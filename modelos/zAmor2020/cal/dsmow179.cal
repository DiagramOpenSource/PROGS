|FICHEROS;

   dsmoz041;
   dsmom040,MANTE;
   dsmom041 #41,MANTE;
   dsmom042 #42,MANTE;
   dsmom044 #44;
   dsmom045 #45;
   dsmom046 #46,MANTE;
   dsmow146 #946,MANTE;
   dsmom049 #49;
   dsmow179,MANTE;

   dsmom107 #107;

   :/contagen/def/cacuenta #300;
   :/contagen/def/camoauxc #312;
   :/contagen/def/anm00001 #313;
   :/contagen/def/anm00007 #314;
   :/contagen/def/anm00014 #324;
   :/contagen/def/anm00015 #325;
   :/contagen/def/cafinanc #360;
   :/contagen/def/cafinanl #361;

   dsmom080 #80;
   dsmom081 #81;
   dsmom085 #85;
   dsmom086 #86;

   &regisnif@ #709;
|FIN;

|VARIABLES;
  &nAmordef   = 0;
  &nAmorpro   = 0;

  &eaDElem  = "";
  &eaHElem  = "";
  &enDNEle  = 0;
  &enHNEle  = 0;
  inkey     = 0;
  aAlfa1    = "";
  aAlfa2    = "";
  nFactor   = 0;
  nPorceMin = 0;
  nPorceMax = 0;
  nSwSal    = 0;
  nSwEsta   = 0;
  swModulo  = 0;
  nContenido   = 0;
  fFecha       = @;
  fFechaUso    = @;
  fFechaVenta  = @;
  fPriVenta    = @;
  fFinVenta    = @;
  fPriCompra   = @;
  fFinCompra   = @;
  aAlfa        = "";
  nVAnyo       = 0;
  nDAnyo       = 0;
  nHAnyo       = 0;
  nPara1       = 0;
  nAnyC  = 0;
  nAnyV  = 0;
  nNume2 = 0;
  nNume1    = 0;
  nProm49   = 0;
  nModo     = 0;
  nImporte  = 0;
  nImport1  = 0;
  nEstado   = 0;
  nDAny     = 0;
  nHAny     = 0;

   &esalta    = 0;
   esaltaL   = 0;
   &sw_lin   = 0;
   &errconta = 0;
   &entrada  = 1;
   alfa1     = "";
   alfa2     = "";
   alfa3     = "";
   alfa4     = "";
   nume1     = 0;
   nume2     = 0;
   nume3     = 0;
   nume4     = 0;

   men1 = "2402Cantidad Negativa de Amort. Fiscal";
   men2 = "2443Cantidad Negativa de Amort. Contable";
   men3 = "2402Cantidad Negativa de Amort. Fiscal       Cantidad Negativa de Amort. Contable";
   men  = "";
   any = "";
   fiac = "  ";
   guarda = "  ";
   relleno = "                                       ";
   aponer = "  ";

   import = 0;
   import1 = 0;
   traba = @;
   elcon = 0;

   &aComVen = "";
   &enSwBien = 0;
   &aCamp1 = "";
   &nCamp2 = 0;
   &fCamp3 = @;
   &nCamp4 = 0;
   &nCamp5 = 0;
   &aCamp6 = "";
   &nCamp7 = 0;
   &aCamp8 = "";
   &nCamp9 = 0;
   &nCamp41_43 = 0;
   &nCamp41_46 = 0;
   &aCamp41_47 = "";
   &aCamp41_48 = "";
   &aCamp41_49 = "";
   &aCamp41_53 = "";
   &aCamp41_50 = "";
   &nCamp41_51 = 0;
   &nCamp41_52 = 0;
   nSwError = 0;

   aLaImpor  = "";
   nLaImpor  = 0;
   nTantoPor = 0;
   nTan      = 0;
   nAlta     = 0;
   nColor    = 0;
   nSwOpera  = 0;
   nTantos   = 0;
   &eaGrAna    = "";
   &enQueAna   = 0;
   &nSwGrupo   = 0;
   &snFilBa    = "";
   nErGrupo    = 0;
   nGrupo      = 0;
   aCtaAcum    = "";
   nEj         = 0;

   &enSwPrim   = 0;
   nUltima     = 0;
   nModoLinea  = 0;

  nOk = 0;
  {30}aPopup        = "";
     aContenido     = "";
     aID            = "";
     nID            = 0;
     aOpera         = "";
|FIN;

|INCLUYE i_variar;
|INCLUYE i_varcon;  || Variables de Contabilidad

|PROCESO TextoAI; |TIPO 0;
     aAlfa1 = "NACTIVO";
 |SI #dsmow179#40 = "A";
     aAlfa1 = "CTIVO  ";
 |FINSI;
 |ATRI P; |PINTA 1274, aAlfa1; |ATRI 0;
|FPRC;

|PROCESO TextoCtaA;
 nGrupo = #dsmow179#18;
 |HAZ VeoGrupo;
 #dsmoz041#4 = aCtaAcum;
 |PINTA #dsmoz041#4;
|FPRC;

|CALCULO tracod1; |TIPO 0; || Desde Campo Descripcion
   inkey = FSalida;
   |SI esalta ! 1;  |Y #dsmow179#26 > "01.01.0000";
       |MENAV "     Atencion! El elemento esta vendido";
   |FINSI;
|FCAL;
|| ************************ Actividades y Reparto
|PROCESO Tip2w146; |TIPO 2;
 nume2 = 0 +.1;
 nTantoPor = nTantoPor +. #946#5;
 |SI #946#5 > nTan; |Y nume2 = 1;
     nTan     = #946#5;
     nLaImpor = #946#1;
     aLaImpor = #946#6;
 |FINSI;
 #dsmoz041#3 = nTantoPor;
 |ATRI P; |PINTA 0873, #dsmoz041#3; |ATRI 0;
|FPRC;

|PROCESO Tip11w146; |TIPO 11;
 inkey = FSalida;
 eOpDep = 0;
 |SI inkey = 10; |Y Campo = 1;
     enActividad = #946#1;
     eOpDep = 1;
     |HAZ LActividad;
     eOpDep = 0;
 |FINSI;
 |SI inkey = 10; |Y Campo = 6;
     enQue = 0;
     eOpSub = 1;
     eaCodSubdep = #946#6;
     |HAZ eSubActividad;
     eOpSub = 0;
 |FINSI;
|FPRC;

|PROCESO Tip0w146; |TIPO 0;
 eOpDep = 0;
 enActividad = #946#1;
 |HAZ LActividad;
 |SI eswLect = 1;
     |MENAV "      Actividad Inexistente";
     |ERROR;
 |SINO;
      #946#1 = enActividad; |PINTA #946#1;
      #946#4 = eaNombreAct; |PINTA #946#4;
      |SI efActFin > "01.01.1900"; |Y snFilBa ! "N";
          aAlfa1 = "    NAtencion!!!. Actividad con Fecha de BAJA " + efActFin + ", Desea introducir Facturas ? ";
          |CONFI aAlfa1;
          |SI FSalida ! 0;
              |ERROR;
              |ACABA;
          |FINSI;
      |FINSI;
      |SI eaEsCom = "S";
          |CONFI "    NAtencion!!!. Actividad Comunera, ¨ Desea introducir Elementos ? ";
          |SI FSalida ! 0;
              |ERROR;
              |ACABA;
          |FINSI;
      |FINSI;
  |FINSI;
|FPRC;

|PROCESO Tip0w146_6; |TIPO 0;
   eOpSub = 0; || 1 = Consulta pantalla
   |SI inkey = 10; eOpSub = 1;  |FINSI;
   |SI inkey = 11; eOpSub = 2;  |FINSI;

   eaCodSubdep = #946#6;
   |HAZ eSubActividad;
   |SI eswLect = 1;
       |MENAV "    Error.! No Existe Subdepartamento";
       |ERROR;
   |SINO;
       #946#6 = eaCodSubdep; |PINTA #946#6;
       #946#7 = eaNomSubdep; |PINTA #946#7;
   |FINSI;
|FPRC;
|| ----------------------------
|PROCESO Tip2m046; |TIPO 2;
 nume2 = 0 +.1;
 nTantoPor = nTantoPor +. #46#5;
 |SI #46#5 > nTan; |Y nume2 = 1;
     nTan     = #46#5;
     nLaImpor = #46#1;
     aLaImpor = #46#6;
 |FINSI;
 #dsmoz041#3 = nTantoPor;
 |ATRI P; |PINTA 0873, #dsmoz041#3; |ATRI 0;
|FPRC;

|PROCESO Tip11m046; |TIPO 11;
 inkey = FSalida;
 eOpDep = 0;
 |SI inkey = 10;
     eOpDep = 1;
     |HAZ LActividad;
     eOpDep = 0;
 |FINSI;
|FPRC;

|PROCESO Tip0m046; |TIPO 0;
 eOpDep = 0;
 enActividad = #46#1;
 |HAZ LActividad;
 |SI eswLect = 1;
     |MENAV "      Actividad Inexistente";
     |ERROR;
 |SINO;
      #46#1 = enActividad; |PINTA #46#1;
      #46#4 = eaNombreAct; |PINTA #46#4;
      |SI efActFin > "01.01.1900"; |Y snFilBa ! "N";
          aAlfa1 = "    NAtencion!!!. Actividad con Fecha de BAJA " + efActFin + ", Desea introducir Facturas ? ";
          |CONFI aAlfa1;
          |SI FSalida ! 0;
              |ERROR;
              |ACABA;
          |FINSI;
      |FINSI;
      |SI eaEsCom = "S";
          |CONFI "    NAtencion!!!. Actividad Comunera, ¨ Desea introducir Elementos ? ";
          |SI FSalida ! 0;
              |ERROR;
              |ACABA;
          |FINSI;
      |FINSI;
  |FINSI;
|FPRC;

|PROCESO Leem046;
 |SI nSwOpera = 0;
     enActividad = #46#1;
     |HAZ LActividad;
     |SI eswLect = 1;
         |BORRA 020#46a;
     |SINO;
         nTantoPor = nTantoPor + #46#5;
         |SI #46#5 > nTan;
             nTan     = #46#5;
             nLaImpor = #46#1;
             aLaImpor = #46#6;
         |FINSI;
         nTantos = nTantos + 1;
     |FINSI;
 |FINSI;
 |SI nSwOpera = 1;
     nColor = nColor + 1;
     |SI nColor > 1; |ERROR10; |FINSI;
 |FINSI;
 |SI nSwOpera = 2;
     |SI nColor = 0; nLaImpor = #46#1;    |FINSI;
     |SI #46#1 = #dsmow179#1;  nLaImpor = #46#1; |FINSI;
     |SI #46#6 = #dsmow179#54; aLaImpor = #46#6; |FINSI;
     nColor   = 1;
 |FINSI;
|FPRC;

|DEFBUCLE Leem046;
 #46#1;
 ;
 #dsmow179#0, #dsmow179#2, #dsmow179#3, 00, "   ";
 #dsmow179#0, #dsmow179#2, #dsmow179#3, 99, "zzz";
 ;
 NULL, Leem046;
|FIN;

|PROCESO ElPrimero;
 nAlta = 0;
 |ABRE #46;
 #46#0 = #dsmow179#0;
 #46#2 = #dsmow179#2;
 #46#3 = #dsmow179#3;
 #46#1 = 0;
 #46#6 = "   ";
 |LEE 041#46];
 |SI FSalida ! 0;
     nAlta = 1;
 |SINO;
    |SI #46#0 ! #dsmow179#0; |O #46#2 ! #dsmow179#2; |O #46#3 ! #dsmow179#3;
        nAlta = 1;
    |FINSI;
 |FINSI;
 |SI nAlta = 1;
    |DDEFECTO #46;
    #46#0 = #dsmow179#0;
    #46#2 = #dsmow179#2;
    #46#3 = #dsmow179#3;
    enActividad = #dsmow179#1;
    |HAZ LActividad;
    |SI eswLect = 0;
        |SI #107#28 = "S"; |Y eaSubdeT = "S";
             #46#6 = #dsmow179#54;
             enQue = 2;
             |HAZ eSubActividad;
             #46#7 = eaNomSubdep;
        |FINSI;
        #46#1 = #dsmow179#1;
        #46#4 = eaNombreAct;
        #46#5 = 100;
        |GRABA 020#46n;
    |FINSI;
 |FINSI;
 |CIERRA #46;
 nTantoPor = 0;
 nTan      = 0;
 nLaImpor  = #dsmow179#1;
 nSwOpera = 0; |BUCLE Leem046;
|FPRC;

|PROCESO ComprueboRep;
 nTantos   = 0;
 nTantoPor = 0;
 nTan      = 0;
 nLaImpor  = #dsmow179#1;
 nSwOpera = 0; |BUCLE Leem046;

 |SI nTantoPor ! 100;
     |MENAV "    Error, no ha repartido el 100 % de los importes";
 |SINO;
     |SI nTantos = 1;
         |ABRE #46;
         #46#0 = #dsmow179#0;
         #46#2 = #dsmow179#2;
         #46#3 = #dsmow179#3;
         #46#1 = nLaImpor;
         #46#6 = aLaImpor;
         |LEE 121#46=;
         |SI FSalida = 0;
             |BORRA 020#46a;
         |FINSI;
         |LIBERA #46;
         #dsmow179#1 = nLaImpor;
         #dsmow179#54 = aLaImpor;
         |CIERRA #46;
    |FINSI;
 |FINSI;
|FPRC;

|RUTINA ClaveBaja46;
 #46#0 = #dsmow179#0;
 #46#1 = 01;
 #46#2 = #dsmow179#2;
 #46#3 = #dsmow179#3;
 #46#6 = "   ";
|FRUT;

|RUTINA ClaveAlta46;
 #46#0 = #dsmow179#0;
 #46#1 = 99;
 #46#2 = #dsmow179#2;
 #46#3 = #dsmow179#3;
 #46#6 = "zzz";
|FRUT;

|RUTINA ClaveBaja946;
 #946#0 = #dsmow179#0;
 #946#1 = 01;
 #946#2 = #dsmow179#2;
 #946#3 = #dsmow179#3;
 #946#6 = "   ";
|FRUT;

|RUTINA ClaveAlta946;
 #946#0 = #dsmow179#0;
 #946#1 = 99;
 #946#2 = #dsmow179#2;
 #946#3 = #dsmow179#3;
 #946#6 = "zzz";
|FRUT;

|PROCESO RepartoAct;
 nLaImpor = #dsmow179#1;
 aLaImpor = #dsmow179#54;
 |HAZ ElPrimero;

 |SI #107#28 = "S"; |Y eaSubdeT = "S";
     |PUSHV 08041880;
     |PINPA #0#946;
     #dsmoz041#3 = nTantoPor;
     |ATRI P; |PINTA 0873, #dsmoz041#3; |ATRI 0;
     |ENTLINEAL #1#946, -4, 2, 16, 0, ClaveBaja946, ClaveAlta946;
 |SINO;
     |PUSHV 08241880;
     |PINPA #0#46;
     #dsmoz041#3 = nTantoPor;
     |ATRI P; |PINTA 0873, #dsmoz041#3; |ATRI 0;
     |ENTLINEAL #1#46, -4, 2, 16, 0, ClaveBaja46, ClaveAlta46;
 |FINSI;
 |HAZ ComprueboRep;
 |POPV;
 #dsmow179#1  = nLaImpor; |PINTA #dsmow179#1;
 #dsmow179#54 = aLaImpor; |PINTA #dsmow179#54;
|FPRC;

|PROCESO MiroReparto;
 nColor   = 0;
 nLaImpor = #dsmow179#1;
 aLaImpor = #dsmow179#54;
 nSwOpera = 2; |BUCLE Leem046;
 |SI nColor = 1;
     |CAMPO_ATRIBUTO #dsmow179#1, S,0,0;
     |SI #dsmow179#1 ! nLaImpor;
         |MENAV "    Error. Existe reparto entre Actividades y esta no esta Incluida";
     |FINSI;
     |C_M #dsmow179#54,1,"N"; #dsmow179#54 = ""; |PINTA #dsmow179#54;
 |SINO;
     |CAMPO_ATRIBUTO #dsmow179#1, D,0,0;
     |C_M #dsmow179#54,1,"S";
 |FINSI;
 #dsmow179#1  = nLaImpor; |PINTA #dsmow179#1;
 #dsmow179#54 = aLaImpor; |PINTA #dsmow179#54;
|FPRC;

|CALCULO LeeLaActividad; |TIPO 0;
  inkey = FSalida;

  |SI inkey = 11;
      |HAZ RepartoAct;
      |ERROR;
      |ACABA;
  |FINSI;

  |HAZ MiroReparto;

  eOpDep = 0;
  |SI inkey = 10; eOpDep = 1; |FINSI;
  enActividad = #dsmow179#1;
  |HAZ LActividad;
  eOpDep = 0;
  |SI eswLect = 1;
      |MENAV "      Actividad Inexistente";
      |ERROR;
  |SINO;
      #dsmow179#1  = enActividad; |PINTA #dsmow179#1;
      #dsmow179#33 = eaNombreAct; |PINTA #dsmow179#33;
      |SI efActFin > "01.01.1900"; |Y snFilBa ! "N";
          aAlfa1 = "    NAtencion!!!. Actividad con Fecha de BAJA " + efActFin + ", Desea introducir Facturas ? ";
          |CONFI aAlfa1;
          |SI FSalida ! 0;
              |ERROR;
              |ACABA;
          |FINSI;
      |FINSI;
      |SI eaEsCom = "S";
          |CONFI "    NAtencion!!!. Actividad Comunera, ¨ Desea introducir Elementos ? ";
          |SI FSalida ! 0;
              |ERROR;
              |ACABA;
          |FINSI;
      |FINSI;

      swModulo = 0;
      |SI enTipoTribut  = 5; |O enTipoTribut  = 10;
          swModulo = 1;
      |FINSI;
      |SI enTipoTribut = 6; |O enTipoTribut = 7; |O enTipoTribut = 11; |O enTipoTribut = 12;
          swModulo = 1;   ||Agricolas  (Paco 30.05.2001)
          |SI enTipoIva = 9; |Y enTipoTribut = 7;
              swModulo = 2;  || adade lugo 28.05.2003
          |FINSI;
      |FINSI;
  |FINSI;
|FCAL;

|CALCULO  TrasSubdep; |TIPO 0;
   inkey = FSalida;
   |C_V #dsmow179#54,0,aAlfa1;
   |SI aAlfa1 = "N"; |ACABA; |FINSI;
   |C_M #dsmow179#54,0,aAlfa1;
   |SI aAlfa1 = "N"; |ACABA; |FINSI;


   eOpSub = 0; || 1 = Consulta pantalla
   |SI inkey = 10; eOpSub = 1;  |FINSI;
   |SI inkey = 11; eOpSub = 2;  |FINSI;

   eaCodSubdep = #dsmow179#54;
   |HAZ eSubActividad;
   |SI eswLect = 1;
       |MENAV "    Error.! No Existe Subdepartamento";
       |ERROR;
   |SINO;
       #dsmow179#54 = eaCodSubdep; |PINTA #dsmow179#54;
   |FINSI;
|FCAL;

|PROCESO ColorAct;
 nColor = 0;
 nSwOpera = 1; |BUCLE Leem046;
 |SI nColor > 0;
     |CAMPO_ATRIBUTO #dsmow179#1, S,0,0;
 |SINO;
     |CAMPO_ATRIBUTO #dsmow179#1, D,0,0;
 |FINSI;
 |PINTA #dsmow179#1;
|FPRC;

|PROCESO VeoGrupo;
 nErGrupo = 0;
 |ABRE #dsmom040;
 |DDEFECTO #dsmom040;
 #dsmom040#0 = enEmpresa;
 #dsmom040#2 = nGrupo;
 |LEE 000#dsmom040.=;
 |SI FSalida ! 0; nErGrupo = 1; |FINSI;
 |CIERRA #dsmom040;

 |SI Campo ! 38;
     aCtaAcum = ""; nEj = 2007;
     |SI #dsmow179#27 > "01.01.0000";
          aAlfa1 = #dsmow179#27; aAlfa1 = aAlfa1 % -104;
          nEj = aAlfa1;
     |FINSI;
     aCtaAcum = #dsmom040#12;
     |SI aCtaAcum = "            "; aCtaAcum = #dsmom040#5; |FINSI;
 |FINSI;
|FPRC;

|CALCULO LeeGrupo; |TIPO 0;
 |C_M #dsmow179#Campo#, 0, aAlfa1;
 |SI aAlfa1 = "N"; |ACABA; |FINSI;

 |SI Campo = 38;
     |SI #dsmow179#Campo# = 0; |ACABA; |FINSI;
 |FINSI;

 nGrupo = #dsmow179#Campo#;
 |HAZ VeoGrupo;
 |SI nErGrupo ! 0;
     |MENAV "    No existe Grupo de Amortizacion ";
     |ERROR;
 |FINSI;
 #dsmow179#0 = enEmpresa;
 |SI Campo = 18; |Y enSwAna = 0;
     #dsmoz041#4 = aCtaAcum; |PINTA #dsmoz041#4;
 |FINSI;
|FCAL;

|| -//////////////////////////////////////////////////////
|CALCULO Prueba; |TIPO 0;
 |SI inkey = 10; |Y swModulo ! 0;  || adade 28.05 swModulo = 1
     |SALVA_DATOS #dsmom041;

     |PARA nPara1 = 0; |SI nPara1 [ 66; |HACIENDO nPara1 = nPara1 + 1;
           #dsmom041#nPara1# = #dsmow179#nPara1#;
     |SIGUE;
     fFecha = ~; aAlfa1 = fFecha;
     aAlfa1 = "31.12." + (aAlfa1 % -104);
     fFechaAmor  = aAlfa1;
     |HAZ CalAmorModulo;
     |PUSHV  12401666;
     |CUADRO 12401665;
     |ATRI R;
     |PINTA 1341, "Amortizacion Modulo      ";
     |PINTA 1441, " Provisional:            ";
     |PINTA 1541, " Definitiva :            ";
     #dsmom041#15 = nAmorpro;
     #dsmom041#21 = nAmordef;
     |PINTA 1455, #dsmom041#15;
     |PINTA 1555, #dsmom041#21;
     |ATRI 0;
     |PAUSA;
     |POPV;
     |REPON_DATOS #dsmom041;
 |FINSI;
|FCAL;

|CALCULO AntesCta1; |TIPO 7;   || Desde Campo Cuenta
   aAlfa2 = "    Cuenta contable Plan 2008 / Ctrl-F2 Utilidades Cuentas";
   |SI #dsmow179#27 > "01.01.0000";
       aAlfa1 = #dsmow179#27; aAlfa1 = aAlfa1 % -104;
       enEjer = aAlfa1;
   |FINSI;
   |SI enEjer < 2008; |Y enHayCambio = 1;
       aAlfa2 = "    Cuenta contable Plan 1990 / Ctrl-F2 Utilidades Cuentas";
   |FINSI;
   |MENSA aAlfa2;
|FCAL;

|CALCULO cuenta1; |TIPO 6;   || Desde Campo Cuenta
     emCta = 1;        || Dar mensajes de error

     eaCuenta = #dsmow179#Campo#;
     salidas  = FSalida;
     |HAZ FiltraPuntos;
     #dsmow179#Campo# = eaCuenta;
     |PINTA #dsmow179#Campo#;

     |HAZ SacaNivel;
     nume1 = Campo + 1;
     #dsmow179#nume1# = enNivel;
|FCAL;

|CALCULO refresca1; |TIPO 0;
   |SI #dsmow179#27 > "01.01.0000";
       aAlfa1 = #dsmow179#27; aAlfa1 = aAlfa1 % -104; enEjer = aAlfa1;
   |FINSI;

   emCta = 0;        || Dar mensajes de error
   eaCuenta = #dsmow179#Campo#;
   |HAZ LeeCuenta;
   |SI eswCta = 1;
        |SI enEjer < 2008; |Y enEn2008 = 1; |Y enHayCambio = 1;
            || ... No doy de alta esta cuenta
            || cuenta del 1990 pero tengo cambio pero no contabilidad del 2007
        |SINO;

            |CONFI "    SError.! No existe Cuenta. Desea darla de alta ";
            |SI FSalida = 0;
                |SUB_EJECUTA_NP "dsmoz030";
                #dsmow179#Campo# = eaCuenta;
                |PINTA #dsmow179#Campo#;
            |SINO;
                |CONFI "    NLa cuenta no existe. Continuar S/N";
                |SI FSalida ! 0;
                    |ERROR;
                |FINSI;
            |FINSI;
        |FINSI;
   |SINO;
        |SI eswCta = 2;
            |MENAV "0000Esta Cuenta NO tiene Pase Directo.";
            |ERROR;
        |FINSI;
   |FINSI;
|FCAL;

|CALCULO comp;
   alfa3 = #dsmow179#1; |QBF alfa3;
   alfa3 = ("00" + alfa3) % -102;
   |ABRE #camoauxc;
   #camoauxc#0 = #dsmow179#5;
   #camoauxc#1 = #dsmow179#6;
   #camoauxc#6 = alfa3;
   |LEE 001#camoauxc.=;
   |SI FSalida = 0;
      |MENAV "0000Esta Cuenta YA existe en el Desglose";
      |ERROR;
   |FINSI;
   |CIERRA #camoauxc;
|FCAL;

                        || Desde Campo Proveedor
|CALCULO ConsuPro;
|FCAL;

                        || Desde Campo Importe Compra
|CALCULO noimporte;
   |SI #dsmow179#Campo# = 0;
      |MENAV "      El importe debe ser diferente de CERO.";
      |ERROR;
   |FINSI;
|FCAL;

                        || Desde Campo Nuevo / Usado
|CALCULO NuevoUsado;
  nFactor = 1;
  |SI #dsmow179#Campo# = "U";  nFactor = 2;  |FINSI;

  |SI swModulo ! 0;   || adade 28.05 swModulo = 1
     |SI #dsmow179#29 = 0;
         |SI #dsmow179#28 = 0;  #dsmow179#29 = 100;           |FINSI;
         |SI #dsmow179#28 = 1;  #dsmow179#29 = 5  * nFactor;  |FINSI;
         |SI #dsmow179#28 = 2;  #dsmow179#29 = 40 * nFactor;  |FINSI;
         |SI #dsmow179#28 = 3;  #dsmow179#29 = 25 * nFactor;  |FINSI;
         |SI #dsmow179#28 = 4;  #dsmow179#29 = 15 * nFactor;  |FINSI;
         |SI #dsmow179#28 = 5;  #dsmow179#29 = 22 * nFactor;  |FINSI;
         |SI #dsmow179#28 = 6;  #dsmow179#29 = 10 * nFactor;  |FINSI;
         |SI #dsmow179#28 = 7;  #dsmow179#29 = 5  * nFactor;  |FINSI;
         |SI #dsmow179#28 = 8;  #dsmow179#29 = 3  * nFactor;  |FINSI;
     |FINSI;

     |SI #dsmow179#30 = 0;
         |SI #dsmow179#28 = 0;  #dsmow179#30 = 100;              |FINSI;
         |SI #dsmow179#28 = 1;  #dsmow179#30 =  2.5  * nFactor;  |FINSI;
         |SI #dsmow179#28 = 2;  #dsmow179#30 = 20    * nFactor;  |FINSI;
         |SI #dsmow179#28 = 3;  #dsmow179#30 = 12.5  * nFactor;  |FINSI;
         |SI #dsmow179#28 = 4;  #dsmow179#30 = 10    * nFactor;  |FINSI;
         |SI #dsmow179#28 = 5;  #dsmow179#30 = 12.5  * nFactor;  |FINSI;
         |SI #dsmow179#28 = 6;  #dsmow179#30 =  5.88 * nFactor;  |FINSI;
         |SI #dsmow179#28 = 7;  #dsmow179#30 =  2.22 * nFactor;  |FINSI;
         |SI #dsmow179#28 = 8;  #dsmow179#30 =  1.25 * nFactor;  |FINSI;
    |FINSI;

    |SI #dsmow179#31 = 0; #dsmow179#31 = #dsmow179#30;  |FINSI;

    |PINTA #dsmow179#29;
    |PINTA #dsmow179#30;
    |PINTA #dsmow179#31;
 |FINSI;
|FCAL;
                        || Desde Campo Tipo Amortizacion Fiscal y Contable
|CALCULO tipamo7; |TIPO 7;

 |SI swModulo ! 0; |Y esalta = 1;
     #dsmow179#57 = 1; |PINTA #dsmow179#57;
     #dsmow179#13 = "N";
     #dsmow179#14 = #dsmow179#30; |PINTA #dsmow179#14;

     #dsmow179#19 = "N";
     #dsmow179#20 = #dsmow179#30; |PINTA #dsmow179#20;
 |FINSI;

 |C_M #dsmow179#14, 1, "S";
 |C_M #dsmow179#17, 1, "S";
 |SI swModulo = 1;
     |C_M #dsmow179#14, 1, "N"; #dsmow179#14 = 0; |PINTA #dsmow179#14;
     |C_M #dsmow179#17, 1, "N";
 |FINSI;
|FCAL;

|CALCULO Ellim; |TIPO 7;
 |SI #dsmow179#13 = "F"; |Y #dsmow179#36 ! 0;
     |C_M #dsmow179#39,1,"S";
 |SINO;
     |C_M #dsmow179#39,1,"N";
 |FINSI;
|FCAL;

|CALCULO ElsAnys07; |TIPO 7;
 nume1 = Campo - 4;
 |SI #dsmow179#nume1# = "R";
     |MENSA "0000Introduzca los a¤os que restan de vida util ";
 |SINO;
     |MENSA "0000Introduzca los a¤os ";
 |FINSI;
|FCAL;

|CALCULO ElsAnys; |TIPO 0;
 |BLIN 4;
 inkey = FSalida;
 |C_M #dsmow179#Campo#,0,aAlfa1;
 |SI aAlfa1 = "N"; |ACABA; |FINSI;
 |SI inkey = 2; |ACABA; |FINSI;

 |SI #dsmow179#Campo# = 0;
     |MENAV "    Introduzca el datos de los A¤os ";
     |ERROR;
 |SINO;
     nume1 = Campo - 4;
     |SI #dsmow179#nume1# ! "R";
         #dsmow179#Campo# = #dsmow179#Campo# ! 0;
         |PINTA #dsmow179#Campo#;
     |FINSI;
 |FINSI;
|FCAL;

|CALCULO Tipo0C57; |TIPO 0;
   |BLIN 4;

   nOk = 0;
   |SI #dsmow179#57 ] 1; |Y #dsmow179#57 [ 10; nOk = 1; |FINSI;
   |SI #dsmow179#57 = 80;                      nOk = 1; |FINSI;
   |SI nOk = 0;
       |MENAV "0000 Tipo de Amortización incorrecto";
       |ERROR;
       |ACABA;
   |FINSI;

   |SI #dsmow179#57 ! 4; |Y #dsmow179#36 ! 0;
       |MENAV "    Error. Este Elemento no se paga por Operacion de Leasing.";
       |ERROR;
       |ACABA;
   |FINSI;

   |SI #dsmow179#11 = "U"; |Y #dsmow179#57 ! 1; |Y #dsmow179#57 ! 80;
      |MENAV "     En un Bien Usado NO se admite este tipo de Amortizacion";
      |ERROR;
      |ACABA;
   |FINSI;

   |SI #dsmow179#57 = 80;
       |SI #dsmow179#9 ] "01.01.2015";
           |MENAV "     Fecha de Compra igual o superior a 01.01.2015, Tipo amortizacion Incorrecto";
           |ERROR;
           |ACABA;
       |FINSI;
       |SI swModulo ! 0;
           |MENAV "     Actividad de Modulos, Tipo amortizacion Incorrecto";
           |ERROR;
           |ACABA;
       |FINSI;
   |FINSI;

   nume1 = Campo + 4;
   |SI #dsmow179#57 = 1;
       #dsmow179#17 = 0;
       #dsmow179#23 = 0;
       |CAMPO_MODIFICA #dsmow179#17, 1, "N";
       |CAMPO_MODIFICA #dsmow179#23, 1, "N";
       |PINTA #dsmow179#17;
       |PINTA #dsmow179#23;
   |SINO;
       |CAMPO_MODIFICA #dsmow179#17, 1, "S";
       |CAMPO_MODIFICA #dsmow179#23, 1, "S";
   |FINSI;

   |SI swModulo = 2; |Y Campo = 13; |Y esalta = 1;
       #dsmow179#19 = #dsmow179#13; |PINTA #dsmow179#19;
       #dsmow179#20 = #dsmow179#14; |PINTA #dsmow179#20;
       #dsmow179#23 = #dsmow179#17; |PINTA #dsmow179#23;
   |FINSI;
   aAlfa = "M";
   |SI #dsmow179#57 = 1; aAlfa = "N"; |FINSI;
   |SI #dsmow179#57 = 2; aAlfa = "D"; |FINSI;
   |SI #dsmow179#57 = 3; aAlfa = "A"; |FINSI;
   |SI #dsmow179#57 = 4; |Y #dsmow179#36 ! 0; aAlfa = "F"; |FINSI;
   |SI #dsmow179#57 = 80; aAlfa = "R"; |FINSI;
   #dsmow179#13 = aAlfa; #dsmow179#19 = aAlfa;
|FCAL;

||--------------------------------------------------------
                        || Desde Campo Fecha Venta
|CALCULO Tipo7C26; |TIPO 7;
   aAlfa1 = "S";
   |SI #dsmow179#58 = 0;
        aAlfa1 = "N";
        #dsmow179#26 = "01.01.0000"; |PINTA #dsmow179#26;
   |FINSI;
   |SI #dsmow179#58 = 2;
       aAlfa1 = "N";
       |SI esalta = 1; |O #dsmow179#26 < "01.01.1900"; aAlfa1 = "S"; |FINSI;
   |FINSI;
   |C_M #dsmow179#26,1, aAlfa1;
|FCAL;

|CALCULO fechave; |TIPO 0;
   |SI esalta = 1;
       #dsmow179#26 = "01.01.0000"; |PINTA #dsmow179#26;
   |FINSI;

   |C_M #dsmow179#40,1,"S";
   |SI #dsmow179#26 > "01.01.1900";
       #dsmow179#40 = "I"; |PINTA #dsmow179#40; |C_M #dsmow179#40,1,"N";
       |HAZ TextoAI;
   |FINSI;
|FCAL;

|CALCULO EnCurso0; |TIPO 0;
   |C_M #dsmow179#35, 0,aAlfa1;
   |SI aAlfa1 = "N"; |ACABA; |FINSI;

   |C_M #dsmow179#9,1, "S";
   |SI #dsmow179#35 = "S";
       #dsmow179#9 = "01.01.0000"; |PINTA #dsmow179#9; |C_M #dsmow179#9,1, "N";
   |FINSI;
|FCAL;

|CALCULO FInicio7;  |TIPO 7;
     |SI #dsmow179#Campo# [ "01.01.1900"; |Y #dsmow179#35 = "N";
         #dsmow179#Campo# = #dsmow179#27; |PINTA #dsmow179#Campo#;
     |FINSI;
|FCAL;

|CALCULO FInicio0;  |TIPO 0;
     |SI #dsmow179#9 < #dsmow179#27; |Y #dsmow179#35 = "N";
         |C_M #dsmow179#9,1,"S";
         |MENAV "    La Fecha Inicio debe ser igual o mayor a la de Compra";
         |ERROR;
     |FINSI;
|FCAL;

|RUTINA inf360;
   #360#0 = enEmpresa;
   #360#1 = 00001;
|FRUT;

|RUTINA sup360;
   #360#0 = enEmpresa;
   #360#1 = 99999;
|FRUT;

|CALCULO LeeFinanciacion; |TIPO 0;
 inkey = FSalida;
 |SI enSwAna = 1;
     |C_V #360#47,1,"S"; |C_A #360#36,1,14;
     |C_V #360#48,1,"S"; |C_A #360#12,1,14;
     |C_V #360#49,1,"S"; |C_A #360#13,1,14;
     |C_V #360#50,1,"S"; |C_A #360#14,1,14;
     |C_V #360#51,1,"S"; |C_A #360#15,1,14;
     |C_V #360#52,1,"S"; |C_A #360#42,1,14;
     |C_V #360#53,1,"S"; |C_A #360#16,1,14;
 |FINSI;

 |SI inkey = 10;
     |ABRE #360;
     #360#1 = #dsmow179#Campo#;
     |CONSULTA_F_CLAVE #1#360,inf360,sup360;
     #dsmow179#Campo# = #360#1; |PINTA #dsmow179#Campo#;
     |CIERRA #360;
     |ERROR;
     |ACABA;
 |FINSI;

 |SI inkey = 11;
     |HAZ ConsulOpera;
     |ERROR;
     |ACABA;
 |FINSI;

 |SI #dsmow179#36 = 0;
     #dsmow179#37 = "01.01.0000";|PINTA #dsmow179#37; |C_M #dsmow179#37,1,"N";
     #dsmow179#38 = 0000;        |PINTA #dsmow179#38; |C_M #dsmow179#38,1,"N";
 |SINO;

     |C_M #dsmow179#37,1,"S";
     |C_M #dsmow179#38,1,"S";

     |ABRE #360;
     nSwError = 0;
     #360#0 = enEmpresa;
     #360#1 = #dsmow179#36;
     |LEE 001#360=;
     |SI FSalida ! 0;
         nSwError = 1;
         |MENAV "    No existe Operacion Financiera";
     |SINO;
         aAlfa1= #360#44; |QBF aAlfa1;
         |SI aAlfa1 ! "";
             |SI #360#44 ! #dsmow179#2; |O #360#45 ! #dsmow179#3;
                 nSwError = 1;
                 |MENAV "    Error.La Operacion Financiera esta asignada a otro Elemento ";
             |FINSI;
         |FINSI;
     |FINSI;
     |SI nSwError = 1;
         |ERROR;
     |SINO;
          #dsmow179#37 = #360#46; |PINTA #dsmow179#37;
     |FINSI;
     |CIERRA #360;
 |FINSI;
|FCAL;

|CALCULO EldefGrupo; |TIPO 7;
 |C_M #dsmow179#Campo#,0,aAlfa1;

 |SI esalta = 1; |Y aAlfa1 = "S";
     #dsmow179#Campo# = #dsmow179#18; |PINTA #dsmow179#Campo#;
 |FINSI;
|FCAL;

                        || Desde Campo Tipo Modelo
|CALCULO TModulo7; |TIPO 7;
  |SI swModulo = 0;
      |C_M #dsmow179#28,1,"N"; #dsmow179#28 = 0; |PINTA #dsmow179#28;
      |C_M #dsmow179#29,1,"N"; #dsmow179#29 = 0; |PINTA #dsmow179#29;
      |C_M #dsmow179#30,1,"N"; #dsmow179#30 = 0; |PINTA #dsmow179#30;
      |C_M #dsmow179#31,1,"N"; #dsmow179#31 = 0; |PINTA #dsmow179#31;
  |SINO;
     |C_M #dsmow179#28,1,"S";
     |C_M #dsmow179#29,1,"S";
     |C_M #dsmow179#30,1,"S";
     |C_M #dsmow179#31,1,"S";

     |PUSHV 1605 2474;
     |||D_CUADRO 1406, 2374;
     |ATRI R;
     |PINTA 1607, " -0- Inmovilizado material nuevos  100% mismo a¤o y menor 601,02   ";
     |PINTA 1707, " -1- Edificios y otras construcciones  (Del  2,5%  al  5%) 40 a¤os ";
     |PINTA 1807, " -2- Utiles, herramientas, equipos.    (Del 20  %  al 40%)  5 a¤os ";
     |PINTA 1907, " -3- Elementos de transportes y resto  (Del 12,5%  al 25%)  8 a¤os ";
     |PINTA 2007, " -4- Inmovilizado inmaterial           (Del 10  %  al 15%) 10 a¤os ";
   || PINTA 2007, " ----------------------------------------------------------------- ";
     |PINTA 2107, " -5- Vacuno, porcino, ovino y caprino  (Del 12,5%  al 22%)  8 a¤os ";
     |PINTA 2207, " -6- Equino y frutales no citricos     (Del  5,88% al 10%) 17 a¤os ";
     |PINTA 2307, " -7- Frutales citricos y vi¤edos       (Del  2,22% al  5%) 45 a¤os ";
     |PINTA 2407, " -8- Olivar                            (Del  1,25% al  3%) 80 a¤os ";

     |ATRI r;
   |FINSI;
|FCAL;

|CALCULO TModulo0;  |TIPO 0;
     inkey = FSalida;
     |C_M #dsmow179#Campo#,0,aAlfa1;
     |SI aAlfa1 = "N"; |ACABA; |FINSI;

     |POPV;

     nContenido = Contenido;
     |SI nContenido ! #dsmow179#Campo#;
         #dsmow179#29  = 0;
         #dsmow179#30  = 0;
         #dsmow179#31  = 0;
         |HAZ NuevoUsado;
     |FINSI;

     |SI #dsmow179#Campo# = 5;
         |C_M #dsmow179#29, 1, "N";
         |C_M #dsmow179#30, 1, "N";
         |C_M #dsmow179#31, 1, "N";
     |FINSI;

     |SI #dsmow179#Campo# = 0;
         |SI #dsmow179#10 > nT600; |Y esalta = 1;
             |CONFI "    NElegido Tipo 0 y el Importe de Compra es superior al Limite. Continuar ?";
             |SI FSalida ! 0;
                 |ERROR;
             |FINSI;
         |FINSI;
     |FINSI;

     |SI inkey = 10;    |HAZ Prueba;  |ERROR; |FINSI;
|FCAL;

                        || Desde Campo Porcentaje Modulos
|CALCULO FiltroPorce;  |TIPO 0;
     |C_M #dsmow179#Campo#,0,alfa1;
     |SI alfa1 = "N"; |ACABA; |FINSI;

     |SI #dsmow179#11 = "N"; nFactor = 1;  |FINSI;
     |SI #dsmow179#11 = "U"; nFactor = 2;  |FINSI;

     |SI #dsmow179#28 = 0;
           nPorceMin = 100;
           nPorceMax = 100;
     |FINSI;

     |SI #dsmow179#28 = 1;
           nPorceMin = 2.5 * nFactor;
           nPorceMax = 5   * nFactor;
     |FINSI;

     |SI #dsmow179#28 = 2;
           nPorceMin = 20  * nFactor;
           nPorceMax = 40  * nFactor;
     |FINSI;

     |SI #dsmow179#28 = 3;
           nPorceMin = 12.5 * nFactor;
           nPorceMax = 25   * nFactor;
     |FINSI;

     |SI #dsmow179#28 = 4;
           nPorceMin = 10   * nFactor;
           nPorceMax = 15   * nFactor;
     |FINSI;

     |SI #dsmow179#28 = 5;
           nPorceMin = 12.5 * nFactor;
           nPorceMax = 22   * nFactor;
     |FINSI;

     |SI #dsmow179#28 = 6;
           nPorceMin = 5.88  * nFactor;
           nPorceMax = 10    * nFactor;
     |FINSI;

     |SI #dsmow179#28 = 7;
           nPorceMin = 2.22 * nFactor;
           nPorceMax = 5    * nFactor;
     |FINSI;

     |SI #dsmow179#28 = 8;
           nPorceMin = 1.25 * nFactor;
           nPorceMax = 3    * nFactor;
     |FINSI;

     |SI #dsmow179#Campo# < nPorceMin;  |O #dsmow179#Campo# > nPorceMax;
         |MENAV "        Porcentaje fuera de limites.";
         |ERROR;
     |FINSI;
|FCAL;
**************************************************************************
|| -------------------------------------------------------------------
|CALCULO Lineam049; |TIPO 0;
    nModo = (FEntrada / 100) ! 0;

    |SI nModo = 3;
        |SI #49#4 = 1;
            |MENAV "    No puede dar de baja esta linea";
            |ERROR;
        |FINSI;
        |ACABA;
   |FINSI;

   |C_M #49#5, 1, "S";
   |C_M #49#6, 1, "S";
   |C_M #49#9, 1, "S";
   |C_M #49#10, 1, "S";
   |SI nModo = 2; |Y #49#4 = 1;
       |C_M #49#5, 1, "N";
       |C_M #49#6, 1, "N";
       |C_M #49#9, 1, "N";
       |C_M #49#10, 1, "N";
   |FINSI;
|FCAL;

|CALCULO elAnyo49; TIPO 0;
 |C_M #49#5,0,aAlfa1;
 |SI aAlfa1 = "N"; |ACABA; |FINSI;

 nNume1 = Contenido;
 nDAny = #dsmow179#74;
 nHAny = #dsmow179#74 + #dsmow179#45;

 |SI #dsmow179#75 ! 0;
     |SI #49#5 > #dsmow179#75;
         |MENAV "    Elemento Vendido. Ejercicio No valido";
         |ERROR;
         |ACABA;
     |FINSI;
 |FINSI;

 |SI #49#5 < nDAny; |O #49#5 > nHAny;
     |MENAV "    A¤o de Regularizacion fuera del Periodo ";
     |ERROR;
 |SINO;
     aAlfa1 = #49#5;
     |SI #49#6 [ "01.01.0000";
         aAlfa2 = "31.12." + aAlfa1;
         #49#6 = aAlfa2;
     |SINO;
         |SI nNume1 ! #49#5;
             aAlfa2 = #49#6; aAlfa2 = aAlfa2 % 106 +  aAlfa1;
             #49#6 = aAlfa2;
         |FINSI;
     |FINSI;
     |PINTA #49#6;
 |FINSI;
|FCAL;

|CALCULO elany7; |TIPO 7;
   |C_M #49#5,0,aAlfa1;
   |SI aAlfa1 = "N"; |ACABA; |FINSI;

   nModo = (FEntrada / 100) ! 0;
   |SI nModo = 1;
       #49#5 = #dsmow179#74 + #49#4 - 1;
       |PINTA #49#5;
   |FINSI;
|FCAL;

|CALCULO Tipo7m049; |TIPO 7;
  nModo = (FEntrada / 100) ! 0;
  |SI nModo = 1;
      enEjer = #49#5;
      |HAZ CalcuPro;
      #49#9 = nProm49;
      |PINTA #49#9;
      |HAZ CalculaRegu;
  |FINSI;
|FCAL;

|CALCULO CalculaRegu;
  |C_M #49Campo,0,aAlfa1;
  |SI aAlfa1 = "N"; |ACABA; |FINSI;

  nImporte = 0;
  nAnyC    = #dsmow179#74;  ||A¤o de la Compra
  nAnyV    = #dsmow179#75;  ||A¤o de la Venta

  |SI nAnyC = #49#5; |Y #49#11 = "C";
       #49#10 = 0; |PINTA #49#10;
       |ACABA;
  |FINSI;

  |SI nAnyV = #49#5; |Y nAnyV ! 0;
      nNume2 = #dsmow179#74 + #dsmow179#45;
      nNume1 = #dsmow179#45 + 1;
      nNume2 = nNume2 - #49#5 + 1; || A¤o final - actual mas 1
      nImport1 = (#dsmow179#43 / nNume1) * nNume2;  ||IVA sop. que me queda

      nImporte = #dsmow179#52 -  nImport1;
      |SI nImporte > 0; nImporte = 0; |FINSI;
      #49#10 = nImporte;
  |SINO;
      nNume1 = #dsmow179#42 - #49#9;
      |SI nNume1 ] -10; |Y nNume1 [ 10;   || Diferencia de mas de 10 puntos
          nImporte = 0;
      |SINO;
          nImport1 = (#dsmow179#10 % #dsmow179#46) % #49#9;
          nImporte = nImport1 - #dsmow179#43;
      |FINSI;
      nNume1 = #dsmow179#45 + 1;
      #49#10 = (nImporte / nNume1);
  |FINSI;

  |PINTA #49#10;
|FCAL;

|CALCULO Tipo2m049; |TIPO 2;
 |SI #49#4 ! 1;
     #dsmow179#76 = #dsmow179#76 +. #49#10; || |PINTA #dsmow179#76;

     #dsmow179#77 = #dsmow179#43 + #dsmow179#76;  || |PINTA #dsmow179#77;

 |FINSI;
|FCAL;

|PROCESO Tipo5m049;  |TIPO 5;
       |LEE 040#49p;
       #49#11 = "R";
       |LINEAS_BI_ATRI #49#11, D, S, -1;
|FPRC;

|PROCESO CalcuPro;

    |HAZ LeeCtrlProrr;
    nProm49 = 100;
    |SI enSwProrr ! 2;
        |SI enEjer [ 2010;
            |ABRE #81;
            #81#0 = #dsmow179#0;
            #81#1 = enEjer;
            #81#2 = #dsmow179#1;
            |LEE 001#81=;
            |SI FSalida = 0;
                nProm49 = #81#6;
            |SINO;
               |ABRE #80;
               #80#0 = #dsmow179#0;
               #80#1 = enEjer;
               |LEE 001#80=;
               |SI FSalida = 0;
                   nProm49 = #80#5;
               |FINSI;
               |CIERRA #80;
            |FINSI;
            |CIERRA #81;
       |SINO;
            |ABRE #86;
            #86#0 = #dsmow179#0;
            #86#1 = enEjer;
            #86#2 = #dsmow179#1;
            |LEE 001#86=;
            |SI FSalida = 0;
                nProm49 = #86#6;
            |SINO;
               |ABRE #85;
               #85#0 = #dsmow179#0;
               #85#1 = enEjer;
               |LEE 001#85=;
               |SI FSalida = 0;
                   nProm49 = #85#5;
               |FINSI;
               |CIERRA #85;
           |FINSI;
           |CIERRA #86;
       |FINSI;
    |FINSI;
|FPRC;

|CALCULO Esinmueble;
    |SI #dsmow179#44 = "S"; #dsmow179#45 = 9; |FINSI;
    |SI #dsmow179#44 = "N"; #dsmow179#45 = 4; |FINSI;
    |PINTA #dsmow179#45;
|FCAL;

|PROCESO LeoDNI; |TIP 6;
     eaVarDni  = #dsmow179#Campo#;
     enCalcCif = 0;
     |HAZ CalculameDNI;
     eaVarDni = (eaVarDni + "             ") % 112;
     |SI #dsmow179#Campo# ! eaVarDni;
         |CONFI "0000SEl Nif puede ser Erroneo. Desea Calcularlo.";
         |SI FSalida = 0;
             #dsmow179#Campo# = eaVarDni;  |PINTA #dsmow179#Campo#;
             |ERROR;
             |ACABA;
         |FINSI;
     |FINSI;

     eaCodNif  = #dsmow179#47;
     |HAZ LeeNifs;

     aContenido = Contenido;
     |SI #dsmow179#47 = aContenido;  |ACABA;   |FINSI;

     |ABRE #709;
     #709#0 = #dsmow179#47;
     |LEE 000#709=;
     |SI FSalida = 0;
         #dsmow179#70 = #709#1;
         #dsmow179#8  = #709#1; |PINTA #dsmow179#8;
     |FINSI;
     |CIERRA #709;
|FPRC;

|PROCESO Sumo;
 #dsmow179#76 = #dsmow179#76 + #49#10;
|FPRC;

|DEFBUCLE Sumo;
 #49#1;
 ;
 #dsmow179#0, #dsmow179#2, #dsmow179#3, 02;
 #dsmow179#0, #dsmow179#2, #dsmow179#3, 99;
 ;
 NULL, Sumo;
|FIN;

|CALCULO SegundaPantalla; |TIPO 7;
   #dsmow179#67 = #dsmow179#2;
   #dsmow179#68 = #dsmow179#3;
   #dsmow179#69 = #dsmow179#4;
   #dsmow179#70 = #dsmow179#8;
   #dsmow179#71 = #dsmow179#27;
   #dsmow179#72 = #dsmow179#10;
   #dsmow179#73 = #dsmow179#26;
   #dsmow179#78 = #dsmow179#47;
   |PINTA #dsmow179#67;
   |PINTA #dsmow179#68;
   |PINTA #dsmow179#69;
   |PINTA #dsmow179#70;
   |PINTA #dsmow179#71;
   |PINTA #dsmow179#72;
   |PINTA #dsmow179#73;
   |PINTA #dsmow179#78;

  |SI enSwPrim = 0;
      enSwPrim = 1;
      |SI esalta = 1; |O #dsmom041#44 = " "; enSwPrim = 0; |FINSI;
  |FINSI;

  |SI #dsmow179#44 = " "; #dsmow179#44 = "N"; |FINSI;

  |SI #dsmow179#27 > "01.01.0000";
      aAlfa1 = #dsmow179#27; aAlfa1 = aAlfa1 % -104;
      enEjer = aAlfa1;
      #dsmow179#74 = enEjer;
  |FINSI;

  #dsmow179#76 = 0;
  |BUCLE Sumo;
  #dsmow179#77 = #dsmow179#76 + #dsmow179#43;
  |PINTA #dsmow179#76;
  |PINTA #dsmow179#77;

  |SI #dsmow179#26 > "01.01.0000";
      aAlfa1 = #dsmow179#26; aAlfa1 = aAlfa1 % -104;
      #dsmow179#75 = aAlfa1;
  |FINSI;

  aAlfa1 = "N";
  |SI #dsmow179#73 > "01.01.0000"; aAlfa1 = "S"; |FINSI;
  |C_M #dsmow179#50, 1, aAlfa1;
  |C_M #dsmow179#51, 1, aAlfa1;
  |C_M #dsmow179#52, 1, aAlfa1;
  |C_M #dsmow179#63, 1, aAlfa1;
  |C_M #dsmow179#65, 1, aAlfa1;
  |C_M #dsmow179#66, 1, aAlfa1;

  |ENTLINEAL #1#49, -4, 7, 22, 0, ClaveBaja49, ClaveAlta49;

  |SI enSwPrim = 0;
      enEjer = #dsmow179#74;
      |HAZ CalcuPro;
      #dsmow179#42 = nProm49;
      |PINTA #dsmow179#42;
      |HAZ CalculaIVA;
  |FINSI;
   enSwPrim = 2;
|FCAL;

|CALCULO CalculaIVA;
    #dsmow179#43 = ( (#dsmow179#10 % #dsmow179#46) ) % #dsmow179#42;
    |PINTA #dsmow179#43;

    #dsmow179#77 = #dsmow179#43 + #dsmow179#76;
|FCAL;

|PROCESO LeoParaCompra;
 #49#7 = #42#12;
 #49#8 = #42#10;
|FPRC;

|DEFBUCLE LeoParaCompra;
 #42#1;
 6;
 #49#0, #49#2, #49#3, 001, "C";
 #49#0, #49#2, #49#3, 999, "C";
 e;
 NULL, LeoParaCompra;
|FIN;

|PROCESO Actua49;
    |ABRE #49;
    |DDEFECTO #49;
    #49#0 = #dsmow179#0;
    #49#2 = #dsmow179#2;
    #49#3 = #dsmow179#3;
    #49#4 = 1;
    |LEE 101#49=;
    nEstado = FSalida;
    #49#0  = #dsmow179#0;
    #49#1  = #dsmow179#1;
    #49#2  = #dsmow179#2;
    #49#3  = #dsmow179#3;
    #49#4  = 1;
    #49#5  = #dsmow179#74;
    #49#6  = #dsmow179#27;
    |SI nEstado ! 0;
        #49#7 = 1;
        #49#8 = "Compra del Elemento";
        |CIERRAT #42;
        |BUCLE LeoParaCompra;
        |ABRET #42;
    |FINSI;
    #49#9  = #dsmow179#42;
    #49#10 = 0;
    #49#11 = "C";
    |SI nEstado = 0; |GRABA 020#49a; |FINSI;
    |SI nEstado ! 0; |GRABA 020#49b; |FINSI;
    |LIBERA #49;
    |CIERRA #49;
|FPRC;
|RUTINA ClaveBaja49;
     #49#0 = #dsmow179#0;
     #49#2 = #dsmow179#2;
     #49#3 = #dsmow179#3;
     #49#4 = 01;
|FRUT;

|RUTINA ClaveAlta49;
     #49#0 = #dsmow179#0;
     #49#2 = #dsmow179#2;
     #49#3 = #dsmow179#3;
     #49#4 = 99;
|FRUT;

|CALCULO Tipo0C50; |TIPO 0;
    |SI FSalida = 2; |ACABA; |FINSI;

    |HAZ Actua49;
    |ENTLINEAL #1#49, -4, 2, 22, 0, ClaveBaja49, ClaveAlta49;
|FCAL;
**************************************************************************
|CALCULO Tipo66C55; |TIPO 66;
     aAlfa = "|C055WID";
     aID   = #dsmow179#aAlfa#;
     nID   = aID;

     aPopup1  = nID;  || Si fuera -1 en la posicion
     aPopup2  = 20;
     aPopup3  = "11. Terrenos dedicados exclusivamente a excombreras";
     aPopup4  = "12. Edificaciones y Construcciones";
     aPopup5  = "21. Maquinaria";
     aPopup6  = "22. Elementos de Transportes";
     aPopup7  = "23. Ordenadores y otros equipos informáticos";
     aPopup8  = "24. Mobiliario";
     aPopup9  = "25. Instalaciones";
     aPopup10 = "26. Barcos y Aeronaves";
     aPopup11 = "27. Batea";
     aPopup12 = "28. Utiles y Herramientas";
     aPopup13 = "29. Otro Inmovilizado Material";
     aPopup14 = "31. Patentes y Marcas";
     aPopup15 = "32. Derechos de Traspaso";
     aPopup16 = "33. Aplicaciones Informáticas";
     aPopup17 = "39. Otro Inmovilizado Intangible";
     aPopup18 = "41. Ganado vacuno, porcino, ovino y caprino";
     aPopup19 = "42. Ganado equino y frutales no cítricos";
     aPopup20 = "43. Frutales cítricos y vi¤edos";
     aPopup21 = "44. Olivar";
     aPopup22 = "49. Otros Bienes Semovientes y Agrícolas";

     IaPopup  = aPopup1  <-;
     |ESPECIFICA "TRACKPOPUP", aPopup;
     |SI FSalida ! 0;
         IaPopup  = aPopup3  <-;
         IaPopup  = IaPopup + (FSalida - 1);

         aAlfa = aPopup % 102;  #dsmow179#55 = aAlfa;
         aAlfa = aPopup % 580;  aOpera = aAlfa;
     |FINSI;

     |PINTA #dsmow179#55;
|FCAL;

|CALCULO Tipo0C55; |TIPO 0;
     nOk = 0;

     |SI #dsmow179#55 = 11; nOk = 1; |FINSI;
     |SI #dsmow179#55 = 12; nOk = 1; |FINSI;
     |SI #dsmow179#55 = 21; nOk = 1; |FINSI;
     |SI #dsmow179#55 = 22; nOk = 1; |FINSI;
     |SI #dsmow179#55 = 23; nOk = 1; |FINSI;
     |SI #dsmow179#55 = 24; nOk = 1; |FINSI;
     |SI #dsmow179#55 = 25; nOk = 1; |FINSI;
     |SI #dsmow179#55 = 26; nOk = 1; |FINSI;
     |SI #dsmow179#55 = 27; nOk = 1; |FINSI;
     |SI #dsmow179#55 = 28; nOk = 1; |FINSI;
     |SI #dsmow179#55 = 29; nOk = 1; |FINSI;
     |SI #dsmow179#55 = 31; nOk = 1; |FINSI;
     |SI #dsmow179#55 = 32; nOk = 1; |FINSI;
     |SI #dsmow179#55 = 33; nOk = 1; |FINSI;
     |SI #dsmow179#55 = 39; nOk = 1; |FINSI;
     |SI #dsmow179#55 = 41; nOk = 1; |FINSI;
     |SI #dsmow179#55 = 42; nOk = 1; |FINSI;
     |SI #dsmow179#55 = 43; nOk = 1; |FINSI;
     |SI #dsmow179#55 = 44; nOk = 1; |FINSI;
     |SI #dsmow179#55 = 49; nOk = 1; |FINSI;

     |SI nOk = 0;
         |MENAV "0000 Tipo de Bien incorrecto";
         |ERROR;
     |FINSI;
|FCAL;

|CALCULO Tipo7C56; |TIPO 7;
  aAlfa1 = "S";
  |SI #dsmow179#55 ! 11; |Y #dsmow179#55 ! 12; |Y #dsmow179#55 ! 22;
      aAlfa1 = "N";
      #dsmow179#56 = "";
      |PINTA #dsmow179#56;
  |FINSI;

  |C_M #dsmow179#56, 1, aAlfa1;
  |SI aAlfa1 = "S";
      aAlfa = "0000Introduzca la Referencia Catastral";
      |SI #dsmow179#55 = 22;
          aAlfa = "0000Introduzca la Matrícula del vehículo";
      |FINSI;
      |MENSA aAlfa;
  |FINSI;
|FCAL;

|CALCULO Tipo0C56; |TIPO 0;
  |BLIN 4;
|FCAL;

|CALCULO Tipo66C57; |TIPO 66;
     aAlfa = "|C057WID";
     aID   = #dsmow179#aAlfa#;
     nID   = aID;

     aPopup1  = nID;  || Si fuera -1 en la posicion
     aPopup2  = 11;
     aPopup3  = "01. Amortización lineal según tablas (cálculo automático)";
     aPopup4  = "02. Amor. según porcentaje constante sobre el imp. pendiente de amor. (cálculo automático)";
     aPopup5  = "03. Amortización según números dígitos - creciente (cálculo automático)";
     aPopup6  = "04. Planes de amortización (cálculo automático)";
     aPopup7  = "05. Depreciación efectiva probada fehacientemente (cálculo manual)";
     aPopup8  = "06. Libertad de Amortización (cálculo manual)";
     aPopup9  = "07. Amortización Acelerada (cálculo automático)";
     aPopup10 = "08. Amortización de Elementos Adquiridos Usados (cálculo automático)";
     aPopup11 = "09. Amortización de Elementos Patrimoniales Objeto de Reinversión - DT 28º LIS (cálculo manual)";
     aPopup12 = "10. Amortización de Activos Nuevos Adquiridos en 2003 y 2004 - DT 13º LIS (cálculo manual)";
     aPopup13 = "80. Amortización según valor residual a 2015 (cálculo automático)";

     IaPopup  = aPopup1  <-;
     |ESPECIFICA "TRACKPOPUP", aPopup;
     |SI FSalida ! 0;
         IaPopup  = aPopup3  <-;
         IaPopup  = IaPopup + (FSalida - 1);

         aAlfa = aPopup % 102;  #dsmow179#57= aAlfa;
     |FINSI;

     |PINTA #dsmow179#57;
|FCAL;

|CALCULO Tipo66C58; |TIPO 66;
     aAlfa = "|C058WID";
     aID   = #dsmow179#aAlfa#;
     nID   = aID;

     aPopup1  = nID;  || Si fuera -1 en la posicion
     aPopup2  = 08;
     aPopup3  = "00. Elemento en Alta";
     aPopup4  = "01. Amortización total";
     aPopup5  = "02. Venta o transmisión";
     aPopup6  = "03. Deterioro o destrucción";
     aPopup7  = "04. Retirada del bien por obsolescencia";
     aPopup8  = "05. Pérdida";
     aPopup9  = "06. Robo";
     aPopup10 = "99. Otras causas diferentes a las anteriores";

     IaPopup  = aPopup1  <-;
     |ESPECIFICA "TRACKPOPUP", aPopup;
     |SI FSalida ! 0;
         IaPopup  = aPopup3  <-;
         IaPopup  = IaPopup + (FSalida - 1);

         aAlfa = aPopup % 102;  #dsmow179#58= aAlfa;
     |FINSI;

     |PINTA #dsmow179#58;
|FCAL;

|CALCULO Tipo0C58; |TIPO 0;
     nOk = 0;
     |SI #dsmow179#58 ] 0; |Y #dsmow179#58 [ 6; nOk = 1; |FINSI;
     |SI #dsmow179#58 = 99;                     nOk = 1; |FINSI;
     |SI nOk = 0;
         |MENAV "0000 Causa de Baja incorrecta";
         |ERROR;
     |FINSI;
     |SI #dsmow179#58 ! 0;
         #dsmow179#40 = "I";
     |SINO;
         #dsmow179#40 = "A";
     |FINSI;
     |HAZ TextoAI;
|FCAL;

|CALCULO Tipo12w179; |TIPO 12;

    |ABRE #dsmom040;
    |DDEFECTO #dsmom040;
    #dsmom040#0 = #dsmow179#0;
    #dsmom040#2 = #dsmow179#18;
    |LEE 041#dsmom040.=;
    alfa1 = #dsmom040#10; |QBF alfa1;
    alfa2 = #dsmom040#12; |QBF alfa2;
    alfa3 = #dsmow179#5;  |QBF alfa3;
    |SI alfa1 = ""; |O alfa2 = ""; |O alfa3 = "";
        |MENAV "0000Aviso. Cuentas Contables en Blanco.";
    |FINSI;
    |CIERRA #dsmom040;
|FCAL;

|RUTINA ClaveBaja361;
 #361#0 = #360#0;
 #361#1 = #360#1;
 #361#2 = 001;
|FRUT;

|RUTINA ClaveAlta361;
 #361#0 = #360#0;
 #361#1 = #360#1;
 #361#2 = 999;
|FRUT;

|PROCESO ConsulOpera;
   |ABRE #360;
   #360#0 = enEmpresa;
   #360#1 = #dsmow179#36;
   |LEE 001#360=;
   |SI FSalida ! 0;
       |MENAV "    No existe Operacion Financiera";
       |CIERRA #360;
       |ACABA;
   |FINSI;

   |PUSHV 0501 2380;
   |PINPA #0#360;
   |PINDA #0#360;
   |ENTLINEAL #1#361, -3, 4, 22, 1, ClaveBaja361, ClaveAlta361
   |CIERRA #360;
   |CLS;
   |POPV;
|FPRC;

**************************************************************************
LLAMADAS DESDE CUENTAS
**************************************************************************
|CALCULO cuenGrupo; |TIPO 7;
  |SI enSwAna = 1;
      |C_V #dsmom040#09,1,"S";
      |C_M #dsmom040#09,1,"S";
      |ATRI P; |PINTA 0934, "Cuenta Analitica: "; |ATRI 0;
  |SINO;
      |C_V #dsmom040#09,1,"N";
      |C_M #dsmom040#09,1,"N";
      |PINTA 0934, "                  ";
  |FINSI;

  |C_M #dsmom040#3, 1,"S"; |C_M #dsmom040#5, 1,"S";
  |C_M #dsmom040#10,1,"S"; |C_M #dsmom040#12,1,"S";
  |SI enEjer < 2008;
      |C_M #dsmom040#10,1,"N";
      |C_M #dsmom040#12,1,"N";
  |SINO;
      |C_M #dsmom040#3,1,"N";
      |C_M #dsmom040#5,1,"N";
  |FINSI;
|FCAL;

|CALCULO cuentag; |TIPO 6;
     |C_M #dsmom040#Campo#, 0, aAlfa1;
     |SI aAlfa1 = "N"; |ACABA; |FINSI;
     emCta = 1;        || Dar mensajes de error

     eaCuenta = #dsmom040#Campo#;
     salidas  = FSalida;
     |HAZ FiltraPuntos;
     #dsmom040#Campo# = eaCuenta;
     |PINTA #dsmom040#Campo#;

     |HAZ SacaNivel;
     nume1 = Campo + 1;
     #dsmom040#nume1# = enNivel;
|FCAL;

|CALCULO refrescag; |TIPO 0;
   |C_M #dsmom040#Campo#, 0, aAlfa1;
   |SI aAlfa1 = "N"; |ACABA; |FINSI;

   emCta = 0;        || no Dar mensajes de error
   eaCuenta = #dsmom040#Campo#;
   |HAZ LeeCuenta;
   |SI eswCta = 1;
        |ERROR;
        |CONFI "    SError.! No existe Cuenta. Desea darla de alta ";
        |SI FSalida = 0;
            |SUB_EJECUTA_NP "dsmoz030";
            #dsmom040#Campo# = eaCuenta;
            |PINTA #dsmom040#Campo#;
        |FINSI;
   |SINO;
        |SI eswCta = 2;
            |MENAV "0000Esta Cuenta NO tiene Pase Directo.";
            |ERROR;
        |FINSI;
   |FINSI;
|FCAL;

|PROCESO cuenta08; |TIPO 7;
|FPRC;

|PROCESO elTipo3g; |TIPO 3;
   alfa1 = #dsmom040#10; |QBF alfa1;
   alfa2 = #dsmom040#12; |QBF alfa2;
   |SI alfa1 = ""; |O alfa2 = "";
       |MENAV "0000Aviso. Cuentas Contables en Blanco.";
   |FINSI;
   #dsmom040#8 = #dsmom041#32; ||A todas las Lineas Nombre empresa
|FPRC;
|| ============================================================

|PROCESO EntraAlaLineag;  |TIPO 5;
|FPRC;

|CALCULO AntesAnaG; |TIPO 7;
|FCAL;
|CALCULO anactaG; |TIPO 0;
|FCAL;

|RUTINA inf2;
   #dsmom040#0 = enEmpresa;
   #dsmom040#2 = 0001;
|FRUT;

|RUTINA sup2;
   #dsmom040#0 = enEmpresa;
   #dsmom040#2 = 9999;
|FRUT;

|CALCULO ElsGrups; |TIPO 6;
   |SI FSalida = 10;
      |ABRE #dsmom040;
      #dsmom040#2 = #dsmow179#Campo#;
      |CONSULTA_F_CLAVE #1#dsmom040,inf2,sup2;
      #dsmow179#Campo# = #dsmom040#2; |PINTA #dsmow179#Campo#;
      |ERROR;
      |CIERRA #dsmom040;
   |FINSI;
   |SI Campo = 38;
       |SI #dsmow179#38 = 0;
           |ABRE #dsmom040;
           #dsmom040#0 = #dsmow179#0;
           #dsmom040#2 = 0;
           |LEE 041#dsmom040.=;
           |SI FSalida ! 0;
               |DDEFECTO #dsmom040;
               #dsmom040#0 = #dsmow179#0;
               #dsmom040#2 = 0;
               |GRABA 020#dsmom040.n;
           |FINSI;
           |CIERRA #dsmom040;
       |FINSI;
   |FINSI;
|FCAL;

|| ----- Cuentas analiticas
|CALCULO AntesAna; |TIPO 7;
 |SI enSwAna = 1;
     |SI esalta = 1;
         #dsmow179#34 = #dsmom040#9;
         |PINTA #dsmow179#34;
     |FINSI;
     eaCuenta = #dsmow179#5;
     |HAZ LeeTablaAna;
     |SI swRelac = 0;
         #dsmow179#34 = eaCtaAna;
         |C_M #dsmow179#34,1,eaAnaMod;
     |SINO;
         |SI eaPAna = "S";
             |C_M #dsmow179#34,1,"N";
         |SINO;
             |C_M #dsmow179#34,1,"S";
         |FINSI;
     |FINSI;
     |PINTA #dsmow179#34;
 |FINSI;
|FCAL;

|CALCULO anacta; |TIPO 0;
  inkey = FSalida;
  |SI enSwAna = 0; |ACABA; |FINSI;

    salidas = FSalida; |HAZ FPuntosAna;
    eOpAna = 0; || 1 = Consulta pantalla
    |SI inkey = 10; eOpAna = 1;  |FINSI;
    eaCtaAna = #dsmow179#34;
    |HAZ LeeCtaAna;
    |SI eswLect = 1;
        |CONFI "    SError.! No existe Cuenta. Desea darla de alta ";
        |SI FSalida = 0;
            |SUB_EJECUTA_NP "dsmoz035";
        |FINSI;
        #dsmow179#34 = eaCtaAna;
        |PINTA #dsmow179#34;
        |ERROR;
    |SINO;
        #dsmow179#34 = eaCtaAna;
        |PINTA #dsmow179#34;

        enQueAna = 5; ||comprobacion
        |SI inkey = 11; enQueAna = 0; |FINSI; ||Consulta
        |SI inkey = 12; enQueAna = 1; |FINSI; ||Modificacion
        |SI inkey = 13; enQueAna = 2; |FINSI; ||Recalculo
        |HAZ GrupoAna;
   |FINSI;
|FCAL;

|PROCESO GrupoAna;

  |SI eaGAna = "S"; |ACABA; |FINSI; ||No existe reparto especifico

  nSwGrupo = 0;
  enEmpresa  = #dsmow179#0;
  eaElemento = #dsmow179#2;
  enElemeNum = #dsmow179#3;
  eaElemeNom = #dsmow179#4;
  enElemeCom = #dsmow179#10;
  eaGrAna    = #dsmow179#34;

  alfa1 = enEmpresa;  |QBF alfa1; alfa1 = ("00000" + alfa1) % -105;
  alfa2 = enPerConta; |QBF alfa2; alfa2 = ("0"     + alfa2) % -101;
  alfa3 = ":contagen/anm00014 canempr1 " + alfa1 + alfa2;
  |PUSHV 0622 2380;
  |SUB_EJECUTA_NP alfa3;
  |SI nSwGrupo = 1;
      |ERROR;
  |FINSI;
  |POPV;
|FPRC;
