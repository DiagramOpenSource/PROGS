|FICHEROS;
   :/contagen/def/canempre #330;
   :/basica/def/agifigen #118;
|FIN;

|VARIABLES;
   nSNum1 = 0;
   nSNum2 = 0;
   nSNum3 = 0;
   nSNum4 = 0;
   nSPin1 = 0;
   nSany  = 0;
   nSanyMas = 0;
   nYaLeo = 0;
   nPara0 = 0;
|FIN;

|| //////////////////// Calculos de Pantalla \\\\\\\\\\\\\\\\\\\\\\\\\\
|CALCULO YaSeCual; |TIPO 7;
 nSNum1 = nCamSel + 1; nSNum2 = nCamSel + 2;
 nSNum3 = nCamSel + 3; nSNum4 = nCamSel + 12;

 |SI enEmpresa ! 0;
     #0nCamTip = "S"; |PINTA #0nCamTip;
     #0nCamSel = "S"; |PINTA #0nCamSel;
     #0nSNum1 = 00;   |PINTA #0nSNum1;
     #0nSNum2 = 99;   |PINTA #0nSNum2;
     |C_M #0nCamSel, 1, "N";
     |C_M #0nSNum1,  1, "N";
     |C_M #0nSNum2,  1, "N";
     |C_M #0nCamTip, 1, "N";
 |FINSI;
|FCAL;

|CALCULO SelTipo0; |TIPO 0;
 nSNum1 = nCamSel + 1; nSNum2 = nCamSel + 2;
 nSNum3 = nCamSel + 3; nSNum4 = nCamSel + 12;
 |SI #0nCamTip = "N";
     #0nSNum1 = 0;  |PINTA #0nSNum1;  |C_M #0nSNum1, 1, "N";
     #0nSNum2 = 99;  |PINTA #0nSNum2;  |C_M #0nSNum2, 1, "N";
     |PARA nCampo = nSNum3;  |SI nCampo [ nSNum4;  |HACIENDO nCampo = nCampo + 1;
           |C_M #0nCampo, 1, "S";
     |SIGUE;
 |SINO;
     |SI enEmpresa = 0;
         |C_M #0nSNum1, 1, "S";
         |C_M #0nSNum2, 1, "S";
     |FINSI;
     |PARA nCampo = nSNum3;  |SI nCampo [ nSNum4;  |HACIENDO nCampo = nCampo + 1;
           |C_M #0nCampo, 1, "N";
           #0nCampo = 0;  |PINTA #0nCampo;
     |SIGUE;
 |FINSI;
|FCAL;

|CALCULO SelTipo1;
 nSNum4 = nCamSel + 12;
 |SI #0Campo = 0;
     |PARA nCampo = Campo + 1;  |SI nCampo [ nSNum4;  |HACIENDO nCampo = nCampo + 1;
           #0nCampo = 0;  |C_M #0nCampo, 1, "N"; |PINTA #0nCampo;
     |SIGUE;
 |SINO;
     |PARA nCampo = Campo + 1;  |SI nCampo [ nSNum4;  |HACIENDO nCampo = nCampo + 1;
           |C_M #0nCampo, 1, "S";
     |SIGUE;
 |FINSI;
|FCAL;


|PROCESO BuscaEmpresa0;
 swerror = 0;   || Si que existe

 |SI #canempre#26  < 80;
     nSany = 2000 + #canempre#26;
 |SINO;
     nSany = 1900 + #canempre#26;
 |FINSI;

 |SI nSany > nSanyMas; || El ejercicio mas alto
     nSanyMas = nSany;
     eaEstadoEmp = "S";
     |SI #canempre#21 = "I"; eaEstadoEmp = "N"; |FINSI;
 |FINSI;
|FPRC;

|DEFBUCLE BuscaEmpresa;
 #canempre#1;
 ;
 enEmpresa,0;
 enEmpresa,9;
 ;
 NULL, BuscaEmpresa0;
|FIN;

|PROCESO LaSelEmpresa;

 enSwSelEmp  = 1;   || No es buena

 swerror = 1;
 eaEstadoEmp = "";
 nSanyMas = 0;
 |BUCLE BuscaEmpresa;
 |SI swerror = 1;
     eaEstadoEmp= "S";
 |FINSI;
 |SI #0nCamSel = "N"; |Y eaEstadoEmp = "N";  |ACABA; |FINSI;  || Inactiva

 nSNum1 = nCamSel + 1; nSNum2 = nCamSel + 2;
 nSNum3 = nCamSel + 3; nSNum4 = nCamSel + 12;

 |ABRE #agifigen;
 #agifigen#0 = enEmpresa;
 |LEE 041#agifigen.=;
 |SI FSalida ! 0;
     |DDEFECTO #agifigen;
 |FINSI;
 |CIERRA #agifigen;

 eaNombreEmp = #agifigen#1;

 |SI swerror = 1;
     swerror = 0;
     eaEstadoEmp = "S";
     |SI #agifigen#94 > "01.01.0000"; |Y #agifigen#94 [ efFecTope;
         eaEstadoEmp = "N";
     |FINSI;
     |SI #0nCamSel = "N"; |Y eaEstadoEmp = "N";  |ACABA; |FINSI;  || Inactiva
 |FINSI;

 nSPin1 = #agifigen#87;
 |SI #0nCamTip = "S";
      |SI nSPin1 ] #0nSNum1; |Y nSPin1 [ #0nSNum2;
          enSwSelEmp = 0;
      |FINSI;
 |SINO;
      |SI nSPin1 = #0nSNum3;
          enSwSelEmp = 0;
      |SINO;
          |PARA nPara0 = nSNum3;  |SI nPara0 [ nSNum4;  |HACIENDO nPara0 = nPara0 + 1;
                |SI nSPin1 = #0nPara0; |Y nSPin1 ! 0;
                    enSwSelEmp = 0;
                    |SAL;
                |FINSI;
          |SIGUE;
      |FINSI;
  |FINSI;
  enTpEm = #agifigen#87;
|FPRC;


|PROCESO LaSelEmpresa2;
 enSwSelEmp  = 1;   || No es buena
 |SI #0nCamSel = "N"; |Y eaEstadoEmp = "N";  |ACABA; |FINSI;  || Inactiva

 nSNum1 = nCamSel + 1; nSNum2 = nCamSel + 2;
 nSNum3 = nCamSel + 3; nSNum4 = nCamSel + 12;
 |SI nYaLeo = 0;
     |ABRE #agifigen;
     #agifigen#0 = enEmpresa;
     |LEE 041#agifigen.=;
     |SI FSalida ! 0;
         |DDEFECTO #agifigen;
     |FINSI;
     |CIERRA #agifigen;
 |FINSI;
 nSPin1 = #agifigen#87;

 |SI #0nCamTip = "S";
      |SI nSPin1 ] #0nSNum1; |Y nSPin1 [ #0nSNum2;
          enSwSelEmp = 0;
      |FINSI;
 |SINO;
      |SI nSPin1 = #0nSNum3;
          enSwSelEmp = 0;
      |SINO;
          |PARA nPara0 = nSNum3;  |SI nPara0 [ nSNum4;  |HACIENDO nPara0 = nPara0 + 1;
               |SI nSPin1 = #0nPara0; |Y nSPin1 ! 0;
                   enSwSelEmp = 0;
                   |SAL;
               |FINSI;
          |SIGUE;
      |FINSI;
  |FINSI;
|FPRC;
