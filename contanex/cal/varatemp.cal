|INCLUYE dscnex_v;
|FICHEROS;
   varatemp #0;
|FIN;

|VARIABLES;
   sw       = 0;

   fondo    = " ";
   x        = 0;
   posici   = 0;
   horizo   = "";

   alfa1 = "";

{-1} menu   = "";
   menu1    = "1416";
   menu2    = "1";
   menu3    = "4";
   menu4    = "Datos Ratio                   ";
   menu5    = "Texto Explicativo             ";
   menu6    = "Calcular (Desde Entrada Gral.)";
   menu7    = "Imprimir Comprobacion         ";
|FIN;

|| =======================================================================
||                  PROCESOS POR PANTALLA
|| =======================================================================

|PROCESO leeregi; |TIPO 0;
  modo = (FEntrada / 100) ! 0;
  |SI dirfich0 = "*";
      |CAMPO_MODIFICA #0#58, 1, "S";
  |SINO;
      |CAMPO_MODIFICA #0#58, 1, "N";
  |FINSI;
|SI modo = 1;
    |SI dirfich0 ! "*";
        |ABRE #30;
        #30#2 = #0Campo;
        #30#3 = 0;
        |LEE 011#30];
        |SI FSalida ! 0;  |O #30#2 ! #0Campo;
            |MENAV "     NO Existe la Empresa Contable";
            |ERROR;
            |CIERRA #30;
            |ACABA;
        |FINSI;
        |CIERRA #30;
        #0#58 = #30#1;
        #0#59 = #30#3;
        |PINTA #0#58;
    |FINSI;
    #0#28 = "00.00.0000"; |PINTA #0#28;
    #0#42 = "00.00.0000"; |PINTA #0#42;
    #0#56 = "00.00.0000"; |PINTA #0#56;
 |FINSI;
|FPRC;

|CALCULO con_empr; |TIPO 0;
  |SI FSalida ! 9;  |ACABA;  |FINSI;
  |SI dirfich0 = "*"; |ACABA; |FINSI;

  |CIERRAT #30;
  |SUB_EJECUTA_NP "vaconemp";
  |ABRET #30;
  |ERROR;
  |SI r_emp = 0; |PTEC 808; |ACABA; |FINSI;

  #0#0 = r_emp; |PINTA #0#0;
  #0#1 = r_eje; |PINTA #0#1;
  #0#59 = #30#3;
  |SI dirfich0 = "*"; #0#58 = r_nom; |PINTA #0#58; |FINSI;
  |PTEC 802;
|FCAL;

|| ===================== Procesos de Actualizacion

|PROCESO acceso;|TIPO 30;
 modo = (FEntrada / 100) ! 0;
|SI modo = 1; |O modo = 2;
    |CIERRAT #0;
    |HAZ pantalla;
    |ABRET #0;
|FINSI;
|FPRC;

|PROCESO consulta; |TIPO 13;
 modo = FEntrada / 100;
 modo = modo ! 0;
 |SI modo = 4;
     |PINTA #0#0;
     |PINTA #0#1;
     |PINTA #0#58;
     |PINTA #0#2;
     |PINTA #0#3;
     |PINTA #0#4;
     |PINTA #0#28;
     |PINTA #0#42;
     |PINTA #0#56;
     |HAZ pantalla;
 |FINSI;
|FPRC;

|PROCESO pantalla;
 opcion = 1;
 sw = 0;
 empresa = #0#0;
 anyo    = #0#1;
 codrati = #0#2;
 descrip = #0#3;
 codform = #0#4;
 nombre  = #0#58;
 fec_con = #0#28;
 fec_ant = #0#42;
 fec_pre = #0#56;
 periodo = #0#59;

|PARA; |SI sw = 0; |HACIENDO;
   |PARA x =  13; |SI x [ 19; |HACIENDO x = x + 1;
       posici = (x * 100) + 52;
       |PINTA posici,fondo;
       posici = (x * 100) + 53;
       |PINTA posici,fondo;
   |SIGUE;
   horizo = "";
   |PARA x = 9; |SI x [ 52; |HACIENDO x = x + 1;
       horizo = horizo + fondo;
   |SIGUE;
   |PINTA 2010,horizo;
   menu2  = opcion;
   |MENUG menu;
   opcion = FSalida;
   |SI opcion ] 1; |Y opcion [ 4;

       |SI opcion = 1;
           |SUB_EJECUTA_NP "varatem1";
           |SI sw_act = 1
               #0#56 = fec_pre;     |PINTA #0#56;
           |FINSI;
       |FINSI;    || ... Previsto

       |SI opcion = 2;
           |SUB_EJECUTA_NP "varatem2";
       |FINSI;  || ... Texto

       |SI opcion = 3; |Y modo ! 4;  || pasar datos Contabilidad
           sw_act = 0;
           |SUB_EJECUTA_NP "varatem3";
           |SI sw_act = 1
               #0#28 = fec_con;     |PINTA #0#28;
               #0#42 = fec_pre;     |PINTA #0#42;
               #0#56 = fec_pre;     |PINTA #0#56;
           |FINSI;
       |FINSI;

       |SI opcion = 4;
           |SUB_EJECUTA_NP "varatem4";
       |FINSI;  || ... Impresion
       |PINDA #0#0;
   |SINO;
       sw = 1;
   |FINSI;

|SIGUE;
|PINPA #0#0;
|FPRC;
