|FICHEROS;
   va8bal00 #0;
   va8planl #1;
   va8planc #8;
   vadacoli #2;

   va8bal02 #3;
   va8bal03 #4;
   va8bal04 #5;
   va8bal05 #6;
   va8accba #7;
|FIN;

|VARIABLES;

   &act_ant_con = "";
   fecact = 0;
   fecant = 0;
   feccon = 0;

     FEstado3 = 0;
     FEstado4 = 0;
     FEstado5 = 0;
     FEstado6 = 0;
     FEstado7 = 0;

     cantidad = 0;
     anyob    = 0;

     cuentad  = "";
     cuentah  = "";
     vari     = "";
     aste     = "";
     long     = "";
     numero   = "";
     longi    = 0;
     el141    = 0;
     el142    = 0;
     x        = 0;
     y        = 0;
     alfa1    = "";
     blancos  = "                              ";
     nume1    = 0;

     &eaPrograma = "";
     &eaExtension = "";
     nActual      = 0;
|FIN;

|INCLUYE dscnex_v;
|| **************************************************************************
||                            CALCULOS DE PANTALLA
|| **************************************************************************

|PROCESO mayor;
  alfa1 = #0Campo > " ";
  #0Campo = alfa1;
  |PINTA #0Campo;
|FPRC;


|PROCESO planilla;
 |SI FSalida = 2; |ACABA; |FINSI;
 |ABRE #8;
 #8#0 = #0Campo;
 |LEE 040#8=;
 |SI FSalida ! 0;
     |PINTA 1426, blancos;
     |MENAV "      No existe Planilla.";
     |ERROR;
 |SINO;
     |ATRI I; |PINTA 1426, #8#1; |ATRI 0;
 |FINSI;
 |CIERRA #8;
|FPRC;

|PROCESO cuadro; |TIPO 7;
 |PUSHV 1601 2380;
 |SI modo ! 1;
     ||  "³ MODIFICACION ³";
     |CUADRO 1616 2271;
     |ATRI R;
     |PINTA 1717, " (S) Deja Datos ACTUALES igual a Datos CONTABILIDAD   ";
     |PINTA 1817, " (N) Pone a Cero Datos ACTUALES                       ";
     |PINTA 1917, " (D) NO modifica Datos ACTUALES                       ";
     |PINTA 2017, "------------------------------------------------------";
     |PINTA 2117, " (S) o (N) Pasa Datos ACTUALES validados a ANTERIORES ";
     |ATRI r;
  |SINO;
     ||  "³ ALTA ³";
     |CUADRO 1618 1971;
     |ATRI R;
     |PINTA 1719, " (S) Deja Datos ACTUALES igual a Datos CONTABILIDAD ";
     |PINTA 1819, " (N) o (D) Deja Datos ACTUALES a Cero               ";
     |ATRI r;
  |FINSI;
|FPRC;

|PROCESO repon; |TIPO 0;
 |POPV;
|FPRC;

|PROGRAMA;
 |HAZ LosPatrones;
 |SI Planilla = 0;
     |PINPA #0#0;
     |DDEFECTO #0;
     |PINDA #0#0;
     |ENDATOS #1#0;
     |SI FSalida ! 0; |ACABA; |FINSI;
     Planilla= #0#0;
     fec_con = #0#1;
     act_ant_con = #0#2;
 |SINO;
     #0#3 = "SI";
     empresa = empAlta;
 |FINSI;
 |SI #0#3 = "SI";
     |HAZ pase;
     sw_act = 1;
 |FINSI;
|FPRO;

|| *************************************************************************
||                        PROCESOS PARA EL ABREVIADO
|| *************************************************************************

|PROCESO abreviad2;
 nume1 = #1#9;
 alfa1 = #1#6;
 alfa1 = alfa1 % 101;
 |SI alfa1 = "1";   || Activo;
     #3nume1 = #3nume1 + cantidad;
 |FINSI;
 |SI alfa1 = "2";   || Paviso;
     #4nume1 = #4nume1 + cantidad;
 |FINSI;
 |SI alfa1 = "3";   || Cta Resultado
     |SI #1#7 = "+";
         #5nume1 = #5nume1 - cantidad;
         #5#116 = #5#116 + cantidad;
     |SINO;
         #5nume1 = #5nume1 + cantidad;
         #5#168 = #5#168 + cantidad;
     |FINSI;
 |FINSI;
|FPRC;

|PROCESO pasaabr;   || Manual los dos a¤os
   |PINTA 2207, " PASANDO CUENTA: ";
   |ATRI I;
   |PINTA 2224, #2#3;
   |ATRI 0;

   cantidad = #2#8;
   |SI cantidad ! 0;
       |SI #1#10 ! " ";
          |SI #1#10 = "P"; |Y cantidad < 0; |ACABA; |FINSI;
          |SI #1#10 = "N"; |Y cantidad > 0; |ACABA; |FINSI;
        |FINSI;
        |SI #1#7 = "-"; cantidad = -#2#8; |FINSI;
   |FINSI;
   |HAZ abreviad2;
|FPRC;

|DEFBUCLE liapun3;
#2#2;
;
empresa, anyo, cuentad;
empresa, anyo, cuentah;
e;
NULL, pasaabr;
|FIN;

|PROCESO bulinabr;
 |HAZ montacuen;
 |BUCLE liapun3;        || Lee las lineas apuntes para el abreviado
                        || para manual
|FPRC;

|DEFBUCLE planabre;
 #1#1;
 9;
 #0#0, 001, 001;
 #0#0, 999, 999;
 e;
 NULL, bulinabr;
|FIN;

|| *************************************************************************
||                        PROCESOS PARA EL EXTENSO
|| *************************************************************************

|PROCESO extenso2;
 nume1 = #1#3;
 alfa1 = #1#5;
 alfa1 = alfa1 % 101;
 |SI alfa1 = "1";   || Activo;
     #3nume1 = #3nume1 + cantidad;
 |FINSI;
 |SI alfa1 = "2";   || Paviso;
     #4nume1 = #4nume1 + cantidad;
 |FINSI;
 |SI alfa1 = "3";   || Cuenta Resultados
     |SI #1#7 = "+";
         #5nume1 = #5nume1 - cantidad;
         #5#116 = #5#116 + cantidad;
     |SINO;
         #5nume1 = #5nume1 + cantidad;
         #5#168 = #5#168 + cantidad;
     |FINSI;
 |FINSI;
|FPRC;

|PROCESO pasaext;   || Manual los dos a¤os
   |PINTA 2207, " PASANDO CUENTA: ";
   |ATRI I;
   |PINTA 2224, #2#3;
   |ATRI 0;

   cantidad = #2#8;
   |SI cantidad ! 0;
       |SI #1#10 ! " ";
          |SI #1#10 = "P"; |Y cantidad < 0; |ACABA; |FINSI;
          |SI #1#10 = "N"; |Y cantidad > 0; |ACABA; |FINSI;
        |FINSI;
        |SI #1#7 = "-"; cantidad = -#2#8; |FINSI;
   |FINSI;
   |HAZ extenso2;
|FPRC;

|DEFBUCLE liapun6;
 #2#2;
 ;
 empresa, anyo, cuentad;
 empresa, anyo, cuentah;
 e;
NULL, pasaext;
|FIN;

|PROCESO bulinext;
 |HAZ montacuen;
 |BUCLE liapun6;        || Lee las lineas apuntes para el abreviado
                        || para manual
|FPRC;

|DEFBUCLE planexten;
 #1#1;
 3;
 #0#0, 001, 001;
 #0#0, 999, 999;
 e;
 NULL, bulinext;
|FIN;

|| **************************************************************************
||                        Recalculo
|| **************************************************************************

|PROCESO totales;

|| Calcula el Activo
 |SI tipo = "E";

    #3#135 = 0;
    |PARA x =136; |SI x [ 141; |HACIENDO x = x + 1;
          #3#135 = #3#135 + #3x;
    |SIGUE;
    #3#135 = #3#135 + #3#218;

    #3#142 = #3#143 + #3#144 + #3#145;
    #3#146 = #3#147 + #3#148;

    #3#149 = 0;
    |PARA x = 150; |SI x [ 154; |HACIENDO x = x + 1;
          #3#149 = #3#149 + #3x;
    |SIGUE;
    #3#149 = #3#149 + #3#219;

    #3#155 = 0;
    |PARA x = 156; |SI x [ 160; |HACIENDO x = x + 1;
          #3#155 = #3#155 + #3x;
    |SIGUE;
    #3#155 = #3#155 + #3#220;

    #3#167 = #3#222+ #3#223;
    #3#168 = #3#224+ #3#225;
    #3#164 = 0;
    |PARA x = 164; |SI x [ 170; |HACIENDO x = x + 1;
          #3#164 = #3#164 + #3x;
    |SIGUE;

    #3#172 = #3#226+ #3#227;
    #3#171 = 0;
    |PARA x = 172; |SI x [ 178; |HACIENDO x = x + 1;
          #3#171 = #3#171 + #3x;
    |SIGUE;

    #3#179 = 0;
    |PARA x = 180; |SI x [ 184; |HACIENDO x = x + 1;
          #3#179 = #3#179 + #3x;
    |SIGUE;
    #3#179 = #3#179 + #3#195;

    #3#185 = 0;
    |PARA x = 186; |SI x [ 190; |HACIENDO x = x + 1;
          #3#185 = #3#185 + #3x;
    |SIGUE;
    #3#185 = #3#185 + #3#196;

    #3#192 = #3#193 + #3#194;
|SINO;
    #3#172 = #3#226 + #3#227;
    #3#171 = #3#172 + #3#174 + #3#178;
|FINSI;

    #3#134 = #3#135 + #3#142 + #3#146 + #3#149 + #3#155 + #3#161 + #3#221;
    #3#162 = #3#163 + #3#164 + #3#171 + #3#179 + #3#185 + #3#191 + #3#192;
    #3#197 = #3#134 + #3#162;

|| Calcula el Pasivo
 #4#172 = #4#199 + #4#200;
 |SI tipo = "E";
     #4#130 = #4#131 + #4#132;
     #4#134 = #4#135 + #4#136;
     #4#141 = #4#142 + #4#143 + #4#144 + #4#195 + #4#196;
     #4#147 = #4#148 + #4#149 + #4#150 + #4#151;
     #4#152 = #4#153 + #4#154 + #4#155 + #4#156 + #4#157;
     #4#164 = #4#165 + #4#166 + #4#167 + #4#168 + #4#169;
     #4#171 = #4#172 + #4#173 + #4#174 + #4#175 + #4#176 + #4#177 + #4#178;

 |SINO;
     #4#152 = #4#154 + #4#155 + #4#157;
     #4#164 = #4#166 + #4#167 + #4#169;
     #4#171 = #4#172 + #4#174;
 |FINSI;

 #4#126 = #4#127 + #4#128;
 #4#125 = #4#126 + #4#129 + #4#130 + #4#133 + #4#134 + #4#137 + #4#138 + #4#139+ #4#140;
 #4#124 = #4#125 + #4#141 + #4#145;
 #4#146 = #4#147 + #4#152 + #4#158 + #4#159 + #4#160 + #4#197 + #4#198;
 #4#161 = #4#162 + #4#163 + #4#164 + #4#170 + #4#171 + #4#179 + #4#180;
 #4#182 = #4#124 + #4#146 + #4#161;

|| Calcula la cuenta de resultados
    #5#116 = 0;
    |SI tipo = "E";
        #5#117 = #5#118 + #5#119;
        #5#122 = #5#123 + #5#124 + #5#125 + #5#126;
        #5#127 = #5#128 + #5#129;
        #5#130 = #5#131 + #5#132 + #5#133;
        #5#134 = #5#135 + #5#136 + #5#137 + #5#138;
        #5#142 = #5#143 + #5#144;

        #5#147 = #5#148 + #5#149;
        #5#150 = #5#151 + #5#152;
        #5#146 = #5#147 + #5#150;

        #5#153 = #5#154 + #5#155 + #5#156;

        #5#157 = #5#158 + #5#159;

        #5#161 = #5#162 + #5#163;
    |FINSI;

    #5#145 = #5#117 + #5#120 + #5#121 + #5#122 + #5#127 + #5#130 + #5#134 + #5#139 + #5#140 + #5#141 + #5#142 + #5#175 + #5#176; ||A1
    #5#164 = #5#146 + #5#153 + #5#157 + #5#160 + #5#161;   ||A2-B

    #5#165 = #5#145 + #5#164;  ||A3 - C

    |SI tipo = "E";
        #5#167 = #5#165 + #5#166;  ||A4
        #5#168 = #5#169;           ||B
    |FINSI;
    #5#170 = #5#165 + #5#166;

|FPRC;

|| ********************************************************************
|| -------------------------- Pasar Actual a Anterior y borrar actual.
|PROCESO borra;
 |SI FEstado3 = 0;
     |PARA x = 6; |SI x [ 69; |HACIENDO x = x + 1;
           y = x + 64;
           |SI fecact > 0; #3x = #3y; |FINSI;
           #3y = 0;
     |SIGUE;

     |PARA x = 198; |SI x [ 207; |HACIENDO x = x + 1;
           y = x + 10;
           |SI fecact > 0; #3x = #3y; |FINSI;
           #3y = 0;
     |SIGUE;
 |FINSI;

 |SI FEstado4 = 0;
     |PARA x = 6; |SI x [ 64; |HACIENDO x = x + 1;
           y = x + 59;
           |SI fecact > 0; #4x = #4y; |FINSI;
           #4y = 0;
     |SIGUE;
     |PARA x = 183; |SI x [ 188; |HACIENDO x = x + 1;
           y = x + 6;
           |SI fecact > 0; #4x = #4y; |FINSI;
           #4y = 0;
     |SIGUE;
 |FINSI;

 |SI FEstado5 = 0;
     |PARA x = 6; |SI x [ 60; |HACIENDO x = x + 1;
           y = x + 55;
           |SI fecact > 0; #5x = #5y; |FINSI;
           #5y = 0;
     |SIGUE;
     |SI fecact > 0; #5#171 = #5#173; #5#172 = #5#174; |FINSI;
     #5#173 = 0; #5#174 = 0;
 |FINSI;

 |SI FEstado6 = 0;
 |FINSI;
|FPRC;
|| ********************************************************************
|| -------------------------- Igual Actual a la Contabilidad.
|PROCESO igual;
     |PARA x = 70; |SI x [ 133; |HACIENDO x = x + 1;
           y = x + 64;
           #3x = #3y;
     |SIGUE;
     |PARA x = 208; |SI x [ 217; |HACIENDO x = x + 1;
           y = x + 10;
           #3x = #3y;
     |SIGUE;

     |PARA x = 65; |SI x [ 123; |HACIENDO x = x + 1;
           y = x + 59;
           #4x = #4y;
     |SIGUE;
     |PARA x = 189; |SI x [ 194; |HACIENDO x = x + 1;
           y = x + 6;
           #4x = #4y;
     |SIGUE;

     |PARA x = 61; |SI x [ 115; |HACIENDO x = x + 1;
           y = x + 55;
           #5x = #5y;
     |SIGUE;
     #5#173 = #5#175; #5#174 = #5#176;
|FPRC;

|| ********************************************************************
|PROCESO montacuen;
vari   = #1#2;
|QBF vari;
aste   = vari % -101;
long   = vari % 0;
longi  = long - 1;
longi  = 100 + longi;
numero = vari % longi;
|SI aste = "*";
    cuentad = numero + "            ";
    cuentad = cuentad % 112;
    cuentah = numero + "zzzzzzzzzzzz";
    cuentah = cuentah % 112;
|SINO;
    cuentad = #1#2;
    cuentah = #1#2;
|FINSI;
|FPRC;

|PROCESO pase;

 fecact = fec_act;
 fecant = fec_ant;
 feccon = fec_con;

|| --------------------------------------------------------------------------------------
|ABRE #3;
|ABRE #4;
|ABRE #5;
|ABRE #6;

|DDEFECTO #3; |DDEFECTO #4; |DDEFECTO #5; |DDEFECTO #6;

|LIBERA #3; #3#0 = empresa; #3#1 = anyo; #3#2 = registr; |LEE 110#3=; FEstado3 = FSalida;
|LIBERA #4; #4#0 = empresa; #4#1 = anyo; #4#2 = registr; |LEE 110#4=; FEstado4 = FSalida;
|LIBERA #5; #5#0 = empresa; #5#1 = anyo; #5#2 = registr; |LEE 110#5=; FEstado5 = FSalida;
|LIBERA #6; #6#0 = empresa; #6#1 = anyo; #6#2 = registr; |LEE 110#6=; FEstado6 = FSalida;


|SI act_ant_con ! "D"; |HAZ borra; |FINSI;

#3#0 = empresa; #3#1 = anyo; #3#2 = registr; #3#5 = tipo;
#4#0 = empresa; #4#1 = anyo; #4#2 = registr; #4#5 = tipo;
#5#0 = empresa; #5#1 = anyo; #5#2 = registr; #5#5 = tipo;
#6#0 = empresa; #6#1 = anyo; #6#2 = registr; #6#5 = tipo;

|PDEFECTO #3,134,198; |PDEFECTO #3,218,228;
|PDEFECTO #4,124,183; |PDEFECTO #4,195,201;
|PDEFECTO #5,116,171; #5#175 = 0; #5#176 = 0;

|SI tipo = "A"; |BUCLE planabre;  |FINSI;  || Lee lineas planillas - abreviado
|SI tipo = "E"; |BUCLE planexten; |FINSI;  || Lee lineas planillas - extenso

|HAZ totales;

|SI act_ant_con = "S"; |HAZ igual; |FINSI;

|SI FEstado3 = 0; |GRABA 020#3a; |SINO; |GRABA 020#3n; |FINSI;
|SI FEstado4 = 0; |GRABA 020#4a; |SINO; |GRABA 020#4n; |FINSI;
|SI FEstado5 = 0; |GRABA 020#5a; |SINO; |GRABA 020#5n; |FINSI;
|SI FEstado6 = 0; |GRABA 020#6a; |SINO; |GRABA 020#6n; |FINSI;
|LIBERA #3;
|LIBERA #4;
|LIBERA #5;
|LIBERA #6;


|CIERRA #3;
|CIERRA #4;
|CIERRA #5;
|CIERRA #6;

|| --------------------------------------------------------------------------

|| Actualizar Acceso.
   |SI act_ant_con ! "D";
       |SI fecact > 0; fec_ant = fec_act; |FINSI;
        fec_act = "00.00.0000";
   |FINSI;

 |ABRE #7;               || Acceso
 #7#0 = empresa;
 #7#1 = anyo;
 #7#2 = registr;
 |LEE 040#7=;
 FEstado7 = FSalida;

 #7#0 = empresa;
 #7#1 = anyo;
 #7#2 = registr;
 #7#3 = descrip;
 #7#4 = fec_con;
 #7#5 = fec_ant;
 #7#6 = fec_act;
 #7#7 = tipo;
 #7#8 = fz;
 #7#9 = periodo;
 #7#10= nombre;

 |SI FEstado7 = 0; |GRABA 020#7a; |SINO; |GRABA 020#7n; |FINSI;
 |LIBERA #7;
 |CIERRA #7;
|FPRC;

|PROCESO LosPatrones;
 nActual = 0;
 |ABRE #1;
 #1#0 = 1;
 #1#1 = 503;
 |LEE 041#1];
 |SI FSalida ! 0; |O #1#0 ! 1;
     nActual = 1;
 |SINO;
     |SELECT #3#1;
     #1#0 = 1;
     #1#2 = "551*        ";
     |LEE 041#1=;
     |SI FSalida ! 0; |O #1#10 = " ";
         nActual = 1;
     |FINSI;
     |SELECT #1#1;
 |FINSI;
 |CIERRA #1;

 enPlan = 2008;
 |SI nActual ! 0;
     eaPrograma  = "va8planc";
     eaExtension = "nex";
     |SUB_EJECUTA_NP ":basica/dspatron";

     eaPrograma  = "va8planl";
     eaExtension = "nex";
     |SUB_EJECUTA_NP ":basica/dspatron";
 |FINSI;
|FPRC;
