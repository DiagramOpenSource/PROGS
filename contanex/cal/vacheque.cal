|FICHEROS;
    vacheque #0;
    vadacoli #1;
    vaplanli #2;
    vaplanca #3;
    va8planl #12;
    va8planc #13;
|FIN;

|VARIABLES;
   fecha = @;
   que_anyo = "";

   cuentad  = "";
   cuentah  = "";
   vari     = "";
   aste     = "";
   long     = "";
   numero   = "";
   longi    = 0;
   sw_print = 0;
   sw_pie   = 0;
   swAbr    = 0;
   swExt    = 0;
   &estruct = 0;
   &text    = "";
   nInkey   = "";
|FIN;

|INCLUYE dscnex_v;

|PROCESO que_anyo; |TIPO 7;
  fecha    = ~;
  que_anyo = fecha % -104;
  #0#2     = que_anyo;
  #0#2     = #0#2 - 1;
  |PINTA #0#2;
|FPRC;

|PROCESO anyo; |TIPO 0;
  enPlan = 2008;
  |C_M #0#5,1,"S";
  |SI #0#2 < 2008;
      enPlan = 1990;
      |C_M #0#5,1,"N";
      #0#5 = 2; |PINTA #0#5;
  |FINSI;
|FPRC;

|PROCESO inf2;
 #2#0 = 1;
|FPRC;

|PROCESO sup2;
 #2#0 = 99;
|FPRC;

|PROCESO inf12;
 #12#0 = 1;
|FPRC;

|PROCESO sup12;
 #12#0 = 99;
|FPRC;

|PROCESO LeoPlan; |TIPO 0;
    nInkey = FSalida;

    |SI #0#5 = 2;
        |SI nInkey = 10;
            |ABRE #2;
            #2#0 = #0#3;
            |CONSULTA_F_CLAVE #1#2, inf2, sup2;
            #0#3 = #2#0;
            |CIERRA #2;
        |FINSI;
        |ABRE #2;
        #2#0 = #0#3;
        |LEE 040#2=;
        |SI FSalida ! 0;
            |MENAV "      No existe estructura de Balance";
            |ERROR;
        |SINO;
            #0#4 = #2#1;
            |PINTA #0#4;
        |FINSI;
        |CIERRA #2;
     |SINO;
        |SI nInkey = 10;
            |ABRE #12;
            #12#0 = #0#3;
            |CONSULTA_F_CLAVE #1#12, inf12, sup12;
            #0#3 = #12#0;
            |CIERRA #12;
        |FINSI;
        |ABRE #12;
        #12#0 = #0#3;
        |LEE 040#12=;
        |SI FSalida ! 0;
            |MENAV "      No existe estructura de Balance 2008";
            |ERROR;
        |SINO;
            #0#3 = #12#1;
            |PINTA #0#3;
        |FINSI;
        |CIERRA #12;
    |FINSI;
|FPRC;
|| ***********************************************************

|PROCESO al_rollo;
vari   = #2#2;
|QBF vari;
aste   = vari % -101;
long   = vari % 0;
longi  = long - 1;
longi  = 100 + longi;
numero = vari % longi;
|SI aste = "*";
    cuentad = numero + "            ";
    cuentad = cuentad % 112;
    cuentah = numero + "zzzzzzzzzzzz";
    cuentah = cuentah % 112;
|SINO;
    cuentad = #2#2;
    cuentah = #2#2;
|FINSI;

|SI #1#3 ] cuentad; |Y #1#3 [ cuentah;
    |SI #2#5 ! 0; swExt = 1; |FINSI;
    |SI #2#6 ! 0; swAbr = 1; |FINSI;
    |SI swExt = 1; |Y swAbr = 1;
        sw_print = 0;
        |ERROR10;
    |FINSI;
|FINSI;
|FPRC;

|DEFBUCLE vaplanli;
 #2#1;
 ;
 estruct, 000;
 estruct, 999;
 e;
 NULL, al_rollo;
|FIN;


|PROCESO al_rollo_8;
 vari   = #12#2;
 |QBF vari;
 aste   = vari % -101;
 long   = vari % 0;
 longi  = long - 1;
 longi  = 100 + longi;
 numero = vari % longi;
 |SI aste = "*";
     cuentad = numero + "            ";
     cuentad = cuentad % 112;
     cuentah = numero + "zzzzzzzzzzzz";
     cuentah = cuentah % 112;
 |SINO;
     cuentad = #12#2;
     cuentah = #12#2;
 |FINSI;

 |SI #1#3 ] cuentad; |Y #1#3 [ cuentah;
     |SI #12#5 ! 0; swExt = 1; |FINSI;
     |SI #12#6 ! 0; swAbr = 1; |FINSI;
     |SI swExt = 1; |Y swAbr = 1;
         sw_print = 0;
         |ERROR10;
     |FINSI;
 |FINSI;
|FPRC;

|DEFBUCLE va8planl;
 #12#1;
 ;
 estruct, 000;
 estruct, 999;
 e;
 NULL, al_rollo_8;
|FIN;

|PROCESO chequear;
 || |PINTA 1960, "                   ";

 |PINTA 1960, #1#0;
 |PINTA 1966, #1#3;

 swAbr = 0; || Comprobar en Abreviado
 swExt = 0; || Comprobar en Extenso

 sw_print = 1; estruct = #0#3;
 |SI #0#5 = 1; |BUCLE va8planl; |FINSI;
 |SI #0#5 = 2; |BUCLE vaplanli; |FINSI;

 |SI sw_print = 1;
     text = "LOS BALANCES     ";
     |SI swAbr = 1; text = "EL BALANCE EXTENSO  "; |FINSI;
     |SI swExt = 1; text = "EL BALANCE ABREVIADO"; |FINSI;

     |PRINT;
     sw_pie = 1;
 |FINSI;
|FPRC;

|DEFBUCLE vadacoli;
 #1#1;
 ;
 #0#0, #0#2, 0000;
 #0#1, #0#2, 9999;
 e;
 NULL, chequear;
|FIN;

|PROCESO tipo_3; |TIPO 3;
 |IMPRE 0;
 |SI FSalida ! 0; |ACABA; |FINSI;

 |INFOR "vacheque";
 |SI FSalida ! 0; |FININF; |ACABA; |FINSI;

 |BUCLE vadacoli;
 |SI sw_pie = 1; |PIEINF; |FINSI;

 |FININF;
 |FINIMP;
|FPRC;
