|FICHEROS;
     gecom001;
     gecom002;
     gecom003;
     gecom004;
     gecom005;
     gecom006;
     gecom007;
     gecom008;
     gecom009;
     gecom010;
     gecom011;
     gecom012;
     gecom013;
     gecom059;
     gecom064;
     gecom065;

     gecow009;

     gecom500;
     gecom501;
|FIN;

|VARIABLES;
     n1Vent              = 0;
     nHandle             = 0;
     nLin                = 0;
     nLin1               = 0;
     nLin2               = 0;
     nLin3               = 0;
     nLin4               = 0;
     nLin5               = 0;
     nLin6               = 0;
     nCmp                = 0;
     nCmp1               = 0;
     nCmp2               = 0;
     nCmp3               = 0;
     nCmp4               = 0;
     nCmp5               = 0;
     nOk                 = 0;
     nOk1                = 0;
     nOk2                = 0;
     nHast               = 0;
     nBases              = 0;
     nLong               = 0;
     nCarac              = 0;
     nPos                = 0;
     nActiv              = 0;
     nReg                = 0;
     nRegs               = 0;
     nTDesFac            = 0;
     nTDesFacSuj         = 0;
     nTDesFacSujEx       = 0;
     nTDesFacSujNEx      = 0;
     nTDesFacNSuj        = 0;
     nTDesTOpPrs         = 0;
     nTDesTOpPrsSuj      = 0;
     nTDesTOpPrsSujEx    = 0;
     nTDesTOpPrsSujNEx   = 0;
     nTDesTOpPrsNSuj     = 0;
     nTDesTOpEnt         = 0;
     nTDesTOpEntSuj      = 0;
     nTDesTOpEntSujEx    = 0;
     nTDesTOpEntSujNEx   = 0;
     nTDesTOpEntNSuj     = 0;
     nEsOtro             = 0;
     nUno                = 0;
     nPasada             = 0;
     nNumReg             = 0;
     nVeces              = 0;
     nTope               = 0;
     nFiche              = 0;
     nDReg               = 0;
     nUltReg             = 0;
     nGrab               = 0;
     nPausa              = 0;
     nNume               = 0;
     nConsola            = 0;
     nLon                = 0;
     nCar                = 0;
     nPun                = 0;
     nDecimal            = 0;

     aNIF                = "";
     aIdRes              = "";
     aIdent              = "";
     aFecEm              = "";
     aEstad              = "";
     aCodEr              = "";
     aDesEr              = "";
     aIdCSV              = "";
     aFEnvi              = "";
     aHEnvi              = "";
     aExt                = "";
     aLinea              = "";
     aModoImp            = "";
     aTDes               = "";
     aNDes               = "";
     aTDes1              = "";
     aTDes2              = "";
     aTDes3              = "";
     aTDes4              = "";
     aTDes5              = "";
     aTDes6              = "";
     aNDes1              = "";
     aNDes2              = "";
     aNDes3              = "";
     aNDes4              = "";
     aNDes5              = "";
     aNDes6              = "";
     aTip1               = "";
     aTip2               = "";
     aTipNiv             = "";
     aDesgl              = "";
     aCar                = "";
     aIP                 = "";
     aFicLCK             = "";
     aProg               = "";
     aFic                = "";
     aTipo               = "";
     aEti1               = "";
     aEti2               = "";
     aCont               = "";
     aFicB64             = "";
     aTab                = "";

     aAlfa               = "";
     aAlfa1              = "";
     aAlfa2              = "";
     aAlfa3              = "";
     aAlfa4              = "";
     aAlfa5              = "";
     aAlfa6              = "";
     aLee                = "";
     aBaseGECO           = "";
     aFicRes             = "";
     aPathTmp            = "";
     aPathTmpLocal       = "";
     aPathPlu            = "";
     aPathEnv            = "";
     aAbreXml            = "";
     aHora               = "";
     aContenido          = "";
     aApli               = "";
     aH60                = "";
     aFec                = "";
     aClv                = "";
     aClvPpl             = "";
     aClvN1              = "";
     aClvN2              = "";
     aClvN3              = "";
     aClvN4              = "";
     aClvN5              = "";
     aTipoCmp            = "";
     aQQ                 = "";
     aDEtiq              = "";
     aHEtiq              = "";
     aDEti               = "";
     aHEti               = "";
     aAgru               = "";
     aAgruClv            = "";
     aOri                = "";
     aDes                = "";
     aVer1               = "";
     aVer2               = "";
     aEnlace             = "";
     aAbre               = "";
     aCaracter           = "";
     aError              = "";
     aLong               = "";
     aCadena             = "";
     aFicTmp             = "";
     aEsq                = "";
     aBase               = "";
     aCarro              = "";
     aLon                = "";
     aCad1               = "";
     aCad2               = "";

     fFecha              = @;
     fFechaSys           = @;

     {1}aMd5             = "";

     {-1}aVent           = "";
         aVent1          = 0;
         aVent2          = 0;
         aVent3          = 0;
         aVent4          = 0;
         aVent5          = "";

     &enEmp              = 0;
     &eaIde              = "";
     &eaAlfa             = "";
     &eaUnidadBasico     = "";
     &eaPathAdj          = "";
     &eaPathPlu          = "";
     &eaFicXml           = "";
|FIN;

|PROCESO PonDsabreextension;
     aVer1 = "";
     aVer2 = "";
     aMd5  = aPathPlu + "dsabreextension.exe";
     |ESPECIFICA "MD5", aMd5;
     aVer1 = FSalida;

     aMd5 = aPathTmpLocal + "dsabreextension.exe";
     |ESPECIFICA "REMOTOMD5", aMd5;
     aVer2 = FSalida;

     |SI aVer1 ! aVer2;
         aOri = aPathPlu + "dsabreextension.exe";
         aDes = aPathTmpLocal + "dsabreextension.exe";

         |SI aIP = "";
             |COPIA_FICHERO aOri, aDes;
         |SINO;
             |ENVIA_FICHERO aOri, aDes;
         |FINSI;

         |XABRE "EC", aDes, 0;
         |SI FSalida < 0;
             |MENAV "0000No encuentro el programa para abrir documentos, por favor consulte con su administrador informatico.";
             |ACABA;
         |FINSI;
     |FINSI;

     nOk = 1;
|FPRC;

|PROCESO VerDoc;
     nOk = 0;
     |HAZ PonDsabreextension;
     |SI nOk = 0;  |ACABA;  |FINSI;

     aOri  = aPathTmp + eaFicXml;
     aDes  = aPathTmpLocal + eaFicXml;
     |SI aIP = "";
         |COPIA_FICHERO aOri, aDes;
     |SINO;
         |ENVIA_FICHERO aOri, aDes;
     |FINSI;

     aFicLCK = aPathTmpLocal + Usuario + ".txt";
     aProg   = aPathTmpLocal + "dsabreextension.exe";

     aAlfa  = "START " + aProg + " " + aDes + " " + aFicLCK;
     |RSYSTEM aAlfa;

     |PARA;  |SI;  |HACIENDO;
          |PARA nPausa = 1; |SI nPausa [ 10000; |HACIENDO nPausa = nPausa + 1;
          |SIGUE;

          |XABRE "EC", aFicLCK, nHandle;
          |SI FSalida ] 0;
              |SAL;
          |FINSI;

          |PULSATECLA;
     |SIGUE;

     |RFBORRA aFicLCK;
     ||RFBORRA aDes;
|FPRC;

|PROCESO AbreVtn;
     |SI nConsola = 0;  |ACABA;  |FINSI;

     |VENTANA 0501, 0540, -1, 16, "Fabricando la XML";
     n1Vent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PTEC 802;  |PAUSA;
|FPRC;

|PROCESO CierraVtn;
     |SI nConsola = 0;  |ACABA;  |FINSI;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA n1Vent;
|FPRC;

|PROCESO GrabaFicEspa;
                            aAlfa1 = "";
     |SI #gecom501#1  ! 0;  aAlfa1 = aAlfa1 + aTab;  |FINSI;
     |SI #gecom501#2  ! 0;  aAlfa1 = aAlfa1 + aTab;  |FINSI;
     |SI #gecom501#3  ! 0;  aAlfa1 = aAlfa1 + aTab;  |FINSI;
     |SI #gecom501#4  ! 0;  aAlfa1 = aAlfa1 + aTab;  |FINSI;
     |SI #gecom501#5  ! 0;  aAlfa1 = aAlfa1 + aTab;  |FINSI;
     |SI #gecom501#6  ! 0;  aAlfa1 = aAlfa1 + aTab;  |FINSI;
     |SI #gecom501#7  ! 0;  aAlfa1 = aAlfa1 + aTab;  |FINSI;
     |SI #gecom501#8  ! 0;  aAlfa1 = aAlfa1 + aTab;  |FINSI;
     |SI #gecom501#9  ! 0;  aAlfa1 = aAlfa1 + aTab;  |FINSI;
     |SI #gecom501#10 ! 0;  aAlfa1 = aAlfa1 + aTab;  |FINSI;

     aAlfa2 = #gecom501#12 % 201;
     |SI aAlfa2 = "/";
         aAlfa1 = aAlfa1 - aTab;
     |FINSI;

     aAlfa = aAlfa1 + aEti1;  |XGRABA nHandle, aAlfa;
     aAlfa = aCont;           |XGRABA nHandle, aAlfa;
     aAlfa = aEti2;           |XGRABA nHandle, aAlfa;
     aAlfa = aCarro;          |XGRABA nHandle, aAlfa;
|FPRC;

|PROCESO GrabaFicSin;
     |XGRABA nHandle, aAlfa;
|FPRC;

|PROCESO GrabaFic;
     aAlfa = aAlfa + aCarro;
     |XGRABA nHandle, aAlfa;
|FPRC;

|PROCESO ConverFec;
     aFec = (aFec % 704) + "-" + (aFec % 402) + "-" + (aFec % 102);
|FPRC;

|PROCESO PonDecimales;
     nNume = aContenido;
     aAlfa = nNume;
     aLon  = aAlfa % 0;
     nLon  = aLon;
     aCad1 = "";
     aCad2 = "";
     nPun  = 0;
     |PARA nCar = 1;  |SI nCar [ nLon;  |HACIENDO nCar = nCar + 1;
           nPos = (nCar * 100) + 1;
           aCar = aAlfa % nPos;

           |SI aCar = ".";
               nPun = 1;
               aCar = "";
           |FINSI;

           |SI nPun = 0;
               aCad1 = aCad1 + aCar;
           |SINO;
               aCad2 = aCad2 + aCar;
           |FINSI;

     |SIGUE;

     nPos  = 100 + nDecimal;
     aCad2 = (aCad2 + ("0" * nDecimal)) % nPos;

     aContenido = aCad1 + "." + aCad2;
|FPRC;

|PROCESO CargaContenido;
     aAlfa = #gecom501#14;  |QBF aAlfa;
     |SI aAlfa = "";  |O #gecom501#20 = "S";
         eaAlfa = aContenido;
         |HAZ QuitaRaros;
         aContenido = eaAlfa;
         |QBF aContenido;
         |ACABA;
     |FINSI;

     aApli    = #gecom501#14 % 208;
     aAlfa    = #gecom501#14 % 1103;
     nCmp     = aAlfa;
     aTipoCmp = #gecom501#18;
     nDecimal = #gecom501#19;

     aContenido = "";

     |SI aApli = "gecom001";
         aContenido = #gecom001#nCmp#;
     |FINSI;

     |SI aApli = "gecom002";
         aContenido = #gecom002#nCmp#;
     |FINSI;

     |SI aApli = "gecom003";
         aContenido = #gecom003#nCmp#;
     |FINSI;

     |SI aApli = "gecom004";
         aContenido = #gecom004#nCmp#;
     |FINSI;

     |SI aApli = "gecom005";
         aContenido = #gecom005#nCmp#;
     |FINSI;

     |SI aApli = "gecom006";
         aContenido = #gecom006#nCmp#;
     |FINSI;

     |SI aApli = "gecom007";
         aContenido = #gecom007#nCmp#;
     |FINSI;

     |SI aApli = "gecom008";
         aContenido = #gecom008#nCmp#;
     |FINSI;

     |SI aApli = "gecom009";
         aContenido = #gecom009#nCmp#;
     |FINSI;

     |SI aApli = "gecom010";
         aContenido = #gecom010#nCmp#;
     |FINSI;

     |SI aApli = "gecom011";
         aContenido = #gecom011#nCmp#;
     |FINSI;

     |SI aApli = "gecom012";
         aContenido = #gecom012#nCmp#;
     |FINSI;

     |SI aApli = "gecom013";
         aContenido = #gecom013#nCmp#;
     |FINSI;

     |SI aApli = "gecow009";
         aContenido = #gecow009#nCmp#;
     |FINSI;

     |QBF aContenido;

     |SI aTipoCmp = "F";
         fFecha = aContenido;
         |SI fFecha < "01.01.2000";
             aContenido = "";
             |ACABA;
         |FINSI;

         aFec = aContenido;
         |HAZ ConverFec;
         aContenido = aFec;
     |FINSI;

     |SI aTipoCmp = "A";
         eaAlfa = aContenido;
         |HAZ QuitaRaros;
         aContenido = eaAlfa;
     |FINSI;

     |SI aTipoCmp = "N";
         |SI aContenido ! "0";
             |HAZ PonDecimales;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO MiraContenido;
     |SI nOk = 1;  |ACABA;  |FINSI;

     |QBF aAlfa;

     |SI aAlfa ! "";  nOk = 1;  |FINSI;
|FPRC;

|PROCESO gecom501;
     |SI #gecom501#11 = "1";
         aEti1 = #gecom501#12;  |QBF aEti1;
         aEti2 = "";
         aCont = "";
         |HAZ GrabaFicEspa;
     |FINSI;

     |SI #gecom501#11 = "2";
         |SI #gecom501#16 ! "3";
             |HAZ CargaContenido;
         |FINSI;

         |SI #gecom501#16 = "2";
             |SI aTipoCmp = "N";
                 |SI aContenido = "0";
                     aContenido = "";
                 |FINSI;
             |FINSI;
         |FINSI;

         |SI #gecom501#16 = "3";
             |SI aContenido ! "";
                 eaAlfa = aContenido;
                 |HAZ QuitaRaros;
                 aContenido = eaAlfa;
             |FINSI;
         |FINSI;

         |SI aContenido = "";  |Y #gecom501#16 ! "1";
             |ACABA;
         |FINSI;

         |QBF aContenido;

         aEti1 = #gecom501#12;          |QBF aEti1;
         aEti2 = #gecom501#13;          |QBF aEti2;
         aCont = aContenido;

         |HAZ GrabaFicEspa;
     |FINSI;

     aAlfa      = #gecom501#17;
     aContenido = "";
|FPRC;

|DEFBUCLE gecom501;
     #gecom501#3;
     ;
     #gecom002#6, aDEti;
     #gecom002#6, aHEti;
     ;
     NULL, gecom501;
|FIN;

|PROCESO LeeClave;
     |SELECT #3#gecom501;

     #gecom501#0  = #gecom002#6;
     #gecom501#17 = aClv;
     |LEE 000#gecom501.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     aDEti   = #gecom501#17;
     aHEti   = #gecom501#17;
     aClvPpl = #gecom501#17;  |QBF aClvPpl;

     |BUCLE gecom501;

     aContenido = "";
|FPRC;

|PROCESO GrabaComentario;
     |SELECT #3#gecom501;

     #gecom501#0  = #gecom002#6;
     #gecom501#17 = aClv;
     |LEE 000#gecom501.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     aEti1 = #gecom501#12;  |QBF aEti1;
     aEti2 = #gecom501#13;  |QBF aEti2;

                            aAlfa1 = "";
     |SI #gecom501#1  ! 0;  aAlfa1 = aAlfa1 + aTab;  |FINSI;
     |SI #gecom501#2  ! 0;  aAlfa1 = aAlfa1 + aTab;  |FINSI;
     |SI #gecom501#3  ! 0;  aAlfa1 = aAlfa1 + aTab;  |FINSI;
     |SI #gecom501#4  ! 0;  aAlfa1 = aAlfa1 + aTab;  |FINSI;
     |SI #gecom501#5  ! 0;  aAlfa1 = aAlfa1 + aTab;  |FINSI;
     |SI #gecom501#6  ! 0;  aAlfa1 = aAlfa1 + aTab;  |FINSI;
     |SI #gecom501#7  ! 0;  aAlfa1 = aAlfa1 + aTab;  |FINSI;
     |SI #gecom501#8  ! 0;  aAlfa1 = aAlfa1 + aTab;  |FINSI;
     |SI #gecom501#9  ! 0;  aAlfa1 = aAlfa1 + aTab;  |FINSI;
     |SI #gecom501#10 ! 0;  aAlfa1 = aAlfa1 + aTab;  |FINSI;

     aAlfa2 = #gecom501#12 % 201;
     |SI aAlfa2 = "/";
         aAlfa1 = aAlfa1 - aTab;
     |FINSI;

     aAlfa = aAlfa1 + aEti1;  |XGRABA nHandle, aAlfa;

     nHast = 0;
     |PARA nCmp = 122;  |SI nCmp ] 113;  |HACIENDO nCmp = nCmp - 1;
           aAlfa = #gecom003#nCmp#;  |QBF aAlfa;
           |SI aAlfa ! "";
               nHast = nCmp;
               |SAL;
           |FINSI;
     |SIGUE;

     |PARA nCmp = 113;  |SI nCmp [ nHast;  |HACIENDO nCmp = nCmp + 1;
           eaAlfa = #gecom003#nCmp#;
           |HAZ QuitaRaros;
           |XGRABA nHandle, eaAlfa;
     |SIGUE;

     aAlfa = aEti2;           |XGRABA nHandle, aAlfa;
     aAlfa = aCarro;          |XGRABA nHandle, aAlfa;

     aContenido = "";
|FPRC;

|PROCESO ItemDescription;
     |SELECT #3#gecom501;

     #gecom501#0  = #gecom002#6;
     #gecom501#17 = aClv;
     |LEE 000#gecom501.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     aEti1 = #gecom501#12;  |QBF aEti1;
     aEti2 = #gecom501#13;  |QBF aEti2;

                            aAlfa1 = "";
     |SI #gecom501#1  ! 0;  aAlfa1 = aAlfa1 + aTab;  |FINSI;
     |SI #gecom501#2  ! 0;  aAlfa1 = aAlfa1 + aTab;  |FINSI;
     |SI #gecom501#3  ! 0;  aAlfa1 = aAlfa1 + aTab;  |FINSI;
     |SI #gecom501#4  ! 0;  aAlfa1 = aAlfa1 + aTab;  |FINSI;
     |SI #gecom501#5  ! 0;  aAlfa1 = aAlfa1 + aTab;  |FINSI;
     |SI #gecom501#6  ! 0;  aAlfa1 = aAlfa1 + aTab;  |FINSI;
     |SI #gecom501#7  ! 0;  aAlfa1 = aAlfa1 + aTab;  |FINSI;
     |SI #gecom501#8  ! 0;  aAlfa1 = aAlfa1 + aTab;  |FINSI;
     |SI #gecom501#9  ! 0;  aAlfa1 = aAlfa1 + aTab;  |FINSI;
     |SI #gecom501#10 ! 0;  aAlfa1 = aAlfa1 + aTab;  |FINSI;

     aAlfa2 = #gecom501#12 % 201;
     |SI aAlfa2 = "/";
         aAlfa1 = aAlfa1 - aTab;
     |FINSI;

     aAlfa = aAlfa1 + aEti1;  |XGRABA nHandle, aAlfa;

     nHast = 0;
     |PARA nCmp = 51;  |SI nCmp ] 43;  |HACIENDO nCmp = nCmp - 1;
           aAlfa = #gecom005#nCmp#;  |QBF aAlfa;
           |SI aAlfa ! "";
               nHast = nCmp;
               |SAL;
           |FINSI;
     |SIGUE;

     eaAlfa = #gecom005#3;
     |HAZ QuitaRaros;
     |XGRABA nHandle, eaAlfa;

     |PARA nCmp = 43;  |SI nCmp [ nHast;  |HACIENDO nCmp = nCmp + 1;
           eaAlfa = #gecom005#nCmp#;
           |HAZ QuitaRaros;
           |XGRABA nHandle, eaAlfa;
     |SIGUE;

     aAlfa = aEti2;           |XGRABA nHandle, aAlfa;
     aAlfa = aCarro;          |XGRABA nHandle, aAlfa;

     aContenido = "";
|FPRC;

|PROCESO LeeEtiqueta;
     |SELECT #2#gecom501;

     #gecom501#0  = #gecom002#6;
     #gecom501#12 = aDEtiq;
     |LEE 000#gecom501.=;

     aDEti   = #gecom501#17;
     aClvPpl = #gecom501#17;  |QBF aClvPpl;

     #gecom501#0  = #gecom002#6;
     #gecom501#12 = aHEtiq;
     |LEE 000#gecom501.=;

     aHEti  = #gecom501#17;

     |BUCLE gecom501;

     aContenido = "";
|FPRC;

|PROCESO Attachment;
     |XABRE "E", aFicB64, 0;
     |SI FSalida < 0;  |ACABA;  |FINSI;

     |SELECT #3#gecom501;

     #gecom501#0  = #gecom002#6;
     #gecom501#17 = aClv;
     |LEE 000#gecom501.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     aCarro = "";

     aEti1 = #gecom501#12;          |QBF aEti1;
     aEti2 = "";
     aCont = "";
     |HAZ GrabaFicEspa;

     |XCIERRA nHandle;

     |AFEGIR_FICHERO aFicB64, aAbreXml;

     |XABRE "AB", aAbreXml, nHandle;

     aEti1 = #gecom501#13;          |QBF aEti1;
     aEti2 = "";
     aCont = "";
     |HAZ GrabaFicEspa;

     aCarro    = &13 + &10;
|FPRC;

|PROCESO CabXml;
     aAlfa = "<?xml version=" + &34 + "1.0" + &34;
     aAlfa = aAlfa + " encoding=" + &34 + "UTF-8" + &34;
     aAlfa = aAlfa + " standalone=" + &34 + "yes" + &34 + "?>";
     |HAZ GrabaFic;

     aAlfa = "<fe:Facturae xmlns:ds=" + &34 + "http://www.w3.org/2000/09/xmldsig#" + &34;
     |HAZ GrabaFicSin;

     aAlfa = " xmlns:fe=" + &34 + "http://www.facturae.gob.es/formato/Versiones/Facturaev3_2_2.xml" + &34;
     |HAZ GrabaFicSin;

     aAlfa = " xmlns:fb2b=" + &34 + "http://www.facturae.es/Facturae/Extensions/FB2B" + &34;
     |HAZ GrabaFicSin;

     aAlfa = " xmlns:xsi=" + &34 + "http://www.w3.org/2001/XMLSchema-instance" + &34 + ">";
     |HAZ GrabaFic;
|FPRC;

|PROCESO Batch;
     aDEtiq = "<Batch>";
     aHEtiq = "<Batch>";
     |HAZ LeeEtiqueta;

     aContenido = #gecom003#11;              |QBF aContenido;
     aContenido = aContenido + #gecom003#1;  |QBF aContenido;
     aClv = "01050100000000000000";   |HAZ LeeClave;  ||<BatchIdentifier>

     aContenido = "1";
     aClv = "01050200000000000000";   |HAZ LeeClave;  ||<InvoicesCount>

     aDEtiq = "<TotalInvoicesAmount>";
     aHEtiq = "</TotalInvoicesAmount>";
     |HAZ LeeEtiqueta;

     aClv = "01050400000000000000";   |HAZ LeeClave;  ||<TotalOutstandingAmount>;
     aClv = "01050401000000000000";   |HAZ LeeClave;  ||<TotalAmount>
     aClv = "01050403000000000000";   |HAZ LeeClave;  ||</TotalOutstandingAmount>;

     aClv = "01050500000000000000";   |HAZ LeeClave;  ||<TotalExecutableAmount>;
     aClv = "01050501000000000000";   |HAZ LeeClave;  ||<TotalAmount>
     aClv = "01050503000000000000";   |HAZ LeeClave;  ||</TotalExecutableAmount>;

     aContenido = "EUR";
     aClv = "01050600000000000000";   |HAZ LeeClave; ||<InvoiceCurrencyCode>

     aDEtiq = "</Batch>";
     aHEtiq = "</Batch>";
     |HAZ LeeEtiqueta;
|FPRC;

|PROCESO FileHeader;
     aDEtiq = "<FileHeader>";
     aHEtiq = "<FileHeader>";
     |HAZ LeeEtiqueta;

     aDEtiq = "<SchemaVersion>";
     aHEtiq = "</SchemaVersion>";
     |HAZ LeeEtiqueta;

     aDEtiq = "<Modality>";
     aHEtiq = "</Modality>";
     aContenido = "I";
     |HAZ LeeEtiqueta;

     aDEtiq = "<InvoiceIssuerType>";
     aHEtiq = "</InvoiceIssuerType>";
     aContenido = "EM";
     |HAZ LeeEtiqueta;

     |HAZ Batch;

     aDEtiq = "</FileHeader>";
     aHEtiq = "</FileHeader>";
     |HAZ LeeEtiqueta;
|FPRC;

|PROCESO Eti_2_1_1;          || Identificacion emisor
     aClv = "02010100000000000000";   |HAZ LeeClave;  ||<TaxIdentification>

     aClv = "02010101000000000000";   |HAZ LeeClave;  ||<PersonTypeCode>
     aClv = "02010102000000000000";   |HAZ LeeClave;  ||<ResidenceTypeCode>

     aContenido = #gecom003#25 % 102;  |QBF aContenido;
     aContenido = aContenido + #gecom003#11;
     aClv = "02010103000000000000";   |HAZ LeeClave;  ||<TaxIdentificationNumber>

     aClv = "02010104000000000000";   |HAZ LeeClave;  ||</TaxIdentification>
|FPRC;

|PROCESO gecom004E;
     aClv = "02010301000000000000";   |HAZ LeeClave;  ||<AdministrativeCentre>
     aClv = "02010301010000000000";   |HAZ LeeClave;  ||<CentreCode>
     aClv = "02010301020000000000";   |HAZ LeeClave;  ||<RoleTypeCode>
     aClv = "02010301030000000000";   |HAZ LeeClave;  ||<Name>
     aClv = "02010301040000000000";   |HAZ LeeClave;  ||<FirstSurname>
     aClv = "02010301050000000000";   |HAZ LeeClave;  ||SecondSurname>

     nOk = 0;
     aAlfa = #gecom004#13;  |HAZ MiraContenido;
     aAlfa = #gecom004#14;  |HAZ MiraContenido;
     aAlfa = #gecom004#15;  |HAZ MiraContenido;
     aAlfa = #gecom004#16;  |HAZ MiraContenido;
     aAlfa = #gecom004#17;  |HAZ MiraContenido;

     |SI nOk = 1;
         |SI #gecom004#17 = "ESP";
             aClv = "02010301060100000000";   |HAZ LeeClave;  ||<AddressInSpain>
             aClv = "02010301060101000000";   |HAZ LeeClave;  ||<Address>
             aClv = "02010301060102000000";   |HAZ LeeClave;  ||<PostCode>
             aClv = "02010301060103000000";   |HAZ LeeClave;  ||<Town>
             aClv = "02010301060104000000";   |HAZ LeeClave;  ||<Province>
             aClv = "02010301060105000000";   |HAZ LeeClave;  ||<CountryCode>
             aClv = "02010301060106000000";   |HAZ LeeClave;  ||</AddressInSpain>
         |FINSI;

         |SI #gecom004#17 ! "ESP";
             aClv = "02010301060200000000";   |HAZ LeeClave;  ||<OverseasAddress>
             aClv = "02010301060201000000";   |HAZ LeeClave;  ||<Address>

             aContenido = #gecom004#14;  |QBF aContenido;
             aContenido = aContenido + " " + #gecom004#15;
             aClv = "02010301060202000000";   |HAZ LeeClave;  ||<PostCode>

             aClv = "02010301060203000000";   |HAZ LeeClave;  ||<Province>
             aClv = "02010301060204000000";   |HAZ LeeClave;  ||<CountryCode>
             aClv = "02010301060205000000";   |HAZ LeeClave;  ||</OverseasAddress>
         |FINSI;
     |FINSI;

     nOk = 0;
     aAlfa = #gecom004#19;  |HAZ MiraContenido;
     aAlfa = #gecom004#20;  |HAZ MiraContenido;
     aAlfa = #gecom004#21;  |HAZ MiraContenido;
     aAlfa = #gecom004#22;  |HAZ MiraContenido;
     aAlfa = #gecom004#23;  |HAZ MiraContenido;
     aAlfa = #gecom004#24;  |HAZ MiraContenido;
     aAlfa = #gecom004#25;  |HAZ MiraContenido;
     aAlfa = #gecom004#26;  |HAZ MiraContenido;

     |SI nOk = 1;
         aClv = "02010301070000000000";   |HAZ LeeClave;  ||<ContactDetails>
         aClv = "02010301070100000000";   |HAZ LeeClave;  ||<Telephone>
         aClv = "02010301070200000000";   |HAZ LeeClave;  ||<TeleFax>
         aClv = "02010301070300000000";   |HAZ LeeClave;  ||<WebAddress>
         aClv = "02010301070400000000";   |HAZ LeeClave;  ||<ElectronicMail>
         aClv = "02010301070500000000";   |HAZ LeeClave;  ||<ContactPersons>
         aClv = "02010301070600000000";   |HAZ LeeClave;  ||<CnoCnae>
         aClv = "02010301070700000000";   |HAZ LeeClave;  ||<INETownCode>
         aClv = "02010301070800000000";   |HAZ LeeClave;  ||<AdditionalContactDetails>
         aClv = "02010301070900000000";   |HAZ LeeClave;  ||</ContactDetails>
     |FINSI;

     aClv = "02010301080000000000";   |HAZ LeeClave;  ||<PhysicalGLN>
     aClv = "02010301090000000000";   |HAZ LeeClave;  ||<LogicalOperationalPoint>
     aClv = "02010301100000000000";   |HAZ LeeClave;  ||<CentreDescription>

     aClv = "02010301110000000000";   |HAZ LeeClave;  ||</AdministrativeCentre>
|FPRC;

|DEFBUCLE gecom004E;
     #gecom004#1;
     ;
     #gecom002#0, #gecom002#1, "E", "";
     #gecom002#0, #gecom002#1, "E", "zzzzzzzzzzzzzzzzzzzzzzzzzzzzzz";
     ;
     NULL, gecom004E;
|FIN;

|PROCESO Eti_2_1_3;          || Centros emisor
     #gecom004#0 = #gecom002#0;
     #gecom004#1 = #gecom002#1;
     #gecom004#2 = "E";
     #gecom004#3 = "";
     |LEE 000#gecom004.];
     |SI FSalida ! 0;                |ACABA;  |FINSI;
     |SI #gecom004#0 ! #gecom002#0;  |ACABA;  |FINSI;
     |SI #gecom004#1 ! #gecom002#1;  |ACABA;  |FINSI;
     |SI #gecom004#2 ! "E";          |ACABA;  |FINSI;

     aClv = "02010300000000000000";   |HAZ LeeClave;  ||<AdministrativeCentres>

     |BUCLE gecom004E;

     aClv = "02010302000000000000";   |HAZ LeeClave;  ||</AdministrativeCentres>
|FPRC;

|PROCESO Eti_2_1_4_1;        || Persona juridica emisor
     |SI #gecom003#12 ! "J";
         |ACABA;
     |FINSI;

     aClv = "02010401000000000000";   |HAZ LeeClave;  ||<LegalEntity>
     aClv = "02010401010000000000";   |HAZ LeeClave;  ||<CorporateName>
     aClv = "02010401020000000000";   |HAZ LeeClave;  ||<TradeName>

     nOk = 0;
     aAlfa = #gecom003#35;  |HAZ MiraContenido;
     aAlfa = #gecom003#36;  |HAZ MiraContenido;
     aAlfa = #gecom003#37;  |HAZ MiraContenido;
     aAlfa = #gecom003#38;  |HAZ MiraContenido;
     aAlfa = #gecom003#39;  |HAZ MiraContenido;
     aAlfa = #gecom003#40;  |HAZ MiraContenido;
     aAlfa = #gecom003#41;  |HAZ MiraContenido;

     |SI nOk = 1;
         aClv = "02010401030000000000";   |HAZ LeeClave;  ||<RegistrationData>
         aClv = "02010401030100000000";   |HAZ LeeClave;  ||<Book>
         aClv = "02010401030200000000";   |HAZ LeeClave;  ||<RegisterOfCompaniesLocation>
         aClv = "02010401030300000000";   |HAZ LeeClave;  ||<Sheet>
         aClv = "02010401030400000000";   |HAZ LeeClave;  ||<Folio>
         aClv = "02010401030500000000";   |HAZ LeeClave;  ||<Section>
         aClv = "02010401030600000000";   |HAZ LeeClave;  ||<Volume>
         aClv = "02010401030700000000";   |HAZ LeeClave;  ||<AdditionalRegistrationData>
         aClv = "02010401030800000000";   |HAZ LeeClave;  ||</RegistrationData>
     |FINSI;

     nOk = 0;
     aAlfa = #gecom003#21;  |HAZ MiraContenido;
     aAlfa = #gecom003#22;  |HAZ MiraContenido;
     aAlfa = #gecom003#23;  |HAZ MiraContenido;
     aAlfa = #gecom003#24;  |HAZ MiraContenido;
     aAlfa = #gecom003#25;  |HAZ MiraContenido;

     |SI nOk = 1;
         |SI #gecom003#25 = "ESP";
             aClv = "02010401040100000000";   |HAZ LeeClave;  ||<AddressInSpain>
             aClv = "02010401040101000000";   |HAZ LeeClave;  ||<Address>
             aClv = "02010401040102000000";   |HAZ LeeClave;  ||<PostCode>
             aClv = "02010401040103000000";   |HAZ LeeClave;  ||<Town>
             aClv = "02010401040104000000";   |HAZ LeeClave;  ||<Province>
             aClv = "02010401040105000000";   |HAZ LeeClave;  ||<CountryCode>
             aClv = "02010401040106000000";   |HAZ LeeClave;  ||</AddressInSpain>
         |FINSI;

         |SI #gecom003#25 ! "ESP";
             aClv = "02010401040200000000";   |HAZ LeeClave;  ||<OverseasAddress>
             aClv = "02010401040201000000";   |HAZ LeeClave;  ||<Address>

             aContenido = #gecom003#22;  |QBF aContenido;
             aContenido = aContenido + " " + #gecom003#23;
             aClv = "02010401040202000000";   |HAZ LeeClave;  ||<PostCode>

             aClv = "02010401040203000000";   |HAZ LeeClave;  ||<Province>
             aClv = "02010401040204000000";   |HAZ LeeClave;  ||<CountryCode>
             aClv = "02010401040205000000";   |HAZ LeeClave;  ||</OverseasAddress>
         |FINSI;
     |FINSI;

     nOk = 0;
     aAlfa = #gecom003#27;  |HAZ MiraContenido;
     aAlfa = #gecom003#28;  |HAZ MiraContenido;
     aAlfa = #gecom003#29;  |HAZ MiraContenido;
     aAlfa = #gecom003#30;  |HAZ MiraContenido;
     aAlfa = #gecom003#31;  |HAZ MiraContenido;
     aAlfa = #gecom003#32;  |HAZ MiraContenido;
     aAlfa = #gecom003#33;  |HAZ MiraContenido;
     aAlfa = #gecom003#34;  |HAZ MiraContenido;

     |SI nOk = 1;
         aClv = "02010401050000000000";   |HAZ LeeClave;  ||<ContactDetails>
         aClv = "02010401050100000000";   |HAZ LeeClave;  ||<Telephone>
         aClv = "02010401050200000000";   |HAZ LeeClave;  ||<TeleFax>
         aClv = "02010401050300000000";   |HAZ LeeClave;  ||<WebAddress>
         aClv = "02010401050400000000";   |HAZ LeeClave;  ||<ElectronicMail>
         aClv = "02010401050500000000";   |HAZ LeeClave;  ||<ContactPersons>
         aClv = "02010401050600000000";   |HAZ LeeClave;  ||<CnoCnae>
         aClv = "02010401050700000000";   |HAZ LeeClave;  ||<INETownCode>
         aClv = "02010401050800000000";   |HAZ LeeClave;  ||<AdditionalContactDetails>
         aClv = "02010401050900000000";   |HAZ LeeClave;  ||</ContactDetails>
     |FINSI;

     aClv = "02010401060000000000";   |HAZ LeeClave;  ||</LegalEntity>
|FPRC;

|PROCESO Eti_2_1_4_2;        ||Persona fisica emisor
     |SI #gecom003#12 ! "F";
         |ACABA;
     |FINSI;

     aClv = "02010402000000000000";   |HAZ LeeClave;  ||<Individual>
     aClv = "02010402010000000000";   |HAZ LeeClave;  ||<Name>
     aClv = "02010402020000000000";   |HAZ LeeClave;  ||<FirstSurname>
     aClv = "02010402030000000000";   |HAZ LeeClave;  ||SecondSurname>

     nOk = 0;
     aAlfa = #gecom003#21;  |HAZ MiraContenido;
     aAlfa = #gecom003#22;  |HAZ MiraContenido;
     aAlfa = #gecom003#23;  |HAZ MiraContenido;
     aAlfa = #gecom003#24;  |HAZ MiraContenido;
     aAlfa = #gecom003#25;  |HAZ MiraContenido;

     |SI nOk = 1;
         |SI #gecom003#25 = "ESP";
             aClv = "02010402040100000000";   |HAZ LeeClave;  ||<AddressInSpain>
             aClv = "02010402040101000000";   |HAZ LeeClave;  ||<Address>
             aClv = "02010402040102000000";   |HAZ LeeClave;  ||<PostCode>
             aClv = "02010402040103000000";   |HAZ LeeClave;  ||<Town>
             aClv = "02010402040104000000";   |HAZ LeeClave;  ||<Province>
             aClv = "02010402040105000000";   |HAZ LeeClave;  ||<CountryCode>
             aClv = "02010402040106000000";   |HAZ LeeClave;  ||</AddressInSpain>
         |FINSI;

         |SI #gecom003#25 ! "ESP";
             aClv = "02010402040200000000";   |HAZ LeeClave;  ||<OverseasAddress>
             aClv = "02010402040201000000";   |HAZ LeeClave;  ||<Address>

             aContenido = #gecom003#22;  |QBF aContenido;
             aContenido = aContenido + " " + #gecom003#23;
             aClv = "02010402040202000000";   |HAZ LeeClave;  ||<PostCode>

             aClv = "02010402040203000000";   |HAZ LeeClave;  ||<Province>
             aClv = "02010402040204000000";   |HAZ LeeClave;  ||<CountryCode>
             aClv = "02010402040205000000";   |HAZ LeeClave;  ||</OverseasAddress>
         |FINSI;
     |FINSI;

     nOk = 0;
     aAlfa = #gecom003#27;  |HAZ MiraContenido;
     aAlfa = #gecom003#28;  |HAZ MiraContenido;
     aAlfa = #gecom003#29;  |HAZ MiraContenido;
     aAlfa = #gecom003#30;  |HAZ MiraContenido;
     aAlfa = #gecom003#31;  |HAZ MiraContenido;
     aAlfa = #gecom003#32;  |HAZ MiraContenido;
     aAlfa = #gecom003#33;  |HAZ MiraContenido;
     aAlfa = #gecom003#34;  |HAZ MiraContenido;

     |SI nOk = 1;
         aClv = "02010402050000000000";   |HAZ LeeClave;  ||<ContactDetails>
         aClv = "02010402050100000000";   |HAZ LeeClave;  ||<Telephone>
         aClv = "02010402050200000000";   |HAZ LeeClave;  ||<TeleFax>
         aClv = "02010402050300000000";   |HAZ LeeClave;  ||<WebAddress>
         aClv = "02010402050400000000";   |HAZ LeeClave;  ||<ElectronicMail>
         aClv = "02010402050500000000";   |HAZ LeeClave;  ||<ContactPersons>
         aClv = "02010402050600000000";   |HAZ LeeClave;  ||<CnoCnae>
         aClv = "02010402050700000000";   |HAZ LeeClave;  ||<INETownCode>
         aClv = "02010402050800000000";   |HAZ LeeClave;  ||<AdditionalContactDetails>
         aClv = "02010402050900000000";   |HAZ LeeClave;  ||</ContactDetails>
     |FINSI;

     aClv = "02010402060000000000";   |HAZ LeeClave;  ||</Individual>
|FPRC;

|PROCESO SellerParty;
     aDEtiq = "<SellerParty>";
     aHEtiq = "<SellerParty>";
     |HAZ LeeEtiqueta;

     |HAZ Eti_2_1_1;    || Identificacion emisor
     |HAZ Eti_2_1_3;    || Centros emisor
     |HAZ Eti_2_1_4_1;  || Persona juridica emisor
     |HAZ Eti_2_1_4_2;  || Persona fisica emisor

     aDEtiq = "</SellerParty>";
     aHEtiq = "</SellerParty>";
     |HAZ LeeEtiqueta;
|FPRC;

|PROCESO Eti_2_2_1;          || Identificacion receptor
     aClv = "02020100000000000000";   |HAZ LeeClave;  ||<TaxIdentification>

     aClv = "02020101000000000000";   |HAZ LeeClave;  ||<PersonTypeCode>
     aClv = "02020102000000000000";   |HAZ LeeClave;  ||<ResidenceTypeCode>

     aContenido = #gecom003#56 % 102;  |QBF aContenido;
     aContenido = aContenido + #gecom003#42;
     aClv = "02020103000000000000";   |HAZ LeeClave;  ||<TaxIdentificationNumber>

     aClv = "02020104000000000000";   |HAZ LeeClave;  ||</TaxIdentification>
|FPRC;

|PROCESO gecom004R;
     aClv = "02020301000000000000";   |HAZ LeeClave;  ||<AdministrativeCentre>

     aContenido = #gecom004#27;   |QBF aContenido;
     aClv = "02020301010000000000";   |HAZ LeeClave;  ||<CentreCode>

     aClv = "02020301020000000000";   |HAZ LeeClave;  ||<RoleTypeCode>
     aClv = "02020301030000000000";   |HAZ LeeClave;  ||<Name>
     aClv = "02020301040000000000";   |HAZ LeeClave;  ||<FirstSurname>
     aClv = "02020301050000000000";   |HAZ LeeClave;  ||SecondSurname>

     nOk = 0;
     aAlfa = #gecom004#13;  |HAZ MiraContenido;
     aAlfa = #gecom004#14;  |HAZ MiraContenido;
     aAlfa = #gecom004#15;  |HAZ MiraContenido;
     aAlfa = #gecom004#16;  |HAZ MiraContenido;
     aAlfa = #gecom004#17;  |HAZ MiraContenido;

     |SI nOk = 1;
         |SI #gecom004#17 = "ESP";
             aClv = "02020301060100000000";   |HAZ LeeClave;  ||<AddressInSpain>
             aClv = "02020301060101000000";   |HAZ LeeClave;  ||<Address>
             aClv = "02020301060102000000";   |HAZ LeeClave;  ||<PostCode>
             aClv = "02020301060103000000";   |HAZ LeeClave;  ||<Town>
             aClv = "02020301060104000000";   |HAZ LeeClave;  ||<Province>
             aClv = "02020301060105000000";   |HAZ LeeClave;  ||<CountryCode>
             aClv = "02020301060106000000";   |HAZ LeeClave;  ||</AddressInSpain>
         |FINSI;

         |SI #gecom004#17 ! "ESP";
             aClv = "02020301060200000000";   |HAZ LeeClave;  ||<OverseasAddress>
             aClv = "02020301060201000000";   |HAZ LeeClave;  ||<Address>

             aContenido = #gecom004#14;  |QBF aContenido;
             aContenido = aContenido + " " + #gecom004#15;
             aClv = "02020301060202000000";   |HAZ LeeClave;  ||<PostCode>

             aClv = "02020301060203000000";   |HAZ LeeClave;  ||<Province>
             aClv = "02020301060204000000";   |HAZ LeeClave;  ||<CountryCode>
             aClv = "02020301060205000000";   |HAZ LeeClave;  ||</OverseasAddress>
         |FINSI;
     |FINSI;

     nOk = 0;
     aAlfa = #gecom004#19;  |HAZ MiraContenido;
     aAlfa = #gecom004#20;  |HAZ MiraContenido;
     aAlfa = #gecom004#21;  |HAZ MiraContenido;
     aAlfa = #gecom004#22;  |HAZ MiraContenido;
     aAlfa = #gecom004#23;  |HAZ MiraContenido;
     aAlfa = #gecom004#24;  |HAZ MiraContenido;
     aAlfa = #gecom004#25;  |HAZ MiraContenido;
     aAlfa = #gecom004#26;  |HAZ MiraContenido;

     |SI nOk = 1;
         aClv = "02020301070000000000";   |HAZ LeeClave;  ||<ContactDetails>
         aClv = "02020301070100000000";   |HAZ LeeClave;  ||<Telephone>
         aClv = "02020301070200000000";   |HAZ LeeClave;  ||<TeleFax>
         aClv = "02020301070300000000";   |HAZ LeeClave;  ||<WebAddress>
         aClv = "02020301070400000000";   |HAZ LeeClave;  ||<ElectronicMail>
         aClv = "02020301070500000000";   |HAZ LeeClave;  ||<ContactPersons>
         aClv = "02020301070600000000";   |HAZ LeeClave;  ||<CnoCnae>
         aClv = "02020301070700000000";   |HAZ LeeClave;  ||<INETownCode>
         aClv = "02020301070800000000";   |HAZ LeeClave;  ||<AdditionalContactDetails>
         aClv = "02020301070900000000";   |HAZ LeeClave;  ||</ContactDetails>
     |FINSI;

     aClv = "02020301080000000000";   |HAZ LeeClave;  ||<PhysicalGLN>
     aClv = "02020301090000000000";   |HAZ LeeClave;  ||<LogicalOperationalPoint>
     aClv = "02020301100000000000";   |HAZ LeeClave;  ||<CentreDescription>

     aClv = "02020301110000000000";   |HAZ LeeClave;  ||</AdministrativeCentre>
|FPRC;

|DEFBUCLE gecom004R;
     #gecom004#1;
     ;
     #gecom002#0, #gecom002#1, "R", "";
     #gecom002#0, #gecom002#1, "R", "zzzzzzzzzzzzzzzzzzzzzzzzzzzzzz";
     ;
     NULL, gecom004R;
|FIN;

|PROCESO CentrosFaceB2B;
     #gecom004#0 = #gecom002#0;
     #gecom004#1 = #gecom002#1;
     #gecom004#2 = "R";
     #gecom004#3 = "";
     |LEE 000#gecom004.];
     |SI FSalida ! 0;                |ACABA;  |FINSI;
     |SI #gecom004#0 ! #gecom002#0;  |ACABA;  |FINSI;
     |SI #gecom004#1 ! #gecom002#1;  |ACABA;  |FINSI;
     |SI #gecom004#2 ! "R";          |ACABA;  |FINSI;

     aClv = "02020300000000000000";   |HAZ LeeClave;  ||<AdministrativeCentres>

     aClv = "02020301000000000000";   |HAZ LeeClave;  ||<AdministrativeCentre>

     aContenido = #gecom004#3;   |QBF aContenido;
     aClv = "02020301010000000000";   |HAZ LeeClave;  ||<CentreCode>

     aClv = "02020301020000000000";   |HAZ LeeClave;  ||<RoleTypeCode>
     aClv = "02020301030000000000";   |HAZ LeeClave;  ||<Name>
     aClv = "02020301040000000000";   |HAZ LeeClave;  ||<FirstSurname>
     aClv = "02020301050000000000";   |HAZ LeeClave;  ||SecondSurname>

     nOk = 0;
     aAlfa = #gecom004#13;  |HAZ MiraContenido;
     aAlfa = #gecom004#14;  |HAZ MiraContenido;
     aAlfa = #gecom004#15;  |HAZ MiraContenido;
     aAlfa = #gecom004#16;  |HAZ MiraContenido;
     aAlfa = #gecom004#17;  |HAZ MiraContenido;

     |SI nOk = 1;
         |SI #gecom004#17 = "ESP";
             aClv = "02020301060100000000";   |HAZ LeeClave;  ||<AddressInSpain>
             aClv = "02020301060101000000";   |HAZ LeeClave;  ||<Address>
             aClv = "02020301060102000000";   |HAZ LeeClave;  ||<PostCode>
             aClv = "02020301060103000000";   |HAZ LeeClave;  ||<Town>
             aClv = "02020301060104000000";   |HAZ LeeClave;  ||<Province>
             aClv = "02020301060105000000";   |HAZ LeeClave;  ||<CountryCode>
             aClv = "02020301060106000000";   |HAZ LeeClave;  ||</AddressInSpain>
         |FINSI;

         |SI #gecom004#17 ! "ESP";
             aClv = "02020301060200000000";   |HAZ LeeClave;  ||<OverseasAddress>
             aClv = "02020301060201000000";   |HAZ LeeClave;  ||<Address>

             aContenido = #gecom004#14;  |QBF aContenido;
             aContenido = aContenido + " " + #gecom004#15;
             aClv = "02020301060202000000";   |HAZ LeeClave;  ||<PostCode>

             aClv = "02020301060203000000";   |HAZ LeeClave;  ||<Province>
             aClv = "02020301060204000000";   |HAZ LeeClave;  ||<CountryCode>
             aClv = "02020301060205000000";   |HAZ LeeClave;  ||</OverseasAddress>
         |FINSI;
     |FINSI;

     nOk = 0;
     aAlfa = #gecom004#19;  |HAZ MiraContenido;
     aAlfa = #gecom004#20;  |HAZ MiraContenido;
     aAlfa = #gecom004#21;  |HAZ MiraContenido;
     aAlfa = #gecom004#22;  |HAZ MiraContenido;
     aAlfa = #gecom004#23;  |HAZ MiraContenido;
     aAlfa = #gecom004#24;  |HAZ MiraContenido;
     aAlfa = #gecom004#25;  |HAZ MiraContenido;
     aAlfa = #gecom004#26;  |HAZ MiraContenido;

     |SI nOk = 1;
         aClv = "02020301070000000000";   |HAZ LeeClave;  ||<ContactDetails>
         aClv = "02020301070100000000";   |HAZ LeeClave;  ||<Telephone>
         aClv = "02020301070200000000";   |HAZ LeeClave;  ||<TeleFax>
         aClv = "02020301070300000000";   |HAZ LeeClave;  ||<WebAddress>
         aClv = "02020301070400000000";   |HAZ LeeClave;  ||<ElectronicMail>
         aClv = "02020301070500000000";   |HAZ LeeClave;  ||<ContactPersons>
         aClv = "02020301070600000000";   |HAZ LeeClave;  ||<CnoCnae>
         aClv = "02020301070700000000";   |HAZ LeeClave;  ||<INETownCode>
         aClv = "02020301070800000000";   |HAZ LeeClave;  ||<AdditionalContactDetails>
         aClv = "02020301070900000000";   |HAZ LeeClave;  ||</ContactDetails>
     |FINSI;

     aClv = "02020301080000000000";   |HAZ LeeClave;  ||<PhysicalGLN>
     aClv = "02020301090000000000";   |HAZ LeeClave;  ||<LogicalOperationalPoint>
     aClv = "02020301100000000000";   |HAZ LeeClave;  ||<CentreDescription>

     aClv = "02020301110000000000";   |HAZ LeeClave;  ||</AdministrativeCentre>

     aClv = "02020302000000000000";   |HAZ LeeClave;  ||</AdministrativeCentres>
|FPRC;

|PROCESO Eti_2_2_3;          || Centros receptor
     |SI #gecom003#110 = "FACeB2B                       ";
         |HAZ CentrosFaceB2B;

         |ACABA;
     |FINSI;

     #gecom004#0 = #gecom002#0;
     #gecom004#1 = #gecom002#1;
     #gecom004#2 = "R";
     #gecom004#3 = "";
     |LEE 000#gecom004.];
     |SI FSalida ! 0;                |ACABA;  |FINSI;
     |SI #gecom004#0 ! #gecom002#0;  |ACABA;  |FINSI;
     |SI #gecom004#1 ! #gecom002#1;  |ACABA;  |FINSI;
     |SI #gecom004#2 ! "R";          |ACABA;  |FINSI;

     aClv = "02020300000000000000";   |HAZ LeeClave;  ||<AdministrativeCentres>

     |BUCLE gecom004R;

     aClv = "02020302000000000000";   |HAZ LeeClave;  ||</AdministrativeCentres>
|FPRC;

|PROCESO Eti_2_2_4_1;        || Persona juridica receptor
     |SI #gecom003#43 ! "J";
         |ACABA;
     |FINSI;

     aClv = "02020401000000000000";   |HAZ LeeClave;  ||<LegalEntity>
     aClv = "02020401010000000000";   |HAZ LeeClave;  ||<CorporateName>
     aClv = "02020401020000000000";   |HAZ LeeClave;  ||<TradeName>

     nOk = 0;
     aAlfa = #gecom003#66;  |HAZ MiraContenido;
     aAlfa = #gecom003#67;  |HAZ MiraContenido;
     aAlfa = #gecom003#68;  |HAZ MiraContenido;
     aAlfa = #gecom003#69;  |HAZ MiraContenido;
     aAlfa = #gecom003#70;  |HAZ MiraContenido;
     aAlfa = #gecom003#71;  |HAZ MiraContenido;
     aAlfa = #gecom003#72;  |HAZ MiraContenido;

     |SI nOk = 1;
         aClv = "02020401030000000000";   |HAZ LeeClave;  ||<RegistrationData>
         aClv = "02020401030100000000";   |HAZ LeeClave;  ||<Book>
         aClv = "02020401030200000000";   |HAZ LeeClave;  ||<RegisterOfCompaniesLocation>
         aClv = "02020401030300000000";   |HAZ LeeClave;  ||<Sheet>
         aClv = "02020401030400000000";   |HAZ LeeClave;  ||<Folio>
         aClv = "02020401030500000000";   |HAZ LeeClave;  ||<Section>
         aClv = "02020401030600000000";   |HAZ LeeClave;  ||<Volume>
         aClv = "02020401030700000000";   |HAZ LeeClave;  ||<AdditionalRegistrationData>
         aClv = "02020401030800000000";   |HAZ LeeClave;  ||</RegistrationData>
     |FINSI;

     nOk = 0;
     aAlfa = #gecom003#52;  |HAZ MiraContenido;
     aAlfa = #gecom003#53;  |HAZ MiraContenido;
     aAlfa = #gecom003#54;  |HAZ MiraContenido;
     aAlfa = #gecom003#55;  |HAZ MiraContenido;
     aAlfa = #gecom003#56;  |HAZ MiraContenido;

     |SI nOk = 1;
         |SI #gecom003#56 = "ESP";
             aClv = "02020401040100000000";   |HAZ LeeClave;  ||<AddressInSpain>
             aClv = "02020401040101000000";   |HAZ LeeClave;  ||<Address>
             aClv = "02020401040102000000";   |HAZ LeeClave;  ||<PostCode>
             aClv = "02020401040103000000";   |HAZ LeeClave;  ||<Town>
             aClv = "02020401040104000000";   |HAZ LeeClave;  ||<Province>
             aClv = "02020401040105000000";   |HAZ LeeClave;  ||<CountryCode>
             aClv = "02020401040106000000";   |HAZ LeeClave;  ||</AddressInSpain>
         |FINSI;

         |SI #gecom003#56 ! "ESP";
             aClv = "02020401040200000000";   |HAZ LeeClave;  ||<OverseasAddress>
             aClv = "02020401040201000000";   |HAZ LeeClave;  ||<Address>

             aContenido = #gecom003#53;  |QBF aContenido;
             aContenido = aContenido + " " + #gecom003#54;
             aClv = "02020401040202000000";   |HAZ LeeClave;  ||<PostCode>

             aClv = "02020401040203000000";   |HAZ LeeClave;  ||<Province>
             aClv = "02020401040204000000";   |HAZ LeeClave;  ||<CountryCode>
             aClv = "02020401040205000000";   |HAZ LeeClave;  ||</OverseasAddress>
         |FINSI;
     |FINSI;

     nOk = 0;
     aAlfa = #gecom003#58;  |HAZ MiraContenido;
     aAlfa = #gecom003#59;  |HAZ MiraContenido;
     aAlfa = #gecom003#60;  |HAZ MiraContenido;
     aAlfa = #gecom003#61;  |HAZ MiraContenido;
     aAlfa = #gecom003#62;  |HAZ MiraContenido;
     aAlfa = #gecom003#63;  |HAZ MiraContenido;
     aAlfa = #gecom003#64;  |HAZ MiraContenido;
     aAlfa = #gecom003#65;  |HAZ MiraContenido;

     |SI nOk = 1;
         aClv = "02020401050000000000";   |HAZ LeeClave;  ||<ContactDetails>
         aClv = "02020401050100000000";   |HAZ LeeClave;  ||<Telephone>
         aClv = "02020401050200000000";   |HAZ LeeClave;  ||<TeleFax>
         aClv = "02020401050300000000";   |HAZ LeeClave;  ||<WebAddress>
         aClv = "02020401050400000000";   |HAZ LeeClave;  ||<ElectronicMail>
         aClv = "02020401050500000000";   |HAZ LeeClave;  ||<ContactPersons>
         aClv = "02020401050600000000";   |HAZ LeeClave;  ||<CnoCnae>
         aClv = "02020401050700000000";   |HAZ LeeClave;  ||<INETownCode>
         aClv = "02020401050800000000";   |HAZ LeeClave;  ||<AdditionalContactDetails>
         aClv = "02020401050900000000";   |HAZ LeeClave;  ||</ContactDetails>
     |FINSI;

     aClv = "02020401060000000000";   |HAZ LeeClave;  ||</LegalEntity>
|FPRC;

|PROCESO Eti_2_2_4_2;        || Persona fisica receptor
     |SI #gecom003#43 ! "F";
         |ACABA;
     |FINSI;

     aClv = "02020402000000000000";   |HAZ LeeClave;  ||<Individual>
     aClv = "02020402010000000000";   |HAZ LeeClave;  ||<Name>
     aClv = "02020402020000000000";   |HAZ LeeClave;  ||<FirstSurname>
     aClv = "02020402030000000000";   |HAZ LeeClave;  ||SecondSurname>

     nOk = 0;
     aAlfa = #gecom003#52;  |HAZ MiraContenido;
     aAlfa = #gecom003#53;  |HAZ MiraContenido;
     aAlfa = #gecom003#54;  |HAZ MiraContenido;
     aAlfa = #gecom003#55;  |HAZ MiraContenido;
     aAlfa = #gecom003#56;  |HAZ MiraContenido;

     |SI nOk = 1;
         |SI #gecom003#56 = "ESP";
             aClv = "02020402040100000000";   |HAZ LeeClave;  ||<AddressInSpain>
             aClv = "02020402040101000000";   |HAZ LeeClave;  ||<Address>
             aClv = "02020402040102000000";   |HAZ LeeClave;  ||<PostCode>
             aClv = "02020402040103000000";   |HAZ LeeClave;  ||<Town>
             aClv = "02020402040104000000";   |HAZ LeeClave;  ||<Province>
             aClv = "02020402040105000000";   |HAZ LeeClave;  ||<CountryCode>
             aClv = "02020402040106000000";   |HAZ LeeClave;  ||</AddressInSpain>
         |FINSI;

         |SI #gecom003#56 ! "ESP";
             aClv = "02020402040200000000";   |HAZ LeeClave;  ||<OverseasAddress>
             aClv = "02020402040201000000";   |HAZ LeeClave;  ||<Address>

             aContenido = #gecom003#53;  |QBF aContenido;
             aContenido = aContenido + " " + #gecom003#54;
             aClv = "02020402040202000000";   |HAZ LeeClave;  ||<PostCode>

             aClv = "02020402040203000000";   |HAZ LeeClave;  ||<Province>
             aClv = "02020402040204000000";   |HAZ LeeClave;  ||<CountryCode>
             aClv = "02020402040205000000";   |HAZ LeeClave;  ||</OverseasAddress>
         |FINSI;
     |FINSI;

     nOk = 0;
     aAlfa = #gecom003#58;  |HAZ MiraContenido;
     aAlfa = #gecom003#59;  |HAZ MiraContenido;
     aAlfa = #gecom003#60;  |HAZ MiraContenido;
     aAlfa = #gecom003#61;  |HAZ MiraContenido;
     aAlfa = #gecom003#62;  |HAZ MiraContenido;
     aAlfa = #gecom003#63;  |HAZ MiraContenido;
     aAlfa = #gecom003#64;  |HAZ MiraContenido;
     aAlfa = #gecom003#65;  |HAZ MiraContenido;

     |SI nOk = 1;
         aClv = "02020402050000000000";   |HAZ LeeClave;  ||<ContactDetails>
         aClv = "02020402050100000000";   |HAZ LeeClave;  ||<Telephone>
         aClv = "02020402050200000000";   |HAZ LeeClave;  ||<TeleFax>
         aClv = "02020402050300000000";   |HAZ LeeClave;  ||<WebAddress>
         aClv = "02020402050400000000";   |HAZ LeeClave;  ||<ElectronicMail>
         aClv = "02020402050500000000";   |HAZ LeeClave;  ||<ContactPersons>
         aClv = "02020402050600000000";   |HAZ LeeClave;  ||<CnoCnae>
         aClv = "02020402050700000000";   |HAZ LeeClave;  ||<INETownCode>
         aClv = "02020402050800000000";   |HAZ LeeClave;  ||<AdditionalContactDetails>
         aClv = "02020402050900000000";   |HAZ LeeClave;  ||</ContactDetails>
     |FINSI;

     aClv = "02020402060000000000";   |HAZ LeeClave;  ||</Individual>
|FPRC;

|PROCESO BuyerParty;
     aDEtiq = "<BuyerParty>";
     aHEtiq = "<BuyerParty>";
     |HAZ LeeEtiqueta;

     |HAZ Eti_2_2_1;    || Identificacion receptor
     |HAZ Eti_2_2_3;    || Centros receptor
     |HAZ Eti_2_2_4_1;  || Persona juridica receptor
     |HAZ Eti_2_2_4_2;  || Persona fisica receptor

     aDEtiq = "</BuyerParty>";
     aHEtiq = "</BuyerParty>";
     |HAZ LeeEtiqueta;
|FPRC;

|PROCESO Parties;
     aDEtiq = "<Parties>";
     aHEtiq = "<Parties>";
     |HAZ LeeEtiqueta;

     |HAZ SellerParty;
     |HAZ BuyerParty;

     aDEtiq = "</Parties>";
     aHEtiq = "</Parties>";
     |HAZ LeeEtiqueta;
|FPRC;

|PROCESO Corrective;
     #gecom003#0 = enEmp;
     #gecom003#1 = #gecom002#13;
     |LEE 000#gecom003.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |ABRE #gecom064;
     #gecom064#0 = #gecom002#15;
     |LEE 000#gecom064.=;
     |CIERRA #gecom064;

     |ABRE #gecom065;
     #gecom065#0 = #gecom002#14;
     |LEE 000#gecom065.=;
     |CIERRA #gecom065;

     aClv = "03010105000000000000";   |HAZ LeeClave;  ||<Corrective>

     aClv = "03010105010000000000";   |HAZ LeeClave;  ||<InvoiceNumber>
     aClv = "03010105020000000000";   |HAZ LeeClave;  ||<InvoiceSeriesCode>
     aClv = "03010105030000000000";   |HAZ LeeClave;  ||<ReasonCode>

     aContenido = #gecom065#1;
     aClv = "03010105040000000000";   |HAZ LeeClave;  ||<ReasonDescription>

     aClv = "03010105050000000000";   |HAZ LeeClave;  ||<TaxPeriod>

     aFec = #gecom003#4;  |HAZ ConverFec;  aContenido = aFec;
     aClv = "03010105050100000000";   |HAZ LeeClave;  ||<StartDate>

     aFec = #gecom002#10;  |HAZ ConverFec;  aContenido = aFec;
     aClv = "03010105050200000000";   |HAZ LeeClave;  ||<EndDate>

     aClv = "03010105050300000000";   |HAZ LeeClave;  ||</TaxPeriod>

     aClv = "03010105060000000000";   |HAZ LeeClave;  ||<CorrectionMethod>

     aContenido = #gecom064#1;
     aClv = "03010105070000000000";   |HAZ LeeClave;  ||<CorrectionMethodDescription>
     aClv = "03010105090000000000";   |HAZ LeeClave;  ||<InvoiceIssueDate>

     aClv = "03010105100000000000";   |HAZ LeeClave;  ||</Corrective>

     #gecom003#0 = enEmp;
     #gecom003#1 = eaIde;
     |LEE 000#gecom003.=;
|FPRC;

|PROCESO Eti_3_1_1;          || Cabecera factura
     aDEtiq = "<InvoiceHeader>";
     aHEtiq = "<InvoiceHeader>";
     |HAZ LeeEtiqueta;

     aClv = "03010101000000000000";   |HAZ LeeClave;  ||<InvoiceNumber>
     aClv = "03010102000000000000";   |HAZ LeeClave;  ||<InvoiceSeriesCode>

     aContenido = "FC";
     aClv = "03010103000000000000";   |HAZ LeeClave;  ||<InvoiceDocumentType>

     |SI #gecom002#7 = "P ";  aContenido = "OO";  |FINSI;
     |SI #gecom002#7 = "X ";  aContenido = "OO";  |FINSI;
     |SI #gecom002#7 = "E ";  aContenido = "OO";  |FINSI;
     |SI #gecom002#7 = "R ";  aContenido = "OO";  |FINSI;
     |SI #gecom002#7 = "A ";  aContenido = "OO";  |FINSI;

     |SI #gecom002#7 = "RP";  aContenido = "OR";  |FINSI;
     |SI #gecom002#7 = "RX";  aContenido = "OR";  |FINSI;
     |SI #gecom002#7 = "RE";  aContenido = "OR";  |FINSI;
     |SI #gecom002#7 = "RR";  aContenido = "OR";  |FINSI;
     |SI #gecom002#7 = "RA";  aContenido = "OR";  |FINSI;

     aClv = "03010104000000000000";   |HAZ LeeClave;  ||<InvoiceDocumentType>

     aAlfa =  #gecom002#7 % 101;
     |SI aAlfa = "R";
         |HAZ Corrective;
     |FINSI;



     aDEtiq = "</InvoiceHeader>";
     aHEtiq = "</InvoiceHeader>";
     |HAZ LeeEtiqueta;
|FPRC;

|PROCESO Eti_3_1_2;          || Datos de la emision de la factura
     aDEtiq = "<InvoiceIssueData>";
     aHEtiq = "<InvoiceIssueData>";
     |HAZ LeeEtiqueta;

     aClv = "03010201000000000000";   |HAZ LeeClave;  ||<IssueDate>
     aClv = "03010202000000000000";   |HAZ LeeClave;  ||<OperationDate>

     nOk = 0;
     aAlfa = #gecom003#6;  |HAZ MiraContenido;
     aAlfa = #gecom003#7;  |HAZ MiraContenido;

     |SI nOk = 1;
         aClv = "03010203000000000000";   |HAZ LeeClave;  ||<PlaceOfIssue>
         aClv = "03010203010000000000";   |HAZ LeeClave;  ||<PostCode>
         aClv = "03010203020000000000";   |HAZ LeeClave;  ||<PlaceOfIssueDescription>
         aClv = "03010203030000000000";   |HAZ LeeClave;  ||</PlaceOfIssue>
     |FINSI;

     |SI #gecom003#8 = "S";
         aClv = "03010204000000000000";   |HAZ LeeClave;  ||<InvoicingPeriod>
         aClv = "03010204010000000000";   |HAZ LeeClave;  ||<StartDate>
         aClv = "03010204020000000000";   |HAZ LeeClave;  ||<EndDate>
         aClv = "03010204030000000000";   |HAZ LeeClave;  ||</InvoicingPeriod>
     |FINSI;

     aContenido = "EUR";
     aClv = "03010205000000000000";   |HAZ LeeClave;  ||<InvoiceCurrencyCode>

     aContenido = "EUR";
     aClv = "03010207000000000000";   |HAZ LeeClave;  ||<TaxCurrencyCode>

     aContenido = "es";
     aClv = "03010208000000000000";   |HAZ LeeClave;  ||<TaxCurrencyCode>




     aDEtiq = "</InvoiceIssueData>";
     aHEtiq = "</InvoiceIssueData>";
     |HAZ LeeEtiqueta;
|FPRC;

|PROCESO gecom007_3_1_3;
     #gecom005#0 = #gecom002#0;
     #gecom005#1 = #gecom002#1;
     #gecom005#2 = #gecom007#2;
     |LEE 000#gecom005.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     #gecow009#0 = #gecom007#11;
     #gecow009#1 = #gecom007#5;
     #gecow009#2 = #gecom007#7;
     |LEE 101#gecow009.=;
     |SI FSalida ! 0;
         |DDEFECTO #gecow009;
         #gecow009#0 = #gecom007#11;
         #gecow009#1 = #gecom007#5;
         #gecow009#2 = #gecom007#7;
         |GRABA 020#gecow009.b;
     |FINSI;

     #gecow009#3 = #gecow009#3 + ((#gecom003#101 * #gecom005#8) / #gecom003#98);
     #gecow009#4 = #gecow009#4 + ((#gecom003#101 * #gecom007#6) / #gecom003#98);
     #gecow009#5 = #gecow009#5 + ((#gecom003#101 * #gecom007#8) / #gecom003#98);
     |GRABA 020#gecow009.a;
     |LIBERA #gecow009;
|FPRC;

|DEFBUCLE gecom007_3_1_3;
     #gecom007#1;
     ;
     #gecom002#0, #gecom002#1, 0000, 00;
     #gecom002#0, #gecom002#1, 9999, 99;
     ;
     NULL, gecom007_3_1_3;
|FIN;

|PROCESO gecow009_3_1_3;
     aClv = "03010301000000000000";   |HAZ LeeClave;  ||<Tax>

     aContenido = ("00" + #gecow009#0) % -102;
     aClv = "03010301010000000000";   |HAZ LeeClave;  ||<TaxTypeCode>
     aClv = "03010301020000000000";   |HAZ LeeClave;  ||<TaxRate>

     aClv = "030103010300000000000";   |HAZ LeeClave; ||<TaxableBase>
     aClv = "030103010301000000000";   |HAZ LeeClave; ||<TotalAmount>
     aClv = "030103010303000000000";   |HAZ LeeClave; ||</TaxableBase>

     |SI #gecow009#4 ! 0;
         aClv = "030103010400000000000";   |HAZ LeeClave; ||<TaxAmount>
         aClv = "030103010401000000000";   |HAZ LeeClave; ||<TotalAmount>
         aClv = "030103010403000000000";   |HAZ LeeClave; ||</TaxAmount>
     |FINSI;

     |SI #gecow009#5 ! 0;
         aClv = "030103010700000000000";   |HAZ LeeClave; ||<EquivalenceSurcharge>
         aClv = "030103010800000000000";   |HAZ LeeClave; ||<EquivalenceSurchargeAmount>
         aClv = "030103010801000000000";   |HAZ LeeClave; ||<EquivalenceSurchargeAmount>
         aClv = "030103010802000000000";   |HAZ LeeClave; ||<TotalAmount>
         aClv = "030103010803000000000";   |HAZ LeeClave; ||</EquivalenceSurchargeAmount>
     |FINSI;

     aClv = "03010301090000000000";   |HAZ LeeClave;  ||</Tax>
|FPRC;

|DEFBUCLE gecow009_3_1_3;
     #gecow009#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, gecow009_3_1_3;
|FIN;

|PROCESO Eti_3_1_3;          || Impuestos repercutidos
     aFic = "gecow009" + Usuario;
     |NOME_DAT #gecow009#aFic#;
     |ABRE #gecow009;  |CIERRA #gecow009;  |DELINDEX #gecow009;

     |ABRE #gecow009;
     |BUCLE gecom007_3_1_3;

     |LEE 000#gecow009.p;
     |SI FSalida ! 0;
         |CIERRA #gecow009;
         |DELINDEX #gecow009;
         |ACABA;
     |FINSI;
     |CIERRA #gecow009;

     aClv = "03010300000000000000";   |HAZ LeeClave;  ||<TaxesOutputs>

     |BUCLE gecow009_3_1_3;

     aClv = "03010302000000000000";   |HAZ LeeClave;  ||</TaxesOutputs>

     |DELINDEX #gecow009;
|FPRC;

|PROCESO gecom008_3_1_4;
     #gecom005#0 = #gecom002#0;
     #gecom005#1 = #gecom002#1;
     #gecom005#2 = #gecom008#2;
     |LEE 000#gecom005.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     #gecow009#0 = #gecom008#7;
     #gecow009#1 = #gecom008#5;
     #gecow009#2 = 0;
     |LEE 101#gecow009.=;
     |SI FSalida ! 0;
         |DDEFECTO #gecow009;
         #gecow009#0 = #gecom008#7;
         #gecow009#1 = #gecom008#5;
         #gecow009#2 = 0;
         |GRABA 020#gecow009.b;
     |FINSI;

     #gecow009#3 = #gecow009#3 + ((#gecom003#101 * #gecom005#8) / #gecom003#98);
     #gecow009#4 = #gecow009#4 + ((#gecom003#101 * #gecom008#6) / #gecom003#98);
     |GRABA 020#gecow009.a;
     |LIBERA #gecow009;
|FPRC;

|DEFBUCLE gecom008_3_1_4;
     #gecom008#1;
     ;
     #gecom002#0, #gecom002#1, 0000, 00;
     #gecom002#0, #gecom002#1, 9999, 99;
     ;
     NULL, gecom008_3_1_4;
|FIN;

|PROCESO gecow009_3_1_4;
     aClv = "03010401000000000000";   |HAZ LeeClave;  ||<Tax>

     aContenido = ("00" + #gecow009#0) % -102;
     aClv = "03010401010000000000";   |HAZ LeeClave;  ||<TaxTypeCode>
     aClv = "03010401020000000000";   |HAZ LeeClave;  ||<TaxRate>

     aClv = "030104010300000000000";   |HAZ LeeClave; ||<TaxableBase>
     aClv = "030104010301000000000";   |HAZ LeeClave; ||<TotalAmount>
     aClv = "030104010303000000000";   |HAZ LeeClave; ||</TaxableBase>

     |SI #gecow009#4 ! 0;
         aClv = "030104010400000000000";   |HAZ LeeClave; ||<TaxAmount>
         aClv = "030104010401000000000";   |HAZ LeeClave; ||<TotalAmount>
         aClv = "030104010403000000000";   |HAZ LeeClave; ||</TaxAmount>
     |FINSI;

     aClv = "03010401050000000000";   |HAZ LeeClave;  ||</Tax>
|FPRC;

|DEFBUCLE gecow009_3_1_4;
     #gecow009#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, gecow009_3_1_4;
|FIN;

|PROCESO Eti_3_1_4;          || Impuestos retenidos
     aFic = "gecow009" + Usuario;
     |NOME_DAT #gecow009#aFic#;
     |ABRE #gecow009;  |CIERRA #gecow009;  |DELINDEX #gecow009;

     |ABRE #gecow009;
     |BUCLE gecom008_3_1_4;

     |LEE 000#gecow009.p;
     |SI FSalida ! 0;
         |CIERRA #gecow009;
         |DELINDEX #gecow009;
         |ACABA;
     |FINSI;
     |CIERRA #gecow009;

     aClv = "03010400000000000000";   |HAZ LeeClave;  ||<TaxesWithheld>

     |BUCLE gecow009_3_1_4;

     aClv = "03010402000000000000";   |HAZ LeeClave;  ||</TaxesWithheld>

     |DELINDEX #gecow009;
|FPRC;

|PROCESO gecom010;
     |SI #gecom010#2 = "D";
         aClv = "03010502010000000000";   |HAZ LeeClave;  ||<Discount>

         aClv = "03010502010100000000";   |HAZ LeeClave;  ||<DiscountReason>
         aClv = "03010502010200000000";   |HAZ LeeClave;  ||<DiscountRate>
         aClv = "03010502010300000000";   |HAZ LeeClave;  ||<DiscountAmount>

         aClv = "03010502010400000000";   |HAZ LeeClave;  ||</Discount>
     |FINSI;

     |SI #gecom010#2 = "C";
         aClv = "03010503010000000000";   |HAZ LeeClave;  ||<Charge>

         aClv = "03010503010100000000";   |HAZ LeeClave;  ||<ChargeReason>
         aClv = "03010503010200000000";   |HAZ LeeClave;  ||<ChargeRate>
         aClv = "03010503010300000000";   |HAZ LeeClave;  ||<ChargeAmount>

         aClv = "03010503010400000000";   |HAZ LeeClave;  ||</Charge>
     |FINSI;
|FPRC;

|DEFBUCLE gecom010;
     #gecom010#1;
     ;
     #gecom002#0, #gecom002#1, aTipo, 00;
     #gecom002#0, #gecom002#1, aTipo, 99;
     ;
     NULL, gecom010;
|FIN;

|PROCESO gecom011;
     aClv = "03010512010000000000";   |HAZ LeeClave;  ||<ReimbursableExpenses>

     nOk = 0;
     aAlfa = #gecom011#3;  |HAZ MiraContenido;
     aAlfa = #gecom011#4;  |HAZ MiraContenido;
     aAlfa = #gecom011#5;  |HAZ MiraContenido;
     aAlfa = #gecom011#6;  |HAZ MiraContenido;

     |SI nOk = 1;
         aClv = "03010512010100000000";   |HAZ LeeClave;  ||<ReimbursableExpensesSellerParty>
         aClv = "03010512010101000000";   |HAZ LeeClave;  ||<PersonTypeCode>
         aClv = "03010512010102000000";   |HAZ LeeClave;  ||<ResidenceTypeCode>
         aClv = "03010512010103000000";   |HAZ LeeClave;  ||<TaxIdentificationNumber>
         aClv = "03010512010104000000";   |HAZ LeeClave;  ||</ReimbursableExpensesSellerParty>
     |FINSI;

     nOk = 0;
     aAlfa = #gecom011#7;  |HAZ MiraContenido;
     aAlfa = #gecom011#8;  |HAZ MiraContenido;
     aAlfa = #gecom011#9;  |HAZ MiraContenido;
     aAlfa = #gecom011#10; |HAZ MiraContenido;

     |SI nOk = 1;
         aClv = "03010512010200000000";   |HAZ LeeClave;  ||<ReimbursableExpensesBuyerParty>
         aClv = "03010512010201000000";   |HAZ LeeClave;  ||<PersonTypeCode>
         aClv = "03010512010202000000";   |HAZ LeeClave;  ||<ResidenceTypeCode>
         aClv = "03010512010203000000";   |HAZ LeeClave;  ||<TaxIdentificationNumber>
         aClv = "03010512010204000000";   |HAZ LeeClave;  ||</ReimbursableExpensesBuyerParty>
     |FINSI;

     aClv = "03010512010600000000";   |HAZ LeeClave;  ||</ReimbursableExpensesAmount>

     aClv = "03010512020000000000";   |HAZ LeeClave;  ||</ReimbursableExpenses>
|FPRC;

|DEFBUCLE gecom011;
     #gecom011#1;
     ;
     #gecom002#0, #gecom002#1, 00;
     #gecom002#0, #gecom002#1, 99;
     ;
     NULL, gecom011;
|FIN;

|PROCESO Eti_3_1_5;          || Totales de factura
     aClv = "03010500000000000000";   |HAZ LeeClave;  ||<InvoiceTotals>
     aClv = "03010501000000000000";   |HAZ LeeClave;  ||<TotalGrossAmount>

     |SI #gecom003#99 ! 0;
         aClv = "03010502000000000000";   |HAZ LeeClave;  ||<GeneralDiscounts>
         aTipo = "D";  |BUCLE gecom010;
         aClv = "03010502020000000000";   |HAZ LeeClave;  ||</GeneralDiscounts>
     |FINSI;

     |SI #gecom003#100 ! 0;
         aClv = "03010503000000000000";   |HAZ LeeClave;  ||<GeneralSurcharges>
         aTipo = "C";  |BUCLE gecom010;
         aClv = "03010503020000000000";   |HAZ LeeClave;  ||</GeneralSurcharges>
     |FINSI;

     aClv = "03010504000000000000";   |HAZ LeeClave;  ||<TotalGeneralDiscounts>
     aClv = "03010505000000000000";   |HAZ LeeClave;  ||<TotalGeneralSurcharges>
     aClv = "03010506000000000000";   |HAZ LeeClave;  ||<TotalGrossAmountBeforeTaxes>
     aClv = "03010507000000000000";   |HAZ LeeClave;  ||<TotalTaxOutputs>
     aClv = "03010508000000000000";   |HAZ LeeClave;  ||<TotalTaxesWithheld>
     aClv = "03010509000000000000";   |HAZ LeeClave;  ||<InvoiceTotal>

     |SI #gecom003#106 ! 0;
         aClv = "03010512000000000000";   |HAZ LeeClave;  ||<ReimbursableExpenses>
         |BUCLE gecom011;
         aClv = "03010512020000000000";   |HAZ LeeClave;  ||</ReimbursableExpenses>
     |FINSI;

     aClv = "03010513000000000000";   |HAZ LeeClave;  ||<TotalFinancialExpenses>

     nNume      = #gecom003#104 + #gecom003#107;
     aContenido = nNume;  nDecimal = 2;  |HAZ PonDecimales;
     aClv = "03010514000000000000";   |HAZ LeeClave;  ||<TotalOutstandingAmount>

     |SI #gecom003#105 ! 0;
         aClv = "03010516000000000000";   |HAZ LeeClave;  ||<AmountsWithheld>
         aClv = "03010516010000000000";   |HAZ LeeClave;  ||<WithholdingReason>
         aClv = "03010516020000000000";   |HAZ LeeClave;  ||<WithholdingRate>
         aClv = "03010516030000000000";   |HAZ LeeClave;  ||<WithholdingAmount>
         aClv = "03010516040000000000";   |HAZ LeeClave;  ||</AmountsWithheld>
     |FINSI;

     aClv = "03010517000000000000";   |HAZ LeeClave;  ||<TotalExecutableAmount>
     aClv = "03010518000000000000";   |HAZ LeeClave;  ||<TotalReimbursableExpenses>

     aClv = "03010520000000000000";   |HAZ LeeClave;  ||</InvoiceTotals>
|FPRC;

|PROCESO gecom009;
     aClv = "03010601120100000000";   |HAZ LeeClave;  ||<DeliveryNote>

     aClv = "03010601120101000000";   |HAZ LeeClave;  ||<DeliveryNoteNumber>
     aClv = "03010601120102000000";   |HAZ LeeClave;  ||<DeliveryNoteDate>

     aClv = "03010601120103000000";   |HAZ LeeClave;  ||</DeliveryNote>
|FPRC;

|DEFBUCLE gecom009;
     #gecom009#1;
     ;
     #gecom005#0, #gecom005#1, #gecom005#2, 00;
     #gecom005#0, #gecom005#1, #gecom005#2, 99;
     ;
     NULL, gecom009;
|FIN;

|PROCESO gecom006;
     |SI #gecom006#3 = "D";
         aClv = "03010601180100000000";   |HAZ LeeClave;  ||<Discount>

         aClv = "03010601180101000000";   |HAZ LeeClave;  ||<DiscountReason>
         aClv = "03010601180102000000";   |HAZ LeeClave;  ||<DiscountRate>
         aClv = "03010601180103000000";   |HAZ LeeClave;  ||<DiscountAmount>

         aClv = "03010601180104000000";   |HAZ LeeClave;  ||</Discount>
     |FINSI;

     |SI #gecom006#3 = "C";
         aClv = "03010601190100000000";   |HAZ LeeClave;  ||<Charge>

         aClv = "03010601190101000000";   |HAZ LeeClave;  ||<ChargeReason>
         aClv = "03010601190102000000";   |HAZ LeeClave;  ||<ChargeRate>
         aClv = "03010601190103000000";   |HAZ LeeClave;  ||<ChargeAmount>

         aClv = "03010601190104000000";   |HAZ LeeClave;  ||</Charge>
     |FINSI;
|FPRC;

|DEFBUCLE gecom006;
     #gecom006#1;
     ;
     #gecom005#0, #gecom005#1, #gecom005#2, aTipo, 00;
     #gecom005#0, #gecom005#1, #gecom005#2, aTipo, 99;
     ;
     NULL, gecom006;
|FIN;

|PROCESO gecom008;
     aClv = "03010601210100000000";   |HAZ LeeClave;  ||<Tax>

     aContenido = ("00" + #gecom008#7) % -102;
     aClv = "03010601210101000000";   |HAZ LeeClave;  ||<TaxTypeCode>
     aClv = "03010601210102000000";   |HAZ LeeClave;  ||<TaxRate>

     aClv = "03010601210103000000";   |HAZ LeeClave;  ||<TaxableBase>
     aClv = "03010601210103010000";   |HAZ LeeClave;  ||<TotalAmount>
     aClv = "03010601210103030000";   |HAZ LeeClave;  ||</TaxableBase>

     aClv = "03010601210104000000";   |HAZ LeeClave;  ||<TaxAmount>
     aClv = "03010601210104010000";   |HAZ LeeClave;  ||<TotalAmount>
     aClv = "03010601210104030000";   |HAZ LeeClave;  ||</TaxAmount>

     aClv = "03010601210105000000";   |HAZ LeeClave;  ||</Tax>
|FPRC;

|DEFBUCLE gecom008;
     #gecom008#1;
     ;
     #gecom005#0, #gecom005#1, #gecom005#2, 00;
     #gecom005#0, #gecom005#1, #gecom005#2, 99;
     ;
     NULL, gecom008;
|FIN;

|PROCESO gecom007;
     aClv = "03010601220100000000";   |HAZ LeeClave;  ||<Tax>

     aContenido = ("00" + #gecom007#11) % -102;
     aClv = "03010601220101000000";   |HAZ LeeClave;  ||<TaxTypeCode>
     aClv = "03010601220102000000";   |HAZ LeeClave;  ||<TaxRate>

     aClv = "03010601220103000000";   |HAZ LeeClave;  ||<TaxableBase>
     aClv = "03010601220103010000";   |HAZ LeeClave;  ||<TotalAmount>
     aClv = "03010601220103030000";   |HAZ LeeClave;  ||</TaxableBase>

     |SI #gecom007#5 ! 0;
         aClv = "03010601220104000000";   |HAZ LeeClave;  ||<TaxAmount>
         aClv = "03010601220104010000";   |HAZ LeeClave;  ||<TotalAmount>
         aClv = "03010601220104030000";   |HAZ LeeClave;  ||</TaxAmount>
     |FINSI;

     |SI #gecom007#7 ! 0;
         aClv = "03010601220105000000";   |HAZ LeeClave;  ||<EquivalenceSurcharge>

         aClv = "03010601220106000000";   |HAZ LeeClave;  ||<EquivalenceSurchargeAmount>
         aClv = "03010601220106010000";   |HAZ LeeClave;  ||<TotalAmount>
         aClv = "03010601220106030000";   |HAZ LeeClave;  ||</EquivalenceSurchargeAmount>
     |FINSI;

     aClv = "03010601210105000000";   |HAZ LeeClave;  ||</Tax>
|FPRC;

|DEFBUCLE gecom007;
     #gecom007#1;
     ;
     #gecom005#0, #gecom005#1, #gecom005#2, 00;
     #gecom005#0, #gecom005#1, #gecom005#2, 99;
     ;
     NULL, gecom007;
|FIN;

|PROCESO gecom005;
     aClv = "03010601000000000000";   |HAZ LeeClave;  ||<InvoiceLine>

     aClv = "03010601010000000000";   |HAZ LeeClave;  ||<IssuerContractReference>
     aClv = "03010601020000000000";   |HAZ LeeClave;  ||<IssuerContractDate>
     aClv = "03010601030000000000";   |HAZ LeeClave;  ||<IssuerTransactionReference>
     aClv = "03010601040000000000";   |HAZ LeeClave;  ||<IssuerTransactionDate>
     aClv = "03010601050000000000";   |HAZ LeeClave;  ||<ReceiverContractReference>
     aClv = "03010601060000000000";   |HAZ LeeClave;  ||<ReceiverContractDate>
     aClv = "03010601070000000000";   |HAZ LeeClave;  ||<ReceiverTransactionReference>
     aClv = "03010601080000000000";   |HAZ LeeClave;  ||<ReceiverTransactionDate>
     aClv = "03010601090000000000";   |HAZ LeeClave;  ||<FileReference>
     aClv = "03010601100000000000";   |HAZ LeeClave;  ||<FileDate>
     aClv = "03010601110000000000";   |HAZ LeeClave;  ||<SequenceNumber>

     #gecom009#0 = #gecom005#0;
     #gecom009#1 = #gecom005#1;
     #gecom009#2 = #gecom005#2;
     #gecom009#3 = 1;
     |LEE 000#gecom009.];
     |SI FSalida = 0;  |Y #gecom009#0 = #gecom005#0;
                       |Y #gecom009#1 = #gecom005#1;
                       |Y #gecom009#2 = #gecom005#2;
         aClv = "03010601120000000000";   |HAZ LeeClave;  ||<DeliveryNotesReferences>

         |BUCLE gecom009;

         aClv = "03010601120200000000";   |HAZ LeeClave;  ||/<DeliveryNotesReferences>
     |FINSI;

     aClv = "03010601130000000000";   |HAZ ItemDescription;   ||<ItemDescription>

     aClv = "03010601140000000000";   |HAZ LeeClave;  ||<Quantity>
     aClv = "03010601150000000000";   |HAZ LeeClave;  ||<UnitOfMeasure>
     aClv = "03010601160000000000";   |HAZ LeeClave;  ||<UnitPriceWithoutTax>
     aClv = "03010601170000000000";   |HAZ LeeClave;  ||<TotalCost>

     #gecom006#0 = #gecom005#0;
     #gecom006#1 = #gecom005#1;
     #gecom006#2 = #gecom005#2;
     #gecom006#3 = "D";
     #gecom006#4 = 1;
     |LEE 000#gecom006.];
     |SI FSalida = 0;  |Y #gecom006#0 = #gecom005#0;
                       |Y #gecom006#1 = #gecom005#1;
                       |Y #gecom006#2 = #gecom005#2;
                       |Y #gecom006#3 = "D";
         aClv = "03010601180000000000";   |HAZ LeeClave;  ||<DiscountsAndRebates>

         aTipo = "D";  |BUCLE gecom006;

         aClv = "03010601180200000000";   |HAZ LeeClave;  ||</DiscountsAndRebates>
     |FINSI;

     #gecom006#0 = #gecom005#0;
     #gecom006#1 = #gecom005#1;
     #gecom006#2 = #gecom005#2;
     #gecom006#3 = "C";
     #gecom006#4 = 1;
     |LEE 000#gecom006.];
     |SI FSalida = 0;  |Y #gecom006#0 = #gecom005#0;
                       |Y #gecom006#1 = #gecom005#1;
                       |Y #gecom006#2 = #gecom005#2;
                       |Y #gecom006#3 = "C";
         aClv = "03010601190000000000";   |HAZ LeeClave;  ||<Charges>

         aTipo = "C";  |BUCLE gecom006;

         aClv = "03010601190200000000";   |HAZ LeeClave;  ||</Charges>
     |FINSI;

     aClv = "03010601200000000000";   |HAZ LeeClave;  ||<GrossAmount>

     #gecom008#0 = #gecom005#0;
     #gecom008#1 = #gecom005#1;
     #gecom008#2 = #gecom005#2;
     #gecom008#3 = 1;
     |LEE 000#gecom008.];
     |SI FSalida = 0;  |Y #gecom008#0 = #gecom005#0;
                       |Y #gecom008#1 = #gecom005#1;
                       |Y #gecom008#2 = #gecom005#2;
         aClv = "03010601210000000000";   |HAZ LeeClave;  ||<TaxesWithheld>

         |BUCLE gecom008;

         aClv = "03010601210200000000";   |HAZ LeeClave;  ||</TaxesWithheld>
     |FINSI;

     #gecom007#0 = #gecom005#0;
     #gecom007#1 = #gecom005#1;
     #gecom007#2 = #gecom005#2;
     #gecom007#3 = 1;
     |LEE 000#gecom007.];
     |SI FSalida = 0;  |Y #gecom007#0 = #gecom005#0;
                       |Y #gecom007#1 = #gecom005#1;
                       |Y #gecom007#2 = #gecom005#2;
         aClv = "03010601220000000000";   |HAZ LeeClave;  ||<TaxesOutputs>

         |BUCLE gecom007;

         aClv = "03010601220200000000";   |HAZ LeeClave;  ||</TaxesOutputs>
     |FINSI;

     aContenido = #gecom005#12;
     aContenido = aContenido + #gecom005#13;
     aContenido = aContenido + #gecom005#14;
     aContenido = aContenido + #gecom005#15;
     aContenido = aContenido + #gecom005#16;
     aContenido = aContenido + #gecom005#17;
     aContenido = aContenido + #gecom005#18;
     aContenido = aContenido + #gecom005#19;
     aContenido = aContenido + #gecom005#20;
     aContenido = aContenido + #gecom005#21;
     |SI aContenido ! "";
         aClv = "03010601250000000000";   |HAZ LeeClave;  ||<AdditionalLineItemInformation>
     |FINSI;

     nOk = 0;
     aAlfa = #gecom005#39;  |HAZ MiraContenido;
     aAlfa = #gecom005#40;  |HAZ MiraContenido;

     |SI nOk = 1;
         aClv = "03010601260000000000";   |HAZ LeeClave;  ||<SpecialTaxableEvent>
         aClv = "03010601260100000000";   |HAZ LeeClave;  ||<SpecialTaxableEventCode>
         aClv = "03010601260200000000";   |HAZ LeeClave;  ||<SpecialTaxableEventReason>
         aClv = "03010601260300000000";   |HAZ LeeClave;  ||</SpecialTaxableEvent>
     |FINSI;

     aClv = "03010601270000000000";   |HAZ LeeClave;  ||<ArticleCode>

     aClv = "03010601290000000000";   |HAZ LeeClave;  ||</InvoiceLine>
|FPRC;

|DEFBUCLE gecom005;
     #gecom005#1;
     ;
     #gecom002#0, #gecom002#1, 0000;
     #gecom002#0, #gecom002#1, 9999;
     ;
     NULL, gecom005;
|FIN;

|PROCESO Eti_3_1_6;          || Items (detalle)
     aClv = "03010600000000000000";   |HAZ LeeClave;  ||<Items>

     |BUCLE gecom005;

     aClv = "03010602000000000000";   |HAZ LeeClave;  ||</Items>
|FPRC;

|PROCESO Eti_3_1_7;          || Datos de pago
     |SI #gecom003#77 = 0;  |ACABA;  |FINSI;

     |ABRE #gecom059;  |SELECT #2#gecom059;
     #gecom059#1 = #gecom003#76;
     |LEE 000#gecom059.=;
     |SI FSalida ! 0;  |DDEFECTO #gecom059;  |FINSI;
     |CIERRA #gecom059;


     aClv = "03010700000000000000";   |HAZ LeeClave;  ||<PaymentDetails>

     aClv = "03010701000000000000";   |HAZ LeeClave;  ||<Installment>

     aClv = "03010701010000000000";   |HAZ LeeClave;  ||<InstallmentDueDate>
     aClv = "03010701020000000000";   |HAZ LeeClave;  ||<InstallmentAmount>

     aContenido = #gecom059#0;
     aClv = "03010701030000000000";   |HAZ LeeClave;  ||<PaymentMeans>

     nOk = 0;
     aAlfa = #gecom003#87;  |HAZ MiraContenido;
     aAlfa = #gecom003#88;  |HAZ MiraContenido;
     aAlfa = #gecom003#89;  |HAZ MiraContenido;
     aAlfa = #gecom003#90;  |HAZ MiraContenido;
     aAlfa = #gecom003#91;  |HAZ MiraContenido;
     aAlfa = #gecom003#92;  |HAZ MiraContenido;
     aAlfa = #gecom003#93;  |HAZ MiraContenido;
     aAlfa = #gecom003#94;  |HAZ MiraContenido;
     aAlfa = #gecom003#95;  |HAZ MiraContenido;

     |SI nOk = 1;
         aClv = "03010701040000000000";   |HAZ LeeClave;  ||<AccountToBeCredited>
         aClv = "03010701040101000000";   |HAZ LeeClave;  ||<IBAN>
         aClv = "03010701040200000000";   |HAZ LeeClave;  ||<BankCode>
         aClv = "03010701040300000000";   |HAZ LeeClave;  ||<BranchCode>

         |SI #gecom003#94 = "ESP";
             nOk = 0;
             aAlfa = #gecom003#90;  |HAZ MiraContenido;
             aAlfa = #gecom003#91;  |HAZ MiraContenido;
             aAlfa = #gecom003#92;  |HAZ MiraContenido;
             aAlfa = #gecom003#93;  |HAZ MiraContenido;
             aAlfa = #gecom003#94;  |HAZ MiraContenido;

             |SI nOk = 1;
                 aClv = "03010701040401000000";   |HAZ LeeClave;  ||<AddressInSpain>
                 aClv = "03010701040401010000";   |HAZ LeeClave;  ||<Address>
                 aClv = "03010701040401020000";   |HAZ LeeClave;  ||<PostCode>
                 aClv = "03010701040401030000";   |HAZ LeeClave;  ||<Town>
                 aClv = "03010701040401040000";   |HAZ LeeClave;  ||<Province>
                 aClv = "03010701040401050000";   |HAZ LeeClave;  ||<CountryCode>
                 aClv = "03010701040401060000";   |HAZ LeeClave;  ||</AddressInSpain>
             |FINSI;
         |FINSI;

         |SI #gecom003#94 ! "ESP";
             nOk = 0;
             aAlfa = #gecom003#90;  |HAZ MiraContenido;
             aAlfa = #gecom003#91;  |HAZ MiraContenido;
             aAlfa = #gecom003#92;  |HAZ MiraContenido;
             aAlfa = #gecom003#93;  |HAZ MiraContenido;
             aAlfa = #gecom003#94;  |HAZ MiraContenido;

             |SI nOk = 1;
                 aClv = "03010701040402000000";   |HAZ LeeClave;  ||<OverseasBranchAddress>
                 aClv = "03010701040402010000";   |HAZ LeeClave;  ||<Address>

                 aContenido = #gecom003#91;  |QBF aContenido;
                 aContenido = aContenido + " " + #gecom003#92;
                 aClv = "03010701040402020000";   |HAZ LeeClave;  ||<PostCodeAndTown>

                 aClv = "03010701040402030000";   |HAZ LeeClave;  ||<Province>
                 aClv = "03010701040402040000";   |HAZ LeeClave;  ||<CountryCode>
                 aClv = "03010701040402050000";   |HAZ LeeClave;  ||</OverseasAddress>
            |FINSI;
         |FINSI;

         aClv = "03010701040600000000";   |HAZ LeeClave;  ||</AccountToBeCredited>
     |FINSI;

     aClv = "03010701050000000000";   |HAZ LeeClave;  ||<PaymentReconciliationReference>

     nOk = 0;
     aAlfa = #gecom003#78;  |HAZ MiraContenido;
     aAlfa = #gecom003#79;  |HAZ MiraContenido;
     aAlfa = #gecom003#80;  |HAZ MiraContenido;
     aAlfa = #gecom003#81;  |HAZ MiraContenido;
     aAlfa = #gecom003#82;  |HAZ MiraContenido;
     aAlfa = #gecom003#83;  |HAZ MiraContenido;
     aAlfa = #gecom003#84;  |HAZ MiraContenido;
     aAlfa = #gecom003#85;  |HAZ MiraContenido;
     aAlfa = #gecom003#86;  |HAZ MiraContenido;

     |SI nOk = 1;
         aClv = "03010701060000000000";   |HAZ LeeClave;  ||<AccountToBeDebited>
         aClv = "03010701060101000000";   |HAZ LeeClave;  ||<IBAN>
         aClv = "03010701060200000000";   |HAZ LeeClave;  ||<BankCode>
         aClv = "03010701060300000000";   |HAZ LeeClave;  ||<BranchCode>

         |SI #gecom003#85 = "ESP";
             nOk = 0;
             aAlfa = #gecom003#81;  |HAZ MiraContenido;
             aAlfa = #gecom003#82;  |HAZ MiraContenido;
             aAlfa = #gecom003#83;  |HAZ MiraContenido;
             aAlfa = #gecom003#84;  |HAZ MiraContenido;
             aAlfa = #gecom003#85;  |HAZ MiraContenido;

             |SI nOk = 1;
                 aClv = "03010701060401000000";   |HAZ LeeClave;  ||<AddressInSpain>
                 aClv = "03010701060401010000";   |HAZ LeeClave;  ||<Address>
                 aClv = "03010701060401020000";   |HAZ LeeClave;  ||<PostCode>
                 aClv = "03010701060401030000";   |HAZ LeeClave;  ||<Town>
                 aClv = "03010701060401040000";   |HAZ LeeClave;  ||<Province>
                 aClv = "03010701060401050000";   |HAZ LeeClave;  ||<CountryCode>
                 aClv = "03010701060401060000";   |HAZ LeeClave;  ||</AddressInSpain>
             |FINSI;
         |FINSI;

         |SI #gecom003#85 ! "ESP";
             nOk = 0;
             aAlfa = #gecom003#81;  |HAZ MiraContenido;
             aAlfa = #gecom003#82;  |HAZ MiraContenido;
             aAlfa = #gecom003#83;  |HAZ MiraContenido;
             aAlfa = #gecom003#84;  |HAZ MiraContenido;
             aAlfa = #gecom003#85;  |HAZ MiraContenido;

             |SI nOk = 1;
                 aClv = "03010701060402000000";   |HAZ LeeClave;  ||<OverseasBranchAddress>
                 aClv = "03010701060402010000";   |HAZ LeeClave;  ||<Address>

                 aContenido = #gecom003#82;  |QBF aContenido;
                 aContenido = aContenido + " " + #gecom003#83;
                 aClv = "03010701060402020000";   |HAZ LeeClave;  ||<PostCodeAndTown>

                 aClv = "03010701060402030000";   |HAZ LeeClave;  ||<Province>
                 aClv = "03010701060402040000";   |HAZ LeeClave;  ||<CountryCode>
                 aClv = "03010701060402050000";   |HAZ LeeClave;  ||</OverseasAddress>
             |FINSI;
         |FINSI;

         aClv = "03010701060600000000";   |HAZ LeeClave;  ||</AccountToBeDebited>
     |FINSI;

     aClv = "03010701090000000000";   |HAZ LeeClave;  ||<DebitReconciliationReference>

     aClv = "03010701100000000000";   |HAZ LeeClave;  ||</Installment>

     aClv = "03010702000000000000";   |HAZ LeeClave;  ||<PaymentDetails>
|FPRC;

|PROCESO gecom013;
     aClv = "03010801000000000000";   |HAZ LeeClave;  ||<LegalReference>
|FPRC;

|DEFBUCLE gecom013;
     #gecom013#1;
     ;
     #gecom002#0, #gecom002#1, 001;
     #gecom002#0, #gecom002#1, 999;
     ;
     NULL, gecom013;
|FIN;

|PROCESO Eti_3_1_8;          || Literales legales
     #gecom013#0 = #gecom002#0;
     #gecom013#1 = #gecom002#1;
     #gecom013#2 = 1;
     |LEE 000#gecom013.];
     |SI FSalida ! 0;  |O #gecom013#0 ! #gecom002#0;
                       |O #gecom013#1 ! #gecom002#1;
         |ACABA;
     |FINSI;

     aClv = "03010800000000000000";   |HAZ LeeClave;  ||<LegalLiterals>

     |BUCLE gecom013;

     aClv = "03010802000000000000";   |HAZ LeeClave;  ||</LegalLiterals>
|FPRC;

|PROCESO gecom012;
     |SI nPasada = 0;
         nOk1 = 1;
         |ERROR10;
         |ACABA;
     |FINSI;

     aClv = "03010902010000000000";   |HAZ LeeClave;  ||<Attachment>

     aContenido = "NONE";
     aClv = "03010902010100000000";   |HAZ LeeClave;  ||<AttachmentCompressionAlgorithm>

     aContenido = #gecom012#3 < "";
     aClv = "03010902010200000000";   |HAZ LeeClave;  ||<AttachmentFormat>

     aContenido = "BASE64";
     aClv = "03010902010300000000";   |HAZ LeeClave;  ||<AttachmentEncoding>

     aClv = "03010902010400000000";   |HAZ LeeClave;  ||<AttachmentDescription>

     aFicB64  = (("00000" + #gecom012#0) % -105);
     aFicB64  = aFicB64 + #gecom012#1;  |QBF aFicB64;
     aFicB64  = aFicB64 + (("00" + #gecom012#2) % -102);
     aFicB64  = aFicB64 + ".b64";

     |PARA; |SI;  |HACIENDO;
          aFicB64 = aFicB64 - "/";
          |SI FSalida = 0;  |SAL;  |FINSI;
     |SIGUE;

     |PARA; |SI;  |HACIENDO;
          aFicB64 = aFicB64 - "\";
          |SI FSalida = 0;  |SAL;  |FINSI;
     |SIGUE;

     aFicB64  = eaPathAdj + aFicB64;

     aClv = "03010902010500000000";   |HAZ Attachment;

     aClv = "03010902010600000000";   |HAZ LeeClave;  ||</Attachment>
|FPRC;

|DEFBUCLE gecom012;
     #gecom012#1;
     5;
     #gecom002#0, #gecom002#1,  0, "S";
     #gecom002#0, #gecom002#1, 99, "S";
     ;
     NULL, gecom012;
|FIN;

|PROCESO MeteExtesionFACeB2B;
     #gecom004#0 = #gecom002#0;
     #gecom004#1 = #gecom002#1;
     #gecom004#2 = "R";
     #gecom004#3 = "";
     |LEE 000#gecom004.];
     |SI FSalida ! 0;                |ACABA;  |FINSI;
     |SI #gecom004#0 ! #gecom002#0;  |ACABA;  |FINSI;
     |SI #gecom004#1 ! #gecom002#1;  |ACABA;  |FINSI;
     |SI #gecom004#2 ! "R";          |ACABA;  |FINSI;

     aClv = "03010904000000000000";   |HAZ LeeClave;  ||<Extensions>

     aAlfa = (aTab * 5) + "<fb2b:FaceB2BExtension>" + aCarro;         |XGRABA nHandle, aAlfa;

     aAlfa = #gecom003#111 + #gecom003#112;  |QBT aAlfa;
     |SI aAlfa ! "";
         aAlfa = (aTab * 6) + "<publicSectorInformation>" + aCarro;   |XGRABA nHandle, aAlfa;

         eaAlfa = #gecom003#111;  |QBF eaAlfa;
         |SI eaAlfa ! "";
             |HAZ QuitaRaros;
             aAlfa = (aTab * 7) + "<publicOrganismCode>" + eaAlfa;
             aAlfa = aAlfa + "</publicOrganismCode>" + aCarro;  |XGRABA nHandle, aAlfa;
         |FINSI;

         eaAlfa = #gecom003#112;  |QBF eaAlfa;
         |SI eaAlfa ! "";
             |HAZ QuitaRaros;
             aAlfa = (aTab * 7) + "<contractReference>" + eaAlfa;
             aAlfa = aAlfa + "</contractReference>" + aCarro;  |XGRABA nHandle, aAlfa;
         |FINSI;

         aAlfa = (aTab * 6) + "</publicSectorInformation>" + aCarro;   |XGRABA nHandle, aAlfa;
     |FINSI;

     aAlfa = (aTab * 6) + "<mainSubcontractorCentres>" + aCarro;      |XGRABA nHandle, aAlfa;
     aAlfa = (aTab * 7) + "<receiverAdministrativeCentre>" + aCarro;  |XGRABA nHandle, aAlfa;

     eaAlfa = #gecom004#27;  |HAZ QuitaRaros;
     aAlfa = (aTab * 8) + "<code>" + eaAlfa + "</code>" + aCarro;     |XGRABA nHandle, aAlfa;

     eaAlfa = #gecom004#6;  |HAZ QuitaRaros;
     aAlfa = (aTab * 8) + "<name>" + eaAlfa + "</name>" + aCarro;     |XGRABA nHandle, aAlfa;

     aAlfa = (aTab * 7) + "</receiverAdministrativeCentre>" + aCarro; |XGRABA nHandle, aAlfa;
     aAlfa = (aTab * 6) + "</mainSubcontractorCentres>" + aCarro;     |XGRABA nHandle, aAlfa;
     aAlfa = (aTab * 5) + "</fb2b:FaceB2BExtension>" + aCarro;        |XGRABA nHandle, aAlfa;

     aClv = "03010904020000000000";   |HAZ LeeClave;  ||</Extensions>
|FPRC;

|PROCESO Eti_3_1_9;          || Datos adicionales
     nOk1 = 0;
     nPasada = 0;  |BUCLE gecom012;

     nOk2 = 0;
     |PARA nCmp = 113;  |SI nCmp [ 122;  |HACIENDO nCmp = nCmp + 1;
           aAlfa = #gecom003#nCmp#;  |QBF aAlfa;
           |SI aAlfa ! "";
               nOk2 = 1;
               |SAL;
           |FINSI;
     |SIGUE;

     |SI nOk1 = 0;  |Y nOk2 = 0;  |Y #gecom003#110 ! "FACeB2B                       ";
         |ACABA;
     |FINSI;

     aClv = "03010900000000000000";   |HAZ LeeClave;  ||<AdditionalData>

     |SI nOk1 ! 0;
         aClv = "03010902000000000000";   |HAZ LeeClave;  ||<RelatedDocuments>

         nPasada = 1;  |BUCLE gecom012;

         aClv = "03010902020000000000";   |HAZ LeeClave;  ||</RelatedDocuments>
     |FINSI;

     |SI nOk2 ! 0;
         aClv = "03010903000000000000";   |HAZ GrabaComentario;  ||<InvoiceAdditionalInformation>
     |FINSI;

     |SI #gecom003#110 = "FACeB2B                       ";
         |HAZ MeteExtesionFACeB2B;
     |FINSI;

     aClv = "03010905000000000000";   |HAZ LeeClave;  ||</AdditionalData>
|FPRC;

|PROCESO Invoices;
     aDEtiq = "<Invoices>";
     aHEtiq = "<Invoices>";
     |HAZ LeeEtiqueta;

     aDEtiq = "<Invoice>";
     aHEtiq = "<Invoice>";
     |HAZ LeeEtiqueta;

     |HAZ Eti_3_1_1;    || Cabecera factura
     |HAZ Eti_3_1_2;    || Datos emision de la factura
     |HAZ Eti_3_1_3;    || Impuestos repercutidos
     |HAZ Eti_3_1_4;    || Impuestos retenidos
     |HAZ Eti_3_1_5;    || Totales de factura
     |HAZ Eti_3_1_6;    || Items (detalle)
     |HAZ Eti_3_1_7;    || Datos de pago
     |HAZ Eti_3_1_8;    || Literales legales
     |HAZ Eti_3_1_9;    || Datos adicionales

     aDEtiq = "</Invoice>";
     aHEtiq = "</Invoice>";
     |HAZ LeeEtiqueta;

     aDEtiq = "</Invoices>";
     aHEtiq = "</Invoices>";
     |HAZ LeeEtiqueta;
|FPRC;

|PROCESO Factura;
     |HAZ FileHeader;
     |HAZ Parties;
     |HAZ Invoices;
|FPRC;

|PROCESO PieXml;
     aAlfa = "</fe:Facturae>";
     |HAZ GrabaFic;
|FPRC;

|PROCESO Ficheros;
     |HORA aHora;

/*
     eaFicXml = ("00000" + #gecom002#0) % -105;
     eaFicXml = eaFicXml +  #gecom002#1;               |QBF eaFicXml;
     eaFicXml = eaFicXml + ".xml";
     aAlfa = eaFicXml;  |HAZ QuitaRaros;  eaFicXml = aAlfa;

     |PARA; |SI;  |HACIENDO;
          eaFicXml = eaFicXml - "/";
          |SI FSalida = 0;  |SAL;  |FINSI;
     |SIGUE;

     |PARA; |SI;  |HACIENDO;
          eaFicXml = eaFicXml - "\";
          |SI FSalida = 0;  |SAL;  |FINSI;
     |SIGUE;
*/

     eaFicXml = fFechaSys % -104;
     eaFicXml = eaFicXml + (fFechaSys % 402);
     eaFicXml = eaFicXml + (fFechaSys % 102);
     eaFicXml = eaFicXml + (aHora % 102);
     eaFicXml = eaFicXml + (aHora % 402);
     eaFicXml = eaFicXml + (aHora % 702);
     eaFicXml = eaFicXml + ".xml";

     |SI PARAMETRO ! "ENVIO";
         aAbreXml = aPathTmp + eaFicXml;
     |SINO;
         aAbreXml = aPathEnv + eaFicXml;
     |FINSI;

     |XABRE "WB", aAbreXml, nHandle;

     |HAZ CabXml;
     |HAZ Factura;
     |HAZ PieXml;

     |XCIERRA nHandle;
|FPRC;

|PROGRAMA;
     #gecom002#0 = enEmp;
     #gecom002#1 = eaIde;
     |LEE 000#gecom002.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |SI #gecom002#6 = "     ";
         |ABRE #gecom500;
         |LEE 000#gecom500.u;
         |SI FSalida ! 0;  |DDEFECTO #gecom500;  |FINSI;
         |CIERRA #gecom500;

         #gecom002#6 = #gecom500#0;

         |GRABA 000#gecom002.a;
     |FINSI;

     |SI PARAMETRO = "ENVIO";
         aAlfa = #gecom002#18;  |QBF aAlfa;
         |SI aAlfa ! "";
             aAlfa = aPathEnv + aAlfa;
             |FBORRA aAlfa;
         |FINSI;
     |FINSI;

     #gecom003#0 = enEmp;
     #gecom003#1 = eaIde;
     |LEE 000#gecom003.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |HAZ AbreVtn;
     |HAZ Ficheros;
     |HAZ CierraVtn;

     |SI PARAMETRO ! "ENVIO";
         |HAZ VerDoc;
     |FINSI;
|FPRO;

|PROCESO T80;  |TIPO 80;
     nConsola   = 1;

     |SI PARAMETRO ! "";
         nConsola = 0;
     |FINSI;

     aCarro    = &13 + &10;
     aTab      = &9;

     aModoImp  = PARAMETRO;  |QBF aModoImp;
     fFechaSys = ~;

     |HAZ LeeUnidadBasico;
     |HAZ CargaColores;

     |ABRE #gecom001;
     |SELECT #1#gecom001;
     #gecom001#0 = enEmp;
     |LEE 000#gecom001.=;
     |SI FSalida ! 0;  |DDEFECTO #gecom001;  |FINSI;
     |CIERRA #gecom001;

     aIP  = "";
     |IP_REMOTO aIP;

     |DBASE aBaseGECO;  |QBF aBaseGECO;
     aPathTmp = aBaseGECO + "tmp";                    |MKDIR aPathTmp;
     aPathTmp = aBaseGECO + "tmp/" + Usuario;         |MKDIR aPathTmp;
     aPathTmp = aBaseGECO + "tmp/" + Usuario + "/";

     aPathPlu      = aBaseGECO + "plugins/";

     aPathEnv      = aBaseGECO + "xface/envios";                   |MKDIR aPathEnv;
     aPathEnv      = aPathEnv + "/" + (("00000" + enEmp) % -105);  |MKDIR aPathEnv;
     aPathEnv      = aPathEnv + "/";

     aPathTmpLocal = eaUnidadBasico + "\documentos";      |RMKDIR aPathTmpLocal;
     aPathTmpLocal = aPathTmpLocal + "\gecobase";         |RMKDIR aPathTmpLocal;
     aPathTmpLocal = aPathTmpLocal + "\";

     aAlfa = aPathTmp + "*.xml";
     |_PDIR aAlfa;
     |PARA;  |SI FSalida = 0;  |HACIENDO;
          |FBORRA aAlfa;

          |_SDIR aAlfa;
     |SIGUE;

     aAlfa = aPathTmpLocal + "*.*";
     |R_PDIR aAlfa;
     |PARA;  |SI FSalida = 0;  |HACIENDO;
          aExt = aAlfa % -103;
          |SI aExt = "res";  |O aExt = "xml";  |O aExt = "bat";
              |RFBORRA aAlfa;
          |FINSI;

          |R_SDIR aAlfa;
     |SIGUE;

     |DBASE aBase;
     eaPathAdj = aBase + "documentos";                         |MKDIR eaPathAdj;
     eaPathAdj = eaPathAdj + "/adjuntos";                      |MKDIR eaPathAdj;
     eaPathAdj = eaPathAdj + "/" + (("00000" + enEmp) % -105); |MKDIR eaPathAdj;
     eaPathAdj = eaPathAdj + "/";

     eaPathPlu = aBase + "plugins/";

     |HAZ VersionPython;

     |ABRET #gecom002;
     |ABRET #gecom003;
     |ABRET #gecom004;
     |ABRET #gecom005;
     |ABRET #gecom006;
     |ABRET #gecom007;
     |ABRET #gecom008;
     |ABRET #gecom009;
     |ABRET #gecom012;
     |ABRET #gecom013;
     |ABRET #gecom501;
|FPRC;

|PROCESO T90;  |TIPO 90;
     |CIERRAT #gecom002;
     |CIERRAT #gecom003;
     |CIERRAT #gecom004;
     |CIERRAT #gecom005;
     |CIERRAT #gecom006;
     |CIERRAT #gecom007;
     |CIERRAT #gecom008;
     |CIERRAT #gecom009;
     |CIERRAT #gecom012;
     |CIERRAT #gecom013;
     |CIERRAT #gecom501;
|FPRC;
