|FICHEROS;
     gecom000;
     gecom002;
     gecom014;
|FIN;

|VARIABLES;
     nHandle             = 0;
     nIni                = 0;
     nLong               = 0;
     nVoy                = 0;
     nSaca               = 0;

     aServ               = "";
     aAlfa               = "";
     aCadena             = "";
     aCR                 = "";
     aLF                 = "";
     aBase               = "";
     aFic                = "";
     aPathSII            = "";
     aAbre               = "";
     aFicTmp             = "";
     aSystema            = "";
     aLee                = "";
     aVersion            = "";
     aLong               = "";
     aLetra              = "";
     aQS                 = "";
     aIP                 = "";
     aHora               = "";
     aDes                = "";
     aDato               = "";
     aPath               = "";
     aTab                = "";

 {-1}aSerie              = "";

     &enAprobacion       = "";
     &eaPrograma         = "";
     &eaUnidadBasico     = "";
     &eaPython           = "";
     &eaUrlSB            = "";
     &eaUrlAP            = "";
     &eaIni              = "";
     &enErrorPy          = 0;
     &eaMensaPy          = "";
     &eaNomFic           = "";
     &eaCmp0             = "";
     &eaCmp1             = "";
     &eaCmp4             = "";
     &eaCmp5             = "";
     &eaCmp7             = "";
     &eaCmp8             = "";
     &eaCmp9             = "";
     &eaCmp10            = "";
|FIN;

|PROCESO VersionPython;
     |ABRE #gecom000;
     |LEE 000#gecom000.p;
     |SI FSalida ! 0;  |DDEFECTO #gecom000;  |FINSI;
     |CIERRA #gecom000;

     eaPython  = #gecom000#1;  |QBF eaPython;

     |DBASE aBase;
     aFicTmp  = aBase + "peticiones_api.log";

     aSystema = eaPython + " --version 2> " + aFicTmp;
     |SYSTEM aSystema;

     enErrorPy = 0;
     eaMensaPy = "";

     |XABRE "E", aFicTmp, 0;
     |SI FSalida < 0;
         enErrorPy = 1;
         eaMensaPy = "Módulo python de sistema no encontrado";
     |SINO;
         |XABRE "", aFicTmp, nHandle;
         |XLEE nHandle, 255, aLee;
         |XCIERRA nHandle;

         aVersion = aLee - "Python ";  |QBT aVersion;
         |SI aVersion < "2.7.10";
             ||enErrorPy = 1;
             eaMensaPy = "Se requiere Python 2.7.10 (instalada " + aVersion + ")";
         |FINSI;
     |FINSI;

     |SI enErrorPy = 1;
         |XABRE "W", aFicTmp, nHandle;
         |XGRABA nHandle, eaMensaPy;
         |XCIERRA nHandle;
     |FINSI;
|FPRC;

|PROCESO GrabaLog;
     |HORA aHora;

     |ABRE #gecom014;

     |DDEFECTO #gecom014;
     #gecom014#0  = eaCmp0;
     #gecom014#1  = eaCmp1;
     #gecom014#2  = ~;
     #gecom014#3  = aHora;
     #gecom014#4  = eaCmp4;
     #gecom014#5  = eaCmp5;
     #gecom014#7  = eaCmp7;
     #gecom014#8  = eaCmp8;
     #gecom014#9  = eaCmp9;
     #gecom014#10 = eaCmp10;

     |SI #gecom014#5 = "P ";  #gecom014#6  = "PENDIENTE ENVIO";  |FINSI;
     |SI #gecom014#5 = "RP";  #gecom014#6  = "PENDIENTE ENVIO";  |FINSI;

     |SI #gecom014#5 = "X ";  #gecom014#6  = "RECHAZADA";        |FINSI;
     |SI #gecom014#5 = "RX";  #gecom014#6  = "RECHAZADA";        |FINSI;

     |SI #gecom014#5 = "E ";  #gecom014#6  = "ENVIADA";          |FINSI;
     |SI #gecom014#5 = "EX";  #gecom014#6  = "ENVIADA";          |FINSI;

     |SI #gecom014#5 = "R ";  #gecom014#6  = "RECIBIDA";         |FINSI;
     |SI #gecom014#5 = "RX";  #gecom014#6  = "RECIBIDA";         |FINSI;

     |SI #gecom014#5 = "A ";  #gecom014#6  = "ANULADA";          |FINSI;
     |SI #gecom014#5 = "RA";  #gecom014#6  = "ANULADA";          |FINSI;

     |GRABA 020#gecom014.n;
     |LIBERA #gecom014;

     |CIERRA #gecom014;
|FPRC;

|PROCESO GrabaResultado;
     |DFICE aPath;
     aDes = aPath + eaNomFic + ".sal";
     |XABRE "WB", aDes, nHandle;
     |SI FSalida < 0;
         |ACABA;
     |FINSI;

     |ABRE #gecom014;
     #gecom014#0 = #gecom002#0;
     #gecom014#1 = #gecom002#1;
     #gecom014#2 = "31.12.9999";
     #gecom014#3 = "zzzzzzzz";
     |LEE 000#gecom014.];
     |SI FSalida = 0;
         |LEE 000#gecom014.a;
     |SINO;
         |LEE 000#gecom014.u;
     |FINSI;
     |SI FSalida ! 0;  |O  #gecom014#0 ! #gecom002#0;
                       |O  #gecom014#1 ! #gecom002#1;
         |DDEFECTO #gecom014;
     |FINSI;
     |CIERRA #gecom014;

     aTab  = &9;

     aDato = "empresa" + aTab;             |XGRABA nHandle, aDato;
     aDato = "identificador" + aTab;       |XGRABA nHandle, aDato;
     aDato = "id_estado" + aTab;           |XGRABA nHandle, aDato;
     aDato = "estado" + aTab;              |XGRABA nHandle, aDato;
     aDato = "id_situacion" + aTab;        |XGRABA nHandle, aDato;
     aDato = "situacion" + aTab;           |XGRABA nHandle, aDato;
     aDato = "respuesta" + aTab;           |XGRABA nHandle, aDato;
     aDato = &13 + &10;                    |XGRABA nHandle, aDato;

     aAlfa = #gecom002#0; |QBF aAlfa;
     aDato = aAlfa + aTab;                 |XGRABA nHandle, aDato;
     aAlfa = #gecom002#1; |QBF aAlfa;
     aDato = aAlfa + aTab;                 |XGRABA nHandle, aDato;
     aAlfa = #gecom014#5;  |QBF aAlfa;
     aDato = aAlfa + aTab;                 |XGRABA nHandle, aDato;
     aAlfa = #gecom014#6;  |QBF aAlfa;
     aDato = aAlfa + aTab;                 |XGRABA nHandle, aDato;
     aAlfa = #gecom014#8;  |QBF aAlfa;
     aDato = aAlfa + aTab;                 |XGRABA nHandle, aDato;
     aAlfa = #gecom014#9;  |QBF aAlfa;
     aDato = aAlfa + aTab;                 |XGRABA nHandle, aDato;
     aAlfa = #gecom014#7;  |QBF aAlfa;
     aDato = aAlfa + aTab;                 |XGRABA nHandle, aDato;
     aDato = &13 + &10;                    |XGRABA nHandle, aDato;

     |XCIERRA nHandle;
|FPRC;
