|FICHEROS;
     gecom500;
     gecom501;

     gecow100;
|FIN;

|VARIABLES;
     n0Vent              = 0;
     n1Vent              = 0;
     nGrid500            = -1;
     nRango              = 0;
     nHandle             = 0;
     nPnt1               = 0;
     nPnt2               = 0;
     nCmp                = 0;
     nIdSalir            = 0;
     nHand1              = 0;
     nHand2              = 0;
     nLong               = 0;
     nCar                = 0;
     nPos                = 0;
     nInd                = 0;
     nCaracter           = 0;

     aEsc1               = "";
     aEsc2               = "";
     aRetu               = "";
     aTecla              = "";
     aAlfa               = "";
     aBase               = "";
     aPath               = "";
     aFic                = "";
     aAbre               = "";
     aContenido          = "";
     aVer                = "";
     aCampoA             = "";
     aCampoB             = "";
     aCampoC             = "";
     aCampoD             = "";
     aCampoE             = "";
     aCampoF             = "";
     aCampoG             = "";
     aCampoH             = "";
     aCampoI             = "";
     aCampoJ             = "";
     aCampoK             = "";
     aCampoL             = "";
     aCod1               = "";
     aCod2               = "";
     aCod3               = "";
     aCod4               = "";
     aCod5               = "";
     aCod6               = "";
     aCod7               = "";
     aCod8               = "";
     aCod9               = "";
     aCod10              = "";
     aLong               = "";
     aAlfa1              = "";
     aAlfa2              = "";
     aCar                = "";
     aCadena             = "";
     aCarac1             = "";
     aTab                = "";

     {2}nNivel           = 0;

     {-1}sTree           = 0;
     sT_nID              = 0;
     sT_nOper            = 0;
     sT_aData            = "";

     {-1}aVent           = "";
         aVent1          = 0;
         aVent2          = 0;
         aVent3          = 0;
         aVent4          = 0;
         aVent5          = "";

     &enBtnAlt           = 0;
     &enBtnMod           = 0;
     &enBtnEsq           = 0;
     &eaVer              = "";
|FIN;

|PROCESO EntraDatos;
     |DDEFECTO #gecow100;

     |PARA nCmp = 0;  |SI nCmp [ 21;  |HACIENDO nCmp = nCmp + 1;
           #gecow100#nCmp# = #gecom500#nCmp#;
     |SIGUE;

     |PINTA #gecow100#0;
     |PINTA #gecow100#1;
     |PINTA #gecow100#2;

     |PULSATECLA;
     |ENDATOS #1#gecow100;
|FPRC;

|PROCESO gecom501;
     #gecom501#0 = #gecom500#2;
     |GRABA 000#gecom501.n;
|FPRC;

|DEFBUCLE gecom501;
     #gecom501#1;
     ;
     aVer, 00, 00, 00, 00, 00, 00, 00, 00, 00, 00;
     aVer, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99;
     ;
     NULL, gecom501;
|FIN;

|PROCESO BtnAlt;
     |VENTANA 0501, 3085, -1, 16, "Nueva versi¢n";
     n1Vent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |DDEFECTO #gecom500;

     |C_M #gecow100#0, 1, "S";

     |HAZ EntraDatos;
     |SI FSalida = 0;
         |LEE 000#gecom500.u;
         aVer = #gecom500#0;

         |DDEFECTO #gecom500;
         |PARA nCmp = 0;  |SI nCmp [ 21;  |HACIENDO nCmp = nCmp + 1;
               #gecom500#nCmp# = #gecow100#nCmp#;
         |SIGUE;

         |GRABA 020#gecom500.n;
         |LIBERA #gecom500;

         |BUCLE gecom501;
     |FINSI;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA n1Vent;

     |REFRESCACONTROL nGrid500;
     |FOCOTECLADO nGrid500;
|FPRC;

|PROCESO BtnMod;
     |VENTANA 0501, 3085, -1, 16, "Modificaci¢n";
     n1Vent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |LEE 101#gecom500.=;

     |C_M #gecow100#0, 1, "N";

     |HAZ EntraDatos;
     |SI FSalida = 0;
         |PARA nCmp = 0;  |SI nCmp [ 21;  |HACIENDO nCmp = nCmp + 1;
               #gecom500#nCmp# = #gecow100#nCmp#;
         |SIGUE;

         |GRABA 020#gecom500.a;
         |LIBERA #gecom500;
     |FINSI;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA n1Vent;

     |REFRESCACONTROL nGrid500;
     |FOCOTECLADO nGrid500;
|FPRC;

|PROCESO Esquema;
     eaVer = #gecom500#0;

     |SUB_EJECUTA "gecoz501";
|FPRC;

|PROCESO Baja501;
     #gecom501#0  = #gecom500#0;
     #gecom501#1  = 00;
     #gecom501#1  = 00;
     #gecom501#1  = 00;
     #gecom501#1  = 00;
     #gecom501#1  = 00;
     #gecom501#1  = 00;
     #gecom501#1  = 00;
     #gecom501#1  = 00;
     #gecom501#1  = 00;
     #gecom501#1  = 00;
|FPRC;

|PROCESO Alta501;
     #gecom501#0  = #gecom500#0;
     #gecom501#1  = 99;
     #gecom501#1  = 99;
     #gecom501#1  = 99;
     #gecom501#1  = 99;
     #gecom501#1  = 99;
     #gecom501#1  = 99;
     #gecom501#1  = 99;
     #gecom501#1  = 99;
     #gecom501#1  = 99;
     #gecom501#1  = 99;
|FPRC;

|PROCESO Grid;
     |ABRE #gecom501;
     |CONSULTA_F_CLAVE #1#gecom501, Baja501, Alta501;
     |CIERRA #gecom501;
|FPRC;


|PROCESO Evnt500;
     |SI FSalida = 1;  |O FSalida = 2;
         |LEE 000#gecom500.=;

         |ESTADO_CONTROL enBtnMod, "ENABLE";
         |ESTADO_CONTROL enBtnEsq, "ENABLE";
     |FINSI;

     |SI FSalida = 4;
         |HAZ Esquema;
     |FINSI;
|FPRC;

|PROGRAMA;
     |VENTANA 0501, 2899, -1, 16, "Bandeja de versiones";
     n0Vent = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{193}}Alta ", 2688, 2698, BtnAlt;
     enBtnAlt = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{197}}Modificar ", 2676, 2686, BtnMod;
     enBtnMod = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{197}}Esquema", 2664, 2674, Esquema;
     enBtnEsq = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{197}}Ver en grid", 2602, 2615, Grid;

     |ESTADO_CONTROL enBtnMod, "DISABLE";
     |ESTADO_CONTROL enBtnEsq, "DISABLE";

     nRango    = 4 + 8 + 16 + 32 + 128;

     |LINEAL_SIMPLE #1#gecom500, nRango, 0602, 2598, NULL, NULL, Evnt500;
     nGrid500 = FSalida;

     aEsc1  = &255 + "806";
     aEsc2  = &255 + "807";
     aRetu  = &255 + "802";
     |PARA; |SI;  |HACIENDO;
         FSalida = "::{{001}}Salir," + nGrid500;
         |LEETECLA aTecla;
         |SI aTecla = aEsc1; |SAL;  |FINSI;
         |SI aTecla = aEsc2; |SAL;  |FINSI;
         |SI aTecla = aRetu; |SAL;  |FINSI;
     |SIGUE;

     |FINVENTANA n0Vent;

     |PULSATECLA;
|FPRO;

/*
|PROCESO SacaCod;
     aCod1  = "";
     aCod2  = "";
     aCod3  = "";
     aCod4  = "";
     aCod5  = "";
     aCod6  = "";
     aCod7  = "";
     aCod8  = "";
     aCod9  = "";
     aCod10 = "";

     nInd = 1;
     aLong = aAlfa1 % 0;
     nLong = aLong;
     |PARA nCar = 1;  |SI nCar [ nLong;  |HACIENDO nCar = nCar + 1;
           nPos = (nCar * 100) + 1;
           aCar = aAlfa1 % nPos;
           |SI aCar ! ".";
               |SI nInd = 1;   aCod1  = aCod1  + aCar;  |FINSI;
               |SI nInd = 2;   aCod2  = aCod2  + aCar;  |FINSI;
               |SI nInd = 3;   aCod3  = aCod3  + aCar;  |FINSI;
               |SI nInd = 4;   aCod4  = aCod4  + aCar;  |FINSI;
               |SI nInd = 5;   aCod5  = aCod5  + aCar;  |FINSI;
               |SI nInd = 6;   aCod6  = aCod6  + aCar;  |FINSI;
               |SI nInd = 7;   aCod7  = aCod7  + aCar;  |FINSI;
               |SI nInd = 8;   aCod8  = aCod8  + aCar;  |FINSI;
               |SI nInd = 9;   aCod9  = aCod9  + aCar;  |FINSI;
               |SI nInd = 10;  aCod10 = aCod10 + aCar;  |FINSI;
           |SINO;
               nInd = nInd + 1;
           |FINSI;
     |SIGUE;

     |SI aCod1  = "";  aCod1  = "0";  |FINSI;
     |SI aCod2  = "";  aCod2  = "0";  |FINSI;
     |SI aCod3  = "";  aCod3  = "0";  |FINSI;
     |SI aCod4  = "";  aCod4  = "0";  |FINSI;
     |SI aCod5  = "";  aCod5  = "0";  |FINSI;
     |SI aCod6  = "";  aCod6  = "0";  |FINSI;
     |SI aCod7  = "";  aCod7  = "0";  |FINSI;
     |SI aCod8  = "";  aCod8  = "0";  |FINSI;
     |SI aCod9  = "";  aCod9  = "0";  |FINSI;
     |SI aCod10 = "";  aCod10 = "0";  |FINSI;
|FPRC;

|PROCESO BuscaPrimerCero;
     |SI aCampoB = "0";  aCampoB = "99";  |ACABA;  |FINSI;
     |SI aCampoC = "0";  aCampoC = "99";  |ACABA;  |FINSI;
     |SI aCampoD = "0";  aCampoD = "99";  |ACABA;  |FINSI;
     |SI aCampoE = "0";  aCampoE = "99";  |ACABA;  |FINSI;
     |SI aCampoF = "0";  aCampoF = "99";  |ACABA;  |FINSI;
     |SI aCampoG = "0";  aCampoG = "99";  |ACABA;  |FINSI;
     |SI aCampoH = "0";  aCampoH = "99";  |ACABA;  |FINSI;
     |SI aCampoI = "0";  aCampoI = "99";  |ACABA;  |FINSI;
     |SI aCampoJ = "0";  aCampoJ = "99";  |ACABA;  |FINSI;
|FPRC;

|PROCESO GrabaReg;
     |QBF aCampoA;
     |QBF aCampoB;
     |QBF aCampoK;

     |SI aCampoA = "";  |ACABA;  |FINSI;

     |SI aCampoL = "1";
         |DDEFECTO #gecom501;
         #gecom501#0  = eaVer;
         #gecom501#1  = aCampoA;
         #gecom501#2  = aCampoB;
         #gecom501#3  = aCampoC;
         #gecom501#4  = aCampoD;
         #gecom501#5  = aCampoE;
         #gecom501#6  = aCampoF;
         #gecom501#7  = aCampoG;
         #gecom501#8  = aCampoH;
         #gecom501#9  = aCampoI;
         #gecom501#10 = aCampoJ;
         #gecom501#11 = aCampoL;
         #gecom501#12 = "<" + aCampoK + ">";
         #gecom501#13 = "";

         |GRABA 020#gecom501.n;
         |LIBERA #gecom501;

         |HAZ BuscaPrimerCero;

         |DDEFECTO #gecom501;
         #gecom501#0  = eaVer;
         #gecom501#1  = aCampoA;
         #gecom501#2  = aCampoB;
         #gecom501#3  = aCampoC;
         #gecom501#4  = aCampoD;
         #gecom501#5  = aCampoE;
         #gecom501#6  = aCampoF;
         #gecom501#7  = aCampoG;
         #gecom501#8  = aCampoH;
         #gecom501#9  = aCampoI;
         #gecom501#10 = aCampoJ;
         #gecom501#11 = aCampoL;
         #gecom501#12 = "</" + aCampoK + ">";
         #gecom501#13 = "";

         |GRABA 020#gecom501.n;
         |LIBERA #gecom501;
     |FINSI;

     |SI aCampoL = "2";
         |DDEFECTO #gecom501;
         #gecom501#0  = eaVer;
         #gecom501#1  = aCampoA;
         #gecom501#2  = aCampoB;
         #gecom501#3  = aCampoC;
         #gecom501#4  = aCampoD;
         #gecom501#5  = aCampoE;
         #gecom501#6  = aCampoF;
         #gecom501#7  = aCampoG;
         #gecom501#8  = aCampoH;
         #gecom501#9  = aCampoI;
         #gecom501#10 = aCampoJ;
         #gecom501#11 = aCampoL;
         #gecom501#12 = "<" + aCampoK + ">";
         #gecom501#13 = "</" + aCampoK + ">";

         |GRABA 020#gecom501.n;
         |LIBERA #gecom501;
     |FINSI;
|FPRC;

|PROCESO RecogeCSV;
     |DBASE aBase;

     aAbre = aBase + "patrones/esquemaxml.csv";
     |XABRE "", aAbre, nHandle;
     |PARA;  |SI FSalida ] 0;  |HACIENDO;
          |XLEE nHandle, 255, aAlfa;
          |SI FSalida < 0;  |SAL;  |FINSI;

          aCampoA  = "";
          aCampoB  = "";
          aCampoC  = "";
          aCampoD  = "";
          aCampoE  = "";
          aCampoF  = "";
          aCampoG  = "";
          aCampoH  = "";
          aCampoI  = "";
          aCampoJ  = "";
          aCampoK  = "";
          aCampoL  = "";

          aCadena = aAlfa;  |QBF aCadena;
          aLong   = aCadena % 0;
          nLong   = aLong;
          nCmp    = 1;
          aTab    = ";";

          |PARA nCaracter = 1;  |SI nCaracter [ nLong;  |HACIENDO nCaracter = nCaracter + 1;
                nPos    = (100 * nCaracter) + 1;
                aCarac1 = aCadena % nPos;
                |SI aCarac1 = aTab;
                    nCmp = nCmp + 1;
                |SINO;
                    |SI nCmp = 1;  aCampoA  = aCampoA  + aCarac1;  |FINSI;
                    |SI nCmp = 2;  aCampoB  = aCampoB  + aCarac1;  |FINSI;
                    |SI nCmp = 3;  aCampoC  = aCampoC  + aCarac1;  |FINSI;
                    |SI nCmp = 4;  aCampoD  = aCampoD  + aCarac1;  |FINSI;
                    |SI nCmp = 5;  aCampoE  = aCampoE  + aCarac1;  |FINSI;
                    |SI nCmp = 6;  aCampoF  = aCampoF  + aCarac1;  |FINSI;
                    |SI nCmp = 7;  aCampoG  = aCampoG  + aCarac1;  |FINSI;
                    |SI nCmp = 8;  aCampoH  = aCampoH  + aCarac1;  |FINSI;
                    |SI nCmp = 9;  aCampoI  = aCampoI  + aCarac1;  |FINSI;
                    |SI nCmp = 10; aCampoJ  = aCampoJ  + aCarac1;  |FINSI;
                    |SI nCmp = 11; aCampoK  = aCampoK  + aCarac1;  |FINSI;
                    |SI nCmp = 12; aCampoL  = aCampoL  + aCarac1;  |FINSI;

                    |SI nCmp > 12;  |SAL;  |FINSI;
                |FINSI;
          |SIGUE;

          |HAZ GrabaReg;
     |SIGUE;
     |XCIERRA nHandle;
|FPRC;
*/

|PROCESO T80;  |TIPO 80;
     |ABRET #gecom500;

/*
     |LEE 000#gecom500.u;

     |ABRE #gecom501;
     |LEE 000#gecom501.p;
     |SI FSalida ! 0;
         eaVer = #gecom500#0;
         |HAZ RecogeCSV;
     |FINSI;
     |CIERRA #gecom501;
*/
|FPRC;

|PROCESO T90;  |TIPO 90;
     |CIERRAT #gecom500;

     |SI aAbre ! "";
         |RFBORRA aAbre;
     |FINSI;
|FPRC;
