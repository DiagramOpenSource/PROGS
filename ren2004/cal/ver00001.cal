|FICHEROS;
     ver00001 #100;
     rem02000 #0;
     rem01000 #1;
     rem01002 #3;
     rem00007 #7;
     rem00008 #8;

     rem00020 #20;
     rem00021 #21;
     rem00028 #28;
     rem00999 #999;

     retabla1 #401;
|FIN;

|VARIABLES;
     &enError    = 0;
     &eaRenta    = "";

      nSwHay     = 0;
      nLimite    = 0;
      nPorce     = 0;
      nCanti1    = 0;
      nCanti2    = 0;
      nCanti3    = 0;
      nCanti4    = 0;
      nDias      = 0;
      nValor     = 0;
      nRecalculo = 0;

      aAlfa   = "";
|FIN;

|| ************************************************************************
|| PROCESOS DE CAMBIO DE VERSION
|| ************************************************************************

|PROCESO rem00020;
     #20#12 = #20#9  + #20#10 - #20#11;

     |SI #20#17 ! -1;
         |C_M #20#18, 1, "N";
         #20#18 = #20#28 % #20#17;
     |SINO;
         |C_M #20#18, 1, "S";
     |FINSI;

     |SI #20#27 ! -1;
         nLimite  = (#401#1 * #20#27) % 30;
         |SI #20#18 > nLimite;  #20#18 = nLimite;  |FINSI;
     |FINSI;

     |SI #20#21 > #401#2;  #20#21 = #401#2;  |FINSI;
     |SI #20#22 > #401#3;  #20#22 = #401#3;  |FINSI;

     #20#23 = #20#19 + #20#20 + #20#21 + #20#22;
     #20#24 = #20#7  + #20#12 + #20#34 + #20#16 + #20#28 - #20#18 - #20#23;
     #20#36 = 0;

     |SI #20#35 = "S";
         #20#36 = #20#24 % 65;
     |FINSI;

     #20#37 = #20#24 - #20#36;

     |GRABA 020#20a;
     |LIBERA #20;
|FPRC;

|DEFBUCLE rem00020;
     #20#1;
     ;
     00000, 00;
     99999, 99;
     be;
     NULL, rem00020;
|FIN;

|PROCESO rem00021;
     nCanti1 = #21#15 - #21#28;
     nPorce  = 80;
     |SI nCanti1 ! 0;  nPorce = (nCanti1 * 100) / #21#15;  |FINSI;

     nCanti2 = #21#26 % nPorce;
     nCanti3 = #21#27 % nPorce;

                            nCanti4 = nCanti2;
     |SI nCanti4 < nCanti1; nCanti4 = nCanti1; |FINSI;

     |SI #21#113 ! 0;
         #21#114 = #21#112 % #21#113;
     |FINSI;

     |SI #21#58 ! 0;
         #21#115  = nCanti4 % #21#58;

          #21#59  = "P";
          nDias   = #21#31 + #21#34;
          #21#115 = #21#115 * (nDias / 366);
     |FINSI;

     #21#60 = #21#114 + #21#115;

     |SI #21#60 < 0;  #21#60 = 0;  |FINSI;

     #21#122 = 0;
     #21#123 = 0;
     #21#61  = 0;

     nValor = #21#38;
     |SI #21#37 = "A"; nValor = #21#38 * (nDias / 366);  |FINSI;
     #21#122 = #21#122 + nValor;

     nValor = #21#40;
     |SI #21#39 = "A"; nValor = #21#40 * (nDias / 366);  |FINSI;
     #21#122 = #21#122 + nValor;

     nValor = #21#42;
     |SI #21#41 = "A"; nValor = #21#42 * (nDias / 366);  |FINSI;
     #21#122 = #21#122 + nValor;

     nValor = #21#44;
     |SI #21#43 = "A"; nValor = #21#44 * (nDias / 366);  |FINSI;
     #21#122 = #21#122 + nValor;

     nValor = #21#22;
     |SI #21#48 = "A"; nValor = #21#22 * (nDias / 366);  |FINSI;
     #21#123 = #21#123 + nValor;

     nValor = #21#21;
     |SI #21#49 = "A"; nValor = #21#21 * (nDias / 366);  |FINSI;
     #21#123 = #21#123 + nValor;

     nValor = #21#51;
     |SI #21#50 = "A"; nValor = #21#51 * (nDias / 366);  |FINSI;
     #21#123 = #21#123 + nValor;

     nValor = #21#53;
     |SI #21#52 = "A"; nValor = #21#53 * (nDias / 366);  |FINSI;
     #21#123 = #21#123 + nValor;

     nValor = #21#55;
     |SI #21#54 = "A"; nValor = #21#55 * (nDias / 366);  |FINSI;
     #21#123 = #21#123 + nValor;

     nValor = #21#57;
     |SI #21#56 = "A"; nValor = #21#57 * (nDias / 366);  |FINSI;
     #21#123 = #21#123 + nValor;

     nValor = #21#60;
     |SI #21#59 = "A"; nValor = #21#60 * (nDias / 366);  |FINSI;
     #21#123 = #21#123 + nValor;

     #21#61  = #21#122 - #21#123;

     |GRABA 020#21a;
     |LIBERA #21;
|FPRC;

|DEFBUCLE rem00021;
     #21#1;
     ;
     00000, 00;
     99999, 99;
     be;
     NULL, rem00021;
|FIN;

|PROCESO rem00028;
     nCanti1 = #28#26 - #28#59 - #28#31 - #28#62;
     |SI #28#35 ! 0;  nCanti1 = nCanti1 * #28#35;  |FINSI;
     |SI #28#36 ! 0;  nCanti1 = nCanti1 * #28#36;  |FINSI;
     |SI #28#38 ! 0;  nCanti1 = nCanti1 * #28#38;  |FINSI;
     |SI #28#54 ! 0;  nCanti1 = nCanti1 * #28#54;  |FINSI;
     |SI #28#39 ! 0;  nCanti1 = nCanti1 * #28#39;  |FINSI;
     |SI #28#55 ! 0;  nCanti1 = nCanti1 * #28#55;  |FINSI;

     nCanti2 = #28#27 - #28#60 - #28#32 - #28#63;
     |SI #28#35 ! 0;  nCanti2 = nCanti2 * #28#35;  |FINSI;
     |SI #28#36 ! 0;  nCanti2 = nCanti2 * #28#36;  |FINSI;
     |SI #28#37 ! 0;  nCanti2 = nCanti2 * #28#37;  |FINSI;
     |SI #28#38 ! 0;  nCanti2 = nCanti2 * #28#38;  |FINSI;
     |SI #28#54 ! 0;  nCanti2 = nCanti2 * #28#54;  |FINSI;
     |SI #28#39 ! 0;  nCanti2 = nCanti2 * #28#39;  |FINSI;
     |SI #28#55 ! 0;  nCanti2 = nCanti2 * #28#55;  |FINSI;

     #28#40 = nCanti1 + nCanti2;
     #28#57 = 0;
     |SI #28#40 > 0;
         #28#57 = #28#40 % 2;
     |FINSI;
     #28#44 = #28#40 - #28#57;
     #28#48 = #28#44 % #28#47;

     |SI #28#48 < 0;  #28#48 = -#28#48;  |FINSI;
     #28#49 = #28#44 - #28#48 - #28#43;

     #28#51 = 0;
     |SI #28#50 = "S";
         #28#51 = #28#49 % 40;
     |FINSI;

     #28#52 = #28#49 - #28#51;

     |GRABA 020#28a;
     |LIBERA #28;
|FPRC;

|DEFBUCLE rem00028;
     #28#1;
     ;
     00000, 00;
     99999, 99;
     be;
     NULL, rem00028;
|FIN;

|PROCESO MiraPatrones;
     nSwHay = 0;

     |ABRE #0;
     |LEE 040#0p;
     |SI FSalida ! 0;  |O #0#4 < 900;
         |CIERRA #0;  |DELINDEX #0;
         nSwHay = 1;
     |FINSI;
     |CIERRA #0;

     |ABRE #1;
     #1#0 = 30;
     #1#1 = "124";
     |LEE 040#1=;
     |SI FSalida = 0;
         |CIERRA #1;
         |DELINDEX #1;
         nSwHay = 1;
     |SINO;
         |CIERRA #1;
     |FINSI;

     |ABRE #8;
     #8#0 = 1;
     #8#1 = 800;
     |LEE 040#8=;
     |SI FSalida ! 0;
         |ABRE #7;  |CIERRA #7;  |DELINDEX #7;
         |CIERRA #8;
         |DELINDEX #8;
         nSwHay = 1;
     |SINO;
         |CIERRA #8;
     |FINSI;

     |ABRE #999;
     #999#0 = 30;
     #999#1 = " 49";
     |LEE 040#999=;
     |SI FSalida ! 0;
         |CIERRA #999;
         |DELINDEX #999;
         nSwHay = 1;
     |SINO;
         |CIERRA #999;
     |FINSI;

     |ABRE #401;
     |LEE 000#401p;
     |SI FSalida ! 0;  |DDEFECTO #401;  |FINSI;
     |CIERRA #401;

     |SI #401#1 ! 17900;
         |DELINDEX #401;
         nSwHay = 1;
     |FINSI;

     |SI nSwHay = 1;
         |MENAV "0000 Han cambiado ficheros patrones, por favor instalelos.";
         eaRenta = "r04";
         |SUB_EJECUTA_NP ":basica/dspatron";
     |FINSI;

     |ABRE #0;
     |LEE 040#0p;
     |SI FSalida ! 0;  |O #0#4 < 900;
         enError = 1;
         |CIERRA #0;
         |DELINDEX #0;
         |ACABA;
     |FINSI;
     |CIERRA #0;

     |ABRE #1;
     #1#0 = 30;
     #1#1 = "124";
     |LEE 040#1=;
     |SI FSalida = 0;
         enError = 1;
         |CIERRA #1;
         |DELINDEX #1;
         |ACABA;
     |FINSI;
     |CIERRA #1;

     |ABRE #8;
     #8#0 = 1;
     #8#1 = 800;
     |LEE 040#8=;
     |SI FSalida ! 0;
         enError = 1;
         |CIERRA #8;
         |DELINDEX #8;
         |ACABA;
     |FINSI;
     |CIERRA #8;

     |ABRE #999;
     #999#0 = 30;
     #999#1 = " 49";
     |LEE 040#999=;
     |SI FSalida ! 0;
         enError = 1;
         |CIERRA #999;
         |DELINDEX #999;
         |ACABA;
     |FINSI;
     |CIERRA #999;

     |ABRE #401;
     |LEE 000#401p;
     |SI FSalida ! 0;  |DDEFECTO #401;  |FINSI;
     |CIERRA #401;

     |SI #401#1 ! 17900;
         enError = 1;
         |DELINDEX #401;
     |FINSI;
|FPRC;

|PROGRAMA;
     nRecalculo = 0;

     |ABRE #100;
     |LEE 101#100p;
     |SI FSalida ! 0;
         |MENAV "0000 Han cambiado ficheros patrones, por favor instalelos.";
         eaRenta = "r04";
         |SUB_EJECUTA_NP ":basica/dspatron";

         |DDEFECTO #100;
         |GRABA 020#100n;
         |LIBERA #100;

         nRecalculo = 1;
     |FINSI;
     |CIERRA #100;

     |MENSA "0000Comprobando configuracion patrones.";
     enError = 0;
     |HAZ MiraPatrones;
     |SI enError = 1;
         |ABRE #100;
         |LEE 101#100p;
         |SI FSalida = 0;
             |BORRA 020#100a;
             |LIBERA #100;
         |FINSI;
         |CIERRA #100;

         |ACABA;
     |FINSI;

     |SI nRecalculo = 0;  |ACABA;  |FINSI;

     |ABRE #401;
     |LEE 000#401p;
     |SI FSalida ! 0;  |DDEFECTO #401;  |FINSI;
     |CIERRA #401;

     |BUCLE rem00020;
     |BUCLE rem00021;
     |BUCLE rem00028;

     |BLIN 5;
|FPRO;
