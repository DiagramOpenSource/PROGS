|FICHEROS;
     agiy0033 #0;
     agicen14 #1;
     agifigen #2;
|FIN;

|VARIABLES;
     nSwPrint   = 0;
     nCliente   = 0;

     aDTipo     = "";
     aHTipo     = "";
     aEpigrafe1 = "";
     aEpigrafe2 = "";
     aAlfa      = "";
     nCampo     = 0;
     nSeleccio  = 0;
     informe    = "";

     &eaTitulo  = "";
     &nSwLinea  = 0;
|FIN;

|INCLUYE i_consul;

|CALCULO SelAlta;
     aAlfa = #agiy0033#6;
     |SI aAlfa = "N";
         #agiy0033#7 = "01.01.0000";
         #agiy0033#8 = "01.01.0000";
     |SINO;
         |SI #agiy0033#7 = "01.01.0000";  #agiy0033#7 = ~; |FINSI;
         |SI #agiy0033#8 = "01.01.0000";  #agiy0033#8 = ~; |FINSI;
     |FINSI;
     |C_M #agiy0033#7, 1, aAlfa;
     |C_M #agiy0033#8, 1, aAlfa;
     |PINTA #agiy0033#7;
     |PINTA #agiy0033#8;
|FCAL;

|CALCULO SelBaja;
     aAlfa = #agiy0033#9;
     |SI aAlfa = "N";
         #agiy0033#10 = "01.01.0000";
         #agiy0033#11 = "01.01.0000";
     |SINO;
         |SI #agiy0033#10 = "01.01.0000";  #agiy0033#10 = ~; |FINSI;
         |SI #agiy0033#11 = "01.01.0000";  #agiy0033#11 = ~; |FINSI;
     |FINSI;
     |C_M #agiy0033#10, 1, aAlfa;
     |C_M #agiy0033#11, 1, aAlfa;
     |PINTA #agiy0033#10;
     |PINTA #agiy0033#11;
|FCAL;

|CALCULO FechaHasta;
     |C_M #agiy0033#Campo#, 0, aAlfa;
     |SI aAlfa = "N"; |ACABA; |FINSI;

     |SI FSalida = 2; |ACABA; |FINSI;

     nCampo = Campo - 1;

     |SI #agiy0033#Campo# < #agiy0033#nCampo#;
         |MENAV "0000Fecha Inferior a la Fecha Desde";
         |ERROR;
     |FINSI;
|FCAL;
|| //////////////////////////////////////////////////////////////////

|PROCESO SelFechas;
     nSeleccio = 0;
     |SI #agiy0033#6 = "S";
         |SI #agicen14#5 < #agiy0033#7; nSeleccio = 1; |FINSI;
         |SI #agicen14#5 > #agiy0033#8; nSeleccio = 1; |FINSI;
     |FINSI;
     |SI nSeleccio = 1; |ACABA; |FINSI;

     |SI #agiy0033#9 = "S";
         |SI #agicen14#6 > "01.01.1900";
             |SI #agicen14#6 < #agiy0033#10; nSeleccio = 1; |FINSI;
             |SI #agicen14#6 > #agiy0033#11; nSeleccio = 1; |FINSI;
         |SINO;
             nSeleccio = 1;  || No tiene Fecha de Baja
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO Imprime1;

     |HAZ SelFechas;
     |SI nSeleccio = 1; |ACABA; |FINSI;

     |SI nSwPrint = 0; |O aEpigrafe1 ! #agicen14#2;  |O aEpigrafe2 ! #agicen14#3;
         nSwLinea = 0;
         nCliente   = #agicen14#0;
         aEpigrafe1 = #agicen14#2;
         aEpigrafe2 = #agicen14#3;
     |FINSI;

     |SI nCliente  = #agicen14#0;
         |SI nSwLinea = 1; nSwLinea = 2; |FINSI;
     |FINSI;

     #agifigen#0 = #agicen14#0;
     |LEE 040#agifigen.=;
     |SI FSalida ! 0;  |DDEFECTO #agifigen;  |FINSI;

     |PRINT;
     nSwPrint = 1;
     nSwLinea = 1;
     nCliente   = #agicen14#0;
     aEpigrafe1 = #agicen14#2;
     aEpigrafe2 = #agicen14#3;
|FPRC;

|DEFBUCLE agicen141;
     #agicen14#1;
     2, 3;
     #agiy0033#0, 01, aDTipo, #agiy0033#3;
     #agiy0033#1, 99, aHTipo, #agiy0033#4;
     ;
     NULL, NULL, NULL, NULL, NULL, Imprime1;
     #agicen14#2, #agicen14#3, #agicen14#0;
|FIN;

|PROCESO Imprime2;

     |HAZ SelFechas;
     |SI nSeleccio = 1; |ACABA; |FINSI;

     |SI nCliente ! #agicen14#0; |O nSwPrint = 0;
         nSwLinea = 0;
         nCliente = #agicen14#0;
     |FINSI;

     #agifigen#0 = #agicen14#0;
     |LEE 040#agifigen.=;
     |SI FSalida ! 0;  |DDEFECTO #agifigen;  |FINSI;

     nSwPrint = 1;
     |PRINT;
     nSwLinea = 1;
|FPRC;

|DEFBUCLE agicen142;
     #agicen14#1;
     2, 3;
     #agiy0033#0, 01, aDTipo, #agiy0033#3;
     #agiy0033#1, 99, aHTipo, #agiy0033#4;
     ;
     NULL, Imprime2;
|FIN;

|| ////////////////////////////////////////////////////////////////////

|PROCESO Tipo3;  |TIPO 3;

     |IMPRE 0;
     |SI FSalida ! 0;
         |MENAV "0000Proceso Interrumpido";
         |ACABA;
     |FINSI;

     eaTitulo = #agiy0033#12; |QBF eaTitulo;

     |SI #agiy0033#5 = 1;
         informe  = "agiy1033";
         eaTitulo = eaTitulo + " ORDENADO POR IAE";
     |FINSI;
     |SI #agiy0033#5 = 2;
         informe = "agiy2033";
         eaTitulo = eaTitulo + " ORDENADO POR CLIENTES";
     |FINSI;

     |INFOR informe;
     |SI FSalida ! 0;
         |MENAV "0000Error en Informe. Proceso Interrumpido";
         |FINIMP;
         |ACABA;
     |FINSI;

     aDTipo = #agiy0033#2;
     aHTipo = #agiy0033#2;
     |SI #agiy0033#2 = "T";
         aDTipo = " ";
         aHTipo = "z";
     |FINSI;

     |ABRE #2;
     |SI #agiy0033#5 = 1;  |BUCLE agicen141;  |FINSI;
     |SI #agiy0033#5 = 2;  |BUCLE agicen142;  |FINSI;
     |CIERRA #2;

     |SI nSwPrint = 1;  |PIEINF;  |FINSI;
     |FININF;
     |FINIMP;
|FPRC;
