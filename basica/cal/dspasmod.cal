|FICHEROS;
     dspase03;
     dspase15;

     agicen14;
     agitab11;
     agitab13;
     agitab99;

     dspase25;

     refer00@;
     refer01@;
     refer02@;
     refer03@;

     :/modelos/def/dsmom002;
     :/modelos/def/dsmom005;
     :/modelos/def/dsmom006;

     :/modelos/def/dsmoc310;
     :/modelos/def/dsmoc131;
     :/modelos/def/dsmom093;
     :/modelos/def/dsmom094;
|FIN;

|VARIABLES;
      aDef           = "";
      aFich          = "";
      aAlfa          = "";

      nCodigoNue     = 0;
      nCodigoReo     = 0;
      nCampoAct      = 0;
      nCampoAgr      = 0;
      nCampoCuo      = 0;
      nCampoRdt      = 0;
      nCampoPor      = 0;
      nCampoCom      = 0;
      nAnyo          = 0;
      nPeriodo       = 0;
      nModelo        = 0;
      nPasada        = 0;
      nPasada1       = 0;
      nActividad     = 0;

     &enModelo       = 0;
     &enEstaCambio   = 0;
     &enEmpresa      = 0;
     &enEmpresaA     = 0;
     &enEjercicioA   = 0;
     &enPeriodoA     = 0;
     &enAnyo         = 0;
     &enSwEstar      = 0;
     &enEjer         = 0;
     &enPeriodo      = 0;
     &enComplem      = 0;
     &enActividad    = 0;
     &enTipoEntrada  = 0;
     &eaArchiva      = "";
     &efFechaI       = @;
     &enDEmpresa     = 0;
     &enHEmpresa     = 0;

     &eaPathAnterior = "";
     &eaPathBasica   = "";
     &eaPathContagen = "";
     &eaPathContanex = "";
     &eaPathContasoc = "";
     &eaPathRen2000  = "";
     &eaPathRen1999  = "";
     &eaPathRen1998  = "";
     &eaPathRen1997  = "";
     &eaPathRen1996  = "";
     &eaPathRen1995  = "";
     &eaPathRen1994  = "";
     &eaPathFacturar = "";
     &eaPathLaboral  = "";
     &eaPathIntegral = "";
     &eaPathDsmodelo = "";
     &eaPathFiscal   = "";
     aPath           = "";
|FIN;

|PROCESO CogeCodigo;
     |SI #dspase15#22 = "S";  |ACABA;  |FINSI;

     nCodigoNue = #dspase15#3;
     |ERROR10;
|FPRC;

|DEFBUCLE dspase15;
     #dspase15#4;
     ;
     nCodigoReo, "            ", 000;
     nCodigoReo, "zzzzzzzzzzzz", 999;
     ;
     NULL, CogeCodigo;
|FIN;

|PROCESO GrabaActivi310;
     nActividad = #refer00@#nCampoAct#;
     nPasada    = 0;
     |PARA;  |SI;  |HACIENDO;
         #agicen14#0 = nCodigoNue;
         #agicen14#1 = nActividad;
         |LEE 040#agicen14.=;
         |SI FSalida ! 0;  |DDEFECTO #agicen14;  |FINSI;

         |ABRE #agitab11;
         #agitab11#0 = #agicen14#7;
         #agitab11#1 = 310;
         |LEE 040#agitab11.=;
         |SI FSalida = 0;  |CIERRA #agitab11;  |SAL;  |FINSI;
         |CIERRA #agitab11;

         |SI nActividad = #refer00@#nCampoAct#;
             |SI nPasada = 0;
                 |SI nActividad ! 1;
                     nActividad = 0;
                 |FINSI;
                 nPasada    = 1;
             |SINO;
                 |SAL;
             |FINSI;
         |FINSI;

         nActividad = nActividad + 1;

         |SI nActividad > 9;  |SAL;  |FINSI;
     |SIGUE;

     #agicen14#0 = nCodigoNue;
     #agicen14#1 = nActividad;
     |LEE 101#agicen14.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     #agicen14#6 = "01.01.0000";

     nModelo = 310;
     |SI #refer01@#60 = "S";
         nModelo = 370;
     |FINSI;

     #dsmom002#0 = nCodigoNue;
     #dsmom002#1 = nActividad;
     #dsmom002#2 = nModelo;
     |LEE 101#dsmom002.=;
     |SI FSalida ! 0;
         #agitab99#0 = nModelo;
         |LEE 040#agitab99.=;
         |SI FSalida ! 0;  |DDEFECTO #agitab99;  |FINSI;

         |DDEFECTO #dsmom002;
         #dsmom002#0  = nCodigoNue;
         #dsmom002#1  = nActividad;
         #dsmom002#2  = nModelo;
         #dsmom002#3  = #agitab99#1;
         #dsmom002#4  = #agitab99#2;
         #dsmom002#5  = #agitab99#3;
         #dsmom002#6  = #agicen14#4;
         #dsmom002#7  = "TRIMESTRAL";
         #dsmom002#8  = #agicen14#5;
         #dsmom002#9  = #agicen14#6;
         #dsmom002#10 = 1;

         |GRABA 020#dsmom002.n;

         |SI nModelo = 370;
             #dsmom002#0 = nCodigoNue;
             #dsmom002#1 = nActividad;
             #dsmom002#2 = 310;
             |LEE 101#dsmom002.=;
             |SI FSalida ! 0;
                 #agitab99#0 = 310;
                 |LEE 040#agitab99.=;
                 |SI FSalida ! 0;  |DDEFECTO #agitab99;  |FINSI;

                 |DDEFECTO #dsmom002;
                 #dsmom002#0  = nCodigoNue;
                 #dsmom002#1  = nActividad;
                 #dsmom002#2  = 310;
                 #dsmom002#3  = #agitab99#1;
                 #dsmom002#4  = #agitab99#2;
                 #dsmom002#5  = #agitab99#3;
                 #dsmom002#6  = #agicen14#4;
                 #dsmom002#7  = "TRIMESTRAL";
                 #dsmom002#8  = #agicen14#5;
                 #dsmom002#9  = #agicen14#6;
                 #dsmom002#10 = 1;

                 |GRABA 020#dsmom002.n;
             |FINSI;
         |FINSI;
     |FINSI;
     |LIBERA #dsmom002;

     #refer02@#0 = #refer00@#0;
     #refer02@#5 = #refer00@#1;
     #refer02@#1 = nActividad;
     |LEE 040#refer02@.=;
     |SI FSalida = 0;
         #agicen14#15 = "MODULOS";
     |SINO;
         |SI #agicen14#15 = "          "; #agicen14#15 = "MANUAL"; |FINSI;
     |FINSI;
     |GRABA 020#agicen14.a;
     |LIBERA #agicen14;

                         enSwEstar = 0;
     |SI nModelo = 370;  enSwEstar = 1;  |FINSI;

     enEmpresaA = nCodigoNue;
     enAnyo     = #dspase03#4;
     |SUB_EJECUTA_NP ":modelos/dsmoz001";

     |SI #refer00@#2 = 1;  nPeriodo = 3;   |FINSI;
     |SI #refer00@#2 = 2;  nPeriodo = 6;   |FINSI;
     |SI #refer00@#2 = 3;  nPeriodo = 9;   |FINSI;
     |SI #refer00@#2 = 4;  nPeriodo = 12;  |FINSI;

     |ABRE #dsmoc310;
     #dsmoc310#0  = nCodigoNue;
     #dsmoc310#1  = #dspase03#4;
     #dsmoc310#2  = nPeriodo;
     #dsmoc310#3  = nModelo;
     #dsmoc310#4  = 0;
     #dsmoc310#5  = #agicen14#1;
     |LEE 101#dsmoc310.=;
     |SI FSalida ! 0;
         |DDEFECTO #dsmoc310;
         #dsmoc310#0  = nCodigoNue;
         #dsmoc310#1  = #dspase03#4;
         #dsmoc310#2  = nPeriodo;
         #dsmoc310#3  = nModelo;
         #dsmoc310#4  = 0;
         #dsmoc310#5  = #agicen14#1;
         |GRABA 020#dsmoc310.b;
     |FINSI;

     #dsmoc310#6  = #agicen14#3;
     #dsmoc310#7  = #agicen14#4;
     #dsmoc310#8  = #refer00@#nCampoAgr#;
     #dsmoc310#9  = #refer00@#nCampoCuo#;

     |SI nCampoAct = 5;
         #dsmoc310#10  = #refer00@#31;
         #dsmoc310#11  = #refer00@#32;
         #dsmoc310#12  = #refer00@#33;
         #dsmoc310#13  = #refer00@#35;
         #dsmoc310#14  = #refer00@#45;
         #dsmoc310#15  = #refer00@#39;
         #dsmoc310#16  = #refer00@#37;
     |FINSI;

     |GRABA 020#dsmoc310.a;
     |LIBERA #dsmoc310;
     |CIERRA #dsmoc310;

     |SI nPeriodo = 12;
         |ABRE #dsmom005;
         #dsmom005#0 = nModelo;
         |LEE 040#dsmom005.=;
         |SI FSalida ! 0;  |DDEFECTO #dsmom005;  |FINSI;
         |CIERRA #dsmom005;

         |SI #refer00@#42 ! 0;  |Y #dsmom005#11 = "COMPENSAR";
             |ABRE #dsmom006;
             #dsmom006#0  = nCodigoNue;
             #dsmom006#1  = #dsmom005#0;
             |LEE 101#dsmom006.=;
             |SI FSalida ! 0;
                 |DDEFECTO #dsmom006;
                 #dsmom006#0  = nCodigoNue;
                 #dsmom006#1  = #dsmom005#0;
                 #dsmom006#2  = #dsmom005#1;
                 #dsmom006#3  = #dsmom005#2;
                 #dsmom006#4  = #dsmom005#3;
                 #dsmom006#5  = #dsmom005#4;
                 #dsmom006#6  = #dsmom005#5;
                 #dsmom006#7  = #dsmom005#6;
                 #dsmom006#8  = #dsmom005#7;
                 #dsmom006#9  = #dsmom005#8;
                 #dsmom006#10 = #dsmom005#9;
                 #dsmom006#11 = #dsmom005#10;
                 |GRABA 020#dsmom006.b;
             |FINSI;
             #dsmom006#12 = "DEVOLVER";
             |GRABA 020#dsmom006.a;
             |LIBERA #dsmom006;
             |CIERRA #dsmom006;
         |FINSI;

         |SI #refer00@#41 ! 0;  |Y #dsmom005#11 = "DEVOLVER ";
             |ABRE #dsmom006;
             #dsmom006#0  = nCodigoNue;
             #dsmom006#1  = #dsmom005#0;
             |LEE 101#dsmom006.=;
             |SI FSalida ! 0;
                 |DDEFECTO #dsmom006;
                 #dsmom006#0  = nCodigoNue;
                 #dsmom006#1  = #dsmom005#0;
                 #dsmom006#2  = #dsmom005#1;
                 #dsmom006#3  = #dsmom005#2;
                 #dsmom006#4  = #dsmom005#3;
                 #dsmom006#5  = #dsmom005#4;
                 #dsmom006#6  = #dsmom005#5;
                 #dsmom006#7  = #dsmom005#6;
                 #dsmom006#8  = #dsmom005#7;
                 #dsmom006#9  = #dsmom005#8;
                 #dsmom006#10 = #dsmom005#9;
                 #dsmom006#11 = #dsmom005#10;
                 |GRABA 020#dsmom006.b;
             |FINSI;
             #dsmom006#12 = "COMPENSAR";
             |GRABA 020#dsmom006.a;
             |LIBERA #dsmom006;
             |CIERRA #dsmom006;
        |FINSI;
     |FINSI;

     enEmpresa     = #dsmoc310#0;
     enEjer        = #dsmoc310#1;
     enPeriodo     = #dsmoc310#2;
     enModelo      = #dsmoc310#3;
     enComplem     = #dsmoc310#4;
     enActividad   = #dsmoc310#5;
     enTipoEntrada = 98;
     |SUB_EJECUTA_NP ":modelos/dsmoc310";
|FPRC;

|PROCESO Pasa310;
     |SI enEstaCambio = 1;
         nCodigoNue = 0;
         nCodigoReo = #refer00@#0;
         |BUCLE dspase15;
         |SI nCodigoNue = 0;  |ACABA;  |FINSI;
     |SINO;
         nCodigoNue = #refer00@#0;
     |FINSI;
     |SI nCodigoNue < #dspase03#9; |O nCodigoNue > #dspase03#10; |ACABA; |FINSI;

     #refer01@#0 = nCodigoReo;
     |LEE 040#refer01@.=;
     |SI FSalida ! 0;  |DDEFECTO #refer01@;  |FINSI;

     |SI #refer00@#5 ! 0;
         nCampoAct = 5;
         nCampoAgr = 8;
         nCampoCuo = 9;
         |HAZ GrabaActivi310;
     |FINSI;

     |SI #refer00@#10 ! 0;
         nCampoAct = 10;
         nCampoAgr = 13;
         nCampoCuo = 14;
         |HAZ GrabaActivi310;
     |FINSI;

     |SI #refer00@#15 ! 0;
         nCampoAct = 15;
         nCampoAgr = 18;
         nCampoCuo = 19;
         |HAZ GrabaActivi310;
     |FINSI;

     |SI #refer00@#20 ! 0;
         nCampoAct = 20;
         nCampoAgr = 23;
         nCampoCuo = 24;
         |HAZ GrabaActivi310;
     |FINSI;

     |SI #refer00@#25 ! 0;
         nCampoAct = 25;
         nCampoAgr = 28;
         nCampoCuo = 29;
         |HAZ GrabaActivi310;
     |FINSI;

     #dspase25#0 = nModelo;
     #dspase25#1 = nPeriodo;
     #dspase25#2 = 0;
     #dspase25#3 = nCodigoNue;
     |LEE 101#dspase25.=;
     |SI FSalida ! 0;
         |DDEFECTO #dspase25;
         #dspase25#0 = nModelo;
         #dspase25#1 = nPeriodo;
         #dspase25#2 = 0;
         #dspase25#3 = nCodigoNue;
         |GRABA 020#dspase25.b;
     |FINSI;
     #dspase25#4 = #refer00@#38;
     |GRABA 020#dspase25.a;
     |LIBERA #dspase25;

     enEmpresa = nCodigoNue;
     enEjer    = #dspase03#4;
     enPeriodo = nPeriodo;
     enModelo  = nModelo;
     enComplem = 0;
     efFechaI  = #refer00@#3;
     eaArchiva = "";
     |SI #refer00@#4 = "S";  eaArchiva = "X";  |FINSI;
     |SUB_EJECUTA "dspasuti;PonDatosPlaning";
|FPRC;

|DEFBUCLE eosm0019;
     #refer00@#1003;
     ;
     00001, nAnyo,  1;
     99999, nAnyo,  4;
     ;
     NULL, Pasa310;
|FIN;

|PROCESO Modelo310;
     enModelo   = 310;
     |SUB_EJECUTA "dspasuti;BorraModelos";

     enModelo   = 370;
     |SUB_EJECUTA "dspasuti;BorraModelos";

     aDef = eaPathAnterior + "agieos/def/eosm0019.mas";
     |CARGA_DEF aDef, refer00@;
     |SI FSalida ! 0;
         |ACABA;
     |FINSI;

     aDef = eaPathAnterior + "agieos/def/eosclien.mas";
     |CARGA_DEF aDef, refer01@;
     |SI FSalida ! 0;
         |DESCARGA_DEF #refer00@;
         |ACABA;
     |FINSI;

     aDef = eaPathAnterior + "agieos/def/eosm0017.mas";
     |CARGA_DEF aDef, refer02@;
     |SI FSalida ! 0;
         |DESCARGA_DEF #refer01@;
         |DESCARGA_DEF #refer00@;
         |ACABA;
     |FINSI;

     aFich = eaPathAnterior + "agieos/fich/";
     |PATH_DAT #refer00@#aFich#;
     |PATH_DAT #refer01@#aFich#;
     |PATH_DAT #refer02@#aFich#;

     aAlfa   = #dspase03#4;
     aAlfa   = #dspase03#4 % -102;
     nAnyo   = aAlfa;

     |ABRE #agicen14;
     |ABRE #dsmom002;
     |ABRE #refer01@;
     |ABRE #refer02@;
     |ABRE #agitab99;
     |BUCLE eosm0019;
     |CIERRA #refer01@;
     |CIERRA #refer02@;
     |CIERRA #agicen14;
     |CIERRA #dsmom002;
     |CIERRA #agitab99;

     |DESCARGA_DEF #refer02@;
     |DESCARGA_DEF #refer01@;
     |DESCARGA_DEF #refer00@;
|FPRC;

|PROCESO GrabaActivi131;
     nActividad = #refer00@#nCampoAct#;
     nPasada1   = 0;
     |PARA;  |SI;  |HACIENDO;
         #agicen14#0 = nCodigoNue;
         #agicen14#1 = nActividad;
         |LEE 040#agicen14.=;
         |SI FSalida ! 0;  |DDEFECTO #agicen14; |FINSI;

         |ABRE #agitab13;
         #agitab13#0 = #agicen14#9;
         #agitab13#1 = 131;
         |LEE 040#agitab13.=;
         |SI FSalida = 0;  |CIERRA #agitab13;  |SAL;  |FINSI;
         |CIERRA #agitab13;

         |SI nActividad = #refer00@#nCampoAct#;
             |SI nPasada1 = 0;
                 |SI nActividad ! 1;
                     nActividad = 0;
                 |FINSI;
                 nPasada1   = 1;
             |SINO;
                 |SAL;
             |FINSI;
         |FINSI;

         nActividad = nActividad + 1;

         |SI nActividad > 9;  |SAL;  |FINSI;
     |SIGUE;

     #agicen14#0 = nCodigoNue;
     #agicen14#1 = nActividad;
     |LEE 101#agicen14.=;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |SI nPasada = 0;
         #agicen14#6 = "01.01.0000";

         #dsmom002#0 = nCodigoNue;
         #dsmom002#1 = nActividad;
         #dsmom002#2 = 131;
         |LEE 101#dsmom002.=;
         |SI FSalida ! 0;
             #agitab99#0 = 131;
             |LEE 040#agitab99.=;
             |SI FSalida ! 0;  |DDEFECTO #agitab99;  |FINSI;

             |DDEFECTO #dsmom002;
             #dsmom002#0  = nCodigoNue;
             #dsmom002#1  = nActividad;
             #dsmom002#2  = 131;
             #dsmom002#3  = #agitab99#1;
             #dsmom002#4  = #agitab99#2;
             #dsmom002#5  = #agitab99#3;
             #dsmom002#6  = #agicen14#4;
             #dsmom002#7  = "TRIMESTRAL";
             #dsmom002#8  = #agicen14#5;
             #dsmom002#9  = #agicen14#6;
             #dsmom002#10 = 1;

             |GRABA 020#dsmom002.n;
         |FINSI;
         |LIBERA #dsmom002;

         #refer01@#0 = #refer00@#0;
         #refer01@#5 = #refer00@#1;
         #refer01@#1 = nActividad;
         |LEE 040#refer01@.=;
         |SI FSalida = 0;
             #agicen14#15 = "MODULOS";
         |SINO;
             |SI #agicen14#15 = "          "; #agicen14#15 = "MANUAL"; |FINSI;
         |FINSI;
         |GRABA 020#agicen14.a;
         |LIBERA #agicen14;

         enEmpresaA = nCodigoNue;
         enAnyo     = #dspase03#4;
         |SUB_EJECUTA_NP ":modelos/dsmoz001";

         |ACABA;
     |FINSI;

     |SI #refer00@#nCampoCom# = "C";  |ACABA;  |FINSI;

     |SI #refer00@#2 = 1;  nPeriodo = 3;   |FINSI;
     |SI #refer00@#2 = 2;  nPeriodo = 6;   |FINSI;
     |SI #refer00@#2 = 3;  nPeriodo = 9;   |FINSI;
     |SI #refer00@#2 = 4;  nPeriodo = 12;  |FINSI;

     |ABRE #dsmoc131;
     #dsmoc131#0  = nCodigoNue;
     #dsmoc131#1  = #dspase03#4;
     #dsmoc131#2  = nPeriodo;
     #dsmoc131#3  = 131;
     #dsmoc131#4  = 0;
     #dsmoc131#5  = #agicen14#1;
     |LEE 101#dsmoc131.=;
     |SI FSalida ! 0;
         |DDEFECTO #dsmoc131;
         #dsmoc131#0  = nCodigoNue;
         #dsmoc131#1  = #dspase03#4;
         #dsmoc131#2  = nPeriodo;
         #dsmoc131#3  = 131;
         #dsmoc131#4  = 0;
         #dsmoc131#5  = #agicen14#1;
         |GRABA 020#dsmoc131.b;
     |FINSI;

     #dsmoc131#6  = #agicen14#3;
     #dsmoc131#7  = #agicen14#4;
     |SI #refer00@#nCampoCuo# ! 0;  |O #refer00@#nCampoRdt# ! 0;
         #dsmoc131#9  = #refer00@#nCampoRdt#;
         #dsmoc131#10 = #refer00@#nCampoPor#;
         #dsmoc131#11 = #refer00@#nCampoCuo#;
     |FINSI;

     |SI nCampoAct = 5;
         |SI #refer00@#nCampoCuo# ! 0;  |O #refer00@#nCampoRdt# ! 0;
             #dsmoc131#12 = #refer00@#54 - #refer00@#45;
         |FINSI;
     |FINSI;

     |SI #refer00@#nCampoCuo# = 0;  |O #refer00@#nCampoRdt# = 0;
         #dsmoc131#8  = "S";
         #dsmoc131#13 = #refer00@#43;
         #dsmoc131#14 = #refer00@#44;
         #dsmoc131#15 = #refer00@#41;
     |FINSI;

     |GRABA 020#dsmoc131.a;
     |LIBERA #dsmoc131;
     |CIERRA #dsmoc131;

     enEmpresa     = #dsmoc131#0;
     enEjer        = #dsmoc131#1;
     enPeriodo     = #dsmoc131#2;
     enModelo      = #dsmoc131#3;
     enComplem     = #dsmoc131#4;
     enActividad   = #dsmoc131#5;
     enTipoEntrada = 98;
     |SUB_EJECUTA_NP ":modelos/dsmoc131";
|FPRC;

|PROCESO Pasa131;
     |SI enEstaCambio = 1;
         nCodigoNue = 0;
         nCodigoReo = #refer00@#0;
         |BUCLE dspase15;
         |SI nCodigoNue = 0;  |ACABA;  |FINSI;
     |SINO;
         nCodigoNue = #refer00@#0;
     |FINSI;
     |SI nCodigoNue < #dspase03#9; |O nCodigoNue > #dspase03#10; |ACABA; |FINSI;

     |SI #refer00@#5 ! 0;
         nCampoAct = 5;
         nCampoCom = 6;
         nCampoRdt = 9;
         nCampoPor = 10;
         nCampoCuo = 11;
         |HAZ GrabaActivi131;
     |FINSI;

     |SI #refer00@#12 ! 0;
         nCampoAct = 12;
         nCampoCom = 13;
         nCampoRdt = 16;
         nCampoPor = 17;
         nCampoCuo = 18;
         |HAZ GrabaActivi131;
     |FINSI;

     |SI #refer00@#19 ! 0;
         nCampoAct = 19;
         nCampoCom = 20;
         nCampoRdt = 23;
         nCampoPor = 24;
         nCampoCuo = 25;
         |HAZ GrabaActivi131;
     |FINSI;

     |SI #refer00@#26 ! 0;
         nCampoAct = 26;
         nCampoCom = 27;
         nCampoRdt = 30;
         nCampoPor = 31;
         nCampoCuo = 32;
         |HAZ GrabaActivi131;
     |FINSI;

     |SI #refer00@#33 ! 0;
         nCampoAct = 33;
         nCampoCom = 34;
         nCampoRdt = 37;
         nCampoPor = 38;
         nCampoCuo = 39;
         |HAZ GrabaActivi131;
     |FINSI;

     |SI #refer00@#5  = 0;  |Y #refer00@#12 = 0;  |Y #refer00@#19 = 0;
      |Y #refer00@#26 = 0;  |Y #refer00@#33 = 0;  |Y #refer00@#43 ! 0;
         nCampoAct     = 5;   #refer00@#nCampoAct# = 1;
         nCampoCom     = 6;   #refer00@#nCampoCom# = 0;
         nCampoRdt     = 9;   #refer00@#nCampoRdt# = 0;
         nCampoPor     = 10;  #refer00@#nCampoPor# = 0;
         nCampoCuo     = 11;  #refer00@#nCampoCuo# = 0;
         |HAZ GrabaActivi131;
     |FINSI;

     |SI nPasada = 1;
         #dspase25#0 = 131;
         #dspase25#1 = nPeriodo;
         #dspase25#2 = 0;
         #dspase25#3 = nCodigoNue;
         |LEE 101#dspase25.=;
         |SI FSalida ! 0;
             |DDEFECTO #dspase25;
             #dspase25#0 = 131;
             #dspase25#1 = nPeriodo;
             #dspase25#2 = 0;
             #dspase25#3 = nCodigoNue;
             |GRABA 020#dspase25.b;
         |FINSI;
         #dspase25#4 = #refer00@#47;
         |GRABA 020#dspase25.a;
         |LIBERA #dspase25;

         enEmpresa = nCodigoNue;
         enEjer    = #dspase03#4;
         enPeriodo = nPeriodo;
         enModelo  = 131;
         enComplem = 0;
         efFechaI  = #refer00@#3;
         eaArchiva = "";
         |SI #refer00@#4 = "S";  eaArchiva = "X";  |FINSI;
         |SUB_EJECUTA "dspasuti;PonDatosPlaning";
     |FINSI;
|FPRC;

|DEFBUCLE eosm0020;
     #refer00@#1003;
     ;
     00001, nAnyo,  1;
     99999, nAnyo,  4;
     ;
     NULL, Pasa131;
|FIN;

|PROCESO Pasam093_131;
  |SI enEstaCambio = 1;
      nCodigoNue = 0;
      nCodigoReo = #refer02@#2;
      |BUCLE dspase15;
      |SI nCodigoNue = 0;  |ACABA;  |FINSI;
  |SINO;
      nCodigoNue = #refer02@#2;
  |FINSI;
  |SI nCodigoNue < #dspase03#9; |O nCodigoNue > #dspase03#10; |ACABA; |FINSI;

  #dsmom093#0 = 131;
  #dsmom093#1 = #dspase03#4;
  #dsmom093#2 = nCodigoNue;
  #dsmom093#3 = #refer02@#3;
  #dsmom093#4 = #refer02@#4;
  #dsmom093#5 = #refer02@#5;
  #dsmom093#6 = #refer02@#6;
  #dsmom093#7 = #refer02@#7;
  #dsmom093#8 = #refer02@#8;
  #dsmom093#9 = #refer02@#9;
  #dsmom093#10 = #refer02@#10;
  #dsmom093#11 = #refer02@#11;
  #dsmom093#12 = #refer02@#12;
  #dsmom093#13 = #refer02@#13;
  |GRABA 040#dsmom093.n;
|FPRC;

|DEFBUCLE eosm0093_131;  ||solo los que no aplican
     #refer02@#1003;
     ;
     131, nAnyo, 00001;
     131, nAnyo, 99999;
     ;
     NULL, Pasam093_131;
|FIN;

|PROCESO Pasam094_131;
  |SI enEstaCambio = 1;
      nCodigoNue = 0;
      nCodigoReo = #refer03@#2;
      |BUCLE dspase15;
      |SI nCodigoNue = 0;  |ACABA;  |FINSI;
  |SINO;
      nCodigoNue = #refer03@#2;
  |FINSI;
  |SI nCodigoNue < #dspase03#9; |O nCodigoNue > #dspase03#10; |ACABA; |FINSI;

  #dsmom094#0 = 131;
  #dsmom094#1 = #dspase03#4;
  #dsmom094#2 = nCodigoNue;
  #dsmom094#3 = #refer03@#3;
  #dsmom094#4 = #refer03@#4;
  #dsmom094#5 = #refer03@#5;
  #dsmom094#6 = #refer03@#6;
  #dsmom094#7 = #refer03@#7;
  #dsmom094#8 = #refer03@#8;
  #dsmom094#9 = #refer03@#9;
  #dsmom094#10 = #refer03@#10;
  |GRABA 040#dsmom094.n;
|FPRC;

|DEFBUCLE eosm0094_131;
     #refer03@#1003;
     0;
     nAnyo, 00001, 0, 131;
     nAnyo, 99999, 9, 131;
     ;
     NULL, Pasam094_131;
|FIN;

|PROCESO Modelo131;
     enModelo   = 131;
     |SUB_EJECUTA "dspasuti;BorraModelos";

     aDef = eaPathAnterior + "agieos/def/eosm0020.mas";
     |CARGA_DEF aDef, refer00@;
     |SI FSalida ! 0;
         |ACABA;
     |FINSI;

     aDef = eaPathAnterior + "agieos/def/eosm0017.mas";
     |CARGA_DEF aDef, refer01@;
     |SI FSalida ! 0;
         |DESCARGA_DEF #refer00@;
         |ACABA;
     |FINSI;

     aDef = eaPathAnterior + "agieos/def/eosm0093.mas";
     |CARGA_DEF aDef, refer02@;
     |SI FSalida ! 0;
         |DESCARGA_DEF #refer01@;
         |DESCARGA_DEF #refer00@;
         |ACABA;
     |FINSI;

     aDef = eaPathAnterior + "agieos/def/eosm0094.mas";
     |CARGA_DEF aDef, refer03@;
     |SI FSalida ! 0;
         |DESCARGA_DEF #refer02@;
         |DESCARGA_DEF #refer01@;
         |DESCARGA_DEF #refer00@;
         |ACABA;
     |FINSI;

     aFich = eaPathAnterior + "agieos/fich/";
     |PATH_DAT #refer00@#aFich#;
     |PATH_DAT #refer01@#aFich#;
     |PATH_DAT #refer02@#aFich#;
     |PATH_DAT #refer03@#aFich#;

     aAlfa   = #dspase03#4;
     aAlfa   = #dspase03#4 % -102;
     nAnyo   = aAlfa;

     |ABRE #dsmom093;
     |BUCLE eosm0093_131;  ||solo los que no aplican
     |CIERRA #dsmom093;
     |ABRE #dsmom094;
     |BUCLE eosm0094_131;  ||solo los que no aplican
     |CIERRA #dsmom094;

     |ABRE #agicen14;
     |ABRE #dsmom002;
     |ABRE #agitab99;
     |ABRE #refer01@;
     nPasada = 0;  |BUCLE eosm0020;
     nPasada = 1;  |BUCLE eosm0020;
     |CIERRA #agicen14;
     |CIERRA #dsmom002;
     |CIERRA #agitab99;
     |CIERRA #refer01@;

     |DESCARGA_DEF #refer03@;
     |DESCARGA_DEF #refer02@;
     |DESCARGA_DEF #refer01@;
     |DESCARGA_DEF #refer00@;
|FPRC;

|PROCESO PaseModulos;
     enDEmpresa = #dspase03#9;
     enHEmpresa = #dspase03#10;

     aPath = eaPathDsmodelo + "fich/";
     |PATH_DAT #dsmom093#aPath#;
     |PATH_DAT #dsmom094#aPath#;

     |SI #dspase03#0 = 310;  |HAZ Modelo310;  |FINSI;
     |SI #dspase03#0 = 131;  |HAZ Modelo131;  |FINSI;
|FPRC;
