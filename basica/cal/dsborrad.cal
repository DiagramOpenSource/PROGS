|FICHEROS;
     dsborrad;

     :/integral/def/dsam0000;            || Historico de Clientes
     :/integral/def/dsam0010;            || Datos Banco Facturacion
     :/integral/def/dsam0050;            || Historico de Clientes
     :/integral/def/dsam0051;            || Historico de Actividades
     :/integral/def/dsam0052;            || Historico de Conceptos Contratados
     :/integral/def/dsam0008;            || Conceptos Contratados
     :/integral/def/dsam0121;            || Tipos Documentos C
     :/integral/def/dsam0122;            || Tipos Documentos L

     :/facturar/def/facemp;              || Empresas Facturacion
     :/facturar/def/asclient;            || Clientes facturar
     :/contagen/def/canempre;            || Empresas Contabilidad

     :/basica/def/agicen14;              || Actividades
     :/basica/def/agifigen;              || Clientes
     :/basica/def/dsficher;              || Tabla de Ficheros

     &referen@;
     &refesql@;
|FIN;

|VARIABLES;
     nDClave1        = 0;
     nHClave1        = 0;
     nDClave2        = 0;
     nHClave2        = 0;
     nDClave3        = 0;
     nHClave3        = 0;
     nDClave4        = 0;
     nHClave4        = 0;
     nDClave5        = 0;
     nHClave5        = 0;
     nDClave6        = 0;
     nHClave6        = 0;
     nDClave7        = 0;
     nHClave7        = 0;
     nCampo          = 0;
     nContador       = 0;

     nCampoClave     = 0;
     nCampo1         = 0;
     nCampo2         = 0;
     nCampo3         = 0;
     nClave          = 0;
     nPosClave       = 0;
     nDEmpresa       = 0;
     nHEmpresa       = 0;
     nCampoDef       = 0;
     nTCampo         = 0;
     nCampoCli       = 0;
     nCampoMod       = 0;
     nAnyo           = 0;
     nHandle         = 0;

     nNume           = 0;
     aAlfa           = "";
     aAlfa1          = "";
     aAlfa2          = "";
     aAlfa3          = "";
     aDAlfa1         = "";
     aHAlfa1         = "";
     aDAlfa2         = "";
     aHAlfa2         = "";
     aDAlfa3         = "";
     aHAlfa3         = "";
     aDAlfa4         = "";
     aHAlfa4         = "";
     aDAlfa5         = "";
     aHAlfa5         = "";
     aDAlfa6         = "";
     aHAlfa6         = "";
     aDAlfa7         = "";
     aHAlfa7         = "";
     aPath           = "";
     aTipoBucle      = "";
     aOrigen         = "";
     aDestino        = "";
     aAplica         = "";
     aMaximo         = "";
     aMinimo         = "";
     aBase           = "";
     aDir            = "";
     aDirecBuscar    = "";
     aDirFichDestino = "";
     aQueQuiero      = "";
     aCampo          = "";
     aBaseAqui       = "";
     aBorrar         = "";
     aDef            = "";
     aFichero        = "";
     aSelect         = "";
     aFrom           = "";
     aInto           = "";
     aWhere          = "";
     aFichSql        = "";
     aFich           = "";
     aDDef           = "";
     aHDef           = "";
     aHora           = "";
     aBaseDSARCHI    = "";
     aMas            = "";

     &enBajaCli      = 0;
     &enCambioCli    = 0;
     &enBorraTodo    = 0;
     &enDeFuera      = 0;
     &enEmpresa      = 0;
     &enEmpresaN     = 0;
     &enEmpFac       = -1;
     &enTransfor     = 0;

     &eaPathBasica   = "";
     &eaPathContagen = "";
     &eaPathContanex = "";
     &eaPathContasoc = "";
     &eaPathRen2019  = "";
     &eaPathRen2018  = "";
     &eaPathRen2017  = "";
     &eaPathRen2016  = "";
     &eaPathRen2015  = "";
     &eaPathRen2014  = "";
     &eaPathRen2013  = "";
     &eaPathRen2012  = "";
     &eaPathRen2011  = "";
     &eaPathRen2010  = "";
     &eaPathRen2009  = "";
     &eaPathRen2008  = "";
     &eaPathRen2007  = "";
     &eaPathRen2006  = "";
     &eaPathRen2005  = "";
     &eaPathRen2004  = "";
     &eaPathRen2003  = "";
     &eaPathRen2002  = "";
     &eaPathRen2001  = "";
     &eaPathRen2000  = "";
     &eaPathRen1999  = "";
     &eaPathRen1998  = "";
     &eaPathRen1997  = "";
     &eaPathRen1996  = "";
     &eaPathRen1995  = "";
     &eaPathRen1994  = "";
     &eaPathFacturar = "";
     &eaPathLaboral  = "";
     &eaPathIntegral = "";
     &eaPathDsmodelo = "";
     &eaPathFiscal   = "";
     &eaPathDsArchi  = "";

     &eaPasaCact     = "";
     &eaPasaNuct     = "";
     &eaPasaCont     = "";
     &eaPasaFisc     = "";
     &eaPasaSoci     = "";
     &eaPasaRent     = "";
     &eaPasaLabo     = "";
     &eaPasaFact     = "";
     &eaPasaMaes     = "";
     &eaPasaArch     = "";
     &eaPasaR1994    = "";
     &eaPasaR1995    = "";
     &eaPasaR1996    = "";
     &eaPasaR1997    = "";
     &eaPasaR1998    = "";
     &eaPasaR1999    = "";
     &eaPasaR2000    = "";
     &eaPasaR2001    = "";
     &eaPasaR2002    = "";
     &eaPasaR2003    = "";
     &eaPasaR2004    = "";
     &eaPasaR2005    = "";
     &eaPasaR2006    = "";
     &eaPasaR2007    = "";
     &eaPasaR2008    = "";
     &eaPasaR2009    = "";
     &eaPasaR2010    = "";
     &eaPasaR2011    = "";
     &eaPasaR2012    = "";
     &eaPasaR2013    = "";
     &eaPasaR2014    = "";
     &eaPasaR2015    = "";
     &eaPasaR2016    = "";
     &eaPasaR2017    = "";
     &eaPasaR2018    = "";
     &eaPasaR2019    = "";

     &eaDSMAC        = "";
     &aPathFich      = "";
     &eaEjec         = "";
     &enPorDepart    = 0;
     &enEmpAntARCHI  = 0;
     &enEmpNueARCHI  = 0;
     &eaAplica       = "";
     &eaTab          = "";

     &eaDDef         = "";
     &eaHDef         = "";
     &enModeloD      = 0;
     nModelo         = 0;
     nSwModelo       = 0;
     &enEmpresaA     = 0;
     &enAnyo         = 0;
     nSw2000         = 0;
     nSw2001         = 0;
     nSw2002         = 0;
     nSw2003         = 0;
     nSw2004         = 0;
     nSw2005         = 0;
     nSw2006         = 0;
     nSw2007         = 0;
     nSw2008         = 0;
     nSw2009         = 0;
     nSw2010         = 0;
     nSw2011         = 0;
     nSw2012         = 0;
     nSw2013         = 0;
     nSw2014         = 0;
|FIN;

|PROCESO Graba001;
     aPath     = eaPathFacturar;
     aPathFich = aPath + "fich/" + (("00" + #facemp#0) % -102) + "/";

     |PATH_DAT #asclient#aPathFich#;

     |ABRE #asclient;
     #asclient#0 = enEmpresaN;
     |LEE 141#asclient.=;
     |SI FSalida = 0;
         #asclient#52 = eaPasaNuct;
         |GRABA 020#asclient.a;
     |FINSI;
     |LIBERA #asclient;
     |CIERRA #asclient;

     |SI eaPathIntegral ! "";
          |ABRE #dsam0010;
          #dsam0010#0 = enEmpresaN;
          #dsam0010#1 = #facemp#0;
          |LEE 141#dsam0010.=;
          |SI FSalida = 0;
               #dsam0010#15 = eaPasaNuct;
               |GRABA 020#dsam0010.a;
          |FINSI;
          |LIBERA #dsam0010;
          |CIERRA #dsam0010;
    |FINSI;
|FPRC;

|DEFBUCLE facempCta;
     #facemp#2;
     ;
     "S", nDEmpresa;
     "S", nHEmpresa;
     ;
     NULL, Graba001;
|FIN;

|PROCESO Graba000; ||Cambia cuenta contable Cliente para Facturacion
     |SI eaPathIntegral ! "";  |Y #dsborrad#7 = "SI";
         |ABRE #dsam0000;
         #dsam0000#0 = enEmpresaN;
         |LEE 141#dsam0000.=;
         |SI FSalida = 0;
             #dsam0000#103 = eaPasaNuct;
             |GRABA 020#dsam0000.a;
         |FINSI;
         |LIBERA #dsam0000;
         |CIERRA #dsam0000;
     |FINSI;

     |SI eaPathFacturar ! "";  |Y #dsborrad#6 = "SI";
         nDEmpresa = 0;
         nHEmpresa = 99;
         |SI enEmpFac ! -1;
             nDEmpresa = enEmpFac;
             nHEmpresa = enEmpFac;
         |FINSI;
         |BUCLE facempCta;
     |FINSI;
|FPRC;

|PROCESO Graba51;
     #dsam0051#0  = #dsam0000#3;
     #dsam0051#1  = #agicen14#1;
     |LEE 101#dsam0051.=;
     |SI FSalida ! 0;
         |DDEFECTO #dsam0051;
         #dsam0051#0  = #dsam0000#3;
         #dsam0051#1  = #agicen14#1;
         |GRABA 020#dsam0051.b;
     |FINSI;

     #dsam0051#2  = #agicen14#2;
     #dsam0051#3  = #agicen14#3;
     #dsam0051#4  = #agicen14#4;
     #dsam0051#5  = #agicen14#5;
     #dsam0051#6  = #agicen14#6;
     #dsam0051#7  = #agicen14#7;
     #dsam0051#8  = #agicen14#8;
     #dsam0051#9  = #agicen14#9;
     #dsam0051#10 = #agicen14#10;
     #dsam0051#11 = #agicen14#11;
     #dsam0051#12 = #agicen14#12;
     #dsam0051#13 = #agicen14#13;
     #dsam0051#14 = #agicen14#14;
     |GRABA 000#dsam0051.a;
     |LIBERA #dsam0051;
|FPRC;

|DEFBUCLE agicen14;
     #agicen14#1;
     ;
     #dsam0000#0, 00;
     #dsam0000#0, 99;
     be;
     NULL, Graba51;
|FIN;

|PROCESO Graba52;
     #dsam0052#0  = #dsam0000#3;
     #dsam0052#1  = #dsam0008#1;
     |LEE 101#dsam0052.=;
     |SI FSalida ! 0;
         |DDEFECTO #dsam0052;
         #dsam0052#0  = #dsam0000#3;
         #dsam0052#1  = #dsam0008#1;
         |GRABA 020#dsam0052.b;
     |FINSI;

     |PARA nCampo = 2;  |SI nCampo [ 18;  |HACIENDO nCampo = nCampo + 1;
           #dsam0052#nCampo# = #dsam0008#nCampo#;
     |SIGUE;

     |GRABA 000#dsam0052.a;
     |LIBERA #dsam0052;
|FPRC;

|DEFBUCLE dsam0008;
     #dsam0008#1;
     ;
     #dsam0000#0, 00;
     #dsam0000#0, 99;
     ;
     NULL, Graba52;
|FIN;

|PROCESO GrabaHisCli;
     |ABRE #dsam0000;
     #dsam0000#0 = #dsborrad#8;
     |LEE 040#dsam0000.=;
     |SI FSalida ! 0;  |CIERRA #dsam0000;  |ACABA;  |FINSI;
     |CIERRA #dsam0000;

     |ABRE #dsam0050;
     #dsam0050#0  = #dsam0000#3;
     |LEE 101#dsam0050.=;
     |SI FSalida ! 0;
         |DDEFECTO #dsam0050;
         #dsam0050#0  = #dsam0000#3;
         |GRABA 020#dsam0050.b;
     |FINSI;

     #dsam0050#1  = #dsam0000#1;   #dsam0050#2  = #dsam0000#2;
     #dsam0050#3  = #dsam0000#4;   #dsam0050#4  = #dsam0000#5;   #dsam0050#5  = #dsam0000#6;
     #dsam0050#6  = #dsam0000#7;   #dsam0050#7  = #dsam0000#8;   #dsam0050#8  = #dsam0000#9;
     #dsam0050#9  = #dsam0000#10;  #dsam0050#10 = #dsam0000#11;  #dsam0050#11 = #dsam0000#12;
     #dsam0050#12 = #dsam0000#13;  #dsam0050#13 = #dsam0000#14;  #dsam0050#14 = #dsam0000#15;
     #dsam0050#15 = #dsam0000#16;  #dsam0050#16 = #dsam0000#17;  #dsam0050#17 = #dsam0000#18;
     #dsam0050#18 = #dsam0000#19;  #dsam0050#19 = #dsam0000#20;  #dsam0050#20 = #dsam0000#21;
     #dsam0050#21 = #dsam0000#22;  #dsam0050#22 = #dsam0000#23;  #dsam0050#23 = #dsam0000#24;
     #dsam0050#24 = #dsam0000#25;  #dsam0050#25 = #dsam0000#26;  #dsam0050#26 = #dsam0000#27;
     #dsam0050#27 = #dsam0000#28;  #dsam0050#28 = #dsam0000#50;  #dsam0050#29 = #dsam0000#51;
     #dsam0050#30 = #dsam0000#52;  #dsam0050#31 = #dsam0000#53;  #dsam0050#33 = #dsam0000#54;
     #dsam0050#35 = #dsam0000#55;  #dsam0050#36 = #dsam0000#72;
     #dsam0050#37 = Usuario % 810;
     #dsam0050#38 = ~;

     |HORA aHora;

     #dsam0050#39 = aHora;

     |GRABA 000#dsam0050.a;
     |LIBERA #dsam0050;
     |CIERRA #dsam0050;

     |SI eaPathBasica ! "";
         |ABRE #dsam0051;
         |BUCLE agicen14;
         |CIERRA #dsam0051;
     |FINSI;

     |ABRE #dsam0052;
     |BUCLE dsam0008;
     |CIERRA #dsam0052;
|FPRC;

|PROCESO TrataDSARCHI;
     |DBASS aBaseDSARCHI;   |QBF aBaseDSARCHI;
     aMas = aBaseDSARCHI + "dsarchi/def/dsarz016.mas";
     |XABRE "E", aMas, nHandle;
     |SI FSalida < 0;  |ACABA;  |FINSI;

     eaPasaCont = #dsborrad#1;
     aAlfa = "|:dsarchi/dsarz016;" + aAlfa;
     |SUB_EJECUTA aAlfa;
|FPRC;

|PROCESO dsam0054;
     |ABRE #dsam0121;
     #dsam0121#0 = #referen@#10;
     |LEE 040#dsam0121.=;
     |SI FSalida ! 0;
         |CIERRA #dsam0121;
         |ACABA;
     |FINSI;
     |CIERRA #dsam0121;

     |HAZ CogeMac;

     |ABRE #dsam0122;
     #dsam0122#0 = #referen@#10;
     #dsam0122#1 = eaDSMAC;
     |LEE 040#dsam0122.=;
     |SI FSalida ! 0;
         |CIERRA #dsam0122;
         |ACABA;
     |FINSI;
     |CIERRA #dsam0122;

     |SI enCambioCli = 0;  |O enCambioCli = 2;  |O enCambioCli = 4;
         aAlfa = #dsam0122#3;  |QBF aAlfa;
         aAlfa = aAlfa + "\" + #referen@#3;  |QBF aAlfa;
         |RFBORRA aAlfa;
     |SINO;
         aAlfa = #dsam0122#3;  |QBF aAlfa;
         aAlfa = aAlfa + "\" + #referen@#3;  |QBF aAlfa;
         aOrigen  = aAlfa;

         aAlfa  = #referen@#3;  |QBT aAlfa;
         aAlfa1 = aAlfa % 103;
         aAlfa2 = (("00000" + enEmpresaN) % -105);
         aAlfa3 = (aAlfa % -108);
         aAlfa  = aAlfa1 + aAlfa2 + aAlfa3;
         #referen@#3 = aAlfa;

         aAlfa = #dsam0122#3;  |QBF aAlfa;
         aAlfa = aAlfa + "\" + #referen@#3;  |QBF aAlfa;
         aDestino = aAlfa;

         |RRENOMBRA_FICHERO aOrigen, aDestino;
     |FINSI;
|FPRC;

|PROCESO megwordl;
     |DBASS aBase;   |QBF aBase;
     aBase = aBase + "contasoc/";
     aOrigen  = aBase + "emisiones/" + (("00000" + #dsborrad#8) % -105) + "/" + #referen@#1 + "/" + #referen@#2;
     |QBF aOrigen;

     |SI enCambioCli = 1;
         aAlfa = aBase + "emisiones/" + (("00000" + enEmpresaN) % -105) + "/";
         |MKDIR aAlfa;
         aAlfa = aAlfa + #referen@#1 + "/";
         |MKDIR aAlfa;
         aDestino = aBase + "emisiones/" + (("00000" + enEmpresaN) % -105) + "/" + #referen@#1 + "/" + #referen@#2;
         |QBF aDestino;
         |COPIA_FICHERO aOrigen, aDestino;
     |FINSI;

     |FBORRA aOrigen;
|FPRC;

|PROCESO Borrado;
     nContador = nContador + 1;

     |BORRA 000#referen@.a;
     |LIBERA #referen@;

     |SI aFichero = "dsam0054.mas";  |HAZ dsam0054;  |FINSI;
     |SI aFichero = "megwordl.mas";  |HAZ megwordl;  |FINSI;
|FPRC;

|PROCESO Cambio;
     |SI nCampoClave = 1;
         #referen@#nCampoCli# = enEmpresaN;
         |GRABA 000#referen@.a;
         |LIBERA #referen@;
         |ACABA;
     |FINSI;

     |SALVA_DATOS #referen@;

     #referen@#nCampoCli# = enEmpresaN;

     |SI aFichero = "dsam0054.mas";
         aAlfa  = #referen@#3;  |QBT aAlfa;
         aAlfa1 = aAlfa % 103;
         aAlfa2 = (("00000" + enEmpresaN) % -105);
         aAlfa3 = (aAlfa % -108);
         aAlfa  = aAlfa1 + aAlfa2 + aAlfa3;
         #referen@#3 = aAlfa;
     |FINSI;

     |GRABA 000#referen@.n;

     |REPON_DATOS #referen@;
     |LIBERA #referen@;

     |SI aFichero = "dsam0054.mas";  |HAZ dsam0054;  |FINSI;
     |SI aFichero = "megwordl.mas";  |HAZ megwordl;  |FINSI;

     |LEE 101#referen@.=;
     |BORRA 000#referen@.a;
     |LIBERA #referen@;
|FPRC;

|PROCESO QueHago;
     |SI nSwModelo = 1;
         |SI nCampoMod ! 0;
             nNume = nCampoMod - 1;
             |SI #referen@#nNume# ! enModeloD; |ACABA; |FINSI;
         |FINSI;
         |SI aFichero = "dsmom004";
             |SI #referen@#1 = 2000; nSw2000 = 1; |FINSI;
             |SI #referen@#1 = 2001; nSw2001 = 1; |FINSI;
             |SI #referen@#1 = 2002; nSw2002 = 1; |FINSI;
             |SI #referen@#1 = 2003; nSw2003 = 1; |FINSI;
             |SI #referen@#1 = 2004; nSw2004 = 1; |FINSI;
             |SI #referen@#1 = 2005; nSw2005 = 1; |FINSI;
             |SI #referen@#1 = 2006; nSw2006 = 1; |FINSI;
             |SI #referen@#1 = 2007; nSw2007 = 1; |FINSI;
             |SI #referen@#1 = 2008; nSw2008 = 1; |FINSI;
             |SI #referen@#1 = 2009; nSw2009 = 1; |FINSI;
             |SI #referen@#1 = 2010; nSw2010 = 1; |FINSI;
             |SI #referen@#1 = 2011; nSw2011 = 1; |FINSI;
             |SI #referen@#1 = 2012; nSw2012 = 1; |FINSI;
             |SI #referen@#1 = 2013; nSw2013 = 1; |FINSI;
             |SI #referen@#1 = 2014; nSw2014 = 1; |FINSI;
         |FINSI;
     |FINSI;

     |SI enCambioCli = 0;  |O enCambioCli = 2;  |O enCambioCli = 4;
         |HAZ Borrado;
     |SINO;
         |HAZ Cambio;
     |FINSI;

     |PULSATECLA;
|FPRC;

|DEFBUCLE buN;
     #referen@#1001;
     ;
     nDClave1;
     nHClave1;
     be;
     NULL, QueHago;
|FIN;

|DEFBUCLE buNN;
     #referen@#1002;
     ;
     nDClave1, nDClave2;
     nHClave1, nHClave2;
     be;
     NULL, QueHago;
|FIN;

|DEFBUCLE buAN;
     #referen@#1002;
     ;
     aDAlfa1, nDClave1;
     aHAlfa1, nHClave1;
     be;
     NULL, QueHago;
|FIN;

|DEFBUCLE buNA;
     #referen@#1002;
     ;
     nDClave1, aDAlfa1;
     nHClave1, aHAlfa1;
     be;
     NULL, QueHago;
|FIN;

|DEFBUCLE buNNN;
     #referen@#1003;
     ;
     nDClave1, nDClave2, nDClave3;
     nHClave1, nHClave2, nHClave3;
     be;
     NULL, QueHago;
|FIN;

|DEFBUCLE buANN;
     #referen@#1003;
     ;
     aDAlfa1, nDClave1, nDClave2;
     aHAlfa1, nHClave1, nHClave2;
     be;
     NULL, QueHago;
|FIN;

|DEFBUCLE buNNA;
     #referen@#1003;
     ;
     nDClave1, nDClave2, aDAlfa1;
     nHClave1, nHClave2, aHAlfa1;
     be;
     NULL, QueHago;
|FIN;

|DEFBUCLE buNAN;
     #referen@#1003;
     ;
     nDClave1, aDAlfa1, nDClave2;
     nHClave1, aHAlfa1, nHClave2;
     be;
     NULL, QueHago;
|FIN;

|DEFBUCLE buNNNN;
     #referen@#1004;
     ;
     nDClave1, nDClave2, nDClave3, nDClave4;
     nHClave1, nHClave2, nHClave3, nHClave4;
     be;
     NULL, QueHago;
|FIN;

|DEFBUCLE buNNNA;
     #referen@#1004;
     ;
     nDClave1, nDClave2, nDClave3, aDAlfa1;
     nHClave1, nHClave2, nHClave3, aHAlfa1;
     be;
     NULL, QueHago;
|FIN;

|DEFBUCLE buNANN;
     #referen@#1004;
     ;
     nDClave1, aDAlfa1, nDClave2, nDClave3;
     nHClave1, aHAlfa1, nHClave2, nHClave3;
     be;
     NULL, QueHago;
|FIN;

|DEFBUCLE buNNNNN;
     #referen@#1005;
     ;
     nDClave1, nDClave2, nDClave3, nDClave4, nDClave5;
     nHClave1, nHClave2, nHClave3, nHClave4, nHClave5;
     be;
     NULL, QueHago;
|FIN;

|DEFBUCLE buANNNN;
     #referen@#1005;
     ;
     aDAlfa1, nDClave1, nDClave2, nDClave3, nDClave4;
     aHAlfa1, nHClave1, nHClave2, nHClave3, nHClave4;
     be;
     NULL, QueHago;
|FIN;

|DEFBUCLE buNANNN;
     #referen@#1005;
     ;
     nDClave1, aDAlfa1, nDClave2, nDClave3, nDClave4;
     nHClave1, aHAlfa1, nHClave2, nHClave3, nHClave4;
     be;
     NULL, QueHago;
|FIN;

|DEFBUCLE buNNAN;
     #referen@#1004;
     ;
     nDClave1, nDClave2, aDAlfa1, nDClave3;
     nHClave1, nHClave2, aHAlfa1, nHClave3;
     be;
     NULL, QueHago;
|FIN;

|DEFBUCLE buNNANA;
     #referen@#1005;
     ;
     nDClave1, nDClave2, aDAlfa1, nDClave3, aDAlfa2;
     nHClave1, nHClave2, aHAlfa1, nHClave3, aHAlfa2;
     be;
     NULL, QueHago;
|FIN;

|DEFBUCLE buNNANN;
     #referen@#1005;
     ;
     nDClave1, nDClave2, aDAlfa1, nDClave3, nDClave4;
     nHClave1, nHClave2, aHAlfa1, nHClave3, nHClave4;
     be;
     NULL, QueHago;
|FIN;

|DEFBUCLE buNNNNNN;
     #referen@#1006;
     ;
     nDClave1, nDClave2, nDClave3, nDClave4, nDClave5, nDClave6;
     nHClave1, nHClave2, nHClave3, nHClave4, nHClave5, nHClave6;
     be;
     NULL, QueHago;
|FIN;

|DEFBUCLE buNNNNNNN;
     #referen@#1007;
     ;
     nDClave1, nDClave2, nDClave3, nDClave4, nDClave5, nDClave6, nDClave7;
     nHClave1, nHClave2, nHClave3, nHClave4, nHClave5, nHClave6, nHClave7;
     be;
     NULL, QueHago;
|FIN;

|DEFBUCLE buNNNNNA;
     #referen@#1006;
     ;
     nDClave1, nDClave2, nDClave3, nDClave4, nDClave5, aDAlfa1;
     nHClave1, nHClave2, nHClave3, nHClave4, nHClave5, aHAlfa1;
     be;
     NULL, QueHago;
|FIN;

|DEFBUCLE buNNNNNNA;
     #referen@#1007;
     ;
     nDClave1, nDClave2, nDClave3, nDClave4, nDClave5, nDClave6, aDAlfa1;
     nHClave1, nHClave2, nHClave3, nHClave4, nHClave5, nHClave6, aHAlfa1;
     be;
     NULL, QueHago;
|FIN;

|PROCESO PorLectura;
     |DBASE aBaseAqui;   |QBF aBaseAqui;

     aFichSql = ("sql" + Usuario + "zzzzzzzz") % 108;

     aOrigen  = aDef;
     aDestino = aBaseAqui + "def/dsborsql.mas";
     |COPIA_FICHERO aOrigen, aDestino;
     aFich    = aBaseAqui + "fich/";

     |CARGA_DEF aDestino, refesql@;
     |SI FSalida = 0;
         |PATH_DAT #refesql@#aFich#;
         |NOME_DAT #refesql@#aFichSql#;

         aSelect = "SELECT * ";
         aFrom   = "FROM "  + "dsborsql ";
         aInto   = "INTO "  + aFichSql + ".def ";
         aWhere  = "WHERE " + nCampoCli + " == " + #dsborrad#8;
         eaEjec  =  aSelect + aFrom + aInto + aWhere;
         |SUB_EJECUTA_NP "dsborra1;NOMEQUITESQUETECORTOLOSGUEVOS";

         |ABRET #referen@;
         |ABRET #refesql@;
         |LEE 040#refesql@.p;
         |PARA;  |SI FSalida = 0;  |HACIENDO;
              |PARA nCampoDef = 0;  |SI nCampoDef [ nTCampo;  |HACIENDO nCampoDef = nCampoDef + 1;
                    #referen@#nCampoDef# = #refesql@#nCampoDef#;
              |SIGUE;

              |LEE 101#referen@.=;
              |SI FSalida = 0;
                  |HAZ QueHago;
                  |LIBERA #referen@;
              |FINSI;

              |LEE 040#refesql@.s;
          |SIGUE;
          |CIERRAT #referen@;
          |CIERRAT #refesql@;

          |DELINDEX #refesql@;

          |DESCARGA_DEF #refesql@;
     |FINSI;

     aBorrar = aBaseAqui + "def/" + aFichSql  + ".mas";  |FBORRA aBorrar;
     aBorrar = aBaseAqui + "def/" + "dsborsql.mas";      |FBORRA aBorrar;

     aOrigen  = aBaseAqui + "def/dsborsq1.mas";
     aDestino = aBaseAqui + "def/dsborsql.mas";
     |COPIA_FICHERO aOrigen, aDestino;

     |PULSATECLA;
|FPRC;

|PROCESO TrataFichero;
     aDef = aPath + "def/" + aFichero;
     |CARGA_DEF aDef, referen@;
     |SI FSalida ! 0;
         |ACABA;
     |FINSI;

     aQueQuiero = "|NC";
     aCampo     = #referen@#aQueQuiero#;
     nTCampo    = aCampo;
     nTCampo    = nTCampo - 1;

     |PATH_DAT #referen@#aPathFich#;

     |SI aTipoBucle = "N";           |BUCLE buN;           |FINSI;
     |SI aTipoBucle = "NN";          |BUCLE buNN;          |FINSI;
     |SI aTipoBucle = "NA";          |BUCLE buNA;          |FINSI;
     |SI aTipoBucle = "AN";          |BUCLE buAN;          |FINSI;
     |SI aTipoBucle = "NNN";         |BUCLE buNNN;         |FINSI;
     |SI aTipoBucle = "ANN";         |BUCLE buANN;         |FINSI;
     |SI aTipoBucle = "NNA";         |BUCLE buNNA;         |FINSI;
     |SI aTipoBucle = "NAN";         |BUCLE buNAN;         |FINSI;
     |SI aTipoBucle = "NNNA";        |BUCLE buNNNA;        |FINSI;
     |SI aTipoBucle = "NANN";        |BUCLE buNANN;        |FINSI;
     |SI aTipoBucle = "NNNN";        |BUCLE buNNNN;        |FINSI;
     |SI aTipoBucle = "NANNN";       |BUCLE buNANNN;       |FINSI;
     |SI aTipoBucle = "NNAN";        |BUCLE buNNAN;        |FINSI;
     |SI aTipoBucle = "NNANA";       |BUCLE buNNANA;       |FINSI;
     |SI aTipoBucle = "NNANN";       |BUCLE buNNANN;       |FINSI;
     |SI aTipoBucle = "NNNNN";       |BUCLE buNNNNN;       |FINSI;
     |SI aTipoBucle = "ANNNN";       |BUCLE buANNNN;       |FINSI;
     |SI aTipoBucle = "NNNNNA";      |BUCLE buNNNNNA;      |FINSI;
     |SI aTipoBucle = "NNNNNN";      |BUCLE buNNNNNN;      |FINSI;
     |SI aTipoBucle = "NNNNNNN";     |BUCLE buNNNNNNN;     |FINSI;
     |SI aTipoBucle = "NNNNNNA";     |BUCLE buNNNNNNA;     |FINSI;
     |SI aTipoBucle = "";            |HAZ   PorLectura;    |FINSI;

     |DESCARGA_DEF #referen@;
|FPRC;

|PROCESO ClaveNumerica;
     nCampo1 = nCampo;
     nCampo2 = nCampo + 1;
     nCampo3 = nCampo + 2;

     nPosClave = (#dsficher#29 * 3) + 3;
     |SI nPosClave = nCampo1;
         |SI nClave = 1; nDClave1 = #dsborrad#8;  nHClave1 = #dsborrad#8;  |FINSI;
         |SI nClave = 2; nDClave2 = #dsborrad#8;  nHClave2 = #dsborrad#8;  |FINSI;
         |SI nClave = 3; nDClave3 = #dsborrad#8;  nHClave3 = #dsborrad#8;  |FINSI;
         |SI nClave = 4; nDClave4 = #dsborrad#8;  nHClave4 = #dsborrad#8;  |FINSI;
         |SI nClave = 5; nDClave5 = #dsborrad#8;  nHClave5 = #dsborrad#8;  |FINSI;
         |SI nClave = 6; nDClave6 = #dsborrad#8;  nHClave6 = #dsborrad#8;  |FINSI;
         |SI nClave = 7; nDClave7 = #dsborrad#8;  nHClave7 = #dsborrad#8;  |FINSI;
         |ACABA;
     |FINSI;

     aMaximo = "9" * #dsficher#nCampo2#;
     |SI #dsficher#nCampo3# = 1;
         |SI nClave = 1; nDClave1 = 0;  nHClave1 = aMaximo;  |FINSI;
         |SI nClave = 2; nDClave2 = 0;  nHClave2 = aMaximo;  |FINSI;
         |SI nClave = 3; nDClave3 = 0;  nHClave3 = aMaximo;  |FINSI;
         |SI nClave = 4; nDClave4 = 0;  nHClave4 = aMaximo;  |FINSI;
         |SI nClave = 5; nDClave5 = 0;  nHClave5 = aMaximo;  |FINSI;
         |SI nClave = 6; nDClave6 = 0;  nHClave6 = aMaximo;  |FINSI;
         |SI nClave = 7; nDClave7 = 0;  nHClave7 = aMaximo;  |FINSI;
     |SINO;
         |SI nClave = 1; nDClave1 = aMaximo;   nHClave1 = 0; |FINSI;
         |SI nClave = 2; nDClave2 = aMaximo;   nHClave2 = 0; |FINSI;
         |SI nClave = 3; nDClave3 = aMaximo;   nHClave3 = 0; |FINSI;
         |SI nClave = 4; nDClave4 = aMaximo;   nHClave4 = 0; |FINSI;
         |SI nClave = 5; nDClave5 = aMaximo;   nHClave5 = 0; |FINSI;
         |SI nClave = 6; nDClave6 = aMaximo;   nHClave6 = 0; |FINSI;
         |SI nClave = 7; nDClave7 = aMaximo;   nHClave7 = 0; |FINSI;
     |FINSI;
|FPRC;

|PROCESO ClaveAlfanumerica;
     nCampo1 = nCampo;
     nCampo2 = nCampo + 1;
     nCampo3 = nCampo + 2;

     |SI #dsficher#nCampo1# = "A";
         aMinimo = " " * #dsficher#nCampo2#;
         aMaximo = "z" * #dsficher#nCampo2#;
     |SINO;
         aMinimo = "01.01.0000";
         aMaximo = "31.12.9999";
     |FINSI;

     |SI #dsficher#nCampo3# = 1;
         |SI nClave = 1; aDAlfa1  = aMinimo;  aHAlfa1 = aMaximo;  |FINSI;
         |SI nClave = 2; aDAlfa2  = aMinimo;  aHAlfa2 = aMaximo;  |FINSI;
         |SI nClave = 3; aDAlfa3  = aMinimo;  aHAlfa3 = aMaximo;  |FINSI;
         |SI nClave = 4; aDAlfa4  = aMinimo;  aHAlfa4 = aMaximo;  |FINSI;
         |SI nClave = 5; aDAlfa5  = aMinimo;  aHAlfa5 = aMaximo;  |FINSI;
         |SI nClave = 6; aDAlfa6  = aMinimo;  aHAlfa6 = aMaximo;  |FINSI;
         |SI nClave = 7; aDAlfa7  = aMinimo;  aHAlfa7 = aMaximo;  |FINSI;
     |SINO;
         |SI nClave = 1; aDAlfa1  = aMaximo;  aHAlfa1 = aMinimo;  |FINSI;
         |SI nClave = 2; aDAlfa2  = aMaximo;  aHAlfa2 = aMinimo;  |FINSI;
         |SI nClave = 3; aDAlfa3  = aMaximo;  aHAlfa3 = aMinimo;  |FINSI;
         |SI nClave = 4; aDAlfa4  = aMaximo;  aHAlfa4 = aMinimo;  |FINSI;
         |SI nClave = 5; aDAlfa5  = aMaximo;  aHAlfa5 = aMinimo;  |FINSI;
         |SI nClave = 6; aDAlfa6  = aMaximo;  aHAlfa6 = aMinimo;  |FINSI;
         |SI nClave = 7; aDAlfa7  = aMaximo;  aHAlfa7 = aMinimo;  |FINSI;
     |FINSI;
|FPRC;

|PROCESO ProcedeAlFichero;
     nDClave1 = 0;   nHClave1 = 0;
     nDClave2 = 0;   nHClave2 = 0;
     nDClave3 = 0;   nHClave3 = 0;
     nDClave4 = 0;   nHClave4 = 0;
     nDClave5 = 0;   nHClave5 = 0;
     nDClave6 = 0;   nHClave6 = 0;
     nDClave7 = 0;   nHClave7 = 0;
     aDAlfa1  = "";  aHAlfa1  = "";
     aDAlfa2  = "";  aHAlfa2  = "";
     aDAlfa3  = "";  aHAlfa3  = "";
     aDAlfa4  = "";  aHAlfa4  = "";
     aDAlfa5  = "";  aHAlfa5  = "";
     aDAlfa6  = "";  aHAlfa6  = "";
     aDAlfa7  = "";  aHAlfa7  = "";

     aFichero    = #dsficher#1;   |QBF aFichero;
     nCampoCli   = #dsficher#4;
     nCampoMod   = #dsficher#31;

     nCampoClave = 0;
     |SI #dsficher#5  = "N";  nCampoClave = 1;  |FINSI;

     |ATRI S;
     |PINTA 2258, aFichero;
     |ATRI s;

     |SI aFichero = "dspase15.mas";  |Y enTransfor = 1;
         |ACABA;
     |FINSI;

     |SI aFichero = "dsam0000.mas";
         |SI enCambioCli = 0;  |O enCambioCli = 2;
             |SI enBorraTodo = 0;
                 |ACABA;
             |FINSI;
         |FINSI;
     |FINSI;

     aTipoBucle = "";

     |SI #dsficher#3 = "N      ";
         nClave = 1;  nCampo = 6;  |HAZ ClaveNumerica;
         aTipoBucle = #dsficher#3;
     |FINSI;

     |SI #dsficher#3 = "NN     ";
         nClave = 1;  nCampo = 6;  |HAZ ClaveNumerica;
         nClave = 2;  nCampo = 9;  |HAZ ClaveNumerica;
         aTipoBucle = #dsficher#3;
     |FINSI;

     |SI #dsficher#3 = "NA     ";
         nClave = 1;  nCampo = 6;  |HAZ ClaveNumerica;
         nClave = 1;  nCampo = 9;  |HAZ ClaveAlfanumerica;
         aTipoBucle = #dsficher#3;
     |FINSI;

     |SI #dsficher#3 = "AN     ";
         nClave = 1;  nCampo = 6;  |HAZ ClaveAlfanumerica;
         nClave = 1;  nCampo = 9;  |HAZ ClaveNumerica;
         aTipoBucle = #dsficher#3;
     |FINSI;

     |SI #dsficher#3 = "NNN    ";
         nClave = 1;  nCampo = 6;  |HAZ ClaveNumerica;
         nClave = 2;  nCampo = 9;  |HAZ ClaveNumerica;
         nClave = 3;  nCampo = 12; |HAZ ClaveNumerica;
         aTipoBucle = #dsficher#3;
     |FINSI;

     |SI #dsficher#3 = "ANN    ";
         nClave = 1;  nCampo = 6;  |HAZ ClaveAlfanumerica;
         nClave = 1;  nCampo = 9;  |HAZ ClaveNumerica;
         nClave = 2;  nCampo = 12; |HAZ ClaveNumerica;
         aTipoBucle = #dsficher#3;
     |FINSI;

     |SI #dsficher#3 = "NNA    ";
         nClave = 1;  nCampo = 6;  |HAZ ClaveNumerica;
         nClave = 2;  nCampo = 9;  |HAZ ClaveNumerica;
         nClave = 1;  nCampo = 12; |HAZ ClaveAlfanumerica;
         aTipoBucle = #dsficher#3;
     |FINSI;

     |SI #dsficher#3 = "NAN    ";
         nClave = 1;  nCampo = 6;  |HAZ ClaveNumerica;
         nClave = 1;  nCampo = 9;  |HAZ ClaveAlfanumerica;
         nClave = 2;  nCampo = 12; |HAZ ClaveNumerica;
         aTipoBucle = #dsficher#3;
     |FINSI;

     |SI #dsficher#3 = "NNNA   ";
         nClave = 1;  nCampo = 6;  |HAZ ClaveNumerica;
         nClave = 2;  nCampo = 9;  |HAZ ClaveNumerica;
         nClave = 3;  nCampo = 12; |HAZ ClaveNumerica;
         nClave = 1;  nCampo = 15; |HAZ ClaveAlfanumerica;
         aTipoBucle = #dsficher#3;
     |FINSI;

     |SI #dsficher#3 = "NNNN   ";
         nClave = 1;  nCampo = 6;  |HAZ ClaveNumerica;
         nClave = 2;  nCampo = 9;  |HAZ ClaveNumerica;
         nClave = 3;  nCampo = 12; |HAZ ClaveNumerica;
         nClave = 4;  nCampo = 15; |HAZ ClaveNumerica;
         aTipoBucle = #dsficher#3;
     |FINSI;

     |SI #dsficher#3 = "NANN   ";
         nClave = 1;  nCampo = 6;  |HAZ ClaveNumerica;
         nClave = 1;  nCampo = 9;  |HAZ ClaveAlfanumerica;
         nClave = 2;  nCampo = 12; |HAZ ClaveNumerica;
         nClave = 3;  nCampo = 15; |HAZ ClaveNumerica;
         aTipoBucle = #dsficher#3;
     |FINSI;

     |SI #dsficher#3 = "NNNNN  ";
         nClave = 1;  nCampo = 6;  |HAZ ClaveNumerica;
         nClave = 2;  nCampo = 9;  |HAZ ClaveNumerica;
         nClave = 3;  nCampo = 12; |HAZ ClaveNumerica;
         nClave = 4;  nCampo = 15; |HAZ ClaveNumerica;
         nClave = 5;  nCampo = 18; |HAZ ClaveNumerica;
         aTipoBucle = #dsficher#3;
     |FINSI;

     |SI #dsficher#3 = "NANNN  ";
         nClave = 1;  nCampo = 6;  |HAZ ClaveNumerica;
         nClave = 1;  nCampo = 9;  |HAZ ClaveAlfanumerica;
         nClave = 2;  nCampo = 12; |HAZ ClaveNumerica;
         nClave = 3;  nCampo = 15; |HAZ ClaveNumerica;
         nClave = 4;  nCampo = 18; |HAZ ClaveNumerica;
         aTipoBucle = #dsficher#3;
     |FINSI;

     |SI #dsficher#3 = "NNAN   ";
         nClave = 1;  nCampo = 6;  |HAZ ClaveNumerica;
         nClave = 2;  nCampo = 9;  |HAZ ClaveNumerica;
         nClave = 1;  nCampo = 12; |HAZ ClaveAlfanumerica;
         nClave = 3;  nCampo = 15; |HAZ ClaveNumerica;
         aTipoBucle = #dsficher#3;
     |FINSI;

     |SI #dsficher#3 = "NNANA  ";
         nClave = 1;  nCampo = 6;  |HAZ ClaveNumerica;
         nClave = 2;  nCampo = 9;  |HAZ ClaveNumerica;
         nClave = 1;  nCampo = 12; |HAZ ClaveAlfanumerica;
         nClave = 3;  nCampo = 15; |HAZ ClaveNumerica;
         nClave = 2;  nCampo = 18; |HAZ ClaveAlfanumerica;
         aTipoBucle = #dsficher#3;
     |FINSI;

     |SI #dsficher#3 = "NNANN  ";
         nClave = 1;  nCampo = 6;  |HAZ ClaveNumerica;
         nClave = 2;  nCampo = 9;  |HAZ ClaveNumerica;
         nClave = 1;  nCampo = 12; |HAZ ClaveAlfanumerica;
         nClave = 3;  nCampo = 15; |HAZ ClaveNumerica;
         nClave = 4;  nCampo = 18; |HAZ ClaveNumerica;
         aTipoBucle = #dsficher#3;
     |FINSI;

     |SI #dsficher#3 = "ANNNN  ";
         nClave = 1;  nCampo = 6;  |HAZ ClaveAlfanumerica;
         nClave = 1;  nCampo = 9;  |HAZ ClaveNumerica;
         nClave = 2;  nCampo = 12; |HAZ ClaveNumerica;
         nClave = 3;  nCampo = 15; |HAZ ClaveNumerica;
         nClave = 4;  nCampo = 18; |HAZ ClaveNumerica;
         aTipoBucle = #dsficher#3;
     |FINSI;

     |SI #dsficher#3 = "NNNNNN ";
         nClave = 1;  nCampo = 6;  |HAZ ClaveNumerica;
         nClave = 2;  nCampo = 9;  |HAZ ClaveNumerica;
         nClave = 3;  nCampo = 12; |HAZ ClaveNumerica;
         nClave = 4;  nCampo = 15; |HAZ ClaveNumerica;
         nClave = 5;  nCampo = 18; |HAZ ClaveNumerica;
         nClave = 6;  nCampo = 21; |HAZ ClaveNumerica;
         aTipoBucle = #dsficher#3;
     |FINSI;

     |SI #dsficher#3 = "NNNNNNN";
         nClave = 1;  nCampo = 6;  |HAZ ClaveNumerica;
         nClave = 2;  nCampo = 9;  |HAZ ClaveNumerica;
         nClave = 3;  nCampo = 12; |HAZ ClaveNumerica;
         nClave = 4;  nCampo = 15; |HAZ ClaveNumerica;
         nClave = 5;  nCampo = 18; |HAZ ClaveNumerica;
         nClave = 6;  nCampo = 21; |HAZ ClaveNumerica;
         nClave = 7;  nCampo = 24; |HAZ ClaveNumerica;
         aTipoBucle = #dsficher#3;
     |FINSI;

     |SI #dsficher#3 = "NNNNNA ";
         nClave = 1;  nCampo = 6;  |HAZ ClaveNumerica;
         nClave = 2;  nCampo = 9;  |HAZ ClaveNumerica;
         nClave = 3;  nCampo = 12; |HAZ ClaveNumerica;
         nClave = 4;  nCampo = 15; |HAZ ClaveNumerica;
         nClave = 5;  nCampo = 18; |HAZ ClaveNumerica;
         nClave = 1;  nCampo = 21; |HAZ ClaveAlfanumerica;
         aTipoBucle = #dsficher#3;
     |FINSI;

     |SI #dsficher#3 = "NNNNNNA";
         nClave = 1;  nCampo = 6;  |HAZ ClaveNumerica;
         nClave = 2;  nCampo = 9;  |HAZ ClaveNumerica;
         nClave = 3;  nCampo = 12; |HAZ ClaveNumerica;
         nClave = 4;  nCampo = 15; |HAZ ClaveNumerica;
         nClave = 5;  nCampo = 18; |HAZ ClaveNumerica;
         nClave = 6;  nCampo = 21; |HAZ ClaveNumerica;
         nClave = 1;  nCampo = 24; |HAZ ClaveAlfanumerica;
         aTipoBucle = #dsficher#3;
     |FINSI;

     |SI aFichero = "dsmom003.mas";
         aTipoBucle = "";
     |FINSI;

     |QBF aTipoBucle;
     |HAZ TrataFichero;

     |SI #dsficher#27 = "S";  |Y #dsborrad#8 ! 0;
         |SI enCambioCli = 1;
             nCampoCli   = #dsficher#28;
             nCampoClave = 1;
             aTipoBucle = "";
             |HAZ TrataFichero;
         |FINSI;
     |FINSI;

     |PULSATECLA;
|FPRC;

|DEFBUCLE dsficher;
     #dsficher#1;
     ;
     aAplica, aDDef;
     aAplica, aHDef;
     ;
     NULL, ProcedeAlFichero;
|FIN;

|DEFBUCLE dsficher_Mod;
     #dsficher#1;
     30;
     aAplica, aDDef, nModelo;
     aAplica, aHDef, nModelo;
     ;
     NULL, ProcedeAlFichero;
|FIN;

|PROCESO Facturar;
     aPath     = eaPathFacturar;
     aPathFich = aPath + "fich/" + (("00" + #facemp#0) % -102) + "/";
     aAplica   = "facturar";
     aDDef     = "";
     aHDef     = "zzzzzzzzzzzz";
     |BUCLE dsficher;
|FPRC;

|DEFBUCLE facemp;
     #facemp#1;
     3;
     nDEmpresa, "S";
     nHEmpresa, "S";
     ;
     NULL, Facturar;
|FIN;

|PROCESO CambiaDirectorio;
     aDirFichDestino = aPath + "fich/" + (("00000" + enEmpresaN) % -105) + #canempre#3 + "/";

     |MKDIR aDirFichDestino;

     aDirecBuscar = aPathFich + "*.*";
     |_PDIR aDirecBuscar;
     |PARA; |SI FSalida = 0; |HACIENDO;
            aFichero = aDirecBuscar - aPathFich;
            aOrigen  = aDirecBuscar;
            aDestino = aDirFichDestino + aFichero;
            |COPIA_FICHERO aOrigen, aDestino;

            |_SDIR aDirecBuscar;
     |SIGUE;

     aAlfa = aDir + "bin/agirm -r " + aPathFich;
     |SYSTEM aAlfa;

     |SALVA_DATOS #canempre;

     #canempre#2 = enEmpresaN;
     #canempre#0  = (#canempre#2 * 10) + #canempre#3;

     aAlfa = #canempre#29 % 205; nNume = aAlfa;
     |SI nNume = #dsborrad#8;
         aAlfa = #canempre#29 % 106;
         aAlfa = #canempre#29 - aAlfa;
         aAlfa = "[" + (("00000" + enEmpresaN) % -105) + aAlfa;
         #canempre#29 = aAlfa;
     |FINSI;
     |GRABA 000#canempre.n;

     |REPON_DATOS #canempre;
     |LIBERA #canempre;
     |LEE 101#canempre.=;
     |BORRA 000#canempre.a;
     |LIBERA #canempre;
|FPRC;

|PROCESO Contabilidad;
     aPath     = eaPathContagen;
     aPathFich = aPath + "fich/" + (("00000" + #canempre#2) % -105) + #canempre#3 + "/";

     aDir = "";
     |DIRECTORIO aDir;
     |SI enCambioCli = 0;  |O enCambioCli = 2;  |O enCambioCli = 4;
         aAlfa = aDir + "bin/agirm -r " + aPathFich;
         |SYSTEM aAlfa;

         |BORRA 000#canempre.a;
         |LIBERA #canempre;
     |SINO;
         |HAZ CambiaDirectorio;
     |FINSI;
|FPRC;

|DEFBUCLE canempre;
     #canempre#1;
     ;
     #dsborrad#8, 0;
     #dsborrad#8, 9;
     be;
     NULL, Contabilidad;
|FIN;

|PROCESO BorraAnyos;
     nSw2000 = 0;
     nSw2001 = 0;
     nSw2002 = 0;
     nSw2003 = 0;
     nSw2004 = 0;
     nSw2005 = 0;
     nSw2006 = 0;
     nSw2007 = 0;
     nSw2008 = 0;
     nSw2009 = 0;
     nSw2010 = 0;
     nSw2011 = 0;
     nSw2012 = 0;
     nSw2013 = 0;
     nSw2014 = 0;
|FPRC;

|PROCESO PorModelos;
     || ... Los que afectan directamente al Modelos
     |HAZ BorraAnyos;
     nSwModelo = 0;
     nModelo   = enModeloD;
     aDDef     = "";
     aHDef     = "zzzzzzzzzzzz";
     |BUCLE dsficher_Mod;

     |SI enModeloD = 300; |O enModeloD = 303; |O enModeloD = 310;
      |O enModeloD = 320; |O enModeloD = 330;
      |O enModeloD = 332; |O enModeloD = 370;   ||ficheros de iva
              nSwModelo = 1;
              nModelo   = 399;
              aDDef     = "";
              aHDef     = "zzzzzzzzzzzz";
              |BUCLE dsficher_Mod;
     |FINSI;

     |SI enModeloD = 303; |O enModeloD = 370;   ||ficheros de prorrata
         nSwModelo = 1;
         nModelo   = 398;
         aDDef     = "";
         aHDef     = "zzzzzzzzzzzz";
         |BUCLE dsficher_Mod;
     |FINSI;

     |SI enModeloD = 303; |O enModeloD = 349;   ||ficheros de prorrata
         nSwModelo = 1;
         nModelo   = 397;
         aDDef     = "";
         aHDef     = "zzzzzzzzzzzz";
         |BUCLE dsficher_Mod;
     |FINSI;

     |SI enModeloD = 130; |O enModeloD = 131;   ||ficheros de utilidades IRPF
         nSwModelo = 1;
         nModelo   = 139;
         aDDef     = "";
         aHDef     = "zzzzzzzzzzzz";
         |BUCLE dsficher_Mod;
     |FINSI;

     |SI enModeloD ! 600; |Y enModeloD ! 210;
         |Y enModeloD ! 211; |Y enModeloD ! 309;  || en planing
              nSwModelo = 1;
              nModelo   = 999;
              aDDef     = "";
              aHDef     = "zzzzzzzzzzzz";
              |BUCLE dsficher_Mod;
     |FINSI;
     nSwModelo = 0;

     enEmpresaA = #dsborrad#8;
     |SI nSw2000 = 1; enAnyo = 2000; |SUB_EJECUTA_NP ":modelos/dsmoz001"; |FINSI;
     |SI nSw2001 = 1; enAnyo = 2001; |SUB_EJECUTA_NP ":modelos/dsmoz001"; |FINSI;
     |SI nSw2002 = 1; enAnyo = 2002; |SUB_EJECUTA_NP ":modelos/dsmoz001"; |FINSI;
     |SI nSw2003 = 1; enAnyo = 2003; |SUB_EJECUTA_NP ":modelos/dsmoz001"; |FINSI;
     |SI nSw2004 = 1; enAnyo = 2004; |SUB_EJECUTA_NP ":modelos/dsmoz001"; |FINSI;
     |SI nSw2005 = 1; enAnyo = 2005; |SUB_EJECUTA_NP ":modelos/dsmoz001"; |FINSI;
     |SI nSw2006 = 1; enAnyo = 2006; |SUB_EJECUTA_NP ":modelos/dsmoz001"; |FINSI;
     |SI nSw2007 = 1; enAnyo = 2007; |SUB_EJECUTA_NP ":modelos/dsmoz001"; |FINSI;
     |SI nSw2008 = 1; enAnyo = 2008; |SUB_EJECUTA_NP ":modelos/dsmoz001"; |FINSI;
     |SI nSw2009 = 1; enAnyo = 2009; |SUB_EJECUTA_NP ":modelos/dsmoz001"; |FINSI;
     |SI nSw2010 = 1; enAnyo = 2010; |SUB_EJECUTA_NP ":modelos/dsmoz001"; |FINSI;
     |SI nSw2011 = 1; enAnyo = 2011; |SUB_EJECUTA_NP ":modelos/dsmoz001"; |FINSI;
     |SI nSw2012 = 1; enAnyo = 2012; |SUB_EJECUTA_NP ":modelos/dsmoz001"; |FINSI;
     |SI nSw2013 = 1; enAnyo = 2013; |SUB_EJECUTA_NP ":modelos/dsmoz001"; |FINSI;
     |SI nSw2014 = 1; enAnyo = 2014; |SUB_EJECUTA_NP ":modelos/dsmoz001"; |FINSI;

     |HAZ BorraAnyos;
     |PULSATECLA;
|FPRC;

|PROCESO Seleccion;

     |PINTA 2209, "                                                              ";

     |SI eaPathIntegral ! "";  |Y #dsborrad#7 = "SI";
         |SI enBajaCli = 1;
             |HAZ GrabaHisCli;
         |FINSI;
     |FINSI;

     |SI eaPathDsmodelo ! "";  |Y #dsborrad#2 ! "NO";
         |ATRI S;
         |PINTA 2210, "TRATANDO FICHEROS EN MODELOS             ";
         |ATRI s;
         aPath     = eaPathDsmodelo;
         aPathFich = aPath + "fich/";
         aAplica   = "modelos";
         |SI enPorDepart = 11;
             |SI eaDDef = "Modelo110"; |O eaHDef = "Modelo110";
                 aDDef  = "dsmoc110.mas";  aHDef = "dsmoc111.mas";  |BUCLE dsficher;
                 aDDef  = "dsmod110.mas";  aHDef = "dsmod110.mas";  |BUCLE dsficher;
                 aDDef  = "dsm11101.mas";  aHDef = "dsm11101.mas";  |BUCLE dsficher;
             |FINSI;
             |SI eaDDef = "Modelo190"; |O eaHDef = "Modelo190";
                 aDDef  = "dsm190ca.mas";  aHDef = "dsm190li.mas";  |BUCLE dsficher;
             |FINSI;
         |SINO;
             |SI enModeloD ! 0; |Y #dsborrad#2 = "PA";
                 |HAZ PorModelos;
             |SINO;
                 aDDef     = "";
                 aHDef     = "zzzzzzzzzzzz";
                 |BUCLE dsficher;
             |FINSI;
         |FINSI;
     |FINSI;

     |SI eaPathLaboral  ! "";  |Y #dsborrad#5 = "SI";
         |ATRI S;
         |PINTA 2210, "TRATANDO FICHEROS EN LABORAL             ";
         |ATRI s;
         aPath     = eaPathLaboral;
         aPathFich = aPath + "fich/";
         aAplica   = "laboral";
         aDDef     = "";
         aHDef     = "zzzzzzzzzzzz";
         |BUCLE dsficher;
     |FINSI;

     |SI eaPathContanex ! "";  |Y #dsborrad#1 = "SI";
         |ATRI S;
         |PINTA 2210, "TRATANDO FICHEROS EN UTILES CONTABILIDAD ";
         |ATRI s;
         aPath     = eaPathContanex;
         aPathFich = aPath + "fich/";
         aAplica   = "contanex";
         aDDef     = "";
         aHDef     = "zzzzzzzzzzzz";
         |BUCLE dsficher;
     |FINSI;

     |SI eaPathContasoc ! "";  |Y #dsborrad#3 = "SI";
         |ATRI S;
         |PINTA 2210, "TRATANDO FICHEROS EN SOCIEDADES         ";
         |ATRI s;
         aPath     = eaPathContasoc;
         aPathFich = aPath + "fich/";
         aAplica   = "contasoc";
         aDDef     = "";
         aHDef     = "zzzzzzzzzzzz";
         |BUCLE dsficher;

         |SI enPorDepart = 1;
             aPath     = eaPathBasica;
             aPathFich = aPath + "fich/";
             aAplica   = "basica";
             aDDef     = "agim0028.mas";  aHDef = "agim0028.mas";  |BUCLE dsficher;
             aDDef     = "agim0019.mas";  aHDef = "agim0019.mas";  |BUCLE dsficher;
             aDDef     = "agim0020.mas";  aHDef = "agim0020.mas";  |BUCLE dsficher;
             aDDef     = "agim0021.mas";  aHDef = "agim0021.mas";  |BUCLE dsficher;
             aDDef     = "agim0022.mas";  aHDef = "agim0022.mas";  |BUCLE dsficher;
             aDDef     = "agim0023.mas";  aHDef = "agim0023.mas";  |BUCLE dsficher;
             aDDef     = "agim0024.mas";  aHDef = "agim0024.mas";  |BUCLE dsficher;
             aDDef     = "agim0025.mas";  aHDef = "agim0025.mas";  |BUCLE dsficher;
             aDDef     = "agim0026.mas";  aHDef = "agim0026.mas";  |BUCLE dsficher;
             aDDef     = "agim0027.mas";  aHDef = "agim0027.mas";  |BUCLE dsficher;
             aDDef     = "agim0033.mas";  aHDef = "agim0033.mas";  |BUCLE dsficher;
             aDDef     = "agim0034.mas";  aHDef = "agim0034.mas";  |BUCLE dsficher;
             aDDef     = "agim0037.mas";  aHDef = "agim0037.mas";  |BUCLE dsficher;
             aDDef     = "agim0038.mas";  aHDef = "agim0038.mas";  |BUCLE dsficher;
             aDDef     = "agim0039.mas";  aHDef = "agim0039.mas";  |BUCLE dsficher;
             aDDef     = "agim0040.mas";  aHDef = "agim0040.mas";  |BUCLE dsficher;
             aDDef     = "agim0041.mas";  aHDef = "agim0041.mas";  |BUCLE dsficher;
             aDDef     = "agim0042.mas";  aHDef = "agim0042.mas";  |BUCLE dsficher;
             aDDef     = "agim0043.mas";  aHDef = "agim0043.mas";  |BUCLE dsficher;
             aDDef     = "agim0044.mas";  aHDef = "agim0044.mas";  |BUCLE dsficher;
             aDDef     = "agim0045.mas";  aHDef = "agim0045.mas";  |BUCLE dsficher;
             aDDef     = "agim0046.mas";  aHDef = "agim0046.mas";  |BUCLE dsficher;
             aDDef     = "agim0049.mas";  aHDef = "agim0049.mas";  |BUCLE dsficher;
         |FINSI;
     |FINSI;

     |SI eaPathRen2019  ! "";  |Y #dsborrad#37 = "SI";
         |ATRI S;
         |PINTA 2210, "TRATANDO FICHEROS EN RENTA 2019          ";
         |ATRI s;
         aPath     = eaPathRen2019;
         aPathFich = aPath + "fich/";
         aAplica   = "ren2019";
         aDDef     = "";
         aHDef     = "zzzzzzzzzzzz";
         |BUCLE dsficher;

         |SI enPorDepart = 1;            || Poner esto en el ultimo a¤o de
             aPath     = eaPathIntegral; || Renta
             aPathFich = aPath + "fich/";
             aAplica   = "integral";
             aDDef     = "dsam0003.mas";  aHDef = "dsam0003.mas";  |BUCLE dsficher;
             aDDef     = "dsam0004.mas";  aHDef = "dsam0004.mas";  |BUCLE dsficher;
         |FINSI;
     |FINSI;

     |SI eaPathRen2018  ! "";  |Y #dsborrad#36 = "SI";
         |ATRI S;
         |PINTA 2210, "TRATANDO FICHEROS EN RENTA 2018          ";
         |ATRI s;
         aPath     = eaPathRen2018;
         aPathFich = aPath + "fich/";
         aAplica   = "ren2018";
         aDDef     = "";
         aHDef     = "zzzzzzzzzzzz";
         |BUCLE dsficher;

         |SI eaPathRen2019 = "";             || Poner esto en el penultimo a¤o de
             |SI enPorDepart = 1;
                 aPath     = eaPathIntegral;
                 aPathFich = aPath + "fich/";
                 aAplica   = "integral";
                 aDDef     = "dsam0003.mas";  aHDef = "dsam0003.mas";  |BUCLE dsficher;
                 aDDef     = "dsam0004.mas";  aHDef = "dsam0004.mas";  |BUCLE dsficher;
             |FINSI;
         |FINSI;
     |FINSI;

     |SI eaPathRen2017  ! "";  |Y #dsborrad#35 = "SI";
         |ATRI S;
         |PINTA 2210, "TRATANDO FICHEROS EN RENTA 2017          ";
         |ATRI s;
         aPath     = eaPathRen2017;
         aPathFich = aPath + "fich/";
         aAplica   = "ren2017";
         aDDef     = "";
         aHDef     = "zzzzzzzzzzzz";
         |BUCLE dsficher;
     |FINSI;

     |SI eaPathRen2016  ! "";  |Y #dsborrad#34 = "SI";
         |ATRI S;
         |PINTA 2210, "TRATANDO FICHEROS EN RENTA 2016          ";
         |ATRI s;
         aPath     = eaPathRen2016;
         aPathFich = aPath + "fich/";
         aAplica   = "ren2016";
         aDDef     = "";
         aHDef     = "zzzzzzzzzzzz";
         |BUCLE dsficher;
     |FINSI;

     |SI eaPathRen2015  ! "";  |Y #dsborrad#33 = "SI";
         |ATRI S;
         |PINTA 2210, "TRATANDO FICHEROS EN RENTA 2015          ";
         |ATRI s;
         aPath     = eaPathRen2015;
         aPathFich = aPath + "fich/";
         aAplica   = "ren2015";
         aDDef     = "";
         aHDef     = "zzzzzzzzzzzz";
         |BUCLE dsficher;
     |FINSI;

     |SI eaPathRen2014  ! "";  |Y #dsborrad#32 = "SI";
         |ATRI S;
         |PINTA 2210, "TRATANDO FICHEROS EN RENTA 2014          ";
         |ATRI s;
         aPath     = eaPathRen2014;
         aPathFich = aPath + "fich/";
         aAplica   = "ren2014";
         aDDef     = "";
         aHDef     = "zzzzzzzzzzzz";
         |BUCLE dsficher;
     |FINSI;

     |SI eaPathRen2013  ! "";  |Y #dsborrad#31 = "SI";
         |ATRI S;
         |PINTA 2210, "TRATANDO FICHEROS EN RENTA 2013          ";
         |ATRI s;
         aPath     = eaPathRen2013;
         aPathFich = aPath + "fich/";
         aAplica   = "ren2013";
         aDDef     = "";
         aHDef     = "zzzzzzzzzzzz";
         |BUCLE dsficher;
     |FINSI;

     |SI eaPathRen2012  ! "";  |Y #dsborrad#30 = "SI";
         |ATRI S;
         |PINTA 2210, "TRATANDO FICHEROS EN RENTA 2012          ";
         |ATRI s;
         aPath     = eaPathRen2012;
         aPathFich = aPath + "fich/";
         aAplica   = "ren2012";
         aDDef     = "";
         aHDef     = "zzzzzzzzzzzz";
         |BUCLE dsficher;
     |FINSI;

     |SI eaPathRen2011  ! "";  |Y #dsborrad#29 = "SI";
         |ATRI S;
         |PINTA 2210, "TRATANDO FICHEROS EN RENTA 2011          ";
         |ATRI s;
         aPath     = eaPathRen2011;
         aPathFich = aPath + "fich/";
         aAplica   = "ren2011";
         aDDef     = "";
         aHDef     = "zzzzzzzzzzzz";
         |BUCLE dsficher;
     |FINSI;

     |SI eaPathRen2010  ! "";  |Y #dsborrad#28 = "SI";
         |ATRI S;
         |PINTA 2210, "TRATANDO FICHEROS EN RENTA 2010          ";
         |ATRI s;
         aPath     = eaPathRen2010;
         aPathFich = aPath + "fich/";
         aAplica   = "ren2010";
         aDDef     = "";
         aHDef     = "zzzzzzzzzzzz";
         |BUCLE dsficher;
     |FINSI;

     |SI eaPathRen2009  ! "";  |Y #dsborrad#27 = "SI";
         |ATRI S;
         |PINTA 2210, "TRATANDO FICHEROS EN RENTA 2009          ";
         |ATRI s;
         aPath     = eaPathRen2009;
         aPathFich = aPath + "fich/";
         aAplica   = "ren2009";
         aDDef     = "";
         aHDef     = "zzzzzzzzzzzz";
         |BUCLE dsficher;
     |FINSI;

     |SI eaPathRen2008  ! "";  |Y #dsborrad#26 = "SI";
         |ATRI S;
         |PINTA 2210, "TRATANDO FICHEROS EN RENTA 2008          ";
         |ATRI s;
         aPath     = eaPathRen2008;
         aPathFich = aPath + "fich/";
         aAplica   = "ren2008";
         aDDef     = "";
         aHDef     = "zzzzzzzzzzzz";
         |BUCLE dsficher;
     |FINSI;

     |SI eaPathRen2007  ! "";  |Y #dsborrad#25 = "SI";
         |ATRI S;
         |PINTA 2210, "TRATANDO FICHEROS EN RENTA 2007          ";
         |ATRI s;
         aPath     = eaPathRen2007;
         aPathFich = aPath + "fich/";
         aAplica   = "ren2007";
         aDDef     = "";
         aHDef     = "zzzzzzzzzzzz";
         |BUCLE dsficher;
     |FINSI;

     |SI eaPathRen2006  ! "";  |Y #dsborrad#24 = "SI";
         |ATRI S;
         |PINTA 2210, "TRATANDO FICHEROS EN RENTA 2006          ";
         |ATRI s;
         aPath     = eaPathRen2006;
         aPathFich = aPath + "fich/";
         aAplica   = "ren2006";
         aDDef     = "";
         aHDef     = "zzzzzzzzzzzz";
         |BUCLE dsficher;
     |FINSI;

     |SI eaPathRen2005  ! "";  |Y #dsborrad#23 = "SI";
         |ATRI S;
         |PINTA 2210, "TRATANDO FICHEROS EN RENTA 2005          ";
         |ATRI s;
         aPath     = eaPathRen2005;
         aPathFich = aPath + "fich/";
         aAplica   = "ren2005";
         aDDef     = "";
         aHDef     = "zzzzzzzzzzzz";
         |BUCLE dsficher;
     |FINSI;

     |SI eaPathRen2004  ! "";  |Y #dsborrad#20 = "SI";
         |ATRI S;
         |PINTA 2210, "TRATANDO FICHEROS EN RENTA 2004          ";
         |ATRI s;
         aPath     = eaPathRen2004;
         aPathFich = aPath + "fich/";
         aAplica   = "ren2004";
         aDDef     = "";
         aHDef     = "zzzzzzzzzzzz";
         |BUCLE dsficher;
     |FINSI;

     |SI eaPathRen2003  ! "";  |Y #dsborrad#19 = "SI";
         |ATRI S;
         |PINTA 2210, "TRATANDO FICHEROS EN RENTA 2003          ";
         |ATRI s;
         aPath     = eaPathRen2003;
         aPathFich = aPath + "fich/";
         aAplica   = "ren2003";
         aDDef     = "";
         aHDef     = "zzzzzzzzzzzz";
         |BUCLE dsficher;
     |FINSI;

     |SI eaPathRen2002  ! "";  |Y #dsborrad#18 = "SI";
         |ATRI S;
         |PINTA 2210, "TRATANDO FICHEROS EN RENTA 2002          ";
         |ATRI s;
         aPath     = eaPathRen2002;
         aPathFich = aPath + "fich/";
         aAplica   = "ren2002";
         aDDef     = "";
         aHDef     = "zzzzzzzzzzzz";
         |BUCLE dsficher;
     |FINSI;

     |SI eaPathRen2001  ! "";  |Y #dsborrad#17 = "SI";
         |ATRI S;
         |PINTA 2210, "TRATANDO FICHEROS EN RENTA 2001          ";
         |ATRI s;
         aPath     = eaPathRen2001;
         aPathFich = aPath + "fich/";
         aAplica   = "ren2001";
         aDDef     = "";
         aHDef     = "zzzzzzzzzzzz";
         |BUCLE dsficher;
     |FINSI;

     |SI eaPathRen2000  ! "";  |Y #dsborrad#10 = "SI";
         |ATRI S;
         |PINTA 2210, "TRATANDO FICHEROS EN RENTA 2000          ";
         |ATRI s;
         aPath     = eaPathRen2000;
         aPathFich = aPath + "fich/";
         aAplica   = "ren2000";
         aDDef     = "";
         aHDef     = "zzzzzzzzzzzz";
         |BUCLE dsficher;
     |FINSI;

     |SI eaPathRen1999  ! "";  |Y #dsborrad#11 = "SI";
         |ATRI S;
         |PINTA 2210, "TRATANDO FICHEROS EN RENTA 1999          ";
         |ATRI s;
         aPath     = eaPathRen1999;
         aPathFich = aPath + "fich/";
         aAplica   = "ren1999";
         aDDef     = "";
         aHDef     = "zzzzzzzzzzzz";
         |BUCLE dsficher;
     |FINSI;

     |SI eaPathRen1998  ! "";  |Y #dsborrad#12 = "SI";
         |ATRI S;
         |PINTA 2210, "TRATANDO FICHEROS EN RENTA 1998          ";
         |ATRI s;
         aPath     = eaPathRen1998;
         aPathFich = aPath + "fich/";
         aAplica   = "ren1998";
         aDDef     = "";
         aHDef     = "zzzzzzzzzzzz";
         |BUCLE dsficher;
     |FINSI;

     |SI eaPathRen1997  ! "";  |Y #dsborrad#13 = "SI";
         |ATRI S;
         |PINTA 2210, "TRATANDO FICHEROS EN RENTA 1997          ";
         |ATRI s;
         aPath     = eaPathRen1997;
         aPathFich = aPath + "fich/";
         aAplica   = "ren1997";
         aDDef     = "";
         aHDef     = "zzzzzzzzzzzz";
         |BUCLE dsficher;
     |FINSI;

     |SI eaPathRen1996  ! "";  |Y #dsborrad#14 = "SI";
         |ATRI S;
         |PINTA 2210, "TRATANDO FICHEROS EN RENTA 1996          ";
         |ATRI s;
         aPath     = eaPathRen1996;
         aPathFich = aPath + "fich/";
         aAplica   = "ren1996";
         aDDef     = "";
         aHDef     = "zzzzzzzzzzzz";
         |BUCLE dsficher;
     |FINSI;

     |SI eaPathRen1995  ! "";  |Y #dsborrad#15 = "SI";
         |ATRI S;
         |PINTA 2210, "TRATANDO FICHEROS EN RENTA 1995          ";
         |ATRI s;
         aPath     = eaPathRen1995;
         aPathFich = aPath + "fich/";
         aAplica   = "ren1995";
         aDDef     = "";
         aHDef     = "zzzzzzzzzzzz";
         |BUCLE dsficher;
     |FINSI;

     |SI eaPathRen1994  ! "";  |Y #dsborrad#16 = "SI";
         |ATRI S;
         |PINTA 2210, "TRATANDO FICHEROS EN RENTA 1994          ";
         |ATRI s;
         aPath     = eaPathRen1994;
         aPathFich = aPath + "fich/";
         aAplica   = "ren1994";
         aDDef     = "";
         aHDef     = "zzzzzzzzzzzz";
         |BUCLE dsficher;
     |FINSI;

     |SI eaPathFacturar ! "";  |Y #dsborrad#6 = "SI";
         |ATRI S;
         |PINTA 2210, "TRATANDO FICHEROS EN FACTURACION         ";
         |ATRI s;

         nDEmpresa = 0;
         nHEmpresa = 99;
         |SI enEmpFac ! -1;
             nDEmpresa = enEmpFac;
             nHEmpresa = enEmpFac;
         |FINSI;

         |BUCLE facemp;

         |SI eaPathIntegral ! "";  |Y #dsborrad#7 = "NO";
             |SI enPorDepart = 1;
                  aPath     = eaPathIntegral;
                  aPathFich = aPath + "fich/";
                  aAplica   = "integral";
                  aDDef     = "dsam0010.mas";
                  aHDef     = "dsam0010.mas";
                  |BUCLE dsficher;
              |FINSI;
         |FINSI;
     |FINSI;

     |SI eaPathContagen ! "";  |Y #dsborrad#1 = "SI";
         |ATRI S;
         |PINTA 2210, "TRATANDO FICHEROS EN CONTABILIDAD        ";
         |ATRI s;

         |BUCLE canempre;

         aAplica   = "contagen";
         aPath     = eaPathContagen;
         aPathFich = aPath + "fich/000000/";
         aDDef     = "";
         aHDef     = "zzzzzzzzzzzz";
         |BUCLE dsficher;
     |FINSI;

     |SI eaPathDsArchi ! "";  |Y #dsborrad#50 = "SI";
         |ATRI S;
         |PINTA 2210, "TRATANDO FICHEROS EN GESTION DOCUMENTAL  ";
         |ATRI s;

         |SI enBajaCli = 1;
             aAlfa = "BORR" + (("000000000000000" + #dsborrad#8) % -115) + "000000000000000";
             |HAZ TrataDSARCHI;
         |SINO;
             aAlfa = "CAMB" + (("000000000000000" + #dsborrad#8) % -115) + (("000000000000000" + enEmpresaN) % -115);
             |HAZ TrataDSARCHI;
         |FINSI;
     |FINSI;

     |SI eaPathIntegral ! "";  |Y #dsborrad#7 = "SI";
         |ATRI S;
         |PINTA 2210, "TRATANDO FICHEROS EN MAESTROS            ";
         |ATRI s;

         aPath     = eaPathIntegral;
         aPathFich = aPath + "fich/";
         aAplica   = "integral";
         aDDef     = "";
         aHDef     = "zzzzzzzzzzzz";
         |BUCLE dsficher;
     |FINSI;

     |SI eaPathBasica ! "";  |Y #dsborrad#7 = "SI";
         |ATRI S;
         |PINTA 2210, "TRATANDO FICHEROS EN MAESTROS            ";
         |ATRI s;
         aPath     = eaPathBasica;
         aPathFich = aPath + "fich/";
         aAplica   = "basica";
         aDDef     = "";
         aHDef     = "zzzzzzzzzzzz";
         |BUCLE dsficher;
     |FINSI;

     |SI eaPasaCact = "S";
         |ATRI S;
         |PINTA 2210, "TRATANDO CUENTA CONTABLE                 ";
         |ATRI s;
         |HAZ Graba000;
     |FINSI;
|FPRC;

|PROGRAMA;
     |HAZ BusquedaApli;

     |SI eaTab ! "";
         #dsborrad#8 = enEmpresa;
         aAplica     = eaAplica;
         |SI aAplica = "basica";   aPath = eaPathBasica;    |FINSI;
         |SI aAplica = "laboral";  aPath = eaPathLaboral;   |FINSI;
         |SI aAplica = "contasoc"; aPath = eaPathContasoc;  |FINSI;
         |SI aAplica = "ren2019";  aPath = eaPathRen2019;   |FINSI;
         |SI aAplica = "ren2018";  aPath = eaPathRen2018;   |FINSI;
         |SI aAplica = "ren2017";  aPath = eaPathRen2017;   |FINSI;
         |SI aAplica = "ren2016";  aPath = eaPathRen2016;   |FINSI;
         |SI aAplica = "ren2015";  aPath = eaPathRen2015;   |FINSI;
         |SI aAplica = "ren2014";  aPath = eaPathRen2014;   |FINSI;
         |SI aAplica = "ren2013";  aPath = eaPathRen2013;   |FINSI;
         |SI aAplica = "ren2012";  aPath = eaPathRen2012;   |FINSI;
         |SI aAplica = "ren2011";  aPath = eaPathRen2011;   |FINSI;
         |SI aAplica = "ren2010";  aPath = eaPathRen2010;   |FINSI;
         |SI aAplica = "ren2009";  aPath = eaPathRen2009;   |FINSI;
         |SI aAplica = "ren2008";  aPath = eaPathRen2008;   |FINSI;
         |SI aAplica = "ren2007";  aPath = eaPathRen2007;   |FINSI;
         |SI aAplica = "ren2006";  aPath = eaPathRen2006;   |FINSI;
         |SI aAplica = "ren2005";  aPath = eaPathRen2005;   |FINSI;
         |SI aAplica = "ren2004";  aPath = eaPathRen2004;   |FINSI;
         |SI aAplica = "ren2003";  aPath = eaPathRen2003;   |FINSI;
         |SI aAplica = "ren2002";  aPath = eaPathRen2002;   |FINSI;
         |SI aAplica = "ren2001";  aPath = eaPathRen2001;   |FINSI;
         |SI aAplica = "ren2000";  aPath = eaPathRen2000;   |FINSI;
         |SI aAplica = "ren1999";  aPath = eaPathRen1999;   |FINSI;
         |SI aAplica = "ren1998";  aPath = eaPathRen1998;   |FINSI;
         |SI aAplica = "ren1997";  aPath = eaPathRen1997;   |FINSI;
         |SI aAplica = "ren1996";  aPath = eaPathRen1996;   |FINSI;
         |SI aAplica = "ren1995";  aPath = eaPathRen1995;   |FINSI;
         |SI aAplica = "ren1994";  aPath = eaPathRen1994;   |FINSI;

         aPathFich = aPath + "fich/";
         aDDef     = eaTab + ".mas";
         aHDef     = eaTab + ".mas";
         |BUCLE dsficher;

         |ACABA;
     |FINSI;

     |SI PARAMETRO ! "";
         |SI enEmpresa = 0;

             enEmpresa = PARAMETRO;

             #dsborrad#8 = enEmpresa;

             |ABRE #agifigen;
             #agifigen#0 = #dsborrad#8;
             |LEE 040#agifigen.=;
             |SI FSalida ! 0;  |DDEFECTO #agifigen;  |FINSI;
             |CIERRA #agifigen;

             #dsborrad#9  = #agifigen#1;
             #dsborrad#1  = "SI";
             #dsborrad#2  = "SI";
             #dsborrad#3  = "SI";
             #dsborrad#4  = "SI";
             #dsborrad#5  = "SI";
             #dsborrad#6  = "SI";
             #dsborrad#7  = "SI";
             #dsborrad#50 = "SI";
             #dsborrad#0  = "SI";

             |PINPA #0#dsborrad;
             |PINDA #0#dsborrad;
             |PARA nAnyo = 10;  |SI nAnyo [ 49;  |HACIENDO nAnyo = nAnyo + 1;
                   #dsborrad#nAnyo# = #dsborrad#4;
             |SIGUE;

             |HAZ Seleccion;

             |ACABA;
         |FINSI;
     |FINSI;

     |SI enCambioCli = 0;  |Y enBorraTodo = 0;   || Baja desde el Integrado o desde Aqui
         |DDEFECTO #dsborrad;
         |SI enEmpresa ! 0;
             #dsborrad#8 = enEmpresa;
             |ABRE #agifigen;
             #agifigen#0 = #dsborrad#8;
             |LEE 040#agifigen.=;
             |SI FSalida ! 0;  |DDEFECTO #agifigen;  |FINSI;
             |CIERRA #agifigen;

             #dsborrad#9  = #agifigen#1;
             #dsborrad#1  = "SI";
             #dsborrad#2  = "SI";
             #dsborrad#3  = "SI";
             #dsborrad#4  = "SI";
             #dsborrad#5  = "SI";
             #dsborrad#6  = "SI";
             #dsborrad#7  = "SI";
             #dsborrad#50 = "SI";

             |C_M #dsborrad#1,  1, "N";
             |C_M #dsborrad#2,  1, "N";
             |C_M #dsborrad#3,  1, "N";
             |C_M #dsborrad#4,  1, "N";
             |C_M #dsborrad#5,  1, "N";
             |C_M #dsborrad#6,  1, "N";
             |C_M #dsborrad#7,  1, "N";
             |C_M #dsborrad#8,  1, "N";
             |C_M #dsborrad#50, 1, "N";

             |PINTA #dsborrad#1;
             |PINTA #dsborrad#2;
             |PINTA #dsborrad#3;
             |PINTA #dsborrad#4;
             |PINTA #dsborrad#5;
             |PINTA #dsborrad#6;
             |PINTA #dsborrad#7;
             |PINTA #dsborrad#8;
             |PINTA #dsborrad#9;
             |PINTA #dsborrad#50;
         |FINSI;

         |PINPA #0#dsborrad;
         |PINDA #0#dsborrad;
         |ENDATOS #1#dsborrad;
         |SI FSalida = 0;  |Y #dsborrad#0 = "SI";
             |PARA nAnyo = 10;  |SI nAnyo [ 49;  |HACIENDO nAnyo = nAnyo + 1;
                   #dsborrad#nAnyo# = #dsborrad#4;
             |SIGUE;

             |HAZ Seleccion;
             enBajaCli = 0;
         |FINSI;
     |FINSI;

     |SI enBorraTodo = 1;   || Baja desde el dsborrpa
         #dsborrad#8  = enEmpresa;
         #dsborrad#1  = "SI";
         #dsborrad#2  = "SI";
         #dsborrad#3  = "SI";
         #dsborrad#4  = "SI";
         #dsborrad#5  = "SI";
         #dsborrad#6  = "SI";
         #dsborrad#7  = "SI";
         #dsborrad#50 = "SI";

         |PARA nAnyo = 10;  |SI nAnyo [ 49;  |HACIENDO nAnyo = nAnyo + 1;
               #dsborrad#nAnyo# = #dsborrad#4;
         |SIGUE;

         |HAZ Seleccion;
         |ACABA;
     |FINSI;

     |SI enCambioCli = 2;  |O enCambioCli = 4;  || Baja desde la Unificacion
         |DDEFECTO #dsborrad;
         #dsborrad#1  = eaPasaCont;
         #dsborrad#2  = eaPasaFisc;
         #dsborrad#3  = eaPasaSoci;
         #dsborrad#4  = eaPasaRent;
         #dsborrad#5  = eaPasaLabo;
         #dsborrad#6  = eaPasaFact;
         #dsborrad#7  = eaPasaMaes;
         #dsborrad#50 = eaPasaArch;
         #dsborrad#16 = eaPasaR1994;
         #dsborrad#15 = eaPasaR1995;
         #dsborrad#14 = eaPasaR1996;
         #dsborrad#13 = eaPasaR1997;
         #dsborrad#12 = eaPasaR1998;
         #dsborrad#11 = eaPasaR1999;
         #dsborrad#10 = eaPasaR2000;
         #dsborrad#17 = eaPasaR2001;
         #dsborrad#18 = eaPasaR2002;
         #dsborrad#19 = eaPasaR2003;
         #dsborrad#20 = eaPasaR2004;
         #dsborrad#23 = eaPasaR2005;
         #dsborrad#24 = eaPasaR2006;
         #dsborrad#25 = eaPasaR2007;
         #dsborrad#26 = eaPasaR2008;
         #dsborrad#27 = eaPasaR2009;
         #dsborrad#28 = eaPasaR2010;
         #dsborrad#29 = eaPasaR2011;
         #dsborrad#30 = eaPasaR2012;
         #dsborrad#31 = eaPasaR2013;
         #dsborrad#32 = eaPasaR2014;
         #dsborrad#33 = eaPasaR2015;
         #dsborrad#34 = eaPasaR2016;
         #dsborrad#35 = eaPasaR2017;
         #dsborrad#36 = eaPasaR2018;
         #dsborrad#37 = eaPasaR2019;
         #dsborrad#8  = enEmpresa;
         enBajaCli = 0;

         |ATRI I;
         |CUADRO 2108 2371;
         |ATRI i;
         |HAZ Seleccion;
     |FINSI;

     |SI enCambioCli = 1;
         #dsborrad#1  = eaPasaCont;
         #dsborrad#2  = eaPasaFisc;
         #dsborrad#3  = eaPasaSoci;
         #dsborrad#4  = eaPasaRent;
         #dsborrad#5  = eaPasaLabo;
         #dsborrad#6  = eaPasaFact;
         #dsborrad#7  = eaPasaMaes;
         #dsborrad#50 = eaPasaArch;
         #dsborrad#16 = eaPasaR1994;
         #dsborrad#15 = eaPasaR1995;
         #dsborrad#14 = eaPasaR1996;
         #dsborrad#13 = eaPasaR1997;
         #dsborrad#12 = eaPasaR1998;
         #dsborrad#11 = eaPasaR1999;
         #dsborrad#10 = eaPasaR2000;
         #dsborrad#17 = eaPasaR2001;
         #dsborrad#18 = eaPasaR2002;
         #dsborrad#19 = eaPasaR2003;
         #dsborrad#20 = eaPasaR2004;
         #dsborrad#23 = eaPasaR2005;
         #dsborrad#24 = eaPasaR2006;
         #dsborrad#25 = eaPasaR2007;
         #dsborrad#26 = eaPasaR2008;
         #dsborrad#27 = eaPasaR2009;
         #dsborrad#28 = eaPasaR2010;
         #dsborrad#29 = eaPasaR2011;
         #dsborrad#30 = eaPasaR2012;
         #dsborrad#31 = eaPasaR2013;
         #dsborrad#32 = eaPasaR2014;
         #dsborrad#33 = eaPasaR2015;
         #dsborrad#34 = eaPasaR2016;
         #dsborrad#35 = eaPasaR2017;
         #dsborrad#36 = eaPasaR2018;
         #dsborrad#37 = eaPasaR2019;
         #dsborrad#8  = enEmpresa;
         |ATRI I;

         |CUADRO 2108 2371;
         |ATRI i;
         |HAZ Seleccion;

         |DBASS aAlfa;
         aAlfa = aAlfa + "dsparcli/def/dstelz27.mas";
         |XABRE "E", aAlfa, nHandle;
         |SI FSalida ] 0;
             |SUB_EJECUTA ":dsparcli/dstelz27;CAMBIA";
         |FINSI;
     |FINSI;
|FPRO;
