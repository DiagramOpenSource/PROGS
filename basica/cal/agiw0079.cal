|FICHEROS;
     agiw0079 #0;
     agiw0080 #1,MANTE;
     agiw0074 #3,MANTE;
     referen@ #100;
|FIN;

|VARIABLES;
     aAntes    = "";
     nModo     = 0;
     alfa1     = "";
     aAlfa     = "";
     aPath     = "";
     aApli     = "";
     aMas      = "";
     aDef      = "";
     nCampos   = 0;
     i         = 0;
     &swElijo  = 0;
     nPosicion = 0;
     aFichero  = "";
|FIN;

|PROCESO LeeCampos;
     |DBASE aPath; |QBF aPath;
     aMas = aPath + "def/" + aDef;
     |CARGA_DEF aMas, referen@;
     |SI FSalida ! 0;
          aAlfa = "0000Error al cargar " + aDef;
          |MENAV aAlfa;
     |SINO;
          aAlfa = "|NC";
          aAlfa = #referen@#aAlfa#;
          nCampos = aAlfa;

          |ABRE #agiw0074;
          |PARA i = 0 ;|SI i < nCampos; |HACIENDO i = i + 1;
               |DDEFECTO #agiw0074;
               #agiw0074#0 = aDef;
               #agiw0074#1 = i;
               |LEE 101#agiw0074.=;
               |SI FSalida ! 0;
                   |GRABA 020#agiw0074.b;
               |FINSI;

               aAlfa = "|C" + (("000" + i) % -103) + "NOMBRE";
               aAlfa = #referen@#aAlfa#;
               #agiw0074#2 = aAlfa;

               aAlfa = "|C" + (("000" + i) % -103) + "TIPO";
               aAlfa = #referen@#aAlfa#;
               #agiw0074#3 = aAlfa;

               aAlfa = "|C" + (("000" + i) % -103) + "LONGITUD";
               aAlfa = #referen@#aAlfa#;
               #agiw0074#4  = aAlfa;

               |GRABA 020#agiw0074.a;
               |LIBERA #agiw0074;
          |SIGUE;
          |DESCARGA_DEF #referen@;
          |CIERRA #agiw0074;
     |FINSI;
|FPRC;

|PROCESO inferior;
     #agiw0074#0 = aDef;
     #agiw0074#1 = 0;
     |SI FSalida = "POSICION";
          #agiw0074#1 = nPosicion;
     |FINSI;
|FPRC;

|PROCESO superior;
     #agiw0074#0 = aDef;
     #agiw0074#1 = 255;
|FPRC;

|PROCESO Campos; |TIPO 7;
     |C_M #agiw0080#2,0,aAlfa;
     |SI aAlfa = "N"; |ACABA; |FINSI;

     swElijo = 0;
     |SI #agiw0080#5 = "X";
         aDef = "agifigen";
     |SINO;
         aDef = #agiw0079#2;
     |FINSI;

     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 1;
          |SALVA_FICHA #agiw0080;
          |LEE 000#agiw0080.u;
          nPosicion = #agiw0080#2 + 1;
          |REPON_FICHA #agiw0080;
     |SINO;
          nPosicion = #agiw0080#2;
     |FINSI;
     |PUSHV 05012380;

     |PINPA #0#agiw0074;
     |ATRI P; |PINTA 1169, aDef; |ATRI 0;
     |ENTLINEAL #1#agiw0074, -2, 4, 22, 0, inferior, superior;
     |POPV;

     |SI swElijo ! 0;

         |ABRE #agiw0074;
         |DDEFECTO #agiw0074;
         #agiw0074#0 = aDef;
         #agiw0074#1 = swElijo;
         |LEE 041#agiw0074.=;
         |CIERRA #agiw0074;

         |SI swElijo ! #agiw0080#2;
             #agiw0080#2 = swElijo;     |PINTA #agiw0080#2;
             #agiw0080#3 = #agiw0074#3; |PINTA #agiw0080#3;
             #agiw0080#4 = #agiw0074#4; |PINTA #agiw0080#4;
         |FINSI;
         |PTEC 802;
     |FINSI;
|FPRC;

|PROCESO Antes; |TIPO 7;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 1;
         #agiw0080#5 = aAntes;
         |PINTA #agiw0080#5;
     |FINSI;
|FPRC;

|PROCESO Despues; |TIPO 0;
     aAlfa = "S";
     aAntes = #agiw0080#5;
     |SI #agiw0080#5 = "F";
         #agiw0080#2 = 0;
         |PINTA #agiw0080#2;
         aAlfa = "N";
     |FINSI;
     |C_M #agiw0080#2,1,aAlfa;
|FPRC;

|PROCESO Tipo5; |TIPO 5;
    aDef = #agiw0079#2;
    |HAZ LeeCampos;
|FPRC;

|PROGRAMA;
    aFichero = ("1w" + Usuario) % 108;
    |NOME_DAT #agiw0074#aFichero#;

    |DELINDEX #agiw0074;

    aDef = "agifigen";
    |HAZ LeeCampos;

    |MANTE #agiw0079;

    |DELINDEX #agiw0074;
|FPRO;
