|FICHEROS;
     dspase00;
     dspase03;
     dspase15;
     dspase25;
     dspase99;
     agitab99;

     :/integral/def/dsam0000;

     :/modelos/def/dsmom004;
     :/modelos/def/dsmom008;
     :/modelos/def/dsmom005;
|FIN;

|VARIABLES;
      nContador      = 0;
      nRegistro      = 0;
      nModelo        = 0;
      nNume          = 0;
      fFecha         = @;
      aAlfa          = "";
      aFichero       = "";
      aPassword      = "";
      nDesde         = 0;

     &enModelo       = 0;
     &enEstaCambio   = 0;
     &enEmpresa      = 0;

     &eaPathAnterior = "";
     &eaPathBasica   = "";
     &eaPathContagen = "";
     &eaPathContanex = "";
     &eaPathContasoc = "";
     &eaPathRen2000  = "";
     &eaPathRen1999  = "";
     &eaPathRen1998  = "";
     &eaPathRen1997  = "";
     &eaPathRen1996  = "";
     &eaPathRen1995  = "";
     &eaPathRen1994  = "";
     &eaPathFacturar = "";
     &eaPathLaboral  = "";
     &eaPathIntegral = "";
     &eaPathDsmodelo = "";
     &eaPathFiscal   = "";
|FIN;

|PROCESO Tipo11;  |TIPO 11;
     |SI FSalida = 10;
         |C_M #dspase03#4, 1, "S";
         |C_M #dspase03#5, 1, "S";
         |C_M #dspase03#9, 1, "S";
         |C_M #dspase03#10, 1, "S";

         |SI #dspase03#0 = 310;  |O #dspase03#0 = 131;
             |C_M #dspase03#5, 1, "N";
         |FINSI;

         |LEE 101#dspase03.=;

         |ET Campo4;
             |ENCAMPO #4#dspase03;
             |SI FSalida = 2;  |VETE Campo4;  |FINSI;

         |ET Campo5;
             |ENCAMPO #5#dspase03;
             |SI FSalida = 2;  |VETE Campo4;  |FINSI;

         |ET Campo8;
             |ENCAMPO #8#dspase03;
             |SI FSalida = 2;  |VETE Campo5;  |FINSI;

         |ET Campo9;
             |ENCAMPO #9#dspase03;
             |SI FSalida = 2;  |VETE Campo8;  |FINSI;

             |ENCAMPO #10#dspase03;
             |SI FSalida = 2;  |VETE Campo9;  |FINSI;

          |GRABA 020#dspase03.a;
          |LIBERA #dspase03;
     |FINSI;

     |SI FSalida = 17;
         |PUSHV 0501 2380;
         |BLANCO 0920 1557;
         |CUADRO 0920 1557;
         |PINTA 1021, "INTRODUZCA EL MODELO PARA ACTIVAR"

         |PARA;  |SI;  |HACIENDO;
              E_inf = 0;
              E_sup = 999;
              nModelo = 1334 ? 1;
              |SI nModelo = 310;  |SAL;  |FINSI;
              |SI nModelo = 131;  |SAL;  |FINSI;
              |SI nModelo = 300;  |SAL;  |FINSI;
              |SI nModelo = 320;  |SAL;  |FINSI;
              |SI nModelo = 330;  |SAL;  |FINSI;
              |SI nModelo = 332;  |SAL;  |FINSI;
              |SI nModelo = 303;  |SAL;  |FINSI;
              |SI nModelo = 130;  |SAL;  |FINSI;
              |SI nModelo = 349;  |SAL;  |FINSI;
              |SI nModelo = 110;  |SAL;  |FINSI;
              |SI nModelo = 115;  |SAL;  |FINSI;
              |SI nModelo = 123;  |SAL;  |FINSI;

              |CONFI "     Modelo no Activado, desea otro Modelo";
              |SI FSalida ! 0;
                  nModelo = 0;
                  |SAL;
              |FINSI;
         |SIGUE;
         |POPV;

         |SI nModelo = 0;  |ACABA;  |FINSI;

         |SI nModelo = 310;  nRegistro = 1;  |FINSI;
         |SI nModelo = 131;  nRegistro = 2;  |FINSI;
         |SI nModelo = 300;  nRegistro = 3;  |FINSI;
         |SI nModelo = 320;  nRegistro = 4;  |FINSI;
         |SI nModelo = 330;  nRegistro = 5;  |FINSI;
         |SI nModelo = 332;  nRegistro = 6;  |FINSI;
         |SI nModelo = 130;  nRegistro = 7;  |FINSI;
         |SI nModelo = 349;  nRegistro = 8;  |FINSI;
         |SI nModelo = 110;  nRegistro = 9;  |FINSI;
         |SI nModelo = 115;  nRegistro = 10; |FINSI;
         |SI nModelo = 123;  nRegistro = 11; |FINSI;
         |SI nModelo = 303;  nRegistro = 12;  |FINSI;

         |SELECT #1#dspase03;
         #dspase03#6 = nRegistro;
         |LEE 101#dspase03.=;
         |SI FSalida = 0;
             #dspase03#7 = "N";
             |GRABA 020#dspase03.a;
             |LIBERA #dspase03;
         |FINSI;

         |SI nModelo = 310;
             #dspase03#6 = 3;
             |LEE 101#dspase03.=;
             |SI FSalida = 0;
                 #dspase03#7 = "N";
                 |GRABA 020#dspase03.a;
                 |LIBERA #dspase03;
             |FINSI;

             #dspase03#6 = 12;
             |LEE 101#dspase03.=;
             |SI FSalida = 0;
                 #dspase03#7 = "N";
                 |GRABA 020#dspase03.a;
                 |LIBERA #dspase03;
             |FINSI;
         |FINSI;

         |SI nModelo = 300;  |O nModelo = 303;
             #dspase03#6 = 1;
             |LEE 101#dspase03.=;
             |SI FSalida = 0;
                 #dspase03#7 = "N";
                 |GRABA 020#dspase03.a;
                 |LIBERA #dspase03;
             |FINSI;
         |FINSI;

         |SELECT #2#dspase03;
         |PONCONTROL 23, "SI";
     |FINSI;
|FPRC;

|PROCESO dspase25;
     #dsam0000#0   = #dspase25#3;
     |LEE 040#dsam0000.=;
     |SI FSalida ! 0;  |DDEFECTO #dsam0000;  |FINSI;

     #agitab99#0 = #dspase25#0;
     |LEE 040#agitab99.=;
     |SI FSalida ! 0;  |DDEFECTO #agitab99;  |FINSI;

     #dsmom004#0 = #dspase25#3;
     #dsmom004#1 = #dspase03#4;
     #dsmom004#2 = #dspase25#1;
     #dsmom004#3 = #dspase25#0;
     #dsmom004#4 = #dspase25#2;
     |LEE 000#dsmom004.=;
     |SI FSalida ! 0;  |DDEFECTO #dsmom004;  |FINSI;

     #dsmom008#0 = #dspase25#3;
     #dsmom008#1 = #dspase03#4;
     #dsmom008#2 = #dspase25#1;
     #dsmom008#3 = #dspase25#0;
     #dsmom008#4 = #dspase25#2;
     #dsmom008#5 = 0;
     |LEE 000#dsmom008.=;
     |SI FSalida ! 0;
         #dspase25#4 = 0;
     |FINSI;

     #dspase25#5 = #dsmom004#15;
     #dspase25#6 = #dspase25#4 - #dspase25#5;
     #dspase25#7 = #dsam0000#1;
     #dspase25#8 = #agitab99#1;

     |GRABA 020#dspase25.a;
     |LIBERA #dspase25;
|FPRC;

|DEFBUCLE dspase25;
     #dspase25#1;
     ;
     #dspase03#0, 00, 00, #dspase03#9;
     #dspase03#0, 99, 99, #dspase03#10;
     be;
     NULL, dspase25;
|FIN;

|PROCESO PasoEl25;
     |ABRE #agitab99;
     |ABRE #dsmom004;
     |ABRE #dsmom008;
     |ABRE #dsam0000;
     |BUCLE dspase25;
     |CIERRA #dsam0000;
     |CIERRA #dsmom004;
     |CIERRA #dsmom008;
     |CIERRA #agitab99;
|FPRC;

|PROCESO Procesando;
     |PINDA #0#dspase03;

     |SI #dspase03#0 = 310;  |HAZ PaseModulos;  #dspase03#7 = "S";  |FINSI;
     |SI #dspase03#0 = 131;  |HAZ PaseModulos;  #dspase03#7 = "S";  |FINSI;
     |SI #dspase03#0 = 300;  |HAZ PaseIva;      #dspase03#7 = "S";  |FINSI;
     |SI #dspase03#0 = 320;  |HAZ PaseIva;      #dspase03#7 = "S";  |FINSI;
     |SI #dspase03#0 = 330;  |HAZ PaseIva;      #dspase03#7 = "S";  |FINSI;
     |SI #dspase03#0 = 332;  |HAZ PaseIva;      #dspase03#7 = "S";  |FINSI;
     |SI #dspase03#0 = 303;  |HAZ PaseIva;      #dspase03#7 = "S";  |FINSI;
     |SI #dspase03#0 = 130;  |HAZ Pase130;      #dspase03#7 = "S";  |FINSI;
     |SI #dspase03#0 = 349;  |HAZ PaseIva;      #dspase03#7 = "S";  |FINSI;
     |SI #dspase03#0 = 110;  |HAZ PaseIrpf;     #dspase03#7 = "S";  |FINSI;
     |SI #dspase03#0 = 115;  |HAZ PaseIrpf;     #dspase03#7 = "S";  |FINSI;
     |SI #dspase03#0 = 123;  |HAZ PaseIrpf;     #dspase03#7 = "S";  |FINSI;

     |HAZ PasoEl25;

     |GRABA 020#dspase03.a;
     |LIBERA #dspase03;
|FPRC;

|DEFBUCLE dspase03;
     #dspase03#1;
     7;
     01, "N";
     99, "N";
     be;
     NULL, Procesando;
|FIN;

|PROCESO GrabaRegistro;
     nContador = nContador + 1;

     fFecha    = ~;
     aAlfa     = fFecha % -104;
     nNume     = aAlfa;
     |SI nNume ] 2009;
         |SI nModelo = 300;  |ACABA;  |FINSI;
         |SI nModelo = 320;  |ACABA;  |FINSI;
         |SI nModelo = 330;  |ACABA;  |FINSI;
         |SI nModelo = 332;  |ACABA;  |FINSI;
     |SINO;
         |SI nModelo = 303;  |ACABA;  |FINSI;
     |FINSI;

     #dspase03#6 = nContador;
     |LEE 040#dspase03.=;
     |SI FSalida = 0;  |ACABA;  |FINSI;

     #agitab99#0 = nModelo;
     |LEE 040#agitab99.=;
     |SI FSalida ! 0;  |DDEFECTO #agitab99;  |FINSI;

     |DDEFECTO #dspase03;
     #dspase03#6      = nContador;
     #dspase03#0      = nModelo;
     #dspase03#1      = #agitab99#1;
     #dspase03#2      = #agitab99#2;
     #dspase03#3      = #agitab99#3;
     #dspase03#4      = aAlfa;
     aAlfa     = fFecha % 402;

     |SI aAlfa = "01";  |O aAlfa = "02";  |O aAlfa = "03";
      |O aAlfa = "04";  |O aAlfa = "05";  |O aAlfa = "06";
         #dspase03#5  = 1;
     |FINSI;

     |SI aAlfa = "07";  |O aAlfa = "08";  |O aAlfa = "09";
         #dspase03#5  = 2;
     |FINSI;

     |SI aAlfa = "10";  |O aAlfa = "11";  |O aAlfa = "12";
         #dspase03#5  = 3;
     |FINSI;

     |SI nModelo = 310;  |O nModelo = 131;
         #dspase03#5 = 4;
     |FINSI;

     |SI nModelo = 320;  |O nModelo = 330;  |O nModelo = 332;
                         |O nModelo = 303;
         #dspase03#5 = aAlfa;
         #dspase03#5 = #dspase03#5 - 1;
     |FINSI;

     |GRABA 020#dspase03.n;
     |LIBERA #dspase03;
|FPRC;

|RUTINA ClaveBaja3;
     #dspase03#7 = "N";
     #dspase03#6 = 1;
|FRUT;

|RUTINA ClaveAlta3;
     #dspase03#7 = "N";
     #dspase03#6 = 99;
|FRUT;


|PROCESO Tipo7C8;  |TIPO 7;
     |SI #dspase03#0 = 300;  |O #dspase03#0 = 130;  |O #dspase03#0 = 349;  |O #dspase03#0 = 115;
                      |O #dspase03#0 = 303;
         |MENSA "0000 <1> Todos;  <2> De REO;  <3> De Contabilidad";
         |ACABA;
     |FINSI;

     |SI #dspase03#0 = 110;
         |MENSA "0000 <1> Todos;  <2> De REO;  <3> De Laboral";
         |ACABA;
     |FINSI;

     |MENSA "0000 <1> De REO;";
|FPRC;

|PROCESO Tipo0C8;  |TIPO 0;
     nDesde = 0;
     |SI #dspase03#0 = 300;  |O #dspase03#0 = 130;  |O #dspase03#0 = 349;  |O #dspase03#0 = 115;
                      |O #dspase03#0 = 303;
         |VETE Cuadro;
     |FINSI;

     |SI #dspase03#0 = 110;
         |VETE Cuadro;
     |FINSI;

     nDesde = 1;
     |SI #dspase03#8 ! 1;
         |ERROR;
         |ACABA;
     |FINSI;

     |ET Cuadro;
     aAlfa = "S";
     |SI nDesde = 0;
         |SI #dspase03#8 = 1;  aAlfa = "N"; |FINSI;
     |FINSI;

     |C_M #dspase03#9,  1, aAlfa;
     |C_M #dspase03#10, 1, aAlfa;
     |SI aAlfa = "N";
         #dspase03#9  = 00000; |PINTA #dspase03#9;
         #dspase03#10 = 99999; |PINTA #dspase03#10;
    |FINSI;
|FPRC;

|PROGRAMA;
     |ABRE #dspase00;
     |LEE 040#dspase00.p;
     |SI FSalida ! 0;
         |MENAV "     No se ha hecho el Pase de la Gestion Anterior";
         |CIERRA #dspase00;
         |ACABA;
     |FINSI;
     |CIERRA #dspase00;

     |ABRE #dspase15;
     |LEE 040#dspase15.p;
     |SI FSalida ! 0;
         enEstaCambio = 0;
         |DDEFECTO #dspase15;
     |SINO;
         enEstaCambio = 1;
         |SI #dspase15#15 ! "S";
             |MENAV "      Unificacion de Codigos no Realizada.";
             |CIERRA #dspase15;
             |ACABA;
         |FINSI;
     |FINSI;
     |CIERRA #dspase15;

     |ABRE #dsmom005;
     |LEE 040#dsmom005.p;
     |SI FSalida ! 0;
         |CIERRA #dsmom005;
         |SUB_EJECUTA_NP ":modelos/dsmom005";
     |SINO;
         |CIERRA #dsmom005;
     |FINSI;

     |HAZ BusquedaApli;

     eaPathAnterior = #dspase00#0;  |QBT eaPathAnterior;

     nContador = 0;
     |ABRE #dspase03;
     |ABRE #agitab99;
     nModelo   = 310;  |HAZ GrabaRegistro;
     nModelo   = 131;  |HAZ GrabaRegistro;
     nModelo   = 300;  |HAZ GrabaRegistro;
     nModelo   = 320;  |HAZ GrabaRegistro;
     nModelo   = 330;  |HAZ GrabaRegistro;
     nModelo   = 332;  |HAZ GrabaRegistro;
     nModelo   = 130;  |HAZ GrabaRegistro;
     nModelo   = 349;  |HAZ GrabaRegistro;
     nModelo   = 110;  |HAZ GrabaRegistro;
     nModelo   = 115;  |HAZ GrabaRegistro;
     nModelo   = 123;  |HAZ GrabaRegistro;
     nModelo   = 303;  |HAZ GrabaRegistro;
     |CIERRA #agitab99;
     |CIERRA #dspase03;

     |ENTLINEAL #2#dspase03, -2, 4, 22, 1, ClaveBaja3, ClaveAlta3;

     |CONFI "0000NDesea hacer el pase en estos momentos.";
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |MENSA "     Realizando Pases de Modelos";

     aFichero = ("99" + Usuario + "zzzzzzzz") % 108;
     |NOME_DAT #dspase99#aFichero#;
     |ABRE #dspase99;  |CIERRA #dspase99;  |DELINDEX #dspase99;

     |ABRE #dspase25;
     |ABRE #dspase99;
     |BUCLE dspase03;
     |CIERRA #dspase25;
     |CIERRA #dspase99;

     |DELINDEX #dspase99;

     nModelo = 0;
|FPRO;
