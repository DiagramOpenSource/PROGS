|FICHEROS;
     dspase33;

     agifigen;

     :integral/dsam0000;
     :integral/dsam0009;
     :integral/dsam0010;
     :integral/dsam0117;

     :facturar/facemp;
     :facturar/asclient;
     :facturar/asbancos;
     :facturar/ascaisec;
     :facturar/asm00022;

     :laboral/labempre;
     :laboral/labtraba;
     :laboral/labcentr;
     :laboral/labtracu;

     :contagen/canempre;
     :contagen/caclipro;
|FIN;

|VARIABLES;
     aPathFich       = "";
     aAlfa           = "";
     aAlfa1          = "";
     aAlfa2          = "";
     aDigito         = "";

     &eaCta          = "";
     &eaPais         = "";
     &eaIBAN         = "";
     &eaPathContagen = "";
     &eaPathBasica   = "";
     &eaPathFacturar = "";
     &eaPathIntegral = "";
     &eaPathLaboral  = "";
     &eaEntidad      = "";
     &eaSucursal     = "";
     &eaCuenta       = "";
     &eaDC           = "";
|FIN;

|PROCESO NoMeQuites;
     |HAZ Labtraba_15;
|FPRC;

|PROCESO dsam0000;
     eaCta  = #dsam0000#90 + #dsam0000#91 + #dsam0000#92 + #dsam0000#93;
     eaPais = #dsam0000#115;
     |HAZ CalcuIBAN;

     #dsam0000#116 = eaIBAN;

     |GRABA 020#dsam0000.a;
     |LIBERA #dsam0000;

     |PULSATECLA;
|FPRC;

|DEFBUCLE dsam0000;
     #dsam0000#1;
     ;
     INICIO;
     FINAL;
     be;
     NULL, dsam0000;
|FIN;

|PROCESO dsam0009;
     eaCta  = #dsam0009#5 + #dsam0009#6 + #dsam0009#7 + #dsam0009#8;
     eaPais = #dsam0009#18;
     |HAZ CalcuIBAN;

     #dsam0009#12 = eaIBAN;

     |GRABA 020#dsam0009.a;
     |LIBERA #dsam0009;

     |PULSATECLA;
|FPRC;

|DEFBUCLE dsam0009;
     #dsam0009#1;
     ;
     INICIO;
     FINAL;
     be;
     NULL, dsam0009;
|FIN;

|PROCESO dsam0010;
     eaCta  = #dsam0010#5 + #dsam0010#6 + #dsam0010#7 + #dsam0010#8;
     eaPais = #dsam0010#32;
     |HAZ CalcuIBAN;

     #dsam0010#22 = eaIBAN;

     |GRABA 020#dsam0010.a;
     |LIBERA #dsam0010;

     |PULSATECLA;
|FPRC;

|DEFBUCLE dsam0010;
     #dsam0010#1;
     ;
     INICIO;
     FINAL;
     be;
     NULL, dsam0010;
|FIN;

|PROCESO dsam0117;
     eaCta  = #dsam0117#7 + #dsam0117#8 + #dsam0117#9 + #dsam0117#10;
     eaPais = #dsam0117#14;
     |HAZ CalcuIBAN;

     #dsam0117#13 = eaIBAN;

     |GRABA 020#dsam0117.a;
     |LIBERA #dsam0117;

     |PULSATECLA;
|FPRC;

|DEFBUCLE dsam0117;
     #dsam0117#1;
     ;
     INICIO;
     FINAL;
     be;
     NULL, dsam0117;
|FIN;

|PROCESO labempre;
     eaCta  = #labempre#113;
     eaPais = #labempre#134;
     |HAZ CalcuIBAN;

     #labempre#135 = eaIBAN;

     |GRABA 020#labempre.a;
     |LIBERA #labempre;

     |PULSATECLA;
|FPRC;

|DEFBUCLE labempre;
     #labempre#1;
     ;
     INICIO;
     FINAL;
     be;
     NULL, labempre;
|FIN;

|PROCESO CalculaCuenta;
     eaEntidad  = "";
     eaSucursal = "";
     eaCuenta   = "";
     eaDC       = "";

     aAlfa = #labtraba#72; |QBF aAlfa;
     |SI aAlfa = "";
         |ACABA;
     |FINSI;

     eaEntidad  = #labtraba#72 % 104;   |QBF eaEntidad;
     eaSucursal = #labtraba#72 % 504;   |QBF eaSucursal;
     eaCuenta   = #labtraba#72 % 1110;  |QBF eaCuenta;
     aDigito    = #labtraba#72 % 0902;  |QBF aDigito;
     eaDC       = "";
     |HAZ CalculoDC;

     |SI eaDC = aDigito;  |ACABA;  |FINSI;

     eaEntidad  = #labtraba#72 % 104;   |QBF eaEntidad;
     eaSucursal = #labtraba#72 % 504;   |QBF eaSucursal;
     eaCuenta   = #labtraba#72 % 910;   |QBF eaCuenta;
     aDigito    = #labtraba#72 % 1902;  |QBF aDigito;
     eaDC       = "";
     |HAZ CalculoDC;

     |SI eaDC = aDigito;  |ACABA;  |FINSI;

     eaEntidad  = #labtraba#72 % 104;   |QBF eaEntidad;
     eaSucursal = #labtraba#72 % 504;   |QBF eaSucursal;
     eaDC       = #labtraba#72 % 902;   |QBF eaDC;
     eaCuenta   = #labtraba#72 % 1110;  |QBF eaCuenta;
|FPRC;

|PROCESO labtraba;
     aAlfa = #labtraba#153;  |QBT aAlfa;
     aAlfa = aAlfa % 0;
     |SI aAlfa = "1";
         #labtraba#153 = "";
     |FINSI;

     |SI #labtraba#153 = "   ";  #labtraba#153 = "ES ";  |FINSI;

     |HAZ CalculaCuenta;

     #labtraba#72 = eaEntidad + eaSucursal + eaDC + eaCuenta;

     eaCta  = #labtraba#72;
     eaPais = #labtraba#153;
     |HAZ CalcuIBAN;

     #labtraba#154 = eaIBAN;

     |GRABA 020#labtraba.a;
     |LIBERA #labtraba;

     |PULSATECLA;
|FPRC;

|DEFBUCLE labtraba;
     #labtraba#1;
     ;
     INICIO;
     FINAL;
     be;
     NULL, labtraba;
|FIN;

|PROCESO labcentr;
     #labcentr#27 = "ES";
     eaCta  = #labcentr#20;
     eaPais = #labcentr#27;
     |HAZ CalcuIBAN;

     #labcentr#28 = eaIBAN;

     |GRABA 020#labcentr.a;
     |LIBERA #labcentr;

     |PULSATECLA;
|FPRC;

|DEFBUCLE labcentr;
     #labcentr#1;
     ;
     INICIO;
     FINAL;
     be;
     NULL, labcentr;
|FIN;

|PROCESO labtracu;
     eaCta  = #labtracu#5 + #labtracu#6 + #labtracu#8 + #labtracu#7;
     eaPais = #labtracu#11;
     |HAZ CalcuIBAN;

     #labtracu#12 = eaIBAN;

     |GRABA 020#labtracu.a;
     |LIBERA #labtracu;

     |PULSATECLA;
|FPRC;

|DEFBUCLE labtracu;
     #labtracu#1;
     ;
     INICIO;
     FINAL;
     be;
     NULL, labtracu;
|FIN;

|PROCESO asclient;
     eaPais = #asclient#86;
     eaCta  = "";

     aAlfa1 = #asclient#13;                                |QBF aAlfa1;
     aAlfa2 = #asclient#71 + #asclient#72 + #asclient#73;  |QBF aAlfa2;

     |SI aAlfa1 ! "";
         eaCta = #asclient#13;  |QBF eaCta;
         eaCta = eaCta + #asclient#14;
     |FINSI;

     |SI aAlfa2 ! "";
         eaCta  = #asclient#71 + #asclient#72 + #asclient#73 + #asclient#14;
     |FINSI;

     |HAZ CalcuIBAN;

     #asclient#77 = eaIBAN;

     #asm00022#0 = #asclient#0;
     |LEE 000#asm00022.=;
     |SI FSalida = 0;
         |SI eaIBAN = "";
             #asclient#77 = #asm00022#4;
         |FINSI;

         |SI #asclient#76 = "           ";
             #asclient#76 = #asm00022#5;
         |FINSI;

         aAlfa = #asclient#83;  |QBF aAlfa;
         |SI aAlfa = "";
             #asclient#83 = #asm00022#3;
         |FINSI;

         |SI #asclient#84 = "01.01.0000";
             #asclient#84 = #asm00022#2;
             #asclient#85 = #asm00022#6;
         |FINSI;
     |FINSI;

     |GRABA 020#asclient.a;
     |LIBERA #asclient;

     |PULSATECLA;

     |SI #facemp#3 = "N";  |ACABA;  |FINSI;

     aAlfa = #asclient#83;  |QBF aAlfa;
     |SI aAlfa ! "";  |O #asclient#84 ! "01.01.0000";
         #dsam0000#0 = #asclient#0;
         |LEE 101#dsam0000.=;
         |SI FSalida = 0;
             aAlfa = #dsam0000#117;  |QBF aAlfa;
             |SI aAlfa = "";
                 #dsam0000#117 = #asclient#83;
                 #dsam0000#118 = #asclient#84;
                 #dsam0000#119 = #asclient#85;

                |GRABA 020#dsam0000.a;
                |LIBERA #dsam0000;
             |FINSI;
             |LIBERA #dsam0000;
         |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE asclient;
     #asclient#1;
     ;
     INICIO;
     FINAL;
     be;
     NULL, asclient;
|FIN;

|PROCESO asbancos;
     eaCta  = #asbancos#7;
     eaPais = #asbancos#31;
     |HAZ CalcuIBAN;

     #asbancos#25 = eaIBAN;

     |GRABA 020#asbancos.a;
     |LIBERA #asbancos;

     |PULSATECLA;
|FPRC;

|DEFBUCLE asbancos;
     #asbancos#1;
     ;
     INICIO;
     FINAL;
     be;
     NULL, asbancos;
|FIN;

|PROCESO ascaisec;
     eaCta  = #ascaisec#4 + #ascaisec#5 + #ascaisec#11 + #ascaisec#6;
     eaPais = #ascaisec#38;
     |HAZ CalcuIBAN;

     #ascaisec#32 = eaIBAN;

     |GRABA 020#ascaisec.a;
     |LIBERA #ascaisec;

     |PULSATECLA;
|FPRC;

|DEFBUCLE ascaisec;
     #ascaisec#1;
     ;
     INICIO;
     FINAL;
     be;
     NULL, ascaisec;
|FIN;

|PROCESO facemp;
     aPathFich = eaPathFacturar + "fich/" + (("00" + #facemp#0) % -102) + "/";
     |PATH_DAT #asclient#aPathFich#;
     |PATH_DAT #asbancos#aPathFich#;
     |PATH_DAT #ascaisec#aPathFich#;

     |ABRE #asm00022;
     |BUCLE asclient;
     |CIERRA #asm00022;

     |BUCLE asbancos;
     |BUCLE ascaisec;

     |PULSATECLA;
|FPRC;

|DEFBUCLE facemp;
     #facemp#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, facemp;
|FIN;

|PROCESO caclipro;

     eaCta  = #caclipro#29 + #caclipro#30 + #caclipro#31 + #caclipro#32;
     eaPais = #caclipro#24;
     |HAZ CalcuIBAN;

     |SI eaIBAN ! "";
         #caclipro#40 = eaIBAN;

         |GRABA 020#caclipro.a;
     |FINSI;

     |LIBERA #caclipro;

     |PULSATECLA;
|FPRC;

|DEFBUCLE caclipro;
     #caclipro#1;
     ;
     INICIO;
     FINAL;
     be;
     NULL, caclipro;
|FIN;

|PROCESO canempre;
     aPathFich = eaPathContagen + "fich/" + (("00000" + #canempre#2) % -105) + (("0" + #canempre#3) % -101) + "/";
     |PATH_DAT #caclipro#aPathFich#;

     |BUCLE caclipro;

     |PULSATECLA;
|FPRC;

|DEFBUCLE canempre;
     #canempre#1;
     26;
     00001, 0, 13;
     99999, 9, 79;
     ;
     NULL, canempre;
|FIN;

|PROCESO agifigen;
     eaCta  = #agifigen#81 + #agifigen#82 + #agifigen#83 + #agifigen#84;
     eaPais = #agifigen#105;
     |HAZ CalcuIBAN;

     #agifigen#99 = eaIBAN;

     |GRABA 020#agifigen.a;
     |LIBERA #agifigen;

     |PULSATECLA;
|FPRC;

|DEFBUCLE agifigen;
     #agifigen#1;
     ;
     INICIO;
     FINAL;
     be;
     NULL, agifigen;
|FIN;

|PROCESO Tipo3;  |TIPO 3;
     |SI #dspase33#0 ! "SI";
         |ACABA;
     |FINSI;

     |ATRI R;
     |PINTA 1825, "PROCESANDO TRABAJO";
     |ATRI 0;

     |HAZ BusquedaApli;

     |SI PARAMETRO ! "AUTO";
         |SI eaPathIntegral ! ""; |Y PARAMETRO = "dsam0117";
             |BUCLE dsam0117;
             |ACABA;
         |FINSI;
     |FINSI;

     |SI eaPathIntegral ! "";
         |BUCLE dsam0000;
         |BUCLE dsam0009;
         |BUCLE dsam0010;
         |BUCLE dsam0117;
     |FINSI;

     |SI eaPathLaboral ! "";
         aPathFich = eaPathLaboral + "fich/";
         |PATH_DAT #labcentr#aPathFich#;

         |BUCLE labempre;
         |BUCLE labtraba;
         |BUCLE labcentr;
         |BUCLE labtracu;
     |FINSI;

     |SI eaPathFacturar ! "";
         |ABRE #dsam0000;
         |BUCLE facemp;
         |CIERRA #dsam0000;
     |FINSI;

     |SI eaPathContagen ! "";
         |BUCLE canempre;
     |FINSI;

     |BUCLE agifigen;
|FPRC;

|PROGRAMA;
     |SI PARAMETRO ! "";
         #dspase33#0 = "SI";
         |PINPA #0#dspase33;
         |PINDA #0#dspase33;

         |HAZ Tipo3;
     |SINO;
         |MANTE #dspase33;
     |FINSI;
|FPRO;
