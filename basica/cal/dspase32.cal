|FICHEROS;
     dspase00;
     dspase15;
     dspase32;
     dsficher;

     ficorig@ #100;
     ficdest@ #200;
|FIN;

|VARIABLES;
     nCampo       = 0;
     nCampoDef    = 0;
     nCampoCli    = 0;
     nTCampo      = 0;

     aPathOrigen  = "";
     aPathDestino = "";
     aOrigen      = "";
     aDestino     = "";
     aAlfa        = "";
     aPassword    = "";
     aQueQuiero   = "";
     aCampo       = "";
     aDef         = "";

     &eaAplica    = "";
     &eaTab       = "";
|FIN;

|PROCESO GrabaRegistro;
     |PARA nCampoDef = 0;  |SI nCampoDef [ nTCampo;  |HACIENDO nCampoDef = nCampoDef + 1;
           #ficdest@#nCampoDef# = #ficorig@#nCampoDef#;
     |SIGUE;

     #ficdest@#nCampoCli# = #dspase15#3#;

     |GRABA 020#ficdest@.n;
     |LIBERA #ficdest@;
|FPRC;

|PROCESO Pasalos;
     |SI #dspase15#nCampo# = 0;  |ACABA;  |FINSI;

     aQueQuiero = "|NC";
     aCampo     = #ficorig@#aQueQuiero#;
     nTCampo    = aCampo;
     nTCampo    = nTCampo - 1;

     nCampoCli = #dsficher#4;
     |SI nCampoCli = 0;
         |DDEFECTO #ficorig@;
         #ficorig@#nCampoCli# = #dspase15#nCampo#;
         |LEE 000#ficorig@.];
         |PARA;  |SI FSalida = 0;  |HACIENDO;
              |SI #ficorig@#nCampoCli# ! #dspase15#nCampo#;
                  |SAL;
              |FINSI;

              |HAZ GrabaRegistro;

              |LEE 000#ficorig@.s;
         |SIGUE;
     |SINO;
         |LEE 000#ficorig@.p;
         |PARA;  |SI FSalida = 0;  |HACIENDO;
              |SI #ficorig@#nCampoCli# = #dspase15#nCampo#;
                  |HAZ GrabaRegistro;
              |FINSI;

              |LEE 000#ficorig@.s;
         |SIGUE;
     |FINSI;

     |PULSATECLA;
|FPRC;

|PROCESO dspase15;
     |SI #dspase15#22 = "S";  |ACABA;  |FINSI;

     |SI eaAplica = "basica";    nCampo = 4;  |HAZ Pasalos;  |FINSI;
     |SI eaAplica = "laboral";   nCampo = 5;  |HAZ Pasalos;  |FINSI;
     |SI eaAplica = "contasoc";  nCampo = 7;  |HAZ Pasalos;  |FINSI;
     |SI eaAplica = "ren2019";   nCampo = 41; |HAZ Pasalos;  |FINSI;
     |SI eaAplica = "ren2018";   nCampo = 40; |HAZ Pasalos;  |FINSI;
     |SI eaAplica = "ren2017";   nCampo = 39; |HAZ Pasalos;  |FINSI;
     |SI eaAplica = "ren2016";   nCampo = 38; |HAZ Pasalos;  |FINSI;
     |SI eaAplica = "ren2015";   nCampo = 37; |HAZ Pasalos;  |FINSI;
     |SI eaAplica = "ren2014";   nCampo = 36; |HAZ Pasalos;  |FINSI;
     |SI eaAplica = "ren2013";   nCampo = 35; |HAZ Pasalos;  |FINSI;
     |SI eaAplica = "ren2012";   nCampo = 34; |HAZ Pasalos;  |FINSI;
     |SI eaAplica = "ren2011";   nCampo = 33; |HAZ Pasalos;  |FINSI;
     |SI eaAplica = "ren2010";   nCampo = 32; |HAZ Pasalos;  |FINSI;
     |SI eaAplica = "ren2009";   nCampo = 31; |HAZ Pasalos;  |FINSI;
     |SI eaAplica = "ren2008";   nCampo = 30; |HAZ Pasalos;  |FINSI;
     |SI eaAplica = "ren2007";   nCampo = 29; |HAZ Pasalos;  |FINSI;
     |SI eaAplica = "ren2006";   nCampo = 28; |HAZ Pasalos;  |FINSI;
     |SI eaAplica = "ren2005";   nCampo = 27; |HAZ Pasalos;  |FINSI;
     |SI eaAplica = "ren2004";   nCampo = 26; |HAZ Pasalos;  |FINSI;
     |SI eaAplica = "ren2003";   nCampo = 25; |HAZ Pasalos;  |FINSI;
     |SI eaAplica = "ren2002";   nCampo = 24; |HAZ Pasalos;  |FINSI;
     |SI eaAplica = "ren2001";   nCampo = 23; |HAZ Pasalos;  |FINSI;
     |SI eaAplica = "ren2000";   nCampo = 8;  |HAZ Pasalos;  |FINSI;
     |SI eaAplica = "ren1999";   nCampo = 9;  |HAZ Pasalos;  |FINSI;
     |SI eaAplica = "ren1998";   nCampo = 10; |HAZ Pasalos;  |FINSI;
     |SI eaAplica = "ren1997";   nCampo = 11; |HAZ Pasalos;  |FINSI;
     |SI eaAplica = "ren1996";   nCampo = 12; |HAZ Pasalos;  |FINSI;
     |SI eaAplica = "ren1995";   nCampo = 13; |HAZ Pasalos;  |FINSI;
     |SI eaAplica = "ren1994";   nCampo = 14; |HAZ Pasalos;  |FINSI;

     |PULSATECLA;
|FPRC;

|DEFBUCLE dspase15;
     #dspase15#3;
     ;
     00001, "            ", 000;
     99999, "zzzzzzzzzzzz", 999;
     ;
     NULL, dspase15;
|FIN;

|PROCESO Tipo12;  |TIPO 12;
     |SI FSalida = 7;  |ACABA;  |FINSI;

     |CONFI "0000NSeguro de lo seleccionado, puede perder informacion";
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |PUSHV 0501 2380;
     |CUADRO 0501 2380;
     |BLANCO 0602 2279;
     |PINTA 1320, "Introduzca Password : ";
     E_inf = "";
     E_sup = "20";
     aPassword = 1342 ? -1;
     |SI aPassword ! "solojuanma          ";
         |MENAV "     Permiso denegado.";
         |POPV;
         |ACABA;
     |FINSI;
     |POPV;

     eaAplica   = #dspase32#1;  |QBF eaAplica;
     eaTab      = #dspase32#2;

     aPathOrigen = #dspase32#0;  |QBF aPathOrigen;

     |SI eaAplica = "basica";   aPathOrigen = aPathOrigen + "agicli/";    |FINSI;
     |SI eaAplica = "laboral";  aPathOrigen = aPathOrigen + "aginom/";    |FINSI;
     |SI eaAplica = "contasoc"; aPathOrigen = aPathOrigen + "sociedad/";  |FINSI;
     |SI eaAplica = "ren2019";  aPathOrigen = aPathOrigen + "agiren19/";  |FINSI;
     |SI eaAplica = "ren2018";  aPathOrigen = aPathOrigen + "agiren18/";  |FINSI;
     |SI eaAplica = "ren2017";  aPathOrigen = aPathOrigen + "agiren17/";  |FINSI;
     |SI eaAplica = "ren2016";  aPathOrigen = aPathOrigen + "agiren16/";  |FINSI;
     |SI eaAplica = "ren2015";  aPathOrigen = aPathOrigen + "agiren15/";  |FINSI;
     |SI eaAplica = "ren2014";  aPathOrigen = aPathOrigen + "agiren14/";  |FINSI;
     |SI eaAplica = "ren2013";  aPathOrigen = aPathOrigen + "agiren13/";  |FINSI;
     |SI eaAplica = "ren2012";  aPathOrigen = aPathOrigen + "agiren12/";  |FINSI;
     |SI eaAplica = "ren2011";  aPathOrigen = aPathOrigen + "agiren11/";  |FINSI;
     |SI eaAplica = "ren2010";  aPathOrigen = aPathOrigen + "agiren10/";  |FINSI;
     |SI eaAplica = "ren2009";  aPathOrigen = aPathOrigen + "agiren09/";  |FINSI;
     |SI eaAplica = "ren2008";  aPathOrigen = aPathOrigen + "agiren08/";  |FINSI;
     |SI eaAplica = "ren2007";  aPathOrigen = aPathOrigen + "agiren07/";  |FINSI;
     |SI eaAplica = "ren2006";  aPathOrigen = aPathOrigen + "agiren06/";  |FINSI;
     |SI eaAplica = "ren2005";  aPathOrigen = aPathOrigen + "agiren05/";  |FINSI;
     |SI eaAplica = "ren2004";  aPathOrigen = aPathOrigen + "agiren04/";  |FINSI;
     |SI eaAplica = "ren2003";  aPathOrigen = aPathOrigen + "agiren03/";  |FINSI;
     |SI eaAplica = "ren2002";  aPathOrigen = aPathOrigen + "agiren02/";  |FINSI;
     |SI eaAplica = "ren2001";  aPathOrigen = aPathOrigen + "agiren01/";  |FINSI;
     |SI eaAplica = "ren2000";  aPathOrigen = aPathOrigen + "agiren00/";  |FINSI;
     |SI eaAplica = "ren1999";  aPathOrigen = aPathOrigen + "agiren99/";  |FINSI;
     |SI eaAplica = "ren1998";  aPathOrigen = aPathOrigen + "agiren98/";  |FINSI;
     |SI eaAplica = "ren1997";  aPathOrigen = aPathOrigen + "agiren97/";  |FINSI;
     |SI eaAplica = "ren1996";  aPathOrigen = aPathOrigen + "agiren96/";  |FINSI;
     |SI eaAplica = "ren1995";  aPathOrigen = aPathOrigen + "agiren95/";  |FINSI;
     |SI eaAplica = "ren1994";  aPathOrigen = aPathOrigen + "agiren94/";  |FINSI;

     |ABRE #dsficher;
     #dsficher#0 = #dspase32#1;
     #dsficher#1 = aAlfa;
     |LEE 000#dsficher.=;
     |SI FSalida ! 0;
         |CIERRA #dsficher;
         |ERROR;
         |ACABA;
     |FINSI;
     |CIERRA #dsficher;

     aDef = aPathOrigen + "def/" + eaTab + ".mas";
     |CARGA_DEF aDef, ficorig@;

     |DBASS aDef;
     aDef = aDef + #dspase32#1;  |QBF aDef;
     aDef = aDef + "/def/" + eaTab + ".mas";
     |CARGA_DEF aDef, ficdest@;

     aPathOrigen = aPathOrigen + "fich/";
     |DBASS aPathDestino;
     aPathDestino = aPathDestino + #dspase32#1;  |QBF aPathDestino;
     aPathDestino = aPathDestino + "/fich/";

     |PATH_DAT #ficorig@#aPathOrigen#;
     |PATH_DAT #ficdest@#aPathDestino#;

     |ABRE #ficdest@;  |CIERRA #ficdest@;  |DELINDEX #ficdest@;

     |ABRE #ficorig@;
     |ABRE #ficdest@;
     |BUCLE dspase15;
     |CIERRA #ficorig@;
     |CIERRA #ficdest@;

     |DESCARGA_DEF #ficdest@;
     |DESCARGA_DEF #ficorig@;
|FPRC;

|PROCESO Tipo0C2;  |TIPO 0;
     eaAplica =  #dspase32#1;  |QBF eaAplica;
     |SI eaAplica = "facturar";  |O eaAplica = "contagen";
      |O eaAplica = "modelos";
         |MENAV "0000No esta preparado. Solo basica, laboral, contasoc y rentas";
         |ERROR;
         |ACABA;
     |FINSI;

     aAlfa = #dspase32#2;  |QBF aAlfa;
     aAlfa = aAlfa + ".mas";

     |ABRE #dsficher;
     #dsficher#0 = #dspase32#1;
     #dsficher#1 = aAlfa;
     |LEE 000#dsficher.=;
     |SI FSalida ! 0;
         |MENAV "0000No existe la aplicaci¢n o el fichero";
         |CIERRA #dsficher;
         |ERROR;
         |ACABA;
     |FINSI;
     |CIERRA #dsficher;
|FPRC;

|PROCESO Tipo7C0;  |TIPO 7;
     |ABRE #dspase00;
     |LEE 000#dspase00.p;
     |SI FSalida ! 0;  |DDEFECTO #dspase00;  |FINSI;
     |CIERRA #dspase00;

     #dspase32#0 = #dspase00#0;
     |PINTA #dspase32#0;
|FPRC;
