|FICHEROS;
     dspase51;
     dspase15;

     :/integral/def/dsam0000;
     :/integral/def/dsam0010;
     :/integral/def/dsam0107;
     :/integral/def/dsam0116;

     :/contagen/def/canempre;

     :/modelos/def/dsmom003;

     :/contasoc/def/maempr01;

     :/laboral/def/labtraba;

     :/facturar/def/facemp;
     :/facturar/def/ashismic;

     :/basica/def/dsficher;
     :/basica/def/agidanif;

     dspasw04,MANTE;
     dspasw05,MANTE;
     dspasw06,MANTE;

     cargadef@;
     ficdesti@;
     ficorige@;
|FIN;

|VARIABLES;
      nContador      = 0;
      nRegistro      = 0;
      nModelo        = 0;
      nRenta         = 0;
      nNif           = 0;
      nModo          = 0;
      nHandle        = 0;
      nNoventaMil    = 0;
      nPasada        = 0;
      nCod           = 0;
      nControl       = 0;
      nTratoEspecial = 0;
      nConta         = 0;
      nTConta        = 0;
      nBanco         = 0;
      nHay           = 0;
      nLinea         = 0;

      fFecha         = @;

      aAlfa          = "";
      aFichero       = "";
      aPassword      = "";
      aBase          = "";
      aPath          = "";
      aDef           = "";
      aPathOrigen    = "";
      aPathDestino   = "";
      aPathFicOrigen = "";
      aPathFicDestino= "";
      aPathFicBasica = "";
      aPathDefSQL    = "";
      aPathDefFichero= "";
      aDirFichOrigen = "";
      aDirEmpresa    = "";
      aFicheroOrigen = "";
      aPathDefDestino= "";
      aMas           = "";
      aHora          = "";
      aAbre          = "";
      aDescri        = "";

     &eaEjec         = "";
     &eaPathAnterior = "";
     &eaPathBasica   = "";
     &eaPathContagen = "";
     &eaPathContanex = "";
     &eaPathContasoc = "";
     &eaPathRen2000  = "";
     &eaPathRen1999  = "";
     &eaPathRen1998  = "";
     &eaPathRen1997  = "";
     &eaPathRen1996  = "";
     &eaPathRen1995  = "";
     &eaPathRen1994  = "";
     &eaPathFacturar = "";
     &eaPathLaboral  = "";
     &eaPathIntegral = "";
     &eaPathDsmodelo = "";
     &eaPathFiscal   = "";
     &aPathFich      = "";
     &eaDSMAC        = "";
     &enCodCli       = 0;
     &enAbogados     = 0;
     &enDesdeFuera   = 0;

     nDClave1        = 0;
     nHClave1        = 0;
     nDClave2        = 0;
     nHClave2        = 0;
     nDClave3        = 0;
     nHClave3        = 0;
     nDClave4        = 0;
     nHClave4        = 0;
     nDClave5        = 0;
     nHClave5        = 0;
     nDClave6        = 0;
     nHClave6        = 0;
     nDClave7        = 0;
     nHClave7        = 0;
     nCampo          = 0;

     nCampo1         = 0;
     nCampo2         = 0;
     nCampo3         = 0;
     nClave          = 0;
     nPosClave       = 0;
     nDEmpresa       = 0;
     nHEmpresa       = 0;
     nCampoDef       = 0;
     nTCampo         = 0;
     nCampoCli       = 0;
     nPasoIntegral   = 0;

     aAlfa1          = "";
     aAlfa2          = "";
     aAlfa3          = "";
     aDAlfa1         = "";
     aHAlfa1         = "";
     aDAlfa2         = "";
     aHAlfa2         = "";
     aDAlfa3         = "";
     aHAlfa3         = "";
     aDAlfa4         = "";
     aHAlfa4         = "";
     aDAlfa5         = "";
     aHAlfa5         = "";
     aDAlfa6         = "";
     aHAlfa6         = "";
     aDAlfa7         = "";
     aHAlfa7         = "";
     aTipoBucle      = "";
     aOrigen         = "";
     aDestino        = "";
     aAplica         = "";
     aMaximo         = "";
     aMinimo         = "";
     aDir            = "";
     aDirecBuscar    = "";
     aDirFichDestino = "";
     aQueQuiero      = "";
     aCampo          = "";
     aBorrar         = "";
     aSelect         = "";
     aFrom           = "";
     aInto           = "";
     aWhere          = "";
     aFichSql        = "";
     aFich           = "";
     aDDef           = "";
     aHDef           = "";

     &enBorraTodo    = 0;
     &eaVarDni       = "";
     &enCalcCif      = 0;
     &enEmpresa      = 0;
     &enEmpresaN     = 0;
     &enEmpFac       = 0;
     &enCambioCli    = 0;

     &eaPasaCact     = "N";
     &eaPasaNuct     = "";
     &eaPasaCont     = "SI";
     &eaPasaFisc     = "SI";
     &eaPasaSoci     = "SI";
     &eaPasaRent     = "SI";
     &eaPasaLabo     = "SI";
     &eaPasaFact     = "SI";
     &eaPasaMaes     = "SI";
     &eaPasaArch     = "SI";
     &eaPasaR1994    = "SI";
     &eaPasaR1995    = "SI";
     &eaPasaR1996    = "SI";
     &eaPasaR1997    = "SI";
     &eaPasaR1998    = "SI";
     &eaPasaR1999    = "SI";
     &eaPasaR2000    = "SI";
     &eaPasaR2001    = "SI";
     &eaPasaR2002    = "SI";
     &eaPasaR2003    = "SI";
     &eaPasaR2004    = "SI";
     &eaPasaR2005    = "SI";
     &eaPasaR2006    = "SI";
     &eaPasaR2007    = "SI";
     &eaPasaR2008    = "SI";
     &eaPasaR2009    = "SI";
     &eaPasaR2010    = "SI";
     &eaPasaR2011    = "SI";
     &eaPasaR2012    = "SI";
     &eaPasaR2013    = "SI";
     &eaPasaR2014    = "SI";
     &eaPasaR2015    = "SI";
     &eaPasaR2016    = "SI";
     &eaPasaR2017    = "SI";
     &eaPasaR2018    = "SI";
|FIN;

|| **************************************************************************
||   PASES DE MAESTROS
|| **************************************************************************

|PROCESO CopiaMaestro;
     aAlfa = aFicheroOrigen < "";
     aAlfa = aAlfa - ".dat" + ".mas";
     aMas  = aPathDefDestino + aAlfa;
     |XABRE "E", aMas, nHandle;
     |SI FSalida < 0;  |ACABA;  |FINSI;

     |SI nControl = 0;
         #dsficher#0 = aAplica;
         #dsficher#1 = aAlfa;
         |LEE 000#dsficher.=;
         |SI FSalida = 0;  |ACABA;  |FINSI;
     |FINSI;

     aAlfa1 = aFichero < "";
     aAlfa2 = aPathDestino + aFicheroOrigen;
     aAlfa2 = aAlfa2 < "";

     aOrigen  = aAlfa1;
     aDestino = aAlfa2;
     |COPIA_FICHERO aOrigen, aDestino;

     aOrigen  = aAlfa1 - ".dat" + ".ddx";
     aDestino = aAlfa2 - ".dat" + ".ddx";
     |COPIA_FICHERO aOrigen, aDestino;

     aOrigen  = aAlfa1 - ".dat" + ".ixx";
     aDestino = aAlfa2 - ".dat" + ".ixx";
     |COPIA_FICHERO aOrigen, aDestino;
|FPRC;

|PROCESO ElDir;
     |DBASS aPathDestino;   |QBF aPathDestino;

     aPathDefDestino = aPathDestino + aAplica + "/def/";

     aPathDestino    = aPathDestino   + aAplica;  |MKDIR aPathDestino;
     aPathDestino    = aPathDestino   + "/fich";  |MKDIR aPathDestino;
     aPathDestino    = aPathDestino   + "/";

     aDirFichOrigen  = #dspase51#0;  |QBF aDirFichOrigen;
     aDirFichOrigen  = aDirFichOrigen + aAplica + "/fich/";

     |SI aDirEmpresa ! "";
         aDirFichOrigen  = aDirFichOrigen + aDirEmpresa + "/";
         aPathDestino    = aPathDestino   + aDirEmpresa;
         |MKDIR aPathDestino;
         aPathDestino    = aPathDestino   + "/";
     |FINSI;

     aFichero = aDirFichOrigen + "*.dat";
     |_PDIR aFichero;
     |PARA; |SI FSalida = 0; |HACIENDO;
            aFicheroOrigen = aFichero - aDirFichOrigen;
            |HAZ CopiaMaestro;

            |_SDIR aFichero;
     |SIGUE;

     |PULSATECLA;
     |PULSATECLA;
     |PULSATECLA;
|FPRC;

|PROCESO facempMaestros;
     aDirEmpresa = ("00" + #facemp#0) % -102;

                           nControl = 0;
     |SI #facemp#3 = "N";  nControl = 1;  |FINSI;
     |HAZ ElDir;
|FPRC;

|DEFBUCLE facempMaestros;
     #facemp#1;
     ;
     00;
     99;
     ;
     NULL, facempMaestros;
|FIN;

|PROCESO TraeteFacturar;
     aDirEmpresa = "";
     aAplica     = "facturar";
     nControl    = 0;
     |HAZ ElDir;

     aBase = #dspase51#0;  |QBF aBase;
     aPath = aBase + "facturar/fich/";
     |PATH_DAT #facemp#aPath#;

     aAplica = "facturar";
     |BUCLE facempMaestros;
|FPRC;

|PROCESO MaestrosLaboral;
     aDirEmpresa = "";
     aAplica     = "laboral";
     nControl    = 0;
     |HAZ ElDir;

     |DBASS aPathDestino;
     aPathDefDestino = aPathDestino + "basica/def/";
     aPathDestino    = aPathDestino + "basica/fich/";
     aDirFichOrigen  = #dspase51#0;  |QBF aDirFichOrigen;
     aDirFichOrigen  = aDirFichOrigen + "basica/fich/";
     aFicheroOrigen  = "agidanif.dat";

     aOrigen  = aDirFichOrigen + "agidanif.dat";
     aDestino = aPathDestino + "agidanif.dat";
     |COPIA_FICHERO aOrigen, aDestino;

     aOrigen  = aDirFichOrigen + "agidanif.ddx";
     aDestino = aPathDestino + "agidanif.ddx";
     |COPIA_FICHERO aOrigen, aDestino;

     aOrigen  = aDirFichOrigen + "agidanif.ixx";
     aDestino = aPathDestino + "agidanif.ixx";
     |COPIA_FICHERO aOrigen, aDestino;

     |DBASS aPathDestino;
     aDef          = aPathDestino + "integral/def/dsam0103.mas";
     aPathDestino  = aPathDestino + "integral/fich/";
     |CARGA_DEF aDef, ficdesti@;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |CARGA_DEF aDef, ficorige@;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     aQueQuiero = "|NC";
     aCampo     = #ficdesti@#aQueQuiero#;
     nTCampo    = aCampo;
     nTCampo    = nTCampo - 1;

     aDirFichOrigen  = #dspase51#0;  |QBF aDirFichOrigen;
     aDirFichOrigen  = aDirFichOrigen + "integral/fich/";
     |PATH_DAT #ficorige@#aDirFichOrigen#;
     |PATH_DAT #ficdesti@#aPathDestino#;

     |ABRET #ficdesti@;
     |ABRET #ficorige@;
     |ABRE #agidanif;
     |LEE 000#ficorige@.p;
     |PARA;  |SI FSalida = 0;  |HACIENDO;
         |PARA nCampoDef = 0;  |SI nCampoDef [ nTCampo;  |HACIENDO nCampoDef = nCampoDef + 1;
               #ficdesti@#nCampoDef# = #ficorige@#nCampoDef#;
         |SIGUE;

         |LEE 101#ficdesti@.=;
         |SI FSalida ! 0;
             |PARA nCampoDef = 0;  |SI nCampoDef [ nTCampo;  |HACIENDO nCampoDef = nCampoDef + 1;
                   #ficdesti@#nCampoDef# = #ficorige@#nCampoDef#;
             |SIGUE;
             |GRABA 020#ficdesti@.n;
         |SINO;
             #agidanif#0 = #ficorige@#0;
             #agidanif#1 = 1;
             |LEE 000#agidanif.];
             |SI FSalida = 0;  |Y #agidanif#0 = #ficorige@#0;
                 |PARA nCampoDef = 0;  |SI nCampoDef [ nTCampo;  |HACIENDO nCampoDef = nCampoDef + 1;
                       #ficdesti@#nCampoDef# = #ficorige@#nCampoDef#;
                 |SIGUE;
                 |GRABA 020#ficdesti@.a;
             |FINSI;
         |FINSI;

         |LIBERA #ficdesti@;

         |LEE 000#ficorige@.s;
     |SIGUE;

     |CIERRA #agidanif;
     |CIERRAT #ficdesti@;
     |CIERRAT #ficorige@;

     |DESCARGA_DEF #ficorige@;
     |DESCARGA_DEF #ficdesti@;

     |PULSATECLA;
     |PULSATECLA;
     |PULSATECLA;
|FPRC;

|PROCESO TratoNormalIntegral;
     |ABRET #ficdesti@;
     |ABRET #ficorige@;
     |LEE 040#ficorige@.p;
     |PARA;  |SI FSalida = 0;  |HACIENDO;
          |PARA nCampoDef = 0;  |SI nCampoDef [ nTCampo;  |HACIENDO nCampoDef = nCampoDef + 1;
                #ficdesti@#nCampoDef# = #ficorige@#nCampoDef#;
          |SIGUE;

          |LEE 101#ficdesti@.=;
          |SI FSalida ! 0;
              |PARA nCampoDef = 0;  |SI nCampoDef [ nTCampo;  |HACIENDO nCampoDef = nCampoDef + 1;
                    #ficdesti@#nCampoDef# = #ficorige@#nCampoDef#;
              |SIGUE;
              |GRABA 020#ficdesti@.n;
          |SINO;
              |PARA nCampoDef = 0;  |SI nCampoDef [ nTCampo;  |HACIENDO nCampoDef = nCampoDef + 1;
                    #ficdesti@#nCampoDef# = #ficorige@#nCampoDef#;
              |SIGUE;
              |GRABA 020#ficdesti@.a;
          |FINSI;

          |LIBERA #ficdesti@;

          |LEE 000#ficorige@.s;
     |SIGUE;
|FPRC;

|PROCESO TratoEspecialIntegral;
     |ABRET #ficdesti@;
     |ABRET #ficorige@;
     |LEE 040#ficorige@.p;
     |PARA;  |SI FSalida = 0;  |HACIENDO;
          |PARA nCampoDef = 0;  |SI nCampoDef [ nTCampo;  |HACIENDO nCampoDef = nCampoDef + 1;
                #ficdesti@#nCampoDef# = #ficorige@#nCampoDef#;
          |SIGUE;

          |LEE 101#ficdesti@.=;
          |SI FSalida ! 0;
              |PARA nCampoDef = 0;  |SI nCampoDef [ nTCampo;  |HACIENDO nCampoDef = nCampoDef + 1;
                    #ficdesti@#nCampoDef# = #ficorige@#nCampoDef#;
              |SIGUE;
              |GRABA 020#ficdesti@.n;
          |FINSI;

          |LIBERA #ficdesti@;

          |LEE 000#ficorige@.s;
     |SIGUE;
|FPRC;

|PROCESO TraeteIntegral;
     |DBASS aPathDestino;
     aDef          = aPathDestino + aAplica + "/def/" + aFichero;
     aPathDestino  = aPathDestino + aAplica + "/fich/";
     |CARGA_DEF aDef, ficdesti@;
     |SI FSalida ! 0;
         |ACABA;
     |FINSI;

     aQueQuiero = "|NC";
     aCampo     = #ficdesti@#aQueQuiero#;
     nTCampo    = aCampo;
     nTCampo    = nTCampo - 1;

     |CARGA_DEF aDef, ficorige@;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     aDirFichOrigen  = #dspase51#0;  |QBF aDirFichOrigen;
     aDirFichOrigen  = aDirFichOrigen + aAplica + "/fich/";
     |PATH_DAT #ficorige@#aDirFichOrigen#;
     |PATH_DAT #ficdesti@#aPathDestino#;

     |ABRE #ficdesti@;
     |SI nTratoEspecial = 0;  |HAZ TratoNormalIntegral;    |FINSI;
     |SI nTratoEspecial = 1;  |HAZ TratoEspecialIntegral;  |FINSI;
     |CIERRA #ficdesti@;

     |DESCARGA_DEF #ficorige@;
     |DESCARGA_DEF #ficdesti@;
|FPRC;

|PROCESO MaestrosIntegral;
     aAplica        = "integral";

     aFichero       = "dsam0100.mas";  nTratoEspecial = 1;  |HAZ TraeteIntegral;
     aFichero       = "dsam0101.mas";  nTratoEspecial = 1;  |HAZ TraeteIntegral;
     aFichero       = "dsam0102.mas";  nTratoEspecial = 1;  |HAZ TraeteIntegral;
     aFichero       = "dsam0104.mas";  nTratoEspecial = 1;  |HAZ TraeteIntegral;
     aFichero       = "dsam0105.mas";  nTratoEspecial = 1;  |HAZ TraeteIntegral;
     aFichero       = "dsam0106.mas";  nTratoEspecial = 1;  |HAZ TraeteIntegral;
     aFichero       = "dsam0107.mas";  nTratoEspecial = 1;  |HAZ TraeteIntegral;
     aFichero       = "dsam0114.mas";  nTratoEspecial = 1;  |HAZ TraeteIntegral;
     aFichero       = "dsam0115.mas";  nTratoEspecial = 1;  |HAZ TraeteIntegral;
     aFichero       = "dsam0116.mas";  nTratoEspecial = 0;  |HAZ TraeteIntegral;
     aFichero       = "dsam0117.mas";  nTratoEspecial = 0;  |HAZ TraeteIntegral;
     aFichero       = "dsam0118.mas";  nTratoEspecial = 0;  |HAZ TraeteIntegral;
     aFichero       = "dsam0123.mas";  nTratoEspecial = 1;  |HAZ TraeteIntegral;
     aFichero       = "dsam0124.mas";  nTratoEspecial = 1;  |HAZ TraeteIntegral;

     |PULSATECLA;
     |PULSATECLA;
     |PULSATECLA;
|FPRC;

|| **************************************************************************

|PROCESO CargaNormal;
     |PARA nCampoDef = 0;  |SI nCampoDef [ nTCampo;  |HACIENDO nCampoDef = nCampoDef + 1;
           #ficdesti@#nCampoDef# = #ficorige@#nCampoDef#;
     |SIGUE;
     #ficdesti@#nCampoCli# = #dspasw06#19;

     |LEE 101#ficdesti@.=;
     |SI FSalida ! 0;
         |PARA nCampoDef = 0;  |SI nCampoDef [ nTCampo;  |HACIENDO nCampoDef = nCampoDef + 1;
               #ficdesti@#nCampoDef# = #ficorige@#nCampoDef#;
         |SIGUE;
         #ficdesti@#nCampoCli# = #dspasw06#19;
         |GRABA 020#ficdesti@.n;
     |SINO;
         |PARA nCampoDef = 0;  |SI nCampoDef [ nTCampo;  |HACIENDO nCampoDef = nCampoDef + 1;
               #ficdesti@#nCampoDef# = #ficorige@#nCampoDef#;
         |SIGUE;
         #ficdesti@#nCampoCli# = #dspasw06#19;
         |GRABA 020#ficdesti@.a;
     |FINSI;

     |LIBERA #ficdesti@;
|FPRC;

|PROCESO CargaEspecial;
     |PARA nCampoDef = 0;  |SI nCampoDef [ nTCampo;  |HACIENDO nCampoDef = nCampoDef + 1;
           #ficdesti@#nCampoDef# = #ficorige@#nCampoDef#;
     |SIGUE;
     #ficdesti@#nCampoCli# = #dspasw06#19;

     |LEE 101#ficdesti@.=;
     |SI FSalida ! 0;
         |PARA nCampoDef = 0;  |SI nCampoDef [ nTCampo;  |HACIENDO nCampoDef = nCampoDef + 1;
               #ficdesti@#nCampoDef# = #ficorige@#nCampoDef#;
         |SIGUE;
         #ficdesti@#nCampoCli# = #dspasw06#19;
         |GRABA 020#ficdesti@.n;
     |SINO;
         |SI aFichero = "dsam0000.mas";
             aAlfa = #ficorige@#53;  |QBF aAlfa;
             |SI aAlfa ! "";
                 #ficdesti@#53 = #ficorige@#53;
             |FINSI;

             #ficdesti@#4   = #ficorige@#4;
             #ficdesti@#70  = #ficorige@#70;
             #ficdesti@#71  = #ficorige@#71;
             #ficdesti@#73  = #ficorige@#73;
             #ficdesti@#74  = #ficorige@#74;
             #ficdesti@#88  = #ficorige@#88;
             #ficdesti@#89  = #ficorige@#89;
             #ficdesti@#90  = #ficorige@#90;
             #ficdesti@#91  = #ficorige@#91;
             #ficdesti@#92  = #ficorige@#92;
             #ficdesti@#93  = #ficorige@#93;
             #ficdesti@#94  = #ficorige@#94;
             #ficdesti@#95  = #ficorige@#95;
             #ficdesti@#96  = #ficorige@#96;
             #ficdesti@#97  = #ficorige@#97;
             #ficdesti@#103 = #ficorige@#103;
             #ficdesti@#104 = #ficorige@#104;
             #ficdesti@#111 = #ficorige@#111;
             #ficdesti@#112 = #ficorige@#112;
             #ficdesti@#113 = #ficorige@#113;
             #ficdesti@#114 = #ficorige@#114;
             #ficdesti@#115 = #ficorige@#115;
             #ficdesti@#116 = #ficorige@#116;
             #ficdesti@#117 = #ficorige@#117;
             #ficdesti@#118 = #ficorige@#118;
             #ficdesti@#119 = #ficorige@#119;

             |GRABA 020#ficdesti@.a;
         |FINSI;

         |SI aFichero = "dsam0005.mas";
             |SI #ficorige@#1 = 99;
                 |PARA nCampoDef = 2;  |SI nCampoDef [ nTCampo;  |HACIENDO nCampoDef = nCampoDef + 1;
                       #ficdesti@#nCampoDef# = #ficorige@#nCampoDef#;
                 |SIGUE;

                 |GRABA 020#ficdesti@.a;
             |FINSI;
         |FINSI;
     |FINSI;

     |LIBERA #ficdesti@;
|FPRC;

|PROCESO TratoNormalSQL;
     |ABRET #ficdesti@;
     |ABRET #ficorige@;
     |LEE 040#ficorige@.p;
     |PARA;  |SI FSalida = 0;  |HACIENDO;
          |HAZ CargaNormal;

          |LEE 000#ficorige@.s;
     |SIGUE;
|FPRC;

|PROCESO TratoEspecialSQL;
     |ABRET #ficdesti@;
     |ABRET #ficorige@;
     |LEE 040#ficorige@.p;
     |PARA;  |SI FSalida = 0;  |HACIENDO;
          |HAZ CargaEspecial;

          |LEE 000#ficorige@.s;
     |SIGUE;
|FPRC;

|PROCESO PorSQL;
     aFichSql = ("sql" + Usuario + "zzzzzzzz") % 108;
     aOrigen  = aDef;
     aDestino = aPathDefSQL + "dsborsql.mas";
     |COPIA_FICHERO aOrigen, aDestino;

     aPathFich = aPathFicOrigen;

     |CARGA_DEF aDestino, ficorige@;
     |SI FSalida = 0;
         |PATH_DAT #ficorige@#aPathFicBasica#;
         |NOME_DAT #ficorige@#aFichSql#;

         aSelect = "SELECT * ";
         aFrom   = "FROM "  + "dsborsql ";
         aInto   = "INTO "  + aFichSql + ".def ";
         aWhere  = "WHERE " + nCampoCli + " == " + #dspasw06#0;
         eaEjec  =  aSelect + aFrom + aInto + aWhere;
         |SUB_EJECUTA_NP "dsborra1;NOMEQUITESQUETECORTOLOSGUEVOS";
         |PULSATECLA;

         |SI aFichero = "dsam0005.mas";
             |HAZ TratoEspecialSQL;
         |SINO;
             |SI nTratoEspecial = 0;  |HAZ TratoNormalSQL;    |FINSI;
             |SI nTratoEspecial = 1;  |HAZ TratoEspecialSQL;  |FINSI;
         |FINSI;

         |CIERRAT #ficdesti@;
         |CIERRAT #ficorige@;

         |DELINDEX #ficorige@;

         |DESCARGA_DEF #ficorige@;
     |FINSI;

     aDestino = aPathDefSQL + "dsborsql.mas";
     aBorrar  = aPathDefSQL + aFichSql  + ".mas";  |FBORRA aBorrar;
     aBorrar  = aPathDefSQL + "dsborsql.mas";      |FBORRA aBorrar;

     aOrigen  = aPathDefSQL + "dsborsq1.mas";
     aDestino = aPathDefSQL + "dsborsql.mas";
     |COPIA_FICHERO aOrigen, aDestino;

     |PULSATECLA;
|FPRC;

|PROCESO QueHago;
     |SI aFichero = "dsam0005.mas";
         |HAZ CargaEspecial;
     |SINO;
         |SI nTratoEspecial = 0;  |HAZ CargaNormal;    |FINSI;
         |SI nTratoEspecial = 1;  |HAZ CargaEspecial;  |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE buN;
     #ficorige@#1001;
     ;
     nDClave1;
     nHClave1;
     ;
     NULL, QueHago;
|FIN;

|DEFBUCLE buNN;
     #ficorige@#1002;
     ;
     nDClave1, nDClave2;
     nHClave1, nHClave2;
     ;
     NULL, QueHago;
|FIN;

|DEFBUCLE buAN;
     #ficorige@#1002;
     ;
     aDAlfa1, nDClave1;
     aHAlfa1, nHClave1;
     ;
     NULL, QueHago;
|FIN;

|DEFBUCLE buNA;
     #ficorige@#1002;
     ;
     nDClave1, aDAlfa1;
     nHClave1, aHAlfa1;
     ;
     NULL, QueHago;
|FIN;

|DEFBUCLE buNNN;
     #ficorige@#1003;
     ;
     nDClave1, nDClave2, nDClave3;
     nHClave1, nHClave2, nHClave3;
     ;
     NULL, QueHago;
|FIN;

|DEFBUCLE buANN;
     #ficorige@#1003;
     ;
     aDAlfa1, nDClave1, nDClave2;
     aHAlfa1, nHClave1, nHClave2;
     ;
     NULL, QueHago;
|FIN;

|DEFBUCLE buNNA;
     #ficorige@#1003;
     ;
     nDClave1, nDClave2, aDAlfa1;
     nHClave1, nHClave2, aHAlfa1;
     ;
     NULL, QueHago;
|FIN;

|DEFBUCLE buNAN;
     #ficorige@#1003;
     ;
     nDClave1, aDAlfa1, nDClave2;
     nHClave1, aHAlfa1, nHClave2;
     ;
     NULL, QueHago;
|FIN;

|DEFBUCLE buNNNN;
     #ficorige@#1004;
     ;
     nDClave1, nDClave2, nDClave3, nDClave4;
     nHClave1, nHClave2, nHClave3, nHClave4;
     ;
     NULL, QueHago;
|FIN;

|DEFBUCLE buNNNA;
     #ficorige@#1004;
     ;
     nDClave1, nDClave2, nDClave3, aDAlfa1;
     nHClave1, nHClave2, nHClave3, aHAlfa1;
     ;
     NULL, QueHago;
|FIN;

|DEFBUCLE buNANN;
     #ficorige@#1004;
     ;
     nDClave1, aDAlfa1, nDClave2, nDClave3;
     nHClave1, aHAlfa1, nHClave2, nHClave3;
     ;
     NULL, QueHago;
|FIN;

|DEFBUCLE buNNNNN;
     #ficorige@#1005;
     ;
     nDClave1, nDClave2, nDClave3, nDClave4, nDClave5;
     nHClave1, nHClave2, nHClave3, nHClave4, nHClave5;
     ;
     NULL, QueHago;
|FIN;

|DEFBUCLE buANNNN;
     #ficorige@#1005;
     ;
     aDAlfa1, nDClave1, nDClave2, nDClave3, nDClave4;
     aHAlfa1, nHClave1, nHClave2, nHClave3, nHClave4;
     ;
     NULL, QueHago;
|FIN;

|DEFBUCLE buNANNN;
     #ficorige@#1005;
     ;
     nDClave1, aDAlfa1, nDClave2, nDClave3, nDClave4;
     nHClave1, aHAlfa1, nHClave2, nHClave3, nHClave4;
     ;
     NULL, QueHago;
|FIN;

|DEFBUCLE buNNAN;
     #ficorige@#1004;
     ;
     nDClave1, nDClave2, aDAlfa1, nDClave3;
     nHClave1, nHClave2, aHAlfa1, nHClave3;
     ;
     NULL, QueHago;
|FIN;

|DEFBUCLE buNNANA;
     #ficorige@#1005;
     ;
     nDClave1, nDClave2, aDAlfa1, nDClave3, aDAlfa2;
     nHClave1, nHClave2, aHAlfa1, nHClave3, aHAlfa2;
     ;
     NULL, QueHago;
|FIN;

|DEFBUCLE buNNNNNN;
     #ficorige@#1006;
     ;
     nDClave1, nDClave2, nDClave3, nDClave4, nDClave5, nDClave6;
     nHClave1, nHClave2, nHClave3, nHClave4, nHClave5, nHClave6;
     ;
     NULL, QueHago;
|FIN;

|DEFBUCLE buNNNNNNN;
     #ficorige@#1007;
     ;
     nDClave1, nDClave2, nDClave3, nDClave4, nDClave5, nDClave6, nDClave7;
     nHClave1, nHClave2, nHClave3, nHClave4, nHClave5, nHClave6, nHClave7;
     ;
     NULL, QueHago;
|FIN;

|DEFBUCLE buNNNNNA;
     #ficorige@#1006;
     ;
     nDClave1, nDClave2, nDClave3, nDClave4, nDClave5, aDAlfa1;
     nHClave1, nHClave2, nHClave3, nHClave4, nHClave5, aHAlfa1;
     ;
     NULL, QueHago;
|FIN;

|DEFBUCLE buNNNNNNA;
     #ficorige@#1007;
     ;
     nDClave1, nDClave2, nDClave3, nDClave4, nDClave5, nDClave6, aDAlfa1;
     nHClave1, nHClave2, nHClave3, nHClave4, nHClave5, nHClave6, aHAlfa1;
     ;
     NULL, QueHago;
|FIN;

|DEFBUCLE buNNNANA;
     #ficorige@#1006;
     ;
     nDClave1, nDClave2, nDClave3, aDAlfa1, nDClave4, aDAlfa2;
     nHClave1, nHClave2, nHClave3, aHAlfa2, nHClave4, aHAlfa2;
     ;
     NULL, QueHago;
|FIN;

|PROCESO TrataFichero;
     aDef = aPathDefFichero + aFichero;
     |CARGA_DEF aDef, ficdesti@;
     |SI FSalida ! 0;
         |ACABA;
     |FINSI;

     aQueQuiero = "|NC";
     aCampo     = #ficdesti@#aQueQuiero#;
     nTCampo    = aCampo;
     nTCampo    = nTCampo - 1;

     |SI aTipoBucle ! "";
         |CARGA_DEF aDef, ficorige@;
         |SI FSalida ! 0;  |ACABA;  |FINSI;

         |PATH_DAT #ficorige@#aPathFicOrigen#;
     |FINSI;

     |PATH_DAT #ficdesti@#aPathFicDestino#;
     |ABRE #ficdesti@;

     |SI aTipoBucle = "N";           |BUCLE buN;           |FINSI;
     |SI aTipoBucle = "NN";          |BUCLE buNN;          |FINSI;
     |SI aTipoBucle = "NA";          |BUCLE buNA;          |FINSI;
     |SI aTipoBucle = "AN";          |BUCLE buAN;          |FINSI;
     |SI aTipoBucle = "NNN";         |BUCLE buNNN;         |FINSI;
     |SI aTipoBucle = "ANN";         |BUCLE buANN;         |FINSI;
     |SI aTipoBucle = "NNA";         |BUCLE buNNA;         |FINSI;
     |SI aTipoBucle = "NAN";         |BUCLE buNAN;         |FINSI;
     |SI aTipoBucle = "NNNA";        |BUCLE buNNNA;        |FINSI;
     |SI aTipoBucle = "NANN";        |BUCLE buNANN;        |FINSI;
     |SI aTipoBucle = "NNNN";        |BUCLE buNNNN;        |FINSI;
     |SI aTipoBucle = "NANNN";       |BUCLE buNANNN;       |FINSI;
     |SI aTipoBucle = "NNAN";        |BUCLE buNNAN;        |FINSI;
     |SI aTipoBucle = "NNANA";       |BUCLE buNNANA;       |FINSI;
     |SI aTipoBucle = "NNNNN";       |BUCLE buNNNNN;       |FINSI;
     |SI aTipoBucle = "ANNNN";       |BUCLE buANNNN;       |FINSI;
     |SI aTipoBucle = "NNNNNA";      |BUCLE buNNNNNA;      |FINSI;
     |SI aTipoBucle = "NNNNNN";      |BUCLE buNNNNNN;      |FINSI;
     |SI aTipoBucle = "NNNNNNN";     |BUCLE buNNNNNNN;     |FINSI;
     |SI aTipoBucle = "NNNNNNA";     |BUCLE buNNNNNNA;     |FINSI;
     |SI aTipoBucle = "NNNANA";      |BUCLE buNNNANA;      |FINSI;
     |SI aTipoBucle = "";            |HAZ   PorSQL;        |FINSI;

     |CIERRA #ficdesti@;

     |SI aTipoBucle ! "";  |DESCARGA_DEF #ficorige@;  |FINSI;

                          |DESCARGA_DEF #ficdesti@;
|FPRC;

|PROCESO ClaveNumerica;
     nCampo1 = nCampo;
     nCampo2 = nCampo + 1;
     nCampo3 = nCampo + 2;

     nPosClave = (#dsficher#29 * 3) + 3;
     |SI nPosClave = nCampo1;
         |SI nClave = 1; nDClave1 = #dspasw06#0;  nHClave1 = #dspasw06#0;  |FINSI;
         |SI nClave = 2; nDClave2 = #dspasw06#0;  nHClave2 = #dspasw06#0;  |FINSI;
         |SI nClave = 3; nDClave3 = #dspasw06#0;  nHClave3 = #dspasw06#0;  |FINSI;
         |SI nClave = 4; nDClave4 = #dspasw06#0;  nHClave4 = #dspasw06#0;  |FINSI;
         |SI nClave = 5; nDClave5 = #dspasw06#0;  nHClave5 = #dspasw06#0;  |FINSI;
         |SI nClave = 6; nDClave6 = #dspasw06#0;  nHClave6 = #dspasw06#0;  |FINSI;
         |SI nClave = 7; nDClave7 = #dspasw06#0;  nHClave7 = #dspasw06#0;  |FINSI;
         |ACABA;
     |FINSI;

     aMaximo = "9" * #dsficher#nCampo2#;
     |SI #dsficher#nCampo3# = 1;
         |SI nClave = 1; nDClave1 = 0;  nHClave1 = aMaximo;  |FINSI;
         |SI nClave = 2; nDClave2 = 0;  nHClave2 = aMaximo;  |FINSI;
         |SI nClave = 3; nDClave3 = 0;  nHClave3 = aMaximo;  |FINSI;
         |SI nClave = 4; nDClave4 = 0;  nHClave4 = aMaximo;  |FINSI;
         |SI nClave = 5; nDClave5 = 0;  nHClave5 = aMaximo;  |FINSI;
         |SI nClave = 6; nDClave6 = 0;  nHClave6 = aMaximo;  |FINSI;
         |SI nClave = 7; nDClave7 = 0;  nHClave7 = aMaximo;  |FINSI;
     |SINO;
         |SI nClave = 1; nDClave1 = aMaximo;   nHClave1 = 0; |FINSI;
         |SI nClave = 2; nDClave2 = aMaximo;   nHClave2 = 0; |FINSI;
         |SI nClave = 3; nDClave3 = aMaximo;   nHClave3 = 0; |FINSI;
         |SI nClave = 4; nDClave4 = aMaximo;   nHClave4 = 0; |FINSI;
         |SI nClave = 5; nDClave5 = aMaximo;   nHClave5 = 0; |FINSI;
         |SI nClave = 6; nDClave6 = aMaximo;   nHClave6 = 0; |FINSI;
         |SI nClave = 7; nDClave7 = aMaximo;   nHClave7 = 0; |FINSI;
     |FINSI;
|FPRC;

|PROCESO ClaveAlfanumerica;
     nCampo1 = nCampo;
     nCampo2 = nCampo + 1;
     nCampo3 = nCampo + 2;

     |SI #dsficher#nCampo1# = "A";
         aMinimo = " " * #dsficher#nCampo2#;
         aMaximo = "z" * #dsficher#nCampo2#;
     |SINO;
         aMinimo = "01.01.0000";
         aMaximo = "31.12.9999";
     |FINSI;

     |SI #dsficher#nCampo3# = 1;
         |SI nClave = 1; aDAlfa1  = aMinimo;  aHAlfa1 = aMaximo;  |FINSI;
         |SI nClave = 2; aDAlfa2  = aMinimo;  aHAlfa2 = aMaximo;  |FINSI;
         |SI nClave = 3; aDAlfa3  = aMinimo;  aHAlfa3 = aMaximo;  |FINSI;
         |SI nClave = 4; aDAlfa4  = aMinimo;  aHAlfa4 = aMaximo;  |FINSI;
         |SI nClave = 5; aDAlfa5  = aMinimo;  aHAlfa5 = aMaximo;  |FINSI;
         |SI nClave = 6; aDAlfa6  = aMinimo;  aHAlfa6 = aMaximo;  |FINSI;
         |SI nClave = 7; aDAlfa7  = aMinimo;  aHAlfa7 = aMaximo;  |FINSI;
     |SINO;
         |SI nClave = 1; aDAlfa1  = aMaximo;  aHAlfa1 = aMinimo;  |FINSI;
         |SI nClave = 2; aDAlfa2  = aMaximo;  aHAlfa2 = aMinimo;  |FINSI;
         |SI nClave = 3; aDAlfa3  = aMaximo;  aHAlfa3 = aMinimo;  |FINSI;
         |SI nClave = 4; aDAlfa4  = aMaximo;  aHAlfa4 = aMinimo;  |FINSI;
         |SI nClave = 5; aDAlfa5  = aMaximo;  aHAlfa5 = aMinimo;  |FINSI;
         |SI nClave = 6; aDAlfa6  = aMaximo;  aHAlfa6 = aMinimo;  |FINSI;
         |SI nClave = 7; aDAlfa7  = aMaximo;  aHAlfa7 = aMinimo;  |FINSI;
     |FINSI;
|FPRC;

|PROCESO MiraBucle;
     nDClave1 = 0;   nHClave1 = 0;
     nDClave2 = 0;   nHClave2 = 0;
     nDClave3 = 0;   nHClave3 = 0;
     nDClave4 = 0;   nHClave4 = 0;
     nDClave5 = 0;   nHClave5 = 0;
     nDClave6 = 0;   nHClave6 = 0;
     nDClave7 = 0;   nHClave7 = 0;
     aDAlfa1  = "";  aHAlfa1  = "";
     aDAlfa2  = "";  aHAlfa2  = "";
     aDAlfa3  = "";  aHAlfa3  = "";
     aDAlfa4  = "";  aHAlfa4  = "";
     aDAlfa5  = "";  aHAlfa5  = "";
     aDAlfa6  = "";  aHAlfa6  = "";
     aDAlfa7  = "";  aHAlfa7  = "";

     aTipoBucle = "";

     |SI #dsficher#3 = "N      ";
         nClave = 1;  nCampo = 6;  |HAZ ClaveNumerica;
         aTipoBucle = #dsficher#3;
     |FINSI;

     |SI #dsficher#3 = "NN     ";
         nClave = 1;  nCampo = 6;  |HAZ ClaveNumerica;
         nClave = 2;  nCampo = 9;  |HAZ ClaveNumerica;
         aTipoBucle = #dsficher#3;
     |FINSI;

     |SI #dsficher#3 = "NA     ";
         nClave = 1;  nCampo = 6;  |HAZ ClaveNumerica;
         nClave = 1;  nCampo = 9;  |HAZ ClaveAlfanumerica;
         aTipoBucle = #dsficher#3;
     |FINSI;

     |SI #dsficher#3 = "AN     ";
         nClave = 1;  nCampo = 6;  |HAZ ClaveAlfanumerica;
         nClave = 1;  nCampo = 9;  |HAZ ClaveNumerica;
         aTipoBucle = #dsficher#3;
     |FINSI;

     |SI #dsficher#3 = "NNN    ";
         nClave = 1;  nCampo = 6;  |HAZ ClaveNumerica;
         nClave = 2;  nCampo = 9;  |HAZ ClaveNumerica;
         nClave = 3;  nCampo = 12; |HAZ ClaveNumerica;
         aTipoBucle = #dsficher#3;
     |FINSI;

     |SI #dsficher#3 = "ANN    ";
         nClave = 1;  nCampo = 6;  |HAZ ClaveAlfanumerica;
         nClave = 1;  nCampo = 9;  |HAZ ClaveNumerica;
         nClave = 2;  nCampo = 12; |HAZ ClaveNumerica;
         aTipoBucle = #dsficher#3;
     |FINSI;

     |SI #dsficher#3 = "NNA    ";
         nClave = 1;  nCampo = 6;  |HAZ ClaveNumerica;
         nClave = 2;  nCampo = 9;  |HAZ ClaveNumerica;
         nClave = 1;  nCampo = 12; |HAZ ClaveAlfanumerica;
         aTipoBucle = #dsficher#3;
     |FINSI;

     |SI #dsficher#3 = "NAN    ";
         nClave = 1;  nCampo = 6;  |HAZ ClaveNumerica;
         nClave = 1;  nCampo = 9;  |HAZ ClaveAlfanumerica;
         nClave = 2;  nCampo = 12; |HAZ ClaveNumerica;
         aTipoBucle = #dsficher#3;
     |FINSI;

     |SI #dsficher#3 = "NNNA   ";
         nClave = 1;  nCampo = 6;  |HAZ ClaveNumerica;
         nClave = 2;  nCampo = 9;  |HAZ ClaveNumerica;
         nClave = 3;  nCampo = 12; |HAZ ClaveNumerica;
         nClave = 1;  nCampo = 15; |HAZ ClaveAlfanumerica;
         aTipoBucle = #dsficher#3;
     |FINSI;

     |SI #dsficher#3 = "NNNN   ";
         nClave = 1;  nCampo = 6;  |HAZ ClaveNumerica;
         nClave = 2;  nCampo = 9;  |HAZ ClaveNumerica;
         nClave = 3;  nCampo = 12; |HAZ ClaveNumerica;
         nClave = 4;  nCampo = 15; |HAZ ClaveNumerica;
         aTipoBucle = #dsficher#3;
     |FINSI;

     |SI #dsficher#3 = "NANN   ";
         nClave = 1;  nCampo = 6;  |HAZ ClaveNumerica;
         nClave = 1;  nCampo = 9;  |HAZ ClaveAlfanumerica;
         nClave = 2;  nCampo = 12; |HAZ ClaveNumerica;
         nClave = 3;  nCampo = 15; |HAZ ClaveNumerica;
         aTipoBucle = #dsficher#3;
     |FINSI;

     |SI #dsficher#3 = "NNNNN  ";
         nClave = 1;  nCampo = 6;  |HAZ ClaveNumerica;
         nClave = 2;  nCampo = 9;  |HAZ ClaveNumerica;
         nClave = 3;  nCampo = 12; |HAZ ClaveNumerica;
         nClave = 4;  nCampo = 15; |HAZ ClaveNumerica;
         nClave = 5;  nCampo = 18; |HAZ ClaveNumerica;
         aTipoBucle = #dsficher#3;
     |FINSI;

     |SI #dsficher#3 = "NANNN  ";
         nClave = 1;  nCampo = 6;  |HAZ ClaveNumerica;
         nClave = 1;  nCampo = 9;  |HAZ ClaveAlfanumerica;
         nClave = 2;  nCampo = 12; |HAZ ClaveNumerica;
         nClave = 3;  nCampo = 15; |HAZ ClaveNumerica;
         nClave = 4;  nCampo = 18; |HAZ ClaveNumerica;
         aTipoBucle = #dsficher#3;
     |FINSI;

     |SI #dsficher#3 = "NNAN   ";
         nClave = 1;  nCampo = 6;  |HAZ ClaveNumerica;
         nClave = 2;  nCampo = 9;  |HAZ ClaveNumerica;
         nClave = 1;  nCampo = 12; |HAZ ClaveAlfanumerica;
         nClave = 3;  nCampo = 15; |HAZ ClaveNumerica;
         aTipoBucle = #dsficher#3;
     |FINSI;

     |SI #dsficher#3 = "NNANA  ";
         nClave = 1;  nCampo = 6;  |HAZ ClaveNumerica;
         nClave = 2;  nCampo = 9;  |HAZ ClaveNumerica;
         nClave = 1;  nCampo = 12; |HAZ ClaveAlfanumerica;
         nClave = 3;  nCampo = 15; |HAZ ClaveNumerica;
         nClave = 2;  nCampo = 18; |HAZ ClaveAlfanumerica;
         aTipoBucle = #dsficher#3;
     |FINSI;

     |SI #dsficher#3 = "ANNNN  ";
         nClave = 1;  nCampo = 6;  |HAZ ClaveAlfanumerica;
         nClave = 1;  nCampo = 9;  |HAZ ClaveNumerica;
         nClave = 2;  nCampo = 12; |HAZ ClaveNumerica;
         nClave = 3;  nCampo = 15; |HAZ ClaveNumerica;
         nClave = 4;  nCampo = 18; |HAZ ClaveNumerica;
         aTipoBucle = #dsficher#3;
     |FINSI;

     |SI #dsficher#3 = "NNNNNN ";
         nClave = 1;  nCampo = 6;  |HAZ ClaveNumerica;
         nClave = 2;  nCampo = 9;  |HAZ ClaveNumerica;
         nClave = 3;  nCampo = 12; |HAZ ClaveNumerica;
         nClave = 4;  nCampo = 15; |HAZ ClaveNumerica;
         nClave = 5;  nCampo = 18; |HAZ ClaveNumerica;
         nClave = 6;  nCampo = 21; |HAZ ClaveNumerica;
         aTipoBucle = #dsficher#3;
     |FINSI;

     |SI #dsficher#3 = "NNNNNNN";
         nClave = 1;  nCampo = 6;  |HAZ ClaveNumerica;
         nClave = 2;  nCampo = 9;  |HAZ ClaveNumerica;
         nClave = 3;  nCampo = 12; |HAZ ClaveNumerica;
         nClave = 4;  nCampo = 15; |HAZ ClaveNumerica;
         nClave = 5;  nCampo = 18; |HAZ ClaveNumerica;
         nClave = 6;  nCampo = 21; |HAZ ClaveNumerica;
         nClave = 7;  nCampo = 24; |HAZ ClaveNumerica;
         aTipoBucle = #dsficher#3;
     |FINSI;

     |SI #dsficher#3 = "NNNNNA ";
         nClave = 1;  nCampo = 6;  |HAZ ClaveNumerica;
         nClave = 2;  nCampo = 9;  |HAZ ClaveNumerica;
         nClave = 3;  nCampo = 12; |HAZ ClaveNumerica;
         nClave = 4;  nCampo = 15; |HAZ ClaveNumerica;
         nClave = 5;  nCampo = 18; |HAZ ClaveNumerica;
         nClave = 1;  nCampo = 21; |HAZ ClaveAlfanumerica;
         aTipoBucle = #dsficher#3;
     |FINSI;

     |SI #dsficher#3 = "NNNNNNA";
         nClave = 1;  nCampo = 6;  |HAZ ClaveNumerica;
         nClave = 2;  nCampo = 9;  |HAZ ClaveNumerica;
         nClave = 3;  nCampo = 12; |HAZ ClaveNumerica;
         nClave = 4;  nCampo = 15; |HAZ ClaveNumerica;
         nClave = 5;  nCampo = 18; |HAZ ClaveNumerica;
         nClave = 6;  nCampo = 21; |HAZ ClaveNumerica;
         nClave = 1;  nCampo = 24; |HAZ ClaveAlfanumerica;
         aTipoBucle = #dsficher#3;
     |FINSI;

     |SI #dsficher#3 = "NNNANA ";
         nClave = 1;  nCampo = 6;  |HAZ ClaveNumerica;
         nClave = 2;  nCampo = 9;  |HAZ ClaveNumerica;
         nClave = 3;  nCampo = 12; |HAZ ClaveNumerica;
         nClave = 1;  nCampo = 15; |HAZ ClaveAlfanumerica;
         nClave = 4;  nCampo = 18; |HAZ ClaveNumerica;
         nClave = 2;  nCampo = 21; |HAZ ClaveAlfanumerica;
         aTipoBucle = #dsficher#3;
     |FINSI;

     |QBF aTipoBucle;
|FPRC;

|PROCESO ProcedeAlFichero;
     aFichero    = #dsficher#1;   |QBF aFichero;

     |SI aFichero = "dspase15.mas";  |ACABA;  |FINSI;

     |ATRI S;
     |PINTA 2258, aFichero;
     |ATRI s;

     |HAZ MiraBucle;

     aFichero    = #dsficher#1;   |QBF aFichero;
     nCampoCli   = #dsficher#4;
     |HAZ TrataFichero;

     |PULSATECLA;
|FPRC;

|DEFBUCLE dsficher;
     #dsficher#1;
     ;
     aAplica, aDDef;
     aAplica, aHDef;
     ;
     NULL, ProcedeAlFichero;
|FIN;

|PROCESO facemp;
     aPathDefFichero = aPathDestino + "facturar/def/";
     aPathFicOrigen  = aPathOrigen  + "facturar/fich/" + (("00" + #facemp#0) % -102) + "/";
     aPathFicDestino = aPathDestino + "facturar/fich/" + (("00" + #facemp#0) % -102) + "/";

     aAplica         = "facturar";
     aDDef           = "";
     aHDef           = "zzzzzzzzzzzz";

     |BUCLE dsficher;
|FPRC;

|DEFBUCLE facemp;
     #facemp#2;
     ;
     "S", 00;
     "S", 99;
     ;
     NULL, facemp;
|FIN;

|PROCESO GrabaHandle;
     |QBF aDescri;

     fFecha = ~;
     |HORA aHora;

     aAlfa = aDescri + " " + fFecha + " a las " + aHora + &13 + &10;
     |XGRABA nHandle, aAlfa;

     |PULSATECLA;
|FPRC;

|PROCESO dspase15;
     #ficdesti@#0 = #dspase15#0;
     #ficdesti@#1 = #dspase15#1;
     |LEE 101#ficdesti@.=;
     |SI FSalida ! 0;
         |DDEFECTO #ficdesti@;
         #ficdesti@#0  = #dspase15#0;
         #ficdesti@#1  = #dspase15#1;
         #ficdesti@#2  = #dspase15#2;
         #ficdesti@#3  = #dspasw06#19;
         #ficdesti@#15 = "S";
         #ficdesti@#16 = "S";
         |GRABA 020#ficdesti@.b;
     |FINSI;

     |SI #dspasw06#3 = "S";
         |SI #dspase15#6 ! 0;
             #ficdesti@#6  = #dspase15#6;
             #ficdesti@#20 = #dspase15#20;
         |FINSI;
     |FINSI;

     |SI #dspasw06#4 = "S";
         |SI #dspase15#17 ! 0;
             #ficdesti@#17 = #dspase15#17;
         |FINSI;
     |FINSI;

     |SI #dspasw06#5 = "S";
         |SI #dspase15#7 ! 0;
             #ficdesti@#7 = #dspase15#7;
         |FINSI;
     |FINSI;

     |SI #dspasw06#6 = "S";  |Y #dspasw06#15 = "N";
         |SI #dspase15#6 ! 0;
             #ficdesti@#5  = #dspase15#5;
             #ficdesti@#19 = #dspase15#19;
         |FINSI;
     |FINSI;

     |GRABA 020#ficdesti@.a;
     |LIBERA #ficdesti@;
|FPRC;

|DEFBUCLE dspase15;
     #dspase15#7;
     ;
     #dspasw06#0;
     #dspasw06#0;
     ;
     NULL, dspase15;
|FIN;

|PROCESO dspasw06_CambioPI1;
     |SI #dspasw06#9  = 0;       |ACABA;  |FINSI;
     |SI #dspasw06#19 = #dspasw06#9;  |ACABA;  |FINSI;

     |SI nPasada = 0;
         nTConta = nTConta + 1;
         |ACABA;
     |FINSI;

     |SI nPasada = 1;
         |SI #dspasw06#19 < 78000;  |ACABA;  |FINSI;
         |SI #dspasw06#19 > 78999;  |ACABA;  |FINSI;
     |FINSI;

     |SI nPasada = 2;
         |SI #dspasw06#19 ] 78000;  |Y #dspasw06#19 [ 78999;
             |ACABA;
         |FINSI;
     |FINSI;

     nConta = nConta + 1;
     aAlfa  = "Cambiando codigo duplicados: " + nConta + " de " + nTConta + "          ";

     |PINTA 1510, aAlfa;
     |PINTA 0802, #dspasw06#18;
     |PINTA 0815, #dspasw06#19;
     |PINTA 0821, #dspasw06#10;
     |PINTA 0834, #dspasw06#9;
     |PINTA 0840, #dspasw06#1;
     |PINTA 0853, #dspasw06#0;
     |PINTA 0759, #dspasw06#2;
     |PINTA 1659, #dspasw06#11;

     enEmpresa   = #dspasw06#9;
     enEmpresaN  = #dspasw06#19;
     enEmpFac    = -1;
     enCambioCli = 1;

     eaPasaCont  = "SI";
     eaPasaFisc  = "SI";
     eaPasaSoci  = "SI";
     eaPasaRent  = "SI";
     eaPasaLabo  = "SI";
     eaPasaFact  = "SI";
     eaPasaMaes  = "SI";
     eaPasaArch  = "SI";
     eaPasaR1994 = "SI";
     eaPasaR1995 = "SI";
     eaPasaR1996 = "SI";
     eaPasaR1997 = "SI";
     eaPasaR1998 = "SI";
     eaPasaR1999 = "SI";
     eaPasaR2000 = "SI";
     eaPasaR2001 = "SI";
     eaPasaR2002 = "SI";
     eaPasaR2003 = "SI";
     eaPasaR2004 = "SI";
     eaPasaR2005 = "SI";
     eaPasaR2006 = "SI";
     eaPasaR2007 = "SI";
     eaPasaR2008 = "SI";
     eaPasaR2009 = "SI";
     eaPasaR2010 = "SI";
     eaPasaR2011 = "SI";
     eaPasaR2012 = "SI";
     eaPasaR2013 = "SI";
     eaPasaR2014 = "SI";
     eaPasaR2015 = "SI";
     eaPasaR2016 = "SI";
     eaPasaR2017 = "SI";
     eaPasaR2018 = "SI";
     eaPasaCact  = "N";
     eaPasaNuct  = "";

     aDescri = "A Cambiar codigo repetido: " + (("00000" + #dspasw06#9) % -105) + " " + #dspasw06#11;
     |HAZ GrabaHandle;

     |SUB_EJECUTA_NP "dsborrad";

     aDescri = "Cambiado codigo repetido: " + (("00000" + #dspasw06#9) % -105) + " " + #dspasw06#11;
     |HAZ GrabaHandle;
|FPRC;

|DEFBUCLE dspasw06_CambioPI1;
     #dspasw06#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, dspasw06_CambioPI1;
|FIN;

|PROCESO facempFac;
     #dsam0010#0 = #dspasw06#19;
     #dsam0010#1 = #facemp#0;
     |LEE 000#dsam0010.=;
     |SI FSalida = 0;  |ACABA;  |FINSI;

     |DDEFECTO #dsam0010;
     #dsam0010#0  = #dspasw06#19;
     #dsam0010#1  = #facemp#0;
     #dsam0010#2  = #facemp#1;
     #dsam0010#3  = #dsam0000#88;
     #dsam0010#4  = #dsam0000#89;
     #dsam0010#5  = #dsam0000#90;
     #dsam0010#6  = #dsam0000#91;
     #dsam0010#7  = #dsam0000#92;
     #dsam0010#8  = #dsam0000#93;
     #dsam0010#9  = #dsam0000#94;
     #dsam0010#10 = #dsam0000#73;
     #dsam0010#11 = #dsam0000#74;
     #dsam0010#12 = #dsam0000#95;
     #dsam0010#13 = #dsam0000#96;
     #dsam0010#14 = #dsam0000#97;
     #dsam0010#15 = #dsam0000#103;

     |SELECT #4#dsam0116;
     #dsam0116#2 = #dsam0010#5;
     #dsam0116#3 = #dsam0010#6;
     #dsam0116#0 = #dsam0010#3;
     |LEE 040#dsam0116.];
     |SI FSalida ! 0;  |O #dsam0116#2 ! #dsam0010#5;  |O  #dsam0116#3 ! #dsam0010#6;
         #dsam0116#2 = #dsam0010#5;
         #dsam0116#3 = #dsam0010#6;
         #dsam0116#0 = 0;
         |LEE 040#dsam0116.];
         |SI FSalida ! 0;  |O #dsam0116#2 ! #dsam0010#5;  |O  #dsam0116#3 ! #dsam0010#6;
             |SELECT #1#dsam0116;
             |PARA nBanco = 1;  |SI nBanco [ 99999;  |HACIENDO nBanco = nBanco + 1;
                   #dsam0116#0 = nBanco;
                   |LEE 000#dsam0116.=;
                   |SI FSalida ! 0;  |SAL;  |FINSI;
             |SIGUE;

             |DDEFECTO #dsam0116;
             #dsam0116#0 = nBanco;
             #dsam0116#1 = #dsam0010#4;
             #dsam0116#2 = #dsam0010#5;
             #dsam0116#3 = #dsam0010#6;
             #dsam0116#5 = #dsam0010#17;
             |GRABA 020#dsam0116.n;
             |LIBERA #dsam0116;
         |FINSI;
     |FINSI;

     #dsam0010#3  = #dsam0116#0;

     |GRABA 020#dsam0010.n;
     |LIBERA #dsam0010;
|FPRC;

|DEFBUCLE facempFac;
     #facemp#2;
     ;
     "S", 00;
     "S", 99;
     ;
     NULL, facempFac;
|FIN;

|PROCESO PonBancosFacturacion;
     aAlfa = #dsam0000#90 + #dsam0000#91 + #dsam0000#92 + #dsam0000#93;  |QBT aAlfa;
     |SI aAlfa = "";  |ACABA;  |FINSI;

     aPath = aPathOrigen + "facturar/fich/";
     |PATH_DAT #facemp#aPath#;

     |ABRE #dsam0010;
     |ABRE #dsam0116;
     |BUCLE facempFac;
     |CIERRA #dsam0010;
     |CIERRA #dsam0116;
|FPRC;

|PROCESO dspasw06_CambioPI2;
     |SI #dspasw06#0 = 0;  |ACABA;  |FINSI;

     |SI nPasada = 0;
         nTConta = nTConta + 1;
         |ACABA;
     |FINSI;

     aDescri = "Importando empresa " + (("00000" + #dspasw06#0) % -105) + " " + #dspasw06#2;
     |HAZ GrabaHandle;

     nConta = nConta + 1;
     aAlfa  = "Importando empresas: " + nConta + " de " + nTConta + "          ";

     |PINTA 1510, aAlfa;
     |PINTA 0802, #dspasw06#18;
     |PINTA 0815, #dspasw06#19;
     |PINTA 0821, #dspasw06#10;
     |PINTA 0834, #dspasw06#9;
     |PINTA 0840, #dspasw06#1;
     |PINTA 0853, #dspasw06#0;
     |PINTA 0759, #dspasw06#2;
     |PINTA 1659, #dspasw06#11;

     aPathOrigen     = #dspase51#0;    |QBF aPathOrigen;

     |DBASS aPathDestino;   |QBF aPathDestino;
     aPathDefSQL     = aPathDestino + "basica/def/";
     aPathFicBasica  = aPathDestino + "basica/fich/";

     aPath = aPathDestino + "integral/fich/";
     |PATH_DAT #dsam0000#aPath#;

     |ABRE #dsam0000;
     #dsam0000#0 = #dspasw06#19;
     |LEE 000#dsam0000.=;
     |SI FSalida ! 0;
         nTratoEspecial = 0;
     |SINO;
         nTratoEspecial = 1;
     |FINSI;
     |CIERRA #dsam0000;

     |ATRI S;
     |PINTA 2210, "TRATANDO FICHEROS EN MAESTROS            ";
     |ATRI s;

     aPathDefFichero = aPathDestino + "integral/def/";
     aPathFicOrigen  = aPathOrigen  + "integral/fich/";
     aPathFicDestino = aPathDestino + "integral/fich/";

     aAplica         = "integral";
     aDDef           = "";
     aHDef           = "zzzzzzzzzzzz";

     |BUCLE dsficher;

     aPathDefFichero = aPathDestino + "basica/def/";
     aPathFicOrigen  = aPathOrigen  + "basica/fich/";
     aPathFicDestino = aPathDestino + "basica/fich/";

     aAplica         = "basica";
     aDDef           = "agicen14.mas";
     aHDef           = "agicen14.mas";

     |BUCLE dsficher;

     nTratoEspecial = 0;

/*  || Segun Cristina no es necesario.

     aPathFicOrigen  = aPathOrigen  + "integral/fich/";
     |PATH_DAT #dsam0000#aPathFicOrigen#;

     |ABRE #dsam0000;
     #dsam0000#0 = #dspasw06#0;
     |LEE 000#dsam0000.=;
     |SI FSalida = 0;
         |HAZ PonBancosFacturacion;
     |FINSI;
     |CIERRA #dsam0000;

*/

     |ATRI S;
     |PINTA 2210, "TRATANDO FICHEROS EN LABORAL            ";
     |ATRI s;

     aPathDefFichero = aPathDestino + "laboral/def/";
     aPathFicOrigen  = aPathOrigen  + "laboral/fich/";
     aPathFicDestino = aPathDestino + "laboral/fich/";

     aAplica         = "laboral";
     aDDef           = "";
     aHDef           = "zzzzzzzzzzzz";
     |BUCLE dsficher;

     |ATRI S;
     |PINTA 2210, "TRATANDO FICHEROS EN MODELOS            ";
     |ATRI s;

     nTratoEspecial  = 1;
     aPathFicOrigen  = aPathOrigen  + "modelos/fich/";
     aPathDefFichero = aPathDestino + "modelos/def/";
     aPathFicDestino = aPathDestino + "modelos/fich/";
     aAplica         = "modelos";
     aDDef           = "";
     aHDef           = "zzzzzzzzzzzz";
     |BUCLE dsficher;

     nTratoEspecial   = 0;

     |ATRI S;
     |PINTA 2210, "TRATANDO FICHEROS EN FACTURACION         ";
     |ATRI s;

     nDEmpresa = 0;
     nHEmpresa = 99;
     aPath     = aPathOrigen + "facturar/fich/";
     |PATH_DAT #facemp#aPath#;

     |BUCLE facemp;

     aDef = aPathDestino + "basica/def/dspase15.mas";
     |CARGA_DEF aDef, ficdesti@;
     |SI FSalida ! 0;
         |ACABA;
     |FINSI;

     aPath = aPathOrigen + "basica/fich/";
     |PATH_DAT #dspase15#aPath#;

     aPath = aPathDestino + "basica/fich/";
     |PATH_DAT #ficdesti@#aPath#;

     |ABRE #ficdesti@;
     |BUCLE dspase15;
     |CIERRA #ficdesti@;

     |DESCARGA_DEF #ficdesti@;

     aPath = aPathDestino + "integral/fich/";
     |PATH_DAT #dsam0000#aPath#;

     |ABRE #dsam0000;
     #dsam0000#0 = #dspasw06#19;
     |LEE 101#dsam0000.=;
     |SI FSalida = 0;
         |SI #dspasw06#6 = "S";  |Y #dspasw06#15 = "N";
             #dsam0000#69 = "S";
             |GRABA 020#dsam0000.a;
         |FINSI;
         |LIBERA #dsam0000;
     |FINSI;
     |CIERRA #dsam0000;

     enCodCli     = #dspasw06#19;
     enDesdeFuera = 1;
     enAbogados   = 1;
     |SUB_EJECUTA_NP ":integral/dsaz0003;SOLOUNCLIENTE";

     aDescri = "Empresa importada: " + (("00000" + #dspasw06#0) % -105) + " " + #dspasw06#2;  |QBF aAlfa;
     |HAZ GrabaHandle;
|FPRC;

|DEFBUCLE dspasw06_CambioPI2;
     #dspasw06#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, dspasw06_CambioPI2;
|FIN;

|| **************************************************************************

|PROCESO Tipo11;  |TIPO 11;
     |SI FSalida = 10;
         |CONSULTA_CLAVE #1#dspasw06;
     |FINSI;

     |SI FSalida = 11;
         |DBASS aBase;  |QBF aBase;
         aPath = aBase + "integral/fich/";
         |PATH_DAT #dsam0000#aPath#;
         |ABRE #dsam0000;
         |CONSULTA_CLAVE #1#dsam0000;
         |CIERRA #dsam0000;
     |FINSI;

     |SI FSalida = 12;
         aBase = #dspase51#0;  |QBF aBase;
         aPath = aBase + "integral/fich/";
         |PATH_DAT #dsam0000#aPath#;
         |ABRE #dsam0000;
         |CONSULTA_CLAVE #1#dsam0000;
         |CIERRA #dsam0000;
     |FINSI;

     |SI FSalida = 13;
         |ABRE #dspasw04;
         |CONSULTA_CLAVE #1#dspasw04;
         |CIERRA #dspasw04;
     |FINSI;

     |SI FSalida = 14;
         |ABRE #dspasw05;
         |CONSULTA_CLAVE #1#dspasw05;
         |CIERRA #dspasw05;
     |FINSI;
|FPRC;

|PROCESO BuscaRentasPI2;
     |PARA nRenta = 1994;  |SI nRenta [ 2018;  |HACIENDO nRenta = nRenta + 1;
           aDef = aBase + "ren" + nRenta + "/def/reacceso.mas";
           |CARGA_DEF aDef, cargadef@;
           |SI FSalida = 0;
               aPath = aBase + "ren" + nRenta + "/fich/";
               |PATH_DAT #cargadef@#aPath#;
               |ABRE #cargadef@;
               #cargadef@#0 = #dspasw06#0;
               |LEE 000#cargadef@.=;
               |SI FSalida = 0;
                   #dspasw06#8 = "S";
               |FINSI;
               |CIERRA #cargadef@;
               |DESCARGA_DEF #cargadef@;
           |FINSI;

           |SI #dspasw06#8 = "S";  |SAL;  |FINSI;
     |SIGUE;
|FPRC;

|PROCESO facempPI2;
     aPath = aBase + "facturar/fich/" + (("00" + #facemp#0) % -102) + "/";
     |PATH_DAT #ashismic#aPath#;
     |ABRE #ashismic;
     |SELECT #3#ashismic;
     #ashismic#3 = #dspasw06#0;
     #ashismic#0 = "";
     #ashismic#1 = 0;
     |LEE 000#ashismic.];
     |SI FSalida = 0;  |Y #ashismic#3 = #dspasw06#0;
         #dspasw06#7 = "S";
     |FINSI;
     |CIERRA #ashismic

     |SI #dspasw06#7 = "S";
         |ERROR10;
     |FINSI;
|FPRC;

|DEFBUCLE facempPI2;
     #facemp#2;
     ;
     "S", 00;
     "S", 99;
     ;
     NULL, facempPI2;
|FIN;

|PROCESO dspasw05;
     |DDEFECTO #dspasw06;

     #dspasw06#0  = #dspasw05#0;
     #dspasw06#1  = #dspasw05#1;
     #dspasw06#2  = #dspasw05#2;
     #dspasw06#18 = #dspasw05#1;
     #dspasw06#19 = #dspasw05#0;

     #labtraba#0 = #dspasw05#0;
     #labtraba#1 = 0;
     |LEE 000#labtraba.];
     |SI FSalida = 0;  |Y  #labtraba#0 = #dspasw05#0;
         #dspasw06#6 = "S";
     |FINSI;

     |BUCLE facempPI2;

     |SI #dspasw06#6 = "N";  |Y  #dspasw06#7 = "N";
         |ACABA;
     |FINSI;

     |GRABA 020#dspasw06.n;
     |LIBERA #dspasw06;
|FPRC;

|DEFBUCLE dspasw05;
     #dspasw05#1;
     ;
     00001;
     99999;
     ;
     NULL, dspasw05;
|FIN;

|PROCESO dspasw06Busca;
     |SI #dspasw06#9 ! 0;  |ACABA;  |FINSI;

     #dspasw06#9  = #dspasw04#0;
     #dspasw06#10 = #dspasw04#1;
     #dspasw06#11 = #dspasw04#2;
     |GRABA 020#dspasw06.a;
     |LIBERA #dspasw06;

     nHay = 1;
     |ERROR10;
|FPRC;

|DEFBUCLE dspasw06Busca;
     #dspasw06#1;
     ;
     #dspasw04#1, 00000;
     #dspasw04#1, 99999;
     ;
     NULL, dspasw06Busca;
|FIN;

|PROCESO dspasw04;
     #dspasw06#18 = #dspasw04#1;
     #dspasw06#19 = #dspasw04#0;
     |LEE 101#dspasw06.=;
     |SI FSalida = 0;
         #dspasw06#9  = #dspasw04#0;
         #dspasw06#10 = #dspasw04#1;
         #dspasw06#11 = #dspasw04#2;
         |GRABA 020#dspasw06.a;
         |LIBERA #dspasw06;
         |ACABA;
     |SINO;
         nHay = 0;
         |BUCLE dspasw06Busca;
         |SI nHay = 1;  |ACABA;  |FINSI;
     |FINSI;

     nCod = #dspasw04#0;
     |SELECT #2#dspasw06;
     #dspasw06#19 = #dspasw04#0;
     |LEE 000#dspasw06.=;
     |SI FSalida = 0;
         nNoventaMil = nNoventaMil + 1;
         nCod        = nNoventaMil;
     |FINSI;

     |SELECT #1#dspasw06;
     |DDEFECTO #dspasw06;
     #dspasw06#18 = #dspasw04#1;
     #dspasw06#19 = nCod;
     #dspasw06#0  = 0;
     #dspasw06#1  = "";
     #dspasw06#2  = "";
     #dspasw06#3  = "N";
     #dspasw06#4  = "N";
     #dspasw06#5  = "N";
     #dspasw06#6  = "N";
     #dspasw06#7  = "N";
     #dspasw06#8  = "N";
     #dspasw06#9  = #dspasw04#0;
     #dspasw06#10 = #dspasw04#1;
     #dspasw06#11 = #dspasw04#2;

     |SI #dspasw06#0 = 0;  |Y #dspasw06#9 = #dspasw06#19;
         |ACABA;
     |FINSI;

     |GRABA 020#dspasw06.n;
     |LIBERA #dspasw06;
|FPRC;

|DEFBUCLE dspasw04;
     #dspasw04#1;
     ;
     00001;
     99999;
     ;
     NULL, dspasw04;
|FIN;

|PROCESO BuscaRentasPI1;
     |PARA nRenta = 1994;  |SI nRenta [ 2018;  |HACIENDO nRenta = nRenta + 1;
           aDef = aBase + "ren" + nRenta + "/def/reacceso.mas";
           |CARGA_DEF aDef, cargadef@;
           |SI FSalida = 0;
               aPath = aBase + "ren" + nRenta + "/fich/";
               |PATH_DAT #cargadef@#aPath#;
               |ABRE #cargadef@;
               #cargadef@#0 = #dspasw04#0;
               |LEE 000#cargadef@.=;
               |SI FSalida = 0;
                   #dspasw06#17 = "S";
               |FINSI;
               |CIERRA #cargadef@;

               |DESCARGA_DEF #cargadef@;
           |FINSI;

           |SI #dspasw06#17 = "S";  |SAL;  |FINSI;
     |SIGUE;
|FPRC;

|PROCESO facempPI1;
     aPath = aBase + "facturar/fich/" + (("00" + #facemp#0) % -102) + "/";
     |PATH_DAT #ashismic#aPath#;
     |ABRE #ashismic;
     |SELECT #3#ashismic;
     #ashismic#3 = #dspasw04#0;
     #ashismic#0 = "";
     #ashismic#1 = 0;
     |LEE 000#ashismic.];
     |SI FSalida = 0;  |Y #ashismic#3 = #dspasw04#0;
         #dspasw06#16 = "S";
     |FINSI;
     |CIERRA #ashismic

     |SI #dspasw06#16 = "S";
         |ERROR10;
     |FINSI;
|FPRC;

|DEFBUCLE facempPI1;
     #facemp#2;
     ;
     "S", 00;
     "S", 99;
     ;
     NULL, facempPI1;
|FIN;

|PROCESO dspasw06_1;
     |SI #dspasw06#0 =  0;  |ACABA;  |FINSI;

     #dspasw04#0 = #dspasw06#0;
     |LEE 000#dspasw04.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |SI #dspasw06#9 = #dspasw04#0;
         #dspasw06#10 = #dspasw04#1;
         #dspasw06#11 = #dspasw04#2;
     |FINSI;

     #labtraba#0 = #dspasw04#0;
     #labtraba#1 = 0;
     |LEE 000#labtraba.];
     |SI FSalida = 0;  |Y  #labtraba#0 = #dspasw04#0;
         #dspasw06#15 = "S";
     |FINSI;

     |BUCLE facempPI1;

     nNif = 0;

     |SI #dspasw06#6 = "S";  |Y #dspasw06#15 = "N";
         nNif = 1;
     |FINSI;

     |SI #dspasw06#7 = "S";  |Y #dspasw06#16 = "N";
         nNif = 1;
     |FINSI;

     |GRABA 020#dspasw06.a;
     |LIBERA #dspasw06;
|FPRC;

|DEFBUCLE dspasw06_1;
     #dspasw06#1;
     ;
     INICIO;
     FINAL;
     be;
     NULL, dspasw06_1;
|FIN;

|PROCESO dsam0000_G4;
     eaVarDni  = #dsam0000#3 > "";
     enCalcCif = 2;
     |HAZ CalculoDNI;

     #dspasw04#0 = #dsam0000#0;
     #dspasw04#1 = eaVarDni;
     #dspasw04#2 = #dsam0000#1;

     |GRABA 020#dspasw04.n;
     |LIBERA #dspasw04;
|FPRC;

|DEFBUCLE dsam0000_G4;
     #dsam0000#1;
     ;
     00001;
     99999;
     ;
     NULL, dsam0000_G4;
|FIN;

|PROCESO dsam0000_G5;
     eaVarDni  = #dsam0000#3 > "";
     enCalcCif = 2;
     |HAZ CalculoDNI;

     #dspasw05#0 = #dsam0000#0;
     #dspasw05#1 = eaVarDni;
     #dspasw05#2 = #dsam0000#1;

     |GRABA 020#dspasw05.n;
     |LIBERA #dspasw05;
|FPRC;

|DEFBUCLE dsam0000_G5;
     #dsam0000#1;
     ;
     00001;
     99999;
     ;
     NULL, dsam0000_G5;
|FIN;

|PROCESO Baja906;
     #dspasw06#18 = "";
     #dspasw06#19 = 1;
|FPRC;

|PROCESO Alta906;
     #dspasw06#18  = "zzzzzzzzzzzz";
     #dspasw06#19  = 99999;
|FPRC;

|PROCESO dsam0107;
     nLinea = #dsam0107#1 + 20;

     #ficdesti@#0 = #dsam0107#0;
     #ficdesti@#1 = nLinea;
     #ficdesti@#2 = #dsam0107#2;
     #ficdesti@#3 = #dsam0107#3;
     #ficdesti@#4 = #dsam0107#4;
     |GRABA 020#ficdesti@.n;
     |LIBERA #ficdesti@;

     |BORRA 020#dsam0107.a;
     |LIBERA #dsam0107;
|FPRC;

|DEFBUCLE dsam0107;
     #dsam0107#1;
     ;
     "                                        ", 01;
     "zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz", 19;
     be;
     NULL, dsam0107;
|FIN;

|PROCESO ListinTelefonico;
     |DBASS aBase;
     aDef  = aBase + "integral/def/dsam0107.mas";
     aPath = aBase + "integral/fich/";

     |ABRE #dsam0107;
     |CONSULTA_CLAVE #1#dsam0107;
     |CIERRA #dsam0107;

     |CARGA_DEF aDef, ficdesti@;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |PATH_DAT #ficdesti@#aPath#;

     |ABRE #ficdesti@;
     |BUCLE dsam0107;
     |CIERRA #ficdesti@;

     |DESCARGA_DEF #ficdesti@;
|FPRC;

|PROCESO Tipo3;
     aAlfa1   = #dspase51#0;  |QBF aOrigen;
     |DBASS aAlfa2;  |QBF aAlfa2;

     aOrigen  = aAlfa1 + "facturar/fich/facemp.dat";
     aDestino = aAlfa2 + "facturar/fich/facemp.dat";
     |COPIA_FICHERO aOrigen, aDestino;

     aOrigen  = aAlfa1 + "facturar/fich/facemp.ddx";
     aDestino = aAlfa2 + "facturar/fich/facemp.ddx";
     |COPIA_FICHERO aOrigen, aDestino;

     aOrigen  = aAlfa1 + "facturar/fich/facemp.ixx";
     aDestino = aAlfa2 + "facturar/fich/facemp.ixx";
     |COPIA_FICHERO aOrigen, aDestino;

     aFichero = ("06" + Usuario + "zzzzzzzz") % 108
     |NOME_DAT #dspasw06#aFichero#;
     |ABRE #dspasw06;  |CIERRA #dspasw06;  |DELINDEX #dspasw06;

     aFichero = ("04" + Usuario + "zzzzzzzz") % 108
     |NOME_DAT #dspasw04#aFichero#;
     |ABRE #dspasw04;  |CIERRA #dspasw04;  |DELINDEX #dspasw04;

     aFichero = ("05" + Usuario + "zzzzzzzz") % 108
     |NOME_DAT #dspasw05#aFichero#;
     |ABRE #dspasw05;  |CIERRA #dspasw05;  |DELINDEX #dspasw05;

     aBase = #dspase51#0;  |QBF aBase;
     aPath = aBase + "integral/fich/";
     |PATH_DAT #dsam0000#aPath#;

     |ABRE #dspasw05;
     |BUCLE dsam0000_G5;
     |CIERRA #dspasw05;

     |DBASS aBase;  |QBF aBase;
     aPath = aBase + "integral/fich/";
     |PATH_DAT #dsam0000#aPath#;

     |ABRE #dspasw04;
     |BUCLE dsam0000_G4;
     |CIERRA #dspasw04;

||---------------------------------------------------------------

     aBase = #dspase51#0;  |QBF aBase;
     aPath = aBase + "integral/fich/";
     |PATH_DAT #dsam0000#aPath#;

     aPath = aBase + "contagen/fich/";
     |PATH_DAT #canempre#aPath#;

     aPath = aBase + "modelos/fich/";
     |PATH_DAT #dsmom003#aPath#;

     aPath = aBase + "contasoc/fich/";
     |PATH_DAT #maempr01#aPath#;

     aPath = aBase + "laboral/fich/";
     |PATH_DAT #labtraba#aPath#;

     aPath = aBase + "facturar/fich/";
     |PATH_DAT #facemp#aPath#;

     |ABRE #dsam0000;
     |ABRE #canempre;
     |ABRE #dsmom003;  |SELECT #2#dsmom003;
     |ABRE #maempr01;
     |ABRE #labtraba;
     |ABRE #dspasw06;
     |BUCLE dspasw05;
     |CIERRA #dsam0000;
     |CIERRA #canempre;
     |CIERRA #dsmom003;
     |CIERRA #maempr01;
     |CIERRA #labtraba;

     nNoventaMil = 78000;
     |BUCLE dspasw04;
     |CIERRA #dspasw06;

     |DBASS aBase;  |QBF aBase;
     aPath = aBase + "integral/fich/";
     |PATH_DAT #dsam0000#aPath#;

     aPath = aBase + "contagen/fich/";
     |PATH_DAT #canempre#aPath#;

     aPath = aBase + "modelos/fich/";
     |PATH_DAT #dsmom003#aPath#;

     aPath = aBase + "contasoc/fich/";
     |PATH_DAT #maempr01#aPath#;

     aPath = aBase + "laboral/fich/";
     |PATH_DAT #labtraba#aPath#;

     aPath = aBase + "facturar/fich/";
     |PATH_DAT #facemp#aPath#;

     |ABRE #dspasw04;
     |ABRE #canempre;
     |ABRE #dsmom003;  |SELECT #2#dsmom003;
     |ABRE #maempr01;
     |ABRE #labtraba;
     |BUCLE dspasw06_1;
     |CIERRA #dspasw04;
     |CIERRA #canempre;
     |CIERRA #dsmom003;
     |CIERRA #maempr01;
     |CIERRA #labtraba;

     |ENTLINEAL #1#dspasw06, -1, 4, 22, 1, Baja906, Alta906;

     |CONFI "0000SQuiere realizar el pase, si dice que NO perdera todo lo introducido";
     |SI FSalida ! 0;
         |DELINDEX #dspasw06;
         |DELINDEX #dspasw04;
         |DELINDEX #dspasw05;
         |ACABA;
     |FINSI;

     fFecha = ~;
     |HORA aHora;

     |DBASE aBase;
     aAbre = aBase + "logpase.txt";
     |XABRE "WB", aAbre, nHandle;

     aDescri = "Empieza el pase el dia:";
     |HAZ GrabaHandle;

     |BLANCO 2101 2380;
     |CUADRO 2101 2380;
     |HAZ ListinTelefonico;

     |ABRE #dsficher;

     |ATRI S;
     |PINTA 2210, "RECOGIENDO FICHEROS MAESTROS INTEGRAL";
     |ATRI s;

     aDescri = "Recogiendo ficheros maestros integral";
     |HAZ GrabaHandle;

     |HAZ MaestrosIntegral;

     |ATRI S;
     |PINTA 2210, "RECOGIENDO FICHEROS MAESTROS LABORAL";
     |ATRI s;

     aDescri = "Recogiendo ficheros maestros laboral";
     |HAZ GrabaHandle;

     |HAZ MaestrosLaboral;

     |ATRI S;
     |PINTA 2210, "RECOGIENDO FICHEROS MAESTROS FACTURACION";
     |ATRI s;

     aDescri = "Recogiendo ficheros maestros facturacion";
     |HAZ GrabaHandle;

     |HAZ TraeteFacturar;
     |CIERRA #dsficher;

     |PINTA 2210, "                                               ";

     |BLANCO 1001 2058;
     |CUADRO 1001 2058;

     aDescri = "Cambiando empresas repetidas en fiscal";
     |HAZ GrabaHandle;

     nTConta = 0;
     nConta  = 0;
     nPasada = 0;  |BUCLE dspasw06_CambioPI1;    || Cambia los codigos nuevos en PI1
     nPasada = 1;  |BUCLE dspasw06_CambioPI1;
     nPasada = 2;  |BUCLE dspasw06_CambioPI1;

     aDescri = "Cambiado en fiscal " + nConta + " codigos de empresas";
     |HAZ GrabaHandle;

     nTConta = 0;
     nConta  = 0;
     nPasada = 0;  |BUCLE dspasw06_CambioPI2;    || Se trae los registros de la PI2
     nPasada = 1;  |BUCLE dspasw06_CambioPI2;

     aDescri = "Se han importado " + nConta + " empresas de laboral y facturacion";
     |HAZ GrabaHandle;

     |DELINDEX #dspasw06;
     |DELINDEX #dspasw04;
     |DELINDEX #dspasw05;

     fFecha = ~;
     |HORA aHora;

     aDescri = "Termina el pase el dia:";
     |HAZ GrabaHandle;

     |XCIERRA nHandle;
|FPRC;

|PROGRAMA;
     |CUADRO 0501 2380;
     |BLANCO 0602 2279;
     |PINTA 1320, "Introduzca Password : ";
     E_inf = "";
     E_sup = "20";
     aPassword = 1342 ? -1;
     |SI aPassword ! "<MYPASWD>       ";
         |MENAV "     Permiso denegado.";
         |ACABA;
     |FINSI;

     |ABRE #dspase15;
     |LEE 040#dspase15.p;
     |SI FSalida ! 0;
         |DDEFECTO #dspase15;
     |SINO;
         |SI #dspase15#15 ! "S";
             |MENAV "      Unificacion de Codigos no Realizada.";
             |CIERRA #dspase15;
             |ACABA;
         |FINSI;
     |FINSI;
     |CIERRA #dspase15;

     |CLS;
     |CABEZA "     Pase desde otra PI";

     |BLANCO 0501 2380;
     |CUADRO 0501 2380;

     |PINTA 0602, "Las pruebas se han realizado en GECO38 con las siguientes carpetas";
     |PINTA 0702, "     ase2913 = Laboral y Facturacion";
     |PINTA 0802, "     ase2914 = Resto";
     |PINTA 0902, "     ase2918 = Vacia";

     |PINTA 1102, "1 paso: copiar todo el contenido del ase2914 al ase2918";
     |PINTA 1302, "2 paso: inicializar las nominas del ase817 ya que hay tres empresas de   ";
     |PINTA 1402, "         pruebas, estas tres empresas tambien tiene modelos 110 y 190 en  ";
     |PINTA 1502, "         el planing intentar eliminarlas.                                 ";

     |PINTA 1702, "3 paso: Recordar optimizar los procesos de control de tareas activas del";
     |PINTA 1802, "         servidor hosting (chkidle). Si est activado es posible que ";
     |PINTA 1902, "         el proceso se corte.";

     |PAUSA;

     |DDEFECTO #dspase51;
     |PINPA #0#dspase51;
     |PINDA #0#dspase51;
     |ENDATOS #1#dspase51;
     |SI FSalida = 0;
         |HAZ Tipo3;
     |FINSI;
|FPRO;
