|FICHEROS;
    agim0024;
    agim0004;

    socm0001;

    agidanif;
    &regisnif@ #709;
    &sgpaises@ #718;
|FIN;

|VARIABLES;
     &Cliente   = 0;
     &Registro  = 0;
     &Modo      = 0;
     &eaVarDni  = "";
     &enCalcCif = 0;
     &eaCodNif  = "";
     &eaCta     = "";
     &eaCodPais = "";

     nSwPasa   = 0;
     aAlfa     = "";
     aAlfa1    = "";
     Modo1     = 0;
     nCampo    = 0;
     fHoy      = @;
     nDia1     = 0;
     nDia2     = 0;
     nMes1     = 0;
     nMes2     = 0;
     nAny1     = 0;
     nAny2     = 0;
     nEdad     = 0;
|FIN;

|PROCESO NombreRepre;
     |HAZ LeeNifs;     || Esto no haze n  pero quien lo toque
                       || los corto lo guevos  PARAQUITAR
|FPRC;

|PROCESO Tipo0C20Fm24;  |TIPO 0;
     eaCta = #agim0024#20;
     |HAZ MFiltraPtos;
     #agim0024#20 = eaCta;
     |PINTA #agim0024#20;
|FPRC;

|PROCESO Tipo0C19Fm24;  |TIPO 0;
     |C_M #agim0024#20, 1, "S";
     |SI #agim0024#19 = "N";
         |C_M #agim0024#20, 1, "N";  #agim0024#20 = "";
     |FINSI;

     |PINTA #agim0024#20;
|FPRC;

|PROCESO Tipo7C19Fm24;  |TIPO 7;
     |C_M #agim0024#19, 1, "S";
     |SI #agim0024#19 = "S";
         |C_M #agim0024#19, 1, "N";
     |FINSI;

     |PINTA #agim0024#19;
|FPRC;

|PROCESO Tipo0C17;  |TIPO 0;
     |SI FSalida = 10;
         #agim0024#17 = "00.00.0000";
         |HAZ Tipo7m0024;
     |FINSI;
|FPRC;


|PROCESO Tipo7m0024;  |TIPO 7;
     |SI #agim0024#17 = "00.00.0000";
         |ATRI I; |PINTA 1469, "INDEFINIDO"; |ATRI 0;
     |FINSI;
|FPRC;

|RUTINA ClaveBaja0;
  #agim0024#0 = Cliente;
  #agim0024#1 = Registro;
  #agim0024#2 = 01;
|FRUT;

|RUTINA ClaveAlta0;
  #agim0024#0 = Cliente;
  #agim0024#1 = Registro;
  #agim0024#2 = 99;
|FRUT;

|PROCESO LetraDni024;  |TIPO 6;
     |SI FSalida = 10;
         eaVarDni  = #agim0024#Campo#;
         enCalcCif = 1;
         |HAZ CalculoDNI;
         #agim0024#Campo# = eaVarDni;
         |PINTA #agim0024#Campo#;
         |ERROR;
         |ACABA;
     |FINSI;

     eaVarDni  = #agim0024#Campo#;
     enCalcCif = 0;
     |HAZ CalculoDNI;
     eaVarDni = (eaVarDni + "            ") % 112;
     |SI #agim0024#Campo# ! eaVarDni;
         |CONFI "0000SEl Nif puede ser Erroneo. Desea Calcularlo.";
         |SI FSalida = 0;
             #agim0024#Campo# = eaVarDni;  |PINTA #agim0024#Campo#;
             |ERROR;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO LeePaism24; |TIPO 6;
     eaCodPais = #agim0024#Campo#;
     |HAZ LeePais;
     nCampo = 22;
     |SI Campo = 23; nCampo = 25; |FINSI;
     #agim0024#nCampo# = #718#1; |PINTA #agim0024#nCampo#;
|FPRC;

|PROCESO PonDatos;
     aAlfa1 = Contenido;
     Modo1 = (FEntrada / 100) ! 0;
     aAlfa = #agim0024#4; |QBF aAlfa;

     |SI Modo1 = 1; |O aAlfa = ""; |O aAlfa1 ! #agim0024##3;
         eaCodNif  = #agim0024#3;
         |HAZ LeeNifs;

         #agim0024#24 = "01.01.0000";
         #agim0024#4  = #709#1;  |PINTA #agim0024#4;
         #agim0024#7  = #709#2;  |PINTA #agim0024#7;
         #agim0024#8  = #709#3;  |PINTA #agim0024#8;
         #agim0024#9  = #709#4;  |PINTA #agim0024#9;
         #agim0024#10 = #709#5;  |PINTA #agim0024#10;
         #agim0024#11 = #709#6;  |PINTA #agim0024#11;
         #agim0024#12 = #709#7;  |PINTA #agim0024#12;
         #agim0024#13 = #709#8;  |PINTA #agim0024#13;
      |FINSI;

      |HAZ Tipo0FecNac;
|FPRC;

|PROCESO Tipo0FecNac;
      |SI #agim0024#24 [ "01.01.0001";
         |ABRE #agidanif;
         #agidanif#0  = #agim0024#3;
         #agidanif#1  = 1;
         |LEE 040#agidanif.=;
         |SI FSalida = 0; |Y #agidanif#13 > "01.01.0000";
             #agim0024#24 = #agidanif#13; |PINTA #agim0024#24;
         |FINSI;
         |CIERRA #agidanif;
     |FINSI;

     fHoy = ~;
     |SI #agim0024#24 > fHoy;    || nacimientos futuros como que no
          |HAZ PonSiglo20;       ||/se cambia sin preguntar
     |FINSI;

     |SI #agim0024#24 ] "01.01.2001"; |Y #agim0024#24 [ fHoy;  || presuntos ni¤os,
                                                                       ||/se pregunta
         |HAZ CumpleAnyos;
         |SI nEdad < 18;
             aAlfa = "0000SLa fecha puede ser incorrecta. Ha introducido un contribuyente menor de edad. Corregir fecha?";
             |CONFI aAlfa;
             |SI FSalida = 0;
                 |ERROR;
                 || |HAZ PonSiglo20;
             |FINSI;
         |FINSI;
     |FINSI;

|FPRC;

|PROCESO CumpleAnyos;
     aAlfa1 = fHoy;         aAlfa1 = aAlfa1 % -104; nAny1 = aAlfa1;
     aAlfa1 = #agim0024#24; aAlfa1 = aAlfa1 % -104; nAny2 = aAlfa1;
     nEdad  = nAny1 - nAny2;

     |SI nEdad ! 18; |ACABA; |FINSI;

     aAlfa1 = fHoy;         aAlfa1 = aAlfa1 % 402; nMes1 = aAlfa1;
     aAlfa1 = #agim0024#24; aAlfa1 = aAlfa1 % 402; nMes2 = aAlfa1;

     |SI nMes2 > nMes1;  nEdad = nEdad - 1; |FINSI;
     |SI nMes1 ! nMes2;  |ACABA;            |FINSI;

     aAlfa1 = fHoy;         aAlfa1 = aAlfa1 % 102; nDia1 = aAlfa1;
     aAlfa1 = #agim0024#24; aAlfa1 = aAlfa1 % 102; nDia2 = aAlfa1;

     |SI nDia2 > nDia1;  nEdad = nEdad - 1; |FINSI;
|FPRC;

|PROCESO PonSiglo20;
     aAlfa1    = (#agim0024#24 % 106) + "19" + (#agim0024#24 % -102);
     #agim0024#24 = aAlfa1;
     |PINTA #agim0024#24;
|FPRC;

|PROCESO GrabaRepre;
     |SI nSwPasa = 1;
         |DDEFECTO #agim0024;
         #agim0024#0  = #agim0004#0;
         #agim0024#1  = Registro;
         #agim0024#2  = #agim0004#1;
         #agim0024#3  = #agim0004#2;
         #agim0024#4  = #agim0004#3;
         #agim0024#5  = #agim0004#4;
         #agim0024#6  = #agim0004#5;
         #agim0024#7  = #agim0004#6;
         #agim0024#8  = #agim0004#7;
         #agim0024#9  = #agim0004#8;
         #agim0024#10 = #agim0004#9;
         #agim0024#11 = #agim0004#10;
         #agim0024#12 = #agim0004#11;
         #agim0024#13 = #agim0004#12;

         |GRABA 140#agim0024.n;
         |LIBERA #agim0024;
     |FINSI;

     |BORRA 020#agim0004.a;
     |LIBERA #agim0004;
|FPRC;

|DEFBUCLE agim0004;
     #agim0004#1;
     ;
     Cliente, 01;
     Cliente, 99;
     be;
     NULL, GrabaRepre;
|FIN;

|PROCESO CreaRepres;
     |SI #agim0024#15 = "A";  |ACABA;  |FINSI;

     #agim0004#0  = #agim0024#0;
     #agim0004#1  = #agim0024#2;
     #agim0004#2  = #agim0024#3;
     #agim0004#3  = #agim0024#4;
     #agim0004#4  = #agim0024#5;
     #agim0004#5  = #agim0024#6;
     #agim0004#6  = #agim0024#7;
     #agim0004#7  = #agim0024#8;
     #agim0004#8  = #agim0024#9;
     #agim0004#9  = #agim0024#10;
     #agim0004#10 = #agim0024#11;
     #agim0004#11 = #agim0024#12;
     #agim0004#12 = #agim0024#13;
     #agim0004#13 = #agim0024#14;
     #agim0004#14 = #agim0024#16;
     #agim0004#15 = #agim0024#17;
     #agim0004#16 = #agim0024#18;
     |GRABA 020#agim0004.n;
     |LIBERA #agim0004;

     |SI #agim0024#19 = "S";
         #socm0001#0 = #agim0024#0;
         #socm0001#1 = #agim0024#3;
         |LEE 101#socm0001.=;
         |SI FSalida ! 0;
             |DDEFECTO #socm0001;
              #socm0001#0 = #agim0024#0;
              #socm0001#1 = #agim0024#3;
              |GRABA 020#socm0001.b;
         |FINSI;

         #socm0001#2  = #agim0024#4;
         #socm0001#3  = #agim0024#5;
         #socm0001#4  = #agim0024#6;
         #socm0001#5  = #agim0024#7;
         #socm0001#6  = #agim0024#8;
         #socm0001#7  = #agim0024#9;
         #socm0001#8  = #agim0024#10;
         #socm0001#9  = #agim0024#11;
         #socm0001#10 = #agim0024#12;
         #socm0001#11 = #agim0024#13;
         #socm0001#12 = #agim0024#14;
         #socm0001#13 = #agim0024#15;
         #socm0001#14 = #agim0024#16;
         #socm0001#15 = #agim0024#17;
         #socm0001#16 = #agim0024#18;
         #socm0001#17 = #agim0024#20;

         |GRABA 020#socm0001.a;
         |LIBERA #socm0001;
     |FINSI;
|FPRC;

|DEFBUCLE agim0024;
     #agim0024#1;
     ;
     Cliente, Registro, 00;
     Cliente, Registro, 99;
     ;
     NULL, CreaRepres;
|FIN;

|PROGRAMA;

     |ABRE #agim0024;
     #agim0024#0 = Cliente;
     #agim0024#1 = Registro;
     #agim0024#2 = 1;
     |LEE 040#agim0024.];
     |SI FSalida ! 0; |O #agim0024#0 ! Cliente; |O #agim0024#1 ! Registro;
         nSwPasa = 1;  |BUCLE agim0004;
     |SINO;
         |SI Modo ! 4;
             nSwPasa = 0;  |BUCLE agim0004;
         |FINSI;
     |FINSI;
     |CIERRA #agim0024;

     |SI Modo ! 4;

         |ENTLINEAL #1#agim0024, -3, 1, 22, 1, ClaveBaja0, ClaveAlta0;

         |ABRE #agim0004;
         |ABRE #socm0001;
         |BUCLE agim0024;
         |CIERRA #agim0004;
         |CIERRA #socm0001;
     |SINO;
         |ENTLINEAL #1#agim0024, -3, 4, 22, 1, ClaveBaja0, ClaveAlta0;
     |FINSI;
|FPRO;
