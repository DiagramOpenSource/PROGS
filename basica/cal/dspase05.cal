|FICHEROS;
     dspase00 #0;
     dspase05 #5;
     dspase15 #15;
     dspase91 #91,MANTE;
     dspase92 #92,MANTE;
     dspase93 #93;
     dspase94 #94;

     :/basica/def/agicen14   #114;
     :/contagen/def/canempre #200;
     :/contagen/def/camoneda #201;
     :/integral/def/dsam0000 #202;
     :/contagen/def/cacalend #213;

     :/contagen/def/camacc01 #501;
     :/contagen/def/camacc02 #502;
     :/contagen/def/camacc03 #503;

     :/contagen/def/cacalend #213;
     :/modelos/def/dsmow123  #123;
     agicen17 #17;

     refer00@ #900;
     refer01@ #901;
     refer02@ #902;
     refer03@ #903;

     refer21@ #921;   || eosmcc01
     refer22@ #922;   || eosmcc02

     refer11@ #911;  || El eosclien
     refer12@ #912;  || conceptos 2
     refer13@ #913;  || conceptos 6
|FIN;

|VARIABLES;
     nNume1          = 0;
     nNume2          = 0;
     nNume3          = 0;
     nCampo2         = 0;
     nTecla          = 0;
     nLinea          = 0;
     nDig1           = 0;
     nDig3           = 0;
     nDig4           = 0;
     nDig5           = 0;
     nDig6           = 0;
     nDig7           = 0;
     nDig8           = 0;
     nDig9           = 0;
     nDigito         = 0;
     nSw             = 0;
     nLong           = 0;
     nPos            = 0;
     nRegistro       = 0;
     nCliente        = 0;
     Base            = 0;
     nBase           = 0;
     nActividad      = 0;
     nNumFacturas    = 0;
     nTotalFact      = 0;
     nPorceIva       = 0;
     nTotalIva       = 0;
     nAcumulador     = 0;
     nLibro          = 0;
     nTrimestre      = 0;
     nSwChequeo      = 0;
     nSwChequeo1     = 0;
     nNume           = 0;
     nCodigoNue      = 0;
     nCodigoReo      = 0;
     nCodigoCon      = 0;
     nEstaCambio     = 0;
     nConversor      = 0;
     nTotal1         = 0;
     nTotal2         = 0;
     nTotal3         = 0;
     nTotal4         = 0;

     &aPathAnterior   = "";
     &aPathDefFiscal  = "";
     &aPathFichFiscal = "";
     &aPathDestino    = "";
     aDef            = "";
     aDirEmpresa     = "";
     aDirFichDestino = "";
     aDirFichOrigen  = "";
     aFichero        = "";
     aAlfa           = "";
     aAlfa1          = "";
     aAlfa2          = "";
     aAlfa3          = "";
     aAlfa4          = "";
     aAlfa5          = "";
     aConcepto       = "";
     aCuenta         = "";
     aSerie          = "";
     aTipoIva        = "";
     aTipoLibro      = "";
     aConfi          = "";
     aNombre         = "";
     aNif            = "";
     aFactura        = "";
     aSubDepar       = "";
     aMonedaAgieos   = "";
     nRedondeo       = 0;
     aBase           = "";
     aPathPases      = "";
     aOrigen         = "";
     aDestino        = "";

     aCampo02        = "";
     aCampo03        = "";
     aCampo04        = "";
     aCampo05        = "";
     aCampo06        = "";
     aCampo07        = "";
     aCampo08        = "";
     aCampo09        = "";
     aCampo10        = "";
     aCampo11        = "";
     aCampo12        = "";
     aCampo13        = "";
     aCampo14        = "";
     aCampo15        = "";
     aCampo16        = "";
     aCampo17        = "";
     aCampo18        = "";
     aCampo19        = "";
     aCampo20        = "";
     aCampo21        = "";
     aCampo22        = "";
     aCampo23        = "";
     aCampo24        = "";
     aCampo25        = "";
     aCampo26        = "";
     aCampo27        = "";
     aCampo42        = "";
     aCamp27         = "";

     fFecha          = "";

     &any_pos        = 0;
     &eaExterno      = "";
     &enEmpreOri     = 0;
     &enPerioOri     = 0;
     &eaCopiar       = "";
     &eaCeros        = "";

     aPathAgicont    = "";
     &eaPathContagen = "";
     &eaPathBasica   = "";
     &eaPathDsmodelo = "";
     &eaPathIntegral = "";
     &eaPathAgitool  = "";
     &eaFAsiento     = "";
     &enEmprEos      = 0;
     &enEmpresa      = 0;
     &enPerConta     = 0;
     &eaNombreEmp    = "";
     &enTipoAct      = 0;
     &enDesdeOtra    = 0;
     &swSinCheq      = 0;
     &enTipoEos      = 0;
     &eaEmprEos      = "";

     &eaEmpresa      = "";
     &eaBase         = "";
     &eaAplica       = "";
     &enForzar       = 0;
     &eaMoneda       = "";
     nEstado         = 0;
     nModoEntrada    = 0;
     aQueQuiero      = "";
     aNumCampos      = "";
     nNumCampos      = 0;
     aIdenti         = "";
     fFechaOp        = @;

     &enSwCaja123    = 0;
     nSwCaja         = 0;
     aTipoIVA        = "";
     eEmpreCaja      = 0;
     eRegisCaja      = 0;
     enEjerCaja      = 0;
     eDevenCaja      = 0;
|FIN;

|| PROCESOS DEL DSPASE92 *************************************

|PROCESO Tipo11w92;  |TIPO 11;
     nTecla = FSalida;

     |SI nTecla = 10;
         |PUSHV 0501 2380;
         |CUADRO 0820 1870;
         |BLANCO 0921 1769;
         |ATRI S;
         |PINTA 0921, "             !!! ATENCION ннн                    ";
         |ATRI s;

         |ATRI I;
         |PINTA 1121, " Debes borrar antes la Empresa de Contabilidad o ";
         |PINTA 1221, "bien borrar todos los asientos  que  se  han     ";
         |PINTA 1321, "generado en el pase anterior, ya que si no lo    ";
         |PINTA 1421, "hacemos tendremos los datos duplicados.          ";
         |ATRI i;

         |PINTA 1740, "Conforme S/N : ";
         E_sup  = "1";
         E_inf  = "SNsn";
         aConfi = "N";
         aConfi = 1755 ? 1;
         |SI aConfi = "S"; |O aConfi = "s";
             #91#0 = #92#0;
             #91#1 = #92#1;
             #91#2 = #92#2;
             #91#3 = "N";
             #91#4 = 0;
             #91#5 = #92#4;
             |GRABA 040#91n;
             |LIBERA #91;

             |LEE 101#92=;
             |BORRA 020#92a;
             |LIBERA #92;

             |PONCONTROL 23, "SI";
         |FINSI;

         |POPV;
     |FINSI;
|FPRC;

|| PROCESOS DEL DSPASE91 *************************************

|PROCESO CogeCodConta;
     |SI #15#22 = "S";  |ACABA;  |FINSI;

     nCodigoCon = #15#20;  ||contabilidad original
     |ERROR10;
|FPRC;

|DEFBUCLE pase15Conta;
     #15#3;                             || lee codigo nuevo en Integrada
     ;                                  || y busca contabilidad original
     #91#1, "            ", 000;
     #91#1, "zzzzzzzzzzzz", 999;
     ;
     NULL, CogeCodConta;
|FIN;

|PROCESO ChequeaEmpresa;

     |SI aPathAgicont = "";  |ACABA;  |FINSI;

     aDirFichOrigen  = aPathAnterior + "agicont/fich/";
     aDef            = aPathAnterior + "agicont/def/canempre.mas";
     |CARGA_DEF aDef, refer00@;
     |SI FSalida ! 0;
         |MENAV "     Error en Cargar el Def canempre.mas";
         |ACABA;
     |FINSI;

     aDirFichDestino = aPathDestino + "fich/";
     aDef            = aPathDestino + "def/canempre";
     |CARGA_DEF aDef, refer01@;
     |SI FSalida ! 0;
         |DESCARGA_DEF #refer00@;
         |MENAV "     Error en Cargar el Def canempre.mas";
         |ACABA;
     |FINSI;

     |PATH_DAT #900 aDirFichOrigen;
     |PATH_DAT #901 aDirFichDestino;

|| ... Mirar el numero de agicont ahora en la PI.

     |SI nEstaCambio = 1;
         nCodigoCon = 0;
         |BUCLE pase15Conta;
     |SINO;
         nCodigoCon = #91#1;
     |FINSI;

|| :::::::::::::::::::::::::::::::::::::::::::::::::::::
     |SI nCodigoCon ! 0;

         |ABRE #900;
         #900#2 = nCodigoCon;
         #900#3 = #5#11;
         |LEE 040#900=;
         |SI FSalida = 0;
             |ABRE #901;
             #901#2 = #91#1;
             #901#3 = #5#11;
             |LEE 040#901=;
             |SI FSalida ! 0;
                 nSwChequeo  = 1;
                 nSwChequeo1 = 1;
             |FINSI;
             |CIERRA #901;
         |FINSI;
         |CIERRA #900;

     |FINSI;

     |DESCARGA_DEF #refer01@;
     |DESCARGA_DEF #refer00@;
|FPRC;

|PROCESO PonAlfa;
     nSwChequeo  = 0;
     |SI aAlfa = "S";
         |HAZ ChequeaEmpresa;
     |FINSI;

     |SI nSwChequeo = 0;
         #91#3 = aAlfa;
         |GRABA 020#91a;
         |LIBERA #91;
     |FINSI;
|FPRC;

|DEFBUCLE dspase91E;
     #91#1;
     ;
     #5#0, 00000, 0;
     #5#0, 99999, 0;
     be;
     NULL, PonAlfa;
|FIN;

|RUTINA ClaveBaja92;
     #92#0 = #5#0;
     #92#1 = 99999;
     #92#3 = 0;
|FRUT;

|RUTINA ClaveAlta92;
     #92#0 = #5#0;
     #92#1 = 00000;
     #92#3 = 0;
|FRUT;

|PROCESO Tipo11w91;  |TIPO 11;
     nTecla = FSalida;

     |SI nTecla = 10;
         |LEE 101#91=;
         |SI #91#3 = "S";
             #91#3 = "N";
         |SINO;
             nSwChequeo  = 0;
             nSwChequeo1 = 0;
             |HAZ ChequeaEmpresa;
             |SI nSwChequeo = 0;
                 #91#3 = "S";
             |SINO;
                 |MENAV "    La Empresa existe en la Contabilidad Anterior y aun no se ha pasado a la Actual";
             |FINSI;
         |FINSI;
         |PINTA #91#3;

         |GRABA 020#91a;
         |LIBERA #91;
     |FINSI;

     |SI nTecla = 11;
         nSwChequeo1 = 0;
         aAlfa       = "S";
         |BUCLE dspase91E;
         |SI nSwChequeo1 = 1;
             |MENAV "    No se han marcado algunas empresas, porque no se ha hecho el pase de Contabilidad";
         |FINSI;
         |PONCONTROL 23, "SI";
         |PTEC 812;
     |FINSI;

     |SI nTecla = 12;
         nSwChequeo = 0;
         aAlfa      = "N";
         |BUCLE dspase91E;
         |PONCONTROL 23, "SI";
         |PTEC 812;
     |FINSI;

     |SI nTecla = 13;
         |ENTLINEAL #1#92, -2, 4, 22, 0, ClaveBaja92, ClaveAlta92;
     |FINSI;
|FPRC;

|| Proceso de Entrada por Pantallas

|PROCESO Tipo8;  |TIPO 8;
     |ABRE #0;
     |LEE 040#0p;
     |SI FSalida ! 0;
         |MENAV "     Pase de Ficheros Generales no Realizado";
         |PTEC 807;
         |CIERRA #0;
         |ACABA;
     |FINSI;
     |CIERRA #0;

     |ABRE #15;
     |LEE 040#15p;
     |SI FSalida ! 0;
         nEstaCambio = 0;
         |DDEFECTO #15;
     |SINO;
         nEstaCambio = 1;
         |SI #15#15 ! "S";
             |MENAV "      Unificacion de Codigos no Realizada.";
             |PTEC 807;
             |CIERRA #15;
             |ACABA;
         |FINSI;
     |FINSI;
     |CIERRA #15;

     |HAZ BusquedaApli;
     eaPathDsmodelo = eaPathDsmodelo + "fich/";

     |SI eaPathContagen = "";
         |MENAV "     No tiene instalada la Contabilidad";
         |PTEC 807;
         |ACABA;
     |FINSI;

     aPathAnterior   = #0#0;  |QBT aPathAnterior;
     aPathDefFiscal  = aPathAnterior + "agieos/def/";
     aPathFichFiscal = aPathAnterior + "agieos/fich/";
     aPathDestino    = eaPathContagen - "fich/";
|FPRC;

|PROCESO Borrar92;
 |BORRA 020#92a;
 |LIBERA #92;
|FPRC;

|DEFBUCLE Borrar92;
     #92#1;
     ;
     #5#0, 99999, 9;
     #5#0, 00000, 0;
     be;
     NULL, Borrar92;
|FIN;


|PROCESO Borrar91;
 |BORRA 020#91a;
 |LIBERA #91;
|FPRC;

|DEFBUCLE Borrar91;
     #91#1;
     ;
     #5#0, 00000, 0;
     #5#0, 99999, 0;
     be;
     NULL, Borrar91;
|FIN;

|PROCESO ParaBorrar; |TIPO 2;
  nModoEntrada = (FEntrada / 100) ! 0;
  |SI nModoEntrada ! 3; |ACABA; |FINSI;

  |BUCLE Borrar91;
  |BUCLE Borrar92;
|FPRC;

|PROCESO despues; |TIPO 0;
  nModoEntrada = (FEntrada / 100) ! 0;
  aAlfa1 = "S";
  |SI nModoEntrada ! 1;
      aAlfa1 = "N";
  |FINSI;
  |C_M #5#13,1, aAlfa1;
|FPRC;

|PROCESO Cuadro; |TIPO 7;
     |PUSHV  0736 1279;

     |C_M #5#13,0, aAlfa1;
     |SI aAlfa1 = "N"; |ACABA; |FINSI;

     |ATRI R;
     |PINTA 0837, " TRATAMIENTO PARA LA EMPRESA QUE NO TIENE  ";
     |PINTA 0937, " LIBROS EN EL EJERCICIO SELECCIONADO       ";
     |ATRI 0;
     |ATRI I;
     |PINTA 1037, "    (S) Crear Cliente y proveedores        ";
     |PINTA 1137, "    (N) No pasa datos                      ";
     |ATRI 0;
     |CUADRO 0736 1279;
|FPRC;

|PROCESO NoCuadro; |TIPO 0;
     |POPV;
|FPRC;

|PROCESO Empresa;

     aDirFichDestino = aPathDestino + "fich/";
     aDef            = aPathDestino + "def/canempre";
     |CARGA_DEF aDef, refer00@;
     |SI FSalida ! 0;
         |MENAV "     Error en Cargar el Def canempre.mas";
         |PTEC 807;
         |ACABA;
     |FINSI;

     |PATH_DAT #900 aDirFichDestino;

     |ABRE #900;
     #900#2 = #5#1;
     #900#3 = #5#2;
     |LEE 040#900=;
     |SI FSalida ! 0;
         |MENAV "     No existe la Empresa Patron de Copia.";
         |PTEC 808;
     |FINSI;
     |CIERRA #900;

     |DESCARGA_DEF #refer00@;
|FPRC;

|PROCESO Diario;
     aDirEmpresa      = (("00000" + #5#1) % -105) + #5#2 + "/";
     aDirFichDestino = aPathDestino + "fich/" + aDirEmpresa;

     aDef            = aPathDestino + "def/camandia";
     |CARGA_DEF aDef, refer00@;
     |SI FSalida ! 0;
         |MENAV "     Error en Cargar el Def camandia.mas";
         |PTEC 807;
         |ACABA;
     |FINSI;

     |PATH_DAT #900 aDirFichDestino;

     |ABRE #900;
     #900#0 = #5#5;
     |LEE 040#900=;
     |SI FSalida ! 0;
         |MENAV "       No existe el Diario";
         |ERROR;
     |SINO;
         #5#6 = #900#1;
         |PINTA #5#6;
     |FINSI;
     |CIERRA #900;

     |DESCARGA_DEF #refer00@;
|FPRC;

|PROCESO Libro;
     aDirEmpresa      = (("00000" + #5#1) % -105) + #5#2 + "/";
     aDirFichDestino = aPathDestino + "fich/" + aDirEmpresa;

     aDef            = aPathDestino + "def/calibros";
     |CARGA_DEF aDef, refer00@;
     |SI FSalida ! 0;
         |MENAV "     Error en Cargar el Def calibros.mas";
         |PTEC 807;
         |ACABA;
     |FINSI;

     |PATH_DAT #900 aDirFichDestino;

     nCampo2 = Campo + 1;

     |ABRE #900;
     #900#0 = #5Campo;
     |LEE 040#900=;
     |SI FSalida ! 0;
         |MENAV "       No existe el Libro";
         |ERROR;
     |SINO;
         #5nCampo2 = #900#1;
         |PINTA #5nCampo2;
     |FINSI;
     |CIERRA #900;

     |DESCARGA_DEF #refer00@;
|FPRC;

|RUTINA ClaveBaja91;
     #91#0 = #5#0;
     #91#1 = 00000;
     #91#4 = 0;
|FRUT;

|RUTINA ClaveAlta91;
     #91#0 = #5#0;
     #91#1 = 99999;
     #91#4 = 0;
|FRUT;

|PROCESO Tipo13;  |TIPO 13;
     |NOME_DAT #91 "pase0591";
     |NOME_DAT #92 "pase0592";
     |ENTLINEAL #1#91, -2, 7, 22, 0, ClaveBaja91, ClaveAlta91;
     |ENTLINEAL #1#92, -2, 7, 22, 0, ClaveBaja92, ClaveAlta92;
|FPRC;

|| Proceso de Creacion Automatica de Empresas Contabilidad

|PROCESO CogeCodigo;
     |SI #15#22 = "S";  |ACABA;  |FINSI;

     nCodigoNue = #15#3;
     |ERROR10;
|FPRC;

|DEFBUCLE dspase15;
     #15#4;
     ;
     nCodigoReo, "            ", 000;
     nCodigoReo, "zzzzzzzzzzzz", 999;
     ;
     NULL, CogeCodigo;
|FIN;

|PROCESO CargaTempoV;
     |SI nEstaCambio = 1;
         nCodigoNue = 0;
         nCodigoReo = #900#0;
         |BUCLE dspase15;
         |SI nCodigoNue = 0;  |ACABA;  |FINSI;
     |SINO;
         nCodigoNue = #900#0;
     |FINSI;

     #91#0 = #900#4;
     #91#1 = nCodigoNue;
     #91#4 = 0;
     |LEE 040#91=;
     |SI FSalida = 0;  |ACABA;  |FINSI;

     #200#2 = nCodigoNue;
     #200#3 = #5#11;
     |LEE 040#200=;
     |SI FSalida = 0;
         #92#0 = #900#4;
         #92#1 = nCodigoNue;
         #92#3 = 0;
         |LEE 040#92=;
         |SI FSalida = 0;  |ACABA;  |FINSI;
     |SINO;
         #92#0 = #900#4;
         #92#1 = nCodigoNue;
         #92#3 = 0;
         |LEE 101#92=;
         |SI FSalida = 0;
             |BORRA 020#92a;
         |FINSI;
         |LIBERA #92;
     |FINSI;

     aFichero = "v" + (("00000" + #900#0) % -105) + (("00" + #900#4) % -102);
     |NOME_DAT #901 aFichero;
     |PATH_DAT #901 aPathFichFiscal;

     |ABRE #901;
     |LEE 040#901p;
     |SI FSalida ! 0;  |ACABA;  |FINSI;
     |CIERRA #901;

     #91#0 = #900#4;
     #91#1 = nCodigoNue;
     #91#2 = #900#1;
     #91#3 = "N";
     #91#4 = 0;
     #91#5 = #900#0;
     |GRABA 020#91n;
     |LIBERA #91;
|FPRC;

|DEFBUCLE eoscabve;
     #900#1002;
     ;
     00000, #5#0;
     99999, #5#0;
     ;
     NULL, CargaTempoV;
|FIN;

|PROCESO CargaTempoC;
     |SI nEstaCambio = 1;
         nCodigoNue = 0;
         nCodigoReo = #900#0;
         |BUCLE dspase15;
         |SI nCodigoNue = 0;  |ACABA;  |FINSI;
     |SINO;
         nCodigoNue = #900#0;
     |FINSI;

     #91#0 = #900#4;
     #91#1 = nCodigoNue;
     #91#4 = 0;
     |LEE 040#91=;
     |SI FSalida = 0;  |ACABA;  |FINSI;

     #200#2 = nCodigoNue;
     #200#3 = #5#11;
     |LEE 040#200=;
     |SI FSalida = 0;
         #92#0 = #900#4;
         #92#1 = nCodigoNue;
         #92#3 = 0;
         |LEE 040#92=;
         |SI FSalida = 0;  |ACABA;  |FINSI;
     |SINO;
         #92#0 = #900#4;
         #92#1 = nCodigoNue;
         #92#3 = 0;
         |LEE 101#92=;
         |SI FSalida = 0;
             |BORRA 020#92a;
         |FINSI;
         |LIBERA #92;
     |FINSI;

     aFichero = "c" + (("00000" + #900#0) % -105) + (("00" + #900#4) % -102);
     |NOME_DAT #901 aFichero;
     |PATH_DAT #901 aPathFichFiscal;

     |ABRE #901;
     |LEE 040#901p;
     |SI FSalida ! 0;  |ACABA;  |FINSI;
     |CIERRA #901;

     #91#0 = #900#4;
     #91#1 = nCodigoNue;
     #91#2 = #900#1;
     #91#3 = "N";
     #91#4 = 0;
     #91#5 = #900#0;
     |GRABA 020#91n;
     |LIBERA #91;
|FPRC;

|DEFBUCLE eoscabco;
     #900#1002;
     ;
     00000, #5#0;
     99999, #5#0;
     ;
     NULL, CargaTempoC;
|FIN;

|PROCESO CreaEmpresa;
     #901#0 = #91#1;
     |LEE 101#901=;
     |SI FSalida = 0;
         #901#23 = "S";
         |GRABA 020#901a;
     |SINO;
         |DDEFECTO #901;
     |FINSI;
     |LIBERA #901;
     |CIERRA #901;

     |SI eaPathIntegral ! "";
         |ABRE #202;
         #202#0 = #91#1;
         |LEE 101#202=;
         |SI FSalida = 0;
             #202#65 = "S";
             |GRABA 020#202a;
         |FINSI;
         |LIBERA #202;
         |CIERRA #202;
     |FINSI;

     #900#2 = #5#1;
     #900#3 = #5#2;
     |LEE 040#900=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;
     aCamp27 = #900#27;

     |ABRE #114;
     #114#0 = #91#1;
     #114#1 = 1;
     |LEE 040#114];
     |SI FSalida ! 0;  |O #114#0 ! #91#1;
         |DDEFECTO #114;
     |FINSI;
     |CIERRA #114;

     #900#2  = #91#1;
     #900#3  = #5#11;
     #900#0  = (N\ (#900#2 * 10) + #900#3);
     #900#1  = #901#2;
     #900#4  = #901#1;
     #900#5  = #901#4;
     aAlfa   = (("00" + #901#9) % -102) + (("000" + #901#10) % -103);
     #900#6  = aAlfa;
     #900#7  = #901#11;
     #900#8  = #901#13;
     #900#9  = #901#14;
     #900#10 = #901#15;
     #900#26 = #5#0;     ||Ejercicio
     #900#21 = "A";
     #900#24 = "S";
     #900#27 = aCamp27;

     |SI #900#26 ] 80;
         nNume = 1900 + #900#26;
     |SINO;
         nNume = 2000 + #900#26;
     |FINSI;

     aAlfa1 = #900#1;   |QBF aAlfa1;
     aAlfa2 = #114#8;   |QBF aAlfa2;
     aAlfa3 = #114#10;  |QBF aAlfa3;
     aAlfa =  "[" + (("00000" + #900#2) % -105) + "/" + nNume + "] " + aAlfa1 + " " + aAlfa2 + " " + aAlfa3;
     #900#29 = aAlfa;

     aAlfa   = &126 * 10;
     #900#20 = aAlfa;
     #900#28 = aMonedaAgieos;
     |GRABA 020#900n;
     |LIBERA #900;

     aDirEmpresa      = (("00000" + #91#1) % -105) + #5#11;
     aDirFichDestino = aPathDestino + "fich/" + aDirEmpresa + "/";
     |MKDIR aDirFichDestino;

     enEmpreOri = #5#1;
     enPerioOri = #5#2;
     eaCopiar   = #5#3;
     eaCeros    = #5#4;
     eaExterno  = aDirFichDestino;
     any_pos    = #900#26;
     |SUB_EJECUTA_NP ":contagen/cacrebal";

     enForzar   = 1;
     eaAplica   = "contagen";
     eaEmpresa  = (("00000" + #900#2) % -105) + #900#3;
     eaMoneda   = #900#28;
     |DBASS eaBase;  |QBT eaBase;
     |SUB_EJECUTA_NP ":agitool/dsconver";
|FPRC;

|| Proceso de Creacion del Temporal Puente de Creacion de Asientos.

|PROCESO LeeConcepto93;
     #93#0 = aConcepto;
     |LEE 040#93=;
     |SI FSalida ! 0;  |DDEFECTO #93;  |FINSI;

     aCampo02 = #93#2;
     aCampo03 = #93#3;
     aCampo04 = #93#4;
     aCampo05 = #93#5;
     aCampo06 = #93#6;
     aCampo07 = #93#7;
     aCampo08 = #93#8;
     aCampo09 = #93#9;
     aCampo10 = #93#10;
     aCampo11 = #93#11;
     aCampo12 = #93#12;
     aCampo13 = #93#13;
     aCampo14 = #93#14;
     aCampo15 = #93#15;
     aCampo16 = #93#16;
     aCampo17 = #93#17;
     aCampo18 = #93#18;
     aCampo19 = #93#19;
     aCampo20 = #93#20;
     aCampo21 = #93#21;
     aCampo22 = #93#22;
     aCampo23 = #93#23;
     aCampo24 = #93#24;
     aCampo25 = #93#25;
     aCampo26 = #93#26;
     aCampo27 = #93#27;

     #913#0 = aConcepto;
     |LEE 040#913=;
     |SI FSalida ! 0;  |DDEFECTO #913;  |FINSI;
     aCampo42 = #913#22;
|FPRC;

|PROCESO LeeConcepto94;
     #94#0 = aConcepto;
     |LEE 040#94=;
     |SI FSalida ! 0;  |DDEFECTO #94;  |FINSI;

     aCampo02 = #94#2;
     aCampo03 = #94#3;
     aCampo04 = #94#4;
     aCampo05 = #94#5;
     aCampo06 = #94#6;
     aCampo07 = #94#7;
     aCampo08 = #94#8;
     aCampo09 = #94#9;
     aCampo10 = #94#10;
     aCampo11 = #94#11;
     aCampo12 = #94#12;
     aCampo13 = #94#13;
     aCampo14 = #94#14;
     aCampo15 = #94#15;
     aCampo16 = #94#16;
     aCampo17 = #94#17;
     aCampo18 = #94#18;
     aCampo19 = #94#19;
     aCampo20 = #94#20;
     aCampo21 = #94#21;
     aCampo22 = #94#22;
     aCampo23 = #94#23;
     aCampo24 = #94#24;
     aCampo25 = #94#25;
     aCampo26 = #94#26;
     aCampo27 = #94#27;

     #912#0 = aConcepto;
     |LEE 040#912=;
     |SI FSalida ! 0;  |DDEFECTO #912;  |FINSI;
     aCampo42 = #912#16;
|FPRC;

|PROCESO CalculaCuenta;
     aAlfa1  = aCuenta;  |QBF aAlfa1;
     aAlfa1  = aAlfa1 % 0;
     nLong   = aAlfa1;
     nSw     = 0;
     nDigito = 0;
     |SI nLong = nDig4; |Y nDig4 ! 0; nSw = 1; nDigito = 1; |FINSI;
     |SI nLong = nDig5; |Y nDig5 ! 0; nSw = 1; nDigito = 2; |FINSI;
     |SI nLong = nDig6; |Y nDig6 ! 0; nSw = 1; nDigito = 3; |FINSI;
     |SI nLong = nDig7; |Y nDig7 ! 0; nSw = 1; nDigito = 4; |FINSI;
     |SI nLong = nDig8; |Y nDig8 ! 0; nSw = 1; nDigito = 5; |FINSI;
     |SI nLong = nDig9; |Y nDig9 ! 0; nSw = 1; nDigito = 6; |FINSI;
     |SI nSw = 0;  |Y nLong ! 0;
         |SI nDig4 ! 0; nDigito = 1; nLong = nDig4;  |FINSI;
         |SI nDig5 ! 0; nDigito = 2; nLong = nDig5;  |FINSI;
         |SI nDig6 ! 0; nDigito = 3; nLong = nDig6;  |FINSI;
         |SI nDig7 ! 0; nDigito = 4; nLong = nDig7;  |FINSI;
         |SI nDig8 ! 0; nDigito = 5; nLong = nDig8;  |FINSI;
         |SI nDig9 ! 0; nDigito = 6; nLong = nDig9;  |FINSI;

         aAlfa   = aCuenta;  |QBF aAlfa;
         nPos    = 100 + nLong;
         aCuenta = (aAlfa + "000000000000") % nPos;
     |FINSI;
|FPRC;

|PROCESO CuentaConAste;
     aAlfa1  = aCuenta;  |QBF aAlfa1;
     aAlfa2  = aAlfa1 % -101;
     aAlfa3  = aAlfa1 % -212;
     |SI aAlfa2 = "*";
         |SI nDig4 ! 0; nDigito = 1; nLong = nDig4;  |FINSI;
         |SI nDig5 ! 0; nDigito = 2; nLong = nDig5;  |FINSI;
         |SI nDig6 ! 0; nDigito = 3; nLong = nDig6;  |FINSI;
         |SI nDig7 ! 0; nDigito = 4; nLong = nDig7;  |FINSI;
         |SI nDig8 ! 0; nDigito = 5; nLong = nDig8;  |FINSI;
         |SI nDig9 ! 0; nDigito = 6; nLong = nDig9;  |FINSI;

         nPos    = 100 + (nLong - 5);
         aCuenta = ((aAlfa3 + "000000000000") % nPos) + (("00000" + nCliente) % -105);
     |SINO;
         |HAZ CalculaCuenta;
     |FINSI;
|FPRC;

|PROCESO Base;
      nLinea  = nLinea + 1;

      |DDEFECTO #123;
      #123#0  = #91#1;
      #123#1  = #5#11;
      #123#2  = nLinea;
      #123#3  = #5#5;
      #123#4  = fFecha;
      #123#5  = nRegistro;
      aCuenta = aCampo10;   |HAZ CalculaCuenta;
      #123#6  = aCuenta;
      #123#7  = nDigito;

      |SI nCliente = 0;
          #123#8 = aCampo19;
          |QBF aCampo20;
          |SI #5#12 = "C";
              #123#9 = aCampo20 + " " + aFactura;
          |SINO;
              #123#9 = aFactura;
          |FINSI;
      |SINO;
          #123#8 = aCampo21;
          |QBF aCampo22;
          |SI #5#12 = "C";
              #123#9 = aCampo22 + " " + aFactura;
          |SINO;
              #123#9 = aFactura;
          |FINSI;
      |FINSI;

      #123#10 = aCampo11;
      #123#11 = nBase;
      #123#12 = nActividad;
      #123#13 = aSubDepar;
      #123#14 = "";
      |SI aCampo02 ! "N";  #123#14 = aTipoLibro;  |FINSI;
      #123#15 = nLibro;
      #123#16 = nRegistro;
      #123#17 = aSerie;
      #123#19 = "B";
      #123#21 = aFactura;
      #123#22 = nNumFacturas;
      #123#23 = nAcumulador;
      |SI aCampo02 = "I";  #123#24 = "S";  |FINSI;
      #123#25 = "";
      #123#26 = "";
      #123#27 = nTrimestre;
      #123#31 = aCampo42;
      |GRABA 020#123n;
      |LIBERA #123;
|FPRC;

|PROCESO Factura;
      nLinea  = nLinea + 1;

      |DDEFECTO #123;
      #123#0  = #91#1;
      #123#1  = #5#11;
      #123#2  = nLinea;
      #123#3  = #5#5;
      #123#4  = fFecha;
      #123#5  = nRegistro;
      |SI nCliente = 0;
          aCuenta = aCampo12;   |HAZ CuentaConAste;
      |SINO;
          aCuenta = aCampo13;   |HAZ CuentaConAste;
      |FINSI;

      #123#6  = aCuenta;
      #123#7  = nDigito;

      |SI nCliente = 0;
          #123#8 = aCampo19;
          |QBF aCampo20;
          |SI #5#12 = "C";
              #123#9 = aCampo20 + " " + aFactura;
          |SINO;
              #123#9 = aFactura;
          |FINSI;
      |SINO;
          #123#8 = aCampo21;
          |QBF aCampo22;
          |SI #5#12 = "C";
              #123#9 = aCampo22 + " " + aFactura;
          |SINO;
              #123#9 = aFactura;
          |FINSI;
      |FINSI;

      #123#10 = aCampo14;
      #123#11 = nTotalFact;
      #123#12 = nActividad;
      #123#13 = aSubDepar;
      #123#14 = "";
      |SI aCampo02 ! "N";  #123#14 = aTipoLibro;  |FINSI;
      #123#15 = nLibro;
      #123#16 = nRegistro;
      #123#17 = aSerie;
      #123#19 = "F";
      #123#21 = aFactura;
      #123#22 = nNumFacturas;
      #123#23 = nAcumulador;
      |SI aCampo02 = "I";  #123#24 = "S";  |FINSI;
      #123#25 = aNombre;
      #123#26 = aNif;
      #123#27 = nTrimestre;
      #123#31 = aCampo42;
      #123#32 = fFechaOp;
      #123#33 = aIdenti;
      |GRABA 020#123n;
      |LIBERA #123;
|FPRC;

|PROCESO Iva;
      nLinea  = nLinea + 1;

      |DDEFECTO #123;
      #123#0  = #91#1;
      #123#1  = #5#11;
      #123#2  = nLinea;
      #123#3  = #5#5;
      #123#4  = fFecha;
      #123#5  = nRegistro;

      aCuenta = aCampo15;   |HAZ CalculaCuenta;
      #123#6  = aCuenta;
      #123#7  = nDigito;

      |SI nCliente = 0;
          #123#8 = aCampo19;
          |QBF aCampo20;
          |SI #5#12 = "C";
              #123#9 = aCampo20 + " " + aFactura;
          |SINO;
              #123#9 = aFactura;
          |FINSI;
      |SINO;
          #123#8 = aCampo21;
          |QBF aCampo22;
          |SI #5#12 = "C";
              #123#9 = aCampo22 + " " + aFactura;
          |SINO;
              #123#9 = aFactura;
          |FINSI;
      |FINSI;

      #123#10 = aCampo16;
      #123#11 = nTotalIva;
      #123#12 = nActividad;
      #123#13 = aSubDepar;
      #123#14 = "";
      |SI aCampo02 ! "N";  #123#14 = aTipoLibro;  |FINSI;
      #123#15 = nLibro;
      #123#16 = nRegistro;
      #123#17 = aSerie;
      #123#19 = aTipoIva;
      #123#20 = nPorceIva;
      #123#21 = aFactura;
      #123#22 = nNumFacturas;
      #123#23 = nAcumulador;
      |SI aCampo02 = "I";  #123#24 = "S";  |FINSI;
      #123#25 = "";
      #123#26 = "";
      #123#27 = nTrimestre;
      #123#31 = aCampo42;
      |GRABA 020#123n;
      |LIBERA #123;
|FPRC;

|PROCESO Retencion;
      nLinea  = nLinea + 1;

      |DDEFECTO #123;
      #123#0  = #91#1;
      #123#1  = #5#11;
      #123#2  = nLinea;
      #123#3  = #5#5;
      #123#4  = fFecha;
      #123#5  = nRegistro;

      aCuenta = aCampo17;   |HAZ CalculaCuenta;
      #123#6  = aCuenta;
      #123#7  = nDigito;
      #123#8  = aCampo23;
      #123#9  = aCampo24;

      #123#10 = aCampo18;
      #123#11 = nTotalIva;
      #123#12 = nActividad;
      #123#13 = aSubDepar;
      #123#14 = "";
      |SI aCampo02 ! "N";  #123#14 = aTipoLibro;  |FINSI;
      #123#15 = nLibro;
      #123#16 = nRegistro;
      #123#17 = aSerie;
      #123#19 = "P";
      #123#20 = nPorceIva;
      #123#21 = aFactura;
      #123#22 = nNumFacturas;
      #123#23 = nAcumulador;
      |SI aCampo02 = "I";  #123#24 = "S";  |FINSI;
      #123#25 = "";
      #123#26 = "";
      #123#27 = nTrimestre;
      #123#31 = aCampo42;
      |GRABA 020#123n;
      |LIBERA #123;
|FPRC;

|PROCESO Arrendamiento;
     #902#0        = #91#5;
     #902#1        = #5#0;
     #902#2        = nAcumulador;
     #902#3        = #900#1;
     |LEE 040#902=;
     |SI FSalida = 0;
         #901#0 = #902#0;
         #901#1 = #902#4;
         |LEE 040#901=;
         |SI FSalida = 0;
             #17#0 = #91#1;
             #17#1 = #900#19;
             #17#2 = #901#1;
             |LEE 101#17=;
             |SI FSalida ! 0;
                 |DDEFECTO #17;
                 #17#0 = #91#1;
                 #17#1 = #900#19;
                 #17#2 = #901#1;
                 #17#3 = #901#5;
                 #17#4 = #901#3;
                 #17#5 = #901#4;
                 |GRABA 020#17n;
                 |LIBERA #17;
             |FINSI;
             aSubDepar     = ("000" + #17#2) % -103;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO Cultivo;
     |SI #903#41 ! "S";  |ACABA;  |FINSI;

     |QBT aCampo26;
     aSubDepar     = ("000" + aCampo26) % -103;

|FPRC;

|PROCESO SubDepartamento;
     aSubDepar     = "";
     |SI aTipoLibro = "R";
         |HAZ Arrendamiento;
         |SI aSubDepar = "";  |HAZ Cultivo;  |FINSI;
     |FINSI;
|FPRC;

|PROCESO PasaCajaZ;
   nSwCaja = 0;
   #921#0  = eEmpreCaja;
   #921#1  = enEjerCaja;
   #921#13 = aTipoIVA;
   #921#2  = eRegisCaja;
   #921#17 = eDevenCaja;
   |LEE 141#921=;
   |SI FSalida = 0;
       nSwCaja = 1;
   |FINSI;
   |LIBERA #921;

   |SI nSwCaja = 1;
       #501#17 = eDevenCaja;
       #501#0  = nLibro;
       #501#1  = eRegisCaja;
       |LEE 141#501=;
       |SI FSalida ! 0;
           |DDEFECTO #501;
           #501#17 = eDevenCaja;
           #501#0  = nLibro;
           #501#1  = eRegisCaja;
           |GRABA 020#501b;
       |FINSI;
       #501#3 = #921#3;
       #501#4 = #921#4;
       #501#5 = #921#5;
       #501#6 = #921#6;
       #501#7 = #921#7;
       #501#8 = #921#8;
       #501#9 = #921#9;
       #501#10 = #921#10;
       #501#11 = #921#11;
       #501#12 = #921#12;
       #501#13 = #921#13;
       #501#14 = #921#14;
       #501#15 = #921#15;
       #501#16 = #921#16;
       #501#17 = #921#17;
       #501#18 = -1;
       |SI #501#17 ! 0;
           #501#18 = #5#11 - 1;
           |SI #501#18 < 0; #501#18 = 9; |FINSI;
       |FINSI;
       |GRABA 020#501a;
       |LIBERA #501;
       enSwCaja123 = 1;
   |FINSI;
|FPRC;

|PROCESO LeoCamcc2;
   #502#17 = #501#17;
   #502#0  = #501#0;
   #502#1  = #501#1;
   #502#2  = #922#4; ||Linea de Cobro.
   |LEE 141#502=;
   |SI FSalida ! 0;
       |DDEFECTO #502;
       #502#17 = #501#17;
       #502#0  = #501#0;
       #502#1  = #501#1;
       #502#2  = #922#4;
       |GRABA 020#502b;
   |FINSI;
   #502#4  = #922#5;
   #502#7  = #922#7;
   #502#8  = #922#8;
   #502#9  = #922#9;
   #502#10 = #922#10;
   #502#11 = #922#11;
   #502#12 = #922#12;
   #502#13 = #922#13;
   #502#14 = #922#14;
   #502#15 = #922#15;
   #502#16 = #501#18;
   #502#18 = #922#36;
   |SI #502#18 = 0;  #501#18 = #501#16; |FINSI;
   |GRABA 020#502a;
   |LIBERA #502;

   Base = 0;
   |PARA nNume1 = 16; |SI nNume1 [ 33; |HACIENDO nNume1 = nNume1 + 3;
         Base = Base + 1;
         nNume2 = nNume1 + 1;
         nNume3 = nNume1 + 2;
         |SI #922nNume1 ! 0; |O #922nNume2 ! 0; |O #922nNume3 ! 0;
             #503#7 = #502#17;
             #503#0 = #502#0;
             #503#1 = #502#1;
             #503#2 = #502#2;
             #503#3 = Base;
             |LEE 141#503=;
             |SI FSalida ! 0;
                 |DDEFECTO #503;
                 #503#7 = #502#17;
                 #503#0 = #502#0;
                 #503#1 = #502#1;
                 #503#2 = #502#2;
                 #503#3 = Base;
                 |GRABA 020#503b;
             |FINSI;
             #503#4 = #922nNume1;
             #503#5 = #922nNume2;
             #503#6 = #922nNume3;
             |GRABA 020#503a;
             |LIBERA #503;
         |FINSI;
   |SIGUE;
|FPRC;

|DEFBUCLE LeoCamacc2;
   #922#1006;
   ;
   eEmpreCaja, enEjerCaja, aTipoIVA, eDevenCaja, eRegisCaja, 01;
   eEmpreCaja, enEjerCaja, aTipoIVA, eDevenCaja, eRegisCaja, 99;
   e;
   NULL, LeoCamcc2;
|FIN;

|PROCESO PasaCajaZLinea;
   |ABRE #502;
   |ABRE #503;
   |BUCLE LeoCamacc2;
   |CIERRA #503;
   |CIERRA #502;
|FPRC;
|| /////////////////////////////////////////////////////////

|PROCESO LasVentas;
     fFechaOp = "01.01.0000";
     aIdenti  = "";

     #903#0 = #900#0;
     #903#1 = #900#19;
     |LEE 040#903=;
     |SI FSalida ! 0;  |DDEFECTO #903;  |FINSI;

     aTipoLibro   = "R";
     fFecha       = #900#13;
     nRegistro    = #900#1;
     nCliente     = #900#3;
     nActividad   = #900#19;
     aSerie       = #900#15;  |QBF aSerie;
     nNumFacturas = #900#21;
     nLibro       = #5#7;
     aNombre      = #900#38;
     aNif         = #900#12;
     nTrimestre   = #900#17;
     |SI nNumCampos ] 78; aIdenti  = #900#78; |FINSI;
     |SI nNumCampos ] 79; fFechaOp = #900#79; |FINSI;

     |SI #5#12 = "C";  |O #900#16 = 0;
         aFactura = #900#6;
     |SINO;
         |SI aSerie = "";
             aFactura = (("000000" + #900#16) % -106) + " " + #900#6;
         |SINO;
             aFactura = aSerie + " " + (("000000" + #900#16) % -106) + " " + #900#6;
         |FINSI;
     |FINSI;

    nSwCaja = 0;
    |SI #900#14 ] 14;
        aTipoIVA    = "R";
        eEmpreCaja = #900#0;
        eRegisCaja = #900#1;
        enEjerCaja = #900#14;
        eDevenCaja = 0;
        |HAZ PasaCajaZ;
    |FINSI;
|| 1ж Linea

     nAcumulador  = 1;

     |SI #900#72 ! "      ";
         aConcepto = #900#72;
         |HAZ LeeConcepto93;
     |SINO;
         aConcepto = #900#5;
         |HAZ LeeConcepto94;
     |FINSI;

     |HAZ SubDepartamento;

     |SI #900#7 ! 0;
          nBase        = (#900#7 / nConversor) ! nRedondeo;

          nTotal1      = (#900#7  / nConversor) ! nRedondeo;
          nTotal2      = (#900#9  / nConversor) ! nRedondeo;
          nTotal3      = (#900#11 / nConversor) ! nRedondeo;
          nTotal4      = (#900#42 / nConversor) ! nRedondeo;
          nTotalFact   = nTotal1 + nTotal2 + nTotal3 - nTotal4;

          |HAZ Base;
          |HAZ Factura;

          |SI aCampo02 ! "N";
              |SI #900#9 ! 0;
                  aTipoIva  = "I";
                  nPorceIva = #900#8;
                  nTotalIva = (#900#9 / nConversor) ! nRedondeo;
                  |HAZ Iva;
              |FINSI;

              |SI #900#11 ! 0;
                  aTipoIva  = "R";
                  nPorceIva = #900#10;
                  nTotalIva = (#900#11 / nConversor) ! nRedondeo;
                  |HAZ Iva;
              |FINSI;

              |SI #900#42 ! 0;
                  nPorceIva = #900#39;
                  nTotalIva = (#900#42 / nConversor) ! nRedondeo;
                  |HAZ Retencion;
              |FINSI;
          |FINSI;
     |FINSI;

|| 2ж Linea

     nAcumulador  = 2;

     |SI #900#73 ! "      ";
         aConcepto = #900#73;
         |HAZ LeeConcepto93;
     |SINO;
         aConcepto = #900#33;
         |HAZ LeeConcepto94;
     |FINSI;

     |HAZ SubDepartamento;

     |SI #900#23 ! 0;
          nBase        = (#900#23 / nConversor) ! nRedondeo;

          nTotal1      = (#900#23  / nConversor) ! nRedondeo;
          nTotal2      = (#900#27  / nConversor) ! nRedondeo;
          nTotal3      = (#900#31  / nConversor) ! nRedondeo;
          nTotal4      = (#900#43  / nConversor) ! nRedondeo;
          nTotalFact   = nTotal1 + nTotal2 + nTotal3 - nTotal4;

          |HAZ Base;
          |HAZ Factura;

          |SI aCampo02 ! "N";
              |SI #900#27 ! 0;
                  aTipoIva  = "I";
                  nPorceIva = #900#25;
                  nTotalIva = (#900#27 / nConversor) ! nRedondeo;
                  |HAZ Iva;
              |FINSI;

              |SI #900#31 ! 0;
                  aTipoIva  = "R";
                  nPorceIva = #900#29;
                  nTotalIva = (#900#31 / nConversor) ! nRedondeo;
                  |HAZ Iva;
              |FINSI;

              |SI #900#43 ! 0;
                  nPorceIva = #900#40;
                  nTotalIva = (#900#43 / nConversor) ! nRedondeo;
                  |HAZ Retencion;
              |FINSI;
          |FINSI;
     |FINSI;

|| 3ж Linea

     nAcumulador  = 3;

     |SI #900#74 ! "      ";
         aConcepto = #900#74;
         |HAZ LeeConcepto93;
     |SINO;
         aConcepto = #900#34;
         |HAZ LeeConcepto94;
     |FINSI;

     |HAZ SubDepartamento;

     |SI #900#24 ! 0;
          nBase        = (#900#24 / nConversor) ! nRedondeo;

          nTotal1      = (#900#24  / nConversor) ! nRedondeo;
          nTotal2      = (#900#28  / nConversor) ! nRedondeo;
          nTotal3      = (#900#32  / nConversor) ! nRedondeo;
          nTotal4      = (#900#44  / nConversor) ! nRedondeo;
          nTotalFact   = nTotal1 + nTotal2 + nTotal3 - nTotal4;

          |HAZ Base;
          |HAZ Factura;

          |SI aCampo02 ! "N";
              |SI #900#28 ! 0;
                  aTipoIva  = "I";
                  nPorceIva = #900#26;
                  nTotalIva = (#900#28 / nConversor) ! nRedondeo;
                  |HAZ Iva;
              |FINSI;

              |SI #900#32 ! 0;
                  aTipoIva  = "R";
                  nPorceIva = #900#30;
                  nTotalIva = (#900#32 / nConversor) ! nRedondeo;
                  |HAZ Iva;
              |FINSI;

              |SI #900#44 ! 0;
                  nPorceIva = #900#41;
                  nTotalIva = (#900#44 / nConversor) ! nRedondeo;
                  |HAZ Retencion;
              |FINSI;
          |FINSI;
     |FINSI;

|| 4ж Linea

     nAcumulador  = 4;

     |SI #900#75 ! "      ";
         aConcepto = #900#75;
         |HAZ LeeConcepto93;
     |SINO;
         aConcepto = #900#60;
         |HAZ LeeConcepto94;
     |FINSI;

     |HAZ SubDepartamento;

     |SI #900#45 ! 0;
          nBase        = (#900#45 / nConversor) ! nRedondeo;

          nTotal1      = (#900#45  / nConversor) ! nRedondeo;
          nTotal2      = (#900#51  / nConversor) ! nRedondeo;
          nTotal3      = (#900#57  / nConversor) ! nRedondeo;
          nTotal4      = (#900#69  / nConversor) ! nRedondeo;
          nTotalFact   = nTotal1 + nTotal2 + nTotal3 - nTotal4;

          |HAZ Base;
          |HAZ Factura;

          |SI aCampo02 ! "N";
              |SI #900#51 ! 0;
                  aTipoIva  = "I";
                  nPorceIva = #900#48;
                  nTotalIva = (#900#51 / nConversor) ! nRedondeo;
                  |HAZ Iva;
              |FINSI;

              |SI #900#57 ! 0;
                  aTipoIva  = "R";
                  nPorceIva = #900#54;
                  nTotalIva = (#900#57 / nConversor) ! nRedondeo;
                  |HAZ Iva;
              |FINSI;

              |SI #900#69 ! 0;
                  nPorceIva = #900#66;
                  nTotalIva = (#900#69 / nConversor) ! nRedondeo;
                  |HAZ Retencion;
              |FINSI;
          |FINSI;
     |FINSI;

|| 5ж Linea

     nAcumulador  = 5;

     |SI #900#76 ! "      ";
         aConcepto = #900#76;
         |HAZ LeeConcepto93;
     |SINO;
         aConcepto = #900#61;
         |HAZ LeeConcepto94;
     |FINSI;

     |HAZ SubDepartamento;

     |SI #900#46 ! 0;
          nBase        = (#900#46 / nConversor) ! nRedondeo;

          nTotal1      = (#900#46  / nConversor) ! nRedondeo;
          nTotal2      = (#900#52  / nConversor) ! nRedondeo;
          nTotal3      = (#900#58  / nConversor) ! nRedondeo;
          nTotal4      = (#900#70  / nConversor) ! nRedondeo;
          nTotalFact   = nTotal1 + nTotal2 + nTotal3 - nTotal4;

          |HAZ Base;
          |HAZ Factura;

          |SI aCampo02 ! "N";
              |SI #900#52 ! 0;
                  aTipoIva  = "I";
                  nPorceIva = #900#49;
                  nTotalIva = (#900#52 / nConversor) ! nRedondeo;
                  |HAZ Iva;
              |FINSI;

              |SI #900#58 ! 0;
                  aTipoIva  = "R";
                  nPorceIva = #900#55;
                  nTotalIva = (#900#58 / nConversor) ! nRedondeo;
                  |HAZ Iva;
              |FINSI;

              |SI #900#70 ! 0;
                  nPorceIva = #900#67;
                  nTotalIva = (#900#70 / nConversor) ! nRedondeo;
                  |HAZ Retencion;
              |FINSI;
          |FINSI;
     |FINSI;

|| 6ж Linea

     nAcumulador  = 6;

     |SI #900#77 ! "      ";
         aConcepto = #900#77;
         |HAZ LeeConcepto93;
     |SINO;
         aConcepto = #900#62;
         |HAZ LeeConcepto94;
     |FINSI;

     |HAZ SubDepartamento;

     |SI #900#47 ! 0;
          nBase        = (#900#47 / nConversor) ! nRedondeo;

          nTotal1      = (#900#47  / nConversor) ! nRedondeo;
          nTotal2      = (#900#53  / nConversor) ! nRedondeo;
          nTotal3      = (#900#59  / nConversor) ! nRedondeo;
          nTotal4      = (#900#71  / nConversor) ! nRedondeo;
          nTotalFact   = nTotal1 + nTotal2 + nTotal3 - nTotal4;

          |HAZ Base;
          |HAZ Factura;

          |SI aCampo02 ! "N";
              |SI #900#53 ! 0;
                  aTipoIva  = "I";
                  nPorceIva = #900#50;
                  nTotalIva = (#900#53 / nConversor) ! nRedondeo;
                  |HAZ Iva;
              |FINSI;

              |SI #900#59 ! 0;
                  aTipoIva  = "R";
                  nPorceIva = #900#56;
                  nTotalIva = (#900#59 / nConversor) ! nRedondeo;
                  |HAZ Iva;
              |FINSI;

              |SI #900#71 ! 0;
                  nPorceIva = #900#68;
                  nTotalIva = (#900#71 / nConversor) ! nRedondeo;
                  |HAZ Retencion;
              |FINSI;
          |FINSI;
     |FINSI;

     |SI nSwCaja = 1; |HAZ PasaCajaZLinea; |FINSI;
|FPRC;

|DEFBUCLE eoslinve;
     #900#1003;
     ;
     #91#5, #5#0, 00001;
     #91#5, #5#0, 32000;
     ;
     NULL, LasVentas;
|FIN;

|PROCESO LasCompras;
     fFechaOp      = "01.01.0000";
     aIdenti       = "";

     aTipoLibro    = "S";
     fFecha        = #900#13;
     nRegistro     = #900#1;
     nCliente      = #900#3;
     nActividad    = #900#19;
     aSubDepar     = "";
     aSerie        = #900#15;   |QBF aSerie;
     nNumFacturas  = #900#21;
     nLibro        = #5#9;
     aNombre       = #900#38;
     aNif          = #900#12;
     nTrimestre    = #900#17;
     |SI nNumCampos ] 79; fFechaOp = #900#79; |FINSI;

     |SI #5#12 = "C";  |O #900#16 = 0;
         aFactura = #900#6;
     |SINO;
         |SI aSerie = "";
             aFactura = (("000000" + #900#16) % -106) + " " + #900#6;
         |SINO;
             aFactura = aSerie + " " + (("000000" + #900#16) % -106) + " " + #900#6;
         |FINSI;
     |FINSI;

|| 1ж Linea

     |SI #900#7 ! 0;
         |SI #900#72 ! "      ";
             aConcepto = #900#72;
             |HAZ LeeConcepto93;
          |SINO;
             aConcepto = #900#5;
             |HAZ LeeConcepto94;
          |FINSI;

          nAcumulador  = 1;
          nBase        = (#900#7 / nConversor) ! nRedondeo;

          nTotal1      = (#900#7   / nConversor) ! nRedondeo;
          nTotal2      = (#900#9   / nConversor) ! nRedondeo;
          nTotal3      = (#900#11  / nConversor) ! nRedondeo;
          nTotal4      = (#900#42  / nConversor) ! nRedondeo;
          nTotalFact   = nTotal1 + nTotal2 + nTotal3 - nTotal4;

          |HAZ Base;
          |HAZ Factura;

          |SI aCampo02 ! "N";
              |SI #900#9 ! 0;
                  aTipoIva  = "I";
                  nPorceIva = #900#8;
                  nTotalIva = (#900#9 / nConversor) ! nRedondeo;
                  |HAZ Iva;
              |FINSI;

              |SI #900#11 ! 0;
                  aTipoIva  = "R";
                  nPorceIva = #900#10;
                  nTotalIva = (#900#11 / nConversor) ! nRedondeo;
                  |HAZ Iva;
              |FINSI;

              |SI #900#42 ! 0;
                  nPorceIva = #900#39;
                  nTotalIva = (#900#42 / nConversor) ! nRedondeo;
                  |HAZ Retencion;
              |FINSI;
          |FINSI;
     |FINSI;

|| 2ж Linea

     |SI #900#23 ! 0;
         |SI #900#73 ! "      ";
             aConcepto = #900#73;
             |HAZ LeeConcepto93;
          |SINO;
             aConcepto = #900#33;
             |HAZ LeeConcepto94;
          |FINSI;

          nAcumulador  = 2;
          nBase        = (#900#23 / nConversor) ! nRedondeo;

          nTotal1      = (#900#23  / nConversor) ! nRedondeo;
          nTotal2      = (#900#27  / nConversor) ! nRedondeo;
          nTotal3      = (#900#31  / nConversor) ! nRedondeo;
          nTotal4      = (#900#43  / nConversor) ! nRedondeo;
          nTotalFact   = nTotal1 + nTotal2 + nTotal3 - nTotal4;

          |HAZ Base;
          |HAZ Factura;

          |SI aCampo02 ! "N";
              |SI #900#27 ! 0;
                  aTipoIva  = "I";
                  nPorceIva = #900#25;
                  nTotalIva = (#900#27 / nConversor) ! nRedondeo;
                  |HAZ Iva;
              |FINSI;

              |SI #900#31 ! 0;
                  aTipoIva  = "R";
                  nPorceIva = #900#29;
                  nTotalIva = (#900#31 / nConversor) ! nRedondeo;
                  |HAZ Iva;
              |FINSI;

              |SI #900#43 ! 0;
                  nPorceIva = #900#40;
                  nTotalIva = (#900#43 / nConversor) ! nRedondeo;
                  |HAZ Retencion;
              |FINSI;
          |FINSI;
     |FINSI;

|| 3ж Linea

     |SI #900#24 ! 0;
         |SI #900#74 ! "      ";
             aConcepto = #900#74;
             |HAZ LeeConcepto93;
          |SINO;
             aConcepto = #900#34;
             |HAZ LeeConcepto94;
          |FINSI;

          nAcumulador  = 3;
          nBase        = (#900#24 / nConversor) ! nRedondeo;

          nTotal1      = (#900#24  / nConversor) ! nRedondeo;
          nTotal2      = (#900#28  / nConversor) ! nRedondeo;
          nTotal3      = (#900#32  / nConversor) ! nRedondeo;
          nTotal4      = (#900#44  / nConversor) ! nRedondeo;
          nTotalFact   = nTotal1 + nTotal2 + nTotal3 - nTotal4;

          |HAZ Base;
          |HAZ Factura;

          |SI aCampo02 ! "N";
              |SI #900#28 ! 0;
                  aTipoIva  = "I";
                  nPorceIva = #900#26;
                  nTotalIva = (#900#28 / nConversor) ! nRedondeo;
                  |HAZ Iva;
              |FINSI;

              |SI #900#32 ! 0;
                  aTipoIva  = "R";
                  nPorceIva = #900#30;
                  nTotalIva = (#900#32 / nConversor) ! nRedondeo;
                  |HAZ Iva;
              |FINSI;

              |SI #900#44 ! 0;
                  nPorceIva = #900#41;
                  nTotalIva = (#900#44 / nConversor) ! nRedondeo;
                  |HAZ Retencion;
              |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE eoslinco;
     #900#1003;
     ;
     #91#5, #5#0, 00001;
     #91#5, #5#0, 32000;
     ;
     NULL, LasCompras;
|FIN;

|PROCESO LeeCalendarios;
 #213#0 = #900#0;
 |LEE 001#213=;
 |SI FSalida ! 0;
     |DDEFECTO #213;
     #213#0 = #900#0;
     |GRABA 020#213c;
 |FINSI;
 |PARA nNume1 = 1; |SI nNume1 [ nNumCampos; |HACIENDO nNume1 = nNume1 + 1;
       #213nNume1 = #900nNume1;
 |SIGUE;
 |GRABA 020#213a;
|FPRC;

|DEFBUCLE LeeCalendarios;
     #900#1001;
     ;
     01;
     99;
     ;
     NULL, LeeCalendarios;
|FIN;

|PROCESO Pasando;
     nLinea          = 0;
     aDirFichDestino = aPathDestino + "fich/";
     aDef            = aPathDestino + "def/canempre";
     |CARGA_DEF aDef, refer00@;
     |SI FSalida ! 0;
         |MENAV "     Error en Cargar el Def canempre.mas";
         |ACABA;
     |FINSI;

     aDef = eaPathBasica + "def/agifigen.mas";
     |CARGA_DEF aDef, refer01@;
     |SI FSalida ! 0;
         |DESCARGA_DEF #refer00@;
         |ACABA;
     |FINSI;

     |PATH_DAT #900 aDirFichDestino;

     |ABRE #900;
     #900#2 = #91#1;
     #900#3 = #5#11;
     |LEE 040#900=;
     |SI FSalida ! 0;
         |ABRE #901;
         |HAZ CreaEmpresa;
         |CIERRA #901;
     |FINSI;
     |CIERRA #900;

     |ABRE #201;
     #201#0 = #900#2;
     #201#1 = #900#3;
     |LEE 101#201=;
     |SI FSalida ! 0;
         |DDEFECTO #201;
         #201#0 = #900#2;
         #201#1 = #900#3;
         #201#2 = #900#28;
         |GRABA 020#201n;
     |FINSI;
     |LIBERA #201;
     |CIERRA #201;

     nConversor = 1;
     nRedondeo  = 2;
     |SI #201#2 = "P";  nRedondeo = 0;  |FINSI;

     |SI aMonedaAgieos = "E";
         |SI #201#2 = "P";
             nConversor = 0.00601012;
             nRedondeo  = 0;
         |FINSI;
     |SINO;
         |SI #201#2 = "E";
             nConversor = 166.386;
             nRedondeo  = 2;
         |FINSI;
     |FINSI;

     nDig1 = #900#11;       || desde mes
     nDig3 = #900#13;       || nro. niveles
     nDig4 = #900#14;       || 1 nivel
     nDig5 = #900#15;       || 2 nivel
     nDig6 = #900#16;       || 3 nivel
     nDig7 = #900#17;       || 4 nivel
     nDig8 = #900#18;       || 5 nivel
     nDig9 = #900#19;       || 6 nivel

     |DESCARGA_DEF #refer01@;
     |DESCARGA_DEF #refer00@;

     enTipoAct  = 5;
     eaFAsiento = ("123" + Usuario) % 108;
     |NOME_DAT #123 eaFAsiento;
     |PATH_DAT #123 eaPathDsmodelo;
     |DELINDEX #123;

     aFichero = ("1c" + Usuario) % 108;
     |NOME_DAT #501 aFichero;
     |PATH_DAT #501 eaPathDsmodelo;
     |DELINDEX #501;

     aFichero = ("2l" + Usuario) % 108;
     |NOME_DAT #502 aFichero;
     |PATH_DAT #502 eaPathDsmodelo;
     |DELINDEX #502;

     aFichero = ("3d" + Usuario) % 108;
     |NOME_DAT #503 aFichero;
     |PATH_DAT #503 eaPathDsmodelo;
     |DELINDEX #503;

     enSwCaja123 = 0;

     aDef = aPathDefFiscal + "eosmcc01.mas";
     |CARGA_DEF aDef, refer21@;
     |SI FSalida ! 0;
         |MENAV "     Error en Cargar el Def eoscc01.mas";
         |ACABA;
     |FINSI;

     aDef = aPathDefFiscal + "eosmcc02.mas";
     |CARGA_DEF aDef, refer22@;
     |SI FSalida ! 0;
         |DESCARGA_DEF #refer21@;
         |MENAV "     Error en Cargar el Def eoscc01.mas";
         |ACABA;
     |FINSI;

     aDef = aPathDefFiscal + "eosconce.mas";
     |CARGA_DEF aDef, refer12@;
     |SI FSalida ! 0;
         |DESCARGA_DEF #refer22@;
         |DESCARGA_DEF #refer21@;
         |MENAV "     Error en Cargar el Def eosconce.mas";
         |ACABA;
     |FINSI;

     aDef = aPathDefFiscal + "eosconc6.mas";
     |CARGA_DEF aDef, refer13@;
     |SI FSalida ! 0;
         |DESCARGA_DEF #refer12@;
         |DESCARGA_DEF #refer22@;
         |DESCARGA_DEF #refer21@;
         |MENAV "     Error en Cargar el Def eosconc6.mas";
         |ACABA;
     |FINSI;

     aDef = aPathDefFiscal + "eoslinve.mas";
     |CARGA_DEF aDef, refer00@;
     |SI FSalida ! 0;
         |DESCARGA_DEF #refer13@;
         |DESCARGA_DEF #refer12@;
         |DESCARGA_DEF #refer22@;
         |DESCARGA_DEF #refer21@;
         |MENAV "     Error en Cargar el Def eoslinve.mas";
         |ACABA;
     |FINSI;

     aDef = aPathDefFiscal + "eosm0011.mas";
     |CARGA_DEF aDef, refer01@;
     |SI FSalida ! 0;
         |DESCARGA_DEF #refer00@;
         |DESCARGA_DEF #refer13@;
         |DESCARGA_DEF #refer12@;
         |DESCARGA_DEF #refer22@;
         |DESCARGA_DEF #refer21@;
         |MENAV "     Error en Cargar el Def eosm0011.mas";
         |ACABA;
     |FINSI;

     aDef = aPathDefFiscal + "eosm0012.mas";
     |CARGA_DEF aDef, refer02@;
     |SI FSalida ! 0;
         |DESCARGA_DEF #refer01@;
         |DESCARGA_DEF #refer00@;
         |DESCARGA_DEF #refer13@;
         |DESCARGA_DEF #refer12@;
         |DESCARGA_DEF #refer22@;
         |DESCARGA_DEF #refer21@;
         |MENAV "     Error en Cargar el Def eosm0012.mas";
         |ACABA;
     |FINSI;

     aDef = aPathDefFiscal + "eosactiv.mas";
     |CARGA_DEF aDef, refer03@;
     |SI FSalida ! 0;
         |DESCARGA_DEF #refer02@;
         |DESCARGA_DEF #refer01@;
         |DESCARGA_DEF #refer00@;
         |DESCARGA_DEF #refer13@;
         |DESCARGA_DEF #refer12@;
         |DESCARGA_DEF #refer22@;
         |DESCARGA_DEF #refer21@;
         |MENAV "     Error en Cargar el Def eosactiv.mas";
         |ACABA;
     |FINSI;

     aFichero = "v" + (("00000" + #91#5) % -105) + (("00" + #5#0) % -102);
     |NOME_DAT #900 aFichero;
     |PATH_DAT #900 aPathFichFiscal;

     aFichero = "f" + (("00000" + #91#5) % -105) + (("00" + #5#0) % -102);
     |NOME_DAT #921 aFichero;
     |PATH_DAT #921 aPathFichFiscal;

     aFichero = "m" + (("00000" + #91#5) % -105) + (("00" + #5#0) % -102);
     |NOME_DAT #922 aFichero;
     |PATH_DAT #922 aPathFichFiscal;

     |PATH_DAT #901 aPathFichFiscal;
     |PATH_DAT #902 aPathFichFiscal;
     |PATH_DAT #903 aPathFichFiscal;
     |PATH_DAT #912 aPathFichFiscal;
     |PATH_DAT #913 aPathFichFiscal;

     aQueQuiero = "|NC";
     aNumCampos = #refer00@#aQueQuiero#;
     nNumCampos = aNumCampos;
     nNumCampos = nNumCampos - 1;

     |ABRE #123;
     |ABRE #93;
     |ABRE #94;
     |ABRE #17;
     |ABRE #901;
     |ABRE #902;
     |ABRE #903;
     |ABRE #912;
     |ABRE #913;
     |ABRE #921;
     |ABRE #501;

     |BUCLE eoslinve;

     |CIERRA #17;
     |CIERRA #901;
     |CIERRA #902;
     |CIERRA #903;

     |DESCARGA_DEF #refer03@;
     |DESCARGA_DEF #refer02@;
     |DESCARGA_DEF #refer01@;
     |DESCARGA_DEF #refer00@;

     aDef = aPathDefFiscal + "eoslinco.mas";
     |CARGA_DEF aDef, refer00@;
     |SI FSalida ! 0;
         |DESCARGA_DEF #refer13@;
         |DESCARGA_DEF #refer12@;
         |DESCARGA_DEF #refer22@;
         |CIERRA #921; |DESCARGA_DEF #refer21@;
         |MENAV "     Error en Cargar el Def eoslinco.mas";
         |ACABA;
     |FINSI;

     aFichero = "c" + (("00000" + #91#5) % -105) + (("00" + #5#0) % -102);
     |NOME_DAT #900 aFichero;
     |PATH_DAT #900 aPathFichFiscal;

     aQueQuiero = "|NC";
     aNumCampos = #refer00@#aQueQuiero#;
     nNumCampos = aNumCampos;
     nNumCampos = nNumCampos - 1;

     |BUCLE eoslinco;

     |DESCARGA_DEF #refer00@;
/* aqui
     |SI #5#0 ] 15;
         |BUCLE Lee501;
     |FINSI;
*/

     |CIERRA #913; |DESCARGA_DEF #refer13@;
     |CIERRA #912; |DESCARGA_DEF #refer12@;
                   |DESCARGA_DEF #refer22@;
     |CIERRA #921; |DESCARGA_DEF #refer21@;

     |CIERRA #501;
     |CIERRA #93;
     |CIERRA #94;
     |CIERRA #123;

     enTipoEos   = 1;  ||desde libros
     enEmpresa   = #91#1;
     enPerConta  = #5#11;
     eaNombreEmp = #91#2;
     enDesdeOtra = 1;
     swSinCheq   = 2;
     enEmprEos   = #91#5;
     eaEmprEos   = #91#2;
     |SUB_EJECUTA ":modelos/dsmoz123";

     enEmpresa   = #91#1;
     enPerConta  = #5#11;
     enEmprEos   = #91#5;
     |SUB_EJECUTA "dspase08";

|| ... Pasar Calendarios Ventas Automaticas EOS
     aDirEmpresa      = (("00000" + #91#1) % -105) + #91#0 + "/";
     aDirFichDestino = aPathDestino + "fich/" + aDirEmpresa;
     |PATH_DAT #213 aDirFichDestino;

     aDef = aPathDefFiscal + "eosfical.mas";
     |CARGA_DEF aDef, refer00@;
     |SI FSalida ! 0;
         |MENAV "     Error en Cargar el Def eosfical.mas. No pasa Calendarios Ventas Automatica";
     |SINO;
         |PATH_DAT #900 aPathFichFiscal;

         aQueQuiero = "|NC";
         aNumCampos = #refer00@#aQueQuiero#;
         nNumCampos = aNumCampos;
         nNumCampos = nNumCampos - 1;
         |ABRE #213;
         |BUCLE LeeCalendarios;
         |CIERRA #213;
         |DESCARGA_DEF #refer00@;
     |FINSI;

|| ///////////////////////////////////////////////////////////////////////

     |ABRE #92;
     #92#0 = #91#0;
     #92#1 = #91#1;
     #92#2 = #91#2;
     #92#3 = 0;
     #92#4 = #91#5;
     |GRABA 020#92n;
     |LIBERA #92;
     |CIERRA #92;

     |BORRA 020#91a;
     |LIBERA #91;

     |HAZ Tipo13;
|FPRC;

|DEFBUCLE dspase91;
     #91#1;
     3;
     #5#0, 00000, 0, "S";
     #5#0, 99999, 0, "S";
     be;
     NULL, Pasando;
|FIN;

|PROCESO BuscaAgicont;
   aPathAgicont = "";
   aAlfa = aPathAnterior + "agicont/def/canempre.mas";
   |XABRE "E", aAlfa, nNume1;
   |SI FSalida ] 0;
        aPathAgicont = aPathAnterior + "agicont/";
   |FINSI;
|FPRC;

|PROCESO Tipo12;  |TIPO 12;
     |SI FSalida = 7;
         |ACABA;
     |FINSI;

     aDef = aPathDefFiscal + "eoscabve.mas";
     |CARGA_DEF aDef, refer00@;
     |SI FSalida ! 0;
         |MENAV "     Error en Cargar el Def eoscabve.mas";
         |ACABA;
     |FINSI;

     aDef = aPathDefFiscal + "eoslinve.mas";
     |CARGA_DEF aDef, refer01@;
     |SI FSalida ! 0;
         |MENAV "     Error en Cargar el Def eoslinve.mas";
         |DESCARGA_DEF #refer00@;
         |ACABA;
     |FINSI;

     |HAZ BuscaAgicont;

     |PATH_DAT #900 aPathFichFiscal;

     |NOME_DAT #91 "pase0591";
     |NOME_DAT #92 "pase0592";

     |ABRE #91;
     |ABRE #92;
     |ABRE #200;

     |BUCLE eoscabve;

     |DESCARGA_DEF #refer01@;
     |DESCARGA_DEF #refer00@;

     aDef = aPathDefFiscal + "eoscabco.mas";
     |CARGA_DEF aDef, refer00@;
     |SI FSalida ! 0;
         |MENAV "     Error en Cargar el Def eoscabco.mas";
         |ACABA;
     |FINSI;

     aDef = aPathDefFiscal + "eoslinco.mas";
     |CARGA_DEF aDef, refer01@;
     |SI FSalida ! 0;
         |MENAV "     Error en Cargar el Def eoslinco.mas";
         |DESCARGA_DEF #refer00@;
         |ACABA;
     |FINSI;

     |PATH_DAT #900 aPathFichFiscal;

     |BUCLE eoscabco;
     |CIERRA #91;
     |CIERRA #92;
     |CIERRA #200;

     |DESCARGA_DEF #refer01@;
     |DESCARGA_DEF #refer00@;

     |SI #5#13 = "S";
         |HAZ CargaEspecial;
     |FINSI;

     |ENTLINEAL #1#92, -2, 7, 22, 0, ClaveBaja92, ClaveAlta92;
     |ENTLINEAL #1#91, -2, 4, 22, 0, ClaveBaja91, ClaveAlta91;

     |CONFI "    SRealizamos el pase en estos Momentos";
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     aDef = eaPathAgitool + "def/zmonedas.mas";
     |CARGA_DEF aDef, refer00@;
     |SI FSalida ! 0;
         aMonedaAgieos = "E";
     |SINO;
         |PATH_DAT #900 aPathFichFiscal;
         |ABRE #900;
         |LEE 040#900p;
         |SI FSalida ! 0;  |DDEFECTO #900;  |FINSI;
         |CIERRA #900;

         aMonedaAgieos = #900#1;

         |DESCARGA_DEF #refer00@;
     |FINSI;

     |DBASE aBase;  |QBF aBase;
     aPathPases = aBase + "pases";  |MKDIR aPathPases;
     aPathPases = aPathPases + "/";

     |PATH_DAT #93 aPathPases;
     |PATH_DAT #94 aPathPases;

     |ABRE #93;
     |LEE 040#93p;
     |SI FSalida ! 0;
         |CIERRA #93;
         aOrigen  = aBase + "fich/dspase93.dat";
         aDestino = aPathPases + "dspase93.dat";
         |COPIA_FICHERO aOrigen, aDestino;
     |FINSI;
     |CIERRA #93;

     |ABRE #94;
     |LEE 040#94p;
     |SI FSalida ! 0;
         |CIERRA #94;
         aOrigen  = aBase + "fich/dspase94.dat";
         aDestino = aPathPases + "dspase94.dat";
         |COPIA_FICHERO aOrigen, aDestino;
     |FINSI;
     |CIERRA #94;

     |BUCLE dspase91;
|FPRC;

|PROCESO CargaTempoE;
     |SI nEstaCambio = 1;
         nCodigoNue = 0;
         nCodigoReo = #911#0;
         |BUCLE dspase15;
         |SI nCodigoNue = 0;  |ACABA;  |FINSI;
     |SINO;
         nCodigoNue = #911#0;
     |FINSI;

     #91#0 = #5#0;
     #91#1 = nCodigoNue;
     #91#4 = 0;
     |LEE 040#91=;
     |SI FSalida = 0;  |ACABA;  |FINSI;

     #200#2 = nCodigoNue;
     #200#3 = #5#11;
     |LEE 040#200=;
     |SI FSalida = 0;
         #92#0 = #0#0;
         #92#1 = nCodigoNue;
         #92#3 = 0;
         |LEE 040#92=;
         |SI FSalida = 0;  |ACABA;  |FINSI;
     |SINO;
         #92#0 = #0#0;
         #92#1 = nCodigoNue;
         #92#3 = 0;
         |LEE 101#92=;
         |SI FSalida = 0;
             |BORRA 020#92a;
         |FINSI;
         |LIBERA #92;
     |FINSI;

     #91#0 = #5#0;
     #91#1 = nCodigoNue;
     #91#2 = #911#2;
     #91#3 = "N";
     #91#4 = 0;
     #91#5 = #911#0;
     |GRABA 020#91n;
     |LIBERA #91;
|FPRC;

|DEFBUCLE eosclien;
     #911#1001;
     ;
     00000;
     99999;
     ;
     NULL, CargaTempoE;
|FIN;

|PROCESO CargaEspecial;
     aDef = aPathDefFiscal + "eosclien.mas";
     |CARGA_DEF aDef, refer11@;
     |SI FSalida ! 0;
         |MENAV "     Error en Cargar el Def eosclien.mas";
         |ACABA;
     |FINSI;

     |PATH_DAT #911 aPathFichFiscal;

     |ABRE #91;
     |ABRE #92;
     |ABRE #200;

     |BUCLE eosclien;

     |CIERRA #91;
     |CIERRA #92;
     |CIERRA #200;

     |DESCARGA_DEF #refer11@;
|FPRC;
