|FICHEROS;
     agim0007 #0;        || Este Def
     agifigen #1;        || Ficha de Clientes
     agim0019 #3;        || Ficha de Sociedades
     :/integral/def/dsam0005 #205;
|FIN;

|VARIABLES;
    Modo        = 0;
    Empresa     = 0;
    Fecha       = @;

    Viene   = 0;
    Cadena  = "";
    Cadena1 = "";
    Cadena2 = "";
    Cadena3 = "";

    Blanco1  = 0;
    Blanco2  = 0;
    Coma     = 0;
    XPara      = 0;
    Posi     = 0;
    Caracter = "";
    Contador = 0;
    LongAlfa = "";
    LongNume = 0;
    ParaQuitar = "";

    &acabalo  = 0;
    &empresa  = 0;
    &efFecha  = @;
    aAlfa     = "";
    nNume1    = 0;
    nDSocial  = 0;
    &eaPathIntegral = "";
|FIN;

|CALCULO Honorarios;
    nNume1 = Contenido;
    |SI nNume1 ! #0Campo;
        |SI Campo < 70;
            #0#70 = #0#68 % #0#69; |PINTA #0#70;
        |FINSI;
        |SI Campo = 68; |O Campo = 71;
            #0#72 = #0#68 % #0#71; |PINTA #0#72;
        |FINSI;
        #0#73 = #0#68 + #0#70 - #0#72;
    |FINSI;
|FCAL;

|PROCESO NombreRepre2;
     |HAZ LeeNifs;     || Esto no haze n  pero quien lo toque
                       || los corto lo guevos  PARAQUITAR
|FPRC;

|PROCESO Mayor;
     #0Campo = #0Campo > #0Campo;
     |PINTA #0Campo;
|FPRC;

|PROCESO RecogeDatos;
     Modo = (FEntrada / 100) ! 0;
     |SI Modo ! 1; |ACABA; |FINSI;

     Empresa = #0#0;
     Fecha   = #0#1;

     #0#0 = Empresa;
     #0#1 = "31.12.9999";
     |LEE 000#0];
     |SI FSalida = 0;
         |LEE 000#0a;
     |SINO;
         |LEE 000#0u;
     |FINSI;

     |SI FSalida = 0;|Y #0#0 = Empresa;
         #0#0 = Empresa;
         #0#1 = Fecha;
         |PDEFECTO #0, 17, 65;
                       || |HAZ LeeFicha1;
         |HAZ LeeFicha;
         |PINDA #0#0;
     |SINO;
         |DDEFECTO #0;
         #0#0 = Empresa;
         #0#1 = Fecha;
         |HAZ LeeFicha;
     |FINSI;
|FPRC;

|PROCESO LeeFicha1;
     |ABRE #1;
     #1#0 = #0#0;
     |LEE 000#1=;
     |SI FSalida ! 0; |DDEFECTO #1; |FINSI;
     |CIERRA #1;

     |ABRE #3;
     #3#0 = #0#0;
     #3#1 = 99;
     |LEE 000#3];
     |SI FSalida = 0;
         |LEE 000#3a;
     |SINO;
         |LEE 000#3u;
     |FINSI;

     |SI FSalida = 0;|Y #3#0 = #0#0;
         #0#12 = #3#29;                |PINTA #0#12;   || Tomo
         #0#13 = #3#30;                |PINTA #0#13;   || Libro
         #0#14 = #3#31;                |PINTA #0#14;   || Seccion
         #0#15 = #3#32;                |PINTA #0#15;   || Folio
         #0#16 = #3#33;                |PINTA #0#16;   || Hoja
     |FINSI;

     |CIERRA #3;
|FPRC;

|PROCESO LeeFicha;
     nDSocial = 0;
     |ABRE #1;
     #1#0 = #0#0;
     |LEE 000#1=;
     |SI FSalida ! 0; |DDEFECTO #1; |FINSI;
     |CIERRA #1;

     |SI eaPathIntegral ! "";
         |ABRE #205;
         #205#0 = #0#0;
         #205#1 = 97;
         |LEE 041#205=;
         |SI FSalida = 0;
             nDSocial = 1;
         |FINSI;
         |CIERRA #205;
     |FINSI;

     Cadena = #1#2; |HAZ SeparaNombre;
     #0#2  = #1#13;                             |PINTA #0#2;    || NIF
     #0#3  = #1#14;                             |PINTA #0#3;    || Telefono
     #0#4  = Cadena1;                           |PINTA #0#4;    || Apellido 1
     #0#5  = Cadena2;                           |PINTA #0#5;    || Apellido 2
     #0#6  = Cadena3;                           |PINTA #0#6;    || Nombre
     #0#8  = #1#1;                              |PINTA #0#8;    || Razon Social
     #0#10 = #1#13;                             |PINTA #0#10;   || NIF
     #0#11 = #1#14;                             |PINTA #0#11;   || Telefono
     |SI nDSocial = 0;
         #0#7  = #1#03 + " " + #1#04 + " " + #1#05; |PINTA #0#7;    || Domicilio
         #0#9  = #1#41 + " " + #1#42 + " " + #1#43; |PINTA #0#9;    || Domicilio
     |SINO;
         aAlfa = #205#3; |QBF aAlfa; |SI aAlfa ! ""; aAlfa = aAlfa + " "; |FINSI;
         #0#7  = aAlfa + #205#4 + " " + #205#5;     |PINTA #0#7;    || Domicilio
         #0#9  = aAlfa + #205#4 + " " + #205#5;     |PINTA #0#9;    || Domicilio
     |FINSI;

     |ABRE #3;
     #3#0 = #0#0;
     #3#1 = 99;
     |LEE 000#3];
     |SI FSalida = 0;
         |LEE 000#3a;
     |SINO;
         |LEE 000#3u;
     |FINSI;

     |SI FSalida = 0;|Y #3#0 = #0#0;
         #0#12 = #3#29;                |PINTA #0#12;   || Tomo
         #0#13 = #3#30;                |PINTA #0#13;   || Libro
         #0#14 = #3#31;                |PINTA #0#14;   || Seccion
         #0#15 = #3#32;                |PINTA #0#15;   || Folio
         #0#16 = #3#33;                |PINTA #0#16;   || Hoja
     |SINO;
         #0#8  = ""; |PINTA #0#8;
         #0#9  = ""; |PINTA #0#9;
         #0#10 = ""; |PINTA #0#10;
         #0#11 = ""; |PINTA #0#11;
     |FINSI;

     |CIERRA #3;
|FPRC;

|PROCESO SeparaNombre;
     || Busca una coma en la cadena

     Cadena1 = "";
     Cadena2 = "";
     Cadena3 = "";

     Blanco1 = 0;
     Blanco2 = 0;
     Coma    = 0;

     |PARA XPara = 1; |SI XPara [ 40; |HACIENDO XPara = XPara + 1;
           Posi = XPara * 100 + 1;
           Caracter = Cadena % Posi;

           |SI Caracter = ","; Coma = XPara; |SAL; |FINSI;
     |SIGUE;

     |SI Coma = 0;
         || Si no hay coma busca el primer blanco empezando por detras

         LongAlfa = Cadena % 0;
         LongNume = LongAlfa;

         |PARA XPara = LongNume; |SI XPara ] 1; |HACIENDO XPara = XPara - 1;
               Posi = XPara * 100 + 1;
               Caracter = Cadena % Posi;
               |SI Caracter = " "; Coma = XPara; |SAL; |FINSI;
         |SIGUE;
     |FINSI;

     || Coge los dos primeros caracteres del segundo apellido

     Blanco1  = Coma - 1;
     Posi     = Blanco1 + 100;
     Cadena2  = Cadena % Posi;
     LongAlfa = Cadena2 % 0;
     LongNume = LongAlfa;

     |PARA XPara = LongNume; |SI XPara ] 1; |HACIENDO XPara = XPara - 1;
           Posi = XPara * 100 + 1;
           Caracter = Cadena2 % Posi;
           |SI Caracter = " "; Blanco1 = XPara; |SAL; |FINSI;
     |SIGUE;

     Blanco1 = Blanco1 + 1;
     Posi    = Blanco1 * 100 + LongNume;
     Cadena2 = Cadena2 % Posi;

     || Coge las dos primeros caracteres del primer apellido

     Blanco1 = Blanco1 - 1;
     Posi    = 100 + Blanco1;
     Cadena1 = Cadena % Posi;

     || Recoge los dos primero caracteres de Nombre

     Posi    = ((Coma + 1) * 100) + 40;
     Cadena3 = Cadena % Posi;

     ParaQuitar = Cadena1; |HAZ QuitaBlanco; Cadena1 = ParaQuitar;
     ParaQuitar = Cadena2; |HAZ QuitaBlanco; Cadena2 = ParaQuitar;
     ParaQuitar = Cadena3; |HAZ QuitaBlanco; Cadena3 = ParaQuitar;
|FPRC;

|PROCESO QuitaBlanco;
     |ET Cadena;
         |QBF ParaQuitar;
         |SI ParaQuitar ! "";
             Caracter = ParaQuitar % 101;
             |SI Caracter = " ";
                 ParaQuitar = ParaQuitar % 240;
                 |VETE Cadena;
             |FINSI;
         |FINSI;
|FPRC;

|PROCESO Tipo3;  |TIPO 3;
     |SI acabalo = 0;  |ACABA;  |FINSI;

     |PTEC 807;
     |PTEC 807;
|FPRC;

|PROGRAMA;
    |HAZ BusquedaApli;

    |SI acabalo  = 1;
        |ABRE #0;
        #0#0 = empresa;
        #0#1 = efFecha;

        |PINPA #0#0;
        |PINDA #0#0;
        FEntrada = 101;
        |HAZ RecogeDatos;

        |GRABA 020#0n;

        |CIERRA #0;

        |ACABA;
    |FINSI;

    |MANTE #0;
|FPRO;
