|FICHEROS;
     dspasf00;
     dspase00;
     dspasf03;
     dspase03;
     dspase15;
     dspase25;
     dspase99;
     agitab99;

     :/basica/def/agifigen;

     :/modelos/def/dsmom004;
     :/modelos/def/dsmom008;
     :/modelos/def/dsmom005;
|FIN;

|VARIABLES;
      nContador      = 0;
      nRegistro      = 0;
      nModelo        = 0;
      nNume          = 0;
      fFecha         = @;
      aAlfa          = "";
      aFichero       = "";
      aPassword      = "";
      nDesde         = 0;

     aQueQuiero = "";
     aNumCampos = "";
     nNumCampos = 0;
     nCampo  = 0;

     &enModelo       = 0;
     &enEstaCambio   = 0;
     &enEmpresa      = 0;

     &eaPathAnterior = "";
     &eaPathBasica   = "";
     &eaPathContagen = "";
     &eaPathContanex = "";
     &eaPathContasoc = "";
     &eaPathIntegral = "";
     &eaPathDsmodelo = "";
|FIN;

|PROCESO Tipo11;  |TIPO 11;
     |SI FSalida = 10;
         |C_M #dspasf03#4, 1, "S";
         |C_M #dspasf03#5, 1, "S";
         |C_M #dspasf03#9, 1, "S";
         |C_M #dspasf03#10, 1, "S";

         |LEE 101#dspasf03.=;

         |ET Campo4;
             |ENCAMPO #4#dspasf03;
             |SI FSalida = 2;  |VETE Campo4;  |FINSI;

         |ET Campo5;
             |ENCAMPO #5#dspasf03;
             |SI FSalida = 2;  |VETE Campo4;  |FINSI;

         |ET Campo9;
             |ENCAMPO #9#dspasf03;
             |SI FSalida = 2;  |VETE Campo5;  |FINSI;

             |ENCAMPO #10#dspasf03;
             |SI FSalida = 2;  |VETE Campo9;  |FINSI;

          |GRABA 020#dspasf03.a;
          |LIBERA #dspasf03;
     |FINSI;

     |SI FSalida = 17;
         |PUSHV 0501 2380;
         |BLANCO 0920 1557;
         |CUADRO 0920 1557;
         |PINTA 1021, "INTRODUZCA EL MODELO PARA ACTIVAR"

         |PARA;  |SI;  |HACIENDO;
              E_inf = 0;
              E_sup = 999;
              nModelo = 1334 ? 1;
              |SI nModelo = 300;  |SAL;  |FINSI;
              |SI nModelo = 303;  |SAL;  |FINSI;
              |SI nModelo = 130;  |SAL;  |FINSI;
              |SI nModelo = 349;  |SAL;  |FINSI;
              |SI nModelo = 115;  |SAL;  |FINSI;
              |SI nModelo = 123;  |SAL;  |FINSI;

              |CONFI "     Modelo no Activado, desea otro Modelo";
              |SI FSalida ! 0;
                  nModelo = 0;
                  |SAL;
              |FINSI;
         |SIGUE;
         |POPV;

         |SI nModelo = 0;  |ACABA;  |FINSI;

         |SI nModelo = 300;  nRegistro = 3;  |FINSI;
         |SI nModelo = 130;  nRegistro = 7;  |FINSI;
         |SI nModelo = 349;  nRegistro = 8;  |FINSI;
         |SI nModelo = 115;  nRegistro = 10; |FINSI;
         |SI nModelo = 123;  nRegistro = 11; |FINSI;
         |SI nModelo = 303;  nRegistro = 12;  |FINSI;

         |SELECT #1#dspasf03;
         #dspasf03#6 = nRegistro;
         |LEE 101#dspasf03.=;
         |SI FSalida = 0;
             #dspasf03#7 = "N";
             |GRABA 020#dspasf03.a;
             |LIBERA #dspasf03;
         |FINSI;

         |SI nModelo = 300;  |O nModelo = 303;
             #dspasf03#6 = 1;
             |LEE 101#dspasf03.=;
             |SI FSalida = 0;
                 #dspasf03#7 = "N";
                 |GRABA 020#dspasf03.a;
                 |LIBERA #dspasf03;
             |FINSI;
         |FINSI;

         |SELECT #2#dspasf03;
         |PONCONTROL 23, "SI";
     |FINSI;
|FPRC;

|PROCESO dspase25;
     #agifigen#0   = #dspase25#3;
     |LEE 040#agifigen.=;
     |SI FSalida ! 0;  |DDEFECTO #agifigen;  |FINSI;

     #agitab99#0 = #dspase25#0;
     |LEE 040#agitab99.=;
     |SI FSalida ! 0;  |DDEFECTO #agitab99;  |FINSI;

     #dsmom004#0 = #dspase25#3;
     #dsmom004#1 = #dspasf03#4;
     #dsmom004#2 = #dspase25#1;
     #dsmom004#3 = #dspase25#0;
     #dsmom004#4 = #dspase25#2;
     |LEE 000#dsmom004.=;
     |SI FSalida ! 0;  |DDEFECTO #dsmom004;  |FINSI;

     #dsmom008#0 = #dspase25#3;
     #dsmom008#1 = #dspasf03#4;
     #dsmom008#2 = #dspase25#1;
     #dsmom008#3 = #dspase25#0;
     #dsmom008#4 = #dspase25#2;
     #dsmom008#5 = 0;
     |LEE 000#dsmom008.=;
     |SI FSalida ! 0;
         #dspase25#4 = 0;
     |FINSI;

     #dspase25#5 = #dsmom004#15;
     #dspase25#6 = #dspase25#4 - #dspase25#5;
     #dspase25#7 = #agifigen#1;
     #dspase25#8 = #agitab99#1;

     |GRABA 020#dspase25.a;
     |LIBERA #dspase25;
|FPRC;

|DEFBUCLE dspase25;
     #dspase25#1;
     ;
     #dspasf03#0, 00, 00, #dspasf03#9;
     #dspasf03#0, 99, 99, #dspasf03#10;
     be;
     NULL, dspase25;
|FIN;

|PROCESO PasoEl25;
     |ABRE #agitab99;
     |ABRE #dsmom004;
     |ABRE #dsmom008;
     |ABRE #agifigen;
     |BUCLE dspase25;
     |CIERRA #agifigen;
     |CIERRA #dsmom004;
     |CIERRA #dsmom008;
     |CIERRA #agitab99;
|FPRC;

|PROCESO Procesando;

     |PARA nCampo = 0; |SI nCampo [ nNumCampos; |HACIENDO nCampo = nCampo + 1;
           #dspase03#nCampo# = #dspasf03#nCampo#;
     |SIGUE;

     |PINDA #0#dspasf03;

     |SI #dspasf03#0 = 300;  |HAZ PaseIva;      #dspasf03#7 = "S";  |FINSI;
     |SI #dspasf03#0 = 303;  |HAZ PaseIva;      #dspasf03#7 = "S";  |FINSI;
     |SI #dspasf03#0 = 130;  |HAZ Pase130;      #dspasf03#7 = "S";  |FINSI;
     |SI #dspasf03#0 = 349;  |HAZ PaseIva;      #dspasf03#7 = "S";  |FINSI;
     |SI #dspasf03#0 = 115;  |HAZ PaseIrpf;     #dspasf03#7 = "S";  |FINSI;
     |SI #dspasf03#0 = 123;  |HAZ PaseIrpf;     #dspasf03#7 = "S";  |FINSI;

     |HAZ PasoEl25;

     |GRABA 020#dspasf03.a;
     |LIBERA #dspasf03;
|FPRC;

|DEFBUCLE dspasf03;
     #dspasf03#1;
     7;
     01, "N";
     99, "N";
     be;
     NULL, Procesando;
|FIN;

|PROCESO GrabaRegistro;
     nContador = nContador + 1;

     fFecha    = ~;
     aAlfa     = fFecha % -104;
     nNume     = aAlfa;
     |SI nNume ] 2009;
         |SI nModelo = 300;  |ACABA;  |FINSI;
         |SI nModelo = 320;  |ACABA;  |FINSI;
         |SI nModelo = 330;  |ACABA;  |FINSI;
         |SI nModelo = 332;  |ACABA;  |FINSI;
     |SINO;
         |SI nModelo = 303;  |ACABA;  |FINSI;
     |FINSI;

     #dspasf03#6 = nContador;
     |LEE 040#dspasf03.=;
     |SI FSalida = 0;  |ACABA;  |FINSI;

     #agitab99#0 = nModelo;
     |LEE 040#agitab99.=;
     |SI FSalida ! 0;  |DDEFECTO #agitab99;  |FINSI;

     |DDEFECTO #dspasf03;
     #dspasf03#6      = nContador;
     #dspasf03#0      = nModelo;
     #dspasf03#1      = #agitab99#1;
     #dspasf03#2      = #agitab99#2;
     #dspasf03#3      = #agitab99#3;
     #dspasf03#4      = aAlfa;
     aAlfa     = fFecha % 402;

     |SI aAlfa = "01";  |O aAlfa = "02";  |O aAlfa = "03";
      |O aAlfa = "04";  |O aAlfa = "05";  |O aAlfa = "06";
         #dspasf03#5  = 1;
     |FINSI;

     |SI aAlfa = "07";  |O aAlfa = "08";  |O aAlfa = "09";
         #dspasf03#5  = 2;
     |FINSI;

     |SI aAlfa = "10";  |O aAlfa = "11";  |O aAlfa = "12";
         #dspasf03#5  = 3;
     |FINSI;

     |SI nModelo = 310;  |O nModelo = 131;
         #dspasf03#5 = 4;
     |FINSI;

     |SI nModelo = 320;  |O nModelo = 330;  |O nModelo = 332;
                         |O nModelo = 303;
         #dspasf03#5 = aAlfa;
         #dspasf03#5 = #dspasf03#5 - 1;
     |FINSI;

     |GRABA 020#dspasf03.n;
     |LIBERA #dspasf03;
|FPRC;

|RUTINA ClaveBaja3;
     #dspasf03#7 = "N";
     #dspasf03#6 = 1;
|FRUT;

|RUTINA ClaveAlta3;
     #dspasf03#7 = "N";
     #dspasf03#6 = 99;
|FRUT;


|PROCESO Tipo7C8;  |TIPO 7;
|FPRC;

|PROCESO Tipo0C8;  |TIPO 0;
|FPRC;

|PROGRAMA;
     |ABRE #dspasf00;
     |LEE 040#dspasf00.p;
     |SI FSalida ! 0;
         |MENAV "     No se ha hecho el Pase de la Gestion Anterior";
         |CIERRA #dspasf00;
         |ACABA;
     |FINSI;
     |CIERRA #dspasf00;

     enEstaCambio = 0;
     |DDEFECTO #dspase15;

     |ABRE #dsmom005;
     |LEE 040#dsmom005.p;
     |SI FSalida ! 0;
         |CIERRA #dsmom005;
         |SUB_EJECUTA_NP ":modelos/dsmom005";
     |SINO;
         |CIERRA #dsmom005;
     |FINSI;

     |HAZ BusquedaApli;

     eaPathAnterior = #dspasf00#0;  |QBT eaPathAnterior;

     nContador = 0;
     |ABRE #dspasf03;
     |ABRE #agitab99;
     nModelo   = 300;  |HAZ GrabaRegistro;
     nModelo   = 130;  |HAZ GrabaRegistro;
     nModelo   = 349;  |HAZ GrabaRegistro;
     nModelo   = 115;  |HAZ GrabaRegistro;
     nModelo   = 303;  |HAZ GrabaRegistro;
     |CIERRA #agitab99;
     |CIERRA #dspasf03;

     |ENTLINEAL #2#dspasf03, -2, 4, 22, 1, ClaveBaja3, ClaveAlta3;

     |CONFI "0000NDesea hacer el pase en estos momentos.";
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |MENSA "     Realizando Pases de Modelos";

     aFichero = ("99" + Usuario + "zzzzzzzz") % 108;
     |NOME_DAT #dspase99#aFichero#;
     |ABRE #dspase99;  |CIERRA #dspase99;  |DELINDEX #dspase99;

     aQueQuiero = "|NC";
     aNumCampos = #dspasf03#aQueQuiero#;
     nNumCampos = aNumCampos;
     nNumCampos = nNumCampos - 1;

     |ABRE #dspase25;
     |ABRE #dspase99;
     |ABRE #dspase03;
     |BUCLE dspasf03;
     |CIERRA #dspase03;
     |CIERRA #dspase25;
     |CIERRA #dspase99;

     |DELINDEX #dspase99;

     nModelo = 0;
|FPRO;
.
