|FICHEROS;
     agim0003 #3,MANTE;
     agim0016 #16;
|FIN;

|VARIABLES;
     &eaNonDni = "";
     &eaDomiDni = "";
     &eaCPDni = "";
     &eaPobDni = "";
     &eaPrvDni = "";
     &eaTlfDni = "";
     &eaFacDni = "";
     &eaPaisDni = "";

     &eaVarDni = "";
     &enCalcCif = 0;
     &enError = 0;
     nError = 0;
     i = 0;
     aAlfa = "";
|FIN;

|PROCESO CheqNif;
     eaVarDni = #3#0;
     enCalcCif = 1;
     |HAZ CalculoDNI;
     eaVarDni = (eaVarDni + "             ") % 112;
     |SI #3#0 ! eaVarDni;
          nError = 1;
     |SINO;
          nError = 0;
     |FINSI;
|FPRC;

|PROGRAMA;
     enError = 1;
     |ABRE #3;
     #3#0 = eaVarDni;
     |LEE 000#3=;
     |SI FSalida ! 0;
          |ABRE #16;
          #16#0 = eaPaisDni;
          |LEE 000#16=;
          |SI FSalida ! 0; |DDEFECTO #16; |FINSI;
          |CIERRA #16;

          #3#1 = eaNonDni;
          #3#2 = eaDomiDni;
          aAlfa = eaCPDni % 102; #3#4 = aAlfa;
          aAlfa = eaCPDni % 303; #3#5 = aAlfa;
          #3#6 = eaPobDni;
          #3#7 = eaPrvDni;
          #3#8 = eaTlfDni;
          #3#17 = eaFacDni;
          #3#12 = eaPaisDni;
          #3#13 = #16#1;

          |GRABA 020#3b;
          |PINPA #0#3;
          |PINDA #0#3;
          |CONFI "0000SNo existe Nif. Dar de alta S/N:";
          |SI FSalida = 0;
               |ENDATOS #2#3;
               |SI FSalida = 0;
                    |PARA; |SI; |HACIENDO;
                         |GRABA 020#3a;
                         |ABRE #16;
                         #16#0 = #3#12;
                         |LEE 000#16=;
                         |SI FSalida ! 0; |DDEFECTO #16; |FINSI;
                         |CIERRA #16;
                         |SI #16#5 = "N";
                              |HAZ CheqNif;
                              |SI nError = 1;
                                   aAlfa = "0000SEl nif introducido no es correcto." + &13 + "¿Indicar otro pais?";
                                   |CONFI aAlfa;
                                   |SI FSalida ! 0;
                                        |BORRA 020#3c; |SAL;
                                   |FINSI;
                              |SINO;
                                   enError = 0; |SAL;
                              |FINSI;
||sin el LEE da error 100 al hacer el graba
                              |LEE 121#3=;
                              |ENCAMPO #12#3;
                              |SI FSalida ! 0;
                                   |BORRA 020#3c; |SAL;
                              |FINSI;
                         |SINO;
                              enError = 0; |SAL;
                         |FINSI;
                    |SIGUE;
               |SINO;
                    |BORRA 020#3c;
               |FINSI;
          |SINO;
               |BORRA 020#3c;
          |FINSI;
     |FINSI;
     |CIERRA #3;
|FPRO;
