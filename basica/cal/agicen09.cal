|FICHEROS;
     agicen09 #9;
     agicen10 #10,MANTE;
     agiw0004 #99,MANTE;
|FIN;

|VARIABLES;
     &enEmpresa   = 0;
     &enActividad = 0;
     &enContador  = 0;
     &enTipo      = 0;
     &eaNombreEmp = "";
     &eaNombreAct = "";
     &efFechaAlta = @;
     &efFechaBaja = @;
     &eaCodEpi1   = "";
     &eaCodEpi2   = "";

     fFechaSys     = @;
     aAlfa         = "";
     nCoef1        = 0;
     nCoef2        = 0;
     nSwGraba      = 0;
     nTipoPon      = 0;
     nCampo1       = 0;
     nCampo2       = 0;
     nCampo3       = 0;
|FIN;

|PROCESO NombreRepre;
     |HAZ LeeNifs;     || Esto no haze n  pero quien lo toque
                       || los corto lo guevos  PARAQUITAR
|FPRC;

|PROCESO Anyo; |TIPO 7;
     |SI #9#4 ! 0; |ACABA; |FINSI;

     fFechaSys = ~;
     aAlfa      = fFechaSys % -104;
     #9#4      = aAlfa;
     |PINTA #9#4;
|FPRC;

|PROCESO Cuadro1; |TIPO 7;
     |PUSHV 1044 2079;
     |CUADRO 1044 2079;
     |ATRI R;
     |PINTA 1145, " Declaracion de :                 ";
     |PINTA 1245, "    Alta ...................... 1 ";
     |PINTA 1345, "    Baja ...................... 2 ";
     |PINTA 1445, "                                  ";
     |PINTA 1545, " Variacion                        ";
     |PINTA 1645, "    Cambio opcion Alta ........ 3 ";
     |PINTA 1745, "    Cambio opcion Baja ........ 4 ";
     |PINTA 1845, "    Elementos tributarios ..... 5 ";
     |PINTA 1945, "    Otras causas .............. 6 ";
     |ATRI 0;
|FPRC;

|PROCESO Cuadro2; |TIPO 7;
     |PUSHV 1417 1852;
     |CUADRO 1417 1852;
     |ATRI R;
     |PINTA 1518, " Regla(s) que son de aplicacion   ";
     |PINTA 1618, "    Regla 4¦ 2F) .............. 1 ";
     |PINTA 1718, "    Regla 7¦. ................. 2 ";
     |ATRI 0;
|FPRC;

|PROCESO Cuadro3; |TIPO 7;
     |PUSHV 1432 1867;
     |CUADRO 1432 1867;
     |ATRI R;
     |PINTA 1533, " Exencion que solicita :          ";
     |PINTA 1633, "    Articulo 83.1.d) .......... 1 ";
     |PINTA 1733, "    Articulo 83.1.e) .......... 2 ";
     |ATRI 0;
|FPRC;

|PROCESO Cuadro4; |TIPO 7;
     |PUSHV 0941 1476;
     |CUADRO 0941 1476;
     |ATRI R;
     |PINTA 1042, " Darse de Alta ................ 1 ";
     |PINTA 1142, " Darse de Baja ................ 2 ";
     |PINTA 1242, " Declarar Variaciones ......... 3 ";
     |PINTA 1342, " Rectificar (Complementaria) .. 4 ";
     |ATRI 0;
|FPRC;

|PROCESO Cuadro5; |TIPO 7;
     |PUSHV 1049 1370;
     |CUADRO 1049 1370;
     |ATRI R;
     |PINTA 1150, " Nacional ....... 1 ";
     |PINTA 1250, " Provincial...... 2 ";
     |ATRI 0;
|FPRC;

|PROCESO Reponer; |TIPO 0;
     |POPV;
     |PINTA #9Campo;
|FPRC;

|PROCESO Declarar; |TIPO 0;
     |SI #9#47 = 1; |C_M #9#5, 1, "N"; #9#5 = 1; |FINSI;
     |SI #9#47 = 2; |C_M #9#5, 1, "N"; #9#5 = 2; |FINSI;
     |SI #9#47 = 3; |C_M #9#5, 1, "S";
         |SI #9#5 < 3; #9#5 = 3; |FINSI;
     |FINSI;
     |SI #9#47 = 4; |C_M #9#5, 1, "S";           |FINSI;

     |PINTA #9#5;
|FPRC;


|PROCESO Tipo1;  || Alta sin locales afectos
     |C_M #9#18, 1, "N";  #9#18 = ""; |PINTA #9#18;

     |SI #9#47 ! 4;
         |C_M #9#19, 1, "N";
         #9#19 = ""; |PINTA #9#19;
     |FINSI;
|FPRC;

|PROCESO Tipo2;  || Baja sin locales afectos
     |C_M #9#007, 1, "N";  |C_M #9#008, 1, "N";
     |C_M #9#009, 1, "N";  |C_M #9#010, 1, "N";
     |C_M #9#011, 1, "N";  |C_M #9#012, 1, "N";
     |C_M #9#013, 1, "N";  |C_M #9#014, 1, "N";
     |C_M #9#015, 1, "N";  |C_M #9#016, 1, "N";
     |C_M #9#020, 1, "N";  |C_M #9#022, 1, "N";
     |C_M #9#023, 1, "N";  |C_M #9#024, 1, "N";
     |C_M #9#025, 1, "N";  |C_M #9#026, 1, "N";
     |C_M #9#027, 1, "N";  |C_M #9#028, 1, "N";
     |C_M #9#029, 1, "N";  |C_M #9#030, 1, "N";
     |C_M #9#031, 1, "N";  |C_M #9#032, 1, "N";
     |C_M #9#033, 1, "N";  |C_M #9#034, 1, "N";
     |C_M #9#035, 1, "N";  |C_M #9#036, 1, "N";
     |C_M #9#037, 1, "N";  |C_M #9#038, 1, "N";
     |C_M #9#039, 1, "N";  |C_M #9#040, 1, "N";
     |C_M #9#041, 1, "N";  |C_M #9#042, 1, "N";

     |SI #9#47 ! 4;
         |C_M #9#19, 1, "N";
         #9#19 = ""; |PINTA #9#19;
     |FINSI;

     #9#007 = "";
     #9#008 = "";
     #9#009 = "";
     #9#010 = "";
     #9#011 = "";
     #9#012 = 0;
     #9#013 = 0;
     #9#014 = "";
     #9#015 = 0;
     #9#016 = "01.01.0000";
     #9#020 = "";
     #9#022 = 0;
     #9#023 = 0;
     #9#024 = 0;
     #9#025 = 0;
     #9#026 = 0;
     #9#027 = 0;
     #9#028 = "";
     #9#029 = "";
     #9#030 = "";
     #9#031 = "";
     #9#032 = "";
     #9#033 = "";
     #9#034 = 0;
     #9#035 = 0;
     #9#036 = 0;
     #9#037 = 0;
     #9#038 = 0;
     #9#039 = 0;
     #9#040 = 0;
     #9#041 = 0;
     #9#042 = 0;
     #9#043 = 0;
     #9#044 = 0;
     #9#045 = 0;
     #9#046 = 0;

     |PINDA #0#9;
|FPRC;

|PROCESO TipoM; |TIPO 0;
     |SI #9#47 = 3;
         |SI #9#5 < 3;
             |HAZ Cuadro1;
             |MENAV "    Valor superior a 2.";
             |ERROR;
             |ACABA;
         |FINSI;
     |FINSI;

     |C_M #9#007, 1, "S";  |C_M #9#008, 1, "S";
     |C_M #9#009, 1, "S";  |C_M #9#010, 1, "S";
     |C_M #9#011, 1, "S";  |C_M #9#012, 1, "S";
     |C_M #9#013, 1, "S";  |C_M #9#014, 1, "S";
     |C_M #9#015, 1, "S";  |C_M #9#016, 1, "S";
     |C_M #9#017, 1, "S";  |C_M #9#018, 1, "S";
     |C_M #9#019, 1, "S";  |C_M #9#020, 1, "S";
     |C_M #9#021, 1, "S";  |C_M #9#022, 1, "S";
     |C_M #9#023, 1, "S";  |C_M #9#024, 1, "S";
     |C_M #9#025, 1, "S";  |C_M #9#026, 1, "S";
     |C_M #9#027, 1, "S";  |C_M #9#034, 1, "S";
     |C_M #9#036, 1, "S";  |C_M #9#037, 1, "S";
     |C_M #9#038, 1, "S";  |C_M #9#039, 1, "S";
     |C_M #9#041, 1, "S";  |C_M #9#042, 1, "S";

     || Tipo 1  Alta
     || Tipo 2  Baja
     || Tipo 3  Alta en variacion


     |SI #9#47  = 1; |HAZ Tipo1; |FINSI;
     |SI #9#47  = 2; |HAZ Tipo2; |FINSI;
     |SI #9#47  = 3;
         |SI #9#5 = 4;
             |HAZ Tipo2;
         |SINO;
             |HAZ Tipo3;
         |FINSI;
     |FINSI;

     |SI #9#47 = 4;
         |SI #9#5 = 1; |HAZ Tipo1; |FINSI;
         |SI #9#5 = 2; |HAZ Tipo2; |FINSI;
         |SI #9#5 = 3; |HAZ Tipo3; |FINSI;
         |SI #9#5 = 4; |HAZ Tipo2; |FINSI;
         |SI #9#5 = 5; |HAZ Tipo3; |FINSI;
         |SI #9#5 = 6; |HAZ Tipo3; |FINSI;
     |FINSI;
|FPRC;

|PROCESO Tipo3;  || Variacion sin locales afectos
     |SI #9#47 ! 4;
         |C_M #9#19, 1, "N";
         #9#19 = ""; |PINTA #9#19;
     |FINSI;
|FPRC;

|PROCESO Provin; |TIPO 0;
     |SI #9#6 = 1;
         |C_M #9#48, 1, "N";
         #9#48  = 0;  |PINTA #9#48;
         #9#49 = "";  |PINTA #9#49;
     |SINO;
         |C_M #9#48, 1, "S";
     |FINSI;
|FPRC;

|PROCESO Graba10;
     |SI nSwGraba = 1;
         #10#41 = nTipoPon;
         |GRABA 140#10a;
         |LIBERA #10;
     |SINO;
         #9#43 = #9#43 + 1;
         #9#44 = #9#44 + #10#22;
         #9#45 = #9#45 + #10#31;
         #9#46 = #9#46 + #10#40;
     |FINSI;
|FPRC;

|DEFBUCLE agicen10;
     #10#1;
     ;
     #9#0, #9#50, #9#1, 00;
     #9#0, #9#50, #9#1, 99;
     be;
     NULL, Graba10;
|FIN;

|PROCESO TipoA;
     nTipoPon = 1;
     nSwGraba = 1;
     |BUCLE agicen10;

     |PINPA #0#10;
     |ENTLINEAL #1#10, -4, 1, 22, 0, ClaveBaja10, ClaveAlta10;
|FPRC;

|PROCESO TipoB;
     #9#43 = 0; |PINTA #9#43;
     #9#44 = 0; |PINTA #9#44;
     #9#45 = 0; |PINTA #9#45;
     #9#46 = 0; |PINTA #9#46;

     nTipoPon = 2;

     nSwGraba = 1;
     |BUCLE agicen10;
|FPRC;

|PROCESO Fichero10;
     |SI #9#47  = 2;              |HAZ TipoB; |ACABA; |FINSI;
     |SI #9#47  = 3; |Y #9#5 = 4; |HAZ TipoB; |ACABA; |FINSI;
     |SI #9#47  = 4; |Y #9#5 = 2; |HAZ TipoB; |ACABA; |FINSI;
     |SI #9#47  = 4; |Y #9#5 = 4; |HAZ TipoB; |ACABA; |FINSI;

     |HAZ TipoA;
     |HAZ Calculo;
|FPRC;


|RUTINA ClaveBaja10;
     #10#0  = #9#0;
     #10#42 = #9#50;
     #10#1  = #9#1;
     #10#2  = 01;
|FRUT;

|RUTINA ClaveAlta10;
     #10#0  = #9#0;
     #10#42 = #9#50;
     #10#1  = #9#1;
     #10#2  = 99;
|FRUT;

|PROCESO Calculo;
     nSwGraba = 0;

     #9#43 = 0;
     #9#44 = 0;
     #9#45 = 0;
     #9#46 = 0;

     |BUCLE agicen10;

     |PINTA #9#43;
     |PINTA #9#44;
     |PINTA #9#45;
     |PINTA #9#46;
|FPRC;

|PROCESO PantaAdjun;
     |SI FSalida = 0;
         |PARA nCampo1 = 10; |SI nCampo1 [ 40; |HACIENDO nCampo1 = nCampo1 + 1;
               nCampo2    = nCampo1 - 10;
               #99nCampo2 = #10nCampo1;
         |SIGUE;
     |FINSI;

     |PUSHV 0501 2380;

     |PINPA #0#99;
     |PINDA #0#99;

     |ENDATOS #1#99;
     |SI FSalida = 0;
         |PARA nCampo1 = 10; |SI nCampo1 [ 40; |HACIENDO nCampo1 = nCampo1 + 1;
               nCampo2    = nCampo1 - 10;
               #10nCampo1 = #99nCampo2;
         |SIGUE;
     |FINSI;

     |POPV;

     |PINTA #10#22;
     |PINTA #10#31;
     |PINTA #10#40;
|FPRC;

|PROCESO TotalesAdj; |TIPO 0;
     nCampo2 = Campo + 9;
     nCampo3 = nCampo2 + 9;
     nCoef2  = .95;
     |SI Campo = 4;  nCoef1 = 1;   |FINSI;
     |SI Campo = 5;  nCoef1 = 1;   nCoef2 = .60; |FINSI;
     |SI Campo = 6;  nCoef1 = .20; |FINSI;
     |SI Campo = 7;  nCoef1 = .40; |FINSI;
     |SI Campo = 8;  nCoef1 = .50; |FINSI;
     |SI Campo = 9;  nCoef1 = .50; |FINSI;
     |SI Campo = 10; nCoef1 = .55; |FINSI;
     |SI Campo = 11; nCoef1 = .55; |FINSI;

     #99nCampo2 = #99Campo   * nCoef1;
     #99nCampo3 = #99nCampo2 * nCoef2;

     |PINTA #99Campo;
     |PINTA #99nCampo2;
     |PINTA #99nCampo3;

     #99#12 = 0;  #99#21 = 0;  #99#30 = 0;
     |PARA nCampo1 = 4; |SI nCampo1 [ 11; |HACIENDO nCampo1 = nCampo1 + 1;
           nCampo2 = nCampo1 + 9;
           nCampo3 = nCampo2 + 9;
           #99#12 = #99#12 + #99nCampo1;
           #99#21 = #99#21 + #99nCampo2;
           #99#30 = #99#30 + #99nCampo3;
     |SIGUE;
     |PINTA #99#12;
     |PINTA #99#21;
     |PINTA #99#30;
|FPRC;

|PROGRAMA;
     |ABRE #9;
     |PINPA #0#9;
     #9#0  = enEmpresa;
     #9#50 = enActividad;
     #9#1  = enContador;
     |LIBERA #9;
     |LEE 140#9=;
     |SI FSalida = 0;
         |PINDA #0#9;
         |ENDATOS #2#9;
         |SI FSalida = 0;
             |HAZ Fichero10;
             |GRABA 140#9a;
             |PINPA #1#9;
             |PINDA #1#9;
             |PAUSA;
         |FINSI;
     |SINO;
         |DDEFECTO #9;
         #9#0  = enEmpresa;
         #9#50 = enActividad;
         #9#1  = enContador;
         #9#2  = eaNombreEmp;
         #9#3  = eaNombreAct;
         #9#10 = eaCodEpi2;
         #9#16 = efFechaBaja;
         #9#17 = efFechaAlta;
         |PINDA #0#9;
         |ENDATOS #1#9;
         |SI FSalida = 0;
             |HAZ Fichero10;
             |GRABA 140#9n;
             |PINPA #1#9;
             |PINDA #1#9;
             |PAUSA;
         |FINSI;
     |FINSI;
     |CIERRA #9;
|FPRO;
