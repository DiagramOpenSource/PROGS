|FICHEROS;
     dspase50 #0;
     dspase15 #15;

     :/integral/def/dsam0000 #100;
     :/integral/def/dsam0121 #121;
     :/integral/def/dsam0122 #122;

     :/contagen/def/canempre #200;

     :/modelos/def/dsmom003  #300;

     :/contasoc/def/maempr01 #400;

     :/laboral/def/labtraba  #500;

     :/facturar/def/facemp   #700;
     :/facturar/def/ashismic #701;

     :/basica/def/dsficher   #800;

     dspasw03 #903,MANTE;

     cargadef@  #600;
     &afichdes@ #900;
     &refesql@  #901;
|FIN;

|VARIABLES;
      nContador      = 0;
      nRegistro      = 0;
      nModelo        = 0;
      nRenta         = 0;
      nNif           = 0;
      nModo          = 0;
      nEstoyLineal   = 0;
      nHandle        = 0;

      fFecha         = @;

      aAlfa          = "";
      aFichero       = "";
      aPassword      = "";
      aBase          = "";
      aPath          = "";
      aDef           = "";
      aPathOrigen    = "";
      aPathDestino   = "";
      aPathFicOrigen = "";
      aPathFicDestino= "";
      aPathFicBasica = "";
      aPathDefSQL    = "";
      aPathDefFichero= "";
      aDirFichOrigen = "";
      aDirEmpresa    = "";
      aFicheroOrigen = "";
      aPathDefDestino= "";
      aMas           = "";

     &enEmpresa      = 0;
     &eaEjec         = "";

     &eaPathAnterior = "";
     &eaPathBasica   = "";
     &eaPathContagen = "";
     &eaPathContanex = "";
     &eaPathContasoc = "";
     &eaPathRen2000  = "";
     &eaPathRen1999  = "";
     &eaPathRen1998  = "";
     &eaPathRen1997  = "";
     &eaPathRen1996  = "";
     &eaPathRen1995  = "";
     &eaPathRen1994  = "";
     &eaPathFacturar = "";
     &eaPathLaboral  = "";
     &eaPathIntegral = "";
     &eaPathDsmodelo = "";
     &eaPathFiscal   = "";
     &aPathFich      = "";
     &eaDSMAC        = "";

     nDClave1        = 0;
     nHClave1        = 0;
     nDClave2        = 0;
     nHClave2        = 0;
     nDClave3        = 0;
     nHClave3        = 0;
     nDClave4        = 0;
     nHClave4        = 0;
     nDClave5        = 0;
     nHClave5        = 0;
     nDClave6        = 0;
     nHClave6        = 0;
     nDClave7        = 0;
     nHClave7        = 0;
     nCampo          = 0;

     nCampo1         = 0;
     nCampo2         = 0;
     nCampo3         = 0;
     nClave          = 0;
     nPosClave       = 0;
     nDEmpresa       = 0;
     nHEmpresa       = 0;
     nCampoDef       = 0;
     nTCampo         = 0;
     nCampoCli       = 0;

     aAlfa1          = "";
     aAlfa2          = "";
     aAlfa3          = "";
     aDAlfa1         = "";
     aHAlfa1         = "";
     aDAlfa2         = "";
     aHAlfa2         = "";
     aDAlfa3         = "";
     aHAlfa3         = "";
     aDAlfa4         = "";
     aHAlfa4         = "";
     aDAlfa5         = "";
     aHAlfa5         = "";
     aDAlfa6         = "";
     aHAlfa6         = "";
     aDAlfa7         = "";
     aHAlfa7         = "";
     aTipoBucle      = "";
     aOrigen         = "";
     aDestino        = "";
     aAplica         = "";
     aMaximo         = "";
     aMinimo         = "";
     aDir            = "";
     aDirecBuscar    = "";
     aDirFichDestino = "";
     aQueQuiero      = "";
     aCampo          = "";
     aBorrar         = "";
     aSelect         = "";
     aFrom           = "";
     aInto           = "";
     aWhere          = "";
     aFichSql        = "";
     aFich           = "";
     aDDef           = "";
     aHDef           = "";

     &enCambioCli    = 0;
     &enBorraTodo    = 0;
|FIN;

|| **************************************************************************
||   PASES DE MAESTROS
|| **************************************************************************

|PROCESO CopiaMaestro;
     aAlfa = aFicheroOrigen < "";
     aAlfa = aAlfa - ".dat" + ".mas";
     aMas  = aPathDefDestino + aAlfa;
     |XABRE "E", aMas, nHandle;
     |SI FSalida < 0;  |ACABA;  |FINSI;

     #800#0 = aAplica;
     #800#1 = aAlfa;
     |LEE 000#800=;
     |SI FSalida = 0;  |ACABA;  |FINSI;

     aAlfa1 = aFichero < "";
     aAlfa2 = aPathDestino + aFicheroOrigen;
     aAlfa2 = aAlfa2 < "";

     aOrigen  = aAlfa1;
     aDestino = aAlfa2;
     |COPIA_FICHERO aOrigen, aDestino;

     aOrigen  = aAlfa1 - ".dat" + ".ddx";
     aDestino = aAlfa2 - ".dat" + ".ddx";
     |COPIA_FICHERO aOrigen, aDestino;

     aOrigen  = aAlfa1 - ".dat" + ".ixx";
     aDestino = aAlfa2 - ".dat" + ".ixx";
     |COPIA_FICHERO aOrigen, aDestino;
|FPRC;

|PROCESO ElDir;
     |DBASS aPathDestino;   |QBF aPathDestino;

     aPathDefDestino = aPathDestino + aAplica + "/def/";

     aPathDestino    = aPathDestino   + aAplica;  |MKDIR aPathDestino;
     aPathDestino    = aPathDestino   + "/fich";  |MKDIR aPathDestino;
     aPathDestino    = aPathDestino   + "/";

     aDirFichOrigen  = #0#0;  |QBF aDirFichOrigen;
     aDirFichOrigen  = aDirFichOrigen + aAplica + "/fich/";

     |SI aDirEmpresa ! "";
         aDirFichOrigen  = aDirFichOrigen + aDirEmpresa + "/";
         aPathDestino    = aPathDestino   + aDirEmpresa;
         |MKDIR aPathDestino;
         aPathDestino    = aPathDestino   + "/";
     |FINSI;

     aFichero = aDirFichOrigen + "*.dat";
     |_PDIR aFichero;
     |PARA; |SI FSalida = 0; |HACIENDO;
            aFicheroOrigen = aFichero - aDirFichOrigen;
            |HAZ CopiaMaestro;

            |_SDIR aFichero;
     |SIGUE;

     |PULSATECLA;
     |PULSATECLA;
     |PULSATECLA;
|FPRC;

|PROCESO MaestroIntegral;
     |PINTA 2115, "PASANDO MAESTROS DE LA INTEGRAL                 ";

     aDirEmpresa = "";
     aAplica     = "integral";
     |HAZ ElDir;
|FPRC;

|PROCESO MaestroBasica;
     |PINTA 2115, "PASANDO MAESTROS DE LA BASICA                   ";

     aDirEmpresa = "";
     aAplica     = "basica";
     |HAZ ElDir;
|FPRC;

|PROCESO MaestroContasoc;
     |PINTA 2115, "PASANDO MAESTROS DE LA CONTASOC                 ";

     aDirEmpresa = "";
     aAplica     = "contasoc";
     |HAZ ElDir;
|FPRC;

|PROCESO facempMaestros;
     aDirEmpresa = ("00" + #700#0) % -102;
     |HAZ ElDir;
|FPRC;

|DEFBUCLE facempMaestros;
     #700#2;
     ;
     "S", 00;
     "S", 99;
     ;
     NULL, facempMaestros;
|FIN;

|PROCESO MaestroFacturar;
     |PINTA 2115, "PASANDO MAESTROS DE LA FACTURACION              ";

     aAplica = "facturar";
     |BUCLE facempMaestros;
|FPRC;

|PROCESO MaestroLaboral;
     |PINTA 2115, "PASANDO MAESTROS DE LA LABORAL                  ";

     aDirEmpresa = "";
     aAplica     = "laboral";
     |HAZ ElDir;
|FPRC;

|PROCESO MaestroModelos;
     |PINTA 2115, "PASANDO MAESTROS DE MODELOS                     ";

     aDirEmpresa = "";
     aAplica     = "modelos";
     |HAZ ElDir;
|FPRC;

|PROCESO MaestroRentas;
     |PINTA 2115, "PASANDO MAESTROS DE RENTAS                     ";

     aDirEmpresa = "";
     aAplica     = "ren2019";  |HAZ ElDir;
     aAplica     = "ren2018";  |HAZ ElDir;
     aAplica     = "ren2017";  |HAZ ElDir;
     aAplica     = "ren2016";  |HAZ ElDir;
     aAplica     = "ren2015";  |HAZ ElDir;
     aAplica     = "ren2014";  |HAZ ElDir;
     aAplica     = "ren2013";  |HAZ ElDir;
     aAplica     = "ren2012";  |HAZ ElDir;
     aAplica     = "ren2011";  |HAZ ElDir;
     aAplica     = "ren2010";  |HAZ ElDir;
     aAplica     = "ren2009";  |HAZ ElDir;
     aAplica     = "ren2008";  |HAZ ElDir;
     aAplica     = "ren2007";  |HAZ ElDir;
     aAplica     = "ren2006";  |HAZ ElDir;
     aAplica     = "ren2005";  |HAZ ElDir;
     aAplica     = "ren2004";  |HAZ ElDir;
     aAplica     = "ren2003";  |HAZ ElDir;
     aAplica     = "ren2002";  |HAZ ElDir;
     aAplica     = "ren2001";  |HAZ ElDir;
     aAplica     = "ren2000";  |HAZ ElDir;
     aAplica     = "ren1999";  |HAZ ElDir;
     aAplica     = "ren1998";  |HAZ ElDir;
     aAplica     = "ren1997";  |HAZ ElDir;
     aAplica     = "ren1996";  |HAZ ElDir;
     aAplica     = "ren1995";  |HAZ ElDir;
     aAplica     = "ren1994";  |HAZ ElDir;
|FPRC;

|| **************************************************************************

|PROCESO dsam0054;
     |LEE 101#900=;

     |PATH_DAT #121 aPathFicOrigen;
     |PATH_DAT #122 aPathFicOrigen;

     |ABRE #121;
     #121#0 = #900#10;
     |LEE 040#121=;
     |SI FSalida ! 0;
         |CIERRA #121;
         |ACABA;
     |FINSI;
     |CIERRA #121;

     |HAZ CogeMac;

     |ABRE #122;
     #122#0 = #900#10;
     #122#1 = eaDSMAC;
     |LEE 040#122=;
     |SI FSalida ! 0;
         |CIERRA #122;
         |ACABA;
     |FINSI;
     |CIERRA #122;

     aAlfa    = #122#3;  |QBF aAlfa;
     aAlfa    = aAlfa + "\" + #900#3;  |QBF aAlfa;
     aOrigen  = aAlfa;

     |PATH_DAT #121 aPathFicDestino;
     |PATH_DAT #122 aPathFicDestino;

     |ABRE #121;
     #121#0 = #900#10;
     |LEE 040#121=;
     |SI FSalida ! 0;
         |CIERRA #121;
         |ACABA;
     |FINSI;
     |CIERRA #121;

     |ABRE #122;
     #122#0 = #900#10;
     #122#1 = eaDSMAC;
     |LEE 040#122=;
     |SI FSalida ! 0;
         |CIERRA #122;
         |ACABA;
     |FINSI;
     |CIERRA #122;

     aAlfa    = #900#3;  |QBT aAlfa;
     aAlfa1   = aAlfa % 103;
     aAlfa2   = (("00000" + #903#9) % -105);
     aAlfa3   = (aAlfa % -108);
     aAlfa    = aAlfa1 + aAlfa2 + aAlfa3;
     #900#3   = aAlfa;

     aAlfa    = #122#3;  |QBF aAlfa;
     aAlfa    = aAlfa + "\" + #900#3;  |QBF aAlfa;
     aDestino = aAlfa;

     |COPIA_FICHERO aOrigen, aDestino;

     |GRABA 000#900a;
     |LIBERA #900;
|FPRC;

|PROCESO megwordl;
     aOrigen  = aPathOrigen + "contasoc/emisiones/" + (("00000" + #903#0) % -105) + "/" + #900#1 + "/" + #900#2;
     |QBF aOrigen;

     aAlfa    = aPathDestino + "contasoc/emisiones";
     |MKDIR aAlfa;

     aAlfa    = aAlfa + "/" + (("00000" + #903#9) % -105);
     |MKDIR aAlfa;

     aAlfa    = aAlfa + "/" + #900#1;
     |MKDIR aAlfa;

     aDestino = aAlfa + "/" + #900#2;  |QBF aDestino;
     |COPIA_FICHERO aOrigen, aDestino;
|FPRC;

|PROCESO PorSQL;
     aFichSql = ("sql" + Usuario + "zzzzzzzz") % 108;
     aOrigen  = aDef;
     aDestino = aPathDefSQL + "dsborsql.mas";
     |COPIA_FICHERO aOrigen, aDestino;

     aPathFich = aPathFicOrigen;

     |CARGA_DEF aDestino, refesql@;
     |SI FSalida = 0;
         |PATH_DAT #901 aPathFicBasica;
         |NOME_DAT #901 aFichSql;

         aSelect = "SELECT * ";
         aFrom   = "FROM "  + "dsborsql ";
         aInto   = "INTO "  + aFichSql + ".def ";
         aWhere  = "WHERE " + nCampoCli + " == " + #903#0;
         eaEjec  =  aSelect + aFrom + aInto + aWhere;
         |SUB_EJECUTA_NP "dsborra1;NOMEQUITESQUETECORTOLOSGUEVOS";

         |ABRET #900;
         |ABRET #901;
         |LEE 040#901p;
         |PARA;  |SI FSalida = 0;  |HACIENDO;
              |PARA nCampoDef = 0;  |SI nCampoDef [ nTCampo;  |HACIENDO nCampoDef = nCampoDef + 1;
                    #900nCampoDef = #901nCampoDef;
              |SIGUE;
              #900nCampoCli = #903#9;

              |LEE 101#900=;
              |SI FSalida ! 0;
                   |PARA nCampoDef = 0;  |SI nCampoDef [ nTCampo;  |HACIENDO nCampoDef = nCampoDef + 1;
                         #900nCampoDef = #901nCampoDef;
                   |SIGUE;
                   #900nCampoCli = #903#9;
                   |GRABA 020#900n;
              |SINO;
                   |PARA nCampoDef = 0;  |SI nCampoDef [ nTCampo;  |HACIENDO nCampoDef = nCampoDef + 1;
                         #900nCampoDef = #901nCampoDef;
                   |SIGUE;
                   #900nCampoCli = #903#9;
                   |GRABA 020#900a;
              |FINSI;

              |LIBERA #900;

              |SI aFichero = "dsam0054.mas";  |HAZ dsam0054;  |FINSI;
              |SI aFichero = "megwordl.mas";  |HAZ megwordl;  |FINSI;

              |LEE 000#901s;
          |SIGUE;
          |CIERRAT #900;
          |CIERRAT #901;

          |DELINDEX #901;

          |DESCARGA_DEF #refesql@;
     |FINSI;

     aDestino = aPathDefSQL + "dsborsql.mas";
     aBorrar  = aPathDefSQL + aFichSql  + ".mas";  |FBORRA aBorrar;
     aBorrar  = aPathDefSQL + "dsborsql.mas";      |FBORRA aBorrar;

     aOrigen  = aPathDefSQL + "dsborsq1.mas";
     aDestino = aPathDefSQL + "dsborsql.mas";
     |COPIA_FICHERO aOrigen, aDestino;

     |PULSATECLA;
|FPRC;

|PROCESO TrataFichero;
     aDef = aPathDefFichero + aFichero;
     |CARGA_DEF aDef, afichdes@;
     |SI FSalida ! 0;
         |ACABA;
     |FINSI;

     aQueQuiero = "|NC";
     aCampo     = #900#aQueQuiero#;
     nTCampo    = aCampo;
     nTCampo    = nTCampo - 1;

     |PATH_DAT #900 aPathFicDestino;
     |HAZ PorSQL;

     |DESCARGA_DEF #afichdes@;
|FPRC;

|PROCESO ProcedeAlFichero;
     |SI aFichero = "dspase15.mas";  |ACABA;  |FINSI;

     |ATRI S;
     |PINTA 2258, aFichero;
     |ATRI s;

     aFichero    = #800#1;   |QBF aFichero;
     nCampoCli   = #800#4;
     |HAZ TrataFichero;

     |SI #800#27 = "S";
         nCampoCli   = #800#28;
         |HAZ TrataFichero;
     |FINSI;

     |PULSATECLA;
|FPRC;

|DEFBUCLE dsficher;
     #800#1;
     ;
     aAplica, aDDef;
     aAplica, aHDef;
     ;
     NULL, ProcedeAlFichero;
|FIN;

|PROCESO facemp;
     aPathDefFichero = aPathDestino + "facturar/def/";
     aPathFicOrigen  = aPathOrigen  + "facturar/fich/" + (("00" + #700#0) % -102) + "/";
     aPathFicDestino = aPathDestino + "facturar/fich/" + (("00" + #700#0) % -102) + "/";

     aAplica         = "facturar";
     aDDef           = "";
     aHDef           = "zzzzzzzzzzzz";

     |BUCLE dsficher;
|FPRC;

|DEFBUCLE facemp;
     #700#2;
     ;
     "S", 00;
     "S", 99;
     ;
     NULL, facemp;
|FIN;

|PROCESO dspase15;
     #900#0 = #15#0;
     #900#1 = #15#1;
     |LEE 101#900=;
     |SI FSalida ! 0;
         |DDEFECTO #900;
         #900#0  = #15#0;
         #900#1  = #15#1;
         #900#2  = #15#2;
         #900#3  = #903#9;
         #900#15 = "S";
         #900#16 = "S";
         |GRABA 020#900b;
     |FINSI;

     |SI #903#3 = "S";  |Y #903#12 = "N";
         |SI #15#6 ! 0;
             #900#6  = #15#6;
             #900#20 = #15#20;
         |FINSI;
     |FINSI;

     |SI #903#4 = "S";  |Y #903#13 = "N";
         |SI #15#17 ! 0;
             #900#17 = #15#17;
         |FINSI;
     |FINSI;

     |SI #903#5 = "S";  |Y #903#14 = "N";
         |SI #15#7 ! 0;
             #900#7 = #15#7;
         |FINSI;
     |FINSI;

     |SI #903#6 = "S";  |Y #903#15 = "N";
         |SI #15#6 ! 0;
             #900#5  = #15#5;
             #900#19 = #15#19;
         |FINSI;
     |FINSI;

     |GRABA 020#900a;
     |LIBERA #900;
|FPRC;

|DEFBUCLE dspase15;
     #15#7;
     ;
     #903#0;
     #903#0;
     ;
     NULL, dspase15;
|FIN;

|PROCESO dspasw03_2;
     |SI #903#9 = 0;  |ACABA;  |FINSI;

     |PINTA 0802, #903#0;
     |PINTA 0808, #903#1;
     |PINTA 0821, #903#9;
     |PINTA 0827, #903#10;

     |PINTA #903#2;
     |PINTA #903#3;
     |PINTA #903#4;
     |PINTA #903#5;
     |PINTA #903#6;
     |PINTA #903#7;
     |PINTA #903#8;
     |PINTA #903#11;
     |PINTA #903#12;
     |PINTA #903#13;
     |PINTA #903#14;
     |PINTA #903#15;
     |PINTA #903#16;
     |PINTA #903#17;

     aPathOrigen     = #0#0;    |QBF aPathOrigen;
     |DBASS aPathDestino;   |QBF aPathDestino;
     aPathDefSQL     = aPathDestino + "basica/def/";
     aPathFicBasica  = aPathDestino + "basica/fich/";

     aPath = aPathDestino + "integral/fich/";
     |PATH_DAT #100 aPath;

     |ABRE #100;
     #100#0 = #903#9;
     |LEE 000#100=;
     |SI FSalida ! 0;
         |CIERRA #100;

         |ATRI S;
         |PINTA 2210, "TRATANDO FICHEROS EN MAESTROS            ";
         |ATRI s;

         aPathDefFichero = aPathDestino + "integral/def/";
         aPathFicOrigen  = aPathOrigen  + "integral/fich/";
         aPathFicDestino = aPathDestino + "integral/fich/";

         aAplica         = "integral";
         aDDef           = "";
         aHDef           = "zzzzzzzzzzzz";

         |BUCLE dsficher;
     |FINSI;
     |CIERRA #100;

     |SI #903#4 = "S";  |Y #903#13 = "N";
         |ATRI S;
         |PINTA 2210, "TRATANDO FICHEROS EN MODELOS             ";
         |ATRI s;

         aPathDefFichero = aPathDestino + "modelos/def/";
         aPathFicOrigen  = aPathOrigen  + "modelos/fich/";
         aPathFicDestino = aPathDestino + "modelos/fich/";

         aAplica         = "modelos";
         aDDef           = "";
         aHDef           = "zzzzzzzzzzzz";

         |BUCLE dsficher;
     |FINSI;

     |SI #903#5 = "S";  |Y #903#14 = "N";
         |ATRI S;
         |PINTA 2210, "TRATANDO FICHEROS EN SOCIEDADES         ";
         |ATRI s;

         aPathDefFichero = aPathDestino + "contasoc/def/";
         aPathFicOrigen  = aPathOrigen  + "contasoc/fich/";
         aPathFicDestino = aPathDestino + "contasoc/fich/";
         aAplica         = "contasoc";

         aDDef           = "";
         aHDef           = "zzzzzzzzzzzz";
         |BUCLE dsficher;

         aPathDefFichero = aPathDestino + "basica/def/";
         aPathFicOrigen  = aPathOrigen  + "basica/fich/";
         aPathFicDestino = aPathDestino + "basica/fich/";
         aAplica  = "basica";

         aDDef = "agim0028.mas";  aHDef = "agim0028.mas";  |BUCLE dsficher;
         aDDef = "agim0019.mas";  aHDef = "agim0019.mas";  |BUCLE dsficher;
         aDDef = "agim0020.mas";  aHDef = "agim0020.mas";  |BUCLE dsficher;
         aDDef = "agim0021.mas";  aHDef = "agim0021.mas";  |BUCLE dsficher;
         aDDef = "agim0022.mas";  aHDef = "agim0022.mas";  |BUCLE dsficher;
         aDDef = "agim0023.mas";  aHDef = "agim0023.mas";  |BUCLE dsficher;
         aDDef = "agim0024.mas";  aHDef = "agim0024.mas";  |BUCLE dsficher;
         aDDef = "agim0025.mas";  aHDef = "agim0025.mas";  |BUCLE dsficher;
         aDDef = "agim0026.mas";  aHDef = "agim0026.mas";  |BUCLE dsficher;
         aDDef = "agim0027.mas";  aHDef = "agim0027.mas";  |BUCLE dsficher;
         aDDef = "agim0033.mas";  aHDef = "agim0033.mas";  |BUCLE dsficher;
         aDDef = "agim0034.mas";  aHDef = "agim0034.mas";  |BUCLE dsficher;
         aDDef = "agim0037.mas";  aHDef = "agim0037.mas";  |BUCLE dsficher;
         aDDef = "agim0038.mas";  aHDef = "agim0038.mas";  |BUCLE dsficher;
         aDDef = "agim0039.mas";  aHDef = "agim0039.mas";  |BUCLE dsficher;
         aDDef = "agim0040.mas";  aHDef = "agim0040.mas";  |BUCLE dsficher;
         aDDef = "agim0041.mas";  aHDef = "agim0041.mas";  |BUCLE dsficher;
         aDDef = "agim0042.mas";  aHDef = "agim0042.mas";  |BUCLE dsficher;
         aDDef = "agim0043.mas";  aHDef = "agim0043.mas";  |BUCLE dsficher;
         aDDef = "agim0044.mas";  aHDef = "agim0044.mas";  |BUCLE dsficher;
         aDDef = "agim0045.mas";  aHDef = "agim0045.mas";  |BUCLE dsficher;
         aDDef = "agim0046.mas";  aHDef = "agim0046.mas";  |BUCLE dsficher;
         aDDef = "agim0049.mas";  aHDef = "agim0049.mas";  |BUCLE dsficher;
     |FINSI;

     |SI #903#6 = "S";  |Y #903#15 = "N";
         |ATRI S;
         |PINTA 2210, "TRATANDO FICHEROS EN LABORAL            ";
         |ATRI s;

         aPathDefFichero = aPathDestino + "laboral/def/";
         aPathFicOrigen  = aPathOrigen  + "laboral/fich/";
         aPathFicDestino = aPathDestino + "laboral/fich/";

         aAplica         = "laboral";
         aDDef           = "";
         aHDef           = "zzzzzzzzzzzz";

         |BUCLE dsficher;
     |FINSI;

     |SI #903#7 = "S";  |Y #903#16 = "N";
         |ATRI S;
         |PINTA 2210, "TRATANDO FICHEROS EN FACTURACION         ";
         |ATRI s;

         nDEmpresa = 0;
         nHEmpresa = 99;

         aPath = aPathDestino + "facturar/fich/";
         |PATH_DAT #700 aPath;

         |BUCLE facemp;
     |FINSI;

     |SI #903#8 = "S";  |Y #903#17 = "N";
         |PARA nRenta = 1994;  |SI nRenta [ 2019;  |HACIENDO nRenta = nRenta + 1;
               aDef = aPathOrigen + "ren" + nRenta + "/def/reacceso.mas";
               |XABRE "E", aDef, nHandle;
               |SI FSalida ] 0;
                   |ATRI S;
                   aAlfa = "TRATANDO FICHEROS EN RENTA " + nRenta;
                   |PINTA 2210, aAlfa;
                   |ATRI s;

                   aPathDefFichero  = aPathDestino + "ren" + nRenta + "/def/";
                   aPathFicOrigen   = aPathOrigen  + "ren" + nRenta + "/fich/";
                   aPathFicDestino  = aPathDestino + "ren" + nRenta + "/fich/";

                   aAplica         = "ren" + nRenta;
                   aDDef           = "";
                   aHDef           = "zzzzzzzzzzzz";

                   |BUCLE dsficher;
               |FINSI;
         |SIGUE;
     |FINSI;

     aDef = aPathDestino + "basica/def/dspase15.mas";
     |CARGA_DEF aDef, afichdes@;
     |SI FSalida ! 0;
         |ACABA;
     |FINSI;

     aPath = aPathOrigen + "basica/fich/";
     |PATH_DAT #15 aPath;

     aPath = aPathDestino + "basica/fich/";
     |PATH_DAT #900 aPath;

     |ABRE #900;
     |BUCLE dspase15;
     |CIERRA #900;

     |DESCARGA_DEF #afichdes@;
|FPRC;

|DEFBUCLE dspasw03_2;
     #903#1;
     ;
     00001;
     99999;
     ;
     NULL, dspasw03_2;
|FIN;

|| **************************************************************************

|PROCESO Tipo2;  |TIPO 2;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 1;
         |MENAV "0000 No se puede dar de alta.";
         |ERROR;
         |ACABA;
     |FINSI;
|FPRC;

|PROCESO Tipo7C9;  |TIPO 7;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 1;
         |PTEC 806;
     |FINSI;
|FPRC;

|PROCESO Tipo0C9;  |TIPO 0;
     |SI #903#9 = 0;  |ACABA;  |FINSI;

     |DBASE aBase;  |QBF aBase;
     aDef = aBase + "def/dspasw03.mas";
     |CARGA_DEF aDef, cargadef@;

     aFichero = ("03" + Usuario + "zzzzzzzz") % 108
     |NOME_DAT #600 aFichero;
     |ABRE #600;
     |SELECT #2#600;

     #600#9 = #903#9;
     |LEE 000#600=;
     |SI FSalida = 0;  |Y  #600#0 ! #903#0;
         |MENAV "0000 Este codigo ya ha sido introducido.";
         |CIERRA #600;
         |DESCARGA_DEF #cargadef@;
         |ERROR;
         |ACABA;
     |FINSI;
     |CIERRA #600;

     |DESCARGA_DEF #cargadef@;

     #903#12 = "N";  |PINTA #903#12;
     #903#13 = "N";  |PINTA #903#13;
     #903#14 = "N";  |PINTA #903#14;
     #903#15 = "N";  |PINTA #903#15;
     #903#16 = "N";  |PINTA #903#16;
     #903#17 = "N";  |PINTA #903#17;

     |DBASS aBase;  |QBF aBase;
     aPath = aBase + "integral/fich/";
     |PATH_DAT #100 aPath;
     |ABRE #100;
     #100#0 = #903#9;
     |LEE 000#100=;
     |SI FSalida ! 0;
         |CONFI "0000 Este codigo no existe en esta PI, lo creamos con este codigo";
         |SI FSalida ! 0;
             |ERROR;
         |FINSI;
         |CIERRA #100;
         |ACABA;
     |FINSI;
     |CIERRA #100;

     |SI #100#3 ! #903#1;
         |MENAV "0000 Los NIF no coinciden";
         |ERROR;
         |ACABA;
     |FINSI;

     |DBASS aBase;  |QBF aBase;
     aPath = aBase + "integral/fich/";
     |PATH_DAT #100 aPath;

     aPath = aBase + "contagen/fich/";
     |PATH_DAT #200 aPath;

     aPath = aBase + "modelos/fich/";
     |PATH_DAT #300 aPath;

     aPath = aBase + "contasoc/fich/";
     |PATH_DAT #400 aPath;

     aPath = aBase + "laboral/fich/";
     |PATH_DAT #500 aPath;

     aPath = aBase + "facturar/fich/";
     |PATH_DAT #700 aPath;

     nEstoyLineal = 1;

     |ABRE #200;
     |ABRE #300;  |SELECT #2#300;
     |ABRE #400;
     |ABRE #500;
     |HAZ dspasw03_1;
     |CIERRA #200;
     |CIERRA #300;
     |CIERRA #400;
     |CIERRA #500;

     |SI nNif = 0;
         |MENAV "0000 Este codigo ya tiene pasados los departamentos.";
         |ERROR;
     |FINSI;
|FPRC;

|PROCESO Tipo11;  |TIPO 11;
     |SI FSalida = 10;
         |CONSULTA_CLAVE #1#903;
     |FINSI;

     |SI FSalida = 11;
         |DBASS aBase;  |QBF aBase;
         aPath = aBase + "integral/fich/";
         |PATH_DAT #100 aPath;
         |ABRE #100;
         |CONSULTA_CLAVE #1#100;
         |CIERRA #100;
     |FINSI;
|FPRC;

|PROCESO BuscaRentasPI2;
     |PARA nRenta = 1994;  |SI nRenta [ 2019;  |HACIENDO nRenta = nRenta + 1;
           aDef = aBase + "ren" + nRenta + "/def/reacceso.mas";
           |CARGA_DEF aDef, cargadef@;
           |SI FSalida = 0;
               aPath = aBase + "ren" + nRenta + "/fich/";
               |PATH_DAT #600 aPath;
               |ABRE #600;
               #600#0 = #100#0;
               |LEE 000#600=;
               |SI FSalida = 0;
                   #903#8 = "S";
               |FINSI;
               |CIERRA #600;
               |DESCARGA_DEF #cargadef@;
           |FINSI;

           |SI #903#8 = "S";  |SAL;  |FINSI;
     |SIGUE;
|FPRC;

|PROCESO facempPI2;
     aPath = aBase + "facturar/fich/" + (("00" + #700#0) % -102) + "/";
     |PATH_DAT #701 aPath;
     |ABRE #701;
     |SELECT #3#701;
     #701#3 = #100#0;
     #701#0 = "";
     #701#1 = 0;
     |LEE 000#701];
     |SI FSalida = 0;  |Y #701#3 = #100#0;
         #903#7 = "S";
     |FINSI;
     |CIERRA #701

     |SI #903#7 = "S";
         |ERROR10;
     |FINSI;
|FPRC;

|DEFBUCLE facempPI2;
     #700#2;
     ;
     "S", 00;
     "S", 99;
     ;
     NULL, facempPI2;
|FIN;

|PROCESO dsam0000PI2;
     |DDEFECTO #903;

     #903#0  = #100#0;
     #903#1  = #100#3;
     #903#2  = #100#1;

     |SI #0#1 = "S";
         #200#2 = #100#0;
         #200#3 = 0;
         |LEE 000#200];
         |SI FSalida = 0;  |Y  #200#2 = #100#0;
             #903#3 = "S";
         |FINSI;
     |FINSI;

     |SI #0#2 = "S";
         #300#0 = #100#0;
         #300#1 = 0;
         #300#2 = 0;
         |LEE 000#300];
         |SI FSalida = 0;  |Y  #300#0 = #100#0;
             #903#4 = "S";
         |FINSI;
     |FINSI;

     |SI #0#3 = "S";
         #400#0 = #100#0;
         #400#1 = 0;
         |LEE 000#400];
         |SI FSalida = 0;  |Y  #400#0 = #100#0;
             #903#5 = "S";
         |FINSI;
     |FINSI;

     |SI #0#5 = "S";
         #500#0 = #100#0;
         #500#1 = 0;
         |LEE 000#500];
         |SI FSalida = 0;  |Y  #500#0 = #100#0;
             #903#6 = "S";
         |FINSI;
     |FINSI;

     |SI #0#4 = "S";
         |HAZ BuscaRentasPI2;
     |FINSI;

     |SI #0#6 = "S";
         |BUCLE facempPI2;
     |FINSI;

     |SI #903#3 = "N";  |Y  #903#4 = "N";  |Y  #903#5 = "N";
     |Y  #903#6 = "N";  |Y  #903#7 = "N";  |Y  #903#8 = "N";
         |ACABA;
     |FINSI;

     |GRABA 020#903n;
     |LIBERA #903;
|FPRC;

|DEFBUCLE dsam0000PI2;
     #100#1;
     ;
     00001;
     99999;
     ;
     NULL, dsam0000PI2;
|FIN;

|PROCESO dsam0000PI1;
     #903#9  = #100#0;
     #903#10 = #100#3;
     #903#11 = #100#1;

     nNif    = nNif + 1;
|FPRC;

|DEFBUCLE dsam0000PI1;
     #100#3;
     ;
     #903#1;
     #903#1;
     ;
     NULL, dsam0000PI1;
|FIN;

|PROCESO BuscaRentasPI1;
     |PARA nRenta = 1994;  |SI nRenta [ 2019;  |HACIENDO nRenta = nRenta + 1;
           aDef = aBase + "ren" + nRenta + "/def/reacceso.mas";
           |CARGA_DEF aDef, cargadef@;
           |SI FSalida = 0;
               aPath = aBase + "ren" + nRenta + "/fich/";
               |PATH_DAT #600 aPath;
               |ABRE #600;
               #600#0 = #100#0;
               |LEE 000#600=;
               |SI FSalida = 0;
                   #903#17 = "S";
               |FINSI;
               |CIERRA #600;

               |DESCARGA_DEF #cargadef@;
           |FINSI;

           |SI #903#17 = "S";  |SAL;  |FINSI;
     |SIGUE;
|FPRC;

|PROCESO facempPI1;
     aPath = aBase + "facturar/fich/" + (("00" + #700#0) % -102) + "/";
     |PATH_DAT #701 aPath;
     |ABRE #701;
     |SELECT #3#701;
     #701#3 = #100#0;
     #701#0 = "";
     #701#1 = 0;
     |LEE 000#701];
     |SI FSalida = 0;  |Y #701#3 = #100#0;
         #903#16 = "S";
     |FINSI;
     |CIERRA #701

     |SI #903#16 = "S";
         |ERROR10;
     |FINSI;
|FPRC;

|DEFBUCLE facempPI1;
     #700#2;
     ;
     "S", 00;
     "S", 99;
     ;
     NULL, facempPI1;
|FIN;

|PROCESO dspasw03_1;
     |SI nEstoyLineal = 0;
         nNif = 0;
         |BUCLE dsam0000PI1;

         |SI nNif   >  1;  |ACABA;  |FINSI;
     |FINSI;

     |SI #903#9 =  0;  |ACABA;  |FINSI;

     |ABRE #100;
     #100#0 = #903#9;
     |LEE 000#100=;
     |SI FSalida ! 0;  |DDEFECTO #100;  |FINSI;
     |CIERRA #100;

     #903#10 = #100#3;
     #903#11 = #100#1;

     |SI #0#1 = "S";
         #200#2 = #100#0;
         #200#3 = 0;
         |LEE 000#200];
         |SI FSalida = 0;  |Y  #200#2 = #100#0;
             #903#12 = "S";
         |FINSI;
     |FINSI;

     |SI #0#2 = "S";
         #300#0 = #100#0;
         #300#1 = 0;
         #300#2 = 0;
         |LEE 000#300];
         |SI FSalida = 0;  |Y  #300#0 = #100#0;
             #903#13 = "S";
         |FINSI;
     |FINSI;

     |SI #0#3 = "S";
         #400#0 = #100#0;
         #400#1 = 0;
         |LEE 000#400];
         |SI FSalida = 0;  |Y  #400#0 = #100#0;
             #903#14 = "S";
         |FINSI;
     |FINSI;

     |SI #0#5 = "S";
         #500#0 = #100#0;
         #500#1 = 0;
         |LEE 000#500];
         |SI FSalida = 0;  |Y  #500#0 = #100#0;
             #903#15 = "S";
         |FINSI;
     |FINSI;

     |SI #0#4 = "S";
         |HAZ BuscaRentasPI1;
     |FINSI;

     |SI #0#6 = "S";
         |BUCLE facempPI1;
     |FINSI;

     nNif = 0;

     |SI #903#3 = "S";  |Y #903#12 = "N";
         nNif = 1;
     |FINSI;

     |SI #903#4 = "S";  |Y #903#13 = "N";
         nNif = 1;
     |FINSI;

     |SI #903#5 = "S";  |Y #903#14 = "N";
         nNif = 1;
     |FINSI;

     |SI #903#6 = "S";  |Y #903#15 = "N";
         nNif = 1;
     |FINSI;

     |SI #903#7 = "S";  |Y #903#16 = "N";
         nNif = 1;
     |FINSI;

     |SI #903#8 = "S";  |Y #903#17 = "N";
         nNif = 1;
     |FINSI;

     |SI nEstoyLineal = 0;
         |SI nNif = 0;
             |BORRA 020#903a;
         |SINO;
             |GRABA 020#903a;
         |FINSI;
         |LIBERA #903;
     |SINO;
         |PINTA #903#9;
         |PINTA #903#10;
         |PINTA #903#11;
         |PINTA #903#12;
         |PINTA #903#13;
         |PINTA #903#14;
         |PINTA #903#15;
         |PINTA #903#16;
         |PINTA #903#17;
     |FINSI;
|FPRC;

|DEFBUCLE dspasw03_1;
     #903#1;
     ;
     00000;
     99999;
     be;
     NULL, dspasw03_1;
|FIN;

|PROCESO Baja903;
     #903#0  = 1;
|FPRC;

|PROCESO Alta903;
     #903#0  = 99999;
|FPRC;

|PROCESO Tipo3;
     |SI  #0#1 = "N";  |Y  #0#2 = "N";  |Y  #0#3 = "N";
      |Y  #0#4 = "N";  |Y  #0#5 = "N";  |Y  #0#6 = "N";
          |ACABA;
     |FINSI;

     aFichero = ("03" + Usuario + "zzzzzzzz") % 108
     |NOME_DAT #903 aFichero;
     |ABRE #903;  |CIERRA #903;  |DELINDEX #903;

     aBase = #0#0;  |QBF aBase;
     aPath = aBase + "integral/fich/";
     |PATH_DAT #100 aPath;

     aPath = aBase + "contagen/fich/";
     |PATH_DAT #200 aPath;

     aPath = aBase + "modelos/fich/";
     |PATH_DAT #300 aPath;

     aPath = aBase + "contasoc/fich/";
     |PATH_DAT #400 aPath;

     aPath = aBase + "laboral/fich/";
     |PATH_DAT #500 aPath;

     aPath = aBase + "facturar/fich/";
     |PATH_DAT #700 aPath;

     |ABRE #200;
     |ABRE #300;  |SELECT #2#300;
     |ABRE #400;
     |ABRE #500;
     |ABRE #903;
     |BUCLE dsam0000PI2;
     |CIERRA #200;
     |CIERRA #300;
     |CIERRA #400;
     |CIERRA #500;
     |CIERRA #903;

     |DBASS aBase;  |QBF aBase;
     aPath = aBase + "integral/fich/";
     |PATH_DAT #100 aPath;

     aPath = aBase + "contagen/fich/";
     |PATH_DAT #200 aPath;

     aPath = aBase + "modelos/fich/";
     |PATH_DAT #300 aPath;

     aPath = aBase + "contasoc/fich/";
     |PATH_DAT #400 aPath;

     aPath = aBase + "laboral/fich/";
     |PATH_DAT #500 aPath;

     aPath = aBase + "facturar/fich/";
     |PATH_DAT #700 aPath;

     nEstoyLineal = 0;

     |ABRE #200;
     |ABRE #300;  |SELECT #2#300;
     |ABRE #400;
     |ABRE #500;
     |BUCLE dspasw03_1;
     |CIERRA #200;
     |CIERRA #300;
     |CIERRA #400;
     |CIERRA #500;

     |ENTLINEAL #1#903, -1, 2, 22, 1, Baja903, Alta903;

     |CONFI "0000SQuiere realizar el pase, si dice que NO perdera todo lo introducido";
     |SI FSalida ! 0;  |DELINDEX #903;  |ACABA;  |FINSI;

     |BLANCO 2101 2380;
     |CUADRO 2101 2380;

     |ABRE #800;
     |SI #0#7  = "S";  |HAZ MaestroIntegral;  |FINSI;
     |SI #0#8  = "S";  |HAZ MaestroBasica;    |FINSI;
     |SI #0#9  = "S";  |HAZ MaestroContasoc;  |FINSI;
     |SI #0#10 = "S";  |HAZ MaestroFacturar;  |FINSI;
     |SI #0#11 = "S";  |HAZ MaestroLaboral;   |FINSI;
     |SI #0#12 = "S";  |HAZ MaestroModelos;   |FINSI;
     |SI #0#13 = "S";  |HAZ MaestroRentas;    |FINSI;
     |CIERRA #800;

     |BUCLE dspasw03_2;

     |DELINDEX #903;
|FPRC;

|PROGRAMA;
     |CUADRO 0501 2380;
     |BLANCO 0602 2279;
     |PINTA 1320, "Introduzca Password : ";
     E_inf = "";
     E_sup = "20";
     aPassword = 1342 ? -1;
     |SI aPassword ! "<MYPASWD>     ";
         |MENAV "     Permiso denegado.";
         |ACABA;
     |FINSI;

     |ABRE #15;
     |LEE 040#15p;
     |SI FSalida ! 0;
         |DDEFECTO #15;
     |SINO;
         |SI #15#15 ! "S";
             |MENAV "      Unificacion de Codigos no Realizada.";
             |CIERRA #15;
             |ACABA;
         |FINSI;
     |FINSI;
     |CIERRA #15;

     |CLS;
     |CABEZA "     Pase desde otra PI";
     |DDEFECTO #0;
     |PINPA #0#0;
     |PINDA #0#0;
     |ENDATOS #1#0;
     |SI FSalida = 0;
         |HAZ Tipo3;
     |FINSI;
|FPRO;
