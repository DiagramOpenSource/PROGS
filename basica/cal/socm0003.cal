|FICHEROS;
     socm0003;
     socm0004;

     socw0005;
     socw0006;

     agifigen;
     agim0019;
     agim0025;

     :/contagen/def/cacuenta;
|FIN;

|VARIABLES;
     aAlfa         = "";
     aQueQuiero    = "";
     aNumCampos    = "";
     aNumPanta     = "";

     aEsc1         = "";
     aEsc2         = "";
     aRetu         = "";
     aTecla        = "";
     aID           = "";
     aBase         = "";
     aMas          = "";

     nCampo        = 0;
     nRango        = 0;
     nID           = 0;
     nVent         = 0;
     nLabel        = -1;
     nVentTrab     = 0;

     nCampoCambia1 = 0;
     nNumPanta     = 0;
     nCampos       = 0;
     nModoPag      = 0;

     {-1}aVent     = "";
         aVent1    = 0;
         aVent2    = 0;
         aVent3    = 0;
         aVent4    = 0;
         aVent5    = "";

     &enEmpresa    = 0;
     &enReg        = 0;
     &enModo       = 0;
     &enModoReg    = 0;
     &enGrid1      = 0;
     &enGrid2      = 0;
     &enRecibo     = 0;
     &enCapital    = 0;
     &enInteres    = 0;
     &enIRPF       = 0;
     &enCapPdte    = 0;
     &efFecha      = @;
     &enPanta      = 0;
     &enNumCampos  = 0;
     &enInforme    = 0;
     &enPrint      = 0;
     &enBtnAltG1   = 0;
     &enBtnModG1   = 0;
     &enBtnBajG1   = 0;
     &enBtnAltG2   = 0;
     &enBtnModG2   = 0;
     &enBtnBajG2   = 0;
     &enBtnRetG1   = 0;
     &enBtnInfG1   = 0;
|FIN;

|INCLUYE i_agicon;

|DEFBUCLE socm0004I;
     #socm0004#1;
     ;
     #socm0003#0, #socm0003#1, 001;
     #socm0003#0, #socm0003#1, 999;
     ;
     NULL, socm0004I;
|FIN;

|PROCESO FichaPrestamo;
     Impresora = "CrystalReport";
     |IMPRE -1;
     |SI FSalida ! 0;
         |MENAV "    Error en Impresora Crystal Report";
         |ACABA;
     |FINSI;

     |INFOR "soc00302";
     |SI FSalida ! 0; |FINIMP; |ACABA; |FINSI;

     |VENTANA 0501, 0540, -1, 16, "Procesando informe";
     nVentTrab = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentTrab;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PTEC 802; |PAUSA;

     enInforme = 2;

     |ABRE #agifigen;
     enPrint = 0;
     |BUCLE socm0004I;
     |SI enPrint = 0;
         |DDEFECTO #socm0004;
         |PRINT;
     |FINSI;
     |CIERRA #agifigen;

     |PIEINF;
     |FININF;
     |FINIMP;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentTrab;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;
     |FINVENTANA nVentTrab;

     |FOCOTECLADO enGrid1;
|FPRC;

|PROCESO BtnsGrid1;
     |CONTROL_SIMPLE enPanta, "BOTON,{{193}}Alta ", 1764, 1774, AltG1;
     enBtnAltG1 = FSalida;

     |CONTROL_SIMPLE enPanta, "BOTON,{{197}}Modificar ", 1776, 1786, ModG1;
     enBtnModG1 = FSalida;

     |CONTROL_SIMPLE enPanta, "BOTON,{{199}}Borrar", 1788, 1798, BajG1;
     enBtnBajG1 = FSalida;

     |CONTROL_SIMPLE enPanta, "BOTON,{{197}}Recibos", 1748, 1762, Recibos;
     enBtnRetG1 = FSalida;

     |CONTROL_SIMPLE enPanta, "BOTON,{{205}}Ficha prestamo", 1702, 1717, FichaPrestamo;
     enBtnInfG1 = FSalida;

     |ESTADO_CONTROL enBtnModG1,  "DISABLE";
     |ESTADO_CONTROL enBtnBajG1,  "DISABLE";
     |ESTADO_CONTROL enBtnRetG1,  "DISABLE";
     |ESTADO_CONTROL enBtnInfG1,  "DISABLE";

     |SI enModo = 4;
         |ESTADO_CONTROL enBtnAltG1, "DISABLE";
     |FINSI;
|FPRC;

|PROCESO BajaGrid1;
     #socm0003#0 = enEmpresa;
     #socm0003#1 = 1;
|FPRC;

|PROCESO AltaGrid1;
     #socm0003#0 = enEmpresa;
     #socm0003#1 = 99999;
|FPRC;

|PROGRAMA;

     |HAZ BusquedaApli;
     |SI eaPathContagen ! "";
         |HAZ SituaMaestra;
         |SI swerror = 1;
             |MENAV "    Atencion, no existe Contabilidad ni de esta Empresa ni de Empresa Maestra";
             |ACABA;
         |FINSI;
         |PATH_DAT #cacuenta#aPathConta#;
     |FINSI;

     aQueQuiero  = "|NC";
     aNumCampos  = #socw0005#aQueQuiero#;
     enNumCampos = aNumCampos;
     enNumCampos = enNumCampos - 1;

     |PINPA #0#socw0005;  enPanta = FSalida;

     |HAZ BtnsGrid1;

     |DDEFECTO #socm0003;
     |HAZ PintaDatosPantalla;

     nRango = 4 + 8 + 16 + 32 + 128;

     |LINEAL_SIMPLE #1#socm0003, nRango, 0602, 1698, BajaGrid1, AltaGrid1, EventoGrid1;
     enGrid1 = FSalida;

     aEsc1  = &255 + "806";
     aEsc2  = &255 + "807";
     aRetu  = &255 + "802";
     |PARA; |SI;  |HACIENDO;
          FSalida = "::{{001}}Salir," + enGrid1;
          |LEETECLA aTecla;
          |SI aTecla = aEsc1; |SAL;  |FINSI;
          |SI aTecla = aEsc2; |SAL;  |FINSI;
          |SI aTecla = aRetu; |SAL;  |FINSI;
     |SIGUE;
|FPRO;

|PROCESO LeeFicha;
     enReg = 0;

     |ABRE #agim0019;
     #agim0019#0 = enEmpresa;
     #agim0019#1 = 100;
     |LEE 000#agim0019.];
     |SI FSalida = 0;
         |LEE 000#agim0019.a;
     |SINO;
         |LEE 000#agim0019.u;
     |FINSI;

     |SI FSalida = 0;  |Y #agim0019#0 = enEmpresa;
         enReg = #agim0019#1;
     |FINSI;

     |CIERRA #agim0019;
|FPRC;

|PROCESO Tipo80Fsocm3;  |TIPO 80;
     |HAZ LeeUnidadBasico;

     aAlfa = PARAMETRO % 105;   enEmpresa = aAlfa;
     aAlfa = PARAMETRO % 601;   enModo    = aAlfa;
     |HAZ LeeFicha;

     |ABRET #socm0003;
     |ABRET #socm0004;

     FSalida = 3799;
|FPRC;

|PROCESO Tipo90Fsocm3;  |TIPO 90;
     |CIERRAT #socm0003;
     |CIERRAT #socm0004;
|FPRC;
