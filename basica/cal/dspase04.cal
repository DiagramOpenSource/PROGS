|FICHEROS;
     dspase00 #0;
     dspase04 #4;
     dspase15 #15;

     dspase22 #22;

     dspase96 #96;
     dspase97 #97;

     dspase95 #95,MANTE;
     dspase98 #98,MANTE;

     :/basica/def/agicen14   #114;
     :/modelos/def/dsmom100  #100;
     :/contagen/def/ca8ctrle #400;

     &referen@ #999;
      refecon@ #998;
      refebue@ #997;
      refeesp@ #996;

      emcarte@;
|FIN;

|VARIABLES;
     aBase             = "";
     aDirecBuscar      = "";
     aFichero          = "";
     aDef              = "";
     aOrigen           = "";
     aDestino          = "";
     aFicheroOrigen    = "";
     aFicheroDestino   = "";
     nPara1            = 0;
     aAlfa             = "";
     aAlfa1            = "";
     aAlfa2            = "";
     aAlfa3            = "";
     aPathAnterior     = "";
     aPathOrigen       = "";
     aPathDestino      = "";
     aDirFichPatron    = "";
     aDirFichOrigen    = "";
     aDirFichDestino   = "";
     aDirEmpresaN      = "";
     aDirEmpresaV      = "";
     aPath000000       = "";
     aPathPases        = "";

     aF2               = "";
     aF3               = "";
     aF4               = "";
     aF5               = "";
     aF6               = "";
     aF7               = "";
     aF8               = "";
     aF9               = "";
     aF10              = "";
     aDActivos         = "";
     aHActivos         = "";
     aActivar          = "";
     aConcepto         = "";
     aHora             = "";
     aAbre             = "";

     nPerConcep        = 0;
     nHandle           = 0;
     nSwCopiar         = 0;
     nSwEsFichero      = 0;
     nSwAplicacion     = 0;
     nSwCoger          = 0;
     nCampos           = 0;
     nEmpresa          = 0;
     nEmpresaDef       = 0;
     nCodigo           = 0;
     nValorEmpre       = 0;
     nValorRegis       = 0;
     nLinea            = 0;
     nLineaA           = 0;
     nLineaC           = 0;
     nActiv            = 0;
     nSwEsta           = 0;
     nAgrupa           = 0;
     nFactor           = 0;
     nDEmpresa         = 0;
     nHEmpresa         = 0;
     nDPeriodo         = 0;
     nHPeriodo         = 0;
     nSwGraba          = 0
     nNume             = 0;
     nCanal            = 0;
     nEjer             = 0;
     nTecla            = 0;
     nDEjer            = 0;
     nHEjer            = 0;
     nCampo            = 0;
     nEmpreContab      = 0;
     nEmprePasada      = 0;
     nHoraInicial      = 0;
     nHoraFinal        = 0;
     nHora             = 0;
     nMinuto           = 0;
     nResto            = 0;
     nHoraTrabajo      = 0;
     nFecha            = 0;
     nHoraEmpieza      = 0;
     nMinuEmpieza      = 0;
     nSeguEmpieza      = 0;
     nHoraTermina      = 0;
     nMinuTermina      = 0;
     nSeguTermina      = 0;
     nTContab          = 0;
     nTEmpieza         = 0;
     nTTermina         = 0;
     nTAcum            = 0;
     nCodigoNue        = 0;
     nCodigoCon        = 0;
     nEstaCambio       = 0;
     nHastaCampo       = 0;

     nSwVale           = 0;
     aQueQuiero        = "";
     aNumCampos        = "";
     nNumCampos        = 0;
     aLongCampo        = "";
     nLongCampo        = 0;

     &enEmpresa        = 0;
     &enEmpresaV       = 0;
     &enPeriodo        = 0;
     &enPeriodoV       = 0;
     &enEjerConta      = 0;
     &eaEmpresa        = "";
     &eaBase           = "";
     &eaAplica         = "";
     &enForzar         = 0;
     &eaMoneda         = "";
     &eaMonedaV        = "";

     &eaPathBasica     = "";
     &eaPathContagen   = "";
     &eaPathContanex   = "";
     &eaPathContasoc   = "";
     &eaPathDscarter   = "";
     &eaPathRen2000    = "";
     &eaPathRen1999    = "";
     &eaPathRen1998    = "";
     &eaPathRen1997    = "";
     &eaPathRen1996    = "";
     &eaPathRen1995    = "";
     &eaPathRen1994    = "";
     &eaPathFacturar   = "";
     &eaPathLaboral    = "";
     &eaPathIntegral   = "";
     &eaPathDsmodelo   = "";
     &eaPathFiscal     = "";
     aPathAgicli       = "";
     aPathAgieos       = "";

     aPathCartera    = "";
     nSwLaFuncion    = 0;
     &eSwCambio      = 0;

     aCartera        = "";
     nPerioNue       = 0;
     nExiste         = 0;
     nSwExiste       = 0;
     nNume1          = 0;
     nEstado         = 0;
     nAnterior       = 0;
     &eaPreg22_1     = "";
     &eaPreg22_2     = "";
     &eaPreg22_5     = "";
     &eaPreg22_6     = "";
     &eaPreg22_7     = "";
     &eaPreg22_8     = "";
     nPerConta       = 0;
     &eaPPortadaX    = "";
     &eaPPortadaO    = "";
     &eaPPortadaD    = "";

     &enEmpCartera = 0;
     &eaDirAgicont = "";
     &enEmpAgicont = 0;
     &enPerAgicont = 0;
     &enERP = 0;
|FIN;

|PROCESO GrabaMoneda;
     aDef = aPathDestino + "def/camoneda.mas";
     |CARGA_DEF aDef, referen@;
     |SI FSalida ! 0;
         eaMoneda = "E";
     |SINO;
         aPath000000  = aPathOrigen + "fich/000000/";
         |PATH_DAT #999 aPath000000;
         |ABRE #999;
         #999#0 = #98#6;
         #999#1 = #98#1;
         |LEE 040#999=;
         |SI FSalida ! 0;
             eaMoneda = "E";
         |SINO;
             eaMoneda = #999#2;
         |FINSI;
         eaMonedaV = eaMoneda;
         |CIERRA #999;

         aPath000000  = aPathDestino + "fich/000000/";
         |PATH_DAT #999 aPath000000;
         |ABRE #999;
         #999#0 = #98#0;
         #999#1 = #98#8;
         |LEE 101#999=;
         |SI FSalida ! 0;     |GRABA 020#999b;    |FINSI;
         #999#2 = eaMoneda;
         |GRABA 020#999a;
         |LIBERA #999;
         |CIERRA #999;

         |DESCARGA_DEF #referen@;
     |FINSI;

     |DBASS eaBase;  |QBF eaBase;
     enForzar = 1;

     |SUB_EJECUTA_NP ":agitool/dsconver";

     |PULSATECLA;
|FPRC;

|PROCESO Graba8Ctrle;
     aDef = aPathOrigen + "def/ca8ctrle.mas";
     |CARGA_DEF aDef, referen@;
     |SI FSalida = 0;
         aPath000000  = aPathOrigen + "fich/000000/";
         |PATH_DAT #999 aPath000000;
         |ABRE #999;
         #999#0 = #98#6;
         #999#1 = #98#1;
         |LEE 040#999=;
         |SI FSalida = 0;
             |ABRE #400;
             #400#0 = #98#0;
             #400#1 = #98#8;
             |LEE 101#400=;
             |SI FSalida ! 0;
                 #400#0 = #98#0;
                 #400#1 = #98#8;
                 |GRABA 020#400b;
             |FINSI;
             #400#2 = #999#2;
             #400#3 = #98#0;   ||asumo el mismo numero de empresa por si ha cambiado
             #400#4 = #999#4;
             #400#5 = #999#5;
             #400#6 = #999#6;
             #400#7 = #999#7;
             |GRABA 020#400a;
             |LIBERA #400;
             |CIERRA #400;
         |FINSI;
         |CIERRA #999;
         |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|| ________________________________________________________________________
|| Proceso del Calculo de Tiempo Finalizacion del Pase
|| ________________________________________________________________________

|PROCESO CalculaTiempo;
     |HORA aHora;
     #4#8  = ~;
     aAlfa = aHora % 102;  #4#9  = aAlfa;
     aAlfa = aHora % 402;  #4#10 = aAlfa;

     #4#14        = (nEmpreContab - nEmprePasada);
     #4#15        = nTContab;
     nHoraFinal   = #4#14 * nTContab;
     nHora        = ((nHoraFinal / 3600) - .5) ! 0;
     nResto       = (nHoraFinal / 3600) - nHora;
     nMinuto      = (nResto * 60) ! 0;

     #4#11        = #4#5;
     #4#12        = #4#9  + nHora;
     #4#13        = #4#10 + nMinuto;

     |SI #4#13 ] 60;
         |PARA;  |SI;  |HACIENDO;
              |SI #4#13 ] 60;
                  #4#12  = #4#12 + 1;
                  #4#13  = #4#13 - 60;
              |SINO;
                  |SAL;
              |FINSI;
         |SIGUE;
     |FINSI;

     |SI #4#12 ] 24;
         |PARA;  |SI;  |HACIENDO;
              |SI #4#12 ] 24;
                  nFecha = #4#11;
                  nFecha = nFecha + 1;
                  #4#11  = nFecha;
                  #4#12  = #4#12 - 24;
              |SINO;
                  |SAL;
              |FINSI;
         |SIGUE;
     |FINSI;

     |PINTA #4#8;
     |PINTA #4#9;
     |PINTA #4#10;
     |PINTA #4#11;
     |PINTA #4#12;
     |PINTA #4#13;
     |PINTA #4#14;
     |PINTA #4#15;
|FPRC;

|PROCESO EmpiezaEmpresa;
     |HORA aHora;
     aAlfa = aHora % 102;  nHoraEmpieza  = aAlfa;
     aAlfa = aHora % 402;  nMinuEmpieza  = aAlfa;
     aAlfa = aHora % 702;  nSeguTermina  = aAlfa;
|FPRC;

|PROCESO TerminaEmpresa;
     nEmprePasada = nEmprePasada + 1;
     |HORA aHora;
     aAlfa = aHora % 102;  nHoraTermina  = aAlfa;
     aAlfa = aHora % 402;  nMinuTermina  = aAlfa;
     aAlfa = aHora % 702;  nSeguTermina  = aAlfa;

     nTTermina = (nHoraTermina * 3600) + (nMinuTermina * 60) + nSeguTermina;
     nTEmpieza = (nHoraEmpieza * 3600) + (nMinuEmpieza * 60) + nSeguEmpieza;
     |SI nTEmpieza > nTTermina;
         nTTermina = nTTermina + 86400;
     |FINSI;

     nTAcum   = nTAcum + (nTTermina - nTEmpieza);
     nTContab = nTAcum / nEmprePasada;

     |HAZ CalculaTiempo;
|FPRC;

|| ________________________________________________________________________
|| Proceso del Temporal de Seleccion de Empresas
|| ________________________________________________________________________

|PROCESO Borrado;
     aDirEmpresaN    = (("00000" + #95#0) % -105) + #95#1 + "/";
     aDirFichDestino = aPathDestino + "fich/" + aDirEmpresaN;

     aDirecBuscar = aDirFichDestino + "*";
     |_PDIR aDirecBuscar;
     |PARA; |SI FSalida = 0; |HACIENDO;
            |FBORRA aDirecBuscar;

            |_SDIR aDirecBuscar;
     |SIGUE;

     |RMDIR aDirFichDestino;
|FPRC;

|PROCESO BorraEmpresa;  |TIPO 11;
     |SI FSalida ! 10;  |ACABA;  |FINSI;


     |CONFI "0000NEsta seguro de Borrar la Empresa y dejarla como no pasada ";
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |SI #95#7 = "S";
         |MENAV "0000Los datos de cartera pasados anteriormente no se borraran.";
         |CONFI "0000Desea continuar con el proceso";
         |SI FSalida ! 0;  |ACABA;  |FINSI;
     |FINSI;

     |HAZ Borrado;

     |DDEFECTO #98;
     #98#0 = #95#0;
     #98#1 = #95#6;
     #98#2 = #95#2;
     #98#3 = #95#3;
     |SI #22#3 = "S"; #98#5 = #22#3; |FINSI;
     #98#6 = #95#4;
     #98#7 = #95#5;
     #98#8 = #95#1;
     #98#10 = #95#7;
     |GRABA 020#98n;
     |LIBERA #98;

     |LEE 101#95=;
     |BORRA 020#95a;
     |LIBERA #95;

     |PONCONTROL 23, "SI";
|FPRC;


|PROCESO Comprobar;
  nAnterior = Contenido;
||  |SI #98#8 = nAnterior; |ACABA; |FINSI;

  |ABRE #95;
  #95#0 = #98#0;
  #95#1 = #98#8;
  |LEE 001#95=;
  |SI FSalida = 0;
      |CIERRA #95;
      |MENAV "    Esta Empresa y Periodo Ya estan Creados ";
      |ERROR;
      |ACABA;
  |FINSI;
  |CIERRA #95;

  |ABRE #997;
  #997#2 = #98#0;
  #997#3 = nAnterior;
  |LEE 101#997=;
  |SALVA_DATOS #997;

  #997#2 = #98#0;
  #997#3 = #98#8;
  |LEE 101#997=;
  nEstado = FSalida;
  |SI nEstado = 0; |Y #997#26 ! #98#2;
      |CONFI "    NERROR. Existe este periodo con otro Ejercicio. Continuar ?";
      |SI FSalida ! 0;
          |ERROR;
          |LIBERA #997;
          |REPON_DATOS #997;
          |CIERRA #997;
          |ACABA;
      |FINSI;
  |FINSI;

      |REPON_DATOS #997;
      #997#2  = #98#0;
      #997#3  = #98#8;
      nNume   = (#997#2 * 10) + #997#3;
      #997#0  = nNume;
      #997#26 = #98#2;
      |SI nEstado = 0; |GRABA 020#997a; |FINSI;
      |SI nEstado ! 0; |GRABA 020#997n; |FINSI;
      |LIBERA #997;

      |SI nAnterior ! #98#8;
          #997#2 = #98#0;
          #997#3 = nAnterior;
          |LEE 001#997=;
          |SI FSalida = 0; |Y #997#26 = #98#2;
              |BORRA 020#997a;
          |FINSI;
      |FINSI;
  |CIERRA #997;
|FPRC;

|PROCESO PonCampos;
     |SI nCampo = 4;  |Y aActivar = "N";
         #98#5 = "N";
     |FINSI;

     #98nCampo = aActivar;
     |GRABA 020#98a;
     |LIBERA #98;
|FPRC;

|DEFBUCLE dspase98R;
     #98#1;
     2, 4;
     00000, 0, nDEjer, aDActivos;
     99999, 9, nHEjer, aHActivos;
     be;
     NULL, PonCampos;
|FIN;

|PROCESO Borra98;
     |SI #98#4 = "N";
         |BORRA 020#98a;
         |LIBERA #98;

         |SELECT #1#997;
         #997#2 = #98#0;
         #997#3 = #98#8;
         |LEE 101#997=;
         |SI FSalida = 0; |Y #997#26 = #98#2;
             |BORRA 020#997a;
         |FINSI;
         |LIBERA #997;

         |ACABA;
     |FINSI;

     nEmpreContab = nEmpreContab + 1;
|FPRC;

|DEFBUCLE dspase98B;
     #98#1;
     ;
     00000, 0;
     99999, 9;
     be;
     NULL, Borra98;
|FIN;

|RUTINA ClaveBaja95;
     #95#0 = 00001;
     #95#1 = 0;
|FRUT;

|RUTINA ClaveAlta95;
     #95#0 = 99999;
     #95#1 = 9;
|FRUT;

|PROCESO Funciones;  |TIPO 11;
     |SI FSalida = 10;
         |PUSHV  0501 2380
         |CUADRO 0801 2380;
         |BLANCO 0902 2279;
         |CUADRO 1009 2176;

         |ATRI S;
         |PINTA 1110, "[F2] Activar    realizacion del Pase Todas las Empresas";
         |PINTA 1210, "[F3] Desactivar realizacion del Pase Todas las Empresas";
         |PINTA 1310, "[F4] Activar    realizacion del Pase por Ejercicio     ";
         |PINTA 1410, "[F5] Desactivar realizacion del Pase por Ejercicio     ";
         |PINTA 1510, "[F6] Activar    cambio de Conceptos para todos los Activados";
         |PINTA 1610, "[F7] Desactivar cambio de Conceptos para todos los Activados";
         |PINTA 1710, "[F8] Activar    cambio de Conceptos por Ejercicio ";
         |PINTA 1810, "[F9] Desactivar cambio de Conceptos por Ejercicio ";
         |ATRI s;

         aF2        = &255 + "824";
         aF3        = &255 + "825";
         aF4        = &255 + "826";
         aF5        = &255 + "827";
         aF6        = &255 + "828";
         aF7        = &255 + "829";
         aF8        = &255 + "830";
         aF9        = &255 + "831";

         nTecla = 0;
         |LEETECLA aAlfa;
         |SI aAlfa = aF2;   nTecla = 10;  |FINSI;
         |SI aAlfa = aF3;   nTecla = 11;  |FINSI;
         |SI aAlfa = aF4;   nTecla = 12;  |FINSI;
         |SI aAlfa = aF5;   nTecla = 13;  |FINSI;
         |SI aAlfa = aF6;   nTecla = 14;  |FINSI;
         |SI aAlfa = aF7;   nTecla = 15;  |FINSI;
         |SI aAlfa = aF8;   nTecla = 16;  |FINSI;
         |SI aAlfa = aF9;   nTecla = 17;  |FINSI;

         nDEjer = 00;
         nHEjer = 99;
         |SI nTecla = 12;  |O nTecla = 13; |O nTecla = 16; |O nTecla = 17;
             |PINTA 2010, "Introduzca el Ejercicio : ";
             E_inf = 0;
             E_sup = 99;
             nEjer = 2036 ? 0;

             nDEjer = nEjer;
             nHEjer = nEjer;
         |FINSI;

         |POPV;

         |SI nTecla = 10;  aDActivos = "N";  aHActivos = "N";  nCampo = 4; aActivar = "S"; |FINSI;
         |SI nTecla = 11;  aDActivos = "S";  aHActivos = "S";  nCampo = 4; aActivar = "N"; |FINSI;
         |SI nTecla = 12;  aDActivos = "N";  aHActivos = "N";  nCampo = 4; aActivar = "S"; |FINSI;
         |SI nTecla = 13;  aDActivos = "S";  aHActivos = "S";  nCampo = 4; aActivar = "N"; |FINSI;
         |SI nTecla = 14;  aDActivos = "S";  aHActivos = "S";  nCampo = 5; aActivar = "S"; |FINSI;
         |SI nTecla = 15;  aDActivos = "S";  aHActivos = "S";  nCampo = 5; aActivar = "N"; |FINSI;
         |SI nTecla = 16;  aDActivos = "S";  aHActivos = "S";  nCampo = 5; aActivar = "S"; |FINSI;
         |SI nTecla = 17;  aDActivos = "S";  aHActivos = "S";  nCampo = 5; aActivar = "N"; |FINSI;

         |SI nTecla ! 0;
             |BUCLE dspase98R;
         |FINSI;

         |PONCONTROL 23, "SI";

         |PTEC 812;

         FSalida = 0;
     |FINSI;

     |SI FSalida = 11;
         |ENTLINEAL #1#95, -1, 4, 22, 0, ClaveBaja95, ClaveAlta95;
         |PONCONTROL 23, "SI";
         |PTEC 812;
     |FINSI;

     |SI FSalida = 12;
         |SI nSwLaFuncion = 0;
             nSwLaFuncion = 1;
             |ATRI P;|PINTA 0502, "Activar Tabla Concepto";|ATRI 0;
         |SINO;
             nSwLaFuncion = 0;
             |PINTA 0502, "ÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄ";
         |FINSI;
         |ERROR;
     |FINSI;
|FPRC;

|| ________________________________________________________________________
|| Proceso Cambio de Conceptos;
|| ________________________________________________________________________

|PROCESO caconci2;
     |SI nEmpresa = 0;
         #97#0 = 0;
         #97#1 = nPerConta;
         #97#2 = #999#2;
         #97#3 = 0;
     |SINO;
         #97#0 = #98#0;
         #97#1 = #98#1;
         #97#2 = #999#2;
         #97#3 = 0;
     |FINSI;
     |LEE 040#97];
     |SI FSalida = 0;  |Y #97#2 = #999#2;
         #999#2 = #97#4;
         |GRABA 020#999a;
     |FINSI;
     |LIBERA #999;
|FPRC;

|DEFBUCLE caconci2;
     #999#1002;
     ;
     00000, 00;
     99999, 99;
     be;
     NULL, caconci2;
|FIN;

|PROCESO caconcim;
     |SI nEmpresa = 0;
         #97#0 = 0;
         #97#1 = nPerConta;
         #97#2 = #999#4;
         #97#3 = 0;
     |SINO;
         #97#0 = #98#0;
         #97#1 = #98#1;
         #97#2 = #999#4;
         #97#3 = 0;
     |FINSI;
     |LEE 040#97];
     |SI FSalida = 0;  |Y #97#2 = #999#4;
         #999#4 = #97#4;
     |FINSI;

     |SI nEmpresa = 0;
         #97#0 = 0;
         #97#1 = nPerConta;
         #97#2 = #999#7;
         #97#3 = 0;
     |SINO;
         #97#0 = #98#0;
         #97#1 = #98#1;
         #97#2 = #999#7;
         #97#3 = 0;
     |FINSI;
     |LEE 040#97];
     |SI FSalida = 0;  |Y #97#2 = #999#7;
         #999#7 = #97#4;
     |FINSI;

     |GRABA 020#999a;
     |LIBERA #999;
|FPRC;

|DEFBUCLE caconcim;
     #999#1001;
     ;
     00000;
     99999;
     be;
     NULL, caconcim;
|FIN;

|PROCESO caentasl;
     |SI nEmpresa = 0;
         #97#0 = 0;
         #97#1 = nPerConta;
         #97#2 = #999#6;
         #97#3 = #999#11;
     |SINO;
         #97#0 = #98#0;
         #97#1 = #98#1;
         #97#2 = #999#6;
         #97#3 = #999#11;
     |FINSI;
     |LEE 040#97];
     |SI FSalida = 0; |Y #97#2 = #999#6;
         #999#6 = #97#4;
         #999#7 = #97#5;
         |GRABA 020#999a;
     |FINSI;
     |LIBERA #999;
|FPRC;

|DEFBUCLE caentasl;
     #999#1002;
     ;
     "        ", 00000;
     "zzzzzzzz", 99999;
     be;
     NULL, caentasl;
|FIN;

|PROCESO cainliva;
     |SI nEmpresa = 0;
         #97#0 = 0;
         #97#1 = nPerConta;
         #97#2 = #999#7;
         #97#3 = #999#0;
     |SINO;
         #97#0 = #98#0;
         #97#1 = #98#1;
         #97#2 = #999#7;
         #97#3 = #999#0;
     |FINSI;
     |LEE 040#97];
     |SI FSalida = 0; |Y #97#2 = #999#7;
         #999#7 = #97#4;
         #999#8 = #97#5;
     |FINSI;

     |SI nEmpresa = 0;
         #97#0 = 0;
         #97#1 = nPerConta;
         #97#2 = #999#43;
         #97#3 = #999#0;
     |SINO;
         #97#0 = #98#0;
         #97#1 = #98#1;
         #97#2 = #999#43;
         #97#3 = #999#0;
     |FINSI;
     |LEE 040#97];
     |SI FSalida = 0; |Y #97#2 = #999#43;
         #999#43 = #97#4;
         #999#44 = #97#5;
     |FINSI;

     |GRABA 020#999a;
     |LIBERA #999;
|FPRC;

|DEFBUCLE cainliva;
     #999#1002;
     ;
     00, 000;
     99, 999;
     be;
     NULL, cainliva;
|FIN;

|PROCESO caivaasi;
     |ABRE #999;
     |LEE 101#999p;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

    |SI nEmpresa = 0;
         #97#0 = 0;
         #97#1 = nPerConta;
         #97#2 = #999#5;
         #97#3 = #999#3;
     |SINO;
         #97#0 = #98#0;
         #97#1 = #98#1;
         #97#2 = #999#5;
         #97#3 = #999#3;
     |FINSI;
     |LEE 040#97];
     |SI FSalida = 0; |Y #97#2 = #999#5;
         #999#5 = #97#4;
         #999#7 = #97#5;
     |FINSI;

     |SI nEmpresa = 0;
         #97#0 = 0;
         #97#1 = nPerConta;
         #97#2 = #999#31;
         #97#3 = #999#29;
     |SINO;
         #97#0 = #98#0;
         #97#1 = #98#1;
         #97#2 = #999#31;
         #97#3 = #999#29;
     |FINSI;
     |LEE 040#97];
     |SI FSalida = 0; |Y #97#2 = #999#31;
         #999#31 = #97#4;
         #999#33 = #97#5;
     |FINSI;

     |SI nEmpresa = 0;
         #97#0 = 0;
         #97#1 = nPerConta;
         #97#2 = #999#13;
         #97#3 = 0;
     |SINO;
         #97#0 = #98#0;
         #97#1 = #98#1;
         #97#2 = #999#13;
         #97#3 = 0;
     |FINSI;
     |LEE 040#97];
     |SI FSalida = 0; |Y #97#2 = #999#13;
         #999#13 = #97#4;
         #999#15 = #97#5;
     |FINSI;

     |SI nEmpresa = 0;
         #97#0 = 0;
         #97#1 = nPerConta;
         #97#2 = #999#50;
         #97#3 = 0;
     |SINO;
         #97#0 = #98#0;
         #97#1 = #98#1;
         #97#2 = #999#50;
         #97#3 = 0;
     |FINSI;
     |LEE 040#97];
     |SI FSalida = 0; |Y #97#2 = #999#50;
         #999#50 = #97#4;
         #999#51 = #97#5;
     |FINSI;

     |SI nEmpresa = 0;
         #97#0 = 0;
         #97#1 = nPerConta;
         #97#2 = #999#54;
         #97#3 = 0;
     |SINO;
         #97#0 = #98#0;
         #97#1 = #98#1;
         #97#2 = #999#54;
         #97#3 = 0;
     |FINSI;
     |LEE 040#97];
     |SI FSalida = 0; |Y #97#2 = #999#54;
         #999#54 = #97#4;
         #999#55 = #97#5;
     |FINSI;

     |GRABA 020#999a;
     |LIBERA #999;
     |CIERRA #999;
|FPRC;

|PROCESO camaniva;
     |SI nEmpresa = 0;
         #97#0 = 0;
         #97#1 = nPerConta;
         #97#2 = #999#27;
         #97#3 = #999#0;
     |SINO;
         #97#0 = #98#0;
         #97#1 = #98#1;
         #97#2 = #999#27;
         #97#3 = #999#0;
     |FINSI;
     |LEE 040#97];
     |SI FSalida = 0; |Y #97#2 = #999#27;
         #999#27 = #97#4;
     |FINSI;

     |SI nEmpresa = 0;
         #97#0 = 0;
         #97#1 = nPerConta;
         #97#2 = #999#29;
         #97#3 = #999#0;
     |SINO;
         #97#0 = #98#0;
         #97#1 = #98#1;
         #97#2 = #999#29;
         #97#3 = #999#0;
     |FINSI;
     |LEE 040#97];
     |SI FSalida = 0; |Y #97#2 = #999#29;
         #999#29 = #97#4;
     |FINSI;

     |GRABA 020#999a;
     |LIBERA #999;
|FPRC;

|DEFBUCLE camaniva;
     #999#1002;
     ;
     00, 0000000001;
     99, 9999999999;
     be;
     NULL, camaniva;
|FIN;

|PROCESO caivalin;
     |SI nEmpresa = 0;
         #97#0 = 0;
         #97#1 = nPerConta;
         #97#2 = #999#3;
         #97#3 = #999#0;
     |SINO;
         #97#0 = #98#0;
         #97#1 = #98#1;
         #97#2 = #999#3;
         #97#3 = #999#0;
     |FINSI;
     |LEE 040#97];
     |SI FSalida = 0; |Y #97#2 = #999#3;
         #999#3 = #97#4;
         |GRABA 020#999a;
     |FINSI;
     |LIBERA #999;
|FPRC;

|DEFBUCLE caivalin;
     #999#1003;
     ;
     00, 0000000001, 01;
     99, 9999999999, 99;
     be;
     NULL, caivalin;
|FIN;

|PROCESO cagruiva;

    |PARA nPara1 = 32; |SI nPara1 [ 46; |HACIENDO nPara1 = nPara1 + 1;
          |SI nEmpresa = 0;
              #97#0 = 0;
              #97#1 = nPerConta;
              #97#2 = #999nPara1;
              #97#3 = 0;
          |SINO;
              #97#0 = #98#0;
              #97#1 = #98#1;
              #97#2 = #999nPara1;
              #97#3 = 0;
          |FINSI;
          |LEE 040#97];
          |SI FSalida = 0; |Y #97#2 = #999nPara1;
              #999nPara1 = #97#4;
          |FINSI;
    |SIGUE;

    |GRABA 020#999a;
    |LIBERA #999;
|FPRC;

|DEFBUCLE cagruiva;
     #999#1001;
     ;
     00;
     99;
     be;
     NULL, cagruiva;
|FIN;

|PROCESO cajainli;
     |SI nEmpresa = 0;
         #97#0 = 0;
         #97#1 = nPerConta;
         #97#2 = #999#6;
         #97#3 = 0;
     |SINO;
         #97#0 = #98#0;
         #97#1 = #98#1;
         #97#2 = #999#6;
         #97#3 = 0;
     |FINSI;
     |LEE 040#97];
     |SI FSalida = 0;  |Y #97#2 = #999#6;
         #999#6 = #97#4;
         |GRABA 020#999a;
     |FINSI;
     |LIBERA #999;
|FPRC;

|DEFBUCLE cajainli;
     #999#1002;
     ;
     "01.01.0000", 0000;
     "31.12.2999", 9999;
     be;
     NULL, cajainli;
|FIN;

|PROCESO cajasald;
    |ABRE #999;
    |LEE 101#999p;
    |SI FSalida ! 0;  |ACABA;  |FINSI;

    |SI nEmpresa = 0;
         #97#0 = 0;
         #97#1 = nPerConta;
         #97#2 = #999#4;
         #97#3 = 0;
     |SINO;
         #97#0 = #98#0;
         #97#1 = #98#1;
         #97#2 = #999#4;
         #97#3 = 0;
     |FINSI;
     |LEE 040#97];
     |SI FSalida = 0; |Y #97#2 = #999#4;
         #999#4 = #97#4;
     |FINSI;

     |SI nEmpresa = 0;
         #97#0 = 0;
         #97#1 = nPerConta;
         #97#2 = #999#5;
         #97#3 = 0;
     |SINO;
         #97#0 = #98#0;
         #97#1 = #98#1;
         #97#2 = #999#5;
         #97#3 = 0;
     |FINSI;
     |LEE 040#97];
     |SI FSalida = 0; |Y #97#2 = #999#5;
         #999#5 = #97#4;
     |FINSI;

     |GRABA 020#999a;
     |LIBERA #999;
     |CIERRA #999;
|FPRC;

|PROCESO camaasil;
     |SI nEmpresa = 0;
         #97#0 = 0;
         #97#1 = nPerConta;
         #97#2 = #999#6;
         #97#3 = #999#13;
     |SINO;
         #97#0 = #98#0;
         #97#1 = #98#1;
         #97#2 = #999#6;
         #97#3 = #999#13;
     |FINSI;
     |LEE 040#97];
     |SI FSalida = 0; |Y #97#2 = #999#6;
         #999#6 = #97#4;
         |GRABA 020#999a;
     |FINSI;
     |LIBERA #999;
|FPRC;

|DEFBUCLE camaasil;
     #999#1004;
     ;
     00, "01.01.0000", 000001, 0000;
     99, "31.12.2999", 999999, 9999;
     be;
     NULL, camaasil;
|FIN;

|PROCESO camautol;
     |SI nEmpresa = 0;
         #97#0 = 0;
         #97#1 = nPerConta;
         #97#2 = #999#4;
         #97#3 = 0;
     |SINO;
         #97#0 = #98#0;
         #97#1 = #98#1;
         #97#2 = #999#4;
         #97#3 = 0;
     |FINSI;
     |LEE 040#97];
     |SI FSalida = 0;  |Y #97#2 = #999#4;
         #999#4 = #97#4;
         |GRABA 020#999a;
     |FINSI;
     |LIBERA #999;
|FPRC;

|DEFBUCLE camautol;
     #999#1002;
     ;
     00001, 0000;
     99999, 9999;
     be;
     NULL, camautol;
|FIN;

|PROCESO camaylin;
     |SI nEmpresa = 0;
         #97#0 = 0;
         #97#1 = nPerConta;
         #97#2 = #999#6;
         #97#3 = 0;
     |SINO;
         #97#0 = #98#0;
         #97#1 = #98#1;
         #97#2 = #999#6;
         #97#3 = 0;
     |FINSI;
     |LEE 040#97];
     |SI FSalida = 0;  |Y #97#2 = #999#6;
         #999#6 = #97#4;
         |GRABA 020#999a;
     |FINSI;
     |LIBERA #999;
|FPRC;

|DEFBUCLE camaylin;
     #999#1004;
     ;
     00, "01.01.0000", 000001, 0000;
     99, "31.12.2999", 999999, 9999;
     be;
     NULL, camaylin;
|FIN;

|PROCESO capasven;
     |SI nEmpresa = 0;
         #97#0 = 0;
         #97#1 = nPerConta;
         #97#2 = #999#15;
         #97#3 = #999#5;
     |SINO;
         #97#0 = #98#0;
         #97#1 = #98#1;
         #97#2 = #999#15;
         #97#3 = #999#5;
     |FINSI;
     |LEE 040#97];
     |SI FSalida = 0; |Y #97#2 = #999#15;
         #999#15 = #97#4;
     |FINSI;

     |SI nEmpresa = 0;
         #97#0 = 0;
         #97#1 = nPerConta;
         #97#2 = #999#16;
         #97#3 = #999#5;
     |SINO;
         #97#0 = #98#0;
         #97#1 = #98#1;
         #97#2 = #999#16;
         #97#3 = #999#5;
     |FINSI;
     |LEE 040#97];
     |SI FSalida = 0; |Y #97#2 = #999#16;
         #999#16 = #97#4;
     |FINSI;

     |SI nEmpresa = 0;
         #97#0 = 0;
         #97#1 = nPerConta;
         #97#2 = #999#17;
         #97#3 = #999#5;
     |SINO;
         #97#0 = #98#0;
         #97#1 = #98#1;
         #97#2 = #999#17;
         #97#3 = #999#5;
     |FINSI;
     |LEE 040#97];
     |SI FSalida = 0; |Y #97#2 = #999#17;
         #999#17 = #97#4;
     |FINSI;

     |GRABA 020#999a;
     |LIBERA #999;
|FPRC;

|DEFBUCLE capasven;
     #999#1001;
     ;
     00;
     99;
     be;
     NULL, capasven;
|FIN;

|PROCESO casieali;
     |SI nEmpresa = 0;
         #97#0 = 0;
         #97#1 = nPerConta;
         #97#2 = #999#5;
         #97#3 = 0;
     |SINO;
         #97#0 = #98#0;
         #97#1 = #98#1;
         #97#2 = #999#5;
         #97#3 = 0;
     |FINSI;
     |LEE 040#97];  |Y #97#2 = #999#5;
     |SI FSalida = 0;
         #999#5 = #97#4;
         |GRABA 020#999a;
     |FINSI;
     |LIBERA #999;
|FPRC;

|DEFBUCLE casieali;
     #999#1002;
     ;
     0000, 00;
     9999, 99;
     be;
     NULL, casieali;
|FIN;

|PROCESO cientasl;
     |SI nEmpresa = 0;
         #97#0 = 0;
         #97#1 = nPerConta;
         #97#2 = #999#4;
         #97#3 = 0;
     |SINO;
         #97#0 = #98#0;
         #97#1 = #98#1;
         #97#2 = #999#4;
         #97#3 = 0;
     |FINSI;
     |LEE 040#97];
     |SI FSalida = 0;  |Y #97#2 = #999#4;
         #999#4 = #97#4;
     |FINSI;

     |SI nEmpresa = 0;
         #97#0 = 0;
         #97#1 = nPerConta;
         #97#2 = #999#10;
         #97#3 = 0;
     |SINO;
         #97#0 = #98#0;
         #97#1 = #98#1;
         #97#2 = #999#10;
         #97#3 = 0;
     |FINSI;
     |LEE 040#97];
     |SI FSalida = 0;  |Y #97#2 = #999#10;
         #999#10 = #97#4;
     |FINSI;

     |GRABA 020#999a;
     |LIBERA #999;
|FPRC;

|DEFBUCLE cientasl;
     #999#1002;
     ;
     "            ", 00001;
     "zzzzzzzzzzzz", 99999;
     be;
     NULL, cientasl;
|FIN;

|PROCESO cientcon;
     |SI nEmpresa = 0;
         #97#0 = 0;
         #97#1 = nPerConta;
         #97#2 = #999#6;
         #97#3 = 0;
     |SINO;
         #97#0 = #98#0;
         #97#1 = #98#1;
         #97#2 = #999#6;
         #97#3 = 0;
     |FINSI;
     |LEE 040#97];
     |SI FSalida = 0;  |Y #97#2 = #999#6;
         #999#6 = #97#4;
         |GRABA 020#999a;
     |FINSI;
     |LIBERA #999;
|FPRC;

|DEFBUCLE cientcon;
     #999#1004;
     ;
     "            ", 0, 00001, 00001;
     "zzzzzzzzzzzz", 9, 99999, 99999;
     be;
     NULL, cientcon;
|FIN;

|PROCESO cavengca;
     |SI nEmpresa = 0;
         #97#0 = 0;
         #97#1 = nPerConta;
         #97#2 = #999#6;
         #97#3 = #999#1;
     |SINO;
         #97#0 = #98#0;
         #97#1 = #98#1;
         #97#2 = #999#6;
         #97#3 = #999#1;
     |FINSI;
     |LEE 040#97];
     |SI FSalida = 0;  |Y #97#2 = #999#6;
         #999#6 = #97#4;
         #999#7 = #97#5;
         |GRABA 020#999a;
     |FINSI;
     |LIBERA #999;
|FPRC;

|DEFBUCLE cavengca;
     #999#1001;
     ;
     "01.01.0000";
     "31.12.2099";
     be;
     NULL, cavengca;
|FIN;

|PROCESO TrataCambio;
     |ABRE #97;

     aDef = aPathDestino + "def/caconci2.mas"
     |CARGA_DEF aDef, referen@;
     |SI FSalida = 0;
         |PATH_DAT #999 aDirFichDestino;

         |BUCLE caconci2;

         |DESCARGA_DEF #referen@;
     |FINSI;

     aDef = aPathDestino + "def/caconcim.mas"
     |CARGA_DEF aDef, referen@;
     |SI FSalida = 0;
         |PATH_DAT #999 aDirFichDestino;

         |BUCLE caconcim;

         |DESCARGA_DEF #referen@;
     |FINSI;

     aDef = aPathDestino + "def/caentasl.mas"
     |CARGA_DEF aDef, referen@;
     |SI FSalida = 0;
         |PATH_DAT #999 aDirFichDestino;

         |BUCLE caentasl;

         |DESCARGA_DEF #referen@;
     |FINSI;

     aDef = aPathDestino + "def/cainliva.mas"
     |CARGA_DEF aDef, referen@;
     |SI FSalida = 0;
         |PATH_DAT #999 aDirFichDestino;

         |BUCLE cainliva;

         |DESCARGA_DEF #referen@;
     |FINSI;

     aDef = aPathDestino + "def/caivaasi.mas"
     |CARGA_DEF aDef, referen@;
     |SI FSalida = 0;
         |PATH_DAT #999 aDirFichDestino;

         |HAZ caivaasi;

         |DESCARGA_DEF #referen@;
     |FINSI;

     aDef = aPathDestino + "def/camaniva.mas"
     |CARGA_DEF aDef, referen@;
     |SI FSalida = 0;
         |PATH_DAT #999 aDirFichDestino;

         |BUCLE camaniva;

         |DESCARGA_DEF #referen@;
     |FINSI;

     aDef = aPathDestino + "def/caivalin.mas"
     |CARGA_DEF aDef, referen@;
     |SI FSalida = 0;
         |PATH_DAT #999 aDirFichDestino;

         |BUCLE caivalin;

         |DESCARGA_DEF #referen@;
     |FINSI;

     aDef = aPathDestino + "def/cagruiva.mas"
     |CARGA_DEF aDef, referen@;
     |SI FSalida = 0;
         |PATH_DAT #999 aDirFichDestino;

         |BUCLE cagruiva;

         |DESCARGA_DEF #referen@;
     |FINSI;

     aDef = aPathDestino + "def/cajainli.mas"
     |CARGA_DEF aDef, referen@;
     |SI FSalida = 0;
         |PATH_DAT #999 aDirFichDestino;

         |BUCLE cajainli;

         |DESCARGA_DEF #referen@;
     |FINSI;

     aDef = aPathDestino + "def/cajasald.mas"
     |CARGA_DEF aDef, referen@;
     |SI FSalida = 0;
         |PATH_DAT #999 aDirFichDestino;

         |HAZ cajasald;

         |DESCARGA_DEF #referen@;
     |FINSI;

     aDef = aPathDestino + "def/camaasil.mas"
     |CARGA_DEF aDef, referen@;
     |SI FSalida = 0;
         |PATH_DAT #999 aDirFichDestino;

         |BUCLE camaasil;

         |DESCARGA_DEF #referen@;
     |FINSI;

     aDef = aPathDestino + "def/camautol.mas"
     |CARGA_DEF aDef, referen@;
     |SI FSalida = 0;
         |PATH_DAT #999 aDirFichDestino;

         |BUCLE camautol;

         |DESCARGA_DEF #referen@;
     |FINSI;

     aDef = aPathDestino + "def/camaylin.mas"
     |CARGA_DEF aDef, referen@;
     |SI FSalida = 0;
         |PATH_DAT #999 aDirFichDestino;

         |BUCLE camaylin;

         |DESCARGA_DEF #referen@;
     |FINSI;

     aDef = aPathDestino + "def/capasven.mas"
     |CARGA_DEF aDef, referen@;
     |SI FSalida = 0;
         |PATH_DAT #999 aDirFichDestino;

         |BUCLE capasven;

         |DESCARGA_DEF #referen@;
     |FINSI;

     aDef = aPathDestino + "def/casieali.mas"
     |CARGA_DEF aDef, referen@;
     |SI FSalida = 0;
         |PATH_DAT #999 aDirFichDestino;

         |BUCLE casieali;

         |DESCARGA_DEF #referen@;
     |FINSI;

     aDef = aPathDestino + "def/cientasl.mas"
     |CARGA_DEF aDef, referen@;
     |SI FSalida = 0;
         |PATH_DAT #999 aDirFichDestino;

         |BUCLE cientasl;

         |DESCARGA_DEF #referen@;
     |FINSI;

     aDef = aPathDestino + "def/cientcon.mas"
     |CARGA_DEF aDef, referen@;
     |SI FSalida = 0;
         |PATH_DAT #999 aDirFichDestino;

         |BUCLE cientcon;

         |DESCARGA_DEF #referen@;
     |FINSI;

     aDef = aPathDestino + "def/cavengca.mas"
     |CARGA_DEF aDef, referen@;
     |SI FSalida = 0;
         |PATH_DAT #999 aDirFichDestino;

         |BUCLE cavengca;

         |DESCARGA_DEF #referen@;
     |FINSI;

     |CIERRA #97;
|FPRC;

|PROCESO Borra97;
     |BORRA 020#97a;
     |LIBERA #97;
|FPRC;

|DEFBUCLE dspase97B;
     #97#1;
     ;
     #96#0, #96#1, #96#2, 00;
     #96#0, #96#1, #96#2, 99;
     be;
     NULL, Borra97;
|FIN;

|PROCESO Borra96;
     |BUCLE dspase97B;

     |BORRA 020#96a;
     |LIBERA #96;
|FPRC;

|DEFBUCLE dspase96B;
     #96#1;
     ;
     #98#0, #98#1, 000;
     #98#0, #98#1, 999;
     be;
     NULL, Borra96;
|FIN;

|PROCESO Graba97;
     #97#0 = #98#0;
     #97#1 = #98#1;
     |GRABA 020#97n;
     |LIBERA #97;
|FPRC;

|DEFBUCLE dspase97;
     #97#1;
     ;
     00000, #96#1, #96#2, 00;
     00000, #96#1, #96#2, 99;
     be;
     NULL, Graba97;
|FIN;

|PROCESO PasaConcepto;
     #96#0 = 0;
     #96#1 = nPerConcep;
     #96#2 = #999#0;
     |LEE 101#96=;
     |SI FSalida ! 0;
         #96#0 = 0;
         #96#1 = nPerConcep;
         #96#2 = #999#0;
         #96#3 = #999#1;
         |GRABA 020#96n;
         nSwGraba = 1;
     |SINO;
         aConcepto = #96#3;
         |SI #96#3 ! #999#1; |O #22#4 ! "S";  aConcepto = "";  nEmpresa = 1;  |FINSI;
     |FINSI;
     |LIBERA #96;

     #96#0 = #98#0;
     #96#1 = #98#1;
     #96#2 = #999#0;
     |LEE 101#96=;
     |SI FSalida ! 0;
         #96#0 = #98#0;
         #96#1 = #98#1;
         #96#2 = #999#0;
         #96#3 = #999#1;
         |GRABA 020#96n;

         |SI aConcepto ! "";
             |BUCLE dspase97;
         |FINSI;
     |FINSI;
     |LIBERA #96;
|FPRC;

|DEFBUCLE caconcep;
     #999#1001;
     ;
     000;
     999;
     ;
     NULL, PasaConcepto;
|FIN;

|RUTINA ClaveBaja96;
      #96#0 = nDEmpresa;
      #96#1 = nDPeriodo;
      #96#2 = 001;
|FRUT;

|RUTINA ClaveAlta96;
      #96#0 = nHEmpresa;
      #96#1 = nHPeriodo;
      #96#2 = 999;
|FRUT;

|PROCESO CambiaConcepto;
     aDef = aPathOrigen + "def/caconcep.mas"
     |CARGA_DEF aDef, referen@;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |PATH_DAT #999 aPathAnterior;

     |SI #22#4 = "S";
         nPerConcep = 0;
     |SINO;
         nPerConcep = #98#1;
     |FINSI;
     |ABRE #96;
     nEmpresa = 0;
     nSwGraba = 0;
     |BUCLE caconcep;
     |CIERRA #96;
     |DESCARGA_DEF #referen@;

     nPerConta = nPerConcep;
     |SI nSwGraba = 1;  |O nEmpresa = 1; |O nSwLaFuncion = 1; |O #22#4 = "N";
         |HAZ TerminaEmpresa;

         nDEmpresa = 0;
         nHEmpresa = 0;
         nDPeriodo = nPerConcep;
         nHPeriodo = nPerConcep;
         |SI nEmpresa = 1;
             nDEmpresa = #98#0;
             nHEmpresa = #98#0;
             nDPeriodo = #98#1;
             nHPeriodo = #98#1;
         |SINO;
             nSwLaFuncion = 0;
         |FINSI;

         aDef = aPathOrigen + "def/calibros.mas"
         |CARGA_DEF aDef, referen@;
         |SI FSalida ! 0;  |ACABA;  |FINSI;

         |PATH_DAT #999 aPathAnterior;

         |PUSHV  0501 2380
         |PARA; |SI; |HACIENDO;
              |ENTLINEAL #1#96, -3, 4, 22, 1, ClaveBaja96, ClaveAlta96;
              |CONFI "0000NLos Conceptos estan Correctos ";
              |SI FSalida = 0;  |SAL;  |FINSI;
         |SIGUE;
         |POPV;

         |DESCARGA_DEF #referen@;
     |FINSI;

     |HAZ TrataCambio;

     ||BUCLE dspase96B;

     |SI nSwGraba = 0;  |Y nEmpresa = 0;
         |HAZ TerminaEmpresa;
     |FINSI;
|FPRC;
|| ________________________________________________________________________
|| Comprobacion y Copia de Fichero con otro Nombre (Analitica)
|| ________________________________________________________________________

|PROCESO RastreoAna;
  aFicheroDestino = "";
  |SI aFicheroOrigen = "cactaana.dat"; aFicheroDestino = "anm00001.dat"; |FINSI;
  |SI aFicheroOrigen = "cagruanc.dat"; aFicheroDestino = "anm00002.dat"; |FINSI;
  |SI aFicheroOrigen = "cagruanl.dat"; aFicheroDestino = "anm00003.dat"; |FINSI;
  |SI aFicheroOrigen = "caanamay.dat"; aFicheroDestino = "anm00004.dat"; |FINSI;
  |SI aFicheroOrigen = "caseleca.dat"; aFicheroDestino = "anm00005.dat"; |FINSI;
  |SI aFicheroOrigen = "caseleli.dat"; aFicheroDestino = "anm00006.dat"; |FINSI;
  |SI aFicheroOrigen = "cacueana.dat"; aFicheroDestino = "anm00007.dat"; |FINSI;
  |SI aFicheroOrigen = "canempan.dat"; aFicheroDestino = "anm00008.dat"; |FINSI;
  |SI aFicheroOrigen = "canempav.dat"; aFicheroDestino = "anm00009.dat"; |FINSI;

  |SI aFicheroDestino ! "";
         aFichero = aFicheroOrigen;              |QBF aFichero;
         aOrigen  = aDirFichOrigen  + aFichero;  |QBF aOrigen;

         aFichero = aFicheroDestino;             |QBF aFichero;
         aDestino = aDirFichDestino + aFichero;  |QBF aDestino;
         |COPIA_FICHERO aOrigen, aDestino;

         aFichero = aFicheroOrigen;              |QBF aFichero;
         aFichero = aFichero - ".dat" + ".ddx";
         aOrigen  = aDirFichOrigen  + aFichero;  |QBF aOrigen;

         aFichero = aFicheroDestino;             |QBF aFichero;
         aFichero = aFichero - ".dat" + ".ddx";
         aDestino = aDirFichDestino + aFichero;  |QBF aDestino;
         |COPIA_FICHERO aOrigen, aDestino;

         aFichero = aFicheroOrigen;              |QBF aFichero;
         aFichero = aFichero - ".dat" + ".ixx";
         aOrigen  = aDirFichOrigen  + aFichero;  |QBF aOrigen;

         aFichero = aFicheroDestino;              |QBF aFichero;
         aFichero = aFichero - ".dat" + ".ixx";
         aDestino = aDirFichDestino + aFichero;  |QBF aDestino;
         |COPIA_FICHERO aOrigen, aDestino;

         #4#0 = aFicheroDestino;  ||Para Rastreo
  |FINSI;
|FPRC;
|| ________________________________________________________________________
|| Comprobacion del .mas del fichero a traspasar para su posible copia o no.
|| ________________________________________________________________________

|PROCESO Rastreo;
     nSwCopiar = 0;
     aFichero  = #4#0;  |QBF aFichero;
     aFichero  = aFichero - ".dat" + ".mas";
     aDef      = aPathDestino + "def/" + aFichero;
     |CARGA_DEF aDef, referen@;
     |SI FSalida ! 0;  nSwCopiar = 1;  |ACABA;  |FINSI;

     |PATH_DAT #999 aDirFichDestino;

     |ABRE #999;
     |LEE 040#999p;
     |SI FSalida = 0;  nSwCopiar = 1;  |FINSI;
     |CIERRA #999;

     |SI nSwCopiar = 0;  |DELINDEX #999;   |FINSI;

     |DESCARGA_DEF #referen@;
|FPRC;

|| ________________________________________________________________________
|| Copiado de los ficheros
|| ________________________________________________________________________

|PROCESO Copiar;
     nSwCopiar = 0;
     |SI nSwEsFichero = 1;
         |HAZ Rastreo;
         |SI nSwCopiar = 1; |HAZ RastreoAna; |FINSI;
     |FINSI;
     |SI nSwCopiar    = 1;  |ACABA;        |FINSI;

     |SI nSwEsFichero = 1;
         aFichero = #4#0;                        |QBF aFichero;
         aOrigen  = aDirFichOrigen  + aFichero;  |QBF aOrigen;
         aDestino = aDirFichDestino + aFichero;  |QBF aDestino;
         |COPIA_FICHERO aOrigen, aDestino;

         aFichero = #4#0;                        |QBF aFichero;
         aFichero = aFichero - ".dat" + ".ddx";
         aOrigen  = aDirFichOrigen  + aFichero;  |QBF aOrigen;
         aDestino = aDirFichDestino + aFichero;  |QBF aDestino;
         |COPIA_FICHERO aOrigen, aDestino;

         aFichero = #4#0;                        |QBF aFichero;
         aFichero = aFichero - ".dat" + ".ixx";
         aOrigen  = aDirFichOrigen  + aFichero;  |QBF aOrigen;
         aDestino = aDirFichDestino + aFichero;  |QBF aDestino;
         |COPIA_FICHERO aOrigen, aDestino;
     |SINO;
         aOrigen  = aDirFichOrigen  + #4#0;   |QBF aOrigen;
         aDestino = aDirFichDestino + #4#0;   |QBF aDestino;
         |COPIA_FICHERO aOrigen, aDestino;
     |FINSI;
|FPRC;

|| ________________________________________________________________________
|| DIR del directorio origen para su traspaso al directorio destino
|| ________________________________________________________________________

|PROCESO HazElDir;
     aDirFichOrigen  = aPathAnterior;
     aDirFichDestino = aPathDestino + "fich/" + aDirEmpresaN;

     nSwEsFichero   = 1;
     aDirecBuscar = aPathAnterior + "*.dat";
     |_PDIR aDirecBuscar;
     |PARA; |SI FSalida = 0; |HACIENDO;
            aFicheroOrigen = aDirecBuscar - aPathAnterior;
            |SI aFicheroOrigen ! "canempre.dat";
                #4#0 = aFicheroOrigen;
                |SI aFicheroOrigen = "camaasic.dat";
                 |O aFicheroOrigen = "camaasil.dat";
                 |O aFicheroOrigen = "casieali.dat";
                 |O aFicheroOrigen = "caivaasi.dat";
                 |O aFicheroOrigen = "camautoc.dat";
                 |O aFicheroOrigen = "capasven.dat";
                 |O aFicheroOrigen = "carecufe.dat";
                 |O aFicheroOrigen = "ca8ctrle.dat";
                 |O aFicheroOrigen = "caportad.dat";
                 |O aFicheroOrigen = "cpcuesal.dat";
                 |O aFicheroOrigen = "n43saldo.dat";
                 |O aFicheroOrigen = "caclipro.dat";
                 |O aFicheroOrigen = "camacc01.dat";
                 |O aFicheroOrigen = "camacc02.dat";
                 |O aFicheroOrigen = "camacc12.dat";
                 |O aFicheroOrigen = "casiim01.dat";
                 |O aFicheroOrigen = "casiim02.dat";
                 |O aFicheroOrigen = "cacreano.dat";
                 |O aFicheroOrigen = "caxcontr.dat";
                 |O aFicheroOrigen = "catmp500.dat";
                    |HAZ TrataEspeciales;
                |SINO;
                    |HAZ Copiar;
                    |HAZ Rastreo;
                |FINSI;
            |FINSI;

            |_SDIR aDirecBuscar;
     |SIGUE;

     nSwEsFichero   = 0;
     aDirecBuscar = aPathAnterior + "lis*.*";
     |_PDIR aDirecBuscar;
     |PARA; |SI FSalida = 0; |HACIENDO;
            aFicheroOrigen = aDirecBuscar - aPathAnterior;
            #4#0 = aFicheroOrigen;

            |HAZ Copiar;

            |_SDIR aDirecBuscar;
     |SIGUE;
|FPRC;

|PROCESO CopiaPatron;
     aOrigen  = aDirFichPatron  + aFichero + ".dat";
     aDestino = aDirFichDestino + aFichero + ".dat";
     |COPIA_FICHERO aOrigen, aDestino;

     aOrigen  = aDirFichPatron  + aFichero + ".ddx";
     aDestino = aDirFichDestino + aFichero + ".ddx";
     |COPIA_FICHERO aOrigen, aDestino;

     aOrigen  = aDirFichPatron  + aFichero + ".ixx";
     aDestino = aDirFichDestino + aFichero + ".ixx";
     |COPIA_FICHERO aOrigen, aDestino;
|FPRC;

|PROCESO CopiaPatrones;
     |ABRE #100;
     |LEE 040#100p;
     |SI FSalida ! 0;
         |CIERRA #100;
         |ACABA;
     |FINSI;
     |CIERRA #100;

     aDirFichPatron  = aPathDestino + "fich/" + (("00000" + #100#4) % -105) + #100#5 + "/";
     aDirFichDestino = aPathDestino + "fich/" + aDirEmpresaN;

     aFichero = "camauto0";  |HAZ CopiaPatron;
     aFichero = "camauto1";  |HAZ CopiaPatron;
     aFichero = "camautoc";  |HAZ CopiaPatron;
     aFichero = "camautol";  |HAZ CopiaPatron;
     aFichero = "camautli";  |HAZ CopiaPatron;
     aFichero = "cadeflab";  |HAZ CopiaPatron;
     aFichero = "cadeflal";  |HAZ CopiaPatron;
||     aFichero = "caivaasi";  |HAZ CopiaPatron;
|FPRC;

|PROCESO EmpresaCero;
     aDirFichDestino = aPathDestino + "fich/000000/";
     |MKDIR aDirFichDestino;
     |SI FSalida = 0;
         aDirEmpresaN     = "000000/";
         |MKDIR aDirFichDestino;

         aPathOrigen     = #0#0;  |QBF aPathOrigen;
         aPathOrigen     = aPathOrigen + "agicont/";
         aPathAnterior   = aPathOrigen + "fich/" + aDirEmpresaN;
         aPathDestino    = eaPathContagen - "fich/";
         |HAZ HazElDir;
     |FINSI;
|FPRC;


|| ________________________________________________________________________
||  Tratamiento especial del Camaasic, Camaasil, casieali y camautoc
|| ________________________________________________________________________
|PROCESO camanban;
  #998#0 = #996#0;
  |LEE 101#998=;
  |SI FSalida ! 0;
      |DDEFECTO #998;
      #998#0 = #996#0;
      |GRABA 020#998b;
  |FINSI;
  #998#1 = #996#1;
  aAlfa = #996#9; |QBF aAlfa;
  #998#2 = aAlfa % 104;
  #998#3 = aAlfa % 504;
  #998#4 = aAlfa % 902;
  #998#5 = #996#8;
  #998#6 = #996#10;
  #998#7 = #996#11;

  |DDEFECTO #999;
  #999#0 = #996#8;
  |LEE 001#999=;

  #998#11 = #999#1;
  #998#12 = #999#2;

  |GRABA 020#998a;
  |LIBERA #998;
|FPRC;

|DEFBUCLE camanban;
 #996#1001;
 ;
 001;
 999;
 ;
 NULL, camanban;
|FIN;


|PROCESO EspCpcuesal;
         aDef      = aPathOrigen + "def/camanban";
         |CARGA_DEF aDef, refeesp@;
         |SI FSalida ! 0;  |ACABA;  |FINSI;
         |PATH_DAT #996 aDirFichOrigen;
         |ABRE #999;
         |ABRE #998;
         |BUCLE camanban;  ||nuevo
         |CIERRA #998;
         |CIERRA #999;
         |DESCARGA_DEF #refeesp@;
|FPRC;

|PROCESO EspCamaasic;
  |DDEFECTO #998;
  |PARA nCampo = 0;  |SI nCampo [ 11;  |HACIENDO nCampo = nCampo + 1;
        #998nCampo = #999nCampo;
  |SIGUE;
  |SI nNumCampos = 12;
      #998#17 = #999nNumCampos;  ||Campo Referencia Analitica
  |FINSI;
  |GRABA 020#998n;
  |LIBERA #998;
  |LIBERA #999;
|FPRC;

|DEFBUCLE EspCamaasic;
     #999#1003;
     ;
     00, "01.01.0000", 000001;
     99, "31.12.2999", 999999;
     e;
     NULL, EspCamaasic;
|FIN;

|PROCESO EspCamaasil;
  |DDEFECTO #998;
  |PARA nCampo = 0;  |SI nCampo [ 23;  |HACIENDO nCampo = nCampo + 1;
        #998nCampo = #999nCampo;
  |SIGUE;
  |SI nNumCampos = 26;
      #998#29 = #999#24; || Campo Cuenta Analitica
      #998#26 = #999#25; || Referencia Linea
      #998#30 = #999#26; || Fecha
  |FINSI;
  |GRABA 020#998n;
  |LIBERA #998;
  |LIBERA #999;
|FPRC;

|DEFBUCLE EspCamaasil;
     #999#1004;
     ;
     00, "01.01.0000", 000001, 0000;
     99, "31.12.2999", 999999, 9999;
     e;
     NULL, EspCamaasil;
|FIN;

|PROCESO EspCasieali;
  |DDEFECTO #998;
  |PARA nCampo = 0;  |SI nCampo [ 60;  |HACIENDO nCampo = nCampo + 1;
        #998nCampo = #999nCampo;
  |SIGUE;
  #998#63 = #999#61; || Campo Cuenta Analitica
  |GRABA 020#998n;
  |LIBERA #998;
  |LIBERA #999;
|FPRC;

|DEFBUCLE EspCasieali;
     #999#1002;
     ;
     0000, 01;
     9999, 99;
     e;
     NULL, EspCasieali;
|FIN;

|PROCESO EspCaivaasi;
  |ABRE #999;
  |DDEFECTO #999;
  |LEE 001#999=;
  |CIERRA #999;

  |DDEFECTO #998;
  nHastaCampo = 46;
  |SI nNumCampos < 46; nHastaCampo = nNumCampos; |FINSI;

  |PARA nCampo = 0;  |SI nCampo [ nHastaCampo;  |HACIENDO nCampo = nCampo + 1;
        #998nCampo = #999nCampo;
  |SIGUE;

  |SI nNumCampos ] 47; #998#114 = #999#47; |FINSI;
  |SI nNumCampos ] 48; #998#97  = #999#48; |FINSI;
  |SI nNumCampos ] 49; #998#98  = #999#49; |FINSI;

  |GRABA 020#998n;
  |LIBERA #998;
  |LIBERA #999;
|FPRC;

|PROCESO EspCapasven;
  |ABRE #999;
  |DDEFECTO #999;
  |LEE 001#999p;
  |CIERRA #999;

  |DDEFECTO #998;
  |PARA nCampo = 0;  |SI nCampo [ 24;  |HACIENDO nCampo = nCampo + 1;
        #998nCampo = #999nCampo;
  |SIGUE;
  |GRABA 020#998n;
  |LIBERA #998;
  |LIBERA #999;
|FPRC;

|PROCESO EspCarecufe;
  |ABRE #999;
  |DDEFECTO #999;
  |LEE 001#999p;
  |CIERRA #999;

  |DDEFECTO #998;
  |PARA nCampo = 0;  |SI nCampo [ 15;  |HACIENDO nCampo = nCampo + 1;
        #998nCampo = #999nCampo;
  |SIGUE;
  |GRABA 020#998n;
  |LIBERA #998;
|FPRC;

|PROCESO EspCaxcontr;
  |ABRE #999;
  |DDEFECTO #999;
  |LEE 001#999p;
  |CIERRA #999;

  |DDEFECTO #998;
  |PARA nCampo = 0;  |SI nCampo [ 8;  |HACIENDO nCampo = nCampo + 1;
        #998nCampo = #999nCampo;
  |SIGUE;
  #998#13 = #999#9;
  #998#14 = #999#10;

  |GRABA 020#998n;
  |LIBERA #998;
|FPRC;

|PROCESO EspCamautoc;

  aQueQuiero = "|NC";
  aNumCampos = #998#aQueQuiero#;
  nNumCampos = aNumCampos;
  nNumCampos = nNumCampos - 1;
  |DDEFECTO #998;
  |PARA nCampo = 0;  |SI nCampo [ 11;  |HACIENDO nCampo = nCampo + 1;
        #998nCampo = #999nCampo;
  |SIGUE;
  |SI nNumCampos = 26; #998#26 = #999#12; |FINSI; || Incremento
  |GRABA 020#998n;
  |LIBERA #998;
  |LIBERA #999;
|FPRC;

|DEFBUCLE EspCamautoc;
     #999#1001;
     ;
     00001;
     99999;
     e;
     NULL, EspCamautoc;
|FIN;

|PROCESO EspCaclipro;
  |DDEFECTO #998;
  |PARA nCampo = 0;  |SI nCampo [ 28;  |HACIENDO nCampo = nCampo + 1;
        #998nCampo = #999nCampo;
  |SIGUE;

  #998#41 = #999#29;
  #998#40 = #999#30;

  #998#44 = #998#2;
  #998#45 = #998#3;
  #998#46 = #998#4;
  #998#47 = #998#5;
  #998#48 = #998#6;
  #998#49 = #998#27;
  #998#50 = #998#25;

  aAlfa = #998#17; |QBT aAlfa; #998#32 = aAlfa;
  aAlfa = #998#18; |QBT aAlfa;
  #998#29 = aAlfa % 0104;
  #998#30 = aAlfa % 0504;
  #998#31 = aAlfa % 0902;

  aAlfa = #998#10; |QBF aAlfa;
  |SI aAlfa ! "";
      |GRABA 020#998n;
  |FINSI;
  |LIBERA #998;
  |LIBERA #999;
|FPRC;

|DEFBUCLE EspCaclipro;
     #999#1003;
     ;
     " ", "            ", 0;
     "z", "999999999999", 9;
     e;
     NULL, EspCaclipro;
|FIN;

|PROCESO EspCamacc12;
  |DDEFECTO #998;
  |PARA nCampo = 0;  |SI nCampo [ 12;  |HACIENDO nCampo = nCampo + 1;
        #998nCampo = #999nCampo;
  |SIGUE;

  |GRABA 020#998n;
  |LIBERA #998;
  |LIBERA #999;
|FPRC;

|DEFBUCLE EspCamacc12;
     #999#1004;
     ;
     "R", 00, 001, 01;
     "S", 99, 999, 99;
     e;
     NULL, EspCamacc12;
|FIN;

|PROCESO TrataEspeciales;
     |SI  aFicheroOrigen = "cpcuesal.dat";
          #4#0 = "n43saldo.dat";
     |FINSI;

     |SI  aFicheroOrigen = "ca8ctrle.dat"; |ACABA; |FINSI; ||no lo copia
     |SI  aFicheroOrigen = "caportad.dat"; |ACABA; |FINSI; ||no lo copia
     |SI  aFicheroOrigen = "camacc01.dat"; |ACABA; |FINSI; ||no lo copia
     |SI  aFicheroOrigen = "camacc02.dat"; |ACABA; |FINSI; ||no lo copia
     |SI  aFicheroOrigen = "casiim01.dat"; |ACABA; |FINSI; ||no lo copia
     |SI  aFicheroOrigen = "casiim02.dat"; |ACABA; |FINSI; ||no lo copia
     |SI  aFicheroOrigen = "cacreano.dat"; |ACABA; |FINSI; ||no lo copia
     |SI  aFicheroOrigen = "catmp500.dat"; |ACABA; |FINSI; ||no lo copia

     nSwCopiar = 0;
     aFichero  = #4#0;  |QBF aFichero;
     aFichero  = aFichero - ".dat" + ".mas";
     aDef      = aPathOrigen + "def/" + aFichero;
     |CARGA_DEF aDef, referen@;
     |SI FSalida ! 0;  nSwCopiar = 1;  |ACABA;  |FINSI;

     aQueQuiero = "|NC";
     aNumCampos = #referen@#aQueQuiero#;
     nNumCampos = aNumCampos;
     nNumCampos = nNumCampos - 1;

     nSwVale = 0;
     |SI aFicheroOrigen = "carecufe.dat"; |Y nNumCampos = 15; nSwVale = 1; |FINSI;
     |SI aFicheroOrigen = "camaasic.dat"; |Y nNumCampos = 11; nSwVale = 1; |FINSI;
     |SI aFicheroOrigen = "camaasil.dat"; |Y nNumCampos = 23; nSwVale = 1; |FINSI;
     |SI aFicheroOrigen = "caclipro.dat"; |Y nNumCampos [ 28; nSwVale = 1; |FINSI;
     |SI aFicheroOrigen = "casieali.dat";
         aQueQuiero = "|C061LONGITUD";
         aLongCampo = #referen@#aQueQuiero#;
         nLongCampo = aLongCampo;
         |SI nLongCampo < 7; nSwVale = 1; |FINSI;
     |FINSI;
     |SI aFicheroOrigen = "camautoc.dat"; |Y nNumCampos = 11; nSwVale = 1; |FINSI;
     |SI aFicheroOrigen = "capasven.dat"; |Y nNumCampos [ 24; nSwVale = 1; |FINSI;

     |SI nSwVale = 0;    || Hay cambio de estructura en Fichero Analitica
          aFichero  = #4#0;  |QBF aFichero;
          aFichero  = aFichero - ".dat" + ".mas";
          aDef      = aPathDestino + "def/" + aFichero;
          |CARGA_DEF aDef, refecon@;
          |SI FSalida = 0;
              |PATH_DAT #998 aDirFichDestino;
              |PATH_DAT #999 aDirFichOrigen;

              |ABRE #998;
              |LEE 040#998p;         || ...Si no existen datos
              |SI FSalida ! 0;
                  |SI aFicheroOrigen = "camaasic.dat"; |BUCLE EspCamaasic; |FINSI;
                  |SI aFicheroOrigen = "camaasil.dat"; |BUCLE EspCamaasil; |FINSI;
                  |SI aFicheroOrigen = "casieali.dat"; |BUCLE EspCasieali; |FINSI;
                  |SI aFicheroOrigen = "caivaasi.dat"; |HAZ   EspCaivaasi; |FINSI;
                  |SI aFicheroOrigen = "camautoc.dat"; |BUCLE EspCamautoc; |FINSI;
                  |SI aFicheroOrigen = "capasven.dat"; |HAZ   EspCapasven; |FINSI;
                  |SI aFicheroOrigen = "carecufe.dat"; |HAZ   EspCarecufe; |FINSI;
                  |SI aFicheroOrigen = "cpcuesal.dat"; |HAZ   EspCpcuesal; |FINSI;
                  |SI aFicheroOrigen = "caclipro.dat"; |BUCLE EspCaclipro; |FINSI;
                  |SI aFicheroOrigen = "camacc12.dat"; |BUCLE EspCamacc12; |FINSI;
                  |SI aFicheroOrigen = "caxcontr.dat"; |HAZ   EspCaxcontr; |FINSI;
              |FINSI;
              |CIERRA #998;
              |DESCARGA_DEF #refecon@;
          |FINSI;
          |DESCARGA_DEF #referen@;
     |SINO;
          |DESCARGA_DEF #referen@;
          |HAZ Copiar;
          |HAZ Rastreo;
     |FINSI;
|FPRC;

|| ________________________________________________________________________
|| Aplicacion Cartera
|| ________________________________________________________________________
|PROCESO DsCarter;

    aDef = eaPathDscarter + "def/dscam000.mas";
    |CARGA_DEF aDef, emcarte@;
    |SI FSalida = 0;

        aPathCartera = eaPathDscarter + "fich/";
        |PATH_DAT #emcarte@#aPathCartera#;

        nSwExiste = 0;
        |ABRE #emcarte@;
        #emcarte@#0 = enEmpresa;
        |LEE 011#emcarte@.=;
        |SI FSalida = 0;
             nSwExiste = 1;
             #emcarte@#14 = enEmpresa;
             #emcarte@#19 = enPeriodo;
             |GRABA 040#emcarte@.a;
        |FINSI;
        |CIERRA #emcarte@;

        enEmpCartera = enEmpresa;
        eaDirAgicont = #0#0;  |QBF eaDirAgicont;
        eaDirAgicont = eaDirAgicont + "agicont/";
        enEmpAgicont = enEmpresaV;
        enPerAgicont = enPeriodoV;

        enERP = 1;
        |SI nSwExiste = 0;
            |SUB_EJECUTA_NP ":dscarter/dscab000";
        |FINSI;
        aAlfa1 = ("00000" + enEmpCartera) % -105;
        aAlfa1 = ":dscarter/dscaz024 dscam005 " + aAlfa1 + ";basica";
        |SUB_EJECUTA aAlfa1;
        enERP = 0;

        |DESCARGA_DEF #emcarte@;
    |FINSI;
|FPRC;

|| ________________________________________________________________________
|| Aplicacion Contabilidad
|| ________________________________________________________________________
|PROCESO RepasoCtrl8;
   #997#2 = #400#0;
   #997#3 = #400#1;
   |LEE 041#997=;
   |SI FSalida ! 0;
       |BORRA 020#400a;
   |SINO;
       |SI #997#26 = 8;
           |SELECT #4#997;
           #997#26 = 7;
           |LEE 041#997=;
           |SI FSalida = 0;
               #400#4 = #997#3;
               |GRABA 020#400a;
           |FINSI;
      |FINSI;
   |FINSI;
   |LIBERA #400;
   |SELECT #1#997;
|FPRC;

|DEFBUCLE RepasoCtrl8;
     #400#1;
     ;
     00000, 0;
     99999, 9;
     be;
     NULL, RepasoCtrl8;
|FIN;

|PROCESO AltaTitulEmp;
     aAlfa = #997#29;  |QBF aAlfa;
     |SI aAlfa = "";
         |ABRE #114;
         #114#0 = #997#2;
         #114#1 = 1;
         |LEE 040#114];
         |SI FSalida ! 0;  |O #114#0 ! #997#2;
             |DDEFECTO #114;
         |FINSI;
         |CIERRA #114;

         |SI #997#26 ] 80;
             nNume = 1900 + #997#26;
         |SINO;
             nNume = 2000 + #997#26;
         |FINSI;

         aAlfa1 = #997#1;   |QBF aAlfa1;
         aAlfa2 = #114#8;   |QBF aAlfa2;
         aAlfa3 = #114#10;  |QBF aAlfa3;
         aAlfa =  "[" + (("00000" + #997#2) % -105) + "/" + nNume + "] " + aAlfa1 + " " + aAlfa2 + " " + aAlfa3;

         #997#29 = aAlfa;
         #997#27 = "N";
         #997#24 = "S"; #98#7 = "S";
         #997#22 = "N";
         |GRABA 020#997a;
      |FINSI;
|FPRC;

|PROCESO BuscaPeriodo;
  nPerioNue = #998#3;
  nExiste   = 0;

  #997#2 = nCodigoNue;  ||lee el mismo que el anterior
  #997#3 = #998#3;
  |LEE 101#997=;
  |SI FSalida = 0;
      |SI #997#26 = #998#26;  ||son el mismo ejercicio. Sale
          |ACABA;
      |FINSI;
  |SINO;
      nExiste = 1;  || NO Existe
  |FINSI;

  |SELECT #4#997;
  #997#2  = nCodigoNue;
  #997#26 = #998#26;      || lee por a¤o
  |LEE 001#997=;
  |SI FSalida = 0;
      |SELECT #1#997;
      nPerioNue = #997#3;   || existe y sale
      |ACABA;
  |FINSI;

  #997#2  = nCodigoNue;   ||lee un a¤o anterior para calcular el periodo
  #997#26 = #998#26 - 1; |SI #997#26 < 0; #997#26 = 99; |FINSI;
  |LEE 001#997=;
  |SI FSalida = 0;
      #997#3    = #997#3 + 1; |SI #997#3 > 9; #997#3 = 0; |FINSI;
      nPerioNue = #997#3;
      |SELECT #1#997;
      |LEE 001#997=;
      |SI FSalida ! 0;
          |ACABA;         || no existe es bueno.
      |FINSI;
  |FINSI;

  |SI nExiste = 1;
      nPerioNue = #998#3;
      |ACABA;
  |FINSI;

  nExiste = 0;
  |SELECT #1#997;
  |PARA nNume1 = 0; |SI nNume1 [ 9; |HACIENDO nNume1 = nNume1 + 1;
        #997#2 = nCodigoNue;
        #997#3 = nNume1;
        |LEE 001#997=;
        |SI FSalida ! 0;
            nPerioNue = nNume1;
            nExiste = 1;
            |SAL;
        |FINSI;
  |SIGUE;
  |SI nExiste = 0;
      |MENAV "    Tiene demasiados Periodos de una Empresa. Revise su Contabilidad";
      nPerioNue = -1;
  |FINSI;
|FPRC;

|PROCESO RepasoMoneda;
   #999#0 = #997#2;
   #999#1 = #997#3;
   |LEE 001#999=;
   |SI FSalida = 0;
       #997#28 = #999#2;
       |GRABA 020#997a;
   |FINSI;
   |LIBERA #997;
|FPRC;

|DEFBUCLE RepasoMoneda;
     #997#1002;
     ;
     00000, 0;
     99999, 9;
     be;
     NULL, RepasoMoneda;
|FIN;

|PROCESO CogeCodigo;
     |SI #15#22 = "S";  |ACABA;  |FINSI;
     nCodigoNue = #15#3;
     |ERROR10;
|FPRC;

|DEFBUCLE dspase15;
     #15#5;
     ;
     nCodigoCon, "            ", 000;
     nCodigoCon, "zzzzzzzzzzzz", 999;
     ;
     NULL, CogeCodigo;
|FIN;

|PROCESO GrabaTemporal;

     |SI nEstaCambio = 1;
         nCodigoNue = 0;
         nCodigoCon = #998#2;
         |BUCLE dspase15;
         |SI nCodigoNue = 0;  |ACABA;  |FINSI;
     |SINO;
         nCodigoNue = #998#2;
     |FINSI;

     |HAZ BuscaPeriodo;
     |SI nPerioNue = -1; |ACABA; |FINSI;

     #997#2 = nCodigoNue;
     #997#3 = nPerioNue;
     |LEE 101#997=;
     |SI FSalida ! 0;
         |DDEFECTO #997;
         |PARA nCampo = 0;  |SI nCampo [ 26;  |HACIENDO nCampo = nCampo + 1;
               #997nCampo = #998nCampo;
         |SIGUE;

         #997#2  = nCodigoNue;
         #997#3  = nPerioNue;
         nNume   = (nCodigoNue * 10) + #997#3;
         #997#0  = nNume;
         #997#22 = "N";
         |GRABA 020#997b;
     |FINSI;

     |SI #997#21 = "S";   #997#21 = "A";  |FINSI;  ||Activa o inactiva
     |SI #997#21 = "N";   #997#21 = "A";  |FINSI;
     |SI #997#24 = "N";   #98#7   = "N";  |FINSI;  ||No subdepartamento

     aAlfa = #997#29;  |QBF aAlfa;
     |SI aAlfa = "";
         |ABRE #114;
         #114#0 = #997#2;
         #114#1 = 1;
         |LEE 040#114];
         |SI FSalida ! 0;  |O #114#0 ! #997#2;
             |DDEFECTO #114;
         |FINSI;
         |CIERRA #114;

         |SI #997#26 ] 80;
             nNume = 1900 + #997#26;
         |SINO;
             nNume = 2000 + #997#26;
         |FINSI;

         aAlfa1 = #997#1;   |QBF aAlfa1;
         aAlfa2 = #114#8;   |QBF aAlfa2;
         aAlfa3 = #114#10;  |QBF aAlfa3;
         aAlfa =  "[" + (("00000" + #997#2) % -105) + "/" + nNume + "] " + aAlfa1 + " " + aAlfa2 + " " + aAlfa3;

         #997#29 = aAlfa;
         #997#27 = "N";
         #997#24 = "S"; #98#7 = "S";
         #997#22 = "N";
      |FINSI;

      |GRABA 020#997a;
      |LIBERA #997;

      aDirFichDestino = aPathDestino + "fich/" + (("00000" + #997#2) % -105) + #997#3 + "/";
      aAbre           = aDirFichDestino + "cacuenta.dat";
      |||MKDIR aDirFichDestino;
      |XABRE "E", aAbre, nHandle;
      |SI FSalida ] 0;
          |DDEFECTO #95;
          #95#0 = #997#2;   || Numero Nuevo
          #95#1 = #997#3;   || Periodo Nuevo
          #95#2 = #997#26;
          #95#3 = #997#1;
          #95#4 = #998#2;   || Empresa Original
          #95#5 = #98#7;
          #95#6 = #998#3;   || Periodo Original
          #95#7 = #98#10;   || Pasada Cartera
          |GRABA 020#95n;
          |LIBERA #95;
      |SINO;
          |RMDIR aDirFichDestino;
          |DDEFECTO #98;
          #98#0 = #997#2;   || Nueva Empresa
          #98#1 = #998#3;   || Periodo Original
          #98#2 = #997#26;
          #98#3 = #997#1;
          |SI #22#3 = "S"; #98#5 = #22#3; |FINSI;
          #98#6 = #998#2;   || Empresa Original
          #98#8 = #997#3;   || Nuevo Periodo
          |GRABA 020#98n;
          |LIBERA #98;
      |FINSI;
|FPRC;

|DEFBUCLE canempre;
     #998#1002;
     ;
     00000, 0;
     99999, 9;
     be;
     NULL, GrabaTemporal;
|FIN;

|PROCESO CreaEmpresaCon;
     |HAZ EmpiezaEmpresa;

     aDirFichDestino = aPathDestino + "fich/";
     aDirEmpresaN    = (("00000" + #98#0) % -105) + #98#8 + "/";
     aDirEmpresaV    = (("00000" + #98#6) % -105) + #98#1 + "/";
     aDirFichDestino = aDirFichDestino + aDirEmpresaN;
     |MKDIR aDirFichDestino;

     aPathOrigen     = #0#0;  |QBF aPathOrigen;
     aPathOrigen     = aPathOrigen + "agicont/";
     aPathAnterior   = aPathOrigen + "fich/" + aDirEmpresaV;
     aPathDestino    = eaPathContagen - "fich/";

     |HAZ HazElDir;
     |HAZ CopiaPatrones;

     eaAplica      = "contagen";
     eaEmpresa     = aDirEmpresaN;
     |HAZ GrabaMoneda;
     |HAZ Graba8Ctrle;

     aCartera   = #98#10;
     eaPreg22_7 = #22#7;
     enEmpresa  = #98#0;
     enEmpresaV = #98#6;
     enPeriodo  = #98#8;
     enPeriodoV = #98#1;
     aAlfa      = ":contagen/capasiva;" + #0#0;  |QBT aAlfa;
     |SUB_EJECUTA_NP aAlfa;
     aAlfa      = ":contagen/capasasf;" + #0#0;  |QBT aAlfa;
     |SUB_EJECUTA_NP aAlfa;

     |SI #98#9 = "S";
         aAlfa     = ":contagen/capastiz;" + #0#0;  |QBT aAlfa;
         |SUB_EJECUTA_NP aAlfa;
     |FINSI;

     |SI #98#7 = "N";
         aAlfa     = ":contagen/capasdep;" + #0#0;  |QBT aAlfa;
         |SUB_EJECUTA_NP aAlfa;
     |FINSI;

     aAlfa     = ":contagen/capasact;" + #0#0;  |QBT aAlfa;
     |SUB_EJECUTA_NP aAlfa;

     aAlfa     = ":contagen/capasnif;" + #0#0;  |QBT aAlfa;
     |SUB_EJECUTA_NP aAlfa;

     |SI #98#5 = "S";
         |HAZ CambiaConcepto;
     |SINO;
         |HAZ TerminaEmpresa;
     |FINSI;

     eSwCambio = 0;
     eaPreg22_1 = #22#1;  ||Preguntar si cambia
     eaPreg22_2 = #22#2;  ||Cambio Maestra
     eaPreg22_6 = #22#6;
     eaPreg22_8 = #22#8;
     aAlfa      = ":contagen/capasz03;" + #0#0;  |QBT aAlfa;
     |SUB_EJECUTA_NP aAlfa;

     eaPreg22_5 = #22#5;  ||Imprimir Errores
     aAlfa      = ":contagen/capasy01;" + #0#0;  |QBT aAlfa;
     |SUB_EJECUTA_NP aAlfa;
     aAlfa      = ":contagen/capasy02;" + #0#0;  |QBT aAlfa;
     |SUB_EJECUTA_NP aAlfa;

     enEjerConta = #98#2;
     |ABRE #95;
     #95#0 = #98#0;
     #95#1 = #98#8;
     #95#2 = #98#2;
     #95#3 = #98#3;
     #95#5 = #98#7;
     #95#6 = #98#1;
     #95#7 = #98#10;
     |GRABA 020#95n;
     |LIBERA #95;
     |CIERRA #95;

     |ENTLINEAL #2#95, -1, 7, 22, 0, ClaveAlta95, ClaveBaja95;

     |BORRA 020#98a;
     |LIBERA #98;

     |ENTLINEAL #1#98, -1, 7, 14, 0, ClaveBaja98, ClaveAlta98;

     |SI aPathAgieos = ""; |Y aPathAgicli = ""; ||no existe eos ni integral en la NOPI
         eaPPortadaX = aPathOrigen;
         eaPPortadaO = aPathAnterior;
         eaPPortadaD = aDirFichDestino;
         |HAZ PaseDePortada;
     |FINSI;

     |SI eaPathDscarter ! ""; |Y aCartera = "S";
         |HAZ DsCarter;
     |FINSI;
|FPRC;

|DEFBUCLE dspase98;
     #98#1;
     4;
     00000, 0, "S";
     99999, 9, "S";
     be;
     NULL, CreaEmpresaCon;
|FIN;

|RUTINA ClaveBaja98;
     #98#0 = 00001;
     #98#1 = 0;
|FRUT;

|RUTINA ClaveAlta98;
     #98#0 = 99999;
     #98#1 = 9;
|FRUT;

|PROCESO Contagen;

     nSwAplicacion   = 7;
     aDirEmpresaN    = "";
     aDirEmpresaV    = "";
     aPathOrigen     = #0#0;  |QBF aPathOrigen;
     aPathOrigen     = aPathOrigen + "agicont/";
     aPathAnterior   = aPathOrigen + "fich/";
     aPathDestino    = eaPathContagen - "fich/";

     |HAZ EmpresaCero;

     aDirEmpresaN    = "";
     aDirEmpresaV    = "";
     aPathOrigen     = #0#0;  |QBF aPathOrigen;
     aPathOrigen     = aPathOrigen + "agicont/";
     aPathAnterior   = aPathOrigen + "fich/";
     aPathDestino    = eaPathContagen - "fich/";
     |HAZ HazElDir;

     aDef            = aPathOrigen + "def/canempre";
     |CARGA_DEF aDef, refecon@;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     aDef            = aPathDestino + "def/canempre";
     aDirFichDestino = aPathDestino + "fich/";
     |CARGA_DEF aDef, refebue@;
     |SI FSalida ! 0;
         |DESCARGA_DEF #refecon@;
         |ACABA;
     |FINSI;

     |PATH_DAT #998 aPathAnterior;
     |PATH_DAT #997 aDirFichDestino;

     |ABRE #98;
     |ABRE #95;
     |ABRE #997;
     |BUCLE canempre;
     |CIERRA #95;
     |CIERRA #98;

     |PARA; |SI;  |HACIENDO;
          |PUSHV 0501 2380;
          |ENTLINEAL #1#95, -1, 7, 22, 0, ClaveBaja95, ClaveAlta95;
          |ENTLINEAL #1#98, -1, 2, 14, 0, ClaveBaja98, ClaveAlta98;
          |POPV;

          |CONFI "0000NEsta seguro de la Seleccion Realizada ";
          |SI FSalida = 0;  |SAL;  |FINSI;
     |SIGUE;

     nTContab        = 0;
     nEmprePasada    = 0;
     nTAcum          = 0;
     |ABRE #95;  |CIERRA #95;  |DELINDEX #95;
     |BUCLE dspase98B;
     |CIERRA #997;

     |DESCARGA_DEF #refebue@;
     |DESCARGA_DEF #refecon@;

     |HORA aHora;

     #4#5  = ~;                            |PINTA #4#5;
     aAlfa = aHora % 102;  #4#6  = aAlfa;  |PINTA #4#6;
     aAlfa = aHora % 402;  #4#7  = aAlfa;  |PINTA #4#7;
     #4#14 = nEmpreContab;                 |PINTA #4#14;
     #4#15 = 60;                           |PINTA #4#15;

     nTContab = 60;
     |HAZ CalculaTiempo;

     |ENTLINEAL #1#98, -1, 7, 14, 0, ClaveBaja98, ClaveAlta98;
     |BUCLE dspase98;


|| ... Repaso Moneda
     aDef            = aPathDestino + "def/canempre";
     aDirFichDestino = aPathDestino + "fich/";
     |CARGA_DEF aDef, refebue@;
     |SI FSalida ! 0;  |ACABA; |FINSI;
     |PATH_DAT #997 aDirFichDestino;

     aDef = aPathDestino + "def/camoneda.mas";
     |CARGA_DEF aDef, referen@;
     |SI FSalida ! 0;
         |DESCARGA_DEF #refebue@;
         |ACABA;
     |FINSI;

     |ABRE #999;
     |BUCLE RepasoMoneda;
     |CIERRA #999;
     |DESCARGA_DEF #referen@;

     |ABRE #997;
     |BUCLE RepasoCtrl8;
     |CIERRA #997;


     |DESCARGA_DEF #refebue@;
|FPRC;

|| ________________________________________________________________________
|| Reparto
|| ________________________________________________________________________

|PROCESO Tipo12;  |TIPO 12;
|FPRC;

|PROCESO BuscaAnterior;
   aPathAgieos = "";
   aAlfa = aPathAnterior + "agieos/def/eosclien.mas";
   |XABRE "E", aAlfa, nNume1;
   |SI FSalida ] 0;
        aPathAgieos = aPathAnterior + "agieos/";
   |FINSI;

   aPathAgicli = "";
   aAlfa = aPathAnterior + "agicli/def/agiclien.mas";
   |XABRE "E", aAlfa, nNume1;
   |SI FSalida ] 0;
        aPathAgicli = aPathAnterior + "agicli/";
   |FINSI;
|FPRC;

|PROCESO PantaCartera;
     |PINTA 0574, "Â";
     |PINTA 0674, "³";  |PINTA 0774, "³"; |PINTA 0874, "³";
     |PINTA 0974, "³";  |PINTA 1074, "³"; |PINTA 1174, "³";
     |PINTA 1274, "³";  |PINTA 1374, "³"; |PINTA 1474, "³";
     |PINTA 1574, "Á";
     |ATRI R; |PINTA 0675, "D";
              |PINTA 0677, "A";
              |PINTA 0679, "R";
     |ATRI 0;
     |C_P #dspase98#5,1,0773;
     |C_P #dspase98#7,1,0775;
     |C_P #dspase98#9,1,0777;
     |C_V #dspase98#10, 1, "S";
     |C_M #dspase98#10, 1, "S";
|FPRC;

|PROGRAMA;
     |ABRE #0;
     |LEE 040#0p;
     |SI FSalida ! 0;
         |MENAV "    No se ha realizado el Pase de Aplicaciones Restantes";
         |CIERRA #0;
         |ACABA;
     |FINSI;
     |CIERRA #0;

     |ABRE #22;
     |DDEFECTO #22;
     |LEE 040#22p;
     |SI FSalida ! 0;
         #22#1 = "N"; #22#2 = "N"; #22#3 = "N"; #22#4 = "N"; #22#5 = "S";
     |FINSI;
     |CIERRA #22;
     |SI #22#3 = "S"; |C_M #98#5,1,"N"; |FINSI;

     |ABRE #15;
     |LEE 040#15p;
     |SI FSalida ! 0;
         nEstaCambio = 0;
         |DDEFECTO #15;
     |SINO;
         nEstaCambio = 1;
         |SI #15#15 ! "S";
             |MENAV "      Unificacion de Codigos no Realizada.";
             |CIERRA #15;
             |ACABA;
         |FINSI;
     |FINSI;
     |CIERRA #15;

     |HAZ BusquedaApli;
     aPathDestino    = eaPathContagen - "fich/";

     |SI eaPathDscarter ! "";
         aDef = eaPathDscarter + "def/dscam000.mas";
         |CARGA_DEF aDef, emcarte@;
         |SI FSalida = 0;
             |DESCARGA_DEF #emcarte@;
         |SINO;
             eaPathDscarter = "";
         |FINSI;
     |FINSI;

     |HAZ BuscaAnterior;

     |ABRE #98;
     |LEE 040#98p;
     |SI FSalida = 0;
         |DDEFECTO #4;
         #4#1 = #98#0;
         #4#2 = #98#1;
         #4#3 = #98#3;

         |PINPA #1#4;
         |PINDA #1#4;

         |ENDATOS #1#4;
         |SI FSalida ! 0;  |ACABA;  |FINSI;
         |SI #4#4 = "N";   |ACABA;  |FINSI;

         #95#0 = #98#0;
         #95#1 = #98#8;
         |HAZ Borrado;
     |FINSI;
     |CIERRA #98;

     |ABRE #98;  |CIERRA #98;  |DELINDEX #98;
     |ABRE #95;  |CIERRA #95;  |DELINDEX #95;

     |CLS;
     |CABEZA "     Pase de Ficheros Contabilidad";
     |PINPA #0#4;
     |PINPA #0#4;
     |SI eaPathDscarter ! "";
         |HAZ PantaCartera;
     |FINSI;

     |DBASE aBase;  |QBF aBase;
     aPathPases = aBase + "pases";  |MKDIR aPathPases;
     aPathPases = aPathPases + "/";

     |PATH_DAT #96 aPathPases;
     |PATH_DAT #97 aPathPases;

     |ABRE #96;
     |LEE 040#96p;
     |SI FSalida ! 0;
         |CIERRA #96;
         aOrigen  = aBase + "fich/dspase96.dat";
         aDestino = aPathPases + "dspase96.dat";
         |COPIA_FICHERO aOrigen, aDestino;
     |FINSI;
     |CIERRA #96;

     |ABRE #97;
     |LEE 040#97p;
     |SI FSalida ! 0;
         |CIERRA #97;
         aOrigen  = aBase + "fich/dspase97.dat";
         aDestino = aPathPases + "dspase97.dat";
         |COPIA_FICHERO aOrigen, aDestino;
     |FINSI;
     |CIERRA #97;

     |SI eaPathContagen ! "";  |HAZ Contagen;  |FINSI;

     |DELINDEX #95;
     |DELINDEX #98;
|FPRO;
