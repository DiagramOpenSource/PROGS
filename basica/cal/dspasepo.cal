|FICHEROS;
     :/integral/def/dsam0000 #1;
     :/integral/def/dsam0003 #3;
     :/integral/def/dsam0009 #9;
     :/integral/def/dsam0106 #106;
     :/integral/def/dsam0107 #107;
     :/integral/def/dsam0116 #116;

     agifigen #2;

     agitab10 #1110;
     agitab14 #1111;
     agitab12 #1112;
     agiepim2 #1113;
     agicen14 #1114;
     agicen15 #1115;

     caportad@ #909;
|FIN;

|VARIABLES;
     &eaPPortadaX = "";
     &eaPPortadaO = "";
     &eaPPortadaD = "";
     &enEmpresa   = 0;
     &enEmpresaV  = 0;
     &enPeriodo   = 0;
     &enPeriodoV  = 0;
     &enEjerConta = 0;
     &eaPathIntegral = "";

     nActividad   = 0;
     nPara1       = 0;
     nNume1       = 0;
     aDef         = "";
     nCodigoNue   = 0;
     aAlfa        = "";
     aAlfa1       = "";
     aAlfa2       = "";
     aAlfa3       = "";
     aAlfa4       = "";

     nLineaTel    = 0;
     aTPpal       = "";
     aTCont       = "";
     aTFax        = "";
     aTOtros      = "";
|FIN;

|PROCESO GrabaLineaTelefono;
     |ABRE #107;

     #107#0 = #106#0;
     #107#1 = nLineaTel;
     |LEE 101#107=;
     |SI FSalida ! 0;
         |DDEFECTO #107;
          #107#0 = #106#0;
          #107#1 = nLineaTel;
          |GRABA 020#107b;
     |FINSI;

     #107#2 = aAlfa2;
     #107#4 = aAlfa4;
     |GRABA 020#107a;
     |LIBERA #107;

     |CIERRA #107;
|FPRC;

|PROCESO GrabaTelefonos;
     |ABRE #106;
     #106#0 = #1#1;
     |LEE 101#106=;
     |SI FSalida ! 0;
         #106#0 = #1#1;
         #106#1 = #1#27;
         #106#2 = #1#28;
         |GRABA 020#106n;
         |LIBERA #106;
     |FINSI;

     |SI aTPpal ! "";
         nLineaTel = 1;
         aAlfa2    = "TELEFONO PRINCIPAL";
         aAlfa4    = aTPpal;
         |HAZ GrabaLineaTelefono;

         nLineaTel = 1;
         aAlfa2    = "TELEFONO DE CONTACTO";
         aAlfa4    = aTPpal;
         |HAZ GrabaLineaTelefono;
     |FINSI;

     |SI aTCont ! "";
         nLineaTel = 2;
         aAlfa2    = "TELEFONO DE CONTACTO";
         aAlfa4    = aTCont;
         |HAZ GrabaLineaTelefono;
     |FINSI;

     |SI aTFax ! "";
         nLineaTel = 3;
         aAlfa2    = "TELEFONO FAX";
         aAlfa4    = aTFax;
         |HAZ GrabaLineaTelefono;
     |FINSI;

     |SI aTOtros ! "";
         nLineaTel = 4;
         aAlfa2    = "OTROS TELEFONOS " + aTOtros;
         aAlfa4    = "";
         |HAZ GrabaLineaTelefono;
     |FINSI;
     |CIERRA #106;
|FPRC;

|PROCESO BancoConta;
     aAlfa1 = #909#66; |QBF aAlfa1;
     aAlfa2 = #909#67; |QBF aAlfa2;
     aAlfa3 = #909#68;
     aAlfa4 = #909#69;

     |SI aAlfa1 = "";  |Y aAlfa2 = "";  |ACABA;  |FINSI;

     #116#2 = aAlfa1;
     #116#3 = aAlfa2;
     #116#4 = "";
     |LEE 040#116];
     |SI FSalida ! 0;  |O #116#2 ! aAlfa1;  |O #116#3 ! aAlfa2;
         |DDEFECTO #116;
     |FINSI;

     #9#0 = nCodigoNue;
     #9#1 = 999;
     |LEE 101#9=;
     |SI FSalida = 0;  |LIBERA #9;  |ACABA;  |FINSI;

     |DDEFECTO #9;
     #9#0 = nCodigoNue;
     #9#1 = 999;
     #9#2  = "BANCO PARA GESTION MODELOS";
     #9#3  = #116#0;
     #9#4  = #116#1;
     #9#5  = aAlfa1;
     #9#6  = aAlfa2;
     #9#7  = aAlfa3;
     #9#8  = aAlfa4;
     |GRABA 020#9n;
     |LIBERA #9;
|FPRC;

|PROCESO GrabaRep;
     |ABRE #1115;
     #1115#0 = nCodigoNue;
     |LEE 101#1115=;
     |SI FSalida ! 0;
         #1115#0 = nCodigoNue;
         |GRABA 020#1115b;
     |FINSI;

     #1115#2 = #909#2;
     #1115#3 = #909#20;
     #1115#4 = #909#38;
     #1115#5 = #909#39;
     #1115#7 = "REPRESENTANTE";
     #1115#8 = #909#40;
     #1115#9 = #909#41;
     #1115#10 = #909#42;
     #1115#11 = #909#43;
     #1115#12 = #909#44;
     #1115#13 = #909#45;
     #1115#14 = #909#46;
     #1115#15 = #909#47;
     #1115#16 = #909#48;
     #1115#17 = #909#49;
     #1115#18 = #909#50;
     #1115#19 = "REPRESENTANTE";

     |GRABA 020#1115a;
     |LIBERA #1115;
     |CIERRA #1115;
|FPRC;

|PROCESO PonTiposActiv;
     #1114#7  = 1;
     |SI #909#73 = 0;  #1114#7 = 1;  |FINSI;
     |SI #909#73 = 1;  #1114#7 = 2;  |FINSI;
     |SI #909#73 = 2;  #1114#7 = 5;  |FINSI;
     |SI #909#73 = 3;  #1114#7 = 5;  |FINSI;
     |SI #909#73 = 4;  #1114#7 = 7;  |FINSI;
     |SI #909#73 = 5;  #1114#7 = 4;  |FINSI;
     |SI #909#73 = 6;  #1114#7 = 10; |FINSI;
     |SI #909#73 = 7;  #1114#7 = 2;  |FINSI;
     |SI #909#73 = 8;  #1114#7 = 3;  |FINSI;
     |SI #909#73 = 9;  #1114#7 = 3;  |FINSI;

     #1114#9 = 1;
     |SI #909#81 = "A";   #1114#9 = 5;  |FINSI;
     |SI #909#81 = "B";   #1114#9 = 4;  |FINSI;
     |SI #909#81 = "C";   #1114#9 = 3;  |FINSI;

     |SI #909#81 = "A";   |Y #909#83 = "S";
         #1114#9 = 6;
     |FINSI;

     |SI #1114#9 = 1;   |Y #909#83 = "S";
         #1114#9 = 7;
     |FINSI;

     #1110#0 = #1114#7;
     |LEE 040#1110=;
     |SI FSalida ! 0;  |DDEFECTO #1110;  |FINSI;

     #1112#0 = #1114#9;
     |LEE 040#1112=;
     |SI FSalida ! 0;  |DDEFECTO #1112;  |FINSI;

     #1114#8  = #1110#5;
     #1114#10 = #1112#5;


     aAlfa1 = #1114#3 % 101;
     aAlfa1 = aAlfa1 + "00";
     aAlfa2 = #1114#3; |QBF aAlfa2;
     aAlfa3 = aAlfa2 % 0;
     |SI aAlfa3 = 4;
         aAlfa2 = (#1114#3 % 103) + "." + (#1114#3 % 401);
     |FINSI;
     #1113#0 = #1114#2;
     #1113#1 = aAlfa1;
     #1113#2 = aAlfa2;
     |LEE 041#1113=;
     |SI FSalida = 0;
         #1114#11 = #1113#5;
         #1111#0  = #1114#11;
         |LEE 041#1111=;
         |SI FSalida = 0;
             #1114#12 = #1111#1;
         |FINSI;
         #1114#20 = #1113#6;
         #1114#21 = #1113#4;
     |FINSI;
|FPRC;

|PROCESO PasaActCon;
     |ABRE #1110;
     |ABRE #1111;
     |ABRE #1112;
     |ABRE #1113;
     |ABRE #1114;
     #1114#0 = nCodigoNue;
     #1114#1 = nActividad;
     |LEE 141#1114=;
     |SI FSalida ! 0;
         |DDEFECTO #1114;
         #1114#0 = nCodigoNue;
         #1114#1 = nActividad;
         #1114#2 = #909#82;
         nNume1  = nPara1 + 12;
         aAlfa1  = #909nNume1 % 101;
         |SI aAlfa1 = "E";
             #909nNume1 = #909nNume1 - ".";
             #1114#3 = #909nNume1 % 204;
         |SINO;
             #909nNume1 = #909nNume1 - ".";
             #1114#3 = #909nNume1;
          |FINSI;
          #1114#4 = #909nPara1;

          |HAZ PonTiposActiv;

          |GRABA 020#1114n;
     |SINO;

         #1114#2 = #909#82;
         nNume1  = nPara1 + 12;
         aAlfa1  = #909nNume1 % 101;
         |SI aAlfa1 = "E";
             #909nNume1 = #909nNume1 - ".";
             #1114#3 = #909nNume1 % 204;
         |SINO;
             #909nNume1 = #909nNume1 - ".";
             #1114#3 = #909nNume1;
          |FINSI;
          #1114#4 = #909nPara1;

          |HAZ PonTiposActiv;

          |GRABA 020#1114a;
     |FINSI;
     |LIBERA #1114;
     |CIERRA #1114;
     |CIERRA #1113;
     |CIERRA #1112;
     |CIERRA #1111;
     |CIERRA #1110;
|FPRC;

|PROCESO PasoDatos;
     |ABRE #1;
     #1#0 = nCodigoNue;
     |LEE 141#1=;
     |SI FSalida = 0;

         #1#15 = #909#16; #1#16 = #909#17;  || Hacienda
         #1#17 = #909#18; #1#18 = #909#19;
         #1#57 = #909#102;                  || Letra Etiqueta
         #1#53 = #909#89;                   || Persona de Contacto

         aAlfa1 = #909#38; aAlfa2 = #909#39;
         |QBF aAlfa1;      |QBF aAlfa2;
         |SI aAlfa1 ! ""; |O aAlfa2 ! "";
             |HAZ GrabaRep;
         |FINSI;

         |HAZ BancoConta;

         aAlfa2 = #909#90; |QBF aAlfa2;
         aAlfa1 = #909#91; |QBF aAlfa1;
         |SI aAlfa1 ! "";
             aTCont = aAlfa2 + aAlfa1;
             aTPpal  = "";
             aTOtros = "";
             aTFax   = "";
             |HAZ GrabaTelefonos;
         |FINSI;

         nActividad = 0;
         |PARA nPara1 = 20; |SI nPara1 [ 25; |HACIENDO nPara1 = nPara1 + 1;
               aAlfa1 = #909nPara1; |QBF aAlfa1;
               |SI aAlfa1 ! "";
                   nActividad = nActividad + 1;
                   |HAZ PasaActCon;
               |FINSI;
         |SIGUE;
         |GRABA 020#1a;
     |FINSI;
     |LIBERA #1;
     |CIERRA #1;
|FPRC;

|PROCESO PasoDatos_Basica;
     |ABRE #2;
     #2#0 = nCodigoNue;
     |LEE 141#2=;
     |SI FSalida = 0;

         #2#63 = #909#16; #2#64 = #909#17;  || Hacienda
         #2#91 = #909#18; #2#92 = #909#19;
         #2#96 = #909#89;                   || Persona de Contacto

         aAlfa1 = #909#38; aAlfa2 = #909#39;
         |QBF aAlfa1;      |QBF aAlfa2;
         |SI aAlfa1 ! ""; |O aAlfa2 ! "";
             |HAZ GrabaRep;
         |FINSI;

         #2#81 = #909#66;
         #2#82 = #909#67;
         #2#83 = #909#68;
         #2#84 = #909#69;
         #2#80 = #909#70;
         #2#14 = #909#14;
         aAlfa2 = #909#90; |QBF aAlfa2;
         aAlfa1 = #909#91; |QBF aAlfa1;
         |SI aAlfa1 ! "";
             #2#61 = aAlfa2 + aAlfa1;
         |FINSI;

         nActividad = 0;
         |PARA nPara1 = 20; |SI nPara1 [ 25; |HACIENDO nPara1 = nPara1 + 1;
               aAlfa1 = #909nPara1; |QBF aAlfa1;
               |SI aAlfa1 ! "";
                   nActividad = nActividad + 1;
                   |HAZ PasaActCon;
               |FINSI;
         |SIGUE;
         |GRABA 020#2a;
     |FINSI;
     |LIBERA #2;
     |CIERRA #2;
|FPRC;

|PROCESO PaseDePortada;

     nCodigoNue = enEmpresa;

     aDef = eaPPortadaX + "def/caportad.mas";
     |CARGA_DEF aDef, caportad@;
     |SI FSalida ! 0;
         aAlfa1   = "     Error en Cargar el Def fichero de Portadas de Empresas Contable de Agicont";
         |MENAV aAlfa1;
         |ACABA;
     |FINSI;

     |SI eaPathIntegral ! "";
         |ABRE #9;
         |ABRE #116;
     |FINSI;

     |PATH_DAT #909 eaPPortadaO;

     |ABRE #909;
     #909#0 = enEmpresaV;
     #909#1 = enEjerConta;
     |LEE 001#909=;
     |SI FSalida = 0;
         |SI eaPathIntegral ! "";
             |HAZ PasoDatos;
         |SINO;
             |HAZ PasoDatos_Basica;
         |FINSI;
     |FINSI;
     |CIERRA #909;

     |SI eaPathIntegral ! "";
         |CIERRA #116;
         |CIERRA #9;
     |FINSI;

     |DESCARGA_DEF #caportad@;
|FPRC;
