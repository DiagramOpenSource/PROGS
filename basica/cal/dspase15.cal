|FICHEROS;
     dspase15;
     dspase16;
     dspase18,MANTE;
     dspase19;
     dspase00;

     dspasw01;
     dspasw02;

     :/basica/def/agifigen;
     :/laboral/def/labempre;
     :/contagen/def/canempre;
     :/contasoc/def/maacceso;
     :/facturar/def/facemp;
     :/facturar/def/asclient;

     espejo1@;
     espejo2@;
|FIN;

|VARIABLES;
     nRegistro         = 0;
     nCasilla          = 0;
     nCodigo           = 0;
     nRegis            = 0;
     nSwMalo           = 0;
     nCarga            = 0;
     nTecla            = 0;
     nEmpresa          = 0;
     nBoton1           = 0;
     nBoton2           = 0;
     nBoton3           = 0;
     nBoton4           = 0;
     nBoton5           = 0;
     nBoton6           = 0;
     nSwRepe           = 0;
     nSwIncidencia     = 0;
     nNume1            = 0;
     nNume2            = 0;
     nPos              = 0;
     nLong             = 0;
     nCampo            = 0;
     nError            = 0;
     nCFac             = 0;
     nOrden            = 0;
     nSwPrint          = 0;
     nCampo13          = 0;
     nCampo14          = 0;
     nRango            = 0;
     nGridTempo        = -1;
     nCampo1           = 0;
     nCampo2           = 0;
     nID               = 0;
     nBotonSalir       = 0;
     nRentas           = 0;
     nCodCambio        = 0;
     nTodos            = 0;

     nHayAnterior      = 0;

     aAplica           = "";
     aNif1             = "";
     aDef              = "";
     aFich             = "";
     aPath             = "";
     aAlfa             = "";
     aLong             = "";
     aPathDefFiscal    = "";
     aPathFichFiscal   = "";
     aPathAnterior     = "";
     aDNombre          = "";
     aHNombre          = "zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz";
     aDBorrado         = "";
     aHBorrado         = "";
     aBase             = "";
     aFichOrigen       = "";
     aOrigen           = "";
     aDestino          = "";
     aFichero          = "";
     aID               = "";

     aLetra1     = "";
     aLetra2     = "";
     aLetra3     = "";
     aLetra4     = "";
     aLetra5     = "";
     aLetra6     = "";
     aLetra7     = "";
     aLetra8     = "";
     aCadena     = "";
     aCaracter   = "";
     aCarac1     = 0;
     aCarac2     = 0;
     aCarac3     = 0;
     aCarac4     = 0;
     aCarac5     = 0;
     nCaracter   = 0;
     nPosi       = 0;

     &eaError          = "";
     &eaPathFacturar   = "";
     &eaPathRen2018    = "";
     &eaPathRen2017    = "";
     &eaPathRen2016    = "";
     &eaPathRen2015    = "";
     &eaPathRen2014    = "";
     &eaPathRen2013    = "";
     &eaPathRen2012    = "";
     &eaPathRen2011    = "";
     &eaPathRen2010    = "";
     &eaPathRen2009    = "";
     &eaPathRen2008    = "";
     &eaPathRen2007    = "";
     &eaPathRen2006    = "";
     &eaPathRen2005    = "";
     &eaPathRen2004    = "";
     &eaPathRen2003    = "";
     &eaPathRen2002    = "";
     &eaPathRen2001    = "";
     &eaPathRen2000    = "";
     &eaPathRen1999    = "";
     &eaPathRen1998    = "";
     &eaPathRen1997    = "";
     &eaPathRen1996    = "";
     &eaPathRen1995    = "";
     &eaPathRen1994    = "";
     &enSwUno          = 0;
     &eaEFacges        = "";
     &eaCFacges        = "";

     &eaVarDni         = "";
     &enCalcCif        = 0;

     aAlfa1 = "";
     aAlfa2 = "";
|FIN;

|PROCESO SacaNumero;
     |QBT aAlfa;
     aCadena = "";
     aLong   = aAlfa % 0;
     nLong   = aLong;
     |PARA nCampo = 1;  |SI nCampo [ aLong;  |HACIENDO nCampo = nCampo + 1;
           nPos = (100 * nCampo) + 1;
           aCaracter = aAlfa % nPos;
           |SI aCaracter = "0";  aCadena = aCadena + aCaracter;   |FINSI;
           |SI aCaracter = "1";  aCadena = aCadena + aCaracter;   |FINSI;
           |SI aCaracter = "2";  aCadena = aCadena + aCaracter;   |FINSI;
           |SI aCaracter = "3";  aCadena = aCadena + aCaracter;   |FINSI;
           |SI aCaracter = "4";  aCadena = aCadena + aCaracter;   |FINSI;
           |SI aCaracter = "5";  aCadena = aCadena + aCaracter;   |FINSI;
           |SI aCaracter = "6";  aCadena = aCadena + aCaracter;   |FINSI;
           |SI aCaracter = "7";  aCadena = aCadena + aCaracter;   |FINSI;
           |SI aCaracter = "8";  aCadena = aCadena + aCaracter;   |FINSI;
           |SI aCaracter = "9";  aCadena = aCadena + aCaracter;   |FINSI;
     |SIGUE;
|FPRC;

|PROCESO dspase16_2;
     |SI #dspase16#3 ! 0;  |Y #espejo2@#3 ! 0;
         |SI #dspase16#3 ! #espejo2@#3;  nSwMalo = 1;  |ERROR10;  |ACABA;  |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE dspase16_2;
     #espejo2@#1003;
     ;
     #espejo1@#0, #espejo1@#1, #dspase16#2;
     #espejo1@#0, #espejo1@#1, #dspase16#2;
     ;
     NULL, dspase16_2;
|FIN;

|PROCESO dspase16_1;
     |BUCLE dspase16_2;
|FPRC;

|DEFBUCLE dspase16_1;
     #dspase16#1;
     ;
     #dspase15#0, #dspase15#1, 00;
     #dspase15#0, #dspase15#1, 99;
     ;
     NULL, dspase16_1;
|FIN;

|PROCESO LeePorCodigos;
     |SI #espejo1@#0 = #dspase15#0; |Y #espejo1@#1 = #dspase15#1;  |ACABA;  |FINSI;

     |SI #espejo1@#22 = "S";  |ACABA;  |FINSI;

     aAlfa   = #espejo1@#0;  |HAZ SacaNumero;   nNume1 = aCadena;
     aAlfa   = #dspase15#0;    |HAZ SacaNumero;   nNume2 = aCadena;

     |SI #dspase15#4 ! 0;  |Y #espejo1@#4 ! 0;
         |SI #dspase15#4 ! #espejo1@#4;  nSwMalo = 1;  |ERROR10;  |ACABA;  |FINSI;
     |FINSI;

     |SI #dspase15#5 ! 0;  |Y #espejo1@#5 ! 0;
         |SI #dspase15#5 ! #espejo1@#5;  nSwMalo = 1;  |ERROR10;  |ACABA;  |FINSI;
     |FINSI;

     |SI #dspase15#6 ! 0;  |Y #espejo1@#6 ! 0;
         |SI #dspase15#6 ! #espejo1@#6;  nSwMalo = 1;  |ERROR10;  |ACABA;  |FINSI;
     |FINSI;

     |SI #dspase15#7 ! 0;  |Y #espejo1@#7 ! 0;
         |SI #dspase15#7 ! #espejo1@#7;  nSwMalo = 1;  |ERROR10;  |ACABA;  |FINSI;
     |FINSI;

     |SI #dspase15#8 ! 0;  |Y #espejo1@#8 ! 0;
         |SI #dspase15#8 ! #espejo1@#8;  nSwMalo = 1;  |ERROR10;  |ACABA;  |FINSI;
     |FINSI;

     |SI #dspase15#9 ! 0;  |Y #espejo1@#9 ! 0;
         |SI #dspase15#9 ! #espejo1@#9;  nSwMalo = 1;  |ERROR10;  |ACABA;  |FINSI;
     |FINSI;

     |SI #dspase15#10 ! 0;  |Y #espejo1@#10 ! 0;
         |SI #dspase15#10 ! #espejo1@#10;  nSwMalo = 1;  |ERROR10;  |ACABA;  |FINSI;
     |FINSI;

     |SI #dspase15#11 ! 0;  |Y #espejo1@#11 ! 0;
         |SI #dspase15#11 ! #espejo1@#11;  nSwMalo = 1;  |ERROR10;  |ACABA;  |FINSI;
     |FINSI;

     |SI #dspase15#12 ! 0;  |Y #espejo1@#12 ! 0;
         |SI #dspase15#12 ! #espejo1@#12;  nSwMalo = 1;  |ERROR10;  |ACABA;  |FINSI;
     |FINSI;

     |SI #dspase15#13 ! 0;  |Y #espejo1@#13 ! 0;
         |SI #dspase15#13 ! #espejo1@#13;  nSwMalo = 1;  |ERROR10;  |ACABA;  |FINSI;
     |FINSI;

     |SI #dspase15#14 ! 0;  |Y #espejo1@#14 ! 0;
         |SI #dspase15#14 ! #espejo1@#14;  nSwMalo = 1;  |ERROR10;  |ACABA;  |FINSI;
     |FINSI;

     |SI #dspase15#17 ! 0;  |Y #espejo1@#17 ! 0;
         |SI #dspase15#17 ! #espejo1@#17;  nSwMalo = 1;  |ERROR10;  |ACABA;  |FINSI;
     |FINSI;

     |SI #dspase15#23 ! 0;  |Y #espejo1@#23 ! 0;
         |SI #dspase15#23 ! #espejo1@#23;  nSwMalo = 1;  |ERROR10;  |ACABA;  |FINSI;
     |FINSI;

     |SI #dspase15#24 ! 0;  |Y #espejo1@#24 ! 0;
         |SI #dspase15#24 ! #espejo1@#24;  nSwMalo = 1;  |ERROR10;  |ACABA;  |FINSI;
     |FINSI;

     |SI #dspase15#25 ! 0;  |Y #espejo1@#25 ! 0;
         |SI #dspase15#25 ! #espejo1@#25;  nSwMalo = 1;  |ERROR10;  |ACABA;  |FINSI;
     |FINSI;

     |SI #dspase15#26 ! 0;  |Y #espejo1@#26 ! 0;
         |SI #dspase15#26 ! #espejo1@#26;  nSwMalo = 1;  |ERROR10;  |ACABA;  |FINSI;
     |FINSI;

     |SI #dspase15#27 ! 0;  |Y #espejo1@#27 ! 0;
         |SI #dspase15#27 ! #espejo1@#27;  nSwMalo = 1;  |ERROR10;  |ACABA;  |FINSI;
     |FINSI;

     |SI #dspase15#28 ! 0;  |Y #espejo1@#28 ! 0;
         |SI #dspase15#28 ! #espejo1@#28;  nSwMalo = 1;  |ERROR10;  |ACABA;  |FINSI;
     |FINSI;

     |SI #dspase15#29 ! 0;  |Y #espejo1@#29 ! 0;
         |SI #dspase15#29 ! #espejo1@#29;  nSwMalo = 1;  |ERROR10;  |ACABA;  |FINSI;
     |FINSI;

     |SI #dspase15#30 ! 0;  |Y #espejo1@#30 ! 0;
         |SI #dspase15#30 ! #espejo1@#30;  nSwMalo = 1;  |ERROR10;  |ACABA;  |FINSI;
     |FINSI;

     |SI #dspase15#31 ! 0;  |Y #espejo1@#31 ! 0;
         |SI #dspase15#31 ! #espejo1@#31;  nSwMalo = 1;  |ERROR10;  |ACABA;  |FINSI;
     |FINSI;

     |SI #dspase15#32 ! 0;  |Y #espejo1@#32 ! 0;
         |SI #dspase15#32 ! #espejo1@#32;  nSwMalo = 1;  |ERROR10;  |ACABA;  |FINSI;
     |FINSI;

     |SI #dspase15#33 ! 0;  |Y #espejo1@#33 ! 0;
         |SI #dspase15#33 ! #espejo1@#33;  nSwMalo = 1;  |ERROR10;  |ACABA;  |FINSI;
     |FINSI;

     |SI #dspase15#34 ! 0;  |Y #espejo1@#34 ! 0;
         |SI #dspase15#34 ! #espejo1@#34;  nSwMalo = 1;  |ERROR10;  |ACABA;  |FINSI;
     |FINSI;

     |SI #dspase15#35 ! 0;  |Y #espejo1@#35 ! 0;  || 2013
         |SI #dspase15#35 ! #espejo1@#35;  nSwMalo = 1;  |ERROR10;  |ACABA;  |FINSI;
     |FINSI;

     |SI #dspase15#36 ! 0;  |Y #espejo1@#36 ! 0;  || 2014
         |SI #dspase15#36 ! #espejo1@#36;  nSwMalo = 1;  |ERROR10;  |ACABA;  |FINSI;
     |FINSI;

     |SI #dspase15#37 ! 0;  |Y #espejo1@#37 ! 0;  || 2015
         |SI #dspase15#37 ! #espejo1@#37;  nSwMalo = 1;  |ERROR10;  |ACABA;  |FINSI;
     |FINSI;

     |SI #dspase15#38 ! 0;  |Y #espejo1@#38 ! 0;  || 2016
         |SI #dspase15#38 ! #espejo1@#38;  nSwMalo = 1;  |ERROR10;  |ACABA;  |FINSI;
     |FINSI;

     |SI #dspase15#39 ! 0;  |Y #espejo1@#39 ! 0;  || 2017
         |SI #dspase15#39 ! #espejo1@#39;  nSwMalo = 1;  |ERROR10;  |ACABA;  |FINSI;
     |FINSI;

     |SI #dspase15#40 ! 0;  |Y #espejo1@#40 ! 0;  || 2018
         |SI #dspase15#40 ! #espejo1@#40;  nSwMalo = 1;  |ERROR10;  |ACABA;  |FINSI;
     |FINSI;

     |BUCLE dspase16_1;

     |SI nNume1 ! nNume2;  |Y nSwMalo = 0;
         |CONFI "0000NCodigo Existente en otro NIF. Mantengo el Codigo. ";
         |SI FSalida ! 0;
             #dspase15#21   = "N";
             nSwMalo = 2;
         |SINO;
             #dspase15#21 = "S";
         |FINSI;

         |ERROR10;
         |ACABA;
     |FINSI;
|FPRC;

|DEFBUCLE dspase15Puedo;
     #espejo1@#3003;
     ;
     #dspase15#3, "            ", 000;
     #dspase15#3, "zzzzzzzzzzzz", 999;
     ;
     NULL, LeePorCodigos;
|FIN;

|PROCESO ChequeaCodigo;
     |SI #dspase15#3 = 0;  |ACABA;  |FINSI;

     |DBASE aPath;  |QBT aPath;
     aDef = aPath + "def/dspase15.mas";
     |CARGA_DEF aDef, espejo1@;
     |SI FSalida ! 0;
         aAlfa = "     Error en cargar el Def dspase15.mas";
         |MENAV aAlfa;
         |ACABA;
     |FINSI;

     |DBASE aPath;  |QBT aPath;
     aDef = aPath + "def/dspase16.mas";
     |CARGA_DEF aDef, espejo2@;
     |SI FSalida ! 0;
         |DESCARGA_DEF #espejo1@;
         aAlfa = "     Error en cargar el Def dspase15.mas";
         |MENAV aAlfa;
         |ACABA;
     |FINSI;

     nSwMalo = 0;
     |BUCLE dspase15Puedo;

     |SI nSwMalo = 2;
         #dspase15#3 = 0;  |PINTA #dspase15#3;
         |ERROR;
     |FINSI;

     |SI nSwMalo = 1;
         |MENAV "     Codigo Repetido en otro NIF";
         #dspase15#3 = 0;  |PINTA #dspase15#3;
         |ERROR;
     |FINSI;

     |DESCARGA_DEF #espejo2@;
     |DESCARGA_DEF #espejo1@;
|FPRC;

|RUTINA ClaveBaja1;
     #dspase16#0 = eaVarDni;
     #dspase16#1 = nRegistro;
     #dspase16#2 = 0;
|FRUT;

|RUTINA ClaveAlta1;
     #dspase16#0 = eaVarDni;
     #dspase16#1 = nRegistro;
     #dspase16#2 = 99;
|FRUT;

|PROCESO BuscaFacges;
     |SI enSwUno ! 1;
         #dspase15#13 = 0;
         #dspase15#14 = 0;
     |SINO;
         #dspase15#13 = nCampo13;
         #dspase15#14 = nCampo14;
     |FINSI;

     aAlfa1 = #dspase16#2; aAlfa1 = ("00" + aAlfa1) % -102;    eaEFacges = aAlfa1;
     aAlfa2 = #dspase16#3; aAlfa2 = ("00000" + aAlfa2) % -105; eaCFacges = aAlfa2;

     |PRINT;

     enSwUno = enSwUno + 1;
     eaEFacges = "";
     eaCFacges = "";
|FPRC;

|DEFBUCLE BuscaFacges;
     #dspase16#1;
     ;
     #dspase15#0, #dspase15#1, 00;
     #dspase15#0, #dspase15#1, 99;
     ;
     NULL, BuscaFacges;
|FIN;

|PROCESO ImprimeUno;
     enSwUno = 0;
     eaEFacges = ""; nCampo13 = #dspase15#13;
     eaCFacges = ""; nCampo14 = #dspase15#14;
     |BUCLE BuscaFacges;
     #dspase15#13 = nCampo13; #dspase15#14 = nCampo14;
     |SI enSwUno < 2;
         |PRINT;
     |FINSI;
     nSwPrint = 1;
|FPRC;

|PROCESO LeeRepetidos;
     |SI #dspase15#21 = "S";  |ACABA; |FINSI;
     |SI #dspase15#22 = "S";  |ACABA; |FINSI;

     |SI nSwRepe = 0;
        aAlfa   = eaVarDni;  |HAZ SacaNumero;   nNume1 = aCadena;
        aAlfa   = #dspase15#0;  |HAZ SacaNumero;   nNume2 = aCadena;
        |SI nNume1 ! nNume2;
            nSwRepe = 1;
            |ERROR10;
        |FINSI;
        |ACABA;
     |FINSI;

     eaError = "Cod.Repetido distinto NIF";
     |HAZ ImprimeUno; || ... |PRINT;
     nSwIncidencia = 1;
|FPRC;

|DEFBUCLE dspase15Inci2;
     #dspase15#3;
     ;
     nCodigo, "            ", 000;
     nCodigo, "zzzzzzzzzzzz", 999;
     ;
     NULL, LeeRepetidos;
|FIN;

|PROCESO LeeIncidencia;
     |SI #espejo1@#22 = "S";     |ACABA;  |FINSI;

     |SI #espejo1@#3 = 0;
         #dspase15#0 = #espejo1@#0;
         #dspase15#1 = #espejo1@#1;
         |LEE 040#dspase15.=;
         |SI FSalida ! 0;  |DDEFECTO #dspase15;  |FINSI;

         eaError = "Codigo sin Introducir    ";
         |HAZ ImprimeUno; || ... |PRINT;
         nSwIncidencia = 1;
         |ACABA;
     |FINSI;

     |SI #espejo1@#21 = "S";     |ACABA;  |FINSI;

     |SI nCodigo = #espejo1@#3;
         |ACABA;
     |FINSI;

     nSwRepe = 0;
     eaVarDni    = #espejo1@#0;
     nCodigo = #espejo1@#3;
     |BUCLE dspase15Inci2;

     |SI nSwRepe = 1;
         eaVarDni = #espejo1@#0;
         |BUCLE dspase15Inci2;
     |FINSI;
|FPRC;

|DEFBUCLE dspase15Inci1;
     #espejo1@#3003;
     ;
     00000, "            ", 000;
     99999, "zzzzzzzzzzzz", 999;
     ;
     NULL, LeeIncidencia;
|FIN;

|PROCESO Incidencias;
     |DBASE aPath;  |QBT aPath;
     aDef = aPath + "def/dspase15.mas";
     |CARGA_DEF aDef, espejo1@;
     |SI FSalida ! 0;
         aAlfa = "     Error en cargar el Def dspase15.mas";
         |MENAV aAlfa;
         |ACABA;
     |FINSI;

     |IMPRE 0;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |INFOR "dspase15";
     |SI FSalida ! 0;  |FINIMP;  |ACABA;  |FINSI;

     |ESTADO_CONTROL nBoton1, "HIDE";
     |ESTADO_CONTROL nBoton2, "HIDE";
     |ESTADO_CONTROL nBoton3, "HIDE";
     |ESTADO_CONTROL nBoton4, "HIDE";
     |ESTADO_CONTROL nBoton5, "HIDE";
     |ESTADO_CONTROL nBoton6, "HIDE";

     |PULSATECLA;

     nSwIncidencia = 0;
     |BUCLE dspase15Inci1;

     |DESCARGA_DEF #espejo1@;

     |LEE 101#dspase15.p;
     #dspase15#16 = "N";
     |SI nSwIncidencia = 0;
         |MENAV "      Fichero preparado para hacer la Unificacion.";
         #dspase15#16 = "S";

         |ESTADO_CONTROL nBoton3, "ENABLE";
     |FINSI;
     |GRABA 020#dspase15.a;
     |LIBERA #dspase15;

     |SI nSwIncidencia = 1; |PIEINF;  |FINSI;

     |FININF;
     |FINIMP;

     |ESTADO_CONTROL nBoton1, "SHOW";
     |ESTADO_CONTROL nBoton2, "SHOW";
     |ESTADO_CONTROL nBoton3, "SHOW";
     |ESTADO_CONTROL nBoton4, "SHOW";
     |ESTADO_CONTROL nBoton5, "SHOW";
     |ESTADO_CONTROL nBoton6, "SHOW";

     |LEE 040#dspase15.p;
     |PONCONTROL 23, "SI";
     |ERROR;
|FPRC;

|PROCESO PonCodigo;
     |SI #dspase15#22 = "S";
         |MENAV "     Registro Borrado ";
         |ACABA;
     |FINSI;

     |LEE 101#dspase15.=;

     |PUSHV 1601 2380;
     |BLANCO 1601 2380;

     |ATRI I;
     |PINTA 1604, "Como estamos trabajando en diagram 9-10, el codigo no lo puedo refrescar";
     |PINTA 1704, "en el lineal.";
     |PINTA 1804, "Para ello pulsar en el identificador del cualquier campo del lineal";
     |ATRI i;

     E_inf   = 0;
     E_sup   = 99999;
     nCodigo = #dspase15#3;
     |PINTA 2115, "Introduzca el codigo para la integrada: ";
     nCodigo = 2155 ? 1;
     #dspase15#3    = nCodigo;
     |HAZ ChequeaCodigo;

     |SI nSwMalo = 0;
         |GRABA 020#dspase15.a;
     |FINSI;
     |LIBERA #dspase15;

     |POPV;
|FPRC;

|PROCESO PonBorrado;
     |SI #dspase15#22 = "N";
         |CONFI "0000NEstas usted seguro de DESACTIVAR el registro para que NO pase a la integrada";
     |SINO;
         |CONFI "0000NEstas usted seguro de ACTIVAR de nuevo el registro";
     |FINSI;

     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |LEE 101#dspase15.=;

     |SI #dspase15#22 = "S";
         #dspase15#22 = "N";
     |SINO;
         #dspase15#22 = "S";
     |FINSI;
     |GRABA 020#dspase15.a;
     |LIBERA #dspase15;
|FPRC;

|PROCESO Imprime;
     |PARA nCampo = 0;  |SI nCampo [ 37;  |HACIENDO nCampo = nCampo + 1;
           #dspase15#nCampo# = #espejo1@#nCampo#;
     |SIGUE;
     enSwUno = 0;
     eaEFacges = ""; nCampo13 = #dspase15#13;
     eaCFacges = ""; nCampo14 = #dspase15#14;
     |BUCLE BuscaFacges;
     #dspase15#13 = nCampo13; #dspase15#14 = nCampo14;
     |SI enSwUno < 2;
         |PRINT;
     |FINSI;
     nSwPrint = 1;
|FPRC;

|DEFBUCLE Impresion1;
     #espejo1@#1002;
     22;
     "            ", 000, aDBorrado;
     "zzzzzzzzzzzz", 999, aHBorrado;
     ;
     NULL, Imprime;
|FIN;

|DEFBUCLE Impresion2;
     #espejo1@#2003;
     22;
     aDNombre, "            ", 000, aDBorrado;
     aHNombre, "zzzzzzzzzzzz", 999, aHBorrado;
     ;
     NULL, Imprime;
|FIN;

|DEFBUCLE Impresion3;
     #espejo1@#3003;
     22;
     00000, "            ", 000, aDBorrado;
     99999, "zzzzzzzzzzzz", 999, aHBorrado;
     ;
     NULL, Imprime;
|FIN;

|PROCESO Impresion;
     |PUSHV 0501 2380;
     |DDEFECTO #dspase19;
     |PINPA #0#dspase19;
     |PINDA #0#dspase19;
     |ENDATOS #1#dspase19;
     |SI FSalida ! 0;
         |POPV;
         |ACABA;
     |FINSI;
     |POPV;

     |DBASE aPath;  |QBT aPath;
     aDef = aPath + "def/dspase15.mas";
     |CARGA_DEF aDef, espejo1@;
     |SI FSalida ! 0;
         aAlfa = "     Error en cargar el Def dspase15.mas";
         |MENAV aAlfa;
         |ACABA;
     |FINSI;

     |IMPRE 0;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |INFOR "dspase19";
     |SI FSalida ! 0;  |FINIMP;  |ACABA;  |FINSI;

     |PULSATECLA;

     |ESTADO_CONTROL nBoton1, "HIDE";
     |ESTADO_CONTROL nBoton2, "HIDE";
     |ESTADO_CONTROL nBoton3, "HIDE";
     |ESTADO_CONTROL nBoton4, "HIDE";
     |ESTADO_CONTROL nBoton5, "HIDE";
     |ESTADO_CONTROL nBoton6, "HIDE";

     aDBorrado = " ";
     aHBorrado = "z";
     |SI #dspase19#1 = "A";  aDBorrado = "N";  aHBorrado = "N";  |FINSI;
     |SI #dspase19#1 = "B";  aDBorrado = "S";  aHBorrado = "S";  |FINSI;

     |SALVA_DATOS #dspase15;
     nSwPrint = 0;
     |SI #dspase19#0 = 1;  |BUCLE Impresion1;  |FINSI;
     |SI #dspase19#0 = 2;  |BUCLE Impresion2;  |FINSI;
     |SI #dspase19#0 = 3;  |BUCLE Impresion3;  |FINSI;
     |REPON_DATOS #dspase15;

     |SI nSwPrint = 1;
         |PIEINF;
     |FINSI;

     |FININF;
     |FINIMP;

     |DESCARGA_DEF #espejo1@;

     |ESTADO_CONTROL nBoton1, "SHOW";
     |ESTADO_CONTROL nBoton2, "SHOW";
     |ESTADO_CONTROL nBoton3, "SHOW";
     |ESTADO_CONTROL nBoton4, "SHOW";
     |ESTADO_CONTROL nBoton5, "SHOW";
     |ESTADO_CONTROL nBoton6, "SHOW";
|FPRC;

|PROCESO BuscaNuevo;
     |QBF eaVarDni;

     #dspase15#0 = eaVarDni;
     #dspase15#1 = 999;
     |LEE 040#dspase15.];
     |SI FSalida = 0;
         |LEE 040#dspase15.a;
     |SINO;
         |LEE 040#dspase15.u;
     |FINSI;

     nRegistro = 0;
     |SI eaVarDni = "";
         nRegistro = #dspase15#1 + 1;
     |SINO;
         aNif1     = #dspase15#0; |QBF aNif1;
         |SI FSalida = 0;  |Y aNif1 = eaVarDni;
             nRegistro = #dspase15#1 + 1;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO BuscaRegistro;
     |QBF eaVarDni;
     |SI eaVarDni = "";
         |HAZ BuscaNuevo;
         |ACABA;
     |FINSI;

     nRegis    = 0;
     nRegistro = -1;
     |PARA;  |SI;  |HACIENDO;
           #dspase15#0 = eaVarDni;
           #dspase15#1 = nRegis;
           |LEE 040#dspase15.=;
           |SI FSalida ! 0;  |SAL;  |FINSI;

           |SI #dspase15#nCasilla# = nCodigo;  nRegistro = nRegis;  |SAL;  |FINSI;

           |SI #dspase15#nCasilla# = 0;  |Y nRegis = 0;
               nRegistro = nRegis;
               |SI #dspase15#4 = 0;  |SAL;  |FINSI;
           |SINO;
               |SI nCodigo = #dspase15#4;  nRegistro = nRegis;  |SAL;  |FINSI;
           |FINSI;

           nRegis = nRegis + 1;
     |SIGUE;

     |SI nRegistro = -1;  nRegistro = nRegis;  |FINSI;
|FPRC;

|PROCESO PasaBasica;
     eaVarDni = #agifigen#13;  |HAZ CalculoDNI;

     #dspase15#0 = eaVarDni;
     #dspase15#1 = 0;
     |LEE 040#dspase15.=;
     |SI FSalida ! 0;
         nRegistro = 0;
     |SINO;
         |SI #dspase15#4 = 0;
             nRegistro = 0;
         |SINO;
             |HAZ BuscaNuevo;
         |FINSI;
     |FINSI;

     #dspase15#0 = eaVarDni;
     #dspase15#1 = nRegistro;
     |LEE 101#dspase15.=;
     |SI FSalida ! 0;
         |DDEFECTO #dspase15;
         #dspase15#0 = eaVarDni;
         #dspase15#1 = nRegistro;
         |GRABA 020#dspase15.b;
     |FINSI;

     aAlfa = #dspase15#2;  |QBF aAlfa;
     |SI aAlfa = "";
         aAlfa = #agifigen#1;  |QBF aAlfa;
         #dspase15#2  = #agifigen#1;
         |SI aAlfa = "";  #dspase15#2  = #agifigen#2;  |FINSI;
     |FINSI;

     #dspase15#4  = #agifigen#0;
     #dspase15#18 = #agifigen#0;
     |GRABA 020#dspase15.a;
     |LIBERA #dspase15;
|FPRC;

|DEFBUCLE agifigen;
     #agifigen#1;
     ;
     00001;
     99999;
     ;
     NULL, PasaBasica;
|FIN;

|PROCESO PasaLaboral;
     eaVarDni = #labempre#10 % 112;    |HAZ CalculoDNI;

     #dspase15#0 = eaVarDni;
     #dspase15#1 = 0;
     |LEE 040#dspase15.=;
     |SI FSalida ! 0;
         nRegistro = 0;
     |SINO;
         nCasilla = 5;
         nCodigo  = #labempre#0;
         |HAZ BuscaRegistro;
     |FINSI;

     #dspase15#0 = eaVarDni;
     #dspase15#1 = nRegistro;
     |LEE 101#dspase15.=;
     |SI FSalida ! 0;
         |DDEFECTO #dspase15;
         #dspase15#0 = eaVarDni;
         #dspase15#1 = nRegistro;
         |GRABA 020#dspase15.b;
     |FINSI;

     aAlfa = #dspase15#2;  |QBF aAlfa;
     |SI aAlfa = "";
         #dspase15#2 = #labempre#2;
     |FINSI;

     #dspase15#5  = #labempre#0;
     #dspase15#19 = #labempre#0;
     |GRABA 020#dspase15.a;
     |LIBERA #dspase15;
|FPRC;

|DEFBUCLE labempre;
     #labempre#1;
     ;
     00001;
     99999;
     ;
     NULL, PasaLaboral;
|FIN;

|PROCESO PasaContabilidad;
     |SI nEmpresa ! #canempre#2;

         nEmpresa = #canempre#2;

         eaVarDni = #canempre#8 % 112;   |HAZ CalculoDNI;

         #dspase15#0 = eaVarDni;
         #dspase15#1 = 0;
         |LEE 040#dspase15.=;
         |SI FSalida ! 0;
             nRegistro = 0;
         |SINO;
             nCasilla = 6;
             nCodigo  = #canempre#2;
             |HAZ BuscaRegistro;
         |FINSI;

         #dspase15#0 = eaVarDni;
         #dspase15#1 = nRegistro;
         |LEE 101#dspase15.=;
         |SI FSalida ! 0;
             |DDEFECTO #dspase15;
             #dspase15#0 = eaVarDni;
             #dspase15#1 = nRegistro;
             |GRABA 020#dspase15.b;
         |FINSI;

         aAlfa = #dspase15#2;  |QBF aAlfa;
         |SI aAlfa = "";
             aAlfa = #canempre#1;  |QBF aAlfa;
             #dspase15#2  = #canempre#1;
             |SI aAlfa = "";  #dspase15#2  = #canempre#4;  |FINSI;
         |FINSI;

         #dspase15#6  = #canempre#2;
         #dspase15#20 = #canempre#2;
         |GRABA 020#dspase15.a;
         |LIBERA #dspase15;
   |FINSI;
|FPRC;

|DEFBUCLE canempre;
     #canempre#1;
     ;
     00001, 0;
     99999, 9;
     ;
     NULL, PasaContabilidad;
|FIN;

|PROCESO PasaSociedad;
     |SI nEmpresa = #maacceso#0;  |ACABA;  |FINSI;

     nEmpresa = #maacceso#0;

     eaVarDni = #maacceso#3;   |HAZ CalculoDNI;

     #dspase15#0 = eaVarDni;
     #dspase15#1 = 0;
     |LEE 040#dspase15.=;
     |SI FSalida ! 0;
         nRegistro = 0;
     |SINO;
         nCasilla = 7;
         nCodigo  = #maacceso#0;
         |HAZ BuscaRegistro;
     |FINSI;

     #dspase15#0 = eaVarDni;
     #dspase15#1 = nRegistro;
     |LEE 101#dspase15.=;
     |SI FSalida ! 0;
         |DDEFECTO #dspase15;
         #dspase15#0 = eaVarDni;
         #dspase15#1 = nRegistro;
         |GRABA 020#dspase15.b;
     |FINSI;

     aAlfa = #dspase15#2;  |QBF aAlfa;
     |SI aAlfa = "";
         #dspase15#2 = #maacceso#2;
     |FINSI;

     #dspase15#7 = #maacceso#0;
     |GRABA 020#dspase15.a;
     |LIBERA #dspase15;
|FPRC;

|DEFBUCLE maacceso;
     #maacceso#4;
     ;
     00001, 9999;
     99999, 0000;
     ;
     NULL, PasaSociedad;
|FIN;

|PROCESO PasaRenta;
     eaVarDni = #espejo1@#2;  |HAZ CalculoDNI;

     #dspase15#0 = eaVarDni;
     #dspase15#1 = 0;
     |LEE 040#dspase15.=;
     |SI FSalida ! 0;
         nRegistro = 0;
     |SINO;
         nCodigo  = #espejo1@#0;
         |HAZ BuscaRegistro;
     |FINSI;

     #dspase15#0 = eaVarDni;
     #dspase15#1 = nRegistro;
     |LEE 101#dspase15.=;
     |SI FSalida ! 0;
         |DDEFECTO #dspase15;
         #dspase15#0 = eaVarDni;
         #dspase15#1 = nRegistro;
         |GRABA 020#dspase15.b;
     |FINSI;

     aAlfa = #dspase15#2;  |QBF aAlfa;
     |SI aAlfa = "";  #dspase15#2 = #espejo1@#1;  |FINSI;

     #dspase15#nCasilla# = #espejo1@#0;
     |GRABA 020#dspase15.a;
     |LIBERA #dspase15;
|FPRC;

|DEFBUCLE reacceso;
     #espejo1@#1001;
     ;
     00001;
     99999;
     ;
     NULL, PasaRenta;
|FIN;

|PROCESO Renta;
     aDef = eaPathRen2018 + "def/reacceso.mas";
     |CARGA_DEF aDef, espejo1@;
     |SI FSalida = 0;
          nCasilla = 40;
          |BUCLE reacceso;
          |DESCARGA_DEF #espejo1@;
     |FINSI;

     aDef = eaPathRen2017 + "def/reacceso.mas";
     |CARGA_DEF aDef, espejo1@;
     |SI FSalida = 0;
          nCasilla = 39;
          |BUCLE reacceso;
          |DESCARGA_DEF #espejo1@;
     |FINSI;

     aDef = eaPathRen2016 + "def/reacceso.mas";
     |CARGA_DEF aDef, espejo1@;
     |SI FSalida = 0;
          nCasilla = 38;
          |BUCLE reacceso;
          |DESCARGA_DEF #espejo1@;
     |FINSI;

     aDef = eaPathRen2015 + "def/reacceso.mas";
     |CARGA_DEF aDef, espejo1@;
     |SI FSalida = 0;
          nCasilla = 37;
          |BUCLE reacceso;
          |DESCARGA_DEF #espejo1@;
     |FINSI;

     aDef = eaPathRen2014 + "def/reacceso.mas";
     |CARGA_DEF aDef, espejo1@;
     |SI FSalida = 0;
          nCasilla = 36;
          |BUCLE reacceso;
          |DESCARGA_DEF #espejo1@;
     |FINSI;

     aDef = eaPathRen2013 + "def/reacceso.mas";
     |CARGA_DEF aDef, espejo1@;
     |SI FSalida = 0;
          nCasilla = 35;
          |BUCLE reacceso;
          |DESCARGA_DEF #espejo1@;
     |FINSI;

     aDef = eaPathRen2012 + "def/reacceso.mas";
     |CARGA_DEF aDef, espejo1@;
     |SI FSalida = 0;
          nCasilla = 34;
          |BUCLE reacceso;
          |DESCARGA_DEF #espejo1@;
     |FINSI;

     aDef = eaPathRen2011 + "def/reacceso.mas";
     |CARGA_DEF aDef, espejo1@;
     |SI FSalida = 0;
          nCasilla = 33;
          |BUCLE reacceso;
          |DESCARGA_DEF #espejo1@;
     |FINSI;

     aDef = eaPathRen2010 + "def/reacceso.mas";
     |CARGA_DEF aDef, espejo1@;
     |SI FSalida = 0;
          nCasilla = 32;
          |BUCLE reacceso;
          |DESCARGA_DEF #espejo1@;
     |FINSI;

     aDef = eaPathRen2009 + "def/reacceso.mas";
     |CARGA_DEF aDef, espejo1@;
     |SI FSalida = 0;
          nCasilla = 31;
          |BUCLE reacceso;
          |DESCARGA_DEF #espejo1@;
     |FINSI;

     aDef = eaPathRen2008 + "def/reacceso.mas";
     |CARGA_DEF aDef, espejo1@;
     |SI FSalida = 0;
          nCasilla = 30;
          |BUCLE reacceso;
          |DESCARGA_DEF #espejo1@;
     |FINSI;

     aDef = eaPathRen2007 + "def/reacceso.mas";
     |CARGA_DEF aDef, espejo1@;
     |SI FSalida = 0;
          nCasilla = 29;
          |BUCLE reacceso;
          |DESCARGA_DEF #espejo1@;
     |FINSI;

     aDef = eaPathRen2006 + "def/reacceso.mas";
     |CARGA_DEF aDef, espejo1@;
     |SI FSalida = 0;
          nCasilla = 28;
          |BUCLE reacceso;
          |DESCARGA_DEF #espejo1@;
     |FINSI;

     aDef = eaPathRen2005 + "def/reacceso.mas";
     |CARGA_DEF aDef, espejo1@;
     |SI FSalida = 0;
         nCasilla = 27;
         |BUCLE reacceso;
         |DESCARGA_DEF #espejo1@;
     |FINSI;

     aDef = eaPathRen2004 + "def/reacceso.mas";
     |CARGA_DEF aDef, espejo1@;
     |SI FSalida = 0;
         nCasilla = 26;
         |BUCLE reacceso;
         |DESCARGA_DEF #espejo1@;
     |FINSI;

     aDef = eaPathRen2003 + "def/reacceso.mas";
     |CARGA_DEF aDef, espejo1@;
     |SI FSalida = 0;
         nCasilla = 25;
         |BUCLE reacceso;
         |DESCARGA_DEF #espejo1@;
     |FINSI;

     aDef = eaPathRen2002 + "def/reacceso.mas";
     |CARGA_DEF aDef, espejo1@;
     |SI FSalida = 0;
         nCasilla = 24;
         |BUCLE reacceso;
         |DESCARGA_DEF #espejo1@;
     |FINSI;

     aDef = eaPathRen2001 + "def/reacceso.mas";
     |CARGA_DEF aDef, espejo1@;
     |SI FSalida = 0;
         nCasilla = 23;
         |BUCLE reacceso;
         |DESCARGA_DEF #espejo1@;
     |FINSI;

     aDef = eaPathRen2000 + "def/reacceso.mas";
     |CARGA_DEF aDef, espejo1@;
     |SI FSalida = 0;
         nCasilla = 8;
         |BUCLE reacceso;
         |DESCARGA_DEF #espejo1@;
     |FINSI;

     aDef = eaPathRen1999 + "def/reacceso.mas";
     |CARGA_DEF aDef, espejo1@;
     |SI FSalida = 0;
         nCasilla = 9;
         |BUCLE reacceso;
         |DESCARGA_DEF #espejo1@;
     |FINSI;

     aDef = eaPathRen1998 + "def/reacceso.mas";
     |CARGA_DEF aDef, espejo1@;
     |SI FSalida = 0;
         nCasilla = 10;
         |BUCLE reacceso;
         |DESCARGA_DEF #espejo1@;
     |FINSI;

     aDef = eaPathRen1997 + "def/reacceso.mas";
     |CARGA_DEF aDef, espejo1@;
     |SI FSalida = 0;
         nCasilla = 11;
         |BUCLE reacceso;
         |DESCARGA_DEF #espejo1@;
     |FINSI;

     aDef = eaPathRen1996 + "def/reacceso.mas";
     |CARGA_DEF aDef, espejo1@;
     |SI FSalida = 0;
         nCasilla = 12;
         |BUCLE reacceso;
         |DESCARGA_DEF #espejo1@;
     |FINSI;

     aDef = eaPathRen1995 + "def/reacceso.mas";
     |CARGA_DEF aDef, espejo1@;
     |SI FSalida = 0;
         nCasilla = 13;
         |BUCLE reacceso;
         |DESCARGA_DEF #espejo1@;
     |FINSI;

     aDef = eaPathRen1994 + "def/reacceso.mas";
     |CARGA_DEF aDef, espejo1@;
     |SI FSalida = 0;
         nCasilla = 14;
         |BUCLE reacceso;
         |DESCARGA_DEF #espejo1@;
     |FINSI;
|FPRC;

|PROCESO BuscaRegistroFac;
     |QBF eaVarDni;
     |SI eaVarDni = "";
         |HAZ BuscaNuevo;
         |ACABA;
     |FINSI;

     nRegis    = 0;
     nRegistro = -1;
     |PARA;  |SI;  |HACIENDO;
           #dspase15#0 = eaVarDni;
           #dspase15#1 = nRegis;
           |LEE 040#dspase15.=;
           |SI FSalida ! 0;  |DDEFECTO #dspase15;  |FINSI;

           #dspase16#0 = eaVarDni;
           #dspase16#1 = nRegis;
           #dspase16#2 = #facemp#0;
           |LEE 040#dspase16.=;
           |SI FSalida ! 0;  |SAL;  |FINSI;

           |SI #dspase16#3 = #asclient#0;  nRegistro = nRegis;  |SAL;  |FINSI;

           |SI #dspase16#3 = 0;  |Y nRegis = 0;
               nRegistro = nRegis;
               |SI #dspase15#4 = 0;  |SAL;  |FINSI;
           |SINO;
               |SI #asclient#0 = #dspase15#4;  nRegistro = nRegis;  |SAL;  |FINSI;
           |FINSI;

           nRegis = nRegis + 1;
     |SIGUE;

     |SI nRegistro = -1;  nRegistro = nRegis;  |FINSI;
|FPRC;

|PROCESO PasaFacturar;
     eaVarDni = #asclient#8;   |HAZ CalculoDNI;

     #dspase16#0 = eaVarDni;
     #dspase16#1 = 0;
     #dspase16#2 = #facemp#0;
     |LEE 040#dspase16.=;
     |SI FSalida ! 0;
         nRegistro = 0;
     |SINO;
         |HAZ BuscaRegistroFac;
     |FINSI;

     #dspase16#0 = eaVarDni;
     #dspase16#1 = nRegistro;
     #dspase16#2 = #facemp#0;
     |LEE 101#dspase16.=;
     |SI FSalida ! 0;
         |DDEFECTO #dspase16;
         #dspase16#0 = eaVarDni;
         #dspase16#1 = nRegistro;
         #dspase16#2 = #facemp#0;
         |GRABA 020#dspase16.b;
     |FINSI;

     #dspase16#3 = #asclient#0;
     |GRABA 020#dspase16.a;
     |LIBERA #dspase16;

     #dspase15#0 = #dspase16#0;
     #dspase15#1 = #dspase16#1;
     |LEE 101#dspase15.=;
     |SI FSalida ! 0;
         |DDEFECTO #dspase15;
         #dspase15#0  = #dspase16#0;
         #dspase15#1  = #dspase16#1;
         aAlfa = #asclient#1;  |QBF aAlfa;
         #dspase15#2  = #asclient#1;
         |SI aAlfa = "";  #dspase15#2  = #asclient#2;  |FINSI;
         |GRABA 020#dspase15.n;
     |FINSI;
     |LIBERA #dspase15;
|FPRC;

|DEFBUCLE asclient;
     #asclient#1;
     ;
     00001;
     99999;
     ;
     NULL, PasaFacturar;
|FIN;

|PROCESO ClienteFacturacion;
     aFich  = eaPathFacturar + "fich/" + (("00" + #facemp#0) % -102) + "/";  |QBT aFich;

     |PATH_DAT #asclient#aFich#;

     |BUCLE asclient;
|FPRC;

|DEFBUCLE facemp;
     #facemp#2;
     ;
     "S", 01;
     "S", 99;
     ;
     NULL, ClienteFacturacion;
|FIN;

|PROCESO Facturacion;
     |ABRE #dspase16;
     |BUCLE facemp;
     |CIERRA #dspase16;
|FPRC;

|PROCESO Chequeo16;
     nCFac = #dspase16#3;
     |SI nCarga = 0;
         |SI nCodigo = 0;  nCodigo = #dspase16#3;  |FINSI;
         |ACABA;
     |FINSI;

     |SI #dspase16#3 ! 0;  |Y nCodigo ! #dspase16#3;  nSwMalo = 1;  |FINSI;
|FPRC;

|DEFBUCLE dspase16Chequeo;
     #dspase16#1;
     ;
     #dspase15#0, #dspase15#1, 00;
     #dspase15#0, #dspase15#1, 99;
     ;
     NULL, Chequeo16;
|FIN;

|PROCESO BuscaOrden;
     |PARA nCampo = 1;  |SI nCampo [ 7;  |HACIENDO nCampo = nCampo + 1;
           |SI #dspase18#nCampo# = nOrden;
               |SI nCampo = 1;  |Y #dspase15#4  ! 0;  nCodigo = #dspase15#4;   |SAL;  |FINSI;
               |SI nCampo = 2;  |Y #dspase15#17 ! 0;  nCodigo = #dspase15#17;  |SAL;  |FINSI;
               |SI nCampo = 3;  |Y #dspase15#5  ! 0;  nCodigo = #dspase15#5;   |SAL;  |FINSI;
               |SI nCampo = 4;  |Y #dspase15#6  ! 0;  nCodigo = #dspase15#6;   |SAL;  |FINSI;
               |SI nCampo = 5;  |Y #dspase15#7  ! 0;  nCodigo = #dspase15#7;   |SAL;  |FINSI;
               |SI nCampo = 7;  |Y nCFac ! 0;  nCodigo = nCFac;  |SAL;  |FINSI;
               |SI nCampo = 6;
                   |SI #dspase15#40 ! 0;  nCodigo = #dspase15#40;  |SAL;  |FINSI;  || 2018
                   |SI #dspase15#39 ! 0;  nCodigo = #dspase15#39;  |SAL;  |FINSI;  || 2017
                   |SI #dspase15#38 ! 0;  nCodigo = #dspase15#38;  |SAL;  |FINSI;  || 2016
                   |SI #dspase15#37 ! 0;  nCodigo = #dspase15#37;  |SAL;  |FINSI;  || 2015
                   |SI #dspase15#36 ! 0;  nCodigo = #dspase15#36;  |SAL;  |FINSI;  || 2014
                   |SI #dspase15#35 ! 0;  nCodigo = #dspase15#35;  |SAL;  |FINSI;  || 2013
                   |SI #dspase15#34 ! 0;  nCodigo = #dspase15#34;  |SAL;  |FINSI;
                   |SI #dspase15#33 ! 0;  nCodigo = #dspase15#33;  |SAL;  |FINSI;
                   |SI #dspase15#32 ! 0;  nCodigo = #dspase15#32;  |SAL;  |FINSI;
                   |SI #dspase15#31 ! 0;  nCodigo = #dspase15#31;  |SAL;  |FINSI;
                   |SI #dspase15#30 ! 0;  nCodigo = #dspase15#30;  |SAL;  |FINSI;
                   |SI #dspase15#29 ! 0;  nCodigo = #dspase15#29;  |SAL;  |FINSI;
                   |SI #dspase15#28 ! 0;  nCodigo = #dspase15#28;  |SAL;  |FINSI;
                   |SI #dspase15#27 ! 0;  nCodigo = #dspase15#27;  |SAL;  |FINSI;
                   |SI #dspase15#26 ! 0;  nCodigo = #dspase15#26;  |SAL;  |FINSI;
                   |SI #dspase15#25 ! 0;  nCodigo = #dspase15#25;  |SAL;  |FINSI;
                   |SI #dspase15#24 ! 0;  nCodigo = #dspase15#24;  |SAL;  |FINSI;
                   |SI #dspase15#23 ! 0;  nCodigo = #dspase15#23;  |SAL;  |FINSI;
                   |SI #dspase15#8  ! 0;  nCodigo = #dspase15#8;   |SAL;  |FINSI;
                   |SI #dspase15#9  ! 0;  nCodigo = #dspase15#9;   |SAL;  |FINSI;
                   |SI #dspase15#10 ! 0;  nCodigo = #dspase15#10;  |SAL;  |FINSI;
                   |SI #dspase15#11 ! 0;  nCodigo = #dspase15#11;  |SAL;  |FINSI;
                   |SI #dspase15#12 ! 0;  nCodigo = #dspase15#12;  |SAL;  |FINSI;
                   |SI #dspase15#13 ! 0;  nCodigo = #dspase15#13;  |SAL;  |FINSI;
                   |SI #dspase15#14 ! 0;  nCodigo = #dspase15#14;  |SAL;  |FINSI;
               |FINSI;
           |FINSI;
    |SIGUE;
|FPRC;

|PROCESO Chequeo15;
     |SI #dspase18#0 = "S";
         nCodigo = nCodigo + 1;
     |SINO;
         nSwMalo = 0;
         nCodigo = #dspase15#4;
         |SI nCodigo = 0;  nCodigo = #dspase15#5;   |FINSI;
         |SI nCodigo = 0;  nCodigo = #dspase15#6;   |FINSI;
         |SI nCodigo = 0;  nCodigo = #dspase15#7;   |FINSI;
         |SI nCodigo = 0;  nCodigo = #dspase15#40;  |FINSI;   || 2018
         |SI nCodigo = 0;  nCodigo = #dspase15#39;  |FINSI;   || 2017
         |SI nCodigo = 0;  nCodigo = #dspase15#38;  |FINSI;   || 2016
         |SI nCodigo = 0;  nCodigo = #dspase15#37;  |FINSI;   || 2015
         |SI nCodigo = 0;  nCodigo = #dspase15#36;  |FINSI;   || 2014
         |SI nCodigo = 0;  nCodigo = #dspase15#35;  |FINSI;   || 2013
         |SI nCodigo = 0;  nCodigo = #dspase15#34;  |FINSI;
         |SI nCodigo = 0;  nCodigo = #dspase15#33;  |FINSI;
         |SI nCodigo = 0;  nCodigo = #dspase15#32;  |FINSI;
         |SI nCodigo = 0;  nCodigo = #dspase15#31;  |FINSI;
         |SI nCodigo = 0;  nCodigo = #dspase15#30;  |FINSI;
         |SI nCodigo = 0;  nCodigo = #dspase15#29;  |FINSI;
         |SI nCodigo = 0;  nCodigo = #dspase15#28;  |FINSI;
         |SI nCodigo = 0;  nCodigo = #dspase15#27;  |FINSI;
         |SI nCodigo = 0;  nCodigo = #dspase15#26;  |FINSI;
         |SI nCodigo = 0;  nCodigo = #dspase15#25;  |FINSI;
         |SI nCodigo = 0;  nCodigo = #dspase15#24;  |FINSI;
         |SI nCodigo = 0;  nCodigo = #dspase15#23;  |FINSI;
         |SI nCodigo = 0;  nCodigo = #dspase15#8;   |FINSI;
         |SI nCodigo = 0;  nCodigo = #dspase15#9;   |FINSI;
         |SI nCodigo = 0;  nCodigo = #dspase15#10;  |FINSI;
         |SI nCodigo = 0;  nCodigo = #dspase15#11;  |FINSI;
         |SI nCodigo = 0;  nCodigo = #dspase15#12;  |FINSI;
         |SI nCodigo = 0;  nCodigo = #dspase15#13;  |FINSI;
         |SI nCodigo = 0;  nCodigo = #dspase15#14;  |FINSI;
         |SI nCodigo = 0;  nCodigo = #dspase15#17;  |FINSI;

         nCarga = 0;  |BUCLE dspase16Chequeo;

         |SI #dspase15#5  ! 0;  |Y nCodigo ! #dspase15#5;   nSwMalo = 1;  |FINSI;
         |SI #dspase15#6  ! 0;  |Y nCodigo ! #dspase15#6;   nSwMalo = 1;  |FINSI;
         |SI #dspase15#7  ! 0;  |Y nCodigo ! #dspase15#7;   nSwMalo = 1;  |FINSI;
         |SI #dspase15#40 ! 0;  |Y nCodigo ! #dspase15#40;  nSwMalo = 1;  |FINSI;   || 2018
         |SI #dspase15#39 ! 0;  |Y nCodigo ! #dspase15#39;  nSwMalo = 1;  |FINSI;   || 2017
         |SI #dspase15#38 ! 0;  |Y nCodigo ! #dspase15#38;  nSwMalo = 1;  |FINSI;   || 2016
         |SI #dspase15#37 ! 0;  |Y nCodigo ! #dspase15#37;  nSwMalo = 1;  |FINSI;   || 2015
         |SI #dspase15#36 ! 0;  |Y nCodigo ! #dspase15#36;  nSwMalo = 1;  |FINSI;   || 2014
         |SI #dspase15#35 ! 0;  |Y nCodigo ! #dspase15#35;  nSwMalo = 1;  |FINSI;   || 2013
         |SI #dspase15#34 ! 0;  |Y nCodigo ! #dspase15#34;  nSwMalo = 1;  |FINSI;
         |SI #dspase15#33 ! 0;  |Y nCodigo ! #dspase15#33;  nSwMalo = 1;  |FINSI;
         |SI #dspase15#32 ! 0;  |Y nCodigo ! #dspase15#32;  nSwMalo = 1;  |FINSI;
         |SI #dspase15#31 ! 0;  |Y nCodigo ! #dspase15#31;  nSwMalo = 1;  |FINSI;
         |SI #dspase15#30 ! 0;  |Y nCodigo ! #dspase15#30;  nSwMalo = 1;  |FINSI;
         |SI #dspase15#29 ! 0;  |Y nCodigo ! #dspase15#29;  nSwMalo = 1;  |FINSI;
         |SI #dspase15#28 ! 0;  |Y nCodigo ! #dspase15#28;  nSwMalo = 1;  |FINSI;
         |SI #dspase15#27 ! 0;  |Y nCodigo ! #dspase15#27;  nSwMalo = 1;  |FINSI;
         |SI #dspase15#26 ! 0;  |Y nCodigo ! #dspase15#26;  nSwMalo = 1;  |FINSI;
         |SI #dspase15#25 ! 0;  |Y nCodigo ! #dspase15#25;  nSwMalo = 1;  |FINSI;
         |SI #dspase15#24 ! 0;  |Y nCodigo ! #dspase15#24;  nSwMalo = 1;  |FINSI;
         |SI #dspase15#23 ! 0;  |Y nCodigo ! #dspase15#23;  nSwMalo = 1;  |FINSI;
         |SI #dspase15#8  ! 0;  |Y nCodigo ! #dspase15#8;   nSwMalo = 1;  |FINSI;
         |SI #dspase15#9  ! 0;  |Y nCodigo ! #dspase15#9;   nSwMalo = 1;  |FINSI;
         |SI #dspase15#10 ! 0;  |Y nCodigo ! #dspase15#10;  nSwMalo = 1;  |FINSI;
         |SI #dspase15#11 ! 0;  |Y nCodigo ! #dspase15#11;  nSwMalo = 1;  |FINSI;
         |SI #dspase15#12 ! 0;  |Y nCodigo ! #dspase15#12;  nSwMalo = 1;  |FINSI;
         |SI #dspase15#13 ! 0;  |Y nCodigo ! #dspase15#13;  nSwMalo = 1;  |FINSI;
         |SI #dspase15#14 ! 0;  |Y nCodigo ! #dspase15#14;  nSwMalo = 1;  |FINSI;
         |SI #dspase15#17 ! 0;  |Y nCodigo ! #dspase15#17;  nSwMalo = 1;  |FINSI;

         nCFac = 0;
         nCarga = 1;
         |BUCLE dspase16Chequeo;

         |SI nSwMalo = 1;
             nCodigo = 0;

                               nOrden  = 1;  |HAZ BuscaOrden;
             |SI nCodigo = 0;  nOrden  = 2;  |HAZ BuscaOrden;  |FINSI;
             |SI nCodigo = 0;  nOrden  = 3;  |HAZ BuscaOrden;  |FINSI;
             |SI nCodigo = 0;  nOrden  = 4;  |HAZ BuscaOrden;  |FINSI;
             |SI nCodigo = 0;  nOrden  = 5;  |HAZ BuscaOrden;  |FINSI;
             |SI nCodigo = 0;  nOrden  = 6;  |HAZ BuscaOrden;  |FINSI;
             |SI nCodigo = 0;  nOrden  = 7;  |HAZ BuscaOrden;  |FINSI;
         |FINSI;
     |FINSI;

     #dspase15#3 = nCodigo;
     |GRABA 020#dspase15.a;
     |LIBERA #dspase15;
|FPRC;

|DEFBUCLE dspase15Chequeo;
     #dspase15#1;
     ;
     "            ", 000;
     "zzzzzzzzzzzz", 999;
     be;
     NULL,  Chequeo15;
|FIN;

|PROCESO ChequeoCambio;
     nCodigo = 0;
     |BUCLE dspase15Chequeo;
|FPRC;

|PROCESO PasaREO;
     eaVarDni = #espejo1@#1;  |HAZ CalculoDNI;

     #dspase15#0 = eaVarDni;
     #dspase15#1 = 0;
     |LEE 040#dspase15.=;
     |SI FSalida ! 0;
         nRegistro = 0;
     |SINO;
         nCasilla = 17;
         nCodigo  = #espejo1@#0;
         |HAZ BuscaRegistro;
     |FINSI;

     #dspase15#0 = eaVarDni;
     #dspase15#1 = nRegistro;
     |LEE 101#dspase15.=;
     |SI FSalida ! 0;
         |DDEFECTO #dspase15;
         #dspase15#0 = eaVarDni;
         #dspase15#1 = nRegistro;
         |GRABA 020#dspase15.b;
     |FINSI;

     aAlfa = #dspase15#2;  |QBF aAlfa;
     |SI aAlfa = "";
         aAlfa = #espejo1@#2;  |QBF aAlfa;
         #dspase15#2  = #espejo1@#2;
         |SI aAlfa = "";  #dspase15#2  = #espejo1@#3;  |FINSI;
     |FINSI;

     #dspase15#17 = #espejo1@#0;
     |GRABA 020#dspase15.a;
     |LIBERA #dspase15;
|FPRC;

|DEFBUCLE eosclien;
     #espejo1@#1001;
     ;
     00001;
     99999;
     ;
     NULL, PasaREO;
|FIN;

|PROCESO GrabaCodigo;
     #espejo1@#0 = #dspase15#0;
     #espejo1@#1 = #dspase15#1;
     |LEE 040#espejo1@.=;
     |SI FSalida = 0;
         #dspase15#3  = #espejo1@#3;
         #dspase15#21 = #espejo1@#21;
         #dspase15#22 = #espejo1@#22;

         |GRABA 020#dspase15.a;
     |FINSI;
     |LIBERA #dspase15;
|FPRC;

|DEFBUCLE dspase15;
     #dspase15#1;
     ;
     "            ", 000;
     "zzzzzzzzzzzz", 999;
     be;
     NULL, GrabaCodigo;
|FIN;

|PROCESO AltaFichero;
     |HAZ BusquedaApli;

     |DELINDEX #dspase15;
     |ABRE #dspase16;  |CIERRA #dspase16;  |DELINDEX #dspase16;

     |DBASS aBase;  |QBF aBase;
     |PATH_DAT #dspase18#aBase#;

     |ABRE #dspase18;
     |LEE 101#dspase18.=;
     |SI FSalida = 0;
         |CONFI "     Ya existe una configuracion anterior, desea mantener la configuracion";
         nHayAnterior = FSalida;
     |SINO;
         |DDEFECTO #dspase18;
         |GRABA 020#dspase18.b;
         FSalida = 1;
     |FINSI;

     nHayAnterior = FSalida;

     |SI FSalida ! 0;
         |PUSHV 0501 2380;
         |DDEFECTO #dspase18;
         |PINPA #0#dspase18;
         |PINDA #0#dspase18;
         |ENDATOS #1#dspase18;
         |SI FSalida ! 0;
             |LIBERA #dspase18;
             |CIERRA #dspase18;

             nError = 1;
             |POPV;
             |ACABA;
         |SINO;
             |GRABA 020#dspase18.a;
         |FINSI;
     |FINSI;
     |LIBERA #dspase18;
     |CIERRA #dspase18;

     |POPV;

     |ABRE #dspase15;

     |MENSA "      Recogiendo Codigos de Basica";
     |BUCLE agifigen;

     |MENSA "      Recogiendo Codigos de Laboral";
     |BUCLE labempre;

     |MENSA "      Recogiendo Codigos de Contabilidad";
     nEmpresa = 0;  |BUCLE canempre;

     |MENSA "      Recogiendo Codigos de Sociedades";
     nEmpresa = 0;  |BUCLE maacceso;

     |MENSA "      Recogiendo Codigos de Renta";
                    |HAZ Renta;

     |MENSA "      Recogiendo Codigos de Facturacion";
                    |HAZ Facturacion;

     |MENSA "      Recogiendo Codigos de REO";

     aPathAnterior   = #dspase00#0;  |QBT aPathAnterior;
     aPathDefFiscal  = aPathAnterior + "agieos/def/";
     aPathFichFiscal = aPathAnterior + "agieos/fich/";
     aDef = aPathDefFiscal + "eosclien.mas";
     |CARGA_DEF aDef, espejo1@;
     |SI FSalida = 0;
         |PATH_DAT #espejo1@#aPathFichFiscal#;

         |BUCLE eosclien;
         |DESCARGA_DEF #espejo1@;
     |FINSI;

     |CIERRA #dspase15;

     |MENSA "      Chequeando Codigos ";

     |HAZ ChequeoCambio;

     |SI nHayAnterior = 0;
         aDef = aBase + "basica/def/dspase15.mas";
         |CARGA_DEF aDef, espejo1@;
         |SI FSalida = 0;
             |PATH_DAT #espejo1@#aBase#;
             |ABRE #espejo1@;
             |BUCLE dspase15;
             |CIERRA #espejo1@;
             |DESCARGA_DEF #espejo1@;
         |FINSI;
     |FINSI;

     |MENSA "                    ";
|FPRC;

|PROCESO dspase15Cambiar;
     |SI #dspase15#17 ! 0;  |Y #dspasw02#1 = "N";
         |ACABA;
     |FINSI;

     |SI #dspase15#5  ! 0;  |Y #dspasw02#2 = "N";
         |ACABA;
     |FINSI;

     |SI #dspase15#6  ! 0;  |Y #dspasw02#3 = "N";
         |ACABA;
     |FINSI;

     |SI #dspase15#7  ! 0;  |Y #dspasw02#4 = "N";
         |ACABA;
     |FINSI;

     nRentas = #dspase15#8  + #dspase15#9  + #dspase15#10 + #dspase15#11;
     nRentas = nRentas      + #dspase15#12 + #dspase15#13 + #dspase15#14;
     nRentas = nRentas      + #dspase15#23 + #dspase15#24 + #dspase15#25;
     nRentas = nRentas      + #dspase15#26 + #dspase15#27 + #dspase15#28;
     nRentas = nRentas      + #dspase15#29 + #dspase15#30 + #dspase15#31;
     nRentas = nRentas      + #dspase15#32 + #dspase15#33 + #dspase15#34;
     nRentas = nRentas      + #dspase15#35 + #dspase15#36 + #dspase15#37;
     nRentas = nRentas      + #dspase15#38 + #dspase15#39 + #dspase15#40;   || 2018

     |SI nRentas ! 0;  |Y #dspasw02#5 = "N";
         |ACABA;
     |FINSI;

     nTodos = 0;

     |ABRE #dspase16;
     #dspase16#0 = #dspase15#0;
     #dspase16#1 = #dspase15#1;
     #dspase16#2 = 0;
     |LEE 000#dspase16.];
     |SI FSalida = 0;  |Y  #dspase16#0 = #dspase15#0;  |Y  #dspase16#1 = #dspase15#1;
         nTodos = 1;
         |SI #dspasw02#6 = "N";
             |CIERRA #dspase16;
             |ACABA;
         |FINSI;
     |FINSI;
     |CIERRA #dspase16;

     nTodos  = nTodos + #dspase15#17  +  #dspase15#5  + #dspase15#6  + #dspase15#7;
     nTodos  = nTodos + #dspase15#8   +  #dspase15#9  + #dspase15#10 + #dspase15#11 + #dspase15#12 + #dspase15#13 + #dspase15#14;
     nTodos  = nTodos + #dspase15#23  +  #dspase15#24 + #dspase15#25 + #dspase15#26 + #dspase15#27 + #dspase15#28 + #dspase15#29;
     nTodos  = nTodos + #dspase15#30  +  #dspase15#31 + #dspase15#32 + #dspase15#33 + #dspase15#34 + #dspase15#35 + #dspase15#36;
     nTodos  = nTodos + #dspase15#37  +  #dspase15#38 + #dspase15#39 + #dspase15#40;   ||2018

     |SI nTodos = 0;
         |ACABA;
     |FINSI;

     |ABRE #espejo1@;
     |SELECT #7#espejo1@;
     |PARA;  |SI;  |HACIENDO;
          #espejo1@#3 = nCodCambio;
          |LEE 000#espejo1@.=;
          |SI FSalida ! 0;  |SAL;  |FINSI;

          |SI nCodCambio > 99999;  |SAL;  |FINSI;

          nCodCambio = nCodCambio + 1;
     |SIGUE;
     |CIERRA #espejo1@;

     |SI nCodCambio  > 99999;  |ACABA;  |FINSI;

     #dspase15#3 = nCodCambio;
     |GRABA 020#dspase15.a;
     |LIBERA #dspase15;
|FPRC;

|DEFBUCLE dspase15Cambiar;
     #dspase15#1;
     ;
     "            ", 000;
     "zzzzzzzzzzzz", 999;
     be;
     NULL,  dspase15Cambiar;
|FIN;

|PROCESO Cambiar;
     |PUSHV 0501 2380;
     |DDEFECTO #dspasw02;
     |PINPA #0#dspasw02;
     |PINDA #0#dspasw02;
     |ENDATOS #1#dspasw02;
     |SI FSalida ! 0;
         |POPV;
         |ACABA;
     |FINSI;
     |POPV;

     |DBASE aPath;  |QBT aPath;
     aDef = aPath + "def/dspase15.mas";
     |CARGA_DEF aDef, espejo1@;
     |SI FSalida ! 0;
         aAlfa = "     Error en cargar el Def dspase15.mas";
         |MENAV aAlfa;
         |ACABA;
     |FINSI;

     nCodCambio = #dspasw02#0;
     |BUCLE dspase15Cambiar;

     |DESCARGA_DEF #espejo1@;
|FPRC;

|PROCESO LinealAplica;
     |PUSHV 0501 1480;
     |BLANCO 0501 1480;

     |ENTLINEAL #1#dspasw01, -1, 4, 22, 1, Baja99, Alta99;
     |POPV;

     FSalida = 1;   |HAZ Evento;
|FPRC;

|PROCESO LinealFactur;
     |PUSHV 0501 1480;
     |BLANCO 0501 1480;

     |ENTLINEAL #1#dspase16, -1, 4, 22, 0, ClaveBaja1, ClaveAlta1;
     |POPV;

     FSalida = 1;   |HAZ Evento;
|FPRC;

|RUTINA ClaveBaja0;
      #dspase15#0 = "";
      #dspase15#1 = 0;
|FRUT;

|RUTINA ClaveAlta0;
      #dspase15#0 = "zzzzzzzzzzzz";
      #dspase15#1 = 999;
|FRUT;

|PROCESO AltaAplica;
     |SI nCampo1 = 0;  |ACABA;  |FINSI;

     #dspasw01#0 = #dspase15#0;
     #dspasw01#1 = #dspase15#1;
     #dspasw01#2 = nOrden;
     #dspasw01#3 = aAplica;
     #dspasw01#4 = nCampo1;
     #dspasw01#5 = nCampo2;
     |GRABA 020#dspasw01.n;
     |LIBERA #dspasw01;
|FPRC;

|PROCESO AltaTempo;
     aAplica = "Integrada   ";  nOrden  = 1;  nCampo1 = #dspase15#3;  nCampo2 = 0;      |HAZ AltaAplica;
     aAplica = "Basica      ";  nOrden  = 2;  nCampo1 = #dspase15#4;  nCampo2 = #dspase15#18;  |HAZ AltaAplica;
     aAplica = "R.E.O.      ";  nOrden  = 3;  nCampo1 = #dspase15#17; nCampo2 = 0;      |HAZ AltaAplica;
     aAplica = "Laboral     ";  nOrden  = 4;  nCampo1 = #dspase15#5;  nCampo2 = #dspase15#19;  |HAZ AltaAplica;
     aAplica = "Contabilidad";  nOrden  = 5;  nCampo1 = #dspase15#6;  nCampo2 = #dspase15#20;  |HAZ AltaAplica;
     aAplica = "Sociedades  ";  nOrden  = 6;  nCampo1 = #dspase15#7;  nCampo2 = 0;      |HAZ AltaAplica;

     aAplica = "Renta 2018  ";  nOrden  = 7;  nCampo1 = #dspase15#40; nCampo2 = 0;      |HAZ AltaAplica;
     aAplica = "Renta 2017  ";  nOrden  = 8;  nCampo1 = #dspase15#39; nCampo2 = 0;      |HAZ AltaAplica;
     aAplica = "Renta 2016  ";  nOrden  = 9;  nCampo1 = #dspase15#38; nCampo2 = 0;      |HAZ AltaAplica;
     aAplica = "Renta 2015  ";  nOrden  = 10; nCampo1 = #dspase15#37; nCampo2 = 0;      |HAZ AltaAplica;
     aAplica = "Renta 2014  ";  nOrden  = 11; nCampo1 = #dspase15#36; nCampo2 = 0;      |HAZ AltaAplica;
     aAplica = "Renta 2013  ";  nOrden  = 12; nCampo1 = #dspase15#35; nCampo2 = 0;      |HAZ AltaAplica;
     aAplica = "Renta 2012  ";  nOrden  = 13; nCampo1 = #dspase15#34; nCampo2 = 0;      |HAZ AltaAplica;
     aAplica = "Renta 2011  ";  nOrden  = 14; nCampo1 = #dspase15#33; nCampo2 = 0;      |HAZ AltaAplica;
     aAplica = "Renta 2010  ";  nOrden  = 15; nCampo1 = #dspase15#32; nCampo2 = 0;      |HAZ AltaAplica;
     aAplica = "Renta 2009  ";  nOrden  = 16; nCampo1 = #dspase15#31; nCampo2 = 0;      |HAZ AltaAplica;
     aAplica = "Renta 2008  ";  nOrden  = 17; nCampo1 = #dspase15#30; nCampo2 = 0;      |HAZ AltaAplica;
     aAplica = "Renta 2007  ";  nOrden  = 18; nCampo1 = #dspase15#29; nCampo2 = 0;      |HAZ AltaAplica;
     aAplica = "Renta 2006  ";  nOrden  = 19; nCampo1 = #dspase15#28; nCampo2 = 0;      |HAZ AltaAplica;
     aAplica = "Renta 2005  ";  nOrden  = 20; nCampo1 = #dspase15#27; nCampo2 = 0;      |HAZ AltaAplica;
     aAplica = "Renta 2004  ";  nOrden  = 21; nCampo1 = #dspase15#26; nCampo2 = 0;      |HAZ AltaAplica;
     aAplica = "Renta 2003  ";  nOrden  = 22; nCampo1 = #dspase15#25; nCampo2 = 0;      |HAZ AltaAplica;
     aAplica = "Renta 2002  ";  nOrden  = 23; nCampo1 = #dspase15#24; nCampo2 = 0;      |HAZ AltaAplica;
     aAplica = "Renta 2001  ";  nOrden  = 24; nCampo1 = #dspase15#23; nCampo2 = 0;      |HAZ AltaAplica;
     aAplica = "Renta 2000  ";  nOrden  = 25; nCampo1 = #dspase15#8;  nCampo2 = 0;      |HAZ AltaAplica;
     aAplica = "Renta 1999  ";  nOrden  = 26; nCampo1 = #dspase15#9;  nCampo2 = 0;      |HAZ AltaAplica;
     aAplica = "Renta 1998  ";  nOrden  = 27; nCampo1 = #dspase15#10; nCampo2 = 0;      |HAZ AltaAplica;
     aAplica = "Renta 1997  ";  nOrden  = 28; nCampo1 = #dspase15#11; nCampo2 = 0;      |HAZ AltaAplica;
     aAplica = "Renta 1996  ";  nOrden  = 29; nCampo1 = #dspase15#12; nCampo2 = 0;      |HAZ AltaAplica;
     aAplica = "Renta 1995  ";  nOrden  = 30; nCampo1 = #dspase15#13; nCampo2 = 0;      |HAZ AltaAplica;
     aAplica = "Renta 1994  ";  nOrden  = 31; nCampo1 = #dspase15#14; nCampo2 = 0;      |HAZ AltaAplica;

     |ABRE #dspase16;
     #dspase16#0 = #dspase15#0;
     #dspase16#1 = #dspase15#1;
     #dspase16#2 = 0;
     |LEE 000#dspase16.];
     |SI FSalida = 0;  |Y  #dspase16#0 = #dspase15#0;  |Y  #dspase16#1 = #dspase15#1;
         aAplica = "Facturacion ";  nOrden  = 32; nCampo1 = #dspase16#3;  nCampo2 = 0;      |HAZ AltaAplica;
     |FINSI;
     |CIERRA #dspase16;
|FPRC;

|PROCESO Baja99;
     #dspasw01#0 = #dspase15#0;
     #dspasw01#1 = #dspase15#1;
     #dspasw01#2 = 1;
|FPRC;

|PROCESO Alta99;
     #dspasw01#0 = #dspase15#0;
     #dspasw01#1 = #dspase15#1;
     #dspasw01#2 = 99;
|FPRC;

|PROCESO Evento;
     |SI FSalida = 1;  |O FSalida = 2;
         |SELECT #1#dspase15;
         |LEE 000#dspase15.=;
         |SI FSalida ! 0;  |DDEFECTO #dspase15;  |FINSI;

         |SI nGridTempo ! -1;
             |DELINDEX #dspasw01;
         |FINSI;

         aFichero = ("99" + Usuario + "zzzzzzzz") % 108;
         |NOME_DAT #dspasw01#aFichero#;

         |ABRE #dspasw01;
         |HAZ AltaTempo;

         |ENTLINEAL #1#dspasw01, -1, 7, 22, 1, Baja99, Alta99;
         nGridTempo = 0;

         eaVarDni = #dspase15#0;
         nRegistro = #dspase15#1;
         |ENTLINEAL #1#dspase16, -1, 7, 22, 0, ClaveBaja1, ClaveAlta1;
     |FINSI;

     |SI FSalida = 4;
         |HAZ PonCodigo;

         |PONCONTROL 23, "SI";
         FSalida = "SKIPDEFAULT";
     |FINSI;
|FPRC;

|PROCESO Salir;
     |PTEC 807;
|FPRC;

|PROGRAMA;
     enCalcCif = 3;

     |ABRE #dspase00;
     |LEE 040#dspase00.p;
     |SI FSalida ! 0;
         |MENAV "     Pase de Ficheros Generales no Realizado";
         |CIERRA #dspase00;
         |ACABA;
     |FINSI;
     |CIERRA #dspase00;

     |CLS;
     |CABEZA "Unificar Codigos";
     |PINPA #0#dspasw01;

     nError = 0;
     |ABRE #dspase15;
     |LEE 040#dspase15.p;
     |SI FSalida = 0;
         |CIERRA #dspase15;
         |SI #dspase15#15 = "N";
             |CONFI "0000NEl Fichero ya existe desea crearlo de nuevo ";
             |SI FSalida = 0;
                 |HAZ AltaFichero;
             |FINSI;
         |FINSI;
     |SINO;
         |CIERRA #dspase15;
         |HAZ AltaFichero;
     |FINSI;

     |SI nError = 1;  |ACABA;  |FINSI;

     |CONTROL_SIMPLE 0, "LBOTON,{{197}}", 1635, 1637, LinealAplica;
     nBoton1 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON,{{197}}", 1676, 1678, LinealFactur;
     nBoton2 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON,Activar/Desactivar registro", 0502, 0520, PonBorrado;
     nBoton4 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON,Imprimir", 0523, 0533, Impresion;
     nBoton5 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON,Incidencias", 0536, 0546,Incidencias;
     nBoton6 = FSalida;

     |CONTROL_SIMPLE 0, "LBOTON,Cambiar codificacion masiva", 0548, 0568, Cambiar;
     nBoton3 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,Salir", 2470, 2480, Salir;
     nBotonSalir = FSalida;

     |ABRE #dspase15;
     |LEE 040#dspase15.p;
     |SI FSalida ! 0;  |O #dspase15#16 = "N";
         |ESTADO_CONTROL nBoton3, "DISABLE";
     |FINSI;

     nRango = 2 + 4 + 8 + 16 + 128;
     |LINEAL_SIMPLE #1#dspase15, nRango, 0601, 1480, ClaveBaja0, ClaveAlta0,  Evento;
     |CIERRA #dspase15;

     |FIN_CONTROL_WINDOWS nBoton1;
     |FIN_CONTROL_WINDOWS nBoton2;
     |FIN_CONTROL_WINDOWS nBoton3;
     |FIN_CONTROL_WINDOWS nBoton4;
     |FIN_CONTROL_WINDOWS nBoton5;
     |FIN_CONTROL_WINDOWS nBoton6;
     |FIN_CONTROL_WINDOWS nBotonSalir;

     |DBASS aBase;        |QBF aBase;
     |DFICE aFichOrigen;  |QBF aFichOrigen;

     aOrigen  = aFichOrigen + "dspase15.dat";
     aDestino = aBase + "dspase15.dat";
     |COPIA_FICHERO aOrigen, aDestino;

     aOrigen  = aFichOrigen + "dspase15.ddx";
     aDestino = aBase + "dspase15.ddx";
     |COPIA_FICHERO aOrigen, aDestino;

     aOrigen  = aFichOrigen + "dspase15.ixx";
     aDestino = aBase + "dspase15.ixx";
     |COPIA_FICHERO aOrigen, aDestino;

     aOrigen  = aFichOrigen + "dspase16.dat";
     aDestino = aBase + "dspase16.dat";
     |COPIA_FICHERO aOrigen, aDestino;

     aOrigen  = aFichOrigen + "dspase16.ddx";
     aDestino = aBase + "dspase16.ddx";
     |COPIA_FICHERO aOrigen, aDestino;

     aOrigen  = aFichOrigen + "dspase16.ixx";
     aDestino = aBase + "dspase16.ixx";
     |COPIA_FICHERO aOrigen, aDestino;

     |CIERRA #dspasw01;  |DELINDEX #dspasw01;

     |PULSATECLA;
|FPRO;
