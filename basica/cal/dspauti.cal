|FICHEROS;
     dspase03;
     dspase25;

     :/modelos/def/dsmom004;
     :/modelos/def/dsmom008;
     :/modelos/def/dsmom095;

     :/modelos/def/dsmoc310;
     :/modelos/def/dsmod310;
     :/modelos/def/dsmoc131;
     :/modelos/def/dsmod131;
     :/modelos/def/dsmociva;
     :/modelos/def/dsmod300;
     :/modelos/def/dsmod320;
     :/modelos/def/dsmod330;
     :/modelos/def/dsmod332;
     :/modelos/def/dsmoc130;
     :/modelos/def/dsmod130;
     :/modelos/def/dsmoc349;
     :/modelos/def/dsmod349;
     :/modelos/def/dsmoc110;
     :/modelos/def/dsmoc111;
     :/modelos/def/dsm11101;
     :/modelos/def/dsmod110;
     :/modelos/def/dsmoc115;
     :/modelos/def/dsmod115;
     :/modelos/def/dsmoc123;
     :/modelos/def/dsmod123;
     :/modelos/def/dsmom093;
     :/modelos/def/dsmod303;
     :/modelos/def/dsm30301;
     :/modelos/def/dsm30302;
     :/modelos/def/dsm30303;
     :/modelos/def/dsm30304;
     :/modelos/def/dsm30305;
|FIN;

|VARIABLES;
     &enModelo      = 0;
     &enDPeriodo    = 0;
     &enHPeriodo    = 0;
     &eaArchiva     = "";
     &efFechaI      = @;
     &enEmpresa     = 0;
     &enEjer        = 0;
     &enPeriodo     = 0;
     &enComplem     = 0;
     &enActividad   = 0;
     &enResultado   = 0;
     &enTipoEntrada = 0;
     &enEntrada     = 0;
     &enExistencia  = 0;
     &enDesdePase   = 0;
     &enDEmpresa    = 0;
     &enHEmpresa    = 0;
     &eaPathDsmodelo = "";

     aAlfa          = "";
     aPath          = "";
     aParametro     = "";
|FIN;

|PROCESO dsmom093B;
     |BORRA 020#dsmom093.a;
     |LIBERA #dsmom093;
|FPRC;

|DEFBUCLE dsmom093B;
     #dsmom093#1;
     ;
     enModelo, #dspase03#4, enDEmpresa;
     enModelo, #dspase03#4, enHEmpresa;
     be;
     NULL, dsmom093B;
|FIN;

|PROCESO dsmom004B;
     |BORRA 020#dsmom004.a;
     |LIBERA #dsmom004;
|FPRC;

|DEFBUCLE dsmom004B;
     #dsmom004#1;
     ;
     enDEmpresa, #dspase03#4, enDPeriodo, enModelo, 00;
     enHEmpresa, #dspase03#4, enHPeriodo, enModelo, 99;
     be;
     NULL, dsmom004B;
|FIN;

|PROCESO dsmom008B;
     |BORRA 020#dsmom008.a;
     |LIBERA #dsmom008;
|FPRC;

|DEFBUCLE dsmom008B;
     #dsmom008#1;
     ;
     enDEmpresa, #dspase03#4, enDPeriodo, enModelo, 00, 00;
     enHEmpresa, #dspase03#4, enHPeriodo, enModelo, 99, 99;
     be;
     NULL, dsmom008B;
|FIN;

|PROCESO dsmoc310B;
     |BORRA 020#dsmoc310.a;
     |LIBERA #dsmoc310;
|FPRC;

|DEFBUCLE dsmoc310B;
     #dsmoc310#1;
     ;
     enDEmpresa, #dspase03#4, enDPeriodo, enModelo, 00, 00;
     enHEmpresa, #dspase03#4, enHPeriodo, enModelo, 99, 99;
     be;
     NULL, dsmoc310B;
|FIN;

|PROCESO dsmod310B;
     |BORRA 020#dsmod310.a;
     |LIBERA #dsmod310;
|FPRC;

|DEFBUCLE dsmod310B;
     #dsmod310#1;
     ;
     enDEmpresa, #dspase03#4, enDPeriodo, enModelo, 00, 00;
     enHEmpresa, #dspase03#4, enHPeriodo, enModelo, 99, 99;
     be;
     NULL, dsmod310B;
|FIN;

|PROCESO dsmoc131B;
     |BORRA 020#dsmoc131.a;
     |LIBERA #dsmoc131;
|FPRC;

|DEFBUCLE dsmoc131B;
     #dsmoc131#1;
     ;
     enDEmpresa, #dspase03#4, enDPeriodo, enModelo, 00, 00;
     enHEmpresa, #dspase03#4, enHPeriodo, enModelo, 99, 99;
     be;
     NULL, dsmoc131B;
|FIN;

|PROCESO dsmod131B;
     |BORRA 020#dsmod131.a;
     |LIBERA #dsmod131;
|FPRC;

|DEFBUCLE dsmod131B;
     #dsmod131#1;
     ;
     enDEmpresa, #dspase03#4, enDPeriodo, enModelo, 00, 00;
     enHEmpresa, #dspase03#4, enHPeriodo, enModelo, 99, 99;
     be;
     NULL, dsmod131B;
|FIN;

|PROCESO dsmocivaB;
     |BORRA 020#dsmociva.a;
     |LIBERA #dsmociva;
|FPRC;

|DEFBUCLE dsmocivaB;
     #dsmociva#1;
     ;
     enDEmpresa, #dspase03#4, enDPeriodo, enModelo, 00, 00, 0, 00;
     enHEmpresa, #dspase03#4, enHPeriodo, enModelo, 99, 99, 9, 99;
     be;
     NULL, dsmocivaB;
|FIN;

|PROCESO dsmod300B;
     |BORRA 020#dsmod300.a;
     |LIBERA #dsmod300;
|FPRC;

|DEFBUCLE dsmod300B;
     #dsmod300#1;
     ;
     enDEmpresa, #dspase03#4, enDPeriodo, enModelo, 00, 00;
     enHEmpresa, #dspase03#4, enHPeriodo, enModelo, 99, 99;
     be;
     NULL, dsmod300B;
|FIN;

|PROCESO dsm30302B;
     |BORRA 020#dsm30302.a;
     |LIBERA #dsm30302;
|FPRC;

|DEFBUCLE dsm30302B;
     #dsm30302#1;
     ;
     #dsm30301#0,#dsm30301#1,#dsm30301#2,#dsm30301#3,#dsm30301#4,00,000;
     #dsm30301#0,#dsm30301#1,#dsm30301#2,#dsm30301#3,#dsm30301#4,99,999;
     be;
     NULL, dsm30302B;
|FIN;

|PROCESO dsm30303B;
     |BORRA 020#dsm30303.a;
     |LIBERA #dsm30303;
|FPRC;

|DEFBUCLE dsm30303B;
     #dsm30303#1;
     ;
     #dsm30301#0,#dsm30301#1,#dsm30301#2,#dsm30301#3,#dsm30301#4,00;
     #dsm30301#0,#dsm30301#1,#dsm30301#2,#dsm30301#3,#dsm30301#4,99;
     be;
     NULL, dsm30303B;
|FIN;

|PROCESO dsm30304B;
     |BORRA 020#dsm30304.a;
     |LIBERA #dsm30304;
|FPRC;

|DEFBUCLE dsm30304B;
     #dsm30304#1;
     ;
     #dsm30301#0,#dsm30301#1,#dsm30301#3,#dsm30301#4,01;
     #dsm30301#0,#dsm30301#1,#dsm30301#3,#dsm30301#4,99;
     be;
     NULL, dsm30304B;
|FIN;

|PROCESO dsm30305B;
     |BORRA 020#dsm30305.a;
     |LIBERA #dsm30305;
|FPRC;

|DEFBUCLE dsm30305B;
     #dsm30305#1;
     ;
     #dsm30301#0,#dsm30301#1,#dsm30301#3,#dsm30301#4,1;
     #dsm30301#0,#dsm30301#1,#dsm30301#3,#dsm30301#4,9;
     be;
     NULL, dsm30305B;
|FIN;

|PROCESO dsm30301B;
     |BORRA 020#dsm30301.a;
     |LIBERA #dsm30301;

     |BUCLE dsm30302B;
     |BUCLE dsm30303B;
     |SI #dsm30301#2 = 12;
         |BUCLE dsm30304B;
         |BUCLE dsm30305B;
     |FINSI;
|FPRC;

|DEFBUCLE dsm30301B;
     #dsm30301#1;
     ;
     enDEmpresa, #dspase03#4, enDPeriodo, enModelo, 00, 00;
     enHEmpresa, #dspase03#4, enHPeriodo, enModelo, 99, 99;
     be;
     NULL, dsm30301B;
|FIN;

|PROCESO dsmod303B;
     |BORRA 020#dsmod303.a;
     |LIBERA #dsmod303;
|FPRC;

|DEFBUCLE dsmod303B;
     #dsmod303#1;
     ;
     enDEmpresa, #dspase03#4, enDPeriodo, enModelo, 00, 00;
     enHEmpresa, #dspase03#4, enHPeriodo, enModelo, 99, 99;
     be;
     NULL, dsmod303B;
|FIN;

|PROCESO dsmod320B;
     |BORRA 020#dsmod320.a;
     |LIBERA #dsmod320;
|FPRC;

|DEFBUCLE dsmod320B;
     #dsmod320#1;
     ;
     enDEmpresa, #dspase03#4, enDPeriodo, enModelo, 00, 00;
     enHEmpresa, #dspase03#4, enHPeriodo, enModelo, 99, 99;
     be;
     NULL, dsmod320B;
|FIN;

|PROCESO dsmod330B;
     |BORRA 020#dsmod330.a;
     |LIBERA #dsmod330;
|FPRC;

|DEFBUCLE dsmod330B;
     #dsmod330#1;
     ;
     enDEmpresa, #dspase03#4, enDPeriodo, enModelo, 00, 00;
     enHEmpresa, #dspase03#4, enHPeriodo, enModelo, 99, 99;
     be;
     NULL, dsmod330B;
|FIN;

|PROCESO dsmod332B;
     |BORRA 020#dsmod332.a;
     |LIBERA #dsmod332;
|FPRC;

|DEFBUCLE dsmod332B;
     #dsmod332#1;
     ;
     enDEmpresa, #dspase03#4, enDPeriodo, enModelo, 00, 00;
     enHEmpresa, #dspase03#4, enHPeriodo, enModelo, 99, 99;
     be;
     NULL, dsmod332B;
|FIN;

|PROCESO dsmoc130B;
     |BORRA 020#dsmoc130.a;
     |LIBERA #dsmoc130;
|FPRC;

|DEFBUCLE dsmoc130B;
     #dsmoc130#1;
     ;
     enDEmpresa, #dspase03#4, enDPeriodo, enModelo, 00, 00;
     enHEmpresa, #dspase03#4, enHPeriodo, enModelo, 99, 99;
     be;
     NULL, dsmoc130B;
|FIN;

|PROCESO dsmod130B;
     |BORRA 020#dsmod130.a;
     |LIBERA #dsmod130;
|FPRC;

|DEFBUCLE dsmod130B;
     #dsmod130#1;
     ;
     enDEmpresa, #dspase03#4, enDPeriodo, enModelo, 00, 00;
     enHEmpresa, #dspase03#4, enHPeriodo, enModelo, 99, 99;
     be;
     NULL, dsmod130B;
|FIN;

|PROCESO dsmom095B;
    |BORRA 020#dsmom095.a;
    |LIBERA #dsmom095;
|FPRC;

|DEFBUCLE dsmom095B;
     #dsmom095#1;
     ;
     enDEmpresa,#dspase03#4;
     enHEmpresa,#dspase03#4;
     be;
     NULL, dsmom095B;
|FIN;

|PROCESO dsmoc349B;
     |BORRA 020#dsmoc349.a;
     |LIBERA #dsmoc349;
|FPRC;

|DEFBUCLE dsmoc349B;
     #dsmoc349#1;
     ;
     enDEmpresa,#dspase03#4,enDPeriodo,enModelo,00,00,"  ",0000,0,"            ";
     enHEmpresa,#dspase03#4,enHPeriodo,enModelo,99,99,"zz",9999,9,"zzzzzzzzzzzz";
     be;
     NULL, dsmoc349B;
|FIN;

|PROCESO dsmod349B;
     |BORRA 020#dsmod349.a;
     |LIBERA #dsmod349;
|FPRC;

|DEFBUCLE dsmod349B;
     #dsmod349#1;
     ;
     enDEmpresa, #dspase03#4, enDPeriodo, enModelo, 00, 00;
     enHEmpresa, #dspase03#4, enHPeriodo, enModelo, 99, 99;
     be;
     NULL, dsmod349B;
|FIN;

|PROCESO dsmoc111B;
     |BORRA 020#dsmoc111.a;
     |LIBERA #dsmoc111;
|FPRC;

|DEFBUCLE dsmoc111B;
     #dsmoc111#1;
     ;
     enDEmpresa,#dspase03#4,enDPeriodo,enModelo,00,00,"            ",0000,00," ","  ",0;
     enHEmpresa,#dspase03#4,enHPeriodo,enModelo,99,99,"zzzzzzzzzzzz",9999,12,"z","zz",9;
     be;
     NULL, dsmoc111B;
|FIN;

|PROCESO dsm11101B;
     |BORRA 020#dsm11101.a;
     |LIBERA #dsm11101;
|FPRC;

|DEFBUCLE dsm11101B;
     #dsm11101#1;
     ;
     enDEmpresa,#dspase03#4,enDPeriodo,enModelo,00,00,"            ",0000,00," ","  ",0;
     enHEmpresa,#dspase03#4,enHPeriodo,enModelo,99,99,"zzzzzzzzzzzz",9999,12,"z","zz",9;
     be;
     NULL, dsm11101B;
|FIN;

|PROCESO dsmoc110B;
     |BORRA 020#dsmoc110.a;
     |LIBERA #dsmoc110;
|FPRC;

|DEFBUCLE dsmoc110B;
     #dsmoc110#1;
     ;
     enDEmpresa,#dspase03#4,enDPeriodo,enModelo,00,00,"            ",0000," ","  ";
     enHEmpresa,#dspase03#4,enHPeriodo,enModelo,99,99,"zzzzzzzzzzzz",9999,"z","zz";
     be;
     NULL, dsmoc110B;
|FIN;

|PROCESO dsmod110B;
     |BORRA 020#dsmod110.a;
     |LIBERA #dsmod110;
|FPRC;

|DEFBUCLE dsmod110B;
     #dsmod110#1;
     ;
     enDEmpresa, #dspase03#4, enDPeriodo, enModelo, 00, 00;
     enHEmpresa, #dspase03#4, enHPeriodo, enModelo, 99, 99;
     be;
     NULL, dsmod110B;
|FIN;

|PROCESO dsmoc115B;
     |BORRA 020#dsmoc115.a;
     |LIBERA #dsmoc115;
|FPRC;

|DEFBUCLE dsmoc115B;
     #dsmoc115#1;
     ;
     enDEmpresa, #dspase03#4, enDPeriodo, enModelo, 00, 00, "            ", 0000, 01;
     enHEmpresa, #dspase03#4, enHPeriodo, enModelo, 99, 99, "zzzzzzzzzzzz", 9999, 99;
     be;
     NULL, dsmoc115B;
|FIN;

|PROCESO dsmod115B;
     |BORRA 020#dsmod115.a;
     |LIBERA #dsmod115;
|FPRC;

|DEFBUCLE dsmod115B;
     #dsmod115#1;
     ;
     enDEmpresa, #dspase03#4, enDPeriodo, enModelo, 00, 00;
     enHEmpresa, #dspase03#4, enHPeriodo, enModelo, 99, 99;
     be;
     NULL, dsmod115B;
|FIN;

|PROCESO dsmoc123B;
     |BORRA 020#dsmoc123.a;
     |LIBERA #dsmoc123;
|FPRC;

|DEFBUCLE dsmoc123B;
     #dsmoc123#1;
     ;
     enDEmpresa,#dspase03#4,enDPeriodo,enModelo,00,00,"            ",0000," ",00,0;
     enHEmpresa,#dspase03#4,enHPeriodo,enModelo,99,99,"zzzzzzzzzzzz",9999,"z",99,9;
     be;
     NULL, dsmoc123B;
|FIN;

|PROCESO dsmod123B;
     |BORRA 020#dsmod123.a;
     |LIBERA #dsmod123;
|FPRC;

|DEFBUCLE dsmod123B;
     #dsmod123#1;
     ;
     enDEmpresa, #dspase03#4, enDPeriodo, enModelo, 00, 00;
     enHEmpresa, #dspase03#4, enHPeriodo, enModelo, 99, 99;
     be;
     NULL, dsmod123B;
|FIN;

|PROCESO dspase25B;
     |BORRA 020#dspase25.a;
     |LIBERA #dspase25;
|FPRC;

|DEFBUCLE dspase25B;
     #dspase25#1;
     ;
     enModelo, enDPeriodo, 00, enDEmpresa;
     enModelo, enHPeriodo, 99, enHEmpresa;
     be;
     NULL, dspase25B;
|FIN;

|PROCESO BorraModelos;
     enDPeriodo = 00;   || Por si alguna vez las activamos.
     enHPeriodo = 99;

     |BUCLE dsmom004B;
     |BUCLE dsmom008B;
     |BUCLE dspase25B;

     aPath = eaPathDsmodelo + "fich/";
     |PATH_DAT #dsmom093#aPath#;
     |PATH_DAT #dsmod123#aPath#;
     |PATH_DAT #dsmod320#aPath#;
     |PATH_DAT #dsmod330#aPath#;
     |PATH_DAT #dsmod332#aPath#;
     |PATH_DAT #dsmom095#aPath#;

     |SI enModelo = 310;
         |BUCLE dsmoc310B;
         |BUCLE dsmod310B;
     |FINSI;

     |SI enModelo = 131;
         |BUCLE dsmoc131B;
         |BUCLE dsmod131B;
         |BUCLE dsmom093B;
     |FINSI;

     |SI enModelo = 300;
         |BUCLE dsmocivaB;
         |BUCLE dsmod300B;
     |FINSI;

     |SI enModelo = 303;
         |BUCLE dsmocivaB;
         |SI #dspase03#4 [ 2013;
             |BUCLE dsmod303B;
         |SINO;
             |BUCLE dsm30301B;
         |FINSI;
     |FINSI;

     |SI enModelo = 320;
         |BUCLE dsmocivaB;
         |BUCLE dsmod320B;
     |FINSI;

     |SI enModelo = 330;
         |BUCLE dsmocivaB;
         |BUCLE dsmod330B;
     |FINSI;

     |SI enModelo = 332;
         |BUCLE dsmocivaB;
         |BUCLE dsmod332B;
     |FINSI;

     |SI enModelo = 370;
         |BUCLE dsmoc310B;
         |BUCLE dsmod310B;
         |BUCLE dsmocivaB;
         |BUCLE dsmod300B;
         |BUCLE dsmod303B;
     |FINSI;

     |SI enModelo = 130;
         |BUCLE dsmoc130B;
         |BUCLE dsmod130B;
         |BUCLE dsmom093B;
     |FINSI;

     |SI enModelo = 349;
         |BUCLE dsmom095B;
         |BUCLE dsmoc349B;
         |BUCLE dsmod349B;
     |FINSI;

     |SI enModelo = 110;
         |SI #dspase03#4 [ 2010;
             |BUCLE dsmoc110B;
         |FINSI;

         |SI #dspase03#4 ] 2011;  |Y #dspase03#4 [ 2015;
             |BUCLE dsmoc111B;
         |FINSI;

         |SI #dspase03#4 ] 2016;
             |BUCLE dsm11101B;
         |FINSI;
     |FINSI;

     |SI enModelo = 115;
         |BUCLE dsmoc115B;
         |BUCLE dsmod115B;
     |FINSI;

     |SI enModelo = 123;
         |BUCLE dsmoc123B;
         |BUCLE dsmod123B;
     |FINSI;
|FPRC;

|PROCESO Graba08;
     |SI #dsmom008#5 = 0;
         #dsmom008#11 = "EXISTENTE";
     |SINO;
         #dsmom008#11 = "COMPLETADO";
     |FINSI;
     |GRABA 020#dsmom008.a;
     |LIBERA #dsmom008;
|FPRC;

|DEFBUCLE dsmom008;
     #dsmom008#1;
     ;
     #dsmom004#0, #dsmom004#1, #dsmom004#2, #dsmom004#3, #dsmom004#4, 00;
     #dsmom004#0, #dsmom004#1, #dsmom004#2, #dsmom004#3, #dsmom004#4, 99;
     be;
     NULL, Graba08;
|FIN;

|PROCESO PonDatosPlaning;
     |ABRE #dsmom004;
     #dsmom004#0 = enEmpresa;
     #dsmom004#1 = enEjer;
     #dsmom004#2 = enPeriodo;
     #dsmom004#3 = enModelo;
     #dsmom004#4 = enComplem;
     |LEE 040#dsmom004.=;
     |SI FSalida = 0;
         enActividad   = 0;
         enResultado   = 0;
         enTipoEntrada = 99;
         enDesdePase   = 1;

         enEntrada = 0;
         aParametro = ("00000" + enEmpresa) % -105;
         aParametro = aParametro + ("0000" + enEjer) % -104;
         aParametro = aParametro + ("00" + enPeriodo) % -102;
         aParametro = aParametro + ("000" + enModelo) % -103;
         aParametro = aParametro + ("00" + enComplem) % -102;
         aParametro = aParametro + ("00" + enActividad) % -102;
         aParametro = aParametro + ("00" + enTipoEntrada) % -102;
         aParametro = aParametro + ("0" + enExistencia) % -101;

         |SI enModelo = 131;  |SUB_EJECUTA_NP ":modelos/dsmod131";  |FINSI;
         |SI enModelo = 310;
             |SI enEjer [ 2013;
                  |SUB_EJECUTA_NP ":modelos/dsmod310";
             |FINSI;

             |SI enEjer ] 2014;
                 aAlfa = ":modelos/dsm30301;" + aParametro;
                 |SUB_EJECUTA_NP aAlfa;
             |FINSI;
         |FINSI;
         |SI enModelo = 300;  |SUB_EJECUTA_NP ":modelos/dsmod300";  |FINSI;
         |SI enModelo = 303;
             |SI enEjer [ 2013;
                  |SUB_EJECUTA_NP ":modelos/dsmod303";
             |FINSI;

             |SI enEjer ] 2014;
                 aAlfa = ":modelos/dsm30301;" + aParametro;
                 |SUB_EJECUTA_NP aAlfa;
             |FINSI;
         |FINSI;
         |SI enModelo = 320;  |SUB_EJECUTA_NP ":modelos/dsmod320";  |FINSI;
         |SI enModelo = 330;  |SUB_EJECUTA_NP ":modelos/dsmod330";  |FINSI;
         |SI enModelo = 332;  |SUB_EJECUTA_NP ":modelos/dsmod332";  |FINSI;
         |SI enModelo = 370;  |SUB_EJECUTA_NP ":modelos/dsmod370";  |FINSI;
         |SI enModelo = 130;  |SUB_EJECUTA_NP ":modelos/dsmod130";  |FINSI;
         |SI enModelo = 349;  |SUB_EJECUTA_NP ":modelos/dsmod349";  |FINSI;
         |SI enModelo = 110;  |SUB_EJECUTA_NP ":modelos/dsmod110";  |FINSI;
         |SI enModelo = 115;  |SUB_EJECUTA_NP ":modelos/dsmod115";  |FINSI;
         |SI enModelo = 123;  |SUB_EJECUTA_NP ":modelos/dsmod123";  |FINSI;
         |SI enModelo = 340;  |SUB_EJECUTA_NP ":modelos/dsmo3401";  |FINSI;

         #dsmom004#7  = "X";
         #dsmom004#8  = efFechaI;
         #dsmom004#15 = enResultado;

         |SI efFechaI ! "01.01.0000";
             #dsmom004#9  = "X";
             #dsmom004#10 = efFechaI;
         |FINSI;

         |SI eaArchiva = "X";
             #dsmom004#13 = "X";
             #dsmom004#14 = efFechaI;
         |FINSI;

         #dsmom004#17 = "COMPLETADO";

         |GRABA 020#dsmom004.a;
         |LIBERA #dsmom004;

         |BUCLE dsmom008;
     |FINSI;
     |CIERRA #dsmom004;
|FPRC;

|PROGRAMA;
     |SI PARAMETRO = "PonDatosPlaning";
         |HAZ PonDatosPlaning;
     |FINSI;

     |SI PARAMETRO = "BorraModelos";
         |HAZ BorraModelos;
     |FINSI;
|FPRO;
