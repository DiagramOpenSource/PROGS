|FICHEROS;
     dspase00 #0;

     dspase12 #4;
     dspase15 #15;

     dspase22 #22;

     dspase96 #96;
     dspase97 #97;

     dspase98 #98;

     :/basica/def/agicen14 #114;
     :/modelos/def/dsmom100 #100;

     :/contagen/def/canempre #130;
     canempr@ #330;
     :/contagen/def/ca8ctrle #400;

     &referen@ #999;
      refecon@ #998;
      refebue@ #997;
      refeesp@ #996;  ||nuevo

      emcarte@;
|FIN;

|VARIABLES;
     nSwLocal = 0;
     aBase             = "";
     aDirecBuscar      = "";
     aFichero          = "";
     aDef              = "";
     aOrigen           = "";
     aDestino          = "";
     aFicheroOrigen    = "";
     aFicheroDestino   = "";
     nPara1            = 0;
     aAlfa             = "";
     aAlfa1            = "";
     aAlfa2            = "";
     aAlfa3            = "";
     aPathAnterior     = "";
     aPathOrigen       = "";
     aPathDestino      = "";
     aPathCartera      = "";
     aDirFichPatron    = "";
     aDirFichOrigen    = "";
     aDirFichDestino   = "";
     aDirEmpresaN      = "";
     aDirEmpresaV      = "";
     aPath000000       = "";
     aPathPases        = "";
     aParam            = "";

     aDActivos         = "";
     aHActivos         = "";
     aActivar          = "";
     aConcepto         = "";
     aHora             = "";
     aAbre             = "";

     nHandle           = 0;
     nSwCopiar         = 0;
     nSwEsFichero      = 0;
     nSwAplicacion     = 0;
     nSwCoger          = 0;
     nCampos           = 0;
     nEmpresa          = 0;
     nEmpresaDef       = 0;
     nCodigo           = 0;
     nValorEmpre       = 0;
     nValorRegis       = 0;
     nLinea            = 0;
     nLineaA           = 0;
     nLineaC           = 0;
     nActiv            = 0;
     nSwEsta           = 0;
     nAgrupa           = 0;
     nFactor           = 0;
     nDEmpresa         = 0;
     nHEmpresa         = 0;
     nDPeriodo         = 0;
     nHPeriodo         = 0;
     nSwGraba          = 0
     nNume             = 0;
     nCanal            = 0;
     nEjer             = 0;
     nTecla            = 0;
     nDEjer            = 0;
     nHEjer            = 0;
     nCampo            = 0;
     nEmpreContab      = 0;
     nEmprePasada      = 0;
     nHoraInicial      = 0;
     nHoraFinal        = 0;
     nHora             = 0;
     nMinuto           = 0;
     nResto            = 0;
     nHoraTrabajo      = 0;
     nFecha            = 0;
     nHoraEmpieza      = 0;
     nMinuEmpieza      = 0;
     nSeguEmpieza      = 0;
     nHoraTermina      = 0;
     nMinuTermina      = 0;
     nSeguTermina      = 0;
     nTContab          = 0;
     nTEmpieza         = 0;
     nTTermina         = 0;
     nTAcum            = 0;
     nCodigoNue        = 0;
     nCodigoCon        = 0;
     nEstaCambio       = 0;
     nHastaCampo       = 0;

     nSwVale           = 0;
     aQueQuiero        = "";
     aNumCampos        = "";
     nNumCampos        = 0;
     aLongCampo        = "";
     nLongCampo        = 0;

     &enEmpresa        = 0;
     &enEmpresaV       = 0;
     &enPeriodo        = 0;
     &enPeriodoV       = 0;

     &eaEmpresa        = "";
     &eaBase           = "";
     &eaAplica         = "";
     &enForzar         = 0;
     &eaMoneda         = "";
     &eaMonedaV        = "";
     &enEjerConta      = 0;
     &eaPathBasica     = "";
     &eaPathContagen   = "";
     &eaPathContanex   = "";
     &eaPathContasoc   = "";
     &eaPathDscarter   = "";
     &eaPathRen2000    = "";
     &eaPathRen1999    = "";
     &eaPathRen1998    = "";
     &eaPathRen1997    = "";
     &eaPathRen1996    = "";
     &eaPathRen1995    = "";
     &eaPathRen1994    = "";
     &eaPathFacturar   = "";
     &eaPathLaboral    = "";
     &eaPathIntegral   = "";
     &eaPathDsmodelo   = "";
     &eaPathFiscal     = "";

     nSwLaFuncion    = 0;
     &eSwCambio      = 0;

     nPerioNue       = 0;
     nExiste         = 0;
     nNume1          = 0;
     nEstado         = 0;
     nAnterior       = 0;
     nDEmp           = 0;
     nHEmp           = 0;
     nSwError        = 0;
     nSwExiste       = 0;
     aMensa          = "";
     aDef330         = "";
     nInkey          = 0;
     aDirBase        = "";
     aPathDef        = "";

     aPath           = "";
     aIPRemoto       = "";
     aDirTempo       = "";
     aBasLocal       = "";
     aDirOrigen      = "";
     aDirDestino     = "";


     aFichTar = "";
     aPathRec = "";
     aFich   = "";
     &eaPreg22_1 = "";
     &eaPreg22_2 = "";
     &eaPreg22_5 = "";
     &eaPreg22_6 = "";
     &eaPreg22_7 = "";
     &eaPreg22_8 = "";
     aPathAgicli  = "";
     aPathAgieos  = "";
     &eaPPortadaX = "";
     &eaPPortadaO = "";
     &eaPPortadaD = "";

     &enEmpCartera = 0;
     &eaDirAgicont = "";
     &enEmpAgicont = 0;
     &enPerAgicont = 0;
     &enERP = 0;
|FIN;

|| ********************************************************************
|| **** DATOS PANTALLA
|| ********************************************************************

|CALCULO PonBarra; |TIPO 0;
     nInkey = FSalida;
     |C_M #4#12,0, aAlfa1;
     |SI aAlfa1 = "N"; |ACABA; |FINSI;

     |SI nInkey = 10;
        aAlfa1 = "D c:\";
        |BROWSE aAlfa1;
        aAlfa1 = aAlfa1 % 280;
        #4Campo = aAlfa1;
        |PINTA #4Campo
    |FINSI;

     aAlfa1 = #4Campo;
     |QBF aAlfa1;
     aAlfa2 = aAlfa1 % -101;
     |SI aAlfa2 ! "/";|Y aAlfa2 ! "\";
          #4Campo = aAlfa1 + "/";
          |PINTA #4Campo;
     |FINSI;

     nSwError = 0;
     |HAZ CargaEmpAgicont;
     |SI nSwError ! 0;
         |MENAV aMensa;
     |FINSI;
     |C_M #4#12,1, "N";
     |C_M #4#13,1, "N";
|FCAL;

|RUTINA infA2;
   #330#2 = nDEmp;
   #330#3 = 0;
|FRUT;

|RUTINA supA2;
   #330#2 = nHEmp;
   #330#3 = 9;
|FRUT;

|CALCULO SoloAmortiza;
   aAlfa1 = "S";
   |SI #4#14 = "X"; aAlfa1 = "N"; |FINSI;
   |C_M #4#9,  1, aAlfa1;
   |C_M #4#10, 1, aAlfa1;
|FCAL;

|CALCULO LeeEmpresa; |TIPO 0;
  nInkey = FSalida;

  aPathOrigen     = #4#12;  |QBF aPathOrigen;
  aPathOrigen     = aPathOrigen + "agicont/fich/";
  |PATH_DAT #330 aPathOrigen;

  |SI nInkey = 10;
     nDEmp = 0; nHEmp = 99999;
     |ABRE #330;
     |CONSULTA_F_CLAVE #1#330,infA2,supA2;
     #4#1 = #330#2; |PINTA #4#1;
     #4#2 = #330#3; |PINTA #4#2;
     |CIERRA #330;
     |PTEC 802;
     |ACABA;
  |FINSI;

  |ABRE #330;
  #330#2 = #4#1;
  #330#3 = 0;
  |LEE 011#330];
  |SI FSalida ! 0;  |O #330#2 ! #4#1;
      |MENAV "     NO Existe la empresa Contable";
      |ERROR;
  |SINO;
      #4#3 = #330#1;  |PINTA #4#3;
      #4#4 = #330#26; |PINTA #4#4;
  |FINSI;
  |CIERRA #330;
|FCAL;

|CALCULO LeeEmpresaP; |TIPO 0;
  nInkey = FSalida;
  |SI nInkey = 2; |ACABA; |FINSI;

  aPathOrigen     = #4#12;  |QBF aPathOrigen;
  aPathOrigen     = aPathOrigen + "agicont/fich/";
  |PATH_DAT #330 aPathOrigen;

  |SI nInkey = 10;
     nDEmp = #4#1; nHEmp = #4#1;
     |ABRE #330;
     |CONSULTA_F_CLAVE #1#330,infA2,supA2;
     #4#2 = #330#3; |PINTA #4#2;
     |CIERRA #330;
  |FINSI;

  |ABRE #330;
  #330#2 = #4#1;
  #330#3 = #4#2;
  |LEE 011#330=;
  |SI FSalida ! 0;
      |MENAV "     NO Existe Periodo en la Empresa Contable";
      |ERROR;
  |SINO;
      #4#3   = #330#1;  |PINTA #4#3;
      #4#4   = #330#26; |PINTA #4#4;
  |FINSI;
  |CIERRA #330;
|FCAL;

|PROCESO CogeCodigo;
     |SI #15#22 = "S";  |ACABA;  |FINSI;
     nCodigoNue = #15#3;
     |ERROR10;
|FPRC;

|DEFBUCLE dspase15;
     #15#5;
     ;
     nCodigoCon, "            ", 000;
     nCodigoCon, "zzzzzzzzzzzz", 999;
     ;
     NULL, CogeCodigo;
|FIN;

|CALCULO defectos; |TIPO 7;

   |SI nEstaCambio = 1;
       nCodigoNue = 0;
       nCodigoCon = #4#1;
       |BUCLE dspase15;
       |SI nCodigoNue = 0;  nCodigoNue = #4#1; |FINSI;
   |SINO;
       nCodigoNue = #4#1;
   |FINSI;

    #4#5 = nCodigoNue;  |PINTA #4#5;
    #4#6 = #4#2;        |PINTA #4#6;
    #4#7 = #4#3;        |PINTA #4#7;
    #4#8 = #4#4;        |PINTA #4#8;
|FCAL;


|CALCULO esbuena1;
  |SI FSalida = 2; |ACABA; |FINSI;

  |ABRE #130;
  #130#2 = #4#5;
  #130#3 = #4#6;
  |LEE 011#130=;
  |SI FSalida = 0;
      nSwError = 1;
      |SI #130#26 ! #4#4;
          aAlfa1 = "    NError, esta Empresa existe y no es el mismo Periodo. Continuar S/N";
      |SINO;
          aAlfa1 = "    SYa Existe Empresa. Sustituir los datos S/N";
      |FINSI;
      |CONFI aAlfa1;
      |SI FSalida ! 0;
          |ERROR;
          |CIERRA #130;
          |ACABA;
      |FINSI;
      #4#7 = #130#1;  |PINTA #4#7;
  |FINSI;
  |CIERRA #130;
|FCAL;

|CALCULO LaFuncion;
     nInkey = FSalida;
     |SI nInkey = 12;
         |SI nSwLaFuncion = 0;
             nSwLaFuncion = 1;
             |ATRI P;|PINTA 2133, "Activar Tabla Concepto";|ATRI 0;
         |SINO;
             nSwLaFuncion = 0;
             |PINTA 2133, "                      ";
         |FINSI;
     |FINSI;
|FCAL;

|RUTINA infB2;
   #emcarte@#0 = nDEmp;
|FRUT;

|RUTINA supB2;
   #emcarte@#0 = nHEmp;
|FRUT;

|CALCULO SiHayCartera; |TIPO 0;
     |SI eaPathDscarter ! "";
         aAlfa1 = #dspase12#16;
         |C_M #dspase12#17, 1, aAlfa1;
         |SI aAlfa1 = "N";
             #dspase12#17 = 1;
         |SINO;
             #dspase12#17 = #dspase12#5;
         |FINSI;
         |PINTA #dspase12#17;
     |FINSI;
|FCAL;

|CALCULO EmpCartera; |TIPO 0;
  nInkey = FSalida;
  |SI nInkey = 2; |ACABA; |FINSI;

  |C_M #dspase12#Campo#,0,aAlfa1;
  |SI aAlfa1 = "N"; |ACABA; |FINSI;

  |SI eaPathDscarter ! "";
      |SI nInkey = 10;
          nDEmp = 0; nHEmp = 99999;
          |ABRE #emcarte@;
          |CONSULTA_F_CLAVE #1#emcarte@, infB2,supB2;
          #dspase12#17 = #emcarte@#0; |PINTA #dspase12#17;
          |CIERRA #emcarte@;
          |PTEC 802;
          |ACABA;
      |FINSI;

      aParam = "basica";
      nSwExiste = 0;
      |ABRE #emcarte@;
      #emcarte@#0 = #dspase12#17;
      |LEE 011#emcarte@.=;
      |SI FSalida = 0;
          nSwExiste = 1;
          aAlfa1 = "    SYa Existe Empresa. Recoger los datos S/N";
          |CONFI aAlfa1;
          |SI FSalida ! 0;
              |ERROR;
          |SINO;
               aAlfa1 = "    NA¤adir a los datos ya existentes";
               |CONFI aAlfa1;
               |SI FSalida = 0;
                   aParam = "basica1";
               |FINSI;
          |FINSI;
      |FINSI;
      |CIERRA #emcarte@;
  |FINSI;
|FCAL;
|| ********************************************************************

|PROCESO GrabaMoneda;
     aDef = aPathDestino + "def/camoneda.mas";
     |CARGA_DEF aDef, referen@;
     |SI FSalida ! 0;
         eaMoneda = "E";
     |SINO;
         aPath000000  = aPathOrigen + "fich/000000/";
         |PATH_DAT #999 aPath000000;
         |ABRE #999;
         #999#0 = #98#6;
         #999#1 = #98#1;
         |LEE 040#999=;
         |SI FSalida ! 0;
             eaMoneda = "E";
         |SINO;
             eaMoneda = #999#2;
         |FINSI;
         eaMonedaV = eaMoneda;
         |CIERRA #999;

         aPath000000  = aPathDestino + "fich/000000/";
         |PATH_DAT #999 aPath000000;
         |ABRE #999;
         #999#0 = #98#0;
         #999#1 = #98#8;
         |LEE 101#999=;
         |SI FSalida ! 0;     |GRABA 020#999b;    |FINSI;
         #999#2 = eaMoneda;
         |GRABA 020#999a;
         |LIBERA #999;
         |CIERRA #999;

         |DESCARGA_DEF #referen@;
     |FINSI;

     |DBASS eaBase;  |QBF eaBase;
     enForzar = 1;

     |SUB_EJECUTA_NP ":agitool/dsconver";
|FPRC;

|PROCESO Graba8Ctrle;
     aDef = aPathOrigen + "def/ca8ctrle.mas";
     |CARGA_DEF aDef, referen@;
     |SI FSalida = 0;
         aPath000000  = aPathOrigen + "fich/000000/";
         |PATH_DAT #999 aPath000000;
         |ABRE #999;
         #999#0 = #98#6;
         #999#1 = #98#1;
         |LEE 040#999=;
         |SI FSalida = 0;
             |ABRE #400;
             #400#0 = #98#0;
             #400#1 = #98#8;
             |LEE 101#400=;
             |SI FSalida ! 0;
                 #400#0 = #98#0;
                 #400#1 = #98#8;
                 |GRABA 020#400b;
             |FINSI;
             #400#2 = #999#2;
             #400#3 = #98#0;   ||asumo el mismo numero de empresa por si ha cambiado
             #400#4 = #999#4;
             #400#5 = #999#5;
             #400#6 = #999#6;
             #400#7 = #999#7;
             |GRABA 020#400a;
             |LIBERA #400;
             |CIERRA #400;
         |FINSI;
         |CIERRA #999;
         |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|| ________________________________________________________________________
|| Proceso Cambio de Conceptos;
|| ________________________________________________________________________

|PROCESO caconci2;
     |SI nEmpresa = 0;
         #97#0 = 0;
         #97#1 = #98#1;
         #97#2 = #999#2;
         #97#3 = 0;
     |SINO;
         #97#0 = #98#0;
         #97#1 = #98#1;
         #97#2 = #999#2;
         #97#3 = 0;
     |FINSI;
     |LEE 040#97];
     |SI FSalida = 0;  |Y #97#2 = #999#2;
         #999#2 = #97#4;
         |GRABA 020#999a;
     |FINSI;
     |LIBERA #999;
|FPRC;

|DEFBUCLE caconci2;
     #999#1002;
     ;
     00000, 00;
     99999, 99;
     be;
     NULL, caconci2;
|FIN;

|PROCESO caconcim;
     |SI nEmpresa = 0;
         #97#0 = 0;
         #97#1 = #98#1;
         #97#2 = #999#4;
         #97#3 = 0;
     |SINO;
         #97#0 = #98#0;
         #97#1 = #98#1;
         #97#2 = #999#4;
         #97#3 = 0;
     |FINSI;
     |LEE 040#97];
     |SI FSalida = 0;  |Y #97#2 = #999#4;
         #999#4 = #97#4;
     |FINSI;

     |SI nEmpresa = 0;
         #97#0 = 0;
         #97#1 = #98#1;
         #97#2 = #999#7;
         #97#3 = 0;
     |SINO;
         #97#0 = #98#0;
         #97#1 = #98#1;
         #97#2 = #999#7;
         #97#3 = 0;
     |FINSI;
     |LEE 040#97];
     |SI FSalida = 0;  |Y #97#2 = #999#7;
         #999#7 = #97#4;
     |FINSI;

     |GRABA 020#999a;
     |LIBERA #999;
|FPRC;

|DEFBUCLE caconcim;
     #999#1001;
     ;
     00000;
     99999;
     be;
     NULL, caconcim;
|FIN;

|PROCESO caentasl;
     |SI nEmpresa = 0;
         #97#0 = 0;
         #97#1 = #98#1;
         #97#2 = #999#6;
         #97#3 = #999#11;
     |SINO;
         #97#0 = #98#0;
         #97#1 = #98#1;
         #97#2 = #999#6;
         #97#3 = #999#11;
     |FINSI;
     |LEE 040#97];
     |SI FSalida = 0; |Y #97#2 = #999#6;
         #999#6 = #97#4;
         #999#7 = #97#5;
         |GRABA 020#999a;
     |FINSI;
     |LIBERA #999;
|FPRC;

|DEFBUCLE caentasl;
     #999#1002;
     ;
     "        ", 00000;
     "zzzzzzzz", 99999;
     be;
     NULL, caentasl;
|FIN;

|PROCESO cainliva;
     |SI nEmpresa = 0;
         #97#0 = 0;
         #97#1 = #98#1;
         #97#2 = #999#7;
         #97#3 = #999#0;
     |SINO;
         #97#0 = #98#0;
         #97#1 = #98#1;
         #97#2 = #999#7;
         #97#3 = #999#0;
     |FINSI;
     |LEE 040#97];
     |SI FSalida = 0; |Y #97#2 = #999#7;
         #999#7 = #97#4;
         #999#8 = #97#5;
     |FINSI;

     |SI nEmpresa = 0;
         #97#0 = 0;
         #97#1 = #98#1;
         #97#2 = #999#43;
         #97#3 = #999#0;
     |SINO;
         #97#0 = #98#0;
         #97#1 = #98#1;
         #97#2 = #999#43;
         #97#3 = #999#0;
     |FINSI;
     |LEE 040#97];
     |SI FSalida = 0; |Y #97#2 = #999#43;
         #999#43 = #97#4;
         #999#44 = #97#5;
     |FINSI;

     |GRABA 020#999a;
     |LIBERA #999;
|FPRC;

|DEFBUCLE cainliva;
     #999#1002;
     ;
     00, 000;
     99, 999;
     be;
     NULL, cainliva;
|FIN;

|PROCESO caivaasi;
     |ABRE #999;
     |LEE 101#999p;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

    |SI nEmpresa = 0;
         #97#0 = 0;
         #97#1 = #98#1;
         #97#2 = #999#5;
         #97#3 = #999#3;
     |SINO;
         #97#0 = #98#0;
         #97#1 = #98#1;
         #97#2 = #999#5;
         #97#3 = #999#3;
     |FINSI;
     |LEE 040#97];
     |SI FSalida = 0; |Y #97#2 = #999#5;
         #999#5 = #97#4;
         #999#7 = #97#5;
     |FINSI;

     |SI nEmpresa = 0;
         #97#0 = 0;
         #97#1 = #98#1;
         #97#2 = #999#31;
         #97#3 = #999#29;
     |SINO;
         #97#0 = #98#0;
         #97#1 = #98#1;
         #97#2 = #999#31;
         #97#3 = #999#29;
     |FINSI;
     |LEE 040#97];
     |SI FSalida = 0; |Y #97#2 = #999#31;
         #999#31 = #97#4;
         #999#33 = #97#5;
     |FINSI;

     |SI nEmpresa = 0;
         #97#0 = 0;
         #97#1 = #98#1;
         #97#2 = #999#13;
         #97#3 = 0;
     |SINO;
         #97#0 = #98#0;
         #97#1 = #98#1;
         #97#2 = #999#13;
         #97#3 = 0;
     |FINSI;
     |LEE 040#97];
     |SI FSalida = 0; |Y #97#2 = #999#13;
         #999#13 = #97#4;
         #999#15 = #97#5;
     |FINSI;

     |SI nEmpresa = 0;
         #97#0 = 0;
         #97#1 = #98#1;
         #97#2 = #999#50;
         #97#3 = 0;
     |SINO;
         #97#0 = #98#0;
         #97#1 = #98#1;
         #97#2 = #999#50;
         #97#3 = 0;
     |FINSI;
     |LEE 040#97];
     |SI FSalida = 0; |Y #97#2 = #999#50;
         #999#50 = #97#4;
         #999#51 = #97#5;
     |FINSI;

     |SI nEmpresa = 0;
         #97#0 = 0;
         #97#1 = #98#1;
         #97#2 = #999#54;
         #97#3 = 0;
     |SINO;
         #97#0 = #98#0;
         #97#1 = #98#1;
         #97#2 = #999#54;
         #97#3 = 0;
     |FINSI;
     |LEE 040#97];
     |SI FSalida = 0; |Y #97#2 = #999#54;
         #999#54 = #97#4;
         #999#55 = #97#5;
     |FINSI;

     |GRABA 020#999a;
     |LIBERA #999;
     |CIERRA #999;
|FPRC;

|PROCESO camaniva;
     |SI nEmpresa = 0;
         #97#0 = 0;
         #97#1 = #98#1;
         #97#2 = #999#27;
         #97#3 = #999#0;
     |SINO;
         #97#0 = #98#0;
         #97#1 = #98#1;
         #97#2 = #999#27;
         #97#3 = #999#0;
     |FINSI;
     |LEE 040#97];
     |SI FSalida = 0; |Y #97#2 = #999#27;
         #999#27 = #97#4;
     |FINSI;

     |SI nEmpresa = 0;
         #97#0 = 0;
         #97#1 = #98#1;
         #97#2 = #999#29;
         #97#3 = #999#0;
     |SINO;
         #97#0 = #98#0;
         #97#1 = #98#1;
         #97#2 = #999#29;
         #97#3 = #999#0;
     |FINSI;
     |LEE 040#97];
     |SI FSalida = 0; |Y #97#2 = #999#29;
         #999#29 = #97#4;
     |FINSI;

     |GRABA 020#999a;
     |LIBERA #999;
|FPRC;

|DEFBUCLE camaniva;
     #999#1002;
     ;
     00, 0000000001;
     99, 9999999999;
     be;
     NULL, camaniva;
|FIN;

|PROCESO caivalin;
     |SI nEmpresa = 0;
         #97#0 = 0;
         #97#1 = #98#1;
         #97#2 = #999#3;
         #97#3 = #999#0;
     |SINO;
         #97#0 = #98#0;
         #97#1 = #98#1;
         #97#2 = #999#3;
         #97#3 = #999#0;
     |FINSI;
     |LEE 040#97];
     |SI FSalida = 0; |Y #97#2 = #999#3;
         #999#3 = #97#4;
         |GRABA 020#999a;
     |FINSI;
     |LIBERA #999;
|FPRC;

|DEFBUCLE caivalin;
     #999#1003;
     ;
     00, 0000000001, 01;
     99, 9999999999, 99;
     be;
     NULL, caivalin;
|FIN;

|PROCESO cagruiva;

    |PARA nPara1 = 32; |SI nPara1 [ 46; |HACIENDO nPara1 = nPara1 + 1;
          |SI nEmpresa = 0;
              #97#0 = 0;
              #97#1 = #98#1;
              #97#2 = #999nPara1;
              #97#3 = 0;
          |SINO;
              #97#0 = #98#0;
              #97#1 = #98#1;
              #97#2 = #999nPara1;
              #97#3 = 0;
          |FINSI;
          |LEE 040#97];
          |SI FSalida = 0; |Y #97#2 = #999nPara1;
              #999nPara1 = #97#4;
          |FINSI;
    |SIGUE;

    |GRABA 020#999a;
    |LIBERA #999;
|FPRC;

|DEFBUCLE cagruiva;
     #999#1001;
     ;
     00;
     99;
     be;
     NULL, cagruiva;
|FIN;

|PROCESO cajainli;
     |SI nEmpresa = 0;
         #97#0 = 0;
         #97#1 = #98#1;
         #97#2 = #999#6;
         #97#3 = 0;
     |SINO;
         #97#0 = #98#0;
         #97#1 = #98#1;
         #97#2 = #999#6;
         #97#3 = 0;
     |FINSI;
     |LEE 040#97];
     |SI FSalida = 0;  |Y #97#2 = #999#6;
         #999#6 = #97#4;
         |GRABA 020#999a;
     |FINSI;
     |LIBERA #999;
|FPRC;

|DEFBUCLE cajainli;
     #999#1002;
     ;
     "01.01.0000", 0000;
     "31.12.2999", 9999;
     be;
     NULL, cajainli;
|FIN;

|PROCESO cajasald;
    |ABRE #999;
    |LEE 101#999p;
    |SI FSalida ! 0;  |ACABA;  |FINSI;

    |SI nEmpresa = 0;
         #97#0 = 0;
         #97#1 = #98#1;
         #97#2 = #999#4;
         #97#3 = 0;
     |SINO;
         #97#0 = #98#0;
         #97#1 = #98#1;
         #97#2 = #999#4;
         #97#3 = 0;
     |FINSI;
     |LEE 040#97];
     |SI FSalida = 0; |Y #97#2 = #999#4;
         #999#4 = #97#4;
     |FINSI;

     |SI nEmpresa = 0;
         #97#0 = 0;
         #97#1 = #98#1;
         #97#2 = #999#5;
         #97#3 = 0;
     |SINO;
         #97#0 = #98#0;
         #97#1 = #98#1;
         #97#2 = #999#5;
         #97#3 = 0;
     |FINSI;
     |LEE 040#97];
     |SI FSalida = 0; |Y #97#2 = #999#5;
         #999#5 = #97#4;
     |FINSI;

     |GRABA 020#999a;
     |LIBERA #999;
     |CIERRA #999;
|FPRC;

|PROCESO camaasil;
     |SI nEmpresa = 0;
         #97#0 = 0;
         #97#1 = #98#1;
         #97#2 = #999#6;
         #97#3 = #999#13;
     |SINO;
         #97#0 = #98#0;
         #97#1 = #98#1;
         #97#2 = #999#6;
         #97#3 = #999#13;
     |FINSI;
     |LEE 040#97];
     |SI FSalida = 0; |Y #97#2 = #999#6;
         #999#6 = #97#4;
         |GRABA 020#999a;
     |FINSI;
     |LIBERA #999;
|FPRC;

|DEFBUCLE camaasil;
     #999#1004;
     ;
     00, "01.01.0000", 000001, 0000;
     99, "31.12.2999", 999999, 9999;
     be;
     NULL, camaasil;
|FIN;

|PROCESO camautol;
     |SI nEmpresa = 0;
         #97#0 = 0;
         #97#1 = #98#1;
         #97#2 = #999#4;
         #97#3 = 0;
     |SINO;
         #97#0 = #98#0;
         #97#1 = #98#1;
         #97#2 = #999#4;
         #97#3 = 0;
     |FINSI;
     |LEE 040#97];
     |SI FSalida = 0;  |Y #97#2 = #999#4;
         #999#4 = #97#4;
         |GRABA 020#999a;
     |FINSI;
     |LIBERA #999;
|FPRC;

|DEFBUCLE camautol;
     #999#1002;
     ;
     00001, 0000;
     99999, 9999;
     be;
     NULL, camautol;
|FIN;

|PROCESO camaylin;
     |SI nEmpresa = 0;
         #97#0 = 0;
         #97#1 = #98#1;
         #97#2 = #999#6;
         #97#3 = 0;
     |SINO;
         #97#0 = #98#0;
         #97#1 = #98#1;
         #97#2 = #999#6;
         #97#3 = 0;
     |FINSI;
     |LEE 040#97];
     |SI FSalida = 0;  |Y #97#2 = #999#6;
         #999#6 = #97#4;
         |GRABA 020#999a;
     |FINSI;
     |LIBERA #999;
|FPRC;

|DEFBUCLE camaylin;
     #999#1004;
     ;
     00, "01.01.0000", 000001, 0000;
     99, "31.12.2999", 999999, 9999;
     be;
     NULL, camaylin;
|FIN;

|PROCESO capasven;
     |SI nEmpresa = 0;
         #97#0 = 0;
         #97#1 = #98#1;
         #97#2 = #999#15;
         #97#3 = #999#5;
     |SINO;
         #97#0 = #98#0;
         #97#1 = #98#1;
         #97#2 = #999#15;
         #97#3 = #999#5;
     |FINSI;
     |LEE 040#97];
     |SI FSalida = 0; |Y #97#2 = #999#15;
         #999#15 = #97#4;
     |FINSI;

     |SI nEmpresa = 0;
         #97#0 = 0;
         #97#1 = #98#1;
         #97#2 = #999#16;
         #97#3 = #999#5;
     |SINO;
         #97#0 = #98#0;
         #97#1 = #98#1;
         #97#2 = #999#16;
         #97#3 = #999#5;
     |FINSI;
     |LEE 040#97];
     |SI FSalida = 0; |Y #97#2 = #999#16;
         #999#16 = #97#4;
     |FINSI;

     |SI nEmpresa = 0;
         #97#0 = 0;
         #97#1 = #98#1;
         #97#2 = #999#17;
         #97#3 = #999#5;
     |SINO;
         #97#0 = #98#0;
         #97#1 = #98#1;
         #97#2 = #999#17;
         #97#3 = #999#5;
     |FINSI;
     |LEE 040#97];
     |SI FSalida = 0; |Y #97#2 = #999#17;
         #999#17 = #97#4;
     |FINSI;

     |GRABA 020#999a;
     |LIBERA #999;
|FPRC;

|DEFBUCLE capasven;
     #999#1001;
     ;
     00;
     99;
     be;
     NULL, capasven;
|FIN;

|PROCESO casieali;
     |SI nEmpresa = 0;
         #97#0 = 0;
         #97#1 = #98#1;
         #97#2 = #999#5;
         #97#3 = 0;
     |SINO;
         #97#0 = #98#0;
         #97#1 = #98#1;
         #97#2 = #999#5;
         #97#3 = 0;
     |FINSI;
     |LEE 040#97];  |Y #97#2 = #999#5;
     |SI FSalida = 0;
         #999#5 = #97#4;
         |GRABA 020#999a;
     |FINSI;
     |LIBERA #999;
|FPRC;

|DEFBUCLE casieali;
     #999#1002;
     ;
     0000, 00;
     9999, 99;
     be;
     NULL, casieali;
|FIN;

|PROCESO cientasl;
     |SI nEmpresa = 0;
         #97#0 = 0;
         #97#1 = #98#1;
         #97#2 = #999#4;
         #97#3 = 0;
     |SINO;
         #97#0 = #98#0;
         #97#1 = #98#1;
         #97#2 = #999#4;
         #97#3 = 0;
     |FINSI;
     |LEE 040#97];
     |SI FSalida = 0;  |Y #97#2 = #999#4;
         #999#4 = #97#4;
     |FINSI;

     |SI nEmpresa = 0;
         #97#0 = 0;
         #97#1 = #98#1;
         #97#2 = #999#10;
         #97#3 = 0;
     |SINO;
         #97#0 = #98#0;
         #97#1 = #98#1;
         #97#2 = #999#10;
         #97#3 = 0;
     |FINSI;
     |LEE 040#97];
     |SI FSalida = 0;  |Y #97#2 = #999#10;
         #999#10 = #97#4;
     |FINSI;

     |GRABA 020#999a;
     |LIBERA #999;
|FPRC;

|DEFBUCLE cientasl;
     #999#1002;
     ;
     "            ", 00001;
     "zzzzzzzzzzzz", 99999;
     be;
     NULL, cientasl;
|FIN;

|PROCESO cientcon;
     |SI nEmpresa = 0;
         #97#0 = 0;
         #97#1 = #98#1;
         #97#2 = #999#6;
         #97#3 = 0;
     |SINO;
         #97#0 = #98#0;
         #97#1 = #98#1;
         #97#2 = #999#6;
         #97#3 = 0;
     |FINSI;
     |LEE 040#97];
     |SI FSalida = 0;  |Y #97#2 = #999#6;
         #999#6 = #97#4;
         |GRABA 020#999a;
     |FINSI;
     |LIBERA #999;
|FPRC;

|DEFBUCLE cientcon;
     #999#1004;
     ;
     "            ", 0, 00001, 00001;
     "zzzzzzzzzzzz", 9, 99999, 99999;
     be;
     NULL, cientcon;
|FIN;

|PROCESO cavengca;
     |SI nEmpresa = 0;
         #97#0 = 0;
         #97#1 = #98#1;
         #97#2 = #999#6;
         #97#3 = #999#1;
     |SINO;
         #97#0 = #98#0;
         #97#1 = #98#1;
         #97#2 = #999#6;
         #97#3 = #999#1;
     |FINSI;
     |LEE 040#97];
     |SI FSalida = 0;  |Y #97#2 = #999#6;
         #999#6 = #97#4;
         #999#7 = #97#5;
         |GRABA 020#999a;
     |FINSI;
     |LIBERA #999;
|FPRC;

|DEFBUCLE cavengca;
     #999#1001;
     ;
     "01.01.0000";
     "31.12.2099";
     be;
     NULL, cavengca;
|FIN;

|PROCESO TrataCambio;
     |ABRE #97;

     aDef = aPathDestino + "def/caconci2.mas"
     |CARGA_DEF aDef, referen@;
     |SI FSalida = 0;
         |PATH_DAT #999 aDirFichDestino;

         |BUCLE caconci2;

         |DESCARGA_DEF #referen@;
     |FINSI;

     aDef = aPathDestino + "def/caconcim.mas"
     |CARGA_DEF aDef, referen@;
     |SI FSalida = 0;
         |PATH_DAT #999 aDirFichDestino;

         |BUCLE caconcim;

         |DESCARGA_DEF #referen@;
     |FINSI;

     aDef = aPathDestino + "def/caentasl.mas"
     |CARGA_DEF aDef, referen@;
     |SI FSalida = 0;
         |PATH_DAT #999 aDirFichDestino;

         |BUCLE caentasl;

         |DESCARGA_DEF #referen@;
     |FINSI;

     aDef = aPathDestino + "def/cainliva.mas"
     |CARGA_DEF aDef, referen@;
     |SI FSalida = 0;
         |PATH_DAT #999 aDirFichDestino;

         |BUCLE cainliva;

         |DESCARGA_DEF #referen@;
     |FINSI;

     aDef = aPathDestino + "def/caivaasi.mas"
     |CARGA_DEF aDef, referen@;
     |SI FSalida = 0;
         |PATH_DAT #999 aDirFichDestino;

         |HAZ caivaasi;

         |DESCARGA_DEF #referen@;
     |FINSI;

     aDef = aPathDestino + "def/camaniva.mas"
     |CARGA_DEF aDef, referen@;
     |SI FSalida = 0;
         |PATH_DAT #999 aDirFichDestino;

         |BUCLE camaniva;

         |DESCARGA_DEF #referen@;
     |FINSI;

     aDef = aPathDestino + "def/caivalin.mas"
     |CARGA_DEF aDef, referen@;
     |SI FSalida = 0;
         |PATH_DAT #999 aDirFichDestino;

         |BUCLE caivalin;

         |DESCARGA_DEF #referen@;
     |FINSI;

     aDef = aPathDestino + "def/cagruiva.mas"
     |CARGA_DEF aDef, referen@;
     |SI FSalida = 0;
         |PATH_DAT #999 aDirFichDestino;

         |BUCLE cagruiva;

         |DESCARGA_DEF #referen@;
     |FINSI;

     aDef = aPathDestino + "def/cajainli.mas"
     |CARGA_DEF aDef, referen@;
     |SI FSalida = 0;
         |PATH_DAT #999 aDirFichDestino;

         |BUCLE cajainli;

         |DESCARGA_DEF #referen@;
     |FINSI;

     aDef = aPathDestino + "def/cajasald.mas"
     |CARGA_DEF aDef, referen@;
     |SI FSalida = 0;
         |PATH_DAT #999 aDirFichDestino;

         |HAZ cajasald;

         |DESCARGA_DEF #referen@;
     |FINSI;

     aDef = aPathDestino + "def/camaasil.mas"
     |CARGA_DEF aDef, referen@;
     |SI FSalida = 0;
         |PATH_DAT #999 aDirFichDestino;

         |BUCLE camaasil;

         |DESCARGA_DEF #referen@;
     |FINSI;

     aDef = aPathDestino + "def/camautol.mas"
     |CARGA_DEF aDef, referen@;
     |SI FSalida = 0;
         |PATH_DAT #999 aDirFichDestino;

         |BUCLE camautol;

         |DESCARGA_DEF #referen@;
     |FINSI;

     aDef = aPathDestino + "def/camaylin.mas"
     |CARGA_DEF aDef, referen@;
     |SI FSalida = 0;
         |PATH_DAT #999 aDirFichDestino;

         |BUCLE camaylin;

         |DESCARGA_DEF #referen@;
     |FINSI;

     aDef = aPathDestino + "def/capasven.mas"
     |CARGA_DEF aDef, referen@;
     |SI FSalida = 0;
         |PATH_DAT #999 aDirFichDestino;

         |BUCLE capasven;

         |DESCARGA_DEF #referen@;
     |FINSI;

     aDef = aPathDestino + "def/casieali.mas"
     |CARGA_DEF aDef, referen@;
     |SI FSalida = 0;
         |PATH_DAT #999 aDirFichDestino;

         |BUCLE casieali;

         |DESCARGA_DEF #referen@;
     |FINSI;

     aDef = aPathDestino + "def/cientasl.mas"
     |CARGA_DEF aDef, referen@;
     |SI FSalida = 0;
         |PATH_DAT #999 aDirFichDestino;

         |BUCLE cientasl;

         |DESCARGA_DEF #referen@;
     |FINSI;

     aDef = aPathDestino + "def/cientcon.mas"
     |CARGA_DEF aDef, referen@;
     |SI FSalida = 0;
         |PATH_DAT #999 aDirFichDestino;

         |BUCLE cientcon;

         |DESCARGA_DEF #referen@;
     |FINSI;

     aDef = aPathDestino + "def/cavengca.mas"
     |CARGA_DEF aDef, referen@;
     |SI FSalida = 0;
         |PATH_DAT #999 aDirFichDestino;

         |BUCLE cavengca;

         |DESCARGA_DEF #referen@;
     |FINSI;

     |CIERRA #97;
|FPRC;

|PROCESO Borra97;
     |BORRA 020#97a;
     |LIBERA #97;
|FPRC;

|DEFBUCLE dspase97B;
     #97#1;
     ;
     #96#0, #96#1, #96#2, 00;
     #96#0, #96#1, #96#2, 99;
     be;
     NULL, Borra97;
|FIN;

|PROCESO Borra96;
     |BUCLE dspase97B;

     |BORRA 020#96a;
     |LIBERA #96;
|FPRC;

|DEFBUCLE dspase96B;
     #96#1;
     ;
     #98#0, #98#1, 000;
     #98#0, #98#1, 999;
     be;
     NULL, Borra96;
|FIN;

|PROCESO Graba97;
     #97#0 = #98#0;
     #97#1 = #98#1;
     |GRABA 020#97n;
     |LIBERA #97;
|FPRC;

|DEFBUCLE dspase97;
     #97#1;
     ;
     00000, #96#1, #96#2, 00;
     00000, #96#1, #96#2, 99;
     be;
     NULL, Graba97;
|FIN;

|PROCESO PasaConcepto;
     #96#0 = 0;
     #96#1 = #98#1;
     #96#2 = #999#0;
     |LEE 101#96=;
     |SI FSalida ! 0;
         #96#0 = 0;
         #96#1 = #98#1;
         #96#2 = #999#0;
         #96#3 = #999#1;
         |GRABA 020#96n;
         nSwGraba = 1;
     |SINO;
         aConcepto = #96#3;
         |SI #96#3 ! #999#1;  aConcepto = "";  nEmpresa = 1;  |FINSI;
     |FINSI;
     |LIBERA #96;

     #96#0 = #98#0;
     #96#1 = #98#1;
     #96#2 = #999#0;
     |LEE 101#96=;
     |SI FSalida ! 0;
         #96#0 = #98#0;
         #96#1 = #98#1;
         #96#2 = #999#0;
         #96#3 = #999#1;
         |GRABA 020#96n;

         |SI aConcepto ! "";
             |BUCLE dspase97;
         |FINSI;
     |FINSI;
     |LIBERA #96;
|FPRC;

|DEFBUCLE caconcep;
     #999#1001;
     ;
     000;
     999;
     ;
     NULL, PasaConcepto;
|FIN;

|RUTINA ClaveBaja96;
      #96#0 = nDEmpresa;
      #96#1 = nDPeriodo;
      #96#2 = 001;
|FRUT;

|RUTINA ClaveAlta96;
      #96#0 = nHEmpresa;
      #96#1 = nHPeriodo;
      #96#2 = 999;
|FRUT;

|PROCESO CambiaConcepto;
     aDef = aPathOrigen + "def/caconcep.mas"
     |CARGA_DEF aDef, referen@;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |PATH_DAT #999 aPathAnterior;

     |ABRE #96;
     nEmpresa = 0;
     nSwGraba = 0;
     |BUCLE caconcep;
     |CIERRA #96;
     |DESCARGA_DEF #referen@;

     |SI nSwGraba = 1;  |O nEmpresa = 1; |O nSwLaFuncion = 1; |O #22#4 = "N";

         nDEmpresa = 0;
         nHEmpresa = 0;
         nDPeriodo = #98#1;
         nHPeriodo = #98#1;
         |SI nEmpresa = 1;
             nDEmpresa = #98#0;
             nHEmpresa = #98#0;
             nDPeriodo = #98#1;
             nHPeriodo = #98#1;
         |SINO;
             nSwLaFuncion = 0;
         |FINSI;

         aDef = aPathOrigen + "def/calibros.mas"
         |CARGA_DEF aDef, referen@;
         |SI FSalida ! 0;  |ACABA;  |FINSI;

         |PATH_DAT #999 aPathAnterior;

         |PUSHV  0501 2380
         |PARA; |SI; |HACIENDO;
              |ENTLINEAL #1#96, -3, 4, 22, 1, ClaveBaja96, ClaveAlta96;
              |CONFI "0000NLos Conceptos estan Correctos ";
              |SI FSalida = 0;  |SAL;  |FINSI;
         |SIGUE;
         |POPV;

         |DESCARGA_DEF #referen@;
     |FINSI;

     |HAZ TrataCambio;

     ||BUCLE dspase96B;

|FPRC;
|| ________________________________________________________________________
|| Comprobacion y Copia de Fichero con otro Nombre (Analitica)
|| ________________________________________________________________________

|PROCESO RastreoAna;
  aFicheroDestino = "";
  |SI aFicheroOrigen = "cactaana.dat"; aFicheroDestino = "anm00001.dat"; |FINSI;
  |SI aFicheroOrigen = "cagruanc.dat"; aFicheroDestino = "anm00002.dat"; |FINSI;
  |SI aFicheroOrigen = "cagruanl.dat"; aFicheroDestino = "anm00003.dat"; |FINSI;
  |SI aFicheroOrigen = "caanamay.dat"; aFicheroDestino = "anm00004.dat"; |FINSI;
  |SI aFicheroOrigen = "caseleca.dat"; aFicheroDestino = "anm00005.dat"; |FINSI;
  |SI aFicheroOrigen = "caseleli.dat"; aFicheroDestino = "anm00006.dat"; |FINSI;
  |SI aFicheroOrigen = "cacueana.dat"; aFicheroDestino = "anm00007.dat"; |FINSI;
  |SI aFicheroOrigen = "canempan.dat"; aFicheroDestino = "anm00008.dat"; |FINSI;
  |SI aFicheroOrigen = "canempav.dat"; aFicheroDestino = "anm00009.dat"; |FINSI;

  |SI aFicheroDestino ! "";
         aFichero = aFicheroOrigen;              |QBF aFichero;
         aOrigen  = aDirFichOrigen  + aFichero;  |QBF aOrigen;

         aFichero = aFicheroDestino;             |QBF aFichero;
         aDestino = aDirFichDestino + aFichero;  |QBF aDestino;
         |COPIA_FICHERO aOrigen, aDestino;

         aFichero = aFicheroOrigen;              |QBF aFichero;
         aFichero = aFichero - ".dat" + ".ddx";
         aOrigen  = aDirFichOrigen  + aFichero;  |QBF aOrigen;

         aFichero = aFicheroDestino;             |QBF aFichero;
         aFichero = aFichero - ".dat" + ".ddx";
         aDestino = aDirFichDestino + aFichero;  |QBF aDestino;
         |COPIA_FICHERO aOrigen, aDestino;

         aFichero = aFicheroOrigen;              |QBF aFichero;
         aFichero = aFichero - ".dat" + ".ixx";
         aOrigen  = aDirFichOrigen  + aFichero;  |QBF aOrigen;

         aFichero = aFicheroDestino;              |QBF aFichero;
         aFichero = aFichero - ".dat" + ".ixx";
         aDestino = aDirFichDestino + aFichero;  |QBF aDestino;
         |COPIA_FICHERO aOrigen, aDestino;

         #4#0 = aFicheroDestino;  ||Para Rastreo
  |FINSI;
|FPRC;
|| ________________________________________________________________________
|| Comprobacion del .mas del fichero a traspasar para su posible copia o no.
|| ________________________________________________________________________

|PROCESO Rastreo;
     nSwCopiar = 0;
     aFichero  = #4#0;  |QBF aFichero;
     aFichero  = aFichero - ".dat" + ".mas";
     aDef      = aPathDestino + "def/" + aFichero;
     |CARGA_DEF aDef, referen@;
     |SI FSalida ! 0;  nSwCopiar = 1;  |ACABA;  |FINSI;

     |PATH_DAT #999 aDirFichDestino;

     |ABRE #999;
     |LEE 040#999p;
     |SI FSalida = 0;  nSwCopiar = 1;  |FINSI;
     |CIERRA #999;

     |SI nSwCopiar = 0;  |DELINDEX #999;   |FINSI;

     |DESCARGA_DEF #referen@;
|FPRC;

|| ________________________________________________________________________
|| Copiado de los ficheros
|| ________________________________________________________________________

|PROCESO Copiar;
     nSwCopiar = 0;
     |SI nSwEsFichero = 1;
         |HAZ Rastreo;
         |SI nSwCopiar = 1; |HAZ RastreoAna; |FINSI;
     |FINSI;
     |SI nSwCopiar    = 1;  |ACABA;        |FINSI;

     |SI nSwEsFichero = 1;
         aFichero = #4#0;                        |QBF aFichero;
         aOrigen  = aDirFichOrigen  + aFichero;  |QBF aOrigen;
         aDestino = aDirFichDestino + aFichero;  |QBF aDestino;
         |COPIA_FICHERO aOrigen, aDestino;

         aFichero = #4#0;                        |QBF aFichero;
         aFichero = aFichero - ".dat" + ".ddx";
         aOrigen  = aDirFichOrigen  + aFichero;  |QBF aOrigen;
         aDestino = aDirFichDestino + aFichero;  |QBF aDestino;
         |COPIA_FICHERO aOrigen, aDestino;

         aFichero = #4#0;                        |QBF aFichero;
         aFichero = aFichero - ".dat" + ".ixx";
         aOrigen  = aDirFichOrigen  + aFichero;  |QBF aOrigen;
         aDestino = aDirFichDestino + aFichero;  |QBF aDestino;
         |COPIA_FICHERO aOrigen, aDestino;
     |SINO;
         aOrigen  = aDirFichOrigen  + #4#0;   |QBF aOrigen;
         aDestino = aDirFichDestino + #4#0;   |QBF aDestino;
         |COPIA_FICHERO aOrigen, aDestino;
     |FINSI;
|FPRC;

|| ________________________________________________________________________
|| DIR del directorio origen para su traspaso al directorio destino
|| ________________________________________________________________________

|PROCESO HazElDir;
     aDirFichOrigen  = aPathAnterior;
     aDirFichDestino = aPathDestino + "fich/" + aDirEmpresaN;

     nSwEsFichero   = 1;
     aDirecBuscar = aPathAnterior + "*.dat";
     |_PDIR aDirecBuscar;
     |PARA; |SI FSalida = 0; |HACIENDO;
            aFicheroOrigen = aDirecBuscar - aPathAnterior;

            |SI aFicheroOrigen ! "canempre.dat";
                #4#0 = aFicheroOrigen;
                |SI aFicheroOrigen = "camaasic.dat";
                 |O aFicheroOrigen = "camaasil.dat";
                 |O aFicheroOrigen = "casieali.dat";
                 |O aFicheroOrigen = "caivaasi.dat";
                 |O aFicheroOrigen = "camautoc.dat";
                 |O aFicheroOrigen = "capasven.dat";
                 |O aFicheroOrigen = "carecufe.dat";
                 |O aFicheroOrigen = "ca8ctrle.dat";
                 |O aFicheroOrigen = "caportad.dat";
                 |O aFicheroOrigen = "cpcuesal.dat";
                 |O aFicheroOrigen = "n43saldo.dat";
                 |O aFicheroOrigen = "caclipro.dat";
                 |O aFicheroOrigen = "camacc01.dat";
                 |O aFicheroOrigen = "camacc02.dat";
                 |O aFicheroOrigen = "camacc12.dat";
                 |O aFicheroOrigen = "casiim01.dat";
                 |O aFicheroOrigen = "casiim02.dat";
                 |O aFicheroOrigen = "cacreano.dat";
                 |O aFicheroOrigen = "caxcontr.dat";
                 |O aFicheroOrigen = "catmp500.dat";
                    |HAZ TrataEspeciales;
                |SINO;
                    |HAZ Copiar;
                    |HAZ Rastreo;
                |FINSI;
            |FINSI;

            |_SDIR aDirecBuscar;
     |SIGUE;

     nSwEsFichero   = 0;
     aDirecBuscar = aPathAnterior + "lis*.*";
     |_PDIR aDirecBuscar;
     |PARA; |SI FSalida = 0; |HACIENDO;
            aFicheroOrigen = aDirecBuscar - aPathAnterior;
            #4#0 = aFicheroOrigen;

            |HAZ Copiar;

            |_SDIR aDirecBuscar;
     |SIGUE;
|FPRC;

|PROCESO CopiaPatron;
     aOrigen  = aDirFichPatron  + aFichero + ".dat";
     aDestino = aDirFichDestino + aFichero + ".dat";
     |COPIA_FICHERO aOrigen, aDestino;

     aOrigen  = aDirFichPatron  + aFichero + ".ddx";
     aDestino = aDirFichDestino + aFichero + ".ddx";
     |COPIA_FICHERO aOrigen, aDestino;

     aOrigen  = aDirFichPatron  + aFichero + ".ixx";
     aDestino = aDirFichDestino + aFichero + ".ixx";
     |COPIA_FICHERO aOrigen, aDestino;
|FPRC;

|PROCESO CopiaPatrones;
     |ABRE #100;
     |LEE 040#100p;
     |SI FSalida ! 0;
         |CIERRA #100;
         |ACABA;
     |FINSI;
     |CIERRA #100;

     aDirFichPatron  = aPathDestino + "fich/" + (("00000" + #100#4) % -105) + #100#5 + "/";
     aDirFichDestino = aPathDestino + "fich/" + aDirEmpresaN;

     aFichero = "camauto0";  |HAZ CopiaPatron;
     aFichero = "camauto1";  |HAZ CopiaPatron;
     aFichero = "camautoc";  |HAZ CopiaPatron;
     aFichero = "camautol";  |HAZ CopiaPatron;
     aFichero = "camautli";  |HAZ CopiaPatron;
     aFichero = "camautti";  |HAZ CopiaPatron;
     aFichero = "cadeflab";  |HAZ CopiaPatron;
     aFichero = "cadeflal";  |HAZ CopiaPatron;
||     aFichero = "caivaasi";  |HAZ CopiaPatron;
|FPRC;

|| ________________________________________________________________________
||  Tratamiento especial del Camaasic, Camaasil y casieali
|| ________________________________________________________________________
|PROCESO camanban;
  #998#0 = #996#0;
  |LEE 101#998=;
  |SI FSalida ! 0;
      |DDEFECTO #998;
      #998#0 = #996#0;
      |GRABA 020#998b;
  |FINSI;
  #998#1 = #996#1;
  aAlfa = #996#9; |QBF aAlfa;
  #998#2 = aAlfa % 104;
  #998#3 = aAlfa % 504;
  #998#4 = aAlfa % 902;
  #998#5 = #996#8;
  #998#6 = #996#10;
  #998#7 = #996#11;

  |DDEFECTO #999;
  #999#0 = #996#8;
  |LEE 001#999=;

  #998#11 = #999#1;
  #998#12 = #999#2;

  |GRABA 020#998a;
  |LIBERA #998;
|FPRC;

|DEFBUCLE camanban;
    #996#1001;
    ;
    001;
    999;
    ;
    NULL, camanban;
|FIN;

|PROCESO EspCpcuesal;
         aDef      = aPathOrigen + "def/camanban";
         |CARGA_DEF aDef, refeesp@;
         |SI FSalida ! 0;  |ACABA;  |FINSI;
         |PATH_DAT #996 aDirFichOrigen;
         |ABRE #999;
         |ABRE #998;
         |BUCLE camanban;  ||nuevo
         |CIERRA #998;
         |CIERRA #999;
         |DESCARGA_DEF #refeesp@;
|FPRC;

|PROCESO EspCarecufe;
  |ABRE #999;
  |DDEFECTO #999;
  |LEE 001#999p;
  |CIERRA #999;

  |DDEFECTO #998;
  |PARA nCampo = 0;  |SI nCampo [ 15;  |HACIENDO nCampo = nCampo + 1;
        #998nCampo = #999nCampo;
  |SIGUE;
  |GRABA 020#998n;
  |LIBERA #998;
|FPRC;

|PROCESO EspCamaasic;
  |DDEFECTO #998;
  |PARA nCampo = 0;  |SI nCampo [ 11;  |HACIENDO nCampo = nCampo + 1;
        #998nCampo = #999nCampo;
  |SIGUE;
  |SI nNumCampos = 12;
      #998#17 = #999nNumCampos;  ||Campo Referencia Analitica
  |FINSI;
  |GRABA 020#998n;
  |LIBERA #998;
  |LIBERA #999;
|FPRC;

|DEFBUCLE EspCamaasic;
     #999#1003;
     ;
     00, "01.01.0000", 000001;
     99, "31.12.2999", 999999;
     be;
     NULL, EspCamaasic;
|FIN;

|PROCESO EspCamaasil;
  |DDEFECTO #998;
  |PARA nCampo = 0;  |SI nCampo [ 23;  |HACIENDO nCampo = nCampo + 1;
        #998nCampo = #999nCampo;
  |SIGUE;
  |SI nNumCampos = 26;
      #998#29 = #999#24; || Campo Cuenta Analitica
      #998#26 = #999#25; || Referencia Linea
      #998#30 = #999#26; || Fecha
  |FINSI;
  |GRABA 020#998n;
  |LIBERA #998;
  |LIBERA #999;
|FPRC;

|DEFBUCLE EspCamaasil;
     #999#1004;
     ;
     00, "01.01.0000", 000001, 0000;
     99, "31.12.2999", 999999, 9999;
     be;
     NULL, EspCamaasil;
|FIN;

|PROCESO EspCasieali;
  |DDEFECTO #998;
  |PARA nCampo = 0;  |SI nCampo [ 60;  |HACIENDO nCampo = nCampo + 1;
        #998nCampo = #999nCampo;
  |SIGUE;
  #998#63 = #999#61; || Campo Cuenta Analitica
  |GRABA 020#998n;
  |LIBERA #998;
  |LIBERA #999;
|FPRC;

|DEFBUCLE EspCasieali;
     #999#1002;
     ;
     0000, 01;
     9999, 99;
     be;
     NULL, EspCasieali;
|FIN;

|PROCESO EspCaivaasi;
  |ABRE #999;
  |DDEFECTO #999;
  |LEE 001#999p;
  |CIERRA #999;

  |DDEFECTO #998;
  nHastaCampo = 46;
  |SI nNumCampos < 46; nHastaCampo = nNumCampos; |FINSI;

  |PARA nCampo = 0;  |SI nCampo [ nHastaCampo;  |HACIENDO nCampo = nCampo + 1;
        #998nCampo = #999nCampo;
  |SIGUE;

  |SI nNumCampos ] 47; #998#114 = #999#47; |FINSI;
  |SI nNumCampos ] 48; #998#97  = #999#48; |FINSI;
  |SI nNumCampos ] 49; #998#98  = #999#49; |FINSI;
  |GRABA 020#998n;
  |LIBERA #998;
|FPRC;

|PROCESO EspCapasven;
  |ABRE #999;
  |DDEFECTO #999;
  |LEE 001#999p;
  |CIERRA #999;

  |DDEFECTO #998;
  |PARA nCampo = 0;  |SI nCampo [ 24;  |HACIENDO nCampo = nCampo + 1;
        #998nCampo = #999nCampo;
  |SIGUE;
  |GRABA 020#998n;
  |LIBERA #998;
|FPRC;

|PROCESO EspCamautoc;

  aQueQuiero = "|NC";
  aNumCampos = #998#aQueQuiero#;
  nNumCampos = aNumCampos;
  nNumCampos = nNumCampos - 1;
  |DDEFECTO #998;
  |PARA nCampo = 0;  |SI nCampo [ 11;  |HACIENDO nCampo = nCampo + 1;
        #998nCampo = #999nCampo;
  |SIGUE;
  |SI nNumCampos = 26; #998#26 = #999#12; |FINSI; || Incremento
  |GRABA 020#998n;
  |LIBERA #998;
|FPRC;

|DEFBUCLE EspCamautoc;
     #999#1001;
     ;
     00001;
     99999;
     e;
     NULL, EspCamautoc;
|FIN;

|PROCESO EspCaclipro;
  |DDEFECTO #998;
  |PARA nCampo = 0;  |SI nCampo [ 28;  |HACIENDO nCampo = nCampo + 1;
        #998nCampo = #999nCampo;
  |SIGUE;

  #998#41 = #999#29;
  #998#40 = #999#30;

  #998#44 = #998#2;
  #998#45 = #998#3;
  #998#46 = #998#4;
  #998#47 = #998#5;
  #998#48 = #998#6;
  #998#49 = #998#27;
  #998#50 = #998#25;

  aAlfa = #998#17; |QBT aAlfa; #998#32 = aAlfa;
  aAlfa = #998#18; |QBT aAlfa;
  #998#29 = aAlfa % 0104;
  #998#30 = aAlfa % 0504;
  #998#31 = aAlfa % 0902;

  aAlfa = #998#10; |QBF aAlfa;
  |SI aAlfa ! "";
      |GRABA 020#998n;
  |FINSI;
  |LIBERA #998;
  |LIBERA #999;
|FPRC;

|DEFBUCLE EspCaclipro;
     #999#1003;
     ;
     " ", "            ", 0;
     "z", "999999999999", 9;
     e;
     NULL, EspCaclipro;
|FIN;

|PROCESO EspCamacc12;
  |DDEFECTO #998;
  |PARA nCampo = 0;  |SI nCampo [ 12;  |HACIENDO nCampo = nCampo + 1;
        #998nCampo = #999nCampo;
  |SIGUE;

  |GRABA 020#998n;
  |LIBERA #998;
  |LIBERA #999;
|FPRC;

|DEFBUCLE EspCamacc12;
     #999#1004;
     ;
     "R", 00, 001, 01;
     "S", 99, 999, 99;
     e;
     NULL, EspCamacc12;
|FIN;

|PROCESO EspCaxcontr;
  |ABRE #999;
  |DDEFECTO #999;
  |LEE 001#999p;
  |CIERRA #999;

  |DDEFECTO #998;
  |PARA nCampo = 0;  |SI nCampo [ 8;  |HACIENDO nCampo = nCampo + 1;
        #998nCampo = #999nCampo;
  |SIGUE;
  #998#13 = #999#9;
  #998#14 = #999#10;

  |GRABA 020#998n;
  |LIBERA #998;
|FPRC;

|PROCESO TrataEspeciales;

     |SI  aFicheroOrigen = "cpcuesal.dat";
          #4#0 = "n43saldo.dat";
     |FINSI;

     |SI  aFicheroOrigen = "ca8ctrle.dat"; |ACABA; |FINSI; ||no lo copia
     |SI  aFicheroOrigen = "caportad.dat"; |ACABA; |FINSI; ||no lo copia
     |SI  aFicheroOrigen = "camacc01.dat"; |ACABA; |FINSI; ||no lo copia
     |SI  aFicheroOrigen = "camacc02.dat"; |ACABA; |FINSI; ||no lo copia
     |SI  aFicheroOrigen = "casiim01.dat"; |ACABA; |FINSI; ||no lo copia
     |SI  aFicheroOrigen = "casiim02.dat"; |ACABA; |FINSI; ||no lo copia
     |SI  aFicheroOrigen = "catmp500.dat"; |ACABA; |FINSI; ||no lo copia
     |SI  aFicheroOrigen = "cacreano.dat"; |ACABA; |FINSI; ||no lo copia

     nSwCopiar = 0;
     aFichero  = #4#0;  |QBF aFichero;
     aFichero  = aFichero - ".dat" + ".mas";
     aDef      = aPathOrigen + "def/" + aFichero;
     |CARGA_DEF aDef, referen@;
     |SI FSalida ! 0;  nSwCopiar = 1;  |ACABA;  |FINSI;

     aQueQuiero = "|NC";
     aNumCampos = #referen@#aQueQuiero#;
     nNumCampos = aNumCampos;
     nNumCampos = nNumCampos - 1;

     nSwVale = 0;
     |SI aFicheroOrigen = "carecufe.dat"; |Y nNumCampos = 15; nSwVale = 1; |FINSI;
     |SI aFicheroOrigen = "camaasic.dat"; |Y nNumCampos = 11; nSwVale = 1; |FINSI;
     |SI aFicheroOrigen = "camaasil.dat"; |Y nNumCampos = 23; nSwVale = 1; |FINSI;
     |SI aFicheroOrigen = "caclipro.dat"; |Y nNumCampos [ 28; nSwVale = 1; |FINSI;
     |SI aFicheroOrigen = "casieali.dat";
         aQueQuiero = "|C061LONGITUD";
         aLongCampo = #referen@#aQueQuiero#;
         nLongCampo = aLongCampo;
         |SI nLongCampo < 7; nSwVale = 1; |FINSI;
     |FINSI;
     |SI aFicheroOrigen = "camautoc.dat"; |Y nNumCampos = 11; nSwVale = 1; |FINSI;
     |SI aFicheroOrigen = "capasven.dat"; |Y nNumCampos [ 24; nSwVale = 1; |FINSI;

     |SI nSwVale = 0;    || Hay cambio de estructura en Fichero Analitica
          aFichero  = #4#0;  |QBF aFichero;
          aFichero  = aFichero - ".dat" + ".mas";
          aDef      = aPathDestino + "def/" + aFichero;
          |CARGA_DEF aDef, refecon@;
          |SI FSalida = 0;
              |PATH_DAT #998 aDirFichDestino;
              |PATH_DAT #999 aDirFichOrigen;

              |ABRE #998;
              |LEE 040#998p;         || ...Si no existen datos
              |SI FSalida ! 0;
                  |SI aFicheroOrigen = "camaasic.dat"; |BUCLE EspCamaasic; |FINSI;
                  |SI aFicheroOrigen = "camaasil.dat"; |BUCLE EspCamaasil; |FINSI;
                  |SI aFicheroOrigen = "casieali.dat"; |BUCLE EspCasieali; |FINSI;
                  |SI aFicheroOrigen = "caivaasi.dat"; |HAZ   EspCaivaasi; |FINSI;
                  |SI aFicheroOrigen = "camautoc.dat"; |BUCLE EspCamautoc; |FINSI;
                  |SI aFicheroOrigen = "capasven.dat"; |HAZ   EspCapasven; |FINSI;
                  |SI aFicheroOrigen = "carecufe.dat"; |HAZ   EspCarecufe; |FINSI;
                  |SI aFicheroOrigen = "cpcuesal.dat"; |HAZ   EspCpcuesal; |FINSI;
                  |SI aFicheroOrigen = "caclipro.dat"; |BUCLE EspCaclipro; |FINSI;
                  |SI aFicheroOrigen = "camacc12.dat"; |BUCLE EspCamacc12; |FINSI;
                  |SI aFicheroOrigen = "caxcontr.dat"; |HAZ   EspCaxcontr; |FINSI;
              |FINSI;
              |CIERRA #998;
              |DESCARGA_DEF #refecon@;
          |FINSI;
          |DESCARGA_DEF #referen@;
     |SINO;
          |DESCARGA_DEF #referen@;
          |HAZ Copiar;
          |HAZ Rastreo;
     |FINSI;
|FPRC;

|| ________________________________________________________________________
|| Aplicacion Contabilidad
|| ________________________________________________________________________
|PROCESO RepasoCtrl8;
   #997#2 = #400#0;
   #997#3 = #400#1;
   |LEE 041#997=;
   |SI FSalida ! 0;
       |BORRA 020#400a;
   |SINO;
       |SI #997#26 = 8;
           |SELECT #4#997;
           #997#26 = 7;
           |LEE 041#997=;
           |SI FSalida = 0;
               #400#4 = #997#3;
               |GRABA 020#400a;
           |FINSI;
      |FINSI;
   |FINSI;
   |LIBERA #400;
   |SELECT #1#997;
|FPRC;

|DEFBUCLE RepasoCtrl8;
     #400#1;
     ;
     #dspase12#5, 0;
     #dspase12#5, 9;
     be;
     NULL, RepasoCtrl8;
|FIN;

|PROCESO AltaTitulEmp;
     aAlfa = #997#29;  |QBF aAlfa;
     |SI aAlfa = "";
         |ABRE #114;
         #114#0 = #997#2;
         #114#1 = 1;
         |LEE 040#114];
         |SI FSalida ! 0;  |O #114#0 ! #997#2;
             |DDEFECTO #114;
         |FINSI;
         |CIERRA #114;

         |SI #997#26 ] 80;
             nNume = 1900 + #997#26;
         |SINO;
             nNume = 2000 + #997#26;
         |FINSI;

         aAlfa1 = #997#1;   |QBF aAlfa1;
         aAlfa2 = #114#8;   |QBF aAlfa2;
         aAlfa3 = #114#10;  |QBF aAlfa3;
         aAlfa =  "[" + (("00000" + #997#2) % -105) + "/" + nNume + "] " + aAlfa1 + " " + aAlfa2 + " " + aAlfa3;

         #997#29 = aAlfa;
         #997#27 = "N";
         #997#24 = "S"; #98#7 = "S";
         #997#22 = "N";
         |GRABA 020#997a;
      |FINSI;
|FPRC;

|PROCESO RepasoMoneda;
   #999#0 = #997#2;
   #999#1 = #997#3;
   |LEE 001#999=;
   |SI FSalida = 0;
       #997#28 = #999#2;
       |GRABA 020#997a;
   |FINSI;
   |LIBERA #997;
|FPRC;

|DEFBUCLE RepasoMoneda;
     #997#1002;
     ;
     00000, 0;
     99999, 9;
     be;
     NULL, RepasoMoneda;
|FIN;
|| /////////////////////////////////////////////////////////////////
|PROCESO CreaEmpresaCon;

     aDirFichDestino = aPathDestino + "fich/";
     aDirEmpresaN    = (("00000" + #98#0) % -105) + #98#8 + "/";
     aDirEmpresaV    = (("00000" + #98#6) % -105) + #98#1 + "/";
     aDirFichDestino = aDirFichDestino + aDirEmpresaN;
     |MKDIR aDirFichDestino;

     aPathOrigen     = #4#12;  |QBF aPathOrigen;
     aPathOrigen     = aPathOrigen + "agicont/";
     aPathAnterior   = aPathOrigen + "fich/" + aDirEmpresaV;
     aPathDestino    = eaPathContagen - "fich/";

|SI #4#14 ! "X";
     |HAZ HazElDir;
     |HAZ CopiaPatrones;

     eaAplica      = "contagen";
     eaEmpresa     = aDirEmpresaN;
     |HAZ GrabaMoneda;
     |HAZ Graba8Ctrle;
|FINSI;

     enEmpresa  = #98#0;
     enEmpresaV = #98#6;
     enPeriodo  = #98#8;
     enPeriodoV = #98#1;
     enEjerConta = #98#2;
|SI #4#14 ! "X";
     aAlfa      = ":contagen/capasiva;" + #4#12;  |QBT aAlfa;
     |SUB_EJECUTA_NP aAlfa;
     aAlfa      = ":contagen/capasasf;" + #4#12;  |QBT aAlfa;
     |SUB_EJECUTA_NP aAlfa;
|FINSI;

|SI #4#14 ! "N";
     aAlfa     = ":contagen/capastiz;" + #4#12;  |QBT aAlfa;
     |SUB_EJECUTA_NP aAlfa;
|FINSI;

|SI #4#14 ! "X";
     |SI #98#7 = "N";
         aAlfa     = ":contagen/capasdep;" + #4#12;  |QBT aAlfa;
         |SUB_EJECUTA_NP aAlfa;
     |FINSI;

     aAlfa     = ":contagen/capasact;" + #4#12;  |QBT aAlfa;
     |SUB_EJECUTA_NP aAlfa;

     aAlfa     = ":contagen/capasnif;" + #4#12;  |QBT aAlfa;
     |SUB_EJECUTA_NP aAlfa;

     |SI #98#5 = "S";
         |HAZ CambiaConcepto;
     |FINSI;

     eSwCambio = 0;
     aAlfa      = ":contagen/capasz03;" + #4#12;  |QBT aAlfa;
     |SUB_EJECUTA_NP aAlfa;

     aAlfa      = ":contagen/capasy01;" + #4#12;  |QBT aAlfa;
     |SUB_EJECUTA_NP aAlfa;
     aAlfa      = ":contagen/capasy02;" + #4#12;  |QBT aAlfa;
     |SUB_EJECUTA_NP aAlfa;

|FINSI;

     |SI #4#15 = "S";
         eaPPortadaX = aPathOrigen;
         eaPPortadaO = aPathAnterior;
         eaPPortadaD = aDirFichDestino;
         |HAZ PaseDePortada;
     |FINSI;
|FPRC;

|| --------------------------------------------------------------
|PROCESO Borrado;
     aDirEmpresaN    = (("00000" + #4#5) % -105) + #4#6 + "/";
     aDirFichDestino = aPathDestino + "fich/" + aDirEmpresaN;

     aDirecBuscar = aDirFichDestino + "*";
     |_PDIR aDirecBuscar;
     |PARA; |SI FSalida = 0; |HACIENDO;
            |FBORRA aDirecBuscar;

            |_SDIR aDirecBuscar;
     |SIGUE;

     |RMDIR aDirFichDestino;
|FPRC;
|| --------------------------------------------------------------

|PROCESO Contagen;

     nSwAplicacion   = 7;
     aDirEmpresaN    = "";
     aDirEmpresaV    = "";
     aPathOrigen     = #4#12;  |QBF aPathOrigen;
     aPathOrigen     = aPathOrigen + "agicont/";
     aPathAnterior   = aPathOrigen + "fich/";
     aPathDestino    = eaPathContagen - "fich/";

     aDef            = aPathOrigen + "def/canempre";
     |CARGA_DEF aDef, refecon@;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     aDef            = aPathDestino + "def/canempre";
     aDirFichDestino = aPathDestino + "fich/";
     |CARGA_DEF aDef, refebue@;
     |SI FSalida ! 0;
         |DESCARGA_DEF #refecon@;
         |ACABA;
     |FINSI;

     |PATH_DAT #998 aPathAnterior;
     |PATH_DAT #997 aDirFichDestino;


     |ABRE #998;
     |DDEFECTO #998;
     #998#2 = #4#1;
     #998#3 = #4#2;
     |LEE 001#998=;
     |SI FSalida ! 0;
         |MENAV "    No existe Empresa Origen";
         |CIERRA #998;
         |DESCARGA_DEF #refebue@;
         |DESCARGA_DEF #refecon@;
         |ACABA;
     |FINSI;
     |CIERRA #998;

     nCodigoNue = #4#5;
     nPerioNue  = #4#6;

     |ABRE #997;
     #997#2 = nCodigoNue;
     #997#3 = nPerioNue;
     |LEE 101#997=;
     |SI FSalida ! 0;
         |DDEFECTO #997;
         |PARA nCampo = 0;  |SI nCampo [ 26;  |HACIENDO nCampo = nCampo + 1;
               #997nCampo = #998nCampo;
         |SIGUE;

         #997#2  = nCodigoNue;
         #997#3  = nPerioNue;
         nNume   = (nCodigoNue * 10) + #997#3;
         #997#0  = nNume;
         #997#22 = "N";
         |GRABA 020#997b;
     |FINSI;

     |PARA nCampo = 11;  |SI nCampo [ 19;  |HACIENDO nCampo = nCampo + 1;
           #997nCampo = #998nCampo;
     |SIGUE;

     |SI #997#21 = "S";   #997#21 = "A";  |FINSI;  ||Activa o inactiva
     |SI #997#21 = "N";   #997#21 = "A";  |FINSI;

     aAlfa = #997#29;  |QBF aAlfa;
     |SI aAlfa = "";
         |ABRE #114;
         #114#0 = #997#2;
         #114#1 = 1;
         |LEE 040#114];
         |SI FSalida ! 0;  |O #114#0 ! #997#2;
             |DDEFECTO #114;
         |FINSI;
         |CIERRA #114;

         |SI #997#26 ] 80;
             nNume = 1900 + #997#26;
         |SINO;
             nNume = 2000 + #997#26;
         |FINSI;

         aAlfa1 = #997#1;   |QBF aAlfa1;
         aAlfa2 = #114#8;   |QBF aAlfa2;
         aAlfa3 = #114#10;  |QBF aAlfa3;
         aAlfa =  "[" + (("00000" + #997#2) % -105) + "/" + nNume + "] " + aAlfa1 + " " + aAlfa2 + " " + aAlfa3;

         #997#29 = aAlfa;
         #997#27 = "N";
         #997#24 = "S";
         #997#22 = "N";
      |FINSI;

      |GRABA 020#997a;
      |LIBERA #997;

      aDirFichDestino = aPathDestino + "fich/" + (("00000" + #997#2) % -105) + #997#3 + "/";

      |SI #4#14 ! "X";
          aAbre           = aDirFichDestino + "cacuenta.dat";
          |||MKDIR aDirFichDestino;
          |XABRE "E", aAbre, nHandle;
          |SI FSalida ] 0;
              |HAZ Borrado;
          |FINSI;
      |FINSI;

      |DDEFECTO #98;
      #98#0  = #997#2;   || Nueva Empresa
      #98#1  = #998#3;   || Periodo Original
      #98#2  = #997#26;
      #98#3  = #997#1;
      #98#4  = "S";
      #98#5  = #4#9;
      #98#6  = #998#2;   || Empresa Original
      #98#7  = #4#10;
      #98#8  = #997#3;   || Nuevo Periodo
      #98#9  = #dspase12#14;   || Pasada Amortizaciones
      #98#10 = #dspase12#16;   || Pasada Cartera

      |CIERRA #997;

      nTContab        = 0;
      nEmprePasada    = 0;
      nTAcum          = 0;

     |DESCARGA_DEF #refebue@;
     |DESCARGA_DEF #refecon@;

     |HAZ CreaEmpresaCon;

     |SI #4#14 = "X"; |ACABA; |FINSI;

|| ... Repaso Moneda
     aDef            = aPathDestino + "def/canempre";
     aDirFichDestino = aPathDestino + "fich/";
     |CARGA_DEF aDef, refebue@;
     |SI FSalida ! 0;  |ACABA; |FINSI;
     |PATH_DAT #997 aDirFichDestino;

     aDef = aPathDestino + "def/camoneda.mas";
     |CARGA_DEF aDef, referen@;
     |SI FSalida ! 0;
         |DESCARGA_DEF #refebue@;
         |ACABA;
     |FINSI;

     |ABRE #999;
     |BUCLE RepasoMoneda;
     |CIERRA #999;
     |DESCARGA_DEF #referen@;

     |ABRE #997;
     |BUCLE RepasoCtrl8;
     |CIERRA #997;


     |DESCARGA_DEF #refebue@;
|FPRC;

|PROCESO DsCarter;

     |SI #dspase12#16 = "S";
         nSwExiste = 0;
         |ABRE #emcarte@;
         #emcarte@#0 = #dspase12#17;
         |LEE 011#emcarte@.=;
         |SI FSalida = 0;
              nSwExiste = 1;
              #emcarte@#14 = enEmpresa;
              #emcarte@#19 = enPeriodo;
              |GRABA 040#emcarte@.a;
         |FINSI;
         |LIBERA #emcarte@;
         |CIERRA #emcarte@;

         enEmpCartera = #dspase12#17;
         eaDirAgicont = #dspase12#12;  |QBF eaDirAgicont;
         eaDirAgicont = eaDirAgicont + "agicont/";
         enEmpAgicont = #dspase12#1;
         enPerAgicont = #dspase12#2;

         enERP = 1;
         |SI nSwExiste = 0;
             |SUB_EJECUTA_NP ":dscarter/dscab000";
         |FINSI;
         aAlfa1 = ("00000" + enEmpCartera) % -105;
         aAlfa1 = ":dscarter/dscaz024 dscam005 " + aAlfa1 + ";" + aParam;
         |SUB_EJECUTA aAlfa1;
         enERP = 0;
     |FINSI;
|FPRC;
|| ________________________________________________________________________

|PROCESO Tipo12;  |TIPO 12;
|FPRC;

|PROGRAMA;

     |ABRE #0;
     |LEE 040#0p;
     |CIERRA #0;

     |ABRE #22;
     |LEE 040#22p;
     |CIERRA #22;

     aParam     = "basica";
     eaPreg22_7 = #22#7;
     eaPreg22_1 = "N";  || para que pregunte Siempre de una en una
     eaPreg22_2 = "N";  || en este proceso
     eaPreg22_6 = #22#6;
     eaPreg22_8 = #22#8;
     eaPreg22_5 = #22#5;  ||Imprimir Errores

     |ABRE #15;
     |DDEFECTO #15;
     |LEE 040#15p;
     |SI FSalida ! 0;
         nEstaCambio = 0;
     |SINO;
         nEstaCambio = 1;
         |SI #15#15 ! "S"; nEstaCambio = 0; |FINSI;
     |FINSI;
     |CIERRA #15;

     |HAZ BusquedaApli;
     aPathDestino    = eaPathContagen - "fich/";
     |SI eaPathContagen = "";
         |MENAV "    Error, no existe Contagen. Proceso Abortado";
         |ACABA;
     |FINSI;

     |CLS;
     |CABEZA "     Pase de Ficheros Contabilidad";

     |PINPA #0#4;

     |SI eaPathDscarter ! "";
         aDef = eaPathDscarter + "def/dscam000.mas";
         |CARGA_DEF aDef, emcarte@;
         |SI FSalida = 0;
             |PINTA 1907, "Cargar Datos a la Cartera desde Star3:     Empresa Cartera:        ";
             |C_V #dspase12#16, 1, "S"; |C_M #dspase12#16, 1, "S";
             |C_V #dspase12#17, 1, "S"; |C_M #dspase12#17, 1, "S";

             aPathCartera = eaPathDscarter + "fich/";
             |PATH_DAT #emcarte@#aPathCartera#;
         |SINO;
             eaPathDscarter = "";
         |FINSI;
     |FINSI;

     #4#12  = #0#0;
     |PINDA #0#4;

     |ET Pido;
     |C_M #4#12, 1, "S";
     |C_M #4#13, 1, "S";

     |ENCAMPO #13#4;
     |SI FSalida = 7; |O nSwError = 1; |HAZ DesCargaDef; |ACABA; |FINSI;
     |ENCAMPO #12#4;
     |SI FSalida = 7; |O nSwError = 1; |HAZ DesCargaDef; |ACABA; |FINSI;
     |SI nSwLocal = 2; |VETE Pido; |FINSI;


     |ENDATOS #1#4;
     |SI FSalida ! 0;   |HAZ DesCargaDef; |ACABA;  |FINSI;
     |SI #4#11 ! "SI";  |HAZ DesCargaDef; |ACABA;  |FINSI;

     |SI #4#13 = "S"; |Y nSwLocal = 0;
         |HAZ TraeEmpresa;
     |FINSI;

     |DBASE aBase;  |QBF aBase;
     aPathPases = aBase + "pases";  |MKDIR aPathPases;
     aPathPases = aPathPases + "/";

     |PATH_DAT #96 aPathPases;
     |PATH_DAT #97 aPathPases;

     |ABRE #96;
     |LEE 040#96p;
     |SI FSalida ! 0;
         |CIERRA #96;
         aOrigen  = aBase + "fich/dspase96.dat";
         aDestino = aPathPases + "dspase96.dat";
         |COPIA_FICHERO aOrigen, aDestino;
     |FINSI;
     |CIERRA #96;

     |ABRE #97;
     |LEE 040#97p;
     |SI FSalida ! 0;
         |CIERRA #97;
         aOrigen  = aBase + "fich/dspase97.dat";
         aDestino = aPathPases + "dspase97.dat";
         |COPIA_FICHERO aOrigen, aDestino;
     |FINSI;
     |CIERRA #97;

     |HAZ DesCargaDef;
     |HAZ Contagen;

     |SI eaPathDscarter ! "";
         |HAZ DsCarter;
         |DESCARGA_DEF #emcarte@;
     |FINSI;

     |SI #4#13 = "S"; |HAZ LimpioAuxi; |FINSI;
|FPRO;

|| *************************************************************************
|PROCESO DesCargaDef;
     |SI aDef330 ! "";   |DESCARGA_DEF #canempr@; aDef330 = ""; |FINSI;
|FPRC;

|PROCESO CargaEmpAgicont;
     nSwError = 0;
     aMensa   = "";
     nSwLocal = 0;

     aDirBase = #4#12; |QBF aDirBase;
     |SI #4#13 = "S";
         aBasLocal = aDirBase;
         |HAZ TraeAplic;
         #4#12 = aDirBase;
     |FINSI;

     |SI nSwLocal = 2; |ACABA; |FINSI;

     aPathDef = aDirBase + "agicont/def/";

     aDef330 = aPathDef + "canempre";
     |CARGA_DEF aDef330, canempr@;
     |SI FSalida ! 0;
         aMensa   = "    Error en:" + aDef330;
         aDef330  = "";
         nSwError = 1;
         |ACABA;
     |FINSI;
|FPRC;

|| ---------------- Nuevo

|PROCESO LimpioAuxi;
   |MENSA "0000Borrando Datos Auxiliares. Espere, por favor...";

   aDirEmpresaV = (("00000" + #4#1) % -105) + #4#2 + "/";
   aPath = aDirBase + "agicont/fich/" + aDirEmpresaV;
   |HAZ PreparaDir;
   aPath = aDirBase + "agicont/fich/000000/";
   |HAZ PreparaDir;
   aPath = aDirBase + "agicont/fich/";
   |HAZ PreparaDir;
   aPath = aDirBase + "agicont/def/";
   |HAZ PreparaDir;
   aPath = aDirBase + "agicont/"
   |HAZ PreparaDir;

   |BLIN 4;
|FPRC;

|PROCESO PreparaDir;
  aDirTempo  = aPath + "*";
  |_PDIR aDirTempo;
  |PARA; |SI; |HACIENDO;
         |SI FSalida ! 0; |SAL; |FINSI;

         |FBORRA aDirTempo;
         |_SDIR aDirTempo;
  |SIGUE;
|FPRC;

|PROCESO TraeAplic;
   |MENSA "0000Traspasando aplicacion. Espere, por favor...";

   nSwLocal = 0;
   |DBASS aBase;
   aAlfa1 = #4#12; |QBF aAlfa1;
   |SI aBase = aAlfa1;
       #4#13 = "N"; |PINTA #4#13;
       aBasLocal = "";
       nSwLocal = 1;
       |ACABA;
   |FINSI;

   aIPRemoto = "";
   |IP_REMOTO aIPRemoto;  |QBT aIPRemoto;
   |SI aIPRemoto =  "";
       aBasLocal = "";
       #4#13     = "N"; |PINTA #4#13;
       nSwLocal  = 1;
       |ACABA;
   |FINSI;

   |HAZ VeoPosible;
   |SI nSwLocal ! 0; |ACABA; |FINSI;

   aPath = aBase + "star3/agicont"
   |MKDIR aPath;
   aPath = aPath + "/";
   |HAZ PreparaDir;

   aPath = aBase + "star3/agicont/def";
   |MKDIR aPath;
   aPath = aPath + "/";
   |HAZ PreparaDir;

   aPath = aBase + "star3/agicont/fich";
   |MKDIR aPath;
   aPath = aPath + "/";
   |HAZ PreparaDir;


|| Paso Datos desde C al Servidor
   aPath = aBase + "star3/";
   aDirBase = aPath;

   aDirOrigen  = aBasLocal + "agicont/def/";
   aDirDestino = aPath     + "agicont/def/";
   aAlfa = "mas";  |HAZ PasaFicheros;

   aDirOrigen = aBasLocal + "agicont/fich/";
   aDirDestino = aPath    + "agicont/fich/";
   aAlfa = "dat";  |HAZ PasaFicheros;

   |BLIN 4;
|FPRC;

|PROCESO TraeEmpresa;
   |MENSA "0000Traspasando datos Empresa. Espere, por favor...";

   |SI aBasLocal = ""; |ACABA; |FINSI;

   aPath = aDirBase + "agicont/fich/000000"
   |MKDIR aPath;
   aPath = aPath + "/";
   |HAZ PreparaDir;

   aDirEmpresaV = (("00000" + #4#1) % -105) + #4#2;
   aPath = aDirBase + "agicont/fich/" + aDirEmpresaV;
   |MKDIR aPath;
   aPath = aPath + "/";
   |HAZ PreparaDir;

|| Paso Datos desde C al Servidor de la Empresa

   aDirOrigen  = aBasLocal + "agicont/fich/000000/";
   aDirDestino = aDirBase  + "agicont/fich/000000/";
   aAlfa = "dat";  |HAZ PasaFicheros;

   aDirEmpresaV = aDirEmpresaV + "/";
   aDirOrigen  = aBasLocal + "agicont/fich/" + aDirEmpresaV;
   aDirDestino = aDirBase  + "agicont/fich/" + aDirEmpresaV;
   aAlfa = "dat";  |HAZ PasaFicheros;

   |HAZ PreparaDir_local;
   |BLIN 4;
|FPRC;

|PROCESO VeoPosible;
  nSwLocal = 2;
  aDirTempo  = aBasLocal + "agicont/fich/";
  |R_PDIR aDirTempo;
  |SI FSalida = 0;
      nSwLocal = 0;
  |SINO;
      |_PDIR aDirTempo;
      |SI FSalida = 0; nSwLocal = 1; |FINSI;
  |FINSI;
  |SI nSwLocal = 1; aBasLocal = ""; #4#13 = "N"; |PINTA #4#13; |FINSI;
  |SI nSwLocal = 2;
      |MENAV "    ERROR. NO EXISTEN DATOS EN EL DIRECTORIO INDICADO";
  |FINSI;
|FPRC;

|PROCESO CopiaFichero;
     aIPRemoto = "";
     |IP_REMOTO aIPRemoto;  |QBT aIPRemoto;
     |SI aIPRemoto ! "";
         |RECIBE_FICHERO aOrigen, aDestino;
     |SINO;
         |COPIA_FICHERO aOrigen, aDestino;
     |FINSI;
|FPRC;

|PROCESO PreparaDir_local;  || Borra directorio recdatos y quidatos
  aAlfa1 =  aBasLocal + "agicont/pase12"
  |RMKDIR aAlfa1;
  aPathRec   = aAlfa1 + "/";
  aDirTempo  = aPathRec + "*";
  |R_PDIR aDirTempo;
  |PARA; |SI; |HACIENDO;
         |SI FSalida ! 0; |SAL; |FINSI;

         |RFBORRA aDirTempo;
         |R_SDIR aDirTempo;
  |SIGUE;
|FPRC;

|PROCESO PasaFicheros;

   |HAZ PreparaDir_local;

   aFich    = "zLaStar3";
   |SI aAlfa ! "dat";
       aFichTar = aPathRec + aFich + ".tar *." + aAlfa;
   |SINO;
       aFichTar = aPathRec + aFich + ".tar *.dat *.ixx *.ddx";
   |FINSI;

   aOrigen = aDirOrigen;
   |RATAR aFichTar, aOrigen;

   aFichTar  = aPathRec + aFich + ".tar";
   |RCOMPRIME aFichTar;

   |RFBORRA aFichTar;

   aOrigen  = aPathRec + aFich + ".tgz";
   aDestino = aDirDestino + aFich + ".tgz";
   |HAZ CopiaFichero;

   aFichTar   = aDestino;
   |DESCOMPRIME aFichTar;
   |SI FSalida = 0;
        aFichTar  = aDirDestino + aFich + ".tar";
        |DETAR aFichTar, aDirDestino;
        |FBORRA aFichTar;

        aFichTar   = aDestino;
        |FBORRA aFichTar;
   |FINSI;
|FPRC;
