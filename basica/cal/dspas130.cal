|FICHEROS;
     dspase03;
     dspase15;
     dspase99;

     agicen14;
     agitab12;
     agitab99;

     :/modelos/def/dsmom004;
     :/modelos/def/dsmom001;
     :/modelos/def/dsmom002;
     :/modelos/def/dsmoc130;
     :/modelos/def/dsmom093;
     :/modelos/def/dsmom094;

     dspase25;

     refer00@;
     refer01@;
     refer02@;
     refer03@;
     refer04@;
|FIN;

|VARIABLES;
      aDef           = "";
      aFich          = "";
      aAlfa          = "";

      nCodigoNue     = 0;
      nCodigoReo     = 0;
      nCodigoCont    = 0;
      nCampoAct      = 0;
      nCampoAgr      = 0;
      nCampoCuo      = 0;
      nCampoRdt      = 0;
      nCampoPor      = 0;
      nCampoCom      = 0;
      nAnyo          = 0;
      nPeriodo       = 0;
      nModelo        = 0;
      nSuma          = 0;

      fFecha         = @;

     &enModelo       = 0;
     &enEstaCambio   = 0;
     &enEmpresa      = 0;
     &enEmpresaA     = 0;
     &enEjercicioA   = 0;
     &enPeriodoA     = 0;
     &enAnyo         = 0;
     &enSwEstar      = 0;
     &enEjer         = 0;
     &enPeriodo      = 0;
     &enComplem      = 0;
     &enActividad    = 0;
     &enTipoEntrada  = 0;
     &eaComunidad    = "";
     &eaArchiva      = "";
     &efFechaI       = @;
     &enDEmpresa     = 0;
     &enHEmpresa     = 0;

     &eaPathAnterior = "";
     &eaPathBasica   = "";
     &eaPathContagen = "";
     &eaPathContanex = "";
     &eaPathContasoc = "";
     &eaPathRen2000  = "";
     &eaPathRen1999  = "";
     &eaPathRen1998  = "";
     &eaPathRen1997  = "";
     &eaPathRen1996  = "";
     &eaPathRen1995  = "";
     &eaPathRen1994  = "";
     &eaPathFacturar = "";
     &eaPathLaboral  = "";
     &eaPathIntegral = "";
     &eaPathDsmodelo = "";
     &eaPathFiscal   = "";
     aPath           = "";
     nDEmp           = 0;
     nHEmp           = 0;
|FIN;

|PROCESO CogeCodigo_130;
     |SI #dspase15#22 = "S";  |ACABA;  |FINSI;

     nCodigoNue = #dspase15#3;
     |ERROR10;
|FPRC;

|DEFBUCLE dspase15_130;
     #dspase15#4;
     ;
     nCodigoReo, "            ", 000;
     nCodigoReo, "zzzzzzzzzzzz", 999;
     ;
     NULL, CogeCodigo_130;
|FIN;

|DEFBUCLE dspase15_Cont130;
     #dspase15#5;
     ;
     nCodigoCont, "            ", 000;
     nCodigoCont, "zzzzzzzzzzzz", 999;
     ;
     NULL, CogeCodigo_130;
|FIN;

|PROCESO CreaPlaningComunero;
     |SI #dsmom001#8 ! "01.01.0000";
         |SI #dsmom001#8 > fFecha;  |ACABA;  |FINSI;
     |FINSI;

     |SI #dsmom001#9 ! "01.01.0000";
         |SI #dsmom001#9 < fFecha;  |ACABA;  |FINSI;
     |FINSI;

     |ABRE #agicen14;
     #agicen14#0 = #dsmom001#3;
     #agicen14#1 = #dsmom001#4;
     |LEE 101#agicen14.=;
     |SI FSalida ! 0;  |CIERRA #agicen14;  |ACABA;  |FINSI;

     #agicen14#6 = "01.01.0000";

     #dsmom002#0 = #agicen14#0;
     #dsmom002#1 = #agicen14#1;
     #dsmom002#2 = 130;
     |LEE 101#dsmom002.=;
     |SI FSalida ! 0;
         #agitab99#0 = 130;
         |LEE 040#agitab99.=;
         |SI FSalida ! 0;  |DDEFECTO #agitab99;  |FINSI;

         |DDEFECTO #dsmom002;
         #dsmom002#0  = #agicen14#0;
         #dsmom002#1  = #agicen14#1;
         #dsmom002#2  = 130;
         #dsmom002#3  = #agitab99#1;
         #dsmom002#4  = #agitab99#2;
         #dsmom002#5  = #agitab99#3;
         #dsmom002#6  = #agicen14#4;
         #dsmom002#7  = "TRIMESTRAL";
         #dsmom002#8  = #agicen14#5;
         #dsmom002#9  = #agicen14#6;
         #dsmom002#10 = 1;

         |GRABA 020#dsmom002.n;
     |FINSI;
     |LIBERA #dsmom002;

     |SI #agicen14#15 = "          ";  |O #agicen14#15 = "MODULOS   ";
         #agicen14#15 = "MANUAL";
     |FINSI;

     |SI #agicen14#9 = 3;  |O #agicen14#9 = 8;  |O #agicen14#9 = 13;
         |SI #refer00@#20 ! 0;
             |SI #agicen14#9 = 3;   #agicen14#9 = 4;   |FINSI;
             |SI #agicen14#9 = 8;   #agicen14#9 = 9;   |FINSI;
             |SI #agicen14#9 = 13;  #agicen14#9 = 14;  |FINSI;

             #agitab12#0 = #agicen14#9;
             |LEE 040#agitab12.=;

             #agicen14#10 = #agitab12#5;
         |FINSI;
     |FINSI;

     |GRABA 020#agicen14.a;
     |LIBERA #agicen14;
     |CIERRA #agicen14;

     enEmpresaA = #agicen14#0;
     enAnyo     = #dspase03#4;
     |SUB_EJECUTA_NP ":modelos/dsmoz001";
|FPRC;

|DEFBUCLE dsmom001;
     #dsmom001#1;
     ;
     #agicen14#0, #agicen14#1, 0001;
     #agicen14#0, #agicen14#1, 9999;
     ;
     NULL, CreaPlaningComunero;
|FIN;

|PROCESO CogeLiquida;
     |SI enEstaCambio = 1;
         nCodigoNue = 0;
         nCodigoReo = #refer01@#0;
         |BUCLE dspase15_130;
         |SI nCodigoNue = 0;  |ACABA;  |FINSI;
     |SINO;
         nCodigoNue = #refer01@#0;
     |FINSI;
     |SI nCodigoNue < #dspase03#9; |O nCodigoNue > #dspase03#10; |ACABA; |FINSI;

     |SI #refer01@#2 = 1;  nPeriodo = 3;   |FINSI;
     |SI #refer01@#2 = 2;  nPeriodo = 6;   |FINSI;
     |SI #refer01@#2 = 3;  nPeriodo = 9;   |FINSI;
     |SI #refer01@#2 = 4;  nPeriodo = 12;  |FINSI;

     enEmpresa     = nCodigoNue;
     enEjer        = #dspase03#4;
     enPeriodo     = nPeriodo;
     enModelo      = 130;
     enComplem     = 0;
     enActividad   = 0;

     #dspase25#0 = enModelo;
     #dspase25#1 = enPeriodo;
     #dspase25#2 = enComplem;
     #dspase25#3 = enEmpresa;
     |LEE 101#dspase25.=;
     |SI FSalida ! 0;
         |DDEFECTO #dspase25;
         #dspase25#0 = enModelo;
         #dspase25#1 = enPeriodo;
         #dspase25#2 = enComplem;
         #dspase25#3 = enEmpresa;
         |GRABA 020#dspase25.b;
     |FINSI;

     #dspase25#4 = #dspase25#4 + #refer01@#46;   ||suma el total liquidacion

     |GRABA 020#dspase25.a;
     |LIBERA #dspase25;

     efFechaI  = #refer01@#4;
     |SI #refer01@#4 = "          ";  efFechaI  = "01,01.0000";  |FINSI;

     eaArchiva = "";
     |SI #refer01@#5 = "S";  eaArchiva = "X";  |FINSI;

     |SUB_EJECUTA "dspasuti;PonDatosPlaning";
|FPRC;

|DEFBUCLE eosm3130;
     #refer01@#1004;
     ;
     00001, 1,    1, nAnyo;
     99999, 9, #dspase03#5, nAnyo;
     ;
     NULL, CogeLiquida;
|FIN;

|PROCESO Pasam094;
  |SI enEstaCambio = 1;
      nCodigoNue = 0;
      nCodigoReo = #refer04@#2;
      |BUCLE dspase15_130;
      |SI nCodigoNue = 0;  |ACABA;  |FINSI;
  |SINO;
      nCodigoNue = #refer04@#2;
  |FINSI;
  |SI nCodigoNue < #dspase03#9; |O nCodigoNue > #dspase03#10; |ACABA; |FINSI;

  #dsmom094#0 = 130;
  #dsmom094#1 = #dspase03#4;
  #dsmom094#2 = nCodigoNue;
  #dsmom094#3 = #refer04@#3;
  #dsmom094#4 = #refer04@#4;
  #dsmom094#5 = #refer04@#5;
  #dsmom094#6 = #refer04@#6;
  #dsmom094#7 = #refer04@#7;
  #dsmom094#8 = #refer04@#8;
  #dsmom094#9 = #refer04@#9;
  #dsmom094#10 = #refer04@#10;
  |GRABA 040#dsmom094.n;
|FPRC;

|DEFBUCLE eosm0094;
     #refer04@#1003;
     0;
     nAnyo, nDEmp, 0, 130;
     nAnyo, nHEmp, 9, 130;
     ;
     NULL, Pasam094;
|FIN;

|PROCESO Pasa130Reo;
     |SI enEstaCambio = 1;
         nCodigoNue = 0;
         nCodigoReo = #refer00@#0;
         |BUCLE dspase15_130;
         |SI nCodigoNue = 0;  |ACABA;  |FINSI;
     |SINO;
         nCodigoNue = #refer00@#0;
     |FINSI;
     |SI nCodigoNue < #dspase03#9; |O nCodigoNue > #dspase03#10; |ACABA; |FINSI;

     |SI #dspase03#8 ! 1;
         #dspase99#0 = nCodigoNue;
         #dspase99#1 = 130;
         |LEE 101#dspase99.=;
         |SI FSalida ! 0;
             enDEmpresa = nCodigoNue;
             enHEmpresa = nCodigoNue;
             enModelo   = 130;
             |SUB_EJECUTA "dspasuti;BorraModelos";

             #dspase99#0 = nCodigoNue;
             #dspase99#1 = 130;
             |GRABA 020#dspase99.n;
             |LIBERA #dspase99;
         |FINSI;
         |ABRE #refer03@;
         #refer03@#0 = 130;
         #refer03@#1 = nAnyo;
         #refer03@#2 = #refer00@#0;
         |LEE 001#refer03@.=;
         |SI FSalida = 0;
             |ABRE #dsmom093;
             |HAZ Paso93;
             |CIERRA #dsmom093;
         |FINSI;
         |CIERRA #refer03@;
         nDEmp = #refer00@#0; nHEmp = #refer00@#0; |BUCLE eosm0094;
     |FINSI;

     |ABRE #agicen14;
     #agicen14#0 = nCodigoNue;
     #agicen14#1 = #refer00@#1;
     |LEE 040#agicen14.=;
     |SI FSalida ! 0;  |CIERRA #agicen14;  |ACABA;  |FINSI;
     |CIERRA #agicen14;

     |SI #refer00@#2 = 1;  nPeriodo = 3;   |FINSI;
     |SI #refer00@#2 = 2;  nPeriodo = 6;   |FINSI;
     |SI #refer00@#2 = 3;  nPeriodo = 9;   |FINSI;
     |SI #refer00@#2 = 4;  nPeriodo = 12;  |FINSI;

     |SI #agicen14#13 = "S";
         |SI nPeriodo = 3;   aAlfa = "01.01." + #dspase03#4;  |FINSI;
         |SI nPeriodo = 6;   aAlfa = "01.04." + #dspase03#4;  |FINSI;
         |SI nPeriodo = 9;   aAlfa = "01.07." + #dspase03#4;  |FINSI;
         |SI nPeriodo = 12;  aAlfa = "01.10." + #dspase03#4;  |FINSI;

         fFecha = aAlfa;

         |BUCLE dsmom001;
     |FINSI;

     |ABRE #agicen14;
     #agicen14#0 = nCodigoNue;
     #agicen14#1 = #refer00@#1;
     |LEE 101#agicen14.=;
     |SI FSalida ! 0;  |CIERRA #agicen14;  |ACABA;  |FINSI;

     #agicen14#6 = "01.01.0000";

     #dsmom002#0 = #agicen14#0;
     #dsmom002#1 = #agicen14#1;
     #dsmom002#2 = 130;
     |LEE 101#dsmom002.=;
     |SI FSalida ! 0;
         #agitab99#0 = 130;
         |LEE 040#agitab99.=;
         |SI FSalida ! 0;  |DDEFECTO #agitab99;  |FINSI;

         |DDEFECTO #dsmom002;
         #dsmom002#0  = #agicen14#0;
         #dsmom002#1  = #agicen14#1;
         #dsmom002#2  = 130;
         #dsmom002#3  = #agitab99#1;
         #dsmom002#4  = #agitab99#2;
         #dsmom002#5  = #agitab99#3;
         #dsmom002#6  = #agicen14#4;
         #dsmom002#7  = "TRIMESTRAL";
         #dsmom002#8  = #agicen14#5;
         #dsmom002#9  = #agicen14#6;
         #dsmom002#10 = 1;

         |GRABA 020#dsmom002.n;
     |FINSI;
     |LIBERA #dsmom002;

     |SI #agicen14#15 = "          ";  |O #agicen14#15 = "MODULOS   ";
         #agicen14#15 = "MANUAL";
     |FINSI;

     |SI #agicen14#9 = 3;  |O #agicen14#9 = 8;  |O #agicen14#9 = 13;
         |SI #refer00@#20 ! 0;
             |SI #agicen14#9 = 3;   #agicen14#9 = 4;   |FINSI;
             |SI #agicen14#9 = 8;   #agicen14#9 = 9;   |FINSI;
             |SI #agicen14#9 = 13;  #agicen14#9 = 14;  |FINSI;

             #agitab12#0 = #agicen14#9;
             |LEE 040#agitab12.=;

             #agicen14#10 = #agitab12#5;
         |FINSI;
     |FINSI;

     |GRABA 020#agicen14.a;
     |LIBERA #agicen14;
     |CIERRA #agicen14;

     enEmpresaA = #agicen14#0;
     enAnyo     = #dspase03#4;
     |SUB_EJECUTA_NP ":modelos/dsmoz001";

     |ABRE #dsmoc130;
     #dsmoc130#0  = #agicen14#0;
     #dsmoc130#1  = #dspase03#4;
     #dsmoc130#2  = nPeriodo;
     #dsmoc130#3  = 130;
     #dsmoc130#4  = 0;
     #dsmoc130#5  = #agicen14#1;
     |LEE 101#dsmoc130.=;
     |SI FSalida ! 0;
         |DDEFECTO #dsmoc130;
         #dsmoc130#0  = #agicen14#0;
         #dsmoc130#1  = #dspase03#4;
         #dsmoc130#2  = nPeriodo;
         #dsmoc130#3  = 130;
         #dsmoc130#4  = 0;
         #dsmoc130#5  = #agicen14#1;
         |GRABA 020#dsmoc130.b;
     |FINSI;

     |SI #refer00@#30 = 0;
         #refer02@#0  = #refer00@#0;
         #refer02@#83 = #refer00@#1;
         #refer02@#1  = #refer00@#3;
         #refer02@#2  = #refer00@#2;
         |LEE 040#refer02@.=;
         |SI FSalida = 0;
             #dsmoc130#46 = #refer02@#48 - #refer02@#49;
         |SINO;
             #dsmoc130#46 = #refer00@#15 - #refer00@#9;
         |FINSI;

         #dsmoc130#6  = #refer00@#6;
         #dsmoc130#9  = #refer00@#12;
         #dsmoc130#18 = #refer00@#20;
         #dsmoc130#25 = 20;
         #dsmoc130#29 = #refer00@#23;
         #dsmoc130#48 = #refer00@#38;
         #dsmoc130#49 = #refer00@#39;
     |SINO;
         #dsmoc130#6  = #refer00@#30;
         #dsmoc130#29 = #refer00@#32;
     |FINSI;

     |GRABA 020#dsmoc130.a;
     |LIBERA #dsmoc130;
     |CIERRA #dsmoc130;

     enEmpresa     = #dsmoc130#0;
     enEjer        = #dsmoc130#1;
     enPeriodo     = #dsmoc130#2;
     enModelo      = #dsmoc130#3;
     enComplem     = #dsmoc130#4;
     enActividad   = #dsmoc130#5;
     enTipoEntrada = 97;
     eaComunidad   = #agicen14#13;
     |SUB_EJECUTA_NP ":modelos/dsmoc130";
|FPRC;

|DEFBUCLE eosm2130;
     #refer00@#1004;
     ;
     00001, 1,    1, nAnyo;
     99999, 9, #dspase03#5, nAnyo;
     ;
     NULL, Pasa130Reo;
|FIN;

|PROCESO Paso93;
  |DDEFECTO #dsmom093;
  #dsmom093#0 = 130;
  #dsmom093#1 = #dspase03#4;
  #dsmom093#2 = nCodigoNue;
  |LEE 101#dsmom093.=;
  |SI FSalida ! 0;
      #dsmom093#0 = 130;
      #dsmom093#1 = #dspase03#4;
      #dsmom093#2 = nCodigoNue;
      |GRABA 020#dsmom093.b;
  |FINSI;
  #dsmom093#3 = #refer03@#3;
  #dsmom093#4 = #refer03@#4;
  #dsmom093#5 = #refer03@#5;
  #dsmom093#6 = #refer03@#6;
  #dsmom093#7 = #refer03@#7;
  #dsmom093#8 = #refer03@#8;
  #dsmom093#9 = #refer03@#9;
  #dsmom093#10 = #refer03@#10;
  #dsmom093#11 = #refer03@#11;
  #dsmom093#12 = #refer03@#12;
  #dsmom093#13 = #refer03@#13;
  |GRABA 020#dsmom093.a;
  |LIBERA #dsmom093;
|FPRC;

|PROCESO Pasam093;
    |SI enEstaCambio = 1;
        nCodigoNue = 0;
        nCodigoReo = #refer03@#2;
        |BUCLE dspase15_130;
        |SI nCodigoNue = 0;  |ACABA;  |FINSI;
    |SINO;
        nCodigoNue = #refer03@#2;
    |FINSI;
    |SI nCodigoNue < #dspase03#9; |O nCodigoNue > #dspase03#10; |ACABA; |FINSI;

    |HAZ Paso93;
|FPRC;

|DEFBUCLE eosm0093;  ||solo los que no aplican
     #refer03@#1003;
     ;
     130, nAnyo, 00001;
     130, nAnyo, 99999;
     ;
     NULL, Pasam093;
|FIN;

|PROCESO Modelo130Reo;
     aDef = eaPathAnterior + "agieos/def/eosm2130.mas";
     |CARGA_DEF aDef, refer00@;
     |SI FSalida ! 0;
         |ACABA;
     |FINSI;

     aDef = eaPathAnterior + "agieos/def/eosm3130.mas";
     |CARGA_DEF aDef, refer01@;
     |SI FSalida ! 0;
         |DESCARGA_DEF #refer00@;
         |ACABA;
     |FINSI;

     aDef = eaPathAnterior + "agieos/def/eosplan1.mas";
     |CARGA_DEF aDef, refer02@;
     |SI FSalida ! 0;
         |DESCARGA_DEF #refer01@;
         |DESCARGA_DEF #refer00@;
         |ACABA;
     |FINSI;

     aDef = eaPathAnterior + "agieos/def/eosm0093.mas";
     |CARGA_DEF aDef, refer03@;
     |SI FSalida ! 0;
         |DESCARGA_DEF #refer02@;
         |DESCARGA_DEF #refer01@;
         |DESCARGA_DEF #refer00@;
         |ACABA;
     |FINSI;

     aDef = eaPathAnterior + "agieos/def/eosm0094.mas";
     |CARGA_DEF aDef, refer04@;
     |SI FSalida ! 0;
         |DESCARGA_DEF #refer03@;
         |DESCARGA_DEF #refer02@;
         |DESCARGA_DEF #refer01@;
         |DESCARGA_DEF #refer00@;
         |ACABA;
     |FINSI;

     aFich = eaPathAnterior + "agieos/fich/";
     |PATH_DAT #refer00@#aFich#;
     |PATH_DAT #refer01@#aFich#;
     |PATH_DAT #refer02@#aFich#;
     |PATH_DAT #refer03@#aFich#;
     |PATH_DAT #refer04@#aFich#;

     aAlfa   = #dspase03#4;
     aAlfa   = #dspase03#4 % -102;
     nAnyo   = aAlfa;

     |ABRE #dsmom093;
     |BUCLE eosm0093;  ||solo los que no aplican
     |CIERRA #dsmom093;

     |ABRE #dsmom094;
     nDEmp = 00001;
     nHEmp = 99999;
     |BUCLE eosm0094;
     |CIERRA #dsmom094;

     |ABRE #dsmom002;
     |ABRE #agitab99;
     |ABRE #agitab12;
     |ABRE #refer02@;
     |BUCLE eosm2130;
     |CIERRA #agitab12;
     |CIERRA #dsmom002;
     |CIERRA #agitab99;
     |CIERRA #refer02@;

     |BUCLE eosm3130;

     |DESCARGA_DEF #refer04@;
     |DESCARGA_DEF #refer03@;
     |DESCARGA_DEF #refer02@;
     |DESCARGA_DEF #refer01@;
     |DESCARGA_DEF #refer00@;
|FPRC;

|PROCESO Pasam094_Cont;
  #dsmom094#0 = 130;
  #dsmom094#1 = #dspase03#4;
  #dsmom094#2 = nCodigoNue;
  #dsmom094#3 = #refer04@#3; |SI #dsmom094#3 = 0; #dsmom094#3 = 1; |FINSI;
  #dsmom094#4 = #refer04@#4;
  #dsmom094#5 = #refer04@#5;
  #dsmom094#6 = #refer04@#6;
  #dsmom094#7 = #refer04@#7;
  #dsmom094#8 = #refer04@#8;
  #dsmom094#9 = #refer04@#9;
  #dsmom094#10 = #refer04@#10;
  |GRABA 040#dsmom094.n;
|FPRC;

|DEFBUCLE agicon094;
     #refer04@#1003;
     ;
     nAnyo, #refer01@#2, 0;
     nAnyo, #refer01@#2, 9;
     ;
     NULL, Pasam094_Cont;
|FIN;

|PROCESO Pasa130Conta;
     nPeriodo = 0;
     |SI #refer00@#2   = 1;  nPeriodo = 3;   |FINSI;
     |SI #refer00@#2   = 2;  nPeriodo = 6;   |FINSI;
     |SI #refer00@#2   = 3;  nPeriodo = 9;   |FINSI;
     |SI #refer00@#2   = 4;  nPeriodo = 12;  |FINSI;
     |SI nPeriodo = 0;  |ACABA;         |FINSI;

     |SI enEstaCambio = 1;
         nCodigoNue  = 0;
         nCodigoCont = #refer01@#2;
         |BUCLE dspase15_Cont130;
         |SI nCodigoNue = 0;  |ACABA;  |FINSI;
     |SINO;
         nCodigoNue = #refer01@#2;
     |FINSI;
     |SI nCodigoNue < #dspase03#9; |O nCodigoNue > #dspase03#10; |ACABA; |FINSI;

     |SI #dspase03#8 ! 1;
         #dspase99#0 = nCodigoNue;
         #dspase99#1 = 130;
         |LEE 101#dspase99.=;
         |SI FSalida ! 0;
             enDEmpresa = nCodigoNue;
             enHEmpresa = nCodigoNue;
             enModelo   = 130;
             |SUB_EJECUTA "dspasuti;BorraModelos";

             #dspase99#0 = nCodigoNue;
             #dspase99#1 = 130;
             |GRABA 020#dspase99.n;
             |LIBERA #dspase99;
         |FINSI;
     |FINSI;

     #refer02@#0  = #refer00@#0;
     #refer02@#1  = #refer00@#3;
     |LEE 040#refer02@.=;
     |SI FSalida ! 0;  |DDEFECTO #refer02@;  |FINSI;

     |ABRE #dsmom004;
     #dsmom004#0   = nCodigoNue;
     #dsmom004#1   = #dspase03#4;
     #dsmom004#2   = nPeriodo;
     #dsmom004#3   = 130;
     #dsmom004#4   = 0;
     |LEE 040#dsmom004.=;
     |SI FSalida  = 0;  |Y #dsmom004#7 = "X";
         |CIERRA #dsmom004;
         |ACABA;
     |FINSI;
     |CIERRA #dsmom004;

     |ABRE #agicen14;
     #agicen14#0 = nCodigoNue;
     #agicen14#1 = 1;
     |LEE 101#agicen14.=;
     |SI FSalida ! 0;
         |DDEFECTO #agicen14;
         #agicen14#0  = nCodigoNue;
         #agicen14#1  = 1;
         #agicen14#3  = #refer02@#32;
         #agicen14#4  = #refer02@#20;
         #agicen14#7  = 2;
         #agicen14#8  = "REGIMEN GENERAL U ORDINARIO";
         |GRABA 020#agicen14.b;
     |FINSI;

     #agicen14#9 = 3;
     #agitab12#0 = #agicen14#9;
     |LEE 040#agitab12.=;
     #agicen14#10 = #agitab12#5;

     #agicen14#6 = "01.01.0000";

     #dsmom002#0 = #agicen14#0;
     #dsmom002#1 = #agicen14#1;
     #dsmom002#2 = 130;
     |LEE 101#dsmom002.=;
     |SI FSalida ! 0;
         #agitab99#0 = 130;
         |LEE 040#agitab99.=;
         |SI FSalida ! 0;  |DDEFECTO #agitab99;  |FINSI;

         |DDEFECTO #dsmom002;
         #dsmom002#0  = #agicen14#0;
         #dsmom002#1  = #agicen14#1;
         #dsmom002#2  = 130;
         #dsmom002#3  = #agitab99#1;
         #dsmom002#4  = #agitab99#2;
         #dsmom002#5  = #agitab99#3;
         #dsmom002#6  = #agicen14#4;
         #dsmom002#7  = "TRIMESTRAL";
         #dsmom002#8  = #agicen14#5;
         #dsmom002#9  = #agicen14#6;
         #dsmom002#10 = 1;

         |GRABA 020#dsmom002.n;
     |FINSI;
     |LIBERA #dsmom002;

     |SI #agicen14#15 = "          ";  |O #agicen14#15 = "MODULOS   ";
         #agicen14#15 = "REGISTROS";
     |FINSI;

     |SI #refer00@#20 ! 0;
         #agicen14#9 = 4;

         #agitab12#0 = #agicen14#9;
         |LEE 040#agitab12.=;

         #agicen14#10 = #agitab12#5;
     |FINSI;

     |GRABA 020#agicen14.a;
     |LIBERA #agicen14;
     |CIERRA #agicen14;

     enEmpresaA = #agicen14#0;
     enAnyo     = #dspase03#4;
     |SUB_EJECUTA_NP ":modelos/dsmoz001";

     |SI #dspase03#4 ] 2008;
             |ABRE #dsmom093;
             #dsmom093#0 = 130;
             #dsmom093#1 = #dspase03#4;
             #dsmom093#2 = #agicen14#0;
             |LEE 001#dsmom093.=;
             |SI FSalida ! 0;
                 |DDEFECTO #dsmom093;
                 #dsmom093#0 = 130;
                 #dsmom093#1 = #dspase03#4;
                 #dsmom093#2 = #agicen14#0;
                 |GRABA 020#dsmom093.b;
             |FINSI;
             #dsmom093#3 = #refer02@#2;
             #dsmom093#4 = #refer02@#103;
             #dsmom093#5 = #refer02@#105;
             #dsmom093#6 = #refer02@#106;
             #dsmom093#7 = #refer02@#107;
             #dsmom093#8 = #refer02@#108;
             #dsmom093#9 = #refer02@#109;
             #dsmom093#10 = #refer02@#110;
             #dsmom093#11 = #refer02@#111;
             #dsmom093#12 = #refer02@#112;
             #dsmom093#13 = #refer02@#113;
             |GRABA 040#dsmom093.a;
             |CIERRA #dsmom093;
             |ABRE #dsmom094;
             |BUCLE agicon094;
             |CIERRA #dsmom094;
     |FINSI;

     |ABRE #dsmoc130;
     #dsmoc130#0  = #agicen14#0;
     #dsmoc130#1  = #dspase03#4;
     #dsmoc130#2  = nPeriodo;
     #dsmoc130#3  = 130;
     #dsmoc130#4  = 0;
     #dsmoc130#5  = #agicen14#1;
     |LEE 101#dsmoc130.=;
     |SI FSalida ! 0;
         |DDEFECTO #dsmoc130;
         #dsmoc130#0  = #agicen14#0;
         #dsmoc130#1  = #dspase03#4;
         #dsmoc130#2  = nPeriodo;
         #dsmoc130#3  = 130;
         #dsmoc130#4  = 0;
         #dsmoc130#5  = #agicen14#1;
         |GRABA 020#dsmoc130.b;
     |FINSI;

     |SI #refer00@#30 = 0;
         #dsmoc130#6  = #refer00@#6;
         #dsmoc130#9  = #refer00@#12;
         #dsmoc130#46 = #refer00@#17 - #refer00@#11;  ||las de ejercicio
         #dsmoc130#18 = #refer00@#20;
         #dsmoc130#25 = 20;
         #dsmoc130#29 = #refer00@#23;
         #dsmoc130#48 = #refer00@#48;
         #dsmoc130#49 = #refer00@#49;
     |SINO;
         #dsmoc130#6  = #refer00@#30;
         #dsmoc130#29 = #refer00@#36;
     |FINSI;

     |GRABA 020#dsmoc130.a;
     |LIBERA #dsmoc130;
     |CIERRA #dsmoc130;

     enEmpresa     = #dsmoc130#0;
     enEjer        = #dsmoc130#1;
     enPeriodo     = #dsmoc130#2;
     enModelo      = #dsmoc130#3;
     enComplem     = #dsmoc130#4;
     enActividad   = #dsmoc130#5;
     enTipoEntrada = 97;
     eaComunidad   = #agicen14#13;
     |SUB_EJECUTA_NP ":modelos/dsmoc130";

     #dspase25#0 = enModelo;
     #dspase25#1 = enPeriodo;
     #dspase25#2 = enComplem;
     #dspase25#3 = enEmpresa;
     |LEE 101#dspase25.=;
     |SI FSalida ! 0;
         |DDEFECTO #dspase25;
         #dspase25#0 = enModelo;
         #dspase25#1 = enPeriodo;
         #dspase25#2 = enComplem;
         #dspase25#3 = enEmpresa;
         |GRABA 020#dspase25.b;
     |FINSI;
     |SI enEjer < 2008;
         #refer00@#46 = #refer00@#29;
     |SINO;
         |SI enEjer = 2008; |Y enPeriodo < 4;
             #refer00@#46 = #refer00@#29;
         |FINSI;
     |FINSI;

     #dspase25#4 = #dspase25#4 + #refer00@#46;
     |GRABA 020#dspase25.a;
     |LIBERA #dspase25;

     efFechaI  = #refer00@#4;
     |SI #refer00@#4 = "          ";  efFechaI  = "01,01.0000";  |FINSI;

     eaArchiva = "";

     |SUB_EJECUTA "dspasuti;PonDatosPlaning";
|FPRC;

|DEFBUCLE caman130;
     #refer00@#1004;
     ;
     #refer01@#2, 1,    1, nAnyo;
     #refer01@#2, 9, #dspase03#5, nAnyo;
     ;
     NULL, Pasa130Conta;
|FIN;

|PROCESO MiraEmpresa130;
     aDef = eaPathAnterior + "agicont/def/caman130.mas";
     |CARGA_DEF aDef, refer00@;
     |SI FSalida ! 0;
         |ACABA;
     |FINSI;

     aDef = eaPathAnterior + "agicont/def/caportad.mas";
     |CARGA_DEF aDef, refer02@;
     |SI FSalida ! 0;
         |DESCARGA_DEF #refer00@;
         |ACABA;
     |FINSI;

     aDef = eaPathAnterior + "agicont/def/eosm0094.mas";
     |CARGA_DEF aDef, refer04@;
     |SI FSalida ! 0;
         |DESCARGA_DEF #refer02@;
         |DESCARGA_DEF #refer00@;
         |ACABA;
     |FINSI;

     aFich = eaPathAnterior + "agicont/fich/" + (("00000" + #refer01@#2) % -105) + #refer01@#3 + "/";
     |PATH_DAT #refer00@#aFich#;
     |PATH_DAT #refer02@#aFich#;
     |PATH_DAT #refer04@#aFich#;

     aAlfa   = #dspase03#4;
     aAlfa   = #dspase03#4 % -102;
     nAnyo   = aAlfa;

     |ABRE #dsmom002;
     |ABRE #agitab99;
     |ABRE #agitab12;
     |ABRE #refer02@;
     |BUCLE caman130;
     |CIERRA #agitab12;
     |CIERRA #dsmom002;
     |CIERRA #agitab99;
     |CIERRA #refer02@;

     |DESCARGA_DEF #refer04@;
     |DESCARGA_DEF #refer02@;
     |DESCARGA_DEF #refer00@;
|FPRC;

|DEFBUCLE canempre_130;
     #refer01@#1002;
     26;
     00000, 0, nAnyo;
     99999, 9, nAnyo;
     ;
     NULL, MiraEmpresa130;
|FIN;

|PROCESO Modelo130Conta;
     aDef = eaPathAnterior + "agicont/def/canempre.mas";
     |CARGA_DEF aDef, refer01@;
     |SI FSalida ! 0;
         |ACABA;
     |FINSI;

     aFich = eaPathAnterior + "agicont/fich/";
     |PATH_DAT #refer01@#aFich#;

     aAlfa   = #dspase03#4;
     aAlfa   = #dspase03#4 % -102;
     nAnyo   = aAlfa;

     |BUCLE canempre_130;

     |DESCARGA_DEF #refer01@;
|FPRC;

|PROCESO Pase130;
     enModelo   = 130;
     enDEmpresa = #dspase03#9;
     enHEmpresa = #dspase03#10;

     aPath = eaPathDsmodelo + "fich/";
     |PATH_DAT #dsmom093#aPath#;
     |PATH_DAT #dsmom094#aPath#;

     |SI #dspase03#8 = 1;
         |SUB_EJECUTA "dspasuti;BorraModelos";
     |FINSI;

     |SI #dspase03#8 = 1;  |O #dspase03#8 = 3;
         |HAZ Modelo130Conta;
     |FINSI;

     |SI #dspase03#8 = 1;  |O #dspase03#8 = 2;
         |HAZ Modelo130Reo;
     |FINSI;
|FPRC;
