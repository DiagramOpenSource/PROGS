|FICHEROS;
     &program@ #0;

     &provinc@ #700;
      agiprovi #701;
     :/integral/def/dsam0100 #702;

     &poblaci@ #703;
      agipobla #704;
     :/integral/def/dsam0101 #705;

     &haciend@ #706;
      agihacie #707;
     :/integral/def/dsam0102 #708;

     &regisnif@ #709;
      agim0003  #710;
     :/integral/def/dsam0103 #711;

     &usuarios@ #712;
      agiusuar  #713;
     :/integral/def/dsam0108 #714;

     &clientes@ #715;
      agifigen  #716;
     :/integral/def/dsam0000 #717;

     &sgpaises@ #718;
      agim0016  #719;
     :/integral/def/dsam0104 #720;

     :/integral/def/dsam0115 #115;

     agiepim2   #602;
     agitab14   #605;
     agim0035   #635;
     agim0135   #636;

     agim0055   #555;
|FIN;

|VARIABLES;
     &eaPathExplorador = "";
     &eaForzExplorador = "";

     aBase           = "";
     aProgAct        = "";
     aDef            = "";
     aPathReo        = "";
     aAlfa           = "";
     aVariable       = "";
     aFichero        = "";
     aPathFichbasica = "";
     aPathPanbasica  = "";
     aOrigen         = "";
     aDestino        = "";
     aDocRemoto      = "";
     aDocServidor    = "";
     aIPRemoto       = "";
     aAbre           = "";
     aEjecuta        = "";

     nCampoCodProv   = 0;
     nCampoCodPobl   = 0;
     nCampoNomProv   = 0;
     nCampoNomPobl   = 0;
     nCanal          = 0;
     nCampoPobla     = 0;
     nCampoEpi1      = 0;
     nCampoEpi2      = 0;
     nCampoEpi3      = 0;
     nCampoEpi4      = 0;
     nCampoEpi5      = 0;
     nCampoEpi6      = 0;
     nCampoEpi7      = 0;
     nCampoEpi8      = 0;
     nCampoEpi9      = 0;
     nSwPantalla     = 0;
     nHandle         = 0;
     nPausa          = 0;
     nConta          = 0;

     {1}aContiene     = "";

     &eaPrograma     = "";
     &enSw           = 0;
     &enCodProv      = 0;
     &enCodPobl      = 0;
     &enModoPob      = 0;
     &eaCodPais      = "";
     &eaPoblacion    = "";
     &eaPoblaParri   = "";
     &eaCodNif       = "";
     &eaCodUsu       = "";
     &enCodCli       = 0;
     &enSwDeDonde    = 0;
     &enAgrupa       = 0;
     &eaEpigrafe     = "";
     &eaTipoEpi      = "";
     &eaNombEpi      = "";
     &enSectAct      = 0;
     &eaCNAE2008     = "";
     &eaCNAE2009     = "";
     &enCampo        = 0;
     &eswNif         = 0;
     &eaSigla5       = "";

     &eaPathBasica   = "";
     &eaPathContagen = "";
     &eaPathContanex = "";
     &eaPathContasoc = "";
     &eaPathDscarter = "";
     &eaPathDsArchi  = "";
     &eaPathRen2019  = "";
     &eaPathRen2018  = "";
     &eaPathRen2017  = "";
     &eaPathRen2016  = "";
     &eaPathRen2015  = "";
     &eaPathRen2014  = "";
     &eaPathRen2013  = "";
     &eaPathRen2012  = "";
     &eaPathRen2011  = "";
     &eaPathRen2010  = "";
     &eaPathRen2009  = "";
     &eaPathRen2008  = "";
     &eaPathRen2007  = "";
     &eaPathRen2006  = "";
     &eaPathRen2005  = "";
     &eaPathRen2004  = "";
     &eaPathRen2003  = "";
     &eaPathRen2002  = "";
     &eaPathRen2001  = "";
     &eaPathRen2000  = "";
     &eaPathRen1999  = "";
     &eaPathRen1998  = "";
     &eaPathRen1997  = "";
     &eaPathRen1996  = "";
     &eaPathRen1995  = "";
     &eaPathRen1994  = "";
     &eaPathFacturar = "";
     &eaPathLaboral  = "";
     &eaPathIntegral = "";
     &eaPathDsmodelo = "";
     &eaPathFiscal   = "";
     &eaPathAgitool  = "";

     &eaUnidadBasico  = "";
     &eaDSMAC         = "";
|FIN;

|PROCESO Tipo88;  |TIPO 88;
     eaPrograma = FSalida % -108;

     enSw = 0;
     |HAZ CargaRefer1;
     |SI enSw = 0;  |HAZ CargaRefer2;  |FINSI;
     |SI enSw = 0;  |HAZ CargaRefer3;  |FINSI;

     |SI enSw = 0;  |ACABA;  |FINSI;

     |DBASS aBase;   |QBT aBase;
     aBase = aBase + "integral/def/dsam0000.mas";
     |XABRE "E", aBase, nCanal;
     |SI FSalida ] 0;
         ||Desactivado

         |MODO_RELACION #0, 1, "agiprovi", "N", "N";
         |MODO_RELACION #0, 1, "agipobla", "N", "N";
         |MODO_RELACION #0, 1, "agihacie", "N", "N";
         |MODO_RELACION #0, 1, "agim0016", "N", "N";
         |MODO_RELACION #0, 1, "agim0003", "N", "N";
         |MODO_RELACION #0, 1, "agiusuar", "N", "N";
         |MODO_RELACION #0, 1, "agifigen", "N", "N";

         |MODO_RELACION #0, 1, "agiprovi", "X", "X";
         |MODO_RELACION #0, 1, "agipobla", "X", "X";
         |MODO_RELACION #0, 1, "agihacie", "X", "X";
         |MODO_RELACION #0, 1, "agim0003", "X", "X";
         |MODO_RELACION #0, 1, "agim0016", "X", "X";
         |MODO_RELACION #0, 1, "agiusuar", "X", "X";
         |MODO_RELACION #0, 1, "agifigen", "X", "X";

         || Activado

         |MODO_RELACION #0, 0, "dsam0100", "X", "X";
         |MODO_RELACION #0, 0, "dsam0101", "X", "X";
         |MODO_RELACION #0, 0, "dsam0102", "X", "X";
         |MODO_RELACION #0, 0, "dsam0103", "X", "X";
         |MODO_RELACION #0, 0, "dsam0104", "X", "X";
         |MODO_RELACION #0, 0, "dsam0108", "X", "X";
         |MODO_RELACION #0, 0, "dsam0000", "X", "X";
         |MODO_RELACION #0, 0, "dsam0115", "X", "X";

         |MODO_RELACION #0, 1, "dsam0100", "S", "S";
         |MODO_RELACION #0, 1, "dsam0101", "S", "S";
         |MODO_RELACION #0, 1, "dsam0102", "S", "S";
         |SI eaPrograma ! "agiz0001";
             |MODO_RELACION #0, 1, "dsam0103", "S", "S";
         |FINSI;
         |MODO_RELACION #0, 1, "dsam0104", "S", "S";
         |MODO_RELACION #0, 1, "dsam0108", "S", "S";
         |MODO_RELACION #0, 1, "dsam0000", "S", "S";
         |MODO_RELACION #0, 1, "dsam0115", "S", "S";

         |REFERENCIA_DEF provinc@,  #702;
         |REFERENCIA_DEF poblaci@,  #705;
         |REFERENCIA_DEF haciend@,  #708;
         |REFERENCIA_DEF regisnif@, #711;
         |REFERENCIA_DEF usuarios@, #714;
         |REFERENCIA_DEF clientes@, #717;
         |REFERENCIA_DEF sgpaises@, #720;

         nCampoPobla = 3;
     |SINO;
         |MODO_RELACION #0, 1, "dsam0100", "N", "N";
         |MODO_RELACION #0, 1, "dsam0101", "N", "N";
         |MODO_RELACION #0, 1, "dsam0102", "N", "N";
         |MODO_RELACION #0, 1, "dsam0103", "N", "N";
         |MODO_RELACION #0, 1, "dsam0104", "N", "N";
         |MODO_RELACION #0, 1, "dsam0108", "N", "N";
         |MODO_RELACION #0, 1, "dsam0000", "N", "N";
         |MODO_RELACION #0, 1, "dsam0115", "N", "N";

         |MODO_RELACION #0, 1, "dsam0100", "X", "X";
         |MODO_RELACION #0, 1, "dsam0101", "X", "X";
         |MODO_RELACION #0, 1, "dsam0102", "X", "X";
         |MODO_RELACION #0, 1, "dsam0103", "X", "X";
         |MODO_RELACION #0, 1, "dsam0104", "X", "X";
         |MODO_RELACION #0, 1, "dsam0108", "X", "X";
         |MODO_RELACION #0, 1, "dsam0000", "X", "X";
         |MODO_RELACION #0, 1, "dsam0115", "X", "X";

         |MODO_RELACION #0, 0, "agiprovi", "X", "X";
         |MODO_RELACION #0, 0, "agipobla", "X", "X";
         |MODO_RELACION #0, 0, "agihacie", "X", "X";
         |MODO_RELACION #0, 0, "agim0003", "X", "X";
         |MODO_RELACION #0, 0, "agim0016", "X", "X";
         |MODO_RELACION #0, 0, "agiusuar", "X", "X";
         |MODO_RELACION #0, 0, "agifigen", "X", "X";

         |MODO_RELACION #0, 1, "agiprovi", "S", "S";
         |MODO_RELACION #0, 1, "agipobla", "S", "S";
         |MODO_RELACION #0, 1, "agihacie", "S", "S";
         |SI eaPrograma ! "agiz0001";
             |MODO_RELACION #0, 1, "agim0003", "S", "S";
         |FINSI;
         |MODO_RELACION #0, 1, "agim0016", "S", "S";
         |MODO_RELACION #0, 1, "agiusuar", "S", "S";
         |MODO_RELACION #0, 1, "agifigen", "S", "S";

         |REFERENCIA_DEF provinc@,  #701;
         |REFERENCIA_DEF poblaci@,  #704;
         |REFERENCIA_DEF haciend@,  #707;
         |REFERENCIA_DEF regisnif@, #710;
         |REFERENCIA_DEF usuarios@, #713;
         |REFERENCIA_DEF clientes@, #716;
         |REFERENCIA_DEF sgpaises@, #719;

         nCampoPobla = 2;
     |FINSI;
|FPRC;

|PROCESO ParrillaPobla;
     |DBASS aBase;   |QBT aBase;
     aBase = aBase + "integral/def/dsam0000.mas";
     |XABRE "E", aBase, nCanal;
     |SI FSalida ] 0;
         enSwDeDonde = 1;
         enCodProv   = #0nCampoCodProv;
         enCodPobl   = #0nCampoCodPobl;
         eaPoblacion = #0nCampoNomPobl;
         enModoPob   = 1;
         |SUB_EJECUTA_NP ":integral/dsaw9996;NOSIRVE";
         |SI eaPoblaParri ! "";
             #0nCampoNomPobl = eaPoblaParri;
         |SINO;
             #0nCampoNomPobl = #703#3;
         |FINSI;
     |SINO;
||         enSwDeDonde     = 0;
||         #0nCampoNomPobl = #703#2;
         enSwDeDonde = 1;
         enCodProv   = #0nCampoCodProv;
         enCodPobl   = #0nCampoCodPobl;
         eaPoblacion = #0nCampoNomPobl;
         enModoPob   = 1;
         |SUB_EJECUTA_NP ":basica/agiw9996;NOSIRVE";
         |SI eaPoblaParri ! "";
             #0nCampoNomPobl = eaPoblaParri;
         |SINO;
             #0nCampoNomPobl = #703#2;
         |FINSI;
     |FINSI;

     |PINTA #0nCampoNomPobl;
|FPRC;

|PROCESO LeeLocalidad;
     |DBASS aBase;   |QBT aBase;
     aBase = aBase + "integral/def/dsam0000.mas";
     |XABRE "E", aBase, nCanal;
     |SI FSalida ] 0;
         enSwDeDonde = 1;
         |REFERENCIA_DEF provinc@,  #702;
         |REFERENCIA_DEF poblaci@,  #705;
     |SINO;
         enSwDeDonde = 0;
         |REFERENCIA_DEF poblaci@,  #704;
         |REFERENCIA_DEF provinc@,  #701;
     |FINSI;

     eaPrograma = Control;  |QBF eaPrograma;

     |SI eaPrograma = "agifigen";
         nCampoNomProv = Campo + 2;
         nCampoNomPobl = Campo + 1;
     |FINSI;

     |SI eaPrograma = "agirefer";
         nCampoNomProv = Campo + 2;
         nCampoNomPobl = Campo + 1;
     |FINSI;

     |SI eaPrograma = "agim0003";
         nCampoNomProv = Campo + 2;
         nCampoNomPobl = Campo + 1;
     |FINSI;

     |SI eaPrograma = "agim0025";
         nCampoNomProv = Campo + 2;
         nCampoNomPobl = Campo + 1;
     |FINSI;

     |SI eaPrograma = "agim0024";
         nCampoNomProv = Campo + 2;
         nCampoNomPobl = Campo + 1;
     |FINSI;

     |SI eaPrograma = "agicen02";
         nCampoNomProv = Campo + 2;
         nCampoNomPobl = Campo + 1;
     |FINSI;

     |SI eaPrograma = "agicen15";
         nCampoNomProv = Campo + 2;
         nCampoNomPobl = Campo + 1;
     |FINSI;

     |SI eaPrograma = "agicen17";
         nCampoNomProv = Campo + 2;
         nCampoNomPobl = Campo + 1;
     |FINSI;

     |SI eaPrograma = "agicen08";
         |SI Campo = 12;
             nCampoNomProv = 8;
             nCampoNomPobl = 7;
         |SINO;
             nCampoNomProv = 40;
             nCampoNomPobl = 39;
         |FINSI;
     |FINSI;

     |SI eaPrograma = "agicen09";
         nCampoNomProv = Campo + 1;
         nCampoNomPobl = -1;
     |FINSI;

     |SI eaPrograma = "agiw0001";
         nCampoNomProv = Campo + 2;
         nCampoNomPobl = Campo + 1;
     |FINSI;

     |SI eaPrograma = "agiw0004";
         nCampoNomProv = Campo + 2;
         nCampoNomPobl = Campo + 1;
     |FINSI;

     |SI eaPrograma = "agiw0030";
         nCampoNomProv = Campo + 2;
         nCampoNomPobl = Campo + 1;
     |FINSI;

     |SI eaPrograma = "agiw0050";
         nCampoNomProv = Campo + 2;
         nCampoNomPobl = Campo + 1;
     |FINSI;

     |SI eaPrograma = "agiw0051";
         nCampoNomProv = Campo + 2;
         nCampoNomPobl = Campo + 1;
     |FINSI;

     |SI eaPrograma = "agiw0052";
         nCampoNomProv = Campo + 2;
         nCampoNomPobl = Campo + 1;
     |FINSI;

     |SI eaPrograma = "agiw0053";
         nCampoNomProv = Campo + 2;
         nCampoNomPobl = Campo + 1;
     |FINSI;

     |SI eaPrograma = "agiw0055";
         nCampoNomProv = Campo + 2;
         nCampoNomPobl = Campo + 1;
     |FINSI;

     |SI eaPrograma = "agiw0056";
         nCampoNomProv = Campo + 1;
         nCampoNomPobl = -1;
     |FINSI;

     |SI eaPrograma = "agicen24";
         nCampoNomProv = Campo + 2;
         nCampoNomPobl = Campo + 1;
     |FINSI;

     |SI eaPrograma = "agicen25";
         nCampoNomProv = Campo + 2;
         nCampoNomPobl = Campo + 1;
     |FINSI;

     |SI eaPrograma = "agiw0063";
         nCampoNomProv = Campo + 2;
         nCampoNomPobl = Campo + 1;
     |FINSI;

     |SI eaPrograma = "agiw0064";
         |SI Campo = 34;
             nCampoNomProv = Campo + 1;
             nCampoNomPobl = -1;
         |SINO;
             nCampoNomProv = Campo + 2;
             nCampoNomPobl = Campo + 1;
         |FINSI;
     |FINSI;

     |SI eaPrograma = "agiw0065";
         nCampoNomProv = Campo + 2;
         nCampoNomPobl = Campo + 1;
     |FINSI;

     |SI eaPrograma = "agicen28";
         nCampoNomProv = Campo + 2;
         nCampoNomPobl = Campo + 1;
     |FINSI;

     |SI nCampoNomPobl ! -1;
         |ABRE #703;
         nCampoCodProv = Campo - 1;
         nCampoCodPobl = Campo;
         #703#0 = #0nCampoCodProv;
         #703#1 = #0nCampoCodPobl;
         |LEE 040#703=;
         |SI FSalida = 0;
             |HAZ ParrillaPobla;
         |SINO;
             |MENAV "    No existe Poblacion.";
             |ERROR;
         |FINSI;
         |CIERRA #703;
     |SINO;
         nCampoCodProv = Campo;
     |FINSI;

     |ABRE #700;
     #700#0 = #0nCampoCodProv;
     |LEE 040#700=;
     |SI FSalida = 0;
         #0nCampoNomProv = #700#1;
         |PINTA #0nCampoNomProv;
     |SINO;
         |MENAV "    No existe Provinciero.";
         |ERROR;
     |FINSI;
     |CIERRA #700;
|FPRC;

|PROCESO LeeProvincia;
     |DBASS aBase;   |QBT aBase;
     aBase = aBase + "integral/def/dsam0000.mas";
     |XABRE "E", aBase, nCanal;
     |SI FSalida ] 0;
         enSwDeDonde = 1;
         |REFERENCIA_DEF provinc@, #702;
     |SINO;
         enSwDeDonde = 0;
         |REFERENCIA_DEF provinc@, #701;
     |FINSI;

     |ABRE #700;
     #700#0 = enCodProv;
     |LEE 040#700=;
     |SI FSalida ! 0; |DDEFECTO #700; |FINSI;
     |CIERRA #700;
|FPRC;

|PROCESO LeePais;
     |DBASS aBase;   |QBT aBase;
     aBase = aBase + "integral/def/dsam0000.mas";
     |XABRE "E", aBase, nCanal;
     |SI FSalida ] 0;
         enSwDeDonde = 1;
         |REFERENCIA_DEF sgpaises@, #720;
     |SINO;
         enSwDeDonde = 0;
         |REFERENCIA_DEF sgpaises@, #719;
     |FINSI;

     |ABRE #718;
     #718#0 = eaCodPais;
     |LEE 040#718=;
     |SI FSalida ! 0; |DDEFECTO #718; |FINSI;
     |CIERRA #718;
|FPRC;

|PROCESO LeeHacienda;
     |DBASS aBase;   |QBT aBase;
     aBase = aBase + "integral/def/dsam0000.mas";
     |XABRE "E", aBase, nCanal;
     |SI FSalida ] 0;
         enSwDeDonde = 1;
         |REFERENCIA_DEF haciend@, #708;
     |SINO;
         enSwDeDonde = 0;
         |REFERENCIA_DEF haciend@, #707;
     |FINSI;

     |ABRE #706;
     #706#0 = enCodProv; #706#1 = enCodPobl;
     |LEE 040#706=;
     |SI FSalida ! 0; |DDEFECTO #706; |FINSI;
     |CIERRA #706;
|FPRC;

|PROCESO LeeNifs;
     |DBASS aBase;   |QBT aBase;
     aBase = aBase + "integral/def/dsam0000.mas";
     |XABRE "E", aBase, nCanal;
     |SI FSalida ] 0;
         enSwDeDonde = 1;
         |REFERENCIA_DEF regisnif@, #711;
     |SINO;
         enSwDeDonde = 0;
         |REFERENCIA_DEF regisnif@, #710;
     |FINSI;

     eswNif = 0;
     |ABRE #709;
     #709#0 = eaCodNif;
     |LEE 040#709=;
     |SI FSalida ! 0; |DDEFECTO #709; eswNif = 1;  |FINSI;
     |CIERRA #709;
|FPRC;

|PROCESO LeeUsuario;
     |DBASS aBase;   |QBT aBase;
     aBase = aBase + "integral/def/dsam0000.mas";
     |XABRE "E", aBase, nCanal;
     |SI FSalida ] 0;
         enSwDeDonde = 1;
         |REFERENCIA_DEF usuarios@, #714;
     |SINO;
         enSwDeDonde = 0;
         |REFERENCIA_DEF usuarios@, #713;
     |FINSI;

     |ABRE #712;
     #712#0 = eaCodUsu;
     |LEE 040#712=;
     |SI FSalida ! 0; |DDEFECTO #712; |FINSI;
     |CIERRA #712;
|FPRC;

|PROCESO LeePersona;
     |DBASS aBase;   |QBT aBase;
     aBase = aBase + "integral/def/dsam0000.mas";
     |XABRE "E", aBase, nCanal;
     |SI FSalida ] 0;
          enSwDeDonde = 1;
          |REFERENCIA_DEF clientes@, #717;
     |SINO;
          enSwDeDonde = 0;
         |REFERENCIA_DEF clientes@, #716;
     |FINSI;

     |ABRE #715;
     #715#0 = enCodCli;
     |LEE 040#715=;
     |SI FSalida ! 0; |DDEFECTO #715; |FINSI;
     |CIERRA #715;
|FPRC;

|PROCESO Lee5DigSg;
     |DBASS aBase;   |QBT aBase;
     aBase = aBase + "integral/def/dsam0115.mas";
     |XABRE "E", aBase, nCanal;
     |SI FSalida ] 0;
         |ABRE #115;
         #115#0 = eaSigla5;
         |LEE 041#115=;
         |SI FSalida = 0;
             eaSigla5 = #115#2;
         |FINSI;
         |CIERRA #115;
     |FINSI;
|FPRC;

|PROCESO PreparaInformes;
     |DBASS aBase;   |QBT aBase;
     aBase = aBase + "integral/def/dsam0000.mas";
     |XABRE "E", aBase, nCanal;
     |SI FSalida ] 0;
         enSwDeDonde = 1;
     |SINO;
         enSwDeDonde = 0;
     |FINSI;

     |DBASS aBase;   |QBT aBase;

     aFichero = aBase + "basica/def/hacienda.ref";
     |XABRE "W", aFichero, nCanal;
     |SI enSwDeDonde = 1;
         aVariable = ":/integral/def/dsam0102" + &13 + &10;
     |SINO;
         aVariable = "agihacie" + &13 + &10;
     |FINSI;
     |XGRABA nCanal, aVariable;
     |XCIERRA nCanal;

     aFichero = aBase + "basica/def/regisnif.ref";
     |XABRE "W", aFichero, nCanal;
     |SI enSwDeDonde = 1;
         aVariable = ":/integral/def/dsam0103" + &13 + &10;
     |SINO;
         aVariable = "agim0003" + &13 + &10;
     |FINSI;
     |XGRABA nCanal, aVariable;
     |XCIERRA nCanal;

     aFichero = aBase + "basica/def/usuarios.ref";
     |XABRE "W", aFichero, nCanal;
     |SI enSwDeDonde = 1;
         aVariable = ":/integral/def/dsam0108" + &13 + &10;
     |SINO;
         aVariable = "agiusuar" + &13 + &10;
     |FINSI;
     |XGRABA nCanal, aVariable;
     |XCIERRA nCanal;
|FPRC;

|PROCESO SinBarra;  |TIPO 5;
     FSalida = "SINBARRA";
|FPRC;

|PROCESO SacaPantaEpi;  |TIPO 7;
     eaPrograma = Control;  |QBF eaPrograma;

     enSw = 0;
     |HAZ CargaRefer1;
     |SI enSw = 0;  |HAZ CargaRefer2;  |FINSI;
     |SI enSw = 0;  |HAZ CargaRefer3;  |FINSI;

     |SI enSw = 0;  |ACABA;  |FINSI;

     |SI eaPrograma = "agicen14";
         nCampoEpi1 = 2;               || Tipo Epigrafe
         nCampoEpi2 = 3;               || Codigo Epigrafe
         nCampoEpi3 = 4;               || Nombre Epigrafe
         nCampoEpi4 = 16;              || Tipo de Actividad
         nCampoEpi5 = 17;              || Nombre Tipo de Actividad
         nCampoEpi6 = 20;              || CNAE  2009
         nCampoEpi7 = -1;              || Nombre CNAE
         nCampoEpi8 = 21;              || CNAE  2008
         nCampoEpi9 = -1;              || Nombre CNAE
     |FINSI;

     |SI eaPrograma = "agicen30";
         nCampoEpi1 = 3;               || Tipo Epigrafe
         nCampoEpi2 = 4;               || Codigo Epigrafe
         nCampoEpi3 = 5;               || Nombre Epigrafe
         nCampoEpi4 = 12;              || Tipo de Actividad
         nCampoEpi5 = 13;              || Nombre Tipo de Actividad
         nCampoEpi6 = -1;              || CNAE 2009
         nCampoEpi7 = -1;              || Nombre CNAE
         nCampoEpi8 = -1;              || CNAE 2008
         nCampoEpi9 = -1;              || Nombre CNAE
     |FINSI;

     |SI eaPrograma = "agim0019";
         nCampoEpi1 = 46;              || Tipo Epigrafe
         nCampoEpi2 = 47;              || Codigo Epigrafe
         nCampoEpi3 = 48;              || Nombre Epigrafe
         nCampoEpi4 = -1;              || Tipo de Actividad
         nCampoEpi5 = -1;              || Nombre Tipo de Actividad
         nCampoEpi6 = 40;              || CNAE 2009
         nCampoEpi7 = 41;              || Nombre CNAE 2009
         nCampoEpi8 = 81;              || CNAE 2008
         nCampoEpi9 = 82;              || Nombre CNAE 2008
     |FINSI;

     |SI eaPrograma = "agiw0042";
         nCampoEpi1 = 6;              || Tipo Epigrafe
         nCampoEpi2 = 7;              || Codigo Epigrafe
         nCampoEpi3 = 8;              || Nombre Epigrafe
         nCampoEpi4 = -1;             || Tipo de Actividad
         nCampoEpi5 = -1;             || Nombre Tipo de Actividad
         nCampoEpi6 = 4;              || CNAE 2009
         nCampoEpi7 = 5;              || Nombre CNAE 2009
         nCampoEpi8 = 11;             || CNAE 2008
         nCampoEpi9 = 12;             || Nombre CNAE 2008
     |FINSI;

     |SI eaPrograma = "agiw0056";
         nCampoEpi1 = -1;              || Tipo Epigrafe
         nCampoEpi2 = 2;               || Codigo Epigrafe
         nCampoEpi3 = 3;               || Nombre Epigrafe
         nCampoEpi4 = -1;              || Tipo de Actividad
         nCampoEpi5 = -1;              || Nombre Tipo de Actividad
         nCampoEpi6 = -1;              || CNAE 2009
         nCampoEpi7 = -1;              || Nombre CNAE
         nCampoEpi8 = -1;              || CNAE 2008
         nCampoEpi9 = -1;              || Nombre CNAE
     |FINSI;

     |SI eaPrograma = "agiw0058";
         nCampoEpi1 = -1;              || Tipo Epigrafe
         nCampoEpi2 = enCampo;         || Codigo Epigrafe
         nCampoEpi3 = -1;              || Nombre Epigrafe
         nCampoEpi4 = -1;              || Tipo de Actividad
         nCampoEpi5 = -1;              || Nombre Tipo de Actividad
         nCampoEpi6 = -1;              || CNAE 2009
         nCampoEpi7 = -1;              || Nombre CNAE
         nCampoEpi8 = -1;              || CNAE 2008
         nCampoEpi9 = -1;              || Nombre CNAE
     |FINSI;

     |SI eaPrograma = "agiw0064";
         nCampoEpi1 = -1;              || Tipo Epigrafe
         nCampoEpi2 = enCampo;         || Codigo Epigrafe
         nCampoEpi3 = -1;              || Nombre Epigrafe

         |SI enCampo = 4;
             nCampoEpi3 = 5;           || Nombre Epigrafe
         |FINSI;

         nCampoEpi4 = -1;              || Tipo de Actividad
         nCampoEpi5 = -1;              || Nombre Tipo de Actividad
         nCampoEpi6 = -1;              || CNAE 2009
         nCampoEpi7 = -1;              || Nombre CNAE
         nCampoEpi8 = -1;              || CNAE 2008
         nCampoEpi9 = -1;              || Nombre CNAE
     |FINSI;

     |SI nCampoEpi1 ! -1;
         eaTipoEpi = #0nCampoEpi1;
         |SI #0nCampoEpi1 ! "E";  |Y #0nCampoEpi1 ! "P";
          |Y #0nCampoEpi1 ! "A";  |Y #0nCampoEpi1 ! " ";
             eaTipoEpi = "O";
         |FINSI;
     |FINSI;

     enAgrupa = 0;
     |SI eaTipoEpi = "E";
         aAlfa    = #0nCampoEpi2 % 101;
         enAgrupa = aAlfa;
         enAgrupa = enAgrupa * 100;
     |FINSI;

     eaEpigrafe = #0nCampoEpi2;  |QBT eaEpigrafe;
     aAlfa      = eaEpigrafe % 0;
     |SI aAlfa  = "4";
         eaEpigrafe = (eaEpigrafe % 103) + "." + (eaEpigrafe % 401);
     |FINSI;

     |SI eaTipoEpi ! "O";
         |ABRE #602;
         #602#0 = eaTipoEpi;
         #602#1 = enAgrupa;
         #602#2 = eaEpigrafe;
         |LEE 040#602=;
         |SI FSalida ! 0;  nSwPantalla = 1;  |FINSI;
         |CIERRA #602;

         eaCNAE2008 = #602#4;
         eaCNAE2009 = #602#6;
         eaNombEpi  = #602#3;
     |SINO;
         eaEpigrafe = "9999";
         eaNombEpi  = #0nCampoEpi3;
     |FINSI;

     |SI nCampoEpi4 ! -1;
         enSectAct = #0nCampoEpi4;
     |FINSI;

     |SI nSwPantalla = 1;
         |SUB_EJECUTA "agiepiz1";
     |FINSI;

     |SI nCampoEpi1 ! -1;
         |SI #0nCampoEpi1 ! eaTipoEpi;
             |SI nCampoEpi6 ! -1;  #0nCampoEpi6 = "";  |FINSI;
             |SI nCampoEpi8 ! -1;  #0nCampoEpi8 = "";  |FINSI;
         |FINSI;
         #0nCampoEpi1 = eaTipoEpi;
     |FINSI;

     |SI nCampoEpi2 ! -1;
         aAlfa      = eaEpigrafe % 0;
         |SI aAlfa  = "5";
             aAlfa        = (eaEpigrafe % 103) + (eaEpigrafe % 501);

             |SI #0nCampoEpi2 ! aAlfa;
                 |SI nCampoEpi6 ! -1;  #0nCampoEpi6 = "";  |FINSI;
                 |SI nCampoEpi8 ! -1;  #0nCampoEpi8 = "";  |FINSI;
             |FINSI;

             #0nCampoEpi2 = aAlfa;
         |SINO;
             aAlfa = #0nCampoEpi2; |QBF aAlfa;
             |SI aAlfa ! eaEpigrafe;
                 |SI nCampoEpi6 ! -1;  #0nCampoEpi6 = "";  |FINSI;
                 |SI nCampoEpi8 ! -1;  #0nCampoEpi8 = "";  |FINSI;
             |FINSI;

             #0nCampoEpi2 = eaEpigrafe;
         |FINSI;


         |PINTA #0nCampoEpi2;
     |FINSI;

     |SI nCampoEpi3 ! -1;
         #0nCampoEpi3 = eaNombEpi;   |PINTA #0nCampoEpi3;
     |FINSI;

     |SI nCampoEpi4 ! -1;
         #0nCampoEpi4 = enSectAct;   |PINTA #0nCampoEpi4;
         |SI nCampoEpi5 ! -1;
             |ABRE #605;
             #605#0 = #0nCampoEpi4;
             |LEE 040#605=;
             |SI FSalida ! 0;  |DDEFECTO #605;  |FINSI;
             |CIERRA #605;

             #0nCampoEpi5 = #605#1;   |PINTA #0nCampoEpi5;
         |FINSI;
     |FINSI;

     |SI nCampoEpi6 ! -1;
         aAlfa = #0nCampoEpi6;  |QBF aAlfa;
         |SI aAlfa = "";
             #0nCampoEpi6 = eaCNAE2009;      |PINTA #0nCampoEpi6;
             |SI nCampoEpi7 ! -1;
                 |ABRE #636;
                 #636#0 = #0nCampoEpi6;
                 |LEE 040#636=;
                 |SI FSalida ! 0;  |DDEFECTO #636;  |FINSI;
                 |CIERRA #636;

                 #0nCampoEpi7 = #636#1;   |PINTA #0nCampoEpi7;
             |FINSI;
         |FINSI;
     |FINSI;

     |SI nCampoEpi8 ! -1;
         aAlfa = #0nCampoEpi8;  |QBF aAlfa;
         |SI aAlfa = "";
             #0nCampoEpi8 = eaCNAE2008;      |PINTA #0nCampoEpi8;
             |SI nCampoEpi9 ! -1;
                 |ABRE #635;
                 #635#0 = #0nCampoEpi8;
                 |LEE 040#635=;
                 |SI FSalida ! 0;  |DDEFECTO #635;  |FINSI;
                 |CIERRA #635;

                 #0nCampoEpi9 = #635#1;   |PINTA #0nCampoEpi9;
             |FINSI;
         |FINSI;
     |FINSI;

     nSwPantalla = 0;
|FPRC;

|PROCESO ExisteEpi;
     |ET Arriba;

         nSwPantalla = 0;
         |SI FSalida = 10;  nSwPantalla = 1;  |FINSI;

         |HAZ SacaPantaEpi;

     |SI eaTipoEpi ! "O";
         |ABRE #602;
         #602#0 = eaTipoEpi;
         #602#1 = enAgrupa;
         #602#2 = eaEpigrafe;
         |LEE 040#602=;
         |SI FSalida ! 0;
             |CIERRA #602;
             |VETE Arriba;
         |FINSI;
         |CIERRA #602;
     |FINSI;
|FPRC;

|PROCESO BusquedaApli;
     eaPathBasica    = "";
     eaPathDscarter  = "";
     eaPathContagen  = "";
     eaPathContanex  = "";
     eaPathContasoc  = "";
     eaPathRen2019   = "";
     eaPathRen2018   = "";
     eaPathRen2017   = "";
     eaPathRen2016   = "";
     eaPathRen2015   = "";
     eaPathRen2014   = "";
     eaPathRen2013   = "";
     eaPathRen2012   = "";
     eaPathRen2011   = "";
     eaPathRen2010   = "";
     eaPathRen2009   = "";
     eaPathRen2008   = "";
     eaPathRen2007   = "";
     eaPathRen2006   = "";
     eaPathRen2005   = "";
     eaPathRen2004   = "";
     eaPathRen2003   = "";
     eaPathRen2002   = "";
     eaPathRen2001   = "";
     eaPathRen2000   = "";
     eaPathRen1999   = "";
     eaPathRen1998   = "";
     eaPathRen1997   = "";
     eaPathRen1996   = "";
     eaPathRen1995   = "";
     eaPathRen1994   = "";
     eaPathFacturar  = "";
     eaPathLaboral   = "";
     eaPathIntegral  = "";
     eaPathDsmodelo  = "";
     eaPathFiscal    = "";
     eaPathAgitool   = "";
     eaPathDsArchi   = "";

     |DBASS aBase;   |QBF aBase;

     aAlfa = aBase + "basica/def/agifigen.mas";
     |XABRE "E", aAlfa, nCanal;
     |SI FSalida ] 0;
         eaPathBasica = aBase + "basica/";
     |FINSI;

     aAlfa = aBase + "contagen/def/canempre.mas";
     |XABRE "E", aAlfa, nCanal;
     |SI FSalida ] 0;
         eaPathContagen = aBase + "contagen/";
     |FINSI;

     aAlfa = aBase + "contanex/def/vamanpax.mas";
     |XABRE "E", aAlfa, nCanal;
     |SI FSalida ] 0;
         eaPathContanex = aBase + "contanex/";
     |FINSI;

     aAlfa = aBase + "contasoc/def/maempr10.mas";
     |XABRE "E", aAlfa, nCanal;
     |SI FSalida ] 0;
         eaPathContasoc = aBase + "contasoc/";
     |FINSI;

     aAlfa = aBase + "dscarter/def/dscam000.mas";
     |XABRE "E", aAlfa, nCanal;
     |SI FSalida ] 0;
         eaPathDscarter = aBase + "dscarter/";
     |FINSI;

     aAlfa = aBase + "ren2019/def/reacceso.mas";
     |XABRE "E", aAlfa, nCanal;
     |SI FSalida ] 0;
         eaPathRen2019   = aBase + "ren2019/";
     |FINSI;

     aAlfa = aBase + "ren2018/def/reacceso.mas";
     |XABRE "E", aAlfa, nCanal;
     |SI FSalida ] 0;
         eaPathRen2018   = aBase + "ren2018/";
     |FINSI;

     aAlfa = aBase + "ren2017/def/reacceso.mas";
     |XABRE "E", aAlfa, nCanal;
     |SI FSalida ] 0;
         eaPathRen2017   = aBase + "ren2017/";
     |FINSI;

     aAlfa = aBase + "ren2016/def/reacceso.mas";
     |XABRE "E", aAlfa, nCanal;
     |SI FSalida ] 0;
         eaPathRen2016   = aBase + "ren2016/";
     |FINSI;

     aAlfa = aBase + "ren2015/def/reacceso.mas";
     |XABRE "E", aAlfa, nCanal;
     |SI FSalida ] 0;
         eaPathRen2015   = aBase + "ren2015/";
     |FINSI;

     aAlfa = aBase + "ren2014/def/reacceso.mas";
     |XABRE "E", aAlfa, nCanal;
     |SI FSalida ] 0;
         eaPathRen2014   = aBase + "ren2014/";
     |FINSI;

     aAlfa = aBase + "ren2013/def/reacceso.mas";
     |XABRE "E", aAlfa, nCanal;
     |SI FSalida ] 0;
         eaPathRen2013   = aBase + "ren2013/";
     |FINSI;

     aAlfa = aBase + "ren2012/def/reacceso.mas";
     |XABRE "E", aAlfa, nCanal;
     |SI FSalida ] 0;
         eaPathRen2012   = aBase + "ren2012/";
     |FINSI;

     aAlfa = aBase + "ren2011/def/reacceso.mas";
     |XABRE "E", aAlfa, nCanal;
     |SI FSalida ] 0;
         eaPathRen2011   = aBase + "ren2011/";
     |FINSI;

     aAlfa = aBase + "ren2010/def/reacceso.mas";
     |XABRE "E", aAlfa, nCanal;
     |SI FSalida ] 0;
         eaPathRen2010   = aBase + "ren2010/";
     |FINSI;

     aAlfa = aBase + "ren2009/def/reacceso.mas";
     |XABRE "E", aAlfa, nCanal;
     |SI FSalida ] 0;
         eaPathRen2009   = aBase + "ren2009/";
     |FINSI;

     aAlfa = aBase + "ren2008/def/reacceso.mas";
     |XABRE "E", aAlfa, nCanal;
     |SI FSalida ] 0;
         eaPathRen2008   = aBase + "ren2008/";
     |FINSI;

     aAlfa = aBase + "ren2007/def/reacceso.mas";
     |XABRE "E", aAlfa, nCanal;
     |SI FSalida ] 0;
         eaPathRen2007   = aBase + "ren2007/";
     |FINSI;

     aAlfa = aBase + "ren2006/def/reacceso.mas";
     |XABRE "E", aAlfa, nCanal;
     |SI FSalida ] 0;
         eaPathRen2006   = aBase + "ren2006/";
     |FINSI;

     aAlfa = aBase + "ren2005/def/reacceso.mas";
     |XABRE "E", aAlfa, nCanal;
     |SI FSalida ] 0;
         eaPathRen2005   = aBase + "ren2005/";
     |FINSI;

     aAlfa = aBase + "ren2004/def/reacceso.mas";
     |XABRE "E", aAlfa, nCanal;
     |SI FSalida ] 0;
         eaPathRen2004   = aBase + "ren2004/";
     |FINSI;

     aAlfa = aBase + "ren2003/def/reacceso.mas";
     |XABRE "E", aAlfa, nCanal;
     |SI FSalida ] 0;
         eaPathRen2003   = aBase + "ren2003/";
     |FINSI;

     aAlfa = aBase + "ren2002/def/reacceso.mas";
     |XABRE "E", aAlfa, nCanal;
     |SI FSalida ] 0;
         eaPathRen2002   = aBase + "ren2002/";
     |FINSI;

     aAlfa = aBase + "ren2001/def/reacceso.mas";
     |XABRE "E", aAlfa, nCanal;
     |SI FSalida ] 0;
         eaPathRen2001   = aBase + "ren2001/";
     |FINSI;

     aAlfa = aBase + "ren2000/def/reacceso.mas";
     |XABRE "E", aAlfa, nCanal;
     |SI FSalida ] 0;
         eaPathRen2000   = aBase + "ren2000/";
     |FINSI;

     aAlfa = aBase + "ren1999/def/reacceso.mas";
     |XABRE "E", aAlfa, nCanal;
     |SI FSalida ] 0;
         eaPathRen1999   = aBase + "ren1999/";
     |FINSI;

     aAlfa = aBase + "ren1998/def/reacceso.mas";
     |XABRE "E", aAlfa, nCanal;
     |SI FSalida ] 0;
         eaPathRen1998   = aBase + "ren1998/";
     |FINSI;

     aAlfa = aBase + "ren1997/def/reacceso.mas";
     |XABRE "E", aAlfa, nCanal;
     |SI FSalida ] 0;
         eaPathRen1997   = aBase + "ren1997/";
     |FINSI;

     aAlfa = aBase + "ren1996/def/reacceso.mas";
     |XABRE "E", aAlfa, nCanal;
     |SI FSalida ] 0;
         eaPathRen1996   = aBase + "ren1996/";
     |FINSI;

     aAlfa = aBase + "ren1995/def/reacceso.mas";
     |XABRE "E", aAlfa, nCanal;
     |SI FSalida ] 0;
         eaPathRen1995   = aBase + "ren1995/";
     |FINSI;

     aAlfa = aBase + "ren1994/def/reacceso.mas";
     |XABRE "E", aAlfa, nCanal;
     |SI FSalida ] 0;
         eaPathRen1994   = aBase + "ren1994/";
     |FINSI;

     aAlfa = aBase + "facturar/def/asclient.mas";
     |XABRE "E", aAlfa, nCanal;
     |SI FSalida ] 0;
         eaPathFacturar  = aBase + "facturar/";
     |FINSI;

     aAlfa = aBase + "laboral/def/labempre.mas";
     |XABRE "E", aAlfa, nCanal;
     |SI FSalida ] 0;
         eaPathLaboral   = aBase + "laboral/";
     |FINSI;

     aAlfa = aBase + "integral/def/dsam0000.mas";
     |XABRE "E", aAlfa, nCanal;
     |SI FSalida ] 0;
         eaPathIntegral  = aBase + "integral/";
     |FINSI;

     aAlfa = aBase + "modelos/def/dsmom001.mas";
     |XABRE "E", aAlfa, nCanal;
     |SI FSalida ] 0;
         eaPathDsmodelo  = aBase + "modelos/";
     |FINSI;

     aAlfa = aBase + "fiscal/def/eosclien.mas";
     |XABRE "E", aAlfa, nCanal;
     |SI FSalida ] 0;
         eaPathFiscal = aBase + "fiscal/";
     |FINSI;

     aAlfa = aBase + "dsarchi/def/dsarm005.mas";
     |XABRE "E", aAlfa, nCanal;
     |SI FSalida ] 0;
         eaPathDsArchi = aBase + "dsarchi/";
     |FINSI;

     eaPathAgitool = aBase + "agitool/";
|FPRC;

|PROCESO EVENTOCRM;
|FPRC;

|PROCESO LeeUnidadBasico;
     aContiene = "";
     |ESPECIFICA "RBASS", aContiene;
     eaUnidadBasico = (aContiene1 % 102) > "";

     aAlfa = eaUnidadBasico % -101;
     |SI aAlfa ! ":";
         eaUnidadBasico = "";
     |FINSI;
|FPRC;

|PROCESO CogeMac;
     |SI eaDSMAC ! "";  |ACABA;  |FINSI;

     |HAZ LeeUnidadBasico;

     aAlfa = eaUnidadBasico + "\MODELOS";  |RMKDIR aAlfa;
     aAlfa = aAlfa + "\DSMAC";             |RMKDIR aAlfa;

     |DBASE aAlfa;   |QBF aAlfa;
     aAlfa     = aAlfa + "plantillas/";
     aOrigen   = aAlfa + "dsmac.exe";
     aDestino  = eaUnidadBasico + "\MODELOS\DSMAC\DSMAC.EXE";

     aContiene1 = aDestino;
     |ESPECIFICA "REMOTOMD5", aContiene;
     aDocRemoto = FSalida;  |QBF aDocRemoto;

     aContiene1 = aOrigen;
     |ESPECIFICA "MD5", aContiene;
     aDocServidor = FSalida;  |QBF aDocServidor;

     aIPRemoto = "";
     |IP_REMOTO aIPRemoto;  |QBT aIPRemoto;

     |SI aDocRemoto ! aDocServidor;
         |SI aIPRemoto ! "";
             |ENVIA_FICHERO aOrigen, aDestino;
         |SINO;
             |COPIA_FICHERO aOrigen, aDestino;
         |FINSI;
     |FINSI;

     |XABRE "EC", aDestino, nHandle;
     |SI FSalida < 0;
         |SI aIPRemoto ! "";
             |ENVIA_FICHERO aOrigen, aDestino;
         |SINO;
             |COPIA_FICHERO aOrigen, aDestino;
         |FINSI;
     |FINSI;

     aAbre    = eaUnidadBasico + "\MODELOS\DSMAC\DSMAC.TXT";  |RFBORRA aAbre;

     aEjecuta = "cmd " + &34 + "/c START /WAIT " + aDestino + " ";
     aEjecuta = aEjecuta +  eaUnidadBasico + "\MODELOS\DSMAC\DSMAC.TXT" + &34;
     |RSYSTEM aEjecuta;

     aAbre  = eaUnidadBasico + "\MODELOS\DSMAC\DSMAC.TXT";
     nConta = 0;
     |PARA;  |SI;  |HACIENDO;
             |PARA nPausa = 1; |SI nPausa [ 10000; |HACIENDO nPausa = nPausa + 1;
             |SIGUE;

             |XABRE "EC", aAbre, nHandle;
             |SI FSalida ] 0;
                 |SAL;
             |FINSI;

             nConta = nConta + 1;
             |SI nConta > 100;
                 |SAL;
             |FINSI;

             |PULSATECLA;
     |SIGUE;

     aAbre    = eaUnidadBasico + "\MODELOS\DSMAC\DSMAC.TXT";
     |XABRE "EC", aAbre, nHandle;
     |SI FSalida < 0;
         aEjecuta = "START "+ aDestino + " ";
         aEjecuta = aEjecuta +  eaUnidadBasico + "\MODELOS\DSMAC\DSMAC.TXT" + &34;
         |RSYSTEM aEjecuta;

         nConta = 0;
         |PARA;  |SI;  |HACIENDO;
                 |PARA nPausa = 1; |SI nPausa [ 10000; |HACIENDO nPausa = nPausa + 1;
                 |SIGUE;

                 |XABRE "EC", aAbre, nHandle;
                 |SI FSalida ] 0;
                     |SAL;
                 |FINSI;

                 nConta = nConta + 1;
                 |SI nConta > 100;
                     |SAL;
                 |FINSI;

                 |PULSATECLA;
         |SIGUE;
     |FINSI;

     eaDSMAC   = "";
     aAbre    = eaUnidadBasico + "\MODELOS\DSMAC\DSMAC.TXT";
     |XABRE "CU", aAbre, nHandle;
     |SI FSalida < 0;   |ACABA;  |FINSI;

     |XLEE nHandle, 250, eaDSMAC;
     |SI FSalida < 0
         eaDSMAC   = "";
     |FINSI;
     |XCIERRA nHandle;

     |QBF eaDSMAC;
|FPRC;

|PROCESO Explorador;
   |HAZ CogeMac;

   |ABRE #agim0055;
   #agim0055#0 = eaDSMAC;
   |LEE 101#agim0055.=;
   |SI FSalida ! 0;
      |DDEFECTO #agim0055;
      #agim0055#0 = eaDSMAC;
      |GRABA 020#agim0055.b;
   |FINSI;

   eaPathExplorador = #agim0055#1; |QBF eaPathExplorador;
   |SI eaPathExplorador = ""; |O eaForzExplorador = "S";
      |MENAV "0000Busque y pinche en el explorador con el que quiera trabajar";

      eaPathExplorador = "F" + eaPathExplorador;
      |BROWSE eaPathExplorador;
      eaPathExplorador = eaPathExplorador % 290;  |QBF eaPathExplorador;
   |FINSI;

   |SI eaPathExplorador ! "";
      #agim0055#1 = eaPathExplorador;
   |FINSI;
   |GRABA 020#agim0055.a;
   |LIBERA #agim0055; |CIERRA #agim0055;
|FPRC;
