|FICHEROS;
     dscambio;
     agifigen;

    :/modelos/def/dsmom100;
    :/contagen/def/canempre;

    dscambio@;
|FIN;

|VARIABLES;
     &enEmpresa   = 0;
     &enEmpresaN  = 0;
     &enEmpFac    = -1;
     &enCambioCli = 0;

     &eaPasaCact     = "";
     &eaPasaNuct     = "";
     &eaPasaCont     = "";
     &eaPasaFisc     = "";
     &eaPasaSoci     = "";
     &eaPasaRent     = "";
     &eaPasaLabo     = "";
     &eaPasaFact     = "";
     &eaPasaMaes     = "";
     &eaPasaArch     = "";
     &eaPasaR2000    = "";
     &eaPasaR1999    = "";
     &eaPasaR1998    = "";
     &eaPasaR1997    = "";
     &eaPasaR1996    = "";
     &eaPasaR1995    = "";
     &eaPasaR1994    = "";
     &eaPasaR2001    = "";
     &eaPasaR2002    = "";
     &eaPasaR2003    = "";
     &eaPasaR2004    = "";
     &eaPasaR2005    = "";
     &eaPasaR2006    = "";
     &eaPasaR2007    = "";
     &eaPasaR2008    = "";
     &eaPasaR2009    = "";
     &eaPasaR2010    = "";
     &eaPasaR2011    = "";
     &eaPasaR2012    = "";
     &eaPasaR2013    = "";
     &eaPasaR2014    = "";
     &eaPasaR2015    = "";
     &eaPasaR2016    = "";
     &eaPasaR2017    = "";
     &eaPasaR2018    = "";
     &enModeloD      = 0;

    aAlfa1   = "";
    aAlfa2   = "";
    aFichero = "";
    aBase    = "";
    aMas     = "";
    nNume1   = 0;
    nMaximo  = 12;
|FIN;

|PROCESO BuscaConta; |TIPO 8;
     |ABRE #dsmom100;
     |LEE 041#dsmom100.p;
     |SI FSalida ! 0;
        |CIERRA #dsmom100;
        |ACABA;
     |FINSI;
     |CIERRA #dsmom100;

     |ABRE #canempre;
     #canempre#2 =  #dsmom100#1;
     #canempre#3 =  #dsmom100#2;
     |LEE 041#canempre.=;
     |SI FSalida = 0;
         nNume1  = #canempre#13 + 13;
         nMaximo = #canempre#nNume1#;
     |FINSI;
     |CIERRA #canempre;
|FPRC;

|PROCESO Nuevo; |TIPO 0;
     |ABRE #agifigen;
     #agifigen#0 = #dscambio#2;
     |LEE 040#agifigen.=;
     |SI FSalida = 0;
         |MENAV "      El Codigo introducido ya existe.";
         |ERROR;
     |FINSI;
     |CIERRA #agifigen;

     #dscambio@#2 = #dscambio#2;
     |LEE 040#dscambio@.=;
     |SI FSalida = 0;
         |MENAV "      El Codigo introducido ya ha sido introducido en otra linea.";
         |ERROR;
     |FINSI;
|FPRC;

|PROCESO NuevaCta; |TIPO 7;
     |SI #dscambio#3 = "N";
         #dscambio#4 = "";   |C_M #dscambio#4,1,"N";
     |SINO;
         aAlfa2 = "";
         aAlfa1 = #dscambio#2; |QBF aAlfa1;
         aAlfa1 = ("00000" + aAlfa1) % -105;
         nNume1 = nMaximo - 7;
         |SI nNume1 > 0;
             aAlfa2 = "0" * nNume1;
         |FINSI;
         aAlfa1 = "43" + aAlfa2 + aAlfa1;
         #dscambio#4 = aAlfa1;
     |FINSI;

     |PINTA #dscambio#4;
|FPRC;

|PROCESO dscambio;
     |PINTA 0902, #dscambio#0;
     |PINTA 0909, #dscambio#1;
     |PINTA 0951, #dscambio#2;
     |PINTA 0961, #dscambio#3;
     |PINTA 0965, #dscambio#4;

     enEmpresa   = #dscambio#0;
     enEmpresaN  = #dscambio#2;
     enEmpFac    = -1;
     enCambioCli = 1;
     enModeloD   = 0;

     eaPasaCont     = "SI";
     eaPasaFisc     = "SI";
     eaPasaSoci     = "SI";
     eaPasaRent     = "SI";
     eaPasaLabo     = "SI";
     eaPasaFact     = "SI";
     eaPasaMaes     = "SI";
     eaPasaArch     = "SI";
     eaPasaR1994    = "SI";
     eaPasaR1995    = "SI";
     eaPasaR1996    = "SI";
     eaPasaR1997    = "SI";
     eaPasaR1998    = "SI";
     eaPasaR1999    = "SI";
     eaPasaR2000    = "SI";
     eaPasaR2001    = "SI";
     eaPasaR2002    = "SI";
     eaPasaR2003    = "SI";
     eaPasaR2004    = "SI";
     eaPasaR2005    = "SI";
     eaPasaR2006    = "SI";
     eaPasaR2007    = "SI";
     eaPasaR2008    = "SI";
     eaPasaR2009    = "SI";
     eaPasaR2010    = "SI";
     eaPasaR2011    = "SI";
     eaPasaR2012    = "SI";
     eaPasaR2013    = "SI";
     eaPasaR2014    = "SI";
     eaPasaR2015    = "SI";
     eaPasaR2016    = "SI";
     eaPasaR2017    = "SI";
     eaPasaR2018    = "SI";
     eaPasaCact     = #dscambio#3;
     eaPasaNuct     = #dscambio#4;

     |SUB_EJECUTA_NP "dsborrad";
|FPRC;

|DEFBUCLE dscambio;
     #dscambio#1;
     ;
     00001;
     99999;
     ;
     NULL, dscambio;
|FIN;

|PROCESO Baja0;
     #dscambio#0 = 1;
|FPRC;

|PROCESO Alta0;
     #dscambio#0 = 99999;
|FPRC;

|PROGRAMA;
    |CLS;
    |CABEZA "Cambio de Codigos";

    aFichero = ("CB" + Usuario + "zzzzzzzz") % 108;
    |NOME_DAT #dscambio#aFichero#;
    |ABRE #dscambio;  |CIERRA #dscambio;  |DELINDEX #dscambio;

    |DBASE aBase;  |QBF aBase;
    aMas = aBase + "def/dscambio.mas";
    |CARGA_DEF aMas, dscambio@;
    |SI FSalida ! 0;  |ACABA;  |FINSI;
    |NOME_DAT #dscambio@#aFichero#;

    |ABRE #dscambio@;
    |SELECT #2#dscambio@;

    |ENTLINEAL #1#dscambio, -1, 2, 19, 1, Baja0, Alta0;
    |CIERRA #dscambio@;
    |DESCARGA_DEF #dscambio@;

    |CONFI "0000NProcedemos a cambiar los codigos seleccionados.";
    |SI FSalida = 0;
        |BUCLE dscambio;
    |FINSI;

    |ABRE #dscambio;  |CIERRA #dscambio;  |DELINDEX #dscambio;
|FPRO;
