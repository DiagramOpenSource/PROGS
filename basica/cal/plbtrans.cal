|VARIABLES;
     nCaracter       = 0;
     nPos            = 0;
     nCampo          = 0;
     nCampo1         = 0;
     nSer            = 0;
     nLong           = 0;
     nBarra          = 0;
     nCar            = 0;
     nLen            = 0;
     nIdSalir        = 0;
     nVentPlb        = 0;
     nHay            = 0;
     nPaso           = 0;
     nLen1           = 0;
     nEspa           = 0;

     aMensaje        = "";
     aPath           = "";
     aBorra          = "";
     aCamufz         = "";
     aAlfa           = "";
     aAlfa1          = "";
     aAlfa2          = "";
     aIPRemoto       = "";
     aLong           = "";
     aCadena         = "";
     aCaracter       = "";
     aLen            = "";
     aDocRemoto      = "";
     aDocServidor    = "";


     {2}nNivel       = 0;
     {1}aContiene    = "";
     {50}aCarac      = "";

     &eaOrigen       = "";
     &eaDestino      = "";
     &eaRutaOrigen   = "";
     &eaRutaDestino  = "";
     &eaFicheroTar   = "";
     &eaFicheroTxt   = "";
     &eaFicheroTgz   = "";
     &eaAlfa         = "";
     &enSwNuevoMD5   = 0;
|FIN;

|PROCESO RecibeFicheroSinMD5;
     |PULSATECLA;

     aIPRemoto = "";
     |IP_REMOTO aIPRemoto;  |QBT aIPRemoto;

     |SI aIPRemoto ! "";
         |RECIBE_FICHERO eaOrigen, eaDestino;
     |SINO;
         |COPIA_FICHERO eaOrigen, eaDestino;
     |FINSI;

     |SI FSalida ! 0;
         |PULSATECLA;
         |SI aIPRemoto ! "";
             |RECIBE_FICHERO eaOrigen, eaDestino;
         |SINO;
             |COPIA_FICHERO eaOrigen, eaDestino;
         |FINSI;
     |FINSI;

     |PULSATECLA;
|FPRC;

|PROCESO RecibeFicheroConMD5;
     aContiene1 = eaDestino;
     |ESPECIFICA "REMOTOMD5", aContiene;
     aDocRemoto = FSalida;  |QBF aDocRemoto;

     aContiene1 = eaOrigen;
     |ESPECIFICA "MD5", aContiene;
     aDocServidor = FSalida;  |QBF aDocServidor;

     |SI aDocRemoto ! aDocServidor;
         aIPRemoto   = "";
         |IP_REMOTO aIPRemoto;
         |SI aIPRemoto ! "";
             |RECIBE_FICHERO eaDestino, eaOrigen;

             aAlfa = "";
             |DIRECTORIO aAlfa;  |QBF aAlfa;
             aAlfa = aAlfa + "bin/agichmod 777 " + eaOrigen;
             |SYSTEM aAlfa;
         |SINO;
             |COPIA_FICHERO eaDestino, eaOrigen;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO EnviaFicheroSinMD5;
     |PULSATECLA;

     aIPRemoto = "";
     |IP_REMOTO aIPRemoto;  |QBT aIPRemoto;

     |SI aIPRemoto ! "";
         |ENVIA_FICHERO eaOrigen, eaDestino;
     |SINO;
         |COPIA_FICHERO eaOrigen, eaDestino;
     |FINSI;

     |SI FSalida ! 0;
         |PULSATECLA;
         |SI aIPRemoto ! "";
             |ENVIA_FICHERO eaOrigen, eaDestino;
         |SINO;
             |COPIA_FICHERO eaOrigen, eaDestino;
         |FINSI;
     |FINSI;

     |PULSATECLA;
|FPRC;

|PROCESO EnviaFicheroConMD5;
     aContiene1 = eaOrigen;
     |ESPECIFICA "MD5", aContiene;
     aDocRemoto = FSalida;  |QBF aDocRemoto;

     aContiene1 = eaDestino;
     |ESPECIFICA "REMOTOMD5", aContiene;
     aDocServidor  = FSalida;  |QBF aDocServidor;

     enSwNuevoMD5 = 0;
     |SI aDocRemoto ! aDocServidor;  |O aDocRemoto = "";
         aIPRemoto = "";
         |IP_REMOTO aIPRemoto;  |QBT aIPRemoto;

         |SI aIPRemoto ! "";
             |ENVIA_FICHERO eaOrigen, eaDestino;
         |SINO;
             |COPIA_FICHERO eaOrigen, eaDestino;
         |FINSI;
         enSwNuevoMD5 = 1;
     |FINSI;
|FPRC;
