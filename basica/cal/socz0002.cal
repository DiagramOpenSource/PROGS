|FICHEROS;
     socz0002;

     socm0003;
     socm0004;

     socw0005;

     agifigen;
     agim0019;
     agim0025;

     clientes@;
     prestamo@;

     dsinfcoc;
     :/contagen/def/cacuenta;
|FIN;

|VARIABLES;
     nPanta             = 0;
     nRango             = 0;
     nPos1              = 0;
     nPos2              = 0;
     nGridCli           = 0;
     nGridTra           = 0;
     nVentana           = 0;
     nVentTrab          = 0;
     nBoton             = 0;
     nBtnSal            = -1;
     nHay               = -1;
     nDesdeEmp          = -1;
     nHastaEmp          = -1;
     nCampo             = -1;

     aQueBoton          = "";
     aID                = "";
     aFichero           = "";
     aTecla             = "";
     aEsc1              = "";
     aEsc2              = "";
     aRetu              = "";
     aAlfa              = "";
     aDef               = "";
     aMas               = "";
     aQueQuiero         = "";
     aNumCampos         = "";

     fFecha             = @;

     {-1}aVent          = "";
         aVent1         = 0;
         aVent2         = 0;
         aVent3         = 0;
         aVent4         = 0;
         aVent5         = "";

     &enGrid1           = 0;
     &enGrid2           = 0;
     &enBtnRetG1        = 0;
     &enBtnDatG1        = 0;
     &enNumCampos       = 0;
     &enInforme         = 0;
     &enPrint           = 0;
     &enCapPdte         = 0;
     &enRecPdte         = 0;

     &enEmpresa = 0;
   informe       = "";
  &efFecLeg      = @;
   aNombrePDF    = "";
   nSwError      = 0;
   nCalc         = 0;
   aIP           = "";
   &enHayInforme = 0;
{1}aContiene    = "";
|FIN;

|INCLUYE i_agicon;
|INCLUYE i_masivo;

|DEFBUCLE socm0004I;
     #socm0004#2;
     ;
     #socm0003#0, #socm0003#1, #socz0002#2;
     #socm0003#0, #socm0003#1, #socz0002#3;
     ;
     NULL, socm0004I;
|FIN;

|PROCESO prestamoI;
     #socm0003#0 = #prestamo@#0;
     #socm0003#1 = #prestamo@#1;
     |LEE 000#socm0003.=;

     enPrint = 0;
     |BUCLE socm0004I;

     |SI enInforme = 2;
         |SI enPrint = 0;
             |DDEFECTO #socm0004;
             |PRINT;
         |FINSI;
         |PIEINF;
     |FINSI;

     |SI enInforme = 3;
         enCapPdte = 0;
         enRecPdte = 0;
         |BUCLE socm0004I;

         |PRINT;
     |FINSI;
|FPRC;

|DEFBUCLE prestamosI;
     #prestamo@#1002;
     ;
     00001, 00001;
     99999, 99999;
     ;
     NULL, prestamoI;
|FIN;

|PROCESO RecibosPrestamos;
     Impresora = "CrystalReport";
     |IMPRE -1;
     |SI FSalida ! 0;
         |MENAV "    Error en Impresora Crystal Report";
         |ACABA;
     |FINSI;

     |INFOR "soc00301";
     |SI FSalida ! 0; |FINIMP; |ACABA; |FINSI;

     |VENTANA 0501, 0540, -1, 16, "Procesando informe";
     nVentTrab = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentTrab;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PTEC 802; |PAUSA;

     enInforme = 1;

     |ABRE #agifigen;
     |BUCLE prestamosI;
     |CIERRA #agifigen;

     |FININF;
     |FINIMP;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentTrab;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;
     |FINVENTANA nVentTrab;

     |FOCOTECLADO nGridCli;
|FPRC;

|PROCESO FichasPrestamos;
     Impresora = "CrystalReport";
     |IMPRE -1;
     |SI FSalida ! 0;
         |MENAV "    Error en Impresora Crystal Report";
         |ACABA;
     |FINSI;

     |INFOR "soc00302";
     |SI FSalida ! 0; |FINIMP; |ACABA; |FINSI;

     |VENTANA 0501, 0540, -1, 16, "Procesando informe";
     nVentTrab = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentTrab;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PTEC 802; |PAUSA;

     enInforme = 2;

     |ABRE #agifigen;
     |BUCLE prestamosI;
     |CIERRA #agifigen;

     |FININF;
     |FINIMP;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentTrab;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;
     |FINVENTANA nVentTrab;

     |FOCOTECLADO nGridCli;
|FPRC;

|PROCESO ResumenPrestamos;
     Impresora = "CrystalReport";
     |IMPRE -1;
     |SI FSalida ! 0;
         |MENAV "    Error en Impresora Crystal Report";
         |ACABA;
     |FINSI;

     |INFOR "soc00303";
     |SI FSalida ! 0; |FINIMP; |ACABA; |FINSI;

     |VENTANA 0501, 0540, -1, 16, "Procesando informe";
     nVentTrab = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentTrab;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PTEC 802; |PAUSA;

     enInforme = 3;

     |ABRE #agifigen;
     |BUCLE prestamosI;
     |CIERRA #agifigen;

     |PIEINF;
     |FININF;
     |FINIMP;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentTrab;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;
     |FINVENTANA nVentTrab;

     |FOCOTECLADO nGridCli;
|FPRC;

|PROCESO EventoGrid3;
     |SI FSalida = 1;  |O FSalida = 2;
         |LEE 000#prestamo@.=;

         #socm0003#0  = #prestamo@#0;
         #socm0003#1  = #prestamo@#1;
         |LEE 000#socm0003.=;

         |PULSATECLA;
     |FINSI;
|FPRC;

|PROCESO Baja3;
     #prestamo@#0 = #clientes@#0;
     #prestamo@#1 = 1;
|FPRC;

|PROCESO Alta3;
     #prestamo@#0 = #clientes@#0;
     #prestamo@#1 = 99999;
|FPRC;

|PROCESO EventoGridCli;
     |SI FSalida = 1;  |O FSalida = 2;
         |LEE 000#clientes@.=;

         |REFRESCACONTROL enGrid1;
     |FINSI;

     |PULSATECLA;
|FPRC;

|PROCESO BajaGridTra;
     #socm0003#0 = #prestamo@#0;
     #socm0003#1 = #prestamo@#1;
|FPRC;

|PROCESO AltaGridTra;
     #socm0003#0 = #prestamo@#0;
     #socm0003#1 = #prestamo@#1;
|FPRC;

|PROCESO VerDatos;

     |VENTANA 0501, 3799, -1, 17, "Prestamo";
     nVentTrab = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentTrab;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PINPA #0#socw0005;

     nRango = 4 + 8 + 16 + 32 + 128;

     |LINEAL_SIMPLE #1#socm0003, nRango, 0602, 1698, BajaGridTra, AltaGridTra, NULL;
     nGridTra = FSalida;

     FSalida = 1;  |HAZ PintaDatosPantalla;

     aEsc1  = &255 + "806";
     aEsc2  = &255 + "807";
     aRetu  = &255 + "802";
     |PARA; |SI;  |HACIENDO;
          FSalida = "::{{001}}Salir," + nGridTra;
          |LEETECLA aTecla;
          |SI aTecla = aEsc1; |SAL;  |FINSI;
          |SI aTecla = aEsc2; |SAL;  |FINSI;
          |SI aTecla = aRetu; |SAL;  |FINSI;
     |SIGUE;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentTrab;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nVentTrab;
|FPRC;

|PROCESO BtnsGrid1;
     |CONTROL_SIMPLE nPanta, "BOTON,{{197}}Recibos ", 3676, 3686, Recibos;
     enBtnRetG1 = FSalida;

     |CONTROL_SIMPLE nPanta, "BOTON,{{197}}Ver datos", 3688, 3698, VerDatos;
     enBtnDatG1 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{197}}Recibos liquidaci¢n", 3602, 3720, RecibosPrestamos;
     |CONTROL_SIMPLE 0, "BOTON,{{197}}Fichas prestamos", 3622, 3740, FichasPrestamos;
     |CONTROL_SIMPLE 0, "BOTON,{{197}}Resumen prestamos", 3642, 3760, ResumenPrestamos;
|FPRC;

|PROCESO Procesar;
     |DESTRUYECONTROL nGridCli;
     |PULSATECLA;

     |FIN_CONTROL_WINDOWS nBtnSal;

     |HAZ BtnsGrid1;

     nRango = 4 + 8 + 16 + 32 + 128;
     |LINEAL_SIMPLE #1#prestamo@, nRango, 2301, 3599, Baja3, Alta3, EventoGrid3;
     enGrid1 = FSalida;

     nRango = 4 + 8 + 16 + 32 + 128;
     |LINEAL_SIMPLE #1#clientes@, nRango, 1001, 2199, NULL, NULL, EventoGridCli;
     nGridCli = FSalida;

     aEsc1  = &255 + "806";
     aEsc2  = &255 + "807";
     aRetu  = &255 + "802";
     |PARA; |SI;  |HACIENDO;
          FSalida = "::{{001}}Salir," + nGridCli;
          |LEETECLA aTecla;
          |SI aTecla = aEsc1; |SAL;  |FINSI;
          |SI aTecla = aEsc2; |SAL;  |FINSI;
          |SI aTecla = aRetu; |SAL;  |FINSI;
     |SIGUE;
|FPRC;

|PROCESO socm0004;
     nHay = 1;
     |ERROR10;
|FPRC;

|DEFBUCLE socm0004;
     #socm0004#2;
     ;
     #socm0003#0, #socm0003#1, #socz0002#2;
     #socm0003#0, #socm0003#1, #socz0002#3;
     ;
     NULL, socm0004;
|FIN;

|PROCESO socm0003;
     |SI #socz0002#4 ! "T";
         nHay = 0;
         |BUCLE socm0004;

         |SI nHay = 0;
             |SI #socm0003#12 ! "M";
                 |ACABA;
             |FINSI;

             |SI #socm0003#12 = "M";
                 |SI #socm0003#8 = 0;
                     |ACABA;
                 |FINSI;
             |FINSI;
         |FINSI;
     |FINSI;

     |PARA nCampo = 0;  |SI nCampo [ 19;  |HACIENDO nCampo = nCampo + 1;
           #prestamo@#nCampo# = #socm0003#nCampo#;
     |SIGUE;

     |GRABA 020#prestamo@.n;
     |LIBERA #prestamo@;

     #clientes@#0 = #prestamo@#0;
     |LEE 000#clientes@.=;
     |SI FSalida = 0;  |ACABA;  |FINSI;

     #agifigen#0 = #prestamo@#0;
     |LEE 000#agifigen.=;
     |SI FSalida ! 0;  |DDEFECTO #agifigen;  |FINSI;

     |PARA nCampo = 0;  |SI nCampo [ 105;  |HACIENDO nCampo = nCampo + 1;
           #clientes@#nCampo# = #agifigen#nCampo#;
     |SIGUE;

     |GRABA 020#clientes@.n;
     |LIBERA #clientes@;
|FPRC;

|DEFBUCLE socm0003;
     #socm0003#1;
     ;
     nDesdeEmp, 00000;
     nHastaEmp, 99999;
     ;
     NULL, socm0003;
|FIN;

|PROCESO Tipo12Fz2;  |TIPO 12;
     |SI FSalida = 7;  |ACABA;  |FINSI;

     |SI eaPathContagen ! "";
         enEmpresa = #socz0002#0;
         |HAZ SituaMaestra;
         |PATH_DAT #cacuenta#aPathConta#;
     |FINSI;

     |VENTANA 0501, 0540, -1, 17, "Procesando trabajo";
     nVentTrab = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentTrab;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     nDesdeEmp = #socz0002#0;
     nHastaEmp = #socz0002#0;

     |SI #socz0002#0 = 0;
         nDesdeEmp = 1;
         nHastaEmp = 99999;
     |FINSI;

     |ABRE #agifigen;
     |BUCLE socm0003;
     |CIERRA #agifigen;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentTrab;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nVentTrab;

     |LEE 000#clientes@.p;
     |SI FSalida ! 0;
         |MENAV "0000Selecci¢n vac¡a.";
         |ACABA;
     |FINSI;

     |HAZ Procesar;
|FPRC;

|PROCESO Salir;
     |PTEC 807;
|FPRC;

|PROCESO PtecFinalFz2;  |TIPO 0;
     |PTEC 806;
|FPRC;

|PROCESO Tipo0C4Fz2;  |TIPO 0;
     |C_M #socz0002#2, 1, "S";
     |C_M #socz0002#3, 1, "S";

     |SI #socz0002#4 = "T";
         |C_M #socz0002#2, 1, "N";  #socz0002#2 = "01.01.0000";
         |C_M #socz0002#3, 1, "N";  #socz0002#3 = "31.12.2099";
     |FINSI;

     |PINTA #socz0002#2;
     |PINTA #socz0002#3;
|FPRC;

|PROCESO Tipo7C0Fz2;  |TIPO 7;
     |SI nBtnSal ! -1;  |ACABA;  |FINSI;

     aQueBoton = "|X000";
     aID       = #socz0002#aQueBoton#;
     nBoton    = aID;
     |ESTADO_CONTROL nBoton, "HIDE";

     aQueBoton = "|X001";
     aID       = #socz0002#aQueBoton#;
     nBoton    = aID;
     |ESTADO_CONTROL nBoton, "HIDE";

     |CONTROL_SIMPLE 0, "BOTON,{{001}}Salir", 3688, 3698, Salir;
     nBtnSal = FSalida;
|FPRC;

|PROCESO Tipo0C0Fz2;  |TIPO 0;
     |SI #socz0002#0 = 0;
         #socz0002#1 = "Todas";
     |SINO;
         |ABRE #agifigen;
         #agifigen#0 = #socz0002#0;
         |LEE 000#agifigen.=;
         |SI FSalida ! 0;
             |MENAV "0000No exite la empresa.";
             |ERROR;
             |CIERRA #agifigen;
             |ACABA;
         |FINSI;
         |CIERRA #agifigen;

         #socz0002#1 = #agifigen#1;
     |FINSI;

     |PINTA #socz0002#1;
|FPRC;

|PROCESO InformePDF;
   nSwError = 0;

   aIP = ""; |IP_REMOTO aIP;
   aContiene = "";
   |ESPECIFICA "RBASS", aContiene;
   aAlfa = aContiene1;
   aAlfa = aAlfa - "\";
   |SI FSalida ! 0;
      nCalc = ((FSalida / 100) ! 0) + 99;
      aAlfa = aAlfa % nCalc;
   |SINO;
      aAlfa = aAlfa - "/";
      |SI FSalida ! 0;
         nCalc = ((FSalida / 100) ! 0) + 99;
         aAlfa = aAlfa % nCalc;
      |FINSI;
   |FINSI;

   aAlfa = eaPathTemporal;
   aNombrePDF = (("00" + enOrMvo) % - 102) + aNombrePDF;

   |SI aIP ! "";
       |RMKDIR aAlfa;
   |SINO;
       |MKDIR aAlfa;
   |FINSI;

   Impresora = "CrystalReport;" + aAlfa + aNombrePDF;
   |IMPRE -1;
   |SI FSalida = 0;
       |INFOR informe;
       |SI FSalida ! 0;
          || |SI nSwMen = 0; |MENAV "     Error en informe."; |FINSI;
          nSwError = 1;
       |FINSI;
   |FINSI;
   enHayInforme = 1;
|FPRC;

|PROCESO LosInfBasica;
    |ABRE #dsinfcoc;
    |DDEFECTO #dsinfcoc;
    #dsinfcoc#0 = enCoMvo;
    |LEE 041#dsinfcoc.=;
    |CIERRA #dsinfcoc;
|FPRC;

|PROCESO InformeEspecial;
     |SI enNuMvo = 1;
         informe = "soc00302";
         enInforme = 2;
     |SINO;
         informe = "soc00303";
         enInforme = 3;
     |FINSI;

     aNombrePDF = "Socios" + enNuMvo + ".pdf";
     |HAZ InformePDF;
     |SI nSwError = 1; |ACABA; |FINSI;

     |ABRE #agifigen;
     |BUCLE prestamosI;
     |CIERRA #agifigen;

     |PIEINF;
     |FININF;
     |FINIMP;

|FPRC;

|PROGRAMA;
     |HAZ BusquedaApli;

     |SI enSwMvo = 2;
         |DDEFECTO #socz0002;

         #socz0002#0 = enEmprM;
         |HAZ LosInfBasica;
         #socz0002#2 = #dsinfcoc#141;
         #socz0002#3 = #dsinfcoc#142;
         #socz0002#4 = #dsinfcoc#140;

         |ABRE #agifigen;
         #agifigen#0 = #socz0002#0;
         |LEE 000#agifigen.=;
         |SI FSalida ! 0;  |DDEFECTO #agifigen;  |FINSI;
         |CIERRA #agifigen;

         #socz0002#1 = #agifigen#1;

         nDesdeEmp = #socz0002#0;
         nHastaEmp = #socz0002#0;

         |ABRE #agifigen;
         |BUCLE socm0003;
         |CIERRA #agifigen;

         |HAZ InformeEspecial;

         |ACABA;
     |FINSI;

     |CLS;

     |PINPA #0#socz0002; nPanta = FSalida;
     |PINDA #0#socz0002;

     nRango = 4 + 8 + 16 + 32 + 128;

     |LINEAL_SIMPLE #1#clientes@, nRango, 1001, 2199, NULL, NULL, NULL;
     nGridCli = FSalida;

     |ENDATOS #1#socz0002;
|FPRO;

|PROCESO Tipo80Fz2;  |TIPO 80;
     aQueQuiero  = "|NC";
     aNumCampos  = #socw0005#aQueQuiero#;
     enNumCampos = aNumCampos;
     enNumCampos = enNumCampos - 1;

     |DDEF aDef;
     aMas = aDef + "agifigen.mas";  |CARGA_DEF aMas, clientes@;
     aMas = aDef + "socm0003.mas";  |CARGA_DEF aMas, prestamo@;

     aFichero = "clientes" + Usuario;  |NOME_DAT #clientes@#aFichero#;
     aFichero = "prestamo" + Usuario;  |NOME_DAT #prestamo@#aFichero#;

     |ABRE #clientes@;  |CIERRA #clientes@;  |DELINDEX #clientes@;
     |ABRE #prestamo@;  |CIERRA #prestamo@;  |DELINDEX #prestamo@;

     |ABRET #clientes@;
     |ABRET #prestamo@;
     |ABRET #socm0003;
     |ABRET #socm0004;

     FSalida = 3799;
|FPRC;

|PROCESO Tipo90Fz2;  |TIPO 90;
     |CIERRAT #socm0003;
     |CIERRAT #socm0004;

     |CIERRAT #prestamo@;  |DELINDEX #prestamo@;
     |CIERRAT #clientes@;  |DELINDEX #clientes@;

     |DESCARGA_DEF #prestamo@;
     |DESCARGA_DEF #clientes@;
|FPRC;
