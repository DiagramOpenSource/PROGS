|FICHEROS;
    agicen08 #8;
    :/integral/def/dsam0005 #95;   || FICHA GENERAL DE CLIENTES.

    &clientes@ #715;
|FIN;

|VARIABLES;
     &enEmpresa   = 0;
     &enActividad = 0;
     &enContador  = 0;
     &enTipo      = 0;
     &eaNombreEmp = "";
     &eaNombreAct = "";
     &efFechaAlta = @;
     &efFechaBaja = @;
     &eaCodEpi1   = "";
     &eaCodEpi2   = "";
     &enCodCli    = 0;
     &enSwDeDonde = 0;

     fFechaSys    = @;
     aAlfa        = "";
     nCampo1      = 0;
     nCampo2      = 0;
     nCampo3      = 0;
     nCoef1       = 0;
     nCoef2       = 0;
     nCampo       = 0;

    &enCodProv   = 0;
    &enCodPobl   = 0;
    &eaPoblacion = "";
    &enModoPob   = 1;
|FIN;

|PROCESO NombreRepre;
     |HAZ LeeNifs;     || Esto no haze n  pero quien lo toque
                       || los corto lo guevos  PARAQUITAR
|FPRC;

|PROCESO Anyo; |TIPO 7;
     |SI #8#4 ! 0; |ACABA; |FINSI;

     fFechaSys = ~;
     aAlfa      = fFechaSys % -104;
     #8#4      = aAlfa;
     |PINTA #8#4;
|FPRC;

|PROCESO Cuadro1; |TIPO 7;
     |PUSHV 0944 1979;
     |CUADRO 0944 1979;
     |ATRI R;
     |PINTA 1045, " Declaracion de :                 ";
     |PINTA 1145, "    Alta ...................... 1 ";
     |PINTA 1245, "    Baja ...................... 2 ";
     |PINTA 1345, "                                  ";
     |PINTA 1445, " Variacion                        ";
     |PINTA 1545, "    Cambio opcion Alta ........ 3 ";
     |PINTA 1645, "    Cambio opcion Baja ........ 4 ";
     |PINTA 1745, "    Elementos tributarios ..... 5 ";
     |PINTA 1845, "    Otras causas .............. 6 ";
     |ATRI 0;
|FPRC;

|PROCESO Cuadro2; |TIPO 7;
     |PUSHV 1617 2052;
     |CUADRO 1617 2052;
     |ATRI R;
     |PINTA 1718, " Regla(s) que son de aplicacion   ";
     |PINTA 1818, "    Regla 4¦ 2F) .............. 1 ";
     |PINTA 1918, "    Regla 7¦. ................. 2 ";
     |ATRI 0;
|FPRC;

|PROCESO Cuadro3; |TIPO 7;
     |PUSHV 1632 2067;
     |CUADRO 1632 2067;
     |ATRI R;
     |PINTA 1733, " Exencion que solicita :          ";
     |PINTA 1833, "    Articulo 83.1.d) .......... 1 ";
     |PINTA 1933, "    Articulo 83.1.e) .......... 2 ";
     |ATRI 0;
|FPRC;

|PROCESO Cuadro4; |TIPO 7;
     |PUSHV 1344 2074;
     |CUADRO 1344 2074;
     |ATRI R;
     |PINTA 1445, " AL - Almacen                ";
     |PINTA 1545, " DP - Depositos              ";
     |PINTA 1645, " CD - Centro de Direccion    ";
     |PINTA 1745, " OF - Oficina Administrativa ";
     |PINTA 1845, " CC - Centro de Calculo      ";
     |PINTA 1945, " OT - Otros                  ";
     |ATRI 0;
|FPRC;

|PROCESO Cuadro5; |TIPO 7;
     |PUSHV 0941 1776;
     |CUADRO 0941 1776;
     |ATRI R;
     |PINTA 1042, " Darse de Alta ................ 1 ";
     |PINTA 1142, " Darse de Baja ................ 2 ";
     |PINTA 1242, " Declarar Variaciones ......... 3 ";
     |PINTA 1342, " Alta local indirec.afecto .... 4 ";
     |PINTA 1442, " Baja local indirec.afecto .... 5 ";
     |PINTA 1542, " Var. local indirec.afecto .... 6 ";
     |PINTA 1642, " Rectificar (Complementaria) .. 7 ";
     |ATRI 0;
|FPRC;

|PROCESO Reponer; |TIPO 0;
     |POPV;
     |PINTA #8Campo;
|FPRC;

|PROCESO Declarar; |TIPO 0;
     |SI eaCodEpi1 ! "P";
         |C_M #8#33, 1, "N";
     |SINO;
         |C_M #8#33, 1, "S";
     |FINSI;

     |C_M #8#6, 1, "N";

     |SI #8#113 = 1; |O #8#113 = 4;
         |C_M #8#5, 1, "N";
         #8#5 = 1;   |PINTA #8#5;
     |FINSI;

     |SI #8#113 = 2; |O #8#113 = 5;
         |C_M #8#5, 1, "N";
         #8#5 = 2;   |PINTA #8#5;
     |FINSI;

     |SI #8#113 = 3; |O #8#113 = 6;
         |C_M #8#5, 1, "S";
         |SI #8#5 < 3; #8#5 = 3; |PINTA #8#5; |FINSI;
     |FINSI;

     |SI #8#113 = 7;
         |C_M #8#5, 1, "S";
         |C_M #8#6, 1, "S";
     |FINSI;

     |SI #8#113 = 4; |O #8#113 = 5; |O #8#113 = 6;
         #8#6 = "X";
     |SINO;
         |SI #8#113 ! 7; #8#6 = " "; |FINSI;
     |FINSI;
     |PINTA #8#6;
|FPRC;


|PROCESO Tipo1;  || Alta sin locales afectos
     |SI #8#113 ! 7; |C_M #8#32, 1, "N"; #8#32 = ""; |FINSI;
     |C_M #8#31, 1, "N";

     |PARA nCampo = 36; |SI nCampo [ 49; |HACIENDO nCampo = nCampo + 1;
           |C_M #8nCampo, 1, "N";
     |SIGUE;

     #8#31 = ""; |PINTA #8#31;   #8#36 = ""; |PINTA #8#36;
     #8#37 = 0;  |PINTA #8#37;   #8#38 = 0;  |PINTA #8#38;
     #8#39 = ""; |PINTA #8#39;   #8#40 = ""; |PINTA #8#40;
     #8#41 = ""; |PINTA #8#41;   #8#42 = ""; |PINTA #8#42;
     #8#43 = ""; |PINTA #8#43;   #8#44 = ""; |PINTA #8#44;
     #8#45 = ""; |PINTA #8#45;   #8#46 = ""; |PINTA #8#46;
     #8#47 = ""; |PINTA #8#47;   #8#48 = ""; |PINTA #8#48;
     #8#49 = ""; |PINTA #8#49;
     |PINTA #8#32;
     |PINTA #8#35;
|FPRC;

|PROCESO Tipo2;  || Baja sin locales afectos
     |PARA nCampo = 20; |SI nCampo [ 87; |HACIENDO nCampo = nCampo + 1;
           |C_M #8nCampo, 1, "N";
     |SIGUE;

     |C_M #8#30, 1, "S";
     |C_M #8#31, 1, "S";
     |C_M #8#35, 1, "S";

     |SI #8#113 = 7;
         |C_M #8#32, 1, "S";
     |SINO;
         #8#32 = "";
         |PINTA #8#32;
     |FINSI;

     #8#020 = "";             |PINTA #8#020;
     #8#021 = "";             |PINTA #8#021;
     #8#022 = "";             |PINTA #8#022;
     #8#023 = "";             |PINTA #8#023;
     #8#024 = "";             |PINTA #8#024;
     #8#025 = 0;              |PINTA #8#025;
     #8#026 = 0;              |PINTA #8#026;
     #8#027 = "";             |PINTA #8#027;
     #8#028 = 0;              |PINTA #8#028;
     #8#029 = "01.01.0000";   |PINTA #8#029;
     #8#033 = 0;              |PINTA #8#033;
     #8#034 = "";             |PINTA #8#034;
     #8#036 = "";             |PINTA #8#036;
     #8#037 = 0;              |PINTA #8#037;
     #8#038 = 0;              |PINTA #8#038;
     #8#039 = "";             |PINTA #8#039;
     #8#040 = "";             |PINTA #8#040;
     #8#041 = "";             |PINTA #8#041;
     #8#042 = "";             |PINTA #8#042;
     #8#043 = "";             |PINTA #8#043;
     #8#044 = "";             |PINTA #8#044;
     #8#045 = "";             |PINTA #8#045;
     #8#046 = "";             |PINTA #8#046;
     #8#047 = "";             |PINTA #8#047;
     #8#048 = "";             |PINTA #8#048;
     #8#049 = "";             |PINTA #8#049;

     |PARA nCampo = 50; |SI nCampo [ 57; |HACIENDO nCampo = nCampo + 1;
           #8nCampo = 0; |PINTA #8nCampo;
     |SIGUE;

     |PARA nCampo = 58; |SI nCampo [ 65; |HACIENDO nCampo = nCampo + 1;
           #8nCampo = ""; |PINTA #8nCampo;
     |SIGUE;

     |PARA nCampo = 66; |SI nCampo [ 112; |HACIENDO nCampo = nCampo + 1;
           #8nCampo = 0; |PINTA #8nCampo;
     |SIGUE;
|FPRC;

|PROCESO Tipo3;  || Variacion sin locales afectos
     |SI #8#113 ! 7; |C_M #8#32, 1, "N"; #8#32 = ""; |FINSI;

     |PARA nCampo = 36; |SI nCampo [ 49; |HACIENDO nCampo = nCampo + 1;
           |C_M #8nCampo, 1, "N";
     |SIGUE;

     #8#036 = "";             |PINTA #8#036;
     #8#037 = 0;              |PINTA #8#037;
     #8#038 = 0;              |PINTA #8#038;
     #8#039 = "";             |PINTA #8#039;
     #8#040 = "";             |PINTA #8#040;
     #8#041 = "";             |PINTA #8#041;
     #8#042 = "";             |PINTA #8#042;
     #8#043 = "";             |PINTA #8#043;
     #8#044 = "";             |PINTA #8#044;
     #8#045 = "";             |PINTA #8#045;
     #8#046 = "";             |PINTA #8#046;
     #8#047 = "";             |PINTA #8#047;
     #8#048 = "";             |PINTA #8#048;
     #8#049 = "";             |PINTA #8#049;
|FPRC;

|PROCESO Tipo4;  || Alta con locales afectos
     |SI #8#113 ! 7; |C_M #8#32, 1, "N"; #8#32 = ""; |FINSI;
     |C_M #8#31, 1, "N";

     #8#31 = ""; |PINTA #8#31;
|FPRC;

|PROCESO Tipo5;  || Baja con locales afectos
     |SI #8#113 ! 7; |C_M #8#32, 1, "N"; #8#32 = ""; |FINSI;

     |PARA nCampo = 20; |SI nCampo [ 29; |HACIENDO nCampo = nCampo + 1;
           |C_M #8nCampo, 1, "N";
     |SIGUE;

     |C_M #8#033, 1, "N";
     |C_M #8#034, 1, "N";

     |PARA nCampo = 50; |SI nCampo [ 57; |HACIENDO nCampo = nCampo + 1;
           |C_M #8nCampo, 1, "N";
     |SIGUE;

     |PARA nCampo = 66; |SI nCampo [ 87; |HACIENDO nCampo = nCampo + 1;
           |C_M #8nCampo, 1, "N";
     |SIGUE;

     #8#020 = "";             |PINTA #8#020;
     #8#021 = "";             |PINTA #8#021;
     #8#022 = "";             |PINTA #8#022;
     #8#023 = "";             |PINTA #8#023;
     #8#024 = "";             |PINTA #8#024;
     #8#025 = 0;              |PINTA #8#025;
     #8#026 = 0;              |PINTA #8#026;
     #8#027 = "";             |PINTA #8#027;
     #8#028 = 0;              |PINTA #8#028;
     #8#029 = "01.01.0000";   |PINTA #8#029;
     #8#033 = 0;              |PINTA #8#033;
     #8#034 = "";             |PINTA #8#034;

     |PARA nCampo = 50; |SI nCampo [ 57; |HACIENDO nCampo = nCampo + 1;
           #8nCampo = 0; |PINTA #8nCampo;
     |SIGUE;

     |PARA nCampo = 58; |SI nCampo [ 65; |HACIENDO nCampo = nCampo + 1;
           #8nCampo = ""; |PINTA #8nCampo;
     |SIGUE;

     |PARA nCampo = 66; |SI nCampo [ 112; |HACIENDO nCampo = nCampo + 1;
           #8nCampo = 0; |PINTA #8nCampo;
     |SIGUE;
|FPRC;

|PROCESO TipoM; |TIPO 0;
     |SI #8#113 = 3; |O #8#113 = 6;
         |SI #8#5 < 3;
             |HAZ Cuadro1;
             |MENAV "    Valor superior a 2.";
             |ERROR;
             |ACABA;
         |FINSI;
     |FINSI;

     |PARA nCampo = 20; |SI nCampo [ 87; |HACIENDO nCampo = nCampo + 1;
           |SI nCampo ! 33;
               |SI nCampo [ 57; |C_M #8nCampo, 1, "S"; |FINSI;
               |SI nCampo ] 67; |C_M #8nCampo, 1, "S"; |FINSI;
           |FINSI;
     |SIGUE;

     |C_M #8#40, 1, "N";

     || Tipo 1  Alta sin locales afectos
     || Tipo 2  Baja sin locales afectos
     || Tipo 3  Alta en variacion
     || Tipo 4  Alta con locales afectos
     || Tipo 5  Baja con locales afectos


     |SI #8#113 = 1; |HAZ Tipo1; |FINSI;
     |SI #8#113 = 2; |HAZ Tipo2; |FINSI;
     |SI #8#113 = 3;
         |SI #8#5 = 4;
             |HAZ Tipo2;
         |SINO;
             |HAZ Tipo3;
         |FINSI;
     |FINSI;
     |SI #8#113 = 4; |HAZ Tipo4; |FINSI;
     |SI #8#113 = 5; |HAZ Tipo5; |FINSI;
     |SI #8#113 = 6;
         |SI #8#5 = 4; |HAZ Tipo5; |FINSI;
     |FINSI;

     |SI #8#113 = 7;
         |SI #8#6 = " ";
             |SI #8#5 = 1; |HAZ Tipo1; |FINSI;
             |SI #8#5 = 2; |HAZ Tipo2; |FINSI;
             |SI #8#5 = 3; |HAZ Tipo3; |FINSI;
             |SI #8#5 = 4; |HAZ Tipo2; |FINSI;
             |SI #8#5 = 5; |HAZ Tipo3; |FINSI;
             |SI #8#5 = 6; |HAZ Tipo3; |FINSI;
         |SINO;
             |SI #8#5 = 1; |HAZ Tipo4; |FINSI;
             |SI #8#5 = 2; |HAZ Tipo5; |FINSI;
             |SI #8#5 = 4; |HAZ Tipo5; |FINSI;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO Panta3; |TIPO 0;
     nCampo2 = Campo   + 12;
     nCampo3 = nCampo2 + 12;

     #8#88   = #8#88 - #8Campo;
     #8#100  = #8#100 - #8nCampo2;
     #8#112  = #8#112 - #8nCampo3;
     nCoef2  = .95;

     |SI Campo = 77; nCoef1 = 1; |FINSI;
     |SI Campo = 78; nCoef1 = 1;  nCoef2 = .60; |FINSI;
     |SI Campo = 79; nCoef1 = .20; |FINSI;
     |SI Campo = 80; nCoef1 = .05; |FINSI;
     |SI Campo = 81; nCoef1 = .20; |FINSI;
     |SI Campo = 82; nCoef1 = .40; |FINSI;
     |SI Campo = 83; nCoef1 = .10; |FINSI;
     |SI Campo = 84; nCoef1 = .50; |FINSI;
     |SI Campo = 85; nCoef1 = .50; |FINSI;
     |SI Campo = 86; nCoef1 = .55; |FINSI;
     |SI Campo = 87; nCoef1 = .55; |FINSI;

     |SI #8Campo ! 0;
         #8nCampo2 = #8Campo * nCoef1;
     |SINO;
         #8nCampo2 = 0;
     |FINSI;

     |SI #8nCampo2 ! 0;
         #8nCampo3 = #8nCampo2 * nCoef2;
     |SINO;
         #8nCampo3 = 0;
     |FINSI;

     #8#88 = 0;  #8#100 = 0;  #8#112 = 0;

     |PINTA #8Campo;
     |PINTA #8nCampo2;
     |PINTA #8nCampo3;

     |PARA nCampo1 = 77;  |SI nCampo1 [ 87;  |HACIENDO nCampo1 = nCampo1 + 1;
           nCampo2 = nCampo1 + 12;
           nCampo3 = nCampo2 + 12;
           #8#88   = #8#88  + #8nCampo1;
           #8#100  = #8#100 + #8nCampo2;
           #8#112  = #8#112 + #8nCampo3;
     |SIGUE;

     |PINTA #8#88;
     |PINTA #8#100;
     |PINTA #8#112;
|FPRC;

||--------------------------------------------------------------------------

|PROCESO LeeFicha;
     enCodCli = #8#0;
     |HAZ LeePersona;
     |SI enSwDeDonde = 1;
         |ABRE #95;
         #95#0 = #8#0;    || CODIGO EMPRESA.
         #95#1 = #8#114;  || CODIGO ACTIVIDAD
         |LEE 000#95=;
         |SI FSalida ! 0;  |DDEFECTO #95;  |FINSI;
         |CIERRA #95;

         #8#9  = #95#3;      || SG.
         #8#10 = #95#4;      || DOMICILIO.
         #8#11 = #95#9;      || CP.
         #8#12 = #95#10;     || CP.
         #8#13 = #95#5;      || NUMERO.
         #8#14 = "";         || KILOMETRO.
         #8#15 = "";         || PTO.
         #8#16 = #95#6;      || ESCALERA.
         #8#17 = #95#7;      || PISO.
         #8#18 = #95#8;      || PUERTA.
         #8#19 = #715#54;    || TELEFONO.
         #8#7  = #95#11;     || POBLACION.
         #8#8  = #95#12;     || PROVINCIA.
    |SINO;
         #8#9  = #715#41;     || CALLE.
         #8#10 = #715#42;     || DOMICILIO.
         #8#11 = #715#47;     || CP.
         #8#12 = #715#48;     || CP.
         #8#13 = #715#43;     || NUMERO.
         #8#14 = "";         || KILOMETRO.
         #8#15 = "";         || PTO.
         #8#16 = #715#44;     || ESCALERA.
         #8#17 = #715#45;     || PISO.
         #8#18 = #715#46;     || PUERTA.
         #8#19 = #715#14;     || TELEFONO.
         #8#7  = #715#49;     || POBLACION.
         #8#8  = #715#50;     || PROVINCIA.
    |FINSI;
|FPRC;

|PROGRAMA;
     |ABRE #8;
     |PINPA #0#8;
     #8#0   = enEmpresa;
     #8#1   = enContador;
     #8#114 = enActividad;
     |LIBERA #8;
     |LEE 140#8=;
     |SI FSalida = 0;
         |PINDA #0#8;
         |ENDATOS #2#8;
         |SI FSalida = 0; |GRABA 140#8a; |FINSI;
     |SINO;
         |DDEFECTO #8;
         #8#0   = enEmpresa;
         #8#1   = enContador;
         #8#114 = enActividad;
         #8#2  = eaNombreEmp;
         #8#3  = eaNombreAct;
         #8#23 = eaCodEpi2;
         #8#29 = efFechaBaja;
         #8#30 = efFechaAlta;
         |HAZ LeeFicha;      ||--------------------- lee la ficha de clientes.
         |PINDA #0#8;
         |ENDATOS #1#8;
         |SI FSalida = 0; |GRABA 140#8n; |FINSI;
     |FINSI;
     |CIERRA #8;
|FPRO;
