|FICHEROS;
     socm0003;
     socm0004;

     socw0005,MANTE;
     socw0006,MANTE;

     agifigen;
     agim0019;
     agim0025;

     recibos@;
|FIN;

|VARIABLES;
     aAlfa         = "";
     aQueQuiero    = "";
     aNumCampos    = "";
     aNumPanta     = "";

     aEsc1         = "";
     aEsc2         = "";
     aRetu         = "";
     aTecla        = "";
     aID           = "";
     aBase         = "";
     aMas          = "";

     nCampo        = 0;
     nRango        = 0;
     nID           = 0;
     nVent         = 0;
     nLabel        = -1;
     nVentTrab     = 0;
     nVez          = 0;
     nDobleClick   = 0;
     nNoContab     = 0;
     nSiContab     = 0;

     nCampoCambia1 = 0;
     nNumPanta     = 0;
     nCampos       = 0;
     nModoPag      = 0;
     nNume         = 0;
     nSumaMes      = 0;
     nDia          = 0;
     nMes          = 0;
     nAnyo         = 0;
     nNumDias      = 0;
     nNumRec       = 0;
     nPorce        = 0;
     nValor        = 0;
     nValor1       = 0;
     nIRPF         = 0;

    {-1}nPotencia  = 0;
        nPotencia1 = 0;
        nPotencia2 = 0;

     {-1}aVent     = "";
         aVent1    = 0;
         aVent2    = 0;
         aVent3    = 0;
         aVent4    = 0;
         aVent5    = "";

     &enEmpresa    = 0;
     &enReg        = 0;
     &enModo       = 0;
     &enModoReg    = 0;
     &enGrid1      = 0;
     &enGrid2      = 0;
     &enNumCampos  = 0;
     &enRecibo     = 0;
     &enCapital    = 0;
     &enInteres    = 0;
     &enIRPF       = 0;
     &enCapPdte    = 0;
     &enRecPdte    = 0;
     &efDFecha     = @;
     &efHFecha     = @;
     &efFecha      = @;
     &efFechaIntro = @;
     &enInforme    = 0;
     &enPrint      = 0;

     &enPanta      = 0;
     &enBtnAltG1   = 0;
     &enBtnModG1   = 0;
     &enBtnBajG1   = 0;
     &enBtnRetG1   = 0;
     &enBtnInfG1   = 0;
     &enBtnAltG2   = 0;
     &enBtnModG2   = 0;
     &enBtnBajG2   = 0;
     &enBtnRecG2   = 0;

     &PRMNT_enError = 0;
|FIN;

|| RECIBO DE LIQUIDACION ---------------------------------------------------

|PROCESO socm0004I;
     #agifigen#0 = #socm0004#0;
     |LEE 000#agifigen.=;
     |SI FSalida ! 0;  |DDEFECTO #agifigen;  |FINSI;

     |SI enInforme = 1;
         |SI #socm0004#2 = 1;
             efDFecha = #socm0003#6;
         |SINO;
             |DDEF aBase;
             aMas = aBase + "socm0004.mas";
             |CARGA_DEF aMas, recibos@;
             |SI FSalida ! 0;  |ACABA;  |FINSI;

             |ABRE #recibos@;
             #recibos@#0 = #socm0004#0;
             #recibos@#1 = #socm0004#1;
             #recibos@#2 = #socm0004#2 - 1;
             |LEE 000#recibos@.=;
             |SI FSalida ! 0;  |DDEFECTO #recibos@;  |FINSI;
             |CIERRA #recibos@;

             efDFecha = #recibos@#3;

             |DESCARGA_DEF #recibos@;
         |FINSI;

         efHFecha = #socm0004#3;

         |PRINT;
         |PIEINF;
     |FINSI;

     |SI enInforme = 2;
         enPrint = 1;
         |PRINT;
     |FINSI;

     |SI enInforme = 3;
         enRecPdte = #socm0004#2;
         enCapPdte = #socm0004#9;
     |FINSI;
|FPRC;

|PROCESO RecLiquidacion;
     Impresora = "CrystalReport";
     |IMPRE -1;
     |SI FSalida ! 0;
         |MENAV "    Error en Impresora Crystal Report";
         |ACABA;
     |FINSI;

     |INFOR "soc00301";
     |SI FSalida ! 0; |FINIMP; |ACABA; |FINSI;

     |VENTANA 0501, 0540, -1, 16, "Procesando informe";
     nVentTrab = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentTrab;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PTEC 802; |PAUSA;

     |ABRE #agifigen;
     enInforme = 1;  |HAZ socm0004I;
     |CIERRA #agifigen;

     |FININF;
     |FINIMP;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentTrab;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;
     |FINVENTANA nVentTrab;

     |FOCOTECLADO enGrid2;
|FPRC;

|| CALCULO RECIBOS ---------------------------------------------------------

|PROCESO Eleva;
     |PARA nVez = 1;  |SI nVez [ 5;  |HACIENDO nVez = nVez + 1;
         nPorce     = (#socm0003#11 / nNumRec) / 100;
         nValor1    = 1 + nPorce;
         nPotencia1 = nValor1;
         nPotencia2 = #socm0003#10;
         |ESPECIFICA "POW", nPotencia;
         nValor1    = nPotencia2;
         |SI nValor1 > 0;  |SAL;  |FINSI;
      |SIGUE;
|FPRC;

|PROCESO CalculaRecibo;
     enCapital = 0;
     enInteres = 0;
     enIRPF    = 0;
     enCapPdte = 0;

     |DDEF aBase;
     aMas = aBase + "socm0004.mas";
     |CARGA_DEF aMas, recibos@;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |DDEFECTO #recibos@;
     efFecha     = #socm0003#6;
     #recibos@#3 = efFecha;
     #recibos@#9 = #socm0003#7;

     |SI enRecibo ! 1;
         |ABRE #recibos@;
         #recibos@#0 = #socm0003#0;
         #recibos@#1 = #socm0003#1;
         #recibos@#2 = enRecibo - 1;
         |LEE 000#recibos@.=;
         |SI FSalida ! 0;
             aAlfa = "0000Hay una anomal¡a en el pr‚stamo, falta el recibo anterior al " + enRecibo;
         |FINSI;
         |CIERRA #recibos@;

         efFecha = #recibos@#3;
     |FINSI;

     |SI #socm0003#9 = "M";  nSumaMes = 1;  |FINSI;
     |SI #socm0003#9 = "T";  nSumaMes = 3;  |FINSI;
     |SI #socm0003#9 = "S";  nSumaMes = 6;  |FINSI;
     |SI #socm0003#9 = "A";  nSumaMes = 12; |FINSI;

     aAlfa  = #socm0003#6 % 102;  nDia  = aAlfa;
     aAlfa  = efFecha     % 402;  nMes  = aAlfa;
     aAlfa  = efFecha     % 704;  nAnyo = aAlfa;

     nMes = nMes + nSumaMes;
     |SI nMes ] 13;
         nMes  = nMes - 12;
         nAnyo = nAnyo + 1;
     |FINSI;

     aAlfa   = (("00" + nDia) % -102) + "." + (("00" + nMes) % -102) + "." + nAnyo;
     efFecha = aAlfa;
     nNume   = efFecha;
     nNume   = nNume + 1;
     nNume   = nNume - 1;
     efFecha = nNume;

     |SI #socm0003#12 = "M";
         nNumDias  = efFechaIntro - #recibos@#3;

         enInteres = ((#recibos@#9 % #socm0003#11) / 365) * nNumDias;
     |FINSI;

     |SI #socm0003#12 = "A";
         enCapital = #socm0003#7 / #socm0003#10;

         |SI #socm0003#10 = enRecibo;
             enCapital = #recibos@#9;
         |FINSI;

         nNumDias  = efFecha - #recibos@#3;

         enInteres = ((#recibos@#9 % #socm0003#11) / 365) * nNumDias;
         enCapPdte = #recibos@#9 - enCapital;
     |FINSI;

     |SI #socm0003#12 = "F";
         |SI #socm0003#9 = "M";  nNumDias = 30;  nNumRec = 12;  |FINSI;
         |SI #socm0003#9 = "T";  nNumDias = 90;  nNumRec = 4;   |FINSI;
         |SI #socm0003#9 = "S";  nNumDias = 180; nNumRec = 2;   |FINSI;
         |SI #socm0003#9 = "A";  nNumDias = 360; nNumRec = 1;   |FINSI;

         enInteres  = ((#recibos@#9 % #socm0003#11) / 360) * nNumDias;

         |SI enRecibo ! #socm0003#10;
             |HAZ Eleva;

             nValor     = #socm0003#7 * ((nPorce * nValor1) / (nValor1 - 1));
             enCapital  = nValor - enInteres;
         |SINO;
             enCapital = #recibos@#9;
         |FINSI;

         enCapPdte  = #recibos@#9 - enCapital;
     |FINSI;

     enIRPF    = 0;
     |SI #socm0003#14 ! 0;
         enIRPF    = enInteres % #socm0003#14;
     |FINSI;

     |DESCARGA_DEF #recibos@;
|FPRC;

|PROCESO CalculaTodo;
     |PARA enRecibo = 1;  |SI enRecibo [ #socm0003#10;  |HACIENDO enRecibo = enRecibo + 1;
         |DDEFECTO #socm0004;
         #socm0004#0 = #socm0003#0;
         #socm0004#1 = #socm0003#1;
         #socm0004#2 = enRecibo;

         |HAZ CalculaRecibo;

         #socm0004#3 = efFecha;
         #socm0004#4 = enCapital;
         #socm0004#5 = enInteres;
         #socm0004#6 = #socm0004#4 + #socm0004#5;
         #socm0004#7 = enIRPF;
         #socm0004#8 = #socm0004#6 - #socm0004#7;
         #socm0004#9 = enCapPdte;

         |GRABA 020#socm0004.n;
         |LIBERA #socm0004;
     |SIGUE;
|FPRC;

|| RECIBOS -----------------------------------------------------------

|PROCESO EntraDatosSocw0006;
     |ESTADO_CONTROL enBtnAltG2, "DISABLE";
     |ESTADO_CONTROL enBtnModG2, "DISABLE";
     |ESTADO_CONTROL enBtnBajG2, "DISABLE";
     |ESTADO_CONTROL enBtnRecG2, "DISABLE";

     |HAZ QuitaBtnSalir;

     |ESTADO_CONTROL enGrid2, "DISABLE";

     |PULSATECLA;

     |DDEFECTO #socw0006;

     |SI nModoPag = 1;
         |C_M #socw0006#0, 1, "S";

         |DDEFECTO #socm0004;
         #socm0004#0 = #socm0003#0;
         #socm0004#1 = #socm0003#1;
         #socm0004#2 = 999;
         |LEE 000#socm0004.];
         |SI FSalida = 0;
             |LEE 000#socm0004.a;
         |SINO;
             |LEE 000#socm0004.u;
         |FINSI;

         enRecibo = 1;
         |SI FSalida = 0;  |Y #socm0004#0 = #socm0003#0;
                           |Y #socm0004#1 = #socm0003#1;
             enRecibo = #socm0004#2 + 1;
         |FINSI;

         |DDEFECTO #socm0004;
         #socm0004#0 = #socm0003#0;
         #socm0004#1 = #socm0003#1;
         #socm0004#2 = enRecibo;

         |HAZ CalculaRecibo;
         #socm0004#3 = efFecha;

         |SI #socm0003#12 ! "M";
             #socm0004#4 = enCapital;
             #socm0004#5 = enInteres;
             #socm0004#6 = #socm0004#4 + #socm0004#5;
             #socm0004#7 = enIRPF;
             #socm0004#8 = #socm0004#6 - #socm0004#7;
             #socm0004#9 = enCapPdte;
         |FINSI;
     |SINO;
         |C_M #socw0006#0, 1, "N";

         |LEE 101#socm0004.=;
         |SI FSalida ! 0;  |ACABA;  |FINSI;
     |FINSI;

     |C_M #socw0006#3, 1, "N";
     |C_M #socw0006#4, 1, "N";
     |SI #socm0003#12 = "M";
         |C_M #socw0006#3, 1, "S";
         |C_M #socw0006#4, 1, "S";
     |FINSI;

     #socw0006#0  = #socm0004#0;
     #socw0006#1  = #socm0004#1;
     #socw0006#2  = #socm0004#2;
     #socw0006#3  = #socm0004#3;
     #socw0006#4  = #socm0004#4;
     #socw0006#5  = #socm0004#5;
     #socw0006#6  = #socm0004#6;
     #socw0006#7  = #socm0004#7;
     #socw0006#8  = #socm0004#8;
     #socw0006#9  = #socm0004#9;
     #socw0006#10 = #socm0004#10;
     #socw0006#11 = #socm0004#11;
     #socw0006#12 = #socm0004#12;
     #socw0006#13 = #socm0004#13;
     #socw0006#14 = #socm0004#14;

     |VENTANA 0502, 1298, -1, 16, "Datos recibo";
     nVentTrab = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentTrab;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PTEC 802; |PAUSA;

     |PINPA #0#socw0006;
     |PINDA #0#socw0006;
     |ENDATOS #1#socw0006;
     |SI FSalida = 0;
         #socm0004#0  = #socw0006#0;
         #socm0004#1  = #socw0006#1;
         #socm0004#2  = #socw0006#2;
         #socm0004#3  = #socw0006#3;
         #socm0004#4  = #socw0006#4;
         #socm0004#5  = #socw0006#5;
         #socm0004#6  = #socw0006#6;
         #socm0004#7  = #socw0006#7;
         #socm0004#8  = #socw0006#8;
         #socm0004#9  = #socw0006#9;
         #socm0004#10 = #socw0006#10;
         #socm0004#11 = #socw0006#11;
         #socm0004#12 = #socw0006#12;
         #socm0004#13 = #socw0006#13;
         #socm0004#14 = #socw0006#14;

         |SI nModoPag = 1;
             |GRABA 020#socm0004.n;
         |SINO;
             |GRABA 020#socm0004.a;
         |FINSI;

         |LEE 101#socm0003.=;
         |SI FSalida = 0;
             #socm0003#8 = #socm0004#9;
             |GRABA 020#socm0003.a;
             |LIBERA #socm0003;
         |FINSI;
     |FINSI;
     |LIBERA #socm0004;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentTrab;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;
     |FINVENTANA nVentTrab;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |SI enModo ! 4;
         |ESTADO_CONTROL enBtnAltG2, "ENABLE";
     |FINSI;

     |HAZ PonBtnSalir;

     |ESTADO_CONTROL enGrid2, "ENABLE";
     |REFRESCACONTROL enGrid1;
     |REFRESCACONTROL enGrid2;

     FSalida = 1;  |HAZ EventoGrid2;

     |FOCOTECLADO enGrid2;
|FPRC;

|PROCESO AltG2;
     nModoPag = 1;
     |HAZ EntraDatosSocw0006;
|FPRC;

|PROCESO ModG2;
     |LEE 000#socm0004.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |SI #socm0004#10 = "S";
         |CONFI "0000 El registro est  contabilidado, quiere dar de baja el asiento y modificar el registro";
         |SI FSalida ! 0;
             |FOCOTECLADO enGrid2;
             |ACABA;
         |FINSI;

         |HAZ BorraAsientoM4;
         |SI PRMNT_enError < 0;
             aAlfa = " el Ejercicio Contable est  bloqueado.";
             |SI PRMNT_enError = -4;
                 aAlfa = " el Ejercicio Contable est  Cerrado";
             |FINSI;
             aAlfa = "0000No se puede modificar el registro," + aAlfa;
             |MENAV aAlfa;
             |FOCOTECLADO enGrid2;
             |ACABA;
         |FINSI;

         |LEE 101#socm0004.=;
         #socm0004#10 = "N";
         #socm0004#11 = 0;
         #socm0004#12 = "01.01.0000";
         #socm0004#13 = 0;
         #socm0004#14 = 0;

         |GRABA 020#socm0004.a;
         |LIBERA #socm0004;
     |FINSI;

     nModoPag = 2;
     |HAZ EntraDatosSocw0006;
|FPRC;

|PROCESO BajG2;
     |LEE 000#socm0004.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |SI #socm0004#10 = "S";
         |CONFI "0000 El registro est  contabilidado, quiere dar de baja el asiento y borrar el registro";
         |SI FSalida ! 0;
             |FOCOTECLADO enGrid2;
             |ACABA;
         |FINSI;

         |HAZ BorraAsientoM4;
         |SI PRMNT_enError < 0;
             aAlfa = " el Ejercicio Contable est  bloqueado.";
             |SI PRMNT_enError = -4;
                 aAlfa = " el Ejercicio Contable est  Cerrado";
             |FINSI;
             aAlfa = "0000No se puede dar de baja el registro," + aAlfa;
             |MENAV aAlfa;
             |FOCOTECLADO enGrid2;
             |ACABA;
         |FINSI;
     |SINO;
         |CONFI "0000 Confirma la baja del registro seleccionado";
         |SI FSalida ! 0;
             |FOCOTECLADO enGrid2;
             |ACABA;
         |FINSI;
     |FINSI;

     |LEE 101#socm0004.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |BORRA 020#socm0004.a;
     |LIBERA #socm0004;

     |LEE 000#socm0004.a;

     |ESTADO_CONTROL enBtnModG2,  "DISABLE";
     |ESTADO_CONTROL enBtnBajG2,  "DISABLE";
     |ESTADO_CONTROL enBtnRecG2,  "DISABLE";

     |REFRESCACONTROL enGrid2;
     |FOCOTECLADO enGrid2;
|FPRC;

|PROCESO EventoGrid2;
     |SI FSalida = 1;  |O FSalida = 2;
         |LEE 000#socm0004.=;

         nDobleClick = 1;
         |ESTADO_CONTROL enBtnAltG2, "ENABLE";
         |ESTADO_CONTROL enBtnModG2, "ENABLE";
         |ESTADO_CONTROL enBtnBajG2, "ENABLE";
         |ESTADO_CONTROL enBtnRecG2, "ENABLE";

         |SI enModo = 4;
             nDobleClick = 0;
             |ESTADO_CONTROL enBtnModG2, "DISABLE";
             |ESTADO_CONTROL enBtnBajG2, "DISABLE";
         |FINSI;

         |DDEF aBase;
         aMas = aBase + "socm0004.mas";
         |CARGA_DEF aMas, recibos@;
         |SI FSalida ! 0;  |ACABA;  |FINSI;

         |ABRE #recibos@;
         #recibos@#0 = #socm0004#0;
         #recibos@#1 = #socm0004#1;
         #recibos@#2 = #socm0004#2 + 1;
         |LEE 000#recibos@.=;
         |SI FSalida = 0;
             nDobleClick = 0;
             |ESTADO_CONTROL enBtnModG2, "DISABLE";
             |ESTADO_CONTROL enBtnBajG2, "DISABLE";
         |FINSI;

         #recibos@#0 = #socm0004#0;
         #recibos@#1 = #socm0004#1;
         #recibos@#2 = #socm0003#10;
         |LEE 000#recibos@.=;
         |SI FSalida = 0;
             nDobleClick = 0;
             |ESTADO_CONTROL enBtnAltG2, "DISABLE";
             |ESTADO_CONTROL enBtnModG2, "DISABLE";
             |ESTADO_CONTROL enBtnBajG2, "DISABLE";

             |SI #socm0004#2 = #recibos@#2;
                 nDobleClick = 1;
                 |ESTADO_CONTROL enBtnModG2, "ENABLE";

                 |SI #socm0003#10 = "M";
                     |ESTADO_CONTROL enBtnBajG2, "ENABLE";
                 |FINSI;
             |FINSI;
         |FINSI;

         |CIERRA #recibos@;
         |DESCARGA_DEF #recibos@;

         |PULSATECLA;
     |FINSI;

     |SI FSalida = 4;
         |SI enModo = 4;  |ACABA;  |FINSI;

         |SI nDobleClick = 1;
             |HAZ ModG2;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO BajaGrid2;
     #socm0004#0 = #socm0003#0;
     #socm0004#1 = #socm0003#1;
     #socm0004#2 = 0001;
|FPRC;

|PROCESO AltaGrid2;
     #socm0004#0 = #socm0003#0;
     #socm0004#1 = #socm0003#1;
     #socm0004#2 = 9999;
|FPRC;

|PROCESO BtnsGrid2;
     |CONTROL_SIMPLE 0, "BOTON,{{193}}Alta ", 2564, 2574, AltG2;
     enBtnAltG2 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{197}}Modificar ", 2576, 2586, ModG2;
     enBtnModG2 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{199}}Borrar", 2588, 2598, BajG2;
     enBtnBajG2 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{205}}Recibo Liquidaci¢n", 2502, 2520, RecLiquidacion;
     enBtnRecG2 = FSalida;

     |ESTADO_CONTROL enBtnModG2,  "DISABLE";
     |ESTADO_CONTROL enBtnBajG2,  "DISABLE";
     |ESTADO_CONTROL enBtnRecG2,  "DISABLE";

     |SI enModo = 4;
         |ESTADO_CONTROL enBtnAltG2, "DISABLE";
     |FINSI;
|FPRC;

|PROCESO Recibos;
     aAlfa = "Recibos del pr‚stamo " + (("00000" + #socm0003#1) % -105) + " / " + #socm0003#2;  |QBF aAlfa;

     |VENTANA 0502, 2898, -1, 16, aAlfa;
     nVent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PTEC 802; |PAUSA;

     |HAZ BtnsGrid2;

     nRango = 4 + 8 + 16 + 32 + 128;

     |LINEAL_SIMPLE #1#socm0004, nRango, 0602, 2497, BajaGrid2, AltaGrid2, EventoGrid2;
     enGrid2 = FSalida;

     aEsc1  = &255 + "806";
     aEsc2  = &255 + "807";
     aRetu  = &255 + "802";
     |PARA; |SI;  |HACIENDO;
          FSalida = "::{{001}}Salir," + enGrid2;
          |LEETECLA aTecla;
          |SI aTecla = aEsc1; |SAL;  |FINSI;
          |SI aTecla = aEsc2; |SAL;  |FINSI;
          |SI aTecla = aRetu; |SAL;  |FINSI;
     |SIGUE;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;
     |FINVENTANA nVent;

     |FOCOTECLADO enGrid1;
|FPRC;

|| -------------------------------------------------------------------------

|PROCESO PintaDatosPantalla;
     |DDEFECTO #socw0005;
     |PARA nCampo = 0;  |SI nCampo [ enNumCampos;  |HACIENDO nCampo = nCampo + 1;
           #socw0005#nCampo# = #socm0003#nCampo#;

           |C_V #socw0005#nCampo#, 0, aAlfa;
           |SI aAlfa = "S";  |PINTA #socw0005#nCampo#;  |FINSI;

           |C_M #socw0005#nCampo#, 1, "N";
     |SIGUE;
|FPRC;

|PROCESO CargaFantasocw0005;
     nNoContab = 0;
     nSiContab = 0;

     |SELECT #3#socm0004;
     #socm0004#10 = "N";
     #socm0004#0  = #socm0003#0;
     #socm0004#1  = #socm0003#1;
     |LEE 000#socm0004.=;
     |SI FSalida = 0;  nNoContab = 1;  |FINSI;

     #socm0004#10 = "S";
     #socm0004#0  = #socm0003#0;
     #socm0004#1  = #socm0003#1;
     |LEE 000#socm0004.=;
     |SI FSalida = 0;  nSiContab = 1;  |FINSI;

     |C_M #socw0005#2,  1, "S";
     |C_M #socw0005#3,  1, "S";
     |C_M #socw0005#4,  1, "S";
     |C_M #socw0005#5,  1, "S";
     |C_M #socw0005#6,  1, "S";
     |C_M #socw0005#7,  1, "S";
     |C_M #socw0005#9,  1, "S";
     |C_M #socw0005#10, 1, "S";
     |C_M #socw0005#11, 1, "S";
     |C_M #socw0005#12, 1, "S";
     |C_M #socw0005#13, 1, "S";
     |C_M #socw0005#14, 1, "S";
     |C_M #socw0005#15, 1, "S";
     |C_M #socw0005#16, 1, "S";
     |C_M #socw0005#17, 1, "S";
     |C_M #socw0005#18, 1, "S";
     |C_M #socw0005#19, 1, "S";

     |SELECT #1#socm0004;
     #socm0004#0 = #socm0003#0;
     #socm0004#1 = #socm0003#1;
     #socm0004#2 = 1;
     |LEE 000#socm0004.=;
     |SI FSalida = 0;
         |C_M #socw0005#3,  1, "N";
         |C_M #socw0005#4,  1, "N";
         |C_M #socw0005#5,  1, "N";
         |C_M #socw0005#6,  1, "N";
         |C_M #socw0005#7,  1, "N";
         |C_M #socw0005#9,  1, "N";
         |C_M #socw0005#10, 1, "N";
         |C_M #socw0005#11, 1, "N";
         |C_M #socw0005#12, 1, "N";
         |C_M #socw0005#13, 1, "N";
         |C_M #socw0005#14, 1, "N";

         |SI nNoContab = 1;
             |C_M #socw0005#14, 1, "S";

             |SI nSiContab = 0;
                 |C_M #socw0005#3,  1, "S";
                 |C_M #socw0005#13, 1, "S";
             |FINSI;
         |FINSI;

         nIRPF = #socw0005#14;
     |FINSI;

     |PARA nCampo = 0;  |SI nCampo [ enNumCampos;  |HACIENDO nCampo = nCampo + 1;
           #socw0005#nCampo# = #socm0003#nCampo#;

           |C_V #socw0005#nCampo#, 0, aAlfa;
           |SI aAlfa = "S";  |PINTA #socw0005#nCampo#;  |FINSI;
     |SIGUE;
|FPRC;

|PROCESO socm0004Rec;
     #socm0004#7 = 0;
     |SI #socm0003#14 ! 0;
         #socm0004#7 = #socm0004#5 % #socm0003#14;
     |FINSI;
     #socm0004#8 = #socm0004#6 - #socm0004#7;

     |GRABA 020#socm0004.a;
     |LIBERA #socm0004;
|FPRC;

|DEFBUCLE socm0004Rec;
     #socm0004#1;
     10;
     #socm0003#0, #socm0003#1, 0000, "N";
     #socm0003#0, #socm0003#1, 9999, "N";
     be;
     NULL, socm0004Rec;
|FIN;

|PROCESO DescargaFantasocw0005;
     |PARA nCampo = 0;  |SI nCampo [ enNumCampos;  |HACIENDO nCampo = nCampo + 1;
           #socm0003#nCampo# = #socw0005#nCampo#;
     |SIGUE;

     #socm0004#0 = #socm0003#0;
     #socm0004#1 = #socm0003#1;
     #socm0004#2 = 1;
     |LEE 000#socm0004.=;
     |SI FSalida ! 0;
         #socm0003#8 = #socm0003#7;

         |SI #socm0003#12 ! "M";
             |HAZ CalculaTodo;
             #socm0003#8 = 0;
         |FINSI;
     |SINO;
         |SI nIRPF ! 0;
             |SI nIRPF ! #socw0005#14;
                 |CONFI "0000SSe ha cambiado el % IRPF. Recalculamos los recibos no contabilizados";
                 |SI FSalida = 0;
                     |BUCLE socm0004Rec;
                 |FINSI;
             |FINSI;
         |FINSI;
     |FINSI;

     |HAZ PintaDatosPantalla;
|FPRC;

|PROCESO AltG1;
     |ESTADO_CONTROL enBtnAltG1, "DISABLE";
     |ESTADO_CONTROL enBtnModG1, "DISABLE";
     |ESTADO_CONTROL enBtnBajG1, "DISABLE";
     |ESTADO_CONTROL enBtnRetG1, "DISABLE";
     |ESTADO_CONTROL enBtnInfG1, "DISABLE";

     |HAZ QuitaBtnSalir;

     |ESTADO_CONTROL enGrid1, "DISABLE";

     |PULSATECLA;

     #socm0003#0 = enEmpresa;
     #socm0003#1 = 99999;
     |LEE 000#socm0003.];
     |SI FSalida =0;
         |LEE 000#socm0003.a;
     |SINO;
         |LEE 000#socm0003.u;
     |FINSI;

     nID = 1;
     |SI FSalida = 0;  |Y #socm0003#0 = enEmpresa;
         nID = #socm0003#1 + 1;
     |FINSI;

     |DDEFECTO #socw0005;
     |DDEFECTO #socm0003;

     #socm0003#0 = enEmpresa;
     #socm0003#1 = nID;
     #socw0005#0 = enEmpresa;
     #socw0005#1 = nID;

     enModoReg = 1;
     |HAZ CargaFantasocw0005;

     |ENDATOS #1#socw0005;
     |SI FSalida = 0;
         |HAZ DescargaFantasocw0005;

         |GRABA 020#socm0003.n;
     |FINSI;
     |LIBERA #socm0003;

     |SI enModo ! 4;
         |ESTADO_CONTROL enBtnAltG1, "ENABLE";
     |FINSI;

     |HAZ PonBtnSalir;

     |ESTADO_CONTROL enGrid1, "ENABLE";
     |REFRESCACONTROL enGrid1;

     FSalida = 1;  |HAZ EventoGrid1;

     |FOCOTECLADO enGrid1;
|FPRC;

|PROCESO ModG1;
     |LEE 101#socm0003.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |ESTADO_CONTROL enBtnAltG1,  "DISABLE";
     |ESTADO_CONTROL enBtnModG1,  "DISABLE";
     |ESTADO_CONTROL enBtnBajG1,  "DISABLE";
     |ESTADO_CONTROL enBtnRetG1,  "DISABLE";
     |ESTADO_CONTROL enBtnInfG1,  "DISABLE";

     |HAZ QuitaBtnSalir;

     |ESTADO_CONTROL enGrid1, "DISABLE";

     enModoReg = 2;

     |HAZ CargaFantasocw0005;
     |ENDATOS #2#socw0005;
     |SI FSalida = 0;
         |HAZ DescargaFantasocw0005;

         |GRABA 020#socm0003.a;
     |FINSI;
     |LIBERA #socm0003;

     |SI enModo ! 4;
         |ESTADO_CONTROL enBtnAltG1, "ENABLE";
         |ESTADO_CONTROL enBtnModG1, "ENABLE";
         |ESTADO_CONTROL enBtnBajG1, "ENABLE";
         |ESTADO_CONTROL enBtnRetG1, "ENABLE";
         |ESTADO_CONTROL enBtnInfG1, "ENABLE";
     |FINSI;

     |HAZ PonBtnSalir;

     |ESTADO_CONTROL enGrid1, "ENABLE";
     |REFRESCACONTROL enGrid1;
     |FOCOTECLADO enGrid1;
|FPRC;

|PROCESO socm0004B;
     |SI #socm0004#10 = "S";
         |HAZ BorraAsientoM4;
         |SI PRMNT_enError < 0;
             aAlfa = " hay Asientos en periodo Contable bloqueado.";
             |SI PRMNT_enError = -4;
                 aAlfa = " hay Asientos en Periodo Contable Cerrado";
             |FINSI;
             aAlfa = "0000No se puede dar de baja el Prestamo," + aAlfa;
             |MENAV aAlfa;
             |ERROR10;
             |ACABA;
         |FINSI;
     |FINSI;

     |BORRA 020#socm0004.a;
     |LIBERA #socm0004;
|FPRC;

|DEFBUCLE socm0004B;
     #socm0004#1;
     ;
     #socm0003#0, #socm0003#1, 0000;
     #socm0003#0, #socm0003#1, 9999;
     be;
     NULL, socm0004B;
|FIN;

|PROCESO BajG1;
     |CONFI "0000 Confirma la baja del registro seleccionado, borrar  los asientos de los recibos contabilizados";
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |LEE 101#socm0003.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |BUCLE socm0004B;
     |SI PRMNT_enError ] 0;
         |BORRA 020#socm0003.a;
         |LIBERA #socm0003;
     |FINSI;

     |ESTADO_CONTROL enBtnModG1,  "DISABLE";
     |ESTADO_CONTROL enBtnBajG1,  "DISABLE";
     |ESTADO_CONTROL enBtnRetG1,  "DISABLE";
     |ESTADO_CONTROL enBtnInfG1,  "DISABLE";

     |DDEFECTO #socm0003;
     |HAZ PintaDatosPantalla;

     |REFRESCACONTROL enGrid1;
     |FOCOTECLADO enGrid1;
|FPRC;

|PROCESO Informe;
|FPRC;

|PROCESO EventoGrid1;
     |SI FSalida = 1;  |O FSalida = 2;
         |LEE 000#socm0003.=;

         |SI enModo = 4;
             |ESTADO_CONTROL enBtnModG1, "DISABLE";
             |ESTADO_CONTROL enBtnBajG1, "DISABLE";
             |ESTADO_CONTROL enBtnRetG1, "DISABLE";
             |ESTADO_CONTROL enBtnInfG1, "DISABLE";
         |SINO;
             |ESTADO_CONTROL enBtnModG1, "ENABLE";
             |ESTADO_CONTROL enBtnBajG1, "ENABLE";
             |ESTADO_CONTROL enBtnRetG1, "ENABLE";
             |ESTADO_CONTROL enBtnInfG1, "ENABLE";
         |FINSI;

         |PULSATECLA;

         enModoReg = 4;
         |HAZ PintaDatosPantalla;
     |FINSI;

     |SI FSalida = 4;
         |SI enModo = 4;  |ACABA;  |FINSI;

         |HAZ ModG1;
     |FINSI;
|FPRC;
