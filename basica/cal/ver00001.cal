|FICHEROS;
     ver00001 #0;

     agicen14 #1;
     agim0019 #2;

     agiepim2   #602;
     agim0035   #635;
     agim0135   #636;

     :/contasoc/def/maempr10 #700;
|FIN;

|VARIABLES;
     aCNAE2008    = "";
     aCNAE2009    = "";
     aTipoEpi     = "O";
     aEpigrafe    = "";
     aAlfa        = "";

     nAgrupa      = 0;

     &eaPrograma     = "";
     &eaExtension    = "";
     &eaPathContasoc = "";
     &enErrorVer     = 0;
|FIN;

|PROCESO agicen14;
     aCNAE2008 = #1#21;
     aCNAE2009 = #1#21;

     aTipoEpi = #1#2;
     |SI #1#2 ! "E";  |Y #1#2 ! "P";
      |Y #1#2 ! "A";  |Y #1#2 ! " ";
          aTipoEpi = "O";
     |FINSI;

     nAgrupa = 0;
     |SI aTipoEpi = "E";
         aAlfa    = #1#3 % 101;
         nAgrupa = aAlfa;
         nAgrupa = nAgrupa * 100;
     |FINSI;

     aEpigrafe = #1#3;  |QBT aEpigrafe;
     aAlfa      = aEpigrafe % 0;
     |SI aAlfa  = "4";
         aEpigrafe = (aEpigrafe % 103) + "." + (aEpigrafe % 401);
     |FINSI;

     |SI aTipoEpi ! "O";
         |ABRE #602;
         #602#0 = aTipoEpi;
         #602#1 = nAgrupa;
         #602#2 = aEpigrafe;
         |LEE 040#602=;
         |SI FSalida = 0;
             aCNAE2008 = #602#4;
             aCNAE2009 = #602#6;
         |FINSI;
         |CIERRA #602;
     |FINSI;

     #1#20 = aCNAE2009;
     #1#21 = aCNAE2008;

     |GRABA 020#1a;
     |LIBERA #1;
|FPRC;

|DEFBUCLE agicen14;
     #1#1;
     ;
     INICIO;
     FINAL;
     be;
     NULL, agicen14;
|FIN;

|PROCESO agim0019;
     aCNAE2008 = #2#81;
     aCNAE2009 = #2#81;

     aTipoEpi = #2#46;
     |SI #2#46 ! "E";  |Y #2#46 ! "P";
      |Y #2#46 ! "A";  |Y #2#46 ! " ";
          aTipoEpi = "O";
     |FINSI;

     nAgrupa = 0;
     |SI aTipoEpi = "E";
         aAlfa    = #2#47 % 101;
         nAgrupa = aAlfa;
         nAgrupa = nAgrupa * 100;
     |FINSI;

     aEpigrafe  = #2#47;  |QBT aEpigrafe;
     aAlfa      = aEpigrafe % 0;
     |SI aAlfa  = "4";
         aEpigrafe = (aEpigrafe % 103) + "." + (aEpigrafe % 401);
     |FINSI;

     |SI aTipoEpi ! "O";
         |ABRE #602;
         #602#0 = aTipoEpi;
         #602#1 = nAgrupa;
         #602#2 = aEpigrafe;
         |LEE 040#602=;
         |SI FSalida = 0;
             aCNAE2008 = #602#4;
             aCNAE2009 = #602#6;
         |FINSI;
         |CIERRA #602;
     |FINSI;

     #2#40 = aCNAE2009;

     |ABRE #636;
     #636#0 = #2#40;
     |LEE 040#636=;
     |SI FSalida ! 0;  |DDEFECTO #636;  |FINSI;
     |CIERRA #636;

     #2#41 = #636#1;

     #2#81 = aCNAE2008;

     |ABRE #635;
     #635#0 = #2#81;
     |LEE 040#635=;
     |SI FSalida ! 0;  |DDEFECTO #635;  |FINSI;
     |CIERRA #635;

     #2#82 = #635#1;

     |GRABA 020#2a;
     |LIBERA #2;
|FPRC;

|DEFBUCLE agim0019;
     #2#1;
     ;
     INICIO;
     FINAL;
     be;
     NULL, agim0019;
|FIN;

|PROCESO maempr10;
     #2#0 = #700#0;
     #2#1 = 99;
     |LEE 040#2];
     |SI FSalida = 0;
         |LEE 040#2a;
     |SINO;
         |LEE 040#2u;
     |FINSI;
     |SI FSalida ! 0;  |O #2#0 ! #700#0;
         |DDEFECTO #2;
     |FINSI;

     #700#17 = #2#40;
     |GRABA 020#700a;
     |LIBERA #700;
|FPRC;

|DEFBUCLE maempr10;
     #700#1;
     ;
     00000, 2008;
     99999, 2999;
     be;
     NULL, maempr10;
|FIN;

|PROCESO Tipo12;  |TIPO 12;
     |SI #0#1 ! "SI";  |ACABA;  |FINSI;

     |ABRE #636;
     |LEE 000#636p;
     |SI FSalida ! 0;
         |CIERRA #636;
         |DELINDEX #636;

         eaPrograma  = "agim0135";
         eaExtension = "bas";
         |SUB_EJECUTA_NP "dspatron";
     |FINSI;
     |CIERRA #636;

     |ABRE #602;
     #602#0 = "P";
     #602#1 = 0;
     #602#2 = "011";
     |LEE 000#602=;
     |SI FSalida ! 0;  |O #602#6 = "    ";
         |CIERRA #602;
         |DELINDEX #602;

         eaPrograma  = "agiepim2";
         eaExtension = "bas";
         |SUB_EJECUTA_NP "dspatron";
     |FINSI;
     |CIERRA #602;

     #0#0 = 1;
     |GRABA 020#0a;

     |BUCLE agicen14;
     |BUCLE agim0019;

     |HAZ BusquedaApli;
     |SI eaPathContasoc ! "";
         aAlfa = eaPathContasoc + "fich/";
         |PATH_DAT #700 aAlfa;
         |ABRE #2;
         |BUCLE maempr10;
         |CIERRA #2;
     |FINSI;
|FPRC;

|PROGRAMA;
     enErrorVer = 0;

     |ABRE #0
     |LEE 000#0p;
     |SI FSalida ! 0;  |DDEFECTO #0;  |FINSI;
     |CIERRA #0

     |SI #0#0 = 1;  |ACABA;  |FINSI;

     |MENAV "0000 No se ha realizado el proceso del cambio de CNAE para el 2009";
     |CONFI "0000SQuiere hacerlo en estos momentos";
     |SI FSalida ! 0;
         |MENAV "0000 No puede proseguir hasta que no realice el preceso";
         enErrorVer = 1;
         |ACABA;
     |FINSI;

     |CABEZA "Regeneracion CNAE 2009";

     |ABRE #0
     |LEE 101#0p;
     |SI FSalida ! 0;
         |DDEFECTO #0;
         #0#0 = 0;
         |GRABA 020#0b;
     |FINSI;

     |PINPA #0#0;

     #0#1 = "NO";
     |PINDA #0#0;

     |ENDATOS #1#0;
     |SI FSalida ! 0;  |O #0#1 ! "SI";
         #0#0       = 0;
         enErrorVer = 1;

         |GRABA 020#0a;
     |FINSI;

     |LIBERA #0;
     |CIERRA #0;
|FPRO;
