|FICHEROS;
    dsinfcs1 #11,MANTE;

    :contagen/ca8m0000 #420;  || Descripcion Numero de Balance
|FIN;

|VARIABLES;
   error1      = "0000Nivel repetido";
   aAlfa1      = "";
   nNume1      = 0;
   &NumMes     = 0;
   &NombreMes  = "";
   &eaCuenta   = "";
   &salidas    = 0;
   nivel       = 0;
   nSwErrorBal = 0;

|FIN;

|PROCESO pintames; |TIPO 0;
  nNume1 = Campo + 2;
  NumMes = #dsinfcs1#Campo#;
  |HAZ NombreMes;
  #dsinfcs1#nNume1# = NombreMes; |PINTA #dsinfcs1#nNume1#;

  |SI Campo = 1; |Y  #dsinfcs1#0 > #dsinfcs1#1;
      |MENAV "    Error de Entrada ...";
      |ERROR;
  |FINSI;
|FPRC;

|PROCESO pintames2; |TIPO 0;
   NumMes = #dsinfcs1#Campo#;
   |HAZ NombreMes;

   |ATRI I;
   |SI Campo = 7;  |PINTA 1966, NombreMes;  |FINSI;
   |SI Campo = 8;  |PINTA 2066, NombreMes;  |FINSI;
   |ATRI 0;
   |SI Campo = 8;  |Y #dsinfcs1#7 > #dsinfcs1#8;
       |MENAV "    Error de Entrada ...";
       |ERROR;
   |FINSI;
|FPRC;

|PROCESO nivel; |TIPO 7;
   aAlfa1 = #dsinfcs1#4;
   |C_M #dsinfcs1#5, 1,aAlfa1;
   |SI aAlfa1 = "N";
       #dsinfcs1#5  = 12; |PINTA #dsinfcs1#5;
   |FINSI;
|FPRC;

|PROCESO nosaldo; |TIPO 7;
   aAlfa1 = "S";
   |SI #dsinfcs1#26 = "S";  aAlfa1 = "N";  #dsinfcs1#27 = "S"; |FINSI;
   |C_M #dsinfcs1#27, 1, aAlfa1;
   |PINTA #dsinfcs1#27;
|FPRC;

|CALCULO cuentaS1; |TIPO 6;
     eaCuenta = #dsinfcs1#Campo#;
     salidas  = FSalida;
     |HAZ FiltraPuntos;
     #dsinfcs1#Campo# = eaCuenta;
     |PINTA #dsinfcs1#Campo#;
|FCAL;

|PROCESO nivelcos; |TIPO 7;  || Calculo para hacer no modificable
     |C_M #dsinfcs1#Campo#,1,"S";
     |SI Campo = 12; |Y #dsinfcs1#10 < 2; || Si solo hemos seleccionado
          #dsinfcs1#Campo# = 0; |PINTA #dsinfcs1#Campo#;
         |C_M #dsinfcs1#Campo#,1,"N";
     |FINSI;
     |SI Campo = 13; |Y #dsinfcs1#10 < 3; || Si solo hemos seleccionado
         #dsinfcs1#Campo# = 0; |PINTA #dsinfcs1#Campo#;
         |C_M #dsinfcs1#Campo#,1,"N";
     |FINSI;
     |SI Campo = 14; |Y #dsinfcs1#10 < 4; || Si solo hemos seleccionado
         #dsinfcs1#Campo# = 0; |PINTA #dsinfcs1#Campo#;
         |C_M #dsinfcs1#Campo#,1,"N";
     |FINSI;
     |SI Campo = 15; |Y #dsinfcs1#10 < 5; || Si solo hemos seleccionado
         #dsinfcs1#Campo# = 0; |PINTA #dsinfcs1#Campo#;
         |C_M #dsinfcs1#Campo#,1,"N";
     |FINSI;
     |SI Campo = 16; |Y #dsinfcs1#10 < 6; || Si solo hemos seleccionado
         #dsinfcs1#Campo# = 0; |PINTA #dsinfcs1#Campo#;
         |C_M #dsinfcs1#Campo#,1,"N";
     |FINSI;
|FPRC;

|PROCESO nivelrep;|TIPO 0;  || Para comprobar que no repetimos los niveles

     |SI #dsinfcs1#Campo# > 6;
        |MENAV "    El numero de nivel no coincide con el numero de nivel de la empresa";
        |ERROR;
        |ACABA;
    |FINSI;

    |SI nivel = 0;        || Buscamo el nivel mas alto;
        nivel = #dsinfcs1#11;
    |FINSI;

   |SI Campo = 11; |ACABA; |FINSI;
   |SI Campo = 12;
      |SI #dsinfcs1#12 = #dsinfcs1#11;|Y #dsinfcs1#12 ! 0;    || Si hay dos niveles iguales error
          |MENAV error1;
          |ERROR;
          |ACABA;
      |SINO;
         |SI #dsinfcs1#12 > #dsinfcs1#11;  || Busca el nivel mas alto
             nivel = #dsinfcs1#12;
         |SINO;
            nivel = #dsinfcs1#11;
         |FINSI;
      |FINSI;
   |FINSI;

   |SI Campo = 13; |Y #dsinfcs1#13 ! 0;
      |SI #dsinfcs1#13 = #dsinfcs1#11; |O #dsinfcs1#13 = #dsinfcs1#12; || Si hay dos niveles iguales error
          |MENAV error1;
          |ERROR;
          |ACABA;
      |FINSI;

      |SI #dsinfcs1#13 > nivel;  || Busca el nivel mas alto
          nivel = #dsinfcs1#13;
      |FINSI;
   |FINSI;

   |SI Campo = 14; |Y #dsinfcs1#14 ! 0;      || Si hay dos niveles iguales error
      |SI #dsinfcs1#14 = #dsinfcs1#11; |O #dsinfcs1#14 = #dsinfcs1#12; |O #dsinfcs1#14 = #dsinfcs1#13;
         |MENAV error1;
         |ERROR;
         |ACABA;
      |FINSI;

      |SI #dsinfcs1#14 > nivel;  || Busca el nivel mas alto
         nivel = #dsinfcs1#14;
      |FINSI;
   |FINSI;

   |SI Campo = 15; |Y #dsinfcs1#15 ! 0;     || Si hay dos niveles iguales error
      |SI #dsinfcs1#15 = #dsinfcs1#11; |O #dsinfcs1#15 = #dsinfcs1#12; |O #dsinfcs1#15 = #dsinfcs1#13; |O #dsinfcs1#15 = #dsinfcs1#14;
         |MENAV error1;
         |ERROR;
         |ACABA;
      |FINSI;

      |SI #dsinfcs1#15 > nivel;  || Busca el nivel mas alto
         nivel = #dsinfcs1#15;
      |FINSI;
   |FINSI;

   |SI Campo = 16; |Y #dsinfcs1#16 ! 0;    || Si hay dos niveles iguales error
      |SI #dsinfcs1#16 = #dsinfcs1#11; |O #dsinfcs1#16 = #dsinfcs1#12; |O #dsinfcs1#16 = #dsinfcs1#13; |O #dsinfcs1#16 = #dsinfcs1#14; |O #dsinfcs1#16 = #dsinfcs1#15;
         |MENAV error1;
         |ERROR;
         |ACABA;
      |FINSI;

      |SI #dsinfcs1#16 > nivel;  || Busca el nivel mas alto
         nivel = #dsinfcs1#16;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO descri; |TIPO 6;
 nSwErrorBal = 0;
 |ABRE #ca8m0000;
 |DDEFECTO #ca8m0000;
 #ca8m0000#0 = #dsinfcs1#Campo#;
 |LEE 001#ca8m0000.=;
 |SI FSalida ! 0;
     |MENAV "   Error. No existe Numero de Balance";
     |ERROR;
     nSwErrorBal = 1;
 |FINSI;
 |CIERRA #ca8m0000;
 nNume1 = Campo + 1;
 #dsinfcs1#nNume1# = #ca8m0000#1;
 |PINTA #dsinfcs1#nNume1#;
|FPRC;
