|FICHEROS;
    agiz0021 #0;

    agifigen #1;
    agicen14 #14;
    agicen17 #17;
    agicen18 #18;

    agiw0038 #998,MANTE;
    agiw0039 #999,MANTE;      || Temporal de Grupos / Cuentas

    rem00021@ #221;
|FIN;

|VARIABLES;
  nEstado = 0;
  fFecha1 = @;
  nGTempo = 0;

  nEmpresa   = 0;
  nActividad = 0;
  nLocal     = 0;
  nValor     = 0;
  nIBI       = 0;
  nTerreno   = 0;

  nModo      = 0;
  nSwRenta   = 0;
  aAlfa1     = "";
  aAlfa2     = "";
  aAlfa3     = "";

  aFichero   = "";
  nInkey     = 0;

  nSwHayRenta = 0;
  aBase       = "";
  aDef        = "";
  aPath       = "";
  aMas        = "";
  nEnRenta    = 0;
  nNume1      = 0;
  &EURODB     = 0;
|FIN;

|CALCULO ElDefecto; |TIPO 7;
  fFecha1 = ~;
  aAlfa1 = fFecha1;
  aAlfa1 = aAlfa1 % -104;

  #0#0 = aAlfa1;
  |PINTA #0#0;
|FCAL;
|| /////////////////////////// Procesos \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\

|RUTINA ClaveBaja999;
 #999#0 = #998#0;
 #999#1 = #998#3;
 #999#2 = 00;
|FRUT;

|RUTINA ClaveAlta999;
 #999#0 = #998#0;
 #999#1 = #998#3;
 #999#2 = 99;
|FRUT;

||************************************************************************
|CALCULO LeelaEmpresa; |TIPO 0;
   nEmpresa   = #999#0;
   nActividad = #999#1;
|FCAL;

|PROCESO Tipo1; |TIPO 1;
|FPRC;

|PROCESO Tipo7;  |TIPO 7;
     nModo = 7;

     |ABRE #999;
     #999#0 = #998#0;
     #999#1 = #998#3;
     #999#2 = 00;
     |LEE 001#999];
     |SI FSalida ! 0; |O #999#0 ! nEmpresa;
         |DDEFECTO #999;
     |FINSI;
     |CIERRA #999;
     |PINDA #0#999;

     |ENTLINEAL #1#999, -3, 7, 22, 0, ClaveBaja999, ClaveAlta999;
|FPRC;

|PROCESO Tipo11;  |TIPO 11;
   nInkey = FSalida;
   |SI nInkey =  10;
         nModo   = 2;
         nEmpresa   = #998#0;
         nActividad = #998#3;
         |ENTLINEAL #1#999, -3, 2, 22, 0, ClaveBaja999, ClaveAlta999;
   |FINSI;
|FPRC;
||************************************************************************

|RUTINA ClaveBaja998;
 #998#0 = 00001;
 #998#3 = 01;
|FRUT;

|RUTINA ClaveAlta998;
 #998#0 = 99999;
 #998#3 = 99;
|FRUT;

||************************************************************************

|PROCESO LeeAgicen17;

  nEmpresa   = #17#0;
  nActividad = #17#1;
  nLocal     = #17#2;

  |HAZ GrabaAux998;

  nSwRenta = 0;
  nValor   = 0;
  nIBI     = 0;
  nTerreno = 0;
  #18#0 = nEmpresa;
  #18#1 = nActividad;
  #18#2 = nLocal;
  #18#3 = #0#0;
  |LEE 041#18=;
  |SI FSalida = 0;
      nValor   = #18#4;
      nIBI     = #18#5;
      nTerreno = #18#6;
      nSwRenta = 1;
  |FINSI;

  |HAZ GrabaAux999;
|FPRC;

|DEFBUCLE LeeAgicen17;
 #17#1;
 ;
 00001, 01, 001;
 99999, 99, 999;
 e;
 NULL, LeeAgicen17;
|FIN;

|CALCULO C20pc; |TIPO 0;
  #999#10 = (#999#3 % 20) ! EURODB;
  |PINTA #999#10;
|FCAL;

|CALCULO Tipo3;  |TIPO 3;

     |DBASS aBase;  |QBF aBase;
     aDef  = aBase + "ren" + #0#0 + "/def/";
     aPath = aBase + "ren" + #0#0 + "/fich/";

     nSwHayRenta = 0;
     aMas = aDef + "rem00021.mas";
     |CARGA_DEF aMas, rem00021@;
     |SI FSalida ! 0;
         nSwHayRenta = 1;
     |SINO;
         |PATH_DAT #221 aPath;
     |FINSI;

     aFichero = ("38w" + Usuario) % 108;
     |NOME_DAT #999 aFichero;
     |ABRE #999;  |CIERRA #999;  |DELINDEX #999;

     aFichero = ("39w" + Usuario) % 108;
     |NOME_DAT #998 aFichero;
     |ABRE #998;  |CIERRA #998;  |DELINDEX #998;

     nGTempo = 0;   ||Busco Empresas Contables

     |ABRE #18;
     |ABRE #998;
     |ABRE #999;
     |BUCLE LeeAgicen17;
     |CIERRA #999;
     |CIERRA #998;
     |CIERRA #18;

     |SI nGTempo = 0;    || No existe ninguna empresa
          |MENAV "    Seleccion Vacia ";
     |SINO;
          |PINPA #0#998;
          |ENTLINEAL #1#998, -1, 4, 22, 0, ClaveBaja998, ClaveAlta998;

          |CONFI "    SSon correctos los datos Introduccidos ?";
          |SI FSalida = 0;
              |HAZ Actualizacion;
          |FINSI;
     |FINSI;

     |DELINDEX #998;
     |DELINDEX #999;

     |SI nSwHayRenta = 0;
         |DESCARGA_DEF #rem00021@;
     |FINSI;
|FCAL;
||***************************************************************************

|PROCESO GrabaAux998;
 #998#0 = nEmpresa;
 #998#3 = nActividad;
 |LEE 001#998=;
 |SI FSalida ! 0;
     |DDEFECTO #998;
     #998#0 = nEmpresa;
     #998#3 = nActividad;
     |HAZ LeeEmpresa;
     #998#1 = #1#1;
     #998#2 = #0#0;
     #998#4 = #14#4;
     |GRABA 020#998n;
 |FINSI;
 nGTempo = 1;
|FPRC;

|PROCESO LeeEmpresa;
 |ABRE #1;
 |DDEFECTO #1;
 #1#0 = nEmpresa;
 |LEE 001#1=;
 |CIERRA #1;

 |ABRE #14;
 |DDEFECTO #14;
 #14#0 = nEmpresa;
 #14#1 = nActividad;
 |LEE 001#14=;
 |SI FSalida ! 0;
     #14#18 = nEmpresa;
 |FINSI;
 nEnRenta = #14#18;
 |CIERRA #14;
|FPRC;
||-----------------------
|PROCESO EncuentroRenta;
  nNume1 = #221#118;
  |SI nNume1 = #17#2;
      nValor   = #221#15;
      nIBI     = #221#21;
      nTerreno = #221#28;
      |ERROR10;
  |FINSI;
|FPRC;

|DEFBUCLE BuscoRenta;
 #221#1002;
 14;
 nEnRenta, 01, #17#3;
 nEnRenta, 99, #17#3;
 ;
 NULL, EncuentroRenta;
|FIN;
|| -------------------------

|PROCESO GrabaAux999;

 #999#0 = nEmpresa;
 #999#1 = nActividad;
 #999#2 = nLocal;
 |LEE 001#999=;
 |SI FSalida ! 0;
     |DDEFECTO #999;
     #999#0 = nEmpresa;
     #999#1 = nActividad;
     #999#2 = nLocal;
     |GRABA 020#999c;
 |FINSI;

 |SI nSwRenta = 0; |Y nSwHayRenta = 0;
     |BUCLE BuscoRenta;
 |FINSI;
 #999#3 = nValor;
 #999#4 = nIBI;

 #999#5 = #17#3;
 aAlfa1 = #17#10; |QBF aAlfa1;
 |SI aAlfa1 ! ""; aAlfa1 = aAlfa1 + " "; |FINSI;
 aAlfa1 = aAlfa1 + #17#11; |QBF aAlfa1;
 |SI aAlfa1 ! ""; aAlfa1 = aAlfa1 + ", "; |FINSI;
 aAlfa1 = aAlfa1 + #17#12; |QBF aAlfa1;
 aAlfa2 = ("00" + #17#6) % -102;
 aAlfa3 = ("000" + #17#7) % -103;
 aAlfa1 = aAlfa1 + " " + aAlfa2 + aAlfa3 + " " + #17#8;
 #999#6 = aAlfa1;
 #999#7 = #17#4;
 #999#8 = #17#5;
 #999#9 = #17#16;
 #999#10 = nTerreno;
 |GRABA 020#999a;
|FPRC;

||***************************************************************************
|PROCESO LeeAuxi999;
  #17#0 = #999#0;
  #17#1 = #999#1;
  #17#2 = #999#2;
  |LEE 141#17=;
  |SI FSalida = 0;
      #17#16 = #999#9;
      |GRABA 020#17a;
  |FINSI;
  |LIBERA #17;

  |DDEFECTO #18;
  #18#0 = #999#0;
  #18#1 = #999#1;
  #18#2 = #999#2;
  #18#3 = #0#0;
  |LEE 141#18=;
  nEstado = FSalida;

  #18#0 = #999#0;
  #18#1 = #999#1;
  #18#2 = #999#2;
  #18#3 = #0#0;
  #18#4 = #999#3;
  #18#5 = #999#4;
  #18#6 = #999#10;
  |SI nEstado = 0;
      |GRABA 020#18a;
  |SINO;
      |SI #18#4 ! 0; |O #18#5 ! 0; |O #18#6 ! 0;
          |GRABA 020#18n;
      |FINSI;
  |FINSI;
  |LIBERA #18;
|FPRC;

|DEFBUCLE LeeAuxi999;
 #999#1;
 ;
 00001, 01, 01;
 99999, 99, 99;
 ;
 NULL, LeeAuxi999;
|FIN;

|PROCESO Actualizacion;
 |ABRE #17;
 |ABRE #18;
 |BUCLE LeeAuxi999;
 |CIERRA #18;
 |CIERRA #17;
|FPRC;
|| *********************************************************************
