|FICHEROS;
     socm0002;
     socm0004;

     socw0007,MANTE;

     caenlace@;
     canempre@;
     camaniva@;
     caivalin@;
|FIN;

|VARIABLES;
     aAlfa         = "";
     aBase         = "";
     aMas          = "";
     aPathEnl      = "";
     aFichEnl      = "";

     &enSwConfi     = 0;
     &enSwMensajes  = 0;
     &PRMNT_enError = 0;

     &enSoCtb    = 0;
     &enSoCtb0   = 0;
     &eaSoCtb1   = "";
     &efSoCtb2   = @;
     &enSoCtbE   = 0;
     &enSoDiario = 0;
     &efSoFecha  = @;

     &eaSoc704   = "";
     &enSoc705   = 0;
     &eaSoc706   = "";
     &enSoc707   = 0;
     &eaSoc708   = "";
     &enSoc709   = 0;
     &eaSoc710   = "";
     &enSoc711   = 0;
     &eaSoc712   = "";
     &eaSoc713   = "";

     &enTpRent   = 0;
     &enBaRent   = 0;
     &enCuRent   = 0;
     &enTotalF   = 0;
|FIN;

|PROCESO BorraAsientoM2;
     |DBASS aBase;
     aMas = aBase + "contagen/def/caenlace.mas";
     |CARGA_DEF aMas, caenlace@;

     aPathEnl = aBase + "contagen/fich/" + (("00000" + #socm0002#0) % -105) + #socm0002#8 + "/";
     |PATH_DAT #caenlace@#aPathEnl#;

     aFichEnl = "enl" + Usuario;
     |NOME_DAT #caenlace@#aFichEnl#;

     |ABRE #caenlace@;
     |DDEFECTO #caenlace@;
     #caenlace@#37 = #socm0002#0;
     #caenlace@#38 = #socm0002#8;
     #caenlace@#0  = #socm0002#5;
     #caenlace@#1  = #socm0002#6;
     #caenlace@#2  = #socm0002#7;
     #caenlace@#3  = 0;
     #caenlace@#9  = 0;
     #caenlace@#12 = "";
     #caenlace@#13 = 0;
     #caenlace@#25 = "S";
     |GRABA 020#caenlace@.n;
     |LIBERA #caenlace@;
     |CIERRA #caenlace@;

     enSwConfi    = 1;
     enSwMensajes = 1;
     aAlfa = ":contagen/dsapunte;" + aPathEnl + "," + aFichEnl
     |SUB_EJECUTA aAlfa;

     |ABRE #caenlace@;
     |CIERRA #caenlace@;
     |DELINDEX #caenlace@;
     enSwConfi    = 0;

     |DESCARGA_DEF #caenlace@;
|FPRC;

|PROCESO BorraAsientoM4;
     |DBASS aBase;
     aMas = aBase + "contagen/def/caenlace.mas";
     |CARGA_DEF aMas, caenlace@;

     aPathEnl = aBase + "contagen/fich/" + (("00000" + #socm0004#0) % -105) + #socm0004#14 + "/";
     |PATH_DAT #caenlace@#aPathEnl#;

     aFichEnl = "enl" + Usuario;
     |NOME_DAT #caenlace@#aFichEnl#;

     |ABRE #caenlace@;
     |DDEFECTO #caenlace@;
     #caenlace@#37 = #socm0004#0;
     #caenlace@#38 = #socm0004#14;
     #caenlace@#0  = #socm0004#11;
     #caenlace@#1  = #socm0004#12;
     #caenlace@#2  = #socm0004#13;
     #caenlace@#3  = 0;
     #caenlace@#9  = 0;
     #caenlace@#12 = "";
     #caenlace@#13 = 0;
     #caenlace@#25 = "S";
     |GRABA 020#caenlace@.n;
     |LIBERA #caenlace@;
     |CIERRA #caenlace@;

     enSwConfi    = 1;
     enSwMensajes = 1;
     aAlfa = ":contagen/dsapunte;" + aPathEnl + "," + aFichEnl
     |SUB_EJECUTA aAlfa;

     |ABRE #caenlace@;
     |CIERRA #caenlace@;
     |DELINDEX #caenlace@;
     enSwConfi    = 0;

     |DESCARGA_DEF #caenlace@;
|FPRC;

|PROCESO LeoLasLineas;
    |SI enTpRent = 0; |Y #caivalin@#18 ! 0;
        enTpRent = #caivalin@#21;
    |FINSI;
|FPRC;

|DEFBUCLE LeoLasLineas;
     #caivalin@#1003;
     ;
     #camaniva@#0, #camaniva@#1, 01;
     #camaniva@#0, #camaniva@#1, 99;
     ;
     NULL, LeoLasLineas;
|FIN;

|PROCESO LeeAsientoM2;

     |DBASS aBase;
     aMas = aBase + "contagen/def/camaniva.mas";
     |CARGA_DEF aMas, camaniva@;

     aMas = aBase + "contagen/def/caivalin.mas";
     |CARGA_DEF aMas, caivalin@;

     aPathEnl = aBase + "contagen/fich/" + (("00000" + #socm0002#0) % -105) + #socm0002#8 + "/";

     |PATH_DAT #camaniva@#aPathEnl#;
     |PATH_DAT #caivalin@#aPathEnl#;

     enTpRent   = 0;
     enBaRent   = 0;
     enCuRent   = 0;
     enTotalF   = 0;

     |ABRE #camaniva@;
     |SELECT #2#camaniva@;
     #camaniva@#7 = #socm0002#5;
     #camaniva@#8 = #socm0002#6;
     #camaniva@#9 = #socm0002#7;
     |LEE 041#camaniva@.=;
     |SI FSalida = 0;
         enBaRent = #camaniva@#19;
         enCuRent = #camaniva@#20;
         enTotalF = #camaniva@#21;
         |BUCLE LeoLasLineas;
     |FINSI;
     |LIBERA #camaniva@;
     |CIERRA #camaniva@;

     |DESCARGA_DEF #caivalin@;
     |DESCARGA_DEF #camaniva@;
|FPRC;

|PROCESO ContaRetPre;
     enSoCtbE = 1;
     |PINPA #0#socw0007;
     |PINDA #0#socw0007;
     |ENDATOS #1#socw0007;
     |SI FSalida ! 0;
         |ACABA;
     |FINSI;

     enSoDiario = #socw0007#2;
     efSoFecha  = #socw0007#3;
     eaSoc704   = #socw0007#4;
     enSoc705   = #socw0007#5;
     eaSoc706   = #socw0007#6;
     enSoc707   = #socw0007#7;
     eaSoc708   = #socw0007#8;
     enSoc709   = #socw0007#9;
     eaSoc710   = #socw0007#10;
     enSoc711   = #socw0007#11;
     eaSoc712   = #socw0007#12;
     eaSoc713   = #socw0007#13;

     enSwMensajes  = 1;
     |SI enSoCtb = 1;
        aAlfa = ":contagen/cacterem;basica";
     |SINO;
        aAlfa = ":contagen/cactepre;basica";
     |FINSI;
     |SUB_EJECUTA aAlfa;
     enSwMensajes  = 0;
|FPRC;
