|FICHEROS;
     agiy0008 #0;  || Este

     agifigen #1;  || Clientes
     agim0001 #2;  || Contratos
     agim0004 #3;  || Representantes
     agicen14 #5;  || Actividades (L)

     :/modelos/def/dsmom002;
|FIN;

|VARIABLES;
     aAlfa   = "";
     aAlfa1  = "";
     aAlfa2  = "";

     fFechaI = @;
     fFechaF = @;
     i       = 0;
     SwPrint = 0;

     &NomCli  = "";
     &fichero = 0;
     &ob1     = "";
     &ob2     = "";
     &ob3     = "";
     &ob4     = "";
     &ob5     = "";
     &ob6     = "";
     &ob7     = "";
     &ob8     = "";
     &ob9     = "";
     &ob10    = "";
     &ob11    = "";
     &ob12    = "";
     &ob13    = "";
     &ob14    = "";
     &ob15    = "";
     &ob16    = "";

     &eaModelo = "";
     &eaModDes = "";
     &eaModPer = "";
     &eaModIni = "";
     &eaModFin = "";

     &enFiscal = 0;
     &eaFiscal = "";
     &enActiv  = 0;
     &eaActiv  = "";
     &enEnvio  = 0;
     &eaEnvio  = "";
|FIN;

|INCLUYE i_consul;

|PROCESO selec; |TIPO 0;
     |SI #0Campo = "S";
          |C_M #0#1,1,"S";
          |C_M #0#2,1,"S";
          |PARA i = 3; |SI i [ 22; |HACIENDO i = i + 1;
               |C_M #0i,1,"N";
               #0i = 0; |PINTA #0i;
          |SIGUE;
     |SINO;
          |C_M #0#1,1,"N"; #0#1 = 00001; |PINTA #0#1;
          |C_M #0#2,1,"N"; #0#2 = 99999; |PINTA #0#2;
          |PARA i = 3; |SI i [ 22; |HACIENDO i = i + 1;
               |C_M #0i,1,"S";
          |SIGUE;
     |FINSI;
|FPRC;

|CALCULO NoMasEmpresas; |TIPO 0;
     |SI #0Campo = 0;
         |PARA i = Campo + 1;  |SI i [ 22;  |HACIENDO i = i + 1;
               #0i = 0;  |C_M #0i, 1, "N";
               |PINTA #0i;
         |SIGUE;
     |SINO;
         |PARA i = Campo + 1;  |SI i [ 22;  |HACIENDO i = i + 1;
               |C_M #0i, 1, "S";
         |SIGUE;
     |FINSI;
|FCAL;
-----------------------------------------------------------
|PROCESO LosModelos;
     eaModelo = ("000" + #dsmom002#2) % -103;
     eaModDes = #dsmom002#3;
     eaModPer = #dsmom002#7;
     eaModIni = "";
     |SI #dsmom002#8 > "01.01.1900";
         eaModIni = "Fecha inicio " + #dsmom002#8;
     |FINSI;
     eaModFin = "";
     |SI #dsmom002#9 > "01.01.1900";
         eaModFin = "Fecha final " + #dsmom002#9;
     |FINSI;
     fichero = 4;
     SwPrint = 1; |PRINT;
|FPRC;

|DEFBUCLE LosModelos;
    #dsmom002#1;
    ;
    #5#0, #5#1, 000;
    #5#0, #5#1, 899;
    e;
    NULL, LosModelos;
|FIN;

|PROCESO Actividades;
     fichero = 1;
     |SI #0#24 ! 0;
         |SI #5#5 > "01.01.1900"; |Y #5#5 > fFechaF; |ACABA; |FINSI;
         |SI #5#6 > "01.01.1900"; |Y #5#6 < fFechaI; |ACABA; |FINSI;
     |FINSI;

     SwPrint = 1; |PRINT;

     |BUCLE LosModelos;
|FPRC;

|DEFBUCLE BActividades;
     #5#1;
     ;
     #1#0, 001;
     #1#0, 999;
     ;
     NULL, Actividades;
|FIN;

|PROCESO Representantes;
     SwPrint = 1;
     |PRINT;
|FPRC;

|DEFBUCLE BRepresentantes;
     #3#1;
     ;
     #1#0, 01;
     #1#0, 99;
     ;
     NULL, Representantes;
|FIN;

|PROCESO Contratos;
     SwPrint = 1;
     |PRINT;
|FPRC;

|DEFBUCLE BContratos;
     #2#1;
     ;
     #1#0, 01;
     #1#0, 99;
     ;
     NULL, Contratos;
|FIN;
---------------------------------------------

|PROCESO Cliente;
     |SALVA_DATOS #1;

     #1#0 = #1#90;
     |LEE 040#1=;
     |SI FSalida ! 0; |DDEFECTO #1; |FINSI;
     NomCli = #1#1;
     |REPON_DATOS #1;
     |LIBERA #1;
     |LEE 140#1=;

     enFiscal = 0;
     eaFiscal = "";
     aAlfa = #1#3; |QBF aAlfa; |SI aAlfa ! ""; eaFiscal = aAlfa + " "; |FINSI;
     aAlfa = #1#4; |QBF aAlfa; |SI aAlfa ! ""; eaFiscal = eaFiscal + aAlfa; |FINSI;
     aAlfa = #1#5; |QBF aAlfa;
     |SI aAlfa ! "";
         |SI eaFiscal ! ""; eaFiscal = eaFiscal + ", "; |FINSI;
         eaFiscal = eaFiscal + aAlfa;
     |FINSI;
     aAlfa = #1#6; |QBF aAlfa;
     |SI aAlfa ! ""; eaFiscal = eaFiscal + " " + aAlfa; |FINSI;
     aAlfa = #1#7; |QBF aAlfa;
     |SI aAlfa ! ""; eaFiscal = eaFiscal + " " + aAlfa; |FINSI;
     aAlfa = #1#8; |QBF aAlfa;
     |SI aAlfa ! ""; eaFiscal = eaFiscal + " " + aAlfa; |FINSI;

     aAlfa = #1#11; |QBF aAlfa; aAlfa1 = #1#12; |QBF aAlfa1;
     |QBF eaFiscal;
     |SI eaFiscal ! ""; |O aAlfa ! ""; |O aAlfa1 ! ""; enFiscal = 1; |FINSI;

     enActiv  = 0;
     eaActiv  = "";
     aAlfa = #1#41; |QBF aAlfa; |SI aAlfa ! ""; eaActiv = aAlfa + " "; |FINSI;
     aAlfa = #1#42; |QBF aAlfa; |SI aAlfa ! ""; eaActiv = eaActiv + aAlfa; |FINSI;
     aAlfa = #1#43; |QBF aAlfa;
     |SI aAlfa ! "";
         |SI eaActiv ! ""; eaActiv = eaActiv + ", "; |FINSI;
         eaActiv = eaActiv + aAlfa;
     |FINSI;
     aAlfa = #1#44; |QBF aAlfa;
     |SI aAlfa ! ""; eaActiv = eaActiv + " " + aAlfa; |FINSI;
     aAlfa = #1#45; |QBF aAlfa;
     |SI aAlfa ! ""; eaActiv = eaActiv + " " + aAlfa; |FINSI;
     aAlfa = #1#46; |QBF aAlfa;
     |SI aAlfa ! ""; eaActiv = eaActiv + " " + aAlfa; |FINSI;

     aAlfa = #1#49; |QBF aAlfa; aAlfa1 = #1#50; |QBF aAlfa1;
     |QBF eaActiv;
     |SI eaActiv ! ""; |O aAlfa ! ""; |O aAlfa1 ! ""; enActiv = 1; |FINSI;

     enEnvio  = 0;
     eaEnvio  = "";
     aAlfa = #1#51; |QBF aAlfa; |SI aAlfa ! ""; eaEnvio = aAlfa + " "; |FINSI;
     aAlfa = #1#52; |QBF aAlfa; |SI aAlfa ! ""; eaEnvio = eaEnvio + aAlfa; |FINSI;
     aAlfa = #1#53; |QBF aAlfa;
     |SI aAlfa ! "";
         |SI eaEnvio ! ""; eaEnvio = eaEnvio + ", "; |FINSI;
         eaEnvio = eaEnvio + aAlfa;
     |FINSI;
     aAlfa = #1#54; |QBF aAlfa;
     |SI aAlfa ! ""; eaEnvio = eaEnvio + " " + aAlfa; |FINSI;
     aAlfa = #1#55; |QBF aAlfa;
     |SI aAlfa ! ""; eaEnvio = eaEnvio + " " + aAlfa; |FINSI;
     aAlfa = #1#56; |QBF aAlfa;
     |SI aAlfa ! ""; eaEnvio = eaEnvio + " " + aAlfa; |FINSI;

     aAlfa = #1#59; |QBF aAlfa; aAlfa1 = #1#60; |QBF aAlfa1;
     |QBF eaEnvio;
     |SI eaEnvio ! ""; |O aAlfa ! ""; |O aAlfa1 ! ""; enEnvio = 1; |FINSI;

     SwPrint = 0;
     fichero = 1;
     |BUCLE  BActividades;

     fichero = 2;
     |BUCLE  BRepresentantes;

     fichero = 3;
     |BUCLE  BContratos;
     |SI SwPrint = 1;
          ob1 = #1#24; |QBF ob1;
          ob2 = #1#25; |QBF ob2;
          ob3 = #1#26; |QBF ob3;
          ob4 = #1#27; |QBF ob4;
          ob5 = #1#28; |QBF ob5;
          ob6 = #1#29; |QBF ob6;
          ob7 = #1#30; |QBF ob7;
          ob8 = #1#31; |QBF ob8;
          ob9 = #1#32; |QBF ob9;
          ob10= #1#33; |QBF ob10;
          ob11= #1#34; |QBF ob11;
          ob12= #1#35; |QBF ob12;
          ob13= #1#36; |QBF ob13;
          ob14= #1#37; |QBF ob14;
          ob15= #1#38; |QBF ob15;
          ob16= #1#39; |QBF ob16;
          |PIEINF;
      |FINSI;
|FPRC;

|DEFBUCLE BCliente;
     #1#1;
     ;
     #0#1;
     #0#2;
     ;
     NULL, Cliente;
|FIN;

|PROCESO imprime; |TIPO 3;

     fFechaI = "01.01.0000";
     fFechaF = "31.12.2099";
     |SI #0#24 ! 0;
         aAlfa = #0#24;
         aAlfa1 = "01.01." + aAlfa; fFechaI = aAlfa1;
         aAlfa1 = "31.12." + aAlfa; fFechaF = aAlfa1;
     |FINSI;

     |DDEFECTO #agifigen;

     |IMPRE 0;
     |SI FSalida ! 0;
         |MENSA "0000No existe Impresora.Proceso interrumpido.";
         |ACABA;
     |FINSI;

     |INFOR "agiy0008";
     |SI FSalida ! 0;
         |MENSA "0000No existe informe. Proceso interrumpido";
         |FINIMP;
         |ACABA;
     |FINSI;

     |SI #0#0 = "S";
         |BUCLE BCliente;
     |SINO;
         |PARA i = 3; |SI i [ 22; |HACIENDO i = i + 1;
               |SI #0i > 0;
                   #0#1 = #0i;
                   #0#2 = #0i;
                   |BUCLE BCliente;
               |FINSI;
         |SIGUE;
     |FINSI;
     |FININF;
     |FINIMP;
|FPRC;
