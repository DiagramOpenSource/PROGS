|FICHEROS;
     socz0001;

     socm0001;
     socm0002;
     agifigen;

     socw0002,MANTE;
     socw0003;
     socw0004,MANTE;

     dsinfcoc;
    :/contagen/def/cacuenta;
|FIN;

|VARIABLES;
     nPanta             = 0;
     nRango             = 0;
     nPos1              = 0;
     nPos2              = 0;
     nGrid              = 0;
     nGrid2             = 0;
     nVentana           = 0;
     nVentTrab          = 0;
     nBoton             = 0;
     nBtnSal            = -1;
     nHay               = -1;
     nDesdeEmp          = -1;
     nHastaEmp          = -1;
     nCampo             = -1;
     nBtnAltG2          = 0;
     nBtnModG2          = 0;
     nBtnBajG2          = 0;
     nBtnRetG2          = 0;
     nBtnCtbG2          = 0;
     nModoPag           = 0;
     nNumPagos          = 0;
     nPago              = 0;
     nResto             = 0;
     nDia               = 0;
     nMes               = 0;
     nAnyo              = 0;
     nNume              = 0;
     nConta             = 0;
     nSumaMes           = 0;
     nPasada            = 0;

     aQueBoton          = "";
     aID                = "";
     aFichero           = "";
     aTecla             = "";
     aEsc1              = "";
     aEsc2              = "";
     aRetu              = "";
     aAlfa              = "";

     fFecha             = @;

     {-1}aVent          = "";
         aVent1         = 0;
         aVent2         = 0;
         aVent3         = 0;
         aVent4         = 0;
         aVent5         = "";

     &PRMNT_enError     = 0;

     &enSoCtb    = 0;
     &enSoCtb0   = 0;
     &eaSoCtb1   = "";
     &efSoCtb2   = @;
     &enSoCtbE   = 0;
     &enEmpresa  = 0;

     &enTpRent   = 0;
     &enBaRent   = 0;
     &enCuRent   = 0;
     &enTotalF   = 0;

     informe     = "";
     aParam      = "";
  &efFecLeg      = @;
   aNombrePDF    = "";
   nSwError      = 0;
   nCalc         = 0;
   aIP           = "";
   &enHayInforme = 0;
{1}aContiene    = "";
|FIN;

|INCLUYE i_agicon;
|INCLUYE i_masivo;

|PROCESO socm0002Inf;
     nHay = 1;
     |PRINT;
|FPRC;

|DEFBUCLE socm0002Inf;
     #socm0002#1;
     ;
     #socw0003#0, #socw0003#1, "31.12.2999";
     #socw0003#0, #socw0003#1, "01.01.0000";
     ;
     NULL, socm0002Inf;
|FIN;

|PROCESO socw0003Inf;
     nHay = 0;
     |BUCLE socm0002Inf;

     |SI nHay = 0;
         |DDEFECTO #socm0002;
         |PRINT;
     |FINSI;
|FPRC;

|DEFBUCLE socw0003Inf;
     #socw0003#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, socw0003Inf;
|FIN;

|PROCESO InformePDF;
   nSwError = 0;

   aIP = ""; |IP_REMOTO aIP;
   aContiene = "";
   |ESPECIFICA "RBASS", aContiene;
   aAlfa = aContiene1;
   aAlfa = aAlfa - "\";
   |SI FSalida ! 0;
      nCalc = ((FSalida / 100) ! 0) + 99;
      aAlfa = aAlfa % nCalc;
   |SINO;
      aAlfa = aAlfa - "/";
      |SI FSalida ! 0;
         nCalc = ((FSalida / 100) ! 0) + 99;
         aAlfa = aAlfa % nCalc;
      |FINSI;
   |FINSI;

   aAlfa = eaPathTemporal;
   aNombrePDF = (("00" + enOrMvo) % - 102) + aNombrePDF;

   |SI aIP ! "";
       |RMKDIR aAlfa;
   |SINO;
       |MKDIR aAlfa;
   |FINSI;

   Impresora = "CrystalReport;" + aAlfa + aNombrePDF;
   |IMPRE -1;
   |SI FSalida = 0;
       |INFOR informe;
       |SI FSalida ! 0;
          || |SI nSwMen = 0; |MENAV "     Error en informe."; |FINSI;
          nSwError = 1;
       |FINSI;
   |FINSI;
   enHayInforme = 1;
|FPRC;

|PROCESO InformeEspecial;
     informe = "socz0001";
     aNombrePDF = "presadm.pdf";
     |HAZ InformePDF;
     |SI nSwError = 1; |ACABA; |FINSI;

     |BUCLE socw0003Inf;

     |PIEINF;
     |FININF;
     |FINIMP;
|FPRC;

|PROCESO Informe;

     Impresora = "CrystalReport";
     |IMPRE -1;
     |SI FSalida ! 0;
         |MENAV "    Error en Impresora Crystal Report";
         |ACABA;
     |FINSI;

     |INFOR "socz0001";
     |SI FSalida ! 0; |FINIMP; |ACABA; |FINSI;

     |VENTANA 0501, 0540, -1, 16, "Procesando informe";
     nVentTrab = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentTrab;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PTEC 802; |PAUSA;

     |BUCLE socw0003Inf;

     |PIEINF;
     |FININF;
     |FINIMP;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentTrab;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;
     |FINVENTANA nVentTrab;

     |FOCOTECLADO nGrid;
|FPRC;

|PROCESO GrabaPago;
     |SI nPasada = 0;
         #socm0002#0 = #socw0003#0;
         #socm0002#1 = #socw0003#1;
         #socm0002#2 = fFecha;
         |LEE 000#socm0002.=;
         |SI FSalida = 0;  |Y #socm0002#4 = "S";
             nHay = 1;
         |FINSI;

         |ACABA;
     |FINSI;

     #socm0002#0 = #socw0003#0;
     #socm0002#1 = #socw0003#1;
     #socm0002#2 = fFecha;
     |LEE 101#socm0002.=;
     |SI FSalida ! 0;
         |DDEFECTO #socm0002;
         #socm0002#0 = #socw0003#0;
         #socm0002#1 = #socw0003#1;
         #socm0002#2 = fFecha;

         |GRABA 020#socm0002.b;
     |FINSI;

     #socm0002#3 = nPago;

     |SI  nConta = nNumPagos;
          #socm0002#3 = nPago + nResto;
     |FINSI;

     |GRABA 020#socm0002.a;
     |LIBERA #socm0002;
|FPRC;

|PROCESO RealizaPago;
     |SI #socw0004#1 = "M";  nNumPagos = 12;  nSumaMes = 1;  |FINSI;
     |SI #socw0004#1 = "B";  nNumPagos = 6;   nSumaMes = 2;  |FINSI;
     |SI #socw0004#1 = "T";  nNumPagos = 4;   nSumaMes = 3;  |FINSI;
     |SI #socw0004#1 = "C";  nNumPagos = 3;   nSumaMes = 4;  |FINSI;
     |SI #socw0004#1 = "S";  nNumPagos = 2;   nSumaMes = 6;  |FINSI;
     |SI #socw0004#1 = "A";  nNumPagos = 1;   nSumaMes = 0;  |FINSI;

     nPago  = (#socw0004#0 / nNumPagos) ! 2;
     nResto = #socw0004#0 - (nPago * nNumPagos);

     aAlfa  = #socw0004#2 % 102;  nDia  = aAlfa;
     aAlfa  = #socw0004#2 % 402;  nMes  = aAlfa;
     aAlfa  = #socw0004#2 % 704;  nAnyo = aAlfa;
     fFecha = #socw0004#2;

     |PARA nConta = 1;  |SI nConta [ nNumPagos;  |HACIENDO nConta = nConta + 1;
           |HAZ GrabaPago;

           nMes = nMes + nSumaMes;
           |SI nMes ] 13;
               nMes  = nMes - 12;
               nAnyo = nAnyo + 1;
           |FINSI;

           aAlfa  = (("00" + nDia) % -102) + "." + (("00" + nMes) % -102) + "." + nAnyo;
           fFecha = aAlfa;
           nNume  = fFecha;
           nNume  = nNume + 1;
           nNume  = nNume - 1;
           fFecha = nNume;
     |SIGUE;
|FPRC;

|PROCESO PagoAutomatico;
     |VENTANA 0501, 1733, -1, 16, "Pagos autom ticos";
     nVentTrab = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentTrab;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PTEC 802; |PAUSA;

     |DDEFECTO #socw0004;
     |PINPA #0#socw0004;
     |PINDA #0#socw0004;
     |ENDATOS #1#socw0004;
     |SI FSalida = 0;
         nHay    = 0;
         nPasada = 0; |HAZ RealizaPago;

         |SI nHay = 1;
             aAlfa = "0000Proceso cancelado. ";
             aAlfa = aAlfa + "Se han calculado retribuciones que ya existen y ";
             aAlfa = aAlfa + "est n contabilidadas, b¢rrelas primero.";
             |MENAV aAlfa;
         |SINO;
             nPasada = 1; |HAZ RealizaPago;
         |FINSI;
     |FINSI;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentTrab;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;
     |FINVENTANA nVentTrab;

     |REFRESCACONTROL nGrid2;
     |FOCOTECLADO nGrid2;
|FPRC;

|PROCESO EntraDatosSocw0002;
     |ESTADO_CONTROL nBtnAltG2, "DISABLE";
     |ESTADO_CONTROL nBtnModG2, "DISABLE";
     |ESTADO_CONTROL nBtnBajG2, "DISABLE";
     |ESTADO_CONTROL nBtnRetG2, "DISABLE";
     |ESTADO_CONTROL nBtnCtbG2, "DISABLE";

     |HAZ QuitaBtnSalir;

     |ESTADO_CONTROL nGrid2, "DISABLE";

     |PULSATECLA;

     |DDEFECTO #socw0002;

     |SI nModoPag = 1;
         |C_M #socw0002#0, 1, "S";

         |DDEFECTO #socm0002;
         #socm0002#0 = #socm0001#0;
         #socm0002#1 = #socm0001#1;
     |SINO;
         |C_M #socw0002#0, 1, "N";

         |LEE 101#socm0002.=;
         |SI FSalida ! 0;  |ACABA;  |FINSI;
     |FINSI;

     #socw0002#0 = #socm0002#2;
     #socw0002#1 = #socm0002#3;

     |VENTANA 0501, 0940, -1, 16, "Datos de la retribuci¢n";
     nVentTrab = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentTrab;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PTEC 802; |PAUSA;

     |PINPA #0#socw0002;
     |PINDA #0#socw0002;
     |ENDATOS #1#socw0002;
     |SI FSalida = 0;
         #socm0002#2 = #socw0002#0;
         #socm0002#3 = #socw0002#1;

         |SI nModoPag = 1;
             |GRABA 020#socm0002.n;
         |SINO;
             |GRABA 020#socm0002.a;
         |FINSI;
     |FINSI;
     |LIBERA #socm0002;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentTrab;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;
     |FINVENTANA nVentTrab;

     |ESTADO_CONTROL nBtnAltG2, "ENABLE";

     |HAZ PonBtnSalir;

     |ESTADO_CONTROL nGrid2, "ENABLE";
     |REFRESCACONTROL nGrid2;

     FSalida = 1;  |HAZ EventoGrid2;

     |FOCOTECLADO nGrid2;
|FPRC;

|PROCESO AltG2;
     nModoPag = 1;
     |HAZ EntraDatosSocw0002;
|FPRC;

|PROCESO ModG2;
     |LEE 000#socm0002.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |SI #socm0002#4 = "S";
         |CONFI "0000 El registro est  contabilidado, quiere dar de baja el asiento y modificar el registro";
         |SI FSalida ! 0;
             |FOCOTECLADO nGrid2;
             |ACABA;
         |FINSI;

         |HAZ BorraAsientoM2;
         |SI PRMNT_enError < 0;
             aAlfa = " el Ejercicio Contable est  bloqueado.";
             |SI PRMNT_enError = -4; aAlfa = " el Ejercicio Contable est  Cerrado"; |FINSI;
             aAlfa = "0000No se puede modificar el registro," + aAlfa;
             |MENAV aAlfa;
             |FOCOTECLADO nGrid2;
             |ACABA;
         |FINSI;

         |LEE 101#socm0002.=;
         #socm0002#4 = "N";
         #socm0002#5 = 0;
         #socm0002#6 = "01.01.0000";
         #socm0002#7 = 0;
         #socm0002#8 = 0;

         |GRABA 020#socm0002.a;
         |LIBERA #socm0002;
     |FINSI;

     nModoPag = 2;
     |HAZ EntraDatosSocw0002;
|FPRC;

|PROCESO BajG2;
     |LEE 000#socm0002.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |SI #socm0002#4 = "S";
         |CONFI "0000 El registro est  contabilidado, quiere dar de baja el asiento y borrar el registro";
         |SI FSalida ! 0;
             |FOCOTECLADO nGrid2;
             |ACABA;
         |FINSI;

         |HAZ BorraAsientoM2;
         |SI PRMNT_enError < 0;
             aAlfa = " el Ejercicio Contable est  bloqueado.";
             |SI PRMNT_enError = -4; aAlfa = " el Ejercicio Contable est  Cerrado"; |FINSI;
             aAlfa = "0000No se puede dar de baja el registro," + aAlfa;
             |MENAV aAlfa;
             |FOCOTECLADO nGrid2;
             |ACABA;
         |FINSI;
     |SINO;
         |CONFI "0000 Confirma la baja del registro seleccionado";
         |SI FSalida ! 0;
             |FOCOTECLADO nGrid2;
             |ACABA;
         |FINSI;
     |FINSI;

     |LEE 101#socm0002.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |BORRA 020#socm0002.a;
     |LIBERA #socm0002;

     |ESTADO_CONTROL nBtnModG2,  "DISABLE";
     |ESTADO_CONTROL nBtnBajG2,  "DISABLE";
     |ESTADO_CONTROL nBtnRetG2,  "DISABLE";
     |ESTADO_CONTROL nBtnCtbG2,  "DISABLE";

     |REFRESCACONTROL nGrid2;
     |FOCOTECLADO nGrid2;
|FPRC;

|PROCESO RetCarta;
     Impresora = "CrystalReport";
     |IMPRE -1;
     |SI FSalida ! 0;
         |MENAV "    Error en Impresora Crystal Report";
         |ACABA;
     |FINSI;

     |INFOR "socm0002";
     |SI FSalida ! 0; |FINIMP; |ACABA; |FINSI;

     |LEE 000#socm0002.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |ABRE #agifigen;
     #agifigen#0 = #socm0002#0;
     |LEE 000#agifigen.=;
     |SI FSalida ! 0;  |DDEFECTO #agifigen;  |FINSI;
     |CIERRA #agifigen;

     |HAZ LeeAsientoM2;

     |VENTANA 0501, 0540, -1, 16, "Procesando informe";
     nVentTrab = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentTrab;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PTEC 802; |PAUSA;

     |PRINT;

     |FININF;
     |FINIMP;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentTrab;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;
     |FINVENTANA nVentTrab;

     |ESTADO_CONTROL nBtnModG2,  "DISABLE";
     |ESTADO_CONTROL nBtnBajG2,  "DISABLE";
     |ESTADO_CONTROL nBtnRetG2,  "DISABLE";
     |ESTADO_CONTROL nBtnCtbG2,  "DISABLE";

     |REFRESCACONTROL nGrid2;
     |FOCOTECLADO nGrid2;
|FPRC;

|PROCESO ConPago;
     |LEE 000#socm0002.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |VENTANA 0501, 1860, -1, 16, "Procesando contabilizacion";
     nVentTrab = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentTrab;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PTEC 802; |PAUSA;

     |SI eaPathContagen ! "";
         enEmpresa = #socm0002#0;
         |HAZ SituaMaestra;
         |SI swerror = 1;
             |MENAV "    No existe Empresa Contable";
             |ACABA;
         |FINSI;
         |PATH_DAT #cacuenta#aPathConta#;
     |FINSI;

     enSoCtb  = 1;
     enSoCtb0 = #socm0002#0;
     eaSoCtb1 = #socm0002#1;
     efSoCtb2 = #socm0002#2;
     |HAZ ContaRetPre;
     |SI enSoCtbE = 0;
         |MENAV "0000Retribucion Contabilizada";
     |FINSI;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentTrab;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;
     |FINVENTANA nVentTrab;

     |ESTADO_CONTROL nBtnModG2,  "DISABLE";
     |ESTADO_CONTROL nBtnBajG2,  "DISABLE";
     |ESTADO_CONTROL nBtnRetG2,  "DISABLE";
     |ESTADO_CONTROL nBtnCtbG2,  "DISABLE";

     |REFRESCACONTROL nGrid2;
     |FOCOTECLADO nGrid2;
|FPRC;

|PROCESO BtnsGrid2;

     |CONTROL_SIMPLE nPanta, "BOTON,{{193}}Alta ", 3764, 3774, AltG2;
     nBtnAltG2 = FSalida;

     |CONTROL_SIMPLE nPanta, "BOTON,{{197}}Modificar ", 3776, 3786, ModG2;
     nBtnModG2 = FSalida;

     |CONTROL_SIMPLE nPanta, "BOTON,{{199}}Borrar", 3788, 3798, BajG2;
     nBtnBajG2 = FSalida;

     |CONTROL_SIMPLE nPanta, "BOTON,{{205}}Justificante Pago", 3722, 3741, RetCarta;
     nBtnRetG2 = FSalida;

     |CONTROL_SIMPLE nPanta, "BOTON,{{197}}Contabilizar Pago", 3743, 3762, ConPago;
     nBtnCtbG2 = FSalida;

     |ESTADO_CONTROL nBtnModG2,  "DISABLE";
     |ESTADO_CONTROL nBtnBajG2,  "DISABLE";
     |ESTADO_CONTROL nBtnRetG2,  "DISABLE";
     |ESTADO_CONTROL nBtnCtbG2,  "DISABLE";
|FPRC;

|PROCESO EventoGrid2;
     |SI FSalida = 1;  |O FSalida = 2;
         |LEE 000#socm0002.=;

         |ESTADO_CONTROL nBtnModG2, "ENABLE";
         |ESTADO_CONTROL nBtnBajG2, "ENABLE";
         |SI #socm0002#4 = "S";
             |ESTADO_CONTROL nBtnRetG2, "ENABLE";
             |ESTADO_CONTROL nBtnCtbG2, "DISABLE";
         |SINO;
             |ESTADO_CONTROL nBtnRetG2, "DISABLE";
             |ESTADO_CONTROL nBtnCtbG2, "ENABLE";
         |FINSI;

         |PULSATECLA;
     |FINSI;

     |SI FSalida = 4;
         |HAZ ModG2;
     |FINSI;
|FPRC;

|PROCESO Baja2;
     #socm0002#0 = #socw0003#0;
     #socm0002#1 = #socw0003#1;
     #socm0002#2 = "31.12.2999";
|FPRC;

|PROCESO Alta2;
     #socm0002#0 = #socw0003#0;
     #socm0002#1 = #socw0003#1;
     #socm0002#2 = "01.01.0000";
|FPRC;

|PROCESO EventoGrid1;
     |SI FSalida = 1;  |O FSalida = 2;
         |LEE 000#socw0003.=;

         #socm0001#0  = #socw0003#0;
         #socm0001#1  = #socw0003#1;
         #socm0001#2  = #socw0003#2;
         #socm0001#3  = #socw0003#3;
         #socm0001#4  = #socw0003#4;
         #socm0001#5  = #socw0003#5;
         #socm0001#6  = #socw0003#6;
         #socm0001#7  = #socw0003#7;
         #socm0001#8  = #socw0003#8;
         #socm0001#9  = #socw0003#9;
         #socm0001#10 = #socw0003#10;
         #socm0001#11 = #socw0003#11;
         #socm0001#12 = #socw0003#12;
         #socm0001#13 = #socw0003#13;
         #socm0001#14 = #socw0003#14;
         #socm0001#15 = #socw0003#15;
         #socm0001#16 = #socw0003#16;
         #socm0001#17 = #socw0003#17;

         |REFRESCACONTROL nGrid2;
     |FINSI;

     |SI FSalida = 4;
         |HAZ PagoAutomatico;
     |FINSI;

     |PULSATECLA;
|FPRC;

|PROCESO Procesar;
     |DESTRUYECONTROL nGrid;
     |PULSATECLA;

     |FIN_CONTROL_WINDOWS nBtnSal;

     |HAZ BtnsGrid2;

     |CONTROL_SIMPLE nPanta, "LABEL,{{15}}Doble click en el registro para retribuir autom ticamente", 1102, 1160, NULL;
     |CONTROL_SIMPLE nPanta, "BOTON,{{197}}Informe", 1188, 1198, Informe;

     nRango = 4 + 8 + 16 + 32 + 128;
     |LINEAL_SIMPLE #1#socm0002, nRango, 2701, 3699, Baja2, Alta2, EventoGrid2;
     nGrid2 = FSalida;

     nRango = 4 + 8 + 16 + 32 + 128;
     |LINEAL_SIMPLE #1#socw0003, nRango, 1201, 2599, NULL, NULL, EventoGrid1;
     nGrid = FSalida;

     aEsc1  = &255 + "806";
     aEsc2  = &255 + "807";
     aRetu  = &255 + "802";
     |PARA; |SI;  |HACIENDO;
          FSalida = "::{{001}}Salir," + nGrid;
          |LEETECLA aTecla;
          |SI aTecla = aEsc1; |SAL;  |FINSI;
          |SI aTecla = aEsc2; |SAL;  |FINSI;
          |SI aTecla = aRetu; |SAL;  |FINSI;
     |SIGUE;
|FPRC;

|PROCESO socm0002;
     nHay = 1;
     |ERROR10;
|FPRC;

|DEFBUCLE socm0002;
     #socm0002#2;
     ;
     #socm0001#0, #socm0001#1, #socz0001#2;
     #socm0001#0, #socm0001#1, #socz0001#3;
     ;
     NULL, socm0002;
|FIN;

|PROCESO socm0001;

     |SI #socz0001#4 ! "T";
         nHay = 0;
         |BUCLE socm0002;

         |SI #socz0001#4 = "I";
             |SI nHay = 0;  |ACABA;  |FINSI;
         |SINO;
             |SI nHay ! 0;  |ACABA;  |FINSI;
         |FINSI;
     |FINSI;

     |PARA nCampo = 0;  |SI nCampo [ 17;  |HACIENDO nCampo = nCampo + 1;
           #socw0003#nCampo# = #socm0001#nCampo#;
     |SIGUE;

     #agifigen#0 = #socm0001#0;
     |LEE 000#agifigen.=;
     |SI FSalida ! 0;  |DDEFECTO #agifigen;  |FINSI;

     #socw0003#18 = #agifigen#1;

     |GRABA 020#socw0003.n;
     |LIBERA #socw0003;
|FPRC;

|DEFBUCLE socm0001;
     #socm0001#1;
     ;
     nDesdeEmp, "            ";
     nHastaEmp, "zzzzzzzzzzzz";
     ;
     NULL, socm0001;
|FIN;

|PROCESO Tipo12Fz1;  |TIPO 12;
     |SI FSalida = 7;  |ACABA;  |FINSI;

     |VENTANA 0501, 0540, -1, 17, "Procesando trabajo";
     nVentTrab = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentTrab;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     nDesdeEmp = #socz0001#0;
     nHastaEmp = #socz0001#0;

     |SI #socz0001#0 = 0;
         nDesdeEmp = 1;
         nHastaEmp = 99999;
     |FINSI;

     |ABRE #agifigen;
     |BUCLE socm0001;
     |CIERRA #agifigen;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentTrab;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nVentTrab;

     |LEE 000#socw0003.p;
     |SI FSalida ! 0;
         |MENAV "0000Selecci¢n vac¡a.";
         |ACABA;
     |FINSI;

     |HAZ Procesar;
|FPRC;

|PROCESO Salir;
     |PTEC 807;
|FPRC;

|PROCESO PtecFinal;  |TIPO 0;
     |PTEC 806;
|FPRC;

|PROCESO Tipo0C4Fz1;  |TIPO 0;
     |C_M #socz0001#2, 1, "S";
     |C_M #socz0001#3, 1, "S";

     |SI #socz0001#4 = "T";
         |C_M #socz0001#2, 1, "N";  #socz0001#2 = "01.01.0000";
         |C_M #socz0001#3, 1, "N";  #socz0001#3 = "31.12.2099";
     |FINSI;

     |PINTA #socz0001#2;
     |PINTA #socz0001#3;
|FPRC;

|PROCESO Tipo7C0Fz1;  |TIPO 7;
     |SI nBtnSal ! -1;  |ACABA;  |FINSI;

     aQueBoton = "|X000";
     aID       = #socz0001#aQueBoton#;
     nBoton    = aID;
     |ESTADO_CONTROL nBoton, "HIDE";

     aQueBoton = "|X001";
     aID       = #socz0001#aQueBoton#;
     nBoton    = aID;
     |ESTADO_CONTROL nBoton, "HIDE";

     |CONTROL_SIMPLE 0, "BOTON,{{001}}Salir", 3688, 3698, Salir;
     nBtnSal = FSalida;
|FPRC;

|PROCESO Tipo0C0Fz1;  |TIPO 0;
     |SI #socz0001#0 = 0;
         #socz0001#1 = "Todas";
     |SINO;
         |ABRE #agifigen;
         #agifigen#0 = #socz0001#0;
         |LEE 000#agifigen.=;
         |SI FSalida ! 0;
             |MENAV "0000No exite la empresa.";
             |ERROR;
             |CIERRA #agifigen;
             |ACABA;
         |FINSI;
         |CIERRA #agifigen;

         #socz0001#1 = #agifigen#1;
     |FINSI;

     |PINTA #socz0001#1;
|FPRC;

|PROCESO LosInfBasica;
    |ABRE #dsinfcoc;
    |DDEFECTO #dsinfcoc;
    #dsinfcoc#0 = enCoMvo;
    |LEE 041#dsinfcoc.=;
    |CIERRA #dsinfcoc;
|FPRC;

|PROGRAMA;
     |HAZ BusquedaApli;

     |SI PARAMETRO ! ""; |O enSwMvo = 2;
         |DDEFECTO #socz0001;

         |SI enSwMvo = 2;
             #socz0001#0 = enEmprM;
             |HAZ LosInfBasica;
             #socz0001#2 = #dsinfcoc#138;
             #socz0001#3 = #dsinfcoc#139;
             #socz0001#4 = #dsinfcoc#137;
         |SINO;
             #socz0001#0 = PARAMETRO;
             #socz0001#4 = "T";
         |FINSI;

         |ABRE #agifigen;
         #agifigen#0 = #socz0001#0;
         |LEE 000#agifigen.=;
         |SI FSalida ! 0;  |DDEFECTO #agifigen;  |FINSI;
         |CIERRA #agifigen;

         #socz0001#1 = #agifigen#1;

         nDesdeEmp = #socz0001#0;
         nHastaEmp = #socz0001#0;

         |ABRE #agifigen;
         |BUCLE socm0001;
         |CIERRA #agifigen;

         |SI enSwMvo = 2;
             |HAZ InformeEspecial;
         |SINO;
             |HAZ Informe;
         |FINSI;

         |ACABA;
     |FINSI;

     |CLS;

     |PINPA #0#socz0001; nPanta = FSalida;
     |PINDA #0#socz0001;

     nRango = 4 + 8 + 16 + 32 + 128;

     |LINEAL_SIMPLE #1#socw0003, nRango, 1201, 2599, NULL, NULL, NULL;
     nGrid = FSalida;

     |ENDATOS #1#socz0001;
|FPRO;

|PROCESO Tipo80Fz1;  |TIPO 80;
     aFichero = "socw0003" + Usuario;
     |NOME_DAT #socw0003#aFichero#;

     |ABRE #socw0003;
     |CIERRA #socw0003;
     |DELINDEX #socw0003;

     |ABRET #socm0002;
     |ABRET #socw0003;

     FSalida = 3799;
|FPRC;

|PROCESO Tipo90Fz1;  |TIPO 90;
     |CIERRAT #socm0002;
     |CIERRAT #socw0003;
     |DELINDEX #socw0003;
|FPRC;
