|FICHEROS;
     dspase00 #0;
     dspase09 #9;
     dspase15 #15;

     :/basica/def/zmonedas   #200;
     :/modelos/def/dsmom103  #103;

     refer00@ #900;
     refer01@ #901;
     refer02@ #902;
|FIN;

|VARIABLES;
     nAnyo           = 0;
     nSw             = 0;
     nTecla          = 0;
     nCampoD         = 0;
     nCampoH         = 0;
     nModelo         = 0;
     nPeriodo        = 0;
     nCampo1         = 0;
     nCampo5         = 0;
     nCampo7         = 0;
     nCodigoNue      = 0;
     nCodigoReo      = 0;
     nCodigoCon      = 0;
     nEstaCambio     = 0;
     nConversor      = 0;
     nRedondeo       = 0;
     nConverMod      = 0;
     nRedonMod       = 0;
     nEjer           = 0;

     aPathAnterior    = "";
     aPathDefFiscal   = "";
     aPathFichFiscal  = "";
     aPathDefAgicont  = "";
     aPathFichAgicont = "";
     aPathFichMoneda  = "";
     aPathDestino     = "";
     aDef             = "";
     aDirEmpresa      = "";
     aDirFichDestino  = "";
     aDirFichOrigen   = "";
     aFichero         = "";
     aAlfa            = "";
     aAlfa1           = "";
     aAlfa2           = "";
     aAlfa3           = "";
     nCanal           = 0;
     aMonedaAgieos    = "";

     fFecha           = "";

     &eaPathContagen = "";
     &eaPathBasica   = "";
     &eaPathDsmodelo = "";
     &eaPathIntegral = "";
     &eaPathAgitool  = "";

     &eaFAsiento     = "";
     &enEmpresa      = 0;
     &enPerConta     = 0;
     &eaNombreEmp    = "";
     &enTipoAct      = 0;
     &enTipoPase     = 0;
     &enEjer         = 0;
     &enActividad    = 0;
     &enComplem      = 0;
     &eaCodEpi2      = "";
     &enCodEpi3      = 0;
|FIN;

|PROCESO CogeCodigo;
     |SI #15#22 = "S";  |ACABA;  |FINSI;

     nCodigoNue = #15#3;
     |ERROR10;
|FPRC;

|DEFBUCLE dspase15;
     #15#4;
     ;
     nCodigoReo, "            ", 000;
     nCodigoReo, "zzzzzzzzzzzz", 999;
     ;
     NULL, CogeCodigo;
|FIN;

|DEFBUCLE dspase15C;
     #15#5;
     ;
     nCodigoCon, "            ", 000;
     nCodigoCon, "zzzzzzzzzzzz", 999;
     ;
     NULL, CogeCodigo;
|FIN;

|PROCESO PasaDesdeActiv;
     |SI #900#27 = "D";  |ACABA;  |FINSI;
     |SI #900#34 = 0;    |ACABA;  |FINSI;

     |SI nEstaCambio = 1;
         nCodigoNue = 0;
         nCodigoReo = #900#0;
         |BUCLE dspase15;
         |SI nCodigoNue = 0;  |ACABA;  |FINSI;
     |SINO;
         nCodigoNue = #900#0;
     |FINSI;

     |SI nEjer [ 2008;
         #103#0 = 300;
     |SINO;
         #103#0 = 303;
     |FINSI;

     #103#1 = nCodigoNue;
     #103#2 = #900#1;
     |SI #900#2 [ 80;
         #103#3 = 2000 + #900#2;
     |SINO;
         #103#3 = 1900 + #900#2;
     |FINSI;
     #103#4 = 12;
     #103#5 = (#900#34 / nConverMod) ! nRedonMod;
     |GRABA 020#103n;
     |LIBERA #103;
|FPRC;

|DEFBUCLE eosactiv;
     #900#1003;
     ;
     00000, 1, #9#0;
     99999, 9, #9#0;
     ;
     NULL, PasaDesdeActiv;
|FIN;

|PROCESO PasaModelo300EOS;
     |SI #900#55 ] 0;  |ACABA;  |FINSI;

     |SI nEstaCambio = 1;
         nCodigoNue = 0;
         nCodigoReo = #900#0;
         |BUCLE dspase15;
         |SI nCodigoNue = 0;  |ACABA;  |FINSI;
     |SINO;
         nCodigoNue = #900#0;
     |FINSI;

     #103#0 = 300;
     #103#1 = nCodigoNue;
     #103#2 = #900#45;
     |SI #900#2 [ 80;
         #103#3 = 2000 + #900#2;
     |SINO;
         #103#3 = 1900 + #900#2;
     |FINSI;
     |SI #900#1 = 1;  #103#4 = 3;   |FINSI;
     |SI #900#1 = 2;  #103#4 = 6;   |FINSI;
     |SI #900#1 = 3;  #103#4 = 9;   |FINSI;
     |SI #900#1 = 4;  #103#4 = 12;  |FINSI;
     #103#5 = (-#900#55 / nConverMod) ! nRedonMod;
     |GRABA 020#103n;
     |LIBERA #103;
|FPRC;

|DEFBUCLE eosm1300;
     #900#1004;
     ;
     00000, 1, #9#1, #9#0;
     99999, 9, #9#1, #9#0;
     ;
     NULL, PasaModelo300EOS;
|FIN;

|PROCESO PasaModelo303EOS;
     |SI #901#55 ] 0;  |ACABA;  |FINSI;
     |SI #901#31 ! 0;  |ACABA;  |FINSI;

     |SI nEstaCambio = 1;
         nCodigoNue = 0;
         nCodigoReo = #901#0;
         |BUCLE dspase15;
         |SI nCodigoNue = 0;  |ACABA;  |FINSI;
     |SINO;
         nCodigoNue = #901#0;
     |FINSI;

     #900#0 = #901#0;
     #900#1 = #901#45;
     #900#2 = #901#2;
     |LEE 040#900=;
     |SI FSalida ! 0;  |DDEFECTO #900;  |FINSI;

     |SI #900#26 = "T";  |O #900#26 = "F";
         |SI #901#1 ! #9#1;  |ACABA;  |FINSI;
     |SINO;
         |SI #901#1 ! #9#2;  |ACABA;  |FINSI;
     |FINSI;

     #103#0 = 303;
     #103#1 = nCodigoNue;
     #103#2 = #901#45;
     |SI #901#2 [ 80;
         #103#3 = 2000 + #901#2;
     |SINO;
         #103#3 = 1900 + #901#2;
     |FINSI;

     |SI #901#1 = 1;  #103#4 = 3;   |FINSI;
     |SI #901#1 = 2;  #103#4 = 6;   |FINSI;
     |SI #901#1 = 3;  #103#4 = 9;   |FINSI;
     |SI #901#1 = 4;  #103#4 = 12;  |FINSI;

     |SI #900#26 = "M";  |O #900#26 = "D";
         #103#4 = #901#1;
     |FINSI;

     #103#5 = (-#901#55 / nConverMod) ! nRedonMod;
     |GRABA 020#103n;
     |LIBERA #103;
|FPRC;

|DEFBUCLE eosm1303;
     #901#1004;
     ;
     00000, 1, 01, #9#0;
     99999, 9, 12, #9#0;
     ;
     NULL, PasaModelo303EOS;
|FIN;

|PROCESO PasaModelo310EOS;
     |SI #900#41 = 0;  |ACABA;  |FINSI;

     |SI nEstaCambio = 1;
         nCodigoNue = 0;
         nCodigoReo = #900#0;
         |BUCLE dspase15;
         |SI nCodigoNue = 0;  |ACABA;  |FINSI;
     |SINO;
         nCodigoNue = #900#0;
     |FINSI;

     #103#0 = 310;
     #103#1 = nCodigoNue;
     #103#2 = 0;
     |SI #900#1 [ 80;
         #103#3 = 2000 + #900#1;
     |SINO;
         #103#3 = 1900 + #900#1;
     |FINSI;
     |SI #900#2 = 1;  #103#4 = 3;   |FINSI;
     |SI #900#2 = 2;  #103#4 = 6;   |FINSI;
     |SI #900#2 = 3;  #103#4 = 9;   |FINSI;
     |SI #900#2 = 4;  #103#4 = 12;  |FINSI;
     #103#5 = (#900#41 / nConverMod) ! nRedonMod;
     |GRABA 020#103n;
     |LIBERA #103;
|FPRC;

|DEFBUCLE eosm0019;
     #900#1003;
     ;
     00000, #9#0,  #9#1;
     99999, #9#0,  #9#1;
     ;
     NULL, PasaModelo310EOS;
|FIN;

|PROCESO Modelo300Conta;
     #902#0 = #900#2;
     #902#1 = #900#3;
     |LEE 040#902=;
     |SI FSalida ! 0;  |DDEFECTO #902;  #902#2 = "P";  |FINSI;

     nConversor = 1;
     nRedondeo  = 2;
     |SI #200#9 = "P";  nRedondeo = 0;  |FINSI;

     |SI #902#2 = "E";
         |SI #200#9 = "P";
             nConversor = 0.00601012;
             nRedondeo  = 0;
         |FINSI;
     |SINO;
         |SI #200#9 = "E";
             nConversor = 166.386;
             nRedondeo  = 2;
         |FINSI;
     |FINSI;

     |SI nEstaCambio = 1;
         nCodigoCon = #900#2;
         nCodigoNue = 0;
         |BUCLE dspase15C;
         |SI nCodigoNue = 0;  |ACABA;  |FINSI;
     |SINO;
         nCodigoNue = #900#2;
     |FINSI;

     nEjer = 2000 + #9#0;

     |SI nEjer [ 2008;
         aDef = aPathDefAgicont + "caman300.mas";
         |CARGA_DEF aDef, refer01@;
         |SI FSalida ! 0;
             |MENAV "     Error en Cargar el Def caman300.mas";
             |ACABA;
         |FINSI;

         aPathFichAgicont = aPathAnterior + "agicont/fich/" + (("00000" + #900#2) % -105) + #900#3 + "/";
         |PATH_DAT #901 aPathFichAgicont;

         |ABRE #901;
         #901#45 = "T";
         #901#1  = #9#1;
         #901#2  = #9#0;
         |LEE 040#901=;
         |SI FSalida = 0;
             |SI #901#32 ! 0;
                 #103#0 = 300;
                 #103#1 = nCodigoNue;
                 #103#2 = 1;
                 |SI #901#2 [ 80;
                     #103#3 = 2000 + #901#2;
                 |SINO;
                     #103#3 = 1900 + #901#2;
                 |FINSI;
                |SI #901#1 = 1;  #103#4 = 3;   |FINSI;
                |SI #901#1 = 2;  #103#4 = 6;   |FINSI;
                |SI #901#1 = 3;  #103#4 = 9;   |FINSI;
                |SI #901#1 = 4;  #103#4 = 12;  |FINSI;
                #103#5 = (#901#32 / nConversor) ! nRedondeo;
                |GRABA 020#103n;
                |LIBERA #103;
             |FINSI;
         |FINSI;
         |CIERRA #901;

         |DESCARGA_DEF #refer01@;
     |FINSI;

     |SI nEjer ] 2009;
         aDef = aPathDefAgicont + "caman303.mas";
         |CARGA_DEF aDef, refer01@;
         |SI FSalida ! 0;
             |MENAV "     Error en Cargar el Def caman303.mas";
             |ACABA;
         |FINSI;

         aPathFichAgicont = aPathAnterior + "agicont/fich/" + (("00000" + #900#2) % -105) + #900#3 + "/";
         |PATH_DAT #901 aPathFichAgicont;

         |ABRE #901;
         #901#45 = "T";
         #901#1  = #9#1;
         #901#2  = #9#0;
         |LEE 040#901=;
         |SI FSalida = 0;  |Y #901#32 ! 0;
             #103#0 = 303;
             #103#1 = nCodigoNue;
             #103#2 = 1;
             |SI #901#2 [ 80;
                 #103#3 = 2000 + #901#2;
             |SINO;
                 #103#3 = 1900 + #901#2;
             |FINSI;

             |SI #901#1 = 1;  #103#4 = 3;   |FINSI;
             |SI #901#1 = 2;  #103#4 = 6;   |FINSI;
             |SI #901#1 = 3;  #103#4 = 9;   |FINSI;
             |SI #901#1 = 4;  #103#4 = 12;  |FINSI;
             #103#5 = (#901#32 / nConversor) ! nRedondeo;
             |GRABA 020#103n;
             |LIBERA #103;
         |SINO;
             #901#45 = "M";
             #901#1  = #9#2;
             #901#2  = #9#0;
             |LEE 040#901=;
             |SI FSalida = 0;  |Y #901#32 ! 0;
                 #103#0 = 303;
                 #103#1 = nCodigoNue;
                 #103#2 = 1;
                 |SI #901#2 [ 80;
                     #103#3 = 2000 + #901#2;
                 |SINO;
                     #103#3 = 1900 + #901#2;
                 |FINSI;
                 #103#4 = #901#1;
                 #103#5 = (#901#32 / nConversor) ! nRedondeo;
                 |GRABA 020#103n;
                 |LIBERA #103;
             |SINO;
                 #901#45 = "D";
                 #901#1  = #9#2;
                 #901#2  = #9#0;
                 |LEE 040#901=;
                 |SI FSalida = 0;  |Y #901#32 ! 0;
                     #103#0 = 303;
                     #103#1 = nCodigoNue;
                     #103#2 = 1;
                     |SI #901#2 [ 80;
                         #103#3 = 2000 + #901#2;
                     |SINO;
                         #103#3 = 1900 + #901#2;
                     |FINSI;
                     #103#4 = #901#1;
                     #103#5 = (#901#32 / nConversor) ! nRedondeo;
                     |GRABA 020#103n;
                     |LIBERA #103;
                 |FINSI;
             |FINSI;
         |FINSI;
         |CIERRA #901;

         |DESCARGA_DEF #refer01@;
     |FINSI;
|FPRC;

|DEFBUCLE canempre;
     #900#1002;
     26;
     00000, 0, #9#0;
     99999, 9, #9#0;
     ;
     NULL, Modelo300Conta;
|FIN;

|PROCESO Tipo3;  |TIPO 3;
     |ABRE #103;  |CIERRA #103;  |DELINDEX #103;

     aDef = eaPathAgitool + "def/zmonedas.mas";
     |CARGA_DEF aDef, refer00@;
     |SI FSalida ! 0;
         aMonedaAgieos = "E";
     |SINO;
         |PATH_DAT #900 aPathFichFiscal;
         |ABRE #900;
         |LEE 040#900p;
         |SI FSalida ! 0;  |DDEFECTO #900;  |FINSI;
         |CIERRA #900;

         aMonedaAgieos = #900#1;

         |DESCARGA_DEF #refer00@;
     |FINSI;

     nConverMod = 1;
     nRedonMod  = 2;
     |ABRE #200;
     |LEE 040#200p;
     |SI FSalida ! 0;  |DDEFECTO #200;  |FINSI;
     |CIERRA #200;

     |SI #200#9 = "P";  nRedonMod = 0;  |FINSI;

     |SI aMonedaAgieos = "E";
         |SI #200#9 = "P";
             nConverMod = 0.00601012;
             nRedonMod  = 0;
         |FINSI;
     |SINO;
         |SI #200#9 = "E";
             nConverMod = 166.386;
             nRedonMod  = 2;
         |FINSI;
     |FINSI;

     nEjer = 2000 + #9#0;

     |ABRE #103;

|SI aPathDefFiscal ! "";

     |SI nEjer [ 2008;
         |SI #9#1 = 4;
             aDef = aPathDefFiscal + "eosactiv.mas";
             |CARGA_DEF aDef, refer00@;
             |SI FSalida ! 0;
                 |MENAV "     Error en Cargar el Def eosactiv.mas";
                 |ACABA;
             |FINSI;
         |SINO;
             aDef = aPathDefFiscal + "eosm1300.mas";
             |CARGA_DEF aDef, refer00@;
             |SI FSalida ! 0;
                 |MENAV "     Error en Cargar el Def eosm1300.mas";
             |FINSI;
             |ACABA;
         |FINSI;

         |PATH_DAT #900 aPathFichFiscal;
         |SI #9#1 = 4;
             |BUCLE eosactiv;
         |SINO;
             |BUCLE eosm1300;
         |FINSI;

         |DESCARGA_DEF #refer00@;
     |FINSI;

     |SI nEjer ] 2009;
         aDef = aPathDefFiscal + "eosactiv.mas";
         |CARGA_DEF aDef, refer00@;
         |SI FSalida ! 0;
             |MENAV "     Error en Cargar el Def eosactiv.mas";
             |ACABA;
         |FINSI;

         aDef = aPathDefFiscal + "eosm1303.mas";
         |CARGA_DEF aDef, refer01@;
         |SI FSalida ! 0;
             |DESCARGA_DEF #refer00@;
             |MENAV "     Error en Cargar el Def eosm1303.mas";
             |ACABA;
         |FINSI;

         |PATH_DAT #900 aPathFichFiscal;
         |PATH_DAT #901 aPathFichFiscal;

         |SI #9#1 = 4;
             |BUCLE eosactiv;
         |SINO;
             |ABRE #900;
             |BUCLE eosm1303;
             |CIERRA #900;
         |FINSI;

         |DESCARGA_DEF #refer01@;
         |DESCARGA_DEF #refer00@;
     |FINSI;

     aDef = aPathDefFiscal + "eosm0019.mas";
     |CARGA_DEF aDef, refer00@;
     |SI FSalida ! 0;
         |MENAV "     Error en Cargar el Def eosm0019.mas";
         |ACABA;
     |FINSI;

     |PATH_DAT #900 aPathFichFiscal;

     |BUCLE eosm0019;

     |DESCARGA_DEF #refer00@;

|FINSI;

|SI aPathDefAgicont ! "";
     aDef = aPathDefAgicont + "canempre.mas";
     |CARGA_DEF aDef, refer00@;
     |SI FSalida ! 0;
         |MENAV "     Error en Cargar el Def canempre.mas";
         |ACABA;
     |FINSI;

     aDef = aPathDefAgicont + "camoneda.mas";
     |CARGA_DEF aDef, refer02@;
     |SI FSalida ! 0;
         |DESCARGA_DEF #refer00@;
         |MENAV "     Error en Cargar el Def camoneda.mas";
         |ACABA;
     |FINSI;

     |PATH_DAT #900 aPathFichAgicont;
     |PATH_DAT #902 aPathFichMoneda;

     |BUCLE canempre;

     |DESCARGA_DEF #refer02@;
     |DESCARGA_DEF #refer00@;
|FINSI;

     |CIERRA #103;
|FPRC;

|PROCESO BuscaAplAnterior;
   aAlfa = aPathDefFiscal + "eosclien.mas";
   |XABRE "E", aAlfa, nCanal;
   |SI FSalida < 0;
        aPathDefFiscal = "";
   |FINSI;
   |XCIERRA nCanal;

   aAlfa = aPathDefAgicont  + "canempre.mas";
   |XABRE "E", aAlfa, nCanal;
   |SI FSalida < 0;
        aPathDefAgicont = "";
   |FINSI;
   |XCIERRA nCanal;
|FPRC;

|PROGRAMA;
     |ABRE #0;
     |LEE 040#0p;
     |SI FSalida ! 0;
         |MENAV "     Pase de Ficheros Generales no Realizado";
         |CIERRA #0;
         |ACABA;
     |FINSI;
     |CIERRA #0;

     |ABRE #15;
     |LEE 040#15p;
     |SI FSalida ! 0;
         nEstaCambio = 0;
         |DDEFECTO #15;
     |SINO;
         nEstaCambio = 1;
         |SI #15#15 ! "S";
             |MENAV "      Unificacion de Codigos no Realizada.";
             |CIERRA #15;
             |ACABA;
         |FINSI;
     |FINSI;
     |CIERRA #15;

     |HAZ BusquedaApli;
     eaPathDsmodelo   = eaPathDsmodelo + "fich/";

     aPathAnterior    = #0#0;  |QBT aPathAnterior;

     aPathDefFiscal   = aPathAnterior + "agieos/def/";
     aPathFichFiscal  = aPathAnterior + "agieos/fich/";

     aPathDefAgicont  = aPathAnterior + "agicont/def/";
     aPathFichAgicont = aPathAnterior + "agicont/fich/";
     aPathFichMoneda  = aPathAnterior + "agicont/fich/000000/";

     |HAZ BuscaAplAnterior;

     |PINPA #0#9;
     |PINDA #0#9;
     |ENDATOS #1#9;
|FPRO;
