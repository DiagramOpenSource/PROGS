|FICHEROS;
     agiw0071 #0,MANTE;
     agifigen #1;
     agicen20 #20;

     agiw0072 #72;
     agiw0073 #73;
     agiw0075 #75;
     agiw0076 #76;
     agiw0077 #77;
     agiw0078 #78;

     agicen42 #42,MANTE;       || causas presentacion
     agicen43 #43,MANTE;       || identificacion personas fisicas
     agicen44 #44,MANTE;       || identificacion personas juridicas
     agicen45 #45,MANTE;       || identificacion establecimientos permanentes
     agicen46 #46,MANTE;       || datos de representantes
     agicen47 #47;             || datos de actividades economicas
     agicen48 #480;            || datos de locales
     agicen49 #49,MANTE;       || sujeto pasivo - IVA
     agicen50 #50,MANTE;       || IRPF, Sociedades, No Residentes y Reg.Fiscal Especial
     agicen51 #51,MANTE;       || Retenc. e Ing. a Cta. y Otros Impuestos
     agicen52 #52,MANTE;       || Regimenes especiales comercio intracomunitario
     agicen53 #53,MANTE;       || Socios

     pdfimtmp #100;
     referen@ #200;
|FIN;

|VARIABLES;
     nCampo       = 0;
     nHandle      = 0;
     nAscii       = 0;
     nLongitud    = 0;
     nPos         = 0;
     nBusca       = 0;
     nCasilla     = 0;
     nEspa        = 0;
     nLong        = 0;
     nConta       = 0;
     nNumCampos   = 0;
     nNume        = 0;
     nNume1       = 0;
     nNumero      = 0;
     nCas         = 0;
     nResto       = 0;
     nHay         = 0;
     nAcum        = 0;
     nSwPunto     = 0;
     nCaracter    = 0;
     nCampoD      = 0;
     nCampoH      = 0;
     nObliga      = 0;
     nPorDonde    = 0;
     nSocio       = 0;
     nBytes       = 0;
     nPon         = 0;

     aAlfa        = "";
     aAlfa0       = "";
     aAlfa1       = "";
     aAlfa2       = "";
     aAbre        = "";
     aFichero     = "";
     aOrigen      = "";
     aDestino     = "";
     aBasePdf     = "";
     aIP          = "";
     aLinea       = "";
     aCaracter    = "";
     aCaracterSal = "";
     aCadenaSal   = "";
     aCadena      = "";
     aLongitud    = "";
     aCampo       = "";
     aValor       = "";
     aSigla       = "";
     aArchivoPdf  = "";
     aArchivoTxt  = "";
     aLong        = "";
     aSi          = "Sí";
     aTipo        = "";
     aRuta        = "";
     aMiCaracter  = "";
     aPathReader  = "";
     aEjecutable  = "";
     aFicheroBAT  = "";
     aUnidad      = "";
     aWait        = "";
     aPath        = "";

     {1}aVersion  = "";

     &eaVarDni  = "";
     &enCalcCif = 0;

     &eaTabla    = "";
     &eaDestino  = "";
     &eaAlfa     = "";
     &enError    = 0;
     &enComp     = 0;
     &enPosicion = 0;

     &enEmpresa = 0;
     &enRegistro = 0;
     aBlanco = " ";
     swFecha = 0;
     aFecha = "";
     nRepre = 0;
     swRepite = 0;
     nActiv = 0;
     nLocal = 0;
     aLocal = "";
     aLocalesDet = "";
     nLocalesDet = 0;
     aLocalesInd = "";
     nLocalesInd = 0;
     nLocales = 0;
     nLineaLocal = 0;
     nPosicion = 0;
     swCual = 0;
     FEstado = 0;
     aCampoPDF = "";
     aHoja = "";
     aApli = "";
     aDef = "";
     &eaTipo = "";
     nDesdeLin = 0;
     nHastaLin = 0;
     nLocalD = 0;
     nLocalI = 0;
     nActivValida = 0;
     aBase = "";
     aBasePatron = "";
     aFic = "";
     nSw = 0;
     aRuta0 = "";
     aLon = "";
     i = 0;
     aDes = "";
     aModelo = "";
     nSize = 0;
     aMensaje = "";
     swDefectoA = 0;
     swDefectoB = 0;
     swDefectoC = 0;

     &eaUnidadBasico = "";
     &eaDSMAC        = "";
|FIN;

|| _________________________________________________________________________
|| PROCESOS DE LA PANTALLA
|| _________________________________________________________________________

|PROCESO TipoEmision;
     |C_M #0#6, 1, "S";
     |SI #0#0 = 2;
          |C_M #0#6, 1, "N";
     |FINSI;
     |SI #0#0 = 3;
          #42#0 = enEmpresa;
          #42#1 = enRegistro;
          |LEE 040#42=;
          |SI FSalida ! 0;  |DDEFECTO #42;  |FINSI;

          |SI #42#5 ! "S"; |Y #42#8 ! "S"; |Y #42#10 ! "S"; |Y #42#11 ! "S";
          |Y #42#13 ! "S"; |Y #42#17 ! "S"; |Y #42#18 ! "S"; |Y #42#22 ! "S";
          |Y #42#28 ! "S";
               aAlfa = "    ATENCION: no se ha marcado ninguna de las causas ";
               aAlfa = aAlfa + "de presentación del modelo 037";
               |MENAV aAlfa;
               aAlfa = "    Introduzca 'S' en alguna de las casillas correspondientes ";
               aAlfa = aAlfa + "para que la emisión sea correcta";
               |MENAV aAlfa;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO ExtraePath;
     aPath     = aVersion1;
     aLongitud = aPath % 0;
     nLongitud = aLongitud;
     |PARA nPos = 1; |SI nPos [ nLongitud; |HACIENDO nPos = nPos + 1;
          nCaracter = (nPos * 100) + 1;
          aCaracter = aPath % nCaracter;
          |SI aCaracter = ",";
               nPos = nLongitud - nPos;
               nPos = nPos + 100;
               nPos = (-1) * nPos;
               aPath = aPath % nPos;
               |SAL;
          |FINSI;
     |SIGUE;

     aPath = aPath - "[";
     aPath = aPath - "]";
     |QBF aPath;
     #0#6 = aPath;
     |PINTA #0#6;
|FPRC;

|PROCESO CompruebaRuta;
     |QBF aPath;
     |XABRE "CE", aPath, nHandle;
     |SI aPath = ""; |O FSalida < 0;
          |XCIERRA nHandle;
          aAlfa = "    No se ha encontrado el directorio donde esta instalado ";
          aAlfa = aAlfa + "Adobe Acrobat Reader. ";
          |MENAV aAlfa;

          aAlfa = "    Debera efectuar la instalacion manualmente.";
          |MENAV aAlfa;

          #0#6 = "";
          |PINTA #0#6;
     |FINSI;
|FPRC;

|PROCESO MensajeFallo;
     |CUADRO 1616 2166;
     |ATRI I;
     |PINTA 1717, " No se ha podido localizar  de manera automatica ";
     |PINTA 1817, " la carpeta donde esta instalado Acrobat Reader. ";
     |PINTA 1917, " Compruebe que la aplicacion esta instalada y si ";
     |PINTA 2017, "  es asi, efectue la busqueda de manera manual.  ";
     |ATRI 0;
|FPRC;

|PROCESO SacaBrowse;  |TIPO 7;
     |SI #0#0 = 2;  |ACABA;  |FINSI;

     aAlfa = #0#6;  |QBF aAlfa;
     |SI aAlfa ! "";  |Y nObliga = 0;
         |ACABA;
     |FINSI;

     aVersion1 = "AcroExch.Document";
     |ESPECIFICA "VERSION_PROGRAMA", aVersion;
     |HAZ ExtraePath;
     |SI aPath = "NO LOCALIZADO";
          aVersion1 = "AcroExch.App";
          |ESPECIFICA "VERSION_PROGRAMA", aVersion;
          |HAZ ExtraePath;
     |FINSI;

     |SI aPath ! "NO LOCALIZADO";
          |HAZ CompruebaRuta;
          nObliga = 0;
     |SINO;
          |HAZ MensajeFallo;       || se supone que no esta instalado
          |PAUSA;                  || el Acrobat
          #0#6 = "";
          |PINTA #0#6;
     |FINSI;

     aAlfa = #0#6;  |QBF aAlfa;
     |SI aAlfa ! "";  |Y nObliga = 0;
         |ACABA;
     |FINSI;

     aRuta = "F";
     |BROWSE aRuta;  |QBF aRuta;
     |SI aRuta = "F";
         |ERROR;
         |ACABA;
     |FINSI;

     #0#6 = aRuta % 280;  |PINTA #0#6;
|FPRC;

||Esto es lo nuevo
|PROCESO ManualBrowse;
     aRuta = "F";
     aFic = "";
     |BROWSE aRuta;

     |SI aRuta ! "F";
          nSw = 0;
          aRuta0 = "";
          aLon = aRuta % A0;
          |PARA i = 1; |SI i < aLon; |HACIENDO i = i + 1;
               nPos = -1 * (i * 100 + 1);
               aAlfa = aRuta % nPos;
               |SI aAlfa = "/"; |O aAlfa = "\"; |O nSw = 1;
                    nSw = 1;
                    aRuta0 = aAlfa + aRuta0;
               |SINO;
                    aRuta0 = aAlfa + aRuta0;
                    aFic = aAlfa + aFic;
               |FINSI;
          |SIGUE;
          |QBT aFic;
          aFic = aFic < "";
          aDes = aPath + aFic;
          aDes = aDes < "";
          #0#6 = aRuta0; |PINTA #0#6;
     |FINSI;
|FPRC;

|PROCESO Browse;  |TIPO 0;
     |SI #0#0 = 2;  |ACABA;  |FINSI;

     nObliga = 1;
     |SI FSalida = 10;  |HAZ SacaBrowse;  |FINSI;

     |SI FSalida = 11;  |HAZ ManualBrowse; |FINSI;


     aAlfa = #0#6;  |QBF aAlfa;
     |SI aAlfa = "";  |HAZ SacaBrowse;  |FINSI;

     nObliga = 0;
|FPRC;

|PROCESO SacaCalidadw61;  |TIPO 7;
     eaTabla = "txtm0005.txt";
     |HAZ CargaTabla;
|FPRC;

|PROCESO CompruebaCalidadw61;  |TIPO 0;
     nCampo   = Campo + 1;
     |SI FSalida = 10;
         enPosicion = 55;
         |HAZ SacaTabla;

         aAlfa1   = eaDestino % 101;
         #0Campo  = aAlfa1;
         |PINTA #0Campo;
     |FINSI;

     enComp = 1;
     eaAlfa = #0Campo;
     |HAZ CompruebaTabla;

     |SI enError = 1;
         |MENAV "0000 Contenido Incorrecto. Consulta la Tabla con F2";
         |ERROR;
         |ACABA;
     |FINSI;

     aAlfa1   = eaDestino % 101;
     aAlfa2   = eaDestino % 415;
     #0Campo  = aAlfa1;
     #0nCampo = aAlfa2;

     |PINTA #0Campo;
     |PINTA #0nCampo;

     |HAZ FinTabla;

     |C_M #0nCampo, 1, "N";
     |SI #0Campo = " ";  |C_M #0nCampo, 1, "S";  |FINSI;
|FPRC;

|| _________________________________________________________________________
|| PROCESOS DE LA EMISION
|| _________________________________________________________________________

|PROCESO Conver3E2D;
     aAlfa     = (nNume + "          ") % 110;
     nPos      = 0;
     aAlfa0    = "";
     aAlfa1    = "";
     aAlfa2    = "";
     nSwPunto  = 0;

     |PARA nCaracter = 1;  |SI nCaracter [ 10;  |HACIENDO nCaracter = nCaracter + 1;
           nPos   = (100 * nCaracter) + 1;
           aAlfa0 = aAlfa % nPos;
           |SI aAlfa0 = "."; nSwPunto = 1;  |FINSI;
           |SI nSwPunto = 0;
               |SI aAlfa0 ! " "; |Y aAlfa0 ! ".";
                  aAlfa1 = aAlfa1 + aAlfa0;
               |FINSI;
           |FINSI;

           |SI nSwPunto = 1;
               |SI aAlfa0 ! " "; |Y aAlfa0 ! ".";
                   aAlfa2 = aAlfa2 + aAlfa0;
               |FINSI;
           |FINSI;
     |SIGUE;

     aAlfa = (("000" + aAlfa1) % -103) + ((aAlfa2 + "00") % 102);
|FPRC;

|PROCESO QuitaRaros;
     nEspa   = 0;
     aCadena = "";
     aLong   = aAlfa % 0;
     nLong   = aLong;
     |PARA nCampo = 1;  |SI nCampo [ aLong;  |HACIENDO nCampo = nCampo + 1;
           nPos = (100 * nCampo) + 1;
           aCaracter = aAlfa % nPos;
           |SI aCaracter = "¥";  aCaracter = &209; |FINSI;
           |SI aCaracter = "¤";  aCaracter = &209; |FINSI;
           |SI aCaracter = "§";  aCaracter = &176; |FINSI;
           |SI aCaracter = "¦";  aCaracter = &170; |FINSI;
           |SI aCaracter = "(";  aCaracter = " ";  |FINSI;
           |SI aCaracter = ")";  aCaracter = " ";  |FINSI;
           aCadena = aCadena + aCaracter;
     |SIGUE;
     aAlfa = aCadena;
|FPRC;

|PROCESO LeeSigla;
     eaTabla = "txtm0001.txt";
     |HAZ CargaTabla;

     eaAlfa = aSigla;
     enComp = 2;
     |HAZ CompruebaTabla;

     aSigla = eaDestino % 415;

     |HAZ FinTabla;
|FPRC;

|PROCESO IniciaTemporal;
     aFichero = ("pd" + Usuario + "zzzzzzzz") % 108;
     |NOME_DAT #100 aFichero;
     |DELINDEX #100;
|FPRC;

|PROCESO Cabecera;
     aLinea = "%FDF-1.2";       |XGRABA nHandle, aLinea;
     aLinea = "%âãÏÓ";          |XGRABA nHandle, aLinea;
     aLinea = "1 0 obj";        |XGRABA nHandle, aLinea;
     aLinea = "<< /FDF ";       |XGRABA nHandle, aLinea;
     aLinea = "<< /Fields [ ";  |XGRABA nHandle, aLinea;
|FPRC;

|PROCESO Cambia;
     nAscii       = &aCaracter;
     aCaracterSal = aCaracter;

     |SI nAscii = 160;  aCaracterSal = "\341";  |FINSI;
     |SI nAscii = 130;  aCaracterSal = "\351";  |FINSI;
     |SI nAscii = 161;  aCaracterSal = "\355";  |FINSI;
     |SI nAscii = 162;  aCaracterSal = "\363";  |FINSI;
     |SI nAscii = 163;  aCaracterSal = "\372";  |FINSI;
     |SI nAscii = 164;  aCaracterSal = "\361";  |FINSI;
|FPRC;

|PROCESO Sustituye;
     aCadenaSal = "";
     aLongitud = aCadena % 0;
     nLongitud = aLongitud;
     |PARA nPos = 1; |SI nPos [ nLongitud; |HACIENDO nPos = nPos + 1;
          nBusca     = (nPos * 100) + 1;
          aCaracter  = aCadena % nBusca;
          |HAZ Cambia;
          aCadenaSal = aCadenaSal + aCaracterSal;
     |SIGUE;
|FPRC;

|PROCESO Lineas;
     aCampo = #100#0;  |QBF aCampo;
     aValor = #100#1;  |QBF aValor;
     |SI aValor = "";  |ACABA;  |FINSI;

     aLinea = "<< /V (" + aValor + ")/T (" + aCampo + ")>> ";
     aCadena = aLinea;
     |HAZ Sustituye;
     aLinea = aCadenaSal;
     |XGRABA nHandle, aLinea;
|FPRC;

|DEFBUCLE pdfimtmp;
     #100#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Lineas;
|FIN;

|PROCESO Pie;
     aLinea = "] ";                                  |XGRABA nHandle, aLinea;
     aLinea = "/F (" + eaUnidadBasico + "/DOCUMENTOS/PDF/MOD" + aModelo + "E_2007.PDF)";  |XGRABA nHandle, aLinea;
     aLinea = "/ID [ ] >>";                          |XGRABA nHandle, aLinea;
     aLinea = ">> ";                                 |XGRABA nHandle, aLinea;
     aLinea = "endobj";                              |XGRABA nHandle, aLinea;
     aLinea = "trailer";                             |XGRABA nHandle, aLinea;
     aLinea = "<</Root 1 0 R >>";                    |XGRABA nHandle, aLinea;
     aLinea = "%%EOF";                               |XGRABA nHandle, aLinea;
|FPRC;

|PROCESO BuscaCaracter;
     aLongitud = aCadena % 0;
     nLongitud = aLongitud;
     |PARA nPos = 1; |SI nPos [ nLongitud; |HACIENDO nPos = nPos + 1;
          nCaracter = ((nPos * 100) + 1) * nPorDonde;
          aCaracter = aCadena % nCaracter;
          |SI aCaracter = aMiCaracter;
               |SAL;
          |FINSI;
     |SIGUE;
|FPRC;

|PROCESO ImprimePDF;
     |SI #0#0 = 1;
          aModelo = "036";
          nSize = 1770770;
     |SINO;
          aModelo = "037";
          nSize = 716515;
     |FINSI;

     |DBASE aBase;  |QBF aBase;
     aBasePdf    = aBase + "pdf";  |MKDIR aBasePdf;
     aBasePdf    = aBasePdf + "/";
     aBasePatron = aBase + "patrones/";

     nPon        = 0;
     aAbre       = aBasePdf + "mod" + aModelo + "e_2007.pdf";
     |XABRE "B", aAbre, nHandle;
     |SI FSalida < 0;
         nPon = 1;
     |SINO;
          nBytes = 0;
          |XPOSICION nHandle, nBytes, 2;
          |SI nBytes ! nSize;
              nPon = 1;
          |FINSI;
     |FINSI;
     |XCIERRA nHandle;

     |SI nPon = 1;
         aFichero   = aBasePatron + "mod" + aModelo + "e_2007.tgz";
         |DESCOMPRIME aFichero;

         aFichero   = aBasePatron + "mod" + aModelo + "e_2007.tar";
         |DETAR aFichero, aBasePdf;

         aOrigen  = aBasePatron + "mod" + aModelo + "e_2007.pdf";
         aDestino = aBasePdf    + "mod" + aModelo + "e_2007.pdf";
         |RENOMBRA_FICHERO aOrigen, aDestino;

         aOrigen  = aBasePatron + "wait.exe";
         aDestino = aBasePdf    + "wait.exe";
         |RENOMBRA_FICHERO aOrigen, aDestino;

         |FBORRA aFichero;
     |FINSI;

     |XABRE "E", aAbre, nHandle;
     |SI FSalida < 0;
         |MENAV "0000 No encuentro el PDF, pongase en contacto con su distribuidor";
         |ACABA;
     |FINSI;

     aDestino = eaUnidadBasico + "\DOCUMENTOS";     |RMKDIR aDestino;
     aDestino = aDestino + "\PDF";   |RMKDIR aDestino;
     aDestino = aDestino + "\MOD" + aModelo + "E_2007.PDF";
     aOrigen  = aAbre;
     nPon     = 0;

     |XABRE "BC", aDestino, nHandle;
     |SI FSalida < 0;
         nPon = 1;
     |SINO;
         nBytes = 0;
         |XPOSICION nHandle, nBytes, 2;
         |SI nBytes ! nSize;
             nPon = 1;
         |FINSI;
         |XCIERRA nHandle;
     |FINSI;

     |SI nPon = 1;
         aIP = "";
         |IP_REMOTO aIP;  |QBF aIP;
         |SI aIP ! "";
             |ENVIA_FICHERO aOrigen, aDestino;
         |SINO;
             |COPIA_FICHERO aOrigen, aDestino;
         |FINSI;
     |FINSI;

     aDestino = eaUnidadBasico + "\DOCUMENTOS";     |RMKDIR aDestino;
     aDestino = aDestino + "\PDF";   |RMKDIR aDestino;
     aDestino = aDestino + "\wait.exe";
     aOrigen  = aBasePdf + "wait.exe";

     |XABRE "EC", aDestino, nHandle;
     |SI FSalida < 0;
         aIP = "";
         |IP_REMOTO aIP;  |QBF aIP;
         |SI aIP ! "";
             |ENVIA_FICHERO aOrigen, aDestino;
         |SINO;
             |COPIA_FICHERO aOrigen, aDestino;
         |FINSI;
     |FINSI;

     aArchivoPdf = eaUnidadBasico + "\DOCUMENTOS\PDF\MOD" + aModelo + "E_2007.FDF";
     |XABRE "CW", aArchivoPdf, nHandle;
     |SI FSalida ] 0;
         |HAZ Cabecera;
         |BUCLE pdfimtmp;
         |HAZ Pie;
     |FINSI;
     |XCIERRA nHandle;

     aPathReader = #0#6;  |QBF aPathReader;
     aCadena     = aPathReader;
     aMiCaracter = "\";
     nPorDonde   = -1;
     |HAZ BuscaCaracter;
     nPos        = nPos -1;
     nPos        = nPos + 100;
     nPos        = (-1) * nPos;
     aEjecutable = aPathReader % nPos;
     aPathReader = aPathReader - aEjecutable;

     aWait       = eaUnidadBasico + "\DOCUMENTOS\PDF\wait.exe";
     aFicheroBAT = eaUnidadBasico + "\DOCUMENTOS\PDF\IMPRIME.BAT";
     |XABRE "CBW", aFicheroBAT, nHandle;
     |SI FSalida = 0;
         aAlfa   = "@echo off" + &13 + &10;  |XGRABA nHandle, aAlfa;
         aUnidad = aPathReader % 102;
         aAlfa   = aUnidad + &13 + &10;      |XGRABA nHandle, aAlfa;
         aAlfa   = "cd " + &34 + aPathReader + &34 + &13 + &10;
         aAlfa   = aAlfa - aUnidad;          |XGRABA nHandle, aAlfa;
         aAlfa   = aWait + " " + aEjecutable;
         aAlfa   = aAlfa + " " + aArchivoPdf + &13 + &10;
                                             |XGRABA nHandle, aAlfa;
     |FINSI;
     |XCIERRA nHandle;

     |RSYSTEM aFicheroBAT;

     ||RFBORRA aFicheroBAT;
     ||RFBORRA aArchivoPdf;

     |DELINDEX #100;
|FPRC;

|PROCESO AbreFichero;
     aArchivoTxt = eaUnidadBasico + "\AEAT";    |RMKDIR aArchivoTxt;
     aArchivoTxt = aArchivoTxt + "\INTERNET";   |RMKDIR aArchivoTxt;
     aArchivoTxt = aArchivoTxt + "\036"; |RMKDIR aArchivoTxt;
     aArchivoTxt = aArchivoTxt + "\M" + (("00000" + enEmpresa) % -105) + (("00" + enRegistro) % -102) + ".TXT";

     |XABRE "CBW", aArchivoTxt, nHandle;
/*

     |DFICE aBase;
     aAlfa = aBase +  "M" + (("00000" + enEmpresa) % -105) + (("00" + enRegistro) % -102) + ".TXT";

     |XABRE "BW", aAlfa, nHandle;
*/
|FPRC;

|PROCESO GrabaPdf;
     |QBF aValor;

     #100#0 = aCampoPDF;
     |LEE 101#100=;
     FEstado = FSalida;

     aAlfa  = aValor;  |HAZ QuitaRaros;
     #100#1 = aAlfa;

     |SI FEstado = 0;
         |GRABA 020#100a;
     |SINO;
         |GRABA 020#100n;
     |FINSI;

     |LIBERA #100;
|FPRC;

|PROCESO SoyUnaFecha;
     |QBF aFecha;
     |SI aFecha = "01.01.0000"; |O aFecha = "";
          aFecha = "00.00.0000";
     |FINSI;
     nNumero = nNumero;
     aAlfa = aFecha % 102;
     |HAZ QuitaRaros;
     |XGRABA nHandle, aAlfa;
     nNumero = nNumero + 1;
     aAlfa = aFecha % 402;
     |HAZ QuitaRaros;
     |XGRABA nHandle, aAlfa;
     nNumero = nNumero + 1;
     aAlfa = aFecha % -104;
     |HAZ QuitaRaros;
     |XGRABA nHandle, aAlfa;
     swFecha = 1;
|FPRC;

|PROCESO CampoPDF;
     nCasilla = #76#1;

     aAlfa = #76#4; |QBF aAlfa;
     aCampoPDF = "dato." + aAlfa;

     aAlfa = #76#5; |QBF aAlfa;
     |SI aAlfa ! "";
          aCampoPDF = aCampoPDF + "." + aAlfa;
     |FINSI;

     aAlfa = #76#6; |QBF aAlfa;
     |SI aAlfa ! "";
          aCampoPDF = aCampoPDF + "." + aAlfa;
     |FINSI;

     nCampo = #76#3;
     aValor = #200nCampo;
     aTipo = #76#2;
     |QBF aValor;
     |SI aValor ! ""; |O aTipo = "3";
          |SI aTipo = " ";
               |HAZ GrabaPdf;
          |FINSI;
          |SI aTipo = "0";                  || fecha solo dd/mm
               |SI aValor ! "01.01.0000";
                    aFecha = aValor;

                    aValor = aFecha % 102;
                    aAlfa = #76#4; |QBF aAlfa;
                    aCampoPDF = "dato." + aAlfa;
                    |HAZ GrabaPdf;

                    aValor = aFecha % 402;
                    nNume = #76#4;
                    nNume = nNume + 1;
                    aAlfa = nNume; |QBF aAlfa;
                    aCampoPDF = "dato." + aAlfa;
                    |HAZ GrabaPdf;
               |FINSI;
          |FINSI;
          |SI aTipo = "1";
               |SI aValor ! "01.01.0000";
                    aFecha = aValor;

                    aValor = aFecha % 102;
                    aAlfa = #76#4; |QBF aAlfa;
                    aCampoPDF = "dato." + aAlfa;
                    |HAZ GrabaPdf;

                    aValor = aFecha % 402;
                    nNume = #76#4;
                    nNume = nNume + 1;
                    aAlfa = nNume; |QBF aAlfa;
                    aCampoPDF = "dato." + aAlfa;
                    |HAZ GrabaPdf;

                    aValor = aFecha % -104;
                    nNume = #76#4;
                    nNume = nNume + 2;
                    aAlfa = nNume; |QBF aAlfa;
                    aCampoPDF = "dato." + aAlfa;
                    |HAZ GrabaPdf;
               |FINSI;
          |FINSI;
          |SI aTipo = "2";
               |SI aValor ! "";
                    aValor = "Sí";
               |FINSI;
               |HAZ GrabaPdf;
          |FINSI;
          |SI aTipo = "3";
               |SI aValor = "S";
                    aValor = "Sí";
               |SINO;
                    |SI aValor = "N";
                         aValor = "Sí";
                         nNume = #76#5;
                         nNume = nNume + 1;
                         aAlfa = nNume; |QBF aAlfa;
                         aCampoPDF = "dato.a." + aAlfa;
                    |FINSI;
               |FINSI;
               |HAZ GrabaPdf;
          |FINSI;
          |SI aTipo = "4";
               |SI aValor = "A";
                    aValor = "Sí";
               |SINO;
                    |SI aValor = "B";
                         aValor = "Sí";
                         nNume = #76#5;
                         nNume = nNume + 1;
                         aAlfa = nNume; |QBF aAlfa;
                         aCampoPDF = "dato.a." + aAlfa;
                    |FINSI;
               |FINSI;
               |HAZ GrabaPdf;
          |FINSI;
          |SI aTipo = "5";   ||tipo especial
               aAlfa1 = aValor % 101;
               aAlfa2 = aValor % 215; |QBF aAlfa2;
               aValor = aAlfa2 + "/" + aAlfa1;
               |HAZ GrabaPdf;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE LineasPDF;
     #76#1;
     ;
     #75#0, nDesdeLin;
     #75#0, nHastaLin;
     ;
     NULL, CampoPDF;
|FIN;

|PROCESO CampoPDF037;
     nCasilla = #78#1;

     aAlfa = #78#4; |QBF aAlfa;
     aCampoPDF = "dato." + aAlfa;

     aAlfa = #78#5; |QBF aAlfa;
     |SI aAlfa ! "";
          aCampoPDF = aCampoPDF + "." + aAlfa;
     |FINSI;

     aAlfa = #78#6; |QBF aAlfa;
     |SI aAlfa ! "";
          aCampoPDF = aCampoPDF + "." + aAlfa;
     |FINSI;

     nCampo = #78#3;
     aValor = #200nCampo;
     aTipo = #78#2;
     |QBF aValor;
     |SI aValor ! ""; |O aTipo = "3";
          |SI aTipo = " ";
               |HAZ GrabaPdf;
          |FINSI;
          |SI aTipo = "1";
               |SI aValor ! "01.01.0000";
                    aFecha = aValor;

                    aValor = aFecha % 102;
                    aAlfa = #78#4; |QBF aAlfa;
                    aCampoPDF = "dato." + aAlfa;
                    |HAZ GrabaPdf;

                    aValor = aFecha % 402;
                    nNume = #78#4;
                    nNume = nNume + 1;
                    aAlfa = nNume; |QBF aAlfa;
                    aCampoPDF = "dato." + aAlfa;
                    |HAZ GrabaPdf;

                    aValor = aFecha % -104;
                    nNume = #78#4;
                    nNume = nNume + 2;
                    aAlfa = nNume; |QBF aAlfa;
                    aCampoPDF = "dato." + aAlfa;
                    |HAZ GrabaPdf;
               |FINSI;
          |FINSI;
          |SI aTipo = "2";
               |SI aValor ! "";
                    aValor = "Sí";
               |FINSI;
               |HAZ GrabaPdf;
          |FINSI;
          |SI aTipo = "3";
               |SI aValor = "S";
                    aValor = "Sí";
               |SINO;
                    |SI aValor = "N";
                         aValor = "Sí";
                         nNume = #78#5;
                         nNume = nNume + 1;
                         aAlfa = nNume; |QBF aAlfa;
                         aCampoPDF = "dato.a." + aAlfa;
                    |FINSI;
               |FINSI;
               |HAZ GrabaPdf;
          |FINSI;
          |SI aTipo = "4";
               |SI aValor = "A";
                    aValor = "Sí";
               |SINO;
                    |SI aValor = "B";
                         aValor = "Sí";
                         nNume = #78#5;
                         nNume = nNume + 1;
                         aAlfa = nNume; |QBF aAlfa;
                         aCampoPDF = "dato.a." + aAlfa;
                    |FINSI;
               |FINSI;
               |HAZ GrabaPdf;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE LineasPDF037;
     #78#1;
     ;
     #77#0, nDesdeLin;
     #77#0, nHastaLin;
     ;
     NULL, CampoPDF037;
|FIN;

|PROCESO Hoja8_PDF;
     nSocio = nSocio + 1;
     |SI nSocio = 1;
          nDesdeLin = 0100;
          nHastaLin = 0199;
          |BUCLE LineasPDF;
     |FINSI;
     |SI nSocio = 2;
          nDesdeLin = 0200;
          nHastaLin = 0299;
          |BUCLE LineasPDF;
     |FINSI;
|FPRC;

|DEFBUCLE Hoja8_PDF;      || Socios, miembros o participes
     #200#1003;
     ;
     enEmpresa, enRegistro, 01;
     enEmpresa, enRegistro, 99;
     ;
     NULL, Hoja8_PDF;
|FIN;

|PROCESO Hoja4B_PDF037;
     |SI #200#4 = "D";
          nLocalD = nLocalD + 1;
          |SI nLocalD = 1;
               nDesdeLin = 0412;
               nHastaLin = 0432;
               |BUCLE LineasPDF037;
               nDesdeLin = 4191;
               nHastaLin = 4202;
               |BUCLE LineasPDF037;
          |FINSI;
     |FINSI;
     |SI #200#4 = "I";
          nLocalI = nLocalI + 1;
          |SI nLocalI = 1;
               nDesdeLin = 0433;
               nHastaLin = 0455;
               |BUCLE LineasPDF037;
               nDesdeLin = 4401;
               nHastaLin = 4412;
               |BUCLE LineasPDF037;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE Hoja4B_PDF037;      || Locales
     #200#1004;
     ;
     enEmpresa, enRegistro, nActivValida, 01;
     enEmpresa, enRegistro, nActivValida, 99;
     ;
     NULL, Hoja4B_PDF037;
|FIN;

|PROCESO Hoja4B_PDF;
     |SI #200#4 = "D";
          nLocalD = nLocalD + 1;
          |SI nLocalD = 1;
               nDesdeLin = 0412;
               nHastaLin = 0432;
               |BUCLE LineasPDF;
               nDesdeLin = 4191;
               nHastaLin = 4202;
               |BUCLE LineasPDF;
          |FINSI;
          |SI nLocalD = 2; |Y #0#0 = 1;
               nDesdeLin = 0433;
               nHastaLin = 0453;
               |BUCLE LineasPDF;
               nDesdeLin = 4401;
               nHastaLin = 4412;
               |BUCLE LineasPDF;
          |FINSI;
     |FINSI;
     |SI #200#4 = "I";
          nLocalI = nLocalI + 1;
          |SI nLocalI = 1;
               nDesdeLin = 0454;
               nHastaLin = 0476;
               |BUCLE LineasPDF;
               nDesdeLin = 4611;
               nHastaLin = 4622;
               |BUCLE LineasPDF;
          |FINSI;
          |SI nLocalI = 2;
               nDesdeLin = 0477;
               nHastaLin = 0499;
               |BUCLE LineasPDF;
               nDesdeLin = 4841;
               nHastaLin = 4852;
               |BUCLE LineasPDF;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE Hoja4B_PDF;      || Locales
     #200#1004;
     ;
     enEmpresa, enRegistro, nActivValida, 01;
     enEmpresa, enRegistro, nActivValida, 99;
     ;
     NULL, Hoja4B_PDF;
|FIN;

|PROCESO Hoja4A_PDF;
     nActiv = nActiv + 1;
     |SI nActiv = 1;
          nDesdeLin = 0001;
          nHastaLin = 9999;
          |SI #0#0 = 1;
               |BUCLE LineasPDF;
          |FINSI;
          |SI #0#0 = 3;
               |BUCLE LineasPDF037;
          |FINSI;
          nActivValida = #200#2;
     |FINSI;
|FPRC;

|DEFBUCLE Hoja4A_PDF;      || Actividades
     #200#1003;
     ;
     enEmpresa, enRegistro, 01;
     enEmpresa, enRegistro, 99;
     ;
     NULL, Hoja4A_PDF;
|FIN;

|PROCESO Hoja3_PDF;
     nRepre = nRepre + 1;
     |SI nRepre = 1;
          nDesdeLin = 0001;
          nHastaLin = 0049;
          |BUCLE LineasPDF;
     |FINSI;
     |SI nRepre = 2;
          nDesdeLin = 0050;
          nHastaLin = 0099;
          |BUCLE LineasPDF;
     |FINSI;
|FPRC;

|DEFBUCLE Hoja3_PDF;      || Representantes
     #200#1003;
     ;
     enEmpresa, enRegistro, 01;
     enEmpresa, enRegistro, 99;
     ;
     NULL, Hoja3_PDF;
|FIN;

|PROCESO ConstruyePDF037;
     |ABRE #77;
     |ABRE #78;

     #77#0 = aHoja;
     |LEE 000#77=;
     |SI FSalida = 0;
          |DBASE aPath; |QBF aPath;
          aDef = #77#2; |QBF aDef;
          aDef = aPath + "def/" + aDef;
          |CARGA_DEF aDef, referen@;
          |SI FSalida = 0;
               |SI aHoja = "1 "; |O aHoja = "2A"; |O aHoja = "2B"; |O aHoja = "2C";
               |O aHoja = "5 "; |O aHoja = "6 "; |O aHoja = "7A"; |O aHoja = "7B";
                    |ABRE #200;
                    #200#0 = enEmpresa;
                    #200#1 = enRegistro;
                    |LEE 101#200=;
                    |SI FSalida = 0;
                         nDesdeLin = 0001;
                         nHastaLin = 9999;
                         |BUCLE LineasPDF037;
                    |FINSI;
                    |LIBERA #200;
                    |CIERRA #200;
               |FINSI;
               |SI aHoja = "3 ";
                    nRepre = 0;
                    |BUCLE Hoja3_PDF;
               |FINSI;
               |SI aHoja = "4A";
                    nActiv = 0;
                    nActivValida = 0;
                    |BUCLE Hoja4A_PDF;
               |FINSI;
               |SI aHoja = "4B";
                    nLocalD = 0;
                    nLocalI = 0;
                    |BUCLE Hoja4B_PDF037;
               |FINSI;
               |SI aHoja = "8 ";
                    nSocio = 0;
                    |BUCLE Hoja8_PDF;
               |FINSI;
          |FINSI;
          |DESCARGA_DEF #referen@;
     |FINSI;

     |CIERRA #78;
     |CIERRA #77;
|FPRC;

|PROCESO ConstruyePDF;
     |ABRE #75;
     |ABRE #76;

     #75#0 = aHoja;
     |LEE 000#75=;
     |SI FSalida = 0;
          |DBASE aPath; |QBF aPath;
          aDef = #75#2; |QBF aDef;
          aDef = aPath + "def/" + aDef;
          |CARGA_DEF aDef, referen@;
          |SI FSalida = 0;
               |SI aHoja = "1 "; |O aHoja = "2A"; |O aHoja = "2B"; |O aHoja = "2C";
               |O aHoja = "5 "; |O aHoja = "6 "; |O aHoja = "7A"; |O aHoja = "7B";
                    |ABRE #200;
                    #200#0 = enEmpresa;
                    #200#1 = enRegistro;
                    |LEE 101#200=;
                    |SI FSalida = 0;
                         nDesdeLin = 0001;
                         nHastaLin = 9999;
                         |BUCLE LineasPDF;
                    |FINSI;
                    |LIBERA #200;
                    |CIERRA #200;
               |FINSI;
               |SI aHoja = "3 ";
                    nRepre = 0;
                    |BUCLE Hoja3_PDF;
               |FINSI;
               |SI aHoja = "4A";
                    nActiv = 0;
                    nActivValida = 0;
                    |BUCLE Hoja4A_PDF;
               |FINSI;
               |SI aHoja = "4B";
                    nLocalD = 0;
                    nLocalI = 0;
                    |BUCLE Hoja4B_PDF;
               |FINSI;
               |SI aHoja = "8 ";
                    nSocio = 0;
                    |BUCLE Hoja8_PDF;
               |FINSI;
          |FINSI;
          |DESCARGA_DEF #referen@;
     |FINSI;

     |CIERRA #76;
     |CIERRA #75;
|FPRC;

|PROCESO Numerico;
     aLong = aAlfa % 0;
     nLong = aLong;
     |QBF aAlfa;
     aAlfa1 = "0" * nLong;
     aAlfa = aAlfa1 + aAlfa;

     nNume = 100 + nLong;
     nNume = nNume * -1;
     aAlfa = aAlfa % nNume;
|FPRC;

|PROCESO Excep_1;
     |SI nNumero = 1; aAlfa = "<T036010>"; |FINSI;
     |SI nNumero = 2; aAlfa = " "; |FINSI;
     |SI nNumero = 3; aAlfa = "20070701"; |FINSI;
     |SI nNumero = 6; aAlfa = "             "; |FINSI;
     |SI nNumero = 30;
          aFecha = #42#27; |HAZ SoyUnaFecha;
     |FINSI;
     |SI nNumero = 35;
         aFecha = #42#30; |HAZ SoyUnaFecha;
     |FINSI;
     |SI nNumero = 39;
         aFecha = #42#32; |HAZ SoyUnaFecha;
     |FINSI;
     |SI nNumero = 44; aAlfa = aBlanco * 110; |FINSI;
     |SI nNumero = 45; aAlfa = "</T036010>";  |FINSI;
     |SI nNumero = 46; aAlfa = &13 + &10;     |FINSI;
|FPRC;

|PROCESO Excep_2A;
     |SI nNumero = 1; aAlfa = "<T03602A>"; |FINSI;
     |SI nNumero = 2; aAlfa = " "; |FINSI;
     |SI nNumero = 3;
         aAlfa = " ";
         |SI #43#2 = "S"; aAlfa = "S"; |FINSI;
         |SI #43#3 = "S"; aAlfa = "N"; |FINSI;
     |FINSI;
     |SI nNumero = 6; aAlfa = "00000"; |FINSI;
     |SI nNumero = 11; aAlfa = "00000"; |FINSI;
     |SI nNumero = 24; aAlfa = "00000"; |FINSI;
     |SI nNumero = 43; aAlfa = "00000"; |FINSI;
     |SI nNumero = 56; aAlfa = "00000"; |FINSI;
     |SI nNumero = 75; aAlfa = "00000"; |FINSI;
     |SI nNumero = 88; aAlfa = "00000"; |FINSI;
     |SI nNumero = 91; aAlfa = aBlanco * 100; |FINSI;
     |SI nNumero = 100; aAlfa = aBlanco * 204; |FINSI;
     |SI nNumero = 101; aAlfa = "</T03602A>"; |FINSI;
     |SI nNumero = 102; aAlfa = &13 + &10; |FINSI;
|FPRC;

|PROCESO Excep_2B;
    |SI nNumero = 1; aAlfa = "<T03602B>"; |FINSI;
    |SI nNumero = 2; aAlfa = " "; |FINSI;
    |SI nNumero = 3;
        aAlfa = " ";
        |SI #44#2 = "S"; aAlfa = "S"; |FINSI;
        |SI #44#3 = "S"; aAlfa = "N"; |FINSI;
    |FINSI;
    |SI nNumero = 9;
        aFecha = #44#9; |HAZ SoyUnaFecha;
    |FINSI;
    |SI nNumero = 12;
        aFecha = #44#10; |HAZ SoyUnaFecha;
    |FINSI;
    |SI nNumero = 15;
        aFecha = #44#11; |HAZ SoyUnaFecha;
    |FINSI;
    |SI nNumero = 19; aAlfa = "00000"; |FINSI;
    |SI nNumero = 32; aAlfa = "00000"; |FINSI;
    |SI nNumero = 51; aAlfa = "00000"; |FINSI;
    |SI nNumero = 64; aAlfa = "00000"; |FINSI;
    |SI nNumero = 83; aAlfa = "00000"; |FINSI;
    |SI nNumero = 96; aAlfa = "00000"; |FINSI;
    |SI nNumero = 99; aAlfa = aBlanco * 100; |FINSI;
    |SI nNumero = 124; aAlfa = aBlanco * 194; |FINSI;
    |SI nNumero = 125; aAlfa = "</T03602B>"; |FINSI;
    |SI nNumero = 126; aAlfa = &13 + &10; |FINSI;
|FPRC;

|PROCESO Excep_2C;
    |SI nNumero = 1; aAlfa = "<T03602C>"; |FINSI;
    |SI nNumero = 2; aAlfa = " "; |FINSI;
    |SI nNumero = 12; aAlfa = "00000"; |FINSI;
    |SI nNumero = 25; aAlfa = "00000"; |FINSI;
    |SI nNumero = 33; aAlfa = "00000"; |FINSI;
    |SI nNumero = 46; aAlfa = "00000"; |FINSI;

    |SI nNumero = 64; aAlfa = aBlanco * 254; |FINSI;
    |SI nNumero = 65; aAlfa = "</T03602C>"; |FINSI;
    |SI nNumero = 66; aAlfa = &13 + &10; |FINSI;
|FPRC;


|PROCESO Excep_3;
    |SI nNumero = 3;
         aAlfa = " ";
         |SI #46#3 = "S";
              aAlfa = "A";
         |SINO;
              |SI #46#4 = "S";
                   aAlfa = "B";
              |SINO;
                   |SI #46#5 = "S";
                        aAlfa = "M";
                   |FINSI;
              |FINSI;
         |FINSI;
    |FINSI;
    |SI nNumero = 4;
         aFecha = #46#6; |HAZ SoyUnaFecha;
    |FINSI;

    |SI nNumero = 11; aAlfa = "00000"; |FINSI;
    |SI nNumero = 24; aAlfa = "00000"; |FINSI;
    |SI nNumero = 27; aAlfa = aBlanco * 100; |FINSI;
    |SI nNumero = 31;
         aAlfa = " ";
         |SI #agicen46#30 = "S";
              aAlfa = "L";
         |FINSI;
         |SI #agicen46#32 = "S";
              aAlfa = "V";
         |FINSI;
    |FINSI;
|FPRC;

|PROCESO Excep_5;
    |SI nNumero = 1; aAlfa = "<T036050>"; |FINSI;
    |SI nNumero = 2; aAlfa = " "; |FINSI;
    |SI nNumero = 4; aFecha = #49#47; |HAZ SoyUnaFecha; |FINSI;
    |SI nNumero = 8; aFecha = #49#80; |HAZ SoyUnaFecha; |FINSI;
    |SI nNumero = 14; aFecha = #49#5; |HAZ SoyUnaFecha; |FINSI;
    |SI nNumero = 18; aFecha = #49#7; |HAZ SoyUnaFecha; |FINSI;
    |SI nNumero = 22; aFecha = #49#9; |HAZ SoyUnaFecha; |FINSI;
    |SI nNumero = 26; aFecha = #49#11; |HAZ SoyUnaFecha; |FINSI;

    |SI nNumero = 31; aFecha = #49#14; |HAZ SoyUnaFecha; |FINSI;
    |SI nNumero = 36; aFecha = #49#18; |HAZ SoyUnaFecha; |FINSI;
    |SI nNumero = 41; aFecha = #49#22; |HAZ SoyUnaFecha; |FINSI;
    |SI nNumero = 46; aFecha = #49#26; |HAZ SoyUnaFecha; |FINSI;
    |SI nNumero = 51; aFecha = #49#30; |HAZ SoyUnaFecha; |FINSI;
    |SI nNumero = 56; aFecha = #49#34; |HAZ SoyUnaFecha; |FINSI;

    |SI nNumero = 59;
         aAlfa = "";
         |SI #49#36 = "S"; aAlfa = "1"; |FINSI;
         |SI #49#40 = "S"; aAlfa = "2"; |FINSI;
         |SI #49#44 = "S"; aAlfa = "3"; |FINSI;
         |SI #49#48 = "S"; aAlfa = "4"; |FINSI;
         |SI #49#72 = "S"; aAlfa = "5"; |FINSI;
         |SI aAlfa = ""; aAlfa = "0"; |FINSI;
    |FINSI;
    |SI nNumero = 60;
         aAlfa = "      ";
         |SI #49#36 = "S"; aAlfa = #49#37; |FINSI;
         |SI #49#40 = "S"; aAlfa = #49#41; |FINSI;
         |SI #49#44 = "S"; aAlfa = #49#45; |FINSI;
         |SI #49#48 = "S"; aAlfa = #49#49; |FINSI;
         |SI #49#72 = "S"; aAlfa = #49#73; |FINSI;
    |FINSI;
    |SI nNumero = 61;
         aAlfa = "        ";
         |SI #49#36 = "S"; aFecha = #49#38; |FINSI;
         |SI #49#40 = "S"; aFecha = #49#42; |FINSI;
         |SI #49#44 = "S"; aFecha = #49#46; |FINSI;
         |SI #49#48 = "S"; aFecha = #49#50; |FINSI;
         |SI #49#72 = "S"; aFecha = #49#74; |FINSI;
         |HAZ SoyUnaFecha;
    |FINSI;

    |SI nNumero = 64;
         aAlfa = "";
         |SI #49#52 = "S"; aAlfa = "1"; |FINSI;
         |SI #49#56 = "S"; aAlfa = "2"; |FINSI;
         |SI #49#60 = "S"; aAlfa = "3"; |FINSI;
         |SI #49#64 = "S"; aAlfa = "4"; |FINSI;
         |SI #49#68 = "S"; aAlfa = "5"; |FINSI;
         |SI aAlfa = ""; aAlfa = "0"; |FINSI;
    |FINSI;
    |SI nNumero = 65;
         aAlfa = "      ";
         |SI #49#52 = "S"; aAlfa = #49#53; |FINSI;
         |SI #49#56 = "S"; aAlfa = #49#57; |FINSI;
         |SI #49#60 = "S"; aAlfa = #49#61; |FINSI;
         |SI #49#64 = "S"; aAlfa = #49#65; |FINSI;
         |SI #49#68 = "S"; aAlfa = #49#69; |FINSI;
    |FINSI;
    |SI nNumero = 66;
         aAlfa = "        ";
         |SI #49#52 = "S"; aFecha = #49#54; |FINSI;
         |SI #49#56 = "S"; aFecha = #49#58; |FINSI;
         |SI #49#60 = "S"; aFecha = #49#62; |FINSI;
         |SI #49#64 = "S"; aFecha = #49#66; |FINSI;
         |SI #49#68 = "S"; aFecha = #49#70; |FINSI;
         |HAZ SoyUnaFecha;
    |FINSI;

    |SI nNumero = 71; aFecha = #49#78; |HAZ SoyUnaFecha; |FINSI;
    |SI nNumero = 76; aFecha = #49#86; |HAZ SoyUnaFecha; |FINSI;
    |SI nNumero = 79;
         nNume = #49#88 * 100;
         aAlfa = nNume;
         aAlfa = ("00000" + aAlfa) % -105;
    |FINSI;
    |SI nNumero = 81;
         nNume = #49#90; aAlfa = nNume; aAlfa = ("000" + aAlfa) % -103;
    |FINSI;
    |SI nNumero = 82;
         nNume = #49#91; aAlfa = nNume; aAlfa = ("000" + aAlfa) % -103;
    |FINSI;
    |SI nNumero = 83;
         nNume = #49#92; aAlfa = nNume; aAlfa = ("000" + aAlfa) % -103;
    |FINSI;
    |SI nNumero = 85;
         nNume = #49#94; aAlfa = nNume; aAlfa = ("000" + aAlfa) % -103;
    |FINSI;
    |SI nNumero = 86;
         nNume = #49#95; aAlfa = nNume; aAlfa = ("000" + aAlfa) % -103;
    |FINSI;
    |SI nNumero = 87;
         nNume = #49#96; aAlfa = nNume; aAlfa = ("000" + aAlfa) % -103;
    |FINSI;
    |SI nNumero = 89;
         nNume = #49#98; aAlfa = nNume; aAlfa = ("000" + aAlfa) % -103;
    |FINSI;
    |SI nNumero = 90;
         nNume = #49#99; aAlfa = nNume; aAlfa = ("000" + aAlfa) % -103;
    |FINSI;
    |SI nNumero = 91;
         nNume = #49#100; aAlfa = nNume; aAlfa = ("000" + aAlfa) % -103;
    |FINSI;

    |SI nNumero = 93; aAlfa = aBlanco * 123; |FINSI;
    |SI nNumero = 94; aAlfa = "</T036050>"; |FINSI;
    |SI nNumero = 95; aAlfa = &13 + &10; |FINSI;
|FPRC;

|PROCESO Excep_6;
    |SI nNumero = 1; aAlfa = "<T036060>"; |FINSI;
    |SI nNumero = 2; aAlfa = " "; |FINSI;
    |SI nNumero = 4; aFecha = #50#4; |HAZ SoyUnaFecha; |FINSI;
    |SI nNumero = 8; aFecha = #50#5; |HAZ SoyUnaFecha; |FINSI;

    |SI nNumero = 11;
         aAlfa = "";
         |SI #50#6 = "S"; aAlfa = "1"; |FINSI;
         |SI #50#7 = "S"; aAlfa = "2"; |FINSI;
         |SI #50#8 = "S"; aAlfa = "3"; |FINSI;
         |SI #50#9 = "S"; aAlfa = "4"; |FINSI;
         |SI #50#39 = "S"; aAlfa = "5"; |FINSI;
         |SI aAlfa = ""; aAlfa = "0"; |FINSI;
    |FINSI;
    |SI nNumero = 12; aFecha = #50#40; |HAZ SoyUnaFecha; |FINSI;

    |SI nNumero = 15;
         aAlfa = "";
         |SI #50#10 = "S"; aAlfa = "1"; |FINSI;
         |SI #50#41 = "S"; aAlfa = "5"; |FINSI;
         |SI aAlfa = ""; aAlfa = "0"; |FINSI;
    |FINSI;
    |SI nNumero = 16; aFecha = #50#42; |HAZ SoyUnaFecha; |FINSI;

    |SI nNumero = 19;
         aAlfa = "";
         |SI #50#11 = "S"; aAlfa = "1"; |FINSI;
         |SI #50#12 = "S"; aAlfa = "2"; |FINSI;
         |SI #50#13 = "S"; aAlfa = "3"; |FINSI;
         |SI #50#14 = "S"; aAlfa = "4"; |FINSI;
         |SI #50#43 = "S"; aAlfa = "5"; |FINSI;
         |SI aAlfa = ""; aAlfa = "0"; |FINSI;
    |FINSI;
    |SI nNumero = 20; aFecha = #50#78; |HAZ SoyUnaFecha; |FINSI;

    |SI nNumero = 48; aFecha = #50#71; |HAZ SoyUnaFecha; |FINSI;

    |SI nNumero = 51;
         aFecha = #50#70;
         |QBF aFecha;
         |SI aFecha ! "01.01.0000"
              aAlfa = aFecha % 102;
         |SINO;
              aAlfa = "00";
         |FINSI;
    |FINSI;
    |SI nNumero = 52;
         aFecha = #50#70;
         |QBF aFecha;
         |SI aFecha ! "01.01.0000"
              aAlfa = aFecha % 402;
         |SINO;
              aAlfa = "00";
         |FINSI;
    |FINSI;

    |SI nNumero = 54; aFecha = #50#72; |HAZ SoyUnaFecha; |FINSI;

    |SI nNumero = 58;
         aAlfa = "0";
         |SI #50#53 = "S"; aAlfa = "1"; |FINSI;
         |SI #50#54 = "S"; aAlfa = "3"; |FINSI;
         |SI #50#55 = "S"; aAlfa = "2"; |FINSI;
    |FINSI;
    |SI nNumero = 59;
         aAlfa = "        ";
         |SI #50#53 = "S"; aFecha = #50#73; |FINSI;
         |SI #50#54 = "S"; aFecha = #50#74; |FINSI;
         |SI #50#55 = "S"; aFecha = #50#75; |FINSI;
         |HAZ SoyUnaFecha;
    |FINSI;

    |SI nNumero = 63; aFecha = #50#76; |HAZ SoyUnaFecha; |FINSI;

    |SI nNumero = 66;
         aAlfa = "0";
         |SI #50#60 = "S"; aAlfa = "1"; |FINSI;
         |SI #50#61 = "S"; aAlfa = "2"; |FINSI;
         |SI #50#62 = "S"; aAlfa = "3"; |FINSI;
    |FINSI;

    |SI nNumero = 68; aFecha = #50#66; |HAZ SoyUnaFecha; |FINSI;
    |SI nNumero = 72; aFecha = #50#67; |HAZ SoyUnaFecha; |FINSI;
    |SI nNumero = 76; aFecha = #50#68; |HAZ SoyUnaFecha; |FINSI;
    |SI nNumero = 80; aFecha = #50#81; |HAZ SoyUnaFecha; |FINSI;
    |SI nNumero = 84; aFecha = #50#82; |HAZ SoyUnaFecha; |FINSI;

    |SI nNumero = 87; aAlfa = aBlanco * 184; |FINSI;
    |SI nNumero = 88; aAlfa = "</T036060>"; |FINSI;
    |SI nNumero = 89; aAlfa = &13 + &10; |FINSI;
|FPRC;

|PROCESO Excep_7A;
    |SI nNumero = 1; aAlfa = "<T036070>"; |FINSI;
    |SI nNumero = 2; aAlfa = " "; |FINSI;

    |SI nNumero = 4; aFecha = #51#22; |HAZ SoyUnaFecha; |FINSI;
    |SI nNumero = 8; aFecha = #51#23; |HAZ SoyUnaFecha; |FINSI;
    |SI nNumero = 12; aFecha = #51#24; |HAZ SoyUnaFecha; |FINSI;
    |SI nNumero = 16; aFecha = #51#25; |HAZ SoyUnaFecha; |FINSI;
    |SI nNumero = 20; aFecha = #51#26; |HAZ SoyUnaFecha; |FINSI;
    |SI nNumero = 24; aFecha = #51#27; |HAZ SoyUnaFecha; |FINSI;
    |SI nNumero = 28; aFecha = #51#28; |HAZ SoyUnaFecha; |FINSI;
    |SI nNumero = 32; aFecha = #51#29; |HAZ SoyUnaFecha; |FINSI;
    |SI nNumero = 36; aFecha = #51#32; |HAZ SoyUnaFecha; |FINSI;
    |SI nNumero = 40; aFecha = #51#33; |HAZ SoyUnaFecha; |FINSI;
    |SI nNumero = 44; aFecha = #51#34; |HAZ SoyUnaFecha; |FINSI;
    |SI nNumero = 48; aFecha = #51#35; |HAZ SoyUnaFecha; |FINSI;
|FPRC;

|PROCESO Excep_7B;
    |SI nNumero = 135; aAlfa = aBlanco * 188; |FINSI;
    |SI nNumero = 136; aAlfa = "</T036070>"; |FINSI;
    |SI nNumero = 137; aAlfa = &13 + &10; |FINSI;
|FPRC;

|PROCESO Excep_8;
    |SI nNumero = 3;
         aAlfa = " ";
         |SI #53#3 = "S";
              aAlfa = "A";
         |SINO;
              |SI #53#4 = "S";
                   aAlfa = "B";
              |SINO;
                   |SI #53#5 = "S";
                        aAlfa = "M";
                   |FINSI;
              |FINSI;
         |FINSI;
    |FINSI;
    |SI nNumero = 4;
         aFecha = #46#6; |HAZ SoyUnaFecha;
    |FINSI;

    |SI nNumero = 10; aAlfa = "00000"; |FINSI;
    |SI nNumero = 23; aAlfa = "00000"; |FINSI;
    |SI nNumero = 26; aAlfa = aBlanco * 100; |FINSI;

    |SI nNumero = 41;
         nNume = #53#18 * 100;
         aAlfa = nNume;
         aAlfa = ("00000" + aAlfa) % -105;
    |FINSI;
    |SI nNumero = 42;
         aAlfa = " ";
         |SI #53#19 = "S"; |O #53#20 = "S"; aAlfa = "S"; |FINSI;
    |FINSI;
    |SI nNumero = 43;
         aAlfa = " ";
         |SI #53#21 = "S"; |O #53#22 = "S"; aAlfa = "S"; |FINSI;
    |FINSI;
    |SI nNumero = 44;
         aAlfa = " ";
         |SI #53#23 = "S"; |O #53#24 = "S"; aAlfa = "S"; |FINSI;
    |FINSI;
    |SI nNumero = 45;
         aAlfa = " ";
         |SI #53#25 = "S"; |O #53#26 = "S"; aAlfa = "S"; |FINSI;
    |FINSI;
|FPRC;

|PROCESO Agiw0073F;
   nNume1 = nNume1 + 1;
   |SI nNume1 [ nNumCampos;
       |PARA nNumero = nNume1; |SI nNumero [ nNumCampos; |HACIENDO nNumero = nNumero + 1;
             swFecha = 0;
             aAlfa   = "";
             |SI aHoja = "1 ";   |HAZ Excep_1;  |FINSI;
             |SI aHoja = "2A";   |HAZ Excep_2A; |FINSI;
             |SI aHoja = "2B";   |HAZ Excep_2B; |FINSI;
             |SI aHoja = "2C";   |HAZ Excep_2C; |FINSI;
             |SI aHoja = "3 ";   |HAZ Excep_3;  |FINSI;
             |SI aHoja = "5 ";   |HAZ Excep_5;  |FINSI;
             |SI aHoja = "6 ";   |HAZ Excep_6;  |FINSI;
             |SI aHoja = "7A";   |HAZ Excep_7A; |FINSI;
             |SI aHoja = "7B";   |HAZ Excep_7B; |FINSI;
             |SI aHoja = "8 ";   |HAZ Excep_8;  |FINSI;

             |SI swFecha = 0;
                 |HAZ QuitaRaros;
                 |XGRABA nHandle, aAlfa;
             |FINSI;
       |SIGUE;
   |FINSI;
|FPRC;

|PROCESO Agiw0073C;
   nNume1 = nNume1 + 1;
   nConta = #73#1;

   |PARA nNumero = nNume1; |SI nNumero [ nConta; |HACIENDO nNumero = nNumero + 1;
         swFecha = 0;
         aAlfa   = "";
         |SI nConta = nNumero;   || Campo del Fichero
             nCampo = #73#2;

             |SI #73#0 = "1 ";  aAlfa = #42nCampo; |FINSI;
             |SI #73#0 = "2A";  aAlfa = #43nCampo; |FINSI;
             |SI #73#0 = "2B";  aAlfa = #44nCampo; |FINSI;
             |SI #73#0 = "2C";  aAlfa = #45nCampo; |FINSI;
             |SI #73#0 = "3 ";  aAlfa = #46nCampo; |FINSI;
             |SI #73#0 = "5 ";  aAlfa = #49nCampo; |FINSI;
             |SI #73#0 = "6 ";  aAlfa = #50nCampo; |FINSI;
             |SI #73#0 = "7A";  aAlfa = #51nCampo; |FINSI;
             |SI #73#0 = "7B";  aAlfa = #52nCampo; |FINSI;
             |SI #73#0 = "8 ";  aAlfa = #53nCampo; |FINSI;

             |SI #73#3 = "N";  |HAZ Numerico; |FINSI;
         |SINO;
             |SI #73#0 = "1 ";   |HAZ Excep_1;  |FINSI;
             |SI #73#0 = "2A";   |HAZ Excep_2A; |FINSI;
             |SI #73#0 = "2B";   |HAZ Excep_2B; |FINSI;
             |SI #73#0 = "2C";   |HAZ Excep_2C; |FINSI;
             |SI #73#0 = "3 ";   |HAZ Excep_3;  |FINSI;
             |SI #73#0 = "5 ";   |HAZ Excep_5;  |FINSI;
             |SI #73#0 = "6 ";   |HAZ Excep_6;  |FINSI;
             |SI #73#0 = "7A";   |HAZ Excep_7A; |FINSI;
             |SI #73#0 = "7B";   |HAZ Excep_7B; |FINSI;
             |SI #73#0 = "8 ";   |HAZ Excep_8;  |FINSI;
         |FINSI;
         |SI swFecha = 0;
             |HAZ QuitaRaros;
             |XGRABA nHandle, aAlfa;
         |FINSI;
   |SIGUE;
   nNume1 = #73#1;
|FPRC;

|DEFBUCLE Agiw0073;
  #73#1;
  ;
  aHoja, 001;
  aHoja, 999;
  ;
  NULL, Agiw0073C, NULL, NULL, Agiw0073F;
|FIN;


|PROCESO Hoja1_2007;     || CAUSAS DE PRESENTACION

     |ABRE #42;
     #42#0 = enEmpresa;
     #42#1 = enRegistro;
     |LEE 040#42=;
     |SI FSalida ! 0;  |DDEFECTO #42;  |FINSI;
     |CIERRA #42;

     |SI #0#0 = 1;
          aHoja = "1 ";
          |HAZ ConstruyePDF;
     |FINSI;
     |SI #0#0 = 3;
          aHoja = "1 ";
          |HAZ ConstruyePDF037;
     |FINSI;
     |SI #0#0 = 2;
          aHoja      = "1 ";
          nNume1     = 0;
          nNumCampos = 46;
          |BUCLE Agiw0073;
     |FINSI;
|FPRC;

|PROCESO Hoja2A_2007;    || IDENTIFICACION PERSONAS FISICAS
     |ABRE #43;
     #43#0 = enEmpresa;
     #43#1 = enRegistro;
     |LEE 040#43=;
     |SI FSalida ! 0; |O swDefectoA = 1;
          |DDEFECTO #43;
     |FINSI;
     |CIERRA #43;

     |SI #0#0 = 1;
          aHoja = "2A";
          |HAZ ConstruyePDF;
     |FINSI;
     |SI #0#0 = 3;
          aHoja = "2A";
          |HAZ ConstruyePDF037;
     |FINSI;
     |SI #0#0 = 2;
          aHoja      = "2A";
          nNume1     = 0;
          nNumCampos = 102;
          |BUCLE Agiw0073;
     |FINSI;
|FPRC;

|PROCESO Hoja2B_2007;    || IDENTIFICACION PERSONAS JURIDICAS
     |ABRE #44;
     #44#0 = enEmpresa;
     #44#1 = enRegistro;
     |LEE 040#44=;
     |SI FSalida ! 0; |O swDefectoB = 1;
          |DDEFECTO #44;
     |FINSI;
     |CIERRA #44;

     |SI #0#0 = 1;
          aHoja = "2B";
          |HAZ ConstruyePDF;
     |FINSI;

     |SI #0#0 = 2;
          aHoja      = "2B";
          nNume1     = 0;
          nNumCampos = 126;
          |BUCLE Agiw0073;
     |FINSI;
|FPRC;

|PROCESO Hoja2C_2007;    || IDENTIFICACION ESTABLECIMENTOS PERMANENTES
     |ABRE #45;
     #45#0 = enEmpresa;
     #45#1 = enRegistro;
     |LEE 040#45=;
     |SI FSalida ! 0; |O swDefectoB = 1;
          |DDEFECTO #45;
     |FINSI;
     |CIERRA #45;

     |SI #0#0 = 1;
          aHoja = "2C";
          |HAZ ConstruyePDF;
     |FINSI;
     |SI #0#0 = 2;
          aHoja      = "2C";
          nNume1     = 0;
          nNumCampos = 66;
          |BUCLE Agiw0073;
     |FINSI;
|FPRC;

|PROCESO ElRepre;
     aHoja      = "3 ";
     nNume1     = 2;
     nNumCampos = 34;
     |BUCLE Agiw0073;
|FPRC;

|DEFBUCLE ReprePDF;

|FIN;

|PROCESO Hoja3_2007;    || REPRESENTANTES
     swCual = 0;
     |SI #0#0 = 1;
          aHoja = "3 ";
          |HAZ ConstruyePDF;
     |FINSI;
     |SI #0#0 = 2;
          |ABRE #46;
          |PARA nRepre = 1; |SI nRepre [ 20; |HACIENDO nRepre = nRepre + 1;
               #46#0 = enEmpresa;
               #46#1 = enRegistro;
               #46#2 = nRepre;
               |LEE 040#46=;
               FEstado = FSalida;
               |SI FSalida ! 0;  |DDEFECTO #46;  |FINSI;
               |SI swCual = 0;
                    swCual = 1;
               |FINSI;

               |SI FEstado = 0; |O nRepre = 1;
                    |SI swCual = 1;
                         nNumero = 1; aAlfa = "<T036030>";
                         |HAZ QuitaRaros; |XGRABA nHandle, aAlfa;
                         nNumero = 2; aAlfa = " ";
                         |HAZ QuitaRaros; |XGRABA nHandle, aAlfa;
                         |HAZ ElRepre;
                         swCual = 2;
                    |SINO;
                         |HAZ ElRepre;
                         aAlfa = aBlanco * 228;
                         |HAZ QuitaRaros; |XGRABA nHandle, aAlfa;
                         aAlfa = "</T036030>";
                         |HAZ QuitaRaros; |XGRABA nHandle, aAlfa;
                         aAlfa = &13 + &10;
                         |HAZ QuitaRaros; |XGRABA nHandle, aAlfa;
                         swCual = 1;
                    |FINSI;
               |SINO;
                    |SI nRepre = 20; |Y swCual = 2;
                         |HAZ ElRepre;
                         aAlfa = aBlanco * 228;
                         |HAZ QuitaRaros; |XGRABA nHandle, aAlfa;
                         aAlfa = "</T036030>";
                         |HAZ QuitaRaros; |XGRABA nHandle, aAlfa;
                         aAlfa = &13 + &10;
                         |HAZ QuitaRaros; |XGRABA nHandle, aAlfa;
                         swCual = 1;
                    |FINSI;
               |FINSI;
          |SIGUE;
          |CIERRA #46;
     |FINSI;
|FPRC;

|PROCESO Locales;
     |PARA nNumero = 19;  |SI nNumero [ 44;  |HACIENDO nNumero = nNumero + 1;
          swFecha = 0;
          aAlfa = "";
          #73#0 = "4B";
          #73#1 = nNumero;
          |LEE 000#73=;
          |SI FSalida = 0;
               nCampo = #73#2;
               aAlfa = #480nCampo;
               |SI #73#3 = "N"; |HAZ Numerico; |FINSI;
          |SINO;
               |SI nNumero = 27;
                    aAlfa = #480#11 % 102;
               |FINSI;
               |SI nNumero = 28; aAlfa = "000000"; |FINSI;
               |SI nNumero = 29;
                    aAlfa = #480#16;
                    aAlfa = ("0000000" + aAlfa) % -107;
               |FINSI;
               |SI nNumero = 30;
                    aAlfa = #480#17;
                    aAlfa = ("000" + aAlfa) % -103;
                    |SI nLocal = 1; |O nLocal = 2;
                         aAlfa = aAlfa;
                    |SINO;
                         aAlfa = aAlfa + #480#27;
                    |FINSI;
               |FINSI;
               |SI nNumero = 32;
                    aFecha = #480#19; |HAZ SoyUnaFecha;
               |FINSI;
               |SI nNumero = 36;
                    aFecha = #480#22; |HAZ SoyUnaFecha;
               |FINSI;
               |SI nNumero = 41;
                    aFecha = #480#25; |HAZ SoyUnaFecha;
               |FINSI;
          |FINSI;
          |SI swFecha = 0;
               |HAZ QuitaRaros;
               |XGRABA nHandle, aAlfa;
          |FINSI;
     |SIGUE;
|FPRC;

|PROCESO Actividades;
     |PARA nNumero = 3;  |SI nNumero [ 18;  |HACIENDO nNumero = nNumero + 1;
          swFecha = 0;
          aAlfa = "";
          #73#0 = "4A";
          #73#1 = nNumero;
          |LEE 000#73=;
          |SI FSalida = 0;
               nCampo = #73#2;
               aAlfa = #47nCampo;
               |SI #73#3 = "N"; |HAZ Numerico; |FINSI;
          |SINO;
               |SI nNumero = 8;
                    aFecha = #47#10; |HAZ SoyUnaFecha;
               |FINSI;
               |SI nNumero = 12;
                    aFecha = #47#13; |HAZ SoyUnaFecha;
               |FINSI;
               |SI nNumero = 17;
                    aAlfa = #47#16; |QBF aAlfa; aAlfa = ("00" + aAlfa) % -102;
                    |SI aAlfa = "00";
                         aAlfa = "  ";
                    |FINSI;
               |FINSI;
               |SI nNumero = 18; aAlfa = "000000"; |FINSI;
          |FINSI;
          |SI swFecha = 0;
               |HAZ QuitaRaros;
               |XGRABA nHandle, aAlfa;
          |FINSI;
     |SIGUE;
|FPRC;

|PROCESO Hoja4_2007;    || LOCALES
     |SI #0#0 = 1;
          aHoja = "4A"
          |HAZ ConstruyePDF;
          aHoja = "4B"
          |HAZ ConstruyePDF;
     |FINSI;
     |SI #0#0 = 3;
          aHoja = "4A"
          |HAZ ConstruyePDF037;
          aHoja = "4B"
          |HAZ ConstruyePDF037;
     |FINSI;

     |SI #0#0 = 2;
          swRepite = 0;
          |ABRE #47;
          |PARA nActiv = 1; |SI nActiv [ 9; |HACIENDO nActiv = nActiv + 1;
               #47#0 = enEmpresa;
               #47#1 = enRegistro;
               #47#2 = nActiv;
               |LEE 040#47=;
               |SI FSalida ! 0;
                    |SI nActiv = 1;
                         |DDEFECTO #47;      || el principal siempre
                    |SINO;
                         |CIERRA #47;
                         |SAL;
                    |FINSI;
               |FINSI;

               nNumero = 1; aAlfa = "<T036040>";
               |HAZ QuitaRaros; |XGRABA nHandle, aAlfa;

               nNumero = 2;
               |SI nActiv = 1;
                    aAlfa = " ";
               |SINO;
                    aAlfa = "C";
               |FINSI;
               |HAZ QuitaRaros; |XGRABA nHandle, aAlfa;

               |ABRE #73;

               |HAZ Actividades;

               |PARA nLocal = 1; |SI nLocal [ 25; |Y swRepite = 0;
               |HACIENDO nLocal = nLocal + 1;
                    |ABRE #480;
                    #480#0 = enEmpresa;
                    #480#1 = enRegistro;
                    #480#2 = nActiv;
                    #480#3 = nLocal;
                    |LEE 040#480=;
                    |SI FSalida = 0;
                         aLocal = nLocal;
                         aLocal = ("00" + aLocal) % -102;
                         |SI #480#4 = "D";
                              aLocalesDet = aLocalesDet + aLocal;
                              nLocalesDet = nLocalesDet + 1;
                         |FINSI;
                         |SI #480#4 = "I";
                              aLocalesInd = aLocalesInd + aLocal;
                              nLocalesInd = nLocalesInd + 1;
                         |FINSI;
                         nLocales = nLocales + 1;
                    |FINSI;
               |SIGUE;
               |SI nLocales = 0;
                    nLocales = 4;
                    nLocalesDet = 2;
                    aLocalesDet = "0000";
                    nLocalesInd = 2;
                    aLocalesInd = "0000";
               |FINSI;
               |SI nLocales > 0;
                    |PARA nLocal = 1; |SI nLocal [ 4; |HACIENDO nLocal = nLocal + 1;
                         nLineaLocal = 0;
                         |SI nLocal = 1; |O nLocal = 2;
                              |SI nLocalesDet > 0;
                                   aLocal = aLocalesDet % 102;
                                   nLineaLocal = aLocal;

                                   aLocalesDet = aLocalesDet - aLocal;
                                   nLocalesDet = nLocalesDet - 1;
                                   nLocales = nLocales - 1;
                              |FINSI;
                         |FINSI;
                         |SI nLocal = 3; |O nLocal = 4;
                              |SI nLocalesInd > 0;
                                   aLocal = aLocalesInd % 102;
                                   nLineaLocal = aLocal;

                                   aLocalesInd = aLocalesInd - aLocal;
                                   nLocalesInd = nLocalesInd - 1;
                                   nLocales = nLocales - 1;
                              |FINSI;
                         |FINSI;

                         |SI nLineaLocal = 0;
                              |DDEFECTO #480;
                         |SINO;
                              |ABRE #480;
                              #480#0 = enEmpresa;
                              #480#1 = enRegistro;
                              #480#2 = nActiv;
                              #480#3 = nLineaLocal;
                              |LEE 040#480=;
                              |CIERRA #480;
                         |FINSI;
                         |HAZ Locales;
                   |SIGUE;
                   |CIERRA #73;
               |FINSI;
               |SI nLocales > 0;
                    swRepite = 1;
                    nActiv = nActiv - 1;
               |SINO;
                    swRepite = 0;
               |FINSI;
               aAlfa = "</T036040>";
               |HAZ QuitaRaros; |XGRABA nHandle, aAlfa;
               aAlfa = &13 + &10;
               |HAZ QuitaRaros; |XGRABA nHandle, aAlfa;
          |SIGUE;
          |CIERRA #47;
     |FINSI;
|FPRC;

|PROCESO Hoja5_2007;    || SUJETO PASIVO GRAN EMPRESA - IVA
     |ABRE #49;
     #49#0 = enEmpresa;
     #49#1 = enRegistro;
     |LEE 040#49=;
     |SI FSalida ! 0;  |DDEFECTO #49;  |FINSI;
     |CIERRA #49;


     |SI #0#0 = 1;
          aHoja = "5 ";
          |HAZ ConstruyePDF;
     |FINSI;
     |SI #0#0 = 3;
          aHoja = "5 ";
          |HAZ ConstruyePDF037;
     |FINSI;
     |SI #0#0 = 2;
          aHoja      = "5 ";
          nNume1     = 0;
          nNumCampos = 95;
          |BUCLE Agiw0073;
     |FINSI;
|FPRC;

|PROCESO Hoja6_2007;    || IRPF
     |ABRE #50;
     #50#0 = enEmpresa;
     #50#1 = enRegistro;
     |LEE 040#50=;
     |SI FSalida ! 0;  |DDEFECTO #50;  |FINSI;
     |CIERRA #50;


     |SI #0#0 = 1;
          aHoja = "6 ";
          |HAZ ConstruyePDF;
     |FINSI;
     |SI #0#0 = 3;
          aHoja = "6 ";
          |HAZ ConstruyePDF037;
     |FINSI;
     |SI #0#0 = 2;
          aHoja      = "6 ";
          nNume1     = 0;
          nNumCampos = 89;
          |BUCLE Agiw0073;
     |FINSI;
|FPRC;

|PROCESO Hoja7_2007;    || REGIMENES ESPECIALES COMERCIO INTRACOMUNITARIO
     |ABRE #51;
     #51#0 = enEmpresa;
     #51#1 = enRegistro;
     |LEE 040#51=;
     |SI FSalida ! 0;  |DDEFECTO #51;  |FINSI;
     |CIERRA #51;

     |SI #0#0 = 1;
          aHoja = "7A";
          |HAZ ConstruyePDF;
          aHoja = "7B";
          |HAZ ConstruyePDF;
     |FINSI;
     |SI #0#0 = 3;
          aHoja = "7A";
          |HAZ ConstruyePDF037;
     |FINSI;
     |SI #0#0 = 2;
          aHoja      = "7A";
          nNume1     = 0;
          nNumCampos = 48;
          |BUCLE Agiw0073;

          |ABRE #52;
          #52#0 = enEmpresa;
          #52#1 = enRegistro;
          |LEE 040#52=;
          |SI FSalida ! 0;  |DDEFECTO #52;  |FINSI;
          |CIERRA #52;

          aHoja      = "7B";
          nNume1     = 50;
          nNumCampos = 137;
          |BUCLE Agiw0073;
     |FINSI;
|FPRC;

|PROCESO ElSocio;
     aHoja      = "8 ";
     nNume1     = 2;
     nNumCampos = 45;
     |BUCLE Agiw0073;
|FPRC;

|PROCESO Hoja8_2007;     || SOCIOS MIEMBROS O PARTICIPES
     swCual = 0;
     |SI #0#0 = 1;
          aHoja = "8 ";
          |HAZ ConstruyePDF;
     |FINSI;

     |SI #0#0 = 2;
          |ABRE #53;
          |PARA nSocio = 1; |SI nSocio [ 20; |HACIENDO nSocio = nSocio + 1;
               #53#0 = enEmpresa;
               #53#1 = enRegistro;
               #53#2 = nSocio;
               |LEE 040#53=;
               FEstado = FSalida;
               |SI FSalida ! 0;  |DDEFECTO #53;  |FINSI;
               |SI swCual = 0;
                    swCual = 1;
               |FINSI;

               |SI FEstado = 0; |O nSocio = 1;
                    |SI swCual = 1;
                         nNumero = 1; aAlfa = "<T036080>";
                         |HAZ QuitaRaros; |XGRABA nHandle, aAlfa;
                         nNumero = 2; aAlfa = " ";
                         |HAZ QuitaRaros; |XGRABA nHandle, aAlfa;
                         |HAZ ElSocio;
                         swCual = 2;
                    |SINO;
                         |HAZ ElSocio;
                         aAlfa = aBlanco * 152;
                         |HAZ QuitaRaros; |XGRABA nHandle, aAlfa;
                         aAlfa = "</T036080>";
                         |HAZ QuitaRaros; |XGRABA nHandle, aAlfa;
                         aAlfa = &13 + &10;
                         |HAZ QuitaRaros; |XGRABA nHandle, aAlfa;
                         swCual = 1;
                    |FINSI;
               |SINO;
                    |SI nSocio = 20; |Y swCual = 2;
                         |HAZ ElSocio;
                         aAlfa = aBlanco * 152;
                         |HAZ QuitaRaros; |XGRABA nHandle, aAlfa;
                         aAlfa = "</T036080>";
                         |HAZ QuitaRaros; |XGRABA nHandle, aAlfa;
                         aAlfa = &13 + &10;
                         |HAZ QuitaRaros; |XGRABA nHandle, aAlfa;
                         swCual = 1;
                    |FINSI;
               |FINSI;

          |SIGUE;
          |CIERRA #53;
     |FINSI;
|FPRC;

|PROCESO CierraFichero;
     |XCIERRA nHandle;

     aArchivoTxt = eaUnidadBasico + "\AEAT";                   |RMKDIR aArchivoTxt;
     aArchivoTxt = aArchivoTxt + "\INTERNET";   |RMKDIR aArchivoTxt;
     aArchivoTxt = aArchivoTxt + "\036 "; |RMKDIR aArchivoTxt;
     aArchivoTxt = aArchivoTxt + "\M" + (("00000" + enEmpresa) % -105) + (("00" + enRegistro) % -102) + ".TXT";
     aDestino = aArchivoTxt;
/*

     |DFICE aBase;
     aAlfa = aBase +  "M" + (("00000" + enEmpresa) % -105) + (("00" + enRegistro) % -102) + ".TXT";
     aOrigen = aAlfa;

         aIP = "";
         |IP_REMOTO aIP;  |QBF aIP;
         |SI aIP ! "";
             |ENVIA_FICHERO aOrigen, aDestino;
         |SINO;
             |COPIA_FICHERO aOrigen, aDestino;
         |FINSI;
*/
     aAlfa = "0000 El fichero generado está en " + aArchivoTxt;
     |MENAV aAlfa;
|FPRC;

|PROCESO Emitir;
     |SI #0#0 = 1; |O #0#0 = 3;
          |HAZ IniciaTemporal;
     |FINSI;

     |SI #0#0 = 2;
          |HAZ AbreFichero;
     |FINSI;

     |ABRE #100;

     |HAZ Hoja1_2007;
     |HAZ Hoja2A_2007;
     |HAZ Hoja2B_2007;
     |HAZ Hoja2C_2007;
     |HAZ Hoja3_2007;
     |HAZ Hoja4_2007;
     |HAZ Hoja5_2007;
     |HAZ Hoja6_2007;
     |HAZ Hoja7_2007;
     |HAZ Hoja8_2007;

     |CIERRA #100;

     |SI #0#0 = 1;  |HAZ ImprimePDF;     |FINSI;
     |SI #0#0 = 2;  |HAZ CierraFichero;  |FINSI;
     |SI #0#0 = 3;  |HAZ ImprimePDF;     |FINSI;
|FPRC;

|PROCESO Chequeos3;
     |SI eaTipo = "A";
          |SI #42#5 = " "; |Y #42#8 = " "; |Y #42#9 = " "; |Y #42#10 = " ";
          |Y #42#11 = " ";
               swDefectoA = 1;
               || aMensaje = "    La página 2A sólo es accesible si se marca la casilla ";
               || aMensaje = aMensaje + "111, 122, 123, 124 o 125";
          |FINSI;
     |FINSI;
     |SI eaTipo = "B";
          |SI #42#5 = " "; |Y #42#6 = " "; |Y #42#8 = " "; |Y #42#9 = " ";
          |Y #42#10 = " "; |Y #42#11 = " ";
               swDefectoB = 1;
               || aMensaje = "    La página 2B sólo es accesible si se marca la casilla ";
               || aMensaje = aMensaje + "111, 120, 122, 123, 124 o 125";
          |FINSI;
     |FINSI;
     |SI eaTipo = "C";
          |SI #42#5 = " "; |Y #42#8 = " "; |Y #42#10 = " "; |Y #42#11 = " ";
               swDefectoC = 1;
               || aMensaje = "    La página 2C sólo es accesible si se marca la casilla ";
               || aMensaje = aMensaje + "111, 122, 124 o 125";
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Chequeos2;
     aMensaje = "";

     aAlfa = #42#2; |QBF aAlfa;
     |SI aAlfa = ""; |Y #0#0 = 2;
          aMensaje = "NIF en las causas de presentación.";
          |ACABA;
     |FINSI;
     aAlfa = #42#3; |QBF aAlfa;
     |SI aAlfa = "";
          aMensaje = "Identificación en las causas de presentación.";
          |ACABA;
     |FINSI;
     aAlfa = #0#1; |QBF aAlfa;
     |SI aAlfa = "";
          aMensaje = "Lugar, Fecha y Firma."
     |FINSI;
     aAlfa = #0#2; |QBF aAlfa;
     |SI aAlfa = "";
          aMensaje = "Lugar, Fecha y Firma."
     |FINSI;
     aAlfa = #0#5; |QBF aAlfa;
     |SI aAlfa = "";
          aMensaje = "Lugar, Fecha y Firma."
     |FINSI;
|FPRC;

|PROCESO EmiteEsto;
     |ABRE #42;

     #42#0 = enEmpresa;
     #42#1 = enRegistro;
     |LEE 101#42=;
     |SI FSalida ! 0;
          |CIERRA #42;
          |MENAV "0000 Datos incompletos, rellene el registro del modelo 036.";
          |ACABA;
     |FINSI;

     |HAZ CogeMac;

     aIP = "";
     |IP_REMOTO aIP;  |QBF aIP;

     |ABRE #0;
     #0#7 = eaDSMAC;
     |LEE 000#0=;
     |SI FSalida ! 0;
         #0#7 = aIP;
         |LEE 000#0=;
         |SI FSalida = 0;
             #0#7 = eaDSMAC;
         |SINO;
             |DDEFECTO #0;
             #0#7 = eaDSMAC;
         |FINSI;
         |GRABA 020#0n;
         |LIBERA #0;
     |FINSI;

     #0#7 = eaDSMAC;
     |LEE 101#0=;

     |PUSHV 0501 2380;

     #0#1 = #42#31;
     #0#2 = #42#32;
     #0#3 = #42#33;
     #0#4 = #42#36;
     #0#5 = #42#34;

     |PINPA #0#0;
     |PINDA #0#0;
     |ENDATOS #1#0;
     |SI FSalida = 0;
         #42#31 = #0#1;
         #42#32 = #0#2;
         #42#33 = #0#3;
         #42#36 = #0#4;
         #42#34 = #0#5;
         |GRABA 020#42a;
         |LIBERA #42;

         |HAZ Chequeos2;

         swDefectoA = 0;
         swDefectoB = 0;
         swDefectoC = 0;
         |HAZ Chequeos3;
         |SI aMensaje = "";
              |HAZ Emitir;
         |SINO;
              |SI aMensaje = "Lugar, Fecha y Firma."
                   aMensaje = "    Es obligatorio rellenar los campos " + aMensaje;
              |SINO;
                   aMensaje = "    Es obligatorio rellenar el campo " + aMensaje;
              |FINSI;
              |MENAV aMensaje;
              |SI #42#4 = "S"; |Y #0#0 = 2;
                    aMensaje = "    La solicitud de NIF no se puede realizar telemáticamente. ";
                    aMensaje = aMensaje + "Es necesaria la impresión en PDF.";
              |FINSI;
              |MENAV aMensaje;
         |FINSI;
     |FINSI;
     |POPV;

     |PDEFECTO #0, 1, 6;
     |GRABA 020#0a;
     |LIBERA #0;
     |CIERRA #0;

     |CIERRA #42;
|FPRC;
