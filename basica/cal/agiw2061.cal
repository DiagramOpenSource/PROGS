|FICHEROS;
     agiw0061 #0,MANTE;
     agifigen #1;
     agicen26 #26,MANTE;
     agicen27 #27;
     agicen28 #28;

     agiw0100 #100;
     agiw0079;
     agiw0080;

     agimunic;
|FIN;

|VARIABLES;
     nCampo       = 0;
     nHandle      = 0;
     nAscii       = 0;
     nLongitud    = 0;
     nPos         = 0;
     nBusca       = 0;
     nCasilla     = 0;
     nEspa        = 0;
     nLong        = 0;
     nNume        = 0;
     nCas         = 0;
     nResto       = 0;
     nHay         = 0;
     nAcum        = 0;
     nSwPunto     = 0;
     nCaracter    = 0;
     nCampoD      = 0;
     nCampoH      = 0;
     nObliga      = 0;
     nPorDonde    = 0;
     nPagina      = 0;
     nSuma1       = 0;
     nSuma2       = 0;
     nSuma3       = 0;

     aCP          = "";
     aAlfa        = "";
     aAlfa0       = "";
     aAlfa1       = "";
     aAlfa2       = "";
     aAbre        = "";
     aFichero     = "";
     aOrigen      = "";
     aDestino     = "";
     aDestinoTxt  = "";
     aBasePdf     = "";
     aIP          = "";
     aLinea       = "";
     aCaracter    = "";
     aCaracterSal = "";
     aCadenaSal   = "";
     aCadena      = "";
     aLongitud    = "";
     aCampo       = "";
     aValor       = "";
     aSigla       = "";
     aArchivoPdf  = "";
     aArchivoTxt  = "";
     aBase        = "";
     aBasePatron  = "";
     aLong        = "";
     aSi          = "Sí";
     aTipo        = "";
     aRuta        = "";
     aMiCaracter  = "";
     aPathReader  = "";
     aEjecutable  = "";
     aFicheroBAT  = "";
     aUnidad      = "";
     aWait        = "";
     aDia         = "";
     aAnyo        = "";
     aMes         = "";
     aPath        = "";
     nNumero      = 0;
     nConta       = 0;
     nContaL      = 0;
     nNume1       = 0;
     nNume2       = 0;
     nNume3       = 0;
     nNume4       = 0;
     nPara1       = 0;
     nLonCampo    = 0;
     nNumCampos   = 0;
     aHoja        = "";
     fFecha       = @;
     aBlanco      = " ";
     aCero        = "0";

     {1}aVersion  = "";

     &eaVarDni  = "";
     &enCalcCif = 0;

     &eaTabla    = "";
     &eaDestino  = "";
     &eaAlfa     = "";
     &enError    = 0;
     &enComp     = 0;
     &enPosicion = 0;
     &eaUnidadBasico = "";
     &eaDSMAC        = "";
     &eaForzExplorador = "";
     &eaPathExplorador = "";
     &eaPathEmision    = "";
     &eaPathInternet   = "";
     &eaPathLanza      = "";
|FIN;

|| _________________________________________________________________________
|| PROCESOS DE LA PANTALLA
|| _________________________________________________________________________

|PROCESO TipoEmision;
     |C_M #0#6, 1, "S";
     |SI #0#0 = 2;  |C_M #0#6, 1, "N";  |FINSI;
|FPRC;

|PROCESO ExtraePath;
     aPath     = aVersion1;
     aLongitud = aPath % 0;
     nLongitud = aLongitud;
     |PARA nPos = 1; |SI nPos [ nLongitud; |HACIENDO nPos = nPos + 1;
          nCaracter = (nPos * 100) + 1;
          aCaracter = aPath % nCaracter;
          |SI aCaracter = ",";
               nPos = nLongitud - nPos;
               nPos = nPos + 100;
               nPos = (-1) * nPos;
               aPath = aPath % nPos;
               |SAL;
          |FINSI;
     |SIGUE;

     aPath = aPath - "[";
     aPath = aPath - "]";
     |QBF aPath;
     #0#6 = aPath;
     |PINTA #0#6;
|FPRC;

|PROCESO CompruebaRuta;
     |QBF aPath;
     |XABRE "CE", aPath, nHandle;
     |SI aPath = ""; |O FSalida < 0;
          |XCIERRA nHandle;
          aAlfa = "    No se ha encontrado el directorio donde esta instalado ";
          aAlfa = aAlfa + "Adobe Acrobat Reader. ";
          |MENAV aAlfa;

          aAlfa = "    Debera efectuar la instalacion manualmente.";
          |MENAV aAlfa;

          #0#6 = "";
          |PINTA #0#6;
     |FINSI;
|FPRC;

|PROCESO MensajeFallo;
     |CUADRO 1616 2166;
     |ATRI I;
     |PINTA 1717, " No se ha podido localizar  de manera automatica ";
     |PINTA 1817, " la carpeta donde esta instalado Acrobat Reader. ";
     |PINTA 1917, " Compruebe que la aplicacion esta instalada y si ";
     |PINTA 2017, "  es asi, efectue la busqueda de manera manual.  ";
     |ATRI 0;
|FPRC;

|PROCESO SacaBrowse;  |TIPO 7;
     |SI #0#0 = 2;  |ACABA;  |FINSI;

     aAlfa = #0#6;  |QBF aAlfa;
     |SI aAlfa ! "";  |Y nObliga = 0;
         |ACABA;
     |FINSI;

     aVersion1 = "AcroExch.Document";
     |ESPECIFICA "VERSION_PROGRAMA", aVersion;
     |HAZ ExtraePath;
     |SI aPath = "NO LOCALIZADO";
          aVersion1 = "AcroExch.App";
          |ESPECIFICA "VERSION_PROGRAMA", aVersion;
          |HAZ ExtraePath;
     |FINSI;

     |SI aPath ! "NO LOCALIZADO";
          |HAZ CompruebaRuta;
          nObliga = 0;
     |SINO;
          |HAZ MensajeFallo;       || se supone que no esta instalado
          |PAUSA;                  || el Acrobat
          #0#6 = "";
          |PINTA #0#6;
     |FINSI;

     aAlfa = #0#6;  |QBF aAlfa;
     |SI aAlfa ! "";  |Y nObliga = 0;
         |ACABA;
     |FINSI;

     aRuta = "F";
     |BROWSE aRuta;  |QBF aRuta;
     |SI aRuta = "F";
         |ERROR;
         |ACABA;
     |FINSI;

     #0#6 = aRuta % 280;  |PINTA #0#6;
|FPRC;

|PROCESO Browse;  |TIPO 0;
     |SI #0#0 = 2;  |ACABA;  |FINSI;

     nObliga = 1;
     |SI FSalida = 10;
        |HAZ SacaBrowse;
     |SINO;
         |SI FSalida = 11;
             aRuta = "F";
             |BROWSE aRuta;  |QBF aRuta;
             |SI aRuta = "F";
                 |ERROR;
                 |ACABA;
             |FINSI;
              #0#6 = aRuta % 280;  |PINTA #0#6;
         |FINSI;
     |FINSI;

     aAlfa = #0#6;  |QBF aAlfa;
     |SI aAlfa = "";  |HAZ SacaBrowse;  |FINSI;

     nObliga = 0;
|FPRC;

|PROCESO SacaCalidadw61;  |TIPO 7;
     |MENSA "0000 <1> Titular;  <2> Representante";
|FPRC;

|PROCESO CompruebaCalidadw61;  |TIPO 0;
     |SI #0#3 ! "1";  |Y #0#3 ! "2";
         |ERROR;
         |ACABA;
     |FINSI;

     |SI #0#3 = 1;  #0#4 = "Titular";        |FINSI;
     |SI #0#3 = 2;  #0#4 = "Representante";  |FINSI;

     |PINTA #0#4;
|FPRC;

|| _________________________________________________________________________
|| PROCESOS DE LA EMISION
|| _________________________________________________________________________

|PROCESO Conver3E2D;
     aAlfa     = (nNume + "          ") % 110;
     nPos      = 0;
     aAlfa0    = "";
     aAlfa1    = "";
     aAlfa2    = "";
     nSwPunto  = 0;

     |PARA nCaracter = 1;  |SI nCaracter [ 10;  |HACIENDO nCaracter = nCaracter + 1;
           nPos   = (100 * nCaracter) + 1;
           aAlfa0 = aAlfa % nPos;
           |SI aAlfa0 = "."; nSwPunto = 1;  |FINSI;
           |SI nSwPunto = 0;
               |SI aAlfa0 ! " "; |Y aAlfa0 ! ".";
                  aAlfa1 = aAlfa1 + aAlfa0;
               |FINSI;
           |FINSI;

           |SI nSwPunto = 1;
               |SI aAlfa0 ! " "; |Y aAlfa0 ! ".";
                   aAlfa2 = aAlfa2 + aAlfa0;
               |FINSI;
           |FINSI;
     |SIGUE;

     aAlfa = (("000" + aAlfa1) % -103) + ((aAlfa2 + "00") % 102);
|FPRC;

|PROCESO QuitaRaros;
     nEspa   = 0;
     aCadena = "";
     aLong   = aAlfa % 0;
     nLong   = aLong;
     |PARA nCampo = 1;  |SI nCampo [ aLong;  |HACIENDO nCampo = nCampo + 1;
           nPos = (100 * nCampo) + 1;
           aCaracter = aAlfa % nPos;
           |SI aCaracter = "¥";  aCaracter = &209; |FINSI;
           |SI aCaracter = "¤";  aCaracter = &209; |FINSI;
           |SI aCaracter = "§";  aCaracter = &176; |FINSI;
           |SI aCaracter = "¦";  aCaracter = &170; |FINSI;
           aCadena = aCadena + aCaracter;
     |SIGUE;
     aAlfa = aCadena;
|FPRC;

|PROCESO LeeSigla;
     eaTabla = "txtm0001.txt";
     |HAZ CargaTabla;

     eaAlfa = aSigla;
     enComp = 2;
     |HAZ CompruebaTabla;

     aSigla = eaDestino % 415;

     |HAZ FinTabla;
|FPRC;

|PROCESO CargaTemporal;
     aFichero = ("pd" + Usuario + "zzzzzzzz") % 108;
     |NOME_DAT #100 aFichero;
     |ABRE #100;  |CIERRA #100;  |DELINDEX #100;

     |ABRE #100;
     |DFICE aAbre;  |QBF aAbre;
     aAbre  = aAbre + "txtm0051.txt";
     nConta = 0;

     |XABRE "AB", aAbre, nHandle;
     |SI FSalida < 0;  |ACABA;  |FINSI;

     |PARA;  |SI;  |HACIENDO;
         |XLEE nHandle, 15, aAlfa;
         |SI  FSalida [ 0;  |SAL;  |FINSI;

         nConta = nConta + 1;

         |DDEFECTO #100;
         #100#0  = nConta;
         #100#1  = aAlfa % 113;
         |GRABA 020#100n;
         |LIBERA #100;
     |SIGUE;

     |XCIERRA nHandle;
     |CIERRA #100;
|FPRC;

|PROCESO Cabecera;
     aLinea = "%FDF-1.2";       |XGRABA nHandle, aLinea;
     aLinea = "%âãÏÓ";          |XGRABA nHandle, aLinea;
     aLinea = "1 0 obj";        |XGRABA nHandle, aLinea;
     aLinea = "<< /FDF ";       |XGRABA nHandle, aLinea;
     aLinea = "<< /Fields [ ";  |XGRABA nHandle, aLinea;
|FPRC;

|PROCESO Cambia;
     nAscii       = &aCaracter;
     aCaracterSal = aCaracter;

     |SI nAscii = 160;  aCaracterSal = "\341";  |FINSI;
     |SI nAscii = 130;  aCaracterSal = "\351";  |FINSI;
     |SI nAscii = 161;  aCaracterSal = "\355";  |FINSI;
     |SI nAscii = 162;  aCaracterSal = "\363";  |FINSI;
     |SI nAscii = 163;  aCaracterSal = "\372";  |FINSI;
     |SI nAscii = 164;  aCaracterSal = "\361";  |FINSI;
|FPRC;

|PROCESO Sustituye;
     aCadenaSal = "";
     aLongitud = aCadena % 0;
     nLongitud = aLongitud;
     |PARA nPos = 1; |SI nPos [ nLongitud; |HACIENDO nPos = nPos + 1;
          nBusca     = (nPos * 100) + 1;
          aCaracter  = aCadena % nBusca;
          |HAZ Cambia;
          aCadenaSal = aCadenaSal + aCaracterSal;
     |SIGUE;
|FPRC;

|PROCESO Lineas;
     aCampo = #100#1;  |QBF aCampo;
     aValor = #100#2;  |QBF aValor;
     |SI aValor = "";  |ACABA;  |FINSI;

     aLinea = "<< /V (" + aValor + ")/T (" + aCampo + ")>> ";
     aCadena = aLinea;
     |HAZ Sustituye;
     aLinea = aCadenaSal;
     |XGRABA nHandle, aLinea;
|FPRC;

|DEFBUCLE agiw0100;
     #100#1;
     ;
     00000;
     99999;
     ;
     NULL, Lineas;
|FIN;

|PROCESO Pie;
     aLinea = "] ";                                  |XGRABA nHandle, aLinea;
     aLinea = "/F (" + eaUnidadBasico + "/DOCUMENTOS/PDF/MOD840E.PDF)";  |XGRABA nHandle, aLinea;
     aLinea = "/ID [ ] >>";                          |XGRABA nHandle, aLinea;
     aLinea = ">> ";                                 |XGRABA nHandle, aLinea;
     aLinea = "endobj";                              |XGRABA nHandle, aLinea;
     aLinea = "trailer";                             |XGRABA nHandle, aLinea;
     aLinea = "<</Root 1 0 R >>";                    |XGRABA nHandle, aLinea;
     aLinea = "%%EOF";                               |XGRABA nHandle, aLinea;
|FPRC;

|PROCESO BuscaCaracter;
     aLongitud = aCadena % 0;
     nLongitud = aLongitud;
     |PARA nPos = 1; |SI nPos [ nLongitud; |HACIENDO nPos = nPos + 1;
          nCaracter = ((nPos * 100) + 1) * nPorDonde;
          aCaracter = aCadena % nCaracter;
          |SI aCaracter = aMiCaracter;
               |SAL;
          |FINSI;
     |SIGUE;
|FPRC;

|PROCESO ImprimePDF;
     |DBASE aBase;  |QBF aBase;
     aBasePdf    = aBase + "pdf";  |MKDIR aBasePdf;
     aBasePdf    = aBasePdf + "/";
     aBasePatron = aBase + "patrones/";

     aAbre    = aBasePdf + "mod840e.pdf";
     |XABRE "E", aAbre, nHandle;
     |SI FSalida < 0;
         aFichero   = aBasePatron + "mod036e.tgz";
         |DESCOMPRIME aFichero;

         aFichero   = aBasePatron + "mod036e.tar";
         |DETAR aFichero, aBasePdf;

         aOrigen  = aBasePatron + "mod840e.pdf";
         aDestino = aBasePdf    + "mod840e.pdf";
         |RENOMBRA_FICHERO aOrigen, aDestino;

         aOrigen  = aBasePatron + "wait.exe";
         aDestino = aBasePdf    + "wait.exe";
         |RENOMBRA_FICHERO aOrigen, aDestino;

         |FBORRA aFichero;
     |FINSI;

     |XABRE "E", aAbre, nHandle;
     |SI FSalida < 0;
         |MENAV "0000 No encuentro el PDF, pongase en contacto con su distribuidor";
         |ACABA;
     |FINSI;

     aDestino = eaUnidadBasico + "\DOCUMENTOS";     |RMKDIR aDestino;
     aDestino = aDestino + "\PDF";   |RMKDIR aDestino;
     aDestino = aDestino + "\MOD840E.PDF";
     aOrigen  = aAbre;

     |XABRE "EC", aDestino, nHandle;
     |SI FSalida < 0;
         aIP = "";
         |IP_REMOTO aIP;  |QBF aIP;
         |SI aIP ! "";
             |ENVIA_FICHERO aOrigen, aDestino;
         |SINO;
             |COPIA_FICHERO aOrigen, aDestino;
         |FINSI;
     |FINSI;

     aDestino = eaUnidadBasico + "\DOCUMENTOS";     |RMKDIR aDestino;
     aDestino = aDestino + "\PDF";   |RMKDIR aDestino;
     aDestino = aDestino + "\wait.exe";
     aOrigen  = aBasePdf + "wait.exe";

     |XABRE "EC", aDestino, nHandle;
     |SI FSalida < 0;
         aIP = "";
         |IP_REMOTO aIP;  |QBF aIP;
         |SI aIP ! "";
             |ENVIA_FICHERO aOrigen, aDestino;
         |SINO;
             |COPIA_FICHERO aOrigen, aDestino;
         |FINSI;
     |FINSI;

     aArchivoPdf = eaUnidadBasico + "\DOCUMENTOS\PDF\MOD840E.FDF";
     |XABRE "CW", aArchivoPdf, nHandle;
     |SI FSalida ] 0;
         |HAZ Cabecera;
         |BUCLE agiw0100;
         |HAZ Pie;
     |FINSI;
     |XCIERRA nHandle;

     aPathReader = #0#6;  |QBF aPathReader;
     aCadena     = aPathReader;
     aMiCaracter = "\";
     nPorDonde   = -1;
     |HAZ BuscaCaracter;
     nPos        = nPos -1;
     nPos        = nPos + 100;
     nPos        = (-1) * nPos;
     aEjecutable = aPathReader % nPos;
     aPathReader = aPathReader - aEjecutable;

     aWait       = eaUnidadBasico + "\DOCUMENTOS\PDF\wait.exe";
     aFicheroBAT = eaUnidadBasico + "\DOCUMENTOS\PDF\IMPRIME.BAT";
     |XABRE "CBW", aFicheroBAT, nHandle;
     |SI FSalida = 0;
         aAlfa   = "@echo off" + &13 + &10;  |XGRABA nHandle, aAlfa;
         aUnidad = aPathReader % 102;
         aAlfa   = aUnidad + &13 + &10;      |XGRABA nHandle, aAlfa;
         aAlfa   = "cd " + &34 + aPathReader + &34 + &13 + &10;
         aAlfa   = aAlfa - aUnidad;          |XGRABA nHandle, aAlfa;
         aAlfa   = aWait + " " + aEjecutable;
         aAlfa   = aAlfa + " " + aArchivoPdf + &13 + &10;
                                             |XGRABA nHandle, aAlfa;
     |FINSI;
     |XCIERRA nHandle;

     |RSYSTEM aFicheroBAT;

     |RFBORRA aFicheroBAT;
     |RFBORRA aArchivoPdf;

     |DELINDEX #100;
|FPRC;
/*
|PROCESO AbreFichero;
     aArchivoTxt = eaUnidadBasico + "\AEAT";                   |RMKDIR aArchivoTxt;
     aArchivoTxt = aArchivoTxt + "\INTERNET";                  |RMKDIR aArchivoTxt;
     aArchivoTxt = aArchivoTxt + "\840";                       |RMKDIR aArchivoTxt;
     aArchivoTxt = aArchivoTxt + "\M" + (("00000" + #26#0) % -105) + (("00" + #26#1) % -102) + ".TXT";

     |DFICE aBase;
     aAlfa = aBase +  "M" + (("00000" + #26#0) % -105) + (("00" + #26#1) % -102) + ".TXT";

     |XABRE "BW", aAlfa, nHandle;
|FPRC;
*/

|PROCESO AbreFichero;
     eaPathInternet = eaUnidadBasico + "\AEAT";                    |RMKDIR eaPathInternet;
     eaPathInternet = eaPathInternet + "\INTERNET";                |RMKDIR eaPathInternet;
     eaPathInternet = eaPathInternet + "\840";                     |RMKDIR eaPathInternet;
     eaPathInternet = eaPathInternet + "\";

 |SI #0#0 = 1;
     eaPathLanza = eaUnidadBasico + "\AEAT";                    |RMKDIR eaPathLanza;
     eaPathLanza = eaPathLanza + "\840";                        |RMKDIR eaPathLanza;
     eaPathLanza = eaPathLanza + "\";

     aAlfa = eaPathLanza + "*.bat";
     |R_PDIR aAlfa;
     |PARA;  |SI FSalida = 0;  |HACIENDO;
          |RFBORRA aAlfa;

          |R_SDIR aAlfa;
     |SIGUE;
     aAlfa = eaPathLanza + "*.txt";
     |R_PDIR aAlfa;
     |PARA;  |SI FSalida = 0;  |HACIENDO;
          |RFBORRA aAlfa;

          |R_SDIR aAlfa;
     |SIGUE;
 |FINSI;

     |DBASE eaPathEmision;
     eaPathEmision = eaPathEmision + "emisiones";                     |MKDIR eaPathEmision;
     eaPathEmision = eaPathEmision + "/840";                          |MKDIR eaPathEmision;
     eaPathEmision = eaPathEmision + "/";

     aArchivoTxt = "M" + (("00000" + #26#0) % -105) + (("00" + #26#1) % -102) + ".txt";

     |SI #0#0 = 2;
         aAlfa = eaPathInternet + aArchivoTxt;
         |RFBORRA aAlfa;
     |FINSI;

     aAlfa = eaPathEmision + aArchivoTxt;
     |FBORRA aAlfa;

     |XABRE "BW", aAlfa, nHandle;
|FPRC;

|PROCESO CierraFichero;
     |XCIERRA nHandle;

     |SI #0#0 = 1;
         aDestino = eaPathLanza;
     |SINO;
         aDestino = eaPathInternet;
     |FINSI;

     aDestino    = aDestino + aArchivoTxt;
     aOrigen     = eaPathEmision + aArchivoTxt;

     aIP = "";
     |IP_REMOTO aIP;  |QBF aIP;
     |SI aIP ! "";
         |ENVIA_FICHERO aOrigen, aDestino;
     |SINO;
         |COPIA_FICHERO aOrigen, aDestino;
     |FINSI;

     aDestinoTxt  = aDestino;
     |SI #0#0 = 2;
         aAlfa = "0000 El fichero generado está en: " + eaPathInternet + " de su PC";
         |MENAV aAlfa;
     |FINSI;
|FPRC;

|| //////////////////////////////////////////
|PROCESO GrabaPdf;
    aAlfa  = aValor;  |HAZ QuitaRaros;
    |QBF aValor;

    #100#0 = nCasilla;
    |LEE 101#100=;
    |SI FSalida = 0;
        #100#2 = aAlfa;
        |GRABA 020#100a;
        |LIBERA #100;
    |FINSI;
|FPRC;

|PROCESO DesFecha;
     aDia  = aAlfa % 102;
     aAnyo = aAlfa % -104;
     aMes  = aAlfa % 402;

     |SI aMes = "01";  aMes = "ENERO     ";  |FINSI;
     |SI aMes = "02";  aMes = "FEBRERO   ";  |FINSI;
     |SI aMes = "03";  aMes = "MARZO     ";  |FINSI;
     |SI aMes = "04";  aMes = "ABRIL     ";  |FINSI;
     |SI aMes = "05";  aMes = "MAYO      ";  |FINSI;
     |SI aMes = "06";  aMes = "JUNIO     ";  |FINSI;
     |SI aMes = "07";  aMes = "JULIO     ";  |FINSI;
     |SI aMes = "08";  aMes = "AGOSTO    ";  |FINSI;
     |SI aMes = "09";  aMes = "SEPTIEMBRE";  |FINSI;
     |SI aMes = "10";  aMes = "OCTUBRE   ";  |FINSI;
     |SI aMes = "11";  aMes = "NOVIEMBRE ";  |FINSI;
     |SI aMes = "12";  aMes = "DICIEMBRE ";  |FINSI;
|FPRC;

|PROCESO ElMunicipio;
     aAlfa = "     ";
     |ABRE #agimunic;
     |SELECT #4#agimunic;
     #agimunic#0 = aCP;
     |LEE 041#agimunic.=;
     |SI FSalida = 0;
         aAlfa = ("00000" + #agimunic#1) % -105;
     |FINSI;
     |SELECT #1#agimunic;
     |CIERRA #agimunic;
|FPRC;

|PROCESO CompletaAlfa;

     |SI #agiw0080#0= "1 ";
         |SI nNumero = 63; |O nNumero = 66; |O nNumero = 69;
             |ACABA;
         |FINSI;
     |FINSI;

     |SI #agiw0080#3 = "F";
         fFecha = aAlfa;
         |SI fFecha > "01.01.1900";
             aAlfa1 = (aAlfa % 102) + (aAlfa % 402) + (aAlfa % 704);
         |SINO;
             aAlfa1 = "00000000";
         |FINSI;
         aAlfa  = aAlfa1;
         |ACABA;
     |FINSI;

     |SI #agiw0080#3 = "D";
         nNume2 = aAlfa;
         nNume2 = (nNume2 * 100) ! 0;
         aAlfa  = nNume2;
     |FINSI;

     |QBF aAlfa;
     aAlfa1 = aAlfa % 0;
     nNume2 = aAlfa1;
     nNume3 = #agiw0080#4;
     nNume4 = nNume3 - nNume2;
     |SI nNume4 > 0;
         |SI #agiw0080#3 = "N"; |O #agiw0080#3 = "D";
             aAlfa = (aCero * nNume4) + aAlfa;
         |FINSI;
         |SI #agiw0080#3 = "A";
             aAlfa = aAlfa + (aBlanco * nNume4);
         |FINSI;
         |SI #agiw0080#3 = "B";
             |SI aAlfa = ""; |O aAlfa = "0";
                 |SI aAlfa = "0"; nNume4 = nNume4 + 1; |FINSI;
                 aAlfa = (aBlanco * nNume4);
             |SINO;
                 aAlfa = (aCero * nNume4) + aAlfa;
             |FINSI;
         |FINSI;
     |FINSI;
     |SI nNume4 < 0;
         nNume3 = 100 + nNume3;
         aAlfa = aAlfa % nNume3;
     |FINSI;
|FPRC;

|PROCESO Excep_3;

     |SI nContaL = 1;
         |SI nNumero = 1; aAlfa = "<T840030>"; |FINSI;
         |SI nNumero = 2;
             |SI nPagina = 1;  aAlfa = " "; |FINSI;
             |SI nPagina > 1;  aAlfa = "C"; |FINSI;
         |FINSI;
     |FINSI;

     |SI nNumero = 11;
         aAlfa = (("00" + #agicen28#11) % -102) + (("000" + #agicen28#12) % -103);
     |FINSI;

     |SI nNumero = 13;
         aCP = (("00" + #agicen28#11) % -102) + (("000" + #agicen28#12) % -103);
         |HAZ ElMunicipio;
     |FINSI;

     |SI nNumero = 156; |O nNumero = 157; |O nNumero = 158;
         #agiw0080#3 = "D";
         #agiw0080#4 = 7;
         |SI nNumero = 156; aAlfa = nSuma1; |FINSI;
         |SI nNumero = 157; aAlfa = nSuma2; |FINSI;
         |SI nNumero = 158; aAlfa = nSuma3; |FINSI;
         |HAZ CompletaAlfa;
     |FINSI;

     |SI nNumero = 159;
         aAlfa = aBlanco * 25;
     |FINSI;

     |SI nNumero = 160;
         aAlfa = "00000000";
     |FINSI;

     |SI nNumero = 163;
         aAlfa = " ";
     |FINSI;

     |SI nNumero = 164; aAlfa = "</T840030>";  |FINSI;
     |SI nNumero = 165; aAlfa = &13 + &10;     |FINSI;
|FPRC;

|PROCESO Excep_2;
     |SI nNumero = 1; aAlfa = "<T840020>"; |FINSI;
     |SI nNumero = 2; aAlfa = " "; |FINSI;

     |SI nNumero = 103;
         aAlfa = #0#1 % 0125;
     |FINSI;

     |SI nNumero = 104;
         aAlfa = #0#2;
         |SI #0#2 > "01.01.1900";
             aAlfa1 = (aAlfa % 102) + (aAlfa % 402) + (aAlfa % 704);
         |SINO;
             aAlfa1 = "00000000";
         |FINSI;
         aAlfa  = aAlfa1;
     |FINSI;

     |SI nNumero = 107;
         aAlfa = " ";
         |SI #0#3 = "1";  aAlfa = "T"; |FINSI;
         |SI #0#3 = "2";  aAlfa = "R"; |FINSI;
     |FINSI;

     |SI nNumero = 109; aAlfa = "</T840020>";  |FINSI;
     |SI nNumero = 110; aAlfa = &13 + &10;     |FINSI;
|FPRC;

|PROCESO Excep_1;
     |SI nNumero = 1; aAlfa = "<T840010>"; |FINSI;
     |SI nNumero = 2; aAlfa = " "; |FINSI;

     |SI nNumero = 4;
         aAlfa = "   ";
         |SI #agifigen#64 ! 0;
             aAlfa = ("000" + #agifigen#64) % -103;
         |FINSI;
         aAlfa = aAlfa + (#agifigen#92 % 120);
     |FINSI;

     |SI nNumero = 15;
         aCP = (("00" + #agifigen#9) % -102) + (("000" + #agifigen#10) % -103);
         |HAZ ElMunicipio;
     |FINSI;

     |SI nNumero = 18;
         aAlfa = (("00" + #agifigen#9) % -102) + (("000" + #agifigen#10) % -103);
     |FINSI;

     |SI nNumero = 21;
         aAlfa = " ";
         |SI #agicen27#3  = "S";  aAlfa = "1"; |FINSI;
         |SI #agicen27#4  = "S";  aAlfa = "2"; |FINSI;
         |SI #agicen27#5  = "S";  aAlfa = "3"; |FINSI;
         |SI #agicen27#6  = "S";  aAlfa = "4"; |FINSI;
         |SI #agicen27#7  = "S";  aAlfa = "5"; |FINSI;
         |SI #agicen27#8  = "S";  aAlfa = "6"; |FINSI;
         |SI #agicen27#9  = "S";  aAlfa = "7"; |FINSI;
         |SI #agicen27#10 = "S";  aAlfa = "8"; |FINSI;
         |SI #agicen27#11 = "S";  aAlfa = "9"; |FINSI;
     |FINSI;

     |SI nNumero = 34;
         aAlfa = (("00" + #agicen27#23) % -102) + (("000" + #agicen27#24) % -103);
     |FINSI;

     |SI nNumero = 36;
         aCP = (("00" + #agicen27#23) % -102) + (("000" + #agicen27#24) % -103);
         |HAZ ElMunicipio;
     |FINSI;

     |SI nNumero = 48;
         aCP = (("00" + #agicen27#42) % -102) + (("000" + #agicen27#43) % -103);
         |HAZ ElMunicipio;
     |FINSI;

     |SI nNumero = 54;
         aAlfa = (("00" + #agicen27#42) % -102) + (("000" + #agicen27#43) % -103);
     |FINSI;

     |SI nNumero = 74;
         aAlfa = " ";
         |SI #agicen27#50 = "S"; aAlfa = "4"; |FINSI;
         |SI #agicen27#51 = "S"; aAlfa = "7"; |FINSI;
     |FINSI;

     |SI nNumero = 89;
         aAlfa = (("00" + #agicen27#72) % -102) + (("000" + #agicen27#73) % -103);
     |FINSI;

     |SI nNumero = 91;
         aCP = (("00" + #agicen27#72) % -102) + (("000" + #agicen27#73) % -103);
         |HAZ ElMunicipio;
     |FINSI;

     |SI nNumero = 105; aAlfa = "</T840010>";  |FINSI;
     |SI nNumero = 106; aAlfa = &13 + &10;     |FINSI;
|FPRC;

|PROCESO Agiw0080F;
   nNume1 = nNume1 + 1;
   |SI nNume1 [ nNumCampos;
       |PARA nNumero = nNume1; |SI nNumero [ nNumCampos; |HACIENDO nNumero = nNumero + 1;
             aAlfa   = "";
             |SI aHoja = "1 "; |HAZ Excep_1;  |FINSI;
             |SI aHoja = "2 "; |HAZ Excep_2;  |FINSI;
             |SI aHoja = "3 "; |HAZ Excep_3;  |FINSI;
             |SI aAlfa ! "";
                 |HAZ QuitaRaros;
                 |XGRABA nHandle, aAlfa;
             |FINSI;
       |SIGUE;
   |FINSI;
|FPRC;

|PROCESO Agiw0080C;
   nNume1 = nNume1 + 1;
   nConta = #agiw0080#1;

   |PARA nNumero = nNume1; |SI nNumero [ nConta; |HACIENDO nNumero = nNumero + 1;

         aAlfa   = "";
         |SI nConta = nNumero;   || Campo del Fichero
             nCampo = #agiw0080#2;

             |SI #agiw0080#5 = "F";  aAlfa = "";                |FINSI;
             |SI #agiw0080#5 = "X";  aAlfa = #agifigen#nCampo#; |FINSI;

             |SI #agiw0080#5= " ";

                 |SI #agiw0080#0= "1 ";
                     aAlfa = #agicen27#nCampo#;
                     |SI nConta = 43;
                         |SI aAlfa = "1"; aAlfa = "E"; |FINSI;
                         |SI aAlfa = "2"; aAlfa = "P"; |FINSI;
                         |SI aAlfa = "3"; aAlfa = "A"; |FINSI;
                     |FINSI;
                     |SI nConta = 82;
                         |SI #agicen27#5 = " "; |Y #agicen27#6 = " ";
                             aAlfa = " ";
                         |FINSI;
                     |FINSI;
                     |SI nConta = 83;
                         aAlfa = aAlfa % 2;
                         |SI #agicen27#7 = " "; |Y #agicen27#8 = " ";
                            |Y #agicen27#9 = " "; |Y #agicen27#10 = " ";
                             aAlfa = " ";
                         |FINSI;
                     |FINSI;
                     |SI nConta = 88;
                         aAlfa = #agicen27#61 + aAlfa;
                     |FINSI;
                 |FINSI;

                 |SI #agiw0080#0= "2 ";
                     aAlfa = #agicen27#nCampo#;
                     |SI nConta = 4; |O nConta = 8;
                         |O nConta = 12; |O nConta = 16;
                            |O nConta = 20; |O nConta = 24;
                               |O nConta = 28; |O nConta = 32;
                          nCampo = nCampo - 1;
                          |SI #agicen27#nCampo# = 0;
                              aAlfa1 = "  ";
                          |SINO;
                              aAlfa1 = ("00" + #agicen27#nCampo#) % -102;
                          |FINSI;
                          aAlfa = aAlfa1 + aAlfa;
                     |FINSI;
                 |FINSI;
                 |SI #agiw0080#0= "3 ";
                     aAlfa = #agicen28#nCampo#;
                 |FINSI;
             |FINSI;
             |HAZ CompletaAlfa;
         |SINO;
             |SI #agiw0080#0 = "1 ";   |HAZ Excep_1;  |FINSI;
             |SI #agiw0080#0 = "2 ";   |HAZ Excep_2;  |FINSI;
             |SI #agiw0080#0 = "3 ";   |HAZ Excep_3;  |FINSI;
         |FINSI;
         |SI aAlfa ! "";
             |HAZ QuitaRaros;
             |XGRABA nHandle, aAlfa;
         |FINSI;
   |SIGUE;
   nNume1 = #agiw0080#1;
|FPRC;

|DEFBUCLE Agiw0080;
  #agiw0080#1;
  ;
  aHoja, 001;
  aHoja, nNumCampos;
  ;
  NULL, Agiw0080C, NULL, NULL, Agiw0080F;
|FIN;


|PROCESO Hoja1Txt;
     |ABRE #1;
     #1#0 = #26#0;
     |LEE 040#1=;
     |SI FSalida ! 0;  |DDEFECTO #1;  |FINSI;
     |CIERRA #1;

     aHoja      = "1 ";
     nNume1     = 0;
     nNumCampos = 106;
     |BUCLE Agiw0080;
|FPRC;

|PROCESO Hoja2Txt;
     |ABRE #1;
     #1#0 = #26#0;
     |LEE 040#1=;
     |SI FSalida ! 0;  |DDEFECTO #1;  |FINSI;
     |CIERRA #1;

     aHoja      = "2 ";
     nNume1     = 0;
     nNumCampos = 110;
     |BUCLE Agiw0080;
|FPRC;

|PROCESO agicen28Txt;
     nContaL = nContaL + 1;
     |SI nContaL > 9;
         nContaL  = 1;
         nPagina  = nPagina + 1;
     |FINSI;

     aHoja      = "3 ";
     nNume1     = 0;
     nNumCampos = 19;
     |BUCLE Agiw0080;

     nSuma1   = nSuma1 + #28#48;
     nSuma2   = nSuma2 + #28#49;
     nSuma3   = nSuma3 + #28#50;

     |SI nContaL = 9;
         aHoja      = "3 ";
         nNume1     = 155;
         nNumCampos = 165;
         |HAZ Agiw0080F;
     |FINSI;
|FPRC;

|PROCESO agicen28Todo;
     |SI #0#0 = 1;  |HAZ agicen28;     |FINSI;
     |SI #0#0 = 2;  |HAZ agicen28Txt;  |FINSI;
|FPRC;

|DEFBUCLE agicen28;
     #28#1;
     ;
     #27#0, #27#1, #27#2, 01;
     #27#0, #27#1, #27#2, 99;
     ;
     NULL, agicen28Todo;
|FIN;

|PROCESO Hoja3Txt;
      nPagina = 1;
      nContaL = 0;
      nSuma1  = 0;
      nSuma2  = 0;
      nSuma3  = 0;
      |BUCLE agicen28;

      |SI nContaL ! 9;
          |PARA nPara1 = nContaL; |SI nPara1 [ 8; |HACIENDO nPara1 = nPara1 + 1;
                |DDEFECTO #agicen28;
                #28#0 = #27#0;
                #28#1 = #27#1;
                #28#2 = #27#2;
                |HAZ agicen28Txt;
          |SIGUE;
      |FINSI;
|FPRC;

|PROCESO Hoja1;
     |ABRE #1;
     #1#0 = #26#0;
     |LEE 040#1=;
     |SI FSalida ! 0;  |DDEFECTO #1;  |FINSI;
     |CIERRA #1;

      nCasilla = 1;     aValor = #1#91;            |HAZ GrabaPdf;
      nCasilla = 2;     aValor = #1#92;            |HAZ GrabaPdf;
      nCasilla = 3;     aValor = (("00" + #1#63) % -102) + (("000" + #1#64) % -103);
                                                   |HAZ GrabaPdf;

      nCasilla = 5;     aValor = #1#13;            |HAZ GrabaPdf;
      nCasilla = 32;    aValor = #1#1;             |HAZ GrabaPdf;
      nCasilla = 33;    aValor = #1#3;             |HAZ GrabaPdf;
      nCasilla = 34;    aValor = #1#4;             |HAZ GrabaPdf;
      nCasilla = 35;    aValor = #1#5;             |HAZ GrabaPdf;
      nCasilla = 37;    aValor = #1#6;             |HAZ GrabaPdf;
      nCasilla = 38;    aValor = #1#7;             |HAZ GrabaPdf;
      nCasilla = 39;    aValor = #1#8;             |HAZ GrabaPdf;
      nCasilla = 40;    aValor = #1#11;            |HAZ GrabaPdf;
      nCasilla = 41;    aValor = #1#12;            |HAZ GrabaPdf;
      nCasilla = 42;    aValor = (("00" + #1#9) % -102) + (("000" + #1#10) % -103);
                                                   |HAZ GrabaPdf;
      nCasilla = 43;    aValor = #1#14;            |HAZ GrabaPdf;

      nCasilla = 31;    aValor = #27#149;          |HAZ GrabaPdf;

      |SI #27#3  = "S";  nCasilla = 6;  aValor = aSi;  |HAZ GrabaPdf;  |FINSI;
      |SI #27#4  = "S";  nCasilla = 7;  aValor = aSi;  |HAZ GrabaPdf;  |FINSI;
      |SI #27#5  = "S";  nCasilla = 8;  aValor = aSi;  |HAZ GrabaPdf;  |FINSI;
      |SI #27#6  = "S";  nCasilla = 9;  aValor = aSi;  |HAZ GrabaPdf;  |FINSI;
      |SI #27#7  = "S";  nCasilla = 10; aValor = aSi;  |HAZ GrabaPdf;  |FINSI;
      |SI #27#8  = "S";  nCasilla = 11; aValor = aSi;  |HAZ GrabaPdf;  |FINSI;
      |SI #27#9  = "S";  nCasilla = 12; aValor = aSi;  |HAZ GrabaPdf;  |FINSI;
      |SI #27#10 = "S";  nCasilla = 13; aValor = aSi;  |HAZ GrabaPdf;  |FINSI;
      |SI #27#11 = "S";  nCasilla = 14; aValor = aSi;  |HAZ GrabaPdf;  |FINSI;

      nCasilla = 4;     aValor = #27#13;           |HAZ GrabaPdf;
      nCasilla = 44;    aValor = #27#14;           |HAZ GrabaPdf;
      nCasilla = 45;    aValor = #27#15;           |HAZ GrabaPdf;
      nCasilla = 46;    aValor = #27#16;           |HAZ GrabaPdf;
      nCasilla = 48;    aValor = #27#17;           |HAZ GrabaPdf;
      nCasilla = 49;    aValor = #27#18;           |HAZ GrabaPdf;
      nCasilla = 50;    aValor = #27#19;           |HAZ GrabaPdf;
      nCasilla = 51;    aValor = #27#20;           |HAZ GrabaPdf;
      nCasilla = 52;    aValor = #27#21;           |HAZ GrabaPdf;
      nCasilla = 53;    aValor = #27#22;           |HAZ GrabaPdf;

                        aValor = (("00" + #27#23) % -102) + (("000" + #27#24) % -103);
      |SI aValor ! "00000";  nCasilla = 54;        |HAZ GrabaPdf;  |FINSI;

      nCasilla = 55;    aValor = #27#25;           |HAZ GrabaPdf;
      nCasilla = 57;    aValor = #27#26;           |HAZ GrabaPdf;

      |SI #27#27 = "M";  nCasilla = 15; aValor = aSi;  |HAZ GrabaPdf;  |FINSI;
      |SI #27#27 = "N";  nCasilla = 16; aValor = aSi;  |HAZ GrabaPdf;  |FINSI;
      |SI #27#27 = "P";  nCasilla = 17; aValor = aSi;  |HAZ GrabaPdf;  |FINSI;

      nCasilla = 360;    aValor = #27#151;         |HAZ GrabaPdf;

      |SI #27#28 = "1";  nCasilla = 18; aValor = aSi;  |HAZ GrabaPdf;  |FINSI;
      |SI #27#28 = "2";  nCasilla = 19; aValor = aSi;  |HAZ GrabaPdf;  |FINSI;
      |SI #27#28 = "3";  nCasilla = 20; aValor = aSi;  |HAZ GrabaPdf;  |FINSI;

      |SI #27#30 = "S";  nCasilla = 21; aValor = aSi;  |HAZ GrabaPdf;  |FINSI;

      nCasilla = 60;    aValor = #27#32;           |HAZ GrabaPdf;
      nCasilla = 61;    aValor = #27#31;           |HAZ GrabaPdf;
      nCasilla = 62;    aValor = #27#44;           |HAZ GrabaPdf;
      nCasilla = 64;    aValor = #27#45;           |HAZ GrabaPdf;
      nCasilla = 66;    aValor = #27#33;           |HAZ GrabaPdf;
      nCasilla = 67;    aValor = #27#34;           |HAZ GrabaPdf;

                        aValor = (("00" + #27#42) % -102) + (("000" + #27#43) % -103);
      |SI aValor ! "00000";  nCasilla = 68;        |HAZ GrabaPdf;  |FINSI;

      nCasilla = 70;    aValor = #27#35;           |HAZ GrabaPdf;
      nCasilla = 71;    aValor = #27#36;           |HAZ GrabaPdf;
      nCasilla = 72;    aValor = #27#37;           |HAZ GrabaPdf;
      nCasilla = 73;    aValor = #27#38;           |HAZ GrabaPdf;
      nCasilla = 74;    aValor = #27#39;           |HAZ GrabaPdf;
      nCasilla = 75;    aValor = #27#40;           |HAZ GrabaPdf;
      nCasilla = 76;    aValor = #27#41;           |HAZ GrabaPdf;
      nCasilla = 77;    aValor = #27#46;           |HAZ GrabaPdf;
      nCasilla = 78;    aValor = #27#47;           |HAZ GrabaPdf;
      nCasilla = 79;    aValor = #27#48;           |HAZ GrabaPdf;

      |SI #27#49 = "S";  nCasilla = 22; aValor = aSi;  |HAZ GrabaPdf;  |FINSI;
      |SI #27#50 = "S";  nCasilla = 23; aValor = aSi;  |HAZ GrabaPdf;  |FINSI;
      |SI #27#51 = "S";  nCasilla = 24; aValor = aSi;  |HAZ GrabaPdf;  |FINSI;

      nCasilla = 80;    aValor = #27#52;           |HAZ GrabaPdf;
      nCasilla = 81;    aValor = #27#53;           |HAZ GrabaPdf;
      nCasilla = 82;    aValor = #27#54;           |HAZ GrabaPdf;
      nCasilla = 83;    aValor = #27#55;           |HAZ GrabaPdf;
      |SI #27#56 ! "01.01.0000";
          nCasilla = 84;    aValor = #27#56;           |HAZ GrabaPdf;
      |FINSI;
      nCasilla = 85;    aValor = #27#57;           |HAZ GrabaPdf;
      nCasilla = 86;    aValor = #27#58;           |HAZ GrabaPdf;
      nCasilla = 87;    aValor = #27#59;           |HAZ GrabaPdf;
      nCasilla = 88;    aValor = #27#60;           |HAZ GrabaPdf;
      nCasilla = 89;    aValor = #27#12;           |HAZ GrabaPdf;
      nCasilla = 90;    aValor = #27#61;           |HAZ GrabaPdf;

                        aValor = (("00" + #27#72) % -102) + (("000" + #27#73) % -103);
      |SI aValor ! "00000";  nCasilla = 91;        |HAZ GrabaPdf;  |FINSI;

      nCasilla = 92;    aValor = #27#74;           |HAZ GrabaPdf;
      nCasilla = 94;    aValor = #27#75;           |HAZ GrabaPdf;
      nCasilla = 96;    aValor = #27#63;           |HAZ GrabaPdf;
      nCasilla = 97;    aValor = #27#64;           |HAZ GrabaPdf;
      nCasilla = 99;    aValor = #27#65;           |HAZ GrabaPdf;
      nCasilla = 100;   aValor = #27#66;           |HAZ GrabaPdf;
      nCasilla = 101;   aValor = #27#67;           |HAZ GrabaPdf;
      nCasilla = 102;   aValor = #27#68;           |HAZ GrabaPdf;
      nCasilla = 103;   aValor = #27#69;           |HAZ GrabaPdf;
      nCasilla = 104;   aValor = #27#70;           |HAZ GrabaPdf;
      nCasilla = 105;   aValor = #27#71;           |HAZ GrabaPdf;
|FPRC;

|PROCESO Hoja2;
      |SI #27#78  ! 0; nCasilla = 107; aValor = #27#78;  |HAZ GrabaPdf; |FINSI;
      |SI #27#81  ! 0; nCasilla = 110; aValor = #27#81;  |HAZ GrabaPdf; |FINSI;
      |SI #27#84  ! 0; nCasilla = 113; aValor = #27#84;  |HAZ GrabaPdf; |FINSI;
      |SI #27#87  ! 0; nCasilla = 116; aValor = #27#87;  |HAZ GrabaPdf; |FINSI;
      |SI #27#90  ! 0; nCasilla = 119; aValor = #27#90;  |HAZ GrabaPdf; |FINSI;
      |SI #27#93  ! 0; nCasilla = 122; aValor = #27#93;  |HAZ GrabaPdf; |FINSI;
      |SI #27#96  ! 0; nCasilla = 125; aValor = #27#96;  |HAZ GrabaPdf; |FINSI;
      |SI #27#99  ! 0; nCasilla = 128; aValor = #27#99;  |HAZ GrabaPdf; |FINSI;
      |SI #27#100 ! 0; nCasilla = 132; aValor = #27#100; |HAZ GrabaPdf; |FINSI;
      |SI #27#101 ! 0; nCasilla = 135; aValor = #27#101; |HAZ GrabaPdf; |FINSI;
      |SI #27#102 ! 0; nCasilla = 138; aValor = #27#102; |HAZ GrabaPdf; |FINSI;

      |SI #27#103 ! 0; nCasilla = 142; aValor = #27#103; |HAZ GrabaPdf; |FINSI;
      |SI #27#104 ! 0; nCasilla = 143; aValor = #27#104; |HAZ GrabaPdf; |FINSI;
      |SI #27#105 ! 0; nCasilla = 144; aValor = #27#105; |HAZ GrabaPdf; |FINSI;
      |SI #27#106 ! 0; nCasilla = 145; aValor = #27#106; |HAZ GrabaPdf; |FINSI;
      |SI #27#107 ! 0; nCasilla = 146; aValor = #27#107; |HAZ GrabaPdf; |FINSI;
      |SI #27#108 ! 0; nCasilla = 147; aValor = #27#108; |HAZ GrabaPdf; |FINSI;
      |SI #27#109 ! 0; nCasilla = 148; aValor = #27#109; |HAZ GrabaPdf; |FINSI;
      |SI #27#110 ! 0; nCasilla = 149; aValor = #27#110; |HAZ GrabaPdf; |FINSI;
      |SI #27#111 ! 0; nCasilla = 150; aValor = #27#111; |HAZ GrabaPdf; |FINSI;
      |SI #27#112 ! 0; nCasilla = 151; aValor = #27#112; |HAZ GrabaPdf; |FINSI;
      |SI #27#113 ! 0; nCasilla = 152; aValor = #27#113; |HAZ GrabaPdf; |FINSI;
      |SI #27#114 ! 0; nCasilla = 153; aValor = #27#114; |HAZ GrabaPdf; |FINSI;
      |SI #27#115 ! 0; nCasilla = 154; aValor = #27#115; |HAZ GrabaPdf; |FINSI;
      |SI #27#116 ! 0; nCasilla = 155; aValor = #27#116; |HAZ GrabaPdf; |FINSI;
      |SI #27#117 ! 0; nCasilla = 156; aValor = #27#117; |HAZ GrabaPdf; |FINSI;
      |SI #27#118 ! 0; nCasilla = 157; aValor = #27#118; |HAZ GrabaPdf; |FINSI;
      |SI #27#119 ! 0; nCasilla = 158; aValor = #27#119; |HAZ GrabaPdf; |FINSI;
      |SI #27#120 ! 0; nCasilla = 159; aValor = #27#120; |HAZ GrabaPdf; |FINSI;
      |SI #27#121 ! 0; nCasilla = 160; aValor = #27#121; |HAZ GrabaPdf; |FINSI;
      |SI #27#122 ! 0; nCasilla = 161; aValor = #27#122; |HAZ GrabaPdf; |FINSI;
      |SI #27#123 ! 0; nCasilla = 162; aValor = #27#123; |HAZ GrabaPdf; |FINSI;
      |SI #27#124 ! 0; nCasilla = 163; aValor = #27#124; |HAZ GrabaPdf; |FINSI;
      |SI #27#125 ! 0; nCasilla = 164; aValor = #27#125; |HAZ GrabaPdf; |FINSI;
      |SI #27#126 ! 0; nCasilla = 165; aValor = #27#126; |HAZ GrabaPdf; |FINSI;
      |SI #27#127 ! 0; nCasilla = 166; aValor = #27#127; |HAZ GrabaPdf; |FINSI;
      |SI #27#128 ! 0; nCasilla = 167; aValor = #27#128; |HAZ GrabaPdf; |FINSI;
      |SI #27#129 ! 0; nCasilla = 168; aValor = #27#129; |HAZ GrabaPdf; |FINSI;
      |SI #27#130 ! 0; nCasilla = 169; aValor = #27#130; |HAZ GrabaPdf; |FINSI;
      |SI #27#131 ! 0; nCasilla = 170; aValor = #27#131; |HAZ GrabaPdf; |FINSI;
      |SI #27#132 ! 0; nCasilla = 171; aValor = #27#132; |HAZ GrabaPdf; |FINSI;
      |SI #27#133 ! 0; nCasilla = 172; aValor = #27#133; |HAZ GrabaPdf; |FINSI;
      |SI #27#134 ! 0; nCasilla = 173; aValor = #27#134; |HAZ GrabaPdf; |FINSI;
      |SI #27#135 ! 0; nCasilla = 174; aValor = #27#135; |HAZ GrabaPdf; |FINSI;
      |SI #27#136 ! 0; nCasilla = 178; aValor = #27#136; |HAZ GrabaPdf; |FINSI;
      |SI #27#137 ! 0; nCasilla = 179; aValor = #27#137; |HAZ GrabaPdf; |FINSI;
      |SI #27#138 ! 0; nCasilla = 180; aValor = #27#138; |HAZ GrabaPdf; |FINSI;
      |SI #27#139 ! 0; nCasilla = 181; aValor = #27#139; |HAZ GrabaPdf; |FINSI;
      |SI #27#140 ! 0; nCasilla = 182; aValor = #27#140; |HAZ GrabaPdf; |FINSI;
      |SI #27#141 ! 0; nCasilla = 186; aValor = #27#141; |HAZ GrabaPdf; |FINSI;
      |SI #27#142 ! 0; nCasilla = 187; aValor = #27#142; |HAZ GrabaPdf; |FINSI;
      |SI #27#143 ! 0; nCasilla = 188; aValor = #27#143; |HAZ GrabaPdf; |FINSI;
      |SI #27#144 ! 0; nCasilla = 189; aValor = #27#144; |HAZ GrabaPdf; |FINSI;

      aAlfa = #0#2;
      |HAZ DesFecha;

      nCasilla = 201;   aValor = #0#1;   |HAZ GrabaPdf;
      nCasilla = 202;   aValor = aDia;   |HAZ GrabaPdf;
      nCasilla = 203;   aValor = aMes;   |HAZ GrabaPdf;
      nCasilla = 204;   aValor = aAnyo;  |HAZ GrabaPdf;

      |SI #0#3 = "1";  nCasilla = 25; aValor = aSi;  |HAZ GrabaPdf;  |FINSI;
      |SI #0#3 = "2";  nCasilla = 26; aValor = aSi;  |HAZ GrabaPdf;  |FINSI;
|FPRC;

|PROCESO agicen28;
     nConta = nConta + 1;
     |SI nConta > 9;
         nConta  = 1;
         nPagina = nPagina + 1;
         |ACABA;
     |FINSI;

     |SI nConta = 1;  nCasilla = 209;  |FINSI;
     |SI nConta = 2;  nCasilla = 225;  |FINSI;
     |SI nConta = 3;  nCasilla = 241;  |FINSI;
     |SI nConta = 4;  nCasilla = 257;  |FINSI;
     |SI nConta = 5;  nCasilla = 273;  |FINSI;
     |SI nConta = 6;  nCasilla = 289;  |FINSI;
     |SI nConta = 7;  nCasilla = 305;  |FINSI;
     |SI nConta = 8;  nCasilla = 321;  |FINSI;
     |SI nConta = 9;  nCasilla = 337;  |FINSI;

                               aValor = #28#4;   |HAZ GrabaPdf;
     nCasilla = nCasilla + 1;  aValor = #28#5;   |HAZ GrabaPdf;
     nCasilla = nCasilla + 2;  aValor = #28#6;   |HAZ GrabaPdf;
     nCasilla = nCasilla + 1;  aValor = #28#7;   |HAZ GrabaPdf;
     nCasilla = nCasilla + 1;  aValor = #28#8;   |HAZ GrabaPdf;
     nCasilla = nCasilla + 1;  aValor = #28#9;   |HAZ GrabaPdf;
     nCasilla = nCasilla + 1;  aValor = #28#10;  |HAZ GrabaPdf;
     nCasilla = nCasilla + 1;

                               aValor = (("00" + #28#11) % -102) + (("000" + #28#12) % -103);
     |SI aValor ! "00000";                       |HAZ GrabaPdf;  |FINSI;

     nCasilla = nCasilla + 1;  aValor = #28#13;  |HAZ GrabaPdf;
     nCasilla = nCasilla + 2;  aValor = #28#14;  |HAZ GrabaPdf;
     nCasilla = nCasilla + 2;

     |SI #28#48 ! 0;           aValor = #28#48;  |HAZ GrabaPdf; |FINSI;

     nCasilla = nCasilla + 1;
     |SI #28#49 ! 0;           aValor = #28#49;  |HAZ GrabaPdf; |FINSI;

     nCasilla = nCasilla + 1;
     |SI #28#50 ! 0;           aValor = #28#50;  |HAZ GrabaPdf; |FINSI;

     nSuma1   = nSuma1 + #28#48;
     nSuma2   = nSuma2 + #28#49;
     nSuma3   = nSuma3 + #28#50;
|FPRC;

|PROCESO Hoja3;
      nPagina = 1;
      nConta  = 0;
      nSuma1  = 0;
      nSuma2  = 0;
      nSuma3  = 0;
      |BUCLE agicen28;

      |SI nConta ! 0;
          nCasilla = 205;   aValor = 1;         |HAZ GrabaPdf;
          nCasilla = 206;   aValor = nPagina;   |HAZ GrabaPdf;
          nCasilla = 207;   aValor = #27#31;    |HAZ GrabaPdf;

          |SI #27#27 = "P";  nCasilla = 27; aValor = aSi;  |HAZ GrabaPdf;  |FINSI;
          |SI #27#27 = "N";  nCasilla = 28; aValor = aSi;  |HAZ GrabaPdf;  |FINSI;

          nCasilla = 353;   aValor = #0#1;   |HAZ GrabaPdf;
          nCasilla = 354;   aValor = aDia;   |HAZ GrabaPdf;
          nCasilla = 355;   aValor = aMes;   |HAZ GrabaPdf;
          nCasilla = 356;   aValor = aAnyo;  |HAZ GrabaPdf;

          |SI #0#3 = "1";    nCasilla = 29; aValor = aSi;  |HAZ GrabaPdf;  |FINSI;
          |SI #0#3 = "2";    nCasilla = 30; aValor = aSi;  |HAZ GrabaPdf;  |FINSI;

          |SI nSuma1 ! 0; nCasilla = 357; aValor = nSuma1; |HAZ GrabaPdf; |FINSI;
          |SI nSuma2 ! 0; nCasilla = 358; aValor = nSuma2; |HAZ GrabaPdf; |FINSI;
          |SI nSuma3 ! 0; nCasilla = 359; aValor = nSuma3; |HAZ GrabaPdf; |FINSI;
      |FINSI;
|FPRC;

|PROCESO Emitir;

     |SI #0#0 = 1;
         |HAZ CargaTemporal;
     |FINSI;
     |SI #0#0 = 2;
         |HAZ AbreFichero;
     |FINSI;

     |SI #0#0 = 1;
         |ABRE #100;
         |HAZ Hoja1;
         |HAZ Hoja2;
         |HAZ Hoja3;
         |CIERRA #100;
     |FINSI;
     |SI #0#0 = 2;
         |HAZ Hoja1Txt;
         |HAZ Hoja2Txt;
         |HAZ Hoja3Txt;
     |FINSI;

     |SI #0#0 = 2; |HAZ CierraFichero;  |FINSI;
     |SI #0#0 = 1; |HAZ ImprimePDF;     |FINSI;
|FPRC;

|PROCESO EmiteEsto;
     |ABRE #27;
     #27#0 = #26#0;
     #27#1 = #26#1;
     #27#2 = #26#2;
     |LEE 101#27=;
     |SI FSalida ! 0;
         |CIERRA #27;
         |MENAV "0000 Datos incompletos, rellene el registro del modelo 840.";
         |ACABA;
     |FINSI;

     |HAZ CogeMac;

     aIP = "";
     |IP_REMOTO aIP;  |QBF aIP;

     |ABRE #0;
     #0#7 = eaDSMAC;
     |LEE 000#0=;
     |SI FSalida ! 0;
         #0#7 = aIP;
         |LEE 000#0=;
         |SI FSalida = 0;
             #0#7 = eaDSMAC;
         |SINO;
             |DDEFECTO #0;
             #0#7 = eaDSMAC;
         |FINSI;
         |GRABA 020#0n;
         |LIBERA #0;
     |FINSI;

     #0#7 = eaDSMAC;
     |LEE 101#0=;

     |PUSHV 0501 2380;

     #0#1 = #27#145;
     #0#2 = #27#146;
     #0#3 = #27#147;
     #0#4 = #27#148;

     eaForzExplorador = "N";
     |HAZ Explorador;
||     #0#6 = eaPathExplorador;

     |PINPA #0#0;

     |C_V #0#5, 1, "N";
     |C_M #0#5, 1, "N";
     |C_M #0#0, 1, "S";
     |PINTA 1602, "                ";

     |ATRI I;
     |PINTA 2026, "840";
     |ATRI i;

     |PINDA #0#0;
     |ENDATOS #1#0;
     |SI FSalida = 0;
         #27#145 = #0#1;
         #27#146 = #0#2;
         #27#147 = #0#3;
         #27#148 = #0#4;
         |GRABA 020#27a;
         |LIBERA #27;

         |HAZ Emitir;
     |FINSI;
     |POPV;

     |GRABA 020#0a;
     |LIBERA #0;
     |CIERRA #0;

     |CIERRA #27;
|FPRC;
