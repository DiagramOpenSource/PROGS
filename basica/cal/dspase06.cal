|FICHEROS;
     dspase00 #0;
     dspase06 #6;
     dspase15 #15;
     dspase91 #91,MANTE;
     dspase92 #92,MANTE;

     :/modelos/def/dsmom003 #3;
     :/modelos/def/dsmom004 #4;
     :/modelos/def/dsmom008 #8;
     :/modelos/def/dsmom017 #17;
     :/modelos/def/dsmom018 #18;
     :/modelos/def/dsmom019 #19;
     :/modelos/def/dsmom020 #20;
     :/modelos/def/dsmom021 #21;

     :/basica/def/agicen14 #114;
     :/basica/def/zmonedas #200;

     refer00@ #900;
     refer01@ #901;
     refer02@ #902;
     refer03@ #903;
     refer04@ #904;
     refer05@ #905;
|FIN;

|VARIABLES;
     nAnyo           = 0;
     nSw             = 0;
     nTecla          = 0;
     nCampoD         = 0;
     nCampoH         = 0;
     nModelo         = 0;
     nPeriodo        = 0;
     nCampo1         = 0;
     nCampo5         = 0;
     nCampo7         = 0;
     nCodigoNue      = 0;
     nCodigoReo      = 0;
     nEstaCambio     = 0;

     aPathAnterior   = "";
     aPathDefFiscal  = "";
     aPathFichFiscal = "";
     aPathDestino    = "";
     aDef            = "";
     aDirEmpresa     = "";
     aDirFichDestino = "";
     aDirFichOrigen  = "";
     aFichero        = "";
     aAlfa           = "";
     aAlfa1          = "";
     aAlfa2          = "";
     aAlfa3          = "";
     aMonedaAgieos   = "";

     fFecha          = "";

     &eaPathContagen = "";
     &eaPathBasica   = "";
     &eaPathDsmodelo = "";
     &eaPathIntegral = "";
     &eaPathAgitool  = "";

     &eaFAsiento     = "";
     &enEmpresa      = 0;
     &enPerConta     = 0;
     &eaNombreEmp    = "";
     &enTipoAct      = 0;
     &enTipoPase     = 0;
     &enEjer         = 0;
     &enActividad    = 0;
     &enComplem      = 0;
     &eaCodEpi2      = "";
     &enCodEpi3      = 0;
     &eaMoneda       = "";
|FIN;

|RUTINA ClaveBaja92;
     #92#0 = #6#0;
     #92#1 = 99999;
     #92#3 = 6;
|FRUT;

|RUTINA ClaveAlta92;
     #92#0 = #6#0;
     #92#1 = 00000;
     #92#3 = 1;
|FRUT;

|RUTINA ClaveBaja91;
     #91#0 = #6#0;
     #91#1 = 00000;
     #91#4 = 1;
|FRUT;

|RUTINA ClaveAlta91;
     #91#0 = #6#0;
     #91#1 = 99999;
     #91#4 = 6;
|FRUT;

|| PROCESOS DEL DSPASE92 *************************************

|PROCESO Tipo11w92;  |TIPO 11;
     nTecla = FSalida;

     |SI nTecla = 10;
         #91#0 = #92#0;
         #91#1 = #92#1;
         #91#2 = #92#2;
         #91#3 = "N";
         #91#4 = #92#3;
         #91#5 = #92#4;
         |GRABA 020#91n;
         |LIBERA #91;

         |LEE 101#92=;
         |BORRA 020#92a;
         |LIBERA #92;

         |PONCONTROL 23, "SI";
     |FINSI;
|FPRC;

|| PROCESOS DEL DSPASE91 *************************************

|PROCESO PonAlfa;
     #91#3 = aAlfa;
     |GRABA 020#91a;
     |LIBERA #91;
|FPRC;

|DEFBUCLE dspase91E;
     #91#1;
     ;
     #6#0, 00000, 0;
     #6#0, 99999, 9;
     be;
     NULL, PonAlfa;
|FIN;

|PROCESO Tipo11w91;  |TIPO 11;
     nTecla = FSalida;

     |SI nTecla = 10;
         |LEE 101#91=;
         |SI #91#3 = "S";
             #91#3 = "N";
         |SINO;
             #91#3 = "S";
         |FINSI;
         |PINTA #91#3;

         |GRABA 020#91a;
         |LIBERA #91;
     |FINSI;

     |SI nTecla = 11;
         aAlfa       = "S";
         |BUCLE dspase91E;
         |PONCONTROL 23, "SI";
         |PTEC 812;
     |FINSI;

     |SI nTecla = 12;
         aAlfa      = "N";
         |BUCLE dspase91E;
         |PONCONTROL 23, "SI";
         |PTEC 812;
     |FINSI;

     |SI nTecla = 13;
         |ENTLINEAL #1#92, -2, 4, 22, 0, ClaveBaja92, ClaveAlta92;
         |ENTLINEAL #1#91, -2, 7, 22, 0, ClaveBaja91, ClaveAlta91;
     |FINSI;
|FPRC;

||________________ PROCESOS DE GRABACION DE AMORTIZACIONES _______________


|PROCESO DesgloTrab;
     #20#0  = #17#0;
     #20#1  = #17#1;
     #20#2  = #17#2;
     #20#3  = #17#3;
     #20#4  = #902#3;
     |LEE 101#20=;
     |SI FSalida ! 0;
         |DDEFECTO #20;
         #20#0  = #17#0;
         #20#1  = #17#1;
         #20#2  = #17#2;
         #20#3  = #17#3;
         #20#4  = #902#3;
         |GRABA 020#20b;
     |FINSI;

     nCampoD = 5;
     |PARA nCampoH = 4;  |SI nCampoH [ 18;  |HACIENDO nCampoH = nCampoH + 1;
           #20nCampoD = #902nCampoH;
           nCampoD    = nCampoD + 1;
     |SIGUE;

     |GRABA 020#20a;
     |LIBERA #20;
|FPRC;

|DEFBUCLE eosm0021;
     #902#1004;
     ;
     #900#0, #900#5, #900#1, 001;
     #900#0, #900#5, #900#1, 999;
     ;
     NULL, DesgloTrab;
|FIN;

|PROCESO DesgloElem;
     #21#0  = #17#0;
     #21#1  = #17#1;
     #21#2  = #17#2;
     #21#3  = #17#3;
     #21#4  = #903#3;
     |LEE 101#21=;
     |SI FSalida ! 0;
         |DDEFECTO #21;
         #21#0  = #17#0;
         #21#1  = #17#1;
         #21#2  = #17#2;
         #21#3  = #17#3;
         #21#4  = #903#3;
         |GRABA 020#21b;
     |FINSI;

     nCampoD = 5;
     |PARA nCampoH = 4;  |SI nCampoH [ 13;  |HACIENDO nCampoH = nCampoH + 1;
           #21nCampoD = #903nCampoH;
           nCampoD    = nCampoD + 1;
     |SIGUE;

     |GRABA 020#21a;
     |LIBERA #21;
|FPRC;

|DEFBUCLE eosm0022;
     #903#1004;
     ;
     #900#0, #900#5, #900#1, 001;
     #900#0, #900#5, #900#1, 999;
     ;
     NULL, DesgloElem;
|FIN;

|PROCESO Graba4;
     |SI nModelo = 310;
         #4#0  = #18#0;
         #4#1  = #18#1;
         #4#2  = nPeriodo;
         #4#3  = 310;
         #4#4  = 0;
         |LEE 101#4=;
         |SI FSalida ! 0;
             #4#0  = #18#0;
             #4#1  = #18#1;
             #4#2  = nPeriodo;
             #4#3  = 370;
             #4#4  = 0;
             |LEE 101#4=;
             |SI FSalida = 0;
                 #4#17 = "COMPLETADO";
                 #4#7  = "X";
                 #4#9  = "X";
                 |GRABA 020#4a;
                 |LIBERA #4;
             |FINSI;
         |SINO;
             #4#17 = "COMPLETADO";
             #4#7  = "X";
             #4#9  = "X";
             |GRABA 020#4a;
             |LIBERA #4;
        |FINSI;
     |FINSI;

     |SI nModelo = 131;
         #4#0  = #19#0;
         #4#1  = #19#1;
         #4#2  = nPeriodo;
         #4#3  = 131;
         #4#4  = 0;
         |LEE 101#4=;
         |SI FSalida = 0;
             #4#17 = "COMPLETADO";
             #4#7  = "X";
             #4#9  = "X";
             |GRABA 020#4a;
             |LIBERA #4;
        |FINSI;
     |FINSI;

     #8#0 = #4#0;
     #8#1 = #4#1;
     #8#2 = #4#2;
     #8#3 = #4#3;
     #8#4 = #4#4;
     #8#5 = #17#3;
     |LEE 101#8=;
     |SI FSalida = 0;
         #8#11 = "COMPLETADO";
         |GRABA 020#8a;
         |LIBERA #8;
     |FINSI;
|FPRC;

|PROCESO Pasando;
     #900#0 = #91#5;
     #900#1 = #91#4;
     #900#5 = #91#0;
     |LEE 040#900=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     #901#0 = #91#5;
     #901#1 = #91#4;
     #901#2 = #91#0;
     |LEE 040#901=;
     |SI FSalida ! 0;  |DDEFECTO #901;  |FINSI;

     #114#0 = #91#1;
     #114#1 = #900#1;
     |LEE 040#114=;
     |SI FSalida ! 0;  |DDEFECTO #114;  |FINSI;

     |SI #900#5 ] 80;
         nAnyo = 1900 + #900#5;
     |SINO;
         nAnyo = 2000 + #900#5;
     |FINSI;

     #17#0  = #91#1;
     #17#1  = nAnyo;
     #17#2  = 0;
     #17#3  = #900#1;
     |LEE 101#17=;
     |SI FSalida ! 0;
         |DDEFECTO #17;
         #17#0  = #91#1;
         #17#1  = nAnyo;
         #17#2  = 0;
         #17#3  = #900#1;
         |GRABA 020#17b;
     |FINSI;

     #17#4  = #900#2;
     #17#5  = #900#3;
     #17#6  = #900#4;
     #17#7  = #900#7;
     #17#8  = #114#4;
     #17#9  = #900#199;
     #17#10 = #900#200;
     #17#11 = #900#201;
     #17#13 = "EXISTENTE";
     #17#14 = "PESETA";
     #17#15 = #900#129;
     #17#16 = #900#130;
     #17#17 = #900#131;
     #17#18 = #900#132;
     #17#19 = #900#128;
     #17#20 = #900#134;
     #17#21 = #900#135;
     #17#22 = #900#136;
     #17#23 = #900#137;
     #17#24 = #900#133;

     |SI #114#11 = 100;  |O #114#11 = 200;
         #17#12 = "S";
     |FINSI;

     |SI #114#9 = 6;  |O #114#9 = 7;  |O #114#9 = 11;  |O #114#9 = 12;
         #17#12 = "S";
     |FINSI;

     |GRABA 020#17a;
     |LIBERA #17;

     |ABRE #18;
     #18#0  = #91#1;
     #18#1  = nAnyo;
     #18#2  = 0;
     #18#3  = #900#1;
     |LEE 101#18=;
     |SI FSalida ! 0;
         |DDEFECTO #18;
         #18#0  = #91#1;
         #18#1  = nAnyo;
         #18#2  = 0;
         #18#3  = #900#1;
         |GRABA 020#18b;
     |FINSI;

     nCampoD = 4;       || Elementos
     |PARA nCampoH = 11;  |SI nCampoH [ 99;  |HACIENDO nCampoH = nCampoH + 11;
           #18nCampoD = #900nCampoH;
           nCampoD    = nCampoD + 1;
     |SIGUE;

     nCampoD = 15;       || Importe Elementos IRPF
     |PARA nCampoH = 12;  |SI nCampoH [ 100;  |HACIENDO nCampoH = nCampoH + 11;
           #18nCampoD = #900nCampoH;
           nCampoD    = nCampoD + 1;
     |SIGUE;

     nCampoD = 26;       || Numero Provisional IRPF
     |PARA nCampoH = 13;  |SI nCampoH [ 101;  |HACIENDO nCampoH = nCampoH + 11;
           #18nCampoD = #900nCampoH;
           nCampoD    = nCampoD + 1;
     |SIGUE;

     nCampoD = 37;       || Importe Provisional IRPF
     |PARA nCampoH = 14;  |SI nCampoH [ 102;  |HACIENDO nCampoH = nCampoH + 11;
           #18nCampoD = #900nCampoH;
           nCampoD    = nCampoD + 1;
     |SIGUE;

     nCampoD = 48;       || Numero Definitivo IRPF
     |PARA nCampoH = 15;  |SI nCampoH [ 103;  |HACIENDO nCampoH = nCampoH + 11;
           #18nCampoD = #900nCampoH;
           nCampoD    = nCampoD + 1;
     |SIGUE;

     nCampoD = 59;       || Importe Definitivo IRPF
     |PARA nCampoH = 16;  |SI nCampoH [ 104;  |HACIENDO nCampoH = nCampoH + 11;
           #18nCampoD = #900nCampoH;
           nCampoD    = nCampoD + 1;
     |SIGUE;

     #18#81  = #900#150;
     #18#82  = #900#158;
     #18#83  = #900#170;
     #18#84  = #900#178;

     #18#85  = #900#152;
     #18#86  = #900#160;
     #18#87  = #900#172;
     #18#88  = #900#180;

     #18#89  = #900#151;
     #18#90  = #900#159;
     #18#91  = #900#171;
     #18#92  = #900#179;

     #18#93  = #900#153;
     #18#94  = #900#161;
     #18#95  = #900#173;
     #18#96  = #900#181;

     #18#97  = #900#166;
     #18#98  = #900#168;
     #18#99  = #900#186;
     #18#100 = #900#188;

     #18#101 = #900#138;
     #18#102 = #900#144;
     #18#103 = #900#139;
     #18#104 = #900#145;
     #18#105 = #900#140;
     #18#106 = #900#146;

     #18#107 = #900#129;
     #18#108 = #900#130;
     #18#109 = #900#131;
     #18#110 = #900#132;
     #18#111 = #900#128;
     #18#112 = #900#134;
     #18#113 = #900#135;
     #18#114 = #900#136;
     #18#115 = #900#137;
     #18#116 = #900#133;

     #18#117 = #900#190;
     #18#118 = #900#202;
     #18#119 = #900#117;
     #18#120 = #900#110;
     #18#121 = #900#111;
     #18#122 = #900#114;
     #18#123 = #900#115;
     #18#124 = #900#116;
     #18#125 = #900#118;
     #18#126 = #900#119;
     #18#127 = #900#120;
     #18#128 = #900#121;

     |ABRE #904;
     |PARA nPeriodo = 1; |SI nPeriodo [ 4; |HACIENDO nPeriodo = nPeriodo + 1;
           #904#0 = #900#0;
           #904#1 = #900#5;
           #904#2 = nPeriodo;
           |LEE 040#904=;
           |SI FSalida = 0; |Y #904#3 ! "01.01.0000";
               |PARA nCampo1 = 5;  |SI nCampo1 [ 33;  |HACIENDO nCampo1 = nCampo1 + 7;
                 |SI #900#1 = #904nCampo1;
                     nCampo7 = nCampo1 + 6;
                      |SI nPeriodo = 1; #18#125 = #904nCampo7; #18#129 = "S"; |FINSI;
                      |SI nPeriodo = 2; #18#126 = #904nCampo7; #18#130 = "S"; |FINSI;
                      |SI nPeriodo = 3; #18#127 = #904nCampo7; #18#131 = "S"; |FINSI;
                      |SI nPeriodo = 4; #18#128 = #904nCampo7; #18#132 = "S"; |FINSI;
                  |FINSI;
              |SIGUE;
           |FINSI;
     |SIGUE;
     |CIERRA #904;

     #18#133 = #901#3;

     || Provisional

     #18#134 = #901#4;
     #18#135 = #901#7;
     #18#136 = #901#89;
     #18#137 = #901#83;
     #18#138 = #901#86;
     #18#139 = #901#91;
     #18#140 = #901#10;

     #18#141 = #901#12;
     #18#142 = #901#13;
     #18#143 = #901#14;
     #18#144 = #901#15;
     #18#145 = #901#16;
     #18#146 = #901#17;
     #18#147 = #901#18;
     #18#148 = #901#19;
     #18#149 = #901#20;
     #18#150 = #901#21;
     #18#151 = #901#22;
     #18#152 = #901#23;
     #18#153 = #901#24;
     #18#154 = #901#25;

     #18#156 = #901#42;
     #18#157 = #901#43;
     #18#158 = #901#46;
     #18#159 = #901#47;
     #18#160 = #901#50;
     #18#161 = #901#51;
     #18#162 = #901#54;
     #18#163 = #901#55;
     #18#164 = #901#58;
     #18#165 = #901#59;
     #18#166 = #901#62;
     #18#167 = #901#63;
     #18#168 = #901#64;
     #18#169 = #901#69;
     #18#170 = #901#70;
     #18#171 = #901#68;
     #18#172 = #901#73;
     #18#173 = #901#74;

     #18#176 = #901#99;
     #18#177 = #901#101;
     #18#178 = #901#103;
     #18#179 = #901#104;
     #18#180 = #901#114;
     #18#181 = #901#106;
     #18#182 = #901#113;
     #18#187 = #901#93;
     #18#188 = #901#94;
     #18#189 = #901#77 + #901#79;

     || Definitivo

     #18#194 = #901#4;
     #18#195 = #901#8;
     #18#196 = #901#90;
     #18#197 = #901#83;
     #18#198 = #901#87;
     #18#199 = #901#92;
     #18#200 = #901#11;

     #18#201 = #901#26;
     #18#202 = #901#27;
     #18#203 = #901#28;
     #18#204 = #901#29;
     #18#205 = #901#30;
     #18#206 = #901#31;
     #18#207 = #901#32;
     #18#208 = #901#33;
     #18#209 = #901#34;
     #18#210 = #901#35;
     #18#211 = #901#36;
     #18#212 = #901#37;
     #18#213 = #901#38;
     #18#214 = #901#39;

     #18#216 = #901#44;
     #18#217 = #901#45;
     #18#218 = #901#48;
     #18#219 = #901#49;
     #18#220 = #901#52;
     #18#221 = #901#53;
     #18#222 = #901#56;
     #18#223 = #901#57;
     #18#224 = #901#60;
     #18#225 = #901#61;

     #18#226 = #901#65;
     #18#227 = #901#66;
     #18#228 = #901#67;
     #18#229 = #901#71;
     #18#230 = #901#72;
     #18#231 = #901#68;
     #18#232 = #901#75;
     #18#233 = #901#76;

     #18#236 = #901#99;
     #18#237 = #901#101;
     #18#238 = #901#103;
     #18#239 = #901#104;
     #18#240 = #901#114;
     #18#241 = #901#106;
     #18#242 = #901#113;
     #18#247 = #901#95;
     #18#248 = #901#96;
     #18#249 = #901#78 + #901#80;

     |GRABA 020#18a;
     |LIBERA #18;
     |CIERRA #18;

     enTipoPase    = 1;
     enEmpresa     = #18#0;
     enEjer        = #18#1;
     enComplem     = #18#2;
     enActividad   = #18#3;
     eaCodEpi2     = #17#5;
     enCodEpi3     = #17#6;
     eaMoneda      = "PESETA";
     |SUB_EJECUTA_NP ":modelos/dsmom018";

     |ABRE #19;
     #19#0  = #91#1;
     #19#1  = nAnyo;
     #19#2  = 0;
     #19#3  = #900#1;
     |LEE 101#19=;
     |SI FSalida ! 0;
         |DDEFECTO #19;
         #19#0  = #91#1;
         #19#1  = nAnyo;
         #19#2  = 0;
         #19#3  = #900#1;
         |GRABA 020#19b;
     |FINSI;

     nCampoD = 4;       || Elementos
     |PARA nCampoH = 11;  |SI nCampoH [ 99;  |HACIENDO nCampoH = nCampoH + 11;
           #19nCampoD = #900nCampoH;
           nCampoD    = nCampoD + 1;
     |SIGUE;

     nCampoD = 15;       || Importe Elementos IVA
     |PARA nCampoH = 17;  |SI nCampoH [ 105;  |HACIENDO nCampoH = nCampoH + 11;
           #19nCampoD = #900nCampoH;
           nCampoD    = nCampoD + 1;
     |SIGUE;

     nCampoD = 26;       || Numero Provisional IVA
     |PARA nCampoH = 18;  |SI nCampoH [ 106;  |HACIENDO nCampoH = nCampoH + 11;
           #19nCampoD = #900nCampoH;
           nCampoD    = nCampoD + 1;
     |SIGUE;

     nCampoD = 37;       || Importe Provisional IVA
     |PARA nCampoH = 19;  |SI nCampoH [ 107;  |HACIENDO nCampoH = nCampoH + 11;
           #19nCampoD = #900nCampoH;
           nCampoD    = nCampoD + 1;
     |SIGUE;

     nCampoD = 48;       || Numero Definitivo IVA
     |PARA nCampoH = 20;  |SI nCampoH [ 108;  |HACIENDO nCampoH = nCampoH + 11;
           #19nCampoD = #900nCampoH;
           nCampoD    = nCampoD + 1;
     |SIGUE;

     nCampoD = 59;       || Importe Definitivo IVA
     |PARA nCampoH = 21;  |SI nCampoH [ 109;  |HACIENDO nCampoH = nCampoH + 11;
           #19nCampoD = #900nCampoH;
           nCampoD    = nCampoD + 1;
     |SIGUE;

     #19#81  = #900#154;
     #19#82  = #900#162;
     #19#83  = #900#174;
     #19#84  = #900#182;

     #19#85  = #900#156;
     #19#86  = #900#164;
     #19#87  = #900#178;
     #19#88  = #900#184;

     #19#89  = #900#155;
     #19#90  = #900#163;
     #19#91  = #900#175;
     #19#92  = #900#183;

     #19#93  = #900#157;
     #19#94  = #900#165;
     #19#95  = #900#177;
     #19#96  = #900#185;

     #19#97  = #900#167;
     #19#98  = #900#169;
     #19#99  = #900#187;
     #19#100 = #900#189;

     #19#101 = #900#141;
     #19#102 = #900#147;
     #19#103 = #900#142;
     #19#104 = #900#148;
     #19#105 = #900#143;
     #19#106 = #900#149;

     #19#107 = #900#129;
     #19#108 = #900#130;
     #19#109 = #900#131;
     #19#110 = #900#132;
     #19#111 = #900#128;
     #19#112 = #900#134;
     #19#113 = #900#135;
     #19#114 = #900#136;
     #19#115 = #900#137;
     #19#116 = #900#133;

     #19#117 = #900#112;
     #19#118 = #900#113;

     #19#119 = #901#62;
     #19#120 = #901#63;

     #19#121 = #900#122;
     #19#122 = #900#123;

     #19#123 = #901#116;
     #19#124 = #901#117;
     #19#125 = #901#118;
     #19#126 = #901#119;
     #19#127 = #901#120;
     #19#128 = #901#121;
     #19#129 = #901#122;
     #19#130 = #901#123;
     #19#131 = #901#124;
     #19#134 = #901#115;
     #19#139 = #900#124;
     #19#140 = #900#125;
     #19#141 = #900#126;
     #19#142 = #900#127;

     |ABRE #905;
     |PARA nPeriodo = 1; |SI nPeriodo [ 4; |HACIENDO nPeriodo = nPeriodo + 1;
           #905#0 = #900#0;
           #905#1 = #900#5;
           #905#2 = nPeriodo;
           |LEE 040#905=;
           |SI FSalida = 0; |Y #905#3 ! "01.01.0000";
               |PARA nCampo1 = 5;  |SI nCampo1 [ 33;  |HACIENDO nCampo1 = nCampo1 + 5;
                     |SI #900#1 = #905nCampo1;
                         nCampo5 = nCampo1 + 4;
                         |SI nPeriodo = 1; #19#139 = #905nCampo5; #19#143 = "S"; |FINSI;
                         |SI nPeriodo = 2; #19#140 = #905nCampo5; #19#144 = "S"; |FINSI;
                         |SI nPeriodo = 3; #19#141 = #905nCampo5; #19#145 = "S"; |FINSI;
                         |SI nPeriodo = 4; #19#142 = #905nCampo5; #19#146 = "S"; |FINSI;
                     |FINSI;
               |SIGUE;
           |FINSI;
     |SIGUE;
     |CIERRA #905;

     |GRABA 020#19a;
     |LIBERA #19;
     |CIERRA #19;

     enTipoPase    = 1;
     enEmpresa     = #19#0;
     enEjer        = #19#1;
     enComplem     = #19#2;
     enActividad   = #19#3;
     eaCodEpi2     = #17#5;
     enCodEpi3     = #17#6;
     eaMoneda      = "PESETA";
     |SUB_EJECUTA_NP ":modelos/dsmom019";

     |SI #17#9 = "S";
         |ABRE #20;
         |BUCLE eosm0021;
         |CIERRA #20;
     |FINSI;

     |SI #17#10 = "S";
         |ABRE #21;
         |BUCLE eosm0022;
         |CIERRA #21;
     |FINSI;

     |ABRE #4;
     |ABRE #8;

     |SI #18#129 = "S";  nModelo  = 131;  nPeriodo = 3;  |HAZ Graba4;  |FINSI;
     |SI #18#130 = "S";  nModelo  = 131;  nPeriodo = 6;  |HAZ Graba4;  |FINSI;
     |SI #18#131 = "S";  nModelo  = 131;  nPeriodo = 9;  |HAZ Graba4;  |FINSI;
     |SI #18#132 = "S";  nModelo  = 131;  nPeriodo = 12; |HAZ Graba4;  |FINSI;

     |SI #19#143 = "S";  nModelo  = 310;  nPeriodo = 3;  |HAZ Graba4;  |FINSI;
     |SI #19#144 = "S";  nModelo  = 310;  nPeriodo = 6;  |HAZ Graba4;  |FINSI;
     |SI #19#145 = "S";  nModelo  = 310;  nPeriodo = 9;  |HAZ Graba4;  |FINSI;
     |SI #19#146 = "S";  nModelo  = 310;  nPeriodo = 12; |HAZ Graba4;  |FINSI;

     |CIERRA #4;
     |CIERRA #8;

     |ABRE #92;
     #92#0 = #91#0;
     #92#1 = #91#1;
     #92#2 = #91#2;
     #92#3 = #91#4;
     #92#4 = #91#5;
     |GRABA 020#92n;
     |LIBERA #92;
     |CIERRA #92;

     |BORRA 020#91a;
     |LIBERA #91;

     |ENTLINEAL #1#92, -2, 7, 22, 1, ClaveBaja92, ClaveAlta92;
     |ENTLINEAL #1#91, -2, 7, 22, 0, ClaveBaja91, ClaveAlta91;
|FPRC;

|DEFBUCLE dspase91;
     #91#1;
     3;
     #6#0, 00000, 1, "S";
     #6#0, 99999, 6, "S";
     be;
     NULL, Pasando;
|FIN;

|PROCESO CogeCodigo;
     |SI #15#22 = "S";  |ACABA;  |FINSI;

     nCodigoNue = #15#3;
     |ERROR10;
|FPRC;

|DEFBUCLE dspase15;
     #15#4;
     ;
     nCodigoReo, "            ", 000;
     nCodigoReo, "zzzzzzzzzzzz", 999;
     ;
     NULL, CogeCodigo;
|FIN;

|PROCESO MiraModulos;
     |SI nEstaCambio = 1;
         nCodigoNue = 0;
         nCodigoReo = #900#0;
         |BUCLE dspase15;
         |SI nCodigoNue = 0;  |ACABA;  |FINSI;
     |SINO;
         nCodigoNue = #900#0;
     |FINSI;

     |SI #900#5 ] 80;
         nAnyo = 1900 + #900#5;
     |SINO;
         nAnyo = 2000 + #900#5;
     |FINSI;

     nSw  = 0;
     #8#0 = nCodigoNue;
     #8#1 = nAnyo;
     #8#2 = 0;
     #8#3 = 0;
     #8#4 = 0;
     #8#5 = #900#1;
     |LEE 040#8];
     |PARA;  |SI;  |HACIENDO;
         |SI FSalida ! 0;  |SAL;  |FINSI;
         |SI #8#0 = nCodigoNue;  |Y #8#1 = nAnyo; |Y #8#5 = #900#1;
             |SI #8#3 = 131;  |O #8#3 = 310;
                 |SI #8#7 = "MODULOS   ";
                     nSw = 1;
                     |SAL;
                 |FINSI;
              |FINSI;
         |FINSI;
         |LEE 040#8s;
     |SIGUE;

     |SI nSw = 0;  |ACABA;  |FINSI;

     #91#0 = #6#0;
     #91#1 = nCodigoNue;
     #91#4 = #900#1;
     |LEE 040#91=;
     |SI FSalida = 0;  |ACABA;  |FINSI;

     #92#0 = #6#0;
     #92#1 = nCodigoNue;
     #92#3 = #900#1;
     |LEE 040#92=;
     |SI FSalida = 0;  |ACABA;  |FINSI;

     #91#0 = #6#0;
     #91#1 = nCodigoNue;
     #91#2 = #900#7;
     #91#3 = "N";
     #91#4 = #900#1;
     #91#5 = #900#0;
     |GRABA 020#91n;
     |LIBERA #91;
|FPRC;

|DEFBUCLE eosm0017;
     #900#1003;
     ;
     00000, #6#0, 1;
     99999, #6#0, 9;
     ;
     NULL, MiraModulos;
|FIN;

|PROCESO Tipo3;  |TIPO 3;
     |NOME_DAT #91 "pase0691";
     |NOME_DAT #92 "pase0692";

     |ABRE #91;
     |ABRE #92;

     aDef = aPathDefFiscal + "eosm0017.mas";
     |CARGA_DEF aDef, refer00@;
     |SI FSalida ! 0;
         |MENAV "     Error en Cargar el Def eosm0017.mas";
         |ACABA;
     |FINSI;

     aDef = aPathDefFiscal + "eosm0018.mas";
     |CARGA_DEF aDef, refer01@;
     |SI FSalida ! 0;
         |MENAV "     Error en Cargar el Def eosm0018.mas";
         |DESCARGA_DEF #refer00@;
         |ACABA;
     |FINSI;

     aDef = aPathDefFiscal + "eosm0021.mas";
     |CARGA_DEF aDef, refer02@;
     |SI FSalida ! 0;
         |MENAV "     Error en Cargar el Def eosm0021.mas";
         |DESCARGA_DEF #refer01@;
         |DESCARGA_DEF #refer00@;
         |ACABA;
     |FINSI;

     aDef = aPathDefFiscal + "eosm0022.mas";
     |CARGA_DEF aDef, refer03@;
     |SI FSalida ! 0;
         |MENAV "     Error en Cargar el Def eosm0022.mas";
         |DESCARGA_DEF #refer02@;
         |DESCARGA_DEF #refer01@;
         |DESCARGA_DEF #refer00@;
         |ACABA;
     |FINSI;

     aDef = aPathDefFiscal + "eosm0020.mas";
     |CARGA_DEF aDef, refer04@;
     |SI FSalida ! 0;
         |MENAV "     Error en Cargar el Def eosm0020.mas";
         |DESCARGA_DEF #refer03@;
         |DESCARGA_DEF #refer02@;
         |DESCARGA_DEF #refer01@;
         |DESCARGA_DEF #refer00@;
         |ACABA;
     |FINSI;

     aDef = aPathDefFiscal + "eosm0019.mas";
     |CARGA_DEF aDef, refer05@;
     |SI FSalida ! 0;
         |MENAV "     Error en Cargar el Def eosm0019.mas";
         |DESCARGA_DEF #refer04@;
         |DESCARGA_DEF #refer03@;
         |DESCARGA_DEF #refer02@;
         |DESCARGA_DEF #refer01@;
         |DESCARGA_DEF #refer00@;
         |ACABA;
     |FINSI;

     |PATH_DAT #900 aPathFichFiscal;
     |PATH_DAT #901 aPathFichFiscal;
     |PATH_DAT #902 aPathFichFiscal;
     |PATH_DAT #903 aPathFichFiscal;
     |PATH_DAT #904 aPathFichFiscal;
     |PATH_DAT #905 aPathFichFiscal;

     |ABRE #8;
     |BUCLE eosm0017;
     |CIERRA #8;

     |CIERRA #91;
     |CIERRA #92;

     |ENTLINEAL #1#92, -2, 7, 22, 0, ClaveBaja92, ClaveAlta92;
     |ENTLINEAL #1#91, -2, 4, 22, 0, ClaveBaja91, ClaveAlta91;

     |CONFI "0000SRealizamos el pase en estos Momentos";
     |SI FSalida = 0;
         |ABRE #17;
         |ABRE #114;
         |ABRE #900;
         |ABRE #901;
         |BUCLE dspase91;
         |CIERRA #17;
         |CIERRA #114;
         |CIERRA #900;
         |CIERRA #901;
     |FINSI;

     |DESCARGA_DEF #refer05@;
     |DESCARGA_DEF #refer04@;
     |DESCARGA_DEF #refer03@;
     |DESCARGA_DEF #refer02@;
     |DESCARGA_DEF #refer01@;
     |DESCARGA_DEF #refer00@;
|FPRC;

|PROGRAMA;
     |ABRE #0;
     |LEE 040#0p;
     |SI FSalida ! 0;
         |MENAV "     Pase de Ficheros Generales no Realizado";
         |CIERRA #0;
         |ACABA;
     |FINSI;
     |CIERRA #0;

     |ABRE #15;
     |LEE 040#15p;
     |SI FSalida ! 0;
         nEstaCambio = 0;
         |DDEFECTO #15;
     |SINO;
         nEstaCambio = 1;
         |SI #15#15 ! "S";
             |MENAV "      Unificacion de Codigos no Realizada.";
             |CIERRA #15;
             |ACABA;
         |FINSI;
     |FINSI;
     |CIERRA #15;

     |HAZ BusquedaApli;

     eaPathDsmodelo = eaPathDsmodelo + "fich/";
     aPathAnterior   = #0#0;  |QBT aPathAnterior;
     aPathDefFiscal  = aPathAnterior + "agieos/def/";
     aPathFichFiscal = aPathAnterior + "agieos/fich/";
     aPathDestino    = eaPathContagen - "fich/";

     aDef = eaPathAgitool + "def/zmonedas.mas";
     |CARGA_DEF aDef, refer00@;
     |SI FSalida ! 0;
         aMonedaAgieos = "P";
     |SINO;
         |PATH_DAT #900 aPathFichFiscal;
         |ABRE #900;
         |LEE 040#900p;
         |SI FSalida ! 0;  |DDEFECTO #900;  |FINSI;
         |CIERRA #900;

         aMonedaAgieos = #900#1;

         |DESCARGA_DEF #refer00@;
     |FINSI;

     |ABRE #200;
     |LEE 040#200p;
     |SI FSalida ! 0;  |DDEFECTO #200;  |FINSI;
     |CIERRA #200;

     |SI aMonedaAgieos ! #200#9;
         |MENAV "    Moneda Gestion de Modulos anterior distinta a la de esta Gestion.";
         |ACABA;
     |FINSI;

     |PINPA #0#6;
     |PINDA #0#6;
     |ENDATOS #1#6;
|FPRO;
