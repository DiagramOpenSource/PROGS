|FICHEROS;
     agim0010;
     agim0011 #0;
     agim0012 #1;
     agiz0019 #999;

     :/laboral/def/labtraba #200;

     :/dsarchi/def/dsarm005;

     imagen@  #2;
     &usuarios@ #712;
     &clientes@ #715;
|FIN;

|VARIABLES;
     aAlfa1       = "";
     aAlfa        = "";
     aFich        = "";
     aMas         = "";
     aBase        = "";
     aFichero     = "";
     aAbre        = "";

     nLinea       = 0;
     nCampo       = 0;
     nHandle      = 0;
     nBtnImp      = 0;
     nPanta       = 0;
     nRef         = 0;

     fDFecha      = @;
     fHFecha      = @;

     &eaCodUsu    = "";
     &enCodCli    = 0;
     &enSwDeDonde = 0;
|FIN;

|PROCESO Tipo15Fm5;
|FPRC;

|PROCESO Tipo16Fm5;
|FPRC;

|PROCESO Tipo17Fm5;
|FPRC;

|PROCESO agim0010;
     |SI #agim0010#8 = "S";
         |SI #agim0010#9 ! #dsarm005#19;
             |ACABA;
         |FINSI;
     |FINSI;

     |LEE 000#agiz0019.u;
     |SI FSalida ! 0;  #agiz0019#0 = 0;  |FINSI;

     nRef = #agiz0019#0 + 1;

     |DDEFECTO #agiz0019;

     #agiz0019#0  = nRef;
     #agiz0019#1  = #dsarm005#8;
     #agiz0019#2  = #agim0010#0;
     #agiz0019#3  = #agim0010#1;

     |SI #agim0010#10 = "S";
         aAlfa = #dsarm005#11;  |QBF aAlfa;
         |SI aAlfa ! "";
             #agiz0019#3  = #dsarm005#11;
         |FINSI;
     |FINSI;

     #agiz0019#4  = #dsarm005#17;
     #agiz0019#5  = "A";
     #agiz0019#6  = "ARCHIVADO";
     #agiz0019#7  = #dsarm005#4;
     #agiz0019#8  = Usuario % 810;

     |SI #agiz0019#4 ! 0;
         |SI #dsarm005#18 [ 12;  #agiz0019#11 = 4;  |FINSI;
         |SI #dsarm005#18 [  9;  #agiz0019#11 = 3;  |FINSI;
         |SI #dsarm005#18 [  6;  #agiz0019#11 = 2;  |FINSI;
         |SI #dsarm005#18 [  3;  #agiz0019#11 = 1;  |FINSI;
         |SI #dsarm005#18 = 99;  #agiz0019#11 = 0;  |FINSI;

         |SI #agim0010#9 = 202;  |O #agim0010#9 = 218;
             #agiz0019#11 = #dsarm005#18;
         |FINSI;
     |FINSI;

     #agiz0019#12 = #dsarm005#14;
     #agiz0019#13 = #dsarm005#15;
     #agiz0019#14 = #dsarm005#16;

     eaCodUsu = #agiz0019#8;
     |HAZ LeeUsuario;
     #agiz0019#9 = #712#1;

     |GRABA 020#agiz0019.n;
     |LIBERA #agiz0019;
|FPRC;

|DEFBUCLE agim0010;
     #agim0010#3;
     ;
     #dsarm005#1, #dsarm005#2, #dsarm005#3, "";
     #dsarm005#1, #dsarm005#2, #dsarm005#3, "zzzzz";
     ;
     NULL, agim0010;
|FIN;

|PROCESO dsarm005;
     |SI #dsarm005#1 = 0;  |Y #dsarm005#2 = 0;  |Y #dsarm005#3 = 0;
         |ACABA;
     |FINSI;

     |BUCLE agim0010;
|FPRC;

|DEFBUCLE dsarm005;
     #dsarm005#8;
     ;
     fDFecha, "     ",         1;
     fHFecha, "zzzzz", 999999999;
     ;
     NULL, dsarm005;
|FIN;

|PROCESO PintaFechas;
     |PINTA 1164, fDFecha;
     |PINTA 1264, fHFecha;
|FPRC;

|PROCESO Importacion;
     |PUSHV  1039 1380;
     |BLANCO 1140 1379;
     |CUADRO 1039 1480;

     |PINTA 1142, "Desde fecha registro";
     |PINTA 1242, "Hasta fecha registro";

     fDFecha      = ~;
     fHFecha      = ~;

     |ET DFecha;
         |HAZ PintaFechas;

         fDFecha = 1164 ? 1;
         |HAZ PintaFechas;

     |ET HFecha;
         fHFecha = 1264 ? 1;
         |SI FSalida = 2;  |VETE DFecha;  |FINSI;

         |HAZ PintaFechas;

     |POPV;

     |DBASS aBase;
     aFich = aBase + "dsarchi/fich/";
     |PATH_DAT #dsarm005#aFich#;

     |BUCLE dsarm005;

     |PTEC 809;
     |PTEC 808;
     |PONCONTROL  23, "SI";
|FPRC;

|PROCESO PasaArchivo;
     #0#0 = #999#1;
     |LEE 101#0=;
     |SI FSalida ! 0;
         |DDEFECTO #0;
         #0#0 = #999#1;
         |GRABA 020#0b;
     |FINSI;

     enCodCli = #0#0;
     |HAZ LeePersona;
     |SI enSwDeDonde = 1;
         #0#1 = #715#1;
         #0#2 = #715#10;
         #0#3 = #715#11;
         #0#4 = #715#13;
         #0#5 = #715#14;
         #0#6 = #715#6;
         #0#7 = #715#7;
     |SINO;
         #0#1 = #715#1;
         #0#2 = #715#88;
         #0#3 = #715#89;
         #0#4 = #715#90;
     |FINSI;

     |SI #0#4 ! 0;
         enCodCli = #0#4;
         |HAZ LeePersona;
         #0#5 = #715#1;
     |FINSI;

     |GRABA 020#0a;
     |LIBERA #0;

     #1#0 = #0#0;
     #1#1 = 9999;
     |LEE 040#1];
     |SI FSalida = 0;
         |LEE 040#1a;
     |SINO;
         |LEE 040#1u;
     |FINSI;
     |SI FSalida = 0;  |Y #1#0 = #0#0;
         nLinea = #1#1 + 1;
     |SINO;
         nLinea = 1;
     |FINSI;

     |DDEFECTO #1;
     #1#0  = #0#0;
     #1#1  = nLinea;
     |PARA nCampo = 2;  |SI nCampo [ 11;  |HACIENDO nCampo = nCampo + 1;
           #1nCampo = #999nCampo;
     |SIGUE;
     #1#12 = #999#13;
     #1#13 = #999#14;

     |GRABA 020#1n;
     |LIBERA #1;
|FPRC;

|DEFBUCLE agiz0019;
     #999#1;
     ;
     0001;
     9999;
     ;
     NULL, PasaArchivo;
|FIN;

|PROCESO PintaCliente;  |TIPO 0;
     enCodCli = #999#1;
     |HAZ LeePersona;
     |SI enSwDeDonde = 1;
         #999#12 = #715#1;
     |SINO;
         #999#12 = #715#1;
     |FINSI;

     |PINTA #999#12;
|FPRC;

|PROCESO PintaUsuario;
     eaCodUsu = #999#8;
     |HAZ LeeUsuario;

     #999#9 = #712#1;
     |PINTA #999#9;
|FPRC;

|PROCESO Clave;
    |SI #999#5 = "N"; #999#6 = "NO TIENE "; |FINSI;
    |SI #999#5 = "A"; #999#6 = "ARCHIVADO"; |FINSI;
    |SI #999#5 = "E"; #999#6 = "ENTREGADO"; |FINSI;
    |PINTA #999#6;
|FPRC;


|PROCESO Traba7;  |TIPO 7;
     |DBASS aBase;  |QBF aBase;
     aAbre = aBase + "laboral/def/labtraba.mas";
     |XABRE "E", aAbre, nHandle;
     |SI FSalida < 0;  |ACABA;  |FINSI;

     |C_M #999#13, 1, "S";

     |ABRE #200;
     #200#0 = #999#1;
     #200#1 = 1;
     |LEE 000#200];
     |SI FSalida ! 0;  |O #200#0 ! #999#1;
         |C_M #999#13, 1, "N";  #999#13 = 0;    |PINTA #999#13;
                                #999#14 = "";   |PINTA #999#14;
     |FINSI;
     |CIERRA #200;
|FPRC;

|PROCESO Baja200;
     #200#0 = #999#1;
     #200#1 = 1;
|FPRC;

|PROCESO Alta200;
     #200#0 = #999#1;
     #200#1 = 99999;
|FPRC;

|PROCESO Traba66;  |TIPO 66;
     |ABRE #200;
     #200#0 = #999#1;
     #200#1 = #999#13;
     |LEE 000#200=;

     |CONSULTA_F_CLAVE #1#200, Baja200, Alta200;
     |SI FSalida = 0;
         #999#13 = #200#1;  |PINTA #999#13;
         #999#14 = #200#2;  |PINTA #999#14;
     |FINSI;
     |CIERRA #200;

     |ERROR;
|FPRC;

|PROCESO Traba0;  |TIPO 0;
     |SI #999#13 = 0;
         #999#14 = "";  |PINTA #999#14;
         |ACABA;
     |FINSI;

     |ABRE #200;
     #200#0 = #999#1;
     #200#1 = #999#13;
     |LEE 000#200=;
     |SI FSalida ! 0;
         |MENAV "0000 Trabajador Inexistente.";
         |ERROR;
     |SINO;
         #999#14 = #200#2;  |PINTA #999#14;
     |FINSI;
     |CIERRA #200;
|FPRC;


|RUTINA ClaveBaja999;
    #999#0 = 1;
|FRUT;

|RUTINA ClaveAlta999;
    #999#0 = 9999;
|FRUT;

|PROGRAMA;
    aFichero = ("19" + Usuario + "zzzzzzzz") % 108;
    |NOME_DAT #999 aFichero;

    |ABRE #999;  |CIERRA #999;  |DELINDEX #999;

    |PINPA #0#agiz0019;
    nPanta = FSalida;

    |DBASS aBase;
    aMas = aBase + "dsarchi/def/dsarm001.mas";
    |XABRE "E", aMas, nHandle;
    |SI FSalida ] 0;
        |CONTROL_SIMPLE nPanta, "BOTON,Importacion GAD", 0960, 0979, Importacion;
        nBtnImp = FSalida;
    |FINSI;

    |ENTLINEAL #1#999, -1, 1, 22, 0, ClaveBaja999, ClaveAlta999;

    |CONFI "0000SDesea Actualizar el Ficheros de Archivos con los datos introducidos";
    |SI FSalida = 0;
        |ABRE #0;
        |ABRE #1;
        |BUCLE agiz0019;
        |CIERRA #0;
        |CIERRA #1;
    |FINSI;

    |FIN_CONTROL_WINDOWS nBtnImp;

    |DELINDEX #999;
|FPRO;
