|FICHEROS;
     agim0052 #0;   ||Recibos Mostrador.
     agifigen #1;   ||Cliente
     agim0053 #2;   ||Historico de Recibos
|FIN;

|VARIABLES;
     aMensaje = "";
     nExiste = 0;
     aCP = "";
     aCP1 = "";
     aCP2 = "";
     nRecibo = 0;
     aInforme = "";
     &eaDia = "";
     &eaMes = "";
     &eaAny = "";
     aFecha = "";
     fFecha = @;
     fMes = @;
     aParametro = "";
     &enRecibo = 0;
|FIN;

|PROGRAMA;
     |CLS;
     aParametro = PARAMETRO;
     |SI aParametro = "H";    ||Impresion desde historico;
          |ABRE #agim0052;
          |ABRE #agim0053;
          #agim0053#8 = enRecibo;
          |LEE 000#agim0053.=;
          |SI FSalida = 0;
               |DDEFECTO #agim0052;
               |LEE 000#agim0052.p;
               #agim0052#0 = #agim0053#0;
               #agim0052#1 = #agim0053#1;
               #agim0052#2 = #agim0053#2;
               #agim0052#3 = #agim0053#3;
               #agim0052#4 = #agim0053#4;
               #agim0052#5 = #agim0053#5;
               #agim0052#6 = #agim0053#6;
               #agim0052#7 = #agim0053#7;
               #agim0052#8 = #agim0053#8;
               #agim0052#9 = #agim0053#9;
               #agim0052#10 = #agim0053#10;
               #agim0052#11 = #agim0053#11;
               #agim0052#12 = #agim0053#12;
               #agim0052#13 = #agim0053#13;
               #agim0052#14 = #agim0053#14;
               #agim0052#15 = #agim0053#15;
               #agim0052#17 = #agim0053#17;
               #agim0052#18 = #agim0053#18;
               #agim0052#19 = #agim0053#19;
               #agim0052#20 = #agim0053#20;
               #agim0052#21 = #agim0053#21;
               #agim0052#22 = #agim0053#22;
               |HAZ Impresion;
          |FINSI;
          |CIERRA #agim0052;
          |CIERRA #agim0053;
     |SINO;                   ||Tal como esta
          |ABRE #0;
          |DDEFECTO #0;
          |LEE 101#0p;
          nExiste=FSalida;
          |PDEFECTO #0, 7, 8;
          |PDEFECTO #0, 15, 16;
          |PDEFECTO #0, 21, 23;
          |PINPA #0#0;
          |PINDA #0#0;
          |ABRE #agim0053;
          |HAZ NumRecibo;
          |ENDATOS #1#0;
          |SI FSalida=0;
               |SI nExiste=0;
                    |GRABA 020#0a;
               |SINO;
                    |GRABA 020#0n;
               |FINSI;
               |HAZ Impresion;
               |HAZ Historico;
          |FINSI;
          |LIBERA #0;
          |CIERRA #0;
          |CIERRA #agim0053;
     |FINSI;
|FPRO;


|PROCESO Tipo0; |TIPO 0;
     |ABRE #agifigen;
     #agifigen#0 = #agim0052#1;
     |LEE 000#agifigen.=;
     |SI FSalida = 0;
          #agim0052#2 = #agifigen#1;
          #agim0052#3 = #agifigen#4;
          #agim0052#4 = #agifigen#11;
          aCP1 = ("00" + #agifigen#9) % -102;
          aCP2 = ("000" + #agifigen#10) % -103;
          aCP = aCP1 + aCP2;
          #agim0052#5 = aCP;
          #agim0052#6 = #agifigen#13;
          #agim0052#17 = #agifigen#5;
          #agim0052#18 = #agifigen#6;
          #agim0052#19 = #agifigen#7;
          #agim0052#20 = #agifigen#8;
     |SINO;
          #agim0052#2 = "";
          #agim0052#3 = "";
          #agim0052#4 = "";
          #agim0052#5 = "";
          #agim0052#6 = "";
          #agim0052#17 = "";
          #agim0052#18 = "";
          #agim0052#19 = "";
          #agim0052#20 = "";
     |FINSI;
     |PINTA #agim0052#2;
     |PINTA #agim0052#3;
     |PINTA #agim0052#4;
     |PINTA #agim0052#5;
     |PINTA #agim0052#6;
     |PINTA #agim0052#17;
     |PINTA #agim0052#18;
     |PINTA #agim0052#19;
     |PINTA #agim0052#20;
     |CIERRA #agifigen;
|FPRC;

|PROCESO NumRecibo;
     ||Calcula el ultimo numero de recibo del Historico
     #agim0053#8 = 999999;
     |LEE 000#agim0053.];
     |SI FSalida = 0;
           |LEE 000#agim0053.a;
     |SINO;
           |LEE 000#agim0053.u;
     |FINSI;
     |SI FSalida = 0;
          nRecibo = #agim0053#8 + 1;
     |SINO;
          nRecibo = 1;
     |FINSI;
     #agim0052#8 = nRecibo;
     |PINTA #agim0052#8;
|FPRC;

|PROCESO Impresion;
     |IMPRE 0;
     |SI FSalida = 0;
          aInforme = #agim0052#16;
          |QBF aInforme;
          |INFOR aInforme;
          |SI FSalida = 0;
               |HAZ Fecha;
               |PRINT;
               |PIEINF;
          |SINO;
               aMensaje = "0000Informe " + aInforme + " inaccesible!";
               |MENAV aMensaje;
          |FINSI;
          |FININF;
      |FINSI;
      |FINIMP;
|FPRC;

|PROCESO Historico;
     |DDEFECTO #agim0053;
     #agim0053#8 = #agim0052#8;
     |LEE 101#agim0053.=;
     |SI FSalida ! 0; |GRABA 020#agim0053.b; |FINSI;
     #agim0053#0 = #agim0052#0;
     #agim0053#1 = #agim0052#1;
     #agim0053#2 = #agim0052#2;
     #agim0053#3 = #agim0052#3;
     #agim0053#4 = #agim0052#4;
     #agim0053#5 = #agim0052#5;
     #agim0053#6 = #agim0052#6;
     #agim0053#7 = #agim0052#7;
     #agim0053#8 = #agim0052#8;
     #agim0053#9 = #agim0052#9;
     #agim0053#10 = #agim0052#10;
     #agim0053#11 = #agim0052#11;
     #agim0053#12 = #agim0052#12;
     #agim0053#13 = #agim0052#13;
     #agim0053#14 = #agim0052#14;
     #agim0053#15 = #agim0052#15;
     #agim0053#17 = #agim0052#17;
     #agim0053#18 = #agim0052#18;
     #agim0053#19 = #agim0052#19;
     #agim0053#20 = #agim0052#20;
     #agim0053#21 = #agim0052#21;
     #agim0053#22 = #agim0052#22;
     |GRABA 020#agim0053.a;
     |LIBERA #agim0053;
|FPRC;

|PROCESO Fecha;
     fFecha = #agim0052#15;
     aFecha = #agim0052#15;
     eaDia = aFecha % 102;
     eaDia = ("00" + eaDia) % -102;
     eaAny = aFecha % -104;

     fMes = fFecha % 0;  ||Para pasar el mes a letra
     eaMes = fMes % 11;
     |QBF eaMes;
|FPRC;
