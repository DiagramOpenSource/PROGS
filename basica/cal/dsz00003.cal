|FICHEROS;
     dsw00003;

     dsficher;

     agifigen;

     origen@;
     destin@;
|FIN;

|VARIABLES;
     n1Vent              = 0;
     nGrid1              = 0;
     nLbl1               = -1;
     nLbl2               = -1;
     nLbl3               = -1;
     nLbl4               = -1;
     nRango              = 0;
     nHandle             = 0;
     nTree               = 0;
     nLinea              = 0;
     nLong               = 0;
     nCampo              = 0;
     nCaracter           = 0;
     nPos                = 0;
     nPrime              = 0;
     nCmp                = 0;
     nCmpCli             = 0;
     nTCmp               = 0;
     nPanta              = 0;
     nCarac              = 0;
     nCod                = 0;
     nImportar           = 0;
     nReg                = 0;

     aFic                = "";
     aFicO               = "";
     aFicD               = "";
     aFicCSV             = "";
     aFicTar             = "";
     aEsc1               = "";
     aEsc2               = "";
     aRetu               = "";
     aTecla              = "";
     aAlfa               = "";
     aPathTmp            = "";
     aPathTar            = "";
     aAbre               = "";
     aCampoA             = "";
     aCampoB             = "";
     aCadena             = "";
     aLong               = "";
     aTab                = "";
     aCarac              = "";
     aRuta               = "";
     aHora               = "";
     aDBase              = "";
     aDBass              = "";
     aPathPaq            = "";
     aPathApl            = "";
     aPathCtO            = "";
     aPathCtD            = "";
     aPathDes            = "";
     aPaq                = "";
     aApl                = "";
     aPro                = "";
     aMas                = "";
     aQQ                 = "";
     aDir                = "";
     aOri                = "";
     aDes                = "";
     aParaBor            = "";
     aParaIni            = "";
     aEjecuta            = "";
     aLee                = "";
     aDoc                = "";
     aExt                = "";
     aIPRemoto           = "";
     aBorra              = "";
     aRojo               = "0,0,0;255,80,80";
     aPass               = "0,0,0;255,80,80";

     fFecha              = @;

 {-1}aVent               = "";
     aVent1              = 0;
     aVent2              = 0;
     aVent3              = 0;
     aVent4              = 0;
     aVent5              = "";

 {-1}sTree               = 0;
     sT_nID              = 0;
     sT_nOper            = 0;
     sT_aData            = "";

  {1}aContiene           = "";

     &eaOrigen           = "";
     &eaDestino          = "";
     &eaUnidadBasico     = "";
|FIN;

|PROCESO FinVent1;
     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA n1Vent;
|FPRC;

|| -------------------------------------------------------------------------

|PROCESO DocMegwordl;
     aPathCtO = aPathApl + "emisiones";
     aPathCtO = aPathCtO + "/" + (("00000" + #origen@#0) % -105);
     aPathCtO = aPathCtO + "/" + (("0000" + #origen@#1) % -104);
     aPathCtO = aPathCtO + "/";

     aPathCtD = aDBass + "contasoc/emisiones";
     aPathCtD = aPathCtD + "/" + (("00000" + #destin@#0) % -105); |MKDIR aPathCtD;
     aPathCtD = aPathCtD + "/" + (("0000" + #destin@#1) % -104);  |MKDIR aPathCtD;
     aPathCtD = aPathCtD + "/";

     aOri = aPathCtO + #origen@#2;   |QBF aOri;
     aDes = aPathCtD + #origen@#2;   |QBF aDes;
     |COPIA_FICHERO aOri, aDes;
|FPRC;

|PROCESO DocSocm0005;
     aPathCtO = aPathApl + "documentos";
     aPathCtO = aPathCtO + "/actas";
     aPathCtO = aPathCtO + "/";

     aPathCtD = aDBass + "basica/documentos/actas/";

     aFicO = ("00000" + #origen@#0) % -105;
     aFicO = aFicO + ("0000"  + #origen@#1) % -104;
     aFicO = aFicO + ("0000"  + #origen@#2) % -104;
     aFicO = aFicO + "1." + #origen@#5;             |QBF aFicO;

     aFicD = ("00000" + #destin@#0) % -105;
     aFicD = aFicD + ("0000"  + #destin@#1) % -104;
     aFicD = aFicD + ("0000"  + #destin@#2) % -104;
     aFicD = aFicD + "1." + #destin@#5;             |QBF aFicD;

     aOri = aPathCtO + aFicO;
     aDes = aPathCtD + aFicD;
     |COPIA_FICHERO aOri, aDes;

     aFicO = ("00000" + #origen@#0) % -105;
     aFicO = aFicO + ("0000"  + #origen@#1) % -104;
     aFicO = aFicO + ("0000"  + #origen@#2) % -104;
     aFicO = aFicO + "2." + #origen@#6;             |QBF aFicO;

     aFicD = ("00000" + #destin@#0) % -105;
     aFicD = aFicD + ("0000"  + #destin@#1) % -104;
     aFicD = aFicD + ("0000"  + #destin@#2) % -104;
     aFicD = aFicD + "2." + #destin@#6;             |QBF aFicD;

     aOri = aPathCtO + aFicO;
     aDes = aPathCtD + aFicD;
     |COPIA_FICHERO aOri, aDes;
|FPRC;

|PROCESO Registros;
     aPathDes = aDBass + #dsficher#0 + "/fich/";

     |SI #dsficher#0 = "contagen";
         aPathDes = aDBass + #dsficher#0 + "/fich/000000/";
     |FINSI;

     |QBT aPathDes;

     aPro = #dsficher#0 + "/def/" + #dsficher#1;  |QBT aPro;
     aMas = aDBass + aPro;                        |QBT aMas;

     |CARGA_DEF aMas, origen@;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |CARGA_DEF aMas, destin@;
     |SI FSalida ! 0;
         |DESCARGA_DEF #origen@;
         |ACABA;
     |FINSI;

     aQQ   = "|NC";
     aAlfa = #origen@#aQQ#;
     nTCmp = aAlfa;
     nTCmp = nTCmp - 1;

     |PATH_DAT #origen@#aPathApl#;
     |PATH_DAT #destin@#aPathDes#;

     |ABRE #origen@;
     |ABRE #destin@;

     nCmpCli = #dsficher#4;

     |DDEFECTO #origen@;
     #origen@#nCmpCli# = #dsw00003#0;
     |LEE 000#origen@.p;
     |PARA;  |SI FSalida = 0;  |HACIENDO;
          |SI #origen@#nCmpCli# = #dsw00003#0;
              |PARA nCmp = 0;  |SI nCmp [ nTCmp;  |HACIENDO nCmp = nCmp + 1;
                    #destin@#nCmp# = #origen@#nCmp#;
              |SIGUE;
              #destin@#nCmpCli# = #dsw00003#2;

              |GRABA 000#destin@.n;
              |LIBERA #destin@;

              |SI aPro = "contasoc/def/megwordl.mas";
                  |HAZ DocMegwordl;
              |FINSI;

              |SI aPro = "basica/def/socm0005.mas";
                  |HAZ DocSocm0005;
              |FINSI;

              |BORRA 000#origen@.a;
              |LIBERA #origen@;
          |FINSI;

          |LEE 000#origen@.s;
     |SIGUE;

     |CIERRA #origen@;
     |CIERRA #destin@;

     |DESCARGA_DEF #destin@;
     |DESCARGA_DEF #origen@;
|FPRC;

|PROCESO dsficher;
     |SI #dsficher#5 = "N";
         |ACABA;
     |FINSI;

     |SI #dsficher#0 = "facturar";
         |ACABA;
     |FINSI;

     aPathApl = aPathPaq + #dsficher#0;  |QBF aPathApl;

     |SI #dsficher#0 = "contagen";
         aPathApl = aPathApl + "/000000";
     |FINSI;

     aPathApl = aPathApl + "/";

     |HAZ Registros;
|FPRC;

|DEFBUCLE dsficher;
     #dsficher#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, dsficher;
|FIN;

|PROCESO CopiaEmpConta;
     aPathCtO = aPathApl + (("00000" + #origen@#2) % -105) + #origen@#3;
     aPathCtD = aPathDes + (("00000" + #destin@#2) % -105) + #destin@#3;
     |MKDIR aPathCtD;

     aPathCtO = aPathCtO + "/";
     aPathCtD = aPathCtD + "/";

     aDir = aPathCtO + "*.*";
     |_PDIR aDir;
     |PARA; |SI FSalida = 0; |HACIENDO;
            aFic = aDir - aPathCtO;
            aOri = aDir;
            aDes = aPathCtD + aFic;
            |COPIA_FICHERO aOri, aDes;

            |_SDIR aDir;
     |SIGUE;
|FPRC;

|PROCESO Contagen;
     aPathApl = aPathPaq + "contagen";
     aPathApl = aPathApl + "/";

     aPathDes = aDBass + "contagen/fich/";
     |QBT aPathDes;

     aMas = aDBass + "contagen/def/canempre.mas";

     |CARGA_DEF aMas, origen@;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |CARGA_DEF aMas, destin@;
     |SI FSalida ! 0;
         |DESCARGA_DEF #origen@;
         |ACABA;
     |FINSI;

     aQQ   = "|NC";
     aAlfa = #origen@#aQQ#;
     nTCmp = aAlfa;
     nTCmp = nTCmp - 1;

     |PATH_DAT #origen@#aPathApl#;
     |PATH_DAT #destin@#aPathDes#;

     |ABRE #origen@;
     |ABRE #destin@;

     nCmpCli = 2;

     |DDEFECTO #origen@;
     #origen@#nCmpCli# = #dsw00003#0;
     |LEE 000#origen@.];
     |PARA;  |SI FSalida = 0;  |HACIENDO;
          |SI #origen@#nCmpCli# ! #dsw00003#0;
              |SAL;
          |FINSI;

          |PARA nCmp = 0;  |SI nCmp [ nTCmp;  |HACIENDO nCmp = nCmp + 1;
                #destin@#nCmp# = #origen@#nCmp#
          |SIGUE;
          #destin@#nCmpCli# = #dsw00003#2;

          |GRABA 000#destin@.n;
          |LIBERA #destin@;

          |HAZ CopiaEmpConta;

          |LEE 000#origen@.s;
     |SIGUE;

     |CIERRA #origen@;
     |CIERRA #destin@;

     |DESCARGA_DEF #destin@;
     |DESCARGA_DEF #origen@;
|FPRC;

|PROCESO CopiaFicGAD;
     aOri = aPathApl + #origen@#9; |QBF aOri;
     aDoc = ("000000000" + #origen@#0) % -109;
     aExt = #origen@#9 - aDoc;  |QBT aExt;

     aDes       = (("000000000" + #destin@#0) % -109) + aExt;
     #destin@#9 = aDes;

     aDes = #destin@#7;  |QBF aDes;  |MKDIR aDes;
     aDes = aDes + #destin@#9;  |QBF aDes;

     |COPIA_FICHERO aOri, aDes;
|FPRC;

|PROCESO GAD;
     aPathApl = aPathPaq + "dsarchi";
     aPathApl = aPathApl + "/";

     aPathDes = aDBass + "dsarchi/fich/";
     |QBT aPathDes;

     aMas = aDBass + "dsarchi/def/dsarm005.mas";

     |CARGA_DEF aMas, origen@;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |CARGA_DEF aMas, destin@;
     |SI FSalida ! 0;
         |DESCARGA_DEF #origen@;
         |ACABA;
     |FINSI;

     aQQ   = "|NC";
     aAlfa = #origen@#aQQ#;
     nTCmp = aAlfa;
     nTCmp = nTCmp - 1;

     |PATH_DAT #origen@#aPathApl#;
     |PATH_DAT #destin@#aPathDes#;

     |ABRE #origen@;
     |ABRE #destin@;

     nReg = 0;
     |LEE 000#destin@.u;
     |SI FSalida = 0;
         nReg = #destin@#0;
     |FINSI;

     nCmpCli = 8;

     |SELECT #3#origen@;
     |DDEFECTO #origen@;
     #origen@#nCmpCli# = #dsw00003#0;
     #origen@#4        = "01.01.0000";
     #origen@#5        = "";
     |LEE 000#origen@.];
     |PARA;  |SI FSalida = 0;  |HACIENDO;
          |SI #origen@#nCmpCli# ! #dsw00003#0;
              |SAL;
          |FINSI;

          |PARA nCmp = 0;  |SI nCmp [ nTCmp;  |HACIENDO nCmp = nCmp + 1;
                #destin@#nCmp# = #origen@#nCmp#
          |SIGUE;

          nReg              = nReg + 1;
          #destin@#0        = nReg;
          #destin@#nCmpCli# = #dsw00003#2;

          |HAZ CopiaFicGAD;

          |GRABA 020#destin@.n;
          |LIBERA #destin@;

          |LEE 000#origen@.s;
     |SIGUE;

     |CIERRA #origen@;
     |CIERRA #destin@;

     |DESCARGA_DEF #destin@;
     |DESCARGA_DEF #origen@;
|FPRC;

|PROCESO Listin;
     aPathApl = aPathPaq + "integral";
     aPathApl = aPathApl + "/";

     aPathDes = aDBass + "integral/fich/";
     |QBT aPathDes;

     aMas = aDBass + "integral/def/dsam0106.mas";

     |CARGA_DEF aMas, origen@;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |CARGA_DEF aMas, destin@;
     |SI FSalida ! 0;
         |DESCARGA_DEF #origen@;
         |ACABA;
     |FINSI;

     aQQ   = "|NC";
     aAlfa = #origen@#aQQ#;
     nTCmp = aAlfa;
     nTCmp = nTCmp - 1;

     |PATH_DAT #origen@#aPathApl#;
     |PATH_DAT #destin@#aPathDes#;

     |ABRE #origen@;
     |ABRE #destin@;

     nCmpCli = 0;

     |DDEFECTO #origen@;
     #origen@#nCmpCli# = #dsw00003#1;
     |LEE 000#origen@.];
     |PARA;  |SI FSalida = 0;  |HACIENDO;
          |SI #origen@#nCmpCli# ! #dsw00003#1;
              |SAL;
          |FINSI;

          |PARA nCmp = 0;  |SI nCmp [ nTCmp;  |HACIENDO nCmp = nCmp + 1;
                #destin@#nCmp# = #origen@#nCmp#
          |SIGUE;

          #destin@#nCmpCli# = #dsw00003#1;

          |GRABA 000#destin@.n;
          |LIBERA #destin@;

          |LEE 000#origen@.s;
     |SIGUE;

     |CIERRA #origen@;
     |CIERRA #destin@;

     |DESCARGA_DEF #destin@;
     |DESCARGA_DEF #origen@;

     aMas = aDBass + "integral/def/dsam0107.mas";

     |CARGA_DEF aMas, origen@;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |CARGA_DEF aMas, destin@;
     |SI FSalida ! 0;
         |DESCARGA_DEF #origen@;
         |ACABA;
     |FINSI;

     aQQ   = "|NC";
     aAlfa = #origen@#aQQ#;
     nTCmp = aAlfa;
     nTCmp = nTCmp - 1;

     |PATH_DAT #origen@#aPathApl#;
     |PATH_DAT #destin@#aPathDes#;

     |ABRE #origen@;
     |ABRE #destin@;

     nCmpCli = 0;

     |DDEFECTO #origen@;
     #origen@#nCmpCli# = #dsw00003#1;
     |LEE 000#origen@.];
     |PARA;  |SI FSalida = 0;  |HACIENDO;
          |SI #origen@#nCmpCli# ! #dsw00003#1;
              |SAL;
          |FINSI;

          |PARA nCmp = 0;  |SI nCmp [ nTCmp;  |HACIENDO nCmp = nCmp + 1;
                #destin@#nCmp# = #origen@#nCmp#
          |SIGUE;

          #destin@#nCmpCli# = #dsw00003#1;

          |GRABA 000#destin@.n;
          |LIBERA #destin@;

          |LEE 000#origen@.s;
     |SIGUE;

     |CIERRA #origen@;
     |CIERRA #destin@;

     |DESCARGA_DEF #destin@;
     |DESCARGA_DEF #origen@;
|FPRC;

|PROCESO dsw00003Imp;
     |SI #dsw00003#2 = 0;
         |BORRA 020#dsw00003.a;
         |LIBERA #dsw00003;

         |PULSATECLA;
         |REFRESCACONTROL nGrid1;
         |ACABA;
     |FINSI;

     |PULSATECLA;
     |BUCLE dsficher;

     |PULSATECLA;
     |HAZ Contagen;

     |PULSATECLA;
     |HAZ Listin;

     |PULSATECLA;
     |HAZ GAD;

     |BORRA 020#dsw00003.a;
     |LIBERA #dsw00003;
     |REFRESCACONTROL nGrid1;
|FPRC;

|DEFBUCLE dsw00003Imp;
     #dsw00003#1;
     ;
     INICIO;
     FINAL;
     be;
     NULL, dsw00003Imp;
|FIN;

|PROCESO Importacion;
     |CONFI "0000SLa importaci¢n la realizar  de los registros con c¢digo destino. Realizamos la importaci¢n.";
     |SI FSalida ! 0;
         |MENAV "0000Proceso cancelado.";
         |ACABA;
     |FINSI;

     |VENTANA 0501, 0540, -1, 16, "Realizando importaci¢n, espere por favor";
     n1Vent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PTEC 802;  |PAUSA;

     aPathPaq = aPathPaq + "/";

     |BUCLE dsw00003Imp;

     |HAZ FinVent1;
|FPRC;

|PROCESO PideCod;
     aMas = aDBase + "def/dsw00003.mas";
     |CARGA_DEF aMas, origen@;
     |SI FSalida < 0;
         |ACABA;
     |FINSI;

     |VENTANA 0501, 0740, -1, 16, "C¢digo destino";
     n1Vent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PTEC 802;  |PAUSA;

     aFic = "dsw00003" + Usuario;  |NOME_DAT #origen@#aFic#;

     |ABRE #agifigen;
     |ABRE #origen@;  |SELECT #2#origen@;

     E_inf = 00000;
     E_sup = 99999;
     |PARA;  |SI;  |HACIENDO;
          |LEE 000#agifigen.u;
          nCod = 0;
          |SI #agifigen#0 < 99999;
              nCod = #agifigen#0 + 1;
          |FINSI;

          nCod = 0620 ? 1;

          #agifigen#0 = nCod;
          |LEE 000#agifigen.=;
          |SI FSalida ! 0;
              #origen@#2 = nCod;
              |LEE 000#origen@.=;
              |SI FSalida ! 0;
                  |SAL;
              |FINSI;
          |FINSI;

          |MENAV "0000El c¢digo ya existe en la base de datos.";
     |SIGUE;

     |CIERRA #agifigen;
     |CIERRA #origen@;
     |DESCARGA_DEF #origen@;

     |HAZ FinVent1;

     |LEE 101#dsw00003.=;
     |SI FSalida = 0;
         #dsw00003#2 = nCod;
         #dsw00003#3 = "";
         |GRABA 020#dsw00003.a;
         |LIBERA #dsw00003;
     |FINSI;

     |REFRESCACONTROL nGrid1;
|FPRC;

|PROCESO Evnt1;
     |SI FSalida = 1;  |O FSalida = 2;
         |LEE 000#dsw00003.=;
     |FINSI;

     |SI FSalida = 4;
         |HAZ PideCod;
     |FINSI;
|FPRC;

|PROCESO dsw00003Cheq;
     #dsw00003#3 = aRojo;

     #agifigen#0 = #dsw00003#0;
     |LEE 000#agifigen.=;
     |SI FSalida ! 0;
         #dsw00003#2 = #dsw00003#0;
         #dsw00003#3 = "";
     |FINSI;

     |GRABA 020#dsw00003.a;
     |LIBERA #dsw00003;
|FPRC;

|DEFBUCLE dsw00003Cheq;
     #dsw00003#1;
     ;
     INICIO;
     FINAL;
     be;
     NULL, dsw00003Cheq;
|FIN;

|PROCESO LeePaquete;
     |MENAV "0000Seleccione el paquete tgz a importar";

     |DBASE aDBase;   |QBF aDBase;

     |HAZ LeeUnidadBasico;
     aPathTmp = eaUnidadBasico + "\documentos";         |RMKDIR aPathTmp;
     aPathTmp = aPathTmp + "\dsselect";                 |RMKDIR aPathTmp;
     aPathTmp = aPathTmp + "\";

     eaOrigen  = aDBase + "plantillas/dsselect.exe";
     eaDestino = aPathTmp + "dsselect.exe";
     |HAZ EnviaFicheroConMD5;
     |XABRE "EC", eaDestino, 0;
     |SI FSalida < 0;  |ACABA;  |FINSI;

     |PULSATECLA;
     aParaBor = aPathTmp + "dsselect.txt";
     aParaIni = aPathTmp + "dsselect.ini";

     |RFBORRA aParaIni;

     aAlfa = &34 + eaUnidadBasico + &34 + " " + &34 + aParaBor + &34;
     |XABRE "CW", aParaIni, nHandle;
     |SI FSalida ] 0;
         |XGRABA nHandle, aAlfa;
     |FINSI;
     |XCIERRA nHandle;

     aEjecuta = aPathTmp + "dsselect.exe";
     |RSYSTEM aEjecuta;

     aAbre = aPathTmp + "dsselect.txt";
     |XABRE "CU", aAbre, nHandle;
     |SI FSalida < 0;
         |RFBORRA aParaBor;
         |RFBORRA aParaIni;

         |ACABA;
     |FINSI;

     |XLEE nHandle, 250, aLee;
     |XCIERRA nHandle;
     |QBF aLee;

     |SI aLee = "";
         |MENAV "0000No se ha seleccionado un paquete";
         |ACABA;
     |FINSI;

     aLong = aLee % 0;
     nLong = aLong;
     aPaq  = "";
     |PARA nCarac = 1;  |SI nCarac [ nLong;  |HACIENDO nCarac = nCarac + 1;
           nPos   = (nCarac * 100) + 1;
           aCarac =  aLee % nPos;
           |SI aCarac = "/";  |O aCarac = "\";
               aPaq = "";
           |SINO;
               aPaq = aPaq + aCarac;
           |FINSI;
     |SIGUE;

     aLong = aPaq % 0;
     |SI aLong ! "18";
         |MENAV "0000El paquete no es v lido";
         |ACABA;
     |FINSI;

     aAlfa = (aPaq % -103) < "";
     |SI aAlfa ! "tgz";
         |MENAV "0000El paquete no es v lido";
         |ACABA;
     |FINSI;

     |VENTANA 0501, 0540, -1, 16, "Resolviendo paquete";
     n1Vent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PTEC 802;  |PAUSA;

     |DBASS aDBass;
     |DBASE aDBase;
     aPathPaq = aDBase + "tmp";               |MKDIR aPathPaq;
     aPathPaq = aDBase + "tmp/paquetes";      |MKDIR aPathPaq;
     aPathPaq = aDBase + "tmp/paquetes/";

     aOri = aLee;
     aDes = (aPathPaq + aPaq) < "";

     aIPRemoto   = "";
     |IP_REMOTO aIPRemoto;

     |SI aIPRemoto ! "";
         |RECIBE_FICHERO aOri, aDes;
     |SINO;
         |COPIA_FICHERO aOri, aDes;
     |FINSI;

     |PULSATECLA;
     |XABRE "E", aDes, 0;
     |SI FSalida < 0;
         |MENAV "0000Ha habido un error a enviar el paquete al servidor. Vuelva a intentarlo.";
         |HAZ FinVent1;

         |ACABA;
     |FINSI;

     |DESCOMPRIME aDes;
     |PULSATECLA;

     |FBORRA aDes;

     aDes = aDes - ".tgz" + ".tar";
     |XABRE "E", aDes, 0;
     |SI FSalida < 0;
         |MENAV "0000Ha habido un error en descomprimir el paquete al servidor. Vuelva a intentarlo.";
         |HAZ FinVent1;

         |ACABA;
     |FINSI;

     |PULSATECLA;
     |DETAR aDes, aPathPaq;
     |PULSATECLA;

     |FBORRA aDes;

     aPathPaq = aDBase + "tmp/paquetes/" + (aPaq - ".tgz");
     aPathApl = aPathPaq + "/basica/";

     aMas = aDBase + "def/agifigen.mas";
     |CARGA_DEF aMas, origen@;
     |SI FSalida < 0;
         |MENAV "0000Error inesperado. Vuelva a intentarlo.";
         |HAZ FinVent1;

         |ACABA;
     |FINSI;

     |PATH_DAT #origen@#aPathApl#;
     |ABRE #origen@;
     |LEE 000#origen@.p;

     |PARA;  |SI FSalida = 0;  |HACIENDO;
          #dsw00003#0 = #origen@#0;
          #dsw00003#1 = #origen@#1;
          |GRABA 020#dsw00003.n;
          |LIBERA #dsw00003;

          |LEE 000#origen@.s;
     |SIGUE;

     |CIERRA #origen@;
     |DESCARGA_DEF #origen@;

     |HAZ FinVent1;
|FPRC;

|PROCESO BorraCarpeta;
     aEjecuta = aDBass + "bin/agirm -r " + aPathPaq;

     |SYSTEM aEjecuta;
|FPRC;

|PROCESO Cancelar;
     |PTEC 807;
|FPRC;

|PROGRAMA;
     |VENTANA 0501, 0730, -1, 16, "Introduzca password";
     n1Vent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     aPass = "";
     E_inf = "";
     E_sup = "20";
     aPass = 0605 ? -1;  |QBF aPass;

     |HAZ FinVent1;

     |SI aPass ! "<MYPASWD>";
         |MENAV "0000 Password de acceso incorrecto.";
         |ACABA;
     |FINSI;

     |CLS;

     |HAZ LeePaquete;
     |PULSATECLA;

     |LEE 000#dsw00003.p;
     |SI FSalida ! 0;
         |MENAV "0000Paquete no v lido.";
         |ACABA;
     |FINSI;

     |ABRE #agifigen;
     |BUCLE dsw00003Cheq;
     |CIERRA #agifigen;

     |CONTROL_SIMPLE 0, "LABEL,{{15}}Importaci¢n de Datos Clientes de otra PI", 0502, 0590, NULL;

     aAlfa = "LABEL,{{11}}En rojo c¢digo origen ya existe en destino, ";
     aAlfa = aAlfa + "doble click en el registro para nuevo c¢digo";
     |CONTROL_SIMPLE 0, aAlfa, 0625, 0698, NULL;

     |CONTROL_SIMPLE 0, "BOTON, {{207}}Cancelar", 3272, 3282, Cancelar;

     nRango = 4 + 8 + 16 + 32 + 128;
     |LINEAL_SIMPLE #1#dsw00003, nRango, 0702, 3098, NULL, NULL, Evnt1;
     nGrid1 = FSalida;

     aEsc1  = &255 + "806";
     aEsc2  = &255 + "807";
     aRetu  = &255 + "802";
     |PARA; |SI;  |HACIENDO;
         FSalida   = "::{{001}}Importar," + nGrid1;
         nImportar = 0;
         |LEETECLA aTecla;
         |SI aTecla = aEsc1; nImportar = 1;  |SAL;  |FINSI;
         |SI aTecla = aEsc2;                 |SAL;  |FINSI;
         |SI aTecla = aRetu; nImportar = 1;  |SAL;  |FINSI;
     |SIGUE;

     |SI nImportar = 1;
         |HAZ Importacion;
     |SINO;
         |MENAV "0000Proceso cancelado.";
     |FINSI;

     |PULSATECLA;
     |HAZ BorraCarpeta;
     |PULSATECLA;
|FPRO;

|PROCESO T80;  |TIPO 80;
     aFic = "dsw00003" + Usuario;  |NOME_DAT #dsw00003#aFic#;

     |ABRE #dsw00003;  |CIERRA #dsw00003;  |DELINDEX #dsw00003;

     |ABRET #dsw00003;

     FSalida = 3299;
|FPRC;

|PROCESO T90;  |TIPO 90;
     |CIERRAT #dsw00003;
     |DELINDEX #dsw00003;
|FPRC;
