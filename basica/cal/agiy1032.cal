|FICHEROS;
     :/integral/def/dsam0121 #121;
     :/integral/def/dsam0122 #122;
|FIN;

|VARIABLES;
     aNombreFich  = "";
     aNombreTexto = "";
     aBase        = "";
     aPlantilla   = "";
     aDirMenu     = "";
     aOrigen      = "";
     aDestino     = "";
     aExtension   = "";
     aCadena1     = "";
     aCadena2     = "";
     aAlfa        = "";
     aAlfa1       = "";
     aAlfa2       = "";
     aAlfa3       = "";
     aAlfa4       = "";
     aLen         = "";
     aImpor1      = "";
     aImpor2      = "";
     aImpor3      = "";
     aImpor4      = "";
     aCadena      = "";
     aCaracter    = "";
     aDecima      = "";
     aEntero      = "";
     aLong        = "";
     aMenav       = "";
     aLetra       = "";
     aIPRemoto    = "";

     nSwBueno      = 0;
     nContaPuntero = 0;
     nConta        = 0;
     nEmpresas     = 0;
     nLen          = 0;
     nCampo        = 0;
     nPos          = 0;
     nLong         = 0;
     nDecimal      = 0;
     nCaracter     = 0;

     &eaContador      = "";
     &eaImporte       = "";
     &eaAlfa          = "";
     &eaOrigen        = "";
     &eaDestino       = "";
     &eaNomUbicacion  = "";
     &eaRutaDocumento = "";

     &enFSalida       = 0;
     &enCodUbica      = 0;
     &eaDSMAC         = "";
|FIN;

|PROCESO Importe;    || Calculo para poner las puntos y comas
                     || en el importe

     aDecima   = "";
     aEntero   = "";
     aLong     = eaImporte % 0;
     nLong     = aLong;
     nDecimal  = 0;
     |PARA nCaracter = 1;  |SI nCaracter [ nLong;  |HACIENDO nCaracter = nCaracter + 1;
           nPos      = (100 * nCaracter) + 1;
           aCaracter = eaImporte % nPos;
           |SI aCaracter = ".";
               nDecimal = 1;
           |SINO;
               |SI nDecimal = 0;
                   aEntero = aEntero + aCaracter;
               |SINO;
                   aDecima = aDecima + aCaracter;
               |FINSI;
           |FINSI;
     |SIGUE;
     aDecima = (aDecima + "00") % 102;
     eaImporte = aEntero;

     aLong = eaImporte % 0;
     nLong = aLong;
     eaImporte = "             " + eaImporte;
     eaImporte = eaImporte % -113;
     aImpor1   = eaImporte % -103;
     aImpor2   = eaImporte % -403;
     aImpor3   = eaImporte % -703;
     aImpor4   = eaImporte % -1004;
     |SI nLong ] 10;
         |SI aImpor4 ! "  -";
             eaImporte = aImpor4 + "." + aImpor3  + "." + aImpor2 + "." + aImpor1;
         |SINO;
             eaImporte = aImpor4 + aImpor3  + "." + aImpor2 + "." + aImpor1;
      |FINSI;
    |SINO;
        |SI nLong ] 7;
            |SI aImpor3 ! "  -";
                eaImporte = aImpor3  + "." + aImpor2 + "." + aImpor1;
            |SINO;
                eaImporte = aImpor3 + aImpor2 + "." + aImpor1;
            |FINSI;
        |SINO;
            |SI nLong ] 4;
                |SI aImpor2 ! "  -";
                    eaImporte = aImpor2 + "." + aImpor1;
                |SINO;
                    eaImporte = aImpor2 + aImpor1;
                |FINSI;
            |SINO;
                eaImporte = aImpor1;
            |FINSI;
        |FINSI;
     |FINSI;

     eaImporte = ("             " + eaImporte + "," + aDecima) % -113;

     |SI eaImporte = "            0";  eaImporte = "             ";  |FINSI;
     |SI eaImporte = "         0,00";  eaImporte = "             ";  |FINSI;
|FPRC;

|PROCESO Importe6;    || Calculo para poner las puntos y comas
                     || en el importe

     aDecima   = "";
     aEntero   = "";
     aLong     = eaImporte % 0;
     nLong     = aLong;
     nDecimal  = 0;
     |PARA nCaracter = 1;  |SI nCaracter [ nLong;  |HACIENDO nCaracter = nCaracter + 1;
           nPos      = (100 * nCaracter) + 1;
           aCaracter = eaImporte % nPos;
           |SI aCaracter = ".";
               nDecimal = 1;
           |SINO;
               |SI nDecimal = 0;
                   aEntero = aEntero + aCaracter;
               |SINO;
                   aDecima = aDecima + aCaracter;
               |FINSI;
           |FINSI;
     |SIGUE;
     aDecima = (aDecima + "000000") % 106;
     eaImporte = aEntero;

     aLong = eaImporte % 0;
     nLong = aLong;
     eaImporte = "             " + eaImporte;
     eaImporte = eaImporte % -113;
     aImpor1   = eaImporte % -103;
     aImpor2   = eaImporte % -403;
     aImpor3   = eaImporte % -703;
     aImpor4   = eaImporte % -1004;
     |SI nLong ] 10;
         |SI aImpor4 ! "  -";
             eaImporte = aImpor4 + "." + aImpor3  + "." + aImpor2 + "." + aImpor1;
         |SINO;
             eaImporte = aImpor4 + aImpor3  + "." + aImpor2 + "." + aImpor1;
      |FINSI;
    |SINO;
        |SI nLong ] 7;
            |SI aImpor3 ! "  -";
                eaImporte = aImpor3  + "." + aImpor2 + "." + aImpor1;
            |SINO;
                eaImporte = aImpor3 + aImpor2 + "." + aImpor1;
            |FINSI;
        |SINO;
            |SI nLong ] 4;
                |SI aImpor2 ! "  -";
                    eaImporte = aImpor2 + "." + aImpor1;
                |SINO;
                    eaImporte = aImpor2 + aImpor1;
                |FINSI;
            |SINO;
                eaImporte = aImpor1;
            |FINSI;
        |FINSI;
     |FINSI;

     eaImporte = ("             " + eaImporte + "," + aDecima) % -113;

     |SI eaImporte = "            0";      eaImporte = "             ";  |FINSI;
     |SI eaImporte = "         0,000000";  eaImporte = "             ";  |FINSI;
|FPRC;

|PROCESO PonLetraEuro;    || Calculo para poner Letras al Euro
     aDecima   = "";
     aEntero   = "";
     aLong     = eaImporte % 0;
     nLong     = aLong;
     nDecimal  = 0;
     |PARA nCaracter = 1;  |SI nCaracter [ nLong;  |HACIENDO nCaracter = nCaracter + 1;
           nPos      = (100 * nCaracter) + 1;
           aCaracter = eaImporte % nPos;
           |SI aCaracter = ".";
               nDecimal = 1;
           |SINO;
               |SI nDecimal = 0;
                   aEntero = aEntero + aCaracter;
               |SINO;
                   aDecima = aDecima + aCaracter;
               |FINSI;
           |FINSI;
     |SIGUE;
     aDecima = (aDecima + "00") % 102;
     eaImporte = "E" + aEntero + "." + aDecima;

     |LETRA eaImporte;
     aAlfa = eaImporte % -105;
     |SI aAlfa = "CENT.";
         eaImporte = eaImporte - "CENT." + "CENTIMOS";
     |FINSI;
|FPRC;

|PROCESO PonLetraEuro6;    || Calculo para poner Letras al Euro
     aDecima   = "";
     aEntero   = "";
     aLong     = eaImporte % 0;
     nLong     = aLong;
     nDecimal  = 0;
     |PARA nCaracter = 1;  |SI nCaracter [ nLong;  |HACIENDO nCaracter = nCaracter + 1;
           nPos      = (100 * nCaracter) + 1;
           aCaracter = eaImporte % nPos;
           |SI aCaracter = ".";
               nDecimal = 1;
           |SINO;
               |SI nDecimal = 0;
                   aEntero = aEntero + aCaracter;
               |SINO;
                   aDecima = aDecima + aCaracter;
               |FINSI;
           |FINSI;
     |SIGUE;
     aDecima = (aDecima + "000000") % 106;
     eaImporte = "E" + aEntero + "." + aDecima;

     |LETRA eaImporte;
     aAlfa = eaImporte % -105;
     |SI aAlfa = "CENT.";
         eaImporte = eaImporte - "CENT." + "CENTIMOS";
     |FINSI;
|FPRC;

|PROCESO QuitaRaros;
     |QBF eaAlfa;
     aCadena = "";
     aLen    = eaAlfa % 0;
     nLen    = aLen;
     |PARA nCampo = 1;  |SI nCampo [ nLen;  |HACIENDO nCampo = nCampo + 1;
           nPos = (100 * nCampo) + 1;
           aCaracter = eaAlfa % nPos;
           |SI aCaracter = "¥";  aCaracter = &209; |FINSI;
           |SI aCaracter = "¤";  aCaracter = &241; |FINSI;
           |SI aCaracter = " ";  aCaracter = &225; |FINSI;
           |SI aCaracter = "‚";  aCaracter = &233; |FINSI;
           |SI aCaracter = "¡";  aCaracter = &237; |FINSI;
           |SI aCaracter = "¢";  aCaracter = &243; |FINSI;
           |SI aCaracter = "£";  aCaracter = &250; |FINSI;
           |SI aCaracter = "§";  aCaracter = &176; |FINSI;
           |SI aCaracter = "¦";  aCaracter = &170; |FINSI;
           aCadena = aCadena + aCaracter;
     |SIGUE;
     eaAlfa = aCadena;
|FPRC;

|PROCESO PonComas;
     |QBF eaAlfa;
     aCadena = "";
     aLen    = eaAlfa % 0;
     nLen    = aLen;
     |PARA nCampo = 1;  |SI nCampo [ nLen;  |HACIENDO nCampo = nCampo + 1;
           nPos = (100 * nCampo) + 1;
           aCaracter = eaAlfa % nPos;
           |SI aCaracter = ".";  aCaracter = ","; |FINSI;
           aCadena = aCadena + aCaracter;
     |SIGUE;
     eaAlfa = aCadena;
|FPRC;

|PROCESO EnviaFichero;
     aIPRemoto = "";
     |IP_REMOTO aIPRemoto;  |QBT aIPRemoto;

     |SI aIPRemoto ! "";
         |ENVIA_FICHERO eaOrigen, eaDestino;
     |SINO;
         |COPIA_FICHERO eaOrigen, eaDestino;
     |FINSI;
|FPRC;

|PROCESO RecibeFichero;
     aIPRemoto = "";
     |IP_REMOTO aIPRemoto;  |QBT aIPRemoto;

     |SI aIPRemoto ! "";
         |RECIBE_FICHERO eaOrigen, eaDestino;
     |SINO;
         |COPIA_FICHERO eaOrigen, eaDestino;
     |FINSI;
|FPRC;

|PROCESO SacaFecha;
     aAlfa1 = eaAlfa % 102;
     aAlfa2 = eaAlfa % 402;
     aAlfa3 = eaAlfa % 704;
     |SI aAlfa2 = "01";  aAlfa2 = "Enero";      |FINSI;
     |SI aAlfa2 = "02";  aAlfa2 = "Febrero";    |FINSI;
     |SI aAlfa2 = "03";  aAlfa2 = "Marzo";      |FINSI;
     |SI aAlfa2 = "04";  aAlfa2 = "Abril";      |FINSI;
     |SI aAlfa2 = "05";  aAlfa2 = "Mayo";       |FINSI;
     |SI aAlfa2 = "06";  aAlfa2 = "Junio";      |FINSI;
     |SI aAlfa2 = "07";  aAlfa2 = "Julio";      |FINSI;
     |SI aAlfa2 = "08";  aAlfa2 = "Agosto";     |FINSI;
     |SI aAlfa2 = "09";  aAlfa2 = "Septiembre"; |FINSI;
     |SI aAlfa2 = "10";  aAlfa2 = "Octubre";    |FINSI;
     |SI aAlfa2 = "11";  aAlfa2 = "Noviembre";  |FINSI;
     |SI aAlfa2 = "12";  aAlfa2 = "Diciembre";  |FINSI;

     eaAlfa = aAlfa1 + " de " + aAlfa2 + " de " + aAlfa3;
|FPRC;

|PROCESO SacaFechaLetra;
     aAlfa2     = eaAlfa % 102;
     |LETRA aAlfa2;
     aAlfa3     = eaAlfa % 102;
     aLetra     = aAlfa2 % -101;
     |SI aLetra = "A"; |Y aAlfa3 ! "30";
         aLen   = aAlfa2 % 0;
         nLen   = aLen;
         nPos   = 100 + (nLen - 1);
         aAlfa2 = (aAlfa2 % nPos) + "O";
     |FINSI;

     aAlfa3  = eaAlfa % 402;
     |SI aAlfa3 = "01";  aAlfa3 = "Enero";      |FINSI;
     |SI aAlfa3 = "02";  aAlfa3 = "Febrero";    |FINSI;
     |SI aAlfa3 = "03";  aAlfa3 = "Marzo";      |FINSI;
     |SI aAlfa3 = "04";  aAlfa3 = "Abril";      |FINSI;
     |SI aAlfa3 = "05";  aAlfa3 = "Mayo";       |FINSI;
     |SI aAlfa3 = "06";  aAlfa3 = "Junio";      |FINSI;
     |SI aAlfa3 = "07";  aAlfa3 = "Julio";      |FINSI;
     |SI aAlfa3 = "08";  aAlfa3 = "Agosto";     |FINSI;
     |SI aAlfa3 = "09";  aAlfa3 = "Septiembre"; |FINSI;
     |SI aAlfa3 = "10";  aAlfa3 = "Octubre";    |FINSI;
     |SI aAlfa3 = "11";  aAlfa3 = "Noviembre";  |FINSI;
     |SI aAlfa3 = "12";  aAlfa3 = "Diciembre";  |FINSI;

     aAlfa4  = eaAlfa % 704;
     |LETRA aAlfa4;

     aAlfa2 = aAlfa2 < aAlfa2;

     aAlfa4 = aAlfa4 < aAlfa4;
     aLetra = aAlfa4 % -101;
     |SI aLetra = "a";
         aLen   = aAlfa4 % 0;
         nLen   = aLen;
         nPos   = 100 + (nLen - 1);
         aAlfa4 = (aAlfa4 % nPos) + "o";
     |FINSI;
     eaAlfa  = aAlfa2 + " de " + aAlfa3 + " de " + aAlfa4;
|FPRC;

|PROCESO LeeUbicaciones;
     enFSalida = 0;

     |ABRE #121;
     #121#0 = enCodUbica;
     |LEE 040#121=;
     enFSalida = FSalida;
     |SI FSalida ! 0;
         |MENAV "      No existe Ubicacion ";
         |CIERRA #121;
         |ACABA;
     |FINSI;
     |CIERRA #121;

     |HAZ CogeMac;

     |ABRE #122;
     #122#0 = enCodUbica;
     #122#1 = eaDSMAC;
     |LEE 040#122=;
     enFSalida = FSalida;
     |SI FSalida ! 0;
         aMenav =  "      No existe Ubicacion en la Maquina : " + eaDSMAC;
         |MENAV aMenav;
         |CIERRA #122;
         |ACABA;
     |FINSI;
     |CIERRA #122;

     eaRutaDocumento = #122#3;  |QBF eaRutaDocumento;
     |SI eaRutaDocumento = "";
         aMenav = "      No esta configurada la Ruta en la Maquina " + eaDSMAC;
         |MENAV aMenav;
         enFSalida = 1;
         |ACABA;
     |FINSI;
     eaNomUbicacion = #121#1;
|FPRC;
