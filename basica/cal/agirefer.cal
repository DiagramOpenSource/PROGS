|FICHEROS;
    agirefer #3;         || ficha general clientes
    agim0036 #5;

    &provinc@ #700;
|FIN;

|VARIABLES;
    numero   = 0;
    nada     = "";
    modo     = 0;

    Direc    = "";
    Handle   = "";
    Field1   = "";
    Field2   = "";
    Valfa    = "";
    Valfa1   = "";
    Valfa2   = "";
    Contador = 0;
    Campo1   = 0;

    &enCodProv = 0;
    &eaVarDni  = "";
    &enCalcCif = 0;
|FIN;

|PROCESO LetraDni;  |TIPO 0;
     |SI FSalida = 10;
         eaVarDni  = #3Campo;
         enCalcCif = 1;
         |HAZ CalculoDNI;
         #3Campo = eaVarDni;
         |PINTA #3Campo;
         |ERROR;
         |ACABA;
     |FINSI;

     eaVarDni  = #3Campo;
     enCalcCif = 0;
     |HAZ CalculoDNI;
     eaVarDni = (eaVarDni + "            ") % 112;
     |SI #3Campo ! eaVarDni;
         |CONFI "0000SEl Nif puede ser Erroneo. Desea Calcularlo.";
         |SI FSalida = 0;
             #3Campo = eaVarDni;  |PINTA #3Campo;
             |ERROR;
             |ACABA;
         |FINSI;
     |FINSI;
|FPRC;


|PROCESO cdpostal1;
numero = #3#9 * 1000;
numero = numero + #3#10;
numero = 100000 + numero;
nada = numero;
#3#16 = nada % A205;
|FPRC;

|PROCESO repetir1; |TIPO 0;
modo = (FEntrada / 100) ! 0;
|SI modo ! 1; |ACABA; |FINSI;

#3#33 = #3#03;  |PINTA #3#33;
#3#34 = #3#04;  |PINTA #3#34;
#3#35 = #3#05;  |PINTA #3#35;
#3#36 = #3#06;  |PINTA #3#36;
#3#37 = #3#07;  |PINTA #3#37;
#3#38 = #3#08;  |PINTA #3#38;
#3#39 = #3#09;  |PINTA #3#39;
#3#40 = #3#10;  |PINTA #3#40;
#3#41 = #3#11;  |PINTA #3#41;
#3#42 = #3#12;  |PINTA #3#42;

#3#43 = #3#03;  |PINTA #3#43;
#3#44 = #3#04;  |PINTA #3#44;
#3#45 = #3#05;  |PINTA #3#45;
#3#46 = #3#06;  |PINTA #3#46;
#3#47 = #3#07;  |PINTA #3#47;
#3#48 = #3#08;  |PINTA #3#48;
#3#49 = #3#09;  |PINTA #3#49;
#3#50 = #3#10;  |PINTA #3#50;
#3#51 = #3#11;  |PINTA #3#51;
#3#52 = #3#12;  |PINTA #3#52;
|FPRC;

|PROCESO Tipo7;  |TIPO 7;
  |ABRE #5;
  |LEE 040#5p;
  |SI FSalida ! 0;  |CIERRA #5;  |ACABA;  |FINSI;
  |CIERRA #5;

  Campo1 = Campo - 16;
  Valfa  = "     " + #5Campo1;   |QBF Valfa;

  |ATRI R;  |BLIN 04;  |ATRI 0;

  |SI Valfa ! "";  |MENSA Valfa;  |FINSI;
|FPRC;

|PROCESO GrabaFichero;
  Contador = Contador + 1;
  #3#0     = Contador;
  Valfa    = Field1 % 139;  |QBT Valfa;
  |SI Valfa ! "";
      Valfa1 =  Field1 % 139;   |QBF Valfa1;
      Valfa2 =  Field1 % 4040;  |QBF Valfa2;
      #3#1 = Valfa1 + ", " + Valfa2
      #3#2 = Valfa1 + ", " + Valfa2
  |SINO;
      Valfa2 =  Field1 % 4040;  |QBF Valfa2;
      #3#1 = Valfa2
      #3#2 = Valfa2
  |FINSI;


                             #3#4  = Field1 % 8240;
  Valfa1 = Field1 % 16802;   #3#9  = Valfa1;
  Valfa1 = Field1 % 17003;   #3#10 = Valfa1;
                             #3#11 = Field1 % 18427;
                             #3#13 = Field1 % 22920;
                             #3#14 = Field2 % 6112;
                             #3#15 = Field2 % 9012;
                             #3#16 = Field1 % 16805;
                             #3#17 = Field1 % 12741;     || Urbanizacion
                             #3#18 = Field1 % 20920;     || Importe
                             #3#19 = Field2 % 142;       || Obligacion
                             #3#20 = Field2 % 4318;      || Referencia
                             #3#21 = Field2 % 11313;     || Idioma
                             #3#22 = Field2 % 12622;     || Pais
                             #3#23 = Field2 % 14825;     || Banco


  enCodProv = #3#9;
  |HAZ LeeProvincia;

  #3#12 = #700#1;
  #3#33 = #3#03;
  #3#34 = #3#04;
  #3#35 = #3#05;
  #3#36 = #3#06;
  #3#37 = #3#07;
  #3#38 = #3#08;
  #3#39 = #3#09;
  #3#40 = #3#10;
  #3#41 = #3#11;
  #3#42 = #3#12;

  #3#43 = #3#03;
  #3#44 = #3#04;
  #3#45 = #3#05;
  #3#46 = #3#06;
  #3#47 = #3#07;
  #3#48 = #3#08;
  #3#49 = #3#09;
  #3#50 = #3#10;
  #3#51 = #3#11;
  #3#52 = #3#12;

  |GRABA 140#3n;
  |LIBERA #3;
|FPRC;

|PROCESO SacaSecuencial;
  |SI FSalida ! 18;  |ACABA;  |FINSI;

  |LEE 040#3p;
  |SI FSalida = 0;   |ACABA;  |FINSI;

  Contador = 0;
  Pos      = -1;
  Direc    = "r   /u/agitra/basica/fich/clientes.txt";
  |FABRE Direc;
  Handle = FSalida;
  |SI FSalida ] 0;
      |PARA; |SI; |HACIENDO;
           Field1 = Handle + " 249";
           |FLEE Field1;
           |SI FSalida [ 0;  |SAL;  |FINSI;

           Field2 = Handle + " 254";
           |FLEE Field2;
           |SI FSalida [ 0;  |SAL;  |FINSI;

           |HAZ GrabaFichero;
      |SIGUE;
  |FINSI;
  |FCIERRA Handle;

  |ABRE #5;
  |DDEFECTO #5;
  #5#1 = "INTRODUZCA LA URBANIZACION";
  #5#2 = "INTRODUZCA EL IMPORTE";
  #5#3 = "INTRODUZCA LA OBLIGACION";
  #5#4 = "INTRODUZCA LA REFERENCIA";
  #5#5 = "INTRODUZCA EL IDIOMA";
  #5#6 = "INTRODUZCA LA PAIS";
  #5#7 = "INTRODUZCA LA BANCO";
  |GRABA 140#5n;
  |LIBERA #5;
  |CIERRA #5;
|FPRC;
