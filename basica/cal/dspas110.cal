|FICHEROS;
     dspase03;
     dspase15;

     agicen14;
     agitab12;
     agitab99;

     :/modelos/def/dsmom002;
     :/modelos/def/dsmom004;
     :/modelos/def/dsmom008;
     :/modelos/def/dsmoc110;
     :/modelos/def/dsmoc111;
     :/modelos/def/dsm11101;
     :/modelos/def/dsmoc115;
     :/modelos/def/dsmoc123;

     dspase25;
     dspase99;

     refer00@;
     refer01@;
     refer02@;
     refer03@;
     refer04@;
|FIN;

|VARIABLES;
      aDef           = "";
      aFich          = "";
      aAlfa          = "";
      aClave         = "";
      aSubClave      = "";

      nDEmpresa      = 0;
      nHEmpresa      = 0;
      nCodigoNue     = 0;
      nCodigoReo     = 0;
      nCodigoNom     = 0;
      nCodigoCont    = 0;
      nCampoAct      = 0;
      nCampoAgr      = 0;
      nCampoCuo      = 0;
      nCampoRdt      = 0;
      nCampoPor      = 0;
      nCampoCom      = 0;
      nAnyo          = 0;
      nMes           = 0;
      nPeriodo       = 0;
      nDPeriodo      = 0;
      nHPeriodo      = 0;
      nDPer          = 0;
      nHPer          = 0;
      nHastaPeriodo  = 0;
      nModelo        = 0;
      nSwHay         = 0;
      nCampo         = 0;
      nCampo1        = 0;
      nCampo2        = 0;
      nSuma          = 0;
      nComplem       = 0;
      nAnterior      = 0;
      nDonde         = 0;
      nPrimera       = 0;
      nResult        = 0;
      nTotal         = 0;
      nPerReg        = 0;

      fFecha         = @;

     &enModelo       = 0;
     &enEstaCambio   = 0;
     &enEmpresa      = 0;
     &enEmpresaA     = 0;
     &enEjercicioA   = 0;
     &enPeriodoA     = 0;
     &enAnyo         = 0;
     &enSwEstar      = 0;
     &enEjer         = 0;
     &enPeriodo      = 0;
     &enComplem      = 0;
     &enActividad    = 0;
     &enTipoEntrada  = 0;
     &eaComunidad    = "";
     &eaArchiva      = "";
     &efFechaI       = @;
     &enDesdePase    = 0;

     &eaPathAnterior = "";
     &eaPathBasica   = "";
     &eaPathContagen = "";
     &eaPathContanex = "";
     &eaPathContasoc = "";
     &eaPathRen2000  = "";
     &eaPathRen1999  = "";
     &eaPathRen1998  = "";
     &eaPathRen1997  = "";
     &eaPathRen1996  = "";
     &eaPathRen1995  = "";
     &eaPathRen1994  = "";
     &eaPathFacturar = "";
     &eaPathLaboral  = "";
     &eaPathIntegral = "";
     &eaPathDsmodelo = "";
     &eaPathFiscal   = "";
     &enDEmpresa     = 0;
     &enHEmpresa     = 0;
|FIN;

|PROCESO CogeCodigo_110;
     |SI #dspase15#22 = "S";  |ACABA;  |FINSI;

     nCodigoNue = #dspase15#3;
     |ERROR10;
|FPRC;

|DEFBUCLE dspase15_Eos110;
     #dspase15#4;
     ;
     nCodigoReo, "            ", 000;
     nCodigoReo, "zzzzzzzzzzzz", 999;
     ;
     NULL, CogeCodigo_110;
|FIN;

|DEFBUCLE dspase15_Nom110;
     #dspase15#6;
     ;
     nCodigoNom, "            ", 000;
     nCodigoNom, "zzzzzzzzzzzz", 999;
     ;
     NULL, CogeCodigo_110;
|FIN;

|DEFBUCLE dspase15_Cont110;
     #dspase15#5;
     ;
     nCodigoCont, "            ", 000;
     nCodigoCont, "zzzzzzzzzzzz", 999;
     ;
     NULL, CogeCodigo_110;
|FIN;

|PROCESO CompleAct;
     #dsmom008#4    = nComplem;
     #dsmom008#7    = "MANUAL";
     #dsmom008#11   = "SIN DATOS";
     |GRABA 020#dsmom008.n;
     |LIBERA #dsmom008;
|FPRC;

|DEFBUCLE dsmom008C;
     #dsmom008#1;
     ;
     #dsmom004#0, #dsmom004#1, #dsmom004#2, #dsmom004#3, nAnterior, 00;
     #dsmom004#0, #dsmom004#1, #dsmom004#2, #dsmom004#3, nAnterior, 99;
     be;
     NULL, CompleAct;
|FIN;

|PROCESO CreaComplementaria;
     |ABRE #dsmom004;
     #dsmom004#0   = nCodigoNue;
     #dsmom004#1   = #dspase03#4;
     #dsmom004#2   = nPeriodo;
     #dsmom004#3   = nModelo;
     #dsmom004#4   = nComplem;
     #dsmom004#5   = #agicen14#1;
     |LEE 040#dsmom004.=;
     |SI FSalida ! 0;
         |DDEFECTO #dsmom004;
         #dsmom004#0   = nCodigoNue;
         #dsmom004#1   = #dspase03#4;
         #dsmom004#2   = nPeriodo;
         #dsmom004#3   = nModelo;
         #dsmom004#4   = nComplem;
         #dsmom004#5   = "ACTIVIDAD";
         #dsmom004#17 = "SIN DATOS";
         |GRABA 020#dsmom004.n;

         nAnterior = nComplem - 1;
         |BUCLE dsmom008C;
     |FINSI;
     |LIBERA #dsmom004;
|FPRC;

|| *************************************************************************
|| *************************************************************************
|| *************************************************************************
||               M O D E L O   1 1 0
|| *************************************************************************
|| *************************************************************************
|| *************************************************************************

|PROCESO PasaNif110;
     |SI #refer01@#6 > 99;  |Y nDonde = 0;
         |SI #refer02@#28 ! 4;
             |SI #refer01@#18 = 1;  nPerReg = 3;  |FINSI;
             |SI #refer01@#18 = 2;  nPerReg = 6;  |FINSI;
             |SI #refer01@#18 = 3;  nPerReg = 9;  |FINSI;
             |SI #refer01@#18 = 4;  nPerReg = 12; |FINSI;
         |SINO;
             nPerReg  = #refer01@#18;
         |FINSI;

         |SI nPerReg ! nPeriodo;  |ACABA;  |FINSI;
     |FINSI;

     #refer03@#0  = #refer01@#0;
     #refer03@#1  = #refer01@#1;
     #refer03@#2  = #refer01@#2;
     |LEE 040#refer03@.=;
     |SI FSalida ! 0;  |DDEFECTO #refer03@;  |FINSI;

     |SI #dspase03#4 [ 2010;
          #dsmoc110#0 = #dsmom008#0;
          #dsmoc110#1 = #dsmom008#1;
          #dsmoc110#2 = #dsmom008#2;
          #dsmoc110#3 = #dsmom008#3;
          #dsmoc110#4 = #dsmom008#4;
          #dsmoc110#5 = #dsmom008#5;
          #dsmoc110#6 = #refer01@#2;
          #dsmoc110#7 = 0;
          |SI #refer01@#6 > 12;  #dsmoc110#7 = #refer01@#6;  |FINSI;
          #dsmoc110#8 = #refer01@#3;
          #dsmoc110#9 = #refer01@#4;
          |LEE 101#dsmoc110.=;
          |SI FSalida ! 0;
              |DDEFECTO #dsmoc110;
              #dsmoc110#0 = #dsmom008#0;
              #dsmoc110#1 = #dsmom008#1;
              #dsmoc110#2 = #dsmom008#2;
              #dsmoc110#3 = #dsmom008#3;
              #dsmoc110#4 = #dsmom008#4;
              #dsmoc110#5 = #dsmom008#5;
              #dsmoc110#6 = #refer01@#2;
              #dsmoc110#7 = 0;
              |SI #refer01@#6 > 12;  #dsmoc110#7 = #refer01@#6;  |FINSI;
              #dsmoc110#8 = #refer01@#3;
              #dsmoc110#9 = #refer01@#4;
              |GRABA 020#dsmoc110.b;
          |FINSI;

          |SI #refer01@#6 = 1;  |O #refer01@#6 = 4;  |O #refer01@#6 = 7;  |O #refer01@#6 = 10;  |O #refer01@#6 > 12;
              #dsmoc110#10 = #dsmoc110#10 + #refer01@#7;
              #dsmoc110#11 = #dsmoc110#11 + #refer01@#9;
              #dsmoc110#12 = #dsmoc110#12 + #refer01@#10;
              |SI #refer01@#13 = "S";
                  #dsmoc110#14 = #dsmoc110#14 + #refer01@#12;
              |SINO;
                  #dsmoc110#13 = #dsmoc110#13 + #refer01@#12;
              |FINSI;
          |FINSI;

          |SI #refer01@#6 = 2;  |O #refer01@#6 = 5;  |O #refer01@#6 = 8;  |O #refer01@#6 = 11;
              #dsmoc110#15 = #dsmoc110#15 + #refer01@#7;
              #dsmoc110#16 = #dsmoc110#16 + #refer01@#9;
              #dsmoc110#17 = #dsmoc110#17 + #refer01@#10;
              |SI #refer01@#13 = "S";
                  #dsmoc110#19 = #dsmoc110#19 + #refer01@#12;
              |SINO;
                  #dsmoc110#18 = #dsmoc110#18 + #refer01@#12;
              |FINSI;
          |FINSI;

          |SI #refer01@#6 = 3;  |O #refer01@#6 = 6;  |O #refer01@#6 = 9;  |O #refer01@#6 = 12;
              #dsmoc110#20 = #dsmoc110#20 + #refer01@#7;
              #dsmoc110#21 = #dsmoc110#21 + #refer01@#9;
              #dsmoc110#22 = #dsmoc110#22 + #refer01@#10;
              |SI #refer01@#13 = "S";
                  #dsmoc110#24 = #dsmoc110#24 + #refer01@#12;
              |SINO;
                  #dsmoc110#23 = #dsmoc110#23 + #refer01@#12;
              |FINSI;
          |FINSI;

          #dsmoc110#25 = #dsmoc110#25 + #refer01@#14;
          #dsmoc110#26 = #dsmoc110#26 + #refer01@#15;
          #dsmoc110#27 = #dsmoc110#27 + #refer01@#16;
          #dsmoc110#28 = #dsmoc110#28 + #refer01@#17;
          #dsmoc110#29 = #refer03@#3;

          |GRABA 020#dsmoc110.a;
          |LIBERA #dsmoc110;

          nSwHay = 1;
     |FINSI;

     |SI #dspase03#4 ] 2011;  |Y #dspase03#4 [ 2015;
          #dsmoc111#0 = #dsmom008#0;
          #dsmoc111#1 = #dsmom008#1;
          #dsmoc111#2 = #dsmom008#2;
          #dsmoc111#3 = #dsmom008#3;
          #dsmoc111#4 = #dsmom008#4;
          #dsmoc111#5 = #dsmom008#5;
          #dsmoc111#6 = #refer01@#2;
          #dsmoc111#7 = 0;
          #dsmoc111#8 = #refer01@#6;
          |SI #refer01@#6 > 12;
              #dsmoc111#7 = #refer01@#6;
              #dsmoc111#8 = #dsmom008#2;
          |FINSI;
          #dsmoc111#9  = #refer01@#3;
          #dsmoc111#10 = #refer01@#4;
          #dsmoc111#11 = #refer01@#5;  ||Tipo de Relacion
          |LEE 101#dsmoc111.=;
          |SI FSalida ! 0;
              |DDEFECTO #dsmoc111;
              #dsmoc111#0 = #dsmom008#0;
              #dsmoc111#1 = #dsmom008#1;
              #dsmoc111#2 = #dsmom008#2;
              #dsmoc111#3 = #dsmom008#3;
              #dsmoc111#4 = #dsmom008#4;
              #dsmoc111#5 = #dsmom008#5;
              #dsmoc111#6 = #refer01@#2;
              #dsmoc111#7 = 0;
              #dsmoc111#8 = #refer01@#6;
              |SI #refer01@#6 > 12;
                  #dsmoc111#7 = #refer01@#6;
                  #dsmoc111#8 = #dsmom008#2;
              |FINSI;
              #dsmoc111#9  = #refer01@#3;
              #dsmoc111#10 = #refer01@#4;
              #dsmoc111#11 = #refer01@#5;  ||Tipo de Relacion
              |GRABA 020#dsmoc111.b;
          |FINSI;
          #dsmoc111#12 = #dsmoc111#12 + #refer01@#7;
          #dsmoc111#13 = #dsmoc111#13 + #refer01@#9;
          #dsmoc111#14 = #dsmoc111#14 + #refer01@#10;
          |SI #refer01@#13 = "S";
              #dsmoc111#16 = #dsmoc111#16 + #refer01@#12;
          |SINO;
              #dsmoc111#15 = #dsmoc111#15 + #refer01@#12;
          |FINSI;
          #dsmoc111#17 = #dsmoc111#17 + #refer01@#14;
          #dsmoc111#18 = #dsmoc111#18 + #refer01@#15;
          #dsmoc111#19 = #dsmoc111#19 + #refer01@#16;
          #dsmoc111#20 = #dsmoc111#20 + #refer01@#17;
          #dsmoc111#21 = #refer03@#3;

          |GRABA 020#dsmoc111.a;
          |LIBERA #dsmoc111;

          nSwHay = 1;
     |FINSI;

     |SI #dspase03#4 ] 2016;
          #dsm11101#0 = #dsmom008#0;
          #dsm11101#1 = #dsmom008#1;
          #dsm11101#2 = #dsmom008#2;
          #dsm11101#3 = #dsmom008#3;
          #dsm11101#4 = #dsmom008#4;
          #dsm11101#5 = #dsmom008#5;
          #dsm11101#6 = #refer01@#2;
          #dsm11101#7 = 0;
          #dsm11101#8 = #refer01@#6;
          |SI #refer01@#6 > 12;
              #dsm11101#7 = #refer01@#6;
              #dsm11101#8 = #dsmom008#2;
          |FINSI;
          #dsm11101#9  = #refer01@#3;
          #dsm11101#10 = #refer01@#4;
          #dsm11101#11 = #refer01@#5;  ||Tipo de Relacion
          |LEE 101#dsm11101.=;
          |SI FSalida ! 0;
              |DDEFECTO #dsm11101;
              #dsm11101#0 = #dsmom008#0;
              #dsm11101#1 = #dsmom008#1;
              #dsm11101#2 = #dsmom008#2;
              #dsm11101#3 = #dsmom008#3;
              #dsm11101#4 = #dsmom008#4;
              #dsm11101#5 = #dsmom008#5;
              #dsm11101#6 = #refer01@#2;
              #dsm11101#7 = 0;
              #dsm11101#8 = #refer01@#6;
              |SI #refer01@#6 > 12;
                  #dsm11101#7 = #refer01@#6;
                  #dsm11101#8 = #dsmom008#2;
              |FINSI;
              #dsm11101#9  = #refer01@#3;
              #dsm11101#10 = #refer01@#4;
              #dsm11101#11 = #refer01@#5;  ||Tipo de Relacion
              |GRABA 020#dsm11101.b;
          |FINSI;
          #dsm11101#12 = #dsm11101#12 + #refer01@#7;
          #dsm11101#13 = #dsm11101#13 + #refer01@#9;
          #dsm11101#14 = #dsm11101#14 + #refer01@#10;
          |SI #refer01@#13 = "S";
              #dsm11101#16 = #dsm11101#16 + #refer01@#12;
          |SINO;
              #dsm11101#15 = #dsm11101#15 + #refer01@#12;
          |FINSI;
          #dsm11101#25 = #dsm11101#25 + #refer01@#20;
          #dsm11101#26 = #dsm11101#26 + #refer01@#22;
          #dsm11101#27 = #dsm11101#27 + #refer01@#23;
          |SI #refer01@#26 = "S";
              #dsm11101#29 = #dsm11101#29 + #refer01@#25;
          |SINO;
              #dsm11101#28 = #dsm11101#28 + #refer01@#25;
          |FINSI;
          #dsm11101#17 = #dsm11101#17 + #refer01@#14;
          #dsm11101#18 = #dsm11101#18 + #refer01@#15;
          #dsm11101#19 = #dsm11101#19 + #refer01@#16;
          #dsm11101#20 = #dsm11101#20 + #refer01@#17;
          #dsm11101#21 = #refer03@#3;

          |GRABA 020#dsm11101.a;
          |LIBERA #dsm11101;

          nSwHay = 1;
     |FINSI;
|FPRC;

|DEFBUCLE eosm0032;
     #refer01@#1007;
     ;
     #refer00@#0, #refer00@#1, "            ", " ", "  ", 0, nDPer;
     #refer00@#0, #refer00@#1, "zzzzzzzzzzzz", "z", "zz", 4, nHPer;
     ;
     NULL, PasaNif110;
|FIN;

|PROCESO GrabaNif110Vacio;
     #dsmoc110#0 = #dsmom008#0;
     #dsmoc110#1 = #dsmom008#1;
     #dsmoc110#2 = #dsmom008#2;
     #dsmoc110#3 = #dsmom008#3;
     #dsmoc110#4 = #dsmom008#4;
     #dsmoc110#5 = #dsmom008#5;
     #dsmoc110#6 = "PASEANTERIOR";
     #dsmoc110#7 = 0;
     #dsmoc110#8 = aClave;
     #dsmoc110#9 = aSubClave;
     |LEE 101#dsmoc110.=;
     |SI FSalida ! 0;
         |DDEFECTO #dsmoc110;
         #dsmoc110#0 = #dsmom008#0;
         #dsmoc110#1 = #dsmom008#1;
         #dsmoc110#2 = #dsmom008#2;
         #dsmoc110#3 = #dsmom008#3;
         #dsmoc110#4 = #dsmom008#4;
         #dsmoc110#5 = #dsmom008#5;
         #dsmoc110#6 = "PASEANTERIOR";
         #dsmoc110#7 = 0;
         #dsmoc110#8 = aClave;
         #dsmoc110#9 = aSubClave;
         |GRABA 020#dsmoc110.b;
     |FINSI;

                           #dsmoc110#30      = #refer00@#nCampo#;
     nCampo = nCampo + 1;  #dsmoc110#10      = #dsmoc110#10 + #refer00@#nCampo#;
     nCampo = nCampo + 1;  #dsmoc110#11      = #dsmoc110#11 + #refer00@#nCampo#;

     |SI nCampo < 23;
         nCampo = nCampo + 1;  #dsmoc110#31      = #refer00@#nCampo#;
         nCampo = nCampo + 1;  #dsmoc110#12      = #dsmoc110#12 + #refer00@#nCampo#;
         nCampo = nCampo + 1;  #dsmoc110#14      = #dsmoc110#14 + #refer00@#nCampo#;
     |FINSI;

     |SI nDonde = 0;
         #dsmoc110#29 = "DESDE NOMINAS SIN REGISTRO TRABAJADORES";
     |FINSI;

     |SI nDonde = 1;
         #dsmoc110#29 = "DESDE REO SIN REGISTRO TRABAJADORES";
     |FINSI;

     |GRABA 020#dsmoc110.a;
     |LIBERA #dsmoc110;
|FPRC;

|PROCESO PasaNif110Vacio;
     nSuma  = #refer00@#5  + #refer00@#6  + #refer00@#7  + #refer00@#8  + #refer00@#9  + #refer00@#10;
     |SI nSuma ! 0;
         nCampo    = 5;
         aClave    = "A";
         aSubClave = "";
         |HAZ GrabaNif110Vacio;
     |FINSI;

     nSuma  = #refer00@#11 + #refer00@#12 + #refer00@#13 + #refer00@#14 + #refer00@#15 + #refer00@#16;
     |SI nSuma ! 0;
         nCampo    = 11;
         aClave    = "G";
         aSubClave = "01";
         |HAZ GrabaNif110Vacio;
     |FINSI;

     nSuma  = #refer00@#17 + #refer00@#18 + #refer00@#19 + #refer00@#20 + #refer00@#21 + #refer00@#22;
     |SI nSuma ! 0;
         nCampo    = 17;
         aClave    = "K";
         aSubClave = "";
         |HAZ GrabaNif110Vacio;
     |FINSI;

     nSuma  = #refer00@#23 + #refer00@#24 + #refer00@#25;
     |SI nSuma ! 0;
         nCampo    = 23;
         aClave    = "J";
         aSubClave = "";
         |HAZ GrabaNif110Vacio;
     |FINSI;

     nSuma  = #refer00@#5  + #refer00@#6  + #refer00@#7  + #refer00@#8  + #refer00@#9  + #refer00@#10;
     nSuma  = nSuma   + #refer00@#11 + #refer00@#12 + #refer00@#13 + #refer00@#14 + #refer00@#15 + #refer00@#16;
     nSuma  = nSuma   + #refer00@#17 + #refer00@#18 + #refer00@#19 + #refer00@#20 + #refer00@#21 + #refer00@#22;
     nSuma  = nSuma   + #refer00@#23 + #refer00@#24 + #refer00@#25;
     |SI nSuma = 0;
         nCampo    = 5;
         aClave    = "A";
         aSubClave = "";
         |HAZ GrabaNif110Vacio;
     |FINSI;
|FPRC;

|PROCESO GrabaNif111Vacio;
     #dsmoc111#0 = #dsmom008#0;
     #dsmoc111#1 = #dsmom008#1;
     #dsmoc111#2 = #dsmom008#2;
     #dsmoc111#3 = #dsmom008#3;
     #dsmoc111#4 = #dsmom008#4;
     #dsmoc111#5 = #dsmom008#5;
     #dsmoc111#6 = "PASEANTERIOR";
     #dsmoc111#7 = 0;
     #dsmoc111#8 = #dsmom008#2;
     #dsmoc111#9 = aClave;
     #dsmoc111#10 = aSubClave;
     #dsmoc111#11 = 0;
     |LEE 101#dsmoc111.=;
     |SI FSalida ! 0;
         |DDEFECTO #dsmoc111;
         #dsmoc111#0 = #dsmom008#0;
         #dsmoc111#1 = #dsmom008#1;
         #dsmoc111#2 = #dsmom008#2;
         #dsmoc111#3 = #dsmom008#3;
         #dsmoc111#4 = #dsmom008#4;
         #dsmoc111#5 = #dsmom008#5;
         #dsmoc111#6 = "PASEANTERIOR";
         #dsmoc111#7 = 0;
         #dsmoc111#8 = #dsmom008#2;
         #dsmoc111#9 = aClave;
         #dsmoc111#10 = aSubClave;
         #dsmoc111#11 = 0;
         |GRABA 020#dsmoc111.b;
     |FINSI;

                           #dsmoc111#22      = #refer00@#nCampo#;
     nCampo = nCampo + 1;  #dsmoc111#12      = #dsmoc111#12 + #refer00@#nCampo#;
     nCampo = nCampo + 1;  #dsmoc111#13      = #dsmoc111#13 + #refer00@#nCampo#;

     |SI nCampo < 23;
         nCampo = nCampo + 1;  #dsmoc111#23 = #refer00@#nCampo#;
         nCampo = nCampo + 1;  #dsmoc111#14 = #dsmoc111#14 + #refer00@#nCampo#;
         nCampo = nCampo + 1;  #dsmoc111#15 = #dsmoc111#15 + #refer00@#nCampo#;
     |FINSI;

     |SI nDonde = 0;
         #dsmoc111#21 = "DESDE NOMINAS SIN REGISTRO TRABAJADORES";
     |FINSI;

     |SI nDonde = 1;
         #dsmoc111#21 = "DESDE REO SIN REGISTRO TRABAJADORES";
     |FINSI;

     |GRABA 020#dsmoc111.a;
     |LIBERA #dsmoc111;
|FPRC;

|PROCESO PasaNif11101Vacio;
     nSuma  = #refer00@#5  + #refer00@#6  + #refer00@#7  + #refer00@#8  + #refer00@#9  + #refer00@#10;
     |SI nSuma ! 0;
         nCampo    = 5;
         aClave    = "A";
         aSubClave = "";
         |HAZ GrabaNif111Vacio;
     |FINSI;

     nSuma  = #refer00@#11 + #refer00@#12 + #refer00@#13 + #refer00@#14 + #refer00@#15 + #refer00@#16;
     |SI nSuma ! 0;
         nCampo    = 11;
         aClave    = "G";
         aSubClave = "01";
         |HAZ GrabaNif111Vacio;
     |FINSI;

     nSuma  = #refer00@#17 + #refer00@#18 + #refer00@#19 + #refer00@#20 + #refer00@#21 + #refer00@#22;
     |SI nSuma ! 0;
         nCampo    = 17;
         aClave    = "K";
         aSubClave = "";
         |HAZ GrabaNif111Vacio;
     |FINSI;

     nSuma  = #refer00@#23 + #refer00@#24 + #refer00@#25;
     |SI nSuma ! 0;
         nCampo    = 23;
         aClave    = "J";
         aSubClave = "";
         |HAZ GrabaNif111Vacio;
     |FINSI;

     nSuma  = #refer00@#5  + #refer00@#6  + #refer00@#7  + #refer00@#8  + #refer00@#9  + #refer00@#10;
     nSuma  = nSuma   + #refer00@#11 + #refer00@#12 + #refer00@#13 + #refer00@#14 + #refer00@#15 + #refer00@#16;
     nSuma  = nSuma   + #refer00@#17 + #refer00@#18 + #refer00@#19 + #refer00@#20 + #refer00@#21 + #refer00@#22;
     nSuma  = nSuma   + #refer00@#23 + #refer00@#24 + #refer00@#25;
     |SI nSuma = 0;
         nCampo    = 5;
         aClave    = "A";
         aSubClave = "";
         |HAZ GrabaNif111Vacio;
     |FINSI;
|FPRC;

|PROCESO GrabaNif11101Vacio;
     #dsm11101#0 = #dsmom008#0;
     #dsm11101#1 = #dsmom008#1;
     #dsm11101#2 = #dsmom008#2;
     #dsm11101#3 = #dsmom008#3;
     #dsm11101#4 = #dsmom008#4;
     #dsm11101#5 = #dsmom008#5;
     #dsm11101#6 = "PASEANTERIOR";
     #dsm11101#7 = 0;
     #dsm11101#8 = #dsmom008#2;
     #dsm11101#9 = aClave;
     #dsm11101#10 = aSubClave;
     #dsm11101#11 = 0;
     |LEE 101#dsm11101.=;
     |SI FSalida ! 0;
         |DDEFECTO #dsm11101;
         #dsm11101#0 = #dsmom008#0;
         #dsm11101#1 = #dsmom008#1;
         #dsm11101#2 = #dsmom008#2;
         #dsm11101#3 = #dsmom008#3;
         #dsm11101#4 = #dsmom008#4;
         #dsm11101#5 = #dsmom008#5;
         #dsm11101#6 = "PASEANTERIOR";
         #dsm11101#7 = 0;
         #dsm11101#8 = #dsmom008#2;
         #dsm11101#9 = aClave;
         #dsm11101#10 = aSubClave;
         #dsm11101#11 = 0;
         |GRABA 020#dsm11101.b;
     |FINSI;

                           #dsm11101#22      = #refer00@#nCampo#;
     nCampo = nCampo + 1;  #dsm11101#12      = #dsm11101#12 + #refer00@#nCampo#;
     nCampo = nCampo + 1;  #dsm11101#13      = #dsm11101#13 + #refer00@#nCampo#;

     |SI nCampo < 23;
         nCampo = nCampo + 1;  #dsm11101#23 = #refer00@#nCampo#;
         nCampo = nCampo + 1;  #dsm11101#14 = #dsm11101#14 + #refer00@#nCampo#;
         nCampo = nCampo + 1;  #dsm11101#15 = #dsm11101#15 + #refer00@#nCampo#;
     |FINSI;

     |SI nDonde = 0;
         #dsm11101#21 = "DESDE NOMINAS SIN REGISTRO TRABAJADORES";
     |FINSI;

     |SI nDonde = 1;
         #dsm11101#21 = "DESDE REO SIN REGISTRO TRABAJADORES";
     |FINSI;

     |GRABA 020#dsm11101.a;
     |LIBERA #dsm11101;
|FPRC;

|PROCESO PasaNif111Vacio;
     nSuma  = #refer00@#5  + #refer00@#6  + #refer00@#7  + #refer00@#8  + #refer00@#9  + #refer00@#10;
     |SI nSuma ! 0;
         nCampo    = 5;
         aClave    = "A";
         aSubClave = "";
         |HAZ GrabaNif111Vacio;
     |FINSI;

     nSuma  = #refer00@#11 + #refer00@#12 + #refer00@#13 + #refer00@#14 + #refer00@#15 + #refer00@#16;
     |SI nSuma ! 0;
         nCampo    = 11;
         aClave    = "G";
         aSubClave = "01";
         |HAZ GrabaNif111Vacio;
     |FINSI;

     nSuma  = #refer00@#17 + #refer00@#18 + #refer00@#19 + #refer00@#20 + #refer00@#21 + #refer00@#22;
     |SI nSuma ! 0;
         nCampo    = 17;
         aClave    = "K";
         aSubClave = "";
         |HAZ GrabaNif111Vacio;
     |FINSI;

     nSuma  = #refer00@#23 + #refer00@#24 + #refer00@#25;
     |SI nSuma ! 0;
         nCampo    = 23;
         aClave    = "J";
         aSubClave = "";
         |HAZ GrabaNif111Vacio;
     |FINSI;

     nSuma  = #refer00@#5  + #refer00@#6  + #refer00@#7  + #refer00@#8  + #refer00@#9  + #refer00@#10;
     nSuma  = nSuma   + #refer00@#11 + #refer00@#12 + #refer00@#13 + #refer00@#14 + #refer00@#15 + #refer00@#16;
     nSuma  = nSuma   + #refer00@#17 + #refer00@#18 + #refer00@#19 + #refer00@#20 + #refer00@#21 + #refer00@#22;
     nSuma  = nSuma   + #refer00@#23 + #refer00@#24 + #refer00@#25;
     |SI nSuma = 0;
         nCampo    = 5;
         aClave    = "A";
         aSubClave = "";
         |HAZ GrabaNif111Vacio;
     |FINSI;
|FPRC;

|PROCESO MiraModelo110;
     |SI nDonde = 0;
         |SI enEstaCambio = 1;
             nCodigoNue = 0;
             nCodigoNom = #refer00@#0;
             |BUCLE dspase15_Nom110;
             |SI nCodigoNue = 0;  |ACABA;  |FINSI;
         |SINO;
             nCodigoNue = #refer00@#0;
         |FINSI;
     |FINSI;

     |SI nDonde = 1;
         |SI enEstaCambio = 1;
             nCodigoNue = 0;
             nCodigoReo = #refer00@#0;
             |BUCLE dspase15_Eos110;
             |SI nCodigoNue = 0;  |ACABA;  |FINSI;
         |SINO;
             nCodigoNue = #refer00@#0;
         |FINSI;
     |FINSI;

     |SI nCodigoNue < #dspase03#9; |O nCodigoNue > #dspase03#10;
         |ACABA;
     |FINSI;

     |SI #dspase03#8 ! 1;
         #dspase99#0 = nCodigoNue;
         #dspase99#1 = 110;
         |LEE 101#dspase99.=;
         |SI FSalida ! 0;
             enDEmpresa = nCodigoNue;
             enHEmpresa = nCodigoNue;
             enModelo   = 110;
             |SUB_EJECUTA "dspasuti;BorraModelos";

             #dspase99#0 = nCodigoNue;
             #dspase99#1 = 110;
             |GRABA 020#dspase99.n;
             |LIBERA #dspase99;
         |FINSI;
     |FINSI;

     |ABRE #agicen14;
     #agicen14#0 = nCodigoNue;
     #agicen14#1 = 1;
     |LEE 040#agicen14.=;
     |SI FSalida ! 0;
         |DDEFECTO #agicen14;
         #agicen14#0 = nCodigoNue;
         #agicen14#1 = 1;
         |GRABA 020#agicen14.n;
         |LIBERA #agicen14;
     |FINSI;

     #refer02@#0 = #refer00@#0;
     |LEE 040#refer02@.=;
     |SI FSalida ! 0;  |DDEFECTO #refer02@;  |FINSI;

     nHastaPeriodo = #dspase03#5;
     |SI nDonde = 0;
         |SI #refer02@#28 = 4;
             |SI #dspase03#5 = 1;  nHastaPeriodo = 3;  |FINSI;
             |SI #dspase03#5 = 2;  nHastaPeriodo = 6;  |FINSI;
             |SI #dspase03#5 = 3;  nHastaPeriodo = 9;  |FINSI;
             |SI #dspase03#5 = 4;  nHastaPeriodo = 12; |FINSI;
         |FINSI;
     |FINSI;

     |SI nDonde = 1;
         |SI #refer02@#2 ! "T";
             |SI #dspase03#5 = 1;  nHastaPeriodo = 3;  |FINSI;
             |SI #dspase03#5 = 2;  nHastaPeriodo = 6;  |FINSI;
             |SI #dspase03#5 = 3;  nHastaPeriodo = 9;  |FINSI;
             |SI #dspase03#5 = 4;  nHastaPeriodo = 12; |FINSI;
         |FINSI;
     |FINSI;

     |SI #refer00@#3 > nHastaPeriodo;  |ACABA;  |FINSI;

     |SI nDonde = 0;
         |SI #refer02@#28 ! 4;
             |SI #refer00@#3 = 1;  nPeriodo = 3;   nDPeriodo = 0;  nHPeriodo = 3;  |FINSI;
             |SI #refer00@#3 = 2;  nPeriodo = 6;   nDPeriodo = 4;  nHPeriodo = 6;  |FINSI;
             |SI #refer00@#3 = 3;  nPeriodo = 9;   nDPeriodo = 7;  nHPeriodo = 9;  |FINSI;
             |SI #refer00@#3 = 4;  nPeriodo = 12;  nDPeriodo = 10; nHPeriodo = 12; |FINSI;
         |SINO;
             nPeriodo  = #refer00@#3;
             nDPeriodo = #refer00@#3;
             nHPeriodo = #refer00@#3;
         |FINSI;
     |FINSI;

     |SI nDonde = 1;
         |SI #refer02@#2 = "T";
             |SI #refer00@#3 = 1;  nPeriodo = 3;   nDPeriodo = 0;  nHPeriodo = 3;  |FINSI;
             |SI #refer00@#3 = 2;  nPeriodo = 6;   nDPeriodo = 4;  nHPeriodo = 6;  |FINSI;
             |SI #refer00@#3 = 3;  nPeriodo = 9;   nDPeriodo = 7;  nHPeriodo = 9;  |FINSI;
             |SI #refer00@#3 = 4;  nPeriodo = 12;  nDPeriodo = 10; nHPeriodo = 12; |FINSI;
         |SINO;
             nPeriodo  = #refer00@#3;
             nDPeriodo = #refer00@#3;
             nHPeriodo = #refer00@#3;
         |FINSI;
     |FINSI;

     |ABRE #dsmom004;
     #dsmom004#0   = nCodigoNue;
     #dsmom004#1   = #dspase03#4;
     #dsmom004#2   = nPeriodo;
     #dsmom004#3   = 110;
     #dsmom004#4   = #refer00@#4;
     |LEE 040#dsmom004.=;
     |SI FSalida  = 0;  |Y #dsmom004#7 = "X";
         |CIERRA #dsmom004;
         |ACABA;
     |FINSI;
     |CIERRA #dsmom004;

     #agicen14#0 = nCodigoNue;
     #agicen14#1 = 1;
     |LEE 040#agicen14.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     #agicen14#6 = "01.01.0000";

     nModelo = 110;

     #agitab99#0 = 110;
     |LEE 040#agitab99.=;
     |SI FSalida ! 0;  |DDEFECTO #agitab99;  |FINSI;

     #dsmom002#0 = nCodigoNue;
     #dsmom002#1 = 1;
     #dsmom002#2 = 110;
     |LEE 101#dsmom002.=;
     |SI FSalida ! 0;
         |DDEFECTO #dsmom002;
         #dsmom002#0  = nCodigoNue;
         #dsmom002#1  = 1;
         #dsmom002#2  = 110;
         |GRABA 020#dsmom002.b;
     |FINSI;

     #dsmom002#3  = #agitab99#1;
     #dsmom002#4  = #agitab99#2;
     #dsmom002#5  = #agitab99#3;
     #dsmom002#6  = #agicen14#4;
     #dsmom002#7  = "TRIMESTRAL";

     |SI nDonde = 0;
         |SI #refer02@#28 = 4;  #dsmom002#7  = "MENSUAL";  |FINSI;
     |FINSI;

     |SI nDonde = 1;
         |SI #refer02@#2 ! "T";  #dsmom002#7  = "MENSUAL";  |FINSI;
     |FINSI;

     #dsmom002#8  = #agicen14#5;
     #dsmom002#9  = #agicen14#6;
     #dsmom002#10 = 1;

     |GRABA 020#dsmom002.a;
     |LIBERA #dsmom002;

     |SI #agicen14#15 = "          ";  |O #agicen14#15 = "MODULOS   ";
          #agicen14#15 = "MANUAL";
     |FINSI;
     |GRABA 020#agicen14.a;
     |LIBERA #agicen14;
     |CIERRA #agicen14;

     enEmpresaA = nCodigoNue;
     enAnyo     = #dspase03#4;
     |SUB_EJECUTA_NP ":modelos/dsmoz001";

     nComplem = #refer00@#4;

     |SI #refer00@#4 ! 0;
         |HAZ CreaComplementaria;
     |FINSI;

     |ABRE #dsmom008;
     #dsmom008#0   = nCodigoNue;
     #dsmom008#1   = #dspase03#4;
     #dsmom008#2   = nPeriodo;
     #dsmom008#3   = nModelo;
     #dsmom008#4   = nComplem;
     #dsmom008#5   = #agicen14#1;
     |LEE 040#dsmom008.=;
     |SI FSalida ! 0;  |CIERRA #dsmom008; |ACABA;  |FINSI;
     |CIERRA #dsmom008;

     nSwHay = 0;
     |ABRE #dsmoc110;
     |ABRE #dsmoc111;
     |ABRE #dsm11101;

     nDPer = nDPeriodo;
     nHPer = nHPeriodo;
     |BUCLE eosm0032;

     |SI nDonde = 1;
         |SI nPeriodo = 3;  |Y #dsmom002#7  = "TRIMESTRAL";
             nDPer = 1900;
             nHPer = 2999;
             |BUCLE eosm0032;
         |FINSI;

         |SI nPeriodo = 1;  |Y #dsmom002#7  = "MENSUAL   ";
             nDPer = 1900;
             nHPer = 2999;
             |BUCLE eosm0032;
         |FINSI;
     |SINO;
         nDPer = 1900;
         nHPer = 2999;
         |BUCLE eosm0032;
     |FINSI;

     |SI nSwHay = 0;
         |SI #dspase03#4 [ 2010;
             |HAZ PasaNif110Vacio;
         |FINSI;

         |SI #dspase03#4 ] 2011;  |Y #dspase03#4 [ 2015;
             |HAZ PasaNif111Vacio;
         |FINSI;

         |SI #dspase03#4 ] 2016;
             |HAZ PasaNif11101Vacio;
             |SUB_EJECUTA_NP ":modelos/dsm11101";
         |FINSI;
     |FINSI;
     |CIERRA #dsmoc110;
     |CIERRA #dsmoc111;
     |CIERRA #dsm11101;

     enEmpresa     = nCodigoNue;
     enEjer        = #dspase03#4;
     enPeriodo     = nPeriodo;
     enModelo      = nModelo;
     enComplem     = nComplem;
     enActividad   = #agicen14#1;
     enTipoEntrada = 98;
     enDesdePase   = 1;

     |SI #dspase03#4 [ 2010;
         |SUB_EJECUTA_NP ":modelos/dsmoc110";
     |FINSI;

     |SI #dspase03#4 ] 2011;  |Y #dspase03#4 [ 2015;
         |SUB_EJECUTA_NP ":modelos/dsmoc111";
     |FINSI;

     |SI #dspase03#4 ] 2016;
         |SUB_EJECUTA_NP ":modelos/dsm11101";
     |FINSI;

     #dspase25#0 = enModelo;
     #dspase25#1 = enPeriodo;
     #dspase25#2 = enComplem;
     #dspase25#3 = enEmpresa;
     |LEE 101#dspase25.=;
     |SI FSalida ! 0;
         |DDEFECTO #dspase25;
         #dspase25#0 = enModelo;
         #dspase25#1 = enPeriodo;
         #dspase25#2 = enComplem;
         #dspase25#3 = enEmpresa;
         |GRABA 020#dspase25.b;
     |FINSI;
     #dspase25#4 = #refer00@#28;
     |GRABA 020#dspase25.a;
     |LIBERA #dspase25;

     efFechaI   = ~;
     eaArchiva  = "";

     enDEmpresa = nCodigoNue;
     enHEmpresa = nCodigoNue;
     |SUB_EJECUTA "dspasuti;PonDatosPlaning";
|FPRC;

|DEFBUCLE eosm0133;
     #refer00@#1005;
     ;
     00001, #dspase03#4, 110,   1, 00;
     99999, #dspase03#4, 110,  12, 99;
     ;
     NULL, MiraModelo110;
|FIN;

|PROCESO DesdeNominas;
     aDef = eaPathAnterior + "aginom/def/eosm0133.mas";
     |CARGA_DEF aDef, refer00@;
     |SI FSalida ! 0;
         |ACABA;
     |FINSI;

     |SI #dspase03#4 ] 2016;
         aDef = eaPathAnterior + "aginom/def/eosm0035.mas";
     |SINO;
         aDef = eaPathAnterior + "aginom/def/eosm0032.mas";
     |FINSI;
     |CARGA_DEF aDef, refer01@;
     |SI FSalida ! 0;
         |DESCARGA_DEF #refer00@;
         |ACABA;
     |FINSI;

     aDef = eaPathAnterior + "aginom/def/labempre.mas";
     |CARGA_DEF aDef, refer02@;
     |SI FSalida ! 0;
         |DESCARGA_DEF #refer01@;
         |DESCARGA_DEF #refer00@;
         |ACABA;
     |FINSI;

     aDef = eaPathAnterior + "aginom/def/eosm0031.mas";
     |CARGA_DEF aDef, refer03@;
     |SI FSalida ! 0;
         |DESCARGA_DEF #refer02@;
         |DESCARGA_DEF #refer01@;
         |DESCARGA_DEF #refer00@;
         |ACABA;
     |FINSI;

     aFich = eaPathAnterior + "aginom/fich/";
     |PATH_DAT #refer00@#aFich#;
     |PATH_DAT #refer01@#aFich#;
     |PATH_DAT #refer02@#aFich#;
     |PATH_DAT #refer03@#aFich#;

     |ABRE #dsmom002;
     |ABRE #agitab99;
     |ABRE #agitab12;
     |ABRE #refer02@;
     |ABRE #refer03@;

     |BUCLE eosm0133;

     |CIERRA #refer03@;
     |CIERRA #refer02@;
     |CIERRA #agitab12;
     |CIERRA #dsmom002;
     |CIERRA #agitab99;

     |DESCARGA_DEF #refer03@;
     |DESCARGA_DEF #refer02@;
     |DESCARGA_DEF #refer01@;
     |DESCARGA_DEF #refer00@;
|FPRC;

|PROCESO DesdeReo;
     aDef = eaPathAnterior + "agieos/def/eosm0133.mas";
     |CARGA_DEF aDef, refer00@;
     |SI FSalida ! 0;
         |ACABA;
     |FINSI;

     |SI #dspase03#4 ] 2016;
         aDef = eaPathAnterior + "agieos/def/eosm0035.mas";
     |SINO;
         aDef = eaPathAnterior + "agieos/def/eosm0032.mas";
     |FINSI;
     |CARGA_DEF aDef, refer01@;
     |SI FSalida ! 0;
         |DESCARGA_DEF #refer00@;
         |ACABA;
     |FINSI;

     aDef = eaPathAnterior + "agieos/def/eosm0028.mas";
     |CARGA_DEF aDef, refer02@;
     |SI FSalida ! 0;
         |DESCARGA_DEF #refer01@;
         |DESCARGA_DEF #refer00@;
         |ACABA;
     |FINSI;

     aDef = eaPathAnterior + "agieos/def/eosm0031.mas";
     |CARGA_DEF aDef, refer03@;
     |SI FSalida ! 0;
         |DESCARGA_DEF #refer02@;
         |DESCARGA_DEF #refer01@;
         |DESCARGA_DEF #refer00@;
         |ACABA;
     |FINSI;

     aFich = eaPathAnterior + "agieos/fich/";
     |PATH_DAT #refer00@#aFich#;
     |PATH_DAT #refer01@#aFich#;
     |PATH_DAT #refer02@#aFich#;
     |PATH_DAT #refer03@#aFich#;

     |ABRE #dsmom002;
     |ABRE #agitab99;
     |ABRE #agitab12;
     |ABRE #refer02@;
     |ABRE #refer03@;

     |BUCLE eosm0133;

     |CIERRA #refer03@;
     |CIERRA #refer02@;
     |CIERRA #agitab12;
     |CIERRA #dsmom002;
     |CIERRA #agitab99;

     |DESCARGA_DEF #refer03@;
     |DESCARGA_DEF #refer02@;
     |DESCARGA_DEF #refer01@;
     |DESCARGA_DEF #refer00@;
|FPRC;

|PROCESO Modelo110;
     enModelo   = 110;
     enDEmpresa = #dspase03#9;
     enHEmpresa = #dspase03#10;

     |SI #dspase03#8 = 1;
         |SUB_EJECUTA "dspasuti;BorraModelos";
     |FINSI;

     |SI #dspase03#8 = 1;  |O #dspase03#8 = 3;
         nDonde = 0;  |HAZ DesdeNominas;
     |FINSI;

     |SI #dspase03#8 = 1;  |O #dspase03#8 = 2;
         nDonde = 1;  |HAZ DesdeReo;
     |FINSI;
|FPRC;

|| *************************************************************************
|| *************************************************************************
|| *************************************************************************
||               M O D E L O   1 1 5
|| *************************************************************************
|| *************************************************************************
|| *************************************************************************
|PROCESO LeerRefCatastral;
     |DDEFECTO #refer03@;
     #refer03@#0 = #refer01@#0;
     #refer03@#1 = #refer01@#2;
     #refer03@#4 = #refer01@#11;
     |LEE 041#refer03@.=;

     #dsmoc115#29 = #refer03@#5;
     #dsmoc115#30 = #refer03@#6;
     #dsmoc115#31 = #refer03@#7;
     #dsmoc115#32 = #refer03@#8;
     #dsmoc115#33 = #refer03@#9;
     #dsmoc115#34 = #refer03@#10;
     #dsmoc115#35 = #refer03@#11;
     #dsmoc115#36 = #refer03@#12;
     #dsmoc115#37 = #refer03@#13;
     #dsmoc115#38 = #refer03@#14;
     #dsmoc115#39 = #refer03@#15;
     #dsmoc115#40 = #refer03@#16;
     #dsmoc115#41 = #refer03@#17;
|FPRC;

|PROCESO PasaNif115;
     #refer02@#0  = #refer01@#0;
     #refer02@#1  = #refer01@#1;
     #refer02@#2  = #refer01@#2;
     #refer02@#4  = #refer01@#11;
     |LEE 040#refer02@.=;
     |SI FSalida ! 0;  |DDEFECTO #refer02@;  |FINSI;

     #dsmoc115#0 = #dsmom008#0;
     #dsmoc115#1 = #dsmom008#1;
     #dsmoc115#2 = #dsmom008#2;
     #dsmoc115#3 = #dsmom008#3;
     #dsmoc115#4 = #dsmom008#4;
     #dsmoc115#5 = #dsmom008#5;
     #dsmoc115#6 = #refer01@#2;
     #dsmoc115#7 = 0;
     |SI #refer01@#9 > 12;  #dsmoc115#7 = #refer01@#9;  |FINSI;
     #dsmoc115#28 = #refer01@#11;
     |LEE 101#dsmoc115.=;
     |SI FSalida ! 0;
         |DDEFECTO #dsmoc115;
         #dsmoc115#0 = #dsmom008#0;
         #dsmoc115#1 = #dsmom008#1;
         #dsmoc115#2 = #dsmom008#2;
         #dsmoc115#3 = #dsmom008#3;
         #dsmoc115#4 = #dsmom008#4;
         #dsmoc115#5 = #dsmom008#5;
         #dsmoc115#6 = #refer01@#2;
         #dsmoc115#7 = 0;
         |SI #refer01@#9 > 12;  #dsmoc115#7 = #refer01@#9;  |FINSI;
         #dsmoc115#28 = #refer01@#11;
         |SI #dsmoc115#1 ] 2015;
             |HAZ LeerRefCatastral;
         |FINSI;
         |GRABA 020#dsmoc115.b;
     |FINSI;

     |SI #refer04@#2 ! "T";
         #dsmoc115#8  = #dsmoc115#8  + #refer01@#3;
         #dsmoc115#9  = #refer01@#4;
         #dsmoc115#10 = #dsmoc115#10 + #refer01@#5;
         #dsmoc115#11 = #dsmoc115#11 + #refer01@#6;
         #dsmoc115#12 = #refer01@#7;
         #dsmoc115#13 = #dsmoc115#13 + #refer01@#8;
     |SINO;
         |SI #refer01@#9 = 1;  |O #refer01@#9 = 4;  |O #refer01@#9 = 7;  |O #refer01@#9 = 10;  |O #refer01@#9 > 12;
             #dsmoc115#8  = #dsmoc115#8  + #refer01@#3;
             #dsmoc115#9  = #refer01@#4;
             #dsmoc115#10 = #dsmoc115#10 + #refer01@#5;
             #dsmoc115#11 = #dsmoc115#11 + #refer01@#6;
             #dsmoc115#12 = #refer01@#7;
             #dsmoc115#13 = #dsmoc115#13 + #refer01@#8;
         |FINSI;

         |SI #refer01@#9 = 2;  |O #refer01@#9 = 5;  |O #refer01@#9 = 8;  |O #refer01@#9 = 11;
             #dsmoc115#14 = #dsmoc115#14 + #refer01@#3;
             #dsmoc115#15 = #refer01@#4;
             #dsmoc115#16 = #dsmoc115#16 + #refer01@#5;
             #dsmoc115#17 = #dsmoc115#17 + #refer01@#6;
             #dsmoc115#18 = #refer01@#7;
             #dsmoc115#19 = #dsmoc115#19 + #refer01@#8;
         |FINSI;

         |SI #refer01@#9 = 3;  |O #refer01@#9 = 6;  |O #refer01@#9 = 9;  |O #refer01@#9 = 12;
             #dsmoc115#20 = #dsmoc115#20 + #refer01@#3;
             #dsmoc115#21 = #refer01@#4;
             #dsmoc115#22 = #dsmoc115#22 + #refer01@#5;
             #dsmoc115#23 = #dsmoc115#23 + #refer01@#6;
             #dsmoc115#24 = #refer01@#7;
             #dsmoc115#25 = #dsmoc115#25 + #refer01@#8;
         |FINSI;
     |FINSI;

     #dsmoc115#26 = #refer02@#3;

     |GRABA 020#dsmoc115.a;
     |LIBERA #dsmoc115;

     nSwHay = 1;
|FPRC;

|DEFBUCLE eosm0042;
     #refer01@#1005;
     ;
     #refer00@#0, #refer00@#1, "            ", 01, nDPer;
     #refer00@#0, #refer00@#1, "zzzzzzzzzzzz", 99, nHPer;
     ;
     NULL, PasaNif115;
|FIN;

|PROCESO MiraAnterior;
     #dsmoc115#2 = nPeriodo;

     |SI nPrimera = 1;
         #dsmoc115#8  = #refer00@#7;
         #dsmoc115#10 = #refer00@#8;
         #dsmoc115#9  = (#dsmoc115#10 * 100) / #dsmoc115#8;

         #dsmoc115#11 = #refer00@#10;
         #dsmoc115#13 = #refer00@#11;
         #dsmoc115#12 = (#dsmoc115#13 * 100) / #dsmoc115#11;

         |PDEFECTO #dsmoc115, 14, 26;
     |FINSI;

     |SI nSwHay = 1;  |Y nPrimera = 1;
         |PDEFECTO #dsmoc115, 8, 26;
     |FINSI;

     |GRABA 020#dsmoc115.n;
     |LIBERA #dsmoc115;

     nSwHay = 1;
|FPRC;

|DEFBUCLE dsmoc115;
     #dsmoc115#1;
     ;
     #dsmom008#0, #dsmom008#1, nDPer, #dsmom008#3, #dsmom008#4, #dsmom008#5, "            ", 0, 01;
     #dsmom008#0, #dsmom008#1, nHPer, #dsmom008#3, #dsmom008#4, #dsmom008#5, "zzzzzzzzzzzz", 0, 99;
     be;
     NULL, MiraAnterior;
|FIN;

|PROCESO RevisaAnterior;
     |SALVA_FICHA #refer00@;
     #refer00@#3 = #refer00@#3 - 1;
     |LEE 040#refer00@.=;
     |SI FSalida ! 0;  |DDEFECTO #refer00@;  |FINSI;

     nResult = #refer00@#12;

     |REPON_FICHA #refer00@;

     nPrimera = 0;
     |SI nResult ! #refer00@#12;
         nPrimera = 1;
     |FINSI;

     |BUCLE dsmoc115;
|FPRC;

|PROCESO PasaNif115Vacio;
     #dsmoc115#0 = #dsmom008#0;
     #dsmoc115#1 = #dsmom008#1;
     #dsmoc115#2 = #dsmom008#2;
     #dsmoc115#3 = #dsmom008#3;
     #dsmoc115#4 = #dsmom008#4;
     #dsmoc115#5 = #dsmom008#5;
     #dsmoc115#6 = "PASEANTERIOR";
     #dsmoc115#7 = 0;
     |LEE 101#dsmoc115.=;
     |SI FSalida ! 0;
         |DDEFECTO #dsmoc115;
         #dsmoc115#0 = #dsmom008#0;
         #dsmoc115#1 = #dsmom008#1;
         #dsmoc115#2 = #dsmom008#2;
         #dsmoc115#3 = #dsmom008#3;
         #dsmoc115#4 = #dsmom008#4;
         #dsmoc115#5 = #dsmom008#5;
         #dsmoc115#6 = "PASEANTERIOR";
         #dsmoc115#7 = 0;
         |GRABA 020#dsmoc115.b;
     |FINSI;

     #dsmoc115#8  = #refer00@#7;
     #dsmoc115#10 = #refer00@#8;
     #dsmoc115#9  = (#dsmoc115#10 * 100) / #dsmoc115#8;

     #dsmoc115#11 = #refer00@#10;
     #dsmoc115#13 = #refer00@#11;
     #dsmoc115#12 = (#dsmoc115#13 * 100) / #dsmoc115#11;

     |PDEFECTO #dsmoc115, 14, 26;

     #dsmoc115#26 = "DESDE REO SIN REGISTRO ARRENDADORES";

     |GRABA 020#dsmoc115.a;
     |LIBERA #dsmoc115;
|FPRC;

|PROCESO MiraModelo115;
     |SI enEstaCambio = 1;
         nCodigoNue = 0;
         nCodigoReo = #refer00@#0;
         |BUCLE dspase15_Eos110;
         |SI nCodigoNue = 0;  |ACABA;  |FINSI;
     |SINO;
         nCodigoNue = #refer00@#0;
     |FINSI;
     |SI nCodigoNue < #dspase03#9; |O nCodigoNue > #dspase03#10; |ACABA; |FINSI;

     |SI #dspase03#8 ! 1;
         #dspase99#0 = nCodigoNue;
         #dspase99#1 = 115;
         |LEE 101#dspase99.=;
         |SI FSalida ! 0;
             enDEmpresa = nCodigoNue;
             enHEmpresa = nCodigoNue;
             enModelo   = 115;
             |SUB_EJECUTA "dspasuti;BorraModelos";

             #dspase99#0 = nCodigoNue;
             #dspase99#1 = 115;
             |GRABA 020#dspase99.n;
             |LIBERA #dspase99;
         |FINSI;
     |FINSI;

     |ABRE #agicen14;
     #agicen14#0 = nCodigoNue;
     #agicen14#1 = 1;
     |LEE 040#agicen14.=;
     |SI FSalida ! 0;
         |DDEFECTO #agicen14;
         #agicen14#0 = nCodigoNue;
         #agicen14#1 = 1;
         |GRABA 020#agicen14.n;
         |LIBERA #agicen14;
     |FINSI;

     #refer04@#0 = #refer00@#0;
     |LEE 040#refer04@.=;
     |SI FSalida ! 0;  |DDEFECTO #refer04@;  |FINSI;

     nHastaPeriodo = #dspase03#5;
     |SI #refer04@#2 ! "T";
         |SI #dspase03#5 = 1;  nHastaPeriodo = 3;  |FINSI;
         |SI #dspase03#5 = 2;  nHastaPeriodo = 6;  |FINSI;
         |SI #dspase03#5 = 3;  nHastaPeriodo = 9;  |FINSI;
         |SI #dspase03#5 = 4;  nHastaPeriodo = 12; |FINSI;
     |FINSI;

     |SI #refer00@#3 > nHastaPeriodo;  |ACABA;  |FINSI;

     |SI #refer04@#2 = "T";
         |SI #refer00@#3 = 1;  nPeriodo = 3;   nDPeriodo = 0;  nHPeriodo = 3;  |FINSI;
         |SI #refer00@#3 = 2;  nPeriodo = 6;   nDPeriodo = 4;  nHPeriodo = 6;  |FINSI;
         |SI #refer00@#3 = 3;  nPeriodo = 9;   nDPeriodo = 7;  nHPeriodo = 9;  |FINSI;
         |SI #refer00@#3 = 4;  nPeriodo = 12;  nDPeriodo = 10; nHPeriodo = 12; |FINSI;
     |SINO;
         nPeriodo  = #refer00@#3;
         nDPeriodo = #refer00@#3;
         nHPeriodo = #refer00@#3;
     |FINSI;

     |ABRE #dsmom004;
     #dsmom004#0   = nCodigoNue;
     #dsmom004#1   = #dspase03#4;
     #dsmom004#2   = nPeriodo;
     #dsmom004#3   = 115;
     #dsmom004#4   = #refer00@#4;
     |LEE 040#dsmom004.=;
     |SI FSalida  = 0;  |Y #dsmom004#7 = "X";
         |CIERRA #dsmom004;
         |ACABA;
     |FINSI;
     |CIERRA #dsmom004;

     #agicen14#0 = nCodigoNue;
     #agicen14#1 = 1;
     |LEE 040#agicen14.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     #agicen14#6 = "01.01.0000";

     nModelo = 115;

     #agitab99#0 = 115;
     |LEE 040#agitab99.=;
     |SI FSalida ! 0;  |DDEFECTO #agitab99;  |FINSI;

     #dsmom002#0 = nCodigoNue;
     #dsmom002#1 = 1;
     #dsmom002#2 = 115;
     |LEE 101#dsmom002.=;
     |SI FSalida ! 0;
         |DDEFECTO #dsmom002;
         #dsmom002#0  = nCodigoNue;
         #dsmom002#1  = 1;
         #dsmom002#2  = 115;
         |GRABA 020#dsmom002.b;
     |FINSI;

     #dsmom002#3  = #agitab99#1;
     #dsmom002#4  = #agitab99#2;
     #dsmom002#5  = #agitab99#3;
     #dsmom002#6  = #agicen14#4;
     #dsmom002#7  = "TRIMESTRAL";
     |SI #refer04@#2 ! "T";  #dsmom002#7  = "MENSUAL";  |FINSI;
     #dsmom002#8  = #agicen14#5;
     #dsmom002#9  = #agicen14#6;
     #dsmom002#10 = 1;

     |GRABA 020#dsmom002.a;
     |LIBERA #dsmom002;

     |SI #agicen14#15 = "          ";  |O #agicen14#15 = "MODULOS   ";
          #agicen14#15 = "MANUAL";
     |FINSI;
     |GRABA 020#agicen14.a;
     |LIBERA #agicen14;
     |CIERRA #agicen14;

     enEmpresaA = nCodigoNue;
     enAnyo     = #dspase03#4;
     |SUB_EJECUTA_NP ":modelos/dsmoz001";

     nComplem = #refer00@#4;

     |SI #refer00@#4 ! 0;
         |HAZ CreaComplementaria;
     |FINSI;

     |ABRE #dsmom008;
     #dsmom008#0   = nCodigoNue;
     #dsmom008#1   = #dspase03#4;
     #dsmom008#2   = nPeriodo;
     #dsmom008#3   = nModelo;
     #dsmom008#4   = nComplem;
     #dsmom008#5   = #agicen14#1;
     |LEE 040#dsmom008.=;
     |SI FSalida ! 0;  |CIERRA #dsmom008; |ACABA;  |FINSI;
     |CIERRA #dsmom008;

     nSwHay = 0;
     |ABRE #dsmoc115;
     |ABRE #refer03@;

     nDPer = nDPeriodo;
     nHPer = nHPeriodo;
     |BUCLE eosm0042;

     |SI nPeriodo = 3;  |Y #dsmom002#7  = "TRIMESTRAL";
         nDPer = 1900;
         nHPer = 2999;
         |BUCLE eosm0042;
     |FINSI;

     |SI nPeriodo = 1;  |Y #dsmom002#7  = "MENSUAL   ";
         nDPer = 1900;
         nHPer = 2999;
         |BUCLE eosm0042;
     |FINSI;

     |CIERRA #refer03@;
     |CIERRA #dsmoc115;

     |SI nSwHay = 0;
         |SI #refer00@#3 ! 1;
             |SI #dsmom002#7  = "TRIMESTRAL";
                 nDPer = nPeriodo - 3;
                 nHPer = nPeriodo - 3;
             |FINSI;

             |SI #dsmom002#7  = "MENSUAL   ";
                 nDPer = nPeriodo - 1;
                 nHPer = nPeriodo - 1;
             |FINSI;

             |HAZ RevisaAnterior;
         |FINSI;

         |SI nSwHay = 0;
             |ABRE #dsmoc115;
             |HAZ PasaNif115Vacio;
             |CIERRA #dsmoc115;
         |FINSI;
     |FINSI;

     enEmpresa     = nCodigoNue;
     enEjer        = #dspase03#4;
     enPeriodo     = nPeriodo;
     enModelo      = nModelo;
     enComplem     = nComplem;
     enActividad   = #agicen14#1;
     enTipoEntrada = 98;

     |SUB_EJECUTA_NP ":modelos/dsmoc115";

     #dspase25#0 = enModelo;
     #dspase25#1 = enPeriodo;
     #dspase25#2 = enComplem;
     #dspase25#3 = enEmpresa;
     |LEE 101#dspase25.=;
     |SI FSalida ! 0;
         |DDEFECTO #dspase25;
         #dspase25#0 = enModelo;
         #dspase25#1 = enPeriodo;
         #dspase25#2 = enComplem;
         #dspase25#3 = enEmpresa;
         |GRABA 020#dspase25.b;
     |FINSI;
     #dspase25#4 = #refer00@#12;
     |GRABA 020#dspase25.a;
     |LIBERA #dspase25;

     efFechaI   = ~;
     eaArchiva  = "";

     |SUB_EJECUTA "dspasuti;PonDatosPlaning";
|FPRC;

|DEFBUCLE eosm0043;
     #refer00@#1005;
     ;
     00001, #dspase03#4, 115,   1, 00;
     99999, #dspase03#4, 115,  12, 99;
     ;
     NULL, MiraModelo115;
|FIN;

|PROCESO Pase115Reo;
     aDef = eaPathAnterior + "agieos/def/eosm0043.mas";
     |CARGA_DEF aDef, refer00@;
     |SI FSalida ! 0;
         |ACABA;
     |FINSI;

     aDef = eaPathAnterior + "agieos/def/eosm0042.mas";
     |CARGA_DEF aDef, refer01@;
     |SI FSalida ! 0;
         |DESCARGA_DEF #refer00@;
         |ACABA;
     |FINSI;

     aDef = eaPathAnterior + "agieos/def/eosm0041.mas";
     |CARGA_DEF aDef, refer02@;
     |SI FSalida ! 0;
         |DESCARGA_DEF #refer01@;
         |DESCARGA_DEF #refer00@;
         |ACABA;
     |FINSI;

     aDef = eaPathAnterior + "agieos/def/eosm0045.mas";
     |CARGA_DEF aDef, refer03@;
     |SI FSalida ! 0;
         |DESCARGA_DEF #refer02@;
         |DESCARGA_DEF #refer01@;
         |DESCARGA_DEF #refer00@;
         |ACABA;
     |FINSI;

     aDef = eaPathAnterior + "agieos/def/eosm0046.mas";
     |CARGA_DEF aDef, refer04@;
     |SI FSalida ! 0;
         |DESCARGA_DEF #refer03@;
         |DESCARGA_DEF #refer02@;
         |DESCARGA_DEF #refer01@;
         |DESCARGA_DEF #refer00@;
         |ACABA;
     |FINSI;

     aFich = eaPathAnterior + "agieos/fich/";
     |PATH_DAT #refer00@#aFich#;
     |PATH_DAT #refer01@#aFich#;
     |PATH_DAT #refer02@#aFich#;
     |PATH_DAT #refer03@#aFich#;
     |PATH_DAT #refer04@#aFich#;

     |ABRE #dsmom002;
     |ABRE #agitab99;
     |ABRE #agitab12;
     |ABRE #refer02@;
     |ABRE #refer04@;
     |BUCLE eosm0043;
     |CIERRA #agitab12;
     |CIERRA #dsmom002;
     |CIERRA #agitab99;
     |CIERRA #refer02@;
     |CIERRA #refer04@;

     |DESCARGA_DEF #refer04@;
     |DESCARGA_DEF #refer03@;
     |DESCARGA_DEF #refer02@;
     |DESCARGA_DEF #refer01@;
     |DESCARGA_DEF #refer00@;
|FPRC;

|PROCESO GrabaElPeriodo;
     |SI nPeriodo > nHastaPeriodo;  |ACABA;  |FINSI;

     |ABRE #agicen14;
     #agicen14#0 = nCodigoNue;
     #agicen14#1 = 1;
     |LEE 040#agicen14.=;
     |SI FSalida ! 0;
         |DDEFECTO #agicen14;
         #agicen14#0 = nCodigoNue;
         #agicen14#1 = 1;
         |GRABA 020#agicen14.n;
         |LIBERA #agicen14;
     |FINSI;

     |SI nPrimera = 0;
         |ABRE #dsmom004;
         #dsmom004#0   = nCodigoNue;
         #dsmom004#1   = #dspase03#4;
         #dsmom004#2   = nPeriodo;
         #dsmom004#3   = 115;
         #dsmom004#4   = #refer00@#4;
         |LEE 040#dsmom004.=;
         |SI FSalida  = 0;  |Y #dsmom004#7 = "X";
             |CIERRA #dsmom004;
             |ACABA;
         |FINSI;
         |CIERRA #dsmom004;
     |FINSI;

     #agicen14#0 = nCodigoNue;
     #agicen14#1 = 1;
     |LEE 040#agicen14.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     #agicen14#6 = "01.01.0000";

     nModelo = 115;

     #agitab99#0 = 115;
     |LEE 040#agitab99.=;
     |SI FSalida ! 0;  |DDEFECTO #agitab99;  |FINSI;

     #dsmom002#0 = nCodigoNue;
     #dsmom002#1 = 1;
     #dsmom002#2 = 115;
     |LEE 101#dsmom002.=;
     |SI FSalida ! 0;
         |DDEFECTO #dsmom002;
         #dsmom002#0  = nCodigoNue;
         #dsmom002#1  = 1;
         #dsmom002#2  = 115;
         |GRABA 020#dsmom002.b;
     |FINSI;

     #dsmom002#3  = #agitab99#1;
     #dsmom002#4  = #agitab99#2;
     #dsmom002#5  = #agitab99#3;
     #dsmom002#6  = #agicen14#4;
     #dsmom002#7  = "TRIMESTRAL";
     |SI #refer02@#93 = "M";  #dsmom002#7 = "MENSUAL"; |FINSI;
     #dsmom002#8  = #agicen14#5;
     #dsmom002#9  = #agicen14#6;
     #dsmom002#10 = 1;

     |GRABA 020#dsmom002.a;
     |LIBERA #dsmom002;

     |SI #agicen14#15 = "          ";  |O #agicen14#15 = "MODULOS   ";
          #agicen14#15 = "REGISTROS";
     |FINSI;
     |GRABA 020#agicen14.a;
     |LIBERA #agicen14;
     |CIERRA #agicen14;

     enEmpresaA = nCodigoNue;
     enAnyo     = #dspase03#4;
     |SUB_EJECUTA_NP ":modelos/dsmoz001";

     |ABRE #dsmom008;
     #dsmom008#0   = nCodigoNue;
     #dsmom008#1   = #dspase03#4;
     #dsmom008#2   = nPeriodo;
     #dsmom008#3   = nModelo;
     #dsmom008#4   = 0;
     #dsmom008#5   = #agicen14#1;
     |LEE 040#dsmom008.=;
     |SI FSalida ! 0;  |CIERRA #dsmom008; |ACABA;  |FINSI;
     |CIERRA #dsmom008;

     |ABRE #dsmoc115;
     #dsmoc115#0 = #dsmom008#0;
     #dsmoc115#1 = #dsmom008#1;
     #dsmoc115#2 = #dsmom008#2;
     #dsmoc115#3 = #dsmom008#3;
     #dsmoc115#4 = #dsmom008#4;
     #dsmoc115#5 = #dsmom008#5;
     #dsmoc115#6 = #refer00@#7;
     #dsmoc115#7 = 0;
     |LEE 101#dsmoc115.=;
     |SI FSalida ! 0;
         |DDEFECTO #dsmoc115;
         #dsmoc115#0 = #dsmom008#0;
         #dsmoc115#1 = #dsmom008#1;
         #dsmoc115#2 = #dsmom008#2;
         #dsmoc115#3 = #dsmom008#3;
         #dsmoc115#4 = #dsmom008#4;
         #dsmoc115#5 = #dsmom008#5;
         #dsmoc115#6 = #refer00@#7;
         #dsmoc115#7 = 0;
         |GRABA 020#dsmoc115.b;
     |FINSI;

  || aqui
     |SI #refer02@#93 ! "M";
         |SI nPeriodo = 3;   nDPer = 23;  nHPer = 25;  |FINSI;
         |SI nPeriodo = 6;   nDPer = 26;  nHPer = 28;  |FINSI;
         |SI nPeriodo = 9;   nDPer = 29;  nHPer = 31;  |FINSI;
         |SI nPeriodo = 12;  nDPer = 32;  nHPer = 34;  |FINSI;
     |SINO;
         nDPer = 22 + nPeriodo;
         nHPer = nDPer;
     |FINSI;

     nTotal  = 0;
     nCampo2 = 7;
     |PARA nCampo = nDPer;  |SI nCampo [ nHPer;  |HACIENDO nCampo = nCampo + 1;
           nCampo1 = nCampo;
           nCampo2 = nCampo2 + 1;  #dsmoc115#nCampo2# = #refer00@#nCampo1#;
           |SI #dsmoc115#nCampo2# ! 0;
               nCampo2 = nCampo2 + 1;
               #dsmoc115#nCampo2# = #refer00@#9;
           |SINO;
               nCampo2 = nCampo2 + 1;
           |FINSI;

           nCampo2 = nCampo2 + 1;
           nCampo1 = nCampo  + 13; #dsmoc115#nCampo2#  = #refer00@#nCampo1#;
           nTotal  = nTotal  + #refer00@#nCampo1#;

           nCampo2 = nCampo2 + 1;
           nCampo1 = nCampo  + 26;  #dsmoc115#nCampo2# = #refer00@#nCampo1#;

           |SI #dsmoc115#nCampo2# ! 0;
               nCampo2 = nCampo2 + 1;
               #dsmoc115#nCampo2# = #refer00@#10;
           |SINO;
               nCampo2 = nCampo2 + 1;
           |FINSI;

           nCampo2 = nCampo2 + 1;
           nCampo1 = nCampo  + 39;  #dsmoc115#nCampo2# = #refer00@#nCampo1#;
           nTotal  = nTotal + #refer00@#nCampo1#;
     |SIGUE;

     #dsmoc115#26 = #refer00@#3;

     |GRABA 020#dsmoc115.a;
     |LIBERA #dsmoc115;
     |CIERRA #dsmoc115;

     enEmpresa     = nCodigoNue;
     enEjer        = #dspase03#4;
     enPeriodo     = nPeriodo;
     enModelo      = nModelo;
     enComplem     = nComplem;
     enActividad   = #agicen14#1;
     enTipoEntrada = 98;
     nPrimera      = 1;

     |SUB_EJECUTA_NP ":modelos/dsmoc115";

     #dspase25#0 = enModelo;
     #dspase25#1 = enPeriodo;
     #dspase25#2 = enComplem;
     #dspase25#3 = enEmpresa;
     |LEE 101#dspase25.=;
     |SI FSalida ! 0;
         |DDEFECTO #dspase25;
         #dspase25#0 = enModelo;
         #dspase25#1 = enPeriodo;
         #dspase25#2 = enComplem;
         #dspase25#3 = enEmpresa;
         |GRABA 020#dspase25.b;
     |FINSI;
     #dspase25#4 = #dspase25#4 + nTotal;
     |GRABA 020#dspase25.a;
     |LIBERA #dspase25;

     efFechaI   = ~;
     eaArchiva  = "";

     |SUB_EJECUTA "dspasuti;PonDatosPlaning";
|FPRC;

|PROCESO MiraModelo115Cont;
     |SI enEstaCambio = 1;
         nCodigoNue  = 0;
         nCodigoCont = #refer00@#0;
         |BUCLE dspase15_Cont110;
         |SI nCodigoNue = 0;  |ACABA;  |FINSI;
     |SINO;
         nCodigoNue = #refer00@#0;
     |FINSI;
     |SI nCodigoNue < #dspase03#9; |O nCodigoNue > #dspase03#10; |ACABA; |FINSI;

     |SI #dspase03#8 ! 1;
         #dspase99#0 = nCodigoNue;
         #dspase99#1 = 115;
         |LEE 101#dspase99.=;
         |SI FSalida ! 0;
             enDEmpresa = nCodigoNue;
             enHEmpresa = nCodigoNue;
             enModelo   = 115;
             |SUB_EJECUTA "dspasuti;BorraModelos";

             #dspase99#0 = nCodigoNue;
             #dspase99#1 = 115;
             |GRABA 020#dspase99.n;
             |LIBERA #dspase99;
         |FINSI;
     |FINSI;

     nHastaPeriodo = #dspase03#5;
     |SI #refer02@#93 ! "M";
         |SI #dspase03#5 = 1;  nHastaPeriodo = 3;  |FINSI;
         |SI #dspase03#5 = 2;  nHastaPeriodo = 6;  |FINSI;
         |SI #dspase03#5 = 3;  nHastaPeriodo = 9;  |FINSI;
         |SI #dspase03#5 = 4;  nHastaPeriodo = 12; |FINSI;
     |FINSI;

     |SI #refer02@#93 ! "M";
         |SI #refer00@#3 = 1;  nPeriodo = 3;   nDPeriodo = 0;  nHPeriodo = 3;  |FINSI;
         |SI #refer00@#3 = 2;  nPeriodo = 6;   nDPeriodo = 4;  nHPeriodo = 6;  |FINSI;
         |SI #refer00@#3 = 3;  nPeriodo = 9;   nDPeriodo = 7;  nHPeriodo = 9;  |FINSI;
         |SI #refer00@#3 = 4;  nPeriodo = 12;  nDPeriodo = 10; nHPeriodo = 12; |FINSI;
     |SINO;
         nPeriodo  = #refer00@#3;
         nDPeriodo = #refer00@#3;
         nHPeriodo = #refer00@#3;
     |FINSI;

     |SI #refer02@#93 ! "M";
         |SI #refer00@#36 ! 0;  |O #refer00@#37 ! 0;  |O #refer00@#38 ! 0;
             |O #refer00@#62 ! 0;  |O #refer00@#63 ! 0;  |O #refer00@#64 ! 0;
                nPeriodo = 3;
                |HAZ GrabaElPeriodo;
         |FINSI;

         |SI #refer00@#39 ! 0;  |O #refer00@#40 ! 0;  |O #refer00@#41 ! 0;
             |O #refer00@#65 ! 0;  |O #refer00@#66 ! 0;  |O #refer00@#67 ! 0;
                nPeriodo = 6;
                |HAZ GrabaElPeriodo;
         |FINSI;

         |SI #refer00@#42 ! 0;  |O #refer00@#43 ! 0;  |O #refer00@#44 ! 0;
             |O #refer00@#68 ! 0;  |O #refer00@#69 ! 0;  |O #refer00@#70 ! 0;
                nPeriodo = 9;
                |HAZ GrabaElPeriodo;
         |FINSI;

         |SI #refer00@#45 ! 0;  |O #refer00@#46 ! 0;  |O #refer00@#47 ! 0;
             |O #refer00@#71 ! 0;  |O #refer00@#72 ! 0;  |O #refer00@#73 ! 0;
                nPeriodo = 12;
                |HAZ GrabaElPeriodo;
         |FINSI;
    |SINO;
         |SI #refer00@#36 ! 0;  |O #refer00@#62 ! 0;
             nPeriodo = 1;
             |HAZ GrabaElPeriodo;
         |FINSI;

         |SI #refer00@#37 ! 0;  |O #refer00@#63 ! 0;
             nPeriodo = 2;
             |HAZ GrabaElPeriodo;
         |FINSI;

         |SI #refer00@#38 ! 0; |O #refer00@#64 ! 0;
                nPeriodo = 3;
                |HAZ GrabaElPeriodo;
         |FINSI;

         |SI #refer00@#39 ! 0;  |O #refer00@#65 ! 0;
                nPeriodo = 4;
                |HAZ GrabaElPeriodo;
         |FINSI;
         |SI #refer00@#40 ! 0; |O #refer00@#66 ! 0;
                nPeriodo = 5;
                |HAZ GrabaElPeriodo;
         |FINSI;
         |SI #refer00@#41 ! 0; |O #refer00@#67 ! 0;
                nPeriodo = 6;
                |HAZ GrabaElPeriodo;
         |FINSI;

         |SI #refer00@#42 ! 0; |O #refer00@#68 ! 0;
                nPeriodo = 7;
                |HAZ GrabaElPeriodo;
         |FINSI;
         |SI #refer00@#43 ! 0;  |O #refer00@#69 ! 0;
                nPeriodo = 8;
                |HAZ GrabaElPeriodo;
         |FINSI;
         |SI #refer00@#44 ! 0; |O #refer00@#70 ! 0;
                nPeriodo = 9;
                |HAZ GrabaElPeriodo;
         |FINSI;

         |SI #refer00@#45 ! 0; |O #refer00@#71 ! 0;
                nPeriodo = 10;
                |HAZ GrabaElPeriodo;
         |FINSI;
         |SI #refer00@#46 ! 0; |O #refer00@#72 ! 0;
                nPeriodo = 11;
                |HAZ GrabaElPeriodo;
         |FINSI;
         |SI #refer00@#47 ! 0;  |O #refer00@#73 ! 0;
                nPeriodo = 12;
                |HAZ GrabaElPeriodo;
         |FINSI;
    |FINSI;
|FPRC;

|DEFBUCLE caman115;
     #refer00@#1003;
     ;
     00000, 00000, nAnyo;
     99999, 99999, nAnyo;
     ;
     NULL, MiraModelo115Cont;
|FIN;

|PROCESO MiraEmpresa115;
     aDef = eaPathAnterior + "agicont/def/caman115.mas";
     |CARGA_DEF aDef, refer00@;
     |SI FSalida ! 0;
         |ACABA;
     |FINSI;

     aDef = eaPathAnterior + "agicont/def/caportad.mas";
     |CARGA_DEF aDef, refer02@;
     |SI FSalida ! 0;
         |DESCARGA_DEF #refer00@;
         |ACABA;
     |FINSI;

     aFich = eaPathAnterior + "agicont/fich/" + (("00000" + #refer01@#2) % -105) + #refer01@#3 + "/";
     |PATH_DAT #refer00@#aFich#;
     |PATH_DAT #refer02@#aFich#;

     aAlfa    = #dspase03#4;
     aAlfa    = #dspase03#4 % -102;
     nAnyo    = aAlfa;
     nPrimera = 0;

     |ABRE #refer02@;
     #refer02@#0  = #refer01@#2;
     #refer02@#1  = #refer01@#26;
     |LEE 040#refer02@.=;
     |SI FSalida ! 0;  |DDEFECTO #refer02@;  |FINSI;
     |CIERRA #refer02@;

     |ABRE #dsmom002;
     |ABRE #agitab99;
     |ABRE #agitab12;
     |BUCLE caman115;
     |CIERRA #agitab12;
     |CIERRA #dsmom002;
     |CIERRA #agitab99;

     |DESCARGA_DEF #refer02@;
     |DESCARGA_DEF #refer00@;
|FPRC;

|DEFBUCLE canempre_115;
     #refer01@#1002;
     26;
     00000, 0, nAnyo;
     99999, 9, nAnyo;
     ;
     NULL, MiraEmpresa115;
|FIN;

|PROCESO Pase115Conta;
     aDef = eaPathAnterior + "agicont/def/canempre.mas";
     |CARGA_DEF aDef, refer01@;
     |SI FSalida ! 0;
         |ACABA;
     |FINSI;

     aFich = eaPathAnterior + "agicont/fich/";
     |PATH_DAT #refer01@#aFich#;

     aAlfa   = #dspase03#4;
     aAlfa   = #dspase03#4 % -102;
     nAnyo   = aAlfa;

     |BUCLE canempre_115;

     |DESCARGA_DEF #refer01@;
|FPRC;

|PROCESO Modelo115;
     enModelo   = 115;
     enDEmpresa = #dspase03#9;
     enHEmpresa = #dspase03#10;

     |SI #dspase03#8 = 1;
         |SUB_EJECUTA "dspasuti;BorraModelos";
     |FINSI;

     |SI #dspase03#8 = 1;  |O #dspase03#8 = 2;
         |HAZ Pase115Reo;
     |FINSI;

     |SI #dspase03#8 = 1;  |O #dspase03#8 = 3;
         |HAZ Pase115Conta;
     |FINSI;
|FPRC;

|PROCESO MiraModelo123;
     |SI enEstaCambio = 1;
         nCodigoNue = 0;
         nCodigoReo = #refer00@#0;
         |BUCLE dspase15_Eos110;
         |SI nCodigoNue = 0;  |ACABA;  |FINSI;
     |SINO;
         nCodigoNue = #refer00@#0;
     |FINSI;
     |SI nCodigoNue < #dspase03#9; |O nCodigoNue > #dspase03#10; |ACABA; |FINSI;

     |ABRE #agicen14;
     #agicen14#0 = nCodigoNue;
     #agicen14#1 = 1;
     |LEE 040#agicen14.=;
     |SI FSalida ! 0;
         |DDEFECTO #agicen14;
         #agicen14#0 = nCodigoNue;
         #agicen14#1 = 1;
         |GRABA 020#agicen14.n;
         |LIBERA #agicen14;
     |FINSI;

     nHastaPeriodo = #dspase03#5;
     |SI #refer00@#29 ! "T";
         |SI #dspase03#5 = 1;  nHastaPeriodo = 3;  |FINSI;
         |SI #dspase03#5 = 2;  nHastaPeriodo = 6;  |FINSI;
         |SI #dspase03#5 = 3;  nHastaPeriodo = 9;  |FINSI;
         |SI #dspase03#5 = 4;  nHastaPeriodo = 12; |FINSI;
     |FINSI;

     |SI #refer00@#2 > nHastaPeriodo;  |ACABA;  |FINSI;

     |SI #refer00@#29 = "T";
         |SI #refer00@#2 = 1;  nPeriodo = 3;   |FINSI;
         |SI #refer00@#2 = 2;  nPeriodo = 6;   |FINSI;
         |SI #refer00@#2 = 3;  nPeriodo = 9;   |FINSI;
         |SI #refer00@#2 = 4;  nPeriodo = 12;  |FINSI;
     |SINO;
         nPeriodo  = #refer00@#2;
     |FINSI;

     |ABRE #dsmom004;
     #dsmom004#0   = nCodigoNue;
     #dsmom004#1   = #dspase03#4;
     #dsmom004#2   = nPeriodo;
     #dsmom004#3   = 123;
     #dsmom004#4   = #refer00@#4;
     |LEE 040#dsmom004.=;
     |SI FSalida  = 0;  |Y #dsmom004#7 = "X";
         |CIERRA #dsmom004;
         |ACABA;
     |FINSI;
     |CIERRA #dsmom004;

     #agicen14#0 = nCodigoNue;
     #agicen14#1 = 1;
     |LEE 040#agicen14.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     #agicen14#6 = "01.01.0000";

     nModelo = 123;

     #agitab99#0 = 123;
     |LEE 040#agitab99.=;
     |SI FSalida ! 0;  |DDEFECTO #agitab99;  |FINSI;

     #dsmom002#0 = nCodigoNue;
     #dsmom002#1 = 1;
     #dsmom002#2 = 123;
     |LEE 101#dsmom002.=;
     |SI FSalida ! 0;
         |DDEFECTO #dsmom002;
         #dsmom002#0  = nCodigoNue;
         #dsmom002#1  = 1;
         #dsmom002#2  = 123;
         |GRABA 020#dsmom002.b;
     |FINSI;

     #dsmom002#3  = #agitab99#1;
     #dsmom002#4  = #agitab99#2;
     #dsmom002#5  = #agitab99#3;
     #dsmom002#6  = #agicen14#4;
     #dsmom002#7  = "TRIMESTRAL";

     |SI #refer00@#29 ! "T";  #dsmom002#7  = "MENSUAL";  |FINSI;

     #dsmom002#8  = #agicen14#5;
     #dsmom002#9  = #agicen14#6;
     #dsmom002#10 = 1;

     |GRABA 020#dsmom002.a;
     |LIBERA #dsmom002;

     |SI #agicen14#15 = "          ";  |O #agicen14#15 = "MODULOS   ";
          #agicen14#15 = "MANUAL";
     |FINSI;
     |GRABA 020#agicen14.a;
     |LIBERA #agicen14;
     |CIERRA #agicen14;

     enEmpresaA = nCodigoNue;
     enAnyo     = #dspase03#4;
     |SUB_EJECUTA_NP ":modelos/dsmoz001";

     nComplem = 0;

     |ABRE #dsmom008;
     #dsmom008#0   = nCodigoNue;
     #dsmom008#1   = #dspase03#4;
     #dsmom008#2   = nPeriodo;
     #dsmom008#3   = nModelo;
     #dsmom008#4   = nComplem;
     #dsmom008#5   = #agicen14#1;
     |LEE 040#dsmom008.=;
     |SI FSalida ! 0;  |CIERRA #dsmom008; |ACABA;  |FINSI;
     |CIERRA #dsmom008;

     nSwHay = 0;
     |ABRE #dsmoc123;
     #dsmoc123#0  = #dsmom008#0;
     #dsmoc123#1  = #dsmom008#1;
     #dsmoc123#2  = #dsmom008#2;
     #dsmoc123#3  = #dsmom008#3;
     #dsmoc123#4  = #dsmom008#4;
     #dsmoc123#5  = #dsmom008#5;
     #dsmoc123#6  = "MANUAL";
     #dsmoc123#7  = 0;
     #dsmoc123#8  = "A";
     #dsmoc123#9  = 1;
     #dsmoc123#10 = 1;
     |LEE 101#dsmoc123.=;
     |SI FSalida ! 0;
         |DDEFECTO #dsmoc123;
         #dsmoc123#0  = #dsmom008#0;
         #dsmoc123#1  = #dsmom008#1;
         #dsmoc123#2  = #dsmom008#2;
         #dsmoc123#3  = #dsmom008#3;
         #dsmoc123#4  = #dsmom008#4;
         #dsmoc123#5  = #dsmom008#5;
         #dsmoc123#6  = "MANUAL";
         #dsmoc123#7  = 0;
         #dsmoc123#8  = "A":
         #dsmoc123#9  = 1;
         #dsmoc123#10 = 1;
         |GRABA 020#dsmoc123.b;
     |FINSI;

     #dsmoc123#11 = #refer00@#16;
     #dsmoc123#13 = #refer00@#17;
     #dsmoc123#12 = (#dsmoc123#13 / #dsmoc123#11) * 100;
     #dsmoc123#21 = "";
     #dsmoc123#20 = #refer00@#25;
     #dsmoc123#22 = #refer00@#15;

     |GRABA 020#dsmoc123.a;
     |LIBERA #dsmoc123;
     |CIERRA #dsmoc123;

     enEmpresa     = nCodigoNue;
     enEjer        = #dspase03#4;
     enPeriodo     = nPeriodo;
     enModelo      = nModelo;
     enComplem     = nComplem;
     enActividad   = #agicen14#1;
     enTipoEntrada = 98;

     |SUB_EJECUTA_NP ":modelos/dsmoc123";

     #dspase25#0 = enModelo;
     #dspase25#1 = enPeriodo;
     #dspase25#2 = enComplem;
     #dspase25#3 = enEmpresa;
     |LEE 101#dspase25.=;
     |SI FSalida ! 0;
         |DDEFECTO #dspase25;
         #dspase25#0 = enModelo;
         #dspase25#1 = enPeriodo;
         #dspase25#2 = enComplem;
         #dspase25#3 = enEmpresa;
         |GRABA 020#dspase25.b;
     |FINSI;
     #dspase25#4 = #refer00@#26;
     |GRABA 020#dspase25.a;
     |LIBERA #dspase25;

     efFechaI   = #refer00@#28;
     eaArchiva  = "";

     |SUB_EJECUTA "dspasuti;PonDatosPlaning";
|FPRC;

|DEFBUCLE eosma123;
     #refer00@#1003;
     ;
     00000, #dspase03#4,    1;
     99999, #dspase03#4, #dspase03#5;
     ;
     NULL, MiraModelo123;
|FIN;

|PROCESO Pase123Reo;
     aDef = eaPathAnterior + "agieos/def/eosma123.mas";
     |CARGA_DEF aDef, refer00@;
     |SI FSalida ! 0;
         |ACABA;
     |FINSI;

     aFich = eaPathAnterior + "agieos/fich/";
     |PATH_DAT #refer00@#aFich#;

     |ABRE #agitab12;
     |ABRE #dsmom002;
     |ABRE #agitab99;
     |BUCLE eosma123;
     |CIERRA #agitab12;
     |CIERRA #dsmom002;
     |CIERRA #agitab99;

     |DESCARGA_DEF #refer00@;
|FPRC;

|PROCESO Modelo123;
     enModelo   = 123;
     enDEmpresa = #dspase03#9;
     enHEmpresa = #dspase03#10;

     |SUB_EJECUTA "dspasuti;BorraModelos";

     |HAZ Pase123Reo;
|FPRC;

|PROCESO PaseIrpf;
     |SI #dspase03#0 = 110;  |HAZ Modelo110;  |FINSI;
     |SI #dspase03#0 = 115;  |HAZ Modelo115;  |FINSI;
     |SI #dspase03#0 = 123;  |HAZ Modelo123;  |FINSI;
|FPRC;
