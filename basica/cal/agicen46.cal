|FICHEROS;
     agicen46 #0;
     agimunic #100;
     &regisnif@ #709;
     :/integral/def/dsam0115 #115;
|FIN;

|VARIABLES;
     nCampo     = 0;
     nCampo1    = 0;
     nCampo2    = 0;
     nCampo3    = 0;
     &aAlfa     = "";
     aAlfa1     = "";
     aAlfa2     = "";


     &eaVarDni  = "";
     &enCalcCif = 0;

     &eaTabla    = "";
     &eaDestino  = "";
     &eaAlfa     = "";
     &enError    = 0;
     &enComp     = 0;
     &enPosicion = 0;
     &eaCodNif = "";
     &aApel1 = "";
     &aApel2 = "";
     &aNom = "";
     &eaPathIntegral = "";
     &eaSigla5       = "";
|FIN;

|PROCESO PonDatos46;
     eaCodNif  = #0#7;
     |HAZ LeeNifs;

     eaSigla5 = #709#9; |HAZ Lee5DigSg;
     #0#8 = #709#1;
     #0#11 = eaSigla5;    || tipo via
     #0#12 = #709#2;      || nombre via
     #0#14 = #709#3;      || numero
     #0#18 = #709#16;      || escalera
     #0#19 = #709#10;      || planta
     #0#20 = #709#11;      || puerta
     aAlfa1 = #709#4; |QBF aAlfa1; aAlfa1 = ("00" + aAlfa1) % -102;
     #0#25 = aAlfa1;    || codigo provincia
     aAlfa2 = #709#5; |QBF aAlfa2; aAlfa2 = ("000" + aAlfa2) % -103;
     aAlfa = aAlfa1 + aAlfa2;
     #0#23 = aAlfa;
     #0#24 = #709#6;     || nombre municipio
     #0#10 = #709#7;     || nombre provincia
     #0#26 = #709#8;     || fijo

     |PINTA #0#8;
     |PINTA #0#11;
     |PINTA #0#12;
     |PINTA #0#14;
     |PINTA #0#18;
     |PINTA #0#19;
     |PINTA #0#20;
     |PINTA #0#25;
     |PINTA #0#23;
     |PINTA #0#24;
     |PINTA #0#10;
     |PINTA #0#26;
     |PINTA #0#28;

     aAlfa2 = "N";
     aAlfa1 = #0#7 % 101;
     aAlfa1 = aAlfa1 > " ";
     |SI aAlfa1 ] "A"; |Y aAlfa1 [ "Z";
         aAlfa2 = "S";
         |SI aAlfa1 = "K"; |O aAlfa1 = "X";
            |O aAlfa1 = "Y"; |O aAlfa1 = "Z";
               aAlfa2 = "N";
         |FINSI;
     |FINSI;
     |C_M #0#38, 1, aAlfa2;
     |C_M #0#39, 1, aAlfa2;
     |C_M #0#40, 1, aAlfa2;
     |C_M #0#41, 1, aAlfa2;
     |C_M #0#42, 1, aAlfa2;
     |C_M #0#43, 1, aAlfa2;
     |SI aAlfa2 = "N";
         #0#38 = "";           |PINTA #0#38;
         #0#39 = "01.01.0000"; |PINTA #0#39;
         #0#40 = "";           |PINTA #0#40;
         #0#41 = "";           |PINTA #0#41;
         #0#42 = "";           |PINTA #0#42;
         #0#43 = "";           |PINTA #0#43;
     |FINSI;
|FPRC;

|PROCESO PonDatos46_C40;
     |C_M #0#40, 0, aAlfa1;
     |SI aAlfa1 = "N"; |ACABA; |FINSI;

     eaCodNif  = #0#40;
     |HAZ LeeNifs;

     aAlfa = #709#1;
     |HAZ SeparaNombre;
     #0#41 = aApel1;
     #0#42 = aApel2;
     #0#43 = aNom;
     |PINTA #0#41;
     |PINTA #0#42;
     |PINTA #0#43;
|FPRC;

|PROCESO SacaTipo46; |TIPO 7;
     eaTabla = "txtn0018.txt";
     |HAZ CargaTabla;
|FPRC;

|PROCESO CompTipo46; |TIPO 0;
     |SI FSalida = 10;
         enPosicion = 55;
         |HAZ SacaTabla;
         #0Campo = eaDestino % 103;
         |PINTA #0Campo;
     |FINSI;

     enComp = 3;
     eaAlfa = #0Campo;
     |HAZ CompruebaTabla;

     |SI enError = 1;
         |MENAV "0000 Contenido Incorrecto. Consulta la Tabla con F2";
         |ERROR;
         |ACABA;
     |FINSI;

     |HAZ FinTabla;
|FPRC;

|PROCESO LetraDni46;  |TIPO 6;
     |SI FSalida ! 10;  |ACABA;  |FINSI;

     eaVarDni  = #0Campo;
     enCalcCif = 1;
     |HAZ CalculoDNI;
     #0Campo = eaVarDni;
     |PINTA #0Campo;
|FPRC;

|PROCESO SacaCauR46;  |TIPO 7;
     eaTabla = "txtn0015.txt";
     |HAZ CargaTabla;
|FPRC;

|PROCESO CompCauR46;  |TIPO 0;
     |SI Campo = 31; nCampo = 35; |FINSI;
     |SI FSalida = 10;
         enPosicion = 41;
         |HAZ SacaTabla;

         aAlfa1   = eaDestino % 102;
         #0Campo  = aAlfa1;
         |PINTA #0Campo;
     |FINSI;

     enComp = 2;
     eaAlfa = #0Campo;
     |HAZ CompruebaTabla;

     |SI enError = 1;
         |MENAV "0000 Contenido Incorrecto. Consulta la Tabla con F2";
         |ERROR;
         |ACABA;
     |FINSI;

     aAlfa1   = eaDestino % 102;
     aAlfa2   = eaDestino % 450;
     #0Campo  = aAlfa1;
     #0nCampo = aAlfa2;

     |PINTA #0Campo;
     ||PINTA #0nCampo;

     |HAZ FinTabla;
|FPRC;

|PROCESO SacaTipR46;  |TIPO 7;
     eaTabla = "txtn0016.txt";
     |HAZ CargaTabla;
|FPRC;

|PROCESO CompTipR46;  |TIPO 0;
     |SI Campo = 33; nCampo = 36; |FINSI;
     |SI FSalida = 10;
         enPosicion = 41;
         |HAZ SacaTabla;

         aAlfa1   = eaDestino % 102;
         #0Campo  = aAlfa1;
         |PINTA #0Campo;
     |FINSI;

     enComp = 2;
     eaAlfa = #0Campo;
     |HAZ CompruebaTabla;

     |SI enError = 1;
         |MENAV "0000 Contenido Incorrecto. Consulta la Tabla con F2";
         |ERROR;
         |ACABA;
     |FINSI;

     aAlfa1   = eaDestino % 102;
     aAlfa2   = eaDestino % 450;
     #0Campo  = aAlfa1;
     #0nCampo = aAlfa2;

     |PINTA #0Campo;
     |PINTA #0nCampo;

     |HAZ FinTabla;
|FPRC;

|PROCESO SacaTitR46;  |TIPO 7;
     eaTabla = "txtn0017.txt";
     |HAZ CargaTabla;
|FPRC;

|PROCESO CompTitR46;  |TIPO 0;
     |SI Campo = 34; nCampo = 37; |FINSI;
     |SI FSalida = 10;
         enPosicion = 41;
         |HAZ SacaTabla;

         aAlfa1   = eaDestino % 102;
         #0Campo  = aAlfa1;
         |PINTA #0Campo;
     |FINSI;

     enComp = 2;
     eaAlfa = #0Campo;
     |HAZ CompruebaTabla;

     |SI enError = 1;
         |MENAV "0000 Contenido Incorrecto. Consulta la Tabla con F2";
         |ERROR;
         |ACABA;
     |FINSI;

     aAlfa1   = eaDestino % 102;
     aAlfa2   = eaDestino % 450;
     #0Campo  = aAlfa1;
     #0nCampo = aAlfa2;

     |PINTA #0Campo;
     |PINTA #0nCampo;

     |HAZ FinTabla;
|FPRC;

|PROCESO SacaSg46;  |TIPO 7;
     |SI eaPathIntegral = "";
         eaTabla = "txtn0001.txt";
         |HAZ CargaTabla;
     |FINSI;
|FPRC;

|PROCESO inf115_46;
  #115#2 = "     ";
|FPRC;

|PROCESO sup115_46;
  #115#2 = "zzzzz";
|FPRC;

|PROCESO CompSg46;  |TIPO 0;
     |SI eaPathIntegral = "";
          |SI FSalida = 10;
              enPosicion = 55;
              |HAZ SacaTabla;
              #0Campo = eaDestino % 105;
              |PINTA #0Campo;
          |FINSI;

          enComp = 5;
          eaAlfa = #0Campo;
          |HAZ CompruebaTabla;

          |SI enError = 1; |Y Campo = 11;
              |MENAV "0000 Contenido Incorrecto. Consulta la Tabla con F2";
              || |ERROR;
          |FINSI;

          |HAZ FinTabla;
    |SINO;
          |SI FSalida = 10;
              |ABRE #115;
              |CONSULTA_F_CLAVE #3#115, inf115_46, sup115_46;
              |CIERRA #115;
              #0Campo = #115#2; |PINTA #0Campo;
          |FINSI;

          |SI #0Campo = "     "; |Y Campo = 11;
              || |MENAV "0000 Contenido Incorrecto. Consulta el Fichero de Siglas con F2";
              || |ERROR;  tique 475_1346 que informen lo que quieran
              || |ACABA;
          |FINSI;

          |SI #0Campo ! "     ";
              |ABRE #115;
              |SELECT #3#115;
              #115#2 = #0Campo;
              |LEE 040#115=
              |SI FSalida ! 0;
                  |MENAV "0000 Contenido Incorrecto. Consulta el Fichero de Siglas con F2";
                  ||  |ERROR;  tique 475_1346 que informen lo que quieran
              |FINSI;
              |SELECT #1#115;
              |CIERRA #115;
          |FINSI;
    |FINSI;
|FPRC;

|PROCESO SacaMuni46;
     || nCampo = Cod. Postal
     || nCampo1 = Nombre Municipio
     || nCampo2 = Codigo Provincia
     || nCampo3 = Nombre Provincia

     nCampo1 = Campo + 1;
     nCampo2 = Campo + 2;
     |SI Campo = 23;
          nCampo3 = 10;
     |FINSI;
     |SI FSalida = 10;
          |SUB_EJECUTA "agimunic";
          |ABRE #100;
          |CONSULTA_CLAVE #1#100;
          |SI FSalida = 0;
               nCampo = Campo;
               #0nCampo = #100#0;     |PINTA #0nCampo;
               #0nCampo1 = #100#3;     |PINTA #0nCampo1;
               #0nCampo2 = (#100#0 % 102);     |PINTA #0nCampo2;
               #0nCampo3 = #100#2;     |PINTA #0nCampo3;
               |ACABA;
          |FINSI;
          |CIERRA #100;
     |FINSI;
     |ABRE #100;
     |SELECT #4#100;
     #100#0 = #0Campo;
     |LEE 000#100=;
     |SI FSalida = 0;
          |SI #0nCampo ! Contenido;
               nCampo = Campo;
               #0nCampo = #100#0;     |PINTA #0nCampo;
               #0nCampo1 = #100#3;     |PINTA #0nCampo1;
               #0nCampo2 = (#100#0 % 102);     |PINTA #0nCampo2;
               #0nCampo3 = #100#2;     |PINTA #0nCampo3;
          |FINSI;
     |SINO;
          |SI #0Campo ! "     ";
               |MENAV "    El Código Postal no existe. Pulse F2 para ver la lista."
               |ERROR;
          |FINSI;
               nCampo = Campo;
               #0nCampo = "";     |PINTA #0nCampo;
               #0nCampo1 = "";     |PINTA #0nCampo1;
               #0nCampo2 = "";     |PINTA #0nCampo2;
               #0nCampo3 = "";     |PINTA #0nCampo3;
     |FINSI;
     |CIERRA #100;
|FPRC;
