|FICHEROS;
     dspase00;
     dspase99;

     :/basica/def/zmonedas;

     :/agitool/def/dsconver;
     :/agitool/def/dsconve1;
     :/agitool/def/dsconve2;

     refecon@;
     referen@;
     refer00@;
     refer01@;
     refer02@;
|FIN;

|VARIABLES;
     aBase             = "";
     aDirecBuscar      = "";
     aDirecB           = "";
     aFichero          = "";
     aDef              = "";
     aOrigen           = "";
     aDestino          = "";
     aFicheroOrigen    = "";
     aAlfa             = "";
     aAlfa1            = "";
     aHoraEmpieza      = "";
     aHoraTermina      = "";
     aPathAnterior     = "";
     aPathOrigen       = "";
     aPathDestino      = "";
     aDirFichOrigen    = "";
     aDirFichDestino   = "";
     aDirFichD         = "";
     aDirEmpresa       = "";
     aAplica           = "";
     aEmpresa          = "";
     aEpigrafe         = "";
     aEpi1             = "";
     aEpi2             = "";
     aPassword         = "";
     aDirEjer          = "";
     aDirAgitool       = "";

     {100}aDirFichO    = "";

     nSwCopiar         = 0;
     nSwEsFichero      = 0;
     nSwAplicacion     = 0;
     nSwCoger          = 0;
     nCampos           = 0;
     nEmpresa          = 0;
     nEmpresaDef       = 0;
     nCodigo           = 0;
     nValorEmpre       = 0;
     nValorRegis       = 0;
     nLinea            = 0;
     nLineaA           = 0;
     nLineaC           = 0;
     nActiv            = 0;
     nSwEsta           = 0;
     nAgrupa           = 0;
     nFactor           = 0;
     nDEmpresa         = 0;
     nHEmpresa         = 0;
     nNume             = 0;
     nPaso             = 0;
     nCampoD           = 0;

  {105} npEmpresa      = 0;

     &enEmpresa        = 0;
     &enPeriodo        = 0;
     &eaMoneda         = "";

     &eaPathAntes      = "";
     &eaPathBasica     = "";
     &eaPathContagen   = "";
     &eaPathContanex   = "";
     &eaPathContasoc   = "";
     &eaPathRen2019    = "";
     &eaPathRen2018    = "";
     &eaPathRen2017    = "";
     &eaPathRen2016    = "";
     &eaPathRen2015    = "";
     &eaPathRen2014    = "";
     &eaPathRen2013    = "";
     &eaPathRen2012    = "";
     &eaPathRen2011    = "";
     &eaPathRen2010    = "";
     &eaPathRen2009    = "";
     &eaPathRen2008    = "";
     &eaPathRen2007    = "";
     &eaPathRen2006    = "";
     &eaPathRen2005    = "";
     &eaPathRen2004    = "";
     &eaPathRen2003    = "";
     &eaPathRen2002    = "";
     &eaPathRen2001    = "";
     &eaPathRen2000    = "";
     &eaPathRen1999    = "";
     &eaPathRen1998    = "";
     &eaPathRen1997    = "";
     &eaPathRen1996    = "";
     &eaPathRen1995    = "";
     &eaPathRen1994    = "";
     &eaPathFacturar   = "";
     &eaPathLaboral    = "";
     &eaPathIntegral   = "";
     &eaPathDsmodelo   = "";
     &eaPathAgitool    = "";

     aAbre             = "";
     nHandle           = 0;

     &eaBase           = "";
     &enCampo          = 0;
     &enForzar         = 0;
     &eaAplica         = "";
     &eaEmpresa        = "";

     aQueQuiero = "";
     aNumCampos = "";
     nNumCampos = 0;
     nSwVale = 0;
     nCampo  = 0;
|FIN;

|| ----------------------------- PROCESOS DEL BORRADO ----------------------

|PROCESO Borrandolo;
     |_PDIR aDirecBuscar;
     |PARA; |SI FSalida = 0; |HACIENDO;
            aAlfa = aDirecBuscar - "dsficher";
            |SI FSalida = 0;
                |FBORRA aDirecBuscar;
            |FINSI;

            |_SDIR aDirecBuscar;
     |SIGUE;
|FPRC;

|PROCESO BorraFicheros;
     aDirecBuscar = aBase + aAplica + "/fich/*.dat";       |HAZ Borrandolo;
     aDirecBuscar = aBase + aAplica + "/fich/*.ddx";       |HAZ Borrandolo;
     aDirecBuscar = aBase + aAplica + "/fich/*.ixx";       |HAZ Borrandolo;
     aDirecBuscar = aBase + aAplica + "/fich/*.inf";       |HAZ Borrandolo;
     aDirecBuscar = aBase + aAplica + "/fich/*.lis";       |HAZ Borrandolo;
     aDirecBuscar = aBase + aAplica + "/fich/*.prc";       |HAZ Borrandolo;
     aDirecBuscar = aBase + aAplica + "/fich/*.dfe";       |HAZ Borrandolo;
     aDirecBuscar = aBase + aAplica + "/fich/lista*.dir";  |HAZ Borrandolo;
|FPRC;

|PROCESO BorraEmpresaFac;
     aDirEmpresa = aBase + aAplica + "/fich/" + (("00" + #refecon@#0) % -102);
     aAlfa = aBase + "bin/agirm -r " + aDirEmpresa;
     |SYSTEM aAlfa;
|FPRC;

|DEFBUCLE facempB;
     #refecon@#1001;
     ;
     00;
     99;
     ;
     NULL, BorraEmpresaFac;
|FIN;

|PROCESO BorraFacturar;
     aDirFichDestino = aBase + aAplica + "/fich/";
     aDef            = aBase + aAplica + "/def/facemp.mas";
     |CARGA_DEF aDef, refecon@;
     |SI FSalida = 0;
         |PATH_DAT #refecon@#aDirFichDestino#;

         |BUCLE facempB;

         |DESCARGA_DEF #refecon@;
     |FINSI;

     |HAZ BorraFicheros;
|FPRC;

|PROCESO BorraDirCanempre;
     aDirEmpresa = aBase + aAplica + "/fich/" + (("00000" + #refecon@#2) % -105) + #refecon@#3;
     aAlfa = aBase + "bin/agirm -r " + aDirEmpresa;
     |SYSTEM aAlfa;
|FPRC;

|DEFBUCLE canempre;
     #refecon@#1002;
     ;
     00000, 0;
     99999, 9;
     ;
     NULL, BorraDirCanempre;
|FIN;

|PROCESO BorraContagen;
     aDirFichDestino = aBase + aAplica + "/fich/";
     aDef            = aBase + aAplica + "/def/canempre.mas";
     |CARGA_DEF aDef, refecon@;
     |SI FSalida = 0;
         |PATH_DAT #refecon@#aDirFichDestino#;

         |BUCLE canempre;

         |DESCARGA_DEF #refecon@;
     |FINSI;

     aDirecBuscar = aBase + aAplica + "/fich/canempre.dat";       |HAZ Borrandolo;
     aDirecBuscar = aBase + aAplica + "/fich/canempre.ddx";       |HAZ Borrandolo;
     aDirecBuscar = aBase + aAplica + "/fich/canempre.ixx";       |HAZ Borrandolo;
|FPRC;

|PROCESO DocuContasoc;
     aDirEmpresa = aBase + "contasoc/" + aAplica + "/*";
     |_PDIR aDirEmpresa;
     |PARA;  |SI FSalida = 0;  |HACIENDO;
         aAlfa   = aBase + "bin/agirm -r " + aDirEmpresa;
         |SYSTEM aAlfa;

         |_SDIR aDirEmpresa;
     |SIGUE;
|FPRC;

|PROCESO Borrado;
     |MENSA "0000 Borrando Ficheros de la DSPI";

     |DBASS aBase;  |QBF aBase;

     aAplica = "basica";    |HAZ BorraFicheros;
     aAplica = "contanex";  |HAZ BorraFicheros;
     aAplica = "contasoc";  |HAZ BorraFicheros;
     aAplica = "integral";  |HAZ BorraFicheros;
     aAplica = "laboral";   |HAZ BorraFicheros;
     aAplica = "modelos";   |HAZ BorraFicheros;
     aAplica = "ren1994";   |HAZ BorraFicheros;
     aAplica = "ren1995";   |HAZ BorraFicheros;
     aAplica = "ren1996";   |HAZ BorraFicheros;
     aAplica = "ren1997";   |HAZ BorraFicheros;
     aAplica = "ren1998";   |HAZ BorraFicheros;
     aAplica = "ren1999";   |HAZ BorraFicheros;
     aAplica = "ren2000";   |HAZ BorraFicheros;
     aAplica = "ren2001";   |HAZ BorraFicheros;
     aAplica = "ren2002";   |HAZ BorraFicheros;
     aAplica = "ren2003";   |HAZ BorraFicheros;
     aAplica = "ren2004";   |HAZ BorraFicheros;
     aAplica = "ren2005";   |HAZ BorraFicheros;
     aAplica = "ren2006";   |HAZ BorraFicheros;
     aAplica = "ren2007";   |HAZ BorraFicheros;
     aAplica = "ren2008";   |HAZ BorraFicheros;
     aAplica = "ren2009";   |HAZ BorraFicheros;
     aAplica = "ren2010";   |HAZ BorraFicheros;
     aAplica = "ren2011";   |HAZ BorraFicheros;
     aAplica = "ren2012";   |HAZ BorraFicheros;
     aAplica = "ren2013";   |HAZ BorraFicheros;
     aAplica = "ren2014";   |HAZ BorraFicheros;
     aAplica = "ren2015";   |HAZ BorraFicheros;
     aAplica = "ren2016";   |HAZ BorraFicheros;
     aAplica = "ren2017";   |HAZ BorraFicheros;
     aAplica = "ren2018";   |HAZ BorraFicheros;
     aAplica = "ren2019";   |HAZ BorraFicheros;
     aAplica = "facturar";  |HAZ BorraFacturar;
     aAplica = "contagen";  |HAZ BorraContagen;

     aAplica = "depositos"; |HAZ DocuContasoc;
     aAplica = "emisiones"; |HAZ DocuContasoc;
|FPRC;

|| ----------------------------- PROCESOS DEL PASE ------------------------

|PROCESO Borra101;
     |BORRA 020#dsconve1.a;
     |LIBERA #dsconve1;
|FPRC;

|DEFBUCLE dsconve1;
     #dsconve1#1;
     ;
     #dsconver#0, #dsconver#1, #dsconver#2, "        ";
     #dsconver#0, #dsconver#1, #dsconver#2, "zzzzzzzz";
     be;
     NULL, Borra101;
|FIN;

|PROCESO Borra102;
     |BORRA 020#dsconve2.a;
     |LIBERA #dsconve2;
|FPRC;

|DEFBUCLE dsconve2;
     #dsconve2#1;
     ;
     #dsconver#0, #dsconver#1, #dsconver#2, "        ", 000;
     #dsconver#0, #dsconver#1, #dsconver#2, "zzzzzzzz", 999;
     be;
     NULL, Borra102;
|FIN;

|PROCESO GrabaMoneda;
     aDef = eaPathAgitool + "def/zmonedas.mas";
     |CARGA_DEF aDef, refer00@;
     |SI FSalida ! 0;
         eaMoneda = "E";
     |SINO;
         |PATH_DAT #refer00@#aPathAnterior#;
         |ABRE #refer00@;
         |LEE 040#refer00@.p;
         |SI FSalida ! 0; |DDEFECTO #refer00@; |FINSI;
         |CIERRA #refer00@;

         eaMoneda = #refer00@#1;

         |SI enCampo ! 0;
             |ABRE #zmonedas;
             |LEE 101#zmonedas.p;
             |SI FSalida ! 0;
                 |DDEFECTO #zmonedas;
                 |GRABA 020#zmonedas.b;
             |FINSI;
             nCampoD    = enCampo + 1;
             #zmonedas#enCampo# = #refer00@#1;
             #zmonedas#nCampoD# = #refer00@#2;
             |GRABA 020#zmonedas.a;
             |LIBERA #zmonedas;
             |CIERRA #zmonedas;
         |FINSI;

         |DESCARGA_DEF #refer00@;
     |FINSI;

     |DBASS eaBase;  |QBF eaBase;
     enForzar = 1;

     aDirAgitool = eaBase + "agitool/fich/";

     |PATH_DAT #dsconver#aDirAgitool#;
     |PATH_DAT #dsconve1#aDirAgitool#;
     |PATH_DAT #dsconve2#aDirAgitool#;

     |ABRE #dsconver;
     #dsconver#0 = eaBase;
     #dsconver#1 = eaAplica;
     #dsconver#2 = eaEmpresa;
     |LEE 101#dsconver.=;
     |SI FSalida = 0;
         |BUCLE dsconve1;
         |BUCLE dsconve2;

         |BORRA 020#dsconver.a;
         |LIBERA #dsconver;
     |FINSI;
     |CIERRA #dsconver;

     |SUB_EJECUTA_NP ":agitool/dsconver";

     |SI enCampo ! 0;
         aAbre = eaBase + eaAplica + "/" + eaAplica + ".sui"
         |XABRE "W", aAbre, nHandle;
         |SI #zmonedas#enCampo# = "E";
             aAlfa = "DsEuroConvierte=166.386" + &13 + &10;  |XGRABA nHandle, aAlfa;
             aAlfa = "DsDeciModoOtro=0"   + &13 + &10;       |XGRABA nHandle, aAlfa;
             aAlfa = "DsDeciModoNormal=2" + &13 + &10;       |XGRABA nHandle, aAlfa;
         |SINO;
             aAlfa = "DsEuroConvierte=0.00601012" + &13 + &10;  |XGRABA nHandle, aAlfa;
             aAlfa = "DsDeciModoOtro=2"   + &13 + &10;       |XGRABA nHandle, aAlfa;
             aAlfa = "DsDeciModoNormal=0" + &13 + &10;       |XGRABA nHandle, aAlfa;
         |FINSI;
         |XCIERRA nHandle;
     |FINSI;
|FPRC;

|| ________________________________________________________________________
|| Comprobacion del .mas del fichero a traspasar para su posible copia o no.
|| ________________________________________________________________________

|PROCESO Rastreo;
     nSwCopiar = 0;
     |SI aFicheroOrigen = "zmonedas.dat";
         aDef      = eaPathAgitool + "def/zmonedas.mas";
         |CARGA_DEF aDef, referen@;
         |SI FSalida ! 0;  nSwCopiar = 1;  |ACABA;  |FINSI;
     |SINO;
         aFichero  = #dspase00#11;  |QBF aFichero;
         aFichero  = aFichero - ".dat" + ".mas";

         |SI aFichero = "asm00003.mas";  aFichero = "asm00013.mas";  |FINSI;
         |SI aFichero = "agim0048.mas";  aFichero = "agim0052.mas";  |FINSI;
         |SI aFichero = "agim0049.mas";  aFichero = "agim0053.mas";  |FINSI;
         |SI aFichero = "agim0050.mas";  aFichero = "agim0054.mas";  |FINSI;

         aDef      = aPathDestino + "def/" + aFichero;
         |CARGA_DEF aDef, referen@;
         |SI FSalida ! 0;  nSwCopiar = 1;  |ACABA;  |FINSI;
     |FINSI;

     |PATH_DAT #referen@#aDirFichDestino#;

     |ABRE #referen@;
     |LEE 040#referen@.p;
     |SI FSalida = 0;  nSwCopiar = 1;  |FINSI;
     |CIERRA #referen@;

     |SI nSwCopiar = 0;  |DELINDEX #referen@;   |FINSI;

     |DESCARGA_DEF #referen@;
|FPRC;

|| ________________________________________________________________________
|| Copiado de los ficheros
|| ________________________________________________________________________

|PROCESO Copiar;
     nSwCopiar = 0;
     |SI nSwEsFichero = 1;  |HAZ Rastreo;  |FINSI;
     |SI nSwCopiar    = 1;  |ACABA;        |FINSI;

     |SI nSwEsFichero = 1;
         |SI #dspase00#11 = "asm00003.dat   "; |O  #dspase00#11 = "agim0048.dat   ";
          |O #dspase00#11 = "agim0049.dat   "; |O  #dspase00#11 = "agim0050.dat   ";
             |SI #dspase00#11 = "asm00003.dat   ";
                 aFichero = #dspase00#11;                            |QBF aFichero;
                 aOrigen  = aDirFichOrigen  + aFichero;       |QBF aOrigen;
                 aDestino = aDirFichDestino + "asm00013.dat"; |QBF aDestino;
                 |COPIA_FICHERO aOrigen, aDestino;

                 aFichero = #dspase00#11;                             |QBF aFichero;
                 aFichero = aFichero - ".dat" + ".ddx";
                 aOrigen  = aDirFichOrigen  + aFichero;       |QBF aOrigen;
                 aDestino = aDirFichDestino + "asm00013.ddx"; |QBF aDestino;
                 |COPIA_FICHERO aOrigen, aDestino;

                 aFichero = #dspase00#11;                             |QBF aFichero;
                 aFichero = aFichero - ".dat" + ".ixx";
                 aOrigen  = aDirFichOrigen  + aFichero;       |QBF aOrigen;
                 aDestino = aDirFichDestino + "asm00013.ixx"; |QBF aDestino;
                 |COPIA_FICHERO aOrigen, aDestino;
             |FINSI;

             |SI #dspase00#11 = "agim0048.dat   ";
                 aFichero = #dspase00#11;                            |QBF aFichero;
                 aOrigen  = aDirFichOrigen  + aFichero;       |QBF aOrigen;
                 aDestino = aDirFichDestino + "agim0052.dat"; |QBF aDestino;
                 |COPIA_FICHERO aOrigen, aDestino;

                 aFichero = #dspase00#11;                             |QBF aFichero;
                 aFichero = aFichero - ".dat" + ".ddx";
                 aOrigen  = aDirFichOrigen  + aFichero;       |QBF aOrigen;
                 aDestino = aDirFichDestino + "agim0052.ddx"; |QBF aDestino;
                 |COPIA_FICHERO aOrigen, aDestino;

                 aFichero = #dspase00#11;                             |QBF aFichero;
                 aFichero = aFichero - ".dat" + ".ixx";
                 aOrigen  = aDirFichOrigen  + aFichero;       |QBF aOrigen;
                 aDestino = aDirFichDestino + "agim0052.ixx"; |QBF aDestino;
                 |COPIA_FICHERO aOrigen, aDestino;
             |FINSI;

             |SI #dspase00#11 = "agim0049.dat   ";
                 aFichero = #dspase00#11;                            |QBF aFichero;
                 aOrigen  = aDirFichOrigen  + aFichero;       |QBF aOrigen;
                 aDestino = aDirFichDestino + "agim0053.dat"; |QBF aDestino;
                 |COPIA_FICHERO aOrigen, aDestino;

                 aFichero = #dspase00#11;                             |QBF aFichero;
                 aFichero = aFichero - ".dat" + ".ddx";
                 aOrigen  = aDirFichOrigen  + aFichero;       |QBF aOrigen;
                 aDestino = aDirFichDestino + "agim0053.ddx"; |QBF aDestino;
                 |COPIA_FICHERO aOrigen, aDestino;

                 aFichero = #dspase00#11;                             |QBF aFichero;
                 aFichero = aFichero - ".dat" + ".ixx";
                 aOrigen  = aDirFichOrigen  + aFichero;       |QBF aOrigen;
                 aDestino = aDirFichDestino + "agim0053.ixx"; |QBF aDestino;
                 |COPIA_FICHERO aOrigen, aDestino;
             |FINSI;

             |SI #dspase00#11 = "agim0050.dat   ";
                 aFichero = #dspase00#11;                            |QBF aFichero;
                 aOrigen  = aDirFichOrigen  + aFichero;       |QBF aOrigen;
                 aDestino = aDirFichDestino + "agim0054.dat"; |QBF aDestino;
                 |COPIA_FICHERO aOrigen, aDestino;

                 aFichero = #dspase00#11;                             |QBF aFichero;
                 aFichero = aFichero - ".dat" + ".ddx";
                 aOrigen  = aDirFichOrigen  + aFichero;       |QBF aOrigen;
                 aDestino = aDirFichDestino + "agim0054.ddx"; |QBF aDestino;
                 |COPIA_FICHERO aOrigen, aDestino;

                 aFichero = #dspase00#11;                             |QBF aFichero;
                 aFichero = aFichero - ".dat" + ".ixx";
                 aOrigen  = aDirFichOrigen  + aFichero;       |QBF aOrigen;
                 aDestino = aDirFichDestino + "agim0054.ixx"; |QBF aDestino;
                 |COPIA_FICHERO aOrigen, aDestino;
             |FINSI;
         |SINO;
             aFichero = #dspase00#11;                       |QBF aFichero;
             aOrigen  = aDirFichOrigen  + aFichero;  |QBF aOrigen;
             aDestino = aDirFichDestino + aFichero;  |QBF aDestino;
             |COPIA_FICHERO aOrigen, aDestino;

             aFichero = #dspase00#11;                       |QBF aFichero;
             aFichero = aFichero - ".dat" + ".ddx";
             aOrigen  = aDirFichOrigen  + aFichero;  |QBF aOrigen;
             aDestino = aDirFichDestino + aFichero;  |QBF aDestino;
             |COPIA_FICHERO aOrigen, aDestino;

             aFichero = #dspase00#11;                       |QBF aFichero;
             aFichero = aFichero - ".dat" + ".ixx";
             aOrigen  = aDirFichOrigen  + aFichero;  |QBF aOrigen;
             aDestino = aDirFichDestino + aFichero;  |QBF aDestino;
             |COPIA_FICHERO aOrigen, aDestino;
         |FINSI;
     |SINO;
         aOrigen  = aDirFichOrigen  + #dspase00#11;  |QBF aOrigen;
         aDestino = aDirFichDestino + #dspase00#11;  |QBF aDestino;
         |COPIA_FICHERO aOrigen, aDestino;
     |FINSI;

     |SI nSwAplicacion = 1;  #dspase00#1  = #dspase00#1  + 1;  |PINTA #dspase00#1;  |FINSI;
     |SI nSwAplicacion = 2;  #dspase00#2  = #dspase00#2  + 1;  |PINTA #dspase00#2;  |FINSI;
     |SI nSwAplicacion = 3;  #dspase00#3  = #dspase00#3  + 1;  |PINTA #dspase00#3;  |FINSI;
     |SI nSwAplicacion = 4;  #dspase00#4  = #dspase00#4  + 1;  |PINTA #dspase00#4;  |FINSI;
     |SI nSwAplicacion = 5;  #dspase00#5  = #dspase00#5  + 1;  |PINTA #dspase00#5;  |FINSI;
     |SI nSwAplicacion = 8;  #dspase00#10 = #dspase00#10 + 1;  |PINTA #dspase00#10; |FINSI;
|FPRC;

|| ________________________________________________________________________
|| especial canempre para analitica
|| ________________________________________________________________________

|PROCESO EspAgicli;
    |DDEFECTO #refer02@;
    |PARA nCampo = 0;  |SI nCampo [ 92;  |HACIENDO nCampo = nCampo + 1;
          #refer02@#nCampo# = #referen@#nCampo#;
    |SIGUE;
    #refer02@#98  = #referen@#93;
    #refer02@#99  = #referen@#94;
    #refer02@#105 = #referen@#100;
    |GRABA 020#refer02@.n;
    |LIBERA #referen@;
|FPRC;

|DEFBUCLE EspAgicli;
     #referen@#1001;
     ;
     00000
     99999;
     be;
     NULL, EspAgicli;
|FIN;

|PROCESO CliAgicli;
          aFichero  = #dspase00#11;  |QBF aFichero;
          aFichero  = aFichero - ".dat" + ".mas";
          aDef      = aPathDestino + "def/" + aFichero;
          |CARGA_DEF aDef, refer02@;
          |SI FSalida = 0;
              |PATH_DAT #refer02@#aDirFichDestino#;
              |PATH_DAT #referen@#aDirFichOrigen#;

              |ABRE #refer02@;
              |LEE 040#refer02@.p;         || ...Si no existen datos
              |SI FSalida ! 0;
                  |BUCLE EspAgicli;
              |FINSI;
              |CIERRA #refer02@;
              |DESCARGA_DEF #refer02@;
          |FINSI;
|FPRC;

|PROCESO EspAsclient;
  |DDEFECTO #refer02@;
  |PARA nCampo = 0;  |SI nCampo [ 54;  |HACIENDO nCampo = nCampo + 1;
        #refer02@#nCampo# = #referen@#nCampo#;
  |SIGUE;
  #refer02@#57 = #referen@#55;
  #refer02@#75 = #referen@#56;
  #refer02@#74 = #referen@#57;
  #refer02@#76 = #referen@#58;
  #refer02@#77 = #referen@#59;
  #refer02@#83 = #referen@#65;
  #refer02@#84 = #referen@#66;
  #refer02@#85 = #referen@#67;
  #refer02@#86 = #referen@#68;
  |GRABA 020#refer02@.n;
  |LIBERA #referen@;
|FPRC;

|DEFBUCLE EspAsclient;
     #referen@#1001;
     ;
     00000
     99999;
     be;
     NULL, EspAsclient;
|FIN;

|PROCESO CliFactur;
          aFichero  = #dspase00#11;  |QBF aFichero;
          aFichero  = aFichero - ".dat" + ".mas";
          aDef      = aPathDestino + "def/" + aFichero;
          |CARGA_DEF aDef, refer02@;
          |SI FSalida = 0;
              |PATH_DAT #refer02@#aDirFichDestino#;
              |PATH_DAT #referen@#aDirFichOrigen#;

              |ABRE #refer02@;
              |LEE 040#refer02@.p;         || ...Si no existen datos
              |SI FSalida ! 0;
                  |BUCLE EspAsclient;
              |FINSI;
              |CIERRA #refer02@;
              |DESCARGA_DEF #refer02@;
          |FINSI;
|FPRC;

|PROCESO EspCanempre;
  |DDEFECTO #refecon@;
  |PARA nCampo = 0;  |SI nCampo [ 26;  |HACIENDO nCampo = nCampo + 1;
        #refecon@#nCampo# = #referen@#nCampo#;
  |SIGUE;
  |GRABA 020#refecon@.n;
  |LIBERA #referen@;
|FPRC;

|DEFBUCLE EspCanempre;
     #referen@#1002;
     ;
     00000, 0;
     99999, 9;
     be;
     NULL, EspCanempre;
|FIN;

|PROCESO EmpContab;
          aFichero  = #dspase00#11;  |QBF aFichero;
          aFichero  = aFichero - ".dat" + ".mas";
          aDef      = aPathDestino + "def/" + aFichero;
          |CARGA_DEF aDef, refecon@;
          |SI FSalida = 0;
              |PATH_DAT #refecon@#aDirFichDestino#;
              |PATH_DAT #referen@#aDirFichOrigen#;

              |ABRE #refecon@;
              |LEE 040#refecon@.p;         || ...Si no existen datos
              |SI FSalida ! 0;
                  |BUCLE EspCanempre;
              |FINSI;
              |CIERRA #refecon@;
              |DESCARGA_DEF #refecon@;
          |FINSI;
|FPRC;

|PROCESO TrataEspecial;
     nSwCopiar = 0;
     aFichero  = #dspase00#11;  |QBF aFichero;
     aFichero  = aFichero - ".dat" + ".mas";
     aDef      = aPathOrigen + "def/" + aFichero;
     |CARGA_DEF aDef, referen@;
     |SI FSalida ! 0;  nSwCopiar = 1;  |ACABA;  |FINSI;

     aQueQuiero = "|NC";
     aNumCampos = #referen@#aQueQuiero#;
     nNumCampos = aNumCampos;
     nNumCampos = nNumCampos - 1;

     nSwVale = 0;
     |SI aFicheroOrigen = "canempre.dat"; |Y nNumCampos = 26; nSwVale = 1; |FINSI;
     |SI aFicheroOrigen = "asclient.dat"; |Y nNumCampos = 54; nSwVale = 1; |FINSI;
     |SI aFicheroOrigen = "agifigen.dat"; |Y nNumCampos [ 92; nSwVale = 1; |FINSI;

     |SI nSwVale = 0;    || Hay cambio de estructura
         |SI aFicheroOrigen = "canempre.dat"; |HAZ EmpContab; |FINSI;
         |SI aFicheroOrigen = "asclient.dat"; |HAZ CliFactur; |FINSI;
         |SI aFicheroOrigen = "agifigen.dat"; |HAZ CliAgicli; |FINSI;
     |SINO;
          |DESCARGA_DEF #referen@;
          |HAZ Copiar;
          |HAZ Rastreo;
     |FINSI;
|FPRC;

|| ________________________________________________________________________
|| DIR del directorio origen para su traspaso al directorio destino
|| ________________________________________________________________________

|PROCESO HazElDir;
     aDirFichOrigen  = aPathAnterior;
     aDirFichDestino = aPathDestino + "fich/" + aDirEmpresa;

     nSwEsFichero   = 1;
     aDirecBuscar  = aPathAnterior + "*.dat";
     |_PDIR aDirecBuscar;
     |PARA; |SI FSalida = 0; |HACIENDO;
            nPaso  = 1;
            aFicheroOrigen = aDirecBuscar - aPathAnterior;
            #dspase00#11 = aFicheroOrigen;  |PINTA #dspase00#11;
            |SI aFicheroOrigen = "zmonedas.dat";
                |SI nSwAplicacion = 8;
                    |HAZ Copiar;
                    |HAZ Rastreo;
                |FINSI;
            |FINSI;

            |SI aFicheroOrigen ! "zmonedas.dat";
             |Y aFicheroOrigen ! "asexpimp.dat";

                |SI aFicheroOrigen = "canempre.dat";
                 |O aFicheroOrigen = "asclient.dat";
                   |O aFicheroOrigen = "agifigen.dat";
                    |HAZ TrataEspecial;
                |SINO;
                    |SI aFicheroOrigen ! "labcentr.dat";
                     |Y aFicheroOrigen ! "labcontr.dat";
                     |Y aFicheroOrigen ! "gomcotiz.dat";
                     |Y aFicheroOrigen ! "nomyrenm.dat";
                     |Y aFicheroOrigen ! "nomyrenn.dat";
                     |Y aFicheroOrigen ! "agim0035.dat";
                     |Y aFicheroOrigen ! "lablitip.dat";
                        |HAZ Copiar;
                        |HAZ Rastreo;
                    |FINSI;
                |FINSI;

            |FINSI;

            |_SDIR aDirecBuscar;
     |SIGUE;

     nSwEsFichero   = 0;
     aDirecBuscar = aPathAnterior + "lis*.*";
     |_PDIR aDirecBuscar;
     |PARA; |SI FSalida = 0; |HACIENDO;
            nPaso  = 1;
            aFicheroOrigen = aDirecBuscar - aPathAnterior;
            #dspase00#11 = aFicheroOrigen;  |PINTA #dspase00#11;

            |HAZ Copiar;

            |_SDIR aDirecBuscar;
     |SIGUE;
|FPRC;

|| ________________________________________________________________________
|| Aplicacion Basica
|| ________________________________________________________________________

|PROCESO GrabaAcciones1;
     |SELECT #2#refer00@;
     #refer00@#1 = #refer01@#5;
     |LEE 040#refer00@.=;
     |SI FSalida ! 0;
         |SELECT #1#refer00@;
         |LEE 040#refer00@.u;
         |SI FSalida ! 0;
             nCodigo = 1;
         |SINO;
             nCodigo = #refer00@#0 + 1;
         |FINSI;

         #refer00@#0 = nCodigo;
         #refer00@#1 = #refer01@#5;
         |GRABA 020#refer00@.n;
         |LIBERA #refer00@;
     |FINSI;

     #refer01@#8 = #refer00@#0;
     |GRABA 020#refer01@.a;
     |LIBERA #refer01@;
|FPRC;

|DEFBUCLE agim0037;
     #refer01@#1005;
     ;
     "        ", 00000, 00, 000, 00;
     "zzzzzzzz", 99999, 99, 999, 99;
     be;
     NULL, GrabaAcciones1;
|FIN;

|PROCESO GrabaAcciones2;
     |SELECT #2#refer00@;
     #refer00@#1 = #refer02@#6;
     |LEE 040#refer00@.=;
     |SI FSalida ! 0;
         |SELECT #1#refer00@;
         |LEE 040#refer00@.u;
         |SI FSalida ! 0;
             nCodigo = 1;
         |SINO;
             nCodigo = #refer00@#0 + 1;
         |FINSI;

         #refer00@#0 = nCodigo;
         #refer00@#1 = #refer02@#6;
         |GRABA 020#refer00@.n;
         |LIBERA #refer00@;
     |FINSI;

     #refer02@#5 = #refer00@#0;
     |GRABA 020#refer02@.a;
     |LIBERA #refer02@;

     |SELECT #2#refer00@;
     #refer00@#1 = #refer02@#11;
     |LEE 040#refer00@.=;
     |SI FSalida ! 0;
         |SELECT #1#refer00@;
         |LEE 040#refer00@.u;
         |SI FSalida ! 0;
             nCodigo = 1;
         |SINO;
             nCodigo = #refer00@#0 + 1;
         |FINSI;

         #refer00@#0 = nCodigo;
         #refer00@#1 = #refer02@#11;
         |GRABA 020#refer00@.n;
         |LIBERA #refer00@;
     |FINSI;

     #refer02@#10 = #refer00@#0;
     |GRABA 020#refer02@.a;
     |LIBERA #refer02@;

     |SELECT #2#refer00@;
     #refer00@#1 = #refer02@#16;
     |LEE 040#refer00@.=;
     |SI FSalida ! 0;
         |SELECT #1#refer00@;
         |LEE 040#refer00@.u;
         |SI FSalida ! 0;
             nCodigo = 1;
         |SINO;
             nCodigo = #refer00@#0 + 1;
         |FINSI;

         #refer00@#0 = nCodigo;
         #refer00@#1 = #refer02@#16;
         |GRABA 020#refer00@.n;
         |LIBERA #refer00@;
     |FINSI;

     #refer02@#15 = #refer00@#0;
     |GRABA 020#refer02@.a;
     |LIBERA #refer02@;
|FPRC;

|DEFBUCLE agim0034;
     #refer02@#1003;
     ;
     00000, 0000, 000;
     99999, 9999, 999;
     be;
     NULL, GrabaAcciones2;
|FIN;

|PROCESO GrabaDescriAccion;
     aDef = eaPathBasica + "def/agim0048.mas";
     |CARGA_DEF aDef, refer00@;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     aDef = eaPathBasica + "def/agim0037.mas";
     |CARGA_DEF aDef, refer01@;
     |SI FSalida ! 0;
         |DESCARGA_DEF #refer00@;
         |ACABA;
     |FINSI;

     aDef = eaPathBasica + "def/agim0034.mas";
     |CARGA_DEF aDef, refer02@;
     |SI FSalida ! 0;
         |DESCARGA_DEF #refer01@;
         |DESCARGA_DEF #refer00@;
         |ACABA;
     |FINSI;

     |ABRE #refer00@;
     |BUCLE agim0034;
     |BUCLE agim0037;
     |CIERRA #refer00@;

     |DESCARGA_DEF #refer02@;
     |DESCARGA_DEF #refer01@;
     |DESCARGA_DEF #refer00@;
|FPRC;

|PROCESO GrabaObjeto;
     #refer00@#0 = #refer01@#0;
     #refer00@#1 = #refer01@#1;
     #refer00@#2 = 1;
     #refer00@#3 = #refer01@#13;
     |GRABA 040#refer00@.n;
     |LIBERA #refer00@;

     #refer00@#0 = #refer01@#0;
     #refer00@#1 = #refer01@#1;
     #refer00@#2 = 2;
     #refer00@#3 = #refer01@#42;
     |GRABA 040#refer00@.n;
     |LIBERA #refer00@;

     #refer00@#0 = #refer01@#0;
     #refer00@#1 = #refer01@#1;
     #refer00@#2 = 3;
     #refer00@#3 = #refer01@#43;
     |GRABA 040#refer00@.n;
     |LIBERA #refer00@;

     #refer00@#0 = #refer01@#0;
     #refer00@#1 = #refer01@#1;
     #refer00@#2 = 4;
     #refer00@#3 = #refer01@#44;
     |GRABA 040#refer00@.n;
     |LIBERA #refer00@;

     #refer00@#0 = #refer01@#0;
     #refer00@#1 = #refer01@#1;
     #refer00@#2 = 5;
     #refer00@#3 = #refer01@#45;
     |GRABA 040#refer00@.n;
     |LIBERA #refer00@;

     |SI #refer01@#6 = "ACTIVA    ";
         #refer01@#54 = "A";
         #refer01@#55 = "01.01.0000";
     |FINSI;
     |SI #refer01@#6 = "INACTIVA  ";
         #refer01@#54 = "I";
     |FINSI;
     |GRABA 040#refer01@.a;
     |LIBERA #refer01@;
|FPRC;

|DEFBUCLE agim0019;
     #refer01@#1002;
     ;
     00000, 00;
     99999, 99;
     be;
     NULL, GrabaObjeto;
|FIN;

|PROCESO GrabaObjetoSocial;
     aDef = eaPathBasica + "def/agim0049.mas";
     |CARGA_DEF aDef, refer00@;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     aDef = eaPathBasica + "def/agim0019.mas";
     |CARGA_DEF aDef, refer01@;
     |SI FSalida ! 0;
         |DESCARGA_DEF #refer00@;
         |ACABA;
     |FINSI;

     |ABRE #refer00@;
     |BUCLE agim0019;
     |CIERRA #refer00@;

     |DESCARGA_DEF #refer01@;
     |DESCARGA_DEF #refer00@;
|FPRC;

|PROCESO BorraRepre;
     |BORRA 020#refer01@.a;
     |LIBERA #refer01@;
|FPRC;

|DEFBUCLE agim0004;
    #refer01@#1002;
    ;
    #refer02@#0, 00;
    #refer02@#0, 99;
    be;
    NULL, BorraRepre;
|FIN;

|PROCESO CreaRepres;
     #refer00@#0  = #refer02@#0;
     #refer00@#1  = #refer02@#1;
     |LEE 040#refer00@.=;
     |SI FSalida ! 0;
         |BORRA 020#refer02@.a;
         |LIBERA #refer02@;
         |ACABA;
     |FINSI;

     |SI #refer02@#15 = "A";  |ACABA;  |FINSI;

     |SI nValorEmpre ! #refer02@#0;
         nValorEmpre = #refer02@#0;
         nValorRegis = #refer02@#1;
     |FINSI;

     |SI nValorEmpre = #refer02@#0; |Y nValorRegis ! #refer02@#1;
         |ACABA;
     |FINSI;

     |SI nCodigo ! #refer02@#0;
         |BUCLE agim0004;
         nCodigo = #refer02@#0;
     |FINSI;

     #refer01@#0  = #refer02@#0;
     #refer01@#1  = #refer02@#2;
     #refer01@#2  = #refer02@#3;
     #refer01@#3  = #refer02@#4;
     #refer01@#4  = #refer02@#5;
     #refer01@#5  = #refer02@#6;
     #refer01@#6  = #refer02@#7;
     #refer01@#7  = #refer02@#8;
     #refer01@#8  = #refer02@#9;
     #refer01@#9  = #refer02@#10;
     #refer01@#10 = #refer02@#11;
     #refer01@#11 = #refer02@#12;
     #refer01@#12 = #refer02@#13;
     #refer01@#13 = #refer02@#14;
     #refer01@#14 = #refer02@#16;
     #refer01@#15 = #refer02@#17;
     #refer01@#16 = #refer02@#18;
     |GRABA 020#refer01@.n;
     |LIBERA #refer01@;
     |LIBERA #refer02@;
|FPRC;

|DEFBUCLE agim0024;
     #refer02@#2003;
     ;
     00000, 99, 00;
     99999, 00, 99;
     be;
     NULL, CreaRepres;
|FIN;

|PROCESO Representantes;
     aDef = eaPathBasica + "def/agim0019.mas";
     |CARGA_DEF aDef, refer00@;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     aDef = eaPathBasica + "def/agim0004.mas";
     |CARGA_DEF aDef, refer01@;
     |SI FSalida ! 0;
         |DESCARGA_DEF #refer00@;
         |ACABA;
     |FINSI;

     aDef = eaPathBasica + "def/agim0024.mas";
     |CARGA_DEF aDef, refer02@;
     |SI FSalida ! 0;
         |DESCARGA_DEF #refer01@;
         |DESCARGA_DEF #refer00@;
         |ACABA;
     |FINSI;

     |ABRE #refer00@;
     |ABRE #refer01@;
     |BUCLE agim0024;
     |CIERRA #refer00@;
     |CIERRA #refer01@;

     |DESCARGA_DEF #refer02@;
     |DESCARGA_DEF #refer01@;
     |DESCARGA_DEF #refer00@;
|FPRC;

|PROCESO Basica;
     aOrigen  = eaPathBasica + "patrones/agiepim1.bas";
     aDestino = eaPathBasica + "fich/agiepim1.dat";
     |COPIA_FICHERO aOrigen, aDestino;

     aOrigen  = eaPathBasica + "patrones/agiepim2.bas";
     aDestino = eaPathBasica + "fich/agiepim2.dat";
     |COPIA_FICHERO aOrigen, aDestino;

     aOrigen  = eaPathBasica + "patrones/agitab05.bas";
     aDestino = eaPathBasica + "fich/agitab05.dat";
     |COPIA_FICHERO aOrigen, aDestino;

     aOrigen  = eaPathBasica + "patrones/agitab10.bas";
     aDestino = eaPathBasica + "fich/agitab10.dat";
     |COPIA_FICHERO aOrigen, aDestino;

     aOrigen  = eaPathBasica + "patrones/agitab11.bas";
     aDestino = eaPathBasica + "fich/agitab11.dat";
     |COPIA_FICHERO aOrigen, aDestino;

     aOrigen  = eaPathBasica + "patrones/agitab12.bas";
     aDestino = eaPathBasica + "fich/agitab12.dat";
     |COPIA_FICHERO aOrigen, aDestino;

     aOrigen  = eaPathBasica + "patrones/agitab13.bas";
     aDestino = eaPathBasica + "fich/agitab13.dat";
     |COPIA_FICHERO aOrigen, aDestino;

     aOrigen  = eaPathBasica + "patrones/agitab14.bas";
     aDestino = eaPathBasica + "fich/agitab14.dat";
     |COPIA_FICHERO aOrigen, aDestino;

     aOrigen  = eaPathBasica + "patrones/agitab99.bas";
     aDestino = eaPathBasica + "fich/agitab99.dat";
     |COPIA_FICHERO aOrigen, aDestino;

     nSwAplicacion   = 1;
     aDirEmpresa     = "";
     aPathOrigen     = #dspase00#0;  |QBF aPathOrigen;
     aPathOrigen     = aPathOrigen + "agicli/";
     aPathAnterior   = aPathOrigen + "fich/";
     aPathDestino    = eaPathBasica - "fich/";

     |HAZ HazElDir;

     |MENSA "     Creando Descripciones de Acciones ";
     |HAZ GrabaDescriAccion;

     |MENSA "     Creando Objeto Social ";
     |HAZ GrabaObjetoSocial;

     |MENSA "     Creando Representantes Empresas ";
     |HAZ Representantes;

     |MENSA "      ";
|FPRC;

|| ________________________________________________________________________
|| Aplicacion Utilidades de Contabilidad
|| ________________________________________________________________________

|PROCESO Contanex;
     nSwAplicacion   = 2;
     aDirEmpresa     = "";
     aPathOrigen     = #dspase00#0;  |QBF aPathOrigen;
     aPathOrigen     = aPathOrigen + "agivcon/";
     aPathAnterior   = aPathOrigen + "fich/";
     aPathDestino    = eaPathContanex - "fich/";
     |HAZ HazElDir;
|FPRC;

|| ________________________________________________________________________
|| Aplicacion de Contabilidad
|| ________________________________________________________________________

|PROCESO Contagen;
     nSwAplicacion   = 2;
     aDirEmpresa     = "";
     aPathOrigen     = #dspase00#0;  |QBF aPathOrigen;
     aPathOrigen     = aPathOrigen + "agicont/";
     aPathAnterior   = aPathOrigen + "fich/";
     aPathDestino    = eaPathContagen - "fich/";
     |HAZ HazElDir;

     aDirFichDestino = aPathDestino + "fich/000000/";
     |MKDIR aDirFichDestino;
     |SI FSalida = 0;
         aDirEmpresa     = "000000/";
         aPathOrigen     = #dspase00#0;  |QBF aPathOrigen;
         aPathOrigen     = aPathOrigen + "agicont/";
         aPathAnterior   = aPathOrigen + "fich/000000/";
         aPathDestino    = eaPathContagen - "fich/";
         |HAZ HazElDir;
     |FINSI;
|FPRC;

|| ________________________________________________________________________
|| Aplicacion Sociedades
|| ________________________________________________________________________

|PROCESO PorWord;
     aAlfa           = #dspase99#0;  |QBF aAlfa;
     aDirFichOrigen  = aPathOrigen  + aAplica + aAlfa + "/";
     aDirFichDestino = aPathDestino + aAplica + aAlfa + "/";
     |MKDIR aDirFichDestino;

     aDirecBuscar = aDirFichOrigen + "*";

     IaDirFichO   = aDirFichO1 <-;
     |PARA nCampo = 1;  |SI nCampo [ 99;  |HACIENDO nCampo = nCampo + 1;
           aDirFichO   = "";
           IaDirFichO  = IaDirFichO + 1;
     |SIGUE;

     IaDirFichO   = aDirFichO1 <-;
     |_PDIR aDirecBuscar;
     |PARA; |SI FSalida = 0; |HACIENDO;
            aAlfa    = aDirecBuscar;  |QBF aAlfa;
            aAlfa    = aAlfa % -401;
            |SI aAlfa = ".";
                 aFichero = aDirecBuscar - aDirFichOrigen;
                 #dspase00#11    = aFichero;   |PINTA #dspase00#11;

                 |HAZ Copiar;
            |SINO;
                 aDirFichO  = aDirecBuscar;
                 IaDirFichO = IaDirFichO + 1;
            |FINSI;
            |_SDIR aDirecBuscar;
     |SIGUE;

     IaDirFichO   = aDirFichO1 <-;
     |PARA nCampo = 1;  |SI nCampo [ 99;  |HACIENDO nCampo = nCampo + 1;
           |SI aDirFichO = "";   |SAL;  |FINSI;

           aAlfa     = aDirFichO;  |QBF aAlfa;
           aAlfa     = aAlfa % -105;
           aDirFichD = aDirFichDestino + aAlfa;  |MKDIR aDirFichD;
           aDirFichD = aDirFichDestino + aAlfa + "/";

           aDirecB  = aDirFichO + "/*";
           |_PDIR aDirecB;
           |PARA; |SI FSalida = 0; |HACIENDO;
                  aFichero = aDirecB - aDirFichO;
                  #dspase00#11    = aFichero;   |PINTA #dspase00#11;

                  aOrigen  = aDirFichO + #dspase00#11;  |QBF aOrigen;
                  aDestino = aDirFichD + #dspase00#11;  |QBF aDestino;
                  |COPIA_FICHERO aOrigen, aDestino;

                  |_SDIR aDirecB;
           |SIGUE;
           IaDirFichO  = IaDirFichO + 1;
     |SIGUE;
|FPRC;

|PROCESO PorEjercicio;
     aDirFichOrigen  = aPathOrigen  + aAplica + (("00000" + nEmpresa) % -105) + "/" + (("0000" + #dspase99#1) % -104) + "/";
     aDirFichDestino = aPathDestino + aAplica + (("00000" + nEmpresa) % -105) + "/" + (("0000" + #dspase99#1) % -104) + "/";
     |MKDIR aDirFichDestino;

     aDirecBuscar = aDirFichOrigen + "*";
     |_PDIR aDirecBuscar;
     |PARA; |SI FSalida = 0; |HACIENDO;
            aFichero = aDirecBuscar - aDirFichOrigen;
            #dspase00#11    = aFichero;   |PINTA #dspase00#11;

            |HAZ Copiar;

            |_SDIR aDirecBuscar;
     |SIGUE;
|FPRC;

|DEFBUCLE dspase99_2;
     #dspase99#1;
     ;
     aEmpresa,    1;
     aEmpresa, 2999;
     ;
     NULL, PorEjercicio;
|FIN;

|PROCESO PorEmpresa;
     |SI aAplica = "word/";
         |HAZ PorWord;
         |ACABA;
     |FINSI;

     aEmpresa        = #dspase99#0;
     nEmpresa        = #dspase99#0;
     aDirFichOrigen  = aPathOrigen  + aAplica + (("00000" + nEmpresa) % -105) + "/";
     aDirFichDestino = aPathDestino + aAplica + (("00000" + nEmpresa) % -105) + "/";
     |MKDIR aDirFichDestino;

     |ABRE #dspase99;
     aDirecBuscar = aDirFichOrigen + "*";
     |_PDIR aDirecBuscar;
     |PARA; |SI FSalida = 0; |HACIENDO;
            aFichero = aDirecBuscar - aDirFichOrigen;
            #dspase99#0    = aEmpresa;
            #dspase99#1    = aFichero;
            |GRABA 020#dspase99.n;
            |_SDIR aDirecBuscar;
     |SIGUE;
     |CIERRA #dspase99;

     |SALVA_DATOS #dspase99;
     |BUCLE dspase99_2;
     |REPON_DATOS #dspase99;
     |LEE 040#dspase99.=;
|FPRC;

|DEFBUCLE dspase99_1;
     #dspase99#1;
     ;
     "        ", 0000;
     "zzzzzzzz", 0000;
     ;
     NULL, PorEmpresa;
|FIN;

|PROCESO Depositos;
     aAplica         = "depositos/";
     aDirFichOrigen  = aPathOrigen  + aAplica;
     aDirFichDestino = aPathDestino + aAplica;
     |MKDIR aDirFichDestino;

     |ABRE #dspase99;  |CIERRA #dspase99;  |DELINDEX #dspase99;

     |ABRE #dspase99;
     aDirecBuscar = aDirFichOrigen + "*";
     |_PDIR aDirecBuscar;
     |PARA; |SI FSalida = 0; |HACIENDO;
            aFichero = aDirecBuscar - aDirFichOrigen;
            #dspase99#0    = aFichero;
            #dspase99#1    = 0;
            |GRABA 020#dspase99.n;
            |_SDIR aDirecBuscar;
     |SIGUE;
     |CIERRA #dspase99;

     |BUCLE dspase99_1;

     |DELINDEX #dspase99;
|FPRC;

|PROCESO Emisiones;
     aAplica         = "emisiones/";
     aDirFichOrigen  = aPathOrigen  + aAplica;
     aDirFichDestino = aPathDestino + aAplica;
     |MKDIR aDirFichDestino;

     |ABRE #dspase99;  |CIERRA #dspase99;  |DELINDEX #dspase99;

     |ABRE #dspase99;
     aDirecBuscar = aDirFichOrigen + "*";
     |_PDIR aDirecBuscar;
     |PARA; |SI FSalida = 0; |HACIENDO;
            aFichero = aDirecBuscar - aDirFichOrigen;
            #dspase99#0    = aFichero;
            #dspase99#1    = 0;
            |GRABA 020#dspase99.n;
            |_SDIR aDirecBuscar;
     |SIGUE;
     |CIERRA #dspase99;

     |BUCLE dspase99_1;

     |DELINDEX #dspase99;
|FPRC;

|PROCESO Word;
     aAplica         = "word/";
     aDirFichOrigen  = aPathOrigen  + aAplica;
     aDirFichDestino = aPathDestino + aAplica;
     |MKDIR aDirFichDestino;

     |ABRE #dspase99;  |CIERRA #dspase99;  |DELINDEX #dspase99;

     |ABRE #dspase99;
     aDirecBuscar = aDirFichOrigen + "*";
     |_PDIR aDirecBuscar;
     |PARA; |SI FSalida = 0; |HACIENDO;
            aFichero = aDirecBuscar - aDirFichOrigen;
            #dspase99#0    = aFichero;
            #dspase99#1    = 0;
            |GRABA 020#dspase99.n;
            |_SDIR aDirecBuscar;
     |SIGUE;
     |CIERRA #dspase99;

     |BUCLE dspase99_1;

     |DELINDEX #dspase99;
|FPRC;

|PROCESO Contasoc;
     nSwAplicacion   = 3;
     aDirEmpresa     = "";
     aPathOrigen     = #dspase00#0;  |QBF aPathOrigen;
     aPathOrigen     = aPathOrigen + "sociedad/";
     aPathAnterior   = aPathOrigen + "fich/";
     aPathDestino    = eaPathContasoc - "fich/";

     |HAZ HazElDir;
     |HAZ Depositos;
     |HAZ Emisiones;
     |HAZ Word;
|FPRC;

|| ________________________________________________________________________
|| Aplicacion Laboral
|| ________________________________________________________________________

|PROCESO Laboral;
     nSwAplicacion   = 4;
     aDirEmpresa     = "";
     aPathOrigen     = #dspase00#0;  |QBF aPathOrigen;
     aPathOrigen     = aPathOrigen + "aginom/";
     aPathAnterior   = aPathOrigen + "fich/";
     aPathDestino    = eaPathLaboral - "fich/";

     |HAZ HazElDir;
|FPRC;

|| ________________________________________________________________________
|| Aplicacion Renta1994
|| ________________________________________________________________________

|PROCESO Renta94;
     nSwAplicacion   = 5;
     aDirEmpresa     = "";
     aPathOrigen     = #dspase00#0;  |QBF aPathOrigen;
     aPathOrigen     = aPathOrigen + "agiren94/";
     aPathAnterior   = aPathOrigen + "fich/";
     aPathDestino    = eaPathRen1994 - "fich/";

     |HAZ HazElDir;
|FPRC;

|| ________________________________________________________________________
|| Aplicacion Renta1995
|| ________________________________________________________________________

|PROCESO Renta95;
     nSwAplicacion   = 5;
     aDirEmpresa     = "";
     aPathOrigen     = #dspase00#0;  |QBF aPathOrigen;
     aPathOrigen     = aPathOrigen + "agiren95/";
     aPathAnterior   = aPathOrigen + "fich/";
     aPathDestino    = eaPathRen1995 - "fich/";

     |HAZ HazElDir;
|FPRC;

|| ________________________________________________________________________
|| Aplicacion Renta1996
|| ________________________________________________________________________

|PROCESO Renta96;
     nSwAplicacion   = 5;
     aDirEmpresa     = "";
     aPathOrigen     = #dspase00#0;  |QBF aPathOrigen;
     aPathOrigen     = aPathOrigen + "agiren96/";
     aPathAnterior   = aPathOrigen + "fich/";
     aPathDestino    = eaPathRen1996 - "fich/";

     |HAZ HazElDir;
|FPRC;

|| ________________________________________________________________________
|| Aplicacion Renta1997
|| ________________________________________________________________________

|PROCESO Renta97;
     nSwAplicacion   = 5;
     aDirEmpresa     = "";
     aPathOrigen     = #dspase00#0;  |QBF aPathOrigen;
     aPathOrigen     = aPathOrigen + "agiren97/";
     aPathAnterior   = aPathOrigen + "fich/";
     aPathDestino    = eaPathRen1997 - "fich/";

     |HAZ HazElDir;
|FPRC;

|| ________________________________________________________________________
|| Aplicacion Renta1998
|| ________________________________________________________________________

|PROCESO Renta98;
     nSwAplicacion   = 5;
     aDirEmpresa     = "";
     aPathOrigen     = #dspase00#0;  |QBF aPathOrigen;
     aPathOrigen     = aPathOrigen + "agiren98/";
     aPathAnterior   = aPathOrigen + "fich/";
     aPathDestino    = eaPathRen1998 - "fich/";

     |HAZ HazElDir;
|FPRC;

|| ________________________________________________________________________
|| Aplicacion Renta1999
|| ________________________________________________________________________

|PROCESO Renta99;
     nSwAplicacion   = 5;
     aDirEmpresa     = "";
     aPathOrigen     = #dspase00#0;  |QBF aPathOrigen;
     aPathOrigen     = aPathOrigen + "agiren99/";
     aPathAnterior   = aPathOrigen + "fich/";
     aPathDestino    = eaPathRen1999 - "fich/";

     |HAZ HazElDir;
|FPRC;

|| ________________________________________________________________________
|| Aplicacion Renta2000
|| ________________________________________________________________________

|PROCESO PasaCapital;
     |DDEFECTO #refer00@;
     |PARA nCampos = 0;  |SI nCampos [ 110;  |HACIENDO nCampos = nCampos + 1;
           #refer00@#nCampos# = #refer01@#nCampos#;
     |SIGUE;
     #refer00@#113 = #refer01@#111;
     |GRABA 020#refer00@.n;
     |LIBERA #refer00@;
|FPRC;

|DEFBUCLE rem00021;
     #refer01@#1002;
     ;
     00000, 00;
     99999, 99;
     ;
     NULL, PasaCapital;
|FIN;

|PROCESO CogeCapInmob;
     aDef = eaPathRen2000 + "def/rem00021.mas";
     |CARGA_DEF aDef, refer00@;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     aDef = aPathOrigen + "def/rem00021.mas";
     |CARGA_DEF aDef, refer01@;
     |SI FSalida ! 0;
         |DESCARGA_DEF #refer00@;
         |ACABA;
     |FINSI;

     aDirFichDestino = aPathDestino + "fich/";

     |PATH_DAT #refer00@#aDirFichDestino#;
     |PATH_DAT #refer01@#aPathAnterior#;

     |ABRE #refer00@;
     |BUCLE rem00021;
     |CIERRA #refer00@;

     |DESCARGA_DEF #refer01@;
     |DESCARGA_DEF #refer00@;
|FPRC;

|PROCESO Renta00;
     nSwAplicacion   = 5;
     aDirEmpresa     = "";
     aPathOrigen     = #dspase00#0;  |QBF aPathOrigen;
     aPathOrigen     = aPathOrigen + "agiren00/";
     aPathAnterior   = aPathOrigen + "fich/";
     aPathDestino    = eaPathRen2000 - "fich/";

     |HAZ CogeCapInmob;
     |HAZ HazElDir;
|FPRC;

|| ________________________________________________________________________
|| Aplicacion Renta2001
|| ________________________________________________________________________

|PROCESO Renta01;
     nSwAplicacion   = 5;
     aDirEmpresa     = "";
     aPathOrigen     = #dspase00#0;  |QBF aPathOrigen;
     aPathOrigen     = aPathOrigen + "agiren01/";
     aPathAnterior   = aPathOrigen + "fich/";
     aPathDestino    = eaPathRen2001 - "fich/";

     |HAZ HazElDir;
|FPRC;

|| ________________________________________________________________________
|| Aplicacion Renta2002
|| ________________________________________________________________________

|PROCESO Renta02;
     nSwAplicacion   = 5;
     aDirEmpresa     = "";
     aPathOrigen     = #dspase00#0;  |QBF aPathOrigen;
     aPathOrigen     = aPathOrigen + "agiren02/";
     aPathAnterior   = aPathOrigen + "fich/";
     aPathDestino    = eaPathRen2002 - "fich/";

     |HAZ HazElDir;
|FPRC;

|| ________________________________________________________________________
|| Aplicacion Renta2003
|| ________________________________________________________________________

|PROCESO Renta03;
     nSwAplicacion   = 5;
     aDirEmpresa     = "";
     aPathOrigen     = #dspase00#0;  |QBF aPathOrigen;
     aPathOrigen     = aPathOrigen + "agiren03/";
     aPathAnterior   = aPathOrigen + "fich/";
     aPathDestino    = eaPathRen2003 - "fich/";

     |HAZ HazElDir;
|FPRC;

|| ________________________________________________________________________
|| Aplicacion Renta2004
|| ________________________________________________________________________

|PROCESO Renta04;
     nSwAplicacion   = 5;
     aDirEmpresa     = "";
     aPathOrigen     = #dspase00#0;  |QBF aPathOrigen;
     aPathOrigen     = aPathOrigen + "agiren04/";
     aPathAnterior   = aPathOrigen + "fich/";
     aPathDestino    = eaPathRen2004 - "fich/";

     |HAZ HazElDir;
|FPRC;

|| ________________________________________________________________________
|| Aplicacion Renta2005
|| ________________________________________________________________________

|PROCESO Renta05;
     nSwAplicacion   = 5;
     aDirEmpresa     = "";
     aPathOrigen     = #dspase00#0;  |QBF aPathOrigen;
     aPathOrigen     = aPathOrigen + "agiren05/";
     aPathAnterior   = aPathOrigen + "fich/";
     aPathDestino    = eaPathRen2005 - "fich/";

     |HAZ HazElDir;
|FPRC;

|| ________________________________________________________________________
|| Aplicacion Renta2006
|| ________________________________________________________________________

|PROCESO Renta06;
     nSwAplicacion   = 5;
     aDirEmpresa     = "";
     aPathOrigen     = #dspase00#0;  |QBF aPathOrigen;
     aPathOrigen     = aPathOrigen + "agiren06/";
     aPathAnterior   = aPathOrigen + "fich/";
     aPathDestino    = eaPathRen2006 - "fich/";

     |HAZ HazElDir;
|FPRC;

|| ________________________________________________________________________
|| Aplicacion Renta2007
|| ________________________________________________________________________

|PROCESO Renta07;
     nSwAplicacion   = 5;
     aDirEmpresa     = "";
     aPathOrigen     = #dspase00#0;  |QBF aPathOrigen;
     aPathOrigen     = aPathOrigen + "agiren07/";
     aPathAnterior   = aPathOrigen + "fich/";
     aPathDestino    = eaPathRen2007 - "fich/";

     |HAZ HazElDir;
|FPRC;

|| ________________________________________________________________________
|| Aplicacion Renta2008
|| ________________________________________________________________________

|PROCESO Renta08;
     nSwAplicacion   = 5;
     aDirEmpresa     = "";
     aPathOrigen     = #dspase00#0;  |QBF aPathOrigen;
     aPathOrigen     = aPathOrigen + "agiren08/";
     aPathAnterior   = aPathOrigen + "fich/";
     aPathDestino    = eaPathRen2008 - "fich/";

     |HAZ HazElDir;
|FPRC;


|| ________________________________________________________________________
|| Aplicacion Renta2009
|| ________________________________________________________________________

|PROCESO Renta09;
     nSwAplicacion   = 5;
     aDirEmpresa     = "";
     aPathOrigen     = #dspase00#0;  |QBF aPathOrigen;
     aPathOrigen     = aPathOrigen + "agiren09/";
     aPathAnterior   = aPathOrigen + "fich/";
     aPathDestino    = eaPathRen2009 - "fich/";

     |HAZ HazElDir;
|FPRC;

|| ________________________________________________________________________
|| Aplicacion Renta2010
|| ________________________________________________________________________

|PROCESO Renta10;
     nSwAplicacion   = 5;
     aDirEmpresa     = "";
     aPathOrigen     = #dspase00#0;  |QBF aPathOrigen;
     aPathOrigen     = aPathOrigen + "agiren10/";
     aPathAnterior   = aPathOrigen + "fich/";
     aPathDestino    = eaPathRen2010 - "fich/";

     |HAZ HazElDir;
|FPRC;

|| ________________________________________________________________________
|| Aplicacion Renta2011
|| ________________________________________________________________________

|PROCESO Renta11;
     nSwAplicacion   = 5;
     aDirEmpresa     = "";
     aPathOrigen     = #dspase00#0;  |QBF aPathOrigen;
     aPathOrigen     = aPathOrigen + "agiren11/";
     aPathAnterior   = aPathOrigen + "fich/";
     aPathDestino    = eaPathRen2011 - "fich/";

     |HAZ HazElDir;
|FPRC;

|| ________________________________________________________________________
|| Aplicacion Renta2012
|| ________________________________________________________________________

|PROCESO Renta12;
     nSwAplicacion   = 5;
     aDirEmpresa     = "";
     aPathOrigen     = #dspase00#0;  |QBF aPathOrigen;
     aPathOrigen     = aPathOrigen + "agiren12/";
     aPathAnterior   = aPathOrigen + "fich/";
     aPathDestino    = eaPathRen2012 - "fich/";

     |HAZ HazElDir;
|FPRC;

|| ________________________________________________________________________
|| Aplicacion Renta2013
|| ________________________________________________________________________

|PROCESO Renta13;
     nSwAplicacion   = 5;
     aDirEmpresa     = "";
     aPathOrigen     = #dspase00#0;  |QBF aPathOrigen;
     aPathOrigen     = aPathOrigen + "agiren13/";
     aPathAnterior   = aPathOrigen + "fich/";
     aPathDestino    = eaPathRen2013 - "fich/";

     |HAZ HazElDir;
|FPRC;

|| ________________________________________________________________________
|| Aplicacion Renta2014
|| ________________________________________________________________________

|PROCESO Renta14;
     nSwAplicacion   = 5;
     aDirEmpresa     = "";
     aPathOrigen     = #dspase00#0;  |QBF aPathOrigen;
     aPathOrigen     = aPathOrigen + "agiren14/";
     aPathAnterior   = aPathOrigen + "fich/";
     aPathDestino    = eaPathRen2014 - "fich/";

     |HAZ HazElDir;
|FPRC;

|| ________________________________________________________________________
|| Aplicacion Renta2015
|| ________________________________________________________________________

|PROCESO Renta15;
     nSwAplicacion   = 5;
     aDirEmpresa     = "";
     aPathOrigen     = #dspase00#0;  |QBF aPathOrigen;
     aPathOrigen     = aPathOrigen + "agiren15/";
     aPathAnterior   = aPathOrigen + "fich/";
     aPathDestino    = eaPathRen2015 - "fich/";

     |HAZ HazElDir;
|FPRC;

|| ________________________________________________________________________
|| Aplicacion Renta2016
|| ________________________________________________________________________

|PROCESO Renta16;
     nSwAplicacion   = 5;
     aDirEmpresa     = "";
     aPathOrigen     = #dspase00#0;  |QBF aPathOrigen;
     aPathOrigen     = aPathOrigen + "agiren16/";
     aPathAnterior   = aPathOrigen + "fich/";
     aPathDestino    = eaPathRen2016 - "fich/";

     |HAZ HazElDir;
|FPRC;

|| ________________________________________________________________________
|| Aplicacion Renta2017
|| ________________________________________________________________________

|PROCESO Renta17;
     nSwAplicacion   = 5;
     aDirEmpresa     = "";
     aPathOrigen     = #dspase00#0;  |QBF aPathOrigen;
     aPathOrigen     = aPathOrigen + "agiren17/";
     aPathAnterior   = aPathOrigen + "fich/";
     aPathDestino    = eaPathRen2017 - "fich/";

     |HAZ HazElDir;
|FPRC;

|| ________________________________________________________________________
|| Aplicacion Renta2018
|| ________________________________________________________________________

|PROCESO Renta18;
     nSwAplicacion   = 5;
     aDirEmpresa     = "";
     aPathOrigen     = #dspase00#0;  |QBF aPathOrigen;
     aPathOrigen     = aPathOrigen + "agiren18/";
     aPathAnterior   = aPathOrigen + "fich/";
     aPathDestino    = eaPathRen2018 - "fich/";

     |HAZ HazElDir;
|FPRC;

|| ________________________________________________________________________
|| Aplicacion Renta2019
|| ________________________________________________________________________

|PROCESO Renta19;
     nSwAplicacion   = 5;
     aDirEmpresa     = "";
     aPathOrigen     = #dspase00#0;  |QBF aPathOrigen;
     aPathOrigen     = aPathOrigen + "agiren19/";
     aPathAnterior   = aPathOrigen + "fich/";
     aPathDestino    = eaPathRen2019 - "fich/";

     |HAZ HazElDir;
|FPRC;

|| ________________________________________________________________________
|| Aplicacion Facturacion
|| ________________________________________________________________________

|PROCESO CreaEmpresaFac;
     #dspase00#9 = #dspase00#9 + 1;      |PINTA #dspase00#9;

     nSwAplicacion   = 8;
     aDirFichDestino = aPathDestino + "fich/";
     aDirEmpresa     = (("00" + #refecon@#0) % -102) + "/";
     aDirFichDestino = aDirFichDestino + aDirEmpresa;
     |MKDIR aDirFichDestino;

     aPathOrigen     = #dspase00#0;  |QBF aPathOrigen;
     aPathOrigen     = aPathOrigen + aAplica;
     aPathAnterior   = aPathOrigen + "fich/" + aDirEmpresa;
     aPathDestino    = eaPathFacturar - "fich/";

     |HAZ HazElDir;

     eaAplica      = "facturar";
     eaEmpresa     = ("00" + #refecon@#0) % -102;
     enCampo       = 0;
     |HAZ GrabaMoneda;

     InpEmpresa = npEmpresa1 <-;
     InpEmpresa = InpEmpresa + #refecon@#0;
     npEmpresa  = #refecon@#0;
|FPRC;

|DEFBUCLE facemp;
     #refecon@#1001;
     ;
     00;
     99;
     ;
     NULL, CreaEmpresaFac;
|FIN;

|PROCESO FactuEmpresas;
     aDirFichDestino = aPathDestino + "fich/";
     aDef            = aPathDestino + "def/facemp";
     |CARGA_DEF aDef, refecon@;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     InpEmpresa = npEmpresa1 <-;
     |PARA nCampos = 1;  |SI nCampos [ 105;  |HACIENDO nCampos = nCampos + 1;
           npEmpresa  = -1;
           InpEmpresa = InpEmpresa + 1;
     |SIGUE;

     |PATH_DAT #refecon@#aDirFichDestino#;
     |BUCLE facemp;

     |DESCARGA_DEF #refecon@;

     InpEmpresa = npEmpresa1 <-;
     |PARA nCampos = 1;  |SI nCampos [ 105;  |HACIENDO nCampos = nCampos + 1;
           |SI npEmpresa ! -1;
               aAlfa = ":facturar/aboz0009 facemp1 " + (("00" + npEmpresa) % -102);
               |SUB_EJECUTA_NP aAlfa;

               aAlfa = ":facturar/aszp0012 facemp1 " + (("00" + npEmpresa) % -102) + ";AUTO";
               |SUB_EJECUTA_NP aAlfa;
           |FINSI;
           InpEmpresa = InpEmpresa + 1;
     |SIGUE;
|FPRC;

|PROCESO Facturar;
     nSwAplicacion   = 8;
     aDirEmpresa     = "";
     aAplica         = "facges/";
     aPathOrigen     = #dspase00#0;  |QBF aPathOrigen;
     aPathOrigen     = aPathOrigen + aAplica;
     aPathAnterior   = aPathOrigen + "fich/";
     aPathDestino    = eaPathFacturar - "fich/";

     nPaso = 0;
     |HAZ HazElDir;
     |SI nPaso = 1;  |HAZ FactuEmpresas;  |FINSI;

     nSwAplicacion   = 8;
     aDirEmpresa     = "";
     aAplica         = "dsabogad/";
     aPathOrigen     = #dspase00#0;  |QBF aPathOrigen;
     aPathOrigen     = aPathOrigen + aAplica;
     aPathAnterior   = aPathOrigen + "fich/";
     aPathDestino    = eaPathFacturar - "fich/";

     nPaso = 0;
     |HAZ HazElDir;
     |SI nPaso = 1;  |HAZ FactuEmpresas;  |FINSI;
|FPRC;

|| ________________________________________________________________________
|| Reparto
|| ________________________________________________________________________

|PROCESO Tipo3;  |TIPO 3;
     eaPathAntes = #dspase00#0;  |QBT eaPathAntes;

     |HAZ BusquedaApli;

     |HORA aHoraEmpieza;

     eaPathAgitool = eaPathAntes + "agitool/";
     |SI #dspase00#1  = -1;  eaPathBasica    = "";  |FINSI;
     |SI #dspase00#2  = -1;  eaPathContanex  = "";  |FINSI;
     |SI #dspase00#2  = -1;  eaPathContagen  = "";  |FINSI;
     |SI #dspase00#3  = -1;  eaPathContasoc  = "";  |FINSI;
     |SI #dspase00#4  = -1;  eaPathLaboral   = "";  |FINSI;
     |SI #dspase00#5  = -1;  eaPathRen1994   = "";  |FINSI;
     |SI #dspase00#5  = -1;  eaPathRen1995   = "";  |FINSI;
     |SI #dspase00#5  = -1;  eaPathRen1996   = "";  |FINSI;
     |SI #dspase00#5  = -1;  eaPathRen1997   = "";  |FINSI;
     |SI #dspase00#5  = -1;  eaPathRen1998   = "";  |FINSI;
     |SI #dspase00#5  = -1;  eaPathRen1999   = "";  |FINSI;
     |SI #dspase00#5  = -1;  eaPathRen2000   = "";  |FINSI;
     |SI #dspase00#5  = -1;  eaPathRen2001   = "";  |FINSI;
     |SI #dspase00#5  = -1;  eaPathRen2002   = "";  |FINSI;
     |SI #dspase00#5  = -1;  eaPathRen2003   = "";  |FINSI;
     |SI #dspase00#5  = -1;  eaPathRen2004   = "";  |FINSI;
     |SI #dspase00#5  = -1;  eaPathRen2005   = "";  |FINSI;
     |SI #dspase00#5  = -1;  eaPathRen2006   = "";  |FINSI;
     |SI #dspase00#5  = -1;  eaPathRen2007   = "";  |FINSI;
     |SI #dspase00#5  = -1;  eaPathRen2008   = "";  |FINSI;
     |SI #dspase00#5  = -1;  eaPathRen2009   = "";  |FINSI;
     |SI #dspase00#5  = -1;  eaPathRen2010   = "";  |FINSI;
     |SI #dspase00#5  = -1;  eaPathRen2011   = "";  |FINSI;
     |SI #dspase00#5  = -1;  eaPathRen2012   = "";  |FINSI;
     |SI #dspase00#5  = -1;  eaPathRen2013   = "";  |FINSI;
     |SI #dspase00#5  = -1;  eaPathRen2014   = "";  |FINSI;
     |SI #dspase00#5  = -1;  eaPathRen2015   = "";  |FINSI;
     |SI #dspase00#5  = -1;  eaPathRen2016   = "";  |FINSI;
     |SI #dspase00#5  = -1;  eaPathRen2017   = "";  |FINSI;
     |SI #dspase00#5  = -1;  eaPathRen2018   = "";  |FINSI;
     |SI #dspase00#5  = -1;  eaPathRen2019   = "";  |FINSI;
     |SI #dspase00#10 = -1;  eaPathFacturar  = "";  |FINSI;

     |SI eaPathBasica   ! "";  |HAZ Basica;    |FINSI;
     |SI eaPathContagen ! "";  |HAZ Contagen;  |FINSI;
     |SI eaPathContanex ! "";  |HAZ Contanex;  |FINSI;
     |SI eaPathContasoc ! "";  |HAZ Contasoc;  |FINSI;
     |SI eaPathLaboral  ! "";  |HAZ Laboral;   |FINSI;
     |SI eaPathRen1994  ! "";  |HAZ Renta94;   |FINSI;
     |SI eaPathRen1995  ! "";  |HAZ Renta95;   |FINSI;
     |SI eaPathRen1996  ! "";  |HAZ Renta96;   |FINSI;
     |SI eaPathRen1997  ! "";  |HAZ Renta97;   |FINSI;
     |SI eaPathRen1998  ! "";  |HAZ Renta98;   |FINSI;
     |SI eaPathRen1999  ! "";  |HAZ Renta99;   |FINSI;
     |SI eaPathRen2000  ! "";  |HAZ Renta00;   |FINSI;
     |SI eaPathRen2001  ! "";  |HAZ Renta01;   |FINSI;
     |SI eaPathRen2002  ! "";  |HAZ Renta02;   |FINSI;
     |SI eaPathRen2003  ! "";  |HAZ Renta03;   |FINSI;
     |SI eaPathRen2004  ! "";  |HAZ Renta04;   |FINSI;
     |SI eaPathRen2005  ! "";  |HAZ Renta05;   |FINSI;
     |SI eaPathRen2006  ! "";  |HAZ Renta06;   |FINSI;
     |SI eaPathRen2007  ! "";  |HAZ Renta07;   |FINSI;
     |SI eaPathRen2008  ! "";  |HAZ Renta08;   |FINSI;
     |SI eaPathRen2009  ! "";  |HAZ Renta09;   |FINSI;
     |SI eaPathRen2010  ! "";  |HAZ Renta10;   |FINSI;
     |SI eaPathRen2011  ! "";  |HAZ Renta11;   |FINSI;
     |SI eaPathRen2012  ! "";  |HAZ Renta12;   |FINSI;
     |SI eaPathRen2013  ! "";  |HAZ Renta13;   |FINSI;
     |SI eaPathRen2014  ! "";  |HAZ Renta14;   |FINSI;
     |SI eaPathRen2015  ! "";  |HAZ Renta15;   |FINSI;
     |SI eaPathRen2016  ! "";  |HAZ Renta16;   |FINSI;
     |SI eaPathRen2017  ! "";  |HAZ Renta17;   |FINSI;
     |SI eaPathRen2018  ! "";  |HAZ Renta18;   |FINSI;
     |SI eaPathRen2019  ! "";  |HAZ Renta19;   |FINSI;
     |SI eaPathFacturar ! "";  |HAZ Facturar;  |FINSI;

     |SUB_EJECUTA_NP "dspatron";

     |SI eaPathBasica   ! "";
         aPathAnterior = eaPathAntes + "agicli/fich/";
         eaAplica      = "basica";
         eaEmpresa     = "";
         enCampo       = 3;
         |HAZ GrabaMoneda;

          eaAplica      = "integral";
          eaEmpresa     = "";
          enCampo       = 1;
          |HAZ GrabaMoneda;

          eaAplica      = "modelos";
          eaEmpresa     = "";
          enCampo       = 9;
          |HAZ GrabaMoneda;
     |FINSI;

     |SI eaPathContasoc ! "";
         aPathAnterior = eaPathAntes + "sociedad/fich/";
         eaAplica      = "contasoc";
         eaEmpresa     = "";
         enCampo       = 7;
         |HAZ GrabaMoneda;
     |FINSI;

     |SI eaPathLaboral  ! "";
         |SUB_EJECUTA_NP ":laboral/nomz0001;AUTOMATICO";
         |SUB_EJECUTA_NP ":laboral/nompasef;AUTOMATICO";

         aPathAnterior = eaPathAntes + "aginom/fich/";
         eaAplica      = "laboral";
         eaEmpresa     = "";
         enCampo       = 5;
         |HAZ GrabaMoneda;
     |FINSI;

     eaAplica = "";
     |SUB_EJECUTA_NP "zmonedas";

     |HORA aHoraTermina;

     |MENSA "       Pase Realizado con Exito.";
     |BLANCO 0702 0979;

     aHoraEmpieza = "Hora de Comienzo : " + aHoraEmpieza;
     aHoraTermina = "Hora de Termino  : " + aHoraTermina;
     |PINTA 0702, aHoraEmpieza;
     |PINTA 0802, aHoraTermina;

     |SI eaPathFacturar ! "";
         |MENAV "0000 A continuacion Activaremos o Desactivaremos las Empresas de Facturacion ";
         |PARA;  |SI;  |HACIENDO;
              |SUB_EJECUTA_NP ":facturar/facemp3";

              aDef            = eaPathFacturar + "def/facemp.mas";
              aDirFichDestino = eaPathFacturar + "fich/";
              |CARGA_DEF aDef, referen@;
              |SI FSalida ! 0;  |SAL;  |FINSI;

              |PATH_DAT #referen@#aDirFichDestino#;

              |ABRE #referen@;
              |SELECT #2#referen@;
              #referen@#3 = "S";
              #referen@#0 = 1;
              |LEE 000#referen@.];
              |SI FSalida = 0;   |Y #referen@#3 = "S";
                  |CIERRA #referen@;
                  |DESCARGA_DEF #referen@;
                  |SAL;
              |FINSI;
              |CIERRA #referen@;
              |DESCARGA_DEF #referen@;

              |MENAV "0000 Active al menos una empresa en Integrada.";
         |SIGUE;
     |FINSI;
|FPRC;

|PROGRAMA;

     |DBASE aBase;  |QBF aBase;
     aAbre = aBase + "fich/agifigen.dat"
     |XABRE "E", aAbre, nHandle;
     |SI FSalida ] 0;
         |XCIERRA nHandle;

         |CONFI "0000NEl Traspaso ya ha sido realizado. Desea volverlo a Realizar";
         |SI FSalida ! 0;
             |ACABA;
         |FINSI;

         |CONFI "0000NSe borraran todos los datos para volverlos a pasar. Esta Seguro. ";
         |SI FSalida ! 0;
             |ACABA;
         |FINSI;

         |CUADRO 0501 2380;
         |BLANCO 0602 2279;
         |PINTA 1320, "Introduzca Password : ";
         E_inf = "";
         E_sup = "20";
         aPassword = 1342 ? -1;
         |SI aPassword ! "<MYPASWD>     ";
             |MENAV "     Permiso denegado.";
             |ACABA;
         |FINSI;

         |HAZ Borrado;
         |PULSATECLA;
     |FINSI;

     |ABRE #dspase00;
     |LEE 101#dspase00.p;
     |SI FSalida ! 0;
        |DDEFECTO #dspase00;
        |GRABA 020#dspase00.b;
     |FINSI;

     |CLS;
     |CABEZA "     Pase de Ficheros";
     |PINPA #0#dspase00;
     |PINDA #0#dspase00;
     |ENDATOS #1#dspase00;
     |SI FSalida = 0;
         |GRABA 020#dspase00.a;
         |LIBERA #dspase00;
         |HAZ Tipo3;
     |FINSI;
     |CIERRA #dspase00;

     |PULSATECLA;
|FPRO;
