|FICHEROS;
     rem00021;
     rew00550;
     rem01011;
|FIN;

|VARIABLES;
     nCampo3    = 0;
     nCampo4    = 0;
     nCampo5    = 0;
     nCampo6    = 0;
     nCampo7    = 0;
     nCampo8    = 0;
     nCampo9    = 0;
     nCampo10   = 0;
     nCampo11   = 0;
     nCampo12   = 0;
     nCampo13   = 0;
     nCampo23   = 0;
     nImputa    = 0;
     nDiasAlq   = 0;
     nDiasUso   = 0;
     nSwHay     = 0;
     nCatastral = 0;
     nValor     = 0;
     nPorce     = 0;
     nRdto3     = 0;
     nRdto4     = 0;
     nRdto5     = 0;
     nRdto7     = 0;
     nRdto9     = 0;
     nRdto10    = 0;
     nRdto11    = 0;
     nRdto12    = 0;
     nRdto13    = 0;
     nRdto18    = 0;
     nRdto19    = 0;
     nRdto22    = 0;
     nRdto23    = 0;
     nTotal1    = 0;
     nTotal2    = 0;
     nTotal3    = 0;
     nTotAlq    = 0;
     nTotalDias = 0;
     nCoefi     = 0;
     nIngresos1 = 0;
     nIngresos2 = 0;
     nIrregular = 0;
     nGastos1   = 0;
     nGastos2   = 0;
     nGastos3   = 0;
     nValor1    = 0;
     nValor2    = 0;
     nResta     = 0;
     nRango     = 0;
     nGrid      = 0;

     aFichero   = "";
     aTipoUso   = "";
     aEsc1      = "";
     aEsc2      = "";
     aRetu      = "";
     aTecla     = "";

     &enEmpresa = 0;
     &eaAzul    = "";
|FIN;

|PROCESO GrabaElC;
     |SI #rem00021#104 = "N";  |ACABA;  |FINSI;

     |SI #rem00021#18 = "S";  |O #rem00021#18 = "T";
         |ACABA;
     |FINSI;

     |DDEFECTO #rem01011;
     nImputa     = 0;
     nCoefi      = 100;

     |SI nDiasUso ! 0;  |O nDiasAlq ! 0;
         |SI #rem00021#104 ! "N";
             |SI #rem00021#15 ! 0;
                 |SI #rem00021#17 = "S";
                     nImputa = (((#rem00021#15 % 1.1) * (nDiasUso / 365)) % #rem00021#136) % nCoefi;
                 |SINO;
                     nImputa = (((#rem00021#15 % 2) * (nDiasUso / 365)) % #rem00021#136) % nCoefi;
                 |FINSI;
             |SINO;
                 nValor     = #rem00021#26;
                 |SI nValor < #rem00021#27;  nValor = #rem00021#27;  |FINSI;

                 nImputa = ((((nValor % 50) % 1.1) * (nDiasUso / 365)) % #rem00021#136) % nCoefi;
             |FINSI;

             aTipoUso = "";

             |SI nDiasAlq = nTotalDias;
                 nImputa   = 0;
             |FINSI;

             |SI #rem00021#128 = "A";  |O #rem00021#128 = "a";
                 |SI nDiasUso = nTotalDias;
                     nImputa   = 0;
                 |FINSI;
             |FINSI;

             |SI nDiasUso ! 0;  |Y nDiasAlq ! 0;
                 |SI #rem00021#128 = "A";  |O #rem00021#128 = "a";
                     nImputa   = 0;
                 |FINSI;
             |FINSI;

             aTipoUso = "";

             |SI nDiasAlq = nTotalDias;
                 aTipoUso  = "1";
             |FINSI;

             |SI #rem00021#128 = "A";  |O #rem00021#128 = "a";
                 |SI nDiasAlq ! 0;  |Y nDiasUso ! 0;  |Y aTipoUso = "";
                     aTipoUso  = "1";
                 |FINSI;
             |FINSI;

             |SI nDiasAlq ! 0;  |Y nDiasUso ! 0;  |Y #rem00021#128 = "D";  |Y aTipoUso = "";
                 aTipoUso  = "3";
             |FINSI;

             |SI nDiasAlq ! 0;  |Y nDiasUso ! 0;  |Y #rem00021#128 = "P";  |Y aTipoUso = "";
                 aTipoUso  = "3";
             |FINSI;

             |SI nDiasUso ! 0;  |Y nDiasAlq = 0;  |Y #rem00021#128 = "D";  |Y aTipoUso = "";
                 aTipoUso  = "2";
             |FINSI;

             |SI nDiasUso ! 0;  |Y nDiasAlq = 0;  |Y #rem00021#128 = "P";  |Y aTipoUso = "";
                 aTipoUso  = "2";
             |FINSI;

             |SI aTipoUso = "";  |Y nDiasAlq ! 0;
                 aTipoUso  = "1";
             |FINSI;

             #rem01011#10 = (N\ #rem00021#136);
             #rem01011#11 = 0;
             |SI nImputa ! 0;
                 #rem01011#11 = (N\ nDiasUso);
             |FINSI;
             #rem01011#12 = (N\ nImputa);
         |FINSI;
     |FINSI;

     nIngresos1  = 0;
     nIngresos2  = 0;
     nIrregular  = 0;
     nGastos1    = 0;
     nGastos2    = 0;
     nGastos3    = 0;
     nCatastral  = 0;

     |SI nDiasAlq ! 0;
         |SI #rem00021#37 = "A";
             nIngresos1 = (nIngresos1  + (#rem00021#38 * (nDiasAlq / 365) % nCoefi));
         |SINO;
             nIngresos1 = (nIngresos1  + (#rem00021#38 % nCoefi));
         |FINSI;

         |SI #rem00021#39 = "A";
             nIngresos2 = (nIngresos2  + (#rem00021#40 * (nDiasAlq / 365) % nCoefi));
         |SINO;
             nIngresos2 = (nIngresos2  + (#rem00021#40 % nCoefi));
         |FINSI;

         |SI #rem00021#41 = "A";
             nIngresos2 = (nIngresos2  + (#rem00021#42 * (nDiasAlq / 365) % nCoefi));
         |SINO;
             nIngresos2 = (nIngresos2  + (#rem00021#42 % nCoefi));
         |FINSI;

         |SI #rem00021#43 = "A";
             nIngresos1 = (nIngresos1 + (#rem00021#44 * (nDiasAlq / 365) % nCoefi));
             nIrregular = ((#rem00021#44 * 0.4) * (nDiasAlq / 365) % nCoefi);
         |SINO;
             nIngresos1 = (nIngresos1 + (#rem00021#44 % nCoefi));
             nIrregular = (#rem00021#44 * 0.4) % nCoefi;
         |FINSI;

         nGastos3  = (#rem00021#140 % nCoefi);

         |SI #rem00021#48 = "A";
             nGastos1  = (nGastos1 + (#rem00021#22 * (nDiasAlq / 365) % nCoefi));
         |SINO;
             nGastos1  = (nGastos1 + (#rem00021#22 % nCoefi));
         |FINSI;

         |SI #rem00021#130 = "A";
             nGastos1  = (nGastos1 + (#rem00021#131 * (nDiasAlq / 365) % nCoefi));
         |SINO;
             nGastos1  = (nGastos1 + (#rem00021#131 % nCoefi));
         |FINSI;

         |SI #rem00021#59 = "A";
             nGastos2 = (nGastos2  + (#rem00021#60 * (nDiasAlq / 365) % nCoefi));
         |SINO;
             nGastos2  = (nGastos2 + (#rem00021#60 % nCoefi));
         |FINSI;

         |SI #rem00021#54 = "A";
             nGastos2  = (nGastos2 + (#rem00021#55 * (nDiasAlq / 365) % nCoefi));
         |SINO;
             nGastos2  = (nGastos2 + (#rem00021#55 % nCoefi));
         |FINSI;

         |SI nDiasAlq ! 0;
             |SI #rem00021#49 = "A";
                 nGastos2  = (nGastos2 + (#rem00021#21 * (nDiasAlq / 365) % nCoefi));
             |SINO;
                 nGastos2  = (nGastos2 + (#rem00021#21 % nCoefi));
             |FINSI;
         |FINSI;

         |SI #rem00021#50 = "A";
             nGastos2  = (nGastos2  + (#rem00021#51 * (nDiasAlq / 365) % nCoefi));
         |SINO;
             nGastos2  = (nGastos2  + (#rem00021#51 % nCoefi));
         |FINSI;

         |SI #rem00021#52 = "A";
             nGastos2  = (nGastos2  + (#rem00021#53 * (nDiasAlq / 365) % nCoefi));
         |SINO;
             nGastos2  = (nGastos2  + (#rem00021#53 % nCoefi));
         |FINSI;

         |SI #rem00021#56 = "A";
             nGastos2  = (nGastos2  + (#rem00021#57 * (nDiasAlq / 365) % nCoefi));
         |SINO;
             nGastos2  = (nGastos2  + (#rem00021#57 % nCoefi));
         |FINSI;

         |SI #rem00021#132 = "A";
             nGastos2  = (nGastos2  + (#rem00021#133 * (nDiasAlq / 365) % nCoefi));
         |SINO;
             nGastos2  = (nGastos2  + (#rem00021#133 % nCoefi));
         |FINSI;

         |SI #rem00021#36 = "S";
             nValor = nIngresos1 - (nGastos1 + nGastos2);

             nPorce = 2;
             |SI #rem00021#17 = "S";  nPorce = 1.1;  |FINSI;

             |SI #rem00021#15 > 0;
                 nCatastral = ((#rem00021#15 % nPorce) * (nDiasAlq / 365)) % nCoefi;
             |SINO;
                 nCatastral = #rem00021#27;
                 |SI nCatastral < #rem00021#26;  nCatastral = #rem00021#26;  |FINSI;
                 nCatastral = (((nCatastral % 50) % 1.1) * (nDiasAlq / 365)) % nCoefi;
             |FINSI;
         |FINSI;

         #rem01011#13 = (N\ nIngresos1 + nIngresos2);

         nValor1 = #rem01011#13;
         nValor2 = nGastos1 + nGastos3;
         |SI nValor2 > nValor1;
             nResta = nValor1;
             |SI nGastos3 > nValor1;
                 nGastos3 = nValor1;
                 nGastos1 = 0;
                 nResta   = 0;
             |SINO;
                 nResta = nResta - nGastos3;
             |FINSI;

             |SI nGastos1 > nResta;
                 nGastos1 = nResta;
             |FINSI;

             #rem01011#15  = (N\ nValor2 - nValor1);
         |FINSI;

         #rem01011#14 = (N\ nGastos1);
         #rem01011#22 = (N\ nGastos3);
         #rem01011#16 = (N\ nGastos2);
         #rem01011#17 = (N\ #rem01011#13 - #rem01011#22 - #rem01011#14 - #rem01011#16);

         |SI #rem00021#132 = "F";
             #rem01011#18 = #rem00021#142 % nCoefi;
         |SINO;
             #rem01011#18 = 0;
             |SI #rem01011#17 > 0;
                 |SI #rem00021#18 = "U";
                     |SI #rem00021#132 = "N";
                         #rem01011#18 = (N\ #rem01011#17 % 60);
                     |SINO;
                         |SI #rem00021#133 = 100;
                             #rem01011#18 = (N\ #rem01011#17 % 100);
                         |SINO;
                             nValor1 = #rem01011#17 % #rem00021#133;
                             nValor2 = #rem01011#17 - nValor1;
                             #rem01011#18 = (N\ nValor1 + (nValor2 % 60));
                         |FINSI;
                     |FINSI;
                 |FINSI;
             |FINSI;
         |FINSI;

         #rem01011#19  = (N\ nIrregular);

         |SI #rem00021#36 = "S";
             #rem01011#20  = (N\ nCatastral);
         |FINSI;

         #rem01011#21 = #rem01011#17 - #rem01011#18 - #rem01011#19;
         |SI #rem01011#20 ! 0;
             nValor1 = #rem01011#17 - #rem01011#18 - #rem01011#19;
             nValor2 = #rem01011#20;
             #rem01011#21   = nValor1;
             |SI nValor2 > nValor1;
                #rem01011#21   = nValor2;
             |FINSI;
         |FINSI;
     |FINSI;

     #rem01011#7  = aTipoUso;
     #rem01011#8  = #rem00021#125;
     #rem01011#9  = #rem00021#14;

     nSwHay = 1;

     #rew00550#0 = #rem00021#1;
     #rew00550#1 = #rem00021#2;
     #rew00550#2 = #rem00021#13;
     #rew00550#3 = #rem00021#14;
     #rew00550#4 = #rem01011#12;
     #rew00550#5 = #rem01011#17;
     #rew00550#6 = #rem01011#21;
     #rew00550#7 = "";
     |GRABA 020#rew00550.n;
     |LIBERA #rew00550;


     #rew00550#0 = 998;
     |LEE 101#rew00550.=;
     |SI FSalida ! 0;
         |DDEFECTO #rew00550;
         #rew00550#0 = 998;
         |GRABA 020#rew00550.n;
         |LIBERA #rew00550;
     |FINSI;

     #rew00550#0 = 999;
     |LEE 101#rew00550.=;
     |SI FSalida ! 0;
         |DDEFECTO #rew00550;
         #rew00550#0 = 999;
         #rew00550#1 = "";
         #rew00550#2 = "TOTAL INMUEBLES";
         |GRABA 020#rew00550.b;
     |FINSI;

     #rew00550#4 = #rew00550#4 + #rem01011#12;
     #rew00550#5 = #rew00550#5 + #rem01011#17;
     #rew00550#6 = #rew00550#6 + #rem01011#21;
     #rew00550#7 = eaAzul;
     |GRABA 020#rew00550.a;
     |LIBERA #rew00550;
|FPRC;

|PROCESO GrabaTempo;
     nDiasAlq   = #rem00021#31 + #rem00021#34;
     nDiasUso   = #rem00021#32 + #rem00021#35;
     nTotalDias = #rem00021#30 + #rem00021#31 + #rem00021#32 + #rem00021#33 + #rem00021#34 + #rem00021#35;

     |SI #rem00021#128 = "A";  |O #rem00021#128 = "a";
         |SI nDiasAlq ! 0;
             |HAZ GrabaElC;
         |FINSI;
     |SINO;
         |SI #rem00021#30 ! 0;  |O #rem00021#33 ! 0;
             |SI nDiasAlq ! 0; |O nDiasUso ! 0;
                 |HAZ GrabaElC;
             |FINSI;
         |SINO;
             |HAZ GrabaElC;
         |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE rem00021;
     #rem00021#1;
     ;
     enEmpresa, 01;
     enEmpresa, 99;
     ;
     NULL, GrabaTempo;
|FIN;

|PROGRAMA;
     |HAZ CargaColores;

     aFichero = Usuario;  |QBT aFichero;
     aFichero = ("rd" + aFichero + "zzzzzzzz") % 108;
     |NOME_DAT #rew00550#aFichero#;
     |ABRE #rew00550;  |CIERRA #rew00550;  |DELINDEX #rew00550;

     nSwHay  = 0;

     |ABRE #rew00550;
     |BUCLE rem00021;
     |CIERRA #rew00550;

     |SI nSwHay = 1;
         |PINPA #0#rew00550;

         nRango = 4 + 8 + 16 + 32;

         |ABRE #rew00550;
         |LEE 000#rew00550.p;

         |LINEAL_SIMPLE #1#rew00550, nRango, 0702, 3698, NULL, NULL, NULL;
         nGrid = FSalida;

         aEsc1  = &255 + "806";
         aEsc2  = &255 + "807";
         aRetu  = &255 + "802";
         |PARA; |SI;  |HACIENDO;
              FSalida = "::{{001}}Salir," + nGrid;
              |LEETECLA aTecla;
              |SI aTecla = aEsc1; |SAL;  |FINSI;
              |SI aTecla = aEsc2; |SAL;  |FINSI;
              |SI aTecla = aRetu; |SAL;  |FINSI;
         |SIGUE;

         |CIERRA #rew00550;
     |FINSI;

     |DELINDEX #rew00550;
|FPRO;

|PROCESO Tipo80;  |TIPO 80;
     FSalida = 3699;
|FPRC;
