|FICHEROS;
     siim0002;
     siim0009;
     siim0101;

     :modelos/dsmom041;
     :modelos/dsmom049;
|FIN;

|VARIABLES;
     nOk                 = 0;
     nReg                = 0;
     nImpor              = 0;
     nLin                = 0;

     aAlfa               = "";

     &enEmp              = 0;
     &enLot              = 0;
     &enEje              = 0;
     &eaPaisNif          = "";
     &eaCodNif           = "";
     &eaPathModSII       = "";

     &eaPrograma         = "";
     &enAprobacion       = 0;
     &enOTP              = 0;
|FIN;

|PROCESO siim0009;
     nOk = 0;

     |SI #siim0009#1 ] #siim0002#1;
         |ACABA;
     |FINSI;

     |SI #siim0009#26 = "N";
         |ACABA;
     |FINSI;

     |SI #siim0009#21 ! "C";  |Y #siim0009#21 ! "A";
         |ACABA;
     |FINSI;

     nOk = 1;
|FPRC;

|DEFBUCLE siim0009;
     #siim0009#3;
     ;
     #dsmom049#0, enEje, 12, #dsmom049#2, #dsmom049#3, 00,          0,      0;
     #dsmom049#0, enEje, 12, #dsmom049#2, #dsmom049#3, 99, 9999999999, 999999;
     ;
     NULL, siim0009;
|FIN;

|PROCESO dsmom049;
     nOk = 1;
     |BUCLE siim0009;
     |SI nOk = 0;
         |ACABA;
     |FINSI;

     nImpor = nImpor + #dsmom049#10;
     nLin   = #dsmom049#4;
|FPRC;

|PROCESO GrabaInver;
     #dsmom049#0 = #dsmom041#0;
     #dsmom049#2 = #dsmom041#2;
     #dsmom049#3 = #dsmom041#3;
     #dsmom049#4 = nLin;
     |LEE 000#dsmom049.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     nReg = 0;
     |SELECT #2#siim0009;
     #siim0009#0  = #siim0002#0;
     #siim0009#5  = #dsmom041#49;
     #siim0009#1  = #siim0002#1;
     #siim0009#2  = 1;
     |LEE 000#siim0009.];
     |SI FSalida = 0;  |Y #siim0009#0  = #siim0002#0;
                       |Y #siim0009#5  = #dsmom041#49;
                       |Y #siim0009#1  = #siim0002#1;
         nReg = #siim0009#2;
     |FINSI;

     |SELECT #1#siim0009;

     |SI nReg = 0;
         #siim0009#0  = #siim0002#0;
         #siim0009#1  = #siim0002#1;
         #siim0009#2  = 999999;
         |LEE 000#siim0009.];
         |SI FSalida = 0;
             |LEE 000#siim0009.a;
         |SINO;
             |LEE 000#siim0009.u;
         |FINSI;

         nReg = 1;
         |SI FSalida = 0;  |Y #siim0009#0  = #siim0002#0;
                           |Y #siim0009#1  = #siim0002#1;
             nReg = #siim0009#2 + 1;
         |FINSI;
     |FINSI;

     #siim0009#0   = #siim0002#0;
     #siim0009#1   = #siim0002#1;
     #siim0009#2   = nReg;
     |LEE 101#siim0009.=;
     |SI FSalida ! 0;
         |DDEFECTO #siim0009;
         #siim0009#0   = #siim0002#0;
         #siim0009#1   = #siim0002#1;
         #siim0009#2   = nReg;

         #siim0009#3   = #siim0002#4;
         #siim0009#4   = #siim0002#5;
         #siim0009#5   = #dsmom041#49;
         #siim0009#6   = #dsmom041#27;
         #siim0009#8   = #dsmom041#47;
         #siim0009#9   = #dsmom041#8;

         aAlfa = #dsmom041#2;  |QBF aAlfa;
         #siim0009#12  = aAlfa + (("00" + #dsmom041#3) % -102);

         #siim0009#13  = #dsmom041#9;
         #siim0009#14  = #dsmom049#9;
         #siim0009#16  = #dsmom041#50;
         #siim0009#27  = #dsmom049#2;
         #siim0009#28  = #dsmom049#3;
         #siim0009#29  = #dsmom049#4;

         #siim0009#10 = "ES";

         eaCodNif = #dsmom041#47;
         |HAZ LeeNif;
         |SI eaPaisNif ! "";
             #siim0009#10 = eaPaisNif;
         |FINSI;

         |SI #siim0009#10 = "E  ";  |O #siim0009#10 = "ESP";
             #siim0009#10 = "ES";
         |FINSI;

         #siim0009#7 = "01";

         |SI #siim0009#10 ! "ES ";
             aAlfa = #siim0009#10;  |QBF aAlfa;
             |SI aAlfa = "GR";  aAlfa = "EL";  |FINSI;

                                #siim0009#7 = "06";
             |SI aAlfa = "DE";  #siim0009#7 = "02";  |FINSI;
             |SI aAlfa = "AT";  #siim0009#7 = "02";  |FINSI;
             |SI aAlfa = "BE";  #siim0009#7 = "02";  |FINSI;
             |SI aAlfa = "BG";  #siim0009#7 = "02";  |FINSI;
             |SI aAlfa = "CY";  #siim0009#7 = "02";  |FINSI;
             |SI aAlfa = "DK";  #siim0009#7 = "02";  |FINSI;
             |SI aAlfa = "SI";  #siim0009#7 = "02";  |FINSI;
             |SI aAlfa = "EE";  #siim0009#7 = "02";  |FINSI;
             |SI aAlfa = "FI";  #siim0009#7 = "02";  |FINSI;
             |SI aAlfa = "FR";  #siim0009#7 = "02";  |FINSI;
             |SI aAlfa = "EL";  #siim0009#7 = "02";  |FINSI;
             |SI aAlfa = "GB";  #siim0009#7 = "02";  |FINSI;
             |SI aAlfa = "NL";  #siim0009#7 = "02";  |FINSI;
             |SI aAlfa = "HU";  #siim0009#7 = "02";  |FINSI;
             |SI aAlfa = "IT";  #siim0009#7 = "02";  |FINSI;
             |SI aAlfa = "IE";  #siim0009#7 = "02";  |FINSI;
             |SI aAlfa = "LV";  #siim0009#7 = "02";  |FINSI;
             |SI aAlfa = "LT";  #siim0009#7 = "02";  |FINSI;
             |SI aAlfa = "LU";  #siim0009#7 = "02";  |FINSI;
             |SI aAlfa = "MT";  #siim0009#7 = "02";  |FINSI;
             |SI aAlfa = "PL";  #siim0009#7 = "02";  |FINSI;
             |SI aAlfa = "PT";  #siim0009#7 = "02";  |FINSI;
             |SI aAlfa = "CZ";  #siim0009#7 = "02";  |FINSI;
             |SI aAlfa = "SK";  #siim0009#7 = "02";  |FINSI;
             |SI aAlfa = "RO";  #siim0009#7 = "02";  |FINSI;
             |SI aAlfa = "SE";  #siim0009#7 = "02";  |FINSI;
             |SI aAlfa = "HR";  #siim0009#7 = "02";  |FINSI;

             #siim0009#11 = aAlfa + #siim0009#8;
         |FINSI;

         |GRABA 020#siim0009.b;
     |FINSI;

     #siim0009#15  = nImpor;
     #siim0009#17  = nImpor;

     |GRABA 020#siim0009.a;
     |LIBERA #siim0009;
|FPRC;

|DEFBUCLE dsmom049;
     #dsmom049#2
     ;
     #dsmom041#0, #dsmom041#2, #dsmom041#3, enEje, " ";
     #dsmom041#0, #dsmom041#2, #dsmom041#3, enEje, "z";
     ;
     NULL, dsmom049;
|FIN;

|PROCESO dsmom041;
     nImpor  = 0;
     nLin    = 0;
     |BUCLE dsmom049;

     |SI nLin ! 0;
         |HAZ GrabaInver;
     |FINSI;
|FPRC;

|DEFBUCLE dsmom041;
     #dsmom041#1
     41;
     enEmp, "        ", 00, "S";
     enEmp, "zzzzzzzz", 99, "S";
     ;
     NULL, dsmom041;
|FIN;

|PROGRAMA;
     |BUCLE dsmom041;
|FPRO;

|PROCESO T80;  |TIPO 80;
     eaPrograma   = "GRUPOOTP";
     |HAZ SIIBASE_INI;
     |SI enAprobacion = 1;
         enOTP = 1;

         |ABRE #siim0101;
         |SELECT #4#siim0101;
         #siim0101#5 = enEmp;
         |LEE 000#siim0101.=;
         |SI FSalida ! 0;
             |CIERRA #siim0101;
             |ACABA;
         |FINSI;
         |CIERRA #siim0101;

         eaPathModSII = "/u/" + #siim0101#0 + "/modelos/fich/";

         |PATH_DAT #dsmom041#eaPathModSII#;
         |PATH_DAT #dsmom049#eaPathModSII#;
     |FINSI;

     |ABRET #siim0002;
     |ABRET #siim0009;
     |ABRET #dsmom041;
     |ABRET #dsmom049;

     #siim0002#0 = enEmp;
     #siim0002#1 = enLot;
     |LEE 000#siim0002.=;
|FPRC;

|PROCESO T90;  |TIPO 90;
     |CIERRAT #siim0002;
     |CIERRAT #siim0009;
     |CIERRAT #dsmom041;
     |CIERRAT #dsmom049;

     |SUB_EJECUTA "siiz0002;REFRESCA";
|FPRC;
