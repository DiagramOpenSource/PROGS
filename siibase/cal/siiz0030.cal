|FICHEROS;
     siim0001;
     siim0002;
     siim0003;
     siim0004;
     siim0007;
     siim0008;
     siim0055;
     siim0101;

     siiw0201;
     siiw0202;
     siiw0205;

     siiz0030;

     :modelos/dsmom030;
     :modelos/dsmom086;

     :contagen/canempre;
     :contagen/caivaasi;
     :contagen/camaniva;
     :contagen/caivalin;
     :contagen/caclipro;
     :contagen/caerpnif;
     :contagen/casiim01;
     :contagen/casiim02;
|FIN;

|VARIABLES;
     n0Vent              = 0;
     n1Vent              = 0;
     nIdSalir            = 0;
     nOk                 = 0;
     nEje                = 0;
     nPer                = 0;
     nDPer               = 0;
     nHPer               = 0;
     nAnyo               = 0;
     nDAnyo              = 0;
     nHAnyo              = 0;
     nID                 = 0;
     nBtnVal             = -1;
     nBt                 = 0;
     nReg                = 0;
     nGrupo              = 0;
     nSubGrupo           = 0;
     nConta              = 0;
     nCmp                = 0;
     nCmp1               = 0;
     nCmp2               = 0;
     nHay201             = 0;
     nHay202             = 0;
     nPro                = 0;
     nActiv              = 0;
     nEmp                = 0;
     nEmpSII             = 0;
     nPas                = 0;

     aID                 = "";
     aQB                 = "";
     aAlfa               = "";
     aPath               = "";
     aFicTmp             = "";
     aClvPais            = "";
     aPais               = "";
     aIdenPais           = "";
     aISP                = "";
     aNom                = "";
     aDesglo             = "";
     aFact               = "";
     aPer                = "";

     fFecha              = @;

     {20}aPopup          = "";
     {2}nNivel           = 0;

     {-1}aVent           = "";
         aVent1          = 0;
         aVent2          = 0;
         aVent3          = 0;
         aVent4          = 0;
         aVent5          = "";

     &eaSiiPro           = "";
     &enSiiLib           = 0;
     &enSiiDoc           = 0;
     &enEmp              = 0;
     &enLot              = 0;
     &enLotFor           = 0;
     &eaTip              = "";
     &enEje              = 0;
     &enPer              = 0;
     &eaNomNif           = "";
     &eaPaisNif          = "";
     &eaCodNif           = "";
     &enAccPNT           = 0;
     &enEmpPNT           = 0;
     &enErrPNT           = 0;
     &eaPathConSII       = "";
     &eaPathModSII       = "";
     &eaPathBasSII       = "";

     &eaPrograma         = "";
     &enAprobacion       = 0;
     &enOTP              = 0;
|FIN;

|PROCESO CogePeriodos;
     nPer  = #siiz0030#1;
     nDPer = #siiz0030#1;
     nHPer = #siiz0030#1;

     |SI #siiz0030#1 = "1T";  nDPer = 01;  nHPer = 03;  nPer = 1;  |FINSI;
     |SI #siiz0030#1 = "2T";  nDPer = 04;  nHPer = 06;  nPer = 2;  |FINSI;
     |SI #siiz0030#1 = "3T";  nDPer = 07;  nHPer = 09;  nPer = 3;  |FINSI;
     |SI #siiz0030#1 = "4T";  nDPer = 10;  nHPer = 12;  nPer = 4;  |FINSI;
|FPRC;

|PROCESO BuscaNombre;
     |QBF eaCodNif;
     |SI eaCodNif = "";  |ACABA;  |FINSI;

     |HAZ LeeNif;
     |SI eaNomNif ! "";
         aNom = eaNomNif;
     |FINSI;
|FPRC;

|PROCESO caivalin;
     #dsmom030#0 = #caivalin#3;
     |LEE 000#dsmom030.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |SI #dsmom030#4  = "N";  |ACABA;  |FINSI;
     |SI #dsmom030#74 ! "N";  |ACABA;  |FINSI;

     |SI nPas = 0;
         nConta = nConta + 1;
         |ACABA;
     |FINSI;

     aISP = " ";
     |SI #camaniva#36 = "S";
         |SI #dsmom030#26 = 6; |Y #dsmom030#36 = 16;
              aISP = "S";
         |FINSI;
     |FINSI;

     aDesglo = "";
     |SI #camaniva#36 = "R";
         |SI #caivalin#2 = #casiim01#50;
             aDesglo = #casiim01#7 + #casiim01#8;
         |FINSI;

         |SI #caivalin#2 = #casiim01#51;
             aDesglo = #casiim01#52 + #casiim01#53;
         |FINSI;

         |SI #caivalin#2 = #casiim01#54;
             aDesglo = #casiim01#55 + #casiim01#56;
         |FINSI;

         |SI #caivalin#2 = #casiim01#57;
             aDesglo = #casiim01#58 + #casiim01#59;
         |FINSI;

         |SI #caivalin#2 = #casiim01#60;
             aDesglo = #casiim01#61 + #casiim01#62;
         |FINSI;

         |SI #caivalin#2 = #casiim01#63;
             aDesglo = #casiim01#64 + #casiim01#65;
         |FINSI;
     |FINSI;

     #siiw0205#0 = aISP;
     #siiw0205#1 = 0;
     #siiw0205#2 = #caivalin#7;
     #siiw0205#3 = #caivalin#9;
     #siiw0205#4 = aDesglo;
     |LEE 101#siiw0205.=;
     |SI FSalida ! 0;
         |DDEFECTO #siiw0205;
         #siiw0205#0 = aISP;
         #siiw0205#1 = 0;
         #siiw0205#2 = #caivalin#7;
         #siiw0205#3 = #caivalin#9;
         #siiw0205#4 = aDesglo;
         |GRABA 020#siiw0205.b;
     |FINSI;

     #siiw0205#5 = #siiw0205#5 + #caivalin#6;
     #siiw0205#6 = #siiw0205#6 + #caivalin#8;
     #siiw0205#7 = #siiw0205#7 + #caivalin#10;

     |SI #caivalin#5  = "S";
         #siiw0205#8 = #siiw0205#8 + #caivalin#8;
     |FINSI;

     |GRABA 020#siiw0205.a;
     |LIBERA #siiw0205;
|FPRC;

|DEFBUCLE caivalin;
     #caivalin#1;
     ;
     #camaniva#0, #camaniva#1, 01;
     #camaniva#0, #camaniva#1, 99;
     ;
     NULL, caivalin;
|FIN;

|PROCESO IdentFactura;
     aAlfa = #camaniva#22;  |QBF aAlfa;
     |SI aAlfa = "";
         aAlfa = #camaniva#2;  |QBF aAlfa;
         |SI aAlfa = "";
             aAlfa = #camaniva#3;
         |SINO;
             |SI #caivaasi#97 = " ";
                 aAlfa = aAlfa + " " + #camaniva#3;
             |SINO;
                 aAlfa = aAlfa + #caivaasi#97 + #camaniva#3;
             |FINSI;
         |FINSI;
     |FINSI;

     #siiw0201#5 = aAlfa;
|FPRC;

|PROCESO IdentFiscal;
     #caerpnif#0 = #camaniva#0;
     #caerpnif#1 = #camaniva#1;
     |LEE 000#caerpnif.=;
     |SI FSalida = 0;
         aClvPais = #caerpnif#4;
     |FINSI;

     |SI #camaniva#36 = "R";
         #caclipro#23 = "C";
     |SINO;
         #caclipro#23 = "P";
     |FINSI;
     #caclipro#10 = #camaniva#12;
     |LEE 000#caclipro.=;
     |SI FSalida ! 0;  |DDEFECTO #caclipro;  |FINSI;

     aPais     = #caclipro#24;
     aIdenPais = "1";

     eaCodNif = #caclipro#9;
     |HAZ LeeNif;
     |SI eaPaisNif ! "";
         aPais = eaPaisNif;
     |FINSI;
     |QBF aPais;

     |SI aPais = "";  |O aPais = "E";  |O aPais = "ESP";
         aPais = "ES";
     |FINSI;

     |SI aPais ! "ES";
         aAlfa   = aPais;  |QBF aAlfa;
         |SI aAlfa = "GR";  aAlfa = "EL";  |FINSI;

                            aIdenPais = "6";
         |SI aAlfa = "DE";  aIdenPais = "2";  |FINSI;
         |SI aAlfa = "AT";  aIdenPais = "2";  |FINSI;
         |SI aAlfa = "BE";  aIdenPais = "2";  |FINSI;
         |SI aAlfa = "BG";  aIdenPais = "2";  |FINSI;
         |SI aAlfa = "CY";  aIdenPais = "2";  |FINSI;
         |SI aAlfa = "DK";  aIdenPais = "2";  |FINSI;
         |SI aAlfa = "SI";  aIdenPais = "2";  |FINSI;
         |SI aAlfa = "EE";  aIdenPais = "2";  |FINSI;
         |SI aAlfa = "FI";  aIdenPais = "2";  |FINSI;
         |SI aAlfa = "FR";  aIdenPais = "2";  |FINSI;
         |SI aAlfa = "EL";  aIdenPais = "2";  |FINSI;
         |SI aAlfa = "GB";  aIdenPais = "2";  |FINSI;
         |SI aAlfa = "NL";  aIdenPais = "2";  |FINSI;
         |SI aAlfa = "HU";  aIdenPais = "2";  |FINSI;
         |SI aAlfa = "IT";  aIdenPais = "2";  |FINSI;
         |SI aAlfa = "IE";  aIdenPais = "2";  |FINSI;
         |SI aAlfa = "LV";  aIdenPais = "2";  |FINSI;
         |SI aAlfa = "LT";  aIdenPais = "2";  |FINSI;
         |SI aAlfa = "LU";  aIdenPais = "2";  |FINSI;
         |SI aAlfa = "MT";  aIdenPais = "2";  |FINSI;
         |SI aAlfa = "PL";  aIdenPais = "2";  |FINSI;
         |SI aAlfa = "PT";  aIdenPais = "2";  |FINSI;
         |SI aAlfa = "CZ";  aIdenPais = "2";  |FINSI;
         |SI aAlfa = "SK";  aIdenPais = "2";  |FINSI;
         |SI aAlfa = "RO";  aIdenPais = "2";  |FINSI;
         |SI aAlfa = "SE";  aIdenPais = "2";  |FINSI;
         |SI aAlfa = "HR";  aIdenPais = "2";  |FINSI;
     |FINSI;

     |SI nGrupo = 3;  |Y nSubGrupo = 9;
         aAlfa   = aPais;  |QBF aAlfa;
         |SI aAlfa = "GR";  aAlfa = "EL";  |FINSI;

         aIdenPais = "2";
     |FINSI;

     |SI nGrupo = 3;  |Y nSubGrupo = 10;
         aAlfa = aPais;  |QBF aAlfa;
         |SI aAlfa = "GR";  aAlfa = "EL";  |FINSI;

         aIdenPais = "4";

         aAlfa   = #camaniva#14;   |QBF aAlfa;
         |SI aAlfa = "";  aIdenPais = "6";  |FINSI;
     |FINSI;

     aAlfa = #camaniva#14 % 101;
     |SI aAlfa = "X";  |O aAlfa = "Y";
         aIdenPais = "1";
     |FINSI;

     |SI aClvPais ! "";
         aIdenPais = aClvPais;
     |FINSI;
|FPRC;

|PROCESO siiw0205E;
     |SI nConta > 6;  |ACABA;  |FINSI;

     nCmp = (nConta * 7) + 18;  #siiw0201#nCmp# = #siiw0205#4 % 101;
     nCmp = nCmp + 1;           #siiw0201#nCmp# = #siiw0205#4 % 202;
     nCmp = nCmp + 1;           #siiw0201#nCmp# = #siiw0205#5;
     nCmp = nCmp + 1;           #siiw0201#nCmp# = #siiw0205#2;
     nCmp = nCmp + 1;           #siiw0201#nCmp# = #siiw0205#6;
     nCmp = nCmp + 1;           #siiw0201#nCmp# = #siiw0205#3;
     nCmp = nCmp + 1;           #siiw0201#nCmp# = #siiw0205#7;

     nConta = nConta + 1;
|FPRC;

|DEFBUCLE siiw0205E;
     #siiw0205#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, siiw0205E;
|FIN;

|PROCESO ImportaEmitidas;
     |LEE 000#siiw0201.u;
     |SI FSalida ! 0;
         #siiw0201#0 = 0;
     |FINSI;

     nReg = #siiw0201#0 + 1;

     |DDEFECTO #siiw0201;
     #siiw0201#0   = nReg;
     #siiw0201#1   = #siim0001#2;
     #siiw0201#2   = #siiz0030#0;
     #siiw0201#3   = #siiz0030#1;
     #siiw0201#4   = "E";

     |HAZ IdentFactura;

     #siiw0201#6   = #camaniva#4;
     #siiw0201#7   = #camaniva#41;

     |HAZ IdentFiscal;

     #siiw0201#8  = aIdenPais;
     #siiw0201#9  = #camaniva#14;

     eaCodNif = #camaniva#14;
     aNom     = #camaniva#13;
     |HAZ BuscaNombre;
     #siiw0201#10 = aNom;
     #siiw0201#11 = aPais;

     |SI aIdenPais ! "1";
         |QBF aPais;
         |SI aPais = "GR";  aPais = "EL";  |FINSI;

         #siiw0201#12 = aPais + #camaniva#14;
     |FINSI;

     #siiw0201#13  = #casiim01#3;
     #siiw0201#14  = #casiim01#4;
     #siiw0201#15  = #casiim01#5;
     #siiw0201#16  = #casiim01#6;
     #siiw0201#17  = #camaniva#44;
     #siiw0201#61  = #casiim01#13;

     |PARA nCmp1 = 62;  |SI nCmp1 [ 95;  |HACIENDO nCmp1 = nCmp1 + 1;
           nCmp2 = nCmp1 - 47;
           #siiw0201#nCmp1#  = #casiim01#nCmp2#;
     |SIGUE;

     #siiw0201#96  = #casiim01#14;
     #siiw0201#97  = #casiim01#49;
     #siiw0201#99  = #casiim01#10;
     #siiw0201#100 = #casiim01#11;
     #siiw0201#101 = #casiim01#12;

     nConta = 0;
     |BUCLE siiw0205E;

     #siiw0201#200 = #siim0001#0;
     #siiw0201#201 = #canempre#3;
     #siiw0201#202 = #camaniva#0;
     #siiw0201#203 = #camaniva#1;

     #siiw0201#122 = #casiim01#67;
     #siiw0201#123 = #casiim01#68;
     #siiw0201#124 = #casiim01#69;
     #siiw0201#125 = #casiim01#70;
     #siiw0201#126 = #casiim01#71;
     #siiw0201#127 = #casiim01#72;

     |GRABA 020#siiw0201.n;
     |LIBERA #siiw0201;
|FPRC;

|PROCESO siiw0205R;
     |SI #siiw0202#15 ! "02";
         nConta = nConta + 1;
         |SI nConta > 6;  |ACABA;  |FINSI;

         nCmp = (nConta * 6) + 13;  #siiw0202#nCmp# = #siiw0205#0;
         nCmp = nCmp + 1;           #siiw0202#nCmp# = #siiw0205#5;
         nCmp = nCmp + 1;           #siiw0202#nCmp# = #siiw0205#2;
         nCmp = nCmp + 1;           #siiw0202#nCmp# = #siiw0205#6;
         nCmp = nCmp + 1;           #siiw0202#nCmp# = #siiw0205#3;
         nCmp = nCmp + 1;           #siiw0202#nCmp# = #siiw0205#7;
     |SINO;
         #siiw0202#55 = #siiw0202#55 + #siiw0205#5;
         #siiw0202#56 = #siiw0205#2;
         #siiw0202#57 = #siiw0202#57 + #siiw0205#6;
     |FINSI;

     #siiw0202#59 = #siiw0202#59 + (#siiw0205#8 % nPro);
|FPRC;

|DEFBUCLE siiw0205R;
     #siiw0205#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, siiw0205R;
|FIN;

|PROCESO ImportaRecibidas;
     |LEE 000#siiw0202.u;
     |SI FSalida ! 0;
         #siiw0202#0 = 0;
     |FINSI;

     nReg = #siiw0202#0 + 1;

     |DDEFECTO #siiw0202;
     #siiw0202#0   = nReg;
     #siiw0202#1   = #siim0001#2;
     #siiw0202#2   = #siiz0030#0;
     #siiw0202#3   = #siiz0030#1;
     #siiw0202#4   = "R";
     #siiw0202#5   = #camaniva#22;
     #siiw0202#6   = #camaniva#4;
     #siiw0202#7   = #camaniva#41;
     #siiw0202#8   = #camaniva#8;

     |SI #caivaasi#190 = "S";
         #siiw0202#8 = ~;
     |FINSI;

     |HAZ IdentFiscal;

     #siiw0202#9  = aIdenPais;
     #siiw0202#10 = #camaniva#14;

     eaCodNif = #camaniva#14;
     aNom     = #camaniva#13;
     |HAZ BuscaNombre;
     #siiw0202#11 = aNom;
     #siiw0202#12 = aPais;

     |SI aIdenPais ! "1";
         |QBF aPais;
         |SI aPais = "GR";  aPais = "EL";  |FINSI;

         #siiw0202#13 = aPais + #camaniva#14;
     |FINSI;

     #siiw0202#14  = #casiim01#3;
     #siiw0202#15  = #casiim01#4;
     #siiw0202#16  = #casiim01#5;
     #siiw0202#17  = #casiim01#6;
     #siiw0202#18  = #camaniva#44;

     nConta = 0;
     |BUCLE siiw0205R;

     #siiw0202#60  = #casiim01#13;
     #siiw0202#61  = #casiim01#15;
     #siiw0202#62  = #casiim01#16;
     #siiw0202#63  = #casiim01#17;
     #siiw0202#64  = #casiim01#18;
     #siiw0202#65  = #casiim01#14;
     #siiw0202#66  = #casiim01#49;

     #siiw0202#87  = #casiim01#67;
     #siiw0202#88  = #casiim01#69;
     #siiw0202#89  = #casiim01#70;
     #siiw0202#90  = #casiim01#71;
     #siiw0202#91  = #casiim01#72;

     #siiw0202#200 = #siim0001#0;
     #siiw0202#201 = #canempre#3;
     #siiw0202#202 = #camaniva#0;
     #siiw0202#203 = #camaniva#1;

     |GRABA 020#siiw0202.n;
     |LIBERA #siiw0202;
|FPRC;

|PROCESO siim0003;
     #siim0002#0 = #siim0003#0;
     #siim0002#1 = #siim0003#1;
     |LEE 000#siim0002.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |SI #siim0002#21 = "M";
         aAlfa = ("00" + #siim0002#5) % -102;
     |SINO;
         aAlfa = #siim0002#5 + "T";
     |FINSI;

     |SI aAlfa ! #siiz0030#1;
         |ACABA;
     |FINSI;

     nOk = 0;

     |SI #siim0003#103 ! "C";  |Y #siim0003#103 ! "A";
         |ACABA;
     |FINSI;

     |SI #siiw0201#5 ! #siim0003#19;
      |O #siiw0201#6 ! #siim0003#21;
      |O #siiw0201#9 ! #siim0003#15;
         nOk = 1;
     |FINSI;
|FPRC;

|DEFBUCLE siim0003;
     #siim0003#4;
     ;
     nEmpSII, #siiz0030#0, nPer, #camaniva#0, #camaniva#1, "",          0,      0;
     nEmpSII, #siiz0030#0, nPer, #camaniva#0, #camaniva#1, "", 9999999999, 999999;
     ;
     NULL, siim0003;
|FIN;

|PROCESO siim0004;
     #siim0002#0 = #siim0004#0;
     #siim0002#1 = #siim0004#1;
     |LEE 000#siim0002.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |SI #siim0002#21 = "M";
         aAlfa = ("00" + #siim0002#5) % -102;
     |SINO;
         aAlfa = #siim0002#5 + "T";
     |FINSI;

     |SI aAlfa ! #siiz0030#1;
         |ACABA;
     |FINSI;

     nOk = 0;

     |SI #siim0004#78 ! "C";  |Y #siim0004#78 ! "A";
         |ACABA;
     |FINSI;

     |SI #siiw0202#5  ! #siim0004#14;
      |O #siiw0202#6  ! #siim0004#16;
      |O #siiw0202#10 ! #siim0004#10;
         nOk = 1;
     |FINSI;
|FPRC;

|DEFBUCLE siim0004;
     #siim0004#5;
     ;
     nEmpSII, #siiz0030#0, nPer, #camaniva#0, #camaniva#1, "",          0,      0;
     nEmpSII, #siiz0030#0, nPer, #camaniva#0, #camaniva#1, "", 9999999999, 999999;
     ;
     NULL, siim0004;
|FIN;

|PROCESO camaniva;
     #casiim01#0 = "camaniva";
     #casiim01#1 = #camaniva#0;
     #casiim01#2 = #camaniva#1;
     |LEE 000#casiim01.=;
     |SI FSalida = 0;
         |SI #casiim01#3 = "XX";
             |SI PARAMETRO = "UNAUNA";
                |MENAV "0000El registro de IVA no es importable al SII";
             |FINSI;

             |ACABA;
         |FINSI;
     |FINSI;

     |SI #camaniva#5 < nDPer;  |O #camaniva#5 > nHPer;
         |SI PARAMETRO = "UNAUNA";
             |MENAV "0000El periodo del registro no coincide con el del lote";
         |FINSI;

         |ACABA;
     |FINSI;

     |SI #camaniva#36 ! "R";  |Y #camaniva#36 ! "S";
         |SI PARAMETRO = "UNAUNA";
             |MENAV "0000El registro no es de IVA";
         |FINSI;

         |ACABA;
     |FINSI;

     |SI #camaniva#36 = "R";
         |HAZ IdentFactura;
         #siiw0201#9 = #camaniva#14;
         #siiw0201#6 = #camaniva#4;

         nOk = 1;
         |BUCLE siim0003;
         |SI nOk = 0;
             |SI PARAMETRO = "UNAUNA";
                 |MENAV "0000Se cancela la importaci¢n, el registro ya est  importado.";
             |FINSI;

             |ACABA;
         |FINSI;
     |FINSI;

     |SI #camaniva#36 = "S";
         #siiw0202#5   = #camaniva#22;
         #siiw0202#10  = #camaniva#14;
         #siiw0202#6   = #camaniva#4;
         nOk = 1;
         |BUCLE siim0004;
         |SI nOk = 0;
             |SI PARAMETRO = "UNAUNA";
                 |MENAV "0000Se cancela la importaci¢n, el registro ya est  importado.";
             |FINSI;

             |ACABA;
         |FINSI;

         nActiv      = 1;
         |SI #camaniva#10 ! "  ";
              nActiv = #camaniva#10;
         |FINSI;

         nPro = 100;

         #siim0055#0 = #siiz0030#0;
         #siim0055#1 = #siim0001#2;
         |LEE 000#siim0055.=;
         |SI FSalida = 0;
             nPro = #siim0055#3;
         |SINO;
             #dsmom086#0 = nEmp;
             #dsmom086#1 = #siiz0030#0;
             #dsmom086#2 = nActiv;
             |LEE 000#dsmom086.=;
             |SI FSalida = 0;
                 nPro = #dsmom086#5;
             |FINSI;
         |FINSI;
     |FINSI;

     #dsmom030#0 = #camaniva#27;
     |LEE 001#dsmom030.=;
     |SI FSalida ! 0;  |DDEFECTO #dsmom030;  |FINSI;

     nGrupo    = 0;
     nSubGrupo = 0;
     |SI #dsmom030#36 ! 0;  nGrupo = 6;  nSubGrupo = #dsmom030#36;  |FINSI;
     |SI #dsmom030#34 ! 0;  nGrupo = 5;  nSubGrupo = #dsmom030#34;  |FINSI;
     |SI #dsmom030#32 ! 0;  nGrupo = 4;  nSubGrupo = #dsmom030#32;  |FINSI;
     |SI #dsmom030#30 ! 0;  nGrupo = 3;  nSubGrupo = #dsmom030#30;  |FINSI;
     |SI #dsmom030#28 ! 0;  nGrupo = 2;  nSubGrupo = #dsmom030#28;  |FINSI;
     |SI #dsmom030#26 ! 0;  nGrupo = 1;  nSubGrupo = #dsmom030#26;  |FINSI;

     aFicTmp = "siiw0205" + Usuario;  |NOME_DAT #siiw0205#aFicTmp#;
     |ABRE #siiw0205;  |CIERRA #siiw0205;  |DELINDEX #siiw0205;

     nConta = 0;
     nPas   = 0;
     |BUCLE caivalin;

     |SI #camaniva#36 = "S";
         nConta = 0;
     |FINSI;

     nOk = 1;

     #casiim01#0 = "camaniva";
     #casiim01#1 = #camaniva#0;
     #casiim01#2 = #camaniva#1;
     |LEE 000#casiim01.=;
     |SI FSalida ! 0;  nOk = 0;  |FINSI;

     |SI FSalida = 0;
         |SI nConta > 1;  |Y #casiim01#51 = 0;
             nOk = 0;
         |FINSI;
     |FINSI;

     |SI nOk = 0;
         eaSiiPro = "camaniva";
         enSiiLib = #camaniva#0;
         enSiiDoc = #casiim01#2;

         |CIERRA #casiim01;

||         aAlfa = ":contagen/casiim01 canempr1 " + (("00000" + #canempre#2) % -105) + #canempre#3 + ";DEFECTOS";
         aAlfa = ":contagen/casiim01;DEFECTOS_SII";
         |SUB_EJECUTA aAlfa;

         |PATH_DAT #casiim01#eaPathConSII#;

         |ABRE #casiim01;
         #casiim01#0 = "camaniva";
         #casiim01#1 = #camaniva#0;
         #casiim01#2 = #camaniva#1;
         |LEE 000#casiim01.=;
         |SI FSalida ! 0;  |DDEFECTO #casiim01;  |FINSI;
     |FINSI;

     nPas = 1;
     |ABRE #siiw0205;
     |BUCLE caivalin;
     |CIERRA #siiw0205;

     |SI #camaniva#36 = "R";
         |HAZ ImportaEmitidas;
     |FINSI;

     |SI #camaniva#36 = "S";
         |HAZ ImportaRecibidas;
     |FINSI;

     |DELINDEX #siiw0205;
|FPRC;

|DEFBUCLE camaniva;
     #camaniva#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, camaniva;
|FIN;

|PROCESO BuscaRegCanempre;
     |SELECT #4#canempre;
     #canempre#2  = nEmp;
     #canempre#26 = nEje;
     |LEE 000#canempre.=;
     |SI FSalida = 0;
         |SI #canempre#11 = 1;
             nOk = 1;  |ACABA;
         |FINSI;

         |SI nHPer ] #canempre#11;
             nOk = 1;  |ACABA;
         |FINSI;
     |FINSI;

     #canempre#2  = nEmp;
     #canempre#26 = nEje - 1;
     |LEE 000#canempre.=;
     |SI FSalida = 0;
         |SI #canempre#11 = 1;
             |ACABA;
         |FINSI;

         |SI nHPer [ #canempre#12;
             nOk = 1;  |ACABA;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO siim0001OTP;
     |SELECT #4#siim0101;
     #siim0101#5 = #siim0001#0;
     |LEE 000#siim0101.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     eaPathConSII = "/u/" + #siim0101#0 + "/contagen/fich/";
     eaPathBasSII = "/u/" + #siim0101#0 + "/basica/fich/";
     eaPathModSII = "/u/" + #siim0101#0 + "/modelos/fich/";
     |PATH_DAT #canempre#eaPathConSII#;

     nOk  = 0;
     nEmp = #siim0101#1;

     |ABRE #canempre;
     |HAZ BuscaRegCanempre;
     |CIERRA #canempre;

     |SI nOk = 0;  |ACABA;  |FINSI;

     eaPathConSII = eaPathConSII + (("00000" + #canempre#2) % -105) + #canempre#3 + "/";

     |PATH_DAT #caivaasi#eaPathConSII#;
     |PATH_DAT #camaniva#eaPathConSII#;
     |PATH_DAT #caivalin#eaPathConSII#;
     |PATH_DAT #caclipro#eaPathConSII#;
     |PATH_DAT #casiim01#eaPathConSII#;
     |PATH_DAT #casiim02#eaPathConSII#;
     |PATH_DAT #caerpnif#eaPathConSII#;

     |ABRE #caivaasi;
     |LEE 000#caivaasi.p;
     |SI FSalida ! 0;  |DDEFECTO #caivaasi;  |FINSI;
     |CIERRA #caivaasi;

     |ABRE #caclipro;
     |ABRE #dsmom030;
     |ABRE #dsmom086;
     |ABRE #caerpnif;
     |ABRE #casiim01;
     |ABRE #canempre;

     nEmpSII = #siim0101#5;
     |BUCLE camaniva;

     |CIERRA #caclipro;
     |CIERRA #dsmom030;
     |CIERRA #dsmom086;
     |CIERRA #siim0055;
     |CIERRA #caerpnif;
     |CIERRA #casiim01;
     |CIERRA #canempre;
|FPRC;

|PROCESO siim0001;
     |SI enOTP = 1;
         |HAZ siim0001OTP;
         |ACABA;
     |FINSI;

     |SI enAccPNT ! 0;
         enEmpPNT = #siim0001#0;
         |HAZ EmpresaPNT;
         |SI enErrPNT = 1;  |ACABA;  |FINSI;
     |FINSI;

     nOk     = 0;
     nEmp    = #siim0001#0;
     nEmpSII = #siim0001#0;

     |ABRE #canempre;
     |HAZ BuscaRegCanempre;
     |CIERRA #canempre;

     |SI nOk = 0;  |ACABA;  |FINSI;

     |DBASS aPath;
     eaPathConSII = aPath + "contagen/fich/";
     eaPathConSII = eaPathConSII + (("00000" + #canempre#2) % -105) + #canempre#3 + "/";

     |PATH_DAT #caivaasi#eaPathConSII#;
     |PATH_DAT #camaniva#eaPathConSII#;
     |PATH_DAT #caivalin#eaPathConSII#;
     |PATH_DAT #caclipro#eaPathConSII#;
     |PATH_DAT #casiim01#eaPathConSII#;
     |PATH_DAT #casiim02#eaPathConSII#;
     |PATH_DAT #caerpnif#eaPathConSII#;

     |ABRE #caivaasi;
     |LEE 000#caivaasi.p;
     |SI FSalida ! 0;  |DDEFECTO #caivaasi;  |FINSI;
     |CIERRA #caivaasi;

     |ABRE #caclipro;
     |ABRE #dsmom030;
     |ABRE #dsmom086;
     |ABRE #caerpnif;
     |ABRE #casiim01;
     |ABRE #canempre;

     |BUCLE camaniva;

     |CIERRA #caclipro;
     |CIERRA #dsmom030;
     |CIERRA #dsmom086;
     |CIERRA #siim0055;
     |CIERRA #caerpnif;
     |CIERRA #casiim01;
     |CIERRA #canempre;
|FPRC;

|DEFBUCLE siim0001;
     #siim0001#3;
     5;
     "S", 00001, aPer;
     "S", 99999, aPer;
     ;
     NULL, siim0001;
|FIN;

|PROCESO AbreVtn0;
     |VENTANA 0501, 1040, -1, 16, "Importaci¢n contagen";
     n0Vent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n0Vent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PTEC 802;  |PAUSA;
|FPRC;

|PROCESO CierraVtn0;
     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n0Vent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA n0Vent;
|FPRC;

|PROCESO AbreVtn1;
     |VENTANA 0501, 1040, -1, 16, "Realizando la importaci¢n";
     n1Vent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PTEC 802;  |PAUSA;
|FPRC;

|PROCESO CierraVtn1;
     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA n1Vent;
|FPRC;

|PROCESO Importa;
     |CONFI "0000NSeguro que quiere realizar la importaci¢n en estos momentos";
     |SI FSalida ! 0;
         |ACABA;
     |FINSI;

     |HAZ AbreVtn1;

     nEje = #siiz0030#0 - 2000;

     |DBASS aPath;
     eaPathBasSII = aPath + "basica/fich/";
     eaPathModSII = aPath + "modelos/fich/";
     eaPathConSII = aPath + "contagen/fich/";

     aFicTmp = "siiw0201" + Usuario;  |NOME_DAT #siiw0201#aFicTmp#;
     |ABRE #siiw0201;  |CIERRA #siiw0201;  |DELINDEX #siiw0201;

     aFicTmp = "siiw0202" + Usuario;  |NOME_DAT #siiw0202#aFicTmp#;
     |ABRE #siiw0202;  |CIERRA #siiw0202;  |DELINDEX #siiw0202;

                               aPer = "M";
     |SI  #siiz0030#1 = "1T";  aPer = "T";  |FINSI;
     |SI  #siiz0030#1 = "2T";  aPer = "T";  |FINSI;
     |SI  #siiz0030#1 = "3T";  aPer = "T";  |FINSI;
     |SI  #siiz0030#1 = "4T";  aPer = "T";  |FINSI;

     |ABRE #siiw0201;
     |ABRE #siiw0202;
     |BUCLE siim0001;
     |CIERRA #canempre;

     |LEE 000#siiw0201.p;  nHay201 = FSalida;
     |LEE 000#siiw0202.p;  nHay202 = FSalida;

     |CIERRA #siiw0201;
     |CIERRA #siiw0202;

     |HAZ CierraVtn1;

     |SI nHay201 ! 0;
         |MENAV "0000No hay registros a importar en expedidas";
     |SINO;
         |SUB_EJECUTA "siiz0022;CONTAGEN";
     |FINSI;

     |SI nHay202 ! 0;
         |MENAV "0000No hay registros a importar en recibidas";
     |SINO;
         |SUB_EJECUTA "siiz0023;CONTAGEN";
     |FINSI;

     |DELINDEX #siiw0201;
     |DELINDEX #siiw0202;
|FPRC;

|PROCESO Select;
     nOk = 1;
     |SI FSalida ! 0;
         |CONFI "0000NQuiere cancelar la selecci¢n";
         |SI FSalida = 0;
             nOk   = 0;
             enSiiDoc = 0;
         |FINSI;
         |ACABA;
     |FINSI;

     |SI eaTip = "11";
         |SI #camaniva#36 ! "R";
             |MENAV "0000No coincide el tipo de IVA con el tipo de LOTE";
             |ACABA;
         |FINSI;
     |FINSI;

     |SI eaTip = "21";
         |SI #camaniva#36 ! "S";
             |MENAV "0000No coincide el tipo de IVA con el tipo de LOTE";
             |ACABA;
         |FINSI;
     |FINSI;

     |CONFI "0000SImportamos el registro";
     |SI FSalida = 0;
         enSiiLib = #camaniva#0;
         enSiiDoc = #camaniva#1;
         nOk   = 0;
     |FINSI;
|FPRC;

|PROCESO LeeRegisOTP;
     |SELECT #4#siim0101;
     #siim0101#5 = #siim0001#0;
     |LEE 000#siim0101.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     eaPathConSII = "/u/" + #siim0101#0 + "/contagen/fich/";
     eaPathBasSII = "/u/" + #siim0101#0 + "/basica/fich/";
     eaPathModSII = "/u/" + #siim0101#0 + "/modelos/fich/";
     |PATH_DAT #canempre#eaPathConSII#;

     nOk  = 0;
     nEmp = #siim0101#1;

     |ABRE #canempre;
     |HAZ BuscaRegCanempre;
     |CIERRA #canempre;

     |SI nOk = 0;  |ACABA;  |FINSI;

     eaPathConSII = eaPathConSII + (("00000" + #canempre#2) % -105) + #canempre#3 + "/";

     |PATH_DAT #caivaasi#eaPathConSII#;
     |PATH_DAT #camaniva#eaPathConSII#;
     |PATH_DAT #caivalin#eaPathConSII#;
     |PATH_DAT #caclipro#eaPathConSII#;
     |PATH_DAT #casiim01#eaPathConSII#;
     |PATH_DAT #casiim02#eaPathConSII#;
     |PATH_DAT #caerpnif#eaPathConSII#;

     |ABRE #caivaasi;
     |LEE 000#caivaasi.p;
     |SI FSalida ! 0;  |DDEFECTO #caivaasi;  |FINSI;
     |CIERRA #caivaasi;

     |ABRE #caclipro;
     |ABRE #dsmom030;
     |ABRE #dsmom086;
     |ABRE #caerpnif;
     |ABRE #casiim01;
     |ABRE #canempre;

     enSiiDoc = 0;
     |ABRE #camaniva;
     |PARA;  |SI;  |HACIENDO;
          |CONSULTA_CLAVE #1#camaniva;
          |HAZ Select;
          |SI nOk = 0;  |SAL;  |FINSI;
     |SIGUE;

     |SI enSiiDoc ! 0;
         #camaniva#0 = enSiiLib;
         #camaniva#1 = enSiiDoc;
         |LEE 000#camaniva.=;
         |SI FSalida = 0;
             |HAZ camaniva;
         |FINSI;
     |FINSI;

     |CIERRA #camaniva;
     |CIERRA #caclipro;
     |CIERRA #dsmom030;
     |CIERRA #dsmom086;
     |CIERRA #siim0055;
     |CIERRA #caerpnif;
     |CIERRA #casiim01;
     |CIERRA #canempre;
|FPRC;

|PROCESO LeeRegis;
     |SI enOTP = 1;
         |HAZ LeeRegisOTP;
         |ACABA;
     |FINSI;

     nOk  = 0;
     nEmp = #siim0001#0;

     |ABRE #canempre;
     |HAZ BuscaRegCanempre;
     |CIERRA #canempre;

     |SI nOk = 0;  |ACABA;  |FINSI;

     |DBASS aPath;
     eaPathConSII = aPath + "contagen/fich/";
     eaPathConSII = eaPathConSII + (("00000" + #canempre#2) % -105) + #canempre#3 + "/";

     |PATH_DAT #caivaasi#eaPathConSII#;
     |PATH_DAT #camaniva#eaPathConSII#;
     |PATH_DAT #caivalin#eaPathConSII#;
     |PATH_DAT #caclipro#eaPathConSII#;
     |PATH_DAT #casiim01#eaPathConSII#;
     |PATH_DAT #casiim02#eaPathConSII#;
     |PATH_DAT #caerpnif#eaPathConSII#;

     |ABRE #caivaasi;
     |LEE 000#caivaasi.p;
     |SI FSalida ! 0;  |DDEFECTO #caivaasi;  |FINSI;
     |CIERRA #caivaasi;

     |ABRE #canempre;
     |ABRE #caclipro;
     |ABRE #dsmom030;
     |ABRE #dsmom086;
     |ABRE #caerpnif;
     |ABRE #casiim01;

     enSiiDoc = 0;
     |ABRE #camaniva;
     |PARA;  |SI;  |HACIENDO;
          |CONSULTA_CLAVE #1#camaniva;
          |HAZ Select;
          |SI nOk = 0;  |SAL;  |FINSI;
     |SIGUE;

     |SI enSiiDoc ! 0;
         #camaniva#0 = enSiiLib;
         #camaniva#1 = enSiiDoc;
         |LEE 000#camaniva.=;
         |SI FSalida = 0;
             |HAZ camaniva;
         |FINSI;
     |FINSI;

     |CIERRA #camaniva;
     |CIERRA #caclipro;
     |CIERRA #dsmom030;
     |CIERRA #dsmom086;
     |CIERRA #siim0055;
     |CIERRA #caerpnif;
     |CIERRA #casiim01;
     |CIERRA #canempre;
|FPRC;

|PROCESO UnaUna;
     |HAZ AbreVtn1;

     #siim0001#0 = enEmp;
     |LEE 000#siim0001.=;
     |SI FSalida ! 0;  |DDEFECTO #siim0001;  |FINSI;

     #siim0002#0 = enEmp;
     #siim0002#1 = enLot;
     |LEE 000#siim0002.=;
     |SI FSalida ! 0;  |DDEFECTO #siim0002;  |FINSI;

     #siiz0030#0 = enEje;

     |SI #siim0001#5 = "M";
         #siiz0030#1 = ("00" + #siim0002#5) % -102;
     |SINO;
         #siiz0030#1 = #siim0002#5 + "T";
     |FINSI;

     |HAZ CogePeriodos;

     nEje = #siiz0030#0 - 2000;

     |DBASS aPath;
     eaPathBasSII = aPath + "basica/fich/";
     eaPathModSII = aPath + "modelos/fich/";
     eaPathConSII = aPath + "contagen/fich/";

     aFicTmp = "siiw0201" + Usuario;  |NOME_DAT #siiw0201#aFicTmp#;
     |ABRE #siiw0201;  |CIERRA #siiw0201;  |DELINDEX #siiw0201;

     aFicTmp = "siiw0202" + Usuario;  |NOME_DAT #siiw0202#aFicTmp#;
     |ABRE #siiw0202;  |CIERRA #siiw0202;  |DELINDEX #siiw0202;

     |ABRE #siiw0201;
     |ABRE #siiw0202;
     |HAZ LeeRegis;
     |CIERRA #canempre;

     |LEE 000#siiw0201.p;  nHay201 = FSalida;
     |LEE 000#siiw0202.p;  nHay202 = FSalida;

     |CIERRA #siiw0201;
     |CIERRA #siiw0202;

     |HAZ CierraVtn1;

     |SI PARAMETRO = "UNAUNA";
         enLotFor = enLot;
     |FINSI;

     |SI nHay201 = 0;
         |SUB_EJECUTA "siiz0022;CONTAGEN";
     |FINSI;

     |SI nHay202 = 0;
         |SUB_EJECUTA "siiz0023;CONTAGEN";
     |FINSI;

     |DELINDEX #siiw0201;
     |DELINDEX #siiw0202;
|FPRC;

|PROCESO T12;  |TIPO 12;
     |SI FSalida = 7;
         |HAZ CierraVtn0;
         |ACABA;
     |FINSI;

     |SI nOk = 0;
         |ERROR;

         |POSICIONATE #siiz0030#0;
         |ACABA;
     |FINSI;

     |HAZ CierraVtn0;

     |HAZ CogePeriodos;
     |HAZ Importa;
|FPRC;

|PROCESO PonMes;
                              #siiz0030#2 = "";
     |SI #siiz0030#1 = "01";  #siiz0030#2 = "ENERO";       |FINSI;
     |SI #siiz0030#1 = "02";  #siiz0030#2 = "FEBRERO";     |FINSI;
     |SI #siiz0030#1 = "03";  #siiz0030#2 = "MARZO";       |FINSI;
     |SI #siiz0030#1 = "04";  #siiz0030#2 = "ABRIL";       |FINSI;
     |SI #siiz0030#1 = "05";  #siiz0030#2 = "MAYO";        |FINSI;
     |SI #siiz0030#1 = "06";  #siiz0030#2 = "JUNIO";       |FINSI;
     |SI #siiz0030#1 = "07";  #siiz0030#2 = "JULIO";       |FINSI;
     |SI #siiz0030#1 = "08";  #siiz0030#2 = "AGOSTO";      |FINSI;
     |SI #siiz0030#1 = "09";  #siiz0030#2 = "SEPTIEMBRE";  |FINSI;
     |SI #siiz0030#1 = "10";  #siiz0030#2 = "OCTUBRE";     |FINSI;
     |SI #siiz0030#1 = "11";  #siiz0030#2 = "NOVIEMBRE";   |FINSI;
     |SI #siiz0030#1 = "12";  #siiz0030#2 = "DICIEMBRE";   |FINSI;
     |SI #siiz0030#1 = "1T";  #siiz0030#2 = "1 TRIMSTRE";  |FINSI;
     |SI #siiz0030#1 = "2T";  #siiz0030#2 = "2 TRIMSTRE";  |FINSI;
     |SI #siiz0030#1 = "3T";  #siiz0030#2 = "3 TRIMSTRE";  |FINSI;
     |SI #siiz0030#1 = "4T";  #siiz0030#2 = "4 TRIMSTRE";  |FINSI;

     |PINTA #siiz0030#2;
|FPRC;

|PROCESO T0C1z30;  |TIPO 0;
     |HAZ PonMes;

     |SI #siiz0030#2 = "          ";
         |MENAV "0000Periodo incorrecto. ";
         |ERROR;
         |ACABA;
     |FINSI;
|FPRC;

|PROCESO T66C1z30;  |TIPO 66;
     aAlfa = "|C001WID";
     aID   = #siiz0030#aAlfa#;
     nID   = aID;

     aPopup1  = nID;
     aPopup2  = 16;
     aPopup3  = "01-ENERO";
     aPopup4  = "02-FEBRERO";
     aPopup5  = "03-MARZO";
     aPopup6  = "04-ABRIL";
     aPopup7  = "05-MAYO";
     aPopup8  = "06-JUNIO";
     aPopup9  = "07-JULIO";
     aPopup10 = "08-AGOSTO";
     aPopup11 = "09-SEPTIEMBRE";
     aPopup12 = "10-OCTUBRE";
     aPopup13 = "11-NOVIEMBRE";
     aPopup14 = "12-DICIEMBRE";
     aPopup15 = "1T-1 TRIMESTRE";
     aPopup16 = "2T-2 TRIMESTRE";
     aPopup17 = "3T-3 TRIMESTRE";
     aPopup18 = "4T-4 TRIMESTRE";

     IaPopup  = aPopup1  <-;
     |ESPECIFICA "TRACKPOPUP", aPopup;
     |SI FSalida ! 0;
         IaPopup  = aPopup3  <-;
         IaPopup  = IaPopup + (FSalida - 1);

         aAlfa = aPopup % 102;  #siiz0030#1 = aAlfa;
     |FINSI;

     |PINTA #siiz0030#1;
     |HAZ PonMes;
|FPRC;

|PROCESO T0C0z30;  |TIPO 0;
     fFecha = ~;
     aAlfa  = fFecha % -104;  nEje = aAlfa;

     |SI nEje = 2017;
         nDAnyo = nEje;
         nHAnyo = nEje + 1;
     |SINO;
         nDAnyo = nEje - 1;
         nHAnyo = nEje + 1;
     |FINSI;

     |SI #siiz0030#0 < nDAnyo;  |O #siiz0030#0 > nHAnyo;
         aAlfa = "0000El a¤o debe ser mayor o igual a " + nDAnyo;
         aAlfa = aAlfa + " y menor o igual a " + nHAnyo;
         |MENAV aAlfa;
         |ERROR;
     |FINSI;
|FPRC;

|PROCESO T66C0z30;  |TIPO 66;
     fFecha = ~;
     aAlfa  = fFecha % -104;  nEje = aAlfa;

     aAlfa = "|C000WID";
     aID   = #siiz0030#aAlfa#;
     nID   = aID;

     aPopup1  = nID;  || Si fuera -1 en la posicion

     |SI nEje = 2017;
         aPopup2  = 2;
         nAnyo = nEje;      aPopup3  = nAnyo;
         nAnyo = nEje + 1;  aPopup4  = nAnyo;
     |SINO;
         aPopup2  = 3;
         nAnyo = nEje - 1;  aPopup3  = nAnyo;
         nAnyo = nEje;      aPopup4  = nAnyo;
         nAnyo = nEje + 1;  aPopup5  = nAnyo;
     |FINSI;

     IaPopup  = aPopup1  <-;
     |ESPECIFICA "TRACKPOPUP", aPopup;
     |SI FSalida ! 0;
         IaPopup  = aPopup3  <-;
         IaPopup  = IaPopup + (FSalida - 1);

         #siiz0030#0 = aPopup;
     |FINSI;

     |PINTA #siiz0030#0;
|FPRC;

|PROCESO Ptec806;
     |PTEC 806;
     nOk = 1;
|FPRC;

|PROCESO Ptec807;
     |PTEC 807;
     nOk = 0;
|FPRC;

|PROCESO T7C0z30;  |TIPO 7;
     |SI nBtnVal ! -1;
         |ACABA;
     |FINSI;

     aQB = "|X000";
     aID = #siiz0030#aQB#;
     nBt = aID;
     |ESTADO_CONTROL nBt, "HIDE";

     aQB = "|X001";
     aID = #siiz0030#aQB#;
     nBt = aID;
     |ESTADO_CONTROL nBt, "HIDE";

     |CONTROL_SIMPLE 0, "BOTON,{{230}}Ejecutar", 1028, 1038, Ptec806;
     nBtnVal = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{207}}Cancelar", 1013, 1023, Ptec807;
|FPRC;

|PROGRAMA;
     |SI PARAMETRO = "UNAUNA";
         |HAZ UnaUna;
         |ACABA;
     |FINSI;

     |CLS;
     |CABEZA "Importaci¢n contagen";

     |HAZ AbreVtn0;

     fFecha = ~;
     aAlfa  = fFecha % -104;  nEje = aAlfa;
     aAlfa  = fFecha % 402;   nPer = aAlfa;

     |SI nPer > 12;
         nPer = 1;
         nEje = nEje + 1;
     |FINSI;

     |DDEFECTO #siiz0030;

     #siiz0030#0 = nEje;
     #siiz0030#1 = ("00" + nPer) % -102;
     |HAZ PonMes;

     |PINPA #0#siiz0030;
     |PINDA #0#siiz0030;
     |ENDATOS #1#siiz0030;
|FPRO;

|PROCESO T80;  |TIPO 80;
     |HAZ EsPNT;

     eaPrograma   = "GRUPOOTP";
     |HAZ SIIBASE_INI;
     |SI enAprobacion = 1;
         enOTP = 1;
     |FINSI;

     |ABRET #siim0001;
     |ABRET #siim0002;
     |ABRET #siim0003;
     |ABRET #siim0004;
     |ABRET #siim0007;
     |ABRET #siim0008;
     |ABRET #siim0055;
     |ABRET #siim0101;
|FPRC;

|PROCESO T90;  |TIPO 90;
     enLotFor = 0;

     |CIERRAT #siim0001;
     |CIERRAT #siim0002;
     |CIERRAT #siim0003;
     |CIERRAT #siim0004;
     |CIERRAT #siim0007;
     |CIERRAT #siim0008;
     |CIERRAT #siim0055;
     |CIERRAT #siim0101;

     |PULSATECLA;
     |PULSATECLA;
     |PULSATECLA;
     |PTEC 802;  |PAUSA;
     |PULSATECLA;
     |PULSATECLA;
     |PULSATECLA;
|FPRC;

|PROCESO Camaniva_15;
|FPRC;

|PROCESO Camaniva_16;
|FPRC;

|PROCESO Camaniva_17;
|FPRC;

|PROCESO T15man;
|FPRC;

|PROCESO T16man;
|FPRC;

|PROCESO T17man;
|FPRC;
