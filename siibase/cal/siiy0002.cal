|FICHEROS;
     siiy0002;

     siim0001;
     siim0002;
     siim0003;
     siim0004;

     siiw0208;
|FIN;

|VARIABLES;
     n0Vent              = 0;
     nCmpGet             = 0;
     nDEmp               = 0;
     nHEmp               = 0;
     nOk                 = 0;
     nReg                = 0;
     nLot                = 0;
     nID                 = 0;

     aID                 = "";
     aMes                = "";
     aAlfa               = "";
     aDef                = "";
     aMas                = "";
     aIden               = "";
     aNif                = "";
     aFicTmp             = "";
     aFicConta           = "";
     aPathConta          = "";

 {20}aPopup              = "";

 {-1}aGet                = 0;
     aGet1               = 0;
     aGet2               = 0;

     fFecha              = @;

     &enEje              = 0;
     &enPer              = 0;
     &enDPer             = 0;
     &enHPer             = 0;
     &eaPaq              = "";
     &enAccPNT           = 0;
     &enEmpPNT           = 0;
     &enErrPNT           = 0;
|FIN;

|PROCESO siim0003_4;
     #siim0002#0 = #siim0003#0;
     #siim0002#1 = #siim0003#1;
     |LEE 000#siim0002.=;
     |SI FSalida ! 0;  |DDEFECTO #siim0002;  |FINSI;

     nReg = 0;
     |SELECT #3#siiw0208;
     #siiw0208#0  = #siim0001#0;
     #siiw0208#17 = #siim0003#21;
     #siiw0208#16 = #siim0003#19;
     |LEE 000#siiw0208.=;
     |SI FSalida = 0;
         nReg = #siiw0208#1;
     |FINSI;

     |DDEFECTO #siiw0208;
     |SELECT #1#siiw0208;

     |SI nReg = 0;
         |SI #siim0003#111 = "S";
             |ACABA;
         |FINSI;

         #siiw0208#0 = #siim0001#0;
         #siiw0208#1 = 9999999;
         |LEE 000#siiw0208.];
         |SI FSalida = 0;
             |LEE 000#siiw0208.a;
         |SINO;
             |LEE 000#siiw0208.u;
         |FINSI;

         nReg = 1;
         |SI FSalida = 0;  |Y  #siiw0208#0 = #siim0001#0;
             nReg = #siiw0208#1 + 1;
         |FINSI;

         |DDEFECTO #siiw0208;
         #siiw0208#0  = #siim0001#0;
         #siiw0208#1  = nReg;
         #siiw0208#5  = "R";
         #siiw0208#9  = "01.01.0000";

         |GRABA 020#siiw0208.b;
     |SINO;
         #siiw0208#0  = #siim0001#0;
         #siiw0208#1  = nReg;
         |LEE 101#siiw0208.=;
     |FINSI;

     |SI #siim0003#111 = "S";
         |SI #siiw0208#4 = 0;
             |BORRA 020#siiw0208.a;
         |SINO;
             #siiw0208#12 = 0;
             #siiw0208#13 = 0;
             #siiw0208#14 = "";

             |PDEFECTO #siiw0208, 17, 23;

             |HAZ PonError;
             |GRABA 020#siiw0208.a;
         |FINSI;

         |LIBERA #siiw0208;
         |ACABA;
     |FINSI;

     #siiw0208#12 = #siim0003#1;
     #siiw0208#13 = #siim0003#2;
     #siiw0208#14 = #siim0002#2;
     #siiw0208#15 = #siim0003#15;
     #siiw0208#16 = #siim0003#19;
     #siiw0208#17 = #siim0003#21;
     #siiw0208#18 = "01.01.0000";

     #siiw0208#19 = #siim0003#23 + #siim0003#29 + #siim0003#35;
     #siiw0208#19 = #siiw0208#19 + #siim0003#41 + #siim0003#47;
     #siiw0208#19 = #siiw0208#19 + #siim0003#53;

     #siiw0208#20 = #siim0003#25 + #siim0003#31 + #siim0003#37;
     #siiw0208#20 = #siiw0208#20 + #siim0003#43 + #siim0003#49;
     #siiw0208#20 = #siiw0208#20 + #siim0003#55;
     #siiw0208#20 = #siiw0208#20 + #siim0003#27 + #siim0003#33;
     #siiw0208#20 = #siiw0208#20 + #siim0003#39 + #siim0003#45;
     #siiw0208#20 = #siiw0208#20 + #siim0003#51 + #siim0003#57;

     #siiw0208#21 = #siim0003#103;
     #siiw0208#22 = #siim0003#16;

     |HAZ PonError;

     |GRABA 020#siiw0208.a;
     |LIBERA #siiw0208;
|FPRC;

|DEFBUCLE siim0003_4;
     #siim0003#4;
     ;
     #siim0001#0, #siiy0002#0, enPer, 00,          0, "  ",          0,      0;
     #siim0001#0, #siiy0002#0, enPer, 99, 9999999999, "zz", 9999999999, 999999;
     ;
     NULL, siim0003_4;
|FIN;

|PROCESO siim0004_5;
     #siim0002#0 = #siim0004#0;
     #siim0002#1 = #siim0004#1;
     |LEE 000#siim0002.=;
     |SI FSalida ! 0;  |DDEFECTO #siim0002;  |FINSI;

     nReg = 0;
     |SELECT #2#siiw0208;
     #siiw0208#0  = #siim0001#0;
     #siiw0208#15 = #siim0004#10;
     #siiw0208#16 = #siim0004#14;
     |LEE 000#siiw0208.=;
     |SI FSalida = 0;
         nReg = #siiw0208#1;
     |FINSI;

     |DDEFECTO #siiw0208;
     |SELECT #1#siiw0208;

     |SI nReg = 0;
         |SI #siim0004#86 = "S";
             |ACABA;
         |FINSI;

         |SELECT #1#siiw0208;
         #siiw0208#0 = #siim0001#0;
         #siiw0208#1 = 9999999;
         |LEE 000#siiw0208.];
         |SI FSalida = 0;
             |LEE 000#siiw0208.a;
         |SINO;
             |LEE 000#siiw0208.u;
         |FINSI;

         nReg = 1;
         |SI FSalida = 0;  |Y  #siiw0208#0 = #siim0001#0;
             nReg = #siiw0208#1 + 1;
         |FINSI;

         |DDEFECTO #siiw0208;
         #siiw0208#0  = #siim0001#0;
         #siiw0208#1  = nReg;
         #siiw0208#5  = "S";
         #siiw0208#9  = "01.01.0000";

         |GRABA 020#siiw0208.b;
     |SINO;
         #siiw0208#0  = #siim0001#0;
         #siiw0208#1  = nReg;
         |LEE 101#siiw0208.=;
     |FINSI;

     |SI #siim0004#86 = "S";
         |SI #siiw0208#4 = 0;
             |BORRA 020#siiw0208.a;
         |SINO;
             #siiw0208#12 = 0;
             #siiw0208#13 = 0;
             #siiw0208#14 = "";

             |PDEFECTO #siiw0208, 17, 23;

             |HAZ PonError;
             |GRABA 020#siiw0208.a;
         |FINSI;

         |LIBERA #siiw0208;
         |ACABA;
     |FINSI;

     #siiw0208#12 = #siim0004#1;
     #siiw0208#13 = #siim0004#2;
     #siiw0208#14 = #siim0002#2;
     #siiw0208#15 = #siim0004#10;
     #siiw0208#16 = #siim0004#14;
     #siiw0208#17 = #siim0004#16;
     #siiw0208#18 = #siim0004#17;

     #siiw0208#19 = #siim0004#20 + #siim0004#27 + #siim0004#34;
     #siiw0208#19 = #siiw0208#19 + #siim0004#41 + #siim0004#48;
     #siiw0208#19 = #siiw0208#19 + #siim0004#55 + #siim0004#61;

     #siiw0208#20 = #siim0004#22 + #siim0004#29 + #siim0004#36;
     #siiw0208#20 = #siiw0208#20 + #siim0004#43 + #siim0004#50;
     #siiw0208#20 = #siiw0208#20 + #siim0004#57 + #siim0004#63;
     #siiw0208#20 = #siiw0208#20 + #siim0004#24 + #siim0004#31;
     #siiw0208#20 = #siiw0208#20 + #siim0004#38 + #siim0004#45;
     #siiw0208#20 = #siiw0208#20 + #siim0004#52 + #siim0004#59;

     #siiw0208#21 = #siim0004#78;
     #siiw0208#22 = #siim0004#11;

     |HAZ PonError;

     |GRABA 020#siiw0208.a;
     |LIBERA #siiw0208;
|FPRC;

|DEFBUCLE siim0004_5;
     #siim0004#5;
     ;
     #siim0001#0, #siiy0002#0, enPer, 00,          0, "  ",          0,      0;
     #siim0001#0, #siiy0002#0, enPer, 99, 9999999999, "zz", 9999999999, 999999;
     ;
     NULL, siim0004_5;
|FIN;

|PROCESO siim0001;
     enEje = #siiy0002#0 - 2000;

     |SI eaPaq = "BASICA";
         |HAZ RecogeContagen;
     |FINSI;

     |SI eaPaq = "AGICLI";
         |HAZ RecogeAgicont;
     |FINSI;

     |BUCLE siim0003_4;
     |BUCLE siim0004_5;
|FPRC;

|DEFBUCLE siim0001;
     #siim0001#1;
     4;
     nDEmp, "S";
     nHEmp, "S";
     ;
     NULL, siim0001;
|FIN;

|PROCESO siiw0208;
     #siim0001#0 = #siiw0208#0;
     |LEE 000#siim0001.=;

     |PRINT;
|FPRC;

|DEFBUCLE siiw0208;
     #siiw0208#1;
     23;
         0,       0, 1;
     99999, 9999999, 99;
     ;
     NULL, siiw0208;
|FIN;

|PROCESO T12;  |TIPO 12;
     |SI FSalida = 7;  |ACABA;  |FINSI;

     |REFERENCIA_DEF aGet1, #siiy0002;
     |PARA nCmpGet = 0;  |SI nCmpGet [ 3;  |HACIENDO nCmpGet = nCmpGet + 1;
           aGet2 = nCmpGet;
           IaGet = aGet1<-;
           |ESPECIFICA "GETDATACONTROL", aGet;
           #siiy0002#nCmpGet# = FSalida;
     |SIGUE;

     nDEmp = #siiy0002#2;
     nHEmp = #siiy0002#2;
     |SI #siiy0002#2 = 0;
         nDEmp = 1;
         nHEmp = 99999;
     |FINSI;

     enPer  = #siiy0002#1;
     enDPer = #siiy0002#1;
     enHPer = #siiy0002#1;

     |SI #siiy0002#1 = "1T";  enDPer = 01;  enHPer = 03;  enPer = 1;  |FINSI;
     |SI #siiy0002#1 = "2T";  enDPer = 04;  enHPer = 06;  enPer = 2;  |FINSI;
     |SI #siiy0002#1 = "3T";  enDPer = 07;  enHPer = 09;  enPer = 3;  |FINSI;
     |SI #siiy0002#1 = "4T";  enDPer = 10;  enHPer = 12;  enPer = 4;  |FINSI;

     aFicTmp = "siiw0208" + Usuario;
     |NOME_DAT #siiw0208#aFicTmp#;
     |ABRE #siiw0208;  |CIERRA #siiw0208;  |DELINDEX #siiw0208;

     |ABRET #siiw0208;
     |BUCLE siim0001;
     |LEE 000#siiw0208.p;
     |SI FSalida ! 0;
         |CIERRAT #siiw0208;  |DELINDEX #siiw0208;

         |MENAV "0000Selecci¢n vac¡a.";

         |ACABA;
     |FINSI;

     Impresora = "CrystalReport";
     |IMPRE -1;
     |SI FSalida ! 0;
         |MENAV "0000Proceso cancelado";
         |ACABA;
     |FINSI;

     |INFOR "y000201";
     |SI FSalida ! 0;
         |MENAV "0000No encuento el informe rpt. Pongase en contacto con su administrador";

         |FINIMP;
         |ACABA;
     |FINSI;

     |BUCLE siiw0208;

     |PIEINF;
     |FININF;
     |FINIMP;

     |CIERRAT #siiw0208;  |DELINDEX #siiw0208;
|FPRC;

|PROCESO T0C1y2;  |TIPO 0;
                              aMes = "";
     |SI #siiy0002#1 = "01";  aMes = "ENERO";       |FINSI;
     |SI #siiy0002#1 = "02";  aMes = "FEBRERO";     |FINSI;
     |SI #siiy0002#1 = "03";  aMes = "MARZO";       |FINSI;
     |SI #siiy0002#1 = "04";  aMes = "ABRIL";       |FINSI;
     |SI #siiy0002#1 = "05";  aMes = "MAYO";        |FINSI;
     |SI #siiy0002#1 = "06";  aMes = "JUNIO";       |FINSI;
     |SI #siiy0002#1 = "07";  aMes = "JULIO";       |FINSI;
     |SI #siiy0002#1 = "08";  aMes = "AGOSTO";      |FINSI;
     |SI #siiy0002#1 = "09";  aMes = "SEPTIEMBRE";  |FINSI;
     |SI #siiy0002#1 = "10";  aMes = "OCTUBRE";     |FINSI;
     |SI #siiy0002#1 = "11";  aMes = "NOVIEMBRE";   |FINSI;
     |SI #siiy0002#1 = "12";  aMes = "DICIEMBRE";   |FINSI;
     |SI #siiy0002#1 = "1T";  aMes = "1 TRIMSTRE";  |FINSI;
     |SI #siiy0002#1 = "2T";  aMes = "2 TRIMSTRE";  |FINSI;
     |SI #siiy0002#1 = "3T";  aMes = "3 TRIMSTRE";  |FINSI;
     |SI #siiy0002#1 = "4T";  aMes = "4 TRIMSTRE";  |FINSI;

     |SI aMes = "";
         |MENAV "0000Periodo incorrecto. ";
         |ERROR;
         |ACABA;
     |FINSI;
|FPRC;

|PROCESO T66C1y2;  |TIPO 66;
     aAlfa = "|C001WID";
     aID   = #siiy0002#aAlfa#;
     nID   = aID;

     aPopup1  = nID;
     aPopup2  = 16;
     aPopup3  = "01-ENERO";
     aPopup4  = "02-FEBRERO";
     aPopup5  = "03-MARZO";
     aPopup6  = "04-ABRIL";
     aPopup7  = "05-MAYO";
     aPopup8  = "06-JUNIO";
     aPopup9  = "07-JULIO";
     aPopup10 = "08-AGOSTO";
     aPopup11 = "09-SEPTIEMBRE";
     aPopup12 = "10-OCTUBRE";
     aPopup13 = "11-NOVIEMBRE";
     aPopup14 = "12-DICIEMBRE";
     aPopup15 = "1T-1 TRIMESTRE";
     aPopup16 = "2T-2 TRIMESTRE";
     aPopup17 = "3T-3 TRIMESTRE";
     aPopup18 = "4T-4 TRIMESTRE";

     IaPopup  = aPopup1  <-;
     |ESPECIFICA "TRACKPOPUP", aPopup;
     |SI FSalida ! 0;
         IaPopup  = aPopup3  <-;
         IaPopup  = IaPopup + (FSalida - 1);

         aAlfa = aPopup % 102;  #siiy0002#1 = aAlfa;
     |FINSI;

     |PINTA #siiy0002#1;
|FPRC;

|PROCESO T0C2y2;  |TIPO 0;
     |SI #siiy0002#2 = 0;
         #siiy0002#3 = "Todas las empresas";

         |PINTA #siiy0002#3;
         |ACABA;
     |FINSI;

     #siim0001#0 = #siiy0002#2;
     |LEE 000#siim0001.=;
     |SI FSalida ! 0;
         |MENAV "0000La empresa no est  en la bandeja";
         |ERROR;
         |ACABA;
     |FINSI;

     #siiy0002#3 = #siim0001#1;
     |PINTA #siiy0002#3;
|FPRC;

|PROCESO T66C2y2;  |TIPO 66;
     |CONSULTA_CLAVE #1#siim0001;
     |SI FSalida = 0;
         #siiy0002#2 = #siim0001#0;
         #siiy0002#3 = #siim0001#1;

         |PINTA #siiy0002#2;
         |PINTA #siiy0002#3;
     |FINSI;
|FPRC;

|PROGRAMA;
     |CLS;
     |CABEZA "Informe consistencia";

     |VENTANA 0501, 2765, -1, 16, "Informe de consistencia";
     n0Vent = FSalida;

     fFecha = ~;
     aAlfa  = fFecha % -104; #siiy0002#0 = aAlfa;
     aAlfa  = fFecha % 402;  #siiy0002#1 = aAlfa;

     |PINPA #0#siiy0002;
     |PINDA #0#siiy0002;
     |ENDATOS #1#siiy0002;

     |FINVENTANA n0Vent;
|FPRO;

|PROCESO T80;  |TIPO 80;
     |ABRET #siim0001;
     |ABRET #siim0002;
     |ABRET #siim0003;
     |ABRET #siim0004;

     |DDEF aDef;
|FPRC;

|PROCESO T90;  |TIPO 90;
     |CIERRAT #siim0001;
     |CIERRAT #siim0002;
     |CIERRAT #siim0003;
     |CIERRAT #siim0004;
|FPRC;
