|FICHEROS;
     siim0001;
     siim0002;
     siim0003;
     siim0004;
     siim0007;
     siim0008;
     siim0055;

     siiw0201;
     siiw0202;
     siiw0205;

     siiz0031;

     :agicont/canempre;
     :agicont/caclipro;
     :agicont/cacon300;
     :agicont/caivarep;
     :agicont/caivasop;
     :agicont/caivaref;
     :agicont/caivasof;
     :agicont/caivarec;
     :agicont/caivaasi;
     :agicont/casiim01;
     :agicont/casiim02;
|FIN;

|VARIABLES;
     n0Vent              = 0;
     n1Vent              = 0;
     nIdSalir            = 0;
     nOk                 = 0;
     nEje                = 0;
     nEjBus              = 0;
     nPer                = 0;
     nDPer               = 0;
     nHPer               = 0;
     nPerConta           = 0;
     nAnyo               = 0;
     nDAnyo              = 0;
     nHAnyo              = 0;
     nID                 = 0;
     nBtnVal             = -1;
     nBt                 = 0;
     nReg                = 0;
     nGrupo              = 0;
     nSubGrupo           = 0;
     nConta              = 0;
     nCmp                = 0;
     nCmp1               = 0;
     nCmp2               = 0;
     nCmp3               = 0;
     nCmp4               = 0;
     nCmp5               = 0;
     nCmp6               = 0;
     nHay201             = 0;
     nHay202             = 0;
     nIva                = 0;
     nNume               = 0;
     nPas                = 0;
     nLin                = 0;
     nPro                = 0;

     aID                 = "";
     aQB                 = "";
     aAlfa               = "";
     aPathConta          = "";
     aFicConta           = "";
     aFicTmp             = "";
     aClvPais            = "";
     aPais               = "";
     aIdenPais           = "";
     aISP                = "";
     aNombre             = "";
     aUlt                = "";
     aNom                = "";
     aDesglo             = "";
     aNif                = "";
     aFact               = "";
     aPer                = "";

     fFecha              = @;

     {20}aPopup          = "";
     {2}nNivel           = 0;

     {-1}aVent           = "";
         aVent1          = 0;
         aVent2          = 0;
         aVent3          = 0;
         aVent4          = 0;
         aVent5          = "";

     &eaPaisNif          = "";
     &eaCodNif           = "";
     &eaNomNif           = "";
     &enEmp              = 0;
     &enLot              = 0;
     &enLotFor           = 0;
     &eaTip              = "";
     &enEje              = 0;
     &enPer              = 0;
     &enLib              = 0;
     &enDoc              = 0;
     &eaSer              = "";
     &eaSiiPro           = "";
     &enSiiLib           = 0;
     &eaSiiDoc           = "";
|FIN;

|PROCESO CogePeriodos;
     nPer  = #siiz0031#1;
     nDPer = #siiz0031#1;
     nHPer = #siiz0031#1;

     |SI #siiz0031#1 = "1T";  nDPer = 01;  nHPer = 03;  nPer = 1;  |FINSI;
     |SI #siiz0031#1 = "2T";  nDPer = 04;  nHPer = 06;  nPer = 2;  |FINSI;
     |SI #siiz0031#1 = "3T";  nDPer = 07;  nHPer = 09;  nPer = 3;  |FINSI;
     |SI #siiz0031#1 = "4T";  nDPer = 10;  nHPer = 12;  nPer = 4;  |FINSI;
|FPRC;

|PROCESO BuscaNombre;
     |QBF eaCodNif;
     |SI eaCodNif = "";  |ACABA;  |FINSI;

     |HAZ LeeNif;
     |SI eaNomNif ! "";
         aNom = eaNomNif;
     |FINSI;
|FPRC;

|| Expedidas ------------------------------------------------------------

|PROCESO AcumulaRep;
     |SI #caivarep#nCmp1# = 0;  |ACABA;  |FINSI;

     |SI nCmp1 = 8;  nLin  = 1;  |FINSI;
     |SI nCmp1 = 9;  nLin  = 2;  |FINSI;
     |SI nCmp1 = 10; nLin  = 3;  |FINSI;
     |SI nCmp1 = 52; nLin  = 4;  |FINSI;
     |SI nCmp1 = 53; nLin  = 5;  |FINSI;

     aDesglo = "";

     |SI #casiim01#50 = nLin; aDesglo = #casiim01#7  + #casiim01#8;   |FINSI;
     |SI #casiim01#51 = nLin; aDesglo = #casiim01#52 + #casiim01#53;  |FINSI;
     |SI #casiim01#54 = nLin; aDesglo = #casiim01#55 + #casiim01#56;  |FINSI;
     |SI #casiim01#57 = nLin; aDesglo = #casiim01#58 + #casiim01#59;  |FINSI;
     |SI #casiim01#60 = nLin; aDesglo = #casiim01#61 + #casiim01#52;  |FINSI;

     #siiw0205#0 = aISP;
     #siiw0205#1 = 0;
     #siiw0205#2 = #caivarep#nCmp2#;
     #siiw0205#3 = #caivarep#nCmp4#;
     #siiw0205#4 = aDesglo;
     |LEE 101#siiw0205.=;
     |SI FSalida ! 0;
         |DDEFECTO #siiw0205;
         #siiw0205#0 = aISP;
         #siiw0205#1 = 0;
         #siiw0205#2 = #caivarep#nCmp2#;
         #siiw0205#3 = #caivarep#nCmp4#;
         #siiw0205#4 = aDesglo;
         |GRABA 020#siiw0205.b;
     |FINSI;

     #siiw0205#5 = #siiw0205#5 + #caivarep#nCmp1#;
     #siiw0205#6 = #siiw0205#6 + #caivarep#nCmp3#;
     #siiw0205#7 = #siiw0205#7 + #caivarep#nCmp5#;

     |GRABA 020#siiw0205.a;
     |LIBERA #siiw0205;
|FPRC;

|PROCESO TipoFactRep;
     #siiw0201#13  = #casiim01#3;
     #siiw0201#14  = #casiim01#4;
     #siiw0201#15  = #casiim01#5;
     #siiw0201#16  = #casiim01#6;
     #siiw0201#61  = #casiim01#13;

     |PARA nCmp1 = 62;  |SI nCmp1 [ 95;  |HACIENDO nCmp1 = nCmp1 + 1;
           nCmp2 = nCmp1 - 47;
           #siiw0201#nCmp1#  = #casiim01#nCmp2#;
     |SIGUE;

     #siiw0201#96  = #casiim01#14;
     #siiw0201#97  = #casiim01#49;
     #siiw0201#99  = #casiim01#10;
     #siiw0201#100 = #casiim01#11;
     #siiw0201#101 = #casiim01#12;

     #siiw0201#122 = #casiim01#67;
     #siiw0201#123 = #casiim01#68;
     #siiw0201#124 = #casiim01#69;
     #siiw0201#125 = #casiim01#70;
     #siiw0201#126 = #casiim01#71;
     #siiw0201#127 = #casiim01#72;
|FPRC;

|PROCESO siiw0205E;
     |SI nConta > 6;  |ACABA;  |FINSI;

     nCmp = (nConta * 7) + 18;  #siiw0201#nCmp# = #siiw0205#4 % 101;
     nCmp = nCmp + 1;           #siiw0201#nCmp# = #siiw0205#4 % 202;
     nCmp = nCmp + 1;           #siiw0201#nCmp# = #siiw0205#5;
     nCmp = nCmp + 1;           #siiw0201#nCmp# = #siiw0205#2;
     nCmp = nCmp + 1;           #siiw0201#nCmp# = #siiw0205#6;
     nCmp = nCmp + 1;           #siiw0201#nCmp# = #siiw0205#3;
     nCmp = nCmp + 1;           #siiw0201#nCmp# = #siiw0205#7;

     nConta = nConta + 1;
|FPRC;

|DEFBUCLE siiw0205E;
     #siiw0205#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, siiw0205E;
|FIN;

|PROCESO IdentFiscalRep;
     #caclipro#23 = "C";
     #caclipro#10 = #caivarep#4;
     #caclipro#11 = #caivarep#5;
     |LEE 000#caclipro.=;
     |SI FSalida ! 0;  |DDEFECTO #caclipro;  |FINSI;

     aPais      = #caclipro#24; |QBF aPais;
     aIdenPais  = "01";

     |SI aPais = "";
         aPais = "ES";
     |FINSI;

     |SI aPais = "ESP";
         aPais = "ES";
     |FINSI;

     aAlfa   = aPais;  |QBF aAlfa;
     |SI aAlfa = "GR";  aPais = "EL";  |FINSI;

     |SI aPais ! "ES";
                            aIdenPais = "06";
         |SI aAlfa = "DE";  aIdenPais = "02";  |FINSI;
         |SI aAlfa = "AT";  aIdenPais = "02";  |FINSI;
         |SI aAlfa = "BE";  aIdenPais = "02";  |FINSI;
         |SI aAlfa = "BG";  aIdenPais = "02";  |FINSI;
         |SI aAlfa = "CY";  aIdenPais = "02";  |FINSI;
         |SI aAlfa = "DK";  aIdenPais = "02";  |FINSI;
         |SI aAlfa = "SI";  aIdenPais = "02";  |FINSI;
         |SI aAlfa = "EE";  aIdenPais = "02";  |FINSI;
         |SI aAlfa = "FI";  aIdenPais = "02";  |FINSI;
         |SI aAlfa = "FR";  aIdenPais = "02";  |FINSI;
         |SI aAlfa = "EL";  aIdenPais = "02";  |FINSI;
         |SI aAlfa = "GB";  aIdenPais = "02";  |FINSI;
         |SI aAlfa = "NL";  aIdenPais = "02";  |FINSI;
         |SI aAlfa = "HU";  aIdenPais = "02";  |FINSI;
         |SI aAlfa = "IT";  aIdenPais = "02";  |FINSI;
         |SI aAlfa = "IE";  aIdenPais = "02";  |FINSI;
         |SI aAlfa = "LV";  aIdenPais = "02";  |FINSI;
         |SI aAlfa = "LT";  aIdenPais = "02";  |FINSI;
         |SI aAlfa = "LU";  aIdenPais = "02";  |FINSI;
         |SI aAlfa = "MT";  aIdenPais = "02";  |FINSI;
         |SI aAlfa = "PL";  aIdenPais = "02";  |FINSI;
         |SI aAlfa = "PT";  aIdenPais = "02";  |FINSI;
         |SI aAlfa = "CZ";  aIdenPais = "02";  |FINSI;
         |SI aAlfa = "SK";  aIdenPais = "02";  |FINSI;
         |SI aAlfa = "RO";  aIdenPais = "02";  |FINSI;
         |SI aAlfa = "SE";  aIdenPais = "02";  |FINSI;
         |SI aAlfa = "HR";  aIdenPais = "02";  |FINSI;
     |FINSI;

     |SI #cacon300#2 = 3;
         aIdenPais = "02";
     |FINSI;

     |SI #cacon300#2 = 8;
         aIdenPais  = "04";
     |FINSI;

     aAlfa = #caivarep#51 % 101;   |QBF aAlfa;
     |SI aAlfa = "X";  |O aAlfa = "Y";
         aIdenPais  = "01";
     |FINSI;
|FPRC;

|PROCESO IdentFacturaRep;
     #siiw0201#5  = #casiim01#66;

     aAlfa = #siiw0201#5;  |QBF aAlfa;
     |SI aAlfa = "";
         aAlfa = #caivarep#27;  |QBF aAlfa;
         |SI aAlfa = "";
             aAlfa = ("000000" + #caivarep#2) % -106;
         |SINO;
             |SI #caivaasi#48 = " ";
                 aAlfa = aAlfa + " " +  (("000000" + #caivarep#2) % -106);
             |SINO;
                 aAlfa = aAlfa + #caivaasi#48 + (("000000" + #caivarep#2) % -106);
             |FINSI;
         |FINSI;

         #siiw0201#5   = aAlfa;
     |FINSI;

     aUlt = "";
     |SI #cacon300#5 = "A";  |O #cacon300#5 = "B";
         aAlfa   = #caivarep#27 + " - " + (("000000" + #caivarep#2) % -106);
         #siiw0201#5 = aAlfa;

         nNume   = (#caivarep#2 + #caivarep#62) - 1;
         aUlt    = #caivarep#27 + " - " + (("000000" + nNume) % -106);
         #siiw0201#17 = aUlt;
     |FINSI;
|FPRC;

|PROCESO ImportaEmitidas;
     |DDEFECTO #caivaref;
     #caivaref#0 = #caivarep#0;
     #caivaref#1 = #caivarep#27;
     #caivaref#2 = #caivarep#2;
     |LEE 000#caivaref.=;
     |SI FSalida ! 0;  |DDEFECTO #caivaref;  |FINSI;

     |SI #caivaref#3 < "01.01.1900";
         #caivaref#3 = "01.01.0000";
     |FINSI;

     |LEE 000#siiw0201.u;
     |SI FSalida ! 0;
         #siiw0201#0 = 0;
     |FINSI;

     nReg = #siiw0201#0 + 1;

     |DDEFECTO #siiw0201;
     #siiw0201#0   = nReg;
     #siiw0201#1   = #siim0001#2;
     #siiw0201#2   = #siiz0031#0;
     #siiw0201#3   = #siiz0031#1;
     #siiw0201#4   = "E";

     #siiw0201#6   = #caivarep#3;
     #siiw0201#7   = #caivaref#3;

     |HAZ IdentFiscalRep;

     #siiw0201#8  = aIdenPais;
     #siiw0201#9  = #caivarep#51;

     eaCodNif = #caivarep#51;
     aNom     = #caivarep#50;
     |HAZ BuscaNombre;
     #siiw0201#10 = aNom;
     #siiw0201#11 = aPais;

     |SI aIdenPais ! "01";
         |QBF aPais;
         |SI aPais = "GR";  aPais = "EL";  |FINSI;

         #siiw0201#12 = aPais + #caivarep#51;
     |FINSI;

     |HAZ IdentFacturaRep;

     nConta = 0;
     |BUCLE siiw0205E;

     #siiw0201#60  = #caivarep#26;
     |HAZ TipoFactRep;


     #siiw0201#200 = #canempre#2;
     #siiw0201#201 = #canempre#3;
     #siiw0201#202 = #caivarep#0;
     #siiw0201#203 = #caivarep#2;
     #siiw0201#204 = #caivarep#27;

     |GRABA 020#siiw0201.n;
     |LIBERA #siiw0201;
|FPRC;

|PROCESO siim0003;
     #siim0002#0 = #siim0003#0;
     #siim0002#1 = #siim0003#1;
     |LEE 000#siim0002.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |SI #siim0002#21 = "M";
         aAlfa = ("00" + #siim0002#5) % -102;
     |SINO;
         aAlfa = #siim0002#5 + "T";
     |FINSI;

     |SI aAlfa ! #siiz0031#1;
         |ACABA;
     |FINSI;

     nOk = 0;

     |SI #siim0003#103 ! "C";  |Y #siim0003#103 ! "A";
         |ACABA;
     |FINSI;

     |SI #siiw0201#5 ! #siim0003#19;
      |O #siiw0201#6 ! #siim0003#21;
      |O #siiw0201#9 ! #siim0003#15;
         nOk = 1;
     |FINSI;
|FPRC;

|DEFBUCLE siim0003;
     #siim0003#4;
     ;
#siim0001#0,#siiz0031#0,nPer,#caivarep#0,#caivarep#2,#caivarep#27,         0,     0;
#siim0001#0,#siiz0031#0,nPer,#caivarep#0,#caivarep#2,#caivarep#27,9999999999,999999;
     ;
     NULL, siim0003;
|FIN;

|PROCESO caivarep;
     eaSiiPro = "caivarep";
     enSiiLib = #caivarep#0;
     eaSiiDoc = #caivarep#27 + (("000000" + #caivarep#2) % -106);

     #casiim01#0 = eaSiiPro;
     #casiim01#1 = enSiiLib;
     #casiim01#2 = eaSiiDoc;
     |LEE 000#casiim01.=;
     |SI FSalida = 0;
         |SI #casiim01#3 = "XX";
             |SI PARAMETRO = "UNAUNA";
                |MENAV "0000El registro de IVA no es importable al SII";
             |FINSI;

             |ACABA;
         |FINSI;
     |FINSI;

     |SI PARAMETRO = "UNAUNA";
         |SI #caivarep#44 < nDPer;  |O #caivarep#44 > nHPer;
             |MENAV "0000El periodo del registro no coincide con el del lote";
             |ACABA;
         |FINSI;
     |FINSI;

     #cacon300#0 = #caivarep#6;
     |LEE 000#cacon300.=;
     |SI FSalida ! 0;  |DDEFECTO #cacon300;  |FINSI;

     |SI #cacon300#2 = 2;
         |SI PARAMETRO = "UNAUNA";
             |MENAV "0000El registro no se importa, es una adquisici¢n intracomunitaria";
         |FINSI;

         |ACABA;
     |FINSI;

     |SI #cacon300#5 = "*";
         |SI PARAMETRO = "UNAUNA";
             |MENAV "0000El registro tiene marca en el concepto de que no se importa";
         |FINSI;
         |ACABA;
     |FINSI;

     |HAZ IdentFacturaRep;

     #siiw0201#9  = #caivarep#51;
     #siiw0201#6  = #caivarep#3;

     nOk = 1;
     |BUCLE siim0003;
     |SI nOk = 0;
         |SI PARAMETRO = "UNAUNA";
             |MENAV "0000Se cancela la importaci¢n, el registro ya est  importado.";
         |FINSI;

         |ACABA;
     |FINSI;

     nOk = 1;
     eaSiiPro = "caivarep";
     enSiiLib = #caivarep#0;
     eaSiiDoc = #caivarep#27 + (("000000" + #caivarep#2) % -106);

     #casiim01#0 = eaSiiPro;
     #casiim01#1 = enSiiLib;
     #casiim01#2 = eaSiiDoc;
     |LEE 000#casiim01.=;
     |SI FSalida ! 0;  nOk = 0;  |DDEFECTO #casiim01;  |FINSI;

     |SI #casiim01#8 = "   ";
         nOk = 0;
     |FINSI;

     |SI nOk = 0;
         |CIERRA #casiim01;
         aAlfa = ":agicont/casiim01 canempr1 " + (("00000" + #canempre#2) % -105) + #canempre#3 + ";DEFECTOS";
         |SUB_EJECUTA aAlfa;

         |ABRE #casiim01;
         #casiim01#0 = eaSiiPro;
         #casiim01#1 = enSiiLib;
         #casiim01#2 = eaSiiDoc;
         |LEE 000#casiim01.=;
         |SI FSalida ! 0;  |DDEFECTO #casiim01;  |FINSI;
     |FINSI;

     aFicTmp = "siiw0205" + Usuario;  |NOME_DAT #siiw0205#aFicTmp#;
     |ABRE #siiw0205;  |CIERRA #siiw0205;  |DELINDEX #siiw0205;

     |ABRE #siiw0205;

     aISP  = "";
     nCmp1 = 8;
     nCmp2 = 11;
     nCmp3 = 14;
     nCmp4 = 17;
     nCmp5 = 20;
     |HAZ AcumulaRep;

     nCmp1 = 9;
     nCmp2 = 12;
     nCmp3 = 15;
     nCmp4 = 18;
     nCmp5 = 21;
     |HAZ AcumulaRep;

     nCmp1 = 10;
     nCmp2 = 13;
     nCmp3 = 16;
     nCmp4 = 19;
     nCmp5 = 22;
     |HAZ AcumulaRep;

     nCmp1 = 52;
     nCmp2 = 54;
     nCmp3 = 56;
     nCmp4 = 58;
     nCmp5 = 60;
     |HAZ AcumulaRep;

     nCmp1 = 53;
     nCmp2 = 55;
     nCmp3 = 57;
     nCmp4 = 59;
     nCmp5 = 61;
     |HAZ AcumulaRep;

     |CIERRA #siiw0205;

     |HAZ ImportaEmitidas;

     |DELINDEX #siiw0205;
|FPRC;

|DEFBUCLE caivarep;
     #caivarep#1;
     44;
     00, "  ", 000001, nDPer;
     99, "zz", 999999, nHPer;
     ;
     NULL, caivarep;
|FIN;

|| Recibidas ------------------------------------------------------------

|PROCESO IdentFiscalRec;
     #caclipro#23 = "P";
     #caclipro#10 = #caivasop#4;
     #caclipro#11 = #caivasop#5;
     |LEE 000#caclipro.=;
     |SI FSalida ! 0;  |DDEFECTO #caclipro;  |FINSI;

     aPais      = #caclipro#24; |QBF aPais;
     aIdenPais  = "01";

     |SI aPais = "";
         aPais = "ES";
     |FINSI;

     |SI aPais = "ESP";
         aPais = "ES";
     |FINSI;

     aAlfa   = aPais;  |QBF aAlfa;
     |SI aAlfa = "GR";  aPais = "EL";  |FINSI;

     |SI aPais ! "ES";
                            aIdenPais = "06";
         |SI aAlfa = "DE";  aIdenPais = "02";  |FINSI;
         |SI aAlfa = "AT";  aIdenPais = "02";  |FINSI;
         |SI aAlfa = "BE";  aIdenPais = "02";  |FINSI;
         |SI aAlfa = "BG";  aIdenPais = "02";  |FINSI;
         |SI aAlfa = "CY";  aIdenPais = "02";  |FINSI;
         |SI aAlfa = "DK";  aIdenPais = "02";  |FINSI;
         |SI aAlfa = "SI";  aIdenPais = "02";  |FINSI;
         |SI aAlfa = "EE";  aIdenPais = "02";  |FINSI;
         |SI aAlfa = "FI";  aIdenPais = "02";  |FINSI;
         |SI aAlfa = "FR";  aIdenPais = "02";  |FINSI;
         |SI aAlfa = "EL";  aIdenPais = "02";  |FINSI;
         |SI aAlfa = "GB";  aIdenPais = "02";  |FINSI;
         |SI aAlfa = "NL";  aIdenPais = "02";  |FINSI;
         |SI aAlfa = "HU";  aIdenPais = "02";  |FINSI;
         |SI aAlfa = "IT";  aIdenPais = "02";  |FINSI;
         |SI aAlfa = "IE";  aIdenPais = "02";  |FINSI;
         |SI aAlfa = "LV";  aIdenPais = "02";  |FINSI;
         |SI aAlfa = "LT";  aIdenPais = "02";  |FINSI;
         |SI aAlfa = "LU";  aIdenPais = "02";  |FINSI;
         |SI aAlfa = "MT";  aIdenPais = "02";  |FINSI;
         |SI aAlfa = "PL";  aIdenPais = "02";  |FINSI;
         |SI aAlfa = "PT";  aIdenPais = "02";  |FINSI;
         |SI aAlfa = "CZ";  aIdenPais = "02";  |FINSI;
         |SI aAlfa = "SK";  aIdenPais = "02";  |FINSI;
         |SI aAlfa = "RO";  aIdenPais = "02";  |FINSI;
         |SI aAlfa = "SE";  aIdenPais = "02";  |FINSI;
         |SI aAlfa = "HR";  aIdenPais = "02";  |FINSI;
     |FINSI;

     |SI #cacon300#1 = 2;  |O #cacon300#1 = 7;
         aIdenPais  = "04";
     |FINSI;

     aAlfa = #caivasop#51 % 101;   |QBF aAlfa;
     |SI aAlfa = "X";  |O aAlfa = "Y";
         aIdenPais  = "01";
     |FINSI;
|FPRC;

|PROCESO AcumulaRec;
     |SI #caivasop#nCmp1# = 0;  |ACABA;  |FINSI;

     #siiw0205#0 = aISP;
     #siiw0205#1 = 0;
     #siiw0205#2 = #caivasop#nCmp2#;
     #siiw0205#3 = #caivasop#nCmp4#;
     #siiw0205#4 = "";
     |LEE 101#siiw0205.=;
     |SI FSalida ! 0;
         |DDEFECTO #siiw0205;
         #siiw0205#0 = aISP;
         #siiw0205#1 = 0;
         #siiw0205#2 = #caivasop#nCmp2#;
         #siiw0205#3 = #caivasop#nCmp4#;
         #siiw0205#4 = "";
         |GRABA 020#siiw0205.b;
     |FINSI;

     #siiw0205#5 = #siiw0205#5 + #caivasop#nCmp1#;
     #siiw0205#6 = #siiw0205#6 + #caivasop#nCmp3#;
     #siiw0205#7 = #siiw0205#7 + #caivasop#nCmp5#;

     |SI #caivasop#23 = "S";
         #siiw0205#8 = #siiw0205#8 + #caivasop#nCmp3#;
     |FINSI;

     |GRABA 020#siiw0205.a;
     |LIBERA #siiw0205;
|FPRC;

|PROCESO TipoFactRec;
     #siiw0202#14  = #casiim01#3;
     #siiw0202#15  = #casiim01#4;
     #siiw0202#16  = #casiim01#5;
     #siiw0202#17  = #casiim01#6;

     #siiw0202#60  = #casiim01#13;
     #siiw0202#61  = #casiim01#15;
     #siiw0202#62  = #casiim01#16;
     #siiw0202#63  = #casiim01#17;
     #siiw0202#64  = #casiim01#18;
     #siiw0202#65  = #casiim01#14;
     #siiw0202#66  = #casiim01#49;

     #siiw0202#87  = #casiim01#67;
     #siiw0202#88  = #casiim01#69;
     #siiw0202#89  = #casiim01#70;
     #siiw0202#90  = #casiim01#71;
     #siiw0202#91  = #casiim01#72;
|FPRC;

|PROCESO siiw0205R;
     |SI #siiw0202#15 ! "02";
         nConta = nConta + 1;
         |SI nConta > 6;  |ACABA;  |FINSI;

         nCmp = (nConta * 6) + 13;  #siiw0202#nCmp# = #siiw0205#0;
         nCmp = nCmp + 1;           #siiw0202#nCmp# = #siiw0205#5;
         nCmp = nCmp + 1;           #siiw0202#nCmp# = #siiw0205#2;
         nCmp = nCmp + 1;           #siiw0202#nCmp# = #siiw0205#6;
         nCmp = nCmp + 1;           #siiw0202#nCmp# = #siiw0205#3;
         nCmp = nCmp + 1;           #siiw0202#nCmp# = #siiw0205#7;
     |SINO;
         #siiw0202#55 = #siiw0202#55 + #siiw0205#5;
         #siiw0202#56 = #siiw0205#2;
         #siiw0202#57 = #siiw0202#57 + #siiw0205#6;
     |FINSI;

     #siiw0202#59 = #siiw0202#59 + (#siiw0205#8 % nPro);
|FPRC;

|DEFBUCLE siiw0205R;
     #siiw0205#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, siiw0205R;
|FIN;

|PROCESO IdentFacturaSop;
     #siiw0202#5  = #casiim01#66;

     aAlfa = #siiw0202#5;  |QBF aAlfa;
     |SI aAlfa = "";
         aAlfa = #caivasop#27;  |QBF aAlfa;
         |SI aAlfa = "";
             aAlfa = ("000000" + #caivasop#2) % -106;
         |SINO;
             |SI #caivaasi#48 = " ";
                 aAlfa = aAlfa + " " +  (("000000" + #caivasop#2) % -106);
             |SINO;
                 aAlfa = aAlfa + #caivaasi#48 + (("000000" + #caivasop#2) % -106);
             |FINSI;
         |FINSI;

         #siiw0202#5   = aAlfa;
     |FINSI;

     aUlt = "";
     |SI #cacon300#6 = "A";  |O #cacon300#6 = "B";
         aAlfa   = #caivasop#27 + " - " + (("000000" + #caivasop#2) % -106);
         #siiw0202#5 = aAlfa;

         nNume   = #caivasop#2 + 1;
         aUlt    = #caivasop#27 + " - " + (("000000" + nNume) % -106);
         #siiw0202#18 = aUlt;
     |FINSI;
|FPRC;

|PROCESO ImportaRecibidas;
     |DDEFECTO #caivasof;
     #caivasof#0 = #caivasop#0;
     #caivasof#1 = #caivasop#27;
     #caivasof#2 = #caivasop#2;
     |LEE 000#caivasof.=;
     |SI FSalida ! 0;  |DDEFECTO #caivasof;  |FINSI;

     |SI #caivasof#3 < "01.01.1900";
         #caivasof#3 = "01.01.0000";
     |FINSI;

     |LEE 000#siiw0202.u;
     |SI FSalida ! 0;
         #siiw0202#0 = 0;
     |FINSI;

     nReg = #siiw0202#0 + 1;

     |DDEFECTO #siiw0202;
     #siiw0202#0   = nReg;
     #siiw0202#1   = #siim0001#2;
     #siiw0202#2   = #siiz0031#0;
     #siiw0202#3   = #siiz0031#1;
     #siiw0202#4   = "R";

     |HAZ IdentFiscalRec;

     #siiw0202#9  = aIdenPais;
     #siiw0202#10 = #caivasop#51;

     eaCodNif = #caivasop#51;
     aNom     = #caivasop#50;
     |HAZ BuscaNombre;
     #siiw0202#11 = aNom;
     #siiw0202#12 = aPais;

     |SI aIdenPais ! "01";
         |QBF aPais;
         |SI aPais = "GR";  aPais = "EL";  |FINSI;

         #siiw0202#13 = aPais + #caivasop#51;
     |FINSI;

     #siiw0202#6   = #caivasop#3;
     #siiw0202#7   = #caivasof#3;
     #siiw0202#8   = #caivasop#46;

     |SI #caivaasi#55 = "S";
         #siiw0202#8  = ~;
     |FINSI;

     |HAZ IdentFacturaSop;

     #siiw0202#58  = #caivasop#26;
     |HAZ TipoFactRec;

     nConta = 0;
     |BUCLE siiw0205R;

     #siiw0202#200 = #canempre#2;
     #siiw0202#201 = #canempre#3;
     #siiw0202#202 = #caivasop#0;
     #siiw0202#203 = #caivasop#2;
     #siiw0202#204 = #caivasop#27;

     |GRABA 020#siiw0202.n;
     |LIBERA #siiw0202;
|FPRC;

|PROCESO siim0004;
     #siim0002#0 = #siim0004#0;
     #siim0002#1 = #siim0004#1;
     |LEE 000#siim0002.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |SI #siim0002#21 = "M";
         aAlfa = ("00" + #siim0002#5) % -102;
     |SINO;
         aAlfa = #siim0002#5 + "T";
     |FINSI;

     |SI aAlfa ! #siiz0031#1;
         |ACABA;
     |FINSI;

     nOk = 0;

     |SI #siim0004#78 ! "C";  |Y #siim0004#78 ! "A";
         |ACABA;
     |FINSI;

     |SI #siiw0202#5  ! #siim0004#14;
      |O #siiw0202#6  ! #siim0004#16;
      |O #siiw0202#10 ! #siim0004#10;
         nOk = 1;
     |FINSI;
|FPRC;

|DEFBUCLE siim0004;
     #siim0004#5;
     ;
#siim0001#0,#siiz0031#0,nPer,#caivasop#0,#caivasop#2,#caivasop#27,         0,     0;
#siim0001#0,#siiz0031#0,nPer,#caivasop#0,#caivasop#2,#caivasop#27,9999999999,999999;
     ;
     NULL, siim0004;
|FIN;

|PROCESO caivasop;
     eaSiiPro = "caivasop";
     enSiiLib = #caivasop#0;
     eaSiiDoc = #caivasop#27 + (("000000" + #caivasop#2) % -106);

     #casiim01#0 = eaSiiPro;
     #casiim01#1 = enSiiLib;
     #casiim01#2 = eaSiiDoc;
     |LEE 000#casiim01.=;
     |SI FSalida = 0;
         |SI #casiim01#3 = "XX";
             |SI PARAMETRO = "UNAUNA";
                |MENAV "0000El registro de IVA no es importable al SII";
             |FINSI;

             |ACABA;
         |FINSI;
     |FINSI;

     |SI PARAMETRO = "UNAUNA";
         |SI #caivasop#44 < nDPer;  |O #caivasop#44 > nHPer;
             |MENAV "0000El periodo del registro no coincide con el del lote";

             |ACABA;
         |FINSI;
     |FINSI;

     #cacon300#0 = #caivasop#6;
     |LEE 000#cacon300.=;
     |SI FSalida ! 0;  |DDEFECTO #cacon300;  |FINSI;

     |SI #cacon300#6 = "*";
         |SI PARAMETRO = "UNAUNA";
             |MENAV "0000El registro tiene marca en el concepto de que no se importa";
         |FINSI;
         |ACABA;
     |FINSI;

     |HAZ IdentFacturaSop;
     #siiw0202#10 = #caivasop#51;
     #siiw0202#6  = #caivasop#3;
     nOk = 1;
     |BUCLE siim0004;
     |SI nOk = 0;
         |SI PARAMETRO = "UNAUNA";
             |MENAV "0000Se cancela la importaci¢n, el registro ya est  importado.";
         |FINSI;

         |ACABA;
     |FINSI;

     eaSiiPro = "caivasop";
     enSiiLib = #caivasop#0;
     eaSiiDoc = #caivasop#27 + (("000000" + #caivasop#2) % -106);

     #casiim01#0 = eaSiiPro;
     #casiim01#1 = enSiiLib;
     #casiim01#2 = eaSiiDoc;
     |LEE 000#casiim01.=;
     |SI FSalida ! 0;  nOk = 0;  |FINSI;

     |SI nOk = 0;
         |CIERRA #casiim01;
         aAlfa = ":agicont/casiim01 canempr1 " + (("00000" + #canempre#2) % -105) + #canempre#3 + ";DEFECTOS";
         |SUB_EJECUTA aAlfa;

         |ABRE #casiim01;
         #casiim01#0 = eaSiiPro;
         #casiim01#1 = enSiiLib;
         #casiim01#2 = eaSiiDoc;
         |LEE 000#casiim01.=;
         |SI FSalida ! 0;  |DDEFECTO #casiim01;  |FINSI;
     |FINSI;

     aFicTmp = "siiw0205" + Usuario;  |NOME_DAT #siiw0205#aFicTmp#;
     |ABRE #siiw0205;  |CIERRA #siiw0205;  |DELINDEX #siiw0205;

     |ABRE #siiw0205;

     aISP  = "";
     |SI #cacon300#6 = "I";
         aISP  = "S";
     |FINSI;

     nCmp1 = 8;
     nCmp2 = 11;
     nCmp3 = 14;
     nCmp4 = 17;
     nCmp5 = 20;
     |HAZ AcumulaRec;

     nCmp1 = 9;
     nCmp2 = 12;
     nCmp3 = 15;
     nCmp4 = 18;
     nCmp5 = 21;
     |HAZ AcumulaRec;

     nCmp1 = 10;
     nCmp2 = 13;
     nCmp3 = 16;
     nCmp4 = 19;
     nCmp5 = 22;
     |HAZ AcumulaRec;

     nCmp1 = 52;
     nCmp2 = 54;
     nCmp3 = 56;
     nCmp4 = 58;
     nCmp5 = 60;
     |HAZ AcumulaRec;

     nCmp1 = 53;
     nCmp2 = 55;
     nCmp3 = 57;
     nCmp4 = 59;
     nCmp5 = 61;
     |HAZ AcumulaRec;

     |CIERRA #siiw0205;

     |HAZ ImportaRecibidas;

     |DELINDEX #siiw0205;
|FPRC;

|DEFBUCLE caivasop;
     #caivasop#1;
     44;
     00, "  ", 000001, nDPer;
     99, "zz", 999999, nHPer;
     ;
     NULL, caivasop;
|FIN;

|PROCESO canempre;
     |SI nPas = 1;
         |SI #canempre#11 = 1;
              nPerConta = #canempre#3;
              nOk = 1;  |ERROR10;  |ACABA;
         |FINSI;

         |SI nHPer ] #canempre#11;
              nPerConta = #canempre#3;
              nOk = 1;  |ERROR10;  |ACABA;
         |FINSI;
     |FINSI;

     |SI nPas = 2;
         |SI #canempre#11 = 1;
             |ACABA;
         |FINSI;

         |SI nHPer [ #canempre#12;
              nPerConta = #canempre#3;
              nOk = 1;  |ERROR10;  |ACABA;
         |FINSI;
     |FINSI;

     |ERROR10;
|FPRC;

|DEFBUCLE canempre;
     #canempre#1;
     26;
     #siim0001#0, 0, nEjBus;
     #siim0001#0, 9, nEjBus;
     ;
     NULL, canempre;
|FIN;

|PROCESO siim0001;
     nEjBus = nEje;

     nOk  = 0;
     nPas = 1;  |BUCLE canempre;
     |SI nOk = 0;
         nEjBus = nEje - 1;
         nPas   = 2;  |BUCLE canempre;
     |FINSI;
     |SI nOk = 0;  |ACABA;  |FINSI;

     #canempre#2  = #siim0001#0;
     #canempre#3  = nPerConta;
     |LEE 000#canempre.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     nPro = 100;
     #siim0055#0 = #siiz0031#0;
     #siim0055#1 = #siim0001#2;
     |LEE 000#siim0055.=;
     |SI FSalida = 0;
         nPro = #siim0055#3;
     |FINSI;

     aFicConta = aPathConta + (("00000" + #canempre#2) % -105) + #canempre#3 + "/";

     |PATH_DAT #caivarep#aFicConta#;
     |PATH_DAT #caivasop#aFicConta#;
     |PATH_DAT #cacon300#aFicConta#;
     |PATH_DAT #caivaref#aFicConta#;
     |PATH_DAT #caivasof#aFicConta#;
     |PATH_DAT #caivarec#aFicConta#;
     |PATH_DAT #caclipro#aFicConta#;
     |PATH_DAT #caivaasi#aFicConta#;
     |PATH_DAT #casiim01#aFicConta#;
     |PATH_DAT #casiim02#aFicConta#;

     |ABRE #caivaasi;
     |LEE 000#caivaasi.p;
     |SI FSalida ! 0;  |DDEFECTO #caivaasi;  |FINSI;
     |CIERRA #caivaasi;

     |ABRE #caclipro;
     |ABRE #cacon300;
     |ABRE #caivaref;
     |ABRE #caivasof;
     |ABRE #caivarec;
     |ABRE #casiim01;

     |BUCLE caivarep;
     |BUCLE caivasop;

     |CIERRA #caclipro;
     |CIERRA #cacon300;
     |CIERRA #caivaref;
     |CIERRA #caivasof;
     |CIERRA #caivarec;
     |CIERRA #casiim01;
|FPRC;

|DEFBUCLE siim0001;
     #siim0001#3;
     5;
     "S", 00001, aPer;
     "S", 99999, aPer;
     ;
     NULL, siim0001;
|FIN;

|PROCESO AbreVtn0;
     |VENTANA 0501, 1140, -1, 16, "Importaci¢n StarIII";
     n0Vent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n0Vent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PTEC 802;  |PAUSA;
|FPRC;

|PROCESO CierraVtn0;
     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n0Vent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA n0Vent;
|FPRC;

|PROCESO AbreVtn1;
     |VENTANA 0501, 0540, -1, 16, "Realizando la importaci¢n";
     n1Vent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PTEC 802;  |PAUSA;
|FPRC;

|PROCESO CierraVtn1;
     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA n1Vent;
|FPRC;

|PROCESO Importa;
     |CONFI "0000NSeguro que quiere realizar la importaci¢n en estos momentos";
     |SI FSalida ! 0;
         |ACABA;
     |FINSI;

     |HAZ AbreVtn1;

     nEje = #siiz0031#0 - 2000;
     |DBASS aPathConta;
     aPathConta = aPathConta + "agicont/fich/";

     aFicTmp = "siiw0201" + Usuario;  |NOME_DAT #siiw0201#aFicTmp#;
     |ABRE #siiw0201;  |CIERRA #siiw0201;  |DELINDEX #siiw0201;

     aFicTmp = "siiw0202" + Usuario;  |NOME_DAT #siiw0202#aFicTmp#;
     |ABRE #siiw0202;  |CIERRA #siiw0202;  |DELINDEX #siiw0202;

                               aPer = "M";
     |SI  #siiz0031#1 = "1T";  aPer = "T";  |FINSI;
     |SI  #siiz0031#1 = "2T";  aPer = "T";  |FINSI;
     |SI  #siiz0031#1 = "3T";  aPer = "T";  |FINSI;
     |SI  #siiz0031#1 = "4T";  aPer = "T";  |FINSI;

     |ABRE #siiw0201;
     |ABRE #siiw0202;

     |ABRE #canempre;
     |BUCLE siim0001;
     |CIERRA #canempre;

     |LEE 000#siiw0201.p;  nHay201 = FSalida;
     |LEE 000#siiw0202.p;  nHay202 = FSalida;

     |CIERRA #siiw0201;
     |CIERRA #siiw0202;

     |HAZ CierraVtn1;

     |SI nHay201 ! 0;
         |MENAV "0000No hay registros a importar en expedidas";
     |SINO;
         |SUB_EJECUTA "siiz0022;AGICONT";
     |FINSI;

     |SI nHay202 ! 0;
         |MENAV "0000No hay registros a importar en recibidas";
     |SINO;
         |SUB_EJECUTA "siiz0023;AGICONT";
     |FINSI;

     |DELINDEX #siiw0201;
     |DELINDEX #siiw0202;
|FPRC;

|PROCESO SelecCaivarep;
     enDoc = 0;
     |ABRE #caivarep
     |PARA;  |SI;  |HACIENDO;
          |CONSULTA_CLAVE #1#caivarep;
          |SI FSalida ! 0;
              |CONFI "0000NQuiere cancelar la selecci¢n";
              |SI FSalida = 0;  |SAL;  |FINSI;
          |SINO;
              |CONFI "0000SImportamos el registro";
              |SI FSalida = 0;
                  enLib = #caivarep#0;
                  enDoc = #caivarep#2;
                  eaSer = #caivarep#27;
                  |SAL;
              |FINSI;
          |FINSI;
     |SIGUE;

     |SI enDoc ! 0;
         #caivarep#0  = enLib;
         #caivarep#2  = enDoc;
         #caivarep#27 = eaSer;
         |LEE 000#caivarep.=;
         |SI FSalida = 0;
             |HAZ caivarep;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO SelecCaivasop;
     enDoc = 0;
     |ABRE #caivasop
     |PARA;  |SI;  |HACIENDO;
          |CONSULTA_CLAVE #1#caivasop;
          |SI FSalida ! 0;
              |CONFI "0000NQuiere cancelar la selecci¢n";
              |SI FSalida = 0;  |SAL;  |FINSI;
          |SINO;
              |CONFI "0000SImportamos el registro";
              |SI FSalida = 0;
                  enLib = #caivasop#0;
                  enDoc = #caivasop#2;
                  eaSer = #caivasop#27;
                  |SAL;
              |FINSI;
          |FINSI;
     |SIGUE;

     |SI enDoc ! 0;
         #caivasop#0  = enLib;
         #caivasop#2  = enDoc;
         #caivasop#27 = eaSer;
         |LEE 000#caivasop.=;
         |SI FSalida = 0;
             |HAZ caivasop;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO LeeRegis;
     nEjBus = nEje;

     nOk  = 0;
     nPas = 1;  |BUCLE canempre;
     |SI nOk = 0;
         nEjBus = nEje - 1;
         nPas   = 2;  |BUCLE canempre;
     |FINSI;
     |SI nOk = 0;  |ACABA;  |FINSI;

     #canempre#2  = #siim0001#0;
     #canempre#3  = nPerConta;
     |LEE 000#canempre.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     nPro = 100;
     #siim0055#0 = #siiz0031#0;
     #siim0055#1 = #siim0001#2;
     |LEE 000#siim0055.=;
     |SI FSalida = 0;
         nPro = #siim0055#3;
     |FINSI;

     aFicConta = aPathConta + (("00000" + #canempre#2) % -105) + #canempre#3 + "/";

     |PATH_DAT #caivarep#aFicConta#;
     |PATH_DAT #caivasop#aFicConta#;
     |PATH_DAT #cacon300#aFicConta#;
     |PATH_DAT #caivaref#aFicConta#;
     |PATH_DAT #caivasof#aFicConta#;
     |PATH_DAT #caivarec#aFicConta#;
     |PATH_DAT #caclipro#aFicConta#;
     |PATH_DAT #caivaasi#aFicConta#;
     |PATH_DAT #casiim01#aFicConta#;
     |PATH_DAT #casiim02#aFicConta#;

     |ABRE #caivaasi;
     |LEE 000#caivaasi.p;
     |SI FSalida ! 0;  |DDEFECTO #caivaasi;  |FINSI;
     |CIERRA #caivaasi;

     |ABRE #caclipro;
     |ABRE #cacon300;
     |ABRE #caivaref;
     |ABRE #caivasof;
     |ABRE #caivarec;
     |ABRE #casiim01;

     |SI eaTip = "11";
         |HAZ SelecCaivarep;
     |FINSI;

     |SI eaTip = "21";
         |HAZ SelecCaivasop;
     |FINSI;

     |CIERRA #caclipro;
     |CIERRA #cacon300;
     |CIERRA #caivaref;
     |CIERRA #caivasof;
     |CIERRA #caivarec;
     |CIERRA #casiim01;
|FPRC;

|PROCESO UnaUna;
     |HAZ AbreVtn1;

     #siim0001#0 = enEmp;
     |LEE 000#siim0001.=;
     |SI FSalida ! 0;  |DDEFECTO #siim0001;  |FINSI;

     #siim0002#0 = enEmp;
     #siim0002#1 = enLot;
     |LEE 000#siim0002.=;
     |SI FSalida ! 0;  |DDEFECTO #siim0002;  |FINSI;

     #siiz0031#0 = enEje;

     |SI #siim0002#21 = "M";
         #siiz0031#1 = ("00" + #siim0002#5) % -102;
     |SINO;
         #siiz0031#1 = #siim0002#5 + "T";
     |FINSI;

     |HAZ CogePeriodos;

     nEje = #siiz0031#0 - 2000;
     |DBASS aPathConta;
     aPathConta = aPathConta + "agicont/fich/";

     aFicTmp = "siiw0201" + Usuario;  |NOME_DAT #siiw0201#aFicTmp#;
     |ABRE #siiw0201;  |CIERRA #siiw0201;  |DELINDEX #siiw0201;

     aFicTmp = "siiw0202" + Usuario;  |NOME_DAT #siiw0202#aFicTmp#;
     |ABRE #siiw0202;  |CIERRA #siiw0202;  |DELINDEX #siiw0202;

     |ABRE #siiw0201;
     |ABRE #siiw0202;
     |ABRE #canempre;
     |HAZ LeeRegis;
     |CIERRA #canempre;

     |LEE 000#siiw0201.p;  nHay201 = FSalida;
     |LEE 000#siiw0202.p;  nHay202 = FSalida;

     |CIERRA #siiw0201;
     |CIERRA #siiw0202;

     |HAZ CierraVtn1;

     |SI PARAMETRO = "UNAUNA";
         enLotFor = enLot;
     |FINSI;

     |SI nHay201 = 0;
         |SUB_EJECUTA "siiz0022;AGICONT";
     |FINSI;

     |SI nHay202 = 0;
         |SUB_EJECUTA "siiz0023;AGICONT";
     |FINSI;

     |DELINDEX #siiw0201;
     |DELINDEX #siiw0202;
|FPRC;

|PROCESO T12;  |TIPO 12;
     |SI FSalida = 7;
         |HAZ CierraVtn0;
         |ACABA;
     |FINSI;

     |SI nOk = 0;
         |ERROR;

         |POSICIONATE #siiz0031#0;
         |ACABA;
     |FINSI;

     |HAZ CierraVtn0;

     |HAZ CogePeriodos;
     |HAZ Importa;
|FPRC;

|PROCESO PonMes;
                              #siiz0031#2 = "";
     |SI #siiz0031#1 = "01";  #siiz0031#2 = "ENERO";       |FINSI;
     |SI #siiz0031#1 = "02";  #siiz0031#2 = "FEBRERO";     |FINSI;
     |SI #siiz0031#1 = "03";  #siiz0031#2 = "MARZO";       |FINSI;
     |SI #siiz0031#1 = "04";  #siiz0031#2 = "ABRIL";       |FINSI;
     |SI #siiz0031#1 = "05";  #siiz0031#2 = "MAYO";        |FINSI;
     |SI #siiz0031#1 = "06";  #siiz0031#2 = "JUNIO";       |FINSI;
     |SI #siiz0031#1 = "07";  #siiz0031#2 = "JULIO";       |FINSI;
     |SI #siiz0031#1 = "08";  #siiz0031#2 = "AGOSTO";      |FINSI;
     |SI #siiz0031#1 = "09";  #siiz0031#2 = "SEPTIEMBRE";  |FINSI;
     |SI #siiz0031#1 = "10";  #siiz0031#2 = "OCTUBRE";     |FINSI;
     |SI #siiz0031#1 = "11";  #siiz0031#2 = "NOVIEMBRE";   |FINSI;
     |SI #siiz0031#1 = "12";  #siiz0031#2 = "DICIEMBRE";   |FINSI;
     |SI #siiz0031#1 = "1T";  #siiz0031#2 = "1 TRIMSTRE";  |FINSI;
     |SI #siiz0031#1 = "2T";  #siiz0031#2 = "2 TRIMSTRE";  |FINSI;
     |SI #siiz0031#1 = "3T";  #siiz0031#2 = "3 TRIMSTRE";  |FINSI;
     |SI #siiz0031#1 = "4T";  #siiz0031#2 = "4 TRIMSTRE";  |FINSI;

     |PINTA #siiz0031#2;
|FPRC;

|PROCESO T0C1z31;  |TIPO 0;
     |HAZ PonMes;

     |SI #siiz0031#2 = "          ";
         |MENAV "0000Periodo incorrecto. ";
         |ERROR;
         |ACABA;
     |FINSI;
|FPRC;

|PROCESO T66C1z31;  |TIPO 66;
     aAlfa = "|C001WID";
     aID   = #siiz0031#aAlfa#;
     nID   = aID;

     aPopup1  = nID;
     aPopup2  = 16;
     aPopup3  = "01-ENERO";
     aPopup4  = "02-FEBRERO";
     aPopup5  = "03-MARZO";
     aPopup6  = "04-ABRIL";
     aPopup7  = "05-MAYO";
     aPopup8  = "06-JUNIO";
     aPopup9  = "07-JULIO";
     aPopup10 = "08-AGOSTO";
     aPopup11 = "09-SEPTIEMBRE";
     aPopup12 = "10-OCTUBRE";
     aPopup13 = "11-NOVIEMBRE";
     aPopup14 = "12-DICIEMBRE";
     aPopup15 = "1T-1 TRIMESTRE";
     aPopup16 = "2T-2 TRIMESTRE";
     aPopup17 = "3T-3 TRIMESTRE";
     aPopup18 = "4T-4 TRIMESTRE";

     IaPopup  = aPopup1  <-;
     |ESPECIFICA "TRACKPOPUP", aPopup;
     |SI FSalida ! 0;
         IaPopup  = aPopup3  <-;
         IaPopup  = IaPopup + (FSalida - 1);

         aAlfa = aPopup % 102;  #siiz0031#1 = aAlfa;
     |FINSI;

     |PINTA #siiz0031#1;
     |HAZ PonMes;
|FPRC;

|PROCESO T0C0z31;  |TIPO 0;
     fFecha = ~;
     aAlfa  = fFecha % -104;  nEje = aAlfa;

     |SI nEje = 2017;
         nDAnyo = nEje;
         nHAnyo = nEje + 1;
     |SINO;
         nDAnyo = nEje - 1;
         nHAnyo = nEje + 1;
     |FINSI;

     |SI #siiz0031#0 < nDAnyo;  |O #siiz0031#0 > nHAnyo;
         aAlfa = "0000El a¤o debe ser mayor o igual a " + nDAnyo;
         aAlfa = aAlfa + " y menor o igual a " + nHAnyo;
         |MENAV aAlfa;
         |ERROR;
     |FINSI;
|FPRC;

|PROCESO T66C0z31;  |TIPO 66;
     fFecha = ~;
     aAlfa  = fFecha % -104;  nEje = aAlfa;

     aAlfa = "|C000WID";
     aID   = #siiz0031#aAlfa#;
     nID   = aID;

     aPopup1  = nID;  || Si fuera -1 en la posicion

     |SI nEje = 2017;
         aPopup2  = 2;
         nAnyo = nEje;      aPopup3  = nAnyo;
         nAnyo = nEje + 1;  aPopup4  = nAnyo;
     |SINO;
         aPopup2  = 3;
         nAnyo = nEje - 1;  aPopup3  = nAnyo;
         nAnyo = nEje;      aPopup4  = nAnyo;
         nAnyo = nEje + 1;  aPopup5  = nAnyo;
     |FINSI;

     IaPopup  = aPopup1  <-;
     |ESPECIFICA "TRACKPOPUP", aPopup;
     |SI FSalida ! 0;
         IaPopup  = aPopup3  <-;
         IaPopup  = IaPopup + (FSalida - 1);

         #siiz0031#0 = aPopup;
     |FINSI;

     |PINTA #siiz0031#0;
|FPRC;

|PROCESO Ptec806;
     |PTEC 806;
     nOk = 1;
|FPRC;

|PROCESO Ptec807;
     |PTEC 807;
     nOk = 0;
|FPRC;

|PROCESO T7C0z31;  |TIPO 7;
     |SI nBtnVal ! -1;
         |ACABA;
     |FINSI;

     aQB = "|X000";
     aID = #siiz0031#aQB#;
     nBt = aID;
     |ESTADO_CONTROL nBt, "HIDE";

     aQB = "|X001";
     aID = #siiz0031#aQB#;
     nBt = aID;
     |ESTADO_CONTROL nBt, "HIDE";

     |PULSATECLA;
     |PULSATECLA;
     |PULSATECLA;
     |PULSATECLA;

     |CONTROL_SIMPLE 0, "BOTON,{{230}}Ejecutar", 1128, 1138, Ptec806;
     nBtnVal = FSalida;

     |PULSATECLA;
     |PULSATECLA;
     |PULSATECLA;

     |CONTROL_SIMPLE 0, "BOTON,{{207}}Cancelar", 1113, 1123, Ptec807;
|FPRC;

|PROGRAMA;

     |SI PARAMETRO = "UNAUNA";
         |HAZ UnaUna;
         |ACABA;
     |FINSI;

     |CLS;
     |CABEZA "Importaci¢n StarIII";

     |HAZ AbreVtn0;

     fFecha = ~;
     aAlfa  = fFecha % -104;  nEje = aAlfa;
     aAlfa  = fFecha % 402;   nPer = aAlfa;

     |SI nPer > 12;
         nPer = 1;
         nEje = nEje + 1;
     |FINSI;

     |DDEFECTO #siiz0031;

     #siiz0031#0 = nEje;
     #siiz0031#1 = ("00" + nPer) % -102;
     |HAZ PonMes;

     |PINPA #0#siiz0031;
     |PINDA #0#siiz0031;

     |ENDATOS #1#siiz0031;
|FPRO;

|PROCESO T80;  |TIPO 80;
     nBtnVal = -1;

     |ABRET #siim0001;
     |ABRET #siim0002;
     |ABRET #siim0003;
     |ABRET #siim0004;
     |ABRET #siim0007;
     |ABRET #siim0008;
     |ABRET #siim0055;
|FPRC;

|PROCESO T90;  |TIPO 90;
     enLotFor = 0;

     |CIERRAT #siim0001;
     |CIERRAT #siim0002;
     |CIERRAT #siim0003;
     |CIERRAT #siim0004;
     |CIERRAT #siim0007;
     |CIERRAT #siim0008;
     |CIERRAT #siim0055;

     |PULSATECLA;
     |PULSATECLA;
     |PULSATECLA;
     |PULSATECLA;
|FPRC;

|PROCESO T15rep;
|FPRC;

|PROCESO T16rep;
|FPRC;

|PROCESO T17rep;
|FPRC;

|PROCESO T15sop;
|FPRC;

|PROCESO T16sop;
|FPRC;

|PROCESO T17sop;
|FPRC;
