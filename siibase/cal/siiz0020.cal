|FICHEROS;
     siim0000;
     siim0001;
     siim0002;
     siim0003;
     siim0004;
     siim0005;
     siim0006;
     siim0009;
     siim0010;

     siim0051;
     siim0052;
     siim0054;

     siiw0207;
|FIN;

|VARIABLES;
     n1Vent              = 0;
     n2Vent              = 0;
     nReg                = 0;
     nDias               = 0;
     nNumReg             = 0;

     aModoImp            = "";
     aDoc                = "";
     aIde                = "";
     aInci               = "";
     aHora               = "";
     aParam              = "";
     aEjec               = "";
     aFicTmp             = "";
     aNom                = "";

     fFechaSys           = @;

     {-1}aVent           = "";
         aVent1          = 0;
         aVent2          = 0;
         aVent3          = 0;
         aVent4          = 0;
         aVent5          = "";

     &eaPython           = "";
     &enID               = 0;
     &enEmp              = 0;
     &enEje              = 0;
     &enPer              = 0;
     &enLot              = 0;
     &enAccPNT           = 0;
     &enEmpPNT           = 0;
     &enErrPNT           = 0;
     &eaCert             = "";
|FIN;

|PROCESO siim0051;
     enID   = #siim0051#0;

                              aEjec = "";
     |SI #siim0051#1 = "FE";  aEjec = "siiz0022;" + aParam;  |FINSI;
     |SI #siim0051#1 = "FR";  aEjec = "siiz0023;" + aParam;  |FINSI;

     |SI aEjec = "";  |ACABA;  |FINSI;

     |SUB_EJECUTA aEjec;
|FPRC;

|DEFBUCLE siim0051;
     #siim0051#2;
     ;
     "          ", 00000000001;
     "          ", 99999999999;
     ;
     NULL, siim0051;
|FIN;

|PROCESO ImportaCSV;
     |ABRET #siim0051;
     |BUCLE siim0051;
     |CIERRAT #siim0051;
|FPRC;

|PROCESO Cuenta;
     nNumReg = nNumReg + 1;
     |ERROR10;
|FPRC;

|DEFBUCLE siim0003E;
     #siim0003#1;
     103, 21;
     #siim0002#0, #siim0002#1,      1, "I", "01.01.0000";
     #siim0002#0, #siim0002#1, 999999, "P",    fFechaSys;
     ;
     NULL, Cuenta;
|FIN;

|DEFBUCLE siim0004E;
     #siim0004#1;
     78, 17;
     #siim0002#0, #siim0002#1,      1, "I", "01.01.0000";
     #siim0002#0, #siim0002#1, 999999, "P",    fFechaSys;
     ;
     NULL, Cuenta;
|FIN;

|DEFBUCLE siim0005E;
     #siim0005#1;
     23, 9;
     #siim0002#0, #siim0002#1,      1, "I", "01.01.0000";
     #siim0002#0, #siim0002#1, 999999, "P",    fFechaSys;
     ;
     NULL, Cuenta;
|FIN;

|DEFBUCLE siim0006E;
     #siim0006#1;
     23, 9;
     #siim0002#0, #siim0002#1,      1, "I", "01.01.0000";
     #siim0002#0, #siim0002#1, 999999, "P",    fFechaSys;
     ;
     NULL, Cuenta;
|FIN;

|DEFBUCLE siim0009E;
     #siim0009#1;
     21, 6;
     #siim0002#0, #siim0002#1,      1, "I", "01.01.0000";
     #siim0002#0, #siim0002#1, 999999, "P",    fFechaSys;
     ;
     NULL, Cuenta;
|FIN;

|DEFBUCLE siim0010E;
     #siim0010#1;
     14;
     #siim0002#0, #siim0002#1,      1, "I";
     #siim0002#0, #siim0002#1, 999999, "P";
     ;
     NULL, Cuenta;
|FIN;

|PROCESO siim0002E;
     nNumReg = 0;

     |SI #siim0002#2 = "11";  |BUCLE siim0003E;  |FINSI;
     |SI #siim0002#2 = "12";  |BUCLE siim0003E;  |FINSI;
     |SI #siim0002#2 = "14";  |BUCLE siim0005E;  |FINSI;
     |SI #siim0002#2 = "15";  |BUCLE siim0003E;  |FINSI;

     |SI #siim0002#2 = "21";  |BUCLE siim0004E;  |FINSI;
     |SI #siim0002#2 = "22";  |BUCLE siim0004E;  |FINSI;
     |SI #siim0002#2 = "24";  |BUCLE siim0006E;  |FINSI;
     |SI #siim0002#2 = "25";  |BUCLE siim0004E;  |FINSI;

     |SI #siim0002#2 = "31";  |BUCLE siim0009E;  |FINSI;
     |SI #siim0002#2 = "32";  |BUCLE siim0009E;  |FINSI;
     |SI #siim0002#2 = "35";  |BUCLE siim0009E;  |FINSI;

     |SI #siim0002#2 = "41";  |BUCLE siim0010E;  |FINSI;
     |SI #siim0002#2 = "42";  |BUCLE siim0010E;  |FINSI;
     |SI #siim0002#2 = "45";  |BUCLE siim0010E;  |FINSI;

     |SI nNumReg = 0;
         |ACABA;
     |FINSI;

     enEmp = #siim0002#0;
     enLot = #siim0002#1;
     enEje = #siim0002#4;
     enPer = #siim0002#5;
     aEjec = "";

     |SI #siim0002#2 = "11";  aEjec = "siiz0012;" + aParam;  |FINSI;
     |SI #siim0002#2 = "12";  aEjec = "siiz0012;" + aParam;  |FINSI;
     |SI #siim0002#2 = "14";  aEjec = "siiz0016;" + aParam;  |FINSI;
     |SI #siim0002#2 = "15";  aEjec = "siiz0014;" + aParam;  |FINSI;

     |SI #siim0002#2 = "21";  aEjec = "siiz0013;" + aParam;  |FINSI;
     |SI #siim0002#2 = "22";  aEjec = "siiz0013;" + aParam;  |FINSI;
     |SI #siim0002#2 = "24";  aEjec = "siiz0017;" + aParam;  |FINSI;
     |SI #siim0002#2 = "25";  aEjec = "siiz0015;" + aParam;  |FINSI;

     |SI #siim0002#2 = "31";  aEjec = "siiz0018;" + aParam;  |FINSI;
     |SI #siim0002#2 = "32";  aEjec = "siiz0018;" + aParam;  |FINSI;
     |SI #siim0002#2 = "35";  aEjec = "siiz0019;" + aParam;  |FINSI;

     |SI #siim0002#2 = "41";  aEjec = "siiz0040;" + aParam;  |FINSI;
     |SI #siim0002#2 = "42";  aEjec = "siiz0040;" + aParam;  |FINSI;
     |SI #siim0002#2 = "45";  aEjec = "siiz0041;" + aParam;  |FINSI;

     |SI aEjec = "";  |ACABA;  |FINSI;

     |SUB_EJECUTA aEjec;

     |PULSATECLA;
|FPRC;

|DEFBUCLE siim0002E;
     #siim0002#1;
     6;
     #siim0001#0, 0000000000,      1;
     #siim0001#0, 9999999999, 999999;
     ;
     NULL, siim0002E;
|FIN;

|PROCESO siim0001E;
     |SI enAccPNT ! 0;
         enEmpPNT = #siim0001#0;
         |HAZ EmpresaPNT;
         |SI enErrPNT = 1;  |ACABA;  |FINSI;
     |FINSI;

     |BUCLE siim0002E;
|FPRC;

|DEFBUCLE siim0001E;
     #siim0001#3;
     ;
     "S", 00001;
     "S", 99999;
     ;
     NULL, siim0001E;
|FIN;

|PROCESO Envio;
     |BUCLE siim0001E;
|FPRC;

|PROCESO PatronCerti;
     |ABRE #siim0000;
     |LEE 101#siim0000.p;
     |SI FSalida ! 0;
         |DDEFECTO #siim0000;
         |GRABA 020#siim0000.b;
     |FINSI;

     |VENTANA 0501, 0857, -1, 16, "Patr묥 del certificado a utilizar";
     n1Vent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     aNom = #siim0000#1;
     E_inf = "";
     E_sup = "254";
     aNom  = 0502 ? 1;

     #siim0000#1 = aNom;
     |GRABA 020#siim0000.a;
     |LIBERA #siim0000;
     |CIERRA #siim0000;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA n1Vent;
|FPRC;

|PROCESO EnvioGen;
     |HAZ PatronCerti;

     |VENTANA 0501, 0540, -1, 16, "Enviando lotes";
     n1Vent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PTEC 802;  |PAUSA;

     aFicTmp = "siiw0207" + Usuario;  |NOME_DAT #siiw0207#aFicTmp#;
     |ABRE #siiw0207;  |CIERRA #siiw0207;  |DELINDEX #siiw0207;

     |BUCLE siim0001E;

     |ABRE #siiw0207;
     |CONSULTA_CLAVE #1#siiw0207;
     |CIERRA #siiw0207;
     |DELINDEX #siiw0207;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA n1Vent;
|FPRC;

|PROCESO GrabaNoti;
     |LEE 000#siim0054.u;
     |SI FSalida ! 0;  |DDEFECTO #siim0054;  |FINSI;

     |HORA aHora;

     nReg = #siim0054#0 + 1;

     |DDEFECTO #siim0054;
     #siim0054#0  = nReg;
     #siim0054#1  = fFechaSys;
     #siim0054#2  = aHora;
     #siim0054#3  = "Caducidad";
     #siim0054#4  = aInci;
     #siim0054#5  = "CADUCIDAD";
     #siim0054#10 = #siim0052#0;

     |GRABA 020#siim0054.n;
     |LIBERA #siim0054;
|FPRC;

|PROCESO siim0052;
     aInci = "";
     nDias = #siim0052#3 - fFechaSys;

     |SI nDias = 90;
         aInci = "Falta 90 d며s para su caducidad";
     |FINSI;

     |SI nDias = 60;
         aInci = "Falta 60 d며s para su caducidad";
     |FINSI;

     |SI nDias = 30;
         aInci = "Falta 30 d며s para su caducidad";
     |FINSI;

     |SI nDias [ 10;
         |SI nDias = 1;
             aInci = "Falta " + nDias  + " d며 para su caducidad";
         |SINO;
             aInci = "Falta " + nDias  + " d며s para su caducidad";
         |FINSI;
     |FINSI;

     |SI nDias < 0;
         aInci = "Certificado caducado";
     |FINSI;

     |SI aInci = "";  |ACABA;  |FINSI;

     |HAZ GrabaNoti;
|FPRC;

|DEFBUCLE siim0052;
     #siim0052#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, siim0052;
|FIN;

|PROCESO Caducidad;
     |ABRE #siim0054;
     |BUCLE siim0052;
     |CIERRA #siim0054;
|FPRC;

|PROGRAMA;
     |SI aModoImp = "ENVIO";
         |VENTANA 0501, 3599, -1, 0, "";
         n2Vent = FSalida;
         |PTEC 802;  |PAUSA;

         |SUB_EJECUTA "siiz0011";

         |FINVENTANA n2Vent;

         |SI eaCert = "";
             |MENAV "0000Proceso cancelado";
             |ACABA;
         |FINSI;

         aParam = "SIIGEN";

         |HAZ EnvioGen;
     |FINSI;

     |SI aModoImp = "TODO";
         aParam = "SIIBOX";

         |HAZ ImportaCSV;
         |HAZ Envio;
         |HAZ Caducidad;
     |FINSI;
|FPRO;

|PROCESO T80;  |TIPO 80;
     |HAZ EsPNT;

     fFechaSys = ~;
     aModoImp  = PARAMETRO;
|FPRC;

|PROCESO T90;  |TIPO 90;
|FPRC;
