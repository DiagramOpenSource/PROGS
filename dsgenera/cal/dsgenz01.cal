|FICHEROS;
      dsgenm01;
      dsgenm02;
      dsgenm03;
      dsgenm04;
      dsgenm05;

      :agitool/agiaudi1;
|FIN;

|VARIABLES;
     rnd             = 0;
     r_semilla       = 0;
     r_vuelta        = 0;
     r_bucle         = 0;
     r_hora          = "";
     r_beta          = "";
     r_punto         = "";
     r_pi            = 3.141592;
     r_producto      = 0.000000;

     nRango          = 0;
     nHandle         = 0;
     nLabel          = -1;
     nBtnGen         = 0;
     nGrid01         = 0;
     n1Vent          = 0;
     n2Vent          = 0;
     n3Vent          = 0;
     nCampo          = 0;
     nLong           = 0;
     nCarac          = 0;
     nPos            = 0;
     nAscii          = 0;
     nCaracter       = 0;
     nDNume          = 0;
     nHNume          = 0;
     nNume           = 0;
     nNume1          = 0;
     nNume2          = 0;
     nNume3          = 0;
     nRepar          = 0;
     nReparto1       = 0;
     nReparto2       = 0;
     nTiempo         = 0;
     nTiempo1        = 0;
     nTiempo2        = 0;
     nTmp            = 0;
     nTmp1           = 0;
     nTmp2           = 0;
     nResto          = 0;
     nHora           = 0;
     nMinu           = 0;
     nSegu           = 0;
     nSegundo        = 0;
     nCal            = 0;
     nValor          = 0;
     nConta          = 0;
     nQuito          = 0;
     nPaso           = 0;
     nPasada         = 0;
     nHasta          = 0;
     nTmpTEMD        = 0;
     nTmpTEMH        = 0;
     nTmpTSMD        = 0;
     nTmpTSMH        = 0;
     nTmpTETD        = 0;
     nTmpTETH        = 0;
     nTmpTSTD        = 0;
     nTmpTSTH        = 0;

     aEsc1           = "";
     aEsc2           = "";
     aRetu           = "";
     aTecla          = "";
     aContenido      = "";
     aLee            = "";
     aAlfa           = "";
     aAlfa1          = "";
     aAlfa2          = "";
     aAlfa3          = "";
     aBase           = "";
     aAbre           = "";
     aMas            = "";
     aOrigen         = "";
     aDestino        = "";
     aParametro1     = "";
     aParametro2     = "";
     aPathDat        = "";
     aRuta           = "";
     aNomFic         = "";
     aLong           = "";
     aCarac          = "";
     aExtension      = "";
     aPunto          = "";
     aPath           = "";
     aPathFic        = "";
     aCadena         = "";
     aCarac1         = "";
     aTab            = "";
     aTiempo         = "";
     aTramo          = "";
     aHora           = "";
     aHora1          = "";
     aHora2          = "";
     aIPRemoto       = "";
     aVersion1       = "";
     aVersion2       = "";
     aTipo           = "";
     aDir            = "";
     aPeri           = "";
     aCampoA         = "";
     aCampoB         = "";
     aCampoC         = "";
     aCampoD         = "";
     aCampoE         = "";

     fFechaM         = @;
     fFechaT         = @;
     fFecha          = @;
     fDFecha         = @;
     fHFecha         = @;

     {1}aLocal       = "";
     {1}aContiene    = "";

     {-1}aVent       = "";
         aVent1      = 0;
         aVent2      = 0;
         aVent3      = 0;
         aVent4      = 0;
         aVent5      = "";
|FIN;

|PROCESO Random;
     r_vuelta = r_vuelta + 1;
     |SI r_semilla [ 0; |O r_vuelta > 200;
          |HORA r_hora;
          r_beta = r_hora % 702;
          r_semilla = r_beta;
          r_vuelta = 0;
     |FINSI;
     r_producto = r_semilla / r_pi;
     r_beta = r_producto;
     |PARA r_bucle = 101;|SI r_bucle < 1000;|HACIENDO r_bucle = r_bucle + 100;
          r_punto = r_beta % r_bucle;
          |SI r_punto = "."; |SAL; |FINSI;
     |SIGUE;
     r_bucle = r_bucle + 104;
     r_beta = r_beta % r_bucle;
     r_semilla = r_beta;
     rnd = r_semilla;
|FPRC;

|PROCESO PonTiempo;
     nHora = 0;
     nMinu = 0;
     nSegu = 0;

     |PARA nSegundo = 1;  |SI nSegundo [ nCal;  |HACIENDO nSegundo = nSegundo + 1;
           nSegu = nSegu + 1;

           |SI nSegu = 60;
               nMinu = nMinu + 1;
               nSegu = 0;
           |FINSI;

           |SI nMinu = 60;
               nHora = nHora + 1;
               nMinu = 0;
               nSegu = 0;
           |FINSI;

           |SI nHora = 24;
               nHora = 0;
               nMinu = 0;
               nSegu = 0;
           |FINSI;
     |SIGUE;

     aTiempo  = (("00" + nHora) % -102) + ":";
     aTiempo  = aTiempo + (("00" + nMinu) % -102) + ":";
     aTiempo  = aTiempo + (("00" + nSegu) % -102);
|FPRC;

|PROCESO Calculagenm03;
     #dsgenm03#4 = #dsgenm03#4 + #dsgenm04#5;
     #dsgenm03#5 = #dsgenm03#4 - #dsgenm03#3;
     #dsgenm03#7 = #dsgenm03#7 + #dsgenm04#10;
     #dsgenm03#8 = #dsgenm03#7 - #dsgenm03#6;
|FPRC;

|PROCESO Calculagenm04;
     #dsgenm04#6  = #dsgenm04#5  - #dsgenm04#4;
     #dsgenm04#11 = #dsgenm04#10 - #dsgenm04#9;
     #dsgenm04#13 = #dsgenm04#5  + #dsgenm04#10;
     #dsgenm04#14 = #dsgenm04#13 - #dsgenm04#12;

     nCal = #dsgenm04#2;  |HAZ PonTiempo;  #dsgenm04#15 = aTiempo;
     nCal = #dsgenm04#3;  |HAZ PonTiempo;  #dsgenm04#16 = aTiempo;
     nCal = #dsgenm04#7;  |HAZ PonTiempo;  #dsgenm04#17 = aTiempo;
     nCal = #dsgenm04#8;  |HAZ PonTiempo;  #dsgenm04#18 = aTiempo;
|FPRC;

|PROCESO EnviaFicheroConMD5;
     |PULSATECLA;

     aIPRemoto = "";
     |IP_REMOTO aIPRemoto;  |QBT aIPRemoto;

     aContiene1 = aOrigen;
     |ESPECIFICA "MD5", aContiene;
     aVersion2 = FSalida; |QBF aVersion2;

     aContiene1 = aDestino;
     |ESPECIFICA "REMOTOMD5", aContiene;
     aVersion1  = FSalida;  |QBF aVersion1;

     |SI aVersion1 ! aVersion2;
          |SI aIPRemoto ! "";
               |ENVIA_FICHERO aOrigen, aDestino;
          |SINO;
               |COPIA_FICHERO aOrigen, aDestino;
          |FINSI;
     |FINSI;

     |PULSATECLA;
|FPRC;

|PROCESO DsSelect;
     aOrigen   = aParametro1 + "dsselect.exe";
     aDestino  = aParametro2 + "dsselect.exe";
     |HAZ EnviaFicheroConMD5;


     aAlfa = aParametro2 + "dsselect.txt";
     |RFBORRA aAlfa;

     aAlfa  = "cmd " + &34 + "/c START /WAIT " + aParametro2 + "dsselect.exe C:\ " + aParametro2 + "dsselect.txt" + &34;
     |RSYSTEM aAlfa;

     aRuta   = "";
     aNomFic = "";

     aAbre = aParametro2 + "dsselect.txt";
     |XABRE "CU", aAbre, nHandle;
     |SI FSalida < 0;   |ACABA;  |FINSI;

     |XLEE nHandle, 250, aRuta;
     |SI FSalida < 0
         aRuta   = "";
         |XCIERRA nHandle;
         |ACABA;
     |FINSI;

     |XCIERRA nHandle;

     |QBF aRuta;
     |SI aRuta = "";  |ACABA;  |FINSI;

     aAlfa    = aRuta;
     aLong    = aAlfa % 0;
     nLong    = aLong;
     |PARA nCarac = 1;  |SI nCarac [ nLong;  |HACIENDO nCarac = nCarac + 1;
           nPos   = (nCarac * 100) + 1;
           aCarac =  aAlfa % nPos;

           nAscii = &aCarac;

           |SI nAscii = 241;  aCarac = "¤";  |FINSI;
           |SI nAscii = 225;  aCarac = " ";  |FINSI;
           |SI nAscii = 233;  aCarac = "‚";  |FINSI;
           |SI nAscii = 237;  aCarac = "¡";  |FINSI;
           |SI nAscii = 243;  aCarac = "¢";  |FINSI;
           |SI nAscii = 250;  aCarac = "£";  |FINSI;

           |SI nAscii = 209;  aCarac = "¥";  |FINSI;
           |SI nAscii = 193;  aCarac = "A";  |FINSI;
           |SI nAscii = 201;  aCarac = "E";  |FINSI;
           |SI nAscii = 205;  aCarac = "I";  |FINSI;
           |SI nAscii = 211;  aCarac = "O";  |FINSI;
           |SI nAscii = 218;  aCarac = "U";  |FINSI;

           |SI aCarac = "/";  |O aCarac = "\";
               aNomFic = "";
           |SINO;
               aNomFic = aNomFic + aCarac;
           |FINSI;
     |SIGUE;

     aExtension = "";
     aPunto     = aNomFic % -401;
     |SI aPunto = ".";
         aExtension = aNomFic % -104;
     |SINO;
         aPunto     = aNomFic % -501;
         |SI aPunto = ".";
             aExtension = aNomFic % -105;
         |FINSI;
     |FINSI;

     aNomFic    = aNomFic - aExtension;
     aExtension = aExtension - ".";

     aAlfa = aParametro2 + "dsselect.txt";
     |RFBORRA aAlfa;
|FPRC;

|PROCESO TraeDatos;
     |MENAV "0000A continuaci¢n busque y seleccione el fichero csv a generar";

     |ESPECIFICA "RBASS", aLocal;
     aLocal = aLocal + "bin/";

     |DBASS aBase;  |QBF aBase;
     aParametro1 = aBase + "dsarchi/dlls/";
     aParametro2 = aLocal;

     |HAZ DsSelect;

     aExtension = aRuta % -103 < "";
     |SI aExtension ! "csv";
         aRuta = "";
         |MENAV "0000Por favor seleccione un fichero csv. Pongase en contacto con Manolo si no tiene informaci¢n sobre el fichero";
     |FINSI;

     |SI aRuta = "";  |ACABA;  |FINSI;

     |DBASE aBase;

     aPath    = aBase + "tmp";           |MKDIR aPath;
     aPath    = aPath + "/" + Usuario;   |MKDIR aPath;
     aPath    = aPath + "/";

     aOrigen  = aRuta;
     aDestino = aPath + "dsgenz01.csv"
     |RECIBE_FICHERO aOrigen, aDestino;

     |VENTANA 0501, 0550, -1, 16, "Recogiendo datos CSV";
     n1Vent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PTEC 802;  |PAUSA;

     aAbre = aDestino;

     |ABRE #dsgenm02;  |CIERRA #dsgenm02;  |DELINDEX #dsgenm02;
     |ABRE #dsgenm03;  |CIERRA #dsgenm03;  |DELINDEX #dsgenm03;
     |ABRE #dsgenm04;  |CIERRA #dsgenm04;  |DELINDEX #dsgenm04;
     |ABRE #dsgenm05;  |CIERRA #dsgenm05;  |DELINDEX #dsgenm05;

     |ABRE #dsgenm02;
     |ABRE #dsgenm03;
     |XABRE "", aAbre, nHandle;
     |PARA;  |SI FSalida ] 0;  |HACIENDO;
          |XLEE nHandle, 250, aLee;
          |SI FSalida < 0;  |SAL;  |FINSI;

          |PULSATECLA;

          aCampoA  = "";
          aCampoB  = "";
          aCampoC  = "";
          aCampoD  = "";
          aCampoE  = "";

          aCadena = aLee;  |QBF aCadena;
          aLong   = aCadena % 0;
          nLong   = aLong;
          nCampo  = 1;
          aTab    = ";";

          |PARA nCaracter = 1;  |SI nCaracter [ nLong;  |HACIENDO nCaracter = nCaracter + 1;
                nPos    = (100 * nCaracter) + 1;
                aCarac1 = aCadena % nPos;
                |SI aCarac1 = aTab;
                    nCampo = nCampo + 1;
                |SINO;
                    |SI nCampo = 1;   aCampoA  = aCampoA  + aCarac1;  |FINSI;
                    |SI nCampo = 2;   aCampoB  = aCampoB  + aCarac1;  |FINSI;
                    |SI nCampo = 3;   aCampoC  = aCampoC  + aCarac1;  |FINSI;
                    |SI nCampo = 4;   aCampoD  = aCampoD  + aCarac1;  |FINSI;
                    |SI nCampo = 5;   aCampoE  = aCampoE  + aCarac1;  |FINSI;

                    |SI nCampo ] 6;  |SAL;  |FINSI;
                |FINSI;
          |SIGUE;

          aCampoA = (aCampoA % 102) + "." + (aCampoA % 402) + "." + (aCampoA % 704);

          #dsgenm02#0  = aCampoB;
          #dsgenm02#1  = aCampoA;
          #dsgenm02#2  = aCampoE;

          nNume = aCampoC;  #dsgenm02#3  = nNume * 3600;
          nNume = aCampoD;  #dsgenm02#4  = nNume * 3600;

          |GRABA 020#dsgenm02.n;
          |LIBERA #dsgenm02;

          aAlfa1 = aCampoA % -104;
          aAlfa2 = aCampoA % 402;
          #dsgenm03#0  = aCampoB;
          #dsgenm03#1  = aAlfa1;
          #dsgenm03#2  = aAlfa2;
          |LEE 101#dsgenm03.=;
          |SI FSalida ! 0;
              |DDEFECTO #dsgenm03;
              #dsgenm03#0  = aCampoB;
              #dsgenm03#1  = aAlfa1;
              #dsgenm03#2  = aAlfa2;
              |GRABA 020#dsgenm03.b;
          |FINSI;

          #dsgenm03#3  = #dsgenm03#3 + #dsgenm02#3;
          #dsgenm03#6  = #dsgenm03#6 + #dsgenm02#4;

          |SI #dsgenm02#3 ! 0;
              #dsgenm03#9  = #dsgenm03#9 + 1;
          |FINSI;

          |SI #dsgenm02#4 ! 0;
              #dsgenm03#10 = #dsgenm03#10 + 1;
          |FINSI;

          |GRABA 020#dsgenm03.a;
          |LIBERA #dsgenm03;
     |SIGUE;
     |XCIERRA nHandle;

     |CIERRA #dsgenm02;
     |CIERRA #dsgenm03;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA n1Vent;
     |PULSATECLA;

     |FBORRA aAbre;
     |PULSATECLA;
|FPRC;

|PROCESO GeneraHora;
     |PARA;  |SI;  |HACIENDO;
         |HAZ Random;
         rnd = rnd $ 1000;

         nNume = nDNume + rnd;
         |SI nNume [ nHNume;
             |SAL;
         |FINSI;
     |SIGUE;
|FPRC;

|PROCESO dsgenm02;
     |SI nLabel ! -1;
         |FIN_CONTROL_WINDOWS nLabel;
     |FINSI;

     aAlfa = "LABEL,{{15}}Usuario " + #dsgenm02#0 + " Fecha " + #dsgenm02#1;
     |CONTROL_SIMPLE 0, aAlfa, 0502, 0550, NULL;
     nLabel = FSalida;

     #dsgenm01#0 = #dsgenm02#2;
     |LEE 000#dsgenm01.=;

     |DDEFECTO #dsgenm04;
     #dsgenm04#0 = #dsgenm02#0;
     #dsgenm04#1 = #dsgenm02#1;

     |SI #dsgenm02#3 ! 0;
         |SI #dsgenm01#2 ! 0;  |O #dsgenm01#3 ! 0;
          |O #dsgenm01#4 ! 0;  |O #dsgenm01#5 ! 0;
             nDNume = ((#dsgenm01#2 * 60) * 60) + (#dsgenm01#3 * 60);
             nHNume = ((#dsgenm01#4 * 60) * 60) + (#dsgenm01#5 * 60);
             nNume  = (nHNume - nDNume) / 60;
             |HAZ GeneraHora;

             #dsgenm04#2 = nNume;
         |FINSI;

         |SI #dsgenm01#6 ! 0;  |O #dsgenm01#7 ! 0;
          |O #dsgenm01#8 ! 0;  |O #dsgenm01#9 ! 0;
             nDNume = ((#dsgenm01#6 * 60) * 60) + (#dsgenm01#7 * 60);
             nHNume = ((#dsgenm01#8 * 60) * 60) + (#dsgenm01#9 * 60);
             nNume  = (nHNume - nDNume) / 60;
             |HAZ GeneraHora;

             #dsgenm04#3 = nNume;
         |FINSI;
     |FINSI;

     |SI #dsgenm02#4 ! 0;
         |SI #dsgenm01#10 ! 0;  |O #dsgenm01#11 ! 0;
          |O #dsgenm01#12 ! 0;  |O #dsgenm01#13 ! 0;
             nDNume = ((#dsgenm01#10 * 60) * 60) + (#dsgenm01#11 * 60);
             nHNume = ((#dsgenm01#12 * 60) * 60) + (#dsgenm01#13 * 60);
             nNume  = (nHNume - nDNume) / 60;
             |HAZ GeneraHora;

             #dsgenm04#7 = nNume;
         |FINSI;

         |SI #dsgenm01#14 ! 0;  |O #dsgenm01#15 ! 0;
          |O #dsgenm01#16 ! 0;  |O #dsgenm01#17 ! 0;
             nDNume = ((#dsgenm01#14 * 60) * 60) + (#dsgenm01#15 * 60);
             nHNume = ((#dsgenm01#16 * 60) * 60) + (#dsgenm01#17 * 60);
             nNume  = (nHNume - nDNume) / 60;
             |HAZ GeneraHora;

             #dsgenm04#8 = nNume;
         |FINSI;
     |FINSI;

     #dsgenm04#4  = #dsgenm02#3;
     #dsgenm04#9  = #dsgenm02#4;
     #dsgenm04#12 = #dsgenm04#4 + #dsgenm04#9;

     |SI #dsgenm04#2 ! 0;  |Y #dsgenm04#3 ! 0;
         #dsgenm04#5 = #dsgenm04#3 - #dsgenm04#2;
     |FINSI;

     |SI #dsgenm04#7 ! 0;  |Y #dsgenm04#8 ! 0;
         #dsgenm04#10 = #dsgenm04#8 - #dsgenm04#7;
     |FINSI;

     |HAZ Calculagenm04;

     |GRABA 020#dsgenm04.n;
     |LIBERA #dsgenm04;

     aAlfa1 = #dsgenm02#1 % -104;
     aAlfa2 = #dsgenm02#1 % 402;

     #dsgenm03#0  = #dsgenm02#0;
     #dsgenm03#1  = aAlfa1;
     #dsgenm03#2  = aAlfa2;
     |LEE 101#dsgenm03.=;
     |SI FSalida ! 0;
         |DDEFECTO #dsgenm03;
         #dsgenm03#0  = #dsgenm02#0;
         #dsgenm03#1  = aAlfa1;
         #dsgenm03#2  = aAlfa2;
         |GRABA 020#dsgenm03.b;
     |FINSI;

     |HAZ Calculagenm03;

     |GRABA 020#dsgenm03.a;
     |LIBERA #dsgenm03;

     |PULSATECLA;
|FPRC;

|DEFBUCLE dsgenm02;
     #dsgenm02#2;
     ;
     INICIO;
     FINAL;
     ;
     NULL, dsgenm02;
|FIN;

|PROCESO RepartoManana;
     |SI #dsgenm04#2 = 0;  |Y  #dsgenm04#3 = 0;
         |ACABA;
     |FINSI;

     nRepar = nReparto1;
     |SI nRepar = 0;  |ACABA;  |FINSI;

     nQuito = 0;
     nPaso  = 0;
     |PARA;  |SI nRepar ! 0;  |HACIENDO;
         nQuito = nQuito + 1;
         nPaso  = nPaso  + 1;

         |SI nRepar > 0;
             |SI nQuito = 1;
                 |SI #dsgenm04#3 > nTmpTSMD;
                     #dsgenm04#3 = #dsgenm04#3 - 1;

                     nRepar      = nRepar - 1;
                     nPaso       = 0;
                 |FINSI;
             |FINSI;

             |SI nQuito = 2;
                 |SI #dsgenm04#2 < nTmpTEMH;
                     #dsgenm04#2 = #dsgenm04#2 + 1;

                     nRepar      = nRepar - 1;
                     nPaso       = 0;
                 |FINSI;
             |FINSI;
         |SINO;
             |SI nQuito = 1;
                 |SI #dsgenm04#3 < nTmpTSMH;
                     #dsgenm04#3 = #dsgenm04#3 + 1;

                     nRepar      = nRepar + 1;
                     nPaso       = 0;
                 |FINSI;
             |FINSI;

             |SI nQuito = 2;
                 |SI #dsgenm04#2 > nTmpTEMD;
                     #dsgenm04#2 = #dsgenm04#2 - 1;

                     nRepar      = nRepar + 1;
                     nPaso       = 0;
                 |FINSI;
             |FINSI;
         |FINSI;

         |SI nPaso  > 2;  |SAL;  |FINSI;

         |SI nQuito = 2;  nQuito = 0;  |FINSI;
     |SIGUE;

     |SI nRepar ! 0;
         nTiempo = #dsgenm04#5 - nReparto1;

         |HORA aHora;
         aAlfa = aHora % -102;
         nNume = aAlfa;

         #dsgenm04#2 = nTmpTEMD + nNume;
         nHasta      = nTmpTSMD + nNume;

         |PARA nSegu = #dsgenm04#2;  |SI;  |HACIENDO;
               #dsgenm04#2 = nSegu;
               #dsgenm04#3 = nSegu + nTiempo;
               |SI #dsgenm04#3 ] nHasta;
                   |SAL;
               |FINSI;

               nSegu = nSegu + 1;
         |SIGUE;
     |FINSI;
|FPRC;

|PROCESO RepartoTarde;
     |SI #dsgenm04#7 = 0;  |Y  #dsgenm04#8 = 0;
         |ACABA;
     |FINSI;

     nRepar = nReparto2;
     |SI nRepar = 0;  |ACABA;  |FINSI;

     nQuito = 0;
     nPaso  = 0;
     |PARA;  |SI nRepar ! 0;  |HACIENDO;
         nQuito = nQuito + 1;
         nPaso  = nPaso  + 1;

         |SI nRepar > 0;
             |SI nQuito = 1;
                 |SI #dsgenm04#8 > nTmpTSTD;
                     #dsgenm04#8 = #dsgenm04#8 - 1;

                     nRepar      = nRepar - 1;
                     nPaso       = 0;
                 |FINSI;
             |FINSI;

             |SI nQuito = 2;
                 |SI #dsgenm04#7 < nTmpTETH;
                     #dsgenm04#7 = #dsgenm04#7 + 1;

                     nRepar      = nRepar - 1;
                     nPaso       = 0;
                 |FINSI;
             |FINSI;
         |SINO;
             |SI nQuito = 1;
                 |SI #dsgenm04#8 < nTmpTSTH;
                     #dsgenm04#8 = #dsgenm04#8 + 1;

                     nRepar      = nRepar + 1;
                     nPaso       = 0;
                 |FINSI;
             |FINSI;

             |SI nQuito = 2;
                 |SI #dsgenm04#7 > nTmpTETD;
                     #dsgenm04#7 = #dsgenm04#7 - 1;

                     nRepar      = nRepar + 1;
                     nPaso       = 0;
                 |FINSI;
             |FINSI;
         |FINSI;

         |SI nPaso  > 2;  |SAL;  |FINSI;

         |SI nQuito = 2;  nQuito = 0;  |FINSI;
     |SIGUE;

     |SI nRepar ! 0;
         nTiempo = #dsgenm04#10 - nReparto2;

         |HORA aHora;
         aAlfa = aHora % -102;
         nNume = aAlfa;

         #dsgenm04#7 = nTmpTETD + nNume;
         nHasta      = nTmpTSTD + nNume;

         |PARA nSegu = #dsgenm04#7;  |SI;  |HACIENDO;
               #dsgenm04#7 = nSegu;
               #dsgenm04#8 = nSegu + nTiempo;
               |SI #dsgenm04#8 ] nHasta;
                   |SAL;
               |FINSI;

               nSegu = nSegu + 1;
         |SIGUE;
     |FINSI;
|FPRC;

|PROCESO dsgenm04Rec;
     |SI nPasada = 0;
         #dsgenm02#0 = #dsgenm04#0;
         #dsgenm02#1 = #dsgenm04#1;
         |LEE 000#dsgenm02.=;

         #dsgenm01#0 = #dsgenm02#2;
         |LEE 000#dsgenm01.=;

         nTmpTEMD = ((#dsgenm01#2  * 60) * 60) + (#dsgenm01#3  * 60);
         nTmpTEMH = ((#dsgenm01#4  * 60) * 60) + (#dsgenm01#5  * 60);
         nTmpTSMD = ((#dsgenm01#6  * 60) * 60) + (#dsgenm01#7  * 60);
         nTmpTSMH = ((#dsgenm01#8  * 60) * 60) + (#dsgenm01#9  * 60);

         nTmpTETD = ((#dsgenm01#10 * 60) * 60) + (#dsgenm01#11 * 60);
         nTmpTETH = ((#dsgenm01#12 * 60) * 60) + (#dsgenm01#13 * 60);
         nTmpTSTD = ((#dsgenm01#14 * 60) * 60) + (#dsgenm01#15 * 60);
         nTmpTSTH = ((#dsgenm01#16 * 60) * 60) + (#dsgenm01#17 * 60);

         |SI nReparto1 ! 0;  |HAZ RepartoManana;  |FINSI;
         |SI nReparto2 ! 0;  |HAZ RepartoTarde;   |FINSI;

         |SI #dsgenm04#2 ! 0;  |Y #dsgenm04#3 ! 0;
             #dsgenm04#5 = #dsgenm04#3 - #dsgenm04#2;
         |FINSI;

         |SI #dsgenm04#7 ! 0;  |Y #dsgenm04#8 ! 0;
             #dsgenm04#10 = #dsgenm04#8 - #dsgenm04#7;
         |FINSI;

         |HAZ Calculagenm04;

         |GRABA 020#dsgenm04.a;
         |LIBERA #dsgenm04;

         |SI #dsgenm04#4 ! 0;  fFechaM = #dsgenm04#1;  |FINSI;
         |SI #dsgenm04#7 ! 0;  fFechaT = #dsgenm04#1;  |FINSI;
     |FINSI;

     |HAZ Calculagenm03;

     |PULSATECLA;
|FPRC;

|DEFBUCLE dsgenm04Rec;
     #dsgenm04#1;
     ;
     #dsgenm03#0, fDFecha;
     #dsgenm03#0, fHFecha;
     be;
     NULL, dsgenm04Rec;
|FIN;

|PROCESO RestoManana;
     #dsgenm02#0 = #dsgenm04#0;
     #dsgenm02#1 = #dsgenm04#1;
     |LEE 000#dsgenm02.=;

     #dsgenm01#0 = #dsgenm02#2;
     |LEE 000#dsgenm01.=;

     nTmpTEMD = ((#dsgenm01#2  * 60) * 60) + (#dsgenm01#3  * 60);
     nTmpTEMH = ((#dsgenm01#4  * 60) * 60) + (#dsgenm01#5  * 60);
     nTmpTSMD = ((#dsgenm01#6  * 60) * 60) + (#dsgenm01#7  * 60);
     nTmpTSMH = ((#dsgenm01#8  * 60) * 60) + (#dsgenm01#9  * 60);

     |HAZ RepartoManana;

     |SI #dsgenm04#2 ! 0;  |Y #dsgenm04#3 ! 0;
         #dsgenm04#5 = #dsgenm04#3 - #dsgenm04#2;
     |FINSI;

     |HAZ Calculagenm04;

     |GRABA 020#dsgenm04.a;
     |LIBERA #dsgenm04;
|FPRC;

|PROCESO RestoTarde;
     #dsgenm02#0 = #dsgenm04#0;
     #dsgenm02#1 = #dsgenm04#1;
     |LEE 000#dsgenm02.=;

     #dsgenm01#0 = #dsgenm02#2;
     |LEE 000#dsgenm01.=;

     nTmpTETD = ((#dsgenm01#10 * 60) * 60) + (#dsgenm01#11 * 60);
     nTmpTETH = ((#dsgenm01#12 * 60) * 60) + (#dsgenm01#13 * 60);
     nTmpTSTD = ((#dsgenm01#14 * 60) * 60) + (#dsgenm01#15 * 60);
     nTmpTSTH = ((#dsgenm01#16 * 60) * 60) + (#dsgenm01#17 * 60);

     |HAZ RepartoTarde;

     |SI #dsgenm04#7 ! 0;  |Y #dsgenm04#8 ! 0;
         #dsgenm04#10 = #dsgenm04#8 - #dsgenm04#7;
     |FINSI;

     |HAZ Calculagenm04;

     |GRABA 020#dsgenm04.a;
     |LIBERA #dsgenm04;
|FPRC;

|PROCESO dsgenm03;
     |SI nLabel ! -1;
         |FIN_CONTROL_WINDOWS nLabel;
     |FINSI;

     aAlfa = "LABEL,{{15}}Usuario " + #dsgenm03#0 + " A¤o " + #dsgenm03#1 + "   Mes " + #dsgenm03#2;
     |CONTROL_SIMPLE 0, aAlfa, 0502, 0550, NULL;
     nLabel = FSalida;

    aAlfa   = "01." + (("00" + #dsgenm03#2) % -102) + "." + #dsgenm03#1;
    fDFecha = aAlfa;
    aAlfa   = "31." + (("00" + #dsgenm03#2) % -102) + "." + #dsgenm03#1;
    fHFecha = aAlfa;

    nReparto1 = (#dsgenm03#5 / #dsgenm03#9)  ! 0;
    nReparto2 = (#dsgenm03#8 / #dsgenm03#10) ! 0;

    |SI nReparto1 = 0;  |Y nReparto2 = 0;
        |ACABA;
    |FINSI;

    #dsgenm03#4 = 0;
    #dsgenm03#5 = 0;
    #dsgenm03#7 = 0;
    #dsgenm03#8 = 0;

    nPasada = 0;  |BUCLE dsgenm04Rec;

    |ABRE #dsgenm04;
    |SI #dsgenm03#5 ! 0;
        #dsgenm04#0 = #dsgenm03#0;
        #dsgenm04#1 = fFechaM;
        |LEE 101#dsgenm04.=;
        |SI FSalida = 0;
            nReparto1 = #dsgenm03#5;

            |HAZ RestoManana;
        |FINSI;
    |FINSI;

    |SI #dsgenm03#8 ! 0;
        #dsgenm04#0 = #dsgenm03#0;
        #dsgenm04#1 = fFechaT;
        |LEE 101#dsgenm04.=;
        |SI FSalida = 0;
            nReparto2 = #dsgenm03#8;

            |HAZ RestoTarde;
        |FINSI;
    |FINSI;
    |CIERRA #dsgenm04;

    #dsgenm03#4 = 0;
    #dsgenm03#5 = 0;
    #dsgenm03#7 = 0;
    #dsgenm03#8 = 0;

    nPasada = 1;  |BUCLE dsgenm04Rec;

    |GRABA 020#dsgenm03.a;
    |LIBERA #dsgenm03;

    |PULSATECLA;
|FPRC;

|DEFBUCLE dsgenm03;
     #dsgenm03#1;
     ;
     INICIO;
     FINAL;
     be;
     NULL, dsgenm03;
|FIN;

|PROCESO CalculaHoras;
     |VENTANA 0501, 0550, -1, 16, "Calculando horas";
     n1Vent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PTEC 802;  |PAUSA;

     nLabel = -1;

     |ABRE #dsgenm01;
     |ABRE #dsgenm03;
     |ABRE #dsgenm04;
     |BUCLE dsgenm02;
     |CIERRA #dsgenm01;
     |CIERRA #dsgenm03;
     |CIERRA #dsgenm04;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA n1Vent;
|FPRC;

|PROCESO ReparteHoras;
     |VENTANA 0501, 0550, -1, 16, "Repartiendo horas";
     n1Vent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PTEC 802;  |PAUSA;

     nLabel = -1;
     |ABRE #dsgenm02;
     |BUCLE dsgenm03;
     |CIERRA #dsgenm02;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA n1Vent;
|FPRC;

|PROCESO GrabaDsgenm05;
     #dsgenm05#0  = #dsgenm04#1;
     #dsgenm05#1  = aHora;
     #dsgenm05#2  = #dsgenm04#0;
     #dsgenm05#5  = "diagram9";

     |SI aTipo = "E";
         #dsgenm05#3  = 1;
         #dsgenm05#4  = "Entrada usuario";
         #dsgenm05#6  = "Acceso";
     |FINSI;

     |SI aTipo = "S";
         #dsgenm05#3  = 0;
         #dsgenm05#4  = "Incidencia gen‚rica";
         #dsgenm05#6  = "SERVIDOR OFF";
     |FINSI;

     |GRABA 020#dsgenm05.n;
     |LIBERA #dsgenm05;
|FPRC;

|PROCESO dsgenm04;
     |SI #dsgenm04#2 ! 0;
         aTipo = "E";
         aPeri = "M";
         aHora = #dsgenm04#15;
         |HAZ GrabaDsgenm05;
     |FINSI;

     |SI #dsgenm04#3 ! 0;
         aTipo = "S";
         aPeri = "M";
         aHora = #dsgenm04#16;
         |HAZ GrabaDsgenm05;
     |FINSI;

     |SI #dsgenm04#7 ! 0;
         aTipo = "E";
         aPeri = "T";
         aHora = #dsgenm04#17;
         |HAZ GrabaDsgenm05;
     |FINSI;

     |SI #dsgenm04#8 ! 0;
         aTipo = "S";
         aPeri = "T";
         aHora = #dsgenm04#18;
         |HAZ GrabaDsgenm05;
     |FINSI;
|FPRC;

|DEFBUCLE dsgenm04;
     #dsgenm04#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, dsgenm04;
|FIN;

|PROCESO CreaTempoDat;
     |VENTANA 0501, 0550, -1, 16, "Creando temporal para el agiaudif";
     n1Vent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PTEC 802;  |PAUSA;

     nLabel = -1;

     |ABRE #dsgenm05;
     |BUCLE dsgenm04;
     |CIERRA #dsgenm05;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA n1Vent;
|FPRC;

|PROCESO dsgenm05;
     |SI fFecha ! #dsgenm05#0;
         aAlfa = (#dsgenm05#0 % -104) + (#dsgenm05#0 % 402) + (#dsgenm05#0 % 102);
         |PATH_DAT #agiaudi1#aPathDat#;
         |NOME_DAT #agiaudi1#aAlfa#;
         nConta = 0;
     |FINSI;

     nConta = nConta + 1;

     |ABRE #agiaudi1;
     #agiaudi1#0  = nConta;
     #agiaudi1#1  = #dsgenm05#0;
     #agiaudi1#2  = (#dsgenm05#1 % 102) + (#dsgenm05#1 % 402) + (#dsgenm05#1 % 702);
     #agiaudi1#3  = #dsgenm05#2;
     #agiaudi1#4  = 0;
     #agiaudi1#5  = 0;
     #agiaudi1#6  = #dsgenm05#3;
     #agiaudi1#7  = #dsgenm05#5;
     #agiaudi1#8  = "";
     #agiaudi1#9  = #dsgenm05#6;

     |GRABA 020#agiaudi1.n;
     |LIBERA #agiaudi1;

     |CIERRA #agiaudi1;

     fFecha = #dsgenm05#0;
|FPRC;

|DEFBUCLE dsgenm05;
     #dsgenm05#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, dsgenm05;
|FIN;

|PROCESO CreaDat;
     |CONFI "0000SQuiere crear los dat con los datos presentados";
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |VENTANA 0501, 0550, -1, 16, "Creando dat agiaudif";
     n1Vent = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |PTEC 802;  |PAUSA;

     nLabel = -1;

     |DBASE aBase;
     aPathDat = aBase + "logs";  |MKDIR aPathDat;
     aPathDat = aBase + "logs/";

     aDir = aPathDat + "*.*";
     |_PDIR aDir;
     |PARA;  |SI FSalida = 0;  |HACIENDO;
             |FBORRA aDir;
             |_SDIR aDir;
     |SIGUE;

     fFecha = "00.00.0000";
     |BUCLE dsgenm05;

     aDir = aPathDat + "*.*";
     |_PDIR aDir;
     |PARA;  |SI FSalida = 0;  |HACIENDO;
             aAlfa = aDir % -103;
             |SI aAlfa ! "dat";  |FBORRA aDir;  |FINSI;

             |_SDIR aDir;
     |SIGUE;

     aAlfa = "0000Los dats generados se encuentran en alba en el directorio " + aPathDat;
     |MENAV aAlfa;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = n1Vent;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA n1Vent;
|FPRC;

|PROCESO BtnGen;
     |HAZ TraeDatos;
     |HAZ CalculaHoras;
     |HAZ ReparteHoras;
     |HAZ CreaTempoDat;

     |ABRE #dsgenm03;
     |ABRE #dsgenm05;
     |CONSULTA_CLAVE #1#dsgenm03;
     |CONSULTA_CLAVE #1#dsgenm05;
     |CIERRA #dsgenm03;
     |CIERRA #dsgenm05;

     |HAZ CreaDat;
|FPRC;

|PROCESO Evt01;
     |SI FSalida = 1;  |O FSalida = 2;
         |LEE 000#dsgenm01.=;
     |FINSI;
|FPRC;

|PROGRAMA;
     |CABEZA "Generador automatico de logs";

     aAlfa = "LABEL,{{15}}GENERADOR AUTOMATICO DE LOGS ";
     |CONTROL_SIMPLE 0, aAlfa,  0502, 0599, NULL;


     |CONTROL_SIMPLE 0, "BOTON,{{197}}Generar", 1788, 1798, BtnGen;
     nBtnGen = FSalida;

     |CONTROL_SIMPLE 0, "LABEL,{{15}}MA¥ANA", 0738, 0749, NULL;

     |CONTROL_SIMPLE 0, "LABEL,{{16}}Entrada", 0829, 0837, NULL;
     |CONTROL_SIMPLE 0, "LABEL,{{16}}Desde", 0924, 0932, NULL;
     |CONTROL_SIMPLE 0, "LABEL,{{16}}Hasta", 0934, 0942, NULL;

     |CONTROL_SIMPLE 0, "LABEL,{{16}}Salida", 0849, 0857, NULL;
     |CONTROL_SIMPLE 0, "LABEL,{{16}}Desde", 0944, 0950, NULL;
     |CONTROL_SIMPLE 0, "LABEL,{{16}}Hasta", 0952, 0960, NULL;

     |CONTROL_SIMPLE 0, "LABEL,{{15}}TARDE", 0777, 0789, NULL;

     |CONTROL_SIMPLE 0, "LABEL,{{16}}Entrada", 0867, 0875, NULL;
     |CONTROL_SIMPLE 0, "LABEL,{{16}}Desde", 0962, 0970, NULL;
     |CONTROL_SIMPLE 0, "LABEL,{{16}}Hasta", 0972, 0980, NULL;

     |CONTROL_SIMPLE 0, "LABEL,{{16}}Salida", 0887, 0896, NULL;
     |CONTROL_SIMPLE 0, "LABEL,{{16}}Desde", 0982, 0990, NULL;
     |CONTROL_SIMPLE 0, "LABEL,{{16}}Hasta", 0992, 0999, NULL;

     aAlfa = "LABEL,{{15}}Recogeremos un csv con las siguientes columnas: ";
     |CONTROL_SIMPLE 0, aAlfa, 1902, 1999, NULL;

     aAlfa = "LABEL,{{16}}Columna A: Fecha";
     |CONTROL_SIMPLE 0, aAlfa, 2004, 2099, NULL;

     aAlfa = "LABEL,{{16}}Columna B: Usuario";
     |CONTROL_SIMPLE 0, aAlfa, 2104, 2199, NULL;

     aAlfa = "LABEL,{{16}}Columna C: Horas ma¤ana";
     |CONTROL_SIMPLE 0, aAlfa, 2204, 2299, NULL;

     aAlfa = "LABEL,{{16}}Columna D: Horas tarde";
     |CONTROL_SIMPLE 0, aAlfa, 2304, 2399, NULL;

     aAlfa = "LABEL,{{16}}Columna E: Turno";
     |CONTROL_SIMPLE 0, aAlfa, 2404, 2499, NULL;

     nRango = 1 + 4 + 8 + 16 + 32 + 128 + 256 + 512 + 1024;

     |LINEAL_SIMPLE #1#dsgenm01, nRango, 1002, 1698, NULL, NULL, Evt01;
     nGrid01 = FSalida;

     aEsc1  = &255 + "806";
     aEsc2  = &255 + "807";
     aRetu  = &255 + "802";
     |PARA; |SI;  |HACIENDO;
         FSalida = "::{{001}}Salir," + nGrid01;
         |LEETECLA aTecla;
         |SI aTecla = aEsc1; |SAL;  |FINSI;
         |SI aTecla = aEsc2; |SAL;  |FINSI;
         |SI aTecla = aRetu; |SAL;  |FINSI;
     |SIGUE;

     |FIN_CONTROL_WINDOWS nBtnGen;

     |PULSATECLA;
|FPRO;

|PROCESO Tipo80;  |TIPO 80;
     |DFICE aPathFic;
     |PATH_DAT #agiaudi1#aPathFic#;

     |ABRET #dsgenm01;

     FSalida = 2599;
|FPRC;

|PROCESO Tipo90;  |TIPO 90;
     |CIERRAT #dsgenm01;

     |ABRE #dsgenm02;  |CIERRA #dsgenm02;  |DELINDEX #dsgenm02;
     |ABRE #dsgenm03;  |CIERRA #dsgenm03;  |DELINDEX #dsgenm03;
     |ABRE #dsgenm04;  |CIERRA #dsgenm04;  |DELINDEX #dsgenm04;
     |ABRE #dsgenm05;  |CIERRA #dsgenm05;  |DELINDEX #dsgenm05;
|FPRC;
