|FICHEROS;
     juanma15 #0;
     juanma16 #1,MANTE;
     juanma17 #2,MANTE;

     referen@ #100;
|FIN;

|VARIABLES;
     aBase        = "";
     aAbre        = "";
     aDef         = "";
     aCarga       = "";
     aMensa       = "";
     aRelacion    = "";
     aQueQuiero   = "";
     aFichero     = "";
     aNombreDef   = "";
     aNumeroCampo = "";
     aNombreCampo = "";
     aTipoCampo   = "";
     aLongCampo   = "";
     aAlfa        = "";
     aAlfa1       = "";
     aAlfa2       = "";
     aAlfa3       = "";
     aAlfa4       = "";
     aCaracter    = "";
     aLong        = "";
     aDirInfor    = "";
     aInformes    = "";
     aBuscar      = "";
     aFicBuscar   = "";
     aCanal       = "";
     aVariable    = "";
     aCampo       = "";
     aEuro        = "";
     aDecimal     = "";
     aLongitud    = "";
     aOrden       = "";
     aRuta        = "";
     aCadena      = "";
     aSustituto   = "";

     nHandle      = 0;
     nSwPrint     = 0;
     nTCampo      = 0;
     nCampo       = 0;
     nLong        = 0;
     nPosi        = 0;
     nCaracter    = 0;
     nNume        = 0;
     nSwHay       = 0;
     nFic         = 0;
     nCanal       = 0;
     nFichero     = 0;
     nSwGraba     = 0;
|FIN;

|RUTINA ClaveBaja2;
     #2#0 = #1#0;
     #2#1 = 0;
|FRUT;

|RUTINA ClaveAlta2;
     #2#0 = #1#0;
     #2#1 = 99;
|FRUT;

|PROCESO Base;  |TIPO 7;
     aBase = #0#0;               |QBF aBase;
     |SI aBase = "";
         |DBASS aBase;               |QBF aBase;
         #0#0 = aBase;
         |PINTA #0#0;
     |FINSI;
|FPRC;

|PROCESO Browse;  |TIPO 0;
     |SI FSalida = 10;
         aRuta = "D" + #0Campo;
         |BROWSE aRuta;
         #0Campo = aRuta % 280;
         |PINTA #0Campo;
         |ERROR;
         |ACABA;
     |FINSI;

     aAlfa  = #0Campo > "";   |QBF aAlfa;
     aAlfa1 = #0#1;           |QBF aAlfa1;
     aAlfa1 = aAlfa1 + "\DEF";
     aAlfa1 = aAlfa1 > "";   |QBF aAlfa1;
     aAlfa1 = aAlfa - aAlfa1;
     |SI aAlfa = aAlfa1;
         |MENAV "     Ubicacion Erronea";
         |ERROR;
     |FINSI;
|FPRC;

|PROCESO BuscaFichero;
     |QBF aAlfa;
     |SI aAlfa = "FIC";  nFic = 1;  |ACABA;  |FINSI;
     |SI aAlfa = "VAR";  nFic = 2;  |ACABA;  |FINSI;

     |SI nFic = 1;
         aLong    = aAlfa % 0;
         nLong    = aLong;
         nFichero = 0;
         aFichero = "";
         aCanal   = "";
         |PARA nCampo = 1;  |SI nCampo [ nLong;  |HACIENDO nCampo = nCampo + 1;
               nPosi     = (nCampo * 100) + 1;
               aCaracter = aAlfa % nPosi;
               |SI aCaracter = "#";
                    nFichero = 1;
               |SINO;
                    |SI nFichero = 0;
                        aFichero = aFichero + aCaracter;
                    |SINO;
                        aCanal   = aCanal + aCaracter;
                    |FINSI;
               |FINSI;
         |SIGUE;
         |SI aCanal = "";  |ACABA;  |FINSI;

         |QBF aFichero;
         |SI aFicBuscar ! "";
             |SI aFichero ! aFicBuscar;  |ACABA;  |FINSI;
         |FINSI;

         aCampo   = "";
         aDef     = aDirInfor + aFichero + ".mas";
         |CARGA_DEF aDef, referen@;
         |SI FSalida = 0;
             aQueQuiero = "|TITULO";
             aCampo     = #100#aQueQuiero#;
             nCanal     = aCanal;

             #2#0   = aInformes;
             #2#1   = nCanal;
             #2#2   = aFichero;
             #2#3   = aCampo;
             |GRABA 020#2n;

             nSwGraba = 1;
             |DESCARGA_DEF #referen@;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO CreaInforme;
     nSwGraba  = 0;
     nFic      = 0;
     aLong     = aInformes % 0;
     nLong     = aLong;
     |SI nLong > 12;  |ACABA;  |FINSI;

     |XABRE "U", aBuscar, nHandle;
     |PARA;  |SI  FSalida ] 0;  |HACIENDO;
             |XLEE nHandle, 250, aAlfa;
             |SI FSalida < 0;  |SAL;  |FINSI;


             |HAZ BuscaFichero;
             |SI nFic = 2;  |SAL;  |FINSI;
     |SIGUE;
     |XCIERRA  nHandle;

     |SI nSwGraba = 1;
         #1#0 = aInformes;
         |GRABA 000#1n;
         |LIBERA #1;
         nSwHay = 1;
     |FINSI;
|FPRC;

|RUTINA ClaveBaja1;
     #1#0 = "        ";
|FRUT;

|RUTINA ClaveAlta1;
     #1#0 = "zzzzzzzz";
|FRUT;

|PROCESO Tipo3;  |TIPO 3;
     aDirInfor  = #0#0;   |QBF aDirInfor;
     aDirInfor  = aDirInfor + #0#1;  |QBF aDirInfor;
     aDirInfor  = aDirInfor + "/def/";
     aBuscar    = aDirInfor + "*.inf";
     nSwHay     = 0;
     aFicBuscar = #0#5;  |QBF aFicBuscar;

     |ABRE #1;
     |ABRE #2;
     |_PDIR aBuscar;
     |PARA; |SI; |HACIENDO;
         aInformes = aBuscar   - aDirInfor;
         aInformes = aInformes - ".inf";
         #0#2      = aInformes;
         |PINTA #0#2;

         |HAZ CreaInforme;

         |_SDIR aBuscar;
         |SI FSalida ! 0; |SAL; |FINSI;
     |SIGUE;
     |CIERRA #1;
     |CIERRA #2;

     |SI nSwHay = 0;
         |MENAV  "      No hay informes en la Aplicacion ";
         |ACABA;
     |FINSI;

     |ENTLINEAL #1#1, -1, 4, 22, 1, ClaveBaja1, ClaveAlta1;
|FPRC;

|PROGRAMA;
     aFichero = ("16" + Usuario + "zzzzzzzz") % 108;  |NOME_DAT #1 aFichero;
     aFichero = ("17" + Usuario + "zzzzzzzz") % 108;  |NOME_DAT #2 aFichero;

     |ABRE #1;  |CIERRA #1;  |DELINDEX #1;
     |ABRE #2;  |CIERRA #2;  |DELINDEX #2;

     |ABRE #0;
     #0#6 = Usuario;
     |LEE 040#0=;
     |SI FSalida ! 0;
         |DDEFECTO #0;
         #0#6 = Usuario;
         |GRABA 000#0b;
     |FINSI;

     |CLS;
     |CABEZA "Cambio a EURO Informes";
     |PINPA #0#0;
     |PINDA #0#0;
     |ENDATOS #1#0;
     |SI FSalida = 0;
         |GRABA 000#0a;
         |HAZ Tipo3;
     |FINSI;
     |LIBERA #0;
     |CIERRA #0;

     |ABRE #1;  |CIERRA #1;  |DELINDEX #1;
     |ABRE #2;  |CIERRA #2;  |DELINDEX #2;
|FPRO;

|| Calculo Programa juanma11

|PROCESO Tipo7m16;  |TIPO 7;
     |ENTLINEAL #1#2, -2, 7, 22, 0, ClaveBaja2, ClaveAlta2;
|FPRC;

|PROCESO Tipo11m16;  |TIPO 11;
     |SI FSalida = 10;
         |SI #0#3 = "        ";
             #0#3 = "NULL";
         |FINSI;

         aOrden  = "../ut/aginfont " + #0#4;         |QBF aOrden;
         aOrden  = aOrden + "/ "  + #0#3;            |QBF aOrden;
         aOrden  = aOrden + " "   + #1#0;            |QBF aOrden;
         |RSYSTEM aOrden;

         aInformes = #1#0;
         aBuscar   = aDirInfor + #1#0;  |QBF aBuscar;
         aBuscar   = aBuscar + ".inf";

         |ERROR;
     |FINSI;
|FPRC;
