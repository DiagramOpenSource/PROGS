|FICHEROS;
     juanma18 #0;
     juanmw06 #98,MANTE;

     referen@ #100;
|FIN;

|VARIABLES;
     aBase        = "";
     aAbre        = "";
     aDef         = "";
     aCarga       = "";
     aMensa       = "";
     aRelacion    = "";
     aTitulo      = "";
     aQueQuiero   = "";
     aFichero     = "";
     aNombreDef   = "";
     aNumeroCampo = "";
     aNombreCampo = "";
     aTipoCampo   = "";
     aLongCampo   = "";
     aMinCampo    = "";
     aMaxCampo    = "";
     aAlfa        = "";
     aAlfa1       = "";
     aAlfa2       = "";
     aAlfa3       = "";
     aAlfa4       = "";
     aCaracter    = "";
     aLong        = "";
     aCadena      = "";
     aAntes       = "";

     nError       = 0;
     nPon         = 0;
     nHandle      = 0;
     nContador    = 0;
     nSwPrint     = 0;
     nTCampo      = 0;
     nCampo       = 0;
     nLong        = 0;
     nPosi        = 0;
     nCaracter    = 0;
     nDecimal     = 0;
     nDecimales   = 0;
     nNume        = 0;
     nBoton1      = 0;
     nBoton2      = 0;
     nBoton3      = 0;
     nBoton4      = 0;
     nBoton5      = 0;
     nBoton6      = 0;
     nBoton7      = 0;
     nBoton8      = 0;
     nBoton9      = 0;
     nBoton10     = 0;
     nBoton11     = 0;
     nBoton12     = 0;
     nTecla       = 0;
     nContaCambio = 0;
     nSwHay       = 0;
     nCambia      = 0;
     nModo        = 0;
|FIN;

|PROCESO Repetido;
     |DBASE aDef;  |QBF aDef;
     aDef  = aDef + "/def/juanmw06.mas";

     |CARGA_DEF aDef, referen@;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     aFichero = ("w6" + Usuario + "zzzzzzzz") % 108;
     |NOME_DAT #100 aFichero;

     |ABRE #100;
     |SELECT #2#100;
     #100#3 = #98#3;
     |LEE 040#100=;
     |SI FSalida = 0;  |Y #100#1 ! #98#1;
         |MENAV "0000 Identificador Repetido";
         |ERROR;
     |FINSI;
     |CIERRA #100;

     |DESCARGA_DEF #referen@;
|FPRC;

|PROCESO Tipo2;  |TIPO 2;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 3;
         |MENAV "0000 Que haces loco.";
         |ERROR;
     |FINSI;
|FPRC;

|PROCESO Base;  |TIPO 7;
     aBase = #0#0;               |QBF aBase;
     |SI aBase = "";
         |DBASS aBase;               |QBF aBase;
         #0#0 = aBase;
         |PINTA #0#0;
     |FINSI;
|FPRC;

|PROCESO Fichero;  |TIPO 7;
     aBase = #0#0;         |QBF aBase;
     #0#5 = aBase + "ut/batch.txt";
     |PINTA #0#5;
|FPRC;

|PROCESO MiraDef;
     aBase    = #0#0;               |QBF aBase;
     aBase    = aBase + #0#1;       |QBF aBase;
     aDef     = aBase + "/def/";
     aCarga   = aDef + #0#2 + ".mas";  |QBT aCarga;
     nSwPrint = 0;

     aMensa = "      Cargando Def " + aCarga;
     |MENSA aMensa;

     |CARGA_DEF aCarga, referen@;
     |SI FSalida = 0;
         |ABRE #98;
         aQueQuiero = "|TITULO";
         aTitulo    = #100#aQueQuiero#;

         aQueQuiero  = "|NC";
         aFichero    = #100#aQueQuiero#;
         nTCampo     = aFichero;
         nTCampo     = nTCampo - 1;
         |PARA nCampo = 0;  |SI nCampo [ nTCampo;  |HACIENDO nCampo = nCampo + 1;
               aNumeroCampo = (("000" + nCampo) % -103);

               aQueQuiero   = "|C" + (("000" + nCampo) % -103) + "NOMBRE";
               aNombreCampo = (#100#aQueQuiero# + (" " * 20)) % 120;

               aQueQuiero   = "|C" + (("000" + nCampo) % -103) + "IDCAMPO";
               aTipoCampo   = #100#aQueQuiero#;

/*
               aAlfa        = aTipoCampo % 103;
               |SI aAlfa ] "000";  |Y aAlfa [ "999";
                   aTipoCampo = aTipoCampo % 410;
               |FINSI;

               aAlfa1 = aTipoCampo % 104;
               aAlfa2 = "C" + aNumeroCampo;
               |SI aAlfa1 = aAlfa2;
                   aTipoCampo = aAlfa2 + (aTipoCampo % 110);
               |FINSI;

               aTipoCampo = aTipoCampo % 104;

*/
               #98#0 = #0#2;
               #98#1 = aNumeroCampo;
               #98#2 = aNombreCampo;
               #98#3 = aTipoCampo;
               #98#4 = aTitulo;
               |GRABA 020#98n;
               |LIBERA #98;

               nSwPrint = 1;
         |SIGUE;
         |CIERRA #98;

     |SINO;
         aMensa = "     No puedo cargar el Def : " + aNombreDef;
         |MENAV aMensa;
     |FINSI;

     |DESCARGA_DEF #referen@;

     aMensa = "               ";
     |MENSA aMensa;
|FPRC;

|PROCESO ConvertirMasivo;
     |SI #98#3 = aAntes;
         aAlfa = "0000 Hay Identificadores Repetidos, Arreglelos. Identificador = " + #98#1 + " " + aAntes;
         |MENAV aAlfa;
         |ERROR10;
         nError = 1;
         |ACABA;
     |FINSI;

     aAntes = #98#3;
     aAlfa1 = #98#0;  |QBF aAlfa1;
     aAlfa  = ":" + aAlfa1 + &13 +  &10;       |XGRABA nHandle, aAlfa;
     aAlfa1 = "#" + #98#1 + ",ID=" + #98#3;    |QBF aAlfa1;
     aAlfa  = aAlfa1 + &13 + &10;              |XGRABA nHandle, aAlfa;
|FPRC;

|DEFBUCLE juanmw06;
     #98#2;
     ;
     "          ";
     "zzzzzzzzzz";
     ;
     NULL, ConvertirMasivo;
|FIN;

|PROCESO GrabaDef;
     aAntes = "";
     nError = 0;
     aAbre  = #0#5;  |QBF aAbre;
     |XABRE "BW", aAbre, nHandle;
     |BUCLE juanmw06;
     |XCIERRA nHandle;

     |SI nError = 0;
         |MENSA "     Convirtiendo Campos, Espere por favor ...";
         aBase  = #0#0;  |QBF aBase;
         aAlfa1 = #0#3;  |QBF aAlfa1;
         aAlfa2 = #0#4;  |QBF aAlfa2;
         aAlfa3 = #0#5;  |QBF aAlfa3;
         aAlfa4 = #0#1;  |QBF aAlfa4;
         aAlfa  = aBase + "ut/" + aAlfa1 + " @" + aBase + " " + aAlfa4 + " @:" + aAlfa2 + " -batch:" + aAlfa3;
         |SYSTEM aAlfa;
     |FINSI;

     |FBORRA aAlfa3;
|FPRC;

|RUTINA ClaveBaja98;
     #98#0 = #0#2;
     #98#1 = 000;
|FRUT;

|RUTINA ClaveAlta98;
     #98#0 = #0#2;
     #98#1 = nTCampo;
|FRUT;

|PROGRAMA;
     |ABRE #0;
     #0#6 = Usuario;
     |LEE 101#0=;
     |SI FSalida ! 0;
         |DDEFECTO #0;
         #0#6 = Usuario;
         |GRABA 101#0b;
     |FINSI;

     aFichero = ("w6" + Usuario + "zzzzzzzz") % 108;
     |NOME_DAT #98 aFichero;
     |ABRE #98;  |CIERRA #98;  |DELINDEX #98;

     |CLS;
     |CABEZA "Cambio Identificacion";
     |PINPA #0#0;
     |PINDA #0#0;
     |ENDATOS #1#0;
     |SI FSalida = 0;
         |GRABA 101#0a;
         |HAZ MiraDef;
     |FINSI;

     |SI nSwPrint ! 0;
         |PARA;  |SI;  |HACIENDO;
              |ENTLINEAL #1#98, -2, 2, 22, 1, ClaveBaja98, ClaveAlta98;
              |CONFI "0000SDesea grabar lo introducido en el Def.";
              |SI FSalida = 0;
                  |HAZ GrabaDef;
                  |SI nError = 0;  |SAL;  |FINSI;
              |SINO;
                  |SAL;
              |FINSI;
         |SIGUE;
     |FINSI;

     |LIBERA #0;
     |CIERRA #0;
     |DELINDEX #98;
|FPRO;
