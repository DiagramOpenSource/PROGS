|FICHEROS;
     gopartca #0;
     gopartll #1;
     gomantca #2;
     gomantli #3;
     goptrbca #4,MANTE;
     gopartli #5,MANTE;
     gorephor #6,MANTE;
     goptrbli #7;
     goparame #10;
     gomantho #11;
     gopre001 #12;
     guerm053 #53;
     gopartli@;
|FIN;
-----------------------------------------------------------------------------
|VARIABLES;
     nLin = 0;
     &Tempo = "";
     nModoCab = 0;
     &enRecalcular = 0;
     aAlfa = "";
     aEstado = "";
     nError = 0;
     &eaSerPre = "";
     &enNumPre = 0;
     &eaSerExp = "";
     &enNumExp = 0;
     nSwCerrado     = 0;
     &efFecha       = @;
     &cCodMonBase   = "";
     &cDesMonBase   = "";
     &cCodMonTrab   = "";
     &cDesMonTrab   = "";

     &nDeci_PBase   = 0;
     &nDeci_TBase   = 0;
     &nDeci_PTrab   = 0;
     &nDeci_TTrab   = 0;
     &nDeci_TotVis  = 0;
     &nEurComTrab   = 0;
     &nEurComBase   = 0;
     &nEurVenTrab   = 0;
     &nEurVenBase   = 0;

     &cSerie        = "";
     &cSerExp       = "";
     &cSerPre       = "";

     &nNumExp       = 0;
     &nNumPre       = 0;
     &nExped        = 0;
     nSumHor        = 0;
     nModo          = 0;
     nLinea         = 0;

     &fFechaIni     = @;
     nBotRepar      = 0;
     nTecla         = 0;
     &nHayT         = 0;

     {-1}menu       = "";
     menu1          = "2400";
     menu2          = "1";
     menu3          = "Fechas por:  ";
     menu4          = "RI";
     menu5          = "    Rango     ";
     menu6          = " Individuales ";
     {-1}aMenu       = "";
     aMenu1          = "2400";
     aMenu2          = "1";
     aMenu3          = "Opciones:  ";
     aMenu4          = "RO";
     aMenu5          = " Recalcular ";
     aMenu6          = " Ordenar ";
|FIN;
-----------------------------------------------------------------------------
|PROCESO ParMin;
     #2#0 = "     ";
     #2#1 = 1;
     #5#0 = #1#4;
     #5#1 = #1#5;
     #5#2 = 1;
     #5#3 = "01.01.0000"
|FPRC;
-----------------------------------------------------------------------------
|PROCESO ParMax;
     #2#0 = "zzzzz";
     #2#1 = 999999;
     #5#0 = #1#4;
     #5#1 = #1#5;
     #5#2 = 9999;
     #5#3 = "31.12.9999"
|FPRC;
-----------------------------------------------------------------------------
|PROCESO MirExpPar; |TIPO 0;
     |ABRE #2;
     #2#0 = #0#0;
     #2#1 = #0#1;
     |LEE 000#2=;

     |SI FSalida = 0;
          #0#10 = #2#2;
          #0#11 = #2#6;
          #0#12 = #2#8;
          |PINTA #0#10;
          |PINTA #0#11;
          |PINTA #0#12;
     |SINO;
          |AVISO;
          |MENAV "0000NO EXISTE EL EXPEDIENTE INTRODUCIDO";
          |ERROR;
     |FINSI;

     |CIERRA #2;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO Accion; |TIPO 7;
     |ABRE #12;
     #12#0 = #1#4;
     #12#1 = #1#5;
     |LEE 000#12=;
     |CIERRA #12;
     |PINTA 1533, #12#8;
     |ENTLINEAL #3#5, -4, 7, 22, 0, ParMin, ParMax;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO Lineas; |TIPO 20;
     |SI FSalida = "OPCION";
          |HAZ Accion;
          FSalida = "Opciones";
     |SINO;
          |MENU aMenu;
          |SI FSalida = 1;
               enRecalcular = 1;
               |HAZ Recalcular;
          |FINSI;
          |SI FSalida = 2;
               |HAZ OrdenaFecha;
          |FINSI;
          |HAZ Accion;
     |FINSI;
|FPRC;
-------------------------------------------------------------------------------
|PROCESO MonTraTra; |TIPO 14;
     |HAZ Accion;
     cCodMonTrab = #0#11;
     |HAZ MonBas;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO AltaPart; |TIPO 0;
     nModo = (FEntrada/100)!0;

     |SI nModo = 1; |O nModo = 2;
          |ABRE #1;
          |ABRE #2;
          #2#0 = #0#0;
          #2#1 = #0#1;
          |LEE 000#2=;

          |SI FSalida = 0;
               nLinea = 0;
               |BUCLELIN 0 GrabLine #2;
          |FINSI;

          |CIERRA #1;
          |CIERRA #2;
     |FINSI;

|FPRC;
------------------------------------------------------------------------------
|PROCESO GrabLine;
     |DDEFECTO #1;
     #1#0 = #0#0;                                 ||Serie Expe.
     #1#1 = #0#1;                                 ||Num. Exped.
     #1#2 = #3#2;                                 ||Linea.
     |LEE 000#1=;

     |SI FSalida ! 0;
          #1#3 = #3#6;                            ||Fecha Pres.
          #1#4 = #3#3;                            ||Serie Pres.
          #1#5 = #3#4;                            ||Num. Presu.
          #1#14 = #3#5;                           ||Tipo Presu.
          |GRABA 020#1c;
     |FINSI;

|FPRC;
-----------------------------------------------------------------------------
|PROCESO Entradas; |TIPO 0;
     nModo = (FEntrada/100)!0;

     |SI nModo = 1;
          |ERROR;
          |ACABA;
     |FINSI;

     |SI nModo = 2;
|||          |PTEC 802;
     |FINSI;

|FPRC;
-------------------------------------------------------------------------------
|PROCESO Fecha;
     fFechaIni = #5#3 + 1;
|FPRC;
-------------------------------------------------------------------------------
|DEFBUCLE Fecha;
     #5#3;
     ;                                          ||Campos Extras.
     #1#4, #1#5, "01.01.0000",    1;
     #1#4, #1#5, "31.12.9999", 9999;
     ;                                          ||b/e Bolqueo-Ordenacion.
     NULL, Fecha;
|FIN;
-------------------------------------------------------------------------------
|PROCESO Parte; |TIPO 0;

     nModo = (FEntrada/100)!0;

     |SI nModo = 4;
          |ACABA;
     |FINSI;

     cSerExp = #1#0;
     nNumExp = #1#1;
     cSerPre = #1#4;
     nNumPre = #1#5;

     |MENU menu;

     |SI FSalida = 1;
          |PUSHV 01012380;
          |CLS;
          fFechaIni = "01.01.0000";
          |BUCLE Fecha;

          |SI fFechaIni = "01.01.0000";
               |HAZ FecIni;
          |FINSI;

          |ABRE #6;
          |DDEFECTO #6;
          |PINPA #0#6;
          |PINDA #0#6;
          |ENDATOS #1#6;
          |CIERRA #6;
          |POPV;
     |FINSI;

     |SI FSalida = 2;
          |ENTLINEAL #1#5, 3, 1, 22, 0, ParMin, ParMax;
     |FINSI;

|FPRC;
-----------------------------------------------------------------------------
|PROCESO FecIni;
     |ABRE #3;
     |SELECT #2#3;
     #3#0 = #1#0;                                 ||Serie Exp.
     #3#1 = #1#1;                                 ||N Exp.
     #3#3 = #1#4;                                 ||Serie Pre.
     #3#4 = #1#5;                                 ||N Pre.
     |LEE 000#3=;

     |SI FSalida = 0;
          fFechaIni = #3#7;                       ||Fecha Inicio.
     |FINSI;

     |CIERRA #3;
|FPRC;
-------------------------------------------------------------------------------
|PROCESO BorraPartes;
     #4#0  = #0#0;            ||Serie Expediente.
     #4#1  = #0#1;            ||Expedinte.
     #4#2  = #5#3;            ||Fecha Expediente.
     #4#16 = #5#0;            ||Serie Presupuesto.
     #4#17 = #5#1;            ||Presupuesto.
     |LEE 000#4=;

     |SI FSalida = 0;
          |BUCLELIN 1 NULL #4;
          |BORRA 020#4a;
     |FINSI;

     |BORRA 020#5a;
|FPRC;
----------------------------------------------------------------------------
|DEFBUCLE BajaPart;
     #5#1;
     ;
     #1#4, #1#5,    1;
     #1#4, #1#5, 9999;
     ;
     NULL, BorraPartes;
|FIN;
-----------------------------------------------------------------------------
|PROCESO MiraCerrado_1;
     ||컴컴컴컴컴컴컴횮ontrol Cierre2
     efFecha = #5#3;
     |HAZ EstaCerrado;
     |SI FSalida = 0;
          nSwCerrado = 1;
          |ERROR10; |ACABA;
     |FINSI;
     |HAZ CheqBaja;
     ||컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|FPRC;

|DEFBUCLE MiraCerrado_1;
     #5#1;
     ;
     #1#4, #1#5, 0001;
     #1#4, #1#5, 9999;
     ;
     NULL, MiraCerrado_1;
|FIN;

|PROCESO MiraCerrado;
     |BUCLE MiraCerrado_1;
     |SI nSwCerrado = 1;
          |ERROR10;
     |FINSI;
|FPRC;

|PROCESO Tipo2Cab; |TIPO 2;
     nModo = (FEntrada/100)!0;
     nModoCab = nModo;
     nError = 0;
     nSwCerrado = 0;
     |SI nModo = 3;
          |BUCLELIN 2 MiraCerrado #0;
          |SI nSwCerrado = 1;
               |ERROR; |ACABA;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO CheqBaja;
     aAlfa = #1#3 % 704; #53#0 = aAlfa;
     aAlfa = #1#3 % 402; #53#1 = aAlfa;
     |LEE 000#53=;
     |SI FSalida = 0;
          |MENAV "0000Periodo cerrado...";
          |ERROR10; nSwCerrado = 1;
     |FINSI;
|FPRC;

|DEFBUCLE CheqBaja;
     #5#1;
     ;
     #1#4, #1#5,    1;
     #1#4, #1#5, 9999;
     ;
     NULL, CheqBaja;
|FIN;

|PROCESO Baja; |TIPO 2;
     nModo = (FEntrada/100)!0;

     |SI nModo = 3; |Y nModoCab ! 3;
          nSwCerrado = 0;
          |ABRE #53;
          |BUCLE CheqBaja;
          |CIERRA #53;
          |SI nSwCerrado ! 0; |ERROR; |ACABA; |FINSI;

          |CONFI "0000NSe van a dar de baja todos los Partes de trabajador asignados al presupuesto. 풢sta seguro?";
          |SI FSalida ! 0; |ERROR; |ACABA; |FINSI;
     |FINSI;
     |SI nModo = 3;
          |ABRE #4;
          |BUCLE BajaPart;
          |CIERRA #4;
     |FINSI;

     #0#2 = #0#2 +. #1#6;
     #0#3 = #0#3 +. #1#7;
     #0#4 = #0#4 +. #1#8;
     #0#5 = #0#5 +. #1#13;
     #0#6 = #0#6 +. #1#9;
     #0#7 = #0#7 +. #1#10;
     #0#8 = #0#8 +. #1#11;
     #0#9 = #0#9 +. #1#12;
     |PINDA #0#0;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO Acep; |TIPO 0;
     nModo = (FEntrada/100)!0

     |SI #1#14 = " ";
          |ERROR;
          |ACABA;
     |FINSI;

     |SI nModo = 4;
          |ENTLINEAL #3#5, 4, 4, 22, 0, ParMin, ParMax;
     |SINO;
          eaSerPre = #1#4;
          enNumPre = #1#5;
          eaSerExp = #1#0;
          enNumExp = #1#1;
          |HAZ EstadoObra1;
          |SI FSalida ! 0; |ERROR; |FINSI;
     |FINSI;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO AccPar; |TIPO 11;
     nModo = (FEntrada/100)!0;

     |SI FSalida = 11;             ||RESUMEN POR CATEGORIAS.
          cSerie = #0#0;           ||Serie.
          nExped = #0#1;           ||Expediente.
          |SUB_EJECUTA_NP "gorescac;PARTECAT";
          |ERROR10;
     |FINSI;

     |SI FSalida = 12;             ||RESUMEN POR TRABAJADORRES.
          cSerie = #0#0;           ||Serie.
          nExped = #0#1;           ||Expediente.
          |SUB_EJECUTA_NP "gorescac;PARTETRA";
          |ERROR10;
     |FINSI;

|FPRC;
-----------------------------------------------------------------------------
|PROCESO EstadoObra1; |||Igual que el EstadoObra del dsz99966
     nError = 0;
     |ABRE #10; |LEE 000#10p; |CIERRA #10;

     |ABRE #3; |SELECT #2#3;
     #3#3 = eaSerPre;
     #3#4 = enNumPre;
     #3#0 = eaSerExp;
     #3#1 = enNumExp;
     |LEE 000#3=;
     |SI FSalida = 0;
          aEstado = #3#10;
          |SI aEstado ! "C";
               |SI aEstado = "E";
                    |MENAV "0000LA 0BRA SE ENCUENTRA EN ESPERA";
               |FINSI;
               |SI aEstado = "P";
                    |SI #10#72 = "S";
                         |MENAV "0000LA OBRA SE ENCUENTRA PARADA";
                    |FINSI;
                    |SI #10#73 = "N";
                         nError = 1;
                    |FINSI;
               |FINSI;
               |SI aEstado = "T";
                    |SI #10#74 = "S";
                         |MENAV "0000LA OBRA SE ECUENTRA TERMINADA";
                    |FINSI;
                    |SI #10#75 = "N";
                         nError = 1;
                    |FINSI;
               |FINSI;
          |FINSI;
    |FINSI;
    |CIERRA #3;
    FSalida = nError;
|FPRC;

|PROCESO Tipo8; |TIPO 8; || Relleno del campo nuevo Wed Feb  8 09:15:57 CET 2006
     |ABRE #10; |LEE 000#10p; |CIERRA #10;
     |ABRE #0;
     |ABRE #11;
     |LEE 101#0p;
     aAlfa = #0#13; |QBF aAlfa;
     |PARA; |SI FSalida = 0; |Y aAlfa = ""; |HACIENDO;
          #11#0 = #0#0;
          #11#1 = #0#1;
          |LEE 000#11=;
          |SI FSalida = 0;
               #0#13 = #11#29;
               |GRABA 020#0a;
          |FINSI;
          |LIBERA #0;
          |LEE 101#0s;
          aAlfa = #0#13; |QBF aAlfa;
     |SIGUE;
     |CIERRA #11;
     |CIERRA #0;
|FPRC;
--------------------------------------
|PROCESO TmpOrden;
     |SALVA_DATOS #gopartli@;
     |REPON_DATOS #5;
     |GRABA 020#5n;
|FPRC;

|DEFBUCLE TmpOrden;
     #gopartli@#1003;
     ;
     "     ", 000001, 0001;
     "zzzzz", 999999, 9999;
     ;
     NULL, TmpOrden;
|FIN;

|PROCESO OrdenaFec5;
     nLin = nLin + 1;
     |SALVA_DATOS #5;
     |REPON_DATOS #gopartli@;
     #gopartli@#2 = nLin;
     |GRABA 020#gopartli@.n;
     |BORRA 020#5a;
|FPRC;

|DEFBUCLE OrdenaFec5;
     #5#2;
     ;
     #1#4, #1#5, "01.01.0000";
     #1#4, #1#5, "31.12.9999";
     be;
     NULL, OrdenaFec5;
|FIN;

|PROCESO OrdenaFec1;
     nLin = 0;
     |BUCLE OrdenaFec5;
|FPRC;

|DEFBUCLE OrdenaFec1;
     #1#1;
     ;
     #0#0, #0#1, 0001;
     #0#0, #0#1, 9999;
     ;
     NULL, OrdenaFec1;
|FIN;

|PROCESO OrdenaFecha;
     |CONFI "0000NOrdenar lineas por fecha:";
     |SI FSalida ! 0; |ACABA; |FINSI;
     |LEE 101#0=;
     |SI FSalida = 0;
          |DDEF aAlfa;
          aAlfa = aAlfa + "gopartli";
          |CARGA_DEF aAlfa, gopartli@;
          |SI FSalida = 0;
               |HAZ CreaTempo; |NOME_DAT #gopartli@#Tempo#; |DELINDEX #gopartli@;
               |ABRE #gopartli@;
               |BUCLE OrdenaFec1;
               |CIERRA #gopartli@;
               |ABRE #5;
               |BUCLE TmpOrden;
               |CIERRA #5;
               |HAZ BoraTempo; |DELINDEX #gopartli@;
               |DESCARGA_DEF #gopartli@;
          |FINSI;
          |LIBERA #0;
     |FINSI;
|FPRC;

|PROCESO Tipo13; |TIPO 13;
     |ABRE #10; |LEE 000#10p; |CIERRA #10;
     |SI #10#141 = "O";
          |PINTA 502, "O.T..........:";
          |ATRI I; |PINTA 702, "O.E.        "; |ATRI 0;
          |PINTA 820, "       O.E.:";
          |ATRI R; |PINTA 907, "O.E.     "; |ATRI 0;
          |ATRI R; |PINTA 1630, "O.E   "; |ATRI 0;
     |FINSI;
|FPRC;
