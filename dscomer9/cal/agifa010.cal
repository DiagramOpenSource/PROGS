|FICHEROS;
     agifa010 #0;        || Albaranes
     agifa019 #2;
     agifa071 #3;
     agifa024 #4;
     agifa025 #25;
     agifa027 #41;       || Contador.              || VIC Puesto el 15/07/98
     agifa142 #42;       || Parametros Generales
     agifa204 #43;       || Titulos Varios
     agifa007 #44;       || Series
     agi00002 #100;
     agi00003 #101;
     agifa321 #35;  || Parametros de Divisas
     agifa328 #36;  || Clientes/Divisas
     agifa329 #37;  || Lineas de Clientes/Divisas
     agifa324 #38;  || Divisas
     dsm00003 #39,MANTE;
     agis0002 #200;
     tempo084 #500,MANTE;  || a Pagar.......
     dscamrec@ #600;

     agifa177 #177;
     agifa091;

     agifa048 #148;
     agifa049 #149;
     dsm00114 #114;
     dsm00117 #117;
     dsm00246 #140; ||Control Riesgo Por Usuarios.
     dsm00247 #141; ||Pantalla Informe Riesgo.
     dsm00248 #143; ||Auditoria.
     dsm00134 #134; ||Promociones cli/art
     dsm00211 #211;
     dsm00279 #279;
     agifa722 #722;
     dsm00289 #289;
     agifa065 #65;
     aser0001@;
     baezam01@;
     dsm00263@;
     referen@;
     refere1@;
     otroref@;
     otromas@;
|FIN;

|VARIABLES;
     nSwEsEvaristo = 0;
     aFin = "";
     aTecla = "";
     nBtnWorkFlowAlb = -1;
     nBtnItemDocAlb = -1;
     nSwJamaica = 0;
     nSwHazEnvio = "";
     aEnvioAuto = "";
     aParamEnvioAuto = "";
     aIP = "";
     nTBultos = 0;
     {1}aBaseLocal;
     aDjunto = "";
     aServidor = "";
     aFrom = "";
     aTo = "";
     aEmail = "";
     aEmail1 = "";
     aEmail2 = "";
     aSubject = "";
     aMensaje = "";

     nUni = 0;
     nError2 = 0;
     aFam1 = "";
     aFam2 = "";
     aFam3 = "";
     aFam4 = "";
     nImpo = 0;
     nSwAparecida = 0;
     nBtnRet_Aut = 0;
     i = 0;
     aPathErp = "";
     aCien = "";
     nEmpErp = 0;
     aAplicaErp = "";
     aDefErp = "";
     aClaveErp = "";
     aBass = "";
     aErp = "";
     nSwEstaDocErp = 0;
     aVienePropu = "";
     aTieneLin = "N";
     aSinError = "";
     aSql = "";
     nSwDHL = 0;
     nLin = 0;
     nResto = 0;
     nUniPromo = 0;
     aDef = "";
     nSwTecatel = 0;
     aCliTeca = "";
     nForma = 0;
     nFlag  = 0;
     Divisa     = "";
     CambioBase = 0;
     CambioDiv  = 0;
     nPos       = 0;
     nConAu     = 0;
     aUs        = "";
     nImpEnt    = 0;
     nTecla     = 0;
     nLinea     = 0;
     nTries     = 0;
     nAudito    = 0;
     nSal      = 0;
     aAlfa     = "";

     nMult     = 0;
     nModo     = 0;
     nGuarda   = 0;

     aTempo600 = "";
     aPath     = "";
     aDef00    = "";
     aMensa    = "";
     Comodin   = "";
     aSubProg = ":dscarter/dsrecibo";

     aArti     = "";
     aOpera    = "";
     nCta     = 0;
     naCum    = 0;
     NoExiste = 0;
     nfecha    = 0;
     div_act = 0;        || Divisa actualizada. Me sirve en un PARA para que
     nModo010 = 0;
     salida = 0;
     tipo = 0;
     dto_prom = "N";
     recoge   = "N";
     def_exp  = "N";
     DescAmpli = "N";
     n_pre    = 0;
     def_alm  = 0;

     puente    = "";
     totalba    = 0;
     imneto    = 0;
     tf        = 0;
     mes       = 0;
     con       = 0;
     margen    = 0;
     control   = 0;
     cant      = 0;
     modificado= 0;
     modo      = 0;
     contenido = 0;
     iva_ant   = 0;
     importe   = 0;

     alfa = "";
     cont     = "";
     contador = 0;

     || MENU PARA INTRODUCIR EL CODIGO DEL CLIENTE DE FORMA AUTOMATICA.
 {-1}menu           = "";
     menu1          = "2400";
     menu2          = "1";
     menu3          = "Contador:  ";
     menu4          = "AM";
     menu5          = " Automatico ";
     menu6          = " Manual ";
     so             = "";
     no             = "";
     caltot         = 0;
     recalpre       = 0;
     nImpDiv   = 0;
     nSwRod = 0;
 {-1}MenuRod        = "";
     MenuRod1       = "2400";
     MenuRod2       = "1";
     MenuRod3       = "Opciones:  ";
     MenuRod4       = "IT";
     MenuRod5       = " Imprimir ";
     MenuRod6       = " Traspaso ";
 {-1}MenuDHL       = "";
     MenuDHL1      = "2400";
     MenuDHL2      = "1";
     MenuDHL3      = "Opciones:  ";
     MenuDHL4      = "ID";
     MenuDHL5      = " Imprimir ";
     MenuDHL6      = " Datos Envio ";

     aNifQbf1   = "";
     aNifQbf2   = "";

     nDto = 0;

     aAlfaX  = "";
     aAlfa1X = "";

     &clien    = "";
     &fpago    = "";
     &repres   = "";
     &dto      = 0;
     &dtoa     = 0;
     &dtop     = 0;
     &factur   = 0;

     &eaVarDni  = "";
     &enCalcCif = 0;
     &consulta = "";
     &sserie   = "";
     &nnumer   = 0;
     &ffecha   = @;
     &cclien   = "";
     &nnombr   = "";
     &iimpor   = 0;
     &ccoste   = 0;
     &fec_alb = @;

     &err = 0;
     &cli="";
     &ser="";
     &ext1     = "";
     &ser_alb  = "";
     &num_alb  = 0;
     &abo_alb  = "";
     &abono    = "";   || Lo utilizo en agifa014
     &n_dec    = 0;

     &eaCodigo  = "";
     &eaTipoCodigo = "CL";

     &Cliente = "";
     &SPedido = "";
     &NPedido = 0;
     &PPedido = "";
     &FPedido = @;
     &TPedido = 0;
     &BAdela  = 0;
     &TipoCta = "A";
     &doc = 0;
     &nDeci_IVADiv   = 0;
     &nDeci_Base     = 0;   || Decimales en Totales de la moneda base
     &nDeci_PreBase  = 0;   || Decimales en el Precio en moneda base
     &nDeci_BaseMx   = 0;   || Decimales en Totales de la moneda base (Maxima precision)
     &nDeci_PreBaseMx= 0;   || Decimales en el Precio en moneda base (Maxima precision)
     &nDeci_Div      = 0;   || Decimales en Totales de la divisa
     &nDeci_PreDiv   = 0;   || Decimales en el Precio en divisa
     &nDeci_TotVis   = 0;   || Decimales en Totales visibles (el de la moneda de trabajo)
     &nDeci_TotNoVis = 0;   || Decimales en Totales no visibles (el de la otra moneda)
     &nDeci_PreVis   = 0;   || Decimales en el Precio visual. (lineas)
     &nDeci_ImpVis   = 0;   || Decimales en el Importe visual. (lineas)
     &ac_divisa = "N";   || Vale "S" cuando las divisas en ventas estan
                         || activadas y la serie es de divisas
     &pintado = 0;       || Sirve para controlar los pintados de las lineas
     &decim_divisa = 0;  || Decimales de la divisa
     &precio_divisa = 0; || Decimales del precio en divisa
     &decim_base = 0;    || Decimales de la moneda base
     &precio_base = 0;   || Decimales del precio en moneda base
                         || no salga hasta que este actualizada (div_act=1)
     &cli_divisa = "";   || Codigo de Cliente. Se pasa a CLIENTES/DIVISAS
     &divisa = "";       || Codigo de Divisa. Se pasa a ACTUAL. de DIVISAS
     &enModo10 = 0;
     &nMasRies  = 0;
     &nRieTotal = 0;
     &nRieUtili = 0;
     &aRieBloqu = "";
     &aBloquead = "";
     &eaTag     = "";
     &Tempo     = "";
     &aCPath    = "";
     &aCNome    = "";
     &enSoloPositivo = 0;
     &eaMenuImpre = "";
     &eaImpresora = "";
     &eaNonDni = "";
     &eaDomiDni = "";
     &eaCPDni = "";
     &eaPobDni = "";
     &eaPrvDni = "";
     &eaTlfDni = "";
     &eaFacDni = "";
     &eaPaisDni = "";
     &eaTmpAV816 = "";
     &PRMNT_aHisto = "";
     &uni_dt = 0;   || Unidades
     &uni_dt2 = 0;   || Unidades2
     &fed_dt = @;   || Fecha....
     &art_dt = "";  || Articulo.
     &cli_dt = "";  || Cliente..
     &fam_dt = "";  || Familia.
     &iva_dt = 0;   || Tipo Iva.
     &dtos_2 = 0;   || Descuento 2.
     &dto_pt = 0;   || Descuento Ptas.
     &dtos_1 = 0;   || Descuento 1.
     &pvp_ve = 0;   || Precio Venta.
     &tarifa = 0;   || Tarifa Cliente.
     &quedto = 0;   || 1=cli./art, 2=cli./familia, 3=cli./subfam.
     &gru_dt = "";  || Grupo Cliente.
     &nPromo = 0;
     &enMensaje = 0;
     &aParam    = "";

     &enDto = 0;
     &enModoCab10 = 0;
     &enNumero = 0;
     &enOk = 0;
|FIN;

|INCLUYE i_varart;
ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ

|PROCESO Promo010_7; |TIPO 7;
     |SI #42#129 = "S";
          |C_M #0#89, 1, "S";
     |FINSI;
     |HAZ EsAlbadis;
     |SI FSalida = 0;
          |HAZ AlbaPideAlb;
     |FINSI;
|FPRC;

|PROCESO Promo010_0; |TIPO 0;
     |SI #0#89 ! 0;
          |ABRE #117;
          #117#0 = #0#89;
          |LEE 000#117=;
          |SI FSalida ! 0;
               |MENAV "0000Promocion Inexistente...";
               |ERROR;
          |FINSI;
          |CIERRA #117;
     |FINSI;
|FPRC;

|PROCESO fecalb;|TIPO 7;
     ||HAZ entra_1;      || esto jodia el tema de la serie por defecto
                         ||/cuando, una vez presentada, la cambiaba el
                         ||/usuario
                         || ENTRE OTRAS COSAS NO SE PARA QUE SE EJECUTABA
                         ||/ESTO AQUI OTRA VEZ !!!     (PRIEGO-AGO/02)
     modo = (FEntrada / 100) ! 0;
     enModoCab10 = modo;
     |SI modo = 2;
       |C_M #0#1 , 1 , "N";
     |SINO;
       |C_M #0#1 , 1 , "S";
     |FINSI;

     |HAZ EsRodacal;
     |SI FSalida = 0;
          |HAZ RodCheqAlb;
          |SI FSalida = 0; |ERROR; |FINSI;
     |FINSI;
     |SI aCliTeca ! ""; |Y modo = 1; || Modulo Tecatel
          #0#3 = aCliTeca; |PINTA #0#3;
          |HAZ DefDirEn;
          #0#4 = #4#2;
          |SI factur = 0; #0#8 = #4#20; |FINSI;
          #0#63 = #4#15;
     |FINSI;
|FPRC;


|PROCESO cogecon0;|TIPO 0;
     control = 0;
|FPRC;

|PROCESO pedcon0;|TIPO 6;
     con = (FEntrada / 100) ! 0;
     |SI con = 2;|Y #0Campo ! Contenido;|Y modificado = 0;
          |SI #0#41 > 0;|O #0#42 > 0;|O #0#38 = AS; |O #0#39 = 999999;
               #0Campo = Contenido;
               |PINTA #0Campo;
               |SI #0#41 > 0;      ||cuando venia de un pedido, si se intentaba modificar
                                   ||el cliente, la segunda vez consecutiva, los descuentos
                 modificado = 1;   ||Cogian defectos NO reales, al poner la variable
                    |MENAV "0000Este albaran contiene lineas provenientes de Pedidos";
                    |ERROR;
                    |ACABA;           ||modificado = 1, no pasa la segunda vez y no coge
               |FINSI;             ||los defectos
               |SI #0#42 > 0;
               |MENAV "0000Este albaran contiene lineas provenientes de Depositos";
                    modificado = 1;
                    |ERROR;
                    |ACABA;
               |FINSI;
               |SI #0#39 = 999999;
                    |MENAV  "0000Este albaran esta en modo Exportacion";
                    modificado = 1;
                    |ERROR;
                    |ACABA;
               |FINSI;
               |SI #0#38 = "S";
                    |SI #0#43 = AN;
                         |MENAV "0000Este albaran esta FACTURADO";
                         modificado = 1;
                         |ERROR;
                         |ACABA;
                    |SINO;
                         |MENAV "0000Este albaran esta FACTURADO";
                         modificado = 1;
                         |ERROR;
                         |ACABA;
                    |FINSI;
               |FINSI;
               |SI #0#39 = 999999;
                   |MENAV "0000Este albaran esta en modo Exportacion";
               |FINSI;
          |SINO;
               control = 1;
          |FINSI;
     |FINSI;
     modificado = 0;
|FPRC;

|PROCESO dcon;|TIPO 6;
     con = (FEntrada / 100) ! 0;
     |SI #0Campo ! Contenido;
          |SI #0#38 = "S"; |O #0#39 = 999999;
               |SI #0#38 = "S";
                    |MENAV "0000Este albaran esta FACTURADO";
               |SINO;
                    |MENAV "0000Este albaran esta en modo Exportacion";
               |FINSI;
               |ERROR;
         |SINO;
            control = 1;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO Tipo1; |TIPO 1;
     nError2 = 0;
|FPRC;

|PROCESO acacp; |TIPO 2;
     |SI nError2 ! 0; |ERROR; |ACABA; |FINSI;

     |HAZ ControlUsuAV;
     |SI enErr ! 0; |ERROR; |ACABA; |FINSI;

     con = (FEntrada / 100) ! 0;
     tipo = 0 +. 1;
     nForma = 0 +. 1;
     enModoCab10 = con;
     |SI con = 4; |ACABA; |FINSI;

     |SI con = 2; |Y nForma = -1; nTBultos = #0#2; |FINSI;

     |SI #0#69 = 0; || chequea el cambio
          |ABRE #agifa324;
          #agifa324#0 = #0#68;
          |LEE 020#agifa324.=;
          |SI FSalida = 0;
               #0#69 = #agifa324#2;
          |FINSI;
          |CIERRA #agifa324;
     |FINSI;

     |HAZ EsCoimasa;
     |SI FSalida = 0;
          aAlfa = #0#83; |QBF aAlfa;
          |SI aAlfa = "F"; |Y #0#90 = "N";
               |SI nForma = -1;
                    |MENAV "0000ALBARAN NO SE PUEDE MODIFICAR ESTA EN CURSO FALCON";
                    nError2 = 1;
                    |ERROR; |ACABA;
               |FINSI;
          |FINSI;
     |FINSI;

     |HAZ EsAsertis;
     |SI FSalida = 0;
          |DDEF aDef;
          aDef = aDef + "aser0001";
          |CARGA_DEF aDef, aser0001@;
          |SI FSalida = 0;
               |ABRE #aser0001@;
               #aser0001@#0 = #0#52;
               #aser0001@#1 = #0#0;
               |LEE 000#aser0001@.=;
               |SI FSalida = 0;
                    |MENAV "0000Albaran generado por el modulo, modifiquelo por ese punto...";
                    enErr = 1;
               |FINSI;
               |CIERRA #aser0001@;
               |DESCARGA_DEF #aser0001@;
          |FINSI;
          |SI enErr ! 0; |ERROR; |ACABA; |FINSI;
     |FINSI;
     |HAZ EsBaeza;
     |SI FSalida = 0;
          enErr = 0;
          |DDEF aDef;
          aDef = aDef + "baezam01";
          |CARGA_DEF aDef, baezam01@;
          |SI FSalida = 0;
               |ABRE #baezam01@;
               #baezam01@#0 = #0#52;
               #baezam01@#1 = #0#0;
               |LEE 000#baezam01@.=;
               |SI FSalida = 0;
                    |MENAV "0000Albaran generado por el modulo, modifiquelo por ese punto...";
                    enErr = 1;
               |FINSI;
               |CIERRA #baezam01@;
               |DESCARGA_DEF #baezam01@;
          |FINSI;
          |SI enErr ! 0; |ERROR; |ACABA; |FINSI;
     |FINSI;
     ||--------------------------------
     |SI con = 3;
          eaSer = #0#52;
          enDocu = #0#0;
          efFec = #0#1;
          |HAZ MiraHisV;
          |SI enErrHis ! 0;
               |ERROR;
               |ACABA;
          |FINSI;
     |FINSI;

     |SI con ! 1; |Y tipo = -1; |Y #0#65 = "S";
          |AVISO;
          |CONFI "2400NAlbaran pasado a Compras. Continuar (S/N).: ";
          |SI FSalida ! 0;
               |ERROR; |ACABA;
          |SINO;
               err = 0;
               alfa = "agiw0005" + &59 + #0#52 + #0#0;
               |SUB_EJECUTA_NP alfa;   || BORRA ALBARAN COMPRAS
               |SI err = 1;
                    |MENAV "0000Error al borrar la compra...";
                    |ERROR; |ACABA;
               |SINO;
                    #0#65 = "N";
                    |SI con ! 3; |GRABA 021#0a; |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;

     |HAZ EsFriesa;
     |SI FSalida = 0;
          |HAZ VienePropu;
          |SI aVienePropu = "S";
               |SI nForma < 0;
                    |MENAV "0000Este albaran proviene de una propuesta";
               |FINSI;
               |ERROR; |ACABA;
          |FINSI;
     |FINSI;

     |SI nForma = -1;
          |HAZ EsCoimasa;
          |SI FSalida = 0;
               |HAZ CoimaAlbBaja;
               |SI FSalida ! 0; |ERROR; |ACABA; |FINSI;
          |FINSI;
     |FINSI;

     |SI #0#41 > 0;|O #0#42 > 0;|O #0#38 = "S"; |O #0#39 = 999999;
          enErr = 1;
          |SI #0#41 > 0;
               |MENAV "0000Este albaran contiene lineas provenientes de Pedidos";
               |ERROR;
               |ACABA;
          |SINO;
               |SI #0#42 > 0;
                    |MENAV "0000Este albaran contiene lineas provenientes de Depositos";
                    |ERROR;   |ACABA;
               |SINO;
                    |SI #0#38 = AS;
                         |MENAV "0000Este albaran esta FACTURADO";
                         |ERROR;   |ACABA;
                    |SINO;
                         |SI #0#39 = 999999;
                              |MENAV "0000Este albaran esta en modo Exportacion";
                              |ERROR;   |ACABA;
                         |FINSI;
                    |FINSI;
               |FINSI;
          |FINSI;
          enErr = 0;
     |SINO;
          |SI control = 1;
               |HAZ actal;
          |FINSI;
     |FINSI;
     |HAZ actpf;
     |SI tipo = -1;
          |HAZ EsCarnicas;
          |SI FSalida = 0;
               |HAZ BajaCarnicasAV;
          |FINSI;
          |HAZ EsAlbadis;
          |SI FSalida = 0;
               |HAZ AlbaLinAutoBaja;
          |FINSI;
          |HAZ EsGuillen;
          |SI FSalida = 0;
               |HAZ GuiLinAutoBaja;
          |FINSI;
     |FINSI;

     |HAZ EsAparecida;
     |SI FSalida = 0;
          |HAZ ApareceHisto;
     |FINSI;

     |SI con = 3;
          |HAZ EsInforpor;
          |SI FSalida = 0;
               #0#90 = "N"; |PINTA #0#90;
               |HAZ BajaInforpor;
          |FINSI;
          |HAZ EsGuipuz;
          |SI FSalida = 0;
               ser_alb = #0#52;
               num_alb = #0#0;
               |HAZ BorraLineaG;
          |FINSI;
          |HAZ EsPefimian;
          |SI FSalida = 0;
               |DDEF aAlfa;
               aAlfa = aAlfa + "dsm00263";
               |CARGA_DEF aAlfa, dsm00263@;
               |SI FSalida = 0;
                    |DDEFECTO #dsm00263@;
                    |ABRE #dsm00263@;
                    #dsm00263@#0 = #0#52;
                    #dsm00263@#1 = #0#0;
                    |BORRA 020#dsm00263@.c;
                    |CIERRA #dsm00263@;
                    |DESCARGA_DEF #dsm00263@;
               |FINSI;
          |FINSI;
          |HAZ EsTagloma;
          |SI FSalida = 0;
               |HAZ TagBajaAlb;
          |FINSI;
          |HAZ EsAlbero;
          |SI FSalida = 0;
               |HAZ AlbeAlbVBorra;
          |FINSI;
          |HAZ EsDiagram;
          |SI FSalida = 0;
               |HAZ DiagBajAlb;
          |FINSI;
          |HAZ EsAlbadis;
          |SI FSalida = 0;
               |HAZ AlbaBorAlb;
          |FINSI;
          |HAZ EsDHL;
          |SI FSalida = 0;
               aAlfa = "tecam038;";
               aAlfa = aAlfa + #0#52 + (("000000" + #0#0) % -106) + "BAJA";
               |SUB_EJECUTA_NP aAlfa;
          |FINSI;
          |HAZ EsJamaica;
          |SI FSalida = 0;
               enModo = 3;
               eaSerie = #0#52;
               enCodigo = #0#0;
               |SUB_EJECUTA_NP "cafe0021";
          |FINSI;
          |HAZ EsAparecida;
          |SI FSalida = 0;
               aAlfa = "aparm016;" + #0#52 + (("000000" + #0#0)% -106) + #0#3 + "BAJA";
               |SUB_EJECUTA_NP aAlfa;
          |FINSI;
          |HAZ EsInforAlba;
          |SI FSalida = 0;
               aAlfa = "ialbm026;" + #0#52 + (("000000" + #0#0)%-106) + "BAJA";
               |SUB_EJECUTA_NP aAlfa;

               eaSerie = #0#52;
               enCodigo = #0#0;
               |SUB_EJECUTA_NP "ialbz005;BAJA";
          |FINSI;
          |HAZ EsQDClor;
          |SI FSalida = 0;
               eaSerie = #0#52;
               enCodigo = #0#0;
               |SUB_EJECUTA_NP "qdclor07;BAJA";
          |FINSI;
          |HAZ EsExtintor;
          |SI FSalida = 0;
               |HAZ ExtintorBajaAlb;
          |FINSI;
          |HAZ EsOrts;
          |SI FSalida = 0;
               eaTipo = "A";
               eaSerie = #0#52;
               enCodigo = #0#0;
               |SUB_EJECUTA_NP "ortsm021;BAJA";
          |FINSI;
          |HAZ EsFergalsan;
          |SI FSalida = 0;
               |HAZ FergalsanBaja;
          |FINSI;
          ||---------------------------
          |HAZ bajatrabajo;
          BAdela = 1;
          TipoCta = "A"; SPedido = #0#52; NPedido = #0#0;
          |SUB_EJECUTA_NP "agis0002;NOMEQUITES"; || Borra Entragas a cuenta

          |HAZ EsJamaica;          || despues de la baja de entrega
          |SI FSalida = 0;
               |HAZ JamaicaBaja;
          |FINSI;
     |FINSI;

     ||ÄÄÄÄÄÄÄÄÄÄÄÄAutomatizacion Empresas
     |ABRE #dsm00114; |LEE 000#dsm00114.p; nSal = FSalida; |CIERRA #dsm00114;
     |SI nSal = 0;
          eaCli = #0#3;
          |SI tipo = 1;
             /*                 Lo pongo en el tipo 3 0
               aAlfa = "dsz99983;ALBALTA" + #0#52 + (("000000" + #0#0) % -106);
               |SUB_EJECUTA aAlfa;
               |LEE 121#0=;
             */
          |SINO;
               aAlfa = "dsz99983;ALBBAJA" + #0#52 + (("000000" + #0#0) % -106);
               |SUB_EJECUTA aAlfa;
          |FINSI;
     |FINSI;
     |HAZ EsRodacal;
     |SI FSalida = 0;
          |GRABA 020#0a;
          |CIERRAT #0;
          enModo = con;
          enForma = nForma;
          eaSerie = #0#52;
          enCodigo = #0#0;
          |SUB_EJECUTA_NP "rodw0001;MODI";
          |ABRET #0;
          |LEE 101#0=;
     |FINSI;

     |SI con = 1;
          |HAZ EsCoimasa;
          |SI FSalida = 0;
               |HAZ CoimaAlbAlta;
          |FINSI;
     |FINSI;

     |HAZ EsWeb;
     |SI FSalida = 0;
          |HAZ DocWeb;
     |FINSI;

     |HAZ EsJamaica;
     |SI FSalida = 0;
          enForma = nForma;
          aAlfa = "cafe0026;ALBASAT" + #0#52 + (("000000" + #0#0) % -106) + #0#3 + #0#1 + #0#67;
          |SUB_EJECUTA_NP aAlfa;
     |FINSI;
     |HAZ EsGesisat;
     |SI FSalida = 0;
          |DDEF aAlfa;
          aAlfa = aAlfa + "gesim005";
          |CARGA_DEF aAlfa, referen@;
          |SI FSalida = 0;
               |ABRE #referen@;
               |SELECT #14#referen@;
               #referen@#36 = #0#52;
               #referen@#37 = #0#0;
               |LEE 000#referen@.=;
               |SI FSalida = 0;
                    enForma = nForma;
                    aAlfa = "cafe0026;GESISAT" + #0#52 + (("000000" + #0#0) % -106) + #0#3 + #0#1;
                    |SUB_EJECUTA_NP aAlfa;
               |FINSI;
               |CIERRA #referen@;
               |DESCARGA_DEF #referen@;
          |FINSI;
     |FINSI;

     |SI con ! 3;
          |HAZ EsGofre;
          |SI FSalida = 0;
               |HAZ BultosGofre;
          |FINSI;
     |FINSI;
|FPRC;

||---------------------------------------------------------------------------
|| CALCULA EL COSTE TOTAL DEL ALBARAN.
||---------------------------------------------------------------------------
|PROCESO calcos;
     ccoste = ccoste + #3#14;
|FPRC;

|DEFBUCLE calcoste;
     #3#1;
     ;
     #0#52,#0#0,001;
     #0#52,#0#0,999;
     ;
     NULL,calcos;
|FIN;

||---------------------------------------------------------------------------

|PROCESO dif;
    #500#2 = #500#0 - #500#1;
    |PINTA #500#2;
|FPRC;

|PROCESO dif2;
    #500#1 = #500#0 - #500#2;
    |PINTA #500#1;
|FPRC;

|PROCESO apagar;
     |ABRE #agis0002;
     |DDEFECTO #agis0002;
     #agis0002#30 = "A";
     #agis0002#20 = #agifa010#52;
     #agis0002#17 = #agifa010#0;
     #agis0002#18 = 01;
     |LEE 101#agis0002.=;
     |SI FSalida = 0;
        |BORRA 020#agis0002.a;

        |DBASS aPath;
        aPath = aPath + "dscarter/";
        aDef00 = aPath + "def/dscamrec";
        |CARGA_DEF aDef00, dscamrec@;
        |SI FSalida ! 0;
           aMensa = "0000Error al cargar:" + aDef00;
           |MENAV aMensa;
           aDef00 = "";
        |SINO;
           |HAZ CreaTempo; aTempo600 = Tempo;
           |PATH_DAT #600 aPath; |NOME_DAT #600 aTempo600; |DELINDEX #600;
           |ABRE #600;
           aCPath = aPath; aCNome = aTempo600;
        |FINSI;
        |DFICE Comodin;
        Comodin = Comodin % -106;
        Comodin = Comodin % 0105;
        Divisa     = #agifa010#68;
        CambioBase = #agifa010#69;
        CambioDiv  = #agifa010#74;

        #agifa324#0 = Divisa;
        |LEE 000#agifa324.=;
        |SI FSalida ! 0; |DDEFECTO #agifa324; |FINSI;

        |DDEFECTO #dscamrec@;
        #600#1  = #agifa010#52;||Serie
        #600#2  = #agifa010#0; ||Fact
        #600#3  = #agis0002#18;||N§ Rec
        #600#4  = #agis0002#8; ||F.V
        #600#5  = #agis0002#7; ||F.E
        #600#6  = #agis0002#12;||Cuenta Cli
        #600#7  = #agis0002#3; ||Nom Cli
        #600#8  = #agis0002#4; ||Nom Banco
        #600#9  = #agifa024#32;      ||Entidad
        #600#10 = #agifa024#33;      ||Sucursal
        #600#11 = #agifa024#31;      ||DC
        #600#12 = #agifa024#30;      ||Cuenta
        #600#13 = #agis0002#22;||Tipo Rec
        #600#15 = #agis0002#9; ||Importe
        #600#16 = #agis0002#15;||A aceptar
        #600#17 = #agis0002#6; ||Aceptado
        #600#18 = #agis0002#2; ||Cliente
        #600#21 = #agifa024#3; ||Zona
        #600#22 = 1;           ||Documento
        #600#25 = Comodin;     ||Empresa ges
        #600#27 = "V";         ||Tipo
        #600#28 = "B";         ||Ope
        #600#29 = #agifa324#0; ||Divisa
        #600#30 = #agifa324#1; ||Nombre
        #600#31 = CambioDiv;   ||Cambio Divisa
        #600#32 = CambioBase;  ||Cambio Base
        #600#33 = #agifa024#203;
        #600#34 = 0;
        #600#35 = "A";
        #600#36 = #agis0002#28;
        #600#38 = #agis0002#16;
        #600#39 = #agis0002#10;

        aAlfa = "|NC"; aAlfa = #600#aAlfa#;
        |SI aAlfa > 48;
             #600#48 = #agifa024#215;
             #600#49 = #agifa024#216;
        |FINSI;
        |SI aAlfa > 50;
             #600#50 = #agifa024#217;
             |ABRE #289;
             #289#0 = #agifa024#0;
             |LEE 000#289=;
             |SI FSalida ! 0; |DDEFECTO #289; |FINSI;
             |CIERRA #289;
             #600#51 = #289#1;
        |FINSI;

        |GRABA 020#600n;

        |SUB_EJECUTA_NP aSubProg;

        |SI aDef00 ! "";
          |CIERRA #600;
          |DELINDEX #600;
          |DESCARGA_DEF #dscamrec@;
        |FINSI;

        #agis0002#9 = -#agis0002#9;

        |SI #0#51 = "S";    || Facturable
            eaTag = "RAA"; |HAZ Riesgos;
        |FINSI;
     |FINSI;
     |CIERRA #agis0002;

     |PUSHV 0501 2380;
     |BLANCO 0923 1758;
     |PINPA #0#500;
     #500#0 = #0#78;
     #500#1 = #0#61;
     #500#2 = #500#0 - #500#1;
     |PINDA #0#500;
     |ENDATOS #1#500;
     |SI FSalida = 0;
          #0#61 = #500#1;
          |GRABA 020#0a;
     |FINSI;
     |POPV;
     |SI nModo ! 1;|PINTA #0#61; |FINSI;

     |SI #500#1 = 0; |ACABA; |FINSI;

     nLinea = 0;
     |ABRE #agis0002;
     |DDEFECTO #agis0002;
     #agis0002#30 = "A";
     #agis0002#20 = #agifa010#52;
     #agis0002#17 = #agifa010#0;
     #agis0002#18 = 01;
     |LEE 000#agis0002.=;
     |SI FSalida ! 0;
        |ABRE #agifa177;
        #agifa177#0 = #agis0002#22;
        |LEE 000#agifa177.=;
        |SI FSalida ! 0; |DDEFECTO #agifa177; |FINSI;
        |CIERRA #agifa177;

        |DDEFECTO #agis0002;
        #agis0002#30 = "A";
        #agis0002#20 = #agifa010#52;
        #agis0002#17 = #agifa010#0;
        #agis0002#18 = 1;
        #agis0002#1  = 1;
        #agis0002#2  = #agifa010#3;
        #agis0002#3  = #agifa010#4;
        #agis0002#4  = #agifa024#29;
        #agis0002#7  = #agifa010#1;
        #agis0002#8  = #agifa010#1;
        |SI #0#43 = "S";
              #agis0002#9 = -#agifa010#61;
        |SINO;
              #agis0002#9 = #agifa010#61;
        |FINSI;
        #agis0002#12 = #agifa024#16;
        #agis0002#19 = #agifa010#52;
        #agis0002#24 = #agifa010#8;
        #agis0002#28 = #agifa177#3;
        |GRABA 020#agis0002.c;
     |FINSI;
     |CIERRA #agis0002;

     |DBASS aPath;
     aPath = aPath + "dscarter/";
     aDef00 = aPath + "def/dscamrec";
     |CARGA_DEF aDef00, dscamrec@;
     |SI FSalida ! 0;
        aMensa = "0000Error al cargar:" + aDef00;
        |MENAV aMensa;
        aDef00 = "";
     |SINO;
        |HAZ CreaTempo; aTempo600 = Tempo;
        |PATH_DAT #600 aPath; |NOME_DAT #600 aTempo600; |DELINDEX #600;
        |ABRE #600;
        aCPath = aPath; aCNome = aTempo600;
     |FINSI;
     |DFICE Comodin;
     Comodin = Comodin % -106;
     Comodin = Comodin % 0105;
     Divisa     = #agifa010#68;
     CambioBase = #agifa010#69;
     CambioDiv  = #agifa010#74;

     |ABRE #agifa324;
     #agifa324#0 = Divisa;
     |LEE 000#agifa324.=;
     |SI FSalida ! 0; |DDEFECTO #agifa324; |FINSI;
     |CIERRA #agifa324;

     nDeci_Div = #agifa324#7;
     |DDEFECTO #dscamrec@;
     #600#1  = #agifa010#52;||Serie
     #600#2  = #agifa010#0; ||Fact
     #600#3  = #agis0002#18;||N§ Rec
     #600#4  = #agis0002#8; ||F.V
     #600#5  = #agis0002#7; ||F.E
     #600#6  = #agis0002#12;||Cuenta Cli
     #600#7  = #agis0002#3; ||Nom Cli
     #600#8  = #agis0002#4; ||Nom Banco
     #600#9  = #agifa024#32;      ||Entidad
     #600#10 = #agifa024#33;      ||Sucursal
     #600#11 = #agifa024#31;      ||DC
     #600#12 = #agifa024#30;      ||Cuenta
     #600#13 = #agis0002#22;||Tipo Rec
     #600#15 = #agis0002#9; ||Importe
     #600#16 = #agis0002#15;||A aceptar
     #600#17 = #agis0002#6; ||Aceptado
     #600#18 = #agis0002#2; ||Cliente
     #600#21 = #agifa024#3; ||Zona
     #600#22 = 1;           ||Documento
     #600#25 = Comodin;     ||Empresa ges
     #600#27 = "V";         ||Tipo
     #600#28 = "A";         ||Ope
     #600#29 = #agifa324#0; ||Divisa
     #600#30 = #agifa324#1; ||Nombre
     #600#31 = CambioDiv;   ||Cambio Divisa
     #600#32 = CambioBase;  ||Cambio Base
     #600#33 = #agifa024#203;
     #600#34 = 0;
     #600#35 = "A";
     #600#36 = #agis0002#28;
     #600#38 = #agis0002#16;
     #600#39 = #agis0002#10;
     |GRABA 020#600n;

     |SUB_EJECUTA_NP aSubProg;

     |SI aDef00 ! "";
          |CIERRA #600;
          |DELINDEX #600;
          |DESCARGA_DEF #dscamrec@;
     |FINSI;

     |SI #0#51 = "S";    || Facturable
          eaTag = "RAA"; |HAZ Riesgos;
     |FINSI;
     |CIERRA #agis0002;

     |HAZ LeeMonBase;
     |HAZ Param_Divisas;
|FPRC;

|PROCESO EvaAviso;
     |HAZ EsEvaristo;
     nSwEsEvaristo = FSalida;
     |SI FSalida = 0;
          |DDEF aAlfa;
          aAlfa = aAlfa + "evarm041";
          |CARGA_DEF aAlfa, referen@;
          |SI FSalida = 0;
               |ABRE #referen@;
               #referen@#0 = #0#3;
               |LEE 000#referen@.=;
               |SI FSalida ! 0; |DDEFECTO #referen@; |FINSI;
               |CIERRA #referen@;

               #agifa024#53 = #referen@#1;

               |DESCARGA_DEF #referen@;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO alriesgo;
     ||ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ Observaciones Clientes.
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 4; |ACABA; |FINSI;

     |ABRE #4;
     #4#0 = #0#3;
     |LEE 000#4=;
     |SI FSalida ! 0; |ACABA; |FINSI;
     |CIERRA #4;

     |SI #agifa142#14 = "S";
          |HAZ EvaAviso;
          puente = #agifa024#53;     |QBF puente;
          |SI puente ! "";
               |PUSHV 1008 1370;
               |SI #agifa142#20 = "S"; |AVISO; |FINSI;
               |BLANCO 1009 1369;
               |CUADRO 1008 1370;
               |ATRI R;
               |PINTA 1110 , #agifa024#53;
               |ATRI 0;
               |SI nSwEsEvaristo = 0;
                    |PINTA 1245, "Pulse Fin para continuar.";
                    aFin = &255 + 816;
                    |PARA aTecla = ""; |SI aTecla ! aFin; |HACIENDO;
                         |LEETECLA aTecla;
                    |SIGUE;
               |SINO;
                    |PAUSA;
               |FINSI;
               |POPV;
          |FINSI;
     |FINSI;

     |SI #0#51 = "N"; |ACABA; |FINSI;   || Facturable

     ||ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ Control Riesgo Cliente.
     nMasRies = 0;
     eaSerie = #0#52; eaTag = "AV";  |HAZ SacaRiesgo;

     |SI #0#43 = AN; |Y #agifa142#6 = "S"; |Y eaExisteCliRie = "S";
          eaDocu = "C";
          eaTipo = "A";
          enImpoDoc = #0#67;
          eaMuestra = "S";
          |HAZ ControlRiesgo;
          |HAZ CtrlRiesgoTaglo;
          |SI enErrRie ! 0; nError6 = 1; |ERROR; |ACABA; |FINSI;
          |SI enAudito = 0;
               |ABRE #143;
               |LEE 000#143u;
               |SI FSalida = 0;
                    nConAu = #143#0 + 1;
               |SINO;
                    nConAu = 1;
               |FINSI;
               |DDEFECTO #143;
               #143#0 = nConAu;
               #143#12 = "ALBARAN";
               #143#1 = #0#52;
               #143#2 = #0#0;
               #143#3 = #0#1;
               #143#4 = #0#3;
               #143#5 = #0#4;
               #143#6 = Usuario % 810;
               #143#7 = #141#0;
               #143#8 = #141#1;
               #143#9 = #141#2;
               #143#10 = #141#3;
               #143#11 = #141#4;
               |GRABA 020#143n;
               |CIERRA #143;
          |FINSI;
     |FINSI;
|FPRC;


|PROCESO actpf;
     |SI #0#15 ] 0;
          importe = 1;
     |SINO;
          importe = -1;
          #0#15 = -#0#15;
     |FINSI;
     cant = #0#15 < #0#5;
     cant = cant < #0#32;
     cant = cant < #0#7;
     cant = cant * importe;
     #0#15 = #0#15 * importe;
     |ABRE #4;
     #4#0 = #0#3;
     |LEE 121#4=;
     |SI FSalida = 0;
        |SI #0#43 = AN;
           #4#50 = #4#50 +. cant;    || es albaran
        |SINO;
           #4#50 = #4#50 -. cant;    || es abono
        |FINSI;
        |GRABA 020#4a;
        |LIBERA #4;
     |FINSI;
     |CIERRA #4;

     |SI #0#43 = "N";
          enImpCliPen = cant * nForma;
     |SINO;
          enImpCliPen =  -cant * nForma;
     |FINSI;
     eaCliente = #0#3;
     efFecha = #0#1;
     |HAZ AcumulaCli;

     eaTag = "AV";  |HAZ Riesgos;
|FPRC;


|PROCESO abo;|TIPO 0;
con = (FEntrada / 100) ! 0;
|SI con = 2;|Y #0#43 ! Contenido;
   |MENAV "0000No puede modificar este campo !";
   |ERROR;
|FINSI;
|FPRC;

|PROCESO totalba;|TIPO 14;
|PINTA 0577,"  ";
|SI #0#41 = 0;|Y #0#42 = 0;
     |PINTA 0577,"AV";
|SINO;
     |SI #0#41 ! 0;
          |PINTA 0577,"PV";
     |SINO;
          |SI #0#42 ! 0;
               |PINTA 0577,"AD";
          |FINSI;
     |FINSI;
|FINSI;
|FPRC;

|PROCESO para_ger;
     nModo = (FEntrada / 100) ! 0;

     enModo10 = nModo;

     |HAZ EsQDClor;
     |SI FSalida = 0;
          |HAZ PinQDClor10;
     |FINSI;

     |ABRE #42; |LEE 001#42p; |CIERRA #42;
     n_dec = #42#8;
     n_pre = #42#9;
     dto_prom = #42#18;
     recoge = #42#27;
     DescAmpli = #agifa142#40;     || Descargar descripcion ampliada
     |ABRE #44;
     #44#26 = #0#52;
     |LEE 001#44=;
     |SI FSalida ! 0; |DDEFECTO #44; |FINSI;
     |CIERRA #44;
     def_alm = #44#29;
     def_exp = #44#30;
     |SI #44#30 = "S";
          #0#12 = 0;
          #0#14 = 0;
          |PINTA #0#12;
          |PINTA #0#14;
     |FINSI;
     |SI nModo = 1;
          |C_M #0#51, 1, "S";
          #0#51 = #44#28;
          |SI #44#37 = "S"; #0#51 = "N"; |C_M #0#51,1,"N"; |FINSI;
     |FINSI;
     |PINTA #0#51;
     |HAZ LeeMonBase;
     |HAZ LeeParamDiv;
|FPRC;


|PROCESO Bultos10; |TIPO 0;
     |SI #0#2 ! 0;
          |HAZ EsVigor;
          |SI FSalida = 0;
               enModo = (FEntrada / 100) ! 0;
               eaSerie = #0#52;
               enCodigo = #0#0;
               |SUB_EJECUTA_NP "vigm0048";
               #0#55 = eaAlfa % 0110; |PINTA #0#55;
               #0#56 = eaAlfa % 1130; |PINTA #0#56;
               #0#57 = eaAlfa % 4110; |PINTA #0#57;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO extracto;
          modo = (FEntrada / 100) ! 0;
          |SI modo = 4;
               |ABRE #4;
               #4#0 = #0#3;
               |LEE 001#4=;
               |SI FSalida ! 0; |DDEFECTO #4; |FINSI;
               |CIERRA #4;
          |FINSI;
          |PUSHV 0501 2380;
          ext1 = #4#16;
          |SUB_EJECUTA_NP "caextrap";
          |POPV;
|FPRC;

|PROCESO entra_0; |TIPO 0;
     nModo = (FEntrada / 100) ! 0;
/*
     |SI nModo = 1;
          |HAZ EsPCEGroup;
          |SI FSalida = 0;
               |MENAV "0000Opción no permitida. Los albaranes solo se generan por servicio de pedidos.";
               |ERROR; |ACABA;
          |FINSI;
     |FINSI;
*/
|FPRC;

|PROCESO entra_7; |TIPO 7;
     nModo = (FEntrada / 100) ! 0;

     |HAZ ControlUsuAV;
     |SI enErr ! 0; |PTEC 807; |ACABA; |FINSI;

     |C_P #0#3, 0, enPosCli;
     |HAZ DefSerVta;
     |SI nModo = 1; |Y #279#24 = "S";
          |SI eaSerCli ! "";
               #0#52 = eaSerCli; |PTEC 802;
          |SINO;
               |PTEC 807; |PTEC 807; |ERROR; |ACABA;
          |FINSI;
     |FINSI;

     |SI PRMNT_aHisto ! "";
          ser_alb = PRMNT_aHisto % 105;
          num_alb = (A\(PRMNT_aHisto % 6));

          #0#52 = ser_alb;
          #0#0 = num_alb;
          |PTEC 802;
          |PTEC 802;
          |PINTA #0#52;
          |PINTA #0#0;
          |ACABA;
     |FINSI;

     |HAZ EsTecatel;
     nSwTecatel = FSalida;
     |SI FSalida = 0;         || Serie segun cliente
          aCliTeca = "";
          |C_M #0#3, 1, "S";
          |SI nModo = 1;
               |ENCAMPO #3#0; aCliTeca = #0#3;
               |SI FSalida ! 0; |PTEC 807; |ACABA; |FINSI;
               |C_M #0#3, 1, "N";
               aAlfa = #4#166; |QBF aAlfa;
               |SI aAlfa ! ""; #0#52 = aAlfa; |FINSI;
          |FINSI;
     |FINSI;
     |HAZ EsQDClor;
     |SI FSalida = 0;
          |HAZ PinQDClor10;
     |FINSI;
|FPRC;

|PROCESO pinta_obs; |TIPO 14;
     |ABRE #agifa204; |LEE 000#agifa204.p; |CIERRA #agifa204;
     puente = #agifa204#6; |QBF puente;
     |SI puente ! "";
         |ATRI I;  |PINTA 2005 , puente;    |ATRI 0;
         |C_M #0#55 , 1 , "S";
     |FINSI;

     puente = #agifa204#7; |QBF puente;
     |SI puente ! "";
         |ATRI I;  |PINTA 2030 , puente;    |ATRI 0;
         |C_M #0#56 , 1 , "S";
     |FINSI;

     puente = #agifa204#8; |QBF puente;
     |SI puente ! "";
         |ATRI I;  |PINTA 2055 , puente;    |ATRI 0;
         |C_M #0#57 , 1 , "S";
     |FINSI;

     |ATRI I;
|FPRC;

|PROCESO consulta; |TIPO 0;  || Consulta Por Clientes
     modo = (FEntrada / 100) ! 0;
     |SI FSalida = 9;
          |SI modo = 1;
               |MENAV "0000No es posible la consulta en modo ALTA";
               |ERROR;
          |SINO;
               |CONSULTA_CLAVE #2#0;
          |FINSI;
     |FINSI;
|FPRC;


|| Borrar los trabajos de Albaranes

|PROCESO bortrab1;
 |BUCLELIN 1NULL#100;
 |BORRA 020#100a;
 |LIBERA #100;
|FPRC;

|DEFBUCLE bortrab;
 #100#4;
 ;
 sserie,nnumer;
 sserie,nnumer;
 be;
 NULL, bortrab1;
|FIN;

|PROCESO bajatrabajo;
     |ABRE #42; |LEE 000#42p; |CIERRA #42;

     |SI #42#132 = "S";
         sserie = #0#52;
         nnumer = #0#0;
         |BUCLE bortrab;
     |FINSI;
|FPRC;


___________/ VIC 15-07-98

_____________________________________/ COMPROBACION CLIENTE / SERIE.



|PROCESO LeeMonBase; ||Lee los parametros de la moneda base
     |ABRE #agifa321;
     |ABRE #agifa324;
     |LEE 010#agifa321.p;   ||Leo parametros de divisa
     #agifa010#73 = #agifa321#9;  ||Cojo la Moneda Base de parametros
     #agifa324#0 = #agifa321#9;
     |LEE 010#agifa324.=;         ||Leo la ficha de la moneda base en Divisas
     #agifa010#74 = #agifa324#2;  ||Asigno el cambio de la moneda base con el euro
     decim_base = #agifa324#7;    ||Asigno los decimales de la moneda base
     precio_base = #agifa324#9;   ||Asigno los decimales del precio en la mon. base
     |CIERRA #agifa324;
     |CIERRA #agifa321;
|FPRC;

|PROCESO Param_Divisas; |TIPO 0;
     pintado = 0;  ||Controla pintados de las lineas

     |ABRE #agifa324;
     #agifa324#0 = #agifa010#68;
     |LEE 001#agifa324.=;   || Leo la divisa
     |CIERRA #agifa324;

     decim_divisa = #agifa324#7;  || Decimales de la divisa
     precio_divisa = #agifa324#9;  || Decimales en el precio de la divisa
     nDeci_Div = decim_divisa;   || Decimales de la divisa
     nDeci_PreDiv = precio_divisa;  || Decimales en el precio de la divisa
     |SI #0#70 = "B";   || Si trabajo con la moneda base ...
          nDeci_PreVis   = precio_divisa;
          nDeci_ImpVis   = decim_divisa;
          nDeci_Base     = decim_base;
          nDeci_PreBase  = precio_base;
          nDeci_BaseMx  = decim_base;
          nDeci_PreBaseMx = precio_base;
          nDeci_TotVis   = decim_base;
          nDeci_TotNoVis = decim_divisa;
     |SINO;     || Si trabajo con la divisa ...
          nDeci_PreVis   = precio_base;
          nDeci_ImpVis   = decim_base;
          nDeci_Base     = decim_base; || Max. precision en los decimales de la moneda base
          nDeci_PreBase  = precio_base;  || Max. precision en los dec. del precio de la moneda base
          |SI #agifa010#69 = 1;
               nDeci_BaseMx    = decim_base;    || sin triangulacion
               nDeci_PreBaseMx = precio_base;
          |SINO;
               nDeci_BaseMx    = #agifa321#10;  || con triangulacion
               nDeci_PreBaseMx = #agifa321#11;
          |FINSI;
          nDeci_TotVis   = decim_divisa;
          nDeci_TotNoVis = decim_base;
     |FINSI;
     |HAZ Deci_IVA;
|FPRC;

|PROCESO LeeParamDiv; |TIPO 0;
     |ABRE #agifa321;
     |LEE 001#agifa321.p;    || Leo parametros de divisas
     |ABRE #agifa007;
     #agifa007#26 = #agifa010#52;
     |LEE 001#agifa007.=;        || Leo la serie

     |SI #agifa007#39 = "N"; |O #agifa321#1 = "N";
          #0#70 = "B";
     |FINSI;

     |SI #0#70 = "D";      || Si la mon. de trabajo es la divisa...
          || ...escondo los campos de la moneda base :
          |C_P #3#6 , 1 , 1009;
          |C_P #3#9 , 1 ,1026;
          |C_V #3#6 , 1 , "N";
          |C_V #3#9 , 1 , "N";
          |C_L #3#6 , 1 , "N";
          |C_L #3#9 , 1 , "N";
          |C_M #3#6 , 1 , "N";
          || ...y pongo en pantalla los de divisa
          |C_P #3#36 , 1 , 1544;
          |C_P #3#37 , 1 ,1568;
          |C_V #3#36 , 1 , "S";
          |C_V #3#37 , 1 , "S";
          |C_M #3#36 , 1 , "S";
          |C_L #3#36 , 1 , "S";
          |C_L #3#37 , 1 , "S";
          |SI #agifa007#39 = "S"; |Y #agifa321#1 = "S"; ||Si la serie es de ...
               ac_divisa = "S";  || ... divisas, y en parametros estan activadas ...
               || ... pongo como modificables los campos relacionados con divisas
               |C_M #0#68 , 1 , "S";
               |C_M #0#69 , 1 , "S";
               |C_M #0#70 , 1 , "S";
               |C_M #0#71 , 1 , "S";
               |C_M #0#72 , 1 , "S";
               |SI #agifa321#3 = "S";  || Si la visualizacion de parametros esta activada
                    || ... pongo los campos visual. de lineas como visualizables
                    |C_V #3#38, 1 , "S";
                    |C_V #3#39 , 1 , "S";
               |SINO;
                    || ... los pongo como no visualizables
                    |C_V #3#38 , 1 , "N";
                    |C_V #3#39 , 1 , "N";
               |FINSI;
          |SINO; || Si la serie no es de divisas, o no estan activados parametros
               ac_divisa = "N";
               #0#70 = "B";  || La moneda de trabajo es por fuerza la moneda base
               |PINTA #0#70;
               || Pongo como no modificables los campos relacionados con divisas
               |C_M #0#70 , 1 , "N";
               |C_M #0#71 , 1 , "N";
               |C_M #0#72 , 1 , "N";
               |C_M #0#68 , 1 , "N";
               |C_M #0#69 , 1 , "N";
               || Pongo como no visualizables los campos visual. de lineas
               |C_V #3#38, 1 , "N";
               |C_V #3#39, 1 , "N";
          |FINSI;
     |SINO;  || Si la moneda de trabajo es la moneda base
          |C_V #0#11, 1, "N";
          |C_V #0#13, 1, "N";
          || ...escondo los campos en divisa :
          |C_P #3#36 , 1 , 1009;
          |C_P #3#37 , 1 ,1026;
          |C_V #3#36 , 1 , "N";
          |C_V #3#37 , 1 , "N";
          |C_M #3#36 , 1 , "N";
          |C_L #3#36 , 1 , "N";
          |C_L #3#37 , 1 , "N";

          || ...coloco los campos en moneda base:
          |C_P #3#6 , 1 , 1544;
          |C_P #3#9 , 1 ,1568;
          |C_V #3#6 , 1 , "S";
          |C_V #3#9 , 1 , "S";
          |C_M #3#6 , 1 , "S";
          |C_L #3#6 , 1 , "S";
          |C_L #3#9 , 1 , "S";
          |SI #agifa007#39 = "S"; |Y #agifa321#1 = "S"; || Si la serie es de divisas...
               ac_divisa = "S"; || ... y divisas estan activadas en parametros
               || Pongo como modificables los campos relacionados con divisas
               |C_M #0#68 , 1 , "S";
               |C_M #0#69 , 1 , "S";
               |C_M #0#70 , 1 , "S";
               |C_M #0#71 , 1 , "S";
               |C_M #0#72 , 1 , "S";
               |SI #agifa321#3 = "S";  || Si la visualizacion esta activada en parametros ...
                    || Pongo como visualizables los campos visual. de las lineas
                    |C_V #3#38, 1 , "S";
                    |C_V #3#39 , 1 , "S";
               |SINO; || Los pongo como no visualizables
                    |C_V #3#38 , 1 , "N";
                    |C_V #3#39 , 1 , "N";
               |FINSI;
          |SINO;  || Si la serie no es de divisas o no estan activados los parametros
               ac_divisa = "N";
               #0#70 = "B";  || La moneda de trabajo es por fuerza la moneda base
               || Pongo como no modificables los campos relacionados con divisas
               |C_M #0#70 , 1 , "N";
               |C_M #0#71 , 1 , "N";
               |C_M #0#72 , 1 , "N";
               |C_M #0#68 , 1 , "N";
               |C_M #0#69 , 1 , "N";
               || Pongo como no visualizables los campos visual. de lineas
               |C_V #3#38, 1 , "N";
               |C_V #3#39, 1 , "N";
          |FINSI;
     |FINSI;
     ||ÄÄÄÄÄÄÄÄPortes/Varios
     |C_P #0#81, 0, nPos; |C_P #0#11, 1, nPos;
     |C_P #0#82, 0, nPos; |C_P #0#13, 1, nPos;
     |C_V #0#11, 1, "N";
     |C_V #0#13, 1, "N";
     |C_V #0#81, 1, "N";
     |C_V #0#82, 1, "N";
     |SI #0#70 = "D";
          |C_V #0#81, 1, "S";
          |C_V #0#82, 1, "S";
     |SINO;
          |C_V #0#11, 1, "S";
          |C_V #0#13, 1, "S";
     |FINSI;

     |CIERRA #agifa007;
     |CIERRA #agifa321;
     |HAZ Param_Divisas;


     |HAZ EsInforAlba;
     |SI FSalida = 0;
          |C_V #0#11, 1, "N";
          |C_V #0#81, 1, "N";
     |FINSI;
|FPRC;

|PROCESO CambioDivisa; |TIPO 0;
     nModo010 = (FEntrada / 100) ! 0;
     |SI nModo010 = 1;   ||Si cambia el valor o es alta
          |ABRE #agifa007;
          #agifa007#26 = #agifa010#52;
          |LEE 020#agifa007.=;  || Leo la serie
          |CIERRA #agifa007;
          |SI #agifa007#39 = "S"; |Y #agifa321#1 = "S";
               |SI #agifa024#191 = "S"; || Si el cliente es de divisa pactada
                    |ABRE #agifa328;
                    |ABRE #agifa329;
                    #agifa329#0 = #agifa010#3;
                    #agifa329#2 = #agifa010#68;
                    #agifa329#7 = "N";
                    |SELECT #2#agifa329;  || Con esta clave ...
                    |LEE 011#agifa329.=;  || ... busco periodos no finalizados de esa divisa
                    |SI FSalida = 0;  || Si existe un periodo no finalizado
                         |PARA div_act = 0; |SI div_act = 0; |HACIENDO;
                              #agifa010#68 = #agifa329#2;        || Cargo la divisa ...
                              #agifa010#69 = #agifa329#3;        || ...y el cambio
                              |LEE 001#agifa329.=;   || Leo las lineas de Clientes/Divisas
                              nfecha = #agifa010#1 - #agifa329#6;  || Resto la fecha de fin de periodo a la actual
                              |SI nfecha > 0;  || Si la fecha actual supera a la del periodo asignado ...
                                   |MENAV "0000ATENCION deberia Actualizar primero la divisa en Clientes/Divisas";
                                   cli_divisa = #agifa010#3;  || Le envio el cod. de cliente a "agifa328"
                                   |SUB_EJECUTA_NP "agifa328.tab";  || Ejecuto Clientess/Divisas
                                   |ERROR;
                              |SINO;
                                   div_act = 1;  || Para salir del PARA
                              |FINSI;
                         |SIGUE;
                    |SINO;  || Si no existe un periodo no finalizado para esa divisa
                        |MENAV "0000No existe un periodo activo para la divisa en Clientes / Divisas";
                        cli_divisa = #agifa010#3;  || Le paso a "agifa328" el cliente
                        |SUB_EJECUTA_NP "agifa328.tab";  || Ejecuto Clientes / Divisas
                        |ERROR;
                    |FINSI;
                    |SELECT #1#agifa329;
                    |CIERRA #agifa329;
                    |CIERRA #agifa328;
               |SINO; || Si el Cliente no es de Divisa pactada ...
                    |ABRE #agifa324; || ...miro directamente en divisas
                    #agifa324#0 = #agifa010#68;
                    |LEE 001#agifa324.=;
                    |SI FSalida = 0; ||Si existe la divisa...
                         #agifa010#69 = #agifa324#2; || la recojo
                         |SI #agifa324#5 ! -1; || Si los dias de margen de actualizacion no
                                       || son = -1 (indefinidos)
                              |PARA div_act = 0; |SI div_act = 0; |HACIENDO;
                                   #agifa010#68 = #agifa324#0;        ||Cargo el valor de la divisa
                                   #agifa010#69 = #agifa324#2;        ||Cargo el valor del cambio
                                   |LEE 001#agifa324.=;  || Leo la divisa
                                   nfecha = #agifa010#1 - #agifa324#4;
                                   |SI nfecha > #agifa324#5; |Y #agifa324#5 ! -1;  || Si la fecha actual
                                        |MENAV "0000ATENCION deberia Actualizar primero la divisa";
                                        divisa = #agifa010#68;
                                        |SUB_EJECUTA_NP "agifa326.tab";
                                        |ERROR;
                                   |SINO;
                                        div_act = 1;
                                   |FINSI;
                              |SIGUE;
                         |FINSI;
                    |FINSI;
                    |CIERRA #agifa324;
               |FINSI;
          |SINO;
               #agifa010#68 = #agifa010#73;
               #agifa010#69 = #agifa010#74;
          |FINSI;
          |PINTA #agifa010#68;
          |PINTA #agifa010#69;
          |SI Campo = 3; || Si llamo al proceso desde el cod. de cliente ...
               |HAZ LeeParamDiv;
          |SINO;
               |HAZ Param_Divisas;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO convportes; |TIPO 6;
     |SI #0#70 = "D";
          #0#11 = #0#81 / #0#69 * #0#74;
     |SINO;
          #0#81 = #0#11 * #0#69 / #0#74;
     |FINSI;
     |HAZ dcon;
|FPRC;

|PROCESO convvarios; |TIPO 6;
     |SI #0#70 = "D";
          #0#13 = #0#82 / #0#69 * #0#74;
     |SINO;
          #0#82 = #0#13 * #0#69 / #0#74;
     |FINSI;
     |HAZ dcon;
|FPRC;

|PROCESO DocErp;
     nSwEstaDocErp = 1;
     |ERROR10;
|FPRC;

|DEFBUCLE DocErp;
 #otroref@#1005;
 ;
 aAplicaErp, nEmpErp, aDefErp, aClaveErp, 01;
 aAplicaErp, nEmpErp, aDefErp, aClaveErp, 99;
 ;
 NULL, DocErp;
|FIN;

|PROCESO MiraSiEstaDocErp;
     |DBASS aBass;
     |QBF aBass;
     aErp = aBass + "dserp/def/dserpm09.mas";
     |XABRE "E", aErp, 0;
     |SI FSalida ] 0;
          |CARGA_DEF aErp, otroref@;
          |SI FSalida = 0;
                 aPathErp = aBass + "dserp/fich/";
                 |PATH_DAT #otroref@#aPathErp#;

                 aCien = " " * 100;
                 nEmpErp = #48#0;
                 aAplicaErp = "dscomer9";
                 aDefErp = "agifa010";
                 aClaveErp = #agifa010#52 + ("000000" + #agifa010#0) % -106;
                 |QBF aClaveErp;
                 aClaveErp = (aClaveErp + aCien) % 199;
                 aClaveErp = aClaveErp + " ";

                 |BUCLE DocErp;

                 |DESCARGA_DEF #otroref@;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO LeeAlb; |TIPO 13;
     nFlag = 0;
     |HAZ EsAparecida; |SI FSalida = 0; nFlag = 1; |FINSI;
     |HAZ EsGesineed;  |SI FSalida = 0; nFlag = 1; |FINSI;
     |HAZ EsJamaica;   |SI FSalida = 0; nFlag = 1; |FINSI;
     |HAZ EsDesanch;   |SI FSalida = 0; nFlag = 1; |FINSI;
     |SI nFlag = 1;
          nSwEstaDocErp = 0;
          |HAZ MiraSiEstaDocErp;
          |SI nSwEstaDocErp = 1;
               |PINTA 0520, "* * * DOCUMENTO ASOCIADO * * *";
          |SINO;
               |PINTA 0520, "ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ";
          |FINSI;
     |FINSI;

     |HAZ EsAlbero;
     |SI FSalida = 0;
          |HAZ AlbeAlbVPinta;
     |FINSI;
     |HAZ EsAlbadis;
     |SI FSalida = 0;
          |HAZ AlbaPinAlb;
     |FINSI;
     |HAZ EsInforAlba;
     |SI FSalida = 0;
          |HAZ PinInforAlba10;
     |FINSI;
     |HAZ EsQDClor;
     |SI FSalida = 0;
          |HAZ PinQDClor10;
     |FINSI;
     |HAZ EsOrts;
     |SI FSalida = 0;
          |HAZ OrtsPin010;
     |FINSI;
     |HAZ EsFergalsan;
     |SI FSalida = 0;
          |HAZ PinFergalsan;
     |FINSI;

     pintado = 0;   || controla pintado de las lineas
     |HAZ LeeMonBase;
     |HAZ LeeParamDiv;
|FPRC;

|PROCESO PintaDiexpa;
     |ABRE #4;
     #4#0 = #0#3;
     |LEE 000#4=
     |CIERRA #4;
     |ATRI I; |PINTA 852, "Tipo Facturacion:  "; |ATRI 0;
     |PINTA 870, #4#41;
|FPRC;

|PROCESO Tipo010_8; |TIPO 8;
     |HAZ EsTagloma;
     |SI FSalida = 0;
          |CONTROL_SIMPLE 0, "BOTON, ItemDoc", 0570, 0578, BtnItemDocAlb;
          nBtnItemDocAlb = FSalida;
          |CONTROL_SIMPLE 0, "BOTON, WorkFlow", 0470, 0478, BtnWorkFlowAlb;
          nBtnWorkFlowAlb = FSalida;
     |FINSI;
|FPRC;

|PROCESO Tipo010_9; |TIPO 9;
     |SI nBtnItemDocAlb ! -1; |FIN_CONTROL_WINDOWS nBtnItemDocAlb; |FINSI;
     |SI nBtnWorkFlowAlb ! -1; |FIN_CONTROL_WINDOWS nBtnWorkFlowAlb; |FINSI;
|FPRC;

|PROCESO cambfecha;
     |SI #0#71 ! "O";
       #0#72 = "        ";
       |PINTA #0#72;
       |C_M #0#72,1,"N";
       |C_V #0#72,1,"N";
     |SINO;
       |C_M #0#72,1,"S";
       |C_V #0#72,1,"S";
     |FINSI;

     |HAZ EsAparecida;
     |SI FSalida = 0; |HAZ Ret_Aut; |FINSI;
|FPRC;

|PROCESO modomod0; |TIPO 0;
     |HAZ LeeParamDiv;
     |HAZ CambioDivisa;
|FPRC;

|PROCESO modomod7; |TIPO 7;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 2;
          |C_M #0#68, 1, "N";
          |C_M #0#70, 1, "N";
     |SINO;
          |C_M #0#68, 1, "S";
          |C_M #0#70, 1, "S";
     |FINSI;
|FPRC;
/*
  Anulado porque falla, lo cambio por modomod0 y modomod7
|PROCESO modomod; |TIPO 6;
     |SI Campo = 68; |O Campo = 70;
          |SI nModo010 = 2; |Y #0Campo ! Contenido;
              |MENAV "0000No se puede modificar el campo.";
              #0Campo = Contenido;
              |PINTA #0Campo;
              |ERROR;
          |FINSI;
          |SI #0Campo ! Contenido; |Y Campo = 70;
              |HAZ LeeParamDiv;
          |FINSI;
     |FINSI;
|FPRC;
*/
|PROCESO caltotal; |TIPO 0; ||Proceso especial para casos determinados como
                            ||modificar los campos de cabecera en dtos, cambio divisas etc
                            ||Recalcula total albaran, descuentos y ivas de lineas
                            ||En el caso de cambiar el cambio de divisas recalcula tambien precio... de lineas

   |SI #0Campo ! Contenido;|O control = 1; ||Solo si cambia
          caltot = 1;
          |SI Campo = 69; ||Si viene del cambio divisa
              recalpre = 1; ||Recalcular tambien precios linea
          |FINSI;
          |HAZ convportes;
          |HAZ convvarios;
          |HAZ actal;

          |PINTA #0#78;
          caltot = 0;
          recalpre = 0;
   |FINSI;
|FPRC;

|PROCESO PortesPD; |TIPO 7;
/*
     |SI #0#64 = " ";
          #0#64 = #42#100;
          |PINTA #0#64;
     |FINSI;
*/
|FPRC;

|PROCESO linf;
  #39#0 = #0#3;
  #39#1 = 1;
|FPRC;

|PROCESO lsup;
  #39#0 = #0#3;
  #39#1 = 9999;
|FPRC;

|PROCESO DefDirEn;
     |ABRE #39;
     #39#0 = #0#3;
     #39#1 = #0#84;
     |LEE 000#39=;
     |SI FSalida = 0;
          #0#29 = #39#10;  |PINTA #0#29;
          #0#30 = #39#2; |PINTA #0#30;
          #0#31 = #39#3; |PINTA #0#31;
          #0#33 = #39#7; |PINTA #0#33;
          #0#62 = #39#6; |PINTA #0#62;
          |SI factur = 0;
               |SI #39#14 = "  ";
                    #0#6 = #4#25; |PINTA #0#6;
               |SINO;
                    #0#6 = #39#14; |PINTA #0#6;
               |FINSI;
               #0#8 = #4#20; |PINTA #0#8;

               |HAZ EsOrts;
               |SI FSalida = 0;
                    eaTipo = "A";
                    eaCliente = #0#3;
                    eaSerie = #0#52;
                    enCodigo = #0#0;
                    |SUB_EJECUTA_NP "ortsm021;DEFECTO";
                    |HAZ OrtsPin010;
               |FINSI;
          |FINSI;
     |FINSI;
     |CIERRA #39;
|FPRC;

|PROCESO SumaImpCta;
     |SI nSwJamaica = 0;
          |SI #200#32 = "S";  || A¤adido Tiquet:1901/1142
               |SI #200#22 ! 3; |Y #200#22 ! 4;
                    naCum = naCum + #200#9;
               |FINSI;
          |FINSI;
     |SINO;
          naCum = naCum + #200#9;
     |FINSI;
|FPRC;

|DEFBUCLE SumaImp;
     #200#1;
     ;
     "A",SPedido,NPedido, 00;
     "A",SPedido,NPedido, 99;
     be;
     NULL, SumaImpCta;
|FIN;

/*
|PROCESO a_cta; |TIPO 7;
     |SI #42#86 = "S";
          aAlfa = "N";
     |SINO;
          aAlfa = "S";
     |FINSI;
     |C_M #0#61, 1, aAlfa;
|FPRC;

|PROCESO CuadraACta;

   nImpEnt = (nImpEnt + #agis0002#9) ! nDeci_BaseMx;
|FPRC;

|DEFBUCLE CuadraACta;
#agis0002#1;
;
"A", #agifa010#52, #agifa010#0, 00;
"A", #agifa010#52, #agifa010#0, 99;
;
NULL,CuadraACta;
|FIN;

|PROCESO CuadraEntregas;
   |SI FSalida = 9;
      |SI #42#86 ! "N";
          |HAZ a_cta2;
      |SINO;
          |MENAV  "    Entregas a cuenta desactivadas"; |ERROR;
      |FINSI;
      |ACABA;
   |FINSI;

   nImpEnt = 0; |BUCLE CuadraACta;
   |SI nImpEnt ! #agifa010#61;
      #agifa010#61 = nImpEnt; |PINTA #agifa010#61;
   |FINSI;
|FPRC;
*/

|PROCESO a_cta2;
         |SI #agifa010#78 = 0; |ERROR; |ACABA; |FINSI;
         TipoCta = "A";
         Cliente = #0#3;
         SPedido = #0#52;
         NPedido = #0#0;
         FPedido = #0#1;
         PPedido = #0#8;
         TPedido = 0;
         BAdela  = 0;
         |GRABA 020#0a;
         |LIBERA #0;
         |CIERRAT #0;
         |SUB_EJECUTA_NP "agis0002";
         |ABRET #0;
         |LEE 101#0=;

         |HAZ EsJamaica;
         nSwJamaica = FSalida;
         |BUCLE SumaImp;

         #0#61=naCum;

         naCum = 0;

         |BLIN 24;
         |CONFI "0000NDesea imprimir el recibo? ";
         |SI FSalida = 0;
              ser = SPedido;
              doc = NPedido;
              TipoCta = "A";
              eaDivisa = #0#68;
              |HAZ ImpreACta;
         |FINSI;
         |ERROR;
|FPRC;

|PROCESO acttl;|TIPO 0;
     nModo = (FEntrada / 100) ! 0;

     |SI #3#2 ! #2#0;
         |ABRE #2;
         #2#0 = #3#2;
         |LEE 000#2=;
         |CIERRA #2;
     |FINSI;

     |SI caltot = 0;
         |PINTA 443,#3#1;
         #3#15 = #0#3;
         #3#16 = #0#34;
         #3#17 = #0#35;
         |SI nModo ! 4;
               |HAZ TotalLin71;
               |GRABA 020#3a;
               |SI #0#70 = "D";     || Si la moneda de trabajo es la divisa ...
                    |PINTA #3#37;
               |SINO;               || Si la moneda de trabajo es la moneda base ...
                    |PINTA #3#9;
               |FINSI;
               |SI ac_divisa = "S"; |Y #agifa321#3= "S";
                    |PINTA #3#39;   || Si las divisas y la visualizacion estan activadas, pinto
               |FINSI;
         |FINSI;
     |FINSI;

     ||----------------------------Margen
     |HAZ CalCabAgifa010;

     ||------------Historico
     |SI nModo ! 4;
          |HAZ ModiHistoAV;
     |FINSI;

     |LIBERA #3;
|FPRC;

|DEFBUCLE agifa071;
     #3#1;
     ;
     #0#52, #0#0, 001;
     #0#52, #0#0, 999;
     be;
     NULL, acttl;
|FIN;

|PROCESO TieneLin010;
     aTieneLin = "S";
|FPRC;

|PROCESO ElTipo3; |TIPO 3;
     |SI nError2 ! 0; |ERROR; |ACABA; |FINSI;

     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 4; |ACABA; |FINSI;

     aTieneLin = "N";
     |BUCLELIN 2 TieneLin010 #0;
     |SI aTieneLin = "N";
          |BORRA 020#0c;
          |ERROR; |ACABA;
     |FINSI;

     |SI enErr = 0;
          nModo = (FEntrada / 100) ! 0;
          ||ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄModulo 000323
          |HAZ EsTecatel;
          |SI FSalida = 0;
               eaSer = #0#52;
               enDocu = #0#0;
               eaCodigo = #0#3;
               eaTipo = "AE";
               |HAZ TecaTrans;
               |SI PARAMETRO = "agrupa";
                    |HAZ TecaAgrupaAlb;
               |FINSI;
          |FINSI;
          ||ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ ||Modulo '000car'
          |HAZ EsCarnicas;
          |SI FSalida = 0;
               |HAZ AltaCarnicasAV;
          |FINSI;
          ||ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
          |HAZ EsAlbadis;
          |SI FSalida = 0;
               |ABRE #3;
               |HAZ AlbaLinAutoAlta;
               |CIERRA #3;
          |FINSI;
          ||ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
          |HAZ EsGuillen;
          |SI FSalida = 0;
               |ABRE #3;
               |HAZ GuiLinAutoAlta;
               |CIERRA #3;
          |FINSI;
          ||ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
          |HAZ LimCabAgifa010;
          |BUCLE agifa071;

          |SI nModo = 2;
               |HAZ EsInforpor;
               |SI FSalida = 0;
                    #0#90 = "N"; |PINTA #0#90;
                    |HAZ BajaInforpor;
               |FINSI;
          |FINSI;
     |FINSI;
     enErr = 0;
|FPRC;

|PROCESO actal;
     |HAZ LimCabAgifa010;
     |BUCLE agifa071;
|FPRC;

|PROCESO siimpre;|TIPO 30;
     enSoloPositivo = 0;
     enModoCab10 = 0;
     nModo = (FEntrada / 100) ! 0;
     ||ÄÄÄÄÄÄÄÄÄÄÄÄAutomatizacion Empresas
     |ABRE #dsm00114; |LEE 000#dsm00114.p; nSal = FSalida; |CIERRA #dsm00114;
     |SI nSal = 0;
          |CIERRAT #0;
          eaCli = #0#3;
          aAlfa = "dsz99983;ALBALTA" + #0#52 + (("000000" + #0#0) % -106);
          |SUB_EJECUTA aAlfa;
          |ABRET #0;
          |LEE 121#0=;
     |FINSI;

     |HAZ EsGestral;
     |SI FSalida = 0; |HAZ GestralHisParti; |FINSI;

     |HAZ EsSematel;
     |SI FSalida = 0;
          #42#86 = "X";
     |FINSI;

     |SI #42#86 = "X";
         |HAZ apagar;
     |FINSI;

     |SI #42#132 = "S";
          |CONFI "0000N¿Desea introducir la descripcion del trabajo? (S/N) ";
          |SI FSalida = 0;
               sserie = #0#52;
               nnumer = #0#0;
               ffecha = #0#1;
               cclien = #0#3;
               nnombr = #0#4;
               iimpor = #0#15 - #0#25;
               ccoste = 0;
               |BUCLE calcoste;
               |PUSHV 0501 2380;
               consulta = "N";
               |SUB_EJECUTA_NP "agi00002";
               |POPV;
          |FINSI;
     |FINSI;
     ||-------------------------------------------
     || A partir albaran crear el de compras

     |SI nModo [ 2; |Y #agifa142#32 = "S"; |Y #0#95 = "N";
          |CONFI "0000NDesea generar los Albaranes de Compra de forma automatica ? ";
          |SI FSalida = 0;
               eaSerie = #0#52;
               enCodigo = #0#0;
               |GRABA 020#0a;
               |LIBERA #0;
               |CIERRAT #0;
               |SUB_EJECUTA_NP "dsz00085";
               |ABRET #0;
               |LEE 101#0=;
          |FINSI;
     |FINSI;
     ||-------------------------------------------
     |HAZ EsAlbadis;
     |SI FSalida = 0;
          eaSerie = #0#52;
          enCodigo = #0#0;
          |HAZ AlbaRecAlb;
     |FINSI;

     |HAZ EsJamaica;
     |SI FSalida = 0;
          enModo = nModo;
          eaSerie = #0#52;
          enCodigo = #0#0;
          |SUB_EJECUTA_NP "cafe0021";

          aAlfa = "cafe0026;ALBAUTO" + #0#52 + (("000000" + #0#0) % -106);
          |SUB_EJECUTA_NP aAlfa;
     |FINSI;
     |HAZ EsGesisat;
     |SI FSalida = 0;
          aAlfa = "cafe0026;GESAUTO" + #0#52 + (("000000" + #0#0) % -106);
          |SUB_EJECUTA_NP aAlfa;
     |FINSI;

     |HAZ EsInforAlba;
     |SI FSalida = 0;
          eaSerie = #0#52;
          enCodigo = #0#0;
          |SUB_EJECUTA_NP "ialbz005";
     |FINSI;
     ||------------------------------
     |CONFI "2400NDesea imprimir este albaran? ";
     |SI FSalida = 0;
         |GRABA 021#0a;
         |LIBERA #0;

         |HAZ impreal;

         |LEE 101#0=;
     |FINSI;

     |HAZ EsVallcorba;
     |SI FSalida = 0;
          |CIERRAT #0;
          |HAZ VallcorbaMail;
          |ABRET #0;
          |LEE 121#0=;
     |FINSI;

     |HAZ EsCoimasa;
     |SI FSalida = 0;
          |CIERRAT #0;
          |HAZ CoimaEnviaMailAlb;
          nTBultos = 0;
          |ABRET #0;
          |LEE 121#0=;
     |FINSI;

     |MODULO puente;     |QBF puente;
     |SI #42#17 = "S"; |Y #0#51 = "S"; |Y puente = "agifa010";
          |SI #42#19 = "S";
               |CONFI "2400NDesea Facturar este Albaran : ";
               |SI FSalida ! 0;  |ACABA;  |FINSI;
          |FINSI;

          |GRABA 021#0a;
          |LIBERA #0;
          |CIERRAT #0;

          ser_alb = #0#52;
          num_alb = #0#0;
          fec_alb = #0#1;
          abo_alb = #0#43;

          |HAZ EsSematel;
          |SI FSalida = 0;
               fec_alb = ~;
          |FINSI;

          |PUSHV 0101 2480;
          |SUB_EJECUTA_NP "agifa057";       ||Facturar Albaranes
          |POPV;
          |ABRET #0;
          #0#0 = num_alb;
          #0#52 = ser_alb;
          |LEE 101#0=;
     |FINSI;
|FPRC;

|PROCESO impreal;
     modo = (FEntrada / 100) ! 0;
     |SI modo = 1; |O modo = 2;
          |GRABA 020#0a;
          |LIBERA #0;
     |FINSI;
     ser_alb = #0#52;
     num_alb = #0#0;
     abono = #0#43;                 || Abono S/N para discriminar los formatos
                                    || en agifa014

     |CIERRAT #0;
     |SUB_EJECUTA_NP "agifa014";    || Impresion de albaranes
     |ABRET #0;

     #0#52 = ser_alb;
     #0#0 = num_alb;
     |LEE 000#0=;
|FPRC;
ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
_____________________________________/ BUSCA UN CODIGO DE CLIENTE AUTOMATICO.
|PROCESO Menus2;
     |MENU menu;
     |SI FSalida = 1;    ||Automatico
          |ABRE #41;
          #41#2 = "";
          #41#0 = "clientes";
          |LEE 101#41=;
          |SI FSalida = 0;
               #41#1 = #41#1 + 1;
               contador = #41#1;
               |GRABA 021#41a;
          |SINO;
               contador = 1;
               #41#1 = 1;
               |GRABA 021#41n;
          |FINSI;
          cont = contador;
          cont = ("000000" + cont) % -106;
          #0Campo = cont;
          |PINTA #0Campo;
          |LIBERA #41;
          |CIERRA #41;
     |FINSI;
|FPRC;

|PROCESO AltaCli;
     NoExiste = 0;
     alfa = #0#3; |QBF alfa;
     |SI alfa ! ""; |Y #42#1 = "S";
          |ABRE #4;
          #4#0 = #0#3;
          |LEE 000#4=;
          |SI FSalida ! 0;
               NoExiste = 1;
               |HAZ Menus2;
          |FINSI;
          |CIERRA #4;
     |FINSI;
|FPRC;

|PROCESO Cli10_7; |TIPO 7;
     nModo = (FEntrada / 100) ! 0;
     |SI #279#24 = "S";
          |C_M #0#3, 1, "N";
          |SI nModo = 1;
               |SI eaSerCli ! ""; #0#3 = eaCliSer; |FINSI;
          |FINSI;
     |FINSI;

     |SI factur = 1;|O factur = 2;
          |SI factur = 2;
               #0#43 = "S";
               |PINTA #0#43;
          |FINSI;
          #0#3 = clien;
          #0#8 = fpago; |C_M #0#8, 1, "N";
          #0#6 = repres;|C_M #0#6, 1, "N";
          #0#5 = dto;   |C_M #0#5, 1, "N";
          #0#32 = dtoa; |C_M #0#32, 1, "N";
          #0#7 = dtop;  |C_M #0#7,1 , "N";
          |PINTA #0#3;
          |PINTA #0#8;
          |PINTA #0#6;
          |PINTA #0#5;
          |PINTA #0#32;
          |PINTA #0#7;
     |FINSI;
|FPRC;

|PROCESO Cli10_0; |TIPO 0;
     nModo = (FEntrada / 100) ! 0;

     |SI #0Campo ! Contenido; |O nModo = 1;
          |HAZ DefDirEn;
          #0#63 = #4#15; |PINTA #0#63;
          #0#88 = #4#202; |PINTA #0#88;
     |FINSI;
     |SI #0Campo ! Contenido; |Y nModo = 2;
          |SI #42#250 = "S"; |HAZ AlbaModLin; |FINSI;
          |HAZ CheqCliEntre;
          |SI FSalida ! 0; |ERROR; |ACABA; |FINSI;
     |FINSI;
     |SI #0Campo ! Contenido; |O nModo = 1;
          |HAZ EsInforAlba
          |SI FSalida = 0;
               |HAZ InforAlbaDto;
          |FINSI;
          |HAZ EsCongecar;
          |SI FSalida = 0;
               |ABRE #4;
               #4#0 = #0#3;
               |LEE 020#4=;
               |CIERRA #4;
               #0#13 = #4#167; |PINTA #0#13;
               #0#82 = #4#167; |PINTA #0#82;
          |FINSI;
          |HAZ EsEvaristo;
          |SI FSalida = 0; |Y #4#157 = "S";
               |CONFI "0000NCliente Retenido. ¿Continuar?";
               |SI FSalida ! 0; |ERROR; |ACABA; |FINSI;
          |FINSI;
     |FINSI;

     |SI nModo = 1;   ||Si cambia el valor o es alta
          |ABRE #agifa024;
          #agifa024#0 = #0#3;
          |LEE 020#agifa024.=;
          |CIERRA #agifa024;
          #0#68 = #agifa024#192;  || Asigno la divisa por defecto del cliente
          #0#70 = #agifa024#193;  || Asigno la moneda de trabajo del cliente
          #0#36 = #agifa024#47;   || Regimen Equi
          |PINTA #0#70;
     |FINSI;
     cli=#0#3;
     ser=#0#52;
     |SUB_EJECUTA_NP "agifv011.tab;por_ejemplo"
     |HAZ EsTagloma;
     |SI FSalida = 0;
          eaCliente = #0#3;
          |HAZ TagCheqPend;
     |FINSI;

     |HAZ CambioDivisa;

     eaCliente = #0#3;
     eaSerie = #0#52;
     eaTipo = "A";
     |HAZ ExisteCliRie;

     |HAZ Pago7_010;
     |HAZ DefePromo10;

     |SI nModo = 1; |Y #4#28 = "S"; || Cliente Exporacion
          #0#12 = 0; |PINTA #0#12;
          #0#14 = 0; |PINTA #0#14;
     |FINSI;
|FPRC;

|RUTINA InfDir10;
     #39#0 = #0#3;
     #39#1 = 1;
|FRUT;

|RUTINA SupDir10;
     #39#0 = #0#3;
     #39#1 = 9999;
|FRUT;

|PROCESO Cli10_6; |TIPO 6;
     nModo010 = (FEntrada / 100) ! 0;
     salida = FSalida

     |SI aCliTeca ! "";  ||Modulo Tecatel
          #0#3 = aCliTeca;
          |HAZ DefDirEn;
     |FINSI;

     |SI factur ! 0; |Y #0#3 ! clien; |Y Campo = 3;
          |MENAV "0000No se puede modificar el cliente...";
          #0#3 = clien;
          |ERROR; |ACABA;
     |FINSI;

     |HAZ AltaCli;

     |ABRE #4;
     #4#0 = #0#3;
     |LEE 000#4=;
     |CIERRA #4;
     |SI nModo010 = 1; |O #0Campo ! Contenido;
          |HAZ DefDirEn;
     |FINSI;

     |HAZ EsTagloma;
     |SI FSalida = 0;
          eaCliente = #0#3;
          |SUB_EJECUTA_NP "tagz0024";
     |FINSI;

     nError6 = 0;
     |HAZ alriesgo;
     |SI nError6 ! 0; |ERROR; |ACABA; |FINSI;

     |HAZ pedcon0;
     |SI NoExiste ! 0; |ACABA; |FINSI;

     |SI salida = 12;
          |PUSHV 0501 2380;
          |ENTLINEAL #1#39, -2, 1, 22, 1, InfDir10, SupDir10;
          |POPV;
          |ERROR; |ACABA;
     |FINSI;

     |SI salida = 13;
          |HAZ extracto;                       || F5 (extracto)
     |FINSI;
     |SI salida = 11; |O #42#102 = "S"; |O #42#102 = "X";|| F3 Observaciones
          |SI salida ! 2;
               eaFuerza = "N";
               |SI salida = 11; eaFuerza = "S"; |FINSI;
               eaCodigo = #0#3;
               |SUB_EJECUTA_NP "dsz99994";
               |SI #42#102 = "N"; |Y nModo010 ! 2; |ERROR;  |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Dto10_7; |TIPO 7;
     |SI FSalida = 0;
          |HAZ EsAlbero;
          |SI FSalida = 0;
               |HAZ AlbeAlbVEntra;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO FPago0; |TIPO 0;
     |HAZ EsTagloma;
     |SI FSalida = 0;
          eAlfa1 = "AV";
          eAlfa2 = #0#8; ||F.Pago
          |HAZ TagAvisaFP;
     |FINSI;
|FPRC;

|PROCESO Tipo10_20; |TIPO 20;
     |SI FSalida ! "OPCION";
          |SELECT #1#0;
          |LEE 000#0=;
          |SI FSalida ! 0;
               |MENAV "0000Por favor, consulte el registro correcto antes de imprimir.";
               |ACABA;
          |SINO;
               |PINDA #0#0;
          |FINSI;
     |FINSI;
     |HAZ T10_20;
|FPRC;

|PROCESO T10_20;
     enModoCab10 = 0;

     aAlfa = FSalida;
     |HAZ EsRodacal; nSwRod = FSalida;
     |HAZ EsDHL; nSwDHL = FSalida;
     FSalida = aAlfa;

     |SI FSalida = "OPCION";
          |SI nSwRod = 0; |O nSwDHL = 0;
                FSalida = " Opciones "; || El modulo
          |SINO;
                FSalida = " Imprimir "; || La estandar
          |FINSI;
          |ACABA;
     |FINSI;

     |SI nSwRod = 0;
          |MENU MenuRod;
          |SI FSalida = 1; |HAZ impreal; |FINSI;
          |SI FSalida = 2;
               eaSerie = #0#52;
               enCodigo = #0#0;
               |SUB_EJECUTA_NP "rodw0001;ALTA";
          |FINSI;
          |ACABA;
     |FINSI;

     |SI nSwDHL = 0;
          |MENU MenuDHL;
          |SI FSalida = 1; |HAZ impreal; |FINSI;
          |SI FSalida = 2;
               aAlfa = "tecam038;";
               aAlfa = aAlfa + #0#52 + (("000000" + #0#0) % -106);
               |SUB_EJECUTA_NP aAlfa;
          |FINSI;
          |ACABA;
     |FINSI;

     || La estandar
     |HAZ impreal;
|FPRC;

|PROCESO Nif010_7; |TIPO 7;
     |HAZ EsTecatel;
     |SI FSalida = 0;
          |MENSA "0000<F5> Recoger datos del cliente";
     |FINSI;
|FPRC;

|PROCESO Nif010_0; |TIPO 0;
     nSal = FSalida;

     |ABRE #4;
     #4#0 = #0#3;
     |LEE 000#4=;
     |CIERRA #4;
     eaPais = #4#205;

     |SI nSal = 9;
         eaVarDni   = #0Campo;
         enCalcCif  = 1;
         |HAZ CalculoNIFCIF;
         #0Campo = eaVarDni;
         |PINTA #0Campo;
         |ERROR;
         |ACABA;
     |FINSI;

     |HAZ EsTagloma;
     |SI FSalida = 0; |HAZ NifTaglo010; |ACABA; |FINSI;

     eaVarDni  = #0Campo;
     enCalcCif = 0;
     |HAZ CalculoNIFCIF;

     aNifQbf1 = #0Campo;   |QBF aNifQbf1;
     aNifQbf2 = eaVarDni;  |QBF aNifQbf2;

     |SI aNifQbf1 ! aNifQbf2; |Y aNifQbf1 ! "";
         |CONFI "0000SEl Nif puede ser Erroneo. Desea Calcularlo.";
         |SI FSalida = 0;
             #0Campo = eaVarDni;  |PINTA #0Campo;
             |ERROR;
         |FINSI;
     |FINSI;

     |HAZ EsTecatel;
     |SI FSalida = 0;
          |MENSA "0000...";
          |ABRE #4;
          |SELECT #4#4;
          #4#15 = #0#63;
          |LEE 000#4=;
          |SI nSal ! 13; |Y #0#3 ! #4#0;
               |MENAV "0000Nif existente en otro codigo de Cliente";
               |CONFI "0000NRecoger Datos del Cliente:";
               |SI FSalida = 0; nSal = 13; |FINSI;
          |FINSI;
          |SI nSal = 13; ||F5
               #0#3 = #4#0; |PINTA #0#3;
               #0#4 = #4#2; |PINTA #0#4;
               #0#5 = #4#37; |PINTA #0#5;
               #0#7 = #4#38; |PINTA #0#7;
               #0#8 = #4#20; |PINTA #0#8;
               #0#32 = #4#156; |PINTA #0#32;
               #0#40 = #4#41;
               #0#91 = #4#206;
               |HAZ DefDirEn;
               |ERROR;
          |FINSI;
          |CIERRA #4;
     |FINSI;
|FPRC;

|PROCESO TecaAgen; |TIPO 7;
     |HAZ EsDHL;
     |SI FSalida = 0;
          aAlfa = "tecam038;";
          aAlfa = aAlfa + #0#52 + (("000000" + #0#0) % -106);
          |SUB_EJECUTA_NP aAlfa;
     |FINSI;
|FPRC;

|PROCESO SalCurso; |TIPO 0;
     |C_M #0#83,1, "S";
|FPRC;

|PROCESO EntraCurso; |TIPO 7;
     |HAZ EsQDClor;
     |SI FSalida = 0;
          eaSerie = #0#52;
          enCodigo = #0#0;
          |SUB_EJECUTA_NP "qdclor07;";
          |HAZ PinQDClor10;
     |FINSI;

     |HAZ EsPefimian;
     |SI FSalida ! 0; |ACABA; |FINSI;
     |C_M #0#83,1, "N";
     |DDEF aAlfa;
     aAlfa = aAlfa + "dsm00263";
     |CARGA_DEF aAlfa, dsm00263@;
     |SI FSalida ! 0; |ACABA; |FINSI;
     |DDEFECTO #dsm00263@;
     |ABRE #dsm00263@;
     #dsm00263@#0 = #0#52;
     #dsm00263@#1 = #0#0;
     |LEE 101#dsm00263@.=;
     |SI FSalida ! 0; |GRABA 020#dsm00263@.b; |FINSI;
     |ENCAMPO #2#dsm00263@;
     #0#83 = #dsm00263@#2; |PINTA #0#83;
     |GRABA 020#dsm00263@.a;
     |CIERRA #dsm00263@;
     |DESCARGA_DEF #dsm00263@;
|FPRC;

|PROCESO PrecioCab10;
     |ABRE #2;
     #2#0 = #3#2;
     |LEE 020#2=;
     |CIERRA #2;

     |ABRE #4;
     #4#0 = #0#3;
     |LEE 000#4=;
     |CIERRA #4;

     fed_dt = #0#1;   || Fecha....
     art_dt = #3#2;   || Articulo.
     cli_dt = #3#15;  || Cliente..
     fam_dt = #3#13;  || Familia.
     iva_dt = #2#30;  || Tipo Iva.
     dtos_2 = 0;      || Descuento 2.
     dto_pt = 0;      || Descuento Ptas.
     dtos_1 = 0;      || Descuento 1.
     pvp_ve = 0;      || Precio Venta.
     tarifa = #4#39;  || Tarifa Cliente....
     gru_dt = #4#158; || Grupo Cliente.
     nPromo = #0#89;
     |SI #3#35 ! 0;
          uni_dt = #3#35;
     |SINO;
          uni_dt = #3#5;
     |FINSI;
     uni_dt2 = #3#48;
     enMensaje = 0;
     aParam = "";
     eaSerie = #3#29;
     enDirEnt = #0#84;
     enAlmacen = #3#3;
     |SI #2#176 = "S";  enMensaje = 1;  |FINSI;
     |HAZ calcdtos;
     #3#6 = pvp_ve - dto_pt;
     #3#8 = dtos_1;
     #3#33 = dtos_2;
|FPRC;

|PROCESO CreaLinProCab10;
     |ABRE #referen@;
     #referen@#29 = #3#29;
     #referen@#0 = #3#0;
     #referen@#1 = #3#63;
     |LEE 000#referen@.=;
     |SI FSalida = 0; |O #3#63 = 0;
          #referen@#1 = 999;
          |LEE 000#referen@.];
          |SI FSalida = 0;
               |LEE 000#referen@.a;
          |SINO;
               |LEE 000#referen@.u;
          |FINSI;
          |SI FSalida = 0; |Y #referen@#29 = #3#29;  |Y #referen@#0 = #3#0;
               nLin = #referen@#1 + 1;
          |SINO;
               nLin = 1;
          |FINSI;
          |SI nLin = #0#1; nLin = nLin + 1; |FINSI;
          #referen@#29 = #3#29;
          #referen@#0 = #3#0;
          #referen@#1 = nLin;
          |GRABA 020#referen@.b;
     |SINO;
          nLin = #3#63;
          |GRABA 020#referen@.b;
     |FINSI;
     |SALVA_DATOS #3;
     |REPON_DATOS #referen@;

     #referen@#1 = nLin;
     #referen@#5 = #3#66;
     #referen@#6 = 0;
     #referen@#7 = 0;
     #referen@#8 = 0;
     #referen@#9 = 0;
     #referen@#36 = 0;
     #referen@#37 = 0;
     #referen@#38 = 0;
     #referen@#39 = 0;
     #referen@#63 = -1;

     |SALVA_DATOS #3;
     |SALVA_DATOS #referen@;
     |REPON_DATOS #3;
     #3#1 = #referen@#1;
     enForma = 1;
     |HAZ AcumulaAV;
     |REPON_DATOS #3;

     |GRABA 020#referen@.a;
     |LIBERA #referen@;
|FPRC;

|PROCESO AlbaModLinea;
     #134#0 = #0#3;
     #134#1 = #3#2;
     |LEE 000#134=;
     |SI FSalida = 0; |Y #0#1 ] #134#6; |Y #0#1 [ #134#7;
          #3#15 = #0#3; || cliente
          |HAZ PrecioCab10;
          nUniPromo = #3#5 / #134#2;
          nResto = #3#5 $ #134#2;
          nResto = nResto / #134#2;
          nUniPromo = nUniPromo  - nResto;
          #3#6 = (#3#6 - #134#4) ! nDeci_Base;
          #3#64 = #134#4;
          #3#65 = #134#5;
          #3#66 = nUniPromo * #134#3;
          #3#8 = #134#5;
          |HAZ TotalLin71;
          |SI #3#66 = 0;
               #3#63 = 0;
          |SINO;
               |HAZ CreaLinProCab10;
               #3#63 = nLin;
          |FINSI;
          |GRABA 020#3a;
     |SINO;    || No tiene promocion
          #3#63 = 0;
          #3#64 = 0;
          #3#65 = 0;
          #3#66 = 0;
          |HAZ TotalLin71;
          |GRABA 020#3a;
     |FINSI;
     |LIBERA #3;
|FPRC;

|PROCESO BorraLinPromo;
     |SI #3#63 = -1;
          enForma = -1;
          |HAZ AcumulaAV;
          |BORRA 020#3a;
     |FINSI;
|FPRC;

|PROCESO AlbaModLin;
     |CONFI "0000SActualizar promociones para el nuevo cliente?";
     |SI FSalida = 0;
          |DDEF aAlfa;
          aAlfa = aAlfa + "agifa071";
          |CARGA_DEF aAlfa, referen@;
          |SI FSalida = 0;
               |ABRE #134;
               |ABRE #referen@;
               |BUCLELIN 0 BorraLinPromo #0;
               |BUCLELIN 0 AlbaModLinea #0;
               |CIERRA #referen@;
               |CIERRA #134;
               |DESCARGA_DEF #referen@;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO AsignaDir010;
     ||#0#4 = #39#10;   |PINTA #0#4;
     #0#29 = #39#10;  |PINTA #0#29;
     #0#30 = #39#2; |PINTA #0#30;
     #0#31 = #39#3; |PINTA #0#31;
     #0#33 = #39#7; |PINTA #0#33;
     #0#62 = #39#6; |PINTA #0#62;
     #0#84 = #39#1; |PINTA #0#84;
     |SI #39#14 = "  ";
         #0#6 = #4#25; |PINTA #0#6;
     |SINO;
         #0#6 = #39#14; |PINTA #0#6;
     |FINSI;
     |PINTA #0#6;

     |HAZ EsOrts;
     |SI FSalida = 0;
          eaTipo = "A";
          eaCliente = #0#3;
          eaSerie = #0#52;
          enCodigo = #0#0;
          |SUB_EJECUTA_NP "ortsm021;DEFECTO";
          |HAZ OrtsPin010;
     |FINSI;
|FPRC;

|PROCESO MinDir010;
     #39#0 = #0#3;
     #39#1 = 1;
|FPRC;

|PROCESO MaxDir010;
     #39#0 = #0#3;
     #39#1 = 9999;
|FPRC;

|PROCESO Dir010_0; |TIPO 0;
     |SI FSalida = 2; |ACABA; |FINSI;
     nTecla = FSalida;
     |SI nTecla = 12;    || F4 Alta direccion
          |PUSHV 0501 2380;
          |ENTLINEAL #1#39, -2, 1, 22, 1, InfDir10, SupDir10;
          |POPV;
          nTecla = 18;
     |FINSI;
     |ABRE #39;
     |SI nTecla = 18;   || F10  Todas las direcciones
          #39#0 = #0#3;
          #39#1 = #0#84;
          |LEE 000#39];
          |CONSULTA_F_CLAVE #1#39, MinDir010, MaxDir010;
          |SI FSalida = 0;
               |HAZ AsignaDir010;
          |SINO;
               |ERROR; |ACABA;
          |FINSI;
     |FINSI;
     #39#0 = #0#3;
     #39#1 = #0#84;
     |LEE 000#39=;
     |SI FSalida = 0;
          |SI #39#18 = "N";
               |CONFI "0000NDireccion de entrega desactiva. ¿Continuar?";
               |SI FSalida ! 0; |ERROR; |ACABA; |FINSI;
          |FINSI;
     |SINO;
          |MENAV "0000No existe direccion de entrega...";
          |ERROR; |ACABA;
     |FINSI;
     |CIERRA #39;
     |SI #0Campo ! Contenido;
          |HAZ AsignaDir010;
          |HAZ CheqCliEntre;
          |SI FSalida ! 0; |ERROR; |ACABA; |FINSI;
     |FINSI;
|FPRC;

|PROCESO Dir010_7; |TIPO 7;
     |SI #42#71 = "S";
          |ABRE #39;
          #39#0 = #0#3;
          #39#1 = 1;
          |LEE 000#39];
          |SI FSalida = 0; |Y #39#0 = #0#3;
               |LEE 000#39s;
               |SI FSalida = 0;  |Y #39#0 = #0#3;
                   aSinError = "S";
                   |HAZ Dir010_66;
                   aSinError = "N";
                   |SI nSal = 0; |ERROR; |FINSI;
               |FINSI;
          |FINSI;
          |CIERRA #39;
     |FINSI;
|FPRC;

|PROCESO Dir010_66; |TIPO 66;
     nModo = (FEntrada / 100) ! 0;
     |ABRE #39;
     aSql = "SELECT * FROM dsm00003 INTO sq" + Usuario + ".def WHERE ";
     aSql = aSql + "0 == " + #0#3 + " AND 18 == S";
     |SQL aSql;
     |SI FSalida = 0;
          |DDEF aDef; |QBF aDef;
          aDef = aDef + "sq" + Usuario + ".mas";
          |CARGA_DEF aDef, referen@;
          |SI FSalida = 0;
               |ABRE #referen@;
               #referen@#0 = #0#3;
               #referen@#1 = #0#84;
               |LEE 000#referen@.]
               |CONSULTA_CLAVE #1#referen@;
               nSal = FSalida;
               |SI FSalida = 0;
                    |SI nModo ! 2; |O #referen@#0 ! #0#3; |O #referen@#1 ! #0#84;
                         ||solo si cambia
                         #39#0 = #referen@#0;
                         #39#1 = #referen@#1;
                         |LEE 020#39=;
                         |HAZ AsignaDir010;
                    |FINSI;
               |SINO;
                    |SI aSinError ! "S";
                         |ERROR;
                    |FINSI;
               |FINSI;
               |CIERRA #referen@;
               |DELINDEX #referen@;
               |DESCARGA_DEF #referen@;
               |FBORRA aDef;
          |FINSI;
     |FINSI;
     |CIERRA #39;
|FPRC;

|PROCESO Pago7_010; |TIPO 7;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo ! 1;  |ACABA;  |FINSI;

/*
     |SI Campo = 8;
         |HAZ CargaContagen;
         |SI enOk = 1;
             |ABRE #agifa091;
             #agifa091#0 = #agifa010#8;
             |LEE 000#agifa091.=;
             |CONSULTA_CLAVE #1#agifa091;
             |SI FSalida = 0;
                 #agifa010#8 = #agifa091#0;
             |FINSI;
             |CIERRA #agifa091;
         |FINSI;
     |FINSI;
*/

     |HAZ EsTagloma;
     |SI FSalida = 0;
         eaAlfa = #0#52;
         |HAZ TagloDefFP;
         |SI eaAlfa ! ""; #0#8 = eaAlfa; |PINTA #0#8; |FINSI;

         |SI eaQuitaDto = "S";
             #0#5 = 0; |PINTA #0#5;
             #0#32 = 0; |PINTA #0#32;
             #0#7 = 0; |PINTA #0#7;
         |FINSI;
     |FINSI;

     |HAZ EsGestral;
     |SI FSalida = 0;
         eaAlfa = #0#52;
         |HAZ GestrDefFP;
         |SI eaAlfa ! ""; #0#8 = eaAlfa; |PINTA #0#8; |FINSI;
         |SI eaQuitaDto = "S";
             #0#5 = 0; |PINTA #0#5;
             #0#32 = 0; |PINTA #0#32;
             #0#7 = 0; |PINTA #0#7;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO EsPropuesta;
     #referen@#0 = #3#29;
     #referen@#1 = #3#0;
     #referen@#2 = #3#1;
     |LEE 000#referen@.=;
     |SI FSalida = 0; |Y #referen@#3 ! 0;
          aVienePropu = "S";
     |FINSI;
|FPRC;

|PROCESO VienePropu;
     |DDEF aAlfa;
     aAlfa = aAlfa + "fries024";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          aVienePropu = "N";
          |ABRE #referen@;
          |BUCLELIN 2EsPropuesta#0;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|PROCESO DefePromo10;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo ! 1; |ACABA; |FINSI;
     |SI #42#129 ! "S"; |ACABA; |FINSI;

     |HAZ EsAparecida;
     |SI FSalida = 0;
          |ABRE #4;
          #4#0 = #0#3;
          |LEE 000#4=;
          |CIERRA #4;
          |ABRE #211;
          |LEE 000#211p;
          |PARA; |SI FSalida = 0; |HACIENDO;
               |SI #211#25 = "GENERADA ";
                    |PARA i = 1; |SI i [ 24; |HACIENDO i = i + 1;
                         |SI #211i = #4#158;
                              #0#89 = #211#0; |PINTA #0#89;
                              |SAL;
                         |FINSI;
                    |SIGUE;
               |FINSI;
               |LEE 000#211s;
          |SIGUE;
          |CIERRA #211;
     |FINSI;
|FPRC;

|PROCESO Observa7; |TIPO 7;
     aAlfa = "0000Observacion 1";

     |HAZ EsInmMarro;
     |SI FSalida = 0;
          aAlfa = "0000Matricula           <F11> Consulta";
          |C_M #0#55, 1, "S";
     |FINSI;

     |HAZ EsJamaica;
     |SI FSalida = 0;
          eaCliente = #0#3;
          |SUB_EJECUTA_NP "cafe0026;EMPRSAT";
          |SI enError ! 0;
               aAlfa = "0000Codigo maquina reparada   <F11> Consulta";
               |C_M #0#55, 1, "S";
          |FINSI;
     |FINSI;

     |MENSA aAlfa;
|FPRC;

|PROCESO Observa0; |TIPO 0;
     |HAZ EsInmMarro;
     |SI FSalida = 0;
          |DDEF aAlfa;
          aAlfa = aAlfa + "inmu0001";
          |CARGA_DEF aAlfa, referen@;
          |SI FSalida = 0;
               |ABRE #referen@;
               #referen@#0 = #0#55;
               |LEE 000#referen@.=;
               |SI FSalida ! 0;
                    eaAlfa = #0#55;
                    |SUB_EJECUTA_NP "inmu0001;alta";
                    |SI enError ! 0; |ERROR; |FINSI;
               |FINSI;
               |CIERRA #referen@;
               |DESCARGA_DEF #referen@;
          |FINSI;
     |FINSI;
     |HAZ EsJamaica;
     |SI FSalida = 0;
          eaCliente = #0#3;
          eaAlfa = #0#55;
          |SUB_EJECUTA_NP "cafe0026;CHEQMAQ";
          |SI enError ! 0;
               |SI enError = 1;
                    |PUSHV 0501 2380;
                    |AVISO;
                    |COLOR 0, 0; |ATRI 0;
                    |BLANCO 0814 1466;
                    |COLOR 14, 0; |ATRI 0;
                    |D_CUADRO 0814, 1466;
                    |D_CUADRO 0915, 1365;
                    |PINTA 1120, "ERROR. El cliente no se corresponde";
                    |ATRI 0;
                    |PINTA 1350, "Pulse Av. Pag.";
                    |PARA; |SI; |HACIENDO;
                         |LEETECLA aAlfa;
                         aAlfa = aAlfa % -103;
                         |SI aAlfa = "815"; |SAL; |FINSI;
                         |AVISO;
                    |SIGUE;
                    |POPV;
                    |ERROR;
               |SINO;
                    || lo pongo en el tipo5
                    ||MENAV "0000Debe de dar de alta el Cliente/Máquina en la aplicación Control Depósitos...";
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Observa66; |TIPO 66;
     |HAZ EsInmMarro;
     |SI FSalida = 0;
          |DDEF aAlfa;
          aAlfa = aAlfa + "inmu0001";
          |CARGA_DEF aAlfa, referen@;
          |SI FSalida = 0;
               |ABRE #referen@;
               #referen@#0 = #0#55;
               |LEE 000#referen@.];
               |CONSULTA_CLAVE #1#referen@;
               |SI FSalida = 0;
                    #0#55 = #referen@#0; |PINTA #0#55;
               |SINO;
                    |ERROR;
               |FINSI;
               |CIERRA #referen@;
               |DESCARGA_DEF #referen@;
          |FINSI;
     |FINSI;
     |HAZ EsJamaica;
     |SI FSalida = 0;
          eaCliente = #0#3;
          eaAlfa = #0#55;
          |SUB_EJECUTA_NP "cafe0026;GRIDMAQ";
          |SI enError = 0
               #0#55 = eaAlfa; |PINTA #0#55;
          |SINO;
               |ERROR;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO CuentaUni;
     nUni = nUni + #3#5;
|FPRC;

|DEFBUCLE CuentaUni;
     #3#1;
     ;
     #0#52, #0#0, 001;
     #0#52, #0#0, 999;
     ;
     NULL, CuentaUni;
|FIN;

|PROCESO CoimaAlbAlta;
     |DDEF aPath;

     aAlfa = aPath + "coima025";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          #referen@#0 = #0#52;
          |LEE 000#referen@.=;
          salida = FSalida;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |SINO;
          |MENAV "0000Error al cargar 'coima025'";
     |FINSI;
     |SI salida = 0; |ACABA; |FINSI;

     aAlfa = aPath + "coima026";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          #referen@#0 = #0#88;
          |LEE 000#referen@.=;
          salida = FSalida;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |SINO;
          |MENAV "0000Error al cargar 'coima026'";
     |FINSI;
     |SI salida = 0; |ACABA; |FINSI;

     aAlfa = aPath + "coima013";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          nUni = 0;
          |BUCLE CuentaUni;
          |DDEFECTO #referen@;
          |ABRE #referen@;
          #referen@#0 = #0#52;
          #referen@#1 = #0#0;
          |SI nUni = 0;
               #referen@#3 = "S";
               #referen@#4 = "S";
          |FINSI;
          |GRABA 020#referen@.n;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |SINO;
          |MENAV "0000Error al cargar 'coima013'";
     |FINSI;
|FPRC;

|PROCESO CoimaAlbBaja;
     nSal = 0;
     |DDEF aAlfa;
     aAlfa = aAlfa + "coima013";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |DDEFECTO #referen@;
          |ABRE #referen@;
          #referen@#0 = #0#52;
          #referen@#1 = #0#0;
          |LEE 101#referen@.=;
          |SI FSalida = 0;
               |SI enModoCab10 = 3;
                    |SI #referen@#2 = "S"; |Y #referen@#3 = "S"
                         |CONFI "0000NEl albaran ha sido procesado en el almacén, seguro que quiere darlo de baja?";
                         |SI FSalida = 0;
                              |BORRA 020#referen@.a;
                         |SINO;
                              nSal = 1;
                         |FINSI;
                    |SINO;
                         |BORRA 020#referen@.a;
                    |FINSI;
               |SINO;
                    |SI #referen@#2 = "S"; |Y #referen@#3 = "S"
                         |CONFI "0000NEl albaran ha sido procesado por el almacén, desea que se vuelva a procesar?";
                         |SI FSalida = 0;
                              #referen@#2 = "N";
                              #referen@#3 = "N";
                              |GRABA 020#referen@.a;
                         |FINSI;
                    |FINSI;
               |FINSI;
          |FINSI;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |SINO;
          |MENAV "0000Error al cargar 'coima013'";
     |FINSI;
     FSalida = nSal;
|FPRC;

|PROCESO Ret_Aut;
     aAlfa = "aparm016;" + #0#52 + (("000000" + #0#0)% -106) + #0#3;
     |SUB_EJECUTA_NP aAlfa;
|FPRC;

|PROCESO Tipo010_80; |TIPO 80;
     |HAZ EsAparecida;
     nSwAparecida = FSalida;
     |SI nSwAparecida = 0;
          |CONTROL_SIMPLE 0, "BOTON, Ret-Aut", 1068, 1078, Ret_Aut;
          nBtnRet_Aut = FSalida;
     |FINSI;
     |HAZ EsChampiEmar;
     |SI FSalida = 0;
          |HAZ CreaTempo; eaTmpAV816 = Tempo;
     |FINSI;
     FSalida = "";
|FPRC;

|PROCESO Tipo010_90; |TIPO 90;
     |SI nBtnRet_Aut ! -1; |FIN_CONTROL_WINDOWS nBtnRet_Aut; |FINSI;
     |SI eaTmpAV816 ! ""; Tempo = eaTmpAV816; |HAZ BoraTempo; |FINSI;
|FPRC;

|PROCESO SumaFam;
     |SI #3#13 = aFam1; |O #3#13 = aFam2; |O #3#13 = aFam3; |O #3#13 = aFam4;
          nImpo = nImpo + #3#9;
     |FINSI;
     #otromas@#31 = #3#2;
     |LEE 000#otromas@.=;
     |SI FSalida = 0;
          |SI #otromas@#32 ! 0;
               nImpo = nImpo + #otromas@#32;
          |FINSI;
          |SI #otromas@#33 ! 0;
               nImpo = nImpo + (#otromas@#33 * #3#5);
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO ApareceHisto;
     |DDEF aPath;
     aAlfa = aPath + "aparm009";
     |CARGA_DEF aAlfa, otromas@;
     |SI FSalida ! 0;
          |MENAV "0000Error al cargar 'aparm009'";
          |ACABA;
     |FINSI;
     aAlfa = aPath + "aparm025";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida ! 0;
          |MENAV "0000Error al cargar 'aparm025'";
          |ACABA;
     |FINSI;
     |ABRE #referen@; |LEE 000#referen@.p; |CIERRA #referen@;
     aFam1 = #referen@#1;
     aFam2 = #referen@#2;
     aFam3 = #referen@#3;
     aFam4 = #referen@#4;
     |DESCARGA_DEF #referen@;

     aAlfa = aPath + "aparm016";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida ! 0;
          |MENAV "0000Error al cargar 'aparm016'";
          |ACABA;
     |FINSI;
     |DDEFECTO #referen@;
     |ABRE #referen@;
     #referen@#0 = #0#52;
     #referen@#1 = #0#0;
     |LEE 000#referen@.=;
     |SI FSalida = 0;
          aAlfa = aPath + "aparm021";
          |CARGA_DEF aAlfa, otroref@;
          |SI FSalida = 0;
               |ABRE #otroref@;
               |SI nForma = -1;
                    #otroref@#0 = #referen@#9;
                    #otroref@#1 = #0#52;
                    #otroref@#2 = #0#0;
                    |BORRA 000#otroref@.c;
               |SINO;
                    nImpo = 0;
                    |ABRE #otromas@;
                    |BUCLELIN 2 SumaFam #0;
                    |CIERRA #otromas@;
                    |DDEFECTO #otroref@;
                    #otroref@#0 = #referen@#9;
                    #otroref@#1 = #0#52;
                    #otroref@#2 = #0#0;
                    #otroref@#3 = #0#1;
                    #otroref@#4 = #0#3;
                    #otroref@#5 = #0#84;
                    #otroref@#6 = #0#4;
                    #otroref@#7 = #referen@#11;
                    #otroref@#8 = #referen@#12;
                    #otroref@#9 = #referen@#13;
                    #otroref@#10 = #referen@#14;
                    #otroref@#11 = #referen@#15;
                    #otroref@#12 = #referen@#6;
                    #otroref@#13 = nImpo;
                    |GRABA 020#otroref@.n;
               |FINSI;
               |CIERRA #otroref@;
               |DESCARGA_DEF #otroref@;
          |SINO;
               |MENAV "0000Error al cargar 'aparm021'";
          |FINSI;
     |FINSI;
     |CIERRA #referen@;
     |DESCARGA_DEF #referen@;
     |DESCARGA_DEF #otromas@;
|FPRC;

|PROCESO InforAlbaDto;
     |DDEF aPath;
     aAlfa = aPath + "ialbm001";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          #referen@#0 = #0#3;
          |LEE 000#referen@.=;
          |CIERRA #referen@;
          nDto = #referen@#1;
          |DESCARGA_DEF #referen@;
          aAlfa = aPath + "ialbm006";
          |CARGA_DEF aAlfa, referen@;
          |SI FSalida = 0;
               |ABRE #referen@; |LEE 000#referen@.p; |CIERRA #referen@;
               |SI #0#52 = #referen@#9; |O #0#52 = #referen@#10; |O #0#52 = #referen@#11;
                    #0#5 = nDto; |PINTA #0#5;
                    #0#32 = 0; |PINTA #0#32;
                    #0#7 = 0; |PINTA #0#7;
               |FINSI;
               |DESCARGA_DEF #referen@;
          |SINO;
               |MENAV "0000Error al cargar 'ialbm006'";
          |FINSI;
     |SINO;
          |MENAV "0000Error al cargar 'ialbm001'";
     |FINSI;
|FPRC;

|PROCESO PinInforAlba10;
     |C_V #0#11, 1, "N";
     |C_V #0#81, 1, "N";
     |DDEF aAlfa;
     aAlfa = aAlfa + "ialbm026";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |DDEFECTO #referen@;
          |ABRE #referen@;
          #referen@#0 = #0#52;
          #referen@#1 = #0#0;
          |LEE 000#referen@.=;
          |CIERRA #referen@;
          |ATRI I; |PINTA 1325, #referen@#2; |ATRI 0;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|PROCESO Portes10; |TIPO 0;
     |HAZ EsInforAlba;
     |SI FSalida = 0;
          aAlfa = "ialbm026;" + #0#52 + (("000000" + #0#0)%-106) + "ALTA";
          |SUB_EJECUTA_NP aAlfa;
          |HAZ PinInforAlba10;
     |FINSI;
|FPRC;

|PROCESO IVA010_66; |TIPO 66;
     enTiva = #0Campo;
     efFiva = #0#1;
     |HAZ ConsuIVA;
     |SI eaDiva = "";
          |ERROR;
     |SINO;
          #0Campo = enTiva; |PINTA #0Campo;
     |FINSI;
|FPRC;

|PROCESO IVA010_0; |TIPO 0;
     enTiva = #0Campo;
     efFiva = #0#1;
     |HAZ SacaIVA;
     |SI eaDiva = "";
          |MENAV "0000No existe tipo iva para esta fecha...";
          |ERROR; |ACABA;
     |SINO;
          |HAZ caltotal;
     |FINSI;
|FPRC;

|PROCESO DocWeb;
     |DDEF aAlfa;
     aAlfa = aAlfa + "coima038";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          #referen@#0 = "AV";
          #referen@#1 = #0#52;
          #referen@#2 = #0#0;
          |SI enModoCab10 = 3;
               |BORRA 000#referen@.c;
          |SINO;
               |LEE 101#referen@.=;
               |SI FSalida ! 0; |GRABA 020#referen@.b; |FINSI;
               #referen@#3 = #0#1;
               #referen@#4 = "N";
               |GRABA 020#referen@.a;
          |FINSI;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|PROCESO BajaInforpor;
     |DDEF aAlfa;
     aAlfa = aAlfa + "infom005";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          #referen@#0 = "A";
          #referen@#1 = #0#52;
          #referen@#2 = #0#0;
          |BORRA 000#referen@.c;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;

     |DDEF aAlfa;
     aAlfa = aAlfa + "infom006";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          #referen@#0 = "A";
          #referen@#1 = #0#52;
          #referen@#2 = #0#0;
          |GRABA 000#referen@.n;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|PROCESO PinQDClor10;
     |DDEF aAlfa;
     aAlfa = aAlfa + "qdclor07";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |DDEFECTO #referen@;
          |ABRE #referen@;
          #referen@#0 = #0#52;
          #referen@#1 = #0#0;
          |LEE 000#referen@.=;
          |CIERRA #referen@;
          |PINTA 903, "Matricula:";
          |PINTA 1002, "ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ";
          |ATRI I; |PINTA 914, #referen@#2; |ATRI 0;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|PROCESO ExtintorBajaAlb;
     |DDEF aAlfa;
     aAlfa = aAlfa + "extm0013";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          |SELECT #4#referen@;
          #referen@#14 = #0#52;
          #referen@#15 = #0#0;
          |LEE 101#referen@.=;
          |SI FSalida = 0;
               #referen@#9 = "A";
               |GRABA 020#referen@.a;
          |FINSI;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|PROCESO CtrlRiesgoTaglo;
     |SI enErrRie ! 0;
          |HAZ EsTagloma;
          |SI FSalida = 0;
               |DDEF aAlfa; aAlfa = aAlfa + "tagm0059";
               |CARGA_DEF aAlfa, referen@;
               |SI FSalida = 0;
                    |ABRE #referen@;
                    #referen@#0 = #0#52;
                    |LEE 000#referen@.=;
                    |SI FSalida = 0;
                         |CONFI "0000N¿El pago se realizará en efectivo?";
                         |SI FSalida = 0; enErrRie = 0; |FINSI;
                    |FINSI;
                    |CIERRA #referen@;
                    |DESCARGA_DEF #referen@;
               |FINSI;

               |SI enErrRie = 0; |ACABA; |FINSI;

               |DDEF aAlfa; aAlfa = aAlfa + "tagm0098";
               |CARGA_DEF aAlfa, referen@;
               |SI FSalida = 0;
                    |ABRE #referen@;
                    #referen@#0 = #0#52;
                    |LEE 000#referen@.=;
                    |SI FSalida = 0;
                          |PUSHV 1210 1670;
                          |BLANCO 1210 1670;
                          |COLOR 7,2; |ATRI 0; |BLANCO 1311 1569; |ATRI 0;
                          |COLOR 15,2; |ATRI 0;
                          aAlfa = "          ALTA SOLO PERMITIDA PARA DEVOLUCIONES";
                          |PINTA 1412, aAlfa;
                          |ATRI 0;
                          |PAUSA;
                          |POPV;
                          enErrRie = 0;
                          enSoloPositivo = 1;
                    |FINSI;
                    |CIERRA #referen@;
                    |DESCARGA_DEF #referen@;
               |FINSI;

          |FINSI;
     |FINSI;
|FPRC;

|PROCESO NifTaglo010;
     aAlfa = #0#63; |QBF aAlfa;
     |SI aAlfa = "."; |ACABA; |FINSI;

     enError = 0;
     |DBASS aAlfa;
     aAlfa = aAlfa + "basica/def/agim0003";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          #referen@#0 = #0#63;
          |LEE 000#referen@.=;
          |SI FSalida ! 0;
               eaVarDni = #0#63;
               |ABRE #4;
               #4#0 = #0#4;
               |LEE 000#4=;
               |CIERRA #4;
               eaNonDni = #0#4;
               eaDomiDni = #0#30;
               eaCPDni = #0#62;
               eaPobDni = #0#31;
               eaPrvDni = #0#33;
               eaTlfDni = #4#17;
               eaFacDni = #4#18;
               eaPaisDni = #4#205;
               |SUB_EJECUTA_NP ":basica/tagm0001";
          |FINSI;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
     |SI enError ! 0; |ERROR; |FINSI;
|FPRC;

|PROCESO JamaicaBaja;
     |DDEF aAlfa;
     aAlfa = aAlfa + "cafe0027";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          #referen@#0 = #0#52;
          #referen@#1 = #0#0;
          |BORRA 000#referen@.c;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|PROCESO Repre010; |TIPO 0;
     |SI FSalida ! 2;
          |HAZ EsOrts;
          |SI FSalida = 0;
               enModo = (FEntrada / 100) ! 0;
               eaTipo = "A";
               eaCliente = #0#3;
               eaSerie = #0#52;
               enCodigo = #0#0;
               |SUB_EJECUTA_NP "ortsm021";
               |HAZ OrtsPin010;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO OrtsPin010;
     |DDEF aAlfa;
     aAlfa = aAlfa + "ortsm021";
     |CARGA_DEF aAlfa, otroref@;
     |SI FSalida = 0;
          |ABRE #otroref@;
          #otroref@#0 = "A";
          #otroref@#1 = #0#52;
          #otroref@#2 = #0#0;
          |LEE 000#otroref@.=;
          |SI FSalida ! 0; |DDEFECTO #otroref@; |FINSI;
          |ATRI I;
          |PINTA 845, #otroref@#4;
          |ATRI 0;
          |DESCARGA_DEF #otroref@;
     |FINSI;
|FPRC;

|PROCESO CoimaMailAlb;
     aIP = ""; |IP_REMOTO aIP;
     |SI aIP = "";
          |DFICE aAlfa;
          aDjunto = aAlfa + #0#52 + "_" + (("000000" + #0#0)%-106)+ ".pdf";
          |QBT aDjunto;
          eaImpresora = "CrystalReport;" + aDjunto;
          ser_alb = #0#52;
          num_alb = #0#0;
          abono = #0#43;
          eaMenuImpre = "N";
          |SUB_EJECUTA_NP "agifa014";
     |SINO;
          |DFICE aAlfa;
          aDjunto = aAlfa + #0#52 + "_" + (("000000" + #0#0)%-106)+ ".pdf";
          |QBT aDjunto;
          |ESPECIFICA "RBASS", aBaseLocal;
          aAlfa = aBaseLocal1 + #0#52 + "_" + (("000000" + #0#0)%-106)+ ".pdf";
          |QBT aAlfa;
          eaImpresora = "CrystalReport;" + aAlfa;
          ser_alb = #0#52;
          num_alb = #0#0;
          abono = #0#43;
          eaMenuImpre = "N";
          |SUB_EJECUTA_NP "agifa014";
          |RECIBE_FICHERO aAlfa, aDjunto;
          |RFBORRA aAlfa;
     |FINSI;
     eaMenuImpre = "";
     eaImpresora = "";

     aIP = "";
     |SI #refere1@#8 = "L";
          |IP_REMOTO aIP;
     |SINO;
          |SI #refere1@#8 = "S";
               |IP_LOCAL aIP;
          |SINO;
               aIP = #refere1@#7; |QBF aIP;
          |FINSI;
     |FINSI;
     aServidor = #refere1@#14; |QBF aServidor;
     aFrom = #refere1@#15; |QBF aFrom;
     aTo = aEmail;
     aSubject = "MERCANCIA ENVIADA POR AGENCIA";
     aMensaje = "LE ADJUNTAMOS PDF CON ALBARAN DE LA MERCANCÍA ENVIADA HOY POR LA AGENCIA DE TRANSPORTES.";
     aMensaje = aMensaje + &13 + "RECIBA UN CORDIAL SALUDO.";
     aMensaje = aMensaje + &13 + "COIMASA.";
     |XABRE "E", aDjunto, 0;
     |SI FSalida ] 0;
          |SI aTo ! "";
               |DSCORREO_ENVIA aIP, aServidor, aFrom, aTo, aSubject, aMensaje, aDjunto;
          |FINSI;
          |FBORRA aDjunto;
     |FINSI;
|FPRC;

|PROCESO CoimaEnviaMailAlb;
     |SI #0#84 = 1;
          |ABRE #4;
          #4#0 = #0#3;
          |LEE 020#4=;
          |CIERRA #4;
          aEmail = #4#214; |QBF aEmail;
          |SI aEmail = "";
               aEmail = #4#197; |QBF aEmail;
          |FINSI;
     |SINO;
          |ABRE #39;
          #39#0 = #0#3;
          #39#1 = #0#84;
          |LEE 020#39=;
          |CIERRA #39;
          aEmail = #39#24; |QBF aEmail;
     |FINSI;
     |SI aEmail = ""; |ACABA; |FINSI;

     |DDEF aAlfa;
     aAlfa = aAlfa + "coima001";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          |LEE 000#referen@.p;
          |CIERRA #referen@;

          nSwHazEnvio = 0;
          aEnvioAuto = #referen@#35;
          aParamEnvioAuto = #referen@#35;

          |SI aEnvioAuto = "S";
               |SI nModo = 2;
                    |SI nTBultos = 0; |Y #0#2 = 0; aEnvioAuto = "N"; |FINSI;
                    |SI nTBultos ! 0; aEnvioAuto = "N"; |FINSI;
               |FINSI;
               |SI nModo = 1; |Y #0#2 = 0; aEnvioAuto = "N"; |FINSI;
          |FINSI;

          |DDEF aAlfa;
          aAlfa = aAlfa + "coima025";
          |CARGA_DEF aAlfa, refere1@;
          |SI FSalida = 0;
               |ABRE #refere1@;
               #refere1@#0 = #0#52;
               |LEE 000#refere1@.=;
               |SI FSalida = 0;
                    aEnvioAuto = "N";
               |FINSI;
               |CIERRA #refere1@;
               |DESCARGA_DEF #refere1@;
          |SINO;
               |MENAV "0000Error al cargar 'coima025'...";
          |FINSI;

          aAlfa = #0#83; |QBF aAlfa;
          |SI aEnvioAuto = "S"; |Y aAlfa = "";
               aEnvioAuto = "N";
          |FINSI;

          |SI aEnvioAuto = "N";
               |CONFI "2400NEnviar este pedido por mail? ";
               |SI FSalida = 0; nSwHazEnvio = 1; |FINSI;
          |SINO;
               nSwHazEnvio = 1;
          |FINSI;

          |SI nSwHazEnvio = 1;
               |DDEF aAlfa;
               aAlfa = aAlfa + "coima022";
               |CARGA_DEF aAlfa, refere1@;
               |SI FSalida = 0;
                    |ABRE #refere1@;
                    |LEE 000#refere1@.p;
                    |SI FSalida = 0;
                         |HAZ CoimaMailAlb;
                    |FINSI;
                    |CIERRA #refere1@;
                    |DESCARGA_DEF #refere1@;
               |SINO;
                    |MENAV "0000Error al cargar 'coima022'...";
               |FINSI;
          |FINSI;
          |DESCARGA_DEF #referen@;
     |SINO;
          |MENAV "0000Error al cargar 'coima001'...";
     |FINSI;
|FPRC;

|PROCESO VallcorbaMailAlbT;
     |DFICE aAlfa;
     aDjunto = aAlfa + #0#52 + "_" + (("000000" + #0#0)%-106)+ ".txt";
     |QBT aDjunto;
     eaFicImpre = aDjunto;
     ser_alb = #0#52;
     num_alb = #0#0;
     abono = #0#43;
     eaMenuImpre = "N";
     |SUB_EJECUTA_NP "agifa014";

     aMensaje = "Le adjuntamos  TXT con Albarán:" +  #0#52 + "/" + (("000000" + #0#0)%-106);
     |HAZ VallcorbaMailAlb;
|FPRC;

|PROCESO VallcorbaMailAlbP;
     aIP = ""; |IP_REMOTO aIP;
     |SI aIP = "";
          |DFICE aAlfa;
          aDjunto = aAlfa + #0#52 + "_" + (("000000" + #0#0)%-106)+ ".pdf";
          |QBT aDjunto;
          eaImpresora = "CrystalReport;" + aDjunto;
          ser_alb = #0#52;
          num_alb = #0#0;
          abono = #0#43;
          eaMenuImpre = "N";
          |SUB_EJECUTA_NP "agifa014";
     |SINO;
          |DFICE aAlfa;
          aDjunto = aAlfa + #0#52 + "_" + (("000000" + #0#0)%-106)+ ".pdf";
          |QBT aDjunto;
          |ESPECIFICA "RBASS", aBaseLocal;
          aAlfa = aBaseLocal1 + #0#52 + "_" + (("000000" + #0#0)%-106)+ ".pdf";
          |QBT aAlfa;
          eaImpresora = "CrystalReport;" + aAlfa;
          ser_alb = #0#52;
          num_alb = #0#0;
          abono = #0#43;
          eaMenuImpre = "N";
          |SUB_EJECUTA_NP "agifa014";
          |RECIBE_FICHERO aAlfa, aDjunto;
          |RFBORRA aAlfa;
     |FINSI;
     aMensaje = "Le adjuntamos  PDF con Albarán:" +  #0#52 + "/" + (("000000" + #0#0)%-106);
     |HAZ VallcorbaMailAlb;
|FPRC;

|PROCESO VallcorbaMailAlb;
     eaMenuImpre = "";
     eaImpresora = "";
     eaFicImpre = "";

     aIP = "";
     |SI #refere1@#2 = "L";
          |IP_REMOTO aIP;
     |SINO;
          |SI #refere1@#2 = "S";
               |IP_LOCAL aIP;
          |SINO;
               aIP = #refere1@#3; |QBF aIP;
          |FINSI;
     |FINSI;
     aServidor = #refere1@#4; |QBF aServidor;
     aFrom = #refere1@#5; |QBF aFrom;
     aSubject = "Albarán:" +  #0#52 + "/" + (("000000" + #0#0)%-106);

     |XABRE "E", aDjunto, 0;
     |SI FSalida ] 0;
          aTo = aEmail1;
          |SI aTo ! "";
               |DSCORREO_ENVIA aIP, aServidor, aFrom, aTo, aSubject, aMensaje, aDjunto;
               |SI FSalida ! 0;
                    |MENAV "0000Error al enviar email al cliente....";
               |FINSI;
          |FINSI;
          aTo = aEmail2;
          |SI aTo ! "";
               |DSCORREO_ENVIA aIP, aServidor, aFrom, aTo, aSubject, aMensaje, aDjunto;
               |SI FSalida ! 0;
                    |MENAV "0000Error al enviar email al representante...";
               |FINSI;
          |FINSI;
          |FBORRA aDjunto;
     |FINSI;
|FPRC;

|PROCESO VallcorbaMail;
     |DDEF aAlfa;
     aAlfa = aAlfa + "vallcm02";
     |CARGA_DEF aAlfa, refere1@;
     |SI FSalida = 0;
          |ABRE #refere1@;
          |LEE 000#refere1@.p;
          |SI FSalida = 0;
               |SI #refere1@#1 = "S"; |Y nModo = 1;
                    FSalida = 0;
               |SINO;
                    |CONFI "0000N¿Enviar albarán por mail?";
               |FINSI;
               |SI FSalida = 0;
                    aEmail1 = ""; aEmail2 = "";
                    |ABRE #4;
                    #4#0 = #0#3;
                    |LEE 020#4=;
                    |CIERRA #4;
                    |ABRE #39;
                    #39#0 = #0#3;
                    #39#1 = #0#84;
                    |LEE 020#39=;
                    |CIERRA #39;
                    |ABRE #25;
                    #25#0 = #0#6;
                    |LEE 000#25=;
                    |CIERRA #25;
                    |SI #0#84 = 1;
                         aEmail1 = #4#163; |QBF aEmail1;
                         |SI aEmail1 = ""; aEmail1 = #4#197; |QBF aEmail1; |FINSI;
                    |SINO;
                         aEmail1 = #39#24; |QBF aEmail1;
                         |SI aEmail1 = ""; aEmail1 = #4#163; |QBF aEmail1; |FINSI;
                         |SI aEmail1 = ""; aEmail1 = #4#197; |QBF aEmail1; |FINSI;
                    |FINSI;
                    aEmail2 = #25#64; |QBF aEmail2;
                    |SI aEmail2 = ""; aEmail2 = #25#62; |QBF aEmail2; |FINSI;
                    |SI aEmail1 ! ""; |O aEmail2 ! "";
                         |ABRE #44;
                         #44#26 = #0#52;
                         |LEE 000#44=;
                         |SI FSalida ! 0; |DDEFECTO #44; |FINSI;
                         |CIERRA #44;
                         |SI #0#43 = "N";
                              |SI #0#50 = "S";
                                   aAlfa = #44#3; |QBF aAlfa;
                              |SINO;
                                   aAlfa = #44#4; |QBF aAlfa;
                              |FINSI;
                         |SINO;
                              aAlfa = #44#5; |QBF aAlfa;
                         |FINSI;
                         aAlfa = aAlfa + ".rpt";
                         |DDEF aAlfaX;
                         aAlfaX = aAlfaX + aAlfa;
                         |XABRE "E", aAlfaX, 0;
                         |SI FSalida ] 0;
                              |HAZ VallcorbaMailAlbP; ||pdf
                         |SINO;
                              |HAZ VallcorbaMailAlbT; ||txt
                         |FINSI;
                    |FINSI;
               |FINSI;
          |SINO;
               |MENAV "0000Parámetros mail no configurado...";
          |FINSI;
          |CIERRA #refere1@;
          |DESCARGA_DEF #refere1@;
     |SINO;
          |MENAV "0000Error al cargar 'coima022'...";
     |FINSI;
|FPRC;

|PROCESO BultosGofre;
     |DDEF aAlfa;
     aAlfa = aAlfa + "gofrem04";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          #0#2 = 0;
          |ABRE #referen@;
          #referen@#0 = #0#52;
          #referen@#1 = #0#0;
          #referen@#2 = 1;
          |LEE 000#referen@.];
          |PARA; |SI FSalida = 0; |Y #referen@#0 = #0#52; |Y #referen@#1 = #0#0; |HACIENDO;
               #0#2 = #0#2 + #referen@#4;
               |LEE 000#referen@.s;
          |SIGUE;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
          |PINTA #0#2;
     |FINSI;
|FPRC;

|PROCESO PinFergalsan;
     |C_V #0#9, 1, "N";
     |DDEF aAlfa;
     aAlfa = aAlfa + "fergam15";
     |CARGA_DEF aAlfa, referen@
     |SI FSalida = 0;
          |ABRE #referen@;
          #referen@#0 = #0#52;
          #referen@#1 = #0#0;
          |LEE 000#referen@.=
          |SI FSalida ! 0; |DDEFECTO #referen@; |FINSI;
          |CIERRA #referen@;
          |PINTA #referen@#2;
          |PINTA #referen@#3;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|PROCESO CodAge10; |TIPO 0;
     |SI FSalida = 0;
          |HAZ EsFergalsan;
          |SI FSalida = 0;
               eaSer = #0#52;
               enDocu = #0#0;
               |SUB_EJECUTA_NP "fergam15";
               |HAZ PinFergalsan;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO FergalsanBaja;
     |DDEF aAlfa;
     aAlfa = aAlfa + "fergam15";
     |CARGA_DEF aAlfa, referen@
     |SI FSalida = 0;
          |ABRE #referen@;
          #referen@#0 = #0#52;
          #referen@#1 = #0#0;
          |LEE 000#referen@.=
          |SI FSalida = 0; |BORRA 020#referen@.a; |FINSI;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|PROCESO BtnItemDocAlb;
     aAlfa = "tagz0025;AV" + #0#52 + #0#0;
     |SUB_EJECUTA_NP aAlfa;
|FPRC;

|PROCESO BtnWorkFlowAlb;
     aAlfa = "tagz0025;WAV" + #0#52 + #0#0;
     |SUB_EJECUTA_NP aAlfa;
|FPRC;


|| En este cliente en algunas ocaciones no se graba la partida en el
|| historico, las regrabo aqui
|PROCESO GestralHisParti;
     |ABRE #3;
     |ABRE #65;
     #3#29 = #0#52;
     #3#0 = #0#0;
     #3#1 = 1;
     |LEE 000#3];
     |PARA; |SI FSalida = 0; |Y #3#29 = #0#52; |Y #3#0 = #0#0; |HACIENDO;
          #65#0 = #3#2;
          #65#1 = #0#1;
          |SI #0#43 = "S"; #65#2 = "BV"; |SINO; #65#2 = "AV"; |FINSI;
          #65#3 = #3#0;
          #65#4 = #3#1;
          #65#11 = #3#29;
          |LEE 121#65=;
          |SI FSalida = 0;
               #65#18 = #3#49;
               |GRABA 020#65a;
               |LIBERA #65;
          |FINSI;
          |LEE 000#3s;
     |SIGUE;
     |CIERRA #65;
     |CIERRA #3;
|FPRC;
