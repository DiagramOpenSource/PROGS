|FICHEROS;
     agiw0004 #0;
     agifa019 #1;
     agim0001 #2;
     agifa142 #142;
     agifa017 #17;
|FIN;

|VARIABLES;
     &eaArticuloAparecida = "";
     &eaClienteAparecida = "";
     &efFechaAparecida = @;
     nSwAparecida = 0;
     &enModo = 0;
     nCampo = 0;
     &eaProgEnv = "";
     &eaTipo = "";
     &enAlmacen = 0;
     aAlfa      = "";
     &enSinPanta= 0;
     &Envase    = "";
     &Unidades1 = 0;
     &Unidades2 = 0;
     &VArticulo = "";
     Valfa      = "";
     nUni       = 0;
     nMulti     = 0;
     &qUnid     = 0;
     &enErr     = 0;
     &qArti     = "";
     &qAbono    = "";
     nTecla = 0;
|FIN;

|PROCESO EnvaseUnidades;
     |SI #0#3  = "S";
         |SI #0#20 = #0#0;
             #0#16 = #0#2 * #0#22 * #0#19 * #0#15 * #0#12 * #0#9 * #0#6;
         |FINSI;

         |SI #0#17 = #0#0;
             #0#16 = #0#2 * #0#19 * #0#15 * #0#12 * #0#9 * #0#6;
         |FINSI;

         |SI #0#13 = #0#0;
             #0#16 = #0#2 * #0#15 * #0#12 * #0#9 * #0#6;
         |FINSI;

         |SI #0#10 = #0#0;
             #0#16 = #0#2 * #0#12 * #0#9 * #0#6;
         |FINSI;

         |SI #0#7 = #0#0;
             #0#16 = #0#2 * #0#9 * #0#6;
         |FINSI;

         |SI #0#4 = #0#0;
             #0#16 = #0#2 * #0#6;
         |FINSI;
     |SINO;
         |SI #0#20 = #0#0;
             #0#16 = #0#2 * #0#22;
         |FINSI;

         |SI #0#17 = #0#0;
             #0#16 = #0#2 * #0#19;
         |FINSI;

         |SI #0#13 = #0#0;
             #0#16 = #0#2 * #0#15;
         |FINSI;

         |SI #0#10 = #0#0;
             #0#16 = #0#2 * #0#12;
         |FINSI;

         |SI #0#7 = #0#0;
             #0#16 = #0#2 * #0#9;
         |FINSI;

         |SI #0#4 = #0#0;
             #0#16 = #0#2 * #0#6;
         |FINSI;
     |FINSI;
     |PINTA #0#16;
|FPRC;

|PROCESO MensaUni; |TIPO 7;
     aAlfa = "0000Unidades";
     |SI nSwAparecida = 0; |Y eaProgEnv = "albaran";
          aAlfa = "0000<F4>Saldo Art./Cliente";
     |FINSI;
     |MENSA aAlfa;
|FPRC;

|PROCESO Convierte; |TIPO 0;
     nTecla = FSalida;

     |SI nTecla = 12;
          |SI nSwAparecida = 0;
               ||...Ya estan cargados en el albaran
               ||eaArticuloAparecida
               ||eaClienteAparecida
               ||efFechaAparecida
               |HAZ CtrlStockDevolAparecida;
               |ERROR;
               |ACABA;
          |FINSI;
     |FINSI;

     |SI Campo = 2;      || Envases a Unidades
          |SI #0Campo = Contenido; |Y #142#139 = "N"; |Y enModo = 2;
               |ACABA; || sino se modifica no recalcula
          |FINSI;

          |HAZ EnvaseUnidades;

     |SINO;              || Unidades a Envases
          |SI #142#139 = "S";
               |SI #0#3  = "S";
                   |SI #0#20 = #0#0;
                       #0#2 = #0#16 / #0#22 / #0#19 / #0#15 / #0#12 / #0#9 / #0#6;
                   |FINSI;

                   |SI #0#17 = #0#0;
                       #0#2 = #0#16 / #0#19 / #0#15 / #0#12 / #0#9 / #0#6;
                   |FINSI;

                   |SI #0#13 = #0#0;
                       #0#2 = #0#16 / #0#15 / #0#12 / #0#9 / #0#6;
                   |FINSI;

                   |SI #0#10 = #0#0;
                       #0#2 = #0#16 / #0#12 / #0#9 / #0#6;
                   |FINSI;

                   |SI #0#7 = #0#0;
                       #0#2 = #0#16 / #0#9 / #0#6;
                   |FINSI;

                   |SI #0#4 = #0#0;
                       #0#2 = #0#16 / #0#6;
                   |FINSI;
               |SINO;
                   |SI #0#20 = #0#0;
                       #0#2 = #0#16 / #0#22;
                   |FINSI;

                   |SI #0#17 = #0#0;
                       #0#2 = #0#16 / #0#19;
                   |FINSI;

                   |SI #0#13 = #0#0;
                       #0#2 = #0#16 / #0#15;
                   |FINSI;

                   |SI #0#10 = #0#0;
                       #0#2 = #0#16 / #0#12;
                   |FINSI;

                   |SI #0#7 = #0#0;
                       #0#2 = #0#16 / #0#9;
                   |FINSI;

                   |SI #0#4 = #0#0;
                       #0#2 = #0#16 / #0#6;
                   |FINSI;
               |FINSI;

/* Segun Tiquet 3218/1777
               |SI #0#2 < 0;
                    nMulti = -1;
               |SINO;
                    nMulti = 1;
               |FINSI;
               #0#2 = #0#2 * nMulti;

               nUni = #0#2;
               #0#2 = #0#2 ! 0;
               |SI nUni > #0#2;
                    #0#2 = #0#2 + 1;
               |FINSI;

               #0#2 = #0#2 * nMulti;
               |PINTA #0#2;
*/
          |FINSI;
     |FINSI;

     |SI #0Campo ! Contenido;
          |HAZ Comprueba;
     |FINSI;
|FPRC;

|PROCESO Comprueba;
     ||------ Comprobacion Por Minimo.......
     |SI #0#16 [ 0; |ACABA; |O qAbono = "S"; |FINSI;
     qUnid  = #0#16;
     qArti  = #1#0;
     |HAZ ComproMin;
     |SI enErr = 1;
          |ERROR; |ACABA;
     |FINSI;

     nCampo = 5;
     |SI eaProgEnv = "prepedido"; nCampo = 35; |FINSI;
     |SI eaProgEnv = "pedido";    nCampo = 35; |FINSI;
     |SI eaProgEnv = "factura";   nCampo = 230; |FINSI;
     |SI eaProgEnv = "albaran";   nCampo = 5; |FINSI;
     |SI eaProgEnv = "proforma";  nCampo = 5; |FINSI;
     |SI eaProgEnv = "deposito";  nCampo = 5; |FINSI;

     |SI #142nCampo = "S"; |O #142nCampo = "X";
          |SI eaTipo = "V";
               |ABRE #17;
               #17#0 = VArticulo;
               #17#1 = enAlmacen;
               |LEE 000#17=;
               |CIERRA #17;
               |SI #17#39 < #0#16;
                    aAlfa = "0000Supera el Stock disponible: " + #17#39;
                    |MENAV aAlfa;
                    |SI #142nCampo = "X"; |Y eaProgEnv ! "proforma";
                         #0#2 = 0;
                         #0#16 = 0;
                         |ERROR;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Envase7; |TIPO 7;
     |SI #0#0 = "  ";
          #0#0 = #1#139;
          |PINTA #0#0;
     |FINSI;
|FPRC;

|PROCESO Envase; |TIPO 0;
     |SI #0#0 ! #0#4;  |Y #0#0 ! #0#7;  |Y #0#0 ! #0#10;  |Y #0#0 ! #0#13;
               |Y #0#0 ! #0#17; |Y #0#0 ! #0#20;
          |MENAV "     El envase no esta informado en el articulo.";
          |ERROR;
          |ACABA;
     |FINSI;

     |ABRE #2;
     #2#0 = #0#0;
     |LEE 040#2=;
     |SI FSalida ! 0;  |DDEFECTO #2;  |FINSI;
     |CIERRA #2;

     #0#1 = #2#1;  |PINTA #0#1;

     |SI #0Campo ! Contenido;
          |HAZ EnvaseUnidades;
          |HAZ Comprueba;
     |FINSI;
|FPRC;

|PROCESO PonEnvase;
     #2#0 = Valfa;
     |LEE 040#2=;
     |SI FSalida ! 0;  |DDEFECTO #2;  |FINSI;
|FPRC;

|PROCESO Tipo12; |TIPO 12;
     Envase    = #0#0;
     Unidades1 = #0#2;
     Unidades2 = #0#16;
|FPRC;

|PROGRAMA;
     |HAZ EsAparecida; nSwAparecida = FSalida;

     |ABRE #142; |LEE 000#142p; |CIERRA #142;

     |ABRE #1;
     #1#0 = VArticulo;
     |LEE 040#1=;
     |SI FSalida ! 0;  |DDEFECTO #1;  |FINSI;
     |CIERRA #1;

     |ABRE #2;
     Valfa = Envase; |HAZ PonEnvase; #0#0  = Envase; #0#1  = #2#1;
     #0#2  = Unidades1;
     #0#16 = Unidades2;
     #0#3  = #1#138;
     Valfa = #1#139; |HAZ PonEnvase; #0#4  = #1#139; #0#5  = #2#1; #0#6  = #1#140;
     Valfa = #1#141; |HAZ PonEnvase; #0#7  = #1#141; #0#8  = #2#1; #0#9  = #1#142;
     Valfa = #1#143; |HAZ PonEnvase; #0#10 = #1#143; #0#11 = #2#1; #0#12 = #1#144;
     Valfa = #1#145; |HAZ PonEnvase; #0#13 = #1#145; #0#14 = #2#1; #0#15 = #1#146;
     Valfa = #1#216; |HAZ PonEnvase; #0#17 = #1#216; #0#18 = #2#1; #0#19 = #1#217;
     Valfa = #1#218; |HAZ PonEnvase; #0#20 = #1#218; #0#21 = #2#1; #0#22 = #1#219;
     |CIERRA #2;

     |SI enSinPanta = 1;
          FSalida = 0;
          Campo = 16;
          |HAZ Convierte;
          |SI FSalida = 0; |HAZ Tipo12; |FINSI;
     |SINO;
          |BLANCO 0920 2255;
          |PINPA #0#0;
          |PINDA #0#0;
          |ENDATOS #1#0;
     |FINSI;
|FPRO;
