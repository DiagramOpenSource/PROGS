|FICHEROS;
     agifa019;
     agifa074;
     agifa090;
     agifa112;
     agifa120;
     dsm00052;

     coimy004;
     coima043;
     coima020;
     coima021;
     coima051;
     coima069;
     coima070;

     coimw021;
     coimw022;
     coimw023;
     coimw024;
     coimw025;
     coimw026;
|FIN;

|VARIABLES;
     i                   = 0;
     nPos                = 0;
     nLin                = 0;
     nTot                = 0;
     nLon                = 0;
     nMay                = 0;
     nCar                = 0;
     nDocCap             = 0;
     nNumDoc             = 0;
     nCntDoc             = 0;
     nCan                = 0;
     nDoc                = 0;
     nBor                = 0;
     nTBor               = 0;
     nEst                = 0;
     nTEst               = 0;
     nTEsp               = 0;
     nTPeg               = 0;

     aFoto               = "";
     aOri                = "";
     aDes                = "";
     aNom                = "";
     aLon                = "";
     aCar                = "";
     aCmp5               = "";
     aCmp6               = "";
     aCmp13              = "";
     aCmp21              = "";
     aLin                = "";
     aAlfa               = "";
     aBase               = "";
     aPathSer            = "";
     aPathPlu            = "";
     aPathPla            = "";
     aPathLoc            = "";
     aPathTra            = "";
     aPathFot            = "";
     aFicGuion           = "";
     aNome               = "";
     aArt                = "";
     aSer                = "";
     aPrv                = "";
     aTip                = "";
     aFic                = "";
     aAbre               = "";
     aImag               = "";
     aMadFam             = "";
     aHijFam             = "";
     aProc               = "";
     aCodPos             = "";
     aH20                = "";
     aH30                = "";
     aH60                = "";
     aH100               = "";

     &enModoExterno      = 1;
     &enHandleTxt        = 0;
     &eaUnidad           = "";
     &eaOrigen           = "";
     &eaDestino          = "";
     &eaParametro1       = "";
     &eaParametro2       = "";
     &eaParametro3       = "";
     &eaParametro4       = "";
     &eaParametro5       = "";
     &eaParametro6       = "";
     &eaAlfa             = "";
     &eaAsigna           = "";
     &eaImporte          = "";
     &eaSer              = "";
     &enOrd              = 0;
     &enDec              = 0;
|FIN;

|PROCESO PonPrimeMayus;
     eaAlfa = eaAlfa < "";
     aLon   = eaAlfa % 0;
     nLon   = aLon;
     nMay   = 0;
     aCmp13 = "";
     |PARA nCar = 1;  |SI nCar [ nLon;  |HACIENDO nCar = nCar + 1;
           nPos = (nCar * 100) + 1;
           aCar = eaAlfa % nPos;

           |SI nMay = 0;
               aCar = aCar > "";
               nMay = 1;
           |FINSI;

           |SI aCar = " "; |O aCar = "/"; |O aCar = "+";
            |O aCar = "-"; |O aCar = ".";
               nMay = 0;
           |FINSI;

           aCmp13 = aCmp13 + aCar;
     |SIGUE;
     eaAlfa = aCmp13;
|FPRC;

|PROCESO PonDesMat;
     aCmp13 = "";
     aCmp21 = "";
     aCmp6  = #coima051#3;
     aCmp6  = #agifa019#1;
     |QBF aCmp6;

     aAlfa = #coima051#7 - "#";
     |SI FSalida = 0;
         |ACABA;
     |FINSI;

     aAlfa  = #coima051#7;   |QBF aAlfa;
     aLon   = aAlfa % 0;
     nLon   = aLon;
     nMay   = 0;
     aCmp13 = "";
     aCmp21 = "";
     |PARA nCar = 1;  |SI nCar [ nLon;  |HACIENDO nCar = nCar + 1;
           nPos = (nCar * 100) + 1;
           aCar = aAlfa % nPos;

           |SI nMay = 0;
               |SI aCar ! "#";
                   |SI aCar ! " ";
                       aCmp21 = aCmp21 + aCar;
                   |SINO;
                       |SI aCmp21 ! "";
                           aCmp21 = aCmp21 + aCar;
                       |FINSI;
                   |FINSI;
               |FINSI;
           |FINSI;

           |SI nMay = 1;
               |SI aCar ! " ";
                   aCmp13 = aCmp13 + aCar;
               |SINO;
                   |SI aCmp13 ! "";
                       aCmp13 = aCmp13 + aCar;
                   |FINSI;
               |FINSI;
           |FINSI;

           |SI aCar = "#";
               nMay = 1;
           |FINSI;
     |SIGUE;
|FPRC;

|PROCESO GrabaCorte;
     #coimw021#0 = #agifa074#9;
     #coimw021#1 = #agifa074#0;
     #coimw021#2 = #agifa019#3;
     #coimw021#3 = #agifa074#2;
     #coimw021#4 = #coima051#2;
     #coimw021#5 = #coima051#1;
     |LEE 000#coimw021.=;
     |SI FSalida = 0;  |ACABA;  |FINSI;

     |HAZ PonDesMat;

     |DDEFECTO #coimw021;
     #coimw021#0  = #agifa074#9;
     #coimw021#1  = #agifa074#0;
     #coimw021#2  = #agifa019#3;
     #coimw021#3  = #agifa074#2;
     #coimw021#4  = #coima051#2;
     #coimw021#5  = #coima051#1;
     #coimw021#6  = #agifa120#1;
     #coimw021#7  = aCmp5;
     #coimw021#8  = aCmp6;
     #coimw021#9  = #coima051#25;
     #coimw021#10 = #coima051#26;
     #coimw021#11 = #dsm00052#4;
     #coimw021#20 = #dsm00052#4;

     |SI #coima051#25 ! 0;
         #coimw021#11 = #coima051#27 * #agifa074#4;
     |FINSI;

     |SI #coima051#25 ! 0;  |O  #coima051#26 ! 0;
         #coimw021#20 = #coima051#27 * #agifa074#4;
     |FINSI;

     #coimw021#12 = "";
     |SI #coima051#23 = 22;  #coimw021#12 = "*";  |FINSI;
     |SI #coima051#23 = 26;  #coimw021#12 = "*";  |FINSI;
     |SI #coima051#23 = 21;  #coimw021#12 = "&";  |FINSI;
     |SI #coima051#23 = 27;  #coimw021#12 = "&";  |FINSI;
     |SI #coima051#23 = 23;  #coimw021#12 = "$";  |FINSI;

     #coimw021#15 = "";
     |SI #coima051#23 = 21;  #coimw021#15 = "*";  |FINSI;
     |SI #coima051#23 = 26;  #coimw021#15 = "&";  |FINSI;

     #coimw021#13 = aCmp13;
     #coimw021#21 = aCmp21;

     |SI #coima051#23 = 21;  #coimw021#14 = "*";  |FINSI;

     |SI #coima051#23 = 21;  #coimw021#16 = 1;    |FINSI;
     |SI #coima051#23 = 27;  #coimw021#16 = 1;    |FINSI;

     |SI #coima051#23 = 23;  #coimw021#17 = 1;    |FINSI;

     |SI #coima051#23 = 11;  #coimw021#18 = 1;    |FINSI;
     |SI #coima051#23 = 12;  #coimw021#18 = 1;    |FINSI;
     |SI #coima051#23 = 21;  #coimw021#18 = 1;    |FINSI;
     |SI #coima051#23 = 22;  #coimw021#18 = 1;    |FINSI;
     |SI #coima051#23 = 26;  #coimw021#18 = 1;    |FINSI;

     |SI #coima051#23 = 25;  #coimw021#19 = 1;    |FINSI;

     eaAlfa   = #coimw021#8;  |QBF eaAlfa;
     eaAlfa   = eaAlfa + " " + #coimw021#13;  |QBF eaAlfa;
     #coimw021#22 = eaAlfa;
     #coimw021#23 = #coima051#30;

     |GRABA 020#coimw021.n;
     |LIBERA #coimw021;
|FPRC;

|PROCESO GrabaEstampacion;
     #coimw022#0 = #agifa074#9;
     #coimw022#1 = #agifa074#0;
     #coimw022#2 = #coima051#2;
     #coimw022#3 = aCmp13;
     #coimw022#4 = #coima051#25;
     #coimw022#5 = #coima051#26;
     |LEE 000#coimw022.=;
     |SI FSalida ! 0;
         |DDEFECTO #coimw022;
         #coimw022#0 = #agifa074#9;
         #coimw022#1 = #agifa074#0;
         #coimw022#2 = #coima051#2;
         #coimw022#3 = aCmp13;
         #coimw022#4 = #coima051#25;
         #coimw022#5 = #coima051#26;

         aAlfa = aCmp6;  |QBF aAlfa;
         aAlfa = aAlfa + " " + aCmp13;
         #coimw022#7 = aAlfa;

         |GRABA 020#coimw022.b;
     |FINSI;

     |SI #coima051#25 = 0;  |Y #coima051#26 = 0;
         nCan = #dsm00052#4;
     |SINO;
         nCan = #coima051#27 * #agifa074#04;
     |FINSI;

     #coimw022#6 = #coimw022#6 + nCan;

     |SI #coima051#23 = 21;  #coimw022#8 = "*";  |FINSI;
     |SI #coima051#23 = 23;  #coimw022#8 = "$";  |FINSI;

     |GRABA 020#coimw022.a;
     |LIBERA #coimw022;
|FPRC;

|PROCESO GrabaBordado;
     #coimw023#0 = #agifa074#9;
     #coimw023#1 = #agifa074#0;
     #coimw023#2 = #coima051#2;
     #coimw023#3 = aCmp13;
     #coimw023#4 = #coima051#25;
     #coimw023#5 = #coima051#26;
     |LEE 000#coimw023.=;
     |SI FSalida ! 0;
         |DDEFECTO #coimw023;
         #coimw023#0 = #agifa074#9;
         #coimw023#1 = #agifa074#0;
         #coimw023#2 = #coima051#2;
         #coimw023#3 = aCmp13;
         #coimw023#4 = #coima051#25;
         #coimw023#5 = #coima051#26;

         aAlfa = aCmp6;  |QBF aAlfa;
         aAlfa = aAlfa + " " + aCmp13;
         #coimw023#7 = aAlfa;

         |GRABA 020#coimw023.b;
     |FINSI;

     |SI #coima051#25 = 0;  |Y #coima051#26 = 0;
         nCan = #dsm00052#4;
     |SINO;
         nCan = #coima051#27 * #agifa074#04;
     |FINSI;

     #coimw023#6 = #coimw023#6 + nCan;

     |SI #coima051#23 = 26;  #coimw023#8 = "&";  |FINSI;
     |SI #coima051#23 = 21;  #coimw023#8 = "*";  |FINSI;

     |GRABA 020#coimw023.a;
     |LIBERA #coimw023;
|FPRC;

|PROCESO GrabaDespiece;
     aAlfa = aCmp21;  |QBF aAlfa;
     |SI aAlfa = "";
         aAlfa = "0-Sin Definir";
     |FINSI;

     |SI aAlfa = "COMPLEMENTOS";
         aAlfa = "zCOMPLEMENTOS";
     |FINSI;

     #coimw024#0 = #agifa074#9;
     #coimw024#1 = #agifa074#0;
     #coimw024#2 = #agifa074#2;
     #coimw024#3 = aAlfa;
     #coimw024#4 = #coima051#2;
     #coimw024#5 = #coima051#1;
     |LEE 000#coimw024.=;
     |SI FSalida = 0;  |ACABA;  |FINSI;

     |DDEFECTO #coimw024;
     #coimw024#0  = #agifa074#9;
     #coimw024#1  = #agifa074#0;
     #coimw024#2  = #agifa074#2;
     #coimw024#3  = aAlfa;
     #coimw024#4  = #dsm00052#3;
     #coimw024#5  = #coima051#1;
     #coimw024#6  = aCmp5;
     #coimw024#7  = aCmp6;
     #coimw024#9  = #coima051#25;
     #coimw024#10 = #coima051#26;
     #coimw024#11 = #dsm00052#4;

     |SI #coima051#25 ! 0;  |O  #coima051#26 ! 0;
         #coimw024#11 = #coima051#27 * #agifa074#4;

         |SI #coima051#27 ! 0;
             #coimw024#8 = (#coimw024#11 * #coima051#12) / #coima051#27;
         |SINO;
             #coimw024#8 = #coimw024#11 * #coima051#12;
         |FINSI;
     |FINSI;

     |SI #coima051#23 = 22;  #coimw024#12 = "*";  |FINSI;
     |SI #coima051#23 = 23;  #coimw024#12 = "*";  |FINSI;
     |SI #coima051#23 = 26;  #coimw024#12 = "*";  |FINSI;
     |SI #coima051#23 = 21;  #coimw024#12 = "&";  |FINSI;
     |SI #coima051#23 = 27;  #coimw024#12 = "&";  |FINSI;

     #coimw024#13 = #agifa074#4;
     #coimw024#14 = aCmp13;

     |GRABA 020#coimw024.n;
     |LIBERA #coimw024;
|FPRC;

|PROCESO GrabaMateria;
     #coimw025#0 = #agifa074#9;
     #coimw025#1 = #agifa074#0;
     #coimw025#2 = #dsm00052#3;
     |LEE 000#coimw025.=;
     |SI FSalida ! 0;
         |DDEFECTO #coimw025;
         #coimw025#0 = #agifa074#9;
         #coimw025#1 = #agifa074#0;
         #coimw025#2 = #dsm00052#3;
         #coimw025#3 = #agifa019#1;
         #coimw025#4 = #coima051#30;

         |GRABA 020#coimw025.b;
     |FINSI;

     #coimw025#5 = #coimw025#5 + #dsm00052#4;

     |GRABA 020#coimw025.a;
     |LIBERA #coimw025;
|FPRC;

|PROCESO dsm00052;
     |SI #dsm00052#12 = 0;
         |ACABA;
     |FINSI;

     |SELECT #1#coima051;
     #coima051#0 = #dsm00052#11;
     #coima051#1 = #dsm00052#12;
     |LEE 000#coima051.=;
     |SI FSalida ! 0;  |DDEFECTO #coima051;  |FINSI;

     |SI #coima051#2 ! #dsm00052#3;
         |SELECT #2#coima051;
         #coima051#2 = #dsm00052#3;
         #coima051#0 = #dsm00052#11;
         |LEE 000#coima051.=;
         |SI FSalida ! 0;
             |DDEFECTO #coima051;
             #coima051#0 = #dsm00052#11;
             #coima051#1 = #dsm00052#12;
             #coima051#2 = #dsm00052#3;
         |FINSI;
     |FINSI;

     |SELECT #1#coima051;
     #agifa019#0 = #coima051#2;
     |LEE 000#agifa019.=;
     |SI FSalida ! 0;  |DDEFECTO #agifa019;  |FINSI;

     #agifa120#0 = #agifa019#3;
     |LEE 000#agifa120.=;
     |SI FSalida ! 0;  |DDEFECTO #agifa120;  |FINSI;

     |HAZ GrabaCorte;

     |SI #coima051#23 = 25;
         nTPeg = 1;
     |FINSI;

     |SI #coima051#23 = 21;  |O #coima051#23 = 27;
         |HAZ GrabaEstampacion;

         nTEst = 1;
     |FINSI;

     |SI #coima051#23 = 21;  |O #coima051#23 = 22; |O #coima051#23 = 26;
      |O #coima051#23 = 11;  |O #coima051#23 = 12;
         |HAZ GrabaBordado;

         nTBor = 1;
     |FINSI;

     |SI #coima051#23 = 23;
         |HAZ GrabaEstampacion;

         nTEsp = 1;
     |FINSI;

     |HAZ GrabaDespiece;
     |HAZ GrabaMateria;
|FPRC;

|DEFBUCLE dsm00052;
     #dsm00052#1;
     11;
     #agifa074#9, #agifa074#0, #agifa074#1, 001, #agifa074#2;
     #agifa074#9, #agifa074#0, #agifa074#1, 999, #agifa074#2;
     ;
     NULL, dsm00052;
|FIN;

|PROCESO agifa074_Tmp;
     #coimw026#0 = #agifa074#9;
     #coimw026#1 = #agifa074#0;
     |LEE 000#coimw026.=;
     |SI FSalida ! 0;
         #coimw026#0 = #agifa074#9;
         #coimw026#1 = #agifa074#0;
         |GRABA 020#coimw026.n;
     |FINSI;

     aCmp5 = #agifa074#3;

     #coima043#0 = "ESP";
     #coima043#1 = #agifa074#2;
     |LEE 000#coima043.=;
     |SI FSalida = 0;
         aCmp5 = #coima043#4;
     |FINSI;

     |BUCLE dsm00052;
|FPRC;

|DEFBUCLE agifa074_Tmp;
     #agifa074#2;
     ;
     #coimy004#3, #coimy004#0, #coimy004#2, 001, "01.01.0000";
     #coimy004#4, #coimy004#1, #coimy004#2, 999, "31.12.2999";
     ;
     NULL, agifa074_Tmp;
|FIN;

|PROCESO CreaTempos;
     |BUCLE agifa074_Tmp;
|FPRC;

|PROCESO PonProv;
     eaAlfa   = aSer;  |QBF eaAlfa;
     eaAsigna = "V#COL#";
     |HAZ AsignaWord;

     |SI aProc = "";
         |ACABA;
     |FINSI;

     |DDEFECTO #agifa112;
     #coima070#0 = aSer;
     |LEE 000#coima070.=;
     |SI FSalida = 0;
         #agifa112#0 = #coima070#2;
         |LEE 000#agifa112.=;
         |SI FSalida ! 0;  |DDEFECTO #agifa112; |FINSI;
     |FINSI;

     eaAsigna = "V#PROCESO#";
     eaAlfa = aProc + #agifa112#1;  |QBF eaAlfa;
     |HAZ QuitaRaros;
     |HAZ AsignaWord;

     eaAsigna = "V#NOMPROV#";
     eaAlfa   = #agifa112#1;   |QBF eaAlfa;
     aAlfa    = #agifa112#23;  |QBF aAlfa;
     |SI aAlfa ! "";
         eaAlfa   = eaAlfa + " (" + aAlfa + ")";
     |FINSI;
     |HAZ QuitaRaros;
     |HAZ AsignaWord;

     eaAsigna = "V#DIRECCION#";
     eaAlfa   = #agifa112#3;  |QBF eaAlfa;
     |HAZ QuitaRaros;
     |HAZ AsignaWord;

     eaAsigna = "V#POBLACION#";
     aCodPos  = #agifa112#76;
     |SI #agifa112#74 = 0;  |Y #agifa112#75 = 0;
         aCodPos  = #agifa112#108;
     |FINSI;
     |QBF aCodPos;

     eaAlfa = aCodPos + " " + #agifa112#4;   |QBF eaAlfa;
     |HAZ QuitaRaros;
     |HAZ AsignaWord;
|FPRC;

|PROCESO agifa074_Cap1;
     aDes = #agifa074#3;

     #coima043#0 = "ESP";
     #coima043#1 = #agifa074#2;
     |LEE 000#coima043.=;
     |SI FSalida = 0;
         aDes = #coima043#4;
     |FINSI;

     nLin  = nLin + 1;

     eaAlfa   = "";
     eaAsigna = "T}3}1}1}+G";   |HAZ AsignaTabla;
     eaAsigna = "T}1}1}1}+P";   |HAZ AsignaTabla;

     eaAsigna = "T}1}" + nLin + "}1}";
     eaAlfa   = #agifa074#2#;
     |HAZ QuitaRaros;
     |HAZ AsignaTabla;

     eaAsigna = "T}1}" + nLin + "}2}";
     eaAlfa   = aDes;
     |HAZ QuitaRaros;
     |HAZ AsignaTabla;

     eaAsigna = "T}1}" + nLin + "}3}";
     eaAlfa   = #agifa074#2# % 103;
     |HAZ AsignaTabla;

     eaAsigna  = "T}1}" + nLin + "}4}";
     enDec     = 0;
     eaImporte = #agifa074#4;  |HAZ SeparaImporte;
     eaAlfa    = eaImporte;
     |HAZ AsignaTabla;

     nTot = nTot + #agifa074#4;
|FPRC;

|DEFBUCLE agifa074_Cap1;
     #agifa074#2;
     ;
     #coimy004#3, #coimw026#0, #coimw026#1, 001, "01.01.0000";
     #coimy004#4, #coimw026#0, #coimw026#1, 999, "31.12.2999";
     ;
     NULL, agifa074_Cap1;
|FIN;

|PROCESO coimw026_Doc1;
     nNumDoc = nNumDoc + 1;
     nCntDoc = nCntDoc + 1;

     aAlfa = ("000" + nCntDoc) % -103;
     |ATRI S;
     |PINTA 1005, "Documentos";
     |PINTA 1108, aAlfa;
     |ATRI 0;

     |PULSATECLA;

     aFic = "doc" + (("00000" + nNumDoc) % -105);

     aFicGuion = aPathTra + aFic + ".txt";
     |XABRE "WC", aFicGuion, enHandleTxt;
     |SI FSalida < 0;
         aAlfa = "0000Problemas en crear el guion " + aFic;
         |MENAV aAlfa;
         |ACABA;
     |FINSI;

     aLin = "[FICHERO]#" + aPathLoc + "my004001.xml#" + aPathTra + aFic + ".xml";
     |XGRABA enHandleTxt, aLin;

     aSer  = #coimw026#0;
     aProc = "SEPARAR PARA ";
     |HAZ PonProv;

     nLin = 1;
     nTot = 0;
     |BUCLE agifa074_Cap1;

     eaAlfa   = "";
     eaAsigna = "T}3}2}1}+G";   |HAZ AsignaTabla;
     eaAsigna = "T}1}1}1}+P";   |HAZ AsignaTabla;

     nLin  = nLin + 1;

     eaAsigna  = "T}1}" + nLin + "}4}";
     enDec     = 0;
     eaImporte = nTot;  |HAZ SeparaImporte;
     eaAlfa    = eaImporte;
     |HAZ AsignaTabla;

     eaAlfa      = "";
     eaAsigna    = "T}3}1}1}+B"; |HAZ AsignaTabla;

     aLin = "[LIMPIA FINAL]" + &13 + &10;
     |XGRABA enHandleTxt, aLin;

     |XCIERRA enHandleTxt;

     eaParametro1 = aPathLoc + "dsxml.exe";
     eaParametro2 = aFicGuion;
     eaParametro3 = aPathPlu;
     eaParametro4 = aPathLoc;
     eaParametro5 = aPathLoc;
     eaParametro6 = "0";

     |HAZ EjecutaDSXML;
|FPRC;

|DEFBUCLE coimw026_Doc1;
     #coimw026#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, coimw026_Doc1;
|FIN;

|PROCESO Documento1;
     |SI #coimy004#5 = "N";  |ACABA;  |FINSI;

     eaOrigen  = aPathPla + "my004001.xml";
     eaDestino = aPathLoc + "my004001.xml";
     |HAZ EnviaFicheroConMD5;

     nCntDoc = 0;
     |BUCLE coimw026_Doc1;
|FPRC;

|PROCESO CargaDoc2;
     nBor     = 0;
     nEst     = 0;
     nLin     = 2;
     nNumDoc  = nNumDoc + 1;
     nDocCap  = nDocCap + 1;
     nCntDoc  = nCntDoc + 1;

     aAlfa = ("000" + nCntDoc) % -103;
     |ATRI S;
     |PINTA 1005, "Documentos";
     |PINTA 1208, aAlfa;
     |ATRI 0;

     |PULSATECLA;

     aFic = "doc" + (("00000" + nNumDoc) % -105);

     aFicGuion = aPathTra + aFic + ".txt";
     |XABRE "WC", aFicGuion, enHandleTxt;
     |SI FSalida < 0;
         aAlfa = "0000Problemas en crear el guion " + aFic;
         |MENAV aAlfa;
         |ACABA;
     |FINSI;

     aLin = "[FICHERO]#" + aPathLoc + "my004002.xml#" + aPathTra + aFic + ".xml";
     |XGRABA enHandleTxt, aLin;

     eaAsigna = "T}1}1}1}";
     eaAlfa   = "Proveedor: " + #coimw021#2 + " " + #coimw021#6;  |QBF eaAlfa;
     eaAlfa   = eaAlfa + "     " + "CONFECCION: " + #coimw021#0;
     |HAZ AsignaTabla;

     aSer  = #coimw021#0;
     aProc = "SEPARAR PARA ";
     |HAZ PonProv;
|FPRC;

|PROCESO FinalDoc2;
     |SI aPrv = "";
         |ACABA;
     |FINSI;

     eaAlfa   = "";
     eaAsigna = "T}3}6}1}+G";   |HAZ AsignaTabla;
     eaAsigna = "T}1}1}1}+P";   |HAZ AsignaTabla;

     |SI nBor = 1;  |O nEst = 1;
         eaAsigna = "T}3}7}1}+G";   |HAZ AsignaTabla;
         eaAsigna = "T}1}1}1}+P";   |HAZ AsignaTabla;

         |SI nBor = 1;
             eaAlfa = "* Separar para bordar";
         |FINSI;

         |SI nEst = 1;
             eaAlfa = "& Separar para estampar";
         |FINSI;

         |SI nBor = 1;  |Y nEst = 1;
             eaAlfa = "* Separar para bordar / & Separar para estampar";
         |FINSI;

         nLin  = nLin + 2;
         eaAsigna  = "T}1}" + nLin + "}1}";
         |HAZ AsignaTabla;
     |FINSI;

     eaAlfa      = "";
     eaAsigna    = "T}3}1}1}+B"; |HAZ AsignaTabla;

     aLin = "[LIMPIA FINAL]" + &13 + &10;
     |XGRABA enHandleTxt, aLin;

     |XCIERRA enHandleTxt;

     eaParametro1 = aPathLoc + "dsxml.exe";
     eaParametro2 = aFicGuion;
     eaParametro3 = aPathPlu;
     eaParametro4 = aPathLoc;
     eaParametro5 = aPathLoc;
     eaParametro6 = "0";

     |HAZ EjecutaDSXML;
|FPRC;

|PROCESO coimw021_Doc2;
     |SI #coimw021#2 = "   ";
         |ACABA;
     |FINSI;

     |SI aSer ! #coimw021#0;  |O aPrv ! #coimw021#2;
         |HAZ FinalDoc2;
         |HAZ CargaDoc2;
     |FINSI;

     |SI aArt ! #coimw021#3;
         eaAlfa   = "";

         |SI nLin > 2;
             eaAsigna = "T}3}1}1}+G";   |HAZ AsignaTabla;
             eaAsigna = "T}1}1}1}+P";   |HAZ AsignaTabla;

             nLin = nLin + 1;
         |FINSI;

         eaAsigna = "T}3}2}1}+G";   |HAZ AsignaTabla;
         eaAsigna = "T}1}1}1}+P";   |HAZ AsignaTabla;

         nLin = nLin + 1;

         eaAsigna = "T}1}" + nLin + "}1}";
         eaAlfa   = "Art¡culo a confeccionar: " + #coimw021#3;  |QBF eaAlfa;
         eaAlfa   = eaAlfa + " " + #coimw021#7;   |QBF eaAlfa;
         eaAlfa   = eaAlfa + " / Set: " + (#coimw021#3 % 103);
         |HAZ QuitaRaros;
         |HAZ AsignaTabla;
     |FINSI;

     eaAlfa   = "";
     |SI #coimw021#12 = " ";
         eaAsigna = "T}3}3}1}+G";   |HAZ AsignaTabla;
         eaAsigna = "T}1}1}1}+P";   |HAZ AsignaTabla;
     |FINSI;

     |SI #coimw021#12 = "&";
         eaAsigna = "T}3}5}1}+G";   |HAZ AsignaTabla;
         eaAsigna = "T}1}1}1}+P";   |HAZ AsignaTabla;
         nEst     = 1;
     |FINSI;

     |SI #coimw021#12 = "*";
         eaAsigna = "T}3}4}1}+G";   |HAZ AsignaTabla;
         eaAsigna = "T}1}1}1}+P";   |HAZ AsignaTabla;
         nBor     = 1;
     |FINSI;

     nLin = nLin + 1;

     eaAsigna = "T}1}" + nLin + "}1}";
     eaAlfa   = #coimw021#12;
     |HAZ AsignaTabla;

     eaAsigna = "T}1}" + nLin + "}2}";
     eaAlfa   = #coimw021#4;  |QBF eaAlfa;
     |HAZ QuitaRaros;
     |HAZ AsignaTabla;

     eaAsigna = "T}1}" + nLin + "}3}";
     eaAlfa   = #coimw021#8;  |QBF eaAlfa;
     eaAlfa   = eaAlfa + " " + #coimw021#13;  |QBF eaAlfa;
     |HAZ PonPrimeMayus;
     |HAZ QuitaRaros;
     |HAZ AsignaTabla;

     eaAsigna  = "T}1}" + nLin + "}4}";
     eaAlfa    = #coimw021#23;
     |HAZ AsignaTabla;

     |SI #coimw021#9 ! 0;
         eaAsigna  = "T}1}" + nLin + "}5}";
         enDec     = 4;
         eaImporte = #coimw021#9;  |HAZ SeparaImporte;
         eaAlfa    = eaImporte;
         |HAZ AsignaTabla;

         eaAsigna = "T}1}" + nLin + "}6}";
         enDec     = 4;
         eaImporte = #coimw021#10; |HAZ SeparaImporte;
         eaAlfa    = eaImporte;
         |HAZ AsignaTabla;
     |FINSI;

     eaAsigna = "T}1}" + nLin + "}7}";
     enDec     = 2;
     eaImporte = #coimw021#11; |HAZ SeparaImporte;
     eaAlfa    = eaImporte;
     |HAZ AsignaTabla;

     aSer = #coimw021#0;
     aPrv = #coimw021#2;
     aArt = #coimw021#3;
|FPRC;

|DEFBUCLE coimw021_Doc2;
     #coimw021#2;
     ;
     INICIO;
     FINAL;
     ;
     NULL, coimw021_Doc2;
|FIN;

|PROCESO Documento2;
     |SI #coimy004#6 = "N";  |ACABA;  |FINSI;

     eaOrigen  = aPathPla + "my004002.xml";
     eaDestino = aPathLoc + "my004002.xml";
     |HAZ EnviaFicheroConMD5;

     nCntDoc = 0;
     nDocCap = 0;
     aPrv    = "";
     aSer    = "";
     aArt    = "";
     |BUCLE coimw021_Doc2;
     |SI nDocCap > 0;
         |HAZ FinalDoc2;
     |FINSI;
|FPRC;

|PROCESO coimw022_Doc3;
     |SI #coimw022#8 = "$";
         |ACABA;
     |FINSI;

     eaAlfa = "";
     |SI #coimw022#8 = " ";
         eaAsigna = "T}2}1}1}+G";   |HAZ AsignaTabla;
         eaAsigna = "T}1}1}1}+P";   |HAZ AsignaTabla;
     |SINO;
         eaAsigna = "T}2}2}1}+G";   |HAZ AsignaTabla;
         eaAsigna = "T}1}1}1}+P";   |HAZ AsignaTabla;
         nBor     = 1;
     |FINSI;

     nLin = nLin + 1;

     eaAsigna = "T}1}" + nLin + "}1}";
     eaAlfa   = #coimw022#8;
     |HAZ AsignaTabla;

     eaAsigna = "T}1}" + nLin + "}2}";
     eaAlfa   = #coimw022#2;
     |HAZ AsignaTabla;

     eaAsigna = "T}1}" + nLin + "}3}";
     eaAlfa   = #coimw022#7;  |QBF eaAlfa;
     |HAZ PonPrimeMayus;
     |HAZ QuitaRaros;
     |HAZ AsignaTabla;

     |SI #coimw022#4 ! 0;
         eaAsigna  = "T}1}" + nLin + "}4}";
         enDec     = 4;
         eaImporte = #coimw022#4;  |HAZ SeparaImporte;
         eaAlfa    = eaImporte;
         |HAZ AsignaTabla;
     |FINSI;

     |SI #coimw022#5 ! 0;
         eaAsigna = "T}1}" + nLin + "}5}";
         enDec     = 4;
         eaImporte = #coimw022#5;  |HAZ SeparaImporte;
         eaAlfa    = eaImporte;
         |HAZ AsignaTabla;
     |FINSI;

     eaAsigna = "T}1}" + nLin + "}6}";
     enDec     = 2;
     eaImporte = #coimw022#6;  |HAZ SeparaImporte;
     eaAlfa    = eaImporte;
     |HAZ AsignaTabla;
|FPRC;

|DEFBUCLE coimw022_Doc3;
     #coimw022#2;
     ;
     #coimw026#0, #coimw026#1,    "", 0.0000, 0.0000;
     #coimw026#0, #coimw026#1, aH100, 9.9999, 9.9999;
     ;
     NULL, coimw022_Doc3;
|FIN;

|PROCESO coimw026_Doc3;
     |DDEFECTO #coimw022;
     #coimw022#0 = #coimw026#0;
     #coimw022#1 = #coimw026#1;
     |LEE 000#coimw022.];
     |SI FSalida ! 0;  |O  #coimw022#0 ! #coimw026#0;
                       |O  #coimw022#1 ! #coimw026#1;
         |ACABA;
     |FINSI;

     nNumDoc = nNumDoc + 1;
     nCntDoc = nCntDoc + 1;

     aAlfa = ("000" + nCntDoc) % -103;
     |ATRI S;
     |PINTA 1005, "Documentos";
     |PINTA 1308, aAlfa;
     |ATRI 0;

     |PULSATECLA;

     aFic = "doc" + (("00000" + nNumDoc) % -105);

     aFicGuion = aPathTra + aFic + ".txt";
     |XABRE "WC", aFicGuion, enHandleTxt;
     |SI FSalida < 0;
         aAlfa = "0000Problemas en crear el guion " + aFic;
         |MENAV aAlfa;
     |FINSI;

     aLin = "[FICHERO]#" + aPathLoc + "my004003.xml#" + aPathTra + aFic + ".xml";
     |XGRABA enHandleTxt, aLin;

     aSer  = #coimw026#0;
     aProc = "";
     |HAZ PonProv;

     nBor = 0;
     nLin = 2;
     |BUCLE coimw022_Doc3;

     eaAlfa   = "";
     eaAsigna = "T}2}3}1}+G";   |HAZ AsignaTabla;
     eaAsigna = "T}1}1}1}+P";   |HAZ AsignaTabla;

     |SI nBor = 1;
         eaAsigna = "T}2}4}1}+G";   |HAZ AsignaTabla;
         eaAsigna = "T}1}1}1}+P";   |HAZ AsignaTabla;

         nLin  = nLin + 2;
         eaAlfa   = "* No precisa bordado directo a Estampar";
         eaAsigna = "T}1}" + nLin + "}1}";
         |HAZ AsignaTabla;
     |FINSI;

     eaAlfa   = "";
     eaAsigna = "T}2}1}1}+B"; |HAZ AsignaTabla;

     aLin = "[LIMPIA FINAL]" + &13 + &10;
     |XGRABA enHandleTxt, aLin;

     |XCIERRA enHandleTxt;

     eaParametro1 = aPathLoc + "dsxml.exe";
     eaParametro2 = aFicGuion;
     eaParametro3 = aPathPlu;
     eaParametro4 = aPathLoc;
     eaParametro5 = aPathLoc;
     eaParametro6 = "0";

     |HAZ EjecutaDSXML;
|FPRC;

|DEFBUCLE coimw026_Doc3;
     #coimw026#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, coimw026_Doc3;
|FIN;

|PROCESO Documento3;
     |SI #coimy004#7 = "N";  |ACABA;  |FINSI;

     eaOrigen  = aPathPla + "my004003.xml";
     eaDestino = aPathLoc + "my004003.xml";
     |HAZ EnviaFicheroConMD5;

     nCntDoc = 0;
     |BUCLE coimw026_Doc3;
|FPRC;

|PROCESO coimw021_Doc4;
     |SI aArt ! #coimw021#3;
         eaAlfa   = "";

         |SI nLin > 0;
             eaAsigna = "T}3}7}1}+G";   |HAZ AsignaTabla;
             eaAsigna = "T}1}1}1}+P";   |HAZ AsignaTabla;

             eaAsigna = "T}3}1}1}+G";   |HAZ AsignaTabla;
             eaAsigna = "T}1}1}1}+P";   |HAZ AsignaTabla;

             eaAsigna = "T}3}2}1}+G";   |HAZ AsignaTabla;
             eaAsigna = "T}1}1}1}+P";   |HAZ AsignaTabla;

             eaAsigna = "T}3}3}1}+G";   |HAZ AsignaTabla;
             eaAsigna = "T}1}1}1}+P";   |HAZ AsignaTabla;

             nLin = nLin + 2;
         |FINSI;

         nLin = nLin + 1;

         eaAsigna = "T}1}" + nLin + "}1}";
         eaAlfa   = "Art¡culo: " + #coimw021#3;  |QBF eaAlfa;
         eaAlfa   = eaAlfa + " " + #coimw021#7;   |QBF eaAlfa;
         |HAZ QuitaRaros;
         |HAZ AsignaTabla;

         nLin = nLin + 1;
     |FINSI;

     eaAlfa   = "";
     |SI #coimw021#14 = " ";
         eaAsigna = "T}3}5}1}+G";   |HAZ AsignaTabla;
         eaAsigna = "T}1}1}1}+P";   |HAZ AsignaTabla;
     |FINSI;

     |SI #coimw021#14 = "*";
         eaAsigna = "T}3}6}1}+G";   |HAZ AsignaTabla;
         eaAsigna = "T}1}1}1}+P";   |HAZ AsignaTabla;
         nEst     = 1;
     |FINSI;

     nLin = nLin + 1;

     eaAsigna = "T}1}" + nLin + "}1}";
     eaAlfa   = #coimw021#14;
     |HAZ AsignaTabla;

     eaAsigna = "T}1}" + nLin + "}2}";
     eaAlfa   = #coimw021#4;  |QBF eaAlfa;
     |HAZ QuitaRaros;
     |HAZ AsignaTabla;

     eaAsigna = "T}1}" + nLin + "}3}";
     eaAlfa   = #coimw021#8;  |QBF eaAlfa;
     eaAlfa   = eaAlfa + " " + #coimw021#13;  |QBF eaAlfa;
     |HAZ PonPrimeMayus;
     |HAZ QuitaRaros;
     |HAZ AsignaTabla;

     |SI #coimw021#9 ! 0;
         eaAsigna  = "T}1}" + nLin + "}4}";
         enDec     = 4;
         eaImporte = #coimw021#9;  |HAZ SeparaImporte;
         eaAlfa    = eaImporte;
         |HAZ AsignaTabla;
     |FINSI;

     |SI #coimw021#10 ! 0;
         eaAsigna = "T}1}" + nLin + "}5}";
         enDec     = 4;
         eaImporte = #coimw021#10;  |HAZ SeparaImporte;
         eaAlfa    = eaImporte;
         |HAZ AsignaTabla;
     |FINSI;

     eaAsigna = "T}1}" + nLin + "}6}";
     enDec     = 2;
     eaImporte = #coimw021#20;  |HAZ SeparaImporte;
     eaAlfa    = eaImporte;
     |HAZ AsignaTabla;

     aArt = #coimw021#3;
|FPRC;

|DEFBUCLE coimw021_Doc4;
     #coimw021#3;
     ;
     #coimw026#0, #coimw026#1, 1,   "",   "",   "";
     #coimw026#0, #coimw026#1, 1, aH20, aH20,  "z";
     ;
     NULL, coimw021_Doc4;
|FIN;

|PROCESO coimw026_Doc4;
     |DDEFECTO #coimw021;
     |SELECT #3#coimw021;
     #coimw021#0  = #coimw026#0;
     #coimw021#1  = #coimw026#1;
     #coimw021#16 = 1;
     |LEE 000#coimw021.];
     |SI FSalida ! 0;  |O  #coimw021#0  ! #coimw026#0;
                       |O  #coimw021#1  ! #coimw026#1;
                       |O  #coimw021#16 ! 1;
         |SELECT #1#coimw021;
         |ACABA;
     |FINSI;

     |SELECT #1#coimw021;
     nNumDoc = nNumDoc + 1;
     nCntDoc = nCntDoc + 1;

     aAlfa = ("000" + nCntDoc) % -103;
     |ATRI S;
     |PINTA 1005, "Documentos";
     |PINTA 1408, aAlfa;
     |ATRI 0;

     |PULSATECLA;

     aFic = "doc" + (("00000" + nNumDoc) % -105);

     aFicGuion = aPathTra + aFic + ".txt";
     |XABRE "WC", aFicGuion, enHandleTxt;
     |SI FSalida < 0;
         aAlfa = "0000Problemas en crear el guion " + aFic;
         |MENAV aAlfa;
     |FINSI;

     aLin = "[FICHERO]#" + aPathLoc + "my004004.xml#" + aPathTra + aFic + ".xml";
     |XGRABA enHandleTxt, aLin;

     aSer  = #coimw026#0;
     aProc = "SEPARAR PARA ";
     |HAZ PonProv;

     nBor = 0;
     nLin = 0;
     aArt = "";
     |BUCLE coimw021_Doc4;

     eaAlfa   = "";
     eaAsigna = "T}3}7}1}+G";   |HAZ AsignaTabla;
     eaAsigna = "T}1}1}1}+P";   |HAZ AsignaTabla;

     |SI nBor = 1;
         eaAsigna = "T}3}8}1}+G";   |HAZ AsignaTabla;
         eaAsigna = "T}1}1}1}+P";   |HAZ AsignaTabla;

         nLin  = nLin + 2;
         eaAlfa   = "* No precisa bordado directo a Estampar";
         eaAsigna = "T}1}" + nLin + "}1}";
         |HAZ AsignaTabla;
     |FINSI;

     eaAlfa   = "";
     eaAsigna = "T}3}1}1}+B"; |HAZ AsignaTabla;

     aLin = "[LIMPIA FINAL]" + &13 + &10;
     |XGRABA enHandleTxt, aLin;

     |XCIERRA enHandleTxt;

     eaParametro1 = aPathLoc + "dsxml.exe";
     eaParametro2 = aFicGuion;
     eaParametro3 = aPathPlu;
     eaParametro4 = aPathLoc;
     eaParametro5 = aPathLoc;
     eaParametro6 = "0";

     |HAZ EjecutaDSXML;
|FPRC;

|DEFBUCLE coimw026_Doc4;
     #coimw026#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, coimw026_Doc4;
|FIN;

|PROCESO Documento4;
     |SI #coimy004#8 = "N";  |ACABA;  |FINSI;

     eaOrigen  = aPathPla + "my004004.xml";
     eaDestino = aPathLoc + "my004004.xml";
     |HAZ EnviaFicheroConMD5;

     nCntDoc = 0;
     |BUCLE coimw026_Doc4;
|FPRC;

|PROCESO coimw022_Doc5;
     |SI #coimw022#8 ! "$";
         |ACABA;
     |FINSI;

     eaAsigna = "T}2}1}1}+G";   |HAZ AsignaTabla;
     eaAsigna = "T}1}1}1}+P";   |HAZ AsignaTabla;

     nLin = nLin + 1;

     eaAsigna = "T}1}" + nLin + "}2}";
     eaAlfa   = #coimw022#2;
     |HAZ AsignaTabla;

     eaAsigna = "T}1}" + nLin + "}3}";
     eaAlfa   = #coimw022#7;  |QBF eaAlfa;
     |HAZ PonPrimeMayus;
     |HAZ QuitaRaros;
     |HAZ AsignaTabla;

     |SI #coimw022#4 ! 0;
         eaAsigna  = "T}1}" + nLin + "}4}";
         enDec     = 4;
         eaImporte = #coimw022#4;  |HAZ SeparaImporte;
         eaAlfa    = eaImporte;
         |HAZ AsignaTabla;

         eaAsigna = "T}1}" + nLin + "}5}";
         enDec     = 4;
         eaImporte = #coimw022#5;  |HAZ SeparaImporte;
         eaAlfa    = eaImporte;
         |HAZ AsignaTabla;
     |FINSI;

     eaAsigna = "T}1}" + nLin + "}6}";
     enDec     = 2;
     eaImporte = #coimw022#6;  |HAZ SeparaImporte;
     eaAlfa    = eaImporte;
     |HAZ AsignaTabla;
|FPRC;

|DEFBUCLE coimw022_Doc5;
     #coimw022#2;
     ;
     #coimw026#0, #coimw026#1,    "", 0.0000, 0.0000;
     #coimw026#0, #coimw026#1, aH100, 9.9999, 9.9999;
     ;
     NULL, coimw022_Doc5;
|FIN;

|PROCESO coimw026_Doc5;
     |DDEFECTO #coimw022;
     #coimw022#0 = #coimw026#0;
     #coimw022#1 = #coimw026#1;
     |LEE 000#coimw022.];
     |SI FSalida ! 0;  |O  #coimw022#0 ! #coimw026#0;
                       |O  #coimw022#1 ! #coimw026#1;
         |ACABA;
     |FINSI;

     nNumDoc = nNumDoc + 1;
     nCntDoc = nCntDoc + 1;

     aAlfa = ("000" + nCntDoc) % -103;
     |ATRI S;
     |PINTA 1005, "Documentos";
     |PINTA 1508, aAlfa;
     |ATRI 0;

     |PULSATECLA;

     aFic = "doc" + (("00000" + nNumDoc) % -105);

     aFicGuion = aPathTra + aFic + ".txt";
     |XABRE "WC", aFicGuion, enHandleTxt;
     |SI FSalida < 0;
         aAlfa = "0000Problemas en crear el guion " + aFic;
         |MENAV aAlfa;
     |FINSI;

     aLin = "[FICHERO]#" + aPathLoc + "my004005.xml#" + aPathTra + aFic + ".xml";
     |XGRABA enHandleTxt, aLin;

     aSer  = #coimw026#0;
     aProc = "";
     |HAZ PonProv;

     nBor = 0;
     nLin = 2;
     |BUCLE coimw022_Doc5;

     eaAlfa   = "";
     eaAsigna = "T}2}3}1}+G";   |HAZ AsignaTabla;
     eaAsigna = "T}1}1}1}+P";   |HAZ AsignaTabla;

     eaAlfa   = "";
     eaAsigna = "T}2}1}1}+B"; |HAZ AsignaTabla;

     aLin = "[LIMPIA FINAL]" + &13 + &10;
     |XGRABA enHandleTxt, aLin;

     |XCIERRA enHandleTxt;

     eaParametro1 = aPathLoc + "dsxml.exe";
     eaParametro2 = aFicGuion;
     eaParametro3 = aPathPlu;
     eaParametro4 = aPathLoc;
     eaParametro5 = aPathLoc;
     eaParametro6 = "0";

     |HAZ EjecutaDSXML;
|FPRC;

|DEFBUCLE coimw026_Doc5;
     #coimw026#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, coimw026_Doc5;
|FIN;

|PROCESO Documento5;
     |SI #coimy004#9 = "N";  |ACABA;  |FINSI;

     eaOrigen  = aPathPla + "my004005.xml";
     eaDestino = aPathLoc + "my004005.xml";
     |HAZ EnviaFicheroConMD5;

     nCntDoc = 0;
     |BUCLE coimw026_Doc5;
|FPRC;

|PROCESO coimw023_Doc6;
     eaAlfa = "";
     |SI #coimw023#8 = " ";
         eaAsigna = "T}2}1}1}+G";   |HAZ AsignaTabla;
         eaAsigna = "T}1}1}1}+P";   |HAZ AsignaTabla;
     |FINSI;

     |SI #coimw023#8 = "&";
         eaAsigna = "T}2}2}1}+G";   |HAZ AsignaTabla;
         eaAsigna = "T}1}1}1}+P";   |HAZ AsignaTabla;
         nEst     = 1;
     |FINSI;

     |SI #coimw023#8 = "*";
         eaAsigna = "T}2}3}1}+G";   |HAZ AsignaTabla;
         eaAsigna = "T}1}1}1}+P";   |HAZ AsignaTabla;
         nBor     = 1;
     |FINSI;

     nLin = nLin + 1;

     eaAsigna = "T}1}" + nLin + "}1}";
     eaAlfa   = #coimw023#8;
     |HAZ AsignaTabla;

     eaAsigna = "T}1}" + nLin + "}2}";
     eaAlfa   = #coimw023#2;
     |HAZ AsignaTabla;

     eaAsigna = "T}1}" + nLin + "}3}";
     eaAlfa   = #coimw023#7;  |QBF eaAlfa;
     |HAZ PonPrimeMayus;
     |HAZ QuitaRaros;
     |HAZ AsignaTabla;

     |SI #coimw023#4 ! 0;
         eaAsigna  = "T}1}" + nLin + "}4}";
         enDec     = 4;
         eaImporte = #coimw023#4;  |HAZ SeparaImporte;
         eaAlfa    = eaImporte;
         |HAZ AsignaTabla;
     |FINSI;

     |SI #coimw023#5 ! 0;
         eaAsigna = "T}1}" + nLin + "}5}";
         enDec     = 4;
         eaImporte = #coimw023#5;  |HAZ SeparaImporte;
         eaAlfa    = eaImporte;
         |HAZ AsignaTabla;
     |FINSI;

     eaAsigna = "T}1}" + nLin + "}6}";
     enDec     = 2;
     eaImporte = #coimw023#6;  |HAZ SeparaImporte;
     eaAlfa    = eaImporte;
     |HAZ AsignaTabla;
|FPRC;

|DEFBUCLE coimw023_Doc6;
     #coimw023#2;
     ;
     #coimw026#0, #coimw026#1, 0.0000,   "",   "";
     #coimw026#0, #coimw026#1, 9.9999, aH60, aH30;
     ;
     NULL, coimw023_Doc6;
|FIN;

|PROCESO coimw026_Doc6;
     |DDEFECTO #coimw023;
     #coimw023#0 = #coimw026#0;
     #coimw023#1 = #coimw026#1;
     |LEE 000#coimw023.];
     |SI FSalida ! 0;  |O  #coimw023#0 ! #coimw026#0;
                       |O  #coimw023#1 ! #coimw026#1;
         |ACABA;
     |FINSI;

     nNumDoc = nNumDoc + 1;
     nCntDoc = nCntDoc + 1;

     aAlfa = ("000" + nCntDoc) % -103;
     |ATRI S;
     |PINTA 1005, "Documentos";
     |PINTA 1608, aAlfa;
     |ATRI 0;

     |PULSATECLA;

     aFic = "doc" + (("00000" + nNumDoc) % -105);

     aFicGuion = aPathTra + aFic + ".txt";
     |XABRE "WC", aFicGuion, enHandleTxt;
     |SI FSalida < 0;
         aAlfa = "0000Problemas en crear el guion " + aFic;
         |MENAV aAlfa;
     |FINSI;

     aLin = "[FICHERO]#" + aPathLoc + "my004006.xml#" + aPathTra + aFic + ".xml";
     |XGRABA enHandleTxt, aLin;

     aSer  = #coimw026#0;
     aProc = "";
     |HAZ PonProv;

     nEst = 0;
     nBor = 0;
     nLin = 2;
     |BUCLE coimw023_Doc6;

     eaAlfa   = "";
     eaAsigna = "T}2}4}1}+G";   |HAZ AsignaTabla;
     eaAsigna = "T}1}1}1}+P";   |HAZ AsignaTabla;

    |SI nEst = 1;  |O nBor = 1;
         eaAsigna = "T}2}5}1}+G";   |HAZ AsignaTabla;
         eaAsigna = "T}1}1}1}+P";   |HAZ AsignaTabla;

         nLin  = nLin + 2;

         eaAlfa = "";
         |SI nEst = 1;  |Y nBor = 1;
             eaAlfa   = "* Primero Requiere Estampaci¢n / & Sin corte";
         |SINO;
             |SI nBor = 1;
                 eaAlfa   = "* Primero Requiere Estampaci¢n";
             |FINSI;

             |SI nEst = 1;
                 eaAlfa   = "& Sin corte";
             |FINSI;
         |FINSI;

         eaAsigna = "T}1}" + nLin + "}1}";
         |HAZ QuitaRaros;
         |HAZ AsignaTabla;
     |FINSI;

     eaAlfa   = "";
     eaAsigna = "T}2}1}1}+B"; |HAZ AsignaTabla;

     aLin = "[LIMPIA FINAL]" + &13 + &10;
     |XGRABA enHandleTxt, aLin;

     |XCIERRA enHandleTxt;

     eaParametro1 = aPathLoc + "dsxml.exe";
     eaParametro2 = aFicGuion;
     eaParametro3 = aPathPlu;
     eaParametro4 = aPathLoc;
     eaParametro5 = aPathLoc;
     eaParametro6 = "0";

     |HAZ EjecutaDSXML;
|FPRC;

|DEFBUCLE coimw026_Doc6;
     #coimw026#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, coimw026_Doc6;
|FIN;

|PROCESO Documento6;
     |SI #coimy004#10 = "N";  |ACABA;  |FINSI;

     eaOrigen  = aPathPla + "my004006.xml";
     eaDestino = aPathLoc + "my004006.xml";
     |HAZ EnviaFicheroConMD5;

     nCntDoc = 0;
     |BUCLE coimw026_Doc6;
|FPRC;

|PROCESO coimw021_Doc7;
     |SI aArt ! #coimw021#3;
         eaAlfa   = "";

         eaAsigna = "T}3}1}1}+G";   |HAZ AsignaTabla;
         eaAsigna = "T}1}1}1}+P";   |HAZ AsignaTabla;

         nLin = nLin + 1;

         eaAsigna = "T}1}" + nLin + "}1}";
         eaAlfa   = "Art¡culo a confeccionar: " + #coimw021#3;  |QBF eaAlfa;
         eaAlfa   = eaAlfa + " " + #coimw021#7;   |QBF eaAlfa;
         eaAlfa   = eaAlfa + " / Set: " + (#coimw021#3 % 103);
         |HAZ QuitaRaros;
         |HAZ AsignaTabla;
     |FINSI;

     eaAlfa   = "";
     |SI #coimw021#15 = " ";
         eaAsigna = "T}3}2}1}+G";   |HAZ AsignaTabla;
         eaAsigna = "T}1}1}1}+P";   |HAZ AsignaTabla;
     |FINSI;

     |SI #coimw021#15 = "*";
         eaAsigna = "T}3}4}1}+G";   |HAZ AsignaTabla;
         eaAsigna = "T}1}1}1}+P";   |HAZ AsignaTabla;
         nBor     = 1;
     |FINSI;

     |SI #coimw021#15 = "&";
         eaAsigna = "T}3}3}1}+G";   |HAZ AsignaTabla;
         eaAsigna = "T}1}1}1}+P";   |HAZ AsignaTabla;
         nEst     = 1;
     |FINSI;

     nLin = nLin + 1;

     eaAsigna = "T}1}" + nLin + "}1}";
     eaAlfa   = #coimw021#15;
     |HAZ AsignaTabla;

     eaAsigna = "T}1}" + nLin + "}2}";
     eaAlfa   = #coimw021#4;  |QBF eaAlfa;
     |HAZ QuitaRaros;
     |HAZ AsignaTabla;

     eaAsigna = "T}1}" + nLin + "}3}";
     eaAlfa   = #coimw021#8;  |QBF eaAlfa;
     eaAlfa   = eaAlfa + " " + #coimw021#13;  |QBF eaAlfa;
     |HAZ PonPrimeMayus;
     |HAZ QuitaRaros;
     |HAZ AsignaTabla;

     |SI #coimw021#9 ! 0;
         eaAsigna  = "T}1}" + nLin + "}4}";
         enDec     = 4;
         eaImporte = #coimw021#9;  |HAZ SeparaImporte;
         eaAlfa    = eaImporte;
         |HAZ AsignaTabla;
     |FINSI;

     |SI #coimw021#10 ! 0;
         eaAsigna = "T}1}" + nLin + "}5}";
         enDec     = 4;
         eaImporte = #coimw021#10;  |HAZ SeparaImporte;
         eaAlfa    = eaImporte;
         |HAZ AsignaTabla;
     |FINSI;

     eaAsigna = "T}1}" + nLin + "}6}";
     enDec     = 0;
     eaImporte = #coimw021#20;  |HAZ SeparaImporte;
     eaAlfa    = eaImporte;
     |HAZ AsignaTabla;

     aArt = #coimw021#3;
|FPRC;

|DEFBUCLE coimw021_Doc7;
     #coimw021#4;
     ;
     #coimw026#0, #coimw026#1, 1,   "",   "",   "";
     #coimw026#0, #coimw026#1, 1, aH20, aH20, aH30;
     ;
     NULL, coimw021_Doc7;
|FIN;

|PROCESO coimw026_Doc7;
     |DDEFECTO #coimw021;
     |SELECT #4#coimw021;
     #coimw021#0  = #coimw026#0;
     #coimw021#1  = #coimw026#1;
     #coimw021#18 = 1;
     |LEE 000#coimw021.];
     |SI FSalida ! 0;  |O  #coimw021#0  ! #coimw026#0;
                       |O  #coimw021#1  ! #coimw026#1;
                       |O  #coimw021#18 ! 1;
         |SELECT #1#coimw021;
         |ACABA;
     |FINSI;

     |SELECT #1#coimw021;

     nNumDoc = nNumDoc + 1;
     nCntDoc = nCntDoc + 1;

     aAlfa = ("000" + nCntDoc) % -103;
     |ATRI S;
     |PINTA 1005, "Documentos";
     |PINTA 1708, aAlfa;
     |ATRI 0;

     |PULSATECLA;

     aFic = "doc" + (("00000" + nNumDoc) % -105);

     aFicGuion = aPathTra + aFic + ".txt";
     |XABRE "WC", aFicGuion, enHandleTxt;
     |SI FSalida < 0;
         aAlfa = "0000Problemas en crear el guion " + aFic;
         |MENAV aAlfa;
     |FINSI;

     aLin = "[FICHERO]#" + aPathLoc + "my004007.xml#" + aPathTra + aFic + ".xml";
     |XGRABA enHandleTxt, aLin;

     aSer  = #coimw026#0;
     aProc = "SEPARAR PARA ";
     |HAZ PonProv;

     nBor = 0;
     nLin = 2;
     aArt = "";
     |BUCLE coimw021_Doc7;

     eaAlfa   = "";
     eaAsigna = "T}3}5}1}+G";   |HAZ AsignaTabla;
     eaAsigna = "T}1}1}1}+P";   |HAZ AsignaTabla;

     |SI nEst = 1;  |O nBor = 1;
         nLin  = nLin + 1;
         eaAlfa = "";
         |SI nEst = 1;  |Y nBor = 1;
             eaAlfa   = "* Primero Requiere Estampaci¢n / & Sin corte";
         |SINO;
             |SI nBor = 1;
                 eaAlfa   = "* Primero Requiere Estampaci¢n";
             |FINSI;

             |SI nEst = 1;
                 eaAlfa   = "& Sin corte";
             |FINSI;
         |FINSI;
         eaAsigna = "T}1}" + nLin + "}1}";

         |HAZ QuitaRaros;
         |HAZ AsignaTabla;
     |FINSI;

     eaAlfa   = "";
     eaAsigna = "T}3}1}1}+B"; |HAZ AsignaTabla;

     aLin = "[LIMPIA FINAL]" + &13 + &10;
     |XGRABA enHandleTxt, aLin;

     |XCIERRA enHandleTxt;

     eaParametro1 = aPathLoc + "dsxml.exe";
     eaParametro2 = aFicGuion;
     eaParametro3 = aPathPlu;
     eaParametro4 = aPathLoc;
     eaParametro5 = aPathLoc;
     eaParametro6 = "0";

     |HAZ EjecutaDSXML;
|FPRC;

|DEFBUCLE coimw026_Doc7;
     #coimw026#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, coimw026_Doc7;
|FIN;

|PROCESO Documento7;
     |SI #coimy004#11 = "N";  |ACABA;  |FINSI;

     eaOrigen  = aPathPla + "my004007.xml";
     eaDestino = aPathLoc + "my004007.xml";
     |HAZ EnviaFicheroConMD5;

     nCntDoc = 0;
     |BUCLE coimw026_Doc7;
|FPRC;

|PROCESO coimw021_Doc8;
     |SI aArt ! #coimw021#3;  |O aCmp21 ! #coimw021#21;
         eaAlfa   = "";

         |SI nLin > 1;
             eaAsigna = "T}2}6}1}+G";   |HAZ AsignaTabla;
             eaAsigna = "T}1}1}1}+P";   |HAZ AsignaTabla;

             eaAsigna = "T}2}1}1}+G";   |HAZ AsignaTabla;
             eaAsigna = "T}1}1}1}+P";   |HAZ AsignaTabla;

             eaAsigna = "T}2}2}1}+G";   |HAZ AsignaTabla;
             eaAsigna = "T}1}1}1}+P";   |HAZ AsignaTabla;

             eaAsigna = "T}2}3}1}+G";   |HAZ AsignaTabla;
             eaAsigna = "T}1}1}1}+P";   |HAZ AsignaTabla;

             eaAsigna = "T}2}4}1}+G";   |HAZ AsignaTabla;
             eaAsigna = "T}1}1}1}+P";   |HAZ AsignaTabla;

             nLin = nLin + 1;
         |FINSI;

         eaAsigna = "T}1}" + nLin + "}1}";
         eaAlfa   = "Art¡culo: " + #coimw021#3;  |QBF eaAlfa;
         eaAlfa   = eaAlfa + " " + #coimw021#7;   |QBF eaAlfa;
         |HAZ QuitaRaros;
         |HAZ AsignaTabla;

         nLin = nLin + 3;
         eaAsigna = "T}1}" + nLin + "}1}";
         eaAlfa   = #coimw021#21;  |QBF eaAlfa;
         |HAZ QuitaRaros;
         |HAZ AsignaTabla;

         nLin = nLin + 1;
     |FINSI;

     eaAlfa   = "";
     eaAsigna = "T}2}5}1}+G";   |HAZ AsignaTabla;
     eaAsigna = "T}1}1}1}+P";   |HAZ AsignaTabla;

     nLin = nLin + 1;

     eaAsigna = "T}1}" + nLin + "}2}";
     eaAlfa   = #coimw021#4;  |QBF eaAlfa;
     |HAZ QuitaRaros;
     |HAZ AsignaTabla;

     eaAsigna = "T}1}" + nLin + "}3}";
     eaAlfa   = #coimw021#8;  |QBF eaAlfa;
     eaAlfa   = eaAlfa + " " + #coimw021#13;  |QBF eaAlfa;
     |HAZ PonPrimeMayus;
     |HAZ QuitaRaros;
     |HAZ AsignaTabla;

     |SI #coimw021#9 ! 0;
         eaAsigna  = "T}1}" + nLin + "}4}";
         enDec     = 4;
         eaImporte = #coimw021#9;  |HAZ SeparaImporte;
         eaAlfa    = eaImporte;
         |HAZ AsignaTabla;
     |FINSI;

     |SI #coimw021#10 ! 0;
         eaAsigna = "T}1}" + nLin + "}5}";
         enDec     = 4;
         eaImporte = #coimw021#10;  |HAZ SeparaImporte;
         eaAlfa    = eaImporte;
         |HAZ AsignaTabla;
     |FINSI;

     eaAsigna = "T}1}" + nLin + "}6}";
     enDec     = 2;
     eaImporte = #coimw021#20;  |HAZ SeparaImporte;
     eaAlfa    = eaImporte;
     |HAZ AsignaTabla;

     aArt   = #coimw021#3;
     aCmp21 = #coimw021#21;
|FPRC;

|DEFBUCLE coimw021_Doc8;
     #coimw021#5;
     ;
     #coimw026#0, #coimw026#1, 1,   "",   "",   "";
     #coimw026#0, #coimw026#1, 1, aH20, aH20, aH30;
     ;
     NULL, coimw021_Doc8;
|FIN;

|PROCESO coimw026_Doc8;
     |DDEFECTO #coimw021;
     |SELECT #5#coimw021;
     #coimw021#0  = #coimw026#0;
     #coimw021#1  = #coimw026#1;
     #coimw021#19 = 1;
     |LEE 000#coimw021.];
     |SI FSalida ! 0;  |O  #coimw021#0  ! #coimw026#0;
                       |O  #coimw021#1  ! #coimw026#1;
                       |O  #coimw021#19 ! 1;
         |SELECT #1#coimw021;
         |ACABA;
     |FINSI;

     |SELECT #1#coimw021;

     nNumDoc = nNumDoc + 1;
     nCntDoc = nCntDoc + 1;

     aAlfa = ("000" + nCntDoc) % -103;
     |ATRI S;
     |PINTA 1005, "Documentos";
     |PINTA 1808, aAlfa;
     |ATRI 0;

     |PULSATECLA;

     aFic = "doc" + (("00000" + nNumDoc) % -105);

     aFicGuion = aPathTra + aFic + ".txt";
     |XABRE "WC", aFicGuion, enHandleTxt;
     |SI FSalida < 0;
         aAlfa = "0000Problemas en crear el guion " + aFic;
         |MENAV aAlfa;
     |FINSI;

     aLin = "[FICHERO]#" + aPathLoc + "my004008.xml#" + aPathTra + aFic + ".xml";
     |XGRABA enHandleTxt, aLin;

     aSer  = #coimw026#0;
     aProc = "";
     |HAZ PonProv;

     nLin   = 1;
     aArt   = "";
     aCmp21 = "";
     |BUCLE coimw021_Doc8;

     eaAlfa   = "";
     eaAsigna = "T}2}6}1}+G";   |HAZ AsignaTabla;
     eaAsigna = "T}1}1}1}+P";   |HAZ AsignaTabla;

     eaAlfa   = "";
     eaAsigna = "T}2}1}1}+B"; |HAZ AsignaTabla;

     aLin = "[LIMPIA FINAL]" + &13 + &10;
     |XGRABA enHandleTxt, aLin;

     |XCIERRA enHandleTxt;

     eaParametro1 = aPathLoc + "dsxml.exe";
     eaParametro2 = aFicGuion;
     eaParametro3 = aPathPlu;
     eaParametro4 = aPathLoc;
     eaParametro5 = aPathLoc;
     eaParametro6 = "0";

     |HAZ EjecutaDSXML;
|FPRC;

|DEFBUCLE coimw026_Doc8;
     #coimw026#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, coimw026_Doc8;
|FIN;

|PROCESO Documento8;
     |SI #coimy004#12 = "N";  |ACABA;  |FINSI;

     eaOrigen  = aPathPla + "my004008.xml";
     eaDestino = aPathLoc + "my004008.xml";
     |HAZ EnviaFicheroConMD5;

     nCntDoc = 0;
     |BUCLE coimw026_Doc8;
|FPRC;

|PROCESO CargaDoc9;
     aTip     = "";
     nLin     = 1;
     nNumDoc  = nNumDoc + 1;
     nDocCap  = nDocCap + 1;
     nCntDoc  = nCntDoc + 1;

     aAlfa = ("000" + nCntDoc) % -103;
     |ATRI S;
     |PINTA 1005, "Documentos";
     |PINTA 1908, aAlfa;
     |ATRI 0;

     |PULSATECLA;

     aFic = "doc" + (("00000" + nNumDoc) % -105);

     aFicGuion = aPathTra + aFic + ".txt";
     |XABRE "WC", aFicGuion, enHandleTxt;
     |SI FSalida < 0;
         aAlfa = "0000Problemas en crear el guion " + aFic;
         |MENAV aAlfa;
         |ACABA;
     |FINSI;

     aLin = "[FICHERO]#" + aPathLoc + "my004009.xml#" + aPathTra + aFic + ".xml";
     |XGRABA enHandleTxt, aLin;

     aSer  = #coimw026#0;
     aProc = "";
     |HAZ PonProv;

     eaAsigna = "T}1}" + nLin + "}1}";
     eaAlfa   = "Art¡culo a fabricar: " + #coimw024#2;  |QBF eaAlfa;
     eaAlfa   = eaAlfa + " " + #coimw024#6;   |QBF eaAlfa;
     |HAZ QuitaRaros;
     |HAZ AsignaTabla;

     nLin = 3;
|FPRC;

|PROCESO SacaNom;
     aLon  = aFoto % A0;
     aImag = "";
     |PARA i = 1; |SI i [ aLon; |HACIENDO i = i + 1;
          nPos = -(i * 100 + 1)
          aCar = aFoto % nPos;

          |SI aCar = "\"; |SAL; |FINSI;
          |SI aCar = "/"; |SAL; |FINSI;

          |SI aCar = ".";
              aImag = "";
              aCar  = "";
          |FINSI;

          aImag = aCar + aImag;
     |SIGUE;
|FPRC;

|PROCESO CogeMadre;
     aImag = "";

     #agifa019#0 = aArt;
     |LEE 000#agifa019.=;
     |SI FSalida = 0;
         aHijFam     = #agifa019#2;  |QBF aHijFam;
         #coima069#0 = #agifa019#2;
         |LEE 000#coima069.=;
         |SI FSalida = 0;
             aMadFam = #coima069#2;  |QBF aMadFam;
             aImag   = aMadFam + (aArt - aHijFam);  |QBF aArt;
         |FINSI;
     |FINSI;

     |SI aImag = "";  |ACABA;  |FINSI;

     #coima021#5 = aImag;
     |LEE 000#coima021.=;
     |SI FSalida = 0;
         #coima020#0 = #coima021#0;
         #coima020#1 = #coima021#1;
         #coima020#2 = #coima021#2;
         #coima020#3 = #coima021#3;
         |LEE 000#coima020.=;
         |SI FSalida = 0;
             aFoto = #coima020#5;  |QBF aFoto;
             |HAZ SacaNom;
         |FINSI;
     |FINSI;

     |SI aImag ! "";
         aImag = aImag + ".jpg";
         aAbre = aPathSer + aImag;
         |XABRE "E", aAbre, 0;
         |SI FSalida < 0;
             aImag = "";
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO CogeImagen;
     aImag = aArt;  |QBF aImag;

     #coima021#5 = aArt;
     |LEE 000#coima021.=;
     |SI FSalida = 0;
         #coima020#0 = #coima021#0;
         #coima020#1 = #coima021#1;
         #coima020#2 = #coima021#2;
         #coima020#3 = #coima021#3;
         |LEE 000#coima020.=;
         |SI FSalida = 0;
             aFoto = #coima020#5; |QBF aFoto;
             |HAZ SacaNom;
         |FINSI;
     |FINSI;

     aImag = aImag + ".jpg";
     aAbre = aPathSer + aImag;
     |XABRE "E", aAbre, 0;
     |SI FSalida < 0;
         |HAZ CogeMadre;
     |FINSI;

     |SI aImag ! "";
         aOri = aPathSer + aImag;
         aDes = aPathTra + aImag;
         |ENVIA_FICHERO aOri, aDes;

         eaAlfa   = aDes;
         eaAsigna = "I<<IMAGEN>>";
         |HAZ AsignaWord;
     |SINO;
         eaAlfa      = "";
         eaAsigna    = "T}3}1}1}+B"; |HAZ AsignaTabla;
     |FINSI;
|FPRC;

|PROCESO FinalDoc9;
     |SI aArt = "";
         |ACABA;
     |FINSI;

     eaAlfa   = "";
     eaAsigna = "T}4}4}1}+G";   |HAZ AsignaTabla;
     eaAsigna = "T}1}1}1}+P";   |HAZ AsignaTabla;

     nLin = nLin + 1;

     eaAsigna = "T}1}" + nLin + "}3}";
     eaAlfa   = "Total Art¡culos a Fabricar: " + nTot;
     |HAZ QuitaRaros;
     |HAZ AsignaTabla;

     eaAsigna = "T}4}5}1}+G";   |HAZ AsignaTabla;
     eaAsigna = "T}1}1}1}+P";   |HAZ AsignaTabla;

     |HAZ CogeImagen;

     eaAlfa      = "";
     eaAsigna    = "T}4}1}1}+B"; |HAZ AsignaTabla;

     aLin = "[LIMPIA FINAL]" + &13 + &10;
     |XGRABA enHandleTxt, aLin;

     |XCIERRA enHandleTxt;

     eaParametro1 = aPathLoc + "dsxml.exe";
     eaParametro2 = aFicGuion;
     eaParametro3 = aPathPlu;
     eaParametro4 = aPathLoc;
     eaParametro5 = aPathLoc;
     eaParametro6 = "0";

     |HAZ EjecutaDSXML;
|FPRC;

|PROCESO coimw024_Doc9;
     |SI aArt ! #coimw024#2;
         |HAZ FinalDoc9;
         |HAZ CargaDoc9;
     |FINSI;

     |SI aTip ! #coimw024#3;
         eaAsigna = "T}4}3}1}+G";   |HAZ AsignaTabla;
         eaAsigna = "T}1}1}1}+P";   |HAZ AsignaTabla;

         nLin = nLin + 1;

         eaAsigna = "T}1}" + nLin + "}3}";
         eaAlfa   = #coimw024#3;  |QBF eaAlfa;
         |SI eaAlfa = "zCOMPLEMENTOS";
             eaAlfa = "COMPLEMENTOS";
         |FINSI;

         |HAZ QuitaRaros;
         |HAZ AsignaTabla;
     |FINSI;

     eaAlfa   = "";
     |SI #coimw024#12 = " ";
         eaAsigna = "T}4}1}1}+G";   |HAZ AsignaTabla;
         eaAsigna = "T}1}1}1}+P";   |HAZ AsignaTabla;
     |FINSI;

     |SI #coimw024#12 ! " ";
         eaAsigna = "T}4}2}1}+G";   |HAZ AsignaTabla;
         eaAsigna = "T}1}1}1}+P";   |HAZ AsignaTabla;
     |FINSI;

     nLin = nLin + 1;

     eaAsigna = "T}1}" + nLin + "}1}";
     eaAlfa   = #coimw024#12;
     |HAZ AsignaTabla;

     eaAsigna = "T}1}" + nLin + "}2}";
     eaAlfa   = #coimw024#4;  |QBF eaAlfa;
     |HAZ QuitaRaros;
     |HAZ AsignaTabla;

     eaAsigna = "T}1}" + nLin + "}3}";
     eaAlfa   = #coimw024#7;  |QBF eaAlfa;
     eaAlfa   = eaAlfa + " " + #coimw024#14;  |QBF eaAlfa;
     |HAZ PonPrimeMayus;
     |HAZ QuitaRaros;
     |HAZ AsignaTabla;

     |SI #coimw024#8 ! 0;
         eaAsigna  = "T}1}" + nLin + "}4}";
         enDec     = 2;
         eaImporte = #coimw024#8;  |HAZ SeparaImporte;
         eaAlfa    = eaImporte;
         |HAZ AsignaTabla;
     |FINSI;

     |SI #coimw024#9 ! 0;
         eaAsigna  = "T}1}" + nLin + "}5}";
         enDec     = 4;
         eaImporte = #coimw024#9;  |HAZ SeparaImporte;
         eaAlfa    = eaImporte;
         |HAZ AsignaTabla;
     |FINSI;

     |SI #coimw024#10 ! 0;
         eaAsigna = "T}1}" + nLin + "}6}";
         enDec     = 4;
         eaImporte = #coimw024#10;  |HAZ SeparaImporte;
         eaAlfa    = eaImporte;
         |HAZ AsignaTabla;
     |FINSI;

     eaAsigna = "T}1}" + nLin + "}7}";
     enDec     = 0;
     eaImporte = #coimw024#11;  |HAZ SeparaImporte;
     eaAlfa    = eaImporte;
     |HAZ AsignaTabla;

     aArt = #coimw024#2;
     aTip = #coimw024#3;
     nTot = #coimw024#13;
|FPRC;

|DEFBUCLE coimw024_Doc9;
     #coimw024#2;
     ;
     #coimw026#0, #coimw026#1,   "",   "",   "", 0.0000;
     #coimw026#0, #coimw026#1, aH20, aH30, aH20, 9.9999;
     ;
     NULL, coimw024_Doc9;
|FIN;

|PROCESO coimw026_Doc9;
     nDocCap = 0;
     aPrv    = "";
     aArt    = "";
     |BUCLE coimw024_Doc9;
     |SI nDocCap > 0;
         |HAZ FinalDoc9;
     |FINSI;

     |PULSATECLA;
|FPRC;

|DEFBUCLE coimw026_Doc9;
     #coimw026#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, coimw026_Doc9;
|FIN;

|PROCESO Documento9;
     |SI #coimy004#13 = "N";  |ACABA;  |FINSI;

     eaOrigen  = aPathPla + "my004009.xml";
     eaDestino = aPathLoc + "my004009.xml";
     |HAZ EnviaFicheroConMD5;

     nCntDoc = 0;
     |BUCLE coimw026_Doc9;
|FPRC;

|PROCESO Final;
     |PULSATECLA;

     aFicGuion = aPathTra + "doc00001.txt";
     |XABRE "WC", aFicGuion, enHandleTxt;
     |SI FSalida < 0;
         |MENAV "0000Problemas en crear el guion my004001001";
         |ACABA;
     |FINSI;

     aLin = "[FICHERO]#" + aPathTra + "doc00001.xml#" + aPathTra + "doc00001.xml";
     |XGRABA enHandleTxt, aLin;

     |PARA nDoc = 2;  |SI nDoc [ nNumDoc;  |HACIENDO nDoc = nDoc + 1;
           aAbre = aPathTra + "doc" + (("00000" + nDoc) % -105) + ".xml";
           |XABRE "EC", aAbre, 0;
           |SI FSalida ] 0;
               aAlfa = "M" + &13 + &10;
               |XGRABA enHandleTxt, aAlfa;

               aAlfa = "<<PEGAR>>" + &13 + &10;
               |XGRABA enHandleTxt, aAlfa;

               aAlfa   = aPathTra + "doc" + (("00000" + nDoc) % -105) + ".xml" + &13 + &10;
               |XGRABA enHandleTxt, aAlfa;
           |FINSI;
     |SIGUE;

     eaAlfa   = #coimy004#0;  |QBF eaAlfa;
     eaAlfa   = eaAlfa + " / " + #coimy004#2;  |QBF eaAlfa;
     eaAlfa   = eaAlfa + " a " + #coimy004#1;  |QBF eaAlfa;
     eaAlfa   = eaAlfa + " / " + #coimy004#2;  |QBF eaAlfa;
     eaAsigna = "V#ORDFAC#";
     |HAZ AsignaWord;

     |XCIERRA enHandleTxt;

     eaParametro1 = aPathLoc + "dsxml.exe";
     eaParametro2 = aFicGuion;
     eaParametro3 = aPathPlu;
     eaParametro4 = aPathLoc;
     eaParametro5 = aPathLoc;
     eaParametro6 = "0";

     |HAZ EjecutaDSXML;

     |PULSATECLA;
     |PULSATECLA;

     aFicGuion = aPathTra + "doc00001.txt";
     |XABRE "WC", aFicGuion, enHandleTxt;
     |SI FSalida < 0;
         |MENAV "0000Problemas en crear el guion my004001001";
         |ACABA;
     |FINSI;

     aLin = "[FICHERO]#" + aPathTra + "doc00001.xml#" + aPathTra + "doc00001.xml";
     |XGRABA enHandleTxt, aLin;

     eaAlfa   = "";
     eaAsigna = "V<<PEGAR>>";
     |HAZ AsignaWord;

     aLin = "[LIMPIA FINAL]" + &13 + &10;
     |XGRABA enHandleTxt, aLin;

     aLin = "[IMPRESORA]#P";
     |XGRABA enHandleTxt, aLin;

     |XCIERRA enHandleTxt;

     eaParametro1 = aPathLoc + "dsxml.exe";
     eaParametro2 = aFicGuion;
     eaParametro3 = aPathPlu;
     eaParametro4 = aPathLoc;
     eaParametro5 = aPathLoc;
     eaParametro6 = "";

     |HAZ EjecutaDSXML;

     |PULSATECLA;
     |PULSATECLA;
|FPRC;

|PROCESO coimw025_Doc10;
     nLin  = nLin + 1;

     eaAlfa   = "";
     eaAsigna = "T}2}1}1}+G";   |HAZ AsignaTabla;
     eaAsigna = "T}1}1}1}+P";   |HAZ AsignaTabla;

     eaAsigna = "T}1}" + nLin + "}1}";
     eaAlfa   = #coimw025#2#;
     |HAZ AsignaTabla;

     eaAsigna = "T}1}" + nLin + "}2}";
     eaAlfa   = #coimw025#3#;
     |HAZ QuitaRaros;
     |HAZ AsignaTabla;

     eaAsigna = "T}1}" + nLin + "}3}";
     eaAlfa   = #coimw025#4#;
     |HAZ AsignaTabla;

     eaAsigna  = "T}1}" + nLin + "}4}";
     enDec     = 2;
     eaImporte = #coimw025#5;  |HAZ SeparaImporte;
     eaAlfa    = eaImporte;
     |HAZ AsignaTabla;
|FPRC;

|DEFBUCLE coimw025_Doc10;
     #coimw025#1;
     ;
     #coimw026#0, #coimw026#1,   "";
     #coimw026#0, #coimw026#1, aH20;
     ;
     NULL, coimw025_Doc10;
|FIN;

|PROCESO coimw026_Doc10;
     |DDEFECTO #coimw025;
     #coimw025#0  = #coimw026#0;
     #coimw025#1  = #coimw026#1;
     #coimw025#2  = "";
     |LEE 000#coimw025.];
     |SI FSalida ! 0;  |O  #coimw025#0  ! #coimw026#0;
                       |O  #coimw025#1  ! #coimw026#1;
         |ACABA;
     |FINSI;

     nNumDoc = nNumDoc + 1;
     nCntDoc = nCntDoc + 1;

     aAlfa = ("000" + nCntDoc) % -103;
     |ATRI S;
     |PINTA 1005, "Documentos";
     |PINTA 2008, aAlfa;
     |ATRI 0;

     |PULSATECLA;

     eaOrigen  = aPathPla + "my004010.xml";
     eaDestino = aPathLoc + "my004010.xml";
     |HAZ EnviaFicheroConMD5;

     aFic = "doc" + (("00000" + nNumDoc) % -105);

     aFicGuion = aPathTra + aFic + ".txt";
     |XABRE "WC", aFicGuion, enHandleTxt;
     |SI FSalida < 0;
         aAlfa = "0000Problemas en crear el guion " + aFic;
         |MENAV aAlfa;
         |ACABA;
     |FINSI;

     aLin = "[FICHERO]#" + aPathLoc + "my004010.xml#" + aPathTra + aFic + ".xml";
     |XGRABA enHandleTxt, aLin;

     aSer  = #coimw026#0;
     aProc = "";
     |HAZ PonProv;

     nLin = 1;
     nTot = 0;
     |BUCLE coimw025_Doc10;

     eaAlfa   = "";
     eaAsigna = "T}2}2}1}+G";   |HAZ AsignaTabla;
     eaAsigna = "T}1}1}1}+P";   |HAZ AsignaTabla;

     eaAlfa      = "";
     eaAsigna    = "T}2}1}1}+B"; |HAZ AsignaTabla;

     aLin = "[LIMPIA FINAL]" + &13 + &10;
     |XGRABA enHandleTxt, aLin;

     |XCIERRA enHandleTxt;

     eaParametro1 = aPathLoc + "dsxml.exe";
     eaParametro2 = aFicGuion;
     eaParametro3 = aPathPlu;
     eaParametro4 = aPathLoc;
     eaParametro5 = aPathLoc;
     eaParametro6 = "0";

     |HAZ EjecutaDSXML;
|FPRC;

|DEFBUCLE coimw026_Doc10;
     #coimw026#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, coimw026_Doc10;
|FIN;

|PROCESO Documento10;
     |SI #coimy004#14 = "N";  |ACABA;  |FINSI;

     nCntDoc = 0;
     |BUCLE coimw026_Doc10;
|FPRC;

|PROCESO T12;  |TIPO 12;
     |SI FSalida = 7;
         |ACABA;
     |FINSI;

     #agifa090#20 = #coimy004#0;
     #agifa090#0  = #coimy004#2;
     |LEE 000#agifa090.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     nNumDoc = 0;
     |HAZ CreaTempos;

     |HAZ Documento1;
     |HAZ Documento2;

     |SI nTEst = 1;
         |HAZ Documento3;
         |HAZ Documento4;
     |FINSI;

     |SI nTEsp = 1;
         |HAZ Documento5;
     |FINSI;

     |SI nTBor = 1;
        |HAZ Documento6;
        |HAZ Documento7;
     |FINSI;

     |SI nTPeg = 1;
         |HAZ Documento8;
     |FINSI;

     |HAZ Documento9;
     |HAZ Documento10;

     |HAZ Final;
|FPRC;

|PROGRAMA;
     |C_M #coimy004#0, 1, "S";
     |C_M #coimy004#1, 1, "S";
     |C_M #coimy004#2, 1, "S";

     |SI enOrd ! 0;
         #coimy004#0 = eaSer;
         #coimy004#1 = eaSer;
         #coimy004#2 = enOrd;

         |C_M #coimy004#0, 1, "N";
         |C_M #coimy004#1, 1, "N";
         |C_M #coimy004#2, 1, "N";
     |FINSI;

     |MANTE #coimy004;
|FPRO;

|PROCESO TraeDocs;
     aOri = aPathPla + "my004001.xml";
     |XABRE "E", aOri, 0;
     |SI FSalida < 0;
         aOri = aPathPla + "plantilla_my004001.xml";
         aDes = aPathPla + "my004001.xml";
         |COPIA_FICHERO aOri, aDes;
     |FINSI;

     aOri = aPathPla + "my004002.xml";
     |XABRE "E", aOri, 0;
     |SI FSalida < 0;
         aOri = aPathPla + "plantilla_my004002.xml";
         aDes = aPathPla + "my004002.xml";
         |COPIA_FICHERO aOri, aDes;
     |FINSI;

     aOri = aPathPla + "my004003.xml";
     |XABRE "E", aOri, 0;
     |SI FSalida < 0;
         aOri = aPathPla + "plantilla_my004003.xml";
         aDes = aPathPla + "my004003.xml";
         |COPIA_FICHERO aOri, aDes;
     |FINSI;

     aOri = aPathPla + "my004004.xml";
     |XABRE "E", aOri, 0;
     |SI FSalida < 0;
         aOri = aPathPla + "plantilla_my004004.xml";
         aDes = aPathPla + "my004004.xml";
         |COPIA_FICHERO aOri, aDes;
     |FINSI;

     aOri = aPathPla + "my004005.xml";
     |XABRE "E", aOri, 0;
     |SI FSalida < 0;
         aOri = aPathPla + "plantilla_my004005.xml";
         aDes = aPathPla + "my004005.xml";
         |COPIA_FICHERO aOri, aDes;
     |FINSI;

     aOri = aPathPla + "my004006.xml";
     |XABRE "E", aOri, 0;
     |SI FSalida < 0;
         aOri = aPathPla + "plantilla_my004006.xml";
         aDes = aPathPla + "my004006.xml";
         |COPIA_FICHERO aOri, aDes;
     |FINSI;

     aOri = aPathPla + "my004007.xml";
     |XABRE "E", aOri, 0;
     |SI FSalida < 0;
         aOri = aPathPla + "plantilla_my004007.xml";
         aDes = aPathPla + "my004007.xml";
         |COPIA_FICHERO aOri, aDes;
     |FINSI;

     aOri = aPathPla + "my004008.xml";
     |XABRE "E", aOri, 0;
     |SI FSalida < 0;
         aOri = aPathPla + "plantilla_my004008.xml";
         aDes = aPathPla + "my004008.xml";
         |COPIA_FICHERO aOri, aDes;
     |FINSI;

     aOri = aPathPla + "my004009.xml";
     |XABRE "E", aOri, 0;
     |SI FSalida < 0;
         aOri = aPathPla + "plantilla_my004009.xml";
         aDes = aPathPla + "my004009.xml";
         |COPIA_FICHERO aOri, aDes;
     |FINSI;

     aOri = aPathPla + "my004010.xml";
     |XABRE "E", aOri, 0;
     |SI FSalida < 0;
         aOri = aPathPla + "plantilla_my004010.xml";
         aDes = aPathPla + "my004010.xml";
         |COPIA_FICHERO aOri, aDes;
     |FINSI;
|FPRC;

|PROCESO T80;  |TIPO 80;
     |DBASE aBase;

     enModoExterno = 1;

     aPathPlu = aBase + "plugins/";
     aPathPla = aBase + "000web/plantillas/";

     |HAZ DimeUnidad;
     aPathLoc = eaUnidad  + ":\DOCUMENTOS";     |RMKDIR aPathLoc;
     aPathLoc = aPathLoc + "\DSCOMER9";         |RMKDIR aPathLoc;
     aPathLoc = aPathLoc + "\";

     aPathTra = aPathLoc + Usuario;             |RMKDIR aPathTra;
     aPathTra = aPathTra + "\";

     |HAZ TraeDocs;

     aNome = "coimw021" + Usuario;  |NOME_DAT #coimw021#aNome#;
     aNome = "coimw022" + Usuario;  |NOME_DAT #coimw022#aNome#;
     aNome = "coimw023" + Usuario;  |NOME_DAT #coimw023#aNome#;
     aNome = "coimw024" + Usuario;  |NOME_DAT #coimw024#aNome#;
     aNome = "coimw025" + Usuario;  |NOME_DAT #coimw025#aNome#;
     aNome = "coimw026" + Usuario;  |NOME_DAT #coimw026#aNome#;

     |ABRE #coimw021;  |CIERRA #coimw021;  |DELINDEX #coimw021;
     |ABRE #coimw022;  |CIERRA #coimw022;  |DELINDEX #coimw022;
     |ABRE #coimw023;  |CIERRA #coimw023;  |DELINDEX #coimw023;
     |ABRE #coimw024;  |CIERRA #coimw024;  |DELINDEX #coimw024;
     |ABRE #coimw025;  |CIERRA #coimw025;  |DELINDEX #coimw025;
     |ABRE #coimw026;  |CIERRA #coimw026;  |DELINDEX #coimw026;

     |DBASE aBase;
     aPathSer = aBase + "000web/fotos/";
     aH20     = "z" * 20;
     aH30     = "z" * 30;
     aH60     = "z" * 60;
     aH100    = "z" * 100;

     |ABRET #agifa019;
     |ABRET #agifa090;
     |ABRET #agifa112;
     |ABRET #agifa120;
     |ABRET #coima020;
     |ABRET #coima021;  |SELECT #2#coima021;
     |ABRET #coima043;
     |ABRET #coima051;
     |ABRET #coima069;
     |ABRET #coima070;
     |ABRET #coimw021;
     |ABRET #coimw022;
     |ABRET #coimw023;
     |ABRET #coimw024;
     |ABRET #coimw025;
     |ABRET #coimw026;
|FPRC;

|PROCESO T90;  |TIPO 90;
     |CIERRAT #agifa019;
     |CIERRAT #agifa090;
     |CIERRAT #agifa112;
     |CIERRAT #agifa120;
     |CIERRAT #coima020;
     |CIERRAT #coima021;
     |CIERRAT #coima043;
     |CIERRAT #coima051;
     |CIERRAT #coima069;
     |CIERRAT #coima070;
     |CIERRAT #coimw021;  |DELINDEX #coimw021;
     |CIERRAT #coimw022;  |DELINDEX #coimw022;
     |CIERRAT #coimw023;  |DELINDEX #coimw023;
     |CIERRAT #coimw024;  |DELINDEX #coimw024;
     |CIERRAT #coimw025;  |DELINDEX #coimw025;
     |CIERRAT #coimw026;  |DELINDEX #coimw026;

     aAlfa = aPathTra + "*.*";
     |R_PDIR aAlfa;
     |PARA;  |SI FSalida = 0;  |HACIENDO;
          |RFBORRA aAlfa;
          |R_SDIR aAlfa;
     |SIGUE;
|FPRC;
