|FICHEROS;
     albm0053 #53;
     albm0052 #52;
     albm0002 #2;
     albm0035 #35;
     albm0046 #46;

     agifa081 #81;
     agifa077 #77;
     agifa112 #112;
     agifa065 #65;

     dsw00034 #934;
|FIN;

|VARIABLES;
     aFechaDesde = "";
     aParametro = "";
     aCodigo    = "";
     aDescri    = "";
     aAlfa      = "";
     aFichero   = "";

     nCampo     = 0;
     nCampo1    = 0;
     nPuntos    = 0;
     nPedidos   = 0;
     nPartidas  = 0;
     nDias      = 0;
     nKilos     = 0;
     nPosicion  = 0;
     nBoton1    = 0;
     nBoton2    = 0;
     nBoton3    = 0;
     nBoton4    = 0;
     nPanta     = 0;
     nVentana   = 0;
     aPrograma = "";
|FIN;

|PROCESO Fechas;
                     nDias = #81#2 - #77#1;
     |SI nDias < 0;  nDias = 0;  |FINSI;

     nPuntos = 0;
     |PARA nCampo = 1;  |SI nCampo [ 5;  |HACIENDO nCampo = nCampo + 1;
           nCampo1 = nCampo + 5;
           |SI nDias ] #52nCampo;
               nPuntos = #52nCampo1;
           |FINSI;
     |SIGUE;

     #53#6 = #53#6 + nPuntos;
|FPRC;

|PROCESO Kilos;
     nKilos = #2#6 - #2#15;
     |SI nKilos < 0;  nKilos = -nKilos;  |FINSI;

     nKilos  = (100 * nKilos) / #2#6;
     nPuntos = 0;

     |PARA nCampo = 11;  |SI nCampo [ 15;  |HACIENDO nCampo = nCampo + 1;
           nCampo1 = nCampo + 5;
           |SI nKilos ] #52nCampo;
               nPuntos = #52nCampo1;
           |FINSI;
     |SIGUE;

     #53#4 = #53#4 + nPuntos;
|FPRC;

|PROCESO agifa065;
     #934#0 = #65#10;
     |LEE 101#934=;
     |SI FSalida ! 0;
         |DDEFECTO #934;
         #934#0 = #65#10;
         |GRABA 020#934b;
     |FINSI;

     #934#2 = #65#1;
     #934#3 = #65#6;
     #934#4 = #65#14;
     #934#5 = #65#11;
     #934#6 = #65#3;
     #934#7 = #65#4;
     |GRABA 020#934a;
     |LIBERA #934;
|FPRC;

|DEFBUCLE agifa065;
     #65#1;
     ;
     #2#4, aFechaDesde, "AC", 000000, 00000, "     ";
     #2#4, "31.12.9999", "AC", 999999, 99999, "zzzzz";
     ;
     NULL, agifa065;
|FIN;

|PROCESO dsw00034;
     nPosicion = nPosicion + 1;

     |SI #934#0 = #2#7;
         |ERROR10;
     |FINSI;
|FPRC;

|DEFBUCLE dsw00034;
     #934#2;
     ;
     9999999, "      ";
     -999999, "zzzzzz";
     ;
     NULL, dsw00034;
|FIN;

|PROCESO Precios;
     aFichero = ("34" + Usuario + "zzzzzzzz") % 108;
     |ABRE #934;  |CIERRA #934;  |DELINDEX #934;

     |ABRE #934;
     |BUCLE agifa065;
     |CIERRA #934;

     nPosicion = 0;
     |BUCLE dsw00034;

     |ABRE #934;  |CIERRA #934;  |DELINDEX #934;

     nPuntos = 0;
     |PARA nCampo = 21;  |SI nCampo [ 25;  |HACIENDO nCampo = nCampo + 1;
           nCampo1 = nCampo + 5;
           |SI nPosicion ] #52nCampo;
               nPuntos = #52nCampo1;
           |FINSI;
     |SIGUE;

     #53#5 = #53#5 + nPuntos;
|FPRC;

|PROCESO albm0002;
     #81#25 = #2#0;
     #81#0  = #2#1;
     |LEE 000#81=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     #77#50 = #2#11;
     #77#0  = #2#12;
     |LEE 000#77=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     nPedidos = nPedidos + 1;

     |HAZ Fechas;
     |HAZ Kilos;
     |HAZ Precios;
|FPRC;

|DEFBUCLE albm0002;
     #2#3;
     2;
     #53#0, "                    ", aFechaDesde;
     #53#0, "zzzzzzzzzzzzzzzzzzzz", "31.12.9999";
     ;
     NULL, albm0002;
|FIN;

|PROCESO albm0046;
     nPuntos = #52#31;

     #35#0 = #46#0;
     #35#2 = #46#1;
     #35#4 = #46#2;
     |LEE 000#35=;
     |SI FSalida = 0;
         |SI #35#39 = "S";  nPuntos = #52#34;  |FINSI;
         |SI #35#40 = "S";  nPuntos = #52#33;  |FINSI;
         |SI #35#41 = "S";  nPuntos = #52#32;  |FINSI;
     |FINSI;

     nPartidas = nPartidas + 1;
     #53#3 = #53#3 + nPuntos;
|FPRC;

|DEFBUCLE albm0046;
     #46#4;
     4;
     #53#0, "                    ", aFechaDesde;
     #53#0, "zzzzzzzzzzzzzzzzzzzz", "31.12.9999";
     ;
     NULL, albm0046;
|FIN;

|PROCESO Calculo;
     nPedidos  = 0;
     nPartidas = 0;
     #53#3     = 0;
     #53#4     = 0;
     #53#5     = 0;
     #53#6     = 0;

     |ABRE #81;
     |ABRE #77;
     |ABRE #35;
     |BUCLE albm0002;
     |BUCLE albm0046;
     |CIERRA #35;
     |CIERRA #77;
     |CIERRA #81;

     #53#3 = #53#3 / nPartidas;
     #53#4 = #53#4 / nPedidos;
     #53#5 = #53#5 / nPedidos;
     #53#6 = #53#6 / nPedidos;

     |SI #53#4 = 0;  #53#4 = 7;  |FINSI;
     |SI #53#5 = 0;  #53#5 = 7;  |FINSI;
     |SI #53#6 = 0;  #53#6 = 7;  |FINSI;

     #53#2  = "CALCULO REALIZADO SOBRE " + nPedidos + " PEDIDOS Y SOBRE " + nPartidas + " PARTIDAS.";
     #53#19 = nPedidos;
     #53#20 = nPartidas;
|FPRC;

|PROCESO PintaCampos;
     |PINTA #53#2;
     |PINTA #53#3;
     |PINTA #53#4;
     |PINTA #53#5;
     |PINTA #53#6;
     |PINTA #53#7;
     |PINTA #53#8;
     |PINTA #53#9;
     |PINTA #53#10;
     |PINTA #53#11;
     |PINTA #53#12;
     |PINTA #53#13;
     |PINTA #53#14;
     |PINTA #53#15;
     |PINTA #53#16;
     |PINTA #53#17;
     |PINTA #53#18;
|FPRC;

|PROCESO CogeLiteral;
     |PARA nCampo = 35;  |SI nCampo [ 39;  |HACIENDO nCampo = nCampo + 1;
           nCampo1 = nCampo + 5;
           |SI nPuntos ] #52nCampo;
               aDescri = #52nCampo1;
           |FINSI;
     |SIGUE;
|FPRC;

|PROCESO Valoracion;
     |SI #53#3 > 10;  #53#3 = 10;  |FINSI;
     |SI #53#4 > 10;  #53#4 = 10;  |FINSI;
     |SI #53#5 > 10;  #53#5 = 10;  |FINSI;
     |SI #53#6 > 10;  #53#6 = 10;  |FINSI;
     |SI #53#7 > 10;  #53#7 = 10;  |FINSI;
     |SI #53#8 > 10;  #53#8 = 10;  |FINSI;
     |SI #53#9 > 10;  #53#9 = 10;  |FINSI;

     #53#10 = #53#3 + #53#4 + #53#5 + #53#6 + #53#7 + #53#8 + #53#9;

     nPuntos = #53#3;  aDescri = "";   |HAZ CogeLiteral;  #53#11 = aDescri;
     nPuntos = #53#4;  aDescri = "";   |HAZ CogeLiteral;  #53#12 = aDescri;
     nPuntos = #53#5;  aDescri = "";   |HAZ CogeLiteral;  #53#13 = aDescri;
     nPuntos = #53#6;  aDescri = "";   |HAZ CogeLiteral;  #53#14 = aDescri;
     nPuntos = #53#7;  aDescri = "";   |HAZ CogeLiteral;  #53#15 = aDescri;
     nPuntos = #53#8;  aDescri = "";   |HAZ CogeLiteral;  #53#16 = aDescri;
     nPuntos = #53#9;  aDescri = "";   |HAZ CogeLiteral;  #53#17 = aDescri;

     |PARA nCampo = 45;  |SI nCampo [ 49;  |HACIENDO nCampo = nCampo + 1;
           nCampo1 = nCampo + 5;
           |SI #53#10 ] #52nCampo;  |Y #52nCampo1 ! "               ";
               #53#18 = #52nCampo1;
           |FINSI;
     |SIGUE;
|FPRC;

|PROCESO Tipo12;  |TIPO 12;
|FPRC;

|PROCESO Tipo80;  |TIPO 80;
     |ABRE #52;
     |LEE 000#52p;
     |SI FSalida ! 0;  |DDEFECTO #52;  |FINSI;
     |CIERRA #52;

     aFechaDesde = #52#56;

     FSalida = 2699;
|FPRC;

|PROCESO Boton1;
     |HAZ ActBaremos;
     |ESTADO_CONTROL nBoton1, "DISABLE";
     |ESTADO_CONTROL nBoton2, "DISABLE";

     |HAZ Calculo;
     |HAZ Valoracion;
     |PINDA #0#53;

     |ESTADO_CONTROL nBoton1, "ENABLE";
     |ESTADO_CONTROL nBoton2, "ENABLE";
|FPRC;

|PROCESO agifa112;
     #53#0 = #112#0;
     |LEE 101#53=;
     |SI FSalida ! 0;
         |DDEFECTO #53;
         #53#0 = #112#0;
         |GRABA 020#53b;
     |FINSI;

     #53#1 = #112#1;
     |HAZ Calculo;
     |HAZ Valoracion;
     |GRABA 020#53a;
     |LIBERA #53;
|FPRC;

|DEFBUCLE agifa112;
     #112#1;
     ;
     "      ";
     "zzzzzz";
     ;
     NULL, agifa112;
|FIN;

|PROCESO Boton2;
     |HAZ ActBaremos;
     |CONFI "0000NSeguro de Calcular a Todos los Proveedores.";
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |ESTADO_CONTROL nBoton1, "DISABLE";
     |ESTADO_CONTROL nBoton2, "DISABLE";

     |BUCLE agifa112;

     #53#0 = aCodigo;
     |LEE 101#53=;

     |PINDA #0#53;

     |ESTADO_CONTROL nBoton1, "ENABLE";
     |ESTADO_CONTROL nBoton2, "ENABLE";
|FPRC;

|PROCESO Boton3;
     |VENTANA 0501, 2699, -1, -1, "";
     nVentana = FSalida;

     |SUB_EJECUTA_NP "albm0052";

     |FINVENTANA nVentana;
|FPRC;

|PROCESO Boton4;
     |VENTANA 0501, 2699, -1, -1, "";
     nVentana = FSalida;

     aPrograma = "albm0058;" + #albm0053#0;
     |SUB_EJECUTA_NP aPrograma;

     |FINVENTANA nVentana;
|FPRC;



|PROGRAMA;
     aParametro = PARAMETRO;  |QBF aParametro;
     aCodigo    = aParametro % 706;
     aParametro = aParametro % 106;

     |SI aParametro = "CALCUL";
         |ABRE #53;
         #53#0 = aCodigo;
         |LEE 101#53=;
         |SI FSalida ! 0;
             |DDEFECTO #53;
             #53#0 = aCodigo;
             |GRABA 020#53b;
         |FINSI;

         |ABRE #112;
         #112#0 = #53#0;
         |LEE 000#112=;
         |SI FSalida ! 0;  |DDEFECTO #112;  |FINSI;
         |CIERRA #112;

         #53#1 = #112#1;

         |HAZ Calculo;
         |HAZ Valoracion;
         |GRABA 020#53a;
         |LIBERA #53;
         |CIERRA #53;

         |ACABA;
     |FINSI;

     |ABRE #53;

     #53#0 = aCodigo;
     |LEE 101#53=;
     |SI FSalida ! 0;
         |DDEFECTO #53;
         #53#0 = aCodigo;
         |GRABA 020#53b;
     |FINSI;

     |ABRE #112;
     #112#0 = #53#0;
     |LEE 000#112=;
     |SI FSalida ! 0;  |DDEFECTO #112;  |FINSI;
     |CIERRA #112;

     #53#1 = #112#1;

     |PINPA #0#53;
     nPanta = FSalida;

     |PINDA #0#53;

     |CONTROL_SIMPLE nPanta,"BOTON,{{217}} Refrescar Proveedor",  0570, 0598, Boton1;
     nBoton1  = FSalida;

     |CONTROL_SIMPLE nPanta,"BOTON,{{218}} Refrescar Todos los Proveedores",  0670, 0698, Boton2;
     nBoton2  = FSalida;

     |CONTROL_SIMPLE nPanta,"BOTON,{{219}} Baremos",  0653, 0665, Boton3;
     nBoton3  = FSalida;

     |CONTROL_SIMPLE nPanta,"BOTON,{{205}} Imprimir", 0553, 0565,  Boton4;
     nBoton4 = FSalida;

     |ENDATOS #1#53;
     |SI FSalida = 0;
         |GRABA 020#53a;
     |FINSI;
     |LIBERA #53;
     |CIERRA #53;

     |DESTRUYECONTROL nBoton1;
     |DESTRUYECONTROL nBoton2;
     |DESTRUYECONTROL nBoton3;
     |DESTRUYECONTROL nBoton4;

     |PULSATECLA;
|FPRO;

|PROCESO ActBaremos;
     |ABRE #52;
     |LEE 000#52p;
     |SI FSalida ! 0;  |DDEFECTO #52;  |FINSI;
     |CIERRA #52;

     aFechaDesde = #52#56;
|FPRC;
