|FICHEROS;
     agifa104 #104;
     agifa024 #24;
     agifa025 #25;
     coima022 #22;
|FIN;

|VARIABLES;
     &enSwPsion = 0;
     &eaSerie = "";
     &enCodigo = 0;
     &eaImpresora = "";
     {1}aBaseLocal = "";
     aIP = "";
     aAlfa = "";
     &ser_ped = "";
     &num_ped = 0;
     aDjunto = "";
     aServidor = "";
     aFrom = "";
     aTo = "";
     aSubject = "";
     aMensaje = "";
     aEmail = "";
     aEmail1 = "";
     aEmail2 = "";
|FIN;

|PROCESO Correo;
     aIP = ""; |IP_REMOTO aIP;
     |SI aIP = "";
          |DFICE aAlfa;
          aDjunto = aAlfa + #104#25 + "_" + (("000000" + #104#0)%-106)+ ".pdf";
          |QBT aDjunto;
          eaImpresora = "CrystalReport;" + aDjunto;
          ser_ped = #104#25;
          num_ped = #104#0;
          |SUB_EJECUTA_NP "agifa105";
     |SINO;
          |DFICE aAlfa;
          aDjunto = aAlfa + #104#25 + "_" + (("000000" + #104#0)%-106)+ ".pdf";
          |QBT aDjunto;
          |ESPECIFICA "RBASS", aBaseLocal;
          aAlfa = aBaseLocal1 + #104#25 + "_" + (("000000" + #104#0)%-106)+ ".pdf";
          |QBT aAlfa;
          eaImpresora = "CrystalReport;" + aAlfa;
          ser_ped = #104#25;
          num_ped = #104#0;
          |SUB_EJECUTA_NP "agifa105";
          |RECIBE_FICHERO aAlfa, aDjunto;
          |RFBORRA aAlfa;
     |FINSI;

     aIP = "";
     |SI #22#8 = "L";
          |IP_REMOTO aIP;
     |SINO;
          |SI #22#8 = "S";
               |IP_LOCAL aIP;
          |SINO;
               aIP = #22#7; |QBF aIP;
          |FINSI;
     |FINSI;
     aServidor = #22#14; |QBF aServidor;
     aFrom = #22#15; |QBF aFrom;
     aTo = aEmail;
     |SI aTo ! "";
          aSubject = "Confirmación pedido web.";
          aMensaje = "Adjunto pedido:" + #104#25 + "/" + (("000000" + #104#0)%-106) + ".";
          aMensaje = aMensaje + &13 + "Reciba un cordial saludo.";
          aMensaje = aMensaje + &13 + "Coimasa.";
          |DSCORREO_ENVIA aIP, aServidor, aFrom, aTo, aSubject, aMensaje, aDjunto;
     |FINSI;
|FPRC;

|PROGRAMA;
     |ABRE #104;
     #104#25 = eaSerie;
     #104#0 = enCodigo;
     |LEE 000#104=;
     |SI FSalida = 0;
          |ABRE #22; |LEE 000#22p; |CIERRA #22;

          |ABRE #24;
          #24#0 = #104#4;
          |LEE 000#24=;
          |SI FSalida ! 0; |DDEFECTO #24; |FINSI;
          |CIERRA #24;
          aEmail1 = #24#214; |QBF aEmail;
          aEmail2 = #24#197; |QBF aEmail;

          |SI aEmail1 = "";
               aEmail = aEmail2;
          |SINO;
               aEmail = aEmail1;
          |FINSI;
          |SI aEmail ! ""; ||Y #22#16 ! "N";
               |HAZ Correo;
          |FINSI;

          |ABRE #25;
          #25#0 = #104#7;
          |LEE 000#25=;
          |SI FSalida ! 0; |DDEFECTO #25; |FINSI;
          |CIERRA #25;

          aEmail = #25#62; |QBF aEmail;
          |SI aEmail ! "";
               |HAZ Correo;
          |FINSI;

          aAlfa = #104#15; |QBT aAlfa;
          |SI aAlfa ! "";
               enSwPsion = 1;
               |HAZ EnviaMail;
          |FINSI;
     |FINSI;
     |CIERRA #104;
|FPRO;
