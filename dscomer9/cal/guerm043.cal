|FICHEROS;
     guerm043 #0;
     gopre001 #1;
     gopre002 #2;
     gopre003 #3;
     gomantho #5;
     gomantl1 #6;
     goparame #100;

     agifa019 #19;
     agifa024 #24;
     agifa025 #25;
     agifa084 #84;
     agifa069 #69;
     agifa134 #134;
     agifa142 #142;
|FIN;

|VARIABLES;
     nSwFlag = 0;
     &eaProg = "";
     &enErrCarte = 0;
     nModo = 0;
     nForma = 0;
     &serie = "";
     &numero = 0;
     nHay = 0;
     &aDivisa = "";
     &aMoneda = "";
     &eaProgVta = "";
     &enForma = 0;
     &enCoste = 0;
     aAlfa = "";
|FIN;

|PROCESO Max1;
     #1#15 = #0#9;
     #1#16 = #0#10;
|FPRC;

|PROCESO Min1;
     #1#15 = #0#9;
     #1#16 = #0#10;
|FPRC;

|PROCESO Max2;
     #2#0 = #0#11;
     #2#1 = #0#12;
     #2#2 = 999;
|FPRC;

|PROCESO Min2;
     #2#0 = #0#11;
     #2#1 = #0#12;
     #2#2 = 1;
|FPRC;

|PROCESO Max3;
     #3#0 = #0#11;
     #3#1 = #0#12;
     #3#2 = #0#13;
     #3#4 = "z" * 20;
|FPRC;

|PROCESO Min3;
     #3#0 = #0#11;
     #3#1 = #0#12;
     #3#2 = #0#13;
     #3#4 = " " * 20;
|FPRC;

|PROCESO Partida66; |TIPO 66;
     |ABRE #3;
     |SELECT #2#3;
     #3#0 = #0#11;
     #3#1 = #0#12;
     #3#2 = #0#13;
     #3#4 = #0#14;
     |LEE 000#3];
     |CONSULTA_F_CLAVE #2#3, Min3, Max3;
     |SI FSalida = 0;
          #0#14 = #3#4; |PINTA #0#14;
     |SINO;
          |ERROR;
     |FINSI;
     |CIERRA #3;
|FPRC;

|PROCESO Capi66; |TIPO 66;
     |ABRE #2;
     #2#0 = #0#11;
     #2#1 = #0#12;
     #2#2 = 0;
     |LEE 000#2];
     |CONSULTA_F_CLAVE #1#2, Min2, Max2;
     |SI FSalida = 0;
          #0#13 = #2#12; |PINTA #0#13;
     |SINO;
          |ERROR;
     |FINSI;
     |CIERRA #2;
|FPRC;

|PROCESO Pre66; |TIPO 66;
     |ABRE #1;
     |SELECT #4#1;
     #1#15 = #0#11;
     #1#16 = #0#12;
     |LEE 000#1];
     |CONSULTA_F_CLAVE #4#1, Min1, Max1;
     |SI FSalida = 0;
          #0#11 = #1#0; |PINTA #0#11;
          #0#12 = #1#1; |PINTA #0#12;
     |SINO;
          |ERROR;
     |FINSI;
     |CIERRA #1;
|FPRC;

|PROCESO Conta7; |TIPO 7;
     |ABRE #84;
     #84#48 = #0#0;
     |HAZ ContaFD7;
     #0#1 = #84#0;
     |CIERRA #84;
|FPRC;

|PROCESO Conta0;
     #84#48 = #0#0;
     |HAZ ContaFD0;

     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 1;
          |HAZ CheqFac;
     |FINSI;
|FPRC;

|PROCESO Hay;
     nHay = 1;
|FPRC

|DEFBUCLE gopre003;
     #3#1;
     4;
     #0#11, #0#12, #0#13, 001, #0#14;
     #0#11, #0#12, #0#13, 999, #0#14;
     ;
     NULL, Hay;
|FIN;

|DEFBUCLE gopre002;
     #2#1;
     12;
     #0#11, #0#12, 001, #0#13;
     #0#11, #0#12, 999, #0#13;
     ;
     NULL, Hay;
|FIN;

|DEFBUCLE gomantl1;
     #6#1;
     3, 4;
     #0#9, #0#10, 001, #0#11, #0#12;
     #0#9, #0#10, 999, #0#11, #0#12;
     ;
     NULL, Hay;
|FIN;

|PROCESO Partida;
     nHay = 0;
     |BUCLE gopre003;
     |SI nHay = 0;
          |MENAV "0000No existe partida en el capitulo del presupuesto...";
          |ERROR;
     |FINSI;
|FPRC;

|PROCESO Capitulo;
     nHay = 0;
     |BUCLE gopre002;
     |SI nHay = 0;
          |MENAV "0000No existe capitulo en el presupuesto...";
          |ERROR;
     |FINSI;
|FPRC;

|PROCESO Presupuesto;
     nHay = 0;
     |BUCLE gomantl1;
     |SI nHay = 0;
          |MENAV "0000Este presupuesto no pertenece al expediente...";
          |ERROR;
     |FINSI;
|FPRC;
*******************************************************************
|PROCESO Cab;
     |ABRE #24;
     #24#0 = #0#2;
     |LEE 000#24=;
     |CIERRA #24;

     |ABRE #25;
     #25#0 = #24#25
     |LEE 000#25=;
     |CIERRA #25;

     #84#1 = #0#15;
     #84#3 = #0#2;
     #84#4 = #0#3;
     #84#6 = #24#25;
     #84#8 = #0#4;  ||FP
     #84#29 = #0#3;
     #84#30 = #24#8;
     #84#31 = #24#9;
     #84#33 = #24#10;
     #84#34 = #25#7;
     #84#35 = #24#4;
     #84#40 = #24#16;
     #84#60 = #24#15;
     #84#64 = #25#23;
     #84#65 = "EUR";     ||Divi
     #84#66 = 1;         ||Cambio
     #84#67 = "B";       ||Moneda Traba
     #84#68 = "EUR";     ||Moneda Base
     #84#69 = 1;         ||Cambio
     #84#88 = #24#22;
     #84#89 = #24#23;
     #84#90 = #24#24;
     aAlfa = #0#9 + "/" + #0#10;
     #84#87 = aAlfa;
|FPRC;

|PROCESO Lin;
     |ABRE #19;
     #19#0 = #0#5;
     |LEE 000#19=;
     |CIERRA #19;

     #69#20 = #84#48;
     #69#0 = #84#0;
     #69#1 = 1;
     #69#2 = #0#5;
     #69#3 = 1;
     #69#4 = #0#6;
     #69#5 = #0#7;
     #69#6 = #0#8;
     #69#26 = #0#8;
     #69#11 = #19#30;
     #69#13 = #19#2;
     #69#15 = #84#3;
     #69#16 = #25#7;
     #69#17 = #24#4;

     enForma = 1;
     eaProgVta = "agifa084";
     |HAZ AcumulaFC;
     #69#14 = enCoste;
     |HAZ TotalLin69;
     |GRABA 020#69n;
|FPRC;

|PROCESO CreaFac;
     |SI #142#26 = "S";
          |ABRE #134;
          #134#49 = #0#0;
          #134#0 = #0#1;
          |LEE 000#134=;
          |SI FSalida = 0;
               |MENAV "0000No se crea la factura, ya existe...";
               |ERROR; |ACABA;
          |FINSI;
          |CIERRA #134;
     |FINSI;

     |ABRE #84;
     |ABRE #69;
     #84#48 = #0#0;
     #84#0 = #0#1;
     |GRABA 000#84b;
     |SI FSalida ! 0;
          |MENAV "0000No se crea la factura, ya existe...";
          |ERROR; |ACABA;
     |FINSI;
     |HAZ Cab;
     aDivisa = #84#65;
     aMoneda = #84#67;
     |HAZ Divisas010;
     |HAZ Lin;
     |HAZ LimCabAgifa084;
     |BUCLELIN 0 CalCabAgifa084 #84;
     |GRABA 020#84a;
     |CIERRA #69;
     |CIERRA #84;

     |CONFI "0000SImprimir Factura...";
     |SI FSalida = 0;
          serie = #0#0;
          numero = #0#1;
          |SUB_EJECUTA_NP "agifa086";
     |FINSI;
|FPRC;

|PROCESO BorrLin;
     enForma = -1;
     eaProgVta = "agifa084";
     |HAZ AcumulaFC;
     |BORRA 020#69a;
|FPRC;

|PROCESO BorrFac;
     |ABRE #84;
     #84#48 = #0#0;
     #84#0 = #0#1;
     |LEE 101#84=;
     |SI FSalida = 0;
          |SI #84#39 = "S";
               |MENAV "0000Factura Contabilizada";
               |ERROR; |ACABA;
          |SINO;
               |SI #142#47 = "S"; |Y #84#10 = "S";
                    |AVISO;
                    |CONFI "0000NDesea dejar la factura como NO impresa y anular los recibos?  ";
                    |SI FSalida ! 0; nSwFlag = 1; |ERROR; |ACABA; |FINSI;

                    eaProg = "agifa084";
                    |HAZ MiraRecVenta;
                    |SI enErrCarte ! 0;
                         |MENAV "0000Recibos con movimientos: NO SE DARA DE BAJA";
                         nSwFlag = 1; |ERROR; |ACABA;
                    |FINSI;

                    eaProg = "agifa084"; |HAZ BorraRecVenta;
               |FINSI;
               |BUCLELIN 0 BorrLin #84;
               |BORRA 020#84a;
          |FINSI;
     |FINSI;
     |CIERRA #84;
|FPRC;

|PROCESO Tipo1; |TIPO 1;
      nSwFlag = 0;
|FPRC;

|PROCESO Tipo2; |TIPO 2;
     nForma = 0 +. 1;
     nModo = (FEntrada / 100) ! 0;

     |SI nModo = 1; nSwFlag = 0; |FINSI;
     |SI nSwFlag = 1; |ACABA; |FINSI;

     |ABRE #142; |LEE 000#142p; |CIERRA #142;

     |SI nForma = 1;
          |HAZ CreaFac;
     |SINO;
          |CONFI "0000NBorrar Factura";
          |SI FSalida = 0;
               |HAZ BorrFac;
          |SINO;
               nSwFlag = 1;
               |ERROR;
          |FINSI;
     |FINSI;
|FPRC;


|PROCESO CheqFac;
     |ABRE #142; |LEE 000#142p; |CIERRA #142;

     |SI #142#26 = "S";
          |ABRE #134;
          #134#49 = #0#0;
          #134#0 = #0#1;
          |LEE 000#134=;
          |SI FSalida = 0;
               |MENAV "0000Ya existe la factura de ventas...";
               |ERROR; |ACABA;
          |FINSI;
          |CIERRA #134;
     |FINSI;

     |ABRE #84;
     #84#48 = #0#0;
     #84#0 = #0#1;
     |LEE 000#84=;
     |SI FSalida = 0;
          |MENAV "0000Ya existe la factura directa...";
          |ERROR; |ACABA;
     |FINSI;
     |CIERRA #84;
|FPRC;

|PROCESO Tipo13; |TIPO 13;
     |ABRE #100; |LEE 000#100p; |CIERRA #100;
     |SI #100#141 = "O";
          |PINTA 1704, "O.T.........:"; |ATRI 0;
          |PINTA 1804, "O.E.........:"; |ATRI 0;
     |FINSI;
|FPRC;
