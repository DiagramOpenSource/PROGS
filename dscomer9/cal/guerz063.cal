|FICHEROS;
     guerz063 #0;

     gopre001 #1;
     gopre002 #2;
     gopre003 #3;
     gopre004 #4;
     godeprec #5;
     godeprel #6;
     gomedici #8;
     goparame #9;

     agifa019 #19;  || Articulo
     agifa060 #60;  || Familias
     agifa120 #120; || Subfamilias
     agifa553 #553; || Linea
     agifa048 #480; || Escan C
     agifa049 #49;  || Escan L
     goartive #100; || Partida C
     goartdes #101; || Partica L
     gofamive #102; || Familia IVE
     gosubive #103; || Subfamilias IVE
     goapaive #104; || Capitulos IVE
     godeivec #105; || Des. Ampliada Cab
     godeivel #106; || Des. Ampliada Lin
     gosecive #107; || Seccion
|FIN;

|VARIABLES;
     aDesTipo = "";
     nLinAmpliParti = 0;
     aMedida = "";
     aSerie = "";
     nPresu = 0;
     aTipo = "";
     aCod = "";
     aDes = "";
     nImp = 0;
     nLin = 0;

     aRuta = "";
     aAlfa = "";
     nBoton = 0;

     &Tempo = "";

     &aIveCodigoSerie = "";
     &aIveCodigoPresupuesto = "";
     &aIveMoneda = "EUR";
     &eaFicCype = "";
     &eaTemp1 = "";
     &eaTemp2 = "";
     &eaTemp3 = "";
     &eaTemp4 = "";
     &eaTemp5 = "";
     &eaTemp6 = "";
     &eaTemp8 = "";
     aCodSec = "";
     aDesSec = "";
     aCodSub = "";
     aDesSub = "";
     aCodFam = "";
     aDesFam = "";
     aCodCap = "";
     aDesCap = "";
|FIN;

|PROCESO GrabaTipos;
     |DDEFECTO #553;
     #553#0 = aCodSec;
     |LEE 101#553=;
     |SI FSalida ! 0; |GRABA 020#553b; |FINSI;
     #553#1 = aDesSec;
     |GRABA 020#553a;
     |LIBERA #553;

     |DDEFECTO #107;
     #107#0 = aCodSec;
     |LEE 101#107=;
     |SI FSalida ! 0; |GRABA 020#107b; |FINSI;
     #107#1 = aDesSec;
     |GRABA 020#107a;
     |LIBERA #107;

     |DDEFECTO #60;
     #60#0 = aCodFam;
     |LEE 101#60=;
     |SI FSalida ! 0; |GRABA 020#60b; |FINSI;
     #60#1 = aDesFam;
     |GRABA 020#60a;
     |LIBERA #60;

     |DDEFECTO #102;
     #102#0 = aCodFam;
     |LEE 101#102=;
     |SI FSalida ! 0; |GRABA 020#102b; |FINSI;
     #102#1 = aDesFam;
     #102#2 = aCodSec;
     #102#3 = aDesSec;
     |GRABA 020#102a;
     |LIBERA #102;

     |DDEFECTO #120;
     #120#0 = aCodFam;
     |LEE 101#120=;
     |SI FSalida ! 0; |GRABA 020#120b; |FINSI;
     #120#1 = aDesFam;
     |GRABA 020#120a;
     |LIBERA #120;

     |DDEFECTO #103;
     #103#0 = aCodSub;
     |LEE 101#103=;
     |SI FSalida ! 0; |GRABA 020#103b; |FINSI;
     #103#1 = aDesSub;
     #103#2 = aCodFam;
     #103#3 = aDesFam;
     |GRABA 020#103a;
     |LIBERA #103;

     |DDEFECTO #104;
     #104#0 = aCodCap;
     |LEE 101#104=;
     |SI FSalida ! 0; |GRABA 020#104b; |FINSI;
     #104#1 = aCodCap;
     #104#2 = aCodSub;
     #104#3 = aDesSub;
     |GRABA 020#104a;
     |LIBERA #104;
|FPRC;

|PROCESO TiposValidos;
     aCodSec = "";
     aDesSec = "";
     aCodFam = "";
     aDesFam = "";
     aCodSub = "";
     aDesSub = "";
     aCodCap = "";
     aDesCap = "";
     |SI aAlfa = "T";
          aCodSec = "T";
          aDesSec = "MATERIALES";
          aCodFam = aCodSec;
          aDesFam = aDesSec;
          aCodSub = aCod % 103;
          aDesSub = #2#13;
          aCodCap = aCodSub;
          aDesCap = aDesSub;
     |FINSI;
     |SI aAlfa = "U";
          aCodSec = "U";
          aDesSec = "UNITARIOS";
          aCodFam = aCodSec;
          aDesFam = aDesSec;
          aCodSub = aCod % 103;
          aDesSub = #2#13;
          aCodCap = aCodSub;
          aDesCap = aDesSub;
     |FINSI;
     |SI aAlfa = "A";
          aCodSec = "U";
          aDesSec = "UNITARIOS";
          aCodFam = aCodSec;
          aDesFam = aDesSec;
     |FINSI;
     |SI aAlfa = "O";
          aCodSec = "O";
          aDesSec = "MANO DE OBRA";
          aCodFam = aCodSec;
          aDesFam = aDesSec;
     |FINSI;
     |SI aAlfa = "Q";
          aCodSec = "O";
          aDesSec = "MAQUINARIA";
          aCodFam = aCodSec;
          aDesFam = aDesSec;
     |FINSI;
|FPRC;

|PROCESO DesTipo;
     aDesTipo = "";
     aAlfa = #100#0 % 101;
     aAlfa = aAlfa + "  ";
     |SI aAlfa = #9#5; aDesTipo = #9#9; |FINSI;
     |SI aAlfa = #9#6; aDesTipo = #9#10; |FINSI;
     |SI aAlfa = #9#7; aDesTipo = #9#11; |FINSI;
     |SI aAlfa = #9#8; aDesTipo = #9#12; |FINSI;
     |SI aAlfa = #9#25; aDesTipo = #9#26; |FINSI;
     |SI aAlfa = #9#47; aDesTipo = #9#48; |FINSI;
     #100#6 = aAlfa;
     #100#16 = aDesTipo;
|FPRC;

|PROCESO ProcesaArti;
     aAlfa = aCod % 101;
     |SI aAlfa = "O"; |O aAlfa = "Q"; |O aAlfa = "T"; |O aAlfa = "A";
               |O aAlfa = "U";
          |DDEFECTO #19;
          #19#0 = aCod;
          |LEE 101#19=;
          |SI FSalida ! 0; |GRABA 020#19b; |FINSI;
          #19#1 = aDes;
          #19#18 = nImp;
          #19#125 = aCod % 101;
          #19#2 = aCod % 102;
          #19#3 = aCod % 103;
          #19#5 = aMedida;
          #19#127 = aCod % 104;
          #19#126 = aCod % 101;
          |GRABA 020#19a
          |LIBERA #19;
     |FINSI;

     |SI aTipo ! "A"; |ACABA; |FINSI;
     aAlfa = #3#4 % 101;
     |SI aAlfa = "A";
          #49#2 = aCod;
          #49#0 = #3#4;
          |SELECT #2#49;
          |LEE 101#49=;
          |SI FSalida ! 0;
               |SELECT #1#49;
               #49#0 = #3#4;
               #49#1 = 999;
               |LEE 000#49];
               |SI FSalida = 0;
                    |LEE 000#49a;
               |SINO;
                    |LEE 000#49u;
               |FINSI;
               |SI FSalida = 0; |Y #49#0 = #3#4;
                    nLin = #49#1 + 1;
               |SINO;
                    nLin = 1;
               |FINSI;
               |DDEFECTO #49;
               #49#0 = #3#4;
               #49#1 = nLin;
               #49#2 = aCod;
               #49#3 = aDes;
               #49#4 = #4#8;
               |GRABA 020#49n;
          |FINSI;
     |FINSI;
     |SI aAlfa = "U";
          |DDEFECTO #100;
          #100#0 = #3#4;
          |LEE 101#100=;
          |SI FSalida = 0;
               #100#4 = "S";
               |HAZ DesTipo;
               |GRABA 020#100a;
               |LIBERA #100;
          |FINSI;

          |DDEFECTO #101;
          #101#0 = #3#4;
          #101#2 = aCod;
          |SELECT #3#101;
          |LEE 101#101=;
          |SI FSalida ! 0;
               |SELECT #1#101;
               #101#0 = #3#4;
               #101#1 = 999;
               |LEE 000#101];
               |SI FSalida = 0;
                    |LEE 000#101a;
               |SINO;
                    |LEE 000#101u;
               |FINSI;
               |SI FSalida = 0; |Y #101#0 = #3#4;
                    nLin = #101#1 + 1;
               |SINO;
                    nLin = 1;
               |FINSI;
               |DDEFECTO #101;
               #101#0 = #3#4;
               #101#1 = nLin;
               |GRABA 020#101b;
          |SINO;
               nLin = #101#1;
          |FINSI;
          #101#2 = aCod;
          #101#3 = aDes;
          #101#5 = #4#8;
          #101#6 = #4#9;
          #101#7 = #4#11;
          aAlfa = #101#2 % 101;
          |SI aAlfa = "%"; aAlfa = ""; |FINSI;
          #101#8 = aAlfa;
          |GRABA 020#101a;
          |LIBERA #101;
     |FINSI;
|FPRC;

|PROCESO gopre004; || Arti
     aCod = #4#5;
     aDes = #4#6;
     nImp = #4#11;
     aTipo = "A";
     aMedida = #4#7;
     |HAZ ProcesaArti;
|FPRC;

|DEFBUCLE gopre004;
     #4#1;
     ;
     #3#0, #3#1, #3#2, #3#4, 001;
     #3#0, #3#1, #3#2, #3#4, 999;
     ;
     NULL, gopre004;
|FIN;

|PROCESO DesAmpliParti;
     nLinAmpliParti = nLinAmpliParti + 1;
     |DDEFECTO #106;
     #106#0 = aCod;
     #106#1 = nLinAmpliParti;
     |LEE 101#106=;
     |SI FSalida ! 0; |GRABA 020#106b; |FINSI;
     #106#2 = #6#4;
     |GRABA 020#106a;
     |LIBERA #106;
|FPRC;

|DEFBUCLE DesAmpliParti;
     #6#1;
     ;
     #3#4, #3#0, #3#1, #3#2, 001;
     #3#4, #3#0, #3#1, #3#2, 999;
     ;
     NULL, DesAmpliParti;
|FIN;

|PROCESO gopre003; || Parti
     aCod = #3#4;
     aDes = #3#5;
     nImp = #3#10;
     aTipo = "P";
     aMedida = #3#6;

     aAlfa = aCod % 101;
     |HAZ TiposValidos;

     |SI aAlfa = "A";
          |DDEFECTO #480;
          #480#0 = aCod;
          |LEE 101#480=;
          |SI FSalida ! 0; |GRABA 020#480b; |FINSI;
          #480#1 = aDes;
          |GRABA 020#480a;
          |LIBERA #480;
     |FINSI;
     |SI aAlfa = "U";
          |DDEFECTO #100;
          #100#0 = aCod;
          |LEE 101#100=;
          |SI FSalida ! 0; |GRABA 020#100b; |FINSI;
          #100#1 = aDes;
          #100#2 = aMedida;
          #100#7 = aCodSec;
          #100#9 = aCodFam;
          #100#11 = aCodSub;
          #100#13 = aCodCap;
          #100#8 = aDesSec;
          #100#10 = aDesFam;
          #100#12 = aDesSub;
          #100#14 = aDesCap;
          |HAZ DesTipo;
          |GRABA 020#100a;
          |LIBERA #100;
          nLinAmpliParti = 0;
          |BUCLE DesAmpliParti;
          |SI nLinAmpliParti ! 0;
               |DDEFECTO #105;
               #105#0 = aCod;
               |LEE 010#105=;
               |SI FSalida ! 0; |GRABA 020#105b; |FINSI;
               #105#1 = aDes;
               #105#2 = aCod;
               |GRABA 020#105a;
               |LIBERA #105;
          |FINSI;
     |FINSI;

     |SI aAlfa = "O"; |O aAlfa = "Q"; |O aAlfa = "T"; |O aAlfa = "A";
               |O aAlfa = "U";
          |HAZ GrabaTipos;
     |FINSI;
     |HAZ ProcesaArti;
     |BUCLE gopre004;
|FPRC;

|DEFBUCLE gopre003;
     #3#1;
     ;
     #2#0, #2#1, #2#12, 001;
     #2#0, #2#1, #2#12, 999;
     ;
     NULL, gopre003;
|FIN;

|PROCESO gopre002; ||Capi
     aCod = #2#12;
     aDes = #2#13;
     nImp = #2#7;
     aMedida = #2#5;

     aAlfa = aCod % 101;
     |HAZ TiposValidos;

     |SI aAlfa = "O"; |O aAlfa = "Q"; |O aAlfa = "T"; |O aAlfa = "A";
               |O aAlfa = "U";
          |HAZ GrabaTipos;
     |FINSI;
     |BUCLE gopre003;
|FPRC;

|DEFBUCLE gopre002;
     #2#1;
     ;
     aSerie, nPresu, 001;
     aSerie, nPresu, 999;
     ;
     NULL, gopre002;
|FIN;

|PROCESO Importacion;
     |ABRE #19;
     |ABRE #553;
     |ABRE #107;
     |ABRE #480;
     |ABRE #49;
     |ABRE #100;
     |ABRE #101;
     |ABRE #60;
     |ABRE #120;
     |ABRE #102;
     |ABRE #103;
     |ABRE #104;
     |ABRE #105;
     |ABRE #106;
     |BUCLE gopre002;
     |CIERRA #106;
     |CIERRA #105;
     |CIERRA #104;
     |CIERRA #103;
     |CIERRA #102;
     |CIERRA #120;
     |CIERRA #60;
     |CIERRA #101;
     |CIERRA #100;
     |CIERRA #49;
     |CIERRA #480;
     |CIERRA #107;
     |CIERRA #553;
     |CIERRA #19;
|FPRC;

|PROCESO Tipo3; |TIPO 3;
     |SI #0#2 ! "SI";
          |ACABA;
     |FINSI;

     |HAZ CreaTempo; eaTemp1 = Tempo; |NOME_DAT #1 Tempo; |DELINDEX #1;
     |HAZ CreaTempo; eaTemp2 = Tempo; |NOME_DAT #2 Tempo; |DELINDEX #2;
     |HAZ CreaTempo; eaTemp3 = Tempo; |NOME_DAT #3 Tempo; |DELINDEX #3;
     |HAZ CreaTempo; eaTemp4 = Tempo; |NOME_DAT #4 Tempo; |DELINDEX #4;
     |HAZ CreaTempo; eaTemp5 = Tempo; |NOME_DAT #5 Tempo; |DELINDEX #5;
     |HAZ CreaTempo; eaTemp6 = Tempo; |NOME_DAT #6 Tempo; |DELINDEX #6;
     |HAZ CreaTempo; eaTemp8 = Tempo; |NOME_DAT #8 Tempo; |DELINDEX #8;

     || Nos apoyamos en la importacion BC3 que ya existe
     aIveCodigoSerie = "";
     aIveCodigoPresupuesto = 3;
     aIveMoneda = "EUR";
     eaFicCype = #0#1; |QBF eaFicCype;
     |SUB_EJECUTA_NP "gopreivi.tab";

     || Ahora lo cargamos desde el  presupuesto
     nPresu = aIveCodigoPresupuesto;
     aSerie = aIveCodigoSerie;
     |HAZ Importacion;

     |DELINDEX #1; Tempo = eaTemp1; |HAZ BoraTempo;
     |DELINDEX #2; Tempo = eaTemp2; |HAZ BoraTempo;
     |DELINDEX #3; Tempo = eaTemp3; |HAZ BoraTempo;
     |DELINDEX #4; Tempo = eaTemp4; |HAZ BoraTempo;
     |DELINDEX #5; Tempo = eaTemp5; |HAZ BoraTempo;
     |DELINDEX #6; Tempo = eaTemp6; |HAZ BoraTempo;
     |DELINDEX #8; Tempo = eaTemp8; |HAZ BoraTempo;
|FPRC;

|PROCESO Desactiva; |TIPO 0;
     |ESTADO_CONTROL nBoton, "DISABLE";
|FPRC;

|PROCESO Activa; |TIPO 7;
     |ESTADO_CONTROL nBoton, "ENABLE";
|FPRC;

|PROCESO Boton;
     |PTEC 824; ||F2
|FPRC;

|PROCESO Browse; |TIPO 0;
     |SI FSalida ! 10; |ACABA; |FINSI;

     |ESTADO_CONTROL nBoton, "DISABLE";
     |PUSHV 0501 2380;
     aRuta = #0#1;  |QBF aRuta;
     |SI aRuta = ""; aRuta = "\*.*"; |FINSI;
     aRuta = "F" + aRuta;
     |BROWSE aRuta; |QBF aRuta;
     |POPV;
     |ESTADO_CONTROL nBoton, "ENABLE";
     #0#1 = aRuta % 280; |PINTA #0#1;
     aRuta = #0#1; |QBF aRuta;
     |SI aRuta = ""; |ERROR; |FINSI;
|FPRC;

|PROCESO Tipo9;
     |FIN_CONTROL_WINDOWS nBoton;
     |PULSATECLA;
|FPRC;

|PROCESO Tipo8;
     |CONTROL_SIMPLE 0, "BOTON, Fichero", 1116, 1123, Boton;
     nBoton = FSalida;
     |ESTADO_CONTROL nBoton, "DISABLE";
     |PULSATECLA;
|FPRC;

|PROGRAMA;
     |ABRE #9; |LEE 000#9p; |CIERRA #9;
     |ABRE #0;
     |LEE 101#0p;
     |SI FSalida ! 0; |GRABA 020#0b; |FINSI;
     |CLS;
     |PINPA #0#0;
     |PINDA #0#0;
     |HAZ Tipo8;
     |ENDATOS #1#0;
     |SI FSalida = 0;
          #0#2 = "NO";
          |GRABA 020#0a;
     |FINSI;
     |HAZ Tipo9;
     |CIERRA #0;
|FPRO;
