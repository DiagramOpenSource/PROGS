|FICHEROS;
     bogew004 #0; ||Este

     bogem003 #3,MANTE; || Pedido Compra
     bogem005 #5,MANTE; || Confirma Recogica C
     bogem006 #6,MANTE; || Confirma Recogida L
     bogem007 #7,MANTE; || Pedido Venta C
     bogem009 #9,MANTE;  || Confirma Entrega C
     bogem010 #10,MANTE; || Confirma Entrega L
     bogem011 #11,MANTE; || Orden Salida C
     bogem012 #12,MANTE; || Orden Salida L
     bogem013 #13,MANTE; ||Control Calidad
     bogem015 #15,MANTE;  ||Orden Entrada Camara
     bogem016 #16,MANTE;  ||Orden Entrada Camara L
     bogew017 #17,MANTE;  ||Tmp Adj. recogida
     bogew018 #18,MANTE;  ||Tmp Adj. recogida L
     bogew019 #19,MANTE;  ||Tmp Adj. recogida LL

     bogem020 #20,MANTE;  ||Compra (principal)
     bogem021 #21;        ||Venta (lineal principal)
     bogem023 #23,MANTE;  ||Pedido compra linea
     bogem024 #24,MANTE;  ||Albaran compra
     bogem025 #25,MANTE;  ||Albaran compra lin
     bogem026 #26,MANTE;  ||Pedido Venta lin
     bogem030 #30;

     bogem028 #28;
     bogez006 #60,MANTE;  ||Tmp seleccion (PRINCIPAL)

     bogew005 #50,MANTE;  ||Linea confirma recogida
     bogew007 #52,MANTE;  ||Tmp Marca confirma recogida
     bogew008 #53,MANTE;  ||Tmp Orden Entrada camara
     bogew009 #54,MANTE;  ||Tmp confirma entrega
     bogew012 #57,MANTE;  ||Tmp Pedido Ventas
     bogew014 #59,MANTE;  ||Tmp selec confirma recge/entrega
     bogew015 #70,MANTE;  ||Linea pedidos compras
     bogew006 #71,MANTE;  ||Linea albaranes compras

     bogem020@;
     bogez006@;

     agifa019 #19;
     agifa220 #220;
     agifa025 #225;
     agifa112 #112;

     agifa077 #77;
     agifa010 #210;
     agifa104 #104;
     agifa142 #142;
     agifa321 #321;
     agifa060 #600;

     bogem006@;
|FIN;

|INCLUYE i_varart;

|VARIABLES;
     nPend = 0;
     &enReferencia = 0;
     nKilos = 0;
     nCoste = 0;
     nVenta = 0;
     nHayCom = 0;
     nHayVta = 0;
     nSwPedido = 0;
     nSwAdj = 0;
     nPrimeRec = 0;
     nPrimeLin = 0;
     &enMenuAuto = 0;
     nPenCaja = 0;
     nPenPale = 0;
     &eaNueva = "";
     &eaBorCab = "";
     nRefresca = 0;
     aNuevo = "";
     aSirviendo = "";
     nPrime = 0;
     aConRecoge = "";
     nLinea = 0;
     nPen = 0;
     nUltNumero = 0;
     nSwCheq = 0;
     nHayLin = 0;
     nTotAlCos = 0;
     nTotAlKgs = 0;
     nTotTrCos = 0;
     nTotTrKgs = 0;
     nKilosPed = 0;
     nTotalPed = 0;
     nSwConsulta = 0;
     nSwAlba = 0;
     nHayReg = 0;
     nTotKgVta = 0;
     nTotImVta = 0;
     nTotTrVta = 0;
     &enRefPedido = 0;
     nSwEligePedi = 0;
     nPedido = 0;
     &eaCodigo = "";
     &eaNombre = "";
     &enEntrega = 0;
     nSwMarcaUna = 0;
     &eaNom = "";
     nLin = 0;
     nRecogida = 0;
     aGuarda = "";
     nKgs = 0;
     nImp = 0;
     nPor = 0;
     nHay = 0;
     nDesde = 0;
     aTmp71 = "";
     aTmp70 = "";
     aTmp50 = "";
     aTmp51 = "";
     aTmp52 = "";
     aTmp53 = "";
     aTmp54 = "";
     aTmp55 = "";
     aTmp56 = "";
     aTmp57 = "";
     aTmp58 = "";
     aTmp59 = "";
     aTmp61 = "";
     aTmp6 = "";
     aCampos = "";
     aDef = "";
     &eaTransporte = "";
     aReg = "";
     &eaTmp60 = "";
     &Tempo = "";
     &enHayAmpli = 0;
     &eaRegistro = "";
     aInfEntCam = "bentcana";
     aInfCompra = "bcompras";
     &aDivisa = "";
     &aMoneda = "";
     &ser_ped = "";
     &num_ped = 0;

     &eaReferen = "";
     &eaSerPedi = "";
     &enNumPedi = 0;
     &eaSerAlba = "";
     &enNumAlba = 0;
     &eaSerFact = "";
     &enNumFact = 0;
     aBorra13 = "";
     aEstado = "";
     &eaMovimi = "";
     aA¤o = "";
     fDoc = @;
     nJueves = 0;
     nModoCali = 0;
     aGraba13 = "";
     aDia = "";
     f = @;
     f1 = @;
     nDia = 0;
     nMes = 0;
     nSemana = 1;
     nNume = 0;
     fFecha = @;
     nTecla = 0;
     aGraba = "S";
     aBorCab = "";
     &enSwMenu = 0;
  {-1}aMenu = "";
     aMenu1 = "2400";
     aMenu2 = "1";
     aMenu3 = "";
     aMenu4 = "MBI";
     aMenu5 = " Modificacion ";
     aMenu6 = " Baja ";
     aMenu7 = " Imprimir ";

  {-1}aMenua = "";
     aMenua1 = "2400";
     aMenua2 = "1";
     aMenua3 = "";
     aMenua4 = "AC";
     aMenua5 = " Alta ";
     aMenua6 = " Consulta ";

  {-1}aMenub = "";
     aMenub1 = "2400";
     aMenub2 = "1";
     aMenub3 = "";
     aMenub4 = "ABMIC";
     aMenub5 = " Alta ";
     aMenub6 = " Baja ";
     aMenub7 = " Modificacion ";
     aMenub8 = " Imprimir ";
     aMenub9 = " Consulta ";

  {-1}aMenuc = "";
     aMenuc1 = "2400";
     aMenuc2 = "1";
     aMenuc3 = "";
     aMenuc4 = "MBLI";
     aMenuc5 = " Modificacion ";
     aMenuc6 = " Baja ";
     aMenuc7 = " Lineas ";
     aMenuc8 = " Imprimir ";

     aNueva = "";
     aAlfa = "";
     i = 0;
     nSal = 0;
     nModo = 0;
     nError = 0;
     nForma = 0;
     &nBoton2 = 0;
     &nBoton3 = 0;
     &nBoton4 = 0;
     &nBoton5 = 0;
     &nBoton6 = 0;
     &nBoton7 = 0;
     &nBoton8 = 0;
     &nBoton9 = 0;
     &nBoton10 = 0;

     nImpo = 0;

     fiac      = "  ";
     guarda    = "  ";
     relleno   = "                                       ";
     aponer    = "  ";
     aTmp18 = "";
     aTmp19 = "";
|FIN;

|RUTINA ImpConRec;
     enReferencia = #60#0;
     |SUB_EJECUTA_NP "bogew002;RECOGE";
|FRUT;

|RUTINA ImpConEnt;
     enReferencia = #60#0;
     |SUB_EJECUTA_NP "bogew002;ENTREGA";
|FRUT;

|PROCESO ImpEntCam;
     |PRINT;
     nHayLin = 1;
|FPRC;

|DEFBUCLE ImpEntCam;
     #16#1;
     ;
     #15#0, #15#24, 001;
     #15#0, #15#24, 999;
     ;
     NULL, ImpEntCam;
|FIN;

|PROCESO ImpEntCamara;
     Impresora = "Crystal Reports";
     |IMPRE 0;
     |SI FSalida = 0;
          aInfEntCam = #30#3; |QBF aInfEntCam;
          |INFOR aInfEntCam;
          |SI FSalida ! 0;
               aAlfa = "0000Error en informe:" + aInfEntCam;
               |MENAV aAlfa;
          |SINO;
               nHayLin = 0;
               |BUCLE ImpEntCam;
               |SI nHayLin = 0;
                    |DDEFECTO #16;
                    |PRINT;
               |FINSI;
               |PIEINF;
               |FININF;
          |FINSI;
          |FINIMP;
     |FINSI;
|FPRC;

|PROCESO Tipo12; |TIPO 12;
|FPRC;

|RUTINA poncontrC;
     fiac = Control % A109;
     fiac = fiac + relleno;
     guarda = fiac % A109;
     fiac = Control % A1001;
     Control = Control + fiac;
     Control = Control + relleno;
     Control = Control % A120;
     Control = Control + aponer;
|FRUT;

----------------------------------------------
|PROCESO TmpConRecogeLin;
     |SI nPrimeLin = 0; nPrimeLin = #59#2; |FINSI;
     |SI nSwAlba = 1;
          nNume = #6#6 - #6#12;
     |SINO;
          nNume = #6#6 - #6#13;
     |FINSI;
     |SI nNume > 0;
          |DDEFECTO #59;
          |PARA i = 0; |SI i [ 12; |HACIENDO i = i + 1;
               #59i = #6i;
          |SIGUE;
          #59#6 = nNume;
          #59#14 = #5#35;
          #59#15 = #6#14;
          #59#16 = #6#15;
          #59#17 = #6#16;
          |GRABA 020#59n;
          nHay = 1;
     |FINSI;
|FPRC;

|PROCESO IniTmpRecoge;
      nPrimeLin = 0;
      nPrimeRec = 0;
|FPRC;

|DEFBUCLE TmpConRecogeLin;
     #6#1;
     ;
     #5#0, #5#25, 001;
     #5#0, #5#25, 999;
     ;
     NULL, TmpConRecogeLin;
|FIN;

|PROCESO TmpConRecoge;
     |SI nPrimeRec = 0; nPrimeRec = #5#25; |FINSI;
     nHay = 0;
     |BUCLE TmpConRecogeLin;
     |SI nHay ! 0;
          |DDEFECTO #52;
          |PARA i = 0; |SI i [ 31; |HACIENDO i = i + 1;
               #52i = #5i;
          |SIGUE;
          |GRABA 020#52n;
          nHayReg = 1;
     |FINSI;
|FPRC;

|DEFBUCLE TmpConRecoge;
     #5#1;
     ;
     #20#0, 000001;
     #20#0, 999999;
     ;
     IniTmpRecoge, TmpConRecoge;
|FIN;

|PROCESO Min52;
     #52#0 = #20#0;
     #52#25 = 1;
|FPRC;

|PROCESO Max52;
     #52#0 = #20#0;
     #52#25 = 999999;
|FPRC;

|PROCESO EligeRecogida;
     nRecogida = 0;
     |PUSHV 0501 2380;
     |ABRE #5;
     #5#0 = #20#0;
     #5#25 = 0;
     |LEE 000#5];
     |SI FSalida = 0; |Y #5#0 = #20#0;
          |ABRE #52;
          |ABRE #59;
          nHayReg = 0;
          |BUCLE TmpConRecoge;
          |CIERRA #59;
          |CIERRA #52;
          |SI nHayReg = 0;
               |MENAV "0000No quedan confirmaciones pendientes de asignar...";
          |SINO;
               |PINPA #0#52;
               |PINTA 714, #5#0;
               |ENTLINEAL #1#52, 2, 4, 22, 0, Min52, Max52;
          |FINSI;
     |SINO;
          |||MENAV "0000No existen confirmaciones de recogida";
     |FINSI;
     |CIERRA #5;
     |POPV;
|FPRC;
----------------------------------------------
---------------------------------------------- bogem020
|PROCESO MontaDiaSema; |TIPO 0;
     aAlfa = (("00" + #20#3) % -102) + "." + (("00" + #20#4) % -102) + "." + aA¤o;
     fFecha = aAlfa;
     fFecha = fFecha % A1;
     aAlfa = fFecha % 1102;
     aAlfa = aAlfa > "";
     |SI aAlfa = "MI";
          #20#2 = "X";
     |SINO;
          aAlfa = fFecha % 1101;
          #20#2 = aAlfa;  || Dia de la semana
     |FINSI;
     |PINTA #20#2;
|FPRC;

|PROCESO AsignaSemana; |TIPO 0;
     fDoc = fFecha;
     |HAZ CalculaSemana;
     #20#30 = nSemana; |PINTA #20#30;
|FPRC;
---------------------------------------------- bogem009
|PROCESO Minb7;
     #7#0 = #9#0;
     #7#19 = 001;
|FPRC;

|PROCESO Maxb7;
     #7#0 = #9#0;
     #7#19 = 999;
|FPRC;

|PROCESO Minb26;
     #26#0 = #9#0;
     #26#1 = #9#35;
     #26#2 = 001;
|FPRC;

|PROCESO Maxb26;
     #26#0 = #9#0;
     #26#1 = #9#35;
     #26#2 = 999;
|FPRC;

|PROCESO Consulta9; |TIPO 66;
     |SI Campo = 35;
          |ABRE #7;
          #7#0 = #9#0;
          #7#19 = #9#35;
          |LEE 000#7];
          |CONSULTA_F_CLAVE #1#7, Minb7, Maxb7;
          |SI FSalida = 0;
               #9#35 = #7#19; |PINTA #9#35;
          |SINO;
               |ERROR;
          |FINSI;
          |CIERRA #7;
     |SINO;
          |ABRE #26;
          #26#0 = #9#0;
          #26#1 = #9#35;
          #26#2 = #9#36;
          |LEE 000#26];
          |CONSULTA_F_CLAVE #1#26, Minb26, Maxb26;
          |SI FSalida = 0;
               #9#36 = #26#1; |PINTA #9#36;
          |SINO;
               |ERROR;
          |FINSI;
          |CIERRA #26;
     |FINSI;
|FPRC;

|PROCESO CheqPenPedVta9;
     |SI #26#15 < #26#5;
          nPend = 1;
          |ERROR10;
     |FINSI;
|FPRC;

|DEFBUCLE CheqPenPedVta9;
     #26#1;
     ;
     #9#0, #9#35, #9#36;
     #9#0, #9#35, #9#36;
     ;
     NULL, CheqPenPedVta9;
|FIN;

|PROCESO Defecto9; |TIPO 0;
     nModo = (FEntrada / 100) ! 0;

     |C_M #9#36, 1, "S";
     |C_M #9#19, 1, "N";
     |C_M #9#20, 1, "N";
     |C_M #9#21, 1, "N";
     |C_M #9#22, 1, "N";
     |C_M #9#23, 1, "N";
     |C_M #9#24, 1, "N";
     |C_M #9#38, 1, "N";
     |C_M #9#39, 1, "N";
     |C_M #9#15, 1, "N";
     |C_M #9#16, 1, "N";

     |SI #9#35 = 0;
          |C_M #9#36, 1, "N";
          |C_M #9#19, 1, "S";
          |C_M #9#20, 1, "S";
          |C_M #9#21, 1, "S";
          |C_M #9#22, 1, "S";
          |C_M #9#23, 1, "S";
          |C_M #9#24, 1, "S";
          |C_M #9#38, 1, "S";
          |C_M #9#39, 1, "S";
          |SI nModo ! 1; |ACABA; |FINSI;

          |ABRE #20;
          #20#0 = #60#0;
          #20#33 = #60#9;
          |LEE 020#20=;
          |CIERRA #20;
          #9#36 = #20#33; |PINTA #9#36;
          #9#26 = #20#31; |PINTA #9#26;
          #9#15 = #20#7; |PINTA #9#15;
          #9#16 = #20#8; |PINTA #9#16;
          #9#13 = #20#9; |PINTA #9#13;
          #9#14 = #20#10; |PINTA #9#14;
          #9#19 = #20#21; |PINTA #9#19;
          #9#20 = #20#22; |PINTA #9#20;
          |ACABA;
     |FINSI;
     |SI nModo ! 1; |ACABA; |FINSI;

     |SI Campo = 35;
          |ABRE #7;
          #7#0 = #9#0;
          #7#19 = #9#35;
          |LEE 000#7=;
          |SI FSalida = 0;
               #9#2 = #7#2; |PINTA #9#2;
               #9#3 = #7#3; |PINTA #9#3;
               #9#5 = #7#5; |PINTA #9#5;
               #9#6 = #7#6; |PINTA #9#6;
               #9#7 = #7#12; |PINTA #9#7;
               #9#26 = #7#16; |PINTA #9#26;
          |SINO;
               |MENAV "0000No existe pedido ventas...";
               |ERROR;
          |FINSI;
          |CIERRA #7;
     |SINO;
          nPend = 0;
          |BUCLE CheqPenPedVta9;
          |SI nPend = 0;
               |MENAV "0000No quedan unidades pendientes de asignar...";
               |ERROR; |ACABA;
          |FINSI;
          |ABRE #26;
          #26#0 = #9#0;
          #26#1 = #9#35;
          #26#2 = #9#36;
          |LEE 000#26=;
          |SI FSalida = 0;
               |ABRE #19;
               #19#0 = #26#3;
               |LEE 000#19=;
               |CIERRA #19;
               |ABRE #600;
               #600#0 = #19#2;
               |LEE 000#600=;
               |CIERRA #600;
               #9#15 = #26#3; |PINTA #9#15;
               #9#16 = #26#4; |PINTA #9#16;
               #9#13 = #600#0; |PINTA #9#13;
               #9#14 = #600#1; |PINTA #9#14;
               #9#19 = #26#8 - #26#21; |PINTA #9#19;
               #9#20 = #26#9 - #26#22; |PINTA #9#20;
               #9#21 = #26#10; |PINTA #9#21;
               #9#22 = #26#11; |PINTA #9#22;
               #9#23 = #26#12; |PINTA #9#23;
               #9#24 = #26#13; |PINTA #9#24;
               #9#38 = #26#16; |PINTA #9#38;
               #9#39 = #26#17; |PINTA #9#39;
          |SINO;
               |MENAV "0000No existe linea pedido ventas...";
               |ERROR;
          |FINSI;
          |CIERRA #26;
     |FINSI;
|FPRC;

|PROCESO Tipo09_2; |TIPO 2;
     |ABRE #26;
     #26#0 = #9#0;
     #26#1 = #9#35;
     #26#2 = #9#36;
     |LEE 101#26=;
     |SI FSalida = 0;
          #26#21 = #26#21 +. #9#19;
          #26#22 = #26#22 +. #9#20;
          |GRABA 020#26a;
     |FINSI;
     |CIERRA #26;
|FPRC;
---------------------------------------------- bogem010
|PROCESO LlenaTmpConRec;
     |PARA i = 0; |SI i [ 16; |HACIENDO i = i + 1;
          #bogem006@#i# = #6i;
     |SIGUE;
     |GRABA 020#bogem006@.n;
|FPRC;

|DEFBUCLE LlenaTmpConRec;
     #6#1;
     ;
     #10#0, 001, 001;
     #10#0, 999, 999;
     ;
     NULL, LlenaTmpConRec;
|FIN;

|PROCESO Consulta10; |TIPO 0;
     |SI FSalida = 13;   || F5
          |DDEF aAlfa;
          aAlfa = aAlfa + "bogem006";
          |CARGA_DEF aAlfa, bogem006@;
          |SI FSalida = 0;
               |HAZ CreaTempo; aTmp6 = Tempo; |NOME_DAT #bogem006@#Tempo#;
               |DELINDEX #bogem006@;
               |ABRE #bogem006@;
               |BUCLE LlenaTmpConRec;
               |LEE 000#bogem006@.p;
               |CONSULTA_CLAVE #1#bogem006@;
               |SI FSalida = 0;
                    #10#3 = #bogem006@#3; |PINTA #10#3;
                    #10#4 = #bogem006@#4; |PINTA #10#4;
                    #10#5 = #bogem006@#5; |PINTA #10#5;
                    #10#6 = #bogem006@#6; |PINTA #10#6;
                    #10#7 = #bogem006@#7; |PINTA #10#7;
                    #10#8 = #bogem006@#8; |PINTA #10#8;
                    #10#9 = #bogem006@#9; |PINTA #10#9;
                    #10#14 = #bogem006@#14; |PINTA #10#14;
                    #10#15 = #bogem006@#15; |PINTA #10#15;
                    #10#16 = #bogem006@#16; |PINTA #10#16;
               |SINO;
                    |ERROR;
               |FINSI;
               |CIERRA #bogem006@;
               Tempo = aTmp6; |HAZ BoraTempo;
               |DELINDEX #bogem006@;
               |DESCARGA_DEF #bogem006@;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Palet10; |TIPO 0;
     |SI #10#3 ! Contenido;
          |ABRE #16;
          |SELECT #2#16;
          #16#17 = #9#28;
          #16#3 = #10#3;
          |LEE 000#16=;
          |SI FSalida = 0;
               #10#4 = #16#4; |PINTA #10#4;
               #10#14 = #16#11; |PINTA #10#14;
               #10#15 = #16#12; |PINTA #10#15;
               #10#16 = #16#13; |PINTA #10#6;
               #10#5 = #16#5; |PINTA #10#5;
               #10#6 = #16#6 - #16#15; |PINTA #10#6;
          |SINO;
               |ABRE #6;
               |SELECT #3#6;
               #6#3 = #10#3;
               |LEE 000#6=;
               |SI FSalida = 0;
                    #10#4 = #6#4; |PINTA #10#4;
                    #10#14 = #6#14; |PINTA #10#14;
                    #10#15 = #6#15; |PINTA #10#15;
                    #10#16 = #6#16; |PINTA #10#16;
                    #10#5 = #6#5; |PINTA #10#5;
                    #10#6 = #6#6; |PINTA #10#6;
               |SINO;
                    |MENAV "0000El palet no existe...";
               |FINSI;
               |CIERRA #6;
          |FINSI;
          |CIERRA #16;
          #10#8 = #10#7 * #10#6; |PINTA #10#8;
     |FINSI;
|FPRC;

|PROCESO Tipo10_2; |TIPO 2;
     #9#32 = #9#32 +. #10#6;
     #9#33 = #9#33 +. #10#8;
     #9#34 = #9#34 +. #10#9;

     |ABRE #26;
     #26#0 = #9#0;  ||Refe
     #26#1 = #9#35; ||Pedido
     #26#2 = #9#36; ||subr
     |LEE 101#26=;
     |SI FSalida = 0;
          #26#15 = #26#15 +. #10#6;
          |GRABA 020#26a;
          |LIBERA #26;
     |FINSI;
     |CIERRA #26;
|FPRC;

|PROCESO Tipo10_7; |TIPO 7;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 1;
          aAlfa = (("000000" + #10#0) % -106) + (("000000" + #10#1) % -102) + (("000" + #10#2) % -102)
          #10#3 = aAlfa; |PINTA #10#3;
          |ABRE #26;
          #26#0 = #9#0;  ||Refe
          #26#1 = #9#35; ||Pedido
          #26#2 = #9#36; ||subr
          |LEE 101#26=;
          |SI FSalida = 0;
               #10#6 = #26#5 - #26#15; |PINTA #10#6;
               #10#7 = #26#6; |PINTA #10#7;
          |FINSI;
          |CIERRA #26;
     |FINSI;
|FPRC;

|PROCESO Unidades10_0; |TIPO 0;
     nModo = (FEntrada / 100) ! 0;
     #10#8 = #10#7 * #10#6; |PINTA #10#8;
     |SI #10Campo ! Contenido; |Y Campo = 6;
          #10#9 = #9#27 / #10#6; |PINTA #10#9;
     |FINSI;

     |ABRE #26;
     #26#0 = #9#0;  ||Refe
     #26#1 = #9#35; ||Pedido
     #26#2 = #9#36; ||subr
     |LEE 101#26=;
     |SI FSalida = 0;
          #26#15 = #26#15 + #10#6;
          |SI #26#15 > #26#5;
               nNume = #26#15 - #26#5;
               aAlfa = "0000Se superan las unidades pedidas en: " + nNume;
               |MENAV aAlfa;
               |ERROR;
          |FINSI;
     |FINSI;
     |CIERRA #26;
|FPRC;
---------------------------------------------- bogem009
|PROCESO Transporte9_0; |TIPO 0;
     eaTransporte = #9#5;
     |HAZ Transporte0;
|FPRC;

|PROCESO Transporte9_66; |TIPO 66;
     eaTransporte = #9#5;
     |HAZ Transporte66;
     |SI eaTransporte = "";
          |ERROR;
     |SINO;
          #9#5 = eaTransporte;
          |PINTA #9#5;
     |FINSI;
|FPRC;
---------------------------------------------- bogew009
|PROCESO Tecla54_2; |TIPO 2;
     |SI #54#2 = 0; |O #54#3 = 0;
          |ERROR;
     |FINSI;
|FPRC;

|PROCESO Tecla54_11; |TIPO 11;
     |SI FSalida ! 1; |Y FSalida ! 7; |Y FSalida ! 0;
               |Y FSalida ! 2; |Y FSalida ! 3;
          |SI FSalida = 13;
               nSwAdj = 1; |PTEC 807;
          |SINO;
               |SI nSwAdj = 0; |ERROR; |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Tecla54_0; |TIPO 0;
     nModo = (FEntrada / 100) ! 0;
     nTecla = FSalida;

     |DDEFECTO #9;
     #9#0 = #54#0;
     #9#25 = #54#1;
     |LEE 000#9=;
     |SI FSalida ! 0; |Y nTecla = 0;
          aNueva = "S";
          |HAZ ConEnt0;
          |SI aNueva = ""; |ERROR; |FINSI;
     |SINO;
          aNueva = "N";
          |HAZ ConEnt0;
          |PTEC 809;     || Abajo
          |ERROR;
          |PONCONTROL 23, "SI";
     |FINSI;
|FPRC;
---------------------------------------------- bogew012
|PROCESO Tipo57_11; |TIPO 11;
     |SI FSalida ! 1; |Y FSalida ! 7; |Y FSalida ! 0;
               |Y FSalida ! 2; |Y FSalida ! 3;
          |ERROR;
     |FINSI;
|FPRC;

|PROCESO Tipo57_0; |TIPO 0;
     |SI nSwEligePedi = 1;
          |SI FSalida = 0; |Y #57Campo = Contenido;
               nPedido = #57#5;
               |PTEC 807;
          |FINSI;
          |ACABA;
     |FINSI;

     nModo = (FEntrada / 100) ! 0;
     nTecla = FSalida;
     #7#0 = #57#0;
     #7#19 = #57#5;
     |LEE 000#7=;
     |SI FSalida ! 0; |Y nTecla = 0;
          aNueva = "S";
          |HAZ PedVta0;
          |SI aNueva = ""; |ERROR; |FINSI;
     |SINO;
          aNueva = "N";
          |HAZ PedVta0;
          |PTEC 809;     || Abajo
          |ERROR;
          |PONCONTROL 23, "SI";
     |FINSI;
|FPRC;
---------------------------------------------- bogem026
|PROCESO Tipo3_26; |TIPO 3;
     |ABRE #20;
     #20#0 = #26#0;
     #20#33 = #26#2;
     |LEE 101#20=;
     |SI FSalida ! 0;
          |LEE 000#20];
          |SI FSalida = 0;
               |LEE 000#20a;
          |SINO;
               |LEE 000#20u;
          |FINSI;
          |SI #20#0 ! #26#0;
               |DDEFECTO #20;
          |FINSI;
          #20#0 = #26#0;
          #20#33 = #26#2;
         || #20#3 = nDia;
         || #20#4 = nMes;
          #20#29 = aA¤o;
         || #20#30 = nSemana;
          #20#32 = ~;
         || |HAZ MontaDiaSema;
          #20#31 = #7#16;
          #20#7 = #26#3;
          #20#8 = #26#4;
          |ABRE #19;
          #19#0 = #20#7;
          |LEE 000#19=;
          |CIERRA #19;
          |ABRE #600;
          #600#0 = #19#2;
          |LEE 000#600=;
          |CIERRA #600;
          #20#9 = #600#0;
          #20#10 = #600#1;
          ||#20#12 =
          ||#20#13 =
          #20#21 = #26#8;
          #20#22 = #26#9;
          |GRABA 020#20n;

          |SALVA_FICHA #60;
          #60#0 = #20#0;
          #60#9 = #20#33;
          #60#1 = #20#5;
          #60#2 = #20#7;
          #60#10 = #20#8;
          |GRABA 020#60n;
          |REPON_FICHA #60;
          nRefresca = 1;
     |FINSI;
     |CIERRA #20;
|FPRC;

|PROCESO BusRegSani;
     #26#23 = #23#2;
     |ERROR10;
|FPRC;

|DEFBUCLE BusRegSani;
     #23#1;
     ;
     #26#0, 000, #26#2;
     #26#0, 999, #26#2;
     ;
     NULL, BusRegSani;
|FIN;

|PROCESO Defecto26; |TIPO 0;
     |C_M #26#3, 1, "N";
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 1;
          |ABRE #20;
          #20#0 = #26#0;
          #20#33 = #26#2;
          |LEE 000#20=;
          |SI FSalida ! 0;
               |CONFI "0000SNo existe la subreferencia. Continuar (S/N):";
               |SI FSalida ! 0;
                    |ERROR;
               |SINO;
                    |C_M #26#3, 1, "S";
               |FINSI;
          |SINO;
               #26#3 = #20#7; |PINTA #26#3;
               #26#4 = #20#8; |PINTA #26#4;
               #26#8 = #20#21; |PINTA #26#8;
               #26#9 = #20#22; |PINTA #26#9;
          |FINSI;
          |CIERRA #20;
          |BUCLE BusRegSani;
     |FINSI;
|FPRC;

|PROCESO Total26; |TIPO 0;
     #26#7 = (#26#5 * #26#6) + (#26#8 * #26#16) + (#26#9 * #26#17);
     |PINTA #26#7;
|FPRC;

|PROCESO ModiCaja26; |TIPO 0;
     |SI #26#8 = 0;
          |C_M #26#10, 1, "N";
          |C_M #26#16, 1, "N";
     |SINO;
          |C_M #26#10, 1, "S";
          |C_M #26#16, 1, "S";
     |FINSI;
|FPRC;

|PROCESO ModiPale26; |TIPO 0;
     |SI #26#9 = 0;
          |C_M #26#11, 1, "N";
          |C_M #26#17, 1, "N";
     |SINO;
          |C_M #26#11, 1, "S";
          |C_M #26#17, 1, "S";
     |FINSI;
|FPRC;
---------------------------------------------- bogew008
|PROCESO Tipo53_11; |TIPO 11;
     |SI FSalida ! 1; |Y FSalida ! 7; |Y FSalida ! 0;
               |Y FSalida ! 2; |Y FSalida ! 3;
          |ERROR;
     |FINSI;
|FPRC;

|PROCESO Tecla53_0; |TIPO 0;
     nModo = (FEntrada / 100) ! 0;
     nTecla = FSalida;
     |DDEFECTO #15;
     #15#0 = #53#0;
     #15#24 = #53#1;
     |LEE 000#15=;
     |SI FSalida ! 0; |Y nTecla = 0;
          aNueva = "S";
          |HAZ EntCamara0;
          |SI aNueva = ""; |ERROR; |FINSI;
     |SINO;
          aNueva = "N";
          |HAZ EntCamara0;
          |PTEC 809;     || Abajo
          |ERROR;
          |PONCONTROL 23, "SI";
     |FINSI;
|FPRC;
---------------------------------------------- bogew007
|PROCESO HayMarcaRec;
     |SI #59#13 = "*";
          nHay = 1;
     |FINSI;
|FPRC;

|DEFBUCLE HayMarcaRec;
     #59#1;
     ;
     #52#0, #52#25, 001;
     #52#0, #52#25, 999;
     ;
     NULL, HayMarcaRec;
|FIN;

|PROCESO Min59_1;
     #59#0 = #52#0;
     #59#1 = #52#25;
     #59#2 = 001;
|FPRC;

|PROCESO Max59_1;
     #59#0 = #52#0;
     #59#1 = #52#25;
     #59#2 = 999;
|FPRC;

|PROCESO Tipo52_0; |TIPO 0;
     |SI #52Campo = Contenido; |Y FSalida = 0;
          |SI nSwMarcaUna = 1;
               nRecogida = #52#25;
               |PTEC 807; |ACABA;
          |FINSI;

          |PUSHV 0501 2380;
          |ENTLINEAL #1#59, 3, 4, 22, 1, Min59_1, Max59_1;
          |POPV;
          nHay = 0;
          |BUCLE HayMarcaRec;
          |SI nHay ! 0;
               #52#32 = "*";
          |SINO;
               #52#32 = "";
          |FINSI;
          |PINTA #52#32;
          |GRABA 020#52a;

     |FINSI;
|FPRC;
---------------------------------------------- bogew014
|PROCESO Tipo59_0; |TIPO 0;
     |SI #59Campo = Contenido; |Y FSalida = 0;
          |SI #59#13 = "*";
               #59#13 = "";
               nRecogida = nRecogida - 1;
               enEntrega = enEntrega - 1;
          |SINO;
               #59#13 = "*";
               nRecogida = nRecogida + 1;
               enEntrega = enEntrega + 1;
          |FINSI;
          |PINTA #59#13;
          |GRABA 020#59a;
     |FINSI;
|FPRC;
---------------------------------------------- bogew005
|PROCESO Tecla50_11; |TIPO 11;
     |SI FSalida ! 1; |Y FSalida ! 7; |Y FSalida ! 0;
               |Y FSalida ! 2; |Y FSalida ! 3;
          |SI FSalida = 13;
               nSwAdj = 1; |PTEC 807;
          |SINO;
               |SI nSwAdj = 0; |ERROR; |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Tecla50_0; |TIPO 0;
     nModo = (FEntrada / 100) ! 0;
     nTecla = FSalida;
     |DDEFECTO #5;
     #5#0 = #50#0;
     #5#25 = #50#1;
     |LEE 000#5=;
     |SI FSalida ! 0; |Y nTecla = 0;
          aNueva = "S";
          |HAZ ConRec0;
          |SI aNueva = ""; |ERROR; |FINSI;
     |SINO;
          aNueva = "N";
          |HAZ ConRec0;
          |PTEC 809;     || Abajo
          |ERROR;
          |PONCONTROL 23, "SI";
     |FINSI;
|FPRC;
---------------------------------------------- bogem016
|PROCESO DefeAlma16; |TIPO 0;
     #16#17 = #15#26;
|FPRC;

|PROCESO Tipo16_0; |TIPO 0;
     #16#8 = #16#7 * #16#6; |PINTA #16#8;
|FPRC;

|PROCESO Tipo16_2; |TIPO 2;
     #15#30 = #15#30 +. #16#6;
     #15#31 = #15#31 +. #16#8;

     nForma = 0 +. 1;
     |ABRE #6;
     #6#0 = #16#0;
     #6#1 = #16#1;
     #6#2 = #16#2;
     |LEE 101#6=;
     |SI FSalida = 0;
          #6#13 = #6#13 +. #16#6;
          |GRABA 020#6a;
          |LIBERA #6;
     |FINSI;
     |CIERRA #6;
|FPRC;

---------------------------------------------- bogem015
|PROCESO CambAlma16;
     #16#17 = #15#26;
     |GRABA 020#16a;
     |LIBERA #16;
|FPRC;

|DEFBUCLE CambAlma16;
     #16#1;
     ;
     #15#0, #15#24, 001;
     #15#0, #15#24, 999;
     ;
     NULL, CambAlma16;
|FIN;

|PROCESO CambAlma15; |TIPO 0;
     |SI #15Campo ! Contenido;
          |BUCLE CambAlma16;
     |FINSI;
|FPRC;

|PROCESO Transporte15_0; |TIPO 0;
     eaTransporte = #15#4;
     |HAZ Transporte0;
|FPRC;

|PROCESO Transporte15_66; |TIPO 66;
     eaTransporte = #15#4;
     |HAZ Transporte66;
     |SI eaTransporte = "";
          |ERROR;
     |SINO;
          #5#4 = eaTransporte;
          |PINTA #5#4;
     |FINSI;
|FPRC;
---------------------------------------------- bogem005
|PROCESO CheqPenPedCom5;
     |SI #23#16 < #23#5;
          nPend = 1;
          |ERROR10;
     |FINSI;
|FPRC;

|DEFBUCLE CheqPenPedCom5;
     #23#1;
     ;
     #5#0, #5#35, #5#36;
     #5#0, #5#35, #5#36;
     ;
     NULL, CheqPenPedCom5;
|FIN;

|PROCESO Defecto5; |TIPO 0;
     nModo = (FEntrada / 100) ! 0;

     |C_M #5#36, 1, "S";
     |C_M #5#19, 1, "N";
     |C_M #5#20, 1, "N";
     |C_M #5#21, 1, "N";
     |C_M #5#22, 1, "N";
     |C_M #5#38, 1, "N";
     |C_M #5#39, 1, "N";
     |SI #5#35 = 0; || sin pedido
          |C_M #5#36, 1, "N";
          |C_M #5#19, 1, "S";
          |C_M #5#20, 1, "S";
          |C_M #5#21, 1, "S";
          |C_M #5#22, 1, "S";
          |C_M #5#38, 1, "S";
          |C_M #5#39, 1, "S";

          |SI nModo ! 1; |ACABA; |FINSI;

          |ABRE #20;
          #20#0 = #60#0;
          #20#33 = #60#9;
          |LEE 020#20=;
          |CIERRA #20;
          #5#36 = #20#33; |PINTA #5#36; || subrefere
          #5#26 = #20#31; |PINTA #5#26;
          #5#2 = #20#5; |PINTA #5#2;
          #5#3 = #20#6; |PINTA #5#3;
          #5#15 = #20#7; |PINTA #5#15;
          #5#16 = #20#8; |PINTA #5#16;
          #5#13 = #20#9; |PINTA #5#13;
          #5#14 = #20#10; |PINTA #5#14;
          #5#19 = #20#21; |PINTA #5#19;
          #5#20 = #20#22; |PINTA #5#20;
          |ACABA;
     |FINSI;

     |SI nModo ! 1; |ACABA; |FINSI;

     |SI Campo = 35;
          |ABRE #3;
          #3#0 = #5#0;
          #3#18 = #5#35;
          |LEE 000#3=;
          |SI FSalida = 0;
               |ABRE #112;
               #112#0 = #3#2;
               |LEE 000#112=;
               |CIERRA #112;
               |ABRE #225;
               #225#0 = #3#16;
               |LEE 000#225=;
               |CIERRA #225;

               #5#2 = #3#2; |PINTA #5#2;
               #5#3 = #3#3; |PINTA #5#3;
               #5#5 = #3#5; |PINTA #5#5;
               #5#6 = #3#6; |PINTA #5#6;
               #5#7 = #3#11; |PINTA #5#7;
               #5#26 = #3#16; |PINTA #5#26;
          |SINO;
               |MENAV "0000No existe pedido de compras...";
               |ERROR;
          |FINSI;
          |CIERRA #3;
     |SINO;
          nPend = 0;
          |BUCLE CheqPenPedCom5;
          |SI nPend = 0;
               |MENAV "0000No quedan unidades pendientes de asignar...";
               |ERROR; |ACABA;
          |FINSI;

          |ABRE #23;
          #23#0 = #5#0;
          #23#15 = #5#35;
          #23#1 = #5#36;
          |LEE 000#23=;
          |SI FSalida = 0;
               |ABRE #19;
               #19#0 = #23#3;
               |LEE 000#19=;
               |CIERRA #10;
               |ABRE #600;
               #600#0 = #19#2;
               |LEE 000#600=;
               |CIERRA #600;

               #5#15 = #23#3; |PINTA #5#15;
               #5#16 = #23#4; |PINTA #5#16;
               #5#13 = #600#0; |PINTA #5#13;
               #5#14 = #600#1; |PINTA #5#14;
               #5#19 = #23#8 - #23#22; |PINTA #5#19;
               #5#20 = #23#9 - #23#23; |PINTA #5#20;
               #5#21 = #23#10; |PINTA #5#21;
               #5#22 = #23#11; |PINTA #5#22;
               #5#23 = #23#12; |PINTA #5#23;
               #5#24 = #23#13; |PINTA #5#24;
               #5#38 = #23#20; |PINTA #5#38;
               #5#39 = #23#21; |PINTA #5#39;
          |SINO;
               |MENAV "0000No existe linea de pedido de compras...";
               |ERROR;
          |FINSI;
          |CIERRA #23;
     |FINSI;
|FPRC;

|PROCESO Mina3;
     #3#0 = #5#0;
     #3#18 = 1;
|FPRC;

|PROCESO Maxa3;
     #3#0 = #5#0;
     #3#18 = 999;
|FPRC;

|PROCESO Mina23;
     #23#0 = #5#0;
     #23#15 = #5#35;
     #23#1 = 1;
|FPRC;

|PROCESO Maxa23;
     #23#0 = #5#0;
     #23#15 = #5#35;
     #23#1 = 999;
|FPRC;

|PROCESO Consulta5; |TIPO 66;
     |SI Campo = 35;
          |ABRE #3;
          #3#0 = #5#0;
          #3#18 = #5#35;
          |LEE 000#3];
          |CONSULTA_F_CLAVE #1#3, Mina3, Maxa3;
          |SI FSalida = 0;
               #5#35 = #3#18; |PINTA #5#35;
          |SINO;
               |ERROR;
          |FINSI;
          |CIERRA #3;
     |SINO;
          |ABRE #23;
          #23#0 = #5#0;
          #23#15 = #5#35;
          #23#1 = #5#36;
          |LEE 000#23];
          |CONSULTA_F_CLAVE #1#23, Mina3, Maxa23;
          |SI FSalida = 0;
               #5#35 = #23#15; |PINTA #5#35;
               #5#36 = #23#1; |PINTA #5#36;
          |SINO;
               |ERROR;
          |FINSI;
          |CIERRA #23;
     |FINSI;
|FPRC;

|PROCESO Transporte5_0; |TIPO 0;
     eaTransporte = #5#5;
     |HAZ Transporte0;
|FPRC;

|PROCESO Transporte5_66; |TIPO 66;
     eaTransporte = #5#5;
     |HAZ Transporte66;
     |SI eaTransporte = "";
          |ERROR;
     |SINO;
          #5#5 = eaTransporte;
          |PINTA #5#5;
     |FINSI;
|FPRC;

|PROCESO Tipo05_2; |TIPO 2;
     |ABRE #23;
     #23#0 = #5#0;
     #23#15 = #5#35;
     #23#1 = #5#36;
     |LEE 101#23=;
     |SI FSalida = 0;
          #23#22 = #23#22 +. #5#19;
          #23#23 = #23#23 +. #5#20;
          |GRABA 020#23a;
     |FINSI;
     |CIERRA #23;
|FPRC;
---------------------------------------------- bogem006
|PROCESO Tipo6_2; |TIPO 2;
     #5#32 = #5#32 +. #6#6;
     #5#33 = #5#33 +. #6#8;
     #5#34 = #5#34 +. #6#9;

     |ABRE #23;
     #23#0 = #5#0;
     #23#15 = #5#35;
     #23#1 = #5#36;
     |LEE 101#23=;
     |SI FSalida = 0;
          #23#16 = #23#16 +. #6#6;
          |GRABA 020#23a;
     |FINSI;
     |CIERRA #23;
|FPRC;

|PROCESO Tipo6_7; |TIPO 7;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 1;
          aAlfa = (("0000000" + #6#0) % -107) + (("000" + #6#1) % -102) + (("000" + #6#2) % -103)
          #6#3 = aAlfa; |PINTA aAlfa;
          |ABRE #23;
          #23#0 = #5#0;
          #23#15 = #5#35;
          #23#1 = #5#36;
          |LEE 101#23=;
          |SI FSalida = 0;
               #6#6 = #23#5 - #23#16; |PINTA #6#6;
               #6#7 = #23#6; |PINTA #6#7;
          |FINSI;
          |CIERRA #23;
     |FINSI;
|FPRC;

|PROCESO Total6; |TIPO 0;
     #6#8 = #6#7 * #6#6; |PINTA #6#8;
     |SI #6Campo ! Contenido; |Y Campo = 6;
          #6#9 = #5#27 / #6#6; |PINTA #6#9;
     |FINSI;
|FPRC;

|PROCESO CheqUni6; |TIPO 0;
     nModo = (FEntrada / 100) ! 0;
     |ABRE #23;
     #23#0 = #5#0;
     #23#15 = #5#35;
     #23#1 = #5#36;
     |LEE 101#23=;
     |SI FSalida = 0;
          #23#16 = #23#16 + #6#6;
          |SI #23#16 > #23#5;
               nNume = #23#16 - #23#5;
               aAlfa = "0000Se superan las unidades pedidas en: " + nNume;
               |MENAV aAlfa;
               |ERROR;
          |FINSI;
     |FINSI;
     |CIERRA #23;
|FPRC;

---------------------------------------------- bogem025
|PROCESO Tipo2_25; |TIPO 2;
     |SI aSirviendo = "S";
          aSirviendo = "N"; |ACABA;
     |FINSI;

     |SI #24#20 = "N"; || De pedido
          |ABRE #23;
          #23#0 = #25#0;
          #23#15 = #25#15;
          #23#1 = #25#16;
          |LEE 101#23=;
          |SI FSalida = 0;
               #23#14 = #23#14 +. #25#5;
               #23#18 = #23#18 +. #25#8;
               #23#19 = #23#19 +. #25#9;
               |GRABA 020#23a;
          |FINSI;
          |CIERRA #23;
     |SINO;         || De recogida
          |ABRE #6;
          #6#0 = #25#0;
          #6#1 = #25#17;
          #6#2 = #25#18;
          |LEE 101#6=;
          |SI FSalida = 0;
               #6#12 = #6#12 +. #25#5;
               |GRABA 020#6a;
               |LIBERA #6;

               |ABRE #5;
               #5#0 = #6#0;
               #5#25 = #6#1;
               |LEE 121#5=;
               |SI FSalida = 0;
                    |ABRE #23;
                    #23#0 = #5#0;
                    #23#15 = #5#35;
                    #23#1 = #5#36;
                    |LEE 121#23=;
                    |SI FSalida = 0;
                         #23#14 = #23#14 +. #25#5;
                         #23#18 = #23#18 +. #25#8;
                         #23#19 = #23#19 +. #25#9;
                         |GRABA 020#23a;
                    |FINSI;
                    |CIERRA #23;
               |FINSI;
               |CIERRA #5;
          |FINSI;
          |CIERRA #6;
     |FINSI;
|FPRC;

|PROCESO SirvePedCom;
     nPen = #23#5 - #23#14;
     nPenCaja = #23#8 - #23#18;
     nPenPale = #23#9 - #23#19;
     |SI nPen > 0; |O nPenCaja > 0; |O nPenPale > 0;
          #23#14 = #23#14 + nPen;
          #23#18 = #23#18 + nPenCaja;
          #23#19 = #23#19 + nPenPale;
          |GRABA 020#23a;
          nHay = 1;

          |DDEFECTO #25;
          |PARA i = 2; |SI i [ 13; |HACIENDO i = i + 1;
               #25i = #23i;
          |SIGUE;
          #25#0 = #24#0;
          #25#1 = nLinea;
          #25#14 = #24#17;
          #25#5 = nPen;
          #25#8 = nPenCaja;
          #25#9 = nPenPale;

          #25#15 = #23#15;
          #25#16 = #23#1;
          #25#21 = #23#20;
          #25#22 = #23#21;
          #25#7 = (#25#5 * #25#6) + (#25#8 * #25#21) + (#25#9 * #25#22);

          |PARA FSalida = 1; |SI FSalida ! 0; |HACIENDO;
               #25#1 = nLinea;
               |SI nPrime = 0;
                    nPrime = 1;
                    |GRABA 040#25a;
               |SINO;
                    |GRABA 040#25n;
               |FINSI;
               nLinea = nLinea + 1;
          |SIGUE;
     |FINSI;
     |LIBERA #23;
|FPRC;

|DEFBUCLE SirvePedCom;
     #23#1;
     ;
     #3#0, #3#18, 001;
     #3#0, #3#18, 999;
     ;
     NULL, SirvePedCom;
|FIN;

|PROCESO Asigna25; |TIPO 0;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo ! 1; |O FSalida = 2; |ACABA; |FINSI;
     |SI #25#15 = 0;
          |SI #24#20 = "N";
               |ABRE #112;
               #112#0 = #3#2;
               |LEE 000#112=;
               |CIERRA #112;
               #25#2 = #112#88; |PINTA #23#2;

               |ABRE #20;
               #20#0 = #25#0;
               #20#33 = #25#1;
               |LEE 000#20=;
               |SI FSalida = 0;
                    #25#3 = #20#7; |PINTA #25#3;
                    #25#4 = #20#8; |PINTA #25#4;
                    #25#8 = #20#21; |PINTA #25#8;
                    #25#9 = #20#22; |PINTA #25#9;
               |SINO;
                    |MENAV "0000No existe referencia...";
                    |ERROR; |ACABA;
               |FINSI;
               |CIERRA #20;
          |FINSI;
          |ACABA;
     |FINSI;

     |ABRE #3;
     #3#0 = #25#0;
     #3#18 = #25#15;
     |LEE 000#3=;
     |SI FSalida ! 0;
          |MENAV "0000No existe pedido de compras...";
          |ERROR;
     |SINO;
          aponer = Asino;
          |HAZ poncontrC;
          nLinea = #25#1;
          nHay = 0;
          nPrime = 0;
          |SI #25#16 = 0;
               |BUCLE SirvePedCom;
               |SI nHay = 0;
                    |MENAV "0000No quedan lineas pendientes de asignar...";
                    |ERROR;
               |SINO;
                    aSirviendo = "S";
                    |PTEC 815;
                    ||PTEC 809;|PTEC 816;|PTEC 812;|PTEC 807;
               |FINSI;
          |SINO;
               |ABRE #23;
               #23#0 = #25#0;
               #23#15 = #25#15;
               #23#1 = #25#16;
               |LEE 101#23=;
               |SI FSalida ! 0;
                    |MENAV "0000No existe linea de pedido de compras...";
                    |ERROR;
               |SINO;
                    |HAZ SirvePedCom;
                    |SI nHay = 0;
                         |MENAV "0000Linea pedido de compras servida...";
                         |ERROR;
                    |SINO;
                         aSirviendo = "S";
                         |PTEC 815;
                         |||PTEC 806; |PTEC 807;
                    |FINSI;
               |FINSI;
               |CIERRA #23;
          |FINSI;

          aponer = Anosi;
          |HAZ poncontrC;
     |FINSI;
     |CIERRA #3;
|FPRC;

|PROCESO Minc3;
     #3#0 = #25#0;
     #3#18 = 1;
|FPRC;

|PROCESO Maxc3;
     #3#0 = #25#0;
     #3#18 = 999;
|FPRC;

|PROCESO Minc23;
     #23#0 = #25#0;
     #23#15 = #25#15;
     #23#1 = 1;
|FPRC;

|PROCESO Maxc23;
     #23#0 = #25#0;
     #23#15 = #25#15;
     #23#1 = 999;
|FPRC;

|PROCESO Consulta25; |TIPO 66;
     |SI Campo = 15;
          |ABRE #3;
          #3#0 = #25#0;
          #3#18 = #25#15;
          |LEE 000#3];
          |CONSULTA_F_CLAVE #1#3, Minc3, Maxc3;
          |SI FSalida = 0;
               #25#15 = #3#18; |PINTA #25#15;
          |SINO;
               |ERROR;
          |FINSI;
          |CIERRA #3;
     |SINO;
          |ABRE #23;
          #23#0 = #25#0;
          #23#15 = #25#15;
          #23#1 = #25#16;
          |LEE 000#23];
          |CONSULTA_F_CLAVE #1#23, Minc23, Maxc23;
          |SI FSalida = 0;
               #25#15 = #23#15; |PINTA #25#15;
               #25#16 = #23#1; |PINTA #25#16;
          |SINO;
               |ERROR;
          |FINSI;
          |CIERRA #23;
     |FINSI;
|FPRC;

|PROCESO NoAtras25; |TIPO 0;
     |SI FSalida = 2; |ERROR; |FINSI;
|FPRC;

|PROCESO ModiCam25; |TIPO 0;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 1;
          |SI #24#20 = "S";
               |MENAV "0000Alta no permitida...";
               |ERROR; |ACABA;
          |FINSI;

          |C_M #25#15, 1, "S";
          |C_M #25#16, 1, "S";
     |SINO;
          |C_M #25#15, 1, "N";
          |C_M #25#16, 1, "N";
     |FINSI;
|FPRC;

|PROCESO Total25; |TIPO 0;
     #25#7 = (#25#5 * #25#6) + (#25#8 * #25#21) + (#25#9 * #25#22);
     |PINTA #25#7;
|FPRC;

|PROCESO ModiCaja25; |TIPO 0;
     |SI #25#8 ! 0;
          |C_M #25#10, 1, "S";
          |C_M #25#12, 1, "S";
     |SINO;
          |C_M #25#10, 1, "N";
          |C_M #25#12, 1, "N";
     |FINSI;
|FPRC;

|PROCESO ModiPale25; |TIPO 0;
     |SI #25#9 ! 0;
          |C_M #25#11, 1, "S";
          |C_M #25#13, 1, "S";
     |SINO;
          |C_M #25#11, 1, "N";
          |C_M #25#13, 1, "N";
     |FINSI;
|FPRC;
---------------------------------------------- bogem024
|PROCESO DefSerie24; |TIPO 7;
     nModo = (FEntrada / 100) !0;
     |SI nModo = 1; |Y #142#185 = "S";
          #24#18 = #142#193;
     |FINSI;
|FPRC;

|PROCESO Contador24_7; |TIPO 7;
     nModo = (FEntrada / 100) !0;
     |SI nModo = 1; |O #24#19 = 0;
          FEntrada = 101; || simula alta
          |ABRE #77;
          #77#0 = 0;
          #77#50 = #24#18;
          |HAZ ContaAC7;
          #24#19 = #77#0; |PINTA #24#19;
          |CIERRA #77;
          |SI enMenuAuto = 2; || menu auto = 1
               |C_M #24#19, 1, "S";
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Contador24_0; |TIPO 0;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 1;
          |ABRE #77;
          #77#50 = #24#18;
          #77#0 = #24#19;
          |LEE 000#77=;
          |SI FSalida = 0;
               |MENAV "0000Albaran existente...";
               |ERROR;
          |SINO;
               |C_M #24#18, 1, "N";
               |C_M #24#19, 1, "N";
          |FINSI;
          |CIERRA #77;
     |FINSI;
|FPRC;

|PROCESO Transporte24_66; |TIPO 66;
     eaTransporte = #24#5;
     |HAZ Transporte66;
     |SI eaTransporte = "";
          |ERROR;
     |SINO;
          #24#5 = eaTransporte;
          |PINTA #24#5;
     |FINSI;
|FPRC;

|PROCESO Transporte24_0; |TIPO 0;
     eaTransporte = #24#5;
     |HAZ Transporte0;
|FPRC;
---------------------------------------------- bogem023
|PROCESO Tipo3_23; |TIPO 3;
     |ABRE #20;
     #20#0 = #23#0;
     #20#33 = #23#1;
     |LEE 101#20=;
     |SI FSalida ! 0;
          |LEE 000#20];
          |SI FSalida = 0;
               |LEE 000#20a;
          |SINO;
               |LEE 000#20u;
          |FINSI;
          |SI #20#0 ! #23#0;
               |DDEFECTO #20;
          |FINSI;
          #20#0 = #23#0;
          #20#33 = #23#1;
         || #20#3 = nDia;
         || #20#4 = nMes;
          #20#29 = aA¤o;
         || #20#30 = nSemana;
          #20#32 = ~;
         || |HAZ MontaDiaSema;
          #20#31 = #3#16;
          #20#5 = #3#2;
          #20#6 = #3#3;
          #20#7 = #23#3;
          #20#8 = #23#4;
          |ABRE #19;
          #19#0 = #20#7;
          |LEE 000#19=;
          |CIERRA #19;
          |ABRE #600;
          #600#0 = #19#2;
          |LEE 000#600=;
          |CIERRA #600;
          #20#9 = #600#0;
          #20#10 = #600#1;
          #20#12 = #3#8;
          #20#13 = #3#9;
          #20#21 = #23#8;
          #20#22 = #23#9;
          |GRABA 020#20n;

          |SALVA_FICHA #60;
          #60#0 = #20#0;
          #60#9 = #20#33;
          #60#1 = #20#5;
          #60#2 = #20#7;
          #60#10 = #20#8;
          |GRABA 020#60n;
          |REPON_FICHA #60;
          nRefresca = 1;
     |SINO;
          |ABRE #19;
          #19#0 = #23#3;
          |LEE 000#19=;
          |CIERRA #19;
          |ABRE #600;
          #600#0 = #19#2;
          |LEE 000#600=;
          |CIERRA #600;

          #20#7 = #23#3;
          #20#8 = #23#4;
          #20#9 = #600#0;
          #20#10 = #600#1;
          #20#21 = #23#8;
          #20#22 = #23#9;
          #20#12 = #3#8;
          #20#13 = #3#9;
          |GRABA 020#20a;
     |FINSI;
     |CIERRA #20;
|FPRC;

|PROCESO Min20;
     #20#0 = #23#0;
     #20#33 = 1;
|FPRC;

|PROCESO Max20;
     #20#0 = #23#0;
     #20#33 = 999;
|FPRC;

|PROCESO Cheq23; |TIPO 0;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo ! 1; |ACABA; |FINSI;

     |ABRE #20;
     #20#0 = #23#0;
     #20#33 = #23#1;
     |LEE 000#20=;
     |SI FSalida = 0; |Y  #3#2 ! #20#5;
          aAlfa = "0000Subreferencia de otro proveedor: " + #20#5;
          |MENAV aAlfa;
          |ERROR;
     |FINSI;
     |CIERRA #20;
|FPRC;

|PROCESO Consulta23; |TIPO 66;
     |ABRE #20;
     #20#0 = #23#0;
     #20#33 = #23#1;
     |LEE 000#20];
     |CONSULTA_F_CLAVE #1#20, Min20, Max20;
     |SI FSalida = 0;
          #23#1 = #20#33; |PINTA #23#1;
     |SINO;
          |ERROR;
     |FINSI;
     |CIERRA #20;
|FPRC;

|PROCESO Defec23; |TIPO 0;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 1; |O #23Campo ! Contenido;
          |ABRE #112;
          #112#0 = #3#2;
          |LEE 000#112=;
          |CIERRA #112;
          #23#2 = #112#88; |PINTA #23#2;

          |ABRE #20;
          #20#0 = #23#0;
          #20#33 = #23#1;
          |LEE 000#20=;
          |SI FSalida ! 0;
               |CONFI "0000SNo existe la subreferencia. Continuar (S/N):";
               |SI FSalida ! 0;
                    |ERROR;
               |FINSI;
          |SINO;
               #23#3 = #20#7; |PINTA #23#2;
               #23#4 = #20#8; |PINTA #23#3;
               #23#8 = #20#21; |PINTA #20#21;
               #23#9 = #20#22; |PINTA #20#22;
          |FINSI;
          |CIERRA #20;
     |FINSI;
|FPRC;

|PROCESO Total23; |TIPO 0;
     #23#7 = (#23#5 * #23#6) + (#23#8 * #23#20) + (#23#9 * #23#21);
     |PINTA #23#7;
|FPRC;

|PROCESO ModiCaja23; |TIPO 0;
     |SI #23#8 = 0;
          |C_M #23#10 , 1, "N";
     |SINO;
          |C_M #23#10 , 1, "S";
     |FINSI;
|FPRC;

|PROCESO ModiPale23; |TIPO 0;
     |SI #23#9 = 0;
          |C_M #23#11 , 1, "N";
     |SINO;
          |C_M #23#11 , 1, "S";
     |FINSI;
|FPRC;
---------------------------------------------- bogem003
|PROCESO Transporte3_66; |TIPO 66;
     eaTransporte = #3#5;
     |HAZ Transporte66;
     |SI eaTransporte = "";
          |ERROR;
     |SINO;
          #3#5 = eaTransporte;
          |PINTA #3#5;
     |FINSI;
|FPRC;

|PROCESO Transporte3_0; |TIPO 0;
     eaTransporte = #3#5;
     |HAZ Transporte0;
|FPRC;
---------------------------------------------- bogew006
|PROCESO Tipo71_11; |TIPO 11;
     |SI FSalida ! 1; |Y FSalida ! 7; |Y FSalida ! 0;
               |Y FSalida ! 2; |Y FSalida ! 3;
          |ERROR;
     |FINSI;
|FPRC;

|PROCESO Tipo71_0; |TIPO 0;
     nModo = (FEntrada / 100) ! 0;
     nTecla = FSalida;
     |DDEFECTO #24;
     #24#0 = #71#0;
     #24#17 = #71#1;
     |LEE 000#24=;
     |SI FSalida ! 0; |Y nTecla = 0;
          aNueva = "S";
          |HAZ AlbCom0;
          |SI aNueva = ""; |ERROR; |FINSI;
     |SINO;
          aNueva = "N";
          |HAZ AlbCom0;
          |PTEC 809;     || Abajo
          |ERROR;
          |PONCONTROL 23, "SI";
     |FINSI;
|FPRC;
---------------------------------------------- bogew015
|PROCESO Tipo70_11; |TIPO 11;
     |SI FSalida ! 1; |Y FSalida ! 7; |Y FSalida ! 0;
               |Y FSalida ! 2; |Y FSalida ! 3;
          |ERROR;
     |FINSI;
|FPRC;

|PROCESO Tipo70_0; |TIPO 0;
     nModo = (FEntrada / 100) ! 0;
     nTecla = FSalida;
     |DDEFECTO #3;
     #3#0 = #70#0;
     #3#18 = #70#1;
     |LEE 000#3=;
     |SI FSalida ! 0; |Y nTecla = 0;
          aNueva = "S";
          |HAZ PedCom0;
          |SI aNueva = ""; |ERROR; |FINSI;
     |SINO;
          aNueva = "N";
          |HAZ PedCom0;
          |PTEC 809;     || Abajo
          |ERROR;
          |PONCONTROL 23, "SI";
     |FINSI;
|FPRC;
---------------------------------------------- bogez006
|PROCESO Min10;
     #10#0 = #9#0;
     #10#1 = #9#25;
     #10#2 = 1;
|FPRC;

|PROCESO Max10;
     #10#0 = #9#0;
     #10#1 = #9#25;
     #10#2 = 999;
|FPRC;

|PROCESO Borra10;
     |SI nSwCheq = 1;
          |SI #10#12 ! 0; |O #10#13 ! 0;
               nHay = 1;
               |ERROR10;
          |FINSI;
     |SINO;
          #26#0 = #9#0;  ||Refe
          #26#1 = #9#35; ||Pedido
          #26#2 = #9#36; ||subr
          |LEE 101#26=;
          |SI FSalida = 0;
               #26#15 = #26#15 - #10#6;
               |GRABA 020#26a;
               |LIBERA #26;
          |FINSI;
          |BORRA 020#10a;
     |FINSI;
|FPRC;

|DEFBUCLE Borra10;
     #10#1;
     ;
     #9#0, #9#25, 001;
     #9#0, #9#25, 999;
     be;
     NULL, Borra10;
|FIN;

|RUTINA ConEnt0;
     |PUSHV 0501 2380;
     |SI aNueva = "S";
          #9#0 = #20#0;
          #9#25 = 999;
          |LEE 000#9];
          |SI FSalida = 0;
               |LEE 000#9a;
          |SINO;
               |LEE 000#9u;
          |FINSI;
          |SI FSalida = 0; |Y #9#0 = #20#0;
               nUltNumero = #9#25 + 1;
          |SINO;
               nUltNumero = 1;
          |FINSI;

          |DDEFECTO #9;
          #9#0 = #20#0;
          #9#25 = nUltNumero;
          |GRABA 020#9b;

          |PINPA #0#9;
          |PINDA #0#9;
          |C_M #9#26, 1, "S";
          |C_M #9#35, 1, "S";
          |C_M #9#36, 1, "S";
          |ENDATOS #1#9;
          |SI FSalida = 0;
               |ENTLINEAL #1#10, 3, 1, 22, 1, Min10, Max10;
               |CONFI "0000NImprimir Confirmacion Entrega";
               |SI FSalida = 0;
                    |HAZ ImpConEnt;
               |FINSI;
               |GRABA 020#9a;

               |ABRE #225;
               |HAZ LlenaConEntrega;
               |CIERRA #225;
          |SINO;
               |ERROR;
               |BORRA 020#9c;
          |FINSI;
     |SINO;
          #9#0 = #54#0;
          #9#25 = #54#1;
          |LEE 121#9=;

          |PINPA #0#9;
          |PINDA #0#9;
          |MENU aMenuc;
          nSal = FSalida;
          |SI nSal = 1;
               |C_M #9#26, 1, "N";
               |C_M #9#35, 1, "N";
               |C_M #9#36, 1, "N";
               |ENDATOS #2#9;
               |SI FSalida = 0;
                    |ENTLINEAL #1#10, 3, 2, 22, 1, Min10, Max10;
                    |GRABA 020#9a;
                    |SI FSalida = 0;
                         |CONFI "0000NImprimir Confirmacion Entrega?";
                         |SI FSalida = 0;
                              |HAZ ImpConEnt;
                         |FINSI;
                    |FINSI;
               |FINSI;
          |FINSI;
          |SI nSal = 2;
               |CONFI "0000NBorrar Confirmacion Entrega?";
               |SI FSalida = 0;
                    nSwCheq = 1;
                    nHay = 0;
                    |ABRE #7;
                    |BUCLE Borra10;
                    |SI nHay = 0;
                         nSwCheq = 0;
                         |ABRE #26;
                         |BUCLE Borra10;
                         |CIERRA #26;
                         |BORRA 020#54a;
                         |BORRA 020#9a;
                    |SINO;
                         |MENAV "0000Hay unidades asignadas. No se puede borrar.";
                    |FINSI;
                    |CIERRA #7;
               |FINSI;
          |FINSI;
          |SI nSal = 3;
               |ENTLINEAL #1#10, 3, 2, 22, 1, Min10, Max10;
               |GRABA 020#9a;
          |FINSI;
          |SI nSal = 4;
               |HAZ ImpConEnt;
          |FINSI;
     |FINSI;
     |POPV;
|FRUT;

|PROCESO LlenaConEntrega;
     |DDEFECTO #225;
     #225#0 = #9#26;
     |LEE 000#225=;

     #54#0 = #9#0;
     #54#1 = #9#25;
     #54#2 = #9#35;
     #54#3 = #9#36;
     #54#4 = #9#2;
     #54#5 = #9#3;
     #54#6 = #225#0;
     #54#7 = #225#1;
     |GRABA 020#54n;
|FPRC;

|DEFBUCLE LlenaConEntrega;
     #9#1;
     ;
     #60#0, 001;
     #60#0, 999;
     ;
     NULL, LlenaConEntrega;
|FIN;

|PROCESO Min54;
     #54#0 = #60#0;
     #54#1 = 1;
|FPRC;

|PROCESO Max54;
     #54#0 = #60#0;
     #54#1 = 999;
|FPRC;

|PROCESO ConEnt;
     nSwPedido = 0;
     |ABRE #7;
     #7#0 = #60#0;
     #7#19 = 0;
     |LEE 000#7];
     |SI FSalida ! 0; |O #7#0 ! #60#0;
          nSwPedido = 1;
          |MENAV "0000No existe pedido de ventas";
          ||ACABA;
     |FINSI;
     |CIERRA #7;

     |MENSA "0000Confirma Entrega";
     |HAZ QuitaBoton;

     |HAZ CreaTempo; aTmp54 = Tempo; |NOME_DAT #54#Tempo#; |DELINDEX #54;

     |PUSHV 0501 2380;
     |ABRE #9;

  |ET OtraConEnt;
     #9#0 = #60#0;
     #9#25 = 0;
     |LEE 000#9];
     |SI FSalida = 0; |Y #9#0 = #60#0;
          |ABRE #54;
          |ABRE #225;
          |BUCLE LlenaConEntrega;
          |CIERRA #225;
          |CIERRA #54;
          |PINPA #0#54;
          |PINTA 714, #9#0;
          |ENTLINEAL #1#54, 2, 1, 22, 0, Min54, Max54;
          |SI nSwAdj = 1;
               nSwAdj = 0;
               |HAZ AdjConEnt;
               |DELINDEX #54;
               |VETE OtraConEnt;
          |FINSI;
     |SINO;
          |SI nSwPedido = 1;
               |ABRE #54;
               aNueva = "S";
               |HAZ ConEnt0;
               |CIERRA #54;
          |SINO;
               |HAZ AdjConEnt;
          |FINSI;
     |FINSI;
     |CIERRA #9;
     Tempo = aTmp54; |HAZ BoraTempo; |DELINDEX #54;

     |POPV;
     |HAZ PonBoton;
|FPRC;

|PROCESO Borra26;
     |BORRA 020#26a;
     |LIBERA #26;
|FPRC;

|DEFBUCLE Borra26;
     #26#1;
     ;
     #7#0, #7#19, 001;
     #7#0, #7#19, 999;
     be;
     NULL, Borra26;
|FIN;

|PROCESO Min26;
     #26#0 = #7#0;
     #26#1 = #7#19;
     #26#2 = 1;
|FPRC;

|PROCESO Max26;
     #26#0 = #7#0;
     #26#1 = #7#19;
     #26#2 = 999;
|FPRC;

|RUTINA PedVta0;
     |PUSHV 0501 2380;
     |SI aNueva = "S";
          #7#0 = #60#0;
          #7#19 = 999;
          |LEE 000#7];
          |SI FSalida = 0;
               |LEE 000#7a;
          |SINO;
               |LEE 000#7u;
          |FINSI;
          |SI FSalida = 0; |Y #7#0 = #60#0;
               nUltNumero = #7#19 + 1;
          |SINO;
               nUltNumero = 1;
          |FINSI;

          |ABRE #225;
          #225#0 = #20#31;
          |LEE 000#225=;
          |CIERRA #225;

          |DDEFECTO #7;
          #7#0 = #20#0;
          #7#19 = nUltNumero;
          |GRABA 020#7b;
          #7#1 = ~;
          #7#16 = #225#0;
          #7#12 = #225#1;
          |PINPA #0#7;
          |PINDA #0#7;
          |ENTLINEAL #1#26, 3, 7, 23, 0, Min26, Max26;
          |ENDATOS #2#7;
          |SI FSalida = 0;
               |ENTLINEAL #1#26, 3, 1, 23, 0, Min26, Max26;
               eaNueva = "S";
               |HAZ CreaPedVta;
               #7#20 = #104#25;
               #7#21 = #104#0;
               |GRABA 020#7a;
               |CONFI "0000NImprimir Pedido de Ventas?";
               |SI FSalida = 0;
                    |HAZ ImpPedVta;
               |FINSI;
               |HAZ LlenaPedVta;
          |SINO;
               aNueva = "";
               |BORRA 020#7c;
               |BUCLE Borra26;
          |FINSI;
     |SINO;
          #7#0 = #57#0;
          #7#19 = #57#5;
          |LEE 121#7=;

          |PINPA #0#7;
          |PINDA #0#7;
          |ENTLINEAL #1#26, 3, 7, 23, 0, Min26, Max26;
          |MENU aMenuc;
          nSal = FSalida;
          |SI nSal = 1;
               |PINDA #0#7;
               |ENDATOS #2#7;
               |SI FSalida = 0;
                    |ENTLINEAL #1#26, 3, 1, 23, 0, Min26, Max26;
                    eaBorCab = "N";
                    |HAZ BorraPedVta;
                    eaNueva = "N";
                    |HAZ CreaPedVta;
                    #7#20 = #104#25;
                    #7#21 = #104#0;
                    |GRABA 020#7a;
                    |CONFI "0000NImprimir Pedido de Ventas?";
                    |SI FSalida = 0;
                         |HAZ ImpPedVta;
                    |FINSI;
               |FINSI;
          |FINSI;
          |SI nSal = 2;
               |ABRE #9;
               #9#0 = #60#0;
               #9#25 = 0;
               |LEE 000#9];
               |SI FSalida = 0; |Y #9#0 = #60#0;
                    |MENAV "0000Existe confirmacion entrega";
               |SINO;
                    |CONFI "0000NBorrar pedido de ventas?";
                    |SI FSalida = 0;
                         eaBorCab = "S";
                         |HAZ BorraPedVta;
                         |BUCLE Borra26;
                         |BORRA 020#7a;
                         |BORRA 020#57a;
                    |FINSI;
               |FINSI;
               |CIERRA #9;
          |FINSI;
          |SI nSal = 3;
               |ENTLINEAL #1#26, 3, 1, 23, 0, Min26, Max26;
               eaBorCab = "N";
               |HAZ BorraPedVta;
               eaNueva = "N";
               |HAZ CreaPedVta;
               #7#20 = #104#25;
               #7#21 = #104#0;
               |GRABA 020#7a;
          |FINSI;
          |SI nSal = 4;
               |HAZ ImpPedVta;
          |FINSI;
     |FINSI;
     |POPV;
|FRUT;

|PROCESO LlenaPedVta;
     #57#0 = #7#0;
     #57#1 = #7#2;
     #57#2 = #7#3;
     #57#3 = #7#20;
     #57#4 = #7#21;
     #57#5 = #7#19;
     |GRABA 020#57n;
|FPRC;

|DEFBUCLE LlenaPedVta;
     #7#1;
     ;
     #60#0, 001;
     #60#0, 999;
     ;
     NULL, LlenaPedVta;
|FIN;

|PROCESO Min57;
     #57#0 = #60#0;
     #57#5 = 1;
|FPRC;

|PROCESO Max57;
     #57#0 = #60#0;
     #57#5 = 999;
|FPRC;

|RUTINA PedVta;
     |MENSA "0000Pedido de venta";
     |HAZ QuitaBoton;

     |HAZ CreaTempo; aTmp57 = Tempo; |NOME_DAT #57#Tempo#; |DELINDEX #57;

     |PUSHV 0501 2380;
     |ABRE #7;
     #7#0 = #60#0;
     #7#19 = 0;
     |LEE 000#7];
     |SI FSalida = 0; |Y #7#0 = #60#0;
          |ABRE #57;
          |BUCLE LlenaPedVta;
          |CIERRA #57;
          |PINPA #0#57;
          |PINTA 714, #60#0;
          |ENTLINEAL #1#57, 2, 1, 22, 0, Min57, Max57;
     |SINO;
          |ABRE #57;
          aNueva = "S";
          |HAZ PedVta0;
          |CIERRA #57;
     |FINSI;
     |CIERRA #7;
     Tempo = aTmp57; |HAZ BoraTempo; |DELINDEX #57;

     |POPV;
     |HAZ PonBoton;
|FRUT;

|RUTINA CtrCal0;
     |PINPA #0#13;
     |PINDA #0#13;

     |SI nModoCali = 1;
          |LEE 000#13u;
          |SI FSalida = 0;
               nNume = #13#0 + 1;
          |SINO;
               nNume = 1;
          |FINSI;
          aAlfa = ("0000000" + nNume) % -107;
          |DDEFECTO #13;
          #13#0 = aAlfa;
          |ENCAMPO #0#13;
          |SI FSalida = 0;
               aBorra13 = "S";
               |LEE 101#13=;
               |SI FSalida = 0;
                    |PINDA #0#13;
                    |MENAV "0000La ficha ya existe";
                    aBorra13 = "N";
               |SINO;
                    |GRABA 020#13b;
               |FINSI;
               |ENDATOS #1#13;
               |SI FSalida = 0;
                    |GRABA 020#13a;
               |SINO;
                    |SI aBorra13 = "S";
                         |BORRA 020#13c;
                    |FINSI;
               |FINSI;
          |FINSI;
     |SINO;
          |ENDATOS #2#13;
          |SI FSalida = 0;
               |GRABA 020#13a;
          |FINSI;
     |FINSI;
     |CONFI "0000NImprimir control calidad";
     |SI FSalida = 0;
          eaRegistro = #13#0;
          |SUB_EJECUTA_NP "bogey001";
     |FINSI;
|FRUT;

|RUTINA CtrCal;
     |MENSA "0000Control calidad";
     |HAZ QuitaBoton;
     |PUSHV 0501 2380;
     |ABRE #13;
     |DDEFECTO #13;
     |PINPA #0#13;
     |PINDA #0#13;
     |MENU aMenua;
     |SI FSalida = 1;    || Alta
          nModoCali = 1;
          |HAZ CtrCal0;
     |FINSI;
     |SI FSalida = 2;    || Consulta
          |LEE 000#13p;
       |ET Otra13;
          |CONSULTA_CLAVE #1#13;
          |SI FSalida = 0;
               |PINPA #0#13;
               |PINDA #0#13;
               |MENU aMenub;
               |SI FSalida = 1;    || Alta
                    |DDEFECTO #13;
                    nModoCali = 1;
                    |HAZ CtrCal0;
               |FINSI;
               |SI FSalida = 2;    || Baja
                    |CONFI "0000NBorrar control calidad?";
                    |SI FSalida = 0;
                         |BORRA 020#13c;
                    |FINSI;
               |FINSI;
               |SI FSalida = 3;    || Modi
                    nModoCali = 2;
                    |HAZ CtrCal0;
               |FINSI;
               |SI FSalida = 4;    || Imprimir
                    |LIBERA #13;
                    eaRegistro = #13#0;
                    |SUB_EJECUTA_NP "bogey001";
               |FINSI;
               |SI FSalida = 5; |VETE Otra13; |FINSI;
          |FINSI;
     |FINSI;
     |CIERRA #13;
     |POPV;
     |HAZ PonBoton;
|FRUT;


|PROCESO Borra16;
     |BORRA 020#16a;

     #6#0 = #16#0;
     #6#1 = #16#1;
     #6#2 = #16#2;
     |LEE 121#6=;
     |SI FSalida = 0;
          #6#13 = #6#13 - #16#6;
          |GRABA 020#6a;
     |FINSI;
|FPRC;

|DEFBUCLE Borra16;
     #16#1;
     ;
     #15#0, #15#24, 001;
     #15#0, #15#24, 999;
     be;
     NULL, Borra16;
|FIN;

|PROCESO Min16;
     #16#0 = #15#0;
     #16#1 = #15#24;
     #16#2 = 1;
|FPRC;

|PROCESO Max16;
     #16#0 = #15#0;
     #16#1 = #15#24;
     #16#2 = 999;
|FPRC;

|PROCESO CargaLinEntra;
     |PARA i = 0; |SI i [ 8; |HACIENDO i = i + 1;
          #16i = #6i;
     |SIGUE;
     #16#0 = #15#0;
     #16#1 = #15#24;
     #16#11 = #6#14;
     #16#12 = #6#15;
     #16#13 = #6#16;
     #16#17 = #15#26;

     #16#6 = #6#6 - #6#13; || Unidades
     #16#9 = #112#64;
     #16#10 = #6#1;
     |SI #16#6 ! 0;
          |GRABA 020#16n;

          #6#13 = #6#13 + #16#6;
          |GRABA 020#6a;
     |FINSI;
     |LIBERA #6;
|FPRC;

|DEFBUCLE CargaLinEntra;
     #6#1;
     ;
     #60#0, nRecogida, 001;
     #60#0, nRecogida, 999;
     be;
     NULL, CargaLinEntra;
|FIN;

|RUTINA EntCamara0;
     |HAZ CreaTempo; aTmp52 = Tempo; |NOME_DAT #52#Tempo#; |DELINDEX #52;
     |HAZ CreaTempo; aTmp59 = Tempo; |NOME_DAT #59#Tempo#; |DELINDEX #59;

     |PUSHV 0501 2380;
     |SI aNueva = "S";
          nSwMarcaUna = 1;
          |HAZ EligeRecogida;
          nSwMarcaUna = 0;
          #15#0 = #60#0;
          #15#24 = 999999;
          |LEE 000#15];
          |SI FSalida = 0;
               |LEE 000#15a;
          |SINO;
               |LEE 000#15u;
          |FINSI;
          |SI FSalida = 0; |Y #15#0 = #60#0;
               nUltNumero = #15#24 + 1;
          |SINO;
               nUltNumero = 1;
          |FINSI;

          |DDEFECTO #15;
          #15#0 = #60#0;
          #15#24 = nUltNumero;
          |GRABA 020#15b;
          |SI nRecogida = 0;
               |ABRE #20;
               #20#0 = #60#0;
               #20#33 = #60#9;
               |LEE 020#20=;
               |CIERRA #20;
               #15#34 = #60#9; || subrefe
               #15#25 = #20#31;
               #15#2 = #20#5;
               #15#3 = #20#6;
               #15#14 = #20#7;
               #15#15 = #20#8;
               #15#12 = #20#9;
               #15#13 = #20#10;
               #15#18 = #20#21;
               #15#19 = #20#22;
          |SINO;
               |ABRE #5;
               #5#0 = #60#0;
               #5#25 = nRecogida;
               |LEE 020#5=;
               |CIERRA #5;

               |ABRE #112;
               #112#0 = #5#2;
               |LEE 000#112=;
               |CIERRA #112;

               #15#2 = #5#2;
               #15#3 = #5#3;
               #15#4 = #5#5;
               #15#5 = #5#6;
               #15#6 = #5#7;
               #15#7 = #5#8;
               #15#8 = #5#9;
               #15#9 = #5#10;
               #15#10 = #5#11;
               #15#11 = #5#12;
               #15#12 = #5#13;
               #15#13 = #5#14;
               #15#14 = #5#15;
               #15#15 = #5#16;
               #15#16 = #5#17;
               #15#17 = #5#18;
               #15#18 = #5#19;
               #15#19 = #5#20;
               #15#20 = #5#21;
               #15#21 = #5#22;
               #15#22 = #5#23;
               #15#23 = #5#24;

               #15#25 = #5#26;
               #15#26 = #5#28;
               #15#27 = #5#29;
               #15#28 = #5#30;
               #15#29 = #5#31;
               #15#30 = #5#32;
               #15#31 = #5#33;
               #15#32 = #5#34;

               #15#33 = #5#35;
               #15#34 = #5#36;

               |ABRE #16;
               |BUCLE CargaLinEntra;
               |CIERRA #16;
          |FINSI;
          |PINPA #0#15;
          |PINDA #0#15;
          |ENDATOS #2#15;
          |SI FSalida = 0;
               |SI FSalida = 0;
                    |ENTLINEAL #1#16, 3, 2, 22, 1, Min16, Max16;
                    |CONFI "0000NImprimir Entrada Orden a Camara?";
                    |SI FSalida = 0;
                         |HAZ ImpEntCamara;
                    |FINSI;
               |FINSI;
               |GRABA 020#15a;
               |ABRE #225;
               |HAZ LlenaEntrada;
               |CIERRA #225;
          |SINO;
               aNueva = "";
               |ERROR;

               |BORRA 020#15c;
               |ABRE #6;
               |BUCLE Borra16;
               |CIERRA #6;
          |FINSI;
     |SINO;         || Existe
          #15#0 = #53#0;
          #15#24 = #53#1;
          |LEE 121#15=;

          |PINPA #0#15;
          |PINDA #0#15;
          |MENU aMenuc;
          nSal = FSalida;
          |SI nSal = 1;
               |ENDATOS #2#15;
               |SI FSalida = 0;
                    |ENTLINEAL #1#16, 3, 2, 22, 1, Min16, Max16;
                    |GRABA 020#15a;
                    |SI FSalida = 0;
                         |CONFI "0000NImprimir Entrada Orden a Camara?";
                         |SI FSalida = 0;
                              |HAZ ImpEntCamara;
                         |FINSI;
                    |FINSI;
               |FINSI;
          |FINSI;
          |SI nSal = 2;
               |CONFI "0000NBorrar Entrada Orden a Camara?";
               |SI FSalida = 0;
                    |BORRA 020#53a;
                    |BORRA 020#15a;
                    |ABRE #6;
                    |BUCLE Borra16;
                    |CIERRA #6;
               |FINSI;
          |FINSI;
          |SI nSal = 3;
               |ENTLINEAL #1#16, 3, 2, 22, 1, Min16, Max16;
               |GRABA 020#15a;
          |FINSI;
          |SI nSal = 4;
               |HAZ ImpEntCamara;
          |FINSI;
     |FINSI;
     |POPV;
     Tempo = aTmp52; |HAZ BoraTempo; |DELINDEX #52;
     Tempo = aTmp59; |HAZ BoraTempo; |DELINDEX #59;
|FRUT;

|PROCESO LlenaEntrada;
     |DDEFECTO #225;
     #225#0 = #15#25;
     |LEE 000#225=;

     #53#0 = #15#0;
     #53#1 = #15#24;
     #53#2 = #15#33;
     #53#3 = #15#34;
     #53#4 = #15#2;
     #53#5 = #15#3;
     #53#6 = #225#0;
     #53#7 = #225#1;
     |GRABA 020#53n;
|FPRC;

|DEFBUCLE LlenaEntrada;
     #15#1;
     ;
     #20#0, 001;
     #20#0, 999;
     ;
     NULL, LlenaEntrada;
|FIN;

|PROCESO Min53;
     #53#0 = #60#0;
     #53#1 = 1;
|FPRC;

|PROCESO Max53;
     #53#0 = #60#0;
     #53#1 = 999;
|FPRC;

|PROCESO EntCamara; ||F5
     |ABRE #5;
     #5#0 = #60#0;
     #5#25 = 0;
     |LEE 000#5];
     |SI FSalida ! 0; |O #5#0 ! #60#0;
          |MENAV "0000No existe confirmacion de recogida...";
          ||ACABA;
     |FINSI;
     |CIERRA #5;

     |MENSA "0000Orden Entrada Camara";
     |HAZ QuitaBoton;

     |HAZ CreaTempo; aTmp53 = Tempo; |NOME_DAT #53#Tempo#; |DELINDEX #53;

     |PUSHV 0501 2380;
     |ABRE #15;
     #15#0 = #60#0;
     #15#24 = 0;
     |LEE 000#15];
     |SI FSalida = 0; |Y #15#0 = #60#0;
          |ABRE #53;
          |ABRE #225;
          |BUCLE LlenaEntrada;
          |CIERRA #225;
          |CIERRA #53;
          |PINPA #0#53;
          |PINTA 714, #15#0;
          |ENTLINEAL #1#53, 2, 1, 22, 0, Min53, Max53;
     |SINO;
          |ABRE #53;
          aNueva = "S";
          |HAZ EntCamara0;
          |CIERRA #53;
     |FINSI;
     |CIERRA #15;
     Tempo = aTmp53; |HAZ BoraTempo; |DELINDEX #53;

     |POPV;
     |HAZ PonBoton;
|FPRC;

|PROCESO Borra6;
     |SI nSwCheq = 1;
          |SI #6#12 ! 0; |O #6#13 ! 0;
               nHay = 1;
               |ERROR10;
          |FINSI;
     |SINO;
          |BORRA 020#6a;

          #23#0 = #6#0;
          #23#15 = #5#35;
          #23#1 = #5#36;
          |LEE 101#23=;
          |SI FSalida = 0;
               #23#16 = #23#16 - #6#6;
               |GRABA 020#23a;
               |LIBERA #23;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE Borra6;
     #6#1;
     ;
     #5#0, #5#25, 001;
     #5#0, #5#25, 999;
     be;
     NULL, Borra6;
|FIN;

|PROCESO Min6;
     #6#0 = #5#0;
     #6#1 = #5#25;
     #6#2 = 1;
|FPRC;

|PROCESO Max6;
     #6#0 = #5#0;
     #6#1 = #5#25;
     #6#2 = 999;
|FPRC;

|RUTINA ConRec0;
     |PUSHV 0501 2380;
     |SI aNueva = "S";
          #5#0 = #20#0;
          #5#25 = 999999;
          |LEE 000#5];
          |SI FSalida = 0;
               |LEE 000#5a;
          |SINO;
               |LEE 000#5u;
          |FINSI;
          |SI FSalida = 0; |Y #5#0 = #20#0;
               nUltNumero = #5#25 + 1;
          |SINO;
               nUltNumero = 1;
          |FINSI;
          |DDEFECTO #5;
          #5#0 = #20#0;
          #5#25 = nUltNumero;
          |GRABA 020#5b;
          |PINPA #0#5;
          |PINDA #0#5;
          |C_M #5#35, 1, "S";
          |C_M #5#36, 1, "S";
          |ENDATOS #1#5;
          |SI FSalida = 0;
               |SI FSalida = 0;
                    |ENTLINEAL #1#6, 3, 1, 22, 1, Min6, Max6;
                    |CONFI "0000NImprimir Confirmacion Recogida";
                    |SI FSalida = 0;
                         |HAZ ImpConRec;
                    |FINSI;
               |FINSI;
               |GRABA 020#5a;

               |ABRE #225;
               |HAZ LlenaConRecoge;
               |CIERRA #225;
          |SINO;
               aNueva = "";
               |ERROR;
               |BORRA 020#5c;
          |FINSI;
     |SINO;
          #5#0 = #50#0;
          #5#25 =  #50#1;
          |LEE 121#5=;

          |PINPA #0#5;
          |PINDA #0#5;
          |MENU aMenuc;
          nSal = FSalida;
          |SI nSal = 1;
               |C_M #5#35, 1, "N";
               |C_M #5#36, 1, "N";
               |ENDATOS #2#5;
               |SI FSalida = 0;
                    |ENTLINEAL #1#6, 3, 2, 22, 1, Min6, Max6;
                    |GRABA 020#5a;
                    |SI FSalida = 0;
                         |CONFI "0000NImprimir Confirmacion Recogida";
                         |SI FSalida = 0;
                              |HAZ ImpConRec;
                         |FINSI;
                    |FINSI;
               |FINSI;
          |FINSI;
          |SI nSal = 2;
               |CONFI "0000NBorrar confirmacion recogida?";
               |SI FSalida = 0;
                    nSwCheq = 1;
                    nHay = 0;
                    |ABRE #23;
                    |BUCLE Borra6;
                    |SI nHay = 0;
                         nSwCheq = 0;
                         |BUCLE Borra6;
                         |BORRA 020#50a;
                         |BORRA 020#5a;
                    |SINO;
                         |MENAV "0000Hay unidades asignadas. No se puede borrar.";
                    |FINSI;
                    |CIERRA #23;
               |FINSI;
          |FINSI;
          |SI nSal = 3;
               |ENTLINEAL #1#6, 3, 2, 22, 1, Min6, Max6;
               |GRABA 020#5a;
          |FINSI;
          |SI nSal = 4;
               |HAZ ImpConRec;
          |FINSI;
     |FINSI;
     |POPV;
|FRUT;

|PROCESO LlenaConRecoge;
     |DDEFECTO #225;
     #225#0 = #5#26;
     |LEE 000#225=;

     #50#0 = #5#0;
     #50#1 = #5#25;
     #50#2 = #5#35;
     #50#3 = #5#36;
     #50#4 = #5#2;
     #50#5 = #5#3;
     #50#6 = #225#0;
     #50#7 = #225#1;
     |GRABA 020#50n;
|FPRC;

|DEFBUCLE LlenaConRecoge;
     #5#1;
     ;
     #60#0, 001;
     #60#0, 999;
     ;
     NULL, LlenaConRecoge;
|FIN;

|PROCESO CargaLinAlba;
     |SI #59#13 ! "*";
          |ACABA;
     |FINSI;

     |DDEFECTO #5;
     #5#0 = #59#0;
     #5#25 = #59#1;
     |LEE 000#5=;

     nLin = nLin + 1;
     |DDEFECTO #25;
     #25#0 = #24#0;
     #25#14 = #24#17;
     #25#1 = nLin;
     #25#3 = #5#15;
     #25#4 = #5#16;
     #25#5 = #59#6;
     #25#6 = #59#7;
     |SI nPrimeLin = #59#2; |Y nPrimeRec = #59#1;
          #25#8 = #5#19;      ||Solo asigna las cajas y palets al
          #25#9 = #5#20;      ||primer lote (la 1§ linea de la confirmacion)
     |FINSI;
     #25#10 = #5#21;
     #25#11 = #5#22;
     #25#12 = #5#23;
     #25#13 = #5#24;
     #25#15 = #5#35;
     #25#16 = #5#36;
     #25#17 = #59#1;
     #25#18 = #59#2;
     #25#19 = #59#3;
     #25#20 = #59#4; #25#23 = #59#15; #25#24 = #59#16; #25#25 = #59#17;
     #25#21 = #5#38;
     #25#22 = #5#39;
     #25#7 = (#25#5 * #25#6) + (#25#8 * #25#21) + (#25#9 * #25#22);
     |GRABA 020#25n;

     #6#0 = #59#0;
     #6#1 = #59#1;
     #6#2 = #59#2;
     |LEE 101#6=;
     |SI FSalida = 0;
          #6#12 = #6#12 + #25#5;
          |GRABA 020#6a;
          |LIBERA #6;
     |FINSI;

     #5#0 = #6#0;
     #5#25 = #6#1;
     |LEE 101#5=;
     |SI FSalida = 0;
          #23#0 = #5#0;
          #23#15 = #5#35;
          #23#1 = #5#36;
          |LEE 101#23=;
          |SI FSalida = 0;
               #23#14 = #23#14 + #25#5;
               #23#18 = #23#18 + #25#8;
               #23#19 = #23#19 + #25#9;
               |GRABA 020#23a;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE CargaLinAlba;
     #59#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, CargaLinAlba;
|FIN;

|PROCESO Min50;
     #50#0 = #20#0;
     #50#1 = 1;
|FPRC;

|PROCESO Max50;
     #50#0 = #20#0;
     #50#1 = 999;
|FPRC;

|PROCESO ConRec;
     nSwPedido = 0;
     |ABRE #3;
     #3#0 = #60#0;
     #3#18 = 0;
     |LEE 000#3];
     |SI FSalida ! 0; |O #3#0 ! #60#0;
          nSwPedido = 1;
          |MENAV "0000No existe pedido de compras...";
          ||ACABA;
     |FINSI;
     |CIERRA #3;

     |MENSA "0000Confirma recogida";
     |HAZ QuitaBoton;

     |HAZ CreaTempo; aTmp50 = Tempo; |NOME_DAT #50#Tempo#; |DELINDEX #50;

     |PUSHV 0501 2380;
     |ABRE #5;

  |ET OtraConRec;
     #5#0 = #20#0;
     #5#25 = 0;
     |LEE 000#5];
     |SI FSalida = 0; |Y #5#0 = #20#0;
          |ABRE #50;
          |ABRE #225;
          |BUCLE LlenaConRecoge;
          |CIERRA #225;
          |CIERRA #50;
          |PINPA #0#50;
          |PINTA 714, #5#0;
          |ENTLINEAL #1#50, 2, 1, 22, 0, Min50, Max50;
          |SI nSwAdj = 1;
               nSwAdj = 0;
               |HAZ AdjConRec;
               |DELINDEX #50;
               |VETE OtraConRec;
          |FINSI;
     |SINO;
          |SI nSwPedido ! 0;
               |ABRE #50;
               aNueva = "S";
               |HAZ ConRec0;
               |CIERRA #50;
          |SINO;
               |HAZ AdjConRec;
          |FINSI;
     |FINSI;
     |CIERRA #5;
     Tempo = aTmp50; |HAZ BoraTempo; |DELINDEX #50;

     |POPV;
     |HAZ PonBoton;
|FPRC;

|PROCESO Borra25;
     |SI #24#20 = "N";
          #23#0 = #25#0;
          #23#15 = #25#15;
          #23#1 = #25#16;
          |LEE 101#23=;
          |SI FSalida = 0;
               #23#14 = #23#14 - #25#5;
               #23#18 = #23#18 - #25#8;
               #23#19 = #23#19 - #25#9;
               |GRABA 020#23a;
          |FINSI;
     |SINO;
          #6#0 = #25#0;
          #6#1 = #25#17;
          #6#2 = #25#18;
          |LEE 101#6=;
          |SI FSalida = 0;
               #6#12 = #6#12 - #25#5;
               |GRABA 020#6a;
               |LIBERA #6;
          |FINSI;
          #5#0 = #6#0;
          #5#25 = #6#1;
          |LEE 101#5=;
          |SI FSalida = 0;
               #23#0 = #5#0;
               #23#15 = #5#35;
               #23#1 = #5#36;
               |LEE 101#23=;
               |SI FSalida = 0;
                    #23#14 = #23#14 - #25#5;
                    #23#18 = #23#18 - #25#8;
                    #23#19 = #23#19 - #25#9;
                    |GRABA 020#23a;
               |FINSI;
          |FINSI;
     |FINSI;

     |BORRA 020#25a;
     |LIBERA #25;
|FPRC;

|DEFBUCLE Borra25;
     #25#1;
     ;
     #24#0, #24#17, 001;
     #24#0, #24#17, 999;
     be;
     NULL, Borra25;
|FIN;

|PROCESO Min25;
     #25#0 = #24#0;
     #25#14 = #24#17;
     #25#1 = 1;
|FPRC;

|PROCESO Max25;
     #25#0 = #24#0;
     #25#14 = #24#17;
     #25#1 = 999;
|FPRC;

|PROCESO BusPediCom;
     |SI #59#13 = "*";
          nPedido = #59#14;
          |ERROR10;
     |FINSI;
|FPRC;

|DEFBUCLE BusPediCom;
     #59#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, BusPediCom;
|FIN;

|RUTINA AlbCom0;
     aGuarda = FEntrada;
     |PUSHV 0501 2380;

     |ABRE #5;
     #5#0 = #60#0;
     #5#25 = #60#9;
     |LEE 000#5];
     |SI FSalida ! 0; |O #5#0 ! #60#0;
          aConRecoge = "N";
     |SINO;
          aConRecoge = "S";
     |FINSI;
     |CIERRA #25;

     |DDEFECTO #77;
     |ABRE #77;
     #77#50 = #24#18;
     #77#0 = #24#19;
     |LEE 000#77=;
     |CIERRA #77;

     |PINPA #0#24;
     |SI aNueva = "S";
          |HAZ CreaTempo; aTmp52 = Tempo; |NOME_DAT #52#Tempo#; |DELINDEX #52;
          |HAZ CreaTempo; aTmp59 = Tempo; |NOME_DAT #59#Tempo#; |DELINDEX #59;
          |SI aConRecoge = "N";
               |MENAV "0000No existe confirmacion de recogida";
               nRecogida = -1;
          |SINO;
               nSwAlba = 1;
               |HAZ EligeRecogida;
               nSwAlba = 0;
          |FINSI;
          |SI nRecogida = 0;
               aNueva = "";
          |SINO;
               #24#0 = #60#0;
               #24#17 = 999;
               |LEE 000#24];
               |SI FSalida = 0;
                    |LEE 000#24a;
               |SINO;
                    |LEE 000#24u;
               |FINSI;
               |SI FSalida = 0; |Y #24#0 = #60#0;
                    nUltNumero = #24#17 + 1;
               |SINO;
                    nUltNumero = 1;
               |FINSI;

               |SI nRecogida = -1;
                    |ABRE #20;
                    #20#0 = #60#0;
                    #20#33 = #60#9;
                    |LEE 020#20=;
                    |CIERRA #20;

                    |DDEFECTO #24;
                    #24#0 = #60#0;
                    #24#16 = #20#31;
                    #24#2 = #20#5;
                    #24#3 = #20#6;
                    #24#8 = #20#12;
                    #24#9 = #20#13;

                    #24#17 = nUltNumero;
                    #24#20 = "N";
                    |GRABA 020#24b;
               |SINO;
                    |DDEFECTO #3;
                    |ABRE #3;
                    #3#0 = #60#0;
                    |SI aConRecoge = "N";
                         #3#18 = 0;
                         |LEE 000#3];        || Lee primer pedido
                    |SINO;
                         |BUCLE BusPediCom;
                         #3#19 = nPedido;
                         |LEE 000#3=;
                    |FINSI;
                    |CIERRA #3;

                    |DDEFECTO #24;
                    #24#0 = #60#0;
                    |PARA i = 2; |SI i [ 16; |HACIENDO i = i + 1;
                         #24i = #3i;
                    |SIGUE;
                    #24#21 = #3#21;

                    #24#17 = nUltNumero;
                    #24#20 = aConRecoge;
                    |GRABA 020#24b;
               |FINSI;

               |PINDA #0#24;
               |ENTLINEAL #1#25, 3, 7, 23, 0, Min25, Max25;
               |C_M #24#2, 1, "S";
               |C_M #24#18, 1, "S";
               |C_M #24#19, 1, "S";
               |ENDATOS #2#24;
               |SI FSalida = 0;
                    |SI aConRecoge = "S";
                         nLin = 0;
                         |ABRE #25;
                         |ABRE #6;
                         |ABRE #5;
                         |ABRE #23;
                         |BUCLE CargaLinAlba;
                         |CIERRA #23;
                         |CIERRA #5;
                         |CIERRA #6;
                         |CIERRA #25;
                    |FINSI;
                    |ENTLINEAL #1#25, 3, 1, 23, 0, Min25, Max25;
                    eaNueva = "S";
                    |HAZ CreaAlbCom;
                    |GRABA 020#24a;

                    |HAZ LlenaAlbCom;

                    |CONFI "0000NImprimir Albaran de Compras";
                    |SI FSalida = 0;
                         |HAZ ImpAlbCom;
                    |FINSI;
               |SINO;
                    aNueva = "";
                    |ABRE #23;
                    |ABRE #6;
                    |ABRE #5;
                    |BUCLE Borra25;
                    |CIERRA #5;
                    |CIERRA #6;
                    |CIERRA #23;
                    |BORRA 020#24c;
               |FINSI;
          |FINSI;
          Tempo = aTmp52; |HAZ BoraTempo; |DELINDEX #52;
          Tempo = aTmp59; |HAZ BoraTempo; |DELINDEX #59;
     |SINO;
          |PINDA #0#24;
          |ENTLINEAL #1#25, 3, 7, 23, 0, Min25, Max25;
          |MENU aMenuc;
          nSal = FSalida;
          |SI nSal = 1;       || Modi
               |PINDA #0#24;
               |C_M #24#2, 1, "N";
               |C_M #24#18, 1, "N";
               |SI #24#19 ! 0;
                    |C_M #24#19, 1, "N";
               |FINSI;
               |SI #77#38 = "S";       || Facturado
                    |ENDATOS #4#24;
               |SINO;
                    |ENDATOS #2#24;
               |FINSI;
               |SI FSalida = 0;
                    |SI #77#38 = "S";
                         |ENTLINEAL #1#25, 3, 4, 23, 0, Min25, Max25;
                    |SINO;
                         |ENTLINEAL #1#25, 3, 2, 23, 0, Min25, Max25;
                         eaBorCab = "N";
                         |HAZ BorraAlbCom;
                         eaNueva = "N";
                         |HAZ CreaAlbCom;
                         |GRABA 020#24a;
                    |FINSI;
                    |CONFI "0000NImprimir Albaran de Compras";
                    |SI FSalida = 0;
                         |HAZ ImpAlbCom;
                    |FINSI;
               |FINSI;
          |FINSI;
          |SI nSal = 2; || Baja
               |CONFI "0000NBorrar albaran de compra?";
               |SI FSalida = 0;
                    |SI #77#38 = "S";
                         |MENAV "0000Albaran facturado...";
                    |SINO;
                         |ABRE #23;
                         |ABRE #6;
                         |BUCLE Borra25;
                         |CIERRA #6;
                         |CIERRA #23;
                         |BORRA 020#24a;
                         |BORRA 020#71a;
                         eaBorCab = "S";
                         |HAZ BorraAlbCom;
                    |FINSI;
               |FINSI;
          |FINSI;
          |SI nSal = 3;
               |SI #77#38 = "S";
                    |ENTLINEAL #1#25, 3, 4, 23, 0, Min25, Max25;
               |SINO;
                    |ENTLINEAL #1#25, 3, 2, 23, 0, Min25, Max25;
                    eaBorCab = "N";
                    |HAZ BorraAlbCom;
                    eaNueva = "N";
                    |HAZ CreaAlbCom;
                    |GRABA 020#24a;
               |FINSI;
          |FINSI;
          |SI nSal = 4; || Impresion
               |HAZ ImpAlbCom;
          |FINSI;
     |FINSI;

     |POPV;
     FEntrada = aGuarda;
|FRUT;

|PROCESO LlenaAlbCom;
     #71#0 = #24#0;
     #71#1 = #24#17;
     #71#2 = #24#2;
     #71#3 = #24#3;
     #71#4 = #24#18;
     #71#5 = #24#19;
     |GRABA 020#71n;
|FPRC;

|DEFBUCLE LlenaAlbCom;
     #24#1;
     ;
     #60#0, 001;
     #60#0, 999;
     ;
     NULL, LlenaAlbCom;
|FIN;

|PROCESO Min71;
     #71#0 = #60#0;
     #71#1 = 1;
|FPRC;

|PROCESO Max71;
     #71#0 = #60#0;
     #71#1 = 999;
|FPRC;

|PROCESO AlbCom;
     |ABRE #3;
     #3#0 = #60#0;
     #3#18 = 0;
     |LEE 000#3];
     |SI FSalida ! 0; |O #3#0 ! #60#0;
          |MENAV "0000No existe pedido de compras...";
          ||ACABA;
     |FINSI;
     |CIERRA #3;

     |MENSA "0000Albaran de compras";
     |HAZ QuitaBoton;
     |PUSHV 0501 2380;
     |HAZ CreaTempo; aTmp71 = Tempo; |NOME_DAT #71#Tempo#; |DELINDEX #71;
     |ABRE #71;

     |ABRE #24;
     #24#0 = #60#0;
     #24#17 = 0;
     |LEE 000#24];
     |SI FSalida = 0; |Y #24#0 = #60#0;
          |BUCLE LlenaAlbCom;
          |PINPA #0#71;
          |PINTA 714, #71#0;
          |ENTLINEAL #1#71, 2, 1, 22, 0, Min71, Max71;
     |SINO;
          aNueva = "S";
          |HAZ AlbCom0;
     |FINSI;
     |CIERRA #24;

     |CIERRA #71;
     Tempo = aTmp71; |HAZ BoraTempo; |DELINDEX #71;
     |POPV;
     |HAZ PonBoton;
|FPRC;

|PROCESO Borra23;
     |BORRA 020#23a;
     |LIBERA #23;
|FPRC;

|DEFBUCLE Borra23;
     #23#1;
     ;
     #3#0, #3#18, 001;
     #3#0, #3#18, 999;
     be;
     NULL, Borra23;
|FIN;

|PROCESO Min23;
     #23#0 = #3#0;
     #23#15 = #3#18;
     #23#1 = 1;
|FPRC;

|PROCESO Max23;
     #23#0 = #3#0;
     #23#15 = #3#18;
     #23#1 = 999;
|FPRC;

|RUTINA PedCom0;
     aGuarda = FEntrada;
     |PUSHV 0501 2380;

     |PINPA #0#3;
     |PINDA #0#3;
     |SI aNueva = "S";
          #3#0 = #60#0;
          #3#18 = 999;
          |LEE 000#3];
          |SI FSalida = 0;
               |LEE 000#3a;
          |SINO;
               |LEE 000#3u;
          |FINSI;
          |SI FSalida = 0; |Y #3#0 = #60#0;
               nUltNumero = #3#18 + 1;
          |SINO;
               nUltNumero = 1;
          |FINSI;

          |ABRE #112;
          #112#0 = #20#5;
          |LEE 000#112=;
          |CIERRA #112;
          |ABRE #225;
          #225#0 = #20#31;
          |LEE 000#225=;
          |CIERRA #225;

          |DDEFECTO #3;
          #3#0 = #60#0;
          #3#1 = ~;
          #3#2 = #20#5;
          #3#3 = #20#6;
          #3#7 = #112#6;
          #3#8 = #20#12;
          #3#9 = #20#13;
          #3#10 = #112#23;
          #3#11 = #225#1;
          #3#15 = #112#7;
          #3#16 = #20#31;
          #3#18 = nUltNumero;
          |GRABA 020#3b;

          |PINDA #0#3;
          |ENTLINEAL #1#23, 3, 7, 22, 0, Min23, Max23;
          |C_M #3#2, 1, "S";
         || |ENDATOS #1#3;
          |ENDATOS #2#3;
          |SI FSalida = 0;
               |ENTLINEAL #1#23, 3, 1, 22, 0, Min23, Max23;
               eaNueva = "S";
               |HAZ CreaPedCom;
               |GRABA 020#3a;

               |HAZ LlenaPedCom;

               |CONFI "0000NImprimir Pedido de Compras";
               |SI FSalida = 0;
                    |HAZ ImpPedCom;
               |FINSI;
          |SINO;
               aNueva = "";
               |BUCLE Borra23;
               |BORRA 020#3c;
          |FINSI;
     |SINO;
          |PINDA #0#3;
          |ENTLINEAL #1#23, 3, 7, 22, 0, Min23, Max23;
          |MENU aMenuc;
          nSal = FSalida;
          |SI nSal = 1;       || Modi
               |PINDA #0#3;
               |C_M #3#2, 1, "N";
               |ENDATOS #2#3;
               |SI FSalida = 0;
                    |ENTLINEAL #1#23, 3, 2, 22, 0, Min23, Max23;

                    eaBorCab = "N";
                    |HAZ BorraPedCom;
                    eaNueva = "N";
                    |HAZ CreaPedCom;

                    |GRABA 020#3a;
                    |CONFI "0000NImprimir Pedido de Compras";
                    |SI FSalida = 0;
                         |HAZ ImpPedCom;
                    |FINSI;
               |FINSI;
          |FINSI;
          |SI nSal = 2; || Baja
               |ABRE #5;
               #5#0 = #60#0;
               #5#15 = 0;
               |LEE 000#5];
               |SI FSalida = 0; |Y #5#0 = #60#0;
                    |MENAV "0000Existe confirmacion recogida";
               |SINO;
                    |CONFI "0000NBorrar pedido de compra?";
                    |SI FSalida = 0;
                         |BUCLE Borra23;
                         |BORRA 020#3a;
                         |BORRA 020#70a;
                         eaBorCab = "S";
                         |HAZ BorraPedCom;
                    |FINSI;
               |FINSI;
               |CIERRA #5;
          |FINSI;
          |SI nSal = 3;
               |ENTLINEAL #1#23, 3, 2, 22, 0, Min23, Max23;
               eaBorCab = "N";
               |HAZ BorraPedCom;
               eaNueva = "N";
               |HAZ CreaPedCom;

               |GRABA 020#3a;
          |FINSI;
          |SI nSal = 4; || Impresion
               |HAZ ImpPedCom;
          |FINSI;
     |FINSI;

     |POPV;
     FEntrada = aGuarda;
|FRUT;

|PROCESO LlenaPedCom;
     #70#0 = #3#0;
     #70#1 = #3#18;
     #70#2 = #3#2;
     #70#3 = #3#3;
     |GRABA 020#70n;
|FPRC;

|DEFBUCLE LlenaPedCom;
     #3#1;
     ;
     #60#0, 001;
     #60#0, 999;
     ;
     NULL, LlenaPedCom;
|FIN;

|PROCESO Min70;
     #70#0 = #60#0;
     #70#1 = 1;
|FPRC;

|PROCESO Max70;
     #70#0 = #60#0;
     #70#1 = 999;
|FPRC;

|PROCESO PedCom;
     |HAZ QuitaBoton;
     |PUSHV 0501 2380;
     |HAZ CreaTempo; aTmp70 = Tempo; |NOME_DAT #70#Tempo#; |DELINDEX #70;
     |ABRE #70;

     |ABRE #3;
     #3#0 = #60#0;
     #3#18 = 0;
     |LEE 000#3];
     |SI FSalida = 0; |Y #3#0 = #60#0;
          |BUCLE LlenaPedCom;
          |PINPA #0#70;
          |PINTA 714, #70#0;
          |ENTLINEAL #1#70, 2, 1, 22, 0, Min70, Max70;
     |SINO;
          aNueva = "S";
          |HAZ PedCom0;
     |FINSI;
     |CIERRA #3;

     |CIERRA #70;
     Tempo = aTmp70; |HAZ BoraTempo; |DELINDEX #70;
     |POPV;
     |HAZ PonBoton;
|FPRC;

|PROCESO Min21;
     #21#0 = #20#0;
     #21#2 = "     ";
     #21#3 = 000000;
|FPRC;

|PROCESO Max21;
     #21#0 = #20#0;
     #21#2 = "zzzzz";
     #21#3 = 999999;
|FPRC;

|PROCESO Asigna60;
     #60#0 = #20#0;
     #60#1 = #20#5;
     #60#2 = #20#7;
     #60#9 = #20#33;
     #60#10 = #20#8;
 ||    |HAZ Totales60;
|FPRC;

|PROCESO Consulta;
     #20#0 = #bogez006@#0;
     #20#33 = #bogez006@#9;
     |LEE 000#20=;
     |SI FSalida = 0;
          |SALVA_DATOS #20;
          |REPON_DATOS #bogem020@;
          |GRABA 020#bogem020@.n;
     |FINSI;
|FPRC;

|DEFBUCLE Consulta;
     #bogez006@#1002;
     ;
     0000000, 001;
     9999999, 999;
     ;
     NULL, Consulta;
|FIN;

|PROCESO ImpreCompra;
     |PRINT;
|FPRC;

|DEFBUCLE ImpreCompra;
     #20#1;
     ;
     #60#0, #60#9;
     #60#0, #60#9;
     ;
     NULL, ImpreCompra;
|FIN;

|PROCESO ImpCompra;
     Impresora = "Crystal Reports";
     |IMPRE 0;
     |SI FSalida = 0;
          |INFOR aInfCompra;
          |SI FSalida ! 0;
               aAlfa = "0000Error en informe:" + aInfCompra;
               |MENAV aAlfa;
          |SINO;
               |BUCLE ImpreCompra;
               |PIEINF;
               |FININF;
          |FINSI;
          |FINIMP;
     |FINSI;
|FPRC;

|PROCESO TieneVentas;
     |ABRE #7;
     #7#0 = #60#0;
     #7#19 = 0;
     |LEE 000#7];
     |SI FSalida = 0; |Y #7#0 = #60#0;
          aAlfa = "0";
     |SINO;
          aAlfa = "1";
     |FINSI;
     |CIERRA #7;
     FSalida = aAlfa;
|FPRC;

|PROCESO TieneCompras;
     |ABRE #3;
     #3#0 = #60#0;
     #3#18 = 0;
     |LEE 000#3];
     |SI FSalida = 0; |Y #3#0 = #60#0;
          aAlfa = "0";
     |SINO;
          aAlfa = "1";
     |FINSI;
     |CIERRA #3;
     FSalida = aAlfa;
|FPRC;

|PROCESO TienePedLin;
     aAlfa = "0";
|FPRC;

|DEFBUCLE TienePedLin;
     #23#1;
     ;
     #60#0, 001, #60#9;
     #60#0, 999, #60#9;
     ;
     NULL, TienePedLin;
|FIN;

|PROCESO TieneComprasLin;
     aAlfa = "1";
     |BUCLE TienePedLin;
     FSalida = aAlfa;
|FPRC;

|PROCESO Tipo66; |TIPO 66;
     |DDEF aDef;
     aAlfa = aDef + "bogem020";
     |CARGA_DEF aAlfa, bogem020@;
     |SI FSalida = 0;
          aAlfa = aDef + "bogez006";
          |CARGA_DEF aAlfa, bogez006@;
          |SI FSalida = 0;
               |HAZ CreaTempo; |NOME_DAT #bogem020@#Tempo#; |DELINDEX #bogem020@;
               |NOME_DAT #bogez006@#eaTmp60#;
               |ABRE #bogem020@;
               |ABRE #20;
               |BUCLE Consulta;
               |CIERRA #20;
               #bogem020@#0 = #60#0;
               #bogem020@#33 = #60#9;
               |LEE 000#bogem020@.=;
               |CONSULTA_CLAVE #1#bogem020@;
               |SI FSalida = 0;
                    #60#0 = #bogem020@#0;
                    #60#9 = #bogem020@#33;
                    |LEE 020#60=;
                    |PONCONTROL 23, "SI";
                    nSwConsulta = 1;
               |SINO;
                    |ERROR;
               |FINSI;
               |CIERRA #bogem020@;
               |HAZ BoraTempo; |DELINDEX #bogem020@;
               |DESCARGA_DEF #bogez006@;
          |FINSI;
          |DESCARGA_DEF #bogem020@;
     |FINSI;
|FPRC;

|PROCESO Tipo2; |TIPO 2;
|FPRC;

|PROCESO Tipo7; |TIPO 7;
|FPRC;

|PROCESO Tipo11; |TIPO 11;
     aGuarda = FEntrada;

     nTecla = FSalida;

     |SI nTecla = 1; |Y Campo = 9; |ERROR; |PTEC 808; |FINSI;

     |SI nTecla < 10; |O nTecla > 18; |ACABA; |FINSI;

     |SI nTecla = 18; || F10
          |HAZ CtrCal;
          |ERROR;
     |SINO;
          |ABRE #20;
          #20#0 = #60#0;
          #20#33 = #60#9;
          |LEE 000#20=;
          |SI FSalida ! 0; |ERROR; |ACABA; |FINSI;
          |CIERRA #20;

          |SI nTecla = 10; |HAZ PedCom;    |ERROR; |FINSI; || F2
          |SI nTecla = 11; |HAZ ConRec;    |ERROR; |FINSI; || F3
          |SI nTecla = 12; |HAZ AlbCom;    |ERROR; |FINSI; || F4
          |SI nTecla = 13; |HAZ EntCamara; |ERROR; |FINSI; || F5

          |SI nTecla = 14; |HAZ PedVta;    |ERROR; |FINSI; || F6
          |SI nTecla = 15; |HAZ ConEnt;    |ERROR; |FINSI; || F7
          |SI nTecla = 16; |HAZ OrdSal;    |ERROR; |FINSI; || F8
          |SI nTecla = 17; |HAZ AlbVta;    |ERROR; |FINSI; || F9

          |SI nRefresca = 1;
               ||PONCONTROL 23, "SI";  no funciona!!!
               nRefresca = 0;
          |FINSI;
     |FINSI;

     FEntrada = aGuarda;
|FPRC;

|PROCESO Tipo0; |TIPO 0;
     |SI #60#9 > 99;
          |AVISO; |ERROR; |ACABA;  || No puede ser mayor !!
     |FINSI;

     aGuarda = FEntrada;
     |PUSHV 0501 2380;

     |DDEFECTO #20;
     |ABRE #20;
     #20#0 = #60#0;
     #20#33 = #60#9;
     |LEE 101#20=;
     |SI FSalida = 0;
          |LEE 000#60=;
          |SI FSalida = 0;
          |PINPA #0#20;
          |PINDA #0#20;
          |ENTLINEAL #1#21, 1, 7, 22, 0, Min21, Max21;
          |MENU aMenu;
          nSal = FSalida;
          |SI nSal = 1; || Modi
               |HAZ TieneComprasLin;
               |SI FSalida = 0;
                    |MENAV "0000No se puede modificar, hay documentos asignados...";
               |SINO;
                    |ENDATOS #2#20;
                    |SI FSalida = 0;
                         |HAZ Asigna60;
                         |GRABA 040#60a;
                         |GRABA 020#20a;
                    |FINSI;
               |FINSI;
          |FINSI;
          |SI nSal = 3;
               |HAZ ImpCompra;
          |FINSI;
          |SI nSal = 2; || Baja
               |HAZ TieneCompras;
               |SI FSalida = 0;
                    |MENAV "0000No se puede modificar, hay documentos asignados...";
                    |ERROR;
                    |PTEC 809; || flecha abajo
               |SINO;
                    |HAZ TieneVentas;
                    |SI FSalida = 0;
                         |MENAV "0000No se puede borrar, hay documentos asignados.";
                         |ERROR;
                    |SINO;
                         |BORRA 040#60a;
                         |BORRA 020#20a;
                         |PONCONTROL 23, "SI";
                    |FINSI;
               |FINSI;
          |SINO;
               |ERROR;
               |PTEC 809; || flecha abajo
          |FINSI;
          |SINO;
               |ERROR;
          |FINSI;
     |SINO;
          #20#3 = nDia;
          #20#4 = nMes;
          #20#29 = aA¤o;
          #20#30 = nSemana;
          #20#32 = ~;
          |HAZ MontaDiaSema;
          |GRABA 020#20b;
          |PINPA #0#20;
          |PINDA #0#20;
          |ENTLINEAL #1#21, 1, 7, 22, 0, Min21, Max21;
          |ENDATOS #1#20;
          |SI FSalida = 0;
               |HAZ Asigna60;
               |GRABA 020#60n;
               |GRABA 020#20a;
          |SINO;
               |BORRA 020#20c;
               |ERROR;
          |FINSI;
     |FINSI;
     |CIERRA #20;

     |POPV;
     FEntrada = aGuarda;
|FPRC;
------------------------------------------------------------------------
|PROCESO F2;
     |PTEC 824;
|FPRC;

|PROCESO F3;
     |PTEC 825;
|FPRC;

|PROCESO F4;
     |PTEC 826;
|FPRC;

|PROCESO F5;
     |PTEC 827;
|FPRC;

|PROCESO F6;
     |PTEC 828;
|FPRC;

|PROCESO F7;
     |PTEC 829;
|FPRC;

|PROCESO F8;
     |PTEC 830;
|FPRC;

|PROCESO F9;
     |PTEC 831;
|FPRC;

|PROCESO F10;
     |PTEC 832;
|FPRC;
------------------------------------------------------------------------
|PROCESO CargaTmp;
     |DDEFECTO #60;
     #60#0 = #20#0;
     #60#1 = #20#5;
     #60#2 = #20#7;
     #60#9 = #20#33;
     #60#10 = #20#8;
     |HAZ Totales60;

     |GRABA 020#60n;
     |GRABA 020#20a;
     |LIBERA #20;
     nHay = 1;
|FPRC;

|DEFBUCLE CargaTmp;
     #20#2;
     ;
     #0#2, #0#0, #0#4;
     #0#3, #0#1, #0#5;
     be;
     NULL, CargaTmp;
|FIN;

|PROCESO Min60;
     #60#0 = nDesde;
     #60#9 = 1;
|FPRC;

|PROCESO Max60;
     #60#0 = 9999999;
     #60#9 = 999;
|FPRC;

|PROCESO CalculaSemana;  || he copiado este calculo al plb "i_semana"
|| Norma ISO 8601
|| la semana 1 de cada a¤o es aquella en la que aparece
|| el primer jueves del a¤o
|| Ej: 02.01.2005 es la semana 53 del 2004

     fFecha = fDoc;
     aAlfa = fFecha % 704;
     aAlfa = "01.01." + aAlfa;
     fFecha = fDoc;
     nSemana = 0;
     nJueves = 0;
     |PARA f = aAlfa; |SI f [ fFecha; |HACIENDO f = f + 1;
          f1 = f;
          f1 = f % A1;
          aAlfa = f1 % 1101;
          |SI nJueves = 0;
               |SI aAlfa = "J"; nJueves = 1; nSemana = 1; |FINSI;
          |FINSI;
          |SI nJueves = 1;
               |SI aAlfa = "L"; nSemana = nSemana + 1; |FINSI;
          |FINSI;
     |SIGUE;
     |SI nSemana = 0;
          fFecha = fDoc;
          aAlfa = fFecha % 704;
          nNume = aAlfa;
          nNume = nNume - 1;
          aAlfa = ("0000" + nNume) % -104;
          aAlfa = "01.01." + aAlfa;
          fFecha = fDoc;
          nSemana = 0;
          nJueves = 0;
          |PARA f = aAlfa; |SI f [ fFecha; |HACIENDO f = f + 1;
               f1 = f;
               f1 = f % A1;
               aAlfa = f1 % 1101;
               |SI nJueves = 0;
                    |SI aAlfa = "J"; nJueves = 1; nSemana = 1; |FINSI;
               |FINSI;
               |SI nJueves = 1;
                    |SI aAlfa = "L"; nSemana = nSemana + 1; |FINSI;
               |FINSI;
          |SIGUE;
     |FINSI;
|FPRC;

|PROGRAMA;
     |CLS;
     |ABRE #142; |LEE 000#142p; |CIERRA #142;
     |ABRE #321; |LEE 000#321p; |CIERRA #321;
     |ABRE #30; |LEE 000#30p; |CIERRA #30;

     fDoc = ~;
     |HAZ CalculaSemana;
     #0#0 = nSemana;
     #0#1 = nSemana;
     fFecha = ~;
     aAlfa = fFecha % 102;
     nDia = aAlfa;
     aAlfa = fFecha % 402;
     nMes = aAlfa;
     aAlfa = fFecha % 704;
     aA¤o = aAlfa;
     #0#2 = aA¤o;
     #0#3 = aA¤o;

     |PINPA #0#0;
     |PINDA #0#0;
     |ENDATOS #1#0;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |CONTROL_SIMPLE 0, "BOTON,F2. Pedido Compra",     2202, 2221, F2; nBoton2 = FSalida;
     |CONTROL_SIMPLE 0, "BOTON,F3. Confirma Recogida", 2223, 2240, F3; nBoton3 = FSalida;
     |CONTROL_SIMPLE 0, "BOTON,F4. Albaran Compra",    2242, 2259, F4; nBoton4 = FSalida;
     |CONTROL_SIMPLE 0, "BOTON,F5. Orden Entrada",     2261, 2279, F5; nBoton5 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,F6. Pedido Venta",      2303, 2317, F6; nBoton6 = FSalida;
     |CONTROL_SIMPLE 0, "BOTON,F7.Confirma Entrega",  2319, 2332, F7; nBoton7 = FSalida;
     |CONTROL_SIMPLE 0, "BOTON,F8. Orden Salida",      2334, 2347, F8; nBoton8 = FSalida;
     |CONTROL_SIMPLE 0, "BOTON,F9. Albaran Venta",     2349, 2362, F9; nBoton9 = FSalida;
     |CONTROL_SIMPLE 0, "BOTON,F10. Control Calidad",  2364, 2378, F10; nBoton10 = FSalida;


     |HAZ CreaTempo; eaTmp60 = Tempo; |NOME_DAT #60 Tempo; |DELINDEX #60;
     |ABRE #60;
     |BUCLE CargaTmp;
     |CIERRA #60;

     nDesde = 1;
     |SI nHay = 0;
          |ABRE #20;
          |LEE 000#20u;
          |SI FSalida = 0;
               nDesde = #20#0;
               nDesde = nDesde + 1;
          |FINSI;
          |CIERRA #20;
     |FINSI;

     |ENTLINEAL #1#60, 1, 1, 20, 1, Min60, Max60;

     Tempo = eaTmp60; |HAZ BoraTempo; |DELINDEX #60;

     |FIN_CONTROL_WINDOWS nBoton2;
     |FIN_CONTROL_WINDOWS nBoton3;
     |FIN_CONTROL_WINDOWS nBoton4;
     |FIN_CONTROL_WINDOWS nBoton5;
     |FIN_CONTROL_WINDOWS nBoton6;
     |FIN_CONTROL_WINDOWS nBoton7;
     |FIN_CONTROL_WINDOWS nBoton8;
     |FIN_CONTROL_WINDOWS nBoton9;
     |FIN_CONTROL_WINDOWS nBoton10;


     |PULSATECLA;
|FPRO;

---------------------------------------------- bogew017
|PROCESO Transporte17_0; |TIPO 0;
     eaTransporte = #17#5;
     |HAZ Transporte0;
|FPRC;

|PROCESO Transporte17_66; |TIPO 66;
     eaTransporte = #17#5;
     |HAZ Transporte66;
     |SI eaTransporte = "";
          |ERROR;
     |SINO;
          #17#5 = eaTransporte;
          |PINTA #17#5;
     |FINSI;
|FPRC;

|PROCESO Consulta17; |TIPO 66;
     |ABRE #3;
     #3#0 = #17#0;
     #3#18 = #17#35;
     |LEE 000#3];
     |CONSULTA_F_CLAVE #1#3, Mina3, Maxa3;
     |SI FSalida = 0;
          #17#35 = #3#18; |PINTA #17#35;
     |SINO;
          |ERROR;
     |FINSI;
     |CIERRA #3;
|FPRC;

|PROCESO CheqPenPedCom17;
     |SI #23#16 < #23#5;
          nPend = 1;
          |ERROR10;
     |FINSI;
|FPRC;

|DEFBUCLE CheqPenPedCom17;
     #23#1;
     ;
     #17#0, #17#35, 000;
     #17#0, #17#35, 999;
     ;
     NULL, CheqPenPedCom17;
|FIN;

|PROCESO Defecto17; |TIPO 0;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo ! 1; |ACABA; |FINSI;

     nPend = 0;
     |BUCLE CheqPenPedCom17;
     |SI nPend = 0;
          |MENAV "0000No quedan unidades pendientes de asignar...";
          |ERROR; |ACABA;
     |FINSI;

     |ABRE #3;
     #3#0 = #17#0;
     #3#18 = #17#35;
     |LEE 000#3=;
     |SI FSalida = 0;
          |ABRE #112;
          #112#0 = #3#2;
          |LEE 000#112=;
          |CIERRA #112;
          |ABRE #225;
          #225#0 = #3#16;
          |LEE 000#225=;
          |CIERRA #225;

          #17#2 = #3#2; |PINTA #17#2;
          #17#3 = #3#3; |PINTA #17#3;
          #17#5 = #3#5; |PINTA #17#5;
          #17#6 = #3#6; |PINTA #17#6;
          #17#7 = #3#11; |PINTA #17#7;
          #17#26 = #3#16; |PINTA #17#26;
     |SINO;
          |MENAV "0000No existe pedido de compras...";
          |ERROR;
     |FINSI;
     |CIERRA #3;
|FPRC;


|PROCESO Min18;
     #18#0 = 1;
|FPRC;

|PROCESO Max18;
     #18#0 = 999;
|FPRC;

|PROCESO UltRecogida;
     #5#0 = #20#0;
     #5#25 = 999999;
     |LEE 000#5];
     |SI FSalida = 0;
          |LEE 000#5a;
     |SINO;
          |LEE 000#5u;
     |FINSI;
     |SI FSalida = 0; |Y #5#0 = #20#0;
          nUltNumero = #5#25 + 1;
     |SINO;
          nUltNumero = 1;
     |FINSI;
     |DDEFECTO #5;
     #5#0 = #20#0;
     #5#25 = nUltNumero;
     |GRABA 020#5b;
|FPRC;

|PROCESO Llena18;
     |DDEFECTO #19;
     #19#0 = #23#3;
     |LEE 000#19=;

     |DDEFECTO #600;
     #600#0 = #19#2;
     |LEE 000#600=;

     |DDEFECTO #18;
     #18#0 = #23#1;
     #18#1 = #600#0;
     #18#2 = #600#1;
     #18#3 = #23#3;
     #18#4 = #23#4;
     #18#5 = #23#8;
     #18#6 = #23#9;
     #18#7 = #23#10;
     #18#8 = #23#11;
     #18#9 = #23#12;
     #18#10 = #23#13;
     #18#15 = #23#20;
     #18#16 = #23#21;
     |HAZ UltRecogida;
     #18#17 = #5#25;
     |GRABA 020#18n;

     #5#1 = #17#1;
     #5#2 = #17#2;
     #5#3 = #17#3;
     #5#4 = #17#4;
     #5#5 = #17#5;
     #5#6 = #17#6;
     #5#7 = #17#7;
     #5#8 = #17#8;
     #5#9 = #17#9;
     #5#10 = #17#10;
     #5#11 = #17#11;
     #5#12 = #17#12;
     #5#13 = #18#1;
     #5#14 = #18#2;
     #5#15 = #18#3;
     #5#16 = #18#4;
     #5#19 = #18#5;
     #5#20 = #18#6;
     #5#21 = #18#7;
     #5#22 = #18#8;
     #5#23 = #18#9;
     #5#24 = #18#10;
     #5#26 = #17#26;
     #5#27 = #17#27;
     #5#28 = #17#28;
     #5#29 = #17#29;
     #5#30 = #17#30;
     #5#31 = #17#31;
     #5#35 = #17#35;
     #5#36 = #18#0;
     #5#37 = #17#37;
     #5#38 = #18#15;
     #5#39 = #18#16;
     |GRABA 020#5a;
     |LIBERA #5;
|FPRC;

|DEFBUCLE Llena18;
     #23#1;
     ;
     #17#0, #17#35, 001;
     #17#0, #17#35, 999;
     ;
     NULL, Llena18;
|FIN;

|PROCESO AdjConRec;
     |HAZ CreaTempo; aTmp18 = Tempo;
     |HAZ CreaTempo; aTmp19 = Tempo;
     |NOME_DAT #18 aTmp18;
     |NOME_DAT #19 aTmp19;
     |DELINDEX #18;
     |DELINDEX #19;

     |PUSHV 0501 2380;

     #17#0 = #20#0;

     |PINPA #0#17;
     |PINDA #0#17;
     |ENTLINEAL #1#18, 1, 7, 22, 0, Min18, Max18;
     |ENDATOS #1#17;
     |SI FSalida = 0;
          |ABRE #19;
          |ABRE #18;
          |ABRE #600;
          |ABRE #5;
          |BUCLE Llena18;
          |CIERRA #600;
          |CIERRA #18;
          |CIERRA #19;
          |ABRE #6;
          |ENTLINEAL #1#18, 1, 4, 22, 0, Min18, Max18;
          |CIERRA #6;
          |CIERRA #5;
     |FINSI;
     |POPV;

     Tempo = aTmp18; |HAZ BoraTempo;
     Tempo = aTmp19; |HAZ BoraTempo;
     |DELINDEX #18;
     |DELINDEX #19;
|FPRC;

|PROCESO Min19;
     #19#0 = #18#0;
     #19#1 = 1;
|FPRC;

|PROCESO Max19;
     #19#0 = #18#0;
     #19#1 = 999;
|FPRC;
---------------------------------------------- bogew018
|PROCESO Tipo18_0; |TIPO 0;
     |SI FSalida = 0; |Y #18Campo = Contenido;
          |PUSHV 0501 2380;
          |ENTLINEAL #1#19, 2, 1, 22, 1, Min19, Max19;
          |POPV;
     |FINSI;
|FPRC;

---------------------------------------------- bogew019
|PROCESO Tipo19_7; |TIPO 7;
     #19#12 = #18#3; |PINTA #19#12;
     #19#13 = #18#4; |PINTA #19#13;
|FPRC;

|PROCESO Tipo19_0; |TIPO 0;
     nModo = (FEntrada / 100) ! 0;

     |SI nModo = 1;
          aAlfa = (("0000000" + #17#0) % -107) + (("000" + #18#17) % -102) + (("000" + #19#1) % -103)
          #19#2 = aAlfa; |PINTA aAlfa;
          |ABRE #23;
          #23#0 = #17#0;
          #23#15 = #17#35;
          #23#1 = #18#0;
          |LEE 121#23=;
          |SI FSalida = 0;
               #19#5 = #23#5 - #23#16; |PINTA #19#5;
               #19#6 = #23#6; |PINTA #19#6;
          |FINSI;
          |CIERRA #23;
     |FINSI;
|FPRC;

|PROCESO Tipo19_2; |TIPO 2;
     nModo = (FEntrada / 100) ! 0;
     #5#0 = #17#0;
     #5#25 = #18#17;
     |LEE 121#5=;

     |DDEFECTO #6;
     #6#0 = #17#0;
     #6#1 = #18#17;
     #6#2 = #19#1;
     |LEE 101#6=;
     |SI FSalida ! 0; |GRABA 020#6b; |FINSI;

     #6#3 = #19#2;
     #6#4 = #19#3;
     #6#5 = #19#4;
     #6#6 = #19#5;
     #6#7 = #19#6;
     #6#8 = #19#7;
     #6#9 = #19#8;
     #6#14 = #19#9;
     #6#15 = #19#10;
     #6#16 = #19#11;

     #5#32 = #5#32 +. #6#6;
     #5#33 = #5#33 +. #6#8;
     #5#34 = #5#34 +. #6#9;

     #6#9 = #5#27 / #6#6;

     |SI nModo = 3;
          |BORRA 020#6c;
     |SINO;
          |GRABA 020#6a;
     |FINSI;
     |LIBERA #6;

     |GRABA 020#5a;
     |LIBERA #5;

     |ABRE #23;
     #23#0 = #17#0;
     #23#15 = #17#35;
     #23#1 = #18#0;
     |LEE 121#23=;
     |SI FSalida = 0;
          #23#16 = #23#16 +. #6#6;
          |GRABA 020#23a;
     |FINSI;
     |CIERRA #23;
|FPRC;

|PROCESO Total19; |TIPO 0;
     #19#7 = #19#6 * #19#5; |PINTA #19#7;
|FPRC;

|PROCESO CheqUni19; |TIPO 0;
     nModo = (FEntrada / 100) ! 0;
     |ABRE #23;
     #23#0 = #17#0;
     #23#15 = #17#35;
     #23#1 = #18#0;
     |LEE 101#23=;
     |SI FSalida = 0;
          #23#16 = #23#16 + #19#5;
          |SI #23#16 > #23#5;
               nNume = #23#16 - #23#5;
               aAlfa = "0000Se superan las unidades pedidas en: " + nNume;
               |MENAV aAlfa;
               |ERROR;
          |FINSI;
     |SINO;
          |MENAV "0000No existe linea de pedido compras...";
          |ERROR;
     |FINSI;
     |CIERRA #23;
|FPRC;
***********************************************************

|PROCESO TPedCom;
     nKilos = nKilos + #23#5;
     nCoste = nCoste + #23#7;
     nHayCom = 1;
|FPRC;

|DEFBUCLE TPedCom;
     #23#1;
     ;
     #60#0, 000, #60#9;
     #60#0, 999, #60#9;
     ;
     NULL, TPedCom;
|FIN;

|PROCESO TConRecLin;
     nKilos = nKilos + #6#6;
     nCoste = nCoste + #6#8;
     nHayCom = 1;
|FPRC;

|DEFBUCLE TConRecLin;
     #6#1;
     ;
     #5#0, #5#25, 001;
     #5#0, #5#25, 999;
     ;
     NULL, TConRecLin;
|FIN;

|PROCESO TConRec;
     |BUCLE TConRecLin;
|FPRC;

|DEFBUCLE TConRec;
     #5#1;
     36;
     #60#0, 000, #60#9;
     #60#0, 999, #60#9;
     ;
     NULL, TConRec;
|FIN;

|PROCESO TAlbCom;
     nKilos = nKilos + #25#5;
     nCoste = nCoste + #25#7;
     nHayCom = 1;
|FPRC;

|DEFBUCLE TAlbCom;
     #25#1;
     ;
     #60#0, 000, #60#9;
     #60#0, 999, #60#9;
     ;
     NULL, TAlbCom;
|FIN;

|PROCESO TOrdEntLin;
     nKilos = nKilos + #16#6;
     nCoste = nCoste + #16#8;
     nHayCom = 1;
|FPRC;

|DEFBUCLE TOrdEntLin;
     #16#1;
     ;
     #15#0, #15#24, 001;
     #15#0, #15#24, 999;
     ;
     NULL, TOrdEntLin;
|FIN;

|PROCESO TOrdEnt;
     |BUCLE TOrdEntLin;
|FPRC;

|DEFBUCLE TOrdEnt;
     #15#1;
     34;
     #60#0, 000, #60#9;
     #60#0, 999, #60#9;
     ;
     NULL, TOrdEnt;
|FIN;

|PROCESO TPedVta;
     nVenta = nVenta + #26#7;
     |SI nHayCom = 0;
          nKilos = nKilos + #26#5;
     |FINSI;
     nHayVta = 1;
|FPRC;

|DEFBUCLE TPedVta;
     #26#1;
     ;
     #60#0, 000, #60#9;
     #60#0, 999, #60#9;
     ;
     NULL, TPedVta;
|FIN;

|PROCESO TConEntLin;
     nVenta = nVenta + #10#8;
     |SI nHayCom = 0;
          nKilos = nKilos + #10#6;
     |FINSI;
     nHayVta = 1;
|FPRC;

|DEFBUCLE TConEntLin;
     #10#1;
     ;
     #9#0, #9#25, 001;
     #9#0, #9#25, 999;
     ;
     NULL, TConEntLin;
|FIN;

|PROCESO TConEnt;
     |BUCLE TConEntLin;
|FPRC;

|DEFBUCLE TConEnt;
     #9#1;
     36;
     #60#0, 000, #60#9;
     #60#0, 999, #60#9;
     ;
     NULL, TConEnt;
|FIN;

|PROCESO TOrdSalLin;
     nVenta = nVenta + #12#8;
     |SI nHayCom = 0;
          nKilos = nKilos + #12#6;
     |FINSI;
     nHayVta = 1;
|FPRC;

|DEFBUCLE TOrdSalLin;
     #12#1;
     ;
     #11#0, #11#31, 001;
     #11#0, #11#31, 999;
     ;
     NULL, TOrdSalLin;
|FIN;

|PROCESO TOrdSal;
     |BUCLE TOrdSalLin;
|FPRC;

|DEFBUCLE TOrdSal;
     #11#1;
     38;
     #60#0, 000, #60#9;
     #60#0, 999, #60#9;
     ;
     NULL, TOrdSal;
|FIN;

|PROCESO TAlbVta;
     nVenta = nVenta + #28#7;
     |SI nHayCom = 0;
          nKilos = nKilos + #28#5;
     |FINSI;
     nHayVta = 1;
|FPRC;

|DEFBUCLE TAlbVta;
     #28#1;
     ;
     #60#0, 000, #60#9;
     #60#0, 999, #60#9;
     ;
     NULL, TAlbVta;
|FIN;

|PROCESO TotRecoge;
     nTotTrCos = nTotTrCos + #5#27;
     nTotTrKgs = nTotTrKgs + #5#32;
|FPRC;

|DEFBUCLE TotRecoge;
     #5#1;
     36;
     #60#0, 000, #60#9;
     #60#0, 999, #60#9;
     ;
     NULL, TotRecoge;
|FIN;

|PROCESO TotEntrega;
     nTotTrCos = nTotTrCos + #9#27;
     nTotTrKgs = nTotTrKgs + #9#32;
|FPRC;

|DEFBUCLE TotEntrega;
     #9#1;
     36;
     #60#0, 000, #60#9;
     #60#0, 999, #60#9;
     ;
     NULL, TotEntrega;
|FIN;

|PROCESO TotOrSalLin;
     nTotAlCos = nTotAlCos + #12#10;
     nTotAlKgs = nTotAlKgs + #12#6;
|FPRC;

|DEFBUCLE TotOrSalLin;
     #12#1;
     ;
     #11#0, #11#31, 001;
     #11#0, #11#31, 999;
     ;
     NULL, TotOrSalLin;
|FIN;

|PROCESO TotOrSal;
     |BUCLE TotOrSalLin;
|FPRC;

|DEFBUCLE TotOrSal;
     #11#1;
     38;
     #60#0, 000, #60#9;
     #60#0, 999, #60#9;
     ;
     NULL, TotOrSal;
|FIN;

|RUTINA Totales60;
     nKilos = 0;
     nVenta = 0;
     nCoste = 0;

     nHayCom = 0;
     |BUCLE TPedCom;
     |SI nHayCom = 0;
          |BUCLE TConRec;
          |SI nHayCom = 0;
               |BUCLE TAlbCom;
               |SI nHayCom = 0;
                    |BUCLE TOrdEnt;
               |FINSI;
          |FINSI;
     |FINSI;
     nHayVta = 0;
     |BUCLE TPedVta;
     |SI nHayVta = 0;
          |BUCLE TConEnt;
          |SI nHayVta = 0;
               |BUCLE TOrdSal;
               |SI nHayVta = 0;
                    |BUCLE TAlbVta;
               |FINSI;
          |FINSI;
     |FINSI;
     #20#14 = nKilos;
     #20#15 = nCoste / nKilos;
     #60#3 = #20#14;
     #60#4 = #20#15;
     #60#5 = nVenta / nKilos;

     nTotTrCos = 0;
     nTotTrKgs = 0;
     |BUCLE TotRecoge;
     |BUCLE TotEntrega;
     #20#16 = nTotTrCos / nTotTrKgs;
     #60#6 = #20#16; || Transporte

     nTotAlCos = 0;
     nTotAlKgs = 0;
     |BUCLE TotOrSal;
     #20#20 = nTotAlCos / nTotAlKgs;
     #60#7 = #20#20;  || Almacen


     #60#8 = #60#5 - #60#4 - #60#6 - #60#7;  || Margen
     #20#17 = #60#8;

|FRUT;
