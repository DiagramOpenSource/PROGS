|FICHEROS;
     guerz011 #0;
     gomantl1 #1;
     gopre004 #2;
     gopre001 #3;
     goalbpa4 #4;
     goalbpa5 #5;
     goalbpa6 #6;
     agifa027 #27;
     guerw020 #20,MANTE;  ||Tmp
     agifa017 #17;
     agifa019 #19;
     dsm00043 #43;
     dsm00044 #44;
     goparame #10;
     guerm025 #25;

     gomatcab #30;
     gomatlin #31;
     gomatljn #32;
     goparam5 #500;
|FIN;

|VARIABLES;
     &enForma  = 1;
     &Tempo    = "";
     aMoneda   = "";
     nAlmaObra = 0;
     nAlmaComp = 0;
     nConta    = 0;
     fFecha    = @;
     nLin      = 0;
     nLin2     = 0;
     nUni      = 0;
     nHay      = 0;
     aParti    = "";
     aCapi     = "";
     aSerPre   = "";
     nNumPre   = 0;
     nMovimi   = 0;

     &eaSerPre = "";
     &enNumPre = 0;
     &eaCapi   = "";
     &eaParti  = "";
     &eaDesPa  = "";

     &xSerie        = "";
     &xCodArti      = "";
     &xDesArti      = "";
     &xDocTras      = 0;
     &xLinDocu      = 0;
     &xCanArti      = 0;
     &xAlmEntr      = 0;
     &xAlmSali      = 0;
     &xForma        = 0;
     &xFecDocu      = @;
     aAlfa = "";
     nImpComTrab    = 0;
     nImpComBase    = 0;
     nImpVenTrab    = 0;
     nImpVenBase    = 0;
|FIN;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO AlmaCom0; |TIPO 0;
     |SI #10#76 = "S";
          |ABRE #500;
          #500#0 = #0#2;
          |LEE 000#500=;
          |SI FSalida ! 0;
               |MENAV "0000No existe Almacen en parametros construccion";
               |ERROR;
          |FINSI;
          |CIERRA #500;
     |FINSI;
|FPRC;

|PROCESO AlmaCom; |TIPO 7;
     |ABRE #10; |LEE 000#10p; |CIERRA #10;
     #0#2 = #10#22;
     |PINTA #0#2;
     |SI #10#76 = "S";
          |C_M #0#2, 1, "S";
     |SINO;
          |C_M #0#2, 1, "N";
     |FINSI;
|FPRC;

|PROCESO Contador;
     |ABRE #27;
     #27#2 = #0#0;                            ||Serie.
     #27#0 = "movcenal";
     |LEE 000#27=;
     |SI FSalida = 0;
          nMovimi = #27#1;
          |SI nMovimi < 500000;
               nMovimi = 500000;
          |FINSI;
          #27#1 = nMovimi + 1;
          |GRABA 020#27a;
     |SINO;
          #27#1 = 500002;
          nMovimi = 500001;
          |GRABA 020#27n;
     |FINSI;
     |CIERRA #27;
|FPRC;

|PROCESO MoviExp2;
     #32#0 = #20#9;
     #32#1 = #20#10;
     #32#2 = 999;
     |LEE 000#32];
     |SI FSalida = 0;
          |LEE 000#32a;
     |SINO;
          |LEE 000#32u;
     |FINSI;
     |SI FSalida = 0; |Y #32#0 = #20#9; |Y #32#1 = #20#10;
          nLin2 = #32#2 + 1;
     |SINO;
          nLin2 = 1;
     |FINSI;
     |DDEFECTO #32;
     #32#0 = #20#9;
     #32#1 = #20#10;
     #32#2 = nLin2;
     #32#3 = fFecha;
     #32#5 = xSerie;
     #32#6 = xDocTras;
     #32#13 = "P";
     #32#9 = -(#20#4 * #20#3);
     #32#10 = #32#9;
     #32#11 = -(#20#5 * #20#3);
     #32#12 = #32#11;
     #32#14 = #0#0;
     #32#15 = #0#1;
     |GRABA 020#32n;

     nImpComTrab = -(#20#4 * #20#3);              ||Imp. Comp. Trabajo.
     nImpComBase = -(#20#4 * #20#3);              ||Imp. Comp. Base.
     nImpVenTrab = -(#20#5 * #20#3);              ||Imp. Vent. Trabajo.
     nImpVenBase = -(#20#5 * #20#3);              ||Imp. Vent. Base.

     #31#3 = #20#9;
     #31#4 = #20#10;
     |LEE 121#31=;

     #30#0 = #0#0;
     #30#1 = #0#1;
     |LEE 121#30=;

     #31#5  = #31#5  + nImpComTrab;              ||Imp. Comp. Trabajo.
     #31#6  = #31#6  + nImpComBase;              ||Imp. Comp. Base.
     #31#7  = #31#7  + nImpVenTrab;              ||Imp. Vent. Trabajo.
     #31#8  = #31#8  + nImpVenBase;              ||Imp. Vent. Base.

     |SI #31#9 = "P";                             ||PRESUPUESTOS.
          #30#2  = #30#2  + nImpComTrab;         ||Imp. Comp. Trabajo.
          #30#3  = #30#3  + nImpComBase;         ||Imp. Comp. Base.
          #30#4  = #30#4  + nImpVenTrab;         ||Imp. Vent. Trabajo.
          #30#5  = #30#5  + nImpVenBase;         ||Imp. Vent. Base.
     |FINSI;
     |SI #31#9 = "A";                             ||ADMINISTRACION.
          #30#6  = #30#6  + nImpComTrab;         ||Imp. Comp. Trabajo.
          #30#7  = #30#7  + nImpComBase;         ||Imp. Comp. Base.
          #30#8  = #30#8  + nImpVenTrab;         ||Imp. Vent. Trabajo.
          #30#9  = #30#9  + nImpVenBase;         ||Imp. Vent. Base.
     |FINSI;
     |SI #31#9 = "E";                             ||EXTRAS.
          #30#10 = #30#10 + nImpComTrab;         ||Imp. Comp. Trabajo.
          #30#11 = #30#11 + nImpComBase;         ||Imp. Comp. Base.
          #30#12 = #30#12 + nImpVenTrab;         ||Imp. Vent. Trabajo.
          #30#13 = #30#13 + nImpVenBase;         ||Imp. Vent. Base.
     |FINSI;
     #30#14 = #30#14 + nImpVenTrab;              ||Total Venta Trabajo.
     #30#15 = #30#15 + nImpVenBase;              ||Total Venta Base.
     #30#16 = #30#16 + nImpComTrab;              ||Total Comp. Trabajo.
     #30#17 = #30#17 + nImpVenBase;              ||Total Comp. Base.

     |GRABA 020#30a;
     |GRABA 020#31a;
     |LIBERA #30;
     |LIBERA #31;
|FPRC;

|PROCESO MoviExp;
     |SI nMovimi = 0;
          |HAZ Contador;
          |DDEFECTO #4;
          #4#0 = #0#0;
          #4#1 = nMovimi;
          |GRABA 020#4n;
          nLin = 0;
     |FINSI;

     |DDEFECTO #5;
     nLin = nLin + 1;
     #5#0 = #4#0;
     #5#1 = #4#1;
     #5#2 = nLin;
     #5#3 = #20#0;
     #5#4 = #20#1;
     #5#5 = -#20#3;
     #5#6 = -#20#3;
     #5#7 = 0;
     #5#8 = nAlmaObra;
     #5#9 = #20#4;
     #5#10 = #5#5 * #5#9;
     #5#11 = xDocTras;
     |GRABA 020#5n;

     |DDEFECTO #6;
     #6#34 = "A";
     #6#0 = #20#9;
     #6#1 = #20#10;
     #6#2 = #0#0;
     #6#3 = #0#1;
     #6#4 = #5#0;
     #6#5 = #5#1;
     #6#6 = #5#2
     #6#7 = 1;
     #6#8 = #20#7;
     #6#9 = #20#11;
     #6#10 = #5#6;
     #6#17 = nAlmaObra;
     #6#19 = xDocTras;
     #6#20 = #20#0;
     #6#21 = #20#12;
     #6#22 = #20#5; || P.V
     #6#23 = #20#4; || P.C
     #6#24 = #6#22 * #6#10;
     #6#25 = #6#23 * #6#10;
     #6#30 = #20#1;
     #6#33 = #20#8;
     |GRABA 020#6n;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO MoviAlma;
     xForma = 1;
   ||xDocTras
     xLinDocu = 0;
     xSerie   = #0#0;
     xFecDocu = fFecha;
     xCodArti = #20#0;
     xDesArti = #20#1;
     xAlmEntr = nAlmaComp;
     xAlmSali = nAlmaObra;
     xCanArti = #20#3;
     |SUB_EJECUTA_NP "gomoval1";
|FPRC;

|PROCESO Regulariza;
     |SI nConta = 0;
          |ABRE #43;
          #43#4 = #0#0;
          #43#0 = 999999;
          |LEE 000#43];
          |SI FSalida = 0;
               |LEE 000#43a;
          |SINO;
               |LEE 000#43u;
          |FINSI;
          |SI FSalida = 0; |Y #43#4 = #0#0;
               nConta = #43#0 + 1;
          |SINO;
               nConta = 1;
          |FINSI;
          |DDEFECTO #43;
          #43#4 = #0#0;
          #43#0 = nConta;
          #43#1 = fFecha;
          #43#2 = "REGULARIZACION";
          #43#3 = "EXPEDIENTE:" + #0#0 + "/" + #0#1;
          #43#4 = #0#0;
          |GRABA 020#43n;
          |CIERRA #43;
     |FINSI;

     |ABRE #19;
     #19#0 = #20#0;
     |LEE 020#19=;
     |CIERRA #19;

     |ABRE #17;
     #17#0 = #20#0;
     #17#1 = nAlmaObra;
     |LEE 020#17=;
     |CIERRA #17;

     |ABRE #44;
     #44#21 = #0#0;
     #44#18 = nConta;
     #44#8 = 999;
     |LEE 000#44=;
     |SI FSalida = 0;
          |LEE 000#44a;
     |SINO;
          |LEE 000#44u;
     |FINSI;
     |SI FSalida = 0; |Y #44#21 = #0#0; |Y #44#18 = nConta;
          nLin = #44#8 + 1;
     |SINO;
          nLin = 1;
     |FINSI;

     |DDEFECTO #44;
     #44#0 = #20#0;
     #44#1 = nAlmaObra;
     #44#2 = #20#1;
     #44#3 = #17#39;
     #44#4 = nUni;
     #44#5 = fFecha;
     #44#6 = #19#6;
     #44#7 = "S";
     #44#8 = nLin;
     #44#18 = nConta;
     #44#19 = #17#5;
     #44#20 = #19#104;
     #44#21 = #0#0;
     |GRABA 020#44n;
     |HAZ AcumulaES_SS;
|FPRC;

|PROCESO Tmp;
     #19#0 = #20#0;
     |LEE 020#19=;

     |SI #20#2 = "S";
          |SI #20#3 ! 0;
               |HAZ MoviAlma;
               |HAZ MoviExp;
               |HAZ MoviExp2;
          |FINSI;
     |SINO;
          |SI #20#3 = 0;
               nUni = #20#6;
          |SINO;
               nUni = #20#6 - #20#3;
          |FINSI;
          |SI nUni ! 0;
               |HAZ Regulariza;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE Tmp;
     #20#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Tmp;
|FIN;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO LisPar; |TIPO 0;
     eaSerPre = #20#9;
     enNumPre = #20#10;
     eaCapi = #20#8;
     eaParti = #20#7;

     |HAZ GuerPartid;
     |SI eaParti ! "";
          #20#8 = eaCapi;
          #20#7 = eaParti;
          #20#11 = eaDesPa;
          |PINTA #20#7;
          |PINTA #20#8;
     |FINSI;
|FPRC;

|PROCESO Tipo0; |TIPO 0;
     |LEE 020#20=;
   |ET A1;
     |ENCAMPO #7#20;
     |SI FSalida = 2; |VETE A1; |FINSI;
     |SI FSalida = 1; |VETE Graba; |FINSI;
     |SI FSalida = 7; |VETE Sal; |FINSI;
   |ET A2;
     |ENCAMPO #2#20;
     |SI FSalida = 2; |VETE A1; |FINSI;
     |SI FSalida = 1; |VETE Graba; |FINSI;
     |SI FSalida = 7; |VETE Sal; |FINSI;
   |ET A3;
     |ENCAMPO #3#20;
     |SI FSalida = 2; |VETE A2; |FINSI;
     |SI FSalida = 1; |VETE Graba; |FINSI;
     |SI FSalida = 7; |VETE Sal; |FINSI;
   |ET A4;
     |ENCAMPO #4#20;
     |SI FSalida = 2; |VETE A3; |FINSI;
     |SI FSalida = 1; |VETE Graba; |FINSI;
     |SI FSalida = 7; |VETE Sal; |FINSI;
   |ET A5;
     |ENCAMPO #5#20;
     |SI FSalida = 2; |VETE A4; |FINSI;
     |SI FSalida = 1; |VETE Graba; |FINSI;
     |SI FSalida = 7; |VETE Sal; |FINSI;

   |ET Graba;
     |GRABA 020#20a;
   |ET Sal;
|FPRC
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO gopre004;
     #3#0 = #2#0;
     #3#1 = #2#1;
     |LEE 020#3=;

     aMoneda = #3#7;
     aParti = #2#3;
     aCapi =  #2#2;
     aSerPre = #2#0;
     nNumPre = #2#1;
     |ERROR10;
|FPRC;

|DEFBUCLE gopre004;
     #2#3;
     ;
     #1#3, #1#4, "                    ", #19#0;
     #1#3, #1#4, "zzzzzzzzzzzzzzzzzzzz", #19#0;
     ;
     NULL, gopre004;
|FIN;

|PROCESO gomantl1;
     |BUCLE gopre004;
     |SI aParti ! ""; |ERROR10; |FINSI;
|FPRC;

|DEFBUCLE gomantl1;
     #1#1;
     ;
     #0#0, #0#1, 001;
     #0#0, #0#1, 999;
     ;
     NULL, gomantl1;
|FIN;

|PROCESO agifa017;
     nHay = 1;
     #19#0 = #17#0;
     |LEE 020#19=;
     |SI FSalida ! 0; |ACABA; |FINSI;

     aParti = "";
     |ABRE #3;
     |BUCLE gomantl1;
     |CIERRA #3;

     #20#0 = #19#0;
     #20#1 = #19#1;
     #20#2 = "N";
     #20#3 = #17#5;
     #20#4 = #19#28;
     #20#5 = #19#18;
     #20#6 = #20#3;
     #20#7 = aParti;
     #20#8 = aCapi;
     #20#9 = aSerPre;
     #20#10 = nNumPre;
     #20#12 = aMoneda;
     |GRABA 020#20n;
|FPRC;

|DEFBUCLE agifa017;
     #17#1;
     ;
     "                    ", nAlmaObra;
     "zzzzzzzzzzzzzzzzzzzz", nAlmaObra;
     ;
     NULL, agifa017;
|FIN;

|PROCESO Min;
     #20#0 = "                    ";
|FPRC;

|PROCESO Max;
     #20#0 = "zzzzzzzzzzzzzzzzzzzz";
|FPRC;

|PROCESO guerm025;
     |MENAV "0000Existem reservas...";
     |ERROR10;
|FPRC;

|DEFBUCLE guerm025;
     #25#3;
     ;
     "                    ", #0#0, #0#1;
     "zzzzzzzzzzzzzzzzzzzz", #0#0, #0#1;
     ;
     NULL, guerm025;
|FIN;

|PROCESO Inicio; |TIPO 3;
     |HAZ DecimalesBase;

     |BUCLE guerm025;

     |ABRE #10; |LEE 000#10p; |CIERRA #10;
     fFecha = ~;
     nAlmaObra = #0#0;
     nAlmaComp = #0#2; || #10#22;

     |HAZ CreaTempo; |NOME_DAT #20 Tempo; |DELINDEX #20;
     |ABRE #20;
     |ABRE #19;
     |BUCLE agifa017;
     |CIERRA #20;
     |CIERRA #19;

     |SI nHay ! 0;
          |PINPA #0#20;
          |ENTLINEAL #1#20, 1, 4, 22, 0, Min, Max;

          |CONFI "0000NCorrecto";
          |SI FSalida = 0;
               |ABRE #19;
               |ABRE #4;
               |ABRE #5;
               |ABRE #6;
               |ABRE #30;
               |ABRE #31; |SELECT #2#31;
               |ABRE #32;
               |BUCLE Tmp;
               |CIERRA #19;
               |CIERRA #4;
               |CIERRA #5;
               |CIERRA #6;
               |CIERRA #30;
               |CIERRA #31;
               |CIERRA #32;
          |FINSI;

          |DELINDEX #20; |HAZ BoraTempo;
     |FINSI;
|FPRC;
