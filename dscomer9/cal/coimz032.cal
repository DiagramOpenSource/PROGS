|FICHEROS;
     coimz032 #0;
     coimz033 #33,MANTE;
     coimw019 #10; ||Tmp
     coimw020 #20; ||Tmp
     agifa017 #17;
     agifa019 #19;
     coima050 #50;
     coima051 #51;
     agifa065 #65;
|FIN;

|VARIABLES;
     &Tempo = "";
     fDFecha = @;
     fHFecha = @;
     nNume = 0;
     nUni = 0;
     {-1}aMenu = "";
     aMenu1 = "2400";
     aMenu2 = "1";
     aMenu3 = "";
     aMenu4 = "MCISa";
     aMenu5 = " Modificar ";
     aMenu6 = " Confirmar ";
     aMenu7 = " Informe ";
     aMenu8 = " Salir ";
     aMenu9 = " Calculo Materiales ";

     {-1}bMenu = "";
     bMenu1 = "2400";
     bMenu2 = "1";
     bMenu3 = "";
     bMenu4 = "MCIS";
     bMenu5 = " Modificar ";
     bMenu6 = " Confirmar ";
     bMenu7 = " Informe ";
     bMenu8 = " Salir ";
|FIN;

|PROCESO ImprimeMateDes;
     |PRINT;
|FPRC;

|DEFBUCLE ImprimeMateDes;
     #20#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, ImprimeMateDes;
|FIN;

|PROCESO InformeMate;
     |IMPRE 0;
     |SI FSalida = 0;
          |INFOR "coimzm32";
          |SI FSalida = 0;
               |BUCLE ImprimeMateDes;
               |PIEINF;
               |FININF;
          |FINSI;
          |FINIMP;
     |FINSI;
|FPRC;

|PROCESO ConfirmarMate;
     |SI #20#4 = "S";
          #19#0 = #20#0;
          |LEE 121#19=;
          |SI FSalida = 0;
               #17#0 = #20#0;
               #17#1 = #0#13;
               |LEE 101#17=;
               |SI FSalida = 0;
                    #17#6 = #20#3;
                    |GRABA 020#17a;
                    |LIBERA #17;

                    #19#7 = 0;
                    #17#0 = #20#0;
                    #17#1 = 1;
                    |LEE 101#17];
                    |PARA; |SI FSalida = 0; |Y #17#0 = #20#0; |HACIENDO;
                         #19#7 = #19#7 + #17#6;
                         |LEE 000#17s;
                    |SIGUE;
                    |GRABA 020#19a;
                    |LIBERA #19;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE ConfirmarMate;
     #20#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, ConfirmarMate;
|FIN;

|PROCESO ConfirmaMate;
     |ABRE #19;
     |ABRE #17;
     |BUCLE ConfirmarMate;
     |CIERRA #17;
     |CIERRA #19;
     |MENAV "0000Stock minimo materia actualizado...";
|FPRC;

|PROCESO Min20;
     #20#0 = " " * 20;
|FPRC;

|PROCESO Max20;
     #20#0 = "z" * 20;
|FPRC;

|PROCESO LinEscan;
     #19#0 = #51#2;
     |LEE 000#19=;
     |SI FSalida = 0;
               |Y #19#2 ] #33#0; |Y #19#2 [ #33#1;
               |Y #19#125 ] #33#2; |Y #19#125 [ #33#3;
               |Y #19#3 ] #33#4; |Y #19#3 [ #33#5;
               |Y #19#127 ] #33#6; |Y #19#127 [ #33#7;
               |Y #19#27 ] #33#8; |Y #19#27 [ #33#9;

          |DDEFECTO #20;
          #20#0 = #19#0;
          |LEE 101#20=;
          |SI FSalida ! 0; |GRABA 020#20b; |FINSI;
          #20#1 = #19#1;
          #20#2 = #20#2 + (#51#12 * #10#6);
          #20#3 = #20#2;
          #20#4 = "S";
          |GRABA 020#20a;
          |LIBERA #20;
     |FINSI;
|FPRC;

|DEFBUCLE Escandallo;
     #50#1;
     ;
     #10#0;
     #10#0;
     ;
     NULL, NULL, LinEscan;
|FIN;

|PROCESO TMaterias;
     |BUCLE Escandallo;
|FPRC;

|DEFBUCLE TMaterias;
     #10#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, TMaterias;
|FIN;

|PROCESO Materias;
     |PUSHV 0501 2380;
     |BLANCO 721 2060;
     |PINPA #0#33;
     |PINDA #0#33;
     |ENDATOS #1#33;
     |SI FSalida = 0;
          |DELINDEX #20;
          |ABRE #20;
          |ABRE #19;
          |BUCLE TMaterias;
          |CIERRA #19;
          |CIERRA #20;

          |BLANCO 514 2369;
          |PARA; |SI; |HACIENDO;
               |PINPA #0#20;
               |ENTLINEAL #1#20, 1, 2, 19, 0, Min20, Max20;
               |PARA; |SI; |HACIENDO;
                    |MENU bMenu
                    bMenu2 = FSalida;
                    |SI bMenu2 = 1; |SAL; |FINSI;
                    |SI bMenu2 = 2; |HAZ ConfirmaMate; |FINSI;
                    |SI bMenu2 = 3; |HAZ InformeMate; |FINSI;
                    |SI bMenu2 = 4; |SAL; |FINSI;
               |SIGUE;
               |SI bMenu2 = 4; |SAL; |FINSI;
          |SIGUE;
     |FINSI;
     |POPV;
|FPRC;

|PROCESO Imprime;
     |PRINT;
|FPRC;

|DEFBUCLE Imprime;
     #10#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Imprime;
|FIN;

|PROCESO Informe;
     |IMPRE 0;
     |SI FSalida = 0;
          |INFOR "coimz032";
          |SI FSalida = 0;
               |BUCLE Imprime;
               |PIEINF;
               |FININF;
          |FINSI;
          |FINIMP;
     |FINSI;
|FPRC;

|PROCESO Confirmar;
     |SI #10#7 = "S";
          #19#0 = #10#0;
          |LEE 121#19=;
          |SI FSalida = 0;
               #17#0 = #10#0;
               #17#1 = #0#13;
               |LEE 101#17=;
               |SI FSalida = 0;
                    #17#6 = #10#6;
                    |GRABA 020#17a;
                    |LIBERA #17;

                    #19#7 = 0;
                    #17#0 = #10#0;
                    #17#1 = 1;
                    |LEE 101#17];
                    |PARA; |SI FSalida = 0; |Y #17#0 = #10#0; |HACIENDO;
                         #19#7 = #19#7 + #17#6;
                         |LEE 000#17s;
                    |SIGUE;
                    |GRABA 020#19a;
                    |LIBERA #19;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE Confirmar;
     #10#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Confirmar;
|FIN;

|PROCESO Confirma;
     |ABRE #19;
     |ABRE #17;
     |BUCLE Confirmar;
     |CIERRA #17;
     |CIERRA #19;
     |MENAV "0000Stock minimo actualizado...";
|FPRC;

|PROCESO agifa065;
     |SI #65#2 = "AV"; |O #65#2 = "BV";
          nUni = nUni + #65#6;
     |FINSI;
|FPRC;

|DEFBUCLE agifa065;
     #65#1;
     5;
     #19#0, fDFecha, "AV", 000000, 00000, "     ", #0#13;
     #19#0, fHFecha, "BV", 999999, 99999, "zzzzz", #0#13;
     ;
     NULL, agifa065;
|FIN;

|PROCESO agifa019;
     nUni = 0;
     |SI #0#14 = "S"
          |BUCLE agifa065;
     |FINSI;

     #17#0 = #19#0;
     #17#1 = #0#13;
     |LEE 000#17=;
     |SI FSalida ! 0; |DDEFECTO #17; |FINSI;

     nUni = -nUni;
     |DDEFECTO #10;
     #10#0 = #19#0;
     #10#1 = #19#1;
     #10#2 = #17#42;
     #10#3 = nUni;
     #10#4 = #10#3 + #10#2;   || Total
     #10#5 = #17#6;
     #10#6 = (#10#4 * #0#11 / #0#10) ! 0;    ||Min Nuevo
     |SI #10#6 [ 0;
          #10#6 = #10#5;
     |FINSI;
     #10#7 = "S";
     |GRABA 020#10n;
|FPRC;

|DEFBUCLE agifa019;
     #19#1;
     2, 125, 3, 127;
     #0#0, #0#2, #0#4, #0#6, #0#8;
     #0#1, #0#3, #0#5, #0#7, #0#9;
     ;
     NULL, agifa019;
|FIN;

|PROCESO Min10;
     #10#0 = " " * 20;
|FPRC;

|PROCESO Max10;
     #10#0 = "z" * 20;
|FPRC;

|PROCESO T3; |TIPO 3;
     |HAZ CreaTempo; |NOME_DAT #10 Tempo; |DELINDEX #10;
     |HAZ CreaTempo; |NOME_DAT #20 Tempo; |DELINDEX #20;

     nNume = #0#12 - #0#10;
     fDFecha = nNume;
     fHFecha = #0#12;

     |ABRE #10;
     |ABRE #17;
     |BUCLE agifa019;
     |CIERRA #17;
     |CIERRA #10;

     |PARA; |SI; |HACIENDO;
          |PINPA #0#10;
          |ENTLINEAL #1#10, 1, 2, 20, 0, Min10, Max10;
          |PARA; |SI; |HACIENDO;
               |MENU aMenu
               aMenu2 = FSalida;
               |SI aMenu2 = 1; |SAL; |FINSI;
               |SI aMenu2 = 2; |HAZ Confirma; |FINSI;
               |SI aMenu2 = 3; |HAZ Informe; |FINSI;
               |SI aMenu2 = 4; |SAL; |FINSI;
               |SI aMenu2 = 5; |HAZ Materias; |FINSI;
          |SIGUE;
          |SI aMenu2 = 4; |SAL; |FINSI;
     |SIGUE;

     |HAZ BoraTempo; |DELINDEX #10;
     |HAZ BoraTempo; |DELINDEX #20;
|FPRC;
