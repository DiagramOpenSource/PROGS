|FICHEROS;
  ortig014 #0;
  ortig010 #1;  ||CAB.PRES.
  ortig011 #2;  ||LINEA PRES.
  agifa019 #3;  ||ARTICULOS
  agifa017 #4;  ||ALMACENES
  agifa065 #5; ||HISTORICO
  ortig005 #6; ||MATERIAL
  ortig016 #7; ||aux.mat
  ortig017 #8; ||aux.corte
|FIN;

|VARIABLES;
 nUnidades = 0;
 medida = 0;
 ValorSt = 0;
 fecha = @;
 fecha1 = "";
 mes = 0;
 linea = 0;
|FIN;


|PROCESO Medidas_dbl;
     |SI #agifa019#188 ] 1; medida = #agifa019#189;         |FINSI;
     |SI #agifa019#188 ] 2; medida = #agifa019#189 * #agifa019#190; |FINSI;
     |SI #agifa019#188 = 3; medida = #agifa019#189 * #agifa019#190 * #agifa019#191; |FINSI;
|FPRC;

|PROCESO EntraModelo;
|ABRE #agifa019;
#agifa019#0 = #ortig011#2;
|LEE 010#agifa019.=;
|SI FSalida = 0;
 ValorSt = #agifa019#10;
 ValorSt = ValorSt + (#ortig011#6*#ortig011#9); ||INCREMENTO VALOR EN UNID*COSTE
 #agifa019#6 = #agifa019#6 + #ortig011#6;
 #agifa019#104 = #agifa019#104 + #ortig011#6;
 #agifa019#10 = #agifa019#6 * #agifa019#9; ||VALOR STOCK
 #agifa019#11 = #agifa019#11 - #ortig011#6; ||NECESIDADES
 #agifa019#9 = ValorSt / #agifa019#6; ||PRECIO MEDIO
 |HAZ Medidas_dbl;
 #agifa019#185 = #agifa019#6*medida;
 #agifa019#193 = #agifa019#104*medida;
 ||#agifa019#104 = #agifa019#193 * medida;
 ||#agifa019#6 = #agifa019#185  * medida;
 |GRABA 010#agifa019.a;
|FINSI;
|LIBERA #agifa019;
|CIERRA #agifa019;
|ABRE #agifa017;
#agifa017#0 = #ortig011#2
#agifa017#1 = 1;  ||poner almacen en ppto
|LEE 010#agifa017.=;
|SI FSalida ! 0;
  |CDEFECTO #agifa017,1;
  |GRABA 010#agifa017.b;
  |LIBERA #agifa017;
|FINSI;
#agifa017#5 = #agifa017#5 + #ortig011#6;
#agifa017#39 = #agifa017#39 + #ortig011#6;
#agifa017#3 = #agifa017#5 * #agifa019#9; ||VALOR STOCK;
fecha = #0#2;
fecha1 = fecha;
fecha1 = fecha % 402;
mes = fecha1;
mes = (mes*2)+10;
#4mes = #4mes + #ortig011#6;
#4#36 = #4#36 + #ortig011#6;
|HAZ Medidas_dbl;
#agifa017#47 = #agifa017#5 * medida;
#agifa017#48 = #agifa017#39 * medida;
|GRABA 010#agifa017.a;
|LIBERA #agifa017;
|CIERRA #agifa017;
|ABRE #agifa065;
#agifa065#0 = #0#0;
#agifa065#1 = #0#2;
#agifa065#2 = "FB";
#agifa065#3 = #ortig011#0;||DOCUMENTO
#agifa065#4 = 1;
#agifa065#5 = #ortig011#9;
#agifa065#6 = #ortig011#6;
#agifa065#9 = #ortig011#9;
|HAZ Medidas_dbl;
#agifa065#17 = #agifa065#6*medida;
|GRABA 010#agifa065.n;
|LIBERA #agifa065;
|CIERRA #agifa065;
|FPRC;

|PROCESO fabrica;
|HAZ EntraModelo;
|FPRC;

|PROCESO MiraBarras;
 nUnidades = #ortig017#1; ||si.. se que se puede hacer mas corto pero no hay tiempo
|FPRC;

|DEFBUCLE MiraBarras;
#ortig017#1;
;
#ortig016#0,#ortig016#1,0000,0000;
#ortig016#0,#ortig016#1,9999,9999;
;
NULL,MiraBarras;
|FIN;

|PROCESO SalMat;
linea = linea + 1;
|ABRE #agifa019;
#agifa019#0 = #ortig016#1;
|LEE 010#agifa019.=;
|SI FSalida = 0;
 #agifa019#6 = #agifa019#6 - nUnidades;
 #agifa019#104 = #agifa019#104 - nUnidades;
 #agifa019#10 = #agifa019#6 * #agifa019#9; ||VALOR STOCK
 #agifa019#11 = #agifa019#11 + nUnidades; ||NECESIDADES
 |HAZ Medidas_dbl;
 #agifa019#185 = #agifa019#6;
 #agifa019#193 = #agifa019#104;
  #agifa019#185 = #agifa019#6/medida;
  #agifa019#193 = #agifa019#104/medida;
  ||#agifa019#104 = #agifa019#193 * medida;
  ||#agifa019#6 = #agifa019#185  * medida;
 |GRABA 010#agifa019.a;
|FINSI;
|LIBERA #agifa019;
|CIERRA #agifa019;
|ABRE #agifa017;
#agifa017#0 = #ortig016#1;
#agifa017#1 = 1;||poner almacen
|LEE 010#agifa017.=;
|SI FSalida ! 0;
  |CDEFECTO #agifa017,1;
  |GRABA 010#agifa017.b;
  |LIBERA #agifa017;
|FINSI;
#agifa017#5 = #agifa017#5 - nUnidades;
#agifa017#39 = #agifa017#39 - nUnidades;
#agifa017#3 = #agifa017#5 * #agifa019#9; ||VALOR STOCK;
fecha = #0#2;
fecha1 = fecha;
fecha1 = fecha % 402;
mes = fecha1;
mes = (mes*2)+9;
#4mes = #4mes + nUnidades;
#agifa017#36 = #agifa017#36 + nUnidades;
|HAZ Medidas_dbl;
#agifa017#47 = #agifa017#5*medida;
#agifa017#48 = #agifa017#39*medida;
|GRABA 010#agifa017.a;
|LIBERA #agifa017;
|CIERRA #agifa017;
|ABRE #agifa065;
#agifa065#0 = #ortig016#1;
#agifa065#1 = #0#2;
#agifa065#2 = "SF";
#agifa065#3 = #ortig011#0;||DOCUMENTO
#agifa065#4 = linea;
#agifa065#5 = 1;||poner almacen
#agifa065#6 = nUnidades*(-1);
|HAZ Medidas_dbl;
#agifa065#17 = #agifa065#6*medida;
|GRABA 010#agifa065.n;
|LIBERA #agifa065;
|CIERRA #agifa065;
|FPRC;

|PROCESO ortig016;
|ABRE #ortig005;
#ortig005#0 = #ortig016#1;
|LEE 010#ortig005.=;
|SI FSalida = 0;
  |SI #ortig005#3 = "S";
    |BUCLE MiraBarras; ||SI SON PIEZAS COMPLETAS, SE CUENTAN LAS BARRRAS
    nUnidades = nUnidades * #ortig005#1; ||y se multiplica por longitud barra
  |SINO;
    nUnidades = #ortig016#2; ||SI NO SON PIEZAS COMPLETAS LO QUE TENGA EL FICH.
  |FINSI;
|FINSI;
|LIBERA #ortig005;
|CIERRA #ortig005;
|HAZ SalMat;
|FPRC;

|DEFBUCLE ortig016;
#ortig016#1;
;
#0#0,"                    ";
#0#0,"zzzzzzzzzzzzzzzzzzzz";
;
NULL,ortig016;
|FIN;

|PROCESO SalMaterial;
|BUCLE ortig016;
|FPRCM;

|CALCULO tipo3;|TIPO 3;
|SI FSalida = 0;
 |ABRE #1;
 #1#0 = #0#0;
 |LEE 010#1=;
 |SI FSalida = 0;
   |BUCLELIN 0fabrica#1;
   |HAZ SalMaterial;
   #ortig010#13 = "S";
   |GRABA 010#ortig010.a;
 |FINSI;
 |LIBERA #1;
 |CIERRA #1;
|FINSI;
|FCAL;
