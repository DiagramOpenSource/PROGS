|FICHEROS;
     conz0018 #0;

     con00637 #637;
     con00642 #642;
     con00696 #696;

     con00623 #623;

     con00620 #620;

     con00663 #663;

     con00664 #664;

     con00625 #625;
     con00626 #626;
     con01625 #1625;
     con00634 #634;

     refere1@;
     refere2@;
     refere3@;
     refere4@;
|FIN;

|VARIABLES;
     MAXIMO = 4;
     &enSalida = 0;
     aAlfa = "";
     aOrg = "";
     aDes = "";
     aFic = "";
     aPath = "";
     aRef = "";
     nConta = 0;
     i = 0;
     nOk = 0;
|FIN;

|PROCESO Histo;
     aAlfa = #0#17;
     |C_M #0#34, 1, aAlfa;
     |C_M #0#35, 1, aAlfa;
|FPRC;

|PROCESO FactuV;
     aAlfa = #0#8;
     |C_M #0#29, 1, aAlfa;
     |C_M #0#30, 1, aAlfa;
     |C_M #0#32, 1, aAlfa;
     |C_M #0#33, 1, aAlfa;
|FPRC;

|PROCESO FactuC;
     aAlfa = #0#12;
     |C_M #0#31, 1, aAlfa;
|FPRC;

|PROCESO ped;
     |SI #0#4 = "N";
          |CAMPO_MODIFICA #0#5 , 1 , "N";
     |SINO;
          |CAMPO_MODIFICA #0#5 , 1 , "S";
     |FINSI;
|FPRC;

|PROCESO alb;
     |SI #0#6 = "N";
          |CAMPO_MODIFICA #0#7 , 1 , "N";
          |CAMPO_MODIFICA #0#21 , 1 , "N";
     |SINO;
          |CAMPO_MODIFICA #0#7 , 1 , "S";
          |CAMPO_MODIFICA #0#21 , 1 , "S";
     |FINSI;
|FPRC;

|PROCESO dep;
     |SI #0#9 = "N";
          |CAMPO_MODIFICA #0#10 , 1 , "N";
     |SINO;
          |CAMPO_MODIFICA #0#10 , 1 , "S";
     |FINSI;
|FPRC;

|PROCESO alc;
     |SI #0#13 = "N";
          |CAMPO_MODIFICA #0#14 , 1 , "N";
     |SINO;
          |CAMPO_MODIFICA #0#14 , 1 , "S";
     |FINSI;
|FPRC;

|PROCESO pec;
     |SI #0#15 = "N";
          |CAMPO_MODIFICA #0#16 , 1 , "N";
     |SINO;
          |CAMPO_MODIFICA #0#16 , 1 , "S";
     |FINSI;
|FPRC;

|CALCULO mayus;
     #0Campo = #0Campo > " ";
     |PINTA #0Campo;
|FCAL;
        /* --- */
|PROCESO Prepara;
     aRef = "exp" + aFic % 4;
     |DFICE aPath;

     aOrg = aPath + aFic + ".ixx";
     aDes = aPath + aRef + ".ixx";
     |COPIA_FICHERO aOrg, aDes;
     |FBORRA aOrg;

     aOrg = aPath + aFic + ".dat";
     aDes = aPath + aRef + ".dat";
     |COPIA_FICHERO aOrg, aDes;
     |FBORRA aOrg;

     aOrg = aPath + aFic + ".ddx";
     aDes = aPath + aRef + ".ddx";
     |COPIA_FICHERO aOrg, aDes;
     |FBORRA aOrg;

     |DDEF aPath;
     aAlfa = aPath + aFic;
     nConta = nConta + 1;
     |SI nConta = 1; |CARGA_DEF aAlfa, refere1@; |NOME_DAT #refere1@#aRef#; |FINSI;
     |SI nConta = 2; |CARGA_DEF aAlfa, refere2@; |NOME_DAT #refere2@#aRef#; |FINSI;
     |SI nConta = 3; |CARGA_DEF aAlfa, refere3@; |NOME_DAT #refere3@#aRef#; |FINSI;
     |SI nConta = 4; |CARGA_DEF aAlfa, refere4@; |NOME_DAT #refere4@#aRef#; |FINSI;
     |SI nConta > MAXIMO;
          |MENAV "0000ERROR, no esta definido, ver codigo...";
     |FINSI;
|FPRC;

|PROCESO Final;
     |PARA i = MAXIMO; |SI i > 0; |HACIENDO i = i - 1;
          |SI i [ nConta;
               |SI i = 1; |DELINDEX #refere1@; |DESCARGA_DEF #refere1@; |FINSI;
               |SI i = 2; |DELINDEX #refere2@; |DESCARGA_DEF #refere2@; |FINSI;
               |SI i = 3; |DELINDEX #refere3@; |DESCARGA_DEF #refere3@; |FINSI;
               |SI i = 4; |DELINDEX #refere4@; |DESCARGA_DEF #refere4@; |FINSI;
          |FINSI;
     |SIGUE;
     nConta = 0;
|FPRC;
        /* --- */

|PROCESO con00696;
     |SALVA_DATOS #refere3@;
     |REPON_DATOS #696;
     |GRABA 020#696n;
|FPRC;

|DEFBUCLE con00696;
     #refere3@#1004;
     ;
     #642#0, #642#1, #642#2, 0000;
     #642#0, #642#1, #642#2, 9999;
     ;
     NULL, con00696;
|FIN;

|PROCESO con00642;
     |SALVA_DATOS #refere2@;
     |REPON_DATOS #642;
     |GRABA 020#642n;

     |BUCLE con00696;
|FPRC;

|DEFBUCLE con00642;
     #refere2@#1003;
     ;
     #637#0, #637#1, 01;
     #637#0, #637#1, 99;
     ;
     NULL, con00642;
|FIN;

|PROCESO con00637;
     |SI #refere1@#2 ] #0#2; |Y #refere1@#2 [ #0#3;
          |ACABA;
     |FINSI;
     aAlfa = #refere1@#0 + "/" + #refere1@#1 + "                ";
     |PINTA 2145, aAlfa;

     |SALVA_DATOS #refere1@;
     |REPON_DATOS #637;
     |GRABA 020#637n;

     |BUCLE con00642;
|FPRC

|DEFBUCLE con00637;
     #refere1@#1002;
     ;
     "     ", 000000;
     "zzzzz", 999999;
     ;
     NULL, con00637;
|FIN;

|PROCESO con00623;
     |SI #refere1@#2 ] #0#2; |Y #refere1@#2 [ #0#3;
          |ACABA;
     |FINSI;
     aAlfa = #refere1@#0 + "/" + #refere1@#1 + "                ";
     |PINTA 2145, aAlfa;

     |SALVA_DATOS #refere1@;
     |REPON_DATOS #623;
     |GRABA 020#623n;
|FPRC

|DEFBUCLE con00623;
     #refere1@#1002;
     ;
     "     ", 000000;
     "zzzzz", 999999;
     ;
     NULL, con00623;
|FIN;

|PROCESO con00620;
     |SI #refere1@#2 ] #0#2; |Y #refere1@#2 [ #0#3;
          |ACABA;
     |FINSI;
     aAlfa = #refere1@#0 + "/" + #refere1@#1 + "                ";
     |PINTA 2145, aAlfa;

     |SALVA_DATOS #refere1@;
     |REPON_DATOS #620;
     |GRABA 020#620n;
|FPRC

|DEFBUCLE con00620;
     #refere1@#1002;
     ;
     "     ", 000000;
     "zzzzz", 999999;
     ;
     NULL, con00620;
|FIN;

|PROCESO con00663;
     |SI #refere1@#2 ] #0#2; |Y #refere1@#2 [ #0#3;
          |ACABA;
     |FINSI;
     aAlfa = #refere1@#0 + "/" + #refere1@#1 + "                ";
     |PINTA 2145, aAlfa;

     |SALVA_DATOS #refere1@;
     |REPON_DATOS #663;
     |GRABA 020#663n;
|FPRC

|DEFBUCLE con00663;
     #refere1@#1002;
     ;
     "     ", 000000;
     "zzzzz", 999999;
     ;
     NULL, con00663;
|FIN;

|PROCESO con00664;
     |SI #refere1@#2 ] #0#2; |Y #refere1@#2 [ #0#3;
          |ACABA;
     |FINSI;
     aAlfa = #refere1@#0 + "/" + #refere1@#1 + "                ";
     |PINTA 2145, aAlfa;

     |SALVA_DATOS #refere1@;
     |REPON_DATOS #664;
     |GRABA 020#664n;
|FPRC

|DEFBUCLE con00664;
     #refere1@#1002;
     ;
     "     ", 000000;
     "zzzzz", 999999;
     ;
     NULL, con00664;
|FIN;

|PROCESO Lineas;
     #637#0 = #refere2@#35;
     #637#1 = #refere2@#36;
     |LEE 000#637=;
     |SI FSalida = 0;
          nOk = 1;
          |ERROR10;
     |FINSI;
|FPRC;

|DEFBUCLE Lineas;
     #refere2@#1003;
     ;
     #625#0, #625#1, 0001;
     #625#0, #625#1, 9999;
     ;
     NULL, Lineas;
|FIN;

|PROCESO con00626;
     |SALVA_DATOS #refere2@;
     |REPON_DATOS #626;
     |GRABA 020#626n;
|FPRC;

|DEFBUCLE con00626;
     #refere2@#1003;
     ;
     #625#0, #625#1, 0001;
     #625#0, #625#1, 9999;
     ;
     NULL, con00626;
|FIN;

|PROCESO con00634;
     |SALVA_DATOS #refere4@;
     |REPON_DATOS #634;
     |GRABA 020#634n;
|FPRC;

|DEFBUCLE con00634;
     #refere4@#1003;
     ;
     #625#0, #625#1, 001;
     #625#0, #625#1, 999;
     ;
     NULL, con00634;
|FIN;

|PROCESO con00625;
     |SI #refere1@#2 ] #0#2; |Y #refere1@#2 [ #0#3;
          nOk = 0;
          |SI #0#26 = "N";    ||facturadas
               |SI #refere1@#16 > 0; |Y #refere1@#16 < 999999;
                    nOk = 1;
               |FINSI;
          |FINSI;
          |SI #0#27 = "N";    ||aparacadas
               |SI #refere1@#16 = 999999;
                    nOk = 1;
               |FINSI;
          |FINSI;
          |SI #0#28 = "N";    ||abiertas
               |SI #refere1@#16 = 0;
                    nOk = 1;
               |FINSI;
          |FINSI;
          |SI nOk = 0;   || Mira si existe la factura para no borrarla
               |SI #refere1@#16 > 0; |Y #refere1@#16 < 999999;
                    #625#0 = #refere1@#0;
                    #625#1 = #refere1@#1;
                    |BUCLE Lineas;
               |FINSI;
          |FINSI;
          |SI nOk = 0; |ACABA; |FINSI;
     |FINSI;
     aAlfa = #refere1@#0 + "/" + #refere1@#1 + "                ";
     |PINTA 2145, aAlfa;

     |SALVA_DATOS #refere1@;
     |REPON_DATOS #625;
     |GRABA 020#625n;

     |BUCLE con00626;

     #refere3@#0 = #625#0;
     #refere3@#1 = #625#1;
     |LEE 000#refere3@.=;
     |SI FSalida = 0;
          |SALVA_DATOS #refere3@;
          |REPON_DATOS #1625;
          |GRABA 020#1625n;
     |FINSI;

     |BUCLE con00634;
|FPRC

|DEFBUCLE con00625;
     #refere1@#1002;
     ;
     "     ", "      ";
     "zzzzz", "zzzzzz";
     ;
     NULL, con00625;
|FIN;

|PROGRAMA;
     |ABRE #0;
     |LEE 101#0p;
     |SI FSalida ! 0; |GRABA 020#0b; |FINSI;
     |SI PARAMETRO = "PANTA";
          |DDEFECTO #0;
          |PINPA #0#0;
          |PINDA #0#0;
          |ENDATOS #1#0;
          enSalida = FSalida;
          |SI FSalida = 0; |GRABA 020#0a; |FINSI;
     |SINO;
          |PINPA #0#0;
          |PINDA #0#0;
          |SI #0#8 = "S"; |Y #0#29 = "S";
               |PINTA 2113, "Facturas Taller                 ";
               aFic = "con00637" ; |HAZ Prepara;
               aFic = "con00642" ; |HAZ Prepara;
               aFic = "con00696" ; |HAZ Prepara;
               |ABRE #637;
               |ABRE #642;
               |ABRE #696;
               |BUCLE con00637;
               |CIERRA #696;
               |CIERRA #642;
               |CIERRA #637;
               |HAZ Final;
          |FINSI;
          |SI #0#8 = "S"; |Y #0#30 = "S";
               |PINTA 2113, "Facturas Venta VO               ";
               aFic = "con00623" ; |HAZ Prepara;
               |ABRE #623;
               |BUCLE con00623;
               |CIERRA #623;
               |HAZ Final;
          |FINSI;
          |SI #0#12 = "S"; |Y #0#31 = "S";
               |PINTA 2113, "Facturas Compra VO              ";
               aFic = "con00620" ; |HAZ Prepara;
               |ABRE #620;
               |BUCLE con00620;
               |CIERRA #620;
               |HAZ Final;
          |FINSI;
          |SI #0#8 = "S"; |Y #0#32 = "S";
               |PINTA 2113, "Facturas Venta VN               ";
               aFic = "con00663" ; |HAZ Prepara;
               |ABRE #663;
               |BUCLE con00663;
               |CIERRA #663;
               |HAZ Final;
          |FINSI;
          |SI #0#8 = "S"; |Y #0#33 = "S";
               |PINTA 2113, "Facturas Venta VN Accesorios    ";
               aFic = "con00664" ; |HAZ Prepara;
               |ABRE #664;
               |BUCLE con00664;
               |CIERRA #664;
               |HAZ Final;
          |FINSI;
          |SI #0#26 = "S"; |O #0#27 = "S"; |O #0#28 = "S";
               |PINTA 2113, "Ordenes Reparacion              ";
               aFic = "con00625"; |HAZ Prepara;
               aFic = "con00626"; |HAZ Prepara;
               aFic = "con01625"; |HAZ Prepara;
               aFic = "con00634"; |HAZ Prepara;
               |ABRE #625;
               |ABRE #626;
               |ABRE #1625;
               |ABRE #634;
               |BUCLE con00625;
               |CIERRA #634;
               |CIERRA #1625;
               |CIERRA #626;
               |CIERRA #625;
               |HAZ Final;
          |FINSI;
     |FINSI;
     |CIERRA #0;
|FPRO;
