|FICHEROS;
     obras008 #0;       ||Pisos.
     obras001 #1;       ||Obras.
     obras002 #2;       ||Bloques.
     obras003 #3;       ||Plantas.
     obras010 #5,MANTE; ||Mejoras Piso.
     obras009 #6;       ||Lineas Pisos.
     agifa019 #7;       ||Articulos.
     obras004 #8;       ||Pisos de Obras.
     obrasf34 #9,MANTE;       ||Auxiliar Bases.

     agifa084 #84;
     agifa069 #69;
     agifa024 #24;
     agifa019 #19;
     dsm00020 #20;
     agifa321 #321;
     agifa324 #324;
     agifa019 #19;
     agifa025 #25;
     agifa142 #142;

     obras035 #35,MANTE;
     obras036 #36;
|FIN;

|INCLUYE i_varart;

|VARIABLES;
       nModoCab = 0;
       nLin = 0;
       nSwLin = 0;
       &enSwConta = 0;
       nErr = 0;
       fmes = "";
       mes = 0;
       imneto = 0;
       nImpo = 0;
       nDto = 0;
       nForma = 0;
       nModo = 0;
       &enSwMenu = 0;
       nAlm = 0;
       aArt = "";
       aAlfa = "";
       nSw = 0;
       &EURODB = 0;
       inkey = 0;
       aa    = 0;
       c1    ="";
       c2    ="";
       c3    ="";
       c4    ="";
       c5    ="";
 {-1}aUtil  = "";
     aUtil1 = "2400";
     aUtil2 = "1";
     aUtil3 = "Opciones : ";
     aUtil4 = "BMHCpD";
     aUtil5 = "Bases";
     aUtil6 = "Mejoras";
     aUtil7 = "Hipoteca";
     aUtil8 = "E.Cobro";
     aUtil9 = "E.Hipoteca";
     aUtil10 = "E.Disponible";
|FIN;

|PROCESO leeob; |TIPO 0;
         |ABRE #1;
         #1#0=#0#0;
         |LEE 000#1=;
         |SI FSalida ! 0; |Y nSw = 0;
            |MENAV "0000No Existe la Obra...";
              |ERROR;
         |FINSI;
         |PINTA 0713, #1#1;
         |CIERRA #1;
|FPRC;

|PROCESO leebl; |TIPO 0;
         |ABRE #2;
         #2#0=#0#0;
         #2#1=#0#1;
         |LEE 000#2=;
         |SI FSalida ! 0; |Y nSw = 0;
            |MENAV "0000No Existe el Bloque...";
              |ERROR;
         |FINSI;
         |PINTA 0813, #2#2;
         |CIERRA #2;
|FPRC;

|PROCESO leepl; |TIPO 0;
         |ABRE #3;
         #3#0=#0#0;
         #3#1=#0#1;
         #3#2=#0#2;
         |LEE 000#3=;
         |SI FSalida ! 0; |Y nSw = 0;
            |MENAV "0000No Existe la Planta...";
              |ERROR;
         |FINSI;
         |PINTA 0913, #3#3;
         |CIERRA #3;
|FPRC;


|PROCESO Tipo12_35; |TIPO 12;
|FPRC;

|PROCESO LinHipo;
     #35#6 = #35#6 - #36#5;
     |SI #36#8 = "N";
          nSwLin = 1;
     |FINSI;
|FPRC;

|PROCESO mejor;  |TIPO 0;
     inkey = FSalida;
     |SI inkey = 9;
          |PUSHV 0501 2380;
          |BLANCO 1602 2378;
          |ENTLINEAL #1#5, 5 , 2 , 22 , 1, inf , sup;
          |POPV;
          |ERROR;
          |HAZ Calcula;
     |FINSI;
     |SI inkey = 13;
          |PUSHV 0501 2380;
          |BLANCO 634 2379;
          |DDEFECTO #35;
          |ABRE #35;
          #35#0 = #0#0;
          #35#1 = #0#1;
          #35#2 = #0#2;
          #35#3 = #0#3;
          |LEE 101#35=;
          |SI FSalida ! 0;
               |GRABA 020#35b;
          |FINSI;
          #35#6 = #35#4;
          nSwLin = 0;
          |BUCLELIN 2 LinHipo #35;
          |PINPA #0#35;
          |PINDA #0#35;
          |ENDATOS #1#35;
          |ABRE #36;
          #36#0 = #35#0;
          #36#1 = #35#1;
          #36#2 = #35#2;
          #36#3 = #35#3;
          #36#4 = 0;
          |LEE 000#36];
          |SI FSalida = 0; |Y #36#0 = #35#0; |Y #36#1 = #35#1;
                    |Y #36#2 = #35#2; |Y #36#3 = #35#3;
               |GRABA 020#35a;
               nErr = 0;
          |SINO;
               |BORRA 020#35c;
               nErr = 1;
          |FINSI;
          |CIERRA #35;
          |POPV;
          |PINTA #0#10;
          |SI nErr = 0;
               |SI #35#7 ! "S";
                    |CONFI "0000NContabilizar Total Hipoteca";
                    |SI FSalida = 0;
                         enSwConta = 2; |HAZ Contabiliza;
                    |FINSI;
               |FINSI;
               |SI nSwLin ! 0;
                    |CONFI "0000NContabilizar Disponible Hipoteca";
                    |SI FSalida = 0;
                         enSwConta = 3; |HAZ Contabiliza;
                    |FINSI;
               |FINSI;
          |FINSI;
          |ERROR;
          |HAZ Calcula;
     |FINSI;
|FPRC;

|PROCESO mejor1;  |TIPO 11;

    inkey = FSalida;

    |SI inkey ! 9; |ACABA; |FINSI;

    |PUSHV 14022178;

    |ENTLINEAL #1#5, 5 , 1 , 20 , 1, inf , sup;

    |POPV;
    |ERROR;

|FPRC;

|RUTINA inf;
    #5#0 = #0#0;
    #5#1 = #0#1;
    #5#2 = #0#2;
    #5#3 = #0#3;
    #5#4 = 1;
|FRUT;
|RUTINA sup;
    #5#0 = #0#0;
    #5#1 = #0#1;
    #5#2 = #0#2;
    #5#3 = #0#3;
    #5#4 = 999;
|FRUT;

|PROCESO sumame; |TIPO 2;
     #0#12 = #0#12 +. #5#10;           ||  Suma/Resta En Mejoras.
     #0#13 = #0#10 +  #0#12;           ||  Suma En campo PVP + Mejoras.
     |PINTA #0#12;
     |PINTA #0#13;
|FPRC;

|PROCESO calcuiv1;  |TIPO 0;
     |SI Campo = 7;
          enTiva = #5Campo;
          efFiva = ~;
          |HAZ SacaIVA;
          |SI eaDiva = "";
               |MENAV "0000No existe tipo iva para esta fecha...";
               |ERROR; |ACABA;
          |SINO;
               #5#8 = enIva; |PINTA #5#8;
          |FINSI;
     |FINSI;

     enTiva = #5#7;
     efFiva = ~;
     |HAZ SacaIVA;

     #5#9 = ((#5#6 * enIva) / 100 ) ! EURODB;
     #5#10 = #5#6 + #5#9;
     |PINTA #5#9;
     |PINTA #5#10;
|FPRC;

|PROCESO TotaHipo; |TIPO 0;
     #35#6 = #35#6 - Contenido + #35Campo;
     |PINTA #35#6;
|FPRC;

|PROCESO Hipo2; |TIPO 2;
     #35#6 = #35#6 -. #36#5;
     |PINTA #35#6;
     |SI #36#8 ! "S"; nSwLin = 1; |FINSI;
|FPRC;

|PROCESO LineasOb;
     |SI #6#11 = "S";
          |MENAV "0000Hay lineas contabilizadas";
          nErr = 1;
          |ERROR10;
     |FINSI;
|FPRC;

|PROCESO BorObras010;
     |BORRA 020#5a;
|FPRC;

|DEFBUCLE BorObras010;
     #5#1;
     ;
     #0#0, #0#1, #0#2, #0#3, 001;
     #0#0, #0#1, #0#2, #0#3, 999;
     be;
     NULL, BorObras010;
|FIN;

|PROCESO BorObras036;
     |BORRA 020#36a;
|FPRC;

|DEFBUCLE BorObras036;
     #36#1;
     ;
     #0#0, #0#1, #0#2, #0#3, 001;
     #0#0, #0#1, #0#2, #0#3, 999;
     be;
     NULL, BorObras036;
|FIN;

|PROCESO BorObras035;
     |BORRA 020#35a;
|FPRC;

|DEFBUCLE BorObras035;
     #35#1;
     ;
     #0#0, #0#1, #0#2, #0#3;
     #0#0, #0#1, #0#2, #0#3;
     be;
     NULL, BorObras035;
|FIN;

|PROCESO Tipo2Piso; |TIPO 2;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 3;
          nErr = 0;
          |BUCLELIN 2 LineasOb #0;
          |SI nErr ! 0;
               |ERROR; |ACABA;
          |FINSI;
          |ABRE #35;
          #35#0 = #0#0;
          #35#1 = #0#1;
          #35#2 = #0#2;
          #35#3 = #0#3;
          |LEE 101#35=;
          |SI FSalida = 0;
               |SI #35#7 = "S";
                    |MENAV "000Hipoteca contabilizada";
                    |ERROR; |ACABA;
               |FINSI;
               |BUCLELIN 1 NULL #35;
               |BORRA 020#35a;
          |FINSI;
          |CIERRA #35;
     |FINSI;
     |SI nModo = 3; |Y #0#19 = "S";
          |ABRE #84;
          #84#48 = #0#20;
          #84#0 = #0#21;
          |LEE 121#84=;
          |SI FSalida = 0;
               |SI #84#39 = "S";
                    |MENAV "0000Factura Contabilizada";
                    |ERROR; |ACABA;
               |FINSI;
               |BUCLELIN 1 NULL #84;
               nForma = -1;
               |HAZ ElCliente;
               |BORRA 020#84a;
          |FINSI;
          |CIERRA #84;
     |FINSI;
     |SI nModo = 3;
          |BUCLE BorObras010;
          |BUCLE BorObras035;
          |BUCLE BorObras036;
     |FINSI;
|FPRC;



|PROCESO pdte; |TIPO 0;

         #6#10 = #6#8 -#6#9;
         |PINTA #6#10;
|FPRC;



|PROCESO altaar;  |TIPO 30;
     |ABRE #7;
     c1=(10000 + #0#0) % -103;
     c2=(10000 + #0#1) % -103;
     c3=(10000 + #0#2) % -103;
     c4=(10000 + #0#3) % -104;
     c5=c1+c2+c3+c4;
     #7#0=c5;
     #7#1=#8#4;
     #7#18=#0#10;
     |GRABA 000#7n;
     |CIERRA #7;

|FPRC;

|PROCESO Facturar; |TIPO 0;
     aAlfa = #9#4;
     |C_M #9#5, 1, aAlfa;
     |C_M #9#6, 1, aAlfa;
|FPRC;

|PROCESO Tipo12; |TIPO 12;
     #0#15 = #9#0;
     #0#16 = #9#1;
     #0#17 = #9#2;
     #0#18 = #9#3;
     #0#7 = #0#15 + #0#16 + #0#17 + #0#18;
     |HAZ CreaFactura;
|FPRC;

|PROCESO sacabase; TIPO 7;
     |SI FSalida = 2; |ACABA; |FINSI;

     |PUSHV 0501 2380;

     #9#0 = #0#15;
     #9#1 = #0#16;
     #9#2 = #0#17;
     #9#3 = #0#18;
     #9#4 = #0#19;
     #9#5 = #0#20;
     #9#6 = #0#23;
     |PINPA #0#9;
     |PINDA #0#9;
     |SI #0#19 = "S";
          |PAUSA;
     |SINO;
          |ENDATOS #1#9;
          |HAZ Calcula;
     |FINSI;
     |POPV;

     |PINTA #0#7;
     |PINTA #0#9;
     |PINTA #0#10;
     |PINTA #0#12;
     |PINTA #0#13;
     |PINTA #0#19;
     |PINTA #0#20;
     |PINTA #0#21;
|FPRC;

|PROCESO ModiIva; |TIPO 7;
     |SI #0#19 = "S";
          |C_M #0#8, 1, "N";
     |SINO;
          |C_M #0#8, 1, "S";
     |FINSI;
|FPRC;

|PROCESO Tipo13; |TIPO 13;
     nSw = 1;
     |HAZ leeob;
     |HAZ leebl;
     |HAZ leepl;
     nSw = 0;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO Lineas;
     aArt = "";
     nAlm = 1;

     |ABRE #19;
     #19#0 = aArt;
     |LEE 000#19=;
     |CIERRA #19;

     |SI #0#15 ! 0;
          nLin = nLin + 1;
          |DDEFECTO #69;
          #69#20 = #84#48;
          #69#0 = #84#0;
          #69#1 = nLin;
          #69#2 = aArt;
          #69#3 = nAlm;
          #69#4 = "Base Imponible Piso";
          #69#5 = 1;
          #69#6 = #0#15;
          #69#7 = #0#15;
          #69#9 = #0#15;
          #69#11 = #0#8;
          #69#13 = #19#2;
          #69#14 = #19#9;
          #69#15 = #24#0;
          #69#17 = #24#17;
          #69#26 = #0#15;
          #69#27 = #0#15;
          #69#28 = #0#15;
          #69#29 = #0#15;
          |GRABA 020#69n;
     |FINSI;

     |SI #0#16 ! 0;
          nLin = nLin + 1;
          |DDEFECTO #69;
          #69#20 = #84#48;
          #69#0 = #84#0;
          #69#1 = nLin;
          #69#2 = aArt;
          #69#3 = nAlm;
          #69#4 = "Base Imponible Trastero";
          #69#5 = 1;
          #69#6 = #0#16;
          #69#7 = #0#16;
          #69#9 = #0#16;
          #69#11 = #0#8;
          #69#13 = #19#2;
          #69#14 = #19#9;
          #69#15 = #24#0;
          #69#17 = #24#17;
          #69#26 = #0#16;
          #69#27 = #0#16;
          #69#28 = #0#16;
          #69#29 = #0#16;
          |GRABA 020#69n;
     |FINSI;

     |SI #0#17 ! 0;
          nLin = nLin + 1;
          |DDEFECTO #69;
          #69#20 = #84#48;
          #69#0 = #84#0;
          #69#1 = nLin;
          #69#2 = aArt;
          #69#3 = nAlm;
          #69#4 = "Base imponible Garaje";
          #69#5 = 1;
          #69#6 = #0#17;
          #69#7 = #0#17;
          #69#9 = #0#17;
          #69#11 = #0#8;
          #69#13 = #19#2;
          #69#14 = #19#9;
          #69#15 = #24#0;
          #69#17 = #24#17;
          #69#26 = #0#17;
          #69#27 = #0#17;
          #69#28 = #0#17;
          #69#29 = #0#17;
          |GRABA 020#69n;
     |FINSI;

     |SI #0#18 ! 0;
          nLin = nLin + 1;
          |DDEFECTO #69;
          #69#20 = #84#48;
          #69#0 = #84#0;
          #69#1 = nLin;
          #69#2 = aArt;
          #69#3 = nAlm;
          #69#4 = "Base Imponible Varios";
          #69#5 = 1;
          #69#6 = #0#18;
          #69#7 = #0#18;
          #69#9 = #0#18;
          #69#11 = #0#8;
          #69#13 = #19#2;
          #69#14 = #19#9;
          #69#15 = #24#0;
          #69#17 = #24#17;
          #69#26 = #0#18;
          #69#27 = #0#18;
          #69#28 = #0#18;
          #69#29 = #0#18;
          |GRABA 020#69n;
     |FINSI;
|FPRC;

|PROCESO CreaFactura;
     |ABRE #142; |LEE 000#142p; |CIERRA #142;

     |SI #9#4 = "S"; |Y #0#19 ! "S";
          |ABRE #20;
          #20#0 = 1;          ||Dir Entrega
          |LEE 000#20=;
          |CIERRA #20;

          |ABRE #24;
          #24#0 = #0#11;
          |LEE 020#24=;
          |CIERRA #24;

          |ABRE #321;
          |ABRE #324;
          |ABRE #84;
          |ABRE #69;
          #84#48 = #9#5;
          enSwMenu = 1; |HAZ ContaFD7;
          #84#1 = #9#6;
          #84#3 = #24#0;
          #84#4 = #24#1;
          #84#5 = #24#37;
          #84#6 = #24#25;
          #84#7 = #24#38;
          #84#8 = #24#20;
          #84#9 = #20#1;
          #84#29 = #24#1;
          #84#30 = #24#8;
          #84#31 = #24#9;
          #84#32 = #24#156;
          #84#33 = #24#10;
          #84#34 = #24#7;
          #84#35 = #24#4;
          #84#36 = #24#47;
          #84#40 = #24#16;
          #84#60 = #24#15;
          #84#64 = #24#183;
          #84#65 = #24#192; ||Divisa
          #324#0 = #84#65;
          |LEE 000#324=;
          #84#66 = #324#2;  ||Cambio
          #84#67 = #24#193; ||Mone Traba
          |LEE 000#321p;
          #84#68 = #321#9;  ||Mone Base
          #324#0 = #84#68;
          |LEE 000#324=;
          #84#69 = #324#2;  ||Cambio Base
          #84#78 = #24#202;
          #84#88 = #24#22;
          #84#89 = #24#33;
          #84#90 = #24#34;
          #84#91 = #20#0;
          |GRABA 020#84b;
          |HAZ Lineas;
          |HAZ LimCabAgifa084;
          |BUCLELIN 0 CalCabAgifa084 #84;
          |GRABA 020#84a;
          |CIERRA #69;
          |CIERRA #84;
          |CIERRA #324;
          |CIERRA #321;
          nForma = 1;
          |HAZ ElCliente;
          ||컴컴컴컴컴컴
          #0#19 = "S"; |PINTA #0#19;
          #0#20 = #84#48; |PINTA #0#20;
          #0#21 = #84#0; |PINTA #0#21;
          #0#23 = #84#1;
          ||GRABA 020#0a;
          |DDEFECTO #9;
          |GRABA 020#0a;
     |FINSI;
|FPRC;

|PROCESO ElCliente;
     |ABRE #24;
     #24#0 = #84#3;
     |LEE 121#24=;
     |SI 0 = FSalida;
          fmes = #84#1 % A402;
          mes = fmes - 1;
          mes = mes * 4;
          mes = mes + 54;
          imneto = #84#15 - #84#25;
          |SI #142#115 = "N";
               nImpo = (imneto * 100) / (100 - #84#7);
               nDto = #84#25 + (imneto - nImpo);
          |SINO;
               nImpo = imneto;
               nDto = #84#25;
          |FINSI;
          #24mes = #24mes +. nImpo; || imneto;
          mes = mes + 1;
          #24mes = #24mes +. nDto;  || #0#25;
          mes = mes + 1;
          #24mes = #24mes +. #84#37;
          #24#102 = #24#102 +. nImpo; || imneto;
          #24#103 = #24#103 +. nDto;  || #0#25;
          #24#104 = #24#104 +. #84#37;
          mes = FEntrada / 100;
          mes = mes ! 0;
          |SI 1 = mes;
               #24#45 = #84#1;
               #24#46 = imneto;
          |FINSI;
          #24#110 = #24#110 +. imneto;
          imneto = imneto + #84#24;
          |GRABA 020#24a;

          enImpCliCom = nImpo * nForma;
          enImpCliDto = nDto * nForma;
          enImpCliFac = imneto * nForma;
          enImpCliMar = #84#37 * nForma;
          eaCliente = #84#3;
          efFecha = #84#1;
          |HAZ AcumulaCli;
     |FINSI;
     |CIERRA #24;
|FPRC;

|PROCESO EnlCobro; |TIPO 20;
     |SI FSalida = "OPCION";
         FSalida = "Opciones";
     |SINO;
          |ABRE #24;
          #24#0 = #0#11;
          |LEE 000#24=;
          |SI FSalida = 0;
               |LEE 101#0=;
               |SI FSalida = 0;
                    |MENU aUtil;
                    aUtil2 = FSalida;
                    |SI aUtil2 = 1;|HAZ sacabase; |FINSI;
                    |SI aUtil2 = 2; FSalida = 9; |HAZ mejor; |FINSI;
                    |SI aUtil2 = 3; FSalida = 13; |HAZ mejor; |FINSI;
                    |SI aUtil2 = 4; enSwConta = 1; |HAZ Contabiliza; |FINSI;
                    |SI aUtil2 = 5; enSwConta = 2; |HAZ Contabiliza; |FINSI;
                    |SI aUtil2 = 6; enSwConta = 3; |HAZ Contabiliza; |FINSI;
                    |GRABA 020#0a;
               |FINSI;
          |FINSI;
          |CIERRA #24;
     |FINSI;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO Mejoras;
     #0#12 = #0#12 + #5#10;
|FPRC;

|DEFBUCLE Mejoras;
     #5#1;
     ;
     #0#0, #0#1, #0#2, #0#3, 0001;
     #0#0, #0#1, #0#2, #0#3, 9999;
     ;
     NULL, Mejoras;
|FIN;

|PROCESO Calcula;
     enTiva = #0#8;
     efFiva = #0#23;
     |HAZ SacaIVA;

     |DDEFECTO #35;
     |ABRE #35;
     #35#0 = #0#0;
     #35#1 = #0#1;
     #35#2 = #0#2;
     #35#3 = #0#3;
     |LEE 000#35=;
     |CIERRA #35;

     #0#12 = 0;
     |BUCLE Mejoras;

     #0#9 = ((#0#7 * enIva) / 100 ) ! EURODB;
     #0#10 = #0#7 + #0#9 - #35#4;
     #0#13 = #0#10 + #0#12;

     |PINTA #0#9;
     |PINTA #0#10;
     |PINTA #0#13;
     |PINTA #0#12;
|FPRC;

|PROCESO Esc6; |TIPO 6;
     |HAZ Esc11;
|FPRC;

|PROCESO Esc11; |TIPO 11;
     nModoCab = (FEntrada / 100) ! 0;
     |SI nModoCab = 1; |Y Campo ] 4;
          |SI FSalida = 1; |O FSalida = 7;
               |AVISO;
               |ERROR;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Tipo5; |TIPO 5;
     |SI nModoCab = 1;
          |DDEFECTO #6;
          #6#0 = #0#0;
          #6#1 = #0#1;
          #6#2 = #0#2;
          #6#3 = #0#3;
          #6#4 = 1;
          |GRABA 000#6n;
          nModoCab = 0;
     |FINSI;
|FPRC;

|PROCESO IVA008_66; |TIPO 66;
     enTiva = #0Campo;
     efFiva = ~;
     |HAZ ConsuIVA;
     |SI eaDiva = "";
          |ERROR;
     |SINO;
          #0Campo = enTiva; |PINTA #0Campo;
     |FINSI;
|FPRC;

|PROCESO IVA008_0; |TIPO 0;
     enTiva = #0Campo;
     efFiva = ~;
     |HAZ SacaIVA;
     |SI eaDiva = "";
          |MENAV "0000No existe tipo iva para esta fecha...";
          |ERROR; |ACABA;
     |FINSI;
|FPRC;


|PROCESO IVA010_66; |TIPO 66;
     enTiva = #5Campo;
     efFiva = ~;
     |HAZ ConsuIVA;
     |SI eaDiva = "";
          |ERROR;
     |SINO;
          #5Campo = enTiva; |PINTA #5Campo;
          #5#8 = enIva; |PINTA #5#8;
     |FINSI;
|FPRC;
