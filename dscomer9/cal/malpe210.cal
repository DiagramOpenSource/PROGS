|FICHEROS;
     malpe210 #0;
     malpe211 #1;
     malpe212 #2,MANTE;
|FIN;

|VARIABLES;
     nBoton1 = 0;
     aRuta = "";
     aExcel = "";
     aAlfa = "";
     aAlfb = "";
     aAlfc = "";
     aAlfd = "";
     aAlfe = "";
     aAlff = "";
     aAlfg = "";
     aAlfh = "";
     aMensa = "";
     nXls = 0;
     nSal = 0;
|FIN;

|PROCESO Registro;
     #0#0 = aAlfh;
     #0#1 = #2#1;
     |LEE 101#0=;
     |SI FSalida = 0;
          |BUCLELIN 1 NULL #0;
     |SINO;
          |GRABA 020#0b;
     |FINSI;
     #1#0 = #0#0;
     #1#1 = #0#1;
     #1#2 = 1; #1#3 = 0;     #1#4 = 1270;  #1#5 = aAlfb; #1#6 = "TN"; |GRABA 020#1n;
     #1#2 = 2; #1#3 = 1271;  #1#4 = 3780;  #1#5 = aAlfc; #1#6 = "TN"; |GRABA 020#1n;
     #1#2 = 3; #1#3 = 3781;  #1#4 = 7560;  #1#5 = aAlfd; #1#6 = "TN"; |GRABA 020#1n;
     #1#2 = 4; #1#3 = 7561;  #1#4 = 12600;  #1#5 = aAlfe; #1#6 = "TN"; |GRABA 020#1n;
     #1#2 = 5; #1#3 = 12601; #1#4 = 17640; #1#5 = aAlff; #1#6 = "TN"; |GRABA 020#1n;
     #1#2 = 6; #1#3 = 17641; #1#4 = 99999;   #1#5 = aAlfg; #1#6 = "TN"; |GRABA 020#1n;
     |LIBERA #0;
|FPRC;

|PROCESO Importa;
     |ABRE #1;
     |ABRE #2;
     aExcel = #2#0; |QBF aAlfa;
     |XABRE "CE", aExcel, 0;
     |SI FSalida < 0
          |MENAV "0000No puedo abrir el fichero a importar";
     |SINO;
          |CARGADLL "agixl97.dll";
          |SI FSalida < 0;
               |MENAV "0000No se puede usar agixl97.dll";
          |SINO;
               |ALFACALLDLL "agixl97.dll", "carga_book", aExcel;
               |ALFACALLDLL "agixl97.dll", "selecciona_hoja", "Hoja1";
               |SI FSalida = 0;
                    |PARA nXls = #2#2; |SI nXls < 65536; |HACIENDO nXls = nXls + 1;
                         aAlfa = "Importando:" + nXls;
                         |PINTA 1916, aAlfa;

                         aAlfa = "A" + nXls; |ALFACALLDLL "agixl97.dll", "peek_dato", aAlfa;
                         |SI FSalida ! 0; |SAL; |FINSI;
                         aAlfb = "B" + nXls; |ALFACALLDLL "agixl97.dll", "peek_dato", aAlfb;
                         |SI FSalida ! 0; |SAL; |FINSI;
                         aAlfc = "C" + nXls; |ALFACALLDLL "agixl97.dll", "peek_dato", aAlfc;
                         |SI FSalida ! 0; |SAL; |FINSI;
                         aAlfd = "D" + nXls; |ALFACALLDLL "agixl97.dll", "peek_dato", aAlfd;
                         |SI FSalida ! 0; |SAL; |FINSI;
                         aAlfe = "E" + nXls; |ALFACALLDLL "agixl97.dll", "peek_dato", aAlfe;
                         |SI FSalida ! 0; |SAL; |FINSI;
                         aAlff = "F" + nXls; |ALFACALLDLL "agixl97.dll", "peek_dato", aAlff;
                         |SI FSalida ! 0; |SAL; |FINSI;
                         aAlfg = "G" + nXls; |ALFACALLDLL "agixl97.dll", "peek_dato", aAlfg;
                         |SI FSalida ! 0; |SAL; |FINSI;
                         aAlfh = "H" + nXls; |ALFACALLDLL "agixl97.dll", "peek_dato", aAlfh;
                         |SI FSalida ! 0; |SAL; |FINSI;

                         aAlfa = aAlfa; |QBT aAlfa;
                         |SI aAlfa = ""; |SAL; |FINSI;

                         aMensa = "0000Procesando " + aAlfa; |MENSA aMensa;
                         |HAZ Registro;
                         |SI nSal = 1; |SAL; |FINSI;

                    |SIGUE;
                    |ALFACALLDLL "agixl97.dll", "fin_book", "salva";
               |FINSI;
          |FINSI;
          |DESCARGADLL "agixl97.dll";
     |FINSI;
     |CIERRA #2;
     |CIERRA #1;
|FPRC;

|PROCESO Browser; |TIPO 0;
     |SI FSalida ! 10; |ACABA; |FINSI;

     aRuta = "F*.xls";

     |BROWSE aRuta;

     aRuta = aRuta % 2; |QBF aRuta;
     |SI aRuta = "F"; aRuta = ""; |FINSI;

     |QBF aRuta;
     |SI aRuta = "";
          |ERROR;
     |SINO;
          #2#0 = aRuta;
          |PINTA #2#0;
     |FINSI;
|FPRC;

|PROCESO Boton1;
     |PTEC 824;
|FPRC;

|PROCESO Tipo20; |TIPO 20;
     |SI FSalida = "OPCION";
          FSalida = "Importar XLS";
     |SINO;
          |PUSHV 0501 2380;
          |BLANCO 1313 2167;
          |PINPA #0#2;
          |PINDA #0#2;
          |CONTROL_SIMPLE 0, "BOTON,Fichero", 1616, 1623, Boton1;
          nBoton1 = FSalida;
          |ENDATOS #1#2;
          |SI FSalida = 0;
               |HAZ Importa;
          |FINSI;
          |FIN_CONTROL_WINDOWS nBoton1;
          |PULSATECLA;
          |POPV;
     |FINSI;
|FPRC;
