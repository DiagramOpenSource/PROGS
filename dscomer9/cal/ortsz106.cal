|FICHEROS;
     ortsz006 #0;
     ortsz007 #100,MANTE;

     ortsm001 #1;
     ortsm002 #2;
     ortsm003 #3;
     ortsm004 #4;
     ortsw001 #10;  ||TMP
     ortsw003 #11;  ||TMP
     ortsm013 #13;
     ortsm014 #14;
     agifa048 #480;
     agifa049 #49;
     agifa104 #104;
     agifa073 #73;
     agifa019 #19;
     agifa024 #24;

|FIN;

|VARIABLES;
     f = @;
     nSal = 0;
     aMarca = "";
     nCampo = 0;
     &enHora = "";
     nCuenta   = 0;
     nTCuenta  = 0;
     nPen      = 0;
     &enBulto  = 0;
     &enCBart  = "";
     &enCBcom  = "";
     aInforme  = "ortsy001";
     aAlfa     = "";
     aImpre    = "";
     nSw       = 0;
     i         = 0;
     nSwImp    = 0;
     aDesSer = "";
     aHasSer = "";
     nDesNum = 0;
     nHasNum = 0;
     fFecha = @;
|FIN;

|PROCESO ControlBultos;
     |ABRE #14;
     #14#0 = #10#0;
     #14#1 = #10#1;
     |LEE 101#14=;
     |SI FSalida ! 0; |GRABA 020#14b; |FINSI;
     #14#2 = #2#2;  || T.Bultos
     #14#3 = #13#3;  || N
     #14#4 = #0#4;
     #14#5 = #0#5;
     |GRABA 020#14a;
     |CIERRA #14;
|FPRC;

|PROCESO ContaEtiqueta;
     |ABRE #13;
     |SELECT #2#13;
     #13#1 = #10#0;
     #13#2 = #10#1;
     |LEE 101#13=;
     |SI FSalida = 0;
          #13#5 = "S";
          |GRABA 020#13a;
     |FINSI;
     |CIERRA #13;
|FPRC;

|PROCESO Temporal;
     |ABRE #13;
     |SELECT #2#13;
     #13#1 = #10#0;
     #13#2 = #10#1;
     |LEE 000#13=;
     nSal = FSalida;
     |CIERRA #13;
     |SI nSal ! 0; |ACABA; |FINSI;

     |SI nSw = 0;
          nSw = 1;
          |ERROR10;
     |FINSI;

     |DDEFECTO #2;
     #2#0 = #10#0;
     #2#1 = #10#1;
     |LEE 020#2=;
     enBulto = #2#2;

     |DDEFECTO #104;
     #104#25 = #10#0;
     #104#0 = #10#1;
     |LEE 020#104=;

     |DDEFECTO #73;
     #73#28 = #10#0;
     #73#0 = #10#1;
     #73#1 = #10#7;
     |LEE 020#73=;

     |DDEFECTO #24;
     #24#0 = #104#4;
     |LEE 020#24=;

     |DDEFECTO #19;
     #19#0 = #10#2; ||   Compo
     |LEE 020#19=;
     enCBcom = #19#128;

     |DDEFECTO #480;
     aAlfa = #10#5; |QBF aAlfa;
     |SI aAlfa ! "";
          #480#0 = #10#5;
          |LEE 020#480=;

          |SALVA_DATOS #19;
          |DDEFECTO #19;
          #19#0 = #10#5; ||   Escan
          |LEE 020#19=;
          enCBart = #19#128;
          |REPON_DATOS #19;
          |LEE 020#19=;
     |SINO;
          #480#0 = #19#0;
          #480#1 = #19#1;
          enCBart = enCBcom;
     |FINSI;

     |DDEFECTO #49;
     |SI #10#6 ! 0;
          #49#0 = #10#5;
          #49#1 = #10#6;
          |LEE 000#49=;
     |FINSI;

     |HAZ ContaEtiqueta;
     |HAZ ControlBultos;
     |HORA enHora;
     enHora = enHora % 105;
     |PARA i = 1; |SI i [ #10#3; |HACIENDO i = i + 1;
          |PRINT;
          |PIEINF;
     |SIGUE;
|FPRC;

|DEFBUCLE Temporal;
     #10#2;
     ;
     #1#2, "  ", 000000, 000, 0000;
     #1#2, "zz", 999999, 999, 9999;
     ;
     NULL, Temporal;
|FIN;

|PROCESO ortsm001;
     nSw = 0;
     |BUCLE Temporal;
     |SI nSw = 0; |ACABA; |FINSI;

     aImpre = #10#4; |QBF aImpre;
     Impresora =  aImpre;
     |IMPRE -1;
     |SI FSalida = 0;
          aInforme  = "ortsy001";
          |INFOR aInforme;
          |SI FSalida = 0;
               |BUCLE Temporal;
               |FININF;
          |SINO;
               aAlfa = "0000Falta informe [" + aInforme + "]";
               |MENAV aAlfa;
          |FINSI;
          |FINIMP;
     |SINO;
          aAlfa = "0000Impresora no definida [" + aImpre + "]";
          |MENAV aAlfa;
     |FINSI;
|FPRC;

|DEFBUCLE ortsm001;
     #1#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, ortsm001;
|FIN;


|PROCESO Componentes;
     |SI #49#10 = 4; |Y nCampo [ 25;
          #11nCampo = #49#3;
          nCampo = nCampo + 1;
          |GRABA 020#11a;
     |FINSI;
     |LIBERA #11;
|FPRC;

|DEFBUCLE Componentes;
     #49#1;
     ;
     #11#5, 001;
     #11#5, 999;
     ;
     NULL, Componentes;
|FIN;

|PROCESO PonComponentes;
     nCampo = 11;
     |BUCLE Componentes;
|FPRC;

|DEFBUCLE PonComponentes;
     #11#1;
     ;
     INICIO;
     FINAL;
     be;
     NULL, PonComponentes;
|FIN;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO agifa049;
     #19#0 = #49#2;
     |LEE 020#19=;

     |SI #49#10 = 4;
          nCuenta = nCuenta + 1;
          #2#2 = #2#2 + (#73#5 - #73#43); ||Bultos Pedido
          |DDEFECTO #10;
          #10#4 = #1#2;
          #10#0 = #73#28;
          #10#1 = #73#0;
          #10#7 = #73#1;
          #10#2 = #49#2;
          |LEE 101#10=;
          |SI FSalida ! 0; |GRABA 020#10b; |FINSI;
          #10#3 = #10#3 + (#73#5 - #73#43);
          #10#5 = #49#0;
          #10#6 = #49#1;
          #10#8 = nCuenta;
          #10#9 = nTCuenta;
          |GRABA 020#10a;
          |LIBERA #10;

          |DDEFECTO #11;
          #11#4 = #1#3;
          #11#10 = #49#7;
          #11#0 = #73#28;
          #11#1 = #73#0;
          #11#7 = #73#1;
          #11#2 = #49#2;
          |LEE 101#11=;
          |SI FSalida ! 0; |GRABA 020#11b; |FINSI;
          #11#3 = #11#3 + (#73#5 - #73#43);
          #11#5 = #49#0;
          #11#6 = #49#1;
          #11#8 = nCuenta;
          #11#9 = nTCuenta;
          |GRABA 020#11a;
          |LIBERA #11;

          |DDEFECTO #4;
          #4#0 = #3#0;
          #4#1 = #3#1;
          #4#2 = #3#2;
          #4#3 = #49#2;
          |LEE 101#4=;
          |SI FSalida ! 0; |GRABA 020#4b; |FINSI;
          #4#4 = #49#3;
          #4#6 = #4#6 + (#73#5 - #73#43);
          #4#7 = #4#5;
          #4#8 = 1;
          #4#9 = #19#128;
          |GRABA 020#4a;
          |LIBERA #4;
     |FINSI;
|FPRC;

|DEFBUCLE agifa048;
     #480#1;
     ;
     #73#2;
     #73#2;
     ;
     NULL, NULL, agifa049;
|FIN;

|PROCESO CuentaMate;
     |SI #49#10 = 4;
          nTCuenta = nTCuenta + 1;
     |FINSI;
|FPRC;

|DEFBUCLE CuentaMate;
     #480#1;
     ;
     #73#2;
     #73#2;
     ;
     NULL, NULL, CuentaMate;
|FIN;

|PROCESO agifa073;
     nPen = #73#5 - #73#43;
     |SI nPen = 0; |ACABA; |FINSI;

     |DDEFECTO #19;
     #19#0 = #73#2;
     |LEE 020#19=;
     aMarca = #19#126;

     |DDEFECTO #1;
     #1#0 = #19#127;
     |LEE 000#1=;
     |SI FSalida ! 0;
          aAlfa = "0000No se ha  definido la impresora para" + &13 + "[" + #19#0 + "]";
          |MENAV aAlfa;
          |ACABA;
     |FINSI;

     |DDEFECTO #2;
     #2#0 = #73#28;
     #2#1 = #73#0;
     |LEE 101#2=;
     |SI FSalida ! 0; |GRABA 020#2b; |FINSI;

     nSwImp = 0;
     |ABRE #480;
     #480#0 = #19#0;
     |LEE 000#480=;
     |SI FSalida ! 0;
          nSwImp = 1;
     |FINSI;
     |CIERRA #480;

     |SI #19#4 = 1;
          |SI nSwImp = 0;
               #2#2 = #2#2 + (#73#5 - #73#43); ||Bultos Pedido
               |DDEFECTO #10;
               #10#4 = #1#2;
               #10#0 = #73#28;
               #10#1 = #73#0;
               #10#7 = #73#1;
               #10#2 = #73#2;
               |LEE 101#10=;
               |SI FSalida ! 0; |GRABA 020#10b; |FINSI;
               #10#3 = #10#3 + (#73#5 - #73#43);
               #10#5 = "";
               #10#8 = 1;
               #10#9 = 1;
               |GRABA 020#10a;
               |LIBERA #10;

               |DDEFECTO #11;
               #11#4 = #1#3;
               #11#10 = aMarca;
               #11#0 = #73#28;
               #11#1 = #73#0;
               #11#7 = #73#1;
               #11#2 = #73#2;
               |LEE 101#11=;
               |SI FSalida ! 0; |GRABA 020#11b; |FINSI;
               #11#3 = #11#3 + (#73#5 - #73#43);
               #11#5 = "";
               #11#8 = 1;
               #11#9 = 1;
               |GRABA 020#11a;
               |LIBERA #11;
          |FINSI;

          |DDEFECTO #3;
          #3#0 = #2#0;
          #3#1 = #2#1;
          #3#2 = #73#2;
          |LEE 101#3=;
          |SI FSalida ! 0; |GRABA 020#3b; |FINSI;
          #3#3 = #73#4;
          #3#8 = #73#1;
          #3#9 = #73#6;
          #3#10 = #3#10 + (#73#5 - #73#43);
          #3#11 = #3#4;
          #3#12 = "N";
          #3#13 = #19#128;
          |GRABA 020#3a;
          |LIBERA #3;
     |SINO;
          |DDEFECTO #3;
          #3#0 = #2#0;
          #3#1 = #2#1;
          #3#2 = #73#2;
          |LEE 101#3=;
          |SI FSalida ! 0; |GRABA 020#3b; |FINSI;
          #3#3 = #73#3;
          #3#8 = #73#1;
          #3#9 = #73#6;
          #3#10 = #3#10 + (#73#5 - #73#43);
          #3#11 = #3#4;
          #3#12 = "S";
          #3#13 = #19#128;
          |GRABA 020#3a;
          |LIBERA #3;

          nTCuenta = 0;
          |BUCLE CuentaMate;
          nCuenta = 0;
          |BUCLE agifa048;
     |FINSI;

     |GRABA 020#2a;
     |LIBERA #2;
|FPRC;

|PROCESO Limpi04;
     #4#6 = 0;
     |GRABA 020#4a;
     |LIBERA #4;
|FPRC;

|DEFBUCLE Limpi04;
     #4#1;
     ;
     #3#0, #3#1, #3#2, "                    ";
     #3#0, #3#1, #3#2, "zzzzzzzzzzzzzzzzzzzz";
     be;
     NULL, Limpi04;
|FIN;

|PROCESO Limpi03;
     |BUCLE Limpi04;
     #3#10 = 0;
     |GRABA 020#3a;
     |LIBERA #3;
|FPRC;

|PROCESO Limpi02;
     #2#2 = 0;
     |GRABA 020#2a;
     |LIBERA #2;
|FPRC;

|DEFBUCLE Limpi02;
     #2#1;
     ;
     #104#25, #104#0;
     #104#25, #104#0;
     be;
     NULL, Limpi02, Limpi03;
|FIN;

|PROCESO ortsz007;
     |SI #100#7 = "*";
          |ABRE #104;
          #104#25 = #100#1;
          #104#0 = #100#2;
          |LEE 000#104=;
          |SI FSalida = 0;
               |BUCLE Limpi02;
               |ABRE #2;
               |ABRE #3;
               |ABRE #4;
               |BUCLELIN 2 agifa073 #104;
               |CIERRA #4;
               |CIERRA #3;
               |CIERRA #2;
          |FINSI;
          |CIERRA #104;
     |FINSI;
|FPRC;

|DEFBUCLE ortsz007;
     #100#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, ortsz007;
|FIN;

|PROCESO Imprime;
     aAlfa = "1" + Usuario;
     |NOME_DAT #10 aAlfa; |DELINDEX #10;
     aAlfa = "2" + Usuario;
     |NOME_DAT #11 aAlfa; |DELINDEX #11;

     |ABRE #1;
     |ABRE #10;
     |ABRE #11;
     |ABRE #19;
     |BUCLE ortsz007;
     |CIERRA #19;
     |CIERRA #11;
     |CIERRA #10;
     |CIERRA #1;


     |ABRE #2;
     |ABRE #104;
     |ABRE #73;
     |ABRE #24;
     |ABRE #19;
     |ABRE #480;
     |ABRE #49;
     |BUCLE ortsm001;
     |CIERRA #49;
     |CIERRA #480;
     |CIERRA #19;
     |CIERRA #24;
     |CIERRA #73;
     |CIERRA #104;
     |CIERRA #2;
|FPRC;
