|FICHEROS;
     dsm00219 #0;
     dsm00214 #1;
     tmp00216 #2;
     dsm00215 #3;
|FIN;

|VARIABLES;
     aFichero = "";
     ip_serv = "";
     serv_correo = "";
     from = "";
     to = "";
     subject = "";
     mensaje = "";
     ficheros = "";
     prim = 0;
     &errorenv = 0;
     aAlfa     = "";
|FIN;

|PROCESO Envia;
     #3#0 = #2#0;
     |LEE 000#3=;
     |SI FSalida ! 0; |ACABA; |FINSI;
     aAlfa = #3#3;
     |QBF aAlfa;
     |SI aAlfa = ""; |ACABA; |FINSI;
     to = #3#3;
     ficheros = aFichero;
     ip_serv = "";
     |SI #1#1 = 0;|Y #1#2 = 0;|Y #1#3 = 0;|Y #1#4 = 0;
          |IP_LOCAL ip_serv;
     |SINO;
          ip_serv = #1#1+"."+#1#2+"."+#1#3+"."+#1#4;
     |FINSI;
     serv_correo = #1#5;
     from = #1#6;
     prim = 0;
     subject = #1#8;
     mensaje = #1#9;
     |QBT ip_serv ;
     |QBF serv_correo;
     |QBF from;
     |QBF to;
     |QBF subject;
     |QBF mensaje;
     |QBF ficheros;
     |MENSA "0000Enviando fichero ...";
     |DSCORREO_ENVIA ip_serv,serv_correo,from,to,subject,mensaje,ficheros;
     |SI FSalida ! 0;
          errorenv = 1;
     |FINSI;
|FPRC;

|PROCESO tmp00216;
     aFichero = #2#1; |QBF aFichero;
     |SI aFichero ! ""; |HAZ Envia; |FINSI;

     aFichero = #2#2; |QBF aFichero;
     |SI aFichero ! ""; |HAZ Envia; |FINSI;
|FPRC;

|DEFBUCLE tmp00216;
     #2#1;
     ;
     "  ";
     "zz";
     ;
     NULL,tmp00216;
|FIN;

|PROGRAMA;
     |CONFI "0000SEsta seguro de que desea enviar los datos";
     |SI FSalida = 0;
          errorenv = 0;
          |ABRE #0;
          |ABRE #1;
          |ABRE #3;
          |LEE 010#1p;
          |SI FSalida ! 0;
               |MENAV "0000No se han establecido los parametros de envio";
          |SINO;
               |BUCLE tmp00216;
               |SI errorenv ! 0;
                    |MENAV "0000Ha habido un error durante el envio.";
               |SINO;
                    |MENSA "000Mensaje enviado."
               |FINSI;
          |FINSI;
          |CIERRA #1;
          |CIERRA #3;
          |CIERRA #0;
     |FINSI;
|FPRO;
