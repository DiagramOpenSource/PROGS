|FICHEROS;
 primy005 #0;
 agifa570 #1;||Temporal;
 agifa071 #2;
 agifa010 #3;
 agifa024;
|FIN;

|VARIABLES;
 mes   = "";
 mesnu = 0;
 dserie = "  ";
 hserie = "zz";
 dalba  = 0;
 halba  = 999999;
 dcli   = "      ";
 hcli   = "zzzzzz";
 dart   = "                    ";
 hart   = "zzzzzzzzzzzzzzzzzzzz";
 informe = "primy005";
 sw = 0;
 cliente = "";
 abono = 0;

     &enAlta = 0;
     &eaArticulo = "";
|FIN;

||INCLUYE i_llena;

|PROCESO llena;
     enAlta = 1;
     eaArticulo = #0Campo;
     |HAZ LlenaArticulo;
     |SI FSalida = 0;
          #0Campo = eaArticulo;
          |PINTA #0Campo;
     |SINO;
          |ERROR; |ACABA;
     |FINSI;
|FPRC;

|PROCESO index;
|ATRI P;
|PINTA 2224," Calculando Meses ........ ";
|ATRI 0;

|DDEFECTO #3;
#3#0  = #2#0; ||Albaran cabecera;
#3#52 = #2#29;||Serie Albaran;
|LEE 000#3=;
mes = #3#1 % 402;||Coge el mes de la fecha;
|SI #3#43 = "S";
     abono = -1;
|SINO;
     abono = 1;
|FINSI;

|DDEFECTO #agifa024;
#agifa024#0 = #3#3;
|LEE 000#agifa024.=;

|DDEFECTO #1;
#1#0 = #2#15;||Cliente;
#1#1 = #2#2; ||Articulo;
|LEE 101#1=;
|SI FSalida = 0;
    mesnu   = mes;
    mesnu   = mesnu + 1;
    #1mesnu = #1mesnu + (#2#5 * abono); || acumula unidades
||    #1#14 = #agifa024#26;               || representante 2
    |GRABA 020#1a;
|SINO;
    mesnu   = mes;
    mesnu   = mesnu + 1;
    #1mesnu = #2#5 * abono;             || acumula unidades
||    #1#14 = #agifa024#26;               || representante 2
    |GRABA 020#1n;
|FINSI;
|LIBERA #1;
|FPRC;


|DEFBUCLE lineas;
 #2#1;
 2,15;
 dserie,dalba,001,#0#2,#0#0;
 hserie,halba,999,#0#3,#0#1;
 be;
 NULL,index;
|FIN;

|PROCESO impre;
|SI sw = 0;
    cliente = #1#0;
    sw = 1;
|FINSI;

|SI cliente ! #1#0;
    cliente = #1#0;
    |PIEINF;
    |PRINT;
|SINO;
    |PRINT;
|FINSI;
|FPRC;


|DEFBUCLE temporal;
 #1#1;
 ;
 dcli,dart;
 hcli,hart;
 be;
 NULL,impre;
|FIN;


|PROCESO tempo;|TIPO 3;
  |ABRE #1;
  |CIERRA #1;
  |DELINDEX #1;

  |ABRE #1;
  |ABRE #3;
  |ABRE #agifa024;
    |BUCLE lineas;
    |IMPRE 0;
    |SI FSalida = 0;
       |INFOR informe;
       |SI FSalida = 0;
          |BUCLE temporal;
          |||PRINT;
          |PIEINF;
          |FININF;
       |FINSI;
       |FINIMP;
    |FINSI;
  |CIERRA #1;
  |CIERRA #3;
  |CIERRA #agifa024;
|FPRC;
