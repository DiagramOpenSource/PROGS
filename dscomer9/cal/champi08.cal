|FICHEROS;
     champi08 #0;
     champi05 #5;
     champi07 #7;
     agifa077 #77;
     agifa080 #80;
     agifa112 #112;
     agifa065 #65;
     agifa142 #142;
|FIN;

|VARIABLES;
     &enSwMenu = 0;
     &enImpPrvCom = 0;
     &efFecha = @;
     &eaProve = "";
     nImpo = 0;
     aMes = "";
     nMes = 0;
     nForma = 0;
     aProve = "";
     nPorce = 0;
     nNuevo = 0;
     nUni = 0;
     nBruto = 0;
     nTara = 0;
     nBulto = 0;
|FIN;

|PROCESO  ActProveedor;
     nImpo = (#80#9 < #77#5) < #77#32;
     |SI #142#114 = "S";
          nImpo = nImpo < #77#7;
     |FINSI;
     #112#0 = #80#15;
     |LEE 101#112=;
     |SI FSalida = 0;
         aMes = #0#1 % A402;
         nMes = aMes + 26;
         |SI #77#42 = "N";
             #112nMes = #112nMes + (nImpo * nForma);
             #112#39 = #112#39 + (nImpo * nForma);
         |SINO;
             #112nMes = #112nMes - (nImpo * nForma);
             #112#39 = #112#39 - (nImpo * nForma);
         |FINSI;
         |GRABA 020#112a;
     |FINSI;
     |LIBERA #112;

     |SI #77#42 = "N";
          enImpPrvCom = nImpo * nForma;
     |SINO;
          enImpPrvCom = -nImpo * nForma;
     |FINSI;
     efFecha = #77#1;
     eaProve = #77#3;
     |HAZ AcumulaPrv;
|FPRC;

|PROCESO FinCab;
     |HAZ LimCabAgifa077;
     |BUCLELIN 0CalCabAgifa077#77;
     |GRABA 020#77a;
     |LIBERA #77;

     |SALVA_FICHA #77;
     #77#0 = nNuevo;
     |LEE 101#77=;
     |SI FSalida = 0;
          #77#3 = #7#2;
          #112#0 = #77#3;
          |LEE 000#112=;
          #77#4 = #112#1;
          |HAZ LimCabAgifa077;
          |BUCLELIN 0CalCabAgifa077#77;
          |GRABA 020#77a;
          |LIBERA #77;

          |DDEFECTO #7;
          #7#0 = #77#50;
          #7#1 = #77#0;
          #7#3 = 0;
          #7#4 = "S";
          #7#5 = aProve;
          #7#6 = nPorce;
          |GRABA 020#7n;
     |FINSI;
     |LIBERA #77;
     |REPON_FICHA #77;
|FPRC;

|PROCESO agifa080;
     nForma = -1; |HAZ ActProveedor;

     nUni = #80#5;
     #80#5 = #80#5 * nPorce / 100;
     |HAZ TotalLin80;
     |GRABA 020#80a;
     nForma = 1; |HAZ ActProveedor;

     |DDEFECTO #5;
     #5#0 = #80#27;
     #5#1 = #80#0;
     #5#2 = #80#1;
     |LEE 101#5=;
     |SI FSalida ! 0; |GRABA 020#5b; |FINSI;
     nBulto = #5#3;
     nBruto = #5#4;
     nTara = #5#5;
     #5#3 = #5#3 * nPorce / 100;
     #5#4 = #5#4 * nPorce / 100;
     #5#5 = #5#5 * nPorce / 100;
     |GRABA 020#5a;
     |LIBERA #5;

     #65#0 = #80#2;
     #65#1 = #77#1;
     #65#2 = "AC";
     #65#3 = #80#0;
     #65#4 = #80#1;
     #65#11 = #80#27;
     |LEE 121#65=;
     |SI FSalida = 0;
          #65#6 = #80#5;
          |GRABA 020#65a;
          |LIBERA #65;

          ||-- el nuevo
          #65#3 = nNuevo;
          #65#6 = nUni - #80#5;
          #65#10 = aProve;
          |GRABA 020#65n;
     |FINSI;
     |LIBERA #65;

     ||---el nuevo
     #80#0 = nNuevo;
     #80#5 = nUni - #80#5;
     #80#15 = aProve;
     |HAZ TotalLin80;
     |GRABA 020#80n;
     nForma = 1; |HAZ ActProveedor;

     |DDEFECTO #5;
     #5#0 = #80#27;
     #5#1 = #80#0;
     #5#2 = #80#1;
     |SI FSalida ! 0; |GRABA 020#5b; |FINSI;
     #5#3 = nBulto - #5#3;
     #5#4 = nBruto - #5#4;
     #5#5 = nTara - #5#5;
     |GRABA 020#5a;
     |LIBERA #5;
|FPRC;

|PROCESO agifa077;
     #7#0 = #77#50;
     #7#1 = #77#0;
     |LEE 101#7=;
     |SI #7#4 ! #0#8;
          |ERROR;
     |SINO;
          nPorce = 100 - #7#3;
          aProve = #77#3;

          |SALVA_FICHA #77;
          |SALVA_DATOS #77;
          enSwMenu = 1;
          |HAZ ContaAC7;
          nNuevo = #77#0;
          |REPON_DATOS #77;
          #77#0 = nNuevo;
          |GRABA 020#77b;
          |SI FSalida = 0;
               #7#4 = "S";
               |GRABA 020#7a;
          |SINO;
               |ERROR;
          |FINSI;
          |REPON_FICHA #77;
     |FINSI;
     |LIBERA #7;
|FPRC;

|DEFBUCLE agifa077;
     #77#1;
     3, 1, 38;
     #0#2, #0#4, #0#0, #0#6, "N";
     #0#3, #0#5, #0#1, #0#7, "N";
     be;
     NULL, agifa077, agifa080, FinCab;
|FIN;

|PROCESO Tipo3; |TIPO 3;
     |ABRE #142; |LEE 000#142p; |CIERRA #142;
     |ABRE #112;
     |ABRE #7;
     |ABRE #5;
     |ABRE #65;
     |BUCLE agifa077;
     |CIERRA #65;
     |CIERRA #5;
     |CIERRA #7;
     |CIERRA #112;
|FPRC;
