|FICHEROS;
     guillz02 #0;
     guillw03 #3;
     guillw04 #4;
     agifa010 #10;
     agifa019 #19;
     agifa024 #24;
     agifa071 #71;
     dsm00134 #134;
|FIN;

|VARIABLES;
     &Tempo = "";
     aTmp3 = "";
     aTmp4 = "";
     aRuta = "";
     nBoton1 = 0;
     aFic = "";
     nHandle = 0;
     aAlfa = "";
     aFinReg = "";
     aDato = "";
     aCli = "";
     aTipo = "";
     aAlf1 = "";
     nPos = 0;
     nLon = 0;
     nNume = 0;
     nAbono = 0;
     nNu1 = 0;
     nNu2 = 0;
     nDec = 0;
     aCondi = "";
     fFecha = @;
     nReg = 0;
     nAlb = 0;
     nDto = 0;
     nHay = 0;
     nDtoDis = 0;
     nImpDto = 0;
     nUni = 0;
     nPvp = 0;
|FIN;

|PROCESO Laborable;
     nNume = #10#1;
     nNume = nNume - 1;
     fFecha = nNume;
     fFecha = fFecha % A1;
     aAlfa = fFecha % 1101;
     |SI aAlfa = "S";
          nNume = nNume - 1;
          fFecha = nNume;
     |FINSI;
     |SI aAlfa = "D";
          nNume = nNume - 2;
          fFecha = nNume;
     |FINSI;
     aAlfa = (fFecha % 704) + (fFecha % 402) + (fFecha % 102);
|FPRC;

|PROCESO Relleno;
     |SI aTipo = "F";
          |SI aAlfa ! "";
               aAlfa = (aAlfa % -104) + (aAlfa % 402) + (aAlfa % 102);
          |FINSI;
          aAlf1 = " " * nLon;
          aAlfa = aAlfa + aAlf1;
          nPos = nLon + 100;
          aAlfa = aAlfa % nPos;
     |FINSI;

     |SI aTipo = "A";
          |ANSI_OEM aAlfa, aAlfa;
          aAlf1 = " " * nLon;
          aAlfa = aAlfa + aAlf1;
          nPos = nLon + 100;
          aAlfa = aAlfa % nPos;
     |FINSI;

     |SI aTipo = "N";
          nNume = aAlfa;
          |SI nNume < 0; nAbono = -1; |SINO; nAbono = 1; |FINSI;
          |SI nNume < 0; nNume = nNume * - 1; |FINSI;
          nNu1 = nNume ! 0;
          |SI nNu1 > nNume; nNu1 = nNu1 - 1; |FINSI;
          nNu2 = nNume - nNu1;
          |SI nDec < 0;
               aAlfa = nNume;
          |SINO;
               |SI nDec = 0;
                    aAlfa = nNu1;
               |SINO;
                    aAlfa = nNu2;
                    aAlfa = aAlfa + "00000000000000000000000000";
                    nPos = nDec + 300;
                    aAlfa = aAlfa % nPos;
                    ||aAlfa = nNu1 + "." + aAlfa;  || con decimal
                    aAlfa = nNu1 + aAlfa;          || sin decimal
               |FINSI;
          |FINSI;
          aAlfa = "000000000000000000000000000000000000000000000" + aAlfa;
          |SI nAbono = 1;
               nPos = -1 * (nLon + 100);
               aAlfa = aAlfa % nPos;
          |SINO;
               nPos = -1 * (nLon + 99);
               aAlfa = "-" + aAlfa % nPos;
          |FINSI;
          nDec = 0;
     |FINSI;
     aDato = aDato + aAlfa;
|FPRC;

|PROCESO ImpDto;
     |SI #19#3 = "ENVAS";
          nPvp = #19#19;
     |SINO;
          nPvp = #19#18;
     |FINSI;

     nImpDto = 0;
     |SI #71#66 ! 0;
          nImpDto = nImpDto + (#71#66 * nPvp);
          aCondi = "S";
     |FINSI;
     |SI #71#65 ! 0;
          nImpDto = nImpDto + (#71#7 * #71#65 / 100);
          aCondi = "S";
     |FINSI;
     |SI #71#64 ! 0;
          nImpDto = nImpDto + #71#64;
          aCondi = "S";
     |FINSI;
     |SI #71#8 ! 0;
          nImpDto = nImpDto + (#71#7 * #71#8 / 100);
          aCondi = "S";
     |FINSI;
     |SI #71#6 ! nPvp;
          nImpDto = nImpDto + ((nPvp - #71#6) * #71#5);
          aCondi = "S";
     |FINSI;
|FPRC;

|PROCESO DtoDis;
     |SI #19#3 = "ENVAS";
          nPvp = #19#19;
     |SINO;
          nPvp = #19#18;
     |FINSI;

     |DDEFECTO #134;
     #134#0 = #10#3;
     #134#1 = #71#2;
     |LEE 000#134=;
     |SI FSalida = 0; |Y #10#1 ] #134#6; |Y #10#1 [ #134#7;
          |SI #134#3 ! 0;
               nDtoDis = (#134#3 * 100) / (#134#3 + #134#2);
               aCondi = "S";
          |FINSI;
          |SI #134#5 ! 0;
               nDtoDis = #134#5;
               aCondi = "S";
          |FINSI;
          |SI #134#4 ! 0;
               nDtoDis = ( #134#4 * 100) / nPvp;
               aCondi = "S";
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO DICC; ||Long=49
     aDato = "DICC ";
     aAlfa = #10#3; aTipo = "N"; nLon = 15; |HAZ Relleno;
     aAlfa = "0000000" + #71#2; |QBF aAlfa;
     aAlfa = aAlfa % -108;
     aTipo = "A"; nLon = 8; |HAZ Relleno;
     ||aAlfa = #71#2; aTipo = "N"; nLon = 8; |HAZ Relleno;
     aAlfa = nImpDto; aTipo = "N"; nLon = 5; nDec = 2; |HAZ Relleno;
     aAlfa = "19000101"; aTipo = "A"; nLon = 8; |HAZ Relleno;
     aAlfa = "29991231"; aTipo = "A"; nLon = 8; |HAZ Relleno;

     nReg = nReg + 1;
     aDato = aDato + aFinReg;
     |XGRABA nHandle, aDato;
|FPRC;

|PROCESO DIDD; ||Long=44
     aDato = "DIDD ";
     aAlfa = #10#0; aTipo = "N"; nLon = 10; |HAZ Relleno;
     aAlfa = "0000000" + #71#2; |QBF aAlfa;
     aAlfa = aAlfa % -108;
     aTipo = "A"; nLon = 8; |HAZ Relleno;
     ||aAlfa = #71#2; aTipo = "N"; nLon = 8; |HAZ Relleno;
     aAlfa = "CL"; aTipo = "A"; nLon = 5; |HAZ Relleno;
     aAlfa = nImpDto; aTipo = "N"; nDec = 2; nLon = 11; |HAZ Relleno;
     aAlfa = ""; aTipo = "A"; nLon = 5; |HAZ Relleno;

     nReg = nReg + 1;
     aDato = aDato + aFinReg;
     |XGRABA nHandle, aDato;
|FPRC;

|PROCESO DIDP; ||Long=64
     aDato = "DIDP ";
     aAlfa = #10#0; aTipo = "N"; nLon = 10; |HAZ Relleno;
     aAlfa = "0000000" + #71#2; |QBF aAlfa;
     aAlfa = aAlfa % -108;
     aTipo = "A"; nLon = 8; |HAZ Relleno;
     ||aAlfa = #71#2; aTipo = "N"; nLon = 8; |HAZ Relleno;
     |SI nUni > 0;
          aAlfa = nUni; aTipo = "N"; nLon = 8; |HAZ Relleno;
          aAlfa = "0"; aTipo = "N"; nLon = 8; |HAZ Relleno;
          aAlfa = nUni; aTipo = "N"; nLon = 8; |HAZ Relleno;
          aAlfa = "0"; aTipo = "N"; nLon = 8; |HAZ Relleno;
     |SINO;
          aAlfa = "0"; aTipo = "N"; nLon = 8; |HAZ Relleno;
          nNume = -nUni; aAlfa = nNume; aTipo = "N"; nLon = 8; |HAZ Relleno;
          aAlfa = "0"; aTipo = "N"; nLon = 8; |HAZ Relleno;
          nNume = -nUni; aAlfa = nNume; aTipo = "N"; nLon = 8; |HAZ Relleno;
     |FINSI;
     |SI #19#3 = "ENVAS";
          nPvp = #19#19;
     |SINO;
          nPvp = #19#18;
     |FINSI;
     aAlfa = nPvp; aTipo = "N"; nLon = 9; nDec = 2; |HAZ Relleno;

     nReg = nReg + 1;
     aDato = aDato + aFinReg;
     |XGRABA nHandle, aDato;
|FPRC;

|PROCESO DIDP_DIDD_DICC;
     |SI #71#63 = -1;
          |ACABA;
     |FINSI;

     |DDEFECTO #19;
     #19#0 = #71#2;
     |LEE 000#19=;

     |SI #19#2 ! #0#7; |Y #19#2 ! #0#8; |ACABA; |FINSI;

     aCondi = "N";
     nUni = #71#5;
     |HAZ ImpDto;
     |SI #71#63 > 0;
          |SALVA_FICHA #71;
          #71#1 = #71#63;
          |LEE 000#71=;
          |SI FSalida = 0;
               |SI aCondi = "S"; nUni = nUni + #71#5; |FINSI;
          |FINSI;
          |REPON_FICHA #71;
     |FINSI;
     |HAZ DIDP;
     |SI aCondi = "S"; |HAZ DIDD; |FINSI;

     aCondi = "N"; |HAZ DtoDis;
     |SI aCondi = "S";
          #4#0 = #71#2;
          #4#1 = #10#3;
          |LEE 000#4=;
          |SI FSalida ! 0;
               |GRABA 020#4n;
               |HAZ DICC;
          |FINSI;
     |FINSI;

     nHay = 1;
|FPRC;


|PROCESO DICP; ||Lon=67
     |SI nHay = 0; |ACABA; |FINSI;

     nAlb = nAlb + 1;

     |DDEFECTO #24;
     #24#0 = #10#3;
     |LEE 000#24=;

     aDato = "DICP ";
     aAlfa = #10#0; aTipo = "N"; nLon = 10; |HAZ Relleno;
     aAlfa = #24#189; aTipo = "N"; nLon = 4; |HAZ Relleno;

     aAlfa = #10#3; aTipo = "N"; nLon = 15; |HAZ Relleno;
     |HAZ Laborable; aDato = aDato + aAlfa;
     aAlfa = #10#1; aTipo = "F"; nLon = 8; |HAZ Relleno;
     |SI #10#8 = "CR"; |O #10#8 = "CO";
          aAlfa = #10#8; aTipo = "A"; nLon = 2; |HAZ Relleno;
     |SINO;
          aAlfa = "CR"; aTipo = "A"; nLon = 2; |HAZ Relleno;
     |FINSI;
     aAlfa = ""; aTipo = "A"; nLon = 10; |HAZ Relleno;
     aAlfa = "EUR"; aTipo = "A"; nLon = 5; |HAZ Relleno;

     nReg = nReg + 1;
     aDato = aDato + aFinReg;
     |XGRABA nHandle, aDato;
|FPRC;

|PROCESO DICP_DIDP_DIDD_DICC;
     nHay = 0;
|FPRC;

|DEFBUCLE DICP_DIDP_DIDD_DICC;
     #10#7;
     ;
     #0#2, #0#0, 000001;
     #0#3, #0#1, 999999;
     ;
     NULL, DICP_DIDP_DIDD_DICC, DIDP_DIDD_DICC, DICP;
|FIN;

|PROCESO DIMP; ||Long=64
     |DDEFECTO #19;
     #19#0 = #4#0;
     |LEE 000#19=;

     aDato = "DIMP ";
     aAlfa = "0000000" + #19#0; |QBF aAlfa;
     aAlfa = aAlfa % -108;
     aTipo = "A"; nLon = 8; |HAZ Relleno;

     aAlfa = #19#2; aTipo = "A"; nLon = 3; |HAZ Relleno;
     aAlfa = ""; aTipo = "A"; nLon = 6; |HAZ Relleno;
     aAlfa = ""; aTipo = "A"; nLon = 5; |HAZ Relleno;
     |SI #19#3 = "ENVAS";
          aAlfa = "ENVA";
     |SINO;
          |SI #19#3 = "PROMO";
               aAlfa = "PROM";
          |SINO;
               aAlfa = "PTER";
          |FINSI;
     |FINSI;
     aDato = aDato + aAlfa;
     aAlfa = #19#1; aTipo = "A"; nLon = 25; |HAZ Relleno;
     aAlfa = #19#110; aTipo = "N"; nLon = 8; |HAZ Relleno;

     nReg = nReg + 1;
     aDato = aDato + aFinReg;
     |XGRABA nHandle, aDato;
|FPRC;

|DEFBUCLE DIMP;
     #4#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, DIMP;
|FIN;

|PROCESO DIMC; ||Long=357
     |DDEFECTO #24;
     #24#0 = #3#0;
     |LEE 000#24=;

     aDato = "DIMC ";
     aAlfa = #24#0 + "R0I" ; aTipo = "N"; nLon = 15; |HAZ Relleno;
     aAlfa = #24#189; aTipo = "N"; nLon = 4; |HAZ Relleno;
     aAlfa = #24#2; aTipo = "A"; nLon = 50; |HAZ Relleno;
     aAlfa = #24#1; aTipo = "A"; nLon = 70; |HAZ Relleno;
     aAlfa = #24#5; aTipo = "A"; nLon = 35; |HAZ Relleno;
     aAlfa = #24#15; aTipo = "A"; nLon = 12; |HAZ Relleno;
     aAlfa = "D"; aTipo = "A"; nLon = 1; |HAZ Relleno;
     aAlfa = ""; aTipo = "A"; nLon = 2; |HAZ Relleno;
     |SI #3#2 = "CR"; |O #3#2 = "CO";
          aAlfa = #3#2; aTipo = "A"; nLon = 2; |HAZ Relleno;
     |SINO;
          aAlfa = "CR"; aTipo = "A"; nLon = 2; |HAZ Relleno;
     |FINSI;
     aAlfa = #24#164; aTipo = "A"; nLon = 2; |HAZ Relleno;
     aAlfa = ""; aTipo = "A"; nLon = 6; |HAZ Relleno;
     aAlfa = ""; aTipo = "A"; nLon = 8; |HAZ Relleno;
     aAlfa = #3#1; aTipo = "A"; nLon = 1; |HAZ Relleno;

     |XGRABA nHandle, aDato;
     aDato = "";

     aAlfa = "SNNNNNN"; aTipo = "A"; nLon = 7; |HAZ Relleno;
     aAlfa = ""; aTipo = "A"; nLon = 15; |HAZ Relleno;
     aAlfa = ""; aTipo = "A"; nLon = 2; |HAZ Relleno;
     aAlfa = ""; aTipo = "A"; nLon = 5; |HAZ Relleno;
     aAlfa = ""; aTipo = "A"; nLon = 1; |HAZ Relleno;
     aAlfa = #24#197; aTipo = "A"; nLon = 35; |HAZ Relleno;
     aAlfa = #24#6; aTipo = "A"; nLon = 20; |HAZ Relleno;
     aAlfa = #24#7; aTipo = "A"; nLon = 12; |HAZ Relleno;
     aAlfa = #24#180; aTipo = "A"; nLon = 5; |HAZ Relleno;
     aAlfa = #24#17; aTipo = "A"; nLon = 12; |HAZ Relleno;
     aAlfa = #24#18; aTipo = "A"; nLon = 12; |HAZ Relleno;
     aAlfa = #24#163; aTipo = "A"; nLon = 8; |HAZ Relleno;
     aAlfa = ""; aTipo = "A"; nLon = 10; |HAZ Relleno;

     nReg = nReg + 1;
     aDato = aDato + aFinReg;
     |XGRABA nHandle, aDato;
|FPRC;

|DEFBUCLE DIMC;
     #3#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, DIMC;
|FIN;

|PROCESO agifa010Fin;
     |SI nHay = 0; |ACABA; |FINSI;

     #3#0 = #10#3;
     |LEE 000#3=;
     |SI FSalida ! 0;
          #3#1 = aCondi;
          #3#2 = #10#8;
          |GRABA 020#3n;
     |SINO;
          #3#1 = aCondi;
          #3#2 = #10#8;
          |GRABA 020#3a;
     |FINSI;
|FPRC;

|PROCESO agifa071Cli;
     |SI #71#63 = -1;
          |ACABA;
     |FINSI;

     |DDEFECTO #19;
     #19#0 = #71#2;
     |LEE 000#19=;

     |SI #19#2 ! #0#7; |Y #19#2 ! #0#8; |ACABA; |FINSI;

     nHay = 1;

     |DDEFECTO #4;
     #4#0 = #71#2;
     |LEE 000#4=;
     |SI FSalida ! 0; |GRABA 020#4n; |FINSI;

     |HAZ DtoDis;
|FPRC;

|PROCESO agifa010;
     aCondi = "N";
     nHay = 0;
|FPRC;

|DEFBUCLE agifa010;
     #10#7;
     ;
     #0#2, #0#0, 000001;
     #0#3, #0#1, 999999;
     ;
     NULL, agifa010, agifa071Cli, agifa010Fin;
|FIN;

|PROCESO agifa024;
     #3#0 = #24#0;
     |LEE 000#3=;
     |SI FSalida ! 0;
          #3#1 = "N";
          |GRABA 020#3n;
     |FINSI;
|FPRC;

|DEFBUCLE agifa024;
     #24#1;
     ;
     #0#5;
     #0#6;
     ;
     NULL, agifa024;
|FIN;

|PROCESO CT; ||Long=26
     aDato = "CT   ";
     aAlfa = (#0#9 % 704) + (#0#9 % 402) + (#0#9 % 102); aDato = aDato + aAlfa;
     aDato = aDato + #0#10;
     aDato = aDato + "99";
     aDato = aDato + #0#13;

     nReg = nReg + 1;
     aDato = aDato + aFinReg;
     |XGRABA nHandle, aDato;
|FPRC;

|PROCESO FT;   ||Long=19
     nReg = nReg + 1;
     aDato = "FT   ";
     aAlfa = nReg; aTipo = "N"; nLon = 7; |HAZ Relleno;
     aAlfa = nAlb; aTipo = "N"; nLon = 7; |HAZ Relleno;

     aDato = aDato + aFinReg;
     |XGRABA nHandle, aDato;
|FPRC;

|PROCESO Tipo3; |TIPO 3;
     aFinReg = &13;
     aFinReg = aFinReg + & 10;

     |HAZ CreaTempo; |NOME_DAT #3 Tempo; aTmp3 = Tempo; |DELINDEX #3;
     |HAZ CreaTempo; |NOME_DAT #4 Tempo; aTmp4 = Tempo; |DELINDEX #4;

     aAlfa = #0#11; |QBF aAlfa;
     |XABRE "BCW", aAlfa, nHandle;
     |SI FSalida ! 0;
          |MENAV "0000Error al crear el fichero...";
     |SINO;
          |ABRE #3;
          |ABRE #4;
          |SI #0#4 = "S";
               |BUCLE agifa024;
          |FINSI;
          |ABRE #134;
          |ABRE #19;
          |BUCLE agifa010;
          |CIERRA #19;
          |CIERRA #134;
          |CIERRA #3;
          |CIERRA #4;

          |HAZ CT;
          |ABRE #24;
          |BUCLE DIMC;

          |ABRE #134;
          |ABRE #19;
          |BUCLE DIMP;
          |DELINDEX #4;
          |ABRE #4;
          |BUCLE DICP_DIDP_DIDD_DICC;
          |CIERRA #4;
          |CIERRA #24;
          |CIERRA #19;
          |CIERRA #134;

          |HAZ FT;

          |XCIERRA nHandle;
     |FINSI;

     Tempo = aTmp3; |HAZ BoraTempo; |DELINDEX #3;
     Tempo = aTmp4; |HAZ BoraTempo; |DELINDEX #4;
|FPRC;

|PROCESO Cliente; |TIPO 0;
     |SI #0#4 = "S";
          |C_M #0#5, 1, "N";
          |C_M #0#6, 1, "N";
          #0#5 = "000000"; |PINTA #0#5;
          #0#6 = "999999"; |PINTA #0#6;
     |SINO;
          |C_M #0#5, 1, "S";
          |C_M #0#6, 1, "S";
     |FINSI;
|FPRC;

|PROCESO Browser; |TIPO 0;
     |SI FSalida ! 10; |ACABA; |FINSI;

     aRuta = "F*.*";

     |BROWSE aRuta;

     aRuta = aRuta % 2; |QBF aRuta;
     |SI aRuta = "F"; aRuta = ""; |FINSI;

     |QBF aRuta;
     |SI aRuta = "";
          |ERROR;
     |SINO;
          #0#11 = aRuta;
          |PINTA #0#11;
     |FINSI;
|FPRC;

|PROCESO Boton1;
     |PTEC 824;
|FPRC;

|PROGRAMA;
     |CLS;
     |CONTROL_SIMPLE 0, "BOTON,Fichero:", 2118, 2125, Boton1;
     nBoton1 = FSalida;
     |ABRE #0;
     |LEE 101#0p;
     |SI FSalida ! 0; |GRABA 020#0b; |FINSI;
     |PINPA #0#0;
     |PINDA #0#0;
     |ENDATOS #1#0;
     |SI FSalida = 0;
          |GRABA 020#0a;
     |FINSI;
     |CIERRA #0;
     |FIN_CONTROL_WINDOWS nBoton1;
     |PULSATECLA;
|FPRO;
