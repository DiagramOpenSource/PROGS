|FICHEROS;
     ortsy005 #0;
     ortsm001 #1;
     dsm00003 #3;
     ortsw004 #4;   ||Tmp
     ortsm006 #6;
     ortsm008 #8;
     ortsm013 #13;
     ortsm017 #17;
     ortsm018 #18;
     agifa019 #19;
     agifa073 #73;
     agifa104 #104;
     ortsm019 #119;
|FIN;

|VARIABLES;
     &eaCodBar = "";

     aCodBarras = "";

     nSw = 0;
     nOrden = 0;
     &Tempo = "";
     &eaCombi = "";
     &eaTira = "";
     &enUniPed = 0;
     &enUni = 0;
     aAlfa = "";
     nPrime = 0;
     i = 0;
     nPdte = 0;
     fFecha = @;
     f = @;
|FIN;

|PROCESO ObtenCodBarras;
     aCodBarras = #17#4;
     aCodBarras = aCodBarras - "-" - "-" - "-" - "-" - "-" - "-" - "-";
     aCodBarras = aCodBarras - "-" - "-" - "-" - "-" - "-" - "-" - "-";
     eaCodBar = aCodBarras;

     aAlfa = eaTira % 102;
     |QBF eaCodBar;
     eaCodBar = eaCodBar + aAlfa;

     aAlfa = #17#20; |QBF aAlfa;
     |SI #119#2 = "S"; |Y aAlfa ! "";
          |SI #17#8 = "N";
               eaCodBar = #17#20;
          |SINO;
               aAlfa = #18#7;
               |QBF aAlfa;
               |SI aAlfa = "";
                    eaCodBar = #17#20;
               |SINO;
                    eaCodBar = #18#7;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO CombinaUni;
     |SI nSw = 0;
          #4#8 = #18#4;
          |GRABA 000#4n;
     |FINSI;
     |SI nSw = 1;
          |SI #4#8 = 0;
               enUni = #18#4;
               eaCombi = #18#5;
               eaTira = #18#6;
               |HAZ ObtenCodBarras;
               |PARA enUniPed = 1; |SI enUniPed [ nPdte; |HACIENDO enUniPed = enUniPed + 1;
                    |PRINT;
               |SIGUE;
          |SINO;
               |SI #4#8 = #18#4;
                    enUni = #18#4;
                    eaCombi = #18#5;
                    eaTira = #18#6;
                    |HAZ ObtenCodBarras;
                    |PARA enUniPed = 1; |SI enUniPed [ nPdte; |HACIENDO enUniPed = enUniPed + 1;
                         |PRINT;
                    |SIGUE;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE CombinaUni;
     #18#1;
     ;
     #17#0, #17#1, #17#2, #17#3, 001;
     #17#0, #17#1, #17#2, #17#3, 999;
     ;
     NULL, CombinaUni;
|FIN;

|PROCESO Combina;
     #19#0 = #17#4;
     |LEE 000#19=;

     |SI nSw = 0;
          |SI #19#0 < #0#23; |O #19#0 > #0#24; |ACABA; |FINSI;
          |SI #19#127 < #0#25; |O #19#127 > #0#26; |ACABA; |FINSI;
          |SI #19#2 < #0#27; |O #19#2 > #0#28; |ACABA; |FINSI;
          |SI #19#3 < #0#12; |O #19#3 > #0#13; |ACABA; |FINSI;
          |SI #19#125 < #0#29; |O #19#125 > #0#30; |ACABA; |FINSI;

          |SI nOrden = 2;
               #4#0 = 2;
               #4#1 = "";
               #4#2 = "";
               #4#3 = #17#0;
               #4#4 = #17#1;
               #4#5 = #17#2;
               #4#6 = #17#4;
               #4#7 = #17#3;
               #4#8 = 0;
               |GRABA 000#4n;
               |ACABA;
          |FINSI;
          |SI #19#127 = 0;
               #4#0 = 0;
               #4#1 = #17#4;
               #4#2 = #17#6 + #17#11;
               #4#3 = #17#0;
               #4#4 = #17#1;
               #4#5 = #17#2;
               #4#6 = "";
               #4#7 = #17#3;
               #4#8 = 0;
               |SI #17#8 = "N";
                    |GRABA 000#4n;
               |SINO;
                    |BUCLE CombinaUni;
               |FINSI;
          |FINSI;
          |SI #19#127 = 1;
               #4#0 = 1;
               #4#1 = #73#2;
               #4#2 = "";
               #4#3 = #17#0;
               #4#4 = #17#1;
               #4#5 = #17#2;
               #4#6 = #17#4;
               #4#7 = #17#3;
               #4#8 = 0;
               |GRABA 000#4n;
          |FINSI;
     |FINSI;

     |SI nSw = 1;
          #104#25 = #4#3;
          #104#0 = #4#4;
          |LEE 000#104=;

          #73#28 = #4#3;
          #73#0 = #4#4;
          #73#1 = #4#5;
          |LEE 000#73=;

          nPdte = #73#5 - #73#43;
          |SI nPdte [ 0; |ACABA; |FINSI;

          #17#0 = #4#3;
          #17#1 = #4#4;
          #17#2 = #4#5;
          #17#3 = #4#7;
          |LEE 000#17=;

          |SI #17#7 = 1;
               eaCombi = #17#6;
               eaTira = #17#11;
               enUni = 1;
               |HAZ ObtenCodBarras;
               |PARA enUniPed = 1; |SI enUniPed [ nPdte; |HACIENDO enUniPed = enUniPed + 1;
                    |PRINT;
               |SIGUE;
          |FINSI;
          |SI #17#7 > 1;
               |SI #17#8 = "N";
                    eaCombi = #17#6;
                    eaTira = #17#11;
                    |HAZ ObtenCodBarras;
                    |PARA enUniPed = 1; |SI enUniPed [ nPdte; |HACIENDO enUniPed = enUniPed + 1;
                         |PARA i = 1; |SI i [ #17#7; |HACIENDO i = i + 1;
                              enUni = i;
                              |PRINT;
                         |SIGUE;
                    |SIGUE;
               |SINO;
                    |BUCLE CombinaUni;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE Temporal;
     #4#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Combina;
|FIN;

|DEFBUCLE Combina;
     #17#1;
     ;
     #73#28, #73#0, #73#1, 001;
     #73#28, #73#0, #73#1, 999;
     ;
     NULL, Combina;
|FIN;

|PROCESO LinPedi;
     #119#0 = #73#2;
     |LEE 000#119=;
     |SI FSalida ! 0; |DDEFECTO #119; |FINSI;

     #8#0 = #73#28;
     #8#1 = #73#0;
     #8#2 = #73#1;
     |LEE 000#8=;
     |SI FSalida ! 0; |DDEFECTO #8; |FINSI;

     nPdte = #73#5 - #73#43;
     |SI nPdte [ 0; |ACABA; |FINSI;

     |SI #73#2 < #0#15; |O #73#2 > #0#16; |ACABA; |FINSI;

     #19#0 = #73#2;
     |LEE 000#19=;
     |SI FSalida ! 0; |DDEFECTO #19; |FINSI;

     |SI #19#127 < #0#17; |O #19#127 > #0#18; |ACABA; |FINSI;
     |SI #19#2 < #0#19; |O #19#2 > #0#20; |ACABA; |FINSI;
     |SI #19#125 < #0#21; |O #19#125 > #0#22; |ACABA; |FINSI;

     nOrden = #19#127;
     |PARA enUniPed = 1; |SI enUniPed [ nPdte; |HACIENDO enUniPed = enUniPed + 1;
          nSw = 0;
          |ABRE #4;
          |BUCLE Combina;
          |CIERRA #4;
     |SIGUE;
|FPRC;

|PROCESO CabPedi;
     #3#0 = #104#4;
     #3#1 = #104#57;
     |LEE 000#3=;
     |SI FSalida ! 0; |DDEFECTO #3; |FINSI;
     |SI #3#11 < #0#6; |O #3#11 > #0#7;
          |ERROR; |ACABA;
     |FINSI;

     |HAZ ContaEti;
     |SI #13#7 = "S"; |Y #0#31 = "N"; |ERROR; |ACABA; |FINSI;
     |SI #13#7 = "N"; |Y #0#31 = "S"; |ERROR; |ACABA; |FINSI;
     |ABRE #13;
     |SELECT #2#13;
     #13#1 = #104#25;
     #13#2 = #104#0;
     |LEE 000#13=;
     |SI FSalida = 0;
          #13#7 = "S";
          |GRABA 020#13a;
     |FINSI;
     |CIERRA #13;
|FPRC;

|DEFBUCLE Pedido;
     #104#1;
     4, 1, 2;
     #0#0, #0#2, #0#4, #0#8, #0#10;
     #0#1, #0#3, #0#5, #0#9, #0#11;
     ;
     NULL, CabPedi, LinPedi;
|FIN;

|PROCESO ContaEti;
     |SI #0#31 = "S";         || ¨esto vale para algo?
          |ABRE #13;
          |SELECT #2#13;
          #13#1 = #104#25;
          #13#2 = #104#0;
          |LEE 000#13=;
          |SI FSalida = 0; |CIERRA #13; |ACABA; |FINSI;
          |CIERRA #13;
     |FINSI;

     fFecha = "01.01.0000";

     |ABRE #13;
     |SELECT #1#13;
     #13#0 = fFecha;
     #13#1 = #104#25;
     #13#2 = #104#0;
     |LEE 000#13=;
     |SI FSalida ! 0;
          |DDEFECTO #13;
          #13#0 = fFecha;
          #13#1 = "";
          #13#2 = 0;
          |LEE 101#13=;
          |SI FSalida ! 0; |GRABA 020#13b; |FINSI;
          #13#3 = #13#3 + 1;
          |SI #13#3 > 999;
               #13#3 = 1;
          |FINSI;
          |GRABA 020#13a;

          #13#0 = fFecha;
          #13#1 = #104#25;
          #13#2 = #104#0;

          #13#7 = "N";

          fFecha = ~;
          f = fFecha % A1;
          aAlfa = f % 1102;
          aAlfa = aAlfa > "";
          |SI aAlfa = "LU"; #13#6 = "P"; |FINSI;
          |SI aAlfa = "MA"; #13#6 = "R"; |FINSI;
          |SI aAlfa = "MI"; #13#6 = "V"; |FINSI;
          |SI aAlfa = "JU"; #13#6 = "Z"; |FINSI;
          |SI aAlfa = "VI"; #13#6 = "A"; |FINSI;
          |SI aAlfa = "SA"; #13#6 = "A"; |FINSI;
          |SI aAlfa = "DO"; #13#6 = "A"; |FINSI;
          |GRABA 020#13n;
     |FINSI;
     |CIERRA #13;
|FPRC;

|PROCESO Tipo3; |TIPO 3;
     |ABRE #1;
     #1#0 = "";
     |LEE 000#1=;
     |CIERRA #1;

     |HAZ CreaTempo;
     |NOME_DAT #4 Tempo; |DELINDEX #4;

     Impresora = #1#4; |QBF Impresora;
     |IMPRE -1;
     |SI FSalida = 0;
          aAlfa = #0#14; |QBF aAlfa;
          |INFOR aAlfa;
          |SI FSalida = 0;
               |ABRE #3;
               |ABRE #8;
               |ABRE #6;
               |ABRE #19;
               |ABRE #119;
               |BUCLE Pedido;
               |CIERRA #119;
               |CIERRA #19;
               |CIERRA #6;
               |CIERRA #8;
               |CIERRA #3;

               nSw = 1;
               |ABRE #104;
               |ABRE #73;
               |ABRE #17;
               |ABRE #19;
               |BUCLE Temporal;
               |CIERRA #19;
               |CIERRA #17;
               |CIERRA #73;
               |CIERRA #104;

               |PIEINF;
               |FININF;
          |SINO;
               aAlfa = "0000Error en informe:" + aAlfa;
               |MENAV aAlfa;
          |FINSI;
          |FINIMP;
     |FINSI;

     |HAZ BoraTempo; |DELINDEX #4;
|FPRC;
