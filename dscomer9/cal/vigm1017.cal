          || TotalLinVig80

|FICHEROS;
     agifa077 #77;
     vigm0017 #80;
     agifa019 #19;
|FIN;

|VARIABLES;
     nImpDiv = 0;
     &nDeci_IVAC = 0;
     &nDeci_BaseMx = 0;
     &nDeci_Div = 0;
     &nDeci_IVACDiv  = 0;

     nPPort1       = 0;
     nPPort2       = 0;

     aAlfa = "";
     nPreTon = 0;
|FIN;

|PROCESO TotalLinVig80;
     |ABRE #19;
     #19#0 = #80#2;
     |LEE 020#19=;
     |CIERRA #19;

     nPreTon = 1;
     |HAZ EsVigor;
     |SI FSalida = 0;
          aAlfa = #19#110; |QBF aAlfa;   || Alfanumerico1
          aAlfa = aAlfa > "";
          |SI aAlfa = "S"; nPreTon = 1000; |FINSI;
     |FINSI;

     #80#44 = #80#5 * #19#208; ||Punto Verde

     |HAZ EsAlbadis; ||Para este modulo se factura con las unidades 2
     |SI FSalida = 0; #agifa019#196 = 2; |FINSI;

     |SI #77#58 = "D";                      || Si mon. de trabajo es divisa ...
          #80#6    = #80#30 / #77#57 * #77#62; || Recalculo precio en mon. base
          #80#32   = #80#6;                  || Precio visual, en mon. base
          nPPort1 = (#80#42 / #77#57 * #77#62) ! nDeci_Div;
          nPPort2 = #80#42;
     |SINO;                               || Si mon. de trabajo es mon. base
          #80#30   = #80#6 / #77#62 * #77#57; || Recalculo precio en divisa
          #80#32   = #80#30;                || Precio visual, en divisa
          nPPort1 = #80#42;
          nPPort2 = (#80#42 / #77#62 * #77#57) ! nDeci_Div;
     |FINSI;

     |SI #19#196 = 2;
          #80#7    = #80#36 * #80#6 / nPreTon;
          nImpDiv = (#80#36 * #80#30 / nPreTon) ! nDeci_IVACDiv;
     |SINO;
          #80#7    = #80#5  * #80#6 / nPreTon;
          nImpDiv = (#80#5  * #80#30 / nPreTon) ! nDeci_IVACDiv;
     |FINSI;

     #80#9  = (#80#7    < #80#8) < #80#26;
     #80#31 = (nImpDiv < #80#8) < #80#26;

     |SI #19#196 = 2;
          #80#9  = #80#9  + (#80#36 * nPPort1);  || Portes Linea
          #80#31 = #80#31 + (#80#36 * nPPort2);  || Portes Linea
     |SINO;
          #80#9  = #80#9  + (#80#5  * nPPort1);  || Portes Linea
          #80#31 = #80#31 + (#80#5  * nPPort2);  || Portes Linea
     |FINSI;

     |SI #77#58 = "D";     || Si mon. de trabajo es divisa ...
          #80#33 = #80#9;   || Importe visual, en mon. base
     |SINO;               || Si mon. de trabajo es mon. base ...
          #80#33 = #80#31;  || Importe visual, en divisa
     |FINSI;
|FPRC;
