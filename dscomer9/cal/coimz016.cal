|FICHEROS;
     coimz016 #0;
     coimw011 #11; ||Tmp
     coima018 #18;
     coima019 #19;
     coima020 #20;
     coima021 #21;
     coima020@;
|FIN;

|VARIABLES;
    aDuplica = "N";
     &Tempo = "";
     {-1}Menu = "";
     Menu1 = "2400";
     Menu2 = "1";
     Menu3 = "Opciones:";
     Menu4 = "RTDC";
     Menu5 = " Repasar ";
     Menu6 = " Trasladar ";
     Menu7 = " Duplicar ";
     Menu8 = " Cancelar ";
     nReg = 0;
     nReg1 = 0;
     nReg2 = 0;
     nCat = 0;
     nCol = 0;
     nPag = 0;
     aAlfa = "";
     nDReg = 0;
     nHReg = 0;
|FIN;

|PROCESO ActLin;
     |SI aDuplica = "N";
          |BORRA 020#21a;
     |FINSI;
     |LIBERA #21;

     #21#0 = #11#7;
     #21#1 = #11#8;
     #21#2 = #11#9;
     #21#3 = #11#10;
     |GRABA 000#21n;
|FPRC;

|PROCESO Actualiza;
     #20#0 = #11#0;
     #20#1 = #11#1;
     #20#2 = #11#2;
     #20#3 = #11#3;
     |LEE 121#20=;
     |SI FSalida = 0;
          |BUCLELIN 0 ActLin #20;
          |SI aDuplica = "N";
               |BORRA 020#20a;
          |FINSI;
          |LIBERA #20;

          #20#0 = #11#7;
          #20#1 = #11#8;
          #20#2 = #11#9;
          #20#3 = #11#10;
          |GRABA 000#20n;
     |FINSI;
|FPRC;

|DEFBUCLE Actualiza;
     #11#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Actualiza;
|FIN;

|PROCESO Registro;
     |SALVA_FICHA #20;
     |SALVA_DATOS #11;

     #20#0 = #11#7;
     #20#1 = #11#8;
     #20#2 = #11#9;
     #20#3 = 999;
     |LEE 000#20];
     |SI FSalida = 0;
          |LEE 000#20a;
     |SINO;
          |LEE 000#20u;
     |FINSI;
     |SI FSalida = 0; |Y #20#0 = #11#7; |Y #20#1 = #11#8; |Y #20#2 = #11#9;
          nReg1 = #20#3 + 1;
     |SINO;
          nReg1 = 1;
     |FINSI;

     nCat = #11#7;
     nCol = #11#8;
     nPag = #11#9;
     |SELECT #2#11;
     #11#7 = nCat;
     #11#8 = nCol;
     #11#9 = nPag;
     #11#10 = 999;
     |LEE 000#11];
     |SI FSalida = 0;
          |LEE 000#11a;
     |SINO;
          |LEE 000#11u;
     |FINSI;
     |SI FSalida = 0; |Y #11#7 = nCat; |Y #11#8 = nCol; |Y #11#9 = nPag;
          nReg2 = #11#10 + 1;
     |SINO;
          nReg2 = 1;
     |FINSI;
     |SELECT #1#11;

     |SI nReg2 > nReg1;
          nReg = nReg2;
     |SINO;
          nReg = nReg1;
     |FINSI;

     |REPON_DATOS #11;
     |REPON_FICHA #20;
|FPRC;

|PROCESO Paginas;
     #18#0 = #20#0;
     |LEE 000#18=;

     #19#0 = #20#0;
     #19#1 = #20#1;
     |LEE 000#19=;

     #11#0 = #20#0;
     #11#1 = #20#1;
     #11#2 = #20#2;
     #11#3 = #20#3;
     #11#4 = #18#1;
     #11#5 = #19#2;
     #11#6 = #20#4;

     #18#0 = #0#7;
     |LEE 000#18=;

     #19#0 = #0#7;
     #19#1 = #0#8;
     |LEE 000#19=;

     #11#7 = #0#7;
     #11#8 = #0#8;
     #11#9 = #0#9;
     #11#11 = #18#1;
     #11#12 = #19#2;

     |HAZ Registro;
     #11#10 = nReg;

     |GRABA 020#11n;
|FPRC;

|DEFBUCLE Paginas;
     #20#1;
     ;
     #0#0, #0#1, #0#2, nDReg;
     #0#0, #0#1, #0#2, nHReg;
     ;
     NULL, Paginas;
|FIN;

|PROCESO Min20;
     #20#0 = #0#7;
     #20#1 = #0#8;
     #20#2 = 0;
     #20#3 = 0;
|FPRC;

|PROCESO Max20;
     #20#0 = #0#7;
     #20#1 = #0#8;
     #20#2 = 999;
     #20#3 = 999;
|FPRC;

|PROCESO Llena20;
     |SALVA_DATOS #20;
     |REPON_DATOS #coima020@;
     |GRABA 020#coima020@.n;
|FPRC;

|DEFBUCLE Llena20;
     #20#1;
     ;
     nCat, nCol, 000, 000;
     nCat, nCol, 999, 999;
     ;
     NULL, Llena20;
|FIN;

|PROCESO Min19a;
     #19#0 = #0#7;
     #19#1 = 0;
|FPRC;

|PROCESO Max19a;
     #19#0 = #0#7;
     #19#1 = 999;
|FPRC;

|PROCESO Coleccion66; |TIPO 66;
     |ABRE #19;
     #19#0 = #0#7;
     #19#1 = #0#8;
     |LEE 000#19];
     |CONSULTA_F_CLAVE #1#19, Min19a, Max19a;
     |SI FSalida = 0;
          #0#8 = #19#1; |PINTA #0#8;
     |SINO;
          |ERROR;
     |FINSI;
     |CIERRA #19;
|FPRC;

|PROCESO Pagina66; |TIPO 66;
     |DDEF aAlfa;
     aAlfa = aAlfa + "coima020";
     |CARGA_DEF aAlfa, coima020@;
     |SI FSalida = 0;
          |HAZ CreaTempo; |NOME_DAT #coima020@#Tempo#; |DELINDEX #coima020@;
          |ABRE #coima020@;
          nCat = #0#7;
          nCol = #0#8;
          |BUCLE Llena20;
          |LEE 000#coima020@.p;
          |CONSULTA_CLAVE #1#coima020@;
          |SI FSalida = 0;
               #0#9 = #coima020@#2; |PINTA #0#9;
          |SINO;
               |ERROR;
          |FINSI;
          |CIERRA #coima020@;
          |HAZ BoraTempo; |DELINDEX #coima020@;
          |DESCARGA_DEF #coima020@;
     |FINSI;
/*
     |ABRE #20;
     #20#0 = #0#7;
     #20#1 = #0#8;
     #20#2 = #0#9;
     #20#3 = 0;
     |LEE 000#20];
     |CONSULTA_F_CLAVE #1#20, Min20, Max20;       *** FALLA ***
     |SI FSalida = 0;
          #0#9 = #20#2; |PINTA #0#9;
     |SINO;
          |ERROR;
     |FINSI;
     |CIERRA #20;
*/
|FPRC;

|PROCESO Pagina0; |TIPO 0;
     |SI FSalida = 2; |ACABA; |FINSI;

     |SI #0#3 = 0; |ACABA; |FINSI;

     |ABRE #20;
     #20#0 = #0#7;
     #20#1 = #0#8;
     #20#2 = #0#9;
     #20#3 = 0;
     |LEE 000#20];
     |SI FSalida ! 0; |O #20#0 ! #0#7; |O #20#1 ! #0#8; |O #20#2 ! #0#9;
          aAlfa = "0000NNo existe pagina." + &13 + "¿Desea crearla?";
          |CONFI aAlfa;
          |SI FSalida = 0;
               #20#0 = #0#0;
               #20#1 = #0#1;
               #20#2 = #0#2;
               #20#3 = #0#3;
               |LEE 020#20=;
               |SI FSalida = 0;
                    #20#0 = #0#7;
                    #20#1 = #0#8;
                    #20#2 = #0#9;
                    #20#3 = 1;
                    |GRABA 020#20n;
/*
                    |ABRE #21;
                    #21#0 = #0#0;
                    #21#1 = #0#1
                    #21#2 = #0#2;
                    #21#3 = #0#3;
                    #21#4 = 1;
                    |LEE 000#21];
                    |PARA; |SI FSalida = 0; |Y #21#0 = #0#0;
                              |Y #21#1 = #0#1; |Y #21#2 = #0#2;
                              |Y #21#3 = #0#3;
                              |HACIENDO;
                         |SALVA_FICHA #21;
                         #21#0 = #0#7;
                         #21#1 = #0#8;
                         #21#2 = #0#9;
                         #21#3 = 1;
                         |GRABA 020#21n;
                         |REPON_FICHA #21;
                         |LEE 000#21s;
                    |SIGUE;
                    |CIERRA #21;
*/
               |SINO;
                    |ERROR;
               |FINSI;
          |SINO;
               |ERROR;
          |FINSI;
     |FINSI;
     |CIERRA #20;
|FPRC;

|PROCESO Min19;
     #19#0 = #0#0;
     #19#1 = 0;
|FPRC;

|PROCESO Max19;
     #19#0 = #0#0;
     #19#1 = 999;
|FPRC;

|PROCESO Min20a;
     #20#0 = #0#0;
     #20#1 = #0#1;
     #20#2 = 0;
     #20#3 = 0;
|FPRC;

|PROCESO Max20a;
     #20#0 = #0#0;
     #20#1 = #0#1;
     #20#2 = 999;
     #20#3 = 999;
|FPRC;

|PROCESO Min20b;
     #20#0 = #0#0;
     #20#1 = #0#1;
     #20#2 = #0#2;
     #20#3 = 0;
|FPRC;

|PROCESO Max20b;
     #20#0 = #0#0;
     #20#1 = #0#1;
     #20#2 = #0#2;
     #20#3 = 999;
|FPRC;


|PROCESO Consulta; |TIPO 66;
     |SI Campo = 0;
          |ABRE #18;
          #18#0 = #0#0;
          |LEE 000#18];
          |CONSULTA_CLAVE #1#18;
          |SI FSalida = 0;
               #0#0 = #18#0; |PINTA #0#0;
          |SINO;
               |ERROR;
          |FINSI;
          |CIERRA #18;
     |FINSI;
     |SI Campo = 1;
          |ABRE #19;
          #19#0 = #0#0;
          #19#1 = #0#1;
          |LEE 000#19];
          |CONSULTA_F_CLAVE #1#19, Min19, Max19;
          |SI FSalida = 0;
               #0#1 = #19#1; |PINTA #0#1;
          |SINO;
               |ERROR;
          |FINSI;
          |CIERRA #19;
     |FINSI;
     |SI Campo = 2;
          |DDEF aAlfa;
          aAlfa = aAlfa + "coima020";
          |CARGA_DEF aAlfa, coima020@;
          |SI FSalida = 0;
               |HAZ CreaTempo; |NOME_DAT #coima020@#Tempo#; |DELINDEX #coima020@;
               |ABRE #coima020@;
               nCat = #0#0;
               nCol = #0#1;
               |BUCLE Llena20;
               |LEE 000#coima020@.p;
               |CONSULTA_CLAVE #1#coima020@;
               |SI FSalida = 0;
                    #0#2 = #coima020@#2; |PINTA #0#2;
               |SINO;
                    |ERROR;
               |FINSI;
               |CIERRA #coima020@;
               |HAZ BoraTempo; |DELINDEX #coima020@;
               |DESCARGA_DEF #coima020@;
          |FINSI;
/*
          |ABRE #20;
          #20#0 = #0#0;
          #20#1 = #0#1;
          #20#2 = #0#2;
          #20#3 = 0;
          |LEE 000#20];
          |CONSULTA_F_CLAVE #1#20, Min20a, Max20a;   *** FALLA ***
          |SI FSalida = 0;
               #0#2 = #20#2; |PINTA #0#2;
          |SINO;
               |ERROR;
          |FINSI;
          |CIERRA #20;
*/
     |FINSI;
     |SI Campo = 3;
          |ABRE #20;
          #20#0 = #0#0;
          #20#1 = #0#1;
          #20#2 = #0#2;
          #20#3 = #0#3;
          |LEE 000#20];
          |CONSULTA_F_CLAVE #1#20, Min20b, Max20b;
          |SI FSalida = 0;
               #0#3 = #20#3; |PINTA #0#3;
          |SINO;
               |ERROR;
          |FINSI;
          |CIERRA #20;
     |FINSI;
|FPRC;

|PROCESO Chequea; |TIPO 0;
     |SI FSalida = 2; |ACABA; |FINSI;
     |SI Campo = 0;
          |ABRE #18;
          #18#0 = #0#0;
          |LEE 000#18=;
          |SI FSalida = 0;
               #0#4 = #18#1; |PINTA #0#4;
          |SINO;
               |MENAV "0000No existe catalogo...";
               |ERROR;
          |FINSI;
          |CIERRA #18;
     |FINSI;
     |SI Campo = 1;
          |ABRE #19;
          #19#0 = #0#0;
          #19#1 = #0#1;
          |LEE 000#19=;
          |SI FSalida = 0;
               #0#5 = #19#2; |PINTA #0#5;
          |SINO;
               |MENAV "0000No existe coleccion...";
               |ERROR;
          |FINSI;
          |CIERRA #19;
     |FINSI;
     |SI Campo = 2;
          |ABRE #20;
          #20#0 = #0#0;
          #20#1 = #0#1;
          #20#2 = #0#2;
          #20#3 = 0;
          |LEE 000#20];
          |SI FSalida ! 0; |O #20#0 ! #0#0; |O #20#1 ! #0#1; |O #20#2 ! #0#2;
               |MENAV "0000No existe pagina...";
               |ERROR;
          |FINSI;
          |CIERRA #20;
     |FINSI;
     |SI Campo = 3;
          |SI #0#3 = 0;
               #0#6 = "TODOS"; |PINTA #0#6;
          |SINO;
               |ABRE #20;
               #20#0 = #0#0;
               #20#1 = #0#1;
               #20#2 = #0#2;
               #20#3 = #0#3;
               |LEE 000#20=;
               |SI FSalida = 0;
                    #0#6 = #20#4; |PINTA #0#6;
               |SINO;
                    |MENAV "0000No existe registro...";
                    |ERROR;
               |FINSI;
               |CIERRA #20;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Min;
     #11#0 = 0;
     #11#1 = 0;
     #11#2 = 0;
     #11#3 = 0;
|FPRC;

|PROCESO Max;
     #11#0 = 999;
     #11#1 = 999;
     #11#2 = 999;
     #11#3 = 999;
|FPRC;


|PROCESO Tipo3; |TIPO 3;
     |SI #0#3 = 0;
          nDReg = 0;
          nHReg = 999;
     |SINO;
          nDReg = #0#3;
          nHReg = #0#3;
     |FINSI;

     aAlfa = Usuario;
     |NOME_DAT #11 aAlfa; |DELINDEX #11;
     |ABRE #11;
     |ABRE #18;
     |ABRE #19;
     |BUCLE Paginas;
     |CIERRA #19;
     |CIERRA #18;
     |CIERRA #11;

     |PINPA #0#11;
     |PARA; |SI; |HACIENDO;
          |ENTLINEAL #1#11, 1, 4, 15, 0, Min, Max;
          |MENU Menu;
          |SI FSalida = 4; |SAL; |FINSI;
          |SI FSalida = 2; |O FSalida = 3;
               |SI FSalida = 3;
                    aDuplica = "S";
               |FINSI;
               |ABRE #20;
               |BUCLE Actualiza;
               |CIERRA #20;
               |SAL;
          |FINSI;
     |SIGUE;

     |DELINDEX #11;
|FPRC;
