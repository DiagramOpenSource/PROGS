|FICHEROS;
     diay0006 #0;
     diam0019 #1;
     diam0032 #32;
|FIN;

|VARIABLES;
     &nRelleno = 0;
     nAnyo = 0;
     nPeriodo = 0;
     &aPeriodoCrys = "";
     &nControlPinta = 0;
     &fFechaCrys = @;

     fFechaIni = @;
     &fFechaFin = @;
     fFechaTmp = @;
     nFechaTmp = 0;
     nSwSelect = 0;
     &nSwSeccion = 0;
     aAlfa = "";
     {12}periodo = @;
     nPara = 0;
     nResta = 0;
     &nPeri = 0
     aPeriodo = "";
     &fFechPeri1 = @
     &fFechPeri2 = @
     &fFechPeri3 = @
     &fFechPeri4 = @
     &fFechPeri5 = @
     &fFechPeri6 = @
     &fFechPeri7 = @
     &fFechPeri8 = @
     &fFechPeri9 = @
     &fFechPeri10 = @
     &fFechPeri11 = @
     &fFechPeri12 = @
|FIN;

|PROCESO MiraPeriodo;
     nPeri = 99;
     |SI nSwSeccion < 3;
          aAlfa = #1#1;     |QBF aAlfa;
     |FINSI;
     |SI nSwSeccion = 3;
          aAlfa = #1#122;    |QBF aAlfa;
     |FINSI;
     |SI nSwSeccion = 4;
          aAlfa = #1#123;    |QBF aAlfa;
     |FINSI;
     aAlfa = aAlfa % -104;
     nAnyo = aAlfa;
     #32#0 = nAnyo;
     #32#1 = #1#18;
     |LEE 000#32=;
     |SI FSalida ! 0;
          |ACABA;
     |SINO;
          aAlfa = #32#4; |QBF aAlfa;
          |SI aAlfa ! "S";    |ACABA; |FINSI;
     |FINSI;
     |SI nSwSeccion = 1; |O nSwSeccion = 2;
          |SI periodo1 [ #1#1; |Y periodo2 ] #1#1;
               nPeri = 1;
          |FINSI;
          |SI nSwSeccion = 1; |Y periodo1 ] #1#1;
               nPeri = 0;
          |FINSI;
          |SI periodo2 [ #1#1; |Y periodo3 ] #1#1;
               nPeri = 2;
          |FINSI;
          |SI periodo3 [ #1#1; |Y periodo4 ] #1#1;
               nPeri = 3;
          |FINSI;
          |SI periodo4 [ #1#1; |Y periodo5 ] #1#1;
               nPeri = 4;
          |FINSI;
          |SI periodo5 [ #1#1; |Y periodo6 ] #1#1;
               nPeri = 5;
          |FINSI;
          |SI periodo6 [ #1#1; |Y periodo7 ] #1#1;
               nPeri = 6;
          |FINSI;
          |SI periodo7 [ #1#1; |Y periodo8 ] #1#1;
               nPeri = 7;
          |FINSI;
          |SI periodo8 [ #1#1; |Y periodo9 ] #1#1;
               nPeri = 8;
          |FINSI;
          |SI periodo9 [ #1#1; |Y periodo10 ] #1#1;
               nPeri = 9;
          |FINSI;
          |SI periodo10 [ #1#1; |Y periodo11 ] #1#1;
               nPeri = 10;
          |FINSI;
          |SI periodo11 [ #1#1; |Y periodo12 ] #1#1;
               nPeri = 11;
          |FINSI;
          |SI periodo12 [ #1#1; |Y fFechaFin ] #1#1;
               nPeri = 12;
          |FINSI;
     |FINSI;
     |SI nSwSeccion = 3;
          |SI periodo1 [ #1#122; |Y periodo2 ] #1#122;
               nPeri = 1;
          |FINSI;
          |SI periodo2 [ #1#122; |Y periodo3 ] #1#122;
               nPeri = 2;
          |FINSI;
          |SI periodo3 [ #1#122; |Y periodo4 ] #1#122;
               nPeri = 3;
          |FINSI;
          |SI periodo4 [ #1#122; |Y periodo5 ] #1#122;
               nPeri = 4;
          |FINSI;
          |SI periodo5 [ #1#122; |Y periodo6 ] #1#122;
               nPeri = 5;
          |FINSI;
          |SI periodo6 [ #1#122; |Y periodo7 ] #1#122;
               nPeri = 6;
          |FINSI;
          |SI periodo7 [ #1#122; |Y periodo8 ] #1#122;
               nPeri = 7;
          |FINSI;
          |SI periodo8 [ #1#122; |Y periodo9 ] #1#122;
               nPeri = 8;
          |FINSI;
          |SI periodo9 [ #1#122; |Y periodo10 ] #1#122;
               nPeri = 9;
          |FINSI;
          |SI periodo10 [ #1#122; |Y periodo11 ] #1#122;
               nPeri = 10;
          |FINSI;
          |SI periodo11 [ #1#122; |Y periodo12 ] #1#122;
               nPeri = 11;
          |FINSI;
          |SI periodo12 [ #1#122; |Y fFechaFin ] #1#122;
               nPeri = 12;
          |FINSI;
     |FINSI;
     |SI nSwSeccion = 4;
          |SI periodo1 [ #1#123; |Y periodo2 ] #1#123;
               nPeri = 1;
          |FINSI;
          |SI periodo2 [ #1#123; |Y periodo3 ] #1#123;
               nPeri = 2;
          |FINSI;
          |SI periodo3 [ #1#123; |Y periodo4 ] #1#123;
               nPeri = 3;
          |FINSI;
          |SI periodo4 [ #1#123; |Y periodo5 ] #1#123;
               nPeri = 4;
          |FINSI;
          |SI periodo5 [ #1#123; |Y periodo6 ] #1#123;
               nPeri = 5;
          |FINSI;
          |SI periodo6 [ #1#123; |Y periodo7 ] #1#123;
               nPeri = 6;
          |FINSI;
          |SI periodo7 [ #1#123; |Y periodo8 ] #1#123;
               nPeri = 7;
          |FINSI;
          |SI periodo8 [ #1#123; |Y periodo9 ] #1#123;
               nPeri = 8;
          |FINSI;
          |SI periodo9 [ #1#123; |Y periodo10 ] #1#123;
               nPeri = 9;
          |FINSI;
          |SI periodo10 [ #1#123; |Y periodo11 ] #1#123;
               nPeri = 10;
          |FINSI;
          |SI periodo11 [ #1#123; |Y periodo12 ] #1#123;
               nPeri = 11;
          |FINSI;
          |SI periodo12 [ #1#123; |Y fFechaFin ] #1#123;
               nPeri = 12;
          |FINSI;
     |FINSI;



     |SI nPeri = 0;
          |PRINT;
     |FINSI;
     |SI nPeri ! 99; |Y nPeri ! 0; |PRINT;   |FINSI;
     |SI nSwSeccion = 1;
          nPeriodo = nPeri + 1;
          |PARA nPara = nPeriodo; |SI nPara [ 12; |HACIENDO nPara = nPara + 1;
               nSwSeccion = 1;
               nPeri = nPara;
               nControlPinta = 1;
               |PRINT;
          |SIGUE;
     |FINSI;
     |SI nSwSeccion = 3; |O nSwSeccion = 4;
          nPeriodo = nPeri;
          |SI periodo1 [ #1#1; |Y periodo2 ] #1#1;
               nPeri = 1;
          |FINSI;
          |SI periodo1 ] #1#1;
               nPeri = 0;
          |FINSI;
          |SI periodo2 [ #1#1; |Y periodo3 ] #1#1;
               nPeri = 2;
          |FINSI;
          |SI periodo3 [ #1#1; |Y periodo4 ] #1#1;
               nPeri = 3;
          |FINSI;
          |SI periodo4 [ #1#1; |Y periodo5 ] #1#1;
               nPeri = 4;
          |FINSI;
          |SI periodo5 [ #1#1; |Y periodo6 ] #1#1;
               nPeri = 5;
          |FINSI;
          |SI periodo6 [ #1#1; |Y periodo7 ] #1#1;
               nPeri = 6;
          |FINSI;
          |SI periodo7 [ #1#1; |Y periodo8 ] #1#1;
               nPeri = 7;
          |FINSI;
          |SI periodo8 [ #1#1; |Y periodo9 ] #1#1;
               nPeri = 8;
          |FINSI;
          |SI periodo9 [ #1#1; |Y periodo10 ] #1#1;
               nPeri = 9;
          |FINSI;
          |SI periodo10 [ #1#1; |Y periodo11 ] #1#1;
               nPeri = 10;
          |FINSI;
          |SI periodo11 [ #1#1; |Y periodo12 ] #1#1;
               nPeri = 11;
          |FINSI;
          |SI periodo12 [ #1#1; |Y fFechaFin ] #1#1;
               nPeri = 12;
          |FINSI;
          nSwSeccion = 2;
          |PRINT;
          |PARA nPara = nPeri; |SI nPara < nPeriodo; |HACIENDO nPara = nPara + 1;
               nSwSeccion = 1;
               nPeri = nPara;
               |PRINT;
          |SIGUE;

     |FINSI;
|FPRC;

|PROCESO diam0019;
     nRelleno = 0;
     nSwSelect = 0;
     nSwSeccion = 0;

     |SI #1#1 > fFechaFin;     nSwSelect = 1; |FINSI;
     |SI #1#122 < periodo1;  |O #1#122 > fFechaFin;   nSwSelect = 1; |FINSI;
     |SI #1#123 < periodo1;  |O #1#123 > fFechaFin;   nSwSelect = 1; |FINSI;
     aAlfa = #1#119;     |QBF aAlfa;

     |SI nSwSelect = 1; |Y aAlfa ! "PENDIENTE"     |ACABA;   |FINSI;


     |SI aAlfa = "PENDIENTE";
          nSwSeccion = 1;
          |HAZ MiraPeriodo;
     |FINSI;
     |SI #1#1 ] periodo1;   |Y #1#1 [ fFechaFin; |Y aAlfa = "PENDIENTE";
          nSwSeccion = 2;
          |HAZ MiraPeriodo;
     |FINSI;
     |SI #1#122 ] periodo1;   |Y #1#122 [ fFechaFin; |Y aAlfa = "EN PEDIDOS";
          nSwSeccion = 3;
          |HAZ MiraPeriodo;
     |FINSI;
     |SI #1#123 ] periodo1;   |Y #1#123 [ fFechaFin; |Y aAlfa = "RECHAZADA";
          nSwSeccion = 4;
          |HAZ MiraPeriodo;
     |FINSI;
|FPRC;

|DEFBUCLE diam0019;
     #1#1;
     #1#18;
     INICIO;
     FINAL;
     ;
     NULL, diam0019;
|FIN;

|PROCESO diam0032;
     nRelleno = 1;
     #1#18 = #32#1;
     #1#120 = #32#2;
     nPeri = 12;
     #1#1 = fFechaFin;
     #1#122 = fFechaFin;
     #1#123 = fFechaFin;
     nSwSeccion = 1;
     |PRINT;
     nSwSeccion = 2;
     |PRINT;
     nSwSeccion = 3;
     |PRINT;
     nSwSeccion = 4;
     |PRINT;
|FPRC;

|DEFBUCLE diam0032;
     #32#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, diam0032;
|FIN;

|PROGRAMA;
     |CLS;
     ||PINPA #0#0;

     fFechaFin = fFechaCrys;
     aPeriodo = aPeriodoCrys;
     Impresora = "CrystalReports";
     |IMPRE -1;
     |SI FSalida = 0;
          |INFOR "diay0006";
          |SI FSalida ! 0; |ACABA; |FINSI;
          |SI aPeriodo = "M";
               nResta = 30;
          |FINSI;
          |SI aPeriodo = "Q";
               nResta = 15;
          |FINSI;
          |SI aPeriodo = "S";
               nResta = 7;
          |FINSI;
          Iperiodo = periodo12<-;
          |PARA nPara = 1; |SI nPara [ 12; |HACIENDO nPara = nPara + 1;
               |SI nPara = 1;
                    nFechaTmp = fFechaFin;
                    nFechaTmp = nFechaTmp - nResta;
                    periodo = nFechaTmp;
               |SINO;
                    nFechaTmp = fFechaTmp;
                    nFechaTmp = nFechaTmp - nResta;
                    periodo = nFechaTmp;
               |FINSI;
               fFechaTmp = periodo;
               Iperiodo = Iperiodo - 1;
          |SIGUE;
          fFechPeri1 = periodo1;
          fFechPeri2 = periodo2;
          fFechPeri3 = periodo3;
          fFechPeri4 = periodo4;
          fFechPeri5 = periodo5;
          fFechPeri6 = periodo6;
          fFechPeri7 = periodo7;
          fFechPeri8 = periodo8;
          fFechPeri9 = periodo9;
          fFechPeri10 = periodo10;
          fFechPeri11 = periodo11;
          fFechPeri12 = periodo12;
          |BUCLE diam0032;
          |ABRE #32;
          |BUCLE diam0019;
          |CIERRA #32;
          |PIEINF;
          |FININF;
          |FINIMP;
     |FINSI;
|FPRO;
