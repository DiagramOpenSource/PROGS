|FICHEROS;
     cafe0017 #0;
     cafe0015 #15;
     cafe0016 #16;
     cafe0018 #18; ||TMP
     cafe0019 #19; ||TMP
     agifa010 #10;
     agifa071 #71;
     agifa084 #84;
     agifa069 #69;
     agifa024 #24;
     referen@;
|FIN;

|VARIABLES;
     &VACIO = -99999;    || Para saber si tiene moviento
     &BLANCO = -99998;   || Para que no lo pinte en el informe
     RAYA = "----------";|| Solo lista los meses informados

     &eaCli = "";
     fHoy = @;
     aAlfa = "";
     aAlf1 = "";
     nUni = 0;
     nImp = 0;
     aRepre = "";
     nHay = 0;
     aDFecha = "";
     aHFecha = "";
     fDFecha = @;
     fHFecha = @;
     fFecha = @;
     nHayUni = 0;
     nCampo = 0;
     aMes = "";
     aAno = "";
     aNomMes = "";
     f = @;
     nMes = 0;
     nAno = 0;
     nNume = 0;
|FIN;

|PROCESO &LeeKilos;
     |ABRE #19;
     #19#0 = eaCli;
     |LEE 020#19=;
     |CIERRA #19;
     |SI #19#1 ] #19#13; #19#1 = BLANCO; |FINSI;
     |SI #19#2 ] #19#13; #19#2 = BLANCO; |FINSI;
     |SI #19#3 ] #19#13; #19#3 = BLANCO; |FINSI;
     |SI #19#4 ] #19#13; #19#4 = BLANCO; |FINSI;
     |SI #19#5 ] #19#13; #19#5 = BLANCO; |FINSI;
     |SI #19#6 ] #19#13; #19#6 = BLANCO; |FINSI;
     |SI #19#7 ] #19#13; #19#7 = BLANCO; |FINSI;
     |SI #19#8 ] #19#13; #19#8 = BLANCO; |FINSI;
     |SI #19#9 ] #19#13; #19#9 = BLANCO; |FINSI;
     |SI #19#10 ] #19#13; #19#10 = BLANCO; |FINSI;
     |SI #19#11 ] #19#13; #19#11 = BLANCO; |FINSI;
     |SI #19#12 ] #19#13; #19#12 = BLANCO; |FINSI;

     |SI #19#1 = VACIO; #19#1 = 0; |FINSI;
     |SI #19#2 = VACIO; #19#2 = 0; |FINSI;
     |SI #19#3 = VACIO; #19#3 = 0; |FINSI;
     |SI #19#4 = VACIO; #19#4 = 0; |FINSI;
     |SI #19#5 = VACIO; #19#5 = 0; |FINSI;
     |SI #19#6 = VACIO; #19#6 = 0; |FINSI;
     |SI #19#7 = VACIO; #19#7 = 0; |FINSI;
     |SI #19#8 = VACIO; #19#8 = 0; |FINSI;
     |SI #19#9 = VACIO; #19#9 = 0; |FINSI;
     |SI #19#10 = VACIO; #19#10 = 0; |FINSI;
     |SI #19#11 = VACIO; #19#11 = 0; |FINSI;
     |SI #19#12 = VACIO; #19#12 = 0; |FINSI;

     |SI #0#9 = RAYA; #19#1 = BLANCO; |FINSI;
     |SI #0#10 = RAYA; #19#2 = BLANCO; |FINSI;
     |SI #0#11 = RAYA; #19#3 = BLANCO; |FINSI;
     |SI #0#12 = RAYA; #19#4 = BLANCO; |FINSI;
     |SI #0#13 = RAYA; #19#5 = BLANCO; |FINSI;
     |SI #0#14 = RAYA; #19#6 = BLANCO; |FINSI;
     |SI #0#15 = RAYA; #19#7 = BLANCO; |FINSI;
     |SI #0#16 = RAYA; #19#8 = BLANCO; |FINSI;
     |SI #0#17 = RAYA; #19#9 = BLANCO; |FINSI;
     |SI #0#18 = RAYA; #19#10 = BLANCO; |FINSI;
     |SI #0#19 = RAYA; #19#11 = BLANCO; |FINSI;
     |SI #0#20 = RAYA; #19#12 = BLANCO; |FINSI;
|FPRC;

|PROCESO Tmp;
     #19#0 = #18#1;
     |LEE 020#19=;
     |SI #19#1 ] #18#5; #18#6 = BLANCO; |FINSI;
     |SI #19#2 ] #18#5; #18#7 = BLANCO; |FINSI;
     |SI #19#3 ] #18#5; #18#8 = BLANCO; |FINSI;
     |SI #19#4 ] #18#5; #18#9 = BLANCO; |FINSI;
     |SI #19#5 ] #18#5; #18#10 = BLANCO; |FINSI;
     |SI #19#6 ] #18#5; #18#11 = BLANCO; |FINSI;
     |SI #19#7 ] #18#5; #18#12 = BLANCO; |FINSI;
     |SI #19#8 ] #18#5; #18#13 = BLANCO; |FINSI;
     |SI #19#9 ] #18#5; #18#14 = BLANCO; |FINSI;
     |SI #19#10 ] #18#5; #18#15 = BLANCO; |FINSI;
     |SI #19#11 ] #18#5; #18#16 = BLANCO; |FINSI;
     |SI #19#12 ] #18#5; #18#17 = BLANCO; |FINSI;

     |SI #18#6 = VACIO; #18#6 = 0; |FINSI;
     |SI #18#7 = VACIO; #18#7 = 0; |FINSI;
     |SI #18#8 = VACIO; #18#8 = 0; |FINSI;
     |SI #18#9 = VACIO; #18#9 = 0; |FINSI;
     |SI #18#10 = VACIO; #18#10 = 0; |FINSI;
     |SI #18#11 = VACIO; #18#11 = 0; |FINSI;
     |SI #18#12 = VACIO; #18#12 = 0; |FINSI;
     |SI #18#13 = VACIO; #18#13 = 0; |FINSI;
     |SI #18#14 = VACIO; #18#14 = 0; |FINSI;
     |SI #18#15 = VACIO; #18#15 = 0; |FINSI;
     |SI #18#16 = VACIO; #18#16 = 0; |FINSI;
     |SI #18#17 = VACIO; #18#17 = 0; |FINSI;

     |SI #0#9 = RAYA; #18#6 = BLANCO; |FINSI;
     |SI #0#10 = RAYA; #18#7 = BLANCO; |FINSI;
     |SI #0#11 = RAYA; #18#8 = BLANCO; |FINSI;
     |SI #0#12 = RAYA; #18#9 = BLANCO; |FINSI;
     |SI #0#13 = RAYA; #18#10 = BLANCO; |FINSI;
     |SI #0#14 = RAYA; #18#11 = BLANCO; |FINSI;
     |SI #0#15 = RAYA; #18#12 = BLANCO; |FINSI;
     |SI #0#16 = RAYA; #18#13 = BLANCO; |FINSI;
     |SI #0#17 = RAYA; #18#14 = BLANCO; |FINSI;
     |SI #0#18 = RAYA; #18#15 = BLANCO; |FINSI;
     |SI #0#19 = RAYA; #18#16 = BLANCO; |FINSI;
     |SI #0#20 = RAYA; #18#17 = BLANCO; |FINSI;

     |DDEFECTO #24;
     #24#0 = #18#1;
     |LEE 000#24=;

     #18#3 = #24#2;


     nHay = 1;
     |PRINT;
|FPRC;

|DEFBUCLE Tmp;
     #18#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Tmp;
|FIN;

|PROCESO LlenaDefecto;
     |DDEFECTO #18;
     #18#0 = aRepre;
     #18#1 = #referen@#0;
     #18#2 = #referen@#1;
     ||#18#3
     #18#4 = #referen@#2;
     #18#5 = #15#4;
     #18#6 = VACIO;
     #18#7 = VACIO;
     #18#8 = VACIO;
     #18#9 = VACIO;
     #18#10 = VACIO;
     #18#11 = VACIO;
     #18#12 = VACIO;
     #18#13 = VACIO;
     #18#14 = VACIO;
     #18#15 = VACIO;
     #18#16 = VACIO;
     #18#17 = VACIO;
     |LEE 000#18=;
     |SI FSalida ! 0; |GRABA 020#18n; |FINSI;

     |DDEFECTO #19;
     #19#0 = #18#1;
     #19#1 = VACIO;
     #19#2 = VACIO;
     #19#3 = VACIO;
     #19#4 = VACIO;
     #19#5 = VACIO;
     #19#6 = VACIO;
     #19#7 = VACIO;
     #19#8 = VACIO;
     #19#9 = VACIO;
     #19#10 = VACIO;
     #19#11 = VACIO;
     #19#12 = VACIO;
     #19#13 = #15#4;
     |LEE 000#19=;
     |SI FSalida ! 0; |GRABA 020#19n; |FINSI;
|FPRC;

|DEFBUCLE LlenaDefecto;
     #referen@#1002;
     ;
     #15#0, "                    ";
     #15#0, "zzzzzzzzzzzzzzzzzzzz";
     ;
     NULL, LlenaDefecto;
|FIN;

|PROCESO Graba;
     aMes = fFecha % 402; nMes = aMes;
     aAno = fFecha % 704; nAno = aAno;

     nNume = ((nAno - #0#6) * 12) + nMes;
     nCampo = nNume - #0#4 + 6;

     aRepre = "";   ||para no tocar nada, quito el repre de la pantalla y
                    ||del informe (y de la condicion de la subcabecera)

     |BUCLE LlenaDefecto;

     |DDEFECTO #18;
     #18#0 = aRepre;
     #18#1 = #16#0;
     #18#2 = #16#1;
     |LEE 101#18=;
     |SI FSalida ! 0; |GRABA 020#18b; |FINSI;
     #18#4 = #16#2;
     #18#5 = #15#4;
     |SI #18nCampo = VACIO; #18nCampo = 0; |FINSI;
     #18nCampo = #18nCampo + nUni;
     |GRABA 020#18a;
     |LIBERA #18;

     nCampo = nNume - #0#4 + 1;

     |DDEFECTO #19;
     #19#0 = #18#1;
     |LEE 101#19=;
     |SI FSalida ! 0; |GRABA 020#19b; |FINSI;
     |SI #19nCampo = VACIO; #19nCampo = 0; |FINSI;
     #19nCampo = #19nCampo + nUni;
     #19#13 = #15#4;
     |GRABA 020#19a;

     nHayUni = 1;
|FPRC;

|PROCESO agifa069;
     |SI #69#5 ! 0; |Y #69#6 = 0;
          |ACABA;
     |FINSI;
     #16#0 = #84#3;
     #16#1 = #69#2;
     |LEE 000#16=;
     |SI FSalida = 0;
          nUni = #69#5;
          nImp = #69#27;
          aRepre = #84#6;
          fFecha = #84#1;
          |HAZ Graba;
     |FINSI;
|FPRC;

|DEFBUCLE agifa084;
     #84#3;
     6;
     #15#0, aDFecha, "     ", 000001, #0#0;
     #15#0, aHFecha, "zzzzz", 999999, #0#1;
     ;
     NULL, NULL, agifa069;
|FIN;

|PROCESO agifa071;
     |SI #71#5 ! 0; |Y #71#6 = 0;
          |ACABA;
     |FINSI;

     #16#0 = #10#3;
     #16#1 = #71#2;
     |LEE 000#16=;
     |SI FSalida = 0;
          nUni = #71#5;
          nImp = #71#37;
          aRepre = #10#6;
          fFecha = #10#1;
          |HAZ Graba;
     |FINSI;
|FPRC;

|DEFBUCLE agifa010;
     #10#3;
     6;
     #15#0, aDFecha, "     ", 000001, #0#0;
     #15#0, aHFecha, "zzzzz", 999999, #0#1;
     ;
     NULL, NULL, agifa071;
|FIN;

|PROCESO cafe0015;
     |SI fHFecha ] #15#2; |Y fDFecha [ #15#3;
          nHayUni = 0;
          |BUCLE agifa010;
          |BUCLE agifa084;
          |SI nHayUni = 0;
               |DDEFECTO #24;
               #24#0 = #15#0;
               |LEE 000#24=;
               aRepre = #24#25;
               |BUCLE LlenaDefecto;
               |DDEFECTO #19;
               #19#0 = #15#0;
               |GRABA 040#19n;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE cafe0015;
     #15#1;
     ;
     #0#2;
     #0#3;
     ;
     NULL, cafe0015;
|FIN;

|PROCESO Tipo7; |TIPO 7;
     |SI #0#6 = 0;
          fHoy = ~;
          aAlfa = fHoy;
          aAlf1 =  aAlfa % 402;
          #0#4 = aAlf1;
          #0#5 = #0#4;
          aAlf1 = aAlfa % -104;
          #0#6 = aAlf1;
          #0#7 = #0#6;
          |PINDA #0#0;
     |FINSI;
|FPRC;

|PROCESO NomMes;
     |SI aMes = 1; aNomMes =  "     ENERO"; |FINSI;
     |SI aMes = 2; aNomMes =  "   FEBRERO"; |FINSI;
     |SI aMes = 3; aNomMes =  "     MARZO"; |FINSI;
     |SI aMes = 4; aNomMes =  "     ABRIL"; |FINSI;
     |SI aMes = 5; aNomMes =  "      MAYO"; |FINSI;
     |SI aMes = 6; aNomMes =  "     JUNIO"; |FINSI;
     |SI aMes = 7; aNomMes =  "     JULIO"; |FINSI;
     |SI aMes = 8; aNomMes =  "    AGOSTO"; |FINSI;
     |SI aMes = 9; aNomMes =  "SEPTIEMBRE"; |FINSI;
     |SI aMes = 10; aNomMes = "   OCTUBRE"; |FINSI;
     |SI aMes = 11; aNomMes = " NOVIEMBRE"; |FINSI;
     |SI aMes = 12; aNomMes = " DICIEMBRE"; |FINSI;
|FPRC;

|PROCESO Tipo3; |TIPO 3;
     aDFecha = "01." + (("00" + #0#4) % -102) + "." + (("0000" + #0#6) % -104);
     aHFecha = "01." + (("00" + #0#5) % -102) + "." + (("0000" + #0#7) % -104);

     fDFecha = aDFecha;
     fHFecha = aHFecha;

     fFecha = aHFecha;
     |PARA; |SI; |HACIENDO;
          fFecha = fFecha + 1;
          aAlfa = fFecha % 402;
          |SI aAlfa ! #0#5; |SAL; |FINSI;
          aHFecha = fFecha;
     |SIGUE;

     |PARA f = aDFecha; |SI f  [ aHFecha; |HACIENDO f = f + 1;
          aAlfa = f % 402;
          |SI aMes = "";
               nCampo = 9;
               nMes = 1;
               aMes = aAlfa;
               |HAZ NomMes;
               #0nCampo = aNomMes;
               nCampo = nCampo + 1;
          |FINSI;
          |SI aMes ! aAlfa;
               nMes = nMes + 1;
               aMes = aAlfa;
               |HAZ NomMes;
               |SI nCampo [ 20;
                    #0nCampo = aNomMes;
               |FINSI;
               nCampo = nCampo + 1;
          |FINSI;
     |SIGUE;

     |SI nMes > 12;
          |MENAV "0000Error en limite de fechas, no pude superar 12 meses";
          |ACABA;
     |FINSI;

     |DDEF aAlfa;
     aAlfa = aAlfa + "cafe0016";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida ! 0;
          |MENAV "0000Error al cargar 'cafe0016'";
          |ACABA;
     |FINSI;

     |IMPRE 0;
     |SI FSalida = 0;
          |INFOR "cafe0017";
          |SI FSalida ! 0;
               |MENAV "0000Error en informe 'cafe0017'";
          |SINO;
               aAlfa = "1" + Usuario;
               |NOME_DAT #18aAlfa; |DELINDEX #18;

               aAlfa = "2" + Usuario;
               |NOME_DAT #19aAlfa; |DELINDEX #19;

               |ABRE #19;
               |ABRE #18;
               |ABRE #16;
               |BUCLE cafe0015;
               |CIERRA #16;
               |CIERRA #18;

               |ABRE #24;
               |BUCLE Tmp;
               |CIERRA #24;
               |CIERRA #19;

               |SI nHay = 0;
                    |MENAV "0000No hay registros...";
               |SINO;
                    |PIEINF;
               |FINSI;
               |FININF;

               |DELINDEX #19;
               |DELINDEX #18;
          |FINSI;
          |FINIMP;
     |FINSI;

     |DESCARGA_DEF #referen@;
|FPRC;
