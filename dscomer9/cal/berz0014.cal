|FICHEROS;
     berz0014 #0;
     agifa019 #19;
     agifa067 #67;
     agifa080 #80;
     agifa081 #81;
     agifa142 #142;
|FIN;

|VARIABLES;
     &enForma = 0;
     &enUnidPend = 0;
     &enUnidPend2 = 0;
     &Tempo = "";
     &eaSer = "";
     &enDocu = 0;
     &eaDocu = "";
     {-1}aMenu = "";
     aMenu1 = "2345";
     aMenu2 = "1";
     aMenu3 = "Opciones:  ";
     aMenu4 = "RA";
     aMenu5 = " Repasar ";
     aMenu6 = " Aceptar ";
     aArt = "";
     nLin = 0;
     nLinUlt = 0;
     aParam = "";
     nVaria1 = 0;
     nVaria2 = 0;
     aDespreciar = "";
     nPendiente = 0;
     nPendiente2 = 0;
|FIN;

|PROCESO ActPedido;
     |ABRE #81;
     |ABRE #67;
     #67#28 = #80#29;
     #67#0 = #80#12;
     #67#1 = #80#21;
     |LEE 101#67=;
     |SI FSalida = 0;
          nPendiente  = #67#5 - #67#38;
          nPendiente2 = #67#41 - #67#46;
          aDespreciar = "N";
          |SI enForma = 1;
               |SI #80#5 > nPendiente; |O #80#36 > nPendiente2;
                    aDespreciar = "S";
               |FINSI;
          |FINSI;

          #67#38 = #67#38 + (#80#5 * enForma);
          #67#46 = #67#46 + (#80#36 * enForma);

          |SI aDespreciar = "S";
               nVaria1 = #67#12;
               nVaria2 = #67#44;
               #67#12 = #67#38 - #67#37;
               #67#44 = #67#46 - #67#45;
               nVaria1 = #67#12 - nVaria1;
               nVaria2 = #67#44 - nVaria2;
               #80#22 = nVaria1;
               #80#24 = nVaria2;
          |SINO;
               |SI #142#225 = "B";
                    |SI #67#37 = 0;
                         #67#12 = #67#38 - #67#37;
                    |FINSI;
                    |SI #67#45 = 0;
                         #67#44 = #67#46 - #67#45;
                    |FINSI;
               |FINSI;
          |FINSI;

          enUnidPend =  0;
          enUnidPend2 =  0;
          |SI enForma = -1;  || Restaura Unid. Variacion Pedido
               #67#12 = #67#12 - #80#22;
               #67#44 = #67#44 - #80#24;
               enUnidPend =  #80#22;
               enUnidPend2 =  #80#24;
               #80#22 = 0;
               #80#24 = 0;
          |FINSI;

          #67#5  = #67#37 + #67#12;
          #67#41 = #67#45 + #67#44;
          |GRABA 020#67a;

          |SI aDespreciar = "S";
               enUnidPend = #80#5 + (nPendiente - #80#5);
               enUnidPend2 = #80#36 + (nPendiente2 - #80#36);
          |SINO;
               enUnidPend = #80#5 - enUnidPend;
               enUnidPend2 = #80#36 - enUnidPend2;
               |SI #67#37 = 0; enUnidPend = 0; |FINSI;
               |SI #67#45 = 0; enUnidPend2 = 0; |FINSI;
          |FINSI;

          eaDocu = "agifa213";
          |HAZ StockEntra;

          #81#25 = #67#28;
          #81#0 = #67#0;
          |LEE 121#81=;
          |SI FSalida = 0;
               |HAZ CalCabAgifa081;
          |FINSI;
     |SINO;
          eaDocu = "agifa080";
          |HAZ StockEntra;
     |FINSI;
     |CIERRA #81;
     |CIERRA #67;
|FPRC;

|PROCESO Tmp;
     nLinUlt = nLinUlt + 1;
     #80#1 = nLinUlt;
     #80#5 = 1;
     #80#37 = #0#1;
     |HAZ TotalLin80;
     |GRABA 020#80n;
     |SI FSalida = 0;
          enForma = 1;
          |SI aParam = "ADJ";
               |HAZ ActPedido;
          |SINO;
               eaDocu = "agifa080";
               |HAZ StockEntra;
          |FINSI;
     |FINSI;
     |BORRA 020#0a;
|FPRC;

|DEFBUCLE Tmp;
     #0#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Tmp;
|FIN;

|PROCESO Min;
     #0#0 = 1;
|FPRC;

|PROCESO Max;
     #0#0 = 999;
|FPRC;

|PROCESO Tipo7; |TIPO 7;
     #0#2 = aArt; |PINTA #0#2;
|FPRC;

|PROCESO PideNum;
     |ABRE #19;
     #19#0 = aArt;
     |LEE 020#19=;
     |SI FSalida = 0; |Y #19#180 = "S";
          |PARA; |SI; |HACIENDO;
               |PINPA #0#0;
               |ENTLINEAL #1#0, 1, 1, 22, 0, Min, Max;
               |MENU aMenu;
               |SI FSalida = 2; |SAL; |FINSI;
          |SIGUE;
          |LEE 000#0p;
          |SI FSalida = 0;
               |SALVA_FICHA #80;
               #80#27 = eaSer;
               #80#0 = enDocu;
               #80#1 = nLin;
               |LEE 121#80=;
               |SI FSalida = 0;
                    enForma = -1;
                    |SI aParam = "ADJ";
                         |HAZ ActPedido;
                    |SINO;
                         eaDocu = "agifa080";
                         |HAZ StockEntra;
                    |FINSI;
                    #80#5 = 1;
                    #80#37 = #0#1;
                    |HAZ TotalLin80;
                    |GRABA 020#80a;     ||Actualiza la partida
                    |LIBERA #80;
                    enForma = 1;
                    |SI aParam = "ADJ";
                         |HAZ ActPedido;
                    |SINO;
                         eaDocu = "agifa080";
                         |HAZ StockEntra;
                    |FINSI;
                    |BORRA 020#0a;
                    |BUCLE Tmp;         ||Crea todas las demas
               |FINSI;
               |REPON_FICHA #80;
          |FINSI;
     |FINSI;
     nLin = 0;
|FPRC;

|PROCESO agifa080;
     |SI aArt ! #80#2; |Y aArt ! "";
          |HAZ PideNum;
     |FINSI;
     aArt = #80#2;
     |SI nLin = 0; nLin = #80#1; |FINSI;
|FPRC;

|DEFBUCLE agifa080;
     #80#1;
     ;
     eaSer, enDocu, 001;
     eaSer, enDocu, 999;
     ;
     NULL, NULL, NULL, NULL, NULL, agifa080;
     #80#2;
|FIN;

|PROGRAMA;
     |ABRE #142; |LEE 000#142p; |CIERRA #142;

     |HAZ CreaTempo; |NOME_DAT #0 Tempo; |DELINDEX #0;

     aParam = PARAMETRO;

     |ABRET #0;
     |ABRET #80;
     #80#27 = eaSer;
     #80#0 = enDocu;
     #80#1 = 999;
     |LEE 000#80];
     |SI FSalida = 0;
          |LEE 000#80a;
     |SINO;
          |LEE 000#80u;
     |FINSI;
     nLinUlt = #80#1;

     aArt = "";
     |BUCLE agifa080;
     |SI aArt ! "";
          |HAZ PideNum;
     |FINSI;
     |CIERRAT #0;
     |CIERRAT #80;

     |HAZ BoraTempo; |DELINDEX #0;
|FPRO;
