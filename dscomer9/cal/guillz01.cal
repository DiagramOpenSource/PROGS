|FICHEROS;
     guillz01 #0;
     guillw02 #2;
     agifa010 #10;
     agifa019 #19;
     guillw01 #20;
     agifa024 #24;
     agifa071 #71;
|FIN;

|VARIABLES;
     aRuta = "";
     nBoton1 = 0;
     aFic = "";
     nHandle = 0;
     aAlfa = "";
     aFinReg = "";
     aFecha = "";
     aCanti = "";
     aStock = "";
     aCodigo = "";
     aCliLpr = "";
     aCliDis = "";
     aCliDes = "";
     aLon = "";
     nPos = 0;
     i = 0;
     aCar = "";
     aNume = "";
|FIN;

|PROCESO Decimal;
     aLon = aNume % A0;
     aAlfa = "";
     |PARA i = 1; |SI i [ aLon; |HACIENDO i = i + 1;
          nPos = i * 100 + 1;
          aCar = aNume % nPos;
          |SI aCar = "."; aCar = ","; |FINSI;
          aAlfa = aAlfa + aCar;
     |SIGUE;
     aNume = aAlfa;
|FPRC;

|PROCESO Temporal;
     |DDEFECTO #19;
     #19#0 = #20#0;
     |LEE 000#19=;

     aCodigo = #19#134;  |QBF aCodigo;
 ||    aCodigo = "0" + aCodigo + "01";
     aNume = #19#6; |HAZ Decimal; aStock = aNume;

     aAlfa = "!DETALLE" + aFinReg;
     aAlfa = aAlfa + "{COD_ARTICULO}" + aCodigo + "#" + aFinReg;
     aAlfa = aAlfa + "{CAN_STOCK}" + aStock + "#" + aFinReg;
     |XGRABA nHandle, aAlfa;
|FPRC;

|DEFBUCLE Temporal;
     #20#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Temporal;
|FIN;

|PROCESO Albaranes;
     |SI #71#13 < #0#4; |O #71#13 > #0#5;
          |ACABA;
     |FINSI;

     #20#0 = #71#2;
     |LEE 000#20=;
     |SI FSalida ! 0; |GRABA 020#20n; |FINSI;

     |DDEFECTO #24;
     #24#0 = #10#3;
     |LEE 000#24=;

     |DDEFECTO #19;
     #19#0 = #71#2;
     |LEE 000#19=;

     aCodigo = #19#134;  |QBF aCodigo;
||     aCodigo = "0" + aCodigo + "01";
     aCliLpr = #24#27; |QBF aCliLpr;
     aCliDis = #24#0; |QBF aCliDis;
     aCliDes = #24#2; |QBF aCliDes;

     |DDEFECTO #2;
     #2#0 = aCodigo;
     #2#1 = aCliDis;
     |LEE 101#2=;
     |SI FSalida ! 0; |GRABA 020#2b; |FINSI;
     #2#2 = aCliLpr;
     #2#3 = aCliDes;
     #2#4 = #2#4 + #71#5;

     |GRABA 020#2a;
     |LIBERA #2;
|FPRC;

|DEFBUCLE Albaranes;
     #10#4;
     ;
     "     ", #0#2, 000001;
     "zzzzz", #0#3, 999999;
     ;
     NULL, NULL, Albaranes;
|FIN;

|PROCESO Tmp2;
     aCodigo = #2#0; |QBF aCodigo;
     aNume = #2#4; |HAZ Decimal; aCanti = aNume;
     aCliLpr = #2#2; |QBF aCliLpr;
     aCliDis = #2#1; |QBF aCliDis;
     aCliDes = #2#3; |QBF aCliDes;

     aAlfa = "!DETALLE" + aFinReg;
     aAlfa = aAlfa + "{COD_ARTICULO}" + aCodigo + "#" + aFinReg;
     aAlfa = aAlfa + "{CAN_VENTAS}" + aCanti + "#" + aFinReg;
     aAlfa = aAlfa + "{VALOR_VENTAS}0#" + aFinReg;
     aAlfa = aAlfa + "{COD_CLIENTE_LPR}" + aCliLpr + "#" + aFinReg;
     aAlfa = aAlfa + "{COD_CLIENTE_DIS}" + aCliDis + "#" + aFinReg;
     aAlfa = aAlfa + "{DES_CLIENTE}" + aCliDes + "#" + aFinReg;
     |XGRABA nHandle, aAlfa;
|FPRC;

|DEFBUCLE Tmp2;
     #2#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Tmp2;
|FIN;

|PROCESO Tipo3; |TIPO 3;
     aFinReg = &13;
     aFinReg = aFinReg + & 10;

     aFecha = #0#0 % 102 + "/" + #0#0 % 402 + "/" + #0#0 % 704;

     aAlfa = "0" + Usuario; |NOME_DAT #20 aAlfa; |DELINDEX #20;
     aAlfa = "1" + Usuario; |NOME_DAT #2 aAlfa; |DELINDEX #2;

     aFic = #0#1; |QBF aFic;
     aFic = aFic + "\ventas";
     |XABRE "CBW", aFic , nHandle;
     |SI FSalida ! 0;
          |MENAV "0000Error al crear el fichero 'ventas'";
     |SINO;
          aAlfa = "!CABECERA" + aFinReg;
          aAlfa = aAlfa + "{FECHA_CIERRE}" + aFecha + "#" + aFinReg;
          aAlfa = aAlfa + "{OBSERVACIONES}#" + aFinReg;
          |XGRABA nHandle, aAlfa;

          |ABRE #19;
          |ABRE #20;
          |ABRE #24;
          |ABRE #2;
          |BUCLE Albaranes;
          |CIERRA #2;
          |CIERRA #24;
          |CIERRA #20;
          |CIERRA #19;

          |BUCLE Tmp2;

          |XCIERRA nHandle;
     |FINSI;

     aFic = #0#1; |QBF aFic;
     aFic = aFic + "\stocks";
     |XABRE "CBW", aFic , nHandle;
     |SI FSalida ! 0;
          |MENAV "0000Error al crear el fichero 'stocks'";
     |SINO;
          aAlfa = "!CABECERA" + aFinReg;
          aAlfa = aAlfa + "{FECHA_CIERRE}" + aFecha + "#" + aFinReg;
          aAlfa = aAlfa + "{OBSERVACIONES}#" + aFinReg;
          |XGRABA nHandle, aAlfa;

          |ABRE #19;
          |BUCLE Temporal;
          |CIERRA #19;

          |XCIERRA nHandle;
     |FINSI;

     |DELINDEX #2;
     |DELINDEX #20;
|FPRC;

|PROCESO Browser; |TIPO 0;
     |SI FSalida ! 10; |ACABA; |FINSI;

     aRuta = "D*.*";

     |BROWSE aRuta;

     aRuta = aRuta % 2; |QBF aRuta;
     |SI aRuta = "D"; aRuta = ""; |FINSI;

     |QBF aRuta;
     |SI aRuta = "";
          |ERROR;
     |SINO;
          #0#1 = aRuta;
          |PINTA #0#1;
     |FINSI;
|FPRC;

|PROCESO Boton1;
     |PTEC 824;
|FPRC;

|PROGRAMA;
     |CLS;
     |CONTROL_SIMPLE 0, "BOTON, Path ficheros", 1106, 1119, Boton1;
     nBoton1 = FSalida;
     |ABRE #0;
     |LEE 101#0p;
     |SI FSalida ! 0; |GRABA 020#0b; |FINSI;
     |PINPA #0#0;
     |PINDA #0#0;
     |ENDATOS #1#0;
     |SI FSalida = 0;
          |GRABA 020#0a;
     |FINSI;
     |CIERRA #0;
     |FIN_CONTROL_WINDOWS nBoton1;
     |PULSATECLA;
|FPRO;
