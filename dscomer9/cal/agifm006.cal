|FICHEROS;
     agifm004;
     agifm006;
     agifa024;
|FIN;

|INCLUYE i_varart;

|VARIABLES;
     aCod = "";
     aCli = "";
     &eaCodigoNum = "";
     aImpreso = "";
     aNifQbf1   = "";
     aNifQbf2   = "";
     aAlfa = "";
     &eaVarDni  = "";
     &enCalcCif = 0;
|FIN;

|PROCESO T7C16; |TIPO 7;
     |C_M #agifm006#16, 1, "S";

     |DBASS aAlfa; |QBF aAlfa;
     aAlfa = aAlfa + "dsarchi/def/dsarm001.mas";
     |XABRE "E", aAlfa, 0;
     |SI FSalida < 0;
         |C_M #agifm006#16, 1, "N"; #agifm006#16 =  "N";  |PINTA #agifm006#16;
     |FINSI;

     aAlfa = #agifm006#6;  |QBF aAlfa;
     |SI aAlfa = "";
         |C_M #agifm006#16, 1, "N"; #agifm006#16 =  "N";  |PINTA #agifm006#16;
     |FINSI;
|FPRC;

|PROCESO cp; |TIPO 0;
     aAlfa = (("00" + #agifm006#11) % -102) + (("000" + #agifm006#12) % -103);
     #agifm006#13 = aAlfa;
|FPRC;

|PROCESO Tipo7; |TIPO 7;
     |SI PARAMETRO = "SELECCIONA";
          |MENSA "0000<F5> Seleccionar contacto";
     |FINSI;
|FPRC;

|PROCESO Tipo11; |TIPO 11;
     |SI FSalida = 13; |Y PARAMETRO = "SELECCIONA";
          enLinea = #agifm006#1;
          |ERROR;
          |PTEC 807;
     |FINSI;
|FPRC;

|PROCESO LDepar; |TIPO 14;
     |DDEFECTO #agifm004;
     |ABRE #agifm004;
     #agifm004#0 = #agifm006#2;
     |LEE 001#agifm004.=;
     |CIERRA #agifm004;
     |PINTA 1240, #agifm004#1;
|FPRC;

|PROCESO CMas506;
     #agifm006#0 = eaCodigoNum;
     #agifm006#1 = 001;
|FPRC;

|PROCESO CMenos506;
    #agifm006#0 = eaCodigoNum;
    #agifm006#1 = 999;
|FPRC;

|PROCESO Contactos;
     |DDEFECTO #agifm004;
     #agifm004#0 = #agifm006#2;
     |LEE 000#agifm004.=;
     |PRINT;
     aImpreso = "S";
|FPRC;

|DEFBUCLE Contactos;
     #agifm006#1;
     ;
     eaCodigoNum, 001;
     eaCodigoNum, 999;
     ;
     NULL, Contactos;
|FIN;

|PROCESO ImprimeCli;
     |ABRE #agifa024;
     #agifa024#0 = eaCodigoNum;
     |LEE 020#agifa024.=;
     |CIERRA #agifa024;

     |HAZ MiraLogos;
     |IMPRE 1;
     |SI FSalida  = 0;
          |INFOR "agifa024";
          |SI FSalida = 0;
               aImpreso = "N";
               |ABRE #agifm004;
               |BUCLE Contactos;
               |CIERRA #agifm004;
               |SI aImpreso = "N";
                    |DDEFECTO #agifm004; |DDEFECTO #agifm006;
                    eaSerLog = "";
                    eaNumLog = #agifa024#0;
                    eaTipLog = "CL";
                    |HAZ ImprimeLog;

                    |PRINT;
               |FINSI;
               |PIEINF;
               |FININF;
          |FINSI;
          |FINIMP;
     |FINSI;
|FPRC;

|PROCESO Alta;
     |ABRE #agifm006;
     |C_M #agifm006#1, 1, "N";
     |DDEFECTO #agifm006;
     #agifm006#0 = aCli;
     #agifm006#1 = aCod;
     |GRABA 020#agifm006.b;
     |SI FSalida = 0;
          |PINPA #0#agifm006;
          |PINDA #0#agifm006;
          |ENDATOS #1#agifm006;
          |SI FSalida = 0;
               |GRABA 020#agifm006.a;
               enError = 0;
          |SINO;
               |BORRA 020#agifm006.c;
               enError = 1;
          |FINSI;
     |FINSI;
     |CIERRA #agifm006;
|FPRC;

|PROCESO LetraNif; |TIPO 6;
     eaPais = ""

     |SI FSalida = 9;
          eaVarDni  = #agifm006#Campo#;
          |HAZ CalculoNIFCIF;
          #agifm006#Campo# = eaVarDni;
          |PINTA #agifm006#Campo#;
          |ERROR; |ACABA;
     |FINSI;

     eaVarDni  = #agifm006#Campo#;
     |HAZ CalculoNIFCIF;
     |SI FSalida = 9;
          eaVarDni  = #agifm006#Campo#;
          |HAZ CalculoNIFCIF;
          #agifm006#Campo# = eaVarDni;
          |PINTA #agifm006#Campo#;
          |ERROR; |ACABA;
     |FINSI;

     eaVarDni  = #agifm006#Campo#;
     |HAZ CalculoNIFCIF;

     aNifQbf1 = #agifm006#Campo#;   |QBF aNifQbf1;
     aNifQbf2 = eaVarDni;  |QBF aNifQbf2;

     |SI aNifQbf1 ! aNifQbf2; |Y aNifQbf1 ! "";
          aAlfa = "0000NEl NIF puede ser erróneo."+&13+"¿Desea calcularlo?";
          |CONFI aAlfa;
          |SI FSalida = 0;
               #agifm006#Campo# = eaVarDni; |PINTA #agifm006#Campo#;
          |FINSI;
     |FINSI;
|FPRC;

|PROGRAMA;
     |SI PARAMETRO = "imprime_cli";
          |HAZ ImprimeCli;
          |ACABA;
     |FINSI;

     aAlfa = PARAMETRO % 104;
     |SI aAlfa = "ALTA";
          aCli =  PARAMETRO % 506;
          aCod = PARAMETRO % 1103;
          |HAZ Alta;
          |ACABA;
     |FINSI;

     |PINPA #0#agifm006;
     |ENTLINEAL #1#agifm006, -2, 2, 22, 0, CMas506, CMenos506;
|FPRO;
