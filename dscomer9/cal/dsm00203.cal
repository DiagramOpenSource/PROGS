|FICHEROS;
dsm00203 #0;
dsm00200 #1;
dsm00204 #3;
|FIN;

|VARIABLES;
     &Tempo = "";
     aTmp0 = "";
     &qFichero = "";
     ip_serv = "";
     serv_correo = "";
     from = "";
     to = "";
     subject = "";
     mensaje = "";
     ficheros = "";
     prim = 0;
     param = "";
|FIN;

|PROCESO para_lin;
|SI #0#2 = "*";
     |SI prim = 0;
          to = #0#3;
          |QBF to;
          prim = 1;
     |SINO;
          to = to + ";" + #0#3;
          |QBF subject;
     |FINSI;
|FINSI;
|FPRC;

|DEFBUCLE para;
#0#1;
;
INICIO;
FINAL;
be;
NULL,para_lin;
|FIN;


|PROCESO leedeleg;
#0#0 = #3#0;
#0#1 = #3#2;
#0#3 = #3#3;
|GRABA 010#0c;
|FPRC;

|DEFBUCLE leedel;
     #3#1;
     ;
     INICIO;
     FINAL;
     be;
     NULL,leedeleg;
|FIN;

/*
|PROCESO lee_tpv;
#0#0 = #2#0;
#0#1 = #2#2;
#0#3 = #2#3;
|GRABA 010#0c;
|FPRC;

|DEFBUCLE leetpv;
#2#1;
;
INICIO;
FINAL;
be;
NULL,lee_tpv;
|FIN;
*/

|RUTINA pro1;
     #0#0 = 0;
|FRUT;

|RUTINA pro2;
     #0#0 = 99999;
|FRUT;

|PROGRAMA;
     |HAZ CreaTempo; aTmp0 = Tempo;
     |NOME_DAT #0 aTmp0; |DELINDEX #0;

     |CLS;
     |ABRE #0;
     param = PARAMETRO;
     |SI param = "moddel";
          |BUCLE leedel;
          ficheros = qFichero;
     |SINO;
        ||  |BUCLE leetpv;
     |FINSI;
     |ENTLINEAL #1#0 , -1 , 4 , 17 , 1 , pro1 , pro2;
     |CIERRA #0;
     |CONFI "0000SEsta seguro de que desea enviar los datos ";
     |SI FSalida = 0;
          |ABRE #0;
          |ABRE #1;
          |LEE 010#1p;
          |SI FSalida ! 0;
               |MENAV "0000No se han establecido los parametros de envio";
          |SINO;
               ip_serv = "";
               |SI #1#1 = 0;|Y #1#2 = 0;|Y #1#3 = 0;|Y #1#4 = 0;
                    |IP_LOCAL ip_serv;
               |SINO;
                    ip_serv = #1#1+"."+#1#2+"."+#1#3+"."+#1#4;
               |FINSI;
               serv_correo = #1#5;
               from = #1#6;
               prim = 0;
               |BUCLE para;
               subject = #1#8;
               mensaje = #1#9;
               |QBT ip_serv ;
               |QBF serv_correo;
               |QBF from;
               |QBF to;
               |QBF subject;
               |QBF mensaje;
               |QBF ficheros;
               |MENSA "0000Enviando fichero ...";
               |DSCORREO_ENVIA ip_serv,serv_correo,from,to,subject,mensaje,ficheros;
               |SI FSalida ! 0;
                    |MENAV "0000Ha habido un error durante el envio.";
               |SINO;
                    |MENSA "0000Mensaje enviado."
               |FINSI;
          |FINSI;
          |CIERRA #1;
          |CIERRA #0;
     |FINSI;
     Tempo = aTmp0; |HAZ BoraTempo; |DELINDEX #0;
|FPRO;

|PROCESO tipo11; |TIPO 11;
 |SI FSalida = 11;
   |SI #0#2 = "*";
     #0#2 = "";
   |SINO;
     #0#2 = "*";
   |FINSI;
   |PINTA #0#2;
   |GRABA 121#0a;
   |LIBERA #0;
 |FINSI;
|FPRC;
