|FICHEROS;
     dsm00036 #0;
     dsm00037 #1;

     agifa019 #2;
     agifa017 #17;
     dsm00024 #24;

     dsm00034 #10;
     dsm00035 #11;
     dsm00023 #23;
     agifa142 #142;
     dsm00238 #238;
|FIN;

|VARIABLES;
     aPartiAnt = ""
     aModiPar = "N";
     aModiUni = "M";
     nAntUni1 = 0;
     nAntUni2 = 0;
     nAntPre = 0;
     nTotaUni = 0;
     nForma = 0;
     nModo = 0;
     aAlfa = "";
     nCodigo = 0;
     nSw = 0;
     nNume = 0;
     nPos = 0;
     nTipo = 0;
|FIN;

|INCLUYE i_varart;

|PROCESO ModiArti; |TIPO 7;
     nModo = (FEntrada / 100) !0;
     |C_M #0#4, 1, "S";
     |SI nModo = 2;
          |C_M #0#4, 1, "N";
     |FINSI;
|FPRC;

|PROCESO Fecha; |TIPO 0;
     aModiPar = "N";
|FPRC;

|PROCESO LeeArti; |TIPO 0;
     |ABRE #2;
     #2#0 = #0#4;
     |LEE 000#2=;
     |CIERRA #2;
     |SI #2#180 = "S";   ||Control Partidas
          |C_M #0#6, 1, "S";
          |MODO_RELACION #0, 1, "dsm00024", "S", "S";
     |SINO;
          |C_M #0#6, 1, "N";
          |MODO_RELACION #0, 1, "dsm00024", "N", "N";
     |FINSI;
     |HAZ Tipo13;
|FPRC;

|PROCESO AlEntrar; |TIPO 7;
     nModo = (FEntrada/100) ! 0;
     |SI nModo = 1;
          |LEE 001#0u;
          |SI FSalida = 0;
             nCodigo = #0#0+1;
             |DDEFECTO #0;
             #0#0 = nCodigo;
             |PINTA #0#0;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO defecto;
     nModo = (FEntrada/100) ! 0;
     |ABRE #10;
     |SI #0#1 ! 0;
          #10#0 = #0#1;
          |LEE 020#10=;
          |SI FSalida ! 0;
               |ERROR;
               |ACABA;
          |SINO;
               #0#33 = #10#1;
               |PINTA #0#33;
          |FINSI;
          |SI nModo = 1;
            #0#4 = #10#2;
            #0#5 = #10#3;
            #0#32 = #10#4;
            #0#34 = #10#5;
            |PINTA #0#4;
            |PINTA #0#5;
            |PINTA #0#32;
            |PINTA #0#34;
          |FINSI;
     |FINSI;
     |CIERRA #10;
|FPRC;

|PROCESO partida7; |TIPO 7;
     aPartiAnt = #0#6;
     |ABRE #2;
     #2#0 = #0#4;
     |LEE 000#2=;
     |CIERRA #2;

     |SI #2#180 = "N";
          |C_M #0#6,1,"N";
     |SINO;
          |C_M #0#6,1,"S";
     |FINSI;
|FPRC;

|PROCESO partida6; |TIPO 6;
     |C_M #0#6, 0, aAlfa;
     |SI #142#122 = "S"; |Y aAlfa = "S";
          aAlfa = #0#6; |QBF aAlfa;
          aAlfa = (#142#121 * #142#120) + aAlfa;
          nNume = -(#142#120 + 100);
          #0#6 = aAlfa % nNume;
          |PINTA #0#6;
     |FINSI;
|FPRC;


|PROCESO partida0; |TIPO 0;
     nModo = (FEntrada/100) ! 0;

     |SI #0#6 ! aPartiAnt; |Y nModo = 2;
          |CONFI "0000풫odificar la partida de las lineas?";
          |SI FSalida = 0; aModiPar = "S"; |FINSI;
     |FINSI;

     |C_M #0#6, 0, aAlfa;
     |SI nModo ! 1; |O aAlfa = "N"; |ACABA; |FINSI;

     |ABRE #24;
     #24#0 = #0#4;
     #24#1 = #0#5;
     #24#2 = #0#6;
     |LEE 020#24=;
     |CIERRA #24;

     ||#0#7 = #24#22;
     ||#0#8 = #24#23;
     ||#0#9 = #24#24/#24#23;
     #0#27 = #24#15;
     |PINTA #0#7;
     |PINTA #0#8;
     |PINTA #0#9;
     |PINTA #0#27;
|FPRC;

|PROCESO Importe; |TIPO 0;
     |HAZ Tipo13;
     |C_V #0#7, 0, aAlfa;
     |SI aAlfa = "S";
          |PINTA #0#7;
          #0#10 = #0#7 * #0#9;
     |SINO;
          |PINTA #0#8;
          #0#10 = #0#8 * #0#9;
     |FINSI;
     |PINTA #0#10;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴횮REACION DE LINEAS 컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO UnidMerma;
     |ABRE #2;
     #2#0 = #1#3;
     |LEE 000#2=;
     |CIERRA #2;
     |SI #2#179 ! "S"; |ACABA; |FINSI;
     |SI #2#180 ! "S"; |ACABA; |FINSI;

     |SI #23#4 = "SC";
          #1#17 = 0;
     |FINSI;
     |SI #23#4 = "DF";
          #1#17 = #1#10 * #24#7
     |FINSI;
     |SI #23#4 = "ME";
          #1#17 = #1#16 * 2 / 100;
     |FINSI;
     |SI #2#181 = "N";
          #1#17 = 0;
     |FINSI;
|FPRC;

|PROCESO calculos;
     |ABRE #2;
     #2#0 = #1#3;
     |LEE 020#2=;
     |CIERRA #2;
|FPRC;

|DEFBUCLE calculos;
     #1#1;
     ;
     #0#0,1;
     #0#0,999;
     ;
     NULL,calculos;
|FIN;

|PROCESO PonLineas;
     |DDEFECTO #1;
     #1#0 = #0#0;
     #1#1 = #11#1;
     #1#2 = #11#4;
     #1#3 = #11#2;
     #1#4 = #11#5;
     #1#5 = #0#6;
     #1#6 = #11#3;
     #1#13 = #11#9;

     |HAZ LeeTipo;

     |ABRE #2;
     #2#0 = #1#3;
     |LEE 000#2=;
     |CIERRA #2;

     #1#15 = #2#18;

     #1#10 = #0#7# * #11#10 / #10#6;
     #1#16 = #0#8# * #11#13 / #10#7;

     |SI #142#118 = "S"; |Y #2#180 = "S";    || Con partida
          |DDEFECTO #24;
          #24#0 = #1#3;
          #24#1 = #1#4;
          #24#2 = #1#5;
          |LEE 000#24=;
          |SI FSalida ! 0; |GRABA 020#24n; |FINSI;
     |FINSI;
     |HAZ TotalLinea;
     |GRABA 020#1n;
|FPRC;

|PROCESO ModiFica;
     |ABRE #2;
     #2#0 = #1#3;
     |LEE 000#2=;
     |CIERRA #2;

     |SI aModiUni = "S";
          #1#10 = #0#7# * #11#10 / #10#6;
          #1#16 = #0#8# * #11#13 / #10#7;
          |HAZ TotalLinea;
          |GRABA 020#1a;
     |FINSI;
     |SI aModiPar = "S"; |Y #142#118 = "S"; |Y #2#180 = "S";    || Con partida
          #1#5 = #0#6;
          |GRABA 020#1a;

          |DDEFECTO #24;
          #24#0 = #1#3;
          #24#1 = #1#4;
          #24#2 = #1#5;
          |LEE 000#24=;
          |SI FSalida ! 0; |GRABA 020#24n; |FINSI;
     |FINSI;
     |LIBERA #1;
|FPRC;

|DEFBUCLE ModiFica;
     #1#2;
     ;
     #0#0, #11#2;
     #0#0, #11#2;
     be;
     NULL, ModiFica;
|FIN;

|PROCESO ModiLineas;
     |BUCLE ModiFica;
|FPRC;

|PROCESO Tipo5; |TIPO 5;        ||Llamado del campo linea
     nModo = (FEntrada / 100) ! 0;

     |SI nModo = 1; |O nModo = 2;
          |ABRE #10;
          #10#0 = #0#1;
          |LEE 020#10=;
          |SI FSalida = 0;
               |ABRE #24;
               |SI nModo = 1;
                    |BUCLELIN 2PonLineas#10;
               |SINO;
                    aModiUni = "N";
                    |SI nAntUni1 ! #0#7; |O nAntUni2 ! #0#8; |O nAntPre ! #0#9;
                         aModiUni = "S";
                    |FINSI;
                    |SI aModiUni = "S"; |O aModiPar = "S";
                         |BUCLELIN 2ModiLineas#10;
                    |FINSI;
               |FINSI;
               |CIERRA #24;
               |HAZ Totales;
          |FINSI;
          |CIERRA #10;
     |FINSI;
|FPRC;

|PROCESO Tipo2Cab; |TIPO 2;
     nForma = 0 +. 1;
     |SI nForma = -1;
          nAntUni1 = #0#7;
          nAntUni2 = #0#8;
          nAntPre = #0#9;
     |FINSI;

     |SI #0#3 = "S";
          |SI nForma = -1;
               |MENAV "0000Orden Finalizada....";
          |FINSI;
          |ERROR; |ACABA;
     |SINO;
          |HAZ StockPro;
     |FINSI;
|FPRC;

|PROCESO Tipo8; |TIPO 8;
     |ABRE #142; |LEE 000#142p; |CIERRA #142;

     |ABRE #23;
     #23#0 = "S1";
     |LEE 000#23=;
     |SI FSalida ! 0;
          |MENAV "0000Proceso no configurado...";
          |PTEC 807;
     |FINSI;
     |CIERRA #23;
|FPRC;

|PROCESO StockProLin;
     #2#0 = #1#3;
     |LEE 121#2=;
     |SI FSalida = 0;
          |SI #1#2 = "P";
               #2#13 = #2#13 + (#1#10 * nForma);
          |SINO;    || A, O, M
               #2#12 = #2#12 + (#1#10 * nForma);
               #2#104 = #2#104 - (#1#10 * nForma);
               #2#193 = #2#193 - (#1#16 * nForma);
          |FINSI;

          #17#0 = #1#3;
          #17#1 = #1#4;
          |LEE 121#17=;
          |SI FSalida = 0;
               |SI #1#2 = "P";
                    #17#9 = #17#9 + (#1#10 * nForma);
               |SINO;    || A, O, M
                    #17#8 = #17#8 + (#1#10 * nForma);
                    #17#39 = #17#39 - (#1#10 * nForma);
                    #17#48 = #17#48 - (#1#16 * nForma);
               |FINSI;
               |HAZ ValoraStock;
               |GRABA 020#17a;
               |LIBERA #17;
          |FINSI;
          |GRABA 020#2a;
          |LIBERA #2;
     |FINSI;
|FPRC;

|PROCESO StockPro;
     |ABRE #142; |LEE 000#142p; |CIERRA #142;
     |ABRE #2;
     |ABRE #17;
     |ABRE #24;

     #2#0 = #0#4;
     |LEE 121#2=;
     |SI FSalida = 0;
          #2#12 = #2#12 + (#0#7 * nForma);
          #2#104 = #2#104 - (#0#7 * nForma);
          #2#193 = #2#193 - (#0#8 * nForma);

          #17#0 = #0#4;
          #17#1 = #0#5;
          |LEE 121#17=;
          |SI FSalida = 0;
               #17#8 = #17#8 + (#0#7 * nForma);
               #17#39 = #17#39 - (#0#7 * nForma);
               #17#48 = #17#48 - (#0#8 * nForma);
               |GRABA 020#17a;
               |LIBERA #17;

               |SI #142#118 = "S"; |Y #2#180 = "S";
                    #24#0 = #0#4;
                    #24#1 = #0#5;
                    #24#2 = #0#6;
                    |LEE 121#24=;
                    |SI FSalida = 0;
                         #24#43 = #24#43 + (#0#7 * nForma);
                         #24#44 = #24#44 + (#0#8 * nForma);
                         |HAZ ValoraStock;
                         |GRABA 020#24a;
                         |LIBERA #24;
                    |FINSI;
               |FINSI;
          |FINSI;
          |HAZ ValoraStock;
          |GRABA 020#2a;
          |LIBERA #2;
     |FINSI;

     |BUCLELIN 2 StockProLin #0;
     |CIERRA #24;
     |CIERRA #17;
     |CIERRA #2;
|FPRC;

|PROCESO Tipo13; |TIPO 13;
     |C_P #0#8, 0, nPos;
     |C_P #0#7, 1, nPos;

     |ATRI R; |PINTA 744, "        KILOS"; |ATRI 0;
     |ABRE #2;
     #2#0 = #0#4;
     |LEE 000#2=;
     |SI FSalida = 0; |Y #2#179 = "S";
          |DDEFECTO #238;
          |ABRE #238;
          #238#0 = #2#201;
          |LEE 000#238=;
          |SI FSalida = 0;
               aAlfa = #238#2; |QBT aAlfa;
               aAlfa = ("             " + aAlfa) % -113;
               |ATRI R; |PINTA 744, aAlfa; |ATRI 0;
          |FINSI;
          |CIERRA #238;
          |SI #238#6 = 1;
               |C_V #0#7, 1, "S";
               |C_V #0#8, 1, "N";
          |SINO;
               |C_V #0#7, 1, "N";
               |C_V #0#8, 1, "S";
          |FINSI;
     |SINO;
          |C_V #0#7, 1, "S";
          |C_V #0#8, 1, "N";
     |FINSI;
     |CIERRA #2;
|FPRC;

|PROCESO CalTotal;
     |SI nSw  = 0;
          |SI #1#2 = "M";
               |SI nTipo = 1;
                    #0#14 = #0#14 + #1#10;
                    #0#16 = #0#16 + #1#12;
               |SINO;
                    #0#14 = #0#14 + #1#16;
                    #0#16 = #0#16 + (#1#16 * #1#15);
               |FINSI;
          |FINSI;
          |SI #1#2 = "A";
               #0#21 = #0#21 + #1#15;
               #0#22 = #0#22 + #1#12;
          |FINSI;
          |SI #1#2 = "O";
               #0#23 = #0#23 + #1#15;
               #0#24 = #0#24 + #1#12;
          |FINSI;

          |SI nTipo = 1;
               #0#17 = #0#7 - #0#14;
               #0#15 = #0#7 - #0#17;
          |SINO;
               #0#17 = #0#8 - #0#14;
               #0#15 = #0#8 - #0#17;
          |FINSI;

          #0#20 = #0#10 + #0#16;
          #0#19 = #0#20 / #0#17;
          #0#25 = #0#19 + #0#21 + #0#23;
          #0#26 = #0#20 + #0#22 + #0#24;
     |SINO;
          |SI #1#2 = "P";
               #1#11 = #0#25; || Valor Unitario
          |FINSI;
          |HAZ TotalLinea;
     |FINSI;
     |GRABA 020#1a;
     |LIBERA #1;
|FPRC;

|DEFBUCLE CalTotal;
     #1#1;
     ;
     #0#0, 001;
     #0#0, 999;
     be;
     NULL, CalTotal;
|FIN;

|PROCESO LeeTipo;
     |ABRE #2;
     #2#0 = #0#4;
     |LEE 000#2=;
     |CIERRA #2;

     nTipo = 1;
     |SI #2#179 = "S";
          |DDEFECTO #238;
          |ABRE #238;
          #238#0 = #2#201;
          |LEE 000#238=;
          |SI FSalida = 0;  nTipo = #238#6; |FINSI;
          |CIERRA #238;
     |FINSI;
|FPRC;

|PROCESO Totales;
     |HAZ Importe;
     #0#14 = 0; #0#15 = 0; #0#17 = 0;
     #0#19 = 0; #0#21 = 0; #0#23 = 0; #0#25 = 0;
     #0#16 = 0; #0#20 = 0; #0#22 = 0; #0#24 = 0; #0#26 = 0;
     |GRABA 000#1a;
     |SALVA_FICHA #1;
     |HAZ LeeTipo;
     nSw = 0;
     |BUCLE CalTotal;
     nSw = 1;
     |BUCLE CalTotal;
     |REPON_FICHA #1;
     |LEE 000#1=;
     |PINDA #0#0;
     nSw = 0;
|FPRC;

|PROCESO TotalLin; |TIPO 0;
     |HAZ LeeTipo;
     |HAZ TotalLinea;
|FPRC;

|PROCESO TotalLinea;
     |ABRE #2;
     #2#0 = #1#3;
     |LEE 000#2=;
     |CIERRA #2;

     |SI nTipo = 1; |O #2#179 = "N";
          |SI #1#2 = "P";
               #1#12 = #1#11 *  #1#10;
          |SINO;
               #1#12 = #1#15 * #1#10;
          |FINSI;
     |SINO;
          |SI #1#2 = "P";
               #1#12 = #1#11 *  #1#16;
          |SINO;
               #1#12 = #1#15 * #1#16;
          |FINSI;
     |FINSI;
     |SI nSw = 0;
          |PINTA #1#12;
     |FINSI;
|FPRC;

|PROCESO Tipo2Lin; |TIPO 2;
     nForma = 0 +. 1;
     |SI nForma = 1;
          |HAZ Totales;
     |FINSI;
|FPRC;

|PROCESO DobleUni36; |TIPO 7;
     |C_M #0#7, 1, "S";
     eaProgVta = "dsm00036";
     |HAZ DobleUniF;
     |SI eaSw2Stock = "S";
          |C_M #0#7, 1, "N";
     |FINSI;
     |HAZ Importe;
|FPRC;

|PROCESO TotaUni;
     |SI nTipo = 1;
          nTotaUni = nTotaUni + #1#10;
     |SINO;
          nTotaUni = nTotaUni + #1#16;
     |FINSI;
|FPRC;

|DEFBUCLE TotaUni;
     #1#1;
     2;
     #0#0, 001, "P";
     #0#0, 999, "P";
     ;
     NULL, TotaUni;
|FIN;

|PROCESO Final; |TIPO 3;
     nTotaUni = 0;
     |HAZ LeeTipo;
     |BUCLE TotaUni;
     |SI #0#17 ! nTotaUni;
          aAlfa = "0000Los totales de productos obtenidos:" + nTotaUni + ", son distintos al neto:" + #0#17;
          |MENAV aAlfa;
     |FINSI;
|FPRC;
