|FICHEROS;
     visem013 #13;
|FIN;

|VARIABLES;
     &ser_ped = "";
     &num_ped = 0;
     &eaImpresora = "";
     aNomFic = "";
     aPDF = "";
     aIP = "";
     {1}aLocal = "";
     aServidor = "";
     aFrom = "";
     aTo = "";
     aSubject = "";
     aMensaje = "";
     aDjunto = "";
     aMail = "";
     aFic = "";
     aAlfa = "";
     i = 0;
|FIN;

|PROCESO Correo;
     aIP = "xdscorreo.dv.diagram.net";
     aServidor = "asmtp.diagram.es";
     aFrom = aMail;
     aTo = aMail;
     aSubject = "Pedido de compras " + aNomFic;
     aMensaje = aSubject;
     aDjunto = aFic;
     |DSCORREO_ENVIA aIP, aServidor, aFrom, aTo, aSubject, aMensaje, aDjunto;
     |SI FSalida < 0;
          aAlfa = "0000Error al enviar correo...";
          |MENAV aAlfa;
     |FINSI;
     |FBORRA aFic;
|FPRC;

|PROGRAMA;
     |ABRE #13; |LEE 000#13p; |CIERRA #13;

     aNomFic = ser_ped + (("000000" + num_ped)) % -106; |QBT aNomFic;
     aIP = ""; |IP_REMOTO aIP;
     |SI aIP = "";
          |DFICE aPDF; aPDF = aPDF + aNomFic + ".pdf";
          |FBORRA aPDF;
     |SINO;
          |ESPECIFICA "RBASS", aLocal;
          aPDF = aLocal;
          aPDF = aPDF + aNomFic + ".pdf";
          |RFBORRA aPDF;
     |FINSI;

     eaImpresora = "CrystalReport;" + aPDF;
     |SUB_EJECUTA_NP "agifa100";
     eaImpresora = "";

     |SI aIP ! "";
          |DFICE aFic; aFic = aFic + aNomFic + ".pdf";
          |RECIBE_FICHERO aPDF, aFic;
          |SI FSalida ! 0;
               |MENAV "0000Error al copiar fichero al servidor...";
               |ERROR;
          |FINSI;
          |RFBORRA aPDF;
     |SINO;
          aFic = aPDF;
     |FINSI;

     |PARA i = 2; |SI i [ 7; |HACIENDO i = i + 1;
          aMail = #13i; |QBF aMail;
          |SI aMail ! ""; |HAZ Correo; |FINSI;
     |SIGUE;
|FPRO;
