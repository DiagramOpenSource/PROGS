|FICHEROS;
     dsz99971 #0,MANTE;
     goparame #1;
     gopre001 #10;
     gopre002 #2;
     gopre003 #3;
     agifa007 #7;
     gopre021 #21;
     agifa081 #81; ||Ped
     agifa067 #67;
     agifa077 #77; ||Alb
     agifa080 #80;
     guerm024 #24;
     guerz008 #18;
     guerz009 #19;
     gocerc09 #9;   || Tmp Agrupaciones
|FIN;

|VARIABLES;
     &enAgrupa = 0;
     nLin = 0;
     &enForma  = 1;
     &eaDocu   = "";
     &Tempo    = "";
     &enSwMenu = 0;

     &eaSerPre = "";
     &enNumPre = 0;
     &eaCapi   = "";
     &eaParti  = "";
     &eaDesPa  = "";
     &eaDesCa  = "";

     aTempo18  = "";
     aTempo19  = "";
     i         = 0;
     aSer      = "";
     nHay      = 0;
     nPend     = 0;
     nNum      = 0;
     nConta    = 0;
     aAlfa     = "";
     nModo     = 0;
     nGrupoAnt = 0;
|FIN;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO CabeceraPed;
     #81#25 = #0#4;
     #81#0 = 999999;
     |LEE 000#81];
     |SI FSalida = 0;
          |LEE 000#81a;
     |SINO;
          |LEE 000#81u;
     |FINSI;
     |SI FSalida = 0; |Y #81#25 = #0#4;
          nConta = #81#0 + 1;
     |SINO;
          nConta = 1;
     |FINSI;
     |SI nConta < 500000;
          nConta = 500000;
     |FINSI;

     #81#0 = #0#5;
     |LEE 020#81=;

     #81#0 = nConta;
     #81#24 = 0;
     |GRABA 020#81b;
|FPRC;

|PROCESO LineasPed;
     #67#28 = #0#4;
     #67#0 = #0#5;
     #67#1 = #0#6;
     |LEE 020#67=;
     |SI FSalida = 0;
          #67#0 = nConta;
          #67#12 = 0;
          #67#5 = #67#37;
          #67#38 = 0;

          #67#44 = 0;
          #67#41 = #67#45;
          #67#46 = 0;
          |GRABA 020#67n;
     |FINSI;
     enForma = 1;
     eaDocu = "agifa067";
     |HAZ StockEntra;
|FPRC;

|PROCESO Temporal;
     |SI aSer ! #0#4; |O nNum ! #0#5;
          nHay = 0;
     |FINSI;

     |SI nHay = 0;
          nHay = 1;
          |HAZ CabeceraPed;
     |FINSI;

     |HAZ LineasPed;

     aSer = #0#4;
     nNum = #0#5;
|FPRC;

|DEFBUCLE Temporal;
     #0#2;
     2;
     "     ", 00000, "*";
     "zzzzz", 99999, "*";
     ;
     NULL, Temporal;
|FIN;

|PROCESO MarcaArti; |TIPO 0;
     |SI FSalida = 0; |Y #0Campo = Contenido;
          |SI #0#2 = "*";
               #0#2 = "";
          |SINO;
               #0#2 = "*";
          |FINSI;
          |GRABA 020#0a;
          |PINTA #0#2;
     |FINSI;
|FPRC;

|PROCESO LinAlb;
     #67#28 = #80#29;
     #67#0 = #80#12;
     #67#1 = #80#21;
     |LEE 000#67=;
     |SI FSalida = 0;
          nPend = #67#5 - #67#38;
          |SI nPend = 0;
               #0#0 = #67#2;
               #0#1 = #67#4;
               #0#2 = "*";
               #0#3 = #67#37;
               #0#4 = #67#28;
               #0#5 = #67#0;
               #0#6 = #67#1;
               |GRABA 000#0n;
               nHay = 1;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Min0;
     #0#0 = "                    ";
|FPRC;

|PROCESO Max0;
     #0#0 = "zzzzzzzzzzzzzzzzzzzz";
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴

|PROCESO GuerAdjPed;
     |HAZ CreaTempo;|NOME_DAT #0 Tempo; |DELINDEX #0;

     nHay = 0;
     |ABRE #67;
     |ABRE #0;
     |BUCLELIN 2 LinAlb #77;
     |CIERRA #0;
     |CIERRA #67;

     |SI nHay ! 0;
          |PUSHV 0501 2380;
          |ENTLINEAL #1#0, -1, 4, 22, 1, Min0, Max0;
          |POPV;

          |ABRE #81;
          |ABRE #67;
          nHay = 0;
          |BUCLE Temporal;
          |SI nHay ! 0;
               |HAZ CalCabAgifa081;
          |FINSI;
          |CIERRA #67;
          |CIERRA #81;
     |FINSI;

     |DELINDEX #0; |HAZ BoraTempo;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO GuerImpPed;
     |ABRE #24;
     #24#0 = #67#2;
     #24#1 = #81#4;
     |LEE 000#24=;
     |SI FSalida = 0;
          #67#2 = #24#3;
          #67#4 = #24#4;
     |FINSI;
     |CIERRA #24;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO Llena19;
     |PARA i = 0; |SI i [ 24; |HACIENDO i = i + 1;
          #19i = #3i;
     |SIGUE;
     nLin = nLin + 1;
     #19#3 = nLin;
     |GRABA 020#19n;
|FPRC;

|PROCESO Llena18;
     |PARA i = 0; |SI i [ 13; |HACIENDO i = i + 1;
          #18i = #2i;
     |SIGUE;
     nLin = nLin +  1;
     #18#2 = nLin;
     |GRABA 020#18n;
|FPRC;

|DEFBUCLE Llena19;
     #3#1;
     ;
     eaSerPre, enNumPre, eaCapi, 001;
     eaSerPre, enNumPre, eaCapi, 999;
     ;
     NULL, Llena19;
|FIN;

|DEFBUCLE Llena18;
     #2#1;
     14;
     eaSerPre, enNumPre, 001, enAgrupa;
     eaSerPre, enNumPre, 999, enAgrupa;
     ;
     NULL, Llena18;
|FIN;

|PROCESO GuerPartid;
     nModo = (FEntrada / 100) ! 0;
     |QBF eaCapi;
     |SI nModo = 1; FSalida = 10; |FINSI;
     |SI eaCapi = ""; FSalida = 10; |FINSI;

     |SI FSalida ! 10;
          |ABRE #3;
          |SELECT #2#3;
          #3#0 = eaSerPre;
          #3#1 = enNumPre;
          #3#2 = eaCapi;
          #3#4 = eaParti;
          |LEE 000#3=;
          |SI FSalida ! 0;
               aAlfa = "0000NO EXISTE" + &13;
               aAlfa = aAlfa + "Presupuesto:" + #3#0 + "-" + #3#1 + &13;
               aAlfa = aAlfa + "Capitulo:" + #3#2;
               aAlfa = aAlfa + " Partida:" + #3#4;
               |MENAV aAlfa;
               |ERROR;
          |SINO;
               eaDesPa = #3#5;
          |FINSI;
          |CIERRA #3;
          |ACABA;
     |FINSI;

     |ABRE #10;
     #10#0 = eaSerPre;
     #10#1 = enNumPre;
     |LEE 000#10=;
     |SI FSalida = 0;
          |HAZ CreaTempo; aTempo18 = Tempo; |NOME_DAT #18 aTempo18; |DELINDEX #18;
          |HAZ CreaTempo; aTempo19 = Tempo; |NOME_DAT #19 aTempo19; |DELINDEX #19;

          |HAZ MuestraAgrupa;
          |SI enAgrupa = -1;
               eaParti = ""; |ERROR;
          |SINO;
               |SI enAgrupa > 0; |O #10#49 = "N";
                    nLin = 0;
                    |ABRE #18;
                    |BUCLE Llena18;
                    |SELECT #2#18;
                    #18#0 = eaSerPre;
                    #18#1 = enNumPre;
                    #18#12 = eaCapi;
                    |LEE 000#18];
                    |SELECT #1#18;
                    |CONSULTA_CLAVE #1#18;
                    |SI FSalida = 0;
                         eaCapi = #18#12;
                         eaDesCa = #18#13;
                    |FINSI;
                    |CIERRA #18;
               |FINSI;
               |SI eaCapi = "";
                    eaParti = ""; |ERROR;
               |SINO;
                    nLin = 0;
                    |ABRE #19;
                    |BUCLE Llena19;
                    |SELECT #2#19;
                    #19#0 = eaSerPre;
                    #19#1 = enNumPre;
                    #19#2 = eaCapi;
                    #19#4 = eaParti;
                    |LEE 000#19];
                    |SELECT #1#19;
                    |CONSULTA_CLAVE #1#19;
                    |SI FSalida = 0;
                         eaParti = #19#4;
                         eaDesPa = #19#5;
                    |SINO;
                         |ERROR;
                    |FINSI;
                    |CIERRA #19;
               |FINSI;
          |FINSI;
          |DELINDEX #18; Tempo = aTempo18; |HAZ BoraTempo;
          |DELINDEX #19; Tempo = aTempo19; |HAZ BoraTempo;
     |SINO;
          aAlfa = "0000Presupuesto inexistente: " + #10#0 + "-" + (("000000" + #10#1) % -106);
          |MENAV aAlfa;
          |ERROR;
     |FINSI;
     |CIERRA #10;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|VARIABLES;
     &efFecha  = @;
     nEsta     = 0;
|FIN;

|FICHEROS;
     gopre014 #14;
|FIN;

|PROCESO EstaCerrado; || Retorna FSalida = 0 si esta cerrado
     nModo = (FEntrada / 100) ! 0;
     nEsta = 1;
     |SI nModo ! 4;
          |ABRE #14;
          |LEE 000#14p;
          |SI FSalida = 0; |Y #14#1 ! "01.01.0000";
               |SI efFecha [ #14#1;
                    |AVISO;
                    nEsta = 0;
                    aAlfa = "0000NCERRADO " + #14#1 + "."+&13+&13+"CONTINUAR:";
                    |CONFI aAlfa;
                    |SI FSalida = 0;
                         |BLIN 24;
                         |ATRI S;
                         |PINTA 2420, "Entre la Clave...:";
                         |ATRI 0;
                         E_sup = 10;
                         E_inf = "";
                         aAlfa = 2439 ? -1;
                         |BLIN 24;
                         |SI aAlfa ! #14#2;
                              |MENAV "0000ERROR. Clave incorrecta";
                         |SINO;
                              nEsta = 1;
                         |FINSI;
                    |FINSI;
               |FINSI;
          |FINSI;
          |CIERRA #14;
     |FINSI;
     FSalida = nEsta;
|FPRC;

|PROCESO GrabaAgrupa;
     |SI #2#14 = 0;
          nLin = nLin + 1;
          #9#0 = nLin;
          #9#1 = #2#13;
          #9#2 = #2#12;
          #9#3 = #2#14;
          |GRABA 020#9n;
     |SINO;
          |SI nGrupoAnt ! #2#14;
               nGrupoAnt = #2#14;
               nLin = nLin + 1;

               |DDEFECTO #21;
               #21#0 = #10#0;
               #21#1 = #10#1;
               #21#2 = #2#14;
               |LEE 000#21=;

               #9#0 = nLin;
               #9#1 = #21#3;
               #9#2 = "";
               #9#3 = #2#14;
               |GRABA 020#9n;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE GrabaAgrupa;
     #2#1;
     ;
     #10#0, #10#1, 001;
     #10#0, #10#1, 999;
     ;
     NULL, GrabaAgrupa;
|FIN;

|PROCESO MuestraAgrupa;
     enAgrupa = 0;
     |ABRE #10;
     #10#0 = eaSerPre;
     #10#1 = enNumPre;
     |LEE 000#10=;
     |SI FSalida = 0;
          |SI #10#49 = "S";
               |HAZ CreaTempo; |NOME_DAT #9#Tempo#; |DELINDEX #9;
               |ABRE #21;
               |ABRE #9;
               nGrupoAnt = 0;
               nLin = 0;
               |BUCLE GrabaAgrupa;
               |SI enAgrupa = 0;
                    |SELECT #2#9;
                    #9#2 = eaCapi;
                    |LEE 000#9];
               |SINO;
                    |SELECT #1#9;
                    #9#0 = enAgrupa;
                    |LEE 000#9];
               |FINSI;
               |CONSULTA_CLAVE #1#9;
               |SI FSalida = 0;
                    enAgrupa = #9#3;
                    eaCapi = #9#2;  |QBF eaCapi;
                    eaDesCa = #9#1;
               |SINO;
                    enAgrupa = -1;
                    eaCapi = "";
               |FINSI;
               |CIERRA #21;
               |CIERRA #9;
               |DELINDEX #9;
          |FINSI;
     |FINSI;
     |CIERRA #10;
|FPRC;
