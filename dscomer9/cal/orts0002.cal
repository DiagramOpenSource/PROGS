|FICHEROS;
     orts0002 #0;
     agifa104 #1;
     agifa073 #2;
     agifa024 #3;
     agifa019 #4;
     dsm00003 #30;
     ortsw005 #100;
|FIN;

|VARIABLES;
     &Tempo = "";
     aServido = "";
     informe = "orts0002";
     sw = 0;
     aCliAnt = "";
     nDirAnt = 0;
     &cliente = "";
     &nDir = 0;
     &tptas = 0;
     &tvol  = 0;
     &tpeso = 0;
     pdte = 0;
|FIN;

|PROCESO impresion;
     |DDEFECTO #4;
     #4#0 = #2#2;
     |LEE 040#4=;
     |SI #0#11 = "P";
           tvol = tvol  + ((#2#5-#2#43) * #4#114);
           tpeso= tpeso + ((#2#5-#2#43) * #4#102);
     |SINO;
           tvol = tvol  + (#2#5 * #4#114);
           tpeso= tpeso + (#2#5 * #4#102);
     |FINSI;
|FPRC;

|DEFBUCLE linpedi;
 #2#1;
 ;
 #1#25,#1#0,001;
 #1#25,#1#0,999;
 ;
 NULL,impresion;
|FIN;

|PROCESO lineas;
     |DDEFECTO #3;
     #3#0 = #1#4;||Lee clientes;
     |LEE 040#3=;

     |DDEFECTO #30;
     #30#0 = #1#4;
     #30#1 = #1#57;
     |LEE 000#30=;

    |SI #30#11 = #0#8;||Seleccion zonas;
        cliente = #1#4;
        nDir = #1#57;
        |SI cliente ! aCliAnt; |O nDir ! nDirAnt;
             |SI aCliAnt = "-1";
                  aCliAnt = cliente;
                  nDirAnt = nDir;
             |SINO;
                  cliente = aCliAnt;
                  nDir = nDirAnt;
                  |PRINT;
                  tptas = 0;
                  tvol  = 0;
                  tpeso = 0;
             |FINSI;
             aCliAnt = #1#4;
             nDirAnt = #1#57;
        |FINSI;
        |SI #0#11 = "P";
            tptas = tptas + #1#12;
        |SINO;
            tptas = tptas + #1#11;
        |FINSI;

        |BUCLE linpedi;
    |FINSI;
|FPRC;

|PROCESO Tmp;
     #1#25 = #100#0;
     #1#0 = #100#1;
     |LEE 020#1=;
     |HAZ lineas;
|FPRC;

|DEFBUCLE Tmp;
     #100#2;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Tmp;
|FIN;

|PROCESO GraTmp;
     |SI aServido = "N"; |O #0#11 = "T";
          #100#0 = #1#25;
          #100#1 = #1#0;
          #100#2 = #1#4;
          #100#3 = #1#57;
          |GRABA 020#100n;
     |FINSI;
|FPRC;

|PROCESO Lin;
     pdte = #2#5 - #2#43;
     |SI pdte > 0; |Y #2#9 ! 0;
          aServido = "N";
     |FINSI;
|FPRC;

|PROCESO Cab;
     aServido = "S";
|FPRC;

|DEFBUCLE pedido;
     #1#1;
     1,4,2;
     #0#4,#0#6,#0#2,#0#0, #0#9;
     #0#5,#0#7,#0#3,#0#1, #0#10;
     ;
     NULL, Cab, Lin, GraTmp;
|FIN;

|PROCESO inicio;|TIPO 3;
     |HAZ CreaTempo; |NOME_DAT #100 Tempo; |DELINDEX #100;
     |ABRE #100;

     |ABRE #30;
     |ABRE #3;
     |IMPRE 0;
     |SI FSalida = 0;
         |INFOR informe;
            |SI FSalida = 0;
              |ABRE #4;
                 aCliAnt = "-1";

                 |BUCLE pedido;

                 |ABRE #1;
                 |BUCLE Tmp;
                 |CIERRA #1;

                 |SI aCliAnt ! "-1";
                       cliente = aCliAnt;
                       nDir = nDirAnt;
                       |PRINT;
                 |FINSI;
                 |PIEINF;
                 |FININF;
              |CIERRA #4;
            |FINSI;
         |FINIMP;
     |FINSI;
     |CIERRA #3;
     |CIERRA #30;

     |CIERRA #100; |DELINDEX #100;
|FPRC;
