|FICHEROS;
     clipr060 #0;
     clipr001 #1;  ||clientes
     cliprw06 #6,MANTE;
     clipr007 #7;
     agifa019 #19;
     dsm00020 #20;
     agifa024 #24;
     agifa025 #25;
     agifa069 #69; ||lin.fra
     clipr078 #78;
     clipr081 #81; ||Histo
     clipr082 #82;
     agifa084 #84; ||cab.fra
     agifa142 #142;
   ||  dsm00053 #253;
     agifa321 #321;
     agifa324 #324;
|FIN;

|INCLUYE i_varart;

|VARIABLES;
     &Tempo = "";
     &aDivisa = "";
     &aMoneda = "";
     &aCon_Serie = "";
     &aCon_Clave = "";
     &nCon_Conta = 0;
     aTmp6 = "";
     nHay = 0;
     nLin = 0;
     nUni = 0;
     nPre = 0;
     aDes = "";
     aAlfa = "";
     aSerie = "";
     mes = 0;
     fmes = "";
     imneto = 0;
     retencion = 0;
     aMesHoy = "";
     aAnoHoy = "";
     aMesUlt = "";
     aAnoUlt = "";
     fFechaUlt = @;
     nIncIPC = 0;
     nNume = 0;
|FIN;

|PROCESO IncIPC;
     |ABRE #82;
     #82#0 = aAnoHoy;
     #82#1 = #7#100;
     |LEE 000#82=;
     |SI FSalida = 0;
          nIncIPC = #82#2;
     |SINO;
          |PUSHV 0501 2380;
          |PINPA #0#82;
          |PINDA #0#82;
          |ENDATOS #1#82;
          |GRABA 020#82n;
          |POPV;
          nIncIPC = #82#2;
     |FINSI;
     |CIERRA #82;

     ||Importes
     #7#68 = #7#68 > nIncIPC;
     #7#70 = #7#70 > nIncIPC;
     #7#72 = #7#72 > nIncIPC;
     #7#73 = #7#73 > nIncIPC;
     #7#75 = #7#75 > nIncIPC;

     #7#7 = #7#7 > nIncIPC;
     #7#49 = #7#49 > nIncIPC;
     #7#76 = #7#76 > nIncIPC;
     #7#77 = #7#77 > nIncIPC;
     #7#78 = #7#78 > nIncIPC;

     #7#85 = #7#85 > nIncIPC;
     #7#86 = #7#86 > nIncIPC;
     #7#87 = #7#87 > nIncIPC;
     #7#88 = #7#88 > nIncIPC;
     #7#89 = #7#89 > nIncIPC;
     ||Precios
     #7#31 = #7#31 > nIncIPC;
     #7#59 = #7#59 > nIncIPC;
     #7#60 = #7#60 > nIncIPC;
     #7#61 = #7#61 > nIncIPC;
     #7#62 = #7#62 > nIncIPC;

     #7#10 = #7#7 + #7#49 + #7#68 + #7#70 + #7#72 + #7#73 + #7#75 + #7#76+ #7#77 + #7#78;
     #7#10 = #7#10 + #7#85 + #7#86 + #7#87 + #7#88 + #7#89;
     #7#21 = #7#10 % #7#20;
     #7#23 = #7#10 + #7#21;
     #7#13 = #7#10 % #7#12;
     #7#24 = #7#23 - #7#13;

     ||Fecha
     #7#101 = #0#1;
     |GRABA 020#7a;
|FPRC;

|PROCESO IPC;
     |SI #7#101 = "01.01.0000";
          fFechaUlt = #7#2;
     |SINO;
          fFechaUlt = #7#101;
     |FINSI;
     aMesHoy = #0#1 % 402;
     aAnoHoy = #0#1 % 704;

     aMesUlt = fFechaUlt % 402;
     aAnoUlt = fFechaUlt % 704;

     |SI aAnoHoy > aAnoUlt;
          |SI aMesHoy ] #7#100; |Y #7#100 ! 0;
               |HAZ IncIPC;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Historico;
     |ABRE #81;
     #81#0 = #7#0;
     #81#1 = #7#1;
     #81#2 = 7;
     #81#3 = 99999;
     |LEE 000#81];
     |SI FSalida ! 0;
          |LEE 000#81u;
     |SINO;
          |LEE 000#81a;
     |FINSI;
     |SI FSalida = 0; |Y #81#2 = 7; |Y #81#1 = #7#1; |Y #81#0 = #7#0;
          nLin = #81#3 + 1;
     |SINO;
          nLin = 1;
     |FINSI;

     #81#0 = #7#0;
     #81#1 = #7#1;
     #81#2 = 7;
     #81#3 = nLin;
     #81#4 = "VIGILANCIA";
     #81#5 = #84#48;
     #81#6 = #84#0;
     #81#7 = #84#72;
     #81#8 = #84#1;
     |GRABA 020#81n;
|FPRC;

|PROCESO ActRepre;
     |ABRE #25;
     #25#0 = #84#6;
     |LEE 121#25=;
     |SI 0 = FSalida;
          imneto = #84#15 - #84#25;
          fmes = #84#1 % A402;
          mes = fmes - 1;
          mes = mes * 2;
          mes = mes + 11;
          #25mes = #25mes +. #84#26;
          retencion = #25mes % #25#39;
          mes = mes + 1;
          #25mes = #25mes +. imneto;
          #25#35 = #25#35 +. #84#26;
          #25#36 = #25#36 +. imneto;
          mes = fmes - 1;
          mes = mes + 40;
          #25mes = retencion;
          retencion = #25#35 % #25#39;
          #25#52 = retencion;
          |GRABA 020#25a;
          |LIBERA #25;

          enImpRepComi = #84#26;
          enImpRepVta = imneto;
          enImpRepRete = retencion;
          eaRepre = #84#6;
          efFecha = #84#1;
          |HAZ AcumulaRep;
     |FINSI;
|FPRC;

|PROCESO Contador;
     |DDEFECTO #84;
     aCon_Serie = #0#5;
     |SI #agifa142#137 = "F";
          aCon_Clave = "facturas";
          |HAZ ContadorFicClip;
     |SINO;
          #84#48 = aCon_Serie;
          #84#0 = 999999;
          |LEE 000#84];
          |SI FSalida = 0;
               |LEE 000#84a;
          |SINO;
               |LEE 000#84u;
          |FINSI;
          |SI FSalida = 0; |Y #84#48 = aCon_Serie;
               nCon_Conta = #84#0 + 1;
          |SINO;
               nCon_Conta = 1;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO CreaLinea;
     |DDEFECTO #69;
     #69#20 = #84#48;
     #69#0 = #84#0;
     #69#1 = nLin;
     #69#2 = #19#0;
     #69#3 = 1;
     #69#4 = aDes;
     #69#5 = nUni;
     #69#6 = nPre;
     #69#11 = #7#11;
     #69#13 = #19#2;
     #69#15 = #84#3;
     #69#16 = #25#7;
     #69#17 = #24#4;
     #69#26 = #69#6;
     #69#28 = #69#6;
     |HAZ TotalLin69;

     enForma = 1;
     |HAZ AcumulaFC;

     #69#14 = enCoste;

     |HAZ CalCabAgifa084;
     |GRABA 020#69n;
|FPRC;

|PROCESO LinFactu;
     |DDEFECTO #19;
     |ABRE #19;
     #19#0 = #0#4;
     |LEE 000#19=;
     |CIERRA #19;

     nLin = 0;
     |SI #6#5 ! 0; |Y #6#7 ! 0;
          nPre = #6#5;
          nUni = #6#7;
          nLin = nLin + 1;
          aAlfa = #7#2 % -104;
          aDes = "Honorarios por concierto n§ " + #7#1 + "/" + aAlfa + " de"
          |HAZ CreaLinea;

          |SI #6#6 ! 0; |Y #6#8 ! 0;
               nPre = #6#6;
               nUni = #6#8;
               aDes = "Vigilancia de la Salud, segun Protocolos";
               nLin = nLin + 1;
               |HAZ CreaLinea;

               nPre = 0;
               nUni = 0;
               aDes = "Especificos";
               nLin = nLin + 1;
               |HAZ CreaLinea;
          |FINSI;
     |SINO;
          |SI #6#6 ! 0; |Y #6#8 ! 0;
               nPre = #6#6;
               nUni = #6#8;
               nLin = nLin + 1;
               aAlfa = #7#2 % -104;
               aDes = "Honorarios por concierto n§ " + #7#1 + "/" + aAlfa + " de"
               |HAZ CreaLinea;
          |FINSI;
     |FINSI;
     |SI nLin = 1;
          nPre = 0
          nUni = 0;
          aDes = "Vigilancia de la Salud, segun Protocolos";
          nLin = nLin + 1;
          |HAZ CreaLinea;

          aDes = "Especificos";
          nLin = nLin + 1;
          |HAZ CreaLinea;
     |FINSI;
|FPRC;

|PROCESO Factura;
     |HAZ Contador;
     |DDEFECTO #84;
     #84#48 = aCon_Serie;
     #84#0 = nCon_Conta;
     |GRABA 020#84b;
     |SI FSalida ! 0; |ACABA; |FINSI;

     #84#1 = #0#1;
     #84#3 = #1#58;

     |ABRE #24;
     #24#0 = #1#58;
     |LEE 000#24=;
     |SI FSalida = 0;
          #84#4 = #24#1;
     |SINO;
          #84#4 = #1#4;
     |FINSI;
     |CIERRA #24;

     #84#6 = "00"; |HAZ ClipreRepre;
     #84#8 = #24#20;
     #84#9 = #20#1;
     #84#29 = #24#2;

     #84#30 = #1#14; ||direccion
     #84#31 = #1#15; ||poblacion
     #84#33 = #1#19; ||provincia

     #84#34 = #25#7;
     #84#35 = #24#4;
     #84#36 = #24#47;
     #84#40 = #1#49; ||cuenta contable
     #84#60 = #1#9;  ||cif
     #84#64 = #1#18;
     #84#65 = #24#192;

     |ABRE #324;
     #324#0 = #84#65;
     |LEE 000#324=;
     #84#66 = #324#2;

     #84#67 = #24#193;
     #84#68 = #321#9;

     #324#0 = #84#68;
     |LEE 000#324=;
     #84#69 = #324#2;
     |CIERRA #324;

     #84#78 = #20#0;
     #84#88 = #1#51;
     #84#89 = #1#52;
     #84#90 = #1#53;

     #84#93 = #7#0;
     #84#94 = ("0000000" + #7#1) % -107;

     aDivisa = #84#65;
     aMoneda = #84#67;
     |HAZ Divisas084;

     |HAZ LimCabAgifa084;
     |HAZ LinFactu;
     |SI nLin = 2;
          #84#95 = nLin;
     |FINSI;
     |GRABA 020#84a;
     |LIBERA #84;
|FPRC;

|PROCESO Tmp;
     #7#0 = #6#0;
     #7#1 = #6#1;
     |LEE 020#7=;
     |SI FSalida = 0;
          nHay = 0;
          |SI #6#5 ! 0; |Y #6#7 ! 0; nHay = 1; |FINSI;
          |SI #6#6 ! 0; |Y #6#8 ! 0; nHay = 1; |FINSI;
          |SI nHay = 1;
               |HAZ Factura;
               |HAZ ActRepre;
               |HAZ VenciDir;
               |HAZ Historico;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE Tmp;
     #6#1;
     4;
     "     ", 0000001, "S";
     "zzzzz", 9999999, "S";
     ;
     NULL, Tmp;
|FIN;

|PROCESO Contratos;
     |HAZ IPC;
     |LIBERA #7;

     #6#0 = #7#0;
     #6#1 = #7#1;
     #6#2 = #7#3;
     #6#3 = #7#4;
     #6#4 = "N";
     #6#5 = #7#7;
     #6#6 = #7#49;
     |GRABA 020#6n;
     nHay = 1;
|FPRC;

|DEFBUCLE Contratos;
     #7#2;
     47;
     #0#3, 1;
     #0#3, 1;
     be;
     NULL, Contratos;
|FIN;

|PROCESO Min;
     #6#0 = "     ";
     #6#1 = 0000001;
|FPRC;

|PROCESO Max;
     #6#0 = "zzzzz";
     #6#1 = 9999999;
|FPRC;

|PROCESO Tecla0; |TIPO 0;
     |SI #6Campo = Contenido; |Y FSalida = 0;
          |SI #6#4 = "S";
               #6#4 = "N";
               #6#7 = 0;
               #6#8 = 0;
          |SINO;
               |ENCAMPO #7#6;
               |ENCAMPO #8#6;
               |SI #6#7 ! 0; |O #6#8 ! 0;
                    #6#4 = "S";
               |FINSI;
          |FINSI;
          |PINTA #6#4;
          |PINTA #6#7;
          |PINTA #6#8;
          |GRABA 020#6a;
     |FINSI;
|FPRC;

|PROCESO Tecla11; |TIPO 11;
     |SI FSalida = 12;
          |PUSHV 0501 2380;
          |ABRE #7;
          #7#0 = #6#0;
          #7#1 = #6#1;
          |LEE 000#7=;
          |SI FSalida = 0;
               |PINPA #0#7;
               |PINDA #0#7;
               |PAUSA;
          |FINSI;
          |CIERRA #7;
          |POPV;
     |FINSI;
|FPRC;

|PROCESO Delega; |TIPO 0;
     |ABRE #78;
     #78#0 = #0#2;
     #78#1 = 2;
     |LEE 000#78=;
     |SI FSalida = 0;
          #0#5 = #78#2; |PINTA #0#5;
          #0#4 = #78#3; |PINTA #0#4;
     |FINSI;
     |CIERRA #78;
|FPRC;

|PROCESO Tipo3;
     |ABRE #142; |LEE 000#142p; |CIERRA #142;
     |ABRE #321; |LEE 000#321p; |CIERRA #321;

     |HAZ CreaTempo; aTmp6 = Tempo;
     |NOME_DAT #6 aTmp6; |DELINDEX #6;

     |ABRE #6;
     |BUCLE Contratos;
     |CIERRA #6;

     |SI nHay = 0;
          |MENAV "0000Seleccion vacia...";
     |SINO;
          |PINPA #0#6;
          |ENTLINEAL #1#6, -1, 4, 19, 0, Min, Max;
          |CONFI "0000SGenerar facturas?";
          |SI FSalida = 0;
               |ABRE #7;
               |ABRE #84;
               |ABRE #69;
               |BUCLE Tmp;
               |CIERRA #69;
               |CIERRA #84;
               |CIERRA #7;;
          |FINSI;
     |FINSI;

     Tempo = aTmp6; |HAZ BoraTempo; |DELINDEX #6;
|FPRC;

|PROGRAMA;
     |CLS;
     |ABRE #0;
     |LEE 101#0p;
     |SI FSalida ! 0; |GRABA 020#0b; |FINSI;
     |PINPA #0#0;
     |PINDA #0#0;
     |ENDATOS #1#0;
     |SI FSalida = 0;
          |HAZ Tipo3;
          |GRABA 020#0a;
     |FINSI;
     |CIERRA #0;
|FPRO;
