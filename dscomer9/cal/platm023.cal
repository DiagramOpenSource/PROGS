|FICHEROS;
 platm023 #0;
 platm011 #1;
 platm020 #2;
 platm012 #3;
|FIN;

|VARIABLES;
 nModo = 0;
 nNumero = 0;
 aEstado = "";
 linea = 0;
 ii = 0;
|FIN;

|CALCULO contador;|TIPO 7;
nModo = (FEntrada/100)!0;
|SI nModo = 1;
  |ABRE #0;
  |LEE 010#0u;
  |SI FSalida ! 0;
    nNumero = 1;
  |SINO;
    nNumero = #0#0 + 1;
  |FINSI;
  |DDEFECTO #0;
  #0#0 = nNumero;
|FINSI;
|FCAL;

|PROCESO MiraEstado;
|ABRE #1;
#1#0 = #0#3;
|LEE 010#1=;
|SI FSalida ! 0;|DDEFECTO #1;|FINSI;
|LIBERA #1;
|CIERRA #1;
|FPRC;

|PROCESO SumaTip;
|HAZ MiraEstado;
|QBF aEstado;
|ABRE #platm012;
#platm012#0 = #platm011#2;
|LEE 010#platm012.=;
|SI FSalida = 0;
  |SI aEstado = "ALMACEN";
    #platm012#2 = #platm012#2 -. 1;
  |FINSI;
  |SI aEstado = "INSTALADO";
    #platm012#3 = #platm012#3 -. 1;
  |FINSI;
  |SI aEstado = "AVERIADO";
    #platm012#4 = #platm012#4 -. 1;
  |FINSI;
  |SI aEstado = "REPARADO";
    #platm012#5 = #platm012#5 -. 1;
  |FINSI;
  #platm012#7 = #platm012#7 +. 1;
  #platm012#6 = #platm012#2 + #platm012#3 + #platm012#4 + #platm012#5 + #platm012#7;
  |GRABA 010#platm012.a;
|FINSI;
|LIBERA #platm012;
|CIERRA #platm012;
|FPRC;


|PROCESO AltaHis;
  |ABRE #1;
  #1#0 = #0#3;
  |LEE 010#1=;
  |SI FSalida = 0;
      aEstado = #1#7;
      #1#7 = "ENVIOPLATA";
      |GRABA 010#1a;
  |FINSI;
  |LIBERA #1;
  |CIERRA #1;
  |ABRE #2;
  #2#0 = #0#3;
  #2#3 = 001;
  |LEE 010#2=;
  |SI FSalida ! 0;
    linea = 1;
  |SINO;
    |PARA ii = 1;|SI ii [100;|HACIENDO;
      linea = #2#3;
      |LEE 010#2s;
      |SI #2#0 ! #0#3;|O FSalida ! 0;
        |SAL;
      |FINSI;
    |SIGUE;
  |FINSI;
  |LIBERA #2;
  #2#0 = #0#3;
  #2#3 = linea+1;
  #2#1 = "ENVIOPLATAF";
  #2#2 = #0#2;
  |GRABA 010#2n;
  |LIBERA #2;
  |CIERRA #2;
|FPRC;

|CALCULO tipo3023;|TIPO 3;
nModo = (FEntrada/100)!0;
|SI nModo = 2;
 |HAZ BajaHisto;
|FINSI;
|HAZ AltaHis;
|FCAL;

|PROCESO BajaHisto;
|ABRE #2;
|SELECT #3#2;
#2#0 = #0#3;
#2#2 = "ENVIOPLATA";
#2#3 = #0#2;
|LEE 010#2=;
|SI FSalida = 0;
 |BORRA 010#2a;
|FINSI;
|LIBERA #2;
|CIERRA #2;
|FPRC;

|CALCULO tipo2023;|TIPO 2;
nModo = (FEntrada/100)!0;
|SI nModo = 3;
 |HAZ BajaHisto
|FINSI;
|HAZ SumaTip;
|FCAL;

|CALCULO MiraTipo;
|ABRE #1;
#1#0 = #0#3;
|LEE 010#1=;
|SI FSalida = 0;
  |SI #1#8 = "O";
    |MENAV "0000 SOLO NUMEROS DE SERIE";
    |ERROR;
  |FINSI;
|FINSI;
|FCAL;
