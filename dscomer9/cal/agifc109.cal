     BorHerrajeCanteado
     GraHerrajeCanteado
     GraPesoArti

|FICHEROS;
     agifa109 #0;
     agifa048 #1;
     agifa049 #49;
     agifa019 #19;
     ortsm019@;
     ortsm028@;
     ortsm027@;
     ortsm036@;
     referen@;
|FIN;

|VARIABLES;
     &enEstaDentro = 0;
     &enCosteOrts = 0;
     &aEscanOri = "";
     nLin = 0;
     aAlfa = "";
     aPath = "";
     nCoste = 0;
     aCanteado = "";
     aHerraje = "";
     nMermaCanteado = 0;
     nMermaHerraje = 0;
     aTrataImos = "N";
     nPeso = 0;
|FIN;

|PROCESO OrtsHerraje;
     #19#0 = #ortsm027@#2;
     |LEE 000#19=;
     |SI FSalida ! 0; |DDEFECTO #19; |FINSI;

     |SI #0#4 = 1; #ortsm027@#8 = #19#9; |FINSI;
     |SI #0#4 = 2; #ortsm027@#8 = #19#28; |FINSI;
     |SI #0#4 = 3; #ortsm027@#8 = #19#133; |FINSI;

     #ortsm027@#9 = #19#102 *  #ortsm027@#4;
     |GRABA 020#ortsm027@.a;

     nCoste = nCoste + (#ortsm027@#4 * #ortsm027@#8);
|FPRC;

|DEFBUCLE OrtsHerraje;
     #ortsm027@#1003;
     ;
     aEscanOri, 001, "                    ";
     aEscanOri, 999, "zzzzzzzzzzzzzzzzzzzz";
     ;
     NULL, OrtsHerraje;
|FIN;

|PROCESO OrtsCanteado;
     #19#0 = #ortsm028@#4;
     |LEE 000#19=;
     |SI FSalida ! 0; |DDEFECTO #19; |FINSI;

     |SI #0#4 = 1; #ortsm028@#11 = #19#9; |FINSI;
     |SI #0#4 = 2; #ortsm028@#11 = #19#28; |FINSI;
     |SI #0#4 = 3; #ortsm028@#11 = #19#133; |FINSI;
     |GRABA 020#ortsm028@.a;

     nCoste = nCoste + (#ortsm028@#7 / 100 * #ortsm028@#11 * #ortsm028@#13);
|FPRC;

|DEFBUCLE OrtsCanteado;
     #ortsm028@#1005;
     ;
     aEscanOri, 001, 0, " ", 00;
     aEscanOri, 999, 9, "z", 99;
     be;
     NULL, OrtsCanteado;
|FIN;

|PROCESO ParamOrts;
     aCanteado = "";
     aHerraje = "";
     aTrataImos = "N";

     |DDEF aPath;

     aAlfa = aPath + "ortsm036";
     |CARGA_DEF aAlfa, ortsm036@;
     |SI FSalida = 0;
          |ABRE #ortsm036@; |LEE 000#ortsm036@.p; |CIERRA #ortsm036@;
          aCanteado = #ortsm036@#18;
          aHerraje = #ortsm036@#17;
          nMermaHerraje = #ortsm036@#20;
          nMermaCanteado = #ortsm036@#21;
          |DESCARGA_DEF #ortsm036@;
     |FINSI;

     aAlfa = aPath + "ortsm019";
     |CARGA_DEF aAlfa, ortsm019@;
     |SI FSalida = 0;
          |ABRE #ortsm019@;
          #ortsm019@#0 = aEscanOri;
          |LEE 000#ortsm019@.=;
          |SI FSalida = 0; |Y #ortsm019@#2 = "S";
               aTrataImos = "S";
          |FINSI;
          |CIERRA #ortsm019@;
          |DESCARGA_DEF #ortsm019@;
     |FINSI;
|FPRC;

|PROCESO BorraOrts;
     |SI #49#2 = aCanteado; |O #49#2 = aHerraje;
          |BORRA 020#49a;
     |FINSI;
|FPRC;

|DEFBUCLE BorraOrts;
     #49#1;
     10;
     aEscanOri, 001, 3;
     aEscanOri, 999, 3;
     be;
     NULL, BorraOrts;
|FIN;

|PROCESO BorHerrajeCanteado;
     enEstaDentro = 1; |||OJO NO QUITAR (ver dsz99956)
     |HAZ ParamOrts;
     |BUCLE BorraOrts;
     enEstaDentro = 0;
|FPRC;

|PROCESO UltLin49;
     #49#0 = aEscanOri; aAlfa = #49#0;
     #49#1 = 999;
     |LEE 000#49];
     |SI FSalida = 0;
          |LEE 000#49a;
     |SINO;
          |LEE 000#49u;
     |FINSI;
     |SI FSalida = 0; |Y #49#0 = aAlfa;
          nLin = #49#1 + 1;
     |SINO;
          nLin = 1;
     |FINSI;

     |DDEFECTO #49;
     #49#0 = aEscanOri;
     #49#1 = nLin;
|FPRC;

|PROCESO GraHerrajeCanteado;
     enEstaDentro = 1; |||OJO NO QUITAR (ver dsz99956)
     |HAZ ParamOrts;

     |SI aTrataImos = "S";
          aAlfa = aPath + "ortsm028";
          |CARGA_DEF aAlfa, ortsm028@;
          |SI FSalida = 0;
               nCoste = 0;
               |BUCLE OrtsCanteado;
               |DESCARGA_DEF #ortsm028@;

               #19#0 = aCanteado;
               |LEE 000#19=;
               |SI FSalida ! 0; |DDEFECTO #19; |FINSI;
               |HAZ UltLin49;
               #49#2 = aCanteado;
               #49#3 = #19#1;
               #49#4 = 1;
               #49#5 = nCoste;
               #49#10 = 3;
               #49#12 = 1;
               #49#13 = nMermaCanteado;
               #49#15 = nCoste;
               |HAZ TotalLin49;
               |GRABA 020#49n;

               enCosteOrts = enCosteOrts + nCoste;
          |FINSI;

          aAlfa = aPath + "ortsm027";
          |CARGA_DEF aAlfa, ortsm027@;
          |SI FSalida = 0;
               nCoste = 0;
               |BUCLE OrtsHerraje;
               |DESCARGA_DEF #ortsm027@;

               #19#0 = aHerraje;
               |LEE 000#19=;
               |SI FSalida ! 0; |DDEFECTO #19; |FINSI;
               |HAZ UltLin49;
               #49#2 = aHerraje;
               #49#3 = #19#1;
               #49#4 = 1;
               #49#5 = nCoste;
               #49#10 = 3;
               #49#12 = 1;
               #49#13 = nMermaHerraje;
               #49#15 = nCoste;
               |HAZ TotalLin49;
               |GRABA 020#49n;

               enCosteOrts = enCosteOrts + nCoste;
          |FINSI;
     |FINSI;

     enEstaDentro = 0;
|FPRC;

|PROCESO Peso20;
     nPeso = nPeso + #referen@#19;
|FPRC;
|PROCESO Peso27;
     nPeso = nPeso + #referen@#9;
|FPRC;
|PROCESO Peso28;
     nPeso = nPeso + #referen@#12;
|FPRC;

|DEFBUCLE Peso20;
     #referen@#1002;
     ;
     #1#0, 001;
     #1#0, 999;
     ;
     NULL, Peso20;
|FIN;

|DEFBUCLE Peso27;
     #referen@#1003;
     ;
     #1#0, 001, "                    ";
     #1#0, 999, "zzzzzzzzzzzzzzzzzzzz";
     ;
     NULL, Peso27;
|FIN;

|DEFBUCLE Peso28;
     #referen@#1005;
     ;
     #1#0, 001, 0, " ", 00;
     #1#0, 999, 9, "z", 99;
     ;
     NULL, Peso28;
|FIN;

|PROCESO GraPesoArti;
     nPeso = 0;
     |DDEF aPath;
     aAlfa = aPath + "ortsm020";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |BUCLE Peso20;
          |DESCARGA_DEF #referen@;
     |FINSI;
     aAlfa = aPath + "ortsm027";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |BUCLE Peso27;
          |DESCARGA_DEF #referen@;
     |FINSI;
     aAlfa = aPath + "ortsm028";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |BUCLE Peso28;
          |DESCARGA_DEF #referen@;
     |FINSI;

     aTrataImos = "N";
     aAlfa = aPath + "ortsm019";
     |CARGA_DEF aAlfa, ortsm019@;
     |SI FSalida = 0;
          |ABRE #ortsm019@;
          #ortsm019@#0 = aEscanOri;
          |LEE 000#ortsm019@.=;
          |SI FSalida = 0; |Y #ortsm019@#2 = "S";
               aTrataImos = "S";
          |FINSI;
          |CIERRA #ortsm019@;
          |DESCARGA_DEF #ortsm019@;
     |FINSI;

     |SI aTrataImos = "S";
          #19#0 = #1#0;
          |LEE 121#19=;
          |SI FSalida = 0;
               #19#102 = nPeso;
               |GRABA 020#19a;
               |LIBERA #19;
          |FINSI;
     |FINSI;
|FPRC;
