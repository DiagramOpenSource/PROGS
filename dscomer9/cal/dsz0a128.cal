|FICHEROS;
     dsz00128 #0;
     agifa019 #19;
     agifa024 #24;
     agifa025 #25;
     agifa069 #69;
     agifa084 #84;
     agifa142 #142;
     dsm00153 #153;
|FIN;

|VARIABLES;
     &enError = 0;
     &enSwMenu = 0;
     &enCoste = 0;
     &enForma = 0;
     &enImpVta = 0;
     &enImpMar = 0;
     &enImpCliCom = 0;
     &enImpCliDto = 0;
     &enImpCliMar = 0;
     &enImpCliFac = 0;
     &enImpRepComi = 0;
     &enImpRepVta = 0;
     &enImpRepRete = 0;
     &efFecha = @;
     &eaArticulo = "";
     &eaCliente = "";
     &eaRepre = "";
     &eaTag = "";
     nForma = 0;
     nConta = 0;
     aAlfa = "";
     nMargen = 0;
     nRete = 0;
     nMes = 0;
     nImpo = 0;
     nImNeto = 0;
     nDto = 0;
|FIN;

|PROCESO ActArti;
     aAlfa = #84#1 % A402;
     nMes = aAlfa - 1;
     nMes = nMes * 5;
     nMes = nMes + 35;
     #19#0 = #69#2;
     |LEE 101#19=;
     |SI FSalida = 0;
          |SI #19#194 = 2;
               nImpo = ((((#69#30 * #69#6) < #69#8) < #69#21) < #84#5) < #84#32;
          |SINO;
               nImpo = ((((#69#5 * #69#6) < #69#8) < #69#21) < #84#5) < #84#32;
          |FINSI;
          |SI #142#115 = "S";
               nImpo = nImpo < #84#7;
          |FINSI;
          nMargen = nImpo - #69#14;
          #19nMes = #19nMes + (nImpo * nForma);
          #19#95 = #19#95 + (nImpo * nForma);
          nMes = nMes + 1;
          #19nMes = #19nMes + (nMargen * nForma);
          #19#96 = #19#96 + (nMargen * nForma);
          |GRABA 020#19a;
     |FINSI;
     |LIBERA #19;

     efFecha = #84#1;
     eaArticulo = #69#2;
     enImpVta = (nImpo * nForma);
     enImpMar = (nMargen * nForma);
     |HAZ AcumulaArt;
|FPRC;

|CALCULO Actualiza84;
     |ABRE #24;
     #24#0 = #84#3;
     |LEE 121#24=;
     |SI 0 = FSalida;
          aAlfa = #84#1 % A402;
          nMes = aAlfa - 1;
          nMes = nMes * 4;
          nMes = nMes + 54;
          nImNeto = #84#15 - #84#25;
          |SI #142#115 = "N";
               nImpo = (nImNeto * 100) / (100 - #84#7);
               nDto = #84#25 + (nImNeto - nImpo);
          |SINO;
               nImpo = nImNeto;
               nDto = #84#25;
          |FINSI;
          #24nMes = #24nMes + nImpo;
          nMes = nMes + 1;
          #24nMes = #24nMes + nDto;
          nMes = nMes + 1;
          #24nMes = #24nMes + #84#37;
          #24#102 = #24#102 + nImpo;
          #24#103 = #24#103 + nDto;
          #24#104 = #24#104 + #84#37;
          #24#45 = #84#1;
          #24#46 = nImNeto;
          #24#110 = #24#110 + nImNeto;
          nImNeto = nImNeto + #84#24;
          |GRABA 020#24a;
          |LIBERA #24;

          enImpCliCom = nImpo * nForma;
          enImpCliDto = nDto * nForma;
          enImpCliMar = #84#37 * nForma;
          enImpCliFac = nImNeto * nForma;
          eaCliente = #84#3;
          efFecha = #84#1;
          |HAZ AcumulaCli;
     |FINSI;
     |CIERRA #24;

     |ABRE #25;
     #25#0 = #84#6;
     |LEE 121#25=;
     |SI 0 = FSalida;
           nImNeto = #84#15 - #84#25;
           aAlfa = #84#1 % A402;
           nMes = aAlfa - 1;
           nMes = nMes * 2;
           nMes = nMes + 11;
           #25nMes = #25nMes + #84#26;
           nRete = #25nMes % #25#39;
           nMes = nMes + 1;
           #25nMes = #25nMes + nImNeto;
           #25#35 = #25#35 + #84#26;
           #25#36 = #25#36 + nImNeto;
           nMes = aAlfa - 1;
           nMes = nMes + 40;
           #25nMes = nRete;
           nRete = #25#35 % #25#39;
           #25#52 = nRete;
           |GRABA 020#25a;
           |LIBERA #25;

          enImpRepComi = #84#26 * nForma;
          enImpRepVta = nImNeto * nForma;
          enImpRepRete = nRete * nForma;
          eaRepre = #84#6;
          efFecha = #84#1;
          |HAZ AcumulaRep;
     |FINSI;
     |CIERRA #25;

     |ABRE #19;
     |BUCLELIN 2 ActArti #84;
     |CIERRA #19;
     |SI #142#47 = "S";  ||컴컴컴컴컴 Acumula en riesgos Si Crea Recibo
          eaTag = "FC";  |HAZ Riesgos;
     |FINSI;
|FCAL;

|PROCESO ActLineas69;
     nForma = 1;
     enForma = 1;
     |HAZ TotalLin69;
     |HAZ AcumulaFC;
     #69#14 = enCoste;
     nImNeto  = ((((#69#9  < #84#5) < #84#32) < #84#7));
     #84#37 = #84#37 + (nImNeto - enCoste);
     |HAZ CalCabAgifa084;
|FPRC;

|PROCESO CopiaLineas69;
     #69#20 = #84#48;
     #69#0 = nConta;
     #69#5 = -#69#5;
     |GRABA 020#69n;
|FPRC;

|DEFBUCLE CopiaLineas69;
     #69#1;
     ;
     #0#1, #0#2, 001;
     #0#1, #0#2, 999;
     ;
     NULL, CopiaLineas69;
|FIN;

|PROCESO FacDirec;
     enError = 1;

     enSwMenu = 1;
     #84#48 = #0#3;
     |HAZ ContaFD7;
     |GRABA 020#84n;
     |SI FSalida = 0;
          nConta = #84#0;
          #84#48 = #0#1;
          #84#0 = #0#2;
          |LEE 020#84=;
          |SALVA_DATOS #84;
          #84#48 = #0#3;
          #84#0 = nConta;
          |LEE 121#84=;
          |REPON_DATOS #84;
          #84#48 = #0#3;
          #84#0 = nConta;
          #84#1 = ~;
          #84#10 = "N";
          #84#39 = "N";
          |GRABA 020#84a;
          |BUCLE CopiaLineas69;
          |HAZ LimCabAgifa084;
          |BUCLELIN 0 ActLineas69 #84;
          |HAZ Actualiza84;
          |GRABA 020#84a;

          #153#6 = #84#48;
          #153#7 = #84#0;
          #153#8 = #84#1;
          |GRABA 020#153a;
          enError = 0;
     |FINSI;
|FPRC;
