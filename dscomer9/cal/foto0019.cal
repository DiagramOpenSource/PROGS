|FICHEROS;
     foto0019 #0; ||Importacion
     foto0015 #1; ||Cabecera sobres
     foto0016 #2; ||Lineas sobres
     foto0x18 #3; ||Cabecera fantasma
     foto0z18 #4; ||Lineas fantasma
     foto0020 #5; ||Control path
|FIN;

|VARIABLES;
     Dato="";
     Sobre="";
     i=0;
     Hora="";
     Fec=~;
     blanco1="         ";
     pintar="";
     path="";
|FIN;

||*************************************************************

|PROCESO lineas;        ||Lineas de sobre
||Actualizo los campos
     |PARA i = 0; |SI i [ 15; |HACIENDO i = i + 1;
          #2i = #4i;
     |SIGUE;
/*
     |PINTA 2300,#2#0;
     |PINTA 2310,#2#1;
     |PINTA 2320,#2#2;
     |PINTA 2335,#2#3;
     |PINTA 2350,#2#4;
     |PINTA 2360,#2#5;
     |PINTA 2370,#2#6;
     |PAUSA;
*/
     |GRABA 011#2n;      ||Grabo en el fichero destino;
|FPRC;

|DEFBUCLE lineassobreI;
#4#1;
;
#foto0x18#0,001;
#foto0x18#0,999;
be;
NULL, lineas;
|FIN;

|PROCESO ImportaFich;
     |ABRE #1;
     |SELECT #1#1;
     #1#0=#foto0x18#0;
     |LEE 010#1=;
     |SI FSalida = 0;                                    || Si el sobre importado existe
         |PINTA 2163 , blanco1;                          || actualizo los datos con los del
         pintar = "Sobre " +#1#0+" existe";              || disquete.
         |PINTA 2163 , pintar;
         |ATRI R;
         |PINTA 2346 , "Actualizando datos";
         |ATRI r;
         ||Actualizo los campos de cabecera
         |PARA i = 1; |SI i [ 38; |HACIENDO i = i + 1;
              #1i = #3i; ||igualo todos los campos
         |SIGUE;
         ||grabo el registro actual
         |GRABA 011#1a; || actualizo datos del actual
         |PINTA 2346 , "                  ";
         |ABRE #2;
         |ABRE #4;
         ||Comienzo el bucle de creación de líneas
         |BUCLE lineassobreI;
         |CIERRA #2;
         |CIERRA #4;
     |SINO;                                              || Si el sobre importado no existe
         |PINTA 2163 , blanco1;                          || recogo todos sus datos, incluidas
         pintar = #1#0;                                  || las lineas.
         |PINTA 2163 , pintar;
         ||Actualizo los campos de cabecera
         |PARA i = 0; |SI i [ 21; |HACIENDO i = i + 1;
              #1i = #3i; ||igualo todos los campos
         |SIGUE;
         |GRABA 011#1n; || grabo el nuevo
         |ABRE #2;
         |ABRE #4;
         ||Comienzo el bucle de creación de líneas
         |BUCLE lineassobreI;
         |CIERRA #2;
         |CIERRA #4;
     |FINSI;
|FPRC;



|DEFBUCLE importa;
#3#1;
1,16;
#0#4,#0#2,#0#0;||sobres,cliente,tienda
#0#5,#0#3,#0#1;
be;
NULL, ImportaFich;
|FIN;

||*************************************************************

|PROCESO Tipo3; |TIPO 3;
     |ABRE #5;
     #5#0="A";
     |LEE 010#5=;
     |CIERRA #5;

     path=#5#2;
     |QBF path;

     |PATH_DAT #3 path;
     |PATH_DAT #4 path;
     |BUCLE importa;
|FPRC;
