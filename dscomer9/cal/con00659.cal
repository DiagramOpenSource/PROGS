|FICHEROS;
con00659 #0,MANTE;
con00625 #10;
con01625 #11;
con00626 #12;
agifa027 #20;
con00650 #50;
con00637 #637;
con00601 #601;
|FIN;

|VARIABLES;
     &eaSerie = "";
     &eaNumero = "";
     &eaVer = "";
     &enError = 0;
     &enLines = 0;
     &eaModelo = "";
     &eaNomMod = "";
     &eaMarca = "";
     &eaSeri = "";
     &eaMatri = "";
     &eaBasti = "";

     modo = 0;
     tempo = "";
     aAlfa = "";
     nForma = 0;
|FIN;


|PROCESO b_lino;
|BORRA 021#12a;
|LIBERA #12;
|FPRC;

|DEFBUCLE b_linor;
#12#1;
;
#10#0 , #10#1 ,001;
#10#0 , #10#1 ,999;
;
NULL , b_lino;
|FIN;


|PROCESO busca_or;
|BUCLE b_linor;
|BORRA 021#10a;
|LIBERA #10;
|FPRC;

|DEFBUCLE borra_o;
#10#1;
;
#0#2 , #0#3;
#0#2 , #0#3;
;
NULL , busca_or;
|FIN;

|PROCESO busca_numero;
|ABRE #20;
#20#0 = "partetra";
#20#2 = "VN";
|LEE 111#20=;
|SI FSalida ! 0;
     #20#1 = 1;
     |GRABA 111#20b;
|FINSI;
tempo = ("000000" + #20#1)% -106;
#20#1 = #20#1 + 1;
|GRABA 021#20a;
|LIBERA #20;
|CIERRA #20;
|FPRC;

|PROCESO EstaFactu;
     aAlfa = 1;
     |DDEFECTO #10;
     |ABRE #10;
     #10#0 = #0#2;
     #10#1 = #0#3;
     |LEE 000#10=;
     |SI FSalida = 0; |Y #10#16 ! 0; |Y  #10#16 ! 999999;
          aAlfa = 0;
     |FINSI;
     |CIERRA #10;
     FSalida = aAlfa;
|FPRC;

|PROCESO tipo2; |TIPO 2;
     modo = (FEntrada/100) !0;
     nForma = 0 +. 1;
     |SI modo = 3;
          |HAZ EstaFactu;
          |SI FSalida = 0;
               |MENAV "0000Esta facturada...";
               |ERROR;
          |SINO;
               |CONFI "0000SBorrar Orden de reparacion?";
               |SI FSalida = 0;
                    aAlfa = "con00802;" + #0#2 + #0#3;
                    |SUB_EJECUTA_NP aAlfa;
               |SINO;
                    |ERROR; |ACABA;
               |FINSI;
          |FINSI;
     |FINSI;

     |SI modo = 2; |Y nForma = -1;
          |HAZ EstaFactu;
          |SI FSalida = 0;
               |MENAV "0000Esta facturada...";
               |ERROR; |ACABA;
          |FINSI;

          eaSerie = #0#2;
          eaNumero = #0#3;
          |SUB_EJECUTA_NP "con00704";
          |SI enError ! 0; |ERROR; |ACABA; |FINSI;

          |ABRE #10;
          #10#0 = eaSerie;
          #10#1 = eaNumero;
          |LEE 020#10=;
          |SI FSalida = 0;
               |ABRE #637;
               |DDEFECTO #637;
               #637#0 = #10#15;
               #637#1 = #10#16;
               |LEE 000#637=;
               |CIERRA #637;

               #0#2 = #10#0;
               #0#3 = #10#1;
               #0#4 = #10#28;
               #0#5 = #10#11;
               #0#6 = #10#19;
               #0#7 = #10#2;
          |FINSI;
          |CIERRA #10;
     |FINSI;

     |SI modo = 1;
          |CONFI "0000SCrear orden de reparacion?";
          |SI FSalida ! 0;
               |ABRE #10;
               |LEE 000#10p;
               |CONSULTA_CLAVE #1#10;
               |SI FSalida ! 0;
                    |ERROR; |ACABA;
               |FINSI;
               |CIERRA #10;
               eaSerie = #10#0;
               eaNumero = #10#1;
          |SINO;
               |HAZ busca_numero;
               |ABRE #10;
               #10#0 = "VN";
               #10#1 = tempo;
               |LEE 000#10=;
               |PARA; |SI FSalida = 0; |HACIENDO;
                      #10#1 = #10#1 + 1;
                      |LEE 000#10=;
               |SIGUE;
               |CIERRA #10;

               eaSerie = #10#0;
               eaNumero = #10#1;
               enLines = #0#1;
               eaModelo = #50#2;
               eaNomMod = #50#16;
               eaMarca = #50#28;
               eaVer = #50#3;
               eaSeri = #50#1;
               eaMatri = #50#29;
               eaBasti = #0#0;
               |SUB_EJECUTA_NP "con00704";
               |SI enError ! 0; |ERROR; |ACABA; |FINSI;
          |FINSI;

          |ABRE #10;
          #10#0 = eaSerie;
          #10#1 = eaNumero;
          |LEE 020#10=;
          |SI FSalida = 0;
               #0#2 = #10#0;
               #0#3 = #10#1;
               #0#4 = #10#28;
               #0#5 = #10#11;
               #0#6 = #10#19;
               #0#7 = #10#2;

               |ABRE #601;
               #601#0 = #10#3;
               |LEE 101#601=;
               |SI FSalida = 0;
                    #601#12 = #10#5;
                    |GRABA 020#601a;
               |FINSI;
               |CIERRA #601;
               |SI #10#16 ! 0; |Y #10#16 ! 999999;
                    |MENAV "0000Orden Facturada...";
               |FINSI;

          |FINSI;
          |CIERRA #10;
     |FINSI;
|FPRC;

|PROCESO Desasigna; |TIPO 11;
     |SI FSalida = 13;
          |BORRA 020#0a;
          |PONCONTROL 23, "SI";
     |FINSI;
|FPRC;
