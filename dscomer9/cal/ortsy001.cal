|FICHEROS;
     ortsy001 #0;
     ortsm001 #1;
     ortsm002 #2;
     ortsm003 #3;
     ortsm004 #4;
     ortsw001 #10;  ||TMP
     ortsw003 #11;  ||TMP
     ortsm013 #13;
     ortsm014 #14;
     agifa048 #480;
     agifa049 #49;
     agifa104 #104;
     agifa071 #71;
     agifa073 #73;
     agifa019 #19;
     agifa024 #24;
     ortsm017 #117; || Aux Ped Comb
     ortsm018 #118; || Aux Ped Comb Uni
     ortsm019 #119; || Aux Escan C
     ortsm020 #120; || Aux Escan L

     ortsy003 #103;      ||Aux.Parrilla ortsy01
     agifa049@;
     ortsm020@;
|FIN;

|VARIABLES;
     aSer = "";
     nNum = 0;
     &eaSerAlb = "";
     &enNumAlb = 0;
     aPath = "";
     aFin = "";
     aCombi = "";
     aTira = "";
     f = @;
     nSal = 0;
     aMarca = "";
     nCampo = 0;
     &enHora = "";
     nCuenta   = 0;
     nTCuenta  = 0;
     nPen      = 0;
     &enBulto  = 0;
     &enCBart  = "";
     &enCBcom  = "";
     aInforme  = "ortsy001";
     aAlfa     = "";
     aImpre    = "";
     nSw       = 0;
     i         = 0;
     nSwImp    = 0;
     aDesSer = "";
     aHasSer = "";
     nDesNum = 0;
     nHasNum = 0;
     fFecha = @;
     aLon = "";
|FIN;

|PROCESO LeeAlbaran;
     |SELECT #4#71;
     #71#31 = #73#28;
     #71#12 = #73#0;
     #71#21 = #73#1;
     |LEE 000#71=;
     |SI FSalida = 0;
          eaSerAlb = #71#29;
          enNumAlb = #71#0;
     |SINO;
          eaSerAlb = "";
          enNumAlb = 0;
     |FINSI;
|FPRC;


|PROCESO ControlBultos_1;
     |ABRE #14;
     #14#0 = #11#0;
     #14#1 = #11#1;
     |LEE 101#14=;
     |SI FSalida ! 0; |GRABA 020#14b; |FINSI;
     #14#2 = #2#2;  || T.Bultos
     #14#3 = #13#3;  || N
     #14#4 = #0#9;
     #14#5 = #0#10;
     |GRABA 020#14a;
     |CIERRA #14;
|FPRC;

|PROCESO ContaEtiqueta_1;
     |SI #0#12 = "S";
          |ABRE #13;
          |SELECT #2#13;
          #13#1 = #11#0;
          #13#2 = #11#1;
          |LEE 000#13=;
          |SI FSalida = 0; |CIERRA #13; |ACABA; |FINSI;
          |CIERRA #13;
     |FINSI;

     fFecha = "01.01.0000";

     |ABRE #13;
     |SELECT #1#13;
     #13#0 = fFecha;
     #13#1 = #11#0;
     #13#2 = #11#1;
     |LEE 000#13=;
     |SI FSalida ! 0;
          |DDEFECTO #13;
          #13#0 = fFecha;
          #13#1 = "";
          #13#2 = 0;
          |LEE 101#13=;
          |SI FSalida ! 0; |GRABA 020#13b; |FINSI;
          #13#3 = #13#3 + 1;
          |SI #13#3 > 999;
               #13#3 = 1;
          |FINSI;
          |GRABA 020#13a;

          #13#0 = fFecha;
          #13#1 = #11#0;
          #13#2 = #11#1;

          #13#4 = "N";
          #13#5 = "N";

          fFecha = ~;
          f = fFecha % A1;
          aAlfa = f % 1102;
          aAlfa = aAlfa > "";
          |SI aAlfa = "LU"; #13#6 = "P"; |FINSI;
          |SI aAlfa = "MA"; #13#6 = "R"; |FINSI;
          |SI aAlfa = "MI"; #13#6 = "V"; |FINSI;
          |SI aAlfa = "JU"; #13#6 = "Z"; |FINSI;
          |SI aAlfa = "VI"; #13#6 = "A"; |FINSI;
          |SI aAlfa = "SA"; #13#6 = "A"; |FINSI;
          |SI aAlfa = "DO"; #13#6 = "A"; |FINSI;

          |GRABA 020#13n;
     |FINSI;
     |CIERRA #13;
|FPRC;

|PROCESO Temporal_1;
     |DDEFECTO #13;
     |ABRE #13;
     |SELECT #2#13;
     #13#1 = #11#0;
     #13#2 = #11#1;
     |LEE 000#13=;
     nSal = FSalida;
     |CIERRA #13;
     |SI #0#12 = "N";    || Reimprime
          |SI #13#4 = "S"; |ACABA; |FINSI;
     |SINO;
||        |SI  #13#4 = "N"; |ACABA; |FINSI;
     |FINSI;

     |SI nSw = 0;
          nSw = 1;
          |ERROR10; |ACABA;
     |FINSI;


     |DDEFECTO #2;
     #2#0 = #11#0;
     #2#1 = #11#1;
     |LEE 020#2=;
     enBulto = #2#2;

     |DDEFECTO #104;
     #104#25 = #11#0;
     #104#0 = #11#1;
     |LEE 020#104=;

     |DDEFECTO #73;
     #73#28 = #11#0;
     #73#0 = #11#1;
     #73#1 = #11#7;
     |LEE 020#73=;
     |HAZ LeeAlbaran;

     |DDEFECTO #24;
     #24#0 = #104#4;
     |LEE 020#24=;

     |DDEFECTO #19;
     #19#0 = #11#2; ||   Compo
     |LEE 020#19=;
     enCBcom = #19#128;

     |DDEFECTO #480;
     aAlfa = #11#5; |QBF aAlfa;
     |SI aAlfa ! "";
          #480#0 = #11#5;
          |LEE 020#480=;

          |SALVA_DATOS #19;
          |DDEFECTO #19;
          #19#0 = #11#5; ||   Escan
          |LEE 020#19=;
          enCBart = #19#128;
          |REPON_DATOS #19;
          |LEE 020#19=;
     |SINO;
          #480#0 = #19#0;
          #480#1 = #19#1;
          enCBart = enCBcom;
     |FINSI;

     |DDEFECTO #49;
     |SI #11#6 ! 0;
          #49#0 = #11#5;
          #49#1 = #11#6;
          |LEE 000#49=;
     |FINSI;

     |HAZ ContaEtiqueta_1;
     |HAZ ControlBultos_1;
     |HORA enHora;
     enHora = enHora % 105;
     |PARA i = 1; |SI i [ #11#3; |HACIENDO i = i + 1;
          |PRINT;
          |PIEINF;
     |SIGUE;
|FPRC;

|DEFBUCLE Temporal_1;
     #11#2;
     ;
     #1#3, "  ", 000000, 000, 0000;
     #1#3, "zz", 999999, 999, 9999;
     ;
     NULL, Temporal_1;
|FIN;

|DEFBUCLE Temporal_1P;
     #11#2;
     0, 1;
     #1#3, "  ", 000000, 000, 0000, aSer, nNum;
     #1#3, "zz", 999999, 999, 9999, aSer, nNum;
     ;
     NULL, Temporal_1;
|FIN;

|PROCESO Parrilla1;
     aSer = #103#1;
     aSer = #103#1;
     nNum = #103#2;
     nNum = #103#2;
     |BUCLE Temporal_1P;
|FPRC;

|DEFBUCLE Parrilla1;
     #103#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Parrilla1;
|FIN;

|PROCESO ortsm001_1;
     nSw = 0;
     |BUCLE Temporal_1;
     |SI nSw = 0; |ACABA; |FINSI;

     aImpre = #11#4; |QBF aImpre;
     |SI aImpre = "pantalla";
          |IMPRE 0;
     |SINO;
          Impresora =  aImpre;
          |IMPRE -1;
     |FINSI;
     |SI FSalida = 0;
          aInforme  = #0#15; |QBF aInforme;
          |INFOR aInforme;
          |SI FSalida = 0;
               |SI #0#8 = "S";
                    |BUCLE Parrilla1;
               |SINO;
                    |BUCLE Temporal_1;
               |FINSI;
               |FININF;
          |SINO;
               aAlfa = "0000Falta informe [" + aInforme + "]";
               |MENAV aAlfa;
          |FINSI;
          |FINIMP;
     |SINO;
          aAlfa = "0000Impresora no definida [" + aImpre + "]";
          |MENAV aAlfa;
     |FINSI;
|FPRC;

|DEFBUCLE ortsm001_1;
     #1#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, ortsm001_1;
|FIN;
-----------------------------------
|PROCESO ControlBultos;
     |ABRE #14;
     #14#0 = #10#0;
     #14#1 = #10#1;
     |LEE 101#14=;
     |SI FSalida ! 0; |GRABA 020#14b; |FINSI;
     #14#2 = #2#2;  || T.Bultos
     #14#3 = #13#3;  || N
     #14#4 = #0#9;
     #14#5 = #0#10;
     |GRABA 020#14a;
     |CIERRA #14;
|FPRC;

|PROCESO ContaEtiqueta;
     |ABRE #13;
     |SELECT #2#13;
     #13#1 = #10#0;
     #13#2 = #10#1;
     |LEE 101#13=;
     |CIERRA #13;
|FPRC;

|PROCESO Temporal;
     |ABRE #13;
     |SELECT #2#13;
     #13#1 = #10#0;
     #13#2 = #10#1;
     |LEE 000#13=;
     nSal = FSalida;
     |CIERRA #13;
     |SI nSal ! 0; |ACABA; |FINSI;

     |SI #0#14 = "N";    || Reimprime
          |SI #13#5 = "S"; |ACABA; |FINSI;
     |SINO;
||        |SI #13#5 = "N"; |ACABA; |FINSI;
     |FINSI;

     |SI nSw = 0;
          nSw = 1;
          |ERROR10;
     |FINSI;

     |DDEFECTO #2;
     #2#0 = #10#0;
     #2#1 = #10#1;
     |LEE 020#2=;
     enBulto = #2#2;

     |DDEFECTO #104;
     #104#25 = #10#0;
     #104#0 = #10#1;
     |LEE 020#104=;

     |DDEFECTO #73;
     #73#28 = #10#0;
     #73#0 = #10#1;
     #73#1 = #10#7;
     |LEE 020#73=;
     |HAZ LeeAlbaran;

     |DDEFECTO #24;
     #24#0 = #104#4;
     |LEE 020#24=;

     |DDEFECTO #19;
     #19#0 = #10#2; ||   Compo
     |LEE 020#19=;
     enCBcom = #19#128;

     |DDEFECTO #480;
     aAlfa = #10#5; |QBF aAlfa;
     |SI aAlfa ! "";
          #480#0 = #10#5;
          |LEE 020#480=;

          |SALVA_DATOS #19;
          |DDEFECTO #19;
          #19#0 = #10#5; ||   Escan
          |LEE 020#19=;
          enCBart = #19#128;
          |REPON_DATOS #19;
          |LEE 020#19=;
     |SINO;
          #480#0 = #19#0;
          #480#1 = #19#1;
          enCBart = enCBcom;
     |FINSI;

     |DDEFECTO #49;
     |SI #10#6 ! 0;
          #49#0 = #10#5;
          #49#1 = #10#6;
          |LEE 000#49=;
     |FINSI;

     |HAZ ContaEtiqueta;
     |HAZ ControlBultos;
     |HORA enHora;
     enHora = enHora % 105;
     |PARA i = 1; |SI i [ #10#3; |HACIENDO i = i + 1;
          |PRINT;
          |PIEINF;
     |SIGUE;
|FPRC;

|DEFBUCLE Temporal;
     #10#2;
     ;
     #1#2, "  ", 000000, 000, 0000;
     #1#2, "zz", 999999, 999, 9999;
     ;
     NULL, Temporal;
|FIN;

|DEFBUCLE TemporalP;
     #10#2;
     0, 1;
     #1#2, "  ", 000000, 000, 0000, aSer, nNum;
     #1#2, "zz", 999999, 999, 9999, aSer, nNum;
     ;
     NULL, Temporal;
|FIN;

|PROCESO Parrilla;
     aSer = #103#1;
     aSer = #103#1;
     nNum = #103#2;
     nNum = #103#2;
     |BUCLE TemporalP;
|FPRC;

|DEFBUCLE Parrilla;
     #103#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Parrilla;
|FIN;

|PROCESO ortsm001;
     nSw = 0;
     |BUCLE Temporal;
     |SI nSw = 0; |ACABA; |FINSI;

     aImpre = #10#4; |QBF aImpre;
     Impresora =  aImpre;
     |IMPRE -1;
     |SI FSalida = 0;
          aInforme  = "ortsy001";
          |INFOR aInforme;
          |SI FSalida = 0;
               |SI #0#8 = "S";
                    |BUCLE Parrilla;
               |SINO;
                    |BUCLE Temporal;
               |FINSI;
               |FININF;
          |SINO;
               aAlfa = "0000Falta informe [" + aInforme + "]";
               |MENAV aAlfa;
          |FINSI;
          |FINIMP;
     |SINO;
          aAlfa = "0000Impresora no definida [" + aImpre + "]";
          |MENAV aAlfa;
     |FINSI;
|FPRC;

|DEFBUCLE ortsm001;
     #1#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, ortsm001;
|FIN;

|PROCESO PedCombiUni;
     |SI nCampo [ 25;
          |SI aCombi = "";
               aAlfa = #118#4 + " a ";
               aCombi = #118#5;
               aTira = #118#6;
          |FINSI;
          |SI aCombi ! #118#5; |O aTira ! #118#6;
               aAlfa = aAlfa + aFin;
               #11nCampo = aAlfa;
               nCampo = nCampo + 1;
               |GRABA 020#11a;
               aLon = aAlfa % A0;
               |SI aLon > 50; |Y nCampo [ 25;
                    aAlfa = aAlfa % 51;
                    #11nCampo = aAlfa;
                    nCampo = nCampo + 1;
                    |GRABA 020#11a;
               |FINSI;

               aAlfa = #118#4 + " a ";
               aCombi = #118#5;
               aTira = #118#6;
          |FINSI;
          aFin = #118#4 + " " + #117#5; |QBF aFin;
          aFin = aFin + "-" + #118#5;
          |SI #118#6 ! "    ";
               aFin = aFin + "-" + #118#6;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE PedCombiUni;
     #118#1;
     ;
     #117#0, #117#1, #117#2, #117#3, 1;
     #117#0, #117#1, #117#2, #117#3, 999;
     ;
     NULL, PedCombiUni;
|FIN;

|PROCESO EscanLin;
     #agifa049@#0 = #ortsm020@#0;
     #agifa049@#1 = #ortsm020@#1;
     |LEE 020#agifa049@.=;

     #117#0 = #11#0;
     #117#1 = #11#1;
     #117#2 = #11#7;
     #117#3 = #agifa049@#1;
     |LEE 000#117=;
     |SI FSalida ! 0;  || que no este en el aux pedido, porque sino ya esta incluido
          |SI nCampo [ 25;
               #11nCampo = #agifa049@#3;
               nCampo = nCampo + 1;
               |GRABA 020#11a;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE EscanLin;
     #ortsm020@#2002;
     ;
     #49#0, #49#2;
     #49#0, #49#2;
     ;
     NULL, EscanLin;
|FIN;

|PROCESO AuxEscanLin;
     |SI nCampo [ 25;
/*
          #agifa049@#0 = #120#0;
          #agifa049@#1 = #120#1;
          |LEE 020#agifa049@.=;

          #117#0 = #11#0;
          #117#1 = #11#1;
          #117#2 = #11#7;
          #117#3 = #agifa049@#1;
*/
          #117#0 = #11#0;
          #117#1 = #11#1;
          #117#2 = #11#7;
          #117#3 = #120#1;

          |LEE 000#117=;
          |SI FSalida ! 0; || no esta en el aux pedido, mira en los componentes
               |SI #119#2 = "N";
                    |BUCLE EscanLin;
               |FINSI;
          |SINO;
               |SI #117#8 ! "S";
                    aAlfa = #117#7 + " " + #117#5; |QBF aAlfa;
                    aAlfa = aAlfa + "-" + #117#6;
                    |SI #117#11 ! "    ";
                         aAlfa = aAlfa + "-" + #117#11;
                    |FINSI;
                    #11nCampo = aAlfa;
                    nCampo = nCampo + 1;
                    |GRABA 020#11a;
                    aLon = aAlfa % A0;
                    |SI aLon > 50; |Y nCampo [ 25;
                         aAlfa = aAlfa % 51;
                         #11nCampo = aAlfa;
                         nCampo = nCampo + 1;
                         |GRABA 020#11a;
                    |FINSI;
               |SINO;
                    aCombi = "";
                    |BUCLE PedCombiUni;
                    |SI aCombi ! ""; |Y nCampo [ 25;
                         aAlfa = aAlfa + aFin;
                         #11nCampo = aAlfa;
                         nCampo = nCampo + 1;
                         |GRABA 020#11a;
                         aLon = aAlfa % A0;
                         |SI aLon > 50; |Y nCampo [ 25;
                              aAlfa = aAlfa % 51;
                              #11nCampo = aAlfa;
                              nCampo = nCampo + 1;
                              |GRABA 020#11a;
                         |FINSI;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE AuxEscanLin;
     #120#2;
     ;
     #11#5, #49#2;
     #11#5, #49#2;
     ;
     NULL, AuxEscanLin;
|FIN;

|PROCESO m1;
#120#0 = #11#5;
#120#3 = #49#2;
|FPRC;
|PROCESO m2;
#120#0 = #11#5;
#120#3 = #49#2;
|FPRC;

|PROCESO Componentes;
     |SI nCampo [ 25;
          |SI #119#1 = "S";
               |SI #49#1 = #11#6;
                    |BUCLE AuxEscanLin;
               |FINSI;
          |SINO;
               #11nCampo = #49#3;
               nCampo = nCampo + 1;
               |GRABA 020#11a;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE Componentes;
     #49#1;
     10;
     #11#5, 001, 4;
     #11#5, 999, 4;
     ;
     NULL, Componentes;
|FIN;

|PROCESO PonComponentes;
     #119#0 = #11#5;
     |LEE 000#119=;
     |SI FSalida ! 0; |DDEFECTO #119; |FINSI;
     |SI #119#1 = "S";
          #11#11 = "DESPIECE";
          |GRABA 020#11a;
          nCampo = 12;
     |SINO;
          nCampo = 11;
     |FINSI;
     |BUCLE Componentes;
|FPRC;

|DEFBUCLE PonComponentes;
     #11#1;
     ;
     INICIO;
     FINAL;
     be;
     NULL, PonComponentes;
|FIN;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO agifa049;
     #19#0 = #49#2;
     |LEE 020#19=;

     |SI #49#10 = 4;
          nCuenta = nCuenta + 1;
          |SI #0#16 = "P";
               #2#2 = #2#2 + #73#5 - #73#43; ||Bultos Pedido
          |FINSI;
          |SI #0#16 = "S";
               #2#2 = #2#2 + #73#43; ||Bultos Pedido
          |FINSI;
          |SI #0#16 = "T";
               #2#2 = #2#2 + #73#5;
          |FINSI;
          |DDEFECTO #10;
          #10#4 = #1#2;
          #10#0 = #73#28;
          #10#1 = #73#0;
          #10#7 = #73#1;
          #10#2 = #49#2;
          |LEE 101#10=;
          |SI FSalida ! 0; |GRABA 020#10b; |FINSI;
          |SI #0#16 = "P";
               #10#3 = #10#3 + (#73#5 - #73#43);
          |SINO;
               #10#3 = #10#3 + #73#5;
          |FINSI;
          #10#5 = #49#0;
          #10#6 = #49#1;
          #10#8 = nCuenta;
          #10#9 = nTCuenta;
          |GRABA 020#10a;
          |LIBERA #10;

          |DDEFECTO #11;
          #11#4 = #1#3;
          #11#10 = #49#7;
          #11#0 = #73#28;
          #11#1 = #73#0;
          #11#7 = #73#1;
          #11#2 = #49#2;
          |LEE 101#11=;
          |SI FSalida ! 0; |GRABA 020#11b; |FINSI;
          |SI #0#16 = "P";
               #11#3 = #11#3 + (#73#5 - #73#43);
          |SINO;
               #11#3 = #11#3 + #73#5;
          |FINSI;
          #11#5 = #49#0;
          #11#6 = #49#1;
          #11#8 = nCuenta;
          #11#9 = nTCuenta;
          |GRABA 020#11a;
          |LIBERA #11;

          |DDEFECTO #4;
          #4#0 = #3#0;
          #4#1 = #3#1;
          #4#2 = #3#2;
          #4#3 = #49#2;
          |LEE 101#4=;
          |SI FSalida ! 0; |GRABA 020#4b; |FINSI;
          #4#4 = #49#3;
          #4#6 = #4#6 + (#73#5 - #73#43);
          #4#7 = #4#5;
          #4#8 = 1;
          #4#9 = #19#128;
          |GRABA 020#4a;
          |LIBERA #4;
     |FINSI;
|FPRC;

|DEFBUCLE agifa048;
     #480#1;
     ;
     #73#2;
     #73#2;
     ;
     NULL, NULL, agifa049;
|FIN;

|PROCESO CuentaMate;
     |SI #49#10 = 4;
          nTCuenta = nTCuenta + 1;
     |FINSI;
|FPRC;

|DEFBUCLE CuentaMate;
     #480#1;
     ;
     #73#2;
     #73#2;
     ;
     NULL, NULL, CuentaMate;
|FIN;

|PROCESO agifa073;
     nPen = #73#5 - #73#43;

     |SI #0#16 ! "T";
          |SI #0#16 = "P";
               |SI nPen = 0; |ACABA; |FINSI;
          |SINO;
               |SI #0#16 = "S";
                   |SI nPen ! 0; |ACABA; |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;

     |DDEFECTO #19;
     #19#0 = #73#2;
     |LEE 020#19=;
     aMarca = #19#126;

     |DDEFECTO #1;
     #1#0 = "";     || #19#127;
     |LEE 000#1=;
     |SI FSalida ! 0;
          aAlfa = "0000No se ha  definido la impresora para" + &13 + "[" + #19#0 + "]";
          |MENAV aAlfa;
          |ACABA;
     |FINSI;

     |DDEFECTO #2;
     #2#0 = #73#28;
     #2#1 = #73#0;
     |LEE 101#2=;
     |SI FSalida ! 0; |GRABA 020#2b; |FINSI;

     nSwImp = 0;
     |ABRE #480;
     #480#0 = #19#0;
     |LEE 000#480=;
     |SI FSalida ! 0;
          nSwImp = 1;
     |FINSI;
     |CIERRA #480;

     |SI #19#4 = 1;
          |SI nSwImp = 0;
               |SI #0#16 = "P";
                    #2#2 = #2#2 + #73#5 - #73#43; ||Bultos Pedido
               |FINSI;
               |SI #0#16 = "S";
                    #2#2 = #2#2 + #73#43; ||Bultos Pedido
               |FINSI;
               |SI #0#16 = "T";;
                    #2#2 = #2#2 + #73#5;
               |FINSI;
               |DDEFECTO #10;
               #10#4 = #1#2;
               #10#0 = #73#28;
               #10#1 = #73#0;
               #10#7 = #73#1;
               #10#2 = #73#2;
               |LEE 101#10=;
               |SI FSalida ! 0; |GRABA 020#10b; |FINSI;
               |SI #0#16 = "P";
                    #10#3 = #10#3 + (#73#5 - #73#43);
               |SINO;
                    #10#3 = #10#3 + #73#5;
               |FINSI;
               #10#5 = "";
               #10#8 = 1;
               #10#9 = 1;
               |GRABA 020#10a;
               |LIBERA #10;

               |DDEFECTO #11;
               #11#4 = #1#3;
               #11#10 = aMarca;
               #11#0 = #73#28;
               #11#1 = #73#0;
               #11#7 = #73#1;
               #11#2 = #73#2;
               |LEE 101#11=;
               |SI FSalida ! 0; |GRABA 020#11b; |FINSI;
               |SI #0#16 = "P";
                    #11#3 = #11#3 + (#73#5 - #73#43);
               |SINO;
                    #11#3 = #11#3 + #73#5;
               |FINSI;
               #11#5 = "";
               #11#8 = 1;
               #11#9 = 1;
               |GRABA 020#11a;
               |LIBERA #11;
          |FINSI;

          |DDEFECTO #3;
          #3#0 = #2#0;
          #3#1 = #2#1;
          #3#2 = #73#2;
          |LEE 101#3=;
          |SI FSalida ! 0; |GRABA 020#3b; |FINSI;
          #3#3 = #73#4;
          #3#8 = #73#1;
          #3#9 = #73#6;
          #3#10 = #3#10 + (#73#5 - #73#43);
          #3#11 = #3#4;
          #3#12 = "N";
          #3#13 = #19#128;
          |GRABA 020#3a;
          |LIBERA #3;
     |SINO;
          |DDEFECTO #3;
          #3#0 = #2#0;
          #3#1 = #2#1;
          #3#2 = #73#2;
          |LEE 101#3=;
          |SI FSalida ! 0; |GRABA 020#3b; |FINSI;
          #3#3 = #73#3;
          #3#8 = #73#1;
          #3#9 = #73#6;
          #3#10 = #3#10 + (#73#5 - #73#43);
          #3#11 = #3#4;
          #3#12 = "S";
          #3#13 = #19#128;
          |GRABA 020#3a;
          |LIBERA #3;

          nTCuenta = 0;
          |BUCLE CuentaMate;
          nCuenta = 0;
          |BUCLE agifa048;
     |FINSI;

     |GRABA 020#2a;
     |LIBERA #2;
|FPRC;

|PROCESO Limpi04;
     #4#6 = 0;
     |GRABA 020#4a;
|FPRC;

|DEFBUCLE Limpi04;
     #4#1;
     ;
     #3#0, #3#1, #3#2, "                    ";
     #3#0, #3#1, #3#2, "zzzzzzzzzzzzzzzzzzzz";
     be;
     NULL, Limpi04;
|FIN;

|PROCESO Limpi03;
     |BUCLE Limpi04;
     #3#10 = 0;
     |GRABA 020#3a;
|FPRC;

|PROCESO Limpi02;
     ||SI #0#16 = "P"; |O #0#16 = "S";
          #2#2 = 0;
     ||FINSI;
     |GRABA 020#2a;
|FPRC;

|DEFBUCLE Limpi02;
     #2#1;
     ;
     #104#25, #104#0;
     #104#25, #104#0;
     be;
     NULL, Limpi02, Limpi03;
|FIN;

|PROCESO agifa104;
     |BUCLE Limpi02;
     |ABRE #2;
     |ABRE #3;
     |ABRE #4;
|FPRC;

|PROCESO Fin;
     |CIERRA #4;
     |CIERRA #3;
     |CIERRA #2;
|FPRC;

|DEFBUCLE agifa104;
     #104#1;
     1, 4;
     aDesSer, nDesNum, #0#4, #0#6;
     aHasSer, nHasNum, #0#5, #0#7;
     ;
     NULL, agifa104, agifa073, Fin;
|FIN;

|PROCESO ortsy003;
     aDesSer = #ortsy003#1;
     aHasSer = #ortsy003#1;
     nDesNum = #ortsy003#2;
     nHasNum = #ortsy003#2;
     |BUCLE agifa104;
|FPRC;

|DEFBUCLE ortsy003;
 #ortsy003#1;
 ;
 INICIO;
 FINAL;
 ;
 NULL, ortsy003;
|FIN;


|PROCESO Parilla; |TIPO 0;
     |SI #ortsy001#8 = "S";
          |C_M #ortsy001#0, 1, "N";
          |C_M #ortsy001#1, 1, "N";
          |C_M #ortsy001#2, 1, "N";
          |C_M #ortsy001#3, 1, "N";
          |HAZ SelParilla;
     |SINO;
          |C_M #ortsy001#0, 1, "S";
          |C_M #ortsy001#1, 1, "S";
          |C_M #ortsy001#2, 1, "S";
          |C_M #ortsy001#3, 1, "S";
     |FINSI;
|FPRC;

|PROCESO inf;
     #ortsy003#0 = 0;
|FPRC;

|PROCESO sup;
     #ortsy003#0 = 999;
|FPRC;

|PROCESO SelParilla;
     |PINPA #0#103;
     |ENTLINEAL #1#ortsy003, 1, 1, 22, 0, inf, sup;
|FPRC;

|PROCESO PedidoImpreso;
     |SELECT #2#13;
     #13#1 = #11#0;
     #13#2 = #11#1;
     |LEE 000#13=;
     |SI FSalida = 0;
          |SI #0#11 = "S";
               #13#4 = "S";
          |FINSI;
          |SI #0#13= "S";
               #13#5= "S";
          |FINSI;
          |GRABA 020#13a;
          |LIBERA #13;
     |FINSI;
|FPRC;

|DEFBUCLE PedidoImpreso;
     #11#2;
     ;
     INICIO;
     FINAL;
     be;
     NULL, PedidoImpreso;
|FIN;

|PROCESO Tipo3; |TIPO 3;
     |DDEF aPath;
     aAlfa = aPath + "agifa049"; |CARGA_DEF aAlfa, agifa049@;
     aAlfa = aPath + "ortsm020"; |CARGA_DEF aAlfa, ortsm020@;

     aAlfa = "1" + Usuario;
     |NOME_DAT #10 aAlfa; |DELINDEX #10;
     aAlfa = "2" + Usuario;
     |NOME_DAT #11 aAlfa; |DELINDEX #11;

     |ABRE #1;
     |ABRE #10;
     |ABRE #11;
     |ABRE #19;
     |SI #ortsy001#8 = "N";        ||Como hasta ahora
          aDesSer = #ortsy001#0;
          aHasSer = #ortsy001#1;
          nDesNum = #ortsy001#2;
          nHasNum = #ortsy001#3;
          |BUCLE agifa104;
     |SINO;
          |BUCLE ortsy003;
     |FINSI;
     |CIERRA #19;
     |CIERRA #11;
     |CIERRA #10;
     |CIERRA #1;

     |ABRE #104;
     |ABRE #480;
     |ABRE #19;
     |ABRE #2;
     |ABRE #24;
     |ABRE #49;
     |ABRE #71;
     |ABRE #73;

     |ABRE #119;
     |ABRE #117;
     |ABRET #agifa049@;

     || aqui el #11 contiene los componentes de escandallo Tipo=4 (montadores)
     ||ABRE #11; |CONSULTA_CLAVE #1#11;

     |BUCLE PonComponentes;

     |CIERRAT #agifa049@;
     |CIERRA #117;
     |CIERRA #119;

     |SI #0#11 = "S";    ||Montadores
          |BUCLE ortsm001_1;
     |FINSI;

||MENAV "0000Se va a proceder a imprimir las etiquetas del montador, pulse intro para continuar";

     |SI #0#13 = "S";    ||Carga
          |BUCLE ortsm001;
     |FINSI;

     |ABRE #13;
     |BUCLE PedidoImpreso;
     |CIERRA #13;

     |CIERRA #71;
     |CIERRA #73;
     |CIERRA #49;
     |CIERRA #24;
     |CIERRA #2;
     |CIERRA #19;
     |CIERRA #480;
     |CIERRA #104;

     |DELINDEX #10;
     |DELINDEX #11;
     |DELINDEX #ortsy003;

     |DESCARGA_DEF #ortsm020@;
     |DESCARGA_DEF #agifa049@;
|FPRC;
