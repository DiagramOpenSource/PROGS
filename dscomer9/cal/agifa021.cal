|FICHEROS;
  agifa021 #0;
  agifa079 #1;
  agifa077 #2;
  agifa007 #10;
  tempo134 #134;
  agifa142 #142;
  referen@;
|FIN;

|VARIABLES;
     nNoFactu = 0;
     aPtec = "";
     nPtec = 0;
     nLin = 0;
     &enSalida = 0;
     nModo = 0;
     &enSwMenu = 0;
     aAlfa = "";
     &prov = "";
     &fpago = "";
     &dto = 0;
     &dtoa = 0;
     &dtop = 0;
     &factur = 2;
     &Tempo          = "";
     aTempo134       = "";
     &nDeci_Base     = 0;   || Decimales en Totales de la moneda base
     &nDeci_PreBase  = 0;   || Decimales en el Precio en moneda base
     &nDeci_BaseMx   = 0;   || Decimales en Totales de la moneda base
     &nDeci_PreBaseMx= 0;   || Decimales en el Precio en moneda base
     &nDeci_DivF     = 0;   || Decimales en Totales de la divisa
     &nDeci_PreDivF  = 0;   || Decimales en el Precio en divisa
     &nDeci_TotVisF  = 0;   || Decimales en Totales visibles (el de la moneda de trabajo)
     &nDeci_TotNoVisF = 0;   || Decimales en Totales no visibles (el de la otra moneda)
     &nDeci_PreVisF  = 0;   || Decimales en el Precio visual. (lineas)
     &nDeci_ImpVisF  = 0;   || Decimales en el Importe visual. (lineas)
serie_fac = "";
serie_alb = "";
alfa = "";
aDSerie = "";
aHSerie = "";
fichero = "";
|FIN;

|PROCESO llenar3;|TIPO 0;
 |ABRE #142;
 |LEE 000#142p;
 |SI FSalida = 0; |Y #142#46 = "S";
   alfa = "000000" +  #0#2;
   |QBF alfa;
   alfa = alfa % -106;
   #0#2 = alfa;
   |PINTA #0#2;
 |FINSI;
 |CIERRA #142;
|FPRC;

|PROCESO nofac;
       #134#0 = #2#50; ||Serie
       #134#1 = #2#0;  ||Albaran
       #134#2 = #2#3;
       #134#3 = #2#4;
       #134#4 = #2#8;
       #134#5 = #2#66;
       |GRABA 001#134n;
|FPRC;
/*
|DEFBUCLE leealbs;
     #2#1;
     3, 42, 38;
     aDSerie , 000000 , #1#2, "S", "N" ;
     aHSerie , 999999 , #1#2, "S", "N" ;
     ;
     NULL,nofac;
|FIN;
*/
|DEFBUCLE leealbs;
     #2#6;
     3, 42, 38;
     "     ", 000000, aDSerie, 000001, #1#2, "S", "N";
     "     ", 000000, aHSerie, 999999, #1#2, "S", "N";
     ;
     NULL, nofac;
|FIN;


|PROCESO apendc2; |TIPO 6;
      nModo = (FEntrada / 100) ! 0;

     prov  = #1#2;
     fpago = #1#11;
     dto   = #1#4;
     dtoa  = #1#5;
     dtop  = #1#6;
     |SI FSalida = 13;           || <F5> Nuevo Alba
          |SI nModo = 1;
               |ABRE #2;
               enSwMenu = 1;
               #2#50 = #0#17;         ||Serie
               |HAZ ContaAC7;
               |CIERRA #2;
               #0#2 = #2#0;           ||Conta
          |FINSI;
          aAlfa = "dsz99957;S" + #0#17 + #0#2;
          |SUB_EJECUTA aAlfa;
          |SI enSalida ! 0; |ERROR; |ACABA; |FINSI;
     |FINSI;

     |SI FSalida = 12;
       |HAZ CreaTempo; aTempo134 = Tempo;
       |NOME_DAT #134 aTempo134; |DELINDEX #134;
       |ABRE #134;
       |SI Campo = 17; ||Llamado desde campo serie
            aDSerie = "  ";
            aHSerie = "zz";
        |SINO; ||Llamado desde
            aDSerie = #0#17;
            aHSerie = #0#17;
        |FINSI;
        |BUCLE leealbs;
        |SI Campo = 17; ||Llamado desde campo serie
            |CONSULTA_CLAVE #1#134;
            |SI FSalida = 0; ||Intro
               #0#17  = #134#0; ||Pongo Serie seleccionada
               #0#2   = #134#1; ||Pongo N
               |PINTA #0#17;
               |PINTA #0#2;
               |PTEC 802;
            |SINO;
               |ENCAMPO #17#0;  ||Entro el N seleccionado para evitar salto a s
            |FINSI;
        |SINO;
            |CONSULTA_CLAVE #2#134; ||Llamado desde
            |SI FSalida = 0; ||Intro
               #0#2  = #134#1; ||Pongo N
               |PINTA #0#2;
            |SINO;
               |ENCAMPO #2#0;  ||Entro el N seleccionado para evitar salto a s
            |FINSI;
        |FINSI;
        |CIERRA #134;

        |DELINDEX #134; Tempo = aTempo134; |HAZ BoraTempo;
        |ACABA;
     |FINSI;
     |SI Campo = 2;
          |ABRE #2;
          #2#50 = #0#17;
          #2#0 = #0#2;
          |LEE 000#2=;
          |SI FSalida ! 0; |Y #0#2 ! 0;
               aAlfa = "dsz99957;S" + #0#17 + #0#2;
               |SUB_EJECUTA aAlfa;
               |SI enSalida ! 0; |ERROR; |FINSI;
          |FINSI;
          |CIERRA #2;
     |FINSI;
|FPRC;

|PROCESO CompDiv; |TIPO 0;
|ABRE #agifa007;
#agifa007#26 = #0#16;
|LEE 010#agifa007.=;
serie_fac = #agifa007#39;
#agifa007#26 = #0#17;
|LEE 010#agifa007.=;
serie_alb = #agifa007#39;
|CIERRA #agifa007;
|SI serie_alb ! serie_fac;
  |SI serie_alb = "S";
    |MENAV "0000La serie de la factura abono no es de divisas";
  |SINO;
    |MENAV "0000La serie de la factura abono es de divisas";
  |FINSI;
  |ERROR;
|FINSI;
|FPRC;

|PROCESO MinC021;
     #referen@#16 = #1#66;
     #referen@#0 = #1#0;
     #referen@#1 = 001;
|FPRC;

|PROCESO MaxC021;
     #referen@#16 = #1#66;
     #referen@#0 = #1#0;
     #referen@#1 = 999;
|FPRC;

|PROCESO Consulta021; |TIPO 66;
     nLin = 0;
     |DDEF aAlfa;
     aAlfa = aAlfa + "agifa072";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          |CONSULTA_F_CLAVE #1#referen@, MinC021, MaxC021;
          |SI FSalida = 0; nLin = #referen@#1; |FINSI;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
     |SI nLin ! 0;
          |PTEC 802;
          aAlfa = ("000" + nLin) % -103;
          aPtec = aAlfa % 301; nPtec = &aPtec;
          |PTEC nPtec;
          aPtec = aAlfa % 201; nPtec = &aPtec;
          |PTEC nPtec;
          aPtec = aAlfa % 101; nPtec = &aPtec;
          |PTEC nPtec;
     |FINSI;
|FPRC;

|PROCESO DefSerie; |TIPO 7;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 1;
          #0#17 = #1#66;
          |SI #agifa142#185 = "S"; #0#17 = #agifa142#193; |FINSI;
     |FINSI;
     |HAZ MensaNoFactu;
|FPRC;


|PROCESO NoFactu;
     nNoFactu = nNoFactu + 1;
|FPRC;

|DEFBUCLE NoFactu;
     #2#6;
     3, 42, 38;
     "     ", 000000, aDSerie, 000001, #1#2, "S", "N";
     "     ", 000000, aHSerie, 999999, #1#2, "S", "N";
     ;
     NULL, NoFactu;
|FIN;

|PROCESO MensaNoFactu; |TIPO 7;
     |SI Campo = 17;
          aDSerie = "     ";
          aHSerie = "zzzzz";
     |SINO;
          aDSerie = #0#17;
          aHSerie = #0#17;
     |FINSI;

     nNoFactu = 0;
     |BUCLE NoFactu;
     |SI Campo = 17;
          aAlfa = "0000<F4> Albaranes sin facturar: [" + nNoFactu + "]    <F5> Alta/Modificacion Albaran";
     |SINO;
          aAlfa = "0000<F4> Albaranes sin facturar: [" + nNoFactu + "]    <F5> Alta/Modificacion Albaran";
     |FINSI;
     |MENSA aAlfa;
|FPRC;
