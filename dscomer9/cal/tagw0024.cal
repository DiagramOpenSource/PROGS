|FICHEROS;
     agifa017 #17;
     agifa019 #19;
     tagm0021 #21; ||Arti Cli/Com
     tagm0030 #30; ||Block
     tagm0031 #31; ||Bock Lin
     tagm0032 #32; ||Accesorios
     tagm0036 #36; ||Histo
     agifa065 #65;
     agifa067 #67; ||Pedi Com. Lin
     agifa069 #69; ||F.D. Vta. Lin
     agifa071 #71; ||Alba Vta. Lin
     agifa080 #80; ||Alba Com. Lin
     agifa081 #81; ||Pedi Com. Cab
     dsm00238 #238;
|FIN;

|VARIABLES;
     aAlfa = "";
     nLin = 0;
     nUni2 = 0;
     &efDfecha  = @;
     &efHfecha = @;
     &eaDarti = "";
     &eaHarti = "";
     nAbo = 0;
     nCampoInterno = 0;
     aArt = "";
     nUni = 0;
     nForma = 0;
     nSwPuerta = 0;
|FIN;

|PROCESO SumaStockBlock;
     |SI aArt < eaDarti; |O aArt > eaHarti;
          |ACABA;
     |FINSI;
     |QBF aArt; |SI aArt = ""; |ACABA; |FINSI;

     |DDEFECTO #19;
     #19#0 = aArt;
     |LEE 101#19=;
     |SI FSalida ! 0; |GRABA 020#19b; |FINSI;
     |DDEFECTO #17;
     #17#0 = aArt;
     #17#1 = 1;     || Almacen
     |LEE 101#17=;
     |SI FSalida ! 0; |GRABA 020#17b; |FINSI;

     nUni = nUni * #31#3;
     #19#12 = #19#12 + (nUni * nForma);
     #19#104 = #19#104 - (nUni * nForma);
||     #19#6 = #19#6 - (nUni * nForma);
     #19#15 = #19#15 + (nUni * nForma);

     #17#8 = #17#8 + (nUni * nForma);
     #17#39 = #17#39 - (nUni * nForma);
||     #17#5 = #17#5 - (nUni * nForma);
     #17#42 = #17#42 - (nUni * nForma);
     nUni2 = 0;
     |SI #19#179 = "S";
          |DDEFECTO #238;
          #238#0 = #19#201;
          |LEE 000#238=;
          |SI nSwPuerta = 0; |Y #238#8 > 0;
               |SI #238#8 = 1; nUni2 = nUni * #19#189; |FINSI;
               |SI #238#8 = 2; nUni2 = nUni * #19#189 * #19#190; |FINSI;
               |SI #238#8 = 3; nUni2 = nUni * #19#189 * #19#190 * #19#191; |FINSI;
          |FINSI;
          |SI nSwPuerta = 1; |Y #238#8 > 0;
               |SI #238#8 = 1; nUni2 = nUni * #31#20; |FINSI;
               |SI #238#8 = 2; nUni2 = nUni * #31#20 * #31#19; |FINSI;
               |SI #238#8 = 3; nUni2 = nUni * #31#20 * #31#19 * #31#21; |FINSI;
          |FINSI;
          |SI nSwPuerta = 2; |Y #238#8 > 0;
               |SI #238#8 = 1; nUni2 = nUni * #31#86; |FINSI;
               |SI #238#8 = 2; nUni2 = nUni * #31#86 * #31#85; |FINSI;
               |SI #238#8 = 3; nUni2 = nUni * #31#86 * #31#85 * #31#87; |FINSI;
          |FINSI;
     |FINSI;

     #19#193 = #19#193 - (nUni2 * nForma);
     #19#182 = #19#182 + (nUni2 * nForma);
||     #19#185 = #19#185 - (nUni2 * nForma);
     #17#48 = #17#48 - (nUni2 * nForma);
     #17#44 = #17#44 + (nUni2 * nForma);
     #17#44 = #17#44 + (nUni2 * nForma);
||     #17#47 = #17#47 - (nUni2 * nForma);

     |HAZ ValoraStock;

     |GRABA 020#19a;
     |LIBERA #19;
     |GRABA 020#17a;
     |LIBERA #17;
|FPRC;

|PROCESO Accesorios;
     |SI #32#3 < eaDarti; |O #32#3 > eaHarti;
          |ACABA;
     |FINSI;

     #19#0 = #32#3;
     |LEE 101#19=;
     |SI FSalida = 0;
          |DDEFECTO #17;
          #17#0 = #32#3;
          #17#1 = 1;
          |LEE 101#17=;
          |SI FSalida ! 0; |GRABA 020#17b; |FINSI;

          #19#15 = #19#15 + #32#5;
          #19#182 = #19#182 + #32#6;
          #19#12 = #19#12 + #32#5;

     ||     #19#6 = #19#6 - #32#5;
     ||     #19#185 = #19#185 - #32#6;
          #19#104 = #19#104 - #32#5;
          #19#193 = #19#193 - #32#6;

          #17#42 = #17#42 + #32#5;
          #17#44 = #17#44 + #32#6;
          #17#8 = #17#8 + #32#5;

     ||     #17#5 = #17#5 - #32#5;
     ||     #17#47 = #17#47 - #32#5;
          #17#39 = #17#39 - #32#5;
          #17#48 = #17#48 - #32#5;

          |HAZ ValoraStock;
          |GRABA 020#19a;
          |GRABA 020#17a;
          |LIBERA #17;
          |LIBERA #19;
     |FINSI;
|FPRC;

|DEFBUCLE Accesorios;
     #32#1;
     ;
     #30#0, #30#1, 001;
     #30#0, #30#1, 999;
     ;
     NULL, Accesorios;
|FIN;

|PROCESO CabBlock;
     |BUCLE Accesorios;
|FPRC;

|PROCESO StockBlock;
     nForma = 1;
     nSwPuerta = 0;
     aArt = #31#7; nUni = #31#40; |HAZ SumaStockBlock;
     nSwPuerta = 1;
     aArt = #31#17; nUni = 1; |HAZ SumaStockBlock;
     |SI #31#5 = "D";
          nSwPuerta = 2;
          aArt = #31#81; nUni = 1; |HAZ SumaStockBlock;
     |FINSI;
     nSwPuerta = 0;
     aArt = #31#24; nUni = #31#23; |HAZ SumaStockBlock;
     aArt = #31#27; nUni = #31#26; |HAZ SumaStockBlock;
     aArt = #31#90; nUni = #31#89; |HAZ SumaStockBlock;
     aArt = #31#30; nUni = #31#29; |HAZ SumaStockBlock;
     aArt = #31#33; nUni = #31#32; |HAZ SumaStockBlock;
     aArt = #31#36; nUni = #31#35; |HAZ SumaStockBlock;
     aArt = #31#43; nUni = 1; |HAZ SumaStockBlock;
     aArt = #31#52; nUni = 1; |HAZ SumaStockBlock;
|FPRC;

|DEFBUCLE StockBlock;
     #30#1;
     2, 24;
     "     ", 000001, efDfecha, " ";
     "zzzzz", 999999, efHfecha, " ";
     ;
     NULL, CabBlock, StockBlock;
|FIN;

|PROGRAMA;
     |HAZ ArtVarios;

     |ABRE #17;
     |ABRE #19;
     |ABRE #238;
     |BUCLE StockBlock;
     |CIERRA #238;
     |CIERRA #19;
     |CIERRA #17;
|FPRO;
