|FICHEROS;
     foto0018 #0; ||Exportacion
     foto0015 #1; ||Cabecera sobres
     foto0016 #2; ||Lineas sobres
     foto0x18 #3; ||Cabecera fantasma
     foto0z18 #4; ||Lineas fantasma
     foto0020 #5; ||Control path import
     foto0032 #6; ||Control path export
|FIN;

|VARIABLES;
     Dato="";
     Sobre="";
     i=0;
     Hora="";
     Fec=~;
     blanco1="         ";
     pintar="";
     path="";
     tiendainicial="";
     atiendafinal="";
     ntiendafinal=0;
     ntiendaactual=0;
     atiendaactual="";
     numerotienda=0;
|FIN;

||*************************************************************

|PROCESO ExportaFich;
     |ABRE #3;
     |PINTA 2163 , blanco1;
     pintar = #1#0;
     |PINTA 2163 , pintar;
     ||Actualizo los campos
     |PARA i = 0; |SI i [ 38; |HACIENDO i = i + 1;
          #3i = #1i; ||igualo todos los campos
     |SIGUE;
     |GRABA 011#3n; || grabo el nuevo
     #1#17="S";
     |GRABA 011#1a; || grabo exportado="S"
     |ABRE #4;
     |BUCLELIN 2linsobre#1;     || Por cada una de las lineas del sobre
     |CIERRA #4;

|FPRC;

|PROCESO linsobre;        ||Lineas de sobre
||Actualizo los campos
     |PARA i = 0; |SI i [ 15; |HACIENDO i = i + 1;
          #4i = #2i;
     |SIGUE;

     |GRABA 011#4n;      ||Grabo en el fichero destino;
|FPRC;


|DEFBUCLE exporta;
#1#3;
;
#0#4,#0#2,"F",atiendaactual,"N";
#0#5,#0#3,"F",atiendaactual,"N";
be;
NULL, ExportaFich;
|FIN;

||*************************************************************

|PROCESO Tipo3; |TIPO 3;
          tiendainicial=#0#0;
          atiendafinal=#0#1;
          ntiendafinal=atiendafinal;
          atiendaactual=#0#0;
          |ABRE #6;
          |SELECT #2#6;
          |PARA ntiendaactual=atiendaactual;|SI ntiendaactual[ntiendafinal;|HACIENDO ntiendaactual=ntiendaactual+1;
           atiendaactual="00" + ntiendaactual;
           atiendaactual=atiendaactual % -102;
           #6#0=atiendaactual;
           |LEE 000#6=;
           |SI FSalida=0;
               path=#6#1;
               |QBF path;
               |PATH_DAT #3 path;   || Informo del camino de exportacion
               |ABRE #3;
               |DELINDEX #3;
               |CIERRA #3;
               |PATH_DAT #4 path;   || Informo del camino de exportacion
               |ABRE #4;
               |DELINDEX #4;
               |CIERRA #4;
               |BUCLE exporta;
           |FINSI;
          |SIGUE;
|FPRC;
