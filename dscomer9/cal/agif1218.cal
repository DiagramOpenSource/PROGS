     || RECALCULA IMPORTES PEDIDO COMPRAS

     || USADO POR: agifa218, dsz00007

|FICHEROS;
     agifa081 #81;  || cab ped.compra
     agifa067 #67;  || lin ped compra
     agifa019 #19;
|FIN;

|VARIABLES;
     nImpDiv   = 0;
     nPend     = 0;
     nPPort1   = 0;
     nPPort2   = 0;
|FIN;

|PROCESO RecalPedCom;
     |ABRE #19;
     #19#0 = #67#2;
     |LEE 020#19=;
     |CIERRA #19;

     #67#56 = #67#5 * #19#208;

     |SI #81#29 = "D";
          #67#6   = #67#33 / #81#28 * #81#33;
          #67#35  = #67#6;
          nPPort1 = #67#50 / #81#28 * #81#33;
          nPPort2 = #67#50;
     |SINO;
          #67#33  = #67#6  / #81#33 * #81#28; || .. recalculo precio en funcion de la moneda base
          #67#35  = #67#33;                 || ... el campo visual. es el precio en divisa
          nPPort1 = #67#50;
          nPPort2 = #67#50 / #81#33 * #81#28;
     |FINSI;

     |SI #19#196 = 2;
          #67#7    = #67#41 * #67#6; ||Importe
          nImpDiv = #67#41 * #67#33;
     |SINO;
          #67#7    = #67#5  * #67#6;  ||Importe
          nImpDiv = #67#5  * #67#33; ||Importe
     |FINSI;

     #67#9 = ((#67#7 < #67#8) < #67#27) < #67#57;
     #67#34 = ((nImpDiv < #67#8) < #67#27) < #67#57;
     |SI #19#196 = 2;
          #67#9  = (#67#9  + (#67#41 * nPPort1));
          #67#34 = (#67#34 + (#67#41 * nPPort2));
     |SINO;
          #67#9  = (#67#9  + (#67#5  * nPPort1));
          #67#34 = (#67#34 + (#67#5  * nPPort2));
     |FINSI;
     #67#9  = ((#67#9  < #81#5) < #81#17) < #81#6;
     #67#34 = ((#67#34 < #81#5) < #81#17) < #81#6;

     |SI #81#29 = "D";             || Si la moneda de trabajo es la divisa ...
          #67#36 = #67#9;           || el campo visualiz. es el importe en moneda base
     |SINO;                       || Si la moneda de trabajo es la moneda base ...
          #67#36 = #67#34;          || el campo visualiz. es el importe en divisa
     |FINSI;

     |SI #19#196 = 2;
          #67#11 = (#67#41 - #67#38) * #67#6;
          #67#11 = ((#67#11 < #67#8) < #67#27) < #67#57;
          #67#11 = #67#11 + ((#67#41 - #67#38) * nPPort1);
     |SINO;
          #67#11 = (#67#5 - #67#38) * #67#6;
          #67#11 = ((#67#11 < #67#8) < #67#27) < #67#57;
          #67#11 = #67#11 + ((#67#5 - #67#38) * nPPort1);
     |FINSI;

     #67#11 = ((#67#11 < #81#5) < #81#17) < #81#6;

     ||컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
     #81#11 = #81#11 + #67#9;
     #81#12 = #81#12 + #67#11;
     #81#13 = #81#11 - #81#12;
     #81#44 = #81#44 + #67#56;

     |SI #19#196 = 2;
         nPend = (#67#41 - #67#38) * #67#33;
     |SINO;
         nPend = (#67#5 - #67#38) * #67#33;
     |FINSI;

     nPend = ((nPend < #67#8) < #67#27) < #67#57;

     |SI #19#196 = 2;
         nPend = nPend + ((#67#41 - #67#38) * nPPort2)
     |SINO;
         nPend = nPend + ((#67#5  - #67#38) * nPPort2);
     |FINSI;

     nPend = ((nPend < #81#5) < #81#17) < #81#6;

     #81#34 = #81#34 + #67#34;
     #81#35 = #81#35 + nPend;
     #81#36 = #81#34 - #81#35;

     |SI #81#29 = "D"; || Si la moneda de trabajo es la divisa
          #81#37 = #81#34;
          #81#38 = #81#35;
          #81#39 = #81#36;
          #81#40 = #81#11;
          #81#41 = #81#12;
          #81#42 = #81#13;
     |SINO;
          #81#37 = #81#11;
          #81#38 = #81#12;
          #81#39 = #81#13;
          #81#40 = #81#34;
          #81#41 = #81#35;
          #81#42 = #81#36;
     |FINSI;

     |GRABA 020#81a;
     |GRABA 020#67a;
|FPRC;

|PROCESO AceraPedCom;
     #81#11 = 0;
     #81#12 = 0;
     #81#13 = 0;
     #81#34 = 0;
     #81#35 = 0;
     #81#36 = 0;
     #81#44 = 0;
|FPRC;
