|FICHEROS;
     albap021 #0;
     alba0007 #7;
     agifa019 #19;
     agifa010 #10;
     agifa065 #65;
     agifa071 #71;
     referen@ #100;
|FIN;

|VARIABLES;
     nAbo = 0;
     nLin = 0;
     aAlfa = "";
|FIN;

|PROCESO CreaLinPromo;
     |ABRE #referen@;
     #referen@#29 = #71#29;
     #referen@#0 = #71#0;
     #referen@#1 = 999;
     |LEE 000#referen@.];
     |SI FSalida = 0;
          |LEE 000#referen@.a;
     |SINO;
          |LEE 000#referen@.u;
     |FINSI;
     |SI FSalida = 0; |Y #referen@#29 = #71#29;  |Y #referen@#0 = #71#0;
          nLin = #referen@#1 + 1;
     |SINO;
          nLin = 1;
     |FINSI;
     |SI nLin = #71#1; nLin = nLin + 1; |FINSI;

     |SALVA_DATOS #71;
     |REPON_DATOS #referen@;

     #referen@#1 = nLin;
     #referen@#5 = #7#5;
     #referen@#6 = 0;
     #referen@#7 = 0;
     #referen@#8 = 0;
     #referen@#9 = 0;
     #referen@#36 = 0;
     #referen@#37 = 0;
     #referen@#38 = 0;
     #referen@#39 = 0;
     #referen@#63 = -1;

     |GRABA 020#referen@.n;
     |CIERRA #referen@;

     #65#0 = #71#2;
     #65#1 = #10#1;
     |SI #10#43 = "N";
          #65#2 = "AV";
     |SINO;
          #65#2 = "BV";
     |FINSI;
     #65#3 = #71#0;
     #65#4 = nLin;
     #65#11 = #71#29;
     |LEE 101#65=;
     |SI FSalida = 0; |BORRA 020#65a; |FINSI;
     #65#6 = (-#referen@#5) * nAbo;
     |GRABA 020#65n;
|FPRC;

|PROCESO agifa071Borra;
     |SI #71#63 = -1;
          |BORRA 020#71a;
          #65#0 = #71#2;
          #65#1 = #10#1;
          |SI #10#43 = "N";
               #65#2 = "AV";
          |SINO;
               #65#2 = "BV";
          |FINSI;
          #65#3 = #71#0;
          #65#4 = #71#1;
          #65#11 = #71#29;
          |LEE 101#65=;
          |SI FSalida = 0;
               |BORRA 020#65a;
          |FINSI;

          |LIBERA #65;
          |LIBERA #10;
          |LIBERA #71;
     |FINSI;
|FPRC;

|PROCESO agifa071;
     #7#0 = "AV";
     #7#1 = #71#29;
     #7#2 = #71#0;
     #7#3 = #71#1;
     |LEE 000#7=;
     |SI FSalida = 0; |Y #7#5 > 0;
          || Corrige historico
          |DDEFECTO #65;
          #65#0 = #71#2;
          #65#1 = #10#1;
          |SI #10#43 = "N";
               nAbo = 1;
               #65#2 = "AV";
          |SINO;
               nAbo = -1;
               #65#2 = "BV";
          |FINSI;
          #65#3 = #71#0;
          #65#4 = #71#1;
          #65#11 = #71#29;
          |LEE 101#65=;
          |SI FSalida = 0;
               #65#6 = (-#7#4)*nAbo;
               #65#17 = 0;
               |GRABA 020#65a;
               |LIBERA #65;
          |FINSI;
          |HAZ CreaLinPromo;
          #71#5 = #7#4;
          #71#63 = nLin;
          #71#64 = #7#19;
          #71#65 = #7#20;
          #71#66 = #7#5;
          |GRABA 020#71a;
     |FINSI;
     |LIBERA #10;
     |LIBERA #71;
|FPRC;

|DEFBUCLE agifa010;
     #10#1;
     ;
     INICIO;
     FINAL;
     be;
     NULL, NULL, agifa071;
|FIN;

|DEFBUCLE agifa010Borra;
     #10#1;
     ;
     INICIO;
     FINAL;
     be;
     NULL, NULL, agifa071Borra;
|FIN;

|PROCESO agifa019;
     #19#194 = 1;
     |GRABA 020#19a;
     |LIBERA #19;
|FPRC;

|DEFBUCLE agifa019;
     #19#1;
     ;
     INICIO;
     FINAL;
     be;
     NULL, agifa019;
|FIN;

|PROCESO Tipo3; |TIPO 3;
     |SI #0#0 ! "SI"; |ACABA; |FINSI;

     |BUCLE agifa019;

     |DDEF aAlfa; aAlfa = aAlfa + "agifa071";
     |CARGA_DEF aAlfa, referen@;
     |ABRE #65;
     |ABRE #7;
     |BUCLE agifa010Borra;
     |BUCLE agifa010;
     |CIERRA #7;
     |CIERRA #65;
|FPRC;
