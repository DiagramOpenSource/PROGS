|FICHEROS;
     agifa024 #24;
     agifa059 #59;
     agifa134 #134;

     dsm00087@;
     referen@;
|FIN;

|VARIABLES;
     aAlfa = "";
     nTipo = 0;
     aSer = "";
     aNum = "";
     aTipo = "";
     nContaLog = 0;
     aUsu = "";
     aDocu = "";
     aPath = "";
     aSerNum = "";
|FIN;

|PROCESO &T134_15; |TIPO 15;
     nTipo = 15; |HAZ Log134;
|FPRC;

|PROCESO &T134_16; |TIPO 16;
     nTipo = 16; |HAZ Log134;

     aTipo = "M";
     aDocu = "agifa134";
     |HAZ CongeCopiaFac;
|FPRC;

|PROCESO &T134_17; |TIPO 17;
     nTipo = 17; |HAZ Log134;

     aTipo = "B";
     aDocu = "agifa134";
     |HAZ CongeCopiaFac;
|FPRC;

|PROCESO Log134;
     |DDEF aAlfa;
     aAlfa = aAlfa + "dsm00087";
     |CARGA_DEF aAlfa, dsm00087@;
     |SI FSalida ! 0; |ACABA; |FINSI;

     aSer = #134#49;
     aNum = ("000000" + #134#0) % -106;
     aTipo = "FV";

     |ABRE #dsm00087@;
     |DDEFECTO #dsm00087@;
     |SELECT #2#dsm00087@;
     #dsm00087@#1 = aSer;
     #dsm00087@#2 = aNum;
     #dsm00087@#3 = aTipo;
     |LEE 101#dsm00087@.=;
     |SI FSalida ! 0;
          |SELECT #1#dsm00087@;
          |LEE 000#dsm00087@.u;
          |SI FSalida = 0;
               nContaLog = #dsm00087@#0 + 1;
          |SINO;
               nContaLog = 1;
          |FINSI;
          |DDEFECTO #dsm00087@;
          #dsm00087@#0 = nContaLog;
          #dsm00087@#1 = aSer;
          #dsm00087@#2 = aNum;
          #dsm00087@#3 = aTipo;
          |GRABA 020#dsm00087@.b;
     |FINSI;
     |SI FSalida = 0;
          |HORA aAlfa;
          aUsu = Usuario % 810;
          |SI nTipo = 15;
               #dsm00087@#4 = aUsu;
               #dsm00087@#5 = ~;
               #dsm00087@#6 = aAlfa;
               #dsm00087@#7 = "";
               #dsm00087@#8 = "01.01.0000";
               #dsm00087@#9 = ""
               #dsm00087@#10 = "";
               #dsm00087@#11 = "01.01.0000";
               #dsm00087@#12 = ""
          |FINSI;
          |SI nTipo = 16;
               #dsm00087@#7 = aUsu;
               #dsm00087@#8 = ~;
               #dsm00087@#9 = aAlfa;
          |FINSI;
          |SI nTipo = 17;
               #dsm00087@#10 = aUsu;
               #dsm00087@#11 = ~;
               #dsm00087@#12 = aAlfa;
          |FINSI;
          |GRABA 020#dsm00087@.a;
     |FINSI;
     |CIERRA #dsm00087@;
     |DESCARGA_DEF #dsm00087@;
|FPRC;

|PROCESO cong0002Fac;
     aAlfa = aSerNum + (("000000" + #59#0) % -106);
     |SI aTipo = "B";
          #referen@#7 = "";
          #referen@#8 = "01.01.0000";

          #referen@#44 = "";
          #referen@#45 = 0;
          #referen@#46 = 0;
     |SINO;
          #referen@#7 = aAlfa;
          #referen@#8 = #134#1;

          #referen@#44 = #59#14;
          #referen@#45 = #59#0;
          #referen@#46 = #59#1;
     |FINSI;
     |GRABA 020#referen@.a;
|FPRC;

|DEFBUCLE cong0002Fac;
     #referen@#3003;
     ;
     #59#15, #59#2, 001;
     #59#15, #59#2, 999;
     be;
     NULL, cong0002Fac;
|FIN;

|PROCESO CongeLinFac;
     |BUCLE cong0002Fac;
|FPRC;

|DEFBUCLE CongeLinFac;
     #59#1;
     ;
     #134#49, #134#0, 001;
     #134#49, #134#0, 999;
     be;
     NULL, CongeLinFac;
|FIN;

|PROCESO CongeCopiaFac;
     |DDEF aPath;
     aAlfa = aPath + "cong0001.mas";
     |XABRE "E", aAlfa, 0;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |ABRE #24;
     #24#0 = #134#2;
     |LEE 000#24=;
     |SI FSalida ! 0; |DDEFECTO #24; |FINSI;
     |CIERRA #24;
     |SI #24#111 = "N"; |ACABA; |FINSI;

     aAlfa = aPath + "cong0006";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          #referen@#0 = #134#49; || #59#14;
          |LEE 000#referen@.=;
          |SI FSalida = 0;
               aSerNum = ("00000" + #referen@#1) % -105;
          |SINO;
               aSerNum = "00000";
          |FINSI;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;

     aAlfa = aPath + "cong0002";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |BUCLE CongeLinFac;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;
