|FICHEROS;
     guerm206 #0; || Este
     guerm205 #1; || Cabecera
     guerm200 #5;
     agifa023 #23;
     agifa024 #24;
     agifa019 #19;
     comunica #100;
     guerm204 #11;
     guerm225 #225;
     guerm201 #201;
|FIN;

|VARIABLES;
     &enTiva = 0;
     &efFiva = @;
     &eaDiva = "";
     &enIva = 0;
     &enRec = 0;
     aDes = "";
     aResul    = "";
     nHandle   = 0;
     aFic      = "":
     nCuenta   = 0;
     nLinea    = 0;
     nBytes    = 0;
     nNum      = 0;
     &sumalin  = 0;
     &programa = 1;
     &EURODB   = 0;
     &estoyen   = "";
     nPrecio   = 0;
     aPuerto   = "";
     aParidad  = "";
     nVelocidad= 0;
     nBits     = 0;
     nStop     = 0;
     nSw       = 0;
     i         = 0;
     j         = 0;
     nPos      = 0;
     aLon      = "";
     aAlfa     = "";
     aHandle   = "";
     aValor    = "";
     aInicio   = "";
     aFin      = "";
     niDato    = 0;
     aDato     = "";
     nNumValores = 0;
   {200}pValor  = "";
     nVueltas  = 0;
     nNume = 0;
     nMaximo  = 0;
     nPara1 = 0;
     nSwEspa = 0;
     bruto     = 0;
     descu     = 0;
     aProve = "";
|FIN;


|PROCESO total; |TIPO 0;
  |SI FSalida = 9;
      |CAMPO_MODIFICA #0#5, 1, "S";
      |CAMPO_MODIFICA #0#8, 1, "S";
  |FINSI;
  #0#6 = (#0#7 * #0#5) < #0#8;
  |PINTA #0#6;
|FPRC;

|PROCESO alsalir1;
  |CAMPO_MODIFICA #0#5, 1, "N";
|FPRC;

|PROCESO alsalir2;
  |CAMPO_MODIFICA #0#8, 1, "N";
|FPRC;

|PROCESO suma; |TIPO 2;
  sumalin = sumalin +. #0#6;

  #1#56 = #1#56 +. (#0#7 * #0#9); |PINTA #1#56;

  #1#33 = #1#33 +. #0#7;
  #1#34 = #1#34 +. #0#7;

  #1#20 = sumalin;
  #1#22 = #1#20 - #1#21;
  #1#23 = ((#1#22 * #1#14) / 100) ! EURODB;
  #1#24 = #1#22 + #1#23;
  |SI #1#15 = "A";
       #1#21 = 0;
       #1#22 = 0;
       #1#23 = 0;
       #1#24 = 0;
  |FINSI;
  |PINTA #1#20;
  |PINTA #1#33;
  |PINTA #1#34;
  |SI programa = 1;
      |PINTA #1#22;
      |PINTA #1#23;
      |PINTA #1#24;
  |FINSI;
|FPRC;

|PROCESO DefPrecio;
     |DDEFECTO #19;
     |ABRE #19;
     #19#0 = #0#2;
     |LEE 000#19=;
     nPrecio = #19#18;
     |SI #19#130 = "S";
          enTiva = #19#30;
          efFiva = #1#1;
          |HAZ SacaIVA;
          nPrecio = nPrecio / (1+(enIva/100));
     |FINSI;
     #11#6 = nPrecio;
     |CIERRA #19;
|FPRC;

|PROCESO articuloficina;
  |ABRE #11;
  #11#0 = #1#3;
  #11#1 = #1#29;
  #11#2 = #0#2;
  |LEE 101#11=;
  |SI FSalida ! 0;
      |DDEFECTO #11;
      |HAZ DefPrecio;
      #11#0 = #1#3;
      #11#1 = #1#29;
      #11#2 = #0#2;
      #11#3 = #1#4;
      #11#4 = #1#30;
      #11#5 = #19#1;
      |PUSHV 0501 2380;
      |PINPA #0#11;
      |PINDA #0#11;
      |ENDATOS #1#11;
      |SI FSalida = 0;
          #0#5 = #11#6;
          #0#8 = #11#7;
          |GRABA 101#11n;
      |SINO;
          |MENAV "     ARTICULO CLIENTE OBRA INEXISTENTE";
          |ERROR; |POPV; |ACABA;
      |FINSI;
      |POPV;
  |FINSI;
  |CIERRA #11;
  |SI #0Campo ! Contenido;
     #0#5 = #11#6;
     #0#3 = #11#5;
     #0#8 = #11#7;
     |PINTA #0#3;
     |PINTA #0#5;
     |PINTA #0#8;
  |FINSI;
|FPRC;

|PROCESO Precio; |TIPO 0;
     |ABRE #19;
     #19#0 = #0#2;
     |LEE 000#19=;
     |CIERRA #19;

     |MODULO aAlfa;
     |SI aAlfa = "guerm215"; |O aAlfa = "guerm218";
          |ABRE #11;
          #11#0 = #1#3;
          #11#1 = #1#29;
          #11#2 = #0#2;
          |LEE 101#11=;
          |SI FSalida ! 0;
               |MENAV "0000No existe articulo cliente/obra.";
               |ERROR; |ACABA;
          |SINO;
               |SI #0Campo ! Contenido;
                    #0#5 = #11#6;
                    #0#3 = #11#5;
                    #0#8 = #11#7;
                    |PINTA #0#3;
                    |PINTA #0#5;
                    |PINTA #0#8;
               |FINSI;
          |FINSI;
          |CIERRA #11;
          |HAZ PreCoste;
          |ACABA;
     |FINSI;


     |SI #0Campo = Contenido; |HAZ PreCoste; |ACABA; |FINSI;
     |SI estoyen = "O";
          |HAZ articuloficina;
          |HAZ PreCoste;
          |ACABA;
     |FINSI;


     |ABRE #24;
     #24#0 = #1#3;
     |LEE 000#24=;
     |CIERRA #24;

     |ABRE #23;
     #23#0 = #24#0;
     #23#1 = #0#2;
     |LEE 000#23=;
     |SI FSalida = 0; |Y #23#28 ] #1#1; |Y #23#29 [ #1#1;
          nPrecio = #23#2;
          aDes = #23#35;
     |SINO;
          aDes = "";
          |ABRE #19;
          #19#0 = #0#2;
          |LEE 000#19=;
          |SI FSalida = 0;
               |SI #24#39 = 1; nPrecio = #19#18; |FINSI;
               |SI #24#39 = 2; nPrecio = #19#19; |FINSI;
               |SI #24#39 = 3; nPrecio = #19#20; |FINSI;
               |SI #24#39 = 4; nPrecio = #19#147; |FINSI;
               |SI #24#39 = 5; nPrecio = #19#148; |FINSI;
               |SI #24#39 = 6; nPrecio = #19#149; |FINSI;
               aDes = #19#1;
          |FINSI;
          |CIERRA #19;
     |FINSI;
     |CIERRA #23;
     #0#3 = aDes;
     #0#5 = nPrecio;
     |PINTA #0#3;
     |PINTA #0#5;

     |HAZ PreCoste;
|FPRC;

|PROCESO Proveedor;
     aProve = "000000";
     |ABRE #201;
     #201#0 = #1#11;
     |LEE 000#201=;
     |SI FSalida = 0; |Y #201#11 = "S";
          aProve = #201#12;
     |FINSI;
     |CIERRA #201;
|FPRC;

|PROCESO PreCoste;
     |DDEFECTO #225;
     |ABRE #225;
     |HAZ Proveedor;
     #225#0 = aProve;
     #225#6 = #1#3;
     #225#1 = #1#29;
     #225#3 = #0#2;
     |LEE 000#225=;
     |SI FSalida = 0;
          #0#9 = #225#5; |PINTA #0#9;
     |SINO;
          |PUSHV 0501 2380;
          #225#4 = #0#3;
          #225#2 = #1#30;
          |PINPA #0#225;
          |PINDA #0#225;
          |ENDATOS #1#225;
          |SI FSalida = 0;
               |POPV;
               #0#9 = #225#5; |PINTA #0#9;
               |GRABA 020#225n;
          |SINO;
               |POPV;
               |ERROR;
          |FINSI;
     |FINSI;
     |CIERRA #225;
|FPRC;

|PROCESO PintaDato;
     |SI #5#18 ! "S"; |ACABA; |FINSI;
     |SI nLinea > 1600; |O nLinea = 0;
          nLinea = 0602;
     |FINSI;

     aAlfa = aDato + aValor; |QBF aAlfa;
     |SI aAlfa ! "";
          aAlfa = "Valor:" + aValor + " Dato:" + aDato;
          |PINTA nLinea, aAlfa;
          nLinea = nLinea + 100;
     |FINSI;
|FPRC;
