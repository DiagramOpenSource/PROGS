|FICHEROS;
     gomaz003 #0;
     agifa041 #1;
     agifa019 #19;
     agifa081 #81;
     agifa067 #67;
     agifa112 #112;
     agifa142 #142;

     agifa067@;
     agifa081@;
|FIN;

|VARIABLES;
     &enImpPrvPed = 0;
     &efFecha = @;
     &eaProve = "";
     &enForma = 0;
     &eaDocu = "";
     &enSwMenu = 0;
     &eaSerie = "";
     &enDocu = 0;

     aPathOrg = "";
     aAlfa = "";
     aPath = "";
     nNume = 0;
     aEmp = "";
     aParam = "";
     fmes1 = "";
     mes = 0;
     nImpo = 0;
     nForma = 0;
|FIN;

|PROCESO ActPro;
     nForma = 1;
     |ABRE #19;
     #19#0 = #67#2;
     |LEE 020#19=;
     |CIERRA #19;

     fmes1 = #81#1 % A402;
     mes = fmes1 + 42;
     |SI #19#196 = 2;
          nImpo = (((((#67#41 * #67#6) < #67#8) < #67#27) < #67#57) < #81#5) < #81#17;
     |SINO;
          nImpo = (((((#67#5 * #67#6) < #67#8) < #67#27) < #67#57) < #81#5) < #81#17;
     |FINSI;
     |SI #142#114 = "S";
          nImpo = nImpo < #81#6;
     |FINSI;
     #112mes = #112mes + (nImpo * nForma);
     #112#55 = #112#55 + (nImpo * nForma);

     enImpPrvPed = nImpo * nForma;
     efFecha = #81#1;
     eaProve = #81#4;
     |HAZ AcumulaPrv;
|FPRC;

|PROCESO CopiaLineas;
     |SALVA_DATOS #agifa067@;
     |REPON_DATOS #67;
     #67#28 = #81#25;
     #67#0 = #81#0;
     #67#12 = 0;
     #67#38 = 0;
     #67#44 = 0;
     #67#46 = 0;
     #67#51 = 0;
     #67#52 = 0;
     #67#53 = "";
     |GRABA 020#67n;

     enForma = 1;
     eaDocu = "agifa067";
     |HAZ StockEntra;
|FPRC;

|DEFBUCLE CopiaLineas;
     #agifa067@#1003;
     ;
     eaSerie, enDocu, 001;
     eaSerie, enDocu, 999;
     ;
     NULL, CopiaLineas;
|FIN;

|PROCESO CopiaPedido;
     |ABRE #142; |LEE 000#142p; |CIERRA #142;

     |ABRE #112;
     #112#0 = "000000";
     |LEE 000#112=;
     |SI FSalida ! 0; |DDEFECTO #112; |FINSI;
     |CIERRA #112;

     |ABRE #81;
     |ABRE #67;
     #81#25 = #agifa081@#25;
     enSwMenu = 1;
     |HAZ ContaPC7;
     nNume = #81#0;
     |SALVA_DATOS #agifa081@;
     |REPON_DATOS #81;
     #81#0 = nNume;
     #81#1 = ~;
     #81#4 = #112#0;
     #81#8 = #112#2;
     #81#24 = 0;
     |GRABA 020#81b;
     |BUCLE CopiaLineas;
     |HAZ CalCabAgifa081;

     |ABRE #112;
     #112#0 = #81#4;
     |LEE 101#112=;
     |SI FSalida ! 0; |GRABA 020#112b; |FINSI;
     |BUCLELIN 2 ActPro #81;
     |GRABA 020#112a;
     |CIERRA #112;

     |CIERRA #67;
     |CIERRA #81;
|FPRC;

|PROCESO Tipo3; |TIPO 3;
     aEmp = ("00000" + #0#0) % -105;
     |DFICE aAlfa;
     aAlfa = ":dscomer9/gomaz003 agif0041 " + aEmp + ";" + eaSerie + (("000000" + enDocu) % -106) + aAlfa;
     |SUB_EJECUTA_NP aAlfa;
|FPRC;

|PROCESO Empresa66; |TIPO 66;
     |DBASE aAlfa;
     aAlfa = aAlfa + "fich/";
     |PATH_DAT #1 aAlfa;
     |ABRE #1;
     #1#0 = #0#0;
     |LEE 000#0];
     |CONSULTA_CLAVE #1#1;
     |SI FSalida = 0;
          #0#0 = #1#0; |PINTA #0#0;
     |FINSI;
     |CIERRA #1;
|FPRC;

|PROCESO Empresa0; |TIPO 0;
     |DBASE aAlfa;
     aAlfa = aAlfa + "fich/";
     |PATH_DAT #1 aAlfa;
     |ABRE #1;
     #1#0 = #0#0;
     |LEE 000#1=;
     |SI FSalida ! 0;
          |MENAV "0000No esiste empresa....";
          |ERROR;
     |SINO;
          #0#1 = #1#1; |PINTA #0#1;
     |FINSI;
     |CIERRA #1;
|FPRC;

|PROGRAMA;
     aParam = PARAMETRO;

     |SI aParam = "";    || lo llama el agifa081
          |ABRE #81;
          #81#25 = eaSerie;
          #81#0 = enDocu;
          |LEE 000#081=;
          |SI FSalida = 0;
               |PINPA #0#0;
               |PINDA #0#0;
               |ENDATOS #1#0;
          |FINSI;
          |CIERRA #81;
     |SINO;              || se llama el mismo
          |DDEF aPath;
          aAlfa = aPath + "agifa081";
          |CARGA_DEF aAlfa, agifa081@;
          |SI FSalida = 0;
               aAlfa = aPath + "agifa067";
               |CARGA_DEF aAlfa, agifa067@;
               |SI FSalida = 0;
                    eaSerie = aParam % 105;
                    aAlfa = aParam % 606; enDocu = aAlfa;
                    aPathOrg = aParam % 12;

                    |PATH_DAT #agifa081@#aPathOrg#;
                    |PATH_DAT #agifa067@#aPathOrg#;

                    |ABRE #agifa081@;
                    #agifa081@#25 = eaSerie;
                    #agifa081@#0 = enDocu;
                    |LEE 000#agifa081@.=;
                    |SI FSalida = 0;
                         |HAZ CopiaPedido;
                    |FINSI;
                    |CIERRA #agifa081@;
                    |DESCARGA_DEF #agifa067@;
               |FINSI;
               |DESCARGA_DEF #agifa081@;
          |FINSI;
     |FINSI;
|FPRO;
