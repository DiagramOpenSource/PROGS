|FICHEROS;
     diefa318 #0; ||Este Def.
     agifa077 #1; ||Albaranes Compra (C).
     diefa319 #2; ||Aux.
|FIN;

|VARIABLES;
     aFecha   = "";
     aAnyo    = "";
     nAnyo    = 0;
     aFich    = "";
     nSal     = 0;
     swImp    = 0;
     aCade    = "";
     aPath    = "";
     aDir     = "";
     nImpo    = 0;
|FIN;

|PROCESO diefa319;
     |PRINT;
     swImp = 1;
|FPRC;

|DEFBUCLE diefa319;
     #2#2;
     ;
     INICIO;
     FINAL;
     ;
     NULL,diefa319;
|FIN;

|PROCESO agifa0772;
     |SI #1#42 = "S";
          nImpo = -#1#15;
     |SINO;
          nImpo = #1#15;
     |FINSI;
     |DDEFECTO #2;
     #2#0 = #1#3;
     |LEE 000#2=;
     nSal = FSalida;
     #2#1 = #1#4;
     |SI #1#1 ] #0#2; |Y #1#1 [ #0#3;
          #2#3 = #2#3 + nImpo;
          #0#6 = #0#6 + nImpo;
     |FINSI;
     |SI #1#1 [ #0#3;
          #2#5 = #2#5 + nImpo;
          #0#8 = #0#8 + nImpo;
     |FINSI;
     |SI nSal = 0; |GRABA 020#2a; |FINSI;
     |SI nSal ! 0; |GRABA 020#2n; |FINSI;
|FPRC;

|DEFBUCLE agifa0772;
     #1#1;
     1;
     "     ",000000,"00.00.0000";
     "zzzzz",999999,#0#3;
     ;
     NULL,agifa0772;
|FIN;

|PROCESO agifa077;
     |SI #1#42 = "S";
          nImpo = -#1#15;
     |SINO;
          nImpo = #1#15;
     |FINSI;
     |DDEFECTO #2;
     #2#0 = #1#3;
     |LEE 000#2=;
     nSal = FSalida;
     #2#1 = #1#4;
     |SI #1#1 ] #0#0; |Y #1#1 [ #0#1;
          #2#2 = #2#2 + nImpo;
          #0#5 = #0#5 + nImpo;
     |FINSI;
     |SI #1#1 [ #0#1;
          #2#4 = #2#4 + nImpo;
          #0#7 = #0#7 + nImpo;
     |FINSI;
     |SI nSal = 0; |GRABA 020#2a; |FINSI;
     |SI nSal ! 0; |GRABA 020#2n; |FINSI;
|FPRC;

|DEFBUCLE agifa077;
     #1#1;
     1;
     "     ",000000,"00.00.0000";
     "zzzzz",999999,#0#1;
     ;
     NULL,agifa077;
|FIN;

|PROCESO ejec; |TIPO 3;
     |IMPRE 0;
     |SI FSalida ! 0; |ACABA; |FINSI;
     |INFOR "diefa318";
     |SI FSalida ! 0; |FINIMP; |ACABA; |FINSI;
     aFecha   = #0#0;
     aAnyo    = aFecha % -104;
     nAnyo    = aAnyo;
     nAnyo    = nAnyo - 1;
     aAnyo    = nAnyo;
     aFecha   = aFecha % 105;
     aFecha   = aFecha + "." + aAnyo;
     #0#2     = aFecha;
     aFecha   = #0#1;
     aAnyo    = aFecha % -104;
     nAnyo    = aAnyo;
     nAnyo    = nAnyo - 1;
     aAnyo    = nAnyo;
     aFecha   = aFecha % 105;
     aFecha   = aFecha + "." + aAnyo;
     #0#3     = aFecha;
     aFich = Usuario;
     |NOME_DAT #2 aFich; |ABRE #2; |CIERRA #2; |DELINDEX #2;
     |ABRE #2;
     |BUCLE agifa077;
     |DBASE aDir;
     |QBF   aDir;
     aCade = ("00000" + #0#4) % -105;
     aPath = aDir + "fich/" + aCade + "/";
     |PATH_DAT #1 aPath;
     |BUCLE agifa0772;
     |CIERRA #2;
     |BUCLE diefa319;
     |SI swImp = 1;
          |PIEINF;
     |FINSI;
     |FININF;
     |FINIMP;
     |DELINDEX #2;
|FPRC;
