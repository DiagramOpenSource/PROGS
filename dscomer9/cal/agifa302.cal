|FICHEROS;
     agifa302 #0;

     agifa010 #1;   ||-Albaranes
     expor010@ #3;

     agifa071 #2;   ||-Lineas de Albaran
     expor071@ #4;

     agifa084 #5;   ||-Facturas contado
     expor084@ #7;

     agifa069 #6;   ||-Lineas de facturas de contado
     expor069@ #8;

     agifa134 #9;   ||-Facturas Ventas
     expor134@ #11;

     agifa059 #10;  ||-Lineas Facturas Ventas
     expor059@ #12;

     agifa133 #13;  ||-Vencimientos Facturas
     expor133@ #14;

     agifa039 #15;  ||-Dtos Familia / Clientes
     expor039@ #16;

     agifa023 #17;  ||-Precios Clientes/Articulos
     expor023@ #18;

     dsm00117 #19;  ||-Descuentos Promocionales (C).
     expor117@ #21;

     agifa142 #30;  || Parametros generales

     agifa024 #32;  ||-Clientes
     expor024@ #33;

     agifa019 #34;  ||-Articulos
     expor019@ #35;

     agifa112 #36;  ||-Proveedores
     expor112@ #37;

     agifa025 #38;  ||-Comisionistas
     expor025@ #39;

     agifa146 #40;  ||-Facturas Proformas (C)
     expor146@ #41;

     agifa147 #42;  ||-Facturas Proformas (L)
     expor147@ #43;

     agifa104 #44;  ||-Pedidos Venta (C)
     expor104@ #45;

     agifa073 #46;  ||-Pedidos Venta (L)
     expor073@ #47;

     dsm00202 #100; ||Historico E/I Central

|FIN;

|VARIABLES;
     &eaNomDef = "";
     &enCamposDef = 0;

     aParam = "";
     n010 = 0; n071 = 0; n084 = 0; n069 = 0; n134 = 0; n059 = 0;
     n133 = 0; n039 = 0; n023 = 0; n305 = 0; n306 = 0; n024 = 0;
     n019 = 0; n112 = 0; n025 = 0; n146 = 0; n147 = 0; n104 = 0;
     n073 = 0;
     &qFichero = "";
     aMensa = "";
     ddx = "";
     aPath = "";
     swErr = 0;
     fich = "";
     org = "";
     nLin  = 0;
     fFecha = @;
     num = 0;
     bufer = 0;
     err = 0;
     fdes = "";
     des = "";
     fdef = "";
     def = "";
     exp = 0;
     puente    = "";
     puente2   = 0;
     path      = "";
     empresa   = "";
     horat     = "";
     no        = "N";
     desfecha  = "00.00.0000";
     hasfecha  = "31.12.9999";
     blanco    ="                         ";
     blanco1   ="                    ";
     param     = "";
     tipo_exp  = "";

     sw_testigo= 0;
     sw_pasada = 0;
     i         = 0;

     fecha     = @;

     aDef     = "";
     aDef1    = "";
     aDef2    = "";
     aDef3    = "";
     aDef4    = "";
     aDef5    = "";
     aDef6    = "";
     aDef7    = "";
     aDef8    = "";
     aDef9    = "";
     aDef10   = "";
     aDef11   = "";
     aDef12   = "";
     aDef13   = "";
     aDef14   = "";
     aDef15   = "";
     aDef16   = "";
     aDef17   = "";
     aDef18   = "";
     aDef19   = "";
     aDef20   = "";
     aDef21   = "";
     aDef22   = "";

     aFic = "";
     aAlfa = "";
     dirfich = "";
     longfich = "";
     longfich1 = 0;
     longfich2 = "";
     aTar      = "";
     a1        = "";
     a2        = "";

|FIN;

||_____________________________________________/ EXPORTACION DE PROVEEDORES

|PROCESO miracomis;
     sw_pasada = 1;
     |PINTA 2163 , blanco1;
     |PINTA 2163 , #agifa025#0;
     |PARA i = 0; |SI i [ n025; |HACIENDO i = i + 1;
          #39i = #38i;
     |SIGUE;
     #agifa025#54 = "S";  || Exportado SI y Fecha
     #agifa025#55 = #0#8;
     |GRABA 011#39n;
     |GRABA 011#agifa025.a;
     |LIBERA #39;
     |LIBERA #agifa025;
|FPRC;


|DEFBUCLE comis;        ||Comisionista #4
   #agifa025#1;
   54,55;
   "  ",no,desfecha;
   "zz",no,hasfecha;
   be;
   NULL,miracomis;
|FIN;

||_____________________________________________/ EXPORTACION DE PROVEEDORES

|PROCESO miraprove;
     sw_pasada = 1;
     |PINTA 2163 , blanco1;
     |PINTA 2163 , #agifa112#0;
     |PARA i = 0; |SI i [ n112; |HACIENDO i = i + 1;
          #37#i# = #agifa112#i#;
     |SIGUE;

     #agifa112#71 = "S";   || Exportado SI y Fecha
     #agifa112#72 = #0#8;

     |GRABA 011#37n;
     |GRABA 011#agifa112.a;
     |LIBERA #37;
     |LIBERA #agifa112;
|FPRC;

|DEFBUCLE proveedores;        ||Proveedor #3
  #agifa112#1;
  71,72;
  "      " ,no,desfecha;
  "zzzzzz" ,no,hasfecha;
  be;
  NULL,miraprove;
|FIN;



||_____________________________________________/ EXPORTACION DE ARTICULOS

|PROCESO miraarti;
     sw_pasada = 1;
     |PINTA 2163 , blanco1;
     |PINTA 2163 , #34#0;
     |PARA i = 0; |SI i [ n019;|HACIENDO i = i + 1;
          #35i = #34i;
     |SIGUE;

     #34#123 = "S";     || Exportado SI y Fecha
     #34#124 = #0#8;
     |GRABA 011#35n;
     |LIBERA #35;
     |GRABA 011#34a;
     |LIBERA #34;
|FPRC;

|| Articulos
|DEFBUCLE articulos;
  #34#3;
  ;
  no,desfecha,"                    ";
  no,hasfecha,"zzzzzzzzzzzzzzzzzzzz";
  be;
  NULL,miraarti;
|FIN;

||_____________________________________________/ EXPORTACION DE CLIENTES


|PROCESO miracli;
     sw_pasada = 1;
     |PINTA 2163,blanco1;
     |PINTA 2163,#32#0;
     |PARA i = 0; |SI i [ n024; |HACIENDO i = i + 1;
          #33i=#32i;
     |SIGUE;
     #32#175="S";    || Exportado SI
     #32#176=#0#8;
     |GRABA 011#33n;
     |GRABA 011#32a;
     |LIBERA #33;
     |LIBERA #32;
|FPRC;

|DEFBUCLE clientes;        ||CLientes #1
  #32#1;
  175, 176, 3;
  "      " , no,desfecha , #0#11;
  "zzzzzz" , no,hasfecha , #0#12;
  be;
  NULL,miracli;
|FIN;

||_____________________________________________/ DTOS FAMILIA / CLIENTE

|PROCESO graba039;
     sw_pasada = 1;
     |PINTA 2163 , blanco1;
     |PINTA 2163 , #agifa039#0;
     #16#0 = #agifa039#0;
     #16#1 = #agifa039#1;
     #16#2 = #agifa039#2;
     #16#3 = #agifa039#3;
     #16#4 = #agifa039#4;
     |GRABA 021#16n;
     #agifa039#5 = "S";
     #agifa039#6 = #0#8;
     |GRABA 021#agifa039.a;
     |LIBERA #agifa039;
|FPRC;

|DEFBUCLE pasar039;
#15#1;
;
"      " , "   ";
"zzzzzz" , "zzz";
be;
NULL , graba039;
|FIN;

||_____________________________________________/ PRECIO CLIENTE / ARTICULO

|PROCESO graba023;
     |DDEFECTO #agifa024;
     #agifa024#0 = #agifa023#0;
     |LEE 001#agifa024.=;
     |SI #agifa024#3 ] #0#11; |Y #agifa024#3 [ #0#12;
          sw_pasada = 1;
          |PINTA 2163 , blanco1;
          |PINTA 2163 , #agifa023#0;
          |PARA i = 0; |SI i [ n023; |HACIENDO i = i + 1;
               #18i = #17i;
          |SIGUE;
               #18#32 = #17#32;
          |GRABA 021#18n;
          #agifa023#30 = "S";
          #agifa023#31 = #0#8;
          |GRABA 021#agifa023.a;
          |LIBERA #agifa023;
     |FINSI;
|FPRC;

|DEFBUCLE pasar023;
#agifa023#1;
;
"      " , "                    ";
"zzzzzz" , "zzzzzzzzzzzzzzzzzzzz";
be;
NULL , graba023;
|FIN;

||_____________________________________________/ PRECIO CLIENTE / ARTICULO
|PROCESO graba305;
     sw_pasada = 1;
     |PINTA 2163 , blanco1;
     |PINTA 2163 , #19#0;
     |PARA i = 0; |SI i [ n305; |HACIENDO i = i + 1;
          #21i = #19i;
     |SIGUE;
     |GRABA 020#21a;
|FPRC;

|DEFBUCLE pasar305;
     #10#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL , graba305;
|FIN;


||_____________________________________________/ EXPORTACION DE ALBARANES

     ||paso los albaranes nuevos

|PROCESO linalb;
     |LEE 101#2=;
     |DDEFECTO #4;
     |PARA i = 0; |SI i [ n071; |HACIENDO i = i+1;
          #4#i# = #agifa071#i#;
     |SIGUE;
     ||#4#29 = #2#29;
     ||#4#0 = #2#0;
     ||#4#1 = #2#1;
     #2#26 = 999999;
     |DEFECTO #4#2;
     |GRABA 021#4n;
     |GRABA 021#2a;
     |LIBERA #2;
|FPRC;

|DEFBUCLE linalb;
     #2#1;
     ;
     #1#52, #1#0, 001;
     #1#52, #1#0, 999;
     ;
     NULL, linalb;
|FIN;

|PROCESO cabalb;
     puente2 = #1#39;
     |SI #0#21 = "S"; puente2 = 0; |FINSI; || Pasar Facturados

     |SI puente2 = 0;
          sw_pasada = 1;
          |PARA i = 0; |SI i [ n010; |HACIENDO i = i+1;
               #3#i# = #agifa010#i#;
          |SIGUE;

          ||#0#0 = #1#52;  |PINTA #0#0;
          ||#0#1 = #1#0;   |PINTA #0#1;
          |||DDEFECTO #3;
          ||#3#52 = #1#52; ||Serie
          ||#3#0 = #1#0;   || Albaran
          #1#39 = 999999;
          #1#58 = "E";
          #3#58 = "E";
          || |DEFECTO #3#1;
          |GRABA 021#3n;
          |GRABA 021#1a;
          |BUCLE linalb;
     |SINO;
          |ERROR;
     |FINSI;
     |LIBERA #1;
|FPRC;
     || Paso los albaranes que ya estaban recibidos, siempre y cuando este
     || faturados

||_____________________________________________/ CREACION DE FACTURAS
|PROCESO creavenci;           ||Traspaso los Vencimientos de Facturas
     |ABRE #13;
     #13#4 = #9#49;
     #13#0 = #9#0;
     #13#1 = 0;
     |LEE 001#13];
     |PARA ; |SI FSalida = 0; |Y #13#4 = #9#49; |Y #13#0 = #9#0; |HACIENDO ;
          #14#0 = #13#0;
          #14#1 = #13#1;
          #14#2 = #13#2;
          #14#3 = #13#3;
          #14#4 = #13#4;
          |GRABA 021#14n;
          |LEE 001#13s;
     |SIGUE;
     |CIERRA #13;
|FPRC;

|PROCESO linfactu;  ||Creacion de lineas de facturas
     #12#14 = #11#49;
     #12#0 = #11#0;
     |DEFECTO #12#10;
     |GRABA 021#12c;
|FPRC;

|DEFBUCLE linfactu;
     #10#1;
     ;
     #9#49, #9#0, 001;
     #9#49, #9#0, 999;
     ;
     NULL, linfactu;
|FIN;

|PROCESO creafactu;
     #9#49 = #3#53;
     #9#0 = #3#39;
     |LEE 001#9=;
     |SI FSalida = 0;
          #11#49 = #3#53;
          #11#0 = #3#39;
          |LEE 001#11=;
          |SI FSalida ! 0;
               #11#49 = #3#53;
               #11#0 = #3#39;
               |DEFECTO #11#9;
               |GRABA 021#11c;
               |BUCLE linfactu;
               |HAZ creavenci;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO linalb2;
     |LEE 101#2=;
     |DDEFECTO #4;
     #4#29 = #2#29;
     #4#0 = #2#0;
     |DEFECTO #4#2;
     |GRABA 021#4n;
     |GRABA 021#2a;
     |LIBERA #2;
|FPRC;

|DEFBUCLE linalb2;
     #2#1;
     ;
     #1#52, #1#0, 001;
     #1#52, #1#0, 999;
     ;
     NULL, linalb2;
|FIN;

|PROCESO cabalb2;
     puente = #1#39;     |QBF puente;
     |SI puente ! 0; |Y puente ! 999999;
          sw_pasada = 1;
          #0#0 = #1#52;  |PINTA #0#0;
          #0#1 = #1#0;   |PINTA #0#1;
          |DDEFECTO #3;
          #3#52 = #1#52; ||Serie
          #3#0 = #1#0;   || Albaran
          #1#58 = "S";
          #3#58 = "R";
          |DEFECTO #3#1;
          |GRABA 021#3n;
          |GRABA 021#1a;
          |BUCLE linalb2;
          |HAZ creafactu;
     |SINO;
          |ERROR;
     |FINSI;
     |LIBERA #1;
|FPRC;

|DEFBUCLE leealba;
#1#1;
58,59;
#0#9  ,       0 , " " , "00.00.0000";
#0#10 ,  999999 , "N" , "31.12.9999";
be;
NULL , cabalb;
|FIN;

|DEFBUCLE leealba2;
#1#1;
58,59;
#0#9  ,       0 , "R" , "00.00.0000";
#0#10 ,  999999 , "R" , "31.12.9999";
be;
NULL , cabalb2;
|FIN;

||__________________________________________/ EXPORTACION FACTURAS CONTADO
|PROCESO lincon;
    || |DEFECTO #8#6;
    || #8#0 = #6#0;
    || #8#20 = #6#20;
    |PARA i=0; |SI i [ n069; |HACIENDO i = i + 1;
          #8#i# = #agifa069#i#;
    |SIGUE;
    |GRABA 021#8n;
|FPRC;

|DEFBUCLE lincon;
     #6#1;
     ;
     #5#48, #5#0, 001;
     #5#48, #5#0, 999;
     ;
     NULL, lincon;
|FIN;

|PROCESO cabcon;
     sw_pasada = 1;
     #0#0 = #5#48;  |PINTA #0#0;
     #0#1 = #5#0;   |PINTA #0#1;
     |||DEFECTO #7#5;
     |PARA i=0;|SI i [ n084;|HACIENDO i = i +1;
          #7#i#=#agifa084#i#;
     |SIGUE;

     |GRABA 021#7n;
     #5#61 = "S";
     |GRABA 021#5a;
     |LIBERA #5;
     |BUCLE lincon;
|FPRC;

||***************Proformas;
|PROCESO linfor;
    |PARA i=0;|SI i [ n147;|HACIENDO i = i+1;
          #43i=#42i;
    |SIGUE;
    |GRABA 021#43n;
|FPRC;

|DEFBUCLE linfor;
     #42#1;
     ;
     #40#48, #40#0, 001;
     #40#48, #40#0, 999;
     ;
     NULL, linfor;
|FIN;

|PROCESO cabfor;
     sw_pasada = 1;
     #0#0 = #40#48;  |PINTA #0#0;
     #0#1 = #40#0;   |PINTA #0#1;
     |PARA i=0;|SI i [ n146; |HACIENDO i = i +1;
          #41i=#40i;
     |SIGUE;

     |GRABA 021#41n;
     #40#63 = "S";
     #40#64 = #0#8;||Fecha exp;
     |GRABA 021#40a;
     |LIBERA #40;
     |BUCLE linfor;
|FPRC,

||******************** ped.vta;
|PROCESO linpvta;
    |PARA i=0;|SI i [ n073;|HACIENDO i = i+1;
          #47i=#46i;
    |SIGUE;
    |GRABA 021#47n;
|FPRC;

|DEFBUCLE linpvta;
     #46#1;
     ;
     #44#25, #44#0, 001;
     #44#25, #44#0, 999;
     ;
     NULL, linpvta;
|FIN;

|PROCESO cabpvta;
     sw_pasada = 1;
     #0#0 = #44#25;  |PINTA #0#0;
     #0#1 = #44#0;   |PINTA #0#1;
     |PARA i=0;|SI i [ n104;|HACIENDO i = i +1;
          #45i=#44i;
     |SIGUE;

     |GRABA 021#45n;
     #44#27 = "S";
     #44#28 = #0#8;||Fecha exp;
     |GRABA 021#44a;
     |LIBERA #44;
     |BUCLE linpvta;
|FPRC;

|DEFBUCLE leeconta;
#5#1;
61,62;
"     " ,       0 , "N" , "00.00.0000";
"zzzzz" ,  999999 , "N" , "31.12.9999";
be;
NULL , cabcon;
|FIN;

|DEFBUCLE leeprofo;
#40#1;
63,64;
"     ",      0 ,"N","00.00.0000";
"zzzzz", 999999 ,"N","31.12.9999";
be;
NULL, cabfor;
|FIN;

|DEFBUCLE leepvta;
#44#1;
27,28;
"     ",      0,"N","00.00.0000";
"zzzzz", 999999,"N","31.12.9999";
be;
NULL, cabpvta;
|FIN;
------------------------------------------------------------------------
|PROCESO Vencimiento;
     #13#4 = #9#49;
     #13#0 = #9#0;
     #13#1 = 0;
     |LEE 001#13];
     |PARA ; |SI FSalida = 0; |Y #13#4 = #9#49; |Y #13#0 = #9#0; |HACIENDO ;
          |PARA i = 0; |SI i [ n133; |HACIENDO i = i + 1;
               #14i = #13i;
          |SIGUE;
          |GRABA 021#14n;
          |LEE 001#13s;
     |SIGUE;
|FPRC;

|PROCESO LFacVenta;
     |PARA i = 0; |SI i [ n059; |HACIENDO i = i + 1;
          #12i = #10i;
     |SIGUE;
     |GRABA 021#12n;
|FPRC;

|DEFBUCLE LFacVenta;
     #10#1;
     ;
     #9#49, #9#0, 001;
     #9#49, #9#0, 999;
     ;
     NULL, LFacVenta;
|FIN;

|PROCESO CFacVenta;
     #0#0 = #9#49;   |PINTA #0#0;
     #0#1 = #9#0;    |PINTA #0#1;
     sw_pasada = 1;
     |PARA i = 0; |SI i [ n134; |HACIENDO i = i + 1;
          #11i = #9i;
     |SIGUE;
     |GRABA 021#11n;
     |SI FSalida = 0;
          |HAZ Vencimiento;
          #9#56 = "S";
          |GRABA 021#9a;
     |FINSI;
     |BUCLE LFacVenta;
|FPRC;

|DEFBUCLE FacVenta;
     #9#1;
     56;
     "     ",       0, "N";
     "zzzzz",  999999, "N";
     ;
     NULL, CFacVenta;
|FIN;

------------------------------------------------------------------------
|PROCESO tipo3;
     fFecha = ~;
     |HAZ BusCampos;
     |ABRE #30;
     |LEE 001#30p;
     |SI FSalida ! 0;
          |CIERRA #30;
          |MENAV "0000No se encuentra el Control Path";
          |ERROR;
          |ACABA;
     |FINSI;
     |CIERRA #30;
     path = #30#150;  |QBF path;

     |ABRE #100;
     #100#0 = "E";
     #100#1 = fFecha;
     #100#2 = 0;
     |LEE 000#100];
     |SI FSalida = 0; |Y #100#0 = "E"; |Y #100#1 = fFecha;
          |AVISO;
          aAlfa = "0000NSe genero una exportacion hoy " + fFecha  + ". Crear otra S/N ";
          |CONFI aAlfa;
          |SI FSalida ! 0; |CIERRA #100; |ACABA; |FINSI;
     |FINSI;
     |CIERRA #100;

     |HAZ  CargaDef;
     |SI swErr ! 0;
          aMensa = "0000Error al cargar:" + aDef;
          |MENAV aMensa;
          |HAZ DesCargaDef;
          |ACABA;
     |FINSI;

     || Clientes
     |SI #0#4="S";
          |PINTA 2124 , blanco;
          |PINTA 2124 , "Clientes";
          |PATH_DAT #33 path;   || Marco camino de clientes exportacion
          |ABRE #33;  |CIERRA #33;
          |DELINDEX #33;
          |ABRE #33;
          |BUCLE clientes;
          |LIBERA #33;
          |CIERRA #33;
     |FINSI;

     ||Articulo
     |SI #0#5="S";
          |PINTA 2124 , blanco;
          |PINTA 2124 , "Articulos";
          |PATH_DAT #35 path;   || Marco camino de articulos exportacion
          |ABRE #35;
          |CIERRA #35;
          |DELINDEX #35;
          |ABRE #35;
          |BUCLE articulos;
          |LIBERA #35;
          |CIERRA #35;
     |FINSI;

     ||Proveedores
     |SI #0#6="S";
          |PINTA 2124 , blanco;
          |PINTA 2124 , "Proveedores";
          |PATH_DAT #37 path;   || Marco camino de proveedores exportacion
          |ABRE #37;
          |CIERRA #37
          |DELINDEX #37;
          |ABRE #37;
          |BUCLE proveedores;
          |LIBERA #37;
          |CIERRA #37;
      |FINSI;

     ||Comisionistas
     |SI #0#7="S";
          |PINTA 2124 , blanco;
          |PINTA 2124 , "Comisionistas";
          |PATH_DAT #39 path;   || Marco camino de comisionistas exportacion
          |ABRE #39;
          |CIERRA #39;
          |DELINDEX #39;
          |ABRE #39;
          |BUCLE comis;
          |LIBERA #39;
          |CIERRA #39;
     |FINSI;

     ||Dtos Familia Cliente
     |SI #0#13 = "S"; |Y tipo_exp = "central";
          |PINTA 2124 , blanco;
          |PINTA 2124 , "Dto. Familia/Cliente";
          |PATH_DAT #16 path;   || Marco camino de comisionistas exportacion
          |ABRE #16; |CIERRA #16; |DELINDEX #16;
          |ABRE #16;
          |BUCLE pasar039;
          |CIERRA #16;
     |FINSI;

     ||Precio Cliente Articulo
     |SI #0#14 = "S"; |Y tipo_exp = "central";
          |PINTA 2124 , blanco;
          |PINTA 2124 , "Precio Cli./Art.    ";
          |PATH_DAT #18 path;   || Marco camino de comisionistas exportacion
          |ABRE #18; |CIERRA #18; |DELINDEX #18;
          |ABRE #18;
          |ABRE #32;               ||Clientes
          |BUCLE pasar023;
          |CIERRA #32;
          |CIERRA #18;
     |FINSI;
     ||Descuentos promocionales
     |SI #0#15 = "S"; |Y tipo_exp = "central";
          |PINTA 2124 , blanco;
          |PINTA 2124 , "Dtos. Promocionales ";
          |PATH_DAT #21 path;   || Marco camino de comisionistas exportacion
          |ABRE #21; |CIERRA #21; |DELINDEX #21;
          |ABRE #21;
          |BUCLE pasar305;
          |CIERRA #21;
     |FINSI;

     || Albaranes
     |SI #0#2 = "S";
          |PINTA 2124 , blanco;
          |PINTA 2124 , "Albaranes";

          |PATH_DAT #3 path;
          |PATH_DAT #4 path;
          |ABRE #3; |CIERRA #3;
          |ABRE #4; |CIERRA #4;
          |DELINDEX #3;
          |DELINDEX #4;
          |ABRE #3;
          |ABRE #4;
          |SI tipo_exp = "delega";
               |BUCLE leealba;     ||Primero envio los no exportados
          |FINSI;
          |PATH_DAT #11 path;
          |PATH_DAT #12 path;
          |PATH_DAT #14 path;
          |ABRE #11; |CIERRA #11;
          |ABRE #12; |CIERRA #12;
          |ABRE #14; |CIERRA #14;
          |DELINDEX #11;
          |DELINDEX #12;
          |DELINDEX #14;
          |ABRE #11;
          |ABRE #12;
          |ABRE #14;
          |ABRE #9;
          |BUCLE leealba2;    ||Luego envio recibidos y facturados
          |CIERRA #9;
          |CIERRA #11;
          |CIERRA #12;
          |CIERRA #3;
          |CIERRA #4;
          |CIERRA #14;
     |FINSI;
     || Facturas Contado
     |SI #0#3 = "S";
          |PINTA 2124 , blanco;
          |PINTA 2124 , "Facturas Contado";

          |PATH_DAT #7 path;
          |PATH_DAT #8 path;
          |ABRE #7; |CIERRA #7;
          |ABRE #8; |CIERRA #8;
          |DELINDEX #7;
          |DELINDEX #8;
          |ABRE #7;
          |ABRE #8;
          |BUCLE leeconta;
          |CIERRA #7;
          |CIERRA #8;
     |FINSI;

||****************** proformas;
     |SI #0#16 = "S";
          |PINTA 2124 , blanco;
          |PINTA 2124 , "Facturas Proforma";

          |PATH_DAT #41 path;
          |PATH_DAT #43 path;
          |ABRE #41; |CIERRA #41;
          |ABRE #43; |CIERRA #43;
          |DELINDEX #41;
          |DELINDEX #43;
          |ABRE #41;
          |ABRE #43;
          |BUCLE leeprofo;
          |CIERRA #41;
          |CIERRA #43;
     |FINSI;
||******************** Pedidos Vta;
     |SI #0#17 = "S";
          |PINTA 2124 , blanco;
          |PINTA 2124 , "Pedidos Vta.";

          |PATH_DAT #45 path;
          |PATH_DAT #47 path;
          |ABRE #45; |CIERRA #45;
          |ABRE #47; |CIERRA #47;
          |DELINDEX #45;
          |DELINDEX #47;
          |ABRE #45;
          |ABRE #47;
          |BUCLE leepvta;
          |CIERRA #45;
          |CIERRA #47;
     |FINSI;

     || Factu Venta
     |SI #0#18 = "S";
          |PINTA 2124 , blanco;
          |PINTA 2124 , "Fac. Vta.";
          |PATH_DAT #11 path;
          |PATH_DAT #12 path;
          |PATH_DAT #14 path;
          |DELINDEX #11; |DELINDEX #12; |DELINDEX #14;
          |ABRE #11; |ABRE #12; |ABRE #13; |ABRE #14;
          |BUCLE FacVenta;
          |CIERRA #11; |CIERRA #12; |CIERRA #13; |CIERRA #14;
     |FINSI;

     |HAZ DesCargaDef;

     |SI sw_pasada = 1;
          |HAZ Comprime;
          |SI #0#22 = "S";        || SI quiere envio Por Correo.
               qFichero = path + aTar;

               |SI tipo_exp = "central";
                    |CONFI "0000SEnviar Exportacion a delegaciones ahora: ";
                    |SI FSalida = 0;
                         |MENAV "0000Atencion!! Debe estar conectado a internet";
                         |SUB_EJECUTA "dsm00203.tab;moddel";
                    |FINSI;
               |SINO;
                    |CONFI "0000SEnviar Exportacion a central ahora: ";
                    |SI FSalida = 0;
                         |MENAV "0000Atencion!! Debe estar conectado a internet";
                         |SUB_EJECUTA "dsm00205.tab";
                    |FINSI;
               |FINSI;
          |FINSI;
     |SINO;
          |MENAV "0000No hay nada nuevo para exportar!!";
     |FINSI;
|FPRC;

|PROCESO alb; |TIPO 0;
     |SI #0Campo = "N";
          |CAMPO_MODIFICA #0#9 , 1 , "N";
          |CAMPO_MODIFICA #0#10 , 1 , "N";
          |CAMPO_MODIFICA #0#21 , 1 , "N";
     |SINO;
          |CAMPO_MODIFICA #0#9 , 1 , "S";
          |CAMPO_MODIFICA #0#10 , 1 , "S";
          |CAMPO_MODIFICA #0#21 , 1 , "S";
     |FINSI;
|FPRC;

|PROCESO cli; |TIPO 0;
     |SI #0Campo = "N";
          |CAMPO_MODIFICA #0#11 , 1 , "N";
          |CAMPO_MODIFICA #0#12 , 1 , "N";
     |SINO;
          |CAMPO_MODIFICA #0#11 , 1 , "S";
          |CAMPO_MODIFICA #0#12 , 1 , "S";
     |FINSI;
|FPRC;

|PROCESO tipo7; |TIPO 7;
     |ATRI R;
     |SI tipo_exp = "central";
          |PINTA 0532, "CENTRAL ";
     |SINO;
          |PINTA 0532, "DELEGACION ";
     |FINSI;
     |ATRI 0;
|FPRC;

|PROCESO mayus; |TIPO 0;
 #0Campo = #0Campo > " ";
 |PINTA #0Campo;
|FPRC;
=======================================================================
|PROCESO BusCampos;
     |DFICE org; |QBF org;
     |DBASE des; |QBF des;
     |DDEF  def; |QBF def;
      eaNomDef = "agifa010"; |HAZ CamposDef; n010 = enCamposDef;
      eaNomDef = "agifa071"; |HAZ CamposDef; n071 = enCamposDef;
      eaNomDef = "agifa084"; |HAZ CamposDef; n084 = enCamposDef;
      eaNomDef = "agifa069"; |HAZ CamposDef; n069 = enCamposDef;
      eaNomDef = "agifa134"; |HAZ CamposDef; n134 = enCamposDef;
      eaNomDef = "agifa134"; |HAZ CamposDef; n134 = enCamposDef;
      eaNomDef = "agifa059"; |HAZ CamposDef; n059 = enCamposDef;
      eaNomDef = "agifa133"; |HAZ CamposDef; n133 = enCamposDef;
      eaNomDef = "agifa039"; |HAZ CamposDef; n039 = enCamposDef;
      eaNomDef = "agifa023"; |HAZ CamposDef; n023 = enCamposDef;
      eaNomDef = "dsm00117"; |HAZ CamposDef; n305 = enCamposDef;
      eaNomDef = "agifa024"; |HAZ CamposDef; n024 = enCamposDef;
      eaNomDef = "agifa019"; |HAZ CamposDef; n019 = enCamposDef;
      eaNomDef = "agifa112"; |HAZ CamposDef; n112 = enCamposDef;
      eaNomDef = "agifa025"; |HAZ CamposDef; n025 = enCamposDef;
      eaNomDef = "agifa146"; |HAZ CamposDef; n146 = enCamposDef;
      eaNomDef = "agifa147"; |HAZ CamposDef; n147 = enCamposDef;
      eaNomDef = "agifa104"; |HAZ CamposDef; n104 = enCamposDef;
      eaNomDef = "agifa073"; |HAZ CamposDef; n073 = enCamposDef;
|FPRC;

|PROCESO CargaDef;
     |DBASE aPath;

     aDef1 = aPath + "def/" + "agifa010";
     aDef  = aDef1;
     |CARGA_DEF aDef, expor010@;
     |SI FSalida ! 0;
          swErr = 1;
          aDef1 = "";
          |ACABA;
     |FINSI;

     aDef2 = aPath + "def/" + "agifa071";
     aDef  = aDef2;
     |CARGA_DEF aDef, expor071@;
     |SI FSalida ! 0;
          swErr = 1;
          aDef2 = "";
          |ACABA;
     |FINSI;

     aDef3 = aPath + "def/" + "agifa084";
     aDef  = aDef3;
     |CARGA_DEF aDef, expor084@;
     |SI FSalida ! 0;
          swErr = 1;
          aDef3 = "";
          |ACABA;
     |FINSI;

     aDef4 = aPath + "def/" + "agifa069";
     aDef  = aDef4;
     |CARGA_DEF aDef, expor069@;
     |SI FSalida ! 0;
          swErr = 1;
          aDef4 = "";
          |ACABA;
     |FINSI;

     aDef5 = aPath + "def/" + "agifa134";
     aDef  = aDef5;
     |CARGA_DEF aDef, expor134@;
     |SI FSalida ! 0;
          swErr = 1;
          aDef5 = "";
          |ACABA;
     |FINSI;

     aDef7 = aPath + "def/" + "agifa059";
     aDef  = aDef7;
     |CARGA_DEF aDef, expor059@;
     |SI FSalida ! 0;
          swErr = 1;
          aDef7 = "";
          |ACABA;
     |FINSI;

     aDef8 = aPath + "def/" + "agifa133";
     aDef  = aDef8;
     |CARGA_DEF aDef, expor133@;
     |SI FSalida ! 0;
          swErr = 1;
          aDef8 = "";
          |ACABA;
     |FINSI;

     aDef9 = aPath + "def/" + "agifa039";
     aDef  = aDef9;
     |CARGA_DEF aDef, expor039@;
     |SI FSalida ! 0;
          swErr = 1;
          aDef9 = "";
          |ACABA;
     |FINSI;

     aDef10= aPath + "def/" + "agifa023";
     aDef  = aDef10;
     |CARGA_DEF aDef, expor023@;
     |SI FSalida ! 0;
          swErr = 1;
          aDef10 = "";
          |ACABA;
     |FINSI;

     aDef11= aPath + "def/" + "dsm00117";
     aDef  = aDef11;
     |CARGA_DEF aDef, expor117@;
     |SI FSalida ! 0;
          swErr = 1;
          aDef11 = "";
          |ACABA;
     |FINSI;

     aDef13= aPath + "def/" + "agifa024";
     aDef  = aDef13;
     |CARGA_DEF aDef, expor024@;
     |SI FSalida ! 0;
          swErr = 1;
          aDef13 = "";
          |ACABA;
     |FINSI;

     aDef14= aPath + "def/" + "agifa019";
     aDef  = aDef14;
     |CARGA_DEF aDef, expor019@;
     |SI FSalida ! 0;
          swErr = 1;
          aDef14 = "";
          |ACABA;
     |FINSI;

     aDef15= aPath + "def/" + "agifa112";
     aDef  = aDef15;
     |CARGA_DEF aDef, expor112@;
     |SI FSalida ! 0;
          swErr = 1;
          aDef15 = "";
          |ACABA;
     |FINSI;

     aDef16= aPath + "def/" + "agifa025";
     aDef  = aDef16;
     |CARGA_DEF aDef, expor025@;
     |SI FSalida ! 0;
          swErr = 1;
          aDef16 = "";
          |ACABA;
     |FINSI;

     aDef17= aPath + "def/" + "agifa146";
     aDef  = aDef17;
     |CARGA_DEF aDef, expor146@;
     |SI FSalida ! 0;
          swErr = 1;
          aDef17 = "";
          |ACABA;
     |FINSI;

     aDef18= aPath + "def/" + "agifa147";
     aDef  = aDef18;
     |CARGA_DEF aDef, expor147@;
     |SI FSalida ! 0;
          swErr = 1;
          aDef18 = "";
          |ACABA;
     |FINSI;

     aDef19= aPath + "def/" + "agifa104";
     aDef  = aDef19;
     |CARGA_DEF aDef, expor104@;
     |SI FSalida ! 0;
          swErr = 1;
          aDef19 = "";
          |ACABA;
     |FINSI;

     aDef20= aPath + "def/" + "agifa073";
     aDef  = aDef20;
     |CARGA_DEF aDef, expor073@;
     |SI FSalida ! 0;
          swErr = 1;
          aDef20 = "";
          |ACABA;
     |FINSI;

     |HAZ NomeDat;

|FPRC;

|PROCESO DesCargaDef;
     |SI aDef20 ! ""; |DESCARGA_DEF #expor073@; |FINSI;
     |SI aDef19 ! ""; |DESCARGA_DEF #expor104@; |FINSI;
     |SI aDef18 ! ""; |DESCARGA_DEF #expor147@; |FINSI;
     |SI aDef17 ! ""; |DESCARGA_DEF #expor146@; |FINSI;
     |SI aDef16 ! ""; |DESCARGA_DEF #expor025@; |FINSI;
     |SI aDef15 ! ""; |DESCARGA_DEF #expor112@; |FINSI;
     |SI aDef14 ! ""; |DESCARGA_DEF #expor019@; |FINSI;
     |SI aDef13 ! ""; |DESCARGA_DEF #expor024@; |FINSI;
     |SI aDef11 ! ""; |DESCARGA_DEF #expor117@; |FINSI;
     |SI aDef10 ! ""; |DESCARGA_DEF #expor023@; |FINSI;
     |SI aDef9  ! ""; |DESCARGA_DEF #expor039@; |FINSI;
     |SI aDef8  ! ""; |DESCARGA_DEF #expor133@; |FINSI;
     |SI aDef7  ! ""; |DESCARGA_DEF #expor059@; |FINSI;
     |SI aDef5  ! ""; |DESCARGA_DEF #expor134@; |FINSI;
     |SI aDef4  ! ""; |DESCARGA_DEF #expor069@; |FINSI;
     |SI aDef3  ! ""; |DESCARGA_DEF #expor084@; |FINSI;
     |SI aDef2  ! ""; |DESCARGA_DEF #expor071@; |FINSI;
     |SI aDef1  ! ""; |DESCARGA_DEF #expor010@; |FINSI;
|FPRC;

|PROCESO NomeDat;
     |NOME_DAT #47 "expor073";
     |NOME_DAT #45 "expor104";
     |NOME_DAT #43 "expor147";
     |NOME_DAT #41 "expor146";
     |NOME_DAT #39 "expor025";
     |NOME_DAT #37 "expor112";
     |NOME_DAT #35 "expor019";
     |NOME_DAT #33 "expor024";
     |NOME_DAT #21 "expor117";
     |NOME_DAT #18 "expor023";
     |NOME_DAT #16 "expor039";
     |NOME_DAT #14 "expor133";
     |NOME_DAT #12 "expor059";
     |NOME_DAT #11 "expor134";
     |NOME_DAT #8  "expor069";
     |NOME_DAT #7  "expor084";
     |NOME_DAT #4  "expor071";
     |NOME_DAT #3  "expor010";
|FPRC;

컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
  El Nombre del Fichero:  aammdd + empresa + "." + Linea Histo
           digitos....   Fecha(6)   (5)             (3)
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴


|PROCESO Comprime;
     |DFICE dirfich; |QBF dirfich; ||Directorio de la empresa
     empresa = dirfich % -205;

     |ABRE #100;
     #100#0 = "E";
     #100#1 = fFecha;
     #100#2 = 999;
     |LEE 000#100];
     |SI FSalida = 0;
          |LEE 000#100a;
     |SINO;
          |LEE 000#100u;
     |FINSI;
     |SI FSalida = 0; |Y #100#0 = "E"; |Y #100#1 = fFecha;
          nLin = #100#2 + 1;
     |SINO;
          nLin = 1;
     |FINSI;

     aFic = (fFecha % -102) + (fFecha % 402) + (fFecha % 102);
     aAlfa = ("000" + nLin) % -103;
     aTar = aFic + empresa + "." + aAlfa;    ||->Nombre del Fichero

     a1 = path + aTar + " *.dat *.ixx *.ddx";
     a2 = path;
     |ATAR a1, a2;

     a1 = path + aTar;
     |COMPRIME a1;
     |FBORRA a1;
     a2 = path + aFic + empresa + ".gz";
     |RENOMBRA_FICHERO a2, a1;

     aFic = path + aTar;
     |XABRE "E", aFic, 0;
     |SI FSalida ! 0;
          aAlfa = "0000No puede compactar... " + aTar;
          |MENAV aAlfa;
          aTar = "ERROR EN TAR";
     |SINO;
          aFic = path;
          |_PDIR aFic;
          |PARA; |SI FSalida = 0; |HACIENDO;
               aAlfa = aFic % -103;
               |SI aAlfa = "ddx"; |O aAlfa = "ixx"; |O aAlfa = "dat";
                    aAlfa = aFic % -1102;
                    |SI aAlfa = "ex"; |FBORRA aFic; |FINSI;
                    aAlfa = aFic % -0507;
                    |SI aAlfa = "testigo"; |FBORRA aFic; |FINSI;
               |FINSI;
               |_SDIR aFic;
          |SIGUE;
     |FINSI;
     ||--------------------Registro
     |HORA aAlfa;
     |DDEFECTO #100;
     #100#0 = "E";
     #100#1 = fFecha;
     #100#2 = nLin;
     #100#3 = aAlfa;
     #100#4 = Usuario % 810;
     #100#5 = aTar;
     |GRABA 020#100n;
     |CIERRA #100;
|FPRC;

|PROGRAMA;
     aParam = PARAMETRO;
     |QBF aParam;
     param = aParam;
     |SI aParam = "centralaut";
          param = "central";
     |FINSI;
     |SI aParam = "delegaaut";
          param = "delega";
     |FINSI;
     |ABRE #0;
     #0#23 = 1;
     |LEE 101#0=;
     |SI FSalida ! 0;
          |DDEFECTO #0;
          |GRABA 020#0b;
     |FINSI;
     |SI aParam = "centralaut";
          |HAZ tipo3;
     |SINO;
          |PINPA #0#0;
          |PINDA #0#0;
          |SI param = "central";
               tipo_exp = "central";
               |ATRI R;
               |PINTA 0532, "CENTRAL ";
               |ATRI 0;
          |SINO;
               tipo_exp = "delega";
               |ATRI R;
               |PINTA 0532, "DELEGACION ";
               |ATRI 0;
               |CAMPO_MODIFICA #0#13 , 1 , "N";
               |CAMPO_MODIFICA #0#14 , 1 , "N";
               |CAMPO_MODIFICA #0#15 , 1 , "N";
          |FINSI;
          |ENDATOS #1#0;
          |SI FSalida = 0;
               |GRABA 020#0a;
               |HAZ tipo3;
          |FINSI;
     |FINSI;
     |CIERRA #0;
|FPRO;
