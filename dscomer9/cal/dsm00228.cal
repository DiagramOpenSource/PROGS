|FICHEROS;
     dsm00228 #0;
     dsm00221 #1;   ||parametros Correo
|FIN;

|VARIABLES;
     &qFichero = "";
     ip_serv = "";
     serv_correo = "";
     from = "";
     to = "";
     subject = "";
     mensaje = "";
     ficheros = "";
     prim = 0;
     &errorenv = 0;
     aAutenti = "";
     aVacia = "";
     aConexion = "";
     aDesconexion = "";
|FIN;

|PROGRAMA;
||     |CONFI "0000SEsta seguro de que desea enviar los datos";
||     |SI FSalida = 0;
          errorenv = 0;
          |ABRE #0;
          |ABRE #1;
          |LEE 010#1p;
          |SI FSalida ! 0;
               |MENAV "0000No se han establecido los parametros de envio";
          |SINO;
               |SI #1#19 = "F";
                    ip_serv = #1#18;  |QBF ip_serv;
               |SINO;
                    |SI #1#19 = "L";   |IP_REMOTO ip_serv;    |FINSI;
                    |SI #1#19 = "S";   |IP_LOCAL ip_serv;     |FINSI;
               |FINSI;

               ||Autentificar al Enviar SI/NO
               |SI #1#17 = "S";
                    aAutenti = #1#13;
                    |QBF aAutenti;
                    aAutenti = aAutenti + ":" + #1#12;
                    |QBF aAutenti;
                    aAutenti = aAutenti + ":" + #1#6;
               |SINO;
                    aAutenti = #1#6;
               |FINSI;

               serv_correo = #1#5;
               from = aAutenti;
               prim = 0;
               to = #1#7;
               subject = #1#8;
               mensaje = #1#9;
               ficheros = qFichero;
               |QBT ip_serv ;
               |QBF serv_correo;
               |QBF from;
               |QBF to;
               |QBF subject;
               |QBF mensaje;
               |QBF ficheros;

               aConexion = #1#20;       |QBF aConexion;
               aDesconexion = #1#21;    |QBF aDesconexion;

               |MENSA "0000Enviando fichero ...";
               ||DSCORREO_RECIBE "LLAMA",serv_correo,aVacia,aVacia,aVacia,aVacia;
               |SYSTEM aConexion;
               |DSCORREO_ENVIA ip_serv,serv_correo,from,to,subject,mensaje,ficheros;
               |SI FSalida ! 0;
                    ||PINTA 1010, ip_serv;
                    ||PINTA 1110, serv_correo;
                    ||PINTA 1210, from;
                    ||PINTA 1310, to;
                    ||PINTA 1410, subject;
                    ||PINTA 1510, mensaje;
                    ||PINTA 1610, ficheros;
                    |MENAV "0000Ha habido un error durante el envio.";
                    errorenv = 1;
               |SINO;
                    ||MENSA "000Mensaje enviado."
                    ||DSCORREO_RECIBE "CUELGA",serv_correo,aVacia,aVacia,aVacia,aVacia;
                    |SYSTEM aDesconexion;
               |FINSI;
          |FINSI;
          |CIERRA #1;
          |CIERRA #0;
||     |FINSI;
|FPRO;
