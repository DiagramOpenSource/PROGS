|FICHEROS;
     diaw0007,MANTE;

     agifa104;
     agifa071;
     agifa073;
|FIN;

|VARIABLES;
     &enSwMenu = 0;
     &enTiva = 0;
     &efFiva = @;
     &eaDiva = "";
     &enIva = 0;
     &enRec = 0;
     nEstado   = 0;

     &enExiste        = 0;
     &enSalida        = 0;
     &enChequeAlbaran = 0;
     &enTotal         = 0;
     &eaCliente       = "";
|FIN;

|PROCESO CogePedido;  |TIPO 7;
     |ABRE #agifa104;

     #agifa104#25 = #diaw0007#0;
     enSwMenu = 1;
     |HAZ ContaPV7;
     #diaw0007#1 = #agifa104#0;

     |CIERRA #agifa104;

     |PINTA #diaw0007#1;
|FPRC;

|PROCESO NumPedido;
     |SI #diaw0007#1 > 999999;
         |MENAV "     Codigo de Pedido incorrecto.";
         |ERROR;
     |FINSI;
|FPRC;

|PROCESO Tipo12w7;  |TIPO 12;
     |SI FSalida = 7;
         enSalida = 1;
         |ACABA;
     |FINSI;

     enSalida = 0;

     |ABRE #agifa104;
     #agifa104#25 = #diaw0007#0;
     #agifa104#0  = #diaw0007#1;
     |LEE 040#agifa104.=;
     nEstado = FSalida;
     |CIERRA #agifa104;

     |SI enExiste = 0;
         |SI nEstado ! 0;
             |MENAV "0000 El Pedido NO Existe.";
             enSalida = 1;
             |ACABA;
         |FINSI;

         |SI enChequeAlbaran = 1;
             |ABRE #agifa073;
             #agifa073#28 = #agifa104#25;
             #agifa073#0  = #agifa104#0;
             #agifa073#1  = 1;
             |LEE 040#agifa073.];
             |SI FSalida ! 0;  |O  #agifa073#28 ! #agifa104#25;  |O  #agifa073#0  ! #agifa104#0;
                 |DDEFECTO #agifa073;
                 #agifa073#0 = 0;
             |FINSI;
             |CIERRA #agifa073;

             |ABRE #agifa071;
             |SELECT #4#agifa071;
             #agifa071#31 = #agifa073#28;
             #agifa071#12 = #agifa073#0;
             #agifa071#21 = #agifa073#1;
             |LEE 040#agifa071.=;
             |SI FSalida = 0;
                 |MENAV "0000 El Pedido YA esta en Facturacion";
                 |CIERRA #agifa071;
                 enSalida = 1;
                 |ACABA;
             |FINSI;
             |CIERRA #agifa071;
         |SINO;
             |SI eaCliente ! #agifa104#4;
                 |MENAV "0000 El Cliente del Prepedido no coincide con el del Pedido";
                 enSalida = 1;
                 |ACABA;
             |FINSI;

             |SI enTotal ! #agifa104#45;
                 |MENAV "0000 El Importe del Prepedido no coincide con el del Pedido";
                 enSalida = 1;
                 |ACABA;
             |FINSI;
         |FINSI;
     |FINSI;

     |SI enExiste = 1;
         |SI nEstado = 0;
             |MENAV "0000 El Pedido YA Existe.";
              enSalida = 1;
             |ACABA;
         |FINSI;

         |CONFI "0000SDesea pasar a Pedidos ";
         |SI FSalida ! 0;
             enSalida = 1;
             |ACABA;
         |FINSI;
     |FINSI;

     |SI enSalida = 0;  |Y enChequeAlbaran = 0;
         |CONFI "0000SDesea asignar el Pedido ";
         |SI FSalida ! 0;
             enSalida = 1;
             |ACABA;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO IVAw07_0; |TIPO 0;
     enTiva = #diaw0007#Campo#;
     efFiva = #diaw0007#2;
     |HAZ SacaIVA;
     |SI eaDiva = "";
          |MENAV "0000No existe tipo iva para esta fecha...";
          |ERROR; |ACABA;
     |SINO;
          #diaw0007#4 = eaDiva; |PINTA #diaw0007#4;
     |FINSI;
|FPRC;

|PROCESO IVAw07_66; |TIPO 66;
     enTiva = #diaw0007#Campo#;
     efFiva = #diaw0007#2;
     |HAZ ConsuIVA;
     |SI eaDiva = "";
          |ERROR;
     |SINO;
          #diaw0007#Campo# = enTiva; |PINTA #diaw0007#Campo#;
          #diaw0007#4 = eaDiva; |PINTA #diaw0007#4;
     |FINSI;
|FPRC;
