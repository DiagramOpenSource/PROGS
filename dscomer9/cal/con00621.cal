|FICHEROS;
     con00621 #0;
     con00620 #1;
     agifa027 #2;
     con00670 #3;

     agifa079 #20;
     agifa072 #21;
     agifa112 #112;
     con00691 #691;
     agifa142 #142;
|FIN;

|VARIABLES;
     &EURODB = 0;
     &enTiva = 0;   || Variables para la gestion
     &efFiva = @;
     &eaDiva = "";
     &enIva = 0;
     &enRec = 0;
     aCta = "";
|FIN;

|PROGRAMA;
|HAZ TallerDeci;
|CLS;
|PINPA #0#0;
|PINDA #0#0;
|ENDATOS #1#0;
|SI FSalida = 0; |Y #0#16 = "S";
     |ABRE #1;
     |DDEFECTO #1;
     #1#0 = #0#13;
     #1#1 = #0#14;
     #1#2 = #0#15;
     #1#3 = #0#9;

     |ABRE #112;
     #112#0 = #0#9;
     |LEE 000#112=;
     |CIERRA #112;
     #1#4 = #112#1;

     #1#5 = #0#0;
     |SI #0#4 = 0;
         #1#6 = #0#2;
     |SINO;
         #1#7 = #0#2;
     |FINSI;
     #1#8 = #0#4;
     #1#9 = #0#6;
     #1#10 = #0#5;
     #1#11 = #0#1;
     #1#14 = #0#17;
     #1#15 = #0#18;
     |GRABA 021#1n;
     |LIBERA #1;
     |CIERRA #1;

     |HAZ CreaFactCompra;


     |ABRE #3;
     #3#0 = #0#0;
     #3#22= #0#17;
     |LEE 020#3=;
     |SI FSalida = 0;
          |ABRE #112;
          #112#0 = #0#9;
          |LEE 000#112=;
          |CIERRA #112;
          #3#19 = #112#1;
          aCta = #112#10;

          #3#40 = #0#18;
          #3#11 = #0#9;
          #3#30 = #0#13;
          #3#12 = #0#14;
          #3#27 = #0#6;
          #3#33 = #0#19;
          #3#23 = #0#1;

          |GRABA 020#3a;
     |FINSI;
     |CIERRA #3;
|FINSI;
|FPRO;


|PROCESO compra;
|SI #0#3 = "E";
     #0#2 = (#0#1 / (1+(#0#6/100))) ! EURODB;
     #0#5 = (#0#1 - #0#2) ! EURODB;
     |C_M #0#4, 1, "S";
|SINO;
     #0#2 = #0#1;
     #0#5 = 0;
     #0#4 = 0;
     #0#6 = 0;
     |C_M #0#4, 1, "N";
|FINSI;
|PINTA #0#2;
|PINTA #0#5;
|PINTA #0#4;
|PINTA #0#6;
|FPRC;

|PROCESO factura;
     |ABRE #142; |LEE 000#142p; |CIERRA #142;
|FPRC;

|PROCESO Conta7; |TIPO 7;
     |ABRE #20;
     #20#66 = #0#13;
     |HAZ ContaFC7;
     #0#14 = #20#0; |PINTA #0#14;
     |CIERRA #20;
|FPRC;

|PROCESO Conta0; |TIPO 0;
     |ABRE #20;
     #20#66 = #0#13;
     #20#0 = #0#14;
     |HAZ ContaFC0;
     |CIERRA #20;
|FPRC;

|PROCESO buena;
|SI #3#12 ! 0;
     |MENAV "0000Vehiculo ya facturado";
     |PTEC 808;
|SINO;
     |HAZ compra;
|FINSI;
|FPRC;

|PROCESO CreaFactCompra;
     |ABRE #112;
     #112#0 = #1#3;
     |LEE 000#112=;
     |SI FSalida ! 0; |DDEFECTO #112; |FINSI;
     |CIERRA #112;

     |ABRE #20; |ABRE #21;

     |DDEFECTO #20;
     #20#0 = #1#1;
     #20#1 = #1#2;
     #20#2 = #1#3;
     #20#3 = #1#4;
     #20#66 = #1#0;
     #20#12 = aCta;

     #20#18  = #1#7 + #1#6; ||Bruto
     #20#82  = #20#18;
     #20#105 = #20#18;

     #20#21  = #1#7; ||Base1
     #20#85  = #20#21;
     #20#108 = #20#21;

     #20#22  = #1#10;||Cuota1
     #20#86  = #20#22;
     #20#109 = #20#22;

     #20#29  = #1#12; ||T.IVA
     #20#93  = #20#29;
     #20#116 = #20#29;

     #20#31  = #1#11; ||T.Fac
     #20#95  = #20#31;
     #20#118 = #20#31;

     #20#56 = #1#9;  ||%iva1

     #20#75 = "EUR";
     #20#76 = 1;
     #20#77 = "B";
     #20#78 = "EUR";
     #20#79 = 1;

     |GRABA 001#20c; |LIBERA #20;

     |DDEFECTO #21;
     #21#16 = #20#66;
     #21#0  = #20#0;
     #21#1  = 1;
     |GRABA 020#21n;

     |HAZ VenciComp;
     |HAZ CreaRecCompra;

     |CIERRA #20; |CIERRA #21;
|FPRC;

|PROCESO Iva0; |TIPO 0;
     enTiva = #0#4;
     efFiva = #0#15;
     |HAZ SacaIVA;
     |SI eaDiva = "";
          |MENAV "0000No existe iva para la fecha...";
          |ERROR;
     |SINO;
          #0#6 = enIva; |PINTA #0#6;
          |HAZ compra;
     |FINSI;
|FPRC;

|PROCESO Iva66; |TIPO 66;
     enTiva = #0#4;
     efFiva = #0#15;
     |HAZ ConsuIVA;
     |SI eaDiva = "";
          |ERROR;
     |SINO;
          #0#6 = enIva; |PINTA #0#6;
          |HAZ compra;
     |FINSI;
|FPRC;
