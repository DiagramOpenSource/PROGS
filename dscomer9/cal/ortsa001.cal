|FICHEROS;
     orts0001 #0;        || este def
     agifa104 #1;        || Pedidos Venta (C)
     agifa073 #2;        || Pedidos Venta (L)
     agifa024 #3;        || Clientes
     ortsm008 #8;
     ortsm013 #13; ||Contador Etiquetas
     ortsm017 #17;
     ortsm018 #18;
     dsm00003 #30;
     ortsw005 #100; ||TMP
     ortsw006 #101; ||TMP
|FIN;

|VARIABLES;
     aTmp5 = "";
     aTmp6 = "";
     &Tempo = "";
     &enTipo = 0;
     &enTiva = 0;
     &efFiva = @;
     &eaDiva = "";
     &enIva = 0;
     &enRec = 0;
     informe = "orts0001";

     aCli = "";
     nDir = 0;
     nHay = 0;

     &dp = 0;
     &da = 0;
     &iva= 0;
     &rec= 0;
     &pdte= 0;
|FIN;

|PROCESO DesCombiUni;
     enTipo = 2;
     |PRINT;
|FPRC;

|DEFBUCLE DesCombiUni;
     #18#1;
     ;
     #17#0, #17#1, #17#2, #17#3, 001;
     #17#0, #17#1, #17#2, #17#3, 999;
     ;
     NULL, DesCombiUni;
|FIN;

|PROCESO DesCombi;
     enTipo = 1;
     |PRINT;
     |BUCLE DesCombiUni;
|FPRC;

|DEFBUCLE DesCombi;
     #17#1;
     ;
     #2#28, #2#0, #2#1, 001;
     #2#28, #2#0, #2#1, 999;
     ;
     NULL, DesCombi;
|FIN;

|PROCESO impresion;
     enTiva = #2#14;
     efFiva = #1#1;
     |HAZ SacaIVA;

     iva = 0;
     rec = 0;
     |SI #3#28 = "N";    ||Exportacion;
          iva = enIva;
          |SI #3#47 = "S"; rec = enRec; |FINSI;
     |FINSI;

     pdte = #2#5-#2#43;
     |SI #0#14 ! "T";
          |SI #0#14 = "P";
               |SI pdte = 0; |ACABA; |FINSI;
          |SINO;
               |SI pdte ! 0; |ACABA; |FINSI;
          |FINSI;
     |FINSI;

     nHay = 1;
     enTipo = 0;
     |PRINT;
     |SI #0#13 = "S";
          #8#0 = #2#28;
          #8#1 = #2#0;
          #8#2 = #2#1;
          |LEE 000#8=;
          |SI FSalida ! 0; |DDEFECTO #8; |FINSI;

          |BUCLE DesCombi;
     |FINSI;
|FPRC;

|DEFBUCLE linpedi;
      #2#1;
      ;
      #1#25, #1#0, 001;
      #1#25, #1#0, 999;
      ;
      NULL,NULL,NULL,NULL,NULL,impresion;
      #2#2;
|FIN;

|PROCESO TmpLin;
     #2#28 = #101#0;
     #2#0 = #101#1;
     #2#1 = #101#2;
     |LEE 020#2=;

     |HAZ impresion;

     |BORRA 020#101a;
|FPRC;

|DEFBUCLE TmpLin;
     #101#2;
     ;
     INICIO;
     FINAL;
     ;
     NULL, TmpLin;
|FIN;

|PROCESO GraTmpLin;
     #101#0 = #2#28;
     #101#1 = #2#0;
     #101#2 = #2#1;
     #101#3 = #2#2;
     |GRABA 020#101n;
|FPRC;

|DEFBUCLE GraTmpLin;
      #2#1;
      ;
      #1#25, #1#0, 001;
      #1#25, #1#0, 999;
      ;
      NULL, GraTmpLin;
|FIN;

|PROCESO lineas;
     |SI aCli ! #1#4; |O nDir ! #1#57;
          |SI aCli ! ""; |Y nHay = 1; |PIEINF; |FINSI;
          nHay = 0;
          aCli = #1#4;
          nDir = #1#57;
     |FINSI;

     |DDEFECTO #13;
     |SELECT #2#13; ||LECTURA POR LA CLAVE 2
     #13#1 = #1#25;
     #13#2 = #1#0;
     |LEE 000#13=;

     |DDEFECTO #30;
     #30#0 = #1#4;
     #30#1 = #1#57;
     |LEE 000#30=;

     dp = #1#6;
     da = #1#5;

     |DDEFECTO #3;
     #3#0 = #1#4;
     |LEE 000#3=;

     |SI #30#11 ] #0#9;|Y #30#11 [ #0#10;     ||Seleccion zonas;
          ||BUCLE linpedi;

          |BUCLE GraTmpLin;
          |BUCLE TmpLin;
     |FINSI;
|FPRC;

|PROCESO Tmp;
     #1#25 = #100#0;
     #1#0 = #100#1;
     |LEE 020#1=;
     |HAZ lineas;
|FPRC;

|DEFBUCLE Tmp;
     #100#2;
     ;
     "      ", 0000, "     ", 000000;
     "zzzzzz", 9999, "zzzzz", 999999;
     ;
     NULL, Tmp;
|FIN;

|PROCESO GraTmp;
     #100#0 = #1#25;
     #100#1 = #1#0;
     #100#2 = #1#4;
     #100#3 = #1#57;
     |GRABA 020#100n;
|FPRC;

|DEFBUCLE pedidoP;
    #1#1;
    1,4,12,2, 60;
    #0#4, #0#6, #0#2, #0#0, 0.1       , #0#11, #0#15;
    #0#5, #0#7, #0#3, #0#1, 9999999.99, #0#12, #0#16;
    ;
    NULL, GraTmp;

    ||NULL,NULL,NULL,NULL,NULL, lineas;
    ||#1#4, #1#57;
|FIN;

|DEFBUCLE pedido;
    #1#1;
    1,4,2, 60;
    #0#4, #0#6, #0#2, #0#0, #0#11, #0#15;
    #0#5, #0#7, #0#3, #0#1, #0#12, #0#16;
    ;
    NULL, GraTmp;

    ||NULL,NULL,NULL,NULL,NULL,lineas;
    ||#1#4, #1#57;
|FIN;

|PROCESO inicio;|TIPO 3;
     |HAZ CreaTempo; |NOME_DAT #100 Tempo; |DELINDEX #100; aTmp5 = Tempo;
     |HAZ CreaTempo; |NOME_DAT #101 Tempo; |DELINDEX #101; aTmp6 = Tempo;
     |ABRE #100;
     |ABRE #101;

     |ABRE #30;
     |ABRE #3;
     |ABRE #13;
     |ABRE #8;
     Impresora = "Crystal Reports";
     |IMPRE 0;
     |SI FSalida = 0;
            |INFOR informe;
            |SI FSalida ! 0;
                 informe = "0000No existe informe '" + informe + "'";
                 |MENAV informe;
            |SINO;
                 |SI #0#14 = "P";
                      |BUCLE pedidoP;
                 |SINO;
                      |BUCLE pedido;
                 |FINSI;

                 |ABRE #1;
                 |ABRE #2;
                 |BUCLE Tmp;
                 |CIERRA #2;
                 |CIERRA #1;

                 |SI aCli ! ""; |Y nHay = 1; |PIEINF; |FINSI;
                 |FININF;
            |FINSI;
            |FINIMP;
     |FINSI;
     |CIERRA #30;
     |CIERRA #3;
     |CIERRA #13;
     |CIERRA #8;

     Tempo = aTmp5; |CIERRA #100; |DELINDEX #100;
     Tempo = aTmp6; |CIERRA #101; |DELINDEX #101;
|FPRC;
