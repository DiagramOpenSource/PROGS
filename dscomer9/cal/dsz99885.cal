     COPIA DE  LOS FICHEROS:
          agifa010 <-> malpe090
          agifa071 <-> malpe091
          dsm00003 <-> malpe001
      Y Copia Direcion Entrega a otras Empresas

|FICHEROS;
     malpe001 #1;
     dsm00003 #3;
     pcegm004 #4;
     pcegm005 #5;
     agifa010 #10;
     agifa019 #19;
     agifa024 #24;
     agifa071 #71;
     agifa073 #73;
     agifa084 #84;
     malpe090 #90;
     malpe091 #91;
     malpe139 #139; || Como el XML
     agifa048 #148;
     agifa049 #149;
     dsm00235 #235;

     baezam01@;
     rodm0005@;
     dsm00087@;
     berm0001@ #101;
     berm0002@ #102;

     coima050@ #201;
     coima051@ #202;

     referen@;
|FIN;

|VARIABLES;
     aEmp = "";
     &eaRodExporta = "";
     aUsu = "";
     nContaLog = 0;
     aSer = "";
     aNum = "";
     aTipo = "";
     nReg = 0;
     nTipo = 0;
     &enEstaDentro = 0; || sirve para evitar reentradas
     i = 0;
     aPath = "";
     aDocu = "";
     nDistribuidor = 0;
     nNume = 0;
     &eaCongeCarVar = "";
     aSerNum = "";
     nExiste = 0;
|FIN;

|PROCESO EsIber_21; ||Igual que EsIber21
     |DBASE aPath;
     aPath = aPath + "/bin/iber0001.tab";
     |XABRE "E", aPath, 0;
|FPRC;

|PROCESO Es_Malpesa;   || Igual que EsMalpesa
     |DBASE aPath;
     aPath = aPath + "/def/malpe001.mas";
     |XABRE "E", aPath, 0;
     |SI FSalida = 0;
          |HAZ EsIber_21;
          |SI FSalida = 0;
              FSalida = 1;
          |SINO;
              FSalida = 0;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Es_Baeza; || Igual que EsBaeza
     |DBASE aPath;
     aPath = aPath + "/def/baezam01.mas";
     |XABRE "E", aPath, 0;
     |SI FSalida = 0;
          |HAZ EsIber_21;
          |SI FSalida = 0;
              FSalida = 1;
          |SINO;
              FSalida = 0;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Es_Berria;   || Igual que EsBerria
     |DBASE aPath;
     aPath = aPath + "/def/berm0003.mas";
     |XABRE "E", aPath, 0;
     |SI FSalida = 0;
          |HAZ EsIber_21;
          |SI FSalida = 0;
              FSalida = 1;
          |SINO;
              FSalida = 0;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Es_Coimasa;   || Igual que EsCoimasa
     |DBASE aPath;
     aPath = aPath + "/def/coima001.mas";
     |XABRE "E", aPath, 0;
     |SI FSalida = 0;
          |HAZ EsIber_21;
          |SI FSalida = 0;
              FSalida = 1;
          |SINO;
              FSalida = 0;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO &Tipo010_15; |TIPO 15;
     |SI enEstaDentro = 1; |ACABA; |FINSI;
     enEstaDentro = 1;

     nTipo = 15; |HAZ Log010;

     |HAZ Es_Malpesa;
     |SI FSalida = 0;
          |HAZ MalpeAlbGra;
     |FINSI;

     enEstaDentro = 0;
|FPRC;

|PROCESO &Tipo010_16; |TIPO 16;
     |SI enEstaDentro = 1; |ACABA; |FINSI;
     enEstaDentro = 1;

     nTipo = 16; |HAZ Log010;

     |HAZ Es_Malpesa;
     |SI FSalida = 0;
          |HAZ MalpeAlbMod;
     |FINSI;

     |HAZ Es_Baeza;
     |SI FSalida = 0;
          |HAZ BaezaAlbMod;
     |FINSI;

     aTipo = "M";
     aDocu = "agifa010";
     |HAZ CongeCopiaAlb;

     enEstaDentro = 0;
|FPRC;

|PROCESO &Tipo010_17; |TIPO 17;
     |SI enEstaDentro = 1; |ACABA; |FINSI;
     enEstaDentro = 1;

     nTipo = 17; |HAZ Log010;
     |HAZ JamaBajaAlb;
     |HAZ GesiBajaAlb;

     |HAZ Es_Malpesa;
     |SI FSalida = 0;
          |HAZ MalpeAlbBor;
     |FINSI;

     enEstaDentro = 0;
|FPRC;

|PROCESO &Tipo071_15; |TIPO 15;
     |SI enEstaDentro = 1; |ACABA; |FINSI;
     enEstaDentro = 1;

     |HAZ Es_Malpesa;
     |SI FSalida = 0;
          |HAZ MalpeLinAlbGra;
     |FINSI;

     aTipo = "A";
     aDocu = "agifa071";
     |HAZ CongeCopiaAlb;

     enEstaDentro = 0;
|FPRC;

|PROCESO &Tipo071_16; |TIPO 16;
     |SI enEstaDentro = 1; |ACABA; |FINSI;
     enEstaDentro = 1;

     |HAZ Es_Malpesa;
     |SI FSalida = 0;
          |HAZ MalpeLinAlbMod;
     |FINSI;

     aTipo = "M";
     aDocu = "agifa071";
     |HAZ CongeCopiaAlb;

     enEstaDentro = 0;
|FPRC;

|PROCESO &Tipo071_17; |TIPO 17;
     |SI enEstaDentro = 1; |ACABA; |FINSI;
     enEstaDentro = 1;

     |HAZ Es_Malpesa;
     |SI FSalida = 0;
          |HAZ MalpeLinAlbBor;
     |FINSI;

     aTipo = "B";
     aDocu = "agifa071";
     |HAZ CongeCopiaAlb;

     enEstaDentro = 0;
|FPRC;

|PROCESO &Copia10_15; |TIPO 15;
     |SI enEstaDentro = 1; |ACABA; |FINSI;
     enEstaDentro = 1;

     |HAZ Es_Malpesa;
     |SI FSalida = 0;
          |HAZ MalpeGraAlb;
     |FINSI;

     enEstaDentro = 0;
|FPRC;

|PROCESO &Copia10_16; |TIPO 16;
     |SI enEstaDentro = 1; |ACABA; |FINSI;
     enEstaDentro = 1;

     |HAZ Es_Malpesa;
     |SI FSalida = 0;
          |HAZ MalpeModAlb;
     |FINSI;

     enEstaDentro = 0;
|FPRC;

|PROCESO &Copia10_17; |TIPO 17;
     |SI enEstaDentro = 1; |ACABA; |FINSI;
     enEstaDentro = 1;

     |HAZ Es_Malpesa;
     |SI FSalida = 0;
          |HAZ MalpeBorAlb;
     |FINSI;

     enEstaDentro = 0;
|FPRC;

|PROCESO &Copia71_15; |TIPO 15;
     |SI enEstaDentro = 1; |ACABA; |FINSI;
     enEstaDentro = 1;

     |HAZ Es_Malpesa;
     |SI FSalida = 0;
          |HAZ MalpeLinGraAlb;
     |FINSI;

     enEstaDentro = 0;
|FPRC;

|PROCESO &Copia71_16; |TIPO 16;
     |SI enEstaDentro = 1; |ACABA; |FINSI;
     enEstaDentro = 1;

     |HAZ Es_Malpesa;
     |SI FSalida = 0;
          |HAZ MalpeLinModAlb;
     |FINSI;

     enEstaDentro = 0;
|FPRC;

|PROCESO &Copia71_17; |TIPO 17;
     |SI enEstaDentro = 1; |ACABA; |FINSI;
     enEstaDentro = 1;

     |HAZ Es_Malpesa;
     |SI FSalida = 0;
          |HAZ MalpeLinBorAlb;
     |FINSI;

     enEstaDentro = 0;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO MalpeGraAlb;
     |ABRE #10;
     #10#52 = #90#52;
     #10#0 = #90#0;
     |GRABA 000#10n;
     |CIERRA #10;
|FPRC;

|PROCESO MalpeModAlb;
     |ABRE #10;
     #10#52 = #90#52;
     #10#0 = #90#0;
     |LEE 101#10=;
     |SI FSalida ! 0; |GRABA 020#10b; |FINSI;
     |PARA i = 0; |SI i [ 91; |HACIENDO i = i + 1;
          #10i = #90i;
     |SIGUE;
     |GRABA 020#10a;
     |CIERRA #10;
|FPRC;

|PROCESO MalpeBorAlb;
     |ABRE #10;
     #10#52 = #90#52;
     #10#0 = #90#0;
     |BORRA 000#10c;
     |CIERRA #10;
|FPRC;

|PROCESO MalpeLinGraAlb;
     |ABRE #71;
     #71#29 = #91#29;
     #71#0 = #91#0;
     #71#1 = #91#1;
     |GRABA 000#71n;
     |CIERRA #71;
|FPRC;

|PROCESO MalpeLinModAlb;
     |ABRE #71;
     #71#29 = #91#29;
     #71#0 = #91#0;
     #71#1 = #91#1;
     |LEE 121#71=;
     |SI FSalida ! 0; |GRABA 020#71b; |FINSI;
     |PARA i = 0; |SI i [ 61; |HACIENDO i = i + 1;
          #71i = #91i;
     |SIGUE;
     |GRABA 020#71a;
     |CIERRA #71;
|FPRC;

|PROCESO MalpeLinBorAlb;
     |ABRE #71;
     #71#29 = #91#29;
     #71#0 = #91#0;
     #71#1 = #91#1;
     |BORRA 000#71c;
     |CIERRA #71;
|FPRC;

|PROCESO MalpeAlbGra;
     |ABRE #90;
     #90#52 = #10#52;
     #90#0 = #10#0;
     |GRABA 000#90n;
     |CIERRA #90;
|FPRC;

|PROCESO MalpeAlbMod;
     |ABRE #90;
     #90#52 = #10#52;
     #90#0 = #10#0;
     |LEE 121#90=;
     |SI FSalida ! 0; |GRABA 020#90b; |FINSI;
     |PARA i = 0; |SI i [ 91; |HACIENDO i = i + 1;
          #90i = #10i;
     |SIGUE;
     |GRABA 020#90a;
     |CIERRA #90;
|FPRC;

|PROCESO MalpeAlbBor;
     |ABRE #90;
     #90#52 = #10#52;
     #90#0 = #10#0;
     |BORRA 000#90c;
     |CIERRA #90;
|FPRC;

|PROCESO MalpeLinAlbGra;
     |ABRE #91;
     #91#29 = #71#29;
     #91#0 = #71#0;
     #91#1 = #71#1;
     |GRABA 000#91n;
     |CIERRA #91;
|FPRC;

|PROCESO MalpeLinAlbMod;
     |ABRE #91;
     #91#29 = #71#29;
     #91#0 = #71#0;
     #91#1 = #71#1;
     |LEE 121#91=;
     |SI FSalida ! 0; |GRABA 020#91b; |FINSI;
     |PARA i = 0; |SI i [ 61; |HACIENDO i = i + 1;
          #91i = #71i;
     |SIGUE;
     |GRABA 020#91a;
     |CIERRA #91;
|FPRC;

|PROCESO MalpeLinAlbBor;
     |ABRE #91;
     #91#29 = #71#29;
     #91#0 = #71#0;
     #91#1 = #71#1;
     |BORRA 000#91c;
     |CIERRA #91;
|FPRC;

컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
          DIR. ENTREGA
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO &Tipo003_15; |TIPO 15;
     |SI enEstaDentro = 1; |ACABA; |FINSI;

     nTipo = 15; |HAZ RodacalCopDir;
     |SI FSalida = 0; |ACABA; |FINSI;

     enEstaDentro = 1;

     |HAZ Es_Malpesa;
     |SI FSalida = 0;
          |HAZ MalpeEntGra;
     |FINSI;
     enEstaDentro = 0;
|FPRC;

|PROCESO &Tipo003_16; |TIPO 16;
     |SI enEstaDentro = 1; |ACABA; |FINSI;

     nTipo = 16; |HAZ RodacalCopDir;
     |SI FSalida = 0; |ACABA; |FINSI;

     enEstaDentro = 1;

     |HAZ DirEnt16;

     |HAZ Es_Malpesa;
     |SI FSalida = 0;
          |HAZ MalpeEntMod;
     |FINSI;
     enEstaDentro = 0;
|FPRC;

|PROCESO &Tipo003_17; |TIPO 17;
     |SI enEstaDentro = 1; |ACABA; |FINSI;


     nTipo = 16; |HAZ RodacalCopDir;
     |SI FSalida = 0; |ACABA; |FINSI;

     enEstaDentro = 1;

     |HAZ DirEnt17;

     |HAZ Es_Malpesa;
     |SI FSalida = 0;
          |HAZ MalpeEntBor;
     |FINSI;
     enEstaDentro = 0;
|FPRC;

|PROCESO &Copia1_15; |TIPO 15;
     |SI enEstaDentro = 1; |ACABA; |FINSI;
     enEstaDentro = 1;

     |HAZ Es_Malpesa;
     |SI FSalida = 0;
          |HAZ MalpeGraEnt;
     |FINSI;
     enEstaDentro = 0;
|FPRC;

|PROCESO &Copia1_16; |TIPO 16;
     |SI enEstaDentro = 1; |ACABA; |FINSI;
     enEstaDentro = 1;

     |HAZ Es_Malpesa;
     |SI FSalida = 0;
          |HAZ MalpeModEnt;
     |FINSI;
     enEstaDentro = 0;
|FPRC;

|PROCESO &Copia1_17; |TIPO 17;
     |SI enEstaDentro = 1; |ACABA; |FINSI;
     enEstaDentro = 1;

     |HAZ Es_Malpesa;
     |SI FSalida = 0;
          |HAZ MalpeBorEnt;
     |FINSI;
     enEstaDentro = 0;
|FPRC;

|PROCESO MalpeGraEnt;
     |ABRE #3;
     #3#0 = #1#0;
     #3#1 = #1#1;
     |GRABA 000#3n;
     |CIERRA #3;

     |ABRE #139;
     #139#0 = #1#1;
     #139#2 = #1#0;
     |GRABA 000#139n;
     |CIERRA #139;
|FPRC;

|PROCESO MalpeModEnt;
     |ABRE #3;
     #3#0 = #1#0;
     #3#1 = #1#1;
     |LEE 101#3=;
     |SI FSalida ! 0; |GRABA 020#3b; |FINSI;
     #3#2 = #1#5;
     #3#3 = #1#6;
     #3#4 = #1#8;
     #3#5 = #1#9;
     #3#6 = #1#25;
     #3#7 = #1#7;
     #3#8 = "ESPA쩇";
     #3#9 = "EUROPA";
     #3#10 = #1#2;
     #3#13 = #1#10;
     |GRABA 020#3a;
     |CIERRA #3;


     |ABRE #139;
     #139#0 = #1#1;
     #139#2 = #1#0;
     |LEE 101#139=;
     |SI FSalida ! 0; |GRABA 020#139b; |FINSI;
     #139#1 = #1#2;
     #139#3 = #1#12;
     #139#4 = #1#31;
     #139#5 = #1#11;
     #139#6 = #1#22;
     #139#7 = #1#5;
     #139#8 = #1#25;
     #139#8 = #1#6;
     #139#10 = #1#7;
     #139#11 = #1#17;
     #139#12 = #1#26;
     #139#13 = #1#18;
     #139#14 = #1#19;
     #139#15 = #1#13;
     #139#16 = #1#14;
     #139#17 = #1#32;
     #139#18 = #1#10;
     #139#19 = #1#34;
     #139#20 = #1#35;
     #139#21 = #1#29;
     #139#22 = #1#30;
     #139#23 = #1#16;
     #139#24 = #1#36;
     #139#25 = #1#39;
     #139#26 = #1#37;
     #139#27 = #1#38;
     |GRABA 000#139a;
     |CIERRA #139;
|FPRC;

|PROCESO MalpeBorEnt;
     |ABRE #3;
     #3#0 = #1#0;
     #3#1 = #1#1;
     |BORRA 000#1c;
     |CIERRA #3;

     |ABRE #139;
     #139#0 = #1#1;
     #139#2 = #1#0;
     |BORRA 000#139c;
     |CIERRA #139;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO MalpeEntGra;
     |ABRE #1;
     #1#0 = #3#0;
     #1#1 = #3#1;
     |GRABA 000#1n;
     |CIERRA #1;
|FPRC;

|PROCESO MalpeEntMod;
     |ABRE #1;
     #1#0 = #3#0;
     #1#1 = #3#1;
     |LEE 121#1=;
     |SI FSalida ! 0; |GRABA 020#1b; |FINSI;
     #1#5 = #3#2;
     #1#6 = #3#3;
     #1#8 = #3#4;
     #1#9 = #3#5;
     #1#25 = #3#6;
     #1#7 = #3#7;
     #1#2 = #3#10;
     #1#10 = #3#13;

     |GRABA 020#1a;
     |CIERRA #1;
|FPRC;

|PROCESO MalpeEntBor;
     |ABRE #1;
     #1#0 = #3#0;
     #1#1 = #3#1;
     |BORRA 000#1c;
     |CIERRA #1;
|FPRC;

====================================================================
                    || Copia Direcion Entrega a otras Empresas

|FICHEROS;
     dsm00003 #3;
     dsm00003@ #300;
     agifa041@ #41;
     agifa142@ #142;
     agifa200 #200;
     agifa205 #205;
     agifa208 #208;
|FIN;

|VARIABLES;
     aDef = "";
     aCopia = "";
     nBaja = 0;
     nAlta = 0;
     aAlfa = "";
     nCampo = 0;
|FIN;

|PROCESO agifa208;
     nCampo = #208#1;
     |SI nAlta = 1; |Y #208#3 = "S";
          #300nCampo = #3nCampo;
     |FINSI;
     |SI nAlta = 0; |Y #208#4 = "S";
          #300nCampo = #3nCampo;
     |FINSI;
|FPRC;

|DEFBUCLE agifa208;
     #208#1;
     ;
     "dsm00003", 001;
     "dsm00003", 999;
     ;
     NULL, agifa208;
|FIN;

|PROCESO agifa200;
     |SI #200#0 = aEmp;  || Por si estamos en la misma empresa
          |ACABA;
     |FINSI;
     |SI #200#12 = "N"; |Y nBaja = 1;
          |ACABA;
     |FINSI;
     |SI #200#10 = "N"; |Y #200#11 = "N"; |Y nBaja = 0;
          |ACABA;
     |FINSI;
     |DFICB aAlfa; |QBF aAlfa; |PATH_DAT #41 aAlfa;
     |ABRE #41;
     #41#0 = #200#0;
     |LEE 000#41=;
     |SI FSalida = 0;
          |DDEF aDef; aDef = "dsm00003";
          |CARGA_DEF aDef, dsm00003@;
          |SI FSalida = 0;
               |DFICB aAlfa; |QBF aAlfa;
               aAlfa = aAlfa + (("00000" + #agifa200#0) % -105) + "/";
               |PATH_DAT #300 aAlfa;
               |ABRE #300;
               #300#0 = #3#0;
               #300#1 = #3#1;
               |LEE 101#300=;
               |SI nBaja = 1; |Y FSalida = 0;
                    |BORRA 020#300a;
               |FINSI;
               |SI nBaja = 0;
                    |SI FSalida ! 0; |Y #200#10 = "S";
                         nAlta = 1;
                         |BUCLE agifa208;
                         |GRABA 020#300b;
                    |FINSI;
                    |SI FSalida = 0; |Y #200#11 = "S";
                         nAlta = 0;
                         |BUCLE agifa208;
                         |GRABA 020#300a;
                    |FINSI;
               |FINSI;
               |CIERRA #300;
               |DESCARGA_DEF #dsm00003@;
          |FINSI;
     |FINSI;
     |CIERRA #41;
|FPRC;

|DEFBUCLE agifa200;
     #200#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, agifa200;
|FIN;

|PROCESO ParamGen;
     |DDEF aDef;
     aDef = aDef + "agifa142";
     |CARGA_DEF aDef, agifa142@;
     |SI FSalida = 0;
          |ABRE #agifa142@;
          |LEE 000#agifa142@.p;
          |CIERRA #agifa142@;
          aCopia = #142#28;
          |DESCARGA_DEF #agifa142@;
     |FINSI;
|FPRC;

|PROCESO DirEnt16; |TIPO 16;
     |HAZ ParamGen;
     |SI aCopia = "N"; |ACABA; |FINSI;

     |DDEF aDef;
     aDef = aDef + "agifa041";
     |CARGA_DEF aDef, agifa041@;
     |SI FSalida = 0;
          nBaja = 0;
          |DFICE aEmp;
          aEmp = aEmp % -205;
          |BUCLE agifa200;
          |DESCARGA_DEF #agifa041@;
     |FINSI;
|FPRC;

|PROCESO DirEnt17; |TIPO 17;
     |HAZ ParamGen;
     |SI aCopia = "N"; |ACABA; |FINSI;

     |DDEF aDef;
     aDef = aDef + "agifa041";
     |CARGA_DEF aDef, agifa041@;
     |SI FSalida = 0;
          nBaja = 1;
          |BUCLE agifa200;
          |DESCARGA_DEF #agifa041@;
     |FINSI;
|FPRC;

|PROCESO BaezaAlbMod;
     |DDEF aDef;
     aDef = aDef + "baezam01";
     |CARGA_DEF aDef, baezam01@;
     |SI FSalida = 0;
          |ABRE #baezam01@;
          #baezam01@#0 = #10#52;
          #baezam01@#1 = #10#0;
          |LEE 000#baezam01@.=;
          |SI FSalida = 0;
               #baezam01@#39 = #10#38; || Facturado
               #baezam01@#40 = #10#90; || Alb Impreso
               #baezam01@#41 = #10#53; || Serie Factu
               #baezam01@#42 = #10#39; || Numer Factu
               #baezam01@#43 = #10#10; || Factura Imp
               |GRABA 020#baezam01@.a;
          |FINSI;
          |CIERRA #baezam01@;
          |DESCARGA_DEF #baezam01@;
     |FINSI;
|FPRC;

|PROCESO RodacalCopDir;
     |SI eaRodExporta = "S"; |ACABA; |FINSI; || lo activa rodw0004

     |DBASE aPath;
     aPath = aPath + "/def/rodm0001.mas";
     |XABRE "E", aPath, 0;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |DDEF aDef;
     aDef = aDef + "rodm0005";
     |CARGA_DEF aDef, rodm0005@;
     |SI FSalida ! 0;
          |MENAV "0000ERROR al cargar 'rodm0005'";
     |SINO;
          |ABRE #rodm0005@;
          |LEE 000#rodm0005@.u;
          |SI FSalida = 0; nReg = #rodm0005@#0 + 1; |SINO; nReg = 1; |FINSI;
          |DDEFECTO #rodm0005@;
          #rodm0005@#0 = nReg;
          aAlfa = #3#0 + "|" + #3#1;
          #rodm0005@#1 = aAlfa;
          #rodm0005@#2 = "dsm00003";
          |SI nTipo = 15; #rodm0005@#3 = "A"; |FINSI;
          |SI nTipo = 16; #rodm0005@#3 = "M"; |FINSI;
          |SI nTipo = 17; #rodm0005@#3 = "B"; |FINSI;
          |SELECT #3#rodm0005@;
          |LEE 101#rodm0005@.=;
          |SI FSalida ! 0; |GRABA 020#rodm0005@.b; |FINSI;
          aAlfa = Usuario % 810;
          #rodm0005@#4 = aAlfa;
          #rodm0005@#5 = ~;
          |HORA aAlfa;
          #rodm0005@#6 = aAlfa;
          |GRABA 020#rodm0005@.a;
          |CIERRA #rodm0005@;
          |DESCARGA_DEF #rodm0005@;
     |FINSI;
     FSalida = 0;
|FPRC;

|PROCESO Log010;
     |DDEF aAlfa;
     aAlfa = aAlfa + "dsm00087";
     |CARGA_DEF aAlfa, dsm00087@;
     |SI FSalida ! 0; |ACABA; |FINSI;

     aSer = #10#52;
     aNum = ("000000" + #10#0) % -106;
     aTipo = "AV";

     |ABRE #dsm00087@;
     |DDEFECTO #dsm00087@;
     |SELECT #2#dsm00087@;
     #dsm00087@#1 = aSer;
     #dsm00087@#2 = aNum;
     #dsm00087@#3 = aTipo;
     |LEE 101#dsm00087@.=;
     |SI FSalida ! 0;
          |SELECT #1#dsm00087@;
          |LEE 000#dsm00087@.u;
          |SI FSalida = 0;
               nContaLog = #dsm00087@#0 + 1;
          |SINO;
               nContaLog = 1;
          |FINSI;
          |DDEFECTO #dsm00087@;
          #dsm00087@#0 = nContaLog;
          #dsm00087@#1 = aSer;
          #dsm00087@#2 = aNum;
          #dsm00087@#3 = aTipo;
          |GRABA 020#dsm00087@.b;
     |FINSI;
     |SI FSalida = 0;
          |HORA aAlfa;
          aUsu = Usuario % 810;
          |SI nTipo = 15;
               #dsm00087@#4 = aUsu;
               #dsm00087@#5 = ~;
               #dsm00087@#6 = aAlfa;
               #dsm00087@#7 = "";
               #dsm00087@#8 = "01.01.0000";
               #dsm00087@#9 = ""
               #dsm00087@#10 = "";
               #dsm00087@#11 = "01.01.0000";
               #dsm00087@#12 = ""
          |FINSI;
          |SI nTipo = 16;
               #dsm00087@#7 = aUsu;
               #dsm00087@#8 = ~;
               #dsm00087@#9 = aAlfa;
          |FINSI;
          |SI nTipo = 17;
               #dsm00087@#10 = aUsu;
               #dsm00087@#11 = ~;
               #dsm00087@#12 = aAlfa;
          |FINSI;
          |GRABA 020#dsm00087@.a;
     |FINSI;
     |CIERRA #dsm00087@;
     |DESCARGA_DEF #dsm00087@;
|FPRC;

|PROCESO &T084_15; |TIPO 15;
     nTipo = 15; |HAZ Log084;
|FPRC;

|PROCESO &T084_16; |TIPO 16;
     nTipo = 16; |HAZ Log084;
|FPRC;

|PROCESO &T084_17; |TIPO 17;
     nTipo = 17; |HAZ Log084;
|FPRC;

|PROCESO Log084;
     |DDEF aAlfa;
     aAlfa = aAlfa + "dsm00087";
     |CARGA_DEF aAlfa, dsm00087@;
     |SI FSalida ! 0; |ACABA; |FINSI;

     aSer = #84#48;
     aNum = ("000000" + #84#0) % -106;
     aTipo = "FD";

     |ABRE #dsm00087@;
     |DDEFECTO #dsm00087@;
     |SELECT #2#dsm00087@;
     #dsm00087@#1 = aSer;
     #dsm00087@#2 = aNum;
     #dsm00087@#3 = aTipo;
     |LEE 101#dsm00087@.=;
     |SI FSalida ! 0;
          |SELECT #1#dsm00087@;
          |LEE 000#dsm00087@.u;
          |SI FSalida = 0;
               nContaLog = #dsm00087@#0 + 1;
          |SINO;
               nContaLog = 1;
          |FINSI;
          |DDEFECTO #dsm00087@;
          #dsm00087@#0 = nContaLog;
          #dsm00087@#1 = aSer;
          #dsm00087@#2 = aNum;
          #dsm00087@#3 = aTipo;
          |GRABA 020#dsm00087@.b;
     |FINSI;
     |SI FSalida = 0;
          |HORA aAlfa;
          aUsu = Usuario % 810;
          |SI nTipo = 15;
               #dsm00087@#4 = aUsu;
               #dsm00087@#5 = ~;
               #dsm00087@#6 = aAlfa;
               #dsm00087@#7 = "";
               #dsm00087@#8 = "01.01.0000";
               #dsm00087@#9 = ""
               #dsm00087@#10 = "";
               #dsm00087@#11 = "01.01.0000";
               #dsm00087@#12 = ""
          |FINSI;
          |SI nTipo = 16;
               #dsm00087@#7 = aUsu;
               #dsm00087@#8 = ~;
               #dsm00087@#9 = aAlfa;
          |FINSI;
          |SI nTipo = 17;
               #dsm00087@#10 = aUsu;
               #dsm00087@#11 = ~;
               #dsm00087@#12 = aAlfa;
          |FINSI;
          |GRABA 020#dsm00087@.a;
     |FINSI;
     |CIERRA #dsm00087@;
     |DESCARGA_DEF #dsm00087@;
|FPRC;
-----------------------------
|PROCESO &Tipo048_15; |TIPO 15;
     |SI enEstaDentro = 1; |ACABA; |FINSI;
     enEstaDentro = 1;

     nTipo = 15;

     |HAZ Es_Berria;
     |SI FSalida = 0; |HAZ BerriaEsCaMod; |FINSI;

     enEstaDentro = 0;
|FPRC;

|PROCESO &Tipo048_16; |TIPO 16;
     |SI enEstaDentro = 1; |ACABA; |FINSI;
     enEstaDentro = 1;

     nTipo = 16;

     |HAZ Es_Berria;
     |SI FSalida = 0; |HAZ BerriaEsCaMod; |FINSI;

     enEstaDentro = 0;
|FPRC;

|PROCESO &Tipo048_17; |TIPO 17;
     |SI enEstaDentro = 1; |ACABA; |FINSI;
     enEstaDentro = 1;

     nTipo = 17;

     |HAZ Es_Berria;
     |SI FSalida = 0; |HAZ BerriaEsCaMod; |FINSI;

     enEstaDentro = 0;
|FPRC;

|PROCESO &Tipo049_15; |TIPO 15;
     |SI enEstaDentro = 1; |ACABA; |FINSI;
     enEstaDentro = 1;

     nTipo = 15;

     |HAZ Es_Berria;
     |SI FSalida = 0; |HAZ BerriaEsLiMod; |FINSI;

     |HAZ Es_Coimasa;
     |SI FSalida = 0; |HAZ CoimaEsLiMod; |FINSI;

     enEstaDentro = 0;
|FPRC;

|PROCESO &Tipo049_16; |TIPO 16;
     |SI enEstaDentro = 1; |ACABA; |FINSI;
     enEstaDentro = 1;

     nTipo = 16;

     |HAZ Es_Berria;
     |SI FSalida = 0; |HAZ BerriaEsLiMod; |FINSI;

     |HAZ Es_Coimasa;
     |SI FSalida = 0; |HAZ CoimaEsLiMod; |FINSI;

     enEstaDentro = 0;
|FPRC;

|PROCESO &Tipo049_17; |TIPO 17;
     |SI enEstaDentro = 1; |ACABA; |FINSI;
     enEstaDentro = 1;

     nTipo = 17;

     |HAZ Es_Berria;
     |SI FSalida = 0; |HAZ BerriaEsLiMod; |FINSI;

     |HAZ Es_Coimasa;
     |SI FSalida = 0; |HAZ CoimaEsLiMod; |FINSI;

     enEstaDentro = 0;
|FPRC;

|PROCESO BerriaEsLiMod;
     |DDEF aAlfa;
     aAlfa = aAlfa + "berm0002";
     |CARGA_DEF aAlfa, berm0002@;
     |SI FSalida ! 0;
          |MENAV "0000Error al cargar 'berm0002'";
     |SINO;
          |ABRE #102;
          #102#0 = #149#0;
          #102#1 = #149#1;
          |SI nTipo = 17;
               |BORRA 000#102c;
          |SINO;
               |LEE 101#102=;
               |SI FSalida ! 0; |GRABA 020#102b; |FINSI;
               |PARA i = 0; |SI i [ 21; |HACIENDO i = i + 1;
                    #102i = #149i;
               |SIGUE;
               |GRABA 020#102a;
          |FINSI;
          |CIERRA #102;
          |DESCARGA_DEF #berm0002@;
     |FINSI;
|FPRC;

|PROCESO BerriaEsCaMod;
     |DDEF aAlfa;
     aAlfa = aAlfa + "berm0001";
     |CARGA_DEF aAlfa, berm0001@;
     |SI FSalida ! 0;
          |MENAV "0000Error al cargar 'berm0001'";
     |SINO;
          |ABRE #101;
          #101#0 = #148#0;
          |SI nTipo = 17;
               |BORRA 000#101c;
          |SINO;
               |LEE 101#101=;
               |SI FSalida ! 0; |GRABA 020#101b; |FINSI;
               |PARA i = 0; |SI i [ 36; |HACIENDO i = i + 1;
                    #101i = #148i;
               |SIGUE;
               |GRABA 020#101a;
          |FINSI;
          |CIERRA #101;
          |DESCARGA_DEF #berm0001@;
     |FINSI;
|FPRC;

|PROCESO CoimaEsLiMod;
     |DDEF aAlfa;
     aAlfa = aAlfa + "coima051";
     |CARGA_DEF aAlfa, coima051@;
     |SI FSalida ! 0;
          |MENAV "0000Error al cargar 'coima051'";
     |SINO;
          |ABRE #202;
          #202#0 = #149#0;
          #202#1 = #149#1;
          |SI nTipo = 17;
               |BORRA 000#202c;
          |SINO;
               |LEE 101#202=;
               |SI FSalida ! 0; |GRABA 020#202b; |FINSI;
               |PARA i = 0; |SI i [ 21; |HACIENDO i = i + 1;
                    #202i = #149i;
               |SIGUE;
               |GRABA 020#202a;
          |FINSI;
          |CIERRA #202;
          |DESCARGA_DEF #coima051@;
     |FINSI;
|FPRC;

|PROCESO JamaBajaAlb;
     |DDEF aAlfa;
     aAlfa = aAlfa + "cafe0001.mas";
     |XABRE "E", aAlfa, 0;
     |SI FSalida ] 0;
          aAlfa = "cafe0026;ALBABOR" + #10#52 + (("000000" + #10#0) % -106);
          |SUB_EJECUTA_NP aAlfa;
     |FINSI;
|FPRC;

|PROCESO GesiBajaAlb;
     |DDEF aAlfa;
     aAlfa = aAlfa + "gesim001.mas";
     |XABRE "E", aAlfa, 0;
     |SI FSalida ] 0;
          aAlfa = "cafe0026;GESIBOR" + #10#52 + (("000000" + #10#0) % -106);
          |SUB_EJECUTA_NP aAlfa;
     |FINSI;
|FPRC;

|PROCESO cong0002Alb;
     aAlfa = aSerNum + (("000000" + #10#0) % -106);
     #referen@#3 = aAlfa;
     #referen@#6 = #10#1;
     #referen@#9 = #24#2;
     #referen@#10 = #24#1;
     #referen@#11 = #24#15;
     #referen@#12 = #24#8;
     #referen@#13 = #24#9;
     #referen@#14 = #24#10;
     #referen@#15 = #24#183;
     #referen@#16 = #24#17;
     #referen@#17 = #24#18;
     #referen@#19 = #24#159;
     aAlfa = ("000000" + #10#0) % -106;
     #referen@#21 = aAlfa;
     aAlfa = #referen@#32; |QBF aAlfa; || Observa
     |SI aAlfa = "";
          #referen@#32 = #10#97;
     |FINSI;
     |GRABA 020#referen@.a;
|FPRC;

|DEFBUCLE cong0002Alb;
     #referen@#3003;
     ;
     #10#52, #10#0, 001;
     #10#52, #10#0, 999;
     be;
     NULL, cong0002Alb;
|FIN;

|PROCESO CongeAdjPed;
     |SELECT #3#referen@;
     #referen@#14 = #71#31;
     #referen@#15 = #71#12;
     #referen@#16 = #71#21;
     |LEE 101#referen@.=;
     |SI FSalida = 0;
          |SI aTipo = "M";
               #referen@#6 = #10#1;
               #referen@#8 = #71#5;
               #referen@#11 = "";
          |SINO;
               |ABRE #73;
               #73#28 = #71#31;
               #73#12 = #71#12;
               #73#21 = #71#21;
               |LEE 000#73=;
               |CIERRA #73;

               |DFICE aAlfa; aAlfa = aAlfa % -205;
               |ABRE #235;
               #235#0 = aAlfa;
               #235#1 = #71#29;
               #235#2 = #71#0;
               #235#3 = #71#1;
               |LEE 000#235=;
               |SI FSalida ! 0; |DDEFECTO #235; |FINSI;
               |CIERRA #235;

               nNume = #73#42 + #73#12;
               |SI #73#5 = 0; |Y nNume = 0;
                    aAlfa = eaCongeCarVar;
                    #referen@#6 = aAlfa;
                    #referen@#10 = "S";
                    #referen@#11 = #235#12;
               |SINO;
                    #referen@#6 = "01.01.0000";
                    #referen@#11 = "";
               |FINSI;
          |FINSI;
          |GRABA 020#referen@.a;
     |FINSI;
|FPRC;

|PROCESO CongeCopiaAlb;
     |SI #71#12 = 0; |Y aDocu = "agifa071";
          |ACABA;   || Sin pedido
     |FINSI;

     |SI aDocu = "agifa071";
          |ABRE #24;
          #24#0 = #71#15;
          |LEE 000#24=;
          |SI FSalida ! 0; |DDEFECTO #24; |FINSI;
          |CIERRA #24;
     |SINO;
          |ABRE #24;
          #24#0 = #10#3;
          |LEE 000#24=;
          |SI FSalida ! 0; |DDEFECTO #24; |FINSI;
          |CIERRA #24;
     |FINSI;
     |SI #24#111 = "N"; |ACABA; |FINSI;

     |DDEF aPath;
     aAlfa = aPath + "cong0001.mas";
     |XABRE "E", aAlfa, 0;
     |SI FSalida ! 0; |ACABA; |FINSI;

     nDistribuidor = -1;
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@; |LEE 000#referen@.p; |CIERRA #referen@;
          |SI aDocu = "agifa010";
               nDistribuidor = #referen@#1;
          |SINO;
               |PARA i = 2; |SI i [ 11; |HACIENDO i = i + 1;
                    |SI #71#13 = #referen@#i#;
                         nDistribuidor = #referen@#1; |SAL;
                    |FINSI;
               |SIGUE;
          |FINSI;
          |DESCARGA_DEF #referen@;
     |FINSI;
     |SI nDistribuidor ] 0;
          aAlfa = aPath + "cong0006";
          |CARGA_DEF aAlfa, referen@;
          |SI FSalida = 0;
               |ABRE #referen@;
               #referen@#0 = #10#52;
               |LEE 000#referen@.=;
               |SI FSalida = 0;
                    aSerNum = ("00000" + #referen@#1) % -105;
               |SINO;
                    aSerNum = "00000";
               |FINSI;
               |CIERRA #referen@;
               |DESCARGA_DEF #referen@;
          |FINSI;

          aAlfa = aPath + "cong0002";
          |CARGA_DEF aAlfa, referen@;
          |SI FSalida = 0;
               |SI aDocu = "agifa010";
                    |BUCLE cong0002Alb;
               |FINSI;
               |SI aDocu = "agifa071";
                    |ABRE #19;
                    #19#0 = #71#2;
                    |LEE 000#19=;
                    |SI FSalida ! 0; |DDEFECTO #19; |FINSI;
                    |CIERRA #19;

                    |ABRE #referen@; |SELECT #2#referen@;
                    #referen@#38 = #71#31;
                    #referen@#39 = #71#12;
                    #referen@#40 = #71#21;
                    |LEE 101#referen@.=;
                    |SI aTipo = "B";
                         |SI FSalida = 0;
                              |HAZ CheqBorraNueva;
                              |SI FSalida ! 0;
                                   |ABRE #73;
                                   #73#28 = #71#31;
                                   #73#12 = #71#12;
                                   #73#21 = #71#21;
                                   |LEE 000#73=;
                                   |SI FSalida = 0;
                                        #referen@#24 = #73#5;
                                        #referen@#27 = #73#45;
                                        #referen@#28 = #73#7;
                                        #referen@#29 = #73#9;
                                   |FINSI;
                                   |CIERRA #73;
                                   #referen@#3 = 0;
                                   #referen@#6 = "01.01.0000";
                                   #referen@#21 = 0;
                                   #referen@#41 = "";
                                   #referen@#42 = 0;
                                   #referen@#43 = 0;
                                   |GRABA 020#referen@.a;
                              |FINSI;
                         |FINSI;
                    |SINO;
                         |SI FSalida = 0;
                              |SI aTipo = "M";
                                   |SELECT #3#referen@;
                                   #referen@#41 = #71#29;
                                   #referen@#42 = #71#0;
                                   #referen@#43 = #71#1;
                                   |LEE 101#referen@.=;
                              |SINO;
                                   |HAZ CheqCreaNueva;
                              |FINSI;
                              |SI FSalida = 0;
                                   #referen@#0 = nDistribuidor;
                                   #referen@#22 = #19#134;
                                   #referen@#23 = "S";
                                   #referen@#24 = #71#5;
                                   #referen@#25 = #19#5;
                                   |SI #71#6 = 0;
                                        #referen@#26 = "S";
                                   |SINO;
                                        #referen@#26 = "N";
                                   |FINSI;
                                   #referen@#27 = #71#49;
                                   #referen@#28 = #71#7;
                                   #referen@#29 = #71#9;
                                   #referen@#30 = "EUR";
                                   #referen@#31 = #19#112;

                                   #referen@#41 = #71#29;
                                   #referen@#42 = #71#0;
                                   #referen@#43 = #71#1;
                                   |GRABA 020#referen@.a;
                              |FINSI;
                         |FINSI;
                    |FINSI;
               |FINSI;
               |CIERRA #referen@;
               |DESCARGA_DEF #referen@;
          |FINSI;
     |FINSI;

     |SI aDocu = "agifa010"; |Y aTipo = "M";
          aAlfa = aPath + "cong0004";
          |CARGA_DEF aAlfa, referen@;
          |SI FSalida = 0;
               |ABRE #referen@;
               |BUCLELIN 2 CongeAdjPed #10;
               |CIERRA #referen@;
               |DESCARGA_DEF #referen@;
          |FINSI;
     |FINSI;
     |SI aDocu = "agifa071"; |Y aTipo = "B";
          aAlfa = aPath + "cong0004";
          |CARGA_DEF aAlfa, referen@;
          |SI FSalida = 0;
               |ABRE #referen@;
               |HAZ CongeAdjPed;
               |CIERRA #referen@;
               |DESCARGA_DEF #referen@;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO CheqBorraNueva;
     |SELECT #3#referen@;
     #referen@#41 = #71#29;
     #referen@#42 = #71#0;
     #referen@#43 = #71#1;
     |LEE 101#referen@.=;
     |SI FSalida = 0; |Y #referen@#48 = "S";
          |BORRA 020#referen@.a;
     |SINO;
          FSalida = "1";
     |FINSI;
|FPRC;

|PROCESO CheqCreaNueva;
     |SI #referen@#42 ! 0; || Tiene numero albaran y es otro linea/albaran
          |SELECT #3#referen@;
          #referen@#41 = #71#29;
          #referen@#42 = #71#0;
          #referen@#43 = #71#1;
          |LEE 101#referen@.=;
          |SI FSalida ! 0;
               |SALVA_DATOS #referen@;
               |SELECT #1#referen@;
               |LEE 000#referen@.u;
               nNume = #referen@#47 + 1;
               |REPON_DATOS #referen@;
               #referen@#47 = nNume;
               #referen@#48 = "S";
               |GRABA 020#referen@.b;
          |FINSI;
     |FINSI;
|FPRC;
