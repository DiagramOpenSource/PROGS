|FICHEROS;
     pcegz042 #0;
     pcegz043 #1; || = pcegm030
     dsm00003 #3;
     pcegm004 #4;
     pcegm005 #5;
     pcegm006 #6;
     pcegm007 #7;
     agifa019 #19;
     agifa024 #24,MANTE;
     agifa025 #25;
     pcegm028 #28;
     pcegm029 #29;
     pcegm031 #31;
     pcegm032 #32;
     agifa066 #66;||*
     pcegm001 #101;
     agifm006 #106;
     agifa142 #142;
     dsm00225 #225;
     agifa321 #321;
     agifa324 #324;
     dsm00113;
     agifm001 #201;
     agifm002 #202;
|FIN;

|VARIABLES;
     &enForma = 0;
     &eaTag = "";
     &nImpo = 0;
     &aDivisa = "";
     &aMoneda = "";
     &enSwMenu = 0;
     &Tempo = "";
     &eaSerie = "";
     &enPedido = 0;
     &efFecha = @;
     aTmp0 = "";
     aAlfa = "";
     aEsp = "";
     aDir = "";
     nCod = 0;
     nSwAuto = 0;
     nError = 0;
     nTotal = 0;
     nDirFac = 0;
     nDirEnv = 0;
     nDir = 0;
     nSal = 0;
     i = 0;
     fFecha = @;
     nIVA = 0;
     nLin = 0;
     nCalc = 0;
     nHay = 0;
     aCif = "";
     aCli = "";
     nPos = 0;
|FIN;
/*
|PROCESO CalcConIva;
     |ABRE #dsm00113;
     #dsm00113#0 = #pcegm004#4;
     #dsm00113#1 = #pcegm005#14;
     |LEE 000#dsm00113.=;
     |SI FSalida = 0;
        nCalc = #pcegm005#11 % #dsm00113#3;
        |SI #agifa024#47 = "S";
           nCalc = nCalc + (#pcegm005#11 % #dsm00113#4);
        |FINSI;
     |SINO;
        enTiva = #pcegm005#14;
        efFiva = #pcegm004#1;
        |HAZ SacaIVA;

        nCalc = #pcegm005#11 % enIva;
        |SI #agifa024#47 = "S";
              nCalc = nCalc + (#pcegm005#11 % enRec);
        |FINSI;
     |FINSI;
     |CIERRA #dsm00113;

     nImpo = nImpo + (#pcegm005#11 + nCalc);
|FPRC;

|DEFBUCLE CalcConIva;
     #pcegm005#1;
     ;
     #pcegm004#25, #pcegm004#0,001;
     #pcegm004#25, #pcegm004#0,999;
     ;
     NULL,CalcConIva;
|FIN;
*/

|PROCESO BuscaIVA;
     |SI #66#2 = #1#7;
          nIVA = #66#0;
     |FINSI;
|FPRC;

|DEFBUCLE BuscaIVA;
     #66#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, BuscaIVA;
|FIN;

|PROCESO LinPed;
     |DDEFECTO #19;
     |ABRE #19;
     #19#0 = #1#2;
     |LEE 000#19=;
     |CIERRA #19;

     nIVA = 0;
     |BUCLE BuscaIVA;

     nLin = nLin + 1;
     |DDEFECTO #5;
     #5#28 = #4#25;
     #5#0 = #4#0;
     #5#1 = nLin;
     #5#2 = #19#0;
     #5#3 = 1;
     #5#4 = #1#3;
     #5#5 = #1#8;
     #5#6 = #1#4;
     #5#14 = nIVA;
     #5#16 = #4#7;
     #5#17 = #4#16;
     #5#18 = #19#2;
     #5#19 = #4#18;
     #5#20 = #4#4;
     #5#26 = #4#9;
     #5#38 = #5#6;
     #5#42 = #5#5;
     enForma = 1;
     |HAZ TotalLin004;
     |HAZ AcumulaPV_PCEG;
     |GRABA 000#5n;

     |SI nLin = 1;
          #4#82 = nIVA;  || IVA Portes de la cabecera
          |GRABA 020#4a;
     |FINSI;
|FPRC;

|PROCESO CalcuZona; |TIPO 0;
     |ABRE #7;
     #7#0 = #4#74;
     #7#1 = #4#59;
     |LEE 000#7=;
     |SI FSalida = 0;
          #4#75 = #7#2;
     |SINO;
          aAlfa = #4#59 % 102;
          #7#1 = aAlfa;
          |LEE 000#7=;
          |SI FSalida = 0;
               #4#75 = #7#2;
          |SINO;
               #7#1 = "";
               |LEE 000#7=;
               |SI FSalida = 0;
                    #4#75 = #7#2;
               |FINSI;
          |FINSI;
     |FINSI;
     |CIERRA #7;
|FPRC;

|PROCESO Notas;
     |ABRE #6;
     #6#0 = #4#25;
     #6#1 = #4#0;
     #6#2 = 1;
     #6#3 = "";
     |GRABA 020#6n;
     #6#2 = 2;
     #6#3 = "";
     |GRABA 020#6n;
     #6#2 = 3;
     #6#3 = #29#7;
     |GRABA 020#6n;
     #6#2 = 4;
     #6#3 = #29#35;
     |GRABA 020#6n;
     #6#2 = 5;
     #6#3 = #29#36;
     |GRABA 020#6n;
     #6#2 = 6;
     #6#3 = #29#37;
     |GRABA 020#6n;
     #6#2 = 7;
     #6#3 = #29#38;
     |GRABA 020#6n;
|FPRC;

|PROCESO PonDirEnv;
     |DDEFECTO #3;
     |ABRE #3;
     #3#0 = #0#37;
     #3#1 = #0#44;
     |LEE 000#3=;
     |CIERRA #3;

     #4#19 = #3#10;
     #4#14 = #3#2;
     #4#20 = #3#3;
     #4#21 = #3#7;
     #4#69 = #3#22;
     #4#13 = #3#22;
     #4#59 = #3#23;
     #4#72 = #3#21;
     #4#71 = #3#24;
     #4#77 = #3#13;
     #4#73 = #3#22;
     #4#74 = #3#19;
     #4#75 = #3#11;
     #4#92 = #3#25;
     #4#93 = #3#26;
|FPRC;

|PROCESO CabPed;
     |DDEFECTO #24;
     |ABRE #24;
     #24#0 = #0#37;
     |LEE 020#24=;
     |CIERRA #24;

     |DDEFECTO #3;
     |ABRE #3;
     #3#0 = #0#37;
     #3#1 = #0#35;
     |LEE 000#3=;
     |CIERRA #3;

     |DDEFECTO #101;
     |ABRE #101;
     #101#0 = #24#205;
     |LEE 000#101=;
     |SI FSalida ! 0;
          aAlfa = "0000No existe el Pais:" + #101#0 + " en el fichero de series facturacion por paises";
          |MENAV aAlfa;
          nError = 1; |ACABA;
     |FINSI;
     |CIERRA #101;

     |DDEFECTO #31;
     |ABRE #31;
     #31#0 = #29#8;
     |LEE 000#31=;
     |CIERRA #31;

     |DDEFECTO #32;
     |ABRE #32;
     #32#0 = #29#39;
     |LEE 000#32=;
     |CIERRA #32;

     |DDEFECTO #25;
     |ABRE #25;
     #25#0 = #24#25;
     |LEE 000#25=;
     |CIERRA #25;

     fFecha = ~;
     aAlfa = fFecha % -102;
     #4#25 = #101#1 + aAlfa;
     enSwMenu = 1;
     |HAZ ContaPe7;
     |GRABA 000#4b;
     |SI FSalida ! 0;
          |SI nSwAuto = 0; |MENAV "0000ERROR al crear el pedido..."; |FINSI;
          nError = 1;
     |SINO;
          nError = 0;

          |ABRE #324;
          #4#3 = #0#0;
          #4#4 = #3#0;
          #4#57 = #3#1;
          |DEFECTO #4#24;
          |SI #29#8 = #28#10; |O #29#8 = #28#11;
               #4#70 = "C";
          |SINO;
               #4#70 = "P";
          |FINSI;
          #4#7 = #25#0;
          #4#8 = #24#2;
          #4#9 = #31#1;
          #4#14 = #29#22;
          #4#16 = #25#7;
          #4#18 = #24#4;
          #4#19 = #29#21;
          #4#20 = #29#23;
          #4#21 = #29#25;
          #4#23 = #24#41;
          #4#35 = #24#192;

          #324#0 = #4#35;
          |LEE 000#324=;
          #4#36 = #324#2;

          #4#37 = #24#193;
          #4#40 = #321#9;

          #324#0 = #4#40;
          |LEE 000#324=;
          #4#41 = #324#2;

          #4#59 = #29#24;
          |HAZ CalcuZona;

          #4#60 = #32#1;
          #4#61 = "P";
          |SI nSwAuto = 1;
               #4#66 = #4#1;
          |FINSI;
          #4#67 = #29#9;
          #4#69 = #24#36;
          #4#71 = #29#4;
          #4#72 = #29#6;
          #4#73 = #29#20;
          #4#74 = #29#26;
          #4#77 = #29#5;
          #4#75 = #3#11;
          #4#83 = Usuario % 810;
          aDivisa = #4#35;
          aMoneda = #4#37;
          |HAZ Divisas104;
          |HAZ PonDirEnv;
          |GRABA 020#4a;

          |CIERRA #324;

          |HAZ Notas;
     |FINSI;
|FPRC;

|DEFBUCLE LinPed;
     #1#1;
     ;
     #29#0, 001;
     #29#0, 999;
     ;
     NULL, LinPed;
|FIN;

|PROCESO PasaPedido;
     nError = 1;

     |ABRE #321; |LEE 000#321p; |CIERRA #321;
     |ABRE #142; |LEE 000#142p; |CIERRA #142;

     |ABRE #4;
     |ABRE #5;
     |ABRE #29;
     #29#0 = #0#0;
     |LEE 101#29=;
     |SI FSalida = 0;
          |SI #29#27 ! " ";
               |SI nSwAuto = 0;
                    |SI #29#27 = "T";
                         aAlfa = "0000Pedido traspado por el usuario:" + #29#32;
                         |MENAV aAlfa;
                    |FINSI;
                    |SI #29#27 = "R";
                         aAlfa = "0000Pedido trechazado por el usuario:" + #29#34;
                         |MENAV aAlfa;
                    |FINSI;
               |FINSI;
               |ACABA;
          |FINSI;

          |HAZ CabPed;
          |SI nError = 0;
               nLin = 0;
               |BUCLE LinPed;
               |HAZ CalCabpcegm004;
             ||  nImpo = 0; |BUCLE CalcConIva;
               nImpo = #4#11;
               enForma = 1;
               eaTag = "PE";  |HAZ RiesgosPCEG;
          |FINSI;
          |SI nError = 0;
               #29#28 = #4#25;
               #29#29 = #4#0;
               #29#30 = #0#37;
               #29#31 = #0#35;
               #29#32 = Usuario % 810;
               #29#27 = "T";
               #29#42 = #4#11;
               |GRABA 020#29a;

               #0#28 = #4#25;
               #0#29 = #4#0;
               #0#30 = #0#37;
               #0#31 = #0#35;
               #0#32 = Usuario % 810;
               #0#27 = "T";

               |SI nSwAuto = 0;
                    aAlfa = "2"+#4#25+(("000000"+#4#0)%-106)+#4#4+(("000"+#4#57)%-103);
                    aAlfa = "pcegz008;" + aAlfa;
                    |SUB_EJECUTA_NP aAlfa;
               |FINSI;

               |SI #4#70 = "C";
                    eaSerie = #4#25;
                    enPedido = #4#0;
                    efFecha = #4#66;
                    |SUB_EJECUTA_NP "pcegz018";
               |FINSI;
          |FINSI;
          |LIBERA #29;
     |FINSI;
     |CIERRA #29;
     |CIERRA #5;
     |CIERRA #4;
|FPRC;

|DEFBUCLE PasaPedido;
     #0#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, PasaPedido;
|FIN;

|PROCESO DatosDirFac;
     #3#0 = aCli;
     #3#1 = 9999;
     |LEE 000#3];
     |SI FSalida = 0;
          |LEE 000#3a;
     |SINO;
          |LEE 000#3u;
     |FINSI;
     |SI FSalida = 0; |Y #3#0 = aCli;
          nDir = #3#1 + 1;
     |SINO;
          nDir = 1;
     |FINSI;

     |DDEFECTO #225;
     #225#0 = #29#19;
     |LEE 000#225=;

     |DDEFECTO #3;
     #3#0 = aCli;
     #3#1 = nDir;
     #3#10 = #29#12;
     #3#2 = #29#15;
     #3#3 = #29#16;

     #3#6 = #29#17;
     aAlfa = #3#6 % 102;
     #3#4 = aAlfa;
     aAlfa = #3#6 % 103;
     #3#5 = aAlfa;

     aAlfa = #29#19; |QBF aAlfa;
     aEsp = #28#9; |QBF aEsp;
     |SI aAlfa ! aEsp;
          #3#6 = "99999";
          #3#4 = "99";
          #3#5 = "999";
     |FINSI;

     #3#7 = #29#18;
     #3#23 = #29#17;
     #3#13 = #29#5;
     #3#21 = #29#6;
     #3#19 = #225#0;
     #3#8 = #225#1;
     #3#14 = "00";
     #3#22 = #29#11;
     #3#24 = #29#4;
|FPRC;

|PROCESO DatosDirEnv;
     #3#0 = aCli;
     #3#1 = 9999;
     |LEE 000#3];
     |SI FSalida = 0;
          |LEE 000#3a;
     |SINO;
          |LEE 000#3u;
     |FINSI;
     |SI FSalida = 0; |Y #3#0 = aCli;
          nDir = #3#1 + 1;
     |SINO;
          nDir = 1;
     |FINSI;

     |DDEFECTO #225;
     #225#0 = #29#19;
     |LEE 000#225=;

     |DDEFECTO #3;
     #3#0 = aCli;
     #3#1 = nDir;
     #3#10 = #29#21;
     #3#2 = #29#22;
     #3#3 = #29#23;

     #3#6 = #29#24;
     aAlfa = #3#6 % 102;
     #3#4 = aAlfa;
     aAlfa = #3#6 % 103;
     #3#5 = aAlfa;

     aAlfa = #29#26; |QBF aAlfa;
     aEsp = #28#9; |QBF aEsp;
     |SI aAlfa ! aEsp;
          #3#6 = "99999";
          #3#4 = "99";
          #3#5 = "999";
     |FINSI;

     #3#7 = #29#25;
     #3#23 = #29#24;
     #3#13 = #29#5;
     #3#21 = #29#6;
     #3#19 = #225#0;
     #3#8 = #225#1;
     #3#14 = "00";
     #3#22 = #29#20;
     #3#24 = #29#4;
|FPRC;

|PROCESO DatosCli;
     |SELECT #1#24;
     |LEE 000#24u;
     |SI FSalida = 0;
          nCod = #24#0;
     |SINO;
          nCod = 0;
     |FINSI;
     |PARA; |SI; |HACIENDO;
          nCod = nCod + 1;
          #24#0 = ("000000" + nCod) % -106;
          |LEE 000#24=;
          |SI FSalida ! 0; |SAL; |FINSI;
     |SIGUE;

     |DDEFECTO #31;
     #31#0 = #29#8;
     |LEE 000#31=;

     |DDEFECTO #225;
     #225#0 = #29#19;
     |LEE 000#225=;

     |DDEFECTO #24;
     #24#0 = ("000000" + nCod) % -106;
     #24#17 = #29#5;     || Tlf
     #24#18 = #29#6;     || Fax
     #24#20 = #31#1;     || F.Pago
     #24#197 = #29#4;    || Mail
     #24#36 = #29#11;    || P.Contacto
     #24#1 = #29#12;     || N.Fiscal
     #24#2 = #29#12;     || N.Comer
     aAlfa = #29#13; |QBF aAlfa;
     |SI aAlfa = "";
          #24#15 = #29#14;    || CIF
     |SINO;
          #24#15 = #29#13;    || CIF
     |FINSI;
     #24#5 = #29#15;          ||Dir
     #24#6 = #29#16;          ||Pob

     #24#180 = #29#17;        ||CP
     aAlfa = #24#180 % 102;
     #24#178 = aAlfa;
     aAlfa = #24#180 % -103;
     #24#179 = aAlfa;

     #24#205 = #225#0;        ||Pais

     aAlfa = #24#205;
     |QBF aAlfa;
     aEsp = #28#9; |QBF aEsp;
     |SI aAlfa ! aEsp;
          #24#180 = "99999";
          #24#178 = "99";
          #24#179 = "999";
     |FINSI;

     #24#7 = #29#18;          ||Prov
     #24#14 = #225#1;

     #24#8 = #29#15;
     #24#9 = #24#6;
     #24#181 = #24#178;
     #24#182 = #24#179;
     #24#183 = #24#180;
     #24#10 = #24#7;

     #24#11 = #29#15;
     #24#12 = #24#6;
     #24#184 = #24#178;
     #24#185 = #24#179;
     #24#186 = #24#180;
     #24#13 = #24#7;

     #24#211 = #29#17;   ||CP Ext

     aAlfa = "430" + #24#0 + "000000000000000";
     nPos = #142#11 + 100;
     aAlfa = aAlfa % nPos;

     #24#16 = aAlfa;
|FPRC;

|PROCESO PerContacto;
     |DDEFECTO #106;
     |ABRE #106;
     #106#0 = #24#0;
     #106#1 = 1;
     |LEE 101#106=;
     |SI FSalida ! 0; |GRABA 020#106b; |FINSI;
     #106#3 = #24#36;
     #106#4 = #24#17;
     #106#5 = #24#196;
     #106#6 = #24#197;
     #106#8 = #24#18;
     |GRABA 020#106a;
     |CIERRA #106;
|FPRC;

|PROCESO DatosDirCliFac;
     #3#0 = aCli;
     #3#1 = 9999;
     |LEE 000#3];
     |SI FSalida = 0;
          |LEE 000#3a;
     |SINO;
          |LEE 000#3u;
     |FINSI;
     |SI FSalida = 0; |Y #3#0 = aCli;
          nDir = #3#1 + 1;
     |SINO;
          nDir = 1;
     |FINSI;

     |ABRE #201;
     #201#0 = #24#3;
     |LEE 000#201=; || Zona
     |CIERRA #201;
     |ABRE #202;
     #202#0 = #24#189;
     |LEE 000#202=; ||Ruta
     |CIERRA #202;
     |ABRE #25;
     #25#0 = #24#25;
     |LEE 000#25=;
     |CIERRA #25;

     |DDEFECTO #3;
     #3#0 = aCli;
     #3#1 = nDir;
     #3#2 = #24#8;
     #3#3 = #24#9;
     #3#4 = #24#181;
     #3#5 = #24#182;
     #3#6 = #24#183;
     #3#7 = #24#10;
     #3#8 = #24#14;
     #3#10 = #24#2;
     #3#11 = #24#3;
     #3#12 = #201#1;
     #3#13 = #24#17;
     #3#14 = #24#25;
     #3#15 = #25#1;
     #3#16 = #24#189;
     #3#17 = #202#1;
     #3#19 = #24#205;
     #3#20 = #24#196;
     #3#21 = #24#18;
     #3#22 = #24#36;
     #3#23 = #24#211;
     #3#24 = #24#197;
|FPRC;

|PROCESO DatosDirCliEnv;
     #3#0 = aCli;
     #3#1 = 9999;
     |LEE 000#3];
     |SI FSalida = 0;
          |LEE 000#3a;
     |SINO;
          |LEE 000#3u;
     |FINSI;
     |SI FSalida = 0; |Y #3#0 = aCli;
          nDir = #3#1 + 1;
     |SINO;
          nDir = 1;
     |FINSI;

     |ABRE #201;
     #201#0 = #24#3;
     |LEE 000#201=; || Zona
     |CIERRA #201;
     |ABRE #202;
     #202#0 = #24#189;
     |LEE 000#202=; ||Ruta
     |CIERRA #202;
     |ABRE #25;
     #25#0 = #24#25;
     |LEE 000#25=;
     |CIERRA #25;

     |DDEFECTO #3;
     #3#0 = aCli;
     #3#1 = nDir;
     #3#2 = #24#8;
     #3#3 = #29#23;

     #3#6 = #29#24;
     aAlfa = #3#6 % 102;
     #3#4 = aAlfa;
     aAlfa = #3#6 % 103;
     #3#5 = aAlfa;
     #3#7 = #29#25;
     #3#8 = #24#14;
     #3#10 = #29#21;
     #3#11 = #24#3;
     #3#12 = #201#1;
     #3#13 = #24#17;
     #3#14 = #24#25;
     #3#15 = #25#1;
     #3#16 = #24#189;
     #3#17 = #202#1;
     #3#19 = #24#205;
     #3#20 = #24#196;
     #3#21 = #24#18;
     #3#22 = #29#20;
     #3#23 = #24#211;
     #3#24 = #24#197;
|FPRC;

|PROCESO NuevoCli;
     nError = 1;
     |ABRE #29;
     |ABRE #31;
     |ABRE #225;
     |ABRE #24;
     #29#0 = #0#0;
     |LEE 020#29=;
     |SI FSalida = 0;
          |HAZ DatosCli;
          |GRABA 020#24b;
          |SI FSalida = 0;
               |PUSHV 0501 2380;
               |PINPA #0#24;
               |PINDA #0#24;
               |ENDATOS #2#24;
               |SI FSalida = 0;
                    nError = 0;
                    |GRABA 020#24a;
                    |HAZ PerContacto;
                    |ABRE #3;
                    aCli = #24#0;
                    |HAZ DatosDirCliFac;
                    nDirFac = nDir;
                    nDirEnv = nDir;
                    |GRABA 020#3n;
                    |SI #29#11 ! #29#20; |O #29#12 ! #29#21; |O #29#15 ! #29#22;
                              |O #29#16 ! #29#23; |O #29#18 ! #29#25;
                              |O #29#17 ! #29#24; |O #29#19 ! #29#26;
                         |HAZ DatosDirCliEnv;
                         |GRABA 000#3n;
                         nDirEnv = #3#1;
                    |FINSI;
                    |CIERRA #3;
               |SINO;
                    |BORRA 020#24c;
               |FINSI;
               |POPV;
          |FINSI;
     |FINSI;
     |CIERRA #24;
     |CIERRA #225;
     |CIERRA #31;
     |CIERRA #29;
|FPRC;

|PROCESO NuevaDirFac;
     nError = 1;
     |ABRE #29;
     #29#0 = #0#0;
     |LEE 020#29=;
     |SI FSalida = 0;
          |ABRE #3;
          |ABRE #225;
          aCli = #0#37;
          |HAZ DatosDirFac;
          |GRABA 020#3b;
          |SI FSalida = 0;
               |PUSHV 0501 2380;
               |PINPA #0#3;
               |PINDA #0#3;
               |ENDATOS #2#3;
               |SI FSalida = 0;
                    nError = 0;
                    |GRABA 020#3a;
               |SINO;
                    |BORRA 020#3c;
               |FINSI;
               |POPV;
          |FINSI;
          |CIERRA #225;
          |CIERRA #3;
     |FINSI;
     |CIERRA #29;
|FPRC;

|PROCESO NuevaDirEnv;
     nError = 1;
     |ABRE #29;
     #29#0 = #0#0;
     |LEE 020#29=;
     |SI FSalida = 0;
          |ABRE #3;
          |ABRE #225;
          aCli = #0#37;
          |HAZ DatosDirEnv;
          |GRABA 020#3b;
          |SI FSalida = 0;
               |PUSHV 0501 2380;
               |PINPA #0#3;
               |PINDA #0#3;
               |ENDATOS #2#3;
               |SI FSalida = 0;
                    nError = 0;
                    |GRABA 020#3a;
               |SINO;
                    |BORRA 020#3c;
               |FINSI;
               |POPV;
          |FINSI;
          |CIERRA #225;
          |CIERRA #3;
     |FINSI;
     |CIERRA #29;
|FPRC;

|PROCESO CreaCliente;
     |HAZ DatosCli;
     |GRABA 000#24n;
     |SI FSalida ! 0;
          |SI nSwAuto = 0; |MENAV "0000Error al crear el nuevo cliente"; |FINSI;
     |SINO;
          |ABRE #3;
          |ABRE #225;
          aCli = #24#0;
          |HAZ DatosDirFac;
          |GRABA 000#3n;
          nDirFac = #3#1;
          nDirEnv = #3#1;
          |SI #29#11 ! #29#20; |O #29#12 ! #29#21; |O #29#15 ! #29#22;
                    |O #29#16 ! #29#23; |O #29#18 ! #29#25;
                    |O #29#17 ! #29#24; |O #29#19 ! #29#26;
               |HAZ DatosDirEnv;
               |GRABA 000#3n;
               nDirEnv = #3#1;
          |FINSI;
          |SI FSalida ! 0;
               |SI nSwAuto = 0; |MENAV "0000Error al crear la nueva dir. entrega"; |FINSI;
          |FINSI;
          |CIERRA #225;
          |CIERRA #3;
     |FINSI;
|FPRC;

|PROCESO FinCab;
     |PARA i = 0; |SI i [ 34; |HACIENDO i = i + 1;
          #0i = #29i;
     |SIGUE;
     #0#37 = #24#0;
     #0#35 = nDirFac;
     #0#39 = #29#35;
     #0#40 = #29#36;
     #0#41 = #29#37;
     #0#42 = #29#38;
     #0#44 = nDirEnv;
     |SI nSwAuto = 1;
          |SI nError ! 0; |ACABA; |FINSI;
     |FINSI;
     nHay = 1;
     |GRABA 020#0n;
|FPRC;

|PROCESO Linea;
     aAlfa = #1#2;
     aAlfa = aAlfa - "CAL";
     |SI FSalida > 0; nError = 1; |FINSI;

     nImpo = (#1#6 * #1#8);
     nImpo = nImpo + (nImpo * #1#7 / 100);
     nTotal = nTotal + nImpo;
     |SI nTotal > #28#3; nError = 1; |FINSI;
|FPRC;

|PROCESO BuscaDir;
     aAlfa = #3#2; |QBF aAlfa;
     |SI aAlfa = aDir;
          nDir = #3#1;
     |FINSI;
|FPRC;

|DEFBUCLE BuscaDir;
     #3#1;
     ;
     #24#0, 0001;
     #24#0, 9999;
     ;
     NULL, BuscaDir;
|FIN;

|PROCESO BuscaCli;
     |QBF aCif;
     |SI aCif ! "";
          |SELECT #4#24;
          #24#15 = aCif;
          |LEE 000#24=;
     |SINO;
          |DDEFECTO #24;
          FSalida = 1;
     |FINSI;
|FPRC;

|PROCESO IniCab;
     nError = 0;
     nTotal = 0;
     nDirFac = 0;
     nDirEnv = 0;

     aAlfa = #29#7; |QBF aAlfa;
     |SI aAlfa ! ""; nError = 1; |FINSI;

     aEsp = #28#9; |QBF aEsp;
     aAlfa = #29#19; |QBF aAlfa;
     |SI aEsp ! aAlfa; nError = 1; |FINSI;

     aCif = #29#13;
     |HAZ BuscaCli;
     |SI FSalida ! 0;
          aCif = #29#14;
          |HAZ BuscaCli;
     |FINSI;
     |SI FSalida ! 0;
          |SI nSwAuto = 1; |HAZ CreaCliente; |FINSI;
     |SINO;
          aDir = #29#15; |QBF aDir;
          |BUCLE BuscaDir;
          nDirFac = nDir;

          aDir = #29#22; |QBF aDir;
          |BUCLE BuscaDir;
          nDirEnv = nDir;
     |FINSI;
     |SI nDirFac = 0; |O nDirEnv = 0; nError = 1; |FINSI;
|FPRC;

|DEFBUCLE CargaTmp;
     #29#2;
     ;
     "     ", 000000, " ";
     "     ", 000000, " ";
     ;
     NULL, IniCab, Linea, FinCab;
|FIN;

|PROCESO Cargar;
     |ABRE #225;
     |ABRE #31;
     |ABRE #24;
     |ABRE #0;
     |BUCLE CargaTmp;
     |CIERRA #0;
     |CIERRA #24;
     |CIERRA #31;
     |CIERRA #225;
|FPRC;

|PROCESO Cli66; |TIPO 66;
     |ABRE #24;
     #24#0 = #0#37;
     |LEE 000#24];
     |CONSULTA_CLAVE #1#24;
     |SI FSalida = 0;
          #0#37 = #24#0; |PINTA #0#37;
     |SINO;
          |ERROR;
     |FINSI;
     |CIERRA #24;
|FPRC;

|PROCESO Min3;
     #3#0 = #0#37;
     #3#1 = 0001;
|FPRC;

|PROCESO Max3;
     #3#0 = #0#37;
     #3#1 = 9999;
|FPRC;

|PROCESO Dir66; |TIPO 66;
     |ABRE #3;
     #3#0 = #0#37;
     #3#1 = #0Campo;
     |LEE 000#3];
     |CONSULTA_F_CLAVE #1#3, Min3, Max3;
     |SI FSalida = 0;
          #0Campo = #3#1; |PINTA #0Campo;
     |SINO;
          |ERROR;
     |FINSI;
     |CIERRA #3;
|FPRC;

|PROCESO Cli6; |TIPO 6;
     |SI FSalida = 15;   || Nuevo Cli
          |HAZ NuevoCli;
          |SI nError = 0;
               #0#37 = #24#0; |PINTA #0#37;
               #0#35 = nDirFac; |PINTA #0#35;
               #0#44 = nDirEnv; |PINTA #0#44;
               |GRABA 020#0a;
          |SINO;
               |ERROR;
          |FINSI;
     |FINSI;
     |SI FSalida = 16;
          |ABRE #24;
          #24#0 = #0#37;
          |LEE 020#24=;
          |SI FSalida = 0;
               |PUSHV 0501 2380;
               |PINPA #0#24;
               |PINDA #0#24;
               |ENDATOS #4#24;
               |POPV;
          |FINSI;
          |CIERRA #24;
          |ERROR;
     |FINSI;
|FPRC;

|PROCESO Cli0; |TIPO 0;
     |SI #0#37 ! "000000";
          |ABRE #24;
          #24#0 = #0#37;
          |LEE 000#24=;
          |SI FSalida ! 0;
               |MENAV "0000No existe cliente...";
               |ERROR;
          |FINSI;
          |CIERRA #24;
     |FINSI;
|FPRC;

|PROCESO Dir6; |TIPO 6;
     |SI FSalida = 15;   || Nueva Dir
          nError = 1;
          ||SI Campo = 35; |HAZ NuevaDirFac; |FINSI;
          ||SI Campo = 44; |HAZ NuevaDirEnv; |FINSI;
          |HAZ NuevaDirEnv;
          |SI nError = 0;
               #0Campo = #3#1; |PINTA #0Campo;
               |GRABA 020#0a;
          |FINSI;
     |FINSI;
     |SI FSalida = 16;
          |ABRE #3;
          #3#0 = #0#37;
          #3#1 = #0Campo;
          |LEE 000#3=;
          |SI FSalida = 0;
               |PUSHV 0501 2380;
               |PINPA #0#3;
               |PINDA #0#3;
               |ENDATOS #4#3;
               |POPV;
          |SINO;
               |MENAV "0000No existe dirección...";
          |FINSI;
          |CIERRA #3;
     |FINSI;
|FPRC;

|PROCESO Dir0; |TIPO 0;
     |SI #0Campo ! 0;
          |ABRE #3;
          #3#0 = #0#37;
          #3#1 = #0Campo;
          |LEE 000#3=;
          |SI FSalida ! 0;
               |MENAV "0000No existe dirección de entrega";
               |ERROR;
          |FINSI;
          |CIERRA #3;
     |FINSI;
|FPRC

|PROCESO Rechaza;
     |PUSHV 0501 2380;
     |BLANCO 1509 2175;
     |CUADRO 1509 2175;
     |ATRI R; |PINTA 1610, " MOTIVO DEL RECHAZO DEL PEDIDO "; |ATRI 0;
     |CUADRO 1710 2074;
     |C_V #0#38, 1, "S";
     |ENCAMPO #38#0;
     nSal = FSalida;
     |SI FSalida = 0;
          |CONFI "0000N¿Confirma el rechazo del pedido?";
          nSal = FSalida;
          |ABRE #29;
          #29#0 = #0#0;
          |LEE 121#29=;
          |SI FSalida = 0;
               |SI nSal = 0;
                    #29#34 = Usuario % 810;
                    #29#33 = #0#38;
                    #29#27 = "R";
               |SINO;
                    #29#34 = "";
                    #29#33 = "";
                    #29#27 = "";
               |FINSI;
               |GRABA 020#29a;
          |FINSI;
          |CIERRA #29;
     |FINSI;
     |C_V #0#38, 1, "N";
     |POPV;
     FSalida = nSal;
|FPRC;

|PROCESO Tecla11; |TIPO 11;
     |SI FSalida = 10;     ||F2
          |VARIABLES; {20} aPopup = ""; |FINSI;
          aPopup1 = "";  || Si fuera -1 en la posicion
          aPopup2 = 6;
          aPopup3 = "<F3> Ver registro importado";
          aPopup4 = "<F4> Cliente";
          aPopup5 = "<F5> Direccion factura";
          aPopup6 = "<F6> Direccion entrega";
          aPopup7 = "<F7> Rechazar registro";
          aPopup8 = "<F8> Lineas";
          IaPopup = aPopup1  <-;
          |ESPECIFICA "TRACKPOPUP", aPopup;
          nSal = FSalida;
          |SI FSalida = 1; nSal = 11; |FINSI;
          |SI FSalida = 2; nSal = 12; |FINSI;
          |SI FSalida = 3; nSal = 13; |FINSI;
          |SI FSalida = 4; nSal = 14; |FINSI;
          |SI FSalida = 5; nSal = 15; |FINSI;
          |SI FSalida = 6; nSal = 16; |FINSI;
          FSalida = nSal;
          |SI FSalida = 0; |ERROR; |ACABA; |FINSI;
     |FINSI;

     |SI FSalida = 11;   ||F3 Ver
          |ABRE #29;
          #29#0 = #0#0;
          |LEE 000#29=;
          |CIERRA #29;
          |PUSHV 0501 2380;
          |PINPA #0#29;
          |PINDA #0#29;
          |ENDATOS #4#29;
          |POPV;
     |FINSI;
     |SI FSalida = 12; || F4 Cliente
          |SI #0#36 = "S";
               |MENAV "0000Ya esta pasado a pedido...";
               |ERROR; |ACABA;
          |FINSI;
          |ENCAMPO #37#0;
          |SI FSalida = 0; |O FSalida = 6; || 6 = F11
               |GRABA 020#0a;
          |SINO;
               |LEE 000#0=;
          |FINSI;
          |PINTA #0#37;
     |FINSI;
     |SI FSalida = 13;   || F5  Dir Fac
          |SI #0#36 = "S";
               |MENAV "0000Ya esta pasado a pedido...";
               |ERROR; |ACABA;
          |FINSI;
          |ENCAMPO #35#0;
          |SI FSalida = 0; |O FSalida = 6; || 6 = F11
               |GRABA 020#0a;
          |SINO;
               |LEE 000#0=;
          |FINSI;
          |PINTA #0#35;
     |FINSI;
     |SI FSalida = 14;   || F6 Dir Env
          |SI #0#36 = "S";
               |MENAV "0000Ya esta pasado a pedido...";
               |ERROR; |ACABA;
          |FINSI;
          |ENCAMPO #44#0;
          |SI FSalida = 0; |O FSalida = 6; || 6 = F11
               |GRABA 020#0a;
          |SINO;
               |LEE 000#0=;
          |FINSI;
          |PINTA #0#44;
     |FINSI;
     |SI FSalida = 15; || F7 Rechazar
          |SI #0#36 = "S";
               |MENAV "0000Ya esta pasado a pedido...";
               |ERROR; |ACABA;
          |FINSI;
          |HAZ Rechaza;
          |SI FSalida = 0;
               #0#36 = "R";
          |SINO;
               #0#36 = "N";
               #0#38 = "";
          |FINSI;
          |GRABA 020#0a;
          |PINTA #0#36;
     |FINSI;
     |SI FSalida = 16; || F8 Lineas
          |ENTLINEAL #1#1, 2, 4, 22, 0, Min1, Max1;
          |PINTA 1710, "                                             ";
     |FINSI;
|FPRC;

|PROCESO Tecla0; |TIPO 0;
     |SI FSalida = 0; |Y #0Campo = Contenido;
          |SI #0#36 = "S";
               |CONFI "0000NYa esta pasado a pedido.¿Desea modificar el pedido?";
               |SI FSalida = 0;
                    aAlfa = "2"+#0#28+(("000000"+#0#29)%-106)+#0#37+(("000"+#0#35)%-103);
                    aAlfa = "pcegz008;" + aAlfa;
                    |SUB_EJECUTA_NP aAlfa;
               |FINSI;
               |ERROR; |ACABA;
          |FINSI;

          |SI #0#37 = "000000";
               |ENCAMPO #37#0;
               |SI FSalida = 0; |O FSalida = 6; ||6 = F11
                    |GRABA 020#0a;
               |SINO;
                    |LEE 000#0=;
               |FINSI;
               |PINTA #0#37;
          |FINSI;
          |SI #0#35 = 0; |Y #0#37 ! "000000";
               |ENCAMPO #35#0;
               |SI FSalida = 0; |O FSalida = 6; ||6 = F11
                    |GRABA 020#0a;
               |SINO;
                    |LEE 000#0=;
               |FINSI;
               |PINTA #0#35;
          |FINSI;
          |SI #0#44 = 0; |Y #0#37 ! "000000"; |Y #0#35 ! 0;
               |ENCAMPO #44#0;
               |SI FSalida = 0; |O FSalida = 6; ||6 = F11
                    |GRABA 020#0a;
               |SINO;
                    |LEE 000#0=;
               |FINSI;
               |PINTA #0#44;
          |FINSI;

          |SI #0#37 ! "000000"; |Y #0#35 ! 0; |Y #0#44 ! 0;
               |CONFI "0000N¿Pasar a pedido?";
               |SI FSalida = 0;
                    |HAZ PasaPedido;
                    |SI nError = 0;
                         #0#36 = "S"; |PINTA #0#36;
                         |GRABA 020#0a;
                    |FINSI;
               |FINSI;
          |FINSI;
          |LEE 000#0=;
          |PINTA #0#35;
          |PINTA #0#36;
          |PINTA #0#44;
     |FINSI;
|FPRC;

|PROCESO Min1;
     #1#0 = #0#0;
     #1#1 = 1;
|FPRC;

|PROCESO Max1;
     #1#0 = #0#0;
     #1#1 = 999;
|FPRC;

|PROCESO Min0;
     #0#0 = 0;
|FPRC;

|PROCESO Max0;
     #0#0 = 9999999;
|FPRC;

|PROCESO Tipo7; |TIPO 7;
     |ENTLINEAL #1#1, 2, 7, 22, 0, Min1, Max1;
|FPRC;

|PROGRAMA;
     |MODO_RELACION #0, 1, "dsm00003", "N", "N";

     |ABRE #28; |LEE 000#28p; |CIERRA #28;

     |HAZ CreaTempo; |NOME_DAT #0Tempo; |DELINDEX #0; aTmp0 = Tempo;
     |SI PARAMETRO = "menu";
          nSwAuto = 0;
          |HAZ Cargar;
          |CLS;
          |PINPA #0#0;
          |PINDA #0#0;
          |SI nHay = 0;
               |MENAV "0000No hay registros...";
          |SINO;
               |ENTLINEAL #1#0, 1, 4, 10, 0, Min0, Max0;
          |FINSI;
     |SINO;
          nSwAuto = 1;
          |HAZ Cargar;
          |BUCLE PasaPedido;
     |FINSI;
     Tempo = aTmp0; |HAZ BoraTempo; |DELINDEX #0;
|FPRO;
