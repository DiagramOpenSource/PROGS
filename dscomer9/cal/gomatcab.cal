|FICHEROS;
     gomatcab #0;
     gomatlin #1;
     gomantca #2;
     gomantli #3;
     agifa324 #6;             ||Divisas.
     goparame #7;
     agifa027 #8;
     agifa321 #9;
     gomatljn #10,MANTE;      ||Albaranes Presup.
     goalbpa3 #5;
     goalbpa2 #4;
     goalbpa5 #104;
     goalbpa1 #105;
     goalbpa4 #106;
     agifa077 #11; ||,MANTE;
     gopre001 #12;
     agifa080 #80;
|FIN;
-----------------------------------------------------------------------------
|VARIABLES;
     &enSubcon = 0;
     &eaSerPre = "";
     &enNumPre = 0;
     &eaSerExp = "";
     &enNumExp = 0;

     &eaEstado = "";
     &efFecha       = @;
     nSwCerrado     = 0;
     &cCodMonBase   = "";
     &cCodMonTrab   = "";
     &cCodMonActu   = "";
     &cCodMonConv   = "";
     &cDesMonBase   = "";
     &cDesMonTrab   = "";
     &cSerie        = "";
     &xSerie        = "";
     &nExped        = 0;
     &nDeci_IBase   = 0;
     &nDeci_TBase   = 0;
     &nDeci_ITrab   = 0;
     &nDeci_TTrab   = 0;
     &nDeci_TotVis  = 0;
     &nEurComTrab   = 0;
     &nEurComBase   = 0;
     &nEurVenTrab   = 0;
     &nEurVenBase   = 0;
     &nPrecioComp   = 0;
     &nPrecioVent   = 0;
     &nPreComTrab   = 0;
     &nPreVenTrab   = 0;
     &nPreComBase   = 0;
     &nPreVenBase   = 0;

     &xDocTras      = 0;
     &xFecDocu      = @;
     &xLinDocu      = 0;
     &xCodArti      = "";
     &xDesArti      = "";
     &xCanArti      = 0;
     &xAlmEntr      = 0;
     &xAlmSali      = 0;
     &xModo         = 0;
     &xForma        = 0;

     nSumHor        = 0;
     nModo          = 0;
     nEuros         = 0;
     nLinea         = 0;
     nSalida        = 0;
     nError         = 0;
     &aSepaAlb      = "";
     &aDepaAlb      = "";
|FIN;
-----------------------------------------------------------------------------
|PROCESO MatMin;
     #2#0 = "     ";
     #2#1 = 1;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO MatMax;
     #2#0 = "zzzzz";
     #2#1 = 999999;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO MonTraMat; |TIPO 13;
     nModo = (FEntrada/100)!0;
     |SI nModo = 4; |O nModo = 3; |O nModo = 0;
          |LEE 000#0=;
          |ABRE #1;
          #1#0 = #0#0;
          #1#1 = #0#1;
          #1#2 = 1;
          |LEE 000#1=;
          |CIERRA #1;
          |HAZ PinLinAlb;
     |FINSI;

     |SI cCodMonTrab ! #0#20;
          cCodMonTrab = #0#20;
          |HAZ MonBas;
          #0#21 = cCodMonBase;          ||Moneda Base.
          #0#23 = nEurVenBase;          ||Valor cambio Base.
          #0#22 = nEurVenTrab;          ||Valor cambio Trabajo.
     |FINSI;

     |ABRE #7; |LEE 000#7p; |CIERRA #7;
     |SI #7#141 = "O";
          |PINTA 624, "         O.T.:";
          |ATRI R; |PINTA 807, " O.E.       "; |ATRI 0;
          |ATRI I; |PINTA 1049, "T.OE.:"; |ATRI 0;
     |FINSI;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO AltaPresu; |TIPO 0;
     nModo = (FEntrada/100)!0;
     |SI nModo = 1; |O nModo = 2;
          |ABRE #1;
          |ABRE #2;
          #2#0 = #0#0;
          #2#1 = #0#1;
          |LEE 000#2=;
          |SI FSalida = 0;
               nLinea = 0;
               |BUCLELIN 0 GrabLine #2;
          |FINSI;
          |CIERRA #1;
          |CIERRA #2;
     |FINSI;
|FPRC;

|PROCESO AltAlb; |TIPO 0;
     nModo = (FEntrada/100)!0;
     |SI nModo = 4;
          cCodMonTrab = #0#20;
          |HAZ MonBas;
     |FINSI;
     |ABRE #2;
     aSepaAlb = "";
     aDepaAlb = "";
     #2#0 = #0#0;
     #2#1 = #0#1;
     |LEE 000#2=;
     |SI FSalida = 0;
          aSepaAlb = #2#28;
          aDepaAlb = #2#29;
     |FINSI;
     |CIERRA #2;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO GrabLine;
     |DDEFECTO #1;
     nLinea = nLinea + 1 ;
     #1#0 = #0#0;        ||Serie Expe.
     #1#1 = #0#1;        ||Num. Exped.
     #1#2 = nLinea;      ||Linea.
     |LEE 101#1=;

     |SI FSalida ! 0;
          |GRABA 020#1c;
     |FINSI;

     #1#3 = #3#3;        ||Serie Pres.
     #1#4 = #3#4;        ||Num. Presu.
     #1#9 = #3#5;        ||Tipo Presu.
     |GRABA 020#1a;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO ParMin;
     #2#0 = "     ";
     #2#1 = 1;
     #10#0 = #1#3;
     #10#1 = #1#4;
     #10#2 = 1;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO ParMax;
     #2#0 = "zzzzz";
     #2#1 = 999999;
     #10#0 = #1#3;
     #10#1 = #1#4;
     #10#2 = 9999;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO PinLinAlb; |TIPO 7;
     |ABRE #12;
     #12#0 = #1#3;
     #12#1 = #1#4;
     |LEE 000#12=;
     |CIERRA #12;
     |C_A #12#8, 1, 40;
     |PINTA 1307, #12#8;

     |ENTLINEAL #1#10, 3, 7, 22, 0, ParMin, ParMax;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO Acepta; |TIPO 0;
     nModo = (FEntrada/100)!0;
     |SI nModo = 1;
          |ERROR;
          |ACABA;
     |FINSI;
     |SI nModo = 4;
          |HAZ LinAlb_1;
     |SINO;
          eaSerPre = #1#3;
          enNumPre = #1#4;
          eaSerExp = #1#0;
          enNumExp = #1#1;
          |HAZ EstadoObra;
          |SI FSalida ! 0; |ERROR; |FINSI;
     |FINSI;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO BajaPart;
     |ABRE #4;
     #4#0 = #5#4;                                 ||Serie Albaran
     #4#1 = #5#5;                                 ||N§ Albaran
     #4#2 = #5#6;                                 ||Linea.
     |LEE 000#4=;

     |SI FSalida = 0;
          #4#6 = #4#6 - #5#10;                    ||Cantidad Asignada.
          #4#7 = #4#7 + #5#10;                    ||Cantidad pendiente.
          |GRABA 020#4a;

          |DDEFECTO #80;
          |ABRE #80;
          #80#27 = #4#0;
          #80#0 = #4#1;
          #80#1 = #4#2;
          |LEE 000#80=;
          |CIERRA #80;
          |SI #80#3 ! #0#0;
               xDocTras = #5#19;
               xSerie   = #5#32;
               xFecDocu = #10#3;
               xLinDocu = #5#7;
               xCodArti = #4#3;
               xDesArti = #4#4;
               xCanArti = #5#10;
               xAlmEntr = #5#17;
               xAlmSali = #4#8;
               xModo = 3;
               xForma = -1;
               |SUB_EJECUTA_NP "gomovalm";
          |FINSI;
     |FINSI;

     |CIERRA #4;
     ||-------------------------------------
     |ABRE #104;
     #104#0 = #5#4;                                 ||Serie Albaran
     #104#1 = #5#5;                                 ||N§ Albaran
     #104#2 = #5#6;                                 ||Linea.
     |LEE 000#104=;

     |SI FSalida = 0;
          #104#6 = #104#6 - #5#10;                    ||Cantidad Asignada.
          #104#7 = #104#7 + #5#10;                    ||Cantidad pendiente.
          |GRABA 020#104a;

          |DDEFECTO #80;
          |ABRE #80;
          #80#27 = #4#0;
          #80#0 = #4#1;
          #80#1 = #4#2;
          |LEE 000#80=;
          |CIERRA #80;
          |SI #80#3 ! #0#0;
               xDocTras = #5#19;
               xSerie   = #5#32;
               xFecDocu = #10#3;
               xLinDocu = #5#7;
               xCodArti = #104#3;
               xDesArti = #104#4;
               xCanArti = #5#10;
               xAlmEntr = #5#17;
               xAlmSali = #104#8;
               xModo = 3;
               xForma = -1;
               |SUB_EJECUTA_NP "gomovalm";
          |FINSI;
     |FINSI;

     |CIERRA #104;

     |BORRA 020#5a;
|FPRC;
-----------------------------------------------------------------------------
|DEFBUCLE BajaPart;
     #5#1;
     ;
     "M", #10#5, #10#6, 001, 001;
     "M", #10#5, #10#6, 999, 999;
     be;
     NULL, BajaPart;
|FIN;
-----------------------------------------------------------------------------
|PROCESO BajaMaterial;
     |BUCLE BajaPart;
     |ABRE #105;
     #105#0 = #10#5;
     #105#1 = #10#6;
     |LEE 101#105=;
     |SI FSalida = 0;
          |BUCLELIN 1 NULL #105;
          |BORRA 020#105a;
          |ABRE #11;
          #11#50 = #10#5;
          #11#0  = #10#6;
          |LEE 101#11=;
          |SI FSalida = 0;
               #11#34 = "PE";
               |GRABA 020#11a;
          |FINSI;
          |LIBERA #11;
          |CIERRA #11;
     |FINSI;
     |CIERRA #105;
     |ABRE #106;
     #106#0 = #10#5;
     #106#1 = #10#6;
     |LEE 101#106=;
     |SI FSalida = 0;
          |BUCLELIN 1 NULL #106;
          |BORRA 020#106a;
     |FINSI;
     |LIBERA #106;
     |CIERRA #106;

     |BORRA 020#10a;
|FPRC;
-----------------------------------------------------------------------------
|DEFBUCLE BajaMate;
     #10#1;
     ;
     #1#3, #1#4,    1;
     #1#3, #1#4, 9999;
     ;
     NULL, BajaMaterial;
|FIN;
-----------------------------------------------------------------------------
|PROCESO CalCab; |TIPO 2;
     nModo = (FEntrada/100)!0;

     |SI nModo = 3;
          |CONFI "    NDar de baja este presupuesto y las lineas de albaranes que cuelgan de el ?";
          |SI FSalida = 0;
             |BUCLE BajaMate;
             |ACABA;
          |SINO;
             |ERROR; |ACABA;
          |FINSI;
     |FINSI;

     |SI #1#9 = "P";
          #0#2  = #0#2 +. #1#5;         ||Pres. Costo.
          #0#4  = #0#4 +. #1#7;         ||Pres. Venta.
     |FINSI;

     |SI #1#9 = "A";
          #0#6  = #0#6 +. #1#5;         ||Admi. Costo.
          #0#8  = #0#8 +. #1#7;         ||Admi. Venta.
     |FINSI;

     |SI #1#9 = "E";
          #0#10 = #0#6 +. #1#5;         ||Extr. Costo.
          #0#12 = #0#8 +. #1#7;         ||Extr. Venta.
     |FINSI;

     #0#14 = #0#4+#0#8+#0#12;           ||Total Gen. Venta.
     #0#16 = #0#2+#0#6+#0#10;           ||Total Gen. Venta.
     |PINDA #0#0;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO LinAlb_1; |TIPO 7;
     |ENTLINEAL #1#10, 3, nModo, 22, 0, ParMin, ParMax;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO Tipo2Cab; |TIPO 2;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 3;
     |FINSI;
|FPRC;
