|FICHEROS;
     juminf01 #0;
     juminf02 #2;
     juminf03 #3;
     dsm00003 #7;
     agifa024 #24;
     agifa025 #25;
     juminf34 #34;
     agifm001 #101;
     agifm002 #102;
     agifa142 #142;
|FIN;

|VARIABLES;
     &eaPais = "";
     &eaVarDni = "";
     aNifQbf1 = "";
     aNifQbf2 = "";
     aAlfa = "";
     nModo = 0;
     nForma = 0;
     quitar = 0;
     cod = 0;
     cuen = "";
     nConta = 0;
     aConte = "";
|FIN;

|PROCESO Tipo80_01; |TIPO 80;
     FSalida = 3090;
|FPRC;

|PROCESO Graba1Dir;
     |ABRE #101;
     #101#0 = #24#3;
     |LEE 000#101=; || Zona
     |CIERRA #101;
     |ABRE #102;
     #102#0 = #24#189;
     |LEE 000#102=; ||Ruta
     |CIERRA #102;
     |ABRE #25;
     #25#0 = #24#25;
     |LEE 000#25=;
     |CIERRA #25;

     |ABRE #7;
     |DDEFECTO #7;
     #7#0 = #24#0;
     #7#1 = 1;
     |LEE 101#7=;
     |SI FSalida ! 0; |GRABA 021#7b; |FINSI;
     #7#2 = #24#5;
     #7#3 = #24#6;
     #7#4 = #24#178;
     #7#5 = #24#179;
     #7#6 = #24#180;
     #7#7 = #24#7;
     #7#8 = #24#14;
     #7#10 = #24#2;
     #7#11 = #24#3;
     #7#12 = #101#1;
     #7#13 = #24#17;
     #7#14 = #24#25;
     #7#15 = #25#1;
     #7#16 = #24#189;
     #7#17 = #102#1;
     #7#19 = #24#205;
     #7#20 = #24#196;
     #7#21 = #24#18;
     #7#22 = #24#36;
     #7#23 = #24#211;
     #7#24 = #24#197;
     |GRABA 021#7a;
     |CIERRA #7;
|FPRC;

|PROCESO BorraDir;
     |BORRA 020#7a;
|FPRC;

|DEFBUCLE BorraDir;
     #7#1;
     ;
     #24#0, 0001;
     #24#0, 9999;
     be;
     NULL, BorraDir;
|FIN;

|PROCESO Tipo2_01; |TIPO 2;
     nModo = (FEntrada / 100) ! 0;
     nForma = 0 +. 1;

     |ABRE #24;
     |ABRE #2;
     |ABRE #3;
     |SI nModo = 3;
          #24#0 = #0#0;
          |BORRA 000#24c;
          |BUCLE BorraDir;

          |SELECT #3#3;
          #3#0 = #0#26;
          #3#1 = #0#0;
          |LEE 101#3=;
          |SI FSalida = 0;
               |BORRA 020#3a;
          |FINSI;
          |SELECT #1#3;
          #3#0 = #0#26;
          #3#3 = "";
          |LEE 000#3];
          |SI FSalida ! 0; |O #3#0 ! #0#26;
               #2#0 = #0#26;
               |BORRA 000#2c;
          |FINSI;
     |SINO;
          |SI nModo = 1;
               |HAZ Cta;
          |FINSI;
          |SI nForma = 1;
               |SELECT #3#3;
               #3#0 = #0#26;
               #3#1 = #0#0;
               |LEE 101#3=;
               |SI FSalida ! 0;
                    |SELECT #1#3;
                    #3#0 = #0#26;
                    #3#3 = "999999";
                    |LEE 000#3];
                    |SI FSalida = 0;
                         |LEE 000#3a;
                    |SINO;
                         |LEE 000#3u;
                    |FINSI;
                    |SI FSalida = 0; |Y #3#0 = #0#26;
                         nConta = #3#3;
                         nConta = nConta + 1;
                    |SINO;
                         nConta = 1;
                    |FINSI;
                    aAlfa = ("000000" + nConta) % -106;
                    |DDEFECTO #3;
                    #3#0 = #0#26;
                    #3#1 = #0#0;
                    #3#2 = #0#1;
                    #3#3 = aAlfa;
                    #3#4 = ~;
                    |GRABA 020#3n;
               |FINSI;
          |FINSI;
          |SI nForma = 1;
               |DDEFECTO #24;
               #24#0 = #0#0;
               |LEE 101#24=;
               |SI FSalida ! 0; |GRABA 020#24b; |FINSI;
               #24#1 = #0#1;
               #24#8 = #0#2;
               #24#9 = #0#3;
               #24#181 = #0#4;
               #24#182 = #0#5;
               #24#183 = #0#6;
               #24#10 = #0#7;
               #24#15 = #0#8;
               #24#17 = #0#9;
               #24#18 = #0#10;
               #24#196 = #0#11;
               #24#197 = #0#12;
               #24#159 = #0#13;
               #24#20 = #0#27;
               #24#36 = #0#29;
               #24#16 = #0#30;
               #24#32 = ("0000" + #0#16) % -104;
               #24#33 = ("0000" + #0#17) % -104;
               #24#31 = ("00" + #0#18) % -102;
               #24#30 = ("0000000000" + #0#19) % -110;
               |GRABA 020#24a;
               |HAZ Graba1Dir;
          |FINSI;
     |FINSI;
     |CIERRA #3;
     |CIERRA #2;
     |CIERRA #24;
|FPRC;

|PROCESO MontaCP01; |TIPO 0;
     #0#6 = (("00" + #0#4) % -102) + (("000" + #0#5) % -103);
|FPRC;

|PROCESO LetraNif01; |TIPO 6;
     eaPais = "";

     |SI FSalida = 9;
          eaVarDni  = #0Campo;
          |HAZ CalculoNIFCIF;
          #0Campo = eaVarDni;
          |PINTA #0Campo;
          |ERROR; |ACABA;
     |FINSI;

     eaVarDni  = #0Campo;
     |HAZ CalculoNIFCIF;

     aNifQbf1 = #0Campo;   |QBF aNifQbf1;
     aNifQbf2 = eaVarDni;  |QBF aNifQbf2;

     |SI aNifQbf1 ! aNifQbf2; |Y aNifQbf1 ! "";
          aAlfa = "0000NEl NIF puede ser erróneo."+&13+"¿Desea calcularlo?";
          |CONFI aAlfa;
          |SI FSalida = 0;
               #0Campo = eaVarDni; |PINTA #0Campo;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Agrupacion6; |TIPO 6;
/*
     |SI #0#26 ! "      ";
          aAlfa = #0#26; |QBF aAlfa;
          #0#26 = ("000000" + aAlfa) % -106;
          |PINTA #0#26;
     |FINSI;
*/
|FPRC;

|PROCESO Agrupacion7; |TIPO 7;
     aConte = #0Campo;
|FPRC;

|PROCESO Agrupacion0; |TIPO 0;
     nModo = (FEntrada / 100) ! 0;
     |SI #0#26 ! "      ";
          |SI #0Campo ! aConte;
               |ABRE #3;
               |SELECT #3#3;
               #3#0 = aConte;
               #3#1 = #0#0;
               |LEE 101#3=;
               |SI FSalida = 0;
                    |BORRA 020#3a;
               |FINSI;
               |CIERRA #3;
          |FINSI;

          |ABRE #2;
          #2#0 = #0#26
          |LEE 000#2=;
          |SI FSalida ! 0;
               |CONFI "0000NNo existe agrupaci¢n. ¨Desea darla de alta?";
               |SI FSalida ! 0;
                    |ERROR;
               |SINO;
                    |DDEFECTO #24;
                    |ABRE #24;
                    #24#0 = #0#26;
                    |LEE 000#24=;
                    |CIERRA #24;
                    #2#0 = #24#0;
                    #2#1 = #24#1;
                    |GRABA 020#2n;
               |FINSI;
          |FINSI;
          |CIERRA #2;
     |FINSI;
|FPRC;

|PROCESO Tipo3_01; |TIPO 3;
|FPRC;

|PROCESO T1_12; |TIPO 12;
|FPRC;

|PROCESO Conta; |TIPO 7;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 1;
          |LEE 000#0u;
          |SI FSalida = 0;
               nConta = #0#0;
          |SINO;
               nConta = 0;
          |FINSI;
          nConta = nConta + 1;
          aAlfa = ("000000" + nConta) % -106;
          |DDEFECTO #0;
          #0#0 = aAlfa;
     |FINSI;
|FPRC;

|PROCESO Cta;
     |ABRE #142; |LEE 000#142p; |CIERRA #142;
     cod = #0#0;
     aAlfa = #0#30; |QBF aAlfa;
     |SI cod ! 0; |Y aAlfa = "";
          |ABRE #34;
          |LEE 101#34p;
          |SI FSalida ! 0; |GRABA 020#34b; |FINSI;
          nConta = #34#1;
          #34#1 = #34#1 + 1;
          |GRABA 020#34a;
          |CIERRA #34;
          cuen = "000000000000" + nConta;
          |QBT cuen;
          quitar = -(100 + (#142#11 - 2));
          cuen = cuen % quitar;
          cuen = "43" + cuen;
          #0#30 = cuen; |PINTA #0#30;
     |FINSI;
|FPRC;
