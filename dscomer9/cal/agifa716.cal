|FICHEROS;
   agifa716 #0;
   agifa704 #10;

   RefDato@ #500;
|FIN;

|VARIABLES;
   &nDeci_nDec = 0;
   &eaCodEnlace = "";
   nCalc = 0; nCalc1 = 0; nCalc2 = 0;

   &fFechaAcot1 = @;
   &fFechaAcot2 = @;

   aFichP = "";
   aFichC = "";
   aCmpClv = "";
   aLong = ""; nLong  = 0;
   aAlfa = ""; aAlfa1 = "";
|FIN;

|PROCESO TomaDecs; |TIPO 13;
   |ABRE #agifa704;
   #agifa704#0 = eaCodEnlace;
   |LEE 000#agifa704.=;
   |SI FSalida = 0; |Y #agifa704#17 ! 999;
      |DDEF aAlfa; |QBF aAlfa;
      aAlfa = aAlfa + #agifa704#16 + ".mas";
      |CARGA_DEF aAlfa, RefDato@;
      |SI FSalida = 0;
         aAlfa1 = "|TITULO"; aAlfa1 = #RefDato@#aAlfa1#;
         aAlfa = " Campo clave enlace : [" + aAlfa1; |QBF aAlfa;
         aAlfa1 = "|C" + (("000" + #agifa704#17) % -103) + "NOMBRE"; aAlfa1 = #RefDato@#aAlfa1#;
         aAlfa = aAlfa + "][" + aAlfa1; |QBF aAlfa;
         |DESCARGA_DEF #RefDato@;
         aCmpClv = aAlfa + "]";
      |FINSI;
   |SINO;
      aCmpClv = &196 * 60;
   |FINSI;
   |CIERRA #agifa704;

   |PINTA 0915, aCmpClv;

   |SI #agifa716#11 ! "N"; |ACABA; |FINSI;
   nLong = 0;

   |DBASE aAlfa; |QBF aAlfa;
   aAlfa = aAlfa + "def/" + #agifa716#13;
   |CARGA_DEF aAlfa, RefDato@;
   |SI FSalida = 0;
      aAlfa = "|C" + (("000" + #agifa716#14) % -103) + "MINIMO";
      aAlfa = #RefDato@#aAlfa#;
      aAlfa = aAlfa - ".";
      |SI FSalida ! 0;
         nCalc = FSalida; nCalc1 = nCalc + 98; aAlfa = aAlfa % nCalc1; |QBF aAlfa;
         aLong = aAlfa % 0; nLong = aLong;
         aAlfa1 = "9" * nLong;
         |SI aAlfa ! aAlfa1;
            aAlfa = "|C" + (("000" + #agifa716#14) % -103) + "MAXIMO";
            aAlfa = #RefDato@#aAlfa#;
            aAlfa = aAlfa - ".";
            |SI FSalida ! 0;
               nCalc1 = FSalida; nCalc1 = nCalc1 + 98; aAlfa = aAlfa % nCalc1; |QBF aAlfa;
            |FINSI;
            aLong = aAlfa % 0; nCalc1 = aLong;
            nCalc2 = (nCalc / 100) ! 0;
            |SI nCalc1 > nCalc2; nCalc = (nCalc1 + 1) * 100; |FINSI;
            nCalc1 = (nCalc / 100) ! 0; nLong = 15 - nCalc1;
         |FINSI;
      |FINSI;
      |DESCARGA_DEF #RefDato@;
   |FINSI;
   nDeci_nDec = nLong;
|FPRC;

|PROCESO MiraCmpClv; |TIPO 11;
   |SI FSalida = 12;
      |ABRE #agifa704;
      #agifa704#0 = eaCodEnlace;
      |LEE 101#agifa704.=;
      |SI FSalida = 0;
         |SI #agifa704#2 = "FV";
            |SI #agifa704#8 = "S";
               aFichP = "agifa071"; aFichC = "agifa010";
            |SINO;
               aFichP = "agifa134"; aFichC = "agifa134";
            |FINSI;
         |FINSI;
         |SI #agifa704#2 = "FC";
            |SI #agifa704#8 = "S";
               aFichP = "agifa077"; aFichC = "agifa080";
            |SINO;
               aFichP = "agifa079"; aFichC = "agifa079";
            |FINSI;
         |FINSI;
         |SI #agifa704#2 = "FD";
            |SI #agifa704#8 = "S";
               aFichP = "agifa084"; aFichC = "agifa069";
            |SINO;
               aFichP = "agifa084"; aFichC = "agifa084";
            |FINSI;
         |FINSI;
         |SI #agifa704#2 = "TI";
            |SI #agifa704#8 = "S";
               aFichP = "agifa502"; aFichC = "agifa501";
            |SINO;
               aFichP = "agifa501"; aFichC = "agifa501";
            |FINSI;
         |FINSI;
         |SI #agifa704#2 = "CC";
            aFichP = "agifa509"; aFichC = "agifa509";
         |FINSI;
         |SI #agifa704#2 = "CR";
            |SI #agifa704#8 = "S";
               aFichP = "agifa572"; aFichC = "agifa571";
            |SINO;
               aFichP = "agifa571"; aFichC = "agifa571";
            |FINSI;
         |FINSI;
         aAlfa = #agifa716#13; |QBF aAlfa;
         |SI aAlfa = aFichP; |O aAlfa = aFichC;
            |SI #agifa704#17 ! 999;
               aAlfa = "    N" + &191 + " Desea cambiar el campo clave del enlace ? ";
               |CONFI aAlfa;
               |SI FSalida = 0;
                  aAlfa = " Campo clave enlace : [" + #agifa716#1; |QBF aAlfa;
                  aAlfa = aAlfa + "][" + #agifa716#2; |QBF aAlfa;
                  aCmpClv = aAlfa + "]";
                  |PINTA 0915, aCmpClv;
                  #agifa704#16 = #agifa716#13; #agifa704#17 = #agifa716#14;
                  |GRABA 020#agifa704.a;
               |FINSI;
            |SINO;
               aAlfa = " Campo clave enlace : [" + #agifa716#1; |QBF aAlfa;
               aAlfa = aAlfa + "][" + #agifa716#2; |QBF aAlfa;
               aCmpClv = aAlfa + "]";
               |PINTA 0915, aCmpClv;
               #agifa704#16 = #agifa716#13; #agifa704#17 = #agifa716#14;
               |GRABA 020#agifa704.a;
            |FINSI;
            |ERROR;
         |FINSI;
      |FINSI;
      |LIBERA #agifa704; |CIERRA #agifa704;
   |FINSI;
   |SI FSalida = 13; |Y #agifa704#17 ! 999;
      |ABRE #agifa704;
      #agifa704#0 = eaCodEnlace;
      |LEE 101#agifa704.=;
      |SI FSalida = 0;
         aAlfa = "    N" + &191 + " Desea vaciar el campo clave del enlace ? ";
         |CONFI aAlfa;
         |SI FSalida = 0;
            #agifa704#16 = ""; #agifa704#17 = 999;
            |GRABA 020#agifa704.a;
         |FINSI;
         aCmpClv = &196 * 60; |PINTA 0915, aCmpClv;
         |ERROR;
      |FINSI;
      |LIBERA #agifa704; |CIERRA #agifa704;
   |FINSI;
|FPRC;

|PROCESO ComprFecha;
   |SI #agifa716#11 = "F";
      fFechaAcot1 = #agifa716#7; fFechaAcot2 = ~;
      aAlfa = fFechaAcot2; aAlfa = aAlfa % -104; nCalc = aAlfa;
      nCalc = nCalc - 6;
      aAlfa = fFechaAcot2; aAlfa = (aAlfa % 0106) + nCalc;
      fFechaAcot2 = aAlfa;
      |SI fFechaAcot1 < fFechaAcot2;
         |AVISO;
         |MENAV "    Fecha erronea"; |ERROR;
         || #agifa716#7 = fFechaAcot2; |PINTA #agifa716#7;
      |FINSI;
   |FINSI;
|FPRC;
