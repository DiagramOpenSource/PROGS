||SI SE ACTUALIZAN LOS CAMPOS TAMBIEN HACERLO EN GOPUE001 Y GOTMPPR1


|FICHEROS;
     gopre001 #0;
     gopre002 #1;
     gopre003 #2,MANTE;
     goapaive #3;                                 ||Capitulos IVE.
     gopre004 #4,MANTE;
     godeivel #5;                                 ||Des. Ampliada (LIN)
     gopue001 #6,MANTE;  || ANEXO
     goinform@ #7;
     agifa027 #8;                                 ||Contadores.
     goartdes #9,MANTE;
     goartive #10;
     gopre021 #11,MANTE; || Agrupa Capi
     gopre022 #12;
     goparame #17;
     godeivec #18;                                ||Des. Ampliada (CAB)
     gomedici #20,MANTE;
     goclipon #21,MANTE;                          ||Clientes Potenciales.
     agifa024 #22,MANTE;                          ||Clientes Generales.
     gopre023 #23,MANTE; || Agrupa Principal
     gofamive #101;
     gosubive #102;
     goapaive #103;
     gosecive #104;
     gopue002 #200;
     godeprel #202;
     agi00063 #203;
     gopue002 #204;
     goanexos #222;      || para el anexo fijo
     gomantho #300;
     gomantl1 #301;
     gocercab #302;
     guerz007 #70;
     gopre015 #80;

     goprepec #500;
     referen@ #501;
     gotmpan2 #511;
     dsm00003 #33,MANTE;
     agifa019 #19;
     agifa091 #91;
     guerm039 #39;
     agifa321 #321;
|FIN;
-----------------------------------------------------------------------------
|VARIABLES;
     &enTiva = 0;
     &efFiva = @;
     &eaDiva = "";
     &enIva = 0;
     &enRec = 0;

     &enSwAltaCli = 0;
     aMarca = "";
     aDesMarca = "";
     nLinea = 0;
     nCosInd = 0;
     &enPre         = 0;
     &enSer         = "";
     aModo = "";
     nValor = 0;
     nTecla = 0;
     &enCosteInd = 0; || Al importar un BC3
     &eaAgrupacion = ""; || Al importar un BC3, si tiene o no agrupacion
     &eaAgrupaPrin = ""; || Al importar un BC3, si tiene o no agrupacion
     &eaCapi = "";
     nTotalE = 0;
     nBajaE = 0;
     nBaja1 = 0;
     nBaja2 = 0;
     nBaja3 = 0;
     nBaja4 = 0;
     nBaja5 = 0;
     nDtoE = 0;
     nDto1 = 0;
     nDto2 = 0;
     nDto3 = 0;
     nDto4 = 0;
     nDto5 = 0;
     nGasE = 0;
     nGas1 = 0;
     nGas2 = 0;
     nGas3 = 0;
     nGas4 = 0;
     nGas5 = 0;
     nBenE = 0;
     nBen1 = 0;
     nBen2 = 0;
     nBen3 = 0;
     nBen4 = 0;
     nBen5 = 0;
     nTotal1 = 0;
     nTotal2 = 0;
     nTotal3 = 0;
     nTotal4 = 0;
     nTotal5 = 0;
     nSwBorra = 0;
     nSwFlag  = 0;
     &enError = 0;
     &efFecha = @;
     &nDeci_PreBase = 0;
     &eaTipo = "";
     &enNum  = 0;
     &eaSer  = "";
     aDesdeFuera = "";
     aSerExp     = "";
     nNumExp     = 0;
     nAntNum     = 0;
     nCalc       = 0;

     nGuarda        = 0;
     nTinc          = 0;
     aSer           = "";
     aNum           = "";
     nForma         = 0;
     aAlfa          = "";
     nTotal         = 0;
     &cCodMonBase   = "";
     &cCodMonTrab   = "";
     &cCodMonDe     = "";
     &cCodMonA      = "";
     &cCodMonConv   = "";
     &cCodMonActu   = "";
     &cDesMonBase   = "";
     &cDesMonTrab   = "";

     &nDeci_Medi    = 0;
     &nDeci_Meda    = 0;
     &nDeci_Incr    = 0;
     &nDeci_PBase   = 0;
     &nDeci_TBase   = 0;
     &nDeci_PTrab   = 0;
     &nDeci_TTrab   = 0;
     &nDeci_TotVis  = 0;
     &nEurComTrab   = 0;
     &nEurComBase   = 0;
     &nEurVenTrab   = 0;
     &nEurVenBase   = 0;
     &nPreComTrab   = 0;
     &nPreComBase   = 0;
     &nPreVenTrab   = 0;
     &nPreVenBase   = 0;
     &nPrecioComp   = 0;
     &nPrecioVent   = 0;

     &eaCodigo      = "";
     &eaSerie       = "";

     &cDesc         = "";
     &cEstado       = "Venta";
     &cNivel        = "PRE";
     &cSerie        = "";
     &cAplica       = "";
     &cCapitulo     = "";
     &cDesCapit     = "";
     &cParti        = "";
     &cPart         = "";

     &nErrorInf     = 0;
     &nAmp          = 0;
     &nNumero       = 0;
     &nImporte      = 0;
     &nError        = 0;
     &eaNumero      = 0;

     cDirBase       = "";
     cUsuario       = "";
     cPathDsin      = "";
     cPathApli      = "";
     cOrigen        = "";
     cDestino       = "";
     cConta         = "";
     cMensaje       = "";
     cFamilia       = "";
     cSubFamilia    = "";
     cSecMin        = "";
     cSecMax        = "";
     cEjecuta       = "";
     cDescr         = "";
     cFami          = "";
     cCodAct        = "";
     cModulo        = "";
     cMensa         = "";
     cont           = "";

     nConta         = 0;
     nModo          = 0;
     nSalida        = 0;
     nDeciActual    = 0;
     nInf           = 0;
     nTotDes        = 0;
     nPreAct        = 0;
     nIncrem        = 0;
     nBorDes        = 0;
     nBotAmCap      = 0;
     contador       = 0;
     nBotAmpli      = 0;
     nBotPorci      = 0;
     nBotPorce      = 0;
     nBotParti      = 0;
     nBotIndic      = 0;
     nBotSelec      = 0;
     nBotGener      = 0;
     nBotSuCap      = 0;
     nBotAgp        = 0;
     nBotReCap      = 0;
     nBotCliGe      = 0;
     nBotCliPo      = 0;

     {-1}aUtil      = "";
     aUtil1         = "2400";
     aUtil2         = "1";
     aUtil3         = "Opciones: ";
     aUtil4         = "IVCASh";
     aUtil5         = " Imprimir";
     aUtil6         = " P. Venta";
     aUtil7         = " P. Coste";
     aUtil8         = "Anexo";
     aUtil9         = "Seguimiento";
     aUtil10        = "Chequeo";

     {-1}menu       = "";
     menu1          = "2400";
     menu2          = "1";
     menu3          = "Contador:  ";
     menu4          = "AM";
     menu5          = " Automatico ";
     menu6          = " Manual ";
     {500}fiebdc    = "";
     nAmp2 = 0;
     alfa1 = "";
     nPreContenido  = 0;
     nIncContenido  = 0;
     nNume1 = 0;
     nNume2 = 0;
     aAlfa1 = "";
     aAlfa2 = "";
     nAlgo = 0;
     nPorPEM = 0;
     nTotalPEM = 0;
     aCam2     = "";
     aCam3     = "";
     aCam4     = "";
     aCam5     = "";
     aCam6     = "";
     aCam10    = "";
     nHay      = 0;
     aArti     = "";
     nPrec     = 0;
     aTempo70  = "";
     &Tempo    = "";
     nSwGoman  = 0;
     nSwModiPre= 0;
     nCampos   = 0;
     i         = 0;
     aDef      = "";
     &nCAPITULO = 0;
     nCAPITULO_ANT = 0;
     &nSUBCAPITULO = 0;
     swImpresion = 0;
     aDestino = "";
     nCanal = 0;
     swCrystal = 0;
     nCampo = 0;
     aFich = "";
     aPath = "";
     aPath1 = "";
     aCrystalPath = "";
     aIP = "";
     nLaUltima = 0;
     &aLinPartida = "";
     &aLinImpre = "";
|FIN;
-----------------------------------------------------------------------------
|PROCESO CargaTmp;
     |PARA i = 0; |SI i [ nCampos; |HACIENDO i = i + 1;
          #501i = #0i;
     |SIGUE;
     |GRABA 020#501n;
|FPRC;

|DEFBUCLE CargaTmp;
     #0#1;
     ;
     "     ", #17#58;
     "zzzzz", #17#59;
     ;
     NULL, CargaTmp;
|FIN;

|PROCESO ConsuPre; |TIPO 66;
     |ABRE #17; |LEE 000#17p; |CIERRA #17;
     |SI #17#52 = "N";
          |CONSULTA_CLAVE #1#0;
          |ACABA;
     |FINSI;

     aSer = #0#0;
     aNum = #0#1;
     |DDEF aDef;
     aDef = aDef + "gopre001";
     |CARGA_DEF aDef, referen@;
     |SI FSalida = 0;
          aSer = #0#0;
          aNum = #0#1;
          aAlfa = "|NC";
          aAlfa = #0#aAlfa#;
          nCampos = aAlfa;
          nCampos = nCampos - 1;
          aAlfa = Usuario; |QBF aAlfa;
          |NOME_DAT #501 aAlfa;
          |DELINDEX #501;
          |ABRE #501;
          |BUCLE CargaTmp;
          #501#0 = aSer;
          #501#1 = aNum;
          |LEE 000#501];
          |CONSULTA_CLAVE #1#501;
          |SI FSalida = 0;
               aSer = #501#0;
               aNum = #501#1;
          |FINSI;
          |CIERRA #501;
          |DELINDEX #501;
          |DESCARGA_DEF #referen@;
     |FINSI;
     #0#0 = aSer;
     #0#1 = aNum;
     |LEE 101#0=;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO MonTraPre; |TIPO 14;
     cCodMonTrab = #0#7;
     |HAZ MonBas;
     nDeci_Medi = #0#24;
     nDeci_Incr = #0#25;
     nDeci_PreBase = nDeci_PTrab;
|FPRC;

|PROCESO T7; |TIPO 7;
     eaTipo = " ";
     aAlfa = PARAMETRO; |QBF aAlfa; ||LO LLAMA EL 'gomantho' y 'gocercab'
     |SI aAlfa ! "";
          aSer = aAlfa % 105;
          aNum = aAlfa % -106;
          #0#0 = aSer;
          #0#1 = aNum;
          |PTEC 802;
          |SI Campo = 1;
               PARAMETRO = "";
          |FINSI;
          nSwGoman = 1;
          nSwModiPre = 1;
     |FINSI;

     nModo = (FEntrada / 100) ! 0;
     |SI Campo = 0; |Y nModo = 1;
          |HAZ EsForestales;
          |SI FSalida = 0;
               |C_P #0Campo, 0, enNum;
               |PUSHV 0501 2380;
               |SUB_EJECUTA_NP "goma0007;CON";
               |POPV;
               |SI eaSer = "";
                    |PTEC 807;
               |SINO;
                    #0Campo = eaSer; |PINTA #0Campo;
                    |PTEC 802;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

------------------------------------------------------------------------------
|PROCESO MinConsul;
     #10#0  = cSecMin;
     #101#2 = cFamilia;
     #102#2 = cSubFamilia;
     #103#2 = cCapitulo;
|FPRC;
------------------------------------------------------------------------------
|PROCESO MaxConsul;
     #10#0  = cSecMax;
     #101#2 = cFamilia;
     #102#2 = cSubFamilia;
     #103#2 = cCapitulo;
|FPRC;
------------------------------------------------------------------------------
|PROCESO Partidas; |TIPO 6;

     nSalida = FSalida;
     cParti = "";
     nModo = (FEntrada/100)!0;

     /* F3 - Entramos en la descomposición de partidas del capitulo.*/

     |SI nSalida = 11;

          |SI nModo = 2;
               |ESTADO_CONTROL nBotParti, "HIDE"; 
               |ESTADO_CONTROL nBotIndic, "HIDE"; 
               |ESTADO_CONTROL nBotSelec, "HIDE";
               |ESTADO_CONTROL nBotGener, "HIDE"; 
               |HAZ EntraParti;
               Contenido = #1#12;
          |FINSI;

     |FINSI;

     /* F4 - F6 Entramos en Busqueda por indice o general.*/

     |SI nSalida = 12; |O FSalida = 14;

          |SI FSalida = 14;
               |ABRE #10;
               |CONSULTA_CLAVE #2#10;
               cParti = #10#0;
               |CIERRA #10;
          |SINO;
               cUsuario = Usuario % 103;
               |SUB_EJECUTA_NP "goindice;PRES";
               cParti = cPart;
          |FINSI;
          |QBF cParti;
          |SI cParti = ""; |ERROR; |ACABA; |FINSI;

          |ABRE #10;
          #10#0 = cParti;
          |LEE 000#10=;

          |SI FSalida = 0;
               cCapitulo = #10#13;
               |QBF cCapitulo;
          |SINO;
               cCapitulo = "";
               |ERROR;
               |ACABA;
          |FINSI;

          |CIERRA #10;
          |ABRE #103;
          #103#0 = cCapitulo;
          |LEE 000#103=;

          |SI FSalida ! 0;
               |MENAV "0000SELECION ERRONEA.DEBE SELECCIONAR CAPITULOS DE MAXIMO NIVEL";
               |ERROR;
               |CIERRA #103;
               |ACABA;
          |SINO;
               cFami = cCapitulo % 103;
               |QBF cFami;
               |ABRE #102;
               #102#0 = cFami;
               |LEE 000#102=;

               |SI FSalida = 0;
                    #1#12 = cFami;
                    #1#3  = cCapitulo;
               |FINSI;

               |CIERRA #102;
          |FINSI;

          |CIERRA #103;
          |CIERRA #10;
     |FINSI;

     /* F5 - Entramos en busca selectiva.*/

     |SI nSalida = 13;
          |SI #17#32 = "H";
               |ABRE #104;
               #104#0 = #1#12;
               |LEE 000#104];
               |CONSULTA_CLAVE #1#104;
               |SI FSalida = 0;
                    #1#12 =  #104#0; |PINTA #1#12;
               |SINO;
                    |ERROR;
               |FINSI;
               |CIERRA #104;
          |SINO;
               |SI #17#90 = "N";
                    |ABRE #101;
                    |ABRE #102;
                    |ABRE #103;
                    cFamilia = #0#19;
                    |QBF cFamilia;
                    |CONSULTA_F_CLAVE #4#101, MinConsul, MaxConsul;
                    |SI FSalida = 0;
                         cSubFamilia = #101#0;
                         |QBF cSubFamilia;
                         |CONSULTA_F_CLAVE #4#102, MinConsul, MaxConsul;
                         |SI FSalida = 0;
                              cCapitulo = #102#0;
                              |QBF cCapitulo;
                              |CONSULTA_F_CLAVE #4#103, MinConsul, MaxConsul;
                              |SI FSalida = 0;
                                   #1#3  = #103#0;
                                   #1#12 = #102#0;
                              |SINO;
                                   |ERROR;
                                   |ACABA;
                              |FINSI;
                         |SINO;
                              |ERROR;
                              |ACABA;
                         |FINSI;
                    |SINO;
                         |ERROR;
                         |ACABA;
                    |FINSI;
                    |CIERRA #101;
                    |CIERRA #102;
                    |CIERRA #103;
               |SINO;
                    |ABRE #102;
                    cSubFamilia = #0#19 + " "; |QBF cSubFamilia;
                    |CONSULTA_F_CLAVE #4#102, MinConsul, MaxConsul;
                    |SI FSalida = 0;
                         #1#3  = #102#0;
                         #1#12 = #102#0;
                    |SINO;
                         |ERROR;
                         |ACABA;
                    |FINSI;
                    |CIERRA #102;
               |FINSI;
          |FINSI;
     |FINSI;

     /* hemos dejado el capitulo en blanco y no dejamos continuar.*/

     |SI #1#12 = "                    ";
          |ERROR;
          |ACABA;
     |FINSI;

     /* se ha modificado el capitulo o es nuevo.*/

     |SI Contenido ! #1#12;
          |SI #17#32 = "H";
               |ABRE #104;
               #104#0 = #1#12;
               |LEE 000#104=;
               |SI FSalida ! 0;
                    |MENAV "0000EL CAPITULO INTRODUCIDO NO EXISTE";
                    |ERROR; |ACABA;
               |FINSI;
               #1#13 = #104#1;
               #1#3 = #1#12;
               |CIERRA #104;
               |PINTA #1#12;
               |PINTA #1#13;
               |HAZ DesAmp;
               |HAZ BusCap;
               |SI nError = 1;
                    nError = 0;
                    #1#12 = "";
                    |PINTA #1#12;
                    |ERROR;
                    |ACABA;
               |FINSI;
               |HAZ CambioCap;

               |SI nBorDes = 0;
                    |ERROR;
                    #1#12 = Contenido;
                    |PINTA #1#12;
                    |ACABA;
               |SINO;
                    #1#7=0;#1#8=0;#1#9=0;#1#10=0;#1#11=0;
                    |SI nModo = 2;
                         |GRABA 020#1a;
                    |FINSI;
                    |SI nSalida = 12; |O nSalida = 14;
                         |PTEC 802;
                    |FINSI;
                    |HAZ EntraParti;
               |FINSI;
          |SINO;
               |SI #1#3 = "                    ";
                    |ABRE #103;
                    cCapitulo = #1#12;
                    |QBF cCapitulo;
                    |CONSULTA_F_CLAVE #4#103, MinConsul, MaxConsul;

                    |SI FSalida = 0;
                         #1#3  = #103#0;
                    |SINO;
                         |ERROR;
                         |ACABA;
                    |FINSI;

                    |CIERRA #103;
               |FINSI;

               |ABRE #102;
               #102#0 = #1#12;
               |LEE 000#102=;

               |SI FSalida = 0;
                    #1#12 = #102#0;                    ||Codigo Captitulo.
                    #1#13 = #102#1;                    ||Descripcion de Familia.
                    |ABRE #103;
                    #103#0 = #1#3;
                    |LEE 000#103=;

                    |SI FSalida = 0;
                         #1#4 = #103#1;                ||Descripcion del Capitulo.
                    |FINSI;

                    |CIERRA #103;
                    |PINTA #1#12;
                    |PINTA #1#13;
                    |HAZ DesAmp;
               |SINO;
                    |MENAV "0000EL CAPITULO INTRODUCIDO NO EXISTE";
                    ||ERROR;
                    ||ACABA;
               |FINSI;

               |CIERRA #102;
               |HAZ BusCap;

               |SI nError = 1;
                    nError = 0;
                    #1#12 = "";
                    |PINTA #1#12;
                    |ERROR;
                    |ACABA;
               |FINSI;

               |HAZ CambioCap;

               |SI nBorDes = 0;
                    |ERROR;
                    #1#12 = Contenido;
                    |PINTA #1#12;
                    |ACABA;
               |SINO;
                    #1#7=0;#1#8=0;#1#9=0;#1#10=0;#1#11=0;

                    |SI nModo = 2;
                         |GRABA 020#1a;
                    |FINSI;

                    |SI nSalida = 12; |O nSalida = 14;
                         |PTEC 802;
                    |FINSI;

                    |HAZ EntraParti;

                    |SI nModo = 1;
                         ||PTEC 802; |PTEC 802; |PTEC 802;
                    |FINSI;

               |FINSI;
          |FINSI;
     |FINSI;

     |HAZ Oculta;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO MinParCap;
     #2#0 = #0#0;                                 ||Serie Pres.
     #2#1 = #0#1;                                 ||Nº. Pres.
     #2#2 = #1#12;                                ||Capitulo.
     #2#3 = 1;                                    ||Linea.
|FPRC;
-----------------------------------------------------------------------------
|PROCESO MaxParCap;
     #2#0 = #0#0;                                 ||Serie Pres.
     #2#1 = #0#1;                                 ||Nº. Pres.
     #2#2 = #1#12;                                ||Capitulo.
     #2#3 = 999;                                  ||Linea.
|FPRC;
-----------------------------------------------------------------------------
|PROCESO CalLinCap; |TIPO 0;
     #1#9 = (#1#6*#1#7);                          ||Importe Venta.
     #1#10 = (#1#6*#1#8);                         ||Importe Coste.
     |SI #0#42 = "+";
          #1#11 = ((#1#7-#1#8)/#1#8)*100;         ||Calcula el Incremento.
     |SINO;
          #1#11 = (1 - (#1#8/#1#7))*100;
     |FINSI;

     |PINTA #1#11;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO MiraCertiPar;
     |SI #2#14 ! 0;
          |MENAV "0000Capitulo con unidades de partidas certificadas";
          nError = 1;
     |FINSI;
|FPRC;

|DEFBUCLE MiraCertiPar;
     #2#1;
     ;
     #1#0, #1#1, #1#12, 001;
     #1#0, #1#1, #1#12, 999;
     ;
     NULL, MiraCertiPar;
|FIN;

|PROCESO TotCabCap; |TIPO 2;       || LINEAS
     nForma = 0 +. 1;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 3; |Y nSwBorra = 0;
          |SI nForma = -1;
               nError = 0;
               |BUCLE MiraCertiPar;
               |SI nError = 1; |ERROR; |ACABA; |FINSI;
               |CONFI "2400NDesea dar de baja la linea";
               |SI FSalida ! 0;
                    |ERROR; |ACABA;
               |FINSI;
          |FINSI;
     |FINSI;

     |HAZ EstPre;
     |SI cMensa ! ""; |Y nSwBorra = 0;
          |ERROR;
          |ACABA;
     |FINSI;

     |SI nForma = 1;
          |HAZ TotalCapi;     || Recalcula totales capitulo
     |FINSI;
/*
     |SI #1#15 = "S";    ||Exento
          #0#50 = #0#50 +. #1#9;
     |SINO;
          #0#51 = #0#51 +. #1#9;                  ||Total Venta.
     |FINSI;
*/
     |SI #1#15 = "S"; |O #1#17 = 0;
          #0#50 = #0#50 +. #1#9;
     |SINO;
          nCampo = 58 - 1 + #1#17;
          #0nCampo = #0nCampo +. #1#9;
          #0#51 = #0#58 + #0#59 + #0#60 + #0#61 + #0#62;
     |FINSI;

     #0#6 = #0#6 +. #1#10;                        ||Total Coste.
     |HAZ Totales1;

     |HAZ PintaTotales1;
     |HAZ Tipo13;
|FPRC;

|RUTINA Totales1;
     #0#5 = #0#50 + #0#51;

/*
     #0#21 = #0#5 - #0#6 + #0#28;                 ||Margen.
     nDto  = (#0#51 % #0#43) ! nDeci_TTrab;
     nDtoE = (#0#50 % #0#43) ! nDeci_TTrab;
     #0#44 = nDto + nDtoE;

     nTotal = (#0#51 - nDto) ! nDeci_TTrab;
     nTotalE = (#0#50 - nDtoE) ! nDeci_TTrab;

     nGas  = (nTotal % #0#26)  ! nDeci_TTrab;
     nBen  = (nTotal % #0#27)  ! nDeci_TTrab;
     nGasE = (nTotalE % #0#26) ! nDeci_TTrab;
     nBenE = (nTotalE % #0#27) ! nDeci_TTrab;
     #0#31 = nGas + nGasE;
     #0#32 = nBen + nBenE;

     nTotal = nTotal + nGas + nBen;
     nTotalE = nTotalE + nGasE + nBenE;

     nBaja = (nTotal % #0#28)  ! nDeci_TTrab;
     nBajaE = (nTotalE % #0#28) ! nDeci_TTrab;
     #0#33 = nBaja + nBajaE;

     nTotal = nTotal - nBaja;
     nTotalE = nTotalE - nBajaE;

     #0#34 = (nTotal % #0#29);

     #0#35 = nTotal + #0#34 + nTotalE;
*/

     #0#21 = #0#5 - #0#6;                 ||Margen.
     nCampo = 68;
     efFiva = #0#4;
     |PARA enTiva = 1; |SI enTiva [ 5; |HACIENDO enTiva = enTiva + 1;
          |HAZ SacaIVA;
          #0nCampo = enIva;
          nCampo = nCampo + 1;
     |SIGUE;
     enTiva = #0#57;
     |HAZ SacaIVA;
     #0#29 = enIva;

     nDto1  = (#0#58 % #0#43) ! nDeci_TTrab;
     nDto2  = (#0#59 % #0#43) ! nDeci_TTrab;
     nDto3  = (#0#60 % #0#43) ! nDeci_TTrab;
     nDto4  = (#0#61 % #0#43) ! nDeci_TTrab;
     nDto5  = (#0#62 % #0#43) ! nDeci_TTrab;
     nDtoE = (#0#50 % #0#43) ! nDeci_TTrab;
     #0#44 = nDto1 + nDto2 + nDto3 + nDto4 + nDto5 + nDtoE;

     nTotal1 = (#0#58 - nDto1) ! nDeci_TTrab;
     nTotal2 = (#0#59 - nDto2) ! nDeci_TTrab;
     nTotal3 = (#0#60 - nDto3) ! nDeci_TTrab;
     nTotal4 = (#0#61 - nDto4) ! nDeci_TTrab;
     nTotal5 = (#0#62 - nDto5) ! nDeci_TTrab;
     nTotalE = (#0#50 - nDtoE) ! nDeci_TTrab;

     nGas1 = (nTotal1 % #0#26)  ! nDeci_TTrab;
     nGas2 = (nTotal2 % #0#26)  ! nDeci_TTrab;
     nGas3 = (nTotal3 % #0#26)  ! nDeci_TTrab;
     nGas4 = (nTotal4 % #0#26)  ! nDeci_TTrab;
     nGas5 = (nTotal5 % #0#26)  ! nDeci_TTrab;
     nGasE = (nTotalE % #0#26) ! nDeci_TTrab;

     nBen1 = (nTotal1 % #0#27)  ! nDeci_TTrab;
     nBen2 = (nTotal2 % #0#27)  ! nDeci_TTrab;
     nBen3 = (nTotal3 % #0#27)  ! nDeci_TTrab;
     nBen4 = (nTotal4 % #0#27)  ! nDeci_TTrab;
     nBen5 = (nTotal5 % #0#27)  ! nDeci_TTrab;
     nBenE = (nTotalE % #0#27) ! nDeci_TTrab;

     #0#31 = nGas1 + nGas2 + nGas3 + nGas4 + nGas5 + nGasE;
     #0#32 = nBen1 + nBen2 + nBen3 + nBen4 + nBen5 + nBenE;

     nTotal1 = nTotal1 + nGas1 + nBen1;
     nTotal2 = nTotal2 + nGas2 + nBen2;
     nTotal3 = nTotal3 + nGas3 + nBen3;
     nTotal4 = nTotal4 + nGas4 + nBen4;
     nTotal5 = nTotal5 + nGas5 + nBen5;
     nTotalE = nTotalE + nGasE + nBenE;

     nBaja1 = (nTotal1 % #0#28)  ! nDeci_TTrab;
     nBaja2 = (nTotal2 % #0#28)  ! nDeci_TTrab;
     nBaja3 = (nTotal3 % #0#28)  ! nDeci_TTrab;
     nBaja4 = (nTotal4 % #0#28)  ! nDeci_TTrab;
     nBaja5 = (nTotal5 % #0#28)  ! nDeci_TTrab;
     nBajaE = (nTotalE % #0#28) ! nDeci_TTrab;

     #0#33 = nBaja1 + nBaja2 + nBaja3 + nBaja4 + nBaja5 + nBajaE;

     nTotal1 = nTotal1 - nBaja1;
     nTotal2 = nTotal2 - nBaja2;
     nTotal3 = nTotal3 - nBaja3;
     nTotal4 = nTotal4 - nBaja4;
     nTotal5 = nTotal5 - nBaja5;
     nTotalE = nTotalE - nBajaE;

     #0#63 = (nTotal1 % #0#68);
     #0#64 = (nTotal2 % #0#69);
     #0#65 = (nTotal3 % #0#70);
     #0#66 = (nTotal4 % #0#71);
     #0#67 = (nTotal5 % #0#72);
     #0#34 = #0#63 +  #0#64 + #0#65 + #0#66 + #0#67;

     #0#35 = nTotal1 + nTotal2 + nTotal3 + nTotal4 + nTotal5 + #0#34 + nTotalE;
||--
     #0#54 = #0#5-#0#33+#0#31+#0#32-#0#44-#0#6;|| Margen Total
     #0#53 = #0#54 * 100 / #0#6;
|FRUT;

|RUTINA PintaTotales1;
     |PINTA #0#5;
     |PINTA #0#6;
     |PINTA #0#21;
     |PINTA #0#53;
     |PINTA #0#54;
     |PINTA #0#44;

     |PINTA #0#31;
     |PINTA #0#32;
     |PINTA #0#33;
     |PINTA #0#34;
     |PINTA #0#35;
     |PINTA #0#53;
|FRUT;
-----------------------------------------------------------------------------
|PROCESO VentComp; |TIPO 20;
     |HAZ Oculta;
     nModo = (FEntrada/100)!0;
     |SI FSalida = "OPCION";
          FSalida = "Opciones";
          |ACABA;
     |FINSI;
     |LEE 000#0=;
     |SI FSalida ! 0;
          |MENAV "0000TIENE QUE SELECCIONAR PRIMERO UNA FICHA";
          |ACABA;
     |FINSI;

     |MENU aUtil;

     |SI FSalida [ 0;
          |ACABA;
     |FINSI;

     |SI FSalida = 1;
          |HAZ MiraLogos; || Copia Logos para el Crystal
          swCrystal = 0;
          aDestino = "C:\controlcrystal.txt";
          |XABRE "CE", aDestino, nCanal;
          swImpresion = FSalida;
          |SI swImpresion < 0;         || FSalida = 0: no existe
               |HAZ ImpParDsinf;
          |SINO;
               swCrystal = 1;
               |HAZ ImpCrystal;
          |FINSI;
          |XCIERRA nCanal;
     |FINSI;

     |SI FSalida = 2;
          cEstado = "Venta";
          |C_V #1#11, 1, "S";
          |C_V #1#7,  1, "S";
          |C_V #1#10,  1, "N";

          |C_V #2#8, 1, "S";
          |C_V #2#10,1, "S";                      ||Importe Venta Par.
          |C_V #2#12,1, "S";
          |C_V #2#9, 1, "N";
          |C_V #2#11,1, "N";                      ||Importe Coste.
          |PINPA #0#0;
          |PINDA #0#0;
     |FINSI;

     |SI FSalida = 3;
          cEstado = "Compra";
          |C_V #1#11, 1, "N";                     ||Incremento Cap.
          |C_V #1#7,  1, "N";
          |C_V #1#10, 1, "S";                     ||Importe Coste Cap.

          |C_V #2#8, 1, "N";
          |C_V #2#10,1, "N";                      ||Importe Venta Par.
          |C_V #2#12,1, "N";
          |C_V #2#9, 1, "S";
          |C_V #2#11,1, "S";                      ||Importe Coste Par.
          |PINPA #0#0;
          |PINDA #0#0;
     |FINSI;

     |SI FSalida = 4;
          |ABRE #17; |LEE 000#17p; |CIERRA #17;
          nCosInd = #0#55;
          aAlfa = "|NC";
          nCampos = #6#aAlfa#;
          |PARA i = 0; |SI i < nCampos; |HACIENDO i = i + 1;
               #6i = #0i;
          |SIGUE;
          |PUSHV 01012380;
          |CLS;
          |PINPA #0#6;
          |SI #17#139 = "S";
               |C_V #6#29, 1, "N";
               |C_V #6#57, 1, "N";
               |PINTA 2203, "                  ";
          |FINSI;
          |PINDA #0#6;
          |ENDATOS #2#6;
          |SI FSalida = 0;
               |PARA i = 0; |SI i < nCampos; |HACIENDO i = i + 1;
                    #0i = #6i;
               |SIGUE;
               |GRABA 020#0a;
               |SI nCosInd ! #0#55;
                    |POPV;
                    |HAZ CosteInd;
                    |PUSHV;
               |FINSI;
          |FINSI;
          |POPV;
          |PINTA #0#21;
          |PINTA #0#31;
          |PINTA #0#32;
          |PINTA #0#33;
          |PINTA #0#34;
          |PINTA #0#35;
     |FINSI;

     |SI FSalida = 5;
           eaSerie = #0#0;
           eaCodigo = #0#1;
           cDesc = #0#3;
           |SUB_EJECUTA_NP "gopue003";
     |FINSI;
     |SI FSalida = 6;    ||Chequeo
          eaSer = #0#0;
          enNum = #0#1;
          |SUB_EJECUTA_NP "guerz020";
          |LEE 000#0=;
          |HAZ PintaTotales1;
     |FINSI;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO BajaDesg;
     |BORRA 020#4a;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO BajaMedi;
     |BORRA 020#20a;
|FPRC;
-----------------------------------------------------------------------------
|DEFBUCLE BajaComp;
     #4#1;
     ;
     #2#0, #2#1, #2#2, #2#4,   1;
     #2#0, #2#1, #2#2, #2#4, 999;
     ;
     NULL, BajaDesg;
|FIN;
-----------------------------------------------------------------------------
|DEFBUCLE BajaMedi;
     #20#1;
     ;
     #2#0, #2#1, #2#2, #2#4,   1;
     #2#0, #2#1, #2#2, #2#4, 999;
     ;
     NULL, BajaMedi;
|FIN;
-----------------------------------------------------------------------------
|PROCESO BajaComp;
     |BUCLE BajaComp;
     |BUCLE BajaMedi;
     |BORRA 020#2a;
|FPRC;
-----------------------------------------------------------------------------
|DEFBUCLE BajaPart;
     #2#1;
     ;
     #1#0, #1#1, #1#12, 1;
     #1#0, #1#1, #1#12, 999;
     ;
     NULL, BajaComp;
|FIN;
-----------------------------------------------------------------------------
|PROCESO DesAmpSuCap0; |TIPO 0;
     |SI FSalida = 10;
          |HAZ DesAmpSuCap;
          |ERROR;
     |FINSI;
|FPRC;

|PROCESO DesAmpSuCap11; |TIPO 11;
     |HAZ DesAmpSuCap0;
|FPRC;

|PROCESO Min11;
     #11#0 = #0#0;
     #11#1 = #0#1;
     #11#2 = 1;
|FPRC;

|PROCESO Max11;
     #11#0 = #0#0;
     #11#1 = #0#1;
     #11#2 = 999;
|FPRC;

|PROCESO Min23;
     #23#0 = #0#0;
     #23#1 = #0#1;
     #23#2 = 1;
|FPRC;

|PROCESO Max23;
     #23#0 = #0#0;
     #23#1 = #0#1;
     #23#2 = 99;
|FPRC;

|PROCESO DesAmpCap; |TIPO 11;
     nModo = (FEntrada / 100) ! 0;

     eaCodigo = #1#12;
     cDesc    = #1#13;
     eaSerie  = #1#0;
     eaNumero = #1#1;

     |BLIN 4;
     |SI FSalida = 9;
          |HAZ ImpoIve;
          |ACABA;
     |FINSI;

     |SI FSalida = 10;
          |ESTADO_CONTROL nBotAmpli, "HIDE"; 
          |ESTADO_CONTROL nBotPorce, "HIDE";
          |ESTADO_CONTROL nBotSuCap, "HIDE";
          |ESTADO_CONTROL nBotAgp, "HIDE";
          |ESTADO_CONTROL nBotReCap, "HIDE";
          cNivel  = "CAP";
          cCapitulo = #1#12;
          cDesCapit = #1#13;
          cSerie  = #0#0;
          nNumero = #0#1;

          |SI cEstado = "Venta";
               nImporte = #1#9;
          |SINO;
               nImporte = #1#10;
          |FINSI;

          |SUB_EJECUTA_NP "gopre005";
          |ESTADO_CONTROL nBotAmpli, "SHOW";
          |ESTADO_CONTROL nBotPorce, "SHOW";
          |ESTADO_CONTROL nBotSuCap, "SHOW";
          |ESTADO_CONTROL nBotAgp, "SHOW";
          |HAZ HabiSubcap;
          |ESTADO_CONTROL nBotReCap, "SHOW";
          |ERROR;
          |ACABA;
     |FINSI;
     |SI FSalida = 13; |Y #0#49 = "S";   ||F5
          |ESTADO_CONTROL nBotAmpli, "HIDE";
          |ESTADO_CONTROL nBotPorce, "HIDE";
          |ESTADO_CONTROL nBotSuCap, "HIDE";
          |ESTADO_CONTROL nBotAgp, "HIDE";
          |ESTADO_CONTROL nBotReCap, "HIDE";

          |PUSHV 0501 2380;
          |BLANCO 1122 2059;
          |ESTADO_CONTROL nBotAmCap, "SHOW";
          |ENTLINEAL #1#11, 3, nModo, 19, 1, Min11, Max11;
          |ESTADO_CONTROL nBotAmCap, "HIDE";
          |POPV;
          |ESTADO_CONTROL nBotAmpli, "SHOW";
          |ESTADO_CONTROL nBotPorce, "SHOW";
          |ESTADO_CONTROL nBotSuCap, "SHOW";
          |ESTADO_CONTROL nBotAgp, "SHOW";
          |ESTADO_CONTROL nBotReCap, "SHOW";
          |HAZ HabiSubcap;
          |ERROR;
          |ACABA;
     |FINSI;
     |SI FSalida = 14; |Y #0#56 = "S";   ||F6
          |ESTADO_CONTROL nBotAmpli, "HIDE";
          |ESTADO_CONTROL nBotPorce, "HIDE";
          |ESTADO_CONTROL nBotSuCap, "HIDE";
          |ESTADO_CONTROL nBotAgp, "HIDE";
          |ESTADO_CONTROL nBotReCap, "HIDE";

          |PUSHV 0501 2380;
          |BLANCO 1122 2058;
          |ENTLINEAL #1#23, 3, nModo, 19, 1, Min23, Max23;
          |POPV;

          |ESTADO_CONTROL nBotAmpli, "SHOW";
          |ESTADO_CONTROL nBotPorce, "SHOW";
          |ESTADO_CONTROL nBotSuCap, "SHOW";
          |ESTADO_CONTROL nBotAgp, "SHOW";
          |ESTADO_CONTROL nBotReCap, "SHOW";
          |HAZ HabiSubcap;
          |ERROR; |ACABA;
     |FINSI;

     |SI FSalida = 15;
          |ESTADO_CONTROL nBotAmpli, "HIDE";
          |ESTADO_CONTROL nBotPorce, "HIDE";
          |ESTADO_CONTROL nBotSuCap, "HIDE";
          |ESTADO_CONTROL nBotAgp, "HIDE";
          |ESTADO_CONTROL nBotReCap, "HIDE";
          |HAZ Renumera;
          |ESTADO_CONTROL nBotAmpli, "SHOW"; 
          |ESTADO_CONTROL nBotPorce, "SHOW"; 
          |ESTADO_CONTROL nBotSuCap, "SHOW";
          |HAZ HabiSubcap;
          |ESTADO_CONTROL nBotReCap, "SHOW";
          |ERROR;
          |ACABA;
     |FINSI;

     |SI FSalida = 16;
          |ESTADO_CONTROL nBotAmpli, "HIDE"; 
          |ESTADO_CONTROL nBotPorce, "HIDE"; 
          |ESTADO_CONTROL nBotSuCap, "HIDE";
          |ESTADO_CONTROL nBotAgp, "HIDE";
          |ESTADO_CONTROL nBotReCap, "HIDE";
          eaCapi = "";
          |HAZ Ampliada;
          |ESTADO_CONTROL nBotAmpli, "SHOW"; 
          |ESTADO_CONTROL nBotPorce, "SHOW"; 
          |ESTADO_CONTROL nBotSuCap, "SHOW";
          |ESTADO_CONTROL nBotAgp, "SHOW";
          |HAZ HabiSubcap;
          |ESTADO_CONTROL nBotReCap, "SHOW";
          |ERROR;
          |ACABA;
     |FINSI;

     |HAZ Oculta;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO ImpCapi;
     nAlgo = 1;
     |PRINT;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO ImpDesPar;
     alfa1 = #4#14;
     |QBF alfa1;
     |SI alfa1 = ""; #4#14 = "S"; |FINSI;
     |PRINT;
|FPRC;
-----------------------------------------------------------------------------
|DEFBUCLE ImpDesPar;
     #4#1;
     ;
     #0#0, #0#1, "                    ", "                   ",   1;
     #0#0, #0#1, "zzzzzzzzzzzzzzzzzzzz", "zzzzzzzzzzzzzzzzzzz", 999;
     ;
     NULL, ImpDesPar;
|FIN;
-----------------------------------------------------------------------------
|DEFBUCLE ImpAnex;
     #200#1;
     ;                                          ||Campos Extras.
     #0#0, #0#1,   1;
     #0#0, #0#1, 999;
     ;                                          ||b/e Bolqueo-Ordenacion.
     NULL, ImpCapi;
|FIN;
-------------------------------------------------------------------------------
|DEFBUCLE ImpAnex2;
     #222#1;
     ;                                          ||Campos Extras.
     1, 1,   1;
     1, 1, 999;
     ;                                          ||b/e Bolqueo-Ordenacion.
     NULL, ImpCapi;
|FIN;
-------------------------------------------------------------------------------
|DEFBUCLE ImpParMed;
     #20#1;
     ;                                          ||Campos Extras.
     #0#0, #0#1, "                    ", "                    ",   1;
     #0#0, #0#1, "zzzzzzzzzzzzzzzzzzzz", "zzzzzzzzzzzzzzzzzzzz", 999;
     ;                                          ||b/e Bolqueo-Ordenacion.
     NULL, ImpCapi;
|FIN;
-----------------------------------------------------------------------------
|PROCESO Gomarcas;
     alfa1 = #203#0;
     |QBF alfa1;
     |SI alfa1 = ""; #203#0 = "S"; #203#1 = "SIN NATURALEZA"; |FINSI;
     |PRINT;
|FPRC;
-------------------------------------------------------------------------------
|DEFBUCLE Gomarcas;
     #203#1;
     ;                                          ||Campos Extras.
     "   ";
     "zzz";
     ;                                          ||b/e Bolqueo-Ordenacion.
     NULL, Gomarcas;
|FIN;
-------------------------------------------------------------------------------
|DEFBUCLE gopre022;
     #gopre022#1;
     ;
     #0#0, #0#1, 001, 001;
     #0#0, #0#1, 999, 999;
     ;
     NULL, ImpCapi;
|FIN;

|PROCESO AnyadeCero;
     #gopre021#0 = #0#0;
     #gopre021#1 = #0#1;
     #gopre021#2 = 999;
     #gopre021#3 = "Sin Agrupacion";
     |PRINT;
|FPRC;
-------------------------------------------------------------------------------
|DEFBUCLE gopre021;
     #gopre021#1;
     ;
     #0#0, #0#1, 001;
     #0#0, #0#1, 999;
     ;
     NULL, ImpCapi, , ,AnyadeCero;
|FIN;
-------------------------------------------------------------------------------
|PROCESO gopre100;
     |SI #gopre002#14 ! nCAPITULO_ANT; |O #gopre002#14 = 0;
          nSUBCAPITULO = 0;
          nCAPITULO = nCAPITULO + 1;
     |FINSI;
     |SI #gopre002#14 = 0;
          nSUBCAPITULO = 0;
     |SINO;
          nSUBCAPITULO = nSUBCAPITULO + 1;
     |FINSI;
     nCAPITULO_ANT = #gopre002#14;

     |PRINT;
|FPRC;

|DEFBUCLE gopre100;
     #gopre002#1;
     ;
     #0#0, #0#1, 001;
     #0#0, #0#1, 999;
     ;
     NULL, gopre100;
|FIN;
-------------------------------------------------------------------------------
|PROCESO ImpParDsinf;

     |SUB_EJECUTA_NP "goinform;IMPgoparcab";
     |SI nErrorInf = 1;
          |ACABA;
     |FINSI;
     |INFOR "goparcab";             ||AQUI
     |PRINT;
     |PIEINF;
     |FININF;
     |SUB_EJECUTA_NP "goinform;ENVgoparcab";

     |SUB_EJECUTA_NP "goinform;IMPgoparbas";
     |SI nErrorInf = 1;
          |ACABA;
     |FINSI;
     |INFOR "goparbas";             ||AQUI
     |PRINT;
     |PIEINF;
     |FININF;
     |SUB_EJECUTA_NP "goinform;ENVgoparbas";

     |SUB_EJECUTA_NP "goinform;IMPgoparca2";
     |SI nErrorInf = 1;
          |ACABA;
     |FINSI;
     |INFOR "goparca2";             ||AQUI
     |PRINT;
     |PIEINF;
     |FININF;
     |SUB_EJECUTA_NP "goinform;ENVgoparca2";

     |SUB_EJECUTA_NP "goinform;IMPgoparca3";
     |SI nErrorInf = 1;
          |ACABA;
     |FINSI;
     |INFOR "goparca3";             ||AQUI
     |ABRE #33;
     #33#0 = #0#2;
     #33#1 = #0#52;
     |LEE 000#33=;
     |CIERRA #33;
     |PRINT;
     |PIEINF;
     |FININF;

     |SUB_EJECUTA_NP "goinform;ENVgoparca3";

     |SUB_EJECUTA_NP "goinform;IMPgoparane";
     |INFOR "goparane";
     |PRINT;
     |PIEINF;
     |FININF;
     |SUB_EJECUTA_NP "goinform;ENVgoparane";

     |SUB_EJECUTA_NP "goinform;IMPgoparlin";
     |INFOR "goparlin";
     |BUCLELIN 2ImpParti#0;
     |PIEINF;
     |FININF;
     |SUB_EJECUTA_NP "goinform;ENVgoparlin";

     |SUB_EJECUTA_NP "goinform;IMPgoparli2";
     |INFOR "goparli2";
     |BUCLELIN 2ImpParti#0;
     |PIEINF;
     |FININF;
     |SUB_EJECUTA_NP "goinform;ENVgoparli2";

     |SUB_EJECUTA_NP "goinform;IMPgoparnex";
     nAlgo = 0;
     |INFOR "goparnex";
     |BUCLE ImpAnex;
     |SI nAlgo = 0;
          #gopue002#3 = ".";
          |PRINT;
     |FINSI;
     |PIEINF;
     |FININF;
     |SUB_EJECUTA_NP "goinform;ENVgoparnex";

     |SUB_EJECUTA_NP "goinform;IMPgoanexfi";
     nAlgo = 0;
     |INFOR "goanexfi";
     |BUCLE ImpAnex2;
     |SI nAlgo = 0;
          #goanexos#3 = ".";
          |PRINT;
     |FINSI;
     |PIEINF;
     |FININF;
     |SUB_EJECUTA_NP "goinform;ENVgoanexfi";

     |SUB_EJECUTA_NP "goinform;IMPgopardes";
     |INFOR "gopardes"
     |BUCLE ImpDesPar;
     |PIEINF;
     |FININF;
     |SUB_EJECUTA_NP "goinform;ENVgopardes";

     |SUB_EJECUTA_NP "goinform;IMPgoparmed";
     |INFOR "goparmed"
     |BUCLE ImpParMed;
     |PIEINF;
     |FININF;
     |SUB_EJECUTA_NP "goinform;ENVgoparmed";

     |SUB_EJECUTA_NP "goinform;IMPgomarcas";
     |INFOR "gomarcas"
     |BUCLE Gomarcas;
     |PIEINF;
     |FININF;
     |SUB_EJECUTA_NP "goinform;ENVgomarcas";

     |SUB_EJECUTA_NP "goinform;IMPgoempres";
     |INFOR "goempres";
     |PRINT;
     |PIEINF;
     |FININF;
     |SUB_EJECUTA_NP "goinform;ENVgoempres";

     |SUB_EJECUTA_NP "goinform;IMPgoparive";
     |ABRE #goartive;
     |INFOR "goparive";
     |BUCLELIN 2ImpParti#0;
     |PIEINF;
     |FININF;
     |CIERRA #goartive;
     |SUB_EJECUTA_NP "goinform;ENVgoparive";

     |SUB_EJECUTA_NP "goinform;IMPgopre021";
     |INFOR "gopre021";
     nAlgo = 0;
     |BUCLE gopre021;
     |SI nAlgo = 0;
          |HAZ AnyadeCero;
     |FINSI;
     |PIEINF;
     |FININF;
     |SUB_EJECUTA_NP "goinform;ENVgopre021";

     |SUB_EJECUTA_NP "goinform;IMPgopre022";
     |INFOR "gopre022";
     |BUCLE gopre022;
     |PIEINF;
     |FININF;
     |SUB_EJECUTA_NP "goinform;ENVgopre022";

     |SUB_EJECUTA_NP "goinform;IMPgopre100";
     |INFOR "gopre100";
     nCAPITULO = 0;
     nSUBCAPITULO = 0;
     |BUCLE gopre100;
     |PIEINF;
     |FININF;
     |SUB_EJECUTA_NP "goinform;ENVgopre100";

     |SUB_EJECUTA_NP "goinform;RUNPRESUPUESTOS";

|FPRC;
-----------------------------------------------------------------------------

|PROCESO ImpAnexoPre;
     nLaUltima = nLaUltima + 1;
     #511#0 = 1;
     #511#1 = 1;
     #511#2 = nLaUltima;
     #511#3 = #200#3;
     |GRABA 020#511n;
|FPRC;

|DEFBUCLE ImpAnexoPre;
     #200#1;
     ;                                          ||Campos Extras.
     #0#0, #0#1,   1;
     #0#0, #0#1, 999;
     ;                                          ||b/e Bolqueo-Ordenacion.
     NULL, ImpAnexoPre;
|FIN;

|PROCESO PorMedio;
     nLaUltima = #222#2;
     nLaUltima = nLaUltima + 1;
     #511#0 = 1;
     #511#1 = 1;
     #511#2 = nLaUltima;
     #511#3 = "";
     |GRABA 020#511n;
|FPRC;

|PROCESO ImpAnexoFij;
     |PARA nCampo = 0; |SI nCampo [ 3; |HACIENDO nCampo = nCampo + 1;
          #511nCampo = #222nCampo;
     |SIGUE;
     |GRABA 020#511n;
|FPRC;

|DEFBUCLE ImpAnexoFij;
     #222#1;
     ;                                          ||Campos Extras.
     1, 1,   1;
     1, 1, 999;
     ;                                          ||b/e Bolqueo-Ordenacion.
     NULL, ImpAnexoFij;
|FIN;

|PROCESO Copiadbf;
     |DFICE aFich;
     |QBF aFich;
     aPath = aFich + aAlfa + ".dbf";
     aAlfa1 = aAlfa % 101;
     |SI aAlfa1 = "c";
          aPath1 = aCrystalPath + "anexopre.dbf";
     |SINO;
          aPath1 = aCrystalPath + "anexofij.dbf";
     |FINSI;
     aIP = "";
     |IP_REMOTO aIP;
     |SI aIP = "";
          |COPIA_FICHERO aPath, aPath1;
     |SINO;
          |ENVIA_FICHERO aPath, aPath1;
     |FINSI;
|FPRC;

|PROCESO LosAnexos;
     aCrystalPath = "C:\ds\crystal\";

     aAlfa = Usuario;    |QBF aAlfa;    aAlfa = ("d" + aAlfa) % 108;
     |NOME_DAT #511 aAlfa;
     |DELINDEX #511;
     |ABRE #511;
     |BUCLE ImpAnexoFij;
     |HAZ PorMedio;
     |BUCLE ImpAnexoPre;
     |CIERRA #511;
     |HAZ Copiadbf;
/*
     aAlfa = Usuario;    |QBF aAlfa;    aAlfa = ("c" + aAlfa) % 108;
     |NOME_DAT #510 aAlfa;
     |DELINDEX #510;
     |ABRE #510;
     |BUCLE ImpAnexoPre;
     |CIERRA #510;
     |HAZ Copiadbf;
*/
|FPRC;

|PROCESO ImpCrystal;
     |IMPRE 0;
     |HAZ LosAnexos;
     |INFOR "gopresup";
     |BUCLELIN 2ImpParti#0;
     |PIEINF;
     |FININF;
     |FINIMP;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO ImpAmp;
     #goartive#0 = #gopre003#4;         || lee el maestro partidas para impri-
     |LEE 000#goartive.=;               || mir el PPI en el informe goparive
                                        || en el goparlin no tiene efecto
     |PRINT;
     nAmp2 = 1;
     |SI cAplica = "0";
         nAmp = 1;
     |FINSI;
|FPRC;
-----------------------------------------------------------------------------
|DEFBUCLE ImpAmp;
     #202#1;
     ;
     #2#4, #1#0, #1#1, #1#12,   1;
     #2#4, #1#0, #1#1, #1#12, 999;
     ;
     NULL, ImpAmp;
|FIN;
-----------------------------------------------------------------------------
|PROCESO ImpCapiCrys;
     #godeprel#4 = "";
     |PRINT;
|FPRC;
-----------------------------------------------------------------------------
|DEFBUCLE ImpParMedCrys;
     #20#1;
     ;                                          ||Campos Extras.
     #0#0, #0#1, #1#12, #2#4,   1;
     #0#0, #0#1, #1#12, #2#4, 999;
     ;                                          ||b/e Bolqueo-Ordenacion.
     NULL, ImpCapiCrys;
|FIN;
-----------------------------------------------------------------------------
|PROCESO ImpPartida;
     |SI #gopre002#14 = 0;
          #gopre002#14 = 999;
     |FINSI;

     aLinImpre = #gopre003#25;
     |QBF aLinImpre;
     |SI aLinImpre = "";
          aLinImpre = #gopre003#3;
     |SINO;
          aAlfa1 = aLinImpre % 101;
          |PARA; |SI aAlfa1 = "0"; |HACIENDO;
               aLinImpre = aLinImpre - "0";
               aAlfa1 = aLinImpre % 101;
          |SIGUE;
     |FINSI;
     aLinPartida = ("0000" + aLinImpre) % -104;

     |BUCLE ImpAmp;
     |SI cAplica = "0";
          nAmp = 2;
          |PRINT;
          nAmp = 0;
     |FINSI;
     |SI nAmp2 ! 1;
          #202#4 = "Sin descripcion"
          |PRINT;
     |FINSI;
     nAmp2 = 0;
     |SI swCrystal = 1;
          |BUCLE ImpParMedCrys;
     |FINSI;
|FPRC;
-----------------------------------------------------------------------------
|DEFBUCLE ImpPartida;
     #2#1;
     ;
     #0#0, #0#1, #1#12,   1;
     #0#0, #0#1, #1#12, 999;
     ;
     NULL,ImpPartida;
|FIN;
-----------------------------------------------------------------------------
|PROCESO ImpParti;
     |BUCLE ImpPartida;
     |SI cAplica = "0";
          FSalida = "PAGINA";
     |FINSI;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO MiraDsInf;
     |DDEF aDef;
     aDef = aDef + "goinform";
     |CARGA_DEF aDef, goinform@;
     |SI FSalida = 0;
          cUsuario = Usuario %810;
          |QBF cUsuario;
          |ABRE #7;
          #7#0 = cUsuario;
          |LEE 000#7=;
          |SI FSalida = 0;
               |SI #7#1 = "S";
                    cAplica = " ";
               |SINO;
                    cAplica = "0";
               |FINSI;
          |SINO;
               cAplica = "0";
          |FINSI;
          |CIERRA #7;

          |DESCARGA_DEF #goinform@;
     |FINSI;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO MiSu;
     |SI #2#22 > 0;
          cMensa = "0000EL CAPITULO ESTA SUBCONTRATADO";
     |FINSI;
|FPRC;
-------------------------------------------------------------------------------
|DEFBUCLE MiSu;
     #2#1;
     ;                                          ||Campos Extras.
     #1#0, #1#1, #1#12, 1;
     #1#0, #1#1, #1#12, 1;
     ;                                          ||b/e Bolqueo-Ordenacion.
     NULL, MiSu;
|FIN;
-------------------------------------------------------------------------------
|PROCESO EstPre;
     nModo = (FEntrada/100)!0;
     cMensa = "";

     |SI nModo = 3;

          |BUCLE MiSu;

          |SI cMensa ! "";
               |MENAV cMensa;
               |ERROR;
               |ACABA;
          |FINSI;

          |BUCLE BajaPart;
     |FINSI;

|FPRC;
------------------------------------------------------------------------------
|PROCESO Consu; |TIPO 0;
     nModo = (FEntrada/100)!0;
     |SI nModo = 4;
          |HAZ Oculta;
          |PUSHV 01012380;
          |ENTLINEAL #1#2, 4, nModo, 21, 1, MinParCap, MaxParCap;
          |ERROR;
          |POPV;
          Campo = 2;
          |HAZ B001;
          |ACABA;
     |FINSI;

     |HAZ Oculta;
|FPRC;
------------------------------------------------------------------------------
|PROCESO SinEscape; || Para el control de cierre
     |SI FSalida = 1; |ERROR; |ACABA; |FINSI;
|FPRC;

|PROCESO Porcien; |TIPO 0;
     ||ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄControl Cierre
     |ESTADO_CONTROL nBotPorci, "HIDE";
     efFecha = #0#4;
     |HAZ EstaCerrado;
     |SI FSalida = 0;
          |ESTADO_CONTROL nBotPorci, "SHOW";
          |ERROR; |ACABA;
     |FINSI;
     |ESTADO_CONTROL nBotPorci, "SHOW";
     ||ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ

     |HAZ Oculta;
     |SI FSalida = 10;
          cNivel  = "PRE";
          cSerie  = #0#0;
          nNumero = #0#1;
          |SI cEstado = "Venta";
               nImporte = #0#5;
          |SINO;
               nImporte = #0#6;
          |FINSI;
          |SUB_EJECUTA_NP "gopre005";
          |ERROR;
          |HAZ B001;
          |ACABA;
     |FINSI;
|FPRC;
------------------------------------------------------------------------------
|PROCESO ConPre; |TIPO 7;
     nModo = (FEntrada/100)!0;

     |SI nModo ! 1; |ACABA; |FINSI;

     |ABRE #321; |LEE 000#321p; |CIERRA #321;
     #0#7 = #321#9; |PINTA #0#7;


     |ABRE #17; |LEE 000#17p; |CIERRA #17;

     #0#57 = #17#140;    || Iva defecto


     |MENU menu;

     |SI FSalida = 1;    ||Automatico
          |ABRE #8;
          #8#0 = "vfacprof";
          #8#2 = #0#0;
          |LEE 101#8=;

          |SI FSalida = 0;
               #8#1 = #8#1 + 1;
               nConta = #8#1;
               |GRABA 021#8a;
               |PTEC 802;
          |SINO;
               nConta = 1;
               #8#1 = 1;
               |GRABA 021#8n;
          |FINSI;

          cConta = nConta;
          cConta = ("000000" + cConta) % -106;
          #0#1 = cConta;
          |PINTA #0#1;
          |LIBERA #8;
          |CIERRA #8;
     |FINSI;

|FPRC;
-----------------------------------------------------------------------------
|PROCESO CamPreCap7; |TIPO 7;
     nPreContenido = #1#7;
|FPRC;

|PROCESO CamPreCap; |TIPO 0;
     |SI #1#7 ! nPreContenido;
          |SI #1#7<#1#8;
               |MENAV "0000ESTA POR DEBAJO DEL COSTE";
               |ERROR;
               |ACABA;
          |FINSI;

          cMensaje = "0000SEL PRECIO A VARIADO. ¨DESEA AJUSTARLO? (S/N)";
          |CONFI cMensaje;
          |SI FSalida = 0;
               |HAZ AjusPrecCap;
               |SI nIncrem > 999.999;
                    |MENAV "0000ESTA SUPERANDO EL INCREMENTO PERMITIDO DE 999,999%";
                    #1#7 = nPreContenido;
                    |PINTA #1#7;
                    |ERROR;
                    |ACABA;
               |FINSI;
               nImporte = #1#7;
               |HAZ AjusteCapitulo;
               |PINTA #1#11;
          |SINO;
               #1#7 = nPreContenido;
               |PINTA #1#7;
               |ERROR;
          |FINSI;
     |FINSI;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO AjusPrecCap;
     nPreAct = #1#7;
     nTotDes = #1#8;                    ||Total de Partida.
     |SI #0#42 = "+";
          nIncrem = ((nPreAct-nTotDes)/nTotDes)*100; ||Calcula el Incremento.
     |SINO;
          nIncrem = (1 - (nTotDes/nPreAct))*100;
     |FINSI;
     nIncrem = nIncrem ! 4;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO EntraParti;
     |HAZ Oculta;
     nModo = (FEntrada/100)!0;
     |PUSHV 01012380;
     |ENTLINEAL #1#2, 4, nModo, 21, 1, MinParCap, MaxParCap;
     |POPV;
     |PINTA #1#7;|PINTA #1#8;

|FPRC;
-----------------------------------------------------------------------------
|PROCESO CambIncrCap7; |TIPO 7;
     nIncContenido = #1#11;
|FPRC;

|PROCESO CambIncrCap; |TIPO 0;
     |SI #1#11 ! nIncContenido;
          nIncrem = #1#11;
          cMensaje = "0000SEL INCREMENTO HA VARIADO ¨DESEA AJUSTARLO? (S/N)";
          |CONFI cMensaje;
          |SI FSalida = 0;
               |HAZ AjusteCapituloInc;
          |SINO;
               #1#11 = nIncContenido;
               |PINTA #1#11;
               |ERROR;
          |FINSI;
     |FINSI;
|FPRC;
------------------------------------------------------------------------------
|PROCESO BorraParDesc;
     |BORRA 020#4a;
|FPRC;
------------------------------------------------------------------------------
|PROCESO BorraParMedi;
     |BORRA 020#20a;
|FPRC;
------------------------------------------------------------------------------
|DEFBUCLE BorraParDesc;
     #4#1;
     ;
     #2#0, #2#1, #2#2, #2#4, 1;
     #2#0, #2#1, #2#2, #2#4, 999;
     ;
     NULL, BorraParDesc;
|FIN;
-----------------------------------------------------------------------------
|DEFBUCLE BorraMedPart;
     #20#1;
     ;
     #2#0, #2#1, #2#2, #2#4, 1;
     #2#0, #2#1, #2#2, #2#4, 999;
     ;
     NULL, BorraParMedi;
|FIN;
-----------------------------------------------------------------------------
|PROCESO BorraPart;
     |BUCLE BorraParDesc;
     |BUCLE BorraMedPart;
     |BORRA 020#2a;
|FPRC;
------------------------------------------------------------------------------
|DEFBUCLE BorraPart;
     #2#1;
     ;
     #1#0, #1#1, Contenido,   1;
     #1#0, #1#1, Contenido, 999;
     ;
     NULL, BorraPart;
|FIN;
------------------------------------------------------------------------------
|PROCESO CambioCap;
     nBorDes = 1;
     |QBF Contenido;
     |SI Contenido ! "";
          |CONFI "0000NSE ELIMINARAN TODOS LAS PARTIDAS ASI COMO DESCOMPUESTOS AL VARIAR EL CAPITULO";
          |SI FSalida = 0;
               |BUCLE BorraPart;
          |SINO;
               nBorDes = 0;
          |FINSI;
     |FINSI;
|FPRC;
------------------------------------------------------------------------------
|PROCESO Borgopre022;
     |BORRA 020#12a;
|FPRC;

|DEFBUCLE Borgopre022;
     #12#1;
     ;
     #11#0, #11#1, #11#2, 1;
     #11#0, #11#1, #11#2, 999;
     be;
     NULL, Borgopre022;
|FIN;

|PROCESO DesAmpSuCap2; |TIPO 2;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 3;
          |BUCLE Borgopre022;
     |FINSI;
|FPRC;

|PROCESO Borgopre021;
     |BUCLE Borgopre022;
     |BORRA 020#11a;
|FPRC;

|DEFBUCLE Borgopre021;
     #11#1;
     ;
     #0#0, #0#1, 1;
     #0#0, #0#1, 999;
     be;
     NULL, Borgopre021;
|FIN;

|PROCESO Borgopre023;
     |BORRA 020#11a;
|FPRC;

|DEFBUCLE Borgopre023;
     #23#1;
     ;
     #0#0, #0#1, 1;
     #0#0, #0#1, 999;
     be;
     NULL, Borgopre023;
|FIN;

|PROCESO Tipo1; |TIPO 1;
     nSwFlag = 0;
|FPRC;

|PROCESO MiraEsta; |TIPO 2;
     nModo = (FEntrada/100)!0;
     nForma = 0 +. 1;

     |SI nModo = 1; nSwFlag = 0; |FINSI;
     |SI nSwFlag = 1; |ACABA; |FINSI;

     |SI nModo = 2; |Y nForma < 0; |Y #goparame#52 = "S";
        |SI #gopre001#1 ] #goparame#58; |Y #gopre001#1 [ #goparame#59;
           |HAZ ModPresup;
           |LEE 000#gopre001.=;
        |SINO;
           |SI #gopre001#1 ] #goparame#56;
              #gopre001#1 = #gopre001#1 - #goparame#56;
              |HAZ ModPresup;
              |LEE 000#gopre001.=;
           |FINSI;
        |FINSI;
     |FINSI;

     |SI nModo = 1;
          aAlfa = Usuario;
          aAlfa = aAlfa % 0810;
          #0#38 = aAlfa;
     |FINSI;

     |SI nModo = 1;
          |C_M #0#7,  1, "S";
          |C_M #0#24, 1, "S";
          |C_M #0#25, 1, "S";
     |SINO;
          |C_M #0#7,  1, "N";
          |C_M #0#24, 1, "N";
          |C_M #0#25, 1, "N";
     |FINSI;

     |SI nModo = 2; |O nModo = 3;
          |ABRE #17; |LEE 000#17p; |CIERRA #17;
          |SI #0#17 ! " "; |Y nSwGoman = 0; |Y nForma = -1;
               |MODULO aAlfa;
               |SI aAlfa = "gopre001";
                    cMensaje = #0#15+"\"+#0#16;
                    |QBF cMensaje;
                    cMensaje = "0000ESTE PRESUPUESTO ESTA ASIGNADO A UN EXPEDIENTE                 ( "+cMensaje+" )";
                    |MENAV cMensaje;
                    |SI #17#52 = "S";   ||Duplicar
                         nSwFlag = 1;
                         |ERROR; |ACABA;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;

     |SI nModo = 3;
          |BUCLE Borgopre021;
     |FINSI;

     nSwBorra = 0;
     |SI nModo = 3;
          |ABRE #80;
          |LEE 000#80u;
          |SI FSalida = 0;
               #80#0 = #80#0 + 1;
          |SINO;
               #80#0 = 1;
          |FINSI;
          #80#1 = #0#0;
          #80#2 = #0#1;
          #80#3 = ~;
          |HORA aAlfa;
          #80#4 = aAlfa;
          aAlfa = Usuario % 810;
          #80#5 = aAlfa;
          #80#6 = "P";
          |GRABA 020#80n;
          |CIERRA #80;
          nSwBorra = 1;
     |FINSI;
|FPRC;
------------------------------------------------------------------------------
|PROCESO AbreFiebdc; |TIPO 8;
     |ABRE #17; |LEE 000#17p; |CIERRA #17; || Parametros
     nDeci_Meda = #17#115;

     nAntNum = -1;
     aAlfa = PARAMETRO; |QBF aAlfa;
     |SI aAlfa = "";
        aDesdeFuera = "N";
     |SINO;
        aDesdeFuera = "S";
     |FINSI;

     |CLS;
     |CONTROL_SIMPLE 0, "BOTON,F2 -Descripción Ampliada.", 2430, 2450, F2001;
     nBotAmCap = FSalida;
     |ESTADO_CONTROL nBotAmCap, "HIDE";

     |CONTROL_SIMPLE 0, "BOTON,F2 -Porcentajes por Tipo.", 2425, 2455, F2001;
     nBotPorci = FSalida;
     |ESTADO_CONTROL nBotPorci, "HIDE";
||*
     |CONTROL_SIMPLE 0, "BOTON,F2 - Porcentaje Tipo", 2402, 2416, F2001;
     nBotPorce = FSalida;
     |ESTADO_CONTROL nBotPorce, "HIDE";

     |CONTROL_SIMPLE 0, "BOTON,F5 - Agr. Capitulos", 2418, 2432, F5001;
     nBotSuCap = FSalida;
     |ESTADO_CONTROL nBotSuCap, "HIDE";

     |CONTROL_SIMPLE 0, "BOTON,F6 - Agr. Principal", 2434, 2448, F6001;
     nBotAgp = FSalida;
     |ESTADO_CONTROL nBotAgp, "HIDE";

     |CONTROL_SIMPLE 0, "BOTON,F7 - Renum. Capitulos", 2450, 2464, F5001;
     nBotReCap = FSalida;
     |ESTADO_CONTROL nBotReCap, "HIDE";

     |CONTROL_SIMPLE 0, "BOTON,F8 - Des. Ampliada", 2466, 2480, F8001;
     nBotAmpli = FSalida;
     |ESTADO_CONTROL nBotAmpli, "HIDE";

||*
     |CONTROL_SIMPLE 0, "BOTON,F3 - Partidas", 2405, 2415, F3001;
     nBotParti = FSalida;
     |ESTADO_CONTROL nBotParti, "HIDE";

     |CONTROL_SIMPLE 0, "BOTON,F4 - Busqueda Indice", 2420, 2435, F4001;
     nBotIndic = FSalida;
     |ESTADO_CONTROL nBotIndic, "HIDE"; 

     |CONTROL_SIMPLE 0, "BOTON,F5 - Busqueda Selectiva", 2440, 2455, F5001;
     nBotSelec = FSalida;
     |ESTADO_CONTROL nBotSelec, "HIDE";

     |CONTROL_SIMPLE 0, "BOTON,F6 - Busqueda General", 2460, 2475, F6001;
     nBotGener = FSalida;
     |ESTADO_CONTROL nBotGener, "HIDE"; 

     |MODULO cModulo;

     |SI cModulo = "gopre001";
          |HAZ CargaIve;
     |FINSI;

     |HAZ OcultaIVAE;
|FPRC;
------------------------------------------------------------------------------
|PROCESO CierraFiebdc; |TIPO 9;
     |PULSATECLA;
     |FIN_CONTROL_WINDOWS nBotAmCap;
     |PULSATECLA;
     |FIN_CONTROL_WINDOWS nBotPorci;
     |PULSATECLA;
     |FIN_CONTROL_WINDOWS nBotPorce;
     |PULSATECLA;
     |FIN_CONTROL_WINDOWS nBotAmpli;
     |PULSATECLA;
     |FIN_CONTROL_WINDOWS nBotParti;
     |PULSATECLA;
     |FIN_CONTROL_WINDOWS nBotIndic;
     |PULSATECLA;
     |FIN_CONTROL_WINDOWS nBotSelec;
     |PULSATECLA;
     |FIN_CONTROL_WINDOWS nBotGener;
     |PULSATECLA;
     |FIN_CONTROL_WINDOWS nBotSuCap;
     |FIN_CONTROL_WINDOWS nBotAgp;
     |PULSATECLA;
     |FIN_CONTROL_WINDOWS nBotReCap;
     |PULSATECLA;
     |FIN_CONTROL_WINDOWS nBotCliGe;
     |PULSATECLA;
     |FIN_CONTROL_WINDOWS nBotCliPo;
     |PULSATECLA;

     |MODULO cModulo;

     |SI cModulo = "gopre001";
          |HAZ LiberaIve;
     |FINSI;


|FPRC;
------------------------------------------------------------------------------
|PROCESO DesAmp;
     |ABRE #18;
     #18#0 = #1#12;
     #18#1 = #1#13;
     |LEE 000#18=;
     |SI FSalida ! 0;
          |GRABA 020#18c;
          |ABRE #5;
          |DDEFECTO #5;
          #5#0 = #18#0;
          #5#1 = 1;
          #5#2 = #1#13;
          |GRABA 020#5c;
          |CIERRA #5;
     |FINSI;
     |GRABA 020#18a;
     |CIERRA #18;
|FPRC;
------------------------------------------------------------------------------
|PROCESO BusCap;
     nError = 0;
     |SALVA_FICHA #1;
     |SELECT #6#1;
     |LEE 000#1=;
     |SI FSalida = 0;
          |MENAV "0000EL CAPITULO YA ESTA INCLUIDO EN ESTE PRESUPUESTO";
          nError = 1;
     |FINSI;
     |SELECT #1#1;
     |REPON_FICHA #1;
|FPRC;
-------------------------------------------------------------------------------
|PROCESO PintDesc; |TIPO 7;
     cCodAct = #1#12;
     cDescr = #1#13;
|FPRC;
-------------------------------------------------------------------------------
|PROCESO Barra01; |TIPO 5;
     FSalida = "SINBARRA";
|FPRC;
-------------------------------------------------------------------------------
|PROCESO CambioDes; |TIPO 0;
     |ABRE #17;
     #17#0 = "A";
     |LEE 000#17=;

     |SI FSalida = 0;

          |SI Contenido ! #1#13; |Y #17#27 = "S";
               |CONFI "0000SDese establecer el nuevo concepto en el banco de datos?";

               |SI FSalida = 0;
                    |ABRE #102;
                    #102#0 = #1#12;
                    |LEE 101#102=;

                    |SI FSalida = 0;
                         #102#1 = #1#13;
                         |GRABA 020#102a;
                    |FINSI;

                    |SUB_EJECUTA_NP "goindice;CREA";
                    |LIBERA #102;
                    |CIERRA #102;
               |FINSI;

          |FINSI;

     |FINSI;

|FPRC;
-------------------------------------------------------------------------------
|PROCESO Renumera;
     cSerie = #0#0;
     nNumero = #0#1;
     |SUB_EJECUTA_NP "goprenum";
     |PTEC 806;
|FPRC;
-------------------------------------------------------------------------------
|PROCESO B001; |TIPO 7;
     nModo = (FEntrada / 100) ! 0;
     |SI Campo = 2;
          |SI nModo = 1;
               #1#17 = #0#57; || Iva defecto
          |FINSI;
          |SI nModo = 1; |Y #gopre002#2 = 1;
               |MENSA "0400Pulse F12 para IMPORTACION EN FORMATO FIEBDC";
          |SINO;
               |BLIN 4;
          |FINSI;
     |FINSI;

     |SI Campo = 4;
          |ESTADO_CONTROL nBotPorci, "SHOW";

          |ESTADO_CONTROL nBotPorce, "HIDE";
          |ESTADO_CONTROL nBotAmpli, "HIDE";

          |ESTADO_CONTROL nBotParti, "HIDE";
          |ESTADO_CONTROL nBotIndic, "HIDE";
          |ESTADO_CONTROL nBotSelec, "HIDE";
          |ESTADO_CONTROL nBotGener, "HIDE"; 
          |ESTADO_CONTROL nBotSuCap, "HIDE";
          |ESTADO_CONTROL nBotAgp, "HIDE";
          |ESTADO_CONTROL nBotReCap, "HIDE";
     |FINSI;

     |SI Campo = 2;
          |ESTADO_CONTROL nBotPorci, "HIDE"; 

          |SI #1#12 ! "                    ";
               |ESTADO_CONTROL nBotPorce, "SHOW"; 
               |ESTADO_CONTROL nBotAmpli, "SHOW"; 
               |ESTADO_CONTROL nBotSuCap, "SHOW";
               |ESTADO_CONTROL nBotAgp, "SHOW";
               |HAZ HabiSubcap;
               |ESTADO_CONTROL nBotReCap, "SHOW";
          |FINSI;

          |ESTADO_CONTROL nBotParti, "HIDE"; 
          |ESTADO_CONTROL nBotIndic, "HIDE"; 
          |ESTADO_CONTROL nBotSelec, "HIDE";
          |ESTADO_CONTROL nBotGener, "HIDE"; 
     |FINSI;

     |SI Campo = 12;
          |ESTADO_CONTROL nBotPorci, "HIDE"; 

          |ESTADO_CONTROL nBotPorce, "HIDE"; 
          |ESTADO_CONTROL nBotAmpli, "HIDE"; 
          |ESTADO_CONTROL nBotSuCap, "HIDE";
          |ESTADO_CONTROL nBotAgp, "HIDE";
          |ESTADO_CONTROL nBotReCap, "HIDE";

          |SI #1#12 ! "                    ";
               |ESTADO_CONTROL nBotParti, "SHOW"; 
          |FINSI;

          |ESTADO_CONTROL nBotIndic, "SHOW"; 
          |ESTADO_CONTROL nBotSelec, "SHOW";
          |ESTADO_CONTROL nBotGener, "SHOW"; 
     |FINSI;

|FPRC;
-------------------------------------------------------------------------------
|PROCESO Oculta;
     |ESTADO_CONTROL nBotPorci, "HIDE";
     |ESTADO_CONTROL nBotPorce, "HIDE"; 
     |ESTADO_CONTROL nBotAmpli, "HIDE"; 
     |ESTADO_CONTROL nBotParti, "HIDE"; 
     |ESTADO_CONTROL nBotIndic, "HIDE"; 
     |ESTADO_CONTROL nBotSelec, "HIDE";
     |ESTADO_CONTROL nBotGener, "HIDE"; 
     |ESTADO_CONTROL nBotSuCap, "HIDE";
     |ESTADO_CONTROL nBotAgp, "HIDE";
     |ESTADO_CONTROL nBotReCap, "HIDE";
     |ESTADO_CONTROL nBotCliGe, "HIDE"; 
     |ESTADO_CONTROL nBotCliPo, "HIDE"; 
|FPRC;
-------------------------------------------------------------------------------
|PROCESO F2001;
     |PTEC 824;
|FPRC;
-------------------------------------------------------------------------------
|PROCESO F3001;
     |SI nModo = 2;
          FEntrada = 202;
     |FINSI;
     |PTEC 825;
|FPRC;
-------------------------------------------------------------------------------
|PROCESO F4001;
     |SI nModo = 1;
          FEntrada = 101;
     |FINSI;
     |SI nModo = 2;
          FEntrada = 201;
     |FINSI;
     |SI nModo = 4;
          FEntrada = 401;
     |FINSI;
     |PTEC 826;
|FPRC;
-------------------------------------------------------------------------------
|PROCESO F5001;
     |PTEC 827;
|FPRC;
-------------------------------------------------------------------------------
|PROCESO F6001;
     |PTEC 828;
|FPRC;
-------------------------------------------------------------------------------
|PROCESO F7001;
     |PTEC 829;
|FPRC;
-------------------------------------------------------------------------------
|PROCESO F8001;
     |PTEC 830;
|FPRC;
-------------------------------------------------------------------------------
|PROCESO SalEsc; |TIPO 0;

     nModo = (FEntrada/100)!0;

     |SI FSalida = 1;

          |SI nModo = 1;

               |SI #1#3 ! "                    ";
                    |CONFI "0000NSE ELIMINARAN LAS PARTIDAS Y SU DESCOMPOSICION";

                    |SI FSalida ! 0;
                         |ERROR;
                         |ACABA;
                    |FINSI;

                    |BUCLE BajaPart;
                    |ACABA;
               |FINSI;
               |ACABA;

          |FINSI;

          |MENAV "0000DEBE COMPLETAR LOS DATOS DE LA LINEA";
          |ERROR;

     |FINSI;

|FPRC;
-------------------------------------------------------------------------------
|PROCESO CalculTot2;
     #6#31 = (#6#5 % #6#26);
     #6#32 = (#6#5 % #6#27);
     nTotal = #6#5 + #6#31 + #6#32;
     #6#33 = (nTotal % #6#28);
     nTotal = nTotal - #6#33;
     #6#34 = (nTotal % #6#29);
     #6#35 = nTotal + #6#34;
|FPRC;
-------------------------------------------------------------------------------
|PROCESO MiraAnex; |TIPO 3;
     nModo = (FEntrada / 100) ! 0;
     |ABRE #204;
     |DDEFECTO #204;
     #204#0 = #0#0;
     #204#1 = #0#1;
     #204#2 = 1;
     |LEE 000#204=;
     |SI FSalida ! 0;
          #204#3 = ".";
          |GRABA 020#204n;
     |FINSI;
     |CIERRA #204;
     |SI nModo = 1;
          #0#15 = "";
          #0#16 = "";
          #0#17 = "";
          #0#47 = "";
          #0#48 = "";
          #0#43 = "";
          #0#26 = "";
          #0#27 = "";
          #0#28 = "";
     |FINSI;
|FPRC;
-------------------------------------------------------------------------------
|PROCESO Potencial; |TIPO 0;
     |SI Contenido ! #0#40;|Y #0#40 = "S"; |Y #0#41 = "P";
          |ABRE #21;
          #21#0 = #0#2;
          |LEE 000#21=;
          |SI FSalida = 0;
               |ABRE #8;
               #8#0 = "clientes";
               |LEE 101#8=;
               |SI FSalida = 0;
                    #8#1 = #8#1 + 1;
                    contador = #8#1;
                    |GRABA 021#8a;
               |SINO;
                    contador = 1;
                    #8#1 = 1;
                    |GRABA 021#8n;
               |FINSI;
               cont = contador;
               cont = ("000000" + cont) % -106;
               |LIBERA #8;
               |CIERRA #8;
          |FINSI;
          |ABRE #22;
          |DDEFECTO #22;
          #22#0   = cont;
          |LEE 000#22=;
          |SI FSalida ! 0;
               #22#1   = #21#2;
               #22#2   = #21#3;
               #22#5   = #21#4; #22#8  = #21#4; #22#11 = #21#4;
               #22#6   = #21#5; #22#9  = #21#5; #22#12 = #21#5;
               #22#7   = #21#6; #22#10 = #21#6; #22#13 = #21#6;
               #22#14  = #21#9;
               #22#15  = #21#1;
               #22#17  = #21#11;
               #22#18  = #21#12;
               #22#178 = #21#7; #22#179 = #21#8; #22#180 = #21#7 + #21#8;
               #22#181 = #21#7; #22#182 = #21#8; #22#183 = #21#7 + #21#8;
               #22#184 = #21#7; #22#185 = #21#8; #22#186 = #21#7 + #21#8;
               #22#196 = #21#13;
               #22#197 = #21#10;
               |GRABA 020#22b;
               |PUSHV 01012380;
               cMensaje ="0000EL CLIENTE ES POTENCIAL. SE PASA A CLIENTE GENERAL CON EL No. " + cont;
               |MENAV cMensaje;
               |CLS;
               |PINPA #0#22;
               |PINDA #0#22;
               |ENDATOS #1#22;
               |POPV;
               |SI FSalida = 0;
                    enSwAltaCli = 1; || Para que funcione el control de empresas
                    |GRABA 020#22a;
                    |BORRA 020#21a;
                    #0#2 = cont;
                    #0#41 = "G";
                    |PINTA #0#2; |PINTA #0#41;
               |SINO;
                    |BORRA 020#22c;
                    #0#2 = #21#0;
                    |PINTA #0#2;
               |FINSI;
          |FINSI;
          |CIERRA #22;
     |FINSI;
|FPRC;
-------------------------------------------------------------------------------

|PROCESO BotE; |TIPO 7;
     |ABRE #17; |LEE 000#17p; |CIERRA #17;

     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 1;
          #0#42 = #17#45;
          |PINTA #0#42;
     |FINSI;

     |SI #0#41 = "G"
          |ESTADO_CONTROL nBotCliGe, "SHOW"; 
     |SINO;
          |ESTADO_CONTROL nBotCliPo, "SHOW"; 
     |FINSI;
|FPRC;
-------------------------------------------------------------------------------
|PROCESO BotS; |TIPO 0;
     |SI #0#41 = "G"
          |ESTADO_CONTROL nBotCliGe, "HIDE"; 
     |SINO;
          |ESTADO_CONTROL nBotCliPo, "HIDE"; 
     |FINSI;
|FPRC;
-------------------------------------------------------------------------------
|PROCESO Min33;
     #33#0 = #0#2;
     #33#1 = 1;
|FPRC;

|PROCESO Max33;
     #33#0 = #0#2;
     #33#1 = 9999;
|FPRC;

|PROCESO DirEntrega;
     |SI #0#2 ! Contenido; |O nTecla = 10; ||F2;
          |ABRE #33;
          #33#0 = #0#2;
          #33#1 = 1;
          |LEE 101#33=;
          |SI FSalida = 0;
               |LEE 101#33s;
               |SI FSalida = 0; |Y #33#0 = #0#2;
                    #33#0 = #0#2;
                    #33#1 = #0#52;
                    |LEE 000#33];
                    |CONSULTA_F_CLAVE #1#33, Min33, Max33;
                    |SI FSalida ] 0;
                         #0#52 = #33#1; |PINTA #0#52;
                         #0#3 = #33#10; |PINTA #0#3;
                    |FINSI;
               |SINO;
                    #0#52 = 1; |PINTA #0#52;
               |FINSI;
          |SINO;
               #0#52 = 1; |PINTA #0#52;
          |FINSI;
          |CIERRA #33;
     |FINSI;
|FPRC;

|PROCESO Cliente0;
     nTecla = FSalida;
     nModo = (FEntrada / 100) ! 0;
     |SI #0#41 = "G";
          |HAZ DirEntrega;
     |FINSI;

     |SI #0#2 = "000000";
          |ACABA;
     |FINSI;
     |SI #0#41 = "G";
          |DDEFECTO #22;
          |ABRE #22;
          #22#0 = #0#2;
          |LEE 000#22=;
          |SI FSalida ! 0;
               |PUSHV 01012380;
               |CLS;
               |PINPA #0#22;
               |PINDA #0#22;
               |ENDATOS #1#22;
               |SI FSalida ! 0;
                    |ERROR;
               |SINO;
                    |GRABA 020#22b;
                    enSwAltaCli = 1; ||Para el alta de empresas;
                    |GRABA 020#22a;
               |FINSI;
               |POPV;
          |FINSI;
          |ABRE #33;
          #33#0 = #0#2;
          #33#1 = #0#52;
          |LEE 000#33=;
          |SI FSalida = 0;
               #0#3 = #33#10;
          |SINO;
               #0#3 = #22#2;
          |FINSI;
          |CIERRA #33;
          |PINTA #0#3;
          |CIERRA #22;
          |SI nModo = 1; #0#7 = #22#192; |PINTA #0#7; |FINSI;
     |FINSI;
     |SI #0#41 = "P";
          |DDEFECTO #21;
          |ABRE #21;
          #21#0 = #0#2;
          |LEE 000#21=;
          |SI FSalida ! 0;
               |PUSHV 01012380;
               |CLS;
               |PINPA #0#21;
               |PINDA #0#21;
               |ENDATOS #1#21;
               |SI FSalida ! 0;
                    |ERROR;
               |SINO;
                    |GRABA 020#21n;
               |FINSI;
               |POPV;
          |FINSI;
          #0#3 = #21#3;
          |PINTA #0#3;
          |CIERRA #21;
     |FINSI;
|FPRC;

|PROCESO Cliente; |TIPO 66;
     |SI #0#41 = "G";
          |ABRE #22;
          |CONSULTA_CLAVE #1#22;
          |SI FSalida ! 0;
               |ERROR;
          |SINO;
               #0#2 = #22#0;
               |PINTA #0#2;
          |FINSI;
          |CIERRA #22;
     |FINSI;
     |SI #0#41 = "P";
          |ABRE #21;
          |CONSULTA_CLAVE #1#21;
          |SI FSalida ! 0;
               |ERROR;
          |SINO;
               #0#2 = #21#0;
               |PINTA #0#2;
          |FINSI;
          |CIERRA #21;
     |FINSI;
/*
     |SI #0#2 = "000000";
          |ACABA;
     |FINSI;
     |SI #0#41 = "G";
          |ABRE #22;
          #22#0 = #0#2;
          |LEE 000#22=;
          |SI FSalida ! 0;
               |PUSHV 01012380;
               |CLS;
               |PINPA #0#22;
               |PINDA #0#22;
               |ENDATOS #1#22;
               |SI FSalida ! 0;
                    |ERROR;
               |SINO;
                    |GRABA 020#22n;
               |FINSI;
               |POPV;
          |FINSI;
          #0#3 = #22#2;
          |PINTA #0#3;
          |CIERRA #22;
     |FINSI;
     |SI #0#41 = "P";
          |ABRE #21;
          #21#0 = #0#2;
          |LEE 000#21=;
          |SI FSalida ! 0;
               |PUSHV 01012380;
               |CLS;
               |PINPA #0#21;
               |PINDA #0#21;
               |ENDATOS #1#21;
               |SI FSalida ! 0;
                    |ERROR;
               |SINO;
                    |GRABA 020#21n;
               |FINSI;
               |POPV;
          |FINSI;
          #0#3 = #21#3;
          |PINTA #0#3;
          |CIERRA #21;
     |FINSI;
*/
|FPRC;
-------------------------------------------------------------------------------
|PROCESO BorLin;|Tipo 6;
    |BLIN 4;
|FPRC;

|PROCESO SumaIve;
     |SI #1#15 = "S";
          #0#50 = #0#50 + #1#9;                         ||Total Venta.
     |SINO;
          #0#51 = #0#51 + #1#9;                         ||Total Venta.
     |FINSI;
     #0#6 = #0#6 + #1#10;                        ||Total Coste.
     |HAZ Totales1;
|FPRC;

|DEFBUCLE SumaIve;
     #gopre002#1;
     ;
     #gopre001#0,#gopre001#1,0;
     #gopre001#0,#gopre001#1,9999;
     ;
     NULL,SumaIve;
|FIN;

|PROCESO ImpoIve;
     |VARIABLES;
       &aIveCodigoSerie     = "XXXX";
       &aIveCodigoPresupuesto = "XXXX";
       &aIveMoneda = "EUR";
       &eaIndIncr = "";
     |FIN;

     |SI FEntrada = 101;|Y #gopre002#2 = 1;
              |SALVA_DATOS #gopre002;
              aIveCodigoSerie = #gopre001#0;
              aIveCodigoPresupuesto = #gopre001#1;
              aIveMoneda = #gopre001#7;
              eaIndIncr = #gopre001#42;
              |GRABA 020#0a;
              |CIERRAT #0;
              |SUB_EJECUTA_NP "gopreivi.tab";
              |ABRET #0;
              |LEE 121#0=;
              #0#55 = enCosteInd;
         ||     |BUCLE SumaIve;

              |HAZ EsForestales;
              |SI FSalida = 0;
                   |HAZ AsignaNaturaleza;
              |FINSI;

              |HAZ PintaTotales1;
              |REPON_DATOS #gopre002;
              |LEE 040#gopre002.=;
              #0#49 = eaAgrupacion; |PINTA #0#49;
              #0#56 = eaAgrupaPrin; ||PINTA #0#56;
              |PONCONTROL 23,"SI";
              |PTEC 808;
              |ERROR;
     |SINO;
              |MENAV "0000Solo para alta";
     |FINSI;
|FPRC;
-------------------------------------------------------------------------------
|PROCESO gomantl1;
     |SI #0#0 = #301#3; |Y #0#1 = #301#4;
          #301#9 = #0#5;
          #301#13 = #0#6;
          |GRABA 020#301a;
          |LIBERA #301;
     |FINSI;

     #300#5 =  #300#5 + #301#9;
     #300#7 = #300#7 + #301#12;
     #300#10 = #300#10 + #301#13;
|FPRC;
ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
|PROCESO Min70;
     #70#0 = " " * 20;
     #70#1 = " " * 20;
     #70#2 = 001;
     #70#3 = " " * 20;
|FPRC;

|PROCESO Max70;
     #70#0 = "z" * 20;
     #70#1 = "z" * 20;
     #70#2 = 999;
     #70#3 = "z" * 20;
|FPRC;

|PROCESO gopre004;
     |SI aArti ! "";
          |SI aArti = #4#5; |Y nPrec ! #4#10;
               #70#0 = aCam2;
               #70#1 = aCam3;
               #70#2 = aCam4;
               #70#3 = aCam5;
               #70#4 = aCam6;
               #70#5 = aCam10;
               |GRABA 000#70n;
               #70#0 = #4#2;
               #70#1 = #4#3;
               #70#2 = #4#4;
               #70#3 = #4#5;
               #70#4 = #4#6;
               #70#5 = #4#10;
               |GRABA 020#70n;
               nHay = 1;
          |FINSI;
     |FINSI;
     aCam2 = #4#2;
     aCam3 = #4#3;
     aCam4 = #4#4;
     aCam5 = #4#5;
     aCam6 = #4#6;
     aCam10 = #4#10;

     aArti = #4#5;
     nPrec = #4#10;
|FPRC;

|DEFBUCLE gopre004;
     #4#1;
     ;
     #0#0, #0#1, "                    ", "                    ", 001;
     #0#0, #0#1, "zzzzzzzzzzzzzzzzzzzz", "zzzzzzzzzzzzzzzzzzzz", 999;
     ;
     NULL, NULL, NULL, NULL, NULL, gopre004;
     #4#3;
|FIN;
ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
|PROCESO ActGen; |TIPO 30;
     nModo = (FEntrada / 100) ! 0;
     ||ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄExpediente
     |ABRE #300;
     #300#0 = #0#15;
     #300#1 = #0#16;
     |LEE 101#300=;
     |SI FSalida = 0;
          #300#5 = 0;
          #300#10 = 0;
          #300#7 = 0;
          |BUCLELIN 0 gomantl1 #300;
          |GRABA 020#300a;
     |FINSI;
     |CIERRA #300;
     ||ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄPresu
     |SI #0#18 ! "A";
          |ABRE #302;
          #302#0 = #0#0;
          #302#1 = #0#1;
          |LEE 101#302=;
          |SI FSalida = 0;
               #302#11 = #0#5;
               #302#12 = #302#11 - #302#10;
               #302#13 = (#302#10*100)/#302#11;
               #302#14 = 100 - #302#13;
               |GRABA 020#302a;
          |FINSI;
          |CIERRA #302;
     |FINSI;
     |SI #17#49 = "S";
          |HAZ CreaTempo; aTempo70 = Tempo;
          |NOME_DAT #70 aTempo70; |DELINDEX #70;
          aArti = "";
          nPrec = 0;
          nHay = 0;
          |ABRE #70;
          |BUCLE gopre004;
          |CIERRA #70;
          |SI nHay ! 0;
               |PUSHV 0501 2380;
               |ENTLINEAL #1#70, 4, 4, 20, 1, Min70, Max70;
               |POPV;
          |FINSI;
          |DELINDEX #70; Tempo = aTempo70; |HAZ BoraTempo;
     |FINSI;

     |SI #gopre001#28 = 0;
          |HAZ EsGuerola;
          |SI FSalida = 0; |Y #17#121 = "N";
               |AVISO;
               |MENAV "0000Presupuesto sin baja...";
          |FINSI;
     |FINSI;
     |SI #17#83 = "S"; |Y nModo = 1;
          enSer = #0#0;
          enPre = #0#1;
          |CIERRAT #0;
          |SUB_EJECUTA_NP "gopre010";
          |ABRET  #0;
          |LEE 000#0=;
     |FINSI;
|FPRC;

|PROCESO ModPresup; |TIPO 6;
     |SI nSwModiPre = 1;
          nSwModiPre = 0;
          |ACABA;
     |FINSI;

/******************************************************
   |SI aDesdeFuera = "N";
      eaTipo = "P";
   |SINO;
      |ABRE #goprepec;
      |SELECT #2#goprepec;
      |SI aSerExp = "     "; |Y nNumExp = 0;
         |SALVA_DATOS #gopre001;
         |LEE 000#gopre001.=;
         aSerExp = #gopre001#15;
         nNumExp = #gopre001#16;
         |REPON_DATOS #gopre001;
      |FINSI;
      #goprepec#3 = aSerExp;
      #goprepec#7 = nNumExp;
      |LEE 000#goprepec.=;
      |SI FSalida = 0; |Y #goprepec#11 = "S";
         eaTipo = "E2";
      |SINO;
         eaTipo = "E1";
      |FINSI;
      |SELECT #1#goprepec;
      |CIERRA #goprepec;
      |SI #goparame#52 = "S";
         |SI #goparame#55 = "S";
            |SI #gopre001#1 > #goparame#59;
               nCalc = #gopre001#1 - #goparame#54; #gopre001#1 = nCalc;
            |FINSI;
         |FINSI;
      |FINSI;
   |FINSI;
***************************************************/
   nModo = (FEntrada / 100) ! 0;
   |SI nModo = 4;   |ACABA;   |FINSI;

   eaTipo = "P";
   nAntNum = #gopre001#1;
   eaSer = #gopre001#0; enNum = #gopre001#1; |HAZ ModifPres;
   |SI enNum = -1; |ERROR; |ACABA; |FINSI;
   |SI enNum ! #gopre001#1;
        |MENAV "0000Existe Copia. No se puede modificar...";
        |ERROR;
        |ACABA;
   |FINSI;
/**********************************************
   #gopre001#1 = enNum; |LEE 000#gopre001.=; |PINTA #gopre001#1;

   |SI aDesdeFuera = "N";
      |SI nModo = 2;
         |SI nAntNum ! #gopre001#1;
            |MENAV "    No se puede modificar el presupuesto";
            |ERROR; |ACABA;
         |FINSI;
      |FINSI;
      |SI nModo = 3;
         |SI nAntNum ! #gopre001#1;
            |MENAV "    No se puede modificar el presupuesto";
            |PTEC 807; |ACABA;
         |FINSI;
      |FINSI;
   |FINSI;
****************************************/
|FPRC;

|PROCESO Tipo13; |TIPO 13;
     nGuarda = #1#11;

     |SI #0#42 = "+";
          #1#11 = ((#0#5-#0#6)/#0#6)*100;         ||Calcula el Incremento.
     |SINO;
          #1#11 = (1 - (#0#6/#0#5))*100;
     |FINSI;
     |ATRI I;
     |PINTA 2044, #1#11; || Incr
     |PINTA 2342, #0#33; || Baja
     |ATRI 0;
     #1#11 = nGuarda;

     |HAZ OcultaIVAE;

     |SI cEstado = "Venta";
          |C_V #1#11, 1, "S";
          |C_V #1#7,  1, "S";
          |C_V #1#10,  1, "N";

          |C_V #2#8, 1, "S";
          |C_V #2#10,1, "S";                      ||Importe Venta Par.
          |C_V #2#12,1, "S";
          |C_V #2#9, 1, "N";
          |C_V #2#11,1, "N";                      ||Importe Coste.
     |SINO;
          |C_V #1#11, 1, "N";                     ||Incremento Cap.
          |C_V #1#7,  1, "N";
          |C_V #1#10, 1, "S";                     ||Importe Coste Cap.

          |C_V #2#8, 1, "N";
          |C_V #2#10,1, "N";                      ||Importe Venta Par.
          |C_V #2#12,1, "N";
          |C_V #2#9, 1, "S";
          |C_V #2#11,1, "S";                      ||Importe Coste Par.
     |FINSI;
     |SI #17#141 = "O";
          |ATRI I; |PINTA 0502, "O.E...........:"; |ATRI 0;
     |FINSI;
|FPRC;

|PROCESO OcultaIVAE;
     || #17#79  (bases exentas) campo eliminado
     || ahora se ha a¤adido #17#139 (ivas en presupuestos)
     ||SI #17#79 = "N";

     |SI #17#139 = "N";
          |C_V #1#17, 1, "N";
          |C_A #1#13, 1, 20;
          |ATRI R; |PINTA 1037, "     "; |ATRI 0;
     |FINSI;
|FPRC;

|PROCESO HabiSubcap;
     |SI #0#49 = "S";
          |ESTADO_CONTROL nBotSuCap, "ENABLE";
     |SINO;
          |ESTADO_CONTROL nBotSuCap, "DISABLE";
     |FINSI;
     |SI #0#56 = "S";
          |ESTADO_CONTROL nBotAgp, "ENABLE";
     |SINO;
          |ESTADO_CONTROL nBotAgp, "DISABLE";
     |FINSI;
|FPRC;

|PROCESO ModiSuCab; |TIPO 7;
     aAlfa = #0#49;
     |C_M #1#14, 1, aAlfa;
     aAlfa = #0#56;
     |C_M #1#16, 1, aAlfa;
|FPRC;

|PROCESO Modgopre002;
     #1#14 = 0;
     #1#16 = 0;
     |GRABA 020#1a;
     |LIBERA #1;
|FPRC;

|DEFBUCLE Modgopre002;
     #1#1;
     ;
     #0#0, #0#1, 001;
     #0#0, #0#1, 999;
     be;
     NULL, Modgopre002;
|FIN;

|PROCESO ConSuCab; |TIPO 0;
     |SI #0Campo ! Contenido; |Y #0Campo = "N";
          |CONFI "0000NSe borraran las agrupaciones de capitulos. Continuar?";
          |SI FSalida = 0;
               |BUCLE Borgopre021;
               |BUCLE Borgopre023;
               |BUCLE Modgopre002;
          |SINO;
               |ERROR;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO CheqSuCab; |TIPO 6;
     |SI #0#49 = "S"; |Y Campo = 14;
          |SI FSalida = 13;
               |PUSHV 0501 2380;
               |BLANCO 1122 2059;
               |ESTADO_CONTROL nBotAmCap, "SHOW";
               |ENTLINEAL #1#11, 3, nModo, 19, 1, Min11, Max11;
               |ESTADO_CONTROL nBotAmCap, "HIDE";
               |POPV;
               |ERROR; |ACABA;
          |FINSI;

          |ABRE #11;
          #11#0 = #1#0;
          #11#1 = #1#1;
          #11#2 = #1#14;
          |LEE 000#11=;
          |SI FSalida ! 0; |Y #1#14 ! 0;
               |MENAV "0000No existe Agrupacion...";
               |ERROR;
          |FINSI;
          |CIERRA #11;
     |FINSI;
     |SI #0#56 = "S"; |Y Campo = 16;
          |SI FSalida = 14;
               |PUSHV 0501 2380;
               |BLANCO 1122 2059;
               |ENTLINEAL #1#23, 3, nModo, 19, 1, Min23, Max23;
               |POPV;
               |ERROR; |ACABA;
          |FINSI;

          |ABRE #23;
          #23#0 = #1#0;
          #23#1 = #1#1;
          #23#2 = #1#16;
          |LEE 000#23=;
          |SI FSalida ! 0; |Y #1#16 ! 0;
               |MENAV "0000No existe Agrupacion principal...";
               |ERROR;
          |FINSI;
          |CIERRA #23;
     |FINSI;
|FPRC;

---------------------------------------------------------------
|PROCESO CreaCosInd;
     nTotal = #2#8 * #0#55 / 100;
     #4#0 = #2#0;
     #4#1 = #2#1;
     #4#2 = #2#2;
     #4#3 = #2#4;
     #4#4 = 999;
     |LEE 000#4]
     |SI FSalida = 0;
          |LEE 000#4a;
     |SINO;
          |LEE 000#4u;
     |FINSI;
     |SI FSalida = 0;|Y #4#0 = #2#0;|Y #4#1 = #2#1;|Y #4#2 = #2#2;|Y #4#3 = #2#4;
          nLinea = #4#4 + 1;
     |SINO;
          nLinea = 1;
     |FINSI;
     |DDEFECTO #4;
     #4#0 = #2#0;
     #4#1 = #2#1;
     #4#2 = #2#2;
     #4#3 = #2#4;
     #4#4 = nLinea;
     #4#5 = #19#0;
     #4#6 = #19#1;
     #4#7 = #19#5;
     #4#8 = 1;
     #4#9 = nTotal;
     #4#10 = nTotal;
     #4#11 = nTotal;
     #4#12 = nTotal;
     #4#13 = 0;
     #4#14 = #203#0;
     #4#15 = #203#1;
     |GRABA 020#4n;
|FPRC;

|DEFBUCLE CreaCosInd;
     #2#1;
     ;
     #0#0, #0#1, "                   ", 001;
     #0#0, #0#1, "zzzzzzzzzzzzzzzzzzz", 999;
     ;
     NULL, CreaCosInd;
|FIN;

|PROCESO BorraCosInd;
     #4#0 = #2#0;
     #4#1 = #2#1;
     #4#2 = #2#2;
     #4#3 = #2#4;
     #4#4 = 999;
     |LEE 000#4]
     |SI FSalida = 0;
          |LEE 000#4a;
     |SINO;
          |LEE 000#4u;
     |FINSI;
     |SI FSalida = 0;|Y #4#0 = #2#0;|Y #4#1 = #2#1;|Y #4#2 = #2#2;|Y #4#3 = #2#4;
          |SI #4#5 = #17#91;
               |BORRA 020#4a;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE BorraCosInd;
     #2#1;
     ;
     #0#0, #0#1, "                   ", 001;
     #0#0, #0#1, "zzzzzzzzzzzzzzzzzzz", 999;
     ;
     NULL, BorraCosInd;
|FIN;

|PROCESO Mini1;
     #1#0 = #0#0;
     #1#1 = #0#1;
     #1#2 = 1;
|FPRC;

|PROCESO Maxi1;
     #1#0 = #0#0;
     #1#1 = #0#1;
     #1#2 = 999;
|FPRC;

|PROCESO CosteInd; |TIPO 0;
     aArti = #17#91; |QBF aArti;
     |SI aArti = ""; |ACABA; |FINSI;

     |ABRE #19;
     #19#0 = aArti;
     |LEE 000#19=;
     |CIERRA #19;

     |ABRE #203;
     #203#0 = #19#126;
     |LEE 000#203=;
     |CIERRA #203;

     |ABRE #4;
     |BUCLE BorraCosInd;
     |GRABA 020#0a;
     enSer = #0#0;
     enPre = #0#1;
     |CIERRAT #0;
     |SUB_EJECUTA_NP "gopre010";
     |ABRET  #0;
     |LEE 121#0=;

     |SI #0#55 ! 0;
          |BUCLE CreaCosInd;
          enSer = #0#0;
          enPre = #0#1;
          |CIERRAT #0;
          |SUB_EJECUTA_NP "gopre010";
          |ABRET  #0;
          |LEE 121#0=;
     |FINSI;
     |CIERRA #4;
     |ENTLINEAL #1#1, 1, 7, 18, 1, Mini1, Maxi1;
     |PINDA #0#0;
|FPRC;

|PROCESO Capitulo66; |TIPO 66;
     |SI #17#32 = "H";
          |ABRE #104;
          #104#0 = #1#12;
          |LEE 000#104];
          |CONSULTA_CLAVE #1#104;
          |SI FSalida = 0;
               #1#12 =  #104#0; |PINTA #1#12;
          |SINO;
               |ERROR;
          |FINSI;
          |CIERRA #104;
     |SINO;
          |ABRE #102;
          #102#0 = #1#12;
          |LEE 000#102];
          |CONSULTA_CLAVE #1#102;
          |SI FSalida = 0;
               #1#12 = #102#0; |PINTA #1#12;
          |SINO;
               |ERROR;
          |FINSI;
          |CIERRA #102;
     |FINSI;
|FPRC;

|PROCESO Desgloparti;
     |SI #4#14 = "   ";
          #39#0 = #4#5;
          |LEE 000#39=;
          |SI FSalida = 0;
               #19#0 = #39#1;
               |LEE 000#19=;
               |SI FSalida = 0;
                    #4#14 = #19#126;
                    |GRABA 020#4a;
               |FINSI;
          |FINSI;
     |FINSI;
     |LIBERA #4;
|FPRC;

|DEFBUCLE Desgloparti;
     #4#1;
     ;
     #0#0, #0#1, "                    ", "                    ", 001;
     #0#0, #0#1, "zzzzzzzzzzzzzzzzzzzz", "zzzzzzzzzzzzzzzzzzzz", 999;
     be;
     NULL, Desgloparti;
|FIN;

|PROCESO AsignaNaturaleza;
     |ABRE #19;
     |ABRE #39;
     |BUCLE Desgloparti;
     |CIERRA #19;
     |CIERRA #39;
|FPRC;

|PROCESO Iva66; |TIPO 66;
     enTiva = #1Campo;
     efFiva = #0#4;
     |HAZ ConsuIVA;
     |SI eaDiva = "";
          |ERROR;
     |SINO;
          #1Campo = enTiva; |PINTA #1Campo;
     |FINSI;
|FPRC;

|PROCESO Iva0; |TIPO 0;
     enTiva = #1Campo;
     efFiva = #0#4;
     |HAZ SacaIVA;
     |SI eaDiva = "";
          |MENAV "0000No existe tipo iva para esta fecha...";
          |ERROR; |ACABA;
     |SINO;
          |SI #1Campo = 0; #1#15 = "S"; |SINO; #1#15 = "N"; |FINSI;
     |FINSI;
|FPRC;
