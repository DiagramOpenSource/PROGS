|FICHEROS;
     sctrz017 #0;
     sctrm003 #3;
     sctrm008 #8;
     sctrm011 #11;
     sctrm012 #12;
     sctrm017 #17;
     sctrm018 #18;
     sctrm019 #19;
     sctrm020 #20;
     sctrm021 #21;
     sctrm023 #23;
     sctrm024 #24;
     sctrm025 #25;
     sctrm026 #26;
     sctrm029 #29;
     sctrm030 #30;
     sctrm031 #31;
     sctrm057 #57;
     sctrm069 #69;
     sctrm001 #100;
     sctrz018 #118,MANTE; ||Pan Cab
     sctrz019 #119,MANTE; ||Pan Lin
     sctrz020 #120,MANTE; ||Pan Org/Des
     sctrz021 #121,MANTE; ||Pan Duplicar
     sctrz022 #122;
     sctrz023 #123,MANTE; ||Pan Mail
     sctrz024 #124,MANTE; ||Pan Incluir Trayectos
     agifa024 #224;
     sctrw012 #200,MANTE; ||Tmp Lineal
     referen@ #90;
     refere1@;
     refere2@;
|FIN;

|VARIABLES;
     aInf = "";
     &eaMensaje = "";
     &enTipo = 0;
     &enLinServi = 0;
     &eaNomLogo = "";
     &enPantaLogo = 0;
     &enCtrFin = 0;
     &Tempo = "";
     aAlfa = "";
     nModoCab = 0;
     nModoLin = 0;
     nModoTra = 0;
     nModo = 0;
     nPanta = 0;
     nPantaLin = 0;
     nPantaTra = 0;
     nPantaCab = 0;
     nRango = 0;
     nGridCab = 0;
     nGridLin = 0;
     nGridTra = 0;
     nBtnAlta = 0;
     nBtnModi = 0;
     nBtnBaja = 0;
     nBtnCons = 0;
     nBtnImpr = 0;
     nBtnPDF = 0;
     nBtnTodos = 0;
     nBtnDuplica = 0;
     nBtnAltaLin = 0;
     nBtnModiLin = 0;
     nBtnBajaLin = 0;
     nBtnConsLin = 0;
     nBtnAltaTra = 0;
     nBtnModiTra = 0;
     nBtnBajaTra = 0;
     nBtnConsTra = 0;
     nBtnIncorpora = 0;
     nBtnRenumera = 0;
     nBtnLineal = 0;
     aReg0 = "";
     nReg2 = 0;
     aReg4 = "";
     nReg5 = 0;
     nReg7 = 0;
     aRegLin0 = "";
     nRegLin1 = 0;
     aRegLin2 = "";
     nRegLin3 = 0;
     nRegLin4 = 0;
     nRegLin5 = 0;
     aRegTra0 = "";
     nRegTra1 = 0;
     aRegTra2 = "";
     nRegTra3 = 0;
     nRegTra4 = 0;
     nRegTra5 = 0;
     nBloquea = 0;
     nBloqueaLin = 0;
     nId = 0;
     nLin = 0;
     nSwFin = 0;
     i = 0;
     aHora = "";
     aMinu = "";
     nHora = 0;
     nMinu = 0;
     nHay = 0;
     nError = 0;
     aPath = "";
     nForma = 0;
     nHoras = 0;
     nCampo = 0;
     nPrime = 0;
     aTipo0 = "";
     aTipo1 = "";
     aIP = "";
     aFicPdf = "";
     aPDF = "";
     {1}aLocal = "";
     aFic = "";
     aMail = "";
     aFicMsg = "";
     nHandle = 0;
     aServidor = "";
     aFrom = "";
     aTo = "";
     aSubject = "";
     aMensaje = "";
     aDjunto = "";
     aTempo = "";
     nLinSer =  0;
     nPlanti = 0;
     aSentido = "";
     aConte = "";
     nHora1 = 0;
     nHora2 = 0;
     nDia = 0;
     nServicio = 0;
     aDiasSer = "";
     aOrgDes = "";
     fFecha = @;
     f = @;
     aDiaSemanaN = "";
     aDiaSemanaL = "";
     nKms = 0;
     nNume = 0;
     nSwCheqHora = 0;
|FIN;

|PROCESO OD; |TIPO 0;
     aAlfa = #200#4;
     aAlfa = aAlfa % 101;
     |SI aAlfa ! "O"; |Y aAlfa ! "D"; |Y aAlfa ! "T";
          aAlfa = "O";
     |FINSI;
     #200#4 = aAlfa; |PINTA #200#4;
|FPRC;

|PROCESO Nume; |TIPO 0;
     nDia = #200#6;
     #200#6 = nDia; |PINTA #200#6;
|FPRC;

|PROCESO Hora200; |TIPO 0;
     nModo = (FEntrada / 100) ! 0;
     aAlfa = #200Campo;
     |HAZ FormaHora;
     #200Campo = aAlfa; |PINTA #200Campo;
     |SI Campo ! 5;
          nCampo = Campo + 5;
          aHora = #200Campo;
          nDia = #200#6;
          |SI nModo = 1;
               #31#0 = #118#0;
               #31#1 = #118#2;
               #31#2 = #118#4;
               #31#3 = #118#5;
               #31#4 = #118#7;
               #31#5 = #200#0;
               |LEE 000#31];
               |SI FSalida = 0;
                    |LEE 000#31a;
               |SINO;
                    |LEE 000#31u;
               |FINSI;
               |SI FSalida ! 0; |O #31#0 ! #118#0; |O #31#1 ! #118#2;
                         |O #31#2 ! #118#4; |O #31#3 ! #118#5;
                         |O #31#4 ! #118#7;
                    FSalida = "1";
               |FINSI;
               nSwCheqHora = 1;
          |SINO;
               #31#0 = #118#0;
               #31#1 = #118#2;
               #31#2 = #118#4;
               #31#3 = #118#5;
               #31#4 = #118#7;
               #31#5 = #200#0;
               nSwCheqHora = 0;
               FSalida = 0;
          |FINSI;
          |SI FSalida = 0;
               |HAZ CheqHora;
               |SI nError ! 0;
                    |MENAV "0000Debe de ser una hora mayor a la anterior...";
                    |ERROR;
               |FINSI;
               nSwCheqHora = 0;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Pob0; |TIPO 0;
     |ABRE #3;
     #3#0 = #200#2;
     |LEE 000#3=;
     |SI FSalida = 0;
          #200#3 = #3#1; |PINTA #200#3;
     |SINO;
          |MENAV "0000No existe c¢digo poblaci¢n...";
          |ERROR;
     |FINSI;
     |CIERRA #3;
|FPRC;

|PROCESO Pob66; |TIPO 66;
     |ABRE #3;
     #3#0 = #200#2;
     |LEE 000#3];
     |CONSULTA_CLAVE #1#3;
     |SI FSalida = 0;
          #200#2 = #3#0; |PINTA #200#2;
     |SINO;
          |ERROR;
     |FINSI;
     |CIERRA #3;
|FPRC;

|PROCESO Tipo2; |TIPO 2;
     nModo = (FEntrada / 100) ! 0;
     |SI #200#0 = 0;
          |AVISO; |ERROR;
     |SINO;
          |DDEFECTO #31;
          #31#0 = #118#0;
          #31#1 = #118#2;
          #31#2 = #118#4;
          #31#3 = #118#5;
          #31#4 = #118#7;
          #31#5 = #200#0;
          |LEE 101#31=;
          |SI FSalida ! 0; |GRABA 020#31b; |FINSI;
          #31#6 = #200#2;
          #31#8 = #200#3;
          #31#9 = #200#4;
          #31#10 = #200#5;
          #31#11 = #200#6;

          #31#12 = #200#7;
          #31#13 = #200#8;
          #31#14 = #200#9;
          #31#15 = #200#10;
          #31#16 = #200#11;
          #31#17 = #200#12;
          #31#18 = #200#13;
          #31#19 = #200#14;
          #31#20 = #200#15;
          #31#21 = #200#16;
          |GRABA 020#31a;
          |LIBERA #31;
     |FINSI;
|FPRC;

|PROCESO Tipo7; |TIPO 7;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 1;
          aOrgDes = "O";
          |LEE 000#200u;
          |SI FSalida = 0;
               |LEE 000#200a;
               aOrgDes = #200#4;

               |LEE 000#200u;
               nLin = #200#0 + 10;
          |SINO;
               nLin = 10;
          |FINSI;
          |DDEFECTO #200;
          #200#0 = nLin;
          #200#4 = aOrgDes; |PINTA #200#4;
     |FINSI;
|FPRC;

|PROCESO Trayectos;
     |DDEFECTO #200;
     #200#0 = #31#5;
     #200#2 = #31#6;
     #200#3 = #31#7;
     #200#4 = #31#9;
     #200#5 = #31#10;
     #200#6 = #31#11;

     #200#7 = #31#12;
     #200#8 = #31#13;
     #200#9 = #31#14;
     #200#10 = #31#15;
     #200#11 = #31#16;
     #200#12 = #31#17;
     #200#13 = #31#18;
     #200#14 = #31#19;
     #200#15 = #31#20;
     #200#16 = #31#21;
     |GRABA 020#200n;
|FPRC;

|DEFBUCLE Trayectos;
     #31#1;
     ;
     #29#0, #29#2, #29#4, #29#5, #29#7, 000;
     #29#0, #29#2, #29#4, #29#5, #29#7, 999;
     ;
     NULL, Trayectos;
|FIN;

|PROCESO Servicios;
     |SI nCampo [ 16;
          aAlfa = ("000000" + #30#6) % -106;
          aAlfa = aAlfa % 104;
          #200nCampo = aAlfa;
          nCampo = nCampo + 1;
     |FINSI;
|FPRC;

|DEFBUCLE Servicios;
     #30#1;
     ;
     #29#0, #29#2, #29#4, #29#5, #29#7, 000;
     #29#0, #29#2, #29#4, #29#5, #29#7, 999;
     ;
     NULL, Servicios;
|FIN;

|PROCESO BtnLineal;
     |HAZ CreaTempo; |NOME_DAT #200 Tempo; |DELINDEX #200; |ABRE #200;
     |VENTANA 0501, 3098, -1, 17, "Trayectos Servicios Origen/Destino";
     |HAZ PushVenModal;

     #200#0 = 0;
     #200#1 = "0,0,0;233,150,122";
     #200#2 = "Pobla";
     #200#3 = "Descripcion";
     #200#4 = "OD";
     #200#5 = "HH-TR";
     #200#6 = "Dt";
     nCampo = 7;
     |BUCLE Servicios;
     |GRABA 020#200n;
     nLin = 0;
     |BUCLE Trayectos;
     |PARA i = nCampo; |SI i [ 16; |HACIENDO i = i + 1;
          |C_M #200i, 1, "N";
     |SIGUE;
     |SI nModoCab = 4;
          nRango = 4 + 8 + 16 + 32;
     |SINO;
          nRango = 1 + 4 + 8 + 16 + 32;
     |FINSI;
     #200#0 = 1; |LEE 000#200];
     |LINEAL_SIMPLE #1#200, nRango, 0501, 2898, NULL, NULL, NULL;
     |PAUSA;
     |REFRESCACONTROL nGridTra;
     |HAZ PopVenModal;
     |CIERRA #200; |HAZ BoraTempo; |DELINDEX #200;
|FPRC;

|PROCESO Renumera;
     |SALVA_DATOS #referen@;
     |REPON_DATOS #31;
     nLin = nLin + 5;
     #31#5 = nLin;
     |GRABA 020#31n;
|FPRC;

|DEFBUCLE Renumera;
     #referen@#1006;
     ;
     #29#0, #29#2, #29#4, #29#5, #29#7, 000;
     #29#0, #29#2, #29#4, #29#5, #29#7, 999;
     ;
     NULL, Renumera;
|FIN;

|PROCESO Copia;
     |SALVA_DATOS #31;
     |REPON_DATOS #referen@;
     |GRABA 020#referen@.n;
     |BORRA 020#31a;
|FPRC;

|DEFBUCLE Copia;
     #31#1;
     ;
     #29#0, #29#2, #29#4, #29#5, #29#7, 000;
     #29#0, #29#2, #29#4, #29#5, #29#7, 999;
     be;
     NULL, Copia;
|FIN;

|PROCESO BtnRenumera;
     |CONFI "0000N¨Esta seguro de renumerar las l¡neas?";
     |SI FSalida = 0;
          |DDEF aAlfa;
          aAlfa = aAlfa + "sctrm031";
          |CARGA_DEF aAlfa, referen@;
          |SI FSalida = 0;
               |HAZ CreaTempo; |NOME_DAT #referen@#Tempo#; |DELINDEX #referen@;
               |ABRE #referen@;
               |BUCLE Copia;
               nLin = 0;
               |BUCLE Renumera;
               |CIERRA #referen@;
               |HAZ BoraTempo; |DELINDEX #referen@;
               |DESCARGA_DEF #referen@;
          |FINSI;
          |REFRESCACONTROL nGridTra;
     |FINSI;
|FPRC;

|PROCESO Incorpora;
     |SI #124#7 = "O";
          |SI #referen@#9 ! "O"; |ACABA; |FINSI;
     |FINSI;
     |SI #124#7 = "D";
          |SI #referen@#9 ! "D"; |ACABA; |FINSI;
     |FINSI;

     #31#0 = #118#0;
     #31#1 = #118#2;
     #31#2 = #118#4;
     #31#3 = #118#5;
     #31#4 = #118#7;
     #31#5 = 999;
     |LEE 000#31];
     |SI FSalida = 0;
          |LEE 000#31a;
     |SINO;
          |LEE 000#31u;
     |FINSI;
     |SI FSalida = 0; |Y #31#0 = #118#0; |Y #31#1 = #118#2;
               |Y #31#2 = #118#4; |Y #31#3 = #118#5;
               |Y #31#4 = #118#7;
          nLin = #31#5 + 10;
     |SINO;
          nLin = 10;
     |FINSI;
     |DDEFECTO #31;
     #31#0 = #118#0;
     #31#1 = #118#2;
     #31#2 = #118#4;
     #31#3 = #118#5;
     #31#4 = #118#7;
     #31#5 = nLin;
     |PARA i = 6; |SI i [ 21; |HACIENDO i = i + 1;
          #31i = #referen@#i#;
     |SIGUE;
     |GRABA 020#31n;
|FPRC;

|DEFBUCLE Incorpora;
     #referen@#1006;
     ;
     aTempo, nLinSer, aSentido, nPlanti, #124#8, 000;
     aTempo, nLinSer, aSentido, nPlanti, #124#8, 999;
     ;
     NULL, Incorpora;
|FIN;

|PROCESO Trayecto0; |TIPO 0;
     |DDEF aAlfa;
     aAlfa = aAlfa + "sctrm029";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          #referen@#0 = #124#0;
          #referen@#2 = #124#2;
          #referen@#4 = #124#4;
          #referen@#5 = #124#5;
          #referen@#7 = #124#8;
          |LEE 000#referen@.=;
          |SI FSalida ! 0;
               |MENAV "0000No existe el registro...";
               |ERROR;
          |FINSI;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|PROCESO Min29R;
     #referen@#0 = #124#0;
     #referen@#2 = #124#2;
     #referen@#4 = #124#4;
     #referen@#5 = #124#5;
     #referen@#7 = 0;
|FPRC;

|PROCESO Max29R;
     #referen@#0 = #124#0;
     #referen@#2 = #124#2;
     #referen@#4 = #124#4;
     #referen@#5 = #124#5;
     #referen@#7 = 99;
|FPRC;

|PROCESO Trayecto66; |TIPO 66;
     |DDEF aAlfa;
     aAlfa = aAlfa + "sctrm029";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          #referen@#0 = #124#0;
          #referen@#2 = #124#2;
          #referen@#4 = #124#4;
          #referen@#5 = #124#5;
          #referen@#7 = #124#8;
          |LEE 000#referen@.];
          |CONSULTA_F_CLAVE #1#referen@, Min29R, Max29R;
          |SI FSalida = 0;
               #124#8 = #referen@#7; |PINTA #124#8;
          |SINO;
               |ERROR;
          |FINSI;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|PROCESO BtnIncorpora;
     |VENTANA 1212, 2582, -1, 17, "Incorporar Trayectos Origen/Destino";
     |HAZ PushVenModal;
     |DDEFECTO #124;
     |PINPA #0#124;
     |PINDA #0#124;
     |ENDATOS #1#124;
     |SI FSalida = 0;
          aTempo = #124#0;
          nLinSer = #124#2;
          aSentido = #124#4;
          nPlanti = #124#5;
          |DDEF aAlfa;
          aAlfa = aAlfa + "sctrm031";
          |CARGA_DEF aAlfa, referen@;
          |SI FSalida = 0;
               |BUCLE Incorpora;
               |DESCARGA_DEF #referen@;
               |REFRESCACONTROL nGridTra;
          |FINSI;
     |FINSI;
     |HAZ PopVenModal;
|FPRC;

|PROCESO sctrm031;
     #31#0 = #121#1;
     |GRABA 000#31n;
|FPRC;

|DEFBUCLE sctrm031;
     #31#1;
     ;
     #121#0, #29#2, #29#4, #29#5, #29#7, 000;
     #121#0, #29#2, #29#4, #29#5, #29#7, 999;
     ;
     NULL, sctrm031;
|FIN;

|PROCESO sctrm030;
     #30#0 = #121#1;
     |GRABA 000#30n;
|FPRC;

|DEFBUCLE sctrm030;
     #30#1;
     ;
     #121#0, #29#2, #29#4, #29#5, #29#7, 000;
     #121#0, #29#2, #29#4, #29#5, #29#7, 999;
     ;
     NULL, sctrm030;
|FIN;

|PROCESO sctrm029;
     #29#0 = #121#1;
     #29#1 = #121#5;
     |GRABA 000#29n;
     |SI FSalida = 0;
          |BUCLE sctrm030;
          |BUCLE sctrm031;
     |SINO;
          aAlfa = "0000Plantilla frecuencias existente: " + #29#0 + "/" + #29#2 + "/" + #29#4 + "/" + #20#5 + "/" + #20#7 +  " ...";
          |MENAV aAlfa;
     |FINSI;
|FPRC;

|DEFBUCLE sctrm029;
     #29#1;
     ;
     #121#0, #121#2, " ", 000, 00;
     #121#0, #121#3, "z", 999, 99;
     ;
     NULL, sctrm029;
|FIN;

|PROCESO sctrm020;
     #20#0 = #121#1;
     |GRABA 000#20n;
     |SI FSalida ! 0;
          aAlfa = "0000Tarifa por temporada y trayecto existente:" + #20#0 + "/" + #20#1 + "/" + #20#2 + "/" + #20#3 + "/" + #20#4 + "/" + #20#5 + "/" + #20#6 + " ...";
          |MENAV aAlfa;
     |FINSI;
|FPRC;

|DEFBUCLE sctrm020;
     #20#1;
     ;
     #121#0, 00, 0000, #121#2, "   ", "    ", "    ";
     #121#0, 99, 9999, #121#3, "zzz", "zzzz", "zzzz";
     ;
     NULL, sctrm020;
|FIN;

|PROCESO sctrm025;
     #25#0 = #121#1;
     |GRABA 000#25n;
|FPRC;

|DEFBUCLE sctrm025;
     #25#1;
     ;
     #121#0, nLinSer, aSentido, nServicio, 00;
     #121#0, nLinSer, aSentido, nServicio, 99;
     ;
     NULL, sctrm025;
|FIN;

|PROCESO DiaSemana;
     fFecha = fFecha % A1; aAlfa = fFecha % 1102;
     |SI aAlfa = "Lu"; aDiaSemanaN = "1"; aDiaSemanaL = "L"; |FINSI;
     |SI aAlfa = "Ma"; aDiaSemanaN = "2"; aDiaSemanaL = "M"; |FINSI;
     |SI aAlfa = "Mi"; aDiaSemanaN = "3"; aDiaSemanaL = "X"; |FINSI;
     |SI aAlfa = "Ju"; aDiaSemanaN = "4"; aDiaSemanaL = "J"; |FINSI;
     |SI aAlfa = "Vi"; aDiaSemanaN = "5"; aDiaSemanaL = "V"; |FINSI;
     |SI aAlfa = "Sa"; aDiaSemanaN = "6"; aDiaSemanaL = "S"; |FINSI;
     |SI aAlfa = "Do"; aDiaSemanaN = "7"; aDiaSemanaL = "D"; |FINSI;
|FPRC;

|PROCESO ViajerosLinea;
     #69#0 = #26#2;
     #69#1 = #26#4;
     #69#2 = #26#7;
     |LEE 000#69=;
     |SI FSalida ! 0;
          #69#3 = #26#20;
          #69#4 = 0;
          #69#5 = "N";
          |GRABA 020#69n;
     |FINSI;
|FPRC;

|PROCESO TraficoDiario;
     |ABRE #69;
     |ABRE #26;
     |PARA f = #24#5; |SI f [ #24#6; |HACIENDO f = f + 1;
          fFecha = f;
          |HAZ DiaSemana;
          aAlfa = #24#7; |QBF aAlfa;
          |SI aAlfa ! "*";
               aAlfa = aAlfa - aDiaSemanaN;
          |SINO;
               FSalida = "1";
          |FINSI;
          |SI FSalida > 0;
               |DDEFECTO #26;
               #26#0 = #23#0;
               #26#1 = #23#1;
               #26#2 = #23#2;
               #26#3 = #23#3;
               #26#4 = #23#4;
               #26#5 = #23#5;
               #26#6 = #23#6;
               #26#7 = f;
               |LEE 101#26=;
               |SI FSalida ! 0; |GRABA 020#26b; |FINSI;
               |SI #26#27 = 0;
                    fFecha = f % A1;
                    #26#8 = fFecha % 11;

                    #26#13 = #23#9;
                    #26#14 = #23#10;
                    #26#19 = #23#15;
                    #26#20 = #23#16;
                    #26#21 = #23#17;
                    |SI #24#8 = "S";
                         #26#24 = "A";
                    |SINO;
                         #26#24 = "S";
                    |FINSI;
                    #26#22 = nKms;

                    |SALVA_FICHA #23;
                    #23#0 = #26#0;
                    #23#2 = #26#2;
                    #23#4 = #26#4;
                    #23#5 = #26#5;
                    |LEE 000#23=;
                    |SI FSalida = 0;
                         #26#15 = #23#11;
                         #26#16 = #23#12;
                         #26#17 = #23#13;
                         #26#18 = #23#14;
                    |FINSI;
                    |REPON_FICHA #23;

                    |GRABA 020#26a;
                    |HAZ ViajerosLinea;
               |FINSI;
               |LIBERA #26;
          |FINSI;
     |SIGUE;
     |CIERRA #26;
     |CIERRA #69;
|FPRC;

|PROCESO sctrm023;
     nLinSer = #23#2;
     aSentido = #23#4;
     nServicio = #23#5;
     #23#0 = #121#1;
     #23#1 = #121#5;
     |GRABA 000#23n;
     |SI FSalida = 0;
          aDiasSer = "*";
          |ABRE #8;
          #8#0 = #23#0;
          |LEE 020#8=;
          |CIERRA #8;

          |ABRE #24;
          #24#0 = #121#0;
          #24#1 = nLinSer;
          #24#2 = aSentido;
          #24#3 = nServicio;
          #24#4 = 1;
          |LEE 000#24];
          |SI FSalida = 0; |Y #24#0 = #121#0; |Y #24#1 = nLinSer;
                    |Y #24#2 = aSentido; |Y #24#3 = nServicio;
               aDiasSer = #24#7;
          |FINSI;

          |DDEFECTO #24;
          #24#0 = #23#0;
          #24#1 = #23#2;
          #24#2 = #23#4;
          #24#3 = #23#5;
          #24#4 = 1;
          #24#5 = #8#2;
          #24#6 = #8#3;
          #24#7 = aDiasSer;
          #24#8 = "S";
          |GRABA 000#24n;
          |CIERRA #24;
          |HAZ TraficoDiario;
          |BUCLE sctrm025;
     |SINO;
          aAlfa = "0000Servicio por temporada existente: " + #23#0 + "/" + #23#2 + "/" + #23#4 + "/" + #23#5 + " ...";
          |MENAV aAlfa;
     |FINSI;
|FPRC;

|DEFBUCLE sctrm023;
     #23#1;
     ;
     #121#0, #121#2, " ", 000000;
     #121#0, #121#3, "z", 999999;
     ;
     NULL, sctrm023;
|FIN;

|PROCESO sctrm018;
     #18#0 = #121#1;
     #18#1 = #121#5;
     |GRABA 000#18n;
|FPRC;

|DEFBUCLE sctrm018;
     #18#1;
     ;
     #121#0, 00, 0000, 000;
     #121#0, 99, 9999, 999;
     ;
     NULL, sctrm018;
|FIN;

|PROCESO sctrm017;
     #17#0 = #121#1;
     #17#1 = #121#5;
     |GRABA 000#17n;
|FPRC;

|DEFBUCLE sctrm017;
     #17#1;
     ;
     #121#0, 00, 0000;
     #121#0, 99, 9999;
     ;
     NULL, sctrm017;
|FIN;

|PROCESO sctrm019;
     #19#0 = #121#1;
     #19#1 = #121#5;

     || suma un a¤o y comparo que este dentro de la nueva temporada
     fFecha = #19#8;
     nNume = 1/1000000;
     fFecha = fFecha + nNume;
     |SI fFecha < #8#2; fFecha = #8#2; |FINSI;
     |SI fFecha > #8#3; fFecha = #8#3; |FINSI;
     #19#8 = fFecha;

     fFecha = #19#9;
     nNume = 1/1000000;
     fFecha = fFecha + nNume;
     |SI fFecha < #8#2; fFecha = #8#2; |FINSI;
     |SI fFecha > #8#3; fFecha = #8#3; |FINSI;
     #19#9 = fFecha;

     |GRABA 000#19n;
|FPRC;

|DEFBUCLE sctrm019;
     #19#1;
     ;
     #121#0, 00, 0000, 000;
     #121#0, 99, 9999, 999;
     ;
     NULL, sctrm019;
|FIN;

|PROCESO HaLin;
     |ABRE #12;
     #12#0 = #121#3;
     |LEE 000#12=;
     |SI FSalida = 0;
          #121#7 = #12#1; |PINTA #121#7;
     |SINO;
          |MENAV "0000No existe c¢digo l¡nea servicio...";
          |ERROR;
     |FINSI;
     |CIERRA #12;
|FPRC;

|PROCESO DeLin;
     |ABRE #12;
     #12#0 = #121#2;
     |LEE 000#12=;
     |SI FSalida = 0;
          #121#6 = #12#1; |PINTA #121#6;
     |SINO;
          |MENAV "0000No existe c¢digo l¡nea servicio...";
          |ERROR;
     |FINSI;
     |CIERRA #12;
|FPRC;

|PROCESO TempDes;
     |ABRE #8;
     #8#0 = #121#1;
     |LEE 000#8=;
     |SI FSalida = 0;
          #121#5 = #8#1; |PINTA #121#5;
     |SINO;
          |MENAV "0000No existe c¢digo de temporada...";
          |ERROR;
     |FINSI;
     |CIERRA #8;
|FPRC;

|PROCESO TempOrg;
     |ABRE #8;
     #8#0 = #121#0;
     |LEE 000#8=;
     |SI FSalida = 0;
          #121#4 = #8#1; |PINTA #121#4;
     |SINO;
          |MENAV "0000No existe c¢digo de temporada...";
          |ERROR;
     |FINSI;
     |CIERRA #8;
|FPRC;

|PROCESO BtnDuplicar;
     |VENTANA 1011, 1788, -1, 17, "Duplicar Servicios por Temporada";
     |HAZ PushVenModal;
     |DDEFECTO #121;
     |PINPA #0#121;
     |PINDA #0#121;
     |ENDATOS #1#121;
     |SI FSalida = 0;
          eaMensaje = "Duplicando servicios..."; |HAZ IniMensaje;
          |BUCLE sctrm023;
          |BUCLE sctrm020;
          |BUCLE sctrm029;
          |BUCLE sctrm017;
          |BUCLE sctrm018;

          |ABRE #8;
          #8#0 = #121#1;
          |LEE 020#8=;
          |CIERRA #8;
          |BUCLE sctrm019;
          |HAZ FinMensaje;

          |REFRESCACONTROL nGridCab;
     |FINSI;
     |HAZ PopVenModal;
|FPRC;

|PROCESO FormaHora;
     |QBF aAlfa;
     |SI aAlfa ! "";
          aHora = aAlfa % 102; nHora = aHora; nHora = nHora $ 24;
          aMinu = aAlfa % 402; nMinu = aMinu; nMinu = nMinu $ 60;
          aAlfa = (("00" + nHora)%-102) + ":" + (("00" + nMinu)%-102);
     |FINSI;
|FPRC;

|PROCESO HoraSer; |TIPO 0;
     aAlfa = #120Campo;
     |HAZ FormaHora;
     #120Campo = aAlfa; |PINTA #120Campo;
     |SI Campo ! 10;
          nCampo = Campo;
          aHora = #120nCampo;
          nDia = #120#11;
          |HAZ CheqHora;
          |SI nError ! 0;
               |MENAV "0000Debe de ser una hora mayor a la anterior...";
               |ERROR;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO OrgDes; |TIPO 0;
     |SI #120#9 = "T";
          |C_M #120#10, 1, "S"; |PINTA #120#10;
          |C_M #120#11, 1, "N"; |PINTA #120#11;
          |C_M #120#12, 1, "N"; |PINTA #120#12;
          |C_M #120#13, 1, "N"; |PINTA #120#13;
          |C_M #120#14, 1, "N"; |PINTA #120#14;
          |C_M #120#15, 1, "N"; |PINTA #120#15;
          |C_M #120#16, 1, "N"; |PINTA #120#16;
          |C_M #120#17, 1, "N"; |PINTA #120#17;
          |C_M #120#18, 1, "N"; |PINTA #120#18;
          |C_M #120#19, 1, "N"; |PINTA #120#19;
          |C_M #120#20, 1, "N"; |PINTA #120#20;
          |C_M #120#21, 1, "N"; |PINTA #120#21;
     |SINO;
          |C_M #120#10, 1, "N"; |PINTA #120#10;
          |C_M #120#11, 1, "S"; |PINTA #120#11;
          |C_M #120#12, 1, "S"; |PINTA #120#12;
          |C_M #120#13, 1, "S"; |PINTA #120#13;
          |C_M #120#14, 1, "S"; |PINTA #120#14;
          |C_M #120#15, 1, "S"; |PINTA #120#15;
          |C_M #120#16, 1, "S"; |PINTA #120#16;
          |C_M #120#17, 1, "S"; |PINTA #120#17;
          |C_M #120#18, 1, "S"; |PINTA #120#18;
          |C_M #120#19, 1, "S"; |PINTA #120#19;
          |C_M #120#20, 1, "S"; |PINTA #120#20;
          |C_M #120#21, 1, "S"; |PINTA #120#21;
     |FINSI;
     |HAZ CheqOrgDes;
     |SI nError ! 0; |ERROR; |FINSI;
|FPRC

|PROCESO Dia; |TIPO 0;
     |HAZ CheqDia;
     |SI nError ! 0; |ERROR; |FINSI;
|FPRC;

|PROCESO CheqHora;
     |SI aHora = "     "; |ACABA; |FINSI;
     nError = 0;
     |DDEF aAlfa;
     aAlfa = aAlfa + "sctrm031";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@
          #referen@#0 = #31#0;
          #referen@#1 = #31#1;
          #referen@#2 = #31#2;
          #referen@#3 = #31#3;
          #referen@#4 = #31#4;
          #referen@#5 = #31#5;
          |LEE 020#referen@.=;
          |PARA; |SI; |HACIENDO;
               |SI nSwCheqHora = 0;
                    |LEE 000#referen@.a;
               |FINSI;
               |SI FSalida = 0; |Y #referen@#0 = #31#0;
                         |Y #referen@#1 = #31#1; |Y #referen@#2 = #31#2;
                         |Y #referen@#3 = #31#3; |Y #referen@#4 = #31#4;
                    |SI #referen@#nCampo# ! "     ";
                         aAlfa = aHora;
                         |HAZ FormaHora;
                         nHora1 = nHora * 60 + nMinu + (nDia * (24*60));
                         aAlfa = #referen@#nCampo#;
                         |HAZ FormaHora;
                         nHora2 = nHora * 60 + nMinu + (#referen@#11 * (24*60));
                         |SI nHora1 < nHora2; nError = 1; |FINSI;
                         |SAL;
                    |FINSI;
               |SINO;
                    |SAL;
               |FINSI;
          |SIGUE;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|PROCESO CheqDia; |TIPO 0;
     nError = 0;
     |DDEF aAlfa;
     aAlfa = aAlfa + "sctrm031";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          #referen@#0 = #120#0;
          #referen@#1 = #120#1;
          #referen@#2 = #120#2;
          #referen@#3 = #120#3;
          #referen@#4 = #120#4;
          #referen@#5 = #120#5;
          |LEE 000#referen@.];
          |SI FSalida = 0;
               |LEE 000#referen@.a;
          |SINO;
               |LEE 000#referen@.u;
          |FINSI;
          |SI FSalida = 0; |Y #referen@#0 = #120#0; |Y #referen@#1 = #120#1;
                    |Y #referen@#2 = #120#2; |Y #referen@#3 = #120#3;
                    |Y #referen@#4 = #120#4;

               |SI #120#1 < #referen@#11;
                    aAlfa = "0000El N£mero d¡as trayecto no puede ser menor al anterior: " + #referen@#11 + " ...";
                    |MENAV aAlfa;
                    nError = 1;
               |FINSI;
          |FINSI;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|PROCESO CheqOrgDes;
     nError = 0;
     |DDEF aAlfa;
     aAlfa = aAlfa + "sctrm031";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          #referen@#0 = #120#0;
          #referen@#1 = #120#1;
          #referen@#2 = #120#2;
          #referen@#3 = #120#3;
          #referen@#4 = #120#4;
          #referen@#5 = 0;
          |LEE 000#referen@.];
          |SI FSalida = 0; |Y  #referen@#0 = #120#0;
                    |Y #referen@#1 = #120#1; |Y #referen@#2 = #120#2;
                    |Y #referen@#3 = #120#3; |Y #referen@#4 = #120#4;
               nPrime = #referen@#5;
               aTipo1 = #referen@#9;
          |FINSI;

          #referen@#0 = #120#0;
          #referen@#1 = #120#1;
          #referen@#2 = #120#2;
          #referen@#3 = #120#3;
          #referen@#4 = #120#4;
          #referen@#5 = #120#5;
          |LEE 000#referen@.];
          |SI FSalida = 0;
               |LEE 000#referen@.a;
          |SINO;
               |LEE 000#referen@.u;
          |FINSI;
          |SI FSalida = 0; |Y #referen@#0 = #120#0; |Y #referen@#1 = #120#1;
                    |Y #referen@#2 = #120#2; |Y #referen@#3 = #120#3;
                    |Y #referen@#4 = #120#4;
               aTipo0 = #referen@#9;
          |SINO;
               aTipo0 = "";
          |FINSI;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;

          |SI #120#5 = nPrime;
               |SI #120#9 ! "O";
                    |MENAV "0000La primera debe ser origen...";
                    nError = 1;
               |FINSI;
          |SINO;
               |SI aTipo0 = "D"; |Y #120#9 = "O";
                    |MENAV "0000Debe ser destino...";
                    nError = 1;
               |FINSI;
          |FINSI;

     |FINSI;
|FPRC;

|PROCESO Pobla; |TIPO 0;
     |ABRE #3;
     #3#0 = #120#6;
     |LEE 000#3=;
     |SI FSalida = 0;
          #120#7 = #3#1; |PINTA #120#7;
          #120#8 = #3#2; |PINTA #120#8;
          |DDEF aAlfa;
          aAlfa = aAlfa + "sctrm031";
          |CARGA_DEF aAlfa, referen@;
          |SI FSalida = 0;
               |ABRE #referen@; |SELECT #2#referen@;
               #referen@#0 = #120#0;
               #referen@#1 = #120#1;
               #referen@#2 = #120#2;
               #referen@#3 = #120#3;
               #referen@#4 = #120#4;
               #referen@#6 = #120#6;
               |LEE 000#referen@.];
               |PARA; |SI FSalida = 0; |Y #referen@#0 = #120#0; |HACIENDO;
                         |Y #referen@#1 = #120#1;
                         |Y #referen@#2 = #120#2;
                         |Y #referen@#3 = #120#3;
                         |Y #referen@#4 = #120#4;
                         |Y #referen@#6 = #120#6;
                    |SI #referen@#5 ! #120#5;
                         aAlfa = "0000Poblaci¢n existente en la l¡nea: " + #referen@#5 + " ...";
                         |MENAV aAlfa;
                         |ERROR;
                    |FINSI;
                    |LEE 000#referen@.s;
               |SIGUE;
               |CIERRA #referen@;
               |DESCARGA_DEF #referen@;
          |FINSI;
     |SINO;
          |MENAV "0000No existe c¢digo poblaci¢n...";
          |ERROR;
     |FINSI;
     |CIERRA #3;
|FPRC;

|PROCESO DefeOrgDes;
     nError = 0;
     |DDEF aAlfa;
     aAlfa = aAlfa + "sctrm031";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          #referen@#0 = #120#0;
          #referen@#1 = #120#1;
          #referen@#2 = #120#2;
          #referen@#3 = #120#3;
          #referen@#4 = #120#4;
          #referen@#5 = #120#5;
          |LEE 000#referen@.];
          |SI FSalida = 0;
               |LEE 000#referen@.a;
          |SINO;
               |LEE 000#referen@.u;
          |FINSI;
          |SI FSalida = 0; |Y #referen@#0 = #120#0; |Y #referen@#1 = #120#1;
                    |Y #referen@#2 = #120#2; |Y #referen@#3 = #120#3;
                    |Y #referen@#4 = #120#4;
               aTipo0 = #referen@#9;
          |SINO;
               aTipo0 = "O";
          |FINSI;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|PROCESO CheqLin; |TIPO 0;
     |SI nModoTra = 1; |Y nBloqueaLin = 0;
          #31#0 = #120#0;
          #31#1 = #120#1;
          #31#2 = #120#2;
          #31#3 = #120#3;
          #31#4 = #120#4;
          #31#5 = #120#5;
          |GRABA 000#31b;
          |SI FSalida ! 0;
               |MENAV "0000Registro existente...";
               |ERROR;
          |SINO;
               nBloqueaLin = 1;
               |C_M #120#5, 1, "N";
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO EditaTra;
     aRegTra0 = #31#0;
     nRegTra1 = #31#1;
     aRegTra2 = #31#2;
     nRegTra3 = #31#3;
     nRegTra4 = #31#4;
     nRegTra5 = #31#5;

     |SI nModoTra = 1; |VENTANA 1901, 3098, -1, 17, "Nuevo L¡nea Trayecto"; |FINSI;
     |SI nModoTra = 2; |VENTANA 1901, 3098, -1, 17, "Modifica L¡nea Trayecto"; |FINSI;
     |SI nModoTra = 4; |VENTANA 1901, 3098, -1, 17, "Consulta L¡nea Trayecto"; |FINSI;
     |HAZ PushVenModal;

     |SI nModoTra = 1;
          #31#0 = #118#0;
          #31#1 = #118#2;
          #31#2 = #118#4;
          #31#3 = #118#5;
          #31#4 = #118#7;
          #31#5 = 999;
          |LEE 000#31];
          |SI FSalida = 0;
               |LEE 000#31a;
          |SINO;
               |LEE 000#31u;
          |FINSI;
          |SI FSalida = 0; |Y #31#0 = #118#0; |Y #31#1 = #118#2;
                    |Y #31#2 = #118#4; |Y #31#3 = #118#5; |Y #31#4 = #118#7;
               nLin = #31#5 + 10;
               nDia = #31#11;
          |SINO;
               nLin = 10;
               nDia = 1;
          |FINSI;
          |DDEFECTO #120;
          #120#0 = #118#0;
          #120#1 = #118#2;
          #120#2 = #118#4;
          #120#3 = #118#5;
          #120#4 = #118#7;
          #120#5 = nLin;
          |HAZ DefeOrgDes;
          #120#9 = aTipo0;
          #120#11 = nDia;
          |C_M #120#5, 1, "S";
     |SINO;
          |C_M #120#5, 1, "N";
          |PARA i = 0; |SI i [ 21; |HACIENDO i = i + 1;
               #120i = #31i;
          |SIGUE;
     |FINSI;

     nBloqueaLin = 0;
     |PINPA #0#120; nPantaTra = FSalida;
     |PINDA #0#120;
  |ET Otra;
     |SI nModoTra = 1; |ENDATOS #1#120; |FINSI;
     |SI nModoTra = 2; |ENDATOS #2#120; |FINSI;
     |SI nModoTra = 4; |PAUSA; |FINSI;
     |SI FSalida = 0; |Y nModoTra ! 4;
          #31#0 = #120#0;
          #31#1 = #120#1;
          #31#2 = #120#2;
          #31#3 = #120#3;
          #31#4 = #120#4;
          #31#5 = #120#5;
          |LEE 121#31=;
          |HAZ CheqOrgDes;
          |SI nError ! 0; |VETE Otra; |FINSI;
          |HAZ CheqDia;
          |SI nError ! 0; |VETE Otra; |FINSI;
          |PARA i = 12; |SI i [ 21; |HACIENDO i = i + 1;
               nCampo = i;
               aHora = #120nCampo;
               nDia = #120#11;
               |HAZ CheqHora;
               |SI nError ! 0; |MENAV "0000Error en horas..."; |SAL; |FINSI;
          |SIGUE;
          |SI nError ! 0; |VETE Otra; |FINSI;
          |PARA i = 0; |SI i [ 21; |HACIENDO i = i + 1;
               #31i = #120i;
          |SIGUE;
          |GRABA 020#31a;
          aRegTra0 = #31#0;
          nRegTra1 = #31#1;
          aRegTra2 = #31#2;
          nRegTra3 = #31#3;
          nRegTra4 = #31#4;
          nRegTra5 = #31#5;
     |SINO;
          |SI nModoTra = 1; |Y nBloquea = 1;
               #31#0 = #120#0;
               #31#1 = #120#1;
               #31#2 = #120#2;
               #31#3 = #120#3;
               #31#4 = #120#4;
               #31#5 = #120#5;
               |BORRA 020#31c;
          |FINSI;
     |FINSI;
     |LIBERA #31;

     |HAZ PopVenModal;

     #31#0 = aRegTra0;
     #31#1 = nRegTra1;
     #31#2 = aRegTra2;
     #31#3 = nRegTra3;
     #31#4 = nRegTra4;
     #31#5 = nRegTra5;
     |LEE 000#31=;
     |REFRESCACONTROL nGridTra;
|FPRC;

|PROCESO BtnAltaTra;
     nModoTra = 1; |HAZ EditaTra;
     |HAZ TieneLineasTra;
|FPRC;

|PROCESO BtnModiTra;
     |LEE 100#31=;
     |SI FSalida ! 0; |ACABA; |FINSI;
     nModoTra = 2; |HAZ EditaTra;
|FPRC;

|PROCESO BtnBajaTra;
     |LEE 100#31=;
     |SI FSalida ! 0; |ACABA; |FINSI;
     aAlfa = "0000N¨Borrar l¡nea trayecto: " + #31#5 + "?";
     |CONFI aAlfa;
     |SI FSalida = 0;
          |BORRA 020#31a;
          |HAZ TieneLineasTra;
          |REFRESCACONTROL nGridTra;
     |FINSI;
     |LIBERA #31;
|FPRC;

|PROCESO BtnConsTra;
     |LEE 000#31=;
     |SI FSalida ! 0; |ACABA; |FINSI;
     nModoTra = 4; |HAZ EditaTra;
|FPRC;

|PROCESO TieneLineasTra;
     |DDEF aAlfa;
     aAlfa = aAlfa + "sctrm031";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          #referen@#0 = #118#0;
          #referen@#1 = #118#2;
          #referen@#2 = #118#4;
          #referen@#3 = #118#5;
          #referen@#4 = #118#7;
          #referen@#5 = 0;
          |LEE 000#referen@.];
          |SI FSalida = 0; |Y #referen@#0 = #118#0; |Y #referen@#1 = #118#2;
                    |Y  #referen@#2 = #118#4; |Y #referen@#3 = #118#5;
                    |Y #referen@#4 = #118#7;
               |SI nModoCab = 4;
                    |ESTADO_CONTROL nBtnAltaTra, "DISABLE";
                    |ESTADO_CONTROL nBtnModiTra, "DISABLE";
                    |ESTADO_CONTROL nBtnBajaTra, "DISABLE";
                    |ESTADO_CONTROL nBtnConsTra, "ENABLE";
                    |ESTADO_CONTROL nBtnIncorpora, "DISABLE";
                    |ESTADO_CONTROL nBtnRenumera, "DISABLE";
                    |ESTADO_CONTROL nBtnLineal, "ENABLE";
               |SINO;
                    |ESTADO_CONTROL nBtnAltaTra, "ENABLE";
                    |ESTADO_CONTROL nBtnModiTra, "ENABLE";
                    |ESTADO_CONTROL nBtnBajaTra, "ENABLE";
                    |ESTADO_CONTROL nBtnConsTra, "ENABLE";
                    |ESTADO_CONTROL nBtnIncorpora, "ENABLE";
                    |ESTADO_CONTROL nBtnRenumera, "ENABLE";
                    |ESTADO_CONTROL nBtnLineal, "ENABLE";
               |FINSI;
          |SINO;
               |SI nModoCab = 4;
                    |ESTADO_CONTROL nBtnAltaTra, "DISABLE";
                    |ESTADO_CONTROL nBtnModiTra, "DISABLE";
                    |ESTADO_CONTROL nBtnBajaTra, "DISABLE";
                    |ESTADO_CONTROL nBtnConsTra, "DISABLE";
                    |ESTADO_CONTROL nBtnIncorpora, "DISABLE";
                    |ESTADO_CONTROL nBtnRenumera, "DISABLE";
                    |ESTADO_CONTROL nBtnLineal, "DISABLE";
               |SINO;
                    |ESTADO_CONTROL nBtnAltaTra, "ENABLE";
                    |ESTADO_CONTROL nBtnModiTra, "DISABLE";
                    |ESTADO_CONTROL nBtnBajaTra, "DISABLE";
                    |ESTADO_CONTROL nBtnConsTra, "DISABLE";
                    |ESTADO_CONTROL nBtnIncorpora, "ENABLE";
                    |ESTADO_CONTROL nBtnLineal, "ENABLE";
               |FINSI;
          |FINSI;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|PROCESO Evento31;
     |SI FSalida = 1; |O FSalida = 2;
          |SELECT #1#31;
          |LEE 000#31=;
          |HAZ TieneLineasTra;
     |FINSI;
     |SI FSalida = 4;
          |HAZ BtnConsTra;
     |FINSI;
|FPRC;

|PROCESO Min31;
     #31#0 = #118#0;
     #31#1 = #118#2;
     #31#2 = #118#4;
     #31#3 = #118#5
     #31#4 = #118#7;
     #31#5 = 000;
|FPRC;

|PROCESO Max31;
     #31#0 = #118#0;
     #31#1 = #118#2;
     #31#2 = #118#4;
     #31#3 = #118#5;
     #31#4 = #118#7;
     #31#5 = 999;
|FPRC;

|PROCESO PobLlega; |TIPO 0;
     |ABRE #3;
     #3#0 = #119#11;
     |LEE 000#3=;
     |SI FSalida = 0;
          #119#12 = #3#1; |PINTA #119#12;
     |SINO;
          |MENAV "0000No existe c¢digo poblaci¢n...";
          |ERROR;
     |FINSI;
     |CIERRA #3;
|FPRC;

|PROCESO Hora; |TIPO 0;
     aAlfa = #119Campo;
     |HAZ FormaHora;
     #119Campo = aAlfa; |PINTA #119Campo;
|FPRC;

|PROCESO PobSal; |TIPO 0;
     |ABRE #3;
     #3#0 = #119#8;
     |LEE 000#3=;
     |SI FSalida = 0;
          #119#9 = #3#1; |PINTA #119#9;
     |SINO;
          |MENAV "0000No existe c¢digo poblaci¢n...";
          |ERROR;
     |FINSI;
     |CIERRA #3;
|FPRC;

|PROCESO Servicio; |TIPO 0;
     |ABRE #23;
     #23#0 = #119#0;
     #23#2 = #119#1;
     #23#4 = #119#2;
     #23#5 = #119#6;
     |LEE 000#23=;
     |SI FSalida = 0;
          #119#7 = #23#6; |PINTA #119#7;
          |SI aConte ! #119#6;
               #119#8 = #23#9; |PINTA #119#8;
               #119#9 = #23#10; |PINTA #119#9;
               #119#10 = #23#13; |PINTA #119#10;
               #119#11 = #23#11; |PINTA #119#11;
               #119#12 = #23#12; |PINTA #119#12;
               #119#13 = #23#14; |PINTA #119#13;
               #119#14 = #23#15; |PINTA #119#14;
               #119#15 = #23#16; |PINTA #119#15;
          |FINSI;
          |SI #23#7 ! 0;
               aAlfa = "0000El servicio esta creado en la plantilla n§:" + #23#7;
               |MENAV aAlfa;
               |ERROR;
          |FINSI;
     |SINO;
          |MENAV "0000No existe c¢digo de servicio...";
          |ERROR;
     |FINSI;
     |CIERRA #23;
|FPRC;

|PROCESO ActServiTempo;
     |ABRE #23;
     #23#0 = #30#0;
     #23#2 = #30#1;
     #23#4 = #30#2;
     #23#5 = #30#6;
     |LEE 101#23=;
     |SI FSalida = 0;
          |SI nForma = 1;
               #23#7 = #30#3;
          |SINO;
               #23#7 = 0;
          |FINSI;
          |GRABA 020#23a;
     |FINSI;
     |CIERRA #23;
|FPRC;

|PROCESO Conte119; |TIPO 7;
     aConte = #119Campo;
|FPRC;

|PROCESO EditaLin;
     aRegLin0 = #30#0;
     nRegLin1 = #30#1;
     aRegLin2 = #30#2;
     nRegLin3 = #30#3;
     nRegLin4 = #30#4;
     nRegLin5 = #30#5;

     |SI nModoLin = 1; |VENTANA 2301, 3098, -1, 17, "Nuevo L¡nea Plantilla"; |FINSI;
     |SI nModoLin = 2; |VENTANA 2301, 3098, -1, 17, "Modifica L¡nea Plantilla"; |FINSI;
     |SI nModoLin = 4; |VENTANA 2301, 3098, -1, 17, "Consulta L¡nea Plantilla"; |FINSI;
     |HAZ PushVenModal;

     |SI nModoLin = 1;
          #30#0 = #118#0;
          #30#1 = #118#2;
          #30#2 = #118#4;
          #30#3 = #118#5;
          #30#4 = #118#7;
          #30#5 = 999;
          |LEE 000#30];
          |SI FSalida = 0;
               |LEE 000#30a;
          |SINO;
               |LEE 000#30u;
          |FINSI;
          |SI FSalida = 0; |Y #30#0 = #118#0; |Y #30#1 = #118#2;
                    |Y #30#2 = #118#4; |Y #30#3 = #118#5; |Y #30#4 = #118#7;
               nLin = #30#5 + 1;
          |SINO;
               nLin = 1;
          |FINSI;
          |DDEFECTO #30;
          #30#0 = #118#0;
          #30#1 = #118#2;
          #30#2 = #118#4;
          #30#3 = #118#5;
          #30#4 = #118#7;
          #30#5 = nLin;
          |GRABA 020#30b;
          |DDEFECTO #119;
          #119#0 = #118#0;
          #119#1 = #118#2;
          #119#2 = #118#4;
          #119#3 = #118#5;
          #119#4 = #118#7;
          #119#5 = nLin;
     |SINO;
          |PARA i = 0; |SI i [ 16; |HACIENDO i = i + 1;
               #119i = #30i;
          |SIGUE;
          nForma = -1; |HAZ ActServiTempo;
     |FINSI;

     |PINPA #0#119; nPantaLin = FSalida;
     |PINDA #0#119;

     |SI nModoLin = 1; |ENDATOS #1#119; |FINSI;
     |SI nModoLin = 2; |ENDATOS #2#119; |FINSI;
     |SI nModoLin = 4; |PAUSA; |FINSI;
     |SI FSalida = 0; |Y nModoLin ! 4;
          #30#0 = #119#0;
          #30#1 = #119#1;
          #30#2 = #119#2;
          #30#3 = #119#3;
          #30#4 = #119#4;
          #30#5 = #119#5;
          |LEE 121#30=;
          |PARA i = 0; |SI i [ 16; |HACIENDO i = i + 1;
               #30i = #119i;
          |SIGUE;
          |GRABA 020#30a;
          nForma = 1; |HAZ ActServiTempo;
          aRegLin0 = #30#0;
          nRegLin1 = #30#1;
          aRegLin2 = #30#2;
          nRegLin3 = #30#3;
          nRegLin4 = #30#4;
          nRegLin5 = #30#5;
     |SINO;
          |SI nModoLin = 1;
               #30#0 = #119#0;
               #30#1 = #119#1;
               #30#2 = #119#2;
               #30#3 = #119#3;
               #30#4 = #119#4;
               #30#5 = #119#5;
               nForma = -1; |HAZ ActServiTempo;
               |BORRA 020#30c;
          |FINSI;
     |FINSI;
     |LIBERA #30;

     |HAZ PopVenModal;

     #30#0 = aRegLin0;
     #30#1 = nRegLin1;
     #30#2 = aRegLin2;
     #30#3 = nRegLin3;
     #30#4 = nRegLin4;
     #30#5 = nRegLin5;
     |LEE 000#30=;
     |REFRESCACONTROL nGridLin;
|FPRC;

|PROCESO BtnAltaLin;
     nModoLin = 1; |HAZ EditaLin;
     |HAZ TieneLineasLin;
|FPRC;

|PROCESO BtnModiLin;
     |LEE 100#30=;
     |SI FSalida ! 0; |ACABA; |FINSI;
     nModoLin = 2; |HAZ EditaLin;
|FPRC;

|PROCESO BtnBajaLin;
     |LEE 100#30=;
     |SI FSalida ! 0; |ACABA; |FINSI;
     aAlfa = "0000N¨Borrar l¡nea plantilla: " + #30#5 + "?";
     |CONFI aAlfa;
     |SI FSalida = 0;
          |BORRA 020#30a;
          |HAZ TieneLineasLin;
          |REFRESCACONTROL nGridLin;
     |FINSI;
     |LIBERA #30;
|FPRC;

|PROCESO BtnConsLin;
     |LEE 000#30=;
     |SI FSalida ! 0; |ACABA; |FINSI;
     nModoLin = 4; |HAZ EditaLin;
|FPRC;

|PROCESO TieneLineasLin;
     |DDEF aAlfa;
     aAlfa = aAlfa + "sctrm030";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          #referen@#0 = #118#0;
          #referen@#1 = #118#2;
          #referen@#2 = #118#4;
          #referen@#3 = #118#5;
          #referen@#4 = #118#7;
          #referen@#5 = 0;
          |LEE 000#referen@.];
          |SI FSalida = 0; |Y #referen@#0 = #118#0; |Y #referen@#1 = #118#2;
                    |Y  #referen@#2 = #118#4; |Y #referen@#3 = #118#5;
                    |Y #referen@#4 = #118#7;
               |SI nModoCab = 4;
                    |ESTADO_CONTROL nBtnAltaLin, "DISABLE";
                    |ESTADO_CONTROL nBtnModiLin, "DISABLE";
                    |ESTADO_CONTROL nBtnBajaLin, "DISABLE";
                    |ESTADO_CONTROL nBtnConsLin, "ENABLE";
               |SINO;
                    |ESTADO_CONTROL nBtnAltaLin, "ENABLE";
                    |ESTADO_CONTROL nBtnModiLin, "ENABLE";
                    |ESTADO_CONTROL nBtnBajaLin, "ENABLE";
                    |ESTADO_CONTROL nBtnConsLin, "ENABLE";
               |FINSI;
          |SINO;
               |SI nModoCab = 4;
                    |ESTADO_CONTROL nBtnAltaLin, "DISABLE";
                    |ESTADO_CONTROL nBtnModiLin, "DISABLE";
                    |ESTADO_CONTROL nBtnBajaLin, "DISABLE";
                    |ESTADO_CONTROL nBtnConsLin, "DISABLE";
               |SINO;
                    |ESTADO_CONTROL nBtnAltaLin, "ENABLE";
                    |ESTADO_CONTROL nBtnModiLin, "DISABLE";
                    |ESTADO_CONTROL nBtnBajaLin, "DISABLE";
                    |ESTADO_CONTROL nBtnConsLin, "DISABLE";
               |FINSI;
          |FINSI;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|PROCESO Evento30;
     |SI FSalida = 1; |O FSalida = 2;
          |SELECT #1#30;
          |LEE 000#30=;
          |HAZ TieneLineasLin;
     |FINSI;
     |SI FSalida = 4;
          |HAZ BtnConsLin;
     |FINSI;
|FPRC;

|PROCESO Min30;
     #30#0 = #118#0;
     #30#1 = #118#2;
     #30#2 = #118#4;
     #30#3 = #118#5
     #30#4 = #118#7;
     #30#5 = 000;
|FPRC;

|PROCESO Max30;
     #30#0 = #118#0;
     #30#1 = #118#2;
     #30#2 = #118#4;
     #30#3 = #118#5;
     #30#4 = #118#7;
     #30#5 = 999;
|FPRC;

|PROCESO Plantilla; |TIPO 0;
     |SI nModoCab = 1;
          |SI #118#5 = 0;
               |MENAV "0000La plantilla no puede ser '0'...";
               |ERROR; |ACABA;
          |FINSI;
     |FINSI;
/*
     |ABRE #11;
     #11#0 = #118#5;
     |LEE 000#11=;
     |SI FSalida = 0;
          #118#6 = #11#1; |PINTA #118#6;
     |SINO;
          |MENAV "0000No existe c¢digo plantilla...";
          |ERROR;
     |FINSI;
     |CIERRA #11;
*/
|FPRC;

|PROCESO Sentido; |TIPO 0;
     |SI #118#4 = "I";
          #118#11 = "IDA";
     |SINO;
          #118#11 = "VUELTA";
     |FINSI;
     |PINTA #118#11;
|FPRC;

|PROCESO CheqKmTra;
     nHay = 1; |ERROR10;
|FPRC;

|DEFBUCLE CheqKmTra;
     #21#1;
     ;
     #118#2, "    ", "    ";
     #118#2, "zzzz", "zzzz";
     ;
     NULL, CheqKmTra;
|FIN;

|PROCESO CheqTari;
     nHay = 1; |ERROR10;
|FPRC;

|DEFBUCLE CheqTari;
     #20#1;
     ;
     #118#0, 00, 0000, #118#2, "   ", "    ", "    ";
     #118#0, 99, 9999, #118#2, "zzz", "zzzz", "zzzz";
     ;
     NULL, CheqTari;
|FIN;

|PROCESO LinServi; |TIPO 0;
     |ABRE #12;
     #12#0 = #118#2;
     |LEE 000#12=;
     |SI FSalida = 0;
          #118#3 = #12#1; |PINTA #118#3;

          nError = 0;
          nHay = 0;
          |BUCLE CheqTari;
          |SI nHay = 0;
               |MENAV "0000No existe registro en Tarifas Trayectos...";
               nError = 1;
          |FINSI;
          nHay = 0;
          |BUCLE CheqKmTra;
          |SI nHay = 0;
               |MENAV "0000No existe registro en Kil¢mentros Trayectos...";
               nError = 1;
          |FINSI;
          |SI nError = 1; |ERROR; |FINSI;
     |SINO;
          |MENAV "0000No existe c¢digo l¡nea servicio...";
          |ERROR;
     |FINSI;
     |CIERRA #12;
|FPRC;

|PROCESO Temporada; |TIPO 0;
     |ABRE #8;
     #8#0 = #118#0;
     |LEE 000#8=;
     |SI FSalida = 0;
          #118#1 = #8#1; |PINTA #118#1;
     |SINO;
          |MENAV "0000No existe c¢digo temporada...";
          |ERROR;
     |FINSI;
     |CIERRA #8;
|FPRC;

|PROCESO Genera31;
     #31#4 = #29#7;
     |GRABA 020#31n;
|FPRC;

|DEFBUCLE Genera31;
     #31#1;
     ;
     #29#0, #29#2, #29#4, #29#5, nLin, 000;
     #29#0, #29#2, #29#4, #29#5, nLin, 999;
     ;
     NULL, Genera31;
|FIN;

|PROCESO Genera30;
     #30#4 = #29#7;
     |GRABA 020#30n;
|FPRC;

|DEFBUCLE Genera30;
     #30#1;
     ;
     #29#0, #29#2, #29#4, #29#5, nLin, 000;
     #29#0, #29#2, #29#4, #29#5, nLin, 999;
     ;
     NULL, Genera30;
|FIN;

|PROCESO Min2;
     #refere2@#0 = #referen@#0;
     #refere2@#1 = #referen@#2;
     #refere2@#2 = #referen@#4;
     #refere2@#3 = #referen@#5
     #refere2@#4 = #referen@#7;
     #refere2@#5 = 000;
|FPRC;

|PROCESO Max2;
     #refere2@#0 = #referen@#0;
     #refere2@#1 = #referen@#2;
     #refere2@#2 = #referen@#4;
     #refere2@#3 = #referen@#5
     #refere2@#4 = #referen@#7;
     #refere2@#5 = 999;
|FPRC;

|PROCESO Min1;
     #refere1@#0 = #referen@#0;
     #refere1@#1 = #referen@#2;
     #refere1@#2 = #referen@#4;
     #refere1@#3 = #referen@#5
     #refere1@#4 = #referen@#7;
     #refere1@#5 = 000;
|FPRC;

|PROCESO Max1;
     #refere1@#0 = #referen@#0;
     #refere1@#1 = #referen@#2;
     #refere1@#2 = #referen@#4;
     #refere1@#3 = #referen@#5
     #refere1@#4 = #referen@#7;
     #refere1@#5 = 999;
|FPRC;

|PROCESO GeneraNuevo;
     |SI #29#7 ! 0;
          |DDEF aPath;
          aAlfa = aPath + "sctrm029";
          |CARGA_DEF aAlfa, referen@;
          |SI FSalida = 0;
               |ABRE #referen@;
               #referen@#0 = #29#0;
               #referen@#2 = #29#2;
               #referen@#4 = #29#4;
               #referen@#5 = #29#5;
               #referen@#7 = #29#7 - 1;
               |LEE 000#referen@.=;
               |SI FSalida = 0;
                    aAlfa = aPath + "sctrm030";
                    |CARGA_DEF aAlfa, refere1@;
                    aAlfa = aPath + "sctrm031";
                    |CARGA_DEF aAlfa, refere2@;

                    |VENTANA 0501, 3098, -1, 17, "Plantilla Frecuencia Servicios Anterior";
                    |HAZ PushVenModal;

                    |PARA i = 0; |SI i [ 9; |HACIENDO i = i + 1;
                         #122i = #referen@#i#;
                    |SIGUE;
                    |SI #122#4 = "I"; #122#10 = "IDA"; |SINO; #122#10 = "VUELTA"; |FINSI;

                    |PINPA #0#122;
                    |PINDA #0#122;
                    nRango = 4 + 8 + 16 + 32;
                    |ABRE #refere1@;
                    |ABRE #refere2@;
                    |LINEAL_SIMPLE #1#refere1@, nRango, 1202, 2098, Min1, Max1, NULL;
                    |LINEAL_SIMPLE #1#refere2@, nRango, 2202, 2998, Min2, Max2, NULL;
                    |PTEC 802;
                    |PAUSA;
                    |AVISO;
                    |CONFI "0000S¨Generar tabla servicio y trayectos a partir de esta?";
                    |SI FSalida = 0;
                         nLin = #referen@#7;
                         |BUCLE Genera30;
                         |BUCLE Genera31;
                         |REFRESCACONTROL nGridLin;
                         |REFRESCACONTROL nGridTra;
                    |FINSI;
                    |CIERRA #refere2@;
                    |CIERRA #refere1@;

                    |HAZ PopVenModal;
                    |DESCARGA_DEF #refere2@;
                    |DESCARGA_DEF #refere1@;
               |FINSI;
               |CIERRA #referen@;
               |DESCARGA_DEF #referen@;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Chequea; |TIPO 0;
     |SI nModoCab = 1; |Y nBloquea = 0;
          |DDEFECTO #29;
          #29#0 = #118#0;
          #29#2 = #118#2;
          #29#4 = #118#4;
          #29#5 = #118#5;
          #29#7 = #118#7;
          |GRABA 000#29b;
          |SI FSalida ! 0;
               |MENAV "0000Registro existente...";
               |ERROR;
          |SINO;
               |HAZ GeneraNuevo;
               |C_M #118#0, 1, "N"; |PINTA #118#0;
               |C_M #118#2, 1, "N"; |PINTA #118#2;
               |C_M #118#4, 1, "N"; |PINTA #118#4;
               |C_M #118#5, 1, "N"; |PINTA #118#5;
               |C_M #118#7, 1, "N"; |PINTA #118#7;
               nBloquea = 1;

               |ESTADO_CONTROL nBtnAltaLin, "ENABLE";
               |ESTADO_CONTROL nBtnAltaTra, "ENABLE";
               |ESTADO_CONTROL nBtnIncorpora, "ENABLE";
               aAlfa = "|X000"; aAlfa = #118aAlfa; nId = aAlfa;
               |ESTADO_CONTROL nId, "ENABLE";
               |REFRESCACONTROL nGridLin;
               |REFRESCACONTROL nGridTra;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Trayecto7; |TIPO 7;
     |SI nModoCab = 1; |Y nBloquea = 0;
          #29#0 = #118#0;
          #29#2 = #118#2;
          #29#4 = #118#4;
          #29#5 = #118#5;
          #29#7 = 99;
          |LEE 000#29];
          |SI FSalida = 0;
               |LEE 000#29a;
          |SINO;
               |LEE 000#29u;
          |FINSI;
          |SI FSalida = 0; |Y #29#0 = #118#0; |Y #29#2 = #118#2;
                    |Y #29#4 = #118#4; |Y #29#5 = #118#5;
               nLin = #29#7 + 1;
          |SINO;
               nLin = 0;
          |FINSI;
          #118#7 = nLin; |PINTA #118#7;
     |FINSI;
|FPRC;

|PROCESO Valida7; |TIPO 7;
     |SI nModoCab = 1;
          aAlfa = "|X000"; aAlfa = #118aAlfa; nId = aAlfa;
          |ESTADO_CONTROL nId, "DISABLE";
     |FINSI;
|FPRC;

|PROCESO PintaCampos;
     |HAZ Sentido;
|FPRC;

|PROCESO Borra31;
     |BORRA 020#31a;
|FPRC;

|DEFBUCLE Borra31;
     #31#1;
     ;
     #29#0, #29#2, #29#4, #29#5, #29#7, 000;
     #29#0, #29#2, #29#4, #29#5, #29#7, 999;
     be;
     NULL, Borra31;
|FIN;

|PROCESO Borra30;
     |BORRA 020#30a;
     nForma = -1; |HAZ ActServiTempo;
|FPRC;

|DEFBUCLE Borra30;
     #30#1;
     ;
     #29#0, #29#2, #29#4, #29#5, #29#7, 000;
     #29#0, #29#2, #29#4, #29#5, #29#7, 999;
     be;
     NULL, Borra30;
|FIN;

|PROCESO Edita;
     aReg0 = #29#0;
     nReg2 = #29#2;
     aReg4 = #29#4;
     nReg5 = #29#5;
     nReg7 = #29#7;

     |SI nModoCab = 1; |VENTANA 0501, 3098, -1, 17, "Nueva Plantilla Frecuencia Servicios"; |FINSI;
     |SI nModoCab = 2; |VENTANA 0501, 3098, -1, 17, "Modifica Plantilla Frecuencia Servicios"; |FINSI;
     |SI nModoCab = 4; |VENTANA 0501, 3098, -1, 17, "Consulta Plantilla Frecuencia Servicios"; |FINSI;
     |HAZ PushVenModal;

     |SI nModoCab = 1;
          |DDEFECTO #118;
          |C_M #118#0, 1, "S";
          |C_M #118#2, 1, "S";
          |C_M #118#4, 1, "S";
          |C_M #118#5, 1, "S";
          |C_M #118#7, 1, "S";
     |SINO;
          |PARA i = 0; |SI i [ 10; |HACIENDO i = i + 1;
               #118i = #29i;
          |SIGUE;
          |C_M #118#0, 1, "N";
          |C_M #118#2, 1, "N";
          |C_M #118#4, 1, "N";
          |C_M #118#5, 1, "N";
          |C_M #118#7, 1, "N";
     |FINSI;

     |PINPA #0#118; nPantaCab = FSalida;
     |PINDA #0#118;
     |HAZ PintaCampos;

     |CONTROL_SIMPLE nPantaCab, "BOTON,{{193}}Alta", 1113, 1123, BtnAltaLin;
     nBtnAltaLin = FSalida;
     |CONTROL_SIMPLE nPantaCab, "BOTON,{{197}}Modificar", 1125, 1135, BtnModiLin;
     nBtnModiLin = FSalida;
     |CONTROL_SIMPLE nPantaCab, "BOTON,{{199}}Baja", 1137, 1147, BtnBajaLin;
     nBtnBajaLin = FSalida;
     |CONTROL_SIMPLE nPantaCab, "BOTON,{{155}}Consulta", 1149, 1159, BtnConsLin;
     nBtnConsLin = FSalida;

     |CONTROL_SIMPLE nPantaCab, "BOTON,{{193}}Alta", 2113, 2123, BtnAltaTra;
     nBtnAltaTra = FSalida;
     |CONTROL_SIMPLE nPantaCab, "BOTON,{{197}}Modificar", 2125, 2135, BtnModiTra;
     nBtnModiTra = FSalida;
     |CONTROL_SIMPLE nPantaCab, "BOTON,{{199}}Baja", 2137, 2147, BtnBajaTra;
     nBtnBajaTra = FSalida;
     |CONTROL_SIMPLE nPantaCab, "BOTON,{{155}}Consulta", 2149, 2159, BtnConsTra;
     nBtnConsTra = FSalida;
     |CONTROL_SIMPLE nPantaCab, "BOTON,{{137}}Incorporar", 2161, 2172, BtnIncorpora;
     nBtnIncorpora = FSalida;
     |CONTROL_SIMPLE nPantaCab, "BOTON,{{137}}Renumerar", 2174, 2185, BtnRenumera;
     nBtnRenumera = FSalida;
     |CONTROL_SIMPLE nPantaCab, "BOTON,{{137}}Lineal", 2187, 2198, BtnLineal;
     nBtnLineal = FSalida;

     |SI nModoCab = 1;
          |ESTADO_CONTROL nBtnAltaLin, "DISABLE";
          |ESTADO_CONTROL nBtnModiLin, "DISABLE";
          |ESTADO_CONTROL nBtnBajaLin, "DISABLE";
          |ESTADO_CONTROL nBtnConsLin, "DISABLE";
          |ESTADO_CONTROL nBtnAltaTra, "DISABLE";
          |ESTADO_CONTROL nBtnModiTra, "DISABLE";
          |ESTADO_CONTROL nBtnBajaTra, "DISABLE";
          |ESTADO_CONTROL nBtnConsTra, "DISABLE";
          |ESTADO_CONTROL nBtnIncorpora, "DISABLE";
          |ESTADO_CONTROL nBtnRenumera, "DISABLE";
          |ESTADO_CONTROL nBtnLineal, "DISABLE";
     |FINSI;

     nRango = 4 + 8 + 16 + 32;
     |LINEAL_SIMPLE #1#30, nRango, 1202, 2098, Min30, Max30, Evento30;
     nGridLin = FSalida;
     |LINEAL_SIMPLE #1#31, nRango, 2202, 2998, Min31, Max31, Evento31;
     nGridTra = FSalida;

     nBloquea = 0;
     |SI nModoCab = 1; |ENDATOS #1#118; |FINSI;
     |SI nModoCab = 2; |ENDATOS #2#118; |FINSI;
     |SI nModoCab = 4; |PAUSA; |FINSI;
     |SI FSalida = 0; |Y nModoCab ! 4;
          #29#0 = #118#0;
          #29#2 = #118#2;
          #29#4 = #118#4;
          #29#5 = #118#5;
          #29#7 = #118#7;
          |LEE 121#29=;
          |PARA i = 0; |SI i [ 10; |HACIENDO i = i + 1;
               #29i = #118i;
          |SIGUE;
          |GRABA 020#29a;
          aReg0 = #29#0;
          nReg2 = #29#2;
          aReg4 = #29#4;
          nReg5 = #29#5;
          nReg7 = #29#7;
     |SINO;
          |SI nBloquea = 1;
               #29#0 = #118#0;
               #29#2 = #118#2;
               #29#4 = #118#4;
               #29#5 = #118#5;
               #29#7 = #118#7;
               |BORRA 020#29c;
               |BUCLE Borra30;
               |BUCLE Borra31;
          |FINSI;
     |FINSI;
     |LIBERA #29;

     |HAZ PopVenModal;

     #29#0 = aReg0;
     #29#2 = nReg2;
     #29#4 = aReg4;
     #29#5 = nReg5;
     #29#7 = nReg7;
     |LEE 000#29=;
     |REFRESCACONTROL nGridCab;
|FPRC;

|PROCESO BtnAlta;
     nModoCab = 1; |HAZ Edita;
     |HAZ TieneLineas;
|FPRC;

|PROCESO BtnModi;
     |LEE 100#29=;
     |SI FSalida ! 0; |ACABA; |FINSI;
     nModoCab = 2; |HAZ Edita;
|FPRC;

|PROCESO BtnBaja;
     |LEE 100#29=;
     |SI FSalida ! 0; |ACABA; |FINSI;
     aAlfa = "0000N¨Borrar plantilla: " + #29#0 + "/" + #29#2 + "/" + #29#4 + "/" + #29#5 + "/" + #29#6;
     |QBF aAlfa;
     aAlfa = aAlfa + "?";
     |CONFI aAlfa;
     |SI FSalida = 0;
          |BORRA 020#29a;
          |BUCLE Borra30;
          |BUCLE Borra31;
          |HAZ TieneLineas;
          |REFRESCACONTROL nGridCab;
     |FINSI;
     |LIBERA #29;
|FPRC;

|PROCESO BtnCons;
     |LEE 000#29=;
     |SI FSalida ! 0; |ACABA; |FINSI;
     nModoCab = 4; |HAZ Edita;
|FPRC;

|PROCESO EnviaMail;
     aMail = #224#197; |QBF aMail;
     |SI aMail ! "";
          aIP = "";
          |SI #100#11 = "L";
               |IP_REMOTO aIP;
          |SINO;
               |SI #100#11 = "S";
                    |IP_LOCAL aIP;
               |SINO;
                    aIP = #100#10; |QBF aIP;
               |FINSI;
          |FINSI;
          aServidor = #100#12; |QBF aServidor;
          aFrom = #100#13; |QBF aFrom;
          aTo = aMail;
          aSubject = #123#0; |QBF aSubject;
          aMensaje = "$$$$" + aFicMsg;
          aDjunto = aFicPdf;
          |DSCORREO_ENVIA aIP, aServidor, aFrom, aTo, aSubject, aMensaje, aDjunto;
     |FINSI;
|FPRC;

|DEFBUCLE EnviaMail;
     #224#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, EnviaMail;
|FIN;

|PROCESO sctrm031P;
     |PRINT;
|FPRC

|DEFBUCLE sctrm031P;
     #31#1;
     ;
     #29#0, #29#2, #29#4, #29#5, #29#7, 000;
     #29#0, #29#2, #29#4, #29#5, #29#7, 999;
     ;
     NULL, sctrm031P;
|FIN;

|PROCESO sctrm030P;
     |PRINT;
|FPRC;

|DEFBUCLE sctrm030P;
     #30#1;
     ;
     #29#0, #29#2, #29#4, #29#5, #29#7, 000;
     #29#0, #29#2, #29#4, #29#5, #29#7, 999;
     ;
     NULL, sctrm030P;
|FIN;

|PROCESO ImprimePDF;
     |DFICE aFicMsg;
     aFicMsg = aFicMsg + Usuario + ".msg";
     |XABRE "W", aFicMsg, nHandle;
     |SI FSalida ] 0;
          |PARA i = 1; |SI i [ 10; |HACIENDO i = i + 1;
               aAlfa = #123i;
               |XGRABA nHandle, aAlfa;
          |SIGUE;
          |XCIERRA nHandle;
     |SINO;
          |MENAV "0000Error al crear fichero con el cuerpo del mensaje...";
     |FINSI;

     aIP = ""; |IP_REMOTO aIP;
     aFicPdf = #29#0; |QBF aFicPdf;
     aFicPdf = aFicPdf + "_" + #29#2 + #29#4 + "_" + #29#5 + "_" + #29#7 + ".pdf";

     |SI aIP = "";
          |DFICE aPDF; aPDF = aPDF + aFicPdf;
          |FBORRA aPDF;
     |SINO;
          |ESPECIFICA "RBASS", aLocal;
          aPDF = aLocal;
          aPDF = aPDF + aFicPdf;
          |RFBORRA aPDF;
     |FINSI;
     Impresora = "CrystalReport;" + aPDF;
     |IMPRE -1;
     |SI FSalida = 0;
          aInf = #57#3; |QBF aInf;
          |INFOR "sctrm029";
          |SI FSalida = 0;
               enTipo = 1; |BUCLE sctrm030P;
               enTipo = 2; |BUCLE sctrm031P;
               |PIEINF;
               |FININF;
          |SINO;
               aInf = "0000Error en in forme:" + aInf;
               |MENAV aInf;
          |FINSI;
          |FINIMP;

          |SI aIP ! "";
               |DFICE aFic; aFic = aFic + aFicPdf;
               |RECIBE_FICHERO aPDF, aFic;
               |SI FSalida ! 0;
                    |MENAV "0000Error al copiar fichero al servidor...";
                    nError = 1;
               |FINSI;
               |RFBORRA aPDF;
          |SINO;
               aFic = aPDF;
          |FINSI;

          |BUCLE EnviaMail;
     |FINSI;
|FPRC;

|PROCESO Imprime;
     Impresora = "CrystalReport";
     |IMPRE -1;
     |SI FSalida = 0;
          aInf = #57#3; |QBF aInf;
          |INFOR aInf;
          |SI FSalida = 0;
               enTipo = 1; |BUCLE sctrm030P;
               enTipo = 2; |BUCLE sctrm031P;
               |PIEINF;
               |FININF;
          |SINO;
               aInf = "0000Error en informe:" + aInf;
               |MENAV aInf;
          |FINSI;
          |FINIMP;
     |FINSI;
|FPRC;

|PROCESO BtnImpr;
     |LEE 000#29=;
     |SI FSalida ! 0; |ACABA; |FINSI;
     |HAZ Imprime;
|FPRC;

|PROCESO BtnPDF;
     |LEE 000#29=;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |VENTANA 1401, 2898, -1, 17, "Envio correo PDF a agencias";
     |HAZ PushVenModal;
     |DDEFECTO #123;
     |PINPA #0#123;
     |PINDA #0#123;
     |ENDATOS #1#123;
     |SI FSalida = 0;
          |HAZ ImprimePDF;
     |FINSI;
     |HAZ PopVenModal;
|FPRC;

|PROCESO Evento29;
     |SI FSalida = 1; |O FSalida = 2;
          |SI enLinServi = 0;
               |SELECT #1#29;
          |SINO;
               |SELECT #2#29;
          |FINSI;
          |LEE 000#29=;
          |HAZ TieneLineas;
     |FINSI;
     |SI FSalida = 4;
          |HAZ BtnCons;
     |FINSI;
|FPRC;

|PROCESO TieneLineas;
     |DDEF aAlfa;
     aAlfa = aAlfa + "sctrm029";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          |SI enLinServi = 0;
               |LEE 000#referen@.p;
          |SINO;
               |SELECT #2#referen@;
               |DDEFECTO #referen@;
               #referen@#2 = enLinServi;
               |LEE 000#referen@.];
               |SI FSalida ! 0; |O #referen@#2 ! enLinServi;
                    FSalida = "1";
               |FINSI;
          |FINSI;
          |SI FSalida = 0;
               |ESTADO_CONTROL nBtnModi, "ENABLE";
               |ESTADO_CONTROL nBtnBaja, "ENABLE";
               |ESTADO_CONTROL nBtnCons, "ENABLE";
               |ESTADO_CONTROL nBtnImpr, "ENABLE";
               |ESTADO_CONTROL nBtnPDF, "ENABLE";
          |SINO;
               |ESTADO_CONTROL nBtnModi, "DISABLE";
               |ESTADO_CONTROL nBtnBaja, "DISABLE";
               |ESTADO_CONTROL nBtnCons, "DISABLE";
               |ESTADO_CONTROL nBtnImpr, "DISABLE";
               |ESTADO_CONTROL nBtnPDF, "DISABLE";
          |FINSI;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|PROCESO LogoPanta;
     eaNomLogo = #100#1;
     |HAZ TraeLogoPan;
     enPantaLogo = nPanta;
     |HAZ PintaLogoPan;
|FPRC;

|PROCESO BtnTodos;
     nSwFin = 1;
     enLinServi = 0;
     |PTEC 807;
|FPRC;

|PROCESO Min29;
     #29#2 = enLinServi;
     #29#0 = "          ";
     #29#4 = " ";
     #29#5 = 000;
     #29#7 = 00;
|FPRC;

|PROCESO Max29;
     #29#2 = enLinServi;
     #29#0 = "zzzzzzzzzz";
     #29#4 = "z";
     #29#5 = 000;
     #29#7 = 99;
|FPRC;

|PROGRAMA;
     |ABRE #100; |LEE 000#100p; |CIERRA #100;
     |ABRE #57; |LEE 000#57p; |CIERRA #57;

     |PINPA #0#0; nPanta = FSalida;
     |PINDA #0#0;
     |HAZ LogoPanta;

     |CONTROL_SIMPLE nPanta, "BOTON,{{193}}Alta", 1002, 1012, BtnAlta;
     nBtnAlta = FSalida;
     |CONTROL_SIMPLE nPanta, "BOTON,{{197}}Modificar", 1014, 1024, BtnModi;
     nBtnModi = FSalida;
     |CONTROL_SIMPLE nPanta, "BOTON,{{199}}Baja", 1026, 1036, BtnBaja;
     nBtnBaja = FSalida;
     |CONTROL_SIMPLE nPanta, "BOTON,{{155}}Consulta", 1038, 1048, BtnCons;
     nBtnCons = FSalida;
     |CONTROL_SIMPLE nPanta, "BOTON,{{205}}Impresi¢n", 1050, 1060, BtnImpr;
     nBtnImpr = FSalida;

     |CONTROL_SIMPLE nPanta, "BOTON,{{205}}PDF Agencias", 1080, 1098, BtnPDF;
     nBtnPDF = FSalida;

     |CONTROL_SIMPLE nPanta, "BOTON,{{230}}Todos", 1088, 1098, BtnTodos;
     nBtnTodos = FSalida;

     |CONTROL_SIMPLE nPanta, "BOTON,{{137}}Duplicar servicios", 2902, 2922, BtnDuplicar;
     nBtnDuplica = FSalida;

     |ABRET #29;
     |ABRET #30;
     |ABRET #31;
     |PARA nSwFin = 1; |SI nSwFin = 1; |HACIENDO;
          |HAZ TieneLineas;
          nSwFin = 0;
          nRango = 4 + 8 + 16 + 32;
          |SI enLinServi = 0;
               |ESTADO_CONTROL nBtnTodos, "DISABLE";
               |LINEAL_SIMPLE #1#29, nRango, 1102, 2799, NULL, NULL, Evento29;
          |SINO;
               |LINEAL_SIMPLE #2#29, nRango, 1102, 2799, Min29, Max29, Evento29;
          |FINSI;
          nGridCab = FSalida;
          enCtrFin = nGridCab;
          |HAZ EsperaFin;
          |PULSATECLA;
          |DESTRUYECONTROL nGridCab;
     |SIGUE;
     |CIERRAT #31;
     |CIERRAT #30;
     |CIERRAT #29;
|FPRO;
