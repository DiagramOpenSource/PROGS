|FICHEROS;
     iber0094 #0;
     dsm00200 #1;        ||Control Parametros CENTRAL
     dsm00201 #10;       ||Control Parametros CENTRO
|FIN;

|VARIABLES;
     aAlfa = "";
     ip_serv = "";
     serv_correo = "";
     from = "";
     to = "";
     subject = "";
     mensaje = "";
     ficheros = "";
     aMenLog = "";
     nErrLog = 0;
     aMensaje = "";
     aFichero = "";
     aNomPaq = "";
     aTipo = "";
     aDirOri = "";

     &eaFicEnvio = "";
     &eaDestino = "";
     &enSwCentral = 0;
|FIN;


|PROGRAMA;
     |SI enSwCentral = 1;
          |ABRE #1;
          |LEE 010#1p;
          |SI FSalida ! 0;
               |MENAV "0000No se han establecido los parametros de envio";
          |SINO;
               ip_serv = "";
               |SI #1#1 = 0;|Y #1#2 = 0;|Y #1#3 = 0;|Y #1#4 = 0;
                    |IP_LOCAL ip_serv;
               |SINO;
                    ip_serv = #1#1+"."+#1#2+"."+#1#3+"."+#1#4;
               |FINSI;
               serv_correo = #1#5;
               from = #1#6;
               subject = "ECO. Paquete actualizado.";
               mensaje = "ECO. Paquete actualizado.";
               to = eaDestino;
               ficheros = eaFicEnvio;

               |QBT ip_serv ;
               |QBF serv_correo;
               |QBF from;
               |QBF to;
               |QBF subject;
               |QBF mensaje;
               |QBF ficheros;
               |MENSA "0000Enviando fichero ...";
               |DSCORREO_ENVIA ip_serv,serv_correo,from,to,subject,mensaje,ficheros;
               |SI FSalida ! 0;
                    aAlfa = "0000Error al enviar a: " + to;
                    |MENAV aAlfa;
               |FINSI;
          |FINSI;
          |CIERRA #1;
     |SINO;
          |ABRE #10;
          |LEE 010#10p;
          |SI FSalida ! 0;
               |MENAV "0000No se han establecido los parametros de envio";
          |SINO;
               ip_serv = "";
               |SI #10#1 = 0;|Y #10#2 = 0;|Y #10#3 = 0;|Y #10#4 = 0;
                    |IP_LOCAL ip_serv;
               |SINO;
                    ip_serv = #10#1+"."+#10#2+"."+#10#3+"."+#10#4;
               |FINSI;
               serv_correo = #10#5;
               from = #10#6;
               subject = "ECO. Paquete actualizado.";
               mensaje = "ECO. Paquete actualizado.";
               to = eaDestino;
               ficheros = eaFicEnvio;

               |QBT ip_serv ;
               |QBF serv_correo;
               |QBF from;
               |QBF to;
               |QBF subject;
               |QBF mensaje;
               |QBF ficheros;
               |MENSA "0000Enviando fichero ...";
               |DSCORREO_ENVIA ip_serv,serv_correo,from,to,subject,mensaje,ficheros;
               |SI FSalida ! 0;
                    aAlfa = "0000Error al enviar a: " + to;
                    |MENAV aAlfa;
               |FINSI;
          |FINSI;
          |CIERRA #10;
     |FINSI;
|FPRO;
