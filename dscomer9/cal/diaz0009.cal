|FICHEROS;
     diaz0009,MANTE;
     diam0009;
     diam0015;
     diam0016;
     diam0017,MANTE;
     diam0018,MANTE;

     diam0019;
     diam0020;
     diam0021;

     diaw0024;

     :/dspartes/def/dsasis03;
|FIN;

|VARIABLES;
     nSwBorra = 0;
     nModiHard = 0;
     &Tempo = "";
     aTmp24 = "";
     i = 0;
     nTipo = 0;
     aEstado = "";
     nCampo1     = 0;
     nCampo2     = 0;
     nError      = 0;
     nRango      = 0;
     nCalcu1     = 0;
     nCalcu2     = 0;
     nResta      = 0;
     nLinea      = 0;
     nSwHay      = 0;
     nSubBoton1  = 0;
     nSubBoton2  = 0;
     nSubBoton3  = 0;
     nSubBoton4  = 0;
     nSubBoton5  = 0;
     nSubBoton6  = 0;
     nSubBoton7  = 0;
     nSubBoton8  = 0;
     nSubBoton9  = 0;
     nSubBoton10  = 0;
     nSubVentana = 0;
     nHandle     = 0;
     nPosIni     = 0;
     nPosFin     = 0;
     nCalc       = 0;

     aTecla         = "";
     aAlfa          = "";
     aAlfa1         = "";
     aAlfa2         = "";
     aAlfa3         = "";
     aFam           = "";
     aEsc1          = "";
     aEsc2          = "";
     aRetu          = "";
     aOrigen        = "";
     aDestino       = "";
     aRuta          = "";
     aExtension     = "";
     aBase          = "";
     aDirDocumentos = "";
     aPunto         = "";
     aAbre          = "";
     aDocumentos    = "";

     &enModif    = 0;
     &enPanta    = 0;
     &enDesdePed = 0;
     &enSalida   = 0;
     &eaCompras  = "";
     &enHard     = 0;
|FIN;

|PROCESO Tipo80z09;  |TIPO 80;
     ||FSalida = 4399;
|FPRC;

|PROCESO ClaveBaja18;
     #diam0018#0 = #diaz0009#0;
     #diam0018#1 = #diaz0009#1;
     #diam0018#2 = #diaz0009#13;
     #diam0018#3 = 10;
|FPRC;

|PROCESO ClaveAlta18;
     #diam0018#0 = #diaz0009#0;
     #diam0018#1 = #diaz0009#1;
     #diam0018#2 = #diaz0009#13;
     #diam0018#3 = 999;
|FPRC;

|PROCESO diam0018;
     #diaz0009#105 = #diaz0009#105 + #diam0018#7;
|FPRC;

|DEFBUCLE diam0018;
     #diam0018#1;
     ;
     #diaz0009#0, #diaz0009#1, #diaz0009#13, 001;
     #diaz0009#0, #diaz0009#1, #diaz0009#13, 999;
     ;
     NULL, diam0018;
|FIN;

|PROCESO CalculaPresupuesto;
     #diaz0009#105 = 0; |BUCLE diam0018;

     |PINTA #diaz0009#105;

     |SI enDesdePed = 1;  |Y #diaz0009#105 ! #diaz0009#116;
         |MENAV "0000 No es igual el Presupuesto al Importe del Pedido.";
         |ERROR;
     |FINSI;
|FPRC;

|PROCESO SacaPresupuesto;  |TIPO 0;
     |VENTANA 0501, 2599, -1, -1, "";
     nSubVentana = FSalida;

     |ABRET #diam0018;

     || No esta en pedido
     nRango = 1 + 4 + 8 + 16;

     || Esta en pedido
     |SI enModif = 1;  nRango = 4 + 8 + 16; |FINSI;

     nPosIni = 0701; nPosFin = 2399;

     |LINEAL_SIMPLE #1#diam0018, nRango, nPosIni, nPosFin, ClaveBaja18, ClaveAlta18, NULL;
     |CIERRAT #diam0018;

     |FINVENTANA nSubVentana;

     |SI enModif = 0;
         |HAZ CalculaPresupuesto;
         |HAZ Ajusta;
     |FINSI;

     |ERROR;
|FPRC;

|PROCESO ClaveBaja24;
     #diaw0024#0 = #diaz0009#0;
     #diaw0024#1 = #diaz0009#1;
     #diaw0024#2 = #diaz0009#13;
     #diaw0024#4 = 1;
|FPRC;

|PROCESO ClaveAlta24;
     #diaw0024#0 = #diaz0009#0;
     #diaw0024#1 = #diaz0009#1;
     #diaw0024#2 = #diaz0009#13;
     #diaw0024#4 = 999;
|FPRC;

|PROCESO diam0017;
     |SI #diam0017#3 = #diaz0009#32;
          #diaz0009#34 = #diaz0009#34 + #diam0017#7;
          #diaz0009#35 = #diam0017#8;
          #diaz0009#36 = #diaz0009#34 * #diaz0009#35;
     |FINSI;
     |SI #diam0017#3 = #diaz0009#37;
          #diaz0009#39 = #diaz0009#39 + #diam0017#7;
          #diaz0009#40 = #diam0017#8;
          #diaz0009#41 = #diaz0009#39 * #diaz0009#40;
     |FINSI;
     |SI #diam0017#3 = #diaz0009#42;
          #diaz0009#44 = #diaz0009#44 + #diam0017#7;
          #diaz0009#45 = #diam0017#8;
          #diaz0009#46 = #diaz0009#44 * #diaz0009#45;
     |FINSI;
     |SI #diam0017#3 = #diaz0009#47;
          #diaz0009#49 = #diaz0009#49 + #diam0017#7;
          #diaz0009#50 = #diam0017#8;
          #diaz0009#51 = #diaz0009#49 * #diaz0009#50;
     |FINSI;
     |SI #diam0017#3 = #diaz0009#52;
          #diaz0009#54 = #diaz0009#54 + #diam0017#7;
          #diaz0009#55 = #diam0017#8;
          #diaz0009#56 = #diaz0009#54 * #diaz0009#55;
     |FINSI;
     |SI #diam0017#3 = #diaz0009#57;
          #diaz0009#59 = #diaz0009#59 + #diam0017#7;
          #diaz0009#60 = #diam0017#8;
          #diaz0009#61 = #diaz0009#59 * #diaz0009#60;
     |FINSI;
     |SI #diam0017#3 = #diaz0009#67;
          #diaz0009#69 = #diaz0009#69 + #diam0017#7;
          #diaz0009#70 = #diam0017#8;
          #diaz0009#71 = #diaz0009#69 * #diaz0009#70;
          #diaz0009#72 = #diaz0009#72 + #diam0017#11;
          #diaz0009#73 = #diaz0009#72;
          #diaz0009#106 = #diaz0009#106 + #diam0017#7; || km
     |FINSI;
     |SI #diam0017#3 = #diaz0009#74;
          #diaz0009#76 = #diaz0009#76 + #diam0017#9;
          #diaz0009#78 = #diaz0009#78 + #diam0017#11;
     |FINSI;
     |SI #diam0017#3 = #diaz0009#82;
          #diaz0009#84 = #diaz0009#84 + #diam0017#9;
     |FINSI;
     |SI #diam0017#3 = #diaz0009#86;
          #diaz0009#88 = #diaz0009#88 + #diam0017#9;
          #diaz0009#90 = #diaz0009#90 + #diam0017#11;
     |FINSI;
     |SI #diam0017#3 = #diaz0009#94;
          #diaz0009#96 = #diaz0009#96 + #diam0017#9;
          #diaz0009#97 = #diaz0009#96;
     |FINSI;
     |SI #diam0017#3 = #diaz0009#98;
          #diaz0009#100 = #diaz0009#100 + #diam0017#9;
          #diaz0009#101 = #diaz0009#100;
     |FINSI;
     |SI #diam0017#3 = #diam0015#51; |O #diam0017#3 = #diam0015#54; |O #diam0017#3 = #diam0015#57;
               |O #diam0017#3 = #diam0015#60; |O #diam0017#3 = #diam0015#63; |O #diam0017#3 = #diam0015#66;

          #diaz0009#114 = #diaz0009#114 + #diam0017#7; || horas
          #diaz0009#65 = #diam0017#8;
          #diaz0009#64 = #diaz0009#64 + #diam0017#7;
          #diaz0009#66 = #diaz0009#65 * #diaz0009#64;

     |FINSI;
|FPRC;

|DEFBUCLE diam0017;
     #diam0017#1;
     ;
     #diaz0009#0, #diaz0009#1, #diaz0009#13, 001;
     #diaz0009#0, #diaz0009#1, #diaz0009#13, 999;
     ;
     NULL, diam0017;
|FIN;

|PROCESO CalculaDetalle;
     |ABRE #diam0015;
     aAlfa = #diaz0009#1 % -104;
     #diam0015#71 = aAlfa;
     |LEE 000#diam0015.=;
     |CIERRA #diam0015;

     #diaz0009#34 = 0; #diaz0009#39 = 0; #diaz0009#44 = 0; #diaz0009#49 = 0; #diaz0009#54 = 0; #diaz0009#59 = 0;
     #diaz0009#69 = 0; #diaz0009#64 = 0;

     #diaz0009#35 = 0; #diaz0009#40 = 0; #diaz0009#45 = 0; #diaz0009#50 = 0; #diaz0009#55 = 0; #diaz0009#60 = 0;
     #diaz0009#70 = 0; #diaz0009#76 = 0; #diaz0009#84 = 0; #diaz0009#88 = 0; #diaz0009#96 = 0; #diaz0009#100 = 0;

     #diaz0009#36 = 0; #diaz0009#41 = 0; #diaz0009#46 = 0; #diaz0009#51 = 0; #diaz0009#56 = 0; #diaz0009#61 = 0;
     #diaz0009#66 = 0; #diaz0009#71 = 0; #diaz0009#77 = 0; #diaz0009#80 = 0; #diaz0009#85 = 0; #diaz0009#89 = 0;
     #diaz0009#92 = 0; #diaz0009#97 = 0; #diaz0009#101 = 0; #diaz0009#102 = 0;

     #diaz0009#72 = 0; #diaz0009#78 = 0; #diaz0009#90 = 0;
     #diaz0009#73 = 0; #diaz0009#79 = 0; #diaz0009#81 = 0; #diaz0009#91 = 0; #diaz0009#93 = 0;

     #diaz0009#114 = 0; #diaz0009#106 = 0;

     |BUCLE diam0017;

     #diaz0009#77 = #diaz0009#76;
     #diaz0009#79 = #diaz0009#78;
     #diaz0009#85 = #diaz0009#84;
     #diaz0009#89 = #diaz0009#88;
     #diaz0009#91 = #diaz0009#90;

     #diaz0009#80 = #diaz0009#36 + #diaz0009#41 + #diaz0009#46 + #diaz0009#51 + #diaz0009#56 + #diaz0009#61 + #diaz0009#66 + #diaz0009#71 + #diaz0009#77;
     #diaz0009#92 = #diaz0009#85 + #diaz0009#89;
     #diaz0009#102 = #diaz0009#97 + #diaz0009#101;
     #diaz0009#81 = #diaz0009#73 + #diaz0009#79;
     #diaz0009#93 = #diaz0009#91;
     #diaz0009#16 = #diaz0009#81 + #diaz0009#93;
     #diaz0009#17 = #diaz0009#80 + #diaz0009#92 + #diaz0009#102
     #diaz0009#20 = #diaz0009#91;
     #diaz0009#21 = #diaz0009#89;
     #diaz0009#113 = #diaz0009#107 + #diaz0009#108 + #diaz0009#109 + #diaz0009#110 + #diaz0009#111 + #diaz0009#112;

     #diaz0009#19 = 0;
     |SI #diaz0009#16 ! 0; |O #diaz0009#17 ! 0;
          #diaz0009#19 = ((#diaz0009#17 - #diaz0009#16) / #diaz0009#17) * 100;
     |FINSI;

     #diaz0009#22 = 0;
     |SI #diaz0009#20 ! 0; |O #diaz0009#21 ! 0;
          #diaz0009#22 = ((#diaz0009#21 - #diaz0009#20) / #diaz0009#21) * 100;
     |FINSI;
     |PINDA #0#diaz0009;
|FPRC;

|PROCESO Evento24;
     |SI FSalida = 1;
         |LEE 040#diaw0024.=;
         |SI FSalida ! 0;
             |ESTADO_CONTROL nSubBoton4, "DISABLE";
             |ESTADO_CONTROL nSubBoton5, "DISABLE";
             |ESTADO_CONTROL nSubBoton6, "DISABLE";
             |ACABA;
         |FINSI;

         aAlfa = #diaw0024#14;  |QBF aAlfa;
         |SI aAlfa = "";
             |ESTADO_CONTROL nSubBoton4, "ENABLE";
             |ESTADO_CONTROL nSubBoton5, "DISABLE";
             |ESTADO_CONTROL nSubBoton6, "DISABLE";
         |SINO;
             |ESTADO_CONTROL nSubBoton5, "ENABLE";
             |ESTADO_CONTROL nSubBoton6, "ENABLE";
             |ESTADO_CONTROL nSubBoton4, "DISABLE";
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO DescargaFamDeta;
     |SI #diaw0024#16 = 0;
          #diam0017#0 = #diaw0024#0;
          #diam0017#1 = #diaw0024#1;
          #diam0017#2 = #diaw0024#2;
          #diam0017#4 = 999;
          |LEE 000#diam0017.];
          |SI FSalida = 0;
               |LEE 000#diam0017.a;
          |SINO;
               |LEE 000#diam0017.u;
          |FINSI;
          |SI FSalida = 0; |Y #diam0017#0 = #diaw0024#0; |Y #diam0017#1 = #diaw0024#1; |Y #diam0017#2 = #diaw0024#2;
               nLinea = #diam0017#4 + 1;
          |SINO;
               nLinea = 1;
          |FINSI;
          |PARA i = 0; |SI i [ 15; |HACIENDO i = i + 1;
               #diam0017#i# = #diaw0024#i#;
          |SIGUE;
          #diam0017#4 = nLinea;
          |GRABA 020#diam0017.n;
     |SINO;
          |PARA i = 0; |SI i [ 15; |HACIENDO i = i + 1;
               #diam0017#i# = #diaw0024#i#;
          |SIGUE;
          |GRABA 020#diam0017.n;
     |FINSI;
|FPRC;

|DEFBUCLE DescargaFamDeta;
     #diaw0024#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, DescargaFamDeta;
|FIN;

|PROCESO CargaFamDeta;
     |PARA i = 0; |SI i [ 15; |HACIENDO i = i + 1;
          #diaw0024#i# = #diam0017#i#;
     |SIGUE;

     |SI nTipo = 1;
          |SI #diam0017#3 ! #diam0015#34; |ACABA; |FINSI;
     |FINSI;
     |SI nTipo = 2;
          |SI #diam0017#3 ! #diam0015#40; |ACABA; |FINSI;
     |FINSI;
     |SI nTipo = 3;
          |SI #diam0017#3 ! #diam0015#37; |ACABA; |FINSI;
     |FINSI;
     |SI nTipo = 7;
          |SI #diam0017#3 ! #diam0015#43; |ACABA; |FINSI;
     |FINSI;
     |SI nTipo = 10;
          |SI #diam0017#3 = #diam0015#34; |O #diam0017#3 = #diam0015#40; |O #diam0017#3 = #diam0015#37;
                    |O #diam0017#3 = #diam0015#43;
               |ACABA;
          |FINSI;
     |FINSI;
     #diaw0024#16 = #diaw0024#4;
     |SI nSwBorra = 1;
          |BORRA 020#diam0017.a;
     |SINO;
          |GRABA 020#diaw0024.n;
     |FINSI;
     |LIBERA #diam0017;
|FPRC;

|DEFBUCLE CargaFamDeta;
     #diam0017#1;
     ;
     #diaz0009#0, #diaz0009#1, #diaz0009#13, 001;
     #diaz0009#0, #diaz0009#1, #diaz0009#13, 999;
     be;
     NULL, CargaFamDeta;
|FIN;

|PROCESO SacaDetalles;
     aAlfa = #diaz0009#1 % -104;
     |ABRE #diam0015;
     #diam0015#71 = aAlfa;
     |LEE 000#diam0015.=;
     |CIERRA #diam0015;

     |SI nTipo = 1; |O nTipo = 2;
          enHard = 0;
     |SINO;
          enHard = 1;
     |FINSI;

     |SI enHard = 0;
         |C_V #diam0017#10, 1, "N";  |C_M #diam0017#10, 1, "N";
         |C_V #diam0017#11, 1, "N";
         |C_V #diam0017#10, 1, "N";  |C_M #diam0017#10, 1, "N";
         |C_V #diam0017#12, 1, "N";  |C_M #diam0017#12, 1, "N";
         |C_V #diam0017#13, 1, "N";  |C_M #diam0017#13, 1, "N";
     |FINSI;
     |SI enHard = 1;
         |C_V #diam0017#10, 1, "S";  |C_M #diam0017#10, 1, "S";
         |C_V #diam0017#11, 1, "S";

         |SI eaCompras ! "S";
             |C_V #diam0017#12, 1, "S";  |C_M #diam0017#12, 1, "N";
             |C_V #diam0017#13, 1, "S";  |C_M #diam0017#13, 1, "N";
         |SINO;
             |C_V #diam0017#12, 1, "S";  |C_M #diam0017#12, 1, "S";
             |C_V #diam0017#13, 1, "S";  |C_M #diam0017#13, 1, "S";
         |FINSI;

         |C_M #diam0017#5,  1, "S";
         |C_M #diam0017#6,  1, "S";
         |C_M #diam0017#7,  1, "S";
         |C_M #diam0017#8,  1, "S";

         |SI enModif = 1;
             |C_M #diam0017#5,  1, "N";
             |C_M #diam0017#6,  1, "N";
             |C_M #diam0017#7,  1, "N";
             |C_M #diam0017#8,  1, "N";
             |SI eaCompras ! "S";  |C_M #diam0017#10, 1, "N";  |FINSI;
         |FINSI;
     |FINSI;

     nRango = 1 + 4 + 8 + 16;

     || Esta en pedido
     |SI enModif = 1;  nRango = 4 + 8 + 16;      |FINSI;

     |SI nModiHard = 1; || El boton 'hardware' siempre se modifica
          nRango = 1 + 4 + 8 + 16;
     |FINSI;


     |VENTANA 0501, 2599, -1, -1, "";
     nSubVentana = FSalida;

     |SI enHard = 1;
         |CONTROL_SIMPLE 0, "BOTON,{{137}} Adjuntar Documento", 0601, 0620, SubBoton4;
         nSubBoton4 = FSalida;

         |CONTROL_SIMPLE 0, "BOTON,{{135}} Ver Documento", 0622, 0640, SubBoton5;
         nSubBoton5 = FSalida;

         |CONTROL_SIMPLE 0, "BOTON,{{199}} Borrar Documento", 0642, 0660, SubBoton6;
         nSubBoton6 = FSalida;

         |ESTADO_CONTROL nSubBoton4, "DISABLE";
         |ESTADO_CONTROL nSubBoton5, "DISABLE";
         |ESTADO_CONTROL nSubBoton6, "DISABLE";
     |FINSI;

     |HAZ CreaTempo;
     |NOME_DAT #diaw0024#Tempo#; |DELINDEX #diaw0024; aTmp24 = Tempo;

     |ABRET #diaw0024;
     nSwBorra = 0;
     |BUCLE CargaFamDeta;
     |LINEAL_SIMPLE #1#diaw0024, nRango, 0701, 2399, ClaveBaja24, ClaveAlta24, Evento24;
     nSwBorra = 1;
     |BUCLE CargaFamDeta;
     |CIERRAT #diaw0024;

     |ABRE #diam0017;
     |BUCLE DescargaFamDeta;
     |CIERRA #diam0017;

     Tempo = aTmp24; |HAZ BoraTempo; |DELINDEX #diaw0024;

     |SI enHard = 1;
         |FIN_CONTROL_WINDOWS nSubBoton4;
         |FIN_CONTROL_WINDOWS nSubBoton5;
         |FIN_CONTROL_WINDOWS nSubBoton6;
     |FINSI;

     |FINVENTANA nSubVentana;

     |HAZ CalculaDetalle;
     |HAZ Ajusta;

     |ERROR;
|FPRC;

|PROCESO Tecnico1;
     |C_M #diaz0009#30, 1, "S";
     |SI #diaz0009#18 = "  ";
         |C_M #diaz0009#30, 1, "N";
         #diaz0009#30 = 0;
         |PINTA #diaz0009#30;
     |FINSI;
|FPRC;

|PROCESO Tecnico2;
     |C_M #diaz0009#31, 1, "S";
     |SI #diaz0009#29 = "  ";
         |C_M #diaz0009#31, 1, "N";
         #diaz0009#31 = 0;
         |PINTA #diaz0009#31;
     |FINSI;
|FPRC;

|PROCESO AltaPorce;
     |PUSHV 0501 2380;

     aAlfa = #diaz0009#1 % -104;

     #diam0009#0 = #diaz0009#nCampo1#;
     #diam0009#5 = aAlfa;
     |LEE 101#diam0009.=;
     |SI FSalida ! 0;
         |DDEFECTO #diam0009;
         #diam0009#0 = #diaz0009#nCampo1#;
         #diam0009#5 = aAlfa;
         |GRABA 020#diam0009.b;
     |FINSI;

     |PINPA #0#diam0009;
     |PINDA #0#diam0009;
     |PINTA 0802, #diam0009#5;
     |ENDATOS #1#diam0009;
     |SI FSalida = 0;
         |GRABA 020#diam0009.a;
     |FINSI;

     |POPV;
|FPRC;

|PROCESO TipoPorce;
     |SI Campo = 30;  nCampo1 = 18;  nCampo2 = 30;  |FINSI;
     |SI Campo = 31;  nCampo1 = 29;  nCampo2 = 31;  |FINSI;

     |SI FSalida = 10;
         |PUSHV 0501 2380;
         aAlfa = #diaz0009#1 % -104;

         |ABRE #diam0009;
         #diam0009#0 = #diaz0009#nCampo1#;
         #diam0009#5 = aAlfa;
         |LEE 040#diam0009.=;
         |SI FSalida ! 0;  |DDEFECTO #diam0009;  |FINSI;

         |PINPA #0#diam0009;
         |PINDA #0#diam0009;
         |PINTA 0802, #diam0009#5;
         |LEETECLA aTecla;

         |CIERRA #diam0009;
         |POPV;

         |ERROR;
         |ACABA;
     |FINSI;

     |SI #diaz0009#nCampo2# ] 4;
         |ERROR;
         |ACABA;
     |FINSI;

     |SI #diaz0009#nCampo2# = 0;  |Y #diaz0009#nCampo1# ! "  ";
         |ERROR;
         |ACABA;
     |FINSI;

     |SI #diaz0009#nCampo2# = 0;  |Y #diaz0009#nCampo1# = "  ";
         |ACABA;
     |FINSI;

     aAlfa = #diaz0009#1 % -104;

     |ABRE #diam0009;
     #diam0009#0 = #diaz0009#nCampo1#;
     #diam0009#5 = aAlfa;
     |LEE 101#diam0009.=;
     |SI FSalida ! 0;
         |HAZ AltaPorce;
     |FINSI;

     |SI #diaz0009#nCampo2# = 1;  |Y #diam0009#1 = 0;
         |MENAV "     No hay asignado porcentaje en el tipo introducido en el a¤o de la fecha.";
         ||HAZ AltaPorce;
         |ERROR;
     |FINSI;

     |SI #diaz0009#nCampo2# = 2;  |Y #diam0009#2 = 0;
         |MENAV "     No hay asignado porcentaje en el tipo introducido en el a¤o de la fecha.";
         ||HAZ AltaPorce;
         |ERROR;
     |FINSI;

     |SI #diaz0009#nCampo2# = 3;  |Y #diam0009#2 = 0;
         |MENAV "     No hay asignado porcentaje en el tipo introducido en el a¤o de la fecha.";
         ||HAZ AltaPorce;
         |ERROR;
     |FINSI;

     |LIBERA #diam0009;
     |CIERRA #diam0009;
|FPRC;

|PROCESO PonKilometros;  |TIPO 7;
     |SI #diaz0009#106 ! 0;  |ACABA;  |FINSI;

     |ABRE #dsasis03;
     #dsasis03#0 = #diaz0009#0;
     |LEE 040#dsasis03.=;
     |SI FSalida ! 0;  |DDEFECTO #dsasis03;  |FINSI;
     |CIERRA #dsasis03;

     #diaz0009#106 = #dsasis03#2;  |PINTA #diaz0009#106;
|FPRC;

|PROCESO Fentrega; |TIPO 0;
     #diaz0009#28 = #diaz0009#1 + 15;
     |PINTA #diaz0009#28;
|FPRC;

|PROCESO Totales;
|FPRC;

|PROCESO Tipo12z09;  |TIPO 12;
     |SI FSalida = 7;
         enSalida = 1;
         |ACABA;
     |FINSI;

     |SI enDesdePed = 1;  |Y #diaz0009#105 ! #diaz0009#116;
         enSalida = 1;
         |ACABA;
     |FINSI;

     |SI #diaz0009#64 = 0;
         |MENAV "      Presupuesto SIN Desplazamientos.";
     |FINSI;

     |SI #diaz0009#69 = 0;
         |MENAV "      Presupuesto SIN Kilometros.";
     |FINSI;
|FPRC;

|PROCESO ModoConsulta;
     |CONTROL_SIMPLE enPanta, "BOTON,{{137}} Software", 3703, 3725, SubBoton1;
     nSubBoton1 = FSalida;

     |CONTROL_SIMPLE enPanta, "BOTON,{{137}} Mantenimiento Software", 3803, 3825, SubBoton2;
     nSubBoton2 = FSalida;

     |CONTROL_SIMPLE enPanta, "BOTON,{{137}} Hardware", 3903, 3925, SubBoton3;
     nSubBoton3 = FSalida;

     |CONTROL_SIMPLE enPanta, "BOTON,{{137}} Mantenimeinto Hardware", 4003, 4025, SubBoton7;
     nSubBoton7 = FSalida;

     |CONTROL_SIMPLE enPanta, "BOTON,{{137}} Otros", 4103, 4125, SubBoton10;
     nSubBoton10 = FSalida;

     |CONTROL_SIMPLE enPanta, "BOTON,{{137}} Presupuesto", 1703, 1725, SubBoton8;
     nSubBoton8 = FSalida;

     |CONTROL_SIMPLE enPanta, "BOTON,{{206}} Datos Representantes", 1727, 1749, SubBoton9;
     nSubBoton9 = FSalida;

     |SI eaCompras ! "S";
         |ESTADO_CONTROL nSubBoton7, "DISABLE";
     |FINSI;
     |SI #diam0016#104 = "SI";
          |ESTADO_CONTROL nSubBoton9, "DISABLE";
     |FINSI;

     aEsc1  = &255 + "806";
     aEsc2  = &255 + "807";
     aRetu  = &255 + "802";
     |PARA; |SI;  |HACIENDO;
         FSalida = "::Pantalla Anterior";
         |LEETECLA aTecla;
         |SI aTecla = aEsc1; |SAL;  |FINSI;
         |SI aTecla = aEsc2; |SAL;  |FINSI;
         |SI aTecla = aRetu; |SAL;  |FINSI;
     |SIGUE;
     aTecla = "";

     |FIN_CONTROL_WINDOWS nSubBoton1;
     |FIN_CONTROL_WINDOWS nSubBoton2;
     |FIN_CONTROL_WINDOWS nSubBoton3;
     |FIN_CONTROL_WINDOWS nSubBoton7;
     |FIN_CONTROL_WINDOWS nSubBoton8;
     |FIN_CONTROL_WINDOWS nSubBoton9;
     |FIN_CONTROL_WINDOWS nSubBoton10;

     |PULSATECLA;
|FPRC;

|PROCESO PonBotones;
     |CONTROL_SIMPLE enPanta, "BOTON,{{137}} Software", 3703, 3725, SubBoton1;
     nSubBoton1 = FSalida;

     |CONTROL_SIMPLE enPanta, "BOTON,{{137}} Mantenimiento Software", 3803, 3825, SubBoton2;
     nSubBoton2 = FSalida;

     |CONTROL_SIMPLE enPanta, "BOTON,{{137}} Hardware", 3903, 3925, SubBoton3;
     nSubBoton3 = FSalida;

     |CONTROL_SIMPLE enPanta, "BOTON,{{137}} Mantenimeinto Hardware", 4003, 4025, SubBoton7;
     nSubBoton7 = FSalida;

     |CONTROL_SIMPLE enPanta, "BOTON,{{137}} Otros", 4103, 4125, SubBoton10;
     nSubBoton10 = FSalida;

     |CONTROL_SIMPLE enPanta, "BOTON,{{137}} Presupuesto", 1703, 1725, SubBoton8;
     nSubBoton8 = FSalida;

     |CONTROL_SIMPLE enPanta, "BOTON,{{206}} Datos Representantes", 1727, 1749, SubBoton9;
     nSubBoton9 = FSalida;

     |SI eaCompras ! "S";
         |ESTADO_CONTROL nSubBoton7, "DISABLE";
     |FINSI;
     |SI #diam0016#104 = "SI";
          |ESTADO_CONTROL nSubBoton9, "DISABLE";
     |FINSI;
|FPRC;

|PROCESO QuitaBotones;
     |FIN_CONTROL_WINDOWS nSubBoton1;
     |FIN_CONTROL_WINDOWS nSubBoton2;
     |FIN_CONTROL_WINDOWS nSubBoton3;
     |FIN_CONTROL_WINDOWS nSubBoton7;
     |FIN_CONTROL_WINDOWS nSubBoton8;
     |FIN_CONTROL_WINDOWS nSubBoton9;
     |FIN_CONTROL_WINDOWS nSubBoton10;

     |PULSATECLA;
|FPRC;

|PROCESO EstadoBoton;
     |ESTADO_CONTROL nSubBoton1, aEstado;
     |ESTADO_CONTROL nSubBoton2, aEstado;
     |ESTADO_CONTROL nSubBoton3, aEstado;
     |ESTADO_CONTROL nSubBoton7, aEstado;
     |ESTADO_CONTROL nSubBoton8, aEstado;
     |SI #diam0016#104 = "SI";
          |ESTADO_CONTROL nSubBoton9, "DISABLE";
     |SINO;
          |ESTADO_CONTROL nSubBoton9, aEstado;
     |FINSI;
     |ESTADO_CONTROL nSubBoton10, aEstado;
|FPRC;

|PROCESO SubBoton1;
     aEstado = "DISABLE"; |HAZ EstadoBoton;
     nTipo = 1;
     |HAZ SacaDetalles;
     aEstado = "ENABLE"; |HAZ EstadoBoton;
|FPRC;

|PROCESO SubBoton2;
     aEstado = "DISABLE"; |HAZ EstadoBoton;
     nTipo = 2;
     |HAZ SacaDetalles;
     aEstado = "ENABLE"; |HAZ EstadoBoton;
|FPRC;

|PROCESO SubBoton3;
     aEstado = "DISABLE"; |HAZ EstadoBoton;
     nTipo = 3;
     nModiHard = 1;
     |HAZ SacaDetalles;
     nModiHard = 0;
     aEstado = "ENABLE"; |HAZ EstadoBoton;
|FPRC;

|PROCESO SubBoton4;
     |LEE 101#diam0017.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     aRuta = "F";
     |BROWSE aRuta;  |QBF aRuta;
     |SI aRuta = "F";  |ACABA;  |FINSI;

     aRuta = aRuta % 0299;
     aExtension = (aRuta % -103) > "";
     aPunto     = aRuta % -401;
     |SI aPunto ! ".";
         |MENAV "0000 Documento sin Extension. Formato exigido extension de 3 caracteres.";
         |ERROR;
         |ACABA;
     |FINSI;

     |DBASE aBase;  |QBF aBase;
     aDirDocumentos = aBase + "000577/documentos";
     |MKDIR aDirDocumentos;

     aOrigen  = aRuta;
     aAlfa1   = (#diam0017#1 % -104) + (#diam0017#1 % 402) + (#diam0017#1 % 102);
     aAlfa2   = (#diam0017#2 %  102) + (#diam0017#2 % 402) + (#diam0017#2 % 702);
     aAlfa3   = ("000" + #diam0017#4) %  -103;
     aDestino = aDirDocumentos + "/" + #diam0017#0 + aAlfa1 + aAlfa2 + aAlfa3 + "." + aExtension;
     |RECIBE_FICHERO aOrigen, aDestino;

     #diam0017#14   = #diam0017#0 + aAlfa1 + aAlfa2 + aAlfa3 + "." + aExtension;
     #diam0017#15   = Usuario % 0810;

     |GRABA 020#diam0017.a;
     |LIBERA #diam0017;

     |ESTADO_CONTROL nSubBoton5, "ENABLE";
     |ESTADO_CONTROL nSubBoton6, "ENABLE";
     |ESTADO_CONTROL nSubBoton4, "DISABLE";
|FPRC;

|PROCESO SubBoton5;
     |LEE 040#diam0017.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |DBASE aBase;  |QBF aBase;
     aDirDocumentos = aBase + "000577/documentos";
     |MKDIR aDirDocumentos;

     aOrigen  = "C:\DOCUMENTOS";
     |RMKDIR aOrigen;

     aAbre = aOrigen + "\wait.exe";
     |XABRE "EC", aAbre, nHandle;
     |SI FSalida < 0;
         aDestino = aBase + "000577/wait.exe";  |QBF aDestino;
         aOrigen  = "C:\DOCUMENTOS\wait.exe";
         |ENVIA_FICHERO aDestino, aOrigen;
         |SI FSalida ! 0;
             |MENAV "      No existe el wait en el directorio de Documentos.";
             |ACABA;
         |FINSI;
     |FINSI;

     aDestino = aDirDocumentos + "/" + #diam0017#14;  |QBF aDestino;
     aOrigen  = "C:\DOCUMENTOS\" + #diam0017#14;      |QBF aOrigen;
     |ENVIA_FICHERO aDestino, aOrigen;
     |SI FSalida = 0;
         |RSYSTEM aOrigen;

         |RECIBE_FICHERO aOrigen, aDestino;

         #diam0017#15 = Usuario % 0810;
     |FINSI;

     |RFBORRA aOrigen;
|FPRC;

|PROCESO SubBoton6;
     |CONFI "0000N Seguro de Borrar el Documento ";
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |LEE 101#diam0017.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |DBASE aDocumentos;  |QBF aDocumentos;
     aDocumentos = aDocumentos + "000577/documentos";
     aDocumentos = aDocumentos + "/" + #diam0017#14;  |QBF aDocumentos;
     |FBORRA aDocumentos;

     #diam0017#14 = "";
     #diam0017#15 = "";

     |GRABA 020#diam0017.a;
     |LIBERA #diam0017;

     |ESTADO_CONTROL nSubBoton4, "ENABLE";
     |ESTADO_CONTROL nSubBoton5, "DISABLE";
     |ESTADO_CONTROL nSubBoton6, "DISABLE";
|FPRC;

|PROCESO SubBoton7;
     aEstado = "DISABLE"; |HAZ EstadoBoton;
     nTipo = 7;
     |HAZ SacaDetalles;
     aEstado = "ENABLE"; |HAZ EstadoBoton;
|FPRC;

|PROCESO SubBoton8;
     aEstado = "DISABLE"; |HAZ EstadoBoton;
     |HAZ SacaPresupuesto;
     aEstado = "ENABLE"; |HAZ EstadoBoton;
|FPRC;

|PROCESO SubBoton9;
     aEstado = "DISABLE"; |HAZ EstadoBoton;

     |ET Campo18;
         |ENCAMPO #18#diaz0009;
         |SI FSalida = 2;  |VETE Campo18;  |FINSI;

     |ET Campo30;
         |ENCAMPO #30#diaz0009;
         |SI FSalida = 2;  |VETE Campo18;  |FINSI;

     |ET Campo29;
         |ENCAMPO #29#diaz0009;
         |SI FSalida = 2;  |VETE Campo30;  |FINSI;

         |ENCAMPO #31#diaz0009;
         |SI FSalida = 2;  |VETE Campo29;  |FINSI;

     aEstado = "ENABLE"; |HAZ EstadoBoton;
|FPRC;

|PROCESO SubBoton10;
     aEstado = "DISABLE"; |HAZ EstadoBoton;

     nTipo = 10;
     |HAZ SacaDetalles;

     aEstado = "ENABLE"; |HAZ EstadoBoton;
|FPRC;

|PROCESO Ajusta;
     |ABRE #diam0017;
     #diam0017#0 = #diaz0009#0;
     #diam0017#1 = #diaz0009#1;
     #diam0017#2 = #diaz0009#13;
     #diam0017#3 = #diaz0009#82;
     #diam0017#4 = 999;
     |LEE 101#diam0017.=;
     |SI FSalida = 0; |BORRA 020#diam0017.a; |FINSI;
     |CIERRA #diam0017;

     |HAZ CalculaDetalle;
     |HAZ CalculaPresupuesto;
     |SI #diaz0009#17 ! #diaz0009#105;
          |DDEFECTO #diam0017;
          |ABRE #diam0017;
          #diam0017#0 = #diaz0009#0;
          #diam0017#1 = #diaz0009#1;
          #diam0017#2 = #diaz0009#13;
          #diam0017#3 = #diaz0009#82;
          #diam0017#4 = 999;
          |LEE 101#diam0017.=;
          |SI FSalida = 0; |BORRA 020#diam0017.a; |FINSI;
          #diam0017#5 = #diam0015#69;
          #diam0017#6 = #diam0015#70;
          #diam0017#7 = 1;
          #diam0017#8 = #diaz0009#105 - #diaz0009#17;
          #diam0017#9 = #diam0017#8;
          |GRABA 020#diam0017.n;
          |CIERRA #diam0017;
          |HAZ CalculaDetalle;
     |FINSI;
|FPRC;

|PROCESO Borra20;
     |BORRA 020#diam0020.a;
     |LIBERA #diam0020;
|FPRC;

|DEFBUCLE Borra20;
     #diam0020#1;
     ;
     #diam0019#0, #diam0019#1, #diam0019#13, 001;
     #diam0019#0, #diam0019#1, #diam0019#13, 999;
     be;
     NULL, Borra20;
|FIN;

|PROCESO Borra21;
     |BORRA 020#diam0021.a;
     |LIBERA #diam0021;
|FPRC;

|DEFBUCLE Borra21;
     #diam0021#1;
     ;
     #diam0019#0, #diam0019#1, #diam0019#13, 001;
     #diam0019#0, #diam0019#1, #diam0019#13, 999;
     be;
     NULL, Borra21;
|FIN;

|PROCESO Pasa20;
     |PARA i = 0; |SI i [ 15; |HACIENDO i = i + 1;
          #diam0020#i# = #diam0017#i#;
     |SIGUE;
     #diam0020#0 = #diam0016#0;
     |GRABA 020#diam0020.n;
|FPRC;

|DEFBUCLE Pasa20;
     #diam0017#1;
     ;
     #diam0016#0, #diam0016#1, #diam0016#13, 001;
     #diam0016#0, #diam0016#1, #diam0016#13, 999;
     ;
     NULL, Pasa20;
|FIN;

|PROCESO Pasa21;
     |PARA i = 0; |SI i [ 8; |HACIENDO i = i + 1;
          #diam0021#i# = #diam0018#i#;
     |SIGUE;
     #diam0021#0 = #diam0016#0;
     |GRABA 020#diam0021.n;
|FPRC;

|DEFBUCLE Pasa21;
     #diam0018#1;
     ;
     #diam0016#0, #diam0016#1, #diam0016#13, 001;
     #diam0016#0, #diam0016#1, #diam0016#13, 999;
     ;
     NULL, Pasa21;
|FIN;

|PROCESO CopiaOferta;
     |ABRE #diam0019;
     |SELECT #5#diam0019;
     #diam0019#127 = #diam0016#117;
     |LEE 121#diam0019.=;
     |SI FSalida = 0;
          |BUCLE Borra20;
          |BUCLE Borra21;
          |ABRE #diam0020;
          |ABRE #diam0021;
          |BUCLE Pasa20;
          |BUCLE Pasa21;
          |CIERRA #diam0021;
          |CIERRA #diam0020;
          |PARA i = 1; |SI i [ 115; |HACIENDO i = i + 1;
               #diam0019#i# = #diam0016#i#;
          |SIGUE;
          |GRABA 020#diam0019.a;
     |FINSI;
     |CIERRA #diam0019;
|FPRC;
