|VARIABLES;
     aExtension = "";

     aLong            = "";
     aCadena          = "";
     aIPRemoto        = "";
     aAlfa            = "";
     aAlfa1           = "";
     aAlfa2           = "";
     aAlfa3           = "";
     aAlfa4           = "";
     aAlfa5           = "";
     aAlfa6           = "";
     aCaracter        = "";
     aLen             = "";
     aDecima          = "";
     aEntero          = "";
     aImpor1          = "";
     aImpor2          = "";
     aDocRemoto       = "";
     aDocRemotoTra    = "";
     aDocServidor     = "";
     aBase            = "";
     aDirec           = "";
     aLogo            = "";
     aGuarda          = "";
     aAbreId1         = "";
     aAbreId2         = "";
     aAbre            = "";
     aPath            = "";
     aLongitud        = "";
     aSit             = "";
     aUsuario         = "";
     aHora            = "";
     aDia             = "";
     aMes             = "";
     aAny             = "";
     aDirGrafico      = "";
     aFicheroResul    = "";
     aFicheroTgz      = "";
     aFicheroTra      = "";
     aFicheroLCK      = "";
     aFicheroIMA      = "";

     nSwError         = 0;
     nInstala         = 0;
     nLen             = 0;
     nLen1            = 0;
     nLongitud        = 0;
     nSer             = 0;
     nLong            = 0;
     nBarra           = 0;
     nWord            = 0;
     nCar             = 0;
     nPos             = 0;
     nCampo           = 0;
     nDecimal         = 0;
     nCaracter        = 0;
     nHandle          = 0;
     nHandleYa        = 0;
     nTope            = 0;
     nPuntero         = 0;
     nIdSalir         = 0;
     nIdSalir1        = 0;
     nIdSalir2        = 0;
     nIdSalir3        = 0;
     nIdSalir4        = 0;
     nLinea           = 0;
     nHay             = 0;
     nDeci            = 0;
     nConta           = 0;
     nPaso            = 0;
     nAscci           = 0;
     nVeces           = 0;
     nHandleTgz       = 0;
     nCarac           = 0;
     nPausa           = 0;

     fFecha           = @;

     &eaAlfa          = "";
     &eaImporte       = "";
     &eaPathLogo      = "";
     &eaPathLogoIso   = "";
     &eaAsigna        = "";
     &eaMes           = "";
     &enWord1         = 0;
     &enWord2         = 0;
     &enCamWord       = 0;
     &enModoExterno   = 0;
     &enHandleTxt     = 0;
     &enHandleTxt2    = 0;
     &enCargaPuntero  = 0;
     &efFecha         = @;

     &eaDirPlantilla  = "";
     &eaDirTrabajo    = "";
     &eaDirTrabServi  = "";
     &eaDirDocId2     = "";
     &eaDirTraId2     = "";
     &eaDirSerGuarda  = "";
     &eaDirSerPlan    = "";
     &eaOrigen        = "";
     &eaDestino       = "";
     &eaDestinoTra    = "";
     &eaFicheroTra    = "";
     &eaFicheroIma    = "";
     &eaFicheroXgz    = "";
     &eaFicheroTgz    = "";
     &eaFicheroTar    = "";
     &eaFicheroTxt    = "";
     &eaFicheroPdf    = "";
     &eaFicheroPlaGz  = "";
     &eaFicheroPlaMl  = "";
     &eaEtiqueta      = "";
     &eaPlanilla      = "";
     &ea16            = "";
     &eaTipoImpresion = "";
     &enConverPDF     = 0;
     &eaFichero       = "";
     &eaDocumento     = "";
     &eaGrafico       = "";
     &eaRaizDoc       = "";
     &enNumeroDoc     = 0;
     &eaRutaOrigen    = "";
     &eaRutaDestino   = "";
     &eaParametro1    = "";
     &eaParametro2    = "";
     &eaParametro3    = "";
     &eaParametro4    = "";
     &eaParametro5    = "";
     &eaParametro6    = "";
     &eaInforme       = "";
     &enBorraDocu     = 0;
     &eaRuta          = "";
     &eaNomFic        = "";
     &enDec           = 0;
     &enError         = 0;

     &eaNombreImagen  = "";
     &enSwEsImagen    = 0;

     {1}aContiene     = "";
     {1}aVersion      = "";
     {2}nNivel        = 0;
     {50}aCarac       = "";

   {100}&eaCamWord    = "";
|FIN;

|PROCESO FechaBarras;
     aAlfa = efFecha;
     |QBF aAlfa;
     aDia = aAlfa % 102;
     aMes = aAlfa % 402;
     aAny = aAlfa % -104;

     eaAlfa = aDia + "/" + aMes +  "/" + aAny;
|FPRC;

|PROCESO EjecutaDSXML;
     || eaParametro1 = Path y fichero exe
     || eaParametro2 = Path y fichero txt
     || eaParametro3 = Origen  del dsxml
     || eaParametro4 = Destino 1 del dsxml
     || eaParametro5 = Destino 2 del dsxml
     || eaParametro6 = "0"  modo silencioso

     |XABRE "EC", eaParametro2, nHandle;
     |SI FSalida < 0;  |ACABA;  |FINSI;

     aFicheroLCK  = eaParametro2 < "";
     aFicheroLCK  = aFicheroLCK - ".txt" + ".lck";
     aFicheroIMA  = eaParametro5 < "";
     aFicheroIMA  = aFicheroIMA + "~$" + (eaFicheroTra % 315);  |QBF aFicheroIMA;

     |SI eaParametro3 ! "";
         eaOrigen       = eaParametro3 + "dsxml.exe";
         eaDestino      = eaParametro4 + "dsxml.exe";
         eaDestinoTra   = eaParametro5 + "dsxml.exe";
         |HAZ EnviaFicheroConMD5;
     |FINSI;

     |RFBORRA aFicheroLCK;

||     aAlfa  = "START " + eaParametro1 + " " + eaParametro2;
     aAlfa  = "cmd " + &34 + "/c START /WAIT " + eaParametro1 + " " + eaParametro2 + " " + eaParametro6  + &34;
     |RSYSTEM aAlfa;

     |PARA;  |SI;  |HACIENDO;
             |PARA nPausa = 1; |SI nPausa [ 10000; |HACIENDO nPausa = nPausa + 1;
             |SIGUE;

             |XABRE "EC", aFicheroLCK, nHandle;
             |SI FSalida ] 0;
                 |SAL;
             |FINSI;

             |PULSATECLA;
     |SIGUE;

     |PARA nVeces = 0;  |SI nVeces [ 20;  |HACIENDO nVeces = nVeces + 1;
             |XABRE "EC", aFicheroIMA, nHandle;
             |SI FSalida < 0;  |SAL;  |FINSI;

             |MENSA "0000 Esperando cierre del documento.";
             |SLEEP 1;
             |PULSATECLA;
     |SIGUE;

     |RFBORRA eaParametro2;
     |RFBORRA aFicheroLCK;

     |PULSATECLA;
     |MENSA "0000  ";
|FPRC;

|PROCESO EjecutaDSAbreExtension;
     || eaParametro1 = Path y fichero exe
     || eaParametro2 = Path y fichero a editar
     || eaParametro3 = Origen  del dsabreextension
     || eaParametro4 = Destino 1 del dsabreextension
     || eaParametro5 = Destino 2 del dsabreextension

     |XABRE "EC", eaParametro2, nHandle;
     |SI FSalida < 0;  |ACABA;  |FINSI;

     aFicheroLCK  = (eaParametro1 - "dsabreextension") + "fin" + Usuario + ".txt";

     |SI eaParametro3 ! "";
         eaOrigen       = eaParametro3 + "dsabreextension.exe";
         eaDestino      = eaParametro4 + "dsabreextension.exe";
         eaDestinoTra   = eaParametro5 + "dsabreextension.exe";
         |HAZ EnviaFicheroConMD5;
     |FINSI;

     |RFBORRA aFicheroLCK;

     aAlfa  = "START " + eaParametro1 + " " + eaParametro2 + " " + aFicheroLCK;
     |RSYSTEM aAlfa;

     |PARA;  |SI;  |HACIENDO;
             |PARA nPausa = 1; |SI nPausa [ 10000; |HACIENDO nPausa = nPausa + 1;
             |SIGUE;

             |XABRE "EC", aFicheroLCK, nHandle;
             |SI FSalida ] 0;
                 |SAL;
             |FINSI;

             |PULSATECLA;
     |SIGUE;

     |RFBORRA aFicheroLCK;

     |PULSATECLA;
|FPRC;

|PROCESO FormateaNumero;
     aLong   = eaAlfa % 0;
     nLong   = aLong;
     nDeci   = -1;
     |PARA nCaracter = 1;  |SI nCaracter [ nLong;  |HACIENDO nCaracter = nCaracter + 1;
           nPos      = (nCaracter * 100) + 1;
           aCaracter = eaAlfa % nPos;
           |SI aCaracter = ".";
               nDeci = 0;
           |SINO;
               |SI nDeci ! -1;  nDeci = nDeci + 1;  |FINSI;
           |FINSI;
     |SIGUE;

     |SI nDeci = -1;  eaAlfa = eaAlfa + ".00";  |FINSI;
     |SI nDeci = 1;   eaAlfa = eaAlfa + "0";    |FINSI;

     eaAlfa = ("          " + eaAlfa) % -110;
|FPRC;

|PROCESO PonBotonSalir;
     |ESTADO_CONTROL nIdSalir, "SHOW";
|FPRC;

|PROCESO QuitaBotonSalir;
     nIdSalir = 0;
     InNivel   = nNivel1<-;
     nNivel1   = 0;
     |ESPECIFICA "IDBOTONTECLA", nNivel;

     nIdSalir = nNivel2;
     |ESTADO_CONTROL nIdSalir, "HIDE";
|FPRC;

|PROCESO PonBotonSalir1;
     |ESTADO_CONTROL nIdSalir1, "SHOW";
|FPRC;

|PROCESO QuitaBotonSalir1;
     nIdSalir1 = 0;
     InNivel   = nNivel1<-;
     nNivel1   = 0;
     |ESPECIFICA "IDBOTONTECLA", nNivel;

     nIdSalir1 = nNivel2;
     |ESTADO_CONTROL nIdSalir1, "HIDE";
|FPRC;

|PROCESO PonBotonSalir2;
     |ESTADO_CONTROL nIdSalir2, "SHOW";
|FPRC;

|PROCESO QuitaBotonSalir2;
     nIdSalir2 = 0;
     InNivel   = nNivel1<-;
     nNivel1   = 0;
     |ESPECIFICA "IDBOTONTECLA", nNivel;

     nIdSalir2 = nNivel2;
     |ESTADO_CONTROL nIdSalir2, "HIDE";
|FPRC;

|PROCESO PonBotonSalir3;
     |ESTADO_CONTROL nIdSalir3, "SHOW";
|FPRC;

|PROCESO QuitaBotonSalir3;
     nIdSalir3 = 0;
     InNivel   = nNivel1<-;
     nNivel1   = 0;
     |ESPECIFICA "IDBOTONTECLA", nNivel;

     nIdSalir3 = nNivel2;
     |ESTADO_CONTROL nIdSalir3, "HIDE";
|FPRC;

|PROCESO PonBotonSalir4;
     |ESTADO_CONTROL nIdSalir4, "SHOW";
|FPRC;

|PROCESO QuitaBotonSalir4;
     nIdSalir4 = 0;
     InNivel   = nNivel1<-;
     nNivel1   = 0;
     |ESPECIFICA "IDBOTONTECLA", nNivel;

     nIdSalir4 = nNivel2;
     |ESTADO_CONTROL nIdSalir4, "HIDE";
|FPRC;

|PROCESO &QuitaRaros;
     |QBF eaAlfa;
     |SI eaAlfa = "";  |ACABA;  |FINSI;

     aCarac1   = "¥";
     aCarac2   = "¤";
     aCarac3   = "á";
     aCarac4   = " ";
     aCarac5   = "‚";
     aCarac6   = "¡";
     aCarac7   = "¢";
     aCarac8   = "£";
     aCarac9   = "§";
     aCarac10  = "¦";
     aCarac11  = "¨";
     aCarac12  = "€";
     aCarac13  = "‡";
     aCarac14  = "…";
     aCarac15  = "Š";
     aCarac16  = "";
     aCarac17  = "•";
     aCarac18  = "—";
     aCarac19  = &001;
     aCarac20  = &002;
     aCarac21  = &003;
     aCarac22  = &004;
     aCarac23  = &005;
     aCarac24  = &006;
     aCarac25  = &007;
     aCarac26  = &015;
     aCarac27  = &016;
     aCarac28  = &017;
     aCarac29  = &018;
     aCarac30  = &019;
     aCarac31  = &020;
     aCarac32  = &021;
     aCarac33  = &022;
     aCarac34  = &023;
     aCarac35  = &024;
     aCarac36  = &025;
     aCarac37  = &026;
     aCarac38  = &028;
     aCarac39  = &029;
     aCarac40  = "";
     aCarac41  = &008;
     aCarac42  = "ï";
     aCarac43  = "µ";
     aCarac44  = "";
     aCarac45  = "Ö";
     aCarac46  = "à";
     aCarac47  = "é";
     aCarac48  = &009;
     aCarac49  = &010;
     aCarac50  = &013;

     IaCarac = aCarac1 <-;
     nHay    = 0;
     |PARA nCampo = 1;  |SI nCampo [ 50;  |HACIENDO nCampo = nCampo + 1;
           aCaracter = eaAlfa - aCarac;
           |SI FSalida ! 0;
               nHay = 1;
               |SAL;
           |FINSI;

           IaCarac = IaCarac + 1;
     |SIGUE;

     |SI nHay = 0;  |ACABA;  |FINSI;

     aCadena = "";
     aLen    = eaAlfa % 0;
     nLen    = aLen;

     |PARA nCampo = 1;  |SI nCampo [ nLen;  |HACIENDO nCampo = nCampo + 1;
           nPos = (100 * nCampo) + 1;
           aCaracter = eaAlfa % nPos;
           nPaso     = 0;

           nAscci    = &aCaracter;

           |SI aCaracter = aCarac1;  |Y nPaso = 0;  aCaracter = &0209;   nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac2;  |Y nPaso = 0;  aCaracter = &0241;   nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac3;  |Y nPaso = 0;  aCaracter = &0225;   nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac4;  |Y nPaso = 0;  aCaracter = &0225;   nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac5;  |Y nPaso = 0;  aCaracter = &0233;   nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac6;  |Y nPaso = 0;  aCaracter = &0237;   nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac7;  |Y nPaso = 0;  aCaracter = &0243;   nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac8;  |Y nPaso = 0;  aCaracter = &0250;   nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac9;  |Y nPaso = 0;  aCaracter = &0176;   nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac10; |Y nPaso = 0;  aCaracter = &0170;   nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac11; |Y nPaso = 0;  aCaracter = &0191;   nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac12; |Y nPaso = 0;  aCaracter = "Ç";     nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac13; |Y nPaso = 0;  aCaracter = &0231;   nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac14; |Y nPaso = 0;  aCaracter = &0224;   nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac15; |Y nPaso = 0;  aCaracter = &0232;   nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac16; |Y nPaso = 0;  aCaracter = &0236;   nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac17; |Y nPaso = 0;  aCaracter = &0242;   nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac18; |Y nPaso = 0;  aCaracter = &0249;   nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac19; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac20; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac21; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac22; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac23; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac24; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac25; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac26; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac27; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac28; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac29; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac30; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac31; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac32; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac33; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac34; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac35; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac36; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac37; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac38; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac39; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac40; |Y nPaso = 0;  aCaracter = &252;    nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac41; |Y nPaso = 0;  aCaracter = "";      nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac42; |Y nPaso = 0;  aCaracter = "´";     nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac43; |Y nPaso = 0;  aCaracter = "A";     nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac44; |Y nPaso = 0;  aCaracter = "E";     nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac45; |Y nPaso = 0;  aCaracter = "I";     nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac46; |Y nPaso = 0;  aCaracter = "O";     nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac47; |Y nPaso = 0;  aCaracter = "U";     nPaso = 1;  |FINSI;
           |SI aCaracter = aCarac48; |Y nPaso = 0;  aCaracter = " ";     nPaso = 1;  |FINSI;

           |SI aCaracter = aCarac49; |Y nPaso = 0;  || Un retorno de carro
               |SI nCampo < nLen;
                   aCaracter = "";
                   nPaso     = 1;
               |FINSI;
           |FINSI;

           |SI aCaracter = aCarac50; |Y nPaso = 0;  || Un retorno de carro
               nLen1 = nLen - 1;
               |SI nCampo < nLen1;
                   aCaracter = "";
                   nPaso     = 1;
               |FINSI;
           |FINSI;

           aCadena = aCadena + aCaracter;
     |SIGUE;

     eaAlfa = aCadena;
|FPRC;

|PROCESO QuitaAcentosMayusculas;
     |QBF eaAlfa;
     aCarac1   = "µ";
     aCarac2   = "";
     aCarac3   = "Ö";
     aCarac4   = "à";
     aCarac5   = "é";

     IaCarac = aCarac1 <-;
     nHay    = 0;
     |PARA nCampo = 1;  |SI nCampo [ 5;  |HACIENDO nCampo = nCampo + 1;
           aCaracter = eaAlfa - aCarac;
           |SI FSalida ! 0;
               nHay = 1;
               |SAL;
           |FINSI;

           IaCarac = IaCarac + 1;
     |SIGUE;

     |SI nHay = 0;  |ACABA;  |FINSI;

     aCadena = "";
     aLen    = eaAlfa % 0;
     nLen    = aLen;
     |PARA nCampo = 1;  |SI nCampo [ nLen;  |HACIENDO nCampo = nCampo + 1;
           nPos = (100 * nCampo) + 1;
           aCaracter = eaAlfa % nPos;

           |SI aCaracter = aCarac1;  aCaracter = "A";   |FINSI;
           |SI aCaracter = aCarac2;  aCaracter = "E";   |FINSI;
           |SI aCaracter = aCarac3;  aCaracter = "I";   |FINSI;
           |SI aCaracter = aCarac4;  aCaracter = "O";   |FINSI;
           |SI aCaracter = aCarac5;  aCaracter = "U";   |FINSI;

           aCadena = aCadena + aCaracter;
     |SIGUE;
     eaAlfa = aCadena;
|FPRC;

|PROCESO SeparaImporte;
     aDecima   = "";
     aEntero   = "";
     aLong     = eaImporte % 0;
     nLong     = aLong;
     nDecimal  = 0;
     |PARA nCaracter = 1;  |SI nCaracter [ nLong;  |HACIENDO nCaracter = nCaracter + 1;
           nPos      = (100 * nCaracter) + 1;
           aCaracter = eaImporte % nPos;
           |SI aCaracter = ".";
               nDecimal = 1;
           |SINO;
               |SI nDecimal = 0;
                   aEntero = aEntero + aCaracter;
               |SINO;
                   aDecima = aDecima + aCaracter;
               |FINSI;
           |FINSI;
     |SIGUE;

     |SI enDec ! 0;
         nPos    = 100 + enDec;
         aAlfa   = (aDecima + ("0" * enDec)) % nPos;
         aDecima = "," + aAlfa;
     |SINO;
         aDecima = "";
     |FINSI;

     eaImporte = aEntero;

     aLong     = eaImporte % 0;
     nLong     = aLong;
     eaImporte = ("      " + eaImporte) % -106;
     aImpor1   = eaImporte % -103;
     aImpor2   = eaImporte % -403;

     |SI aImpor2 ! "   ";  |Y aImpor2 ! "  -";
         eaImporte = aImpor2 + "." + aImpor1;
     |SINO;
         eaImporte = aImpor1;
     |FINSI;

     aAlfa     = "          " + eaImporte + aDecima;
     eaImporte = aAlfa % -109;
|FPRC;

|PROCESO SacaFecha;
     aAlfa = efFecha % 402;
     |SI aAlfa = "01";  eaMes = "enero";      |FINSI;
     |SI aAlfa = "02";  eaMes = "febrero";    |FINSI;
     |SI aAlfa = "03";  eaMes = "marzo";      |FINSI;
     |SI aAlfa = "04";  eaMes = "abril";      |FINSI;
     |SI aAlfa = "05";  eaMes = "mayo";       |FINSI;
     |SI aAlfa = "06";  eaMes = "junio";      |FINSI;
     |SI aAlfa = "07";  eaMes = "julio";      |FINSI;
     |SI aAlfa = "08";  eaMes = "agosto";     |FINSI;
     |SI aAlfa = "09";  eaMes = "septiembre"; |FINSI;
     |SI aAlfa = "10";  eaMes = "octubre";    |FINSI;
     |SI aAlfa = "11";  eaMes = "noviembre";  |FINSI;
     |SI aAlfa = "12";  eaMes = "diciembre";  |FINSI;

     eaAlfa  = (efFecha % 102) + " de " + eaMes + " de " + (efFecha % -104);
|FPRC;

|PROCESO ComparaConImagen;
     enError    = 0;

     aContiene1 = eaDirTrabajo + eaFicheroTra;
     |ESPECIFICA "REMOTOMD5", aContiene;
     aDocRemoto = FSalida;  |QBF aDocRemoto;

     aContiene1 = eaDirTrabajo + eaFicheroIma;
     |ESPECIFICA "REMOTOMD5", aContiene;
     aDocServidor = FSalida;  |QBF aDocServidor;

     |SI aDocRemoto ! aDocServidor;
         enError = 1;
     |FINSI;
|FPRC;

|PROCESO TraeTxtComprimido;
     aAlfa = eaRutaDestino;  |QBF aAlfa;
     |SI aAlfa ! "";  nSer = 0;  |HAZ CreaDirectorios;  |FINSI;

     aAlfa = eaRutaOrigen + eaFicheroTar + " " + eaFicheroTxt;
     |ATAR aAlfa, eaRutaOrigen;

     |PARA;  |SI;  |HACIENDO;
          aAbre = eaRutaOrigen + eaFicheroTar;
          |XABRE "E", aAbre, nHandleTgz;
          |SI FSalida ] 0;  |SAL;  |FINSI;

          |PULSATECLA;
     |SIGUE;

     aAlfa = eaRutaOrigen + eaFicheroTar;
     |COMPRIME aAlfa;

     |PARA;  |SI;  |HACIENDO;
          aAbre = eaRutaOrigen + eaFicheroTgz;
          |XABRE "E", aAbre, nHandleTgz;
          |SI FSalida ] 0;  |SAL;  |FINSI;

          |PULSATECLA;
     |SIGUE;

     aAlfa = eaRutaOrigen + eaFicheroTxt;  |FBORRA aAlfa;
     aAlfa = eaRutaOrigen + eaFicheroTar;  |FBORRA aAlfa;

     eaOrigen  = eaRutaOrigen  + eaFicheroTgz;
     eaDestino = eaRutaDestino + eaFicheroTgz;

     |RFBORRA eaDestino;
     |HAZ EnviaFicheroSinMD5;

     |PARA;  |SI;  |HACIENDO;
          aAbre = eaRutaDestino + eaFicheroTgz;
          |XABRE "EC", aAbre, nHandleTgz;
          |SI FSalida ] 0;  |SAL;  |FINSI;

          |PULSATECLA;
     |SIGUE;

     Pos   = -1;
     aAlfa = eaRutaDestino + eaFicheroTgz;
     |RDESCOMPRIME aAlfa;

     |PARA;  |SI;  |HACIENDO;
          aAbre = eaRutaDestino + eaFicheroTar;
          |XABRE "EC", aAbre, nHandleTgz;
          |SI FSalida ] 0;  |SAL;  |FINSI;

          |PULSATECLA;
     |SIGUE;

     |RDETAR aAlfa, eaRutaDestino;

     |PARA;  |SI;  |HACIENDO;
          aAbre = eaRutaDestino + eaFicheroTxt;
          |XABRE "EC", aAbre, nHandleTgz;
          |SI FSalida ] 0;  |SAL;  |FINSI;

          |PULSATECLA;
     |SIGUE;

     aAlfa = eaRutaOrigen  + eaFicheroTgz;  |FBORRA aAlfa;
     aAlfa = eaRutaDestino + eaFicheroTgz;  |RFBORRA aAlfa;
     aAlfa = eaRutaDestino + eaFicheroTar;  |RFBORRA aAlfa;
|FPRC;

|PROCESO EnviaFicheroConMD5;
     aContiene1 = eaDestino;
     |ESPECIFICA "REMOTOMD5", aContiene;
     aDocRemoto = FSalida;  |QBF aDocRemoto;

     aContiene1 = eaOrigen;
     |ESPECIFICA "MD5", aContiene;
     aDocServidor = FSalida;  |QBF aDocServidor;

     |PULSATECLA;

     |SI aDocRemoto ! aDocServidor;
         aIPRemoto = "";
         |IP_REMOTO aIPRemoto;  |QBT aIPRemoto;

         |SI aIPRemoto ! "";
             |ENVIA_FICHERO eaOrigen, eaDestino;
         |SINO;
             |COPIA_FICHERO eaOrigen, eaDestino;
         |FINSI;

         aContiene1 = eaDestino;
         |ESPECIFICA "REMOTOMD5", aContiene;
         aDocRemoto = FSalida;  |QBF aDocRemoto;
     |FINSI;

     |PULSATECLA;

     |SI eaDestinoTra ! "";  |Y eaDestinoTra ! eaDestino;
         aContiene1 = eaDestinoTra;
         |ESPECIFICA "REMOTOMD5", aContiene;
         aDocRemotoTra = FSalida;  |QBF aDocRemotoTra;

         |SI aDocRemoto ! aDocRemotoTra;  |O aDocRemotoTra = "";
             |RCOPIA_FICHERO eaDestino, eaDestinoTra;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO EnviaFicheroSinMD5;
     |PULSATECLA;

     aIPRemoto = "";
     |IP_REMOTO aIPRemoto;  |QBT aIPRemoto;

     |SI aIPRemoto ! "";
         |ENVIA_FICHERO eaOrigen, eaDestino;
     |SINO;
         |COPIA_FICHERO eaOrigen, eaDestino;
     |FINSI;

     |SI FSalida ! 0;
         |PULSATECLA;
         |SI aIPRemoto ! "";
             |ENVIA_FICHERO eaOrigen, eaDestino;
         |SINO;
             |COPIA_FICHERO eaOrigen, eaDestino;
         |FINSI;
     |FINSI;

     |PULSATECLA;
|FPRC;

|PROCESO RecibeFichero;
     aContiene1 = eaDestino;
     |ESPECIFICA "REMOTOMD5", aContiene;
     aDocRemoto = FSalida;  |QBF aDocRemoto;

     aContiene1 = eaOrigen;
     |ESPECIFICA "MD5", aContiene;
     aDocServidor = FSalida;  |QBF aDocServidor;

     |SI aDocRemoto ! aDocServidor;
        aIPRemoto = "";
        |IP_REMOTO aIPRemoto;  |QBT aIPRemoto;

        |SI aIPRemoto ! "";
            |RECIBE_FICHERO eaDestino, eaOrigen;
        |SINO;
            |COPIA_FICHERO eaDestino, eaOrigen;
        |FINSI;
     |FINSI;
|FPRC;

|PROCESO CopiaRTF;
     |DBASE aBase;   |QBF aBase;

     eaDestinoTra  = eaDirTrabajo   + "planilla.rtf";
     eaDestino     = eaDirPlantilla + "planilla.rtf";
     eaOrigen      = eaDirSerPlan   + "planilla.rtf";
     |HAZ EnviaFicheroConMD5;
|FPRC;

|PROCESO CopiaRTF_JU;
     |DBASE aBase;   |QBF aBase;

     eaDestinoTra  = eaDirTrabajo   + "planilju.rtf";
     eaDestino     = eaDirPlantilla + "planilju.rtf";
     eaOrigen      = eaDirSerPlan   + "planilju.rtf";
     |HAZ EnviaFicheroConMD5;
|FPRC;

|PROCESO CopiaRTF12;
     |DBASE aBase;   |QBF aBase;

     eaDestinoTra  = eaDirTrabajo   + "planil12.rtf";
     eaDestino     = eaDirPlantilla + "planil12.rtf";
     eaOrigen      = eaDirSerPlan   + "planil12.rtf";
     |HAZ EnviaFicheroConMD5;
|FPRC;

|PROCESO VisualizaPdf;
     fFecha = ~;
     aAlfa1 = fFecha % 102;
     aAlfa2 = fFecha % 402;
     aAlfa3 = fFecha % 704;
     aAlfa4 = aAlfa3 + aAlfa2 + aAlfa1;

     aAlfa = eaDirTrabajo + "pdf";  |RMKDIR aAlfa;
     aAlfa = aAlfa + "\*.*";
     |R_PDIR aAlfa;
     |PARA; |SI FSalida = 0; |HACIENDO;
            aAlfa5 = aAlfa - aAlfa4;
            |SI FSalida = 0;  |RFBORRA aAlfa;  |FINSI;

            |R_SDIR aAlfa;
     |SIGUE;

     fFecha = ~;
     |HORA aHora;

     aAlfa4 = aHora % 102;
     aAlfa5 = aHora % 402;
     aAlfa6 = aHora % 702;

     eaDestino = eaDirTrabajo + "pdf/" + aAlfa3 + aAlfa2 + aAlfa1 + aAlfa4 + aAlfa5 + aAlfa6 + ".pdf";
     |RRENOMBRA_FICHERO eaOrigen, eaDestino;

     eaParametro1 = eaDirTrabajo + "pdf/dsabreextension";
     eaParametro2 = eaDirTrabajo + "pdf/" + aAlfa3 + aAlfa2 + aAlfa1 + aAlfa4 + aAlfa5 + aAlfa6 + ".pdf";
     eaParametro3 = eaDirSerPlan;
     eaParametro4 = eaDirPlantilla;
     eaParametro5 = eaDirTrabajo + "pdf/";

     |HAZ EjecutaDSAbreExtension;
|FPRC;

|PROCESO DescomprimeFichero;
     |SI eaFicheroPlaGz ! eaFicheroTgz;  |Y eaFicheroPlaGz ! "";
         eaOrigen  = eaDirTrabajo + eaFicheroPlaGz;
         eaDestino = eaDirTrabajo + eaFicheroTgz;
         |RRENOMBRA_FICHERO eaOrigen, eaDestino;
     |FINSI;

     aAlfa = eaDirTrabajo + eaFicheroTgz;
     Pos   = -1;
     |RDESCOMPRIME aAlfa;
     |RDETAR aAlfa, eaDirTrabajo;

     aAlfa = eaDirTrabajo + eaFicheroTgz;  |RFBORRA aAlfa;
     aAlfa = eaDirTrabajo + eaFicheroTar;  |RFBORRA aAlfa;

     |SI eaFicheroPlaMl ! eaFicheroTra;
         eaOrigen  = eaDirTrabajo + eaFicheroPlaMl;
         eaDestino = eaDirTrabajo + eaFicheroTra;
         |RRENOMBRA_FICHERO eaOrigen, eaDestino;
     |FINSI;
|FPRC;

|PROCESO ComprimeFichero;
     aAlfa = eaDirTrabajo + eaFicheroTar + " " + eaFicheroTra;
     |RATAR aAlfa, eaDirTrabajo;

     aAlfa = eaDirTrabajo + eaFicheroTar;
     |RCOMPRIME aAlfa;

     aAlfa = eaDirTrabajo + eaFicheroTar;  |RFBORRA aAlfa;

     |SI enBorraDocu = 0;  |Y enConverPDF = 0;
         aAlfa = eaDirTrabajo + eaFicheroTra;  |RFBORRA aAlfa;
     |FINSI;
|FPRC;

|PROCESO FicheroImagen;
     eaOrigen  = eaDirTrabajo + eaFicheroTra;
     eaDestino = eaDirTrabajo + eaFicheroIma;
     |RCOPIA_FICHERO eaOrigen, eaDestino;
|FPRC;

|PROCESO CreaDirectorios;
     aLong   = aAlfa % 0;
     nLong   = aLong;
     nBarra  = 0;
     aCadena = "";
     |PARA nCar = 1;  |SI nCar [ nLong;  |HACIENDO nCar = nCar + 1;
           nPos      = (nCar * 100) + 1;
           aCaracter = aAlfa % nPos;
           |SI aCaracter = "/";  |O aCaracter = "\";
               nBarra = nBarra + 1;
               |SI nBarra ! 1;
                   |SI nSer = 0;  |RMKDIR aCadena;  |FINSI;
                   |SI nSer = 1;  |MKDIR aCadena;   |FINSI;
               |FINSI;
           |FINSI;
           aCadena = aCadena + aCaracter;
     |SIGUE;
|FPRC;

|PROCESO MiraDirectorios;
     aAlfa = eaDirPlantilla;  |QBF aAlfa;
     |SI aAlfa ! "";  nSer = 0;  |HAZ CreaDirectorios;  |FINSI;

     aAlfa = eaDirTrabajo;  |QBF aAlfa;
     |SI aAlfa ! "";  nSer = 0;  |HAZ CreaDirectorios;  |FINSI;

     aAlfa = eaDirDocId2;  |QBF aAlfa;
     |SI aAlfa ! "";  nSer = 0;  |HAZ CreaDirectorios;  |FINSI;

     aAlfa = eaDirSerGuarda;  |QBF aAlfa;
     |SI aAlfa ! "";  nSer = 1;  |HAZ CreaDirectorios;  |FINSI;
|FPRC;

|PROCESO ImprimeDocPorImpresora;
     eaOrigen       = eaDirSerPlan   + "dsprint.exe";
     eaDestino      = eaDirPlantilla + "dsprint.exe";
     eaDestinoTra   = eaDirTrabajo   + "dsprint.exe";

     |HAZ EnviaFicheroConMD5;

     aAlfa  = "cmd " + &34 + "/c START /WAIT " + eaDirTrabajo + "dsprint " + eaDirTrabajo + eaFicheroTra + &34;
     |RSYSTEM aAlfa;
|FPRC;

||  WORD ------------------------------------------------------------------

|PROCESO GrabaFicheroExterno;
     aAlfa = eaAsigna % 101;
     |SI aAlfa ! "V";  |Y aAlfa ! "M";
      |Y aAlfa ! "I";  |Y aAlfa ! "T";
      |Y aAlfa ! "X";  |Y aAlfa ! "Y";
         |ACABA;
     |FINSI;

     aAlfa = (eaAsigna % 101) + &13 + &10;  |XGRABA enHandleTxt, aAlfa;
     aAlfa = (eaAsigna % 220) + &13 + &10;  |XGRABA enHandleTxt, aAlfa;
     aAlfa = eaAlfa + &13 + &10;            |XGRABA enHandleTxt, aAlfa;
|FPRC;

|PROCESO AsignaTabla;
     |SI enModoExterno = 0;
         aAlfa      = eaAsigna % 101;

         |SI aAlfa = "V";  |O aAlfa = "M";
          |O aAlfa = "I";  |O aAlfa = "T";
          |O aAlfa = "X";  |O aAlfa = "Y";
              eaAsigna = eaAsigna % 220;  |QBF eaAsigna;
         |FINSI;

         |WORD_ASIGNA_TEXTO enWord1, eaAsigna, eaAlfa;
     |FINSI;

     |SI enModoExterno = 1;
         |HAZ GrabaFicheroExterno;
     |FINSI;
|FPRC;

|PROCESO AsignaTabla2;
     |SI enModoExterno = 0;
         aAlfa      = eaAsigna % 101;

         |SI aAlfa = "V";  |O aAlfa = "M";
          |O aAlfa = "I";  |O aAlfa = "T";
          |O aAlfa = "X";  |O aAlfa = "Y";
              eaAsigna = eaAsigna % 220;  |QBF eaAsigna;
         |FINSI;

         |WORD_ASIGNA_TEXTO enWord2, eaAsigna, eaAlfa;
     |FINSI;

     |SI enModoExterno = 1;
         |HAZ GrabaFicheroExterno2;
     |FINSI;
|FPRC;

|PROCESO AsignaWord;
     |SI enModoExterno = 0;
         aAlfa      = eaAsigna % 101;

         |SI aAlfa = "V";  |O aAlfa = "M";
          |O aAlfa = "I";  |O aAlfa = "T";
          |O aAlfa = "X";  |O aAlfa = "Y";
              eaAsigna = eaAsigna % 220;  |QBF eaAsigna;
         |FINSI;

         |SI enCargaPuntero = 1;
             eaCamWord  = eaAsigna;
             IeaCamWord = IeaCamWord + 1;

             eaCamWord  = eaAlfa;
             IeaCamWord = IeaCamWord + 1;

             enCamWord  = enCamWord  + 2;
         |SINO;
             eaAsigna = "!" + eaAsigna;
             |PARA;  |SI;  |HACIENDO;
                  |WORD_ASIGNA_TEXTO enWord1, eaAsigna,  eaAlfa;
                  |SI FSalida ! 0;  |SAL;  |FINSI;
             |SIGUE;
         |FINSI;
     |FINSI;

     |SI enModoExterno = 1;
         |HAZ GrabaFicheroExterno;
     |FINSI;
|FPRC;

|PROCESO AsignaWordPie;
     |SI enModoExterno ! 0;  |ACABA;  |FINSI;

     |WORD_ASIGNA_TEXTO enWord1, eaAsigna,  eaAlfa;
|FPRC;

|PROCESO EditaModoGenerador;
     |SI ea16 ! "I";
          nWord = 1;
          |WORD_ABRE nWord, eaDestino;
          |WORD_PROPIEDADES nWord, "Visible", "SI";
          FSalida = "NO";
          |PARA;  |SI FSalida = "NO";  |HACIENDO;
                |PULSATECLA;
                |WORD_PROPIEDADES nWord, "Quit", "";
          |SIGUE;
     |SINO;
         |HAZ ImprimeDocPorImpresora;
     |FINSI;
|FPRC;

|PROCESO PegarWordId1;
     |SI enModoExterno = 0;
         |WORD_CARGA_TEXTO enWord1, eaAsigna, eaAlfa;
     |FINSI;

     |SI enModoExterno = 1;
         aAbre = eaDirTrabServi + "asignaya.txt";
         |XABRE "WB", aAbre, nHandleYa;

         aAlfa = "[FICHERO]#" + eaDirTrabajo + eaFicheroTra + &13 + &10;
         |XGRABA nHandleYa, aAlfa;

         aAlfa = "[VISUALIZACION]" + &13 + &10;
         |XGRABA nHandleYa, aAlfa;

         aAlfa = "M" + &13 + &10;                  |XGRABA nHandleYa, aAlfa;
         aAlfa = (eaAsigna % 230) + &13 + &10;     |XGRABA nHandleYa, aAlfa;
         aAlfa = eaAlfa + &13 + &10;               |XGRABA nHandleYa, aAlfa;
         |XCIERRA nHandleYa;

         eaOrigen       = eaDirTrabServi + "asignaya.txt";
         eaDestino      = eaDirTrabajo   + "asignaya.txt";
         |HAZ EnviaFicheroSinMD5;

         |FBORRA eaOrigen;

         eaParametro1 = eaDirTrabajo + "dsxml";
         eaParametro2 = eaDirTrabajo + "asignaya.txt";
         eaParametro3 = eaDirSerPlan;
         eaParametro4 = eaDirPlantilla;
         eaParametro5 = eaDirTrabajo;
         eaParametro6 = "";

         |HAZ EjecutaDSXML;
     |FINSI;
|FPRC;

|PROCESO PegarWordId2;
     |SI enModoExterno = 0;
         |WORD_CARGA_TEXTO enWord2, eaAsigna, eaAlfa;
     |FINSI;

     |SI enModoExterno = 1;
         aAlfa = "M" + &13 + &10;                  |XGRABA enHandleTxt2, aAlfa;
         aAlfa = (eaAsigna % 230) + &13 + &10;     |XGRABA enHandleTxt2, aAlfa;
         aAlfa = eaAlfa + &13 + &10;               |XGRABA enHandleTxt2, aAlfa;
     |FINSI;
|FPRC;

|PROCESO PegarWordIdOtro;
     |SI enModoExterno = 0;
         |WORD_CARGA_TEXTO enWord2, eaAsigna, eaAlfa;
     |FINSI;

     |SI enModoExterno = 1;
         aAbre = eaDirTraId2 + "asignaya.txt";
         |XABRE "WB", aAbre, nHandleYa;

         aAlfa = "[FICHERO]#" + eaDirDocId2 + eaFicheroTra + &13 + &10;
         |XGRABA nHandleYa, aAlfa;

         aAlfa = "[VISUALIZACION]" + &13 + &10;
         |XGRABA nHandleYa, aAlfa;

         aAlfa = "M" + &13 + &10;                  |XGRABA nHandleYa, aAlfa;
         aAlfa = (eaAsigna % 230) + &13 + &10;     |XGRABA nHandleYa, aAlfa;
         aAlfa = eaAlfa + &13 + &10;               |XGRABA nHandleYa, aAlfa;
         |XCIERRA nHandleYa;

         eaOrigen       = eaDirTraId2 + "asignaya.txt";
         eaDestino      = eaDirDocId2 + "asignaya.txt";
         |HAZ EnviaFicheroSinMD5;

         |FBORRA eaOrigen;

         eaParametro1 = eaDirDocId2  + "dsxml";
         eaParametro2 = eaDirDocId2  + "asignaya.txt";
         eaParametro3 = eaDirSerPlan;
         eaParametro4 = eaDirDocId2;
         eaParametro5 = eaDirDocId2;
         eaParametro6 = "";

         |HAZ EjecutaDSXML;
     |FINSI;
|FPRC;

|PROCESO AbreWordId1;
     aAbreId1 = eaDirTrabajo + eaFicheroTra;

     |WORD_ABRE nWord, aAbreId1;
     enWord1 = nWord;

     |WORD_PROPIEDADES enWord1, "Visible", "NO";

     |XABRE "EC", eaPathLogo, nHandle;
     |SI FSalida < 0;
         eaPathLogo = "";
     |FINSI;

     |XABRE "EC", eaPathLogoIso, nHandle;
     |SI FSalida < 0;
         eaPathLogoIso = "";
     |FINSI;

     IeaCamWord = eaCamWord1<-;

     |SI eaPathLogo ! "";
         aAlfa = "@" + eaPathLogo;
         |WORD_CARGA_TEXTO enWord1, "!<<LOGO>>", aAlfa;
         |WORD_CARGA_TEXTO enWord1, "!!@<<LOGO>>", aAlfa;
     |SINO;
         eaAlfa   = "";
         eaAsigna = "V<<LOGO>>";
         |HAZ AsignaWord;
     |FINSI;

     |SI eaPathLogoIso ! "";
         aAlfa = "@" + eaPathLogoIso;
         |WORD_CARGA_TEXTO enWord1, "!<<LOGO>>", aAlfa;
         |WORD_CARGA_TEXTO enWord1, "!!@<<LOGO>>", aAlfa;
     |SINO;
         eaAlfa   = "";
         eaAsigna = "V<<LOGOISO>>";
         |HAZ AsignaWord;
     |FINSI;
|FPRC;

|PROCESO CierraWordId1;
     |SI enCamWord ! 0;
         IeaCamWord = eaCamWord1<-;
         eaAlfa     = enCamWord; |QBT eaAlfa;
         |WORD_ASIGNA_TEXTO enWord1, eaAlfa, eaCamWord;
     |FINSI;

     |WORD_PROPIEDADES enWord1, "limpiafinal", "";
     |WORD_PROPIEDADES enWord1, "Paginacion", "0001";
     |WORD_SALVA enWord1, "";

     |SI ea16 ! "I";
         aAbreId1 = eaDirTrabajo + eaFicheroTra;
         |WORD_ABRE nWord, aAbreId1;
         enWord1 = nWord;

         |WORD_PROPIEDADES enWord1, "Visible", "SI";

         FSalida = "NO";
         |PARA;  |SI FSalida = "NO";  |HACIENDO;
                 |PULSATECLA;
                 |WORD_PROPIEDADES enWord1, "Quit", "";
         |SIGUE;
     |SINO;
         |HAZ ImprimeDocPorImpresora;
     |FINSI;

     nTope      = enCamWord * 2;
     IeaCamWord = eaCamWord1<-;
     |PARA nPuntero = 1;  |SI nPuntero [ nTope;  |HACIENDO nPuntero = nPuntero + 1;
           eaCamWord = "";
           IeaCamWord = IeaCamWord + 1;
     |SIGUE;

     enCamWord = 0;
     |PULSATECLA;
|FPRC;

|PROCESO GrabaFicheroExterno2;
     aAlfa = eaAsigna % 101;
     |SI aAlfa ! "V";  |Y aAlfa ! "M";
      |Y aAlfa ! "I";  |Y aAlfa ! "T";
      |Y aAlfa ! "X";  |Y aAlfa ! "Y";
         |ACABA;
     |FINSI;

     aAlfa = (eaAsigna % 101) + &13 + &10;  |XGRABA enHandleTxt2, aAlfa;
     aAlfa = (eaAsigna % 220) + &13 + &10;  |XGRABA enHandleTxt2, aAlfa;
     aAlfa = eaAlfa + &13 + &10;            |XGRABA enHandleTxt2, aAlfa;
|FPRC;

|PROCESO AsignaWord2;
     |SI enModoExterno = 0;
         aAlfa      = eaAsigna % 101;

         |SI aAlfa = "V";  |O aAlfa = "M";
          |O aAlfa = "I";  |O aAlfa = "T";
          |O aAlfa = "X";  |O aAlfa = "Y";
              eaAsigna = eaAsigna % 220;  |QBF eaAsigna;
         |FINSI;

         eaAsigna = "!" + eaAsigna;
         |PARA;  |SI;  |HACIENDO;
              |WORD_ASIGNA_TEXTO enWord2, eaAsigna,  eaAlfa;
              |SI FSalida ! 0;  |SAL;  |FINSI;
         |SIGUE;
     |FINSI;

     |SI enModoExterno = 1;
         |HAZ GrabaFicheroExterno2;
     |FINSI;
|FPRC;

|PROCESO AbreWordExterno;
     eaParametro1 = eaDirTrabajo + "dsxml";
     eaParametro2 = eaDirTrabajo + eaFicheroTxt;
     eaParametro3 = eaDirSerPlan;
     eaParametro4 = eaDirPlantilla;
     eaParametro5 = eaDirTrabajo;
     eaParametro6 = "";

     |HAZ EjecutaDSXML;
|FPRC;

|PROCESO InstalaImpre;
     nInstala = 0;

     aAlfa = "C:\ds\dspdf\bin\puerto.exe";
     |XABRE "EC", aAlfa, nHandle;
     |SI FSalida < 0;  nInstala = 1;  |FINSI;

     eaOrigen       = eaDirSerPlan   + "dspdf.tgz";
     eaDestino      = eaDirPlantilla + "dspdf.tgz";
     eaDestinoTra   = "";

     |HAZ EnviaFicheroConMD5;
     |SI aDocRemoto ! aDocServidor;
         nInstala = 1;
     |FINSI;

     |SI nInstala = 1;
         aAlfa = eaDirPlantilla + "dspdf.tgz";
         Pos   = -1;
         |RDESCOMPRIME aAlfa;
         |RDETAR aAlfa, "c:\ds\";

         aAlfa = eaDirPlantilla + "dspdf.tar";  |RFBORRA aAlfa;

         aAlfa = "c:\ds\dspdf\bin\puerto.exe";
         |XABRE "EC", aAlfa, nHandle;
         |SI FSalida < 0;
             |MENAV "0000 No puedo instalar la impresora en PDF.";
             nSwError = -1; |ACABA;
         |FINSI;

         aAlfa  = "cmd " + &34 + "/c START /WAIT C:\DS\DSPDF\BIN\PUERTO.EXE" + &34;
         |RSYSTEM aAlfa;
     |FINSI;
|FPRC;

|PROCESO GrabaImpresora;
     enConverPDF = 0;

     nSwError = 0;
     |HAZ InstalaImpre;

     |SI nSwError < 0;
         aAlfa = "[IMPRESORA]" + eaTipoImpresion + &13 + &10;
         |XGRABA enHandleTxt, aAlfa;
         |ACABA;
     |FINSI;

     aAlfa = eaTipoImpresion % -102;
     |SI aAlfa = "#P";
         aAlfa = "[IMPRESORA]#I#2#dspdf#2"   + &13 + &10;
         |XGRABA enHandleTxt, aAlfa;
     |FINSI;

     |SI aAlfa = "NO";
         aAlfa = "[IMPRESORA]#I#2#dspdf#2" + &13 + &10;
         |XGRABA enHandleTxt, aAlfa;
     |FINSI;

     |SI aAlfa = "#0";
         aAlfa = "[IMPRESORA]#F#0"   + &13 + &10;
         |XGRABA enHandleTxt, aAlfa;
     |FINSI;

     |SI aAlfa = "#1";
         aAlfa = "[IMPRESORA]#F#1"   + &13 + &10;
         |XGRABA enHandleTxt, aAlfa;
     |FINSI;
     enConverPDF = 1;
|FPRC;

|PROCESO EditaModoExterno;
     |SI ea16 ! "I";
         aAbre = eaDirTrabServi + eaFicheroTxt;
         |XABRE "WB", aAbre, enHandleTxt;

         aAlfa = "[FICHERO]#" + eaDirTrabajo + eaFicheroTra + &13 + &10;
         |XGRABA enHandleTxt, aAlfa;

         aAlfa = "[IMPRESORA]#P" + &13 + &10;
         |XGRABA enHandleTxt, aAlfa;

         |XCIERRA enHandleTxt;

         eaOrigen       = eaDirTrabServi + eaFicheroTxt;
         eaDestino      = eaDirTrabajo   + eaFicheroTxt;
         |HAZ EnviaFicheroSinMD5;

         |FBORRA eaOrigen;

         |HAZ AbreWordExterno;
     |SINO;
         |HAZ ImprimeDocPorImpresora;
     |FINSI;
|FPRC;

|PROCESO AbreWordId2;
     eaDirDocId2    = "C:\DOCUMENTOS\DSPREVEX\OTROS\";
     eaDirTraId2    = eaDirTrabServi + "otros/";  |MKDIR eaDirTraId2;
     eaOrigen       = eaDirSerPlan   + eaFicheroPlaGz;
     eaDestino      = eaDirPlantilla + eaFicheroPlaGz;
     eaDestinoTra   = eaDirDocId2    + eaFicheroPlaGz;
     aGuarda        = eaDirTrabajo;
     eaDirTrabajo   = eaDirDocId2;

     |HAZ MiraDirectorios;
     |HAZ EnviaFicheroConMD5;
     |HAZ DescomprimeFichero;

     eaDirTrabajo  = aGuarda;
     enError       = 0;

     |SI enModoExterno = 0;
         aAbreId2      = eaDirDocId2 + eaFicheroTra;
         |WORD_ABRE nWord, aAbreId2;
         enWord2 = nWord;
         |SI FSalida < 0;  enError = 1;  |FINSI;

         |WORD_PROPIEDADES enWord2, "Visible", "NO";
     |SINO;
         aAbre = eaDirTraId2 + eaFicheroTxt;
         |XABRE "WB", aAbre, enHandleTxt2;

         aAlfa = "[FICHERO]#" + eaDirDocId2 + eaFicheroTra + &13 + &10;
         |XGRABA enHandleTxt2, aAlfa;

         aAlfa = "[GRABA ORIGEN]" + &13 + &10;
         |XGRABA enHandleTxt2, aAlfa;

         aAlfa = "[VISUALIZACION]" + &13 + &10;
         |XGRABA enHandleTxt2, aAlfa;
     |FINSI;
|FPRC;

|PROCESO AbreWordExterno2;
     eaParametro1 = eaDirDocId2  + "dsxml";
     eaParametro2 = eaDirDocId2  + eaFicheroTxt;
     eaParametro3 = eaDirSerPlan;
     eaParametro4 = eaDirPlantilla;
     eaParametro5 = eaDirDocId2;
     eaParametro6 = "";

     |HAZ EjecutaDSXML;

     aAlfa = "M" + &13 + &10;                         |XGRABA enHandleTxt, aAlfa;
     aAlfa = "<<PEGAR>>" + &13 + &10;                 |XGRABA enHandleTxt, aAlfa;
     aAlfa = eaDirDocId2 + eaFicheroTra + &13 + &10;  |XGRABA enHandleTxt, aAlfa;
     aAlfa = "[VISUALIZACION]" + &13 + &10;           |XGRABA enHandleTxt, aAlfa;

     |XCIERRA enHandleTxt;

     eaOrigen       = eaDirTrabServi + eaFicheroTxt;
     eaDestino      = eaDirTrabajo   + eaFicheroTxt;
     |HAZ EnviaFicheroSinMD5;

     |FBORRA eaOrigen;

     |HAZ AbreWordExterno;

     aAlfa = eaDirDocId2 + eaFicheroTra;  |RFBORRA aAlfa;
     aAlfa = eaDirDocId2 + eaFicheroTxt;  |RFBORRA aAlfa;

     aAbre = eaDirTrabServi + eaFicheroTxt;
     |XABRE "WB", aAbre, enHandleTxt;

     aAlfa = "[FICHERO]#" + eaDirTrabajo + eaFicheroTra + &13 + &10;
     |XGRABA enHandleTxt, aAlfa;
|FPRC;

|PROCESO CierraWordId2;
     |SI enModoExterno = 0;
         |WORD_SALVA enWord2, "";
         |PULSATECLA;

         aAbreId2 = eaDirDocId2 + eaFicheroTra;
         |WORD_CARGA_TEXTO enWord1, "!<<PEGAR>>", aAbreId2;

         aAbreId2 = eaDirDocId2 + eaFicheroTra;
         |RFBORRA aAbreId2;
     |SINO;
         |XCIERRA enHandleTxt2;

         eaOrigen       = eaDirTraId2 + eaFicheroTxt;
         eaDestino      = eaDirDocId2 + eaFicheroTxt;
         |HAZ EnviaFicheroSinMD5;

         |FBORRA eaOrigen;

         |HAZ AbreWordExterno2;
     |FINSI;

     eaDirDocId2 = "";
|FPRC;

|PROCESO CierraYAbreWord;
     |XCIERRA enHandleTxt;

     eaOrigen       = eaDirTrabServi + eaFicheroTxt;
     eaDestino      = eaDirTrabajo   + eaFicheroTxt;
     |HAZ EnviaFicheroSinMD5;
     |FBORRA eaOrigen;

     eaParametro1 = eaDirTrabajo  + "dsxml";
     eaParametro2 = eaDirTrabajo  + eaFicheroTxt;
     eaParametro3 = eaDirSerPlan;
     eaParametro4 = eaDirPlantilla;
     eaParametro5 = eaDirTrabajo;
     eaParametro6 = "";

     |HAZ EjecutaDSXML;

     aAbre = eaDirTrabServi + eaFicheroTxt;
     |XABRE "WB", aAbre, enHandleTxt;

     aAlfa = "[FICHERO]#" + eaDirTrabajo + eaFicheroTra + &13 + &10;
     |XGRABA enHandleTxt, aAlfa;
|FPRC;


||  EXCEL ------------------------------------------------------------------

|PROCESO ExtraePath;
     aPath     = aVersion1;
     aLongitud = aPath % 0;
     nLongitud = aLongitud;
     |PARA nPos = 1; |SI nPos [ nLongitud; |HACIENDO nPos = nPos + 1;
           nCaracter = (nPos * 100) + 1;
           aCaracter = aPath % nCaracter;
           |SI aCaracter = ",";
               nPos = nLongitud - nPos;
               nPos = nPos + 100;
               nPos = (-1) * nPos;
               aPath = aPath % nPos;
               |SAL;
          |FINSI;
     |SIGUE;

     aPath = aPath - "[";
     aPath = aPath - "]";
     |QBF aPath;
|FPRC;

|PROCESO EditaCrystalSystem;
     |SI ea16 ! "I";
         aAlfa = "ftype CrystalReports > pp.txt"; |RSYSTEM aAlfa;
         |XABRE "C", "pp.txt", nHandle;
         |SI FSalida ] 0;
            |XLEE nHandle, 250, aAlfa;
            |XCIERRA nHandle; |RFBORRA "pp.txt";
         |FINSI;
         aAlfa = aAlfa - "crw32.exe";
         |SI FSalida = 0;
            aPath = "NO LOCALIZADO";
         |SINO;
            aPath = "CrystalReports=" + &34;
            aPath = aAlfa - aPath;
            aAlfa = &34 + " /dde";
            aPath = aPath - aAlfa;
         |FINSI;

         |SI aPath = "NO LOCALIZADO";
             |MENAV "0000 No puedo encontrar automaticamente el Crystal Reports";
             |ACABA;
         |FINSI;
         |QBF aPath;

         aAlfa  = aPath + "crw32.exe " + eaDirTrabajo + eaFicheroTra;
         |RSYSTEM aAlfa;
     |SINO;
         |HAZ ImprimeDocPorImpresora;
     |FINSI;
|FPRC;

|PROCESO EditaExcelSystem;
     |SI ea16 ! "I";
        eaParametro1 = eaDirTrabajo + "dsabreextension";
        eaParametro2 = eaDirTrabajo + eaFicheroTra;
        eaParametro3 = eaDirSerPlan;
        eaParametro4 = eaDirPlantilla;
        eaParametro5 = eaDirTrabajo;

        |HAZ EjecutaDSAbreExtension;
     |SINO;
         |HAZ ImprimeDocPorImpresora;
     |FINSI;
|FPRC;

|PROCESO AbreExcel;
     |CARGADLL "agixl97.dll";
     |SI FSalida < 0;
         |MENAV "0000 No puedo cargar agixl97.dll, consulte con su Distribuidor de Sofware.";
         |ACABA;
     |FINSI;

     aAbreId1 = eaDirTrabajo + eaFicheroTra;
     |ALFACALLDLL "agixl97.dll", "carga_book", aAbreId1;
|FPRC;

|PROCESO CargaEtiqueta;
     |ALFACALLDLL "agixl97.dll", "selecciona_hoja", eaEtiqueta;

     |SI eaPathLogo = "";  |ACABA;  |FINSI;

     aAlfa = "";
     aSit  = "";

     |SI eaPlanilla = "02020"; aSit = "A2";  |FINSI;
     |SI eaPlanilla = "02030"; aSit = "B2";  |FINSI;
     |SI eaPlanilla = "02040"; aSit = "B2";  |FINSI;
     |SI eaPlanilla = "02050"; aSit = "B2";  |FINSI;
     |SI eaPlanilla = "02090"; aSit = "A1";  |FINSI;
     |SI eaPlanilla = "02100"; aSit = "A1";  |FINSI;
     |SI eaPlanilla = "02110"; aSit = "L1";  |FINSI;
     |SI eaPlanilla = "02120"; aSit = "L1";  |FINSI;
     |SI eaPlanilla = "02130"; aSit = "E1";  |FINSI;
     |SI eaPlanilla = "03000"; aSit = "B2";  |FINSI;
     |SI eaPlanilla = "03010"; aSit = "B2";  |FINSI;
     |SI eaPlanilla = "03020"; aSit = "B2";  |FINSI;
     |SI eaPlanilla = "03030"; aSit = "B2";  |FINSI;
     |SI eaPlanilla = "03040"; aSit = "B2";  |FINSI;
     |SI eaPlanilla = "03050"; aSit = "B2";  |FINSI;
     |SI eaPlanilla = "03060"; aSit = "B2";  |FINSI;
     |SI eaPlanilla = "06000"; aSit = "A2";  |FINSI;
     |SI eaPlanilla = "06010"; aSit = "A2";  |FINSI;
     |SI eaPlanilla = "11030"; aSit = "A1";  |FINSI;
     |SI eaPlanilla = "11040"; aSit = "A1";  |FINSI;
     |SI eaPlanilla = "99999"; aSit = "A1";  |FINSI;

     |SI aSit ! "";
         aAlfa = aSit + "," + eaPathLogo;
         |ALFACALLDLL "agixl97.dll","poke_imagen", aAlfa;

         ||eaAlfa = aSit + ",Módulo1.MueveImagen";
         |||ALFACALLDLL "agixl97.dll","ejecuta_celda", eaAlfa;
     |FINSI;
|FPRC;

|PROCESO AsignaExcel;
     |ALFACALLDLL "agixl97.dll","poke_dato", eaAlfa;
|FPRC;

|PROCESO CierraExcel;
     aGuarda = eaFicheroTra;
     aAlfa   = eaDirTrabajo + "trabajo.xls";
     |RFBORRA aAlfa;

     |PARA;  |SI;  |HACIENDO;
         aAlfa   = eaDirTrabajo + "trabajo.xls";
         |XABRE "EC", aAlfa, nHandle;
         |SI FSalida ] 0;
             |MENAV "0000 Hay una hoja excel ejecutandose o colgada, por favor quitela";
         |SINO;
             |SAL;
         |FINSI;
     |SIGUE;

     |ALFACALLDLL "agixl97.dll", "fichero_destino", aAlfa;

     |ALFACALLDLL "agixl97.dll", "fin_book", "salva";
     |DESCARGADLL "agixl97.dll";

     aAlfa = eaDirTrabajo + eaFicheroTra;
     |RFBORRA aAlfa;

     eaFicheroTra = "trabajo.xls";

     |SI ea16 = "A";
         |HAZ EditaExcelSystem;
     |FINSI;

     |SI ea16 = "I";
         |HAZ ImprimeDocPorImpresora;
     |FINSI;

     eaOrigen  = eaDirTrabajo + eaFicheroTra;
     eaDestino = eaDirTrabajo + aGuarda;
     |RCOPIA_FICHERO eaOrigen, eaDestino;

     aAlfa        = eaDirTrabajo + eaFicheroTra;  |RFBORRA aAlfa;
     eaFicheroTra = aGuarda;
|FPRC;

|PROCESO TraeDocumento;
     eaAlfa   = eaDirTrabajo + eaDocumento + ".xml";
     |XABRE "EC", eaAlfa, nHandle;
     |SI FSalida ] 0;
         |ACABA;
     |FINSI;

     |DBASE aBase;   |QBF aBase;
     eaDestinoTra  = eaDirTrabajo   + eaDocumento + ".xgz";
     eaDestino     = eaDirPlantilla + eaDocumento + ".xgz";
     eaOrigen      = eaDirSerPlan   + eaDocumento + ".xgz";
     |HAZ EnviaFicheroConMD5;

     eaOrigen  = eaDestinoTra;
     eaDestino = eaDirTrabajo   + eaDocumento + ".tgz";
     |RFBORRA eaDestino;
     |RRENOMBRA_FICHERO eaOrigen, eaDestino;

     aAlfa = eaDestino;
     |RDESCOMPRIME aAlfa;
     |RDETAR aAlfa, eaDirTrabajo;

     aAlfa = eaDirTrabajo + eaDocumento + ".tgz";  |RFBORRA aAlfa;
     aAlfa = eaDirTrabajo + eaDocumento + ".tar";  |RFBORRA aAlfa;
|FPRC;

|PROCESO PegaDocumento;
     |HAZ TraeDocumento;

     eaAlfa   = eaDirTrabajo + eaDocumento + ".xml";
     |HAZ PegarWordId1;

     |RFBORRA eaAlfa;
|FPRC;

|PROCESO EjecutaGrafico;
     aDirGrafico = "C:\DOCUMENTOS\DSPREVEX\GRAFICOS\";
     aAbre       = aDirGrafico + "teechart5.ocx";
     |XABRE "EC", aAbre, nHandle;
     |SI FSalida < 0;
         eaOrigen  = eaDirSerPlan + "teechart5.xgz";
         eaDestino = aDirGrafico + "teechart5.xgz";
         |HAZ EnviaFicheroSinMD5;

         eaOrigen  = eaDestino;
         eaDestino = aDirGrafico + "teechart5.tgz";
         |RCOPIA_FICHERO eaOrigen, eaDestino;

         aAlfa = eaDestino;
         Pos   = -1;
         |RDESCOMPRIME aAlfa;
         |RDETAR aAlfa, aDirGrafico;

         aAlfa = aDirGrafico + "teechart5.tgz";  |RFBORRA aAlfa;
         aAlfa = aDirGrafico + "teechart5.tar";  |RFBORRA aAlfa;

         aAlfa  = "cmd " + &34 + "/c START /WAIT regsvr32 " + aDirGrafico + "teechart5.ocx /s" + &34;
         |RSYSTEM aAlfa;
     |FINSI;

     eaOrigen  = eaDirSerPlan + "dsgrafico.exe";
     eaDestino = aDirGrafico + "dsgrafico.exe";
     |HAZ EnviaFicheroConMD5;

     aAlfa  = "cmd " + &34 + "/c START /WAIT " + eaDestino + " " + aDirGrafico + eaGrafico + ".txt" + &34;
     |RSYSTEM aAlfa;
|FPRC;

|PROCESO AbreTrozoDocumento;
     eaDirDocId2    = "C:\DOCUMENTOS\DSPREVEX\OTROS\";
     eaDirTraId2    = eaDirTrabServi + "otros/";  |MKDIR eaDirTraId2;
     eaOrigen       = eaDirSerPlan   + eaFicheroPlaGz;
     eaDestino      = eaDirPlantilla + eaFicheroPlaGz;
     eaDestinoTra   = eaDirDocId2    + eaFicheroPlaGz;
     aGuarda        = eaDirTrabajo;
     eaDirTrabajo   = eaDirDocId2;

     |SI enNumeroDoc = 1;
         aFicheroTra  = eaFicheroTra;
         aFicheroTgz  = eaFicheroTgz;
         eaFicheroTra = eaFicheroPlaMl;
         eaFicheroTgz = (eaFicheroPlaGz - ".xgz") + ".tgz";

         |HAZ MiraDirectorios;
         |HAZ EnviaFicheroConMD5;
         |HAZ DescomprimeFichero;

         eaFicheroTgz = aFicheroTgz;
         eaFicheroTra = aFicheroTra;
     |FINSI;

     eaDirTrabajo  = aGuarda;
     enError       = 0;

     aAbre = eaDirTraId2 + eaFicheroTxt;
     |XABRE "WB", aAbre, enHandleTxt2;

     aFicheroResul = eaRaizDoc + (("0000" + enNumeroDoc) % -104) + ".xml";

     aAlfa = "[FICHERO]#" + eaDirDocId2 + eaFicheroPlaMl + "#" + eaDirDocId2 + aFicheroResul + &13 + &10;
     |XGRABA enHandleTxt2, aAlfa;

     |SI enNumeroDoc = 1;
         aAlfa = "[GRABA ORIGEN]" + &13 + &10;
         |XGRABA enHandleTxt2, aAlfa;
     |FINSI;

     aAlfa = "[VISUALIZACION]" + &13 + &10;
     |XGRABA enHandleTxt2, aAlfa;
|FPRC;

|PROCESO CierraTrozoDocumento;
     |XCIERRA enHandleTxt2;

     eaOrigen       = eaDirTraId2 + eaFicheroTxt;
     eaDestino      = eaDirDocId2 + eaFicheroTxt;
     |HAZ EnviaFicheroSinMD5;

     |FBORRA eaOrigen;

     eaParametro1 = eaDirDocId2   + "dsxml";
     eaParametro2 = eaDirDocId2   + eaFicheroTxt;
     eaParametro3 = eaDirSerPlan;
     eaParametro4 = eaDirPlantilla;
     eaParametro5 = eaDirDocId2;
     eaParametro6 = "";

     |HAZ EjecutaDSXML;

     aFicheroResul = eaRaizDoc + (("0000" + enNumeroDoc) % -104) + ".xml";

     aAlfa = "M" + &13 + &10;                          |XGRABA enHandleTxt, aAlfa;
     aAlfa = "<<PEGAR>>" + &13 + &10;                  |XGRABA enHandleTxt, aAlfa;
     aAlfa = eaDirDocId2 + aFicheroResul + &13 + &10;  |XGRABA enHandleTxt, aAlfa;

     eaDirDocId2 = "";
|FPRC;

|PROCESO PreparaCrystal;
     |PULSATECLA;

     |DBASE aBase;
     aAlfa1 = aBase + "tmp";  |MKDIR aAlfa1;

     eaOrigen  = aBase + "documentos/plantillas/" + eaInforme + ".xgz";
     eaDestino = aAlfa1 + "/" + eaInforme + ".tgz";
     |COPIA_FICHERO eaOrigen, eaDestino;
     |PULSATECLA;

     aAlfa1 = aBase + "def/";
     aAlfa2 = aBase + "tmp/" + eaInforme + ".tgz";

     aAlfa = aAlfa2;
     |DESCOMPRIME aAlfa;
     |PULSATECLA;

     |DETAR aAlfa, aAlfa1;
     |PULSATECLA;

     aAlfa = aBase + "tmp/" + eaInforme + ".tgz";  |FBORRA aAlfa;
     aAlfa = aBase + "tmp/" + eaInforme + ".tar";  |FBORRA aAlfa;
     aAlfa = aBase + "def/" + eaInforme + ".tar";  |FBORRA aAlfa;

     |PULSATECLA;
|FPRC;

|PROCESO DsSelect;
     || eaParametro1 = Path y fichero exe
     || eaParametro2 = Path y fichero a editar
     || eaParametro3 = Origen  del dsselect
     || eaParametro4 = Destino 1 del dsselect
     || eaParametro5 = Destino 2 del dsselect

     aAlfa = eaParametro2;  |QBF aAlfa;
     |SI aAlfa ! "";  nSer = 0;  |HAZ CreaDirectorios;  |FINSI;

     eaOrigen       = eaParametro1 + "dsselect.exe";
     eaDestino      = eaParametro2 + "dsselect.exe";
     eaDestinoTra   = eaParametro2 + "dsselect.exe";
     |HAZ EnviaFicheroConMD5;

     aAlfa = eaParametro2 + "dsselect.txt";
     |RFBORRA aAlfa;

     aAlfa  = "cmd " + &34 + "/c START /WAIT " + eaParametro2 + "dsselect.exe " + "C:\ " + eaParametro2 + "dsselect.txt" + &34;
     |RSYSTEM aAlfa;

     eaRuta   = "";
     eaNomFic = "";

     aAbre = eaParametro2 + "dsselect.txt";
     |XABRE "CU", aAbre, nHandle;
     |SI FSalida < 0;   |ACABA;  |FINSI;

     |XLEE nHandle, 250, eaRuta;
     |SI FSalida < 0
         eaRuta   = "";
         |XCIERRA nHandle;
         |ACABA;
     |FINSI;

     |XCIERRA nHandle;

     |QBF eaRuta;
     |SI eaRuta = "";  |ACABA;  |FINSI;

     aAlfa    = eaRuta;
     aLong    = aAlfa % 0;
     nLong    = aLong;
     eaRuta   = "";
     |PARA nCarac = 1;  |SI nCarac [ nLong;  |HACIENDO nCarac = nCarac + 1;
           nPos   = (nCarac * 100) + 1;
           aCarac =  aAlfa % nPos;
           |SI aCarac = "/";  |O aCarac = "\";
               eaNomFic = "";
           |SINO;
               eaNomFic = eaNomFic + aCarac;
           |FINSI;

           eaRuta = eaRuta + aCarac;
     |SIGUE;

     aAlfa    = eaNomFic % -104;
     eaNomFic = eaNomFic - aAlfa;

     aAlfa = eaParametro2 + "dsselect.txt";
     |RFBORRA aAlfa;
|FPRC;

|PROCESO FicheroEsImagen;
     ||Nos dice si el fichero es imagen o no (se basa en la extension).

     aExtension = eaNombreImagen;
     |QBF aExtension;
     aExtension = aExtension % -104;
     aExtension = aExtension > aExtension;
     |SI aExtension = ".JPG"; |O aExtension = ".TIF"; |O aExtension = "TIFF";
      |O aExtension = ".PNG"; |O aExtension = ".GIF"; |O aExtension = ".BMP";
          enSwEsImagen = 1;
     |SINO;
          enSwEsImagen = 0;
     |FINSI;
|FPRC;

|PROCESO FicheroEsPDF;
     ||Nos dice si el fichero es un PDF o no (se basa en la extension).

     aExtension = eaNombreImagen;
     |QBF aExtension;
     aExtension = aExtension % -104;
     aExtension = aExtension > aExtension;
     |SI aExtension = ".PDF";
          enSwEsImagen = 1;
     |SINO;
          enSwEsImagen = 0;
     |FINSI;
|FPRC;
