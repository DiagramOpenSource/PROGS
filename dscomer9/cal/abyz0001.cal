|FICHEROS;
     abyz0001 #0;
     abym0001 #1;
     abym0002 #2,MANTE;
     abym0003 #3;
     abyw0001 #10,MANTE; || Tmp
     agifa019 #19;
     agifa024 #24;
|FIN;

|VARIABLES;
     &Tempo = "";
     nForma = 0;
     nHay = 0;
     nMesSelec = 0;
     nMesIni = 0;
     nMes = 0;
     nInc = 0;
     i = 0;
     aTmp10 = "";
     aDia = "";
     aA쨚 = "";
     aMes = "";
     fFecha = @;
     aAlfa = "";
     aFecha = "";
     aEsFac = "";
     aEsVis = "";
     nExiste = 0;
     nConta = 0;
     nModo = 0;
|FIN;

|PROCESO PintaMes0; |TIPO 0;
     |HAZ PintaMes7;
|FPRC;

|PROCESO PintaMes7; |TIPO 7;
     |SI #0#4 = 0;
          fFecha = ~;
          #0#4 = (A\(fFecha % 402));
          #0#5 = (A\(fFecha % -104));
          |PINTA #0#4;
          |PINTA #0#5;
     |FINSI;

     aMes = "          ";
     |SI #0#4 = 1; aMes = "Enero     "; |FINSI;
     |SI #0#4 = 2; aMes = "Febrero   "; |FINSI;
     |SI #0#4 = 3; aMes = "Marzo     "; |FINSI;
     |SI #0#4 = 4; aMes = "Abril     "; |FINSI;
     |SI #0#4 = 5; aMes = "Mayo      "; |FINSI;
     |SI #0#4 = 6; aMes = "Junio     "; |FINSI;
     |SI #0#4 = 7; aMes = "Julio     "; |FINSI;
     |SI #0#4 = 8; aMes = "Agosto    "; |FINSI;
     |SI #0#4 = 9; aMes = "Septiembre"; |FINSI;
     |SI #0#4 = 10;aMes = "Octubre   "; |FINSI;
     |SI #0#4 = 11;aMes = "Noviembre "; |FINSI;
     |SI #0#4 = 12;aMes = "Diciembre "; |FINSI;
     |ATRI I; |PINTA 1533, aMes; |ATRI 0;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO CreaRevision;
     #2#0 = #1#0;
     #2#1 = #1#1;
     #2#2 = "R";
     #2#3 = 9999;
     |LEE 000#2];
     |SI FSalida = 0;
          |LEE 000#2a;
     |SINO;
          |LEE 000#2u;
     |FINSI;
     |SI FSalida = 0; |Y #2#0 = #1#0; |Y #2#1 = #1#1; |Y #2#2 = "R";
          nConta = #2#3 + 1;
     |SINO;
          nConta = 1;
     |FINSI;
     |DDEFECTO #2;
     #2#0 = #1#0;
     #2#1 = #1#1;
     #2#2 = "R";
     #2#3 = nConta;
     #2#4 = #1#4;
     #2#5 = aFecha;
     #2#6 = aEsVis;
     #2#7 = aEsFac;
     #2#10 = #1#13;
     |SI aEsVis = "S";
          #2#12 = #1#15;
     |FINSI;
     #2#19 = #2#5;  || Visita
     #2#20 = #1#5;
     #2#21 = #1#2;
     #2#22 = #1#3;
     #2#23 = #1#17;
     |GRABA 020#2n;
     |DDEFECTO #3;
     #3#0 = #2#0;
     #3#1 = #2#1;
     #3#2 = #2#2;
     #3#3 = #2#3;
     #3#4 = 1;
     #3#5 = #1#16;
     #3#6 = #19#1;
     |SI aEsFac = "S";
          #3#7 = 1;
          #3#8 = #1#13;
     |FINSI;
     #3#9 = #3#7 * #3#8;
     #3#11 = #2#7;
     #3#12 = #2#12;
     |GRABA 020#3n;
|FPRC;

|PROCESO ExisteRevision;
     |SELECT #2#2;
     #2#0 = #1#0;
     #2#1 = #1#1;
     #2#2 = "R";
     #2#5 = aFecha;
     |LEE 000#2=;
     nExiste = FSalida;
     |SELECT #1#2;
|FPRC;

|PROCESO Contratos;
     || cheq fecha alta
     aDia = #1#7 % 102;
     aMes = #1#7 % 402;
     aA쨚 = #1#7 % -104;
     |SI aA쨚 > #0#5; |ACABA; |FINSI;
     |SI aA쨚 = #0#5;
          |SI aMes > #0#4; |ACABA; |FINSI;
     |FINSI;

     || cheq fecha baja
     aFecha = #1#8;
     |SI aFecha = "01.01.0000"; aFecha = "31.12.9999"; |FINSI;
     aDia = aFecha % 102;
     aMes = aFecha % 402;
     aA쨚 = aFecha % -104;
     |SI aA쨚 < #0#5; |ACABA; |FINSI;
     |SI aA쨚 = #0#5;
          |SI aMes < #0#4; |ACABA; |FINSI;
     |FINSI;

     || cheq periodos
     nMesSelec = #0#4;
     nMesIni = #1#12;
     |SI nMesIni = 0; nMesIni = (A\(#1#7 % 402)); |FINSI;
     aEsFac = "N";
     nInc = 1;
     |SI #1#11 = "M"; nInc = 1; |FINSI;
     |SI #1#11 = "B"; nInc = 2; |FINSI;
     |SI #1#11 = "T"; nInc = 3; |FINSI;
     |SI #1#11 = "S"; nInc = 6; |FINSI;
     |SI #1#11 = "A"; nInc = 12; |FINSI;
     |PARA i = nMesIni; |SI; |HACIENDO i = i + nInc;
          nMes = i;
          |SI i > 12; nMes = i - 12; |FINSI;
          |SI nMes = nMesIni; |Y i ! nMesIni; |SAL; |FINSI;
          |SI nMes = nMesSelec;
               aEsFac = "S";
               |SAL;
          |FINSI;
     |SIGUE;
     aEsVis = "N";
     nInc = 1;
     |SI #1#14 = "M"; nInc = 1; |FINSI;
     |SI #1#14 = "B"; nInc = 2; |FINSI;
     |SI #1#14 = "T"; nInc = 3; |FINSI;
     |SI #1#14 = "S"; nInc = 6; |FINSI;
     |SI #1#14 = "A"; nInc = 12; |FINSI;
     |PARA i = nMesIni; |SI; |HACIENDO i = i + nInc;
          nMes = i;
          |SI i > 12; nMes = i - 12; |FINSI;
          |SI nMes = nMesIni; |Y i ! nMesIni; |SAL; |FINSI;
          |SI nMes = nMesSelec;
               aEsVis = "S";
               |SAL;
          |FINSI;
     |SIGUE;

     |SI aEsFac = "N"; |Y aEsVis = "N"; |ACABA; |FINSI;

     aFecha = "01." + (("00" + #0#4) % -102) + "." + (("0000" + #0#5) % -104);

     |DDEFECTO #24;
     #24#0 = #1#2;
     |LEE 000#24=;

     |DDEFECTO #19;
     #19#0 = #1#16;
     |LEE 000#19=;

     |HAZ ExisteRevision;
     |SI nExiste ! 0;    || si no existe
          |HAZ CreaRevision;
     |FINSI;

     || el tmp
     #10#0 = #2#0;
     #10#1 = #2#1;
     #10#2 = #2#2;
     #10#3 = #2#3;
     #10#4 = #2#4;
     #10#5 = #2#19;
     #10#6 = #2#6;
     #10#7 = #2#7;
     #10#8 = #2#18;
     #10#9 = #24#1;
     |GRABA 020#10n;
     nHay = 1;
|FPRC;

|DEFBUCLE Contratos;
     #1#1;
     6;
     #0#0, #0#2, "S";
     #0#1, #0#3, "S";
     ;
     NULL, Contratos;
|FIN;

|PROCESO Min10;
     #10#0 = "     ";
     #10#1 = 1;
     #10#2 = " ";
     #10#3 = 1;
|FPRC;

|PROCESO Max10;
     #10#0 = "zzzzz";
     #10#1 = 999999;
     #10#2 = "z";
     #10#3 = 9999;
|FPRC;

|PROCESO Tipo2; |TIPO 2;
     nModo = (FEntrada / 100) ! 0;
     nForma = 0 +. 1;
     |SI nModo = 1;
          |MENAV "0000Alta No permitida...";
          |ERROR; |ACABA;
     |FINSI;
     |SI nModo = 3;
          |ABRE #2;
          #2#0 = #10#0;
          #2#1 = #10#1;
          #2#2 = #10#2;
          #2#3 = #10#3;
          |LEE 121#2=;
          |SI FSalida = 0;
               |SI #2#18 = "P";
                    |BUCLELIN 1 NULL #2;
                    |BORRA 020#2a;
               |SINO;
                    aAlfa = "";
                    |SI #2#18 = "R"; aAlfa = "Revisado"; |FINSI;
                    |SI #2#18 = "V"; aAlfa = "Visado"; |FINSI;
                    |SI #2#18 = "F"; aAlfa = "Faturado"; |FINSI;
                    aAlfa = "0000Parte en estado ("+#2#18+") " + aAlfa;
                    |MENAV aAlfa;
                    |ERROR;
               |FINSI;
          |FINSI;
          |CIERRA #2;
     |FINSI;
     |SI nModo = 2; |Y nForma = 1;
          |ABRE #2;
          #2#0 = #10#0;
          #2#1 = #10#1;
          #2#2 = #10#2;
          #2#3 = #10#3;
          |LEE 121#2=;
          |SI FSalida = 0;
               |SI #2#18 = "P";
                    |PUSHV 0501 2380;
                    |PINPA #0#2;
                    |PINDA #0#2;
                    |ENDATOS #2#2;
                    |SI FSalida = 0;
                         |GRABA 020#2a;

                         |ABRE #24;
                         #24#0 = #2#4;
                         |LEE 000#24=;
                         |CIERRA #24;
                         #10#4 = #2#4;
                         #10#5 = #2#19;
                         #10#6 = #2#6;
                         #10#7 = #2#7;
                         #10#8 = #2#18;
                         #10#9 = #24#1;
                         |GRABA 020#10a;
                    |FINSI;
                    |POPV;
               |SINO;
                    aAlfa = "";
                    |SI #2#18 = "R"; aAlfa = "Revisado"; |FINSI;
                    |SI #2#18 = "V"; aAlfa = "Visado"; |FINSI;
                    |SI #2#18 = "F"; aAlfa = "Faturado"; |FINSI;
                    aAlfa = "0000Parte en estado ("+#2#18+") " + aAlfa;
                    |MENAV aAlfa;
                    |ERROR;
               |FINSI;
          |FINSI;
          |CIERRA #2;
     |FINSI;
|FPRC;

|PROCESO Tipo3; |TIPO 3;
     |HAZ CreaTempo; aTmp10 = Tempo;
     |NOME_DAT #10 aTmp10; |DELINDEX #10;

     |ABRE #1;
     |ABRE #2;
     |ABRE #3;
     |ABRE #10;
     |ABRE #24;
     |ABRE #19;
     |BUCLE Contratos;
     |CIERRA #19;
     |CIERRA #24;
     |CIERRA #10;
     |CIERRA #2;
     |CIERRA #3;
     |CIERRA #1;
     |SI nHay = 0;
          |MENAV "0000Seleccion Vacia...";
     |SINO;
          |ENTLINEAL #1#10, 1, 2, 22, 1, Min10, Max10;
     |FINSI;

     |DELINDEX #10; Tempo = aTmp10; |HAZ BoraTempo;
|FPRC;
