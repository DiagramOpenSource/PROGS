|FICHEROS;
     coima006 #0;
     agifa104 #104;
     coima006@;

     coima001 #1;        ||Parametros COIMASA
|FIN;

|VARIABLES;
     &enPrioAntes = 0;
     &enPrioAhora = 0;
     &eaSerPed = "";
     &enNumPed = 0;
     &enModoCoimasa = 0;

     &eaSerie = "";
     &enDocu = 0;
     &eaCliente = "";
     aAlfa = "";

     &enPrioridadBajaPed = 0;
|FIN;

|PROCESO Pedidos;
     |SI #104#25 ! eaSerie; |O #104#0 ! enDocu;
          |SI #104#46 ! 0;
               |DDEFECTO #coima006@;
               #coima006@#0 = #104#25;
               #coima006@#1 = #104#0;
               |LEE 101#coima006@.=;
               |SI FSalida ! 0; |GRABA 020#coima006@.b; |FINSI;
               enPrioAntes = #coima006@#2;
               enPrioAhora = #0#2;
               #coima006@#2 = #0#2;
               |GRABA 020#coima006@.a;
               |LIBERA #coima006@;

               |SI enPrioAntes ! enPrioAhora;
                    |SI enPrioAntes [ #coima001#27;
                         |SI enPrioAhora > #coima001#27;
                              eaSerPed = #104#25;
                              enNumPed = #104#0;
                              enModoCoimasa = 6;       ||Resta
                              |HAZ CambioPrioReservaPed;
                         |FINSI;
                    |SINO;
                         |SI enPrioAhora [ #coima001#27;
                              eaSerPed = #104#25;
                              enNumPed = #104#0;
                              enModoCoimasa = 5;       ||Suma
                              |HAZ CambioPrioReservaPed;
                         |FINSI;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE Pedidos;
     #104#2;
     ;
     eaCliente, "     ", 000001;
     eaCliente, "zzzzz", 999999;
     ;
     NULL, Pedidos;
|FIN;

|PROCESO CamPrio; |TIPO 0;
     |SI #0Campo ! Contenido;
          ||ARA39
          enPrioAntes = Contenido;
          enPrioAhora = #coima006#2;
          |SI enPrioAntes [ #coima001#27;
               |SI enPrioAhora > #coima001#27;
                    eaSerPed = #coima006#0;
                    enNumPed = #coima006#1;
                    enModoCoimasa = 6;       ||Resta
                    |HAZ CambioPrioReservaPed;
               |FINSI;
          |SINO;
               |SI enPrioAhora [ #coima001#27;
                    eaSerPed = #coima006#0;
                    enNumPed = #coima006#1;
                    enModoCoimasa = 5;       ||Suma
                    |HAZ CambioPrioReservaPed;
               |FINSI;
          |FINSI;
          |CONFI "0000NModificar prioridad en resto pedidos del cliente?";
          |SI FSalida = 0;
               |DDEF aAlfa;
               aAlfa = aAlfa + "coima006";
               |CARGA_DEF aAlfa, coima006@;
               |SI FSalida = 0;
                    |ABRE #coima006@;
                    |BUCLE Pedidos;
                    |CIERRA #coima006@;
                    |DESCARGA_DEF #coima006@;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Na; |TIPO 12;

|FPRC;

|PROGRAMA;
     |ABRE #coima001;
     |DDEFECTO #coima001;
     |LEE 000#coima001.=;
     |CIERRA #coima001;

     |ABRE #0;
     #0#0 = eaSerie;
     #0#1 = enDocu;
     |SI PARAMETRO = "BAJA";
          enPrioridadBajaPed = #0#2;
          |BORRA 000#0c;
     |SINO;
          |LEE 101#0=;
          |SI FSalida ! 0; |GRABA 020#0b; |FINSI;
          |PINDA #0#0;
          |ENDATOS #1#0;
          |SI FSalida = 0; |GRABA 020#0a; |FINSI;
     |FINSI;
     |CIERRA #0;
|FPRO;
