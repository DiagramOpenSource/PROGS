|FICHEROS;
     sctrz088 #0;
     sctrm036 #36;
     sctrm052 #52;
     sctrm053 #53;
     sctrm054 #54;  || Fac C
     sctrm055 #55;  || Fac L
     sctrm056 #56;
     sctrm058 #58;
     sctrm066 #66;
     sctrm001 #100;
|FIN;

|VARIABLES;
     &eaConMensa = "S";
     &enError = 0;
     &enTiva = 0;
     &efFiva = @;
     &enIva = 0;
     aTipo = "";
     nForma = 0;
     aAlfa = "";
     aPais = "";
|FIN;

|PROCESO Saca_IVA;
     aAlfa = aPais; |QBF aPais;
     |SI aAlfa = "";
          |HAZ SacaIVA;
     |SINO;
          enIva = 0;
          |ABRE #66;
          #66#5 = aPais; aPais = #66#5;
          #66#0 = enTiva
          #66#4 = "01.01.0000";
          |LEE 000#66];
          |PARA; |SI FSalida = 0; |Y #66#5 = aPais; |Y #66#0 = enTiva; |HACIENDO;
               |SI efFiva ] #66#4;
                    enIva = #66#2;
               |FINSI;
               |LEE 000#66s;
          |SIGUE;
          |CIERRA #66;
     |FINSI;
|FPRC;

|PROCESO ActLin;
     |ABRE #36;
     #36#1 = #55#14;
     |LEE 000#36=;
     |SI FSalida ! 0; |DDEFECTO #36; |FINSI;
     |CIERRA #36;

     |SI aTipo = "V";

     |SINO;
          |ABRE #52;
          |ABRE #53;
          #52#0 = #55#3;
          |LEE 121#52=;
          |SI FSalida = 0;
               #53#0 = #52#0;
               #53#1 = 0;
               |LEE 000#53];
               |SI FSalida ! 0; |O #53#0 ! #52#0; |DDEFECTO #53; |FINSI;

               #55#4 = #52#75;
               #55#6 = #52#45;
               #55#7 = #53#3;
               #55#8 = #52#20;
               #55#10 = #52#19;
               ||#55#11 =
               |SI #55#20 = 1;
                    #55#9 = #52#1;
                    #55#12 = #52#108;
                    #55#13 = #52#32 - #52#108;
               |SINO;
                    #55#9 = #52#64;
                    |SI #52#112 ! "C";
                         #55#12 = 0;
                    |SINO;
                         #55#12 = #52#108;
                    |FINSI;
                    #55#13 = -(#52#72 - #55#12);
                    #55#12 = -#55#12;
               |FINSI;
               #55#14 = #55#13 *  #52#55 / 100;
               |SI #52#38 = "R"; |Y #36#72 = "N";
                    #55#12 = 0;
                    #55#13 = 0;
               |FINSI;
               #55#17 = #52#8;
               #55#18 = #52#12;

               enTiva = #100#26;
               efFiva = #54#2;
               aPais = #54#25;
               |HAZ Saca_IVA;
               |SI #36#45 = "N";
                    enTiva = 0;
                    #55#19 = 0;
               |SINO;
                    #55#19 = enIva;
               |FINSI;

               #55#16 = #55#14 * #55#19 / 100;
               #55#15 = #55#13 - #55#14 - #55#16 + #55#12;

               |SI nForma = 1;

               |SINO;
                    |SI #55#20 = 1;
                         #52#83 = "N";
                         #52#84 = "";
                         #52#85 = 0;
                    |SINO;
                         #52#89 = "N";
                         #52#90 = "";
                         #52#91 = 0;
                    |FINSI;
               |FINSI;
               |GRABA 020#52a;
          |FINSI;
          |CIERRA #53;
          |CIERRA #52;
     |FINSI;
|FPRC;

|PROCESO Borra56;
     |BORRA 020#56a;
|FPRC;

|DEFBUCLE Borra56;
     #56#1;
     ;
     #54#0, #54#1, 0000;
     #54#0, #54#1, 9999;
     be;
     NULL, Borra56;
|FIN;

|PROCESO Borra58;
     |BORRA 020#58a;
     aTipo = #54#13; nForma = -1; |HAZ ActLin;
|FPRC;

|DEFBUCLE Borra58;
     #58#1;
     ;
     #54#0, #54#1, 0000;
     #54#0, #54#1, 9999;
     be;
     NULL, Borra58;
|FIN;

|PROCESO Borra55;
     |BORRA 020#55a;
     aTipo = #54#13; nForma = -1; |HAZ ActLin;
|FPRC;

|DEFBUCLE Borra55;
     #55#1;
     ;
     #54#0, #54#1, 0000;
     #54#0, #54#1, 9999;
     be;
     NULL, Borra55;
|FIN;

|PROCESO Facturas;
     |HAZ ChequeaReci;
     |SI enError = 0;
          |HAZ BorraReci;
          |BORRA 020#54a;
          |ABRE #52;
          |BUCLE Borra55;
          |CIERRA #52;
          |BUCLE Borra58;
          |BUCLE Borra56;
     |SINO;
          aAlfa = "00000Recibo/s con movimiento/s:" + #54#0; |QBF aAlfa;
          aAlfa = aAlfa + "/" + (("000000" + #54#0) % -106);
          |MENAV aAlfa;
     |FINSI;
|FPRC;

|DEFBUCLE Facturas;
     #54#1;
     3, 2;
     #0#0, #0#1, #0#2, #0#3;
     #0#4, #0#5, #0#6, #0#7;
     be;
     NULL, Facturas;
|FIN;

|PROCESO T3; |TIPO 3;
     |ABRE #100; |LEE 000#100p; |CIERRA #100;
     |BUCLE Facturas;
|FPRC;
