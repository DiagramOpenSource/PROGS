|FICHEROS;
     iberz024 #0;
     agifa065 #65;
     dsm00120 #120;
     dsm00121 #121;
     agifa019 #19;
     dsm00241 #241;
     agifa321;
     agifa324;
     agifa077 #77;
     agifa017 #17;
     agifa080 #80;
|FIN;

|CAMPOS;
     #19#15  art_pser;  #17#42  alm_pser;
     #19#182 art_pser2; #17#44  alm_pser2;
     #19#16  art_prec;  #17#43  alm_prec;
     #19#183 art_prec2; #17#45  alm_prec2;
     #19#17  art_pval;  #17#4   alm_pval;
     #19#11  art_nece;  #17#50  alm_nece;
     #19#12  art_rese;  #17#8   alm_rese;
     #19#14  art_depo;  #17#10  alm_depo;
     #19#184 art_depo2; #17#46  alm_depo2;
     #19#13  art_fabr;  #17#9   alm_fabr;
     #19#10  art_vsto;  #17#3   alm_vsto;
     #19#7   art_mini;  #17#6   alm_mini;
     #19#8   art_maxi;  #17#7   alm_maxi;
     #19#6   art_tota;  #17#5   alm_tota;
     #19#185 art_tota2; #17#47  alm_tota2;
     #19#104 art_disp;  #17#39  alm_disp;
     #19#193 art_disp2;  #17#48 alm_disp2;
     #19#9   art_pcm;
|FIN;

|VARIABLES;
     nValor = 0;
     ||컴컴컴컴컴컴컴컴컴횵VAS
     &nDeci_IVADiv  = 0;
     &nDeci_IVAImp  = 0;
     &nDeci_IVA     = 0;
     ||컴컴컴컴컴컴컴컴컴훆tos
     &nDeci_Vto= 0;
     ||컴컴컴컴컴컴컴컴컴횯ivision Vertical
     &nDeci_TBas = 0;
     &nDeci_TDiv = 0;
     &nDeci_PBas = 0;
     &nDeci_PDiv = 0;
     &nDeci_VTot = 0;
     ||컴컴컴컴컴컴컴컴컴
     &aDivisa  = "";
     &aMoneda  = "";
     &nFactor  = 0;
     nDivi     = 0;
     nBase     = 0;
     ||컴컴컴컴컴컴컴컴컴
     &decim_divisa = 0;     || Decimales de la divisa
     &precio_divisa = 0;    || Decimales del precio en divisa
     &decim_base = 0;       || Decimales de la moneda base
     &precio_base = 0;      || Decimales del precio en moneda base
     ||컴컴컴컴컴컴컴컴컴훍gifa134
     &nDeci_Base     = 0;   || Decimales en Totales de la moneda base
     &nDeci_PreBase  = 0;   || Decimales en el Precio en moneda base
     &nDeci_BaseMx   = 0;   || Decimales en Totales de la moneda base
     &nDeci_PreBaseMx= 0;   || Decimales en el Precio en moneda base
     &nDeci_DivF     = 0;   || Decimales en Totales de la divisa
     &nDeci_PreDivF  = 0;   || Decimales en el Precio en divisa
     &nDeci_TotVisF  = 0;   || Decimales en Totales visibles (el de la moneda de trabajo)
     &nDeci_TotNoVisF= 0;  || Decimales en Totales no visibles (el de la otra moneda)
     &nDeci_PreVisF  = 0;   || Decimales en el Precio visual. (lineas)
     &nDeci_ImpVisF  = 0;   || Decimales en el Importe visual. (lineas)
     &nDeci_BaseMxP  = 0;   || Decimales en Totales de la moneda base (Maxima precision)
     &nDeci_PreBasMxP= 0;   || Decimales en el Precio en moneda base (Maxima precision)
     &nDeci_DivP     = 0;   || Decimales en Totales de la divisa
     &nDeci_PreDivP  = 0;   || Decimales en el Precio en divisa
     &nDeci_TotVisP  = 0;   || Decimales en Totales visibles (el de la moneda de trabajo)
     &nDeci_TotNoVisP = 0;  || Decimales en Totales no visibles (el de la otra moneda)
     &nDeci_PreVisP  = 0;   || Decimales en el Precio visual. (lineas)
     &nDeci_ImpVisP  = 0;   || Decimales en el Importe visual. (lineas)
     &nDeci_BaseMxD   = 0;   || Decimales en Totales de la moneda base (Maxima precision)
     &nDeci_PreBasMxD = 0;   || Decimales en el Precio en moneda base (Maxima precision)
     &nDeci_DivD      = 0;   || Decimales en Totales de la divisa
     &nDeci_PreDivD   = 0;   || Decimales en el Precio en divisa
     &nDeci_TotVisD   = 0;   || Decimales en Totales visibles (el de la moneda de trabajo)
     &nDeci_TotNoVisD = 0;   || Decimales en Totales no visibles (el de la otra moneda)
     &nDeci_PreVisD   = 0;   || Decimales en el Precio visual. (lineas)
     &nDeci_ImpVisD   = 0;   || Decimales en el Importe visual. (lineas)
     &nDeci_Div      = 0;   || Decimales en Totales de la divisa
     &nDeci_PreDiv   = 0;   || Decimales en el Precio en divisa
     &nDeci_TotVis   = 0;   || Decimales en Totales visibles (el de la moneda de trabajo)
     &nDeci_TotNoVis = 0;   || Decimales en Totales no visibles (el de la otra moneda)
     &nDeci_PreVis   = 0;   || Decimales en el Precio visual. (lineas)
     &nDeci_ImpVis   = 0;   || Decimales en el Importe visual. (lineas)
|FINSI;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO MonedaBase; ||Lee los parametros de la moneda base
     |ABRE #agifa321;
     |LEE 010#agifa321.p;
     |CIERRA #agifa321;

     #agifa324#0 = #agifa321#9;
     |LEE 010#agifa324.=;
     decim_base = #agifa324#7;
     precio_base = #agifa324#9;
|FPRC;

|PROCESO LeeDivisas;
     |ABRE #agifa324;
     |HAZ MonedaBase;
     #agifa324#0 = aDivisa;
     |LEE 020#agifa324.=;
     |CIERRA #agifa324;
     decim_divisa = #agifa324#7;
     precio_divisa = #agifa324#9;
|FPRC

|PROCESO Deci_IVA;
     |ABRE #agifa321; |LEE 000#agifa321.p; |CIERRA #agifa321;

     nDeci_IVA = #agifa321#12 + nDeci_BaseMx;
     nDeci_IVADiv = #agifa321#12 + nDeci_Div;
     nDeci_IVAImp = #agifa321#12 + nDeci_ImpVis;
|FPRC;

|PROCESO Divisas084;
     |HAZ LeeDivisas;

     nDeci_Div = decim_divisa;   || Decimales de la divisa
     nDeci_PreDiv = precio_divisa;  || Decimales en el precio de la divisa
     |SI aMoneda = "B";   || Si trabajo con la moneda base ...
          nDeci_PreVis   = precio_divisa;
          nDeci_ImpVis   = decim_divisa;
          nDeci_Base     = decim_base;
          nDeci_PreBase  = precio_base;
          nDeci_BaseMx  = decim_base;
          nDeci_PreBaseMx = precio_base;
          nDeci_TotVis   = decim_base;
          nDeci_TotNoVis = decim_divisa;
     |SINO;     || Si trabajo con la divisa ...
          nDeci_PreVis   = precio_base;
          nDeci_ImpVis   = decim_base;
          nDeci_Base     = decim_base; || Max. precision en los decimales de la moneda base
          nDeci_PreBase  = precio_base;  || Max. precision en los dec. del precio de la moneda base
          nDeci_BaseMx    = #agifa321#10;  || Max. precision en los decimales de la moneda base
          nDeci_PreBaseMx = #agifa321#11;  || Max. precision en los dec. del precio de la moneda base
          nDeci_TotVis   = decim_divisa;
          nDeci_TotNoVis = decim_base;

          nDeci_BaseMx    = decim_divisa;  ||OJO
     |FINSI;
     nDeci_TBas = nDeci_Base;
     nDeci_TDiv = nDeci_Div;
     nDeci_PBas = nDeci_PreBase;
     nDeci_PDiv = nDeci_PreDiv;

     |HAZ Deci_IVA;
|FPRC;

컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO Factor;
     #241#0 = #19#5;
     #241#2 = #80#43;
     |LEE 000#241=;
     |SI #241#6 = "D";
          nFactor = 1 / #241#5;
     |SINO;
          nFactor = 1 * #241#5;
     |FINSI;
|FPRC;

|PROCESO agifa017;
     nValor = alm_tota - alm_pval;
     |SI nValor > 0;
          alm_vsto = nValor * art_pcm;
     |SINO;
          alm_vsto = 0;
     |FINSI;
     alm_nece = alm_pser + alm_mini - alm_prec - alm_disp;
     alm_nece = alm_nece - alm_pval - alm_fabr - alm_rese;
     |SI alm_nece < 0; alm_nece = 0; |FINSI;
     |GRABA 020#17a;
     |LIBERA #17;
|FPRC;

|DEFBUCLE agifa017;
     #17#1;
     ;
     #19#0, 00001;
     #19#0, 99999;
     be;
     NULL, agifa017;
|FIN;

|PROCESO agifa065;
     #77#50 = #65#11;
     #77#0 = #65#3;
     |LEE 000#77=;

     #80#27 = #65#11;
     #80#0 = #65#3;
     #80#1 = #65#4;
     |LEE 000#80=;


     aDivisa = #77#56;
     aMoneda = #77#58;
     |HAZ Divisas084;

     |DDEFECTO #19;
     #19#0 = #121#1;
     |LEE 101#19=;
     |SI FSalida ! 0; |GRABA 020#19b; |FINSI;

     |HAZ Factor;

     #19#27 = #65#10;
     #19#29 = #65#12;
     #19#129 = #65#13;
     #19#209 = #65#21;
     #19#26 = #65#1;

     #19#28 = #65#9 * nFactor;
     #19#163 = #65#9 * nFactor;

     #19#133 = #65#14 * nFactor;
     #19#164 = #65#14 * nFactor;

     #19#9 = #65#14 * nFactor;

     nValor = art_tota - art_pval;
     |SI nValor > 0;
          art_vsto = nValor * art_pcm;
     |SINO;
          art_vsto = 0;
     |FINSI;

     |BUCLE agifa017;
     |GRABA 020#19a;
     |LIBERA #19;

     #121#8 = #19#9;
     |GRABA 020#121a;
     |LIBERA #121;


     |ERROR10;
|FPRC;

|DEFBUCLE agifa065;
     #65#2;
     ;
     #121#1, "31.12.9999", "AC", 000001, 00001, "      ";
     #121#1, "01.01.0000", "AC", 999999, 99999, "zzzzzz";
     ;
     NULL, agifa065;
|FIN;

|PROCESO dsm00121;
     |BUCLE agifa065;
|FPRC;

|PROCESO Tipo3; |TIPO 3;
     |SI #0#1 ! "SI";
          |ACABA;
     |FINSI;

     |ABRE #80;
     |ABRE #77;
     |ABRE #241; |SELECT #2#241;
     |ABRE #19;
     |ABRE #65;
     |ABRE #120;
     #120#0 = #0#0;
     |LEE 000#120=;
     |SI FSalida = 0;
          |BUCLELIN 0 dsm00121 #120;
     |SINO;
          |MENAV "0000No existe inventario...";
     |FINSI;
     |CIERRA #120;
     |CIERRA #65;
     |CIERRA #19;
     |CIERRA #241;
     |CIERRA #77;
     |CIERRA #80;
|FPRC;
