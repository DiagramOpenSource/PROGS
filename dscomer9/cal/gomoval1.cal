|FICHEROS;
     dsm00054 #54;
     dsm00055 #55;
     agifa017 #17;
     agifa019 #19;
     dsm00024 #24;
     agifa027 #27;
     goparame #100;
|FIN;
--------------------------------------------------------------------------------
|VARIABLES;
     &nDeci_PreBase = 0;
     &nDeci_PreBaseMx = 0;

     &xDocTras      = 0;
     &xSerie        = "";
     &xFecDocu      = @;
     &xLinDocu      = 0;
     &xCodArti      = "";
     &xDesArti      = "";
     &xCanArti      = 0;
     &xAlmEntr      = 0;
     &xAlmSali      = 0;
     &xForma        = 0;
     &xCanArti2 = 0;
     &xMedida1 = 0;
     &xMedida2 = 0;
     &xMedida3 = 0;
     &xPartida = "";
|FIN;
--------------------------------------------------------------------------------
|INCLUYE i_varart;
--------------------------------------------------------------------------------
|PROCESO ContMovi;
     |ABRE #27;
     #27#2 = xSerie;
     #27#0 = "movcenal";
     |LEE 000#27=;
     |SI FSalida = 0;
          xDocTras = #27#1;
          |SI xDocTras < 500000;
               xDocTras = 500000;
          |FINSI;
          #27#1 = xDocTras + 1;
          |GRABA 020#27a;
     |SINO;
          xDocTras = 500001;
          #27#1 = 500002;
          |GRABA 020#27c;
     |FINSI;
     |CIERRA #27;
|FPRC;

|PROCESO UltimaLin;
     #55#28 = xSerie;
     #55#27 = xDocTras;
     #55#11 = 999;
     |LEE 000#55];
     |SI FSalida = 0;
          |LEE 000#55a;
     |SINO;
          |LEE 000#55u;
     |FINSI;
     |SI FSalida = 0; |Y #55#28 = xSerie; |Y #55#27 = xDocTras;
          xLinDocu = #55#11 + 1;
     |SINO;
          xLinDocu = 1;
     |FINSI;
|FPRC;
-------------------------------------------------------------------------------
|PROCESO StockArt;
     |ABRE #17;
     |DDEFECTO #17;
     #17#0 = #55#0;                              ||Cod.Artículo.
     #17#1 = #55#1;                              ||Almacen Salida.
     |LEE 000#17=;

     #55#12 = #17#47;                       ||Stock Salida 2.
     #55#3  = #17#5;                        ||Stoxk Salida.

     |DDEFECTO #17;
     #17#0 = #55#0;                              ||Cod.Artículo.
     #17#1 = #55#5;                              ||Almacen Entrada.
     |LEE 000#17=;

     #55#13 = #17#47;                       ||Stock Salida 2.
     #55#6  = #17#5;                        ||Stock Entrada.
     |CIERRA #17;

     |ABRE #19;
     |DDEFECTO #19;
     #19#0 = #55#0;                              ||Cod. Artículo.
     |LEE 000#19=;

     #55#14 = #19#185;                      ||Stock Articulo 2.
     #55#7  = #19#6;                        ||Stock Articulo.
     |CIERRA #19;

     |ABRE #24;
     |DDEFECTO #24;
     #24#0 = #55#0;                              ||Articulo;
     #24#1 = #55#1;                              ||Almacen Salida.
     #24#2 = #55#16;                             ||Partida Salida.
     |LEE 000#24=;

     #55#19 = #24#23;                       ||Stock 1 Partida Salida.
     #55#20 = #24#22;                       ||Stock 2 Partida Salida.

     |DDEFECTO #24;
     #24#0 = #55#0;                              ||Articulo;
     #24#1 = #55#5;                              ||Almacen Entrada.
     #24#2 = #55#17;                             ||Partida Entrada.
     |LEE 000#24=;

     #55#21 = #24#23;                       ||Stock 1 Partida Entrada.
     #55#22 = #24#22;                       ||Stock 2 Partida Entrada.
     |CIERRA #24;
|FPRC;
-------------------------------------------------------------------------------
|PROGRAMA;
     |HAZ DecimalesBase;
     nDeci_PreBaseMx = nDeci_PreBase;

     |SI xDocTras = 0; |HAZ ContMovi; |FINSI;

     |ABRE #54;
     |DDEFECTO #54;
     #54#2 = xSerie;
     #54#0 = xDocTras;
     |LEE 101#54=;
     |SI FSalida ! 0;
          #54#1 = xFecDocu;
          |GRABA 020#54n;
     |FINSI;
     |CIERRA #54;

     |ABRE #55;
     |SI xLinDocu = 0; |HAZ UltimaLin; |FINSI;
     |DDEFECTO #55;
     #55#28 = xSerie;
     #55#27 = xDocTras;
     #55#11 = xLinDocu;
     |LEE 101#55=;
     |SI FSalida ! 0; |GRABA 020#55b; |FINSI;

     #55#1  = xAlmSali;
     #55#0  = xCodArti;                               ||Codigo Articulo.
     #55#2  = xDesArti;                               ||Descripcion Articulo.
     #55#4  = xCanArti;                              ||Cantidad Salida.
     #55#5  = xAlmEntr;                              ||Cod. Almacen Entrada.
     #55#8  = xFecDocu;                               ||Fecha de movimientos.
     |QBF xPartida;
     |SI xPartida = "";
          ||#55#16 = "000000000000001";                  ||Partida Salida.
          ||#55#17 = "000000000000001";                  ||Partida Entrada.
     |SINO;
          #55#16 = xPartida;
          #55#17 = xPartida;
     |FINSI;
     #55#15 = xCanArti2;
     #55#24 = xMedida1;
     #55#25 = xMedida2;
     #55#26 = xMedida3;
     |HAZ StockArt;

     enCodigo = xDocTras;                            ||Doc. Transpaso.
     enForma = xForma;
     |HAZ AcumulaME_MS;

     |SI enForma = 1;
          |GRABA 020#55a;
     |SINO;
          |BORRA 020#55a;
     |FINSI;

     |CIERRA #55;
|FPROG;
