||por00001  #portatil-Consulta Cliente

|FICHEROS;
     por00001 #0;         || Consulta Cliente
     por00002 #2,MANTE;   || temporal de busqueda de clientes
     por00003 #3,MANTE;   || consulta articulos
     por00004 #4,MANTE;   || temporal articulos, cuando se pulsa a¤adir
     por00005 #5,MANTE;   || temporal para pedir las unidades al a¤adir el articulo
     marhup07 #7;         || grupos de descuento
     marhup08 #8;         || configuracion articulo-grupo descuento
     marhup09 #9;         || maximo descuento por cliente
     por00010 #10,MANTE;  || temporal que pide la clave cuando se pone dto max
     agifa060 #11;        || familia
     por00012 #12;        || temporar de lineas de articulo pendientes
     agi00063 #13;        || marca
     agifa023 #14;        || precio cliente/articulo
     por00016 #16,MANTE;  || filtro articulos
     porconrp #17;        || cabecera control representante
     por00020 #19,MANTE;  || pantalla mas datos articulo
     por00021 #21,MANTE;  || configuracion reloj, articulos automaticos
     por00022 #22;        || filtro de articulos
     agifa025 #23;        || representantes
     agifa024 #24;        || clientes
     por00025 #25;        || busquedas en memoria
     agifa104 #26;        || cabecera de pedidos
     agifa073 #27;        || lineas de pedidos
     dsm00237 #30;        || precio coste proveeder-articulo
     agifa017 #31;        || articulo almacen
     porm0003 #33;        || clientes nuevos
     agifa071 #43;        || albaran L
     marhu361 #44;        || Ofertas Clientes
     agifa146 #46;        || cabecera de proformas para presupuesto
     agifa147 #47;        || lineas de proformas para presupuesto
     marhu362 #55;        || Tarifa Articulo (CAB)
     marhu363 #56;        || Tarifa Articulo (LIN)
     agifa553 #100;       || lineas
     agifa120 #120;       || subfamilia
     por00024 #124,MANTE; || aux. para introduccion pedidos usando cod. Barras
     agifa129 #129,MANTE; || tablas descuento-comision
     agifa019 #225;       || articulos, para sacar el valor de venta-min #25#198
     dsm00239;            || tipos de embalaje
     agifa321 #321;       || configuracion divisa
     agifa324 #324;       || divisas
     agifa023@;           || Precio Art./Clientes
     marhu363@;           || Tarifa Articulo (L)
|FIN;

|VARIABLES;
     &Tempo = "";
     aTmp22 = "";
     aTmp12 = "";
     aTmp4 = "";
     aTmp2 = "";

     &enDescuento1 = 0;
     &eaSerie = "";
     &efFecha = @;
     &eaCliente    = "";
     &eaRepre      = "";
     &eaArticulo   = "";
     &enComision   = 0;
     &enUniMarhu= 0;
     nSwContinua = 0;
     nTipoTarifa = 0;
     nSwOferta = 0;
     nSwFolleto = 0;
     nSwCliArt = 0;
     nFecha1 = 0;
     nFecha = 0;
     nDias = 0;
     &EURODB = 0;
     aAlf1 = "";
     aAlf2 = "";
     aSerPed = "";
     nNumPed = 0;
     nSwEsCentral = 0;
     nSalEntLin = 0;
     &enPreNor = 0;
     &enPreOfe = 0;
     &enSwMenu = 0;
     aDef  = "";
     aArt  = "";
     aCodOfe= "";
 {-1}FMemo = "";
 ||  FMemo1 = "agifa019"; || fichero origen o blanco
     FMemo1 = "por00025"; || fichero origen o blanco Si es el mismo los campos no cuentan
     FMemo2 = "por00025"; || este no puede estar en blanco
     FMemo3 = "0";        || Extra registros para inserciones (necesario si origen en blanco)
     FMemo4 = "0";        || Campos (no necesario si no hay fichero origen)
     FMemo5 = "1";
     FMemo6 = "2";
     FMemo7 = "3";
     FMemo8 = "6";
     FMemo9 = "9";
     FMemo10 = "27";
     FMemo11 = "125";
     FMemo12 = "126";
     FMemo13 = "128";
     FMemo14 = "134";
     FMemo15 = "199";
     FMemo16 = "200";
     FMemo17 = "18";
     FMemo18 = "30";
     FMemo19 = "198";
     FMemo20 = "0";
 {-1}FM1emo = "";
     FM1emo1 = "";         || fichero origen o blanco Si es el mismo los campos no cuentan
     FM1emo2 = "por00022"; || este no puede estar en blanco
     FM1emo3 = "50000";    || Extra registros para inserciones (necesario si origen en blanco)
     FM1emo4 = "0";        || Campos (no necesario si no hay fichero origen)
 {-1}FM2emo = "";
     FM2emo1 = "por00025"; || fichero a copiar campos (los campos iguales)
     FM2emo2 = "16";       || campo destino
     FM2emo3 = "13";       || campo origen
     FM2emo4 = "0";

     nCodCli = "";
     nCodArt = "";
     &aArtSelect = "";
     &aArtDefecto = "";
     &nSwOfer     = 0;
     aRepr = "";
     nCpmv = 0;
     nRcoe = 0;
     aRSeA = "";
     aRSeB = "";
     aRruI = "";
     nRnar = 0;
     nRtip = 0;

     aLinea="";
     nHandle=0;
     aEjecutableImagenes = "c:\ds\bin\dsImg.exe";
     aFicheroArticulos   = "c:\ds\tmp\articulos.txt";
     aFicheroArtElegido  = "c:\ds\tmp\selec.txt";
     aComando9Imagenes   = "";

     &nTipoRepresentante=0;

     aInfArt1 = "por00001";
     aInfArt2 = "por20001";
     &aCodigoFoto="";    || para el informe

     aClienteAntiguo = "";
     nEsPedidoAux=0;
     aNombreAux="";
     aCodigoAux="";
     aPoblacionAux = "";
     swPara = 0;
     &nRedondeoPu    = 0;
     aEstadoBoton    = "";
     aEstadoBotonP   = "";
     aEstadoBotonPed = "";
     aEstadoBotonSub = "";
     aTecla = "";
     nTecla = 0;

     aMensajeFaltaCliente="0000Tienes que seleccionar un Cliente!";
     aMensajeFaltaArticulo="0000Tienes que seleccionar un Articulo!";

     &nEsPedido=0;
     &nHojas=0;
     aAlfa  = "";
     bAlfa  = "";
     cAlfa  = "";
     aSw    = "";
     &ser_ped="";
     &num_ped=0;

     &nDescuento = 0;
     &nLugar=0;
     nNume2=0;
     nInicio=0;
     nFinal=0;
     nreg=0;
     nNuFi=0;
     &aAutonomo="";
     nOpmv=0;
     nOpre = 0;
     nExiste=0;
     &aClienteSuper = "";
     nImagen=0;
     aParametro="";

     {-1}aDato="";
     aDato1="2400";
     aDato2="1";
     aDato3="";
     aDato4="IP";
     aDato5="     Informe     ";
     aDato6="      Pedido     ";

     aCad0 = "";
     aCad1 = "";
     aCad2 = "";
     aCad3 = "";
     aCad4 = "";
     aCad5 = "";
     aCad6 = "";

     nSeguir=0;

     nUltimo=0;
     nUnidades;

     aSerie="";
     nNumeroPedido=0;
     nNumeroPresupuesto=0;
     nIva=0;

     nTotalBruto=0;
     nTotalFactura=0;
     nImporteTotal=0;   || para saber el importe total del pedido
     nCambio=0;

     nCambioBase=0;
     &nAuxI=0;
     nAux=0;
     nComision=0;
     &nMaxDto=0;
     &nLineaMaxDto=0;
     &nLineaMaxDtoC=0;
     nMaxComision=0;
     &aLetras1="";
     &aLetras2="";
     aHora="";
     nSegundos=0;
     aArrayLetras="ABCDEFGHIJKLMOPQRSTUVWXYZABCD";  || 30 letras

     nCodigoSecreto=0;
     nClaveSecreta=0;

     fFecha=@;
     fFecha1=@;
     nDia=0;
     nMes=0;
     nAnyo=0;
     nHora=0;
     nMinuto=0;
     nSegundo=0;
     nSal  = 0;
     PedidMod = 0;
     SerieMod = "";
     fDesdeFecha=@;
     fHastaFecha=@;

     aDAr1 = "";
     aHAr1 = "";

     aDesdeArticulo="";
     aHastaArticulo="";
     aDescripArticulo1="";
     aDescripArticulo2="";
     aDescripArticulo3="";
     aSignoPrecio="";
     nPrecio=0;
     nYMenorPrecio=0;
     aSignoStock="";
     aCodigoBarras="";
     aLineaDesde="";
     aLineaHasta="";
     aFamiliaDesde="";
     aFamiliaHasta="";
     aSubFamiliaDesde="";
     aSubFamiliaHasta="";
     nCoste=0;
     nYMenorCoste=0;
     aNovedad="";
     aHabitual="";
     aOferta="";
     aOfeOfe = "";
     aOfeFol = "";
     aOfeCli = ""
     aDCodBarras="";
     aHCodBarras="";
     nDStock=0;
     nHStock=0;

     nDPrecio=0;
     nHPrecio=0;

     nDCoste=0;
     nHCoste=0;

     nNumero=0;
     nCero=0;
     aArticuloAux="";
     nPrecioAux=0;
     aInicialImagen="";

     nArAc = 0;
     nTArt = 0;
     &nxArtTotal=0;
     nSalida=0;
     nMenos1=-1;

     || para el OCX
          miocx    = -1;
          parsocx  = 0;
          tRetorno = 0;
          vRetorno = 0;
          tPar1    = 1;
          vPar1    = "NADA";
          aAlfa1   = "";
          nNume1   = 0;
          aBlanco  = "";


     &nDeci_PreDiv  = 0;
     &nDeci_Base = 0;
     &nDeci_PreBase = 0;

     i = 0;
     totalc = 0;

     nBotonx31 = 0;
     nBotonx32 = 0;
     nBotonx33 = 0;

     nBotonx51 = 0;
     nBotonx52 = 0;

     nBotonx41 = 0;
     nBotonx42 = 0;
     nBotonx43 = 0;
     nBotonx44 = 0;

     &nBotonx1 = 0;
     &nBotonx2 = 0;
     &nBotonx3 = 0;
     &nBotonx4 = 0;

     nBotony1 = 0;
     nBotony2 = 0;
     nBotony3 = 0;

     nBotonx21 = 0;
     nBotonx22 = 0;
     nBotonx23 = 0;
     nBotonx24 = 0;
     nBotonx240 = 0;
     nBotonx25 = 0;
     nBotonx26 = 0;
     nBotonx260 = 0;
     nBotonx27 = 0;
     nBotonx28 = 0;
     nBotonx29 = 0;
     nBotonx30 = 0;
     nBotonx300 = 0;
     nBotonx210 = 0;
     nBotonx211 = 0;
     nBotonx212 = 0;
     nBotonx213 = 0;
     nBotonx214 = 0;
     nBotonx215 = 0;
     nBotonx216 = 0;
     nBotonx217 = 0;
     nBotonx218 = 0;
     nBotonx219 = 0;
     nBotonx220 = 0;
     nBotonx888 = 0;
     aMensaje = "";
     nSinCodigo = 0;
     &nFiltro = 0;
     aCodBarras = "";
     nSwCodBarra = 0;
     aFamily = "";
     aSubFamily = "";
     aLineaPro = "";
     aPrecioPtas = "";
     nPrecioPtas = 0;
     aPrecioEuro = "";
     nPrecioEuro = 0;
     nSwEstaArt = 0;
     nLinArt = 0;
     aArtSel = "";
     aArtPor4 = "";
     aTecla2 = "";
     nSwModoAlta = 0;
     aIniDesc = "";
     aFinDesc = "";
     swSiLee  = 0;
     &nUli    = 0;
     &nDtt    = 0;
     &nDt2    = 0;
     &vLugar  = 0;
     nSwVic   = 0;
     nSwBus   = 0;
     &aArticulo = "";
     &aDescArt  = "";
     &nPesetas  = "";
     &nEuros    = "";
     &nStock    = "";
     aRafa      = "";

     &aPathImagen = "";

     nIdImagen = -1;

     {-1}vPopup = "";
          vPopup1 = "1024";
          vPopup2 = "2164";
          vPopup3 = "0000";
          vPopup4 = "PEDIR";

     aCadena   = "";
     nCampo    = 0;
     nPosi     = 0;
     aLen      = "";
     nLen      = "";
     aCaracter = "";

     swNomod = 0;
     nContalis = 0;
     nSw9Imagenes = 0;
     nBotonx71 = 0;
     nBotonx72 = 0;
     nBotonx73 = 0;
     nBotonx74 = 0;
     nBotonx75 = 0;
|FIN;

|PROCESO Tipo12k;|TIPO 12;
|FPRC;

|PROCESO LeeConRep;
     |ABRE #17;
     |LEE 000#17p;
     |SI FSalida ! 0;
          #17#0 = 0;
          #17#1 = 1;
          #17#2 = "3";
          #17#3 = "  ";
          #17#4 = "  ";
          #17#5 = "  ";
          #17#6 = 0;
          #17#7 = "  ";
          #17#8 = 1;
          #17#9 = "";
     |FINSI;
     |CIERRA #17;
     aRepr = #17#0;
     nCpmv = #17#1;
     nRtip = #17#2;
     nRnar = #17#8;
     aRSeA = #17#7;
     aRSeB = #17#5;
     nRcoe = #17#6;
     aRruI = #17#9;
     |QBF aRruI;

     aAutonomo = "N";
     |ABRE #23;
     #23#0 = aRepr;
     |LEE 000#23=;
     |SI FSalida = 0;
          aAutonomo = #23#57;
     |FINSI;
     |CIERRA #23;
|FPRC;


|PROCESO DibujaOCX;|TIPO 14;
     |SI miocx = nMenos1;
          || |OCX_ACTIVA "DsStd.DsImagen",miocx;
          || miocx = FSalida;
     |FINSI;
     aAlfa1 = aRruI;

     aBlanco = aAlfa1;
     |SI nNuFi=1;
         aInicialImagen=#por00022#0 % 101;
         aAlfa1  = aAlfa1 + aInicialImagen+"\"+ #por00022#0;
     |SINO;
         aInicialImagen=#por00025#0 % 101;
         aAlfa1  = aAlfa1 + aInicialImagen+"\"+ #por00025#0;
     |FINSI;
     |SI nSw9Imagenes = 1;
         aAlfa1 = aRruI;
         aInicialImagen=#por00003#0 % 101;
         aAlfa1  = aAlfa1 + aInicialImagen+"\"+ #por00003#0;
         nSw9Imagenes = 0;
     |FINSI;
     aBlanco = aBlanco+ "blanco.jpg";
     |QBF aAlfa1;
     aAlfa1 = aAlfa1 + ".jpg";
     |XABRE "CE",aAlfa1,nNume1;
     |SI FSalida = 1;
         vPar1 = aAlfa1;
     |SINO;
         vPar1 = aBlanco;
     |FINSI;

     vPar1 = "IMAGEN," + vPar1;
     |CONTROL_SIMPLE 0, vPar1, 530, 2275,NULL;
     nIdImagen=FSalida;

     || parsocx = tRetorno<-;
     |||OCX_INVOCA miocx,"Pinta",0428,2380,2,parsocx;
|FPRC;

|PROCESO LiberaOCX;|TIPO 9;
     |SI nIdImagen ! -1;
         |FIN_CONTROL_WINDOWS nIdImagen;
         |PULSATECLA;
         nIdImagen = -1;
     |FINSI;
     miocx = nMenos1;
|FPRC;

|PROCESO InformaFinProceso;
     |HAZ IniFil;
     |MENAV "0000Proceso detenido por el usuario";
|FPRC;

|PROCESO PCalculaRegTotalesFiPre;
     |SI aOferta = "S";
          |SI aDescripArticulo1 ! ""; |O  aDescripArticulo2 ! "";
                    |O  aDescripArticulo3 ! "";
               aAlf2 = #25#1;
               aAlf1 = aAlf2 -  aDescripArticulo1;
               aAlf1 = aAlf1 -  aDescripArticulo2;
               aAlf1 = aAlf1 -  aDescripArticulo3;
               |SI aAlf1 = aAlf2;
                    |ACABA;
               |FINSI;
          |FINSI;
     |FINSI;
     aCad1 = aSw % 1001;
     |SI aCad1 = "1";
          #43#15 = #0#15;
          #43#2  = #25#0;
          |LEE 000#43=;
          |SI FSalida ! 0;
               |ACABA;
          |FINSI;
     |FINSI;
     |SI swSiLee = 1; |O swSiLee = 2;
          ||--------------Precios Clientes/Articulos.
          #3#25 = 0;
          nCodCli = #0#15; ||Cod.Cli.
          nCodArt = #25#0; ||Cod.Art.
          nSwBus = 1;
          nSwOferta = 0;
          nSwFolleto = 0;
          nSwCliArt = 0;
          |HAZ PreCliArt;
          nSwBus = 0;
          |SI swSiLee = 1; ||Ofertas S
               nSwContinua = 0;
               |SI aOfeCli = "S";
                    |SI nSwCliArt = 1;
                         nSwContinua = 1;
                    |FINSI;
               |FINSI;
               |SI aOfeOfe = "S";
                    |SI nSwOferta = 1;
                         nSwContinua = 1;
                    |FINSI;
               |FINSI;
               |SI aOfeFol = "S";
                    |SI nSwFolleto = 1;
                         nSwContinua = 1;
                    |FINSI;
               |FINSI;

               |SI nSwContinua = 0;
                    |ACABA;
               |FINSI;
          |FINSI;
          |SI swSiLee = 2; ||Ofertas N
               |SI #3#25 ! 0;
                    |ACABA;
               |FINSI;
          |FINSI;
     |FINSI;
     #22#0 = #25#0;
     |SI nTArt < 50001;            || TOPE DE 50000 ARTICULOS!!!
          |GRABA 000#22n;          || SI SE CAMBIA, CAMBIAR TAMBIEN
          |SI FSalida = 0;         || FM1emo3 = "50000";  EN VARIABLES
               nTArt = nTArt + 1;
          |FINSI;             || en la busqueda de ofertas pueden
     |FINSI;                  ||/venir duplicados, hay que dejarlos pasar
|FPRC;

|DEFBUCLE BCalculaRegTotalesFiPre;  || en nTArt esta el total de articulos
     #25#3;
     4,16,11,5;
     #16#11,#16#9 ,#16#13,#16#0,nDStock,nDPrecio,fDesdeFecha,nDCoste;
     #16#12,#16#10,#16#14,#16#1,nHStock,nHPrecio,fHastaFecha,nHCoste;
     ;
     NULL,PCalculaRegTotalesFiPre;
|FIN;

|DEFBUCLE BCalculaRegTotalesFiD;  || en nTArt esta el total de articulos
     #25#2;
     7,2,3,0,4,16,11,5;
     aIniDesc,#16#11, #16#9,#16#13,#16#0,nDStock,nDPrecio,fDesdeFecha,nDCoste;
     aFinDesc,#16#12,#16#10,#16#14,#16#1,nHStock,nHPrecio,fHastaFecha,nHCoste;
     f;
     NULL,PCalculaRegTotalesFiPre;
|FIN;

|DEFBUCLE  FiltroRefe;
     #25#1;
     7,2,3,0,4,16,11,5;
     aArt,#16#11, #16#9,#16#13,#16#0,nDStock,nDPrecio,fDesdeFecha,nDCoste;
     aArt,#16#12,#16#10,#16#14,#16#1,nHStock,nHPrecio,fHastaFecha,nHCoste;
     ;
     NULL,PCalculaRegTotalesFiPre;
|FIN;

|PROCESO Ref_marhu363;
     aArt = #marhu363@#1;
     |BUCLE FiltroRefe;
|FPRC;

|DEFBUCLE Ref_marhu363;
     #marhu363@#1002;
     ;
     aCodOfe, "                    ";
     aCodOfe, "zzzzzzzzzzzzzzzzzzzz";
     ;
     NULL, Ref_marhu363;
|FIN;

|PROCESO Ref_agifa023;
     aArt = #agifa023@#1;
     |BUCLE FiltroRefe;
|FPRC;

|DEFBUCLE Ref_agifa023;
     #agifa023@#1002;
     ;
     #0#15, "                    ";
     #0#15, "zzzzzzzzzzzzzzzzzzzz";
     ;
     NULL, Ref_agifa023;
|FIN;

|PROCESO FilOfertaRef;
     |DDEF aDef;
     aAlfa = aDef + "agifa023";
     |CARGA_DEF aAlfa, agifa023@;
     |SI FSalida = 0;
          |BUCLE Ref_agifa023;
          |DESCARGA_DEF #agifa023@;
     |FINSI;
     aAlfa = aDef + "marhu363";
     |CARGA_DEF aAlfa, marhu363@;
     |SI FSalida = 0;
          |ABRE #44;
          #44#0 = #0#15;
          |LEE 000#44=;
          aAlfa = FSalida;
          |CIERRA #44;
          |SI aAlfa = "0";
               aCodOfe = #44#1;
               |BUCLE Ref_marhu363;
               aCodOfe = #44#2;
               |BUCLE Ref_marhu363;
          |FINSI;
          |DESCARGA_DEF #marhu363@;
     |FINSI;
|FPRC;

|PROCESO IniFil;
     aDAr1 = "                    ";
     aHAr1 = "zzzzzzzzzzzzzzzzzzzz";
     nTArt = 0;
     aCad1 = "por00025";
     |LEEDEDEF aCad1 , "";
     aCad1 = FSalida;
     aCad1 = aCad1 % 1108;
     nTArt = aCad1;
     nNuFi = 0;
|FPRC;


|PROCESO PintaRegistroActual;
     |SI nBotonx888 ! 0;
          |FIN_CONTROL_WINDOWS nBotonx888;
          |PULSATECLA;
     |FINSI;
     aCad1 = "BOTON,Articulo " + nArAc + "/" + nTArt;
     |CONTROL_SIMPLE 0, aCad1, 2513, 2528, PulsaRegActualArticulo;
     nBotonx888 = FSalida;
|FPRC;

|PROCESO QuitaRegistroActual;
     |FIN_CONTROL_WINDOWS nBotonx888;
     |PULSATECLA;
     nBotonx888 = 0;
|FPRC;

|PROCESO VerificaCambiosFi;
     aSw = "0000000000000";
     || 1 0 - Descripcion
     || 2 0 - Codigo Articulo.
     || 3 0 - Precio Venta.
     || 4 0 - Stock
     || 5 0 - Codigo Barras.
     || 6 0 - Linea.
     || 7 0 - Familia.
     || 8 0 - SubFamilia.
     || 9 0 - Novedad.
     ||10 0 - Habitual.
     ||11 0 - Ofertas.
     ||12 0 - Oferta S/N.
     ||13 0 - Precio Coste.
     |SI aDescripArticulo1 ! ""; |O aDescripArticulo2 ! ""; |O aDescripArticulo3 ! "";
          aSw = "1000000000000";
     |FINSI;
     |SI aDesdeArticulo ! ""; |O aHastaArticulo ! "";
          aAlfa = aSw % 101;
          bAlfa = aSw % -111;
          aSw   = aAlfa + "1" + bAlfa;
     |FINSI;
     |SI nPrecio ! 0; |O nYMenorPrecio ! 0;
          aCad1 = aSw % 102;
          bAlfa = aSw % -110;
          aSw   = aCad1 + "1" + bAlfa;
     |FINSI;
     |SI nStock ! -999999;
          aAlfa = aSw % 103;
          bAlfa = aSw % -109;
          aSw   = aAlfa + "1" + bAlfa;
     |FINSI;
     |SI aCodigoBarras ! "";
          aSw = "0000100000000";
          |ACABA;
     |FINSI;
     |SI aLineaDesde ! ""; |O aLineaHasta ! "";
          aAlfa = aSw % 105;
          bAlfa = aSw % -107;
          aSw   = aAlfa + "1" + bAlfa;
     |FINSI;
     |SI aFamiliaDesde ! ""; |O aFamiliaHasta ! "";
          aAlfa = aSw % 106;
          bAlfa = aSw % -106;
          aSw   = aAlfa + "1" + bAlfa;
     |FINSI;
     |SI aSubFamiliaDesde ! ""; |O aSubFamiliaHasta ! "";
          aAlfa = aSw % 107;
          bAlfa = aSw % -105;
          aSw   = aAlfa + "1" + bAlfa;
     |FINSI;
     |SI aNovedad ! "T";
          aAlfa = aSw % 108;
          bAlfa = aSw % -104;
          aSw   = aAlfa + "1" + bAlfa;
     |FINSI;
     |SI aHabitual ! "N";
          aAlfa = aSw % 109;
          bAlfa = aSw % -103;
          aSw   = aAlfa + "1" + bAlfa;
     |FINSI;
     |SI aOferta ! "T";
          aAlfa = aSw % 110;
          bAlfa = aSw % -102;
          aSw   = aAlfa + "1" + bAlfa;
     |FINSI;
     |SI nCoste ! 0; |O nYMenorCoste ! 0;
          aAlfa = aSw % 112;
          aSw   = aAlfa + "1";
     |FINSI;
|FPRC;

|PROCESO VerificaFiltro;
     ||__Cod.Articulo
     aCad1 = aSw % 201;
     |SI aCad1 = "0";
         #16#0 = "                    ";
         #16#1 = "zzzzzzzzzzzzzzzzzzzz";
     |FINSI;
     ||__Cod.Linea.
     aCad1 = aSw % 601;
     |SI aCad1 = "0";
         #16#11 = "  ";
         #16#12 = "zz";
     |FINSI;
     ||__Cod.Familia.
     aCad1 = aSw % 701;
     |SI aCad1 = "0";
         #16#9  ="   ";
         #16#10 ="zzz";
     |FINSI;
     ||__Cod.SubFamilia.
     aCad1 = aSw % 801;
     |SI aCad1 = "0";
         #16#13 = "     ";
         #16#14 = "zzzzz";
     |FINSI;
     ||__Stock.
     aCad1 = aSw % 401;
     |SI aCad1 = "0";
          nDStock = -99999999;
          nHStock = 999999999;
     |SINO;
          |SI aSignoStock = "=";
               nDStock = nStock;
               nHStock = nStock;
          |SINO;
               |SI aSignoStock = "<";
                    nDStock = -99999999;
                    nHStock = nStock - 1;
               |SINO;
                    |SI aSignoStock = ">";
                         nDStock = nStock + 1;
                         nHStock = 999999999;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
     ||__Precio Venta.
     aCad1 = aSw % 301;
     |SI aCad1 = "0";
          nDPrecio = -9999999.999;
          nHPrecio = 99999999.999;
     |SINO;
          nDPrecio = nPrecio;
          nHPrecio = nYMenorPrecio;
     |FINSI;
     ||__Precio Coste.
     aCad1 = aSw % 1301;
     |SI aCad1 = "0";
          nDCoste = -9999999.999;
          nHCoste = 99999999.999;
     |SINO;
          nDCoste = nCoste;
          nHCoste = nYMenorCoste;
     |FINSI;
|FPRC;

|PROCESO PulsaOkFiltro;
     |PTEC 806;
|FPRC;

|PROCESO PulsaCancelarFiltro;
     |PTEC 807;
|FPRC;

|PROCESO PonBotonesFiltro;
     |CONTROL_SIMPLE 0, "BOTON,OK", 2303, 2313, PulsaOkFiltro;
     nBotonx1 = FSalida;
     |CONTROL_SIMPLE 0, "BOTON,Cancelar", 2315, 2325, PulsaCancelarFiltro;
     nBotonx2 = FSalida;
|FPRC;

|PROCESO QuitaBotonesFiltro;
     |FIN_CONTROL_WINDOWS nBotonx1;
     |FIN_CONTROL_WINDOWS nBotonx2;
     |PULSATECLA;
|FPRC;
ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
|PROCESO EstablecerFiltro;
     |PUSHV 0501 2327;
     |ABRE #16;
     |DDEFECTO #16;
     nTipoRepresentante = nRtip;  || variable global para el filtro
     |HAZ PonBotonesFiltro;
     |SI nRtip = 1;
          |C_M #16#16 , 1 , "S";
          |C_M #16#17 , 1 , "S";
          |C_V #16#16 , 1 , "S";
          |C_V #16#17 , 1 , "S";
     |SINO;
          |C_M #16#16 , 1 , "N";
          |C_M #16#17 , 1 , "N";
          |C_V #16#16 , 1 , "N";
          |C_V #16#17 , 1 , "N";
     |FINSI;
     |PINPA #0#16;
     |SI nRtip = 1;
          |PINTA 2102 , "P.C. > que";
          |PINTA 2202 , "   Y < que";
     |FINSI;
     |PINDA #0#16;
     |ENDATOS #1#16;
     |SI FSalida < 0;
          |HAZ QuitaBotonesFiltro;
          nSeguir = 0;   || si no hay cambios
          |HAZ IniFil;
          |POPV;
          |HAZ ArtPrim;
          |CIERRA #16;
          |ACABA;
     |FINSI;
     |FIN_CONTROL_WINDOWS nBotonx1;
     |FIN_CONTROL_WINDOWS nBotonx2;
     |PULSATECLA;
     aDesdeArticulo    = #16#0;
     aDAr1   = #16#0;  || desde articulo sin quitar espacios blancos
     aHastaArticulo    = #16#1;
     aHAr1   = #16#1;  || hasta articulo sin quitar espacios blancos
     aAlfa = #16#2; |HAZ QuitaRaros; #16#2 = aAlfa;
     aDescripArticulo1 = #16#2;
     aAlfa = #16#9; |HAZ QuitaRaros; #16#9 = aAlfa;
     aDescripArticulo2 = #16#19;
     aAlfa = #16#20; |HAZ QuitaRaros; #16#20 = aAlfa;
     aDescripArticulo3 = #16#20;
     |QBF aDesdeArticulo;
     |QBF aHastaArticulo;
     |QBF aDescripArticulo1;
     |QBF aDescripArticulo2;
     |QBF aDescripArticulo3;
     aDescripArticulo1 = aDescripArticulo1 > "";
     aDescripArticulo2 = aDescripArticulo2 > "";
     aDescripArticulo3 = aDescripArticulo3 > "";
     nPrecio           = #16#4;
     nYMenorPrecio     = #16#5;
     aSignoStock       = #16#6;
     nCoste            = #16#16;
     nYMenorCoste      = #16#17;
     nStock            = #16#7;
     aCodigoBarras     = #16#8;
     |QBF aCodigoBarras;
     aFamiliaDesde     = #16#9;
     aFamiliaHasta     = #16#10;
     aLineaDesde       = #16#11;
     aLineaHasta       = #16#12;
     aSubFamiliaDesde  = #16#13;
     aSubFamiliaHasta  = #16#14;
     |QBF aFamiliaDesde;
     |QBF aFamiliaHasta;
     |QBF aLineaDesde;
     |QBF aLineaHasta;
     |QBF aSubFamiliaDesde;
     |QBF aSubFamiliaHasta;
     aNovedad         = #16#18;
     aHabitual        = #16#21;
     aOferta          = #16#22;
     aOfeOfe = #16#23;
     aOfeFol = #16#24;
     aOfeCli = #16#25;
     fDesdeFecha      = "01.01.0000";
     fHastaFecha      = "31.12.9999";
     |SI aNovedad = "S";
          fHastaFecha = ~;
          nNume1 = -0.002;
          fDesdeFecha = fHastaFecha + nNume1;
     |FINSI;
     |SI aNovedad = "N";
          fHastaFecha = ~;
          nNume1 = -1.002;
          fDesdeFecha = fHastaFecha + nNume1;
          fHastaFecha = fDesdeFecha;
          fDesdeFecha = "01.01.0000";
     |FINSI;
     |SI aHabitual = "S";
          aCad1=#0#15;
          |QBF aCad1;
          |SI aCad1="";
               |MENAV "0000Para ver los Articulos Habituales tienes que seleccionar un Cliente!";
               |POPV;
               |ACABA;
          |FINSI;
     |FINSI;

     |SELECT #1#por00025;

     |HAZ IniFil;
     |HAZ VerificaCambiosFi;
     |CIERRAT #22;
     |DELINDEX #22;
     |ABRET #22;
     |HAZ Carga_22;
     nTArt = 0;
     |ABRE #43;
     |SELECT #5#43;
     ||___________________________________ Seleccion Oferta.
     aCad1 = aSw % 1101;
     |SI aCad1 = "1";
          |SI aOferta = "S";
               swSiLee = 1;
               ||ARA.
               ||Distinguir los tres tipos de Oferta.
               ||Oferta, Folleto, Tarifa Art/Cli

          |FINSI;
          |SI aOferta = "N";  swSiLee = 2;   |FINSI;
     |SINO;
          swSiLee = 0;
     |FINSI;
     ||___________________________________ Seleccion Por Codigo Barras.
     aCad1 = aSw % 501;
     |SI aCad1 = "1";
          |SELECT #4#por00025;
          #por00025#9 = #16#8;
          |LEE 010#por00025.=;
          |SI FSalida ! 0;
               nTArt = 0;
          |SINO;
               nTArt = 1;
          |FINSI;
          #22#0 = #25#0;
          |GRABA 020#22n;
          |SELECT #1#por00025;
          nNuFi = 1;
     |FINSI;
     ||________________________________ Seleccion Por Codigo Articulos.
     aCad1 = aSw % 201;
     |SI aCad1 = "1";
          #25#0 = #16#0
          |LEE 000#25];
          |DAREGN #25,nreg;
          nInicio = FSalida;
          #25#0 = #16#1;
          |LEE 000#25>;
          |SI FSalida ! 0;
               |LEE 000#25u;
          |SINO;
               |LEE 000#25a;
          |FINSI;
          |DAREGN #25,nreg;
          nFinal = FSalida;
          nTArt = nFinal - nInicio + 1;
          nNuFi = 0;
     |FINSI;
     ||__________________________________ Seleccion Por Descripcion.
     aCad1 = aSw % 101;
     |SI aCad1 = "1";
          |HAZ VerificaFiltro;
          nNuFi = 1;
          aRafa = "";
          FSalida = "";
          |SI aDescripArticulo1 ! "";
               ||FSalida = aDescripArticulo1;
               aRafa = aDescripArticulo1;
          |FINSI;
          |SI aDescripArticulo2 ! "";
               |SI aRafa ! "";
                   aRafa = aRafa + "\\";
               |FINSI;
               aRafa = aRafa + aDescripArticulo2;
          |FINSI;
          |SI aDescripArticulo3 ! "";
               |SI aRafa ! "";
                    aRafa = aRafa + "\\";
               |FINSI;
               aRafa = aRafa + aDescripArticulo3;
          |FINSI;
          nTArt = 0;
          FSalida = aRafa;
          |SI aOferta = "S";
               |HAZ FilOfertaRef;
          |SINO;
               |BUCLE BCalculaRegTotalesFiD;
          |FINSI;
     |FINSI;
     ||______ Seleccion Resto.
     aCad1 = aSw % 101; bAlfa = aSw % 501;
     |SI aCad1 = "0"; |Y bAlfa = "0";
          nTArt       = 0;
          nNuFi = 1;
          |HAZ VerificaFiltro;
          nTArt = 0;
          |SI aOferta = "S";
               |HAZ FilOfertaRef;
          |SINO;
               |BUCLE BCalculaRegTotalesFiPre;
          |FINSI;
     |FINSI;
     |SI nTArt = 0;   || No Hay Articulos
          |HAZ IniFil;
          |MENAV "0000No se han encontrado Articulos con esas caracteristicas!";
     |FINSI;
     |POPV;
     |HAZ ArtPrim;
     |CIERRA #16;
     |CIERRA #43;
|FPRC;

|PROCESO PintaNovedad; || Pinta "Novedad" si el articulo es novedad
     ||ARA
     fFecha1 = ~;
     fFecha = #225#199;
     nFecha1 = fFecha1;
     nFecha = fFecha;
     nDias = nFecha1 - nFecha;

     |PINTA 2209,"       ";
     |SI nDias [ 30;
          |ATRI S;
          |PINTA 2209,"NOVEDAD";
          |ATRI 0;
     |FINSI;
|FPRC;

|PROCESO PintaOferta;
          |SI nSwFolleto = 1;
               |ATRI S;
               |PINTA 2219 , "OFERTA F";
               |ATRI 0;
          |SINO;
               |SI nSwOferta = 1;
                    |ATRI S;
                    |PINTA 2219 , "OFERTA O";
                    |ATRI 0;
               |SINO;
                    |SI nSwCliArt = 1;
                         |ATRI S;
                         |PINTA 2219 , "OFERTA C";
                         |ATRI 0;
                    |SINO;
                         |PINTA 2219 , "        ";
                    |FINSI;
               |FINSI;
          |FINSI;

/*
     |SI #3#25 ! 0; || Hay oferta
          |ATRI S;
          |PINTA 2219 , "OFERTA";
          |ATRI 0;
     |SINO;
          |PINTA 2219 , "      ";
     |FINSI;
*/
|FPRC;

|PROCESO PonReloj;
     |ABRE #21;
     |LEE 000#21p;
     |CIERRA #21;
     nNumero=#21#1;
     |PINTA 2424,"     ";
     |ATRI S;
     |PINTA 2424,nNumero;
     |ATRI 0;
|FPRC;

|PROCESO QuitaReloj;
     |PINTA 2424,"    ";
|FPRC;

|PROCESO PonArt; |TIPO 0;
     |HAZ DecimalesMoneda;

     |DDEFECTO #225;
     #225#0 = #3#0;
     |LEE 000#225=;

     |DDEFECTO #dsm00239;
     |ABRE #dsm00239;
     #dsm00239#0 = #225#5;
     |LEE 000#dsm00239.=;
     |CIERRA #dsm00239;

     #3#1  = #225#1; || 25 primeros caracteres de la descrip
     #3#27 = #225#1 % 2625;
     #3#2  = #225#6;
     #3#3  = #225#125;
     #3#5  = #225#2;
     #3#7  = #225#3;
     #3#9  = #225#126;
     |SI nEsPedido = 1;
          #3#11 = #225#18; ||Precio Pvp-1
     |SINO;
          #3#11 = #225#18 + #225#18 % nRcoe; ||Precio Pvp-1
     |FINSI;
     #3#12 = #225#19;
     #3#13 = #225#20;
     #3#14 = #225#147;
     #3#15 = #225#148;
     #3#16 = #225#149;
     #3#20 = #225#4;   ||Unidades embalaje
     #3#21 = #225#198; ||Unidades Minimo Venta
     #3#22 = #225#128; ||EAN
     #3#23 = #225#16;  ||Pendientes Recibir
     |SI EURODB = 2;
          #3#24 = #3#11 * 166.386;  ||Pvp-1 en pesetas
          #3#24 = #3#24 ! 0;
     |SINO;
          #3#24 = #3#11 / 166.386;  ||Pvp-1 en euros
     |FINSI;
     #3#26 = #225#133 * nCpmv;   ||PCM * Coeficiente de Control Repr
     #3#28 = #dsm00239#0;          || tipo embalaje
     #3#29 = #dsm00239#1;          || descrip. tipo embalaje
     #3#30 = #dsm00239#2;          || abrevi. tipo embalaje

     ||--------------Linea.
     |ABRE #100;
     |DDEFECTO #100;
     #100#0 = #3#3;
     |LEE 000#100=;
     #3#4 = #100#1;
     |CIERRA #100;
     ||--------------Familia.
     |ABRE #11;
     |DDEFECTO #11;
     #11#0 = #3#5;
     |LEE 000#11=;
     #3#6 = #11#1;
     |CIERRA #11;
     ||--------------SubFamilias.
     |ABRE #120;
     |DDEFECTO #120;
     #120#0 = #3#7;
     |LEE 000#120=;
     #3#8 = #120#1;
     |CIERRA #120;
     ||--------------Marca.
     |ABRE #13;
     |DDEFECTO #13;
     #13#0 = #3#9;
     |LEE 000#13=;
     #3#10 = #13#1;
     |CIERRA #13;
     ||--------------Precios Clientes/Articulos.
     nCodCli = #0#15; ||Cod.Cli.
     nCodArt = #3#0;  ||Cod.Art.
     |HAZ PreCliArt;
     ||--------------Presentacion.
     |SI nSwVic = 0;
          |PINDA #0#3;
          |SI nImagen = 0;
               ||TODO CCC
               |HAZ DibujaOCX;
          |FINSI;
          |HAZ PintaNovedad;
          |HAZ PintaOferta;
          |HAZ OcultaPrecios;
     |FINSI;
|FPRC;

|PROCESO EstadoBotonesArt;
     |ESTADO_CONTROL nBotonx21,aEstadoBoton;
     |ESTADO_CONTROL nBotonx22,aEstadoBoton;
     |ESTADO_CONTROL nBotonx23,aEstadoBoton;
     |ESTADO_CONTROL nBotonx24,aEstadoBoton;
     |ESTADO_CONTROL nBotonx25,aEstadoBoton;
     |ESTADO_CONTROL nBotonx26,aEstadoBoton;
     |ESTADO_CONTROL nBotonx27,aEstadoBoton;
     |ESTADO_CONTROL nBotonx28,aEstadoBoton;
     |ESTADO_CONTROL nBotonx29,aEstadoBoton;
     |ESTADO_CONTROL nBotonx210,aEstadoBoton;
     |ESTADO_CONTROL nBotonx211,aEstadoBoton;
     |ESTADO_CONTROL nBotonx212,aEstadoBoton;
     |ESTADO_CONTROL nBotonx213,aEstadoBoton;
     |ESTADO_CONTROL nBotonx214,aEstadoBoton;
     |ESTADO_CONTROL nBotonx215,aEstadoBoton;
     |ESTADO_CONTROL nBotonx216,aEstadoBoton;
     |ESTADO_CONTROL nBotonx219,aEstadoBoton;
     |ESTADO_CONTROL nBotonx220,aEstadoBoton;
     |ESTADO_CONTROL nBotonx888,aEstadoBoton;

     |SI aEstadoBoton="HIDE";
          |ESTADO_CONTROL nBotonx217,aEstadoBoton;
          |ESTADO_CONTROL nBotonx218,aEstadoBoton;
     |SINO;
          |SI nRedondeoPu=0;
               |ESTADO_CONTROL nBotonx217,"HIDE";
               |ESTADO_CONTROL nBotonx218,"SHOW";
          |SINO;
               |ESTADO_CONTROL nBotonx217,"SHOW";
               |ESTADO_CONTROL nBotonx218,"HIDE";
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO PonEstadoNavegador;
     |ESTADO_CONTROL nBotonx26,"ENABLE";
     |ESTADO_CONTROL nBotonx27,"ENABLE";
     |ESTADO_CONTROL nBotonx28,"ENABLE";
     |ESTADO_CONTROL nBotonx29,"ENABLE";
     |SI nArAc = 1;
          |ESTADO_CONTROL nBotonx26,"DISABLE";
          |ESTADO_CONTROL nBotonx27,"DISABLE";
          |SI nTArt = 1;
               |ESTADO_CONTROL nBotonx28,"DISABLE";
               |ESTADO_CONTROL nBotonx29,"DISABLE";
          |FINSI;
     |FINSI;

     |SI nArAc = nTArt;
          |ESTADO_CONTROL nBotonx28,"DISABLE";
          |ESTADO_CONTROL nBotonx29,"DISABLE";
          |SI nArAc = 1;
               |ESTADO_CONTROL nBotonx26,"DISABLE";
               |ESTADO_CONTROL nBotonx27,"DISABLE";
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO ArticuloAnterior;
     |SI nNuFi=1;
          #22#0=#3#0;
          |LEE 000#22=;
          |LEE 000#22a;
          |SI FSalida=nCero;
               #3#0=#22#0;
               |HAZ PonArt;
               nArAc=nArAc-1;
          |SINO;
               |MENAV "0000Primera Ficha";
          |FINSI;
     |FINSI;

     |SI nNuFi=nCero;
          #25#0=#3#0;
          |LEE 000#25=;
          |LEE 000#25a;
          |SI FSalida=nCero;|Y #25#0 ] aDAr1;
               #3#0=#25#0;
               |HAZ PonArt;
               nArAc=nArAc-1;
          |SINO;
               |MENAV "0000Primera Ficha";
          |FINSI;
     |FINSI;

     |HAZ PonEstadoNavegador;
|FPRC;

|PROCESO ArticuloSiguiente;
     |SI nNuFi=1;
          #22#0=#3#0;
          |LEE 000#22=;
          |LEE 000#22s;
          |SI FSalida=nCero;
               #3#0=#22#0;
               |HAZ PonArt;
               nArAc=nArAc+1;
          |SINO;
               |MENAV "0000Ultima Ficha";
               nSeguir = -1;
          |FINSI;
     |FINSI;


     |SI nNuFi=nCero;
          #25#0=#3#0;
          |LEE 000#25=;
          |LEE 000#25s;
          |SI FSalida=nCero;|Y #25#0 [ aHAr1;
               #3#0=#25#0;
               |HAZ PonArt;
               nArAc=nArAc+1;
          |SINO;
               |MENAV "0000Ultima Ficha";
               nSeguir = -1;
          |FINSI;
     |FINSI;

     |HAZ PonEstadoNavegador;
|FPRC;


|PROCESO ArtPrim;
     |SI nNuFi = 1;
          |LEE 000#22p;
          |SI FSalida = nCero;
               #3#0 = #22#0;
               |HAZ PonArt;
               nArAc = 1;
          |FINSI;
     |FINSI;
     |SI nNuFi = 0;
          #25#0 = aDAr1;
          |LEE 000#25];
          |SI FSalida = 0;
               #3#0 = #25#0;
               |HAZ PonArt;
               nArAc = 1;
          |FINSI;
     |FINSI;
     |HAZ PonEstadoNavegador;
|FPRC;

|PROCESO ArticuloUltimo;
     |SI nNuFi=1;
          |LEE 000#22u;
          |SI FSalida=nCero;
               #3#0=#22#0;
               |HAZ PonArt;
               nArAc=nTArt;
          |FINSI;
     |FINSI;

     |SI nNuFi=nCero;
          #25#0 = aHAr1;
          |LEE 000#25>;
          |SI FSalida!nCero;
             |LEE 000#25u;
          |SINO;
             |LEE 000#25a;
          |FINSI;
          |SI FSalida = 0;
               #3#0 = #25#0;
               |HAZ PonArt;
               nArAc = nTArt;
          |FINSI;
     |FINSI;

     |HAZ PonEstadoNavegador;
|FPRC;


|PROCESO DibuCliAnt;
     |DDEFECTO #24;
     |ABRE #24;
     #24#0 = aClienteSuper;
     |LEE 000#24=;
     #0#15 = #24#0;
     #0#0  = #24#1;
     #0#1  = #24#6;
     #0#4  = #24#6;
     #0#2  = #24#2;
     #0#3  = #24#5;
     #0#5  = #24#178;
     #0#6  = #24#179;
     #0#7  = #24#7;
     #0#8  = #24#8;
     #0#9  = #24#9;
     #0#10 = #24#181;
     #0#11 = #24#182;
     #0#12 = #24#10;
     #0#13 = #24#15;
     #0#14 = #24#17;
     |CIERRA #24;
|FPRC;

|PROCESO DibuCliNue;
     |DDEFECTO #33;
     |ABRE #33;
     #33#0 = aClienteSuper;
     |LEE 000#33=;
     #0#15 = #33#0;  || codigo del cliente, a¤adimos una "N"
     #0#0  = #33#2;
     #0#1  = #33#6;
     #0#4  = #33#6;
     #0#3  = #33#3;
     #0#5  = #33#4;
     #0#6  = #33#5;
     #0#7  = #33#7;
     #0#8  = #33#3;
     #0#9  = #33#6;
     #0#10 = #33#4;
     #0#11 = #33#5;
     #0#12 = #33#7;
     #0#13 = #33#1;
     #0#14 = #33#8;
     |CIERRA #33;
|FPRC;


|PROCESO GeneraCodigoSecreto;
     fFecha=~;
     |HORA aHora;

     aCad1=fFecha % A102;
     nDia=aCad1;
     aCad1=fFecha % A402;
     nMes=aCad1;
     aCad1=fFecha % A704;
     nAnyo=aCad1;

     aCad1=aHora % A102;
     nHora=aCad1;
     aCad1=aHora % A402;
     nMinuto=aCad1;
     aCad1=aHora % A702;
     nSegundo=aCad1;

     nAux=(nSegundo+1)*(nAnyo-nMes*(nHora+1));
     nAux=nAux-(nDia*nMinuto+1)*300;
     nCodigoSecreto=nAux;
     nAux=(nAnyo*(nHora+1))-((nMinuto+1)*16)-((nHora+1)*8);
     nAux=nAux*(nSegundo+1)-nCodigoSecreto;
     nCodigoSecreto=nAux;
|FPRC;


|PROCESO CompruebaCodigoSecreto;
     nAux=nCodigoSecreto;
     nAux=(nAux/2)*3+nAux-1000;
     nAux=nAux ! nCero;

     |SI nClaveSecreta=nAux;
          nSeguir=nCero;
     |SINO;
          nSeguir=nMenos1;
     |FINSI;
|FPRC;


|PROCESO Genera2Letras;
     |HORA aHora;
     aCad1=aHora % A702;

     nSegundos=aCad1;
     nSegundos=nSegundos/2;
     nSegundos=nSegundos ! nCero;
     nAux=(nSegundos * 100) + 1;
     aCad2=aArrayLetras % nAux;

     nSegundos=aCad1;
     |SI nSegundos<20;
          nSegundos=nSegundos/2 + 10;
     |SINO;
          nSegundos=nSegundos/2 - 10;
     |FINSI;
     nSegundos=nSegundos ! nCero;
     nAux=(nSegundos * 100) + 1;
     aCad3=aArrayLetras % nAux;

     nSegundos=aCad1;
     |SI nSegundos<15;
          nSegundos=nSegundos/2 + 15;
     |SINO;
          nSegundos=nSegundos/2 - 15;
     |FINSI;
     nSegundos=nSegundos ! nCero;
     nAux=(nSegundos * 100) + 1;
     aCad4=aArrayLetras % nAux;

     nSegundos=aCad1;
     |SI nSegundos>10;
          nSegundos=nSegundos/2 - 10;
     |SINO;
          nSegundos=nSegundos/2 + 10;
     |FINSI;
     nSegundos=nSegundos ! nCero;
     nAux=(nSegundos * 100) + 1;
     aCad5=aArrayLetras % nAux;

     aLetras1=aCad2+ aCad3;
     aLetras2=aCad4+ aCad5;
|FPRC;

|PROCESO PendLin;
     nAux=#27#42+#27#12;
     |SI #27#43<nAux;   || esta linea esta pendiente de servir

          |DDEFECTO #12;
          #12#0=#27#28;
          #12#1=#27#0;
          #12#2=#27#1;
          #12#3=#27#2;
          #12#4=#27#4;
          #12#5=#27#5;
          #12#6=#27#42;
          #12#7=#27#8;
          #12#8=#27#10;
          #12#9=#27#6;
          #12#10=#26#1;
          #12#11=#26#4;
          #12#12=#26#8;

          |GRABA 020#12n;
     |FINSI;
|FPRC;

|PROCESO PendCab;
     ||SI #26#25 = #17#7; |O #26#25 = #17#5;
          ||ERROR;
     ||FINSI;
|FPRC;

|DEFBUCLE PendCab;
     #26#1;
     4,27;
     "     ",nCero ,#0#15,"S";
     "zzzzz",999999,#0#15,"S";
     ;
     NULL, PendCab, PendLin;
|FIN;

|PROCESO PendCabPor;
     ||SI #26#25 ! #17#7; |Y #26#25 ! #17#5;
          ||ERROR;
     ||FINSI;
|FPRC;

|DEFBUCLE PendCabPor;
     #26#1;
     4,27;
     "     ", nCero, #0#15,"N";
     "zzzzz", 999999,#0#15,"N";
     ;
     NULL, PendCabPor, PendLin;
|FIN;

|PROCESO VerPendientesServir;
     aCad0=#0#0;
     |QBF aCad0;
     |SI aCad0="";
          |MENAV aMensajeFaltaCliente;
     |SINO;
          |DELINDEX #12;
          |ABRE #12;
          |BUCLE PendCab;
          |CONSULTA_CLAVE #1#12;
          nSalEntLin = FSalida;
          |SI nSalEntLin = 0;
               aSerPed = #12#0;
               nNumPed = #12#1;
          |FINSI;
          |CIERRA #12;
     |FINSI;
|FPRC;

|PROCESO VerPendientesServirP;
     aCad0=#0#0;
     |QBF aCad0;
     |SI aCad0="";
          |MENAV aMensajeFaltaCliente;
     |SINO;
          |DELINDEX #12;
          |ABRE #12;
          |BUCLE PendCabPor;
          |CONSULTA_CLAVE #1#12;
          nSalEntLin = FSalida;
          |SI nSalEntLin = 0;
               aSerPed = #12#0;
               nNumPed = #12#1;
          |FINSI;
          |CIERRA #12;
     |FINSI;
|FPRC;
||*****


|PROCESO PBorrarLineasPedido;
     |BORRA 020#27a;
|FPRC;

|DEFBUCLE BBorrarLineasPedido;
     #27#1;
     ;
     #26#25,#26#0,nCero;
     #26#25,#26#0,999;
     ;
     NULL,PBorrarLineasPedido;
|FIN;

|PROCESO BorrarLineaPedido;
     |CONSULTA_CLAVE #1#4;
     |SI FSalida=nCero;
          |CONFI "00000Seguro que deseas borrar la Linea seleccionada?";
          |SI FSalida=nCero;
               |BORRA 020#4a;
               |MENAV "0000La Linea ha sido eliminada";
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO BorrarTodasLineaPedido;
     |CONFI "00000Seguro que quieres eliminar los Todas las lineas de Articulos Pedidos?";
     |SI FSalida=nCero;
          |DELINDEX #4;
          |MENAV "0000Articulos Borrados";
     |FINSI;
|FPRC;


|PROCESO PImportarLineasPedido;
     |DDEFECTO #4;
     #4#0=#27#1;         || linea
     #4#1=#27#2;         || articulo
     #4#2=#27#5;         || unidades
     #4#3=#27#10;        || comision
     #4#4=#27#8;         || descuento
     #4#5=#27#6;         || precio
     #4#6=#27#4;         || descripcion articulo

     |GRABA 020#4n;
|FPRC;

|DEFBUCLE BImportarLineasPedido;
     #27#1;
     ;
     #26#25,#26#0,nCero;
     #26#25,#26#0,999;
     ;
     NULL,PImportarLineasPedido;
|FIN;

|PROCESO minMP;
     #26#0=000001;
     #26#25="     ";
     #26#4=#0#15;
|FPRC;

|PROCESO maxMP;
     #26#0=999999;
     #26#25="zzzzz";
     #26#4=#0#15;
|FPRC;


|PROCESO minPedido;
     #27#28 = aSerPed;
     #27#0 = nNumPed;
     #27#1 = 1;
|FPRC;

|PROCESO maxPedido;
     #27#28 = aSerPed;
     #27#0 = nNumPed;
     #27#1 = 999;
|FPRC;

|PROCESO ModificarPedido;
     swNomod = 0;
     aCad0=#0#0;
     |QBF aCad0;
     |SI aCad0="";
          |MENAV aMensajeFaltaCliente;
     |SINO;
          SerieMod = "";
          PedidMod = 0;
          |ABRE #26;
          |DDEFECTO #26;
          #26#0 = nNumPed;
          #26#25 = aSerPed;
          |LEE 101#26=;
          |SI FSalida=nCero;
               |SI #26#27 = "S";
                    |MENAV "0000Pedido en Central No se Puede Modificar";
                    swNomod = 1;
               |SINO;
                    |CONFI "00000Seguro que deseas Modificar el Pedido seleccionado?";
                    |SI FSalida=nCero;
                         |DELINDEX #4;
                         |ABRE #4;
                         |BUCLE BImportarLineasPedido;
                         |CIERRA #4;
                         PedidMod = #26#0;  ||N§Pedido.
                         SerieMod = #26#25; ||Serie Pedido.
                         || |BUCLE BBorrarLineasPedido;
                         || |BORRA 020#26a;

                         || poner en pantalla el cliente de la cabecera
                         |DDEFECTO #0;
                         |ABRE #24;
                         #24#0=#26#4;
                         |LEE 000#24=;
                         |SI FSalida=nCero;
                              #0#15=#24#0;
                              #0#0=#24#1;
                              #0#1=#24#6;
                              #0#4=#24#6;
                              #0#2=#24#2;
                              #0#3=#24#5;
                              #0#4=#24#6;
                              #0#5=#24#178;
                              #0#6=#24#179;
                              #0#7=#24#7;
                              #0#8=#24#8;
                              #0#9=#24#9;
                              #0#10=#24#181;
                              #0#11=#24#182;
                              #0#12=#24#10;
                              #0#13=#24#15;
                              #0#14=#24#17;
                         |FINSI;
                         |CIERRA #24;

                         |PINDA #0#0;

                         |DDEFECTO #3;
                         |PINDA #0#3;
                         |HAZ ArtPrim;

                         |MENAV "0000El Pedido ha sido Importado";
                    |SINO;
                         swNomod = 1;
                    |FINSI;
               |FINSI;
          |FINSI;
          |CIERRA #26;
     |FINSI;
/*
     swNomod = 0;
     aCad0=#0#0;
     |QBF aCad0;
     |SI aCad0="";
          |MENAV aMensajeFaltaCliente;
     |SINO;
          |ABRE #26;
          |CONSULTA_F_CLAVE #2#26,minMP,maxMP;
          SerieMod = "";
          PedidMod = 0;
          |SI FSalida=nCero;
               |SI #26#27 = "S";
                    |MENAV "0000Pedido en Central No se Puede Modificar";
                    swNomod = 1;
               |SINO;
                    |CONFI "00000Seguro que deseas Modificar el Pedido seleccionado?";
                    |SI FSalida=nCero;
                         |DELINDEX #4;
                         |ABRE #4;
                         |BUCLE BImportarLineasPedido;
                         |CIERRA #4;
                         PedidMod = #26#0;  ||N§Pedido.
                         SerieMod = #26#25; ||Serie Pedido.
                         || |BUCLE BBorrarLineasPedido;
                         || |BORRA 020#26a;

                         || poner en pantalla el cliente de la cabecera
                         |DDEFECTO #0;
                         |ABRE #24;
                         #24#0=#26#4;
                         |LEE 000#24=;
                         |SI FSalida=nCero;
                              #0#15=#24#0;
                              #0#0=#24#1;
                              #0#1=#24#6;
                              #0#4=#24#6;
                              #0#2=#24#2;
                              #0#3=#24#5;
                              #0#4=#24#6;
                              #0#5=#24#178;
                              #0#6=#24#179;
                              #0#7=#24#7;
                              #0#8=#24#8;
                              #0#9=#24#9;
                              #0#10=#24#181;
                              #0#11=#24#182;
                              #0#12=#24#10;
                              #0#13=#24#15;
                              #0#14=#24#17;
                         |FINSI;
                         |CIERRA #24;

                         |PINDA #0#0;

                         |DDEFECTO #3;
                         |PINDA #0#3;
                         |HAZ ArtPrim;

                         |MENAV "0000El Pedido ha sido Importado";
                    |SINO;
                         swNomod = 1;
                    |FINSI;
               |FINSI;
          |FINSI;
          |CIERRA #26;
     |FINSI;
*/
|FPRC;



|PROCESO minBP;
     #26#0=000001;
     #26#25="  ";
     #26#4=#0#15;
|FPRC;

|PROCESO maxBP;
     #26#0=999999;
     #26#25="zz";
     #26#4=#0#15;
|FPRC;


|PROCESO BorrarPedido;
     aCad0=#0#0;
     |QBF aCad0;
     |SI aCad0="";
          |MENAV aMensajeFaltaCliente;
     |SINO;
          |ABRE #26;
          |DDEFECTO #26;
          #26#0 = nNumPed;
          #26#25 = aSerPed;
          |LEE 101#26=;
          |SI FSalida=nCero;
               |CONFI "00000Seguro que deseas borrar el Pedido seleccionado?";
               |SI FSalida=nCero;
                    |BUCLE BBorrarLineasPedido;
                    |MENAV "0000El Pedido ha sido eliminado";
                    |BORRA 020#26a;
               |FINSI;
          |FINSI;
          |CIERRA #26;
     |FINSI;
/*
     aCad0=#0#0;
     |QBF aCad0;
     |SI aCad0="";
          |MENAV aMensajeFaltaCliente;
     |SINO;
          |ABRE #26;
          |CONSULTA_F_CLAVE #2#26,minBP,maxBP;
          |SI FSalida=nCero;
               |CONFI "00000Seguro que deseas borrar el Pedido seleccionado?";
               |SI FSalida=nCero;
                    |BUCLE BBorrarLineasPedido;
                    |MENAV "0000El Pedido ha sido eliminado";
                    |BORRA 020#26a;
               |FINSI;
          |FINSI;
          |CIERRA #26;
     |FINSI;
*/
|FPRC;


|PROCESO PMeteLineasPedido;
     #25#0=#4#1;   || para leer datos articulo
     |LEE 000#25=;

     |DDEFECTO #27;
     #27#28=aSerie;
     #27#0=nNumeroPedido;
     #27#1=#4#0;         || linea
     |LEE 101#27=;
     nSal = FSalida;

     #27#2=#4#1;         || articulo
     #27#3 = 1;          || Almacen

     |SI nEsPedido=1;    || si es un pedido
         #27#14 = #25#14;
     |SINO;
          #27#14=nCero;
     |FINSI;

     #27#4=#4#6;         || descripcion articulo
     #27#5=#4#2;         || unidades
     #27#8=#4#4;         || descuento
     ||ARA3
     #27#10=#4#3;        || comision
     #27#42=#4#2;        || unidades pedidas


     || precios e importes, aqui esta el tema2
     #27#6=#4#5;         || precio

     #27#38=#4#5 / nCambioBase *#26#36;

     |SI #24#193 = "D";                    || Si la moneda de trabajo es la divisa ...
          #27#6 = #27#38 / #26#36 * nCambioBase;  || ... recalculo precio en funcion de la divisa
          #27#40 = #27#6;                  || ... el campo visualiz. es el precio en moneda base
     |SINO;
          #27#40=#27#38;
     |FINSI;

     || calcular importes, teniendo en cuenta los porcentajes
     nAux=#4#2 * #27#6;
     #27#7=nAux - ( nAux % #24#37) ;    || dto espcial
     #27#7=#27#7 - ( #27#7 % #24#156);  || dto acumulado
     #27#7=#27#7 - ( #27#7 % #24#38);   || dto PP
     #27#7=#27#7 - ( #27#7 % #4#4) ;    || descuento cliente-articulo

     nAux=#4#2 * #27#38;
     #27#39=nAux - (nAux % #24#37);        || dto especial
     #27#39=#27#39 - ( #27#39 % #24#156);  || dto acumulado
     #27#39=#27#39 - ( #27#39 % #24#38);   || dto PP
     #27#39=#27#39 - ( #27#39 % #4#4) ;    || descuento cliente-articulo

     nAux=#4#2 * #27#40;
     #27#41=nAux - (nAux  % #24#37);       || dto especial
     #27#41=#27#41 - ( #27#41 % #24#156);  || dto acumulado
     #27#41=#27#41 - ( #27#41 % #24#38);   || dto PP
     #27#41=#27#41 - ( #27#41 % #4#4) ;    || descuento cliente-articulo

     nAux=#4#2 * #27#40;
     #27#41=nAux - (nAux  % #24#37);       || dto especial
     #27#41=#27#41 - ( #27#41 % #24#156);  || dto acumulado
     #27#41=#27#41 - ( #27#41 % #24#38);   || dto PP
     #27#41=#27#41 - ( #27#41 % #4#4) ;    || descuento cliente-articulo

     nImporteTotal=nImporteTotal+ #27#7;
     #27#9=#27#7;

     |SI nSal ! 0; |GRABA 020#27n; |FINSI;
     |SI nSal = 0; |GRABA 020#27a; |FINSI;
     |LIBERA #27;
|FPRC;


|DEFBUCLE BMeteLineasPedido;
     #4#1;
     ;
     nCero;
     999;
     ;
     NULL,PMeteLineasPedido;
|FIN;


|| crea un pedido o un presupuesto
|PROCESO CrearPedido;
     |PUSHV 0501 2380;

     |ABRE #17; |LEE 000#17p; |CIERRA #17;

     |SI nEsPedido=1;  || depende de si es pedido o presupuesto
          aSerie = aRSeA; || ahora se coge del fichero de control
     |SINO;
          aSerie = aRSeB; || cogemos la serie del fichero de control
     |FINSI;

     |ABRE #26;
     |SI PedidMod ! 0;
          |DDEFECTO #26;
          aSerie = SerieMod;
          nNumeroPedido = PedidMod;
          #26#25 = SerieMod;
          #26#0  = PedidMod;
          |LEE 101#26=;
     |SINO;
          #26#25 = aSerie;
          enSwMenu = 1;
          |HAZ ContaPV7;
          |SI nEsPedido=1;  || depende de si es pedido o presupuesto
               nNumeroPedido = #17#10;
          |SINO;
               nNumeroPedido = #17#11;
          |FINSI;

          || ver monedas base y de cliente

          |ABRE #321;    || para saber la moneda base
          |LEE 000#321p; || en #321#9 esta la moneda base
          |CIERRA #321;

          |ABRE #324;    || tipo de cambio para la moneda base
          #324#0=#321#9; || en #324#2 esta el cambio de la moneda base
          |LEE 000#324=;
          |CIERRA #324;
          nCambioBase=#324#2;

          || crear cabecera del pedido
          |DDEFECTO #26;
          #26#25=aSerie;
          #26#0=nNumeroPedido;
          |LEE 101#26=;
          |SI FSalida ! 0;
               |GRABA 020#26b;
          |FINSI;
          |ABRE #24;
          #24#0=#0#15;
          |LEE 000#24=;
          |SI FSalida!nCero;  || si el cliente no existe o es nuevo, datos defecto
               |DDEFECTO #24;
               #26#35=#321#9;     || divisa
          |SINO;
               #26#35=#24#192;     || divisa
          |FINSI;

          #26#4=#0#15;             || cliente
          #26#7=#17#0;              ||Repre
          #26#8=#0#0;              || nombre cliente
          #26#9 = #24#20; ||FP
          #26#14=#0#3;             || direccion de entrega
          #26#20=#0#4;             || poblacion
          #26#21=#0#7;             || provincia
          #26#19=#0#0;             || entregar a


          #26#5  = #24#37;      || dto especial
          #26#17 = #24#156;     || dto acumulado
          #26#6  = #24#38;      || dto PP
          #26#37 = #24#193;     || moneda de trabajo
          #26#22 = #24#47;      || Recargo E.
          #26#64 = #24#15;
          |ABRE #324;           || ver el valor de cambio
          |DDEFECTO #324;
          #324#0=#26#35;  || antes ponia #324#0=#24#192
          |LEE 000#324=;
          |SI FSalida=nCero;
               #26#36=#324#2;
          |FINSI;
          |CIERRA #324;
          |CIERRA #24;
     |FINSI;

     || crear lineas de pedidos
     || en la variable nImporteTotal estara el total del pedido que
     || habra que guardar en la cabecera del pedido
     nImporteTotal=nCero;
     |ABRE #27;
     |BUCLE BMeteLineasPedido;
     |LIBERA #27;
     |CIERRA #27;


     || parte B de las cabecer del pedido, los importes
     || importes totales, aqui esta el tema1
     #26#11=nImporteTotal;    || importe en moneda de cliente
     #26#12=nImporteTotal;
     |SI #321#9=#24#192;
          #26#42=nImporteTotal;
          #26#43=nImporteTotal;
     |SINO;
          #26#42=nImporteTotal / nCambioBase * #26#36;    || en divisas
          #26#43=nImporteTotal / nCambioBase * #26#36;
     |FINSI;

     |SI #24#193 = "D";
          #26#45 = #26#42;
          #26#46 = #26#43;

          #26#48 = #26#11;
          #26#50 = #26#13;
     |SINO;
          #26#45 = #26#11;
          #26#46 = #26#12;

          #26#48 = #26#42;
          #26#50 = #26#44;
     |FINSI;

     |GRABA 020#26a;
     |LIBERA #26;
     |CIERRA #26;

     |SI PedidMod = 0;
          |ABRE #porconrp;
          |LEE 101#porconrp.p;
          |SI FSalida = 0;
               |SI nEsPedido=1;  || depende de si es pedido o presupuesto
                    #porconrp#10 = nNumeroPedido +1;
               |SINO;
                    #porconrp#11 = nNumeroPedido +1;
               |FINSI;
               |GRABA 020#porconrp.a;
               |LIBERA #porconrp;
          |FINSI;
          |CIERRA #porconrp;
     |FINSI;

     |DELINDEX #4;

     |SI nEsPedido=1;
          |CONFI "00000Pedido Generado, Deseas Imprimirlo?";
     |SINO;
          |CONFI "00000Presupuesto Generado, Deseas Imprimirlo?";
     |FINSI;

     |SI FSalida=nCero;
          ser_ped = #26#25;
          num_ped = #26#0;
          |SUB_EJECUTA_NP "agifa105.run;marhv104";
     |FINSI;
     |POPV;
|FPRC;

/*
|PROCESO PMeteLineasPresupuesto;
     nIva=nCero;
     |ABRE #66;     || % iva
     #66#0=#47#11;
     |LEE 000#66=;
     |CIERRA #66;
     nIva=#66#2;

     |DDEFECTO #47;
     #47#20=aSerie;
     #47#0=nNumeroPresupuesto;
     #47#1=#4#0;         || linea
     #47#2=#4#1;         || articulo
     #47#4=#4#6;         || descripcion articulo
     #47#5=#4#2;         || unidades
     #47#8=#4#4;         || descuento
     #47#10=#4#3;        || comision
     #47#28=#4#2;        || unidades pedidas


     || precios e importes, aqui esta el tema2
     #47#6=#4#5;         || precio
     #47#24=#4#5 / nCambioBase *#46#66;

     |SI #24#193 = "D";                    || Si la moneda de trabajo es la divisa ...
          #47#6 = #47#24 / #46#66 * nCambioBase;  || ... recalculo precio en funcion de la divisa
          #47#26 = #47#6;                  || ... el campo visualiz. es el precio en moneda base
     |SINO;
          #47#26=#47#24;
     |FINSI;

     || calcular importes, teniendo en cuenta los porcentajes
     nAux=#4#2 * #47#6;
     #47#7=nAux - ( nAux % #4#4) ;

     nAux=#4#2 * #47#24;
     #47#25=nAux - (nAux % #4#4);

     nAux=#4#2 * #47#26;
     #47#27=nAux - (nAux  % #4#4);

     nAux=#4#2 * #47#26;
     #47#27=nAux - (nAux  % #4#4);

     nTotalBruto=nTotalBruto+#47#7;  || en vez de #47#7
     nTotalFactura=nTotalFactura+ #47#7 + #47#7*(nIva/100);
     #47#9=#47#7;

     |GRABA 020#47n;
|FPRC;


|DEFBUCLE BMeteLineasPresupuesto;
     #4#1;
     ;
     nCero;
     999;
     ;
     NULL,PMeteLineasPresupuesto;
|FIN;


|PROCESO CrearPresupuesto;
     |PUSHV 0501 2380;

     |ABRE #6;    || pedir el numero de serie
     |PINPA #0#6;
     |PINDA #0#6;
     |ENDATOS #1#6;
     aSerie=#6#0;

     |SI FSalida=nCero;
          aSerie=#6#0;
          |ABRE #46;
          #46#48=aSerie;
          #46#0=999999;
          |LEE 000#46];   || lee el mayor o igual
          |SI FSalida=nCero;
               |LEE 000#46a;
          |SINO;
               |LEE 000#46u;
          |FINSI;

          |SI FSalida=nCero; |Y #46#48=aSerie;
               nNumeroPresupuesto=#46#0+1;
          |SINO;
               nNumeroPresupuesto=1;
          |FINSI;

          || ver monedas base y de cliente

          |ABRE #321;    || para saber la moneda base
          |LEE 000#321p; || en #321#9 esta la moneda base
          |CIERRA #321;

          |ABRE #324;    || tipo de cambio para la moneda base
          #324#0=#321#9; || en #324#2 esta el cambio de la moneda base
          |LEE 000#324=;
          |CIERRA #324;
          nCambioBase=#324#2;



          || crear cabecera del presupuesto
          |DDEFECTO #46;
          #46#48=aSerie;
          #46#0=nNumeroPresupuesto;
          #46#3=#0#15;             || cliente
          #46#4=#0#0;              || nombre cliente
          #46#30=#0#3;             || direccion de entrega
          #46#31=#0#4;             || poblacion
          #46#33=#0#7;             || provincia
          #46#29=#0#0;             || entregar a

          |ABRE #24;
          #24#0=#0#15;
          |LEE 000#24=;
          |SI FSalida=nCero;
               #46#5=#24#37;       || dto especial
               #46#32=#24#156;     || dto acumulado
               #46#7=#24#38;       || dto PP
               #46#67=#24#193;     || moneda de trabajo
               #46#65=#24#192;     || divisa

               |ABRE #324;         || ver el valor de cambio
               #324#0=#24#192;
               |LEE 000#324=;
               |SI FSalida=nCero;
                    #46#66=#324#2;
               |FINSI;
               |CIERRA #324;
          |FINSI;
          |CIERRA #24;

          || crear lineas de presupuesto
          || en la variable nImporteTotal estara el total del prespuesto que
          || habra que guardar en la cabecera del presupuesto
          nTotalBruto=nCero;
          nTotalFactura=nCero;
          |ABRE #47;
          |BUCLE BMeteLineasPresupuesto;
          |LIBERA #47;
          |CIERRA #47;

          || parte B de las cabecer del presupuesto, los importes
          || importes totales, aqui esta el tema1

          #46#15=nTotalBruto;   || importe en moneda de cliente, total Bruto

          nAux=nTotalFactura - (nTotalFactura  % #24#37);       || dto especial
          nAux=nAux - ( nAux % #24#156);  || dto acumulado
          nAux=nAux - ( nAux % #24#38);   || dto PP
          nTotalFactura=nAux;

          #46#41=nTotalFactura;


          |SI #321#9=#24#192;
               #46#70=nTotalBruto;  || DIV Bruto
               #46#71=nTotalFactura;  || DIV Fact con iva y descuentos
          |SINO;
               #46#70=nTotalBruto / nCambioBase * #46#66;    || en divisas
               #46#71=nTotalFactura / nCambioBase * #46#66;
          |FINSI;

          |SI #24#193 = "D";
               #46#72 = #46#70;
               #46#73 = #46#71;
               #46#74 = #46#15;
               #46#75 = #46#41;
          |SINO;
               #46#72 = #46#15;
               #46#73 = #46#41;
               #46#74 = #46#70;
               #46#75 = #46#71;
          |FINSI;

          |GRABA 020#46n;
          |LIBERA #46;
          |CIERRA #46;

          |MENAV "0000Presupuesto Generado";
     |FINSI;
     |CIERRA #6;
     |POPV;
|FPRC;
*/

|PROCESO BuscaMaximoDescuento;
     nLineaMaxDtoC = -1;  ||Linea de descuento del cliente inicial
     nLineaMaxDto  = 0;   ||Linea maximo de dto de la tabla
     nMaxDto       = 0;
     nDescuento    = 0;
     nComision     = 0;

     |ABRE #8;               ||Buscar el grupo de descuento del articulo
     #8#0 = nCodArt;
     |LEE 000#8=;
     |SI FSalida = 0;
          |ABRE #9;          ||Buscar el grupo de descuento del cliente
          #9#0 = nCodCli;
          #9#3 = #8#1;
          |LEE 000#9=;
          |SI FSalida = 0;
               nLineaMaxDtoC = #9#2;
          |FINSI;
          |ABRE #7;          ||Abrir el grupo de descuento para ver la tabla
          #7#0 = #8#1;
          |LEE 000#7=;
          |SI FSalida = 0;
               |ABRE #129;   ||Abrir la tabla descuento-comision
               |SI aAutonomo = "S";
                    #129#0 = #7#3;
               |SINO;
                    #129#0 = #7#2;
               |FINSI;
               |LEE 000#129=;
               |SI FSalida = 0;
                    |SI #129#1  ! 0; nLineaMaxDto = 1; |FINSI;
                    |SI #129#3  ! 0; nLineaMaxDto = 2; |FINSI;
                    |SI #129#5  ! 0; nLineaMaxDto = 3; |FINSI;
                    |SI #129#7  ! 0; nLineaMaxDto = 4; |FINSI;
                    |SI #129#9  ! 0; nLineaMaxDto = 5; |FINSI;
                    |SI #129#11 ! 0; nLineaMaxDto = 6; |FINSI;
                    |SI #129#13 ! 0; nLineaMaxDto = 7; |FINSI;
                    ||_________Maximo descuento aplicable...
                    |SI nLineaMaxDto = 1; nMaxDto = #129#1;  |FINSI;
                    |SI nLineaMaxDto = 2; nMaxDto = #129#3;  |FINSI;
                    |SI nLineaMaxDto = 3; nMaxDto = #129#5;  |FINSI;
                    |SI nLineaMaxDto = 4; nMaxDto = #129#7;  |FINSI;
                    |SI nLineaMaxDto = 5; nMaxDto = #129#9;  |FINSI;
                    |SI nLineaMaxDto = 6; nMaxDto = #129#11; |FINSI;
                    |SI nLineaMaxDto = 7; nMaxDto = #129#13; |FINSI;
                    ||_________No tiene configurado el cliente el maximo Limite
                    |SI nLineaMaxDtoC = -1;
                         nLineaMaxDtoC = nLineaMaxDto;
                    |FINSI;
                    ||_________Descuento inicial para el cliente...
                    |SI nLineaMaxDtoC = 1; nDescuento = #129#1;  |FINSI;
                    |SI nLineaMaxDtoC = 2; nDescuento = #129#3;  |FINSI;
                    |SI nLineaMaxDtoC = 3; nDescuento = #129#5;  |FINSI;
                    |SI nLineaMaxDtoC = 4; nDescuento = #129#7;  |FINSI;
                    |SI nLineaMaxDtoC = 5; nDescuento = #129#9;  |FINSI;
                    |SI nLineaMaxDtoC = 6; nDescuento = #129#11; |FINSI;
                    |SI nLineaMaxDtoC = 7; nDescuento = #129#13; |FINSI;
               |FINSI;
                    |CIERRA #129;
          |FINSI;
          |CIERRA #7;
          |CIERRA #9;
     |FINSI;
     |CIERRA #8;
|FPRC;

|PROCESO CalculaComision;
     nComision = nMenos1;
     || buscar comision correspondiente para #5#1
     |SI #129#13 ] nDescuento;  nComision = #129#14; |FINSI;
     |SI #129#11 ] nDescuento;  nComision = #129#12; |FINSI;
     |SI #129#9  ] nDescuento;  nComision = #129#10; |FINSI;
     |SI #129#7  ] nDescuento;  nComision = #129#8;  |FINSI;
     |SI #129#5  ] nDescuento;  nComision = #129#6;  |FINSI;
     |SI #129#3  ] nDescuento;  nComision = #129#4;  |FINSI;
     |SI #129#1  ] nDescuento;  nComision = #129#2;  |FINSI;

     |SI nComision = nMenos1;
          || maximo descuento aplicable
          |SI nLineaMaxDto = 1; nComision = #129#2;  |FINSI;
          |SI nLineaMaxDto = 2; nComision = #129#4;  |FINSI;
          |SI nLineaMaxDto = 3; nComision = #129#6;  |FINSI;
          |SI nLineaMaxDto = 4; nComision = #129#8;  |FINSI;
          |SI nLineaMaxDto = 5; nComision = #129#10; |FINSI;
          |SI nLineaMaxDto = 6; nComision = #129#12; |FINSI;
          |SI nLineaMaxDto = 7; nComision = #129#14; |FINSI;
     |FINSI;
|FPRC;


|PROCESO PulsaOkAnyadirA;
     |PTEC 815;
|FPRC;

|PROCESO PulsaCancAnyadirA;
     |PTEC 807;
|FPRC;


|PROCESO PonBotonesAnyadirA;
     |CONTROL_SIMPLE 0, "BOTON,OK", 1829, 1839, PulsaOkAnyadirA;
     nBotonx1 = FSalida;
     |CONTROL_SIMPLE 0, "BOTON,Cancelar", 1841, 1851, PulsaCancAnyadirA;
     nBotonx2 = FSalida;
|FPRC

|PROCESO QuitaBotonesAnyadirA;
     |FIN_CONTROL_WINDOWS nBotonx1;
     |FIN_CONTROL_WINDOWS nBotonx2;
     |PULSATECLA;
|FPRC;

|PROCESO PulsaOkClave;
     |PTEC 806;
|FPRC;

|PROCESO PulsaCancelarClave;
     |PTEC 807;
|FPRC;

|PROCESO PonBotonesClave;
     |CONTROL_SIMPLE 0, "BOTON,OK", 2025, 2035, PulsaOkClave;
     nBotonx1 = FSalida;
     |CONTROL_SIMPLE 0, "BOTON,Cancelar", 2045, 2055, PulsaCancelarClave;
     nBotonx2 = FSalida;
|FPRC;

|PROCESO QuitaBotonesClave;
     |FIN_CONTROL_WINDOWS nBotonx1;
     |FIN_CONTROL_WINDOWS nBotonx2;
     |PULSATECLA;
|FPRC;

|PROCESO BuscaPosicionTabla;
          nLugar=-1;
          |SI #129#13]nDescuento;  nLugar=7; |FINSI;
          |SI #129#11]nDescuento;  nLugar=6; |FINSI;
          |SI #129#9]nDescuento;   nLugar=5; |FINSI;
          |SI #129#7]nDescuento;   nLugar=4; |FINSI;
          |SI #129#5]nDescuento;   nLugar=3; |FINSI;
          |SI #129#3]nDescuento;   nLugar=2; |FINSI;
          |SI #129#1]nDescuento;   nLugar=1; |FINSI;
|FPRC;


|PROCESO CalculaDescuento;
     |SI nLugar = 1; nDescuento = #129#1; |FINSI;
     |SI nLugar = 2; nDescuento = #129#3; |FINSI;
     |SI nLugar = 3; nDescuento = #129#5; |FINSI;
     |SI nLugar = 4; nDescuento = #129#7; |FINSI;
     |SI nLugar = 5; nDescuento = #129#9; |FINSI;
     |SI nLugar = 6; nDescuento = #129#11; |FINSI;
     |SI nLugar = 7; nDescuento = #129#13; |FINSI;
|FPRC;

|PROCESO CompruebaRedondeo; || si no es multiplo decremento el dto
     nNume1=#5#0;
     nNume2=#3#20;
     nAux=nNume1 $ nNume2;
     |SI nAux!nCero;  || no es multiplo, decrementar descuento
          |HAZ BuscaPosicionTabla;
          |SI nLugar=-1;
               #5#0=0;
          |SINO;
               nLugar=nLugar-1;
               |HAZ CalculaDescuento;
          |FINSI;
          #5#1=nDescuento;
     |FINSI;
|FPRC;

|PROCESO por00004;
     aArtPor4 = #por00004#1;
     |QBF aArtPor4;
     |SI aArtPor4 = aArtSel;
          nLinArt = #por00004#0;
          nSwEstaArt = 1;
          |ERROR10;
     |FINSI;
|FPRC;

|DEFBUCLE por00004;
 #por00004#1;
 ;
 INICIO;
 FINAL;
 ;
 NULL, por00004;
|FIN;


|PROCESO &PideSel;
     aAlfa = aArtSelect;
     |QBF aAlfa;
     |SI aAlfa ! "";
          |HAZ AnyadeArtTempo;
     |FINSI;
     aArtSelect = "";
|FPRC;

|PROCESO AnyadeArticuloTemporal;
     |PUSHV 0501 2380;
/*
     IvPopup = vPopup1<-;
     vPopup1 = "1024";
     vPopup2 = "1969";
     vPopup3 = "0001";
     vPopup4 = "PEDIR";
     |ESPECIFICA "POPUPMODE",vPopup;
*/


     #25#0 = #3#0;
     |LEE 000#25=;
     nUnidades = #25#15;
     |HAZ Genera2Letras;
     #5#2 = aLetras1;
     #5#3 = aLetras2;

     || se hace para que en el endatos de pedir unidades y descuento,
     || se sepan los datos que necesitamos, como nLineaMaxDto y tabla
     || dto-comision

     nCodCli = #0#15;
     nCodArt = #3#0;
     #3#25   = 0;
     |HAZ PreCliArt;
     |SI #3#25 ! 0;
          nSwOfer = 1;
     |SINO;
          nSwOfer = 0;
     |FINSI;

     |HAZ PreCliArt;

     aArticulo = #3#0;
     |ABRE #5;
     #5#0 = nUnidades;

     |SI #3#17 = 0;   || si no tiene precio cliente-articulo
          #5#1 = nDescuento;
     |SINO;
          #5#1 = #3#18;
     |FINSI;

     |BLANCO 1125 2070;
     |PINPA #0#5;
     |PINDA #0#5;

     |ET EtPideUnidades;

     |HAZ PonBotonesAnyadirA;

     |PULSATECLA;

     |ENDATOS #2#5;
     nSalida = FSalida;
     |HAZ QuitaBotonesAnyadirA;


     |SI nSalida = 0;
          nDescuento = #5#1;

          |SI #5#0 < nUnidades;
               |MENAV "0000No puedes pedir menos unidades que el limite!";
               |VETE EtPideUnidades;
          |SINO;
               |SI #5#0 = 0;
                    |MENAV "0000Tienes que introducir 1 unidad por lo menos!";
                    |VETE EtPideUnidades;
               |FINSI;
          |FINSI;

          || comprueba si el num unid es multiplo de unidades embalaje
          |HAZ CompruebaRedondeo; || si no es multiplo decremento el dto

          || controlar que no se pase del maximo ya que no tenia descuento
          || cliente-articulo y buscar la comision
          ||ARA3
          ||HAZ CalculaComision; || en nComision la tenemos

          enUniMarhu = #agifa073#5;
          eaCliente = #por00001#15;
          eaRepre = #porconrp#0;
          eaArticulo = #por00003#0;
          eaSerie = aSerie;
          efFecha = ~;
          |HAZ ComiMarhu;
          nComision = enComision;


          |SI nDescuento = #3#18;
               |SI #3#19!nCero;  || si no hemos variado el dto, la comision que tenia
                    nComision=#3#19;
               |FINSI;
          |FINSI;

          |SI nDescuento = nMaxDto; |Y nDescuento!nCero;
               |PUSHV 0501 2380;

               |HAZ GeneraCodigoSecreto;
               |DDEFECTO #10;
               #10#0=nCodigoSecreto;

               |HAZ PonBotonesClave;
               |PINPA #0#10;
               |PINDA #0#10;
               |ENDATOS #1#10;
               |SI FSalida=nCero;
                    |HAZ QuitaBotonesClave;

                    nClaveSecreta=#10#1;
                    |HAZ CompruebaCodigoSecreto;

                    |SI nSeguir!nCero;
                         |MENAV "0000La Clave no se corresponde con el Codigo!";
                         |POPV;
                         |VETE EtPideUnidades;
                    |FINSI;
                    |POPV;
               |SINO;
                     |HAZ QuitaBotonesClave;
                     |POPV;
                    |VETE EtPideUnidades;
               |FINSI;

          |FINSI;

          |SI nDescuento>nMaxDto;
               |MENAV "0000No puedes aplicar mas del asignado!";
               |VETE EtPideUnidades;
          |FINSI;
          ||TODO CCC
          ||Ahora compruebo si el articulo a introducir ya esta introducido
          ||en tal caso sacar este menu: [Sustituir]  [Anyadir]  [Cancelar]
          aArtSel = #3#0;
          |QBF aArtSel;
          nSwEstaArt = 0;
          nLinArt = 0;
          |BUCLE por00004;
          |SI nSwEstaArt = 1;
               |PINTA 1727, "- Articulo ya incluido en Pedido -";
               |HAZ PonBotArt;
               |LEETECLA aTecla2;
               aTecla2 = aTecla2 % 203;
               |SI aTecla2 = 815;
                    nSwModoAlta = 2;         ||Sustituir
               |SINO;
                    |SI aTecla2 = 816;
                         nSwModoAlta = 1;    ||A¤adir
                    |SINO;
                         nSwModoAlta = 0;    ||No hacer nada
                    |FINSI;
               |FINSI;
               |PINTA 1727, "                                  ";
               |HAZ QuitaBotArt;
          |SINO;
               nSwModoAlta = 3;    ||Crear nuevo;
          |FINSI;

          |SI nSwModoAlta = 3;     ||Crear nuevo en Temporal
               |ABRE #4;
               |LEE 101#4u;
               |SI FSalida=nCero;
                    nUltimo=#4#0+1;
               |SINO;
                    nUltimo=1;
               |FINSI;

               |DDEFECTO #4;
               #4#0=nUltimo;
               #4#1=#3#0;
               #4#2=#5#0;
               ||ARA3
               #4#3=nComision;     || comision
               #4#4=nDescuento;     || descuento
               #4#6=#3#1;
               #4#5=#3#11;

               |GRABA 020#4n;
               |LIBERA #4;
               |CIERRA #4;
          |SINO;
               |SI nSwModoAlta = 2;
                    |ABRE #4;
                    #4#0 = nLinArt;
                    |LEE 101#por00004.=;
                    |SI FSalida = 0;
                         #4#1=#3#0;
                         #4#2=#5#0;
                         #4#3=nComision;      || comision
                         #4#4=nDescuento;     || descuento
                         #4#6=#3#1;
                         #4#5=#3#11;
                         |GRABA 020#4a;
                         |LIBERA #4;
                    |FINSI;
                    |CIERRA #4;
               |SINO;
                    |SI nSwModoAlta = 1;
                         |ABRE #4;
                         #4#0 = nLinArt;
                         |LEE 101#por00004.=;
                         |SI FSalida = 0;
                              #4#1=#3#0;
                              #4#2=#4#2 + #5#0;
                              #4#3=nComision;     || comision
                              #4#4=nDescuento;     || descuento
                              #4#6=#3#1;
                              #4#5=#3#11;
                              |GRABA 020#4a;
                         |LIBERA #4;
                         |FINSI;
                         |CIERRA #4;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
     |CIERRA #5;
/*
     IvPopup = vPopup1<-;
     |ESPECIFICA "FIN_POPUPMODE",vPopup;
*/
     |POPV;
|FPRC;


|PROCESO PBuscaClientes;
     aCad1=#24#1;
     |QBF aCad1;
     aCad1=aCad1 > "";
     aCad2=#0#0;
     |QBF aCad2;
     aCad2=aCad2 > "";
     aCad3=aCad1 - aCad2;
     |QBF aCad3;


     aCad4=#24#6;
     |QBF aCad4;
     aCad4=aCad4 > "";
     aCad5=#0#1;
     |QBF aCad5;
     aCad5=aCad5 > "";
     aCad6=aCad4 - aCad5;
     |QBF aCad6;

     |SI aCad2=""; aCad3="x"; |FINSI;
     |SI aCad5=""; aCad6="x"; |FINSI;


     |SI aCad1 ! aCad3; |Y aCad4 ! aCad6;
          |DDEFECTO #2;
          #2#0=#24#0;
          #2#1=#24#1;
          #2#2=#24#6;
          #2#3=#24#2;
          #2#4=#24#5;
          #2#5=#24#6;
          #2#6=#24#178;
          #2#7=#24#179;
          #2#8=#24#7;
          #2#9=#24#8;
          #2#10=#24#9;
          #2#11=#24#181;
          #2#12=#24#182;
          #2#13=#24#10;
          #2#14=#24#15;
          #2#15=#24#17;

          |GRABA 020#2n;
     |FINSI;
|FPRC;

|DEFBUCLE BBuscaClientesP;
     #24#6;
     ;
     INICIO;
     FINAL;
     f;
     NULL,PBuscaClientes;
|FIN;

|DEFBUCLE BBuscaClientesN;
     #24#2;
     ;
     INICIO;
     FINAL;
     f;
     NULL,PBuscaClientes;
|FIN;

|PROCESO ConsultaClientes;
     aCad2=#0#0;
     |QBF aCad2;
     aCad5=#0#1;
     |QBF aCad5;
     |SI aCad5 = "";|Y aCad2 = "";
             |ABRE #24;
             |CONSULTA_CLAVE #2#24;
          |SI FSalida=nCero;
                  nSeguir=nCero;
               |DDEFECTO #2;
               #2#0=#24#0;
               #2#1=#24#1;
               #2#2=#24#6;
               #2#3=#24#2;
               #2#4=#24#5;
               #2#5=#24#6;
               #2#6=#24#178;
               #2#7=#24#179;
               #2#8=#24#7;
               #2#9=#24#8;
               #2#10=#24#9;
               #2#11=#24#181;
               #2#12=#24#182;
               #2#13=#24#10;
               #2#14=#24#15;
               #2#15=#24#17;
             |SINO;
            nSeguir=-1;
             |FINSI;
             |CIERRA #24;
     |SINO;
          |DELINDEX #2;
          |ABRE #2;
          |SI aCad2 ! "";
               FSalida = aCad2;
               |BUCLE BBuscaClientesN;    || buscamos en todos los clientes
          |SINO;
               FSalida = aCad5;
               |BUCLE BBuscaClientesP;    || buscamos en todos los clientes
          |FINSI;

          |LEE 000#2p;
          |SI FSalida!nCero;
               |MENAV "0000No Existen Clientes con esas Caracteristicas!";
               nSeguir=nMenos1;
          |SINO;
               |CONSULTA_CLAVE #1#2;
               nSeguir=FSalida;
          |FINSI;

          |CIERRA #2;
     |FINSI;

     |SI nSeguir=nCero;
          #0#0=#2#1;
          #0#1=#2#2;
          #0#2=#2#3;
          #0#3=#2#4;
          #0#4=#2#5;
          #0#5=#2#6;
          #0#6=#2#7;
          #0#7=#2#8;
          #0#8=#2#9;
          #0#9=#2#10;
          #0#10=#2#11;
          #0#11=#2#12;
          #0#12=#2#13;
          #0#13=#2#14;
          #0#14=#2#15;
          #0#15=#2#0;

          |PINDA #0#0;

          aClienteSuper=#0#15;
     |SINO;
          aClienteSuper="";
     |FINSI;
|FPRC;

|PROCESO Tipo12; |TIPO 12;
|| tipo 12, para que al terminar con una ficha, no pregunte SI o NO
|FPRC;


|PROCESO ConsultaArticulos;
     |ABRE #3;

     |ET EtPideArticulo;

     |DDEFECTO #3;
     |PINDA #0#3;
     |ENDATOS #1#3;
     |SI FSalida=nCero;
          aCad1=#3#0;
          |QBF aCad1;
          |SI aCad1="";
               |CONFI "00000No has seleccionado ningun Articulo, Quieres Seleccionarlo?";
               |SI FSalida=nCero;
                    nSeguir=nMenos1;
                    |VETE EtPideArticulo;
               |SINO;
                    nSeguir=nCero;
               |FINSI;
          |FINSI;
     |SINO;
          nSeguir=-3;
     |FINSI;
     |CIERRA #3;
|FPRC;

|PROCESO PulsaOkCliente;
     |PTEC 806;
|FPRC;

|PROCESO PulsaCancelarCliente;
     |PTEC 807;
|FPRC;

|PROCESO PonBotonesCliente;
     |CONTROL_SIMPLE 0, "BOTON,OK", 2303, 2313, PulsaOkCliente;
     nBotonx51 = FSalida;
     |CONTROL_SIMPLE 0, "BOTON,Cancelar", 2315, 2325, PulsaCancelarCliente;
     nBotonx52 = FSalida;
|FPRC;

|PROCESO QuitaBotonesCliente;
     |FIN_CONTROL_WINDOWS nBotonx51;
     |FIN_CONTROL_WINDOWS nBotonx52;
     |PULSATECLA;
|FPRC;


|PROCESO EsClienteNuevo;
     || miramos si es cliente nuevo o no
     |ABRE #33;
     #33#0=#0#15;
     |LEE 000#33=;
     |SI FSalida=0;
          aClienteAntiguo="N";
     |SINO;
          aClienteAntiguo="S";
     |FINSI;
     |CIERRA #33;
|FPRC;


|PROCESO SeleccionaClientes;
               || solo se permite consultar clientes si no venimos de consulta clientes
               aCad1=#0#15;
               |QBF aCad1;
               |SI aCad1!"";
                    |HAZ EsClienteNuevo;
                    |SI aClienteAntiguo="S";
                         |SUB_EJECUTA "porm0001;DesdeMenuAntiguos";
                         |HAZ DibuCliAnt;
                    |SINO;
                         |SUB_EJECUTA "porm0001;DesdeMenuNuevos";
                         |HAZ DibuCliNue;
                    |FINSI;
                    |PINDA #0#0;
               |SINO;
                    nEsPedido=nEsPedidoAux;
                    aNombreAux=#0#0;
                    aCodigoAux=#0#15;
                    aPoblacionAux=#0#1;


                    |HAZ PonBotonesCliente;
                    |DDEFECTO #0;
                    |PINDA #0#0;
                    |ENDATOS #1#0;
                    |SI FSalida=nCero;
                         |HAZ ConsultaClientes;

                         |SI nSeguir=nCero;

                              || borra las lineas de pedido creadas
                              |DELINDEX #4; || borrar para que no haya problemas luego
                              aMensaje = "00000Es Pedido (Si)" + &13 + "Es Presupuesto (No)?";
                              |CONFI aMensaje;
                              |SI FSalida=0;
                                   nEsPedido=1;
                              |SINO;
                                   nEsPedido=nCero;
                              |FINSI;
                              nSeguir=0;
                         |SINO;
                              nSeguir=-1;
                         |FINSI;
                    |SINO;
                         nSeguir=-1;
                    |FINSI;


                    |HAZ QuitaBotonesCliente;

                    nImagen=nMenos1;
                    |HAZ PonArt;
                    nImagen=nCero;

                    |SI nSeguir=-1;
                         nEsPedido=nEsPedidoAux;
                         #0#0=aNombreAux;
                         #0#15=aCodigoAux;
                         #0#1=aPoblacionAux;
                         |PINTA #0#0;
                         |PINTA #0#1;
                    |SINO;
                         |HAZ MenuArticulos;
                    |FINSI;
               |FINSI;
|FPRC;

|PROCESO DecimalesMoneda;
  |ABRE #agifa324;
  #agifa324#0 = #225#165;
  |LEE 001#agifa324.=;
  nDeci_PreDiv = #agifa324#9;
  |ABRE #agifa321;
  |LEE 001#agifa321.p;
  #agifa324#0 = #agifa321#9; ||Igualo a moneda base
  |LEE 001#agifa324.=;
  nDeci_Base = #agifa324#7;  ||Decimales moneda base
  nDeci_PreBase = #agifa324#9;  ||Decimales precio de moneda base
  |CIERRA #agifa321;
  |CIERRA #agifa324;
|FPRC;

|PROCESO PulsaOkMasDatosA;
     |PTEC 802;
|FPRC;

|PROCESO PonBotonesMasDatosA;
     |CONTROL_SIMPLE 0, "BOTON,OK", 2209, 2219, PulsaOkMasDatosA;
     nBotonx1 = FSalida;
|FPRC;

|PROCESO QuitaBotonesMasDatosA;
     |FIN_CONTROL_WINDOWS nBotonx1;
     |PULSATECLA;
|FPRC;

|PROCESO MuestraMasDatosArticulo;
     |PUSHV 0501 2327;
     #225#0 = #3#0;
     |LEE 000#225=;
     |HAZ DecimalesMoneda;
     #19#0=#225#9;       || precio coste medio
     #19#1=#225#15;      || pte.servir
     #19#2=#225#16;      || pte.recibir
     #19#3=#225#6;       || stock
     #19#4=#225#27;      || ultimo proveedor
     #19#5=#225#28;      || ultimo precio compra sin dto.
     #19#6=#225#133;     || ultimo precio compra con dto.
     #19#7=#225#165;     || divisa u.p.c.
     #19#8=#225#163;     || ultimo precio compra sin dto. (divisa)
     #19#9=#225#164;     || ultimo precio compra con dto. (divisa)
     #19#10=#225#29;     || ultimo descuento compra 1
     #19#11=#225#129;    || ultimo descuento compra 2
     #19#12=#225#26;     || ultima fecha compra
     #19#13=#225#24;     || ultima fecha venta
     #19#14=#225#25;     || unidades ultima venta
     #19#15=#225#99;     || total Ventas A¤o Anterior
     #19#16=#225#93;
     #19#17=#225#94;     || total Ventas A¤o Actual
     #19#18=#225#95;
     #19#19=#225#96;
     #19#20=#225#101;
     #19#21=#225#19;     || tarifa-2
     #19#22=#225#200;    || grupo
     #19#23=#225#102;    || peso
     #19#24=#225#199;    || fecha alta

     |HAZ PonBotonesMasDatosA;

     |PINPA #0#19;
     |PINDA #0#19;
     |PAUSA;

     |HAZ QuitaBotonesMasDatosA;

     |POPV;
|FPRC;



|PROCESO EsUltimo;
     nSeguir=nCero;
     |LEE 000#25u;
     |SI FSalida=nCero;
          |SI #25#0=#3#0;
               nSeguir=nMenos1;
          |FINSI;
     |SINO;
          nSeguir=nMenos1;
     |FINSI;
|FPRC;



|PROCESO ArticulosAutomaticos;
     |ABRE #21;
     |LEE 101#21p;
     |SI FSalida!nCero;
          |MENAV "0000Debes configurar el Tiempo del reloj!";
     |SINO;
          |HAZ PintaRegistroActual;
          nNumero=#21#1;

          |PARA ;|SI ; |HACIENDO;
               |SLEEP nNumero;
               |PTEC 808;
               |PULSATECLA;

               |SI FSalida=812;  || tecla "Inicio"
                    |HAZ ArtPrim;
                    |HAZ PintaRegistroActual;
               |SINO;
                    |SI FSalida!nMenos1;
                         |SAL;
                    |SINO;
                         nSeguir = 0;
                         |HAZ ArticuloSiguiente;
                         |SI nSeguir!nCero;
                              |SAL;
                         |FINSI;
                         |HAZ PintaRegistroActual;

                         |HAZ EsUltimo;
                         |SI nSeguir!nCero;
                              |SAL;
                         |FINSI;
                    |FINSI;
               |FINSI;
          |SIGUE;
     |FINSI;
     |CIERRA #21;
|FPRC;


|PROCESO ConfigurarRelojMas;
     |ABRE #21;
     |DDEFECTO #21;
     |LEE 101#21p;
     nExiste=FSalida;
     |SI nExiste=nCero;
          #21#1=#21#1+1;
          |GRABA 020#21a;
     |SINO;
          #21#1=1;
          |GRABA 020#21n;
     |FINSI;

     |LIBERA #21;
     |CIERRA #21;

     |HAZ PonReloj;
|FPRC;


|PROCESO ConfigurarRelojMenos;
     |ABRE #21;
     |DDEFECTO #21;
     |LEE 101#21p;
     nExiste=FSalida;
     |SI nExiste=nCero;
          |SI #21#1>1;
               #21#1=#21#1-1;
               |GRABA 020#21a;
          |FINSI;
     |SINO;
          #21#1=1;
          |GRABA 020#21n;
     |FINSI;

     |LIBERA #21;
     |CIERRA #21;

     |HAZ PonReloj;
|FPRC;

|PROCESO ObtieneArticuloElegido;
     nHandle=1;
     |XABRE "C",aFicheroArtElegido,nHandle;
     |SI FSalida=0;
          |XLEE nHandle, 20, aCad0;
          |SI FSalida ] 0;
               #3#0=aCad0;
               |HAZ PonArt;
          |FINSI;
          |XCIERRA nHandle;
     |FINSI;
|FPRC;

|PROCESO Especifica;
|VARIABLES;
     {-1}pvisual = "";
     dll = "dsimagen.dll";
     mortrar = "0";
|FIN;
Ipvisual = dll<-;
aArtSelect="";
|ESPECIFICA "INTERFACE_VISUAL",pvisual;
|FPRC;

|PROCESO &LeeArticulo;
     aCad1 = aArticulo;
     |QBF aCad1;
     |SI aCad1 ! "";
          #3#0 = aArticulo;
          nSwVic = 1;
          |HAZ PonArt;
          nSwVic = 0;
          |LEE 000#3=;
          aDescArt = #3#1;
          ||TODO CCC
          ||ARA4
          |SI nOpre = 1;
               nPesetas = #3#24;
               nEuros   = #3#11;
          |SINO;
               nPesetas = 0;
               nEuros   = 0;
          |FINSI;
          ||nPesetas = #3#11;
          ||nEuros   = #3#24;
          nStock   = #3#2;
          |HAZ DamePathA;
     |FINSI;
|FPRC;


|PROCESO &DamePathA;
     aAlfa1 = aRruI;
     aBlanco = aAlfa1;
     aInicialImagen = aArticulo % 101;
     aAlfa1  = aAlfa1 + aInicialImagen;
     aAlfa1  = aAlfa1 + "\" + aArticulo + ".jpg";
     aPathImagen = aAlfa1;
|FPRC;
/* */

|PROCESO Saca9Imagenes;
  |ET jVic;
     |HAZ Especifica;
     aCad1 = aArtSelect;
     |QBF aCad1;
     |SI aCad1 ! "";
          aArtDefecto = aArtSelect;
          |HAZ QuitaReloj;
          aEstadoBoton="HIDE";
          |HAZ EstadoBotonesArt;
          |HAZ AnyadeArtTempo;
          aEstadoBoton="SHOW";
          |HAZ EstadoBotonesArt;
          |VETE jVic;
     |SINO;
          aArtDefecto = "";
          || #22#0 =
          || |LEE 000#22p;
          || |SI FSalida = nCero;
          ||     #3#0 = #22#0;
               |HAZ PonArt;
          ||     nArAc = 1;
          || |FINSI;
          || |HAZ ArtPrim;
     |FINSI;
|FPRC;

|PROCESO OcultaPrecios;
     |SI nOpre = 0;
          |CAMPO_VISUAL #3#26,1,"N";  || PVM
          |CAMPO_VISUAL #3#11,1,"N";  || precio
          |CAMPO_VISUAL #3#24,1,"N";  || precio en euros
          |PINTA 1902,"                          ";
          |PINTA 2002,"                          ";
          |PINTA 2102,"                          ";
          |CUADRO 1927 2127;

          |CAMPO_VISUAL #3#18,1,"N";    ||Descuento
          |CAMPO_VISUAL #3#2,1,"N";     ||Existencias
          |PINTA 1102,"                          ";
          |PINTA 1817,"          ";
          |CUADRO 1127 1227;
          |CUADRO 1827 1927;
     |SINO;
          |SI nOpmv = 0;
               |CAMPO_VISUAL #3#26,1,"S";  || PVM
               |PINTA #3#26;
               |PINTA 2102,"PMV:";
          |FINSI;

          |CAMPO_VISUAL #3#11,1,"S";  || precio
          |CAMPO_VISUAL #3#24,1,"S";  || precio en CONTRAVALOR
          |PINTA #3#24;
          |PINTA #3#11;

          ||ARA
          ||TODO CCC
          |SI EURODB = 0;
               |PINTA 1907,"Pesetas";
               |PINTA 2007,"EUROS  ";
               |PINTA 1902,"Pre: ";
          |SINO;
               |C_V #3#24, 1, "N";
               |PINTA 1907,"EUROS  ";
               |PINTA 2007,"Pesetas";
               |PINTA 1902,"Pre: ";
               ||CUADRO 1827 1927;
          |FINSI;

          |CAMPO_VISUAL #3#18,1,"S";    ||Descuento
          |CAMPO_VISUAL #3#2,1,"S";     ||Existencias
          |PINTA #3#18;
          |PINTA #3#2;
          |PINTA 1102,"Exi:";
          |PINTA 1817,"Dto.";
     |FINSI;
|FPRC;


|PROCESO minIP;
     #26#0=000001;
     #26#25="  ";
     #26#4=#0#15;
|FPRC;

|PROCESO maxIP;
     #26#0=999999;
     #26#25="zz";
     #26#4=#0#15;
|FPRC;


|PROCESO ImprimirPedido;
     aCad0=#0#0;
     |QBF aCad0;
     |SI aCad0="";
          |MENAV aMensajeFaltaCliente;
     |SINO;
          |ABRE #26;
          #26#0 = nNumPed;
          #26#25 = aSerPed;
          |LEE 000#26=;
          |SI FSalida=nCero;
               |CIERRA #26;
               |CONFI "00000Seguro que deseas Imprimir el Pedido seleccionado?";
               |SI FSalida=nCero;
                    ser_ped = #26#25;
                    num_ped = #26#0;
                    |PARA;  |SI;  |HACIENDO;
                         |MENU aDato;
                         aDato2 = FSalida;
                         |SI aDato2 = "1";  |HAZ CrearListadoPedido; |SAL;  |FINSI;
                         |SI aDato2 = "2";  |HAZ tipodocum; |SAL;  |FINSI;
                         |SI aDato2 < "1"; |O aDato2 > "2";  |SAL;  |FINSI;
                    |SIGUE;
               |FINSI;
          |SINO;
               |CIERRA #26;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO tipodocum;
     |SUB_EJECUTA_NP "agifa105.run;marhv104";
|FPRC;

|PROCESO DatosParaInforme;
     aInicialImagen =#225#0 % 101;
     aCad1 = #225#0;
     |QBF aCad1;
     aCodigoFoto="\" + aInicialImagen + "\" + aCad1 + ".jpg";

     |ABRE #30;   || leer precio coste proveedor-articulo
     |SELECT #2#30;
     #30#7=#225#27;
     #30#2=#225#0;
     |LEE 000#30=;
     |SI FSalida ! 0;
          |DDEFECTO #30;
     |FINSI;
     |CIERRA #30;

     |ABRE #31;   || leer ubicacion articulo-almacen 1????
     #31#0 = #225#0;
     #31#1 = 1;
     |LEE 000#31=;
     |SI FSalida!0;
          |DDEFECTO #31;
     |FINSI;
     |CIERRA #31;
|FPRC;

|PROCESO por00004b;
     |SI #por00004#1 = #22#0;
          nUli = #por00004#2;
          |ERROR10;
     |FINSI;
|FPRC;

|DEFBUCLE por00004b;
     #por00004#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL,por00004b;
|FIN;

|PROCESO busca2d;
     |HAZ BuscaPosicionTabla;
     |SI nLugar = -1;
          nDt2 = 0;
     |SINO;
          nLugar = nLugar - 1;
          |HAZ CalculaDescuento;
          nDt2 = nDescuento;
     |FINSI;
|FPRC;

|PROCESO PreOferta;
     fFecha = ~;
     enPreNor = 0;
     enPreOfe = 0;

     |ABRE #44;
     #44#0 = #0#15;
     |LEE 000#44=;
     |SI FSalida = 0;
          |ABRE #55;
          |ABRE #56;
          #55#0 = #44#1;
          |LEE 000#55=;
          |SI FSalida = 0; |Y fFecha ] #55#4; |Y fFecha [ #55#5;
               #56#0 = #55#0;
               #56#1 = #22#0;
               |LEE 000#56=;
               |SI FSalida = 0;
                    |SI nEsPedido = 1;
                         enPreNor = #56#3;
                    |SINO;
                         enPreNor = #56#3 + #56#3 % nRcoe;
                    |FINSI;
               |FINSI;
          |FINSI;
          #55#0 = #44#2;
          |LEE 000#55=;
          |SI FSalida = 0; |Y fFecha ] #55#4; |Y fFecha [ #55#5;
               #56#0 = #55#0;
               #56#1 = #22#0;
               |LEE 000#56=;
               |SI FSalida = 0;
                    |SI nEsPedido = 1;
                         enPreOfe = #56#3;
                    |SINO;
                         enPreOfe = #56#3 + #56#3 % nRcoe;
                    |FINSI;
               |FINSI;
          |FINSI;
          |CIERRA #55;
          |CIERRA #56;
     |FINSI;
     |CIERRA #44;
|FPRC;

|PROCESO PImprimeFiltrados;
     nContalis = nContalis + 1;
     |SI nContalis > nRnar; |ERROR10; |ACABA; |FINSI;
     #3#0 = #22#0;
     nLugar = -1;
     |HAZ PonArt;
     nDtt = #3#18;
     |HAZ busca2d;
     nLugar = -1;
     |HAZ PonArt;

     |HAZ PonPreCliArt;

     |HAZ DatosParaInforme;
     nUli = 0;
     |BUCLE por00004b; ||Sacar Unidades Pedidas.
     |SI nUli = 0;
          #5#0 = #3#20;
     |SINO;
          #5#0 = nUli;
     |FINSI;
     |HAZ CompruebaRedondeo;
     |HAZ PreOferta;

     nCodArt = #22#0;
     |HAZ BuscaMaximoDescuento;
     |HAZ CalculaComision;
     nHojas = nComision;

     |PRINT;
     nAuxI = 1;
|FPRC;

|DEFBUCLE BImprimeFiltrados;
     #22#1;
     ;
     "                    ";
     "zzzzzzzzzzzzzzzzzzzz";
     ;
     NULL,PImprimeFiltrados;
|FIN;

|PROCESO CrearListadoArticulos;
     nSwVic = 1;
     |IMPRE 0;
     |SI FSalida ! 0; |ACABA; |FINSI;
     nRtip = 1;
     |SI nRtip = 1; |INFOR aInfArt1; |FINSI;
     |SI nRtip > 1; |INFOR aInfArt2; |FINSI;
     |SI FSalida ! 0; |FINIMP; |ACABA; |FINSI;
     nAuxI=0;
     nContalis = 0;
     |BUCLE BImprimeFiltrados;
     nSwVic = 0;
     |HAZ ArtPrim;
     |SI nAux = 1;
          |PIEINF;
     |FINSI;
     |FININF;
     |FINIMP;
|FPRC;

|PROCESO PulsaBorrarTodo;
     |PTEC 824;
|FPRC;

|PROCESO PulsaBorrarLinea;
     |PTEC 825;
|FPRC;
|PROCESO PulsaVolverBorrar;
     |PTEC 823;
|FPRC;

|PROCESO PonBotonesBorrarL;
     |CONTROL_SIMPLE 0, "BOTON,F2 Todo", 2424, 2434, PulsaBorrarTodo;
     nBotonx31 = FSalida;
     |CONTROL_SIMPLE 0, "BOTON,F3 L¡neas", 2435, 2445, PulsaBorrarLinea;
     nBotonx32 = FSalida;
     |CONTROL_SIMPLE 0, "BOTON,F12 SALIR", 2446, 2456, PulsaVolverBorrar;
     nBotonx33 = FSalida;

|FPRC;

|PROCESO QuitaBotonesBorrarL;
     |FIN_CONTROL_WINDOWS nBotonx31;
     |FIN_CONTROL_WINDOWS nBotonx32;
     |FIN_CONTROL_WINDOWS nBotonx33;
     |PULSATECLA;
|FPRC;

|PROCESO MenuBorrarLineas;
     |ABRE #4;
     |LEE 000#4p;
     |SI FSalida!nCero;
          |MENAV "0000No existen Articulos Pedidos en el Temporal!";
     |SINO;
          |HAZ PonBotonesBorrarL;

          |PARA; |SI; |HACIENDO;
               |LEETECLA aTecla;
               aTecla = aTecla % 203;
               |SI aTecla = 806;|O aTecla=807; |O aTecla=823; |SAL; |FINSI;
               nTecla = aTecla; nTecla = (nTecla - 824) + 1

               |SI nTecla ] 1; |Y  nTecla [ 2;
                    |SI nTecla = 1;
                         |HAZ BorrarTodasLineaPedido;
                    |FINSI;
                    |SI nTecla = 2;
                         |HAZ BorrarLineaPedido;
                    |FINSI;
               |FINSI;
          |SIGUE;

          |HAZ QuitaBotonesBorrarL;
     |FINSI;
     |CIERRA #4;
|FPRC;

|PROCESO AnyadeArtTempo;
     aCad1 = #3#0;
     |QBF aCad1;
     aCad2 = #0#0;
     |QBF aCad2;
     |SI aCad2="";
          |MENAV aMensajeFaltaCliente;
     |SINO;
          |SI aCad1="";
               |MENAV aMensajeFaltaArticulo;
          |SINO;
               |ESTADO_CONTROL nIdImagen,"HIDE";
               aEstadoBoton="HIDE";
               |HAZ EstadoBotonesArt;
               |PINDA #0#3;

               aAlfa1 = aRruI;

               aBlanco = aAlfa1;
               aInicialImagen = #por00025#0 % 101;
               aAlfa1  = aAlfa1 + aInicialImagen+"\"+ #por00025#0;
               aBlanco = aBlanco+ "blanco.jpg";
               |QBF aAlfa1;
               aAlfa1 = aAlfa1 + ".jpg";
               |XABRE "CE",aAlfa1,nNume1;
               |SI FSalida = 1;
                   vPar1 = aAlfa1;
               |SINO;
                   vPar1 = aBlanco;
               |FINSI;

||               parsocx = tRetorno<-;
            vPar1 = "IMAGEN," + vPar1;
            |CONTROL_SIMPLE 0, vPar1, 530, 2275,NULL;

            nIdImagen=FSalida;

               || |OCX_INVOCA miocx,"Pinta",0428,2380,2,parsocx;

               |HAZ AnyadeArticuloTemporal;

               aEstadoBoton="SHOW";
               |HAZ EstadoBotonesArt;
               |ESTADO_CONTROL nIdImagen,"SHOW";
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO VentanaPedido;
     aCad1 = #3#0;
     |QBF aCad1;
     aCad2 = #0#0;
     |QBF aCad2;
     |SI aCad2="";
          |MENAV aMensajeFaltaCliente;
     |SINO;
          |SI aCad1="";
               |MENAV aMensajeFaltaArticulo;
          |SINO;
               |ESTADO_CONTROL nIdImagen,"HIDE";
               aEstadoBoton="HIDE";
               |HAZ EstadoBotonesArt;
               |PINDA #0#3;
               aAlfa1 = aRruI;
               aBlanco = aAlfa1;
               aInicialImagen = #3#0 % 101;
               aAlfa1  = aAlfa1 + aInicialImagen+"\"+ #3#0;
               aBlanco = aBlanco+ "blanco.jpg";
               |QBF aAlfa1;
               aAlfa1 = aAlfa1 + ".jpg";
               |XABRE "CE",aAlfa1,nNume1;
               |SI FSalida = 1;
                   vPar1 = aAlfa1;
               |SINO;
                   vPar1 = aBlanco;
               |FINSI;
               vPar1 = "IMAGEN," + vPar1;
               |CONTROL_SIMPLE 0, vPar1, 530, 2275,NULL;

               nIdImagen=FSalida;

               |HAZ AnyadeArticuloTemporal;

               aEstadoBoton="SHOW";
               |HAZ EstadoBotonesArt;
               |ESTADO_CONTROL nIdImagen,"SHOW";
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO VerMasDatosArticulo;
  |SI nRtip = 1;
      aCad1=#3#0;
      |QBF aCad1;
      |SI aCad1="";
          |MENAV aMensajeFaltaArticulo;
      |SINO;
           aEstadoBoton="HIDE";
           |HAZ EstadoBotonesArt;

               |HAZ MuestraMasDatosArticulo;

               aEstadoBoton="SHOW";
               |HAZ EstadoBotonesArt;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO EstadoPVM;
                    |SI nOpre = 1;
                         aCad1 = #3#0;
                         |QBF aCad1;
                         |SI nRtip = 1; |O nRtip = 2;
                              aCad1=#3#0;
                              |QBF aCad1;
                              |SI aCad1="";
                                   |MENAV aMensajeFaltaArticulo;
                              |SINO;
                                   |CAMPO_VISUAL #3#26,0,aCad1;
                                   |SI aCad1="S";
                                        nOpmv = 1;
                                        |CAMPO_VISUAL #3#26,1,"N";
                                        |PINTA 2102,"                        ";
                                   |SINO;
                                        nOpmv = 0;
                                        |CAMPO_VISUAL #3#26,1,"S";
                                        |PINTA 2102,"PMV:";
                                        |PINTA #3#26;
                                   |FINSI;
                              |FINSI;
                         |FINSI;
                    |FINSI;
|FPRC;

|PROCESO ConsultaArtPedidos;
     |ABRE #4;
     |LEE 000#4p;
     |SI FSalida!nCero;
          |MENAV "0000No existen Articulos Pedidos en el Temporal!";
     |SINO;
          |CONSULTA_CLAVE #1#4;
     |FINSI;
     |CIERRA #4;
|FPRC;

|PROCESO PulsaListadoArticulo;
     |PTEC 818;
|FPRC;

|PROCESO PulsaCArticulo;
     |PTEC 813;
|FPRC;

|PROCESO PulsaRelojMasArticulo;
     |PTEC 815;
|FPRC;

|PROCESO PulsaRelojMenosArticulo;
     |PTEC 814;
|FPRC;

|PROCESO PulsaVolverArticulo;
     |PTEC 806;
|FPRC;

|PROCESO PulsaPrimerArticulo;
     |PTEC 827;
|FPRC;

|PROCESO PulsaAnteriorArticulo;
     |PTEC 828;
|FPRC;

|PROCESO PulsaSigArticulo;
     |PTEC 829;
|FPRC;

|PROCESO PulsaUltimoArticulo;
     |PTEC 830;
|FPRC;

|PROCESO PulsaBuscarArticulo;
     |PTEC 831;
|FPRC;

|PROCESO PulsaPedirArticulo;
     |PTEC 838; ||Ctrl +F6  Antes = |PTEC 832 -> F10
|FPRC;

|PROCESO PulsaBorrarArticulo;
     |PTEC 839; ||Ctrl +F7  Antes = |PTEC 819 -> F11
|FPRC;

|PROCESO PulsaConsulArticulo;
  ||   |PTEC 821;
     |PTEC 840; ||Ctrl +F8  Antes = |PTEC 821 -> F12
|FPRC;

|PROCESO PulsaMasDArticulo;
     |PTEC 824;
|FPRC;

|PROCESO PulsaPMVArticulo;
     |PTEC 825;
|FPRC;

|PROCESO PulsaOcultArticulo;
     |PTEC 826;
|FPRC;

|PROCESO PulsaIntrCodBarras;
     |PTEC 841;
|FPRC;

|PROCESO PulsaNoRedArticulo;
     |ESTADO_CONTROL nBotonx217,"HIDE";
     |ESTADO_CONTROL nBotonx218,"SHOW";
     nRedondeoPu = 0;
|FPRC;

|PROCESO PulsaSiRedArticulo;
     |ESTADO_CONTROL nBotonx217,"SHOW";
     |ESTADO_CONTROL nBotonx218,"HIDE";
     nRedondeoPu = 1;
     |MENAV "0000Se va a penalizar el descuento!";
|FPRC;

|PROCESO PulsaRegActualArticulo;
|FPRC;

|PROCESO Pulsa9x9Articulo;
   ||  |PTEC 820;
     |PTEC 835;
|FPRC;

|PROCESO PonBotonesArticulo;
     |CONTROL_SIMPLE 0, "BOTON,List", 2403, 2407, PulsaListadoArticulo;     nBotonx21 = FSalida;
     |CONTROL_SIMPLE 0, "BOTON,Ver", 2408, 2412, PulsaCArticulo;            nBotonx22 = FSalida;
     |CONTROL_SIMPLE 0, "BOTON,R +", 2413, 2417, PulsaRelojMasArticulo;     nBotonx23 = FSalida;
     |CONTROL_SIMPLE 0, "BOTON,R -", 2418, 2422, PulsaRelojMenosArticulo;   nBotonx24 = FSalida;
     |CONTROL_SIMPLE 0, "BOTON,SALIR ", 2603, 2607, PulsaVolverArticulo;    nBotonx25 = FSalida;
     |CONTROL_SIMPLE 0, "BOTON,|<< F5", 2503, 2507, PulsaPrimerArticulo;    nBotonx26 = FSalida;
     |CONTROL_SIMPLE 0, "BOTON,< F6", 2508, 2512, PulsaAnteriorArticulo;    nBotonx27 = FSalida;
     |CONTROL_SIMPLE 0, "BOTON,F7 >", 2529, 2534, PulsaSigArticulo;         nBotonx28 = FSalida;
     |CONTROL_SIMPLE 0, "BOTON,F8 >>|", 2535, 2540, PulsaUltimoArticulo;    nBotonx29 = FSalida;
 ||    |CONTROL_SIMPLE 0, "BOTON,F9 Buscar", 2545, 2553, PulsaBuscarArticulo; nBotonx210 = FSalida;
 ||    |CONTROL_SIMPLE 0, "BOTON,F10 Pedir", 2554, 2562, PulsaPedirArticulo;  nBotonx211 = FSalida;
 ||    |CONTROL_SIMPLE 0, "BOTON,F11 Borrar", 2563, 2570, PulsaBorrarArticulo;nBotonx212 = FSalida;
 ||    |CONTROL_SIMPLE 0, "BOTON,F12 Consultar", 2571, 2580, PulsaConsulArticulo; nBotonx213 = FSalida;
     |CONTROL_SIMPLE 0, "BOTON,F9 Buscar", 2541, 2549, PulsaBuscarArticulo; nBotonx210 = FSalida;
     |CONTROL_SIMPLE 0, "BOTON,Ctrl+F6 Pedir", 2550, 2559, PulsaPedirArticulo;  nBotonx211 = FSalida;
     |CONTROL_SIMPLE 0, "BOTON,Ctrl+F7 Borrar", 2560, 2569, PulsaBorrarArticulo;nBotonx212 = FSalida;
     |CONTROL_SIMPLE 0, "BOTON,Ctrl+F8 Consulta", 2570, 2580, PulsaConsulArticulo; nBotonx213 = FSalida;

     ||TODO CCC. Nuevo boton para introducir con pistola cod. Barras.
     |CONTROL_SIMPLE 0, "BOTON,Cod. Barras", 2441, 2449, PulsaIntrCodBarras;nBotonx220 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,F2", 2079, 2081, PulsaMasDArticulo;          nBotonx214 = FSalida;
     |CONTROL_SIMPLE 0, "BOTON,F3", 2279, 2281, PulsaPMVArticulo;           nBotonx215 = FSalida;
     |CONTROL_SIMPLE 0, "BOTON,F4", 2479, 2481, PulsaOcultArticulo;         nBotonx216 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,No Red", 0821, 0826, PulsaNoRedArticulo;     nBotonx217 = FSalida;
     |CONTROL_SIMPLE 0, "BOTON,Redond", 0821, 0826, PulsaSiRedArticulo;     nBotonx218 = FSalida;
     |ESTADO_CONTROL nBotonx217,"SHOW"; nRedondeoPu = 1;

     |CONTROL_SIMPLE 0, "BOTON,Multi-Imagenes", 2429, 2440, Pulsa9x9Articulo;nBotonx219 = FSalida;
|FPRC;

|PROCESO QuitaBotonesArticulo;
     |ESTADO_CONTROL nBotonx21, "HIDE";
     |ESTADO_CONTROL nBotonx22, "HIDE";
     |ESTADO_CONTROL nBotonx23, "HIDE";
     |ESTADO_CONTROL nBotonx24, "HIDE";
     |ESTADO_CONTROL nBotonx25, "HIDE";
     |ESTADO_CONTROL nBotonx26, "HIDE";
     |ESTADO_CONTROL nBotonx27, "HIDE";
     |ESTADO_CONTROL nBotonx28, "HIDE";
     |ESTADO_CONTROL nBotonx29, "HIDE";
     |ESTADO_CONTROL nBotonx210, "HIDE";
     |ESTADO_CONTROL nBotonx211, "HIDE";
     |ESTADO_CONTROL nBotonx212, "HIDE";
     |ESTADO_CONTROL nBotonx213, "HIDE";
     |ESTADO_CONTROL nBotonx214, "HIDE";
     |ESTADO_CONTROL nBotonx215, "HIDE";
     |ESTADO_CONTROL nBotonx216, "HIDE";
     |ESTADO_CONTROL nBotonx217, "HIDE";
     |ESTADO_CONTROL nBotonx218, "HIDE";
     |ESTADO_CONTROL nBotonx219, "HIDE";
     |ESTADO_CONTROL nBotonx220, "HIDE";

     |FIN_CONTROL_WINDOWS nBotonx21;
     |FIN_CONTROL_WINDOWS nBotonx22;
     |FIN_CONTROL_WINDOWS nBotonx23;
     |FIN_CONTROL_WINDOWS nBotonx24;
     |FIN_CONTROL_WINDOWS nBotonx25;
     |FIN_CONTROL_WINDOWS nBotonx26;
     |FIN_CONTROL_WINDOWS nBotonx27;
     |FIN_CONTROL_WINDOWS nBotonx28;
     |FIN_CONTROL_WINDOWS nBotonx29;
     |FIN_CONTROL_WINDOWS nBotonx210;
     |FIN_CONTROL_WINDOWS nBotonx211;
     |FIN_CONTROL_WINDOWS nBotonx212;
     |FIN_CONTROL_WINDOWS nBotonx213;
     |FIN_CONTROL_WINDOWS nBotonx214;
     |FIN_CONTROL_WINDOWS nBotonx215;
     |FIN_CONTROL_WINDOWS nBotonx216;
     |FIN_CONTROL_WINDOWS nBotonx217;
     |FIN_CONTROL_WINDOWS nBotonx218;
     |FIN_CONTROL_WINDOWS nBotonx219;
     |FIN_CONTROL_WINDOWS nBotonx220;
     |PULSATECLA;
|FPRC;

|PROCESO MenuArticulos;
     |HAZ PonReloj;
     nRedondeoPu = 0;
     |HAZ PonBotonesArticulo;
     |HAZ PonEstadoNavegador;

     |PARA; |SI; |HACIENDO;
          |HAZ PintaRegistroActual;
          |LEETECLA aTecla;
          aTecla = aTecla % 203;
          |SI aTecla = 806;|O aTecla = 807;
               |HAZ QuitaRegistroActual;
               |ABRE #4;
               |LEE 000#4p;
               nSalida = FSalida;
               |CIERRA #4;
               |SUB_EJECUTA "porv0001";
               |SI nSalida = 0;
                    |SI nEsPedido = 1;
                         aMensaje = "00000Generar Pedido(Si)" + &13 + "Cancelar Pedido (No)?";
                    |SINO;
                         aMensaje = "00000Generar Presupuesto(Si)" + &13 + "Cancelar Presupuesto (No)?";
                    |FINSI;
                    |CONFI aMensaje;
                    |SI FSalida=0;
                         |HAZ CrearPedidoAlSalir;      ||Crea Pedido o Presupuesto
                    |SINO;
                         |DELINDEX #4;
                    |FINSI;
               |FINSI;
               |SAL;
          |FINSI;

      ||    |SI aTecla = 819;        ||Pulsa F11.
          |SI aTecla = 839;        ||Ctrl+F7
               nTecla = 10;
          |SINO;
              || |SI aTecla = 821;  ||Pulsa F12
               |SI aTecla = 840; || Ctrl+F9
                    nTecla = 11;
               |SINO;
                    |SI aTecla = 818; ||Pulsa Listar Articulos
                         nTecla = 12;
                    |SINO;
                         |SI aTecla = 813;
                              nTecla = 13;
                         |SINO;
                              |SI aTecla = 815;
                                   nTecla = 14;
                              |SINO;
                                   |SI aTecla = 814;
                                        nTecla = 15;
                                   |SINO;
                                        |SI aTecla = 820;
                                             nTecla = 10;
                                             || nTecla = 16;
                                        |SINO;
                                             |SI aTecla = 834;
                                                  nTecla = 17;
                                             |SINO;
                                                  |SI aTecla = 835; ||Pulsa Multi imagen
                                                     nTecla = 16;
                                                  |SINO;
                                                       nTecla = aTecla; nTecla = (nTecla - 824) + 1
                                                  |FINSI;
                                             |FINSI;
                                        |FINSI;
                                   |FINSI;
                              |FINSI;
                         |FINSI;
                    |FINSI;
               |FINSI;
          |FINSI;
          |SI nTecla ] 1; |Y  nTecla [ 18;
               |SI nTecla = 4;
                    |SI nArAc ! 1;
                         |HAZ ArtPrim;
                         |HAZ PintaRegistroActual;
                    |FINSI;
               |FINSI;
               |SI nTecla = 5;
                    |SI nArAc ! 1;
                         |HAZ ArticuloAnterior;
                         |HAZ PintaRegistroActual;
                    |FINSI;
               |FINSI;
               |SI nTecla = 6;
                    |SI nArAc ! nTArt;
                         |HAZ ArticuloSiguiente;
                         |HAZ PintaRegistroActual;
                    |FINSI;
               |FINSI;
               |SI nTecla = 7;
                    |SI nArAc ! nTArt;
                         |HAZ ArticuloUltimo;
                         |HAZ PintaRegistroActual;
                    |FINSI;
               |FINSI;
               |SI nTecla = 8;
                    |HAZ QuitaReloj;

                    aEstadoBoton="HIDE";
                    |HAZ EstadoBotonesArt;

                    |HAZ IniFil;
                    |HAZ EstablecerFiltro;

                    aEstadoBoton="SHOW";
                    |HAZ EstadoBotonesArt;
               |FINSI;

         ||      |SI nTecla = 9;               ||Pulsa F10 Pedir
               |SI aTecla = 838;               ||Crtl+ F6
                    |HAZ QuitaReloj;
                    aEstadoBoton="HIDE";
                    |HAZ EstadoBotonesArt;

                    || |HAZ AnyadeArtTempo;
                    |HAZ VentanaPedido;
                    aEstadoBoton="SHOW";
                    |HAZ EstadoBotonesArt;
               |FINSI;
               |SI nTecla = 10;
                    |HAZ QuitaReloj;

                    aEstadoBoton="HIDE";
                    |HAZ EstadoBotonesArt;

                    |HAZ MenuBorrarLineas;

                    aEstadoBoton="SHOW";
                    |HAZ EstadoBotonesArt;
               |FINSI;
               |SI nTecla = 11;
                    |HAZ QuitaReloj;
                    aEstadoBoton="HIDE";
                    |HAZ EstadoBotonesArt;
                    |HAZ ConsultaArtPedidos;
                    aEstadoBoton="SHOW";
                    |HAZ EstadoBotonesArt;
               |FINSI;

               |SI nTecla = 1;
                    |HAZ QuitaReloj;
                    |HAZ VerMasDatosArticulo;
               |FINSI;

               |SI nTecla = 2;
                    |HAZ EstadoPVM;
               |FINSI;

               |SI nTecla = 3;
                    |SI nOpre = 0;
                         nOpre = 1;
                    |SINO;
                         nOpre = 0;
                    |FINSI;
                    |HAZ OcultaPrecios;
               |FINSI;

               |SI nTecla = 12;
                    |HAZ CrearListadoArticulos;
               |FINSI;
               |SI nTecla = 13;
                    |HAZ QuitaReloj;

                    aEstadoBoton="HIDE";
                    |HAZ EstadoBotonesArt;

                    |HAZ ArticulosAutomaticos;

                    aEstadoBoton="SHOW";
                    |HAZ EstadoBotonesArt;
               |FINSI;
               |SI nTecla = 14;
                    |HAZ ConfigurarRelojMas;
               |FINSI;
               |SI nTecla = 15;
                    |HAZ ConfigurarRelojMenos;
               |FINSI;

               |SI nTecla = 16;
                    ||TODO CCC
                    ||Para que repinte el articulo al presionar boton 9Imagenes
                    |HAZ Saca9Imagenes;
                    nSwVic = 0;
                    nSw9Imagenes = 1;
                    |HAZ RecalculaArAc;
                    |HAZ PonArt;
               |FINSI;

||               |SI nTecla = 17;
               |SI aTecla = 841;
                    |HAZ QuitaReloj;

                    aEstadoBoton="HIDE";
                    |HAZ EstadoBotonesArt;

                    ||aMensaje = "0000Introduccion por Codigo de Barras";
                    ||MENAV aMensaje;
                    |HAZ CodBarras;

                    aEstadoBoton="SHOW";
                    |HAZ EstadoBotonesArt;
               |FINSI;

               |HAZ PonReloj;
          |FINSI;
     |SIGUE;

     |HAZ QuitaReloj;
     |HAZ QuitaBotonesArticulo;
|FPRC;

|PROCESO PLineasPedido;
     #3#0 = #27#2;
     nLugar = -1;
     |HAZ PonArt;
     nDtt = #3#18;
     |HAZ busca2d;
     |HAZ DatosParaInforme;
     nUli = #27#5;
     |HAZ CompruebaRedondeo;
     |PRINT;
     nAuxI = 1;
|FPRC;

|DEFBUCLE BLineasPedido;
     #27#1;
     ;
     #26#25,#26#0,1;
     #26#25,#26#0,999;
     ;
     NULL,PLineasPedido;
|FIN;

|PROCESO CrearListadoPedido;
     nSwVic = 1;
     |IMPRE 0;
     |SI FSalida ! 0; |ACABA; |FINSI;
     |SI nRtip = 1; |INFOR aInfArt1; |FINSI;
     |SI nRtip > 1; |INFOR aInfArt2; |FINSI;
     |SI FSalida ! 0; |FINIMP; |ACABA; |FINSI;
     nAuxI=0;
     |BUCLE BLineasPedido;
     nSwVic = 0;
     |HAZ ArtPrim;
     |SI nAux = 1;
          |PIEINF;
     |FINSI;
     |FININF;
     |FINIMP;
|FPRC;

|PROCESO PulsaModifPedido;
     |PTEC 824;
|FPRC;

|PROCESO PulsaBorrarPedido;
     |PTEC 825;
|FPRC;

|PROCESO PulsaImprimirPedido;
     |PTEC 826;
|FPRC;

|PROCESO PulsaPendPedido;
     |PTEC 827;
|FPRC;

|PROCESO PulsaPendPortatil;
     |PTEC 828;
|FPRC;

|PROCESO PulsaListadoPedido;
     |PTEC 829;
|FPRC;

|PROCESO PulsaVolverPedido;
     |PTEC 823;
|FPRC;

|PROCESO PonBotonesPedido;
     |CONTROL_SIMPLE 0, "BOTON,F5 Ptes.Central", 2435, 2445, PulsaPendPedido;     nBotonx240 = FSalida;
     |CONTROL_SIMPLE 0, "BOTON,F6 Ptes.Portatil", 2446, 2456, PulsaPendPortatil;   nBotonx300 = FSalida;
     |CONTROL_SIMPLE 0, "BOTON,F12 SALIR", 2457, 2467, PulsaVolverPedido;   nBotonx260 = FSalida;
|FPRC;

|PROCESO QuitaBotonesPedido;
 ||    |FIN_CONTROL_WINDOWS nBotonx21;
 ||    |FIN_CONTROL_WINDOWS nBotonx22;
 ||    |FIN_CONTROL_WINDOWS nBotonx23;
     |FIN_CONTROL_WINDOWS nBotonx240;
 ||    |FIN_CONTROL_WINDOWS nBotonx25;
     |FIN_CONTROL_WINDOWS nBotonx260;
     |FIN_CONTROL_WINDOWS nBotonx300;
     |PULSATECLA;
|FPRC;

|PROCESO QuitaBotonesSubMenu;
     |SI nSwEsCentral = 0;
          |FIN_CONTROL_WINDOWS nBotonx71;
          |FIN_CONTROL_WINDOWS nBotonx72;
     |FINSI;
     |FIN_CONTROL_WINDOWS nBotonx73;
     |FIN_CONTROL_WINDOWS nBotonx74;
     |FIN_CONTROL_WINDOWS nBotonx75;
     |PULSATECLA;
|FPRC;


|PROCESO EstadoBotonesPed;
 ||    |ESTADO_CONTROL nBotonx21,aEstadoBotonPed;
 ||    |ESTADO_CONTROL nBotonx22,aEstadoBotonPed;
 ||    |ESTADO_CONTROL nBotonx23,aEstadoBotonPed;
     |ESTADO_CONTROL nBotonx240,aEstadoBotonPed;
 ||    |ESTADO_CONTROL nBotonx25,aEstadoBotonPed;
     |ESTADO_CONTROL nBotonx300,aEstadoBotonPed;
     |ESTADO_CONTROL nBotonx260,aEstadoBotonPed;
|FPRC;

|PROCESO EstadoBotonesSub;
    |SI nSwEsCentral = 0;
         |ESTADO_CONTROL nBotonx71,aEstadoBotonSub;
         |ESTADO_CONTROL nBotonx72,aEstadoBotonSub;
    |FINSI;
    |ESTADO_CONTROL nBotonx73,aEstadoBotonSub;
    |ESTADO_CONTROL nBotonx74,aEstadoBotonSub;
    |ESTADO_CONTROL nBotonx75,aEstadoBotonSub;
|FPRC;


|PROCESO MenuPedido;
     ||ARA
     aCad0=#0#0;
     |QBF aCad0;
     |SI aCad0="";
          |MENAV aMensajeFaltaCliente;
     |SINO;
          aEstadoBotonPed="SHOW"; |HAZ EstadoBotonesPed; |HAZ PonBotonesPedido;
          |PARA; |SI; |HACIENDO;
               |LEETECLA aTecla;
               aTecla = aTecla % 203;
               |SI aTecla = 806;|O aTecla=807; |O aTecla=823; |SAL; |FINSI;
               nTecla = aTecla; nTecla = (nTecla - 824) + 1

               |SI nTecla ] 1; |Y  nTecla [ 6;
                    aEstadoBotonPed="HIDE"; |HAZ EstadoBotonesPed; |HAZ QuitaBotonesPedido;

                    nSalEntLin = -1;
                    |SI nTecla = 4;
                         |HAZ VerPendientesServir;
                    |FINSI;
                    |SI nTecla = 5;
                         |HAZ VerPendientesServirP;
                    |FINSI;
                    |SI nSalEntLin = 0;
                         |SI nTecla = 4;
                              nSwEsCentral = 1;
                         |SINO;
                              nSwEsCentral = 0;
                         |FINSI;
                         |HAZ SubMenu;
                         ||ARACCC
                         |SI nSwEsCentral = 1;
                              |HAZ VerPendientesServir;
                         |SINO;
                              |HAZ VerPendientesServirP;
                         |FINSI;
                    |FINSI;
                    aEstadoBotonPed="SHOW"; |HAZ EstadoBotonesPed; |HAZ PonBotonesPedido;
               |FINSI;
          |SIGUE;
          aEstadoBotonPed="HIDE"; |HAZ EstadoBotonesPed; |HAZ QuitaBotonesPedido;
     |FINSI;
|FPRC;

|PROCESO EstadoBotonesPri;
     |ESTADO_CONTROL nBotonx41,aEstadoBotonP;
     ||ESTADO_CONTROL nBotonx42,aEstadoBotonP;
     |ESTADO_CONTROL nBotonx43,aEstadoBotonP;
     |ESTADO_CONTROL nBotonx44,aEstadoBotonP;
|FPRC;

|PROCESO PulsaArticulosP;
     |PTEC 824;
|FPRC;
|PROCESO PulsaPedidoP;
     |PTEC 825;
|FPRC;
|PROCESO PulsaVolverP;
     |PTEC 823;
|FPRC;


|PROCESO PonBotonesPrincipal;
     |CONTROL_SIMPLE 0, "BOTON,F2 Pedir", 2420, 2430,               PulsaArticulosP; nBotonx41 = FSalida;
     |CONTROL_SIMPLE 0, "BOTON,F3 Pedidos Realizados", 2431, 2452,  PulsaPedidoP;    nBotonx43 = FSalida;
     |CONTROL_SIMPLE 0, "BOTON,F12 SALIR", 2453, 2463,              PulsaVolverP;    nBotonx44 = FSalida;
|FPRC;

|PROCESO QuitaBotonesPrincipal;
     |FIN_CONTROL_WINDOWS nBotonx41;
     ||FIN_CONTROL_WINDOWS nBotonx42;
     |FIN_CONTROL_WINDOWS nBotonx43;
     |FIN_CONTROL_WINDOWS nBotonx44;
     |PULSATECLA;
|FPRC;

|PROCESO Menus;
     aEstadoBotonP = "SHOW"; |HAZ EstadoBotonesPri; |HAZ PonBotonesPrincipal;
     |PARA; |SI; |HACIENDO;
          |LEETECLA aTecla;
          aTecla = aTecla % 203;
          |SI aTecla = 806;|O aTecla = 807; |O aTecla = 823; |SAL; |FINSI;
          nTecla = aTecla; nTecla = (nTecla - 824) + 1
          |SI nTecla ] 1; |Y  nTecla [ 3;
               aEstadoBotonP = "HIDE"; |HAZ EstadoBotonesPri; |HAZ QuitaBotonesPrincipal;
               |SI nTecla = 1;
                    |HAZ MenuArticulos;
               |FINSI;
               |SI nTecla = 2;
                    |HAZ MenuPedido;
               |FINSI;
               aEstadoBotonP = "SHOW"; |HAZ EstadoBotonesPri; |HAZ PonBotonesPrincipal;
          |FINSI;
     |SIGUE;
     aEstadoBotonP = "HIDE"; |HAZ EstadoBotonesPri; |HAZ QuitaBotonesPrincipal;
|FPRC;

|PROCESO OculCli;
     totalc = #24#"|NC"#;
     |PARA i = 0; |SI i < totalc; |HACIENDO i = i + 1;
          |C_V #24#i# , 1 ,"N";
          |C_M #24#i# , 1 ,"N";
     |SIGUE;
     |C_V #24#0   , 1 , "S";
     |C_V #24#1   , 1 , "S";
     |C_V #24#6   , 1 , "S";
     |C_V #24#2   , 1 , "S";
     |C_V #24#178 , 1 , "S";
     |C_V #24#179 , 1 , "S";
     |C_V #24#7   , 1 , "S";
     |C_V #24#8   , 1 , "S";
     |C_V #24#9   , 1 , "S";
     |C_V #24#181 , 1 , "S";
     |C_V #24#182 , 1 , "S";
     |C_V #24#10  , 1 , "S";
     |C_V #24#15  , 1 , "S";
     |C_V #24#17  , 1 , "S";
     |C_M #24#0   , 1 , "S";
     |C_M #24#1   , 1 , "S";
     |C_M #24#6   , 1 , "S";
     |C_M #24#2   , 1 , "S";
     |C_M #24#178 , 1 , "S";
     |C_M #24#179 , 1 , "S";
     |C_M #24#7   , 1 , "S";
     |C_M #24#8   , 1 , "S";
     |C_M #24#9   , 1 , "S";
     |C_M #24#181 , 1 , "S";
     |C_M #24#182 , 1 , "S";
     |C_M #24#10  , 1 , "S";
     |C_M #24#15  , 1 , "S";
     |C_M #24#17  , 1 , "S";
|FPRC;


|PROCESO CrearPedidoAlSalir;
     aCad0=#0#15;
     |QBF aCad0;

     |ABRE #4;
     |LEE 000#4p;
     |SI FSalida=nCero;|Y aCad0!"";
          |HAZ CrearPedido;
     |FINSI;
     |CIERRA #4;
|FPRC;


|PROGRAMA;
     |HAZ CreaTempo; aTmp22 = Tempo; |NOME_DAT #22 Tempo; |DELINDEX #22;
     |HAZ CreaTempo; aTmp12 = Tempo; |NOME_DAT #12 Tempo; |DELINDEX #12;
     |HAZ CreaTempo; aTmp4 = Tempo; |NOME_DAT #4 Tempo; |DELINDEX #4;
     |HAZ CreaTempo; aTmp2 = Tempo; |NOME_DAT #2 Tempo; |DELINDEX #2;

     aParametro = PARAMETRO;  || ya que desde porm00001 se puede llamar
     |CLS;
     |DDEFECTO #0;
     aIniDesc = " " * 50;
     aFinDesc = "z" * 50;
     |HAZ OculCli;
     |SI aClienteSuper ! "";
          aCad1 = aClienteSuper % 101;
          |SI aCad1 = "N";
               aParametro = "porm0001n";
          |SINO;
               aParametro = "porm0001a";
          |FINSI;
     |FINSI;
     |SI aParametro = "porm0001a";
          |HAZ DibuCliAnt;         ||Traer datos del cliente con codigo "aClienteSuper"
     |FINSI;
     |SI aParametro = "porm0001n";
          |HAZ DibuCliNue;         ||Traer datos del cliente con codigo "aClienteSuper"
     |FINSI;
     |PINPA #0#0;
     |PINDA #0#0;
     |PINPA #0#3;
     |PINDA #0#3;

     |ABRET #25;
     |ABRET #22;

     |ABRET #225;
     |ABRE #10;
     |ABRE #11;
     |ABRE #12;
     |ABRE #13;
     |ABRE #14;
     |HAZ Carga_22;

     IFMemo = FMemo1<-;
     |ESPECIFICA "MEMORYFILE",FMemo;

     |HAZ LeeConRep;
     |HAZ IniFil;

     nOpmv = 1;
     nOpre = 1;
 ||    |HAZ ArtPrim;   No lo Entiendo.
     |HAZ Carga_Tar;
     |HAZ Menus;

     ||TODO CCC. El pedido se crea en un paso anterior
     ||HAZ CrearPedidoAlSalir;

     |CIERRAT #22;
     |CIERRAT #25;

     |CIERRAT #225;
     |CIERRA #10;
     |CIERRA #11;
     |CIERRA #12;
     |CIERRA #13;
     |CIERRA #14;
     |DELINDEX #4;  || Borrar las lineas de pedido para que luego
                    || no haya problemas al seleccionar otro cliente
     |HAZ LiberaOCX;

     Tempo = aTmp22; |HAZ BoraTempo; |DELINDEX #22;
     Tempo = aTmp12; |HAZ BoraTempo; |DELINDEX #12;
     Tempo = aTmp4; |HAZ BoraTempo; |DELINDEX #4;
     Tempo = aTmp2; |HAZ BoraTempo; |DELINDEX #2;
|FPRO;

|PROCESO BuscaArticulo; |TIPO 0;
     |DDEFECTO #225;
     |ABRE #225;
     |SELECT #4#225;
     #225#128 = #124#0;
     |LEE 000#225=;
     |SI FSalida ! 0;
          |MENAV "0000Articulo inaccesible.";
          |ERROR;
     |FINSI;
     |SELECT #1#225;
     |CIERRA #225;

     #3#0 = #225#0;
     |HAZ BuscaMaximoDescuento;

     #124#3 = #225#0;    || codigo real
     #124#1 = #225#1;    || descrip.
     |PINTA #124#3;
     |PINTA #124#1;
|FPRC;

|PROCESO UnidBarra; |TIPO 0;
     aAlfa1 = #124#2;
     |QBF aAlfa1;
     #124#4 = 0;
     |SI aAlfa1 = "0000000000017"; #124#4 = 1; |FINSI;
     |SI aAlfa1 = "0000000000024"; #124#4 = 2; |FINSI;
     |SI aAlfa1 = "0000000000055"; #124#4 = 5; |FINSI;
     |SI aAlfa1 = "0000000000109"; #124#4 = 10; |FINSI;
     |SI #124#4 = 0;
          |PINTA #124#4;
          |MENAV "0000Unidades incorrectas.";
          |ERROR;
     |SINO;
          |PINTA #124#4;
     |FINSI;
|FPRC;

|PROCESO CodBarras;

     ||Pido la introduccion del codigo de barras. ENCAMPO
     ||Carga la pantalla con los datos del articulo
     ||Luego simulo como si fuera a realizar el pedido.
     ||TODO CCC
|ET EtCodBarras;
     nSwCodBarra = 0;
     |ENCAMPO #22#3;
     |SI FSalida = 0;
          |SELECT #4#225;
          #225#128 = #3#22;
          |LEE 000#225=;
          |SI FSalida = 0;
               nSwCodBarra = 1;
               |SELECT #1#225;
               |LEE 000#225=;
               |DAREGN #25,nreg;
               nArAc = FSalida + 1;
          |SINO;
               aCodBarras = #3#22;
               |QBF aCodBarras;
               aMensaje = "0000Error: No existen ningun articulo con este codigo de barras [" + aCodBarras + "]";
               |MENAV aMensaje;
               #3#22 = " ";
               |PINTA #3#22;
               |VETE EtCodBarras
          |FINSI;
     |FINSI;

     |SI nSwCodBarra = 1;
          #3#0 = #225#0;
          |HAZ PonArt;
          ||Ahora quitare el filtro porque ahora dejara de tener sentido.
          |HAZ IniFil;
          |HAZ PonEstadoNavegador;
          |HAZ PulsaPedirArticulo;
     |FINSI;

/*
     ||TODO CCC Y RPC
     Queda comentada la primera aproximacion de la introduccion por
     codigo de barras, por si se puede reutilizar mas tarde


     |PUSHV 0501 2380;
     |PARA; |SI nSalida ] 0;  |HACIENDO;
          nSinCodigo = 0;
          |DDEFECTO #124;
          |PINPA #0#124;
          |PINDA #0#124;
          |ENDATOS #1#124;
          nSalida = FSalida;

          |SI nSalida=nCero;

               #5#0 = #124#4;      || para aprovechar las rutinas
               |SI #5#0<nUnidades;
                    |MENAV "0000No puedes pedir menos unidades que el limite!";
                    nSinCodigo = 1;
               |SINO;
                    |SI #5#0=nCero;
                         |MENAV "0000Tienes que introducir 1 unidad por lo menos!";
                         nSinCodigo = 1;
                    |FINSI;
               |FINSI;
               || comprueba si el num unid es multiplo de unidades embalaje
               |HAZ CompruebaRedondeo; || si no es multiplo decremento el dto

               || controlar que no se pase del maximo ya que no tenia descuento
               || cliente-articulo y buscar la comision
               |HAZ CalculaComision; || en nComision la tenemos

               |SI nDescuento=#3#18;
                    |SI #3#19!nCero;  || si no hemos variado el dto, la comision que tenia
                         nComision=#3#19;
                    |FINSI;
               |FINSI;

               |SI nDescuento>nMaxDto;
                    |MENAV "0000No puedes aplicar mas del asignado!";
                    nSinCodigo = 1;
               |FINSI;

               |SI nSinCodigo = 0;
                   |ABRE #4;
                   |LEE 101#4u;
                   |SI FSalida=nCero;
                        nUltimo=#4#0+1;
                   |SINO;
                        nUltimo=1;
                   |FINSI;

                   |DDEFECTO #4;
                   #4#0=nUltimo;       || linea
                   #4#1=#124#3;        || cod.articulo
                   #4#2=#124#4;        || unidades
                   #4#3=nComision;     || comision
                   #4#4=nDescuento;    || descuento
                   |SI nEsPedido=1;  || precio normal
                        #4#5=#225#18; || precio pvp1
                   |SINO;
                        #4#5=#225#18+ #225#18 % nRcoe; || precio pvp1
                   |FINSI;
                   #4#6=#124#1;        || descripcion articulo

                   |GRABA 020#4n;
                   |LIBERA #4;
                   |CIERRA #4;
              |FINSI;
          |FINSI;
     |SIGUE;
     |POPV;
     nSalida = 0;
*/
|FPRC;

|PROCESO DesArt; |TIPO 0;
     |ABRE #225;
     |SELECT #4#25;
     #225#128 = #por00001#0;
     |LEE 000#225=;
     |SI FSalida = 0;
          #por00001#1 = #225#1;
          |PINTA #por00001#1;
     |SINO;
          aMensaje = "0000Error: Articulo no introducido en la Base de Datos";
          |MENAV aMensaje;
          |ERROR;
     |FINSI;
     |CIERRA #225;
|FPRC;

|PROCESO PonBotArt;
     |CONTROL_SIMPLE 0, "BOTON,Sustituir", 1827, 1837, PulsaSusArt;
     nBotony1 = FSalida;
     |CONTROL_SIMPLE 0, "BOTON,A¤adir", 1838, 1848, PulsaAddArt;
     nBotony2 = FSalida;
     |CONTROL_SIMPLE 0, "BOTON,Cancelar", 1849, 1859, PulsaCancArt;
     nBotony3 = FSalida;
|FPRC

|PROCESO QuitaBotArt;
     |FIN_CONTROL_WINDOWS nBotony1;
     |FIN_CONTROL_WINDOWS nBotony2;
     |FIN_CONTROL_WINDOWS nBotony3;
     |PULSATECLA;
|FPRC;

|PROCESO PulsaSusArt;
     |PTEC 815;
|FPRC;
|PROCESO PulsaAddArt;
     |PTEC 816;
|FPRC;
|PROCESO PulsaCancArt;
     |PTEC 807;
|FPRC;

|PROCESO Carga_Tar;
     IFM2emo = FM2emo1<-;
     |ESPECIFICA "MEMORYFCOPY",FM2emo;
|FPRC;

|PROCESO Carga_22;
     IFM1emo = FM1emo1<-;
     |ESPECIFICA "MEMORYFILE",FM1emo;
|FPRC;

||--------------Precios Clientes/Articulos.
|PROCESO PreCliArt;
     nSwOferta = 0;
     nSwFolleto = 0;
     nSwCliArt = 0;
     |DDEFECTO #14;
     #14#0 = nCodCli; ||Cod.Cli.
     #14#1 = nCodArt; ||Cod.Art.
     |LEE 000#14=;
     |SI FSalida = 0;
          fFecha = ~;
          |SI #14#28 [ fFecha; |Y #14#29 ] fFecha;
               nSwCliArt = 1;
               |SI nEsPedido = 1;
                    #3#17 = #14#2;
               |SINO;
                    #3#17 = #14#2 + #14#2 % nRcoe;
               |FINSI;
               |SI aClienteSuper ! "";
                    #3#18 = #14#32; ||DTO
                    #3#19 = #14#34; ||comision
               |FINSI;
               #3#11 = #3#17;
               |SI EURODB = 2;
                    #3#24 = #3#11 * 166.386; ||Pvp-1 en pesetas
               #3#24 = #3#24 ! 0;
               |SINO;
                    #3#24 = #3#11 / 166.386; ||Pvp-1 en euros
               |FINSI;
               |HAZ RestoDtos;
          |FINSI;
     |SINO;
          |HAZ RestoDtos;
     |FINSI;
     #3#25 = #3#17 / 166.386;  ||Precio cliente articulo en euros
|FPRC;

|PROCESO TariOfe;
     |LEE 000#55=;
     |SI FSalida = 0;
          fFecha = ~;
          |SI fFecha ] #55#4; |Y fFecha [ #55#5;
               |ABRE #56;
               #56#0 = #55#0;
               #56#1 = nCodArt;
               |LEE 000#56=;
               |SI FSalida = 0;
                    |SI nEsPedido = 1;
                         #3#17 = #56#3;
                    |SINO;
                         #3#17 = #56#3 + #56#3 % nRcoe;
                    |FINSI;
                    #3#11 = #3#17;
                    |SI EURODB = 2;
                         #3#24 = #3#11 * 166.386; ||Pvp-1 en pesetas
                         #3#24 = #3#24 ! 0;
                    |SINO;
                         #3#24 = #3#11 / 166.386; ||Pvp-1 en euros
                    |FINSI;
                    #3#18 = 0;
                    |SI nTipoTarifa = 1;
                         nSwOferta = 1;
                    |SINO;
                         nSwFolleto = 1;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO RestoDtos;
     |SI nSwBus = 0;
          |HAZ BuscaMaximoDescuento;
          |SI aClienteSuper ! "";
               |SI nDescuento ! 0;
                    #3#18 = nDescuento;
               |SINO;
                    #3#18 = #agifa019#21;
               |FINSI;
          |FINSI;
     |FINSI;
     ||______________________________
     #3#17 = 0;
     || LEER TARIFAS NORMAL Y OFERTA
     |ABRE #44;
     #44#0 = nCodCli;
     |LEE 000#44=;
     |SI FSalida = 0;
          |ABRE #55;
          #55#0 = #44#1;
          nTipoTarifa = 1;
          |HAZ TariOfe;
          #55#0 = #44#2;
          nTipoTarifa = 2;
          |HAZ TariOfe;
          |CIERRA #55;
     |FINSI;
     |CIERRA #44;
|FPRC;

|PROCESO QuitaRaros;
     |QBF aAlfa;
     aCadena = "";
     aLen    = aAlfa % 0;
     nLen    = aLen;
     |PARA nCampo = 1;  |SI nCampo [ nLen;  |HACIENDO nCampo = nCampo + 1;
           nPosi = (100 * nCampo) + 1;
           aCaracter = aAlfa % nPosi;
           |SI aCaracter = "¤";  aCaracter = "¥"; |FINSI;
           aCadena = aCadena + aCaracter;
     |SIGUE;
     aAlfa = aCadena;
|FPRC;

|PROCESO RecalculaArAc;
     #22#0 = #3#0;
     |LEE 000#22=;
     |SI FSalida = 0;
          |DAREGN #22,nreg;
          nArAc = FSalida;
     |FINSI;
     |HAZ PonEstadoNavegador;
|FPRC;

|PROCESO SubMenu;
     aEstadoBotonPed="HIDE"; |HAZ EstadoBotonesPed; |HAZ QuitaBotonesPedido;
     aEstadoBotonSub="SHOW"; |HAZ EstadoBotonesSub;
     |HAZ PonBotSubMenu;
     |PARA; |SI; |HACIENDO;
          |LEETECLA aTecla;
          aTecla = aTecla % 203;
          |SI aTecla = 806;|O aTecla=807; |O aTecla=823; |SAL; |FINSI;
          nTecla = aTecla; nTecla = (nTecla - 824) + 1

          |SI nTecla ] 1; |Y  nTecla [ 6;
               aEstadoBotonSub="HIDE"; |HAZ EstadoBotonesSub; |HAZ QuitaBotonesSubMenu;
               |SI nTecla = 1;
                    swNomod = 0;
                    |HAZ ModificarPedido;
                    |SI swNomod = 0;
                         |HAZ MenuArticulos;
                    |FINSI;
                    SerieMod = "";
                    PedidMod = 0;
               |FINSI;
               |SI nTecla = 2;
                    |HAZ BorrarPedido;
               |FINSI;
               |SI nTecla = 3;
                    |HAZ ImprimirPedido;
               |FINSI;
               |SI nTecla = 4;
                    |ABRE #27;
                    |CONSULTA_F_CLAVE #1#27,minPedido,maxPedido;
                    |CIERRA #27;
                    ||ARA
               |FINSI;
               aEstadoBotonSub="SHOW"; |HAZ EstadoBotonesSub; |HAZ PonBotSubMenu;
          |FINSI;
     |SIGUE;
     aEstadoBotonSub="HIDE"; |HAZ EstadoBotonesSub; |HAZ QuitaBotonesSubMenu;
|FPRC;

|PROCESO PonBotSubMenu;
     |SI nSwEsCentral = 0;
          |CONTROL_SIMPLE 0, "BOTON,F2 Modificar", 2402, 2412, PulsaModifPedido;    nBotonx71 = FSalida;
          |CONTROL_SIMPLE 0, "BOTON,F3 Borrar", 2413, 2423, PulsaBorrarPedido;   nBotonx72 = FSalida;
     |FINSI;
     |CONTROL_SIMPLE 0, "BOTON,F4 Imprimir", 2424, 2434, PulsaImprimirPedido; nBotonx73 = FSalida;
     |CONTROL_SIMPLE 0, "BOTON,F5 VerDetalles", 2435, 2445, PulsaPendPedido;     nBotonx74 = FSalida;
     |CONTROL_SIMPLE 0, "BOTON,F12 SALIR", 2457, 2467, PulsaVolverPedido;   nBotonx75 = FSalida;
|FPRC;

|PROCESO PonPreCliArt;
     #3#17 = 0;
     |DDEFECTO #14;
     #14#0 = nCodCli; ||Cod.Cli.
     #14#1 = nCodArt; ||Cod.Art.
     |LEE 000#14=;
     |SI FSalida = 0;
          fFecha = ~;
          |SI #14#28 [ fFecha; |Y #14#29 ] fFecha;
               nSwCliArt = 1;
               |SI nEsPedido = 1;
                    #3#17 = #14#2;
               |SINO;
                    #3#17 = #14#2 + #14#2 % nRcoe;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;
