|FICHEROS;
     agifa186 #0;

     agifa134 #1;        ||Facturas
     agifa059 #2;        ||Lineas Factura
     agifa010 #3;        ||Albaran
     agifa071 #4;        ||Lineas albaran
     agifa104 #5;        ||Pedidos
     agifa073 #6;        ||Lineas Pedidos
     agifa036 #7;        ||Depositos
     agifa070 #8;        ||Lineas Depositos

     agifa079 #9;        ||Faturas Compras
     agifa072 #10;       ||Lineas de Facturas compras
     agifa077 #11;       ||Albaranes Ventas
     agifa080 #12;       ||Lineas de albaranes compras
     agifa081 #13;       ||Pedidos Compras
     agifa067 #14;       ||Lineas Pedidos Compras

     agifa084 #15;       ||Facturas Contado
     agifa069 #16;       ||Lineas de Facturas Contado
     agifa024 #17;
     agifa091 #18;

     agifa187 #50;       ||Historico de Cambios
     agifa065 #51;       ||Historico
     agis0002 #102;
     agifa007 #100;
     dsm00005 #905;
     dsm00006 #906;

     dscam045@ #1000;
     dscam004@ #1001;
     dscam003@ #1002;
     dscam008@ #1003;
     dscam009@ #1004;

     ||TODO CCC
     ||Anyadir que haga el proceso tambien para Vencimientos Factura
     ||cuando el tipo de cambio sea = 1.
     agifa133 #133;      ||Vencimientos Factura y Facturas Directas

     dsm00130 #130;

     || agrom011
     referen@;

     dsm00053 #153;
     dsm00083 #183;

     dsw00089 #89; || tmp excel
     agifa142 #142;

     agifa722 #722;

     dsw00090 #90;
     agifa501 #501;
     agifa502 #502;
|FIN;

|VARIABLES;
     &eaEntrega = "";
     nSwOrts = 0;
     &efFecAnt = @;
     &eaSerAnt = "";
     &enNumAnt = 0;
     &eaMensaje = "";
     &Tempo = "";
     &enSwVipei = 0;
     nHayExcel = 0;
     aTmp89 = "";
     aTmp90 = "";
     aRuta = "";
     nBoton1 = 0;
     &eaIva = "";
     &enTipo = 0;;
     &eaSerOrg = "";;
     &eaSerDes = "";
     &enNum = 0;
     &efFecOrg = @;
     &efFecDes = @;
     &eaTag    = "";

     aCli = "";
     aAno = "";
     aDFecha = "";
     aHFecha = "";
     fDFecha = @;
     fHFecha = @;

     aDef = "";
     &aDivisa = "";
     &aMoneda = "";

     fFecVto   = @;

     aCliente = "";
     aSer     = "";
     aSer1    = "";
     nRec     = 0;
     nCont    = 0;
     nCont1   = 0;
     nCont2   = 0;
     nSwError = 0;
     nSw      = 0;
     fFecha   = @;
     fFecha1  = @;
     nCalc    = 0;
     nCalc1   = 0;

     nLinea = 0;
     aFP      = "";
     aTipo = "";
     dArti = "";
     hArti = "";
     C29 = 0;
     C31 = 0;
     C39 = "";
     C37 = "";
     C28 = "";
     C30 = "";
     buena     = "N";
     puente    = "";
     articulo  = "";
     operacion = "";

     sw        = 0;
     num_lin   = 0;

     fecha     = @;

     aAlfa       = "";
     aAlfA       = "";
     aAlfb       = "";
     aAlfc       = "";
     aAlfd       = "";
     aAlfe       = "";
     aAlff       = "";
     aDirectorio = "";
     aDA = "";
     aExcel = "";
     nXls = 0;
     aIP = "";
|FIN;

---------------Modulo Orts ---------------------------------
|PROCESO OrtsPed;
     |DDEF aAlfa;
     aAlfa = aAlfa + "ortsm008";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          #referen@#0 = #6#28;
          #referen@#1 = #6#0;
          #referen@#2 = #6#1;
          |LEE 101#referen@.=;
          |SI FSalida = 0;
               |BORRA 020#referen@.a;
               #referen@#0 = #0#2;
               #referen@#1 = #0#4;
               |GRABA 020#referen@.n;
          |FINSI;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|PROCESO OrtsAlb;
     |DDEF aAlfa;
     aAlfa = aAlfa + "ortsm009";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          #referen@#0 = #4#29;
          #referen@#1 = #4#0;
          #referen@#2 = #4#1;
          |LEE 101#referen@.=;
          |SI FSalida = 0;
               |BORRA 020#referen@.a;
               #referen@#0 = #0#2;
               #referen@#1 = #0#4;
               |GRABA 020#referen@.n;
          |FINSI;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|PROCESO OrtsFacD;
     |DDEF aAlfa;
     aAlfa = aAlfa + "ortsm010";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          #referen@#0 = #16#20;
          #referen@#1 = #16#0;
          #referen@#2 = #16#1;
          |LEE 101#referen@.=;
          |SI FSalida = 0;
               |BORRA 020#referen@.a;
               #referen@#0 = #0#2;
               #referen@#1 = #0#4;
               |GRABA 020#referen@.n;
          |FINSI;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|PROCESO OrtsDep;
     |DDEF aAlfa;
     aAlfa = aAlfa + "ortsm011";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          #referen@#0 = #8#22;
          #referen@#1 = #8#0;
          #referen@#2 = #8#1;
          |LEE 101#referen@.=;
          |SI FSalida = 0;
               |BORRA 020#referen@.a;
               #referen@#0 = #0#2;
               #referen@#1 = #0#4;
               |GRABA 020#referen@.n;
          |FINSI;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;
------------------------------------------------------------
|PROCESO DesAmpliV;
     |ABRE #153;
     #153#0 = aDA;
     #153#1 = #0#1;
     #153#2 = #0#3;
     #153#3 = num_lin;
     #153#4 = 1;
     |LEE 101#153];
     |PARA; |SI FSalida = 0; |Y #153#0 = aDA; |Y #153#1 = #0#1;
               |Y #153#2 = #0#3; |Y #153#3 = num_lin; |HACIENDO;
          |BORRA 020#153a;
          #153#1 = #0#2;
          #153#2 = #0#4;
          |GRABA 020#153n;
          |LIBERA #153;
          |LEE 101#153s;
     |SIGUE;
     |CIERRA #153;
|FPRC;

|PROCESO DesAmpliC;
     |ABRE #183;
     #183#0 = aDA;
     #183#1 = #0#1;
     #183#2 = #0#3;
     #183#3 = num_lin;
     #183#4 = 1;
     |LEE 101#183];
     |PARA; |SI FSalida = 0; |Y #183#0 = aDA; |Y #183#1 = #0#1;
               |Y #183#2 = #0#3; |Y #183#3 = num_lin; |HACIENDO;
          |BORRA 020#183a;
          #183#1 = #0#2;
          #183#2 = #0#4;
          |GRABA 020#183n;
          |LIBERA #183;
          |LEE 101#183s;
     |SIGUE;
     |CIERRA #183;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO dsm00130;
     aAno = fFecVto; aAno = aAno % -104;
     aDFecha = (("00" + #130#2) % -102) +"."+(("00" + #130#3) % -102) +"."+aAno;
     aHFecha = (("00" + #130#4) % -102) +"."+(("00" + #130#5) % -102) +"."+aAno;
     fDFecha = aDFecha;
     fHFecha = aHFecha;
     |SI fFecVto ] fDFecha; |Y fFecVto [ fHFecha;
          fFecha = fHFecha + 1;
          #agifa133#3 = fFecha;
          |HAZ DiasFijos;
          fFecVto = #agifa133#3;
     |FINSI;
|FPRC;

|DEFBUCLE dsm00130;
     #130#1;
     ;
     aCli, 01;
     aCli, 99;
     ;
     NULL, dsm00130;
|FIN;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO dsm00006;
     |BORRA 020#906a;
     #906#4 = #0#2;
     #906#5 = #0#4;
     |GRABA 020#906n;
|FPRC;

|DEFBUCLE dsm00006;
     #906#1;
     ;
     dArti, 01, "01.01.0000", aTipo, #0#1, #0#3, 00001, "      ";
     hArti, 99, "31.12.9999", aTipo, #0#1, #0#3, 99999, "zzzzzz";
     be;
     NULL, dsm00006;
|FIN;

|PROCESO dsm00005;
     |BORRA 020#905a;
     #905#1 = #0#2;
     #905#2 = #0#4;
     |GRABA 020#905n;
|FPRC;

|DEFBUCLE dsm00005;
     #905#1;
     ;
     aTipo, #0#1, #0#3, 00001, "      ";
     aTipo, #0#1, #0#3, 99999, "zzzzzz";
     be;
     NULL, dsm00005;
|FIN;

|PROCESO Vertical;
     |BUCLE dsm00005;
     |BUCLE dsm00006;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO TipoIVA; |TIPO 7;
     |SI #0#0 = 2;
          |C_M #0#7, 1, "S";
          |ABRE #100;
          #100#26 = #0#2;
          |LEE 000#100=;
          |CIERRA #100;
          |SI #100#30 = "S";                 ||Serie Exportacion
               #0#7 = 0; |PINTA #0#7;
               |C_M #0#7, 1, "N";
          |FINSI;
     |SINO;
          |C_M #0#7, 1, "N";
     |FINSI;
|FPRC;


|PROCESO pintar; |TIPO 0;
     |SI #0#0 = 1; |PINTA 815 , "Facturas Ventas  ";  |FINSI;
     |SI #0#0 = 2; |PINTA 815 , "Albaranes Ventas ";  |FINSI;
     |SI #0#0 = 3; |PINTA 815 , "Pedidos Ventas   ";  |FINSI;
     |SI #0#0 = 4; |PINTA 815 , "Depositos Ventas ";  |FINSI;
     |SI #0#0 = 5; |PINTA 815 , "Facturas Compras ";  |FINSI;
     |SI #0#0 = 6; |PINTA 815 , "Albaranes Compras";  |FINSI;
     |SI #0#0 = 7; |PINTA 815 , "Pedidos Compras  ";  |FINSI;
     |SI #0#0 = 8; |PINTA 815 , "Facturas Contado ";  |FINSI;
|FPRC;

|PROCESO Empresas;
   aAlfa = aDirectorio + "fich/" + (("00000" + #dscam045@#0) % -105) + "/";
   |PATH_DAT #1001 aAlfa; |PATH_DAT #1002 aAlfa;
   |PATH_DAT #1003 aAlfa; |PATH_DAT #1004 aAlfa;
   |SI aTipo = "V";
      |ABRE #dscam003@; |ABRE #dscam004@; |SELECT #2#dscam004@;
      |SI nSw = 1;
         |SELECT #12#dscam003@;
         |DDEFECTO #dscam003@;
         #dscam003@#0 = aSer;  aSer = #dscam003@#0;
         #dscam003@#1 = nCont;
         |LEE 101#dscam003@.];
         |PARA; |SI FSalida = 0; |Y #dscam003@#0 = aSer; |Y #dscam003@#1 = nCont; |HACIENDO;
            |SI #dscam003@#4 = fFecha;
               |SI #dscam003@#14 ! "P"; nSwError = 1; |SAL; |FINSI;
            |FINSI;
            |LIBERA #dscam003@; |LEE 101#dscam003@.s;
         |SIGUE;
         |SELECT #1#dscam003@;

         |SI nSwError = 1; |ERROR10; |ACABA; |FINSI;

         #dscam004@#15 = 0;
         #dscam004@#0  = aSer;
         #dscam004@#1  = nCont;
         |LEE 101#dscam004@.];
         |PARA; |SI FSalida = 0; |Y #dscam004@#0  = aSer; |Y #dscam004@#1  = nCont; |HACIENDO;
            #dscam003@#40 = #dscam004@#17;
            |LEE 101#dscam003@.=;
            |SI FSalida = 0; |Y #dscam003@#4 = fFecha;
               nSwError = 1; |SAL;
            |FINSI;
            |LIBERA #dscam003@;
            |LIBERA #dscam004@; |LEE 101#dscam004@.s;
         |SIGUE;
      |FINSI;
      |SI nSw = 2;
         |SELECT #12#dscam003@; |DDEFECTO #dscam003@;
         #dscam003@#0 = aSer; aSer = #dscam003@#0;
         #dscam003@#1 = nCont;
         #dscam003@#2 = nRec;
         |LEE 101#dscam003@.];
         |PARA; |SI FSalida = 0; |Y #dscam003@#0 = aSer; |Y #dscam003@#1 = nCont;
          |Y #dscam003@#2 = nRec; |HACIENDO;
            |SI #dscam003@#4 = fFecha;
                #dscam003@#0 = aSer1; #dscam003@#1 = nCont1;
                |SI #0#5 ! #0#6; #dscam003@#3 = fFecVto; #dscam003@#4 = fFecha1; |FINSI;
                |GRABA 020#dscam003@.a;
                |SAL;
            |FINSI;
            |LIBERA #dscam003@; |LEE 101#dscam003@.s;
         |SIGUE;
         |SELECT #1#dscam003@;
      |FINSI;
      |CIERRA #dscam004@; |CIERRA #dscam003@;
   |FINSI;
   |SI aTipo = "C";
      |ABRE #dscam008@; |ABRE #dscam009@; |SELECT #2#dscam009@;
      |SI nSw = 1;
         |SELECT #2#dscam008@;
         |DDEFECTO #dscam008@;
         #dscam008@#0 = aSer;
         #dscam008@#1 = nCont;
         |LEE 101#dscam008@.];
         |PARA; |SI FSalida = 0; |Y #dscam008@#0  = aSer; |Y #dscam008@#1  = nCont; |HACIENDO;
            |SI #dscam008@#4 = fFecha;
               |SI #dscam008@#14 ! "P"; nSwError = 1; |SAL; |FINSI;
            |FINSI;
            |LIBERA #dscam008@; |LEE 101#dscam008@.s;
         |SIGUE;
         |SELECT #1#dscam008@;

         |SI nSwError = 1; |ERROR10; |ACABA; |FINSI;

         #dscam009@#13 = 0;
         #dscam009@#0  = aSer;
         #dscam009@#1  = nCont;
         |LEE 101#dscam009@.];
         |PARA; |SI FSalida = 0; |Y #dscam009@#0  = aSer; |Y #dscam009@#1  = nCont; |HACIENDO;
            #dscam008@#40 = #dscam009@#14;
            |LEE 101#dscam008@.=;
            |SI FSalida = 0; |Y #dscam008@#4 = fFecha;
               nSwError = 1; |SAL;
            |FINSI;
            |LIBERA #dscam008@;
            |LIBERA #dscam009@; |LEE 101#dscam009@.s;
         |SIGUE;
      |FINSI;
      |CIERRA #dscam009@; |CIERRA #dscam008@;
   |FINSI;
|FPRC;

|DEFBUCLE Empresas;
#dscam045@#1002;
2;
#48#0, 001, aTipo;
#48#0, 999, aTipo;
;
NULL,Empresas;
|FIN;

|PROCESO MiraMovtos;
   nSwError = 0;
   |DBASS aDirectorio; |QBF aDirectorio;
   aDirectorio = aDirectorio + "dscarter/";
   aAlfa = aDirectorio + "def/dscam045.mas";
   |CARGA_DEF aAlfa, dscam045@;
   |SI FSalida = 0;
      aAlfa = aDirectorio + "fich/"; |PATH_DAT #1000 aAlfa;
      aAlfa = aDirectorio + "def/dscam004.mas"; |CARGA_DEF aAlfa, dscam004@;
      aAlfa = aDirectorio + "def/dscam003.mas"; |CARGA_DEF aAlfa, dscam003@;
      aAlfa = aDirectorio + "def/dscam008.mas"; |CARGA_DEF aAlfa, dscam008@;
      aAlfa = aDirectorio + "def/dscam009.mas"; |CARGA_DEF aAlfa, dscam009@;
      |BUCLE Empresas;
      |DESCARGA_DEF #dscam009@; |DESCARGA_DEF #dscam008@;
      |DESCARGA_DEF #dscam003@; |DESCARGA_DEF #dscam004@; |DESCARGA_DEF #dscam045@;
   |FINSI;
|FPRC;

|PROCESO actual; |TIPO 0;
     |SI FSalida = 2; |ACABA; |FINSI;
     |SI #0#0 = 1;       ||Facturas Ventas
          |ABRE #1; #1#49 = #0#1;  #1#0 = #0#3;   |LEE 001#1=;
          |SI FSalida ! 0;
               buena = "N";
               |SI #0#8 = "S";
                    eaMensaje = "Factura Inexistente";
               |SINO;
                    |MENAV "0000Atencion Factura Inexistente";
                    |ERROR;
               |FINSI;
          |SINO;
               |SI #1#48 = "S";
                    buena = "N";
                    |MENAV "0000Factura contabilizada...";
                    |ERROR; |ACABA;
               |FINSI;
               |SI #1#45 = "S";
                    buena = "N";
                    |MENAV "0000Factura impresa...";
                    |ERROR; |ACABA;
               |FINSI;

               aSer = #0#1; nCont = #0#3; fFecha = #1#1; aTipo = "V"; nSw = 1;
               |HAZ MiraMovtos;
               |SI nSwError = 1; |Y enSwVipei ! 0;
                  buena = "N";
                  |SI #0#8 = "S";
                      eaMensaje = "La factura tiene vencimientos con movimientos";
                  |SINO;
                      |MENAV "0000La factura tiene vencimientos con movimientos";
                      |ERROR;
                  |FINSI;
               |SINO;
                  |SI #1#48 = "S"; |Y enSwVipei ! 0;
                     buena = "N";
                     |SI #0#8= "S";
                         eaMensaje = "La factura esta contabilizada";
                     |SINO;
                         |MENAV "0000La factura esta contabilizada";
                         |ERROR;
                     |FINSI;
                  |SINO;
                     buena = "S";
                     |SI Campo = 3;
                        #0#5 = #1#1;   |PINTA #0#5;
                        #0#6 = #1#1;   |PINTA #0#6;
                        #0#4 = #1#0;   |PINTA #0#4;
                        #0#2 = #1#49;  |PINTA #0#2;
                     |FINSI;
                  |FINSI;
               |FINSI;
          |FINSI;
          |CIERRA #1;
     |FINSI;
     |SI #0#0 = 2;       ||Albaranes Ventas
          |ABRE #3; #3#52 = #0#1;  #3#0 = #0#3;   |LEE 001#3=;
          |SI #3#38 = "S"; |Y FSalida = 0;
               buena = "N";
               |SI #0#8 = "S";
                    eaMensaje = "Albaran Facturado";
               |SINO;
                    |MENAV "0000Atencion Albaran Facturado";
                    |ERROR;
               |FINSI;
          |FINSI;
          |SI FSalida ! 0;
               buena = "N";
               |SI #0#8 = "S";
                    eaMensaje = "Albaran Inexistente";
               |SINO;
                    |MENAV "0000Atencion Albaran Inexistente";
                    |ERROR;
               |FINSI;
          |SINO;
               |SI Campo = 3;
                    #0#5 = #3#1;   |PINTA #0#5;
                    #0#6 = #3#1;   |PINTA #0#6;
                    #0#4 = #3#0;   |PINTA #0#4;
                    #0#2 = #3#52;  |PINTA #0#2;
               |FINSI;
               buena = "S";
          |FINSI;
          |CIERRA #3;
     |FINSI;
     |SI #0#0 = 3;       ||Pedidos Ventas
          |ABRE #5; #5#25 = #0#1;  #5#0 = #0#3;   |LEE 001#5=;
          |SI FSalida ! 0;
               buena = "N";
               |SI #0#8 = "S";
                    eaMensaje = "Pedido Inexistente";
               |SINO;
                    |MENAV "0000Atencion Pedido Inexistente";
                    |ERROR;
               |FINSI;
          |SINO;
               buena = "S";
               |SI Campo = 3;
                    #0#5 = #5#1;   |PINTA #0#5;
                    #0#6 = #5#1;   |PINTA #0#6;
                    #0#4 = #5#0;   |PINTA #0#4;
                    #0#2 = #5#25;  |PINTA #0#2;
               |FINSI;
          |FINSI;
          |CIERRA #5;
     |FINSI;
     |SI #0#0 = 4;       ||Depositos Ventas
          |ABRE #7; #7#46 = #0#1;  #7#0 = #0#3;   |LEE 001#7=;
          |SI FSalida ! 0;
               buena = "N";
               |SI #0#8 = "S";
                    eaMensaje = "Deposito Inexistente";
               |SINO;
                    |MENAV "0000Atencion Deposito Inexistente";
                    |ERROR;
               |FINSI;
          |SINO;
               buena = "S";
               |SI Campo = 3;
                    #0#5 = #7#1;   |PINTA #0#5;
                    #0#6 = #7#1;   |PINTA #0#6;
                    #0#4 = #7#0;   |PINTA #0#4;
                    #0#2 = #7#46;  |PINTA #0#2;
               |FINSI;
          |FINSI;
          |CIERRA #7;
     |FINSI;
     |SI #0#0 = 5;       ||Facturas Compra
          |ABRE #9; #9#66 = #0#1;  #9#0 = #0#3;   |LEE 001#9=;
          |SI FSalida ! 0;
               buena = "N";
               |SI #0#8 = "S";
                    eaMensaje = "Factura Inexistente";
               |SINO;
                    |MENAV "0000Atencion Factura Inexistente";
                    |ERROR;
               |FINSI;
          |SINO;
               |SI #9#48 = "S";
                    buena = "N";
                    |MENAV "0000Factura contabilizada...";
                    |ERROR; |ACABA;
               |FINSI;
               |SI #9#45 = "S";
                    buena = "N";
                    |MENAV "0000Factura impresa...";
                    |ERROR; |ACABA;
               |FINSI;
              aSer = #0#1; nCont = #0#3; fFecha = #9#1; aTipo = "C"; nSw = 1;
              |HAZ MiraMovtos;
              |SI nSwError = 1;
                  buena = "N";
                  |SI #0#8 = "S";
                       eaMensaje = "La factura tiene vencimientos con movimientos";
                  |SINO;
                       |MENAV "0000La factura tiene vencimientos con movimientos";
                       |ERROR;
                  |FINSI;
              |SINO;
                  |SI #9#48 = "S";
                     buena = "N";
                     |SI #0#8 = "S";
                         eaMensaje = "La factura esta contabilizada";
                     |SINO;
                         |MENAV "0000La factura esta contabilizada";
                         |ERROR;
                     |FINSI;
                  |SINO;
                     buena = "S";
                     |SI Campo = 3;
                         #0#5 = #9#1;   |PINTA #0#5;
                         #0#6 = #9#1;   |PINTA #0#6;
                         #0#4 = #9#0;   |PINTA #0#4;
                         #0#2 = #9#66;  |PINTA #0#2;
                     |FINSI;
                  |FINSI;
              |FINSI;
          |FINSI;
          |CIERRA #9;
     |FINSI;
     |SI #0#0 = 6;       ||Albaranes Compra
          |ABRE #11; #11#50 = #0#1;  #11#0 = #0#3;   |LEE 001#11=;
          |SI #11#38 = "S"; |Y FSalida = 0;
               buena = "N";
               |SI #0#8 = "S";
                    eaMensaje = "Albaran Facturado";
               |SINO;
                    |MENAV "0000Atencion Albaran Facturado";
                    |ERROR;
               |FINSI;
          |FINSI;
          |SI FSalida ! 0;
               buena = "N";
               |SI #0#8 = "S";
                    eaMensaje = "Albaran Inexistente";
               |SINO;
                    |MENAV "0000Atencion Albaran Inexistente";
                    |ERROR;
               |FINSI;
          |SINO;
               buena = "S";
               |SI Campo = 3;
                    #0#5 = #11#1;   |PINTA #0#5;
                    #0#6 = #11#1;   |PINTA #0#6;
                    #0#4 = #11#0;   |PINTA #0#4;
                    #0#2 = #11#50;  |PINTA #0#2;
               |FINSI;
          |FINSI;
          |CIERRA #11;
     |FINSI;
     |SI #0#0 = 7;       ||Pedidos Compra
          |ABRE #13; #13#25 = #0#1;  #13#0 = #0#3;   |LEE 001#13=;
          |SI FSalida ! 0;
               buena = "N";
               |SI #0#8 = "S";
                    eaMensaje = "Pedido Inexistente";
               |SINO;
                    |MENAV "0000Atencion Pedido Inexistente";
                    |ERROR;
               |FINSI;
          |SINO;
               buena = "S";
               |SI Campo = 3;
                    #0#5 = #13#1;   |PINTA #0#5;
                    #0#6 = #13#1;   |PINTA #0#6;
                    #0#4 = #13#0;   |PINTA #0#4;
                    #0#2 = #13#25;  |PINTA #0#2;
               |FINSI;
          |FINSI;
          |CIERRA #13;
     |FINSI;
     |SI #0#0 = 8;       ||Facturas Contado
          |ABRE #15; #15#48 = #0#1;  #15#0 = #0#3;   |LEE 001#15=;
          |SI FSalida ! 0;
               buena = "N";
               |SI #0#8 = "S";
                    eaMensaje = "Factura Inexistente";
               |SINO;
                    |MENAV "0000Atencion Factura Inexistente";
                    |ERROR;
               |FINSI;
          |SINO;
               |SI #15#39 = "S";
                    buena = "N";
                    |MENAV "0000Factura contabilizada...";
                    |ERROR; |ACABA;
               |FINSI;
               |SI #15#10 = "S";
                    buena = "N";
                    |MENAV "0000Factura impresa...";
                    |ERROR; |ACABA;
               |FINSI;
              aSer = #0#1; nCont = #0#3; fFecha = #15#1; aTipo = "V"; nSw = 1;
              |HAZ MiraMovtos;
              |SI nSwError = 1;
                  buena = "N";
                  |SI #0#8 = "S";
                      eaMensaje = "La factura tiene vencimientos con movimientos";
                  |SINO;
                      |MENAV "0000La factura tiene vencimientos con movimientos";
                      |ERROR;
                  |FINSI;
              |SINO;
                  |SI #15#39 = "S";
                     buena = "N";
                     |SI #0#8 = "S";
                          eaMensaje = "La factura esta contabilizada";
                     |SINO;
                          |MENAV "0000La factura esta contabilizada";
                          |ERROR;
                     |FINSI;
                  |SINO;
                     buena = "S";
                     |SI Campo = 3;
                        #0#5 = #15#1;   |PINTA #0#5;
                        #0#6 = #15#1;   |PINTA #0#6;
                        #0#4 = #15#0;   |PINTA #0#4;
                        #0#2 = #15#48;  |PINTA #0#2;
                     |FINSI;
                  |FINSI;
              |FINSI;
          |FINSI;
          |CIERRA #15;
     |FINSI;
|FPRC;

|PROCESO nueva; |TIPO 0;
     |SI FSalida = 2; |O #0#4 = 0; |ACABA; |FINSI;
     |SI #0#0 = 1;       ||Facturas Ventas
          |ABRE #1;  #1#49 = #0#2;  #1#0 = #0#4;   |LEE 001#1=;
          |SI FSalida = 0;
               buena = "N";
               |SI #0#8 = "S";
                    eaMensaje = "Esta Factura Ya Existe";
               |SINO;
                    |MENAV "0000Atencion Esta Factura Ya Existe";
                    |ERROR;
               |FINSI;
          |SINO;
               buena = "S";
          |FINSI;
          |CIERRA #1;
     |FINSI;
     |SI #0#0 = 2;       ||Albaranes Ventas
          |ABRE #3;  #3#52 = #0#2;  #3#0 = #0#4;   |LEE 001#3=;
          |SI FSalida = 0;
               buena = "N";
               |SI #0#8 = "S";
                    eaMensaje = "Este Albaran Ya Existe";
               |SINO;
                    |MENAV "0000Atencion Este Albaran Ya Existe";
                    |ERROR;
               |FINSI;
          |SINO;
               buena = "S";
          |FINSI;
          |CIERRA #3;
     |FINSI;
     |SI #0#0 = 3;       ||Pedidos Ventas
          |ABRE #5;  #5#25 = #0#2;  #5#0 = #0#4;   |LEE 001#5=;
          |SI FSalida = 0;
               buena = "N";
               |SI #0#8 = "S";
                    eaMensaje  = "Este Pedido Ya Existe":
               |SINO;
                   |MENAV "0000Atencion Este Pedido Ya Existe";
                   |ERROR;
               |FINSI;
          |SINO;
               buena = "S";
          |FINSI;
          |CIERRA #5;
     |FINSI;
     |SI #0#0 = 4;       ||Depositos Ventas
          |ABRE #7;  #7#46 = #0#2;  #7#0 = #0#4;   |LEE 001#7=;
          |SI FSalida = 0;
               buena = "N";
               |SI #0#8 = "S";
                    eaMensaje = "Este Deposito Ya Existe";
               |SINO;
                   |MENAV "0000Atencion Este Deposito Ya Existe";
                   |ERROR;
               |FINSI;
          |SINO;
               buena = "S";
          |FINSI;
          |CIERRA #7;
     |FINSI;
     |SI #0#0 = 5;       ||Factura Compras
          |ABRE #9;  #9#66 = #0#2;  #9#0 = #0#4;   |LEE 001#9=;
          |SI FSalida = 0;
               buena = "N";
               |SI #0#8 = "S";
                    eaMensaje = "Esta Factura Ya Existe";
               |SINO;
                    |MENAV "0000Atencion Esta Factura Ya Existe";
                    |ERROR;
               |FINSI;
          |SINO;
               buena = "S";
          |FINSI;
          |CIERRA #9;
     |FINSI;
     |SI #0#0 = 6;       ||Albaranes Compras
          |ABRE #11;  #11#50 = #0#2;  #11#0 = #0#4;   |LEE 001#11=;
          |SI FSalida = 0;
               buena = "N";
               |SI #0#8 = "S";
                    eaMensaje = "Este Albaran Ya Existe";
               |SINO;
                    |MENAV "0000Atencion Este Albaran Ya Existe";
                    |ERROR;
               |FINSI;
          |SINO;
               buena = "S";
          |FINSI;
          |CIERRA #11;
     |FINSI;
     |SI #0#0 = 7;       ||Pedidos Compras
          |ABRE #13;  #13#25 = #0#2;  #13#0 = #0#4;   |LEE 001#13=;
          |SI FSalida = 0;
               buena = "N";
               |SI #0#8 = "S";
                    eaMensaje = "Este Pedido Ya Existe";
               |SINO;
                    |MENAV "0000Atencion Este Pedido Ya Existe";
                    |ERROR;
               |FINSI;
          |SINO;
               buena = "S";
          |FINSI;
          |CIERRA #13;
     |FINSI;
     |SI #0#0 = 8;       ||Facturas Contado
          |ABRE #15;  #15#48 = #0#2;  #15#0 = #0#4;   |LEE 001#15=;
          |SI FSalida = 0;
               buena = "N";
               |SI #0#8 = "S";
                    eaMensaje = "Esta Factura Ya Existe";
               |SINO;
                    |MENAV "0000Atencion Esta Factura Ya Existe";
                    |ERROR;
               |FINSI;
          |SINO;
               buena = "S";
          |FINSI;
          |CIERRA #15;
     |FINSI;
|FPRC;

|PROCESO actu_187;
     |ABRE #50;
     #50#0 = #0#0;
     #50#1 = 999999999;
     |LEE 001#50];
     |SI FSalida = 0;
          |LEE 001#50a;
     |SINO;
          |LEE 001#50u;
     |FINSI;
     |SI FSalida = 0; |Y #50#0 = #0#0;
          #50#0 = #0#0;
          #50#1 = #50#1 + 1;
     |SINO;
          #50#0 = #0#0;
          #50#1 = 1;
     |FINSI;
     #50#2 = #0#1;  #50#3 = #0#2;  #50#4 = #0#3;  #50#5 = #0#4;
     #50#6 = fecha;
     #50#7 = #0#5;
     #50#8 = #0#6;
     |GRABA 021#50n;
     |LIBERA #50;
     |CIERRA #50;
|FPRC;

||____________________________________/ CAMBIO NUMERO FACTURAS VENTAS

|PROCESO pasa01;
     |ABRE #133;
     |ABRE #1;
     |ABRE #3;
     #1#49 = #0#1;
     #1#0 = #0#3;
     |LEE 101#1=;
     |SI FSalida = 0;
          aDivisa = #1#58;
          aMoneda = #1#60;
          |HAZ Divisas134;
          |BUCLELIN 2pasa01l#1;
          aFP = #1#11; aCliente = #1#2;

          |||HAZ PasaVencimientos;

          |BORRA 001#1a;
          eaSerAnt = #1#49;
          enNumAnt = #1#0;
          efFecAnt = #1#1;
          #1#49 = #0#2;
          #1#0 = #0#4;
          #1#1 = #0#6;
          |GRABA 021#1n;
          |SI #0#5 ! #0#6;
               |LEE 121#1=;
               |SI FSalida = 0;
                    |HAZ CalCabAgifa134;
                    |GRABA 020#1a;
               |FINSI;
          |FINSI;
          |HAZ actu_187;
          |HAZ VtoFactuVta;
          |SI enSwVipei = 0;
               |HAZ VipeiModiFac;
          |FINSI;
     |FINSI;
     |LIBERA #1;
     |CIERRA #1;
     |CIERRA #3;
     |CIERRA #133;
|FPRC;

|PROCESO pasa01l;
     #3#52 = #2#15;
     #3#0 = #2#2;
     |LEE 101#3=;
     |SI FSalida = 0;
          |BUCLELIN 2pasa01l1#3;
          #3#53 = #0#2;
          #3#39 = #0#4;
          |GRABA 021#3a;
     |FINSI;
     |LIBERA #3;
     |BORRA 001#2a;
     #2#14 = #0#2;
     #2#0 = #0#4;
     |GRABA 021#2n;
     |LIBERA #2;
|FPRC;

|PROCESO pasa01l1;
     |LEE 101#4=;
     |SI FSalida = 0;
          #4#30 = #0#2;
          #4#26 = #0#4;
          |GRABA 021#4a;
     |FINSI;
     |LIBERA #4;
|FPRC;

||____________________________________/ CAMBIO NUMERO ALBARAN VENTAS

|PROCESO pasa02;
     |ABRE #3;
     #3#52 = #0#1;
     #3#0 =  #0#3;
     |LEE 001#3=;
     |SI FSalida = 0;
          aDivisa = #3#68;
          aMoneda = #3#70;
          |HAZ Divisas010;
          puente = #3#39;     |QBF puente;
          |SI #3#38 = "S"; |Y puente ! "";
               |ABRE #2;
               #2#14 = #3#53;
               #2#0 = #3#39;
               |LEE 101#2];
               |PARA ; |SI FSalida = 0; |Y #2#0 = #3#39;
                                        |Y #2#14 = #3#53; |HACIENDO;
                    |SI #2#15 = #3#52; |Y #2#2 = #3#0;
                         #2#2 = #0#4;
                         #2#15 = #0#2;
                         |GRABA 021#2a;
                         |LIBERA #2;
                         |SAL;
                    |FINSI;
                    |LIBERA #2;
                    |LEE 101#2s;
               |SIGUE;
               |CIERRA #2;
          |FINSI;
          |ABRE #51;          ||Abro el historico
          |BUCLELIN 2pasa02l#3;
          |CIERRA #51;
          |HAZ actu_187;
          |BORRA 020#3a;
          #3#52 = #0#2;
          #3#0 = #0#4;
          #3#1 = #0#6;
          |GRABA 021#3n;

          eaEntrega = "A"; |HAZ EntregaCta;
     |FINSI;
     |LIBERA #3;
     |CIERRA #3;
|FPRC;

|PROCESO pasa02l;        ||Actualizo el historico de las lineas de albaran
     articulo = #4#2;
     |SI #3#43 = "N";
          operacion = "AV";  ||Codigo Operacion
     |SINO;
          operacion = "BV";  ||Codigo Operacion
     |FINSI;
     num_lin = #4#1;
     |HAZ hist_065;

     |SI nSwOrts = 0; |HAZ OrtsAlb; |FINSI;
     |BORRA 021#4a;
     #4#29 = #0#2;
     #4#0 = #0#4;
     |GRABA 021#4n;

     aDA = "A"; |HAZ DesAmpliV;
|FPRC;

|PROCESO hist_065;
     #51#0 = articulo;  ||Articulo
     #51#1 = #0#5;      ||Fecha
     #51#2 = operacion; ||Codigo Operacion
     #51#3 = #0#3;      ||Documento
     #51#4 = num_lin;   ||Numero de linea
     #51#11 = #0#1;     ||Serie
     |LEE 101#51=;
     |SI FSalida = 0;
          |BORRA 020#51a;
          #51#11 = #0#2;
          #51#3 = #0#4;
          #51#1 = #0#6;
          |GRABA 021#51n;
     |FINSI;
     |LIBERA #51;
|FPRC;

||________________________________________/ CAMBIO NUMERO PEDIDOS VENTAS

|PROCESO pasar03l;
     #4#31 = #0#2;
     #4#12 = #0#4;
     |GRABA 021#4a;
     |LIBERA #4;
|FPRC;

|DEFBUCLE pasar03;
#4#1;
31 , 12;       ||Lo busco por serie Pedido y numero pedido
"     " ,       0 ,   0 , #0#1 , #0#3;
"zzzzz" ,  999999 , 999 , #0#1 , #0#3;
be;
NULL , pasar03l;
|FIN;

|PROCESO pasa03;
     |ABRE #5;
     #5#25 = #0#1;
     #5#0 = #0#3;
     |LEE 001#5=;
     |SI FSalida = 0;
          aDivisa = #5#35;
          aMoneda = #5#37;
          |HAZ Divisas104;
          |BUCLELIN 2pasa03l#5;
          |BUCLE pasar03;
          |HAZ actu_187;
          |BORRA 001#5a;
          #5#25 = #0#2;
          #5#0 = #0#4;
          #5#1 = #0#6;
          |GRABA 021#5n;
          eaEntrega = "P"; |HAZ EntregaCta;
     |FINSI;
     |LIBERA #5;
     |CIERRA #5;
|FPRC;

|PROCESO pasa03l;
     |SI nSwOrts = 0; |HAZ OrtsPed; |FINSI;

     |BORRA 001#6a;
     #6#28 = #0#2;
     #6#0 = #0#4;
     |GRABA 021#6n;
     |LIBERA #6;

     num_lin = #6#1;
     aDA = "P"; |HAZ DesAmpliV;
|FPRC;

||________________________________________/ CAMBIO NUMERO DEPOSITOS VENTAS

|PROCESO pasar04l;
     #4#32 = #0#2;
     #4#18 = #0#4;
     |GRABA 021#4a;
     |LIBERA #4;
|FPRC;

|DEFBUCLE pasar04;
#4#1;
32 , 18;       ||Lo busco por serie Deposito y numero Deposito
"     " ,       0 ,   0 , #0#1 , #0#3;
"zzzzz" ,  999999 , 999 , #0#1 , #0#3;
be;
NULL , pasar04l;
|FIN;

|PROCESO pasa04;
     |ABRE #7;
     #7#46 = #0#1;
     #7#0 = #0#3;
     |LEE 001#7=;
     |SI FSalida = 0;
          aDivisa = #7#49;
          aMoneda = #7#51;
          |HAZ Divisas036;
          sw = 0;
          buena = "N";
          |BUCLELIN 2pasa04l#7;
          |SI buena = "S";
               |BUCLE pasar04;
          |FINSI;
          |HAZ actu_187;
          |BORRA 001#7a;
          #7#46 = #0#2;
          #7#0 = #0#4;
          #7#1 = #0#6;
          |GRABA 021#7n;
          |SI #0#5 ! #0#6;
               |LEE 121#7=;
               |SI FSalida = 0;
                    |HAZ LimCabAgifa036;
                    |BUCLELIN 2 CalCabAgifa036 #7;
                    |GRABA 020#7a;
               |FINSI;
          |FINSI;
     |FINSI;
     |LIBERA #7;
     |CIERRA #7;
|FPRC;

|PROCESO pasa04l;
     |SI #8#18 ! 0; |Y sw = 0;
          buena = "S";
          sw = 1;
     |SINO;
          buena = "N";
     |FINSI;
     articulo = #8#2;
     num_lin = #8#1;
     |SI #8#18 ! 0;
          operacion = "DP";
          |HAZ hist_065;
     |FINSI;
     |SI #8#19 ! 0;
          operacion = "DV";
          |HAZ hist_065;
     |FINSI;

     |SI nSwOrts = 0; |HAZ OrtsDep; |FINSI;
     |BORRA 001#8a;
     #8#22 = #0#2;
     #8#0 = #0#4;
     |GRABA 021#8n;
     |LIBERA #8;

     aDA = "D"; |HAZ DesAmpliV;
|FPRC;


||____________________________________/ CAMBIO NUMERO FACTURAS COMPRAS

|PROCESO pasa05;
     |ABRE #9;
     |ABRE #11;
     #9#66 = #0#1;
     #9#0 = #0#3;
     |LEE 001#9=;
     |SI FSalida = 0;
          aDivisa = #9#75;
          aMoneda = #9#77;
          |HAZ Divisas079;
          |BUCLELIN 2pasa05l#9;
          |BORRA 001#9a;
          #9#66 = #0#2;
          #9#0 = #0#4;
          #9#1 = #0#6;
          |GRABA 021#9n;
          |HAZ actu_187;
          |SI #0#5 ! #0#6;
               |LEE 121#9=;
               |SI FSalida = 0;
                    |HAZ CalCabAgifa079;
                    |GRABA 020#9a;
               |FINSI;
          |FINSI;
     |FINSI;
     |LIBERA #9;
     |CIERRA #9;
     |CIERRA #11;
|FPRC;

|PROCESO pasa05l;
     #11#50 = #10#17;         ||Serie albaran
     #11#0 = #10#2;
     |LEE 101#11=;
     |SI FSalida = 0;
          |BUCLELIN 2pasa05l1#11;
          #11#51 = #0#2;
          #11#39 = #0#4;
          #11#77 = #0#5;
          |GRABA 021#11a;
     |FINSI;
     |LIBERA #11;
     |BORRA 001#10a;
     #10#16 = #0#2;
     #10#0 = #0#4;
     |GRABA 021#10n;
     |LIBERA #10;
|FPRC;

|PROCESO pasa05l1;
     |LEE 101#12=;
     |SI FSalida = 0;
          #12#28 = #0#2;
          #12#25 = #0#4;
          |GRABA 021#12a;
     |FINSI;
     |LIBERA #12;
|FPRC;

||____________________________________/ CAMBIO NUMERO ALBARAN COMPRAS

|PROCESO pasa06;
     |ABRE #11;
     #11#50 = #0#1;
     #11#0 =  #0#3;
     |LEE 001#11=;
     |SI FSalida = 0;
          aDivisa = #11#56;
          aMoneda = #11#58;
          |HAZ Divisas077;
          puente = #11#39;     |QBF puente;
          |SI #11#38 = "S"; |Y puente ! "";
               |ABRE #10;
               #10#16 = #11#51;
               #10#0 = #11#39;
               |LEE 101#10];
               |PARA ; |SI FSalida = 0; |Y #10#0 = #11#39;
                                        |Y #10#16 = #11#51; |HACIENDO;
                    |SI #10#17 = #11#50; |Y #10#2 = #11#0;
                         #10#2 = #0#4;
                         #10#17 = #0#2;
                         |GRABA 021#10a;
                         |LIBERA #10;
                         |SAL;
                    |FINSI;
                    |LIBERA #10;
                    |LEE 101#10s;
               |SIGUE;
               |CIERRA #10;
          |FINSI;
          |ABRE #51;          ||Abro el historico
          |BUCLELIN 2pasa06l#11;
          |CIERRA #51;
          |HAZ actu_187;
          |BORRA 001#11a;
          #11#50 = #0#2;
          #11#0 = #0#4;
          #11#1 = #0#6;
          |GRABA 021#11n;
          |SI #0#5 ! #0#6;
               |LEE 121#11=;
               |SI FSalida = 0;
                    |HAZ LimCabAgifa077;
                    |BUCLELIN 2 CalCabAgifa077 #11;
                    |GRABA 020#11a;
               |FINSI;
          |FINSI;
     |FINSI;
     |LIBERA #11;
     |CIERRA #11;
|FPRC;

|PROCESO pasa06l;        ||Actualizo el historico de las lineas de albaran
     articulo = #12#2;
     |SI #11#42 = "N";
          operacion = "AC";  ||Codigo Operacion
     |SINO;
          operacion = "BC";  ||Codigo Operacion
     |FINSI;
     num_lin = #12#1;
     |BORRA 001#12a;
     #12#27 = #0#2;
     #12#0 = #0#4;
     |GRABA 021#12n;
     |HAZ hist_065;
     aDA = "A"; |HAZ DesAmpliC;
|FPRC;

||________________________________________/ CAMBIO NUMERO PEDIDOS COMPRAS

|PROCESO pasar07l;
     #12#29 = #0#2;
     #12#12 = #0#4;
     |GRABA 021#12a;
     |LIBERA #12;
|FPRC;

|DEFBUCLE pasar07;
#12#1;
29 , 12;       ||Lo busco por serie Pedido y numero pedido
"     " ,       0 ,   0 , #0#1 , #0#3;
"zzzzz" ,  999999 , 999 , #0#1 , #0#3;
be;
NULL , pasar07l;
|FIN;

|PROCESO pasa07;
     |ABRE #13;
     #13#25 = #0#1;
     #13#0 = #0#3;
     |LEE 001#13=;
     |SI FSalida = 0;
          aDivisa = #13#27;
          aMoneda = #13#29;
          |HAZ Divisas081;
          |BUCLELIN 2pasa07l#13;
          |BUCLE pasar07;
          |HAZ actu_187;
          |BORRA 001#13a;
          #13#25 = #0#2;
          #13#0 = #0#4;
          #13#1 = #0#6;
          |GRABA 021#13n;
     |FINSI;
     |LIBERA #13;
     |CIERRA #13;
|FPRC;

|PROCESO pasa07l;
     |BORRA 001#14a;
     #14#28 = #0#2;
     #14#0 = #0#4;
     |GRABA 021#14n;
     |LIBERA #14;
     num_lin = #14#1;
     aDA = "P"; |HAZ DesAmpliC;
|FPRC;


||________________________________________/ CAMBIO NUMERO FACTURAS CONTADO

|PROCESO pasa08l;
     |LEE 101#16=;
     |SI FSalida = 0;
          |SI nSwOrts = 0; |HAZ OrtsFacD; |FINSI;

          |BORRA 021#16a;
          #16#20 = #0#2;
          #16#0 = #0#4;
          |GRABA 021#16n;
          articulo = #16#2;
          num_lin  = #16#1;
          operacion = "FC";
          |ABRE #51;
          |HAZ hist_065;
          |CIERRA #51;
          aDA = "F"; |HAZ DesAmpliV;
     |FINSI;
     |LIBERA #16;
|FPRC;

|PROCESO LinTiq;
     #502#9 = #0#6;
     |GRABA 020#502a;
|FPRC;

|PROCESO pasa08;
     |ABRE #133;
     |ABRE #15;
     #15#48 = #0#1;
     #15#0 = #0#3;
     |LEE 001#15=;
     |SI FSalida = 0;
          aDivisa = #15#65;
          aMoneda = #15#67;
          |HAZ Divisas084;
          |BUCLELIN 2pasa08l#15;
          aFP = #15#8; aCliente = #15#3;

          |||HAZ PasaVencimientos;

          |HAZ actu_187;
          |BORRA 001#15a;
          eaSerAnt = #15#48;
          enNumAnt = #15#0;
          efFecAnt = #15#1;
          #15#48 = #0#2;
          #15#0 = #0#4;
          #15#1 = #0#6;
          |GRABA 021#15n;
          |SI #0#5 ! #0#6;
               |LEE 121#15=;
               |SI FSalida = 0;
                    |HAZ LimCabAgifa084;
                    |BUCLELIN 2 CalCabAgifa084 #15;
                    |GRABA 020#15a;
               |FINSI;
          |FINSI;
          |HAZ VtoFactuDir;
     |FINSI;
     |LIBERA #15;
     |CIERRA #15;
     |CIERRA #133;

     |ABRE #501;
     |SELECT #2#501;
     #501#35 = "F";
     #501#57 = #0#1;
     #501#58 = #0#3;
     |LEE 101#501=;
     |SI FSalida = 0;
          #501#57 = #0#2;
          #501#58 = #0#4;
          #501#14 = #0#6;
          |GRABA 020#501a;
          |BUCLELIN 0 LinTiq #501;
     |FINSI;
     |CIERRA #501;
|FPRC;

|PROCESO DiasFijos;
     |SI #agifa024#22 = 0; |Y #agifa024#23 = 0; |Y #agifa024#24 = 0; |ACABA; |FINSI;

     aAlfa = #agifa133#3; aAlfa = aAlfa % 0102; nCalc = aAlfa;
     |SI nCalc < #agifa024#22; |Y #agifa024#22 ! 0;
        nCalc = #agifa024#22;
     |SINO;
        |SI nCalc < #agifa024#23; |Y #agifa024#23 ! 0;
           nCalc = #agifa024#23;
        |SINO;
           |SI #agifa024#24 ! 0;
              nCalc = #agifa024#24;
           |FINSI;
        |FINSI;
     |FINSI;
     aAlfa = #agifa133#3; |QBF aAlfa;
     aAlfa = (("00" + nCalc) % -102) + (aAlfa % 0308);
     fFecha = aAlfa;
     |SI fFecha < #agifa133#3;
        nCalc = fFecha; nCalc = nCalc + .0001; fFecha = nCalc;
     |FINSI;
     aAlfa = fFecha;
|FPRC;

|PROCESO PasaVencimientos;
     |SI #0#5 ! #0#6;
        |ABRE #agifa024;
        #agifa024#0 = aCliente;
        |LEE 000#agifa024.=;
        |SI FSalida ! 0; |DDEFECTO #agifa024; |FINSI;
        |CIERRA #agifa024;

        |ABRE #agifa091;
        #agifa091#0 = aFP;
        |LEE 000#agifa091.=;
        |SI FSalida ! 0; |DDEFECTO #agifa091; |FINSI;
        |CIERRA #agifa091;
        nCont2 = 6;
     |FINSI;

     |PARA nLinea = 1; |SI nLinea [ 999; |HACIENDO nLinea = nLinea + 1;
          #agifa133#4 = #0#1;
          #agifa133#0 = #0#3;
          #agifa133#1 = nLinea;
          |LEE 101#agifa133.=;
          |SI FSalida = 0;
               |BORRA 020#agifa133.a; |SALVA_FICHA #agifa133;

               #agifa133#4 = #0#2;                ||Serie
               #agifa133#0 = #0#4;                ||Numero
               #agifa133#1 = nLinea;              ||Linea

               |SI #0#5 ! #0#6;
                  nCalc = #0#6; nCalc = nCalc + #agifa091#nCont2#; nCont2 = nCont2 + 1;
                  #agifa133#3 = nCalc;
                  || Comprueba el mes de no pago
                  aAlfa = #agifa133#3; aAlfa = aAlfa % 0402; nCalc = aAlfa;
                  |SI nCalc = #agifa024#21;
                     nCalc = nCalc + 1;
                     aAlfa = #agifa133#3;
                     aAlfa = (aAlfa % 0103) + (("00" + nCalc) % -102) + (aAlfa % 0605);
                     #agifa133#3 = aAlfa;
                  |FINSI;

                  || Comprueba los dias fijos de pago
                  |HAZ DiasFijos;

                  || Trasmos no pago
                  |SI #agifa186#0 = 1; |O #agifa186#0 = 8;
                     fFecVto = aAlfa;
                     |BUCLE dsm00130;
                     aAlfa = fFecVto;
                  |FINSI;

                  #agifa133#3 = aAlfa;
                  fFecVto = #agifa133#3;
               |FINSI;
               |GRABA 020#agifa133.n; |LIBERA #agifa133;

               |REPON_FICHA #agifa133;

               aSer  = #0#1; nCont  = #0#3; fFecha  = #0#5; nRec = nLinea;
               aSer1 = #0#2; nCont1 = #0#4; fFecha1 = #0#6;
               aTipo = "V"; nSw = 2; |HAZ MiraMovtos;
          |FINSI;
     |SIGUE;
|FPRC;

|PROCESO Bagrom011;
     |BORRA 020#referen@.a;
     #referen@#0 = #0#2;
     #referen@#1 = #0#4;
     #referen@#4 = #0#6;
     |GRABA 020#referen@.n;
|FPRC;

|DEFBUCLE Bagrom011;
     #referen@#1003;
     ;
     #0#1, #0#3, 001;
     #0#1, #0#3, 999;
     be;
     NULL, Bagrom011;
|FIN;

|PROCESO agrom011;
     |DDEF aDef;
     aDef = aDef + "agrom011";
     |CARGA_DEF aDef, referen@;
     |SI FSalida = 0;
          |BUCLE Bagrom011;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|PROCESO PorPantalla;
     |SI #0#0 = 1;
          |HAZ pasa01;
     |FINSI;      ||Facturas Ventas
     |SI #0#0 = 2;
          |ABRE #3;
          #3#52 = #0#1;
          #3#0 =  #0#3;
          |LEE 001#3=;
          |SI FSalida = 0;
             |SI #3#43 = "S";
                #3#43 = "N";
             |SINO;
                #3#43 = "S";
             |FINSI;
             eaTag = "AV"; |HAZ Riesgos;
          |FINSI;
          |CIERRA #3;

          |HAZ pasa02;                       ||Albaranes Ventas
          |SI #0#7 ! "*"; |O eaIva = "X"; |O #0#5 ! #0#6;
               |HAZ RecalcuAlba;
          |FINSI;

          eaTag = "AV"; |HAZ Riesgos;

     |FINSI;
     |SI #0#0 = 3; |HAZ pasa03; |FINSI;      ||Pedidos Ventas
     |SI #0#0 = 4; |HAZ pasa04; |FINSI;      ||Depositos Ventas
     |SI #0#0 = 5; |HAZ pasa05; |FINSI;      ||Facturas Compras
     |SI #0#0 = 6; |HAZ pasa06; |FINSI;      ||Albaranes Compras
     |SI #0#0 = 7; |HAZ pasa07; |FINSI;      ||Pedidos Compras
     |SI #0#0 = 8; |HAZ pasa08; |FINSI;      ||Facturas Contado
     ||컴컴컴컴컴컴컴컴컴컴Vertical
     dArti = " " * 20;
     hArti = "z" * 20;
     |SI #0#0 = 2; aTipo = "AV"; |HAZ Vertical; |FINSI;
     |SI #0#0 = 3; aTipo = "PV"; |HAZ Vertical; |FINSI;
     |SI #0#0 = 4; aTipo = "DP"; |HAZ Vertical; |FINSI;
     |SI #0#0 = 6; aTipo = "AC"; |HAZ Vertical; |FINSI;
     |SI #0#0 = 7; aTipo = "PC"; |HAZ Vertical; |FINSI;
     |SI #0#0 = 8; aTipo = "FC"; |HAZ Vertical; |FINSI;
|FPRC;

|PROCESO TmpExcel;
     #0#1 = #89#0; |PINTA #0#1;
     #0#3 = #89#1; |PINTA #0#3;
     Campo = 3;|HAZ actual;

     |SI buena ! "N";
          #0#2 = #89#2; |PINTA #0#2;
          #0#4 = #89#3; |PINTA #0#4;
          |HAZ nueva;
          |SI buena ! "N";
               #0#5 = #89#6; |PINTA #0#5;
               #0#6 = #89#4; |PINTA #0#6;
               #0#7 = #89#5; |PINTA #0#7;
               |HAZ TipoIVA;
               eaMensaje = "*Documento actualizado*";
               |HAZ PorPantalla;
          |FINSI;
     |FINSI;

     |SI enSwVipei ! 0; |PRINT; |FINSI;
|FPRC;

|DEFBUCLE TmpExcel;
     #89#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, TmpExcel;
|FIN;

|PROCESO VipeiRec;
     |PRINT;
|FPRC;

|DEFBUCLE VipeiRec;
     #90#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, VipeiRec;
|FIN;

|PROCESO VipeiImpRec;
     |CONFI "0000SImprimir recibos modificados";
     |SI FSalida ! 0; |ACABA; |FINSI;

     |IMPRE 0;
     |SI FSalida = 0;
          |INFOR "vipei286";
          |SI FSalida = 0;
               |BUCLE VipeiRec;
               |PIEINF;
               |FININF;
          |FINSI;
          |FINIMP;
     |FINSI;
|FPRC;

|PROCESO PorExcel;
     aExcel = #0#9; |QBF aExcel;
     aIP = "";
     |IP_REMOTO aIP;
     |SI aIP = "";
          |XABRE "E", aExcel, 0;
     |SINO;
          |XABRE "CE", aExcel, 0;
     |FINSI;
     |SI FSalida < 0
          |MENAV "0000No puedo abrir el fichero a importar";
     |SINO;
          |CARGADLL "agixl97.dll";
          |SI FSalida < 0;
               |MENAV "0000No se puede usar agixl97.dll";
          |SINO;
               |ALFACALLDLL "agixl97.dll", "carga_book", aExcel;
               |ALFACALLDLL "agixl97.dll", "selecciona_hoja", "Hoja1";
               |SI FSalida = 0;
                    |PARA nXls = 1; |SI nXls < 65536; |HACIENDO nXls = nXls + 1;
                         aAlfa = "Importando:" + nXls;
                         |PINTA 1903, aAlfa;

                         aAlfA = "A" + nXls; |ALFACALLDLL "agixl97.dll", "peek_dato", aAlfA;
                         |SI FSalida ! 0; |SAL; |FINSI;
                         aAlfb = "B" + nXls; |ALFACALLDLL "agixl97.dll", "peek_dato", aAlfb;
                         |SI FSalida ! 0; |SAL; |FINSI;
                         aAlfc = "C" + nXls; |ALFACALLDLL "agixl97.dll", "peek_dato", aAlfc;
                         |SI FSalida ! 0; |SAL; |FINSI;
                         aAlfd = "D" + nXls; |ALFACALLDLL "agixl97.dll", "peek_dato", aAlfd;
                         |SI FSalida ! 0; |SAL; |FINSI;
                         aAlfe = "E" + nXls; |ALFACALLDLL "agixl97.dll", "peek_dato", aAlfe;
                         |SI FSalida ! 0; |SAL; |FINSI;
                         aAlff = "F" + nXls; |ALFACALLDLL "agixl97.dll", "peek_dato", aAlff;
                         |SI FSalida ! 0; |SAL; |FINSI;

                         |QBT aAlfb;
                         |SI aAlfb = ""; |SAL; |FINSI;

                         aAlfa = "0000Importando excel " + aAlfA + "/" + aAlfb;
                         |MENSA aAlfa;

                         #89#0 = aAlfA;
                         #89#1 = aAlfb;

                         #0#1 = #89#0;
                         #0#3 = #89#1;
                         Campo = 3; |HAZ actual;
                         #89#4 = #0#6; || F.Destino
                         #89#5 = #0#7; || IVa Destino
                         #89#6 = #0#5; || F.Origen

                         #89#2 = aAlfc;
                         #89#3 = aAlfd;

                         |QBF aAlfe;
                         |SI aAlfe ! ""; #89#4 = aAlfe; |FINSI;
                         |SI aAlff ! ""; #89#5 = aAlff; |FINSI;
                         |GRABA 000#89n;
                         nHayExcel = 1;
                    |SIGUE;
                    |ALFACALLDLL "agixl97.dll", "fin_book", "salva";
               |FINSI;
          |FINSI;
          |DESCARGADLL "agixl97.dll";
     |FINSI;

     |SI enSwVipei = 0;
          |HAZ CreaTempo; |NOME_DAT #90 Tempo; aTmp90 = Tempo; |DELINDEX #90;
     |FINSI;

     |SI nHayExcel ! 0;
          |IMPRE 0;
          |SI FSalida = 0;
               |SI enSwVipei = 0; |Y #0#0 = 1;
                    |INFOR "vipei186";
               |SINO;
                    |INFOR "agifa186";
               |FINSI;
               |SI FSalida = 0;
                    |BUCLE TmpExcel;
                    |PIEINF;
                    |FININF;
               |FINSI;
               |FINIMP;
          |FINSI;
          |SI enSwVipei = 0; |Y #0#0 = 1;
               |HAZ VipeiImpRec;
          |FINSI;
     |FINSI;

     |SI enSwVipei = 0;
          Tempo = aTmp90; |HAZ BoraTempo; |DELINDEX #90;
     |FINSI;
|FPRC;

|PROCESO fin; |TIPO 3;
     |ABRE #142; |LEE 000#142p; |CIERRA #142;
     |HAZ DecimalesBase;

     |SI #0#0 = 1; |O #0#0 = 5;
        |SI #0#5 ! #0#6;  |Y #0#8 = "N";
           |CONFI "    NSe recalcularan las fechas de los vtos.y se perderan las fechas fijas indicadas.  Continuar ?";
        |FINSI;
        |SI #0#8 = "S";
           |CONFI "    NSi se cambia la fecha se recalcularan los vtos.  Continuar ?";
        |FINSI;
        |SI FSalida ! 0; |ACABA; |FINSI;
     |FINSI;

     |SI #0#8 = "S";
          |HAZ CreaTempo; aTmp89 = Tempo; |NOME_DAT #89 Tempo; |DELINDEX #89;
          |ABRE #89;
          |HAZ PorExcel;
          |CIERRA #89;
          Tempo = aTmp89; |HAZ BoraTempo; |DELINDEX #89;
     |SINO;
          |HAZ actual;
          |SI buena = "N"; |ACABA; |FINSI;
          |HAZ nueva;
          |SI buena = "N"; |ACABA; |FINSI;
          |HAZ PorPantalla;
     |FINSI;
|FPRC;

|PROCESO Browser; |TIPO 0;
     |SI FSalida ! 10; |ACABA; |FINSI;

     aRuta = "F*.xls";

     |BROWSE aRuta;

     aRuta = aRuta % 2; |QBF aRuta;
     |SI aRuta = "F"; aRuta = ""; |FINSI;

     |QBF aRuta;
     |SI aRuta = "";
          |ERROR;
     |SINO;
          #0#9 = aRuta;
          |PINTA #0#9;
          |ERROR;
     |FINSI;
|FPRC;

|PROCESO Boton1;
     |PTEC 824;
|FPRC;

|PROCESO Importa; |TIPO 0;
     |SI #0#8 = "S";
          |C_M #0#9, 1, "S";
          |C_M #0#1, 1, "N";
          |C_M #0#2, 1, "N";
          |C_M #0#3, 1, "N";
          |C_M #0#4, 1, "N";
          |C_M #0#6, 1, "N";
          |C_M #0#7, 1, "N";
     |SINO;
          |C_M #0#9, 1, "N";
          |C_M #0#1, 1, "S";
          |C_M #0#2, 1, "S";
          |C_M #0#3, 1, "S";
          |C_M #0#4, 1, "S";
          |C_M #0#6, 1, "S";
          |C_M #0#7, 1, "S";
     |FINSI;
|FPRC;

|PROGRAMA;
     |HAZ EsVipei; enSwVipei = FSalida;
     |HAZ EsOrts; nSwOrts = FSalida;

     |SI enTipo ! 0;
          || Lo llama dsz00059 cuando eaIva="X" se recoge el iva del articulo
          #0#0 = enTipo;
          #0#1 = eaSerOrg;
          #0#2 = eaSerDes;
          #0#3 = enNum;
          #0#4 = enNum;
          #0#5 = efFecOrg;
          #0#6 = efFecDes;
          |SI eaIva = "0";    || eaIva = "0"
               #0#7 = "0";
          |SINO;              || eaIva = "X" o eaIva = "*"
               #0#7 = "*";
          |FINSI;
          |HAZ fin;
          |ACABA;
     |FINSI;

     fecha = ~;
     |CLS;
     |CABEZA "Cambio Claves";

     |CONTROL_SIMPLE 0, "BOTON,Fichero Excel", 1604, 1617, Boton1;
     nBoton1 = FSalida;

     |PINPA #0#0;
     |PINDA #0#0;
     FSalida = 0;
     #0#0 = 1;
     |PARA ; |SI FSalida = 0; |Y #0#0 ! 0; |HACIENDO ;
          |DDEFECTO #0;
          |ENDATOS #1#0;
          |SI #0#8 = "S"; |SAL; |FINSI;
     |SIGUE;

     |FIN_CONTROL_WINDOWS nBoton1;
     |PULSATECLA;
|FPRO;
