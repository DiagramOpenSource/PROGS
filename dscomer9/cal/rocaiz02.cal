|FICHEROS;
     rocaiz02 #0;
     agifa019 #19;
     agifa067 #67;
     agifa073 #73;
     agifa081 #81;
     agifa104 #104;
     dsm00005 #905;
     dsm00016 #916;
|FIN;

|VARIABLES;
     &aDivisa = "";
     &aMoneda = "";
     aEleConUni = "";
     aElePrimero = "";
     nUni = 0;
     nPed = 0;
     nSer = 0;
     nLinea = 0;
     aAlfa = "";
     aEle = "";
|FIN;

|PROCESO BuscaEle;
     #916#0 = #19#177;
     #916#1 = "";
     #916#2 = "";
     #916#15 = "";
     #916#3 = "";
     |LEE 000#916];
     |SI FSalida = 0;
          aEle = #916#3;
     |FINSI;
|FPRC;

|PROCESO dsm00005;
     |SI aElePrimero = "";
          aElePrimero = #905#4;
     |FINSI;
     |SI aEleConUni = ""; |Y #905#6 ! 0;
          aEleConUni = #905#4;
     |FINSI;
     nUni = nUni + #905#6;
     nPed = nPed + #905#11;
     nSer = nSer + #905#12;

     #905#9 = #905#6 - #905#11;
     |GRABA 020#905a;
|FPRC;

|DEFBUCLE dsm00005V;
     #905#1;
     ;
     "PV", #73#28, #73#0, nLinea, "      ";
     "PV", #73#28, #73#0, nLinea, "zzzzzz";
     be;
     NULL, dsm00005;
|FIN;

|PROCESO agifa073;
     #19#0 = #73#2;
     |LEE 000#19=;
     |SI FSalida ! 0; |DDEFECTO #19; |FINSI;

     |SI #19#176 = "S";
          aEleConUni = "";
          aElePrimero = "";
          nUni = 0;
          nPed = 0;
          nSer = 0;
          nLinea = #73#1;
          |BUCLE dsm00005V;

          |SI nUni ! #73#5; |O nPed ! #73#42; |O nSer ! #73#43;
               aEle = aEleConUni;
               |SI aEle = ""; aEle = aElePrimero; |FINSI;
               |SI aEle = ""; |HAZ BuscaEle; |FINSI;

               |DDEFECTO #905;
               |ABRE #905;
               #905#0 = "PV";
               #905#1 = #73#28;
               #905#2 = #73#0;
               #905#3 = #73#1;
               #905#4 = aEle;
               |LEE 101#905=;
               |SI FSalida ! 0; |GRABA 020#905b; |FINSI;

               nUni = #73#5 - nUni;
               nPed = #73#42 - nPed;
               nSer = #73#43 - nSer;

               #905#6 = #905#6 + nUni;
               #905#11 = #905#11 + nPed;
               #905#12 = #905#12 + nSer;

               #905#9 = #905#6 - #905#11;
               |GRABA 020#905a;
               |LIBERA #905;
               |CIERRA #905;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO agifa104;
     aDivisa = #104#35;
     aMoneda = #104#37;
     |HAZ Divisas104;
|FPRC;

|DEFBUCLE agifa104;
     #104#1;
     ;
     "     ", 000000;
     "zzzzz", 999999;
     be;
     NULL, agifa104, agifa073;
|FIN;


|DEFBUCLE dsm00005C;
     #905#1;
     ;
     "PC", #67#28, #67#0, nLinea, "      ";
     "PC", #67#28, #67#0, nLinea, "zzzzzz";
     be;
     NULL, dsm00005;
|FIN;

|PROCESO agifa067;
     #19#0 = #67#2;
     |LEE 000#19=;
     |SI FSalida ! 0; |DDEFECTO #19; |FINSI;

     |SI #19#176 = "S";
          aEleConUni = "";
          aElePrimero = "";
          nUni = 0;
          nPed = 0;
          nSer = 0;
          nLinea = #67#1;
          |BUCLE dsm00005C;

          |SI nUni ! #67#5; |O nPed ! #67#37; |O nSer ! #67#38;
               aEle = aEleConUni;
               |SI aEle = ""; aEle = aElePrimero; |FINSI;
               |SI aEle = ""; |HAZ BuscaEle; |FINSI;

               |DDEFECTO #905;
               |ABRE #905;
               #905#0 = "PC";
               #905#1 = #67#28;
               #905#2 = #67#0;
               #905#3 = #67#1;
               #905#4 = aEle;
               |LEE 101#905=;
               |SI FSalida ! 0; |GRABA 020#905b; |FINSI;

               nUni = #67#5 - nUni;
               nPed = #67#37 - nPed;
               nSer = #67#38 - nSer;

               #905#6 = #905#6 + nUni;
               #905#11 = #905#11 + nPed;
               #905#12 = #905#12 + nSer;

               #905#9 = #905#6 - #905#11;
               |GRABA 020#905a;
               |LIBERA #905;
               |CIERRA #905;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO agifa081;
     aDivisa = #81#27;
     aMoneda = #104#29;
     |HAZ Divisas081;
|FPRC;

|DEFBUCLE agifa081;
     #81#1;
     ;
     "     ", 000000;
     "zzzzz", 999999;
     be;
     NULL, agifa081, agifa067;
|FIN;

|PROCESO T3; |TIPO 3;
     |SI #0#0 = "SI";
          |ABRE #19;
          |ABRE #916;
          |BUCLE agifa104;
          |BUCLE agifa081;
          |CIERRA #916;
          |CIERRA #19;
     |FINSI;
|FPRC;
