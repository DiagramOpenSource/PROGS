|VARIABLES;
     aDef = "";
     aMas = "";
     aProg = "";
     aPrograma = "";
     aParametro = "";
     aAlfa = "";
     aAuto = "";
     nHandle = 0;
     aEmp = "";
     aCliente = "";
     aFich = "";
     aBase = "";
     nSwContinua = 0;
     aFichero = "";
     &eaCliente = "";
     aCli = "";
|FIN;

|PROCESO Ejecuta;
     |DDEF aDef;
     aMas = aDef + (aProg % 108) + ".mas";
     |XABRE "E", aMas, 0;
     |SI FSalida = 0;
          aPrograma = aProg % 108;
          aParametro = aProg - aPrograma;
          aAlfa = aPrograma + ";" + aParametro;
          |SUB_EJECUTA_NP aAlfa;
          FSalida = 0;
     |FINSI;
|FPRC;

|PROCESO LeeTxt;
     aAuto = "";
     |XABRE "", aFichero, nHandle;

     |XLEE nHandle, 250, aEmp;
     |XLEE nHandle, 250, aAuto;
     |XLEE nHandle, 250, aProg;
     |XLEE nHandle, 250, aCliente;

     |XCIERRA nHandle;
|FPRC;

|PROCESO CreaTxt;
     |DFICE aFich;
     aEmp = aFich % -205;

     |DBASE aBase;
     aFichero = aBase + "fich/" + (Usuario % 810);

     |XABRE "E", aFichero, 0;
     |SI FSalida = 0;
          |AVISO;
          |MENAV "0000Este proceso solo puede ejecutarse una tarea por usuario";
          aAlfa = "0000NYa existe una tarea con el usuario [" + (Usuario % 810) + "]. ¿Continuar?"
          |CONFI aAlfa;
          nSwContinua = FSalida;
          |SI FSalida ! 0;
               |ACABA;
          |FINSI;
     |FINSI;

     |XABRE "W", aFichero, nHandle;

     |XGRABA nHandle, aEmp;
     |XGRABA nHandle, aAuto;

     |SI eaCliente ! "";
          |XGRABA nHandle, "";     ||programa
          aCli = eaCliente;
          |XGRABA nHandle, aCli;    ||cliente
     |FINSI;

     |XCIERRA nHandle;
|FPRC;

|PROGRAMA;
     |HAZ CreaTxt;
     |SI nSwContinua ! 0; |ACABA; |FINSI;

     |PARA; |SI; |HACIENDO;
          aAlfa = "|:dscomer9/dsoptm02 agif0041 " + #48#0;
          |SUB_EJECUTA_NP aAlfa;
          |PULSATECLA;
          |PULSATECLA;
          |PULSATECLA;
          |HAZ LeeTxt;
          |SI aAuto = ""; |SAL; |FINSI;
          |HAZ Ejecuta;
          |SI FSalida ! 0;
               aAlfa = "0000Ejecuta:" + aProg;
               |MENAV aAlfa;
          |FINSI;
     |SIGUE;

     |FBORRA aFichero;
|FPRO;
