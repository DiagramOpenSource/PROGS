|FICHEROS;
     solm0002 #0;
     solm0003 #1;
     solm0005 #5;
     solw0006 #6,MANTE;
     solm0001 #10;
     agifa041 #41;
     agifa084 #84;
     solm0003@;
|FIN;

|VARIABLES;
     nForma = 0;
     nHay = 0;
     i = 0;
     nModo = 0;
     nHuerto = 0;
     nConta = 0;
     aAlfa = "";
     aPos = "";
     nPos = 0;
|FIN;

|PROCESO Contador7; |TIPO 7;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 1;
          nHuerto = #0#0;
          #0#1 = 9999;
          |LEE 000#0];
          |SI FSalida = 0;
               |LEE 000#0a;
          |SINO;
               |LEE 000#0u;
          |FINSI;
          |SI FSalida = 0; |Y nHuerto = #0#0;
               nConta = #0#1 + 1;
          |SINO;
               nConta = 1;
          |FINSI;
          |DDEFECTO #0;
          #0#0 = nHuerto;
          #0#1 = nConta;
     |FINSI;
|FPRC;

|PROCESO ContaUni;
     |SI #1#0 ! #solm0003@#0; |O #1#1 ! #solm0003@#1; |O #1#2 ! #solm0003@#2;
          |SI #1#5 [ #solm0003@#6; |Y #1#6 ] #solm0003@#5;
               nHay = 1;
               aAlfa = "0000Contador existente en Huerto/Contrato:" + #solm0003@#0 + "/" +  #solm0003@#1 + " linea: " + #solm0003@#2;
               |MENAV aAlfa;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE ContaUni;
     #solm0003@#2003;
     ;
     #1#3, #1#0, 0000;
     #1#3, #1#0, 9999;
     ;
     NULL, ContaUni;
|FIN;

|PROCESO ContaUnico; |TIPO 0;
     |SI FSalida = 2; |ACABA; |FINSI;

     |DDEF aAlfa;
     aAlfa = aAlfa + "solm0003";
     |CARGA_DEF aAlfa, solm0003@;
     |SI FSalida = 0;
          nHay = 0;
          |BUCLE ContaUni;
          |SI nHay ! 0; |ERROR; |FINSI;
          |DESCARGA_DEF #solm0003@;
     |FINSI;
|FPRC;

|PROCESO Empresa0; |TIPO 0;
     |DFICE aAlfa;
     aPos = aAlfa % A0;
     nPos = aPos;
     nPos = nPos - 6 + 100;
     aAlfa = aAlfa % nPos;
     |PATH_DAT #41 aAlfa;
     |ABRE #41;
     #41#0 = #1#11;
     |LEE 000#41=;
     |SI FSalida ! 0;
          |MENAV "0000No existe Empresa...";
          |ERROR;
     |FINSI;
     |CIERRA #41;
|FPRC;

|PROCESO Empresa66; |TIPO 66;
     |DFICE aAlfa;
     aPos = aAlfa % A0;
     nPos = aPos;
     nPos = nPos - 6 + 100;
     aAlfa = aAlfa % nPos;
     |PATH_DAT #41 aAlfa;
     |ABRE #41;
     #41#0 = #1#11;
     |LEE 000#41];
     |CONSULTA_CLAVE #1#41;
     |SI FSalida = 0;
          #1#11 = #41#0;
          |PINTA #1#11;
     |SINO;
          |ERROR;
     |FINSI;
     |CIERRA #41;
|FPRC;

|PROCESO Defecto3; |TIPO 0;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 1;
          |ABRE #10;
          #10#0 = #0#0;
          |LEE 000#10=;
          |SI FSalida = 0;
               #1#7 = #10#11; |PINTA #1#7;
               #1#8 = #10#10; |PINTA #1#8;
               #1#9 = #10#9; |PINTA #1#9;
               #1#10 = #10#14; |PINTA #1#10;
               #1#11 = #10#13; |PINTA #1#11;
               #1#12 = #10#12; |PINTA #1#12;
          |FINSI;
          |CIERRA #10;
     |FINSI;
|FPRC;

|PROCESO Min6;
     #6#0 = 0;
     #6#1 = 0;
     #6#2 = 0;
     #6#3 = 0;
     #6#4 = 1;
|FPRC;

|PROCESO Max6;
     #6#0 = 9999;
     #6#1 = 9999;
     #6#2 = 9999;
     #6#3 = 9999;
     #6#4 = 12;
|FPRC;

|PROCESO solm0005;
     |PARA i = 0; |SI i [ 19; |HACIENDO i = i + 1;
          #6i = #5i;
     |SIGUE;
     |GRABA 020#6n;
     nHay = 1;
|FPRC;

|DEFBUCLE solm0005;
     #5#1;
     ;
     #1#0, #1#1, #1#3, 0000, 1;
     #1#0, #1#1, #1#3, 9999, 12;
     ;
     NULL, solm0005;
|FIN;

|PROCESO LinCtc;
     |BUCLE solm0005;
|FPRC;

|PROCESO Lecturas20; |TIPO 20;
     |SI FSalida = "OPCION";
          FSalida = "Lecturas";
          |ACABA;
     |FINSI;
     aAlfa = Usuario;
     |NOME_DAT #6 aAlfa;
     |DELINDEX #6;
     |ABRE #6;
     nHay = 0;
     |LEE 000#0=;
     |BUCLELIN 2 LinCtc #0;
     |SI nHay ! 0;
          |PUSHV 0501 2380;
          |ENTLINEAL #1#6, 3, 4, 21, 1, Min6, Max6;
          |POPV;
     |SINO;
          |MENAV "0000No hay lecturas..";
     |FINSI;
     |DELINDEX #6;
|FPRC;

|PROCESO Consulta; |TIPO 11;
     |SI FSalida = 13;   ||F5;
          |SI #6#13 = 0;
               |MENAV "0000No se ha generado la factura...";
               |ACABA;
          |FINSI;
          |DFICE aAlfa;
          |PATH_DAT #84 aAlfa;

          |ABRE #84;
          #84#48 = #6#12;
          #84#0 = #6#13;
          |LEE 020#84=;
          |SI FSalida = 0;
               |PUSHV 0501 2380;
               |PINPA #0#84;
               |PINDA #0#84;
               |PAUSA;
               |POPV;
          |FINSI;
          |CIERRA #84;
          |ERROR;
     |FINSI;
     |SI FSalida = 14;   ||F6;
          |SI #6#16 = 0;
               |MENAV "0000No se ha generado la factura...";
               |ACABA;
          |FINSI;
          |DBASE aAlfa;
          aAlfa = aAlfa + "fich/" + (("00000" + #6#14) % -105) + "/";
          |PATH_DAT #84 aAlfa;

          |ABRE #84;
          #84#48 = #6#15;
          #84#0 = #6#16;
          |LEE 020#84=;
          |SI FSalida = 0;
               |PUSHV 0501 2380;
               |PINPA #0#84;
               |PINDA #0#84;
               |PAUSA;
               |POPV;
          |FINSI;
          |CIERRA #84;
          |ERROR;
     |FINSI;
|FPRC;

|PROCESO Tipo3_2; |TIPO 2;
     nForma = 0 +. 1;
     |SI nForma = 1;
          FSalida = 0;
          |HAZ ContaUnico;
     |FINSI;
|FPRC;

|PROCESO Mini;
     #solm0003@#0 = #1#0;
     #solm0003@#1 = #1#1;
     #solm0003@#3 = 000;
|FPRC;

|PROCESO Maxi;
     #solm0003@#0 = #1#0;
     #solm0003@#1 = #1#1;
     #solm0003@#3 = 999;
|FPRC;

|PROCESO Conta0; |TIPO 0;
     |SI FSalida = 13;
          |DDEF aAlfa;
          aAlfa = aAlfa + "solm0003";
          |CARGA_DEF aAlfa, solm0003@;
          |SI FSalida = 0;
               |ABRE #solm0003@;
               |SELECT #3#solm0003@;
               #solm0003@#0 = #1#0;
               #solm0003@#1 = #1#1;
               #solm0003@#3 = #1#18;
               |LEE 000#solm0003@.];
               |CONSULTA_F_CLAVE #3#solm0003@, Mini, Maxi;
               |SI FSalida = 0;
                    #1#18 = #solm0003@#3; |PINTA #1#8;
               |SINO;
                    |ERROR;
               |FINSI;
               |CIERRA #solm0003@;
               |DESCARGA_DEF #solm0003@;
          |FINSI;
     |SINO;
          |SI #1#18 = 0; |ACABA; |FINSI;
          |SI #1#18 = #1#3;
               |MENAV "0000Contador erroneo...";
               |ERROR; |ACABA;
          |FINSI;

          |DDEF aAlfa;
          aAlfa = aAlfa + "solm0003";
          |CARGA_DEF aAlfa, solm0003@;
          |SI FSalida = 0;
               |ABRE #solm0003@;
               |SELECT #3#solm0003@;
               #solm0003@#0 = #1#0;
               #solm0003@#1 = #1#1;
               #solm0003@#3 = #1#18;
               |LEE 000#solm0003@.=;
               |SI FSalida ! 0;
                    |MENAV "0000No existe contador...";
                    |ERROR;
               |FINSI;
               |CIERRA #solm0003@;
               |DESCARGA_DEF #solm0003@;
          |FINSI;
     |FINSI;
|FPRC;
