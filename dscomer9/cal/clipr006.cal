|FICHEROS;
     clipr006 #0;
     clipr007 #7; ||cto
     clipr015 #15; ||centros de trabajo;
     clipr077 #77;
     clipr080 #80; ||Lineas
|FIN;

|VARIABLES;
     &enTiva = 0;
     &efFiva = @;
     &eaDiva = "";
     &enIva = 0;
     &enRec = 0;
     &aCon_Serie = "";
     &aCon_Clave = "";
     &nCon_Conta = 0;
     &nDeci_nDe = 0;
     aAlfa = "";
     nModo = 0;
     nCentro = 0;
     nForma = 0;
     nErr = 0;
|FIN;

|CALCULO contpres;
     aCon_Serie = #0#0;
     aCon_Clave = "presupue";
     nCon_Conta = 0;
     |HAZ ContadorFicClip;
     #0#1 = nCon_Conta;
     |PINTA #0#1;
|FCAL;

|PROCESO Totales; |TIPO 0;
     enTiva = #0#11;
     efFiva = #0#2;
     |HAZ SacaIVA;

     #0#20 = enIva; |PINTA #0#20;

     #0#10 = #0#7 + #0#49 + #0#68 + #0#70 + #0#72 + #0#73 + #0#75 + #0#76+ #0#77 + #0#78;
     #0#10 = #0#10 + #0#85 + #0#86 + #0#87 + #0#88 + #0#89;
     #0#21 = #0#10 % #0#20;
     #0#23 = #0#10 + #0#21;
     |PINTA #0#10;
     |PINTA #0#21;
     |PINTA #0#23;
|FPRC;

|PROCESO Mini;
     #15#0 = #80#5;
     #15#1 = 0;
|FPRC;

|PROCESO Maxi;
     #15#0 = #80#5;
     #15#1 = 999;
|FPRC;

|PROCESO BuscaCent; |TIPO 66;
     |ABRE #15;
     #15#0 = #80#5;
     #15#1 = #80#3;
     |LEE 000#15];
     |CONSULTA_F_CLAVE #1#15, Mini, Maxi;
     |SI FSalida = 0;
          #80#3 = #15#1; |PINTA #15#1;
     |SINO;
          |ERROR;
     |FINSI;
     |CIERRA #15;
|FPRC;

|PROCESO CentLin; |TIPO 7;
     #80#5 = #0#3; ||Empresa;
|FPRC;

|PROCESO CentTipo2; |TIPO 2;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 3;
          nCentro = 0;
     |SINO;
          nCentro = #80#3;
     |FINSI;
     |SI #80#2 = 1; #0#42 = nCentro; |FINSI;
     |SI #80#2 = 2; #0#43 = nCentro; |FINSI;
     |SI #80#2 = 3; #0#44 = nCentro; |FINSI;
     |SI #80#2 = 4; #0#45 = nCentro; |FINSI;
     |SI #80#2 = 5; #0#46 = nCentro; |FINSI;

     |SI #80#2 = 6; #0#50 = nCentro; |FINSI;
     |SI #80#2 = 7; #0#51 = nCentro; |FINSI;
     |SI #80#2 = 8; #0#52 = nCentro; |FINSI;
     |SI #80#2 = 9; #0#53 = nCentro; |FINSI;
     |SI #80#2 = 10; #0#54 = nCentro; |FINSI;
|FPRC;

|PROCESO Tipo2Cab; |TIPO 2;
     nForma = 0 +. 1;
     |SI #0#5 ! "01.01.0000"; |Y nForma = -1;
          |ABRE #7;
          |SELECT #5#7;
          #7#25 = #0#0;
          #7#26 = #0#1;
          |LEE 000#7=;
          |SI FSalida = 0;
               |AVISO;
               aAlfa = #7#0 + "/" + (("000000" + #7#1) % -106);
               aAlfa = "0000NPresupuesto adjudicado al contrato:" + aAlfa + ". Continuar?";
               |CONFI aAlfa;
               |SI FSalida ! 0; |ERROR; |FINSI;
          |FINSI;
          |CIERRA #7;
     |FINSI;
|FPRC;

|PROCESO ModiCent;
     |SI FSalida ! 13; |ACABA; |FINSI;
     |PUSHV 0501 2380;
     |ABRE #15;
     #15#0 = #80#5;
     #15#1 = #80#3;
     |LEE 101#15=;
     |SI FSalida = 0;
          |PINPA #0#15;
          |PINDA #0#15;
          |ENDATOS #2#15;
          |SI FSalida = 0;
               #80#4 = #15#2;
               |GRABA 020#15a;
          |FINSI;
     |FINSI;
     |CIERRA #15;
     |POPV;
     |PINTA #80#4;
     |ERROR;
|FPRC;

|PROCESO Centros;
     |PRINT;
|FPRC;

|DEFBUCLE Centros;
     #80#1;
     ;
     #0#0, #0#1, 1;
     #0#0, #0#1, 10;
     ;
     NULL, Centros;
|FIN;

|PROCESO Tipo4; |TIPO 4;
     Impresora = "CrystalReports";
     |IMPRE -1;
     |SI FSalida = 0;
          |INFOR "clipr006";
          |SI FSalida = 0;
               |BUCLE Centros;
               |PIEINF;
               |FININF;
          |SINO;
               |MENAV "0000Error en informe 'clipr006'";
          |FINSI;
          |FINIMP;
     |FINSI;
|FPRC;

|PROCESO Tipo3; |TIPO 3;
     |CONFI "0000N¿Imprimir presupuesto?";
     |SI FSalida = 0;
          |HAZ Tipo4;
     |FINSI;
|FPRC;

|PROCESO Especi0; |TIPO 0;
     |SI FSalida = 2; |ACABA; |FINSI;

     |SI #0Campo ! 0;
          |ABRE #77;
          #77#0 = #0Campo;
          |LEE 000#77=;
          |SI FSalida ! 0;
               |MENAV "0000No existe especialidad...";
               |ERROR;
          |FINSI;
          |CIERRA #77;
     |SINO;
          nErr = 0;
          |SI Campo = 63; |Y #0#31 ! 0; nErr = 1; |FINSI;
          |SI Campo = 64; |Y #0#59 ! 0; nErr = 1; |FINSI;
          |SI Campo = 65; |Y #0#60 ! 0; nErr = 1; |FINSI;
          |SI Campo = 66; |Y #0#61 ! 0; nErr = 1; |FINSI;
          |SI Campo = 67; |Y #0#62 ! 0; nErr = 1; |FINSI;
          |SI Campo = 90; |Y #0#68 ! 0; nErr = 1; |FINSI;
          |SI Campo = 91; |Y #0#70 ! 0; nErr = 1; |FINSI;
          |SI Campo = 92; |Y #0#72 ! 0; nErr = 1; |FINSI;
          |SI Campo = 93; |Y #0#73 ! 0; nErr = 1; |FINSI;
          |SI Campo = 94; |Y #0#75 ! 0; nErr = 1; |FINSI;
          |SI nErr ! 0;
               |MENAV "0000El codigo de especialidad no puede ser '0'";
               |ERROR;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO IVA006_66; |TIPO 66;
     enTiva = #0Campo;
     efFiva = #0#2;
     |HAZ ConsuIVA;
     |SI eaDiva = "";
          |ERROR;
     |SINO;
          #0Campo = enTiva; |PINTA #0Campo;
     |FINSI;
|FPRC;

|PROCESO IVA006_0; |TIPO 0;
     enTiva = #0Campo;
     efFiva = #0#2;
     |HAZ SacaIVA;
     |SI eaDiva = "";
          |MENAV "0000No existe tipo iva para esta fecha...";
          |ERROR; |ACABA;
     |SINO;
          |HAZ Totales;
     |FINSI;
|FPRC;
