|FICHEROS;
     marhu347 #0;
     marhu348 #1;
     marhu348@ #100;
     agifa134 #134;
     agifa059 #59;
     agifa010 #10;
     agifa024 #24;
     dscam045@ #645;     || Control L
     dscam048@ #648;     || Cobradores
|FIN;

|VARIABLES;
     nSw       = 0;
     &aEmp     = "";
     nBultos   = 0;
     &enEti    = 0;
     nVarias   = 0;
     i         = 0;
     aInforme  = "marhu347";
     aInformeE = "marhu329";
     nModo     = 0;
     nConta    = 0;

 {-1}aMenu     = "";
     aMenu1    = "2400";
     aMenu2    = "1";
     aMenu3    = " Contador: ";
     aMenu4    = "AM";
     aMenu5    = " Automatico ";
     aMenu6    = " Manual ";

 {-1}aMenui    = "";
     aMenui1   = "2400";
     aMenui2   = "1";
     aMenui3   = "";
     aMenui4   = "EL";
     aMenui5   = " Etiquetas ";
     aMenui6   = " Listado ";

     aDef45    = "";
     aDef48    = "";
     aPath     = "";
     aPathDef  = "";
     aPathFic  = "";
     aMensa    = "";
     aAlfa     = "";
     aSer      = "";
     aEmpre    = "";
     nErr      = 0;
     aDef      = "";
     Comodin   = "";
     aNumEmp   = "";
     nNumEmp   = 0;
|FIN;

|PROCESO NumEmp;
     |DFICE Comodin;
     Comodin = Comodin % -205;
     aNumEmp = Comodin;
     nNumEmp = aNumEmp;
|FPRC;

|PROCESO Conta; |TIPO 7;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 1;
          |MENU aMenu;
          |SI FSalida = 1;
               |LEE 000#0u;
               nConta = #0#0 + 1;
               |DDEFECTO #0;
               #0#0 = nConta;
               |PTEC 802;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO DescargaDef;
     |SI aDef45 ! ""; |DESCARGA_DEF #dscam045@; |FINSI;
     |SI aDef48 ! ""; |DESCARGA_DEF #dscam048@; |FINSI;
|FPRC;

|PROCESO CargaDef;
     nErr = 1;

     |DBASS aPath;
     aPath = aPath + "dscarter/";
     aPathDef = aPath + "def/";
     aPath = aPath + "fich/";

     aDef45 = aPathDef + "dscam045";
     |CARGA_DEF aDef45, dscam045@;
     |SI FSalida ! 0;
          aMensa = "0000Error al cargar:" + aDef45;
          |MENAV aMensa;
          aDef45 = ""; |HAZ DescargaDef;
          |ACABA;
     |FINSI;
     aDef48 = aPathDef + "dscam048";
     |CARGA_DEF aDef48, dscam048@;
     |SI FSalida ! 0;
          aMensa = "0000Error al cargar:" + aDef48;
          |MENAV aMensa;
          aDef48 = ""; |HAZ DescargaDef;
          |ACABA;
     |FINSI;

     |PATH_DAT #645 aPath;

     nErr = 0;
|FPRC;

|PROCESO dscam045;
     |SI #dscam045@#2 = "V";
          aEmpre = ("00000" + #dscam045@#6) % -105;
          aPathFic = aPath + aEmpre + "/";
          |ERROR10;
     |FINSI;
|FPRC;

|DEFBUCLE dscam045;
     #dscam045@#1002;
     ;
     nNumEmp, 001;
     nNumEmp, 999;
     ;
     NULL, dscam045;
|FIN;

|PROCESO Tipo66; |TIPO 66;
     |HAZ NumEmp;
     |HAZ CargaDef;
     |SI nErr = 0;
          aEmpre = "";
          |BUCLE dscam045;
          |SI aEmpre ! "";
               |PATH_DAT #648 aPathFic;
               |ABRE #648;
               |LEE 000#648p;
               |CONSULTA_CLAVE #1#648;
               |SI FSalida = 0;
                    #0#1 = #648#0; |PINTA #0#1;
               |SINO;
                    |ERROR;
               |FINSI;
               |CIERRA #648;
          |SINO;
               |MENAV "0000Empresa cartera no encontrada...";
               |ERROR;
          |FINSI;
          |HAZ DescargaDef;
     |FINSI;
|FPRC;

|PROCESO Conductor; |TIPO 0;
     |HAZ NumEmp;
     |HAZ CargaDef;
     |SI nErr = 0;
          aEmpre = "";
          |BUCLE dscam045;
          |SI aEmpre ! "";
               |PATH_DAT #648 aPathFic;
               |ABRE #648;
               #648#0 = #0#1;
               |LEE 000#648=;
               |SI FSalida ! 0;
                    |MENAV "0000Conductor inexistente...";
                    |ERROR;
               |SINO;
                    #0#2 = #648#1; |PINTA #0#2;
               |FINSI;
               |CIERRA #648;
          |SINO;
               |MENAV "0000Empresa cartera no encontrada...";
               |ERROR;
          |FINSI;
          |HAZ DescargaDef;
     |FINSI;
|FPRC;

|PROCESO LinFa;
     #10#52 = #59#15;
     #10#0 = #59#2;
     |LEE 020#10=;
     #1#11 = #10#43; |PINTA #1#11;
     nBultos = nBultos + #10#2;
     |ERROR10;
|FPRC;

|PROCESO DatoFac;
     |ABRE #134;
     #134#49 = #1#2
     #134#0 = #1#3;
     |LEE 020#134=
     |SI FSalida = 0;
          nBultos =  0;
          |ABRE #10;
          |BUCLELIN 2 LinFa #134;
          |CIERRA #10;
          #1#6 = nBultos;
          #1#4 = #134#2;   |PINTA #1#4;
          #1#5 = #134#3;   |PINTA #1#5;
          #1#7 = #134#101; |PINTA #1#7;
          |ABRE #24;
          #24#0 = #1#4;
          |LEE 000#24=;
          |CIERRA #24;
          #1#8 = #24#183;  |PINTA #1#8;
          #1#9 = #24#9;    |PINTA #1#9;
     |FINSI;
     |CIERRA #134;
|FPRC;

|PROCESO Repite; |TIPO 6;
     nModo = (FEntrada / 100)  ! 0;
     |SI nModo ! 1; |ACABA; |FINSI;

     |DDEF aDef;
     aDef = aDef + "marhu348";
     |CARGA_DEF aDef, marhu348@;
     |SI FSalida = 0;
          |ABRE #100;
          |SELECT #2#100;
          #100#2 = #1#2;
          #100#3 = #1#3;
          |LEE 000#100=;
          |SI FSalida = 0;
               aAlfa = "0000Factura ya introducida en expedicion [" + #100#0 + "]";
               |MENAV aAlfa;
               |ERROR;
          |FINSI;
          |SELECT #1#100;
          |CIERRA #100;
          |DESCARGA_DEF #marhu348@;
     |FINSI;
|FPRC;

|PROCESO Tipo2; |TIPO 2;
     #0#4 = #0#4 +. #1#6; |PINTA #0#4;
     #0#5 = #0#5 +. #1#7; |PINTA #0#5;
|FPRC;

|PROCESO Imprime;
     |SI nSw = 0;
          nSw = #1#2;
          aEmp = "MARHUENDA   ";
          |SI nSw = 50;
               aEmp = "MARONS      ";
          |FINSI;
          |SI nSw = 60;
               aEmp = "PRESUPUESTOS";
          |FINSI;
     |FINSI;
     |PRINT;
|FPRC;

|PROCESO ImpreLis;
     |IMPRE 0;
     |SI FSalida = 0;
           |INFOR aInforme;
           |SI FSalida = 0;
               nSw = 0;
               |BUCLELIN 2 Imprime #0;
               |PIEINF;
               |FININF;
           |FINSI;
           |FINIMP;
     |FINSI;
|FPRC;

|PROCESO Tipo30; |TIPO 30;
     |CONFI "0000NImprimir documento...";
     |SI FSalida = 0;
          |HAZ ImpreLis;
     |FINSI;
|FPRC;

|PROCESO Tipo4; |TIPO 4;
     |HAZ ImpreLis;
|FPRC;
