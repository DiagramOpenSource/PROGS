|FICHEROS;
     agi00015 #0;
     agi00014 #1;   || Defectos articulos del proveedor.
     agifa019 #2;   || Articulos.
     agifa142 #4;   || Parametros generales.
|FIN;

|VARIABLES;
     &enTiva = 0;
     &efFiva = @;
     &eaDiva = "";
     &enIva = 0;
     &enRec = 0;
     &eaPrv = "";

     calpre         = 0;
     precio         = 0;
     &proveedor     = "";
     desde          = "";
     hasta          = "";
     m1             = 0;
     m2             = 0;
     m3             = 0;
     m4             = 0;
     m5             = 0;
     m6             = 0;
     prove          = "";
|FIN;
___________________________________________/ CALCULA EL PRECIO Y EL REDONDEO.
|CALCULO pvps1;
     |SI #2#108 =  "S";|O #2#108 = "G";
          |SI calpre = 1; precio = #2#9;   |FINSI;
          |SI calpre = 2; precio = #2#28;  |FINSI;
          |SI calpre = 3; precio = #2#133; |FINSI;
          |SI #2#108 = "S";
               |SI #2#105 ! 0; #2#18  = precio > #2#105; |FINSI;
               |SI #2#106 ! 0; #2#19  = precio > #2#106; |FINSI;
               |SI #2#107 ! 0; #2#20  = precio > #2#107; |FINSI;
               |SI #2#156 ! 0; #2#147 = precio > #2#156; |FINSI;
               |SI #2#157 ! 0; #2#148 = precio > #2#157; |FINSI;
               |SI #2#158 ! 0; #2#149 = precio > #2#158; |FINSI;
          |SINO;
               |SI #2#105 ! 0; #2#18  = (precio * 100) / (100 - #2#105); |FINSI;
               |SI #2#106 ! 0; #2#19  = (precio * 100) / (100 - #2#106); |FINSI;
               |SI #2#106 ! 0; #2#20  = (precio * 100) / (100 - #2#107); |FINSI;
               |SI #2#156 ! 0; #2#147 = (precio * 100) / (100 - #2#156); |FINSI;
               |SI #2#157 ! 0; #2#148 = (precio * 100) / (100 - #2#157); |FINSI;
               |SI #2#158 ! 0; #2#149 = (precio * 100) / (100 - #2#158); |FINSI;
          |FINSI;

          eaPrv = #1#0;
          enTiva = #2#30;
          efFiva = ~;
          |HAZ IVAPrv;

          |SI #2#130 = "S"; |Y #2#105 ! 0; #2#18  = #2#18  > enIva; |FINSI;
          |SI #2#131 = "S"; |Y #2#106 ! 0; #2#19  = #2#19  > enIva; |FINSI;
          |SI #2#132 = "S"; |Y #2#107 ! 0; #2#20  = #2#20  > enIva; |FINSI;
          |SI #2#153 = "S"; |Y #2#156 ! 0; #2#147 = #2#147 > enIva; |FINSI;
          |SI #2#154 = "S"; |Y #2#157 ! 0; #2#148 = #2#148 > enIva; |FINSI;
          |SI #2#155 = "S"; |Y #2#158 ! 0; #2#149 = #2#149 > enIva; |FINSI;

          |SI #2#109 > 0;
               |HAZ redon1;
          |FINSI;
          #2#18  = #2#18  ! #4#9;
          #2#19  = #2#19  ! #4#9;
          #2#20  = #2#20  ! #4#9;
          #2#147 = #2#147 ! #4#9;
          #2#148 = #2#148 ! #4#9;
          #2#149 = #2#149 ! #4#9;
     |FINSI;
|FCAL;

|CALCULO redon1;
     #2#18  = #2#18  ! 0;
     #2#19  = #2#19  ! 0;
     #2#20  = #2#20  ! 0;
     #2#147 = #2#147 ! 0;
     #2#148 = #2#148 ! 0;
     #2#149 = #2#149 ! 0;
     |SI #2#109 > 1;
          m1 = #2#18  $ #2#109;
          m2 = #2#19  $ #2#109;
          m3 = #2#20  $ #2#109;
          m4 = #2#147 $ #2#109;
          m5 = #2#148 $ #2#109;
          m6 = #2#149 $ #2#109;
          |SI m1 ! 0;
               #2#18 = #2#18 + #2#109 - m1;
          |FINSI;
          |SI m2 ! 0;
               #2#19 = #2#19 + #2#109 - m2;
          |FINSI;
          |SI m3 ! 0;
               #2#20 = #2#20 + #2#109 - m3;
          |FINSI;
          |SI m4 ! 0;
               #2#147 = #2#147 + #2#109 - m4;
          |FINSI;
          |SI m5 ! 0;
               #2#148 = #2#148 + #2#109 - m5;
          |FINSI;
          |SI m6 ! 0;
               #2#149 = #2#149 + #2#109 - m6;
          |FINSI;
     |FINSI;
|FCAL;

_____________________________/ ACTUALIZA LOS DEFECTOS POR PROVEEDOR Y EL PVP.
|PROCESO actualiz2;
     #1#0 = #2#27;
     |LEE 000#1=;
     |SI FSalida = 0;
          |PINTA 2435,#2#0;
          #2#109 = #1#2;      || PTS.REDONDEO.
          #2#108 = #1#3;      || CONFIRMA INCREMENTO.
          #2#105 = #1#4;      || % INCREMENTO 1.
          #2#106 = #1#5;      || % INCREMENTO 2.
          #2#107 = #1#6;      || % INCREMENTO 3.
          #2#156 = #1#7;      || % INCREMENTO 4.
          #2#157 = #1#8;      || % INCREMENTO 5.
          #2#158 = #1#9;      || % INCREMENTO 6.
/*
          |HAZ pvps1;
*/
          |GRABA 021#2a;
          |HAZ CalPre109;
          |GRABA 021#2a;
     |FINSI;
     |LIBERA #2;
|FPRC;

|DEFBUCLE actualiza;
     #2#1;
     27;
     "                    ",desde;
     "zzzzzzzzzzzzzzzzzzzz",hasta;
     be;
     NULL,actualiz2;
|FIN;

_________________________________________________________________/ PRINCIPIO.
|PROGRAMA;
     |ABRE #1;
     |ABRE #4;
     |LEE 000#4p;
     prove = proveedor;
     |QBF proveedor;
     |SI proveedor = "";
          calpre = #4#60;
          |CLS;
          |CABEZA "DEFECTOS PROVEEDOR";
          |PINPA #0#0;
          |DDEFECTO #0;
          |PINDA #0#0;
          |ENDATOS #1#0;
          |SI FSalida = 0;
               desde = #0#0;
               hasta = #0#1;
               |BUCLE actualiza;
          |FINSI;
     |SINO;
          |ATRI P;
          |MENSA "0000ACTUALIZANDO ARTICULOS";
          |ATRI p;
          desde = prove;
          hasta = prove;
          |BUCLE actualiza;
          |MENSA "0000 ";
     |FINSI;
     |CIERRA #1;
     |CIERRA #4;
|FPRO;
