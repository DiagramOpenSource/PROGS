Excel_Bost_Iberica_Europa_Netos

|FICHEROS;
     desan007 #0;
     desan003 #3;
     desan004 #4;
     agifa019 #19;
     agifa112 #112;
     agifa321 #321;
     agifa324 #324;
|FIN;

|VARIABLES;
     &nDeci_PreBase = 0;
     &nDeci_PreDiv  = 0;
     nCambioD       = 0;
     nCambioB       = 0;

     nNum = 0;
     nLin = 0;
     aRuta = "";
     aExcel = "";
     aMensa = "";
     nXls = 0;
     nSal = 0;
     aAlfa = "";
     aAlfb = "";
     aAlfc = "";
     aAlfd = "";
     aAlfe = "";
     aAlff = "";
     aAlfh = "";
     aAlfi = "";
     aAlfj = "";
     aAlfk = "";
     aAlfl = "";
     aAlfm = "";
     aAlfn = "";
     aAlfo = "";
     aAlfp = "";
     aAlfq = "";
     aAlfr = "";
     nPre = 0;
     nCan = 0;

     aVal = "";
     aLon = "";
     aDato = "";
     nPos = 0;
     aCar = "";
     i = 0;
|FIN;

|| Coge el 1§ numerico de cantidad
|PROCESO CogeCanti;
     aVal = "";
     aLon = aDato % A0;
     |PARA i = 1; |SI i [ aLon; |HACIENDO i = i + 1;
          nPos = (i * 100) + 1;
          aCar = aDato % nPos;
          aAlfa = "0123456789.," - aCar;
          |SI FSalida > 0;
               aVal = aVal + aCar;
          |SINO;
               |SI aVal ! ""; |SAL; |FINSI;
          |FINSI;
     |SIGUE;
     aDato = aVal;
|FPRC;


B, código articulo.
D, código articulo.
E, descripción.
F, Textos Especiales Observaciones
H, PVP 1.
I, Precio Neto1.
J, Cantidad 1.
K, Precio Neto2.
L, Cantidad 2.
M, Precio Neto3.
N, Cantidad 3.
O, Precio Neto4.
P, Cantidad 4.
Q, Precio Neto5.
R, Cantidad 5.
|PROCESO Registro;
     |SI aAlfb = ""; |Y aAlfd = ""; |ACABA; |FINSI;

     aDato = aAlfj; |HAZ CogeCanti; aAlfj = aDato;
     aDato = aAlfl; |HAZ CogeCanti; aAlfl = aDato;
     aDato = aAlfn; |HAZ CogeCanti; aAlfn = aDato;
     aDato = aAlfp; |HAZ CogeCanti; aAlfp = aDato;
     aDato = aAlfr; |HAZ CogeCanti; aAlfr = aDato;

     |DDEFECTO #19;
     |SI #0#1 = "B";
          #19#0 = aAlfb;
          |LEE 101#19=;
          |SI FSalida ! 0;
               #19#0 = aAlfd;
               |LEE 101#19=;
          |FINSI;
     |SINO;
          #19#0 = aAlfd;
          |LEE 101#19=;
          |SI FSalida ! 0;
               #19#0 = aAlfb;
               |LEE 101#19=;
          |FINSI;
     |FINSI;
     |SI FSalida ! 0; |ACABA; |FINSI;
||     |SI FSalida ! 0; #19#27 = #0#4; #19#213 = #0#4; |GRABA 020#19b; |FINSI;

     aMensa = "0000Procesando " + #19#0;
     |MENSA aMensa;

     aAlfa = #19#1; |QBF aAlfa;
     |SI aAlfa = "";
          #19#1 = aAlfe;
     |FINSI;

     #19#18 = aAlfh;
     |GRABA 020#19a;
     |LIBERA #19;

     |SI nLin = 0;
          |LEE 000#3u;
          |SI FSalida = 0;
               nNum = #3#0 + 1;
          |SINO;
               nNum = 1;
          |FINSI;
          |DDEFECTO #3;
          #3#0 = nNum;
          |GRABA 020#3b;
          #3#1 = #112#0;
          #3#4 = #112#81;
          #3#2 = #0#5;
          #3#3 = #0#6;
          |GRABA 020#3a;
          |LIBERA #3;
     |FINSI;

     nLin = nLin + 1;
     |DDEFECTO #4;
     #4#0 = #3#0;
     #4#1 = nLin;
     |GRABA 020#4b;
     #4#2 = #19#0;
     #4#3 = #19#1;
     #4#5 = aAlfi;
     #4#4 = #4#5 / nCambioD * nCambioB;
     #4#8 = #0#2;
     #4#9 = #0#3;
     #4#10 = aAlfj;
     #4#7 = #3#1;
     #4#12 = #3#2;
     #4#13 = #3#3;

     |QBT aAlff;
     aAlfa = aAlff - "EXENTODESCUENTOPROGRAMA";
     |SI FSalida > 0;
          #4#8 = 0;
     |FINSI;
     aAlfa = aAlff - "EXENTORAPPELPROGRAMA";
     |SI FSalida > 0;
          #4#11 = "S";
     |FINSI;
     aAlfa = aAlff - "EXENTORAPPELYDESCUENTOPROGRAMA";
     |SI FSalida > 0;
          #4#8 = 0;
          #4#11 = "S";
     |FINSI;
     |GRABA 020#4a;
     |LIBERA #4;

     nPre = aAlfk;
     nCan = aAlfl;
     |SI nPre ! 0; |Y nCan ! 0;
          nLin = nLin + 1;
          #4#1 = nLin;
          |GRABA 020#4b;
          #4#5 = aAlfk;
          #4#4 = #4#5 / nCambioD * nCambioB;
          #4#10 = aAlfl;
          |GRABA 020#4a;
          |LIBERA #4;
     |FINSI;

     nPre = aAlfm;
     nCan = aAlfn;
     |SI nPre ! 0; |Y nCan ! 0;
          nLin = nLin + 1;
          #4#1 = nLin;
          |GRABA 020#4b;
          #4#5 = aAlfm;
          #4#4 = #4#5 / nCambioD * nCambioB;
          #4#10 = aAlfn;
          |GRABA 020#4a;
          |LIBERA #4;
     |FINSI;

     nPre = aAlfo;
     nCan = aAlfp;
     |SI nPre ! 0; |Y nCan ! 0;
          nLin = nLin + 1;
          #4#1 = nLin;
          |GRABA 020#4b;
          #4#5 = aAlfo;
          #4#4 = #4#5 / nCambioD * nCambioB;
          #4#10 = aAlfp;
          |GRABA 020#4a;
          |LIBERA #4;
     |FINSI;

     nPre = aAlfb;
     nCan = aAlfq;
     |SI nPre ! 0; |Y nCan ! 0;
          nLin = nLin + 1;
          #4#1 = nLin;
          |GRABA 020#4b;
          #4#5 = aAlfq;
          #4#4 = #4#5 / nCambioD * nCambioB;
          #4#10 = aAlfr;
          |GRABA 020#4a;
          |LIBERA #4;
     |FINSI;
|FPRC;

|PROCESO Tipo3; |TIPO 3;
     |ABRE #112;
     |DDEFECTO #112;
     #112#0 = #0#4;
     |LEE 020#112=;
     |CIERRA #112;

     |ABRE #321; |LEE 000#321p; |CIERRA #321;
     |ABRE #324;
     #324#0 = #321#9;
     |LEE 000#324=;
     nDeci_PreBase = #324#9;
     nCambioB = #324#3;
     #324#0 = #112#81;
     |LEE 000#324=;
     nDeci_PreDiv = #324#9;
     nCambioD = #324#3;
     |CIERRA #324;

     |ABRE #19;
     |ABRE #3;
     |ABRE #4;

     aExcel = #0#7; |QBF aExcel;
     |XABRE "CE", aExcel, 0;
     |SI FSalida < 0
          |MENAV "0000No puedo abrir el fichero a importar";
     |SINO;
          |CARGADLL "agixl97.dll";
          |SI FSalida < 0;
               |MENAV "0000No se puede usar agixl97.dll";
          |SINO;
               |ALFACALLDLL "agixl97.dll", "carga_book", aExcel;
               aAlfa = #0#10; |QBF aAlfa;
               |ALFACALLDLL "agixl97.dll", "selecciona_hoja", aAlfa;
               |SI FSalida = 0;
                    |PARA nXls = #0#8; |SI nXls [ #0#9; |HACIENDO nXls = nXls + 1;
                         aAlfa = "Importando:" + nXls;
                         |PINTA 2003, aAlfa;
                         aAlfb = "B" + nXls; |ALFACALLDLL "agixl97.dll", "peek_dato", aAlfb;
                         |SI FSalida ! 0; |SAL; |FINSI;
                         aAlfd = "D" + nXls; |ALFACALLDLL "agixl97.dll", "peek_dato", aAlfd;
                         |SI FSalida ! 0; |SAL; |FINSI;
                         aAlfe = "E" + nXls; |ALFACALLDLL "agixl97.dll", "peek_dato", aAlfe;
                         |SI FSalida ! 0; |SAL; |FINSI;
                         aAlff = "F" + nXls; |ALFACALLDLL "agixl97.dll", "peek_dato", aAlff;
                         |SI FSalida ! 0; |SAL; |FINSI;
                         aAlfh = "H" + nXls; |ALFACALLDLL "agixl97.dll", "peek_dato", aAlfh;
                         |SI FSalida ! 0; |SAL; |FINSI;
                         aAlfi = "I" + nXls; |ALFACALLDLL "agixl97.dll", "peek_dato", aAlfi;
                         |SI FSalida ! 0; |SAL; |FINSI;
                         aAlfj = "J" + nXls; |ALFACALLDLL "agixl97.dll", "peek_dato", aAlfj;
                         |SI FSalida ! 0; |SAL; |FINSI;
                         aAlfk = "K" + nXls; |ALFACALLDLL "agixl97.dll", "peek_dato", aAlfk;
                         |SI FSalida ! 0; |SAL; |FINSI;
                         aAlfl = "L" + nXls; |ALFACALLDLL "agixl97.dll", "peek_dato", aAlfl;
                         |SI FSalida ! 0; |SAL; |FINSI;
                         aAlfm = "M" + nXls; |ALFACALLDLL "agixl97.dll", "peek_dato", aAlfm;
                         |SI FSalida ! 0; |SAL; |FINSI;
                         aAlfn = "N" + nXls; |ALFACALLDLL "agixl97.dll", "peek_dato", aAlfn;
                         |SI FSalida ! 0; |SAL; |FINSI;
                         aAlfo = "O" + nXls; |ALFACALLDLL "agixl97.dll", "peek_dato", aAlfo;
                         |SI FSalida ! 0; |SAL; |FINSI;
                         aAlfp = "P" + nXls; |ALFACALLDLL "agixl97.dll", "peek_dato", aAlfp;
                         |SI FSalida ! 0; |SAL; |FINSI;
                         aAlfq = "Q" + nXls; |ALFACALLDLL "agixl97.dll", "peek_dato", aAlfq;
                         |SI FSalida ! 0; |SAL; |FINSI;
                         aAlfr = "R" + nXls; |ALFACALLDLL "agixl97.dll", "peek_dato", aAlfr;
                         |SI FSalida ! 0; |SAL; |FINSI;

                         |HAZ Registro;
                         |SI nSal = 1; |SAL; |FINSI;

                    |SIGUE;
                    |ALFACALLDLL "agixl97.dll", "fin_book", "salva";
               |FINSI;
          |FINSI;
          |DESCARGADLL "agixl97.dll";
     |FINSI;

     |CIERRA #4;
     |CIERRA #3;
     |CIERRA #19;
|FPRC;

|PROCESO Browser; |TIPO 0;
     |SI FSalida ! 10; |ACABA; |FINSI;

     aRuta = "F*.xls";

     |BROWSE aRuta;

     aRuta = aRuta % 2; |QBF aRuta;
     |SI aRuta = "F"; aRuta = ""; |FINSI;

     |QBF aRuta;
     |SI aRuta = "";
          |ERROR;
     |SINO;
          #0#7 = aRuta;
          |PINTA #0#7;
     |FINSI;
|FPRC;

|PROGRAMA;
     |ABRE #0;
     |LEE 101#0p;
     |SI FSalida ! 0; |GRABA 020#0b; |FINSI;
     |PINPA #0#0;
     |PINDA #0#0;
     |ENDATOS #1#0;
     |SI FSalida = 0; |GRABA 020#0a; |FINSI;
     |CIERRA #0;
|FPRO;
