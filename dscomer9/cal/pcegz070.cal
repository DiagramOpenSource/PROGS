|FICHEROS;
     pcegz070 #0;
     pcegm004 #4;
     pcegm005 #5;
     pcegm012 #12;
     agifa019 #19;
     agifa067 #67;
     agifa081 #81;
     agifa570 #570; ||Tmp
|FIN;

|VARIABLES;
     &eaAlfa = "";
     &Tempo = "";
     aPath = "";
     aAlfa = "";
     aSepara = "";
     aDato = "";
     nHandle = 0;
     nHandle1 = 0;
     nHandle2 = 0;
     nPdte = 0;
     nHay = 0;
     p = "";
     aCaracter = "";
     aLen = 0;
     i = 0;
     aCadena = "";
     nPosi = 0;
|FIN;

|PROCESO QuitaRaros1;
     eaAlfa = aDato;
     |HAZ QuitaRaros;
     aDato = eaAlfa;
/*
     aAlfa = aDato;
     |OEM_ANSI aAlfa, aAlfa;
     aDato = aAlfa;
*/
|FPRC;

|PROCESO pcegm005;
     nPdte = #5#5 - #5#43;

     #570#1 = #5#2;
     |LEE 101#570=;
     |SI FSalida = 0;
          #570#2 = #570#2 + nPdte;
          |GRABA 020#570a;
     |SINO;
          #570#2 = nPdte;
          |GRABA 020#570n;
     |FINSI;
     |LIBERA #570;
|FPRC;

|DEFBUCLE pcegm004;
     #4#4;
     ;
     "C", "      ", 0001, "     ", 000001;
     "C", "zzzzzz", 9999, "zzzzz", 999999;
     ;
     NULL, NULL, pcegm005;
|FIN;

|PROCESO agifa067;
     nPdte = #67#5 - #67#38;

     |SI nPdte [ 0; |ACABA; |FINSI;

     aDato = #67#28; |QBF aDato; aDato = aDato + aSepara;
     aAlfa = (("000000" + #67#0) % -106);
     aDato = aDato + aAlfa; |QBF aDato; aDato = aDato + aSepara;
     aAlfa = (("000" + #67#1) % -103);
     aDato = aDato + aAlfa; |QBF aDato; aDato = aDato + aSepara;
     aDato = aDato + p + #67#2; |QBF aDato; aDato = aDato + p + aSepara;
     aDato = aDato + #67#4; |QBF aDato; aDato = aDato + aSepara;
     aDato = aDato + nPdte; |QBF aDato; aDato = aDato + aSepara;
     aAlfa = (#67#13 % 102) + "/" + (#67#13 % 402) + "/" + (#67#13 % 704);
     aDato = aDato + aAlfa; |QBF aDato; aDato = aDato + aSepara;
     |HAZ QuitaRaros1;
     |XGRABA nHandle2, aDato;

     nHay = 1;
|FPRC;

|DEFBUCLE agifa067;
     #67#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, agifa067;
|FIN;

|PROCESO agifa081;
     |SI nHay = 0;
          |ACABA;
     |FINSI;

     aDato = #81#25; |QBF aDato; aDato = aDato + aSepara;
     aAlfa = (("000000" + #81#0) % -106);
     aDato = aDato + aAlfa; |QBF aDato; aDato = aDato + aSepara;
     aAlfa = (#81#1 % 102) + "/" + (#81#1 % 402) + "/" + (#81#1 % 704);
     aDato = aDato + aAlfa; |QBF aDato; aDato = aDato + aSepara;
     aDato = aDato + #81#4; |QBF aDato; aDato = aDato + aSepara;
     aDato = aDato + p + #81#8; |QBF aDato; aDato = aDato + p + aSepara;
     aAlfa = (#81#2 % 102) + "/" + (#81#2 % 402) + "/" + (#81#2 % 704);
     aDato = aDato + aAlfa; |QBF aDato; aDato = aDato + aSepara;
     |HAZ QuitaRaros1;
     |XGRABA nHandle1, aDato;
|FPRC;

|PROCESO Ini;
     nHay = 0;
|FPRC;

|DEFBUCLE agifa081;
     #81#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Ini, agifa067, agifa081;
|FIN;

|PROCESO agifa019;
     |DDEFECTO #12;
     #12#0 = #19#0;
     |LEE 000#12=;

     |DDEFECTO #570;
     #570#1 = #19#0;
     |LEE 000#570=;

     aDato = #19#0; |QBF aDato; aDato = aDato + aSepara;
     aDato = aDato + p + #19#1; |QBF aDato; aDato = aDato + p + aSepara;
     aDato = aDato + #19#104; |QBF aDato; aDato = aDato + aSepara;
     aDato = aDato + #12#2; |QBF aDato; aDato = aDato + aSepara;
     aDato = aDato + #570#2; |QBF aDato; aDato = aDato + aSepara;
     aDato = aDato + p + #12#3; |QBF aDato; aDato = aDato + p + aSepara;
     |HAZ QuitaRaros1;
     |XGRABA nHandle, aDato;
|FPRC;

|DEFBUCLE agifa019;
     #19#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, agifa019;
|FIN;

|PROCESO Tipo3; |TIPO 3;
     p = &34;
     aSepara = ";";
     aPath = #0#1; |QBF aPath;
     aAlfa = aPath % -101;
     |SI aAlfa ! "/"; |Y aAlfa ! "\"; aPath = aPath + "/"; |FINSI;
     |MKDIR aPath;

     aAlfa = aPath + "pedido_cabecera.csv";
     |XABRE "CW", aAlfa, nHandle1;
     |SI FSalida < 0;
          |MENAV "0000Error al crear 'pedido_cabecera.csv'.";
     |SINO;
          aDato = p + "serial" + p + aSepara;
          aDato = aDato + p + "number" + p + aSepara;
          aDato = aDato + p + "order_date" + p + aSepara;
          aDato = aDato + p + "provider" + p + aSepara;
          aDato = aDato + p + "provider_name" + p + aSepara;
          aDato = aDato + p + "delivery_date" + p;
          |XGRABA nHandle1, aDato;

          aAlfa = aPath + "pedido_linea.csv";
          |XABRE "CW", aAlfa, nHandle2;
          |SI FSalida < 0;
               |MENAV "0000Error al crear 'pedido_linea.csv'.";
          |SINO;
               aDato = p + "serial" + p + aSepara;
               aDato = aDato + p + "number" + p + aSepara;
               aDato = aDato + p + "line" + p + aSepara;
               aDato = aDato + p + "code" + p + aSepara;
               aDato = aDato + p + "article_description" + p + aSepara;
               aDato = aDato + p + "units outstanding" + p + aSepara;
               aDato = aDato + p + "delivery_date" + p;
               |XGRABA nHandle2, aDato;
               |BUCLE agifa081;
               |XCIERRA nHandle2;
          |FINSI;
          |XCIERRA nHandle1;
     |FINSI;

     |HAZ CreaTempo; |NOME_DAT #570 Tempo; |DELINDEX #570;
     |ABRE #570;
     |BUCLE pcegm004;

     aAlfa = aPath + "articulo.csv";
     |XABRE "CW", aAlfa, nHandle;
     |SI FSalida < 0;
          |MENAV "0000Error al crear 'articulo.csv'.";
     |SINO;
          aDato = p + "code" + p + aSepara;
          aDato = aDato + p + "description" + p + aSepara;
          aDato = aDato + p + "stock" + p + aSepara;
          aDato = aDato + p + "mode" + p + aSepara;
          aDato = aDato + p + "pending" + p + aSepara;
          aDato = aDato + p + "note" + p;
          |XGRABA nHandle, aDato;
          |ABRE #12;
          |BUCLE agifa019;
          |CIERRA #12;
          |XCIERRA nHandle;
     |FINSI;

     |CIERRA #570;
     |HAZ BoraTempo; |DELINDEX #570;
|FPRC;

|PROGRAMA;
     |ABRE #0;
     |LEE 101#0p;
     |SI FSalida ! 0; |GRABA 020#0b; |FINSI;
     |SI PARAMETRO = "menu";
          |CLS;
          |PINPA #0#0;
          |PINDA #0#0;
          |ENDATOS #1#0;
          |SI FSalida = 0; |GRABA 020#0a; |FINSI;
     |SINO;
          |HAZ Tipo3;
     |FINSI;
     |CIERRA #0;
|FPRO;
