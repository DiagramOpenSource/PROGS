|FICHEROS;
     dsz99984  #0;
     agis0002  #2;
     dscam044@ #644;     || Control C
     dscam045@ #645;     || Control L
     dscam003@ #1603;     || Recibos Venta
     dscam004@ #604;     || Movimientos Recibos Venta
     dscam008@ #608;     || Recibos Compra
     dscam009@ #609;     || Movimientos Recibos Compra
     dscamrec@ #600;     || Puente
     agifa134  #134;
     agifa133  #133;
     agifa079  #79;
     agifa084  #84;
     agifa324  #324;
     agifa025  #25;
     agifa024  #24;
     agifa112  #112;
     agifa010  #10;
     agifa142  #142;
     agifa724  #724;
     dsm00289  #289;

     agifa091@ #1091;         ||Formas de Pago en Luxe Perfil
     luxe0048@ #1048;         ||Situaciones

     refere1@ #1000;
     referen@ #2000;

     visal000@;
     pycm0014@;
     maesm012@;
|FIN;

|VARIABLES;
     aEstanTodosCobrados = ""; || Ver tambien dsz99973, esta la misma pero global
     aSerAlb = "";
     nNumAlb = 0;
     nTotalCob = 0;
     nTotalAlb = 0;
     aBass = "";
     nEmp = 0;
     nDespreciado = 0;
     aBaseLxe = "";
     aMensaje = "";
     aAlfa1 = "";
     nEmpresa = 0;
     aFPago = "";
     aCurso = "";

     aCodSitu = "";
     aDescSitu = "";
     nError = 0;
     aDef = "";
     aTipoCta = "";
     nHay = 0;
     aFam = "";
     aDesArti = "";
     aCta  = "";
     aCtaC = "";
     aCtaV = "";
     nUltimoRec = 0;
     nSwEsCompaq = 0;
     nCampos = 0;
     aAlfaB  = "";

     &eaModulo = "";
     &enNumCartera  = 0;
     &enNumReci     = 0;
     &eaDEjer       = "";
     &eaHEjer       = "";
     &Tempo         = "";
     aTempo600      = "";
     &nDeci_Div     = 0;
     &nDeci_Base    = 0;                          ||pte. de cargar!!!!!!
     &aCPath        = "";     || Enlace a
     &aCNome        = "";     || cartera
     aSubProg       = ":dscarter/dsrecibo";
     &enDirEnt      = 0;
     &eaDirEnt      = "";
     &eaEmpExt      = "";

     &enErrCarte    = 0;

     &eaSer         = 0;
     &enNum         = 0;
     &eaTipoEntre   = "";
     &enTotaEntre   = 0;
     &enNumRec      = 0;
     &enAcuenta     = 0;
     &eaProg        = "";

     nLinea         = 0;
     nCalc          = 0;
     nAnyo          = 0;
     nSwLee         = 0;
     nLiqui         = 0;
     nNumRec        = 0;
     aTipoRec       = "";
     DEjer          = "";
     HEjer          = "";
     nSwEntrega     = 0;
     nTotal         = 0;
     nErr           = 0;
     aPath          = "";
     aPathFic       = "";
     aPathDef       = "";
     aMensa         = "";
     aDef00         = "";
     aDef44         = "";
     aDef45         = "";
     aDef03         = "";
     aDef04         = "";
     aDef08         = "";
     aDef09         = "";
     aSer           = "";
     aEmpre         = "";
     aAlfa          = "";
     aTipo          = "";
     aZona          = "";
     nRec           = 0;
     nImp           = 0;
     nNum           = 0;
     nCobra         = 0;
     nBase          = 0;
     nEuro          = 0;
     Comodin        = "";
     aNumEmp        = "";
     nNumEmp        = 0;
     nKK            = 0;
     SwAbre         = 0;

     || OTP
     &eaCliente = "";
     &enNumCampos = 0;
     &eaEmpresa = "";
     &eaAlfa = "";
     &eAlfa1 = "";
     &eAlfa2 = "";
     &eAlfa3 = "";
     &eAlfa4 = "";
     &eAlfa5 = "";
     aBase = "";
     aMase = "";
     aQueQuiero = "";
     aNumCampos = "";
     aMas = "";
     aFich = "";
     &eaIBAN = "";
     || fin Otp
|FIN;

|PROCESO EmpresaPrevencion;
     |DBASS aBase;
     aMas = aBase + "dspreven/def/visal000.mas";

     |CARGA_DEF aMas, visal000@;
     aQueQuiero = "|NC";
     aNumCampos = #visal000@#aQueQuiero#;
     enNumCampos = aNumCampos;
     eaEmpresa = "00001";

     |SI enNumCampos = 4;
          aFich = aBase + "dspreven/fich/";
          |PATH_DAT #visal000@#aFich#;
          |ABRE #visal000@;
          |SELECT #2#visal000@;
          #visal000@#3 = "S";
          |LEE 000#visal000@.=;
          |SI FSalida = 0;
               eaEmpresa = ("00000" + #visal000@#0) % -105;
          |FINSI;
          |CIERRA #visal000@;
     |FINSI;

     |DESCARGA_DEF #visal000@;
|FPRC;

|PROCESO CtaOTP;
     eaIBAN = "";
     |DBASS aBase;
     aAlfa = aBase + "dspreven/def/pycm0014.mas";
     |CARGA_DEF aAlfa, pycm0014@;
     |SI FSalida = 0;
          |HAZ EmpresaPrevencion;

          aAlfa = aBase + "dspreven/fich/" + eaEmpresa + "/";
          |PATH_DAT #pycm0014@#aAlfa#;

          |ABRE #pycm0014@;
          |SELECT #3#pycm0014@;
          #pycm0014@#0 = eaCliente;
          #pycm0014@#6 = "*";
          |LEE 000#pycm0014@.=;
          |SI FSalida = 0;
               eAlfa5 = "";
               aAlfa = aBase + "dspreven/def/maesm012.mas";
               |CARGA_DEF aAlfa, maesm012@;
               |SI FSalida = 0;
                    |ABRE #maesm012@;
               ||   #maesm012@#0 = eAlfa1;
                    #maesm012@#0 = #pycm0014@#2;
                    |LEE 000#maesm012@.=;
                    |CIERRA #maesm012@;
                    eAlfa5 = #maesm012@#1; |QBF eAlfa5;
                    |DESCARGA_DEF #maesm012@;
               |FINSI;

               aAlfa = #pycm0014@#2;              ||Entidad
               aAlfa = aAlfa + #pycm0014@#3;      ||Sucursal
               aAlfa = aAlfa + #pycm0014@#5;      ||DC
               aAlfa = aAlfa + #pycm0014@#4;      ||Cuenta

               eAlfa1 = #pycm0014@#2;      ||Entidad
               eAlfa2 = #pycm0014@#3;      ||Sucursal
               eAlfa3 = #pycm0014@#5;      ||DC
               eAlfa4 = #pycm0014@#4;      ||Cuenta
               eaIBAN = #pycm0014@#8;

               |ABRE #24;
               #24#0 = eaCliente;
               |LEE 101#24=;
               |SI FSalida = 0;
                    #24#32  = #pycm0014@#2;
                    #24#33  = #pycm0014@#3;
                    #24#31  = #pycm0014@#5;
                    #24#30  = #pycm0014@#4;
                    |GRABA 020#24a;
                    |LIBERA #24;
                    |SI eAlfa5 = "";
                         eAlfa5 = #24#29;
                    |FINSI;
               |FINSI;
               |CIERRA #24;
          |SINO;
               |ABRE #24;
               #24#0 = eaCliente;
               |LEE 000#24=;
               |CIERRA #24;
               aAlfa = (#24#32%104)+(#24#33%104)+(#24#31%102)+(#24#30%110);
               |QBF aAlfa;
               eaIBAN = #24#215;
               eAlfa5 = #24#29;
          |FINSI;
          |CIERRA #pycm0014@;
          |DESCARGA_DEF #pycm0014@;

          |SI aAlfa = ""; |Y eAlfa1 = "";
               |MENAV "0000Cuenta bancaria predeterminada inaccesible. Se quedara en blanco.";
          |FINSI;
          eaAlfa = aAlfa;
     |FINSI;
|FPRC;

|PROCESO NumEmp;
     |DFICE Comodin;
     Comodin = Comodin % -106;
     Comodin = Comodin % 0105;
     aNumEmp = Comodin;
     nNumEmp = aNumEmp;

     aAlfa = (("00000" + nNumEmp) % -105);
     |SI aAlfa ! aNumEmp;
        |SI eaEmpExt ! "";
           aNumEmp = eaEmpExt;
           nNumEmp = aNumEmp;
        |FINSI;
     |FINSI;
|FPRC;

|PROCESO DescargaDef;
     |SI aDef09 ! ""; |DESCARGA_DEF #dscam009@; |FINSI;
     |SI aDef08 ! ""; |DESCARGA_DEF #dscam008@; |FINSI;
     |SI aDef04 ! ""; |DESCARGA_DEF #dscam004@; |FINSI;
     |SI aDef03 ! ""; |DESCARGA_DEF #dscam003@; |FINSI;
     |SI aDef45 ! ""; |DESCARGA_DEF #dscam045@; |FINSI;
     |SI aDef44 ! ""; |DESCARGA_DEF #dscam044@; |FINSI;
|FPRC;

|PROCESO CargaDef;
     nErr = 1;

     |DBASS aPath;
     aPath = aPath + "dscarter/";
     aPathDef = aPath + "def/";
     aPath = aPath + "fich/";

     aDef44 = aPathDef + "dscam044";
     |CARGA_DEF aDef44, dscam044@;
     |SI FSalida ! 0;
||
||        ***SIN ERRORES*** (la cartera puedeque no este instalada=
||
||          aMensa = "0000Error al cargar:" + aDef44;
||          |MENAV aMensa;

          aDef44 = ""; |HAZ DescargaDef;
          |ACABA;
     |FINSI;

     aDef45 = aPathDef + "dscam045";
     |CARGA_DEF aDef45, dscam045@;
     |SI FSalida ! 0;
          aMensa = "0000Error al cargar:" + aDef45;
          |MENAV aMensa;
          aDef45 = ""; |HAZ DescargaDef;
          |ACABA;
     |FINSI;

     aDef03 = aPathDef + "dscam003";
     |CARGA_DEF aDef03, dscam003@;
     |SI FSalida ! 0;
          aMensa = "0000Error al cargar:" + aDef03;
          |MENAV aMensa;
          aDef03 = ""; |HAZ DescargaDef;
          |ACABA;
     |FINSI;

     aDef04 = aPathDef + "dscam004";
     |CARGA_DEF aDef04, dscam004@;
     |SI FSalida ! 0;
          aMensa = "0000Error al cargar:" + aDef04;
          |MENAV aMensa;
          aDef04 = ""; |HAZ DescargaDef;
          |ACABA;
     |FINSI;

     aDef08 = aPathDef + "dscam008";
     |CARGA_DEF aDef08, dscam008@;
     |SI FSalida ! 0;
          aMensa = "0000Error al cargar:" + aDef08;
          |MENAV aMensa;
          aDef08 = ""; |HAZ DescargaDef;
          |ACABA;
     |FINSI;

     aDef09 = aPathDef + "dscam009";
     |CARGA_DEF aDef09, dscam009@;
     |SI FSalida ! 0;
          aMensa = "0000Error al cargar:" + aDef09;
          |MENAV aMensa;
          aDef09 = ""; |HAZ DescargaDef;
          |ACABA;
     |FINSI;

     |PATH_DAT #644 aPath;
     |PATH_DAT #645 aPath;

     nErr = 0;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO dscam003Entrega;
     nCobra = nCobra + #dscam003@#60;
     nNumRec = #dscam003@#2;
|FPRC;

|DEFBUCLE dscam003Entrega;
     #dscam003@#6006;
     4, 46;
     00, aSer, nNum, #2#18, aTipoRec, 000000001, DEjer, nNumEmp;
     99, aSer, nNum, #2#18, aTipoRec, 999999999, HEjer, nNumEmp;
     ;
     NULL, dscam003Entrega;
|FIN;

|PROCESO dscam004;
   nCobra = 3;
|FPRC;

|DEFBUCLE dscam004;
#dscam004@#1002;
;
#dscam003@#40,001;
#dscam003@#40,999;
;
NULL,dscam004;
|FIN;

|PROCESO dscam003;
     |SI enNumReci = #dscam003@#2;
          enNumCartera = #dscam003@#40;
     |FINSI;

     nKK = #dscam003@#23 ! nDeci_Div;
     |SI nKK > 0;             nCobra = 1; |ERROR10; |FINSI;
     |SI #dscam003@#14 ! "P";
        |SI #dscam003@#30 ! 0; nCobra = 2; |ERROR10; |FINSI;
     |FINSI;
     |BUCLE dscam004;
     |SI nCobra ! 0; |ERROR10; |FINSI;
|FPRC;

|DEFBUCLE dscam003;
     #dscam003@#6006;
     69, 4, 46;
     00, aSer, nNum, 001, " ", 000000001, " ",DEjer, nNumEmp;
     99, aSer, nNum, 999, "z", 999999999, " ",HEjer, nNumEmp;
     ;
     NULL, dscam003;
|FIN;

|PROCESO agis0002;
     DEjer = #2#7;
     HEjer = #2#7;
     |BUCLE dscam003Entrega;
|FPRC;

|DEFBUCLE agis0002;
     #2#1;
     ;
     aTipoRec, aSer, nNum, 001;
     aTipoRec, aSer, nNum, 999;
     ;
     NULL, agis0002;
|FIN;

|PROCESO dscam009;
   nCobra = 3;
|FPRC;

|DEFBUCLE dscam009;
#dscam009@#1002;
;
#dscam008@#40,001;
#dscam008@#40,999;
;
NULL,dscam009;
|FIN;

|PROCESO dscam008;
     nKK =  #dscam008@#57 ! nDeci_Base;
     |SI nKK > 0;
          nCobra = 1;
          |ERROR10;
     |FINSI;
     |SI #dscam008@#14 ! "P";
        |SI #dscam008@#25 ! 0; nCobra = 2; |ERROR10; |FINSI;
     |FINSI;
     |BUCLE dscam009;
     |SI nCobra ! 0; |ERROR10; |FINSI;
|FPRC;

|DEFBUCLE dscam008;
     #dscam008@#2004;
     4, 46;
     00, aSer, nNum, 001, DEjer, nNumEmp;
     99, aSer, nNum, 999, HEjer, nNumEmp;
     ;
     NULL, dscam008;
|FIN;

|PROCESO dscam045;
     |SI #dscam045@#2 = aTipo; |Y aTipo = "V";
          |SI aSer ] #dscam045@#4; |Y aSer [ #dscam045@#5;
               aEmpre = ("00000" + #dscam045@#6) % -105;
               aPathFic = aPath + aEmpre + "/";
               |PATH_DAT #1603 aPathFic; |PATH_DAT #604 aPathFic;
               |SI nSwLee = 1;
                    |ERROR10; |ACABA;
               |FINSI;
               |SI nSwEntrega = 1;
                    |BUCLE agis0002;
/*
                    DEjer = eaDEjer;
                    HEjer = eaHEjer;
                    |BUCLE dscam003Entrega;
*/
                    |ERROR10;
               |SINO;
                    nCobra = 0;
                    enNumCartera = 0;
                    |BUCLE dscam003;
                    |SI nCobra ! 0; |ERROR10; |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
     |SI #dscam045@#2 = aTipo; |Y aTipo = "C";
          |SI aSer ] #dscam045@#4; |Y aSer [ #dscam045@#5;
               aEmpre = ("00000" + #dscam045@#6) % -105;
               aPathFic = aPath + aEmpre + "/";
               |PATH_DAT #608 aPathFic; |PATH_DAT #609 aPathFic;
               nCobra = 0;
               |BUCLE dscam008;
               |SI nCobra ! 0; |ERROR10; |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE dscam045;
     #dscam045@#1002;
     ;
     nNumEmp, 001;
     nNumEmp, 999;
     ;
     NULL, dscam045;
|FIN;

|PROCESO TempoPase;
     |DBASS aPath;
     aPath = aPath + "dscarter/";
     aDef00 = aPath + "def/dscamrec";
     |CARGA_DEF aDef00, dscamrec@;
     |SI FSalida ! 0;
||
||   ***SIN ERRORES***
||          aMensa = "0000Error al cargar:" + aDef00;
||          |MENAV aMensa;

          aDef00 = "";
     |SINO;
          aPath = aPath + "fich/";
          |HAZ CreaTempo; aTempo600 = Tempo;
          |PATH_DAT #600 aPath;
          |NOME_DAT #600 aTempo600; |DELINDEX #600;
          |ABRE #600; aAlfaB = "|NC";
          aAlfaB = #600#aAlfaB#; nCampos = aAlfaB;
          aCPath = aPath;
          aCNome = Tempo;
     |FINSI;
|FPRC;

|PROCESO FinTempo;
     |SI aDef00 ! "";
          |CIERRA #600;
          |DELINDEX #600; Tempo = aTempo600; |HAZ BoraTempo;
          |DESCARGA_DEF #dscamrec@;
     |FINSI;
|FPRC;

|PROCESO CargaReciV;
     #dscamrec@#1 = #133#4; ||Ser
     #dscamrec@#2 = #133#0; ||Fac
     #dscamrec@#3 = #133#1; ||Rec
     #dscamrec@#5 = aAlfa;  ||Fecha Emision
     #dscamrec@#22 = #133#1;||Doc
     #dscamrec@#25 = aNumEmp;
     #dscamrec@#27 = "V";
     #dscamrec@#28 = "B";
     |GRABA 020#dscamrec@.n;
|FPRC;

|DEFBUCLE CargaReciV;
     #133#1;
     ;
     aSer, nNum, 001;
     aSer, nNum, 999;
     ;
     NULL, CargaReciV;
|FIN;

|PROCESO CargaReciC;
     nUltimoRec = 0;
     |PARA nRec = 0; |SI nRec  < 12; |HACIENDO nRec = nRec + 1;
          nImp = nRec + 33;
          nCalc = nRec + 68; |SI nCalc > 73; nCalc = nCalc + 55; |FINSI;
          |SI #79#nImp# ! 0;
               #dscamrec@#1 = #79#66;   ||Ser
               #dscamrec@#2 = #79#0;    ||Fac
               #dscamrec@#3 = nRec + 1; ||Rec
               #dscamrec@#5 = #79#1;    ||Fecha Emision
               #dscamrec@#22 = nRec + 1;||Doc
               #dscamrec@#25 = aNumEmp;
               #dscamrec@#27 = "C";
               #dscamrec@#28 = "B";
               |GRABA 020#dscamrec@.n;
               nUltimoRec = #dscamrec@#3 + 1;
          |FINSI;
     |SIGUE;
     |SI #79#146 ! 0;
          #dscamrec@#1 = #79#66;   ||Ser
          #dscamrec@#2 = #79#0;    ||Fac
          #dscamrec@#3 = nUltimoRec; ||Rec
          #dscamrec@#5 = #79#1;    ||Fecha Emision
          #dscamrec@#22 = nUltimoRec;||Doc
          #dscamrec@#25 = aNumEmp;
          #dscamrec@#27 = "C";
          #dscamrec@#28 = "B";
          |GRABA 020#dscamrec@.n;
     |FINSI;
|FPRC;

|PROCESO LeeReciV;
/*
     |DDEFECTO #1603;
     |ABRE #1603;
     |SELECT #6#1603;
     #1603#27 = 0;
     #1603#0 = #0#17;
     #1603#1 = #0#0;
     #1603#2 = #0#1;
     #1603#69 = "P";
     #1603#40 = 1;
     |LEE 000#1603];
     |SI FSalida ! 0; |O #1603#27 = 0; |O #1603#0 = #0#17; |O #1603#1 = #0#0;
      |O #1603#2 = #0#1; |O #1603#69 = "P";
          #1603#69 = "A";
          #1603#40 = 1;
          |LEE 000#1603];
          |SI FSalida ! 0; |O #1603#27 = 0; |O #1603#0 = #0#17; |O #1603#1 = #0#0;
           |O #1603#2 = #0#1; |O #1603#69 = "A";
              |DDEFECTO #1603;
          |FINSI;
     |FINSI;
     |CIERRA #1603;
     nLiqui = #1603#23;
*/
     nLiqui = 0;
     nHay = 0;
     |ABRE #1603;
     |SELECT #6#1603;
     #1603#27 = 0;
     #1603#0 = #0#17;
     #1603#1 = #0#0;
     #1603#2 = #0#1;
     #1603#69 = "P";
     #1603#40 = 1;
     |LEE 000#1603];
     |PARA; |SI FSalida = 0; |Y #1603#27 = 0; |Y #1603#0 = #0#17;
               |Y #1603#1 = #0#0; |Y #1603#2 = #0#1; |Y #1603#69 = "P";
               |HACIENDO;
          |SI #1603#46 = nNumEmp;
               nHay = 1;
               nLiqui = #1603#23;
          |FINSI;
          |LEE 000#1603s;
     |SIGUE;
     |SI nHay = 0;
          #1603#27 = 0;
          #1603#0 = #0#17;
          #1603#1 = #0#0;
          #1603#2 = #0#1;
          #1603#69 = "A";
          #1603#40 = 1;
          |LEE 000#1603];
          |PARA; |SI FSalida = 0; |Y #1603#27 = 0; |Y #1603#0 = #0#17;
                    |Y #1603#1 = #0#0; |Y #1603#2 = #0#1; |Y #1603#69 = "A";
                    |HACIENDO;
               |SI #1603#46 = nNumEmp;
                    nHay = 1;
                    nLiqui = #1603#23;
               |FINSI;
               |LEE 000#1603s;
          |SIGUE;
     |FINSI;
     |CIERRA #1603;
|FPRC;

|PROCESO GrabaReciV;
     |HAZ EsCompaq;
     nSwEsCompaq = FSalida;

     |ABRE #324;
     |ABRE #25;
     |ABRE #24;

     |SI eaProg ! "agifa084";
          #324#0 = #134#58; ||divisa
          #25#0 = #134#7;   ||repre
          #24#0 = #134#2;   ||cli
          nBase = #134#59;
          nEuro = #134#62;
          nTotal = #134#101; ||EL campo DIV no es correcto #134#78
          |SI nEuro = 0;
             |SI #134#58 = #134#61;
                nEuro = nBase;
             |FINSI;
          |FINSI;
          aCurso = "";
     |SINO;
          #324#0 = #84#65;  ||divisa
          #25#0 = #84#6;    ||repre
          #24#0 = #84#3;    ||cli
          nBase = #84#66;
          nEuro = #84#69;
          nTotal = #84#73 - #84#63;
          aCurso = #84#87;
     |FINSI;
     |SI FSalida ! 0; |DDEFECTO #1000; |FINSI;
     |LEE 020#324=;
     |LEE 000#25=;
     |LEE 000#24=;
     |CIERRA #324;
     |CIERRA #25;
     |CIERRA #24;
     nDeci_Div = #324#7;

     |DBASE aAlfa; |QBF aAlfa;
     aAlfa = aAlfa + "def/dsm00003.mas";
     |CARGA_DEF aAlfa, refere1@;
     |SI FSalida = 0;
        |ABRE #refere1@;
        #refere1@#0 = #agifa024#0;
        #refere1@#1 = enDirEnt;
        |LEE 000#refere1@.=;
        |SI FSalida = 0;
           aZona = #refere1@#11;
        |SINO;
           aZona = #agifa024#3;
        |FINSI;
        |CIERRA #refere1@;
        |DESCARGA_DEF #refere1@;
     |SINO;
        aZona = "";
        |MENAV "0000Error al cargar 'dsm00003'";
     |FINSI;
     |QBF aZona;
     |SI aZona = ""; aZona = #agifa024#3; |FINSI;

   ||#600#0  =              ||Libro
     #600#1  = #0#17;       ||Serie
     #600#2  = #0#0;        ||Fact
     #600#3  = #0#1;        ||N Rec
     #600#4  = #0#8;        ||F.V
     #600#5  = #0#7;        ||F.E
     #600#6  = #0#12;       ||Cuenta Cli
     #600#7  = #0#3;        ||Nom Cli
     #600#8  = #0#4;        ||Nom Banco

     |SI #0#26 ! "    ";       ||Proviene de la Aplicacion dspreven.
         #600#9  = #0#26;      ||Entidad
         #600#10 = #0#27;      ||Sucursal
         #600#11 = #0#28;      ||DC
         #600#12 = #0#29;      ||Cuenta
         #600#48 = #0#30;      ||IBAN
     |SINO;
          #600#9  = #24#32;      ||Entidad
          #600#10 = #24#33;      ||Sucursal
          #600#11 = #24#31;      ||DC
          #600#12 = #24#30;      ||Cuenta
          |HAZ EsOTP;
          |SI FSalida = 0; |Y eaProg = "agifa084";
               aAlfa = #84#93 % 104;  #600#9 = aAlfa;
               aAlfa = #84#93 % 504;  #600#10 = aAlfa;
               aAlfa = #84#93 % 902;  #600#11 = aAlfa;
               aAlfa = #84#93 % 1110; #600#12 = aAlfa;

               #600#48 = #84#104;
          |FINSI;
     |FINSI;

     #600#13 = #0#21;       ||Tipo Rec
   ||#600#14 =      ||Departa
     #600#15 = #0#9;        ||Importe
     #600#16 = #0#15;       ||A aceptar
     #600#17 = #0#6;        ||Aceptado
     #600#18 = #0#2;        ||Cliente
     #600#19 = #25#0;       ||Repre
     #600#20 = #25#1;       ||Nom Repre
     #600#21 = aZona;       ||Zona
     #600#22 = nLinea;      ||Documento
   ||#600#23 =      ||Empresa Contable
   ||#600#24 =      ||Periodo
     #600#25 = aNumEmp;       ||Empresa ges
   ||#600#25 = #48#0;         || Cambiado por Abdon el 05/01/2001
   ||                            ya que a veces el numero de empresa era
   ||                            incorrecto
   |SI nSwEsCompaq = 0;
      |SI nCampos > 45;
         |DBASS aBaseLxe; |QBF aBaseLxe;
         aAlfa1 = aBaseLxe + "compaq4/def/agifa091.mas";
         |CARGA_DEF aAlfa1, agifa091@;
         |SI FSalida ! 0;
               aMensaje = "0000Error Carga_def " + aAlfa1;
               |MENAV aMensaje;
         |FINSI;

         aAlfa1 = aBaseLxe + "compaq4/def/luxe0048.mas";
         |CARGA_DEF aAlfa1, luxe0048@;
         |SI FSalida ! 0;
               aMensaje = "0000Error Carga_def " + aAlfa1;
               |MENAV aMensaje;
               |DESCARGA_DEF #agifa091@
         |FINSI;

         nEmpresa = aNumEmp;
         aAlfa1 = nEmpresa;
         |QBF aAlfa1;
         aAlfa1 = (("00" + aAlfa1) % -102);
         aAlfa1 = aBaseLxe + "compaq4/fich/" + aAlfa1 + "/";
         |PATH_DAT #agifa091@#aAlfa1#; |ABRE #agifa091@;
         |PATH_DAT #luxe0048@#aAlfa1#; |ABRE #luxe0048@;

         aFPago = #0#24;
         |QBF aFPago;
         aFPago = ("00" + aFPago) % -102;
         #agifa091@#0 = aFPago;
         |LEE 000#agifa091@.=;
         |SI FSalida = 0;
               aCodSitu = #agifa091@#71;
               #luxe0048@#0 = #agifa091@#71;
               |LEE 000#luxe0048@.=;
               |SI FSalida = 0;
                    aDescSitu = #luxe0048@#1;
               |SINO;
                    aDescSitu = "";
               |FINSI;
         |SINO;
               aCodSitu = "";
               aDescSitu = "";
         |FINSI;

         ||#600#45 = aCodSitu;
         ||#600#46 = aDescSitu;
         #600#45 = "";
         #600#46 = "";

         |CIERRA #agifa091@;
         |CIERRA #luxe0048@;

         |DESCARGA_DEF #agifa091@
         |DESCARGA_DEF #luxe0048@
      |FINSI;
   |FINSI;
/*
     |SI eaProg ! "agifa084";
        |SI #134#32 ! 0;
           #600#26 = "S";     ||A cuenta
        |SINO;
           #600#26 = "N";     ||A cuenta
        |FINSI;
     |SINO;
        |SI #84#63 ! 0;
           #600#26 = "S";     ||A cuenta
        |SINO;
           #600#26 = "N";     ||A cuenta
        |FINSI;
     |FINSI;
*/

     #600#26 = "N";         ||Entrega a cuenta
     #600#27 = "V";         ||Tipo
     #600#28 = "A";         ||Ope
     #600#29 = #324#0;      ||Divisa
     #600#30 = #324#1;      ||Nombre
     #600#31 = nEuro;       ||Cambio Euros
     #600#32 = nBase;       ||Cambio Base
     #600#33 = #24#203;
     |HAZ EsConstru;
     |SI FSalida = 0; |Y eaProg = "agifa084";
        #600#37 = aCurso;
     |FINSI;

     nDespreciado = 0;
     |SI #0#23 = #0#1;     || Total Factura en el Ultimo Recibo
          |HAZ ImpDespreciado;
          |SI aEstanTodosCobrados = "S";
               #600#34 = nTotalCob;
          |SINO;
               #600#34 = nTotal;
          |FINSI;
     |SINO;
          #600#34 = 0;
     |FINSI;
     #600#40 = #0#24;    || F.P
     #600#41 = #0#25;    || F.P Des
     #600#42 = enDirEnt;
     #600#43 = eaDirEnt;
     #600#47 = nDespreciado;

     aAlfa = "|NC"; aAlfa = #600#aAlfa#;
     |SI aAlfa > 48;
          aCta = #600#48;  |QBF aCta;
          |SI aCta = "";  |O  #600#48 = #24#215;
              #600#48 = #24#215;
              #600#49 = #24#216;
          |FINSI;
     |FINSI;
     |SI aAlfa > 50;
          #600#50 = #24#217;
          |ABRE #289;
          #289#0 = #24#0;
          |LEE 000#289=;
          |SI FSalida ! 0; |DDEFECTO #289; |FINSI;
          |CIERRA #289;
          #600#51 = #289#1;
     |FINSI;
     |GRABA 020#600n;
|FPRC;

|PROCESO GrabaReciC;
     |ABRE #324;
     |ABRE #112;
     #324#0 = #79#75;   ||divisa
     #112#0 = #79#2;    ||prov
     nBase = #79#76;
     nEuro = #79#79;
     |SI nEuro = 0;
        |SI #79#75 = #79#78; nEuro = nBase; |FINSI;
     |FINSI;
     ||nTotal = #79#95;  Abdon 12/02/02    El campo no contiene el valor correcto
     nTotal = #79#118;
     |LEE 020#324=;
     |LEE 020#112=;
     |CIERRA #324;
     |CIERRA #112;
   ||#600#0 =              ||Libro
     #600#1 = #0#17;       ||Serie
     #600#2 = #0#0;        ||Fact
     #600#3 = #0#1;        ||N Rec
     #600#4 = #0#8;        ||F.V
     #600#5 = #0#7;        ||F.E
     #600#6 = #0#12;       ||Cuenta
     #600#7 = #0#3;        ||Nom
     #600#8 = #0#4;        ||Nom Banco
     #600#9 = #112#14;      ||Cd.Entidad
     #600#10 = #112#15;      ||Sucursal
     #600#11 = #112#13;      ||DC
     #600#12 = #112#12;      ||Cuenta
     #600#13 = #0#21;       ||Tipo Rec
   ||#600#14 =      ||Departa
     #600#15 = #0#9;        ||Importe
     #600#16 = #0#15;       ||A aceptar
     #600#17 = #0#6;        ||Aceptado
     #600#18 = #0#2;        ||Prov
   ||#600#19 =              ||Repre
   ||#600#20 =              ||Nom Repre
     #600#21 = #112#92;     ||Zona
     #600#22 = nLinea;      ||Documento
   ||#600#23 =      ||Empresa Contable
   ||#600#24 =      ||Periodo
     #600#25 = aNumEmp;       ||Empresa ges
   ||#600#26 =      ||A cuenta
     #600#27 = "C";         ||Tipo
     #600#28 = "A";         ||Ope
     #600#29 = #324#0;      ||Divisa
     #600#30 = #324#1;      ||Nombre
     #600#31 = nEuro;       ||Cambio Euros
     #600#32 = nBase;       ||Cambio Base
     #600#33 = #112#98;     ||Banco asociado a pagos
     #600#37 = #79#74;      ||Referencia
     |SI #0#23 = #0#1;      || Total Factura en el Ultimo Recibo
          #600#34 = nTotal;
     |SINO;
          #600#34 = 0;
     |FINSI;
     #600#40 = #0#24;    || F.P
     #600#41 = #0#25;    || F.P Des
     aAlfa = "|NC"; aAlfa = #600#aAlfa#;
     |SI aAlfa > "42";
        #600#44 = #112#99;
     |FINSI;
     |GRABA 020#600n;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
                     PROCESOS EXTERNOS
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO MiraRecVenta;
     |HAZ NumEmp;
     |HAZ CargaDef;
     |SI nErr ! 0; |ACABA; |FINSI;
     |SI eaProg = "agifa084";
          aSer = #84#48;
          nNum = #84#0;
          aAlfa = #84#1; |QBF aAlfa; aAlfa = aAlfa % -104; nAnyo = aAlfa;
          aAlfa = #84#1;
     |SINO;
          aSer = #134#49;
          nNum = #134#0;
          aAlfa = #134#1; |QBF aAlfa; aAlfa = aAlfa % -104; nAnyo = aAlfa;
          aAlfa = #134#1;
     |FINSI;
     aTipo = "V";
     DEjer = "01.01." + nAnyo;
     HEjer = "31.12." + nAnyo;
     |BUCLE dscam045;
     enErrCarte = nCobra;

     |HAZ DescargaDef;
|FPRC;

|PROCESO BorraRecVenta;
     |HAZ NumEmp;
     |SI eaProg = "agifa084";
          aSer = #84#48;
          nNum = #84#0;
          aAlfa = #84#1; |QBF aAlfa; aAlfa = aAlfa % -104; nAnyo = aAlfa;
          aAlfa = #84#1;
     |SINO;
          aSer = #134#49;
          nNum = #134#0;
          aAlfa = #134#1; |QBF aAlfa; aAlfa = aAlfa % -104; nAnyo = aAlfa;
          aAlfa = #134#1;
     |FINSI;
     aTipo = "V"; DEjer = "01.01." + nAnyo; HEjer = "31.12." + nAnyo;
     |HAZ TempoPase;
     |SI aDef00 ! "";
          |BUCLE CargaReciV;
          |SUB_EJECUTA_NP aSubProg;
          |HAZ FinTempo;
     |FINSI;
|FPRC;

|PROCESO AbreRecVenta;

   |HAZ NumEmp;
   |HAZ TempoPase;
   nLinea = 1;
|FPRC;

|PROCESO RecVenta;
   |SI aDef00 ! "";
      |HAZ GrabaReciV; nLinea = nLinea + 1;
   |FINSI;
|FPRC;

|PROCESO CierraRecVenta;
   |SI aDef00 ! "";
     |SUB_EJECUTA_NP aSubProg;
     |HAZ FinTempo;
   |FINSI;
|FPRC;

|PROCESO CreaRecVenta;
     nLinea = 1;
     |HAZ NumEmp;
     |HAZ TempoPase;
     |SI aDef00 ! "";
          |HAZ GrabaReciV;
          |SUB_EJECUTA_NP aSubProg;
          |HAZ FinTempo;
     |FINSI;
|FPRC;

|PROCESO LeeRecVenta;
     |HAZ NumEmp;
     |HAZ CargaDef;
     |SI nErr = 0;
          aSer = #0#17;
          nNum = #0#0;
          aTipo = "V";
          nSwLee = 1;
          |BUCLE dscam045;
          nSwLee = 0;
          nLiqui = 0;
          |HAZ LeeReciV;
          enAcuenta = nLiqui;
          |HAZ DescargaDef;
     |FINSI;
|FPRC;

|PROCESO MiraRecCompra;
     |HAZ NumEmp;
     |HAZ CargaDef;
     |SI nErr ! 0; |ACABA; |FINSI;
     aSer = #79#66;
     nNum = #79#0;
     aAlfa = #79#1; |QBF aAlfa; aAlfa = aAlfa % -104; nAnyo = aAlfa;
     aTipo = "C";
     DEjer = "01.01." + nAnyo;
     HEjer = "31.12." + nAnyo;
     |BUCLE dscam045;
     enErrCarte = nCobra;

     |HAZ DescargaDef;
|FPRC;

|PROCESO BorraRecCompra;
     |HAZ NumEmp;
     |HAZ TempoPase;
     |SI aDef00 ! "";
          |HAZ CargaReciC;
          |SUB_EJECUTA_NP aSubProg;
          |HAZ FinTempo;
     |FINSI;
|FPRC;

|PROCESO AbreRecCompra;
     |HAZ NumEmp;
     |HAZ TempoPase;
     nLinea = 1;
|FPRC;

|PROCESO RecCompra;
     |SI aDef00 ! "";
        |HAZ GrabaReciC; nLinea = nLinea + 1;
     |FINSI;
|FPRC;

|PROCESO CierraRecCompra;
     |SI aDef00 ! "";
        |SUB_EJECUTA_NP aSubProg;
        |HAZ FinTempo;
     |FINSI;
|FPRC;

|PROCESO CreaRecCompra;
     nLinea = 1;
     |HAZ NumEmp;
     |HAZ TempoPase;
     |SI aDef00 ! "";
          |HAZ GrabaReciC;
          |SUB_EJECUTA_NP aSubProg;
          |HAZ FinTempo;
     |FINSI;
|FPRC;

|PROCESO TotaRecEntrega;
     |HAZ NumEmp;
     |HAZ CargaDef;
     |SI nErr ! 0; |ACABA; |FINSI;

     aSer = eaSer;
     nNum = enNum;
     aTipoRec = eaTipoEntre;
     aTipo = "V";

     nSwEntrega = 1;
     nCobra = 0;
     nNumRec = 0;
     |BUCLE dscam045;
     nSwEntrega = 0;

     |HAZ DescargaDef;
     enTotaEntre = nCobra;
     enNumRec = nNumRec;
|FPRC;

|PROCESO CtaArt;
   nError = 0;
   aAlfa = eaModulo;
   |SI aAlfa = "agifa104"; |O aAlfa = "agifa036"; |O aAlfa = "agifa010";
    |O aAlfa = "agifa084"; |O aAlfa = "agifa146"; |O aAlfa = "agi00027";
       aAlfa = "V";
       aTipoCta = "V";
   |SINO;
       aAlfa = "C";
       aTipoCta = "C";
   |FINSI;

   |DDEFECTO #agifa142;
   |LEE 000#agifa142.p;
   |SI FSalida ! 0;
      |SI FSalida = 102;
         SwAbre = 1;
      |SINO;
         SwAbre = 0;
         |DDEFECTO #agifa142; |GRABA 020#agifa142.c;
      |FINSI;
      |SI SwAbre = 1;
         |ABRE #agifa142;
         |DDEFECTO #agifa142;
         |LEE 000#agifa142.p;
         |SI FSalida ! 0;
            |DDEFECTO #agifa142; |GRABA 020#agifa142.c;
         |FINSI;
      |FINSI;
   |FINSI;

   |DDEFECTO #agifa724;
   |ABRE #agifa724;
   #agifa724#0 = #Fichero@#2;
   |LEE 000#agifa724.=;
   |SI FSalida = 0;
      |SI aAlfa = "V";
         aAlfa = #agifa724#2; |QBF aAlfa;
         |SI #agifa142#183 = "N"; |Y aAlfa = "";
            |MENAV "    Cuenta ingreso del articulo en blanco";
            |ERROR; nError = 1;
         |FINSI;
      |FINSI;
      |SI aAlfa = "C";
         aAlfa = #agifa724#3; |QBF aAlfa;
         |SI #agifa142#184 = "N"; |Y aAlfa = "";
            |MENAV "    Cuenta gasto del articulo en blanco";
            |ERROR; nError = 1;
         |FINSI;
      |FINSI;
   |SINO;
      |SI #agifa142#183 = "N"; |O #agifa142#184 = "N";
         |HAZ AltaCuenta;
         |SI nHay = 0;
               |MENAV "    Cuenta del articulo inexistente ";
               |ERROR; nError = 1;
         |FINSI;
      |FINSI;
   |FINSI;
   |SI SwAbre = 1; |CIERRA #agifa142; |FINSI;
   |CIERRA #agifa724;

     |SI nError ! 0; |ACABA; |FINSI; || Si no hay error se chequea la cuenta
                                     || de la familia
     |HAZ LeeCtaFami;
     |SI aFam ! "";
          |SI aTipoCta = "V";
               |SI #agifa142#183 = "N"; |Y aCtaV = "";
                    |MENAV "    Cuenta ingreso familia articulo en blanco";
                    |ERROR; nError = 1;
               |FINSI;
          |FINSI;
          |SI aTipoCta = "C";
               |SI #agifa142#184 = "N"; |Y aCtaC = "";
                    |MENAV "    Cuenta gasto familia articulo en blanco";
                    |ERROR; nError = 1;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO LeeCtaFami;
     aFam = "";
     aCtaC = "";
     aCtaV = "";

     |DDEF aDef;
     aAlfa = aDef + "agifa019";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          #referen@#0 = #Fichero@#2;
          |LEE 000#referen@.=;
          |SI FSalida = 0;
              aFam = #referen@#2;
              aDesArti = #referen@#1;
          |FINSI;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;

     aAlfa = aDef + "agifa060";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          #referen@#0 = aFam;
          |LEE 000#referen@.=;
          |SI FSalida = 0;
               aCtaV = #referen@#2; |QBF aCtaV;
               aCtaC = #referen@#3; |QBF aCtaC;
          |FINSI;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|PROCESO AltaCuenta;
     nHay = 0;

     |HAZ LeeCtaFami;
     |SI aFam = ""; |ACABA; |FINSI;
     |SI aTipoCta = "C"; |Y aCtaC = ""; |ACABA; |FINSI;
     |SI aTipoCta = "V"; |Y aCtaV = ""; |ACABA; |FINSI;

     #724#1 = aDesArti;
     |SI aTipoCta = "V";
          #724#2 = aCtaV;
     |SINO;
          #724#3 = aCtaC;
     |FINSI;
     |GRABA 020#724n;
     nHay = 1;
|FPRC;


|PROCESO ReciEntrega2;
     |SI aEstanTodosCobrados = ""; aEstanTodosCobrados = "S"; |FINSI;
     nTotalAlb = nTotalAlb - #referen@#68 - #referen@#64;
     nTotalCob = nTotalCob + #referen@#68 + #referen@#64;

     nDespreciado = nDespreciado + #referen@#68;
|FPRC;

|DEFBUCLE ReciEntrega2;
     #referen@#12006;
     46;
     aSerAlb, nNumAlb, 001, "01.01.0000", "            ", "      ", nEmp;
     aSerAlb, nNumAlb, 999, "31.12.9999", "zzzzzzzzzzzz", "zzzzzz", nEmp;
     ;
     NULL, ReciEntrega2;
|FIN;

|PROCESO CtrRecibosLin2;
     |SI #134#49 ] #dscam045@#4; |Y #134#49 [ #dscam045@#5;
          aAlfa = aBass + "dscarter/def/dscam003";
          |CARGA_DEF aAlfa, referen@;
          |SI FSalida = 0;
               aAlfa = aBass + "dscarter/fich/" + (("00000" + #dscam045@#6)%-105) + "/";
               |PATH_DAT #referen@#aAlfa#;
               |SELECT #5#refere1@;
               #refere1@#53 = #134#49;
               #refere1@#39 = #134#0;
               #refere1@#52 = "";
               #refere1@#0 = 0;
               |LEE 000#refere1@.];
               |PARA; |SI FSalida = 0; |Y #refere1@#53 = #134#49; |Y #refere1@#39 = #134#0; |HACIENDO;
                    nTotalAlb = #refere1@#67;
                    aSerAlb = #refere1@#52;
                    nNumAlb = #refere1@#0;
                    |BUCLE ReciEntrega2;
                    nTotalAlb = nTotalAlb ! nDeci_Base;
                    |SI nTotalAlb ! 0;
                         aEstanTodosCobrados = "N";
                    |FINSI;

                    |LEE 000#refere1@.s;
               |SIGUE;
               |SELECT #1#refere1@;
               |DESCARGA_DEF #referen@;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE CtrRecibosLin2;
     #dscam045@#1002;
     2;
     nEmp, 001, "V";
     nEmp, 999, "V";
     ;
     NULL, CtrRecibosLin2;
|FIN;

|| Importe despreciado de la entrega a cuenta del albaran
|| cuando se realiza el cobro desde el gesineed
|PROCESO ImpDespreciado;
     |SI eaProg = "agifa084"; |ACABA; |FINSI;

     |HAZ EsJamaica;
     |SI FSalida = 0; |ACABA; |FINSI;

     aEstanTodosCobrados = "";
     nTotalCob = 0;
     nDespreciado = 0;
     |DBASS aBass;
     aAlfa = aBass + "dscarter/def/dscam045";
     |CARGA_DEF aAlfa, dscam045@;
     |SI FSalida = 0;
          |DFICE aAlfa; aAlfa = aAlfa % -205; nEmp = aAlfa;
          aAlfa = aBass + "dscarter/fich/";
          |PATH_DAT #dscam045@#aAlfa#;

          |DDEF aAlfa;
          aAlfa = aAlfa + "agifa010";
          |CARGA_DEF aAlfa, refere1@;
          |SI FSalida = 0;
               |ABRE #refere1@;
               |BUCLE CtrRecibosLin2;
               |CIERRA #refere1@;
               |DESCARGA_DEF #refere1@;
          |SINO;
               |MENAV "0000Error al cargar 'agifa010'...";
          |FINSI;

          |DESCARGA_DEF #dscam045@;
     |SINO;
          |MENAV "0000Error al cargar 'dscam045'...";
     |FINSI;
|FPRC;
