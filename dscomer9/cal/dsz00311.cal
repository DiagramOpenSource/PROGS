|FICHEROS;
     dsz00311 #0;
     dsm00003 #3;
     agifa010 #10;
     agifa065 #65;
     agifa071 #71;
     agifa024 #24;
     agifa025 #25;
     agifa059 #59;
     agifa134 #134;
     agifa142 #142;
     agifa228 #228; || Tmp para albaranes facturados
     agifa321 #321;
     agifa324 #324;
     referen@;
|FIN;

|VARIABLES;
     &aMoneda = "";
     &aDivisa = "";
     aAlfa = "";
     fFecha = @;
     aAbo = "";
     nLinPed = 0;
     nLinDep = 0;
|FIN;

|PROCESO LinFactu;
     #228#0 = #59#15;
     #228#1 = #59#2;
     #228#2 = #59#14;
     #228#3 = #59#0;
     #228#4 = #59#1;
     #228#5 = #134#45;

     #228#6 = #134#7;
     #228#7 = #134#11;
     #228#8 = #134#4;
     #228#9 = #134#5;
     #228#10 = #134#6;

     |GRABA 020#228n;
|FPRC;

|DEFBUCLE Facturas;
     #134#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, NULL, LinFactu;
|FIN;

|PROCESO agifa065;
     |SI #65#2 = "AV"; |O #65#2 = "BV";
          fFecha = #65#1;
          |SI #65#2 = "AV";
               aAbo = "N";
          |FINSI;
          |SI #65#2 = "BV";
               aAbo = "S";
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE agifa065;
     #65#1;
     ;
     #71#2, "01.01.0000", "  ", #71#0, 001, #71#29;
     #71#2, "31.12.9999", "zz", #71#0, 999, #71#29;
     ;
     NULL, agifa065;
|FIN;

|PROCESO NumLineas;
     nLinPed = 0; nLinDep = 0;
     |DDEF aAlfa;
     aAlfa = aAlfa + "agifa071";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          #referen@#29 = #71#29;
          #referen@#0 = #71#0;
          #referen@#1 = 1;
          |LEE 000#referen@.];
          |PARA; |SI FSalida = 0; |Y #referen@#29 = #71#29; |Y #referen@#0 = #71#0; |HACIENDO;
               |SI #referen@#21 ! 0;
                    nLinPed = nLinPed + 1;
               |FINSI;
               |SI #referen@#22 ! 0;
                    nLinDep = nLinDep + 1;
               |FINSI;
               |LEE 000#referen@.s;
          |SIGUE;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|PROCESO agifa071;
     |DDEFECTO #10;
     #10#52 = #71#29;
     #10#0 = #71#0;
     |LEE 000#10=;
     |SI FSalida ! 0;
          aAbo = "N";
          fFecha = "01.01.0000";
          |BUCLE agifa065;

          #24#0 = #71#15;
          |LEE 000#24=;
          |SI FSalida ! 0; |DDEFECTO #24; |FINSI;

          #25#0 = #24#25;
          |LEE 000#24=;
          |SI FSalida ! 0; |DDEFECTO #25; |FINSI;

          #10#1 = fFecha;
          #10#3 = #71#15;
          #10#4 = #24#2;
          #10#5 = #24#37;
          #10#6 = #24#25;
          #10#7 = #24#38;
          #10#8 = #24#20;

          #3#0 = #10#3;
          #3#1 = 1;
          |LEE 000#3=;
          |SI FSalida ! 0; |DDEFECTO #3; |FINSI;
          #10#84 = 1;

          #10#29 = #3#10;
          #10#30 = #3#2;
          #10#31 = #3#3;
          #10#33 = #3#7;
          #10#62 = #3#6;
          |SI #3#14 = "  ";
               #10#6 = #24#25;
          |SINO;
               #10#6 = #3#14;
          |FINSI;

          #10#32 = #24#156;
          #10#34 = #71#16;
          #10#35 = #71#17;
          #10#36 = #24#47;
          #10#40 = #24#41;
          #10#43 = aAbo;
          #10#50 = #24#40;
          #10#51 = #24#28;
          #10#63 = #24#15;
          #10#64 = #24#208;
          #10#68 = #24#192;

          #324#0 = #10#68;
          |LEE 000#324=;
          |SI FSalida ! 0; |DDEFECTO #324; |FINSI;
          #10#69 = #324#2;

          #10#70 = #24#193;
          #10#73 = #321#9;

          #324#0 = #10#73;
          |LEE 000#324=;
          |SI FSalida ! 0; |DDEFECTO #324; |FINSI;
          #10#74 = #324#2;

          #10#91 = #24#206;

          |HAZ NumLineas;
          #10#41 = nLinPed;
          #10#42 = nLinDep;

          #228#0 = #10#52;
          #228#1 = #10#0;
          |LEE 000#228=;
          |SI FSalida = 0;
               #10#38 = "S";
               #10#39 = #228#3;
               #10#53 = #228#2;
               #10#60 = #228#4;
               #10#10 = #228#5;
               #10#6 = #134#7;
               #10#8 = #134#11;
               #10#5 = #134#4;
               #10#32 = #134#5;
               #10#7 = #134#6;
          |SINO;
               #10#38 = "N";
               #10#60 = "01.01.0000";
          |FINSI;
          |GRABA 020#10b;

          aDivisa = #10#68;
          aMoneda = #10#70;
          |HAZ Divisas010;

          |BUCLELIN 0 CalCabAgifa010 #10;
          |GRABA 020#10a;
          |LIBERA #10;
     |FINSI;
|FPRC;

|DEFBUCLE agifa071;
     #71#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, agifa071;
|FIN;

|PROCESO T3; |TIPO 3;
     |SI #0#0 ! "SI"; |ACABA; |FINSI;

     aAlfa = Usuario;
     |NOME_DAT #228 aAlfa; |DELINDEX #228;
     |ABRE #228;
     |BUCLE Facturas;

     |ABRE #142; |LEE 000#142p; |CIERRA #142;
     |ABRE #321; |LEE 000#321p; |CIERRA #321;

     |ABRE #10;
     |ABRE #65;
     |ABRE #24;
     |ABRE #25;
     |ABRE #3;
     |ABRE #324;
     |BUCLE agifa071;
     |CIERRA #324;
     |CIERRA #3;
     |CIERRA #25;
     |CIERRA #24;
     |CIERRA #65;
     |CIERRA #10;

     |CIERRA #228;
     |DELINDEX #228;
|FPRC;
