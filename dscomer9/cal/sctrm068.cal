|FICHEROS;
     sctrm068 #0;
     sctrm008 #8;
     sctrm012 #12;
     sctrm023 #23;
     referen@;
|FIN;

|VARIABLES;
     &Tempo = "";
     nDLinea = 0;
     nHLinea = 0;
     nModo = 0;
     nConta = 0;
     aMinu = "";
     aHora = "";
     nMinu = 0;
     nHora = 0;
     aAlfa = "";
|FIN;

|PROCESO Contador; |TIPO 7;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 1;
          |LEE 000#0u;
          |SI FSalida = 0;
               nConta = #0#0 + 1;
          |SINO;
               nConta = 1;
          |FINSI;
          |DDEFECTO #0;
          #0#0 = nConta;
     |FINSI;
|FPRC;

|PROCESO Tempo; |TIPO 0;
     |ABRE #8;
     #8#0 = #0#1;
     |LEE 000#8=;
     |SI FSalida ! 0;
          |MENAV "0000No existe temporada...";
          |ERROR;
     |SINO;
          |HAZ T68_13;
     |FINSI;
     |CIERRA #8;
|FPRC;

|PROCESO Linea; |TIPO 0;
     |SI #0#2 ! 0;
          |ABRE #12;
          #12#0 = #0#2;
          |LEE 000#12=;
          |SI FSalida ! 0;
               |MENAV "0000No existe l¡nea de servicio...";
               |ERROR;
          |SINO;
               |HAZ T68_13;
          |FINSI;
          |CIERRA #12;
          |C_M #0#3, 1, "S"; |PINTA #0#3;
          |C_M #0#4, 1, "S"; |PINTA #0#4;
     |SINO;
          #0#3 = 0;
          #0#4 = 999999;
          |C_M #0#3, 1, "N"; |PINTA #0#3;
          |C_M #0#4, 1, "N"; |PINTA #0#4;
          |HAZ T68_13;
     |FINSI;
|FPRC;

|PROCESO T68_13; |TIPO 13;
     |ABRE #8;
     #8#0 = #0#1;
     |LEE 000#8=;
     |SI FSalida ! 0; |DDEFECTO #8; |FINSI;
     |CIERRA #8;

     |ABRE #12;
     #12#0 = #0#2;
     |LEE 000#12=;
     |SI FSalida ! 0; |DDEFECTO #12; |FINSI;
     |CIERRA #12;

     |PINTA 1330, #8#1;
     |PINTA 1430, #12#1;
|FPRC;

|PROCESO Hora; |TIPO 0;
     aHora = #0Campo % 102; nHora = aHora;
     aMinu = #0Campo % 402; nMinu = aMinu;
     |SI nHora < 0; |O nHora > 23; nHora = 0; |FINSI;
     |SI nMinu < 0; |O nMinu > 59; nMinu = 0; |FINSI;
     aAlfa = (("00" + nHora) % -102) + ":" + (("00" + nMinu) % -102);
     #0Campo = aAlfa; |PINTA #0Campo;
|FPRC;

|PROCESO sctrm023;
     |SALVA_DATOS #23;
     |REPON_DATOS #referen@;
     |GRABA 020#referen@.n;
|FPRC;

|DEFBUCLE sctrm023;
     #23#1;
     ;
     #0#1, nDLinea, " ", 000000;
     #0#1, nHLinea, "z", 999999;
     ;
     NULL, sctrm023;
|FIN;

|PROCESO Servicio66; |TIPO 66;
     |DDEF aAlfa;
     aAlfa = aAlfa + "sctrm023";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |HAZ CreaTempo; |NOME_DAT #referen@#Tempo#; |DELINDEX #referen@;
          |ABRE #referen@;
          |SI #0#2 = 0;
               nDLinea = 000;
               nHLinea = 999;
          |SINO;
               nDLinea = #0#2;
               nHLinea = #0#2;
          |FINSI;
          |BUCLE sctrm023;
          |LEE 000#referen@.p;
          #referen@#5 = #0Campo;
          |LEE 000#referen@.];
          |CONSULTA_CLAVE #1#referen@;
          |SI FSalida = 0;
               #0Campo = #referen@#5; |PINTA #0Campo;
          |SINO;
               |ERROR;
          |FINSI;
          |CIERRA #referen@;
          |DELINDEX #referen@; |HAZ BoraTempo;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;
