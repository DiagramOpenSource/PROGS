|FICHEROS;
     aparz004 #0;
     aparw007 #7;
     aparm017 #17;
     aparm034 #34;
|FIN;

|VARIABLES;
     nSwAcaba = 0;
     aMensaje = "";
     aAlfa = "";
     fHoy = @;
     &efDFecha = @;
     &efHFecha = @;
     f = @;
     nMeses = 0;
     i = 0;
     nCampo = 0;
     fFecha = @;
     nMes = 0;
     aMes = "";
     aA¤o = "";
     aTipo = "";
|FIN;

|PROCESO Tipo12; |TIPO 12;
     |SI FSalida = 7; |ACABA; |FINSI;
     nMeses = (#0#5 - #0#4) * 12 + (#0#3 - #0#2);
     |SI nMeses ] 12;
          |MENAV "0000Periodo superior a un a¤o...";
          |ERROR;
          |ACABA;
     |FINSI;

     aMensaje = "0000SES CORRECTO?";
     |CONFI aMensaje;
     |SI FSalida ! 0;
          nSwAcaba = 1;
     |FINSI;
|FPRC;

|PROCESO Defecto; |TIPO 7;
     |SI #0#2 = 0;
          fHoy = ~;
          aAlfa = fHoy % 402; #0#2 = aAlfa; |PINTA #0#2;
          #0#3 = #0#2; |PINTA #0#3;
          aAlfa = fHoy % 704; #0#4 = aAlfa; |PINTA #0#4;
          #0#5 = #0#4; |PINTA #0#5;
     |FINSI;
|FPRC;

|PROCESO Tmp;
     |PRINT;
|FPRC;

|DEFBUCLE Tmp;
     #7#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Tmp;
|FIN;

|PROCESO Historico;
     aMes = #34#3 % 402;
     aA¤o = #34#3 % -104;
     |SI #0#4 = #0#5; |O #0#4 = aA¤o;
          nMes = aMes;
          nMes = nMes - #0#2 + 1;
     |SINO;
          nMes = aMes;
          nMes = nMes + 12 - #0#2 + 1;
     |FINSI;

     |DDEFECTO #17;
     #17#0 = #34#6;
     |LEE 000#17=;

     |DDEFECTO #7;
     #7#0 = #17#0;
     |LEE 101#7=;
     |SI FSalida ! 0;
          #7#1 = #17#1;
          |GRABA 020#7b;
     |FINSI;
     nMes = nMes + 1;
     #7nMes = #7nMes + #34#4;
     |GRABA 020#7a;
     |LIBERA #7;
|FPRC;

|DEFBUCLE Historico;
     #34#3;
     ;
     aTipo, #0#0, #0#18, efDFecha;
     aTipo, #0#1, #0#19, efHFecha;
     ;
     NULL, Historico;
|FIN;

|PROCESO UltDiaMes;
     |PARA f = efHFecha; |SI; |HACIENDO f = f + 1;
          aAlfa = f % 402;
          |SI aAlfa ! #0#3; |SAL; |FINSI;
          efHFecha = f;
     |SIGUE;
|FPRC;

|PROCESO NomMes;
     |SI i = 1; aAlfa = "     ENERO"; |FINSI;
     |SI i = 2; aAlfa = "   FEBRERO"; |FINSI;
     |SI i = 3; aAlfa = "     MARZO"; |FINSI;
     |SI i = 4; aAlfa = "     ABRIL"; |FINSI;
     |SI i = 5; aAlfa = "      MAYO"; |FINSI;
     |SI i = 6; aAlfa = "     JUNIO"; |FINSI;
     |SI i = 7; aAlfa = "     JULIO"; |FINSI;
     |SI i = 8; aAlfa = "    AGOSTO"; |FINSI;
     |SI i = 9; aAlfa = "SEPTIEMBRE"; |FINSI;
     |SI i = 10; aAlfa = "   OCTUBRE"; |FINSI;
     |SI i = 11; aAlfa = " NOVIEMBRE"; |FINSI;
     |SI i = 12; aAlfa = " DICIEMBRE"; |FINSI;
|FPRC;

|PROCESO Tipo3; |TIPO 3;
     |SI nSwAcaba = 1;
          |ACABA;
     |FINSI;

     nCampo = 6;
     |SI #0#4 = #0#5;
          |PARA i = #0#2; |SI i [ #0#3; |HACIENDO i = i + 1;
               |HAZ NomMes;
               #0nCampo = aAlfa;
               nCampo = nCampo + 1;
          |SIGUE;
     |SINO;
          |PARA i = #0#2; |SI i [ 12; |HACIENDO i = i + 1;
               |HAZ NomMes;
               #0nCampo = aAlfa;
               nCampo = nCampo + 1;
          |SIGUE;
          |PARA i = 1; |SI i [ #0#3; |HACIENDO i = i + 1;
               |HAZ NomMes;
               #0nCampo = aAlfa;
               nCampo = nCampo + 1;
          |SIGUE;
     |FINSI;

     |IMPRE 0;
     |SI FSalida = 0;
          |INFOR "aparz004";
          |SI FSalida = 0;
               aAlfa = "01." + (("00" + #0#2) % -102) + ".";
               aAlfa = aAlfa + (("0000" + #0#4) % -104);
               efDFecha = aAlfa;

               aAlfa = "01." + (("00" + #0#3) % -102) + ".";
               aAlfa = aAlfa + (("0000" + #0#5) % -104);
               efHFecha = aAlfa;
               |HAZ UltDiaMes;

               aAlfa = Usuario; |NOME_DAT #7 aAlfa; |DELINDEX #7;
               |ABRE #7;
               |ABRE #17;
               aTipo = #0#20;
               |BUCLE Historico;
               |CIERRA #17;
               |CIERRA #7;
               |BUCLE Tmp;
               |PIEINF;
               |FININF;
               |DELINDEX #7;
          |SINO;
               aAlfa = "0000No existe informe 'aparz004'";
               |MENAV aAlfa;
          |FINSI;
          |FINIMP;
     |FINSI;
|FPRC,
