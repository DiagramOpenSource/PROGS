|FICHEROS;
     gorephor #0;
     goreptra #1;        ||Lineal de trabajadores
     gotrabaj #2;        ||Trabajadores
     goreppar #3,MANTE;  ||Lineal del partidas
     gopartid #4;        ||Partidas presupuestos
     gopartca #5;        ||Partes trabajo (CAB)
     gopartll #6;        ||Partes trabajo (LIN)
     gopartli #7;        ||Partes trabajo presupuestos
     gomantca #8;        ||Expedientes (CAB)
     gomantli #9;        ||Expedientes (LIN)
     goptrbca #10;       ||Partes trabajadores (CAB)
     goptrbli #11;       ||Partes trabajadores (LIN)
     gopre001 #12;       ||Presupuestos
     goparame #13;       ||Parametros Generales
     agifa027 #14;       ||Contadores
     gocatcon #15;       ||Categorias Trabajadores
     gopartia #16;       ||Partidas Adjudicadas
     goartive #17;       ||Partidas.
     gocatcot #19;
     gotrabat #20;
     gocallac #21; || calendario laboral
     gocallal #22;
|FIN;
-----------------------------------------------------------------------------
|VARIABLES;
     aAlfa = "";
     f = @;
     fDia = @;
     &efFecha       = @;
     nHor0          = 0;
     nHor1          = 0;
     nHora          = 0;
     nSal           = 0;
     &cTipo         = "";
     &cSerExp       = "";
     &cSerPre       = "";

     &fFechaIni     = @;

     &cCodMonBase   = "";
     &cCodMonTrab   = "";
     &cCodMonConv   = "";
     &cCodMonActu   = "";
     &cDesMonBase   = "";
     &cDesMonTrab   = "";

     &nDeci_PBase   = 0;
     &nDeci_TBase   = 0;
     &nDeci_PTrab   = 0;
     &nDeci_TTrab   = 0;
     &nDeci_TotVis  = 0;

     &nEurComTrab   = 0;
     &nEurComBase   = 0;
     &nEurVenTrab   = 0;
     &nEurVenBase   = 0;
     &nPreComTrab   = 0;
     &nPreComBase   = 0;
     &nPreVenTrab   = 0;
     &nPreVenBase   = 0;
     &nPrecioComp   = 0;
     &nPrecioVent   = 0;
     &nNumExp       = 0;
     &nNumPre       = 0;

     &nHayT         = 0;

     cFich          = "";

     nHay           = 0;
     nLinT          = 0;
     nLinP          = 0;
     nLinPS         = 0;
     nLinPar        = 0;
     nLinea         = 0;
     nModo          = 0;
     nEuros         = 0;
     nPartidas      = 0;
     nTotHPres      = 0;
     nTotHAdmi      = 0;
     nTotHExtr      = 0;
     nTotHPart      = 0;
     nTotCosTr      = 0;
     nTotVenTr      = 0;
     nTotCosBa      = 0;
     nTotVenBa      = 0;
|FIN;
-----------------------------------------------------------------------------
|PROCESO ReParti;
     |DDEFECTO #3;
     nLinP = nLinP + 1;
     #3#0 = #0#0;             ||SERIE EXPEDIENTE
     #3#1 = #0#1;             ||NUMERO EXPEDIENTE
     #3#2 = #0#2;             ||SERIE PRESUPUESTO
     #3#3 = #0#3;             ||NUMERO PRESUPUESTO
     #3#4 = #1#5;             ||TRABAJADOR
     #3#5 = nLinP;            ||LINEA
     |LEE 101#3=;
     nSal = FSalida;
     #3#6 = #4#5;             ||PARTIDA
     #3#7 = #4#6;             ||DESCRIPCION
     |SI nSal ! 0; |GRABA 020#3c; |FINSI;
     |SI nSal = 0; |GRABA 020#3a; |FINSI;
     |LIBERA #3;
|FPRC;
-----------------------------------------------------------------------------
|DEFBUCLE ReParti;
     #4#4;
     ;
     #0#2,#0#3,#0#0,#0#1,1," "*20;
     #0#2,#0#3,#0#0,#0#1,999,"z"*20;
     ;
     NULL, ReParti;
|FIN;
-----------------------------------------------------------------------------
|PROCESO ReTraba;
     |DDEFECTO #1;
     nLinT = nLinT + 1;
     #1#0 = #0#0;             ||SERIE EXPEDIENTE
     #1#1 = #0#1;             ||NUMERO EXPEDIENTE
     #1#2 = #0#2;             ||SERIE PRESUPUESTO
     #1#3 = #0#3;             ||NUMERO PRESUPUESTO
     #1#4 = nLinT;            ||LINEA
     |LEE 101#1=;
     nSal = FSalida;
     #1#5 = #2#0;             ||CODIGO TRABAJADOR
     #1#6 = #2#1;             ||NOMBRE TRABAJADOR
     #1#8 = #0#7;
     |SI nSal ! 0; |GRABA 020#1c; |FINSI;
     |SI nSal = 0; |GRABA 020#1a; |FINSI;
     |LIBERA #1;
|FPRC;
-----------------------------------------------------------------------------
|DEFBUCLE ReTraba;
     #2#1;
     ;
     1;
     99999;
     ;
     NULL, ReTraba;
|FIN;
-----------------------------------------------------------------------------
|PROCESO PCab; |TIPO 7;
     #0#0 = cSerExp;
     #0#1 = nNumExp;
     #0#2 = cSerPre;
     #0#3 = nNumPre;
     #0#4 = fFechaIni;
     #0#5 = #0#4;

     cFich = Usuario % 105;
     cFich = cFich + "reh";
     |NOME_DAT #1 cFich;
     |DELINDEX #1;
     |ABRE #1;

     cFich = Usuario % 105;
     cFich = cFich + "rep";
     |NOME_DAT #3 cFich;
     |DELINDEX #3;
     |ABRE #3;

     |ENTLINEAL #1#3,-2,7,22,0,MinPar,MaxPar;
     |PINDA #0#0;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO BorraFich; |TIPO 7;
|FPRC;
-------------------------------------------------------------------------------
|PROCESO Temporales; |TIPO 0;
     nLinT = 0;
     nLinP = 0;
     |BUCLE ReTraba;
     |BUCLE ReParti;
     |ENTLINEAL #1#3,-2,7,22,0,MinPar,MaxPar;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO FechaValida;
     f = fFechaIni;

     #12#0 = #0#2;
     #12#1 = #0#3;
     |LEE 020#12=;

     #21#0 = #12#39;
     |LEE 000#21=;
     |SI FSalida ! 0;
          FSalida = 0;
     |SINO;
          |SELECT #2#22;
          #22#0 = #21#0;
          #22#2 = f;
          |LEE 000#22=;
          |SI FSalida = 0;
               FSalida = 1;
          |SINO;
               fDia = f % A1;
               aAlfa = fDia % 1102; aAlfa = aAlfa > "";
               |SI aAlfa = "LU"; |Y #21#1 = "S"; FSalida = 0; |FINSI;
               |SI aAlfa = "MA"; |Y #21#2 = "S"; FSalida = 0; |FINSI;
               |SI aAlfa = "MI"; |Y #21#3 = "S"; FSalida = 0; |FINSI;
               |SI aAlfa = "JU"; |Y #21#4 = "S"; FSalida = 0; |FINSI;
               |SI aAlfa = "VI"; |Y #21#5 = "S"; FSalida = 0; |FINSI;
               |SI aAlfa = "SA"; |Y #21#6 = "S"; FSalida = 0; |FINSI;
               |SI aAlfa = "DO"; |Y #21#7 = "S"; FSalida = 0; |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO DiasCalen;
     |ABRE #12;
     #12#0 = #0#2;
     #12#1 = #0#3;
     |LEE 020#12=;
     |CIERRA #12;

     |ABRE #21;
     |ABRE #22;
     #21#0 = #12#39;
     |LEE 000#21=;
     |SI FSalida ! 0;
          #0#6 = (#0#5 - #0#4) + 1;
          |SI #0#6 = 0; #0#6 = 1; |FINSI;
          aAlfa = "0000No existe calendario:" + #12#39;
          |MENAV aAlfa;
     |SINO;
          #0#6 = 0;
          |PARA f = #0#4; |SI f [ #0#5; |HACIENDO f = f + 1;
               |SELECT #2#22;
               #22#0 = #21#0;
               #22#2 = f;
               |LEE 000#22=;
               |SI FSalida ! 0;
                    fDia = f % A1;
                    aAlfa = fDia % 1102; aAlfa = aAlfa > "";
                    |SI aAlfa = "LU"; |Y #21#1 = "S"; #0#6 = #0#6 + 1; |FINSI;
                    |SI aAlfa = "MA"; |Y #21#2 = "S"; #0#6 = #0#6 + 1; |FINSI;
                    |SI aAlfa = "MI"; |Y #21#3 = "S"; #0#6 = #0#6 + 1; |FINSI;
                    |SI aAlfa = "JU"; |Y #21#4 = "S"; #0#6 = #0#6 + 1; |FINSI;
                    |SI aAlfa = "VI"; |Y #21#5 = "S"; #0#6 = #0#6 + 1; |FINSI;
                    |SI aAlfa = "SA"; |Y #21#6 = "S"; #0#6 = #0#6 + 1; |FINSI;
                    |SI aAlfa = "DO"; |Y #21#7 = "S"; #0#6 = #0#6 + 1; |FINSI;
               |FINSI;
          |SIGUE;
     |FINSI;
     |CIERRA #22;
     |CIERRA #21;
|FPRC;

|PROCESO CalcDias; |TIPO 0;

     |SI #0#5 < #0#4;
          |MENAV "0000FECHA ERRONEA";
          |ERROR10;
          |ACABA;
     |SINO;
          |HAZ DiasCalen;
          ||#0#6 = (#0#5 - #0#4) + 1;
          |||SI #0#6 = 0; #0#6 = 1; |FINSI;
          |PINTA #0#6;
          |HAZ CalcTH;
     |FINSI;

|FPRC;
-----------------------------------------------------------------------------
|PROCESO CalcTH; |TIPO 0;
     |SI #0#7 > 0;
          #0#8 = #0#6 * #0#7;
          |PINTA #0#8;
     |FINSI;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO CalcHJ; |TIPO 0;
     #0#7 = #0#8 / #0#6;
     |PINTA #0#7;

     |SI #0#7 = 0; |Y #0#8 = 0; |Y FSalida ! 2;
          |MENAV "0000DEBE COMPLETAR LAS HORAS";
          |ERROR;
     |FINSI;

|FPRC;
-----------------------------------------------------------------------------
|PROCESO EnParti; |TIPO 11;

     |SI FSalida = 10;
          |ENTLINEAL #1#3,-2,2,22,0,MinPar,MaxPar;
          |ERROR10;
     |FINSI;

|FPRC;
-----------------------------------------------------------------------------
|PROCESO MinPar;
     #3#3 = #0#3;
     #3#5 = 1;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO MaxPar;
     #3#3 = #0#3;
     #3#5 = 999;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO MinTra;
     #1#3 = #0#3;
     #1#4 = 1;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO MaxTra;
     #1#3 = #0#3;
     #1#4 = 999;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO SelTraba; |TIPO 0;
     |SI #1#7 = " ";
          #1#7 = "*";
     |SINO;
          #1#7 = " ";
     |FINSI;

     |PINTA #1#7;
     |GRABA 020#1a;

     |ERROR;
     |PTEC 809; || Flecha abajo
|FPRC;
-----------------------------------------------------------------------------
|PROCESO SelParti; |TIPO 0;

     |SI #3#8 = " ";
          #3#8 = "*";
     |SINO;
          #3#8 = " ";
     |FINSI;

     |PINTA #3#8;
     |GRABA 020#3a;
     |PTEC 809;
     |ERROR10;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO SPartidas;
     |DDEFECTO #16;
     |SELECT #2#16;
     #16#34 = "T";
     #16#4 = #10#15;                              ||SERIE DOCUMENTO (PARTE)
     #16#5 = #10#3;                               ||NUMERO DOCUMENTO (PARTE)
     #16#8 = #3#6;                                ||PARTIDA
     #16#33 = #3#8;                               ||Capitulo
     #16#6 = #11#3;                               ||LINEA DOCUMENTO (PARTE)
     |LEE 000#16=;

     |SI FSalida ! 0;
          nLinPS = nLinPS + 1;
          #16#0  = #0#2;                          ||SERIE PRESUPUESTO
          #16#1  = #0#3;                          ||NUMERO PRESUPUESTO
          #16#2  = #0#0;                          ||SERIE EXPEDIENTE
          #16#3  = #0#1;                          ||NUMERO EXPEDIENTE
          #16#7  = nLinPS;                        ||LINEA
          #16#9  = #3#7;                          ||DESCRIPCION PARTIDA
          |SI nLinPS = 1;
               #16#10 = nHora;
          |SINO;
               #16#10 = nHor0;                    ||CANTIDAD/SUMA PARTIDAS SELECCIONADAS
          |FINSI;
          #16#11 = #11#12;                        ||Precio Vent. Trab.
          #16#12 = #11#13;                        ||Precio Cost. Trab.
          #16#13 = #16#10 * #16#11;               ||Imp. Vent. Trabajo
          #16#14 = #16#10 * #16#12;               ||Imp. Cost. Trabajo
          cCodMonConv = #10#14;
          nPrecioVent = #16#11;
          nPrecioComp = #16#12;
          |HAZ MonBas
          #16#22 = nPreVenBase;                   ||Precio Vent. Base.
          #16#23 = nPreComBase;                   ||Precio Comp. Base.
          #16#24 = #16#10 * #16#22;               ||Imp. Vent. Base.
          #16#25 = #16#10 * #16#23;               ||Imp. Comp. Base.
          #16#15 = #10#7;                         ||Codigo de Cliente.
          #16#16 = #10#8;                         ||Nombre del Cliente.
          #16#20 = #11#22;                        ||Codigo M.O.
          #16#21 = #10#14;                        ||Moneda de Trabajo.
          #16#28 = #11#2;                         ||Fecha Documento.
          #16#29 = "T";                           ||Tipo Documeto(Trabajos).
          |ABRE #17;
          #17#0 = #11#22;
          |LEE 000#17=;

          |SI FSalida = 0;
               #16#30 = #17#1;
          |FINSI;

          |CIERRA #17;
          |GRABA 020#16n;
          nHay = 1;
     |FINSI;

|FPRC;
-----------------------------------------------------------------------------
|DEFBUCLE SPartidas;
     #3#2;
     ;
     "*";
     "*";
     ;
     NULL, SPartidas;
|FIN;
-----------------------------------------------------------------------------
|PROCESO SumaPart;
     nPartidas = nPartidas + 1;
|FPRC;
-----------------------------------------------------------------------------
|DEFBUCLE SumaPart;
     #3#2;
     ;
     "*";
     "*";
     ;
     NULL, SumaPart;
|FIN;
-----------------------------------------------------------------------------
|PROCESO ImporteHoras;
     |ABRE #20;
     #20#0 = #2#0;
     #20#2 = #0#9; ||Tipo H
     |LEE 000#20=;
     |SI FSalida = 0;
          |SI #6#14 = "P";
               #11#14 = #20#4;                 ||Importe Hora Venta Base.
               #11#15 = #20#5;                 ||Importe Hora Costo Base.
          |FINSI;

          |SI #6#14 = "A";
               #11#14 = #20#6;                 ||Importe Hora Venta Base.
               #11#15 = #20#7;                 ||Importe Hora Costo Base.
          |FINSI;

          |SI #6#14 = "E";
               #11#14 = #20#8;                 ||Importe Hora Venta Base.
               #11#15 = #20#9;                 ||Importe Hora Costo Base.
          |FINSI;
     |SINO;
          |ABRE #19;
          #19#0 = #2#3; ||Cate
          #19#1 = #2#2; ||conve
          #19#2 = #0#9; ||Tipo H
          |LEE 000#19=;
          |SI FSalida = 0;
               |SI #6#14 = "P";
                    #11#14 = #19#4;                 ||Importe Hora Venta Base.
                    #11#15 = #19#5;                 ||Importe Hora Costo Base.
               |FINSI;

               |SI #6#14 = "A";
                    #11#14 = #19#6;                 ||Importe Hora Venta Base.
                    #11#15 = #19#7;                 ||Importe Hora Costo Base.
               |FINSI;

               |SI #6#14 = "E";
                    #11#14 = #19#8;                 ||Importe Hora Venta Base.
                    #11#15 = #19#9;                 ||Importe Hora Costo Base.
               |FINSI;
          |SINO;
               |SI #6#14 = "P";
                    #11#14 = #15#3;               ||IMPORTE HORA VENTA BASE
                    #11#15 = #15#4;               ||IMPORTE HORA COSTO BASE
               |FINSI;

               |SI #6#14 = "A";
                    #11#14 = #15#7;               ||IMPORTE HORA VENTA BASE
                    #11#15 = #15#9;               ||IMPORTE HORA COSTO BASE
               |FINSI;

               |SI #6#14 = "E";
                    #11#14 = #15#8;               ||IMPORTE HORA VENTA BASE
                    #11#15 = #15#10;              ||IMPORTE HORA COSTO BASE
               |FINSI;
          |FINSI;
          |CIERRA #19;
     |FINSI;
     |CIERRA #20;
|FPRC;

|PROCESO STrab;

     nLinPar = nLinPar + 1;

     #11#0  = #0#0;                               ||SERIE EXPEDIENTE
     #11#1  = #0#1;                               ||NUMERO EXPEDIENTE
     #11#2  = fFechaIni;                          ||FECHA PARTE
     #11#3  = nLinPar;                            ||LINEA
     #11#4  = #1#5;                               ||CODIGO TRABAJADOR
     #11#5  = #1#6;                               ||NOMBRE TRABAJADOR
     #11#23 = #10#15;                             ||SERIE PARTE
     #11#24 = #10#3;                              ||NUMERO PARTE
     #11#20 = #0#2;                               ||SERIE PRESUPUESTO
     #11#21 = #0#3;                               ||NUMERO PRESUPUESTO

     |ABRE #2;
     #2#0 = #11#4;                                ||TRABAJADORES
     |LEE 000#2=;

     |SI FSalida = 0;
          #11#6 = #2#3;                           ||CATEGORIA
          #11#7 = #2#25;                          ||DESCRIPCION CATEGORIA
          |ABRE #15;
          #15#0 = #2#3;                           ||CONVENIO
          #15#1 = #2#2;                           ||CATEGORIA
          |LEE 000#15=;

          |SI FSalida = 0;
               #11#22 = #15#13;                   ||CODIGO MANO OBRA
               |HAZ ImporteHoras;
               #11#11 = #1#8;                     ||TOTAL HORAS OPERARIO DIA
               #11#27 = "JORNADA";                ||DESCRIPCION DEL TIPO DE HORA.
               |HAZ Conversion;
               |HAZ TotLin;
               |HAZ TotParteAcu;
          |FINSI;

          |CIERRA #15;
     |FINSI;

     |CIERRA #2;
     |GRABA 020#11c;

     nLinPS = 0;
     nHor0 = (#0#7/nPartidas) ! 3;
     nHor1 = (#0#7/nPartidas) ! 0;
     |SI nHor0 ! nHor1;
          nHora = nHor0 + (#0#7 - ((nHor0 * nPartidas) ! 3));
     |SINO;
          nHora = nHor0;
     |FINSI;
     |BUCLE SPartidas;
|FPRC;
-----------------------------------------------------------------------------
|DEFBUCLE STrab;
     #1#2;
     ;
     "*";
     "*";
     ;
     NULL, STrab;
|FIN;
-----------------------------------------------------------------------------
|PROCESO Sal; |TIPO 3;
     nPartidas = 0;
     nLinea = 0;
     |BUCLE SumaPart;

     |SI nPartidas = 0;
          |ACABA;
     |FINSI;

     |ABRE #16;
     |ABRE #11;
     |ABRE #10;
     |ABRE #7;
     #7#0  = #0#2;                                ||SERIE PRESUPUESTO
     #7#1  = #0#3;
     #7#2  = 1;
     |LEE 000#7=;

     |SI FSalida = 0;

          |PARA nLinea = 1; |SI FSalida = 0; |HACIENDO nLinea = nLinea + 1;
               #7#0  = #0#2;
               #7#1  = #0#3;
               #7#2 = nLinea
               |LEE 000#7=;
          |SIGUE;

          nLinea = nLinea - 1;

     |SINO;
          nLinea = 1;
     |FINSI;

     |ABRE #12;
     |ABRE #21;
     |ABRE #22;
     fFechaIni = #0#4;
     |PARA fFechaIni = #0#4; |SI fFechaIni [ #0#5; |HACIENDO fFechaIni = fFechaIni + 1;
          |HAZ FechaValida;
          |SI FSalida = 0;
               nModo = (FEntrada/100)!0;
               |DDEFECTO #10;
               |HAZ NParte;
               |DDEFECTO #11;
               nHay = 0;
               nHayT = 0;
               nLinPar = 0;
               |BUCLE STrab;

               |SI nHay = 1;
                    |GRABA 020#10c;
                    ||HAZ TotParte;
                    |HAZ LinPres;
                    nHayT = 1;
               |FINSI;
          |FINSI;
     |SIGUE;
     |CIERRA #22;
     |CIERRA #21;
     |CIERRA #12;

     |CIERRA #16;
     |CIERRA #10;
     |CIERRA #11;
     |CIERRA #7;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO Conversion;
     nEuros = #11#14 / nEurComBase;               ||CANT.EUROS VENTA BASE HORA
     #11#12 = nEuros * nEurComTrab;               ||IMPORTE VENTA TRABAJO HORA
     nEuros = #11#15 / nEurComBase;               ||CANT.EUROS COSTO BASE HORA
     #11#13 = nEuros * nEurComTrab;               ||IMPORTE COSTO TRABAJO HORA
|FPRC;
-----------------------------------------------------------------------------
|PROCESO TotLin;

     |SI #6#14 = "P";                             ||PRESUPUESTO
          #11#8  = #11#11;
     |FINSI;

     |SI #6#14 = "A";                             ||ADMINISTRACION
          #11#9  = #11#11;
     |FINSI;

     |SI #6#14 = "E";                             ||EXTRAS
          #11#10 = #11#11;
     |FINSI;

     #11#16 = #11#11*#11#12;                      ||T.TRABAJ.VENTA MON.TRAB.
     #11#17 = #11#11*#11#13;                      ||T.TRABAJ.COSTO MON.TRAB.
     #11#18 = #11#11*#11#14;                      ||T.TRABAJ.VENTA MON.BASE
     #11#19 = #11#11*#11#15;                      ||T.TRABAJ.COSTO MON BASE

     #10#4  = #10#4  + #11#8;                     ||TOTAL HORAS PRESUPUESTO
     #10#5  = #10#5  + #11#9;                     ||TOTAL HORAS ADMINISTRACION
     #10#6  = #10#6  + #11#10;                    ||TOTAL HORAS EXTRAS
     #10#9  = #10#9  + #11#11;                    ||TOTAL HORAS PARTE
     #10#10 = #10#10 + #11#17;                    ||TOTAL COSTO MONEDA TRABAJO
     #10#11 = #10#11 + #11#16;                    ||TOTAL VENTA MONEDA TRABAJO
     #10#12 = #10#12 + #11#19;                    ||TOTAL COSTO MONEDA BASE
     #10#13 = #10#13 + #11#18;                    ||TOTAL VENTA MONEDA BASE

     |SI #6#14 = "P";
          #10#20 = "P";
     |FINSI;

     |SI #6#14 = "A";
          #10#20 = "A";
     |FINSI;

     |SI #6#14 = "E";
          #10#20 = "E";
     |FINSI;

|FPRC;
-----------------------------------------------------------------------------
|PROCESO NParte;

     |ABRE #13;
     #13#0 = "A";
     |LEE 000#13=;

     |SI FSalida ! 0;
          |MENAV "0000NO ESTAN DEFINIDOS LOS PARAMETROS DE OBRAS";
          |ERROR;
          |CIERRA #13;
          |ACABA;
     |FINSI;

     |ABRE #14;
     #14#0 = #13#3;                ||SERIE
     #14#2 = "partetrab";          ||TIPO DOCUMENTO
     |LEE 000#14=;

     |SI FSalida = 0;
          #14#1 = #14#1 + 1;
          |GRABA 020#14a;
     |SINO;
          #14#1 = 1;
          |GRABA 020#14c;
     |FINSI;

     #10#0  = #0#0;                ||SERIE EXPEDIENTE.
     #10#1  = #0#1;                ||NO. EXPEDIENTE.
     #10#2  = fFechaIni;           ||FECHA EXPEDIENTE
     #10#15 = #13#3;               ||SERIE PARTE
     #10#3  = #14#1;               ||NUMERO PARTE
     #10#16 = #0#2;                ||SERIE PRESUPUESTO.
     #10#17 = #0#3;                ||NO. PRESUPUESTO.
     #10#7  = #5#10;               ||COD. CLIENTE.
     #10#8  = #5#12;               ||NOMBRE CLIENTE.
     #10#14 = #5#11;               ||MONEDA TRABAJO.


     |CIERRA #14;
     |CIERRA #13;

|FPRC;
-----------------------------------------------------------------------------
|PROCESO LinPres;
     #7#0  = #0#2;                                ||SERIE PRESUPUESTO
     #7#1  = #0#3;                                ||NO. PRESUPUESTO
     #7#2  = nLinea;                              ||LINEA
     #7#3  = fFechaIni;                           ||FECHA PARTE
     #7#4  = #10#15;                              ||SERIE PARTE
     #7#5  = #10#3;                               ||NUMERO PARTE
     #7#6  = #10#4;                               ||T.HORAS PRES
     #7#7  = #10#5;                               ||T.HORAS ADMI
     #7#8  = #10#6;                               ||T.HORAS EXTRA
     #7#9  = #10#10;                              ||IMP.TOT.HORAS VENTA
     #7#10 = #10#11;                              ||IMP.TOT.HORAS COSTE
     #7#13 = #10#9;                               ||TOTAL HORAS PARTE
     #7#14 = #6#0;                                ||SERIE EXPEDIENTE
     #7#15 = #6#1;                                ||NUMERO EXPEDIENTE
     #7#16 = #6#14;                               ||TIPO PRESUPUESTO
     |GRABA 020#7c;

     #6#6  = #6#6  + #7#6;
     #6#7  = #6#7  + #7#7;
     #6#8  = #6#8  + #7#8;
     #6#13 = #6#13 + #7#13;
     #6#9  = #6#9  + #7#9;
     #6#10 = #6#10 + #7#10;
     |GRABA 020#6a;

     #10#4 = 0; #10#5 = 0; #10#6 = 0;
     #10#9 = 0; #10#10 = 0; #10#11 = 0;
     nLinea = nLinea + 1;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO TotParteAcu;
/*
     nTotHPres = nTotHPres + #11#8;               ||TOTAL HORAS PRESUPUESTO
     nTotHAdmi = nTotHAdmi + #11#9;               ||TOTAL HORAS ADMINISTRACION
     nTotHExtr = nTotHExtr + #11#10;              ||TOTAL HORAS EXTRAS
     nTotHPart = nTotHPart + #11#11;              ||TOTAL HORAS PARTE
     nTotCosTr = nTotCosTr + #11#17;              ||TOTAL COSTO MONEDA TRABAJO
     nTotVenTr = nTotVenTr + #11#16;              ||TOTAL VENTA MONEDA TRABAJO
     nTotCosBa = nTotCosBa + #11#19;              ||TOTAL COSTO MONEDA BASE
     nTotVenBa = nTotVenBa + #11#18;              ||TOTAL VENTA MONEDA BASE
*/
|FPRC;
-----------------------------------------------------------------------------
|PROCESO TotParte;
/*
     #10#4 = nTotHPres + #11#8;                   ||TOTAL HORAS PRESUPUESTO
     #10#5 = nTotHAdmi + #11#9;                   ||TOTAL HORAS ADMINISTRACION
     #10#6 = nTotHExtr + #11#10;                  ||TOTAL HORAS EXTRAS
     #10#9 = nTotHPart + #11#11;                  ||TOTAL HORAS PARTE
     #10#10 = nTotCosTr + #11#17;                 ||TOTAL COSTO MONEDA TRABAJO
     #10#11 = nTotVenTr + #11#16;                 ||TOTAL VENTA MONEDA TRABAJO
     #10#12 = nTotCosBa + #11#19;                 ||TOTAL COSTO MONEDA BASE
     #10#13 = nTotVenBa + #11#18;                 ||TOTAL VENTA MONEDA BASE
*/
|FPRC;
-----------------------------------------------------------------------------
|PROCESO Rango;
     |MENAV "0000EXISTEN PARTES CON ESTE RANGO DE FECHAS";
     nHay = 1;
|FPRC;
-------------------------------------------------------------------------------
|DEFBUCLE Rango;
     #7#2;
     ;                                          ||Campos Extras.
     #0#2, #0#3, #0#4;
     #0#2, #0#3, #0#5;
     ;                                          ||b/e Bolqueo-Ordenacion.
     NULL, Rango;
|FIN;
-------------------------------------------------------------------------------
|PROCESO MirFec; |TIPO 0;
     nHay = 0;
     ||컴컴컴컴컴컴컴횮ontrol Cierre
     efFecha = #0#4;
     |HAZ EstaCerrado;
     |SI FSalida = 0;
          |ERROR; |ACABA;
     |FINSI;
     ||컴컴컴컴컴컴컴컴컴컴컴컴컴컴

     |SI Campo = 4;
          |ABRE #7;
          |SELECT #2#7;
          #7#0 = #0#2;
          #7#1 = #0#3;
          #7#3 = #0#4;
          |LEE 000#7=;

          |SI FSalida = 0;
               |HAZ Rango;
          |FINSI;

          |CIERRA #7;

     |SINO;
          |BUCLE Rango;
     |FINSI;

     |SI nHay = 1;
          |ERROR;
          nHay = 0;
     |FINSI;

|FPRC;
-------------------------------------------------------------------------------
