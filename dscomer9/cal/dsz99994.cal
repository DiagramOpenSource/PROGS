
||                      OBSERVACIONES CLIENTES;


|FICHEROS;
     dsz99994 #0;
     dsm00018 #918;
     agifa142 #142;
     agifa024 #24;
     agifa112 #112;
     referen@;                                                                
|FIN;

|VARIABLES;
     nLin = 0;
     &Tempo = "";
     nHay      = 0;
     &eaFuerza = "";
     &aClave   = "";
     &aMenClave= "";
     aParam         = "";
     aDirectorio    = "";
     aNFichero      = "";
     aVariableCarga = "";
     aFichero       = "";
     aAlfa          = "";

     nVariable      = 0;
     nBaffer        = 0;
     nTotalLinea    = 0;
     nTope          = 0;
     nVari1         = 0;
     nVari2         = 0;

     &eaCodigo      = "";
     &eaTipoCodigo  = "";
     &eaNombreList  = "";
     &enCuadroIni   = 0;
     &enCuadroFin   = 0;
     &enCampoAncho  = 0;
     &enModoEdita   = 0;
     &enTotalVaria  = 0;

{100}&epPuntEdita   = "";
|FIN;

|PROCESO CopiaObs;
     |SALVA_DATOS #referen@;
     |REPON_DATOS #918;
     |GRABA 020#918n;
|FPRC;

|DEFBUCLE CopiaObs;
     #referen@#1003;
     ;
     "      ", "  ", 0;
     "zzzzzz", "zz", 999;
     ;
     NULL, CopiaObs;
|FIN;

|PROCESO BorraObs;
     |BORRA 020#918a;
     |LIBERA #918;
|FPRC;

|DEFBUCLE BorraObs;
     #918#1;
     ;
     eaCodigo, eaTipoCodigo, 0;
     eaCodigo, eaTipoCodigo, 999;
     be;
     NULL, BorraObs;
|FIN;

|PROCESO GrabaSecuencial;
     IepPuntEdita  = epPuntEdita1 <-;
     |PARA nTotalLinea = 0;  |SI nTotalLinea [ enTotalVaria;  |HACIENDO nTotalLinea = nTotalLinea + 1;
          |AL_BUF nBaffer, nTotalLinea, epPuntEdita;
          IepPuntEdita = IepPuntEdita + 1;
     |SIGUE;
|FPRC;

|PROCESO Edicion;
     nTope  = nTotalLinea - 1;
     nVari1 = 0;
     nVari2 = 0;
     enModoEdita = enModoEdita + 100;
     |EDITA nBaffer, 1, nTope, enCuadroIni, enCuadroFin, enModoEdita, eaNombreList, enCampoAncho, nVari1, nVari2;
     enModoEdita = enModoEdita $ 100;
|FPRC;

|PROCESO CogePuntero;
     IepPuntEdita  = epPuntEdita1 <-;
     |PARA nTotalLinea = 0;  |SI nTotalLinea [ enTotalVaria;  |HACIENDO nTotalLinea = nTotalLinea + 1;
          |DEL_BUF nBaffer, nTotalLinea, epPuntEdita;
          IepPuntEdita = IepPuntEdita + 1;
     |SIGUE;
|FPRC;

|PROCESO Edita;
     |PUSHV 0501 2380;
     |DIMENSIONA  200, nBaffer, 0;

     |HAZ GrabaSecuencial;
     |HAZ Edicion;
     |HAZ CogePuntero;

     |FINDIM nBaffer;
     |POPV;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO PintaCampos;
     |BLANCO 0510 2071;
     nLin = 0;
     |ABRE #0;
     |ABRE #918;
     |PARA nVariable = 0;  |SI nVariable [ 98;  |HACIENDO nVariable = nVariable + 1;
          |DDEFECTO #918;
          #918#0 = eaCodigo;
          #918#1 = nVariable + 2;
          #918#3 = eaTipoCodigo;
          |LEE 000#918=;
          |SI FSalida ! 0; |SAL; |FINSI;
          nLin = nLin + 1;
          #0#0 = nLin;
          #0#1 = #918#2;
          |GRABA 020#0n;
     |SIGUE;
     |CIERRA #918;
     |CIERRA #0;
|FPRC;

|PROCESO GrabaClave;
     |ABRE #142;
     |LEE 101#142=;
     |SI FSalida ! 0; |GRABA 020#142b; |FINSI;
     #142#145 = aClave;
     |GRABA 020#142a;
     |CIERRA #142;
|FPRC;

|PROCESO PideClave;
     |MENSA "0000Clave para Modificacion Observaciones.";
     |SI #142#145 = 0;
          aMenClave = "          Entre la CLAVE:";
          |HAZ Clave;
          aAlfa = aClave;
          aMenClave = "        Reentre la CLAVE:";
          |HAZ Clave;
          |SI aAlfa ! aClave;
               |MENAV "0000CLAVE incorrecta";
          |SINO;
               |HAZ GrabaClave;
          |FINSI;
     |SINO;
          aAlfa = #142#145;
          aMenClave = "          Entre la CLAVE:";
          |HAZ Clave;
          |SI aAlfa ! aClave;
               |MENAV "0000Clave incorrecta...";
          |SINO;
               |CONFI "2400NModificar CLAVE (S/N).: ";
               |SI FSalida = 0;
                    aMenClave = "   Entre la Nueva CLAVE :";
                    |HAZ Clave;
                    aAlfa = aClave;
                    aMenClave = "       Reentre la CLAVE :";
                    |HAZ Clave;
                    |SI aAlfa ! aClave;
                         |MENAV "0000CLAVE incorrecta, NO SE MODIFICA...";
                    |SINO;
                         |HAZ GrabaClave;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
     |BLIN 4;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO IniciaEdicion;
     |ABRE #918;
     |PARA nVariable = 1;  |SI nVariable [ 100;  |HACIENDO nVariable = nVariable + 1;
           IepPuntEdita  = epPuntEdita1 <-;
           IepPuntEdita = IepPuntEdita + (nVariable - 1);

           #918#0 = eaCodigo;
           #918#1 = nVariable;
           #918#3 = eaTipoCodigo;
           |LEE 101#918=;
           |SI FSalida ! 0;
               epPuntEdita  = "";
           |SINO;
               epPuntEdita  = #918#2;
           |FINSI;
           |LIBERA #918;
     |SIGUE;

     |PUSHV  0501 2380;
     |BLANCO 0811 2071;
     |ATRI R;  |PINTA 0511, "   Observaciones   ";  |ATRI 0;

     |HAZ Edita;
     |POPV;

     |PARA nVariable = 1;  |SI nVariable [ 100;  |HACIENDO nVariable = nVariable + 1;
           IepPuntEdita = epPuntEdita1 <-;
           IepPuntEdita = IepPuntEdita + (nVariable - 1);
           |DDEFECTO #referen@;
           #referen@#0 = eaCodigo;
           #referen@#1 = nVariable;
           #referen@#3 = eaTipoCodigo;
           |LEE 101#referen@.=;
           |SI FSalida ! 0;  |GRABA 020#referen@.b;  |FINSI;
           #referen@#2 = epPuntEdita;
           |GRABA 020#referen@.a;
           |LIBERA #referen@;
     |SIGUE;
     |PARA nVariable = 100;  |SI nVariable ] 1;  |HACIENDO nVariable = nVariable - 1;
           #referen@#0 = eaCodigo;
           #referen@#1 = nVariable;
           #referen@#3 = eaTipoCodigo;
           |LEE 101#referen@.=;
           aAlfa = #referen@#2;  |QBF aAlfa;
           |SI aAlfa ! "";  |SAL;  |FINSI;
           |BORRA 020#referen@.a;
           |LIBERA #referen@;
     |SIGUE;

     || Chequea si se ha modificado
     |PARA nVariable = 1;  |SI nVariable [ 100;  |HACIENDO nVariable = nVariable + 1;
          |DDEFECTO #referen@;
          #referen@#0 = eaCodigo;
          #referen@#1 = nVariable;
          #referen@#3 = eaTipoCodigo;
          |LEE 000#referen@.=;
          aAlfa = #referen@#2;
          |DDEFECTO #918;
          #918#0 = eaCodigo;
          #918#1 = nVariable;
          #918#3 = eaTipoCodigo;
          |LEE 000#918=;
          |SI aAlfa ! #918#2; |SAL; |FINSI;
     |SIGUE;
     |SI nVariable [ 100;     || Se ha modificado
          |BUCLE BorraObs;
          |BUCLE CopiaObs;
     |FINSI;
     |CIERRA #918;
|FPRC;

|PROCESO Borralo;
     |BORRA 020#918a;
|FPRC;

|DEFBUCLE Borralo;
     #918#1;
     ;
     eaCodigo, eaTipoCodigo, 001;
     eaCodigo, eaTipoCodigo, 999;
     be;
     NULL, Borralo;
|FIN;

|PROCESO Min;
     #0#0 = 1;
     #0#1 = " " * 58;
|FPRC;

|PROCESO Max;
     #0#0 = 99;
     #0#1 = "z" * 58;
|FPRC;

|PROGRAMA;
     aParam = PARAMETRO;
     enTotalVaria  = 100;
     eaNombreList  = "";
     enCuadroIni   = 0611;
     enCuadroFin   = 2070;
     enCampoAncho  = 60;
     enModoEdita   = 0;


     |SI aParam = "BORRA";
          |BUCLE Borralo;
          |ACABA;
     |FINSI;

     aAlfa = aParam % 101;
     |SI aAlfa = "X";                   || llama tagm0092
          eaCodigo = aParam % 206;
          eaFuerza = aParam % 801;
          eaTipoCodigo = "CL";
          aParam = "";
     |FINSI;


     |ABRE #142; |LEE 000#142p; |CIERRA #142;

     nHay = 1;
     |SI #142#102 = "X"; |Y aParam ! "MANTE"; |Y eaFuerza = "N";
          |ABRE #918;
          #918#0 = eaCodigo;
          #918#3 = eaTipoCodigo;
          #918#1 = 0;
          eaTipoCodigo = #918#3;   ||Formateo
          eaCodigo = #918#0;       ||''
          |LEE 000#918];
          |SI FSalida = 0; |Y #918#3 = eaTipoCodigo; |Y #918#0 = eaCodigo;
               nHay = 1;
          |SINO;
               nHay = 0;
          |FINSI;
          |CIERRA #918;
     |FINSI;

     |SI nHay = 0; |ACABA; |FINSI;

     |SI #142#144 = "S";  || Clave
          |HAZ CreaTempo; |NOME_DAT #0 Tempo; |DELINDEX #0;
          |SI aParam = "MANTE";  || Llamada del mantenimiento
               |PUSHV 0501 2380;
               |HAZ PintaCampos;
               |ENTLINEAL #1#0, 2, 4, 19, 1, Min, Max;
               |HAZ PideClave;
               |POPV;
               |SI aClave ! #142#145;
                    |DELINDEX #0; |HAZ BoraTempo;
                    |ACABA;
               |FINSI;
          |SINO;
               |PUSHV 0501 2380;
               |HAZ PintaCampos;
               |ENTLINEAL #1#0, 2, 4, 19, 1, Min, Max;
               |POPV;
               |DELINDEX #0; |HAZ BoraTempo;
               |ACABA;
          |FINSI;
          |DELINDEX #0; |HAZ BoraTempo;
     |FINSI;
     ||컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
     |SI eaTipoCodigo = "CL";
          |ABRE #24;
          #24#0 = eaCodigo;
          |LEE 101#24=;
     |FINSI;
     |SI eaTipoCodigo = "PR";
          |ABRE #112;
          #112#0 = eaCodigo;
          |LEE 101#112=;
     |FINSI;

     |SI FSalida = 0;
          |DDEF aAlfa;
          aAlfa = aAlfa + "dsm00018";
          |CARGA_DEF aAlfa, referen@;
          |SI FSalida = 0;
               |HAZ CreaTempo; |NOME_DAT #referen@#Tempo#; |DELINDEX #referen@;
               |ABRE #referen@;
               |HAZ IniciaEdicion;
               |CIERRA #referen@;
               |HAZ BoraTempo; |DELINDEX #referen@;
               |DESCARGA_DEF #referen@;
          |SINO;
               |MENAV "0000Error al cargar 'dsm00018'";
          |FINSI;
     |FINSI;

     |SI eaTipoCodigo = "CL";
          |LIBERA #24;
          |CIERRA #24;
     |FINSI;
     |SI eaTipoCodigo = "PR";
          |LIBERA #112;
          |CIERRA #112;
     |FINSI;
|FPRO;
