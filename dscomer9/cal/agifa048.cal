|FICHEROS;
     agifa048 #0;   || escandallo cabs.
     agifa049 #1,MANTE;   || escandallo lins.
     agifa019 #2;   || articulo
     agifa142 #5;   || parametros
     agifa017 #17;
     agifa321;
     agifa324;
     agifa046 #46;  || Parametros
     agifa045 #45,MANTE;  || Calculo Comparativo
     referen@;
|FIN;

|VARIABLES;
     aPath = "";
     aImos = "N";
     nOk = 0;
     nBtnOrtsBorra = 0;
     nGuarda = 0;
     nSal = 0;
     aFilm = "";
     nTari = 0;
     nModo = 0;
     &nDeci_Base = 0;
     &nDeci_PreBase = 0;
     &nDeci_EsCab = 0;
     &nDeci_EsLin = 0;

     &Tempo    = "";
     nSwConfi  = 1;
     &nModcab       = 0;
     nim        = 0;
     &nDec      = 0;
     nNume    = 0;
     nNume1   = 0;
     aAlfa    = "";
     nMod     = 0;
     informe  = "agifa048";
     coste    = 0         ;
     nivel    = 0         ;
     maxnivel = 0         ;
     espacios = "                ";
     escandall= " ";
     nCalculo = 0;
     impcompone = 0;
     nForma     = 0;
     nContenido = 0;
     nPrecio    = 0;

     &wtip   = 0;
     nPvp = 0;
     nCampo = 0;
     nIVA  = 0;
     nPvpSin = 0;
     nImpo = 0;
     nImpo2 = 0;

     nGrid1 = -1;
     nRango = 0;
|FIN;

|INCLUYE i_varart;

|CAMPOS;
     ||Lineas Escandallo
     #1#0 linesca  ;
     #1#1 linlinea ;
     #1#2 linartic ;
     #1#8 linivel  ;

     ||Articulo
     #2#0  artic    ;
     #2#6  stocktot ;
     ||#2#9  preco    ;
     #2#10 vstock   ;

     ||Temporal
     #3#0 tmpescal ;
     #3#1 tmp1busc ;
     #3#2 tmp2busc ;

     ||Almacenes
     #4#0 almcodig ;
     #4#1 almalmac ;
     #4#5 almstock ;
     #4#3 almvastk ;
|FIN;

|PROCESO KitFab; |TIP O7;
     |SI #5#12 = "X";
          |C_M #0#33, 1, "S";
     |SINO;
          |C_M #0#33, 1, "N";
     |FINSI;
|FPRC;

|PROCESO Pack; |TIPO 7;
     |ABRE #5; |LEE 000#5p; |CIERRA #5;
     |SI #5#126 = 0;
          |C_M #0#15, 1, "N";
     |SINO;
          |C_M #0#15, 1, "S";
     |FINSI;
     |SI nBtnOrtsBorra ! 0;
          |ESTADO_CONTROL nBtnOrtsBorra, "DISABLE";
     |FINSI;
|FPRC;

|PROCESO T48_6; |TIPO 6;
     enAlta = 1;
     eaArticulo = #0Campo;
     |HAZ LlenaArticulo;
     |SI FSalida = 0;
          #0Campo = eaArticulo;
          |PINTA #0Campo;
          |HAZ CreaArti;
     |SINO;
          |ERROR; |ACABA;
     |FINSI;
|FPRC;

|PROCESO Modifica;
     |C_M #0#16, 1, "S";
     |C_M #0#26, 1, "S";
     |C_M #0#23, 1, "S";
     |C_M #0#27, 1, "S";
     |C_M #0#24, 1, "S";
     |C_M #0#28, 1, "S";
     |C_M #0#25, 1, "S";
     |C_M #0#29, 1, "S";

     |SI #0#17 = "N";
         |C_M #0#16, 1, "N";  #0#16 = 0;   |PINTA #0#16;
         |C_M #0#26, 1, "N";  #0#26 = "I"; |PINTA #0#26;
     |FINSI;

     |SI #0#18 = "N";
         |C_M #0#23, 1, "N";  #0#23 = 0;   |PINTA #0#23;
         |C_M #0#27, 1, "N";  #0#27 = "I"; |PINTA #0#27;
     |FINSI;

     |SI #0#19 = "N";
         |C_M #0#24, 1, "N";  #0#24 = 0;   |PINTA #0#24;
         |C_M #0#28, 1, "N";  #0#28 = "I"; |PINTA #0#28;
     |FINSI;

     |SI #0#20 = "N";
         |C_M #0#25, 1, "N";  #0#25 = 0;   |PINTA #0#25;
         |C_M #0#29, 1, "N";  #0#29 = "I"; |PINTA #0#29;
     |FINSI;
|FPRC;

|PROCESO imprelia;
     |SI nCalculo = 1;
         |HAZ EsMecanogra48;
         |SI FSalida = 0;
               |HAZ MecanoFilm;
               |SI aFilm = "S"; |ACABA; |FINSI;
         |FINSI;

         impcompone = #1#6 / #0#6;
         |SI #1#10 = 1; #0#8 = #0#8 + impcompone;    |FINSI;   ||Componentes
         |SI #1#10 = 2; #0#2 = #0#2 + impcompone;    |FINSI;   ||Mano Obra
         |SI #1#10 = 3; #0#3 = #0#3 + impcompone;    |FINSI;   ||Maquinaria
         |SI #1#10 = 4; #0#4 = #0#4 + impcompone;    |FINSI;   ||Otros

         |SI #1#10 = 1;
             |SI #0#17 = "S";
                 |SI #0#26 = "D";
                     #0#21 = #0#21 + (#1#6 > #0#16);
                 |SINO;
                     #0#21 = #0#21 + (#1#6 / ((100 - #0#16) / 100));
                 |FINSI;
             |SINO;
                 #0#21 = #0#21 + #1#6;
             |FINSI;
         |FINSI;

         |SI #1#10 = 2;
             |SI #0#19 = "S";
                 |SI #0#28 = "D";
                     #0#21 = #0#21 + (#1#6 > #0#24);
                 |SINO;
                     #0#21 = #0#21 + (#1#6 / ((100 - #0#24) / 100));
                 |FINSI;
             |SINO;
                 #0#21 = #0#21 + #1#6;
             |FINSI;
         |FINSI;

         |SI #1#10 = 3;
             |SI #0#18 = "S";
                 |SI #0#27 = "D";
                     #0#21 = #0#21 + (#1#6 > #0#23);
                 |SINO;
                     #0#21 = #0#21 + (#1#6 / ((100 - #0#23) / 100));
                 |FINSI;
             |SINO;
                 #0#21 = #0#21 + #1#6;
             |FINSI;
         |FINSI;

         |SI #1#10 = 4;
             |SI #0#20 = "S";
                 |SI #0#29 = "D";
                     #0#21 = #0#21 + (#1#6 > #0#25);
                 |SINO;
                     #0#21 = #0#21 + (#1#6 / ((100 - #0#25) / 100));
                 |FINSI;
             |SINO;
                 #0#21 = #0#21 + #1#6;
             |FINSI;
         |FINSI;


          |HAZ Total;
         |PINTA #0#2;
         |PINTA #0#3;
         |PINTA #0#4;
         |PINTA #0#5;
         |PINTA #0#8;
         |PINTA #0#9;
         |PINTA #0#11;
         |PINTA #0#21;
     |SINO;
         |PRINT;
     |FINSI;
|FPRC;

|PROCESO T48_4; |TIPO 4;
     |SELECT #1#0;
     |LEE 000#0=;
     |SI FSalida ! 0;
          |MENAV "0000Por favor, consulte el registro correcto antes de imprimir.";
          |ACABA;
     |SINO;
          |PINDA #0#0;
          FEntrada = 402;
     |FINSI;
     |HAZ Tipo4;
|FPRC;

|DEFBUCLE imprelia;
     #1#1;
     ;
     #0#0, 001;
     #0#0, 999;
     ;
     NULL, imprelia;
|FIN;

|PROCESO Tipo4;
     |IMPRE 1;
     |SI 0 = FSalida;
          |INFOR informe;
          |SI 0 = FSalida;
               wtip = 2;
               |BUCLE imprelia;
               |PIEINF;
               |FININF;
          |FINSI;
          |FINIMP;
     |FINSI;
|FPRC;

|PROCESO Total;
     #0#5 = #0#2 + #0#3 + #0#4;         || total otros costes
     |SI #0#36 = "S";
           #0#11 = (#0#5 + #0#8) > #0#7;      || total serie
           #0#11 = #0#11 > #0#34;
     |SINO;
           nImpo = (#0#5 + #0#8) % #0#7;
           nImpo2 = (#0#5 + #0#8) % #0#34;
           #0#11 = (#0#5 + #0#8) + nImpo + nImpo2;
     |FINSI;
     #0#9 = #0#11 / #0#12;              || total unitario
     |HAZ CosteModulo;
|FPRC;

|PROCESO totcoste; |TIPO 0;
     |HAZ Total;
     |PINTA #0#5;
     |PINTA #0#11;
     |PINTA #0#9;
|FPRC;

|PROCESO npiezas; |TIPO 0;
     |DDEFECTO #2;
     |ABRE #2;
     #2#0 = #0#0;
     |LEE 000#2=;
     |SI #2#13 > 0;|Y #0Campo ! Contenido;
         |MENAV "0000Existen ordenes de fabricacion del escandallo ...";
         #0Campo = Contenido;
         |PINTA #0Campo;
         |ERROR;
     |SINO;
         #0#9 = #0#11 / #0#12;
         |HAZ CosteModulo;
         |PINTA #0#9;
     |FINSI;
     |CIERRA #2;

     #0#22 = #2#18;   |PINTA #0#22;
|FPRC;

|PROCESO Tipo1; |TIPO 1;
     ||proceso para registros anteriores a a¤adir coste unitario
     |SI #0#12 = 1;
         |SI #0#11 ! #0#9;
            #0#12 = 1;
            #0#11 = #0#9;
            |PINTA #0#11;
            |PINTA #0#9;
            |GRABA 020#0a;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO AlmaEsca6; |TIPO 6;
     eaArticulo = #0#0;
     enAlmacen = #0#10;
     |HAZ CreaArtiAlma;
|FPRC;

|PROCESO tipo7;     |TIPO 7;
     nMod = (FEntrada / 100 ) ! 0;
     |SI nMod = 2;
          |C_M #0#2, 1, "N";
          |C_M #0#3, 1, "N";
          |C_M #0#4, 1, "N";
          ||C_M #0#7, 1, "N";
     |SINO;
          |C_M #0#2, 1, "S";
          |C_M #0#3, 1, "S";
          |C_M #0#4, 1, "S";
          ||C_M #0#7, 1, "S";


          #0#17 = #46#1;  |PINTA #0#17;
          #0#16 = #46#5;  |PINTA #0#16;
          #0#26 = #46#9;  |PINTA #0#26;
          #0#18 = #46#2;  |PINTA #0#18;
          #0#23 = #46#6;  |PINTA #0#23;
          #0#27 = #46#10; |PINTA #0#27;
          #0#19 = #46#3;  |PINTA #0#19;
          #0#24 = #46#7;  |PINTA #0#24;
          #0#28 = #46#11; |PINTA #0#28;
          #0#20 = #46#4;  |PINTA #0#20;
          #0#25 = #46#8;  |PINTA #0#25;
          #0#29 = #46#12; |PINTA #0#29;
     |FINSI;
|FPRC;

|PROCESO Min;
     #1#0 = #0#0;
     #1#1 = 001;
|FPRC;

|PROCESO Max;
     #1#0 = #0#0;
     #1#1 = 999;
|FPRC;

|PROCESO Tipo14; |TIPO 14;
     |ABRE #5; |LEE 000#5p; |CIERRA #5;
     nDec = #5#8;

     |HAZ Es48X;
     |SI FSalida = 0;
          |SI nGrid1 = -1;
               nRango = 1 + 4 + 8 + 16 + 32;
               |LINEAL_SIMPLE #1#1, nRango, 2102, 2999, Min, Max, NULL;
               nGrid1 = FSalida;
          |SINO;
               |REFRESCACONTROL nGrid1;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO BorraLin49;
     |BORRA 020#1a;
     |LIBERA #1;
|FPRC;

|DEFBUCLE BorraLin49;
     #1#1;
     ;
     #0#0, 001;
     #0#0, 999;
     be;
     NULL, BorraLin49;
|FIN;

|PROCESO baja; |TIPO 2;
     nModcab = (FEntrada / 100 ) ! 0;
     nForma  = 0 +. 1;
     |SI nForma = 1;
          nCalculo = 1;
          #0#2  = 0;
          #0#3  = 0;
          #0#4  = 0;
          #0#8  = 0;
          #0#21 = 0;
          #0#5  = 0;
          #0#11 = 0;
          #0#9  = 0;
          |BUCLE imprelia;
          nCalculo = 0;
          |ABRE #2;
          #2#0 = #0#0;
          |LEE 000#2=;
          |CIERRA #2;
          enTiva = #2#30;
          efFiva = ~;
          |HAZ SacaIVA;

          nPvp = #0#21;
          |SI #46#13 = "S";
               nPvp = nPvp > enIva;
          |FINSI;

          |SI #46#14 = "S";
               nNume = 1;
               |PARA nCampo = 1; |SI nCampo [ nDeci_EsCab; |HACIENDO nCampo = nCampo + 1;
                    nNume = nNume * 10;
               |SIGUE;
               nPvp = nPvp * nNume;

               |SI #2#109 > 0; nPvp = nPvp + (#2#109-1); |FINSI;
               nNume1 = (nPvp $ #2#109);
               |SI nNume1 ! 0;
                    nPvp = nPvp - nNume1;
               |FINSI;

               nPvp = nPvp / nNume;
          |FINSI;
          #0#21 = nPvp; |PINTA #0#21;
     |FINSI;
     |SI nModcab = 3;
          |HAZ Es48X;
          |SI FSalida = 0; |BUCLE BorraLin49; |FINSI;

          |HAZ EsOrts;
          |SI FSalida = 0;
               eaArticulo = #0#0;
               |SUB_EJECUTA_NP "ortsm019;BAJA";
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO CompaIVA;
     nContenido = Contenido;
     |SI nContenido = #45Campo;  |ACABA;  |FINSI;

     |HAZ LeeIVA;
||     |SI #46#13 = "N";
||          #45#4 = #45#8 / (1+ (enIva / 100));
||     |SINO;
          #45#4 = #45#8;
||     |FINSI;

     #45#3 = 100 - ((#45#0 / #45#4) * 100);
     |PINTA #45#3;
     |PINTA #45#4;
     |PINTA #45#8;
|FPRC;

|PROCESO Comparativo;
     nContenido = Contenido;
     |SI nContenido = #45Campo;  |ACABA;  |FINSI;

     |HAZ LeeIVA;

     |SI Campo = 3;
         #45#4 = #45#0 /  ((100 - #45#3) / 100);
         #45#4 = #45#4 > enIva; ||**
     |FINSI;

     |SI Campo = 4;
         nPvpSin = #45#4 / ( 1 + (enIva/100));   ||quito el iva **
         #45#3 = 100 - ((#45#0 / nPvpSin) * 100);|| **
||        #45#3 = 100 - ((#45#0 / #45#4) * 100); || **
     |FINSI;

     |HAZ CalcuIVA;
     #45#8 = nPvp;

     |PINTA #45#3;
     |PINTA #45#4;
     |PINTA #45#8;
|FPRC;

|PROCESO Tarifa;
/*
     |SI #45#6 = 1;  #45#7 = #2#130;  |FINSI;
     |SI #45#6 = 2;  #45#7 = #2#131;  |FINSI;
     |SI #45#6 = 3;  #45#7 = #2#132;  |FINSI;
     |SI #45#6 = 4;  #45#7 = #2#153;  |FINSI;
     |SI #45#6 = 5;  #45#7 = #2#154;  |FINSI;
     |SI #45#6 = 6;  #45#7 = #2#155;  |FINSI;
     |PINTA #45#7;
*/
|FPRC;

|PROCESO LeeIVA;
     |ABRE #2;
     #2#0 = #0#0;
     |LEE 000#2=;
     |CIERRA #2;
     enTiva = #2#30;
     efFiva = ~;
     |HAZ SacaIVA;
|FPRC;

|PROCESO CalcuIVA;
     |HAZ LeeIVA;
     nPvp = #45#4;
   ||  |SI #46#13 = "S";
          nPvp = nPvp > enIva;
   ||  |FINSI;

     |SI #46#14 = "S";
          nNume = 1;
          |PARA nCampo = 1; |SI nCampo [ nDeci_EsCab; |HACIENDO nCampo = nCampo + 1;
               nNume = nNume * 10;
          |SIGUE;
          nPvp = nPvp * nNume;

          |SI #2#109 > 0; nPvp = nPvp + (#2#109-1); |FINSI;
          nNume1 = (nPvp $ #2#109);
          |SI nNume1 ! 0;
               nPvp = nPvp - nNume1;
          |FINSI;

          nPvp = nPvp / nNume;
     |FINSI;
|FPRC;

|PROCESO Boton1;
     |PUSHV 0501 2380;
     |ATRI N; |BLANCO 717 2255;
     #45#0 = #0#11;
     #45#1 = #0#22;
     #45#2 = #0#21;
     #45#3 = #0#30;
     #45#4 = #0#31;
     #45#8 = #0#32;

     |SI #45#8 = 0;  |Y #45#4 = 0;
          |HAZ LeeIVA;
          nPvpSin = #45#2 / ( 1 + (enIva/100));   ||**
          #45#3 = 100 - ((#45#0 * 100) / nPvpSin);||**
          #45#4 = #45#0 /  ((100 - #45#3) / 100); ||**
          #45#4 = #45#4 > enIva;                  ||**

||          #45#3 = 100 - ((#45#0 * 100) / #45#2);
||          #45#4 = #45#0 /  ((100 - #45#3) / 100);

          |SI #46#13 = "N"
               |HAZ CalcuIVA;
               #45#8 = nPvp;
          |SINO;
               #45#8 = #45#4;
          |FINSI;
     |FINSI;

     |C_V #45#5, 1, "N";  |C_M #45#5, 1, "N";
     |C_V #45#6, 1, "N";  |C_M #45#6, 1, "N";
     |C_V #45#7, 1, "N";  |C_M #45#7, 1, "N";
     |C_M #45#3, 1, "S";
     |C_M #45#4, 1, "S";
     |C_M #45#8, 1, "S";

     |PINPA #0#45;
     |PINDA #0#45;
     |ENDATOS #1#45;
     |SI FSalida = 0;
         #0#30 = #45#3;
         #0#31 = #45#4;
         #0#32 = #45#8;
     |FINSI;
     |POPV;
     |PINTA #0#30;
     |PINTA #0#31;
|FPRC;

|PROCESO Boton2;
     |PUSHV 0501 2380;
     |ATRI N; |BLANCO 717 2255;
     #45#0 = #0#11;
     #45#1 = #0#22;
     #45#2 = #0#21;
     #45#3 = #0#30;
     #45#4 = #0#31;
     #45#7 = #46#13; ||IVA S/N
     #45#8 = #0#32;

     |C_V #45#5, 1, "S";  |C_M #45#5, 1, "S";
     |C_V #45#6, 1, "S";  |C_M #45#6, 1, "S";
     |C_V #45#7, 1, "S";
     |C_M #45#3, 1, "N";
     |C_M #45#4, 1, "N";
     |C_M #45#8, 1, "N";

     |ABRE #2;
     #2#0 = #0#0;
     |LEE 101#2=;
     |SI FSalida = 0;
         |PINPA #0#45;
         |ATRI R;
         |PINTA 1820,"PVP Calculado/Comparativo C/P :";
         |PINTA 1920,"Grabar en Tarifa .............:";
         |ATRI I;
         |PINTA 2020,"IVA incluido ... .............:";
         |ATRI 0;

         |PINDA #0#45;
         |ENDATOS #1#45;
         |SI FSalida = 0;
             nPrecio = #45#2;
             |SI #45#5 = "P";
/*
                 |SI #45#7 = "S";
                    nPrecio = #45#8;
                 |SINO;
                    nPrecio = #45#4;
                 |FINSI;
*/
                 nPrecio = #45#4;
             |FINSI;
             |SI #45#6 = 1;  #2#18  = nPrecio;  #2#130 = #45#7;  |FINSI;
             |SI #45#6 = 2;  #2#19  = nPrecio;  #2#131 = #45#7;  |FINSI;
             |SI #45#6 = 3;  #2#20  = nPrecio;  #2#132 = #45#7;  |FINSI;
             |SI #45#6 = 4;  #2#147 = nPrecio;  #2#153 = #45#7;  |FINSI;
             |SI #45#6 = 5;  #2#148 = nPrecio;  #2#154 = #45#7;  |FINSI;
             |SI #45#6 = 6;  #2#149 = nPrecio;  #2#155 = #45#7;  |FINSI;
             |GRABA 020#2a;
             |LIBERA #2;

             |SI #45#6 = 1;
                 #0#22 = nPrecio;
             |FINSI;
         |FINSI;
     |FINSI;

     |POPV;
     |PINTA #0#22;
|FPRC;

|PROCESO ConfirmaPCM;
     |PULSATECLA;
     |CONFI "0000NActualizar PCM del Escandallo...";
     nSwConfi = FSalida;
|FPRC;

|PROCESO Tipo3m48;  |TIPO 3;
     |SI nSwConfi = 1;
          |HAZ ConfirmaPCM;
     |FINSI;
     |SI nSwConfi = 0;
          |ABRE #2;
          #2#0 = #0#0;
          |LEE 121#2=;
          |SI FSalida = 0;
               #2#9 = #0#9;
               |HAZ EsRodacal48;
               |SI FSalida = 0;
                    #2#9 = #0#9 * #2#4;
               |FINSI;
               |GRABA 020#2a;
          |FINSI;
          |CIERRA #2;

          |ABRE #17;
          #17#0 = #0#0;
          #17#1 = #0#10;
          |LEE 121#17=;
          |SI FSalida = 0;
               #17#69 = #0#9;     || PCM
               |HAZ EsRodacal48;
               |SI FSalida = 0;
                    #17#9 = #0#9 * #2#4;
               |FINSI;
               |GRABA 020#17a;
          |FINSI;
          |CIERRA #17;
     |FINSI;

     |HAZ EsOrts;
     |SI FSalida = 0;
          aImos = "N";
          |DDEF aPath;
          aAlfa = aPath + "ortsm036";
          |CARGA_DEF aAlfa, referen@;
          |SI FSalida = 0;
               |ABRE #referen@;
               #referen@#0 = #0#0;
               |LEE 020#referen@.p;
               |CIERRA #referen@;
               aImos = #referen@#28;
               |DESCARGA_DEF #referen@;
          |FINSI;
          |SI aImos = "S";
               aAlfa = aPath + "ortsm019";
               |CARGA_DEF aAlfa, referen@;
               |SI FSalida = 0;
                    |ABRE #referen@;
                    #referen@#0 = #0#0;
                    |LEE 020#referen@.=;
                    |CIERRA #referen@;
                    aImos = #referen@#2;
                    |DESCARGA_DEF #referen@;
               |FINSI;
          |FINSI;
          |SI aImos = "S";
               |CONFI "0000NModificar volumen artículo S/N:";
               |SI FSalida = 0;
                    |HAZ OrtsVolumen;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Tipo8;  |TIPO 8;
     |HAZ Es48X;
     |SI FSalida = 0;
          |ABRET #1;
     |FINSI;

     |ABRE #agifa324;
     |ABRE #agifa321;
     |LEE 001#agifa321.p;
     #agifa324#0 = #agifa321#9;    ||Igualo a moneda base
     |LEE 001#agifa324.=;
     nDeci_Base = #agifa324#7;     ||Decimales moneda base
     nDeci_PreBase = #agifa324#9;  ||Decimales precio de moneda base
     |CIERRA #agifa321;
     |CIERRA #agifa324;

     |ABRE #46;
     |LEE 040#46p;
     |SI FSalida ! 0;  |DDEFECTO #46;  |FINSI;
     |CIERRA #46;

     nDeci_EsCab = #46#15;
     nDeci_EsLin = #46#16;

     |HAZ EsOrts;
     |SI FSalida = 0;
          |CONTROL_SIMPLE 0, "BOTON, Borrar Tipos 1", 0468, 0480, OrtsBorraTipo1;
          nBtnOrtsBorra = FSalida;
     |FINSI;
|FPRC;

|PROCESO Tipo9;  |TIPO 9;
     |HAZ Es48X;
     |SI FSalida = 0;
          |CIERRAT #1;
     |FINSI;
     |SI nBtnOrtsBorra ! 0;
          |FIN_CONTROL_WINDOWS nBtnOrtsBorra;
     |FINSI;
|FPRC;

|PROCESO Tipo30_48; |TIPO 30;
     aAlfa = "agifa053;" + #0#0;  ||Chequeo
     |SUB_EJECUTA aAlfa;

     |HAZ Es48X;
     |SI FSalida = 0;
          #1#0 = #0#0;
          #1#1 = 1;
          |LEE 000#1];
          |SI FSalida ! 0; |O #1#0 ! #0#0;
               |SI nModo = 1;
                    |MENAV "0000Se anulan los datos entrados.";
               |SINO;
                    |MENAV "0000No existen lineas, se borra la cabecera.";
               |FINSI;
               |BORRA 020#0a;
               |ERROR;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Tipo7_48; |TIPO 7;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 1;
          #0#34 = #46#17;
          |PINTA #0#34;
     |FINSI;
|FPRC;


|PROCESO T48_13; |TIPO 13;
     |HAZ Es48X;
     |SI FSalida = 0;
          |MODO_RELACION #1, 1, "agifa017", "N", "N";
          |MODO_RELACION #1, 1, "agifa017", "X", "X";
     |FINSI;

     |HAZ EsRodacal48;
     |SI FSalida = 0;
          |C_V #1#11, 1, "S";
          |C_A #1#11, 1, 9;
          |C_A #1#3, 1, 19;

          |C_P #1#10, 1, 1727;
          |C_P #1#12, 1, 1729;
          |C_P #1#11, 1, 1739;
          |ATRI R; |PINTA 1626, "³T³Unidades ³Unidades"; |ATRI 0;
     |FINSI;
     |HAZ EsTagloma48;
     |SI FSalida = 0;
          |PINTA 2353, "ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ";
     |FINSI;
     |HAZ EsMecanogra48;
     |SI FSalida = 0;
          |ATRI R; |PINTA 1460, "³Film Protector³Tipo"; |ATRI 0;
          |PINTA 1560, "³              ³    ³";
          |HAZ PinMecanogra49;
     |FINSI;
     |HAZ EsCoimasa48;
     |SI FSalida = 0;
          |ATRI R; |PINTA 1460, "³Proceso³Proceso³"; |ATRI 0;
          |PINTA 1560, "³       ³       ³";
     |FINSI;
     |HAZ EsOrts;
     |SI FSalida = 0;
          |PINTA 1302, "Es Combinable:";
          |PINTA 1320, "Tratamiento Imos:";
          |ATRI R; |PINTA 1461, "C³Codigo Etiqueta"; |ATRI 0;
          |PINTA 1562, "³";
          |HAZ PinOrts;
     |FINSI;
|FPRC;

|PROCESO EscanLin13; |TIPO 13;
     |HAZ EsTagloma48;
     |SI FSalida = 0;
          |DDEF aAlfa;
          aAlfa = aAlfa + "tagmpara";
          |CARGA_DEF aAlfa, referen@;
          |SI FSalida = 0;
               |ABRE #referen@;
               |LEE 000#referen@.p;
               |CIERRA #referen@;
               nTari = #referen@#4;
               |DESCARGA_DEF #referen@;
               |ABRE #2;
               #2#0 = #1#2;
               |LEE 000#2=;
               |CIERRA #2;
               |SI #0#33 ! "K";
                    |PINTA 2353, "ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ";
               |SINO;
                    |ATRI I;
                    |PINTA 2353, "PVP Componente: ";
                    |SI nTari = 1; nCampo = 18; |FINSI;
                    |SI nTari = 2; nCampo = 19; |FINSI;
                    |SI nTari = 3; nCampo = 20; |FINSI;
                    |SI nTari = 4; nCampo = 147; |FINSI;
                    |SI nTari = 5; nCampo = 148; |FINSI;
                    |SI nTari = 6; nCampo = 149; |FINSI;
                    |PINTA 2369, #2nCampo;
                    |ATRI 0;
               |FINSI;
          |FINSI;
     |FINSI;

     |HAZ EsMecanogra48;
     |SI FSalida = 0;
          |HAZ PinMecanogra49;
     |FINSI;
|FPRC;

|PROCESO PinMecanogra49;
     |DDEF aAlfa;
     aAlfa = aAlfa + "mecam004";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          #referen@#0 = #1#0;
          #referen@#1 = #1#1;
          |LEE 000#referen@.=;
          |ATRI I;
          |PINTA #referen@#2;
          |PINTA #referen@#3;
          |ATRI 0;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|PROCESO Observa49; |TIPO 0;
     nModo = (FEntrada / 100) ! 0;
     |SI FSalida = 0; |O FSalida = 3;
          |HAZ EsMecanogra48;
          |SI FSalida = 0;
               eaArticulo = #1#0;
               enLinea = #1#1;
               |SUB_EJECUTA_NP "mecam004";
               |HAZ PinMecanogra49;
          |FINSI;
          |HAZ EsCoimasa48;
          |SI FSalida = 0;
               eaArticulo = #1#0;
               enLinea = #1#1;
               |SUB_EJECUTA_NP "coima010";
               |HAZ PinCoimasa;
          |FINSI;
          |HAZ EsOrts;
          |SI FSalida = 0;
               enModo = nModo;
               eaArticulo = #1#0;
               enLinea = #1#1;
               |SUB_EJECUTA_NP "ortsm020";
               |HAZ PinOrts;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO MecanoFilm;
     |DDEF aAlfa;
     aAlfa = aAlfa + "mecam004";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |DDEFECTO #referen@;
          |ABRE #referen@;
          #referen@#0 = #1#0;
          #referen@#1 = #1#1;
          |LEE 000#referen@.=;
          |CIERRA #referen@;
          aFilm = #referen@#2;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|PROCESO DefTipo; |TIPO 7;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 1;
          |ABRE #5; |LEE 000#5p; |CIERRA #5;
          |SI #5#12 = "K";
               #0#33 = "K";
          |SINO;
               #0#33 = "N";
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO PinCoimasa;
     |DDEF aAlfa;
     aAlfa = aAlfa + "coima010";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          #referen@#0 = #1#0;
          #referen@#1 = #1#1;
          |LEE 000#referen@.=;
          |ATRI I;
          |PINTA #referen@#3;
          |PINTA #referen@#4;
          |ATRI 0;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|PROCESO RecalLin;
     |HAZ totliesc;

     |HAZ imprelia;
     |GRABA 020#1a;
     |LIBERA #1;
|FPRC;

|PROCESO Min1;
     #1#0 = #0#0;
     #1#1 = 1;
|FPRC;

|PROCESO Max1;
     #1#0 = #0#0;
     #1#1 = 999;
|FPRC;

|DEFBUCLE RecalLin;
     #1#1;
     ;
     #0#0, 001;
     #0#0, 999;
     ;
     NULL, RecalLin;
|FIN;

|PROCESO CalGasto;
     nSal = FSalida;
     |SI #0Campo ! Contenido;
          nCalculo = 1;
          #0#2  = 0;
          #0#3  = 0;
          #0#4  = 0;
          #0#8  = 0;
          #0#21 = 0;
          #0#5  = 0;
          #0#11 = 0;
          #0#9  = 0;
          |BUCLE RecalLin;
          nCalculo = 0;
          |HAZ totcoste;
          |PINDA #0#0;
          |ENTLINEAL #1#1, 1, 7, 22, 0, Min1, Max1;
     |FINSI;

     |SI nSal = 0; |O nSal = 3;
          |HAZ EsOrts;
          |SI FSalida = 0;
               eaArticulo = #0#0;
               |SUB_EJECUTA_NP "ortsm019";
               |HAZ PinOrts;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO TipoArti; |TIPO 0;
     |SI #1#10 < 1; |O #1#10 > 4;
          |AVISO; |ERROR;
     |FINSI;
|FPRC;

|PROCESO PinOrts;
     |DDEF aAlfa; aAlfa = aAlfa + "ortsm019";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          #referen@#0 = #0#0;
          |LEE 000#referen@.=;
          |ATRI I;
          |PINTA #referen@#1;
          |PINTA #referen@#2;
          |ATRI 0;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
     |DDEF aAlfa; aAlfa = aAlfa + "ortsm020";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          #referen@#0 = #1#0;
          #referen@#1 = #1#1;
          |LEE 000#referen@.=;
          |ATRI I;
          |PINTA #referen@#2;
          |PINTA #referen@#3;
          |ATRI 0;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;
--------------------------------------------------------
     Procesos A¤adidos para el X
--------------------------------------------------------
|PROCESO T80_48; |TIPO 80;
     FSalida = 3099;
|FPRC;

|PROCESO T12_48; |TIPO 12;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 1; |Y FSalida = 7;
          |BUCLE BorraLin49;
     |FINSI;
|FPRC;

|PROCESO T7_48; |TIPO 7;
     |HAZ Es48X;
     |SI FSalida = 0;
          nModo = (FEntrada / 100) ! 0;
          |SI nModo = 1;
               |BUCLE BorraLin49;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO T0_48; |TIPO 0;
     |HAZ Es48X;
     |SI FSalida = 0;
          |REFRESCACONTROL nGrid1;
     |FINSI;
|FPRC;

|PROCESO CreaArti;
     nOk = 0;
     nModo = (FEntrada / 100) ! 0;
     nGuarda = FEntrada;
     |HAZ Es48X;
     |SI FSalida = 0;
          |ABRE #2;
          #2#0 = eaArticulo;
          |LEE 000#2=;
          |SI FSalida ! 0;
               aAlfa = "*dsz99895;" + eaArticulo;
               |SUB_EJECUTA_NP aAlfa;
          |FINSI;
          #2#0 = eaArticulo;
          |LEE 000#2=;
          |SI FSalida ! 0;
               nOk = 1;
               |ERROR;
          |FINSI;
          |CIERRA #2;
     |SINO;
          |DDEFECTO #2;
          |ABRE #2;
          #2#0 = eaArticulo;
          |LEE 000#2=;
          |SI FSalida ! 0;
               |PUSHV 0501 2380;
               |PINPA #0#2;
               |PINDA #0#2;
               |CONFI "0000SConfirma alta (S/N):";
               |SI FSalida = 0;
                    |ENDATOS #1#2;
                    |SI FSalida = 0;
                         |GRABA 020#2n;
                    |SINO;
                         nOk = 1;
                         |ERROR;
                    |FINSI;
               |SINO;
                    nOk = 1;
                    |ERROR;
               |FINSI;
               |POPV;
          |FINSI;
          |CIERRA #2;
     |FINSI;
     FEntrada = nGuarda;
     |SI nOk = 0; |Y nModo = 1;
          |ABRE #2;
          #2#0 = #1#2;
          |LEE 000#2=;
          #1#3 = #2#1; |PINTA #1#3;
          |CIERRA #2;
     |FINSI;
|FPRC;

|PROCESO CreaArtiAlma;
     nGuarda = FEntrada;
     |HAZ Es48X;
     |SI FSalida = 0;
          |ABRE #17;
          #17#0 = eaArticulo;
          #17#1 = enAlmacen;
          |LEE 000#17=;
          |SI FSalida ! 0;
               aAlfa = "*dsz99894;" + eaArticulo + (("00000" + enAlmacen) % -105);
               |SUB_EJECUTA_NP aAlfa;
          |FINSI;
          #17#0 = eaArticulo;
          #17#1 = enAlmacen;
          |LEE 000#17=;
          |SI FSalida ! 0;
               |ERROR;
          |FINSI;
          |CIERRA #17;
     |SINO;
          |DDEFECTO #17;
          |ABRE #17;
          #17#0 = eaArticulo;
          #17#1 = enAlmacen;
          |LEE 000#17=;
          |SI FSalida ! 0;
               |PUSHV 0502 2380;
               |CLS;
               |PINPA #0#17;
               |PINDA #0#17;
               |CONFI "0000SConfirma alta (S/N):";
               |SI FSalida = 0;
                    |ENDATOS #1#17;
                    |SI FSalida = 0;
                         |GRABA 020#17n;
                    |SINO;
                         |ERROR;
                    |FINSI;
               |SINO;
                    |ERROR;
               |FINSI;
               |POPV;
          |FINSI;
          |CIERRA #17;
     |FINSI;
     FEntrada = nGuarda;
|FPRC;

|PROCESO T48_20; |TIPO 20;
     |SI nBtnOrtsBorra ! 0;
          |ESTADO_CONTROL nBtnOrtsBorra, "ENABLE";
     |FINSI;
     FSalida = "";
|FPRC;
