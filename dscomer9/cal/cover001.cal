|FICHEROS:
     cover001 #0;
     agifa019 #19; ||articulos
     agifa065 #65; ||historico
     agifa553 #3;  ||lineas
     agifa553@;
|FIN;

|VARIABLES;
     &ucom  = 0;
     &uven  = 0;
     &pcom  = 0;
     &pven  = 0;
     &ben   = 0;
     &mar   = 0;
     aux1   = 0;
     aux2   = 0;
     &uni   = 0;
     &exi   = 0;
     temp   = "";
     &tuni  = 0;
     &tucom = 0;
     &tuven = 0;
     &tpcom = 0;
     &tpven = 0;
     &tben  = 0;
     &tmar  = 0;
     pvp = 0;
     pcm = 0;
     &tpvp = 0;
     &tpcm = 0;
     informe1 = "lucio001";
     informe2 = "lucio002";
     &fam     ="                              ";
     uuni = 0;
     &fpvp = 0;
     &fpcm = 0;
     &ttexi = 0;
|FIN;

|PROCESO inicializa;
     uven = 0;
     ucom = 0;
     pven = 0;
     pcom = 0;
     ben  = 0;
     mar  = 0;
     aux1 = 0;
     aux2 = 0;
     uni  = 0;
     fpvp = 0;
     fpcm = 0;
|FPRC;

|PROCESO totales;
     tuni = tuni + uni;
     tucom = tucom + ucom;
     tuven = tuven + uven;
     tpcom = tpcom + pcom;
     tpven = tpven + pven;
     tben  = tben  + ben;

     fam = #3#1;

     |SI #0#5 = "A";
          |PRINT;
          ttexi = ttexi + exi;
          exi = 0;
     |FINSI;
|FPRC;

|PROCESO existencias;
     |SI #65#2 = "AC";     ||SI #65#6 ] 0;                       ||compra
          aux1 = #65#6 * #65#9;
          pcom = pcom + aux1;
          ucom = ucom + #65#6;
     |FINSI;
     |SI #65#2 = "FC";|O #65#2 = "AV";|O #65#2 = "TI";  ||SI #65#6 [ 0;          ||venta
          aux2 = (#65#6 * #65#9)* (-1);
          uven = uven + (#65#6 * (-1));
          pven = pven + aux2;
     |FINSI;

     |SI #0#5 = "A";
          exi = #19#6;
     |FINSI;
     uuni = uuni +#65#6;
     |SI temp ! #65#0; |Y #0#5 = "L";
          exi = exi + #19#6
     |FINSI;
     temp = #65#0;
|FPRC;

|PROCESO beneficio;
     ben  = pven - pcom;
     mar  = ((100 * pven) / pcom) - 100
|FPRC;

|PROCESO pvp;
     pvp = 0;
     pcm = 0;
     pvp = #19#18 * uuni;
     pcm = #19#9 * uuni;
     uuni = 0;
     tpvp = tpvp + pvp;
     tpcm = tpcm + pcm;
     fpvp = fpvp + pvp;
     fpcm = fpcm + pcm;
|FPRC;

|DEFBUCLE existencias;
     #65#1;
     ;
     #19#0, #0#2, "  ", 000001, 00001, "     ";
     #19#0, #0#3, "zz", 999999, 99999, "zzzzz";
     ;
     NULL, existencias;
|FIN;

|PROCESO historico;
     |SI #0#5 = "A";
          |DDEFECTO #3;
          #3#0 = #19#125;
          |LEE 000#3=;
          |HAZ inicializa;
     |FINSI;
     |BUCLE existencias;
     |HAZ pvp;
     |HAZ beneficio;
     |SI #0#5 ="A";
          |HAZ totales;
     |FINSI;
|FPRC;

|PROCESO tmar;
     tmar = ((100 * tpven) / tpcom) - 100;
|FPRC;

|DEFBUCLE articulos;
     #19#1;
     3;
     #0#0,#0#8;||nando para controlar temporadas
     #0#1,#0#9;
     ;
     NULL, historico;
|FIN;

|DEFBUCLE articulosf;
     #19#1;
     125,3;
     #0#0,#3#0,#0#8; ||nando para controlar temporadas
     #0#1,#3#0,#0#9;
     ;
     NULL, historico;
|FIN;

|PROCESO Lineas;
     |HAZ inicializa;
     |BUCLE articulosf;
     |PRINT;
     exi = 0;
|FPRC;

|DEFBUCLE Lineas;
     #3#1;
     ;
     #0#6;
     #0#7;
     ;
     NULL, Lineas;
|FIN;

|PROCESO Tipo3; |TIPO 3;
     |IMPRE #0;
     |SI FSalida = 0;
          |SI #0#5="A";
               |INFOR informe1;
               |ABRE #3;
               |BUCLE articulos;
               |CIERRA #3;
               |HAZ tmar;
          |FINSI;
          |SI #0#5="L";
               |INFOR informe2;
               exi = 0;
               |BUCLE Lineas;
               |HAZ tmar;
          |FINSI;
          |PIEINF;
          |FININF;
     |FINSI;
|FPRC;
