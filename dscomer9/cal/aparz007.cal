|FICHEROS;
     aparz007 #0;
     aparm019 #19;
     aparm020 #20;
     aparm021 #21;
     aparm028 #28;
     aparm029 #29;
     aparm034 #34;
     referen@;
|FIN;

|VARIABLES;
     &efDFecha = @;
     &efHFecha = @;
     aParam = "";
     fHoy = @;
     aPath = "";
     aFic = "";
     aVehiculo = "";
     aOrg = "";
     aDes = "";
     aAlfa = "";
     nImpo = 0;
     aUsu = "";
     aCodVehi = "";
     nLin = 0;
     nKms = 0;
     nTiempo = 0;
     aSurtidor = "";
     nLts = 0;
|FIN;

|PROCESO aparm034;
     nLin = nLin + 1;
     |SALVA_DATOS #34;
     |REPON_DATOS #referen@;
     #referen@#0 = nLin;
     |GRABA 020#referen@.n;
|FPRC;

|DEFBUCLE aparm034;
     #34#3;
     ;
     INICIO;
     FINAL;
     ;
     NULL, aparm034;
|FIN;

|PROCESO Graba34G;
     |SI aVehiculo ! "";
          nLin = nLin + 1;
          #referen@#0 = nLin;
          #referen@#1 = aSurtidor;
          #referen@#2 = "g";
          #referen@#3 = efHFecha;
          #referen@#4 = nLts;
          #referen@#5 = nImpo;
          #referen@#6 = aVehiculo;
          |GRABA 020#referen@.n;
          nLts = 0;
          nImpo = 0;
     |FINSI;
|FPRC;

|PROCESO aparm034G;
     aAlfa = #34#2; aAlfa = aAlfa > "";
     |SI #34#3 ] efDFecha; |Y #34#3 [ efHFecha; |Y aAlfa = "G";
          |SI aVehiculo ! #34#6; |O aSurtidor ! #34#1;
               |HAZ Graba34G;
               aVehiculo = #34#6;
               aSurtidor = #34#1;
          |FINSI;
          nLts = nLts + #34#4;
          nImpo = nImpo + #34#5;
     |SINO;
          nLin = nLin + 1;
          |SALVA_DATOS #34;
          |REPON_DATOS #referen@;
          #referen@#0 = nLin;
          |GRABA 020#referen@.n;
     |FINSI;
|FPRC;

|DEFBUCLE aparm034G;
     #34#3;
     ;
     INICIO;
     FINAL;
     ;
     NULL, aparm034G;
|FIN;

|PROCESO Graba34C;
     |SI aVehiculo ! "";
          nLin = nLin + 1;
          #referen@#0 = nLin;
          #referen@#1 = aSurtidor;
          #referen@#2 = "c";
          #referen@#3 = efHFecha;
          #referen@#4 = nLts;
          #referen@#5 = nImpo;
          #referen@#6 = aVehiculo;
          |GRABA 020#referen@.n;
          nLts = 0;
          nImpo = 0;
     |FINSI;
|FPRC;

|PROCESO aparm034C;
     aAlfa = #34#2; aAlfa = aAlfa > "";
     |SI #34#3 ] efDFecha; |Y #34#3 [ efHFecha; |Y aAlfa = "C";
          |SI aVehiculo ! #34#6; |O aSurtidor ! #34#1;
               |HAZ Graba34C;
               aVehiculo = #34#6;
               aSurtidor = #34#1;
          |FINSI;
          nLts = nLts + #34#4;
          nImpo = nImpo + #34#5;
     |SINO;
          nLin = nLin + 1;
          |SALVA_DATOS #34;
          |REPON_DATOS #referen@;
          #referen@#0 = nLin;
          |GRABA 020#referen@.n;
     |FINSI;
|FPRC;

|DEFBUCLE aparm034C;
     #34#3;
     ;
     INICIO;
     FINAL;
     ;
     NULL, aparm034C;
|FIN;

|PROCESO Graba29;
     |SI aVehiculo ! "";
          nLin = nLin + 1;
          #referen@#0 = aVehiculo;
          #referen@#1 = nLin;
          #referen@#2 = fHoy;
          #referen@#4 = "CIERRE EJERCICIO";
          #referen@#6 = nKms;
          #referen@#7 = nImpo;
          |GRABA 020#referen@.n;
          nKms = 0;
          nImpo = 0;
     |FINSI;
|FPRC;

|PROCESO aparm029;
     |SI #29#2 ] efDFecha; |Y #29#2 [ efHFecha;
          |SI aVehiculo ! #29#0;
               |HAZ Graba29;
               aVehiculo = #29#0;
          |FINSI;
          nKms = nKms + #29#6;
          nImpo = nImpo + #29#7
     |SINO;
          |SI aCodVehi ! #29#0;
               aCodVehi = #29#0;
               nLin = 0;
          |FINSI;
          nLin = nLin + 1;
          |SALVA_DATOS #29;
          |REPON_DATOS #referen@;
          #referen@#1 = nLin;
          |GRABA 020#referen@.n;
     |FINSI;
|FPRC;

|DEFBUCLE aparm029;
     #29#2;
     ;
     INICIO;
     FINAL;
     ;
     NULL, aparm029;
|FIN;

|PROCESO Graba28;
     |SI aVehiculo ! "";
          nLin = nLin + 1;
          #referen@#0 = aVehiculo;
          #referen@#1 = nLin;
          #referen@#2 = fHoy;
          #referen@#5 = "CIERRE EJERCICIO";
          #referen@#6 = nImpo;
          |GRABA 020#referen@.n;
          nImpo = 0;
     |FINSI;
|FPRC;

|PROCESO aparm028;
     |SI #28#2 ] efDFecha; |Y #28#2 [ efHFecha;
          |SI aVehiculo ! #28#0;
               |HAZ Graba28;
               aVehiculo = #28#0;
          |FINSI;
          nImpo = nImpo + #28#6;
     |SINO;
          |SI aCodVehi ! #28#0;
               aCodVehi = #28#0;
               nLin = 0;
          |FINSI;
          nLin = nLin + 1;
          |SALVA_DATOS #28;
          |REPON_DATOS #referen@;
          #referen@#1 = nLin;
          |GRABA 020#referen@.n;
     |FINSI;
|FPRC;

|DEFBUCLE aparm028;
     #28#2;
     ;
     INICIO;
     FINAL;
     ;
     NULL, aparm028;
|FIN;

|PROCESO Graba21;
     |SI aVehiculo ! "";
          nLin = nLin + 1;
          #referen@#0 = aVehiculo;
          #referen@#3 = fHoy;
          #referen@#6 = "CIERRE EJERCICIO";
          #referen@#11 = nTiempo;
          #referen@#13 = nImpo;
          |GRABA 020#referen@.n;
          nTiempo = 0;
          nImpo = 0;
     |FINSI;
|FPRC;

|PROCESO aparm021;
     |SI #21#3 ] efDFecha; |Y #21#3 [ efHFecha;
          |SI aVehiculo ! #21#0;
               |HAZ Graba21;
               aVehiculo = #21#0;
          |FINSI;
          nTiempo = nTiempo + #21#11;
          nImpo = nImpo + #21#13;
     |SINO;
          |SI aCodVehi ! #21#0;
               aCodVehi = #21#0;
               nLin = 0;
          |FINSI;
          nLin = nLin + 1;
          |SALVA_DATOS #21;
          |REPON_DATOS #referen@;
          |GRABA 020#referen@.n;
     |FINSI;
|FPRC;

|DEFBUCLE aparm021;
     #21#2;
     ;
     INICIO;
     FINAL;
     ;
     NULL, aparm021;
|FIN;

|PROCESO Graba20;
     |SI aVehiculo ! "";
          nLin = nLin + 1;
          #referen@#0 = aVehiculo;
          #referen@#1 = nLin;
          #referen@#2 = fHoy;
          #referen@#4 = "CIERRE EJERCICIO";
          #referen@#6 = nKms;
          #referen@#7 = nImpo;
          |GRABA 020#referen@.n;
          nKms = 0;
          nImpo = 0;
     |FINSI;
|FPRC;

|PROCESO aparm020;
     |SI #20#2 ] efDFecha; |Y #20#2 [ efHFecha;
          |SI aVehiculo ! #20#0;
               |HAZ Graba20;
               aVehiculo = #20#0;
          |FINSI;
          nKms = nKms + #20#6;
          nImpo = nImpo + #20#7
     |SINO;
          |SI aCodVehi ! #20#0;
               aCodVehi = #20#0;
               nLin = 0;
          |FINSI;
          nLin = nLin + 1;
          |SALVA_DATOS #20;
          |REPON_DATOS #referen@;
          #referen@#1 = nLin;
          |GRABA 020#referen@.n;
     |FINSI;
|FPRC;

|DEFBUCLE aparm020;
     #20#2;
     ;
     INICIO;
     FINAL;
     ;
     NULL, aparm020;
|FIN;

|PROCESO Graba19;
     |SI aVehiculo ! "";
          nLin = nLin + 1;
          #referen@#0 = aVehiculo;
          #referen@#1 = nLin;
          #referen@#2 = fHoy;
          #referen@#5 = "CIERRE EJERCICIO";
          #referen@#6 = nImpo;
          |GRABA 020#referen@.n;
          nImpo = 0;
     |FINSI;
|FPRC;

|PROCESO aparm019;
     |SI #19#2 ] efDFecha; |Y #19#2 [ efHFecha;
          |SI aVehiculo ! #19#0;
               |HAZ Graba19;
               aVehiculo = #19#0;
          |FINSI;
          nImpo = nImpo + #19#6;
     |SINO;
          |SI aCodVehi ! #19#0;
               aCodVehi = #19#0;
               nLin = 0;
          |FINSI;
          nLin = nLin + 1;
          |SALVA_DATOS #19;
          |REPON_DATOS #referen@;
          #referen@#1 = nLin;
          |GRABA 020#referen@.n;
     |FINSI;
|FPRC;

|DEFBUCLE aparm019;
     #19#2;
     ;
     INICIO;
     FINAL;
     ;
     NULL, aparm019;
|FIN;

|PROCESO Copia;
     |DFICE aAlfa;
     aUsu = Usuario;
     aOrg = aAlfa + aFic + ".dat";
     aDes = aAlfa + aUsu + ".dat";
     |RENOMBRA_FICHERO aOrg, aDes;
     aOrg = aAlfa + aFic + ".ddx";
     aDes = aAlfa + aUsu + ".ddx";
     |RENOMBRA_FICHERO aOrg, aDes;
     aOrg = aAlfa + aFic + ".ixx";
     aDes = aAlfa + aUsu + ".ixx";
     |RENOMBRA_FICHERO aOrg, aDes;
|FPRC;

|PROCESO Ejecuta;
     |DDEF aPath;
     fHoy = ~;
     |SI #0#1 = "S";
          nLin = 0;
          aFic = "aparm019";
          |HAZ Copia;
          |NOME_DAT #19 aUsu;
          aAlfa = aPath + "aparm019";
          |CARGA_DEF aAlfa, referen@;
          |SI FSalida = 0;
               nImpo = 0;
               aVehiculo = "";
               |ABRE #referen@;
               |BUCLE aparm019;
               |HAZ Graba19;
               |DELINDEX #19;
               |CIERRA #referen@;
               |DESCARGA_DEF #referen@;
          |FINSI;
     |FINSI;
     |SI #0#2 = "S";
          nLin = 0;
          aFic = "aparm020";
          |HAZ Copia;
          |NOME_DAT #20 aUsu;
          aAlfa = aPath + "aparm020";
          |CARGA_DEF aAlfa, referen@;
          |SI FSalida = 0;
               nImpo = 0;
               aVehiculo = "";
               |ABRE #referen@;
               |BUCLE aparm020;
               |HAZ Graba20;
               |DELINDEX #20;
               |CIERRA #referen@;
               |DESCARGA_DEF #referen@;
          |FINSI;
     |FINSI;
     |SI #0#3 = "S";
          nLin = 0;
          aFic = "aparm021";
          |HAZ Copia;
          |NOME_DAT #21 aUsu;
          aAlfa = aPath + "aparm021";
          |CARGA_DEF aAlfa, referen@;
          |SI FSalida = 0;
               nImpo = 0;
               aVehiculo = "";
               |ABRE #referen@;
               |BUCLE aparm021;
               |HAZ Graba21;
               |DELINDEX #21;
               |CIERRA #referen@;
               |DESCARGA_DEF #referen@;
          |FINSI;
     |FINSI;
     |SI #0#4 = "S";
          nLin = 0;
          aFic = "aparm028";
          |HAZ Copia;
          |NOME_DAT #28 aUsu;
          aAlfa = aPath + "aparm028";
          |CARGA_DEF aAlfa, referen@;
          |SI FSalida = 0;
               nImpo = 0;
               aVehiculo = "";
               |ABRE #referen@;
               |BUCLE aparm028;
               |HAZ Graba28;
               |DELINDEX #28;
               |CIERRA #referen@;
               |DESCARGA_DEF #referen@;
          |FINSI;
     |FINSI;
     |SI #0#5 = "S";
          nLin = 0;
          aFic = "aparm029";
          |HAZ Copia;
          |NOME_DAT #29 aUsu;
          aAlfa = aPath + "aparm029";
          |CARGA_DEF aAlfa, referen@;
          |SI FSalida = 0;
               nImpo = 0;
               aVehiculo = "";
               |ABRE #referen@;
               |BUCLE aparm029;
               |HAZ Graba29;
               |DELINDEX #29;
               |CIERRA #referen@;
               |DESCARGA_DEF #referen@;
          |FINSI;
     |FINSI;
     |SI #0#6 = "S";
          nLin = 0;
          aFic = "aparm034";
          |HAZ Copia;
          |NOME_DAT #34 aUsu;
          aAlfa = aPath + "aparm034";
          |CARGA_DEF aAlfa, referen@;
          |SI FSalida = 0;
               nImpo = 0;
               aVehiculo = "";
               |ABRE #referen@;
               |BUCLE aparm034C;
               |HAZ Graba34C;
               |DELINDEX #34;
               |CIERRA #referen@;
               |DESCARGA_DEF #referen@;
          |FINSI;
     |FINSI;
     |SI #0#7 = "S";
          nLin = 0;
          aFic = "aparm034";
          |HAZ Copia;
          |NOME_DAT #34 aUsu;
          aAlfa = aPath + "aparm034";
          |CARGA_DEF aAlfa, referen@;
          |SI FSalida = 0;
               nImpo = 0;
               aVehiculo = "";
               |ABRE #referen@;
               |BUCLE aparm034G;
               |HAZ Graba34G;
               |DELINDEX #34;
               |CIERRA #referen@;
               |DESCARGA_DEF #referen@;
          |FINSI;
     |FINSI;
     |SI #0#6 = "S"; |O #0#7 = "S"; || Renumera la linea;
          aFic = "aparm034";
          |HAZ Copia;
          |NOME_DAT #34 aUsu;
          aAlfa = aPath + "aparm034";
          |CARGA_DEF aAlfa, referen@;
          |SI FSalida = 0;
               nLin = 0;
               |ABRE #referen@;
               |BUCLE aparm034;
               |DELINDEX #34;
               |CIERRA #referen@;
               |DESCARGA_DEF #referen@;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Na; |TIPO 12;
|FPRC;

|PROGRAMA;
     aParam = PARAMETRO;
     |ABRE #0;
     |LEE 101#0p;
     |SI aParam = "INI";
          |SI FSalida ! 0; |GRABA 020#0b; |FINSI;
          |DDEFECTO #0;
          |GRABA 020#0a;
     |FINSI;
     |SI aParam = "ENTRA";
          |PINPA #0#0;
          |PINDA #0#0;
          |ENDATOS #1#0;
          |GRABA 020#0a;
     |FINSI;
     |SI aParam = "EJECUTA";
          |HAZ Ejecuta;
     |FINSI;
     |CIERRA #0;
|FPRO;
