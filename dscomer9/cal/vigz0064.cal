|FICHEROS;
     vigz0064 #0;
     agifa007 #7;
     agifa010 #10;
     agifa019 #19;
     agifa024 #24;
     agifa025 #25;
     vigw0034 #34;
     vigw0035 #35;
     vigw0036 #36;
     vigm0043 #43;
     agifa065 #65;
     agifa134 #134;
|FIN;

|VARIABLES;
     &Tempo = "";
     aTmp34 = "";
     aTmp35 = "";
     aTmp36 = "";
     fDFecha = @;
     fHFecha = @;
     aMes = "";
     aA¤o = "";
     aAlfa = "";
     nMes = 0;
     nA¤o = 0;
     nUni = 0;
     nPre = 0;
     nPreTon = 0;
     nKg = 0;
     nPcmV = 0;
     nPcmF = 0;
     f = @;
     aArt = "";
|FIN;

|PROCESO Tmp;
     |DDEFECTO #34;
     #34#0 = #35#0;
     #34#14 = #35#1;
     |LEE 000#34=;

     |DDEFECTO #36;
     #36#0 = #35#0;
     |LEE 000#36=;

     #34#5 = #36#5;
     #34#6 = #36#6;
     #34#8 = #36#8;

     |DDEFECTO #24;
     #24#0 = #35#1;
     |LEE 000#24=;

     |DDEFECTO #25;
     #25#0 = #35#3;
     |LEE 000#25=;

     #35#5 = #24#1;
     #35#6 = #25#1;

     |SI #0#15 = "P";
          #34#7 = #34#7 * 166.386;
          #34#8 = #34#8 * 166.386;
     |FINSI;

     |PRINT;
|FPRC;

|DEFBUCLE Tmp1;
     #35#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Tmp;
|FIN;

|DEFBUCLE Tmp2;
     #35#2;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Tmp;
|FIN;

|DEFBUCLE Tmp3;
     #35#3;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Tmp;
|FIN;

|PROCESO Traspaso;
     |DDEFECTO #34;
     #34#0 = #43#12;
     #34#14 = #43#8;
     |LEE 101#34=;
     |SI FSalida ! 0; |GRABA 020#34b; |FINSI;

     |DDEFECTO #36;
     #36#0 = #43#12;
     |LEE 000#36=;
     |SI FSalida ! 0; |GRABA 020#36n; |FINSI;

     |DDEFECTO #19;
     #19#0 = #43#12;
     |LEE 000#19=;
     nPreTon = 1;
     aAlfa = #19#110; |QBF aAlfa;   || Alfanumerico1
     aAlfa = aAlfa > "";
     |SI aAlfa = "S"; nPreTon = 1000; |FINSI;
     nPre = #43#14 / nPreTon;

     #34#3 = #34#3 + #43#13;
     #34#4 = #34#4 + (nPre * #43#13);
     #34#7 = #34#4 / #34#3;
     |GRABA 020#34a;
     |LIBERA #34;

     |DDEFECTO #10;
     #10#52 = #43#0;
     #10#0 = #43#1;
     |LEE 000#10=;

     |DDEFECTO #24;
     #24#0 = #10#3;
     |SI #24#3 < #0#12; |O #24#3 > #0#13; |ACABA; |FINSI;

     |SI #10#6 < #0#4; |O #10#6 > #0#5; |ACABA; |FINSI;
     |SI #10#31 < #0#8; |O #10#31 > #0#9; |ACABA; |FINSI;
     |SI #10#3 < #0#10; |O #10#3 > #0#11; |ACABA; |FINSI;

     |DDEFECTO #35;
     #35#0 = #65#2;
     #35#1 = #24#0;
     #35#2 = #10#31;
     #35#3 = #10#6;
     |LEE 101#35=;
     |SI FSalida ! 0; |GRABA 020#35b; |FINSI;
     #35#7 = "01.01.0000";
     |SI #10#38 = "S";
          #134#49 = #10#53;
          #134#0 = #10#39;
          |LEE 000#134=;
          |SI FSalida = 0;
               #35#7 = #134#1;
          |FINSI;
     |FINSI;
     |DDEFECTO #19;
     #19#0 = #35#0;
     |LEE 000#19=;
     #35#4 = #19#1;
     |GRABA 020#35a;
     |LIBERA #35;
|FPRC;

|DEFBUCLE Traspaso;
     #43#3;
     12;
     fDFecha, #0#2;
     fHFecha, #0#3;
     ;
     NULL, Traspaso;
|FIN;

|PROCESO Historico;
     |SI #65#2 = "AV"; |O #65#2 = "BV"; |O #65#2 = "FB";
          |DDEFECTO #36;
          #36#0 = #65#0;

          |DDEFECTO #34;
          #34#0 = #65#0;
          #34#14 = #65#10;
          |SI #65#2 = "AV"; |O #65#2 = "BV";
               |DDEFECTO #7;
               #7#26 = #65#11;
               |LEE 000#7=;
               |SI #7#37 = "S"; |ACABA; |FINSI;

               |DDEFECTO #10;
               #10#52 = #65#11;
               #10#0 = #65#3;
               |LEE 000#10=;

               |DDEFECTO #24;
               #24#0 = #10#3;
               |SI #24#3 < #0#12; |O #24#3 > #0#13; |ACABA; |FINSI;

               |SI #10#6 < #0#4; |O #10#6 > #0#5; |ACABA; |FINSI;
               |SI #10#31 < #0#8; |O #10#31 > #0#9; |ACABA; |FINSI;
               |SI #10#3 < #0#10; |O #10#3 > #0#11; |ACABA; |FINSI;

               |DDEFECTO #35;
               #35#0 = #65#0;
               #35#1 = #24#0;
               #35#2 = #10#31;
               #35#3 = #10#6;
               |LEE 101#35=;
               |SI FSalida ! 0; |GRABA 020#35b; |FINSI;
               #35#7 = "01.01.0000";
               |SI #10#38 = "S";
                    #134#49 = #10#53;
                    #134#0 = #10#39;
                    |LEE 000#134=;
                    |SI FSalida = 0;
                         #35#7 = #134#1;
                    |FINSI;
               |FINSI;
               |DDEFECTO #19;
               #19#0 = #35#0;
               |LEE 000#19=;
               #35#4 = #19#1;
               |GRABA 020#35a;
               |LIBERA #35;

               |SI #65#2 = "AV";
                    nUni = -#65#6;
               |SINO;
                    nUni = #65#6;
               |FINSI;
               |LEE 101#34=;
               |SI FSalida ! 0; |GRABA 020#34b; |FINSI;
               #34#3 = #34#3 + nUni;
               #34#4 = #34#4 + (nUni * #65#14);

               |LEE 000#36=;
               |SI FSalida ! 0; |GRABA 020#36b; |FINSI;
          |SINO;
               |LEE 101#34=;
               |SI FSalida ! 0; |GRABA 020#34b; |FINSI;

               |LEE 101#36=;
               |SI FSalida ! 0; |GRABA 020#36b; |FINSI;
               #36#5 = #36#5 + #65#6;
               #36#6 = #36#6 + (#65#6 * #65#9);
          |FINSI;
          #34#7 = #34#4 / #34#3;
          #36#8 = #36#6 / #36#5;
          |GRABA 020#34a;
          |LIBERA #34;
          |GRABA 020#36a;
          |LIBERA #36;
     |FINSI;
|FPRC;

|DEFBUCLE Historico;
     #65#1;
     ;
     #0#2, fDFecha, "  ", 000000, 00000, "     ";
     #0#3, fHFecha, "zz", 999999, 99999, "zzzzz";
     ;
     NULL, Historico;
|FIN;

|PROCESO Fecha;
     nA¤o = #0#6;
     nMes = #0#0;
 ||    nMes = nMes - 1;
||     |SI nMes = 0; nMes = 12; nA¤o = nA¤o - 1; |FINSI;
     aAlfa = "01." + (("00" + nMes) % -102) + "." + (("0000" + nA¤o) % -104);
     fDFecha = aAlfa;
     aAlfa = "27." + (("00" + #0#1) % -102) + "." + (("0000" + #0#7) % -104);
     fHFecha = aAlfa;
     aMes = fHFecha % 402;
     |PARA; |SI; |HACIENDO;
          f = fHFecha + 1;
          aAlfa = f % 402;
          |SI aMes ! aAlfa; |SAL; |FINSI;
          fHFecha = f;
     |SIGUE;
     aAlfa = "0000Periodo:" + fDFecha + "-" + fHFecha;
     ||MENAV aAlfa;
|FPRC;

|PROCESO Tipo7; |TIPO 7;
     f = ~;
     aMes = f % 402;
     aA¤o = f % 704;
     |SI #0#0 ! 0; |ACABA; |FINSI;

     #0#0 = aMes; |PINTA #0#0;
     #0#1 = aMes; |PINTA #0#1;
     #0#6 = aA¤o; |PINTA #0#6;
     #0#7 = aA¤o; |PINTA #0#7;
|FPRC;

|PROCESO Tipo3; |TIPO 3;
     |IMPRE 0;
     |SI FSalida = 0;
          |INFOR "vigz0064";
          |SI FSalida = 0;
               |HAZ CreaTempo; |NOME_DAT #34 Tempo; |DELINDEX #34; aTmp34 = Tempo;
               |HAZ CreaTempo; |NOME_DAT #35 Tempo; |DELINDEX #35; aTmp35 = Tempo;
               |HAZ CreaTempo; |NOME_DAT #36 Tempo; |DELINDEX #36; aTmp36 = Tempo;
               |HAZ Fecha;
               |ABRE #36;
               |ABRE #34;
               |ABRE #35;
               |ABRE #7;
               |ABRE #24;
               |ABRE #19;
               |ABRE #134;
               |ABRE #10;
               |BUCLE Historico;
               |BUCLE Traspaso;
               |CIERRA #10;
               |CIERRA #134;
               |CIERRA #7;
               |CIERRA #35;
               |CIERRA #19;
               |ABRE #25;
               |SI #0#14 = 1; |BUCLE Tmp1; |FINSI;
               |SI #0#14 = 2; |BUCLE Tmp2; |FINSI;
               |SI #0#14 = 3; |BUCLE Tmp3; |FINSI;
               |CIERRA #25;
               |CIERRA #24;
               |CIERRA #34;
               |CIERRA #36;
               |PIEINF;
               |FININF;
               Tempo = aTmp34; |HAZ BoraTempo; |DELINDEX #34;
               Tempo = aTmp35; |HAZ BoraTempo; |DELINDEX #35;
               Tempo = aTmp36; |HAZ BoraTempo; |DELINDEX #36;
          |SINO;
               |MENAV "0000Error en informe 'vigz0064'";
          |FINSI;
          |FINIMP;
     |FINSI;
|FPRC;
