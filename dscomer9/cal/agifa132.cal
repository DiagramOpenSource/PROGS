|FICHEROS;
   agifa132 #0;
   agifa134 #1;
   agifa059 #2;
   agifa024 #3;
   agifa010 #4;
   agifa071 #5;
   agifa091 #6;
   agifa091 #10;
   dsz99984 #11
   agifa104 #12;
   agifa025 #14;
   agifa038 #13;
   agifa048 #15;
   agifa049 #16;
   agifa321 #321;
   agifa324 #324;
|FIN;

|VARIABLES;
     &enDirEnt = 0;

     &eaProg   = "";
     &nDeci_Base = 0;
     &nDeci_PreBase = 0;
     &eaCli    = "";
     &enTiva   = 0;
     &enIva    = 0;
     &enRec    = 0;
     &efFiva = @;

     nEuro = 0;
     aEuro = "";
     num = 0;
     importe = 0;
     resto = 0;
     i = 0;
     j = 0;
     a = 0;
     saltar = 0;
     indtope = 0;
     ind = 0;
     informe1 = "agifa134";
     informe2 = "agifa219";
     informe  = "";
     &iva1    = 0;
     &iva2    = 0;
     &iva3    = 0;
     &re1     = 0;
     &re2     = 0;
     &re3     = 0;
     &fechae  = @;

     &codigo="";
     &descrip=""
     &precio=0;
     &dto=0;
     &dto1=0;
     &unid=0;
     &imptot=0;
     &tiva=0;
     &linea=0;
     vacio="";

     lafecha = @;
     yaesta  = 1;
     &bl  = "                              ";
     n_copia   = 0 ;
|FIN;

|CALCULO leepago;|TIPO 0;
   |SI #10#0 ! #1#11;
      #10#0 = #1#11;
      |ABRE #10;
      |LEE 121#10=;
      |SI 0 ! FSalida;|DDEFECTO #10;|FINSI;
      |CIERRA #10;
   |FINSI;
|FCAL;

|CALCULO escanlinea;
  unid = #16#4 * #5#5;
  descrip = #16#3;
  codigo = "";
  dto = 0;
  precio = 0;
  imptot = 0;
  tiva = 0;
  linea = 1;
  |PRINT;
|FCAL;



|CALCULO imprelin;|TIPO 0;

   #12#0 = #5#12;
   |LEE 041#12=;


codigo=#5#2;
descrip=#5#4;
dto=#5#8;
dto1=#5#33;
precio=#5#6;
unid=#5#5;
imptot=#5#9;
tiva=#5#11;
linea=1;

   |PRINT;

|HAZ impdesam;

|ABRE #15;                 || Imprime las lineas de escandallos
   #15#0 = #5#2;
      |LEE 040#15=;
          |SI FSalida = 0;
               |BUCLELIN 0escanlinea#15;
          |FINSI;
|CIERRA #15;


|FCAL;

|CALCULO impdesam;|TIPO 0;
#13#0 = #5#27;
|ABRE #13;
|LEE 101#13=;
|SI 0=FSalida;
|HAZ xx;
|FINSI;
|LIBERA #13;
|CIERRA #13;
|FCAL;

|CALCULO xx;
indtope = 0
|PARA ind=6;|SI ind>0;|HACIENDO ind=ind-1;
descrip=#13ind;
|QBF descrip;
|SI descrip ! vacio;
indtope=ind+1;
ind=0
|FINSI;
|SIGUE;
|PARA ind=1;|SI ind<indtope;|HACIENDO ind= ind+1;
descrip=#13ind;
linea=0;|PRINT;|SIGUE;
|FCAL;

|CALCULO facimprl;|TIPO 0;
   |ABRE #12;
   #4#0 = #2#2;
   |LEE 021#4=;
   |SI 0 ! FSalida;
       |DDEFECTO #4;
   |SINO;
       |SI #3#42 = AS;
           |PRINT;
       |SINO;
           |BUCLELIN 2 imprelin #4;
       |FINSI;
   |FINSI;
   enDirEnt = #agifa010#84;
   |CIERRA #12;
|FCAL;

/********************************************

     NO SE LLAMA DESDE NINGUN SITIO


|CALCULO llenarec;
     |HAZ leepago;
     num = #10#3;
     |DDEFECTO #11;
     #11#0 = #1#0;
     ||importe = #1#31 - #1#32;
     importe = #1#31;
     importe = importe ! nDeci_Base;
     aEuro = "0" * nDeci_Base;
     aEuro = "1" + aEuro;
     nEuro = aEuro;
     importe = (importe * nEuro) ! 0;

     resto = importe $ num;
     importe = importe / num;
     importe = importe ! 0;

     |HAZ AbreRecVenta;

     |PARA i = 0;|SI i < num;|HACIENDO i = i + 1;
          |SI i < 13;
               j = 33 + i;
               #11#9 = #1j;
          |SINO;
               #11#9 = importe;
               a = num - resto;
               |SI i ] a;
                    #11#9 = #11#9 + 1;
               |FINSI;
          |FINSI;
          #11#9 = #11#9 / nEuro;
          #11#7 = #1#1;
          j = i + 6;j = #10j;
          |SI #10#5 = AS;
               j = j / 1000;
          |FINSI;
          #11#8 = #11#7 + j;
          saltar = 0;
          |PARA yaesta = 0;|SI yaesta = 0;|HACIENDO;
               Adia = #11#8 % 102;
               |SI #3#22 > 0;
                    saltar = 1;
                    |SI #3#22 ] Adia;
                         saltar = 2;
                         Adia = A0 + #3#22;
                         Adia = Adia % -102;
                    |FINSI;
               |FINSI;
               |SI #3#23 > 0;|Y saltar < 2;
                    saltar = 1;
                    |SI #3#23 ] Adia;
                         saltar = 2;
                         Adia = A0 + #3#23;
                         Adia = Adia % -102;
                    |FINSI;
               |FINSI;
               |SI #3#24 > 0;|Y saltar < 2;
                    saltar = 1;
                    |SI #3#24 ] Adia;
                         saltar = 2;
                         Adia = A0 + #3#24;
                         Adia = Adia % -102;
                    |FINSI;
               |FINSI;
               |SI saltar = 1;
                    #11#8 = #11#8 + 0.001;
                    saltar = 2;
                    Adia = A0 + #3#22;
                    Adia = Adia % -102;
               |FINSI;
               |SI saltar = 2;
                    Af = #11#8 % 308;
                    Af = Adia + Af;
                    #11#8 = Af;
               |FINSI;
               Ames = #11#8 % 402;
               |SI #3#21 = Ames;
                    #11#8 = #11#8 + 0.001;
               |FINSI;
               lafecha = #11#8 + 0.000;
               |SI #11#8 = lafecha;
                    yaesta = 1;
               |SINO;
                    #11#8 = lafecha + 1;
               |FINSI;
          |SIGUE;
          #11#1 = i + 1;
          #11#2 = #1#2;
          #11#3 = #1#3;
          #11#4 = #1#9;
          #11#12 = #1#12;
          #11#24 = #6#0;
          #11#25 = #6#1;
          eaProg = "agifa134";
          ||HAZ CreaRecVenta;
          |HAZ RecVenta;
     |SIGUE;
     |HAZ CierraRecVenta;
|FCAL;
***********************************************************/
|CALCULO facimpr2;

   |PIEINF;

   |SI #1#45 = AN;
       #1#45 = AS;
       |GRABA 020#1a;
   |FINSI;
|FCAL;

|PROCESO IVAS;
     eaCli = #1#2;
     efFiva = #1#1;
     enTiva = 1; |HAZ IVACli; iva1 = enIva; re1 = enRec;
     enTiva = 2; |HAZ IVACli; iva1 = enIva; re1 = enRec;
     enTiva = 3; |HAZ IVACli; iva1 = enIva; re1 = enRec;
     enTiva = 4; |HAZ IVACli; iva1 = enIva; re1 = enRec;
     enTiva = 5; |HAZ IVACli; iva1 = enIva; re1 = enRec;
|FPRC;

|CALCULO facimpr1;
     |HAZ IVAS;
     |SI #3#0 ! #1#2;
         #3#0 = #1#2;
         |LEE 041#3=;
         |SI 0 ! FSalida;|DDEFECTO #3;|FINSI;
     |FINSI;

     |ABRE #13;
     |DDEFECTO #13;
     #13#0 = #1#7;
     |LEE 000#13=;
     |CIERRA #13;

     |SI #3#42 = AS;
         informe = informe2;
     |SINO;
         informe = informe1;
     |FINSI;
     |INFOR informe;


     |SI 0 = FSalida;
         |SI #6#0 ! #1#11;
            |ABRE #6;
            #6#0 = #1#11;
            |LEE 021#6=;
            |SI 0 ! FSalida;|DDEFECTO #6;|FINSI;
            |CIERRA #6;
         |FINSI;
         |BUCLELIN 0 facimprl #1;
         |HAZ facimpr2;
         |PARA n_copia = 0; |SI n_copia < #3#44; |HACIENDO n_copia = n_copia + 1;
               |BUCLELIN 0 facimprl #1;
               |PIEINF;
         |SIGUE;
         |FININF;
     |FINSI;
|FCAL;




|DEFBUCLE agifa5340;
   #1#1;
   2,1,45,31;
   "     " , #0#2 , #0#0 ,  #0#4 ,  #0#6 ,  #0#7;
   "zzzzz" , #0#3 , #0#1 ,  #0#5 ,  #0#6 ,  #0#8;
   e;
   NULL, facimpr1,NULL,NULL;
|FIN;

|CALCULO facimpr;|TIPO 3;
   |ABRE #5;
   |ABRE #4;
   |ABRE #3;
   |IMPRE 2;
   |SI 0 = FSalida;
       |BUCLE agifa5340;
       |FINIMP;
   |FINSI;
   |CIERRA #3;
   |CIERRA #4;
   |CIERRA #5;
|FCAL;

|CALCULO &vencimi;|TIPO 0;
   Ames = fechae % 402;
   |SI #3#21 = Ames;
       fechae = fechae + 0.001;
   |FINSI;
   Adia = fechae % 102;
   saltar = 0;
   |SI #3#22 > 0;
       saltar = 1;
       |SI #3#22 ] Adia;
           saltar = 2;
           Adia = A0 + #3#22;
           Adia = Adia % -102;
       |FINSI;
   |FINSI;
   |SI #3#23 > 0;|Y saltar < 2;
       saltar = 1;
       |SI #3#23 ] Adia;
           saltar = 2;
           Adia = A0 + #3#23;
           Adia = Adia % -102;
       |FINSI;
   |FINSI;
   |SI #3#24 > 0;|Y saltar < 2;
       saltar = 1;
       |SI #3#24 ] Adia;
           saltar = 2;
           Adia = A0 + #3#24;
           Adia = Adia % -102;
       |FINSI;
   |FINSI;
   |SI saltar = 1;
       fechae = fechae + 0.001;
       saltar = 2;
       Adia = A0 + #3#22;
       Adia = Adia % -102;
   |FINSI;
   |SI saltar = 2;
       Af = fechae % 308;
       Af = Adia + Af;
       fechae = Af;
   |FINSI;
|FCAL;

|PROCESO LeeDecimBase; |TIPO 8;
     |ABRE #agifa321;
     |ABRE #agifa324;
     |LEE 001#agifa321.p;
     #agifa324#0 = #agifa321#9; ||Igualo a moneda base
     |LEE 001#agifa324.=;
     nDeci_Base = #agifa324#7;  ||Decimales moneda base
     nDeci_PreBase = #agifa324#9;  ||Decimales precio de moneda base
     |CIERRA #agifa321;
     |CIERRA #agifa324;
|FPRC;
