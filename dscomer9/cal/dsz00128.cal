|FICHEROS;
     dsz00128 #0;
     agifa084 #84;
     agifa134 #134;
     agifa142 #142;
     dsm00153 #153;
|FIN;

|VARIABLES;
     &enError = 0;
     aAlfa = "";
|FIN;

|PROCESO Factura0; |TIPO 0;
     |SI #0#0 = "D";
          |ABRE #84;
          #84#48 = #0#1;
          #84#0 = #0#2;
          |LEE 000#84=;
          |SI FSalida ! 0;
               |MENAV "0000No existe codigo de factura...";
               |ERROR;
          |FINSI;
          |CIERRA #84;
     |SINO;
          |ABRE #134;
          #134#49 = #0#1;
          #134#0 = #0#2;
          |LEE 000#134=;
          |SI FSalida ! 0;
               |MENAV "0000No existe codigo de factura...";
               |ERROR;
          |FINSI;
          |CIERRA #134;
     |FINSI;
|FPRC;

|PROCESO Factura66; |TIPO 66;
     |SI #0#0 = "D";
          |ABRE #84;
          #84#48 = #0#1;
          #84#0 = #0#2;
          |LEE 000#84];
          |CONSULTA_CLAVE #1#84;
          |SI FSalida = 0;
               #0#1 = #84#48; |PINTA #0#1;
               #0#2 = #84#0; |PINTA #0#2;
          |SINO;
               |ERROR;
          |FINSI;
          |CIERRA #84;
     |SINO;
          |ABRE #134;
          #134#49 = #0#1;
          #134#0 = #0#2;
          |LEE 000#134];
          |CONSULTA_CLAVE #1#134;
          |SI FSalida = 0;
               #0#1 = #134#49; |PINTA #0#1;
               #0#2 = #134#0; |PINTA #0#2;
          |SINO;
               |ERROR;
          |FINSI;
          |CIERRA #134;
     |FINSI;
|FPRC;

|PROCESO Tipo3; |TIPO 3;
     |ABRE #142; |LEE 000#142p; |CIERRA #142;

     |ABRE #153;
     #153#0 = #0#0;
     #153#1 = #0#1;
     #153#2 = #0#2;
     |LEE 000#153=;
     |SI FSalida = 0;
          aAlfa = "0000Ya existe una factura de abono:" +&13 + #153#6 + "/" + (("000000"+#153#7)%-106);
          |MENAV aAlfa;
     |SINO;
          |SI  #0#0 = "D";
               |ABRE #84;
               #84#48 = #0#1;
               #84#0 = #0#2;
               |LEE 020#84=;
               |SI FSalida = 0;
                    #153#3 = #84#1;
                    #153#4 = #84#3;
                    #153#5 = #84#4;
                    |GRABA 020#153b;
                    |HAZ FacDirec;
                    |SI enError = 0;
                         |LIBERA #84;
                         aAlfa = "dsz99889;" + #84#48 + (("000000" + #84#0) % -106);
                         |SUB_EJECUTA_NP aAlfa;
                    |SINO;
                         |BORRA 020#153c;
                    |FINSI;
               |FINSI;
               |CIERRA #84;
          |SINO;
               |ABRE #134;
               #134#49 = #0#1;
               #134#0 = #0#2;
               |LEE 020#134=;
               |SI FSalida = 0;
                    #153#3 = #134#1;
                    #153#4 = #134#2;
                    #153#5 = #134#3;
                    |GRABA 020#153b;
                    |HAZ FacVenta;
                    |SI enError = 0;
                         |LIBERA #134;
                         aAlfa = "dsz99888;" + #134#49 + (("000000" + #134#0) % -106);
                         |SUB_EJECUTA_NP aAlfa;
                    |SINO;
                         |BORRA 020#153c;
                    |FINSI;
               |FINSI;
               |CIERRA #134;
          |FINSI;
     |FINSI;
     |CIERRA #153;
|FPRC;
