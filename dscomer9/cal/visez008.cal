|FICHEROS;
     visez008 #0;
     visew003 #3; ||Tmp
     visew004 #4; ||Tmp
     visem007 #7; ||Produccion C
     visem008 #8; || ''        L
     visem010 #10; ||Peso Arti
     visem011 #11;
     gopartia #100;
|FIN;

|VARIABLES;
     &Tempo = "";
     nHay = 0;
     fFecha = @;
     aAlfa = "";
     aTmp3 = "";
     aTmp4 = "";
     fDFecha = @;
     fHFecha = @;
     aSerie = "";
     aD = "";
     aH = "";
     nAlmacen = -1;
|FIN;

|PROCESO Imprime0;
     |SI #4#2 ! nAlmacen; |Y nAlmacen  ! -1;
          |PIEINF;
     |FINSI;
     nAlmacen = #4#2;
     |PRINT;
     nHay = 1;
|FPRC;

|DEFBUCLE Imprime0;
     #3#2;
     ;
     #4#0, #4#1, #4#2, aD;
     #4#0, #4#1, #4#2, aH;
     ;
     NULL, Imprime0;
|FIN;

|PROCESO Imprime;
     |BUCLE Imprime0;
|FPRC;

|DEFBUCLE Imprime;
     #4#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Imprime;
|FIN;

|PROCESO visew003_1;
     |DDEFECTO #4;
     #4#0 = #3#0;
     #4#1 = #3#1;
     #4#2 = #3#3;
     |LEE 000#4=;

     #3#9 = #4#7 / #4#3 * #3#5;
     #3#10 = #4#8 / #4#4 * #3#6;
     #3#11 = #4#9 / #4#5 * #3#7;
     #3#12 = #3#9 + #3#10 + #3#11;

     |GRABA 020#3a;
     |LIBERA #3;
|FPRC;

|DEFBUCLE visew003_1;
     #3#1;
     ;
     INICIO;
     FINAL;
     be;
     NULL, visew003_1;
|FIN;

|PROCESO gopartia;
     |SI #100#34 = "C";
          #4#9 = #4#9 + #100#25; || Coste Otros
     |FINSI;
     |SI #100#34 = "T";
          #4#8 = #4#8 + #100#25; || Coste Mano Obra
     |FINSI;
|FPRC;

|DEFBUCLE gopartia;
     #100#3;
     28;
     aSerie, 000001, "     ", 000001, aD, aD, fDFecha;
     aSerie, 999999, "zzzzz", 999999, aH, aH, fHFecha;
     ;
     NULL, gopartia;
|FIN;

|PROCESO visem011;
     aSerie = #11#1;
     |BUCLE gopartia;
|FPRC;

|DEFBUCLE visem011;
     #11#1;
     ;
     #4#2, "     ";
     #4#2, "zzzzz";
     ;
     NULL, visem011;
|FIN;

|PROCESO visew004;
     |BUCLE visem011;
     #4#8 = #4#8 / 100 * #11#2;
     #4#9 = #4#9 / 100 * #11#2;
     |GRABA 020#4a;
     |LIBERA #4;
|FPRC;

|DEFBUCLE visew004;
     #4#1;
     ;
     INICIO;
     FINAL;
     be;
     NULL, visew004;
|FIN;

|PROCESO visew003;
     |DDEFECTO #10;
     #10#0 = #3#2;
     |LEE 000#10=;

     #3#5 = #10#1 * #3#4;
     #3#6 = #10#2 * #3#4;
     #3#7 = #10#3 * #3#4;
     #3#8 = #3#5 + #3#6 + #3#7;
     |GRABA 020#3a;
     |LIBERA #3;

     |DDEFECTO #4;
     #4#0 = #3#0;
     #4#1 = #3#1;
     #4#2 = #3#3;
     |LEE 101#4=;
     |SI FSalida ! 0; |GRABA 020#4b; |FINSI;
     #4#3 = #4#3 + #3#5;
     #4#4 = #4#4 + #3#6;
     #4#5 = #4#5 + #3#7;
     #4#6 = #4#6 + #3#8;
     |GRABA 020#4a;
     |LIBERA #4;
|FPRC;

|DEFBUCLE visew003;
     #3#1;
     ;
     INICIO;
     FINAL;
     be;
     NULL, visew003;
|FIN;

|PROCESO visem008;
     |SI #8#2 = "FB";    || Entrada
          |DDEFECTO #3;
          #3#0 = #0#0;
          #3#1 = #0#1;
          #3#2 = #8#4;
          #3#3 = #7#2;
          |LEE 101#3=;
          |SI FSalida ! 0; |GRABA 020#3b; |FINSI;
          #3#4 = #3#4 + #8#6; ||Fabricadas
          |GRABA 020#3a;
          |LIBERA #3;
     |SINO;              || Salida
          |DDEFECTO #4;
          #4#0 = #0#0;
          #4#1 = #0#1;
          #4#2 = #7#2;
          |LEE 101#4=;
          |SI FSalida ! 0; |GRABA 020#4b; |FINSI;
          #4#7 = #4#7 + (#8#6 * #8#7); ||Coste Materiales
          |GRABA 020#4a;
          |LIBERA #4;
     |FINSI;
|FPRC;

|DEFBUCLE visem008;
     #8#1;
     ;
     #7#0, #7#1, "  ", 001;
     #7#0, #7#1, "zz", 999;
     ;
     NULL, visem008;
|FIN;

|PROCESO visem007;
     |BUCLE visem008;
|FPRC;

|DEFBUCLE visem007;
     #7#2;
     ;
     fDFecha;
     fHFecha;
     ;
     NULL, visem007;
|FIN;

|PROCESO Tipo7; |TIPO 7;
     fFecha = ~;
     aAlfa = fFecha % -104;
     #0#0 = aAlfa; |PINTA #0#0;
     aAlfa = fFecha % 402;
     #0#1 = aAlfa; |PINTA #0#1;
|FPRC;

|PROCESO Tipo3; |TIPO 3;
     |HAZ CreaTempo; aTmp3 = Tempo; |NOME_DAT #3#Tempo#; |DELINDEX #3;
     |HAZ CreaTempo; aTmp4 = Tempo; |NOME_DAT #4#Tempo#; |DELINDEX #4;

     aAlfa = "01." + (("00" + #0#1) % -102) + "." + (("0000" + #0#0) % -104);
     fDFecha = aAlfa;
     |PARA fFecha = fDFecha; |SI; |HACIENDO fFecha = fFecha + 1;
          aAlfa = fFecha % 402;
          |SI aAlfa ! #0#1; |SAL; |FINSI;
          fHFecha = fFecha;
     |SIGUE;
     aD = " " * 20;
     aH = "z" * 20;

     |IMPRE 0;
     |SI FSalida = 0;
          |INFOR "visez008";
          |SI FSalida ! 0;
               |MENAV "0000No existe informe 'visez008'";
          |SINO;
               |ABRE #3;
               |ABRE #4;
               |BUCLE visem007; ||1
               |CIERRA #3;
               |CIERRA #4;

               |ABRE #10;
               |ABRE #4;
               |BUCLE visew003; ||2,3
               |CIERRA #4;
               |CIERRA #10;

               |ABRE #11;
               |BUCLE visew004; ||4
               |CIERRA #11;

               |ABRE #4;
               |BUCLE visew003_1; ||5
               |CIERRA #4;

               |BUCLE Imprime;
               |SI nHay ! 0; |PIEINF; |FINSI;
               |FININF;
          |FINSI;
          |FINIMP;
     |FINSI;

     Tempo = aTmp3; |HAZ BoraTempo; |DELINDEX #3;
     Tempo = aTmp4; |HAZ BoraTempo; |DELINDEX #4;
|FPRC;
