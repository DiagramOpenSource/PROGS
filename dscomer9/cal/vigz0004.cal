|FICHEROS;
     vigz0004 #0;
     vigm0006 #6;
     vigm0007 #7;
     agifa010 #10;
     agifa024 #4;
     agifa071 #71;
     agifa104 #104;
     agifa073 #73;
     agifa019 #19;
     agifa024 #24;
     agifa142 #142;
     vigm0048 #8;
|FIN;

|INCLUYE i_varart;

|VARIABLES;
     nForma = 1;
     aAlfa = "";
     &eaTag = "";
     i = 0;
     cant = 0;
     importe = 0;
     mes = 0;
     fmes = "";
     nImpo = 0;
|FIN;

|PROCESO FinCabAlb;
     |SI #10#15 ] 0;
          importe = 1;
     |SINO;
          importe = -1;
          #10#15 = -#10#15;
     |FINSI;
     cant = #10#15 < #10#5;
     cant = cant < #10#32;
     cant = cant < #10#7;
     cant = cant * importe;
     #10#15 = #10#15 * importe;
     |ABRE #4;
     #4#0 = #10#3;
     |LEE 121#4=;
     |SI FSalida = 0;
        |SI #10#43 = AN;
           #4#50 = #4#50 +. cant;    || es albaran
        |SINO;
           #4#50 = #4#50 -. cant;    || es abono
        |FINSI;
        |GRABA 020#4a;
        |LIBERA #4;
     |FINSI;
     |CIERRA #4;

     |SI #10#43 = "N";
          enImpCliPen = cant;
     |SINO;
          enImpCliPen =  -cant;
     |FINSI;
     eaCliente = #10#3;
     efFecha = #10#1;
     |HAZ AcumulaCli;

     eaTag = "AV";  |HAZ Riesgos;
|FPRC;

|PROCESO LinAlb;
     |PARA i = 0; |SI i [ 62; |HACIENDO i = i + 1;
          #71i = #7i;
     |SIGUE;
     enForma = 1;
     |HAZ AcumulaAV;
     #71#14 = enCoste;
     |GRABA 020#71n;
|FPRC;

|PROCESO CabAlb;
     |PARA i = 0; |SI i [ 94; |HACIENDO i = i + 1;
          #10i = #6i;
     |SIGUE;
     #10#97 = #6#101;
     |SI #10#2 ! 0;
          #8#0 = #10#52;
          #8#1 = #10#0;
          |LEE 101#8=;
          |SI FSalida ! 0; |GRABA 020#8b; |FINSI;
          #8#2 = #6#96;
          #8#3 = #6#97;
          #8#4 = #6#98;
          #8#5 = #6#99;
          #8#6 = #6#100;
          |GRABA 020#8a;
          |LIBERA #8;
     |FINSI;
     |GRABA 000#10n;
     |SI FSalida ! 0;
          aAlfa = "0000Albaran:" + #10#52 + "/" + #10#0 + ", existente...";
          |MENAV aAlfa;
          |ERROR;
     |SINO;
          #6#95 = "A";
          |GRABA 020#6a;
     |FINSI;
     |LIBERA #6;
|FPRC;

|DEFBUCLE vigm0006_Alb;
     #6#3;
     95;
     #0#6, #0#4, #0#0, #0#2, "N";
     #0#7, #0#5, #0#1, #0#3, "N";
     be;
     NULL, CabAlb, LinAlb, FinCabAlb;
|FIN;

|PROCESO FinCabPed;
     |HAZ CalCabAgifa104;
     |GRABA 020#104a;
     |LIBERA #104;
|FPRC;

|PROCESO LinPed;
     #73#28 = #104#25;
     #73#0 = #104#0;
     #73#1 = #7#1;
     #73#2 = #7#2;
     #73#3 = #7#3;
     #73#4 = #7#4;
     #73#5 = #7#5;
     #73#6 = #7#6;
     #73#7 = #7#7;
     #73#8 = #7#8;
     #73#9 = #7#9;
     #73#10 = #7#10;
     #73#13 = #104#2;
     #73#14 = #7#11;
     #73#16 = #104#7;
     #73#17 = #7#16;
     #73#18 = #7#13;
     #73#19 = #7#17;
     #73#20 = #104#4;
     #73#23 = #104#5
     #73#24 = #104#6
     #73#25 = #104#17;
     #73#26 = #104#9;
     #73#27 = #7#27;
     #73#29 = #7#33;
     #73#35 = #7#34;
     #73#36 = #7#35;
     #73#40 = #7#38;
     #73#42 = #73#5;
     #73#43 = 0;
     #73#44 = #7#48;
     #73#45 = #7#49;
     #73#46 = #7#50;
     #73#47 = 0;
     #73#48 = #7#44;
     #73#44 = 0;
     #73#50 = #7#51;
     #73#51 = #7#52;
     #73#52 = #7#53;
     #73#54 = #7#62;
     |GRABA 020#73n;
     |SI FSalida = 0;
          enForma = 1;
          |HAZ AcumulaPV;

          #19#0 = #73#2;
          |LEE 020#19=;

          #24#0 = #104#4;
          |LEE 121#24=;
          |SI FSalida = 0;
               |SI #19#194 = 2;
                    nImpo = ((((#73#44 * #73#6) < #73#8) < #73#29) < #104#5) < #104#17;
               |SINO;
                    nImpo = ((((#73#5 * #73#6) < #73#8) < #73#29) < #104#5) < #104#17;
               |FINSI;
               |SI #142#115 = "S";
                    nImpo = nImpo < #104#6;
               |FINSI;
               nImpo = nImpo * nForma;
               fmes = #104#1 % A402;
               mes = fmes - 1;
               mes = mes * 3;
               mes = mes + 114;
               #24mes = #24mes   + nImpo;     || VENTA.
               #24#150 = #24#150 + nImpo;
               |GRABA 020#24a;

               eaCliente = #104#4;
               efFecha = #104#1;
               enImpCliPed = nImpo;
               |HAZ AcumulaCli;
               |LIBERA #24;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO CabPed;
     |DDEFECTO #104;
     #104#25 = #6#52;
     #104#0 = #6#0;
     |GRABA 101#104b;
     |SI FSalida ! 0;
          aAlfa = "0000Pedido:" + #104#25 + "/" + #104#0 + ", existente...";
          |MENAV aAlfa;
          |ERROR;
     |SINO;
          #104#1 = #6#1;
          #104#2 = #6#1;
          #104#4 = #6#3;
          #104#5 = #6#5;
          #104#6 = #6#7;
          #104#7 = #6#6;
          #104#8 = #6#4;
          #104#9 = #6#8;
          #104#14 = #6#30;
          #104#16 = #6#34;
          #104#17 = #6#32;
          #104#18 = #6#35;
          #104#19 = #6#29;
          #104#20 = #6#31;
          #104#21 = #6#33;
          #104#22 = #6#36;
          #104#23 = #6#40;
          #104#35 = #6#68;
          #104#36 = #6#69;
          #104#37 = #6#70;
          #104#40 = #6#73;
          #104#41 = #6#74;
          #104#51 = #6#83;
          #104#56 = #6#87;
          #104#57 = #6#84;
          #104#59 = #6#62;
          #104#60 = #6#88;
          #104#61 = #6#64;
          #104#62 = #6#1;
          #104#63 = #6#94;
          |GRABA 020#104a;

          #6#95 = "P";
          |GRABA 020#6a;
     |FINSI;
     |LIBERA #6;
|FPRC;

|DEFBUCLE vigm0006_Ped;
     #6#3;
     95;
     #0#6, #0#4, #0#0, #0#2, "N";
     #0#7, #0#5, #0#1, #0#3, "N";
     be;
     NULL, CabPed, LinPed, FinCabPed;
|FIN;

|PROCESO Tipo3; |TIPO 3;
     |ABRE #142; |LEE 000#142p; |CIERRA #142;
     |SI #0#8 = "A";
          |ABRE #10;
          |ABRE #71;
          |ABRE #8;
          |BUCLE vigm0006_Alb;
          |CIERRA #8;
          |CIERRA #71;
          |CIERRA #10;
     |SINO;
          |ABRE #104;
          |ABRE #73;
          |ABRE #19;
          |ABRE #24;
          |BUCLE vigm0006_Ped;
          |CIERRA #24;
          |CIERRA #19;
          |CIERRA #73;
          |CIERRA #104;
     |FINSI;
|FPRC;
