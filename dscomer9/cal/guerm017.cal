|FICHEROS;
     guerm017 #0;
     guerm018 #18;
     guerm019 #9;    ||Elementos/art. (CAB)
     guerm020 #1020; ||Elementos/art. (LIN)
     guerm021 #21;   ||Tmp. Articulo/Elem.
     guerm022 #22;   ||Tarifas Transporte

     gotrabaj #10;  ||Trabajadores (aka conductores)
     gocatcon #20;  ||Categorias Convenio
     goparame #100; ||Parametros
     agifa024 #7;   ||Clientes

     gomantho #1003;||Construccion Hor.(C)
     gomantl1 #4;   ||Construccion Hor.(L)
     gocatcot #19,MANTE; ||Categorias Tipos Hor
     goalbpa7 #14;  ||Tmp Adj Partida
     agifa019 #1019;||Articulos

     gopre001 #8;   ||Presupuestos
     gopre002 #16;  ||Presup. Capitulos
     gopre003 #3;   ||Presup. Partidas
     gopre004 #15;  ||Presup. Productos
     guerm029 #29;
     gopre001@ #200;
     guerm048;
     guerm018@;
     gotrabat #30,MANTE;
     gotipoho #101;
     guerm053 #53;
     guerm054 #54;
|FIN;

|VARIABLES;
     &enSubCon = 0;
     &eaSerExp1 = "";     || Llamado por guerz086
     &enNumExp1 = 0;      || ''
     &eaSerPre1 = "";     || ''
     &enNumPre1 = 0;      || ''
     aEstaCerti = "";
     aDes = "";
     aTip = "";
     nCuantos = 0;
     nPreVta = 0;
     nPreCos = 0;
     nSwTari = 0;

     &eaPrograma = "";
     &enConductor = 0;
     nModoCab = 0;
     &enForma = 0;
     &enTraba = 0;
     aMes = "";
     aA¤o = "";
     nPCoste = 0;
     nPVenta = 0;
     nLin = 0;
     nForma = 0;
     &eaSerExp = "";
     &enNumExp = 0;
     aDef = "";
     aAlfa = "";
     &efFecha       = @;

     &eaEle         = "";
     &efFec         = @;
     &enDoc         = 0;
     &enLin         = 0;

     &eaSerPre      = "";
     &enNumPre      = 0;
     &eaCapi        = "";
     &eaParti       = "";
     &eaDesPa       = "";

     nSwAct    = 0;
     nExiste = 0;
     aMensaje = "";
     &EURODB = 0;
     &nDeci_PBase = 0;
     &nDeci_PreBase = 0;
     &nDeci_PreDiv = 0;

     nBotTipos = 0;
     nBotArt = 0;
     nSalida = 0;

     nBotF20 = 0;
     nBotF21 = 0;
     nBotF30 = 0;

     aTipoArt = "";
     nHay = 0;
     i              = 0;
     &Tempo         = "";
     aTempo14       = "";
     aTempo21       = "";
     nModo = 0;
     nSwAltaCab = 0;
     aCP = "";
     aCP1 = "";
     aCP2 = "";
     aArt = "";
|FIN;

|PROCESO CtrlFec; |TIPO 0;
     nModo = (FEntrada /100) ! 0;

     ||ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄControl Cierre
     efFecha = #0#1;
     |HAZ EstaCerrado;
     |SI FSalida = 0;
          |ERROR; |ACABA;
     |FINSI;
     ||ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
     |HAZ EsGuerola;
     |SI FSalida = 0;
     |FINSI;
|FPRC;

|PROCESO Estado; |TIPO 6;
     nModo = (FEntrada/100) ! 0;
     |SI nModo = 1;
          nSwAltaCab = 1;
     |SINO;
          nSwAltaCab = 0;
     |FINSI;
|FPRC;

|PROCESO MiraAct;
     |SI #18#22 = "S";
          |ERROR10;
          nSwAct = 1;
     |FINSI;
|FPRC;

|PROCESO ActuaParte;
     |SI nForma = 1; |Y #18#8 = "S";
          |ACABA; || Esta certificado
     |FINSI;
     eaEle = #18#0;
     efFec = #18#1;
     enDoc = #18#2;
     enLin = #18#3;
     enForma = nForma;
     eaPrograma = "guerm017";
     enConductor = #0#3;
     |SUB_EJECUTA_NP "guerw013";
|FPRC;

|PROCESO CheqParte;
     eaEle = #18#0;
     efFec = #18#1;
     enDoc = #18#2;
     enLin = #18#3;
     enForma = nForma;
     eaPrograma = "guerm017";
     enConductor = #0#3;
     |SUB_EJECUTA_NP "guerw013;CHEQUEA";
     |LEE 020#18=;
     |SI #18#8 = "S";
          aEstaCerti = "S";
          |ERROR10;
     |FINSI;
|FPRC;

|PROCESO Tipo2Cab; |TIPO 2;
     nModoCab = (FEntrada / 100) ! 0;
     nForma = 0 +. 1;
     |SI nModoCab = 3;
          aEstaCerti = "";
          |BUCLELIN 2CheqParte#0;
          |SI aEstaCerti = "S";
               |MENAV "0000Hay registros cetificados..";
               |ERROR; |ACABA;
          |FINSI;
     |FINSI;
     |BUCLELIN 2ActuaParte#0;
|FPRC;

|PROCESO Tipo2Lin; |TIPO 2;
     |ABRE #100; |LEE 000#10p; |CIERRA #100;
     nModo = (FEntrada / 100) ! 0;
     nForma = 0 +. 1;

     |SI nModo = 1; nModoCab = 1; |FINSI;

     |SI #18#8 = "S"; |Y nModo ! 1;
          |SI nForma = -1;
               |MENAV "0000Linea certificada, no se puede modificar.";
          |FINSI;
          |ERROR; |ACABA;
     |FINSI;

     |SI #18#30 = -1; |Y nModoCab ! 3;
          |SI nForma = -1;
               aAlfa = "0000Linea automatica, no se puede modificar.";
               |MENAV aAlfa;
          |FINSI;
          |ERROR; |ACABA;
     |FINSI;

     |SI #18#22 = "S"; |Y nModo ! 3;
          |SI nForma = -1;
               |MENAV "0000Linea Actualizada...";
          |FINSI;
          |ERROR; |ACABA;
     |FINSI;

     #0#6 = #0#6 +. #18#5;
     #0#7 = #0#7 +. #18#7;
     #0#13 = #0#13 +. #18#20;

     |SI nForma = 1;
          #18#31 = enSubCon;
     |FINSI;

     |HAZ EsGuerola;
     |SI FSalida = 0;
          |HAZ CosteTraba;
     |FINSI;

     |ABRE #1020;
     #1020#0 = #0#0;
     #1020#1 = #18#17;
     |LEE 000#1020=;
     |CIERRA #1020;

     ||||SI #18#25 = "M"; |Y #1020#3 ! #goparame#5; |Y #goparame#103 = "S";

     |SI #1020#3 ! #goparame#5; |Y #goparame#103 = "S";
          |Y nModoCab ! 3;
          || Crea /Borra linea automatica
          |DDEF aAlfa; aAlfa = aAlfa + "guerm018";
          |CARGA_DEF aAlfa, guerm018@;
          |SI FSalida = 0;
               |ABRE #guerm018@;
               |SI nForma = -1;
                    #guerm018@#0 = #18#0;
                    #guerm018@#1 = #18#1;
                    #guerm018@#2 = #18#2;
                    #guerm018@#3 = #18#30;
                    |LEE 101#guerm018@.=;
                    |SI FSalida = 0;
                         |BORRA 020#guerm018@.a;
                         ||#0#6 = #0#6 - #guerm018@#5;
                         ||#0#7 = #0#7 - #guerm018@#7;
                         ||#0#13 = #0#13 - #guerm018@#20;
                    |FINSI;
               |SINO;
                    |DDEFECTO #10;
                    |ABRE #10;
                    #10#0 = #0#3;
                    |LEE 000#10=;
                    |CIERRA #10;
                    |DDEFECTO #20;
                    |ABRE #20;
                    #20#0 = #10#3;
                    #20#1 = #10#2;
                    |LEE 000#20=;
                    |CIERRA #20;
                    |DDEFECTO #8;
                    |ABRE #8;
                    #8#0 = #18#12;
                    #8#1 = #18#13;
                    |LEE 000#8=;
                    |CIERRA #8;

                    nPCoste = 0;
                    nPVenta = 0;
                    |ABRE #30;
                    #30#0 = #0#3;
                    #30#2 = #18#9;
                    |LEE 000#30=;
                    |SI FSalida = 0;
                         |SI #8#18 = "P";
                              nPCoste = #30#5; nPVenta = #30#4;
                         |FINSI;
                         |SI #8#18 = "A";
                              nPCoste = #30#7; nPVenta = #30#6;
                         |FINSI;
                         |SI #8#18 = "E";
                              nPCoste = #30#9; nPVenta = #30#8;
                         |FINSI;
                    |FINSI;
                    |CIERRA #30;
                    |SI nPCoste = 0; |Y nPVenta = 0;
                         |ABRE #19;
                         #19#0 = #10#3;
                         #19#1 = #10#2;
                         #19#2 = #18#9;
                         |LEE 000#19=;
                         |SI FSalida = 0;
                              |SI #8#18 = "P";
                                   nPCoste = #19#5; nPVenta = #19#4;
                              |FINSI;
                              |SI #8#18 = "A";
                                   nPCoste = #19#7; nPVenta = #19#6;
                              |FINSI;
                              |SI #8#18 = "E";
                                   nPCoste = #19#9; nPVenta = #19#8;
                              |FINSI;
                         |FINSI;
                         |CIERRA #19;
                    |FINSI;

                    |SI nModo = 1; |O #18#30 [ 0;
                         #guerm018@#0 = #18#0;
                         #guerm018@#1 = #18#1;
                         #guerm018@#2 = #18#2;
                         #guerm018@#3 = 999;
                         |LEE 000#guerm018@.];
                         |SI FSalida = 0;
                              |LEE 000#guerm018@.a;
                         |SINO;
                              |LEE 000#guerm018@.u;
                         |FINSI;
                         |SI FSalida = 0; |Y #guerm018@#0 = #18#0;
                                   |Y #guerm018@#1 = #18#1;
                                   |Y #guerm018@#2 = #18#2;
                              nLin = #guerm018@#3 + 1;
                         |SINO;
                              nLin = 1;
                         |FINSI;
                         |SI nLin = #18#3; nLin = #18#3 + 1; |FINSI;
                    |SINO;
                         nLin = #18#30;
                    |FINSI;
                    |SALVA_DATOS #18;
                    |REPON_DATOS #guerm018@;
                    #guerm018@#3 = nLin;
                    #guerm018@#30 = -1;
                    #guerm018@#17 = #20#13;
                    #guerm018@#16 = nPCoste;
                    #guerm018@#6 = nPVenta;
                    #guerm018@#7 = (#guerm018@#5 * #guerm018@#16) + (#guerm018@#20 * #guerm018@#21);
                    #guerm018@#21 = 0;
                    #guerm018@#24 = 0;
                    |GRABA 020#guerm018@.n;

                    #18#30 = nLin;
                    ||PTEC 809; |PTEC 808;
                    |PTEC 815; |PTEC 808;
               |FINSI;
               |CIERRA #guerm018@;
               |DESCARGA_DEF #guerm018@;
               |PONCONTROL 23, "SI";
          |FINSI;
     |FINSI;
     |PINTA #0#6;
     |PINTA #0#7;
     |PINTA #0#13;
|FPRC;

|PROCESO Importe; |TIPO 0;
     |SI eaSerPre1 ! "";
          |SI #18#5 > 1;
               |MENAV "0000Las horas no pueden ser mayo de 1";
               |ERROR; |ACABA;
          |FINSI;
     |FINSI;

     |SI #18#25 = "T";
          |SI #guerm018#20 = 0;
               #guerm018#7 = (#guerm018#5 * #guerm018#16);
          |SINO;
               #guerm018#7 = (#guerm018#20 * #guerm018#21);
          |FINSI;
     |SINO;
          #guerm018#7 = (#guerm018#5 * #guerm018#16) + (#guerm018#20 * #guerm018#21);
     |FINSI;
     |PINTA #guerm018#7;
|FPRC;

|PROCESO Articulo; |TIPO 0;
     |ABRE #gotrabaj;
     #gotrabaj#0 = #guerm017#3;
     |LEE 000#gotrabaj.=;
     |SI FSalida = 0;
          ||PINTA 1222, #gotrabaj#1;
          |ABRE #gocatcon;
          #gocatcon#0 = #gotrabaj#3;
          #gocatcon#1 = #gotrabaj#2;
          |LEE 000#gocatcon.=;
          |SI FSalida = 0;
               #guerm017#8 = #gocatcon#13;
               |PINTA #guerm017#8;
          |FINSI;
          |CIERRA #gocatcon;
     |FINSI;
     |CIERRA #gotrabaj;
|FPRC;

|PROCESO Entrada; |TIPO 8;
     |ABRE #guerm048;
     |LEE 000#guerm048.p;
     |CIERRA #guerm048;

     |ABRE #goparame;
     |LEE 000#goparame.p;
     |CIERRA #goparame;

     nDeci_PBase = EURODB;
     nDeci_PreBase = EURODB;
     nDeci_PreDiv = EURODB;
|FPRC;

|PROCESO BIptr; |TIPO 80;
     |CLS;
     |CONTROL_SIMPLE 0, "BOTON,F3 - Tipos Horas", 2735, 2755, F3ptr;
     nBotTipos = FSalida;
     |ESTADO_CONTROL nBotTipos, "HIDE"; ||"SHOW""HIDE""ENABLE""DISABLE".

     |CONTROL_SIMPLE 0, "BOTON,F2 - Art./Elemento", 2735, 2755, F2art;
     nBotArt = FSalida;
     |ESTADO_CONTROL nBotArt, "HIDE"; ||"SHOW""HIDE""ENABLE""DISABLE".

     |CONTROL_SIMPLE 0,"LBOTON, F2 - Presupuestos de Expediente", 2730, 2760, F2al3;
     nBotF20 = FSalida;
     |ESTADO_CONTROL nBotF20, "HIDE"; ||"SHOW""HIDE""ENABLE""DISABLE".

     |CONTROL_SIMPLE 0, "LBOTON,F2 - Partidas Presupuesto", 2715, 2735, F2al3;
     nBotF21 = FSalida;
     |ESTADO_CONTROL nBotF21, "HIDE"; ||"SHOW""HIDE""ENABLE""DISABLE".

     |CONTROL_SIMPLE 0, "LBOTON,F3 - Partidas Presupuesto/Articulo", 2745, 2765, F3al3;
     nBotF30 = FSalida;
     |ESTADO_CONTROL nBotF30, "HIDE"; ||"SHOW""HIDE""ENABLE""DISABLE".
|FPRC;

------------------------------------------------------------------------------
|PROCESO BSptr; |TIPO 7;
     |SI Campo = 9;
          |ESTADO_CONTROL nBotTipos, "SHOW"; ||"SHOW""HIDE""ENABLE""DISABLE".
     |FINSI;
     |SI Campo = 17;
          |ESTADO_CONTROL nBotArt, "SHOW"; ||"SHOW""HIDE""ENABLE""DISABLE".
     |FINSI;
|FPRC;
-------------------------------------------------------------------------------
|PROCESO BHptr; |TIPO 0;
     |ESTADO_CONTROL nBotTipos, "HIDE"; ||"SHOW""HIDE""ENABLE""DISABLE".
|FPRC;


-------------------------------------------------------------------------------
|PROCESO F3ptr;
     |PTEC 825;
|FPRC;
-------------------------------------------------------------------------------
|PROCESO F2art;
     |PTEC 824;
|FPRC;
-------------------------------------------------------------------------------
|PROCESO cMinHor;
     #19#0 = #gotrabaj#3;
     #19#1 = #gotrabaj#2;
     #19#2 = 0;
|FPRC;
-------------------------------------------------------------------------------
|PROCESO cMaxHor;
     #19#0 = #gotrabaj#3;
     #19#1 = #gotrabaj#2;
     #19#2 = 99;
|FPRC;
-------------------------------------------------------------------------------
|PROCESO Hora66; |TIPO 66;
     |ABRE #19;
     |CONSULTA_F_CLAVE #1#19, cMinHor, cMaxHor;
     |SI FSalida = 0;
          #guerm018#9 = #19#2;
          |PINTA #guerm018#9;
     |FINSI;
     |CIERRA #19;
|FPRC;

|PROCESO THora; |TIPO 0;
     nSalida = FSalida;
     |ABRE #19;
     |SI nSalida = 11;
          |CONSULTA_F_CLAVE #1#19, cMinHor, cMaxHor;
          |SI FSalida = 0;
               #guerm018#9 = #19#2;
               |PINTA #guerm018#9;
          |SINO;
               |ERROR;
               |ESTADO_CONTROL nBotTipos, "SHOW"; ||"SHOW""HIDE""ENABLE""DISABLE".
          |FINSI;
     |FINSI;
     |SI Contenido ! #18#9;
          #19#0 = #gotrabaj#3;
          #19#1 = #gotrabaj#2;
          #19#2 = #18#9;
          |LEE 000#19=;
          |SI FSalida ! 0;
               |MENAV "0000EL TIPO DE HORA INTRODUCIDO NO EXISTE EN LA CATEGORIA";
               |ESTADO_CONTROL nBotTipos, "SHOW";
               |ERROR;
          |FINSI;
     |FINSI;
     |CIERRA #19;
|FPRC;

|PROCESO aBortar; |TIPO 11;
     |SI FSalida = 7;
          |HAZ BHptr;
     |FINSI;
|FPRC;


------------------------------------------------------------------------------
|PROCESO BFal; |TIPO 90;
     |PULSATECLA;
     |FIN_CONTROL_WINDOWS nBotTipos;
     |PULSATECLA;
     |FIN_CONTROL_WINDOWS nBotF20;
     |PULSATECLA;
     |FIN_CONTROL_WINDOWS nBotF21;
     |PULSATECLA;
     |FIN_CONTROL_WINDOWS nBotF30;
     |PULSATECLA;
|FPRC;
------------------------------------------------------------------------------
|PROCESO BSal3; |TIPO 7;
     |SI Campo = 12; |O Campo = 13;
          |ESTADO_CONTROL nBotF20, "SHOW"; ||"SHOW""HIDE""ENABLE""DISABLE".
          |ESTADO_CONTROL nBotF21, "HIDE"; ||"SHOW""HIDE""ENABLE""DISABLE".
          |ESTADO_CONTROL nBotF30, "HIDE"; ||"SHOW""HIDE""ENABLE""DISABLE".
     |FINSI;
     |SI Campo = 14;
          |ESTADO_CONTROL nBotF20, "HIDE"; ||"SHOW""HIDE""ENABLE""DISABLE".
          |ESTADO_CONTROL nBotF21, "SHOW"; ||"SHOW""HIDE""ENABLE""DISABLE".
          |ESTADO_CONTROL nBotF30, "SHOW"; ||"SHOW""HIDE""ENABLE""DISABLE".
     |FINSI;
     |SI Campo = 3;
          |ESTADO_CONTROL nBotF20, "HIDE"; ||"SHOW""HIDE""ENABLE""DISABLE".
          |ESTADO_CONTROL nBotF21, "HIDE"; ||"SHOW""HIDE""ENABLE""DISABLE".
          |ESTADO_CONTROL nBotF30, "HIDE"; ||"SHOW""HIDE""ENABLE""DISABLE".
     |FINSI;
|FPRC;
-------------------------------------------------------------------------------
|PROCESO BHal3; |TIPO 7;
     |ESTADO_CONTROL nBotF20, "HIDE"; ||"SHOW""HIDE""ENABLE""DISABLE".
     |ESTADO_CONTROL nBotF21, "HIDE"; ||"SHOW""HIDE""ENABLE""DISABLE".
     |ESTADO_CONTROL nBotF30, "HIDE"; ||"SHOW""HIDE""ENABLE""DISABLE".
     |ESTADO_CONTROL nBotArt, "HIDE"; ||"SHOW""HIDE""ENABLE""DISABLE".
|FPRC;
-------------------------------------------------------------------------------
|PROCESO F2al3;
     |PTEC 824;
|FPRC;

|PROCESO F3al3;
     |PTEC 825;
|FPRC;
-------------------------------------------------------------------------------

|PROCESO PonHoras; |TIPO 0;
     |SI aTipoArt = "O";
          |ABRE #gopre001;
          #gopre001#0 = #guerm018#12;
          #gopre001#1 = #guerm018#13;
          |LEE 000#gopre001.=;
          |SI FSalida = 0;
               |ABRE #gocatcot;
               #gocatcot#0 = #gotrabaj#3;
               #gocatcot#1 = #gotrabaj#2;
               #gocatcot#2 = #guerm018#9;
               |LEE 000#gocatcot.=;
               |SI FSalida = 0;
                    |SI #gopre001#18 = "P";
                         #guerm018#6 = #gocatcot#4;
                         #guerm018#16 = #gocatcot#5;
                    |FINSI;
                    |SI #gopre001#18 = "A";
                         #guerm018#6 = #gocatcot#6;
                         #guerm018#16 = #gocatcot#7;
                    |FINSI;
                    |SI #gopre001#18 = "E";
                         #guerm018#6 = #gocatcot#8;
                         #guerm018#16 = #gocatcot#9;
                    |FINSI;
               |FINSI;
               |CIERRA #gocatcot;
               ||ARA
          |FINSI;
          |PINTA #guerm018#6;
          |PINTA #guerm018#16;

          |CIERRA #gopre001;
     |FINSI;
|FPRC;

|PROCESO LisPres2; |TIPO 0;
     |ABRE #4;
     |SELECT #2#4;
     #4#3 = #18#12;                            ||serie Pres.
     #4#4 = #18#13;                            ||Nº Pres.
     #4#0 = #18#10;                            ||Serie Exp.
     #4#1 = #18#11;                            ||Nº Exp.
     |LEE 000#4=;
     |SI FSalida ! 0;
          |SI aTipoArt ! "S";
               |MENAV "0000PRESUPUESTO INEXISTENTE EN EL EXPEDIENTE";
          |FINSI;
          |CIERRA #4;
          |ERROR;
          |ACABA;
     |FINSI;
     |CIERRA #4;

     eaSerPre = #4#3;
     enNumPre = #4#4;
     eaSerExp = #4#0;
     enNumExp = #4#1;
     |HAZ EstadoObra;
     |SI FSalida ! 0; |ERROR; |ACABA; |FINSI;

     |HAZ PonHoras;
|FPRC;

|PROCESO gopre004;
     |SI #guerm017#8 = #15#5; |Y aTipoArt = "O";
          nHay = 1;
          |ERROR10;
     |FINSI;
|FPRC;

|DEFBUCLE gopre004;
     #15#3;
     ;
     #guerm018#12, #guerm018#13, #3#4, "                    ";
     #guerm018#12, #guerm018#13, #3#4, "zzzzzzzzzzzzzzzzzzzz";
     be;
     NULL, gopre004;
|FIN;

|PROCESO CargaEl14;
     nHay = 0;
     |BUCLE gopre004;
     |SI nHay ! 0;
          |PARA i = 0; |SI i [ 24; |HACIENDO i = i + 1;
               #14i = #3i;
          |SIGUE;
          #16#0 = #3#0;
          #16#1 = #3#1;
          #16#12 = #3#2;
          |LEE 000#16=;
          #14#25 = #16#13;
          |GRABA 020#14n;
     |FINSI;
|FPRC;

|DEFBUCLE CargaEl14;
     #3#3;
     ;
     #guerm018#12, #guerm018#13, 001; || Serie/Presu
     #guerm018#12, #guerm018#13, 999;
     ;
     NULL, CargaEl14;
|FIN;

|PROCESO LisPart6; |TIPO 6;
     |SI FSalida = 10;
          eaSerPre = #18#12;
          enNumPre = #18#13;
          eaCapi = #18#23;
          eaParti = #18#14;
          |HAZ GuerPartid;
          |SI eaParti ! "";
               #18#23 = eaCapi;
               #18#14 = eaParti;
               #18#15 = eaDesPa;
               |PINTA #18#14;
               |PINTA #18#15;
          |FINSI;
     |FINSI;

     |SI FSalida = 11;        ||F3
          |HAZ CreaTempo; aTempo14 = Tempo;
          |NOME_DAT #14 aTempo14; |DELINDEX #14;
          |ABRE #14;
          |ABRE #16; |SELECT #6#16;
          |BUCLE CargaEl14;
          |CIERRA #16;
          |CONSULTA_CLAVE #1#14;
          |SI FSalida ! 0;
               |ERROR;
          |SINO;
               #guerm018#14 = #14#4;                        ||Partida.
               #guerm018#15 = #14#5;                        ||Descripcion Partida.
               |PINTA #guerm018#14;
               |PINTA #guerm018#15;
          |FINSI;
          |CIERRA #14;
          |DELINDEX #14; Tempo = aTempo14; |HAZ BoraTempo;
     |FINSI;
|FPRC;

|PROCESO LisPart; |TIPO 0;
     |SI eaSerPre1 ! ""; |ACABA; |FINSI;

     aAlfa = #18#14; |QBF aAlfa;
     |SI #100#124 = "S"; |Y aAlfa = "";
          |ACABA;
     |FINSI;

     |SI aAlfa = "";
          eaSerPre = #18#12;
          enNumPre = #18#13;
          eaCapi = #18#23;
          eaParti = #18#14;

          |HAZ GuerPartid;
          |SI eaParti ! "";
               #18#23 = eaCapi;
               #18#14 = eaParti;
               #18#15 = eaDesPa;
               |PINTA #18#14;
               |PINTA #18#15;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO MiraParti; |TIPO 0;
     |SI eaSerPre1 ! ""; |ACABA; |FINSI;

     aAlfa = #18#14; |QBF aAlfa;
     |SI #100#124 = "S"; |Y aAlfa = "";
          |ACABA;
     |FINSI;

     |ABRE #3;
     |SELECT #4#3;
     #3#0 = #guerm018#12;                            ||Serie Pres.
     #3#1 = #guerm018#13;                            ||Nº Pres.
     #3#4 = #guerm018#14;                            ||Partida.
     |LEE 000#3=;
     |SI FSalida ! 0;
          |SI aTipoArt ! "S";
               |MENAV "0000NO EXISTE LA PARTIDA EN ESTE PRESUPUESTO";
               |ERROR10;
          |FINSI;
     |SINO;
          |ABRE #15;
          |SELECT #3#15;
          #15#0 = #3#0;                            ||Serie Pres.
          #15#1 = #3#1;                            ||Nº Pres.
          #15#3 = #3#4;                            ||Partida.
          |SI aTipoArt = "O";
               #15#5 = #guerm017#8;                ||Cod. Articulo.
          |SINO;
               #15#5 = #guerm017#9;                ||Cod. Articulo.
          |FINSI;
          |LEE 000#15=;
          |SI FSalida ! 0;
               |SI #goparame#28 = "S";
                    |CONFI "0000NEL ARTICULO INTRODUCIDO NO SE ENCUENTRA EN LA PARTIDA. ¨CONTINUAR?";
                    |SI FSalida = -1;
                         |ERROR;
                         |ACABA;
                    |FINSI;
               |FINSI;
          |FINSI;
          |CIERRA #15;
     |FINSI;
     |CIERRA #3;
|FPRC;

|PROCESO guerm020;
     |DDEFECTO #21;
     #21#0 = #guerm020#1;
     |LEE 101#21=;
     |SI FSalida ! 0; |GRABA 020#21b; |FINSI;
     #21#1 = #guerm020#2;
     #21#2 = #guerm020#3;
     |GRABA 020#21a;
     |LIBERA #21;
|FPRC;

|DEFBUCLE guerm020;
 #guerm020#1;
 ;
 #guerm017#0, "                    ";
 #guerm017#0, "zzzzzzzzzzzzzzzzzzzz";
 ;
 NULL, guerm020;
|FIN;

|PROCESO ArtEle; |TIPO 0;
     |SI FSalida = 10;        ||F2
          |HAZ CreaTempo; aTempo21 = Tempo;
          |NOME_DAT #21 aTempo14;
          |DELINDEX #21;
          |ABRE #21;
          |BUCLE guerm020;    ||Carga el Temporal

          |CONSULTA_CLAVE #1#21;
          |SI FSalida = 0;
               #guerm018#17 = #guerm021#0;
               |PINTA #guerm018#17;
          |SINO;
               |ESTADO_CONTROL nBotArt, "SHOW"; ||"SHOW""HIDE""ENABLE""DISABLE".
               |ERROR;
          |FINSI;
          |CIERRA #21;
          |DELINDEX #21; Tempo = aTempo21; |HAZ BoraTempo;
          |HAZ DatosArt;
     |SINO;
          |HAZ DatosArt;
     |FINSI;

|FPRC;

|PROCESO DatosArt;
     nModo = (FEntrada / 100) ! 0;

     |ABRE #guerm020;
     |DDEFECTO #guerm020;
     #guerm020#0 = #guerm017#0;
     #guerm020#1 = #guerm018#17;
     |LEE 000#guerm020.=;
     |SI FSalida ! 0;
          aMensaje = "0000Este articulo no pertenece al Elemento [" + #guerm017#0 + "]";
          |MENAV aMensaje;
          |ERROR;
     |SINO;
          aArt = #guerm020#2;
          |QBF aArt;
          aArt = aArt % 138;
     ||     |ATRI S;
     ||     |PINTA 2032, aArt;
     ||     |ATRI 0;
          |SI #guerm020#3 = #goparame#5;
               ||Mano obra
               aTipoArt = "O";
          |SINO;
               |SI #guerm020#3 = #goparame#7;
                    ||Maquinaria
                    aTipoArt = "M";
               |SINO;
                    ||Sin Naturaleza
                    aTipoArt = "S";
               |FINSI;
          |FINSI;
     |FINSI;
     |CIERRA #guerm020;

     |SI eaSerPre1 = ""; |O #18#3 > 1;
          |SI aTipoArt = "S";
               |C_M #guerm018#10, 1, "N";
               |C_M #guerm018#11, 1, "N";
               |C_M #guerm018#12, 1, "N";
               |C_M #guerm018#13, 1, "N";
               |C_M #guerm018#14, 1, "N";
          |SINO;
               |C_M #guerm018#10, 1, "S";
               |C_M #guerm018#11, 1, "S";
               |C_M #guerm018#12, 1, "S";
               |C_M #guerm018#13, 1, "S";
               |C_M #guerm018#14, 1, "S";
          |FINSI;
     |FINSI;

     |SI aTipoArt ! "M"; |ACABA; |FINSI;

     |SI #18Campo ! Contenido; |O nModo = 1;
          |ABRE #29; |SELECT #2#29;
          #29#1 = #18#17;
          #29#0 = #0#1;
          |LEE 000#29=;
          |SI FSalida ! 0;
               |LEE 000#29];
               |SI FSalida = 0;
                    |LEE 000#29a;
               |SINO;
                    |LEE 000#29u;
               |FINSI;
          |FINSI;
          |SI FSalida = 0; |Y #29#1 = #18#17;
               #18#6 = #29#3; |PINTA #18#6;
               #18#16 = #29#4;|PINTA #18#16;
          |SINO;
               |MENAV "0000No existe tarifa para este articulo...";
               |ERROR;
          |FINSI;
          |CIERRA #29;
     |FINSI;
|FPRC;

|PROCESO Tipo66_017; |TIPO 66;
     |HAZ CreaTempo; aTempo21 = Tempo;
     |NOME_DAT #21 aTempo14;
     |DELINDEX #21;
     |ABRE #21;
     |BUCLE guerm020;    ||Carga el Temporal

     |CONSULTA_CLAVE #1#21;
     |SI FSalida = 0;
          #guerm018#17 = #guerm021#0;
          |PINTA #guerm018#17;
     |SINO;
          |ESTADO_CONTROL nBotArt, "SHOW"; ||"SHOW""HIDE""ENABLE""DISABLE".
     |FINSI;
     |CIERRA #21;
     |DELINDEX #21; Tempo = aTempo21; |HAZ BoraTempo;
     |HAZ DatosArt;
|FPRC;

|PROCESO EntraLin; |TIPO 7;
     |HAZ ModiCampos;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 1; |Y eaSerPre1 ! "";
          #18#25 = "M";
          #18#17 = aArt;
          #18#9 = 01;
          #18#10 = eaSerExp1;
          #18#11 = enNumExp1;
          #18#12 = eaSerPre1;
          #18#13 = enNumPre1;
          #18#5 = 1;
     |FINSI;
|FPRC;

|PROCESO AltaLin; |TIPO 0;
     nModo = (FEntrada/100) ! 0;
     |SI nModo = 1; |Y #guerm018#3 = 1; |Y nSwAltaCab = 1;
          |HAZ PrimerArt;
     |FINSI;
|FPRC;

|PROCESO guerm020p;
     #guerm018#17 = #guerm020#1;
     |PINTA #guerm018#17;
     |ERROR10;
|FPRC;

|DEFBUCLE guerm020p;
 #guerm020#1;
 ;
 #guerm017#0, "                    ";
 #guerm017#0, "zzzzzzzzzzzzzzzzzzzz";
 ;
 NULL, guerm020p;
|FIN;

|PROCESO PrimerArt;
     |BUCLE guerm020p;
|FPRC;


|PROCESO CargaPre;
     #8#0 = #4#3;
     #8#1 = #4#4;
     |LEE 000#8=;
     |SI FSalida = 0;
          |PARA i = 0; |SI i [ 48; |HACIENDO i = i + 1;
               #200i = #8i;
          |SIGUE;
          |GRABA 020#200n;
     |FINSI;
|FPRC;

|DEFBUCLE CargaPre;
     #1003#1;
     ;
     #18#10, #18#11;
     #18#10, #18#11;
     ;
     NULL, NULL, CargaPre;
|FIN;

|PROCESO Pres6; |TIPO 6;
     |SI FSalida ! 10; |ACABA; |FINSI;
     |DDEF aDef;
     aDef = aDef  + "gopre001";
     |CARGA_DEF aDef, gopre001@;
     |SI FSalida = 0;
          aAlfa = Usuario + "2";
          |NOME_DAT #200 aAlfa;
          |DELINDEX #200;
          |ABRE #200;
          |ABRE #8;
          |BUCLE CargaPre;
          |CIERRA #8;
          #200#0 = #18#12;
          #200#1 = #18#13;
          |LEE 000#200];
          |CONSULTA_CLAVE #1#200;
          |SI FSalida = 0;
              #18#12 = #200#0;
              #18#13 = #200#1;
              |PINTA #18#12;
              |PINTA #18#13;
          |FINSI;
          |CIERRA #200;
          |DELINDEX #200;
          |DESCARGA_DEF #200;
     |FINSI;
     |CIERRA #8;
|FPRC;

|PROCESO Gasoil; |TIPO 7;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 1;
          #0#15 = #guerm048#1;
          |PINTA #0#15;
     |FINSI;
|FPRC;

|PROCESO ImpoConsu; |TIPO 0;
     #0#17 = #0#15 * #0#16;
     |PINTA #0#17;
|FPRC;

|PROCESO Diferenci; |TIPO 0;
     #0#14 = #0#5 - #0#4;
     |PINTA #0#14;
|FPRC;

|PROCESO PonTipo7; |TIPO 7;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 1;
          |ABRE #9;
          #9#0 = #0#0;
          |LEE 020#9=;
          |SI FSalida = 0;
               #18#25 = #9#2;
          |FINSI;
          |CIERRA #9;
     |FINSI;
|FPRC;

|PROCESO PonTipo0; |TIPO 0;
     |SI #18#25 ! Contenido;
          |HAZ DefCp;
          |HAZ DefPrecio;
     |FINSI;

     |SI #18#25 = "T";
          |C_M #guerm018#18, 1, "S";
          |C_M #guerm018#19, 1, "S";
          |C_M #guerm018#20, 1, "S";
          |C_M #guerm018#21, 1, "S";
          |C_M #guerm018#24, 1, "S";
     |SINO;
          |C_M #guerm018#18, 1, "N";
          |C_M #guerm018#19, 1, "N";
          |C_M #guerm018#20, 1, "N";
          |C_M #guerm018#21, 1, "N";
          |C_M #guerm018#24, 1, "N";
     |FINSI;

|FPRC;

|PROCESO DefCp;            ||Cod. Postal por defecto
     |SI #18#25 = "T";
          |ABRE #gomantho;
          |DDEFECTO #gomantho;
          #gomantho#0 = #guerm018#10;
          #gomantho#1 = #guerm018#11;
          |LEE 000#gomantho.=;
          |SI FSalida = 0;
               aCP = #gomantho#4 % 105;
               aCP1 = aCP % 102;
               aCP2 = aCP % -103;
               #guerm018#18 = aCP1;
               #guerm018#19 = aCP2;
          |FINSI;
          |CIERRA #gomantho;
     |SINO;
          #guerm018#18 = 0;
          #guerm018#19 = 0;
     |FINSI;
     |PINTA #guerm018#18;
     |PINTA #guerm018#19;
|FPRC;

|PROCESO DefPrecio; |TIPO 0;
     |SI #18#25 = "T";
          |ABRE #guerm022;
          |DDEFECTO #guerm022;
          #guerm022#0 = #guerm018#18;
          #guerm022#1 = #guerm018#19;
          |LEE 000#guerm022.=;
          |SI FSalida = 0;
               #guerm018#21 = #guerm022#3;
               #guerm018#24 = #guerm022#5;
          |FINSI;
          |CIERRA #guerm022;
     |SINO;
          |ABRE #29; |SELECT #2#29;
          #29#1 = #18#17;
          #29#0 = #0#1;
          |LEE 000#29=;
          |SI FSalida ! 0;
               |LEE 000#29];
               |SI FSalida = 0;
                    |LEE 000#29a;
               |SINO;
                    |LEE 000#29u;
               |FINSI;
          |FINSI;
          |SI FSalida = 0; |Y #29#1 = #18#17;
               #18#21 = #29#4;
               #18#24 = #29#3;
          |SINO;
               #18#21 = 0;
               #18#24 = 0;
          |SINO;
          |FINSI;
          |CIERRA #29;
          |PINTA #18#6;
          |PINTA #18#16;
     |FINSI;
     |PINTA #guerm018#21;
     |PINTA #guerm018#24;
     |HAZ Importe;
|FPRC;

|PROCESO Expediente; |TIPO 0;
     |SI #18Campo ! Contenido;
          |HAZ DefCp;
          |HAZ DefPrecio;
     |FINSI;
|FPRC;

|PROCESO CP; |TIPO 0;
     |SI #18Campo ! Contenido;
          |HAZ DefPrecio;
     |FINSI;
|FPRC;

|PROCESO CosteTraba; || para Guerola
     |ABRE #101;
     #101#0 = #18#9;
     |LEE 000#101=;
     |CIERRA #101;

     aA¤o = #0#1 % 704;
     aMes = #0#1 % 402;
     |ABRE #53;
     |ABRE #54;
     #54#0 = aA¤o;
     #54#1 = aMes;
     #54#2 = #0#3;
     |LEE 000#54=;
     |SI FSalida = 0;
          #53#0 = #54#0;
          #53#1 = #54#1;
          |LEE 000#53=;
          |SI FSalida = 0; |Y #53#5 = "S";
               |CONFI "0000NRecalcular costes trabajador?";
               |SI FSalida = 0;
                    |SI #101#12 = "S";
                         #54#7 = #54#7 + (#18#5 * nForma);
                    |SINO;
                         #54#12 = #54#12 + (#18#5 * nForma);
                    |FINSI;
                    #54#8 = #54#6 / #54#7;
                    #54#10 = #54#9 / #54#7;
                    #54#11 = #54#8 + #54#10;
                    |GRABA 020#54a;
                    #53#7 = #53#7 + (#18#5 * nForma);
                    #53#8 = #53#6 / #53#7;
                    |GRABA 020#53a;

                    |GRABA 040#18b;
                    |SI FSalida ! 0;
                         |GRABA 020#18a;
                    |FINSI;

                    |SALVA_DATOS #guerm017;
                    |SALVA_DATOS #guerm018;
                    |CIERRAT #guerm017;
                    |CIERRAT #guerm018;
                    efFecha = #0#1;
                    enTraba = #0#3;
                    |SUB_EJECUTA_NP "guerm055";
                    |ABRET #guerm018;
                    |ABRET #guerm017;
                    |REPON_DATOS #guerm018;
                    |REPON_DATOS #guerm017;
                    |LEE 121#guerm018.=;
                    |LEE 121#guerm017.=;
               |FINSI;
          |FINSI;
     |FINSI;
     |CIERRA #53;
     |CIERRA #54;
|FPRC;

|PROCESO CheckParteAct; |TIPO 0;
     aA¤o = #0#1 % 704;
     aMes = #0#1 % 402;
     |ABRE #53;
     #53#0 = aA¤o;
     #53#1 = aMes;
     |LEE 000#53=;
     |SI FSalida = 0; |Y #53#5 = "S";;
          |MENAV "0000Precio de coste actualizado...";
     |FINSI;
     |CIERRA #53;
|FPRC;

|PROCESO ModiCampos;
     |C_M #18#25, 1, "S";
     |C_M #18#9, 1, "S";
     |C_M #18#10, 1, "S";
     |C_M #18#11, 1, "S";
     |C_M #18#12, 1, "S";
     |C_M #18#13, 1, "S";
     |C_M #18#14, 1, "S";

     |C_M #18#17, 1, "S";
     |C_M #18#16, 1, "S";
     |C_M #18#6, 1, "S";

     |SI eaSerPre1 = ""; |O #18#3 > 1; |ACABA; |FINSI;
     |C_M #18#25, 1, "N";
     |C_M #18#9, 1, "N";
     |C_M #18#10, 1, "N";
     |C_M #18#11, 1, "N";
     |C_M #18#12, 1, "N";
     |C_M #18#13, 1, "N";
     |C_M #18#14, 1, "N";

     |SI nCuantos = 1;
          |C_M #18#17, 1, "N";
     |FINSI;
     |SI nSwTari = 0;
          |C_M #18#16, 1, "N";
          |C_M #18#6, 1, "N";
     |FINSI;
|FPRC;

|PROCESO Tipo5; |TIPO 5;
     |SI eaSerPre1 = ""; |ACABA; |FINSI;

     nCuantos = 0;
     |ABRE #1020;
     #1020#0 = #0#0;
     #1020#1 = "";
     |LEE 000#1020];
     |PARA; |SI FSalida = 0; |Y #1020#0 = #0#0; |HACIENDO;
          nCuantos = nCuantos + 1;
          |SI nCuantos = 1;
               aArt = #1020#1;
               aDes = #1020#2;
               aTip = #1020#3;
          |FINSI;
          |LEE 000#1020s;
     |SIGUE;
     |CIERRA #1020;

     |ABRE #29; |SELECT #2#29;
     #29#1 = aArt;
     #29#0 = #0#1;
     |LEE 000#29=;
     |SI FSalida ! 0;
          |LEE 000#29];
          |SI FSalida = 0;
               |LEE 000#29a;
          |SINO;
               |LEE 000#29u;
          |FINSI;
     |FINSI;
     |SI FSalida = 0; |Y #29#1 = aArt;
          nPreVta = #29#3;
          nPreCos = #29#4;
          nSwTari = 0;
     |SINO;
          nSwTari = 1;
          |MENAV "0000No existe tarifa para este articulo...";
     |FINSI;
     |CIERRA #29;

     |DDEFECTO #18;
     #18#0 = #0#0;
     #18#1 = #0#1;
     #18#2 = #0#2;
     #18#3 = 1;
     #18#25 = "M";
     #18#17 = aArt;
     #18#9 = 01;
     #18#10 = eaSerExp1;
     #18#11 = enNumExp1;
     #18#12 = eaSerPre1;
     #18#13 = enNumPre1;
     #18#5 = 1;
     #18#6 = nPreVta;
     #18#16 = nPreCos;
     |HAZ Tipo2Lin;
     |GRABA 020#18n;

     |PTEC 802;
     |PTEC 808;
|FPRC;

|PROCESO Tipo13; |TIPO 13;
     |ABRE #100; |LEE 000#100p; |CIERRA #100;
     |SI #100#141 = "O";
          |PINTA 1413, "O.T.      ";
          |PINTA 1426, "O.E.       ";
     |FINSI;
|FPRC;
