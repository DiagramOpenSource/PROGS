|FICHEROS;
     inmoz005 #0;
     inmom001 #1;
     inmom004 #4;
|FIN;

|VARIABLES;
     nHay = 0;
     nSwCheq = 0;
     aCbAnt = "";
     nPrime = 0;
     nInfor = -1;
     nImpre = -1;
     aAlfa = "";
     nError = 0;

     &eaFecha = @;
     &eaHora = "";
     &eaCB =  "";
|FIN;

|PROCESO Imprime;
     |SI nPrime = 0;
          nPrime = 1;
          |IMPRE 0;
          nImpre = FSalida;
          |SI FSalida ! 0; |ACABA; |FINSI;
          |INFOR "inmoz005";
          nInfor = FSalida;
          |SI FSalida ! 0; |ACABA; |FINSI;
     |FINSI;
     |SI nInfor = 0; |PRINT; |FINSI;
|FPRC;

|PROCESO inmom004;
     |SI nSwCheq = 1;
          nHay = nHay + 1;
     |FINSI;
     |SI nSwCheq = 2;
          |SI aCbAnt = #4#2;
               |HAZ Imprime;
               nError = 1;
          |FINSI;
          aCbAnt = #4#2;

          eaFecha = #4#0;
          eaHora = #4#1;
          eaCB = #4#2;
     |FINSI;
     |SI nSwCheq = 3;
          |DDEFECTO #1;
          #1#0 = #4#2;
          |LEE 101#1=;
          |SI FSalida = 0;
               |SI #1#7 = #4#3; |Y #1#2 = #4#4;
                    #1#3 = #4#5;
                    #1#13 = "S";
                    #1#14 = #4#6;
                    #1#19 = ~;
                    |GRABA 020#1a;

                    #4#8 = "S";
                    |GRABA 020#4a;
               |FINSI;
               |SI #1#7 = #4#3; |Y #1#2 ! #4#4;
                    aAlfa = "Palet distinto. Original:" + #1#2;
                    #1#2 = #4#4;
                    #1#3 = #4#5;
                    #1#13 = "S";
                    #1#14 = #4#6;
                    #1#19 = ~;
                    |GRABA 020#1a;

                    #4#8 = "E";
                    #4#9 = aAlfa;
                    |GRABA 020#4a;
               |FINSI;
               |SI #1#7 ! #4#3;
                    #4#9 = "Albaran distinto";
                    |GRABA 020#4a;
               |FINSI;
          |SINO;
               #1#7 = #4#3;
               #1#2 = #4#4;
               #1#3 = #4#5;
               #1#13 = "N";
               #1#14 = #4#6;
               #1#19 = ~;
               #1#20 = #4#7;
               |GRABA 020#1n;

               #4#8 = "N";
               #4#9 = "Registro nuevo";
               |GRABA 020#4a;
          |FINSI;
     |FINSI;

     |LIBERA #4;
     |LIBERA #1;
|FPRC;

|DEFBUCLE inmom004;
     #4#2;
     8;
     #0#0, " ";
     #0#0, " ";
     be;
     NULL, NULL, NULL, NULL, NULL, inmom004;
     #4#2;
|FIN;

|PROCESO Tipo3; |TIPO 3;
     nSwCheq = 1;
     |BUCLE inmom004;
     |SI nHay = 0;
          |MENAV "0000No hay registros...";
     |SINO;
          aAlfa = "0000S" + nHay + ", codigos de barras a procesar. Continuar?";
          |CONFI aAlfa;
          |SI FSalida = 0;
               nSwCheq = 2;
               |BUCLE inmom004;
               |SI nError = 1;
                    |SI nInfor = 0; |PIEINF; |FININF; |FINSI;
                    |SI nImpre = 0; |FINIMP; |FINSI;
                    |MENAV "0000Proceso cancelado...";
                    |ACABA;
               |FINSI;

               |ABRE #1;
               nSwCheq = 3;
               |BUCLE inmom004;
               |CIERRA #1;
          |FINSI;
     |FINSI;
|FPRC;
