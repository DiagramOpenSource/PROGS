|FICHEROS;
     agifa067 #0;
     agifa081 #1;
     agifa019 #2;
     agifa112 #6;
     agifa017 #8;
     agi00011 #80,MANTE; || Textos lineas pedidos compras.
     agifa007 #90;       || Series.
     agitp001 #12;       || Tarifas Actualizadas Proveedor / Articulo.
     agifa142 #142;
     agifa321 #15;       || DIV - Parametros
     dsm00005 #905;
     dsm00010 #910;
     dsm00014 #914;
     dsm00005 #905;
     dsm00004 #904;
     agifa220 #220;      ||Descripcion ampliada.
     agifa561 #561;      ||Tarifas de Proveedor
     dsw00051 #51;
     agifa029 #29;
     dsm00226 #226;
     dsm00237 #237;
     agifa073 #73;

     referen@ #67;
     desan001@;
     sanch001@;
|FIN;

|VARIABLES;
     &enOk5050 = 0;
     nEsta = 0;
     aPath = "";
     nNum1 = 0;
     nNum2 = 0;
     nNum3 = 0;
     nDias = 0;
     fHoy = ~;
     aImporta = "";
     nNume = 0;
     &enModo81 = 0;
     nTallerBorLin = 0;
     nSwTaller = 0;
     &eaPCEAsigna = "";
     nPreTon = 0;
     nCan = 0;
     nUni = 0;
     nAlma = 0;
     &enSwFuerzaDA = 0;
     &eaTagSubAnt = "";   || modulo 000654   (no quitarla)
     &eaSerieTra = "";    || modulo 001254
     &enCreaLineas = 0;   || modulo 002743
     nSal = 0;
     nalmacen = 0;
     nImporDescue1 = 0;
     nImporDescue2 = 0;
     nImporDescue3 = 0;
     nImporMoneda1 = 0;
     nImporMoneda2 = 0;
     nBrutoMoneda1 = 0;
     nBrutoMoneda2 = 0;
     nSwTagloma = 0;
     &enUniTagPen = 0;
     &enUniTagRes = 0;
     aPtec = "";
     nPtec = 0;
     nLin = 0;
     nSwDA     = 0;
     nHay      = 0;
     &Tempo    = "";
     aTempo51  = "";
     nNume7    = 0;
     nNume11   = 0;
     &eaModulo = "";

     nResto     = 0;
     qCono      = "";
     nSwCB      = -1;
     nModo      = 0;
     nImpo      = 0;
     &Envase    = "";
     &Unidades1 = 0;
     &Unidades2 = 0;
     &VArticulo = "";

     &ser_ped   = "";
     &num_ped   = 0;
     &lin_ped   = 0;
     &enSwPanta = 1;

     &nDeci_Base      = 0;   || Decimales en Totales de la moneda base
     &nDeci_PreBase   = 0;   || Decimales en el Precio en moneda base
     &nDeci_BaseMxP   = 0;   || Decimales en Totales de la moneda base (Maxima precision)
     &nDeci_PreBasMxP = 0;   || Decimales en el Precio en moneda base (Maxima precision)
     &nDeci_DivP      = 0;   || Decimales en Totales de la divisa
     &nDeci_PreDivP   = 0;  || Decimales en el Precio en divisa
     &nDeci_PreDiv    = 0;  || Decimales en el Precio en divisa
     &nDeci_TotVisP   = 0;  || Decimales en Totales visibles (el de la moneda de trabajo)
     &nDeci_TotNoVisP = 0;  || Decimales en Totales no visibles (el de la otra moneda)
     &nDeci_PreVisP   = 0;  || Decimales en el Precio visual. (lineas)
     &nDeci_ImpVisP   = 0;  || Decimales en el Importe visual. (lineas)
     tecla      = "";
     &ac_divisa = ""; ||
     mensa      = ""; || Linea de visualizacion
     &pintado   = 0;|| Controla el pintado de mensa para que solo lo haga 1 vez
     titdiv = "";   || Encabezado de precio e imp. con la divisa "Imp.Tot(USD)"

     aAlfa      = "";
     nForma     = 0;
     nPrecio    = 0;
     precio     = 0;
     dto1       = 0;
     dto2       = 0;
     asto       = 0;
     Unidades   = 0;
     alfa       = "";
     &Cie_pasa      = 0;
     &Cie_fech      = @;
     &Cie_alma      = 0;
     ind        = 0;
     salida     = 0;
     menor      = 0;
     articulo   = " ";
     mensaje3   = "";
     pc         = 0;
     fmes       = " ";
     vacio      = "                    ";
     &n_dec     = 0;
     &n_pre     = 0;
     modo       = 0;
     &def_alm   = 0;
     fiac       = "  ";
     guarda     = "  ";
     relleno    = "                                       ";
     aponer     = "  ";
     serie      = "";
     pedido     = 0;
     pedido_o   = 0;
     serie_o    = "";
     alfa1      = "";
     alfa2      = "";
     &recoge    = "";  || Viene de agifa104
     nlinea     = 0;
     nerror     = 0;
     nLineaD    = 0;
     aprograma  = "";
     &c_prove   = "";
     &c_artic   = "";
     &c_serie   = "";
     &entrada   = 0;
     inkey      = 0;
     &codiBarra = "";
     &r_arti    = "";
     aRecoge = "N";
     &aModalidad = "C";  || Compras
     &aProceso = "agifa067";          || Lo utilizo en agifa409

     nPPort1   = 0;
     nPPort2   = 0;
     nImpDiv   = 0;
     nPend     = 0;
     aArti = "";

     aSer                = "";
     aDef                = "";
     nNum                = 0;
     nLinOrg             = 0;
     i                   = 0;
     j                   = 0;
     nSwSanchez          = 0;
|FIN;

|INCLUYE i_varart;
|INCLUYE i_cdbarr;

ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄModulo 002736ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
|PROCESO UllLinPedCom;
     |SALVA_FICHA #agifa067;
     aSer = #agifa067#28;
     nNum = #agifa067#0;
     #agifa067#1 = 999;
     |LEE 000#agifa067.];
     |SI FSalida = 0;
          |LEE 000#agifa067.a;
     |SINO;
          |LEE 000#agifa067.u;
     |FINSI;
     |SI FSalida = 0; |Y #agifa067#28 = aSer; |Y #agifa067#0 = nNum;
          nLin = #agifa067#1 + 1;
     |SINO;
          nLin = 1;
     |FINSI;
     |REPON_FICHA #agifa067;
|FPRC;

|PROCESO Sanchez67; |TIPO 6;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo ! 1; |ACABA; |FINSI;

     |HAZ EsSanchez;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |DDEF aDef;
     aDef = aDef + "sanch001";
     |CARGA_DEF aDef, sanch001@;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |ABRE #sanch001@;
     #sanch001@#0 = #agifa067#2;
     |LEE 000#sanch001@.=;
     |SI FSalida = 0;
          nLinOrg = 0;
          |PARA i = 1; |SI i [ 6; |HACIENDO i = i + 1;
               j = i + 6;
               |SI #sanch001@#i# ! 0;
                    |SI nLinOrg = 0;
                         nLinOrg = #agifa067#1;
                         #agifa067#6 = #sanch001@#i#;
                         #agifa067#33 = #sanch001@#i#;
                         #agifa067#14 = #sanch001@#j#;
                         |HAZ lpctotal;
                         #agifa067#47 = nLinOrg;
                         |GRABA 020#agifa067.n;
                    |SINO;
                         |HAZ UllLinPedCom;
                         #agifa067#1 = nLin;
                         #agifa067#3 = 0;
                         #agifa067#6 = #sanch001@#i#;
                         #agifa067#33 = #sanch001@#i#;
                         #agifa067#14 = #sanch001@#j#;
                         |HAZ lpctotal;
                         |HAZ lpcacart;
                         #agifa067#47 = nLinOrg;
                         |GRABA 020#agifa067.n;
                    |FINSI;
               |FINSI;
          |SIGUE;

          |SI nLinOrg ! 0;
               #agifa067#1 = nLinOrg;
               |LEE 121#agifa067.=;
          |FINSI;

          |PTEC 809;
          |PTEC 816;
          |PTEC 814;
          |PTEC 815;
          |PONCONTROL 23, "SI";
     |FINSI;
     |CIERRA #sanch001@;
     |DESCARGA_DEF #sanch001@;
|FPRC;

|PROCESO BajaSanchez;
     |SI nSwSanchez ! 0; |ACABA; |FINSI;
     nSwSanchez = 1;

     |DDEF aDef;
     aDef = aDef + "sanch001";
     |CARGA_DEF aDef, sanch001@;
     |SI FSalida ! 0; |ACABA; |FINSI;
     |ABRE #sanch001@;
     #sanch001@#0 = #agifa067#2;
     |LEE 000#sanch001@.=;
     |SI FSalida = 0;
          aSer = #agifa067#28;
          nNum = #agifa067#0;
          |PARA; |SI FSalida = 0; |Y #agifa067#3 = 0; |Y aSer = #agifa067#28; |Y nNum = #agifa067#0; |HACIENDO;
               |LEE 000#agifa067.a;
          |SIGUE;
          nLinOrg = #agifa067#1;
          |LEE 000#agifa067.s;
          |PARA; |SI FSalida = 0; #agifa067#3 = 0; |Y #agifa067#2 = #sanch001@#0;
                      |Y aSer = #agifa067#28; |Y nNum = #agifa067#0; |HACIENDO;
               |HAZ lpcacart;
               |BORRA 020#agifa067.a;
               |LEE 000#agifa067.s;
          |SIGUE;
          #agifa067#1 = nLinOrg;
          |LEE 121#agifa067.=;
          |PONCONTROL 23, "SI";
          |PTEC 808;
     |FINSI;
     |CIERRA #sanch001@
     |DESCARGA_DEF #sanch001@;
     nSwSanchez = 0;
|FPRC;

|PROCESO MiraSanchez;
     |SI nSwSanchez ! 0; |ACABA; |FINSI;

     |DDEF aDef;
     aDef = aDef + "sanch001";
     |CARGA_DEF aDef, sanch001@;
     |SI FSalida ! 0; |ACABA; |FINSI;
     |ABRE #sanch001@;
     #sanch001@#0 = #agifa067#2;
     |LEE 000#sanch001@.=;
     |SI FSalida = 0;
          nSwSanchez = 1;
     |FINSI;
     |CIERRA #sanch001@
     |DESCARGA_DEF #sanch001@;
|FPRC;

ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ

|PROCESO Tipo67_3; |TIPO 3;
     |SI #agifa142#206 = "S";
          aTipoDA = "P"; |HAZ AltaDAC;
     |FINSI;

     nModo = (FEntrada/ 100) ! 0;
     |SI nModo = 1;
          |HAZ EsDesanch;
          |SI FSalida = 0;
               |HAZ Desan067;
          |FINSI;
     |FINSI;
|FPRC;
ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
|CALCULO civaped;
     inkey = salida;
     |SI inkey = 14;
          c_prove = #1#4;
          c_artic = #0#2;
          c_serie = #1#25;
          entrada = 1;
          |SUB_EJECUTA_NP "agifa383.run";
          |ERROR;
          inkey = 0;
     |FINSI;
     |SI inkey = 15;
          eaPrv = #1#4;
          enTiva = #2#30;
          efFiva = #1#1;
          |HAZ IVAPrv;
          #0#6 = #0#6 / (1 + enIva/100);
          |HAZ visual_precio;
     |FINSI;
|FCAL;

|CALCULO lpcinfo;|TIPO 7;
     |DDEFECTO #8;
     |ABRE #8;
     #8#0 = #0#2;
     #8#1 = #0#3;
     |LEE 000#8=;
     |CIERRA #8;
     mensaje3 = "0410<F2>T. Funcion. (Stock Disp. Almacen: " + #8#39+"     Stock Minimo: "+#8#6+")";
     |MENSA mensaje3;
|FCAL;

|CALCULO cogelpc;|TIPO 0;
     articulo = #0#2;
     nalmacen = #0#3;
|FCAL;

|CALCULO defeclpc;|TIPO 0;

     #0#20 = #1#4;
     #0#23 = #1#5;
     #0#24 = #1#6;
     #0#25 = #1#17;
     #0#26 = #1#9;

     |SI #0#2 ! #2#0;
          |ABRE #2;
          #2#0 = #0#2;
          |LEE 000#2=;
          |CIERRA #2;
     |FINSI;

          |ABRE #6;
          #6#0 = #0#20;
          |LEE 000#6=;
          |CIERRA #6;

     |SI articulo ! #0#2; |O nalmacen ! #0#3;
          articulo = #0#2;
          nalmacen = #0#3;
          #0#18 = #2#2;
          ||ÄÄÄÄÄÄÄÄÄÄÄÄ Doble/MultiÄ
          eaDocu = "agifa067";
          |HAZ LeePreDtoCom;
          #0#6 = enPrecio;
          #0#33 = enPreDiv;
          #0#8 = enDto1;
          #0#27 = enDto2;
          #0#57 = enDto3;
          ||ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
          |PINTA #0#8;
          |PINTA #0#27;
          |PINTA #0#57;
          |HAZ upc_div;
     |FINSI;
|FCAL;

|CALCULO lpctotal;|TIPO 6;
     |SI salida = 13;
          enTipEnvase = 1;
          |HAZ Envase67;
     |FINSI;

     #0#5 = #0#5 ! n_dec;

     |ABRE #2;
     #2#0 = #0#2;
     |LEE 000#2=;
     |CIERRA #2;
     |SI #0#5 < #2#212; |Y #0#5 > 0;
          aAlfa = "0000Unidades Minimas Compra " + #2#212;
          |MENAV aAlfa;
          |ERROR; |ACABA;
     |FINSI;

     |SI #0#5 > 0;
          |SI #2#5 = #2#205;
             nResto = #0#5 $ #2#202;
             |SI nResto ! 0;
               #0#5 = #0#5 - nResto + #2#202;
             |FINSI;
          |FINSI;
     |SINO;
          |SI #2#5 = #2#205;
             nResto = -#0#5 $ #2#202;
             |SI nResto ! 0;
               #0#5 = #0#5 + nResto - #2#202;
             |FINSI;
          |FINSI;
     |FINSI;

     |PINTA #0#5;

     #0#37 = #0#5;
     #0#45 = #0#41;

     |HAZ TotalLin67;
     |HAZ visual_importe;
|FCAL;


|PROCESO Min12;
     #12#0 = #1#4;
     #12#2 = " " * 20;
|FPRC;

|PROCESO Max12;
     #12#0 = #1#4;
     #12#2 = "z" * 20;
|FPRC;

|PROCESO TariPrv;
     |SALVA_DATOS #12;
     |REPON_DATOS #referen@;
     |GRABA 020#referen@.n;
|FPRC;

|DEFBUCLE TariPrv;
     #12#3;
     ;
     #1#4, "                    ";
     #1#4, "zzzzzzzzzzzzzzzzzzzz";
     ;
     NULL, TariPrv;
|FIN;

|PROCESO art6pdc;
     r_arti = "";
     |SI codiBarra = "S"; |Y modo = 1;
          eaArti = #0#2;
          |HAZ HallaArti;
          |SI eaArti = ""; |Y #910#19 = "S"; |ERROR; |ACABA; |FINSI;
          |SI #2#176 = "S"; |Y eaEleme = "";
               |MENAV "0000Codigo incompleto...";
               |ERROR; |ACABA;
          |FINSI;
          |SI eaArti ! ""; #0#2 = eaArti; |FINSI;
     |FINSI;

     |SI salida = 10;
          |SI #142#74 = "T";
               |ABRE #2;
               #2#0 = #0#2;
               |LEE 000#2=;
               |CONSULTA_CLAVE #6#2;
               |SI FSalida = 0;
                    #0#2 = #2#0;
                    |PINTA #0#2;
               |SINO;
                    |ERROR;
               |FINSI;
               |CIERRA #2;
          |SINO;
               |DDEF aAlfa;
               aAlfa = aAlfa + "agitp001";
               |CARGA_DEF aAlfa, referen@;
               |SI FSalida = 0;
                    aAlfa = Usuario;
                    |NOME_DAT #referen@#aAlfa#;
                    |DELINDEX #referen@;
                    |ABRE #referen@;
                    |BUCLE TariPrv;
                    #referen@#0 = #1#4;
                    #referen@#1 = #0#2;
                    |LEE 000#referen@.];
                    |CONSULTA_CLAVE #3#referen@;
                    |SI FSalida = 0;
                         #0#2 = #referen@#1;
                         |PINTA #0#2;
                    |SINO;
                         |ERROR;
                    |FINSI;
                    |CIERRA #referen@;
                    |DELINDEX #referen@;
                    |DESCARGA_DEF #referen@;
               |FINSI;
/*
El basico da error [50000] en el .ixx al ordenar por su articulo
               |ABRE #12;
               #12#0 = #1#4;
               #12#1 = #0#2;
               |LEE 000#12];
               |CONSULTA_F_CLAVE #3#12, Min12, Max12;
               |SI FSalida = 0;
                    #0#2 = #12#1;
                    |PINTA #0#2;
               |SINO;
                    |ERROR;
               |FINSI;
               |CIERRA #12;
*/
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Envase67;
     Envase    = #0#39;
     Unidades1 = #0#40;
     Unidades2 = #0#5;
     VArticulo = #0#2;
     enAlmacen = #0#3;
     eaTipo = "C";
     eaProgEnv = "pedido";
     |HAZ EntraEnvase;
     #0#39 = Envase;
     #0#40 = Unidades1;
     #0#5  = Unidades2;  |PINTA #0#5;
|FPRC;

|PROCESO Conversion;  |TIPO 7;
     aAlfa = "0000<F5> Envases   <F8> Descripcion Ampliada";
     |HAZ EsDesanch;
     |SI FSalida = 0;
          aAlfa = "0000<F2> Ofertas   <F5> Envases   <F8> Descripcion Ampliada";
     |FINSI;
     |MENSA aAlfa;

     |HAZ EsAlbadis;
     |SI FSalida = 0;
          eaDocu = "PC";
          eaSerie = #0#28;
          enCodigo = #0#0;
          enLinea = #0#1;
          eaArticulo = #0#2;
          eaProve = #1#4;
          enPrecio = #0#6;
          eaDivisa = #1#27;
          eaEnvase = #agifa142#72;
          |HAZ BseEntraUniC;
          #0#5 = enUnid1;
          #0#41 = enUnid2;
          #0#6 = enPrecio;
          #0#39 = Envase;
          #0#40 = enUnid3;
          |C_M #0#5, 1, "N";
     |FINSI;
     eaDocu = "agifa067";
     ||ÄÄÄÄÄÄÄÄÄÄÄÄ Doble/MultiÄ
     enModo = (FEntrada / 100) ! 0;
     |HAZ DobleUni;
     |SI eaSw2Stock = "S";
          |C_M #0#5, 1, "N";
     |FINSI;
     ||ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
     |SI #agifa142#72 = "S";
          |HAZ Envase67;
          |C_M #0#5, 1, "S";
          |SI enEntraEnvase ! 0;  |C_M #0#5, 1, "N";  |FINSI;
     |FINSI;
|FPRC;

|PROCESO GrabaElemento;
     |ABRE #914;
     #914#0 = eaEleme;
     |LEE 000#914=;
     |CIERRA #914;

     |ABRE #905;
     |DDEFECTO #905;
     #905#0 = "PC";
     #905#1 = #0#28;
     #905#2 = #0#0;
     #905#3 = #0#1;
     #905#4 = eaEleme;
     #905#5 = #914#1;
     #905#6 = #0#5;
     #905#7 = #0#33;
     #905#8 = #905#6 * #905#7;
     #905#11 = #0#5;
     |GRABA 020#905n;

     |DDEFECTO #904;
     |ABRE #904;
     #904#0 = #0#2;
     #904#1 = #0#3;
     #904#2 = eaEleme;
     |LEE 101#904=;
     |SI FSalida ! 0; |GRABA 020#904b; |FINSI;
     #904#3 = #914#1;
     #904#5 = #904#5 + #0#5;
     |GRABA 020#904a;
|FPRC;

|CALCULO lpcacart; |TIPO 2;   || *(2)
     |MODULO aprograma;
     |SI aprograma = "agifa081";
         |SI #0#12 ! 0;  |O #0#38 ! 0; |O #0#44 ! 0; |O #0#46 ! 0;
             |MENAV "      No puedo dejar modificar o dar de baja la Ficha. ";
             |ERROR;
             |ACABA;
         |FINSI;
     |FINSI;

     nForma = 0 +. 1;
     modo = (FEntrada / 100) ! 0;

     |HAZ EsTagloma; nSwTagloma = FSalida;
     |HAZ EsTaller; nSwTaller = FSalida;

     |SI nSwTaller = 0;
          |SI #0#58 = -1; |Y enModo81 ! 3;
               |SI nForma = -1;
                    |MENAV "0000Linea canon de articulo, no se puede modificar";
               |FINSI;
               |ERROR; |ACABA;
          |FINSI;
     |FINSI;

     |SI modo = 2; |O modo = 3;
          |ABRE #73;
          #73#28 = #0#30;
          #73#0 = #0#29;
          #73#1 = #0#31;
          |LEE 000#73=;
          |SI FSalida = 0;
               |SI nForma < 1;
                    aAlfa = "0000Linea procedente del pedido de ventas '" + #0#30 + "/" + (("000000" + #0#29) % -106) + "'";
                    |MENAV aAlfa;
               |FINSI;
               |SI modo = 3; |ERROR; |ACABA; |FINSI;
          |FINSI;
          |CIERRA #73;
     |FINSI;

     |SI modo ! 3; |Y nForma = 1;
          |HAZ EsPCEGroup;
          |SI FSalida = 0;
               |SI eaPCEAsigna ! "N";  ||lo pone pcegz016
                    |HAZ PCEGAsigPed;
                    |SI FSalida ! 0; |ERROR; |ACABA; |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;

     |SI aprograma ! "agifa081";
          FEntrada  = 101;   || Como si fuera alta
     |FINSI;

     |SI Campo < 3;
          |HAZ defeclpc;
     |FINSI;
     enForma = 0 +. 1;

     |HAZ EsSanchez;
     |SI FSalida = 0;
         |SI modo = 3;
             |HAZ BajaSanchez;
         |FINSI;

         |SI modo = 2;
             |HAZ MiraSanchez;
             |SI nSwSanchez ! 0;
                 nSwSanchez = 0;
                 |SI nForma = - 1;
                     |MENAV "0000Modificacion no permitida, de debaja la linea...";
                 |FINSI;
                |ERROR; |ACABA;
             |FINSI;
         |FINSI;
     |FINSI;

     ||ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
     |SI codiBarra = "S"; |Y nModo = 1; |Y enForma = 1; |Y #2#176 = "S";
          |HAZ GrabaElemento;
     |FINSI;
     ||ÄÄÄÄÄÄÄÄÄÄÄÄ Doble/MultiÄ
     eaDocu = "agifa067";
     |HAZ StockEntra;
     ||ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
     |SI nSwTagloma = 0;
          eaArticulo = #0#2;
          enUniTagPen = #0#5 * nForma;
          eaSerie = #0#28;
          enDocu = #0#0;
          enLinea = #0#1;
          |HAZ TagCompraVario;
     |FINSI;
     ||ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ Modulo 000323
     |HAZ EsTecatel;
     |SI FSalida = 0;
          |HAZ TecaFecPed;
     |FINSI;
     ||ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ

     enTipEnvase = 2;
     |HAZ Envase67;

     nPreTon = 1;
     |HAZ EsVigor;
     |SI FSalida = 0;
          aAlfa = #19#110; |QBF aAlfa;   || Alfanumerico1
          aAlfa = aAlfa > "";
          |SI aAlfa = "S"; nPreTon = 1000; |FINSI;
     |FINSI;

     #1#11 = #1#11 +. #0#9;
     #1#12 = #1#12 +. #0#11;
     #1#13 = #1#11 - #1#12;
     #1#44 = #1#44 +. #0#56;

     |SI #1#29 = "D";                    || Si la moneda de trabajo es la divisa ...
          nPPort2 = #0#50;
     |SINO;
          nPPort2 = #0#50 / #1#33 * #1#28;
     |FINSI;

     |SI #2#196 = 2;
         nPend = ((#0#41 - #0#38) * #0#33/nPreTon) ! nDeci_BaseMxP;
     |SINO;
         nPend = ((#0#5 - #0#38) * #0#33/nPreTon) ! nDeci_BaseMxP;
     |FINSI;

     nPend = (((nPend < #0#8) < #0#27) < #0#57) ! nDeci_BaseMxP;

     |SI #2#196 = 2;
         nPend = nPend + (((#0#41 - #0#38)/nPreTon * nPPort2) ! nDeci_BaseMxP);
     |SINO;
         nPend = nPend + (((#0#5  - #0#38)/nPreTon * nPPort2) ! nDeci_BaseMxP);
     |FINSI;
/*
     nPend = (nPend < #1#5) ! nDeci_BaseMxP;
     nPend = (nPend < #1#17) ! nDeci_BaseMxP;
     nPend = (nPend < #1#6) ! nDeci_BaseMxP;
*/
     nBrutoMoneda1 = nPend;
     nImporDescue1 = (nBrutoMoneda1 % #1#5) ! nDeci_BaseMxP;
     nBrutoMoneda1 = nBrutoMoneda1 - nImporDescue1;
     nImporDescue2 = (nBrutoMoneda1 % #1#17) ! nDeci_BaseMxP;
     nBrutoMoneda1 = nBrutoMoneda1 - nImporDescue2;
     nImporDescue3 = (nBrutoMoneda1 % #1#6) ! nDeci_BaseMxP
     nBrutoMoneda1 = nBrutoMoneda1 - nImporDescue3;
     nPend = nBrutoMoneda1;

     #1#34 = #1#34 +. #0#34;
     #1#35 = #1#35 +. nPend;
     #1#36 = #1#34 - #1#35;

     |HAZ panpecom;

     |SI modo = 3;
          |HAZ EsPCEGroup;
          |SI FSalida = 0;
               |HAZ PCEGDesasigPed;
          |FINSI;
          ||ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
          |HAZ EsAlbadis;
          |SI FSalida = 0;
               eaDocu = "PC";
               eaSerie = #0#28;
               enCodigo = #0#0;
               enLinea = #0#1;
               |HAZ BseBorraUni;
          |FINSI;
          ||ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
          |SI nSwTagloma = 0;
               |HAZ TagBorCliPed;
          |FINSI;

         eaTipo      = "PC";
         eaSerie     = #0#28;
         enCodigo    = #0#0;
         enLinea     = #0#1;
         eaAbono     = "N";
         eaReservado = #0#22;
         enTarifa    = 0;
         eaArticulo  = #0#2;
         enAlmacen   = #0#3;
         eaProve = #1#4;
         |SUB_EJECUTA_NP "dsz00002;BAJA";
         |HAZ BorraKit;

         |SI #agifa142#206 = "S";
               aTipoDA = "P"; |HAZ BajaDAC;
         |FINSI;
     |FINSI;

     |HAZ EsAlbero;
     |SI FSalida = 0;
         |SI modo = 3;
             |HAZ AlbeBorraPdte;
         |SINO;
             |HAZ AlbeModifPdte;
         |FINSI;
     |FINSI;

     |SI modo ! 3; |Y nSwTagloma = 0;
          |HAZ TagDesTipo;
     |FINSI;
     |SI nSwTaller = 0; |HAZ TallerCanon67; |FINSI;

     |HAZ EsCoimasa;
     |SI FSalida = 0;
          |HAZ CoimaHistorico;
          |SI modo ! 3; |HAZ CoimaAuxArti; |FINSI;
     |FINSI;

     |HAZ EsDesanch;
     |SI FSalida = 0;
          |HAZ ActDesanch67;
     |FINSI;

     |HAZ EsOk5050;
     |SI FSalida = 0;      || Para que entre en el tipo16/17 del arti/alma
          eaSerie = #0#28; || tambien esta en el tipo2 de la cabecera
          enCodigo = #0#0;
          enLinea = #0#1;
          enModo = modo;
          enOk5050 = 1;
          |ABRE #8;
          #8#0 = #0#2;
          #8#1 = #0#3;
          |LEE 020#8=;
          |GRABA 020#8a;
          |CIERRA #8;
     |FINSI;
|FCAL;

|CALCULO panpecom;|TIPO 13;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 3; |ACABA; |FINSI;

     |HAZ visual_totales;

     |ABRE #142; |LEE 000#142p; |CIERRA #142;
     |SI #142#148 = "S";
          |PINTA 1034, "Portes:";
     |FINSI;
|FCAL;

|PROCESO DespresIva;
     |HAZ EsAlbero;
     |SI FSalida = 0;
          |HAZ AlbePedModL;
     |FINSI;
|FPRC;

|PROCESO nomodif4; |TIPO 0;
     |ABRE #6;
     #6#0 = #1#4;
     |LEE 000#6=;
     |SI #6#90 = "S";
          #0#14 = 0; |PINTA #0#14;
     |FINSI;
     |CIERRA #6;

     |ABRE #90;
     #90#26 = #1#25;
     |LEE 000#90=;
     |SI #90#30 = "S";
          #0#14 = 0; |PINTA #0#14;
     |FINSI;
     |CIERRA #90;

     ||FIN............................................
     |QBF r_arti;
     |SI r_arti ! "";
          #0#2 = r_arti;
          |PINTA #0#2;
     |FINSI;
     modo = (FEntrada / 100) ! 0;

     |SI modo = 1;
          #0#3 = def_alm;
          |HAZ EsConstru;
          |SI FSalida = 0;
               eaArticulo = #0#2;
               |HAZ ConstruDefAlma;
               #0#3 = enAlmacen; |PINTA #0#3;
          |FINSI;
     |FINSI;
     |SI #0#2 = vacio;
          |CAMPO_MODIFICA #0#3,  1, "N";
          |CAMPO_MODIFICA #0#5,  1, "N";
          |SI #1#29 = "B";
            |CAMPO_MODIFICA #0#6,  1, "N";
          |SINO;
            |CAMPO_MODIFICA #0#33,  1, "N";
          |FINSI;
          |CAMPO_MODIFICA #0#8,  1, "N";
          |CAMPO_MODIFICA #0#27,  1, "N";
          |CAMPO_MODIFICA #0#57,  1, "N";
          |CAMPO_MODIFICA #0#10, 1, "N";
          |CAMPO_MODIFICA #0#11, 1, "N";
          |CAMPO_MODIFICA #0#13, 1, "N";
          |CAMPO_MODIFICA #0#14, 1, "N";
     |SINO;
          |CAMPO_MODIFICA #0#3,  1, "S";
          |CAMPO_MODIFICA #0#5,  1, "S";
          |SI #1#29 = "B";
            |CAMPO_MODIFICA #0#6,  1, "S";
          |SINO;
            |CAMPO_MODIFICA #0#33,  1, "S";
          |FINSI;
          |CAMPO_MODIFICA #0#8,  1, "S";
          |CAMPO_MODIFICA #0#27,  1, "S";
          |CAMPO_MODIFICA #0#57,  1, "S";
          |CAMPO_MODIFICA #0#10, 1, "S";
          |CAMPO_MODIFICA #0#11, 1, "S";
          |CAMPO_MODIFICA #0#13, 1, "S";
          |CAMPO_MODIFICA #0#14, 1, "S";
     |FINSI;
|FPRC;

|| *********************** *(1)
|PROCESO leeotro; |TIPO 11;
     modo = (FEntrada / 100) ! 0;
     salida = FSalida;        || ESTO ES PARA EL CONTROL DE ENTRADA DE TEXTOS.
     inkey = FSalida;

     |SI Campo ! 1;
          |SI inkey = 7; |Y nSwDA = 1;
               |MENAV "      Imposible anular;  Termine de introducir la linea y efectue una Baja.";
               |ERROR;
               |ACABA;
          |FINSI;
     |FINSI;

|| **** CALCULOS SOLO PARA EL CAMPO LINEA ****
     |SI Campo ! 1; |ACABA; |FINSI;

     ||ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
     |HAZ EsAlbero;
     |SI FSalida = 0;
          |HAZ AlbePedComLin2;
     |FINSI;
     ||ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ

     |SI inkey = 10;     ||F2
          |HAZ MenuTrack67;
          |SI FSalida = 0; |ERROR; |ACABA; |FINSI;
          inkey = FSalida;
     |FINSI;

     nSwDA = 0;
     |SI inkey = 18;     || F10
           |HAZ tx;
     |FINSI;
     |SI inkey = 14;
          |SI modo = 1;
               |MENAV "0000Opcion no disponible en alta...";
          |SINO;
               c_prove = #1#4;
               c_artic = #0#2;
               c_serie = #1#25;
               entrada = 1;
               |SUB_EJECUTA_NP "agifa383.run";
         |FINSI;
         |ERROR;
         inkey = 0;
     |FINSI;
     |SI inkey = 9;
         |PUSHV 0101 2380;
         |CLS;
         |PINPA #0#1;
         |PINDA #0#1;
         |PAUSA;
         |POPV;
         |ERROR;
     |FINSI;

     |SI inkey = 13;          || F5
          |HAZ EsAlbadis;
          |SI FSalida = 0;
               eaDocu = "PC";
               eaSerie = #0#28;
               enCodigo = #0#0;
               enLinea = #0#1;
               enPrecio = #0#6;
               enPVerde = #0#56;
               |HAZ BseVerUni;
               |ERROR; |ACABA;
          |FINSI;

          |HAZ VerKit;
          ||ÄÄÄÄÄÄÄÄÄÄÄÄ Doble/MultiÄ
          eaDocu = "agifa067";
          |HAZ VerDobleUni;
          |ERROR; |ACABA;
          ||ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
     |FINSI;

     |SI inkey = 11;
          ser_ped = #0#28;
          num_ped = #0#0;
          lin_ped = #0#1;
          |PUSHV 0501 2380;
          |SUB_EJECUTA_NP "dsy00003";
          |POPV;
          |ERROR;
          |ACABA;
     |FINSI;

     |SI inkey = 12;
          |SI inkey = 12; |Y recoge = "N"; ||F4
               |MENAV "0000Opcion no activada en Utilidades Usuario de Parametros Generales";
               |ERROR;
               |ACABA;
          |FINSI;
          modo = (FEntrada/100) !0; ||Controlando el modo aqui siempre estare en alta?.Pero va bien

          || compruebo que este en la ultima linea y en modo alta
          nLineaD = #0#1;    || Guardo puntero
          nLineaD = nLineaD +1;     || Porque si estoy en alta la linea en la que
                                 || estoy todavia no esta grabada
          |LEE 001#0];
          |SI FSalida ! 0;|O #0#0 ! #agifa081#0;
                      |O #0#28 ! #agifa081#25;|Y modo = 1;
               nLineaD = nLineaD -1;
               || Recupero el puntero
               #0#0  = #agifa081#0;    || pedido
               #0#28 = #agifa081#25;   || Serie
               #0#1  = nLineaD;        || Numero de linea
               |LEE 001#0=;
               nerror = 0;
               |SI inkey = 12;
                    |HAZ entradatos;
               |FINSI;
               |SI nerror = 0 ;
                    |SI inkey = 12;
                         |HAZ leelineas;
                    |FINSI;
                    |HAZ control2;
                    |PTEC 816;
                    |PTEC 812;
               |SINO;
                    |ERROR;
               |FINSI;
          |SINO;
               || Recupero el puntero
               nLineaD = nLineaD -1;
               #0#0  = #agifa081#0;     || pedido
               #0#28 = #agifa081#25;    || Serie
               #0#1  = nLineaD;         || Numero de linea
               |LEE 001#0=;
               |MENAV "0000Debe estar en la ultima linea";
               |ERROR;
          |FINSI;
     |FINSI;
     |SI inkey = 16; |Y #agifa142#206 = "S";
          aTipoDA = "P"; |HAZ VerDAC;
          |ERROR;
     |FINSI;
     |SI inkey = 15;
          |HAZ VerPendte;
          |ERROR;
     |FINSI;
     |SI inkey = 20;          ||Ctrl+F2
          |HAZ EsTagloma;
          |SI FSalida = 0;
               eaArticulo = #0#2;
               |HAZ TagPrecio;
               |ERROR;
          |FINSI;
     |FINSI;
     |SI inkey = 25; || Ctrl-F7
          |HAZ CreaTempo;
          eaFichero = Tempo;
          |SUB_EJECUTA_NP "psion066";
          |HAZ BoraTempo;
          |SI enError = 0; |HAZ ImportaPDA67; |FINSI;
          |ERROR; |ACABA;
     |FINSI;
     |SI inkey = 33; || SHIFT + F5
           |ABRE #2; #2#0 = #0#2; |LEE 020#2=; |CIERRA #2;
           |SI #2#176 = "S";
               eaTipo      = "PC";
               eaSerie     = #0#28;
               enCodigo    = #0#0;
               enLinea     = #0#1;
               eaArticulo  = #0#2;
               enAlmacen   = #0#3;
               enUnidades  = #0#5;
               enTBruto    = #0#7;
               eaAbono     = "N";
               eaReservado = #0#22;
               enTarifa    = 0;
               eaProve     = #1#4;
               enCamBas    = #1#28;
               eaMoneda    = #1#29;
               enCamDiv    = #1#33;
               |SUB_EJECUTA_NP "dsz00002;CONSU";
           |FINSI;
           |ERROR;
     |FINSI;
|FPRC;

|PROCESO Dto67; |TIPO 7;
     |SI FSalida = 0;
          |HAZ EsTagloma;
          |SI FSalida = 0;
               eaArticulo = #0#2;
               |HAZ TagPrecioAuto;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO entradatos;
     |PINTA 2420 , " Recogida de datos del pedido  :      /    ";
     alfa1 = "";
     E_sup = 5;
     E_inf = "";
     alfa1 = 2453 ? 1;
     serie_o = alfa1;
     alfa2 = "";
     E_sup = 6;
     E_inf = "";
     alfa2 = 2459 ? 1;
     pedido_o = alfa2;
     |BLIN 24;

     |SI  serie_o = #agifa081#25;|Y pedido_o = #agifa081#0;
          |MENAV "0000ATENCION !!! Esta en este pedido";
          nerror = 1;
     |FINSI;
|FPRC;

|PROCESO control1;
   aponer= Asino;
   |HAZ poncontr1;
|FPRC;

|PROCESO control2;
   aponer= Anosi;
   |HAZ poncontr1;
|FPRC;

|PROCESO poncontr1;
         fiac = Control % A109;
         fiac = fiac + relleno;
         guarda = fiac % A109;
         fiac = Control % A1001;
         Control = Control + fiac;
         Control = Control + relleno;
         Control = Control % A120;
         Control = Control + aponer;
|FPRC;

|PROCESO CreaComponente;
     #905#0 = "PC";
     #905#1 = #0#28;
     #905#2 = #0#0;
     #905#3 = #0#1;
     #905#9 = #905#6;
     |GRABA 020#905n;
     |LIBERA #905;

     eaTipo       = "PC";
     eaArticulo   = #0#2;
     enAlmacen    = #0#3;
     eaComponente = #905#4;
     eaReservado  = #0#22;
     enCamBas     = #1#28;
     eaMoneda     = #1#29;
     enCamDiv     = #1#33;

     |SUB_EJECUTA_NP "dsz00002;PCC";
|FPRC;

|DEFBUCLE dsm00005;
     #905#1;
     ;
     "PC", serie, pedido, nlinea, "      ";
     "PC", serie, pedido, nlinea, "zzzzzz";
     be;
     NULL, CreaComponente;
|FIN;

|PROCESO crealineasV;
     #0#28= #agifa081#25;    || Serie
     #0#0 = #agifa081#0;     || Numero de Pedido
     #0#1 = nLineaD;         || Numero de linea
     |DEFECTO #0#agifa081;   || Cargo los valores de defecto de cab.pedido
     |HAZ defeclpc;          || Este proceso carga los defectos, ya que
                             || estos no estan puestos en D000
                             || porque no iba bien.
     |DEFECTO #0#agifa019;   || Cargo defectos de articulo
     #0#5 = #0#37;
     #0#12 = 0;
     #0#15 = "N";            || Bloqueado = N
     #0#21 = "";             || Numero de albaran
     #0#22 = "N";            || Reservado
     #0#29 = 0;
     #0#30 = "";
     #0#31 = 0;
     #0#32 = 0;
     #0#38 = 0;
     #0#41 = #0#45;
     #0#44 = 0;
     #0#46 = 0;
     |HAZ lpctotal;     || Calculo total linea
     |HAZ lpcacart;     || Lo envio al tipo 2 para que calcule lo mismo que si fuera
                       || una linea introducida por el operador
     |GRABA 021#0b;
     |LIBERA #0;

     |BUCLE dsm00005;

     nLineaD = nLineaD + 1;  || Aumento contador de lineas
|FPRC;


|PROCESO leelineas;
      #0#28= serie_o;
      #0#0 = pedido_o;
      #0#1 = 1;
      |LEE 001#0];
      |SI FSalida =0;
           |PARA;|SI FSalida =0;|Y #0#28=serie_o;|Y #0#0=pedido_o; |HACIENDO;
                  || Me guardo el puntero
                  serie   = #0#28;   || Serie y pedido actual
                  pedido  = #0#0;
                  nlinea  = #0#1;
                  |HAZ crealineasV;
                  || Recupero puntero
                  #0#28 = serie;
                  #0#0  = pedido;
                  #0#1  = nlinea;
                  |LEE 001#0=;
                  |LEE 001#0s;
           |SIGUE;
      |SINO;
           |MENAV "0000Atencion !!! No se ha encontrado el pedido indicado";
           |ERROR;
      |FINSI;
      || Devuelvo el puntero de la linea
      #0#28= #agifa081#25;       || Serie
      #0#0 = #agifa081#0;        || pedido
      #0#1 = nLineaD;            || Linea
      |LEE 001#0=;
|FPRC;

________________________/ TEXTO LINEAS.......................................
|PROCESO min34;
     #80#0 = #0#28;
     #80#1 = #0#0;
     #80#2 = #0#1;
     #80#3 = 1;
|FPRC;

|PROCESO max34;
     #80#0 = #0#28;
     #80#1 = #0#0;
     #80#2 = #0#1;
     #80#3 = 200;
|FPRC;

|PROCESO tx;
     |ABRET #80;
     |ABRE #220;
     |PUSHV 0501 2380;
     |PINPA #0#80;
     |PARA ind = 1; |SI ind [ 200; |HACIENDO ind = ind + 1;
          #80#0 = #0#28;
          #80#1 = #0#0;
          #80#2 = #0#1;
          #80#3 = ind;
          |LEE 141#80=;
          |SI FSalida ! 0;
               #220#0 = #0#2;
               #220#1 = ind;
               |LEE 000#220=;
               |SI FSalida = 0;
                    #80#4 = #220#2;
               |SINO;
                    #80#4 = "";
               |FINSI;
               |GRABA 021#80n;
          |FINSI;
          |LIBERA #80;
     |SIGUE;
     |CIERRA #220;
     |MENSA "0000< ESC > SALIR.";
     |ENTLINEAL #1#80,1,4,21,1,min34,max34;
     |PARA ind = 200; |SI ind ] 1; |HACIENDO ind = ind - 1;
          #80#0 = #0#28;
          #80#1 = #0#0;
          #80#2 = #0#1;
          #80#3 = ind;
          |LEE 141#80=;
          |SI FSalida = 0;
               alfa = #80#4;
               |QBF alfa;
               |SI alfa ! ""; |SAL; |FINSI;
               |BORRA 021#80a;
          |FINSI;
          |LIBERA #80;
     |SIGUE;
     |POPV;
     |CIERRAT #80;
     |ERROR;
     salida = 0;
|FPRC;

 REGISTRO DE ACTUALIZACIONES

*(1) ... Mediante la pulsacion de F4 podremos recoger las lineas de otro
         pedido de compra.
         (Lorca 18/07/96)

*(2)...  Utilizamos este proceso entero para la creacion de albaranes desde
         otros procesos, por tanto forzamos esos valores, si no estamos en
         ese momento en el mantenimiento propiamente dicho (p.e. solis008)
         (Lorca 19/07/96).


|| _____________________________ VER CAMBIO DE PRECIOS. PROVEEDOR / ARTICULO.

|PROCESO Mensaje;
     |HAZ EsSanchez;
     |SI FSalida = 0; |ACABA; |FINSI;

     |PUSHV 0501 2380;
     |AVISO;
     |COLOR 0, 0; |ATRI 0;
     |BLANCO 0815 1265;
     |COLOR 14, 0; |ATRI 0;
     |D_CUADRO 0815,1265;
     |ATRI S;
     |PINTA 1017, alfa;
     |ATRI 0;
     |PAUSA;
     |POPV;
|FPRC;

|PROCESO cambipre; |TIPO 0;
     salida = FSalida;
     |SI #142#75 ! "S"; |ACABA; |FINSI;
     ||ÄÄÄÄÄÄÄÄÄÄÄÄ Doble/MultiÄ
     eaDocu = "agifa067";
     |HAZ LeePreDtoCom;
     ||ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
     |SI #1#29 = "B";
          |SI enPrecio ! #0#6;
               alfa = "­ ATENCION ! POSIBLE CAMBIO DE PRECIO COSTE...";
               |HAZ Mensaje;
               |HAZ Desanch67;
          |FINSI;
     |SINO;
          |SI enPreDiv ! #0#33;
               alfa = "­ ATENCION ! POSIBLE CAMBIO DE PRECIO COSTE...";
               |HAZ Mensaje;
               |HAZ Desanch67;
          |FINSI;
     |FINSI;
     FSalida = salida;
|FPRC;

|PROCESO cambidto;
     |SI #142#75 ! "S"; |ACABA; |FINSI;
     ||ÄÄÄÄÄÄÄÄÄÄÄÄ Doble/MultiÄ
     eaDocu = "agifa067";
     |HAZ LeePreDtoCom;
     ||ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
     |SI enDto1 ! #0#8; |Y Campo = 8;
          alfa = "­ ATENCION ! POSIBLE CAMBIO DE DESCUENTO 1 ...";
          |HAZ Mensaje;
     |FINSI;
     |SI enDto2 ! #0#27; |Y Campo = 27;
          alfa = "­ ATENCION ! POSIBLE CAMBIO DE DESCUENTO 2 ...";
          |HAZ Mensaje;
     |FINSI;
     |SI enDto3 ! #0#57; |Y Campo = 57;
          alfa = "­ ATENCION ! POSIBLE CAMBIO DE DESCUENTO 3 ...";
          |HAZ Mensaje;
     |FINSI;
|FPRC;
------------------ ACTUALIZA ARTICULOS Y ALMACEN -------------------------

|PROCESO decim1;
     modo = (FEntrada / 100) ! 0;
     |SI #2#176 = "S";
         |SI codiBarra = "N"; |O modo ! 1;
             |SI #1#29 = "D";  || Si la moneda de trabajo es la divisa ...
                 #0#33 = nPrecio;
             |SINO;
                 #0#6  = nPrecio;
             |FINSI;
         |FINSI;
     |FINSI;

     |SI #1#29 = "D";  || Si la moneda de trabajo es la divisa ...
         #0#6 = #0#33 / #1#28 * #1#33;  || ... recalculo en funcion de la divisa
     |SINO;
         #0#33 = #0#6 / #1#33 * #1#28; || .. recalculo en funcion de la moneda base
     |FINSI;

     |HAZ visual_precio; || Visualiza el precio
     |HAZ PintaUniMediC;
|FPRC;

|PROCESO FecEntra
     |ABRE #6;
     #6#0 = #1#4;
     |LEE 020#6=;
     |CIERRA #6;
     #0#13 = #1#2;
     ||ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
     |HAZ EsTecatel;
     |SI FSalida = 0;
          #0#13 = "11.11.1111";
     |FINSI;
     ||ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
|FPRC;

|PROCESO LinDiv;  |TIPO 7;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 1;
          |HAZ FecEntra;
     |FINSI;

     ||ÄÄÄÄÄÄÄÄÄÄÄÄ Doble/MultiÄ
     eaDocu = "agifa067";
     |HAZ PintaUniMediC;
     ||ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
     |HAZ EsAlbero;
     |SI FSalida = 0;
          |HAZ AlbePedComLin1;
     |FINSI;
     ||ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ

     |ABRE #agifa321;
     |LEE 001#agifa321.p;  || Leo parametros de divisa
     |CIERRA #agifa321;

     |SI ac_divisa ! "S";
          |ATRI R;
          |PINTA 1447, "Precio";
          |PINTA 1465, "I.Total";
          |ATRI r;
     |SINO;
          |SI pintado = 0; || Si divisas estan activadas y no he pintado ...
               |SI #1#29 = "D";   || Si la moneda de trabajo es la divisa la pinto en
                    |ATRI R;         || el encabezado del precio y el importe
                    titdiv = "Precio" + "(" + #1#27 + ")";
                    |PINTA 1444,titdiv;
                    titdiv = "I.Tot." + "(" + #1#27 + ")";
                    |PINTA 1468,titdiv;
                    |ATRI r;
               |SINO;
                    |ATRI R;
                    |PINTA 1447, "Precio";
                    |PINTA 1465, "I.Total";
                    |ATRI r;
               |FINSI;
               |SI #agifa321#4 = "S";  || Si la visualizacion esta activada ...
                    ||mensa = "Precio:             Imp:                                                      ";
                    ||PINTA 1102,mensa;  || ... pinto la linea de visualizacion
                    |PINTA 1102, "Precio:";
                    |PINTA 1122, "Imp:";
                    |PINTA #0#35; || Pinto precio visual
                    |PINTA #0#36; || Pinto importe visual
                    |SI #1#29 = "D"; || Si la moneda de trabajo es la divisa
                         #1#37 = #1#34;
                         #1#38 = #1#35;
                         #1#39 = #1#36;
                         #1#40 = #1#11;
                         #1#41 = #1#12;
                         #1#42 = #1#13;
                         |PINTA 1145,#1#41;
                         |PINTA 1157,#1#42;
                         |PINTA 1169,#1#40;
                    |SINO;
                         #1#37 = #1#11;
                         #1#38 = #1#12;
                         #1#39 = #1#13;
                         #1#40 = #1#34;
                         #1#41 = #1#35;
                         #1#42 = #1#36;
                         |PINTA 1145,#1#35;
                         |PINTA 1157,#1#36;
                         |PINTA 1169,#1#34;
                    |FINSI;
                    pintado = 1;  || Ya hemos pintado
               |FINSI;
          |FINSI;
     |FINSI;
     |HAZ EsAlbero;
     |SI FSalida = 0;
          |HAZ AlbePedPintaL;
     |FINSI;
     |HAZ EsTagloma;
     |SI FSalida = 0;
          |HAZ TagloPinPeCom;
     |FINSI;
|FPRC;

|PROCESO upc_div;
     |SI eaDivisa = #1#27;
          #0#6 = #0#33 * #1#33 / #1#28;  || Calculo el precio en divisa
     |SINO;
          #0#33 = #0#6 / #1#33 * #1#28;  || Calculo el precio en divisa
     |FINSI;
     |HAZ visual_precio;
|FPRC;


|PROCESO visual_precio; || Pinta el precio visual.
|SI #1#29 = "D";  || Si la moneda de trabajo es la divisa ...
  #0#35 = #0#6;   || ... el campo visualiz. es el precio en moneda base
  |PINTA #0#33;
|SINO;            || Si la moneda de trabajo es la moneda base ...
  #0#35 = #0#33;  || ... el campo visual. es el precio en divisa
  |PINTA #0#6;
|FINSI;
|SI ac_divisa = "S"; |Y #agifa321#4= "S";
  |PINTA #0#35; || Si las divisas y la visualizacion estan activadas, pinto
|FINSI;
|FPRC;


|PROCESO visual_importe;  || Pinta el importe visual
|SI #1#29 = "D";  || Si la moneda de trabajo es la divisa ...
  #0#36 = #0#9;   || el campo visualiz. es el importe en moneda base
  |PINTA #0#34;
|SINO;            || Si la moneda de trabajo es la moneda base ...
  #0#36 = #0#34;  || el campo visualiz. es el importe en divisa
  |PINTA #0#9;
|FINSI;
|SI ac_divisa = "S"; |Y #agifa321#4= "S";
  |PINTA #0#36; || Si las divisas y la visualizacion estan activadas, pinto
|FINSI;
|FPRC;

|PROCESO visual_totales;
     |ABRE #agifa321;
     |LEE 000#agifa321.p;
     |CIERRA #agifa321;

     |SI #1#29 = "D";
          #1#37 = #1#34;
          #1#38 = #1#35;
          #1#39 = #1#36;
          #1#40 = #1#11;
          #1#41 = #1#12;
          #1#42 = #1#13;
          |SI ac_divisa = "S"; |Y #agifa321#4= "S";
               |PINTA 1145,#1#41;
               |PINTA 1157,#1#42;
               |PINTA 1169,#1#40;
          |FINSI;
          |PINTA 1345,#1#35;
          |PINTA 1357,#1#36;
          |PINTA 1369,#1#34;
     |SINO;
          #1#37 = #1#11;
          #1#38 = #1#12;
          #1#39 = #1#13;
          #1#40 = #1#34;
          #1#41 = #1#35;
          #1#42 = #1#36;
          |SI ac_divisa = "S"; |Y #agifa321#4= "S";
               |PINTA 1145,#1#35;
               |PINTA 1157,#1#36;
               |PINTA 1169,#1#34;
          |FINSI;
          |PINTA 1345,#1#12;
          |PINTA 1357,#1#13;
          |PINTA 1369,#1#11;
     |FINSI;
|FPRC;

|| LLAMADAS DESDE EL CAMPO DEL ARTICULO

|PROCESO CogeValores67;  |TIPO 7;
     |ABRE #142;
     |LEE 001#142p;
     |SI FSalida ! 0; |DDEFECTO #142; |FINSI;
     |CIERRA #142;

     |SI Campo = 3;
         |C_M #0Campo, 1, "S";
         |SI #142#99 = "S";
             |C_M #0Campo, 1, "N";
             #0Campo = 1;  |PINTA #0Campo;
         |FINSI;
     |FINSI;

     |SI #2#176 = "N";  |ACABA;  |FINSI;

     |SI Campo = 3;
         |SI enAlmacen ! 0;
             #0#3 = enAlmacen;  |PINTA #0#3;
         |FINSI;
     |FINSI;

     |SI Campo = 5;
         |SI enUnidades ! 0;
             |SI #0#5 ! enUnidades;  Contenido = #0#5;  |FINSI;
             #0#5 = enUnidades;  |PINTA #0#5;
         |FINSI;
     |FINSI;

     |SI Campo = 6;
         |SI nPrecio ! 0;
             #0#6 = nPrecio;  |PINTA #0#6;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO PideArt67;  |TIPO 7;
     nModo = (FEntrada / 100) ! 0;

     aAlfa = "0000<F2> Consulta Articulo/Proveedor   <F8> Descripcion Ampliada";
     |HAZ EsTagloma;
     |SI FSalida = 0;
          aAlfa = "0000<F2>Consulta Arti/Prv  <F5>Ped.Varios <F6>Cambio Cli. <F7>Asociar Cli. <F8>D.A.";
     |FINSI;
     |HAZ EsAparecida;
     |SI FSalida = 0;
          aAlfa = "0000<F2>Consulta Articulo/Proveedor  <F5>Alta Articulo  <F8>Descripcion Ampliada";
     |FINSI;
     |HAZ EsForestales;
     |SI FSalida = 0;
          aAlfa = "0000<F2> Consulta arti./prov.,  <F3> Buscar articulo,  <F8> Desc. ampliada";
     |FINSI;
     |MENSA aAlfa;

     |SI #142#140 = "S"; |Y nModo = 1; #0#2 = eaArtAnt; |FINSI;

     |C_M #0#2, 1, "S";
     |C_M #0#3, 1, "N";

     |SI #0#2 ! "                    ";
         |ABRE #2;
         #2#0 = #0#2;
         |LEE 000#2=;
         |SI FSalida ! 0;  |DDEFECTO #2;  |FINSI;
         |CIERRA #2;
         |SI #2#176 = "S";
             |C_M #0#2, 1, "N";
             |C_M #0#3, 1, "N";
             |ACABA;
         |FINSI;
     |FINSI;

     |ABRE #910;
     |LEE 040#910p;
     |SI FSalida ! 0;  |DDEFECTO #910;  |FINSI;
     |CIERRA #910;

     |SI #910#2 [ 2;    |ACABA;  |FINSI;

     eAlfa = #0Campo;
     |SUB_EJECUTA_NP "dsz99990";                 || Por Pantalla

     |SI eAlfa = "-1";  |PTEC 807;  |ACABA;  |FINSI;
     |SI eAlfa = "-2";              |ACABA;  |FINSI;

     eaArticulo = eAlfa;      ||  700000-4215

     #0Campo = eAlfa;
     |PINTA #0Campo;
     |PTEC 802;
|FPRC;

|PROCESO Calc667;  |TIPO 6;
     modo = (FEntrada / 100) ! 0;
     salida = FSalida;

     |SI FSalida = 10; |Y Campo = 4;    ||F2
          |VARIABLES; {20} aPopu = ""; |FINSI;
          aPopu1 = "-1";  || Si fuera -1 en la posicion
          aPopu2 = 2;
          aPopu3 = "<F8> Descripcion Ampliada";
          aPopu4 = "<F11> Cambio Unidad";
          |ESPECIFICA "TRACKPOPUP", aPopu;
          nSal = FSalida;
          |SI FSalida = 1; nSal = 16; |FINSI;
          |SI FSalida = 2; |HAZ Multi67; |FINSI;
          FSalida = nSal;
          |SI FSalida = 0; |ERROR; |ACABA; |FINSI;
          salida = FSalida;
     |FINSI;


     |SI #0Campo ! Contenido; |Y Campo = 2;
          eaArticulo = #0#2;
          |HAZ DefectoMediC;
          #0#47 = enMedida1;
          #0#48 = enMedida2;
          #0#49 = enMedida3;
     |FINSI;
     |SI salida = 11;   ||F3
          |HAZ EsForestales;
          |SI FSalida = 0;
               |SUB_EJECUTA_NP "goma0008";
               |SI eaArticulo ! "";
                    #0Campo = eaArticulo;
                    |PINTA #0Campo;
               |SINO;
                    |ERROR; |ACABA;
               |FINSI;
          |FINSI;
     |FINSI;
     |SI salida = 12;   ||F4
          |ABRE #29;
          #29#0 = #0#3;
          |LEE 000#29];
          |CONSULTA_CLAVE #1#29;
          |SI FSalida = 0;
               #0#3 = #29#0;
               |PINTA #0#3;
          |SINO;
               |ERROR; |ACABA;
          |FINSI;
          |CIERRA #29;
     |FINSI;

     |SI salida = 16;   ||F8
          aTipoDA = "P";
          nSwDA = 1;
          enSwFuerzaDA = 1;
          |HAZ AltaDAC;
          enSwFuerzaDA = 0;
          |ERROR; |ACABA;
     |FINSI;
     |SI salida = 13; |O salida = 14; |O salida = 15; ||F5 / F6 /F7
          |HAZ EsTagloma;
          |SI FSalida = 0;
               |SI salida = 13;
                    eaCliente = "";
                    |HAZ TagConTipo;
               |FINSI;
               |SI salida = 14;
                    |SI modo = 1;
                         |HAZ TagConTipoCli;
                         |HAZ TagConTipo;
                    |SINO;
                         |MENAV "0000Opcion solo en altas..."; |ERROR;
                    |FINSI;
               |FINSI;
               |SI salida = 15;
                    aAlfa = #0#2; |QBF aAlfa;
                    |SI aAlfa = "";
                         |MENAV "0000Introduzca antes el articulo...";
                         |ERROR; |ACABA;
                    |SINO;
                         |HAZ TagAsociaCli;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
     |SI salida = 13; ||F5
          |HAZ EsAparecida;
          |SI FSalida = 0;
               |SUB_EJECUTA_NP "aparm005";
               |ERROR; |ACABA;
          |FINSI;
     |FINSI;

||************SOLO PARA EL CAMPO 2 ************
     |SI Campo ! 2; |ACABA; |FINSI;
||*********************************************
     eaArtAnt = #0#2;
     ||ÄÄÄÄÄÄÄÄÄÄÄÄ Doble/MultiÄ
     eaDocu = "agifa067";
     |HAZ UniPartiCB;
     ||ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
     enAlta = 1;
     eaArticulo = #0Campo;
     |HAZ LlenaArticulo;
     |SI FSalida = 0;
          #0Campo = eaArticulo;
          |PINTA #0Campo;
     |SINO;
          |ERROR; |ACABA;
     |FINSI;

     |HAZ art6pdc;

     |SI codiBarra = "S"; |Y #910#19 = "S"; |Y modo = 1;
          |ACABA;
     |FINSI;

     |DDEFECTO #2;
     |ABRE #2;
     #2#0 = #0#2;
     |LEE 000#2=;
     qCono = #2#27; |QBF qCono;
     |SI FSalida = 0;
          |SI #1#4 ! #2#27; |Y qCono ! "";
               |MENAV "0000El Proveedor no se corresponde con el habitual";
          |FINSI;
     |FINSI;
     |CIERRA #2;

     |HAZ SacaKit;
|FPRC;

|PROCESO Tipo067; |TIPO 0;
     |HAZ nomodif4;

     |SI Campo = 2;
          |HAZ EsDesanch;
          |SI FSalida = 0;
               |ABRE #2;
               #2#0 = #0#2;
               |LEE 000#2=;
               |SI FSalida = 0; |Y #2#135 = "N";
                    |MENAV "0000El articulo no es de entrada...";
                    |ERROR; |ACABA;
               |FINSI;
               |CIERRA #2;
          |FINSI;
     |FINSI;

     ||ÄÄÄÄÄÄÄÄÄÄÄÄ Doble/MultiÄ
     eaDocu = "agifa067";
     |HAZ PintaUniMediC;
     ||ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
     |SI #agifa142#206 = "S";
          aTipoDA = "P"; |HAZ DescriDAC;
     |FINSI;

     |HAZ Portes;

     |SI #agifa142#77 = "N";
          |ABRE #237;
          |SELECT #2#237;
          #237#7 = #1#4;
          #237#2 = #0#2;
          |LEE 000#237=;
          |SI FSalida ! 0;
               |MENAV "0000No existe Oferta Proveedor/Articulo";
               |ERROR; |ACABA;
          |SINO;
               |ABRE #226;
               #226#0 = #237#0;
               |LEE 000#226=;
               |SI #1#1 < #226#2; |O #1#1 > #226#3;
                    |MENAV "0000Oferta Proveedor/Articulo fuera de perido";
                    |ERROR; |ACABA;
               |FINSI;
               |CIERRA #226;
          |FINSI;
          |CIERRA #237;
     |FINSI;

     |ABRE #2; #2#0 = #0#2; |LEE 000#2=; |CIERRA #2;
     |SI #2#176 = "S";
          eaTipo      = "PC";
          eaSerie     = #0#28;
          enCodigo    = #0#0;
          enLinea     = #0#1;
          eaArticulo  = #0#2;
          enAlmacen   = #0#3;
          enUnidades  = #0#5;
          enTBruto    = #0#7;
          eaAbono     = "N";
          eaReservado = #0#22;
          enTarifa    = 0;
          eaProve     = #1#4;
          enCamBas    = #1#28;
          eaMoneda    = #1#29;
          enCamDiv    = #1#33;

          |SUB_EJECUTA_NP "dsz00002";

          #0#3    = enAlmacen;
          nPrecio = enTBruto / enUnidades;

          |PTEC 802;
          |PTEC 802;
          |PTEC 802;
          |PTEC 802;
     |FINSI;
|FPRC;

|PROCESO Multi67; |TIPO 66;
     ||ÄÄÄÄÄÄÄÄÄÄÄÄ Doble/MultiÄ
     eaDocu = "agifa067";
     |HAZ CambiaUniMulti;
     |SI enError = 0;
          |HAZ LeePreDtoCom;
          #0#6 = enPrecio;
          #0#33 = enPreDiv;
          ||ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
          |HAZ upc_div;
     |FINSI;
|FPRC;

|PROCESO Tipo11067;  |TIPO 11;
     salida = FSalida;
     |SI FSalida = 7;  |Y #2#176 = "S";
         |MENAV "      Imposible abortar;  Termine de introducir la linea y efectue una Baja.";
         |ERROR;
     |FINSI;
     |SI FSalida = 7; |Y nSwDA = 1;
          |MENAV "      Imposible anular;  Termine de introducir la linea y efectue una Baja.";
          |ERROR;
     |FINSI;
|FPRC;

|PROCESO CtaArt1;
   eaModulo = "agifa081"; |HAZ CtaArt;
|FPRC;


|PROCESO Portes;
|FPRC;

|PROCESO PenServir;
     nPend = #67#5 - #67#38;
     |SI nPend > 0;
          #51#0 = #67#1;
          #51#1 = #67#2;
          #51#2 = #67#4;
          #51#3 = #67#5;
          #51#4 = #67#38;
          #51#5 = nPend;
          |GRABA 020#51n;
          nHay = 1;
     |FINSI;
|FPRC;

|DEFBUCLE PenServir;
     #67#1003;
     ;
     #0#28, #0#0, 001;
     #0#28, #0#0, 999;
     ;
     NULL, PenServir;
|FIN;

|PROCESO Min51;
     #51#0 = 1;
|FPRC;

|PROCESO Max51;
     #51#0 = 999;
|FPRC;

|PROCESO VerPendte;
     |DDEF aAlfa;
     aAlfa = aAlfa + "agifa067";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |HAZ CreaTempo; aTempo51 = Tempo;
          |NOME_DAT #51 aTempo51; |DELINDEX #51;
          nHay = 0;
          |ABRE #51;
          |BUCLE PenServir;
          |CIERRA #51;
          |SI nHay = 0;
               |MENAV "0000No hay unidades pendientes de recibir...";
          |SINO;
               |PUSHV 0501 2380;
               |ENTLINEAL #1#51, 1, 4, 22, 1, Min51, Max51;
               |POPV;
          |FINSI;
          |DELINDEX #51; Tempo = aTempo51; |HAZ BoraTempo
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|PROCESO FecEnt67; |TIPO 0;
     |SI FSalida = 13;
          |HAZ EsAlbero;
          |SI FSalida = 0;
               ||HAZ AlbeConsuLin;
               |HAZ AlbeEntLin;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO MinC067;
     #referen@#28 = #1#25;
     #referen@#0 = #1#0;
     #referen@#1 = 001;
|FPRC;

|PROCESO MaxC067;
     #referen@#28 = #1#25;
     #referen@#0 = #1#0;
     #referen@#1 = 999;
|FPRC;

|PROCESO Consulta067; |TIPO 66;
     nLin = 0;
     |DDEF aAlfa;
     aAlfa = aAlfa + "agifa067";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          |CONSULTA_F_CLAVE #1#referen@, MinC067, MaxC067;
          |SI FSalida = 0; nLin = #referen@#1; |FINSI;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
     |SI nLin ! 0;
          |PTEC 802;
          aAlfa = ("000" + nLin) % -103;
          aPtec = aAlfa % 301; nPtec = &aPtec;
          |PTEC nPtec;
          aPtec = aAlfa % 201; nPtec = &aPtec;
          |PTEC nPtec;
          aPtec = aAlfa % 101; nPtec = &aPtec;
          |PTEC nPtec;
     |FINSI;
|FPRC;

|PROCESO Tipo7_67; |TIPO 7;
     |ABRE #agifa142; |LEE 000#agifa142.p; |CIERRA #142;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 1;
          #0#1 = #0#1 + #agifa142#236 - 1;
     |FINSI;
     |HAZ PintaDes67;
|FPRC;

|PROCESO ImportaPDA67;
     |DDEF aAlfa; aAlfa = aAlfa + "agifa067";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida ! 0; |ACABA; |FINSI;
     |ABRE #referen@;
     #referen@#28 = #1#25;
     #referen@#0 = #1#0;
     #referen@#1 = 999;
     |LEE 000#referen@.];
     |SI FSalida = 0;
          |LEE 000#referen@.a;
     |SINO;
          |LEE 000#referen@.u;
     |FINSI;
     |SI FSalida = 0; |Y #referen@#28 = #1#25; |Y #referen@#0 = #1#0;
          nLin = #referen@#1 + 1;
     |SINO;
          nLin = 1;
     |FINSI;
     |CIERRA #referen@;
     |DESCARGA_DEF #referen@;

     |DDEF aAlfa; aAlfa = aAlfa + "psion067";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida ! 0; |ACABA; |FINSI;
     |NOME_DAT #referen@#eaFichero#;
     |ABRE #referen@;
     |LEE 000#referen@.p;
     |PARA; |SI FSalida = 0; |HACIENDO;
          #0#28 = #1#25;
          #0#0 = #1#00;
          #0#1 = nLin;
          |GRABA 020#0b;
          #0#2 = #referen@#0; ||Arti
          #0#4 = #referen@#1; ||Des
          #0#3 = #referen@#2; ||Alma
          #0#5 = #referen@#3; ||Uni
          #0#42 = #referen@#9; ||Parti
          FEntrada = 100;     ||simula alta
          |HAZ defeclpc;
          |HAZ TotalLin67;
          |HAZ lpcacart;
          |GRABA 020#0a;
          |LIBERA #0;
          nLin = nLin + 1;
          |LEE 000#referen@.s;
     |SIGUE;
     |CIERRA #referen@;
     |DELINDEX #referen@;
     |DESCARGA_DEF #referen@;
     |PONCONTROL 23, "SI"
     |PTEC 809;
     |PTEC 808;
|FPRC;

|PROCESO MenuTrack67;
     |VARIABLES; {20} aPopup = ""; |FINSI;
     aPopup1 = "-1";  || Si fuera -1 en la posicion
     aPopup2 = 9;
     aPopup3 = "<F3> Estado Pedido";
     aPopup4 = "<F4> Copiar Pedido";
     aPopup5 = "<F5> Doble Stock/Kit";
     aPopup6 = "<F6> Precios Proveedor";
     aPopup7 = "<F7> Pendientes";
     aPopup8 = "<F8> Descripcion Ampliada";
     aPopup9 = "<F10> Textos";
     aPopup10 = "<F12> Consulta Cabecera";
     aPopup11 = "<Ctrl+F7> Captura PDA";
     IaPopup = aPopup1  <-;
     |ESPECIFICA "TRACKPOPUP", aPopup;
     nSal = FSalida;
     |SI FSalida = 1; nSal = 11; |FINSI;
     |SI FSalida = 2; nSal = 12; |FINSI;
     |SI FSalida = 3; nSal = 13; |FINSI;
     |SI FSalida = 4; nSal = 14; |FINSI;
     |SI FSalida = 5; nSal = 15; |FINSI;
     |SI FSalida = 6; nSal = 16; |FINSI;
     |SI FSalida = 7; nSal = 18; |FINSI;
     |SI FSalida = 8; nSal = 9; |FINSI;
     |SI FSalida = 9; nSal = 25; |FINSI;
     FSalida = nSal;
|FPRC;

|PROCESO Tipo5_067; |TIPO 5;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo ! 1 ; |ACABA; |FINSI;
     |HAZ EsGuerola;
     |SI FSalida = 0; |Y eaSerieTra ! "";  || viene del guerm217
          |SI enCreaLineas = 1;
               #0#28 = #1#25;
               #0#0 = #1#0;
               #0#1 = 1;
               |HAZ GueCreaLinPed;
               |HAZ TotalLin67;
               |GRABA 020#0n;
               eaDocu = "agifa067";
               |HAZ StockEntra;
          |FINSI;
     |FINSI;
|FPRC;

-----------------------------------------------
|PROCESO desan001_67;
     |SI #desan001@#2 ! "S"; |ACABA; |FINSI;
     nCan = nUni / #desan001@#4;
     nCan = ((nCan - 0.49) ! 0) * #desan001@#5;
     |SI nCan [ 0; |ACABA; |FINSI;

     |SI nHay = 0; |HAZ control1; |FINSI;

     nLin = nLin + 1;
     #0#1 = nLin;
     #0#2 = #desan001@#1;   || Codigo
     |HAZ defeclpc;
     #0#4  = #2#1;
     #0#3  = nAlma;
     #0#5  = nCan;
     #0#37 = nCan;
     |HAZ lpctotal;
     |HAZ lpcacart;
     |GRABA 020#0n;
     nHay = 1;
|FPRC;

|DEFBUCLE desan001_67;
     #desan001@#1002;
     ;
     #0#2,"                    ";
     #0#2,"zzzzzzzzzzzzzzzzzzzz";
     ;
     NULL, desan001_67;
|FIN;

|PROCESO Desan067;
     |DDEF aAlfa;
     aAlfa = aAlfa + "desan001";
     |CARGA_DEF aAlfa, desan001@;
     |SI FSalida = 0;
          nLin = #0#1;
          nUni = #0#5;
          nAlma = #0#3;
          nHay = 0;
          |SALVA_DATOS #0;
          |BUCLE desan001_67;
          |REPON_DATOS #0;
          |DESCARGA_DEF #desan001@;
          |SI nHay ! 0;
               |HAZ control2;
               |PTEC 809; |PTEC 816; |PTEC 806;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO PCEGAsigPed;
     aArti = #0#2; |QBF aArti;
     aAlfa = aArti - "CAL";
     |SI aArti ! aAlfa;
          eaSerie = #0#28;
          enCodigo = #0#0;
          enLinea = #0#1;
          eaArticulo = #0#2;
          eaProve = #1#4;
          enModo = modo;
          |SUB_EJECUTA_NP "pcegz023;PEDIDO";
          FSalida = enError;
     |SINO;
          FSalida = 0;
     |FINSI;
|FPRC;

|PROCESO PCEGDesasigPed;
     aArti = #0#2; |QBF aArti;
     aAlfa = aArti - "CAL";
     |SI aArti ! aAlfa;
          eaSerie = #0#28;
          enCodigo = #0#0;
          enLinea = #0#1;
          eaArticulo = #0#2;
          eaProve = #1#4;
          enModo = modo;
          |SUB_EJECUTA_NP "pcegz023;PEDIDO";
     |FINSI;
|FPRC;

----------------------------------------------
|PROCESO TallerCreaLin67;
     |DDEF aAlfa; aAlfa = aAlfa + "agifa067";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |ABRE #referen@;
     |SI #0#58 > 0;
          nLin = #0#58;
          #referen@#28 = #0#28;
          #referen@#0 = #0#0;
          #referen@#1 = nLin;
          |LEE 121#referen@.=;
     |SINO;
          #referen@#28 = #0#28;
          #referen@#0 = #0#0;
          #referen@#1 = 999;
          |LEE 000#referen@.];
          |SI FSalida = 0;
               |LEE 000#referen@.a;
          |SINO;
               |LEE 000#referen@.u;
          |FINSI;
          |SI FSalida = 0; |Y #referen@#28 = #0#28;  |Y #referen@#0 = #0#0;
               nLin = #referen@#1 + 1;
          |SINO;
               nLin = 1;
          |FINSI;
          |SI nLin [ #0#1; nLin = #0#1 + 1; |FINSI;
          |DDEFECTO #referen@;
          #referen@#28 = #0#28;
          #referen@#0 = #0#0;
          #referen@#1 = nLin;
          |GRABA 020#referen@.b;
     |FINSI;
     aAlfa = "CANON " + #0#4;
     #referen@#2 = "xxxxx";
     #referen@#3 = 1;
     #referen@#4 = aAlfa;
     #referen@#5 = #0#5;
     #referen@#6 = enCanon;
     #referen@#14 = #0#14;
     #referen@#18 = #0#18;
     #referen@#20 = #0#20;
     #referen@#26 = #0#26;
     #referen@#33 = enCanon;
     #referen@#37 = #0#37;
     #referen@#58 = -1;
     |SALVA_DATOS #0;

     |SALVA_DATOS #referen@;
     |REPON_DATOS #0;

     enForma = 1;
     eaDocu = "agifa067";
     |HAZ StockEntra;
     |HAZ TotalLin67;
     |HAZ AcuPedido;

     |SALVA_DATOS #0;
     |REPON_DATOS #referen@;
     |GRABA 020#referen@.a;

     |REPON_DATOS #0;

     #0#58 = nLin;       || Linea Promocion

     |CIERRA #referen@;
     |DESCARGA_DEF #referen@;
|FPRC;

|PROCESO TallerAcuLin67;
     |DDEF aAlfa; aAlfa = aAlfa + "agifa067";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |ABRE #referen@;
     #referen@#28 = #0#28;
     #referen@#0 = #0#0;
     #referen@#1 = #0#58;     || Usa linea promocion
     |LEE 101#referen@.=;
     |SI FSalida = 0;
          |SALVA_DATOS #0;
          |SALVA_DATOS #referen@;
          |REPON_DATOS #0;
          #0#1 = #referen@#1;
          enForma = -1;
          eaDocu = "agifa067";
          |HAZ StockEntra;
          |HAZ TotalLin67;
          |HAZ AcuPedido;
          |REPON_DATOS #0;
     |FINSI;
     |CIERRA #referen@;

     |DESCARGA_DEF #referen@;
|FPRC;

|PROCESO TallerBorLin67;
     |DDEF aAlfa; aAlfa = aAlfa + "agifa067";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |ABRE #referen@;
     #referen@#28 = #0#28;
     #referen@#0 = #0#0;
     #referen@#1 = #0#58;     || Usa linea promocion
     |LEE 101#referen@.=;
     nTallerBorLin = FSalida;
     |SI FSalida = 0;
          |BORRA 020#referen@.a;
     |FINSI;
     |CIERRA #referen@;

     |DESCARGA_DEF #referen@;
|FPRC;

|PROCESO TallerCanon67;
     eaArticulo = #0#2; |QBF eaArticulo;
     |HAZ TallerCanon;
     |SI nForma = 1;
          |SI enCanon ! 0;
               aponer = Asino; |HAZ poncontr1;
               |HAZ TallerCreaLin67;
               aponer = Anosi; |HAZ poncontr1;
               |PTEC 809; |PTEC 816; |PTEC 806;
          |SINO;
               |SI #0#58 > 0;      || ha cambiado a un articulo sin canon
                    |HAZ TallerBorLin67;
                    #0#58 = 0;
               |FINSI;
          |FINSI;
     |SINO;
          |SI modo = 3; |Y enModo81 ! 3;
               |HAZ TallerAcuLin67;
               |HAZ TallerBorLin67;
               |SI nTallerBorLin = 0;
                    |PONCONTROL 23, "SI";
                    |PTEC 809; |PTEC 808;
               |FINSI;
          |SINO;
               |SI modo = 2;
                    |HAZ TallerAcuLin67;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO AcuPedido;
     #1#11 = #1#11 + (#0#9 * enForma);
     #1#12 = #1#12 + (#0#11 * enForma);
     #1#13 = #1#11 - #1#12;
     #1#44 = #1#44 + (#0#56 * enForma);

     |SI #1#29 = "D";                    || Si la moneda de trabajo es la divisa ...
          nPPort2 = #0#50;
     |SINO;
          nPPort2 = #0#50 / #1#33 * #1#28;
     |FINSI;

     |SI #2#196 = 2;
         nPend = ((#0#41 - #0#38) * #0#33/nPreTon) ! nDeci_BaseMxP;
     |SINO;
         nPend = ((#0#5 - #0#38) * #0#33/nPreTon) ! nDeci_BaseMxP;
     |FINSI;

     nPend = (((nPend < #0#8) < #0#27) < #0#57) ! nDeci_BaseMxP;

     |SI #2#196 = 2;
         nPend = nPend + (((#0#41 - #0#38)/nPreTon * nPPort2) ! nDeci_BaseMxP);
     |SINO;
         nPend = nPend + (((#0#5  - #0#38)/nPreTon * nPPort2) ! nDeci_BaseMxP);
     |FINSI;

     nBrutoMoneda1 = nPend;
     nImporDescue1 = (nBrutoMoneda1 % #1#5) ! nDeci_BaseMxP;
     nBrutoMoneda1 = nBrutoMoneda1 - nImporDescue1;
     nImporDescue2 = (nBrutoMoneda1 % #1#17) ! nDeci_BaseMxP;
     nBrutoMoneda1 = nBrutoMoneda1 - nImporDescue2;
     nImporDescue3 = (nBrutoMoneda1 % #1#6) ! nDeci_BaseMxP
     nBrutoMoneda1 = nBrutoMoneda1 - nImporDescue3;
     nPend = nBrutoMoneda1;

     #1#34 = #1#34 + (#0#34 * enForma);
     #1#35 = #1#35 + (nPend * enForma);
     #1#36 = #1#34 - #1#35;

     |HAZ visual_totales;
|FPRC;

|PROCESO Descri67; |TIPO 0;
     |HAZ PintaDes67;
|FPRC;

|PROCESO PintaDes67;
     |HAZ EsAparecida;
     |SI FSalida = 0;
          |C_A #0#4, 0, nNume;
          |C_A #0#4, 1, 50;
          |PINTA 2301, "³Descripcion: ";
          |PINTA 2315, #0#4;
          |C_A #0#4, 1, nNume;
     |FINSI;
|FPRC;

|PROCESO CoimaHistorico;
     |DDEF aAlfa;
     aAlfa = aAlfa + "coima001";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          |LEE 000#referen@.p;
          |CIERRA #referen@;
          aImporta = #referen@#2;
          |DESCARGA_DEF #referen@;
     |SINO;
          |MENAV "0000ERROR al cargar 'coima001'";
     |FINSI;
     |ABRE #90;
     #90#26 = #0#28;
     |LEE 020#90=;
     |CIERRA #90;

     |SI #90#30 = "N"; |Y aImporta = "N"; |ACABA; |FINSI;

     |DDEF aAlfa;
     aAlfa = aAlfa + "coima003";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |DDEFECTO #referen@;
          |ABRE #referen@;
          #referen@#0 = "C";
          #referen@#1 = #0#28;
          #referen@#2 = #0#0;
          #referen@#3 = #0#1;
          |SI nForma = -1;
               |LEE 101#referen@.];
               |PARA; |SI FSalida = 0; |Y #referen@#0 = "C"; |Y #referen@#1 = #0#28;
                         |Y #referen@#2 = #0#0; |Y #referen@#3 = #0#1; |HACIENDO;
                    |BORRA 020#referen@.a;
                    |LIBERA #referen@;
                    |LEE 101#referen@.s;
               |SIGUE;
          |SINO;
               |LEE 101#referen@.=;
               |SI FSalida ! 0; |GRABA 020#referen@.b; |FINSI;
               #referen@#7 = #0#5;
               #referen@#9 = #1#1;
               #referen@#10 = #0#13;
               #referen@#11 = #1#4;
               #referen@#12 = #1#8;
               #referen@#13 = #0#2;
               #referen@#14 = #0#4;
               #referen@#16 = #0#3;
               |GRABA 020#referen@.a;
               |LIBERA #referen@;
          |FINSI;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |SINO;
          |MENAV "0000ERROR al cargar 'coima003'";
     |FINSI;
|FPRC;

|PROCESO CoimaAuxArti;
     |DDEF aPath;
     aAlfa = aPath + "coima001";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@; |LEE 000#referen@.p; |CIERRA #referen@;
          nNum3 = #referen@#5;
          |DESCARGA_DEF #referen@;
     |SINO;
          |MENAV "0000ERROR al cargar 'coima001'";
          |ACABA;
     |FINSI;

     aAlfa = aPath + "coima027";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |DDEFECTO #referen@;
          |ABRE #referen@;
          #referen@#0 = #0#2;
          #referen@#1 = #0#3;
          |LEE 101#referen@.=;
          |SI FSalida ! 0; |GRABA 020#referen@.b; |FINSI;
          |SI #referen@#2 < #0#13;
               #referen@#2 = #0#13;
               #referen@#3 = #0#5;
          |FINSI;
          fHoy = ~;
          nNum1 = fHoy;
          nNum2 = #0#13;
          nDias = #0#13 - fHoy;
          |SI nDias < nNum3;
               #referen@#4 = #referen@#4 - #0#5;
          |SINO;
               #referen@#5 = #referen@#5 + #0#5;
          |FINSI;
          |GRABA 020#referen@.a;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |SINO;
          |MENAV "0000ERROR al cargar 'coima027'";
     |FINSI;
|FPRC;

|PROCESO IVA067_66; |TIPO 66;
     enTiva = #0Campo;
     efFiva = #1#1;
     |HAZ ConsuIVA;
     |SI eaDiva = "";
          |ERROR;
     |SINO;
          #0Campo = enTiva; |PINTA #0Campo;
     |FINSI;
|FPRC;

|PROCESO IVA067_0; |TIPO 0;
     enTiva = #0Campo;
     efFiva = #1#1;
     |HAZ SacaIVA;
     |SI eaDiva = "";
          |MENAV "0000No existe tipo iva para esta fecha...";
          |ERROR; |ACABA;
     |SINO;
          |HAZ DespresIva;
     |FINSI;
|FPRC;

|PROCESO Uni67; |TIPO 0;
     |HAZ EsDesanch;
     |SI FSalida = 0;
          eaDocu = "agifa067";
          |SI salida = 10;
               |HAZ DesanOfeCon;
               |ERROR; |ACABA;
          |SINO;
               |SI #0Campo = Contenido; |ACABA; |FINSI;
               enPrecio = #0#6;
               enPreDiv = #0#33;
               enDto1 = #0#8;
               enDto2 = #0#27;
               enDto3 = #0#57;
               |HAZ DesanOferta;
          |FINSI;
          #0#6 = enPrecio;
          #0#33 = enPreDiv;
          #0#8 = enDto1;
          #0#27 = enDto2;
          #0#57 = enDto3;
          |PINTA #0#8;
          |PINTA #0#27;
          |PINTA #0#57;
          |HAZ upc_div;
     |FINSI;
|FPRC;

|PROCESO ActDesanch67;
/*
     nEsta = 0;
     |DDEF aPath;
     aAlfa = aPath + "desan001";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          |SELECT #2#referen@;
          #referen@#1 = #0#2;
          |LEE 000#referen@.=;
          |SI FSalida = 0; |Y #referen@#2 = "S";
               nEsta = 1;
          |FINSI;
          |DESCARGA_DEF #referen@;
     |FINSI;

     |SI nEsta = 0; |ACABA; |FINSI;

     aAlfa = aPath + "desan026";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          #referen@#0 = #0#2;
          #referen@#1 = #1#1;
          #referen@#2 = "PC";
          #referen@#3 = #0#28;
          #referen@#4 = #0#0;
          #referen@#5 = #0#1;
          #referen@#6 = #0#5;
          #referen@#7 = #1#4;
          |SI nForma = 1;
               |GRABA 020#referen@.n;
          |SINO;
               |BORRA 000#referen@.c;
          |FINSI;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
*/
|FPRC;


|PROCESO Desanch67;
     |HAZ EsDesanch;
     |SI FSalida ! 0; |ACABA; |FINSI;
     eaProve = #1#4;
     eaArticulo = #0#2;
     |SUB_EJECUTA_NP "desan043";
|FPRC;
