|FICHEROS;
     con0g005 #0;
     con0g003 #3;
     con0g011 #11,MANTE;
     con0g012 #12,MANTE;
     con0g013 #13,MANTE;
     con0g015 #15,MANTE;
     con0g016 #16;
     con0g017 #17;
     con00606 #606;
     con00625 #625;
     con00626 #626;
     referen@;
     agifa019 #19;
|FIN;

|VARIABLES;
     &eaArticulo = "";
     &enCanon = 0;
     nModoCab = 0;
     nTallerBorLin = 0;
     nTotCanon = 0;
     nModoLin = 0;
     nSwMeteAlgo = 0;
     nUltimaLin = 0;

     nEstoy = 0;
     aMensaje = "";

 {-1}aMenu = "";
     aMenu1 = "2400";
     aMenu2 = "1";
     aMenu3 = "Tipo:  ";
     aMenu4 = "OMT";
     aMenu5 = " Mano Obra ";
     aMenu6 = " Materiales ";
     aMenu7 = " T.Externos ";
 {-1}aMenuA = "";
     aMenuA1 = "2400";
     aMenuA2 = "1";
     aMenuA3 = "";
     aMenuA4 = "MB";
     aMenuA5 = "Modificacion";
     aMenuA6 = "    Baja    ";
 {-1}aMenuC = "";
     aMenuC1 = "2400";
     aMenuC2 = "1";
     aMenuC3 = "";
     aMenuC4 = "RAC";
     aMenuC5 = " Repasar  ";
     aMenuC6 = " Aceptar  ";
     aMenuC7 = " Cancelar ";
 {-1}aMenuD = "";
     aMenuD1 = "2400";
     aMenuD2 = "1";
     aMenuD3 = "";
     aMenuD4 = "DA";
     aMenuD5 = " Descargar ";
     aMenuD6 = "  Agrupar  ";
     fiac = "  ";
     guarda = "  ";
     relleno  = "                                       ";
     aponer = "  ";
     nModo = 0;
     tecla = 0;
     nForma = 0;
     modo = 0;
     nLin = 0;
     nSw = 0;
     nLineas = 0;
     nTipo = 0;
     aAlfa = "";
     nSwAgrupa = 0;
     aMarca = "";
     nTotaUni = 0;
     nTotaImp = 0;
     nLinAgr = 0;
     i = 0;
     nCuentaLin = 0;
     nGuardaLin = 0;
|FIN;

|PROCESO min12;
     #12#10 = #0#25;
     #12#0 = #0#0;
     #12#1 = #0#1;
     #12#2 = 1001;
|FPRC;

|PROCESO max12;
     #12#10 = #0#25;
     #12#0 = #0#0;
     #12#1 = #0#1;
     #12#2 = 9999;
|FPRC;

|PROCESO min11;
     #11#12 = #0#25;
     #11#0 = #0#0;
     #11#1 = #0#1;
     #11#2 = 1;
|FPRC;

|PROCESO max11;
     #11#12 = #0#25;
     #11#0 = #0#0;
     #11#1 = #0#1;
     #11#2 = 9999;
|FPRC;

|PROCESO min13;
     #13#8 = #0#25;
     #13#0 = #0#0;
     #13#1 = #0#1;
     #13#2 = 2000;
|FPRC;

|PROCESO max13;
     #13#8 = #0#25;
     #13#0 = #0#0;
     #13#1 = #0#1;
     #13#2 = 9999;
|FPRC;

|PROCESO Ptec;
     || Si existe mas de una linea hace 2 ptec
     |DDEF aAlfa; aAlfa = aAlfa + "con0g005";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          #referen@#25 = #3#37;
          #referen@#0 = #3#0;
          #referen@#1 = 1;
          |LEE 000#referen@.];
          |PARA i = 1; |SI FSalida = 0; |Y i [ 3; |Y #referen@#25 = #3#37; |Y #referen@#0 = #3#0;
                    |HACIENDO i = i + 1;
               |LEE 000#referen@.s;
          |SIGUE;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
          |SI i > 2; |PTEC 802; |FINSI;
     |FINSI;
|FPRC;

|PROCESO tecla; |TIPO 11;
     tecla = FSalida;

     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 4;
          |SI tecla = 10; |O tecla = 11; |O tecla = 12;
               nLin = #0#1;
               |HAZ ConsultaLin;
               |ERROR;
          |FINSI;
          |SI tecla = 13;
             aAlfa = (#con0g005#25 + "     ") % 0105;
             aAlfa = aAlfa + (("00000000" + #con0g005#0) % -108);
             aAlfa = aAlfa + (("0000" + #con0g005#1) % -104);
             aAlfa = "conz0010.tab;" + aAlfa;
             |SUB_EJECUTA aAlfa;
             |ERROR;
          |FINSI;
          |ACABA;
     |FINSI;

     |SI tecla = 10; |O tecla = 11; |O tecla = 12;
          nEstoy = #0#1;
          |LEE 000#0.=;
          |SI FSalida ! 0;
               aMensaje = "0000Primero introduzca la incidencia";
               |MENAV aMensaje;
               |ERROR;
               |PTEC 802;
               |SI nEstoy > 1;
                    #0#1 = nEstoy - 1;
               |FINSI;
               |PINTA #0#1;
               |ACABA;
          |FINSI;
          nGuardaLin = #0#1;
          nLin = #0#1;
          |HAZ UltimaLin;
          |HAZ EditaLin;

          |GRABA 020#0a;
          |PINTA #0#17;
          |PINTA #0#18;
          |PINTA #0#19;
          |PINTA #0#20;
          |PINTA #0#29;
          |ERROR;
     |FINSI;

     |SI tecla = 13;
        aAlfa = (#con0g005#25 + "     ") % 0105;
        aAlfa = aAlfa + (("00000000" + #con0g005#0) % -108);
        aAlfa = aAlfa + (("0000" + #con0g005#1) % -104);
        aAlfa = "conz0010.tab;" + aAlfa;
        |SUB_EJECUTA aAlfa;
        |ERROR;
     |FINSI;
|FPRC;

|PROCESO HayLin;
     nCuentaLin = nCuentaLin + 1;
|FPRC;

|DEFBUCLE HayMano;
     #11#1;
     ;
     #0#25, #0#0 , #0#1 ,    1;
     #0#25, #0#0 , #0#1 , 9999;
     ;
     NULL, HayLin;
|FIN;

|DEFBUCLE HayMateria;
     #12#1;
     ;
     #0#25, #0#0 , #0#1 ,    1;
     #0#25, #0#0 , #0#1 , 9999;
     ;
     NULL, HayLin;
|FIN;

|DEFBUCLE HayTercero;
     #13#1;
     ;
     #0#25, #0#0 , #0#1 ,    1;
     #0#25, #0#0 , #0#1 , 9999;
     ;
     NULL, HayLin;
|FIN;

|PROCESO ConsultaLin;
     |PUSHV 0501 2380;

     |SI tecla = 10;|| Mano de OBra
          |ENTLINEAL #1#11, 4 , 4 , 16 , 1 , min11 , max11;
     |FINSI;

     |SI tecla = 11; ||MAteriales
          |ENTLINEAL #1#12, 4 , 4 , 16, 1 , min12 , max12;
     |FINSI;

     |SI tecla = 12;|| Fras. de terceros
          |ENTLINEAL #1#13, 4 , 4 , 16 , 1 , min13 , max13;
     |FINSI;

     |POPV;
|FPRC;

|PROCESO EditaLin;
     |PUSHV 0501 2380;

     nCuentaLin = 0;
     |SI tecla = 10;|| Mano de OBra
          |ENTLINEAL #1#11, 4 , 2 , 16 , 1 , min11 , max11;
          |BUCLE HayMano;
     |FINSI;

     |SI tecla = 11; ||MAteriales
          |ENTLINEAL #1#12, 4 , 2 , 16, 1 , min12 , max12;
          |BUCLE HayMateria;
     |FINSI;

     |SI tecla = 12;|| Fras. de terceros
          |ENTLINEAL #1#13, 4 , 2 , 16 , 1 , min13 , max13;
          |BUCLE HayTercero;
     |FINSI;

     |POPV;
|FPRC;

|PROCESO borra_mobra;
     |HAZ AcuMobra;
     |BORRA 020#11a;
     |LIBERA #11;

     |SI #11#13 ! 0;
          |ABRE #626;
          #626#0 = #3#2;
          #626#1 = #3#3;
          #626#11 = #11#13;
          |LEE 121#626=;
          |SI FSalida = 0;
               #626#31 = "";
               #626#32 = 0;
               #626#33 = 0;
               |GRABA 020#626a;
          |FINSI;
          |CIERRA #626;
     |FINSI;
|FPRC;

|DEFBUCLE borra_mobra;
     #11#1;
     ;
     #0#25, #0#0 , #0#1 ,    1;
     #0#25, #0#0 , #0#1 , 9999;
     be;
     NULL , borra_mobra;
|FIN;

|PROCESO BorraAgrupa;
     |BORRA 020#17a;
     |LIBERA #17;
     |SI #17#11 ! 0;
          |ABRE #626;
          #626#0 = #3#2;
          #626#1 = #3#3;
          #626#11 = #17#11;
          |LEE 121#626=;
          |SI FSalida = 0;
               #626#31 = "";
               #626#32 = 0;
               #626#33 = 0;
               |GRABA 020#626a;
          |FINSI;
          |CIERRA #626;
     |FINSI;
|FPRC;

|DEFBUCLE BorraAgrupa;
     #17#1;
     ;
     #12#10, #12#0, #12#1, #12#2, 001;
     #12#10, #12#0, #12#1, #12#2, 999;
     be;
     NULL, BorraAgrupa;
|FIN;

|PROCESO borra_arti;
     |HAZ AcuArti;
     |BORRA 020#12a;
     |LIBERA #12;

     |SI #12#11 ! 0;
          |ABRE #626;
          #626#0 = #3#2;
          #626#1 = #3#3;
          #626#11 = #12#11;
          |LEE 121#626=;
          |SI FSalida = 0;
               #626#31 = "";
               #626#32 = 0;
               #626#33 = 0;
               |GRABA 020#626a;
          |FINSI;
          |CIERRA #626;
     |FINSI;

     |BUCLE BorraAgrupa;
|FPRC;

|DEFBUCLE borra_arti;
     #12#1;
     ;
     #0#25, #0#0 , #0#1 ,    1;
     #0#25, #0#0 , #0#1 , 9999;
     ;
     NULL , borra_arti;
|FIN;

|PROCESO borra_exte;
     |HAZ AcuExte;
     |BORRA 020#13a;
     |LIBERA #13;
|FPRC;

|DEFBUCLE borra_exte;
     #13#1;
     ;
     #0#25, #0#0 , #0#1 ,    1;
     #0#25, #0#0 , #0#1 , 9999;
     be;
     NULL , borra_exte;
|FIN;

|PROCESO DesactualizaOR;
     |SI #con00626#31 = #con0g005#25; |Y #con00626#32 = #con0g005#0; |Y #con00626#33 = #con0g005#1;
          #con00626#30 = "N";
          #con00626#31 = "";
          #con00626#32 = 0;
          #con00626#33 = 0;
          |GRABA 020#con00626.a;
          |LIBERA #con00626;
     |FINSI;
|FPRC;

|DEFBUCLE DesactualizaOR;
 #con00626#1;
 ;
 #con0g003#2, #con0g003#3, 0001;
 #con0g003#2, #con0g003#3, 9999;
 be;
 NULL, DesactualizaOR;
|FIN;

|PROCESO tipo2; |TIPO 2;
     modo = (FEntrada / 100) ! 0;
     nModoCab = modo;

     nForma = 0 +. 1;
     |SI modo = 3;
          |BUCLE borra_mobra;
          |BUCLE borra_arti;
          |BUCLE borra_exte;

          |BUCLE DesactualizaOR;
     |FINSI;
|FPRC;

|PROCESO Modi11; |TIPO 0;
/*
     |SI #11#13 = 0;
          |C_M #11#3, 1, "S";
          |C_M #11#4, 1, "S";
          |C_M #11#11, 1, "S";
          |C_M #11#5, 1, "S";
     |SINO;
          |C_M #11#3, 1, "N";
          |C_M #11#4, 1, "N";
          |C_M #11#11, 1, "N";
          |C_M #11#5, 1, "N";
     |FINSI;
*/
|FPRC;

|PROCESO Modi12; |TIPO 0;
/*
     |SI #12#11 = 0;
          |C_M #12#3, 1, "S";
          |C_M #12#4, 1, "S";
          |C_M #12#5, 1, "S";
          |C_M #12#6, 1, "S";
          |C_M #12#8, 1, "S";
          |SI #12#8 = "A";
               |C_M #12#7, 1, "S";
          |SINO;
               |C_M #12#7, 1, "N";
          |FINSI;
     |SINO;
          |C_M #12#3, 1, "N";
          |C_M #12#4, 1, "N";
          |C_M #12#5, 1, "N";
          |C_M #12#6, 1, "N";
          |C_M #12#8, 1, "N";
          |SI #12#8 = "A";
               |C_M #12#7, 1, "N";
          |FINSI;
     |FINSI;
*/
|FPRC;

|PROCESO Total11; |TIPO 0;
     #11#10 = (#11#5 * #11#11) < #11#15;
     |PINTA #11#10;
|FPRC;

|PROCESO Total12; |TIPO 0;
     |SI #12#8 = "A";
          |SI #12#6 ! 0;
               #12#7 = (#12#5 * #12#6) < #12#13;
               |PINTA #12#7;
          |FINSI;
     |SINO;
          #12#7 = (#12#5 * #12#6) < #12#13;
          |PINTA #12#7;
     |FINSI;
|FPRC;

|PROCESO Total13; |TIPO 0;
     #13#6 = (#13#11 * #13#12) < #13#15;
     |PINTA #13#6;
|FPRC;

|PROCESO AcuMobra;
     #0#18 = #0#18 + (#11#10 * nForma);
     #0#20 = #0#20 + (#11#10 * nForma);
     #0#29 = #0#29 + (#11#5 * nForma);
     |GRABA 020#0a;

     #3#28 = #3#28 + (#11#10 * nForma);
     #3#30 = #3#30 + (#11#10 * nForma);
     #3#46 = #3#46 + (#11#5 * nForma);
     |GRABA 001#3a;
|FPRC;

|PROCESO AcuArti;
     #0#17 = #0#17 + (#12#7 * nForma);
     #0#20 = #0#20 + (#12#7 * nForma);
     |GRABA 020#0a;

     #3#27 = #3#27 + (#12#7 * nForma);
     #3#30 = #3#30 + (#12#7 * nForma);
     |GRABA 020#3a;
|FPRC;

|PROCESO AcuExte;
     #0#19 = #0#19 + (#13#6 * nForma);
     #0#20 = #0#20 + (#13#6 * nForma);
     |GRABA 020#0a;

     #3#29 = #3#29 + (#13#6 * nForma);
     #3#30 = #3#30 + (#13#6 * nForma);
     |GRABA 020#3a;
|FPRC;

|PROCESO suma_mobra; |TIPO 2;
     nModo = (FEntrada / 100) ! 0;
     nForma = 0 +. 1;
     |HAZ AcuMobra;
     |SI #11#13 ! 0; |Y nModo = 3;
          |ABRE #626;
          #626#0 = #3#2;
          #626#1 = #3#3;
          #626#11 = #11#13;
          |LEE 121#626=;
          |SI FSalida = 0;
               #626#31 = "";
               #626#32 = 0;
               #626#33 = 0;
               |GRABA 020#626a;
          |FINSI;
          |CIERRA #626;
     |FINSI;
|FPRC;

|PROCESO suma_arti; |TIPO 2;
     nModo = (FEntrada / 100) ! 0;
     nForma = 0 +. 1;
     |SI #12#12 = -1;
          |SI nForma = -1;
               |MENAV "0000Linea de canon, no se puede modificar...";
          |FINSI;
          |ERROR; |ACABA;
     |FINSI;

     |HAZ AcuArti;

     |SI #12#11 ! 0; |Y nModo = 3;
          |ABRE #626;
          #626#0 = #3#2;
          #626#1 = #3#3;
          #626#11 = #12#11;
          |LEE 121#626=;
          |SI FSalida = 0;
               #626#31 = "";
               #626#32 = 0;
               #626#33 = 0;
               |GRABA 020#626a;
          |FINSI;
          |CIERRA #626;
     |FINSI;

     |HAZ Canon;

     |SI nModo = 3;
          |BUCLE BorraAgrupa;
     |FINSI;
|FPRC;

|PROCESO suma_serex; |TIPO 2;
     nModo = (FEntrada / 100) ! 0;
     nForma = 0 +. 1;

     |HAZ AcuExte;

     |SI #13#13 ! 0; |Y nModo = 3;
          |ABRE #626;
          #626#0 = #3#2;
          #626#1 = #3#3;
          #626#11 = #13#13;
          |LEE 121#626=;
          |SI FSalida = 0;
               #626#31 = "";
               #626#32 = 0;
               #626#33 = 0;
               |GRABA 020#626a;
          |FINSI;
          |CIERRA #626;
     |FINSI;
|FPRC;

---------------------------
|PROCESO poncontr;
     fiac = Control % A109;
     fiac = fiac + relleno;
     guarda = fiac % A109;
     fiac = Control % A1001;
     Control = Control + fiac;
     Control = Control + relleno;
     Control = Control % A120;
     Control = Control + aponer;
|FPRC;

|PROCESO UltimaLin;
     |SI nLin = 0;
          nLin = 1;
          |DDEFECTO #0;
          #0#25 = #3#37;
          #0#0 = #3#0;
          #0#1 = nLin; |PINTA #0#1;
          |GRABA 020#0b;
     |FINSI;
|FPRC;

|PROCESO Alta; |TIPO 0;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 1;
     |SINO;
     |FINSI;
|FPRC;
---------------------------------------------------
|PROCESO CargaLinOrd;
     |SI #626#28 = -1;   || Linea Canon
          |ACABA;
     |FINSI;

     |SI #626#14 ! "G";  ||No es Garantia
          |ACABA;
     |FINSI;

     |DDEFECTO #15;
     #15#0 = #626#11;
     #15#1 = #626#2;
     #15#2 = #626#3;
     #15#3 = #626#4;
     #15#4 = #626#5;
     #15#5 = #626#8;
     #15#8 = #626#6;

     nTotCanon = 0;
     |SI #626#28 > 0;              || Tiene canon
          |SALVA_FICHA #626;
          #626#11 = #626#28;
          |LEE 020#626=;
          |SI FSalida = 0;
               nTotCanon = #626#8;
          |FINSI;
          |REPON_FICHA #626;
     |FINSI;

     |SI #626#30 = "S";
          #15#7 = "*";  || Desprecia
     |FINSI;
     |SI nTipo = 1; |Y #626#11 ] 1; |Y #626#11 [ 999;     ||Mano Obra
          |SI #626#33 = 0; |O #15#7 = "*";
               nLineas = nLineas + 1;
               |GRABA 020#15n;
          |FINSI;
     |FINSI;
     |SI nTipo = 2; |Y #626#11 ] 1000; |Y #626#11 [ 1999;     ||Materiales (pieza)
          |SI #626#33 = 0; |O #15#7 = "*";
               #15#5 = #15#5 + nTotCanon;
               #15#4 = #15#5 / #15#3;
               nLineas = nLineas + 1;
               |GRABA 020#15n;
          |FINSI;
     |FINSI;
     |SI nTipo = 2; |Y #626#11 ] 3000; |Y #626#11 [ 3999;     ||Materiales (lubri)
          |SI #626#33 = 0; |O #15#7 = "*";
               #15#5 = #15#5 + nTotCanon;
               #15#4 = #15#5 / #15#3;
               nLineas = nLineas + 1;
               |GRABA 020#15n;
          |FINSI;
     |FINSI;
     |SI nTipo = 3; |Y #626#11 ] 2000; |Y #626#11 [ 2999;     ||Externo
          |SI #626#33 = 0; |O #15#7 = "*";
               nLineas = nLineas + 1;
               |GRABA 020#15n;
          |FINSI;
     |FINSI;
     |SI #15#7 = "*";
          #16#2 = #16#2 + #15#3;
          #16#3 = #16#3 + #15#5 + nTotCanon;
     |FINSI;
|FPRC;

|DEFBUCLE CargaLinOrd;
     #626#1;
     ;
     #3#2, #3#3, 0001;
     #3#2, #3#3, 9999;
     ;
     NULL, CargaLinOrd;
|FIN;

|PROCESO Tecla15; |TIPO 11;
     |SI FSalida = 13;             || F5
          |SI #15#7 = "*";
               #15#7 = "";
               #16#2 = #16#2 - #15#3;
               #16#3 = #16#3 - #15#5;
          |SINO;
               #15#7 = "*";
               #16#2 = #16#2 + #15#3;
               #16#3 = #16#3 + #15#5;
               |SI #15#6 = "*";
                    #15#6 = "";
                    #16#0 = #16#0 - #15#3;
                    #16#1 = #16#1 - #15#5;
               |FINSI;
          |FINSI;
          |PINTA #15#6;
          |PINTA #15#7;
          |PINTA #16#0; |PINTA #16#1;
          |PINTA #16#2; |PINTA #16#3;
          |GRABA 020#15a;
          |PTEC 809;
     |FINSI;
|FPRC;

|PROCESO Enter15; |TIPO 0;
     |SI #15Campo = Contenido; |Y FSalida = 0;
          |SI #15#6 = "*";
               #15#6 = "";
               #16#0 = #16#0 - #15#3;
               #16#1 = #16#1 - #15#5;
          |SINO;
               #15#6 = "*";
               |SI #15#7 = "*";
                    #15#7 = "";
                    #16#2 = #16#2 - #15#3;
                    #16#3 = #16#3 - #15#5;
               |FINSI;
               #16#0 = #16#0 + #15#3;
               #16#1 = #16#1 + #15#5;
          |FINSI;
          |GRABA 020#15a;
          |PINTA #15#6;
          |PINTA #15#7;
          |PINTA #16#0; |PINTA #16#1;
          |PINTA #16#2; |PINTA #16#3;
     |FINSI;
|FPRC;

|PROCESO Min15;
     #15#1 = " " * 20;
|FPRC;

|PROCESO Max15;
     #15#1 = "z" * 20;
|FPRC;

|PROCESO DescargaMano;
     |SI #15#6 ! "*"; |Y #15#7 ! "*";
          |ACABA;
     |FINSI;

     #626#0 = #3#2;
     #626#1 = #3#3;
     #626#11 = #15#0;
     |LEE 121#626=;
     |SI FSalida = 0;
          |SI #15#7 = "*";
               #626#30 = "S";
               |GRABA 020#626a;
               |LIBERA #626;
          |SINO;
               #626#30 = "N";
               #626#31 = #3#37;
               #626#32 = #3#0;
               #626#33 = #0#1;
               |GRABA 020#626a;
               |LIBERA #626;

               #11#12 = #0#25;
               #11#0 = #0#0;
               #11#1 = #0#1;
               #11#2 = 999;
               |LEE 000#11];
               |SI FSalida = 0;
                    |LEE 000#11a;
               |SINO;
                    |LEE 000#11u;
               |FINSI;
               |SI FSalida = 0; |Y #11#12 = #0#25;  |Y #11#0 = #0#0; |Y #11#1 = #0#1;
                    nLin = #11#2 + 1;
               |SINO;
                    nLin = 1;
               |FINSI;
               |DDEFECTO #11;
               #11#12 = #0#25;
               #11#0 = #0#0;
               #11#1 = #0#1;
               #11#2 = nLin;
               #11#3 = #626#2;
               #11#4 = #626#3;
               #11#11 = #626#5; ||Precio
               #11#5 = #626#4;  ||Uni
               #11#15 = #626#6;
               #11#10 = (#11#5 * #11#11) < #11#15;
               #11#13 = #626#11;
               #11#14 = 0;
               |GRABA 020#11n;

               nForma = 1; |HAZ AcuMobra;

               nSwMeteAlgo = 1;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE DescargaMano;
     #15#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, DescargaMano;
|FIN;

|PROCESO DescargaMate;
     |SI #15#6 ! "*"; |Y #15#7 ! "*";
          |ACABA;
     |FINSI;

     #626#0 = #3#2;
     #626#1 = #3#3;
     #626#11 = #15#0;
     |LEE 121#626=;
     |SI FSalida = 0;
          |SI #15#7 = "*";
               #626#30 = "S";
               |GRABA 020#626a;
               |LIBERA #626;
          |SINO;
               #626#30 = "N";
               #626#31 = #3#37;
               #626#32 = #3#0;
               #626#33 = #0#1;
               |GRABA 020#626a;
               |LIBERA #626;

               #12#10 = #0#25;
               #12#0 = #0#0;
               #12#1 = #0#1;
               #12#2 = 9999;
               |LEE 000#12];
               |SI FSalida = 0;
                    |LEE 000#12a;
               |SINO;
                    |LEE 000#12u;
               |FINSI;
               |SI FSalida = 0; |Y #12#10 = #0#25;  |Y #12#0 = #0#0; |Y #12#1 = #0#1;
                    nLin = #12#2 + 1;
               |SINO;
                    nLin = 1001;
               |FINSI;
               |DDEFECTO #12;
               #12#10 = #0#25;
               #12#0 = #0#0;
               #12#1 = #0#1;
               #12#2 = nLin;
               |SI nSwAgrupa = 0;
                    #12#3 = #626#2;
                    #12#4 = #626#3;
                    #12#5 = #626#4;
                    #12#6 = #626#5;
                    #12#13 = #626#6;
                    #12#7 = (#12#5 * #12#6) < #12#13;
                    |SI #626#11 ] 1000; |Y #626 [ 1999;
                         #12#8 = "O";
                    |SINO;
                         #12#8 = "";
                    |FINSI;
                    #12#11 = #626#11;

                    |SALVA_DATOS #12;
                    |SI #626#28 [ 0;
                         nLin = 0;
                    |SINO;              ||Linea Canon
                         nLin = nLin + 1;
                         #626#0 = #3#2;
                         #626#1 = #3#3;
                         #626#11 = #626#28;
                         |LEE 020#626=;
                         |SI FSalida = 0;
                              #12#2 = nLin;
                              #12#3 = #626#2;
                              #12#4 = #626#3;
                              #12#5 = #626#4;
                              #12#6 = #626#5;
                              #12#13 = #626#6;
                              #12#7 = (#12#5 * #12#6) < #12#13;
                              |SI #626#11 ] 1000; |Y #626 [ 1999;
                                   #12#8 = "O";
                              |SINO;
                                   #12#8 = "";
                              |FINSI;
                              #12#11 = #626#11;
                              #12#12 = -1;

                              |GRABA 020#12n;

                              nForma = 1; |HAZ AcuArti;

                              nTotaImp = nTotaImp + #12#7;
                              nTotaUni = nTotaUni + #12#5;
                         |FINSI;
                    |FINSI;
                    |REPON_DATOS #12;
                    #12#12 = nLin;
                    |GRABA 020#12n;

                    nForma = 1; |HAZ AcuArti;

                    nTotaImp = nTotaImp + #12#7;
                    nTotaUni = nTotaUni + #12#5;
                    nSwMeteAlgo = 1;
               |SINO;                    || Lineas Agrupadas
                    #17#10 = #0#25;
                    #17#0 = #0#0;
                    #17#1 = #0#1;
                    #17#2 = nLin;
                    #17#12 = 999;
                    |LEE 000#17];
                    |SI FSalida = 0;
                         |LEE 000#17a;
                    |SINO;
                         |LEE 000#17u;
                    |FINSI;
                    |SI FSalida = 0; |Y #17#10 = #0#25;  |Y #17#0 = #0#0;
                              |Y #17#1 = #0#1; |Y #17#2 = nLin;
                         nLinAgr = #17#12 + 1;
                    |SINO;
                         nLinAgr = 1;
                    |FINSI;
                    |DDEFECTO #17;
                    #17#10 = #0#25;
                    #17#0 = #0#0;
                    #17#1 = #0#1;
                    #17#2 = nLin;
                    #17#12 = nLinAgr;
                    #17#3 = #626#2;
                    #17#4 = #626#3;
                    #17#5 = #626#4;
                    #17#6 = #626#5;
                    #17#13 = #626#6;
                    #17#7 = (#17#5 * #17#6) < #17#13;
                    |SI #626#11 ] 1000; |Y #626 [ 1999;
                         #17#8 = "O";
                    |SINO;
                         #17#8 = "";
                    |FINSI;
                    #17#11 = #626#11;
                    |GRABA 020#17n;
                    nTotaImp = nTotaImp + #17#7;
                    nTotaUni = nTotaUni + #17#5;
                    |SI #626#28 > 0;    || Linea Canon
                         #626#0 = #3#2;
                         #626#1 = #3#3;
                         #626#11 = #626#28;
                         |LEE 020#626=;
                         |SI FSalida = 0;
                              #17#2 = nLin;
                              #17#12 = nLinAgr + 1;
                              #17#3 = #626#2;
                              #17#4 = #626#3;
                              #17#5 = #626#4;
                              #17#6 = #626#5;
                              #17#13 = #626#6;
                              #17#7 = (#17#5 * #17#6) < #17#13;
                              |SI #626#11 ] 1000; |Y #626 [ 1999;
                                   #17#8 = "O";
                              |SINO;
                                   #17#8 = "";
                              |FINSI;
                              #17#11 = #626#11;
                              |GRABA 020#17n;
                              nTotaImp = nTotaImp + #17#7;
                              nTotaUni = nTotaUni + #17#5;
                         |FINSI;
                    |FINSI;
                    nSwMeteAlgo = 1;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE DescargaMate;
     #15#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, DescargaMate;
|FIN;

|PROCESO Tecla11; |TIPO 11;
     |SI nModo = 4; |Y FSalida = 10;   || F2
          aMensaje = "0000Modo consula." + &13 + "Modificacion NO permitida";
          |MENAV aMensaje;
          |ACABA;
     |FINSI;

     |SI FSalida = 10;   || F2
          aAlfa = Usuario;
          |NOME_DAT #15 aAlfa; |DELINDEX #15;
          |ABRE #15;
          |DDEFECTO #16;
          nTipo = 1;          || Mano Obra
          nLineas = 0;
          |BUCLE CargaLinOrd;
          |CIERRA #15;
          |SI nLineas = 0;
               |MENAV "0000No hay registros...";
               |ERROR;
          |SINO;
               |PUSHV 0501 2380;
               |PINPA #0#15;
               |PINPA #0#16;
               |PINDA #0#16;
               |PARA; |SI; |HACIENDO;
                    |MENSA "0000<ENTER> Marca linea   <F5> Desprecia linea";
                    |ENTLINEAL #2#15, 1, 4, 21, 0, Min15, Max15;
                    |MENU aMenuC;
                    |SI FSalida ! 1; |SAL; |FINSI;
               |SIGUE;
               |POPV;
               |SI FSalida = 2;

                    || aponer = Asino; |HAZ poncontr;
                    nSwMeteAlgo = 0;
                    |ABRE #626;
                    |BUCLE DescargaMano;
                    |CIERRA #626;
                    |SI nSwMeteAlgo = 0;
                         |ERROR;
                    |FINSI;

                    || aponer = Anosi; |HAZ poncontr;
                    || |PONCONTROL 23, "SI";
||                    |PTEC 807;
               |SINO;
                    |ERROR;
               |FINSI;
          |FINSI;

          |DELINDEX #15;
     |FINSI;
|FPRC;

|PROCESO MiraMarca;
     |SI #15#6 = "*";
          aMarca = "S";
          |ERROR10;
     |FINSI;
|FPRC;

|DEFBUCLE MiraMarca;
     #15#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, MiraMarca;
|FIN;

|PROCESO Min17;
     #17#10 = #0#25;
     #17#0 = #0#0;
     #17#1 = #0#1;
     #17#2 = #12#2;
     #17#12 = 1;
|FPRC;

|PROCESO Max17;
     #17#10 = #0#25;
     #17#0 = #0#0;
     #17#1 = #0#1;
     #17#2 = #12#2;
     #17#12 = 999;
|FPRC;

|PROCESO Tecla12; |TIPO 11;
     |SI nModo = 4; |Y FSalida = 11; || F3
          aMensaje = "0000Modo consula." + &13 + "Modificacion NO permitida";
          |MENAV aMensaje;
          |ACABA;
     |FINSI;

     |SI FSalida = 11; || F3
          aAlfa = Usuario;
          |NOME_DAT #15 aAlfa; |DELINDEX #15;
          |ABRE #15;
          |DDEFECTO #16;
          nTipo = 2;          || Materiales
          nLineas = 0;
          |BUCLE CargaLinOrd;
          |CIERRA #15;
          |SI nLineas = 0;
               |MENAV "0000No hay registros...";
               |ERROR;
          |SINO;
               |PUSHV 0501 2380;
               |PINPA #0#15;
               |PINPA #0#16;
               |PINDA #0#16;
               |PARA; |SI; |HACIENDO;
                    |MENSA "0000<ENTER> Marca linea   <F5> Desprecia linea" ;
                    |ENTLINEAL #2#15, 1, 4, 21, 0, Min15, Max15;
                    |MENU aMenuC;
                    |SI FSalida ! 1; |SAL; |FINSI;
               |SIGUE;
               |POPV;
               |SI FSalida = 2;
                    nSwAgrupa = 0;
                    aMarca = "N";
                    |BUCLE MiraMarca;
                    |SI aMarca = "S";
                         |MENU aMenuD;
                         |SI FSalida = 2; nSwAgrupa = 1; |FINSI;
                    |FINSI;

                    ||aponer = Asino; |HAZ poncontr;
                    nLin = 0; nTotaImp = 0; nTotaUni = 0;
                    |ABRE #626;
                    |ABRE #17;
                    nSwMeteAlgo = 0;
                    |BUCLE DescargaMate;
                    |SI nLin > 0; |Y nSwAgrupa = 1;
                         #12#4 = "Articulos agrupados";
                         #12#5 = nTotaUni;
                         #12#7 = nTotaImp;
                         #12#6 = #12#7/#12#5;
                         #12#8 = "A";
                         |GRABA 020#12n;

                         nForma = 1; |HAZ AcuArti;
                    |FINSI;
                    |CIERRA #17;
                    |CIERRA #626;
                    |SI nSwMeteAlgo = 0;
                         |ERROR;
                    |FINSI;
               |SINO;
                    |ERROR;
               |FINSI;
          |FINSI;

          |DELINDEX #15;
     |FINSI;
     |SI FSalida = 12;   ||F4
          |SI #12#8 = "A";
               |PUSHV 0501 2380;
               |ENTLINEAL #1#17, 5, 4, 22, 1, Min17, Max17;
               |POPV;
          |SINO;
               |MENAV "0000La linea no es de articulos agrupados";
          |FINSI;
          |ERROR;
     |FINSI;
|FPRC;
---------------------------------------------------
|PROCESO Arti12; |TIPO 0;
     ||TODO CCC.
     ||Es un articulo. (AGIFA019)
/*
     |SI #12Campo ! Contenido;
          |ABRE #606
          #606#0 = #12#3;
          |LEE 020#606=;
          |CIERRA #606;
          #12#4 = #606#1; |PINTA #12#4;
          #12#6 = #606#2; |PINTA #12#6;
     |FINSI;
*/
     |SI #12Campo ! Contenido;
          |ABRE #agifa019
          #agifa019#0 = #12#3;
          |LEE 000#agifa019.=;
          |CIERRA #agifa019;
          #12#4 = #agifa019#1; |PINTA #12#4;
          #12#6 = #agifa019#18; |PINTA #12#6;
     |FINSI;
|FPRC;


|PROCESO Arti13; |TIPO 0;
     |SI #13Campo ! Contenido;
          |ABRE #606
          #606#0 = #13#9;
          |LEE 020#606=;
          |CIERRA #606;
          #13#10 = #606#1; |PINTA #13#10;
          #13#12 = #606#2; |PINTA #13#12;
     |FINSI;
|FPRC;


|PROCESO Tipo7_12; |TIPO 7;
     nModoLin = (FEntrada / 100) ! 0;
     |SI nModoLin = 1;
          #12#10 = #0#25;
          #12#0 = #0#0;
          #12#1 = #0#1;
          #12#2 = 5000;
          |LEE 000#12];
          |SI FSalida = 0;
               |LEE 000#12.a;
          |SINO;
               |LEE 000#12.u;
          |FINSI;
          |SI FSalida = 0; |Y #12#10 = #0#25; |Y #12#0 = #0#0; |Y #12#1 = #0#1;
               nUltimaLin = #12#2 + 1;
          |SINO;
               nUltimaLin = 1001;
          |FINSI;
          |DDEFECTO #12;
          #12#10 = #0#25;
          #12#0 = #0#0;
          #12#1 = #0#1;
          #12#2 = nUltimaLin;
          |PINTA #12#2;
     |FINSI;
|FPRC;

|PROCESO Tipo7_13; |TIPO 7;
     nModoLin = (FEntrada / 100) ! 0;
     |SI nModoLin = 1;
          #13#8 = #0#25;
          #13#0 = #0#0;
          #13#1 = #0#1;
          #13#2 = 9999;
          |LEE 000#13.];
          |SI FSalida = 0;
               |LEE 000#13.a;
          |SINO;
               |LEE 000#13.u;
          |FINSI;
          |SI FSalida = 0; |Y #13#8 = #0#25; |Y #13#0 = #0#0; |Y #13#1 = #0#1;
               nUltimaLin = #13#2 + 1;
          |SINO;
               nUltimaLin = 2001;
          |FINSI;
          |DDEFECTO #13;
          #13#8 = #0#25;
          #13#0 = #0#0;
          #13#1 = #0#1;
          #13#2 = nUltimaLin;
          |PINTA #13#2;
     |FINSI;
|FPRC;

|PROCESO Modi13; |TIPO 0;
/*
     |SI #13#13 = 0;
          |C_M #13#6, 1, "S";
          |C_M #13#9, 1, "S";
          |C_M #13#10, 1, "S";
          |C_M #13#11, 1, "S";
          |C_M #13#12, 1, "S";
     |SINO;
          |C_M #13#6, 1, "N";
          |C_M #13#9, 1, "N";
          |C_M #13#10, 1, "N";
          |C_M #13#11, 1, "N";
          |C_M #13#12, 1, "N";
     |FINSI;
*/
|FPRC;

|PROCESO DescargaSerEx;
     |SI #15#6 ! "*"; |Y #15#7 ! "*";
          |ACABA;
     |FINSI;

     #626#0 = #3#2;
     #626#1 = #3#3;
     #626#11 = #15#0;
     |LEE 121#626=;
     |SI FSalida = 0;
          |SI #15#7 = "*";
               #626#30 = "S";
               |GRABA 020#626a;
               |LIBERA #626;
          |SINO;
               #626#30 = "N";
               #626#31 = #3#37;
               #626#32 = #3#0;
               #626#33 = #0#1;
               |GRABA 020#626a;
               |LIBERA #626;

               #13#8 = #0#25;
               #13#0 = #0#0;
               #13#1 = #0#1;
               #13#2 = 9999;
               |LEE 000#13];
               |SI FSalida = 0;
                    |LEE 000#13a;
               |SINO;
                    |LEE 000#13u;
               |FINSI;
               |SI FSalida = 0; |Y #13#8 = #0#25; |Y #13#0 = #0#0; |Y #13#1 = #0#1;
                    nLin = #13#2 + 1;
               |SINO;
                    nLin = 2001;
               |FINSI;
               |DDEFECTO #13;
               #13#8 = #0#25;
               #13#0 = #0#0;
               #13#1 = #0#1;
               #13#2 = nLin;
               #13#9 = #626#2;
               #13#10 = #626#3;
               #13#12 = #626#5; ||Precio
               #13#11 = #626#4;  ||Uni
               #13#15 = #626#6;
               #13#6 = (#13#11 * #13#12) < #13#15;
               #13#13 = #626#11;
               |GRABA 020#13n;

               nForma = 1; |HAZ AcuExte;

               nSwMeteAlgo = 1;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE DescargaSerEx;
     #15#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, DescargaSerEx;
|FIN;

|PROCESO Tecla13; |TIPO 11;
     |SI nModo = 4; |Y FSalida = 12; || F4
          aMensaje = "0000Modo consula." + &13 + "Modificacion NO permitida";
          |MENAV aMensaje;
          |ACABA;
     |FINSI;

     |SI FSalida = 12; || F4
          aAlfa = Usuario;
          |NOME_DAT #15 aAlfa; |DELINDEX #15;
          |ABRE #15;
          |DDEFECTO #16;
          nTipo = 3;          || Servicios Externos
          nLineas = 0;
          |BUCLE CargaLinOrd;
          |CIERRA #15;
          |SI nLineas = 0;
               |MENAV "0000No hay registros...";
               |ERROR;
          |SINO;
               |PUSHV 0501 2380;
               |PINPA #0#15;
               |PINPA #0#16;
               |PINDA #0#16;
               |PARA; |SI; |HACIENDO;
                    |MENSA "0000<ENTER> Marca linea   <F5> Desprecia linea";
                    |ENTLINEAL #2#15, 1, 4, 21, 0, Min15, Max15;
                    |MENU aMenuC;
                    |SI FSalida ! 1; |SAL; |FINSI;
               |SIGUE;
               |POPV;

               |SI FSalida = 2;
                    |ABRE #626;
                    nSwMeteAlgo = 0;
                    |BUCLE DescargaSerEx;
                    |CIERRA #626;
                    |SI nSwMeteAlgo = 0;
                         |ERROR;
                    |FINSI;
               |SINO;
                    |ERROR;
               |FINSI;
          |FINSI;

          |DELINDEX #15;
     |FINSI;
|FPRC;

|PROCESO TallerBorLin;
     |DDEF aAlfa; aAlfa = aAlfa + "con0g012";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |ABRE #referen@;
     #referen@#10 = #12#10;
     #referen@#0 = #12#0;
     #referen@#1 = #12#1;
     #referen@#2 = #12#12;
     |LEE 101#referen@.=;
     nTallerBorLin = FSalida;
     |SI FSalida = 0;
          |BORRA 020#referen@.a;
     |FINSI;
     |CIERRA #referen@;

     |DESCARGA_DEF #referen@;
|FPRC;

|PROCESO AcuArti2;
     |HAZ AcuArti;
/*
     #0#17 = #0#17 +. #12#7;
     #0#20 = #0#20 +. #12#7;
     |GRABA 020#3a;

     #3#27 = #3#27 +. #12#7;
     #3#30 = #3#30 +. #12#7;
     |GRABA 020#0a;
*/
|FPRC;

|PROCESO TallerCreaLin;
     |DDEF aAlfa; aAlfa = aAlfa + "con0g012";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |ABRE #referen@;
     |SI #12#12 > 0;
          nLin = #12#12;
          #referen@#10 = #12#10;
          #referen@#0 = #12#0;
          #referen@#1 = #12#1;
          #referen@#2 = nLin;
          |LEE 121#referen@.=;
     |SINO;
          #referen@#10 = #12#10;
          #referen@#0 = #12#0;
          #referen@#1 = #12#1;
          #referen@#2 = 9999;
          |LEE 000#referen@.];
          |SI FSalida = 0;
               |LEE 000#referen@.a;
          |SINO;
               |LEE 000#referen@.u;
          |FINSI;
          |SI FSalida = 0; |Y #referen@#10 = #12#10; |Y #referen@#0 = #12#0; |Y #referen@#1 = #12#1;
               nLin = #referen@#2 + 1;
          |SINO;
               nLin = 1;
          |FINSI;
          |SI nLin [ #12#2; nLin = #12#2 + 1; |FINSI;
          |DDEFECTO #referen@;
          #referen@#10 = #12#10;
          #referen@#0 = #12#0;
          #referen@#1 = #12#1;
          #referen@#2 = nLin;
          |GRABA 020#referen@.b;
     |FINSI;
     aAlfa = "CANON " + #12#4;
     #referen@#3 = "xxxxx";
     #referen@#4 = aAlfa;
     #referen@#5 = #12#5;
     #referen@#6 = enCanon;
     #referen@#7 = #referen@#5 * #referen@#6;
     #referen@#8 = #12#8;
     #referen@#10 = #12#10;
     #referen@#11 = #12#11;
     #referen@#12 = -1;
     |SALVA_DATOS #12;

     |SALVA_DATOS #referen@;
     |REPON_DATOS #12;

     |HAZ AcuArti2;

     |SALVA_DATOS #12;
     |REPON_DATOS #referen@;
     |GRABA 020#referen@.a;

     |REPON_DATOS #12;

     #12#12 = nLin;  || Linea Canon

     |CIERRA #referen@;
     |DESCARGA_DEF #referen@;
|FPRC;

|PROCESO TallerAcuLin;
     |DDEF aAlfa; aAlfa = aAlfa + "con0g012";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |ABRE #referen@;
     #referen@#10 = #12#10;
     #referen@#0 = #12#0;
     #referen@#1 = #12#1;
     #referen@#2 = #12#12;
     |LEE 101#referen@.=;
     |SI FSalida = 0;
          |SALVA_DATOS #12;
          |SALVA_DATOS #referen@;
          |REPON_DATOS #12;
          |HAZ AcuArti2;
          |REPON_DATOS #12;
     |FINSI;
     |CIERRA #referen@;

     |DESCARGA_DEF #referen@;
|FPRC;

|PROCESO Canon;
     eaArticulo = #12#3; |QBF eaArticulo;
     |HAZ TallerCanon;
     |SI nForma = 1;
          |SI enCanon ! 0;
               aponer = Asino; |HAZ poncontr;
               |HAZ TallerCreaLin;
               aponer = Anosi; |HAZ poncontr;
               |SI nModo = 1; |PTEC 809; |PTEC 809; |PTEC 809; |FINSI;
               |PTEC 806;
          |SINO;
               |SI #12#12 > 0;      || ha cambiado a un articulo sin canon
                    |HAZ TallerBorLin;
                    #12#12 = 0;
               |FINSI;
          |FINSI;
     |SINO;
          |SI nModo = 3; |Y nModoCab ! 3;
               |HAZ TallerAcuLin;
               |HAZ TallerBorLin;
               |SI nTallerBorLin = 0;
                    || |PONCONTROL 23, "SI";
                    |||PTEC 809; |PTEC 808;
               |FINSI;
          |SINO;
               |SI nModo = 2;
                    |HAZ TallerAcuLin;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;
