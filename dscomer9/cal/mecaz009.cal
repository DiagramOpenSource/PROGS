|FICHEROS;
     mecaz009 #0;
     mecam009 #9;
     mecam011 #11;
     mecam012 #12;
     mecaw014 #14,MANTE; ||Tmp
     mecaw015 #15,MANTE; ||Tmp
     agifa017 #17;
     agifa019 #19;
     dsm00024 #24;
|FIN;

|VARIABLES;
     aDArt = "                    ";
     aHArt = "zzzzzzzzzzzzzzzzzzzz";
     nModo = 0;
     aConsumida = "";
     &Tempo = "";
     aTmp14 = "";
     aTmp15 = "";
     nHay = 0;
     nUni = 0;
     nForma = 0;
     aPartida = "";
     aAlfa = "";
     aArti = "";
     nAlma = 0;
     aParti = "";
     {-1}Menu = "";
     Menu1 = "2400";
     Menu2 = "1";
     Menu3 = "Opciones:";
     Menu4 = "RAC";
     Menu5 = " Repasar ";
     Menu6 = " Aceptar ";
     Menu7 = " Cancelar ";
|FIN;

|PROCESO Min24;
     #24#0 = #15#1;
     #24#1 = #15#6;
     #24#2 = " " * 30;
|FPRC;

|PROCESO Max24;
     #24#0 = #15#1;
     #24#1 = #15#6;
     #24#2 = "z" * 30;
|FPRC;

|PROCESO Parti66; |TIPO 66;
     |ABRE #24;
     #24#0 = #15#1;
     #24#1 = #15#6;
     #24#2 = #15#3;
     |LEE 000#24];
     |CONSULTA_F_CLAVE #1#24, Min24, Max24;
     |SI FSalida = 0;
          #15#3 = #24#2; |PINTA #15#3;
     |SINO;
          |ERROR;
     |FINSI;
     |CIERRA #24;
|FPRC;

|PROCESO DefeUni; |TIPO 0;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 1;
          |ABRE #24;
          #24#0 = #15#1;
          #24#1 = #15#6;
          #24#2 = #15#3;
          |LEE 000#24=;
          |SI FSalida = 0;
               #15#7 = #24#31;
          |FINSI;
          |CIERRA #24;
          |PINTA #15#7;
     |FINSI;
|FPRC;

|PROCESO Stock;
     #19#0 = aArti;
     |LEE 101#19=;
     |SI FSalida = 0;
          #19#12 = #19#12 + nUni;
          #19#104 = #19#104 - nUni;

          #17#0 = aArti;
          #17#1 = nAlma;
          |LEE 101#17=;
          |SI FSalida = 0;
               #17#8 = #17#8 + nUni;
               #17#39 = #17#39 - nUni;
               |HAZ ValoraStock;
               |GRABA 020#17a;
               |SI #19#180 = "S";
                    |DDEFECTO #24;
                    #24#0 = aArti;
                    #24#1 = nAlma;
                    #24#2 = aParti;
                    |LEE 101#24=;
                    |SI FSalida ! 0; |GRABA 020#24b; |FINSI;
                    #24#24 = #24#24 + nUni; ||Reservado (INTERNO)
                    #24#22 = #24#22 - nUni;
                    |HAZ ValoraStock;
                    |GRABA 020#24a;
                    |LIBERA #24;
               |FINSI;
          |SINO;
               |HAZ ValoraStock;
          |FINSI;
          |GRABA 020#19a;
     |FINSI;
|FPRC;

|PROCESO Tmp15;
     |DDEFECTO #12;
     #12#0 = #0#0;
     #12#1 = #0#1;
     #12#2 = #15#0;
     #12#3 = #15#1;
     #12#6 = #15#3;
     #12#5 = #14#3;
     |LEE 101#12=;
     |SI FSalida ! 0; |GRABA 020#12b; |FINSI;
     #12#4 = #15#6;
     #12#7 = #12#7 + #15#4;
     #12#8 = #15#2;
     #12#9 = #15#5;
     #12#11 = #15#7;
     |GRABA 020#12a;
     |LIBERA #12;
     aArti = #12#3;
     nAlma = #12#4;
     aParti = #12#6;
     nUni = #12#7;
     |HAZ Stock;
|FPRC;

|DEFBUCLE Tmp15;
     #15#1;
     ;
     #14#0, #14#1, #14#3, 000;
     #14#0, #14#1, #14#3, 999;
     ;
     NULL, Tmp15;
|FIN;

|PROCESO Tmp14;
     |BUCLE Tmp15;

     |DDEFECTO #11;
     #11#0 = #0#0;
     #11#1 = #0#1;
     #11#2 = #14#0;
     #11#3 = #14#1;
     #11#4 = #14#2;
     #11#5 = #14#3;
     #11#6 = #14#4;
     #11#7 = #14#5;
     #11#8 = #14#6;
     |GRABA 020#11n;
     |SI #11#6 = "N";
          aArti = #11#3;
          nAlma = #11#4;
          nUni = #11#7;
          aParti = "";
          |HAZ Stock;
     |FINSI;
|FPRC;

|DEFBUCLE Tmp14;
     #14#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Tmp14;
|FIN;

|PROCESO Borra12;
     |BORRA 020#12a;
     aArti = #12#3;
     nAlma = #12#4;
     aParti = #12#6;
     nUni = -#12#7;
     |HAZ Stock;
|FPRC;

|PROCESO Borra11;
     |BORRA 020#11a;
     |SI #11#6 = "N";
          aArti = #11#3;
          nAlma = #11#4;
          aParti = "";
          nUni = -#11#7;
          |HAZ Stock;
     |FINSI;
|FPRC;

|DEFBUCLE Borra12;
     #12#1;
     ;
     #0#0, #0#1, aDArt, aDArt, "               ", " ";
     #0#0, #0#1, aHArt, aHArt, "zzzzzzzzzzzzzzz", "z";
     be;
     NULL, Borra12;
|FIN;

|DEFBUCLE Borra11;
     #11#1;
     ;
     #0#0, #0#1, aDArt, aDArt, " ";
     #0#0, #0#1, aHArt, aHArt, "z";
     be;
     NULL, Borra11;
|FIN;

|PROCESO Actualiza;
     |ABRE #24;
     |ABRE #17;
     |ABRE #19;
     |BUCLE Borra11;
     |BUCLE Borra12;
     |ABRE #11;
     |ABRE #12;
     |BUCLE Tmp14;
     |CIERRA #12;
     |CIERRA #11;
     |CIERRA #19;
     |CIERRA #17;
     |CIERRA #24;
|FPRC;

|PROCESO Tipo2_15; |TIPO 2;
     nForma = 0 +. 1;
     |SI #15#5 ! 0;
          |SI nForma = -1;
               |MENAV "0000Tiene unidades consumnidas";
          |FINSI;
          |ERROR; |ACABA;
     |FINSI;
     #14#8 = #14#8 +. #15#4;
|FPRC;

|PROCESO Max15;
     #15#0 = #14#0;
     #15#1 = #14#1;
     #15#8 = #14#3;
     #15#2 = 999;
|FPRC;

|PROCESO Min15;
     #15#0 = #14#0;
     #15#1 = #14#1;
     #15#8 = #14#3;
     #15#2 = 0;
|FPRC;

|PROCESO Chequea;
     nUni = nUni + #15#4;
|FPRC;

|DEFBUCLE Chequea;
     #15#1;
     ;
     #14#0, #14#1, #14#3, 000;
     #14#0, #14#1, #14#3, 999;
     ;
     NULL, Chequea;
|FIN;

|PROCESO DefAlma; |TIPO 0;
     #15#6 = #14#2;
|FPRC;

|PROCESO Tecla; |TIPO 0;
     |SI FSalida = 0; |Y #14Campo = Contenido;
          |SI aConsumida = "S";
               |MENAV "0000Tiene unidades consumidas";
               |ERROR; |ACABA;
          |FINSI;

          |SI #14#4 = "N";
               |ENCAMPO #5#14;
               |SI FSalida = 0;
                    |GRABA 020#14a;
               |FINSI;
          |SINO;
               |PUSHV 0501 2380;
               |ENTLINEAL #1#15, 4, 2, 22, 1, Min15, Max15;
               nUni = 0;
               |BUCLE Chequea;
               #14#5 = nUni;
               #14#8 = nUni;
               |POPV;
               |GRABA 020#14a;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO mecam012;
     |DDEFECTO #15;
     #15#0 = #14#0;
     #15#1 = #14#1;
     #15#2 = #12#8;
     #15#3 = #12#6;
     #15#4 = #12#7;
     #15#5 = #12#9;
     #15#6 = #12#4;
     #15#7 = #12#11;
     #15#8 = #14#3;
     |GRABA 020#15n;
     #14#5 = #14#5 + #15#4;
     #14#6 = #14#6 + #15#5;
|FPRC;

|DEFBUCLE mecam012;
     #12#1;
     ;
     #11#0, #11#1, #11#2, #11#3, "               ", #11#5;
     #11#0, #11#1, #11#2, #11#3, "zzzzzzzzzzzzzzz", #11#5;
     ;
     NULL, mecam012;
|FIN;

|PROCESO mecam011;
     |SI #11#9 = "S";
          aConsumida = "S";
     |FINSI;

     |DDEFECTO #14;
     #14#0 = #11#2;
     #14#1 = #11#3;
     #14#2 = #11#4;
     #14#3 = #11#5;
     #14#4 = #11#6;
     |DDEFECTO #19;
     #19#0 = #14#1;
     |LEE 000#19=;
     #14#7 = #19#1;
     |SI #11#6 = "S";
          |BUCLE mecam012;
     |SINO;
          #14#5 = #11#7;
          #14#6 = #11#8;
     |FINSI;
     #14#8 = #14#5;
     |GRABA 020#14n;
     nHay = 1;
|FPRC;

|DEFBUCLE mecam011;
     #11#1;
     ;
     #0#0, #0#1, "                    ", "                    ", " ";
     #0#0, #0#1, "zzzzzzzzzzzzzzzzzzzz", "zzzzzzzzzzzzzzzzzzzz", "z";
     ;
     NULL, mecam011;
|FIN;

|PROCESO Min;
     #14#0 = " " * 20;
     #14#1 = " " * 20;
     #14#3 = " ";
|FPRC

|PROCESO Max;
     #14#0 = "z" * 20;
     #14#1 = "z" * 20;
     #14#3 = "z";
|FPRC;

|PROCESO Tipo3; |TIPO 3;
     |ABRE #9;
     #9#0 = #0#0;
     #9#1 = #0#1;
     |LEE 101#9=;
     |SI FSalida ! 0;
          |MENAV "0000No existe Orden...";
          |ACABA;
     |FINSI;

     |HAZ CreaTempo; |NOME_DAT #14 Tempo; |DELINDEX #14; aTmp14 = Tempo;
     |HAZ CreaTempo; |NOME_DAT #15 Tempo; |DELINDEX #15; aTmp15 = Tempo;
     |ABRE #14;
     |ABRE #15;
     |ABRE #19;
     |BUCLE mecam011;
     |CIERRA #19;
     |CIERRA #15;
     |CIERRA #14;
     |SI nHay = 0;
          |MENAV "0000No hay registros";
     |SINO;
          |PARA; |SI; |HACIENDO;
               |ENTLINEAL #1#14, 1, 4, 22, 0, Min, Max;
               |MENU Menu;
               |SI FSalida = 0; |O FSalida = 3; |SAL; |FINSI;
               |SI FSalida = 2;
                    |SI aConsumida ! "S";
                         |HAZ Actualiza;
                    |FINSI;
                    |SAL;
               |FINSI;
          |SIGUE;
     |FINSI;

     aTmp14 = Tempo; |HAZ BoraTempo; |DELINDEX #14;
     aTmp15 = Tempo; |HAZ BoraTempo; |DELINDEX #15;

     |CIERRA #9;
|FPRC;

|PROGRAMA;
     |CLS;
     |PINPA #0#0;
     |PINDA #0#0;
     |ENTLINEAL #1#14, 1, 7, 22, 0, Min, Max;
     |ENDATOS #1#0;
|FPRO;
