|FICHEROS;
     pcegz020 #0;
     pcegw003 #3;   || Alba
     pcegw004 #4;   || Factu
     pcegz006 #6; || Ventana Espera
     pcegw015 #15;  || Alba Confirmados
     pcegm016 #16;
     pcegm020 #20;
     pcegz021 #21,MANTE; || Borrar Albaran/factura
     pcegz035 #35,MANTE; || Confirmar Albaran/Cambio agencia

     agifa010 #10;
     pcegm042 #42;
     agifa059 #59;
     agifa071 #71;
     pcegm004 #104;
     pcegm006 #106;
     agifa134 #134;
     dsm00020;
     gestempo;
|FIN;

|VARIABLES;
     {-1}aGet       = 0;
         aGet1      = 0;
         aGet2      = 0;
     nCampo = 0;
     nBultos = 0;
     nAgen = 0;
     aSerAlb = "";
     nNumAlb = 0;
     &Tempo = "";
     i = 0;
     aAlfa = "";
     aFich = "";
     aFichero = "";
     aEmp = "";
     nHandle = 0;
     nRango = 0;
     nPos1 = 0;
     nPos2 = 0;
     nPanta0 = 0;
     nPanAlb = 0;
     nPanFac = 0;
     nPanCon = 0;
     nPanta = 0;
     nGridAlb = 0;
     nGridFac = 0;
     nGridCon = 0;
     nBtnFacAnula = 0;
     nBtnFacAgencia = 0;
     nBtnFacEtiqueta = 0;
     nBtnFacSal = 0;
     nBtnAlbConfi = 0;
     nBtnAlbCancel = 0;
     nBtnActualiza = 0;
     nBtnAlbSal = 0;
     nBtnConAge = 0;
     nBtnConSal = 0;
     nVentana0 = 0;
     nVenEspera = -1;
     nLabel = 0;
     nLabelFac = 0;
     nLabelAlb = 0;
     nLabelCon = 0;
     nFocoFac = 0;
     nFocoAlb = 0;
     nFocoCon = 0;
     {-1}aVent = "";
         aVent1 = 0;
         aVent2 = 0;
         aVent3 = 0;
         aVent4 = 0;
         aVent5 = "";
     nPrimera = 0;
     aEstadoBtnIni = "";
     aTmp3 = "";
     aTmp4 = "";
     aTmp15 = "";
     nTecla = 0;
     aAuto = "";
     aProg = "";
     nPestana = 0;
     aGuardaPestana = "";

     aPestana = "";
     aFecha = "";
     aClaveFac = "";
     aClaveAlb = "";
     aClaveCon = "";
|FIN;

|PROCESO FinVentanaEspera;
     |SI nVenEspera = -1; |ACABA; |FINSI;
     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVenEspera;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;
     |FINVENTANA nVenEspera;
|FPRC;

|PROCESO IniVentanaEspera;
     |VENTANA 1512, 2291, -1, 17, "Mensaje";
     nVenEspera = FSalida;
     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVenEspera;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;
     |PINPA #0#6;
     |PTEC 802;
     |PAUSA;
|FPRC;
---------------------------------------------------------------
|PROCESO BtnConAge;
     aSerAlb = #15#52;
     nNumAlb = #15#0;

     |ABRE #16;
     #16#0 = aSerAlb;
     #16#1 = nNumAlb;
     |LEE 000#16=;
     |SI FSalida = 0;
          aSerAlb = #16#2;
          nNumAlb = #16#3;
     |SINO;
          |MENAV "0000No existe albaran de servicio relacionado";
          |ACABA;
     |FINSI;
     |CIERRA #16;

     |ABRE #10;
     #10#52 = aSerAlb;
     #10#0 = nNumAlb;
     |LEE 000#10=;
     |SI FSalida ! 0;
          aAlfa = "0000Error al leer albaran servicio:" + #10#52 + "/" + (("000000" + #10#0) % -106);
          |MENAV aAlfa;
          |ACABA;
     |FINSI;
     |CIERRA #10;

     |VENTANA 1525, 2381, -1, 17, "Cambiar Agencia";
     nVentana0 = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentana0;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |ABRE #10;
     #10#52 = aSerAlb;
     #10#0 = nNumAlb;
     |LEE 121#10=;

     #35#0 = #10#52;
     #35#1 = #10#0;
     #35#2 = #10#88;
     #35#3 = #10#9;
     #35#4 = #10#2;
     |SI #35#4 = 0; #35#4 = 1; |FINSI; || bultos
     nBultos = #35#4;
     nAgen = #35#2;

     |PINPA #0#35; nPanta = FSalida;
     |PINDA #0#35;

     aAuto = "";
     |ENDATOS #1#35;
     |SI FSalida = 0; |Y nTecla = 0;
          aAuto = "1";
          |SI nBultos ! #35#4; |O nAgen ! #35#2;
               #10#88 = #35#2;
               #10#9 = #35#3;
               #10#2 = #35#4;
               |GRABA 020#10a;
          |FINSI;
     |FINSI;

     |LIBERA #10;
     |CIERRA #10;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentana0;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nVentana0;
     |PULSATECLA;

     |SI aAuto ! "";
          |SI nBultos ! #35#4; |O nAgen ! #35#2;
               |HAZ IniVentanaEspera;
               ||   Progama + Clave
               aProg = "pcegz019" + #10#52 + (("000000" + #10#0) % -106);
               |PTEC 807;
          |SINO;
               aAuto = "";
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO BtnConSal;
     |PTEC 807;
|FPRC;
---------------------------------------------------------------
|PROCESO ModiFase; |TIPO 7;
     aAlfa = #21#2;
     |C_M #21#3, 1, aAlfa;
|FPRC;

|PROCESO BtnFacEtiqueta;
     |ABRE #59;
     #59#14 = #4#49;
     #59#0 = #4#0;
     #59#1 = 1;
     |LEE 000#59];
     |SI FSalida = 0; |Y #59#14 = #4#49; |Y #59#0 = #4#0;
          aSerAlb = #59#15;
          nNumAlb = #59#2;
     |SINO;
          |MENAV "0000Error al leer linea factura";
          |ACABA;
     |FINSI;
     |CIERRA #59;

     |ABRE #16;
     #16#0 = aSerAlb;
     #16#1 = nNumAlb;
     |LEE 000#16=;
     |SI FSalida = 0;
          aSerAlb = #16#2;
          nNumAlb = #16#3;
     |SINO;
          |MENAV "0000No existe albaran de servicio relacionado";
          |ACABA;
     |FINSI;
     |CIERRA #16;

     |ABRE #10;
     #10#52 = aSerAlb;
     #10#0 = nNumAlb;
     |LEE 000#10=;
     |SI FSalida ! 0;
          aAlfa = "0000Error al leer albaran servicio:" + #10#52 + "/" + (("000000" + #10#0) % -106);
          |MENAV aAlfa;
          |ACABA;
     |FINSI;
     |CIERRA #10;

     |SI #10#88 ! #20#1; |Y #10#88 ! #20#2;
          |MENAV "0000La agencia no es DHL ó CRONOEXPRESS";
          |ACABA;
     |FINSI;

     aAlfa = "0000SImprimir etiquetas del albaran:" + #10#52 + "/" + (("000000" + #10#0) % -106);
     |CONFI aAlfa;
     |SI FSalida = 0;
          aAuto = "1";
          |HAZ IniVentanaEspera;
          ||   Progama + Clave
          aProg = "pcegz019" + #10#52 + (("000000" + #10#0) % -106);
          |PTEC 807;
     |FINSI;
|FPRC;

|PROCESO BtnFacAgencia;
     |ABRE #59;
     #59#14 = #4#49;
     #59#0 = #4#0;
     #59#1 = 1;
     |LEE 000#59];
     |SI FSalida = 0; |Y #59#14 = #4#49; |Y #59#0 = #4#0;
          aSerAlb = #59#15;
          nNumAlb = #59#2;
     |SINO;
          |MENAV "0000Error al leer linea factura";
          |ACABA;
     |FINSI;
     |CIERRA #59;

     |ABRE #16;
     #16#0 = aSerAlb;
     #16#1 = nNumAlb;
     |LEE 000#16=;
     |SI FSalida = 0;
          aSerAlb = #16#2;
          nNumAlb = #16#3;
     |SINO;
          |MENAV "0000No existe albaran de servicio relacionado";
          |ACABA;
     |FINSI;
     |CIERRA #16;

     |ABRE #10;
     #10#52 = aSerAlb;
     #10#0 = nNumAlb;
     |LEE 000#10=;
     |SI FSalida ! 0;
          aAlfa = "0000Error al leer albaran servicio:" + #10#52 + "/" + (("000000" + #10#0) % -106);
          |MENAV aAlfa;
          |ACABA;
     |FINSI;
     |CIERRA #10;

     |VENTANA 1525, 2381, -1, 17, "Cambiar Agencia";
     nVentana0 = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentana0;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |ABRE #10;
     #10#52 = aSerAlb;
     #10#0 = nNumAlb;
     |LEE 121#10=;

     #35#0 = #10#52;
     #35#1 = #10#0;
     #35#2 = #10#88;
     #35#3 = #10#9;
     #35#4 = #10#2;
     |SI #35#4 = 0; #35#4 = 1; |FINSI; || bultos
     nBultos = #35#4;
     nAgen = #35#2;

     |PINPA #0#35; nPanta = FSalida;
     |PINDA #0#35;

     aAuto = "";
     |ENDATOS #1#35;
     |SI FSalida = 0; |Y nTecla = 0;
          aAuto = "1";
          |SI nBultos ! #35#4; |O nAgen ! #35#2;
               #10#88 = #35#2;
               #10#9 = #35#3;
               #10#2 = #35#4;
               |GRABA 020#10a;
          |FINSI;
     |FINSI;

     |LIBERA #10;
     |CIERRA #10;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentana0;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nVentana0;
     |PULSATECLA;

     |SI aAuto ! "";
          |SI nBultos ! #35#4; |O nAgen ! #35#2;
               |HAZ IniVentanaEspera;
               ||   Progama + Clave
               aProg = "pcegz019" + #10#52 + (("000000" + #10#0) % -106);
               |PTEC 807;
          |SINO;
               aAuto = "";
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO BtnFacAnula;
     |ABRE #134;
     #134#49 = #4#49;
     #134#0 = #4#0;
     |LEE 000#134=;
     |SI #134#48 = "S";
          |MENAV "0000FACTURA CONTABILIZADA NO ES POSIBLE DAR DE BAJA. INFORMAR AL DEPARTAMENTO DE CONTABILIDAD.";
          |ACABA;
     |FINSI;
     |CIERRA #134;

     |VENTANA 1725, 2567, -1, 17, "Borrar factura";
     nVentana0 = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentana0;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |ABRE #134;
     #134#49 = #4#49;
     #134#0 = #4#0;
     |LEE 121#134=;

     #21#0 = #134#49;
     #21#1 = #134#0;

     |PINPA #0#21; nPanta = FSalida;
     |PINDA #0#21;

     |CONTROL_SIMPLE nPanta, "LABEL,{{1}}Factura",0618, 0624, NULL;
     nLabel = FSalida;

     aAuto = "";
     |ENDATOS #1#21;
     |SI FSalida = 0; |Y nTecla = 0;
          aAuto = "1";
     |FINSI;

     |LIBERA #134;
     |CIERRA #134;

     |FIN_CONTROL_WINDOWS nLabel;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentana0;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nVentana0;
     |PULSATECLA;

     |SI aAuto ! "";
          |HAZ IniVentanaEspera;
          ||   Progama + F + " " + Clave + Rese + Fase
          aProg = "pcegz022" + "F " + #4#49 + (("000000" + #4#0) % -106) + #21#2 + #21#3;
          |PTEC 807;
     |FINSI;
|FPRC;

|PROCESO BtnFacSal;
     |PTEC 807;
|FPRC;

|PROCESO BtnAlbConfi;
     |VENTANA 1525, 2181, -1, 17, "Confirmar Albar n";
     nVentana0 = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentana0;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |ABRE #10;
     #10#52 = #3#52;
     #10#0 = #3#0;
     |LEE 121#10=;

     #35#0 = #3#52;
     #35#1 = #3#0;
     #35#2 = #10#88;
     #35#3 = #10#9;
     #35#4 = #10#2;
     |SI #35#4 = 0; #35#4 = 1; |FINSI; || bultos

     |PINPA #0#35; nPanta = FSalida;
     |PINDA #0#35;

     aAuto = "";
     |ENDATOS #1#35;
     |SI FSalida = 0; |Y nTecla = 0;
          aAuto = "1";
          |SI #35#2 ! #10#88;
               #10#88 = #35#2;
               #10#9 = #35#3;
               #10#2 = #35#4;
               |GRABA 020#10a;
          |FINSI;
     |FINSI;

     |LIBERA #10;
     |CIERRA #10;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentana0;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nVentana0;
     |PULSATECLA;

     |SI aAuto ! "";
          |HAZ IniVentanaEspera;
          ||   Progama + A + "C" + Clave
          aProg = "pcegz022" + "AC" + #3#52 + (("000000" + #3#0) % -106);
          |PTEC 807;
     |FINSI;
|FPRC;

|PROCESO BtnAlbCancel;
     |VENTANA 1725, 2567, -1, 17, "Borrar albaran";
     nVentana0 = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentana0;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |ABRE #10;
     #10#52 = #3#52;
     #10#0 = #3#0;
     |LEE 121#10=;

     #21#0 = #10#52;
     #21#1 = #10#0;

     |PINPA #0#21;
     nPanta = FSalida;
     |PINDA #0#21;

     |CONTROL_SIMPLE nPanta, "LABEL,{{1}}Albaran",0618, 0624, NULL;
     nLabel = FSalida;

     aAuto = "";
     |ENDATOS #1#21;
     |SI FSalida = 0; |Y nTecla = 0;
          aAuto = "1";
     |FINSI;

     |LIBERA #10;
     |CIERRA #10;

     |FIN_CONTROL_WINDOWS nLabel;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentana0;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |FINVENTANA nVentana0;
     |PULSATECLA;

     |SI aAuto ! "";
          |HAZ IniVentanaEspera;
          ||   Progama + A + "B" + Clave + Rese + Fase
          aProg = "pcegz022" + "AB" + #3#52 + (("000000" + #3#0) % -106) + #21#2 + #21#3;
          |PTEC 807;
     |FINSI;
|FPRC;

|PROCESO BtnAlbSal;
     |PTEC 807;
|FPRC;

|PROCESO LlenaFac;
     |PARA i = 0; |SI i [ 124; |HACIENDO i = i + 1;
          #4i = #134i;
     |SIGUE;
     #59#14 = #134#49;
     #59#0 = #134#0;
     #59#1 = 1;
     |LEE 000#59];
     |SI #59#14 = #134#49; |Y #59#0 = #134#0;
          aSerAlb = #59#15;
          nNumAlb = #59#2;

          #16#0 = aSerAlb;
          #16#1 = nNumAlb;
          |LEE 000#16=;
          |SI FSalida = 0;
               aSerAlb = #16#2;
               nNumAlb = #16#3;

               #4#128 = #16#2;
               #4#129 = #16#3;
          |FINSI;

          #10#52 = aSerAlb;
          #10#0 = nNumAlb;
          |LEE 000#10=;
          |SI FSalida = 0;
               #4#125 = #10#88;
               #4#126 = #10#9;

               #71#29 = #10#52;
               #71#0 = #10#0;
               #71#1 = 1;
               |LEE 000#71];
               |SI FSalida = 0; |Y #71#29 = #10#52; |Y #71#0 = #10#0;
                    #104#25 = #71#31;
                    #104#0 = #71#12;
                    |LEE 000#104=;
                    |SI FSalida = 0;
                         #4#127 = #104#21;

                         #4#130 = #104#95;
                         #4#131 = #104#96;
                    |FINSI;
               |FINSI;
          |FINSI;

          |SELECT #6#42;
          #42#25 = aSerAlb;
          #42#26 = nNumAlb;
          |LEE 000#42=;
          |SI FSalida = 0;
               #4#130 = #42#0;
               #4#131 = #42#1;
          |FINSI;
     |FINSI;


     |GRABA 020#4n;
|FPRC;

|DEFBUCLE LlenaFac;
     #134#4;
     ;
     #0#0, "zzzzz", 999999, "      ";
     #0#0, "     ", 000001, "zzzzzz";
     ;
     NULL, LlenaFac;
|FIN;

|PROCESO LlenaAlb;
     |SELECT #2#16;
     #16#2 = #10#52;
     #16#3 = #10#0;
     |LEE 000#16=;
     |SI FSalida ! 0;
          |PARA i = 0; |SI i [ 95; |HACIENDO i = i + 1;
               #3i = #10i;
          |SIGUE;

          #71#29 = #10#52;
          #71#0 = #10#0;
          #71#1 = 1;
          |LEE 000#71];
          |SI FSalida = 0; |Y #71#29 = #10#52; |Y #71#0 = #10#0;
               #104#25 = #71#31;
               #104#0 = #71#12;
               |LEE 000#104=;
               |SI FSalida = 0;
                    #3#96 = #104#21;
               |FINSI;
          |FINSI;
          |GRABA 020#3n;
     |SINO;
          |SELECT #1#16;
          #16#0 = #10#52;
          #16#1 = #10#0;
          |LEE 000#16=;
          |SI FSalida ! 0; |ACABA; |FINSI;

          |PARA i = 0; |SI i [ 95; |HACIENDO i = i + 1;
               #15i = #10i;
          |SIGUE;

          #71#29 = #10#52;
          #71#0 = #10#0;
          #71#1 = 1;
          |LEE 000#71];
          |SI FSalida = 0; |Y #71#29 = #10#52; |Y #71#0 = #10#0;
               #104#25 = #71#31;
               #104#0 = #71#12;
               |LEE 000#104=;
               |SI FSalida = 0;
                    #15#96 = #104#21;
               |FINSI;
          |FINSI;
          |GRABA 020#15n;
     |FINSI;
|FPRC;

|DEFBUCLE LlenaAlb;
     #10#7;
     38;
     #0#0, "     ", 000001, "N";
     #0#0, "YZZZZ", 999999, "N";
     ;
     NULL, LlenaAlb;
|FIN;

|PROCESO BtnActualiza;
     |REFERENCIA_DEF aGet1, #0;
     aGet2  = 0;    || numero de campo
     IaGet = aGet1<-;
     |ESPECIFICA "GETDATACONTROL", aGet;
     #0#0 = FSalida;

     |SI nPrimera = 0; ||Solo la 1§ vez
          aEstadoBtnIni = "ENABLE"; |HAZ EstadoBotonIni;
          |HAZ EventoFocoAlb;
     |FINSI;
     nPrimera = 1;

     |CIERRAT #3;
     |CIERRAT #4;
     |CIERRAT #15;
     |DELINDEX #3;
     |DELINDEX #4;
     |DELINDEX #15;
     |ABRE #71;
     |ABRE #104;
     |ABRET #3;
     |ABRET #4;
     |ABRET #15;
     |ABRE #16;
     |BUCLE LlenaAlb;
     |CIERRA #16;
     |ABRE #10;
     |ABRE #16;
     |ABRE #59;
     |ABRE #42;
     |BUCLE LlenaFac;
     |CIERRA #42;
     |CIERRA #59;
     |CIERRA #16;
     |CIERRA #10;
     |CIERRA #104;
     |CIERRA #71;
     |LEE 000#3p;
     |LEE 000#4p;
     |LEE 000#15p;

     |DESTRUYECONTROL nGridFac;
     |DESTRUYECONTROL nGridAlb;
     |DESTRUYECONTROL nGridCon;
     |FIN_CONTROL_WINDOWS nBtnFacAnula;
     |FIN_CONTROL_WINDOWS nBtnFacAgencia;
     |FIN_CONTROL_WINDOWS nBtnFacEtiqueta;
     |FIN_CONTROL_WINDOWS nBtnFacSal;
     |FIN_CONTROL_WINDOWS nBtnAlbConfi;
     |FIN_CONTROL_WINDOWS nBtnAlbCancel;
     |FIN_CONTROL_WINDOWS nBtnAlbSal;
     |FIN_CONTROL_WINDOWS nBtnConAge;
     |FIN_CONTROL_WINDOWS nBtnConSal;

     |FIN_CONTROL_WINDOWS nFocoFac;
     |FIN_CONTROL_WINDOWS nFocoAlb;
     |FIN_CONTROL_WINDOWS nFocoCon;

     |FIN_CONTROL_WINDOWS nLabelFac;
     |FIN_CONTROL_WINDOWS nLabelAlb;
     |FIN_CONTROL_WINDOWS nLabelCon;

     |HAZ PanAlbaran;
     |HAZ PanFactura;
     |HAZ PanConfir;
|FPRC;

|PROCESO EstadoBotonIni;
     |ESTADO_CONTROL nBtnAlbConfi, aEstadoBtnIni;
     |ESTADO_CONTROL nBtnAlbCancel, aEstadoBtnIni;
     |ESTADO_CONTROL nBtnAlbSal, aEstadoBtnIni;
     |ESTADO_CONTROL nBtnFacAnula, aEstadoBtnIni;
     |ESTADO_CONTROL nBtnFacAgencia, aEstadoBtnIni;
     |ESTADO_CONTROL nBtnFacEtiqueta, aEstadoBtnIni;
     |ESTADO_CONTROL nBtnFacSal, aEstadoBtnIni;
     |ESTADO_CONTROL nBtnConAge, aEstadoBtnIni;
     |ESTADO_CONTROL nBtnConSal, aEstadoBtnIni;

     || bloquea/desbloquea todas las pesta¤as
     aAlfa = nPanAlb;
     |MAINCOMMAND 32913, "-1", "-1", aAlfa, "-1", "-1";
     |SI FSalida > 0;
          nPestana = FSalida;
          |ESTADO_CONTROL nPestana, aEstadoBtnIni;
     |FINSI;
|FPRC;
-----------------------------------------------------
|PROCESO EventoFocoFac;
     aPestana = "2";
     |FOCOTECLADO nGridFac;
|FPRC;

|PROCESO EventoFac;
     |SI FSalida = 1;  |O FSalida = 2;
          |LEE 000#4=;
          |SI FSalida = 0;
               |ESTADO_CONTROL nBtnFacAnula, "ENABLE";
               |ESTADO_CONTROL nBtnFacAgencia, "ENABLE";
               |SI #4#125 ! #20#1; |Y #4#125 ! #20#2;
                    |ESTADO_CONTROL nBtnFacEtiqueta, "DISABLE";
               |SINO;
                    |ESTADO_CONTROL nBtnFacEtiqueta, "ENABLE";
               |FINSI;

               |ABRE #59;
               #59#14 = #4#49;
               #59#0 = #4#0;
               #59#1 = 1;
               |LEE 000#59];
               |SI FSalida = 0; |Y #59#14 = #4#49; |Y #59#0 = #4#0;
                    |ABRE #10;
                    #10#52 = #59#15;
                    #10#0 = #59#2;
                    |LEE 020#10=;
                    |SI FSalida = 0;
                         nCampo = 104;
                         |HAZ QuitaObs;
                         nCampo = 104;
                         |HAZ Observa;
                         |PINTA #0#104;  |PINTA #0#105; |PINTA #0#106;
                    |FINSI;
                    |CIERRA #10;
               |FINSI;
               |CIERRA #59;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO MinFac;
     #4#49 = "      ";
     #4#0 = 000001;
|FPRC;

|PROCESO MaxFac;
     #4#49 = "zzzzzz";
     #4#0 = 999999;
|FPRC;

|PROCESO PanFactura;
     |PINPA #2#0;  nPanFac = FSalida;

     |CONTROL_SIMPLE nPanFac, "LABEL,{{1}}Facturas generadas",0502, 0530, NULL;
     nLabelFac = FSalida;

     nRango = 4 + 8 + 16 + 32;
     nPos1 = 0602;
     nPos2 = 2298;

     |CONTROL_SIMPLE nPanFac, "BOTON,Anular factura", 3102, 3116, BtnFacAnula;
     nBtnFacAnula = FSalida;
     |ESTADO_CONTROL nBtnFacAnula, "DISABLE";

     |CONTROL_SIMPLE nPanFac, "BOTON,Cambiar agencia", 3117, 3131, BtnFacAgencia;
     nBtnFacAgencia = FSalida;
     |ESTADO_CONTROL nBtnFacAgencia, "DISABLE";

     |CONTROL_SIMPLE nPanFac, "BOTON,Imprimir etiquetas", 3132, 3146, BtnFacEtiqueta;
     nBtnFacEtiqueta = FSalida;
     |ESTADO_CONTROL nBtnFacEtiqueta, "DISABLE";

     |LINEAL_SIMPLE #1#4, nRango, nPos1, nPos2, MinFac, MaxFac, EventoFac;
     nGridFac = FSalida;

     |CONTROL_SIMPLE nPanFac, "EVENTOPAN", 0000, 0000, EventoFocoFac;
     nFocoFac = FSalida;

     |CONTROL_SIMPLE nPanFac, "BOTON,{{207}} Salir", 3290, 3298, BtnFacSal;
     nBtnFacSal = FSalida;
|FPRC;

|PROCESO EventoFocoAlb;
     aPestana = "1";
     |FOCOTECLADO nGridAlb;
|FPRC;

|PROCESO QuitaObs;
     |PARA i = 1; |SI i [ 102; |HACIENDO i = i + 1;
          #0nCampo = "";
          nCampo = nCampo + 1;
     |SIGUE;
|FPRC;

|PROCESO LlenaObs;
     #0nCampo = #106#3;
     nCampo = nCampo + 1;
|FPRC;

|DEFBUCLE LlenaObs;
     #106#1;
     ;
     #71#31, #71#12, 1;
     #71#31, #71#12, 99;
     ;
     NULL, LlenaObs;
|FIN;

|PROCESO Observa;
     |ABRE #71;
     #71#29 = #10#52;
     #71#0 = #10#0;
     #71#1 = 1;
     |LEE 000#71];
     |SI FSalida = 0; |Y #71#29 = #10#52; |Y #71#0 = #10#0;
          |BUCLE LlenaObs;
     |FINSI;
     |CIERRA #71;
|FPRC;

|PROCESO EventoAlb;
     |SI FSalida = 1;  |O FSalida = 2;
          |LEE 000#3=;
          |SI FSalida = 0;
               |ESTADO_CONTROL nBtnAlbConfi, "ENABLE";
               |ESTADO_CONTROL nBtnAlbCancel, "ENABLE";

               |ABRE #10;
               #10#52 = #3#52;
               #10#0 = #3#0;
               |LEE 020#10=;
               |SI FSalida = 0;
                    nCampo = 1;
                    |HAZ QuitaObs;
                    nCampo = 1;
                    |HAZ Observa;
                    |PINTA #0#1; |PINTA #0#2; |PINTA #0#3;
               |FINSI;
               |CIERRA #10;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO MinAlb;
     #3#52 = "      ";
     #3#0 = 000001;
|FPRC;

|PROCESO MaxAlb;
     #3#52 = "zzzzzz";
     #3#0 = 999999;
|FPRC;

|PROCESO PanAlbaran;
     |PINPA #1#0;  nPanAlb = FSalida;

     |CONTROL_SIMPLE nPanAlb, "LABEL,{{1}}Albaranes pendientes",0502, 0530, NULL;
     nLabelAlb = FSalida;

     nRango = 4 + 8 + 16 + 32;
     nPos1 = 0602;
     nPos2 = 2298;

     |CONTROL_SIMPLE nPanAlb, "BOTON,Confirmar envio", 3102, 3116, BtnAlbConfi;
     nBtnAlbConfi = FSalida;

     |CONTROL_SIMPLE nPanAlb, "BOTON,Cancelar envio", 3117, 3131, BtnAlbCancel;
     nBtnAlbCancel = FSalida;

     |ESTADO_CONTROL nBtnAlbConfi, "DISABLE";
     |ESTADO_CONTROL nBtnAlbCancel, "DISABLE";

     |LINEAL_SIMPLE #1#3, nRango, nPos1, nPos2, MinAlb, MaxAlb, EventoAlb;
     nGridAlb = FSalida;

     |CONTROL_SIMPLE nPanAlb, "EVENTOPAN", 0000, 0000, EventoFocoAlb;
     nFocoAlb = FSalida;

     |CONTROL_SIMPLE nPanAlb, "BOTON,{{207}} Salir", 3290, 3298, BtnAlbSal;
     nBtnAlbSal = FSalida;
|FPRC;

|PROCESO EventoFocoCon;
     aPestana = "3";
     |FOCOTECLADO nGridCon;
|FPRC;

|PROCESO QuitaObsCon;
     |PARA i = 1; |SI i [ 45; |HACIENDO i = i + 1;
          #0nCampo = "";
          nCampo = nCampo + 1;
     |SIGUE;
|FPRC;

|PROCESO LlenaObsCon;
     #0nCampo = #106#3;
     nCampo = nCampo + 1;
|FPRC;

|DEFBUCLE LlenaObsCon;
     #106#1;
     ;
     #71#31, #71#12, 1;
     #71#31, #71#12, 45;
     ;
     NULL, LlenaObsCon;
|FIN;

|PROCESO ObservaCon;
     |ABRE #71;
     #71#29 = #10#52;
     #71#0 = #10#0;
     #71#1 = 1;
     |LEE 000#71];
     |SI FSalida = 0; |Y #71#29 = #10#52; |Y #71#0 = #10#0;
          |BUCLE LlenaObsCon;
     |FINSI;
     |CIERRA #71;
|FPRC;

|PROCESO EventoCon;
     |SI FSalida = 1;  |O FSalida = 2;
          |LEE 000#15=;
          |SI FSalida = 0;
               |ESTADO_CONTROL nBtnConAge, "ENABLE";

               |ABRE #10;
               #10#52 = #15#52;
               #10#0 = #15#0;
               |LEE 020#10=;
               |SI FSalida = 0;
                    nCampo = 207;
                    |HAZ QuitaObsCon;
                    nCampo = 207;
                    |HAZ ObservaCon;
                    |PINTA #0#207; |PINTA #0#208; |PINTA #0#209;
               |FINSI;
               |CIERRA #10;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO MinCon;
     #15#52 = "      ";
     #15#0 = 000001;
|FPRC;

|PROCESO MaxCon;
     #15#52 = "zzzzzz";
     #15#0 = 999999;
|FPRC;

|PROCESO PanConfir;
     |PINPA #3#0;  nPanCon = FSalida;

     |CONTROL_SIMPLE nPanCon, "LABEL,{{1}}Albaranes confirmados",0502, 0530, NULL;
     nLabelCon = FSalida;

     nRango = 4 + 8 + 16 + 32;
     nPos1 = 0602;
     nPos2 = 2298;

     |CONTROL_SIMPLE nPanCon, "BOTON,Cambiar agencia", 3102, 3116, BtnConAge;
     nBtnConAge = FSalida;

     |ESTADO_CONTROL nBtnConAge, "DISABLE";

     |LINEAL_SIMPLE #1#15, nRango, nPos1, nPos2, MinCon, MaxCon, EventoCon;
     nGridCon = FSalida;

     |CONTROL_SIMPLE nPanCon, "EVENTOPAN", 0000, 0000, EventoFocoCon;
     nFocoCon = FSalida;

     |CONTROL_SIMPLE nPanCon, "BOTON,{{207}} Salir", 3290, 3298, BtnConSal;
     nBtnConSal = FSalida;
|FPRC;

|PROCESO LeeTxt;
     |DBASE aFich;
     aFich = aFich + "fich/";
     aFichero = aFich + "C" + (Usuario % 810);
     |XABRE "", aFichero, nHandle;

     |XLEE nHandle, 250, aEmp;
     |XLEE nHandle, 250, aAuto;
     |XLEE nHandle, 250, aProg;
     |XLEE nHandle, 250, aFecha;
     |XLEE nHandle, 250, aPestana;
     |XLEE nHandle, 250, aClaveAlb;
     |XLEE nHandle, 250, aClaveFac;
     |XLEE nHandle, 250, aClaveCon;
     |XCIERRA nHandle;
|FPRC;

|PROCESO GrabaTxt;
     |DBASE aFich;
     aFich = aFich + "fich/";
     aFichero = aFich + "C" + (Usuario % 810);
     |XABRE "W", aFichero, nHandle;

     |XGRABA nHandle, aEmp;
     |XGRABA nHandle, aAuto;
     |XGRABA nHandle, aProg;
     aAlfa = #0#0;
     |XGRABA nHandle, aAlfa;       || fecha
     |XGRABA nHandle, aPestana;
     aAlfa = #3#52 + (("000000" + #3#0) % -106);
     |XGRABA nHandle, aAlfa;
     aAlfa = #4#49 + (("000000" + #4#0) % -106);
     |XGRABA nHandle, aAlfa;
     aAlfa = #15#52 + (("000000" + #15#0) % -106);
     |XGRABA nHandle, aAlfa;
     |XCIERRA nHandle;
|FPRC;

|PROCESO Confirma; |TIPO 12;
     |SI FSalida ! 7;
          |CONFI "0000N¿Desea continuar?";
          nTecla = FSalida;
     |SINO;
          nTecla = 1;
     |FINSI;
|FPRC;

|PROCESO Posiciona;
     #0#0 = aFecha; |PINTA #0#0;
     aGuardaPestana = aPestana;
     |HAZ BtnActualiza;
     |SI aGuardaPestana = "1"; |FOCOTECLADO nGridAlb; |FINSI;
     |SI aGuardaPestana = "2"; |FOCOTECLADO nGridFac; |FINSI;
     |SI aGuardaPestana = "3"; |FOCOTECLADO nGridCon; |FINSI;
     aAlfa = aClaveAlb % 105; #3#52 = aAlfa;
     aAlfa = aClaveAlb % 606; #3#0 = aAlfa;
     |LEE 000#3=;
     |ESTADO_CONTROL nBtnAlbConfi, "DISABLE";
     |ESTADO_CONTROL nBtnAlbCancel, "DISABLE";
     |REFRESCACONTROL nGridAlb;
     aAlfa = aClaveFac % 105; #4#49 = aAlfa;
     aAlfa = aClaveFac % 606; #4#0 = aAlfa;
     |LEE 000#4=;
     |ESTADO_CONTROL nBtnFacAnula, "DISABLE";
     |ESTADO_CONTROL nBtnFacAgencia, "DISABLE";
     |ESTADO_CONTROL nBtnFacEtiqueta, "DISABLE";
     |REFRESCACONTROL nGridFac;
     aAlfa = aClaveCon % 105; #15#52 = aAlfa;
     aAlfa = aClaveCon % 606; #15#0 = aAlfa;
     |LEE 000#15=;
     |ESTADO_CONTROL nBtnConAge, "DISABLE";
     |REFRESCACONTROL nGridCon;
|FPRC;

|PROCESO Tipo0; |TIPO 0;
|FPRC;

|PROCESO Tipo_12; |TIPO 12;
|FPRC;

|PROCESO Tipo80; |TIPO 80;
     FSalida = 3399;
|FPRC;

|PROGRAMA;
     |CLS;
     |PINPA #0#0;  nPanta0 = FSalida;
     |PINDA #0#0;

     |CONTROL_SIMPLE nPanta0, "BOTON,Actualizar", 0702, 0711, BtnActualiza;
     nBtnActualiza = FSalida;

     |HAZ LeeTxt;

     |HAZ DecimalesBase;
     |ABRE #20; |LEE 000#20p; |CIERRA #20;

     |HAZ CreaTempo; |NOME_DAT #3 Tempo; |DELINDEX #3; aTmp3 = Tempo;
     |HAZ CreaTempo; |NOME_DAT #4 Tempo; |DELINDEX #4; aTmp4 = Tempo;
     |HAZ CreaTempo; |NOME_DAT #15 Tempo; |DELINDEX #15; aTmp15 = Tempo;

     |ABRET #3;
     |ABRET #4;
     |ABRET #15;

     |SI aAuto = "1";
          |HAZ Posiciona;
     |SINO;
          aEstadoBtnIni = "DISABLE"; |HAZ EstadoBotonIni;
     |FINSI;

     aAuto = ""; || salida normal del programa

     |PINDA #0#0;
     |PARA; |SI; |HACIENDO;
          |ENDATOS #1#0;
          |SI FSalida ! 0; |SAL; |FINSI;
     |SIGUE;

     |HAZ GrabaTxt;

     |CIERRAT #3;
     |CIERRAT #4;
     Tempo = aTmp3; |HAZ BoraTempo; |DELINDEX #3;
     Tempo = aTmp4; |HAZ BoraTempo; |DELINDEX #4;
     Tempo = aTmp15; |HAZ BoraTempo; |DELINDEX #15;

     |DESTRUYECONTROL nGridFac;
     |DESTRUYECONTROL nGridAlb;
     |DESTRUYECONTROL nGridCon;
     |FIN_CONTROL_WINDOWS nBtnActualiza;
     |FIN_CONTROL_WINDOWS nBtnFacAnula;
     |FIN_CONTROL_WINDOWS nBtnFacAgencia;
     |FIN_CONTROL_WINDOWS nBtnFacEtiqueta;
     |FIN_CONTROL_WINDOWS nBtnFacSal;
     |FIN_CONTROL_WINDOWS nBtnAlbConfi;
     |FIN_CONTROL_WINDOWS nBtnAlbCancel;
     |FIN_CONTROL_WINDOWS nBtnAlbSal;
     |FIN_CONTROL_WINDOWS nBtnConAge;
     |FIN_CONTROL_WINDOWS nBtnConSal;

     |FIN_CONTROL_WINDOWS nFocoFac;
     |FIN_CONTROL_WINDOWS nFocoAlb;
     |FIN_CONTROL_WINDOWS nFocoCon;

     |FIN_CONTROL_WINDOWS nLabelFac;
     |FIN_CONTROL_WINDOWS nLabelAlb;
     |FIN_CONTROL_WINDOWS nLabelCon;

     |HAZ FinVentanaEspera;

     |PULSATECLA;
|FPRO;
