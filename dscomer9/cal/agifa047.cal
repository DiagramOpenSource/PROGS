|FICHEROS;
     agifa048#0;
     agifa049#1;
     agifa047#2;
     agifa127#3;
|FIN;

|VARIABLES;
     &Tempo = "";
     contador = 0;
     nivel    = 0;
     maxnivel = 0;
     espacios = "               " ;
     escandall= " ";
|FIN;

|CAMPOS;
     #0#0 escodigo ;
     #1#0 linesca  ;
     #1#1 linlinea ;
     #1#2 linartic ;
     #1#8 linivel  ;
     #3#0 tmpescal ;
     #3#1 tmp1busc ;
     #3#2 tmp2busc ;
|FIN;

|CALCULO ponivel;|TIPO 0;
      linivel = maxnivel;
      |GRABA 121#1a;
      |LIBERA #1;
|FCAL;


|CALCULO control;|TIPO 0;
         |ERROR;
|FCAL;


|CALCULO buscaniv;|TIPO 0;
     |HAZ CreaTempo;
     |NOME_DAT #3 Tempo; |DELINDEX #3;

         |ABRE #3;
         |ABRE #1;
         |SELECT #2#1;
         contador = contador + 1;
         linesca  = espacios;
         linartic = escodigo;
         escandall= escodigo;
         maxnivel = 0 ;
         |||PINTA 1457,escodigo;
         |||PINTA 1157,contador;
         |LEE 001#1>;
         |SI linartic = escandall;
         |PARA nivel = 1;|SI nivel > 0;|HACIENDO nivel = nivel + 1;
              |SI 0 = FSalida;|Y linartic = escandall;
                           tmpescal = nivel    ;
                                    |SI  maxnivel < nivel;
                                         maxnivel = nivel;
                                    |FINSI;
                           tmp1busc = linesca  ;
                           tmp2busc = linartic ;
                           |GRABA 101#3c;
                           |SI 0 ! FSalida;|GRABA 101#3a;|FINSI;
                                linartic  = linesca ;
                                escandall = linesca ;
                                linesca   = espacios;
                           |SINO ;
                           |SI nivel > 1;
                                tmpescal = nivel - 1 ;
                                |LEE 121#3=;
                                linesca   = tmp1busc;
                                linartic  = tmp2busc;
                                escandall = tmp2busc;
                           |FINSI;
                                 nivel = nivel - 2 ;
                       |FINSI;
                       |LEE 001#1>;
         |SIGUE;
         |FINSI;

         |CIERRA  #3;

         |HAZ BoraTempo; |DELINDEX #3;

         |SELECT #1#1;
         |BUCLELIN 0ponivel#0;
|FCAL;



|DEFBUCLE agifa4620;
#0#1;
;
#2#0;
#2#1;
e;
control,buscaniv,NULL,NULL;
|FIN;

|CALCULO actescan;|TIPO 3;
         |BUCLE agifa4620;
|FCAL;
