          Modificacion totales factura

|FICHEROS;
     agifa079 #0;
     godiacaj #1;
     agifa077 #77;
     tmp00078 #79,MANTE;
|FIN;

|VARIABLES;
     &nDeci_TotVisF = 0;
     serie     = "";
     numero    = 0;
     i         = 0;
     nModo     = 0;
     &enSwModi = 0;
     nSwCompru = 0;
     nBases    = 0;
     nCuota    = 0;
     nReca     = 0;
     nNume     = 0;
|FIN;

|PROCESO CompruImporte;
     nBases = (#79#47 + #79#108 + #79#111 + #79#114 + #79#119 + #79#122) ! nDeci_TotVisF;
     nCuota = (#79#109 + #79#112 + #79#115 + #79#120 + #79#123) ! nDeci_TotVisF;
     nReca =  (#79#110 + #79#113 + #79#125 + #79#121 + #79#124) ! nDeci_TotVisF;

     nNume = (#79#105 + #79#106 + #79#107 - #79#104) ! nDeci_TotVisF;
     |SI nNume ! nBases;
          nSwCompru = 1;
          |MENAV "0000 Total bases incorrecto";
     |FINSI;
     |SI nCuota ! #79#116;
          nSwCompru = 1;
          |MENAV "0000 Total Cuota Iva incorrecto";
     |FINSI;
     |SI nReca ! #79#117;
          nSwCompru = 1;
          |MENAV "0000 Total Recargo incorrecto";
     |FINSI;

     nNume = (#79#105 + #79#106 + #79#107 - #79#104 + nCuota + nReca - #79#126) ! nDeci_TotVisF;
     |SI nNume ! #79#118;
          nSwCompru = 1;
          |MENAV "0000 Total Factura incorrecto";
     |FINSI;

     |SI nSwCompru ! 0;
          |CONFI "0000NEs correcto";
          nSwCompru = FSalida;
     |FINSI;
|FPRC;

|PROCESO CambioImportes0;
     |SI #0#77 = "B"; || Si la moneda de trabajo es la moneda base ...
          #0#17 = #0#104;
          #0#18 = #0#105;
          #0#19 = #0#106;
          #0#20 = #0#107;
          #0#21 = #0#108;
          #0#22 = #0#109;
          #0#23 = #0#100;
          #0#24 = #0#111;
          #0#25 = #0#112;
          #0#26 = #0#113;
          #0#27 = #0#114;
          #0#28 = #0#115;
          #0#29 = #0#116;
          #0#30 = #0#117;
          #0#31 = #0#118;
          #0#49 = #0#119;
          #0#50 = #0#120;
          #0#51 = #0#121;
          #0#52 = #0#122;
          #0#53 = #0#123;
          #0#54 = #0#124;
          #0#55 = #0#125;
          #0#67 = #0#126;

          #0#81 = #0#104 * #0#76 / #0#79;
          #0#82 = #0#105 * #0#76 / #0#79;
          #0#83 = #0#106 * #0#76 / #0#79;
          #0#84 = #0#107 * #0#76 / #0#79;
          #0#85 = #0#108 * #0#76 / #0#79;
          #0#86 = #0##109 * #0#76 / #0#79;
          #0#87 = #0#110 * #0#76 / #0#79;
          #0#88 = #0#111 * #0#76 / #0#79;
          #0#89 = #0#112 * #0#76 / #0#79;
          #0#90 = #0#113 * #0#76 / #0#79;
          #0#91 = #0#114 * #0#76 / #0#79;
          #0#92 = #0#115 * #0#76 / #0#79;
          #0#93 = #0#116 * #0#76 / #0#79;
          #0#94 = #0#117 * #0#76 / #0#79;
          #0#95 = #0#118 * #0#76 / #0#79;
          #0#96 = #0#119 * #0#76 / #0#79;
          #0#97 = #0#120 * #0#76 / #0#79;
          #0#98 = #0#121 * #0#76 / #0#79;
          #0#99 = #0#122 * #0#76 / #0#79;
          #0#100 = #0#123 * #0#76 / #0#79;
          #0#101 = #0#124 * #0#76 / #0#79;
          #0#102 = #0#125 * #0#76 / #0#79;
          #0#103 = #0#126 * #0#76 / #0#79;
     |SINO;
          #0#81 = #0#104;
          #0#82 = #0#105;
          #0#83 = #0#106;
          #0#84 = #0#107;
          #0#85 = #0#108;
          #0#86 = #0##109;
          #0#87 = #0#110;
          #0#88 = #0#111;
          #0#89 = #0#112;
          #0#90 = #0#113;
          #0#91 = #0#114;
          #0#92 = #0#115;
          #0#93 = #0#116;
          #0#94 = #0#117;
          #0#95 = #0#118;
          #0#96 = #0#119;
          #0#97 = #0#120;
          #0#98 = #0#121;
          #0#99 = #0#122;
          #0#100 = #0#123;
          #0#101 = #0#124;
          #0#102 = #0#125;
          #0#103 = #0#126;

          #0#17 = #0#104 / #0#76 * #0#79;
          #0#18 = #0#105 / #0#76 * #0#79;
          #0#19 = #0#106 / #0#76 * #0#79;
          #0#20 = #0#107 / #0#76 * #0#79;
          #0#21 = #0#108 / #0#76 * #0#79;
          #0#22 = #0#109 / #0#76 * #0#79;
          #0#23 = #0#100 / #0#76 * #0#79;
          #0#24 = #0#111 / #0#76 * #0#79;
          #0#25 = #0#112 / #0#76 * #0#79;
          #0#26 = #0#113 / #0#76 * #0#79;
          #0#27 = #0#114 / #0#76 * #0#79;
          #0#28 = #0#115 / #0#76 * #0#79;
          #0#29 = #0#116 / #0#76 * #0#79;
          #0#30 = #0#117 / #0#76 * #0#79;
          #0#31 = #0#118 / #0#76 * #0#79;
          #0#49 = #0#119 / #0#76 * #0#79;
          #0#50 = #0#120 / #0#76 * #0#79;
          #0#51 = #0#121 / #0#76 * #0#79;
          #0#52 = #0#122 / #0#76 * #0#79;
          #0#53 = #0#123 / #0#76 * #0#79;
          #0#54 = #0#124 / #0#76 * #0#79;
          #0#55 = #0#125 / #0#76 * #0#79;
          #0#67 = #0#126 / #0#76 * #0#79;
     |FINSI;
|FPRC;

|PROCESO CambioImportes;
     enSwModi = 0;
     |PARA i = 104; |SI i [ 126; |HACIENDO i = i + 1;
          |SI #0i ! #79i;
               enSwModi = 1;
          |FINSI;
     |SIGUE;
     |SI enSwModi = 1;             ||Solo si modifica
         |HAZ CambioImportes0;
     |FINSI;
|FPRC;

|PROCESO FinModi; |TIPO 12;
     |HAZ CompruImporte;
     |SI nSwCompru = 0;
          enSwModi = 0;
          |PARA i = 104; |SI i [ 126; |HACIENDO i = i + 1;
               |SI #0i ! #79i;
                    enSwModi = 1;
               |FINSI;
               #0i = #79i;
          |SIGUE;
          |SI enSwModi = 1;             ||Solo si modifica
               |HAZ CambioImportes0;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO ModiImportes;
     |ABRE #0;
     #0#66 = #77#51;
     #0#0 = #77#39;
     |LEE 121#0=;
     |SI FSalida = 0;
          |PARA i = 0; |SI i [ 128; |HACIENDO i = i + 1;
               #79i = #0i;
          |SIGUE;
          |PUSHV 0101 2380;
          |CLS;
          |PINPA #0#79;
          |PINDA #0#79;
          |PARA nSwCompru = 1; |SI nSwCompru ! 0; |HACIENDO;
               nSwCompru = 0;
               |ENDATOS #1#79;
          |SIGUE;
          |GRABA 020#0a;
          |POPV;

          #1#9 = #0#21 + #0#24 + #0#27 + #0#49 + #0#52; ||Bases Iva
          #1#10 = #0#22 + #0#25 + #0#28 + #0#50 + #0#53; ||Cuotas IVa
          #1#11 =  #0#67;                            || Retencion
          #1#12 = #0#23 + #0#26 + #0#55 + #0#51 + #0#54; ||Cuotas Ret
          #1#13 = #0#47; ||Exenta
          #1#14 = #0#21; ||Bases impo
          #1#15 = #0#24;
          #1#16 = #0#27;
          #1#17 = #0#49;
          #1#18 = #0#52;
          #1#24 = #0#22; ||Cuotas iva
          #1#25 = #0#22;
          #1#26 = #0#28;
          #1#27 = #0#50;
          #1#28 = #0#53;
          ||#1#29 =      ||Base Rete
     |FINSI;
     |CIERRA #0;
|FPRC;
