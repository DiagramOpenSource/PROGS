|FICHEROS;

     agifa655 #0; || Este def

     agifa104 #1; || Pedido Venta (C)
     agifa073 #2; || Pedido Venta (L)
     agifa010 #3; || Albaran Venta (C)
     agifa071 #4; || Albaran Venta (L)
     agifa134 #5; || Factura Venta (C)
     agifa059 #6; || Factura Venta (L)
     agifa065 #9; || Historico Movimientos
     agifa036 #10;|| Depositos (C)
     agifa070 #11;|| Depositos (L)
     agifa084 #12;|| Facturas Directas (C)
     agifa069 #13;|| Facturas Directas (L)
     agifa146 #14;|| Proforma (C)
     agifa147 #15;|| Proforma (L)
     agifa081 #16;|| Pedidos Compras (C)
     agifa067 #17;|| Pedidos Compras (L)
     agifa077 #18;|| Albaran Compras (C)
     agifa080 #19;|| Albaran Compras (L)
     agifa079 #20;|| Facturas Compras (C)
     agifa072 #21;|| Facturas Compras (L)
     agifa501 #24;|| Tickets (C)
     agifa502 #25;|| Tickets (L)
     agifa007 #26;|| Series.
     agifa722 #722;
|FIN;

|VARIABLES;
     swSi      = 0;
     aParam    = "";

     aNume1 = "";
     aNume2 = "";
     aTipo = "";
     aD = "          ";
     aH = "zzzzzzzzzz";

     nCampo    = 0;
     aLon      = "";
     i         = 0;
     nPos      = 0;
     aLetra    = "";
     aReg      = "";
     aTab      = "";
     aDato     = "";
 {99}Valor     = "";
|FIN;


|| Borra todos los documentos: Pedidos, Albaran, factura, recibos, cobros,
|| Historico movimientos etc... de las serie introducidas

|PROCESO BorraHistoGes;
     |BORRA 020#722a;
|FPRC;

|DEFBUCLE BorraHistoGes;
     #722#1;
     ;
     aTipo, aNume1, aNume2, aD, 000000, 00000, 0;
     aTipo, aNume1, aNume2, aH, 999999, 99999, 9;
     ;
     NULL, BorraHistoGes;
|FIN;

|PROCESO BorraLineaPed;
  |BORRA 020#2a;
|FPRC;

|PROCESO BorraCabPed;
  |BORRA 020#1a;
|FPRC;

|PROCESO BorraPedido;

     |SI #1#25 ! #0#0; |Y #1#25 ! #0#1; |Y #1#25 ! #0#2; |Y #1#25 ! #0#3;
      |Y #1#25 ! #0#4; |Y #1#25 ! #0#5; |Y #1#25 ! #0#6; |Y #1#25 ! #0#7;
      |Y #1#25 ! #0#11; |Y #1#25 ! #0#12; |Y #1#25 ! #0#13; |Y #1#25 ! #0#14;
      |Y #1#25 ! #0#15; |Y #1#25 ! #0#16; |Y #1#25 ! #0#17; |Y #1#25 ! #0#18;
      |Y #1#25 ! #0#19; |Y #1#25 ! #0#20; |Y #1#25 ! #0#21; |Y #1#25 ! #0#22;

          |ERROR;

     |FINSI;

|FPRC;

|DEFBUCLE BorraPedido;
#1#1;
;
INICIO;
FINAL;
be;
NULL, BorraPedido, BorraLineaPed, BorraCabPed;
|FIN;

|PROCESO BorraLineaAlb;
  |BORRA 020#4a;
|FPRC;

|PROCESO BorraCabAlb;
  |BORRA 020#3a;
|FPRC;

|PROCESO BorraAlbaran;

     |SI #3#52 ! #0#0; |Y #3#52 ! #0#1; |Y #3#52 ! #0#2; |Y #3#52 ! #0#3;
      |Y #3#52 ! #0#4; |Y #3#52 ! #0#5; |Y #3#52 ! #0#6; |Y #3#52 ! #0#7;
      |Y #3#52 ! #0#11; |Y #3#52 ! #0#12; |Y #3#52 ! #0#13; |Y #3#52 ! #0#14;
      |Y #3#52 ! #0#15; |Y #3#52 ! #0#16; |Y #3#52 ! #0#17; |Y #3#52 ! #0#18;
      |Y #3#52 ! #0#19; |Y #3#52 ! #0#20; |Y #3#52 ! #0#21; |Y #3#52 ! #0#22;

          |ERROR;

     |FINSI;

|FPRC;

|DEFBUCLE BorraAlbaran;
#3#1;
;
INICIO;
FINAL;
be;
NULL, BorraAlbaran, BorraLineaAlb, BorraCabAlb;
|FIN;

|PROCESO BorraLineaFac;
  |BORRA 020#6a;
|FPRC;

|PROCESO BorraCabFac;
  aTipo = "FV";
  aNume1 = #5#49;
  aNume2 = #5#0;
  |BUCLE BorraHistoGes;
  |BORRA 020#5a;
|FPRC;

|PROCESO BorraFactura;

     |SI #5#49 ! #0#0; |Y #5#49 ! #0#1; |Y #5#49 ! #0#2; |Y #5#49 ! #0#3;
      |Y #5#49 ! #0#4; |Y #5#49 ! #0#5; |Y #5#49 ! #0#6; |Y #5#49 ! #0#7;
      |Y #5#49 ! #0#11; |Y #5#49 ! #0#12; |Y #5#49 ! #0#13; |Y #5#49 ! #0#14;
      |Y #5#49 ! #0#15; |Y #5#49 ! #0#16; |Y #5#49 ! #0#17; |Y #5#49 ! #0#18;
      |Y #5#49 ! #0#19; |Y #5#49 ! #0#20; |Y #5#49 ! #0#21; |Y #5#49 ! #0#22;

          |ERROR;

     |FINSI;

|FPRC;

|DEFBUCLE BorraFactura;
#5#1;
;
INICIO;
FINAL;
be;
NULL, BorraFactura, BorraLineaFac, BorraCabFac;
|FIN;


|PROCESO BorraHisto;

     |SI #9#11 = #0#0; |O #9#11 = #0#1; |O #9#11 = #0#2; |O #9#11 = #0#3;
      |O #9#11 = #0#4; |O #9#11 = #0#5; |O #9#11 = #0#6; |O #9#11 = #0#7;
      |O #9#11 = #0#11; |O #9#11 = #0#12; |O #9#11 = #0#13; |O #9#11 = #0#14;
      |O #9#11 = #0#15; |O #9#11 = #0#16; |O #9#11 = #0#17; |O #9#11 = #0#18;
      |O #9#11 = #0#19; |O #9#11 = #0#20; |O #9#11 = #0#21; |O #9#11 = #0#22;

          |BORRA 020#9a;

     |FINSI;

|FPRC;

|DEFBUCLE BorraHisto;
#9#1;
;
INICIO;
FINAL;
be;
NULL, BorraHisto;
|FIN;

|PROCESO BorraLineaDep;
  |BORRA 020#11a;
|FPRC;

|PROCESO BorraCabDep;
  |BORRA 020#10a;
|FPRC;

|PROCESO BorraDeposito;

     |SI #10#46 ! #0#0; |Y #10#46 ! #0#1; |Y #10#46 ! #0#2; |Y #10#46 ! #0#3;
      |Y #10#46 ! #0#4; |Y #10#46 ! #0#5; |Y #10#46 ! #0#6; |Y #10#46 ! #0#7;
      |Y #10#46 ! #0#11; |Y #10#46 ! #0#12; |Y #10#46 ! #0#13; |Y #10#46 ! #0#14;
      |Y #10#46 ! #0#15; |Y #10#46 ! #0#16; |Y #10#46 ! #0#17; |Y #10#46 ! #0#18;
      |Y #10#46 ! #0#19; |Y #10#46 ! #0#20; |Y #10#46 ! #0#21; |Y #10#46 ! #0#22;

          |ERROR;

     |FINSI;

|FPRC;

|DEFBUCLE BorraDeposito;
#10#1;
;
INICIO;
FINAL;
be;
NULL, BorraDeposito, BorraLineaDep, BorraCabDep;
|FIN;

|PROCESO BorraLineaFad;
  |BORRA 020#13a;
|FPRC;

|PROCESO BorraCabFad;
  aTipo = "FD";
  aNume1 = #12#48;
  aNume2 = #12#0;
  |BUCLE BorraHistoGes;
  |BORRA 020#12a;
|FPRC;

|PROCESO BorraFacdir;

     |SI #12#48 ! #0#0; |Y #12#48 ! #0#1; |Y #12#48 ! #0#2; |Y #12#48 ! #0#3;
      |Y #12#48 ! #0#4; |Y #12#48 ! #0#5; |Y #12#48 ! #0#6; |Y #12#48 ! #0#7;
      |Y #12#48 ! #0#11; |Y #12#48 ! #0#12; |Y #12#48 ! #0#13; |Y #12#48 ! #0#14;
      |Y #12#48 ! #0#15; |Y #12#48 ! #0#16; |Y #12#48 ! #0#17; |Y #12#48 ! #0#18;
      |Y #12#48 ! #0#19; |Y #12#48 ! #0#20; |Y #12#48 ! #0#21; |Y #12#48 ! #0#22;

          |ERROR;

     |FINSI;

|FPRC;

|DEFBUCLE BorraFacdir;
#12#1;
;
INICIO;
FINAL;
be;
NULL, BorraFacdir, BorraLineaFad, BorraCabFad;
|FIN;

|PROCESO BorraLineaPro;
  |BORRA 020#15a;
|FPRC;

|PROCESO BorraCabPro;
  |BORRA 020#14a;
|FPRC;

|PROCESO BorraProfor;

     |SI #14#48 ! #0#0; |Y #14#48 ! #0#1; |Y #14#48 ! #0#2; |Y #14#48 ! #0#3;
      |Y #14#48 ! #0#4; |Y #14#48 ! #0#5; |Y #14#48 ! #0#6; |Y #14#48 ! #0#7;
      |Y #14#48 ! #0#11; |Y #14#48 ! #0#12; |Y #14#48 ! #0#13; |Y #14#48 ! #0#14;
      |Y #14#48 ! #0#15; |Y #14#48 ! #0#16; |Y #14#48 ! #0#17; |Y #14#48 ! #0#18;
      |Y #14#48 ! #0#19; |Y #14#48 ! #0#20; |Y #14#48 ! #0#21; |Y #14#48 ! #0#22;

          |ERROR;

     |FINSI;

|FPRC;

|DEFBUCLE BorraProfor;
#14#1;
;
INICIO;
FINAL;
be;
NULL, BorraProfor, BorraLineaPro, BorraCabPro;
|FIN;

|PROCESO BorraLineaPec;
  |BORRA 020#17a;
|FPRC;

|PROCESO BorraCabPec;
  |BORRA 020#16a;
|FPRC;

|PROCESO BorraPedcom;

     |SI #16#25 ! #0#0; |Y #16#25 ! #0#1; |Y #16#25 ! #0#2; |Y #16#25 ! #0#3;
      |Y #16#25 ! #0#4; |Y #16#25 ! #0#5; |Y #16#25 ! #0#6; |Y #16#25 ! #0#7;
      |Y #16#25 ! #0#11; |Y #16#25 ! #0#12; |Y #16#25 ! #0#13; |Y #16#25 ! #0#14;
      |Y #16#25 ! #0#15; |Y #16#25 ! #0#16; |Y #16#25 ! #0#17; |Y #16#25 ! #0#18;
      |Y #16#25 ! #0#19; |Y #16#25 ! #0#20; |Y #16#25 ! #0#21; |Y #16#25 ! #0#22;

          |ERROR;

     |FINSI;

|FPRC;

|DEFBUCLE BorraPedcom;
#16#1;
;
INICIO;
FINAL;
be;
NULL, BorraPedcom, BorraLineaPec, BorraCabPec;
|FIN;

|PROCESO BorraLineaAlc;
  |BORRA 020#19a;
|FPRC;

|PROCESO BorraCabAlc;
  |BORRA 020#18a;
|FPRC;

|PROCESO BorraAlbacom;

     |SI #18#50 ! #0#0; |Y #18#50 ! #0#1; |Y #18#50 ! #0#2; |Y #18#50 ! #0#3;
      |Y #18#50 ! #0#4; |Y #18#50 ! #0#5; |Y #18#50 ! #0#6; |Y #18#50 ! #0#7;
      |Y #18#50 ! #0#11; |Y #18#50 ! #0#12; |Y #18#50 ! #0#13; |Y #18#50 ! #0#14;
      |Y #18#50 ! #0#15; |Y #18#50 ! #0#16; |Y #18#50 ! #0#17; |Y #18#50 ! #0#18;
      |Y #18#50 ! #0#19; |Y #18#50 ! #0#20; |Y #18#50 ! #0#21; |Y #18#50 ! #0#22;

          |ERROR;

     |FINSI;

|FPRC;

|DEFBUCLE BorraAlbacom;
#18#1;
;
INICIO;
FINAL;
be;
NULL, BorraAlbacom, BorraLineaAlc, BorraCabAlc;
|FIN;

|PROCESO BorraLineaFam;
  |BORRA 020#21a;
|FPRC;

|PROCESO BorraCabFam;
  aTipo = "FC";
  aNume1 = #20#66;
  aNume2 = #20#0;
  |BUCLE BorraHistoGes;
  |BORRA 020#20a;
|FPRC;

|PROCESO BorraFactucom;

     |SI #20#66 ! #0#0; |Y #20#66 ! #0#1; |Y #20#66 ! #0#2; |Y #20#66 ! #0#3;
      |Y #20#66 ! #0#4; |Y #20#66 ! #0#5; |Y #20#66 ! #0#6; |Y #20#66 ! #0#7;
      |Y #20#66 ! #0#11; |Y #20#66 ! #0#12; |Y #20#66 ! #0#13; |Y #20#66 ! #0#14;
      |Y #20#66 ! #0#15; |Y #20#66 ! #0#16; |Y #20#66 ! #0#17; |Y #20#66 ! #0#18;
      |Y #20#66 ! #0#19; |Y #20#66 ! #0#20; |Y #20#66 ! #0#21; |Y #20#66 ! #0#22;

          |ERROR;

     |FINSI;

|FPRC;

|DEFBUCLE BorraFactucom;
#20#1;
;
INICIO;
FINAL;
be;
NULL, BorraFactucom, BorraLineaFam, BorraCabFam;
|FIN;

|PROCESO BorraLineaTik;
  |BORRA 020#25a;
|FPRC;

|PROCESO BorraCabTik;
  aTipo = "TI";
  aNume1 = #24#36;
  aNume2 = #24#0;
  |BUCLE BorraHistoGes;
  |BORRA 020#24a;
|FPRC;

|DEFBUCLE BorraLineaTik;
     #agifa502#1;
     ;
     #agifa501#36, #agifa501#0, 001;
     #agifa501#36, #agifa501#0, 999;
     ;
     NULL, BorraLineaTik;
|FIN;

|PROCESO BorraTick;

     |SI #24#36 ! #0#0; |Y #24#36 ! #0#1; |Y #24#36 ! #0#2; |Y #24#36 ! #0#3;
      |Y #24#36 ! #0#4; |Y #24#36 ! #0#5; |Y #24#36 ! #0#6; |Y #24#36 ! #0#7;
      |Y #24#36 ! #0#11; |Y #24#36 ! #0#12; |Y #24#36 ! #0#13; |Y #24#36 ! #0#14;
      |Y #24#36 ! #0#15; |Y #24#36 ! #0#16; |Y #24#36 ! #0#17; |Y #24#36 ! #0#18;
      |Y #24#36 ! #0#19; |Y #24#36 ! #0#20; |Y #24#36 ! #0#21; |Y #24#36 ! #0#22;

          |ERROR;
     |SINO;
          |BUCLE BorraLineaTik;
          |HAZ BorraCabTik;
     |FINSI;

|FPRC;

|DEFBUCLE BorraTick;
#24#1;
;
INICIO;
FINAL;
be;
NULL, BorraTick;
|FIN;

|PROCESO BorraSerie;

     |SI #26#26 = #0#0; |O #26#26 = #0#1; |O #26#26 = #0#2; |O #26#26 = #0#3;
      |Y #26#26 = #0#4; |O #26#26 = #0#5; |O #26#26 = #0#6; |O #26#26 = #0#7;
      |Y #26#26 ! #0#11; |Y #26#26 ! #0#12; |Y #26#26 ! #0#13; |Y #26#26 ! #0#14;
      |Y #26#26 ! #0#15; |Y #26#26 ! #0#16; |Y #26#26 ! #0#17; |Y #26#26 ! #0#18;
      |Y #26#26 ! #0#19; |Y #26#26 ! #0#20; |Y #26#26 ! #0#21; |Y #26#26 ! #0#22;

          |BORRA 020#26a;

     |FINSI;

|FPRC;

|DEFBUCLE BorraSerie;
#26#1;
;
INICIO;
FINAL;
be;
NULL, BorraSerie;
|FIN;

|PROCESO Dato;
     aTab = ";"
     nCampo = 1;
     IValor = Valor1<-;
     aLon = aDato % A0;
     aReg = "";
     |PARA i = 1; |SI i [ aLon; |HACIENDO i = i + 1;
          nPos = i * 100 + 1;
          aLetra = aDato % nPos;
          |SI aLetra = aTab;
               Valor = aReg;
               aReg = "";
               nCampo = nCampo + 1;
               IValor = IValor + 1;
          |SINO;
               aReg = aReg + aLetra;
          |FINSI;
          |SI nCampo > 90; |SAL; |FINSI;     || Por si.... :)
     |SIGUE;
     Valor = aReg;
|FPRC;

|PROGRAMA;
     aParam = PARAMETRO; |QBF aParam;
     |ABRE #0;
     |LEE 101#0p;
     |SI FSalida ! 0; |GRABA 020#0b; |FINSI;

     |SI aParam = "";              || desde un programa externo
          #0#8 = "S";
          FSalida = 0;
     |SINO;
          |SI aParam ! "MENU";     || series separadas por ";"
               aDato = aParam;
               |HAZ Dato;
               #0#0 = Valor1;
               #0#1 = Valor2;
               #0#2 = Valor3;
               #0#3 = Valor4;
               #0#4 = Valor5;
               #0#5 = Valor6;
               #0#6 = Valor7;
               #0#7 = Valor8;
               #0#11 = Valor9;
               #0#12 = Valor10;
               #0#13 = Valor11;
               #0#14 = Valor12;
               #0#15 = Valor13;
               #0#16 = Valor14;
               #0#17 = Valor15;
               #0#18 = Valor16;
               #0#19 = Valor17;
               #0#20 = Valor18;
               #0#21 = Valor19;
               #0#22 = Valor20;
               #0#8 = "S";
               FSalida = 0;
          |SINO;              || desde el menu (SE LLAMA CON MENU)
               |CLS;
               |CABEZA "Recalculo Historico";
               #0#9 = "";
               |ENCAMPO #9#0;
               |SI #0#9 ! "BORRATODO"; |ACABA; |FINSI; ||LA CLAVE

               |C_V #0#9, 1, "N";
               #0#8 = "N";
               |PINTA #0#8;
               |PINPA #0#0;
               |PINDA #0#0;
               |ENDATOS #1#0;
               |SI FSalida = 0;
                    |GRABA 020#0a;
               |FINSI;
          |FINSI;
     |FINSI;

     |SI #0#8 = "S"; |Y FSalida = 0;
          |BUCLE BorraPedido;
          |BUCLE BorraAlbaran;
          |BUCLE BorraFactura;
          |BUCLE BorraHisto;
          |BUCLE BorraDeposito;
          |BUCLE BorraFacdir;
          |BUCLE BorraProfor;
          |BUCLE BorraPedcom;
          |BUCLE BorraAlbacom;
          |BUCLE BorraFactucom;
          |BUCLE BorraTick;
          |BUCLE BorraSerie;

          ||HAZ BorraCartera;
          || ABDON Tiquet 001911/00168 (04/02/2008)
          || Se deshabilita porque se ha hecho el borrado de cartera aparte,
          ||    directamente en cartera (dscaz146)

          |SUB_EJECUTA "agifa026.tab;agifa655"; || Ejecutar Recalculo acumulados maestros
          |SUB_EJECUTA "agifa068.tab;agifa655"; || Ejecutar Recalculo stocks
     |FINSI;

     |LIBERA #0;
     |CIERRA #0;
|FPRO;
