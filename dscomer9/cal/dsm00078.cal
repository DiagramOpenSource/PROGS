|FICHEROS;
     dsm00078 #0;
     agifa010 #10;
     dsm00047 #47;
     agifa071 #71;
     agifa069 #69;
     dsm00048 #480;
     dsm00051 #51;
     agifa084 #84;
     agifa509 #509;
     agifa512 #512;
     agifa513 #513;
     agifa501 #501;
     agifa502 #502;
     agifa019 #19;
     agifa024 #24;
     agifa025 #25;
     agifa142 #142;
     agifa065 #65;
|FIN;

|INCLUYE i_varart;

|VARIABLES;
     &eaImporIber = "";
     &eaTag    = "";
     fmes      = "";
     nImpo     = 0;
     mes       = 0;
     nMargen   = 0;
     nForma    = 0;
     nNume     = 0;
     imneto    = 0;
     nDto      = 0;
     retencion = 0;
|FIN;

|PROCESO Acu_agifa501;
     |ABRE #24;
     |DDEFECTO #24;
     #24#0 = #501#1;
     |LEE 101#24=;
     |SI FSalida ! 0; |GRABA 020#24b; |FINSI;
     fmes = #501#14 % A402;
     mes = ((fmes - 1) * 4) + 54;
     imneto = #501#3 - nDto;
     |SI #501#35 = "A";
          #24#50 = #24#50 - imneto;
          enImpCliPen = imneto;
     |SINO;
          |SI #142#115 = "N";
               nImpo = (imneto * 100) / (100 - #501#18);
               nDto = nDto + (imneto - nImpo);
          |SINO;
               nImpo = imneto;
          |FINSI;
          #24mes = #24mes - nImpo;
          mes = mes + 1;
          #24mes = #24mes - nDto;
          mes = mes + 1;
          #24mes = #24mes - #501#8;
          #24#102 = #24#102 - nImpo;
          #24#103 = #24#103 - nDto;
          #24#104 = #24#104 - #501#8;
          #24#45 = #501#14;
          #24#46 = imneto;
          #24#110 = #24#110 - imneto;

          enImpCliCom = -nImpo
          enImpCliDto = -nDto;
          enImpCliFac = -imneto;
          enImpCliMar = -#501#8;
     |FINSI;
     eaCliente = #501#1;
     efFecha = #501#14;
     |HAZ AcumulaCli;

     |GRABA 020#24a;
     |CIERRA #24;
|FPRC;

|PROCESO Acu_agifa010;
     |SI #10#15 ] 0;
          nNume = 1;
     |SINO;
          nNume = -1;
          #10#15 = -#10#15;
     |FINSI;
     nImpo = ((#10#15 < #10#5) < #10#32) < #10#7;
     nImpo = nImpo * nNume;
     #10#15 = #10#15 * nNume;

     |ABRE #24;
     #24#0 = #10#3;
     |LEE 121#24=;
     |SI FSalida = 0;
          |SI #10#43 = AN;
               #24#50 = #24#50 - nImpo;    || es albaran
          |SINO;
               #24#50 = #24#50 + nImpo;    || es abono
          |FINSI;
          |GRABA 020#24a;
     |FINSI;
     |CIERRA #24;
     eaTag = "AV"; |HAZ Riesgos;

     |SI #10#43 = "N";
          enImpCliPen = -nImpo;
     |SINO;
          enImpCliPen = nImpo;
     |FINSI;
     eaCliente = #10#3;
     efFecha = #10#1;
     |HAZ AcumulaCli;
|FPRC;

|PROCESO ActArti;
     nForma = -1;
     fmes = #84#1 % A402;
     mes = fmes - 1;
     mes = mes * 5;
     mes = mes + 35;
     #19#0 = #69#2;
     |LEE 101#19=;
     |SI FSalida = 0;
          |SI #19#194 = 2;
               nImpo = ((((#69#30 * #69#6) < #69#8) < #69#21) < #84#5) < #84#32;
          |SINO;
               nImpo = ((((#69#5 * #69#6) < #69#8) < #69#21) < #84#5) < #84#32;
          |FINSI;
          |SI #142#115 = "S";
               nImpo = nImpo < #84#7;
          |FINSI;
          nMargen = nImpo - #69#14;
          #19mes = #19mes - (nImpo * nForma);
          #19#95 = #19#95 - (nImpo * nForma);
          mes = mes + 1;
          #19mes = #19mes - (nMargen * nForma);
          #19#96 = #19#96 - (nMargen * nForma);
          |GRABA 020#19a;

          efFecha = #84#1;
          eaArticulo = #69#2;
          enImpVta = -(nImpo * nForma);
          enImpMar = -(nMargen * nForma);
          |HAZ AcumulaArt;
     |FINSI;
     |LIBERA #19;
|FPRC;

|PROCESO Acu_agifa084;
     |ABRE #24;
     #24#0 = #84#3;
     |LEE 121#24=;
     |SI 0 = FSalida;
          fmes = #84#1 % A402;
          mes = fmes - 1;
          mes = mes * 4;
          mes = mes + 54;
          imneto = #84#15 - #84#25;
          |SI #142#115 = "N";
               nImpo = (imneto * 100) / (100 - #84#7);
               nDto = #84#25 + (imneto - nImpo);
          |SINO;
               nImpo = imneto;
               nDto = #84#25;
          |FINSI;
          #24mes = #24mes - nImpo;
          mes = mes + 1;
          #24mes = #24mes - nDto;
          mes = mes + 1;
          #24mes = #24mes - #84#37;
          #24#102 = #24#102 - nImpo; || imneto;
          #24#103 = #24#103 - nDto;
          #24#104 = #24#104 - #84#37;
          mes = FEntrada / 100;
          mes = mes ! 0;
          |SI 1 = mes;
               #24#45 = #84#1;
               #24#46 = imneto;
          |FINSI;
          #24#110 = #24#110 - imneto;
          imneto = imneto + #84#24;
          |GRABA 020#24a;
          |LIBERA #24;

          enImpCliCom = -nImpo
          enImpCliDto = -nDto;
          enImpCliFac = -imneto;
          enImpCliMar = -#501#8;
          eaCliente = #84#3;
          efFecha = #84#1;
          |HAZ AcumulaCli;
     |FINSI;
     |CIERRA #24;
     |ABRE #25;
     #25#0 = #84#6;
     |LEE 121#25=;
     |SI 0 = FSalida;
           imneto = #84#15 - #84#25;
           fmes = #84#1 % A402;
           mes = fmes - 1;
           mes = mes * 2;
           mes = mes + 11;
           #25mes = #25mes - #84#26;
           retencion = #25mes % #25#39;
           mes = mes + 1;
           #25mes = #25mes - imneto;
           #25#35 = #25#35 - #84#26;
           #25#36 = #25#36 - imneto;
           mes = fmes - 1;
           mes = mes + 40;
           #25mes = retencion;
           retencion = #25#35 % #25#39;
           #25#52 = retencion;
           |GRABA 020#25a;
           |LIBERA #25;


          enImpRepComi = -#84#26;
          enImpRepVta = -imneto;
          enImpRepRete = -retencion;
          eaRepre = #84#6;
          efFecha = #84#1;
          |HAZ AcumulaRep;
     |FINSI;
     |CIERRA #25;
     |ABRE #19;
     |BUCLELIN 2 ActArti #84;
     |CIERRA #19;
     |SI #142#47 = "S";  ||컴컴컴컴컴 Acumula en riesgos Si Crea Recibo
          eaTag = "FC";  |HAZ Riesgos;
     |FINSI;
|FPRC;

|PROCESO ActImpoArti;
     |ABRE #19;
     fmes = #501#14 % A402;
     mes = ((fmes - 1) * 5) + 35;
     #19#0 = #502#2;
     |LEE 101#19=;
     |SI FSalida = 0;
          |SI #19#194 = 2;
               nImpo = ((((#502#29 * #502#10) < #502#14) < #501#17) < #501#19);
          |SINO;
               nImpo = ((((#502#5 * #502#10) < #502#14) < #501#17) < #501#19);
          |FINSI;
          |SI #142#115 = "S";
               nImpo = nImpo < #501#18;
          |FINSI;
          nMargen = nImpo - #502#23;
          #19mes = #19mes - (nImpo * nForma);
          #19#95 = #19#95 - (nImpo * nForma);
          mes = mes + 1;
          #19mes = #19mes - (nMargen * nForma);
          #19#96 = #19#96 - (nMargen * nForma);
          |GRABA 020#19a;

          efFecha = #501#14;
          eaArticulo = #502#2;
          enImpVta = -(nImpo * nForma);
          enImpMar = -(nMargen * nForma);
          |HAZ AcumulaArt;
     |FINSI;
     |CIERRA #19;
|FPRC;

|PROCESO dsm00051;
     |BORRA 020#51a;
     #65#0 = #51#3;      ||Ar
     #65#1 = #501#14;    ||fe
     #65#2 = "TI";       ||
     #65#3 = #501#58;    ||Nu
     #65#4 = #502#1;     ||Lin
     #65#11= #501#57;    ||Se
     |LEE 101#65=;
     |SI FSalida = 0;
          |BORRA 020#65a;
     |FINSI;
|FPRC;

|DEFBUCLE dsm00051;
     #51#1;
     ;
     #502#20, #502#0, #502#1, 001;
     #502#20, #502#0, #502#1, 999;
     be;
     NULL, dsm00051;
|FIN;

|PROCESO dsm00047;
     |BORRA 020#47a;
|FPRC;

|DEFBUCLE dsm00047;
     #47#1;
     ;
     #71#29, #71#0, #71#1, 001;
     #71#29, #71#0, #71#1, 999;
     be;
     NULL, dsm00047;
|FIN;

|PROCESO dsm00048;
     |BORRA 020#480a;
|FPRC;

|DEFBUCLE dsm00048;
     #480#1;
     ;
     #69#20, #69#0, #69#1, 001;
     #69#20, #69#0, #69#1, 999;
     be;
     NULL, dsm00047;
|FIN;

|PROCESO Lin10;
     |BUCLE dsm00047;
     eaImporIber = "S";
     eaTipo550 = "AV";
     enForma = -1; |HAZ AcumulaAV;
|FPRC;

|PROCESO Lin84;
     |BUCLE dsm00048;
     enForma = -1; |HAZ AcumulaFC;
|FPRC;

|PROCESO agifa502;
     |BUCLE dsm00051;
     |SI #501#35 = "T";
          eaImporIber = "S";
          eaTipo550 = "TI";
          enForma = -1; |HAZ AcumulaTPVR;
          |HAZ ActImpoArti;
     |FINSI;
     |BORRA 020#502a;

     #65#0 = #502#2;     ||Ar
     #65#1 = #501#14;    ||fe
     #65#2 = "TI";       ||
     #65#3 = #501#58;    ||Nu
     #65#4 = #502#1;     ||Lin
     #65#11= #501#57;    ||Se
     |LEE 101#65=;
     |SI FSalida = 0;
          |BORRA 020#65a;
     |FINSI;
|FPRC;

|DEFBUCLE agifa502;
     #agifa502#1;
     ;
     #agifa501#36, #agifa501#0, 001;
     #agifa501#36, #agifa501#0, 999;
     ;
     NULL, agifa502;
|FIN;

|PROCESO agifa501;
     |SI #501#35 = "F";
          #84#48 = #501#57;
          #84#0 = #501#58;
          |LEE 101#84=;
          |SI FSalida = 0;
               |BUCLELIN 1 Lin84 #84;
               |HAZ Acu_agifa084;
               |BORRA 020#84a;
          |FINSI;
     |FINSI;
     |SI #501#35 = "A";
          #10#52 = #501#57;
          #10#0 = #501#58;
          |LEE 101#10=;
          |SI FSalida = 0;
               |BUCLELIN 1 Lin10 #10;
               |HAZ Acu_agifa010;
               |BORRA 020#10a;
          |FINSI;
     |FINSI;
     |HAZ Acu_agifa501;
     |BUCLE agifa502;
     |BORRA 020#501a;
|FPRC;

|PROCESO agifa509;
     |BORRA 020#509a;
|FPRC;

|PROCESO agifa512;
     |BORRA 020#512a;
|FPRC;

|PROCESO agifa513;
     |BORRA 020#513a;
|FPRC;

|DEFBUCLE agifa501;
     #501#3;
     ;
     #0#0, "      ", " ", #0#3, 000001;
     #0#1, "zzzzzz", "z", #0#4, 999999;
     be;
     NULL, agifa501;
|FIN;

|DEFBUCLE agifa509;
     #509#1;
     ;
     00001, 00001, #0#0;
     99999, 99999, #0#1;
     be;
     NULL, agifa509;
|FIN;

|DEFBUCLE agifa512;
     #512#3;
     ;
     "      ", #0#0, #0#3, 000001;
     "zzzzzz", #0#1, #0#4, 999999;
     be;
     NULL, agifa512;
|FIN;

|DEFBUCLE agifa513;
     #513#3;
     ;
     "      ", #0#0, #0#3, 000001;
     "zzzzzz", #0#1, #0#4, 999999;
     be;
     NULL, agifa513;
|FIN;

|PROCESO Tipo3; |TIPO 3;
     |SI #0#2 = "SI";
          |ABRE #142; |LEE 000#142p; |CIERRA #142;
          |ABRE #65;
          |BUCLE agifa501;
          |CIERRA #65;
          |BUCLE agifa509;
          |BUCLE agifa512;
          |BUCLE agifa513;
     |FINSI;
|FPRC;
