|FICHEROS;
     ialbz023 #0;
     dsm00003 #3;
     ialbm006 #6;
     agifa010 #10;
     agifa024 #24;
     ialbm025 #25;
     ialbm026 #26;
     ialbm029 #29;       ||Etiqueta Impresa
|FIN;

|VARIABLES;
     aCp1 = "";
     nAbre = 0;
     nPrime = 0;
     &ser_alb = "";
     &num_alb = 0;
     aFic = "";
     aAlfa = "";
     nHandle = 0;
     aNom = "";
     aDir = "";
     aPob = "";
     aCP = "";
     aTlf = "";
     aBul = "";
     nImp = 0;
     aImp = "";
     aNum = "";
     aObs = "";
     aFinReg = "";
     nOk = 0;
|FIN;

|CALCULO agifa010;
     |SI #10#2 ! 0;
          |DDEFECTO #29;
          #29#0 = #10#52;
          #29#1 = #10#0;
          |LEE 101#29=;
          |SI #0#8 = "T";
               nOk = 1;
          |SINO;
               nOk = 1;
               |SI #0#8 = "S";
                    |SI #29#2 = "N"; nOk = 0; |FINSI;
               |SINO;
                    |SI #29#2 = "S"; nOk = 0; |FINSI;
               |FINSI;
          |FINSI;
          |SI nOk = 1;
               |SI FSalida ! 0; |GRABA 020#29b; |FINSI;
               #29#2 = "S";
               |GRABA 020#29a;

               |DDEFECTO #25;
               #25#0 = #10#8;
               |LEE 000#25=;

               |DDEFECTO #3;
               #3#0 = #10#3;
               #3#1 = #10#84;
               |LEE 000#3=;

               |DDEFECTO #26;
               #26#0 = #10#52;
               #26#1 = #10#0;
               |LEE 000#26=;

               |DDEFECTO #24;
               #24#0 = #10#3;
               |LEE 000#24=;

               |SI num_alb = 0;
                    |SI nPrime = 0;
                         aFic = #6#21; |QBF aFic;
                         aFic = aFic + "generico.txt";
                         |SI #6#22 = "P";
                              |XABRE "CWB", aFic, nHandle;
                         |SINO;
                              |XABRE "WB", aFic, nHandle;
                         |FINSI;
                         nAbre = FSalida;
                         nPrime = 1;
                    |SINO;
                         FSalida = nAbre;
                    |FINSI;
               |SINO;
                    aAlfa = #10#52 + (("000000" + #10#0) % -106); |QBT aAlfa;
                    aFic = #6#21; |QBF aFic;
                    aFic = aFic + aAlfa + ".txt";
                    |SI #6#22 = "P";
                         |XABRE "CWB", aFic, nHandle;
                    |SINO;
                         |XABRE "WB", aFic, nHandle;
                    |FINSI;
               |FINSI;
               |SI FSalida ] 0;
                    aNom = #3#10 % 145;
                    aDir = #3#2 % 145;
                    aPob = #3#3 % 128;
                    aCP = #3#6;
                    aTlf = #24#17 % 110;
                    aBul = ("000" + #10#2) % -103;
                    |SI #25#1 = "S";
                         nImp = (#10#67 + #26#2) ! 2;
                    |SINO;
                         nImp = 0;
                    |FINSI;
                    nImp = nImp * 100;
                    aImp = ("0000000000" + nImp) % -110;
                    aImp = (aImp % 108) + "," + (aImp % -102);
                    aNum = ("000000" + #10#0) % -106;
                    aAlfa = " " * 60;
                    aObs = (#10#97 + aAlfa) % 160;

                    aCp1 = aCP % 102;
                    |SI aCp1 = "02";
                         aCp1 = "50555";
                    |SINO;
                         aCp1 = "50805";
                    |FINSI;

                    aAlfa = aNom + ";" + aDir + ";" + aPob + ";" + aCP + ";";
                    aAlfa = aAlfa + aTlf + ";" + aBul + ";" + aImp + ";";
                    aAlfa = aAlfa + aNum + ";" + aObs + ";" + aCp1 + aFinReg;
                    |XGRABA nHandle, aAlfa;
                    |SI num_alb ! 0;
                         |XCIERRA  nHandle;
                         aAlfa = #10#52 + (("000000" + #10#0) % -106); |QBT aAlfa;
                         aAlfa = "0000Creado:" + aAlfa + ".txt";
                         |MENAV aAlfa;
                    |FINSI;
               |SINO;
                    aAlfa = "0000Error al crear: " + aAlfa + ".txt";
                    |MENAV aAlfa;
               |FINSI;
          |FINSI;
          |LIBERA #29;
     |FINSI;
|FCAL;

|DEFBUCLE agifa010;
     #10#3;
     43;
     #0#0 , #0#4 , #0#6 , #0#2, "N";
     #0#1 , #0#5 , #0#7 , #0#3, "N";
     ;
     NULL, agifa010;
|FIN;

|CALCULO Tipo3;  |TIPO 3;
     |ABRE #3;
     |ABRE #24;
     |ABRE #25;
     |ABRE #26;
     |ABRE #29;
     |BUCLE agifa010;
     |SI num_alb = 0; |Y nPrime = 1; |Y nAbre ] 0;
          |XCIERRA  nHandle;
          |MENAV "0000Creado: generico.txt";
     |FINSI;
     |CIERRA #29;
     |CIERRA #26;
     |CIERRA #25;
     |CIERRA #24;
     |CIERRA #3;
|FCAL;

|PROGRAMA;
     aFinReg = &13;
     aFinReg = aFinReg + & 10;
     |ABRE #6; |LEE 000#6p; |CIERRA #6;
     |SI ser_alb = ""; |Y num_alb = 0;
         |CLS;
         |CABEZA "Emitir Etiquetas Envio";
         |PINPA #0#0;
         |PINDA #0#0;
         |ENDATOS #1#0;
         |SI FSalida = 0;  |HAZ Tipo3;  |FINSI;
     |SINO;
         |DDEFECTO #0;
         #0#6  = ser_alb;
         #0#7  = ser_alb;
         #0#2  = num_alb;
         #0#3  = num_alb;
         #0#4 = "01.01.0000";
         #0#5 = "31.12.9999";
         #0#8 = "T";
         |HAZ Tipo3;
     |FINSI;
|FPRO;
