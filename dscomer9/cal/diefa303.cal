 |FICHEROS;
     diefa303 #0;   || este def
     agifa071 #1;   || Albaranes venta (L)
     agifa010 #3;   || Albaranes venta (C)
     diefa304 #4;   || Fichero para obtenerlo por pantalla
     agifa024 #5;   || Clientes
     agifm001 #6;   || Zonas de clientes
     agifa025 #7;   || Representante
     agifa084 #84;  || Facturas Contado (C)
     agifa069 #69;  || Facturas Contado (L)
|FIN;

|VARIABLES;
     &aDivisa  = "";
     &aMoneda  = "";
     i         = 0;
     aFic      = "";
     aOrg      = "";
     aDes      = "";
     aUsu      = "";
     aAlfa     = "";
     aCliente  = "";
     nResul    = 1;
     linea     = 0;
     salmenu   = 0;
     &sw       = 0;
     nPrimera  = 0;
     informe   = "diefa303";
     factu     = "";
     {-1}menu  = "";
     menu1     = "2400";
     menu2     = "1";
     menu3     = "Salida:  ";
     menu4     = "PI";
     menu5     = " Pantalla ";
     menu6     = " Impresora ";
|FIN;

|PROCESO FacCont;
     |SI #69#2 < #0#8; |O #69#2 > #0#9; |ACABA; |FINSI;

     |DDEFECTO #4;
     #4#9 = #69#15;       || cliente
     #4#1 = #69#2;        || articulo
     |LEE 101#4=;
     |SI FSalida ! 0; |GRABA 020#4b; |FINSI;
     |SI #84#1 ] #4#3;
          #4#2 = #69#4;        || descripcion
          #4#3 = #84#1;        || fecha factura
          #4#4 = #69#0;        || nro. factura
          #4#5 = #69#5;        || unidades
          #4#7 = #69#6;        || precio
          #4#13 = #5#25;       || representante
          #4#10 = #5#3;
          #4#11 = #5#1;
          #4#12 = #6#1;
          #4#14 = #84#48;
          #4#15 = #69#27;
          #4#16 = "D";
     |FINSI;
     #4#6 = #4#6 + #69#5;
     #4#8 = #4#8 + #69#27;       || total
     |GRABA 020#4a;
     |LIBERA #4;
|FPRC;

|PROCESO CabFac;
     #5#0 = #84#3;
     |LEE 000#5=;
     |SI FSalida ! 0; |DDEFECTO #5; |FINSI;

     |SI #5#3 < #0#10;|O #5#3 > #0#11; || filtra las zonas
          |ERROR;
     |FINSI;
     |SI #84#6 < #0#12; |O #84#6 > #0#13;    ||filtra repre
          |ERROR;
     |FINSI;

     #6#0 = #5#3;
     |LEE 000#6=;
     |SI FSalida ! 0; |DDEFECTO #6; |FINSI;

     aDivisa = #84#65;
     aMoneda = #84#67;
     |HAZ Divisas084;
|FPRC;

|DEFBUCLE LeerFacCont;
     #84#3;
     ;
     #0#0, #0#6, #0#2, #0#4;
     #0#1, #0#7, #0#3, #0#5;
     ;
     NULL, CabFac, FacCont;
|FIN;

|PROCESO AlbVen;
     |SI #3#1 < #0#6; |O #3#1 > #0#7; |ACABA; |FINSI;
     |SI #1#2 < #0#8; |O #1#2 > #0#9; |ACABA; |FINSI;

     |DDEFECTO #4;
     #4#9 = #1#15;       || cliente
     #4#1 = #1#2;        || articulo
     |LEE 101#4=;
     |SI FSalida ! 0; |GRABA 020#4b; |FINSI;
     |SI #3#1 ] #4#3;
          #4#2 = #1#4;        || descripcion
          #4#3 = #3#1;       || fecha factura
          #4#4 = #3#0;       || nro. factura
          #4#5 = #1#5;        || unidades
          #4#7 = #1#6;        || precio
          #4#13 = #5#25;       || representante
          #4#10 = #5#3;
          #4#11 = #5#1;
          #4#12 = #6#1;
          #4#14 = #3#52;
          #4#15 = #1#37;
          #4#16 = "A";
     |FINSI;
     #4#6 = #4#6 + #1#5;
     #4#8 = #4#8 + #1#37;       || total

      |||    linea = linea + 1;
      |||    #4#0 = linea;
     |GRABA 020#4a;
     |LIBERA #4;
|FPRC;

|PROCESO CabAlb;
     |DDEFECTO #5;
     #5#0 = #3#3;
     |LEE 000#5=;
     |SI FSalida ! 0; |DDEFECTO #5; |FINSI;

     |SI #5#3 < #0#10;|O #5#3 > #0#11; || filtra las zonas
          |ERROR;
     |FINSI;
     |SI #3#6 < #0#12; |O #3#6 > #0#13;    ||filtra repre
          |ERROR;
     |FINSI;

     #6#0 = #5#3;
     |LEE 000#6=;
     |SI FSalida ! 0; |DDEFECTO #6; |FINSI;

     aDivisa = #3#68;
     aMoneda = #3#70;
     |HAZ Divisas010;
|FPRC;

|DEFBUCLE LeerAlbVen;
     #3#3;
     ;
     #0#0, "01.01.0000", #0#2, #0#4;
     #0#1, "31.12.9999", #0#3, #0#5;
     ;
     NULL, CabAlb, AlbVen;
|FIN;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO LeeCliente;
     |DDEFECTO #5;
     |ABRE #5;
     #5#0 = #4#9;
     |LEE 000#5=;
     |CIERRA #5;
|FPRC;

|PROCESO LeeRepre;
     |DDEFECTO #7;
     |ABRE #7;
     #7#0 = #4#13;
     |LEE 000#7=;
     |CIERRA #7;
|FPRC;

|PROCESO Informe;
     |HAZ LeeCliente;
     |HAZ LeeRepre;
     |SI aCliente ! #4#9;
          |SI nPrimera = 1;
               sw = 2;
               |PRINT;
               |PIEINF;
          |FINSI;
          aCliente = #4#9;
          sw = 1;
          |PRINT;
     |FINSI;
     sw = 0;
     |PRINT;
     |SI nPrimera = 0;
          nPrimera = 1;
     |FINSI;
|FPRC;

|PROCESO Final;
     sw = 2;
     |PRINT;
|FPRC;

|DEFBUCLE Informe;
     #4#2;
     ;
     "   ", "      ", "                   ";
     "zzz", "zzzzzz", "zzzzzzzzzzzzzzzzzzzz";
     ;
     NULL, Informe, NULL, NULL, Final;
|FIN;


|PROCESO tipo3; |TIPO 3;
     aUsu = Usuario; |QBF aUsu;
     |NOME_DAT #4 aUsu; |DELINDEX #4;

     |MENU menu;
     salmenu = FSalida;
     |SI salmenu ! 1; |Y salmenu ! 2; |ACABA; |FINSI;

     |ABRE #3;
     |ABRE #4;
     |ABRE #5;    || Clientes
     |ABRE #6;
     |ABRE #84;
     |ABRE #69;
     linea = 0;
     |SI #0#14 = "A"; |O #0#14 = "T";
          |BUCLE LeerAlbVen;
     |FINSI;
     |SI #0#14 = "F"; |O #0#14 = "T";
          |BUCLE LeerFacCont;
     |FINSI;
     |CIERRA #3;
     |CIERRA #4;
     |CIERRA #5;
     |CIERRA #6;
     |CIERRA #84;
     |CIERRA #69;

     |SI salmenu = 2;
          |IMPRE 0;
          |SI FSalida = 0;
               |INFOR informe;
               |SI FSalida = 0;
                    nPrimera = 0;
                    |BUCLE Informe;
                    |PIEINF;
                    |FININF;
               |FINSI;
               |FINIMP;
          |FINSI;
     |FINSI;
     |SI salmenu = 1;
          aAlfa =  "diefa304;" + aUsu;
          |SUB_EJECUTA aAlfa;
     |FINSI;

     |DFICE aFic;
     aOrg = aFic + aUsu + ".dat";
     aDes = aFic + "diefa304.dat";
     |COPIA_FICHERO aOrg, aDes;

     aOrg = aFic + aUsu + ".ddx";
     aDes = aFic + "diefa304.ddx";
     |COPIA_FICHERO aOrg, aDes;

     aOrg = aFic + aUsu + ".ixx";
     aDes = aFic + "diefa304.ixx";
     |COPIA_FICHERO aOrg, aDes;

     |DELINDEX #4;
|FPRC;
