|FICHEROS;
     evarm004 #0;
     evarm003@ #3;
     evarm005@ #2;
     evarm012@ #12;
     evarm021@ #21;
     evarm022@ #22;
     agifa019 #19;
     agifa073 #73;
     agifa104 #104;
     dsm00005 #905;
|FIN;

|VARIABLES;
     aTalla = "";
     nUni = 0;
     &eaArtiAntes = "";
     &eaArticulo = "";
     &eaEvaInc = "";
     &enEvaPor = 0;
     &enEvaImp = 0;
     &eaEvaTalla = "";
     &enUnidades = 0;
     &enModo = 0;
     nLinV = 0;
     nReg = 0;
     nCampo = 0;
     aAlfa = "";

     aIncr = "";
     nPrime = 0;
     nOk = 0;
     aPath = "";
     Camino = "";
     nGuarda = 0;
     suma = 0;
     nModo = 0;
     uni = 0;
     talla = "";
     tt = "";
     etiq = "";
     bultos = 0;
     cta1 = "";
     cta = "";
     aPrime = "";
     aUlti = "";
     aBase = "";
     nPorce = 0;
     i = 0;
     nServi = 0;
     nError = 0;
|FIN;

|PROCESO ActServidas;
     |SELECT #5#22;
     #22#5 = #73#28;
     #22#6 = #73#0;
     #22#7 = #73#1;
     #22#13 = #21#0;
     |LEE 000#22=;
     |SI FSalida = 0;
          #21#11 = "S";
          |GRABA 020#21a;
     |FINSI;
|FPRC;

|DEFBUCLE ActServidas;
     #21#1004;
     ;
     #73#28, #73#0, #73#1, "            ";
     #73#28, #73#0, #73#1, "zzzzzzzzzzzz";
     be;
     NULL, ActServidas;
|FIN;

|PROCESO Servidas;
     nServi = nServi + 1;
|FPRC;

|DEFBUCLE Servidas;
     #22#5004;
     12;
     #73#28, #73#0, #73#1, "            ", aTalla;
     #73#28, #73#0, #73#1, "zzzzzzzzzzzz", aTalla;
     ;
     NULL, Servidas;
|FIN;

|PROCESO CheqTallas;
     nError = 0;
     |PARA i = 3; |SI i [ 23; |HACIENDO i = i + 1;
          aTalla = "";
          |SI i = 3; aTalla = "80      "; |FINSI;
          |SI i = 4; aTalla = "85      "; |FINSI;
          |SI i = 5; aTalla = "90      "; |FINSI;
          |SI i = 6; aTalla = "95      "; |FINSI;
          |SI i = 7; aTalla = "100     "; |FINSI;
          |SI i = 8; aTalla = "105     "; |FINSI;
          |SI i = 9; aTalla = "110     "; |FINSI;
          |SI i = 10; aTalla = "115     "; |FINSI;
          |SI i = 11; aTalla = "120     "; |FINSI;
          |SI i = 12; aTalla = "125     "; |FINSI;
          |SI i = 13; aTalla = "130     "; |FINSI;
          |SI i = 14; aTalla = "135     "; |FINSI;
          |SI i = 15; aTalla = "Especial"; |FINSI;
          |SI i = 16;
               aTalla = "140     ";
               nUni = #0#27;
          |FINSI;
          |SI i = 17;
               aTalla = "Compleme";
               nUni = #0#39;
          |FINSI;
          |SI i = 18;
               aTalla = "70      ";
               nUni = #0#40;
          |FINSI;
          |SI i = 19;
               aTalla = "75      ";
               nUni = #0#41;
          |FINSI;
          |SI i = 20;
               aTalla = "3M      ";
               nUni = #0#42;
          |FINSI;
          |SI i = 21;
               aTalla = "6M      ";
               nUni = #0#43;
          |FINSI;
          |SI i = 22;
               aTalla = "9M      ";
               nUni = #0#44;
          |FINSI;
          |SI i = 23;
               aTalla = "18M     ";
               nUni = #0#45;
          |FINSI;

          |SI aTalla = "";
               nUni = #0i;
          |FINSI;

          nServi = 0;
          |BUCLE Servidas;
          |SI nUni < nServi;
               aAlfa = "0000Las unidades talla " + aTalla; |QBF aAlfa;
               aAlfa = aAlfa + " no pueden ser menor a las servidas:" + nServi;
               |MENAV aAlfa;
               nError = 1;
          |FINSI;
     |SIGUE;
|FPRC;

|PROCESO Borra21;
     |BORRA 020#21a;
|FPRC;

|DEFBUCLE Borra21;
     #21#1004;
     ;
     #73#28, #73#0, #73#1, "            ";
     #73#28, #73#0, #73#1, "zzzzzzzzzzzz";
     be;
     NULL, Borra21;
|FIN;

|PROCESO BorraSobra;
     |BORRA 020#2a;

     #21#4 = #73#28;
     #21#5 = #73#0;
     #21#6 = #73#1;
     #21#0 = #2#0;
     |LEE 101#21=;
     |SI FSalida = 0;
          |BORRA 020#21a;
     |FINSI;
|FPRC;

|DEFBUCLE BorraSobra;
     #2#1001;
     ;
     aPrime;
     aUlti;
     be;
     NULL, BorraSobra;
|FIN;

|PROCESO EvaEtiqueta;
     |DDEFECTO #2;
     #2#0 = etiq;
     |LEE 000#2=;
     |SI FSalida ! 0;
          #2#1 = #73#28; || Serie Pedido....
          #2#2 = "4";
          #2#3 = "PREVIO";
          #2#4 = talla;
          #2#5 = bultos;
          #2#6 = #73#0;  || N§ Pedido...
          #2#7 = #73#1;  || N§ Linea....
          #2#8 = ~;
          |GRABA 020#2n;
     |FINSI;

     |DDEFECTO #21;
     #21#4 = #73#28;
     #21#5 = #73#0;
     #21#6 = #73#1;
     #21#0 = #2#0;
     |LEE 101#21=;
     |SI FSalida ! 0; |GRABA 020#21b; |FINSI;
     #21#1 = #73#2;
     #21#2 = #2#4;
     #21#3 = #0#29;
     #21#7 = #0#28;
     #21#8 = #2#3;
     #21#9 = #104#1;
     #21#10 = #104#4;
     #21#11 = "N";
     #21#12 = 1;
     #21#13 = 1;
     |GRABA 020#21a;
     |LIBERA #21;
|FPRC;

|PROCESO EtiquetaBase;
     etiq = #agifa073#0;
     etiq = "000000" + etiq;
     etiq = etiq % "-106";

     cta1 = #agifa073#1;
     cta = "00" + cta1;
     cta = cta % "-102";

     etiq = etiq + cta;
     etiq = etiq + tt;

     aBase = etiq;
|FPRC;

|PROCESO EvaEtiqueta0;
     |HAZ EtiquetaBase;

     aPrime = aBase;
     aUlti = aBase + "zz";
     |ABRE #2;
     uni = uni + 1;
     |PARA bultos = 1; |SI bultos [ uni;|HACIENDO bultos = bultos + 1;
          etiq = aBase;
          cta1 = bultos;
          cta = "00" + cta1;
          cta = cta % "-102";
          etiq = etiq + cta;
          aPrime = etiq;
          |SI bultos ! uni;
               |HAZ EvaEtiqueta;
          |FINSI;
     |SIGUE;
     |CIERRA #2;
     |BUCLE BorraSobra;
|FPRC;

|PROCESO CreaEtiquetas;
     uni = #0#3; talla = "80";  tt = "01"; |HAZ EvaEtiqueta0;
     uni = #0#4; talla = "85";  tt = "02"; |HAZ EvaEtiqueta0;
     uni = #0#5; talla = "90";  tt = "03"; |HAZ EvaEtiqueta0;
     uni = #0#6; talla = "95";  tt = "04"; |HAZ EvaEtiqueta0;
     uni = #0#7; talla = "100"; tt = "05"; |HAZ EvaEtiqueta0;
     uni = #0#8; talla = "105"; tt = "06"; |HAZ EvaEtiqueta0;
     uni = #0#9; talla = "110"; tt = "07"; |HAZ EvaEtiqueta0;
     uni = #0#10; talla = "115"; tt = "08"; |HAZ EvaEtiqueta0;
     uni = #0#11; talla = "120"; tt = "09"; |HAZ EvaEtiqueta0;
     uni = #0#12; talla = "125"; tt = "10"; |HAZ EvaEtiqueta0;
     uni = #0#13; talla = "130"; tt = "11"; |HAZ EvaEtiqueta0;
     uni = #0#14; talla = "135"; tt = "12"; |HAZ EvaEtiqueta0;
     uni = #0#27; talla = "140"; tt = "14"; |HAZ EvaEtiqueta0;
     uni = #0#15; talla = "Especial"; tt = "13"; |HAZ EvaEtiqueta0;
     uni = #0#39; talla = "Compleme"; tt = "15"; |HAZ EvaEtiqueta0;
     uni = #0#40; talla = "70      "; tt = "16"; |HAZ EvaEtiqueta0;
     uni = #0#41; talla = "75      "; tt = "17"; |HAZ EvaEtiqueta0;
     uni = #0#42; talla = "3M      "; tt = "18"; |HAZ EvaEtiqueta0;
     uni = #0#43; talla = "6M      "; tt = "19"; |HAZ EvaEtiqueta0;
     uni = #0#44; talla = "9M      "; tt = "20"; |HAZ EvaEtiqueta0;
     uni = #0#45; talla = "18M     "; tt = "21"; |HAZ EvaEtiqueta0;
|FPRC;

|PROCESO ModiIncr;
     aAlfa = #0#36;
     |C_M #0#37, 1, aAlfa;
     |C_M #0#38, 1, aAlfa;
|FPRC;

|PROCESO Tallas;
     nCampo = nReg + 3;
     |SI nReg = 12; nCampo = 27; |FINSI;
     |SI nReg = 13; nCampo = 15; |FINSI;
     |SI nReg = 14; nCampo = 40; |FINSI;
     |SI nReg = 15; nCampo = 41; |FINSI;
     |SI nReg = 16; nCampo = 42; |FINSI;
     |SI nReg = 17; nCampo = 43; |FINSI;
     |SI nReg = 18; nCampo = 44; |FINSI;
     |SI nReg = 19; nCampo = 45; |FINSI;
     |SI nReg ] 20; |ACABA; |FINSI;
     #0nCampo = #905#6;
     nReg = nReg + 1;
|FPRC;

|DEFBUCLE Tallas;
     #905#1;
     ;
     "PV", #73#28, #73#0, nLinV, "      ";
     "PV", #73#28, #73#0, nLinV, "zzzzzz";
     ;
     NULL, Tallas;
|FIN;

|PROCESO CreaSinTalla;
     |DDEFECTO #21;
     #21#4 = #73#28;
     #21#5 = #73#0;
     #21#6 = #73#1;
     #21#0 = "";
     |LEE 101#21=;
     |SI FSalida ! 0; |GRABA 020#21b; |FINSI;
     #21#1 = #73#2;
     #21#3 = #73#2;
     #21#9 = #104#1;
     #21#10 = #104#4;
     #21#11 = "N";
     #21#12 = #73#5;
     #21#13 = #73#5;
     |GRABA 020#21a;
     |LIBERA #21;
|FPRC;

|PROCESO EvaResto;
     |DDEFECTO #0;
     |ABRE #0;
     #0#30 = #73#28;
     #0#31 = #73#0;
     #0#32 = #73#1;
     |SI enModo = 3;
          |LEE 101#0=;
          |SI FSalida = 0;
               |BORRA 000#0a;
          |FINSI;
          |HAZ EvaBajaResto;
     |SINO;
          |LEE 101#0=;
          |SI FSalida ! 0; |GRABA 020#0b; |FINSI;
          |SI eaEvaTalla = "S";
               |SI enModo = 1; |O eaArtiAntes ! eaArticulo;
                    #0#29 = #73#2;
                    |ABRE #evarm003@;
                    #evarm003@#0 = #104#4;
                    #evarm003@#1 = #73#2;
                    |LEE 000#evarm003@.=;
                    |SI FSalida = 0;
                         #0#2 = #evarm003@#2;
                         #0#29 = #evarm003@#5;
                    |FINSI;
                    |CIERRA #evarm003@;
               |FINSI;
               nReg = 0;
               nLinV = #73#1;
               |BUCLE Tallas;
               |GRABA 020#0a;

               |PUSHV 0501 2380;
               |PINPA #0#0;
               |PINDA #0#0;
               |PARA; |SI; |HACIENDO;
                    |SI enModo = 1;
                         |ENDATOS #1#0;
                    |SINO;
                         |ENDATOS #2#0;
                    |FINSI;
                    |SI FSalida = 0;
                         |HAZ CheqTallas;
                         |SI nError = 0;
                              |GRABA 020#0a;
                              |SAL;
                         |FINSI;
                    |SINO;
                         |SAL;
                    |FINSI;
               |SIGUE;
               |POPV;
          |SINO;
               |ABRE #21;
               |HAZ CreaEtiquetas;
               |ABRE #22;
               |BUCLE ActServidas;
               |CIERRA #22;
               nUni = #0#27 + #0#39 + #0#40 + #0#41;
               nUni = nUni + #0#42 + #0#43 + #0#44 + #0#45;
               |PARA i = 3; |SI i [ 15; |HACIENDO i = i + 1;
                    nUni = nUni + #0i;
               |SIGUE;
               |SI nUni = 0;
                    |HAZ CreaSinTalla;
               |SINO;
                    #21#4 = #73#28;
                    #21#5 = #73#0;
                    #21#6 = #73#1;
                    #21#0 = "";
                    |LEE 101#21=;
                    |SI FSalida = 0; |BORRA 020#21a; |FINSI;
               |FINSI;
               |CIERRA #21;
          |FINSI;

          eaEvaInc = "N";
          |SI #0#36 = "S";
               |SI eaEvaTalla = "N";
/*

                    |SI #0#37 ! 0;
                         #73#6 = #73#6 + (#73#6 * #0#37 / 100);
                    |FINSI;
                    #73#6 = #73#6 + #0#38;
                    |PINTA #73#6;
*/
               |SINO;
                    || se incrementa en el pedido
                    eaEvaInc = #0#36;
                    enEvaPor = #0#37;
                    enEvaImp = #0#38;
               |FINSI;
          |FINSI;
     |FINSI;
     |CIERRA #0;
|FPRC;

|PROCESO EvaBajaResto;
     |ABRE #evarm012@;
     #evarm012@#0 = #73#28; ||serie
     #evarm012@#1 = #73#0; ||numero
     #evarm012@#2 = #73#1; ||linea
     |LEE 101#evarm012@.=;
     |SI FSalida = 0;
          |BORRA 000#evarm012@.a;
     |FINSI;
     |CIERRA #evarm012@;

     tt = "";
     |HAZ EtiquetaBase;
     aPrime = aBase;
     aUlti = aBase + "zz";

     |ABRE #evarm021@;
     |BUCLE BorraSobra;
     |CIERRA #evarm021@;
     |BUCLE Borra21;
|FPRC;

|PROCESO EvaPideResto;
     |ABRE #19;
     #19#0 = #73#2;
     |LEE 000#19=;
     |SI FSalida ! 0; |ACABA; |FINSI;
     |CIERRA #19;
     |SI enModo ! 3;
/*
          |SI eaEvaTalla = "S";
               |SI #19#175 = "S"; |O #19#176 = "S"; |ACABA; |FINSI;
          |SINO;
               |SI #19#175 = "N"; |Y #19#176 = "N"; |ACABA; |FINSI;
          |FINSI;
*/
          |PARA i = 3; |SI i [ 15; |HACIENDO i = i + 1;
               |C_M #0i, 1, eaEvaTalla;
          |SIGUE;
          |C_M #0#27, 1, eaEvaTalla;
          |C_M #0#39, 1, eaEvaTalla;
          |C_M #0#40, 1, eaEvaTalla;
          |C_M #0#41, 1, eaEvaTalla;
          |C_M #0#42, 1, eaEvaTalla;
          |C_M #0#43, 1, eaEvaTalla;
          |C_M #0#44, 1, eaEvaTalla;
          |C_M #0#45, 1, eaEvaTalla;
     |FINSI;
     |DDEF aPath;
     aAlfa = aPath + "evarm005";
     |CARGA_DEF aAlfa, evarm005@;
     |SI FSalida = 0;
          aAlfa = aPath + "evarm021";
          |CARGA_DEF aAlfa, evarm021@;
          |SI FSalida = 0;
               aAlfa = aPath + "evarm012";
               |CARGA_DEF aAlfa, evarm012@;
               |SI FSalida = 0;
                    aAlfa = aPath + "evarm003";
                    |CARGA_DEF aAlfa, evarm003@;
                    |SI FSalida = 0;
                         aAlfa = aPath + "evarm022";
                         |CARGA_DEF aAlfa, evarm022@;
                         |SI FSalida = 0;

                              |HAZ EvaResto;
                              enUnidades = #73#5;
                              nUni = #0#27 + #0#39 + #0#40 + #0#41;
                              nUni = nUni + #0#42 + #0#43 + #0#44 + #0#45;
                              |PARA i = 3; |SI i [ 15; |HACIENDO i = i + 1;
                                   nUni = nUni + #0i;
                              |SIGUE;
                              |SI nUni ! 0; enUnidades = nUni; |FINSI;

                              |DESCARGA_DEF #evarm022@;
                         |FINSI;
                         |DESCARGA_DEF #evarm003@;
                    |SINO;
                         |MENAV "0000Error al cargar 'evarm003'";
                    |FINSI;
                    |DESCARGA_DEF #evarm012@;
               |SINO;
                    |MENAV "0000Error al cargar 'evarm012'";
               |FINSI;
               |DESCARGA_DEF #evarm021@;
          |SINO;
               |MENAV "0000Error al cargar 'evarm021'";
          |FINSI;
          |DESCARGA_DEF #evarm005@;
     |SINO;
          |MENAV "0000Error al cargar 'evarm005'";
     |FINSI;
|FPRC;
