|FICHEROS;
     tempcpvp #0,MANTE;
     agifa019 #19;
     agifa142 #142;
|FIN;

|VARIABLES;
     &enTiva = 0;
     &efFiva = @;
     &eaDiva = "";
     &enIva = 0;
     &enRec = 0;
     nSwPedido = 0;
     nSwVertical = 0;
     nSacaPan = 0;
     &enOrgPcm = 0;
     &enOrgPcom = 0;
     &enOrgPdto = 0;

     aGuarda = "";
     nRedo = 0;
     &nDeci_PreBase  = 0;   || Decimales en el Precio en moneda base
     &nDeci_PreDiv  = 0;
     &nDeci_Base = 0;
     factordec = 0;
     calpre = 0;
     precio = 0;
     &pvp1   = 0;
     &pvp2   = 0;
     &pvp3   = 0;
     &pvp4   = 0;
     &pvp5   = 0;
     &pvp6   = 0;
     m1     = 0;
     m2     = 0;
     m3     = 0;
     m4     = 0;
     m5     = 0;
     m6     = 0;
     i      = 0;
     &enPVP = 0;
     &enInc = 0;
     &eaInc = "";
     &enRedo = 0;
     &enPreCom = 0;
|FIN;

|PROCESO actudemas; |TIPO 0;
     |SI FSalida = 9;
          #0#9  = #0#8;
          #0#10 = #0#8;
          #0#11 = #0#8;
          #0#12 = #0#8;
          #0#13 = #0#8;
          |PINTA #0#9;
          |PINTA #0#10;
          |PINTA #0#11;
          |PINTA #0#12;
          |PINTA #0#13;
          |ERROR;
     |FINSI;
|FPRC;

|PROCESO CalPre;
     #19#109 = #0#21;
     |SI Campo ] 14; |Y Campo [ 19; |Y #0#20 = "G"; |Y #0Campo > 100;
          |MENAV "0000Porcentaje incorrecto debe ser menor de 100";
     |FINSI;

     |SI calpre = 1; precio = #19#9;    |FINSI;
     |SI calpre = 2; precio = #19#28;  |FINSI;
     |SI calpre = 3; precio = #19#133; |FINSI;

     |SI nSwVertical = 1; |Y precio = 0;
          precio = enPreCom;
     |FINSI;
     |SI nSwPedido = 1;
          precio = enPVP;
     |FINSI;

     |SI #142#125 = "N";
          pvp1 = #0#2;
          pvp2 = #0#3;
          pvp3 = #0#4;
          pvp4 = #0#5;
          pvp5 = #0#6;
          pvp6 = #0#7;
          |SI #0#20 = "S";
               |SI #0#14 ! 0; pvp1 = precio > #0#14; |FINSI;
               |SI #0#15 ! 0; pvp2 = precio > #0#15; |FINSI;
               |SI #0#16 ! 0; pvp3 = precio > #0#16; |FINSI;
               |SI #0#17 ! 0; pvp4 = precio > #0#17; |FINSI;
               |SI #0#18 ! 0; pvp5 = precio > #0#18; |FINSI;
               |SI #0#19 ! 0; pvp6 = precio > #0#19; |FINSI;
          |SINO;
               |SI #0#14 ! 0; pvp1 = (precio * 100) / (100 - #0#14); |FINSI;
               |SI #0#15 ! 0; pvp2 = (precio * 100) / (100 - #0#15); |FINSI;
               |SI #0#16 ! 0; pvp3 = (precio * 100) / (100 - #0#16); |FINSI;
               |SI #0#17 ! 0; pvp4 = (precio * 100) / (100 - #0#17); |FINSI;
               |SI #0#18 ! 0; pvp5 = (precio * 100) / (100 - #0#18); |FINSI;
               |SI #0#19 ! 0; pvp6 = (precio * 100) / (100 - #0#19); |FINSI;
          |FINSI;
     |SINO;
          |SI #0#20 = "S";
               pvp1 = precio > #0#14;
               pvp2 = precio > #0#15;
               pvp3 = precio > #0#16;
               pvp4 = precio > #0#17;
               pvp5 = precio > #0#18;
               pvp6 = precio > #0#19;
          |SINO;
               pvp1 = (precio * 100) / (100 - #0#14);
               pvp2 = (precio * 100) / (100 - #0#15);
               pvp3 = (precio * 100) / (100 - #0#16);
               pvp4 = (precio * 100) / (100 - #0#17);
               pvp5 = (precio * 100) / (100 - #0#18);
               pvp6 = (precio * 100) / (100 - #0#19);
          |FINSI;
     |FINSI;

     enTiva = #19#30;
     efFiva = ~;
     |HAZ SacaIVA;

     |SI #142#125 = "N";
          |SI #19#130 = "S"; |Y #0#14 ! 0; pvp1 = pvp1 > enIva; |FINSI;
          |SI #19#131 = "S"; |Y #0#15 ! 0; pvp2 = pvp2 > enIva; |FINSI;
          |SI #19#132 = "S"; |Y #0#16 ! 0; pvp3 = pvp3 > enIva; |FINSI;
          |SI #19#153 = "S"; |Y #0#17 ! 0; pvp4 = pvp4 > enIva; |FINSI;
          |SI #19#154 = "S"; |Y #0#18 ! 0; pvp5 = pvp5 > enIva; |FINSI;
          |SI #19#155 = "S"; |Y #0#19 ! 0; pvp6 = pvp6 > enIva; |FINSI;
     |SINO;
          |SI #19#130 = "S"; pvp1 = pvp1 > enIva; |FINSI;
          |SI #19#131 = "S"; pvp2 = pvp2 > enIva; |FINSI;
          |SI #19#132 = "S"; pvp3 = pvp3 > enIva; |FINSI;
          |SI #19#153 = "S"; pvp4 = pvp4 > enIva; |FINSI;
          |SI #19#154 = "S"; pvp5 = pvp5 > enIva; |FINSI;
          |SI #19#155 = "S"; pvp6 = pvp6 > enIva; |FINSI;
     |FINSI;
     |SI #19#109 > 0;
          |HAZ Redondeo;
     |FINSI;

     pvp1 = pvp1 ! nDeci_PreBase;
     pvp2 = pvp2 ! nDeci_PreBase;
     pvp3 = pvp3 ! nDeci_PreBase;
     pvp4 = pvp4 ! nDeci_PreBase;
     pvp5 = pvp5 ! nDeci_PreBase;
     pvp6 = pvp6 ! nDeci_PreBase;

     #0#8 = pvp1;   |PINTA #0#8;
     #0#9 = pvp2;   |PINTA #0#9;
     #0#10 = pvp3;  |PINTA #0#10;
     #0#11 = pvp4;  |PINTA #0#11;
     #0#12 = pvp5;  |PINTA #0#12;
     #0#13 = pvp6;  |PINTA #0#13;
|FPRC;

|CALCULO Redondeo;|TIPO 0;
     pvp1 = pvp1 ! nDeci_PreBase;
     pvp2 = pvp2 ! nDeci_PreBase;
     pvp3 = pvp3 ! nDeci_PreBase;
     pvp4 = pvp4 ! nDeci_PreBase;
     pvp5 = pvp5 ! nDeci_PreBase;
     pvp6 = pvp6 ! nDeci_PreBase;
     |SI #19#109 > 0;
          factordec = 1; ||Necesario redondeo divisas
          |PARA i = 1;|SI i [ nDeci_PreBase;|HACIENDO i = i + 1;
               factordec = factordec * 10;
          |SIGUE;
          pvp1 = (pvp1 * factordec) ! 0;
          pvp2 = (pvp2 * factordec) ! 0;
          pvp3 = (pvp3 * factordec) ! 0;
          pvp4 = (pvp4 * factordec) ! 0;
          pvp5 = (pvp5 * factordec) ! 0;
          pvp6 = (pvp6 * factordec) ! 0;

          nRedo = #19#109 * factordec;

          m1 = pvp1 $ nRedo;
          m2 = pvp2 $ nRedo;
          m3 = pvp3 $ nRedo;
          m4 = pvp4 $ nRedo;
          m5 = pvp5 $ nRedo;
          m6 = pvp6 $ nRedo;

          |SI m1 ! 0;    pvp1 = pvp1 + nRedo - m1; |FINSI;
          |SI m2 ! 0;    pvp2 = pvp2 + nRedo - m2; |FINSI;
          |SI m3 ! 0;    pvp3 = pvp3 + nRedo - m3; |FINSI;
          |SI m4 ! 0;    pvp4 = pvp4 + nRedo - m4; |FINSI;
          |SI m5 ! 0;    pvp5 = pvp5 + nRedo - m5; |FINSI;
          |SI m6 ! 0;    pvp6 = pvp6 + nRedo - m6; |FINSI;

          pvp1 = pvp1 / factordec;
          pvp2 = pvp2 / factordec;
          pvp3 = pvp3 / factordec;
          pvp4 = pvp4 / factordec;
          pvp5 = pvp5 / factordec;
          pvp6 = pvp6 / factordec;
     |FINSI;
|FCAL;

|PROCESO CargaDatos;
     calpre = #142#60;
     #0#0 = #19#0;
     #0#1 = #19#1;

     #0#2 = #19#18;
     #0#3 = #19#19;
     #0#4 = #19#20;
     #0#5 = #19#147;
     #0#6 = #19#148;
     #0#7 = #19#149;

     #0#14 = #19#105;
     #0#15 = #19#106;
     #0#16 = #19#107;
     #0#17 = #19#156;
     #0#18 = #19#157;
     #0#19 = #19#158;

     #0#20 = #19#108;
     #0#21 = #19#109;
|FPRC;

|PROCESO Termina; |TIPO 3;
     #19#105 = #0#14;
     #19#106 = #0#15;
     #19#107 = #0#16;
     #19#156 = #0#17;
     #19#157 = #0#18;
     #19#158 = #0#19;
     #19#108 = #0#20;
     #19#109 = #0#21;

     #19#18 = #0#8;
     #19#19 = #0#9;
     #19#20 = #0#10;
     #19#147 = #0#11;
     #19#148 = #0#12;
     #19#149 = #0#13;
     #19#123 = "N";       ||Exportado
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO CalPre019;
     aGuarda = FEntrada;

     |PUSHV 0501 2380;
     |HAZ CargaDatos;
     |HAZ CalPre;
     |PINPA #0#0;
     |PINDA #0#0;
     |ENDATOS #1#0;
     |POPV;

     FEntrada = aGuarda;
|FPRC;

|PROCESO CalPre077;
     |HAZ CargaDatos;
     |HAZ CalPre;

     nSacaPan = 0;
     |SI #142#76 = "S"; |Y #142#240 = "N";
          |SI #19#18 ! #0#8; |O #19#19 ! #0#9; |O #19#20 ! #0#10;
                    |O #19#147 ! #0#11; |O #19#148 ! #0#12; |O #19#149 ! #0#13;
               nSacaPan = 1;
          |FINSI;
     |FINSI;
     |SI #142#76 = "N"; |Y #142#240 = "N";
          |HAZ Termina;
     |FINSI;

     |SI #142#76 = "S"; |Y #142#240 = "S";
          |SI enOrgPcm ! #19#9; |Y #142#60 = 1; nSacaPan = 1; |FINSI;
          |SI enOrgPcom ! #19#28; |Y #142#60 = 2; nSacaPan = 1; |FINSI;
          |SI enOrgPdto ! #19#133; |Y #142#60 =3; nSacaPan = 1; |FINSI;
     |FINSI;

     |SI #142#76 = "N"; |Y #142#240 = "S";
          |SI enOrgPcm ! #19#9; |Y #142#60 = 1; |HAZ Termina; |FINSI;
          |SI enOrgPcom ! #19#28; |Y #142#60 = 2; |HAZ Termina; |FINSI;
          |SI enOrgPdto ! #19#133; |Y #142#60 =3; |HAZ Termina; |FINSI;
     |FINSI;

     |HAZ EsTaller;     || segun tiquet 4762/40 15/4/2013
     |SI FSalida = 0; nSacaPan = 1; |FINSI;

     |SI nSacaPan = 1;
          |PUSHV 0501 2380;
          |PINPA #0#0;
          |PINDA #0#0;
          |ENDATOS #1#0;
          |POPV;
     |FINSI;
|FPRC;

|PROCESO CalPre109;
     |HAZ DecimalesBase;
     |HAZ CargaDatos;
     |HAZ CalPre;
     |HAZ Termina;
|FPRC;

|PROCESO CalpreVertical;
     |HAZ DecimalesBase;

     calpre = #142#60;

     |DDEFECTO #0;
     #0#2 = enPVP;
     #0#14 = enInc;
     #0#20 = eaInc;
     #0#21 = enRedo;

     nSwVertical = 1;
     |HAZ CalPre;
     nSwVertical = 0;

     enPVP = #0#8;
|FPRC;

|PROCESO CalPre081;
     |HAZ CargaDatos;

     nSwPedido = 1;
     |HAZ CalPre;
     nSwPedido = 0;

     nSacaPan = 0;
     |SI #142#76 = "S"; |Y #142#240 = "N";
          |SI #19#18 ! #0#8; |O #19#19 ! #0#9; |O #19#20 ! #0#10;
                    |O #19#147 ! #0#11; |O #19#148 ! #0#12; |O #19#149 ! #0#13;
               nSacaPan = 1;
          |FINSI;
     |FINSI;
     |SI #142#76 = "N"; |Y #142#240 = "N";
          |HAZ Termina;
     |FINSI;

     |SI #142#76 = "S"; |Y #142#240 = "S";
          |SI enOrgPcm ! #19#9; |Y #142#60 = 1; nSacaPan = 1; |FINSI;
          |SI enOrgPcom ! #19#28; |Y #142#60 = 2; nSacaPan = 1; |FINSI;
          |SI enOrgPdto ! #19#133; |Y #142#60 =3; nSacaPan = 1; |FINSI;
     |FINSI;

     |SI #142#76 = "N"; |Y #142#240 = "S";
          |SI enOrgPcm ! #19#9; |Y #142#60 = 1; |HAZ Termina; |FINSI;
          |SI enOrgPcom ! #19#28; |Y #142#60 = 2; |HAZ Termina; |FINSI;
          |SI enOrgPdto ! #19#133; |Y #142#60 =3; |HAZ Termina; |FINSI;
     |FINSI;

     |SI nSacaPan = 1;
          |PUSHV 0501 2380;
          |PINPA #0#0;
          |PINDA #0#0;
          |ENDATOS #1#0;
          |POPV;
     |FINSI;
|FPRC;

|PROCESO CalPreArt;
     |HAZ DecimalesBase;
     |HAZ CargaDatos;
     |HAZ CalPre;
     |HAZ Termina;
|FPRC;
