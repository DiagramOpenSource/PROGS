 piens042

|FICHEROS;
 vigz0010 #0;
 vigw0009 #1;
 agifa019 #2;
 agifa081 #3; ||cabecera pedidos compras;
 agifa067 #4; ||lineas pedidos compras;
 agifa060 #5; ||familias
 agifa010 #6;
 agifa071 #7;
 vigm0009 #8;
 agifa065 #9; ||historico;
 agifa007;
|FIN;

|VARIABLES;
&Tempo = "";
hoy = @00.00.0000;
hoy1 = "";
hoy2 = "";
linea = 0;
lin= 0;
&el_mes = 0;
&el_a¤o = 0;
&mes = 0;
&a¤o = 0;
dia = "";
dia1 = "";
fecha = "";
fecha1 = @00.00.0000;
fecha2 = @00.00.0000;
|FIN;

|PROCESO EsInterno;
     |ABRE #agifa007;
     #agifa007#26 = #agifa010#52;
     |LEE 000#agifa007.=;
     |CIERRA #agifa007;

     |SI #agifa007#37 = "S";
          FSalida = 0;
     |SINO;
          FSalida = 1;
     |FINSI;
|FPRC;

|PROCESO EsInternoHis;
     |ABRE #agifa007;
     #agifa007#26 = #agifa065#11;
     |LEE 000#agifa007.=;
     |CIERRA #agifa007;

     |SI #agifa007#37 = "S";
          FSalida = 0;
     |SINO;
          FSalida = 1;
     |FINSI;
|FPRC;

|PROCESO arti;
 |ABRE #5;
 #5#0 = #2#2;
 |LEE 010#5=;
 |LIBERA #5;
 |CIERRA #5;
 |SI #5#5 = "S";
   |ABRE #1;
   #1#0 = #0#0;
   #1#1 = #2#0;
   |LEE 010#1=;
   |SI FSalida ! 0;
     |DDEFECTO #1;
     #1#0 = #0#0;
     #1#1 = #2#0;
     || #1#3 = #2#6;
     #1#4 = #2#9;
     |GRABA 010#1n;
     |LIBERA #1;
   |FINSI;
   |CIERRA #1;
 |FINSI;
|FPRC;

|DEFBUCLE articulos;
#2#1;
;
INICIO;
FINAL;
be;
NULL,arti;
|FIN;

|PROCESO histo1;
     |HAZ EsInternoHis;
     |SI FSalida = 0; |ACABA; |FINSI;

|ABRE #1;
#1#0 = #0#0;
#1#1 = #9#0;
|LEE 010#1=;
|SI FSalida = 0;
  #1#2 = #1#2 + (#9#6*(-1));
  |GRABA 010#1a;
  |LIBERA #1;
|FINSI;
|CIERRA #1;
|FPRC;

|DEFBUCLE histor;
#9#1;
;
"                    ",fecha1,"SF",000001,00000,"     ";
"zzzzzzzzzzzzzzzzzzzz",fecha2,"SF",999999,99999,"zzzzz";
;
NULL, histo1;
|FIN;

|PROCESO stock1;
     |HAZ EsInternoHis;
     |SI FSalida = 0; |ACABA; |FINSI;

|ABRE #1;
#1#0 = #0#0;
#1#1 = #9#0;
|LEE 010#1=;
|SI FSalida = 0;
  #1#3 = #1#3 + #9#6;
  |GRABA 010#1a;
  |LIBERA #1;
|FINSI;
|CIERRA #1;
|FPRC;

|DEFBUCLE stock;
#9#1;
;
"                    ","01.01.1900","  ", 000001, 00000, "     ";
"zzzzzzzzzzzzzzzzzzzz",fecha2      ,"zz", 999999, 99999, "zzzzz";
;
NULL,stock1;
|FIN;

|PROCESO lipedi;
|SI #4#12 > 0;
  |ABRE #1;
  #1#0 = #0#0;
  #1#1 = #4#2;
  |LEE 010#1=;
  |SI FSalida = 0;
    #1#5 = #1#5 + #4#12;
    #1#6 = #1#6 + #4#11;
    |GRABA 010#1a;
    |LIBERA #1;
  |FINSI;
  |CIERRA #1;
|FINSI;
|FPRC;

|PROCESO pedi;
|SI #3#12 ! 0;
 |BUCLELIN 0lipedi#3;
|FINSI;
|FPRC;

|DEFBUCLE pedidos;
#3#1;
;
INICIO;
FINAL;
be;
NULL,pedi;
|FIN;

|PROCESO repaso1;
 linea = linea + 1;
 #1#6 = #1#6 / #1#5;
 #1#7 = #1#2 - #1#3 - #1#5;
 #1#10 = linea;
 |SI #1#7<0;
  #1#7 = 0;
 |FINSI;
 |GRABA 010#1a;
 |LIBERA #1;
|FPRC;

|DEFBUCLE repaso;
#1#1;
;
INICIO;
FINAL;
be;
NULL,repaso1;
|FIN;

|PROCESO linalba;
 |ABRE #1;
 #1#0 = #0#0;
 #1#1 = #7#2;
 |LEE 010#1=;
 |SI FSalida = 0;
   #1#2 = #1#2 + #7#5;
   |GRABA 010#1a;
   |LIBERA #1;
 |FINSI;
 |CIERRA #1;
|FPRC;

|PROCESO albar;
     |HAZ EsInterno;
     |SI FSalida ! 0;
          |BUCLELIN 0linalba#6;
     |FINSI;
|FPRC;


|DEFBUCLE albaran;
#6#7;
;
fecha1,"     ", 000001;
fecha2,"zzzzz", 999999;
be;
NULL,albar;
|FIN;


|PROGRAMA;
|CLS;
|HAZ CreaTempo; |NOME_DAT #1 Tempo;
|DELINDEX #1;
|PINPA #0#0;
|DDEFECTO #0;
hoy = ~;
hoy1 = hoy;
hoy2 = hoy1 % 402;
#0#0 = hoy2;
hoy2 = hoy1 % -104;
#0#1 = hoy2;
|PINDA #0#0;
|ENDATOS #1#0;
|SI FSalida = 0;
  |ABRE #8;
  #8#0 = #0#0;
  #8#1 = #0#1;
  |LEE 010#8=;
  |SI FSalida = 0;
    |MENAV "0000 ­ATENCION! Este mes ya ha sido calculado. Utilizar la opcion de Mantenimiento";
  |SINO;
   |SI #0#0< 10;
     dia = #0#0;
     |QBT dia;
     dia = "0"+dia; || aunque ponga dia es el mes
   |SINO;
     dia = #0#0; || aunque ponga dia es el mes
   |FINSI;
   dia1 = #0#1; || aunque ponga dia es el a¤o
   fecha = "01."+dia+"."+dia1;
   fecha1 = fecha;
   fecha = "31."+dia+"."+dia1;
   fecha2 = fecha;
   |BUCLE articulos;
   |BUCLE albaran;
   |BUCLE pedidos;
   |BUCLE histor;
   |BUCLE stock;
   linea = 0;
   |BUCLE repaso;
   el_mes = #0#0;
   el_a¤o = #0#1;
   |SUB_EJECUTA "vigw0009";
 |FINSI;
|FINSI;
|LIBERA #8;
|CIERRA #8;
|HAZ BoraTempo; |DELINDEX #1;
|FPRO;
