|FICHEROS;
     ibery011 #0;
     iberz012 #1;
     agifa019 #2;
     agifa029 #3;
     agifa501 #501;
     agifa502 #502;
     iber0016 #16;
     iber0017 #17;
     iber0018 #18;
     iber0019 #19;
     iber0020 #20;
|FIN;

|VARIABLES;
     &Tempo    = "";
     aTempo1   = "";
     aInforme  = "ibery011";
     dSerie    = "";
     hSerie    = "";
     dArt      = "";
     hArt      = "";
     aCentro   = "";
     fFecha    = @;
     nNume     = 0;
     nHay      = 0;
|FIN;

|PROCESO Temporal;
     |SI #1#6 ] #0#8; |Y #1#6 [ #0#9;
          #2#0 = #1#4;
          |LEE 000#2=;
          |SI FSalida ! 0; |DDEFECTO #2; |FINSI;

          #16#0 = #1#1;
          |LEE 000#16=;
          |SI FSalida ! 0; |DDEFECTO #16; |FINSI;

          #17#0 = #1#1;
          |LEE 000#17=;
          |SI FSalida ! 0; |DDEFECTO #17; |FINSI;

          nHay = 1;
          |PRINT;
     |FINSI;
|FPRC;

|DEFBUCLE Temporal;
     #1#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Temporal;
|FIN;

|PROCESO agifa502;
     #18#0 = aCentro;
     #18#1 = #502#2;
     |LEE 000#18=;
     |SI #18#5 < #0#6; |O #18#5 > #0#7; |ACABA; |FINSI;

     |DDEFECTO #1;
     #1#0 = #17#2;  || Tipo
     #1#1 = #17#0;  || Centro
     #1#2 = #18#5; || Seccion
     #1#4 = #502#2; || Art
     |LEE 101#1=;
     |SI FSalida ! 0; |GRABA 020#1b; |FINSI;

     #1#5 = #1#5 + #502#5;
     |SI #0#13 = "S";
          #1#6 = #1#6 + #502#7;
     |SINO;
          #1#6 = #1#6 + #502#21;
     |FINSI;

     |GRABA 020#1a;
     |LIBERA #1;
|FPRC;

|DEFBUCLE agifa502;
     #agifa502#1;
     ;
     #agifa501#36, #agifa501#0, 001;
     #agifa501#36, #agifa501#0, 999;
     ;
     NULL, agifa502;
|FIN;

|PROCESO agifa501;
     |SI #501#31 = "R"; |Y #0#10 = "N"; |ERROR; |ACABA; |FINSI;
     |SI #501#31 = "A"; |Y #0#11 = "N"; |ERROR; |ACABA; |FINSI;
     |SI #501#31 = "L"; |Y #0#12 = "N"; |ERROR; |ACABA; |FINSI;

     aCentro = #501#57 % 103;
     #17#0 = aCentro;
     |SI #17#0 < #0#0; |O #17#0 > #0#1; |ERROR; |ACABA; |FINSI;
     |LEE 000#17=;
     |SI #17#2 < #0#2; |O #17#2 > #0#3; |ERROR; |ACABA; |FINSI;

     |BUCLE agifa502;
|FPRC;

|DEFBUCLE agifa501;
     #501#3;
     ;
     #0#4, "      ", " ", dSerie, 000000;
     #0#5, "zzzzzz", "z", hSerie, 999999;
     ;
     NULL, agifa501;
|FIN;

|PROCESO iber0020;
     #17#0 = #20#0;
     |LEE 000#17=;
     |SI #17#2 < #0#2; |O #17#2 > #0#3; |ACABA; |FINSI;

     #18#0 = #17#0;
     #18#1 = #20#2;
     |LEE 000#18=;
     |SI #18#5 < #0#6; |O #18#5 > #0#7; |ACABA; |FINSI;

     |DDEFECTO #1;
     #1#0 = #17#2; || Tipo
     #1#1 = #17#0; || Centro
     #1#2 = #18#5; || Seccion
     #1#4 = #20#2; || Art
     |LEE 000#1=;
     |SI FSalida ! 0; |GRABA 020#1n; |FINSI;
|FPRC;

|DEFBUCLE iber0020;
     #20#1;
     ;
     #0#0, 01, dArt;
     #0#1, 99, hArt;
     ;
     NULL, iber0020;
|FIN;

|PROCESO Tipo3; |TIPO 3;

     ||ннн El Centro son los 3 primeros digitos de la serie !!!

     dSerie = ("000" + #0#0) % -103; dSerie = dSerie + "  ";
     hSerie = ("000" + #0#1) % -103; hSerie = hSerie + "zz";

     dArt = " " * 20;
     hArt = "z" * 20;

     nNume = #0#5 - #0#4;
     |SI nNume > 100;
          |MENAV "0000Periodo de Fechas demasiado grande...";
          |ACABA;
     |FINSI;

     |HAZ CreaTempo; aTempo1 = Tempo;
     |NOME_DAT #1 aTempo1; |DELINDEX #1;
     |ABRE #1;

     |IMPRE 0;
     |SI FSalida = 0;
          |INFOR aInforme;
          |SI FSalida = 0;
               |ABRE #17;
               |ABRE #18;
               |SI #0#8 [ 0;
                    |BUCLE iber0020;
               |FINSI;
               |BUCLE agifa501;
               |ABRE #16;
               |ABRE #2;
               |ABRE #3;
               |BUCLE Temporal;
               |CIERRA #3;
               |CIERRA #2;
               |CIERRA #16;
               |CIERRA #17;
               |CIERRA #18;
               |SI nHay ! 0; |PIEINF; |FINSI;
               |FININF;
          |FINSI;
          |FINIMP;
     |FINSI;

     |CIERRA #1;
     |DELINDEX #1; Tempo = aTempo1; |HAZ BoraTempo;
|FPRC;
