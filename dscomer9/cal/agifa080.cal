|FICHEROS;
     agifa080 #0;
     agifa077 #1;
     agifa019 #2;    || Articulos
     agifa112 #6;
     agifa017 #8;
     agifa007 #11;   || Fichero de series;
     agitp001 #12;   || Tarifas Actualizadas Proveedor / Articulo.
     agifa142 #142;  || Param. Gen.
     agifa321 #15;    || DIV - Parametros

     dsm00014 #914;
     dsm00010 #910;
     dsm00004 #904;
     dsm00005 #905;
     dsm00006 #906;
     dsw00045 #100;
     agifa561 #561;
     agifa029 #29;
     dsm00226 #226;
     dsm00237 #237;

     iber0113@ #113;
     referen@ #555;
     mecaw016@;
     desan001@;
     tlfm0001@;
     tlfm0019@;
     sanch001@;
|FIN;

|VARIABLES;
     &enRavePre = 0;
     nSwSebaLopez = 0;
     &enBultos = 0;
     nSwPideUni = 0;
     &eaGesMatri = "";         ||Modulo gesenvia
     &enSwAtras = 0;
     aArtBol = "";
     aPartBol = "";
     &enImpGesKit = 0;
     nEsta = 0;
     nSalida = 0;
     nSwPasa = 0;
     nTallerBorLin = 0;
     nSwTaller = 0;
     &eaHayIMEI = "";
     nCan = 0;
     nAlma = 0;
     aMecaDes = "";
     nMecaPre = 0;
     nMecaDto1 = 0;
     nMecaDto2 = 0;
     nMecaDto3 = 0;
     nUni = 0;
     nUniDesanch = 0;
     aParti = "";
     nSwMecaCreaLin = 0;
     aPath = "";
     nHay = 0;
     &enModoCab77 = 0;
     &enAlmaExpe = 0;
     nSal = 0;
     &eaModuloCon = "";
     &enDto = 0;
     nalmacen = 0;
     &eArtChampi = "";
     aPtec = "";
     nPtec = 0;
     nLin = 0;
     ||Variables Mod.Obras .....(Reysor)
     &prefot    = 0;
     &numfot    = 0;
     &modfot    = 0;
     &serfot    = "";
     &linfot    = 0;
     &canfot    = 0;
     &impfot    = 0;
     &artfot    = "";
     ||ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
     &eaModulo = "";

     &Tempo    = "";
     aAlfa     = "";
     &enSwIber = 0;
     &Envase    = "";
     &Unidades1 = 0;
     &Unidades2 = 0;
     &VArticulo = "";
     nNume      = 0;
     nModo      = 0;
     nPrecio         = 0;
     nForma          = 0;

     &nDeci_Base     = 0;   || Decimales en Totales de la moneda base
     &nDeci_PreBase  = 0;   || Decimales en el Precio en moneda base
     &nDeci_BaseMx   = 0;   || Decimales en Totales de la moneda base (Maxima precision)
     &nDeci_PreBaseMx= 0;   || Decimales en el Precio en moneda base (Maxima precision)
     &nDeci_Div      = 0;   || Decimales en Totales de la divisa
     &nDeci_PreDiv   = 0;   || Decimales en el Precio en divisa
     &nDeci_TotVis   = 0;   || Decimales en Totales visibles (el de la moneda de trabajo)
     &nDeci_TotNoVis = 0;   || Decimales en Totales no visibles (el de la otra moneda)
     &nDeci_PreVis   = 0;   || Decimales en el Precio visual. (lineas)
     &nDeci_ImpVis   = 0;   || Decimales en el Importe visual. (lineas)
     tecla      = "";
     &ac_divisa = ""; ||
     mensa      = ""; || Linea de visualizacion
     &pintado   = 0;|| Controla el pintado de mensa para que solo lo haga 1 vez
     titdiv = "";   || Encabezado de precio e imp. con la divisa "Imp.Tot(USD)"
     precio = 0;
     forma = 0;
     dto1 = 0;
     dto2 = 0;
     alfa = "";
     Unidades = 0;
     asto = 0;
     salida    = 0;
     descu = 0;
     imneto = 0;
     tf = 0;
     modo = 0;
     articulo = " ";
     fmes = "  ";
     mes = 0;
     mensaje3 = "";
     a = 0;
     sto = 0;
     vacio = "                    ";
     previo = 0;
     de = 0;
     pm = 0;
     pe = 0;
     m1 = 0;
     m2 = 0;
     m3 = 0;
     canti2 = 0;
     mes1 = 0;
     modo1 = 0;
     &n_dec = 0;
     &n_pre = 0;
     neto = 0;
     &def_alm = 0;
     &recoge   = "";     || Viene de agifa077
     campo = 0;
     mensaje5 = "0000 Albaran para exportacion Tipo iva = 0 !!";
     expor = "";

     serie     = "";
     serie_o   = "";
     albaran   = 0;
     albaran_o = 0;

     alfa1     = "";
     alfa2     = "";
     fiac      = "  ";
     guarda    = "  ";
     relleno   = "                                       ";
     aponer    = "  ";
     nerror    = 0;
     &LineaD  = 0;   || Lo utilizo en solis008
     nlinea    = 0;
     i         = 0;
     aprograma = "";
     impret = 0;
     &c_prove   = "";
     &c_artic   = "";
     &c_serie   = "";
     &entrada   = 0;
     inkey      = 0;
     &codiBarra = "";
     &r_arti    = "";
     &aRecoge      = "N";
     &aModalidad   = "C";  || Compras
     &aProceso     = "agifa080";
     nHayPrecio    = 0;
     aCentro       = "";
     aModi6        = "";
     aModi30       = "";
     aDef          = "";
     nSwPreIber    = 0;
     nSwGesenvia = 0;

     aSer                = "";
     nNum                = 0;
     nLinOrg             = 0;
     nSwSanchez          = 0;
     j                   = 0;
|FIN;

|INCLUYE i_varart;
|INCLUYE i_cdbarr;
|INCLUYE i_semana;

ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄModulo 004159ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
|PROCESO UltLinAlbCom;
     |SALVA_FICHA #agifa080;
     aSer = #agifa080#27;
     nNum = #agifa080#0;
     #agifa080#1 = 999;
     |LEE 000#agifa080.];
     |SI FSalida = 0;
          |LEE 000#agifa080.a;
     |SINO;
          |LEE 000#agifa080.u;
     |FINSI;
     |SI FSalida = 0; |Y #agifa080#27 = aSer; |Y #agifa080#0 = nNum;
          nLin = #agifa080#1 + 1;
     |SINO;
          nLin = 1;
     |FINSI;
     |REPON_FICHA #agifa080;
|FPRC;

|PROCESO Sanchez80; |TIPO 6;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo ! 1; |ACABA; |FINSI;

     |HAZ EsSanchez;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |DDEF aDef;
     aDef = aDef + "sanch001";
     |CARGA_DEF aDef, sanch001@;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |ABRE #sanch001@;
     #sanch001@#0 = #agifa080#2;
     |LEE 000#sanch001@.=;
     |SI FSalida = 0;
          nLinOrg = 0;
          |PARA i = 1; |SI i [ 6; |HACIENDO i = i + 1;
               j = i + 6;
               |SI #sanch001@#i# ! 0;
                    |SI nLinOrg = 0;
                         nLinOrg = #agifa080#1;
                         #agifa080#6 = #sanch001@#i#;
                         #agifa080#30 = #sanch001@#i#;
                         #agifa080#11 = #sanch001@#j#;
                         #agifa080#39 = nLinOrg;
                         |HAZ TotalLin80;
                         |GRABA 020#agifa080.n;
                    |SINO;
                         |HAZ UltLinAlbCom;
                         #agifa080#1 = nLin;
                         #agifa080#3 = 0;
                         #agifa080#6 = #sanch001@#i#;
                         #agifa080#30 = #sanch001@#i#;
                         #agifa080#11 = #sanch001@#j#;
                         #agifa080#39 = nLinOrg;
                         |HAZ TotalLin80;
                         |HAZ liacartiC;
                         |GRABA 020#agifa080.n;
                    |FINSI;
               |FINSI;
          |SIGUE;
          |SI nLinOrg ! 0;
               #agifa080#1 = nLinOrg;
               |LEE 121#agifa080.=;
          |FINSI;
          |PTEC 809;
          |PTEC 816;
          |PTEC 814;
          |PTEC 815;
          |PONCONTROL 23, "SI";
     |FINSI;
     |CIERRA #sanch001@;
     |DESCARGA_DEF #sanch001@;
|FPRC;

|PROCESO BajaSanchez;
     |SI nSwSanchez ! 0; |ACABA; |FINSI;
     nSwSanchez = 1;

     |DDEF aDef;
     aDef = aDef + "sanch001";
     |CARGA_DEF aDef, sanch001@;
     |SI FSalida ! 0; |ACABA; |FINSI;
     |ABRE #sanch001@;
     #sanch001@#0 = #agifa080#2;
     |LEE 000#sanch001@.=;
     |SI FSalida = 0;
          aSer = #agifa080#27;
          nNum = #agifa080#0;
          |PARA; |SI FSalida = 0; |Y #agifa080#3 = 0; |Y aSer = #agifa080#27; |Y nNum = #agifa080#0; |HACIENDO;
               |LEE 000#agifa080.a;
          |SIGUE;
          nLinOrg = #agifa080#1;
          |LEE 000#agifa080.s;
          |PARA; |SI FSalida = 0; #agifa080#3 = 0; |Y #agifa080#2 = #sanch001@#0;
                      |Y aSer = #agifa080#27; |Y nNum = #agifa080#0; |HACIENDO;
               |HAZ liacartiC;
               |BORRA 020#agifa080.a;
               |LEE 000#agifa080.s;
          |SIGUE;
          #agifa080#1 = nLinOrg;
          |LEE 121#agifa080.=;
          |PONCONTROL 23, "SI";
          |PTEC 808;
     |FINSI;
     |CIERRA #sanch001@
     |DESCARGA_DEF #sanch001@;
     nSwSanchez = 0;
|FPRC;

|PROCESO MiraSanchez;
     |SI nSwSanchez ! 0; |ACABA; |FINSI;

     |DDEF aDef;
     aDef = aDef + "sanch001";
     |CARGA_DEF aDef, sanch001@;
     |SI FSalida ! 0; |ACABA; |FINSI;
     |ABRE #sanch001@;
     #sanch001@#0 = #agifa080#2;
     |LEE 000#sanch001@.=;
     |SI FSalida = 0;
          nSwSanchez = 1;
     |FINSI;
     |CIERRA #sanch001@
     |DESCARGA_DEF #sanch001@;
|FPRC;
ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ

|PROCESO Tipo80_3; |TIPO 3;
     |HAZ EsQDClor;
     |SI FSalida = 0; |Y #0#18 = "S";
          eaSerie = #0#27;
          enCodigo = #0#0;
          enLinea = #0#1;
          eaTipo = "C";
          eaArticulo = #0#2;
          eaPartida = #0#37;
          |SUB_EJECUTA_NP "qdclor10;VER";
          #0#18 = eaTipo;
     |FINSI;

     |SI #agifa142#207 = "S";
          aTipoDA = "A"; |HAZ AltaDAC;
     |FINSI;

     nModo = (FEntrada/ 100) ! 0;
     |SI nModo = 1;
          |HAZ EsDesanch;
          |SI FSalida = 0;
               |HAZ Desan080;
          |FINSI;
     |FINSI;

     |HAZ EsExtintor;
     |SI FSalida = 0;
          eaArticulo = #0#2;
          efFecha = #1#1;
          eaSerie = #0#27;
          enCodigo = #0#0;
          enLinea = #0#1;
          enModo = nModo;
          |SUB_EJECUTA_NP "extz0015;CREA";
     |FINSI;
|FPRC;

|PROCESO iber0113;
     nHayPrecio = 1;
     nPrecio = #113#4;
     |ERROR10;
|FPRC;

|DEFBUCLE iber0113;
     #113#1004;
     ;
     aCentro, #1#3, #0#2, #0#43;
     aCentro, #1#3, #0#2, #0#43;
     ;
     NULL, iber0113;
|FIN;

|PROCESO NoEntra; |TIPO 7;
     |SI #142#164 = "D";
          |HAZ EsIber21;
          |SI enSwIber = 0;
               |C_M #0#6, 1, aModi6;
               |C_M #0#30, 1, aModi30;
               |DDEF aDef;
               aDef = aDef + "iber0113";
               |CARGA_DEF aDef, iber0113@;
               |SI FSalida = 0;
                    |DFICE aCentro;
                    aCentro = aCentro % -403;
                    nHayPrecio = 0;
                    |BUCLE iber0113;
                    |SI nHayPrecio = 1;
                         #0#6 = nPrecio;
                         #0#30 = nPrecio;
                         |C_M #0#6, 1, "N";
                         |C_M #0#30, 1, "N";
                    |SINO;
                         aCentro = 0;
                         |BUCLE iber0113;
                         |SI nHayPrecio = 1;
                              #0#6 = nPrecio;
                              #0#30 = nPrecio;
                              |C_M #0#6, 1, "N";
                              |C_M #0#30, 1, "N";
                         |FINSI;
                    |FINSI;
                    |DESCARGA_DEF #iber0113@;
               |SINO;
                    aDef = "0000Error al cargar " + aDef;
                    |MENAV aDef;
               |FINSI;
          |FINSI;
     |FINSI;

     |HAZ EsGesenvia;
     |SI FSalida = 0;
          |C_M #0#6, 1, aModi6;
          |C_M #0#30, 1, aModi30;
          eaArticulo = #0#2; |HAZ EsKit;
          |SI FSalida = 0;
               |C_M #0#6, 1, "N";
               |C_M #0#30, 1, "N";
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO PrecioIber;
     |SI #0#6 = 0; |Y #142#164 = "D";
          |HAZ EsIber21;
          |SI enSwIber = 0;
               |DDEF aDef;
               aDef = aDef + "iber0113";
               |CARGA_DEF aDef, iber0113@;
               |SI FSalida = 0;
                    aCentro = 999;
                    nHayPrecio = 0;
                    |BUCLE iber0113;
                    |SI nHayPrecio = 0;
                        nSwPreIber = 1;
                    |FINSI;
                    |DESCARGA_DEF #iber0113@;
               |SINO;
                    aDef = "0000Error al cargar " + aDef;
                    |MENAV aDef;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO civaalb;
     inkey = FSalida;
     |SI inkey = 14;
           c_prove = #1#3;      || Corregido Por VIC esta mal. antes #0#2
           c_artic = #0#2;      || Corregido Por VIC esta mal. antes #1#3
           c_serie = #1#50;
           entrada = 1;
          |SUB_EJECUTA_NP "agifa383.run";
          |ERROR;
          inkey = 0;
     |FINSI;
     |SI inkey = 15;
          eaPrv = #1#3;
          enTiva = #0#11;
          efFiva = #1#1;
          |HAZ IVAPrv;
          #0#6 = #0#6 / (1 + enIva/100);
          |HAZ visual_precio;
     |FINSI;
|FPRC;

|PROCESO licogeas;|TIPO 0;
     |HAZ EsRavenida;
     |SI FSalida = 0;
          |HAZ RaveLinea;
          |SI FSalida = 0; |ERROR; |ACABA; |FINSI;
     |FINSI;

     nModo = (FEntrada / 100) ! 0;
     articulo = #0#2;
     nalmacen = #0#3;
     aArtBol = #0#2;
     aPartBol = #0#37;
     |SI aModi6 = "";            || Solo al entrar
          |C_M #0#6, 0, aModi6;
          |C_M #0#30, 0, aModi30;
     |FINSI;
     |SI nModo = 1;
          |HAZ EsGesenvia;
          |SI FSalida = 0;
               eaSerie = #0#27;
               enCodigo = #0#0;
               enLinea = #0#1;
               eaArticulo = #0#2;
               |SUB_EJECUTA_NP "gesem001;DEFE";
               |HAZ PinGese80;
          |FINSI;
     |FINSI;
|FPRC;


|PROCESO totlis;|TIPO 0;
     |HAZ TotalLin80;
     |HAZ visual_importe;
|FPRC;

|PROCESO Envase80;
     Envase    = #0#34;
     Unidades1 = #0#35;
     Unidades2 = #0#5;
     VArticulo = #0#2;
     enAlmacen = #0#3;
     eaTipo = "C";
     eaProgEnv = "albaran";
     |HAZ EntraEnvase;

     |HAZ EsChampi;
     |SI FSalida = 0;
          |SI enBultos = 0;
               #0#34 = Envase;
               #0#35 = Unidades1;
               #0#5  = Unidades2;  |PINTA #0#5;
          |FINSI;
     |SINO;    || la estandar
          #0#34 = Envase;
          #0#35 = Unidades1;
          #0#5  = Unidades2;  |PINTA #0#5;
     |FINSI;
|FPRC;

|PROCESO Conversion;  |TIPO 7;
     nModo = (FEntrada / 100) ! 0;
     aAlfa = "0000<F5> Envases";
     |HAZ EsDesanch;
     |SI FSalida = 0;
          aAlfa = "0000<F2> Ofertas   <F5> Envases";
     |FINSI;
     |MENSA aAlfa;

     |SI nSwMecaCreaLin ! 0;
          |ACABA;
     |FINSI;

     |HAZ EsSebaLopez;
     nSwSebaLopez = FSalida;
     |SI FSalida = 0;
          eaSerie = #0#27;
          enCodigo = #0#0;
          enLinea = #0#1;
          eaArticulo = #0#2;
          |SUB_EJECUTA_NP "sebalo05";
          #0#5 = enUnidades; |PINTA #0#5;
          |C_M #0#5, 1, "N";
     |FINSI;

     |HAZ EsSematel;
     |SI FSalida = 0;
          enModo = (FEntrada / 100) ! 0;
          eaArticulo = #0#2;
          enAlmacen = #0#3;
          eaDes = #0#4;
          eaDesp = #1#4;
          eaProve = #1#3;
          efFecha = #1#1;
          eaSerie = #0#27; enCodigo = #0#0; enLinea = #0#1;
          |SUB_EJECUTA_NP "tlfw0001";
          |SI eaHayIMEI = "S";
               |C_M #0#5, 1, "N";
               #0#5 = enUnidades; |PINTA #0#5;
               |ACABA;
          |FINSI;
     |FINSI;

     |HAZ EsChampi;
     |SI FSalida = 0;
          eaTipo = "AC";
          eaSerie = #0#27;
          enCodigo = #0#0;
          enLinea = #0#1;
          eaArticulo = #0#2;
          |SUB_EJECUTA_NP "champ003";
          |HAZ ChampiPinAux;
          |SI enBultos ! 0; #0#5 = enUnidades; |FINSI;
          |SI nModo = 1;
               |ABRE #6;
               #6#0 = #1#3;
               |LEE 000#6=;
               |CIERRA #6;
               fFecha = #1#1; |HAZ CalculaSemana; |HAZ DiaSemana;
               aAlfa = ("00" + nSemana) % -102;
               aAlfa = aAlfa + (("00" + nDiaSemana) % -102);
               aAlfa = aAlfa + (#6#59 % 104);
               #0#37 = aAlfa;
          |FINSI;
     |FINSI;
     |HAZ EsChampiEmar;
     |SI FSalida = 0;
          eaTipo = "AC";
          eaSerie = #0#27;
          enCodigo = #0#0;
          enLinea = #0#1;
          eaArticulo = #0#2;
          |SUB_EJECUTA_NP "champi03;COMPRAS";
          |HAZ ChampiPinEmar;
          #0#5 = enUnidades;
     |FINSI;
     |HAZ EsAlbadis;
     |SI FSalida = 0;
          eaDocu = "AC";
          eaSerie = #0#27;
          enCodigo = #0#0;
          enLinea = #0#1;
          eaArticulo = #0#2;
          eaProve = #1#3;
          enPrecio = #0#6;
          eaDivisa = #1#56;
          eaEnvase = #agifa142#72;
          |HAZ BseEntraUniC;
          #0#5 = enUnid1;
          #0#36 = enUnid2;
          #0#6 = enPrecio;
          #0#34 = Envase;
          #0#35 = enUnid3;
          |C_M #0#5, 1, "N";
     |FINSI;
     eaDocu = "agifa080"; ||?

     nSwPideUni = 0;
     |SI enModoCab77 = 1;
          |HAZ EsBerria;
          |SI FSalida = 0;
               nSwPideUni = 1;
          |FINSI;
     |FINSI;

     ||ÄÄÄÄÄÄÄÄÄÄÄÄ Doble/MultiÄ
     eaProgCom = "agifa077";
     |SI nSwPideUni = 0;
          |HAZ DobleUni;
          |SI eaSw2Stock = "S";
               |C_M #0#5, 1, "N";
          |FINSI;
     |FINSI;

     |SI nSwSebaLopez = 0; |ACABA; |FINSI;

     |SI #agifa142#72 = "S";
          |HAZ Envase80;
          |C_M #0#5, 1, "S";
          |SI enEntraEnvase ! 0;  |C_M #0#5, 1, "N";  |FINSI;
     |FINSI;
     |HAZ EsQDClor;
     |SI FSalida = 0;
          |HAZ Boletin;
     |FINSI;
|FPRC;

|PROCESO GrabaElemento;
     |ABRE #914;
     #914#0 = eaEleme;
     |LEE 000#914=;
     |CIERRA #914;

     |ABRE #905;
     |DDEFECTO #905;
     #905#0 = "AC";
     #905#1 = #0#27;
     #905#2 = #0#0;
     #905#3 = #0#1;
     #905#4 = eaEleme;
     #905#5 = #914#1;
     #905#6 = #0#5;
     #905#7 = #0#32;
     #905#8 = #905#6 * #905#7;
     #905#11 = #0#5;
     |GRABA 020#905n;

     |DDEFECTO #904;
     |ABRE #904;
     #904#0 = #0#2;
     #904#1 = #0#3;
     #904#2 = eaEleme;
     |LEE 101#904=;
     |SI FSalida ! 0; |GRABA 020#904b; |FINSI;
     #904#3 = #914#1;
     |SI #1#42 = "N";
          #904#12 = #904#12 + #0#5;
          #904#13 = #904#13 + #0#5;
     |SINO;
          #904#12 = #904#12 + #0#5;
          #904#13 = #904#13 + #0#5;
     |FINSI;
     nNume = #904#12 - #904#6;
     |SI nNume > 0;
          #904#24 = nNume * #2#9;
     |SINO;
          #904#24 = 0;
     |FINSI;
     |GRABA 020#904a;
     |ABRE #906;
     #906#0 = #0#2;
     #906#1 = #0#3;
     #906#2 = #1#1;
     #906#3 = "AC";
     #906#4 = #0#27;
     #906#5 = #0#0;
     #906#6 = #0#1;
     #906#7 = eaEleme;
     #906#8 = #914#1;
     #906#9 = #0#5;
     #906#10= #0#30;
     |GRABA 020#906n;
     |CIERRA #906;
|FPRC;

|PROCESO liacartiC;|TIPO 2;
     ||MODULO aprograma;           quitado segun tiquet 3068/391
     ||SI aprograma ! "agifa077";  13 de septiembre de 2010
     ||    FEntrada = 101;
     ||FINSI;

     modo   = (FEntrada / 100) !0;
     nForma = 0 +. 1;

     |HAZ EsTaller; nSwTaller = FSalida;

     |SI nSwTaller = 0;
          |SI #0#50 = -1; |Y enModoCab77 ! 3;
               |SI nForma = -1;
                    |MENAV "0000Linea canon de articulo, no se puede modificar";
               |FINSI;
               |ERROR; |ACABA;
          |FINSI;
     |FINSI;

     |SI modo = 1; |O modo = 2; |Y nForma = 1;
          |HAZ EsIber21;
          |SI FSalida = 0;
               nSwPreIber = 0;
               |HAZ PrecioIber;
               |SI nSwPreIber = 1;
                    || quitado el chequeo por R.AURA 27.12.2001
                    ||MENAV "0000Es obligatorio informar el precio";
                    ||ERROR;
                    ||ACABA;
               |FINSI;
               |HAZ MinimoIber;
          |FINSI;
     |FINSI;
     |SI modo = 2;|O modo = 3;
          efFec = #1#1;
          enAlma = #0#3;
          |HAZ MiraHisL;
          |SI enErrHis ! 0;
               |ERROR;
               |ACABA;
          |FINSI;
     |FINSI;
     |SI #0#19 = "S";  |O #1#38 = "S";
         |SI nForma < 0;
             |SI #0#19 = AS;
                 |MENAV "0000Esta linea proviene de un Pedido (use la opcion adecuada)";
             |FINSI;
             |SI #1#38 = AS;
                 |MENAV "0000Este albaran esta FACTURADO";
             |FINSI;
         |FINSI;
         |ERROR;
        |ACABA;
     |FINSI;
     |HAZ EsConstru;
     |SI FSalida = 0;
          |SI eaModuloCon ! "goalbpa1";
               enModo = modo;
               eaSerie = #0#27;
               enCodigo = #0#0;
               enLinea = #0#1;
               enUnidades = #0#5;
               enDto1 = #0#8;
               enDto2 = #0#26;
               enDto3 = #0#45;
               enDto = 0;
               enPrecio = #0#6;
               |SUB_EJECUTA_NP "guerz061";
               |SI enError ! 0; |ERROR; |ACABA; |FINSI;
          |FINSI;
          |SI modo = 3;
               enError = 0;
               |HAZ CheqSubcon1;
               |SI enError ! 0; |ERROR; |ACABA; |FINSI;
          |FINSI;
     |FINSI;

     |HAZ EsSanchez;
     |SI FSalida = 0;
          |SI modo = 3; |Y enModoCab77 ! 3;
               |HAZ BajaSanchez;
          |FINSI;
          |SI modo = 2;
               |HAZ MiraSanchez;
               |SI nSwSanchez ! 0;
                    nSwSanchez = 0;
                    |SI nForma = - 1;
                         |MENAV "0000Modificacion no permitida, de debaja la linea...";
                    |FINSI;
                    |ERROR; |ACABA;
               |FINSI;
          |FINSI;
     |FINSI;

     enForma = 0 +. 1;

     |HAZ EsTaller;
     |SI FSalida = 0;
          |HAZ EsGuerola;
          |SI FSalida ! 0;    || Cuando es Guerola no tiene que salir
               |HAZ TallerSecCom;
          |FINSI;
     |FINSI;

     imneto = #0#9 < #1#5;
     imneto = imneto < #1#32;
     imneto = imneto < #1#7;

     ||ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
     |SI codiBarra = "S"; |Y nModo = 1; |Y enForma = 1; |Y #2#176 = "S";
          |HAZ GrabaElemento;
     |FINSI;
     ||ÄÄÄÄÄÄÄÄÄÄÄÄ Doble/MultiÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
     eaDocu = "agifa080";
     |HAZ StockEntra;
     enTipEnvase = 2;
     |HAZ Envase80;

     |HAZ CalCabAgifa077;

     |HAZ EsConstru;
     |SI FSalida = 0;
          |HAZ ConstruPreParti;
     |FINSI;

     |HAZ EsSematel;
     |SI FSalida = 0;
          |HAZ HistoIMEI;
     |FINSI;

     |SI modo = 3;
          ||ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
          |HAZ EsAlbadis;
          |SI FSalida = 0;
               eaDocu = "AC";
               eaSerie = #0#27;
               enCodigo = #0#0;
               enLinea = #0#1;
               |HAZ BseBorraUni;
          |FINSI;

          eaTipo      = "AC";
          eaSerie     = #0#27;
          enCodigo    = #0#0;
          enLinea     = #0#1;
          efFecha     = #1#1;
          eaAbono     = #1#42;
          enTarifa    = 0;
          eaArticulo   = #0#2;
          enAlmacen    = #0#3;
          |SUB_EJECUTA_NP "dsz00002;BAJA";

          |HAZ BorraKit;

          |SI #agifa142#207 = "S";
               aTipoDA = "A"; |HAZ BajaDAC;
          |FINSI;
          |HAZ EsViarsa;
          |SI FSalida = 0;
               |HAZ ViaBajaAlbCom;
          |FINSI;
          |HAZ EsCampoJerez;
          |SI FSalida = 0;
               |HAZ CpjBajaAlbCom;
          |FINSI;

          |HAZ EsSematel;
          |SI FSalida = 0;
               enModo = 3;
               eaSerie = #0#27; enCodigo = #0#0; enLinea = #0#1;
               |SUB_EJECUTA_NP "tlfw0001";
          |FINSI;

          |HAZ EsSebaLopez;
          |SI FSalida = 0;
               eaSerie = #0#27;
               enCodigo = #0#0;
               enLinea = #0#1;
               |SUB_EJECUTA_NP "sebalo05;BORRA";
          |FINSI;
          |HAZ EsQDClor;
          |SI FSalida =0;
               eaSerie = #0#27;
               enCodigo = #0#0;
               enLinea = #0#1;
               eaTipo = "C";
               eaArticulo = #0#2;
               eaPartida = #0#37;
               |SUB_EJECUTA_NP "qdclor10;BAJA";
          |FINSI;
          |HAZ EsGesenvia;
          |SI FSalida = 0;
               eaSerie = #0#27;
               enCodigo = #0#0;
               enLinea = #0#1;
               eaArticulo = #0#2;
               |SUB_EJECUTA_NP "gesem001;BAJA";
          |FINSI;
          |HAZ EsExtintor;
          |SI FSalida = 0;
               eaSerie = #0#27;
               enCodigo = #0#0;
               enLinea = #0#1;
               |SUB_EJECUTA_NP "extz0015;BAJA";
          |FINSI;
          |HAZ EsGesisat;
          |SI FSalida = 0;
               |HAZ GesiBorMaqui;
          |FINSI;
     |FINSI;

     |HAZ EsInforAlba;
     |SI FSalida = 0; |HAZ InforActMatri; |FINSI;

     |HAZ EsGesisat;
     |SI FSalida = 0; |HAZ GesiActMaqui; |FINSI;

     |SI nSwTaller = 0; |HAZ TallerCanon80; |FINSI;

     |HAZ pantcomp;

     |SI nForma = 1; |HAZ Obras; |FINSI;

     |HAZ EsDesanch;
     |SI FSalida = 0;
          |HAZ ActDesanch80;
     |FINSI;
|FPRC;

|PROCESO Obras;
     |HAZ EsReysor;
     |SI FSalida = 0;
         modfot = (FEntrada / 100) ! 0;
         serfot = #0#27;
         numfot = #0#0;
         linfot = #0#1;
         canfot = #0#5;
         impfot = #0#9;
         artfot = #0#2;
         prefot = #0#30;
         |SUB_EJECUTA_NP "obras016";
     |FINSI;
|FPRC;

|PROCESO agitp001;
     |PARA i = 0; |SI i [ 9; |HACIENDO i = i + 1;
          #100i = #12i;
     |SIGUE;
     |GRABA 020#100n;
|FPRC;

|DEFBUCLE agitp001;
     #12#1;
     ;
     #1#3, "                    ";
     #1#3, "zzzzzzzzzzzzzzzzzzzz";
     ;
     NULL, agitp001;
|FIN;

|PROCESO art6alc;
     modo = (FEntrada / 100)  ! 0;
     r_arti = "";
     inkey = salida;
     |SI codiBarra = "S"; |Y modo = 1;
          eaArti = #0#2;

          |HAZ HallaArti;
          |SI eaArti = ""; |Y #910#19 = "S"; |ERROR; |ACABA; |FINSI;
          |SI #2#176 = "S"; |Y eaEleme = "";
               |MENAV "0000Codigo incompleto...";
               |ERROR; |ACABA;
          |FINSI;
          |SI eaArti ! ""; #0#2 = eaArti; |FINSI;
     |FINSI;
     |SI inkey = 10;
          |SI #142#74 = "T";
               |ABRE #2;
               |SELECT #6#2;
               #2#134 = #0#2;
               |LEE 000#2];
               |CONSULTA_CLAVE #6#2;
               |SI FSalida = 0;
                    #0#2 = #2#0;
                    #0#4 = #2#1;
                    |PINTA #0#2;
                    |PINTA #0#4;
               |SINO;
                    |ERROR;
               |FINSI;
               |CIERRA #2;
          |SINO;
               |HAZ CreaTempo; |NOME_DAT #100 Tempo; |DELINDEX #100;
               |ABRE #100;
               |BUCLE agitp001;
               #100#0 = #1#3;
               #100#1 = #0#2;
               |LEE 000#100];
               |CONSULTA_CLAVE #1#100;
               |SI FSalida = 0;
                    #0#2 = #100#1;
                    #0#4 = #100#7;
                    |PINTA #0#2;
                    |PINTA #0#4;
               |SINO;
                    |ERROR;
               |FINSI;
               |CIERRA #100;
               |DELINDEX #100; |HAZ BoraTempo;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO nomodif5; |TIPO 0;
     |QBF r_arti;
     |SI r_arti ! "";
          #0#2 = r_arti;
          |PINTA #0#2;
     |FINSI;
     modo = (FEntrada / 100) ! 0;
     |SI modo = 1;
          #0#3 = def_alm;
          ||ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
          |HAZ EsConstru;
          |SI FSalida = 0;
               eaSerie = #0#27;
               |HAZ ConstruDefAlma;
               #0#3 = enAlmacen;
               |SI enAlmaExpe ! 0; #0#3 = enAlmaExpe; |FINSI;
          |FINSI;
          ||ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
          |PINTA #0#3;
     |FINSI;
     |SI #0#2 = vacio;
          |CAMPO_MODIFICA #0#3,  1, "N";
          |CAMPO_MODIFICA #0#5,  1, "N";
          |SI #1#58 = "B"; || Si la moneda de trabajo es la moneda base
            |CAMPO_MODIFICA #0#6,  1, "N";
          |SINO;
            |CAMPO_MODIFICA #0#30,  1, "N";
          |FINSI;
          |CAMPO_MODIFICA #0#8,  1, "N";
          |CAMPO_MODIFICA #0#26,  1, "N";
          |CAMPO_MODIFICA #0#45,  1, "N";
          |CAMPO_MODIFICA #0#10, 1, "N";
          |CAMPO_MODIFICA #0#11, 1, "N";
     |SINO;
          |CAMPO_MODIFICA #0#3,  1, "S";
          |CAMPO_MODIFICA #0#5,  1, "S";
          |SI #1#58 = "B";
            |CAMPO_MODIFICA #0#6,  1, "S";
          |SINO;
            |CAMPO_MODIFICA #0#30,  1, "S";
          |FINSI;
          |CAMPO_MODIFICA #0#8,  1, "S";
          |CAMPO_MODIFICA #0#26,  1, "S";
          |CAMPO_MODIFICA #0#45,  1, "S";
          |CAMPO_MODIFICA #0#10, 1, "S";
          |CAMPO_MODIFICA #0#11, 1, "S";
     |FINSI;
|FPRC;

|PROCESO decim; |TIPO 6;
     nSalida = FSalida;
     |SI FSalida = 13;
          enTipEnvase = 1;
          |HAZ Envase80;
     |FINSI;
     #0#5 = #0#5 ! n_dec;
     |PINTA #0#5;
     |ABRE #2;
     #2#0 = #0#2;
     |LEE 000#2=;
     |CIERRA #2;
     |SI #0#5 < #2#212; |Y #0#5 > 0;
          aAlfa = "0000Unidades Minimas Compra " + #2#212;
          |MENAV aAlfa;
          |ERROR; |ACABA;
     |FINSI;

     |HAZ EsDesanch;
     |SI FSalida = 0;
          |HAZ DesanchUni;
          eaDocu = "agifa080";
          |SI nSalida = 10;
               |HAZ DesanOfeCon;
               |ERROR; |ACABA;
          |SINO;
               |SI #0Campo = Contenido; |ACABA; |FINSI;
               enPrecio = #0#6;
               enPreDiv = #0#30;
               enDto1 = #0#8;
               enDto2 = #0#26;
               enDto3 = #0#45;
               |HAZ DesanOferta;
          |FINSI;
          #0#6 = enPrecio;
          #0#30 = enPreDiv;
          #0#8 = enDto1;
          #0#26 = enDto2;
          #0#45 = enDto3;
          |PINTA #0#8;
          |PINTA #0#26;
          |PINTA #0#45;
          |HAZ upc_div;
     |FINSI;
|FPRC;

|PROCESO decim1;
     |SI #2#176 = "S";
          |SI codiBarra = "N"; |O modo ! 1;
               |SI #1#58 = "D";  || Si la moneda de trabajo es la divisa ...
                    #0#30 = nPrecio;
               |SINO;
                    #0#6  = nPrecio;
               |FINSI;
          |FINSI;
     |FINSI;

     |SI #1#58 = "D";  || Si la moneda de trabajo es la divisa ...
         #0#6 = #0#30 / #1#57 * #1#62;  || ... recalculo en funcion de la divisa
     |SINO;
         #0#30 = #0#6 / #1#62 * #1#57; || .. recalculo en funcion de la moneda base
     |FINSI;

     |HAZ visual_precio; || Visualiza el precio
     ||ÄÄÄÄÄÄÄÄÄÄÄÄ Doble/MultiÄ
     eaDocu = "agifa080";
     |HAZ PintaUniMediC;
|FPRC;

|| *********************** *(1)
|PROCESO leeotroC; |TIPO 11;
     inkey = FSalida;
     modo = (FEntrada/100) !0;

     ||ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
     |HAZ EsAlbero;
     |SI FSalida = 0;
          |HAZ AlbeAlbComLin2;
     |FINSI;
     ||ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
     |SI inkey = 10;     ||F2
          |HAZ MenuTrack80;
          |SI FSalida = 0; |ERROR; |ACABA; |FINSI;
          inkey = FSalida;
     |FINSI;
     |SI inkey = 9;
          |PUSHV 0101 2380;
          |CLS;
          |PINPA #0#1;
          |PINDA #0#1;
          |PAUSA;
          |POPV;
          |ERROR;
          Control = "agifa080";
     |FINSI;

     |SI inkey = 14;
          |SI modo = 1;
              c_artic = "";
          |SINO;
              c_artic = #0#2;
          |FINSI;
          c_prove = #1#3;
          c_serie = #1#50;
          entrada = 1;
          |SUB_EJECUTA_NP "agifa383.run";
          |ERROR;
          inkey = 0;
     |FINSI;

     |SI inkey = 13;          || F5
          |HAZ EsAlbadis;
          |SI FSalida = 0;
               eaDocu = "AC";
               eaSerie = #0#27;
               enCodigo = #0#0;
               enLinea = #0#1;
               enPrecio = #0#6;
               enPVerde = #0#44;
               |HAZ BseVerUni;
               |ERROR; |ACABA;
          |FINSI;
          |HAZ EsQDClor;
          |SI FSalida = 0;
               eaSerie = #0#27;
               enCodigo = #0#0;
               enLinea = #0#1;
               eaTipo = "C";
               eaArticulo = #0#2;
               eaPartida = #0#37;
               ||SUB_EJECUTA_NP "qdclor10;VER";
               ||#0#18 = eaTipo; |PINTA #0#18;
               ||GRABA 020#0a;
               |SUB_EJECUTA_NP "qdclor10;CON";
          |FINSI;
          |HAZ EsSematel;
          |SI FSalida = 0;
               enModo = 4;
               eaSerie = #0#27; enCodigo = #0#0; enLinea = #0#1;
               |SUB_EJECUTA_NP "tlfw0001";
          |FINSI;
          |HAZ EsSebaLopez;
          |SI FSalida = 0;
               eaSerie = #0#27;
               enCodigo = #0#0;
               enLinea = #0#1;
               |SUB_EJECUTA_NP "sebalo05;VER";
          |FINSI;
          ||ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ

          |HAZ VerKit;
          eaDocu = "agifa080"; ||?
          ||ÄÄÄÄÄÄÄÄÄÄÄÄ Doble/MultiÄ
          eaProgCom = "agifa077";
          |HAZ VerDobleUni;
          |ERROR; |ACABA;
     |FINSI;

     |SI inkey = 12;      || F4
          |SI inkey = 12; |Y recoge ="N"; ||F4
               |PUSHV 0400 0479;
               |MENAV "0000Opcion no activada en Utilidades Usuario de Parametros Generales";
               |POPV;
               |ERROR;
               |ACABA;
          |FINSI;
           || compruebo que este en la ultima linea y en modo alta
          LineaD = #agifa080#1;    || Guardo puntero
          LineaD = LineaD +1;     || Porque si estoy en alta la linea en la que
                                     || estoy todavia no esta grabada
          |LEE 001#agifa080.];

          |SI FSalida ! 0;|O #agifa080#0 ! #agifa077#0;
                          |O #agifa080#27 ! #agifa077#50;|Y modo = 1;

               LineaD = LineaD -1;

               || Recupero el puntero
               #agifa080#0  = #agifa077#0;    || Albaran
               #agifa080#27 = #agifa077#50;   || Serie
               #agifa080#1  = LineaD;        || Numero de linea
               |LEE 001#agifa080.=;

               nerror = 0;
               |HAZ entradatosC;
               |SI nerror = 0 ;
                    |HAZ leelineasC;
                    |HAZ control2C;
                      || Le meto 3 ptec's para cuando cambia de pantalla
                    |PTEC 809;    || Flecha abajo
                    |PTEC 809;    || Flecha abajo
                    |PTEC 809;    || Flecha abajo
               |SINO;
                    |ERROR;
               |FINSI;
          |SINO;
                   || Recupero el puntero
               LineaD = LineaD -1;
               #agifa080#0  = #agifa077#0;    || Albaran
               #agifa080#27 = #agifa077#50;   || Serie
               #agifa080#1  = LineaD;        || Numero de linea
               |LEE 001#agifa080.=;

               |MENAV "0000Para recoger un albaran debe estar en la ultima linea  y en Alta";
               |ERROR;
          |FINSI;    || Si #agifa080#1 = 1 ...
     |FINSI;      || Si FSalida ...

     |SI inkey = 16; |Y #agifa142#207 = "S";
          aTipoDA = "A"; |HAZ VerDAC;
          |ERROR; |ACABA;
     |FINSI;
     |SI inkey = 25; || Ctrl-F7
          |HAZ CreaTempo;
          eaFichero = Tempo;
          |SUB_EJECUTA_NP "psion066";
          |HAZ BoraTempo;
          |SI enError = 0; |HAZ ImportaPDA80; |FINSI;
          |ERROR; |ACABA;
     |FINSI;
     |SI inkey = 17;
          |HAZ EsGesenvia;
          |SI FSalida = 0;
               eaArticulo = #0#2;
               |SUB_EJECUTA_NP "gesez003";
               |ERROR;
          |FINSI;
     |FINSI;

     |SI salida = 33; || SHIFT + F5
          |ABRE #2; #2#0 = #0#2; |LEE 020#2=; |CIERRA #2;
          |SI #2#176 = "S";
               eaTipo      = "AC";
               eaSerie     = #0#27;
               enCodigo    = #0#0;
               enLinea     = #0#1;
               efFecha     = #1#1;
               eaArticulo  = #0#2;
               enAlmacen   = #0#3;
               enUnidades  = #0#5;
               enTBruto    = #0#7;
               eaAbono     = #1#42;
               enTarifa    = 0;
               eaProve     = #1#3;
               enCamBas     = #1#57;
               eaMoneda     = #1#58;
               enCamDiv     = #1#62;
               |SUB_EJECUTA_NP "dsz00002";
          |FINSI;
          |ERROR;
     |FINSI;
|FPRC;

|| Recojo la serie y numero de albaran
|PROCESO entradatosC;
         |PINTA 2420 , " Recogida de datos del albaran :      /    ";
         alfa1 = "";
         E_sup = 5;
         E_inf = "";
         alfa1 = 2453 ? 1;
         serie_o = alfa1;
         alfa2 = "";
         E_sup = 6;
         E_inf = "";
         alfa2 = 2459 ? 1;
         albaran_o = alfa2;
         |BLIN 24;

         || No puedo leer en el que estoy sino se embuclaria
         |SI  serie_o = #agifa077#50;|Y albaran_o = #agifa077#0;
             |MENAV "0000ATENCION !!! Esta en este albaran";
             nerror = 1;
         |FINSI;
|FPRC;

|PROCESO control1C;
   aponer= Asino;
   |HAZ poncontrC;
|FPRC;

|PROCESO control2C;
   aponer= Anosi;
   |HAZ poncontrC;
|FPRC;

|PROCESO poncontrC;
         fiac = Control % A109;
         fiac = fiac + relleno;
         guarda = fiac % A109;
         fiac = Control % A1001;
         Control = Control + fiac;
         Control = Control + relleno;
         Control = Control % A120;
         Control = Control + aponer;
|FPRC;

|PROCESO CreaComponente;
     #905#0 = "AC";
     #905#1 = #0#27;
     #905#2 = #0#0;
     #905#3 = #0#1;
     #905#9 = #905#6;
     |GRABA 020#905n;
     |LIBERA #905;

     enUnidades   = #905#6;
     eaTipo       = "AC";
     eaSerie      = #0#27;
     enCodigo     = #0#0;
     enLinea      = #0#1;
     efFecha      = #1#1;
     eaArticulo   = #0#2;
     enAlmacen    = #0#3;
     eaComponente = #905#4;
     efFecha      = #1#1;
     enCamBas     = #1#57;
     eaMoneda     = #1#58;
     enCamDiv     = #1#62;

     |SUB_EJECUTA_NP "dsz00002;ACC";
|FPRC;

|DEFBUCLE dsm00005;
     #905#1;
     ;
     "AC", serie, albaran, nlinea, "      ";
     "AC", serie, albaran, nlinea, "zzzzzz";
     be;
     NULL, CreaComponente;
|FIN;

|PROCESO crealineasC;
    || Clave primaria
    #agifa080#27= #agifa077#50;    || Serie
    #agifa080#0 = #agifa077#0;     || Numero de Albaran
    #agifa080#1 = LineaD;         || Numero de linea


    |DEFECTO #agifa080#agifa077;   || Cargo los valores de defecto de cab.albaran

    || Ahora cambio lo que es particular de este albaran y que por tanto
    || no puede ver como copia de otro
    #agifa080#12 = "";                  || Familia
    || !!!! Descargar el coste !!! (pdte)
    |PARA i = 16;|SI i [ 26; |HACIENDO i = i+1;
          #agifa080#i# = "";
    |SIGUE;
    #agifa080#28 = ""; || Serie Factura
    #agifa080#29 = ""; || Serie Pedido

    |HAZ totlis;       || Calculo total linea
    |HAZ liacartiC;    || Lo envio al t ipo 2 para que calcule lo mismo que si fuera
                       || una linea introducida por el operador
    |GRABA 021#agifa080.b;
    |LIBERA #agifa080;

    |BUCLE dsm00005;

    LineaD =LineaD + 1;  || Aumento contador de lineas
|FPRC;


|PROCESO leelineasC;
      #agifa080#27= serie_o;
      #agifa080#0 = albaran_o;
      #agifa080#1 = 1;
      |LEE 001#agifa080.];
      |SI FSalida =0;
           |PARA;|SI FSalida =0;|Y #agifa080#27=serie_o;|Y #agifa080#0=albaran_o;
                                                     |HACIENDO;
                  || Me guardo el puntero
                  serie   = #agifa080#27;   || Serie y albaran actual
                  albaran = #agifa080#0;
                  nlinea  = #agifa080#1;

                  |HAZ crealineasC;

                  || Recupero puntero
                  #agifa080#27 = serie;
                  #agifa080#0  = albaran;
                  #agifa080#1  = nlinea;
                  |LEE 001#agifa080.=;

                  |LEE 001#agifa080.s;
           |SIGUE;
      |SINO;
           |MENAV "0000Atencion !!! No se ha encontrado el albaran indicado";
           |ERROR;
      |FINSI;

      || Devuelvo el puntero de la linea
      #agifa080#27= #agifa077#50; || Serie
      #agifa080#0 = #agifa077#0;  || Albaran
      #agifa080#1 = LineaD;      || Linea
      |LEE 001#agifa080.=;
|FPRC;


|PROCESO param;|TIPO 7;
     nModo = (FEntrada / 100) ! 0;

     |ABRE #11;
     |DDEFECTO #11;
     #11#26 = #0#27;
     |LEE 001#11=;
     expor = #11#30;
     |CIERRA #11;

     |SI nModo = 1;
          #0#1 = #0#1 + #agifa142#236 - 1;
     |FINSI;
|FPRC;

|PROCESO mirespor;|TIPO 0
     |SI #0#11 ! 0; |Y expor = "S";
          |MENSA mensaje5;
          #0#11 = 0;
          |PINTA #0#11;
     |FINSI;
     |ABRE #6;
     #6#0 = #1#3;
     |LEE 000#6=;
     |CIERRA #6;
     |SI #0#11 ! 0; |Y #6#90 = "S";
          |MENSA mensaje5;
          #0#11 = 0; |PINTA #0#11;
     |FINSI;
|FPRC;

 REGISTRO DE ACTUALIZACIONES

*(1) ... Mediante la pulsacion de F4 podremos recoger las lineas de otro
         albaran.

*(2)...  Utilizamos este proceso entero para la creacion de albaranes desde
         otros procesos, por tanto forzamos esos valores, si no estamos en
         ese momento en el mantenimiento propiamente dicho (p.e. solis008)
         (Lorca 14/07/96).

|| _____________________________ VER CAMBIO DE PRECIOS. PROVEEDOR / ARTICULO.
|PROCESO Mensaje;
     |HAZ EsSanchez;
     |SI FSalida = 0; |ACABA; |FINSI;

     |SI nSwMecaCreaLin ! 0;
          |ACABA;
     |FINSI;

     |PUSHV 0501 2380;
     |AVISO;
     |COLOR 0, 0; |ATRI 0;
     |BLANCO 0815 1265;
     |COLOR 4, 0; |ATRI 0;
     |D_CUADRO 0815,1265;
     |PINTA 1017, alfa;
     |ATRI 0;
     |PAUSA;
     |POPV;

|FPRC;

|PROCESO cambipre; |TIPO 0;
     |SI #142#75 ! "S"; |ACABA; |FINSI;
     ||ÄÄÄÄÄÄÄÄÄÄÄÄ Doble/MultiÄ
     eaDocu = "agifa080";
     |HAZ LeePreDtoCom0;
     ||ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
     |SI #1#58 = "B";
          |SI enPrecio ! #0#6;
               alfa = "­ ATENCION ! POSIBLE CAMBIO DE PRECIO COSTE...";
               |HAZ Mensaje;
               |HAZ Desanch80;
          |FINSI;
     |SINO;
          |SI enPreDiv ! #0#30;
               alfa = "­ ATENCION ! POSIBLE CAMBIO DE PRECIO COSTE...";
               |HAZ Mensaje;
               |HAZ Desanch80;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO cambidto;
     |SI #142#75 ! "S"; |ACABA; |FINSI;
     ||ÄÄÄÄÄÄÄÄÄÄÄÄ Doble/MultiÄ
     eaDocu = "agifa080";
     |HAZ LeePreDtoCom0;
     ||ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
     |SI enDto1 ! #0#8; |Y Campo = 8;
          alfa = "­ ATENCION ! POSIBLE CAMBIO DE DESCUENTO 1 ...";
          |HAZ Mensaje;
     |FINSI;
     |SI enDto2 ! #0#26; |Y Campo = 26;
          alfa = "­ ATENCION ! POSIBLE CAMBIO DE DESCUENTO 2 ...";
          |HAZ Mensaje;
     |FINSI;
     |SI enDto3 ! #0#45; |Y Campo = 45;
          alfa = "­ ATENCION ! POSIBLE CAMBIO DE DESCUENTO 3 ...";
          |HAZ Mensaje;
     |FINSI;
|FPRC;
------------------ ACTUALIZA ARTICULOS Y ALMACEN -------------------------
|PROCESO pantcomp; |TIPO 13;
     |SI enModoCab77 = 3; |ACABA; |FINSI;
     |HAZ visual_totales; || Visualiza los totales

     |HAZ EsRavenida;
     |SI FSalida = 0;
          |HAZ PinRavenida80;
     |FINSI;
|FPRC;

|PROCESO IVA080_0; |TIPO 0;
     |SI FSalida = 2; |ACABA; |FINSI;
     enTiva = #0Campo;
     efFiva = #1#1;
     |HAZ SacaIVA;
     |SI eaDiva = "";
          |MENAV "0000No existe tipo iva para esta fecha...";
          |ERROR; |ACABA;
     |FINSI;

     |HAZ EsInforAlba;
     |SI FSalida = 0;
          |ABRE #2;
          #2#0 = #0#2;
          |LEE 000#2=;
          |SI FSalida = 0; |Y #2#174 = "S ";
               eaArticulo = #0#2;
               eaMatri = #0#37;
               |SUB_EJECUTA_NP "ialbz001;AC";
               #0#37 = eaMatri;
          |SINO;
               #0#37 = "";
          |FINSI;
          |CIERRA #2;
          |ATRI I; |PINTA 1327, #0#37; |ATRI 0;
     |FINSI;

     |HAZ EsGesisat;
     |SI FSalida = 0;
          |ABRE #2;
          #2#0 = #0#2;
          |LEE 000#2=;
          |SI FSalida = 0; |Y #2#174 = "S ";
               eaArticulo = #0#2;
               eaProve = #1#3;
               efFecha = #1#1;
               enImpoDoc = #0#9;
               aAlfa = "gesiz019;AC" + #0#27 + (("000000"+#0#0)%-106) + #0#1;
               |SUB_EJECUTA_NP aAlfa;
               |SI eaMatri = ""; |ERROR; |FINSI;
          |SINO;
               |HAZ GesiBorMaqui;
          |FINSI;
          |CIERRA #2;
          aAlfa = #0#37; #0#37 = eaMatri;
          |ATRI I; |PINTA 1327, #0#37; |ATRI 0;
          #0#37 = aAlfa;
     |FINSI;

     |HAZ EsGesenvia;
     |SI FSalida = 0;
          eaSerie = #0#27;
          enCodigo = #0#0;
          enLinea = #0#1;
          |SUB_EJECUTA_NP "gesem001";
          |SI enSwAtras = 1; |ERROR; |FINSI;
     |FINSI;
|FPRC;

|PROCESO LinDiv;  |TIPO 7;
     ||ÄÄÄÄÄÄÄÄÄÄÄÄ Doble/MultiÄ
     eaDocu = "agifa080";
     |HAZ PintaUniMediC;
     ||ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
     |SI #142#148 = "S";
          |PINTA 1327, "Portes:"
     |FINSI;
     |HAZ EsAlbero;
     |SI FSalida = 0;
          |HAZ AlbeAlbComLin1;
     |FINSI;
     |HAZ EsViarsa;
     |SI FSalida = 0;
          |HAZ ViaPinAlbCom;
     |FINSI;
     |HAZ EsCampoJerez;
     |SI FSalida = 0;
          |HAZ CpjPinAlbCom;
     |FINSI;
     |HAZ EsGesenvia;
     |SI FSalida = 0;
          |HAZ PinGese80;
     |FINSI;

     |HAZ EsChampi;
     |SI FSalida = 0;
          eaTipo      = "C";
          eaSerie     = #0#27;
          enCodigo    = #0#0;
          enLinea     = #0#1;
          |HAZ ChampiPinAux;
     |FINSI;
     |HAZ EsChampiEmar;
     |SI FSalida = 0;
          eaTipo      = "AC";
          eaSerie     = #0#27;
          enCodigo    = #0#0;
          enLinea     = #0#1;
          |HAZ ChampiPinEmar;
     |FINSI;
     |HAZ EsInforAlba;
     |SI FSalida = 0;
          |ATRI R; |PINTA 1227, "Matricula"; |ATRI I;
          |PINTA 1327, #0#37;
     |FINSI;
     |HAZ EsGesisat;
     |SI FSalida = 0;
          |ATRI R; |PINTA 1227, "Maquina  "; |ATRI I;
          |HAZ GesiLeeMaqui;
          aAlfa = #0#37; #0#37 = eaMatri;
          |PINTA 1327, #0#37;
          #0#37 = aAlfa;
     |FINSI;
     |HAZ EsQDClor;
     |SI FSalida = 0;
          |C_V #0#18, 1, "S";
          |ATRI R; |PINTA 1225, "³Bol³";
          |ATRI I; |PINTA 1325, "³   ³";
          |PINTA #0#18;
     |FINSI;
     ||ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
     |HAZ PintaDes80;

     |ABRE #agifa321; |LEE 001#agifa321.p; |CIERRA #agifa321;
     |SI ac_divisa ! "S";
          |ATRI R;
          |PINTA 1447, "Precio";
          |PINTA 1463, "Imp. Total";
          |ATRI r;
     |SINO;
          |SI pintado = 0; || Si divisas estan activadas y no he pintado ...
               |SI #1#58 = "D";   || Si la moneda de trabajo es la divisa la pinto en
                    |ATRI R;         || el encabezado del precio y el importe
                    titdiv = "Precio" + "(" + #1#56 + ")";
                    |PINTA 1444,titdiv;
                    titdiv = "I.Tot." + "(" + #1#56 + ")";
                    |PINTA 1468,titdiv;
                    |ATRI r;
               |SINO;
                    |ATRI R;
                    |PINTA 1447, "Precio";
                    |PINTA 1463, "Imp. Total";
                    |ATRI r;
               |FINSI;
               |SI #agifa321#4 = "S";  || Si la visualizacion esta activada ...
                    ||mensa = "Precio:            Imp.:              T.Bruto:             T.ALB:             ";
                    ||PINTA 1102,mensa;  || ... pinto la linea de visualizacion
                    |PINTA 1102, "Precio:";
                    |PINTA 1121, "Imp:";
                    |PINTA 1141, "T.Bruto:";
                    |PINTA 1162, "T.ALB:";
                    |PINTA #0#32; || Pinto precio visual
                    |PINTA #0#33; || Pinto importe visual
                    |SI #1#58 = "D"; || Si la moneda de trabajo es la divisa
                         |PINTA 1149,#1#67;
                         |PINTA 1168,#1#68;
                    |SINO;
                         |PINTA 1149,#1#63;
                         |PINTA 1168,#1#64;
                    |FINSI;
                    pintado = 1;  || Ya hemos pintado
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO upc_div;
     |SI eaDivisa = #1#56;
          #0#6 = #0#30 * #1#62 / #1#57;
     |SINO;
          #0#30 = #0#6 / #1#62 * #1#57;
     |FINSI;
     |HAZ visual_precio;
|FPRC;

|PROCESO visual_precio; || Pinta el precio visual.
|SI #1#58 = "D";  || Si la moneda de trabajo es la divisa ...
  #0#32 = #0#6;   || ... el campo visualiz. es el precio en moneda base
  |PINTA #0#30;
|SINO;            || Si la moneda de trabajo es la moneda base ...
  #0#32 = #0#30;  || ... el campo visual. es el precio en divisa
  |PINTA #0#6;
|FINSI;
|SI ac_divisa = "S"; |Y #agifa321#4= "S";
  |PINTA #0#32; || Si las divisas y la visualizacion estan activadas, pinto
|FINSI;
|FPRC;


|PROCESO visual_importe;  || Pinta el importe visual
|SI #1#58 = "D";  || Si la moneda de trabajo es la divisa ...
  #0#33 = #0#9;   || el campo visualiz. es el importe en moneda base
  |PINTA #0#31;
|SINO;            || Si la moneda de trabajo es la moneda base ...
  #0#33 = #0#31;  || el campo visualiz. es el importe en divisa
  |PINTA #0#9;
|FINSI;
|SI ac_divisa = "S"; |Y #agifa321#4= "S";
  |PINTA #0#33; || Si las divisas y la visualizacion estan activadas, pinto
|FINSI;
|FPRC;

|PROCESO visual_totales;
||   |SI Control = "agifa080";
          |ABRE #agifa321;
          |LEE 001#agifa321.p;
          |SI #1#58 = "D";
               |SI ac_divisa = "S"; |Y #agifa321#4= "S";
                    |PINTA 1149,#1#67;
                    |PINTA 1168,"        ";
                    |PINTA 1168,#1#68;
               |FINSI;
               |CIERRA #agifa321;
               |PINTA 1356,#1#63;
               |PINTA 1368,#1#64;
          |SINO;
               |SI ac_divisa = "S"; |Y #agifa321#4= "S";
                    |PINTA 1149,#1#63;
                    |PINTA 1168,"        ";
                    |PINTA 1168,#1#64;
              |FINSI;
              |CIERRA #agifa321;
              |PINTA 1356,#1#15;
              |PINTA 1368,#1#55;
          |FINSI;
||   |FINSI;
|FPRC;

|PROCESO CogeValores80;  |TIPO 7;
     |SI Campo = 3;
         |C_M #0Campo, 1, "S";
         |SI #142#99 = "S";
             |C_M #0Campo, 1, "N";
             #0Campo = 1;  |PINTA #0Campo;
         |FINSI;
     |FINSI;

     |SI #2#176 = "N";  |ACABA;  |FINSI;

     |SI Campo = 3;
         |SI enAlmacen ! 0;
             #0#3 = enAlmacen;  |PINTA #0#3;
         |FINSI;
     |FINSI;

     |SI Campo = 5;
         |SI enUnidades ! 0;
             |SI #0#5 ! enUnidades;  Contenido = #0#5;  |FINSI;
             #0#5 = enUnidades;  |PINTA #0#5;
         |FINSI;
     |FINSI;

     |SI Campo = 6;
         |SI nPrecio ! 0;
             #0#6 = nPrecio;  |PINTA #0#6;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO PideArt80;  |TIPO 7;
     nModo = (FEntrada/100) ! 0;
     |SI #142#140 = "S"; |Y nModo = 1; #0#2 = eaArtAnt; |FINSI;

     aAlfa = "0000<F2>Consulta Articulo/Proveedor <F4>Modificar Articulo";
     |HAZ EsAparecida;
     |SI FSalida = 0;
          aAlfa = "0000<F2>Consulta Articulo/Proveedor <F4>Modificar Articulo <F5>Division Articulo";
     |FINSI;
     |HAZ EsForestales;
     |SI FSalida = 0;
          aAlfa = "0000<F2>Consulta Articulo/Proveedor <F3>Buscar Articulo <F4>Modificar Articulo";
     |FINSI;
     |MENSA aAlfa;

     |SI nModo = 1;
          |HAZ EsRavenida;
          |SI FSalida = 0;
               eaSerie = #0#27;
               enCodigo = #0#0;
               enLinea = #0#1
               |SUB_EJECUTA_NP "ravem005;LIN";
               |HAZ PinRavenida80;
          |FINSI;
     |FINSI;


     |C_M #0#2, 1, "S";
     |C_M #0#3, 1, "N";

     |SI #0#2 ! "                    ";
         |ABRE #2;
         #2#0 = #0#2;
         |LEE 000#2=;
         |SI FSalida ! 0;  |DDEFECTO #2;  |FINSI;
         |CIERRA #2;
         |SI #2#176 = "S";
             |C_M #0#2, 1, "N";
             |C_M #0#3, 1, "N";
             |ACABA;
         |FINSI;
     |FINSI;

     |ABRE #910;
     |LEE 040#910p;
     |SI FSalida ! 0;  |DDEFECTO #910;  |FINSI;
     |CIERRA #910;

     |SI #910#2 [ 2;    |ACABA;  |FINSI;

     eAlfa = #0Campo;
     |SUB_EJECUTA_NP "dsz99990";                 || Por Pantalla

     |SI eAlfa = "-1";  |PTEC 807;  |ACABA;  |FINSI;
     |SI eAlfa = "-2";              |ACABA;  |FINSI;

     eaArticulo = eAlfa;      ||  700000-4215

     #0Campo = eAlfa;
     |PINTA #0Campo;
     |PTEC 802;
|FPRC;

|PROCESO Calc680;  |TIPO 6;
     eaArtAnt = #0#2;
     salida = FSalida;

     |SI salida = 11;   ||F3
          |HAZ EsForestales;
          |SI FSalida = 0;
               |SUB_EJECUTA_NP "goma0008";
               |SI eaArticulo ! "";
                    #0Campo = eaArticulo;
                    |PINTA #0Campo;
               |SINO;
                    |ERROR; |ACABA;
               |FINSI;
          |FINSI;
     |FINSI;

     |SI FSalida = 12;   ||F4
          aAlfa = "dsz99895;" + #0#2;
          |SUB_EJECUTA_NP aAlfa;        ||Modi Articulo

          |HAZ EsAparecida;
          |SI FSalida = 0; articulo = ""; |FINSI;||para que refresque el precio
          |ERROR;
     |FINSI;

     |SI salida = 13; || F5
          |HAZ EsAparecida;
          |SI FSalida = 0;
               |SUB_EJECUTA_NP "aparm005";
               |ERROR;
          |FINSI;
     |FINSI;

     ||ÄÄÄÄÄÄÄÄÄÄÄÄ Doble/MultiÄ
     eaDocu = "agifa080";
     |HAZ UniPartiCB;
     ||ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
     |SI #0Campo ! Contenido; |Y Campo = 2;
          eaArticulo = #0#2;
          |HAZ DefectoMediC;
          #0#39 = enMedida1;
          #0#40 = enMedida2;
          #0#41 = enMedida3;
     |FINSI;

     enAlta = 1;
     eaArticulo = #0Campo;
     |HAZ LlenaArticulo;
     |SI FSalida = 0;
          #0Campo = eaArticulo;
          |PINTA #0Campo;
     |SINO;
          |ERROR; |ACABA;
     |FINSI;

     |HAZ art6alc;

     |SI codiBarra = "S"; |Y #910#19 = "S"; |Y modo = 1;
          |ACABA;
     |FINSI;

     |ABRE #2;
     #2#0 = #0#2;
     |LEE 101#2=;
     |SI FSalida = 0; |Y #142#209 = "S"; |Y #2#27 ! #1#3;
          aAlfa = "0000NModificar Proveedor en Articulo:"+&13+"Actual:["+#2#27+"]";
          |CONFI aAlfa;
          |SI FSalida = 0; #2#27 = #1#3; |GRABA 020#2a; |FINSI;
     |FINSI;
     |CIERRA #2;

     |HAZ SacaKit;
     |HAZ GesPreKit;

     |ABRE #2;
     #2#0 = #0#2;
     |LEE 000#2=;
     |SI FSalida ! 0;
          aAlfa = "dsz99895;" + #0#2;
          |SUB_EJECUTA_NP aAlfa;        ||Alta Articulo
          |ERROR;
     |FINSI;
     |CIERRA #2;
|FPRC;

|PROCESO Alma80_6; |TIPO 6;
     |HAZ EsConstru;
     |SI FSalida = 0;
          |DDEF aAlfa;
          aAlfa = aAlfa + "goparame";
          |CARGA_DEF aAlfa, referen@;
          |SI FSalida = 0;
               |ABRE #referen@;
               |LEE 000#referen@.p;
               |SI FSalida = 0; |Y #referen@#141 = "O";
                    |ABRE #29;
                    #29#0 = #0#3;
                    |LEE 000#29=;
                    |SI FSalida ! 0; |DDEFECTO #29; |FINSI;
                    |CIERRA #29;
                    |ABRE #2;
                    #2#0 = #0#2;
                    |LEE 000#2=;
                    |SI FSalida ! 0; |DDEFECTO #2; |FINSI;
                    |CIERRA #2;
                    |DDEFECTO #8;
                    |ABRE #8;
                    #8#0 = #0#2;
                    #8#1 = #0#3;
                    #8#40 = #2#1;
                    #8#41 = #29#1;
                    |LEE 000#8=;
                    |SI FSalida ! 0; |GRABA 020#8n; |FINSI;
                    |CIERRA #8;
               |FINSI;
               |CIERRA #referen@;
               |DESCARGA_DEF #referen@;
          |FINSI;
     |FINSI;

     |ABRE #8;
     #8#0 = #0#2;
     #8#1 = #0#3;
     |LEE 000#8=;
     |SI FSalida ! 0;
          aAlfa = "dsz99894;" + #0#2 + (("00000" + #0#3) % -105);
          |SUB_EJECUTA_NP aAlfa;        ||Alta Almacen
     |FINSI;
     |CIERRA #8;
|FPRC;

|PROCESO Tipo080; |TIPO 0;
     nModo = (FEntrada / 100) ! 0;
     |ABRE #2;
     #2#0 = #0#2;
     |LEE 000#2=;
     |CIERRA #2;
     |SI #0Campo ! Contenido; |O nModo = 1;
          #0#11 = #2#30; |PINTA #0#11;
     |FINSI;
     |HAZ EsQDClor;
     |SI FSalida = 0; |Y nModo = 2;
          |HAZ Boletin;
     |FINSI;
     |HAZ EsDesanch;
     |SI FSalida = 0;
          |SI #2#135 = "N";
               |MENAV "0000El articulo no es de entrada...";
               |ERROR; |ACABA;
          |FINSI;
     |FINSI;
     |HAZ EsExtintor;
     |SI FSalida = 0;
          eaArticulo = #0#2;
          efFecha = #1#1;
          eaSerie = #0#27;
          enCodigo = #0#0;
          enLinea = #0#1;
          enModo = nModo;
          |SUB_EJECUTA_NP "extz0015;ALTA";
          #0#5 = enUnidades; |PINTA #0#5;
     |FINSI;

     |HAZ nomodif5;
     ||ÄÄÄÄÄÄÄÄÄÄÄÄ Doble/MultiÄ
     eaDocu = "agifa080";
     |HAZ PintaUniMediC;
     ||ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
     |SI #agifa142#207 = "S";
          aTipoDA = "A"; |HAZ DescriDAC;
     |FINSI;
     |HAZ Portes;

     ||Modulo 003273
     |SI #0Campo ! Contenido; |Y Campo = 2; eArtChampi = ""; |FINSI;

     |SI #agifa142#77 = "N";
          |ABRE #237;
          |SELECT #2#237;

          #237#7 = #1#3;
          #237#2 = #0#2;
          |LEE 000#237=;
          |SI FSalida ! 0;
               |MENAV "0000No existe Oferta Proveedor/Articulo";
               |ERROR; |ACABA;
          |SINO;
               |ABRE #226;
               #226#0 = #237#0;
               |LEE 000#226=;
               |SI #1#1 < #226#2; |O #1#1 > #226#3;
                    |MENAV "0000Oferta Proveedor/Articulo fuera de perido";
                    |ERROR; |ACABA;
               |FINSI;
               |CIERRA #226;
          |FINSI;
          |CIERRA #237;
     |FINSI;

     |ABRE #2; #2#0 = #0#2; |LEE 000#2=; |CIERRA #2;
     |SI #2#176 = "S";
         eaTipo      = "AC";
         eaSerie     = #0#27;
         enCodigo    = #0#0;
         enLinea     = #0#1;
         efFecha     = #1#1;
         eaArticulo  = #0#2;
         enAlmacen   = #0#3;
         enUnidades  = #0#5;
         enTBruto    = #0#7;
         eaAbono     = #1#42;
         enTarifa    = 0;
         eaProve     = #1#3;
         enCamBas     = #1#57;
         eaMoneda     = #1#58;
         enCamDiv     = #1#62;

         |SUB_EJECUTA_NP "dsz00002";

         #0#3    = enAlmacen;
         nPrecio = enTBruto / enUnidades;

         |PTEC 802;
         |PTEC 802;
         |PTEC 802;
         |PTEC 802;
     |FINSI;
|FPRC;

|PROCESO Multi80; |TIPO 66;
     ||ÄÄÄÄÄÄÄÄÄÄÄÄ Doble/MultiÄ
     eaDocu = "agifa080";
     |HAZ CambiaUniMulti;
     |SI enError = 0;
          |HAZ LeePreDtoCom0;
          #0#6 = enPrecio;
          #0#30 = enPreDiv;
          #0#8 = enDto1;
          #0#26 = enDto2;
          #0#45 = enDto3;
          |PINTA #0#8;
          |PINTA #0#26;
          |PINTA #0#45;
          ||ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
          |HAZ upc_div;
     |FINSI;
|FPRC;

|PROCESO Tipo11080;  |TIPO 11;
     |SI FSalida = 7;
          |SI #2#176 = "S";
               |MENAV "      Imposible abortar;  Termine de introducir la linea y efectue una Baja.";
               |ERROR;
          |FINSI;

          |HAZ EsSematel;
          |SI FSalida = 0;
               |MENAV "      Imposible abortar;  Termine de introducir la linea y efectue una Baja.";
               |ERROR;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO MinAlma80;
     #8#0 = #0#2;
     #8#1 = 1;
|FPRC;

|PROCESO MaxAlma80;
     #8#0 = #0#2;
     #8#1 = 99999;
|FPRC;


|PROCESO Tipo5_080;  |TIPO 5;
     eaGesMatri = "";         ||Modulo gesenvia

     nModo = (FEntrada / 100) ! 0;
     |SI nModo ! 4;
          |HAZ actalc;
     |FINSI;
|FPRC;

|PROCESO CtaArt1;
   eaModulo = "agifa104"; |HAZ CtaArt;
|FPRC;


|PROCESO Portes;
|FPRC;

|PROCESO MinC080;
     #referen@#27 = #1#50;
     #referen@#0 = #1#0;
     #referen@#1 = 001;
|FPRC;

|PROCESO MaxC080;
     #referen@#27 = #1#50;
     #referen@#0 = #1#0;
     #referen@#1 = 999;
|FPRC;

|PROCESO Consulta080; |TIPO 66;
     nLin = 0;
     |DDEF aAlfa;
     aAlfa = aAlfa + "agifa080";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          |CONSULTA_F_CLAVE #1#referen@, MinC080, MaxC080;
          |SI FSalida = 0; nLin = #referen@#1; |FINSI;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
     |SI nLin ! 0;
          |PTEC 802;
          aAlfa = ("000" + nLin) % -103;
          aPtec = aAlfa % 301; nPtec = &aPtec;
          |PTEC nPtec;
          aPtec = aAlfa % 201; nPtec = &aPtec;
          |PTEC nPtec;
          aPtec = aAlfa % 101; nPtec = &aPtec;
          |PTEC nPtec;
     |FINSI;
|FPRC;

|PROCESO TotalImp7_80; |TIPO 7;
     |HAZ EsViarsa;
     |SI FSalida = 0;
          |HAZ ViaModiAlbCom;
     |FINSI;
     |HAZ EsCampoJerez;
     |SI FSalida = 0;
          |HAZ CpjModiAlbCom;
     |FINSI;
|FPRC;

|PROCESO ImportaPDA80;
     |DDEF aAlfa; aAlfa = aAlfa + "agifa080";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida ! 0; |ACABA; |FINSI;
     |ABRE #referen@;
     #referen@#27 = #1#50;
     #referen@#0 = #1#0;
     #referen@#1 = 999;
     |LEE 000#referen@.];
     |SI FSalida = 0;
          |LEE 000#referen@.a;
     |SINO;
          |LEE 000#referen@.u;
     |FINSI;
     |SI FSalida = 0; |Y #referen@#27 = #1#50; |Y #referen@#0 = #1#0;
          nLin = #referen@#1 + 1;
     |SINO;
          nLin = 1;
     |FINSI;
     |CIERRA #referen@;
     |DESCARGA_DEF #referen@;

     |DDEF aAlfa; aAlfa = aAlfa + "psion067";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida ! 0; |ACABA; |FINSI;
     |NOME_DAT #referen@#eaFichero#;
     |ABRE #referen@;
     |LEE 000#referen@.p;
     |PARA; |SI FSalida = 0; |HACIENDO;
          #0#27 = #1#50;
          #0#0 = #1#0;
          #0#1 = nLin;
          |GRABA 020#0b;
          #0#2 = #referen@#0; ||Arti
          #0#4 = #referen@#1; ||Des
          #0#3 = #referen@#2; ||Alma
          #0#5 = #referen@#3; ||Uni
          #0#37 = #referen@#9; ||Parti
          FEntrada = 100;     ||simula alta
          |HAZ defeclis;
          |HAZ TotalLin80;
          |HAZ liacartiC;
          |GRABA 020#0a;
          |LIBERA #0;
          nLin = nLin + 1;
          |LEE 000#referen@.s;
     |SIGUE;
     |CIERRA #referen@;
     |DELINDEX #referen@;
     |DESCARGA_DEF #referen@;
     |PONCONTROL 23, "SI"
     |PTEC 809;
     |PTEC 808;
|FPRC;

|PROCESO MenuTrack80;
     |VARIABLES; {20} aPopup = ""; |FINSI;
     aPopup1 = "-1";  || Si fuera -1 en la posicion
     aPopup2 = 6;
     aPopup3 = "<F4> Recoger Lineas";
     aPopup4 = "<F5> Doble Stock/Kit";
     |HAZ EsSebaLopez;
     |SI FSalida = 0;
          aPopup4 = "<F5> Envase/Tara";
     |FINSI;
     |HAZ EsQDClor;
     |SI FSalida = 0;
          aPopup4 = "<F5> Boletin Analisis";
     |FINSI;
     aPopup5 = "<F6> Precios Proveedor";
     aPopup6 = "<F8> Descripción Ampliada";
     aPopup7 = "<F12> Consulta Cabecera";
     aPopup8 = "<Ctrl+F7> Captura PDA";

     |HAZ EsGesenvia;
     nSwGesenvia = FSalida;
     |SI FSalida = 0;
          aPopup2 = 7;
          aPopup7 = "<F9> Artículo Proveedor";
          aPopup8 = "<F12> Consulta Cabecera";
          aPopup9 = "<Ctrl+F7> Captura PDA";
     |FINSI;

     IaPopup = aPopup1  <-;
     |ESPECIFICA "TRACKPOPUP", aPopup;
     nSal = FSalida;
     |SI FSalida = 1; nSal = 12; |FINSI;
     |SI FSalida = 2; nSal = 13; |FINSI;
     |SI FSalida = 3; nSal = 14; |FINSI;
     |SI FSalida = 4; nSal = 16; |FINSI;

     |SI nSwGesenvia = 0;
          |SI FSalida = 5; nSal = 17; |FINSI;
          |SI FSalida = 6; nSal = 9; |FINSI;
          |SI FSalida = 7; nSal = 25; |FINSI;
     |SINO;
          |SI FSalida = 5; nSal = 9; |FINSI;
          |SI FSalida = 6; nSal = 25; |FINSI;
     |FINSI;

     FSalida = nSal;
     inkey = nSal;
|FPRC;

|PROCESO Alma80_66; |TIPO 66;
     |ABRE #29;
     #29#0 = #0#3;
     |LEE 000#29];
     |CONSULTA_CLAVE #1#29;
     |SI FSalida = 0;
          #0#3 = #29#0;
          |PINTA #0#3;
     |SINO;
          |ERROR;
     |FINSI;
     |CIERRA #29;
|FPRC;

|PROCESO defeclis;
     #0#15 = #1#3;

     |SI #0#2 ! #2#0;
          |ABRE #2;
          #2#0 = #0#2;
          |LEE 000#2=;
          |CIERRA #2;
     |FINSI;
     #0#13 = #2#2;

     |SI #0#15 ! #6#0;
          |ABRE #6;
          #6#0 = #0#15;
          |LEE 000#6=;
          |CIERRA #6;
     |FINSI;

     |HAZ mirespor;

     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 1; |O articulo ! #0#2; |O nalmacen ! #0#3;
          articulo = #0#2;
          nalmacen = #0#3;
          ||ÄÄÄÄÄÄÄÄÄÄÄÄ Doble/MultiÄ
          eaDocu = "agifa080";
          |HAZ LeePreDtoCom0;
          #0#6 = enPrecio;
          #0#30 = enPreDiv;
          #0#8 = enDto1;
          #0#26 = enDto2;
          #0#45 = enDto3;
          ||ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
          |PINTA #0#8;
          |PINTA #0#26;
          |PINTA #0#45;
          |HAZ upc_div;
     |FINSI;
|FPRC;

|PROCESO InfoStock; |TIPO 7;
     |ABRE #8;
     #8#0 = #0#2;
     #8#1 = #0#3;
     |LEE 000#8=;
     |CIERRA #8;
     mensaje3 = "0410<F11>Cambia Unidad. (Stock Dis. Almacen: " + #8#39+"     Stock Minimo: "+#8#6+")";
     |MENSA mensaje3;
|FPRC;

|PROCESO Alma80_0; |TIPO 0;
     nModo = (FEntrada / 100) ! 0;
     nSal = FSalida;

     |SI FSalida = 13; || F5;
          |ABRE #8;
          #8#0 = #0#2;
          #8#1 = #0#3;
          |LEE 000#8];
          |CONSULTA_F_CLAVE #1#8, MinAlma80, MaxAlma80;
          |SI FSalida = 0;
               #0#3 = #8#1; |PINTA #0#3;
          |SINO;
               |ERROR; |ACABA;
          |FINSI;
          |CIERRA #8;
     |FINSI;

     efFec = #1#1;
     enAlma = #0#3;
     |HAZ MiraHisL;
     |SI enErrHis ! 0;
          |ERROR;
          |ACABA;
     |FINSI;

     |HAZ defeclis;


     nSwMecaCreaLin = 0;
     |SI nModo = 1; |Y #2#180 = "S";
          |HAZ EsMecanogra;
          |SI FSalida = 0;
               eaArticulo = #0#2;
               enAlmacen = #0#3;
               eaDes = #0#4;
               enPrecio = #0#6;
               enDto1 = #0#8;
               enDto2 = #0#26;
               enDto3 = #0#45;
               enCodigo = 0;
               |HAZ CreaTempo;
               |SUB_EJECUTA_NP "mecaz011";
               aMecaDes = eaDes;
               nMecaPre = enPrecio;
               nMecaDto1 = enDto1;
               nMecaDto2 = enDto2;
               nMecaDto3 = enDto3;
               nHay = 0;
               |HAZ MecaCreaLin;
               |SI nHay = 0;
                    |PTEC 807;
               |SINO;
                    |PTEC 816;
                    |PTEC 808;
                    |PTEC 809;
                    |PTEC 815;
                    nSwMecaCreaLin = 1;
                    |PONCONTROL 23, "SI";
               |FINSI;
               |HAZ BoraTempo;
          |FINSI;
     |FINSI;

     |HAZ EsRavenida;
     |SI FSalida = 0;
          eaSerie = #0#27;
          enCodigo = #0#0;
          enLinea = #0#1;
          eaPrv = #1#3;
          enTiva = #0#11;
          efFiva = #1#1;
          |SUB_EJECUTA_NP "ravem005";
          |HAZ PinRavenida80;
          |HAZ RavenidaPre;
     |FINSI;
|FPRC;
-----------------------------------------------
|PROCESO mecaw016;
     |SI nHay = 0;
          nUni = #mecaw016@#2;
          aParti = #mecaw016@#1;
          nHay = 1;
          |ACABA;
     |FINSI;
     |SALVA_DATOS #0;
     |REPON_DATOS #referen@;
     #referen@#5 = #mecaw016@#2;
     #referen@#37 = #mecaw016@#1;
     #referen@#1 = nLin;
     |GRABA 020#referen@.b;

     |SALVA_DATOS #referen@;
     |REPON_DATOS #0;

     FEntrada = 100;     ||simula alta
     |HAZ defeclis;
     #0#4 = aMecaDes;
     #0#6 = nMecaPre;
     #0#8 = nMecaDto1;
     #0#26 = nMecaDto2;
     #0#45 = nMecaDto3;
     |HAZ TotalLin80;

     |HAZ liacartiC;
     nLin = nLin + 1;

     |SALVA_DATOS #0;
     |REPON_DATOS #referen@;

     |GRABA 020#referen@.a;
     |LIBERA #referen@;
|FPRC;

|DEFBUCLE mecaw016;
     #mecaw016@#1001;
     ;
     001;
     999;
     ;
     NULL, mecaw016;
|FIN;

|PROCESO MecaCreaLin;
     |DDEF aPath;
     aAlfa = aPath + "agifa080";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |ABRE #referen@;
     #referen@#27 = #1#50;
     #referen@#0 = #1#0;
     #referen@#1 = 999;
     |LEE 000#referen@.];
     |SI FSalida = 0;
          |LEE 000#referen@.a;
     |SINO;
          |LEE 000#referen@.u;
     |FINSI;
     |SI FSalida = 0; |Y #referen@#27 = #1#50; |Y #referen@#0 = #1#0;
          nLin = #referen@#1 + 1;
     |SINO;
          nLin = 1;
     |FINSI;
     |SI nLin [ #0#1; nLin = #0#1 + 1; |FINSI;

     aAlfa = aPath + "mecaw016";
     |CARGA_DEF aAlfa, mecaw016@;
     |SI FSalida = 0;
          |NOME_DAT #mecaw016@#Tempo#;
          #0#4 = aMecaDes;
          #0#6 = nMecaPre;
          #0#8 = nMecaDto1;
          #0#26 = nMecaDto2;
          #0#45 = nMecaDto3;
          nUni = 0; aParti = "";
          |SALVA_DATOS #0;
          |BUCLE mecaw016;
          |REPON_DATOS #0;
          #0#5 = nUni;
          #0#37 = aParti;
          |DELINDEX #mecaw016@;
          |DESCARGA_DEF #mecaw016@;
     |FINSI;

     |CIERRA #referen@;
     |DESCARGA_DEF #referen@;
|FPRC;
-----------------------------------------------
|PROCESO desan001_80;
     |SI #desan001@#2 ! "S"; |ACABA; |FINSI;
     nCan = nUniDesanch / #desan001@#4;
     nCan = ((nCan - 0.49) ! 0) * #desan001@#5;
     |SI nCan [ 0; |ACABA; |FINSI;

     |SI nHay = 0; |HAZ control1C; |FINSI;
     nLin = nLin + 1;
     #0#1 = nLin;
     #0#2 = #desan001@#1;   || Codigo
     |HAZ defeclis;

     #0#4 = #2#1;
     #0#3 = nAlma;
     #0#5 = nCan;
     #0#11 = #2#30;
     #0#6 = 0;
     #0#30 = 0;
     |HAZ totlis;       || Calculo total linea
     |HAZ liacartiC;
     |GRABA 020#0n;
     nHay = 1;
|FPRC;

|DEFBUCLE desan001_80;
     #desan001@#1002;
     ;
     #0#2,"                    ";
     #0#2,"zzzzzzzzzzzzzzzzzzzz";
     ;
     NULL, desan001_80;
|FIN;

|PROCESO Desan080;
     |DDEF aAlfa;
     aAlfa = aAlfa + "desan001";
     |CARGA_DEF aAlfa, desan001@;
     |SI FSalida = 0;
          nLin = #0#1;
          nUniDesanch = #0#5;
          nAlma = #0#3;
          nHay = 0;
          |SALVA_DATOS #0;
          |BUCLE desan001_80;
          |REPON_DATOS #0;
          |DESCARGA_DEF #desan001@;
          |SI nHay ! 0;
               |HAZ control2C;
               |PTEC 809; |PTEC 816; |PTEC 806;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO tlfm0001;
     #tlfm0019@#0 = #tlfm0001@#0;
     #tlfm0019@#1 = #0#2;
     #tlfm0019@#2 = #1#1;
     |SI #1#42 = "S";
          #tlfm0019@#3 = "BC";
     |SINO;
          #tlfm0019@#3 = "AC";
     |FINSI;
     #tlfm0019@#4 = #0#27;
     #tlfm0019@#5 = #0#0;
     #tlfm0019@#6 = #0#1;
     #tlfm0019@#7 = #tlfm0001@#52;
     #tlfm0019@#8 = #0#3;
     #tlfm0019@#9 = #1#3;
     #tlfm0019@#10 = #0#6;
     |SI nForma = 1;
          |GRABA 020#tlfm0019@.n;
     |SINO;
          |BORRA 020#tlfm0019@.c;
     |FINSI;
|FPRC;

|DEFBUCLE tlfm0001;
     #tlfm0001@#3004;
     ;
     #0#27, #0#0, #0#1, 01;
     #0#27, #0#0, #0#1, 99;
     ;
     NULL, tlfm0001;
|FIN;

|PROCESO HistoIMEI;
     |DDEF aDef;
     aAlfa = aDef + "tlfm0001";
     |CARGA_DEF aAlfa, tlfm0001@;
     |SI FSalida = 0;
          aAlfa = aDef + "tlfm0019";
          |CARGA_DEF aAlfa, tlfm0019@;
          |SI FSalida = 0;
               |ABRE #tlfm0019@;
               |BUCLE tlfm0001;
               |CIERRA #tlfm0019@;
               |DESCARGA_DEF #tlfm0019@;
          |FINSI;
          |DESCARGA_DEF #tlfm0001@;
     |SINO;
          |MENAV "0000Error al cargar 'tlfm0001'";
     |FINSI;
|FPRC;

----------------------------------------------
|PROCESO TallerCreaLin80;
     |DDEF aAlfa; aAlfa = aAlfa + "agifa080";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |ABRE #referen@;
     |SI #0#50 > 0;
          nLin = #0#50;
          #referen@#27 = #0#27;
          #referen@#0 = #0#0;
          #referen@#1 = nLin;
          |LEE 121#referen@.=;
     |SINO;
          #referen@#27 = #0#27;
          #referen@#0 = #0#0;
          #referen@#1 = 999;
          |LEE 000#referen@.];
          |SI FSalida = 0;
               |LEE 000#referen@.a;
          |SINO;
               |LEE 000#referen@.u;
          |FINSI;
          |SI FSalida = 0; |Y #referen@#27 = #0#27;  |Y #referen@#0 = #0#0;
               nLin = #referen@#1 + 1;
          |SINO;
               nLin = 1;
          |FINSI;
          |SI nLin [ #0#1; nLin = #0#1 + 1; |FINSI;
          |DDEFECTO #referen@;
          #referen@#27 = #0#27;
          #referen@#0 = #0#0;
          #referen@#1 = nLin;
          |GRABA 020#referen@.b;
     |FINSI;
     aAlfa = "CANON " + #0#4;
     #referen@#2 = "xxxxx";
     #referen@#3 = 1;
     #referen@#4 = aAlfa;
     #referen@#5 = #0#5;
     #referen@#6 = enCanon;
     #referen@#11 = #0#11;
     #referen@#13 = #0#13;
     #referen@#15 = #0#15;
     #referen@#30 = enCanon;
     #referen@#50 = -1;
     |SALVA_DATOS #0;

     |SALVA_DATOS #referen@;
     |REPON_DATOS #0;

     enForma = 1;
     eaDocu = "agifa080";
     |HAZ StockEntra;
     |HAZ TotalLin80;
     |HAZ AcuAlbaran;

     |SALVA_DATOS #0;
     |REPON_DATOS #referen@;
     |GRABA 020#referen@.a;

     |REPON_DATOS #0;

     #0#50 = nLin;       || Linea Promocion

     |CIERRA #referen@;
     |DESCARGA_DEF #referen@;
|FPRC;

|PROCESO TallerAcuLin80;
     |DDEF aAlfa; aAlfa = aAlfa + "agifa080";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |ABRE #referen@;
     #referen@#27 = #0#27;
     #referen@#0 = #0#0;
     #referen@#1 = #0#50;     || Usa linea promocion
     |LEE 101#referen@.=;
     |SI FSalida = 0;
          |SALVA_DATOS #0;
          |SALVA_DATOS #referen@;
          |REPON_DATOS #0;
          #0#1 = #referen@#1;
          enForma = -1;
          eaDocu = "agifa080";
          |HAZ StockEntra;
          |HAZ TotalLin80;
          |HAZ AcuAlbaran;
          |REPON_DATOS #0;
     |FINSI;
     |CIERRA #referen@;

     |DESCARGA_DEF #referen@;
|FPRC;

|PROCESO TallerBorLin80;
     |DDEF aAlfa; aAlfa = aAlfa + "agifa080";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |ABRE #referen@;
     #referen@#27 = #0#27;
     #referen@#0 = #0#0;
     #referen@#1 = #0#50;     || Usa linea promocion
     |LEE 101#referen@.=;
     nTallerBorLin = FSalida;
     |SI FSalida = 0;
          |BORRA 020#referen@.a;
     |FINSI;
     |CIERRA #referen@;

     |DESCARGA_DEF #referen@;
|FPRC;

|PROCESO TallerCanon80;
     eaArticulo = #0#2; |QBF eaArticulo;
     |HAZ TallerCanon;
     |SI nForma = 1;
          |SI enCanon ! 0;
               aponer = Asino; |HAZ poncontrC;
               |HAZ TallerCreaLin80;
               aponer = Anosi; |HAZ poncontrC;
               |PTEC 809; |PTEC 816; |PTEC 806;
          |SINO;
               |SI #0#50 > 0;      || ha cambiado a un articulo sin canon
                    |HAZ TallerBorLin80;
                    #0#50 = 0;
               |FINSI;
          |FINSI;
     |SINO;
          |SI modo = 3; |Y enModoCab77 ! 3;
               |HAZ TallerAcuLin80;
               |HAZ TallerBorLin80;
               |SI nTallerBorLin = 0;
                    |PONCONTROL 23, "SI";
                    |PTEC 809; |PTEC 808;
               |FINSI;
          |SINO;
               |SI modo = 2;
                    |HAZ TallerAcuLin80;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO AcuAlbaran;
     |HAZ CalCabAgifa077;
     |HAZ visual_totales;
|FPRC;

|PROCESO Des080; |TIPO 0;
     |HAZ PintaDes80;
|FPRC;

|PROCESO PintaDes80;
     |HAZ EsAparecida;
     |SI FSalida = 0;
          |C_A #0#4, 0, nNume;
          |C_A #0#4, 1, 50;
          |PINTA 2301, "³Descripcion: ";
          |PINTA 2315, #0#4;
          |C_A #0#4, 1, nNume;
     |FINSI;
|FPRC;

|PROCESO InforActMatri;
     aAlfa = #0#37; |QBF aAlfa;
     |SI aAlfa = ""; |ACABA; |FINSI;
     nSwPasa = 0;
     |DDEF aPath;
     aAlfa = aPath + "ialbm006";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |SI #0#27 = #referen@#2; |O #0#27 = #referen@#3;
                    |O #0#27 = #referen@#4; |O #0#27 = #referen@#5;
               nSwPasa = 1;
          |FINSI;
          |DESCARGA_DEF #referen@;
     |FINSI;
     |SI nSwPasa = 1; |ACABA; |FINSI;

     aAlfa = aPath + "ialbm002";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          #referen@#0 = #0#37;
          |LEE 101#referen@.=;
          |SI FSalida = 0;
               |SI nForma = 1;
                    #referen@#2 = #1#3;
                    #referen@#3 = #1#4;
                    #referen@#4 = #1#1;
                    #referen@#5 = #0#9;
                    #referen@#25 = #0#27;
                    #referen@#19 = #0#0;
               |SINO;
                    #referen@#2 = "";
                    #referen@#3 = "";
                    #referen@#4 = "";
                    #referen@#5 = "";
                    #referen@#25 = "";
                    #referen@#19 = "";
               |FINSI;
               |GRABA 020#referen@.a;
          |FINSI;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |SINO;
          |MENAV "0000Error al cargar 'ialbm002'";
     |FINSI;
|FPRC;

|PROCESO gosubaux1;
     |SI #referen@#6 = "S";
          |MENAV "0000ALBARAN CERTIFICADO A DESTAJISTA...";
          enError = 1; |ERROR10;
     |FINSI;
     |SI nSwPasa = 2;
          |BORRA 020#referen@.a;
     |FINSI;
     |LIBERA #referen@;
|FPRC;

|DEFBUCLE gosubaux1;
     #referen@#4003;
     ;
     #0#27, #0#0, #0#1;
     #0#27, #0#0, #0#1;
     be;
     NULL, gosubaux1;
|FIN;

|PROCESO CheqSubcon1;
     |DDEF aAlfa;
     aAlfa = aAlfa + "gosubaux";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          nSwPasa = 1;
          |BUCLE gosubaux1;
          |SI enError = 0;
               nSwPasa = 2;
               |BUCLE gosubaux1;
          |FINSI;
          |DESCARGA_DEF #referen@;
     |SINO;
          |MENAV "0000Error al cargar 'gosubaux'";
     |FINSI;
|FPRC;

|PROCESO IVA080_66; |TIPO 66;
     enTiva = #0Campo;
     efFiva = #1#1;
     |HAZ ConsuIVA;
     |SI eaDiva = "";
          |ERROR;
     |SINO;
          #0Campo = enTiva; |PINTA #0Campo;
     |FINSI;
|FPRC;

|PROCESO ActDesanch80;
     nEsta = 0;
     |DDEF aPath;
     aAlfa = aPath + "desan001";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          |SELECT #2#referen@;
          #referen@#1 = #0#2;
          |LEE 000#referen@.=;
          |SI FSalida = 0; |Y #referen@#2 = "S";
               nEsta = 1;
          |FINSI;
          |DESCARGA_DEF #referen@;
     |FINSI;

     |SI nEsta = 0; |ACABA; |FINSI;

     aAlfa = aPath + "desan026";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          #referen@#0 = #0#2;
          #referen@#1 = #1#1;
          |SI #1#42 = "S";
               #referen@#2 = "BC";
               nUni = -#0#5;
          |SINO;
               #referen@#2 = "AC";
               nUni = #0#5;
          |FINSI;
          #referen@#3 = #0#27;
          #referen@#4 = #0#0;
          #referen@#5 = #0#1;
          #referen@#6 = nUni;
          #referen@#7 = #1#3;
          |SI nForma = 1;
               |GRABA 000#referen@.n;
          |SINO;
               |BORRA 000#referen@.c;
          |FINSI;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;

     aAlfa = aPath + "desan024";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |DDEFECTO #referen@;
          |ABRE #referen@;
          #referen@#0 = #1#3;
          #referen@#1 = #0#2;
          |LEE 101#referen@.=;
          |SI FSalida ! 0; |GRABA 020#referen@.b; |FINSI;
          #referen@#2 = #referen@#2 + (nUni * nForma);
          |GRABA 020#referen@.a;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|PROCESO DesanchUni;
     |SI #0#5 ] 0; |ACABA; |FINSI;
     nEsta = 0;
     |DDEF aPath;
     aAlfa = aPath + "desan001";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          |SELECT #2#referen@;
          #referen@#1 = #0#2;
          |LEE 000#referen@.=;
          |SI FSalida = 0; |Y #referen@#2 = "S";
               nEsta = 1;
          |FINSI;
          |DESCARGA_DEF #referen@;
     |FINSI;

     |SI nEsta = 0; |ACABA; |FINSI;

     aAlfa = aPath + "desan024";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |DDEFECTO #referen@;
          |ABRE #referen@;
          #referen@#0 = #1#3;
          #referen@#1 = #0#2;
          |LEE 000#referen@.=;
          nUni = #referen@#2 + #0#5;
          |CIERRA #referen@;
          |SI nUni < 0;
               aAlfa = "0000El proveedor solo tiene: " + #referen@#2 + " cascos. Continuar?"
               |CONFI aAlfa;
               |SI FSalida ! 0; |ERROR; |FINSI;
          |FINSI;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|PROCESO Desanch80;
     |HAZ EsDesanch;
     |SI FSalida ! 0; |ACABA; |FINSI;
     eaArticulo = #0#2;
     eaProve = #1#3;
     |SUB_EJECUTA_NP "desan043";
|FPRC;

|PROCESO LeePreDtoCom0;
     |HAZ LeePreDtoCom;
     |HAZ GesPreKit;
     |HAZ RavenidaPre;
|FPRC;

|PROCESO RavenidaPre;
     |HAZ EsRavenida;
     |SI FSalida = 0; |Y enRavePre ! 0;
          enPrecio = enRavePre;
          enPreDiv = enPrecio / #1#62 * #1#57;
          #0#6 = enPrecio; |PINTA #0#6;
          #0#30 = enPreDiv; |PINTA #0#30;
          #0#5 = 1; |PINTA #0#5;
          enRavePre = 0;
     |FINSI;
|FPRC;

|PROCESO GesPreKit;
     |HAZ EsGesenvia;
     |SI FSalida = 0;
          eaArticulo = #0#2; |HAZ EsKit;
          |SI FSalida = 0;
               enPrecio = enImpGesKit;
               enPreDiv = enPrecio / #1#62 * #1#57;
               #0#6 = enPrecio; |PINTA #0#6;
               #0#30 = enPreDiv; |PINTA #0#30;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO PinGese80;
     |ATRI R; |PINTA 1225, "³Cod. Bien Produccion ³"; |ATRI I;
     |DDEF aAlfa; aAlfa = aAlfa + "gesem001";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          #referen@#0 = #0#27;
          #referen@#1 = #0#0;
          #referen@#2 = #0#1;
          |LEE 000#referen@.=;
          |SI FSalida ! 0; |DDEFECTO #referen@; |FINSI;
          |CIERRA #referen@;
          |ATRI I; |PINTA 1328, #referen@#3; |PINTA 1335, #referen@#4; |ATRI 0;
          |DESCARGA_DEF #referen@;
     |FINSI;

     |ATRI 0;
     |ABRE #2;
     #2#0 = #0#2;
     |LEE 000#2=;
     |SI FSalida ! 0; |DDEFECTO #2; |FINSI;
     |CIERRA #2;
     |C_A #2#134, 0, nNume;
     |C_A #2#134, 1, 50;
     |PINTA 1001, "³Ref.Pr: ";
     |ATRI I; |PINTA 1009, #2#134; |ATRI 0;
     |C_A #2#134, 1, nNume;
|FPRC;

|PROCESO Campo18; |TIPO 7;
     nModo = (FEntrada / 100) ! 0;
     |HAZ EsQDClor;
     |SI FSalida = 0; |Y nModo = 1;
          |HAZ Boletin;
     |FINSI;
|FPRC;

|PROCESO Boletin;
     |SI aArtBol ! #0#2; |O aPartBol ! #0#37;
          eaSerie = #0#27;
          enCodigo = #0#0;
          enLinea = #0#1;
          eaTipo = "C";
          eaArticulo = #0#2;
          eaPartida = #0#37;
          |SUB_EJECUTA_NP "qdclor10;ALTA";
          #0#18 = eaTipo; |PINTA #0#18;
          aArtBol = #0#2;
          aPartBol = #0#37;
     |FINSI;
|FPRC;

|PROCESO GesiActMaqui;
     |HAZ GesiLeeMaqui;
     |SI eaMatri = ""; |ACABA; |FINSI;
     nSwPasa = 0;
     |DDEF aPath;
     aAlfa = aPath + "gesim001";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |SI #0#27 = #referen@#2; |O #0#27 = #referen@#3;
                    |O #0#27 = #referen@#4; |O #0#27 = #referen@#5;
               nSwPasa = 1;
          |FINSI;
          |DESCARGA_DEF #referen@;
     |FINSI;
     |SI nSwPasa = 1; |ACABA; |FINSI;

     aAlfa = aPath + "gesim002";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          #referen@#0 = eaMatri;
          |LEE 101#referen@.=;
          |SI FSalida = 0;
               |SI nForma = 1;
                    #referen@#2 = #1#3;
                    #referen@#3 = #1#4;
                    #referen@#4 = #1#1;
                    #referen@#5 = #0#9;
                    #referen@#25 = #0#27;
                    #referen@#19 = #0#0;
               |SINO;
                    #referen@#2 = "";
                    #referen@#3 = "";
                    #referen@#4 = "";
                    #referen@#5 = "";
                    #referen@#25 = "";
                    #referen@#19 = "";
               |FINSI;
               |GRABA 020#referen@.a;
          |FINSI;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |SINO;
          |MENAV "0000Error al cargar 'gesim002'";
     |FINSI;
|FPRC;

|PROCESO GesiLeeMaqui;
     |DDEF aAlfa;
     aAlfa = aAlfa + "gesim024";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          #referen@#0 = "AC";
          #referen@#1 = #0#27;
          #referen@#2 = #0#0;
          #referen@#3 = #0#1;
          |LEE 000#referen@.=;
          |SI FSalida = 0;
               eaMatri = #referen@#4;
          |SINO;
               eaMatri = "";
          |FINSI;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |SINO;
          |MENAV "0000Error al cargar 'gesim024'";
     |FINSI;
|FPRC;

|PROCESO GesiBorMaqui;
     |DDEF aAlfa;
     aAlfa = aAlfa + "gesim024";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          #referen@#0 = "AC";
          #referen@#1 = #0#27;
          #referen@#2 = #0#0;
          #referen@#3 = #0#1;
          |LEE 101#referen@.=;
          |SI FSalida = 0;
               |BORRA 020#referen@.a;
          |FINSI;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|PROCESO PinRavenida80;
     |DDEF aAlfa;
     aAlfa = aAlfa + "ravem005";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |DDEFECTO #referen@;
          |ABRE #referen@;
          #referen@#0 = #0#27;
          #referen@#1 = #0#0;
          #referen@#2 = #0#1;
          |LEE 000#referen@.=;
          |CIERRA #referen@;
          |ATRI R; |PINTA 1225, "³%Repar.³Recaudacion³Diferencia³"; |ATRI 0;
                   |PINTA 1325, "³       ³           ³          ³";
          |ATRI I;
          |PINTA 1326, #referen@#3;
          |PINTA 1335, #referen@#4;
          |PINTA 1347, #referen@#5;
          |ATRI 0;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|PROCESO RaveLinea;
     |DDEF aAlfa;
     |SI #0#1 > 1;
          aAlfa = aAlfa + "ravem004";
          |CARGA_DEF aAlfa, referen@;
          |SI FSalida = 0;
               |DDEFECTO #referen@;
               |ABRE #referen@;
               #referen@#0 = #0#27;
               #referen@#1 = #0#0;
               |LEE 000#referen@.=;
               |SI FSalida = 0;
                    aAlfa = #referen@#4;
               |FINSI;
               |CIERRA #referen@;
               |DESCARGA_DEF #referen@;
          |FINSI;
     |FINSI;
     |SI aAlfa = "A"; |O aAlfa = "B";
          FSalida = 0;
     |SINO;
          FSalida = 1;
     |FINSI;
|FPRC;
