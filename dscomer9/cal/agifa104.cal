|FICHEROS;
     agifa104 #0;
     agifa024 #1;
     agifa073 #3;
     agifa038 #13;
     dsm00018 #18;
     agifa019 #19;
     dsm00020 #20;
     agifa025 #25;
     agifa007 #40;
     agifa142 #41;  || Parametros Generales
     agifa027 #42;  || Contador.
     agis0002 #90;  || Recibos adelantados.
     agifa321 #35;  || Parametros de Divisas
     agifa328 #36;  || Clientes/Divisas
     agifa329 #37;  || Lineas de Clientes/Divisas
     agifa324 #38;  || Divisas
     dsm00003 #39,MANTE;
     agifa204 #204;
     dsm00117 #117;
     dsm00134 #134; ||Promociones cli/art
     dsm00211 #211;
     dsm00246 #140; ||Control Riesgo Por Usuarios.
     dsm00247 #141; ||Pantalla Informe Riesgo.
     dsm00248 #143; ||Auditoria.
     dsm00113 #144;
     agifa146 #146;
     dsm00279 #279;
     dsm00114;
     agit0000;

     dsz99998,MANTE; ||Definido solo para que no de el error
                     ||DEF DECLARADO MANTE YA CARGADO SIN MANTE
     referen@;
     refere1@;
     dsm00264@;
     mecam005@;
     mecam006@;
     tagw0042@;
|FIN;

|VARIABLES;
     aTecla = "";
     aFin = "";
     nSwEsEvaristo = 0;
     nSwEvaFuerza = 0;
     aCliAnt = "";
     nPos = 0;
     aSeccion = "";
     &eaImp = "";
     nBtnItemDocPed = -1;
     nBtnWorkFlow = -1;
     &PRMNT_aHisto = "";
     &eaFergaCli = "";
     &eaFergaDir = "";
     &eaFergaFam = "";
     &eaFergaSub = "";
     nSwHazEnvio = 0;
     {1}aBaseLocal = "";
     &eaImpresora = "";
     aIP = "";
     aSubject = "";
     aMailRep1 = "";
     aMailRep2 = "";
     aDjunto = "";
     aServidor = "";
     aFrom = "";
     aTo = "";
     aEmail = "";
     &eaNonDni = "";
     &eaDomiDni = "";
     &eaCPDni = "";
     &eaPobDni = "";
     &eaPrvDni = "";
     &eaTlfDni = "";
     &eaFacDni = "";
     &eaPaisDni = "";
     &eaTmpPV816 = "";
     &Tempo = "";
     aCien = "";
     aPathErp = "";
     aErp = "";
     aBass = "";
     nSwEstaDocErp = 0;
     aAplicaErp = "";
     nEmpErp = 0;
     aDefErp = "";
     aClaveErp = "";
     nError = 0;
     &enPrioridadBajaPed = 0;
     nSwBerria = 0;
     &enSwPrimiPDA = 0;
     nSwTagloma = 0;
     &enLin004082 = 0;
     aPtec = "";
     nPtec = 0;
     nSwCoimasa = 0;
     i = 0;
     aTieneLin = "";
     aPath = "";
     aSinError = "";
     nSal = 0;
     aSql = "";
     aDef = "";
     aUsu = "";
     nContaLog = 0;
     aSer = "";
     aNum = "";
     nTipo = "";
     aTipo = "";
     &enLinAuto = 0;
     nLin = 0;
     nResto = 0;
     nUniPromo = 0;
     &uni_dt = 0;   || Unidades
     &uni_dt2 = 0;   || Unidades
     &fed_dt = @;   || Fecha....
     &art_dt = "";  || Articulo.
     &cli_dt = "";  || Cliente..
     &fam_dt = "";  || Familia.
     &iva_dt = 0;   || Tipo Iva.
     &dtos_2 = 0;   || Descuento 2.
     &dto_pt = 0;   || Descuento Ptas.
     &dtos_1 = 0;   || Descuento 1.
     &pvp_ve = 0;   || Precio Venta.
     &tarifa = 0;   || Tarifa Cliente.
     &quedto = 0;   || 1=cli./art, 2=cli./familia, 3=cli./subfam.
     &gru_dt = "";  || Grupo Cliente.
     &nPromo = 0;
     &enMensaje = 0;
     &aParam    = "";
     &enModo104 = 0;
 {-1}aMenu           = "";
     aMenu1          = "2400";
     aMenu2          = "1";
     aMenu3          = "Opciones:  ";
     aMenu4          = "IA";
     aMenu5          = " Imprimir ";
     aMenu6          = " Adjudicar ";
     aMenu7          = " Procesos ";
     aMenu8          = " Asig. Procesos ";

     &fec_alb = @;
     &num_alb = 0;
     &eaCurso = "";
     &enNumero = 0;
     &enEsCto = 0;
     aServido = "";
     nSwNohacer = 0;
     &eaDirEntrega= "";
     &eaSerPedido = "";
     &enNumPedido = 0;
     &enSwHayOrdMez = 0;
     &enSwHayFinaliz = 0;
     &eaArtMod = "";
     &enCanMod = 0;
     &enAlmMod = 0;

     nDif = 0;

     aMensaje = "";
     nSwTecatel = 0;
     &enCliAdj = "";
     aCliTeca = "";
     nSwAlbero  = 0;
     nBoton     = 0;
     nPendiente = 0;
     nPendiente2= 0;
     nNume11    = 0;
     nModo      = 0;
     nNume7     = 0;
     nCalc      = 0;
     nConAu     = 0;
     aUs        = "";
     &nMasRies  = 0;
     nTries     = 0;
     nAudito    = 0;
     &nRieTotal = 0;
     &nRieUtili = 0;
     &aRieBloqu = "";
     &aBloquead = "";
     &eaTag     = "";
     nMult      = 0;
     aProg      = "";
     nForma     = 0;
     &nImpo     = 0;
     &cli       = "";
     nPosi      = 0;
     nfecha     = 0;
     nTecla     = 0;
     nSwVersion = 0;

     &enSw      = 0;

     &nDeci_Base     = 0;   || Decimales en Totales de la moneda base
     &nDeci_PreBase  = 0;   || Decimales en el Precio en moneda base
     &nDeci_BaseMxP  = 0;   || Decimales en Totales de la moneda base (Maxima precision)
     &nDeci_PreBasMxP= 0;   || Decimales en el Precio en moneda base (Maxima precision)
     &nDeci_DivP     = 0;   || Decimales en Totales de la divisa
     &nDeci_PreDivP  = 0;   || Decimales en el Precio en divisa
     &nDeci_TotVisP  = 0;   || Decimales en Totales visibles (el de la moneda de trabajo)
     &nDeci_TotNoVisP = 0;  || Decimales en Totales no visibles (el de la otra moneda)
     &nDeci_PreVisP  = 0;   || Decimales en el Precio visual. (lineas)
     &nDeci_ImpVisP  = 0;   || Decimales en el Importe visual. (lineas)
     &nDeci_PreVis  = 0;    || para agifa023
     &nDeci_ImpVis  = 0;    ||
     &ac_divisa = "N";   || Vale "S" cuando las divisas en ventas estan
                         || activadas y la serie es de divisas
     &pintado = 0;       || Sirve para controlar los pintados de las lineas
     &decim_divisa = 0;  || Decimales de la divisa
     &precio_divisa = 0; || Decimales del precio en divisa
     &decim_base = 0;    || Decimales de la moneda base
     &precio_base = 0;   || Decimales del precio en moneda base
     div_act = 0;        || Divisa actualizada. Me sirve en un PARA para que
                         || no salga hasta que este actualizada (div_act=1)
     &cli_divisa = "";   || Codigo de Cliente. Se pasa a CLIENTES/DIVISAS
     &divisa = "";       || Codigo de Divisa. Se pasa a ACTUAL. de DIVISAS
     nModo104 = 0;
     sw_reserva     = 0;
     alfa           = "";
     contador       = 0;
     cont           = "";
     &ext1          = "";
     &ser_ped       = "";
     &num_ped       = 0;
     &bl            = "                              ";
     dto_prom       = "N";
     def_exp        = "N";
     avisa_st       = "N";
     recoge         = "N";    || Lo utilizo en agifa073
     fmes           = "  ";
     mensaje10      = "0000El Pedido ya esta Servido en parte o totalmente";
     mensaje11      = "0423Actualizando linea:";
     mensaje1       = "2400NDesea imprimir el recibo? ";
     informe        = "";
     puente         = "";
     &cant          = 0;
     &tolin         = 0;
     n_dec          = 0;
     n_pre          = 0;
     def_alm        = 0;
     con            = 0;
     indtope        = 0;
     ind            = 0;
     mes            = 0;
     control        = 0;
     modo           = 0;
     nEntrada       = 0;
     aAlfa          = "";
     || Variables de comunicacion con agifa218
     &aSeriePedido  = "";
     &aNumeroPedido = 0;
     &SPedido       = "";
     &NPedido       = 0;
     &BAdela        = 0;
     &TipoCta       = "P";
     &ser           = "";
     &doc           = 0;
     &eaCodigo      = "";
     &eaTipoCodigo  = "CL";

     || MENU PARA INTRODUCIR EL CODIGO DEL CLIENTE DE FORMA AUTOMATICA.
 {-1}menu           = "";
     menu1          = "2400";
     menu2          = "1";
     menu3          = "Contador:  ";
     menu4          = "AM";
     menu5          = " Automatico ";
     menu6          = " Manual ";
     so             = "";
     no             = 0;
     ser_a          = "";
     num_a          = 0;
     lin_a          = 0;
     art_a          = "";
     uni_a          = 0;
     serie          = "";
     numero         = 0;
     caltot         = 0;
     recalpre       = 0;
     nImpDiv        = 0;
     nPend          = 0;
     nImpoIva = 0;

     aNifQbf1   = "";
     aNifQbf2   = "";

     &eaVarDni  = "";
     &enCalcCif = 0;
|FIN;

|INCLUYE i_varart;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴

|PROCESO CalculaNif;
     nSal = FSalida;

     |SI enProg211 = 211; |ACABA; |FINSI; || cuando viene  de Adj.Pedio (F10)

     |ABRE #1;
     #1#0 = #0#4;
     |LEE 000#1=;
     |CIERRA #1;
     eaPais = #1#205;

     |SI nSal = 9;
         eaVarDni   = #0Campo;
         enCalcCif  = 1;
         |HAZ CalculoNIFCIF;
         #0Campo = eaVarDni;
         |PINTA #0Campo;
         |ERROR;
         |ACABA;
     |FINSI;

     |HAZ EsTagloma;
     |SI FSalida = 0; |HAZ NifTaglo104; |ACABA; |FINSI;

     eaVarDni  = #0Campo;
     enCalcCif = 0;
     |HAZ CalculoNIFCIF;

     aNifQbf1 = #0Campo;   |QBF aNifQbf1;
     aNifQbf2 = eaVarDni;  |QBF aNifQbf2;

     |SI aNifQbf1 ! aNifQbf2; |Y aNifQbf1 ! "";
         |CONFI "0000SEl Nif puede ser Erroneo. Desea Calcularlo.";
         |SI FSalida = 0;
             #0Campo = eaVarDni;  |PINTA #0Campo;
             |ERROR;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO Entra104; |TIPO 7;
     nModo = (FEntrada / 100) ! 0;

     |HAZ ControlUsuPV;
     |SI enErr ! 0; |PTEC 807; |ACABA; |FINSI;

     |C_P #0#4, 0, enPosCli;
     |HAZ DefSerVta;
     |SI nModo = 1; |Y #279#24 = "S";
          |SI eaSerCli ! "";
               #0#25 = eaSerCli; |PTEC 802;
          |SINO;
               |PTEC 807; |PTEC 807; |ERROR; |ACABA;
          |FINSI;
     |FINSI;

     |HAZ EsTecatel;
     nSwTecatel = FSalida;
     |SI FSalida = 0;         || Serie segun cliente
          aCliTeca = "";
          |C_M #0#4, 1, "S";
          |SI nModo = 1;
               |ENCAMPO #4#0; aCliTeca = #0#4;
               |SI FSalida ! 0; |PTEC 807; |ACABA; |FINSI;
               |C_M #0#4, 1, "N";
               aAlfa = #1#166; |QBF aAlfa;
               |SI aAlfa ! ""; #0#25 = aAlfa; |FINSI;
          |FINSI;
     |FINSI;

     |SI nSwCoimasa = 0;
          |SI nModo = 2;
               |ESTADO_CONTROL nBoton, "ENABLE";
          |SINO;
               |ESTADO_CONTROL nBoton, "DISABLE";
          |FINSI;
     |FINSI;

     |HAZ EsFergalsan;
     |SI FSalida = 0;
          enModo = nModo;
          eaSerPedido = #0#25;
          enNumPedido = #0#0;
          efFecha = #0#1;
          eaCliente = #0#4;
          eaDirEntrega = #0#57;
          |SUB_EJECUTA_NP "fergaz10";
          |SI enModo = 1;
               |SI enNumPedido = 0;
                    |PTEC 807;
               |SINO;
                    |ABRE #1;
                    #1#0 = eaCliente;
                    |LEE 000#1=;
                    |CIERRA #1;

                    #0#25 = eaSerPedido;
                    #0#0  = enNumPedido;
                    #0#57 = eaDirEntrega;

                    |PTEC 802;
                    |PTEC 802;
               |FINSI;
          |FINSI;
          |SI enModo = 4;
               |SI enNumPedido = 0;
                    |PTEC 807;
               |SINO;
                    #0#25 = eaSerPedido;
                    #0#0  = enNumPedido;
                    #0#57 = eaDirEntrega;
                    |PTEC 802;
                    |PTEC 802;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Promo104_7; |TIPO 7;
     |SI #41#129 = "S";
          |C_M #0#56, 1, "S";
     |FINSI;
|FPRC;

|PROCESO Promo104_0; |TIPO 0;
     |SI #0#56 ! 0;
          |ABRE #117;
          #117#0 = #0#56;
          |LEE 000#117=;
          |SI FSalida ! 0;
               |MENAV "0000Promocion Inexistente...";
               |ERROR;
          |FINSI;
          |CIERRA #117;
     |FINSI;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO pedcon; |TIPO 6;
     con = (FEntrada / 100) ! 0;
     |SI con ! 1; |Y #0Campo ! Contenido;
          |SI con ! 4;
               |SI #0#24 > 0;
                    |MENAV mensaje10;
                    |ERROR; nError6 = 1;
               |SINO;
                    control = 1;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO ModiFec104;
     nPendiente = #3#5 - #3#43;
     nPendiente2 = #3#44 - #3#49;
     |SI nPendiente > 0; |O nPendiente2 > 0;
          #3#13 = #0#2;
          |GRABA 020#3a;
          |LIBERA #3;
     |FINSI;
|FPRC;

|PROCESO Fecha104; |TIPO 0;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 2; |Y #0Campo ! Contenido;
          |CONFI "0000NModificar fecha entrega de lineas ";
          |SI FSalida = 0;
               |BUCLELIN 0ModiFec104 #0;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO altac; |TIPO 6;
     alfa = #0#4; |QBF alfa;
     |SI alfa ! "";
          |ABRE #1;
          #1#0 = #0#4;
          |LEE 000#1=;
          |SI FSalida ! 0; |Y #41#1 = "S";
               |HAZ Menus;
          |FINSI;
          |CIERRA #1;
     |FINSI;
|FPRC;

|PROCESO mirar_d; |TIPO 6;
     control = 0;
     nModo = (FEntrada / 100) ! 0;

     |SI nModo = 1; |O nModo = 2;
          |MODULO aAlfa;
          |SI Campo = 0; |Y aAlfa = "agifa104";
               |HAZ Curso66;
          |FINSI;
     |FINSI;

     |ABRE #41; |LEE 001#41p; |CIERRA #41;
     n_dec = #41#8;
     n_pre = #41#9;
     dto_prom = #41#18;
     avisa_st = #41#35;
     |ABRE #agifa007;
     #agifa007#26 = #agifa104#25;
     |LEE 001#agifa007.=;
     |CIERRA #agifa007;
     def_alm = #agifa007#29;
     def_exp = #agifa007#30;
     recoge  = #agifa142#38;
     |HAZ LeeMonBase;
     |HAZ LeeParamDiv;
     ||컴컴컴컴컴컴컴컴컴
     |SI nModo = 1;
          |HAZ EsTecatel;
          |SI FSalida = 0;
               |HAZ TecaFecSer;
          |FINSI;
          |HAZ EsEvaristo;
          |SI FSalida = 0;
               |HAZ EvaTipoPedDef;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO DirEntrega;
     con = (FEntrada / 100) ! 0;

     |SI nTecla = 11; |O #41#102 = "S"; |O #41#102 = "X";
          eaCodigo = #0#4;
          eaFuerza = "N";
          |SI nTecla = 11; eaFuerza = "S"; |FINSI;
          |SUB_EJECUTA_NP "dsz99994;alquelotoquelecortolosguevos";
          |SI #41#102 = "N"; |Y con ! 2; |ERROR;  |FINSI;
     |FINSI;
|FPRC;

|PROCESO Cliente7; |TIPO 7;
     nModo = (FEntrada / 100) ! 0;
     |SI #279#24 = "S";
          |C_M #0#4, 1, "N";
          |SI nModo = 1;
               |SI eaSerCli ! ""; #0#4 = eaCliSer; |FINSI;
          |FINSI;
     |FINSI;
     |SI enCliAdj ! "";       || Alta desde la Adj.
          #0#4 = enCliAdj;
          |PINTA #0#4;
          enCliAdj = "";
          |C_M #0#4, 1, "N";
     |FINSI;
|FPRC;

|PROCESO LineasServida;
     |SI #3#43 ! 0;
          aServido = "S";
     |FINSI;
|FPRC;

|PROCESO ModiLinCli;
     #3#19 = #1#4;
     #3#20 = #0#4;
     |GRABA 020#3a;
     |LIBERA #3;
|FPRC;

|PROCESO Cliente6; |TIPO 6;
     nTecla = FSalida;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 4; |ACABA; |FINSI;

     |ABRE #1;
     #1#0 = #0#4;
     |LEE 000#1=;
     |CIERRA #1;
     |SI nModo = 1; |O #0Campo ! Contenido;
          |ABRE #39;
          #39#0 = #0#4;
          #39#1 = #0#57;
          |LEE 000#39=;
          |CIERRA #39;
          |HAZ AsignaDir104;
     |FINSI;

     |HAZ EsTagloma;
     |SI FSalida = 0;
          eaCliente = #0#4;
          |SUB_EJECUTA_NP "tagz0024";
     |FINSI;

     nError6 = 0;
     |SI nModo = 2; |Y #0Campo ! Contenido;
          aServido = "N";
          |BUCLELIN 2LineasServida#0;
          |SI aServido = "S";
               |MENAV "0000No se puede modificar el cliente, hay unidades servidas...";
               #0Campo = Contenido;
               |ERROR; |ACABA;
          |SINO;
               |ABRE #1;
               #1#0 = #0#4;
               |LEE 000#1=;
               |BUCLELIN 0ModiLinCli#0;
               |CIERRA #1;
          |FINSI;
     |FINSI;

     |SI aCliTeca ! "";  ||Modulo Tecatel
          #0#4 = aCliTeca;
          |SI #0Campo ! Contenido; |O nModo = 1; || Se carga otra vez
               |HAZ DefDirEnt;
          |FINSI;
          |HAZ DirEntrega;
     |FINSI;
     |HAZ mirar_d;
     |HAZ altac;
     |SI nSwTecatel ! 0; |O nTecla = 10; ||F2
          |HAZ DirEntrega; ||Solo cuando no es Tecatel
     |FINSI;
     |HAZ pedcon;
     |HAZ Extracto;

     |HAZ EsTagloma;
     |SI FSalida = 0;
          eaDocu = "PV";
          eaCliente = #0#4;
          |HAZ TagCheqPend;
     |FINSI;

     |HAZ alriesgo;
     |SI nError6 ! 0; |ERROR; |FINSI;
|FPRC;

|PROCESO ser55; |TIPO 0;
     cli = #0#4;
     ser = #0#25;
     |SUB_EJECUTA_NP "agifv011.tab;por_ejemplo"
|FPRC;

|PROCESO EvarAviso;
     |HAZ EsEvaristo;
     nSwEsEvaristo = FSalida;
     |SI FSalida = 0;
          |DDEF aAlfa;
          aAlfa = aAlfa + "evarm041";
          |CARGA_DEF aAlfa, referen@;
          |SI FSalida = 0;
               |ABRE #referen@;
               #referen@#0 = #0#4;
               |LEE 000#referen@.=;
               |SI FSalida ! 0; |DDEFECTO #referen@; |FINSI;
               |CIERRA #referen@;

               #agifa024#53 = #referen@#1;

               |DESCARGA_DEF #referen@;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO alriesgo; |TIPO 0;
     nModo = (FEntrada / 100) ! 0;

     |SI nModo = 4; |ACABA; |FINSI;

     |SI enLinAuto ! 0; ||lo manda dsz99920 (del agifa211)
          |ACABA;
     |FINSI;

     |SI #agifa142#14 = "S"; |Y enLin004082 = 0;
          |HAZ EvarAviso;
          puente = #agifa024#53;     |QBF puente;
          |SI puente ! "";
               |PUSHV 1008 1370;
               |SI #agifa142#20 = "S"; |AVISO; |FINSI;
               |BLANCO 1008 1370;
               |CUADRO 1008 1370;
               |ATRI R;
               |PINTA 1110 , #agifa024#53;
               |ATRI 0;
               |SI nSwEsEvaristo = 0;
                    |PINTA 1245, "Pulse Fin para continuar.";
                    aFin = &255 + 816;
                    |PARA aTecla = ""; |SI aTecla ! aFin; |HACIENDO;
                         |LEETECLA aTecla;
                    |SIGUE;
               |SINO;
                    |PAUSA;
               |FINSI;
               |POPV;
          |FINSI;
     |FINSI;
     ||컴컴컴컴컴컴컴컴컴컴컴컴컴 Control Riesgo Cliente.
     nMasRies   = 0;
     eaSerie = #0#25; eaTag = "PE";  |HAZ SacaRiesgo;
     |SI #agifa142#166 = "S"; |Y eaExisteCliRie = "S";
          eaDocu = "C";
          eaTipo = "P";
          enImpoDoc = #0#11;
          eaMuestra = "S";
          |HAZ ControlRiesgo;
          |HAZ CtrlRiesgoTaglo;
          |SI enErrRie ! 0;
               nError6 = 1;
               |SI nModo ! 4; |ERROR; |FINSI;
               |ACABA;
          |FINSI;
          |SI enAudito = 0;
               |ABRE #143;
               |LEE 000#143u;
               |SI FSalida = 0;
                    nConAu = #143#0 + 1;
               |SINO;
                    nConAu = 1;
               |FINSI;
               |DDEFECTO #143;
               #143#0 = nConAu;
               #143#12 = "PEDIDO";
               #143#1 = #0#25;
               #143#2 = #0#0;
               #143#3 = #0#1;
               #143#4 = #0#4;
               #143#5 = #0#8;
               #143#6 = Usuario % 810;
               #143#7 = #141#0;
               #143#8 = #141#1;
               #143#9 = #141#2;
               #143#10 = #141#3;
               #143#11 = #141#4;
               |GRABA 020#143n;
               |CIERRA #143;
          |FINSI;
     |FINSI;
     |HAZ EsMecanogra;
     |SI FSalida = 0;
          |SI nRieUtili ] nRieTotal;
               |HAZ MecaRiesgo;
          |SINO;
               |SI nModo = 1; |HAZ MecaGra5; |FINSI;
          |FINSI;
          |HAZ MecanoPin104;
          |PINTA 1201, " Ace.Financiera:";
     |FINSI;
|FPRC;

|PROCESO Cliente0; |TIPO 0;
     nModo = (FEntrada / 100) ! 0;

     |SI #0Campo ! Contenido; |O nModo = 1;
          |HAZ DefDirEnt;
          |HAZ EsCoimasa;
          |SI FSalida = 0;
               #0#52 = #1#167; |PINTA #0#52;
          |FINSI;
          #0#64 = #1#15; |PINTA #0#64;
     |FINSI;

     |SI #0Campo ! Contenido; |Y nModo = 2;
          |SI #41#250 = "S"; |HAZ PediModLin; |FINSI;
     |FINSI;

     |HAZ ser55;
     |HAZ caltotal;
     |HAZ CambioDivisa;

     eaCliente = #0#4;
     eaSerie = #0#25;
     eaTipo = "P";
     |HAZ ExisteCliRie;

     |HAZ Pago7_104;

     |HAZ DefePromo104;
|FPRC;

|PROCESO DefDirEnt;
     |ABRE #39;
     #39#0 = #0#4;
     #39#1 = #0#57;
     |LEE 101#39=;
     |SI FSalida = 0;
          |HAZ AsignaDir104;
     |FINSI;
     |CIERRA #39;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO mira_ser;
     |SI #3#43 ! 0; |O #3#49 ! 0;
          sw_reserva = 1; |ERROR10;
     |FINSI;
|FPRC;

|DEFBUCLE mira_ser;
     #3#1;
     ;
     #0#25,#0#0,001;
     #0#25,#0#0,999;
     ;
     NULL, mira_ser;
|FIN;

|PROCESO ActCli;
     #19#0 = #3#2;
     |LEE 020#19=;

     #1#0 = #0#4;
     |LEE 121#1=;
     |SI FSalida = 0;
          |SI #19#194 = 2;
               nImpo = ((((#3#44 * #3#6) < #3#8) < #3#29) < #0#5) < #0#17;
          |SINO;
               nImpo = ((((#3#5 * #3#6) < #3#8) < #3#29) < #0#5) < #0#17;
          |FINSI;
          |SI #41#115 = "S";
               nImpo = nImpo < #0#6;
          |FINSI;
          nImpo = nImpo * nForma;
          fmes = #0#1 % A402;
          mes = fmes - 1;
          mes = mes * 3;
          mes = mes + 114;
          #1mes = #1mes   + nImpo;     || VENTA.
          #1#150 = #1#150 + nImpo;
          |GRABA 020#1a;
          |LIBERA #1;

          eaCliente = #agifa104#4;
          efFecha = #agifa104#1;
          enImpCliPed = nImpo;
          |HAZ AcumulaCli;
     |FINSI;

     eaCli = #0#4;
     enTiva = #3#14;
     efFiva = #0#1;
     |HAZ IVACli;
     nCalc = #3#11 % enIva;
     |SI #1#47 = "S";
          nCalc = nCalc + (#3#11 % enRec);
     |FINSI;
     nImpoIva = nImpoIva + (#3#11 + nCalc);
|FPRC;

|PROCESO pedaccli; |TIPO 2;
     |HAZ ControlUsuPV;
     |SI enErr ! 0; |ERROR; |ACABA; |FINSI;

     con = (FEntrada / 100) ! 0;
     nForma = 0 +. 1;
     enModo104 = (FEntrada / 100) ! 0;
     |SI enModo104 = 4; |ACABA; |FINSI;

     |SI #0#36 = 0; || chequea el cambio
          |ABRE #agifa324;
          #agifa324#0 = #0#35;
          |LEE 020#agifa324.=;
          |SI FSalida = 0;
               #0#36 = #agifa324#2;
          |FINSI;
          |CIERRA #agifa324;
     |FINSI;

     |SI con ! 1;
          |HAZ EsTecatel;
          |SI FSalida = 0;
               |HAZ TecaModPedVta;
               |SI FSalida ! 0;
                    |ERROR; |ACABA;
               |FINSI;
          |FINSI;
     |FINSI;
     |SI con = 2;
          |SI nForma = 1; |O #0#24 = 0;
               |C_M #0#1, 1, "S";
               ||C_M #0#4, 1, "S";
               |C_M #0#7, 1, "S";
               |C_M #0#9, 1, "S";
               |C_M #0#35, 1, "S";
               |C_M #0#36, 1, "S";
               |C_M #0#37, 1, "S";
               |C_M #0#5, 1, "S";
               |C_M #0#17, 1, "S";
               |C_M #0#6, 1, "S";
          |SINO;
               |C_M #0#1, 1, "N";
               ||C_M #0#4, 1, "N";
               |C_M #0#7, 1, "N";
               |C_M #0#9, 1, "N";
               |C_M #0#35, 1, "N";
               |C_M #0#36, 1, "N";
               |C_M #0#37, 1, "N";
               |C_M #0#5, 1, "N";
               |C_M #0#17, 1, "N";
               |C_M #0#6, 1, "N";
          |FINSI;
     |FINSI;
     |SI con = 2;|O con = 3;
          |SI #agifa104#27 = "S";
               |MENAV "0000Pedido no modificable. Esta exportado.";
               |ERROR; |ACABA;
          |FINSI;
     |FINSI;

     |SI con = 2;
          |HAZ EsAlbero;
          |SI FSalida = 0;
               |SI nForma = -1;
                    nSwNohacer = 0;
                    eaSerPedido = #agifa104#25;
                    enNumPedido = #agifa104#0;

                    enSwHayOrdMez = 0;
                    enSwHayFinaliz = 0;
                    |HAZ MiraOrdenMezAsociadas;
                    |SI enSwHayOrdMez = 1;
                         aMensaje = "0000NPedido con Ordenes Fabrib./Mezcladas Asociadas. Continuar?";
                         |CONFI aMensaje;
                         |SI FSalida = 0;
                              |SI enSwHayFinaliz = 1;
                                   aMensaje = "0000Ordenes Fabribacion o Mezcladas Finalizar. Modificacion no permitida.";
                                   |MENAV aMensaje;
                                   nSwNohacer = 1;
                                   |ERROR;
                                   |ACABA;
                              |FINSI;

                              |ABRE #agifa073;
                              #agifa073#28 = #agifa104#25;
                              #agifa073#0 = #agifa104#0;
                              #agifa073#1 = 1;
                              |LEE 000#agifa073.=;
                              |SI FSalida = 0;
                                   eaArtMod = #agifa073#2;
                                   enCanMod = #agifa073#5;
                              |SINO;
                                   nSwNohacer = 1;
                              |FINSI;
                              |CIERRA #agifa073;
                         |SINO;
                              nSwNohacer = 1;
                              |ERROR;
                              |ACABA;
                         |FINSI;
                    |SINO;
                         nSwNohacer = 1;
                    |FINSI;
               |SINO;
                    |SI nSwNohacer = 0;
                         |SI enSwHayOrdMez = 1;
                              aMensaje = "0000Se procede a Actualizar las Ordenes y Mezcladas asociadas";
                              |MENAV aMensaje;
                              |ABRE #agifa073;
                              #agifa073#28 = #agifa104#25;
                              #agifa073#0 = #agifa104#0;
                              #agifa073#1 = 1;
                              |LEE 000#agifa073.=;
                              |SI FSalida = 0;
                                   |SI eaArtMod = #agifa073#2;
                                        nDif = #agifa073#5 - enCanMod;
                                        eaArtMod = #agifa073#2;
                                        enCanMod = nDif;
                                        enAlmMod = #agifa073#3;
                                   |SINO;
                                        aMensaje = "0000Imposible Actualizar Ordenes/Mezcladas. Cambio de Articulo en Pedidos";
                                        |MENAV aMensaje;
                                        nSwNohacer = 1;
                                   |FINSI;
                              |SINO;
                                   nSwNohacer = 1;
                              |FINSI;
                              |CIERRA #agifa073;

                              |SI nSwNohacer = 0;
                                   eaSerPedido = #agifa104#25;
                                   enNumPedido = #agifa104#0;
                                   |HAZ ModOrdenMezcladasAlb;
                              |FINSI;
                         |FINSI;
                    |FINSI;
               |FINSI;
          |FINSI;
          |HAZ EsEvaristo;
          |SI FSalida = 0;
               |HAZ EvaAct21;
          |FINSI;
     |FINSI;

     |SI con = 3;|Y #0#24 > 0;
          |MENAV mensaje10;
          |ERROR; |ACABA;
     |FINSI;
     |SI con = 3;                  || BAJA.
          sw_reserva = 0;
          |BUCLE mira_ser;
          |SI sw_reserva ! 0;
               |MENAV "0000El pedido tiene unidades servidas...";
               |ERROR; |ACABA;
          |FINSI;
          ||컴컴컴컴컴컴컴Modulo 000577
          |HAZ EsDiagram;
          |SI FSalida = 0;
               |HAZ DiagBajPed;
               |SI FSalida ! 0;
                    |ERROR; |ACABA;
               |FINSI;
          |FINSI;
          ||컴컴컴컴컴컴컴횺odulo 003679
          |HAZ EsMecanogra;
          |SI FSalida = 0;
               |HAZ MecaBajaPed;
               |SI FSalida ! 0;
                    |ERROR; |ACABA;
               |FINSI;
          |FINSI;
          ||컴컴컴컴컴컴컴횺odulo 003026
          |SI nSwAlbero = 0;
               |HAZ AlbePedVBorra;
          |FINSI;
          ||컴컴컴컴컴컴컴컴컴컴컴컴컴
          |HAZ EsMecanogra;
          |SI FSalida = 0;
               eaSerie = #0#25;
               enNumero = #0#0;
               |SUB_EJECUTA_NP "mecam005;BAJA";
          |FINSI;
          ||컴컴컴컴컴컴컴컴컴컴컴컴컴
          |SI nSwCoimasa = 0;
               eaSerie = #0#25;
               enDocu = #0#0;
               |SUB_EJECUTA_NP "coima006;BAJA";
          |FINSI;
          ||컴컴컴컴컴컴컴컴컴컴컴컴컴
          |HAZ EsTagloma;
          |SI FSalida = 0;
               |HAZ TagloAuxBaja;
               aAlfa = ("000000" + #0#0) % -106;
               |ABRE #146; |SELECT #6#146;
               #146#62 = "P";
               #146#60 = #0#25;
               #146#61 = aAlfa;
               |LEE 101#146=;
               |SI FSalida = 0;
                    #146#62 = "";
                    #146#60 = "";
                    #146#61 = "";
                    #146#83 = "N";
                    |GRABA 020#146a;
               |FINSI;
               |CIERRA #146;
               |HAZ TagloBajaImo;
          |FINSI;
          ||컴컴컴컴컴컴컴컴컴컴컴컴컴
          |HAZ EsDefelino;
          |SI FSalida = 0;
               |HAZ DefelinoFab;
               |SI nError ! 0; |ERROR; |ACABA; |FINSI;
          |FINSI;
          ||컴컴컴컴컴컴컴컴컴컴컴컴컴
          |HAZ EsOrts;
          |SI FSalida = 0;
               eaTipo = "P";
               eaSerie = #0#25;
               enCodigo = #0#0;
               |SUB_EJECUTA_NP "ortsm021;BAJA";
          |FINSI;
          |HAZ EsCercama;
          |SI FSalida = 0;
               eaSerie = #0#25;
               enCodigo = #0#0;
               |SUB_EJECUTA_NP "cerca002";
          |FINSI;
          |HAZ EsOk5050;
          |SI FSalida = 0;
               eaSerie = #0#25;
               enCodigo = #0#0;
               |SUB_EJECUTA_NP "okz00002;V";
          |FINSI;
          |HAZ EsEvaristo;
          |SI FSalida = 0;
               |HAZ EvaBorraTotalPed;
          |FINSI;
          |HAZ EsChampiEmar;
          |SI FSalida = 0;
               |HAZ ChampEmarBorraPed;
          |FINSI;

          BAdela = 1;
          TipoCta = "P";
          SPedido = #0#25;
          NPedido = #0#0;
          |SUB_EJECUTA_NP "agis0002"; || Borra Entragas a cuenta
     |FINSI;

     |SI control = 1;
          control = 0;
          #0#12 = 0;
          #0#13 = 0;
          #0#43 = 0;
          #0#44 = 0;
          |HAZ baallpp;
     |FINSI;

     nImpoIva = 0;
     |ABRE #1;
     |ABRE #19;
     |BUCLELIN 2 ActCli #0;
     |CIERRA #1;
     |CIERRA #19;
     nImpo = nImpoIva; eaTag = "PE";  |HAZ Riesgos;

     |HAZ EsVigor;
     |SI FSalida = 0;
          |HAZ VigorViaje;
     |FINSI;
     |CIERRA #0;
     ||컴컴컴컴컴컴Automatizacion Empresas
     |ABRE #dsm00114; |LEE 000#dsm00114.p; nSal = FSalida; |CIERRA #dsm00114;
     |SI nSal = 0;
          eaCli = #0#4;
          |SI nForma = 1;
               aAlfa = "dsz99983;PEDALTA" + #0#25 + (("000000" + #0#0) % -106);
               |SUB_EJECUTA aAlfa;
          |SINO;
               aAlfa = "dsz99983;PEDBAJA" + #0#25 + (("000000" + #0#0) % -106);
               |SUB_EJECUTA aAlfa;
          |FINSI;
     |FINSI;
     ||컴컴컴컴컴
|FPRC;

|PROCESO aallpp;|TIPO 0;
     |ABRE #19;
     #19#0 = #3#2;
     |LEE 020#19=;
     |CIERRA #19;

     |SI caltot = 0;
          |LEE 101#3=;
          |PINTA 445,#3#1;
     |FINSI;

     #3#19 = #1#4;
     #3#16 = #0#7;
     #3#17 = #0#16;
     #3#20 = #0#4;
     #3#23 = #0#5;
     #3#24 = #0#6;
     #3#25 = #0#17;
     #3#26 = #0#9;

     |HAZ TotalLin73;
     |SI ac_divisa = "S"; |Y #agifa321#3= "S";
          |PINTA #3#41; || Si las divisas y la visualizacion estan activadas, pinto
     |FINSI;

     #0#11 = #0#11 + #3#9;
     #0#12 = #0#12 + #3#11;
     #0#13 = #0#11 - #0#12;

     |SI #19#194 = 2;
         nPend = (#3#44 - #3#43) * #3#38;
     |SINO;
         nPend = (#3#5 - #3#43)  * #3#38;
     |FINSI;
     nPend = ((((nPend < #3#8) < #3#29) < #0#5) < #0#17) < #0#6;

     #0#42 = #0#42 + #3#39;
     #0#43 = #0#43 + nPend;
     #0#44 = #0#42 - #0#43;

     |GRABA 020#3a;
     |LIBERA #3;
|FPRC;

|PROCESO baallpp;|TIPO 0;
     |MENSA mensaje11;
     #0#11 = 0;
     #0#12 = 0;
     #0#42 = 0;
     #0#43 = 0;
     |BUCLELIN 2aallpp#0;
     |BLIN 4;
|FPRC;

|PROCESO PantaDesglo;
     |C_P #0#52, 0, nPosi;
     |C_P #0#52, 1, 1251;
     |C_M #0#52, 1, "S";

     |PUSHV 0501 2380;

     |BLANCO 1127 1455;
     |CUADRO 1127 1455;
     |PINTA 1228, " PORCENTAJE DESGLOSE :     ";
     |ENCAMPO #52#0;

     |POPV;
     |C_P #0#52, 1, nPosi;
     |C_M #0#52, 1, "N";
|FPRC;

|PROCESO TieneLin104;
     aTieneLin = "S";
|FPRC;

|PROCESO siimpre1;|TIPO 3;
     nEntrada = (FEntrada /100) ! 0;
     |SI nEntrada = 4; |ACABA; |FINSI;

     enModo104 = 0;

     aTieneLin = "N";
     |BUCLELIN 2 TieneLin104 #0;
     |SI aTieneLin = "N";
          |BORRA 020#0c;
          |ERROR; |ACABA;
     |FINSI;

     |HAZ CalCabAgifa104;

     |ABRE #1;
     #1#0 = #0#4;
     |LEE 040#1=;
     |SI FSalida ! 0;  |DDEFECTO #1;  |FINSI;
     |CIERRA #1;

     |SI #0#13 = 0;
         |SI #0#52 = 0;
             |SI #1#198 ! " ";
                 |CONFI "2400NDetectado Cliente con Desglose lo activamos en el pedido : ";
                 |SI FSalida = 0;
                     |HAZ PantaDesglo;
                 |FINSI;
             |FINSI;
         |SINO;
             |HAZ PantaDesglo;
         |FINSI;
     |FINSI;

     || A partir pedido crear el de compras

     |SI nEntrada [ 2; |Y #agifa142#37 = "S"; |Y #0#34 = "N";
          |CONFI "0000NDesea generar los Pedidos de Compra de forma automatica ? ";
          |SI FSalida = 0;
               |GRABA 010#agifa104.a; || Si no grababa, perdia los valores en el sub_ejecuta
               |LIBERA #0;
               aSeriePedido  = #agifa104#25;
               aNumeroPedido = #agifa104#0;
               |CIERRAT #0;
               |SUB_EJECUTA_NP "agifa218.tab";
               |ABRET #0;
               |LEE 101#0=;
          |FINSI;
     |FINSI;
     ||컴컴컴컴컴컴컴Modulo 000577
     |HAZ EsDiagram;
     |SI FSalida = 0;
          |HAZ DiagFinPed;
     |FINSI;
     ||컴컴컴컴컴컴컴컴컴컴Modulo 000323
     |HAZ EsTecatel;
     |SI FSalida = 0;
          eaSer = #0#25;
          enDocu = #0#0;
          eaCodigo = #0#4;
          eaTipo = "PE";
          |HAZ TecaTrans;
     |FINSI;
     ||컴컴컴컴컴컴컴컴컴컴컴컴컴
     |HAZ EsTagloma;
     |SI FSalida = 0;
          num_alb = 0;
          fec_alb = #0#1;
          eaSerPedido = #0#25;
          enNumPedido = #0#0;
          |GRABA 021#0a;
          |LIBERA #0;
          |CIERRAT #0;
          |HAZ TagloFacPed;
          |CONFI "0000N풞signar procesos al pedido?";
          |SI FSalida = 0;
               ser_ped = #0#25;
               num_ped = #0#0;
               |SUB_EJECUTA_NP "tagz0018;N";
          |FINSI;
          |ABRET #0;
          #0#25 =  eaSerPedido;
          #0#0 = enNumPedido;
          |LEE 121#0=;
          |SI num_alb ! 0; |ACABA; |FINSI;
     |FINSI;
     ||--------------------------
     |SI enProg211 = 211; |ACABA; |FINSI; ||cuando viene  de Adj.Pedio (F10)
     ||--------------------------

     |||HAZ EsMecanogra;
     |||SI FSalida = 0;
     ||     |HAZ MecaCheqImpre;    || Quitado segun tiquet 3679/69
     |||SINO;
          FSalida = 0;   ||La estandar (siempre imprime)
     |||FINSI;

     |SI FSalida = 0;
          |CONFI "2400NDesea imprimir este pedido? ";
          |SI 0 = FSalida;
               |HAZ impreal1;
          |FINSI;
     |FINSI;

     |HAZ EsCoimasa;
     |SI FSalida = 0;
          |HAZ CoimaEnviaMail;
     |FINSI;

     |SI #41#246 = "S";
          |CONFI "2400NAdjudicar pedido venta?";
          |SI FSalida = 0;
               |HAZ AdjPedido;
          |FINSI;
     |FINSI;
     |SI enSwPrimiPDA = 1; |Y nEntrada = 2;
          |HAZ EsPrimicias;
          |SI FSalida = 0;
               |CONFI "0000SExportar pedidos al PDA?";
               |SI FSalida = 0;
                    |SUB_EJECUTA_NP "primz006;AUTO";
               |FINSI;
          |FINSI;
     |FINSI;
     |HAZ EsBerria;
     |SI FSalida = 0;
          ser_ped = #0#25;
          num_ped = #0#0;
          |SUB_EJECUTA_NP "berz0005;PREGUNTA";
     |FINSI;
     |HAZ EsFergalsan;
     |SI FSalida = 0;
          ser_ped = #0#25;
          num_ped = #0#0;
          eaFergaCli = #0#4 + #0#8;
          eaFergaDir = (("0000" + #0#57) % -104) + #0#19;
          |SUB_EJECUTA_NP "fergaz05";
          |HAZ FergaDefectoGra;
     |FINSI;

     nSwEvaFuerza = 1;
     |HAZ EvaTotalPed;
|FPRC;

|PROCESO impreal1;
     modo = (FEntrada / 100) ! 0;
     |SI modo = 1; |O modo = 2;
          |GRABA 021#0a;
          |LIBERA #0;
     |FINSI;
     ser_ped = #0#25;
     num_ped = #0#0;
     |CIERRAT #0;
     |SUB_EJECUTA_NP "agifa105.run";
     |ABRET #0;
     #0#25 = ser_ped;
     #0#0 = num_ped;
     |SI modo = 4;
          |LEE 001#0=;
     |SINO;
          |LEE 101#0=;
     |FINSI;
|FPRC;

|PROCESO mirainf;
     |ABRE #40;
     #40#26 = #0#25;
     |LEE 001#40=;
     |SI FSalida = 0;
          informe = #40#0;
     |SINO;
          informe = "agifa104";
     |FINSI;
     |CIERRA #40;
     |QBF informe;
|FPRC;

|PROCESO Extracto;
     |SI nTecla = 13; ||F5
          modo = (FEntrada / 100) ! 0;
          |SI modo = 4;
               |ABRE #1;
               #1#0 = #0#4;
               |LEE 001#1=;
               |SI FSalida ! 0; |DDEFECTO #1; |FINSI;
               |CIERRA #1;
          |FINSI;
          |PUSHV 0501 2380;
          ext1 = #1#16;
          |SUB_EJECUTA_NP "caextrap.run";
          |POPV;
          |ERROR;
     |FINSI;
|FPRC;

|PROCESO Menus;
     |MENU menu;
     |SI FSalida = 1;    ||Automatico
          |ABRE #42;
          #42#2 = "";
          #42#0 = "clientes";
          |LEE 101#42=;
          |SI FSalida = 0;
               #42#1 = #42#1 + 1;
               contador = #42#1;
               |GRABA 021#42a;
          |SINO;
               contador = 1;
               #42#1 = 1;
               |GRABA 021#42n;
          |FINSI;
          cont = contador;
          cont = ("000000" + cont) % -106;
          #0Campo = cont;
          |PINTA #0Campo;
          |LIBERA #42;
          |CIERRA #42;
     |FINSI;
|FPRC;

|PROCESO LeeMonBase; ||Lee los parametros de la moneda base
     |ABRE #agifa321;
     |ABRE #agifa324;
     |LEE 010#agifa321.p;   ||Leo parametros de divisa
     #agifa104#40 = #agifa321#9;  ||Cojo la Moneda Base de parametros
     #agifa324#0 = #agifa321#9;
     |LEE 010#agifa324.=;         ||Leo la ficha de la moneda base en Divisas
     #agifa104#41 = #agifa324#2;  ||Asigno el cambio de la moneda base con el euro
     decim_base = #agifa324#7;    ||Asigno los decimales de la moneda base
     precio_base = #agifa324#9;   ||Asigno los decimales del precio en la mon. base
     |CIERRA #agifa324;
     |CIERRA #agifa321;
|FPRC;

|PROCESO Param_Divisas; |TIPO 0;
     pintado = 0;  ||Controla pintados de las lineas

     |ABRE #agifa324;
     #agifa324#0 = #agifa104#35;
     |LEE 001#agifa324.=;   || Leo la divisa
     |CIERRA #agifa324;

     decim_divisa = #agifa324#7;  || Decimales de la divisa
     precio_divisa = #agifa324#9;  || Decimales en el precio de la divisa
     nDeci_DivP = decim_divisa;   || Decimales de la divisa
     nDeci_PreDivP = precio_divisa;  || Decimales en el precio de la divisa
     |SI #0#37 = "B";   ||Si trabajo con la moneda base ...
          nDeci_PreVis    = precio_divisa;
          nDeci_ImpVis    = decim_divisa;
          nDeci_PreVisP   = precio_divisa;
          nDeci_ImpVisP   = decim_divisa;
          nDeci_Base     = decim_base;
          nDeci_PreBase  = precio_base;
          nDeci_BaseMxP  = decim_base;
          nDeci_PreBasMxP = precio_base;
          nDeci_TotVisP   = decim_base;
          nDeci_TotNoVisP = decim_divisa;
     |SINO;     ||Si trabajo con la divisa ...
          nDeci_PreVis    = precio_base;
          nDeci_ImpVis    = decim_base;
          nDeci_PreVisP   = precio_base;
          nDeci_ImpVisP   = decim_base;
          nDeci_Base      = decim_base; || Max. precision en los decimales de la moneda base
          nDeci_PreBase   = precio_base;  || Max. precision en los dec. del precio de la moneda base
         |SI #0#36 = 1;
              nDeci_BaseMxP   = decim_base;    || sin triangulacion
              nDeci_PreBasMxP = precio_base;
         |SINO;
              nDeci_BaseMxP   = #agifa321#10;  || con triangulacion
              nDeci_PreBasMxP = #agifa321#11;
         |FINSI;
          nDeci_TotVisP   = decim_divisa;
          nDeci_TotNoVisP = decim_base;
     |FINSI;
|FPRC;

|PROCESO LeeParamDiv; |TIPO 0;
     |ABRE #agifa321;
     |LEE 001#agifa321.p;    || Leo parametros de divisas
     |ABRE #agifa007;
     #agifa007#26 = #agifa104#25;
     |LEE 001#agifa007.=;        || Leo la serie

     |SI #agifa007#39 = "N"; |O #agifa321#1 = "N";
          #0#37 = "B";
     |FINSI;

     |SI #0#37 = "D";      || Si la mon. de trabajo es la divisa...
          || ...escondo los campos de la moneda base :
          |C_P #3#6 , 1 , 1009;
          |C_P #3#9 , 1 ,1026;
          |C_V #3#6 , 1 , "N";
          |C_V #3#9 , 1 , "N";
          |C_L #3#6 , 1 , "N";
          |C_L #3#9 , 1 , "N";
          |C_M #3#6 , 1 , "N";
          || ...y pongo en pantalla los de divisa
          |C_P #3#38 , 1 , 1544;
          |C_P #3#39 , 1 ,1568;
          |C_V #3#38 , 1 , "S";
          |C_V #3#39 , 1 , "S";
          |C_M #3#38 , 1 , "S";
          |C_L #3#38 , 1 , "S";
          |C_L #3#39 , 1 , "S";
          |SI #agifa007#39 = "S"; |Y #agifa321#1 = "S"; ||Si la serie es de ...
               ac_divisa = "S";  || ... divisas, y en parametros estan activadas ...
               || ... pongo como modificables los campos relacionados con divisas
               |C_M #0#35 , 1 , "S";
               |C_M #0#36 , 1 , "S";
               |C_M #0#37 , 1 , "S";
               |C_M #0#38 , 1 , "S";
               |C_M #0#39 , 1 , "S";
               |SI #agifa321#3 = "S";  || Si la visualizacion de parametros esta activada
                    || ... pongo los campos visual. de lineas como visualizables
                    |C_V #3#40, 1 , "S";
                    |C_V #3#41 , 1 , "S";
               |SINO;
                    || ... los pongo como no visualizables
                    |C_V #3#40 , 1 , "N";
                    |C_V #3#41 , 1 , "N";
               |FINSI;
          |SINO; || Si la serie no es de divisas, o no estan activados parametros
               ac_divisa = "N";
               #0#37 = "B";  || La moneda de trabajo es por fuerza la moneda base
               |PINTA #0#37;
               || Pongo como no modificables los campos relacionados con divisas
               |C_M #0#37 , 1 , "N";
               |C_M #0#38 , 1 , "N";
               |C_M #0#39 , 1 , "N";
               |C_M #0#35 , 1 , "N";
               |C_M #0#36 , 1 , "N";
               || Pongo como no visualizables los campos visual. de lineas
               |C_V #3#40, 1 , "N";
               |C_V #3#41, 1 , "N";
          |FINSI;
     |SINO;  || Si la moneda de trabajo es la moneda base
          || ...escondo los campos en divisa :
          |C_P #3#38 , 1 , 1009;
          |C_P #3#39 , 1 ,1026;
          |C_V #3#38 , 1 , "N";
          |C_V #3#39 , 1 , "N";
          |C_M #3#38 , 1 , "N";
          |C_L #3#38 , 1 , "N";
          |C_L #3#39 , 1 , "N";
          || ...coloco los campos en moneda base:
          |C_P #3#6 , 1 , 1544;
          |C_P #3#9 , 1 ,1568;
          |C_V #3#6 , 1 , "S";
          |C_V #3#9 , 1 , "S";
          |C_M #3#6 , 1 , "S";
          |C_L #3#6 , 1 , "S";
          |C_L #3#9 , 1 , "S";
          |SI #agifa007#39 = "S"; |Y #agifa321#1 = "S"; || Si la serie es de divisas...
               ac_divisa = "S"; || ... y divisas estan activadas en parametros
               || Pongo como modificables los campos relacionados con divisas
               |C_M #0#35 , 1 , "S";
               |C_M #0#36 , 1 , "S";
               |C_M #0#37 , 1 , "S";
               |C_M #0#38 , 1 , "S";
               |C_M #0#39 , 1 , "S";
               |SI #agifa321#3 = "S";  || Si la visualizacion esta activada en parametros ...
                    || Pongo como visualizables los campos visual. de las lineas
                    |C_V #3#40, 1 , "S";
                    |C_V #3#41 , 1 , "S";
               |SINO; || Los pongo como no visualizables
                    |C_V #3#40 , 1 , "N";
                    |C_V #3#41 , 1 , "N";
               |FINSI;
          |SINO;  || Si la serie no es de divisas o no estan activados los parametros
               ac_divisa = "N";
               #0#37 = "B";  || La moneda de trabajo es por fuerza la moneda base
               || Pongo como no modificables los campos relacionados con divisas
               |C_M #0#37 , 1 , "N";
               |C_M #0#38 , 1 , "N";
               |C_M #0#39 , 1 , "N";
               |C_M #0#35 , 1 , "N";
               |C_M #0#36 , 1 , "N";
               || Pongo como no visualizables los campos visual. de lineas
               |C_V #3#40, 1 , "N";
               |C_V #3#41, 1 , "N";
          |FINSI;
     |FINSI;
     |CIERRA #agifa007;
     |CIERRA #agifa321;
     |HAZ Param_Divisas;

     |HAZ EsChampiEmar;  || Cambia el total linea con dto
     |SI FSalida = 0;
          |C_V #3#9, 0, aAlfa;
          |SI aAlfa = "S";
               |C_P #3#9, 0, nPosi;
          |SINO;
               |C_P #3#39, 0, nPosi;
          |FINSI;
          |C_P #3#7, 1, nPosi;
          |C_V #3#7, 1, "S";
          |C_L #3#7, 1, "S";

          |C_V #3#9, 1, "N";
          |C_V #3#39, 1, "N";
     |FINSI;
|FPRC;

|PROCESO CambioDivisa; |TIPO 0;
     nModo104 = (FEntrada / 100) ! 0;
     |SI #0Campo ! Contenido; |Y nModo104 = 1;   ||Si cambia el valor o es alta
       |SI Campo = 4; || Si llamo al proceso desde el cod. de cliente ...
         |LEE 001#agifa024.=;
         #0#35 = #agifa024#192;  || Asigno la divisa por defecto del cliente
         #0#37 = #agifa024#193; || Asigno la moneda de trabajo del cliente
         |PINTA #0#37;
       |FINSI;
       #agifa007#26 = #agifa104#25;
       |LEE 001#agifa007.=;  || Leo la serie
        |SI #agifa007#39 = "S"; |Y #agifa321#1 = "S";
           |SI #agifa024#191 = "S"; || Si el cliente es de divisa pactada
              |ABRE #agifa328;
              |ABRE #agifa329;
              #agifa329#0 = #agifa104#4;
              #agifa329#2 = #agifa104#35;
              #agifa329#7 = "N";
              |SELECT #2#agifa329;  || Con esta clave ...
              |LEE 011#agifa329.=;  || ... busco periodos no finalizados de esa divisa
              |SI FSalida = 0;  || Si existe un periodo no finalizado
                |PARA div_act = 0; |SI div_act = 0; |HACIENDO;
                  #agifa104#35 = #agifa329#2;        || Cargo la divisa ...
                  #agifa104#36 = #agifa329#3;        || ...y el cambio
                  |LEE 001#agifa329.=;   || Leo las lineas de Clientes/Divisas
                  nfecha = #agifa104#1 - #agifa329#6;  || Resto la fecha de fin de periodo a la actual
                  |SI nfecha > 0;  || Si la fecha actual supera a la del periodo asignado ...
                     |MENAV "0000ATENCION deberia Actualizar primero la divisa en Clientes/Divisas";
                     cli_divisa = #agifa104#4;  || Le envio el cod. de cliente a "agifa328"
                     |SUB_EJECUTA_NP "agifa328.tab";  || Ejecuto Clientes/Divisas
                     |ERROR;
                  |SINO;
                     div_act = 1;  || Para salir del PARA
                  |FINSI;
                |SIGUE;
              |SINO;  || Si no existe un periodo no finalizado para esa divisa
                |MENAV "0000No existe un periodo activo para la divisa en Clientes / Divisas";
                cli_divisa = #agifa104#4;  || Le paso a "agifa328" el cliente
                |SUB_EJECUTA_NP "agifa328.tab";  || Ejecuto Clientes / Divisas
                |ERROR;
                ||#agifa104#35 = #agifa104#40;
                ||#agifa104#36 = #agifa104#41;
              |FINSI;
              |SELECT #1#agifa329;
              |CIERRA #agifa329;
              |CIERRA #agifa328;
           |SINO; || Si el cliente no es de Divisa pactada ...
              |ABRE #agifa324; || ...miro directamente en divisas
              #agifa324#0 = #agifa104#35;
              |LEE 001#agifa324.=;
              |SI FSalida = 0; ||Si existe la divisa...
                 #agifa104#36 = #agifa324#2; || la recojo
                 |SI #agifa324#6 ! -1; || Si los dias de margen de actualizacion no
                                       || son = -1 (indefinidos)
                   |PARA div_act = 0; |SI div_act = 0; |HACIENDO;
                      #agifa104#35 = #agifa324#0;        ||Cargo el valor de la divisa
                      #agifa104#36 = #agifa324#2;        ||Cargo el valor del cambio
                      |LEE 001#agifa324.=;  || Leo la divisa
                      nfecha = #agifa104#1 - #agifa324#4;
                      |SI nfecha > #agifa324#6; |Y #agifa324#6 ! -1;  || Si la fecha actual
                         |MENAV "0000ATENCION deberia Actualizar primero la divisa";
                         divisa = #agifa104#35;
                         |SUB_EJECUTA_NP "agifa326.tab";
                         |ERROR;
                      |SINO;
                         div_act = 1;
                      |FINSI;
                   |SIGUE;
                 |FINSI;
              |FINSI;
              |CIERRA #agifa324;
           |FINSI;
        |SINO;
          #agifa104#35 = #agifa104#40;
          #agifa104#36 = #agifa104#41;
        |FINSI;
     |PINTA #agifa104#35;
     |PINTA #agifa104#36;
     |SI Campo = 4; || Si llamo al proceso desde el cod. de cliente ...
       |HAZ LeeParamDiv;
       |HAZ Param_Divisas;
     |SINO;
       |HAZ Param_Divisas;
     |FINSI;
     |FINSI;
|FPRC;


|PROCESO LeePed; |TIPO 13;  || Sirve para cargar los valores cada vez que
                            || cambio de ficha
     |HAZ EsGesineed;
     |SI FSalida = 0;
          nSwEstaDocErp = 0;
          |HAZ MiraSiEstaDocErp;
          |SI nSwEstaDocErp = 1;
               |PINTA 0520, "* * * DOCUMENTO ASOCIADO * * *";
          |SINO;
               |PINTA 0520, "컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴";
          |FINSI;
     |FINSI;
     pintado = 0;   || controla pintado de las lineas
     |HAZ LeeMonBase;
     |HAZ LeeParamDiv;
     |HAZ Param_Divisas;
     ||컴컴컴컴컴컴컴컴컴컴
     |SI nSwAlbero = 0;
          |HAZ AlbePedVPinta;
     |FINSI;
     ||컴컴컴컴컴컴컴컴컴컴
     |HAZ EsPefimian;
     |SI FSalida = 0;
          |DDEF aAlfa;
          aAlfa = aAlfa + "dsm00264";
          |CARGA_DEF aAlfa, dsm00264@;
          |SI FSalida = 0;
               |DDEFECTO #dsm00264@;
               |ABRE #dsm00264@;
               #dsm00264@#0 = #0#25;
               #dsm00264@#1 = #0#0;
               |LEE 000#dsm00264@.=;
               |CIERRA #dsm00264@;
               |PINTA #dsm00264@#2;
               |DESCARGA_DEF #dsm00264@;
          |FINSI;
     |FINSI;

     |HAZ EsMecanogra;
     |SI FSalida = 0;
          |HAZ MecanoPin104;
     |FINSI;

     |SI nSwCoimasa = 0;
          |HAZ CoimaPin104;
          |C_M #0#52, 1, "S";
     |FINSI;

     |HAZ EsTagloma;
     |SI FSalida = 0;
          |HAZ TagloPin104;
     |FINSI;
     |HAZ EsOrts;
     |SI FSalida = 0;
          |HAZ OrtsPin104;
     |FINSI;
     |HAZ EsEvaristo;
     |SI FSalida = 0;
          |HAZ EvaTotalPed;
     |FINSI;
     |HAZ EsChampiEmar;
     |SI FSalida = 0;
          |HAZ ChampiEmarPed;
     |FINSI;
|FPRC;

|PROCESO cambfecha;
|SI #0#38 ! "O";
  #0#39 = "        ";
  |PINTA #0#39;
  |C_M #0#39,1,"N";
  |C_V #0#39,1,"N";
|SINO;
  |C_M #0#39,1,"S";
  |C_V #0#39,1,"S";
|FINSI;
|FPRC;

|PROCESO modomod; |TIPO 6;
   |SI nModo104 = 2; |Y #0Campo ! Contenido;
       |MENAV "0000No se puede modificar el campo.";
       #0Campo = Contenido;
       |PINTA #0Campo;
       |ERROR;
   |FINSI;
  |SI #0Campo ! Contenido; |Y Campo = 37;
    |HAZ LeeParamDiv;
    |HAZ Param_Divisas;
  |FINSI;
|FPRC;

|PROCESO caltotal; |TIPO 0; ||Proceso especial para casos determinados como
                            ||modificar los campos de cabecera en dtos, cambio divisas etc
                            ||Recalcula total pedido y pendiente...
                            ||En el caso de cambiar el cambio de divisas recalcula tambien precio... de lineas
     nModo104 = (FEntrada/100) ! 0;
     |SI nModo104 = 4; |O nModo104 = 1; |ACABA; |FINSI;

   |SI #0Campo ! Contenido;||Solo si cambia
     caltot = 1;
     |SI Campo = 36; ||Si viene del cambio divisa
         recalpre = 1; ||Recalcular tambien precios linea
     |FINSI;
     #agifa104#11 = 0;
     #agifa104#12 = 0;
     #agifa104#42 = 0;
     #agifa104#43 = 0;
     |BUCLELIN 2aallpp#0;
     |SI #0#37 = "D"; || Si la moneda de trabajo es la divisa
       #0#45 = #0#42;
       #0#46 = #0#43;
       #0#47 = #0#44;
       #0#48 = #0#11;
       #0#49 = #0#12;
       #0#50 = #0#13;
     |SINO;
       #0#45 = #0#11;
       #0#46 = #0#12;
       #0#47 = #0#13;
       #0#48 = #0#42;
       #0#49 = #0#43;
       #0#50 = #0#44;
     |FINSI;
     |PINTA #0#45;
     |PINTA #0#46;
     |PINTA #0#47;
     |GRABA 021#0a;  ||Grabo actual porque he rectificado las lineas y si
                     ||sale con Ctrl-c no coincidira el Dto de cabecera con las lineas
     caltot = 0;
     recalpre = 0;
   |FINSI;
|FPRC;

|PROCESO linf;
     #39#0 = #0#4;
     #39#1 = 1;
|FPRC;

|PROCESO lsup;
     #39#0 = #0#4;
     #39#1 = 9999;
|FPRC;

|PROCESO C; |TIPO 0;  ||Direccion de entrega
     nModo104 = (FEntrada / 100) ! 0;
     |MODULO aProg;                          || Cuando viene del Adj.Pedido
     |SI aProg = "agifa210"; |ACABA; |FINSI; || F10 en linea
     |SI aProg = "dsm01000"; |ACABA; |FINSI; || F10 en linea

     |SI nTecla = 11; |O #41#102 = "S"; |O #41#102 = "X";
          eaCodigo = #0#4;
          eaFuerza = "N";
          |SI nTecla = 11; eaFuerza = "S"; |FINSI;
          |SUB_EJECUTA_NP "dsz99994";
          |SI #41#102 = "N"; |Y nModo104 ! 2; |ERROR;  |FINSI;
     |FINSI;
|FPRC;

|PROCESO PintaObs; |TIPO 14;
     |ABRE #204;
     |LEE 040#204p;
     |SI FSalida ! 0;  |DDEFECTO #204;  |FINSI;
     |CIERRA #204;

     aAlfa = #agifa204#6; |QBF aAlfa;
     |SI aAlfa ! "";
         |ATRI I;  |PINTA 2105 , aAlfa;    |ATRI 0;
         |C_M #0#53 , 1 , "S";
     |FINSI;

     aAlfa = #agifa204#7; |QBF aAlfa;
     |SI aAlfa ! "";
         |ATRI I;  |PINTA 2130 , aAlfa;    |ATRI 0;
         |C_M #0#54 , 1 , "S";
     |FINSI;

     aAlfa = #agifa204#8; |QBF aAlfa;
     |SI aAlfa ! "";
         |ATRI I;  |PINTA 2155 , aAlfa;    |ATRI 0;
         |C_M #0#55 , 1 , "S";
     |FINSI;

     |ATRI I;
|FPRC;

|PROCESO FEntra104_7; |TIPO 7;
     |SI FSalida = 0;
          |SI nSwAlbero = 0;
               |HAZ AlbePedVEntra;
          |FINSI;
     |FINSI;

     |SI FSalida ! 2;
          |HAZ EsTagloma;
          |SI FSalida = 0;
               enModo = (FEntrada / 100) ! 0;
               eaImp = #0#58;
               aAlfa = "tagw0042;" + #0#25 + #0#0;
               |SUB_EJECUTA_NP aAlfa;
               #0#58 = eaImp; |PINTA #0#58;
               |HAZ TagloPin104;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO agifa104_agit;
     || Reconstruccion del agit0000 con los procesos en T104_15 y T104_16

     |GRABA 000#agifa104.a;
     |LIBERA #agifa104;
|FPRC;

|DEFBUCLE agifa104_agit;
     #agifa104#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, agifa104_agit;
|FIN;

|PROCESO Tipo104_80; |TIPO 80;
     |C_A #20#1, 1, 11;  ||Recorta descripcion agencia

     |HAZ EsAlbero;
     nSwAlbero = FSalida;
     |SI nSwAlbero = 0;
          |CONTROL_SIMPLE 0, "BOTON, Enviar Fax", 0561, 0573, AlberoEnvFax;
          nBoton = FSalida;
          |ESTADO_CONTROL nBoton, "ENABLE";
     |FINSI;

     |HAZ EsCoimasa;
     nSwCoimasa = FSalida;
     |SI nSwCoimasa = 0;
          |CONTROL_SIMPLE 0, "BOTON,F5.- Art죅ulos Pendientes", 0565, 0580, PF5;
          nBoton = FSalida;
          |ESTADO_CONTROL nBoton, "DISABLE";
     |FINSI;

     |HAZ EsChampiEmar;
     |SI FSalida = 0;
          |HAZ CreaTempo; eaTmpPV816 = Tempo;
     |FINSI;

     |HAZ EsFergalsan;
     |SI FSalida = 0;
         |ABRET #agit0000;
         |LEE 000#agit0000.p;
         |SI FSalida ! 0;
             |BUCLE agifa104_agit;
         |FINSI;
         |CIERRAT #agit0000;
     |FINSI;

     FSalida = "";
|FPRC;

|PROCESO Tipo104_90; |TIPO 90;
     |SI nSwAlbero = 0; |O nSwCoimasa = 0;
          |FIN_CONTROL_WINDOWS nBoton;
          |PULSATECLA;
     |FINSI;
     |SI eaTmpPV816 ! ""; Tempo = eaTmpPV816; |HAZ BoraTempo; |FINSI;
|FPRC;

|PROCESO PinBoton104; |TIPO 7;
     |SI nSwAlbero = 0;
          |ESTADO_CONTROL nBoton, "ENABLE";
     |FINSI;
|FPRC;

|PROCESO Curso0; |TIPO 0;
     nModo = (FEntrada / 100) ! 0;
     |SI FSalida = 0; |O FSalida = 3;
          |SI nSwCoimasa = 0;
               eaSerie = #0#25;
               enDocu = #0#0;
               eaCliente = #0#4;
               |SUB_EJECUTA_NP "coima006";
               |HAZ CoimaPin104;
          |FINSI;

          |HAZ EsEvaristo;
          |SI FSalida = 0;
               |HAZ EvaLeeTipoPed;
               |C_P #279#28, 1, 979;    || Este campo solo
               #279#28 = aTipo;         || se usa para
               |ENCAMPO #28#279;        || pedir el dato
               aTipo = #279#28;         || no se usa para nada mas
               |HAZ EvaGraTipoPed;      || en sitio alguno
          |FINSI;

     |FINSI;
     |C_M #0#51,1, "S";
|FPRC;

|PROCESO Curso7; |TIPO 7;
     |MENSA "0000Campo informativo";
     |HAZ EsTagloma;
     |SI FSalida = 0;
          |MENSA "0000<F11> Consulta Registro Entrada";
     |FINSI;

     |HAZ EsPefimian;
     |SI FSalida = 0;
          |C_M #0#51,1, "N";
          |DDEF aAlfa;
          aAlfa = aAlfa + "dsm00264";
          |CARGA_DEF aAlfa, dsm00264@;
          |SI FSalida = 0;
               |DDEFECTO #dsm00264@;
               |ABRE #dsm00264@;
               #dsm00264@#0 = #0#25;
               #dsm00264@#1 = #0#0;
               |LEE 101#dsm00264@.=;
               |SI FSalida ! 0; |GRABA 020#dsm00264@.b; |FINSI;
               |ENCAMPO #2#dsm00264@;
               #0#51 = #dsm00264@#2;
               |GRABA 020#dsm00264@.a;
               |CIERRA #dsm00264@;
               |DESCARGA_DEF #dsm00264@;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Curso66; |TIPO 66;
     |HAZ EsTagloma;
     |SI FSalida = 0;
          eaCurso = #0#51;
          |HAZ TagRegEnt;
          |SI eaCurso = "error";
               |ERROR;
          |SINO;
               #0#51 = eaCurso; |PINTA #0#51;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO MiraPartiBlan;
     #19#0 = #3#2;
     |LEE 000#19=;
     |SI #19#180 = "S";
          aAlfa = #3#45; |QBF aAlfa;
          |SI aAlfa = "";
               aMensaje = "0000Linea: " + #3#1 + " con partida en blanco.";
               |MENAV aMensaje;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO AdjPedido;
     |SI #agifa142#242 = "N";
          aMensaje = "";
          |ABRE #19;
          |BUCLELIN 2 MiraPartiBlan #0;
          |CIERRA #19;
          |SI aMensaje ! ""; |MENAV "0000No se Adjudica el Pedido..."; |ACABA; |FINSI;
     |FINSI;

     modo = (FEntrada / 100) ! 0;
     |SI modo = 1; |O modo = 2;
          |GRABA 021#0a;
          |LIBERA #0;
     |FINSI;
     ser_ped = #0#25;
     num_ped = #0#0;
     |CIERRAT #0;

     |SUB_EJECUTA_NP "dsz00067";

     |ABRET #0;
     #0#25 = ser_ped;
     #0#0 = num_ped;
     |SI modo = 4;
          |LEE 001#0=;
     |SINO;
          |LEE 101#0=;
     |FINSI;
|FPRC;

|PROCESO Tipo104_20; |TIPO 20;
     |SI FSalida ! "OPCION";
          |SELECT #1#0;
          |LEE 000#0=;
          |SI FSalida ! 0;
               |MENAV "0000Por favor, consulte el registro correcto antes de imprimir.";
               |ACABA;
          |SINO;
               |PINDA #0#0;
          |FINSI;
     |FINSI;
     |HAZ T104_20;
|FPRC;

|PROCESO T104_20;
     |SI nSwCoimasa = 0;
          enLin004082 = 0;
          |ESTADO_CONTROL nBoton, "DISABLE";
     |FINSI;
     |SI FSalida = "OPCION";
          FSalida = "Opciones";
          |ACABA;
     |FINSI;
     |HAZ EsTagloma;
     nSwTagloma = FSalida;

     |HAZ EsBerria;
     nSwBerria = FSalida;
     |SI nSwBerria = 0;
          aMenu7 = "Crear Orden";
          aMenu4 = "IAC";
     |FINSI;

     |SI nSwTagloma = 0; aMenu4 = "IAPg"; |FINSI;

     |MENU aMenu;
     aMenu2 = FSalida;

     |SI aMenu2 = 1;
          /*                       || Quitado segun tiquet 3679/69
          |HAZ EsMecanogra;
          |SI FSalida = 0;
               |HAZ MecaCheqImpre;
               |SI FSalida ! 0;
                    |MENAV "0000Hay lineas sin aceptar...";
                    |ERROR; |ACABA;
               |FINSI;
          |FINSI;*/

          |HAZ impreal1;
     |FINSI;
     |SI aMenu2 = 2; |HAZ AdjPedido; |FINSI;
     |SI nSwTagloma = 0; |Y aMenu2 = 3;
          ser_ped = #0#25;
          num_ped = #0#0;
          |SUB_EJECUTA_NP "tagm0079";
     |FINSI;
     |SI nSwTagloma = 0; |Y aMenu2 = 4;
          ser_ped = #0#25;
          num_ped = #0#0;
          |SUB_EJECUTA_NP "tagz0018;N";
     |FINSI;
     |SI nSwBerria = 0; |Y aMenu2 = 3;
          ser_ped = #0#25;
          num_ped = #0#0;
          |SUB_EJECUTA_NP "berz0005";
     |FINSI;
|FPRC;

|PROCESO PrecioCab104;
     |ABRE #19;
     #19#0 = #3#2;
     |LEE 020#19=;
     |CIERRA #19;

     |ABRE #1;
     #1#0 = #0#4;
     |LEE 000#1=;
     |CIERRA #1;

     fed_dt = #0#1;   || Fecha....
     art_dt = #3#2;   || Articulo.
     cli_dt = #3#20;  || Cliente..
     fam_dt = #3#18;  || Familia.
     iva_dt = #19#30;  || Tipo Iva.
     dtos_2 = 0;      || Descuento 2.
     dto_pt = 0;      || Descuento Ptas.
     dtos_1 = 0;      || Descuento 1.
     pvp_ve = 0;      || Precio Venta.
     tarifa = #1#39;  || Tarifa Cliente....
     gru_dt = #1#158; || Grupo Cliente.
     |SI #3#36 ! 0;
           uni_dt = #3#36;
     |SINO;
           uni_dt = #3#5;
     |FINSI;
     uni_dt2 = #3#44;
     nPromo = #0#56;
     enMensaje = 0;
     aParam = "";
     eaSerie = #3#28;
     enDirEnt = #0#57;
     |SI #19#176 = "S";  enMensaje = 1;  |FINSI;
     enAlmacen = #3#3;
     |HAZ calcdtos;    || Calculo Dtos.....
     #3#6   = pvp_ve - dto_pt;  || Precio Venta. sin iva.
     #3#8   = dtos_1;  || 1 Dto.
     #3#29  = dtos_2;  || 2 Dto.
|FPRC;

|PROCESO CreaLinProCab104;
     |ABRE #referen@;
     #referen@#28 = #3#28;
     #referen@#0 = #3#0;
     #referen@#1 = #3#55;
     |LEE 000#referen@.=;
     |SI FSalida = 0; |O #3#55 = 0;
          #referen@#1 = 999;
          |LEE 000#referen@.];
          |SI FSalida = 0;
               |LEE 000#referen@.a;
          |SINO;
               |LEE 000#referen@.u;
          |FINSI;
          |SI FSalida = 0; |Y #referen@#28 = #3#28;  |Y #referen@#0 = #3#0;
               nLin = #referen@#1 + 1;
          |SINO;
               nLin = 1;
          |FINSI;
          |SI nLin = #0#1; nLin = nLin + 1; |FINSI;
          #referen@#28 = #3#28;
          #referen@#0 = #3#0;
          #referen@#1 = nLin;
          |GRABA 020#referen@.b;
     |SINO;
          nLin = #3#55;
          |GRABA 020#referen@.b;
     |FINSI;
     |SALVA_DATOS #3;
     |REPON_DATOS #referen@;

     #referen@#1 = nLin;
     #referen@#5 = #3#58;
     #referen@#6 = 0;
     #referen@#7 = 0;
     #referen@#8 = 0;
     #referen@#9 = 0;
     #referen@#11 = 0;
     #referen@#12 = 0;
     #referen@#40 = 0;
     #referen@#41 = 0;
     #referen@#42 = #3#58;
     #referen@#43 = 0;
     #referen@#55 = -1;

     |SALVA_DATOS #3;
     |SALVA_DATOS #referen@;
     |REPON_DATOS #3;
     #3#1 = #referen@#1;
     enForma = 1;
     |HAZ AcumulaPV;
     |REPON_DATOS #3;

     |GRABA 020#referen@.a;
     |LIBERA #referen@;
|FPRC;

|PROCESO PediModLinea;
     #134#0 = #0#4;
     #134#1 = #3#2;
     |LEE 000#134=;
     |SI FSalida = 0; |Y #0#1 ] #134#6; |Y #0#1 [ #134#7;
          #3#20 = #0#4; || cliente
          |HAZ PrecioCab104;
          nUniPromo = #3#5 / #134#2;
          nResto = #3#5 $ #134#2;
          nResto = nResto / #134#2;
          nUniPromo = nUniPromo  - nResto;
          #3#6 = (#3#6 - #134#4) ! nDeci_Base;
          #3#56 = #134#4;
          #3#57 = #134#5;
          #3#58 = nUniPromo * #134#3;
          #3#8 = #134#5;
          |HAZ TotalLin73;
          |SI #3#58 = 0;
               #3#55 = 0;
          |SINO;
               |HAZ CreaLinProCab104;
               #3#55 = nLin;
          |FINSI;
          |GRABA 020#3a;
     |SINO;    || No tiene promocion
          #3#55 = 0;
          #3#56 = 0;
          #3#57 = 0;
          #3#58 = 0;
          |HAZ TotalLin73;
          |GRABA 020#3a;
     |FINSI;
     |LIBERA #3;
|FPRC;

|PROCESO BorraLinPromo104;
     |SI #3#55 = -1;
          enForma = -1;
          |HAZ AcumulaPV;
          |BORRA 020#3a;
     |FINSI;
|FPRC;

|PROCESO PediModLin;
     |CONFI "0000SActualizar promociones para el nuevo cliente?";
     |SI FSalida = 0;
          |DDEF aAlfa;
          aAlfa = aAlfa + "agifa073";
          |CARGA_DEF aAlfa, referen@;
          |SI FSalida = 0;
               |ABRE #134;
               |ABRE #referen@;
               |BUCLELIN 0 BorraLinPromo104 #0;
               |BUCLELIN 0 PediModLinea #0;
               |CIERRA #referen@;
               |CIERRA #134;
               |DESCARGA_DEF #referen@;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO VigorViaje;
     |DDEF aAlfa; aAlfa = aAlfa + "vigm0027";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida ! 0;
          |MENAV "0000ERROR al cargar 'vigm0027'";
          |ACABA;
     |FINSI;
     |DDEFECTO #referen@;
     |ABRE #referen@;
     #referen@#0 = #0#25;
     #referen@#1 = #0#0;
     |SI con = 3;
          |BORRA 040#referen@.c;
     |SINO;
          |LEE 101#referen@.=;
          #referen@#5 = #0#4;
          |SI FSalida = 0;
               |GRABA 020#referen@.a;
          |SINO;
               |GRABA 020#referen@.n;
          |FINSI;
     |FINSI;
     |CIERRA #referen@;
     |DESCARGA_DEF #referen@;
|FPRC;

|PROCESO AsignaDir104;
     #0#57 = #39#1; |PINTA #0#57;
     #0#19 = #39#10;|PINTA #0#19;
     #0#14 = #39#2; |PINTA #0#14;
     #0#20 = #39#3; |PINTA #0#20;
     #0#21 = #39#7; |PINTA #0#21;
     #0#59 = #39#6; |PINTA #0#59;
     |SI #39#14 = "  ";
         #0#7 = #1#25;
     |SINO;
         #0#7 = #39#14;
     |FINSI;
     |PINTA #0#7;

     |HAZ EsOrts;
     |SI FSalida = 0;
          eaTipo = "P";
          eaCliente = #0#4;
          eaSerie = #0#25;
          enCodigo = #0#0;
          |SUB_EJECUTA_NP "ortsm021;DEFECTO";
          |HAZ OrtsPin104;
     |FINSI;

     |HAZ EsFergalsan;
     |SI FSalida = 0;
         #0#8 = #39#10; |PINTA #0#8;
     |FINSI;
|FPRC;

|PROCESO CoimaImpPen;
     nImpo = nImpo + #referen@#12;
|FPRC;

|DEFBUCLE CoimaImpPen;
     #referen@#2003;
     57;
     #0#4, "     ", 000001, #0#57;
     #0#4, "zzzzz", 999999, #0#57;
     ;
     NULL, CoimaImpPen;
|FIN;

|PROCESO MinDir104;
     #39#0 = #0#4;
     #39#1 = 1;
|FPRC;

|PROCESO MaxDir104;
     #39#0 = #0#4;
     #39#1 = 9999;
|FPRC;

|PROCESO Dir104_0; |TIPO 0;
     |SI FSalida = 2; |ACABA; |FINSI;
     nTecla = FSalida;
     |SI nTecla = 12;    || F4 Alta direccion
          |PUSHV 0501 2380;
          |ENTLINEAL #1#39, -2, 1, 22, 1, MinDir104, MaxDir104;
          |POPV;
          nTecla = 18;
     |FINSI;
     |ABRE #39;
     |SI nTecla = 18;   || F10  Todas las direcciones
          #39#0 = #0#4;
          #39#1 = #0#57;
          |LEE 000#39];
          |CONSULTA_F_CLAVE #1#39, MinDir104, MaxDir104;
          |SI FSalida = 0;
               |HAZ AsignaDir104;
          |SINO;
               |ERROR; |ACABA;
          |FINSI;
     |FINSI;
     #39#0 = #0#4;
     #39#1 = #0#57;
     |LEE 000#39=;
     |SI FSalida = 0;
          |SI #39#18 = "N";
               |CONFI "0000NDireccion de entrega desactiva. 풠ontinuar?";
               |SI FSalida ! 0; |ERROR; |ACABA; |FINSI;
          |FINSI;
     |SINO;
          |MENAV "0000No existe direccion de entrega...";
          |ERROR; |ACABA;
     |FINSI;
     |CIERRA #39;
     |SI #0Campo ! Contenido;
          |HAZ AsignaDir104;
     |FINSI;

     |HAZ EsCoimasa;
     |SI FSalida = 0;
          |DDEF aAlfa;
          aAlfa = aAlfa + "agifa104";
          |CARGA_DEF aAlfa, referen@;
          |SI FSalida = 0;
               nImpo = 0;
               |BUCLE CoimaImpPen;
               |SI nImpo ! 0;
                    aAlfa = "0000Importe pendiente de servir:"+&13+ nImpo;
                    |MENAV aAlfa;
               |FINSI;
               |DESCARGA_DEF #referen@;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Dir104_7; |TIPO 7;
     |SI #41#71 = "S"; |Y enProg211 ! 211; ||enProg211 = 211 cuando viene
          |ABRE #39;                       ||de Adj.Pedio (F10)
          #39#0 = #0#4;
          #39#1 = 1;
          |LEE 000#39];
          |SI FSalida = 0; |Y #39#0 = #0#4;
               |LEE 000#39s;
               |SI FSalida = 0; |Y #39#0 = #0#4;
                    aSinError = "S";
                    |HAZ Dir104_66;
                    aSinError = "N";
                    |SI nSal = 0; |ERROR; |FINSI;
               |FINSI;
          |FINSI;
          |CIERRA #39;
     |FINSI;
|FPRC;

|PROCESO Dir104_66; |TIPO 66;
     nModo = (FEntrada / 100) ! 0;
     |ABRE #39;
     aSql = "SELECT * FROM dsm00003 INTO sq" + Usuario + ".def WHERE ";
     aSql = aSql + "0 == " + #0#4 + " AND 18 == S";
     |SQL aSql;
     |SI FSalida = 0;
          |DDEF aDef; |QBF aDef;
          aDef = aDef + "sq" + Usuario + ".mas";
          |CARGA_DEF aDef, referen@;
          |SI FSalida = 0;
               |ABRE #referen@;
               #referen@#0 = #0#4;
               #referen@#1 = #0#57;
               |LEE 000#referen@.]
               |CONSULTA_CLAVE #1#referen@;
               nSal = FSalida;
               |SI FSalida = 0;

                    |SI nModo ! 2; |O #referen@#0 ! #0#4; |O #referen@#1 ! #0#57;
                         #39#0 = #referen@#0;
                         #39#1 = #referen@#1;
                         |LEE 020#39=;
                         |HAZ AsignaDir104;
                    |FINSI;
               |SINO;
                    |SI aSinError ! "S";
                         |ERROR;
                    |FINSI;
               |FINSI;
               |CIERRA #referen@;
               |DELINDEX #referen@;
               |DESCARGA_DEF #referen@;
               |FBORRA aDef;
          |FINSI;
     |FINSI;
     |CIERRA #39;
|FPRC;

|PROCESO MecanoPin104;
     nModo = (FEntrada / 100) ! 0;
     |DDEF aAlfa;
     aAlfa = aAlfa + "mecam005";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |DDEFECTO #referen@;
          |ABRE #referen@;
          #referen@#0 = #0#25;
          #referen@#1 = #0#0;
          |LEE 000#referen@.=;
          |SI FSalida ! 0; |GRABA 020#referen@.b; |FINSI;
          |CIERRA #referen@;
          |PINTA 1001, " Ace.Cliente...:                                         ";
          |PINTA 1201, " Ace.Financiera:                                         ";
          |ATRI I;
          |PINTA #referen@#2;
          |PINTA #referen@#3;
          |PINTA #referen@#4;
          |PINTA #referen@#5;
          |PINTA #referen@#6;
          |PINTA #referen@#7;
          |ATRI 0;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|PROCESO T104_36_0; |TIPO 0;
     nModo = (FEntrada / 100) ! 0;
/*
     |SI FSalida = 0; |O FSalida = 3;
          |HAZ EsMecanogra;
          |SI FSalida = 0;
               eaSerie = #0#25;
               enNumero = #0#0;
               |SUB_EJECUTA_NP "mecam005";
          |FINSI;
     |FINSI;
     |HAZ MecanoPin104;
*/
|FPRC;

|PROCESO MecaCheqOrden;
     |SI #mecam006@#8 ! 0;
          nSal = 1;
     |FINSI;
|FPRC;

|DEFBUCLE MecaCheqOrden;
     #mecam006@#1003;
     ;
     #0#25, #0#0, 001;
     #0#25, #0#0, 999;
     ;
     NULL, MecaCheqOrden;
|FIN;

|PROCESO MecaBajaPed;
     nSal = 0;
     |DDEF aAlfa;
     aAlfa = aAlfa + "mecam006";
     |CARGA_DEF aAlfa, mecam006@;
     |SI FSalida = 0;
          |BUCLE MecaCheqOrden;
          |DESCARGA_DEF #mecam006@;
     |FINSI;
     |SI nForma = -1; |Y nSal ! 0;
          |MENAV "0000Hay lineas ordenadas...";
     |FINSI;
     |SI nSal = 0;
          aAlfa = aAlfa + "mecam005";
          |CARGA_DEF aAlfa, mecam005@;
          |SI FSalida = 0;
               |ABRE #mecam005@;
               #mecam005@#0 = #0#25;
               #mecam005@#1 = #0#0;
               |BORRA 000#mecam005@.c;
               |CIERRA #mecam005@;
               |DESCARGA_DEF #mecam005@;
          |FINSI;
     |FINSI;
     FSalida = nSal;
|FPRC;

|PROCESO MecaCheqImp;
     #mecam006@#6 = #mecam005@#2;
     #mecam006@#7 = #mecam005@#3;
     |GRABA 020#mecam006@.a;       || Actualiza los campos
     |LIBERA #mecam006@;

     |SI #mecam006@#4 = "N"; |O #mecam006@#6 = "N";
          nSal = 1;
     |FINSI;
|FPRC;

|DEFBUCLE MecaCheqImp;
     #mecam006@#1003;
     ;
     #0#25, #0#0, 001;
     #0#25, #0#0, 999;
     be;
     NULL, MecaCheqImp;
|FIN;

|PROCESO MecaCheqImpre;
     nSal = 0;
     |DDEF aPath;
     aAlfa = aPath + "mecam005";
     |CARGA_DEF aAlfa, mecam005@;
     |SI FSalida = 0;
          aAlfa = aPath + "mecam006";
          |CARGA_DEF aAlfa, mecam006@;
          |SI FSalida = 0;
               |ABRE #mecam005@;
               #mecam005@#0 = #0#25;
               #mecam005@#1 = #0#0;
               |LEE 000#mecam005@.=;
               |SI FSalida ! 0; |GRABA 020#mecam005@.n; |FINSI;
               |BUCLE MecaCheqImp;
               |CIERRA #mecam005@;
               |DESCARGA_DEF #mecam006@;
          |FINSI;
          |DESCARGA_DEF #mecam005@;
     |FINSI;
     FSalida = nSal;
|FPRC;

|PROCESO MecaRiesgo;
     |DDEF aAlfa;
     aAlfa = aAlfa + "mecam005";
     |CARGA_DEF aAlfa, mecam005@;
     |SI FSalida = 0;
          |DDEFECTO #mecam005@;
          |ABRE #mecam005@;
          #mecam005@#0 = #0#25;
          #mecam005@#1 = #0#0;
          |LEE 101#mecam005@.=;
          |SI FSalida ! 0; |GRABA 020#mecam005@.b; |FINSI;

          |SI nModo ! 2; |Y #mecam005@#2 ! "S"; || condicion a쨅dida segun tiquet 3679/43

               |SI #mecam005@#3 = "01.01.0000";
                    |SI #mecam005@#2 = "S"
                         |MENAV "0000Pedido denegado financieramente por limite de riesgo";
                         #mecam005@#2 = "N";
                         |GRABA 020#mecam005@.a;
                    |FINSI;
               |SINO;
                    |MENAV "0000Pedido aceptado financieramente por direccion con cambios que superan el riesgo";
               |FINSI;
          |FINSI;

          |CIERRA #mecam005@;
          |DESCARGA_DEF #mecam005@;
     |FINSI;
|FPRC;

|PROCESO MecaGra5;
     |DDEF aAlfa;
     aAlfa = aAlfa + "mecam005";
     |CARGA_DEF aAlfa, mecam005@;
     |SI FSalida = 0;
          |DDEFECTO #mecam005@;
          |ABRE #mecam005@;
          #mecam005@#0 = #0#25;
          #mecam005@#1 = #0#0;
          |LEE 101#mecam005@.=;
          |SI FSalida ! 0; |GRABA 020#mecam005@.b; |FINSI;
          #mecam005@#2 = "S";
          #mecam005@#3 = "01.01.0000";
          |GRABA 020#mecam005@.a;
          |CIERRA #mecam005@;
          |DESCARGA_DEF #mecam005@;
     |FINSI;
|FPRC;

|PROCESO Pago7_104; |TIPO 7;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 1;
          |HAZ EsTagloma;
          |SI FSalida = 0;
               eaAlfa = #0#25;
               |HAZ TagloDefFP;
               |SI eaAlfa ! ""; #0#9 = eaAlfa; |PINTA #0#9; |FINSI;
               |SI eaQuitaDto = "S";
                    #0#5 = 0; |PINTA #0#5;
                    #0#17 = 0; |PINTA #0#17;
                    #0#6 = 0; |PINTA #0#6;
               |FINSI;
          |FINSI;
          |HAZ EsGestral;
          |SI FSalida = 0;
               eaAlfa = #0#25;
               |HAZ GestrDefFP;
               |SI eaAlfa ! ""; #0#9 = eaAlfa; |PINTA #0#9; |FINSI;
               |SI eaQuitaDto = "S";
                    #0#5 = 0; |PINTA #0#5;
                    #0#17 = 0; |PINTA #0#17;
                    #0#6 = 0; |PINTA #0#6;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Conta_PV7; |TIPO 7;
     |HAZ EsFergalsan;
     |SI FSalida = 0; |ACABA; |FINSI;

     |SI nSwCoimasa = 0;
          |ESTADO_CONTROL nBoton, "DISABLE";
     |FINSI;

     |HAZ ContaPV7;

     nModo = (FEntrada/ 100) ! 0;
     |HAZ EsOrts;
     |SI FSalida = 0; |Y nModo = 1;
          #0#51 = Usuario % 810; |PINTA #0#51;
     |FINSI;
|FPRC;

|PROCESO ContaPV; |TIPO 0;
     |HAZ ContaPV0;

     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 1;
          |MODULO aAlfa;
          |SI nSwCoimasa = 0; |Y aAlfa ! "agifa210";
               |HAZ CoimaPin104;
          |FINSI;

          |HAZ EsFergalsan;
          |SI FSalida = 0;
               #0#51 = Usuario % 810; |PINTA #0#51;
          |FINSI;
/*
||Quitado segun  Subtiquet nro. 00112.0013 Cliente: 003679
          |HAZ EsMecanogra;
          |SI FSalida = 0;
               |ABRE #146;
               #146#48 = #0#25;
               #146#0 = #0#0;
               |LEE 000#146=;
               |SI FSalida = 0;
                    |MENAV "0000Documento existente en presupuestos/proformas.";
                    |ERROR;
               |FINSI;
               |CIERRA #146;
          |FINSI;
*/
     |FINSI;

|FPRC;

|PROCESO PedFecha; |TIPO 0;
     nModo = (FEntrada / 100) ! 0;
     |SI aCliTeca ! "";  |Y nModo = 1;  ||Modulo Tecatel;
          #0#4 = aCliTeca; |PINTA #0#4;
          |HAZ DefDirEnt;
          #0#8 = #1#2; |PINTA #0#8;
          #0#9 = #1#20; |PINTA #0#9;
          #0#64 = #1#15; |PINTA #0#64;
     |FINSI;
|FPRC,

|PROCESO DefePromo104;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo ! 1; |ACABA; |FINSI;
     |SI #41#129 ! "S"; |ACABA; |FINSI;

     |HAZ EsAparecida;
     |SI FSalida = 0;
          |ABRE #1;
          #1#0 = #0#4;
          |LEE 000#1=;
          |CIERRA #1;
          |ABRE #211;
          |LEE 000#211p;
          |PARA; |SI FSalida = 0; |HACIENDO;
               |SI #211#25 = "GENERADA ";
                    |PARA i = 1; |SI i [ 24; |HACIENDO i = i + 1;
                         |SI #211i = #1#158;
                              #0#56 = #211#0; |PINTA #0#56;
                              |SAL;
                         |FINSI;
                    |SIGUE;
               |FINSI;
               |LEE 000#211s;
          |SIGUE;
          |CIERRA #211;
     |FINSI;
|FPRC;

|PROCESO CoimaPin104;
     |DDEF aAlfa;
     aAlfa = aAlfa + "coima006";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |C_V #0#35, 1, "N";
          |C_V #0#36, 1, "N";
          |C_V #0#37, 1, "N";
          |DDEFECTO #referen@;
          |ABRE #referen@;
          #referen@#0 = #0#25;
          #referen@#1 = #0#0;
          |LEE 000#referen@.=;
          |SI FSalida ! 0; |GRABA 020#referen@.b; |FINSI;
          |ATRI I;
          |PINPA #0#referen@;
          |PINDA #0#referen@;
          |ATRI 0;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|PROCESO PF5;
     |PTEC 827;
|FPRC;

|PROCESO Serie6_104; |TIPO 6;
     enLin004082 = 0;
     nModo = (FEntrada / 100) ! 0;
     |SI FSalida = 13; |Y nSwCoimasa = 0; ||F5
          |SI nModo = 2; |O nModo = 0;
               |SUB_EJECUTA_NP "coimz002";
               |SI enLinea = 0;
                    |ERROR;
               |SINO;
                    #0#25 = eaSerie;    ||y lo meto en las lineas
                    #0#0 = enDocu;
                    |PTEC 802;
                    enLin004082 = enLinea;
                    |PTEC 806;
                    |PTEC 802;
                    |PTEC 802;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO SuPedido; |TIPO 0;
     |SI #41#178 = "S";
          |DDEF aAlfa;
          aAlfa = aAlfa + "agifa104";
          |CARGA_DEF aAlfa, referen@;
          |SI FSalida = 0;
               aAlfa = "";
               |DDEFECTO #referen@;
               |ABRE #referen@;
               |SELECT #2#referen@;
               #referen@#4 = #0#4;
               |LEE 000#referen@.];
               |PARA; |SI FSalida = 0; |Y #referen@#4 = #0#4; |HACIENDO;
                    |SI #referen@#3 = #0#3;
                         |SI #referen@#25 ! #0#25; |O #referen@#0 ! #0#0;
                              aAlfa = "0000'Su Pedido' existente en el pedido:" + #referen@#25+"/"+(("000000"+#referen@#0)%-106);
                              |MENAV aAlfa;
                         |FINSI;
                    |FINSI;
                    |LEE 000#referen@.s;
               |SIGUE;
               |CIERRA #referen@;
               |DESCARGA_DEF #referen@;
               |SI aAlfa ! ""; |ERROR; |ACABA; |FINSI;
          |SINO;
               |MENAV "0000Error al cargar 'agifa104'";
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Bloqueado;
     #3#15 = #0#10;
     |GRABA 020#3a;
     |LIBERA #3;
|FPRC;

|PROCESO Bloquea; |TIPO 0;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 2; |Y #0Campo ! Contenido;
          |BUCLELIN 0 Bloqueado #0;
     |FINSI;
|FPRC;

|PROCESO TagloPin104;
     |DDEF aPath;
     aAlfa = aPath + "tagw0042";
     |CARGA_DEF aAlfa, tagw0042@;
     |SI FSalida = 0;
          aAlfa = aPath + "tagm0079";
          |CARGA_DEF aAlfa, referen@;
          |SI FSalida = 0;
               |DDEFECTO #referen@;
               |ABRE #referen@;
               #referen@#0 = #0#25;
               #referen@#1 = #0#0;
               |LEE 000#referen@.=;
               |CIERRA #referen@;
               |DDEFECTO #tagw0042@;
               #tagw0042@#0 = #referen@#3;
               #tagw0042@#2 = #referen@#4;
               #tagw0042@#3 = #referen@#5
               #tagw0042@#4 = #referen@#6;
               #tagw0042@#5 = #referen@#19;
               #tagw0042@#6 = #referen@#20;
               #tagw0042@#7 = #referen@#21;
               |DESCARGA_DEF #referen@;
               aAlfa = aPath + "tagm0081";
               |CARGA_DEF aAlfa, referen@;
               |SI FSalida = 0;
                    |ABRE #referen@;
                    #referen@#0 = #tagw0042@#0;
                    |LEE 000#referen@.=;
                    |SI FSalida = 0;
                         #tagw0042@#1 = #referen@#1;
                    |FINSI;
                    |CIERRA #referen@;
                    |DESCARGA_DEF #referen@;
               |FINSI;
               |C_V #0#35, 1, "N";
               |C_V #0#36, 1, "N";
               |C_V #0#37, 1, "N";
               |PINPA #0#tagw0042@;
               |PINDA #0#tagw0042@;
          |FINSI;
          |DESCARGA_DEF #tagw0042@;
     |FINSI;

     |PINTA 866, "";
     |PINTA 966, "쿐n Ped.Com:";
     |PINTA 1066, "좔컴컴컴컴컴";
     |C_M #0#34, 1, "S";
     |C_V #0#34, 1, "S";
|FPRC;

|PROCESO CheqDesglose; |TIPO 0;
     enError = 0;
     |HAZ EsCoimasa;
     |SI FSalida = 0; |Y #0#52 ! 0;
          |ABRE #1;
          #1#0 = #0#4;
          |LEE 000#1=;
          |SI FSalida = 0; |Y #1#108 = " "; |Y #1#199 = "     ";
               |MENAV "0000El cliente no tiene definido desglose...";
               enError = 1;
               |ERROR;
          |FINSI;
          |CIERRA #1;
     |FINSI;
|FPRC;

|PROCESO TagloAuxBaja;
     |DDEF aAlfa;
     aAlfa = aAlfa + "tagm0079";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          #referen@#0 = #0#25;
          #referen@#1 = #0#0;
          |BORRA 000#referen@.c;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|PROCESO DefelinoFab;
     |DDEF aAlfa;
     aAlfa = aAlfa + "defelm01";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          #referen@#0 = #0#25;
          #referen@#1 = #0#0;
          #referen@#2 = 0;
          |LEE 000#referen@.];
          |SI FSalida = 0; |Y #referen@#0 = #0#25; |Y #referen@#1 = #0#0;
               nError = 1;
               |MENAV "0000Pedido con lineas en fabricacin...";
          |SINO;
               nError = 0;
          |FINSI;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|PROCESO DocErp;
     nSwEstaDocErp = 1;
     |ERROR10;
|FPRC;

|DEFBUCLE DocErp;
     #referen@#1005;
     ;
     aAplicaErp, nEmpErp, aDefErp, aClaveErp, 01;
     aAplicaErp, nEmpErp, aDefErp, aClaveErp, 99;
     ;
     NULL, DocErp;
|FIN;

|PROCESO MiraSiEstaDocErp;
     |DBASS aBass;
     |QBF aBass;
     aErp = aBass + "dserp/def/dserpm09.mas";
     |XABRE "E", aErp, 0;
     |SI FSalida ] 0;
          |CARGA_DEF aErp, referen@;
          |SI FSalida = 0;
                 aPathErp = aBass + "dserp/fich/";
                 |PATH_DAT #referen@#aPathErp#;

                 aCien = " " * 100;
                 nEmpErp = #48#0;
                 aAplicaErp = "dscomer9";
                 aDefErp = "0";
                 aClaveErp = #0#25 + ("000000" + #0#0) % -106;
                 |QBF aClaveErp;
                 aClaveErp = (aClaveErp + aCien) % 199;
                 aClaveErp = aClaveErp + " ";

                 |BUCLE DocErp;

                 |DESCARGA_DEF #referen@;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO CtrlRiesgoTaglo;
     |SI enErrRie ! 0;
          |HAZ EsTagloma;
          |SI FSalida = 0;
               |DDEF aAlfa; aAlfa = aAlfa + "tagm0059";
               |CARGA_DEF aAlfa, referen@;
               |SI FSalida = 0;
                    |ABRE #referen@;
                    #referen@#0 = #0#25;
                    |LEE 000#referen@.=;
                    |SI FSalida = 0;
                         |CONFI "0000N풢l pago se realizar en efectivo?";
                         |SI FSalida = 0; enErrRie = 0; |FINSI;
                    |FINSI;
                    |CIERRA #referen@;
                    |DESCARGA_DEF #referen@;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO NifTaglo104;
     aAlfa = #0#64; |QBF aAlfa;
     |SI aAlfa = "."; |ACABA; |FINSI;

     enError = 0;
     |DBASS aAlfa;
     aAlfa = aAlfa + "basica/def/agim0003";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          #referen@#0 = #0#64;
          |LEE 000#referen@.=;
          |SI FSalida ! 0;
               eaVarDni = #0#64;
               |ABRE #1;
               #1#0 = #0#4;
               |LEE 000#1=;
               |CIERRA #1;
               eaNonDni = #0#8;
               eaDomiDni = #0#14;
               eaCPDni = #0#59;
               eaPobDni = #0#20;
               eaPrvDni = #0#21;
               eaTlfDni = #1#17;
               eaFacDni = #1#18;
               eaPaisDni = #1#205;
               |SUB_EJECUTA_NP ":basica/tagm0001";
          |FINSI;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
     |SI enError ! 0; |ERROR; |FINSI;
|FPRC;

|PROCESO Repre104; |TIPO 0;
     |SI FSalida ! 2;
          |HAZ EsOrts;
          |SI FSalida = 0;
               enModo = (FEntrada / 100) ! 0;
               eaTipo = "P";
               eaCliente = #0#4;
               eaSerie = #0#25;
               enCodigo = #0#0;
               |SUB_EJECUTA_NP "ortsm021";
               |HAZ OrtsPin104;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO OrtsPin104;
     |DDEF aAlfa;
     aAlfa = aAlfa + "ortsm021";
     |CARGA_DEF aAlfa, refere1@;
     |SI FSalida = 0;
          |ABRE #refere1@;
          #refere1@#0 = "P";
          #refere1@#1 = #0#25;
          #refere1@#2 = #0#0;
          |LEE 000#refere1@.=;
          |SI FSalida ! 0; |DDEFECTO #refere1@; |FINSI;
          |ATRI I;
          |PINTA 838, #refere1@#4;
          |ATRI 0;
          |DESCARGA_DEF #refere1@;
     |FINSI;
|FPRC;

|PROCESO CoimaMail;
     aIP = ""; |IP_REMOTO aIP;
     |SI aIP = "";
          |DFICE aAlfa;
          aDjunto = aAlfa + #0#25 + "_" + (("000000" + #0#0)%-106)+ ".pdf";
          |QBT aDjunto;
          eaImpresora = "CrystalReport;" + aDjunto;
          ser_ped = #0#25;
          num_ped = #0#0;
          |SUB_EJECUTA_NP "agifa105";
     |SINO;
          |DFICE aAlfa;
          aDjunto = aAlfa + #0#25 + "_" + (("000000" + #0#0)%-106)+ ".pdf";
          |QBT aDjunto;
          |ESPECIFICA "RBASS", aBaseLocal;
          aAlfa = aBaseLocal1 + #0#25 + "_" + (("000000" + #0#0)%-106)+ ".pdf";
          |QBT aAlfa;
          eaImpresora = "CrystalReport;" + aAlfa;
          ser_ped = #0#25;
          num_ped = #0#0;
          |SUB_EJECUTA_NP "agifa105";
          |RECIBE_FICHERO aAlfa, aDjunto;
          |RFBORRA aAlfa;
     |FINSI;

     aIP = "";
     |SI #refere1@#8 = "L";
          |IP_REMOTO aIP;
     |SINO;
          |SI #refere1@#8 = "S";
               |IP_LOCAL aIP;
          |SINO;
               aIP = #refere1@#7; |QBF aIP;
          |FINSI;
     |FINSI;
     aServidor = #refere1@#14; |QBF aServidor;
     aFrom = #refere1@#15; |QBF aFrom;
     aTo = aEmail;
     aSubject = "Confirmacin pedido web.";
     aMensaje = "Adjunto pedido:" + #0#25 + "/" + (("000000" + #0#0)%-106);

     aMensaje = "Le adjuntamos PDF con la confirmacion de su pedido realizado a traves de nuestra web.";
     aMensaje = aMensaje + &13 + "Reciba un cordial saludo.";
     aMensaje = aMensaje + &13 + "Coimasa.";

     |SI aTo ! "";
          |DSCORREO_ENVIA aIP, aServidor, aFrom, aTo, aSubject, aMensaje, aDjunto;
     |FINSI;

     aTo = aMailRep1; |QBF aTo;
     |SI aTo ! "";
          |DSCORREO_ENVIA aIP, aServidor, aFrom, aTo, aSubject, aMensaje, aDjunto;
     |FINSI;
     aTo = aMailRep2; |QBF aTo;
     |SI aTo ! "";
          |DSCORREO_ENVIA aIP, aServidor, aFrom, aTo, aSubject, aMensaje, aDjunto;
     |FINSI;
|FPRC;

|PROCESO CoimaEnviaMail;
     |SI #0#57 = 1;
          |ABRE #1;
          #1#0 = #0#4;
          |LEE 020#1=;
          |CIERRA #1;
          aEmail = #1#214; |QBF aEmail;
          |SI aEmail = "";
               aEmail = #1#197; |QBF aEmail;
          |FINSI;
     |SINO;
          |ABRE #39;
          #39#0 = #0#4;
          #39#1 = #0#57;
          |LEE 020#39=;
          |CIERRA #39;
          aEmail = #39#24; |QBF aEmail;
     |FINSI;
     |SI aEmail = ""; |ACABA; |FINSI;

     |ABRE #25;
     #25#0 = #0#7;
     |LEE 020#25=;
     |CIERRA #25;
     aMailRep1 = #25#62; |QBF aMailRep1;
     aMailRep2 = #25#64; |QBF aMailRep2;

     |DDEF aAlfa;
     aAlfa = aAlfa + "coima001";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          nSwHazEnvio = 0;
          |ABRE #referen@;
          |LEE 000#referen@.p;
          |CIERRA #referen@;
          |SI #referen@#34 = "S";
               |SI nEntrada = 1;
                    nSwHazEnvio = 1;
               |SINO;
                    |CONFI "2400NEnviar este pedido por mail? ";
                    |SI FSalida = 0;
                         nSwHazEnvio = 1;
                    |FINSI;
               |FINSI;
          |SINO;
               |CONFI "2400NEnviar este pedido por mail? ";
               |SI FSalida = 0;
                    nSwHazEnvio = 1;
               |FINSI;
          |FINSI;

          |SI nSwHazEnvio = 1;
               |DDEF aAlfa;
               aAlfa = aAlfa + "coima022";
               |CARGA_DEF aAlfa, refere1@;
               |SI FSalida = 0;
                    |ABRE #refere1@;
                    |LEE 000#refere1@.p;
                    |SI FSalida = 0;
                         |HAZ CoimaMail;
                    |FINSI;
                    |CIERRA #refere1@;
                    |DESCARGA_DEF #refere1@;
               |SINO;
                    |MENAV "0000Error al cargar 'coima022'...";
               |FINSI;
          |FINSI;
          |DESCARGA_DEF #referen@;
     |SINO;
          |MENAV "0000Error al cargar 'coima001'...";
     |FINSI;
|FPRC;

|PROCESO Evarm021Act;
     #referen@#9 = #0#1;
     #referen@#10 = #0#4;
     |GRABA 020#referen@.a;
|FPRC;

|DEFBUCLE Evarm021Act;
     #referen@#1004;
     ;
     #0#25, #0#0, 000, "            ";
     #0#25, #0#0, 999, "zzzzzzzzzzzz";
     be;
     NULL, Evarm021Act;
|FIN;

|PROCESO EvaAct21;
     |DDEF aAlfa;
     aAlfa = aAlfa + "evarm021";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |BUCLE Evarm021Act;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|PROCESO FergaDefectoGra;
     |DDEF aAlfa;
     aAlfa = aAlfa + "fergam14";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          aAlfa = Usuario % 810;
          |ABRE #referen@;
          #referen@#0 = aAlfa;
          |LEE 101#referen@.=;
          |SI FSalida ! 0; |GRABA 020#referen@.b; |FINSI;
          #referen@#1 = #0#4;
          #referen@#2 = #0#8;
||          #referen@#3 = #0#57;
          #referen@#4 = eaFergaFam;
          #referen@#5 = eaFergaSub;
          |GRABA 020#referen@.a;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|PROCESO FergaDefectoLee;
     |DDEF aAlfa;
     aAlfa = aAlfa + "fergam14";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          aAlfa = Usuario % 810;
          |ABRE #referen@;
          #referen@#0 = aAlfa;
          |LEE 000#referen@.=;
          |SI FSalida = 0;
               #0#8 = #referen@#2; |PINTA #0#8;
||               #0#57 = #referen@#3; |PINTA #0#57;
               eaFergaFam = #referen@#4;
               eaFergaSub = #referen@#5;
               |ABRE #39;
               #39#0 = #0#4;
               #39#1 = #0#57;
               |LEE 000#39=;
               |CIERRA #39;
               |HAZ AsignaDir104;
          |FINSI;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|PROCESO PedFecha7; |TIPO 7;
     |HAZ EsFergalsan;
     |SI FSalida = 0; |Y nModo = 1;
          #0#1 = efFecha; |PINTA #0#1; ||PTEC 802;
          #0#4 = eaCliente; |PINTA #0#4; ||PTEC 802;
          |HAZ FergaDefectoLee;
          |PTEC 806;
     |FINSI;
|FPRC;

|PROCESO T8_104; |TIPO 8;
     |HAZ EsTagloma;
     |SI FSalida = 0;
          |CONTROL_SIMPLE 0, "BOTON, ItemDoc", 0570, 0579, BtnItemDocPed;
          nBtnItemDocPed = FSalida;
          |CONTROL_SIMPLE 0, "BOTON, WorkFlow", 0470, 0479, BtnWorkFlow;
          nBtnWorkFlow = FSalida;
     |FINSI;
|FPRC;

|PROCESO T9_104; |TIPO 9;
     |SI nBtnItemDocPed ! -1; |FIN_CONTROL_WINDOWS nBtnItemDocPed; |FINSI;
     |SI nBtnWorkFlow ! -1; |FIN_CONTROL_WINDOWS nBtnWorkFlow; |FINSI;
|FPRC;

|PROCESO BtnItemDocPed;
     aAlfa = "tagz0025;PV" + #0#25 + #0#0;
     |SUB_EJECUTA_NP aAlfa;
|FPRC;

|PROCESO BtnWorkFlow;
     aAlfa = "tagz0025;WPV" + #0#25 + #0#0;
     |SUB_EJECUTA_NP aAlfa;
|FPRC;

|PROCESO TagloCheqSec;
     aSeccion = "";
     |DDEF aPath;
     aAlfa = aPath + "tagm0079";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |DDEFECTO #referen@;
          |ABRE #referen@;
          #referen@#0 = #0#25;
          #referen@#1 = #0#0;
          |LEE 000#referen@.=;
          |CIERRA #referen@;
          aSeccion = #referen@#3; |QBF aSeccion;
          |DESCARGA_DEF #referen@;
     |FINSI;
     |SI aSeccion = "";
          eaImp = #0#58;
          aAlfa = "tagw0042;" + #0#25 + #0#0;
          |SUB_EJECUTA_NP aAlfa;
          #0#58 = eaImp; |PINTA #0#58;
     |FINSI;
|FPRC;

|PROCESO TagloBajaImo;
     |DDEF aAlfa;
     aAlfa = aAlfa + "tagm0092";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          |SELECT #2#referen@;
          #referen@#10 = "PE";
          #referen@#11 = #0#25;
          #referen@#12 = #0#0;
          |LEE 101#referen@.=;
          |SI FSalida = 0;
               #referen@#10 = "";
               #referen@#11 = "";
               #referen@#12 = "";
               |GRABA 020#referen@.a;
          |FINSI;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|PROCESO EvaBorraTotalPed;
     |DDEF aAlfa;
     aAlfa = aAlfa + "evarm043";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          #referen@#0 = #0#25;
          #referen@#1 = #0#0;
          |LEE 000#referen@.=;
          |SI FSalida = 0;
               |BORRA 020#referen@.a;
          |FINSI;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|PROCESO EvaBruto;
     #referen@#2 = #referen@#2 + (#3#5 * #3#6);
|FPRC;

|PROCESO EvaTotalPed;
     |DDEF aAlfa;
     aAlfa = aAlfa + "evarm043";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          #referen@#0 = #0#25;
          #referen@#1 = #0#0;
          |LEE 000#referen@.=;
          |SI FSalida ! 0; |O nSwEvaFuerza = 1;
               |SI FSalida ! 0; |GRABA 020#referen@.b; |FINSI;
               #referen@#2 = 0;
               |BUCLELIN 0 EvaBruto #0;
               |GRABA 020#referen@.a;
          |FINSI;
          |ATRI R; |PINTA 2103, "  I. Bruto ....:"; |ATRI 0;
          |ATRI I; |PINTA 2119, #referen@#2; |ATRI 0;
          |ATRI R; |PINTA 0966, "Tipo Pedido:"; |ATRI 0;
          |ATRI I; |PINTA 0979, #referen@#3; |ATRI 0;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
     nSwEvaFuerza = 0;
|FPRC;

|PROCESO EvaTipoPedDef;
     |DDEF aDef;
     aAlfa = aDef + "evarm044";
     |CARGA_DEF aAlfa, referen@
     |SI FSalida = 0;
          |ABRE #referen@; |LEE 000#referen@.p; |CIERRA #referen@;
          aTipo = #referen@#1;
          |DESCARGA_DEF #referen@;
     |FINSI;
     |HAZ EvaGraTipoPed;
|FPRC;

|PROCESO EvaGraTipoPed;
     |DDEF aDef;
     aAlfa = aDef + "evarm043";
     |CARGA_DEF aAlfa, referen@
     |SI FSalida = 0;
          |ABRE #referen@;
          #referen@#0 = #0#25;
          #referen@#1 = #0#0;
          |LEE 101#referen@.=;
          |SI FSalida ! 0; |GRABA 020#referen@.b; |FINSI;
          #referen@#3 = aTipo;
          |GRABA 020#referen@.a;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|PROCESO EvaLeeTipoPed;
     |DDEF aDef;
     aAlfa = aDef + "evarm043";
     |CARGA_DEF aAlfa, referen@
     |SI FSalida = 0;
          |ABRE #referen@;
          #referen@#0 = #0#25;
          #referen@#1 = #0#0;
          |LEE 000#referen@.=;
          |CIERRA #referen@;
          aTipo = #referen@#3;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|PROCESO ChampiEmarPed;
     |DDEF aAlfa;
     aAlfa = aAlfa + "champi14";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          #referen@#0 = #0#25;
          #referen@#1 = #0#0;
          |LEE 000#referen@.=;
          |SI FSalida ! 0; |DDEFECTO #referen@; |FINSI;

          |ATRI 0; |PINTA 1901, " Portes.........                 "; |ATRI 0;
          |ATRI I; |PINTA 1919, #referen@#2; |ATRI 0;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|PROCESO CodAge; |TIPO 0;
     |SI FSalida = 0;
          |HAZ EsChampiEmar;
          |SI FSalida = 0;
               aAlfa = "champi14;" + #0#25 + #0#0;
               |SUB_EJECUTA_NP aAlfa;
               |HAZ ChampiEmarPed;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO ChampEmarBorraPed;
     aAlfa = aDef + "champi14";
     |CARGA_DEF aAlfa, referen@
     |SI FSalida = 0;
          |ABRE #referen@;
          #referen@#0 = #0#25;
          #referen@#1 = #0#0;
          |LEE 101#referen@.=;
          |SI FSalida = 0;
               |BORRA 020#referen@.a;
          |FINSI;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;
