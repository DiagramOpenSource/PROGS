|FICHEROS;
     orderm02 #2;
     agifa081 #81;
     agifa067 #67;
     agifa077 #77;
     agifa080 #80;
     agifa019 #19;
     agifa112 #112;
     dsm00020 #20;
     agifa142 #142;
     agifa321;
     agifa324;
|FIN;

|VARIABLES;
     &aDivisa = "";
     &aMoneda = "";
     &enImpPrvCom = 0;
     &efFecha = @;
     &eaProve = "";
     &nDeci_PreBase = 0;
     &enPrecioB = 0;
     &enDeciB = 0;
     &precio_base = 0;
     &decim_base = 0;
     nImpo = 0;
     aMes = "";
     nMes = 0;
     nForma = 1;
     &enForma = 0;
     &eaDocu = "";
     &enUnidPend = 0;
     &enUnidPend2 = 0;
     &enSwMenu = 0;
     &enContaAlb = 0;
     aSerPed = "";
     nNumPed = 0;
     aProve = "";
     aAlfa = "";
     nLin = 0;
|FIN;

|PROCESO LinAlba;
     |ABRE #19;
     #19#0 = #67#2;
     |LEE 000#19=;
     |SI FSalida ! 0; |DDEFECTO #19; |FINSI;
     |CIERRA #19;

     nLin = nLin + 1;

     #77#41 = #77#41 + 1;

     |DDEFECTO #80;
     #80#27 = #77#50;
     #80#0 = #77#0;
     #80#1 = nLin;
     #80#2 = #67#2;
     #80#3 = #67#3;
     #80#4 = #67#4;
     #80#5 = #2#8;
     #80#6 = #67#6;
     #80#7 = #67#7;
     #80#8 = #67#8;
     #80#11 = #67#14;
     #80#12 = #67#0;
     #80#13 = #67#18;
     #80#15 = #81#4;
     #80#21 = #67#1;
     #80#23 = #67#5;
     #80#29 = #67#28;
     #80#30 = #67#33;
     #80#32 = #67#35;
     #80#34 = #67#39;
     #80#35 = #67#40;
     #80#37 = #67#42;
     #80#38 = #67#43;
     #80#39 = #67#47;
     #80#40 = #67#48;
     #80#41 = #67#49;
     #80#43 = #67#54;
     #80#45 = #67#57;
     |GRABA 020#80n;

     #67#38 = #67#38 + #80#5;
     |SI #142#225 = "B";
          |SI #67#37 = 0;
               #67#12 = #67#38 - #67#37;
          |FINSI;
          |SI #67#45 = 0;
               #67#44 = #67#46 - #67#45;
          |FINSI;
     |FINSI;
     enForma = 1;
     eaDocu = "agifa213";
     enUnidPend = #80#5;
     enUnidPend2 = #80#36;
     |HAZ StockEntra;
     |GRABA 020#67a;
|FPRC;

|PROCESO CabAlba;
     |ABRE #112;
     #112#0 = #81#4;
     |LEE 000#112=;
     |SI FSalida ! 0; |DDEFECTO #112; |FINSI;
     |CIERRA #112;

     #20#0 = #81#45;
     |LEE 000#20=;
     |SI FSalida ! 0; |DDEFECTO #20; |FINSI;

     #77#50 = #2#4;
     enSwMenu = 1;
     |HAZ ContaAC7;
     |GRABA 020#77b;

     #77#3 = #81#4;
     #77#4 = #112#3;
     #77#5 = #81#5;
     #77#7 = #81#6;
     #77#8 = #81#9;
     #77#9 = #20#1;
     #77#29 = #81#19;
     #77#30 = #81#18;
     #77#31 = #81#20;
     #77#32 = #81#17;
     #77#32 = #81#21;
     #77#34 = #81#26;
     #77#36 = #112#58;
     #77#52 = #112#78;
     #77#56 = #81#27;
     #77#57 = #81#28;
     #77#58 = #81#29;
     #77#61 = #81#32;
     #77#62 = #81#33;
     #77#71 = #81#43;
     #77#72 = #81#45;
     |GRABA 020#77a;
     enContaAlb = enContaAlb + 1;


     aDivisa = #77#56;
     aMoneda = #77#58;
     |HAZ Divisas077;
|FPRC;

|PROCESO RecalLin;
     |HAZ TotalLin80;
     |HAZ CalCabAgifa077;
     |GRABA 020#77a;

     ||컴컴컴컴컴컴 Doble/Multi
     enPrecioB  = precio_base;
     enDeciB    = nDeci_PreBase;
     enForma = nForma;
     eaDocu = "agifa212";
     |HAZ StockEntra;
     ||컴컴컴컴컴컴컴컴컴컴컴컴
     nImpo = (#80#9 < #77#5) < #77#32;
     |SI #142#114 = "S";
          nImpo = nImpo < #77#7;
     |FINSI;
     #112#0 = #77#3;
     |LEE 101#112=;
     |SI FSalida = 0;
         aMes = #77#1 % A402;
         nMes = aMes + 26;
         |SI #77#42 = "N";
             #112nMes = #112nMes + (nImpo * nForma);
             #112#39 = #112#39 + (nImpo * nForma);
         |SINO;
             #112nMes = #112nMes - (nImpo * nForma);
             #112#39 = #112#39 - (nImpo * nForma);
         |FINSI;
         |GRABA 020#112a;
         |LIBERA #112;
     |FINSI;

     |SI #77#42 = "N";
          enImpPrvCom = nImpo * nForma;
     |SINO;
          enImpPrvCom = -nImpo * nForma;
     |FINSI;
     efFecha = #77#1;
     eaProve = #77#3;
     |HAZ AcumulaPrv;
|FPRC;

|PROCESO Asigna;
     |SI aProve ! #2#9;
          |SI aProve ! "";
               |HAZ LimCabAgifa077;
               |ABRE #112;
               |BUCLELIN 2 RecalLin #77;
               |CIERRA #112;
               |LIBERA #77;
          |FINSI;

          |HAZ CabAlba;
          nLin = 0;
          aProve = #2#9;
     |FINSI;
     |HAZ LinAlba;
|FPRC;

|PROCESO Pendientes;
     |SI aSerPed ! #2#4; |O nNumPed ! #2#5;
          |SI aSerPed ! "";
               |HAZ CalCabAgifa081;
               |LIBERA #81;
          |FINSI;

          #81#25 = #2#4;
          #81#0 = #2#5;
          |LEE 101#81=;
          aSerPed = #2#4;
          nNumPed = #2#5;

          aDivisa = #81#27;
          aMoneda = #81#29;
          |HAZ Divisas081;
     |FINSI;

     #67#28 = #2#4;
     #67#0 = #2#5;
     #67#1 = #2#6;
     |LEE 101#67=;
     |SI FSalida = 0;
          |HAZ Asigna;
          #2#10 = "S";
          #2#11 = #80#27;
          #2#12 = #80#0;
          #2#13 = #80#1;
          #2#14 = ~;
          |HORA aAlfa;
          #2#15 = aAlfa;
          aAlfa = Usuario % 810;
          #2#16 = aAlfa;
          |GRABA 020#2a;
          |LIBERA #67;
     |FINSI;
|FPRC;

|DEFBUCLE Pendientes;
     #2#2;
     ;
     "N", 00000001, "     ", 000000, 000;
     "N", 99999999, "zzzzz", 999999, 999;
     be;
     NULL, NULL, NULL, NULL, NULL, Pendientes;
     #2#9, #2#4, #2#5;
|FIN;

|PROCESO LeeMonBase2; ||Lee los parametros de la moneda base
     |ABRE #agifa321;
     |ABRE #agifa324;
     |LEE 010#agifa321.p;   ||Leo parametros de divisa
     #agifa077#61 = #agifa321#9;  ||Cojo la Moneda Base de parametros
     #agifa324#0 = #agifa321#9;
     |LEE 010#agifa324.=;         ||Leo la ficha de la moneda base en Divisas
     #agifa077#62 = #agifa324#3;  ||Asigno el cambio de la moneda base con el euro
     decim_base = #agifa324#7;    ||Asigno los decimales de la moneda base
     precio_base = #agifa324#9;   ||Asigno los decimales del precio en la mon. base
     |CIERRA #agifa324;
     |CIERRA #agifa321;
|FPRC;

|PROCESO AdjPedido;
     |HAZ LeeMonBase2;
     |HAZ DecimalesBase;
     enContaAlb = 0;
     aSerPed = "";
     nNumPed = 0;
     aProve = "";
     nLin = 0;

     |ABRE #142; |LEE 000#142p; |CIERRA #142;

     |ABRET #67;
     |ABRET #77;
     |ABRET #80;
     |ABRET #81;
     |ABRE #20;

     |BUCLE Pendientes;
     |SI aSerPed ! "";
          |HAZ CalCabAgifa081;
          |LIBERA #81;
          |SI aProve ! "";
               |HAZ LimCabAgifa077;
               |ABRE #112;
               |BUCLELIN 2 RecalLin #77;
               |CIERRA #112;
               |LIBERA #77;
          |FINSI;
     |FINSI;

     |CIERRA #20;
     |CIERRAT #81;
     |CIERRAT #80;
     |CIERRAT #77;
     |CIERRAT #67;
|FPRC;
