|FICHEROS;
     vigz0065 #0;
     agifa071 #1;
     agifa010 #2;
     agifa019 #3;
     agifa025 #4;
     vigw0037 #5;   ||Temporal.
     agifa060 #6;
     agifa134 #7;
     agifa007;
     vigm0043 #43;
|FIN;

|VARIABLES;
     &esw = 0;

     &ef1 = 0;
     &ef2 = 0;
     &ef3 = 0;
     &ef4 = 0;
     &ef5 = 0;
     &ef6 = 0;
     &ef7 = 0;
     &er1 = 0;
     &er2 = 0;
     &er3 = 0;
     &er4 = 0;
     &er5 = 0;
     &er6 = 0;
     &er7 = 0;
     &et1 = 0;
     &et2 = 0;
     &et3 = 0;
     &et4 = 0;
     &et5 = 0;
     &et6 = 0;
     &et7 = 0;
     aSerie = "";
     informe = "";
     aRepe = "";
     aFam = "";
|FIN;

|PROCESO &Suma;
     ef3 = ef3 + #5#4;
     ef1 = ef1 + #5#5;
     ef5 = ef5 + #5#6;
     ef2 = ef3 / ef1;
     ef4 = ef5 / ef1;
     ef6 = ef2 - ef4;
     ef7 = ef6 * ef1;

     er3 = er3 + #5#4;
     er1 = er1 + #5#5;
     er5 = er5 + #5#6;
     er2 = er3 / er1;
     er4 = er5 / er1;
     er6 = er2 - er4;
     er7 = er6 * er1;

     et3 = et3 + #5#4;
     et1 = et1 + #5#5;
     et5 = et5 + #5#6;
     et2 = et3 / et1;
     et4 = et5 / et1;
     et6 = et2 - et4;
     et7 = et6 * et1;
|FPRC;

|PROCESO Impresion;
     |SI aRepe ! #5#10; |Y #0#15 = "N";
          |SI aRepe ! "";
               esw = 3; |PRINT;
               esw = 4; |PRINT;
               |PIEINF;
          |FINSI;
          esw = 1; |PRINT;
          esw = 2; |PRINT;
     |SINO;
          |SI aFam ! #5#1;
               esw = 3; |PRINT;
               esw = 2; |PRINT;
          |FINSI;
     |FINSI;
     aRepe = #5#10;
     aFam = #5#1;
     esw = 0; |PRINT;
|FPRC;

|DEFBUCLE Impresion;
     #5#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Impresion;
|FIN;

|PROCESO EsInterno;
     |ABRE #agifa007;
     #agifa007#26 = aSerie;
     |LEE 000#agifa007.=;
     |CIERRA #agifa007;

     |SI #agifa007#37 = "S";
          FSalida = 0;
     |SINO;
          FSalida = 1;
     |FINSI;
|FPRC;

|PROCESO HistoTras;
     aSerie = #43#0;
     |HAZ EsInterno;
     |SI FSalida = 0; |ACABA; |FINSI;

     |ABRE #3;
     #3#0 = #43#12;
     |LEE 000#3=;
     |CIERRA #3;

     |ABRE #4;
     #4#0 = #43#10;
     |LEE 000#4=;
     |CIERRA #4;

     |ABRE #6;
     #6#0 = #3#2;
     |LEE 000#6=;
     |CIERRA #6;

     |SI #43#6 ] #0#3;|Y #43#6 [ #0#4;                 || Fecha
         |SI #43#10 ] #0#7;|Y #43#10 [ #0#8;           || Repre
                 |SI #3#2 ] #0#11;|Y #3#2 [ #0#12;     || Fam
                 |SI #43#12 ] #0#13; |Y #43#12 [ #0#14;|| Articulo
                     |DDEFECTO #5;
                     #5#10 = #43#10;
                     #5#1 = #3#2;
                     #5#11 = #43#12;
                     |LEE 000#5=;
                     |SI FSalida ! 0; |GRABA 020#5b; |FINSI;
                     #5#2  = #6#1;
                     #5#4  = #5#4 + #43#15;
                     #5#5  = #5#5 + #43#13;
                     #5#6  = #5#6 + #43#16;
                     #5#7  = #5#4 - #5#6;
                     #5#8  = (#5#7 / #5#4) * 100;
                     #5#9  = #5#6 / #5#5;
                     #5#12 = #3#1;
                     #5#13 = #5#4 / #5#5;
                     #5#14 = #5#6 / #5#5;
                     #5#15 = #5#13 - #5#14;
                     #5#16 = #5#15 * #5#5;
                     |GRABA 020#5a;
                     |LIBERA #5;
                 |FINSI;
             |FINSI;
         |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE HistoTras;
     #43#1;
     ;
     #0#1, 000001, 001;
     #0#2, 999999, 999;
     ;
     NULL, HistoTras;
|FIN;

|CALCULO lee_lin;
     |ABRE #2;
     #2#52 = #1#29;
     #2#0 = #1#0;
     |LEE 000#2=;
     |CIERRA #2;

     aSerie = #agifa010#52;
     |HAZ EsInterno;
     |SI FSalida = 0; |ACABA; |FINSI;

     |ABRE #3;
     #3#0 = #1#2;
     |LEE 000#3=;
     |CIERRA #3;

     |ABRE #4;
     #4#0 = #2#6;
     |LEE 000#4=;
     |CIERRA #4;

     |ABRE #6;
     #6#0 = #3#2;
     |LEE 000#6=;
     |CIERRA #6;

     |ABRE #7;
     #7#0 = #2#39;
     #7#49 = #2#53;
     |LEE 000#7=;
     |CIERRA #7;

    |SI #2#1 ] #0#3;|Y #2#1 [ #0#4;
        |SI #2#6 ] #0#7;|Y #2#6 [ #0#8;
                |SI #3#2 ] #0#11;|Y #3#2 [ #0#12;
                    |DDEFECTO #5;
                    #5#10 = #2#6;
                    #5#1 = #3#2;
                    #5#11 = #1#2;
                    |LEE 000#5=;
                    |SI FSalida ! 0; |GRABA 020#5b; |FINSI;
                    #5#2  = #6#1;
                    #5#4  = #5#4 + #1#9;
                    #5#5  = #5#5 + #1#5;
                    #5#6  = #5#6 + #1#14;
                    #5#7  = #5#4 - #5#6;
                    #5#8  = (#5#7 / #5#4) * 100;
                    #5#9  = #5#6 / #5#5;
                    #5#12 = #3#1;
                    #5#13 = #5#4 / #5#5;
                    #5#14 = #5#6 / #5#5;
                    #5#15 = #5#13 - #5#14;
                    #5#16 = #5#15 * #5#5;
                    |GRABA 020#5a;
                    |LIBERA #5;
               |FINSI;
          |FINSI;
    |FINSI;
|FCAL;

|DEFBUCLE lee_lin;
     #1#1;
     2;
     #0#1 , 000001,  0 , #0#13;
     #0#2 , 999999,999 , #0#14;
     ;
     NULL, lee_lin;
|FIN;

|PROCESO Tipo3; |TIPO 3;
     |SI #0#5 = "SI";|O #0#5 = "si";
         |DELINDEX #5;
         |IMPRE 0;
         |SI FSalida = 0;
             |SI #0#15 = "S";
                 informe = "vigzc065";
             |SINO;
                 informe = "vigz0065";
             |FINSI;
             |INFOR informe;
             |SI FSalida = 0;
                 |ABRE #5;
                 |BUCLE lee_lin;
                 |BUCLE HistoTras;
                 |CIERRA #5;
                 |BUCLE Impresion;
                 esw = 3; |PRINT;
                 esw = 4; |PRINT;
                 esw = 5;|PIEINF;
             |FINSI;
             |FININF;
         |FINSI;
         |FINIMP;
     |FINSI;
|FPRC;
