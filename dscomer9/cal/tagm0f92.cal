  Proforma

|FICHEROS;
     tagm0092 #0;
     tagm0093 #1,MANTE;
     dsm00003 #3;
     tagz0032 #32,MANTE;
     agifa019 #19;
     dsm00020 #20;
     agifa024 #24;
     agifa025 #25;
     tagm0081 #81;
     tagm0084 #84;
     dsm00087 #87;
     tagm0091 #91;
     agifa142 #142;
     agifa146 #146;
     agifa147 #147;
     agifa321 #321;
     agifa324 #324;
|FIN;

|INCLUYE i_varart;

|VARIABLES;
     &serie = "";
     &numero = 0;
     &reimpr = "";
     &enSwMenu = 0;
     &aDivisa = "";
     &aMoneda = "";
     &enDescuento1 = 0;
     &enDescuento2 = 0;
     &eaTComision  = 0;
     &enComision = 0;
     aAlfa = "";
     nContaLog = 0;
     aSer = "";
     aNum = "";
     aTipo = "";
     aUsu = "";
|FIN;

|PROCESO Log146;
     |ABRE #87

     aSer = #146#48;
     aNum = ("000000" + #146#0) % -106;
     aTipo = "PF";

     |ABRE #87;
     |DDEFECTO #87;
     |SELECT #2#87;
     #87#1 = aSer;
     #87#2 = aNum;
     #87#3 = aTipo;
     |LEE 101#87=;
     |SI FSalida ! 0;
          |SELECT #1#87;
          |LEE 000#87u;
          |SI FSalida = 0;
               nContaLog = #87#0 + 1;
          |SINO;
               nContaLog = 1;
          |FINSI;
          |DDEFECTO #87;
          #87#0 = nContaLog;
          #87#1 = aSer;
          #87#2 = aNum;
          #87#3 = aTipo;
          |GRABA 020#87.b;
     |FINSI;
     |SI FSalida = 0;
          |HORA aAlfa;
          aUsu = Usuario % 810;
          #87#4 = aUsu;
          #87#5 = ~;
          #87#6 = aAlfa;
          #87#7 = "";
          #87#8 = "01.01.0000";
          #87#9 = ""
          #87#10 = "";
          #87#11 = "01.01.0000";
          #87#12 = ""
          |GRABA 020#87a;
     |FINSI;
     |CIERRA #87;
|FPRC;

|PROCESO LinPro;
     |ABRE #19;
     #19#0 = #1#2;
     |LEE 000#19=;
     |SI FSalida ! 0; |DDEFECTO #19; |FINSI;
     |CIERRA #19;

     |DDEFECTO #147;
     #147#20 = #146#48;
     #147#0 = #146#0;
     #147#1 = #1#1;
     #147#2 = #1#2;
     #147#3 = #1#7;
     #147#4 = #1#3;
     #147#5 = #1#4;
     #147#6 = #1#5;
     #147#8 = #1#8;
     #147#11 = #19#30;
     #147#13 = #19#2;
     #147#15 = #146#3;
     #147#16 = #146#34;
     #147#17 = #146#35;
     #147#21 = #1#9;
     #147#24 = #1#5;
     #147#26 = #1#5;
     #147#31 = #1#10;
     #147#32 = #1#11;
     #147#33 = #1#12;
     #147#28 = #1#13;

     enDescuento1 = #147#8;
     enDescuento2 = #147#21;
     eaTComision  = #147#16;
     eaCliente    = #146#3;
     eaArticulo   = #147#2;
     eaRepre      = #146#6;
     efFecha      = #146#1;
     eaSerie      = #147#20;
     enDirEnt = #146#80;
     enAlmacen = #147#3;
     |HAZ Comisiones;
     #147#10  = enComision;

     |GRABA 020#147n;
|FPRC;

|PROCESO CabPro;
     |ABRE #24;
     #24#0 = #0#2;
     |LEE 000#24=;
     |SI FSalida ! 0; |DDEFECTO #24; |FINSI;
     |CIERRA #24;

     |ABRE #25;
     #25#0 = #32#4;
     |LEE 000#25=;
     |SI FSalida ! 0; |DDEFECTO #25; |FINSI;
     |CIERRA #25;

     |ABRE #3;
     #3#0 = #0#2;
     #3#1 = 1;
     |LEE 000#3=;
     |SI FSalida ! 0; |DDEFECTO #3; |FINSI;
     |CIERRA #3;

     #146#48 = #32#0;
     enSwMenu = 1;
     |HAZ ContaPR7;
     |GRABA 020#146b;

     #146#1 = #32#1;
     #146#3 = #0#2;
     #146#4 = #24#2;
     #146#5 = #0#5;
     #146#6 = #32#4;
     #146#7 = #0#6;
     #146#8 = #0#4;
     #146#9 = #32#3;
     #146#29 = #3#10;
     #146#30 = #3#2;
     #146#31 = #3#3;
     #146#32 = #0#7;
     #146#33 = #3#7;
     #146#34 = #25#7;
     #146#35 = #24#4;
     #146#36 = #24#47;
     #146#40 = #24#16;
     #146#65 = #24#192;

     #324#0 = #146#65;
     |LEE 000#324=;
     #146#66 = #324#2;

     #146#67 = #24#193;
     #146#68 = #321#9;

     #324#0 = #146#68;
     |LEE 000#324=;
     #146#69 = #324#2;

     #146#78 = #32#2;

     #146#80 = 1;
     #146#81 = #3#6;
     #146#84 = #0#9;
     #146#86 = #24#15;
     #146#91 = #0#0;
     #146#92 = Usuario % 810;
     |GRABA 020#146a;

     #91#0 = #146#48;
     #91#1 = #146#0;
     |LEE 101#91=;
     |SI FSalida ! 0; |GRABA 020#91b; |FINSI;
     #91#2 = #0#15;
     #91#3 = #81#1;
     |GRABA 020#91a;
     |LIBERA #91;


     aDivisa = #146#65;
     aMoneda = #146#67;
     |HAZ Divisas146;
|FPRC;

|DEFBUCLE LinPro;
     #1#1;
     ;
     #0#0, 001;
     #0#0, 999;
     ;
     NULL, LinPro;
|FIN;

|PROCESO Recal146;
     |HAZ TotalLin147;
     |GRABA 020#147a;
     enForma = 1;
     |HAZ CalCabAgifa146_2;
|FPRC;

|PROCESO Proforma;
     |LEE 101#0=;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |ABRE #142; |LEE 000#142p; |CIERRA #142;
     |ABRE #321; |LEE 000#321p; |CIERRA #321;

     aAlfa = Usuario % 810;
     |ABRE #84;
     #84#0 = aAlfa;
     |LEE 000#84=;
     |SI FSalida ! 0; |DDEFECTO #84; |FINSI;
     |CIERRA #84;
     |ABRE #81;
     #81#0 = #0#15;
     |LEE 000#81=;
     |SI FSalida ! 0; |DDEFECTO #81; |FINSI;
     |CIERRA #81;

     |DDEFECTO #32;
     #32#0 = #142#186;
     #32#1 = ~;
     #32#2 = #0#8;
     #32#4 = #0#3;

     |ABRE #20;
     #20#0 = #32#2;
     |LEE 000#20=;
     |CIERRA #20;

     |ABRE #25;
     #25#0 = #32#4;
     |LEE 000#25=;
     |CIERRA #25;

     #32#3 = #20#1;
     #32#5 = #25#1;

     |VENTANA 1008, 1690, -1, 17, "Pase a proforma";
     |HAZ PushVenModal;
     |PINPA #0#32;
     |PINDA #0#32;
     |ENDATOS #1#32;
     |SI FSalida = 0;
          |ABRE #324;
          |ABRE #147;
          |ABRE #146;
          |ABRE #91;
          |HAZ CabPro;
          |BUCLE LinPro;
          |HAZ LimCabAgifa146;
          |BUCLELIN 0 Recal146 #146;
          |GRABA 020#146a;

          #0#10 = "PR";       |PINTA #0#10;
          #0#11 = #146#48;    |PINTA #0#11;
          #0#12 = #146#0;     |PINTA #0#12;
          |GRABA 020#0a;
          |HAZ Log146;

          |CIERRA #91;
          |CIERRA #146;
          |CIERRA #147;
          |CIERRA #324;

          |CONFI "0000N¨Desde imprimir la proforma?";
          |SI FSalida = 0;
               serie = #146#48;
               numero = #146#0;
               reimpr = #146#10;
               |SUB_EJECUTA_NP "agifa150";
          |FINSI;
     |FINSI;
     |HAZ PopVenModal;

     |LIBERA #0;
|FPRC;
