|FICHEROS;
     berm0001 #0;   || escandallo cabs.
     berm0002 #1,MANTE;   || escandallo lins.
     berm0003 #3,MANTE;
     agifa019 #2;   || articulo
     agifa142 #5;   || parametros
     agifa017 #17;
     agifa321;
     agifa324;
     agifa046 #46;  || Parametros
     agifa045 #45,MANTE;  || Calculo Comparativo
     refere1@;
     refere2@;
     referen@;
     refelin@;
     refecom@;
     berz0001 #101;
     berm0004 #40;
     berm0005 #50;
     berm0006 #60;
     berm0010 #100;
     berm0015 #115;
|FIN;

|VARIABLES;
     aTieneCompo = 0;
     &enTiva = 0;
     &efFiva = @;
     &eaDiva = "";
     &enIva = 0;
     &enRec = 0;
     aFilm = "";
     &enLinea = 0;
     nTari = 0;
     nModo = 0;
     &enAlta = 0;
     &eaArticulo = "";
     &nDeci_Base = 0;
     &nDeci_PreBase = 0;
     &nDeci_EsCab = 0;
     &nDeci_EsLin = 0;

     &Tempo    = "";
     nSwConfi  = 1;
     &enErr          = 0;
     &nModcab       = 0;
     nim        = 0;
     &nDec      = 0;
     nNume    = 0;
     nNume1   = 0;
     aAlfa    = "";
     nMod     = 0;
     informe  = "berm0001";
     coste    = 0         ;
     nivel    = 0         ;
     maxnivel = 0         ;
     espacios = "                ";
     escandall= " ";
     nCalculo = 0;
     impcompone = 0;
     nForma     = 0;
     nContenido = 0;
     nPrecio    = 0;

     &wtip   = 0;
     nPvp = 0;
     nCampo = 0;
     nIVA  = 0;
     nPvpSin = 0;
     nImpo = 0;
     nImpo2 = 0;

     nGrid1 = -1;
     nGrid3 = -1;
     nGridCom = 0;
     nGridLin = 0;
     nRango = 0;
     nPanta = 0;
     &enCtrFin = 0;
     aPath = "";
     nBtnEdiLin = 0;
     nBtnEdiCom = 0;
     nBtnAltaLin = 0;
     nBtnModiLin = 0;
     nBtnBajaLin = 0;
     nBtnConsLin = 0;
     nBtnCompo = 0;
     nBtnAltaCom = 0;
     nBtnModiCom = 0;
     nBtnBajaCom = 0;
     nBtnConsCom = 0;
     nBtnTodoFondo = 0;
     nBtnTodoPega = 0;
     nBtnTodoAcaba = 0;
     nBtnTodoTalla = 0;
     nBtnOtraAlta = 0;
     nLabel = 0;
     nModoCom = 0;
     nModoLin = 0;
     nPanta1 = 0;
     aLinEsc = "";
     aLinArt = "";
     nLinLin = 0;
     aLinDes = "";
     nPanEdi = 0;
     nSwOtra1 = 0;
     nSwOtra3 = 0;
     nLin = 0;
     nSwAlta = 0;
     nHay = 0;
     aConte = "";
     i = 0;
|FIN;

|CAMPOS;
     ||Lineas Escandallo
     #1#0 linesca  ;
     #1#1 linlinea ;
     #1#2 linartic ;
     #1#8 linivel  ;

     ||Articulo
     #2#0  artic    ;
     #2#6  stocktot ;
     ||#2#9  preco    ;
     #2#10 vstock   ;

     ||Temporal
     #3#0 tmpescal ;
     #3#1 tmp1busc ;
     #3#2 tmp2busc ;

     ||Almacenes
     #4#0 almcodig ;
     #4#1 almalmac ;
     #4#5 almstock ;
     #4#3 almvastk ;
|FIN;

|PROCESO KitFab; |TIP O7;
     |SI #5#12 = "X";
          |C_M #0#33, 1, "S";
     |SINO;
          |C_M #0#33, 1, "N";
     |FINSI;
|FPRC;

|PROCESO Pack; |TIPO 7;
     |ABRE #5; |LEE 000#5p; |CIERRA #5;
     |SI #5#126 = 0;
          |C_M #0#15, 1, "N";
     |SINO;
          |C_M #0#15, 1, "S";
     |FINSI;
|FPRC;

|PROCESO T48_6; |TIPO 6;
     enAlta = 1;
     eaArticulo = #0Campo;
     |HAZ LlenaArticulo;
     |SI FSalida = 0;
          #0Campo = eaArticulo;
          |PINTA #0Campo;
     |SINO;
          |ERROR; |ACABA;
     |FINSI;
|FPRC;

|PROCESO Modifica;
     |C_M #0#16, 1, "S";
     |C_M #0#26, 1, "S";
     |C_M #0#23, 1, "S";
     |C_M #0#27, 1, "S";
     |C_M #0#24, 1, "S";
     |C_M #0#28, 1, "S";
     |C_M #0#25, 1, "S";
     |C_M #0#29, 1, "S";

     |SI #0#17 = "N";
         |C_M #0#16, 1, "N";  #0#16 = 0;   |PINTA #0#16;
         |C_M #0#26, 1, "N";  #0#26 = "I"; |PINTA #0#26;
     |FINSI;

     |SI #0#18 = "N";
         |C_M #0#23, 1, "N";  #0#23 = 0;   |PINTA #0#23;
         |C_M #0#27, 1, "N";  #0#27 = "I"; |PINTA #0#27;
     |FINSI;

     |SI #0#19 = "N";
         |C_M #0#24, 1, "N";  #0#24 = 0;   |PINTA #0#24;
         |C_M #0#28, 1, "N";  #0#28 = "I"; |PINTA #0#28;
     |FINSI;

     |SI #0#20 = "N";
         |C_M #0#25, 1, "N";  #0#25 = 0;   |PINTA #0#25;
         |C_M #0#29, 1, "N";  #0#29 = "I"; |PINTA #0#29;
     |FINSI;
|FPRC;

|PROCESO imprelia;
     |SI nCalculo = 1;
         impcompone = #1#6 / #0#6;
         |SI #1#10 = 1; #0#8 = #0#8 + impcompone;    |FINSI;   ||Componentes
         |SI #1#10 = 2; #0#2 = #0#2 + impcompone;    |FINSI;   ||Mano Obra
         |SI #1#10 = 3; #0#3 = #0#3 + impcompone;    |FINSI;   ||Maquinaria
         |SI #1#10 = 4; #0#4 = #0#4 + impcompone;    |FINSI;   ||Otros

         |SI #1#10 = 1;
             |SI #0#17 = "S";
                 |SI #0#26 = "D";
                     #0#21 = #0#21 + (#1#6 > #0#16);
                 |SINO;
                     #0#21 = #0#21 + (#1#6 / ((100 - #0#16) / 100));
                 |FINSI;
             |SINO;
                 #0#21 = #0#21 + #1#6;
             |FINSI;
         |FINSI;

         |SI #1#10 = 2;
             |SI #0#19 = "S";
                 |SI #0#28 = "D";
                     #0#21 = #0#21 + (#1#6 > #0#24);
                 |SINO;
                     #0#21 = #0#21 + (#1#6 / ((100 - #0#24) / 100));
                 |FINSI;
             |SINO;
                 #0#21 = #0#21 + #1#6;
             |FINSI;
         |FINSI;

         |SI #1#10 = 3;
             |SI #0#18 = "S";
                 |SI #0#27 = "D";
                     #0#21 = #0#21 + (#1#6 > #0#23);
                 |SINO;
                     #0#21 = #0#21 + (#1#6 / ((100 - #0#23) / 100));
                 |FINSI;
             |SINO;
                 #0#21 = #0#21 + #1#6;
             |FINSI;
         |FINSI;

         |SI #1#10 = 4;
             |SI #0#20 = "S";
                 |SI #0#29 = "D";
                     #0#21 = #0#21 + (#1#6 > #0#25);
                 |SINO;
                     #0#21 = #0#21 + (#1#6 / ((100 - #0#25) / 100));
                 |FINSI;
             |SINO;
                 #0#21 = #0#21 + #1#6;
             |FINSI;
         |FINSI;


          |HAZ Total;
         |PINTA #0#2;
         |PINTA #0#3;
         |PINTA #0#4;
         |PINTA #0#5;
         |PINTA #0#8;
         |PINTA #0#9;
         |PINTA #0#11;
         |PINTA #0#21;
     |SINO;
         |PRINT;
     |FINSI;
|FPRC;

|PROCESO T48_4; |TIPO 4;
     |SELECT #1#0;
     |LEE 000#0=;
     |SI FSalida ! 0;
          |MENAV "0000Por favor, consulte el registro correcto antes de imprimir.";
          |ACABA;
     |SINO;
          |PINDA #0#0;
          FEntrada = 402;
     |FINSI;
     |HAZ Tipo4;
|FPRC;

|PROCESO Tipo4;
     |IMPRE 1;
     |SI 0 = FSalida;
          |INFOR informe;
          |SI 0 = FSalida;
               wtip = 2;
               |BUCLELIN 2imprelia#0;
               |PIEINF;
               |FININF;
          |FINSI;
          |FINIMP;
     |FINSI;
|FPRC;

|PROCESO Total;
     #0#5 = #0#2 + #0#3 + #0#4;         || total otros costes
     |SI #0#36 = "S";
           #0#11 = (#0#5 + #0#8) > #0#7;      || total serie
           #0#11 = #0#11 > #0#34;
     |SINO;
           nImpo = (#0#5 + #0#8) % #0#7;
           nImpo2 = (#0#5 + #0#8) % #0#34;
           #0#11 = (#0#5 + #0#8) + nImpo + nImpo2;
     |FINSI;
     #0#9 = #0#11 / #0#12;              || total unitario
     |HAZ CosteModulo;
|FPRC;

|PROCESO totcoste; |TIPO 0;
     |HAZ Total;
     |PINTA #0#5;
     |PINTA #0#11;
     |PINTA #0#9;
|FPRC;

|PROCESO npiezas; |TIPO 0;
     |DDEFECTO #2;
     |ABRE #2;
     #2#0 = #0#0;
     |LEE 000#2=;
     |SI #2#13 > 0;|Y #0Campo ! Contenido;
         |MENAV "0000Existen ordenes de fabricacion del escandallo ...";
         #0Campo = Contenido;
         |PINTA #0Campo;
         |ERROR;
     |SINO;
         #0#9 = #0#11 / #0#12;
         |HAZ CosteModulo;
         |PINTA #0#9;
     |FINSI;
     |CIERRA #2;

     #0#22 = #2#18;   |PINTA #0#22;
|FPRC;

|PROCESO Tipo1; |TIPO 1;
     ||proceso para registros anteriores a a¤adir coste unitario
     |SI #0#12 = 1;
         |SI #0#11 ! #0#9;
            #0#12 = 1;
            #0#11 = #0#9;
            |PINTA #0#11;
            |PINTA #0#9;
            |GRABA 020#0a;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO tipo7;     |TIPO 7;
     nMod = (FEntrada / 100 ) ! 0;
     |SI nMod = 2;
          |C_M #0#2, 1, "N";
          |C_M #0#3, 1, "N";
          |C_M #0#4, 1, "N";
          ||C_M #0#7, 1, "N";
     |SINO;
          |C_M #0#2, 1, "S";
          |C_M #0#3, 1, "S";
          |C_M #0#4, 1, "S";
          ||C_M #0#7, 1, "S";


          #0#17 = #46#1;  |PINTA #0#17;
          #0#16 = #46#5;  |PINTA #0#16;
          #0#26 = #46#9;  |PINTA #0#26;
          #0#18 = #46#2;  |PINTA #0#18;
          #0#23 = #46#6;  |PINTA #0#23;
          #0#27 = #46#10; |PINTA #0#27;
          #0#19 = #46#3;  |PINTA #0#19;
          #0#24 = #46#7;  |PINTA #0#24;
          #0#28 = #46#11; |PINTA #0#28;
          #0#20 = #46#4;  |PINTA #0#20;
          #0#25 = #46#8;  |PINTA #0#25;
          #0#29 = #46#12; |PINTA #0#29;
     |FINSI;
|FPRC;

|PROCESO Min;
     #refere1@#0 = #0#0;
     #refere1@#1 = 001;
|FPRC;

|PROCESO Max;
     #refere1@#0 = #0#0;
     #refere1@#1 = 999;
|FPRC;

|PROCESO Min3;
     #refere2@#0 = #refere1@#0;
     #refere2@#1 = #refere1@#1;
     #refere2@#2 = 001;
|FPRC;

|PROCESO Max3;
     #refere2@#0 = #refere1@#0;
     #refere2@#1 = #refere1@#1;
     #refere2@#2 = 999;
|FPRC;

|PROCESO Evento;
     |SI FSalida = 1; |O FSalida = 2;
          |LEE 000#refere1@.=;
          |REFRESCACONTROL nGrid3;
     |FINSI;
|FPRC

|PROCESO Tipo14; |TIPO 14;
     |ABRE #5; |LEE 000#5p; |CIERRA #5;
     nDec = #5#8;

     |SI nGrid1 = -1;
          nRango = 4 + 8 + 16 + 32;
          |LINEAL_SIMPLE #1#refere1@, nRango, 2602, 3250, Min, Max, Evento;
          nGrid1 = FSalida;
          |LINEAL_SIMPLE #1#refere2@, nRango, 2651, 3299, Min3, Max3, NULL;
          nGrid3 = FSalida;

          |PINPA #0#0; nPanta = FSalida;
          |CONTROL_SIMPLE nPanta, "BOTON,{{137}}Edici¢n", 2502, 2512, BtnEdiLin;
          nBtnEdiLin = FSalida;
          |CONTROL_SIMPLE nPanta, "BOTON,{{137}}Edici¢n", 2551, 2563, BtnEdiCom;
          nBtnEdiCom = FSalida;
     |SINO;
          |REFRESCACONTROL nGrid1;
     |FINSI;
|FPRC;

|PROCESO BorraLin3;
     |BORRA 020#3a;
     |LIBERA #3;
|FPRC;

|DEFBUCLE BorraLin3;
     #3#1;
     ;
     #1#0, #1#1, 001;
     #1#0, #1#1, 999;
     ;
     NULL, BorraLin3;
|FIN;

|PROCESO BorraLin49;
     |BUCLE BorraLin3;
     |BORRA 020#1a;
     |LIBERA #1;
|FPRC;

|DEFBUCLE BorraLin49;
     #1#1;
     ;
     #0#0, 001;
     #0#0, 999;
     be;
     NULL, BorraLin49;
|FIN;

|PROCESO baja; |TIPO 2;
     nModcab = (FEntrada / 100 ) ! 0;
     nForma  = 0 +. 1;
     |SI nForma = 1;
          nCalculo = 1;
          #0#2  = 0;
          #0#3  = 0;
          #0#4  = 0;
          #0#8  = 0;
          #0#21 = 0;
          #0#5  = 0;
          #0#11 = 0;
          #0#9  = 0;
          |BUCLELIN 2imprelia#0;
          nCalculo = 0;
          |ABRE #2;
          #2#0 = #0#0;
          |LEE 000#2=;
          |CIERRA #2;
          enTiva = #2#30;
          efFiva = ~;
          |HAZ SacaIVA;

          nPvp = #0#21;
          |SI #46#13 = "S";
               nPvp = nPvp > enIva;
          |FINSI;

          |SI #46#14 = "S";
               nNume = 1;
               |PARA nCampo = 1; |SI nCampo [ nDeci_EsCab; |HACIENDO nCampo = nCampo + 1;
                    nNume = nNume * 10;
               |SIGUE;
               nPvp = nPvp * nNume;

               |SI #2#109 > 0; nPvp = nPvp + (#2#109-1); |FINSI;
               nNume1 = (nPvp $ #2#109);
               |SI nNume1 ! 0;
                    nPvp = nPvp - nNume1;
               |FINSI;

               nPvp = nPvp / nNume;
          |FINSI;
          #0#21 = nPvp; |PINTA #0#21;
     |FINSI;

     |SI nModcab = 3;
          |BUCLE BorraLin49;
     |FINSI;
|FPRC;

|PROCESO CompaIVA;
     nContenido = Contenido;
     |SI nContenido = #45Campo;  |ACABA;  |FINSI;

     |HAZ LeeIVA;
||     |SI #46#13 = "N";
||          #45#4 = #45#8 / (1+ (enIva / 100));
||     |SINO;
          #45#4 = #45#8;
||     |FINSI;

     #45#3 = 100 - ((#45#0 / #45#4) * 100);
     |PINTA #45#3;
     |PINTA #45#4;
     |PINTA #45#8;
|FPRC;

|PROCESO Comparativo;
     nContenido = Contenido;
     |SI nContenido = #45Campo;  |ACABA;  |FINSI;

     |HAZ LeeIVA;

     |SI Campo = 3;
         #45#4 = #45#0 /  ((100 - #45#3) / 100);
         #45#4 = #45#4 > enIva; ||**
     |FINSI;

     |SI Campo = 4;
         nPvpSin = #45#4 / ( 1 + (enIva/100));   ||quito el iva **
         #45#3 = 100 - ((#45#0 / nPvpSin) * 100);|| **
||        #45#3 = 100 - ((#45#0 / #45#4) * 100); || **
     |FINSI;

     |HAZ CalcuIVA;
     #45#8 = nPvp;

     |PINTA #45#3;
     |PINTA #45#4;
     |PINTA #45#8;
|FPRC;

|PROCESO Tarifa;
/*
     |SI #45#6 = 1;  #45#7 = #2#130;  |FINSI;
     |SI #45#6 = 2;  #45#7 = #2#131;  |FINSI;
     |SI #45#6 = 3;  #45#7 = #2#132;  |FINSI;
     |SI #45#6 = 4;  #45#7 = #2#153;  |FINSI;
     |SI #45#6 = 5;  #45#7 = #2#154;  |FINSI;
     |SI #45#6 = 6;  #45#7 = #2#155;  |FINSI;
     |PINTA #45#7;
*/
|FPRC;

|PROCESO LeeIVA;
     |ABRE #2;
     #2#0 = #0#0;
     |LEE 000#2=;
     |CIERRA #2;
     enTiva = #2#30;
     efFiva = ~;
     |HAZ SacaIVA;
|FPRC;

|PROCESO CalcuIVA;
     |HAZ LeeIVA;
     nPvp = #45#4;
   ||  |SI #46#13 = "S";
          nPvp = nPvp > enIva;
   ||  |FINSI;

     |SI #46#14 = "S";
          nNume = 1;
          |PARA nCampo = 1; |SI nCampo [ nDeci_EsCab; |HACIENDO nCampo = nCampo + 1;
               nNume = nNume * 10;
          |SIGUE;
          nPvp = nPvp * nNume;

          |SI #2#109 > 0; nPvp = nPvp + (#2#109-1); |FINSI;
          nNume1 = (nPvp $ #2#109);
          |SI nNume1 ! 0;
               nPvp = nPvp - nNume1;
          |FINSI;

          nPvp = nPvp / nNume;
     |FINSI;
|FPRC;

|PROCESO Boton1;
     |PUSHV 0501 2380;
     |ATRI N; |BLANCO 717 2255;
     #45#0 = #0#11;
     #45#1 = #0#22;
     #45#2 = #0#21;
     #45#3 = #0#30;
     #45#4 = #0#31;
     #45#8 = #0#32;

     |SI #45#8 = 0;  |Y #45#4 = 0;
          |HAZ LeeIVA;
          nPvpSin = #45#2 / ( 1 + (enIva/100));   ||**
          #45#3 = 100 - ((#45#0 * 100) / nPvpSin);||**
          #45#4 = #45#0 /  ((100 - #45#3) / 100); ||**
          #45#4 = #45#4 > enIva;                  ||**

||          #45#3 = 100 - ((#45#0 * 100) / #45#2);
||          #45#4 = #45#0 /  ((100 - #45#3) / 100);

          |SI #46#13 = "N"
               |HAZ CalcuIVA;
               #45#8 = nPvp;
          |SINO;
               #45#8 = #45#4;
          |FINSI;
     |FINSI;

     |C_V #45#5, 1, "N";  |C_M #45#5, 1, "N";
     |C_V #45#6, 1, "N";  |C_M #45#6, 1, "N";
     |C_V #45#7, 1, "N";  |C_M #45#7, 1, "N";
     |C_M #45#3, 1, "S";
     |C_M #45#4, 1, "S";
     |C_M #45#8, 1, "S";

     |PINPA #0#45;
     |PINDA #0#45;
     |ENDATOS #1#45;
     |SI FSalida = 0;
         #0#30 = #45#3;
         #0#31 = #45#4;
         #0#32 = #45#8;
     |FINSI;
     |POPV;
     |PINTA #0#30;
     |PINTA #0#31;
|FPRC;

|PROCESO Boton2;
     |PUSHV 0501 2380;
     |ATRI N; |BLANCO 717 2255;
     #45#0 = #0#11;
     #45#1 = #0#22;
     #45#2 = #0#21;
     #45#3 = #0#30;
     #45#4 = #0#31;
     #45#7 = #46#13; ||IVA S/N
     #45#8 = #0#32;

     |C_V #45#5, 1, "S";  |C_M #45#5, 1, "S";
     |C_V #45#6, 1, "S";  |C_M #45#6, 1, "S";
     |C_V #45#7, 1, "S";
     |C_M #45#3, 1, "N";
     |C_M #45#4, 1, "N";
     |C_M #45#8, 1, "N";

     |ABRE #2;
     #2#0 = #0#0;
     |LEE 101#2=;
     |SI FSalida = 0;
         |PINPA #0#45;
         |ATRI R;
         |PINTA 1820,"PVP Calculado/Comparativo C/P :";
         |PINTA 1920,"Grabar en Tarifa .............:";
         |ATRI I;
         |PINTA 2020,"IVA incluido ... .............:";
         |ATRI 0;

         |PINDA #0#45;
         |ENDATOS #1#45;
         |SI FSalida = 0;
             nPrecio = #45#2;
             |SI #45#5 = "P";
/*
                 |SI #45#7 = "S";
                    nPrecio = #45#8;
                 |SINO;
                    nPrecio = #45#4;
                 |FINSI;
*/
                 nPrecio = #45#4;
             |FINSI;
             |SI #45#6 = 1;  #2#18  = nPrecio;  #2#130 = #45#7;  |FINSI;
             |SI #45#6 = 2;  #2#19  = nPrecio;  #2#131 = #45#7;  |FINSI;
             |SI #45#6 = 3;  #2#20  = nPrecio;  #2#132 = #45#7;  |FINSI;
             |SI #45#6 = 4;  #2#147 = nPrecio;  #2#153 = #45#7;  |FINSI;
             |SI #45#6 = 5;  #2#148 = nPrecio;  #2#154 = #45#7;  |FINSI;
             |SI #45#6 = 6;  #2#149 = nPrecio;  #2#155 = #45#7;  |FINSI;
             |GRABA 020#2a;
             |LIBERA #2;

             |SI #45#6 = 1;
                 #0#22 = nPrecio;
             |FINSI;
         |FINSI;
     |FINSI;

     |POPV;
     |PINTA #0#22;
|FPRC;

|PROCESO ConfirmaPCM;
     |CONFI "0000N¨Actualizar PCM del Articulo?";
     nSwConfi = FSalida;
|FPRC;

|PROCESO Tipo3m48;  |TIPO 3;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 1;
          |ABRE #1;
          #1#0 = #0#0;
          #1#1 = 1;
          |LEE 000#1];
          |SI FSalida ! 0; |O #1#0 ! #0#0;
               nSwAlta = 1;
               |HAZ BtnEdiLin;
               nSwAlta = 0;
          |FINSI;
          |CIERRA #1;
     |FINSI;

     |SI nSwConfi = 1;
          |HAZ ConfirmaPCM;
     |FINSI;
     |SI nSwConfi = 0;
          |ABRE #2;
          #2#0 = #0#0;
          |LEE 101#2=;
          |SI FSalida = 0;
               #2#9 = #0#9;
               |GRABA 020#2a;
          |FINSI;
          |CIERRA #2;

          |ABRE #17;
          #17#0 = #0#0;
          #17#1 = #0#10;
          |LEE 101#17=;
          |SI FSalida = 0;
               #17#69 = #0#11;     || PCM
               |GRABA 020#17a;
          |FINSI;
          |CIERRA #17;
     |FINSI;
|FPRC;

|PROCESO Tipo8;  |TIPO 8;
     |DDEF aPath;
     aAlfa = aPath + "berm0002"; |CARGA_DEF aAlfa , refere1@;
     aAlfa = aPath + "berm0003"; |CARGA_DEF aAlfa , refere2@;

     |ABRET #refere1@;
     |ABRET #refere2@;

     |ABRE #agifa324;
     |ABRE #agifa321;
     |LEE 001#agifa321.p;
     #agifa324#0 = #agifa321#9;    ||Igualo a moneda base
     |LEE 001#agifa324.=;
     nDeci_Base = #agifa324#7;     ||Decimales moneda base
     nDeci_PreBase = #agifa324#9;  ||Decimales precio de moneda base
     |CIERRA #agifa321;
     |CIERRA #agifa324;

     |ABRE #46;
     |LEE 040#46p;
     |SI FSalida ! 0;  |DDEFECTO #46;  |FINSI;
     |CIERRA #46;

     nDeci_EsCab = #46#15;
     nDeci_EsLin = #46#16;
|FPRC;

|PROCESO Tipo9;  |TIPO 9;
     |CIERRAT #refere1@;
     |CIERRAT #refere2@;
     |DESCARGA_DEF #refere1@;
     |DESCARGA_DEF #refere2@;
|FPRC;

|PROCESO Tipo30_48; |TIPO 30;
     aAlfa = "agifa053;" + #0#0;  ||Chequeo
     |SUB_EJECUTA aAlfa;

     |ABRE #1;
     #1#0 = #0#0;
     #1#1 = 1;
     |LEE 000#1];
     |SI FSalida ! 0; |O #1#0 ! #0#0;
          |SI nModo = 1;
               |MENAV "0000Se anulan los datos entrados.";
          |SINO;
               |MENAV "0000No existen lineas, se borra la cabecera.";
          |FINSI;
          |BORRA 020#0a;
          |BUCLE BorraLin49;
          |ERROR;
     |FINSI;
     |CIERRA #1;
|FPRC;

|PROCESO Tipo7_48; |TIPO 7;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 1;
          #0#34 = #46#17;
          |PINTA #0#34;
     |FINSI;
|FPRC;

|PROCESO T48_13; |TIPO 13;
|FPRC;

|PROCESO EscanLin13; |TIPO 13;
|FPRC;

|PROCESO Observa49; |TIPO 0;
     |SI FSalida = 0; |O FSalida = 3;
     |FINSI;
|FPRC;

|PROCESO DefTipo; |TIPO 7;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 1;
          |ABRE #5; |LEE 000#5p; |CIERRA #5;
          |SI #5#12 = "K";
               #0#33 = "K";
          |SINO;
               #0#33 = "N";
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO RecalLin;
     |HAZ totliesc;

     |HAZ imprelia;
     |GRABA 020#1a;
     |LIBERA #1;
|FPRC;

|PROCESO Min1;
     #1#0 = #0#0;
     #1#1 = 1;
|FPRC;

|PROCESO Max1;
     #1#0 = #0#0;
     #1#1 = 999;
|FPRC;

|PROCESO CalGasto;
     |SI #0Campo ! Contenido;
          nCalculo = 1;
          #0#2  = 0;
          #0#3  = 0;
          #0#4  = 0;
          #0#8  = 0;
          #0#21 = 0;
          #0#5  = 0;
          #0#11 = 0;
          #0#9  = 0;
          |BUCLELIN 0 RecalLin #0;
          nCalculo = 0;
          |HAZ totcoste;
          |PINDA #0#0;
          |ENTLINEAL #1#1, 1, 7, 22, 0, Min1, Max1;
     |FINSI;
|FPRC;
--------------------------------------------------------
     Procesos A¤adidos para el X
--------------------------------------------------------
|PROCESO T12_48; |TIPO 12;
     || no quitar
|FPRC;

|PROCESO T7_48; |TIPO 7;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 1;
          |BUCLE BorraLin49;
     |FINSI;
|FPRC;

|PROCESO T0_48; |TIPO 0;
     |REFRESCACONTROL nGrid1;
|FPRC;
-------------------------------------------------------------------------
|PROCESO EventoLin;
     |SI FSalida = 1; |O FSalida = 2;
          |LEE 000#refelin@.=;
     |FINSI;
|FPRC;


|PROCESO EvtCom;
     |SI FSalida = 1; |O FSalida = 2;
          |LEE 000#refecom@.=;
     |FINSI;
|FPRC;

|PROCESO MinLin;
     #refelin@#0 = #0#0;
     #refelin@#1 = 001;
|FPRC;

|PROCESO MaxLin;
     #refelin@#0 = #0#0;
     #refelin@#1 = 999;
|FPRC;

|PROCESO MinCom;
     #refecom@#0 = aLinEsc;
     #refecom@#1 = nLinLin;
     #refecom@#2 = 000;
|FPRC;

|PROCESO MaxCom;
     #refecom@#0 = aLinEsc;
     #refecom@#1 = nLinLin;
     #refecom@#2 = 999;
|FPRC;

|PROCESO BtnEdiLin;
     |LEE 101#0=;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |DDEF aAlfa;
     aAlfa = aAlfa + "berm0002";
     |CARGA_DEF aAlfa, refelin@;

     |VENTANA 1901, 3198, -1, 17, "Lineas escandallo";
     |HAZ PushVenModal;

     |CONTROL_SIMPLE 0, "BOTON,{{193}}Alta", 2002, 2012, BtnAltaLin;
     nBtnAltaLin = FSalida;
     |CONTROL_SIMPLE 0, "BOTON,{{197}}Modificar", 2014, 2024, BtnModiLin
     nBtnModiLin = FSalida;
     |CONTROL_SIMPLE 0, "BOTON,{{199}}Baja", 2026, 2036, BtnBajaLin;
     nBtnBajaLin = FSalida;
     |CONTROL_SIMPLE 0, "BOTON,{{155}}Consulta", 2038, 2048, BtnConsLin;
     nBtnConsLin = FSalida;
     |CONTROL_SIMPLE 0, "BOTON,{{137}}Componentes", 2050, 2065, BtnCompo;
     nBtnCompo = FSalida;

     |ABRE #refelin@;
     nRango = 4 + 8 + 16 + 32;
     |LINEAL_SIMPLE #1#refelin@, nRango, 2102, 2998, MinLin, MaxLin, EventoLin;
     nGridLin = FSalida;
     |SI nSwAlta = 1;
          |HAZ BtnAltaLin;
     |SINO;
          enCtrFin = FSalida; |HAZ EsperaFin;
     |FINSI;
     |CIERRA #refelin@;

     |FIN_CONTROL_WINDOWS nBtnAltaLin;
     |FIN_CONTROL_WINDOWS nBtnModiLin;
     |FIN_CONTROL_WINDOWS nBtnBajaLin;
     |FIN_CONTROL_WINDOWS nBtnConsLin;
     |FIN_CONTROL_WINDOWS nBtnCompo;
     |DESTRUYECONTROL nGridLin;

     |HAZ PopVenModal;

     |DESCARGA_DEF #refelin@;

     |REFRESCACONTROL nGrid1;

     |GRABA 020#0a;
     |LIBERA #0;
|FPRC;

|PROCESO BtnEdiCom;
     |LEE 000#refere1@.=;
     |SI FSalida ! 0; |ACABA; |FINSI;
     |SI #refere1@#24 = "S";
          |MENAV "0000El art¡culo de la linea del escadallo es final...";
          |ACABA;
     |FINSI;

     aLinEsc = #refere1@#0;
     nLinLin = #refere1@#1;
     aLinArt = #refere1@#2;
     aLinDes = #refere1@#3;
     |HAZ EdiCom0;
|FPRC;

|PROCESO EdiCom0;
     |DDEF aAlfa;
     aAlfa = aAlfa + "berm0003";
     |CARGA_DEF aAlfa, refecom@;

     |VENTANA 1901, 3198, -1, 17, "Lineas componentes escandallo";
     |HAZ PushVenModal;

     #101#0 = aLinArt;
     #101#1 = aLinDes;
     |PINPA #0#101; nPanta1 = FSalida;
     |PINDA #0#101;
     |CONTROL_SIMPLE nPanta1, "BOTON,{{193}}Alta", 0802, 0812, BtnAltaCom;
     nBtnAltaCom = FSalida;
     |CONTROL_SIMPLE nPanta1, "BOTON,{{197}}Modificar", 0814, 0824, BtnModiCom
     nBtnModiCom = FSalida;
     |CONTROL_SIMPLE nPanta1, "BOTON,{{199}}Baja", 0826, 0836, BtnBajaCom;
     nBtnBajaCom = FSalida;
     |CONTROL_SIMPLE nPanta1, "BOTON,{{155}}Consulta", 0838, 0848, BtnConsCom;
     nBtnConsCom = FSalida;
     |CONTROL_SIMPLE nPanta1, "LABEL,{{003}}(Doble click marca valor defecto)", 0852, 0890, NULL;
     nLabel = FSalida;

     |ABRE #refecom@;
     nRango = 4 + 8 + 16 + 32;
     |LINEAL_SIMPLE #1#refecom@, nRango, 0902, 1698, MinCom, MaxCom, EvtCom;
     nGridCom = FSalida;
     |SI nSwAlta = 1;
          |HAZ BtnAltaCom;
     |SINO;
          enCtrFin = FSalida; |HAZ EsperaFin;
     |FINSI;
     |CIERRA #refecom@;

     |FIN_CONTROL_WINDOWS nLabel;
     |FIN_CONTROL_WINDOWS nBtnAltaCom;
     |FIN_CONTROL_WINDOWS nBtnModiCom;
     |FIN_CONTROL_WINDOWS nBtnBajaCom;
     |FIN_CONTROL_WINDOWS nBtnConsCom;
     |DESTRUYECONTROL nGridCom;

     |HAZ PopVenModal;

     |DESCARGA_DEF #refecom@;

     |REFRESCACONTROL nGrid3;
|FPRC;

|PROCESO BtnAltaLin;
     nModoLin = 1;
     |HAZ EditaLin;
|FPRC;

|PROCESO BtnModiLin;
     nModoLin = 2;
     |LEE 000#refelin@.=;
     |SI FSalida ! 0; |ACABA; |FINSI;
     |HAZ EditaLin;
|FPRC;

|PROCESO BtnBajaLin;
     |LEE 101#refelin@.=;
     |SI FSalida ! 0; |ACABA; |FINSI;
     aAlfa = "0000N¿Borrar linea: " + #refelin@#1 + "?";
     |CONFI aAlfa;
     |SI FSalida = 0;
          |ABRE #1;
          #1#0 = #refelin@#0;
          #1#1 = #refelin@#1;
          |BORRA 020#1c;      || Para que entre en el tipo 17
          |CIERRA #1;
          ||BORRA 020#refelin@.a;

          |ABRE #3;
          #3#0 = #1#0;
          #3#1 = #1#1;
          #3#2 = 0;
          |LEE 101#3];
          |PARA; |SI FSalida = 0; |Y #3#0 = #1#0; |Y #3#1 = #1#1; |HACIENDO;
               |BORRA 020#3a;
               |LIBERA #3;
               |LEE 101#3s;
          |SIGUE;
          |CIERRA #3;
          |REFRESCACONTROL nGridLin;
     |FINSI;
|FPRC;

|PROCESO BtnConsLin;
     nModoLin = 4;
     |LEE 000#refelin@.=;
     |SI FSalida ! 0; |ACABA; |FINSI;
     |HAZ EditaLin;
|FPRC;

|PROCESO BtnCompo;
     |LEE 000#refelin@.=;
     |SI FSalida ! 0; |ACABA; |FINSI;
     |SI #refelin@#24 = "S";
          |MENAV "0000El art¡culo de la linea del escadallo es final...";
          |ACABA;
     |FINSI;

     aLinEsc = #refelin@#0;
     nLinLin = #refelin@#1;
     aLinArt = #refelin@#2;
     aLinDes = #refelin@#3;
     |HAZ EdiCom0;
|FPRC;

|PROCESO BtnAltaCom;
     nModoCom = 1;
     |HAZ EditaCom;
|FPRC;

|PROCESO BtnModiCom;
     nModoCom = 2;
     |LEE 000#refecom@.=;
     |SI FSalida ! 0; |ACABA; |FINSI;
     |HAZ EditaCom;
|FPRC;

|PROCESO BtnBajaCom;
     |LEE 101#refecom@.=;
     |SI FSalida ! 0; |ACABA; |FINSI;
     aAlfa = "0000N¿Borrar linea: " + #refecom@#2 + "?";
     |CONFI aAlfa;
     |SI FSalida = 0;
          |BORRA 020#refecom@.a;
          |REFRESCACONTROL nGridCom;
     |FINSI;
|FPRC;

|PROCESO BtnConsCom;
     nModoCom = 4;
     |LEE 000#refecom@.=;
     |SI FSalida ! 0; |ACABA; |FINSI;
     |HAZ EditaCom;
|FPRC;

|PROCESO BtnOtraAlta;
     nSwOtra1 = 1;
     nSwOtra3 = 1;
     |PTEC 806;
|FPRC;

|PROCESO TieneCompo;
     aTieneCompo = "S";
     |ABRE #3;
     #3#0 = #1#0;
     #3#1 = #1#1;
     #3#2 = 1;
     |LEE 000#3];
     |SI FSalida ! 0; |O #3#0 ! #1#0; |O #3#1 ! #1#1;
          aTieneCompo = "N";
     |FINSI;
     |CIERRA #3;
|FPRC;

|PROCESO EditaLin;
     |SI nModoLin = 1; |VENTANA 1901, 3198, -1, 17, "Nueva l¡nea escandallo"; |FINSI;
     |SI nModoLin = 2; |VENTANA 1901, 3198, -1, 17, "Modifica l¡nea escandallo"; |FINSI;
     |SI nModoLin = 4; |VENTANA 1901, 3198, -1, 17, "Consulta l¡nea volumen"; |FINSI;
     |HAZ PushVenModal;

     |PINPA #0#1;
     nPanEdi = FSalida;
     |SI nModoLin = 1;
          |CONTROL_SIMPLE nPanEdi, "BOTON,{{206}}Validar y otra Alta", 1602, 1622, BtnOtraAlta;
     |FINSI;
     |SI nModoLin = 2;
          |CONTROL_SIMPLE nPanEdi, "BOTON,{{206}}Validar y siguiente", 1602, 1622, BtnOtraAlta;
     |FINSI;
     |SI nModoLin = 4;
          |CONTROL_SIMPLE nPanEdi, "BOTON,{{206}}Consulta siguiente", 1602, 1622, BtnOtraAlta;
     |FINSI;
     nBtnOtraAlta = FSalida;

     |ABRE #1;
|ET OtraLin;
     nSwOtra1 = 0;
     |SI nModoLin = 1;
          #1#0 = #0#0;
          #1#1 = 999;
          |LEE 000#1];
          |SI FSalida = 0;
               |LEE 000#1a;
          |SINO;
               |LEE 000#1u;
          |FINSI;
          |SI FSalida = 0; |Y #1#0 = #0#0;
               nLin = #1#1 + 1;
          |SINO;
               nLin = 1;
          |FINSI;
          |DDEFECTO #1;
          #1#0 = #0#0;
          #1#1 = nLin;
          |GRABA 020#1b;
     |SINO;
          #1#0 = #refelin@#0;
          #1#1 = #refelin@#1;
          |LEE 121#1=;
     |FINSI;
     |C_M #1#26, 1, "S";
     |PINDA #0#1;
     |SI nModoLin = 1; |ENDATOS #1#1; |FINSI;
     |SI nModoLin = 2; |ENDATOS #2#1; |FINSI;
     |SI nModoLin = 4; |PAUSA; |FINSI;
     |SI FSalida = 0; |Y nModoLin ! 4;
          |GRABA 020#1a;
          |SI #1#24 = "S";
               |BUCLE BorraLin3;
          |SINO;
               |HAZ TieneCompo;
               |SI nModoLin = 1; |O aTieneCompo = "N";
                    aLinEsc = #1#0;
                    nLinLin = #1#1;
                    aLinArt = #1#2;
                    aLinDes = #1#3;
                    nSwAlta = 1;
                    |HAZ EdiCom0;
                    nSwAlta = 0;
               |FINSI;
               |HAZ TieneCompo;
               |SI aTieneCompo = "N";
                    |MENAV "0000No se han introducido componentes. Se cambia Final = 'S'";
                    #1#24 = "S";
               |FINSI;
          |FINSI;
          |GRABA 020#1a;
          |REFRESCACONTROL nGridLin;
          |PULSATECLA;
          |SI nSwOtra1 = 1;
               |LIBERA #1;
               |SI nModoLin = 1;
                    |VETE OtraLin;
               |SINO;
                    |LEE 101#1s;
                    |SI FSalida = 0; |Y #1#0 = #0#0;
                         |VETE OtraLin;
                    |SINO;
                         |MENAV "0000No hay mas registros...";
                    |FINSI;
               |FINSI;
          |FINSI;
     |SINO;
          |SI nModoLin = 4; |Y nSwOtra1 = 1;
               |REFRESCACONTROL nGridLin;
               |PULSATECLA;
               |LEE 000#refelin@.s;
               |SI FSalida = 0; |Y #refelin@#0 = #0#0;
                    |VETE OtraLin;
               |SINO;
                    |MENAV "0000No hay mas registros...";
               |FINSI;
          |FINSI;
          |SI nModoLin = 1;
               |BORRA 020#1c;
               |REFRESCACONTROL nGridLin;
          |FINSI;
     |FINSI;
     |LIBERA #1;
     |CIERRA #1;

     |FIN_CONTROL_WINDOWS nBtnOtraAlta;
     |HAZ PopVenModal;
|FPRC;

|PROCESO BtnTodoFondo;
     #3#7 = #0#55; |PINTA #3#7;
     #3#8 = #0#56; |PINTA #3#8;
     #3#9 = #0#57; |PINTA #3#9;
     #3#10 = #0#58; |PINTA #3#10;
     #3#11 = #0#59; |PINTA #3#11;
|FPRC;

|PROCESO BtnTodoPega;
     #3#12 = #0#37; |PINTA #3#12;
     #3#13 = #0#38; |PINTA #3#13;
     #3#14 = #0#39; |PINTA #3#14;
     #3#15 = #0#40; |PINTA #3#15;
     #3#16 = #0#41; |PINTA #3#16;
     #3#17 = #0#42; |PINTA #3#17;
     #3#18 = #0#43; |PINTA #3#18;
     #3#19 = #0#44; |PINTA #3#19;
     #3#20 = #0#45; |PINTA #3#20;
     #3#21 = #0#46; |PINTA #3#21;
|FPRC;

|PROCESO BtnTodoAcaba;
     #3#22 = #0#60; |PINTA #3#22;
     #3#23 = #0#61; |PINTA #3#23;
|FPRC;

|PROCESO BtnTodoTalla;
     #3#24 = #0#64; |PINTA #3#24;
     #3#25 = #0#65; |PINTA #3#25;
     #3#26 = #0#66; |PINTA #3#26;
     #3#27 = #0#67; |PINTA #3#27;
     #3#28 = #0#68; |PINTA #3#28;
     #3#29 = #0#69; |PINTA #3#29;
     #3#30 = #0#70; |PINTA #3#30;
     #3#31 = #0#71; |PINTA #3#31;
|FPRC;

|PROCESO EditaCom;
     |SI nModoCom = 1; |VENTANA 2101, 3198, -1, 17, "Nueva l¡nea componente escandallo"; |FINSI;
     |SI nModoCom = 2; |VENTANA 2101, 3198, -1, 17, "Modifica l¡nea componente escandallo"; |FINSI;
     |SI nModoCom = 4; |VENTANA 2101, 3198, -1, 17, "Consulta l¡nea componente volumen"; |FINSI;
     |HAZ PushVenModal;

     |PINPA #0#3;
     nPanEdi = FSalida;
     |SI nModoCom = 1;
          |CONTROL_SIMPLE nPanEdi, "BOTON,{{206}}Validar y otra Alta", 1402, 1422, BtnOtraAlta;
     |FINSI;
     |SI nModoCom = 2;
          |CONTROL_SIMPLE nPanEdi, "BOTON,{{206}}Validar y siguiente", 1402, 1422, BtnOtraAlta;
     |FINSI;
     |SI nModoCom = 4;
          |CONTROL_SIMPLE nPanEdi, "BOTON,{{206}}Consulta siguiente", 1402, 1422, BtnOtraAlta;
     |FINSI;
     nBtnOtraAlta = FSalida;

     |CONTROL_SIMPLE nPanEdi, "BOTON,{{206}}Todos", 0990, 0997, BtnTodoFondo;
     nBtnTodoFondo = FSalida;
     |CONTROL_SIMPLE nPanEdi, "BOTON,{{206}}Todos", 1090, 1097, BtnTodoPega;
     nBtnTodoPega = FSalida;
     |CONTROL_SIMPLE nPanEdi, "BOTON,{{206}}Todos", 1190, 1197, BtnTodoAcaba;
     nBtnTodoAcaba = FSalida;
     |CONTROL_SIMPLE nPanEdi, "BOTON,{{206}}Todos", 1290, 1297, BtnTodoTalla;
     nBtnTodoTalla = FSalida;

     |ABRE #3;
  |ET OtraCom;
     nSwOtra3 = 0;
     |SI nModoCom = 1;
          #3#0 = aLinEsc;
          #3#1 = nLinLin;
          #3#2 = 999;
          |LEE 000#3];
          |SI FSalida = 0;
               |LEE 000#3a;
          |SINO;
               |LEE 000#3u;
          |FINSI;
          |SI FSalida = 0; |Y #3#0 = aLinEsc; |Y #3#1 = nLinLin;
               nLin = #3#2 + 1;
          |SINO;
               nLin = 1;
          |FINSI;
          |DDEFECTO #3;
          #3#0 = aLinEsc;
          #3#1 = nLinLin;
          #3#2 = nLin;
          |GRABA 020#3b;
     |SINO;
          #3#0 = #refecom@#0;
          #3#1 = #refecom@#1;
          #3#2 = #refecom@#2;
          |LEE 121#3=;
     |FINSI;

     |SI #refelin@#26 = "A"; aAlfa = "S"; |SINO; aAlfa = "N"; |FINSI;
     |PARA i = 7; |SI i [ 31; |HACIENDO i = i + 1;
          |C_M #3i, 1, aAlfa;
     |SIGUE;
     |SI #refelin@#26 = "M";
          |C_M #3#6, 1, "S";
     |SINO;
          |C_M #3#6, 1, "N";
     |FINSI;
     |SI nModoCom = 4; |O aAlfa = "N";
          |ESTADO_CONTROL nBtnTodoFondo, "DISABLE";
          |ESTADO_CONTROL nBtnTodoPega, "DISABLE";
          |ESTADO_CONTROL nBtnTodoAcaba, "DISABLE";
          |ESTADO_CONTROL nBtnTodoTalla, "DISABLE";
     |FINSI;

     |PINDA #0#3;
     |SI nModoCom = 1; |ENDATOS #1#3; |FINSI;
     |SI nModoCom = 2; |ENDATOS #2#3; |FINSI;
     |SI nModoCom = 4; |PAUSA; |FINSI;
     |SI FSalida = 0; |Y nModoCom ! 4;
          |GRABA 020#3a;
          |SI nGridCom ! -1; |REFRESCACONTROL nGridCom; |FINSI;
          |PULSATECLA;
          |SI nSwOtra3 = 1;
               |LIBERA #3;
               |SI nModoCom = 1;
                    |VETE OtraCom;
               |SINO;
                    |LEE 101#3s;
                    |SI FSalida = 0; |Y #3#0 = #refecom@#0; |Y #3#1 = #refecom@#1;
                         |VETE OtraCom;
                    |SINO;
                         |MENAV "0000No hay mas registros...";
                    |FINSI;
               |FINSI;
          |FINSI;
     |SINO;
          |SI nModoCom = 4; |Y nSwOtra3 = 1;
               |REFRESCACONTROL nGridCom;
               |PULSATECLA;
               |LEE 000#refecom@.s;
               |SI FSalida = 0; |Y #3#0 = #refecom@#0; |Y #3#1 = #refecom@#1;
                    |VETE OtraCom;
               |SINO;
                    |MENAV "0000No hay mas registros...";
               |FINSI;
          |FINSI;
          |SI nModoCom = 1;
               |BORRA 020#3c;
               |REFRESCACONTROL nGridCom;
          |FINSI;
     |FINSI;
     |LIBERA #3;
     |CIERRA #3;

     |FIN_CONTROL_WINDOWS nBtnOtraAlta;
     |FIN_CONTROL_WINDOWS nBtnTodoFondo;
     |FIN_CONTROL_WINDOWS nBtnTodoPega;
     |FIN_CONTROL_WINDOWS nBtnTodoAcaba;
     |FIN_CONTROL_WINDOWS nBtnTodoTalla;
     |HAZ PopVenModal;
|FPRC;

|PROCESO ColorP; |TIPO 0;
     |SI #0Campo = 0; |ACABA; |FINSI;
     |ABRE #50;
     #50#0 = #0Campo;
     |LEE 000#50=;
     |SI FSalida ! 0;
          |MENAV "0000No existe c¢digo...";
          |ERROR;
     |SINO;
          |SI #50#8 ! "P";
               |MENAV "0000El c¢digo no es de pegatina...";
               |ERROR;
          |FINSI;
     |FINSI;
     |CIERRA #50;
|FPRC;

|PROCESO ColorF; |TIPO 0;
     |SI #0Campo = 0; |ACABA; |FINSI;
     |ABRE #50;
     #50#0 = #0Campo;
     |LEE 000#50=;
     |SI FSalida ! 0;
          |MENAV "0000No existe c¢digo...";
          |ERROR;
     |SINO;
          |SI #50#8 ! "F";
               |MENAV "0000El c¢digo no es de fondo...";
               |ERROR;
          |FINSI;
     |FINSI;
     |CIERRA #50;
|FPRC;

|PROCESO Acaba; |TIPO 0;
     |ABRE #100;
     #100#0 = #0Campo;
     |LEE 000#100=;
     |SI FSalida ! 0;
          |MENAV "0000No existe c¢digo...";
          |ERROR;
     |FINSI;
     |CIERRA #100;
|FPRC;

|PROCESO Talla; |TIPO 0;
     |ABRE #115;
     #115#0 = #0Campo;
     |LEE 000#115=;
     |SI FSalida ! 0;
          |MENAV "0000No existe c¢digo...";
          |ERROR;
     |FINSI;
     |CIERRA #115;
|FPRC;

|PROCESO TipoCom; |TIPO 0;
     |ABRE #40;
     #40#0 = #1Campo;
     |LEE 000#40=;
     |SI FSalida ! 0;
          |MENAV "0000No existe c¢digo...";
          |ERROR;
     |SINO;
          #1#23 = #40#1; |PINTA #1#23;
          |SI aConte ! #1Campo;
               #1#24 = #40#4; |PINTA #1#24;
               #1#25 = #40#3; |PINTA #1#25;
          |FINSI;
     |FINSI;
     |CIERRA #40;
|FPRC;

|PROCESO ConteLin; |TIPO 7;
     aConte = #1Campo;
|FPRC;

|PROCESO ColorP3; |TIPO 0;
     |SI #3Campo = 0; |ACABA; |FINSI;
     |ABRE #50;
     #50#0 = #3Campo;
     |LEE 000#50=;
     |SI FSalida ! 0;
          |MENAV "0000No existe c¢digo...";
          |ERROR;
     |SINO;
          |SI #50#8 ! "P";
               |MENAV "0000El c¢digo no es de pegatina...";
               |ERROR;
          |FINSI;
     |FINSI;
     |CIERRA #50;
|FPRC;

|PROCESO ColorF3; |TIPO 0;
     |SI #0Campo = 0; |ACABA; |FINSI;
     |ABRE #50;
     #50#0 = #3Campo;
     |LEE 000#50=;
     |SI FSalida ! 0;
          |MENAV "0000No existe c¢digo...";
          |ERROR;
     |SINO;
          |SI #50#8 ! "F";
               |MENAV "0000El c¢digo no es de fondo...";
               |ERROR;
          |FINSI;
     |FINSI;
     |CIERRA #50;
|FPRC;

|PROCESO Acaba3; |TIPO 0;
     |ABRE #100;
     #100#0 = #3Campo;
     |LEE 000#100=;
     |SI FSalida ! 0;
          |MENAV "0000No existe c¢digo...";
          |ERROR;
     |FINSI;
     |CIERRA #100;
|FPRC;

|PROCESO Talla3; |TIPO 0;
     |ABRE #115;
     #115#0 = #3Campo;
     |LEE 000#115=;
     |SI FSalida ! 0;
          |MENAV "0000No existe c¢digo...";
          |ERROR;
     |FINSI;
     |CIERRA #115;
|FPRC;

|PROCESO Final; |TIPO 0;
     |SI #1#24 = "N";
          |C_M #1#26, 1, "S"; |PINTA #1#26;
     |SINO;
          |C_M #1#26, 1, "N"; |PINTA #1#26;
     |FINSI;
|FPRC;

|PROCESO TipoFin; |TIPO 0;
     |SI #1#26 = "A"; |O #1#26 = "M";
          aAlfa = #1#2; |QBF aAlfa;
          |SI aAlfa ! "";
               |MENAV "0000La l¡nea no puede tener un art¡culo...";
               |ERROR;
          |FINSI;
     |FINSI;
     |SI #1#26 = "C";
          aAlfa = #1#2; |QBF aAlfa;
          |SI aAlfa = "";
               |MENAV "0000Debe de indicar alg£n art¡culo...";
               |ERROR;
          |FINSI;
     |FINSI;
|FPRC;
