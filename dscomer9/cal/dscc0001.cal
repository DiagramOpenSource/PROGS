|FICHEROS;
     dscc0001 #0;
     agifa019 #19;
     agifa024 #24;
     agifa112 #112;
     agifa025 #25;
     agifa017 #17;

     foto0015@ #90;
     foto0016@ #91;
|FIN;

|VARIABLES;
     aDef = "";
     aAlfa = "";
     dbase    = "";
     dir      = "";
     alfa1    = "";
     alfa2    = "";
     origen   = "";
     destino  = "";
     Campo19  = 0;
     Campo17  = 0;
     Campo25  = 0;
     Campo24  = 0;
     Campo112 = 0;
     &ddestino = "";
     i        =  0;
     afichero = "";
     ai       = "";
     atermina = "";
     afich    = "";
|FIN;

|PROCESO foto0016;
     |BORRA 020#91a;
|FPRC;

|DEFBUCLE foto0016;
     #91#1002;
     ;
     #90#0, 001;
     #90#0, 999;
     ;
     NULL, foto0016;
|FIN;

|PROCESO foto0015;
     |SI #90#5 = "R"; |O #90#5 = "r";
         |BORRA 020#90a;
         |BUCLE foto0016;
    |FINSI;
|FPRC;

|DEFBUCLE foto0015;
     #90#1001;
     ;
     "               ";
     "zzzzzzzzzzzzzzz";
     be;
     NULL, foto0015;
|FIN;

|PROCESO BorraFotos;
     |DDEF aDef;
     aAlfa = aDef + "foto0015";
     |CARGA_DEF aAlfa, foto0015@;
     |SI FSalida = 0;
          aAlfa = aDef + "foto0016";
          |CARGA_DEF aAlfa, foto0016@;
          |SI FSalida = 0;
               |PATH_DAT #90 ddestino;
               |PATH_DAT #91 ddestino;
               |BUCLE foto0015;
               |DESCARGA_DEF #foto0016@;
          |FINSI;
          |DESCARGA_DEF #foto0015@;
     |FINSI;
|FPRC;

||***** Este proceso copia los ficheros de parametros grales

|PROCESO copia;
        |DFICE alfa1;
        alfa2= alfa1 % -106;
        dir = alfa1 - alfa2;
        ||*******Fichero de series
          origen  = dir + #0#0 + "/" + "agifa007.dat";
          destino = dir + #0#1 + "/" + "agifa007.dat";
          |COPIA_FICHERO origen,destino;

        ||*******Fichero datos almacenes agifa029
          origen  = dir + #0#0 + "/" + "agifa029.dat";
          destino = dir + #0#1 + "/" + "agifa029.dat";
          |COPIA_FICHERO origen,destino;

        ||*******Fichero Provinciero agifa040
          origen  = dir + #0#0 + "/" + "agifa040.dat";
          destino = dir + #0#1 + "/" + "agifa040.dat";
          |COPIA_FICHERO origen,destino;

        ||*******Fichero Empresas agifa041
        ||  origen  = dir + #0#0 + "/" + "agifa041.dat";
        ||  destino = dir + #0#1 + "/" + "agifa041.dat";
        || |COPIA_FICHERO origen,destino;

        ||*******Fichero familias agifa060
          origen  = dir + #0#0 + "/" + "agifa060.dat";
          destino = dir + #0#1 + "/" + "agifa060.dat";
          |COPIA_FICHERO origen,destino;

        ||*******Fichero ivas agifa066
          origen  = dir + #0#0 + "/" + "agifa066.dat";
          destino = dir + #0#1 + "/" + "agifa066.dat";
          |COPIA_FICHERO origen,destino;

        ||*******Fichero Formas de pago agifa091
          origen  = dir + #0#0 + "/" + "agifa091.dat";
          destino = dir + #0#1 + "/" + "agifa091.dat";
          |COPIA_FICHERO origen,destino;

        ||*******Fichero Subfamilias agifa120
          origen  = dir + #0#0 + "/" + "agifa120.dat";
          destino = dir + #0#1 + "/" + "agifa120.dat";
          |COPIA_FICHERO origen,destino;

        ||*******Fichero Par metros generales agifa142
          origen  = dir + #0#0 + "/"+ "agifa142.dat";
          destino = dir + #0#1 + "/"+ "agifa142.dat";
          |COPIA_FICHERO origen,destino;

        ||*******Fichero de DIVISAS agifa321
          origen  = dir + #0#0 + "/" + "agifa321.dat";
          destino = dir + #0#1 + "/" + "agifa321.dat";
          |COPIA_FICHERO origen,destino;

        ||*******Fichero de Par metros caja agifa505
          origen  = dir + #0#0 + "/" + "agifa505.dat";
          destino = dir + #0#1 + "/" + "agifa505.dat";
          |COPIA_FICHERO origen,destino;

        ||*******Fichero de horarios agifa510
          origen  = dir + #0#0 + "/" + "agifa510.dat";
          destino = dir + #0#1 + "/" + "agifa510.dat";
          |COPIA_FICHERO origen,destino;

        ||*******Fichero de cajeros agifa514
          origen =  dir + #0#0 + "/" + "agifa514.dat";
          destino = dir + #0#1 + "/" + "agifa514.dat";
          |COPIA_FICHERO origen,destino;

        ||*******Fichero de tarjetas agifa515
          origen  = dir + #0#0 + "/" + "agifa515.dat";
          destino = dir + #0#1 + "/" + "agifa515.dat";
          |COPIA_FICHERO origen,destino;

        ||*******Fichero Par metros TPV agifa517
          origen  = dir + #0#0 + "/" + "agifa517.dat";
          destino = dir + #0#1 + "/" + "agifa517.dat";
          |COPIA_FICHERO origen,destino;

        ||*******Fichero de Control Path agifa555
          origen  = dir + #0#0 + "/" + "agifa555.dat";
          destino = dir + #0#1 + "/" + "agifa555.dat";
          |COPIA_FICHERO origen,destino;

        ||*******Fichero de Control Path TPV agifa556
          origen  = dir + #0#0 + "/" + "agifa556.dat";
          destino = dir + #0#1 + "/" + "agifa556.dat";
          |COPIA_FICHERO origen,destino;

        ||*******Fichero de Articulos
          origen  = dir + #0#0 + "/" + "agifa019.dat";
          destino = dir + #0#1 + "/" + "agifa019.dat";
          |COPIA_FICHERO origen,destino;

        ||*******Fichero de Clientes
          origen  = dir + #0#0 + "/" + "agifa024.dat";
          destino = dir + #0#1 + "/" + "agifa024.dat";
          |COPIA_FICHERO origen,destino;

        ||*******Fichero de Comisionistas
          origen  = dir + #0#0 + "/" + "agifa025.dat";
          destino = dir + #0#1 + "/" + "agifa025.dat";
          |COPIA_FICHERO origen,destino;

        ||*******Fichero de Art/ALm
          origen  = dir + #0#0 + "/" + "agifa017.dat";
          destino = dir + #0#1 + "/" + "agifa017.dat";
          |COPIA_FICHERO origen,destino;

        ||*******Fichero de Proveedores
          origen  = dir + #0#0 + "/" + "agifa112.dat";
          destino = dir + #0#1 + "/" + "agifa112.dat";
          |COPIA_FICHERO origen,destino;

        |PINTA 2310,"   COPIANDO LOS LISTADOS DEFINIBLES"
        ||*******Copio listados.dir
          origen  = dir + #0#0 + "/" + "listados.dir";
          destino = dir + #0#1 + "/" + "listados.dir";
          |COPIA_FICHERO origen,destino;

        ||*******Copio los lisinfor
          origen  = dir + #0#0 + "/" + "lisinfor.dat";
          destino = dir + #0#1 + "/" + "lisinfor.dat";
          |COPIA_FICHERO origen,destino;

          origen  = dir + #0#0 + "/" + "lisinfor.ddx";
          destino = dir + #0#1 + "/" + "lisinfor.ddx";
          |COPIA_FICHERO origen,destino;

          origen  = dir + #0#0 + "/" + "lisinfor.ixx";
          destino = dir + #0#1 + "/" + "lisinfor.ixx";
          |COPIA_FICHERO origen,destino;

        || ******Copio los lis*


          |PARA i=0; |SI i [ 99999 ; |HACIENDO i=i+1;
               ai       = "00000" + i ;
               atermina = ai % -105;
               |QBF atermina;
               afichero = "lis" + atermina;

          ||Si existe copio los listados

          origen  = dir + #0#0 + "/" + afichero + ".ixx";
          destino = dir + #0#1 + "/" + afichero + ".ixx";
          |COPIA_FICHERO origen,destino;

          origen  = dir + #0#0 + "/" + afichero + ".dat";
          destino = dir + #0#1 + "/" + afichero + ".dat";
          |COPIA_FICHERO origen,destino;

          origen  = dir + #0#0 + "/" + afichero + ".ddx";
          destino = dir + #0#1 + "/" + afichero + ".ddx";
          |COPIA_FICHERO origen,destino;

          origen  = dir + #0#0 + "/" + afichero + ".lis";
          destino = dir + #0#1 + "/" + afichero + ".lis";
          |COPIA_FICHERO origen,destino;

          origen  = dir + #0#0 + "/" + afichero + ".inf";
          destino = dir + #0#1 + "/" + afichero + ".inf";
          |COPIA_FICHERO origen,destino;

          origen  = dir + #0#0 + "/" + afichero + ".prc";
          destino = dir + #0#1 + "/" + afichero + ".prc";
          |COPIA_FICHERO origen,destino;

          |SIGUE;

        ||*******Copio las cabeceras de los sobres
          origen  = dir + #0#0 + "/" + "foto0015.dat";
          destino = dir + #0#1 + "/" + "foto0015.dat";
          |COPIA_FICHERO origen,destino;

        ||*******Copio las lineas de los sobres
          origen  = dir + #0#0 + "/" + "foto0016.dat";
          destino = dir + #0#1 + "/" + "foto0016.dat";
          |COPIA_FICHERO origen,destino;

        ||*******Copio el fichero hist¢rico
          origen  = dir + #0#0 + "/" + "agifa065.dat";
          destino = dir + #0#1 + "/" + "agifa065.dat";
          |COPIA_FICHERO origen,destino;

        ||*******Copio series
          origen  = dir + #0#0 + "/" + "agifa007.dat";
          destino = dir + #0#1 + "/" + "agifa007.dat";
          |COPIA_FICHERO origen,destino;

        ||*******Copio horarios
          origen  = dir + #0#0 + "/" + "agifa510.dat";
          destino = dir + #0#1 + "/" + "agifa510.dat";
          |COPIA_FICHERO origen,destino;

        ||*******Copio cajeros
          origen  = dir + #0#0 + "/" + "agifa514.dat";
          destino = dir + #0#1 + "/" + "agifa514.dat";
          |COPIA_FICHERO origen,destino;

        ||*******Copio condiciones de pago
          origen  = dir + #0#0 + "/" + "agifa091.dat";
          destino = dir + #0#1 + "/" + "agifa091.dat";
          |COPIA_FICHERO origen,destino;


|FPRC;

||***** Este proceso actualiza los fichero maestros

||--------------------------------------||
||   ARTICULOS                          ||
||--------------------------------------||


|PROCESO gra19;

    #19#97  = #19#92;
    #19#98  = #19#93;
    #19#99  = #19#94;
    #19#100 = #19#95;
    #19#101 = #19#96;

    |PARA Campo19=32; |SI Campo19 [ 96; |HACIENDO Campo19 = Campo19 + 1;
         #19Campo19 = 0;
    |SIGUE;

    |GRABA 020#19a;

|FPRC;

|DEFBUCLE agifa019;
#19#1;
;
"                    ";
"zzzzzzzzzzzzzzzzzzzz";
be;
NULL,gra19;
|FIN;

||--------------------------------------||
||   CLIENTES                           ||
||--------------------------------------||

|PROCESO gra24;

    #24#106 = #24#102;
    #24#107 = #24#103;
    #24#108 = #24#104;
    #24#109 = #24#155;
    #24#150 = #24#153;
    #24#151 = #24#154;
    #24#152 = #24#155;

    |PARA Campo24=54; |SI Campo24 [ 105; |HACIENDO Campo24 = Campo24 + 1;
         #24Campo24 = 0;
    |SIGUE;

    |PARA Campo24=114; |SI Campo24 [ 152; |HACIENDO Campo24 = Campo24 + 1;
         #24Campo24 = 0;
    |SIGUE;


    |GRABA 020#24a;

|FPRC;

|DEFBUCLE agifa024;
#24#1;
;
"      ";
"zzzzzz";
be;
NULL,gra24;
|FIN;

||--------------------------------------||
||   PROVEEDORES                        ||
||--------------------------------------||

|PROCESO gra112;

    #112#56= #112#55;

    |PARA Campo112=27; |SI Campo112 [ 55; |HACIENDO Campo112 = Campo112 + 1;
         #112Campo112 = 0;
    |SIGUE;

    |GRABA 020#112a;

|FPRC;



|DEFBUCLE agifa112;
#112#1;
;
"      ";
"zzzzzz";
be;
NULL,gra112;
|FIN;

||--------------------------------------||
||   ART/ALM                            ||
||--------------------------------------||

|PROCESO gra17;

    #17#37 = #17#35;
    #17#38 = #17#36;

    |PARA Campo17=11; |SI Campo17 [ 36; |HACIENDO Campo17 = Campo17 + 1;
         #17Campo17 = 0;
    |SIGUE;

    |GRABA 020#17a;

|FPRC;


|DEFBUCLE agifa017;
#17#1;
;
"                    ",00001;
"zzzzzzzzzzzzzzzzzzzz",99999;
be;
NULL,gra17;
|FIN;

||--------------------------------------||
||   COMISIONISTAS                      ||
||--------------------------------------||

|PROCESO gra25;

    #25#37 = #25#35;
    #25#38 = #25#36;

    |PARA Campo25=11; |SI Campo25 [ 36; |HACIENDO Campo25 = Campo25 + 1;
         #25Campo25 = 0;
    |SIGUE;

    |GRABA 020#25a;

|FPRC;


|DEFBUCLE agifa025;
#25#1;
;
"  ";
"zz";
be;
NULL,gra25;
|FIN;

|PROGRAMA;
  |CLS;
  |CABEZA "Cierre de TPV";

  |PINPA #0#0;
  |ABRE #0;
  |DDEFECTO #0;
  |PINDA #0#0;
  |ENDATOS #1#0;
  |SI FSalida = 0;
   |SI #0#2 = "SI";

     |ATRI P;
     |PINTA 2310,"Copiando los parametros del TPV";
     |HAZ copia;

     |DBASE dbase;
     dbase = dbase + "fich/";
     ddestino = dbase + #0#1 + "/";


     |PINTA 2310,"         ACTUALIZANDO ARTICULOS";
     |PATH_DAT #19 ddestino;
     |BUCLE agifa019; ||Articulos;

     |PINTA 2310,"          ACTUALIZANDO CLIENTES";
     |PATH_DAT #24 ddestino;
     |BUCLE agifa024; ||Clientes;

     |PINTA 2310,"       ACTUALIZANDO PROVEEDORES";
     |PATH_DAT #112 ddestino;
     |BUCLE agifa112; ||Proveedores

     |PINTA 2310,"  ACTUALIZANDO ARTICULO/ALMACEN";
     |PATH_DAT #17 ddestino;
     |BUCLE agifa017; ||Articulos/Almacen

     |PINTA 2310,"     ACTUALIZANDO COMISIONISTAS";
     |PATH_DAT #25 ddestino;
     |BUCLE agifa025; ||Comisionistas

     |HAZ EsCoverin;
     |SI FSalida = 0;
          |PINTA 2310,"           ACTUALIZANDO SOBRES";
          |HAZ BorraFotos;
          |ATRI p;
     |FINSI;
   |FINSI;
  |FINSI;
  |LIBERA #0;
  |CIERRA #0;
|FPRO;
