|FICHEROS;
     mecam009 #0;
     mecam006 #6;
     mecam007 #7;
     mecam008 #8;
     mecam010 #10;
     mecam011 #11;
     mecam012 #12;
     agifa017 #17;
     agifa019 #19;
     agifa073 #73;
     mecam016 #16;
     mecam017 #117;
|FIN;

|VARIABLES;
     aDArt = "                    ";
     aHArt = "zzzzzzzzzzzzzzzzzzzz"
     &eaSerie = "";
     &enOrden = 0;
     nUni = 0;
     aAlfa = "";
     nModo = 0;
     nError = 0;
|FIN;

|PROCESO Min;
     #10#0 = #0#0;
     #10#1 = #0#1;
     #10#2 = "     ";
     #10#3 = 1;
     #10#4 = 1;
|FPRC;

|PROCESO Max;
     #10#0 = #0#0;
     #10#1 = #0#1;
     #10#2 = "zzzzz";
     #10#3 = 999999;
     #10#4 = 999;
|FPRC;

|PROCESO Tipo13; |TIPO 13;
     |ENTLINEAL #1#10, 3, 7, 22, 0, Min, Max;
|FPRC;

|PROCESO Tipo12; |TIPO 12;
     |ENTLINEAL #1#10, 3, 4, 22, 0, Min, Max;
|FPRC;
--------------------------------------------------------------
|PROCESO BorraPaquete;
     #7#0 = #8#0;
     #7#1 = #8#1;
     #7#2 = #8#2;
     |LEE 101#7=;
     |SI FSalida = 0;
          #7#5 = "";
          #7#6 = 0;
          |GRABA 020#7a;
          |LIBERA #7;
     |FINSI;
|FPRC;

|DEFBUCLE BorraPaquete;
     #8#2;
     ;
     #10#2, #10#3, #10#4;
     #10#2, #10#3, #10#4;
     ;
     NULL, BorraPaquete;
|FIN;

|PROCESO BorraLineas;
     |HAZ StockFab;
     |BUCLE BorraPaquete;
     |BORRA 020#10a;

     #6#0 = #10#2;
     #6#1 = #10#3;
     #6#2 = #10#4;
     |LEE 101#6=;
     |SI FSalida = 0;
          #6#14 = "";
          #6#8 = 0;
          #6#9 = 0;
          |GRABA 020#6a;
          |LIBERA #6;
     |FINSI;
|FPRC;

|DEFBUCLE BorraLineas;
     #10#1;
     ;
     #0#0, #0#1, "     ", 000001, 001;
     #0#0, #0#1, "zzzzz", 999999, 999;
     be;
     NULL, BorraLineas;
|FIN;

|PROCESO BorraNece;
     |BORRA 020#11a;
|FPRC;

|DEFBUCLE BorraNece;
     #11#1;
     ;
     #0#0, #0#1, aDArt, aDArt, " ";
     #0#0, #0#1, aHArt, aHArt, "z";
     be;
     NULL, BorraNece;
|FIN;

|PROCESO BorraNeceLote;
     |BORRA 020#12a;
|FPRC;

|DEFBUCLE BorraNeceLote;
     #12#1;
     ;
     #0#0, #0#1, aDArt, aDArt, "               ", " ";
     #0#0, #0#1, aHArt, aHArt, "zzzzzzzzzzzzzzz", "z";
     be;
     NULL, BorraNeceLote;
|FIN;

|PROCESO StockFab;
     |DDEFECTO #73;
     #73#28 = #10#2;
     #73#0 = #10#3;
     #73#1 = #10#4;
     |LEE 000#73=;

     |SI #73#44 = 0;
          nUni = #73#5;
     |SINO;
          nUni = #73#44;
     |FINSI;

     #19#0 = #73#2;
     |LEE 101#19=;
     |SI FSalida = 0;
          #19#13 = #19#13 - nUni;

          #17#0 = #73#2;
          #17#1 = #73#3;
          |LEE 101#17=;
          |SI FSalida = 0;
               #17#9 = #17#9 - nUni;
               |HAZ ValoraStock;
               |GRABA 020#17a;
               |LIBERA #17;
          |SINO;
               |HAZ ValoraStock;
          |FINSI;
          |GRABA 020#19a;
          |LIBERA #19;
     |FINSI;
|FPRC;

|PROCESO MiraConsu;
     |SI #11#9 = "S";
          nError = 1;
          |ERROR10;
     |FINSI;
|FPRC;

|DEFBUCLE MiraConsu;
     #11#1;
     ;
     #0#0, #0#1, aDArt, aHArt, " ";
     #0#0, #0#1, aDArt, aHArt, "z";
     ;
     NULL, MiraConsu;
|FIN;

|PROCESO MiraEntra;
     #6#0 = #10#2;
     #6#1 = #10#3;
     #6#2 = #10#4;
     |LEE 000#6=;
     |SI FSalida = 0; |Y #6#10 = "S";
          nError = 1;
          |ERROR10;
     |FINSI;
|FPRC;

|DEFBUCLE MiraEntra;
     #10#1;
     ;
     #0#0, #0#1, "      ", 000000, 001;
     #0#0, #0#1, "zzzzzz", 999999, 999;
     ;
     NULL, MiraEntra;
|FIN;

|PROCESO CheqLote;
     aAlfa = #12#6; |QBF aAlfa;
     |SI aAlfa ! "";
          nError = 1;
          |ERROR10;
     |FINSI;
|FPRC;

|DEFBUCLE CheqLote;
     #12#1;
     ;
     #0#0, #0#1, aDArt, aDArt, "               ", " ";
     #0#0, #0#1, aHArt, aHArt, "zzzzzzzzzzzzzzz", "z";
     be;
     NULL, CheqLote;
|FIN;

|PROCESO BorraExcesoLin;
     |BORRA 020#117a;
|FPRC;

|PROCESO BorraExceso
     |BORRA 020#16a;
|FPRC;

|DEFBUCLE BorraExceso;
     #16#1;
     ;
     #0#0, #0#1;
     #0#0, #0#1;
     be;
     NULL, BorraExceso, BorraExcesoLin;
|FIN;

|PROCESO Tipo2; |TIPO 2;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 3;
          nError = 0;
          |ABRE #6;
          |BUCLE MiraEntra;
          |CIERRA #6;
          |SI nError ! 0;
               |MENAV "0000Hay productos terminados ya introducidos...";
               |ERROR; |ACABA;
          |FINSI;
          |BUCLE MiraConsu;
          |SI nError ! 0;
               |MENAV "0000Hay productos consumidos ya introducidos...";
               |ERROR; |ACABA;
          |FINSI;
          |BUCLE CheqLote;
          |SI nError ! 0;
               |MENAV "0000Hay partidas asignadas...";
               |ERROR; |ACABA;
          |FINSI;
          |ABRE #6;
          |ABRE #7;
          |ABRE #19;
          |ABRE #17;
          |ABRE #73;
          |BUCLE BorraLineas;
          |CIERRA #73;
          |CIERRA #17;
          |CIERRA #19;
          |CIERRA #6;
          |CIERRA #7;

          |BUCLE BorraNece;
          |BUCLE BorraNeceLote;
          |BUCLE BorraExceso;
     |FINSI;
|FPRC;
