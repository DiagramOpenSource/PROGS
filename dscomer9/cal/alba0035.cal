|FICHEROS;
     alba0035 #0;   || Lineas revision.
     alba0034 #1;   || Cabecera revision.
     agifa024 #3;   || Clientes.
     agifa019 #4;   || Articulos.
     dsm00134 #50;  || Promociones.
|FIN;

|VARIABLES;
     &enTiva = 0;
     &efFiva = @;
     &eaDiva = "";
     &enIva = 0;
     &enRec = 0;
     nModo = 0;
     &EURODB = 0;
     liquid = 0;
     base  = 0;
     base2 = 0;
     impue = 0;
     modo = 0;
     unip = 0;
     restop = 0;
     preciop = 0;
|FIN;

|PROCESO calculo; |TIPO 0;
     |ABRE #4;
     #4#0 = #0#4;
     |LEE 000#4=;
     |LIBERA #4;
     |CIERRA #4;
     #0#15 = #0#6 * #4#179;
     base = #0#12 * #0#7;         || importe
     base = base < #0#8;          || dto
     |HAZ lee;
     impue = enIva;
     |SI #3#47 = "S"; impue = impue + enRec; |FINSI; || recargo e.
     #0#10 = base;
     base = base < #3#37;
     base = base < #3#38;
     base = base ! EURODB;
     base = base + #0#15;
     liquid = base > impue; || iva, re.
     |PINTA #0#10;
|FPRC;

|PROCESO totalb; |TIPO 2;
     |HAZ calculo;
     #1#8 = #1#8 +. #0#10;
     |PINTA #1#8;
     #1#9 = #1#9 +. liquid;
     ||#1#9 = #1#9 +. #0#15;
     |PINTA #1#9;
|FPRC;

|PROCESO lee;
     enTiva = #0#9;
     efFiva = #1#3;
     |HAZ SacaIVA;

     |ABRE #3;
     #3#0 = #1#4;
     |LEE 141#3=;
     |SI FSalida ! 0;
       |GRABA 121#3c;
     |FINSI;
     |LIBERA #3;
     |CIERRA #3;
|FPRC;

|CALCULO promoc;
modo = (FEntrada / 100) ! 0;
|SI modo = 1;
  |ABRE #50;
  #50#0 = #1#4;
  #50#1 = #0#4;
  |LEE 000#50=;
  |SI FSalida = 0;
    |SI #1#3 ] #50#6;|Y #1#3 [ #50#7;
      unip = #0#12 / #50#2;
      restop = #0#12 $ #50#2;
      restop = restop / #50#2;
      unip = unip - restop;
      #0#13 = unip * #50#3;
      |PINTA #0#13;
      #0#14 = #50#4;
      |SI #50#5 ! 0;
        #0#14 = #0#7 % #50#5;
      |FINSI;
      #0#7 = #0#7 - #0#14;
      |PINTA #0#7;
    |FINSI;
  |FINSI;
  #0#6 = #0#12 + #0#13;
  |PINTA #0#6;
  |LIBERA #50;
  |CIERRA #50;
|FINSI;
|FCAL;

|CALCULO promoc1;
#0#6 = #0#12 + #0#13;
|PINTA #0#6;
|FCAL;

|PROCESO CodArti; |TIPO 0;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 1; |O Contenido ! #0Campo;
          |ABRE #4;
          #4#0 = #0#4;
          |LEE 020#4=;
          |CIERRA #4;
          #0#15 = #4#208;
     |FINSI;
|FPRC;
