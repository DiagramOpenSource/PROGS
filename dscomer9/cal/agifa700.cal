|FICHEROS;
   agifa700 #0;
   agifa701 #1,MANTE;
   agifa702 #2,MANTE;
   agifa703 #3,MANTE;

   referen@ #4;
   refere1@ #5;
|FIN;

|VARIABLES;
   Comodin  = ""; Comodin1 = ""; ClaveAnt = "";
   ModoEntrada = 0; Modo = 0; Sw = 0;

   Cont = 0;

   NumCampos = 0;
   DefCargado = "";
   Linea = 0;

   Flag = 0;

   aAlfa = "";
|FIN;

|RUTINA inf2;
   #agifa702#0 = 0;
|FRUT;

|RUTINA sup2;
   #agifa702#0 = 999;
|FRUT;

|PROCESO EntraConcep; |TIPO 7;
   |SI FSalida = 10;
      |PUSHV 1905 2237;
      |BLANCO 1905 2237;
      |CUADRO 1905 2237;
      E_sup = 29;
      E_inf = "";
      |SI Comodin = ""; Comodin = " "; |FINSI;
      Comodin = 2007 ? 1; |QBF Comodin; Comodin = Comodin < "";
      ClaveAnt = #agifa700#0;
      Sw = 0;
      |LEE 000#agifa700.s;
      |PARA; |SI FSalida = 0; |HACIENDO;
         Comodin1 = #agifa700#0; |QBF Comodin1; Comodin1 = Comodin1 < "";
         Comodin1 = Comodin1 - Comodin;
         |SI FSalida ! 0; Sw = 1; |SAL; |FINSI;
         Comodin1 = #agifa700#1; |QBF Comodin1; Comodin1 = Comodin1 < "";
         Comodin1 = Comodin1 - Comodin;
         |SI FSalida ! 0; Sw = 1; |SAL; |FINSI;
         |LEE 000#agifa700.s;
      |SIGUE;
      |SI Sw = 0; #agifa700#0 = ClaveAnt; |LEE 000#agifa700.=; |FINSI;
      |PTEC 808; |PTEC 809;
      |POPV;
   |FINSI;

   |SI FSalida = 11;
      |ENTLINEAL #1#agifa702,-1,Modo,20,1,inf2,sup2;
      |ENTLINEAL #1#agifa702,-1,7,20,1,inf2,sup2;
      |ACABA;
   |FINSI;
|FPRC;

|PROCESO CogeCampo; |TIPO 7;

   |SI FSalida = 10;
      |PUSHV 1141 1379;
      |BLANCO 1141 1379;
      |CUADRO 1146 1367;
      E_sup = 20;
      E_inf = "";
      |SI Comodin = ""; Comodin = " "; |FINSI;
      Comodin = 1247 ? 1; |QBF Comodin; Comodin = Comodin < "";
      ClaveAnt = #agifa701#1;
      Sw = 0;
      |LEE 000#agifa701.s;
      |PARA; |SI FSalida = 0; |HACIENDO;
         Comodin1 = #agifa701#2; |QBF Comodin1; Comodin1 = Comodin1 < "";
         Comodin1 = Comodin1 - Comodin;
         |SI FSalida ! 0; Sw = 1; |SAL; |FINSI;
         |LEE 000#agifa701.s;
      |SIGUE;
      |SI Sw = 0; #agifa701#1 = ClaveAnt; |LEE 000#agifa701.=; |FINSI;
      |PTEC 808; |PTEC 809;
      |POPV;
   |FINSI;

   |SI FSalida = 11;
      |LEE 010#agifa702.u;
      |SI FSalida ! 0;
         Linea = 1;
      |SINO;
         Linea = #agifa702#0 + 1;
      |FINSI;
      |PUSHV 0817 1765;
      |PINPA #0#agifa703;
      |PINDA #0#agifa703;
      |ENDATOS #1#agifa703;
      |SI FSalida ! 0; |POPV; |ACABA; |FINSI;
      |DDEFECTO #agifa702;
      #agifa702#0 = Linea;    Linea = Linea + 1;
      #agifa702#1 = #agifa701#0;
      #agifa702#2 = #agifa701#1;
      #agifa702#3 = #agifa701#2;
      |SI #agifa703#0 = "X"; #agifa702#4 = "FV"; |FINSI;
      |SI #agifa703#1 = "X"; #agifa702#4 = "FC"; |FINSI;
      |SI #agifa703#2 = "X"; #agifa702#4 = "FD"; |FINSI;
      |SI #agifa703#3 = "X"; #agifa702#4 = "TI"; |FINSI;
      |SI #agifa703#4 = "X"; #agifa702#4 = "CC"; |FINSI;
      |SI #agifa703#9 = "X"; #agifa702#4 = "CR"; |FINSI;
      |SI #agifa703#5 = "X"; #agifa702#5 = "I"; |FINSI;
      |SI #agifa703#6 = "X"; #agifa702#5 = "D"; |FINSI;
      |SI #agifa703#7 = "X"; #agifa702#5 = "C"; |FINSI;
      |SI #agifa703#8 = "X"; #agifa702#5 = "A"; |FINSI;
      |GRABA 020#agifa702.n;
      |POPV;
      |ENTLINEAL #1#agifa702,-1,7,20,1,inf2,sup2;
   |FINSI;
|FPRC;

|RUTINA inf1;
   #agifa701#0 = "        ";
   #agifa701#1 = 0;
|FRUT;

|RUTINA sup1;
   #agifa701#0 = "zzzzzzzz";
   #agifa701#1 = 255;
|FRUT;

|PROCESO CargaDef;
   |DBASE Comodin; |QBF Comodin;
   Comodin = Comodin + "def/" + #agifa700#0; |QBF Comodin;
   Comodin = Comodin + ".mas";
   |CARGA_DEF Comodin, referen@;
   |SI FSalida ! 0;
     |MENAV "    Fichero inexistente";
     |ERROR; |ACABA;
   |FINSI;
|FPRC;

|PROCESO DescargaDef;
   |DESCARGA_DEF #referen@;
|FPRC;

|PROCESO Datos; |TIPO 7;

   Comodin = "|NC";
   NumCampos = #referen@#Comodin# - 1;

   Comodin = "|TITULO";
   #agifa700#1 = #referen@#Comodin#;
   |PINTA #agifa700#1; Comodin = "";

   |ABRET #agifa702;
   |SI DefCargado ! #agifa700#0;
      DefCargado = #agifa700#0;
      aAlfa = "gl" + Usuario; |NOME_DAT #agifa701#aAlfa#;
      |DELINDEX #agifa701; |ABRET #agifa701;

      |PARA Cont = 0; |SI Cont [ NumCampos; |HACIENDO Cont = Cont + 1;
         Comodin = ("000" + Cont) % -103;
         Comodin = "|C" + Comodin;
         Comodin1 = Comodin + "NOMBRE";
         |DDEFECTO #agifa701;
         #agifa701#0 = #agifa700#0;
         #agifa701#1 = Cont;
         #agifa701#2 = #referen@#Comodin1#;
         Comodin1 = Comodin + "TIPO"; |QBF Comodin1;
         Comodin1 = #referen@#Comodin1#;
         |SI Comodin1 = "F"; #agifa701#3 = "Fecha"; |FINSI;
         |SI Comodin1 = "A"; #agifa701#3 = "Alfa "; |FINSI;
         |SI Comodin1 = "N"; #agifa701#3 = "Num  "; |FINSI;
         Comodin1 = Comodin + "LONGITUD";
         Comodin1 = #referen@#Comodin1#; |QBF Comodin1;
         Comodin1 = ("000" + Comodin1) % -103;
         #agifa701#4 = Comodin1;
         |GRABA 020#agifa701.n;
      |SIGUE;
      |CIERRAT #agifa701;
   |FINSI;

   Comodin = "";
   |ENTLINEAL #1#agifa701,-1,4,12,1,inf1,sup1;

   |CIERRAT #agifa702;
|FPRC;

|RUTINA inf;
   #agifa700#0 = "                    ";
|FRUT;

|RUTINA sup;
   #agifa700#0 = "zzzzzzzzzzzzzzzzzzzz";
|FRUT;

|PROCESO BajaConc;
   |BORRA 020#agifa702.a;
|FPRC;

|DEFBUCLE BajaConc;
#agifa702#1;
1;
001,#agifa700#0;
999,#agifa700#0;
;
NULL,BajaConc;
|FIN;

|PROCESO Baja; |TIPO 1;
   ModoEntrada = (FEntrada / 100) ! 0
   |SI ModoEntrada ! 3; |ACABA; |FINSI;

   |ABRET #agifa702;
   |SELECT #2#agifa702;
   #agifa702#0 = 0;
   #agifa702#1 = #agifa700#0;
   |LEE 010#agifa702.];
   |SI FSalida = 0; |Y #agifa702#1 = #agifa700#0;
      |CONFI "    NSe daran de baja todos los conceptos definidos de ese fichero.¿Continuar?";
      |SI FSalida = 0;
         |CIERRAT #agifa702; |BUCLE BajaConc; |ABRET #agifa702;
         |ENTLINEAL #1#agifa702,-1,7,20,1,inf2,sup2;
      |FINSI;
   |FINSI;
   |SELECT #1#agifa702;
   |CIERRAT #agifa702;
|FPRC;

|PROCESO ModificaLinea;
   ModoEntrada = (FEntrada / 100) ! 0; |SI ModoEntrada ! 2; |ACABA; |FINSI;

   |DBASE Comodin1; |QBF Comodin1;
   Comodin1 = Comodin1 + "def/" + #agifa702#1; |QBF Comodin1;
   Comodin1 = Comodin1 + ".mas";
   |CARGA_DEF Comodin1, refere1@;
   |SI FSalida = 0;
      Comodin = ("000" + #agifa702#2) % -103;
      Comodin = "|C" + Comodin;
      Comodin = Comodin + "NOMBRE";
      #agifa702#3 = #refere1@#Comodin#;
      |GRABA 020#agifa702.a;
      |DESCARGA_DEF #refere1@;
      Comodin = "";
   |FINSI;

   |PUSHV 0817 1765;

   |PARA Cont = 0; |SI Cont [ 9; |HACIENDO Cont = Cont + 1;
      #agifa703#Cont# = " ";
   |SIGUE;

   |SI #agifa702#4 = "FV"; #agifa703#0 = "X"; |FINSI;
   |SI #agifa702#4 = "FC"; #agifa703#1 = "X"; |FINSI;
   |SI #agifa702#4 = "FD"; #agifa703#2 = "X"; |FINSI;
   |SI #agifa702#4 = "TI"; #agifa703#3 = "X"; |FINSI;
   |SI #agifa702#4 = "CC"; #agifa703#4 = "X"; |FINSI;
   |SI #agifa702#4 = "CR"; #agifa703#9 = "X"; |FINSI;
   |SI #agifa702#5 = "I";  #agifa703#5 = "X"; |FINSI;
   |SI #agifa702#5 = "D";  #agifa703#6 = "X"; |FINSI;
   |SI #agifa702#5 = "C";  #agifa703#7 = "X"; |FINSI;
   |SI #agifa702#5 = "A";  #agifa703#8 = "X"; |FINSI;

   |PINPA #0#agifa703;
   |PINDA #0#agifa703;
   |ENDATOS #1#agifa703;
   |SI FSalida ! 0; |POPV; |ACABA; |FINSI;

   |SI #agifa703#0 = "X"; #agifa702#4 = "FV"; |FINSI;
   |SI #agifa703#1 = "X"; #agifa702#4 = "FC"; |FINSI;
   |SI #agifa703#2 = "X"; #agifa702#4 = "FD"; |FINSI;
   |SI #agifa703#3 = "X"; #agifa702#4 = "TI"; |FINSI;
   |SI #agifa703#4 = "X"; #agifa702#4 = "CC"; |FINSI;
   |SI #agifa703#9 = "X"; #agifa702#4 = "CR"; |FINSI;
   |SI #agifa703#5 = "X"; #agifa702#5 = "I"; |FINSI;
   |SI #agifa703#6 = "X"; #agifa702#5 = "D"; |FINSI;
   |SI #agifa703#7 = "X"; #agifa702#5 = "C"; |FINSI;
   |SI #agifa703#8 = "X"; #agifa702#5 = "A"; |FINSI;
   |GRABA 020#agifa702.a;
   |POPV;
|FPRC;

|PROCESO MiraEnGrid; |TIPO 11;
   |SI FSalida = 10;
      |CONSULTA_CLAVE #1#agifa702;
   |FINSI;
|FPRC;

|PROCESO Rellena700;
     |ABRE #agifa700;
     |DBASE Comodin1;  |QBF Comodin1;  Comodin1 = Comodin1 + "def/*.mas";
     |_PDIR Comodin1;
     |PARA; |SI FSalida = 0; |HACIENDO;
        |CARGA_DEF Comodin1, referen@;
        |SI FSalida = 0;
           |DDEFECTO #agifa700;
           Comodin = Comodin1 % -112; Comodin = Comodin % 0108;
           #agifa700#0 = Comodin;
           Comodin ="|TITULO";
           #agifa700#1 = #referen@#Comodin#;
           |GRABA 020#agifa700.n;
           |DESCARGA_DEF #referen@;
           Comodin = "";
        |FINSI;
        |_SDIR Comodin1;
     |SIGUE;
     |CIERRA #agifa700;
|FPRC;

|PROGRAMA;
     |CLS;
     |CABEZA "Definicion conceptos enlace";

     |PINPA #0#0;
     |PINPA #0#1;
     |PINPA #0#2;
     |PINDA #0#0;

     E_sup = 10;
     E_inf = "";
     Comodin = " ";
     |MENSA "2405 Entre clave :           ";
     Comodin = 2420 ? -1;
     |SI FSalida ! 7; |Y FSalida ! 1;
          |MENSA "2405                         ";

          |SI Comodin = "ENLACES   "; Modo = 2; |SINO; Modo = 4; |FINSI;

          aAlfa = "gc" + Usuario; |NOME_DAT #agifa700#aAlfa#;
          aAlfa = "gl" + Usuario; |NOME_DAT #agifa701#aAlfa#;
          |DELINDEX #agifa700; |DELINDEX #agifa701;
          |HAZ Rellena700;

          |ENTLINEAL #1#agifa701,-1,7,12,1,inf1,sup1;
          |ENTLINEAL #1#agifa702,-1,7,20,1,inf2,sup2;
          |ENTLINEAL #1#agifa700,-1,Modo,20,1,inf,sup;
     |FINSI;
|FPRO;
