|FICHEROS;
     alby0003 #0;
     agifa104 #104;
     agifa073 #73;
     albm0004 #4;
     agifa024 #24;
     agifa060 #60;
     agifa019 #19;
     albw0022 #22; ||Tmp
     albm0059 #59; ||Compara
     agifa142 #142;
     referen@ #100;
|FIN;

|VARIABLES;
     nConta = 0;
     aAlfa = "";
     nUni = 0;
     nHay = 0;
     &enPed = 0;
     aCli = "";
     aFam = "";
     fHoy = @;
     i = 0;
     &Tempo = "";
     aTempo1 = "";
     aTempo2 = "";
     aDef = "";
     &eaTexto = "";
     nCompara = 0;
     nNume = 0;
     nImprime = 0;
|FIN;

|PROCESO BorraHoy;
     |BORRA 020#59a;
|FPRC;

|DEFBUCLE BorraHoy;
     #59#1;
     ;
     fHoy, 0;
     fHoy, 999999999;
     be;
     NULL, BorraHoy;
|FIN;

|PROCESO Print;
     nHay = 1;

     |SI nImprime = 1; |PRINT; |FINSI;

     |SI nCompara = 0;
          |PARA i = 0; |SI i [ 17; |HACIENDO i = i + 1;
               #59i = #22i;
          |SIGUE;
          #59#18 = fHoy;
          |GRABA 020#59n;
     |FINSI;
|FPRC;

|DEFBUCLE Clave2;
     #22#2;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Print;
|FIN;

|DEFBUCLE Clave3;
     #22#3;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Print;
|FIN;

|DEFBUCLE Clave4;
     #22#4;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Print;
|FIN;

|DEFBUCLE Clave5;
     #22#5;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Print;
|FIN;

|DEFBUCLE Clave6;
     #22#6;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Print;
|FIN;

|DEFBUCLE Clave7;
     #22#7;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Print;
|FIN;

|DEFBUCLE Clave8;
     #22#8;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Print;
|FIN;

|PROCESO Lee;
     |DDEFECTO #24;
     #24#0 = aCli;
     |LEE 000#24=;

     |DDEFECTO #60;
     #60#0 = aFam;
     |LEE 000#60=;
|FPRC;

|PROCESO albm0004;
     |DDEFECTO #19;
     #19#0 = #4#3;
     |LEE 000#19=;

     aFam = #19#2;
     aCli = #4#2;
     |HAZ Lee;

     nConta = nConta + 1;
     |DDEFECTO #22;
     #22#0 = nConta;
     #22#1 = 2;   ||Prepe
     #22#4 = #24#0;
     #22#5 = #24#1;
     #22#6 = #4#3;
     #22#7 = #4#5;
     #22#8 = #60#0;
     #22#9 = #60#1;
     #22#10 = #4#0;
     #22#11 = #4#13;
     #22#12 = #4#6;
     #22#16 = #4#8
     |GRABA 020#22n;
|FPRC;

|DEFBUCLE albm0004;
     #4#1;
     ;
     #0#4, "        ";
     #0#5, "zzzzzzzz";
     ;
     NULL, albm0004;
|FIN;

|PROCESO agifa073;
     aCli = #104#4;
     aFam = #73#18;
     |HAZ Lee;
     |SI #73#42 > 0;
          nUni = (#73#42 - #73#43 + #73#12) ! #142#8;
          |SI nUni ! 0;
               nConta = nConta + 1;
               |DDEFECTO #22;
               #22#0 = nConta;
               #22#1 = 1;          ||Pedido
               #22#2 = #73#28;
               #22#3 = #73#0;
               #22#4 = #24#0;
               #22#5 = #24#1;
               #22#6 = #73#2;
               #22#7 = #73#4;
               #22#8 = #60#0;
               #22#9 = #60#1;
               #22#10 = #104#1;
               #22#11 = #73#13;
               #22#12 = #73#42;
               #22#13 = #73#43;
               #22#14 = (#73#42 - #73#43 + #73#12) ! #142#8;
               #22#15 = #104#7;
               #22#16 = #73#6;
               #22#17 = #104#51;
               |GRABA 020#22n;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE agifa104;
     #104#1;
     1;
     #0#0, #0#2, #0#4;
     #0#1, #0#3, #0#5;
     ;
     NULL, NULL, agifa073;
|FIN;

|PROCESO ImpCompara;
     |SI nHay = 0;
          |SI #0#6 ! 0;
               |MENAV "0000Seleccion vacia..";;
          |FINSI;
     |SINO;
           nImprime = 1;
          |SI #0#6 = 1; |BUCLE Clave2; |FINSI;
          |SI #0#6 = 2; |BUCLE Clave3; |FINSI;
          |SI #0#6 = 3; |BUCLE Clave4; |FINSI;
          |SI #0#6 = 4; |BUCLE Clave5; |FINSI;
          |SI #0#6 = 5; |BUCLE Clave6; |FINSI;
          |SI #0#6 = 6; |BUCLE Clave7; |FINSI;
          |SI #0#6 = 7; |BUCLE Clave8; |FINSI;
          |PIEINF;
          |DELINDEX #22;
     |FINSI;
|FPRC;

|PROCESO Graba22;
     nHay = 1;
     |SI nCompara = 4;
          |PARA i = 0; |SI i [ 17; |HACIENDO i = i + 1;
               #22i = #100i;
          |SIGUE;
     |SINO;
          |PARA i = 0; |SI i [ 17; |HACIENDO i = i + 1;
               #22i = #59i;
          |SIGUE;
     |FINSI;
     |GRABA 020#22n;
|FPRC;

|PROCESO BCompara;
     |SI nCompara = 2;
          |SELECT #2#59;
          #59#18 = #0#7;  ||Fecha
          #59#2 = #100#2; ||Ser
          #59#3 = #100#3; ||Num
          #59#4 = #100#4; ||Cli
          #59#6 = #100#6; ||Art
          #59#10 = #100#10; ||F.Pedi
          |LEE 000#59=;
          |SI FSalida = 0;
               |HAZ Graba22;
          |FINSI;
     |FINSI;
     |SI nCompara = 3; |Y #100#3 ! 0;
          |SELECT #3#59;
          #59#18 = #0#7;  ||Fecha
          #59#4 = #100#4; ||Cli
          #59#6 = #100#6; ||Art
          #59#10 = #100#10; ||F.Pedi
          |LEE 000#59=;
          |SI FSalida = 0;
               |HAZ Graba22;
          |FINSI;
     |FINSI;
     |SI nCompara = 4;|Y #100#1 = 2;      ||Nuevos
          |SELECT #2#59;
          #59#18 = #0#7;  ||Fecha
          #59#2 = #100#2; ||Ser
          #59#3 = #100#3; ||Num
          #59#4 = #100#4; ||Cli
          #59#6 = #100#6; ||Art
          #59#10 = #100#10; ||F.Pedi
          |LEE 000#59=;
          |SI FSalida ! 0;
               |HAZ Graba22;
          |FINSI;
     |FINSI;
     |SI nCompara = 5; |Y #59#0 = 1;  ||Entregados
          |SELECT #9#100;
          #100#1 = #59#1; ||Ped/Pre
          #100#2 = #59#2; ||Ser
          #100#3 = #59#3; ||Num
          |LEE 000#100=;
          |SI FSalida ! 0;
               |HAZ Graba22;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE BCompara;
     #100#1001;
     ;
     0;
     999999999;
     ;
     NULL, BCompara;
|FIN;

|DEFBUCLE BCompara2;
     #59#1;
     ;
     #0#7, 0;
     #0#7, 999999999;
     ;
     NULL, BCompara;
|FIN;

|PROCESO Compara;
     |DDEF aDef; aDef = aDef + "albw0022";
     |CARGA_DEF aDef, referen@;
     |SI FSalida ! 0; |ACABA; |FINSI;
     |NOME_DAT #100 aTempo1;

     |HAZ CreaTempo; aTempo2 = Tempo;
     |NOME_DAT #22 aTempo2;
     |DELINDEX #22;

     nCompara = #0#8;
     |SI #0#8 = 2; |O #0#8 = 6;
          nHay = 0;
          eaTexto = "LOS QUE ESTABAN EN EL LISTADO DE AYER Y ESTAN EN EL DE HOY";
          |ABRE #59;
          |ABRE #22;
          |BUCLE BCompara;
          |CIERRA #22;
          |CIERRA #59;
          |HAZ ImpCompara;
     |FINSI;
     |SI #0#8 = 3;|O #0#8 = 6;
          nHay = 0;
          eaTexto = "LOS QUE ESTABAN COMO PREPEDIDOS Y AHORA ESTAN COMO PEDIDOS";
          |ABRE #59;
          |ABRE #22;
          |BUCLE BCompara;
          |CIERRA #22;
          |CIERRA #59;
          |HAZ ImpCompara;
     |FINSI;
     |SI #0#8 = 4;|O #0#8 = 6;
          nHay = 0;
          eaTexto = "NUEVOS";
          |ABRE #59;
          |ABRE #22;
          |BUCLE BCompara;
          |CIERRA #22;
          |CIERRA #59;
          |HAZ ImpCompara;
     |FINSI;
     |SI #0#8 = 5;|O #0#8 = 6;
          nHay = 0;
          eaTexto = "ENTREGADOS";
          |ABRE #100;
          |ABRE #22;
          |BUCLE BCompara2;
          |CIERRA #100;
          |CIERRA #59;
          |HAZ ImpCompara;
     |FINSI;

     |DELINDEX #100;
     Tempo = aTempo2; |HAZ BoraTempo;
     |DESCARGA_DEF #referen@;
|FPRC;

|PROCESO DiaAnt; |TIPO 7;
     fHoy = ~;
     #0#7 = "01.01.0000";
     |ABRE #59;
     |LEE 000#59u;
     |SI FSalida = 0;
          |SI #59#18 = fHoy;
               |PARA; |SI #59#18 = fHoy; |Y FSalida = 0; |HACIENDO;
                    |LEE 000#59a;
               |SIGUE;
          |FINSI;
          |SI FSalida = 0; |Y #59#18 ! fHoy;
               #0#7 = #59#18;
          |FINSI;
     |FINSI;
     |CIERRA #59;
     |PINTA #0#7;
|FPRC;

|PROCESO Tipo3; |TIPO 3;
     || #0#8 = 6 esta anulado en el def, cuando es 6 salen todos los listados

     |ABRE #142; |LEE 000#142p; |CIERRA #142;
     |IMPRE 0;
     |SI FSalida = 0;
          |INFOR "alby0003";
          |SI FSalida ! 0;
               |MENAV "0000No existe informe 'alby0003'...";
          |SINO;

               |MENSA "0000Creando temporal...";
               |BUCLE BorraHoy;

               |HAZ CreaTempo; aTempo1 = Tempo;
               |NOME_DAT #22 aTempo1;
               |DELINDEX #22;

               |ABRE #24;
               |ABRE #60;
               |ABRE #22;
               |ABRE #19;
               |BUCLE agifa104;
               |BUCLE albm0004;
               |CIERRA #19;
               |CIERRA #22;
               |CIERRA #60;
               |CIERRA #24;

               |MENSA "0000Imprimiendo...";
               |SI #0#8 = 1; |O #0#8 = 6;
                    nImprime = 1;
               |FINSI;
               eaTexto = "";
               |ABRE #59;
               |SI #0#6 = 1; |BUCLE Clave2; |FINSI;
               |SI #0#6 = 2; |BUCLE Clave3; |FINSI;
               |SI #0#6 = 3; |BUCLE Clave4; |FINSI;
               |SI #0#6 = 4; |BUCLE Clave5; |FINSI;
               |SI #0#6 = 5; |BUCLE Clave6; |FINSI;
               |SI #0#6 = 6; |BUCLE Clave7; |FINSI;
               |SI #0#6 = 7; |BUCLE Clave8; |FINSI;
               |CIERRA #59;
               |SI nHay ! 0;
                    |SI nImprime = 1; |PIEINF; |FINSI;
                    |SI #0#7 ! "01.01.0000";
                         |HAZ Compara;
                    |FINSI;
               |SINO;
                    |MENAV "0000Seleccion Vacia...";
               |FINSI;
               |FININF;
               |DELINDEX #22;
               Tempo = aTempo1; |HAZ BoraTempo;
          |FINSI;
          |FINIMP;
     |FINSI;
|FPRC;
