|FICHEROS;
     conp0625 #0;
     conp0626 #1,MANTE;
     con00627 #2;
     con00628 #3,MANTE;|| Tmp Servicios Exteriores
     con00629 #4,MANTE;|| Tmp Mano de Obra
     con00630 #5,MANTE;|| Tmp Piezas
     con00631 #6,MANTE;|| Tmp Lubricante
     con00632 #7; || Tmp totales
     con00605 #10; || articulos por mano de obra;
     agifa019 #11; || articulos
     agifa017 #9;  || almacen
     agifa065 #12; || Historico
     con00637 #20 ; || facturas
     con00638 #21,MANTE; || tmp facturas
     agifa024 #30; || clientes
     agifa091 #40; || formas de pago
     agifa059 #55;
     agifa134 #56;
     con00659 #65; || lineas or vn
     con00674 #80; || Lineas or vo
     conp1625 #85; || texto inicial o.r.
     con00603 #63; || Maestro M.Obra
     con00606 #66; || Maestro Ser. Exteriores
     conp0634 #14; || Explicacion reparacion
     con00642 #67; || Lineas Fra. O.R.
     con00682 #82; || Trabajos operarios
     con00683 #83; ||control aplicacion
     con00684 #92;
     conp0634 #8; ||texto explicativo
     con00680 #90; ||Operarios
     con00690 #91; ||Series / Formatos OR
     contmp02 #15;
     con00760 #16; ||clave modificacion
     con00601 #601;
     con00007;
     agifa007 #70;
|FIN;

|INCLUYE i_varart;

|VARIABLES;
     &iva1 = 0;
     &iva2 = 0;
     &iva3 = 0;
     &iva4 = 0;
     &iva5 = 0;
     &rec1 = 0;
     &rec2 = 0;
     &rec3 = 0;
     &rec4 = 0;
     &rec5 = 0;
     nSeccion = 0;
     &enLinCanon = 0;
     &eaMatricula = "";
     nTecla = 0;
     nError = 0;
     nLineas = 0;
     nTipo = 0;
     nLin = 0;
     &Tempo = "";
     aMensaje = "";
     &aDivisa     = "";
     &aMoneda     = "";
     &EURODB = 0;
hay_pendientes = "";
||\\ variables para el calculo de vencimientos

puente = "";
serie_orden = "";
numero_orden = "";
     solo_entrada = "S";
     aAlfa = "";
     aAlfa1 = "";
     eaCodigo = "";
     cuenta_conta = "";
     &sw_inf = 0;
     lineas_fra = 0;
     puedo_borrar = "N";
     tipo_iva = 0;
     fecha     = "          ";
     &opcion = 0;
     cafe      = "";
     diafe     = "";
     dianu     = "";
     dia_venci = "";
     mes_venci = "";
     any_venci = "";
     em = 0;
     j = 0;
     k = 0;
     importe = 0;
     redondeo = 0;
     resto = 0;
     tipo_imp = 0;
     fechas = "";
     fecha_fac = @;
     num = 0;
     mes_ven = 0;
     fechae = @;
     nCont = 0;

imneto = 0;
mod = 0;
precio = 0;
tipo_rec = "";
seguir = 0;
i = 0;
mensaje = "";
&matricula = "";
&bastidor = "";
&cliente = "";
&tipo_parte = "";
&fecha_ent = "01.01.1900";
&linea_usado = 0;
&numparte = "";
&serie_parte = "";
&es_garantia = 0;
linea = 0;
linea_aux = 0;
correcto = 0;
modo  = 0;
hacer_histo = 0;
mes = 0;
pri = 0;
fmes = "  ";
mes_margen = 0;
mes_importe = 0;
     {-1}aUtil  = "";
         aUtil1 = "2400";
         aUtil2 = "1";
         aUtil3 = "Opciones "
         aUtil4 = "TRIO";
         aUtil5 = " Texto Inicial    ";
         aUtil6 = " Texto Reparacion ";
         aUtil7 = " Imprimir ";
         aUtil8 = " Opciones ";

salida =0;
informe = "";
 {-1} menu      = "";
    menu1       = "2400";
    menu2       = "1";
    menu3       = "";
    menu4       = "OPSLMFTREICA"
    menu5       = "M.Obra";
    menu6       = "Piezas";
    menu7       = "S.Ext";
    menu8       = "Lubri";
    menu9       = "Modif";
    menu10      = "Fin ";
    menu11      = "Total";
    menu12      = "ObseR";
    menu13      = "TExt.";
    menu14      = "Imp.";
    menu15      = "Cerrar";
    menu16      = "Abrir";
    r_alfa = "";
    r_long = "";
    r_num = 0;
    alfa = "    ";
|FIN;

|PROCESO OR20; |TIPO 20;
     |SI FSalida ! "OPCION";
          |SELECT #1#0;
          |LEE 000#0=;
          |SI FSalida ! 0;
               |MENAV "0000Por favor, consulte el registro correcto antes de imprimir.";
               |ACABA;
          |SINO;
               |PINDA #0#0;
          |FINSI;
     |FINSI;
     |HAZ tipo200;
|FPRC;

|PROCESO tipo200;
     aAlfa1 = FSalida;

     |SI aAlfa1 = "OPCION";
         FSalida = "Opciones";
         |ACABA;
     |FINSI;

     |LEE 101#0=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     eaCodigo = #0#0;

     |MENU aUtil;
     aUtil2 = FSalida;
     |SI aUtil2 = "1"; |HAZ datosor;|FINSI;
     |SI aUtil2 = "2"; |HAZ texto_reparacion;|FINSI;
     |SI aUtil2 = "3"; |HAZ imp_parte; |FINSI;
     |SI aUtil2 = "4"; |HAZ tipo33; |FINSI;
     |LIBERA #0;
|FPRC;

|PROCESO carga_tmp02;
|SI #0#40 ! 999999
     hay_pendientes = "S";
     #15#0 = #0#0;
     #15#1 = #0#1;
     #15#2 = #0#3;
     #15#3 = #0#2;
     #15#4 = #0#19;
     #15#5 = #0#4;
     #15#6 = #0#21;
     |GRABA 001#15n;
     |LIBERA #15;
|FINSI;
|FPRC;

|DEFBUCLE carga_tmp02;
#0#1;
38;
"     ", "      ", "N";
"zzzzz", "zzzzzz", "N";
;
NULL , carga_tmp02;
|FIN;

|PROCESO efe11; |TIPO 66;
  |CONFI "0000SSolo Pendientes de Cerrar";
  |SI FSalida = 0;
       |HAZ CreaTempo;
       |NOME_DAT #15 Tempo;|DELINDEX #15; |ABRE #15;
       hay_pendientes = "N";
       |BUCLE carga_tmp02;
       |SI hay_pendientes = "S";
            |CONSULTA_CLAVE #2#15;
            |SI FSalida = 0;
               #0#0 = #15#0;
               #0#1 = #15#1;
               |LEE 000#0=;
               |PINTA #0#0;
               |PINTA #0#1;
            |SINO;
               |ERROR;
            |FINSI;
       |SINO;
          |MENAV "0000No hay Pendientes de Cerrar";
          |ERROR;
       |FINSI;
       |CIERRA #15;
       |HAZ BoraTempo; |DELINDEX #15;
  |SINO;
       |CONSULTA_CLAVE #1#conp0625;
  |FINSI;
|FPRC;

|PROCESO rellena;
    r_alfa = #0#1;
    |QBF r_alfa;
    #0#1 = "000000";
    r_long = #0#1 % A0;
    r_alfa = "000000" + r_alfa;
    r_num = -(r_long + 100);
    #0#1 = r_alfa % r_num;
    |PINTA #0#1;
|FPRC;

|PROCESO cliceros;
    r_alfa = #0#11;
    |QBF r_alfa;
    #0#11 = "000000";
    r_long = #0#11 % A0;
    r_alfa = "000000" + r_alfa;
    r_num = -(r_long + 100);
    #0#11 = r_alfa % r_num;
    |PINTA #0#11;
|FPRC;

|PROCESO imp_parte;
     enTiva = 1; efFiva = #0#2; |HAZ SacaIVA; iva1 = enIva; rec1 = enRec;
     enTiva = 2; efFiva = #0#2; |HAZ SacaIVA; iva2 = enIva; rec2 = enRec;
     enTiva = 3; efFiva = #0#2; |HAZ SacaIVA; iva3 = enIva; rec3 = enRec;
     enTiva = 4; efFiva = #0#2; |HAZ SacaIVA; iva4 = enIva; rec4 = enRec;
     enTiva = 5; efFiva = #0#2; |HAZ SacaIVA; iva5 = enIva; rec5 = enRec;

     |IMPRE 0;
     |SI FSalida = 0;
          |ABRE #91;
          #91#0 = #0#0;
          |LEE 010#91=;
          |SI FSalida = 0;
            informe = #91#7;
          |SINO;
            informe = "conp0625";
          |FINSI;
          |INFOR informe;
          |SI FSalida = 0;
               |ABRE #83;
               |DDEFECTO #83;
               |LEE 000#83]
               |SI FSalida ! 0 ; |DDEFECTO #83; |FINSI;
               |LIBERA #83;
               |CIERRA #83;
               |ABRE #85;
               #85#0 = #0#0;
               #85#1 = #0#1;
               |LEE 001#85=;
               sw_inf = 8; |PRINT;
               |HAZ  imp_fra_linea;
               |PIEINF;
               |CIERRA #85;
          |SINO;
               aMensaje = "0000Problemas con el informe " + informe;
               |MENAV aMensaje;
          |FINSI;
          |FININF;
          |LIBERA #91;
          |CIERRA #91;
     |FINSI;
     |FINIMP;
|FPRC;

|PROCESO imp_fra_resu;
|SI #92#1 = "G";
     es_garantia = 1;
|SINO;
     es_garantia = 0;
|FINSI;
|PRINT;
es_garantia = 0;
|FPRC;

|DEFBUCLE imp_fra_resu;
#92#1;
;
INICIO;
FINAL;
;
NULL , imp_fra_resu;
|FIN;

|PROCESO AcuResu;
     |ABRE #90;
     #90#0 = #1#21;
     |LEE 000#90=;
     |SI FSalida ! 0 ; |DDEFECTO #90; |FINSI;
     |CIERRA #90;

     |DDEFECTO #92;
     #92#0 = #90#4;
     #92#1 = #1#14;
     #92#3 = #1#5;
     #92#5 = #1#6;
     |LEE 001#92=;
     |SI FSalida ! 0 ; |GRABA 021#92b; |FINSI;
     #92#2 = #92#2 + #1#4;
     #92#4 = #92#4 + #1#8;
     |GRABA 001#92a;
     |LIBERA #92;
|FPRC;

|DEFBUCLE AcuResu;
#1#1;
;
#0#0 , #0#1 , 0001;
#0#0 , #0#1 , 0999;
;
NULL , AcuResu;
|FIN;

|PROCESO imp_fra_lin2;
|SI #1#14 = "G";
     es_garantia = 1;
|SINO;
     es_garantia = 0;
|FINSI;
|PRINT;
es_garantia = 0;
|FPRC;

|DEFBUCLE imp_fra_lin2;
#1#1;
;
#0#0 , #0#1 , 0001;
#0#0 , #0#1 , 0999;
;
NULL , imp_fra_lin2;
|FIN;

|DEFBUCLE imp_fra_lin3;
#1#1;
;
#0#0 , #0#1 , 1000;
#0#0 , #0#1 , 9999;
;
NULL , imp_fra_lin2;
|FIN;

|PROCESO imp_texto;
     |PRINT;
|FPRC;

|DEFBUCLE imp_texto;
#8#1;
;
#0#0 , #0#1 , 001;
#0#0 , #0#1 , 999;
;
NULL , imp_texto;
|FIN;

|PROCESO imp_fra_linea;
     |SI #0#18 ! "R";
          |SI #83#1 = "S";
               aAlfa = Usuario;
               |NOME_DAT #92 aAlfa; |DELINDEX #92;
               |ABRE #92;
               |BUCLE AcuResu;
               |CIERRA #92;
               sw_inf = 2;
               |BUCLE imp_fra_resu;
               |DELINDEX #92;
          |SINO;
               sw_inf = 0;
               |BUCLE imp_fra_lin2;
          |FINSI;
          sw_inf = 0;
          |BUCLE imp_fra_lin3;
     |FINSI;
     sw_inf = 3;
     |BUCLE imp_texto;
     sw_inf = 0;
|FPRC;

|PROCESO imp_fra;
|IMPRE 0;
|SI FSalida = 0;
    |ABRE #91;
     #91#0 = #0#0;
     |LEE 010#91=;
     |SI FSalida = 0;
         informe = #91#2;
     |SINO;
        informe = "conf0625";
     |FINSI;
     |LIBERA #91;
     |CIERRA #91;
     |INFOR informe;
     |SI FSalida = 0;
          |ABRE #83;
          |DDEFECTO #83;
          |LEE 000#83]
          |SI FSalida ! 0 ; |DDEFECTO #83; |FINSI;
          |LIBERA #83;
          |CIERRA #83;
          |ABRE #85;
          |ABRE #20;
          |ABRE #30;
          #85#0 = #0#0;
          #85#1 = #0#1;
          |LEE 001#85=;
          #20#0 = #0#15;
          #20#1 = #0#16;
          |LEE 001#20=;
          #30#0 = #0#11;
          |LEE 001#30=;
          |SI #30#44 = 0; #30#44 = 1; |FINSI;
          |PARA nCont = 1; |SI nCont [ #30#44; |HACIENDO nCont = nCont + 1;
             sw_inf = 8; |PRINT;
             |HAZ  imp_fra_linea; |PIEINF;
          |SIGUE;
          |CIERRA #85;
          |CIERRA #20;
          |CIERRA #30;
     |FINSI;
     |FININF;
|FINSI;
|FINIMP;
|FPRC;

|PROCESO quita_cliente;
          #30#0 = #0#11;
          |LEE 121#30=;
          |SI 0 = FSalida;
               fmes = #0#17 % A402;
               mes = ((fmes - 1) * 4) + 54;
               imneto = #20#6 + #20#7;
               || #30#50 = #30#50 -. imneto;        || pendiente de facturar
               #30mes = #30mes - imneto;
               mes = mes + 1;
               ||#30mes = #30mes + imneto;
               mes = mes + 1;
               ||#30mes = #30mes +. #0#46;
               #30#102 = #30#102 - imneto;
               ||#30#103 = #30#103 + #0#17;
               ||#30#104 = #30#104 +. #0#46;
               #30#49  = #30#49  - #20#11;        || riesgo
               #30#46  = 0;
               #30#110 = #30#110 - imneto;
               |GRABA 020#30a;

               enImpCliCom = -imneto;
               enImpCliFac = -imneto;
               eaCliente = #0#11;
               efFecha = #0#17;
               |HAZ AcumulaCli;
/*
||*************** CALCULO DEL RIESGO;
*/
          |FINSI;
          |LIBERA #30;
|FPRC;

|PROCESO actua_cliente;
          |ABRE #30;
          #30#0 = #0#11;
          |LEE 121#30=;
          |SI 0 = FSalida;
               cuenta_conta = #30#16;
               fmes = #0#17 % A402;
               mes = ((fmes - 1) * 4) + 54;
               imneto = #20#6 + #20#7;
               || #30#50 = #30#50 -. imneto;        || pendiente de facturar
               #30mes = #30mes + imneto;
               mes = mes + 1;
               ||#30mes = #30mes + imneto;
               mes = mes + 1;
               ||#30mes = #30mes +. #0#46;
               #30#102 = #30#102 + imneto;
               ||#30#103 = #30#103 + #0#17;
               ||#30#104 = #30#104 +. #0#46;
               #30#49  = #30#49  + (#21#11 - #21#23);        || riesgo
               #30#45 = #0#17;
               #30#46 = imneto;
               #30#110 = #30#110 + imneto;
               |GRABA 020#30a;

               enImpCliCom = imneto;
               enImpCliFac = imneto;
               eaCliente = #0#11;
               efFecha = #0#17;
               |HAZ AcumulaCli;
/*
||*************** CALCULO DEL RIESGO;
*/
          |FINSI;
          |LIBERA #30;
          |CIERRA #30;
|FPRC;

|CALCULO leepago;|TIPO 0;
     |ABRE #40;
     #40#0 = #20#20;
     |LEE 021#40=;
     |SI 0 ! FSalida; |DDEFECTO #40; |FINSI;
     tipo_rec = #40#69;
     |CIERRA #40;
|FCAL;

|PROCESO cambios;
     fecha = fechae;
     cafe = fecha;
     diafe = fecha % A102;
     dianu = diafe;
|FPRC;


|PROCESO fijos;
     |SI #30#21 = 0;          ||#6#22
          |VETE finfijos;
     |FINSI;
     |HAZ cambios;
     |SI dianu > #30#21;
          |VETE  fijos2;
     |FINSI;
     |ET fijos1;
     |SI dianu = #30#21;
          |VETE finfijos;
     |FINSI;
     fechae = fechae +1;
     |HAZ cambios;
     |VETE fijos1;
     |ET fijos2;
     |SI #30#22 = 0; |O dianu [ #30#21;
      |VETE fijos1;
 |FINSI;
 |SI dianu > #30#22;
     |VETE fijos3;
 |FINSI;
 |SI dianu = #30#22;
     |VETE finfijos;
 |FINSI;
 fechae = fechae + 1;
 |HAZ cambios;
 |VETE fijos2;
|ET fijos3;
 |SI #30#23 = 0;|O dianu > #30#23; |O dianu [ #30#21; |O dianu [ #30#22;
     |VETE fijos1;
 |FINSI;
 |SI dianu = #30#23;
     |VETE finfijos;
 |FINSI;
 fechae = fechae +1;
 |HAZ cambios;
 |VETE fijos3;
|ET finfijos;
 fecha = fechae;
|FPRC;

|PROCESO cambia_fecha;
     dia_venci = fechae % 102;
     mes_venci = fechae % 402;
     mes_ven = mes_venci + 1;
     mes_venci = ("00" + mes_ven) % -102;
     any_venci = fechae %704;
     |SI mes_ven > 12;
          mes_venci = "01";
          mes_ven = any_venci + 1;
          any_venci = mes_ven;
     |FINSI;
     fechas = dia_venci + "." + mes_venci + "." + any_venci;
     fechae = fechas;
|FPRC;

|PROCESO quita_VNVO;
|SI #0#7 = "VO";
     |ABRE #80;
     #80#0 = #0#3;
     #80#5 = #0#13;
     #80#1 = #0#14;
     |LEE 021#80=;
     |SI FSalida = 0;
          #80#4 = 0;
          |GRABA 021#80a;
     |FINSI;
     |LIBERA #80;
     |CIERRA #80;
|SINO;

|FINSI;
|FPRC;

|PROCESO borra_fra_standard;
|ABRE #55;
|ABRE #56;
#55#14 = #0#15;
#55#0 = #0#16;
|BORRA 021#55c;
#56#0 = #0#16;
#56#49 = #0#15;
|BORRA 021#56c;
|LIBERA #55;
|LIBERA #56;
|CIERRA #55;
|CIERRA #56;
|FPRC;

|PROCESO borra_lin_fr;
|FPRC;

|PROCESO borra_fra;
|ABRE #20;
#20#0 = #0#15;
#20#1 = #0#16;
|LEE 001#20=;
|SI FSalida = 0;
     |SI #0#7 = "VN" ; |O #0#7 = "VO";
          |HAZ quita_VNVO;
     |SINO;
          |ABRE #30;
          |HAZ quita_cliente;
          |GRABA 021#30a;
          |LIBERA #30;
          |CIERRA #30;
     |FINSI;
     |BORRA 021#20a;
     |BUCLELIN 1borra_lin_fr#20;
     |HAZ borra_fra_standard;
     #0#15 = "";
     #0#16 = 0;
     #0#17 = "01.01.1900";
     |PINTA #0#15;
     |PINTA #0#16;
     |PINTA #0#17;
     |GRABA 001#0a;

|FINSI;
|LIBERA #0;
|LIBERA #20;
|CIERRA #20;
|FPRC;

|PROCESO suma_lin_fra;
lineas_fra = lineas_fra + 1;
|FPRC;

|DEFBUCLE lee_lin_fra;
#67#1;
;
#0#15 , #0#16 , 001;
#0#15 , #0#16 , 999;
;
NULL , suma_lin_fra;
|FIN;

|PROCESO puedo_borrar;
lineas_fra = 0;
|BUCLE lee_lin_fra;
|SI lineas_fra > 1;
     puedo_borrar = "N";
|FINSI;
|FPRC;

|PROCESO pideclave;
    |PUSHV 0501 2475;
    |PINPA #0#16;
||    |ENDATOS #1#16;         || con el basico 32 o superior
||    alfa = #16#0;           ||/ya no funciona bien (RPC: 10.06.2008)

    |PINTA 2415, "Clave modific. .:";
    alfa = "";
    E_sup = 4;
    E_inf = "";
    alfa = 2434 ? -1;
    |QBF alfa;

    alfa = alfa + " ";   || compatibiliza con las preguntas de la clave

    |POPV;
|FPRC;

|PROCESO BorraLin;
     |BORRA 020#1a;
|FPRC;

|DEFBUCLE BorraLin;
     #1#1;
     ;
     #0#0, #0#1, 0001;
     #0#0, #0#1, 9999;
     be;
     NULL, BorraLin;
|FIN;

|PROCESO mod_baja;|TIPO 2;
     modo = (FEntrada/100)!0;
     mod = 0 +. 1;
     nError = 0;

     |SI mod = 1;
          |ABRE #601;
          #601#0 = #0#3;
          |LEE 121#601=;
          |SI FSalida = 0;
               #601#12 = #0#5;
               |GRABA 020#601a;
          |FINSI;
          |CIERRA #601;
     |FINSI;

     |SI modo = 2; |O modo = 3;
          |SI #0#40 ! 0;
               |SI mod < 0;
                    |MENAV "0000Presupuesto pasado a Orden...";
               |FINSI;
               nError = 1;
               |ERROR; |ACABA;
          |FINSI;
     |FINSI;
     |SI modo = 3;
          |BUCLE BorraLin;
     |FINSI;
/*
     |SI mod < 0;
          |SI modo = 2; |O modo = 3;
               |SI #0#16 ! 0;
                    |MENAV "0000Presupuesto pasao a Orden...";
                    |ERROR;
               |FINSI;
               |SI #0#16 ! 0;
                  |SI #0#16 ! 999999;
                    |MENAV "0000Esta facturado";
                    |SI modo = 3;
                         |CONFI "0000NConfirmar la Baja";
                         |SI FSalida ! 0;
                              correcto = 1;
                              |ERROR;
                         |SINO;
                              puedo_borrar = "S";
                              |HAZ puedo_borrar;
                              |SI puedo_borrar = "S";
                                  |HAZ borra_fra;
                              |SINO;
                                   |MENAV "0000Estar O.R. esta en una factura englobada. Borrar por Facturas";
                                   correcto = 1;
                                   |ERROR;
                              |FINSI;
                         |FINSI;
                    |SINO;
                         |CONFI "0000NModificar O.R.";
                         |SI FSalida ! 0;
                              correcto = 1;
                              |ERROR;
                         |SINO;
                            |HAZ pideclave;
                            |SI alfa = "MOR ";
                              puedo_borrar = "S";
                              |HAZ puedo_borrar;
                              |SI puedo_borrar = "S";
                                   |HAZ borra_fra;
                              |SINO;
                                   |MENAV "0000Estar O.R. esta en una factura englobada. Borrar por Facturas";
                                   correcto = 1;
                                   |ERROR;
                              |FINSI;
                            |SINO;
                               |MENAV "0000CLAVE INCORRECTA";
                               |ERROR;
                            |FINSI;
                         |FINSI;
                    |FINSI;
                  |SINO;
                    |MENAV "0000Esta O.R. esta cerrada sin factura.";
                    |CONFI "0000SDesea Modificar (S/N) ";
                         |SI FSalida = 0;
                              |HAZ pideclave;
                              |SI alfa = "MOR ";
                                 #0#16 = 0;
                                 |PINTA #0#16;
                                 |GRABA 001#0a;
                                 |LIBERA #0;
                               |SINO;
                                  |MENAV "0000CLAVE INCORRECTA";
                                  |ERROR;
                               |FINSI;
                         |FINSI;
                  |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
*/
|FPRC;

|PROCESO actua_arti;
      |ABRE #9;
      |DDEFECTO #9;
      #9#0 = #1#2;
      #9#2 = 01;
      |LEE 101#9=;
      |SI FSalida ! 0;
          |GRABA 011#9b;
      |FINSI;
      #11#104 = #11#104 - #1#4;
      #9#39 = #9#39 - #1#4;
      #11#6 = #11#6 - #1#4;
      #9#5 = #9#5 - #1#4;
      |SI #11#6 > 0;
           #11#10 = #11#6 * #11#9;
      |SINO;
           #11#10 = 0;
      |FINSI;
      |SI #9#5 > 0;
           #9#3 = #9#5 * #11#9;
        |SINO;
            #9#3 = 0;
      |FINSI;
      #11#11 = #11#15 + #11#7 - #11#16 - #11#104 - #11#17 - #11#13 - #11#12 ;
      fmes = #0#2 % A402;
      mes = fmes - 1;
      mes = mes * 5;
      mes = mes + 34;
      mes_importe = mes + 1;
      mes_margen = mes + 2;
      #11mes = #11mes + #1#4;
      |SI #1#14 = "G"; |O #1#14 = "S";
           #11mes_margen  = #11mes_margen -  #1#17;||\\ resto el coste
           #11#96 = #11#96 - #1#17;  ||anual
           enImpMar = #1#17;
      |SINO;
           #11mes_importe = #11mes_importe + #1#8; || Sumo la venta
           #11mes_margen  = #11mes_margen + (#1#8 - #1#17);||\\ resto el coste
           #11#95 = #11#95 + #1#8;            || ptas ventas anual
           #11#96 = #11#96 + (#1#8 - #1#17);  ||margen anual
           enImpVta = #1#8;
           enImpMar = #1#8 - #1#17;
      |FINSI;
      #11#94 = #11#94 + #1#4;
      |GRABA 021#11a;
      mes = fmes - 1;
      mes = mes * 2;
      mes = mes + 11;
      #9mes = #9mes + #1#4; ||salida mensual
      #9#35 = #9#35 + #1#4; ||salida anual
      #9#50 = #9#42 + #9#6 - #9#43 - #9#39; || necesidades
      #9#50 = #9#50 - #9#4 - #9#9 - #9#8;
      |GRABA 021#9a;
      |LIBERA #9; |CIERRA #9;
      |LIBERA #11;

     efFecha = #0#2;
     eaArticulo = #1#2;
     enAlmacen = 01;
     enUniVta = #1#4;
     enUniSal = #1#4;
     |HAZ AcumulaArt;
     |HAZ AcumulaAlm;
|FPRC;

|PROCESO quita_arti;
      #11#104 = #11#104 + #1#4;
      #11#6 = #11#6 + #1#4;
      |SI #11#6 > 0;
           #11#10 = #11#6 * #11#9;
      |SINO;
           #11#10 = 0;
      |FINSI;
      #11#11 = #11#15 + #11#7 - #11#16 - #11#104 - #11#17 - #11#13 - #11#12 ;
      fmes = #0#2 % A402;
      mes = fmes - 1;
      mes = mes * 5;
      mes = mes + 34;
      mes_importe = mes + 1;
      mes_margen = mes + 2;
      #11mes = #11mes - #1#4;
      |SI #1#14 = "G"; |O #1#14 = "S";
           #11mes_margen  = #11mes_margen + #1#17;||\\ sumo el coste
      |SINO;
           #11mes_importe = #11mes_importe - #1#8; || resto la venta
           #11mes_margen  = #11mes_margen - (#1#8 - #1#17);||\\ resto el coste
      |FINSI;
      #11#94 = #11#94 - #1#4;
|GRABA 021#11a;
|LIBERA #11;
|FPRC;

|PROCESO actua_histo;
 |ABRE #70;
 #70#26 = #1#0;
 |LEE 000#70=;
 |CIERRA #70;

 |ABRE #12;
 |DDEFECTO #12;
 #12#0 = #1#2;||articulo
 #12#11= #1#0;||Serie
 #12#1 = #0#2;||FECHA
 #12#2 = "OR";|| tipo operacion
 #12#3 = #1#1;|| documento
 #12#4 = #1#11;|| linea
 #12#5 = #70#29;        || almacen
 #12#6 = #1#4 * -1 ;   || stock se hace la salida
 #12#7 = 0; || stock resultante (del articulo)
 #12#8 = 0; || precio costo medio
 |SI #1#14 = "G"; |O #1#14 = "S";
     #12#9 = 0; || precio de venta
     #12#14 = 0 < #1#6;  || precio con descuento
 |SINO;
     #12#9 = #1#5; || precio de venta
     #12#14 = #1#5 < #1#6;  || precio con descuento
 |FINSI;
 #12#10 = #0#11;  || cliente
 #12#12 = #1#6;   || porcentaje descuento
 #12#13 = 0;
 ||\\es bueno#12#15 = #0#3; || matricula
 |GRABA 121#12n;
 |LIBERA #12;
 |CIERRA #12;

|FPRC;

|PROCESO quita_histo;
|ABRE #12;
 |DDEFECTO #12;
 #12#0 = #1#2;||articulo
 #12#11= #1#0;||Serie
 #12#1 = #0#2;||FECHA
 #12#2 = "OR";|| tipo operacion
 #12#3 = #1#1;|| documento
 #12#4 = #1#11;|| linea
 #12#5 = 01;        || almacen
 ||\\ es bueno#12#15 = #0#3;
 |BORRA 021#12c;
 |LIBERA #12;
 |CIERRA #12;

|FPRC;

|PROCESO alta_histo;
|FPRC;


|PROCESO comercial;
|SI tipo_parte ! "";
#0#3 = matricula;
#0#4 = bastidor;
#0#11 = cliente;
#0#7 = tipo_parte;
#0#13 = fecha_ent;
#0#14 = linea_usado;
serie_parte = #0#0;
numparte = #0#1;
|PINTA #0#3;
|PINTA #0#4;
|PINTA #0#11;
|PINTA #0#7;
|FINSI;
|FPRC;


|PROCESO texto_reparacion;
|PUSHV 0501 2380;
|ENTLINEAL #1#14 , 3 , 1 , 22 , 1 , min_texto , max_texto;
|POPV;
|FPRC;

|PROCESO min_texto;
#14#0 = #0#0;
#14#1 = #0#1;
#14#2 = 001;
|FPRC;
|PROCESO max_texto;
#14#0 = #0#0;
#14#1 = #0#1;
#14#2 = 999;
|FPRC;

|PROCESO Min;
     #1#0 = #0#0;
     #1#1 = #0#1;
     #1#9 = 0;
     #1#11 = 1;
     |SI FSalida = "POSICION";
          #1#9 = nTipo;
          #1#11 = nLin;
     |FINSI;
|FPRC;

|PROCESO Repinta0;
     |ENTLINEAL #2#1 , 4 , 7 , 22 , 0 ,  min , max;
|FPRC;

|PROCESO Repinta;
     nTipo = #1#9;
     nLin = #1#11;
     |ABRE #1;
     #1#0 = #0#0;
     #1#1 = #0#1;
     #1#11 = nLin;
     |LEE 000#1];
     |SI FSalida = 0;
          |LEE 000#1a;
     |SINO;
          |LEE 000#1u;
     |FINSI;
     |PARA nLineas = 0; |SI FSalida = 0; |Y #1#0 = #0#0; |Y #1#1 = #0#1;
               |Y nLineas < 10; |HACIENDO nLineas = nLineas + 1;
          nLin = #1#11; || para posicionar el lineal
          nTipo = #1#9; || y visualizar la linea introducida
          |LEE 000#1a;
     |SIGUE;
     |CIERRA #1;

     |ENTLINEAL #2#1 , 4 , 7 , 22 , 0 ,  Min , max;
|FPRC;

|PROCESO lineal;
|SI #0#16 = 0;
     |ENTLINEAL #2#1 , 4 , 2 , 22 , 0 ,  min , max;
|SINO;
     |ENTLINEAL #2#1 , 4 , 4 , 22 , 0 ,  min , max;
|FINSI;
|FPRC;



|PROCESO tipo13;|TIPO 13;
     |HAZ TallerDeci;
     |HAZ Repinta0;
|FPRC;

|PROCESO min;
#1#0 = #0#0;
#1#1 = #0#1;
#1#9 = 0;
#1#11 = 1;
|FPRC;

|PROCESO max;
#1#0 = #0#0;
#1#1 = #0#1;
#1#9 = 9;
#1#11 = 9999;
|FPRC;


|PROCESO pon_pieza;
|DDEFECTO #1;
#1#0 = #0#0;
#1#1 = #0#1;
#1#11 = 1999;
|LEE 001#1];
|SI FSalida ! 0;
      |LEE 001#1u;
|SINO;
     |LEE 001#1a;
|FINSI;
|SI FSalida ! 0;
     |DDEFECTO #1;
     #1#0 = #0#0;
     #1#1 = #0#1;
     #1#2 = #10#2;
     #1#3 = #11#1;
     #1#4 = #10#4;
     #1#5 = #11#18;
     #1#6 = 0;
     #1#7 = 0;
     #1#8 = #1#4 * #1#5;
     #1#10 = #0#7;
     #1#9 = 2;
     #1#11 = 1000;
     #1#12 = linea_aux;
     #1#14 = #4#12;
     ||\\#1#19 = #90#1;
     #1#15 = #11#9;|| costo medio;
     ||\\|SI #90#1 = 0;
     ||\\     #1#16 = #1#15;
     ||\\|SINO;
     ||\\     #1#16 = #1#5 - (#1#5 % #90#1)!0;
     ||\\|FINSI;
     #1#17 = #1#15 * #1#4;
     #1#18 = #1#16 * #1#4;
     |GRABA 001#1n;
|SINO;
     |SI #1#0 = #0#0;|Y #1#1 = #0#1;|Y #1#11 ] 999;|Y #1#11 [ 1999;
          linea = #1#11 + 1;
          |DDEFECTO #1;
          #1#0 = #0#0;
          #1#1 = #0#1;
          #1#2 = #10#2;
          #1#3 = #11#1;
          #1#4 = #10#4;
          #1#5 = #11#18;
          #1#6 = 0;
          #1#7 = 0;
          #1#8 = #1#4 * #1#5;
          #1#10 = #0#7;
          #1#9 = 2;
          #1#11 = linea;
          #1#12 = linea_aux;
          #1#14 = #4#12;
          ||#1#19 = #90#1;
          #1#15 = #11#9;|| costo medio;
          |||SI #90#1 = 0;
          ||     #1#16 = #1#15;
          |||SINO;
          ||     #1#16 = #1#5 - (#1#5 % #90#1)!0;
          |||FINSI;
           #1#17 = #1#15 * #1#4;
           #1#18 = #1#16 * #1#4;
          |GRABA 001#1n;
     |SINO;
          |DDEFECTO #1;
          #1#0 = #0#0;
          #1#1 = #0#1;
          #1#2 = #10#2;
          #1#3 = #11#1;
          #1#4 = #10#4;
          #1#5 = #11#18;
          #1#6 = 0;
          #1#7 = 0;
          #1#8 = #1#4 * #1#5;
          #1#10 = #0#7;
          #1#9 = 2;
          #1#11 = 1000;
          #1#12 = linea_aux;
          #1#14 = #4#12;
                 ||#1#19 = #90#1;
                 #1#15 = #11#9;|| costo medio;
          |||SI #90#1 = 0;
          ||     #1#16 = #1#15;
          |||SINO;
          ||     #1#16 = #1#5 - (#1#5 % #90#1)!0;
          |||FINSI;
                 #1#17 = #1#15 * #1#4;
                 #1#18 = #1#16 * #1#4;
          |GRABA 001#1n;
     |FINSI;
|FINSI;

|LIBERA #1;

|FPRC;

|PROCESO pon_lubri;
|DDEFECTO #1;
#1#0 = #0#0;
#1#1 = #0#1;
#1#11 = 4000;
|LEE 001#1];
|SI FSalida ! 0;
      |LEE 001#1u;
|SINO;
     |LEE 001#1a;
|FINSI;
|SI FSalida ! 0;
     |DDEFECTO #1;
     #1#0 = #0#0;
     #1#1 = #0#1;
          #1#2 = #10#2;
          #1#3 = #11#1;
          #1#4 = #10#4;
          #1#5 = #11#18;
          #1#6 = 0;
          #1#7 = 0;
          #1#8 = #1#4 * #1#5;
          #1#10 = #0#7;
     #1#9 = 4;
     #1#11 = 3000;
     #1#12 = linea_aux;
     #1#14 = #4#12;
     ||#1#19 = #90#1;
     #1#15 = #11#9;|| costo medio;
     ||     |SI #90#1 = 0;
     ||          #1#16 = #1#15;
     ||     |SINO;
     ||          #1#16 = #1#5 - (#1#5 % #90#1)!0;
     ||     |FINSI;
     #1#17 = #1#15 * #1#4;
     #1#18 = #1#16 * #1#4;
     |GRABA 001#1n;
|SINO;
     |SI #1#0 = #0#0;|Y #1#1 = #0#1;|Y #1#11 ] 3000;|Y #1#11 [ 3999;
          linea = #1#11 + 1;
          |DDEFECTO #1;
          #1#0 = #0#0;
          #1#1 = #0#1;
          #1#2 = #10#2;
          #1#3 = #11#1;
          #1#4 = #10#4;
          #1#5 = #11#18;
          #1#6 = 0;
          #1#7 = 0;
          #1#8 = #1#4 * #1#5;
          #1#10 = #0#7;
          #1#9 = 4;
          #1#11 = linea;
          #1#12 = linea_aux;
          #1#14 = #4#12;
     ||#1#19 = #90#1;
     #1#15 = #11#9;|| costo medio;
      ||    |SI #90#1 = 0;
      ||         #1#16 = #1#15;
      ||    |SINO;
      ||         #1#16 = #1#5 - (#1#5 % #90#1)!0;
      ||    |FINSI;
     #1#17 = #1#15 * #1#4;
     #1#18 = #1#16 * #1#4;
          |GRABA 001#1n;
     |SINO;
          |DDEFECTO #1;
          #1#0 = #0#0;
          #1#1 = #0#1;
          #1#2 = #10#2;
          #1#3 = #11#1;
          #1#4 = #10#4;
          #1#5 = #11#18;
          #1#6 = 0;
          #1#7 = 0;
          #1#8 = #1#4 * #1#5;
          #1#10 = #0#7;
          #1#9 = 4;
          #1#11 = 3000;
          #1#12 = linea_aux;
          #1#14 = #4#12;
     ||#1#19 = #90#1;
     #1#15 = #11#9;|| costo medio;
     ||     |SI #90#1 = 0;
     ||          #1#16 = #1#15;
     ||     |SINO;
     ||          #1#16 = #1#5 - (#1#5 % #90#1)!0;
     ||     |FINSI;
     #1#17 = #1#15 * #1#4;
     #1#18 = #1#16 * #1#4;
          |GRABA 001#1n;
     |FINSI;
|FINSI;

|LIBERA #1;

|FPRC;



|PROCESO busca_coste;
|||ABRE #90;
||#90#0 = #11#29;
|||LEE 001#90];
|||SI FSalida ! 0; |DDEFECTO #90; |FINSI;
|||LIBERA #90;
|||CIERRA #90;
|FPRC;

|PROCESO pon_relac;
|ABRE #11;
#11#0 = #10#2;
|LEE 001#11=;
hacer_histo = FSalida;
|SI FSalida = 0;
     |||HAZ busca_coste;
     |SI #11#135 = "P";
          |HAZ pon_pieza;
     |SINO;
          |HAZ pon_lubri;
     |FINSI;
|FINSI;
|LIBERA #11;
|CIERRA #11;
|SI hacer_histo = 0;
      |HAZ alta_histo;
|FINSI;
|FPRC;

|DEFBUCLE lee_relaci;
#10#1;
;
#4#0 , 1;
#4#0 , 99;
;
NULL , pon_relac;
|FIN;


|PROCESO art_relaci;
|BUCLE lee_relaci;
|FPRC;

|PROCESO ver_importe;
|ABRE #90;
#90#0 = #82#0;
|LEE 001#90=;
|SI FSalida ! 0 ; |DDEFECTO #90;|FINSI;
precio = #90#2;
|LIBERA #90;
|CIERRA #90;
|FPRC;


|PROCESO horas_pend;
|SI pri = 0;
  seguir = 1;
  |CONFI "0000S ¨RECOGER HORAS PENDIENTES? (S/N) ";
  seguir = FSalida;
  pri = 1;
|FINSI;
|SI seguir = 0;  ||Recoger las horas
 |SI #82#10 ! 0;
  |HAZ ver_importe;
  |ABRE #1;
  |DDEFECTO #1;
  #1#0 = #0#0;
  #1#1 = #0#1;
  #1#11 = 999;
  |LEE 001#1];
  |SI FSalida ! 0;
       |LEE 001#1u;
  |SINO;
       |LEE 001#1a;
  |FINSI;
  |SI FSalida ! 0;
       |DDEFECTO #1;
       #1#0 = #0#0;
       #1#1 = #0#1;
       #1#2 = "";
       #1#3 = "M. Obra Operario :" + #82#0;
       #1#4 = #82#10;
       #1#5 = precio;
       #1#6 = 0;
       #1#7 = 0;
       #1#8 = #1#4 * #1#5;
       #1#10 = #0#7;
       #1#9 = 1;
       #1#12 = 0;
       #1#13 = #82#6;
       #1#14 = #0#12;
       #1#15 = 0;
       #1#16 = 0;
       #1#17 = 0;
       #1#18 = 0;
       #1#19 = 0;
       #1#20 = "N";
       #1#21 = #82#0;
       linea_aux = #1#11;
       #1#22 = #82#1;
       |GRABA 001#1n;
  |SINO;
       |SI #1#0 = #0#0;|Y #1#1 = #0#1;|Y #1#11 [ 999;
            linea = #1#11 + 1;
            |DDEFECTO #1;
              #1#0 = #0#0;
              #1#1 = #0#1;
              #1#2 = "";
              #1#3 = "M. Obra Operario :" + #82#0;
              #1#4 = #82#10;
              #1#5 = precio;
              #1#6 = 0;
              #1#7 = 0;
              #1#8 = #1#4 * #1#5;
              #1#10 = #0#7;
              #1#9 = 1;
              #1#12 = 0;
              #1#13 = #82#6;
              #1#14 = #0#12;
              #1#15 = 0;
              #1#16 = 0;
              #1#17 = 0;
              #1#18 = 0;
              #1#19 = 0;
              #1#20 = "N";
              #1#21 = #82#0;
              #1#22 = #82#1;
              #1#11 = linea;
              linea_aux = linea;
             |GRABA 001#1n;
       |SINO;
            |DDEFECTO #1;
                #1#0 = #0#0;
                #1#1 = #0#1;
                #1#2 = "";
                #1#3 = "M. Obra Operario :" + #82#0;
                #1#4 = #82#10;
                #1#5 = precio;
                #1#6 = 0;
                #1#7 = 0;
                #1#8 = #1#4 * #1#5;
                #1#10 = #0#7;
                #1#9 = 1;
                #1#12 = 0;
                #1#13 = #82#6;
                #1#14 = #0#12;
                #1#15 = 0;
                #1#16 = 0;
                #1#17 = 0;
                #1#18 = 0;
                #1#19 = 0;
                #1#20 = "N";
                #1#21 = #82#0;
                #1#22 = #82#1;
                #1#11 = 1;
                linea_aux =  #1#11;
           |GRABA 001#1n;
       |FINSI;
  |FINSI;
  #82#11 = "S";
  |GRABA 010#82a;
 |SINO;
   |MENAV "0000Esta orden tiene partes sin finalizar.";
 |FINSI;
|SINO;
  |ERROR10;
|FINSI;
|FPRC;

|DEFBUCLE ver_horas;
 #82#2;
 ;
 #0#0,#0#1,"N";
 #0#0,#0#1,"N";
 be;
 NULL ,horas_pend;
|FIN;

|PROCESO mano_obra;
 pri = 0;
|BUCLE ver_horas;
|DDEFECTO #4;
#4#9 = #0#7;
|PUSHV 0501 2380;
|PINPA #0#4;
|PINDA #0#4;
||#4#15 = #1#23;
#4#16 = 1;
#4#17 = #0#0;
|ENDATOS #1#4;
|SI FSalida = 0;
|ABRE #1;
|DDEFECTO #1;
#1#0 = #0#0;
#1#1 = #0#1;
#1#11 = 999;
|LEE 001#1];
|SI FSalida ! 0;
      |LEE 001#1u;
|SINO;
     |LEE 001#1a;
|FINSI;
|SI FSalida ! 0;
     |DDEFECTO #1;
     #1#0 = #0#0;
     #1#1 = #0#1;
     #1#2 = #4#0;
     #1#3 = #4#1;
     #1#4 = #4#2;
     #1#5 = #4#4;
     #1#6 = #4#6;
     #1#7 = #4#7;
     #1#8 = #4#8;
     #1#10 = #4#9;
     #1#9 = 1;
     #1#11 = 1;
     #1#13 = #4#3;
     #1#14 = #4#12;
     #1#21 = #4#13;
     linea_aux = #1#11;
     #1#22 = #4#14;
     #1#23 = #4#15;
     |GRABA 001#1n;
|SINO;
     |SI #1#0 = #0#0;|Y #1#1 = #0#1;|Y #1#11 [ 999;
          linea = #1#11 + 1;
          |DDEFECTO #1;
          #1#0 = #0#0;
          #1#1 = #0#1;
          #1#2 = #4#0;
          #1#3 = #4#1;
          #1#4 = #4#2;
          #1#5 = #4#4;
          #1#6 = #4#6;
          #1#7 = #4#7;
          #1#8 = #4#8;
          #1#10 = #4#9;
          #1#9 = 1;
          #1#11 = linea;
          linea_aux = linea;
          #1#13 = #4#3;
          #1#14 = #4#12;
          #1#21 = #4#13;
          #1#22 = #4#14;
          #1#23 = #4#15;
          |GRABA 001#1n;
     |SINO;
          |DDEFECTO #1;
          #1#0 = #0#0;
          #1#1 = #0#1;
          #1#2 = #4#0;
          #1#3 = #4#1;
          #1#4 = #4#2;
          #1#5 = #4#4;
          #1#6 = #4#6;
          #1#7 = #4#7;
          #1#8 = #4#8;
          #1#10 = #4#9;
          #1#9 = 1;
          #1#11 = 1;
          linea_aux =  #1#11;
          #1#13 = #4#3;
          #1#14 = #4#12;
          #1#21 = #4#13;
          #1#22 = #4#14;
          #1#23 = #4#15;
          |GRABA 001#1n;
     |FINSI;
|FINSI;

|LIBERA #1;
|HAZ art_relaci;
|CIERRA #1;
|FINSI;
|POPV;
|HAZ Repinta;
|FPRC;

|PROCESO articulos;
|DDEFECTO #5;
#5#8 = #0#7;
||#5#18 = #1#23;
#5#19 = 2;
#5#20 = #0#0;
|PUSHV 0501 2380;
|PINPA #0#5;
|PINDA #0#5;
|ENDATOS #1#5;
|SI FSalida = 0;

|ABRE #1;
|DDEFECTO #1;
#1#0 = #0#0;
#1#1 = #0#1;
#1#11 = 1999;
|LEE 001#1];
|SI FSalida ! 0;
      |LEE 001#1u;
|SINO;
     |LEE 001#1a;
|FINSI;
|SI FSalida ! 0;
     |DDEFECTO #1;
     #1#0 = #0#0;
     #1#1 = #0#1;
     #1#2 = #5#0;
     #1#3 = #5#1;
     #1#4 = #5#2;
     #1#5 = #5#3;
     #1#6 = #5#5;
     #1#7 = #5#6;
     #1#8 = #5#7;
     #1#10 = #5#8
     #1#9 = 2;
     #1#11 = 1000;
     #1#14 = #5#11;
     #1#15 = #5#12;
     #1#16 = #5#13;
     #1#17 = #5#14;
     #1#18 = #5#15;
     #1#19 = #5#16;
     #1#22 = #5#17;
     #1#23 = #5#18;
|SINO;
     |SI #1#0 = #0#0;|Y #1#1 = #0#1;|Y #1#11 ] 999;|Y #1#11 [ 1999;
          linea = #1#11 + 1;
          |DDEFECTO #1;
          #1#0 = #0#0;
          #1#1 = #0#1;
          #1#2 = #5#0;
          #1#3 = #5#1;
          #1#4 = #5#2;
          #1#5 = #5#3;
          #1#6 = #5#5;
          #1#7 = #5#6;
          #1#8 = #5#7;
          #1#10 = #5#8
          #1#9 = 2;
          #1#11 = linea;
          #1#14 = #5#11;
          #1#15 = #5#12;
          #1#16 = #5#13;
          #1#17 = #5#14;
          #1#18 = #5#15;
          #1#19 = #5#16;
          #1#22 = #5#17;
          #1#23 = #5#18;
     |SINO;
          |DDEFECTO #1;
          #1#0 = #0#0;
          #1#1 = #0#1;
          #1#2 = #5#0;
          #1#3 = #5#1;
          #1#4 = #5#2;
          #1#5 = #5#3;
          #1#6 = #5#5;
          #1#7 = #5#6;
          #1#8 = #5#7;
          #1#10 = #5#8
          #1#9 = 2;
          #1#11 = 1000;
          #1#14 = #5#11;
          #1#15 = #5#12;
          #1#16 = #5#13;
          #1#17 = #5#14;
          #1#18 = #5#15;
          #1#19 = #5#16;
          #1#22 = #5#17;
          #1#23 = #5#18;
     |FINSI;
|FINSI;
|GRABA 001#1b;
|HAZ alta_histo;
|SALVA_FICHA #1;
|HAZ CanonArticulo;
|REPON_FICHA #1;
#1#27 = nLin;
|GRABA 020#1a;
|LIBERA #1;
|CIERRA #1;
|FINSI;
|POPV;
|HAZ Repinta;
|FPRC;

|PROCESO ser_exter;
|DDEFECTO #3;
#3#7 = #0#7;
||#3#15 = #1#23;
#3#16 = 3;
#3#17 = #0#0;
|PUSHV 0501 2380;
|PINPA #0#3;
|PINDA #0#3;
|ENDATOS #1#3;
|SI FSalida = 0;

  |ABRE #1;
  |DDEFECTO #1;
  #1#0 = #0#0;
  #1#1 = #0#1;
  #1#11 = 3000;
  |LEE 001#1];
  |SI FSalida ! 0;
        |LEE 001#1u;
  |SINO;
       |LEE 001#1a;
  |FINSI;
  |SI FSalida ! 0;
       |DDEFECTO #1;
       #1#0 = #0#0;
       #1#1 = #0#1;
       #1#2 = #3#0;
       #1#3 = #3#1;
       #1#4 = #3#2;
       #1#5 = #3#3;
       #1#6 = #3#4;
       #1#7 = #3#5;
       #1#8 = #3#6;
       #1#9 = 3;
       #1#10 = #3#7;
       #1#11 = 2000;
       #1#14 = #3#11;
       #1#16 = #3#12;
       #1#18 = #3#13;
       #1#22 = #3#14;
       #1#23 = #3#15;
       |GRABA 001#1n;
  |SINO;
       |SI #1#0 = #0#0;|Y #1#1 = #0#1;|Y #1#11 ] 2000;|Y #1#11 [ 2999;
            linea = #1#11 + 1;
            |DDEFECTO #1;
            #1#0 = #0#0;
            #1#1 = #0#1;
            #1#2 = #3#0;
            #1#3 = #3#1;
            #1#4 = #3#2;
            #1#5 = #3#3;
            #1#6 = #3#4;
            #1#7 = #3#5;
            #1#8 = #3#6;
            #1#9 = 3;
            #1#10 = #3#7;
            #1#11 = linea;
            #1#14 = #3#11;
            #1#16 = #3#12;
            #1#18 = #3#13;
            #1#22 = #3#14;
            #1#23 = #3#15;
            |GRABA 001#1n;
       |SINO;
            |DDEFECTO #1;
            #1#0 = #0#0;
            #1#1 = #0#1;
            #1#2 = #3#0;
            #1#3 = #3#1;
            #1#4 = #3#2;
            #1#5 = #3#3;
            #1#6 = #3#4;
            #1#7 = #3#5;
            #1#8 = #3#6;
            #1#9 = 3;
            #1#10 = #3#7;
            #1#11 = 2000;
            #1#14 = #3#11;
            #1#16 = #3#12;
            #1#18 = #3#13;
            #1#22 = #3#14;
            #1#23 = #3#15;
            |GRABA 001#1n;
       |FINSI;
  |FINSI;

  |LIBERA #1;
  |CIERRA #1;
|FINSI;
|POPV;
|HAZ Repinta;
|FPRC;

|PROCESO lubricant;
|DDEFECTO #6;
#6#8 = #0#7;
||#6#18 = #1#23;
#6#19 = 4;
#6#20 = #0#0;
|PUSHV 0501 2380;
|PINPA #0#6;
|PINDA #0#6;
|ENDATOS #1#6;
|SI FSalida = 0;


|ABRE #1;
|DDEFECTO #1;
#1#0 = #0#0;
#1#1 = #0#1;
#1#11 = 4000;
|LEE 001#1];
|SI FSalida ! 0;
      |LEE 001#1u;
|SINO;
     |LEE 001#1a;
|FINSI;
|SI FSalida ! 0;
     |DDEFECTO #1;
     #1#0 = #0#0;
     #1#1 = #0#1;
     #1#2 = #6#0;
     #1#3 = #6#1;
     #1#4 = #6#2;
     #1#5 = #6#3;
     #1#6 = #6#5;
     #1#7 = #6#6;
     #1#8 = #6#7;
     #1#10 = #6#8
     #1#9 = 4;
     #1#11 = 3000;
     #1#14 = #6#11;
     #1#15 = #6#12;
     #1#16 = #6#13;
     #1#17 = #6#14;
     #1#18 = #6#15;
     #1#19 = #6#16;
     #1#22 = #6#17;
     #1#23 = #6#18;
|SINO;
     |SI #1#0 = #0#0;|Y #1#1 = #0#1;|Y #1#11 ] 3000;|Y #1#11 [ 3999;
          linea = #1#11 + 1;
          |DDEFECTO #1;
          #1#0 = #0#0;
          #1#1 = #0#1;
          #1#2 = #6#0;
          #1#3 = #6#1;
          #1#4 = #6#2;
          #1#5 = #6#3;
          #1#6 = #6#5;
          #1#7 = #6#6;
          #1#8 = #6#7;
          #1#10 = #6#8
          #1#9 = 4;
          #1#11 = linea;
          #1#14 = #6#11;
          #1#15 = #6#12;
          #1#16 = #6#13;
          #1#17 = #6#14;
          #1#18 = #6#15;
          #1#19 = #6#16;
          #1#22 = #6#17;
          #1#23 = #6#18;
     |SINO;
          |DDEFECTO #1;
          #1#0 = #0#0;
          #1#1 = #0#1;
          #1#2 = #6#0;
          #1#3 = #6#1;
          #1#4 = #6#2;
          #1#5 = #6#3;
          #1#6 = #6#5;
          #1#7 = #6#6;
          #1#8 = #6#7;
          #1#10 = #6#8
          #1#9 = 4;
          #1#11 = 3000;
          #1#14 = #6#11;
          #1#15 = #6#12;
          #1#16 = #6#13;
          #1#17 = #6#14;
          #1#18 = #6#15;
          #1#19 = #6#16;
          #1#22 = #6#17;
          #1#23 = #6#18;
     |FINSI;
|FINSI;
|GRABA 001#1b;
|HAZ alta_histo;
|SALVA_FICHA #1;
|HAZ CanonLubri;
|REPON_FICHA #1;
#1#27 = nLin;
|GRABA 020#1a;
|LIBERA #1;
|CIERRA #1;

|FINSI;
|POPV;
|HAZ Repinta;
|FPRC;

|PROCESO suma_to;
|SI #1#11 [ 999;
   #7#0 = #7#0 + #1#8;
   #7#10 = #7#10 + #1#4;
   |SI #1#14 = "G";
      #7#7 = #7#7 + #1#4;
   |SINO;
     |SI #1#14 = "N";
        #7#8 = #7#8 + #1#4;
     |SINO;
       |SI #1#14 = "N";
          #7#9 = #7#9 + #1#4;
       |FINSI;
     |FINSI;
   |FINSI;
|FINSI;
|SI #1#11 ] 1000;|Y #1#11 [ 1999; #7#1 = #7#1 + #1#8; |FINSI;
|SI #1#11 ] 2000;|Y #1#11 [ 2999; #7#3 = #7#3 + #1#8; |FINSI;
|SI #1#11 ] 3000;|Y #1#11 [ 3999; #7#2 = #7#2 + #1#8; |FINSI;
#7#4 = #7#4 + #1#8;
|SI #1#14 = "S";|O #1#14 = "G";|O #1#14 = "I"; #7#5 = #7#5 + #1#8; |FINSI;
#7#6 = #7#4 - #7#5;
|FPRC;

|DEFBUCLE suma_t;
#1#1;
;
#0#0 , #0#1 ,   1;
#0#0 , #0#1 , 9999;
;
NULL , suma_to;
|FIN;

|PROCESO suma_tot;
|DDEFECTO #7;
|BUCLE suma_t;
|SI correcto = 0;
    |PUSHV 0501 2380;
    |PINPA #0#7;
    |PINDA #0#7;
    |ENDATOS #4#7;
    |POPV;
|FINSI;
#0#22 = #7#0;
#0#23 = #7#1;
#0#24 = #7#2;
#0#25 = #7#3;
#0#26 = #7#5;
#0#28 = #7#6;
|GRABA 021#0a;
|FPRC;

|PROCESO pondatos;
#21#3 = #0#11;
|ABRE #30;
#30#0 = #0#11;
|LEE 000#20=;
|LIBERA #30;
|CIERRA #30;
#21#4 = #30#1;
#21#5 = #0#3;
#21#14 = #0#0;
#21#15 = #0#1;
#21#20 = #30#20;
|FPRC;

|PROCESO sumaf;
|SI #1#14 = "N";
     |SI #1#11 ] 1; |Y #1#11 [ 999; ||\\ mano de obra;
          #21#19 = #21#19 + #1#8;
          #63#0 = #1#2;
          |LEE 000#63=;
          |SI FSalida ! 0; |DDEFECTO #63; |FINSI;
          tipo_iva = #63#5;
          |LIBERA #63;
     |FINSI;
     |SI #1#11 ] 1000; |Y #1#11 [ 1999; ||Piezas;
          #21#16 = #21#16 + #1#8;
          #11#0 = #1#2;
          |LEE 000#11=;
          |SI FSalida ! 0 ; |DDEFECTO #11; |FINSI;
          tipo_iva = #11#30;
          |LIBERA #11;
     |FINSI;
     |SI #1#11 ] 2000; |Y #1#11 [ 2999; || S.exte;
          #21#18 = #21#18 + #1#8;
          #66#0 = #1#2;
          |LEE 000#66=;
          |SI FSalida ! 0 ; |DDEFECTO #66; |FINSI;
          tipo_iva = #66#4;
          |LIBERA #66;
     |FINSI;
     |SI #1#11 ] 3000; |Y #1#11 [ 3999; ||lubricante;
          #21#17 = #21#17 + #1#8;
          #11#0 = #1#2;
          |LEE 000#11=;
          |SI FSalida ! 0 ; |DDEFECTO #11; |FINSI;
          tipo_iva = #11#30;
          |LIBERA #11;
     |FINSI;
     ||\\ EN FUNCION DEL TIPO DE IVA ACUMULAR EN BASE 1 O BASE 2
     enTiva = tipo_iva;
     efFiva = #1#22;
     |HAZ SacaIVA;
     |SI tipo_iva = 1;
          #21#7 = #21#7 + #1#8;
          #21#8 = tipo_iva;
          #21#9 = enIva;
     |SINO;
       |SI tipo_iva = 2;
          #21#26 = #21#26 + #1#8;
          #21#27 = tipo_iva;
          #21#28 = enIva;
       |SINO;  ||EXENTO
          #21#6 = #21#6 + #1#8;
       |FINSI;
     |FINSI;
|FINSI;
|SI #1#14 = "I";
     #21#25 = #21#25 + #1#8;
|FINSI;
|FPRC;

|DEFBUCLE suma_fac;
#1#1;
;
#0#0 , #0#1 ,   1;
#0#0 , #0#1 , 9999;
;
NULL , sumaf;
|FIN;

|PROCESO calcula_fac;
|ABRE #63;
|ABRE #66;
|ABRE #11;
|BUCLE suma_fac;
#21#10 = (#21#7 % #21#9) ! EURODB;
#21#29 = (#21#26% #21#28) ! EURODB;
|CIERRA #63;
|CIERRA #66;
|CIERRA #11;
|FPRC;

|PROCESO pon_VNVO;
|SI #0#7 = "VO";
     |ABRE #80;
     |SELECT #2#80;
     #80#2 = #0#0;
     #80#3 = #0#1;
     |LEE 121#80=;
     |SI FSalida = 0;
          #80#4 = #20#11;
          |GRABA 021#80a;
     |FINSI;
     |LIBERA #80;
     |CIERRA #80;
|SINO;
     |ABRE #65;
     |SELECT #2#65;
     #65#2 = #0#0;
     #65#3 = #0#1;
     |LEE 121#65=;
     |SI FSalida = 0;
          #65#4 = #20#11;
          |GRABA 021#65a;
     |FINSI;
     |LIBERA #65;
     |CIERRA #65;
|FINSI;
|FPRC;

|PROCESO crea_fra_standard;
          |ABRE #30;
          #30#0 = #0#11;
          |LEE 121#30=;
          |SI 0 = FSalida;
               cuenta_conta = #30#16;
          |SINO;
               cuenta_conta = "";
          |FINSI;

     |ABRE #55;
     |DDEFECTO #55;
     #55#14 = #21#0;
     #55#0 = #21#1;
     #55#1 = 1;
     #55#2 = #0#1;
     #55#15 = #0#0;
     |GRABA 001#55n;
     |LIBERA #55;
     |CIERRA #55;

     aMoneda = "B"
     aDivisa = "EUR";
     |HAZ Divisas134;

     |ABRE #56;
     |DDEFECTO #56;
     #56#49 = #21#0;
     #56#0 = #21#1;
     #56#1 = #21#2;
     #56#2 = #21#3;
     #56#3 = #21#4;
     #56#11 = #21#20;
     #56#12 = cuenta_conta;
     #56#14 = #30#22;    ||DIAS FIJOS DE PAGO
     #56#15 = #30#23;
     #56#16 = #30#24;

     #56#18 = #21#7 + #21#26+ #21#6;    ||Bruto
     #56#65 = #56#18;
     #56#88 = #56#18;

     #56#21 = #21#7; ||Base1
     #56#68 = #56#21;
     #56#91 = #56#21;

     #56#22 = #21#10; ||Cuota1
     #56#69 = #56#22;
     #56#92 = #56#22;

     #56#24 = #21#26;||Base2
     #56#71 = #56#24;
     #56#94 = #56#24;

     #56#25 = #21#29; ||Cuota2
     #56#72 = #56#25;
     #56#95 = #56#25;

     #56#29 = #21#10 + #21#29; ||T.IVAS
     #56#76 = #56#29;
     #56#99 = #56#29;

     #56#31 = #21#11; ||T.FAC
     #56#78 = #56#31;
     #56#101 = #56#31;

     #56#39 = #21#9;  ||%iva
     #56#41 = #21#28; ||%iva
     #56#47 = #21#6;  ||Exe.

     #56#58 = "EUR";
     #56#59 = 1;
     #56#60 = "B";
     #56#61 = "EUR";
     #56#62 = "1";
     #56#45 = "S";
     |GRABA 001#56n;
     |LIBERA #56;
     |CIERRA #56;
|FPRC;

|PROCESO crea_factura;
|ABRE #20;
|ABRE #67;
|PARA i = 0 ; |SI i [ 22; |HACIENDO i = i + 1;
#20i = #21i;
|SIGUE;
#20#23 = #21#26;
#20#24 = #21#27;
#20#25 = #21#28;
#20#26 = #21#29;
|SI #0#7 = "VN";|O #0#7 = "VO";
     #20#11 = #20#11 + #21#25;
|FINSI;
#67#0 = #20#0;
#67#1 = #20#1;
#67#2 = 1;
#67#3 = #0#0;
#67#4 = #0#1;
#67#5 = #20#6 + #20#7 + #20#23;
|GRABA 021#20n;
|GRABA 021#67n;
|LIBERA #20;
|LIBERA #67;
|CIERRA #20;
|CIERRA #67;
#0#15 = #20#0;
#0#16 = #20#1;
#0#17 = #20#2;
|GRABA 001#0a;
|HAZ crea_fra_standard;
|SI #0#7 = "VN";|O #0#7 = "VO";
          |HAZ pon_VNVO;
|SINO;
     |SI #20#11 ! 0;
           |HAZ actua_cliente;
     |FINSI;
|FINSI;
|FPRC;

|PROCESO resta_contador;
|FPRC;

|PROCESO CambiaFecha;
     |SI #21Campo ! Contenido;
          #21#6 = 0;
          #21#7 = 0;
          #21#10 = 0;
          #21#11 = 0;
          #21#12 = 0;
          #21#16 = 0;
          #21#17 = 0;
          #21#18 = 0;
          #21#19 = 0;
          #21#25 = 0;
          #21#26 = 0;
          #21#27 = 0;
          #21#29 = 0;
          |HAZ calcula_fac;
          |PINDA #0#21;
     |FINSI;
|FPRC;

|PROCESO factura;
     |DDEFECTO #21;
     |HAZ pondatos;

     |HAZ calcula_fac;
     |PUSHV 0501 2380;
     |PINPA #0#21;
     |PINDA #0#21;
     |C_M #21#0, 1, "S";
     |C_M #21#1, 1, "S";
     |C_M #21#2, 1, "S";
     |ENDATOS #1#21;
     |SI FSalida = 0; |Y #21#24 = "SI";
          |HAZ crea_factura;
          |CONFI "0000SDesea Imprimir Factura";
          |SI FSalida = 0;
                |HAZ imp_fra;
          |FINSI;
     |SINO;
          |MENAV "0000Factura no creada";
          |HAZ resta_contador;
     |FINSI;
|POPV;
|FPRC;


|PROCESO datosor;
|PUSHV 0501 2380;
|ABRE #85;
#85#0 = #0#0;
#85#1 = #0#1;
|LEE 101#85=;
|SI FSalida ! 0;
     |DDEFECTO #85;
     #85#0 = #0#0;
     #85#1 = #0#1;
     |PINPA #0#85;
     |ENDATOS #1#85;
     |SI FSalida = 0;
          |GRABA 101#85n;
     |FINSI;
|SINO;
     |PINPA #0#85;
     |PINDA #0#85;
     |ENDATOS #2#85;
     |SI FSalida = 0;
          |GRABA 101#85a;
     |FINSI;
|FINSI;
|LIBERA #85;
|CIERRA #85;
|POPV;
|FPRC;

|PROCESO clave;
    |HAZ pideclave;
    |SI alfa = "MOR ";
       |SI opcion = 1;
          |HAZ mano_obra;
       |SINO;
          |SI opcion = 2;
             |HAZ articulos;
          |SINO;
             |SI opcion = 3;
                  |HAZ ser_exter;
             |SINO;
                |SI opcion = 4;
                    |HAZ lubricant;
                |SINO;
                    |HAZ factura;
                |FINSI;
             |FINSI;
          |FINSI;
       |FINSI;
    |SINO;
       |MENAV "0000CLAVE INCORRECTA";
    |FINSI;
|FPRC;


|PROCESO tipo33; |TIPO 3;
     |SI nError = 1;
          nError = 0;
          |ACABA;
     |FINSI;
     serie_orden = #0#0;
     numero_orden = #0#1;
     |ABRE #85;
     #85#0 = #0#0;
     #85#1 = #0#1;
     |LEE 101#85=;
     |SI FSalida ! 0;
          |PUSHV 0502 2380;
          |DDEFECTO #85;
          #85#0 = #0#0;
          #85#1 = #0#1;
          |PINPA #0#85;
          |ENDATOS #1#85;
          |SI FSalida = 0;
               |GRABA 101#85n;
          |FINSI;
          |POPV;
     |FINSI;
     |LIBERA #85;
     |CIERRA #85;
     |SI correcto = 0;
     |DDEFECTO #2;
     correcto = 0;

     |HAZ Repinta0;
     |PARA; |SI correcto = 0; |HACIENDO;
          menu2 = opcion;
          |MENU menu;
          opcion = FSalida;
     ||     |DDEFECTO #2;
     ||     |ENDATOS #1#2;
          salida = FSalida;
               |SI opcion = 1;
                    |SI #0#16 = 0;
                        |HAZ mano_obra;
                    |SINO;
                         |MENAV "0000O.R. Ya cerrada. No admite modificaciones";
                         |HAZ clave;
                    |FINSI;
               |FINSI;
               |SI opcion = 2;
                    |SI #0#16 = 0;
                         |HAZ articulos;
                    |SINO;
                         |MENAV "0000O.R. Ya cerrada. No admite modificaciones";
                         |HAZ clave;
                    |FINSI;
               |FINSI;
               |SI opcion = 3;
                    |SI #0#16 = 0;
                         |HAZ ser_exter;
                    |SINO;
                         |MENAV "0000O.R. Ya cerrada. No admite modificaciones";
                         |HAZ clave;
                    |FINSI;
               |FINSI;
               |SI opcion = 4;
                    |SI #0#16 = 0;
                           |HAZ lubricant;
                    |SINO;
                         |MENAV "0000O.R. Ya cerrada. No admite modificaciones";
                         |HAZ clave;
                    |FINSI;
               |FINSI;
               |SI opcion = 5; |HAZ lineal; |FINSI;
               |SI opcion = 6;
                    correcto = 1;
                    |HAZ suma_tot;
               |FINSI;
               |SI opcion = 7; correcto = 0; |HAZ suma_tot; |FINSI;
               |SI opcion = 8; |HAZ datosor; |FINSI;
               |SI opcion = 9; |HAZ texto_reparacion; |FINSI;
               |SI opcion = 10;
                    correcto = 1;
                    |HAZ suma_tot;
                    |HAZ imp_parte;
                    correcto = 0;
               |FINSI;
               |SI opcion = 11; |HAZ cierra; |FINSI;
               |SI opcion = 12; |HAZ reabrir; |FINSI;
     |SIGUE;
     |FINSI;
     correcto = 0;
|FPRC;


|PROCESO observaciones;
          puente = #agifa024#53;     |QBF puente;
          |SI puente ! "";
               |PUSHV 0501 2380;
               |BLANCO 1008 1370;
               |CUADRO 1008 1370;
               |ATRI R;
               |PINTA 1110 , #agifa024#53;
               |ATRI 0;
               |PAUSA;
               |POPV;
          |FINSI;
|FPRC;


|PROCESO cierra;
     |SI #0#40 = 999999;
          aMensaje = "0000Orden ya cerrada previamente.";
          |MENAV aMensaje;
     |SINO;
          |SI #0#38 = "N";
               aMensaje = "0000Se va a proceder a cerrar el Presupuesto, sin generar O.R.";
               |MENAV aMensaje;
               aMensaje = "0000NEsta seguro de cerrar el Presupuesto?";
               |CONFI aMensaje;
               |SI FSalida = 0;
                    #0#40 = 999999;
                    |PINTA #0#40;
                    |GRABA 001#0a;
                    |LIBERA #0;
                    aMensaje = "0000Presupuesto Cerrado.";
                    |MENAV aMensaje;
               |FINSI;
          |SINO;
               aMensaje = "0000Orden ya adjudicada a una O.R., no se puede Cerrar.";
               |MENAV aMensaje;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO reabrir;
     |SI #0#40 = 999999;
          aMensaje = "0000NEsta seguro de reabrir el Presupuesto?";
          |CONFI aMensaje;
          |SI FSalida = 0;
               #0#40 = 0;
               |PINTA #0#40;
               |GRABA 001#0a;
               |LIBERA #0;
               aMensaje = "0000Presupuesto Reabierto.";
               |MENAV aMensaje;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO ClaveSec628;
|FPRC;

|PROCESO ClaveSec629;
|FPRC;

|PROCESO ClaveSec630;
|FPRC;

|PROCESO ClaveSec631;
|FPRC;

|PROCESO CogeSec628; |TIPO 7;
|FPRC;

|PROCESO CogeSec629; |TIPO 7;
|FPRC;

|PROCESO CogeSec630; |TIPO 7;
|FPRC;

|PROCESO CogeSec631; |TIPO 7;
|FPRC;

|PROCESO Matrip625; |TIPO 0;
     nTecla = FSalida;
     |ABRE #con00007;
     #con00007#0 = #0Campo;
     #con00007#1 = 1;
     |LEE 000#con00007.];
     |SI FSalida = 0; |Y #con00007#0 = #0Campo; |O nTecla = 11;
          eaMatricula = #0Campo;
          |SUB_EJECUTA_NP "con00007";
     |FINSI;
     |CIERRA #con00007;
|FPRC;
-------------------------------------
|PROCESO CanonArticulo;
     nSeccion = #1#23;
     nLin = 0;
     |DDEFECTO #11;
     |ABRE #11;
     #11#0 = #1#2;
     |LEE 020#11=;
     |CIERRA #11;

     |SI #11#168 = 0; |ACABA; |FINSI;

     #1#0 = #0#0;
     #1#1 = #0#1;
     #1#11 = 5999;
     |LEE 000#1];
     |SI FSalida ! 0;
           |LEE 001#1u;
     |SINO;
          |LEE 001#1a;
     |FINSI;
     |SI FSalida = 0; |Y #1#0 = #0#0; |Y #1#1 = #0#1;
               |Y #1#11 ] 4999; |Y #1#11 [ 5999;
          nLin = #1#11 + 1;
     |SINO;
          nLin = 5000;
     |FINSI;
     |DDEFECTO #1;
     #1#0 = #0#0;
     #1#1 = #0#1;
     #1#11 = nLin;

     #1#2 = "xxxxx";
     #1#3 = "CANON " + #5#1;
     #1#4 = #5#2;
     #1#5 = #11#168;
     #1#6 = 0;
     #1#7 = 0;
     #1#8 = #1#4  * #1#5;
     #1#9 = 5;
     #1#10 = #5#8
     #1#14 = #5#11;
     #1#23 = nSeccion;
     #1#27 = -1;
     #1#28 = #11#30;
     |GRABA 020#1n;
     enLinCanon = #1#11;
|FPRC;

|PROCESO CanonLubri;
     nSeccion = #1#23;

     |DDEFECTO #11;
     |ABRE #11;
     #11#0 = #1#2;
     |LEE 020#11=;
     |CIERRA #11;

     |SI #11#168 = 0; |ACABA; |FINSI;

     #1#0 = #0#0;
     #1#1 = #0#1;
     #1#11 = 5999;
     |LEE 000#1];
     |SI FSalida ! 0;
           |LEE 001#1u;
     |SINO;
          |LEE 001#1a;
     |FINSI;
     |SI FSalida = 0; |Y #1#0 = #0#0; |Y #1#1 = #0#1;
               |Y #1#11 ] 4999; |Y #1#11 [ 5999;
          nLin = #1#11 + 1;
     |SINO;
          nLin = 5000;
     |FINSI;
     |DDEFECTO #1;
     #1#0 = #0#0;
     #1#1 = #0#1;
     #1#11 = nLin;

     #1#2 = "xxxxx";
     #1#3 = "CANON " + #6#1;
     #1#4 = #6#2;
     #1#5 = #11#168;
     #1#6 = 0;
     #1#7 = 0;
     #1#8 = #1#4  * #1#5;
     #1#9 = 5;
     #1#10 = #6#8
     #1#14 = #6#11;
     #1#23 = nSeccion;
     #1#27 = -1;
     #1#28 = #11#30;
     |GRABA 020#1n;
     enLinCanon = #1#11;
|FPRC;
