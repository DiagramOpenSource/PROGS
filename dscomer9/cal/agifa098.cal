|FICHEROS;
     agifa071 #0;   || Lineas de albaran/abono
     agifa010 #1;   || Albaranes
     agifa019 #2;   || Articulos
     agifa098 #3;   || Pantalla de adjudicacion
     agifa027 #4;
     agifa024 #6;   || Clientes
     agifa017 #8;   || Stocks almacenes
     agifa104 #9;   || Pedidos
     agifa073 #10;  || Lineas de Pedidos
     agifa007 #21;  || Series.
     agifa142 #97;  || Parametros generales.
     tmp00010 #100; || Temporal albaranes(C).
     tmp00071 #101; || Temporal albaranes(L).
     agifa321 #35;  || Parametros de Divisas
     agifa328 #36;  || Clientes/Divisas
     agifa329 #37;  || Lineas de Clientes/Divisas
     agifa324 #38;  || Divisas
     dsm00004 #904;
     dsm00005 #905;
     dsm00010 #910;
     dsm00046 #946;
     dsm00047 #947;
     tmpmarhu #300; || Auxiliar Para Modulo Maruenda.
     dsm00114 #114;

     dsm00020 #20;

     dsm00024 #24; || Art/Alma/Part
     dsw00083 #83; || Ordenacion Art/Alma/Part
     tempo036 #150;
     dsm00279 #279;

     refere0@;
     refere1@;
     tagm0056@;
     tlfm0001@;
     tlfm0019@;
|FIN;

|VARIABLES;
     &eaSerPed = "";
     &enNumPed = 0;
     nSwJamaica = 0;
     aCliDefe = "";
     nSwGofre = 0;
     nImpRiesgo = 0;
     nSwChampiEmar = 0;
     nSwRieTaglo = 0;
     nPriTaglo = 0;
     &enInfoAge = 0;
     &enInfoBul = 0;
     &enInfoPes = 0;
     &eaInfoFac = "";
     nSwEvaristo = 0;
     nSwGestral = 0;
     nSwInforpor = 0;
     nSwTecatel = 0;
     nSwCongecar = 0;
     nSwFeldo = 0;
     nSwSematel = 0;
     nSwInforAlba = 0;
     nSwOrts = 0;
     nSwWeb = 0;
     nSwAlbero = 0;
     nSwQDClor = 0;
     aRepre = "";
     aDef = "";
     aPath = "";
     nUni = 0;
     nEsta = 0;
     nSwDesach = 0;
     &eaRepreAdj = "";
     nSwPasa = 0;
     nSwTaller = 0;
     &enNumAlbAnt = 0;
     nSwOk = 0;
     nSwSirve = 0;
     Tmp150 = "";
     nTagLinOrgPos = 0;
     nTagIncPos = 0;
     nTagLinPos = 0;
     aTagDesPos = "";
     nSali = 0;
     nTagDocPos = 0;
     &enTagAgen = 0;
     nSwTagloma = 0;
     nSwMecanogra = 0;
     &enUniTagRes = 0;
     nUniAsig = 0;
     nUnidades = 0;
     aPartida = "";
     aTmp83 = "";
     &eaFecAlb = "";
     &eaSerAlb = "";
     &enNumAlb = 0;
     &eaSerPedido = "";
     &enNumPedido = 0;
     nImporDescue1 = 0;
     nImporDescue2 = 0;
     nImporDescue3 = 0;
     nImporMoneda1 = 0;
     nImporMoneda2 = 0;
     nBrutoMoneda1 = 0;
     nBrutoMoneda2 = 0;
     &Tempo = "";
     aTmpMarhu = "";
     nLinV           = 0;
     &eaSer1         = "";
     &enDocu1        = 0;
     nLinea          = 0;
     &aTempo300      = "";
     nSal            = 0;
     canmar          = 0;
     swparrilla      = 0;
     nCalc           = 0;
     nVic            = 0;
     nVic2           = 0;
     aFich           = "";
     aParam          = "";
     &nRieTotal      = 0;
     &nRieUtili      = 0;
     &aRieBloqu      = "";
     &aBloquead      = "";
     &eaTag          = "";
     &nImpo          = 0;
     nMult           = 0;
     &enSwMenu       = 0;
     &enConta        = 0;
     aExporNegro     = 0;
     nNume           = 0;
     imneto          = 0;
     margen          = 0;

     &enCodAlbNegro  = 0;

     aSerAlbBlanco   = "";
     nCodAlbBlanco   = 0;
     nCodAlb         = 0;
     nPorce          = 0;
     nPorceT         = 0;
     nCanti          = 0;
     nCanti2         = 0;
     nAcumula        = 0;
     nReparto        = 0;
     nEntero         = 0;
     nTotalBlanco    = 0;
     nTotalNegro     = 0;
     nTCantiBlanco   = 0;
     nCantiBlanco    = 0;
     nCantiBlanco2   = 0;
     nMasMenos       = 0;
     aAlfa           = "";
     aAlfa1          = "";
     aAlfa2          = "";

     &nDeci_Base     = 0;   || Decimales en Totales de la moneda base
     &nDeci_PreBase  = 0;   || Decimales en el Precio en moneda base
     &nDeci_BaseMx   = 0;   || Decimales en Totales de la moneda base (Maxima precision)
     &nDeci_PreBaseMx= 0;   || Decimales en el Precio en moneda base (Maxima precision)
     &nDeci_Div      = 0;   || Decimales en Totales de la divisa
     &nDeci_PreDiv   = 0;   || Decimales en el Precio en divisa
     &nDeci_TotVis   = 0;   || Decimales en Totales visibles (el de la moneda de trabajo)
     &nDeci_TotNoVis = 0;   || Decimales en Totales no visibles (el de la otra moneda)
     &nDeci_PreVis   = 0;   || Decimales en el Precio visual. (lineas)
     &nDeci_ImpVis   = 0;   || Decimales en el Importe visual. (lineas)
     &nDeci_BaseMxP  = 0;   || Decimales en Totales de la moneda base (Maxima precision)
     &nDeci_PreBasMxP= 0;   || Decimales en el Precio en moneda base (Maxima precision)
     &nDeci_DivP     = 0;   || Decimales en Totales de la divisa
     &nDeci_PreDivP  = 0;   || Decimales en el Precio en divisa
     &nDeci_TotVisP  = 0;   || Decimales en Totales visibles (el de la moneda de trabajo)
     &nDeci_TotNoVisP= 0;   || Decimales en Totales no visibles (el de la otra moneda)
     &nDeci_PreVisP  = 0;   || Decimales en el Precio visual. (lineas)
     &nDeci_ImpVisP  = 0;   || Decimales en el Importe visual. (lineas)
     nfecha    = 0;
     &ac_divisa = "N";   || Vale "S" cuando las divisas en ventas estan
                         || activadas y la serie es de divisas
     &pintado = 0;       || Sirve para controlar los pintados de las lineas
     &decim_divisa = 0;  || Decimales de la divisa
     &precio_divisa = 0; || Decimales del precio en divisa
     &decim_base = 0;    || Decimales de la moneda base
     &precio_base = 0;   || Decimales del precio en moneda base
     div_act = 0;        || Divisa actualizada. Me sirve en un PARA para que
                         || no salga hasta que este actualizada (div_act=1)
     &cli_divisa = "";   || Codigo de Cliente. Se pasa a CLIENTES/DIVISAS
     &divisa = "";       || Codigo de Divisa. Se pasa a ACTUAL. de DIVISAS
     nModo210 = 0;
     seriei_a       = "";
     seriei_b       = "";
     seriet         = "";
     asto           = 0;
     totalba        = 0;
     cantidad       = 0;
     minimo         = 0;
     almacen        = 0;
     mensajeri = "0000Se supera el Riesgo Limite del cliente";
     modo           = 0;
     tf             = 0;
     fmes           = "  ";
     mes            = 0;
     hacer          = 0;
     fiac           = "  ";
     i              = 0;
     entro          = 0;
     clave          = "valbaran";
     ncontador      = 0;
     entrar         = 0;
     mascara        = "0000000";
     tempo          = " ";
     filtro         = "-106";
     codigo         = "  ";
     r1             = "  ";
     f1             = "  ";
     totbu          = 0;
     cant           = 0;
     sw             = 0;
     fecent         = @;
     fecped         = @;
     a              = 0;
     b              = 0;
     operainte      = "";
     origen         = "";
     destino        = "";
     conta_a        = "";
     conta_b        = "";
     empresa        = "";
     ind            = 0;
     alfa           = "";
     precio         = 0;
     neto           = 0;
     iva            = 0;
     fp             = "";
     sblanco        = "";
     swd            = 0;
     ser_ant        = "";
     num_ant        = "";
     serie          = "";
     numero         = "";
     importe        = 0;
     importeD       = 0;
     fFecha = @;
     aFecha = "";
     aAny = "";
     nImpDiv        = 0;
     aGuarda6 = "";
     aWget = "";
     aUrl = "";
|FIN;

|INCLUYE i_varart;

|PROCESO ChampiEmarPorte;
     |DDEF aAlfa;
     aAlfa = aAlfa + "champi14";
     |CARGA_DEF aAlfa, refere1@;
     |SI FSalida = 0;
          |ABRE #refere1@;
          #refere1@#0 = #9#25;
          #refere1@#1 = #9#0;
          |LEE 101#refere1@.=;
          |SI FSalida ! 0; |DDEFECTO #refere1@; |FINSI;

          #1#11 = #refere1@#2;     ||Portes
          #1#81 = #refere1@#2;

          |CIERRA #refere1@;
          |DESCARGA_DEF #refere1@;
     |FINSI;
|FPRC;

|PROCESO OrtsAlbConsumo;
     |DDEF aAlfa;
     aAlfa = aAlfa + "ortsm035";
     |CARGA_DEF aAlfa, refere1@;
     |SI FSalida = 0;
          |HORA aAlfa;
          |ABRE #refere1@;
          #refere1@#0 = #0#29;
          #refere1@#1 = #0#0;
          #refere1@#2 = #0#1;
          |LEE 101#refere1@.=;
          |SI FSalida ! 0; |GRABA 020#refere1@.b; |FINSI;
          #refere1@#3 = ~;
          #refere1@#4 = aAlfa;
          #refere1@#5 = #0#31;
          #refere1@#6 = #0#12;
          #refere1@#7 = #0#21;
          #refere1@#8 = "A";
          #refere1@#9 = "N";
          |GRABA 020#refere1@.a;
          |CIERRA #refere1@;
          |DESCARGA_DEF #refere1@;
     |FINSI;
|FPRC;

|PROCESO TagModiFabri;
     |DDEF aAlfa;
     aAlfa = aAlfa + "tagm0079";
     |CARGA_DEF aAlfa, refere1@;
     |SI FSalida = 0;
          |ABRE #refere1@;
          #refere1@#0 = #0#31;
          #refere1@#1 = #0#12;
          |LEE 101#refere1@.=;
          |SI FSalida = 0;
               |SI #refere1@#4 = "S";
                    |SI #refere1@#19 = "X"; |O #refere1@#19 = "P";
                              |O #refere1@#19 = "I";
                         #refere1@#19 = "A";
                    |FINSI;
               |FINSI;
               |SI #refere1@#5 = "S";
                    |SI #refere1@#20 = "X"; |O #refere1@#20 = "P";
                              |O #refere1@#20 = "I";
                         #refere1@#20 = "A";
                    |FINSI;
               |FINSI;
               |SI #refere1@#6 = "S";
                    |SI #refere1@#21 = "X"; |O #refere1@#21 = "P";
                              |O #refere1@#21 = "I";
                         #refere1@#21 = "A";
                    |FINSI;
               |FINSI;
               |GRABA 020#refere1@.a;
          |FINSI;
          |CIERRA #refere1@;

          |DESCARGA_DEF #refere1@;
     |SINO;
          |MENAV "0000Error al cargar 'tagm0079'...";
     |FINSI;
|FPRC;

|PROCESO GofrePalet;
     |DDEF aPath;
     aAlfa = aPath + "gofrem01";
     |CARGA_DEF aAlfa, refere0@;
     |SI FSalida = 0;
          |ABRE #refere0@; |LEE 000#refere0@.p; |CIERRA #refere0@;
          aCliDefe = #refere0@#2;
          |DESCARGA_DEF #refere0@;
     |FINSI;

     aAlfa = aPath + "gofrem03";
     |CARGA_DEF aAlfa, refere0@;
     |SI FSalida = 0;
          aAlfa = aPath + "gofrem04";
          |CARGA_DEF aAlfa, refere1@;
          |SI FSalida = 0;
               |ABRE #refere0@;
               |ABRE #refere1@;
               #refere1@#0 = #0#29;
               #refere1@#1 = #0#0;
               #refere1@#2 = #0#1;
               |LEE 000#refere1@.=;
               |SI FSalida ! 0; |GRABA 020#refere1@.b; |FINSI;
               #refere1@#3 = #0#1;

               #refere0@#0 = #1#3;
               #refere0@#1 = #0#2;
               |LEE 000#refere0@.=;
               |SI FSalida ! 0;
                    #refere0@#0 = aCliDefe;
                    |LEE 000#refere0@.=;
               |FINSI;
               |SI FSalida = 0;
                    #refere1@#4 = #0#5 / (#refere0@#2 * #refere0@#3);
                    #refere1@#5 = #0#5 / (#refere0@#3 * #refere0@#4);
                    #refere1@#6 = #0#5 / #refere0@#4;
               |FINSI;
               |GRABA 020#refere1@.a;
               |CIERRA #refere1@;
               |CIERRA #refere0@;
               |DESCARGA_DEF #refere1@;
          |FINSI;
          |DESCARGA_DEF #refere0@;
     |FINSI;
|FPRC;

|PROCESO ChampiEmarEnv;
     |DDEF aPath;
     aAlfa = aPath + "champi10";
     |CARGA_DEF aAlfa, refere0@;
     |SI FSalida = 0;
          aAlfa = aPath + "champi04";
          |CARGA_DEF aAlfa, refere1@;
          |SI FSalida = 0;
               |ABRE #refere0@;
               #refere0@#0 = #10#28;
               #refere0@#1 = #10#0;
               #refere0@#2 = #10#1;
               |LEE 000#refere0@.=;
               |SI FSalida ! 0; |DDEFECTO #refere0@; |FINSI;
               |CIERRA #refere0@;

               |ABRE #refere1@;
               #refere1@#0 = #0#29;
               #refere1@#1 = #0#0;
               #refere1@#2 = #0#1;
               |LEE 000#refere1@.=;
               |SI FSalida ! 0; |GRABA 020#refere1@.b; |FINSI;
               |SI #0#5 = #10#5;
                    #refere1@#3 = #refere0@#3;
                    #refere1@#5 = #refere0@#5;
                    #refere1@#4 = #refere0@#4;
                    #refere1@#6 = #refere0@#6;
               |SINO;
                    #refere1@#3 = #0#5 * #refere0@#3 / #10#5;
                    #refere1@#5 = #refere1@#3 * (#refere0@#5/#refere0@#3);
                    #refere1@#4 = #0#5 + #refere1@#5;
                    #refere1@#6 = #refere0@#6;
               |FINSI;
               |GRABA 020#refere1@.a;
               |CIERRA #refere0@;

               |DESCARGA_DEF #refere1@;
          |SINO;
               |MENAV "0000Error al cargar 'champi004'...";
          |FINSI;
          |DESCARGA_DEF #refere0@;
     |SINO;
          |MENAV "0000Error al cargar 'champi010'...";
     |FINSI;
|FPRC;

|PROCESO Cero;
     entro = 0;
|FPRC;

|PROCESO clicon;
/*   Tue Apr 15 10:53:20 CEST 2008

     |SI #10#43 = #10#5;  |ACABA;  |FINSI;
*/
     nSwOk = 0;

     #9#25 = #10#28;
     #9#0 = #10#0;
     |LEE 000#9=;

     swparrilla = 0;
     |HAZ parrilla;
     |SI swparrilla = 0; nSwOk = 1; |ERROR; |ACABA; |FINSI;

     |SI #6#0 ! #10#20;     || #clientes#codigo ! #lineas de pedido#cliente
         |ABRE #6;          || Fichero clientes
         #6#0 = #10#20;     || cargo clave
         |LEE 021#6=;
         |CIERRA #6;
     |FINSI;

     ||---Comprobacion Zona.
     |SI #6#3 < #3#47; |O #6#3 > #3#48; nSwOk = 1; |ERROR; |ACABA; |FINSI;
     ||ÄÄÄDir Entrega
     |SI #9#57 < #3#49; |O #9#57 > #3#50; nSwOk = 1; |ERROR; |ACABA; |FINSI;
     ||ÄÄÄAgencia
     |SI #9#60 < #3#51; |O #9#60 > #3#52; nSwOk = 1; |ERROR; |ACABA; |FINSI;

     ||ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ Control Riesgo Cliente.
     eaSerie = #10#28; eaTag = "PE";  |HAZ SacaRiesgo;
     |SI #agifa142#6 = "S";
          |SI nRieUtili ] nRieTotal;  |Y nRieTotal ! 0;
               mensajeri = "0000Riesgo Limite superado del cliente [" + #6#0 + "] ...";
               |MENSA mensajeri;
               |SI #agifa142#22 = "S";|O #agifa142#22 = "P";
                    |AVISO;
                    |BLIN 4;
                    |SI #agifa142#22 = "P";   || Avisa y para
                         nSwOk = 1; |ERROR;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
     |SI aRieBloqu = "S";
          |SI nSwTagloma = 0; |Y enNumPedido ! 0;
               |SI nPriTaglo = 0;
                    |HAZ BloqCart;
                    nSwOk = 1;
                    |HAZ CtrlRiesgoTaglo;
                    |SI nSwOk = 1; |ERROR; |FINSI;
               |SINO;
                    nSwOk = nSwRieTaglo;
                    |SI nSwOk = 1; |ERROR; |FINSI;
               |FINSI;

          |SINO;    || la estandar
               |HAZ BloqCart;
               nSwOk = 1;
               |ERROR;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO actpf;|TIPO 0;
     cant = #1#15 < #1#5;
     cant = cant < #1#32;
     cant = cant < #1#7;

     |ABRE #6;
     #6#0 = #1#3;
     |LEE 121#6=;
     |SI FSalida = 0;
         #6#50 = #6#50 + cant;
         |GRABA 020#6a;
         |LIBERA #6;
     |FINSI;
     |CIERRA #6;
     enImpCliPen = cant;
     eaCliente = #1#3;
     efFecha = #1#1;
     |HAZ AcumulaCli;
|FPRC;

|PROCESO finadju;|TIPO 0;
     |SI entro ! 0;
          |SI nSwJamaica = 0;
               |HAZ AdjJamaica;
          |FINSI;
          |SI nSwTagloma = 0;
               eaAlfa = #1#52;
               |HAZ TagloDefFP;
               |SI eaAlfa ! ""; #1#8 = eaAlfa; |FINSI;
               |SI eaQuitaDto = "S";
                    #1#5 = 0;
                    #1#32 = 0;
                    #1#7 = 0;
               |FINSI;
               eaSerAlb = #1#52;
               enNumAlb = #1#0;
               |SUB_EJECUTA_NP "tagz0027;ADJ";
          |FINSI;
          |SI nSwGestral = 0;
               eaAlfa = #1#52;
               |HAZ GestrDefFP;
               |SI eaAlfa ! ""; #1#8 = eaAlfa; |FINSI;
               |SI eaQuitaDto = "S";
                    #1#5 = 0;
                    #1#32 = 0;
                    #1#7 = 0;
               |FINSI;
          |FINSI;

          |HAZ actpf;
          |HAZ grabaalba;
          |LIBERA #9;


          /* antes estaba por linea */
          nImpo = nImpRiesgo;
          eaTag = "PAU";  |HAZ Riesgos;
          nImpRiesgo = 0;
     |FINSI;
|FPRC;

|PROCESO tot_ped_div;
     |SI #9#37 = "B";  || Asigna campos visual. y no visual. en el pedido segun la moneda de trabajo
         #9#45 = #9#11;
         #9#46 = #9#12;
         #9#47 = #9#13;
         #9#48 = #9#42;
         #9#50 = #9#43;
         #9#49 = #9#44;
     |SINO;
         #9#45 = #9#42;
         #9#46 = #9#43;
         #9#47 = #9#44;
         #9#48 = #9#11;
         #9#50 = #9#12;
         #9#49 = #9#13;
     |FINSI;
|FPRC;

|PROCESO grabaalba;|TIPO 0;
     |PATH_DAT #1 origen;
     |HAZ tot_ped_div;

     |GRABA 020#1a;
     |LIBERA #1;

     |SI nSwWeb = 0;
          |HAZ DocWeb;
     |FINSI;

     ||ÄÄÄÄÄÄÄÄÄÄÄÄAutomatizacion Empresas
     |ABRE #dsm00114; |LEE 000#dsm00114.p; nSal = FSalida; |CIERRA #dsm00114;
     |SI nSal = 0;
          eaCli = #1#3;
          aAlfa = "dsz99983;ALBALTA" + #1#52 + (("000000" + #1#0) % -106);
          |SUB_EJECUTA aAlfa;
     |FINSI;

     ||ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
     |SI nSwInforAlba = 0;
          eaSerie = #1#52;
          enCodigo = #1#0;
          |SI enNumPedido = 0;
               |SUB_EJECUTA_NP "ialbz005;NOIMP";
          |SINO;
               |SUB_EJECUTA_NP "ialbz005";
          |FINSI;
     |FINSI;

     |SI #1#85 = "E";
         |HAZ DesgloNegro;
     |FINSI;
|FPRC;

|PROCESO LeeMonBase4; ||Lee los parametros de la moneda base
     |ABRE #agifa321;
     |ABRE #agifa324;
     |LEE 010#agifa321.p;   ||Leo parametros de divisa
     #agifa010#73 = #agifa321#9;  ||Cojo la Moneda Base de parametros
     #agifa324#0 = #agifa321#9;
     |LEE 010#agifa324.=;         ||Leo la ficha de la moneda base en Divisas
     #agifa010#74 = #agifa324#2;  ||Asigno el cambio de la moneda base con el euro
     decim_base = #agifa324#7;    ||Asigno los decimales de la moneda base
     precio_base = #agifa324#9;   ||Asigno los decimales del precio en la mon. base
     |CIERRA #agifa324;
     |CIERRA #agifa321;
|FPRC;

|PROCESO Param_Divisas4; |TIPO 0;
     |ABRE #agifa324;
     #agifa324#0 = #agifa010#68;
     |LEE 001#agifa324.=;   || Leo la divisa
     |CIERRA #agifa324;

     decim_divisa = #agifa324#7;  || Decimales de la divisa
     precio_divisa = #agifa324#9;  || Decimales en el precio de la divisa
     nDeci_Div = decim_divisa;   || Decimales de la divisa
     nDeci_PreDiv = precio_divisa;  || Decimales en el precio de la divisa
     nDeci_DivP = decim_divisa;   || Decimales de la divisa
     nDeci_PreDivP = precio_divisa;  || Decimales en el precio de la divisa
     |SI #1#70 = "B";   || Si trabajo con la moneda base ...
         nDeci_Base     = decim_base;
         nDeci_PreBase  = precio_base;
         nDeci_PreVis   = precio_divisa;
         nDeci_ImpVis   = decim_divisa;
         nDeci_BaseMx   = decim_base;
         nDeci_PreBaseMx= precio_base;
         nDeci_TotVis   = decim_base;
         nDeci_TotNoVis = decim_divisa;
         nDeci_PreVisP  = precio_divisa;
         nDeci_ImpVisP  = decim_divisa;
         nDeci_BaseMxP  = decim_base;
         nDeci_PreBasMxP= precio_base;
         nDeci_TotVisP  = decim_base;
         nDeci_TotNoVisP= decim_divisa;
     |SINO;     || Si trabajo con la divisa ...
         nDeci_Base     = decim_base; || Max. precision en los decimales de la moneda base
         nDeci_PreBase  = precio_base;  || Max. precision en los dec. del precio de la moneda base
         nDeci_PreVis   = precio_base;
         nDeci_ImpVis   = decim_base;
         |SI #1#69 = 1;
              nDeci_BaseMx    = decim_base;    || sin triangulacion
              nDeci_PreBaseMx = precio_base;
         |SINO;
              nDeci_BaseMx    = #agifa321#10;  || con triangulacion
              nDeci_PreBaseMx = #agifa321#11;
         |FINSI;
         nDeci_TotVis   = decim_divisa;
         nDeci_TotNoVis = decim_base;
         nDeci_PreVisP  = precio_base;
         nDeci_ImpVisP  = decim_base;
         |SI #1#69 = 1;
              nDeci_BaseMxP   = decim_base;    || sin triangulacion
              nDeci_PreBasMxP = precio_base;
         |SINO;
              nDeci_BaseMxP   = #agifa321#10;  || con triangulacion
              nDeci_PreBasMxP = #agifa321#11;
         |FINSI;
         nDeci_TotVisP  = decim_divisa;
         nDeci_TotNoVisP= decim_base;
     |FINSI;
     |HAZ Deci_IVA;
|FPRC;

|PROCESO CambioDivisa4; |TIPO 0;
     |SI #agifa024#191 = "S"; || Si el cliente es de divisa pactada
         |ABRE #agifa328;
         |ABRE #agifa329;
         #agifa329#0 = #agifa010#3;
         #agifa329#2 = #agifa010#68;
         #agifa329#7 = "N";
         |SELECT #2#agifa329;  || Con esta clave ...
         |LEE 011#agifa329.=;  || ... busco periodos no finalizados de esa divisa
         |SI FSalida = 0;  || Si existe un periodo no finalizado
            |PARA div_act = 0; |SI div_act = 0; |HACIENDO;
                  #agifa010#69 = #agifa329#3;        || ...y el cambio
                  |LEE 001#agifa329.=;   || Leo las lineas de Clientes/Divisas
                  nfecha = #agifa010#1 - #agifa329#6;  || Resto la fecha de fin de periodo a la actual
                  |SI nfecha > 0;  || Si la fecha actual supera a la del periodo asignado ...
                      |MENAV "0000ATENCION deberia Actualizar primero la divisa en Clientes/Divisas";
                      cli_divisa = #agifa010#3;  || Le envio el cod. de cliente a "agifa328"
                      |SUB_EJECUTA_NP "agifa328.tab";  || Ejecuto Clientess/Divisas
                      |ERROR;
                  |SINO;
                      div_act = 1;  || Para salir del PARA
                  |FINSI;
            |SIGUE;
        |SINO;  || Si no existe un periodo no finalizado para esa divisa
           |MENAV "    No existe un periodo activo para la divisa en Clientes / Divisas";
           cli_divisa = #agifa010#3;  || Le paso a "agifa328" el cliente
           |SUB_EJECUTA_NP "agifa328.tab";  || Ejecuto Clientes / Divisas
           |ERROR;
        |FINSI;
        |SELECT #1#agifa329;
        |CIERRA #agifa329;
        |CIERRA #agifa328;
     |SINO; || Si el Cliente no es de Divisa pactada ...
        |ABRE #agifa324; || ...miro directamente en divisas
        #agifa324#0 = #agifa010#68;
        |LEE 001#agifa324.=;
        |SI FSalida = 0; ||Si existe la divisa...
            #agifa010#69 = #agifa324#2; || la recojo
            |SI #agifa324#5 ! -1; || Si los dias de margen de actualizacion no
                               || son = -1 (indefinidos)
               |PARA div_act = 0; |SI div_act = 0; |HACIENDO;
                     #agifa010#69 = #agifa324#2;        ||Cargo el valor del cambio
                     |LEE 001#agifa324.=;  || Leo la divisa
                     nfecha = #agifa010#1 - #agifa324#4;
                     |SI nfecha > #agifa324#5; |Y #agifa324#5 ! -1;  || Si la fecha actual
                         |MENAV "0000ATENCION deberia Actualizar primero la divisa";
                         divisa = #agifa010#68;
                         |SUB_EJECUTA_NP "agifa326.tab";
                         |ERROR;
                     |SINO;
                         div_act = 1;
                     |FINSI;
               |SIGUE;
            |FINSI;
        |FINSI;
        |CIERRA #agifa324;
     |FINSI;
     |HAZ Param_Divisas4;
|FPRC;

|PROCESO contador;|TIPO 0;
     |DFICE origen;                || ME ASEGURO QUE TIENE EL PATH CORRECTO.
     |PATH_DAT #4 origen;          || CAMINO DE LA EMPRESA DE TRABAJO.

     |SI #3#9 = "*****";
         eaSerie = #10#28;
     |SINO;
         eaSerie = #3#9;
     |FINSI;
     enSwMenu = 1;
     |HAZ ContaADJ;
     codigo = enCodigo;
|FPRC;

|PROCESO FeldoPortes;
     |DDEF aAlfa;
     aAlfa = aAlfa + "feldo001";
     |CARGA_DEF aAlfa, refere0@;
     |SI FSalida = 0;
          |ABRE #refere0@;
          |SELECT #2#refere0@;
          #refere0@#2 = #9#25;
          #refere0@#3 = #9#0;
          |LEE 000#refere0@.=;
          |SI FSalida = 0;
               #1#81 = #refere0@#4;
               #1#11 = #refere0@#4;
               #1#12 = #refere0@#5;

               aGuarda6 = #3#6;
               #3#6 = "N";
          |SINO;
               #3#6 = aGuarda6;
          |FINSI;
          |CIERRA #refere0@;
          |DESCARGA_DEF #refere0@;
     |SINO;
          |MENAV "0000Error al cargar 'feldo001'";
     |FINSI;
|FPRC;

|PROCESO creacabe;|TIPO 0;
     |ABRE #6;
     #6#0 = #9#4;
     |LEE 000#6=;
     |CIERRA #6;

     alfa = #1#0;
     |QBF alfa;
     |DDEFECTO #1;
     #1#4  = #9#8;
     #1#3  = #9#4;
     #1#5  = #9#5;
     #1#7  = #9#6;
     #1#32 = #9#17;
     |SI eaRepreAdj = "";
          #1#6  = #9#7;
     |SINO;
          #1#6  = eaRepreAdj;
     |FINSI;
     #1#8  = #9#9;
     #1#35 = #9#18;
     #1#31 = #9#20;
     #1#33 = #9#21;
     #1#36 = #9#22;
     #1#40 = #9#23;
     #1#34 = #9#16;
     #1#29 = #9#19;
     #1#30 = #9#14;
     #1#50 = #6#40;
     #1#55 = #9#53;
     #1#56 = #9#54;
     #1#57 = #9#55;
     #1#62 = #9#59;
     #1#63 = #9#64;
     aAlfa = #1#63; |QBF aAlfa;
     |SI aAlfa = "";
          #1#63 = #6#15;
     |FINSI;

     #1#64 = #9#61;
     #1#68 = #9#35; ||DIVISA
     #1#69 = #9#36; ||CAMBIO
     #1#70 = #9#37; ||MONEDA DE TRABAJO
     #1#73 = #9#40; ||MONEDA BASE
     #1#74 = #9#41; ||CAMBIO MON. BASE
     #1#83 = #9#51;
     #1#84 = #9#57; || Dir Ent.
     #1#91 = #6#206;
     #1#97 = #9#15;

     |SI nSwFeldo = 0;
          |HAZ FeldoPortes;
     |FINSI;

     |SI nSwTagloma = 0;
          #9#60 = enTagAgen;
     |FINSI;
     |SI nSwInforpor = 0;
          #9#60 = enInfoAge;
          #1#2 = enInfoBul;
          #1#55 = enInfoPes;
          #1#40 = eaInfoFac;
     |FINSI;

     |ABRE #20;
     #20#0 = #9#60;
     |LEE 000#20=;
     |CIERRA #20;
     #1#88 = #20#0; ||Agencia
     #1#9 = #20#1;

     |HAZ LeeMonBase4;
     |HAZ CambioDivisa4;

     |SI #3#12 = "E";
          #1#1 = fecent;
     |SINO;
          |SI #3#12 = "P";
               #1#1 = fecped;
          |SINO;
               #1#1 = #3#13;
          |FINSI;
     |FINSI;

     |SI enNumAlbAnt ! 0;     || Llamado por dsz00067, a¤ade al albaran
          #1#52 = eaSerAlb;
          #1#0 = enNumAlbAnt;
          |LEE 121#1=;
     |SINO;
          |PARA FSalida = 1;|SI 0 ! FSalida;|HACIENDO FSalida = FSalida;
                |HAZ contador;
                #1#0 = codigo;
                |SI #3#9 = "*****";
                    #1#52 = #10#28;
                |SINO;
                    #1#52 = #3#9;
               |FINSI;
               |GRABA 000#1b;
          |SIGUE;
     |FINSI;

     |ABRE #21;
     #21#26 = #1#52;
     |LEE 000#21=;
     |CIERRA #21;
     #1#51 = #21#28;

     |SI nSwTecatel = 0;
          eaSer1 = #1#52;
          enDocu1 = #1#0;
          eaTipo = "PE";
          eaSer = #9#25;
          enDocu = #9#0;
          |HAZ TecaTransPeAb;
     |FINSI;

     |SI nSwCongecar = 0;
          #1#13 = #6#167;
          #1#82 = #6#167;
     |FINSI;
     |SI nSwOrts = 0;
          |HAZ OrtsRepreCab;
     |FINSI;
     |SI nSwChampiEmar = 0;
          |HAZ ChampiEmarPorte;
     |FINSI;

     |HAZ LimCabAgifa010;
|FPRC;

|PROCESO riesgo_cli;
     eaTag = "AV";  |HAZ Riesgos;
|FPRC;

|PROCESO LineasKit;
     |DDEFECTO #947;
     #947#0 = #0#29;
     #947#1 = #0#0;
     #947#2 = #0#1;
     #947#3 = #946#3;
     #947#4 = #946#4;
     #947#5 = #946#5;
     #947#6 = #946#6;
     #947#7 = #946#7;
     #947#8 = #946#8;
     #947#9 = #946#9;
     #947#10 = #946#10;
     #947#11 = #946#11;
     #947#12 = #946#12;
     |GRABA 020#947n;
|FPRC;

|DEFBUCLE LineasKit;
     #946#1;
     ;
     #10#28, #10#0, #10#1, 001;
     #10#28, #10#0, #10#1, 999;
     ;
     NULL, LineasKit;
|FIN;

|PROCESO actulp;|TIPO 0;
     |ABRE #2;
     #2#0 = #10#2;
     |LEE 000#2=;
     |CIERRA #2;

     || nMult corrige redondeo importe negativo
     |SI #2#194 = 2;
          nImpo = #10#44  * #10#6;
     |SINO;
          nImpo = #10#5  * #10#6;
     |FINSI;

     importe  = #9#13;
     importeD = #9#44;
     |SI #2#194 = 2;
          #9#13 = (#10#49 * #10#6)  * nMult;
          #9#44 = (#10#49 * #10#38) * nMult;
     |SINO;
          #9#13 = (#10#43 * #10#6)  * nMult;
          #9#44 = (#10#43 * #10#38) * nMult;
     |FINSI;
/*
     #9#13 = ((((#9#13 < #10#8) < #10#29) < #9#5) < #9#17) < #9#6;
     #9#44 = ((((#9#44 < #10#8) < #10#29) < #9#5) < #9#17) < #9#6;
*/
     nBrutoMoneda1 = (#9#13 < #10#8) < #10#29;
     nImporDescue1 = (nBrutoMoneda1 % #9#5) ! nDeci_BaseMxP;
     nBrutoMoneda1 = nBrutoMoneda1 - nImporDescue1;
     nImporDescue2 = (nBrutoMoneda1 % #9#17) ! nDeci_BaseMxP;
     nBrutoMoneda1 = nBrutoMoneda1 - nImporDescue2;
     nImporDescue3 = (nBrutoMoneda1 % #9#6) ! nDeci_BaseMxP
     nBrutoMoneda1 = nBrutoMoneda1 - nImporDescue3;
     #9#13 = nBrutoMoneda1;

     nBrutoMoneda2 = (#9#44 < #10#8) < #10#29;
     nImporDescue1 = (nBrutoMoneda2 % #9#5) ! nDeci_DivP;
     nBrutoMoneda2 = nBrutoMoneda2 - nImporDescue1;
     nImporDescue2 = (nBrutoMoneda2 % #9#17) ! nDeci_DivP;
     nBrutoMoneda2 = nBrutoMoneda2 - nImporDescue2;
     nImporDescue3 = (nBrutoMoneda2 % #9#6) ! nDeci_DivP;
     nBrutoMoneda2 = nBrutoMoneda2 - nImporDescue3;
     #9#44 = nBrutoMoneda2;

     #9#13 = importe - (#9#13 * nMult);        || Imp Servido (C)
     #9#44 = importeD - (#9#44 * nMult);        || Imp Servido (C)

     #10#43 = #10#43 + #0#5;
     #10#49 = #10#49 + #0#48;

     #9#11 = #9#11  - #10#9;
     #9#42 = #9#42  - #10#39;

     |SI nImpo < 0; nMult = -1; |SINO; nMult = 1; |FINSI;
     |SI #2#194 = 2;
          #10#7   = (#10#44  * #10#6)  * nMult;
          nImpDiv = (#10#44  * #10#38) * nMult;
     |SINO;
          #10#7   = (#10#5  * #10#6)  * nMult;
          nImpDiv = (#10#5  * #10#38) * nMult;
     |FINSI;
/*
     #10#9  = ((((#10#7   < #10#8) < #10#29) < #9#5) < #9#17) < #9#6;
     #10#39 = ((((nImpDiv < #10#8) < #10#29) < #9#5) < #9#17) < #9#6;
*/
     nBrutoMoneda1 = (#10#7 < #10#8) < #10#29;
     nImporDescue1 = (nBrutoMoneda1 % #9#5) ! nDeci_BaseMxP;
     nBrutoMoneda1 = nBrutoMoneda1 - nImporDescue1;
     nImporDescue2 = (nBrutoMoneda1 % #9#17) ! nDeci_BaseMxP;
     nBrutoMoneda1 = nBrutoMoneda1 - nImporDescue2;
     nImporDescue3 = (nBrutoMoneda1 % #9#6) ! nDeci_BaseMxP
     nBrutoMoneda1 = nBrutoMoneda1 - nImporDescue3;
     #10#9 = nBrutoMoneda1;

     nBrutoMoneda2 = (nImpDiv < #10#8) < #10#29;
     nImporDescue1 = (nBrutoMoneda2 % #9#5) ! nDeci_DivP;
     nBrutoMoneda2 = nBrutoMoneda2 - nImporDescue1;
     nImporDescue2 = (nBrutoMoneda2 % #9#17) ! nDeci_DivP;
     nBrutoMoneda2 = nBrutoMoneda2 - nImporDescue2;
     nImporDescue3 = (nBrutoMoneda2 % #9#6) ! nDeci_DivP;
     nBrutoMoneda2 = nBrutoMoneda2 - nImporDescue3;
     #10#39 = nBrutoMoneda2;


     #10#7  = #10#7 * nMult;
     #10#9  = #10#9 * nMult;
     #10#39 = #10#39 * nMult;

     #9#11 = #9#11 + #10#9;
     #9#42 = #9#42 + #10#39;

     |SI #9#37 = "D";
         #10#41 = #10#9;
     |SINO;
         #10#41 = #10#39;
     |FINSI;

     |SI #2#194 = 2;
          importe  = (#10#49 * #10#6)  * nMult;
          importeD = (#10#49 * #10#38) * nMult;
     |SINO;
          importe  = (#10#43 * #10#6)  * nMult;
          importeD = (#10#43 * #10#38) * nMult;
     |FINSI;
/*
     importe  = ((((importe  < #10#8) < #10#29) < #9#5) < #9#17) < #9#6;
     importeD = ((((importeD < #10#8) < #10#29) < #9#5) < #9#17) < #9#6;
*/
     nBrutoMoneda1 = (importe < #10#8) < #10#29;
     nImporDescue1 = (nBrutoMoneda1 % #9#5) ! nDeci_BaseMxP;
     nBrutoMoneda1 = nBrutoMoneda1 - nImporDescue1;
     nImporDescue2 = (nBrutoMoneda1 % #9#17) ! nDeci_BaseMxP;
     nBrutoMoneda1 = nBrutoMoneda1 - nImporDescue2;
     nImporDescue3 = (nBrutoMoneda1 % #9#6) ! nDeci_BaseMxP
     nBrutoMoneda1 = nBrutoMoneda1 - nImporDescue3;
     importe = nBrutoMoneda1;

     nBrutoMoneda2 = (importeD < #10#8) < #10#29;
     nImporDescue1 = (nBrutoMoneda2 % #9#5) ! nDeci_DivP;
     nBrutoMoneda2 = nBrutoMoneda2 - nImporDescue1;
     nImporDescue2 = (nBrutoMoneda2 % #9#17) ! nDeci_DivP;
     nBrutoMoneda2 = nBrutoMoneda2 - nImporDescue2;
     nImporDescue3 = (nBrutoMoneda2 % #9#6) ! nDeci_DivP;
     nBrutoMoneda2 = nBrutoMoneda2 - nImporDescue3;
     importeD = nBrutoMoneda2;

     enTiva = #10#14;
     efFiva = #9#1;
     |HAZ SacaIVA;

     nCalc = (#10#11 % enIva);
     |SI #6#47 = "S";
          nCalc = nCalc + (#10#11 % enRec);
     |FINSI;
     nCalc = nCalc ! 2;

     nImpRiesgo = nImpRiesgo + #10#11 + nCalc;
/*
Lo ponemos al final para acelera
     nImpo = #10#11 + nCalc;
     eaTag = "PAU";  |HAZ Riesgos;
*/
     #10#11 = #10#9  - (importe * nMult);|| Imp. Pdte (L)
     #10#37 = #10#37 + #0#35;

     nImpo = #9#13;
     #9#13 = importe;                   || Imp Servido (C)
     #9#13 = (#9#13 * nMult) + nImpo;   || Imp Servido (C)
     #9#12 = #9#11 - #9#13;             || Imp Pdte serv (C)

     nImpo = #9#44;
     #9#44 = importeD;                  || Imp Servido (C)
     #9#44 = (#9#44 * nMult) + nImpo;   || Imp Servido (C)
     #9#43 = #9#42 - #9#44;             || Imp Pdte serv (C)

     #9#24 = #9#24 + #0#5;              || Ctrl Servido (C)

     ||--------------------
     eaArticulo = #10#2;
     |HAZ EsKit;
     |SI FSalida = 0;
          |ABRE #947;
          |BUCLE LineasKit;
          |CIERRA #947;
     |FINSI;
     ||-------------------Actualiza Historico, Articulo y Almacen
     enForma =  1;
     enUnidPend = #0#5;
     enUnidPend2 = #0#48;

     |HAZ AcumulaAV;
     |HAZ AcumulaPV;

     ||-------------------------------------
     |SI nSwTagloma = 0;
          eaCliente = #1#3;
          eaArticulo = #0#2;
          enUniTagRes = -#0#5;
          |HAZ TagVentaVario;
          |HAZ TagModiFabri;
     |FINSI;
     ||-------------------------------------

     nNume  = ((((#0#9 < #1#5) < #1#32) < #1#7));
     #0#14  = enCoste;

     |SI #9#37 = "B";  || Asigna campos visual. y no visual. en el pedido segun la moneda de trabajo
       #9#45 = #9#11;
       #9#46 = #9#12;
       #9#47 = #9#13;
       #9#48 = #9#42;
       #9#50 = #9#43;
       #9#49 = #9#44;
     |SINO;
       #9#45 = #9#42;
       #9#46 = #9#43;
       #9#47 = #9#44;
       #9#48 = #9#11;
       #9#50 = #9#12;
       #9#49 = #9#13;
     |FINSI;

     |SI enNumPedido = 0;
          |PINTA 1064,#9#0;
          |PINTA 1264,#1#3;
          |PINTA 1464,#1#0;
          |PINTA 1664,#0#1;
          |PINTA 1864,#0#2;
          |PINTA 2064,#0#3;
     |FINSI;
     |HAZ ChampiEmarPortes;

     |GRABA 020#9a;  |LIBERA #9;
     |GRABA 020#10a; |LIBERA #10;

     |SI nSwAlbero = 0;
          |HAZ AlbePed2Alb;
     |FINSI;

     || _____________ Modulo Marhuenda.............
     |SI aParam = "marhu";
          #300#0 = #9#25;
          #300#1 = #9#0;
          |LEE 000#300=;
          |SI FSalida ! 0;
               #300#0 = #9#25;
               #300#1 = #9#0;
               #300#2 = #9#4;
               #300#3 = 0;
               #300#4 = #1#52;
               #300#5 = #1#0;
               |GRABA 020#300n;
          |FINSI;
     |FINSI;

     |SI nSwEvaristo = 0;
          |HAZ EvaGraba;
     |FINSI;
|FPRC;


|PROCESO liacartia;|TIPO 0;
     #0#5 =  nUnidades; || #10#5  - #10#43;  ||Unidades.
     #0#48 = #10#48 - #10#49;

     #1#41 = #1#41 + 1;

     |SI aParam = "marhu";
          |HAZ mirarvic;
     |FINSI;

     |HAZ TotalLin71;

     #0#24 = #10#5 - #10#43;
     #0#23 = #10#5;

     |HAZ actulp;

     |HAZ CalCabAgifa010;

     |HAZ riesgo_cli;

     |SI #9#52 ! 0;
         aAlfa = #6#198 + "P" + (("000" + #9#52) % -103);
         #0#47 = aAlfa;
         #1#85 = "E";
     |FINSI;
|FPRC;

|PROCESO GrabaCompoN;
     |SI #3#44 = "N";
          |DDEFECTO #904;
          #904#0 = #0#2;
          #904#1 = #0#3;
          #904#2 = #905#4;
          |LEE 000#904=;
          cantidad = #904#13;
          minimo = #904#10;
          cantidad = cantidad - minimo - (#905#11-#905#12+#905#9);
          |SI cantidad < 0;
               aAlfa = "0000No Hay Stock [" + #2#0 + "]" + &13 + #910#20 + " [" + #905#4 + "]";
               |MENAV aAlfa;
               |ACABA;
          |FINSI;
     |FINSI;

     |SALVA_DATOS #905;

     #905#0  = "AV";
     #905#1  = #0#29;
     #905#2  = #0#0;
     #905#3  = #0#1;
     #905#6  = #905#6 - #905#12;
     #905#8  = #905#6 * #905#7;
     #905#9  = 0;
     #905#11 = 0;
     #905#12 = 0;
     |GRABA 020#905n;
     |LIBERA #905;
     nUnidades = nUnidades + #905#6;

     |REPON_DATOS #905;
     |LEE 040#905=;

     eaTipo        = "AV";
     eaSerie       = #0#29;
     enCodigo      = #0#0;
     enLinea       = #0#1;
     efFecha       = #1#1;
     eaArticulo    = #0#2;
     enAlmacen     = #0#3;
     eaComponente  = #905#4;
     enUnidades    = #0#5;
     enTBruto      = #0#7;
     eaAbono       = #1#43;
     enTarifa      = #6#39;
     eaSeriePedido = #0#31;
     enCodigPedido = #0#12;
     enLineaPedido = #0#21;
     enCamBas      = #1#69;
     eaMoneda      = #1#70;
     enCamDiv      = #1#74;

     |SUB_EJECUTA_NP "dsz00002;AVC";
|FPRC;

|DEFBUCLE dsm00005N;
     #905#1;
     ;
     "PV", #0#31, #0#12, nLinV, "      ";
     "PV", #0#31, #0#12, nLinV, "zzzzzz";
     ;
     NULL, GrabaCompoN;
|FIN;

|PROCESO CreaLinea;
     #0#29 = #1#52;
     #0#0 = #1#0;
     #0#1 = 999;
     |LEE 000#0];
     |SI FSalida = 0;
          |LEE 000#0a;
     |SINO;
          |LEE 000#0u;
     |FINSI;
     |SI #97#236 [ 0; #97#236 = 1; |FINSI; || aseguramos que sea ] 1
     |SI FSalida = 0; |Y #0#29 = #1#52; |Y #0#0 = #1#0;
          nLinea = #0#1 + #97#236;
     |SINO;
          nLinea = #97#236;
     |FINSI;

     |ABRE #21;
     #21#26 = #1#52;
     |LEE 000#21=;
     |CIERRA #21;

     |DDEFECTO #0;
     #0#29 = #1#52;
     #0#0 = #1#0;
     #0#1 = nLinea;
     |PARA i = 2;|SI i < 11;|HACIENDO i = i + 1;
          #0i = #10i;
     |SIGUE;
     #0#3 = almacen;
     #0#5 = nUnidades;
     #0#27 = #10#27;
     #0#33 = #10#29;
     #0#12 = #9#0;
     #0#21 = #10#1;
     #0#19 = "S";
     #0#11 = #10#14;
     |SI #21#30 = "S"; #0#11 = 0; |FINSI; || iva=0 en exportacion
     #0#31 = #9#25;
     #0#16 = #10#17;
     #0#17 = #10#19;
     #0#15 = #10#20;
     #0#13 = #10#18;
     #0#34 = #10#35;
     #0#35 = #10#36 - #10#37;
     #0#36 = #10#38;                     ||Precio en divisa

     #0#49 = aPartida;   ||partida
     #0#50 = #10#46;   ||merma
     #0#51 = #10#50;   ||medida1
     #0#52 = #10#51;   ||medida2
     #0#53 = #10#52;   ||medida3
     #0#51 = #10#50;   ||medida1
     #0#62 = #10#54;   ||p.verde
     #0#63 = #10#55;   ||linea promo
     #0#64 = #10#56;   ||imp promo
     #0#65 = #10#57;
     #0#66 = #10#58;

     aAlfa = #0#2; |QBF aAlfa;
     |SI aAlfa ! "";
          |SI #97#202 = "S"; |O #97#40 = "S";
               aTipoDA = "AP"; |HAZ AltaDA;
          |FINSI;
     |FINSI;

     |SI #2#176 = "S";
          nUnidades = 0;
          nLinV = #0#21;
          |ABRE #904;
          |BUCLE dsm00005N;
          |CIERRA #904;
          #0#5 = nUnidades;
     |FINSI;

     |HAZ liacartia;

     |SI nSwTagloma = 0;
          #0#61 = #10#53; || ­­­ Campo INTERNO marcado con 9
     |FINSI;
     |SI nSwQDClor = 0;
          |HAZ QDClorCamAdj;
          eaSerie = #0#29;
          enCodigo = #0#0;
          enLinea = #0#1;
          eaTipo = "VA";
          eaArticulo = #0#2;
          eaPartida = #0#49;
          |SUB_EJECUTA_NP "qdclor10;ALTA";
     |FINSI;
     |GRABA 020#0n;
/*
     nLinV = #0#21;
     |BUCLE dsm00005N;
*/
     |SI nSwOrts = 0;
          |HAZ OrtsRepreLin;
          eaSeriePedido = #agifa073#28;
          enCodigPedido = #agifa073#0;
          enLineaPedido = #agifa073#1;
          eaSerie = #agifa071#29;
          enCodigo = #agifa071#0;
          enLinea = #agifa071#1;
          |SUB_EJECUTA_NP "dsz99905;ADJPED";
          |HAZ OrtsAlbConsumo;
     |FINSI;
     |SI nSwTagloma = 0;
          |HAZ TagAdjUniFami;
     |FINSI;
     |SI nSwDesach = 0;
          |HAZ ActDesanch;
     |FINSI;
     |SI nSwSematel = 0;
          |HAZ HistoIMEI;
     |FINSI;
     |SI nSwChampiEmar = 0;
          |HAZ ChampiEmarEnv;
     |FINSI;
     |SI nSwGofre = 0;
          |HAZ GofrePalet;
     |FINSI;
|FPRC;

|PROCESO StockEleme;
     #905#0 = "PV";
     #905#1 = #10#28;
     #905#2 = #10#0;
     #905#3 = #10#1;
     #905#4 = "";
     |LEE 000#905];
     |PARA; |SI FSalida = 0; |Y #905#0 = "PV"; |Y #905#1 = #10#28;
               |Y #905#2 = #10#0; |Y #905#3 = #10#1; |HACIENDO;
          |DDEFECTO #904;
          #904#0 = #0#2;
          #904#1 = almacen;
          #904#2 = #905#4;
          |LEE 000#904=;
          cantidad = #904#13;
          minimo = #904#10;
          cantidad = cantidad - minimo - (#905#11-#905#12+#905#9);
          |SI cantidad ] 0;
               hacer = 1;
          |FINSI;
          |LEE 000#905s;
     |SIGUE;
|FPRC;

|PROCESO HayStock;
     |SI #910#52 = "S";
          |SI #10#22 = "S";
               hacer = 1;
          |SINO;
               |ABRE #905;
               |ABRE #904;
               |HAZ StockEleme;
               |CIERRA #904;
               |CIERRA #905;
          |FINSI;
     |SINO;
          #8#0 = #0#2;
          #8#1 = almacen;
          |LEE 020#8=;
          |SI FSalida ! 0; |DDEFECTO #8; |FINSI;

          cantidad = #8#39;
          minimo = #8#6;
          canmar = #8#39;
          cantidad = cantidad - minimo - (#10#42-#10#43+#10#12);

          |SI #10#22 = "S"; |O cantidad ] 0;
               hacer = 1;
          |SINO;
               |SI aParam = "marhu";
                    |SI canmar > 0;
                         hacer = 1;
                    |FINSI;
               |FINSI;
         |FINSI;
    |FINSI;
|FPRC;

|PROCESO mirarser;
     |SI enNumPedido ! 0;     || Llamado con un sub_ejecuta
          hacer = 1;
          |ACABA;
     |FINSI;
     |SI #3#44 = "S";    ||Adj.Sin Stock
          hacer = 1;
          |ACABA;
     |FINSI;

     #2#0 = #0#2;
     |LEE 020#2=;
     |SI FSalida ! 0; |DDEFECTO #2; |FINSI;

     almacen = #0#3;
     |HAZ HayStock;

     |SI hacer = 0; |Y #3#7 = "S";    ||Cualquier Almacen
          #8#0 = #0#2;
          #8#1 = 0;
          |LEE 000#8];
          |PARA; |SI FSalida = 0; |Y hacer = 0; |Y #8#0 = #0#2; |HACIENDO;
               almacen = #8#1;
               |HAZ HayStock;
               |LEE 000#8s;
          |SIGUE;

          |SI hacer = 0;
               cantidad = #2#104; minimo = #2#7;
               canmar = #2#104;
               cantidad = cantidad - minimo - (#10#42-#10#43+#10#12);
               |SI cantidad ] 0;
                    hacer = 1;
               |SINO;
                    |SI aParam = "marhu";
                         |SI canmar > 0;
                              hacer = 1;
                         |FINSI;
                    |FINSI;
              |FINSI;
              almacen = #0#3;
          |FINSI;
     |FINSI;

     |SI hacer = 0;
          mensajeri = "0000No Hay Stock [" + #2#0 + "] ...";
          |MENAV mensajeri;
     |FINSI;
|FPRC;

|PROCESO sirve;
     |SI #10#15 = "S"; |ACABA; |FINSI;

     |SI nSwTaller = 0; |Y #10#55 = -1; |ACABA; |FINSI;

     |SI nSwMecanogra = 0;
          |HAZ MecaPedFinaliza;
          |SI FSalida ! 0; |ACABA; |FINSI;
     |FINSI;

     |ABRE #2; #2#0 = #10#2; |LEE 000#2=; |CIERRA #2;

     nSwSirve = 0;
     |SI #97#224 = "B";
          |SI #2#179 = "S";
               |SI #10#43 = #10#5; |Y #10#49 = #10#44; nSwSirve = 1; |FINSI;
          |SINO;
               |SI #10#43 = #10#5; nSwSirve = 1; |FINSI;
          |FINSI;
     |SINO;
          |SI #10#43 = #10#5; nSwSirve = 1; |FINSI;
          |SI #2#179 = "S";
               |SI #10#49 = #10#44; nSwSirve = 1;; |FINSI;
          |FINSI;
     |FINSI;

     || Linea de cod. blanco siempre se sirve para el modulo de Tagloma
     aAlfa = #10#2; |QBF aAlfa;
     |SI nSwTagloma = 0; |Y aAlfa = "";
          #150#0 = #10#28;
          #150#1 = #10#0;
          |LEE 000#150=;
          |SI FSalida = 0;
               || los postformados tienen cod. blanco y unidades
               |SI #10#43 = #10#5; |Y #10#5 = 0; || no es un postformado
                    nSwSirve = 0; || sive articulo blanco
               |FINSI;
          |FINSI;
     |FINSI;

     |SI #10#5 = 0; |Y #279#19 = "S";   ||Sirve Uni=0 segun parametro
          nSwSirve = 0;
     |FINSI;


     |SI nSwSirve ! 0; |ACABA; |FINSI;

     |SI #10#0 ! #9#0; |O #10#28 ! #9#25;
         |SI #3#6 = "N";  entrar = 1;  |FINSI;
     |FINSI;

     |SI #10#0 ! #9#0; |O #10#28 ! #9#25;
         |LIBERA #9;
         #9#0 = #10#0;
         #9#25 = #10#28;        ||Serie
         |LEE 121#9=;
         |SI sw = 0; |O #3#6 = "N";
             fecent = #9#2;
             fecped = #9#1;
             sw = 1;
         |FINSI;
     |FINSI;

     |ABRE #6;
     #6#0 = #9#4;
     |LEE 021#6=;
     |CIERRA #6;

     #0#2 = #10#2;
     #0#3 = #10#3;
     almacen = #0#3;
     hacer = 0;
     |SI #9#10 = "N"; |Y #6#157 = "N";
         |HAZ mirarser;
     |FINSI;

     |SI #9#10 = "S"; |Y enNumPedido ! 0; |Y nSwPasa = 0;
          |MENAV "0000Pedido bloqueado...";
     |FINSI;
     || Si esta el pedido retendido pregunta
     |SI #9#10 = "N"; |Y #6#157 = "S"; |Y enNumPedido ! 0; |Y nSwPasa = 0;
          |CONFI "0000NCliente con pedido retenido. ¿Desea servir el pedido?";
          |SI FSalida = 0;
               |HAZ mirarser;
          |FINSI;
     |FINSI;
     nSwPasa = 1;

     aRepre = #9#7;
     |SI eaRepreAdj ! "";
          aRepre  = eaRepreAdj;
     |FINSI;

     |SI hacer = 1;
          |SI entrar = 1; |O entro = 0; |O #9#4 ! #1#3; |O #9#5 ! #1#5;
                    |O #9#17 ! #1#32; |O #9#6 ! #1#7; |O aRepre ! #1#6;
                    |O #9#9 ! #1#8; |O #9#57 ! #1#84;
               |HAZ finadju;
               |HAZ creacabe;
               entro = 1;
               entrar = 0;
          |FINSI;
          #2#0 = #10#2;
          |LEE 020#2=;

          aPartida = #10#45;
          nUniAsig = #10#5 - #10#43;
          |SI #97#118 = "S"; |Y #97#119 = "S"; |Y nUniAsig > 0;|Y #2#180="S";
               || Con partidas y asignacion automatica
               |HAZ CreaTmpAlmParti;
               |ABRE #83;

               |SELECT #2#83;
               #83#0 = #10#2;
               #83#1 = almacen;
               #83#2 = #10#45;
               |LEE 000#83=;
               |SI FSalida = 0;
                    |SI #83#4 < nUniAsig;
                         nUnidades = #83#4;
                         aPartida = #83#2;
                         nUniAsig = nUniAsig - nUnidades;
                         |HAZ CreaLinea;
                         |BORRA 020#83a;
                     |SINO;
                         nUnidades = nUniAsig
                         aPartida = #83#2;
                         |HAZ CreaLinea;
                         nUniAsig = 0;
                     |FINSI;
               |FINSI;
               |SELECT #1#83;

               |LEE 000#83p;
               |PARA; |SI FSalida = 0; |HACIENDO;
                    |SI nUniAsig [ 0; |SAL; |FINSI;
                    |SI #83#4 < nUniAsig;
                         nUnidades = #83#4;
                         aPartida = #83#2;
                         nUniAsig = nUniAsig - nUnidades;
                         |HAZ CreaLinea;
                         |LEE 000#83s;
                     |SINO;
                         nUnidades = nUniAsig
                         aPartida = #83#2;
                         |HAZ CreaLinea;
                         |SAL;
                     |FINSI;
               |SIGUE;
               |CIERRA #83;
          |SINO;
               || Asignacion Normal
               nUnidades = #10#5 - #10#43;
               aPartida = #10#45;
               |HAZ CreaLinea;

               |SI nSwTaller = 0; |Y #10#55 ! 0;
                    |SALVA_FICHA #10;
                    #10#1 = #10#55;
                    |LEE 121#10=;
                    |SI FSalida = 0;
                         |HAZ CreaLinea;
                         |LIBERA #10;
                    |FINSI;
                    |REPON_FICHA #10;
               |FINSI;
          |FINSI;
          |SI nSwTagloma = 0;
               |HAZ TagGrabaPos0;
          |FINSI;
     |FINSI;
     fecent = #9#2;
     fecped = #9#1;

     eaSerPed = #9#25;
     enNumPed = #9#0;
|FPRC;

|| Lineas de pedido, segunda clave
|| Cliente, Fecha de entrega, Dto. , Dto. acumulado, Dto. pp, representante
|| forma de pago, numero de pedido
|| Ademas
|| Serie, Pendiente, Bloqueado
|| + Almacen

|DEFBUCLE FecArt;
     #10#2;
     28, 15, 3;
     #3#2, #3#4,    0,     0,     0, r1,  f1,  #3#0, #3#8,  "N", #3#45;
     #3#3, #3#5,99.99, 99.99, 99.99,"zz","zz", #3#1, #3#10, "N", #3#46;
     be;
     Cero, clicon, NULL, NULL, finadju, sirve;
     #10#13 , #10#28 , #10#0 , #10#2;
|FIN;

|DEFBUCLE FecLin;
     #10#2;
     28, 15, 3;
     #3#2, #3#4,    0,     0,     0, r1,  f1,  #3#0, #3#8,  "N", #3#45;
     #3#3, #3#5,99.99, 99.99, 99.99,"zz","zz", #3#1, #3#10, "N", #3#46;
     be;
     Cero, clicon, NULL, NULL, finadju, sirve;
     #10#13 , #10#28 , #10#0 , #10#1;
|FIN;

|DEFBUCLE CliArt;
     #10#2;
     28, 15, 3;
     #3#2, #3#4,     0,     0,     0,  r1,  f1,  #3#0, #3#8,  "N", #3#45;
     #3#3, #3#5, 99.99, 99.99, 99.99, "zz","zz", #3#1, #3#10, "N", #3#46;
     be;
     Cero, clicon, NULL, NULL, finadju, sirve;
     #10#20, #9#57, #10#28, #10#0, #10#2;
|FIN;

|DEFBUCLE CliLin;
     #10#2;
     28, 15, 3;
     #3#2, #3#4,     0,     0,     0,  r1,  f1,  #3#0, #3#8,  "N", #3#45;
     #3#3, #3#5, 99.99, 99.99, 99.99, "zz","zz", #3#1, #3#10, "N", #3#46;
     be;
     Cero, clicon, NULL, NULL, finadju, sirve;
     #10#20, #9#57, #10#28, #10#0, #10#1;
|FIN;

|DEFBUCLE PedLin;
     #10#2;
     28, 15, 3;
     #3#2, #3#4,     0,     0,     0,  r1,  f1,  #3#0, #3#8,  "N", #3#45;
     #3#3, #3#5, 99.99, 99.99, 99.99, "zz","zz", #3#1, #3#10, "N", #3#46;
     be;
     Cero, clicon, NULL, NULL, finadju, sirve;
     #10#28, #10#0, #10#1;
|FIN;

|DEFBUCLE PedArt;
     #10#2;
     28, 15, 3;
     #3#2, #3#4,     0,     0,     0,  r1,  f1,  #3#0, #3#8,  "N", #3#45;
     #3#3, #3#5, 99.99, 99.99, 99.99, "zz","zz", #3#1, #3#10, "N", #3#46;
     be;
     Cero, clicon, NULL, NULL, finadju, sirve;
     #10#28, #10#0, #10#2;
|FIN;

|PROCESO adjuped; |TIPO 3;
     |SI aParam = "marhu";
          |HAZ CreaTempo; aTmpMarhu = Tempo;
          |NOME_DAT #300 aTmpMarhu; |DELINDEX #300;
          |ABRE #300;
     |FINSI;

     |ABRET #0;                || Lineas Albaranes
     |DDEFECTO #0;

     |ABRET #1;                || Albaranes
     |DDEFECTO #1;

     |ABRE #2;                || Articulos
     |ABRE #8;                || Stocks almacenes
     |ABRE #9;                || Pedidos

     |SI nSwTagloma = 0;
          |HAZ CargaTmpAdj;
     |FINSI;

     |SI enNumPedido ! 0;
          |SI nSwOk = 0;
               #9#25 = eaSerPedido;
               #9#0 = enNumPedido;
               |LEE 101#9=;
               |SI FSalida = 0;
                    #3#9 = eaSerAlb;
                    |SI eaFecAlb ! ""; #3#13 = eaFecAlb; |FINSI;
                    |HAZ Cero;
                    |BUCLELIN 0 sirve #9;
                    |HAZ finadju;
                    |SI entro ! 0;
                         |HAZ ActualizaFicha;
                         |GRABA 020#1a;
                         eaSerAlb = #1#52;
                         enNumAlb = #1#0;
                    |FINSI;
               |FINSI;
          |FINSI;
     |SINO;
          #9#0 = "zzz";            || ??

          |SI nSwTagloma = 0;
               |BUCLE PedLin;
          |SINO;

               || la estandar
               |SI #3#11 = "S";
                    |SI #3#53 = "A";
                         |BUCLE FecArt;   || fecha/serie/numero/art
                    |SINO;
                         |BUCLE FecLin;   || fecha/serie/numero/lin
                    |FINSI;
               |SINO;
                    |SI #3#6 = "N";     ||
                         |SI #3#53 = "A";
                              |BUCLE PedArt; || ser/ped/art
                         |SINO;
                              |BUCLE PedLin; || ser/ped/lin
                         |FINSI;
                    |SINO;
                         |SI #3#53 = "A";
                              |BUCLE CliArt; || cli/dir/arti
                         |SINO;
                              |BUCLE CliLin; || cli/dir/lin
                         |FINSI;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;

     |SI nSwTagloma = 0;
          |HAZ BorraTmpAdj;
     |FINSI;

     |CIERRAT #1;
     |CIERRA #2;
     |CIERRA #8;
     |CIERRAT #0;
     |CIERRA #9;
     |SI aParam = "marhu";
          |CIERRA #300;
          Tempo = aTmpMarhu; |HAZ BoraTempo; |DELINDEX #300;
     |FINSI;
|FPRC;

|| PROCESO DE SEPARACION DEL ABARAN CREADO AHORA EN SU HONONIMO EN NEGRO


|PROCESO acttl;
     |HAZ TotalLin71;
     |GRABA 020#0a; ||Grabo lineas

     |HAZ CalCabAgifa010;
|FPRC;

|PROCESO ActualizaFicha;
     |HAZ LimCabAgifa010;

     |BUCLELIN 0acttl#1;
|FPRC;

|PROCESO Reparto;
     nAcumula = nAcumula + nCanti;
     nReparto = nCanti * nPorce;
     nEntero  = (nReparto - .50) ! 0;
     |SI nReparto = nEntero;
         nCantiBlanco = nReparto;
         nTCantiBlanco = nTCantiBlanco + nCantiBlanco;
     |SINO;
         nReparto = ((nCanti * nPorce) - nMasMenos);
         |SI nReparto < 0;
             nCantiBlanco = 0;
         |SINO;
             nEntero = (nReparto - .50) ! 0;
             |SI nReparto = nEntero;
                 nCantiBlanco  = nReparto;
                 nTCantiBlanco = nTCantiBlanco + nCantiBlanco;
             |SINO;
                 nCantiBlanco = nEntero + 1;
                 nTCantiBlanco = nTCantiBlanco + nCantiBlanco;
             |FINSI;
         |FINSI;
     |FINSI;

     nReparto  = nAcumula * nPorce;
     nMasMenos = nTCantiBlanco - nReparto;
|FPRC;

|PROCESO PorUnidadC;
     nCanti = #905#6;
     |HAZ Reparto;

     |SALVA_FICHA #905;

     #905#1  = #6#199;
     #905#2  = enCodAlbNegro;
     #905#6  = nCanti - nCantiBlanco;
     #905#8  = #905#6 * #905#7;
     #905#9  = 0;
     #905#11 = 0;
     #905#12 = 0;
     |GRABA 020#905n;

     |REPON_FICHA #905;
     #905#10 = #905#6;
     #905#6  = nCantiBlanco;
     #905#8  = #905#6 * #905#7;
     |GRABA 020#905a;
     |LIBERA #905;
|FPRC;

|PROCESO PorPrecioC;
     nCanti = #905#7;
     |HAZ Reparto;

     |SALVA_FICHA #905;

     #905#1 = #6#199;
     #905#2 = enCodAlbNegro;
     #905#7 = #905#7 - nCantiBlanco;
     #905#8 = #905#6 * #905#7;
     #905#9  = 0;
     #905#11 = 0;
     #905#12 = 0;
     |GRABA 020#905n;
     nTotalNegro = nTotalNegro + #905#8;

     |REPON_FICHA #905;
     #905#10 = #905#7;
     #905#7  = nCantiBlanco;
     #905#8  = #905#6 * #905#7;
     |GRABA 020#905a;
     |LIBERA #905;
     nTotalBlanco = nTotalBlanco + #905#8;
|FPRC;

|PROCESO LineasBlancasC;
     |SI #6#198 = "U";   |HAZ PorUnidadC;  |FINSI;
     |SI #6#198 = "P";   |HAZ PorPrecioC;  |FINSI;
     |SI #6#198 = "A";
         |SI #2#178 = " ";  #2#178 = "U";     |FINSI;
         |SI #2#178 = "U";  |HAZ PorUnidadC;  |FINSI;
         |SI #2#178 = "P";  |HAZ PorPrecioC;  |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE dsm00005;
     #905#1;
     ;
     "AV", #0#29, #0#0, nLinV, "      ";
     "AV", #0#29, #0#0, nLinV, "zzzzzz";
     be;
     NULL, LineasBlancasC;
|FIN;

|PROCESO PorUnidad;
     |SI #2#176 = "S";
         nLinV = #0#1;
         |BUCLE dsm00005;

         |SALVA_FICHA #0;

         #0#29 = #6#199;
         #0#0  = enCodAlbNegro;
         #0#5  = #0#5 - nTCantiBlanco;
         aAlfa = "U" + "N" + (("000" + nPorceT) % -103);
         #0#47 = aAlfa;
         |SI aExporNegro = "S"; #0#11 = 0; |FINSI;  ||Exporta
         |GRABA 020#0n;

         |REPON_FICHA #0;

         aAlfa = "U" + "P" + (("000" + nPorceT) % -103) + (("               " + #0#5) % -115);
         #0#47 = aAlfa;
         #0#5  = nTCantiBlanco;
         |GRABA 020#0a;
     |SINO;
         |SI #2#179 = "S";         || Doble Stock
              |SI #0#48 = 1;
                  nPorce = 1;  || Si uni2 = 1 no hay desglose
                  nPorceT = 0;
              |FINSI;
              nCanti = #0#5;
              nReparto = nCanti * nPorce;
              nCantiBlanco = nReparto ! #2#187;
              nCanti2 = #0#48;
              nReparto = nCanti2 * nPorce;
              nCantiBlanco2 = nReparto ! 0;
              #0#50 = #0#50 * nPorce;
         |SINO;
               nCanti = #0#5;
               nReparto = nCanti * nPorce;
               nCantiBlanco = nReparto ! #2#187;
               nCanti2 = 0;
               nCantiBlanco2 = 0;
         |FINSI;

         |SALVA_FICHA #0;

         #0#29 = #6#199;
         #0#0  = enCodAlbNegro;
         #0#5  = nCanti - nCantiBlanco;
         #0#48  = nCanti2 - nCantiBlanco2;
         aAlfa = "U" + "N" + (("000" + nPorceT) % -103);
         #0#47 = aAlfa;
         |SI aExporNegro = "S"; #0#11 = 0; |FINSI;  ||Exporta
         |GRABA 020#0n;

         |REPON_FICHA #0;

         aAlfa = "U" + "P" + (("000" + nPorceT) % -103) + (("               " + #0#5) % -115);
         aAlfa = aAlfa + (("               " + #0#48) % -115);
         #0#47 = aAlfa;
         #0#5  = nCantiBlanco;
         #0#48  = nCantiBlanco2;
         |GRABA 020#0a;
         |LIBERA #0;
     |FINSI;
|FPRC;

|PROCESO PorPrecio;
     |SI #2#176 = "S";
         nTotalNegro  = 0;
         nTotalBlanco = 0;
         nLinV = #0#1;
         |BUCLE dsm00005;

         |SALVA_FICHA #0;

         #0#29 = #6#199;
         #0#0  = enCodAlbNegro;
         |SI #1#70 = "D";
             #0#36 = nTotalNegro / #0#5;
         |SINO;
             #0#6  = nTotalNegro / #0#5;
         |FINSI;

         aAlfa = "P" + "N" + (("000" + nPorceT) % -103);
         #0#47 = aAlfa;
         |SI aExporNegro = "S"; #0#11 = 0; |FINSI;  ||Exporta
         #0#14 = #0#14 * nPorceT / 100; || Coste Negro
         |GRABA 020#0n;

         |REPON_FICHA #0;

         |SI #1#70 = "D";
             aAlfa = "P" + "P" + (("000" + nPorceT) % -103) + (("               " + #0#36) % -115);
             #0#47 = aAlfa;
             #0#36 = nTotalBlanco / #0#5;
         |SINO;
             aAlfa = "P" + "P" + (("000" + nPorceT) % -103) + (("               " + #0#6) % -115);
             #0#47 = aAlfa;
             #0#6  = nTotalBlanco / #0#5;
         |FINSI;
         #0#14 = #0#14 * (100-nPorceT) / 100; || Coste Blanco
         |GRABA 020#0a;
         |LIBERA #0;
     |SINO;
         |SI #1#70 = "D";
             nCanti = #0#36;
         |SINO;
             nCanti = #0#6;
         |FINSI;
         |HAZ Reparto;

         |SALVA_FICHA #0;

         #0#29 = #6#199;
         #0#0  = enCodAlbNegro;
         |SI #1#70 = "D";
             #0#36 = nCanti - nCantiBlanco;
         |SINO;
             #0#6 = nCanti - nCantiBlanco;
         |FINSI;
         aAlfa = "P" + "N" + (("000" + nPorceT) % -103);
         #0#47 = aAlfa;
         |SI aExporNegro = "S"; #0#11 = 0; |FINSI;  ||Exporta
         #0#14 = #0#14 * nPorceT / 100; || Coste Negro
         |GRABA 020#0n;

         |REPON_FICHA #0;

         |SI #1#70 = "D";
             aAlfa = "P" + "P" + (("000" + nPorceT) % -103) + (("               " + #0#36) % -115);
             #0#47 = aAlfa;
             #0#36 = nCantiBlanco;
         |SINO;
             aAlfa = "P" + "P" + (("000" + nPorceT) % -103) + (("               " + #0#6) % -115);
             #0#47 = aAlfa;
             #0#6  = nCantiBlanco;
         |FINSI;
         #0#14 = #0#14 * (100-nPorceT) / 100; || Coste Blanco
         |GRABA 020#0a;
         |LIBERA #0;
     |FINSI;
|FPRC;

|PROCESO KitNegro;
     #947#0 = #6#199;
     #947#1 = enCodAlbNegro;
     |GRABA 020#947n;
|FPRC;

|DEFBUCLE KitNegro;
     #947#1;
     ;
     #0#29, #0#0, #0#1, 001;
     #0#29, #0#0, #0#1, 999;
     ;
     NULL, KitNegro;
|FIN;

|PROCESO LineasBlancas;
     |LEE 101#0=;

     aAlfa         = #0#47 % 303;
     nPorceT       = aAlfa;
     nPorce        =  ((100 - nPorceT) / 100);
     nMasMenos     = 0;
     nAcumula      = 0;
     nTCantiBlanco = 0;
     nMasMenos     = 0;

     |ABRE #2;
     #2#0 = #0#2;
     |LEE 000#2=;
     |SI FSalida ! 0;  |DDEFECTO #2;  |FINSI;
     |CIERRA #2;

     |SI #6#198 = "U";   |HAZ PorUnidad;  |FINSI;
     |SI #6#198 = "P";   |HAZ PorPrecio;  |FINSI;
     |SI #6#198 = "A";
         |SI #2#178 = " ";  #2#178 = "U";     |FINSI;
         |SI #2#178 = "U";  |HAZ PorUnidad;  |FINSI;
         |SI #2#178 = "P";  |HAZ PorPrecio;  |FINSI;
     |FINSI;

     eaArticulo = #0#2;
     |HAZ EsKit;
     |SI FSalida = 0;
          |BUCLE KitNegro;
     |FINSI;
|FPRC;

|PROCESO DesgloseAlb;
     |ABRE #6;
     #6#0 = #1#3;
     |LEE 040#6=;
     |SI FSalida ! 0;  |DDEFECTO #6;  |FINSI;
     |CIERRA #6;

     |ABRE #21;
     #21#26 = #6#199;
     |LEE 000#21=;
     |CIERRA #21;
     aExporNegro = #21#30;

     aSerAlbBlanco = #1#52;
     nCodAlbBlanco = #1#0;
     nCodAlb       = #1#0;

     FSalida = 0;
     |PARA; |SI FSalida = 0;  |HACIENDO;
            |SI #97#103 = "N";
                enSwMenu = 1;
                |HAZ ContadorNegro;
            |SINO;
                enCodAlbNegro = nCodAlb;
            |FINSI;

            #1#52 = #6#199;
            #1#0  = enCodAlbNegro;
            |LEE 040#1=;

            nCodAlb = nCodAlb + 1;
     |SIGUE;

     #1#52 = #6#199;
     #1#0  = enCodAlbNegro;
     #1#8  = #6#200;
     #1#85 = "X";
     #1#86 = aSerAlbBlanco;
     #1#87 = nCodAlbBlanco;
     #1#64 = #9#61;
     #1#2  = 0;
     #1#5  = #6#201;
     |GRABA 020#1n;

     #1#52 = aSerAlbBlanco;
     #1#0  = nCodAlbBlanco;
     |LEE 101#1=;
     |SI FSalida = 0;
         #1#86 = #6#199;
         #1#87 = enCodAlbNegro;

        |BUCLELIN 0LineasBlancas#1;
     |FINSI;
|FPRC;

|PROCESO DesgloNegro;
     |HAZ DesgloseAlb;
     |HAZ ActualizaFicha;
     |GRABA 020#1a;
     |LIBERA #1;

     #1#52 = #6#199;
     #1#0  = enCodAlbNegro;
     |LEE 101#1=;
     |SI FSalida = 0;
          |HAZ ActualizaFicha;
          |GRABA 020#1a;
          |LIBERA #1;

          |SI nSwWeb = 0;
               |HAZ DocWeb;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO cierre; |TIPO 0;
     efFec = #3#13;
     enAlma = 0;
     |HAZ MiraHisT;
     |SI enErrHis ! 0;
          |ERROR;
          |ACABA;
     |FINSI;
|FPRC;

||---------------------------------------------------------------------------
|| Este proceso mira en PG si en la adj. las series de alb. y ped. tienen que
|| ser iguales (parametro 127). Si es asi el campo serie albaran no puede ser
|| "*****", tiene que tener valor. Los campos desde y hasta serie son iguales al
|| serie albaran y no modificables. Alejandro 27/03/2000
||----------------------------------------------------------------------------
|PROCESO MiraParam; |TIPO 0;
     |ABRE #97;
     |LEE 000#97p;
     |CIERRA #97;
     |SI #97#127 = "S";
          |SI #3#9 = "*****";
               |MENSA "0000Es necesario especificar la serie del albaran";
               |PAUSA;
               |ERROR;
               |ACABA;
          |SINO;
               #3#8  = #3#9;
               #3#10 = #3#9;
               |C_M #3#8, 1, "N";
               |C_M #3#10, 1, "N";
               |PINTA #3#8;
               |PINTA #3#10;
          |FINSI;
     |SINO;
          |C_M #3#8, 1, "S";
          |C_M #3#10, 1, "S";
     |FINSI;
|FPRC;

|PROGRAMA;
     aParam = PARAMETRO;

     |HAZ EsCoimasa;
     |SI FSalida = 0; |CORRE "coimz004"; |FINSI;

     |HAZ EsMecanogra; nSwMecanogra = FSalida;
     |HAZ EsTagloma; nSwTagloma = FSalida;
     |HAZ EsTaller; nSwTaller = FSalida;
     |HAZ EsDesanch; nSwDesach = FSalida;
     |HAZ EsCongecar; nSwCongecar = FSalida;
     |HAZ EsTecatel; nSwTecatel = FSalida;
     |HAZ EsInforpor; nSwInforpor = FSalida;
     |HAZ EsSematel; nSwSematel = FSalida;
     |HAZ EsOrts; nSwOrts = FSalida;
     |HAZ EsInforAlba; nSwInforAlba = FSalida;
     |HAZ EsWeb; nSwWeb = FSalida;
     |HAZ EsAlbero; nSwAlbero = FSalida;
     |HAZ EsFeldo; nSwFeldo = FSalida;
     |HAZ EsQDClor; nSwQDClor = FSalida;
     |HAZ EsGestral; nSwGestral = FSalida;
     |HAZ EsEvaristo; nSwEvaristo = FSalida;
     |HAZ EsChampiEmar; nSwChampiEmar = FSalida;
     |HAZ EsGofre; nSwGofre = FSalida;
     |HAZ EsJamaica; nSwJamaica = FSalida;
     |HAZ EsChampiEmar; nSwChampiEmar = FSalida;

     |ABRE #97; |LEE 000#97p; |CIERRA #97;
     |ABRE #279; |LEE 000#279p; |CIERRA #279;
     |ABRE #910; |LEE 000#910p; |CIERRA #910;
     |HAZ CreaTempo; aTmp83 = Tempo; |NOME_DAT #83#Tempo#;

     |SI enNumPedido = 0;
          |SI #97#246 = "N";
               |MENAV "0000No se permite la adj. automatica de pedidos a albaranes";
          |SINO;
               |PINPA #0#3;
               |SI nSwJamaica = 0;
                    |C_V #3#6, 1, "N";  #3#6 = "N";
                    |C_V #3#7, 1, "N";  #3#7 = "N";
                    |C_V #3#44, 1, "N"; #3#44 = "S";
                    |PINTA 2001, "ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´";
                    |BLANCO 1702 1838;
               |FINSI;
               |PINDA #0#3;
               |ENDATOS #1#3;
          |FINSI;
     |SINO;
          |HAZ adjuped;
     |FINSI;

     Tempo = aTmp83; |HAZ BoraTempo;
     |DELINDEX #83;
|FPRO;

|PROCESO parrilla;
     |SI #3#15 = 0; swparrilla = 1; |ACABA; |FINSI;
     |PARA nVic = 14; |SI nVic [ 42; |HACIENDO nVic = nVic + 2;
          nVic2 = nVic + 1;
          |SI #3nVic = #10#28; |Y #3nVic2 = #10#0;
               swparrilla = 1;
               |SAL;
          |FINSI;
     |SIGUE;
|FPRC;

|PROCESO mirarvic;
     #2#0 = #0#2;
     |LEE 000#2=;
     |SI FSalida = 0;
         #8#0 = #0#2;
         #8#1 = #0#3;
         |LEE 000#8=;
         |SI FSalida = 0;
             |SI #3#7 = "S";
                 cantidad = #2#104; minimo = #2#7;
             |SINO;
                 cantidad = #8#39;  minimo = #8#6;
             |FINSI;
             cantidad = cantidad - minimo - (#10#42-#10#43+#10#12);
             |SI #10#22 = "S"; |O cantidad ] 0;

             |SINO;
                  |SI #3#7 = "S";
                      #0#5 = #2#104;
                  |SINO;
                      #0#5 = #8#39;
                  |FINSI;
             |FINSI;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO NormalizaFecha; |TIPO 7;
     |SI #agifa098#4 = "01.01.0001";
          fFecha = ~;
          aFecha = fFecha;
          aAny = aFecha % -104;
          |QBF aAny;
          aFecha = "01.01." + aAny;
          #agifa098#4 = aFecha;
          |PINTA #agifa098#4;
     |FINSI;
     |SI #agifa142#185 = "S"; #3#9 = #agifa142#188; |FINSI;
|FPRC;

|PROCESO CreaTmpAlmParti;
     |DELINDEX #83;
     |ABRE #83;
     |ABRE #24;
     #24#0 = #10#2;
     #24#1 = almacen;
     #24#2 = "";
     |LEE 000#24];
     |PARA; |SI FSalida = 0; |Y #24#0 = #10#2; |Y #24#1 = almacen; |HACIENDO;
          #83#0 = #24#0;
          #83#1 = #24#1;
          #83#2 = #24#2;
          #83#3 = #24#4; || Ordenado por F.Entrada
          #83#4 = #24#31;
          #83#5 = #24#32;
          |SI #83#4 > 0;
               |GRABA 020#83n;
          |FINSI;
          |LEE 000#24s;
     |SIGUE;
     |CIERRA #24;
     |CIERRA #83;
|FPRC;

|PROCESO MecaPedFinaliza;
     |DDEF aAlfa;
     aAlfa = aAlfa + "mecam006";
     |CARGA_DEF aAlfa, refere0@;
     |SI FSalida = 0;
          |ABRE #refere0@;
          #refere0@#0 = #10#28;
          #refere0@#1 = #10#0;
          #refere0@#2 = #10#1;
          |LEE 000#refere0@.=;
          |CIERRA #refere0@;
          aAlfa = #refere0@#10;
          |DESCARGA_DEF #refere0@;
     |FINSI;
     |SI aAlfa = "S";
          FSalida = 0;
     |SINO;
          FSalida = 1;
     |FINSI;
|FPRC;

----------------------
|PROCESO TagGrabaPos;
     |DDEF aAlfa;
     aAlfa = aAlfa + "tagm0056";
     |CARGA_DEF aAlfa, tagm0056@;
     |SI FSalida = 0;
          |ABRE #tagm0056@;
          #tagm0056@#0 = "AV";
          #tagm0056@#1 = #0#29;
          #tagm0056@#2 = #0#0;
          #tagm0056@#3 = nTagLinOrgPos;
          |LEE 101#tagm0056@.=;
          |SI FSalida ! 0; |GRABA 020#tagm0056@.b; |FINSI;
          #tagm0056@#4 = nTagIncPos;
          #tagm0056@#5 = nTagLinPos;
          #tagm0056@#6 = aTagDesPos;
          |GRABA 020#tagm0056@.a;
          |CIERRA #tagm0056@;
          |DESCARGA_DEF #tagm0056@;
     |FINSI;
|FPRC;

|PROCESO TagEsLinPostP;
     nSali = 1; || No es
     |DDEF aAlfa;
     aAlfa = aAlfa + "tagm0056";
     |CARGA_DEF aAlfa, tagm0056@;
     |SI FSalida = 0;
          |ABRE #tagm0056@;
          |SELECT #2#tagm0056@;
          #tagm0056@#0 = "PV";
          #tagm0056@#1 = #0#31;
          #tagm0056@#2 = #0#12;
          #tagm0056@#5 = #0#21;
          |LEE 000#tagm0056@.=;
          nSali = FSalida;
          nTagDocPos = #tagm0056@#3;
          nTagIncPos = #tagm0056@#4;
          aTagDesPos = #tagm0056@#6;
          |CIERRA #tagm0056@;
          |DESCARGA_DEF #tagm0056@;
     |FINSI;
     FSalida = nSali;
|FPRC;

|PROCESO TagTieneLinPostP;
     nSali = 1; || No es
     |DDEF aAlfa;
     aAlfa = aAlfa + "tagm0056";
     |CARGA_DEF aAlfa, tagm0056@;
     |SI FSalida = 0;
          |ABRE #tagm0056@;
          #tagm0056@#0 = "PV";
          #tagm0056@#1 = #0#31;
          #tagm0056@#2 = #0#12;
          #tagm0056@#3 = #0#21;
          |LEE 000#tagm0056@.=;
          nSali = FSalida;
          nTagDocPos = #tagm0056@#5;
          nTagIncPos = #tagm0056@#4;
          aTagDesPos = #tagm0056@#6;
          |CIERRA #tagm0056@;
          |DESCARGA_DEF #tagm0056@;
     |FINSI;
     FSalida = nSali;
|FPRC;

|PROCESO TagGrabaPos0;
     |HAZ TagEsLinPostP;
     |SI FSalida = 0;
          |DDEF aAlfa;
          aAlfa = aAlfa + "agifa071";
          |CARGA_DEF aAlfa, refere0@;
          |SI FSalida = 0;
               |ABRE #refere0@;
               |SELECT #4#refere0@;
               #refere0@#31 = #0#31;
               #refere0@#12 = #0#12;
               #refere0@#21 = nTagDocPos;
               |LEE 000#refere0@.=;
               |SI FSalida = 0;
                    nTagLinOrgPos = #refere0@#1;
                    nTagLinPos = #0#1;
                    |HAZ TagGrabaPos;
               |FINSI;
               |DESCARGA_DEF #refere0@;
          |FINSI;
     |SINO;
          |HAZ TagTieneLinPostP;
          |SI FSalida ! 0; |ACABA; |FINSI;
          |DDEF aAlfa;
          aAlfa = aAlfa + "agifa071";
          |CARGA_DEF aAlfa, refere0@;
          |SI FSalida = 0;
               |ABRE #refere0@;
               |SELECT #4#refere0@;
               #refere0@#31 = #0#31;
               #refere0@#12 = #0#12;
               #refere0@#21 = nTagDocPos;
               |LEE 000#refere0@.=;
               |SI FSalida = 0;
                    nTagLinOrgPos = #0#1;
                    nTagLinPos = #refere0@#1;
                    |HAZ TagGrabaPos;
               |FINSI;
               |DESCARGA_DEF #refere0@;
          |FINSI;
     |FINSI;
|FPRC;

--------------------------------------------------
INI adj. lineas cod. blanco para tagloma
--------------------------------------------------
|PROCESO MiraSirve;
     |HAZ clicon;
     |SI nSwOk ! 0; |ACABA; |FINSI;

     |SI #10#15 = "S"; |ACABA; |FINSI;


     |ABRE #2; #2#0 = #10#2; |LEE 000#2=; |CIERRA #2;

     |SI #97#224 = "B";
          |SI #2#179 = "S";
               |SI #10#43 = #10#5; |Y #10#49 = #10#44; |ACABA; |FINSI;
          |SINO;
               |SI #10#43 = #10#5;  |ACABA; |FINSI;
          |FINSI;
     |SINO;
          |SI #10#43 = #10#5;  |ACABA; |FINSI;
          |SI #2#179 = "S";
               |SI #10#49 = #10#44; |ACABA; |FINSI;
          |FINSI;
     |FINSI;

     || si la linea se sirve graba el temporal
     #150#0 = #10#28;
     #150#1 = #10#0;
     |GRABA 040#150n;
|FPRC;

|DEFBUCLE CabSirve;
     #10#2;
     28, 15, 3;
     #3#2, #3#4,    0,     0,     0, r1,  f1,  #3#0, #3#8,  "N", #3#45;
     #3#3, #3#5,99.99, 99.99, 99.99,"zz","zz", #3#1, #3#10, "N", #3#46;
     be;
     NULL, MiraSirve;
|FIN;

|PROCESO CargaTmpAdj;
     |HAZ CreaTempo; Tmp150 = Tempo; |NOME_DAT #150 Tempo; |DELINDEX #150;
     |ABRE #150;
     |SI enNumPedido ! 0;
          #9#25 = eaSerPedido;
          #9#0 = enNumPedido;
          |LEE 101#9=;
          |SI FSalida = 0;
               |BUCLELIN 0 MiraSirve #9;
          |FINSI;
     |SINO;
          |BUCLE CabSirve;
     |FINSI;
|FPRC;

|PROCESO BorraTmpAdj;
     |CIERRA #150;
     Tempo = Tmp150; |HAZ BoraTempo; |DELINDEX #150;
|FPRC;
--------------------------------------------------
FIN adj. lineas cod. blanco para tagloma
--------------------------------------------------
|PROCESO ActDesanch;
     nEsta = 0;
     |DDEF aPath;
     aAlfa = aPath + "desan001";
     |CARGA_DEF aAlfa, refere0@;
     |SI FSalida = 0;
          |ABRE #refere0@;
          |SELECT #2#refere0@;
          #refere0@#1 = #0#2;
          |LEE 000#refere0@.=;
          |SI FSalida = 0; |Y #refere0@#3 = "S";
               nEsta = 1;
          |FINSI;
          |DESCARGA_DEF #refere0@;
     |FINSI;

     |SI nEsta = 0; |ACABA; |FINSI;

     aAlfa = aPath + "desan026";
     |CARGA_DEF aAlfa, refere0@;
     |SI FSalida = 0;
          |ABRE #refere0@;
          #refere0@#0 = #0#2;
          #refere0@#1 = #1#1;
          |SI #1#43 = "S";
               #refere0@#2 = "BV";
               nUni = #0#5;
          |SINO;
               #refere0@#2 = "AV";
               nUni = -#0#5;
          |FINSI;
          #refere0@#3 = #0#29;
          #refere0@#4 = #0#0;
          #refere0@#5 = #0#1;
          #refere0@#6 = nUni;
          #refere0@#7 = #1#3;
          |GRABA 020#refere0@.n;
          |CIERRA #refere0@;
          |DESCARGA_DEF #refere0@;
     |FINSI;

     aAlfa = aPath + "desan025";
     |CARGA_DEF aAlfa, refere0@;
     |SI FSalida = 0;
          |DDEFECTO #refere0@;
          |ABRE #refere0@;
          #refere0@#0 = #1#3;
          #refere0@#1 = #0#2;
          |LEE 101#refere0@.=;
          |SI FSalida ! 0; |GRABA 020#refere0@.b; |FINSI;
          #refere0@#2 = #refere0@#2 + nUni;
          |GRABA 020#refere0@.a;
          |CIERRA #refere0@;
          |DESCARGA_DEF #refere0@;
     |FINSI;
|FPRC;

|PROCESO DocWeb;
     |DDEF aAlfa;
     aAlfa = aAlfa + "coima038";
     |CARGA_DEF aAlfa, refere0@;
     |SI FSalida = 0;
          |ABRE #refere0@;
          #refere0@#0 = "AV";
          #refere0@#1 = #1#52;
          #refere0@#2 = #1#0;
          |LEE 101#refere0@.=;
          |SI FSalida ! 0; |GRABA 020#refere0@.b; |FINSI;
          #refere0@#3 = #1#1;
          #refere0@#4 = "N";
          |GRABA 020#refere0@.a;
          |CIERRA #refere0@;
          |DESCARGA_DEF #refere0@;
     |FINSI;
|FPRC;

|PROCESO tlfm0001;
     #tlfm0019@#0 = #tlfm0001@#0;
     #tlfm0019@#1 = #0#2;
     #tlfm0019@#2 = #1#1;
     |SI #1#43 = "S";
          #tlfm0019@#3 = "BV";
     |SINO;
          #tlfm0019@#3 = "AV";
     |FINSI;
     #tlfm0019@#4 = #0#29;
     #tlfm0019@#5 = #0#0;
     #tlfm0019@#6 = #0#1;
     #tlfm0019@#7 = 0;
     #tlfm0019@#8 = #0#3;
     #tlfm0019@#9 = #1#3;
     #tlfm0019@#10 = #0#6;
     |GRABA 020#tlfm0019@.n;
|FPRC;

|DEFBUCLE tlfm0001;
     #tlfm0001@#5003;
     ;
     #0#29, #0#0, #0#1;
     #0#29, #0#0, #0#1;
     ;
     NULL, tlfm0001;
|FIN;

|PROCESO HistoIMEI;
     |DDEF aDef;
     aAlfa = aDef + "tlfm0001";
     |CARGA_DEF aAlfa, tlfm0001@;
     |SI FSalida = 0;
          |ABRE #tlfm0001@;
          |SELECT #10#tlfm0001@;
          #tlfm0001@#58 = #0#31;
          #tlfm0001@#58 = #0#12;
          #tlfm0001@#58 = #0#21;
          |LEE 101#tlfm0001@.=;
          |SI FSalida = 0;
               #tlfm0001@#25 = #0#29;
               #tlfm0001@#26 = #0#0;
               #tlfm0001@#27 = #0#1;
               #tlfm0001@#28 = #1#1;
               |GRABA 020#tlfm0001@.a;
          |FINSI;
          |CIERRA #tlfm0001@;

          aAlfa = aDef + "tlfm0019";
          |CARGA_DEF aAlfa, tlfm0019@;
          |SI FSalida = 0;
               |ABRE #tlfm0019@;
               |BUCLE tlfm0001;
               |CIERRA #tlfm0019@;
               |DESCARGA_DEF #tlfm0019@;
          |FINSI;
          |DESCARGA_DEF #tlfm0001@;
     |SINO;
          |MENAV "0000Error al cargar 'tlfm0001'";
     |FINSI;
|FPRC;

|PROCESO QDClorCamAdj;
     |DDEF aPath;
     aAlfa = aPath + "qdclor08";
     |CARGA_DEF aAlfa, refere0@;
     |SI FSalida = 0;
          |DDEFECTO #refere0@;
          |ABRE #refere0@;
          #refere0@#0 = #0#29;
          #refere0@#1 = #0#0;
          #refere0@#2 = #0#1;
          |LEE 101#refere0@.=;
          |SI FSalida ! 0; |GRABA 020#refere0@.b; |FINSI;

          aAlfa = aPath + "qdclor06";
          |CARGA_DEF aAlfa, refere1@;
          |SI FSalida = 0;
               |DDEFECTO #refere1@;
               |ABRE #refere1@;
               #refere1@#0 = #10#28;
               #refere1@#1 = #10#0;
               #refere1@#2 = #10#1;
               |LEE 000#refere1@.=;
               |CIERRA #refere1@;
               #refere0@#3 = #refere1@#3; ||Envases
               #refere0@#4 = #refere1@#4; ||Tipo
               #refere0@#6 = #refere1@#8; ||Articulo
               |DESCARGA_DEF #refere1@;
          |FINSI;

          aAlfa = aPath + "qdclor01";
          |CARGA_DEF aAlfa, refere1@;
          |SI FSalida = 0;
               |DDEFECTO #refere1@;
               |ABRE #refere1@;
               #refere1@#0 = #0#2;
               |LEE 000#refere1@.=;
               |CIERRA #refere1@;
               #refere0@#5 = #refere1@#2; ||Emite Boletin
               |DESCARGA_DEF #refere1@;
          |FINSI;

          |GRABA 020#refere0@.a;
          |CIERRA #refere0@;
          |DESCARGA_DEF #refere0@;
     |FINSI;
|FPRC;
------------
|PROCESO EvaPenSer;
     aAlfa = #refere0@#0; |QBF aAlfa;
     |SI aAlfa = "";     || Si no tiene CB es un articulo normal, sin tallas
          nUni = #0#5;
     |SINO;
          nUni = 1;
     |FINSI;

     #refere0@#11 = "S";
     #refere0@#14 = #refere0@#14 + nUni;
     |GRABA 020#refere0@.a;

     |DDEFECTO #refere1@;
     #refere1@#0 = #0#29;
     #refere1@#1 = #0#0;
     #refere1@#2 = #0#1;
     #refere1@#3 = #0#2;
     #refere1@#5 = #0#31;
     #refere1@#6 = #0#12;
     #refere1@#7 = #0#21;
     #refere1@#9 = #1#1;
     #refere1@#10 = #1#3;
     #refere1@#11 = nUni;
     #refere1@#4 = #refere0@#3; || modelo
     #refere1@#8 = #refere0@#7; || referencia
     |SI aAlfa ! "";
          #refere1@#12 = #refere0@#2;|| talla
          #refere1@#13 = #refere0@#0; || CB
     |FINSI;
     |LEE 101#refere1@.=;
     |SI FSalida ! 0;
          |GRABA 020#refere1@.n;
     |SINO;
          |GRABA 020#refere1@.a;
     |FINSI;
|FPRC;

|DEFBUCLE EvaPenSer;
     #refere0@#3003;
     11;
     #0#31, #0#12, #0#21, "N";
     #0#31, #0#12, #0#21, "N";
     ;
     NULL, EvaPenSer;
|FIN;

|PROCESO EvaGraba;
     |DDEF aPath;
     aAlfa = aPath + "evarm021";
     |CARGA_DEF aAlfa, refere0@;
     |SI FSalida = 0;
          aAlfa = aPath + "evarm022";
          |CARGA_DEF aAlfa, refere1@;
          |SI FSalida = 0;
               |ABRE #refere1@;
               |BUCLE EvaPenSer;
               |CIERRA #refere1@;
          |SINO;
               |MENAV "0000Error al cargar 'refere1'";
          |FINSI;
          |DESCARGA_DEF #refere0@;
     |SINO;
          |MENAV "0000Error al cargar 'refere0'";
     |FINSI;
|FPRC;

|PROCESO CtrlRiesgoTaglo;
     |SI nSwTagloma = 0; |Y enNumPedido ! 0;
          |SI nPriTaglo = 0;
               nPriTaglo = 1;
               |DDEF aAlfa; aAlfa = aAlfa + "tagm0059";
               |CARGA_DEF aAlfa, refere0@;
               |SI FSalida = 0;
                    |ABRE #refere0@;
                    #refere0@#0 = eaSerAlb;
                    |LEE 000#refere0@.=;
                    |SI FSalida = 0;
                         |CONFI "0000N¿El pago se realizará en efectivo?";
                         |SI FSalida = 0; nSwOk = 0; |FINSI;
                    |FINSI;
                    |CIERRA #refere0@;
                    |DESCARGA_DEF #refere0@;
               |FINSI;
               nSwRieTaglo = nSwOk;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO OrtsRepreCab;
     |DDEF aAlfa;
     aAlfa = aAlfa + "ortsm021";
     |CARGA_DEF aAlfa, refere0@;
     |SI FSalida = 0;
          |ABRE #refere0@;
          #refere0@#0 = "P";
          #refere0@#1 = #9#25;
          #refere0@#2 = #9#0;
          |LEE 000#refere0@.=;
          |SI FSalida = 0;
               #refere0@#0 = "A";
               #refere0@#1 = #1#52;
               #refere0@#2 = #1#0;
               |GRABA 020#refere0@.n;
          |FINSI;
          |CIERRA #refere0@;
          |DESCARGA_DEF #refere0@;
     |SINO;
          |MENAV "0000Error al cargar 'ortsm021'...";
     |FINSI;
|FPRC;

|PROCESO OrtsRepreLin;
     |DDEF aAlfa;
     aAlfa = aAlfa + "ortsm022";
     |CARGA_DEF aAlfa, refere0@;
     |SI FSalida = 0;
          |ABRE #refere0@;
          #refere0@#0 = "P";
          #refere0@#1 = #10#28;
          #refere0@#2 = #10#0;
          #refere0@#3 = #10#1;
          |LEE 000#refere0@.=;
          |SI FSalida = 0;
               #refere0@#0 = "A";
               #refere0@#1 = #0#29;
               #refere0@#2 = #0#0;
               #refere0@#3 = #0#1;
               |GRABA 020#refere0@.n;
          |FINSI;
          |CIERRA #refere0@;
          |DESCARGA_DEF #refere0@;
     |SINO;
          |MENAV "0000Error al cargar 'ortsm022'...";
     |FINSI;
|FPRC;

|PROCESO ChampiEmarPortes;
     |DDEF aPath;
     aAlfa = aPath + "agifa071";
     |CARGA_DEF aAlfa, refere1@;
     |SI FSalida = 0;
          nEsta = 0;
          |ABRE #refere1@;
          |SELECT #4#refere1@;
          #refere1@#31 = #0#31;
          #refere1@#12 = #0#12;
          #refere1@#21 = 1;
          |LEE 000#refere1@.];
          |PARA; |SI FSalida = 0; |Y #refere1@#31 = #0#31; |Y #refere1@#12 = #0#12; |HACIENDO;
               |SI #refere1@#29 ! #0#29; |O #refere1@#0 ! #0#0; |O  #refere1@#1 ! #0#1;
                    nEsta = 1;
               |FINSI;
               |LEE 000#refere1@.s;
          |SIGUE;
          |CIERRA #refere1@;

          |SI nEsta = 0;
               aAlfa = aPath + "champi14";
               |CARGA_DEF aAlfa, refere0@;
               |SI FSalida = 0;
                    |ABRE #refere0@;
                    #refere0@#0 = #9#25;
                    #refere0@#1 = #9#0;
                    |LEE 000#refere0@.=;
                    |SI FSalida ! 0; |DDEFECTO #refere0@; |FINSI;

                    || por servir
                    #9#12 = #9#12 - #refere0@#2;
                    #9#43 = #9#43 - #refere0@#2;
                    #9#46 = #9#46 - #refere0@#2;
                    #9#49 = #9#49 - #refere0@#2;

                    || servido
                    #9#13 = #9#13 + #refere0@#2;
                    #9#44 = #9#44 + #refere0@#2;
                    #9#47 = #9#47 + #refere0@#2;
                    #9#50 = #9#50 + #refere0@#2;

                    |DESCARGA_DEF #refere0@;
               |FINSI;
          |FINSI;
          |DESCARGA_DEF #refere1@;
     |FINSI;
|FPRC;
