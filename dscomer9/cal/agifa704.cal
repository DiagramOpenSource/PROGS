|FICHEROS;
   agifa704 #0;
   agifa705 #1,MANTE;
   agifa706 #2,MANTE;
   agifa708 #4,MANTE;
   agifa709 #5,MANTE;

   agifa702 #6;
   agifa700 #7;

   agifa707 #8,MANTE;
   agifa717 #9,MANTE;
   agifa718 #15,MANTE;
   referen@ #10;
   caconce@ #11;

   canempr@ #12;
   agifa710 #13;
   agifa723 #14;
   refere1@ #15;
   calibro@ #20;
   caivses@ #21;

   agifa734 #30,MANTE;

   RefDato@ #500;
   RefDat1@ #501;
|FIN;

|VARIABLES;
   &eaAlfa = "";
   &eaTipoEnlace = "";
   &nDeci_nDec = 0;

   aAlfa  = ""; aAlfa1 = "";
   nCalc  = 0;  nCalc1 = 0;
   nCalc2 = 0;

   nSwErr = 0;

   aCuenta = ""; aDescri = ""; aImport = ""; aDepart = ""; SwDep = 0;
   aCmpClv = "";

   aFichC = ""; aFichP = "";

   nFlag = 0;
   Cont  = 0;
   ComodNum = 0;
   Comodin = "";
   Comodin1 = "";
   Comodin2 = "";
   Salir = 0;
   NumCampos = 0;
   DefCargado = "";
   Direc = "";
   aFormato = "";

   nTecla = 0;

   ModoEntrada = 0;
   TipoDato = ""; LongDato = 0;

   Linea = 0; LinCmps = 0;
   TipoCampo1 = "";
   TipoCampo2 = "";
   Fich = "";  NumCampo = 0; Cmp = ""; NomFich = "";

   aLong = ""; nLong = 0; Calc = 0; nPosic = 0;
   Tecla = 0; acota = 0; LinAcot = 0; Parte1 = ""; Parte2 = "";
   ConcepAntes = 0;

   MaxDig = 0; Nivel = 0;
|FIN;

|PROCESO PintaTipo;
   |SI #agifa704#2 = "FV"; #agifa704#3 = "FACTURAS VENTA      "; |FINSI;
   |SI #agifa704#2 = "FC"; #agifa704#3 = "FACTURAS COMPRA     "; |FINSI;
   |SI #agifa704#2 = "FD"; #agifa704#3 = "FACTURAS DIRECTAS   "; |FINSI;
   |SI #agifa704#2 = "TI"; #agifa704#3 = "TICKETS             "; |FINSI;
   |SI #agifa704#2 = "CC"; #agifa704#3 = "CIERRE CAJA         "; |FINSI;
   |SI #agifa704#2 = "CR"; #agifa704#3 = "CREDITOS            "; |FINSI;
   |PINTA #agifa704#3;
|FPRC;

|RUTINA inf;
   #agifa705#0 = #agifa704#0;
   #agifa705#2 = 000001;
|FRUT;

|RUTINA sup;
   #agifa705#0 = #agifa704#0;
   #agifa705#2 = 999999;
|FRUT;

|PROCESO EntraLineas;
   |ENTLINEAL #1#agifa705,-2,2,16,1,inf,sup;
   |PUSHV 0501 2380;
   |PINTA 1015, aCmpClv; |PTEC 809; |PTEC 808;
   |ENTLINEAL #1#agifa707,-2,1,22,1,inf4,sup4;
   |POPV;
|FPRC;

|RUTINA inf717;
   #agifa717#0 = #agifa704#0;
   #agifa717#1 = "               ";
|FRUT;

|RUTINA sup717;
   #agifa717#0 = #agifa704#0;
   #agifa717#1 = "zzzzzzzzzzzzzzz";
|FRUT;

|RUTINA inf1;
   #agifa706#0 = #agifa704#0;
   #agifa706#1 = #agifa705#2;
   #agifa706#2 = 0001;
|FRUT;

|RUTINA sup1;
   #agifa706#0 = #agifa704#0;
   #agifa706#1 = #agifa705#2;
   #agifa706#2 = 9999;
|FRUT;

|RUTINA inf2;
   #agifa708#0 = 001;
   #agifa708#6 = TipoCampo1;
|FRUT;

|RUTINA sup2;
   #agifa708#0 = 999;
   #agifa708#6 = TipoCampo2;
|FRUT;

|RUTINA inf3;
   #agifa709#3 = #agifa704#0;
   #agifa709#4 = #agifa705#2;
   #agifa709#5 = #agifa706#2;
   |SI acota = 0;
      |SI TipoCampo1 = "A";
         #agifa709#6 = "E";
      |SINO;
         #agifa709#6 = TipoCampo1;
      |FINSI;
   |SINO;
      #agifa709#6 = TipoCampo1;
   |FINSI;
   #agifa709#0 = 1;
|FRUT;

|RUTINA sup3;
   #agifa709#3 = #agifa704#0;
   #agifa709#4 = #agifa705#2;
   #agifa709#5 = #agifa706#2;
   |SI acota = 0;
      |SI TipoCampo2 = "A";
         #agifa709#6 = "E";
      |SINO;
         #agifa709#6 = TipoCampo2;
      |FINSI;
   |SINO;
      #agifa709#6 = TipoCampo2;
   |FINSI;
   #agifa709#0 = 999;
|FRUT;

|RUTINA inf4;
   #agifa707#0 = 001;
   #agifa707#15 = #agifa704#0;
|FRUT;

|RUTINA sup4;
   #agifa707#0 = 999;
   #agifa707#15 = #agifa704#0;
|FRUT;

|RUTINA InfAcota;
   #agifa709#3 = #agifa704#0;
   #agifa709#4 = #agifa705#2;
   #agifa709#5 = #agifa706#2;
   #agifa709#6 = "A";
   #agifa709#0 = 1;
|FRUT;

|RUTINA SupAcota;
   #agifa709#3 = #agifa704#0;
   #agifa709#4 = #agifa705#2;
   #agifa709#5 = #agifa706#2;
   #agifa709#6 = "A";
   #agifa709#0 = 999;
|FRUT;

|PROCESO DefineLinea; |TIPO 3;
   #agifa705#1 = #agifa706#2;
   |ENTLINEAL #1#agifa706,-3,1,22,1,inf1,sup1;
|FPRC;

|PROCESO PresentaLineas; |TIPO 13;
   |ENTLINEAL #1#agifa705,-2,7,16,1,inf,sup;
   |ENTLINEAL #1#agifa706,-3,7,22,1,inf1,sup1;
   |HAZ PintaDatos;
   |SI #agifa704#17 ! 999;
      aCmpClv = &196 * 60;
      |DDEF aAlfa; |QBF aAlfa; aAlfa = aAlfa + #agifa704#16 + ".mas";
      |CARGA_DEF aAlfa, refere1@;
      |SI FSalida = 0;
         aCmpClv = " Campo clave enlace : ["; aAlfa1 = "|TITULO";
         aAlfa1 = #refere1@#aAlfa1#; aCmpClv = aCmpClv + aAlfa1 + "][";
         aAlfa1 = "|C" + (("000" + #agifa704#17) % -103) + "NOMBRE";
         aAlfa1 = #refere1@#aAlfa1#; aCmpClv = aCmpClv + aAlfa1 + "]";
      |FINSI;
   |SINO;
      aCmpClv = &196 * 60;
   |FINSI;

   |PINTA 1015, aCmpClv;
   |ATRI I;
   |SI #agifa704#18 = "A"; |PINTA 0545, " Formato fechas automatico      "; |FINSI;
   |SI #agifa704#18 = "B"; |PINTA 0545, " Formato fechas manual          "; |FINSI;
   |SI #agifa704#18 = "C"; |PINTA 0545, " Formato fechas manual contable "; |FINSI;
   |ATRI N;
|FPRC;

|PROCESO Borra3;
   |BORRA 020#agifa707.a;
|FPRC;

|DEFBUCLE Borra3;
#agifa707#1;
;
#agifa704#0,001;
#agifa704#0,999;
;
NULL,Borra3;
|FIN;

|PROCESO BorraLins;
   |BORRA 020#agifa709.a;
|FPRC;

|DEFBUCLE BorraLins;
#agifa709#1;
;
#agifa704#0,#agifa705#2,#agifa706#2," ",001;
#agifa704#0,#agifa705#2,#agifa706#2,"z",999;
;
NULL,BorraLins;
|FIN

|PROCESO Borra2;
   |ABRE #agifa709;
   |BUCLE BorraLins;
   |CIERRA #agifa709;
   |BORRA 020#agifa706.a;
|FPRC;

|DEFBUCLE Borra2;
#agifa706#1;
;
#agifa704#0,000001,0001;
#agifa704#0,999999,9999;
;
NULL,Borra2;
|FIN;

|PROCESO Borra1;
   |BORRA 020#agifa705.a;
|FPRC;

|DEFBUCLE Borra1;
#agifa705#1;
;
#agifa704#0,000001;
#agifa704#0,999999;
;
NULL,Borra1;
|FIN;

|PROCESO BorraLineas; |TIPO 1;
   ModoEntrada = (FEntrada / 100) ! 0;
   |SI ModoEntrada = 3;
      |ABRE #agifa705;
      |ABRE #agifa706;
      |BUCLE Borra3;
      |BUCLE Borra2;
      |BUCLE Borra1;
      |CIERRA #agifa706;
      |CIERRA #agifa705;
   |SINO;
      Comodin = #agifa704#6; |QBF Comodin;
      |SI Comodin ! "";
         Comodin1 = Comodin + "def/canempre.mas";
         |CARGA_DEF Comodin1 , canempr@;
         |SI FSalida = 0;
            Comodin1 = Comodin + "fich/";
            |PATH_DAT #12 Comodin1;
            |ABRE #canempr@;
            #canempr@#2 = #agifa704#4;
            #canempr@#3 = #agifa704#5;
            |LEE 010#canempr@.=;
            |SI FSalida = 0;
               |PINTA 0831, #canempr@#1;
            |FINSI;
            |CIERRA #canempr@;
            |DESCARGA_DEF #canempr@;
         |FINSI;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO Campos;

   |DDEF aAlfa; |QBF aAlfa; aAlfa = aAlfa + #agifa702#1 + ".mas";
   |CARGA_DEF aAlfa, RefDat1@;
   |SI FSalida = 0;
      aAlfa = "|TITULO"; aAlfa = #RefDat1@#aAlfa#;
      #agifa700#1 = aAlfa;
      |DESCARGA_DEF #RefDat1@;
   |SINO;
      #agifa700#0 = #agifa702#1;
      |LEE 000#agifa700.=;
   |FINSI;

   |DDEFECTO #agifa708;

   #agifa708#0 = Linea;  Linea = Linea + 1;
   #agifa708#1 = #agifa702#1;
   #agifa708#2 = #agifa700#1;
   #agifa708#3 = #agifa702#4;
   #agifa708#4 = #agifa702#2;
   #agifa708#5 = #agifa702#3;
   #agifa708#6 = #agifa702#5;
   |GRABA 020#agifa708.n;
|FPRC;

|DEFBUCLE Ficheros;
#agifa702#1;
4,5;
001,#agifa704#2,TipoCampo1;
999,#agifa704#2,TipoCampo2;
;
NULL,Campos;
|FIN;

|PROCESO Interpreta;
   Comodin1 = #agifa709#1 % 0102;
   |SI Comodin1 = "[%";
      Comodin1 = #agifa709#1 % 0105; |QBF Comodin1;
   |SINO;
      Comodin1 = #agifa709#2 % 0101;
   |FINSI;

   Comodin2 = #agifa709#2 % 0299; |QBF Comodin2;
   Comodin1 = Comodin1 + Comodin2; |QBF Comodin1;
   |SI Comodin1 = "";
      Comodin1 = #agifa709#1; |QBF Comodin1;
   |FINSI;
   Comodin = Comodin + Comodin1;
|FPRC;

|DEFBUCLE Interpreta;
#agifa709#1;
;
#agifa704#0,#agifa705#2,#agifa706#2,TipoCampo1,001;
#agifa704#0,#agifa705#2,#agifa706#2,TipoCampo1,999;
;
NULL,Interpreta;
|FIN;

|PROCESO EditaLineas; |TIPO 13;
   |SI FSalida = 10;
      |SI acota = 0;
         |ENTLINEAL #1#agifa709,-5,1,22,1,inf3,sup3;
         |ENTLINEAL #1#agifa709,5,7,22,1,inf3,sup3;
      |SINO;
         |ENTLINEAL #1#agifa709,-5,1,22,1,InfAcota,SupAcota;
         |ENTLINEAL #1#agifa709,5,7,22,1,InfAcota,SupAcota;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO LinFichero; |TIPO 0;
   LinCmps = 0;
   |SALVA_FICHA #agifa709;
   #agifa709#3 = #agifa704#0;
   #agifa709#4 = #agifa705#2;
   #agifa709#5 = #agifa706#2;
   |SI acota = 1;
      #agifa709#6 = "A";
   |SINO;
      |SI TipoCampo1 = "A";
         #agifa709#6 = "E";
      |SINO;
         #agifa709#6 = TipoCampo1;
      |FINSI;
   |FINSI;
   #agifa709#0 = 1;
   |LEE 010#agifa709.];
   |SI FSalida ! 0; LinCmps = 10; |FINSI;
   |PARA; |SI FSalida = 0; |HACIENDO;
      |SI acota = 0;
         |SI #agifa709#3 = #agifa704#0; |Y #agifa709#4 = #agifa705#2;
         |Y #agifa709#5 = #agifa706#2;  |Y #agifa709#6 = TipoCampo1;
            LinCmps = #agifa709#0 + 10;
            |LEE 010#agifa709.s;
         |SINO;
            |SI LinCmps = 0; LinCmps = 10; |FINSI;
            |SAL;
         |FINSI;
      |SINO;
         |SI #agifa709#3 = #agifa704#0; |Y #agifa709#4 = #agifa705#2;
         |Y #agifa709#5 = #agifa706#2;  |Y #agifa709#6 = "A";
            LinCmps = #agifa709#0 + 10;
            |LEE 010#agifa709.s;
         |SINO;
            |SI LinCmps = 0; LinCmps = 10; |FINSI;
            |SAL;
         |FINSI;
      |FINSI;
   |SIGUE;
   |REPON_FICHA #agifa709;

   |DDEFECTO #agifa709;
   #agifa709#0 = LinCmps;
   Comodin = "[" + #agifa708#2; |QBF Comodin;
   Comodin = Comodin + "][" + #agifa708#5; |QBF Comodin;
   Comodin = Comodin + "]";
   #agifa709#1 = Comodin;
   Comodin = "[" + #agifa708#1; |QBF Comodin;
   Comodin1 = ("000" + #agifa708#4) % -103;
   Comodin = Comodin + "][" + Comodin1 + "]";
   #agifa709#2 = Comodin;
   #agifa709#3 = #agifa704#0;
   #agifa709#4 = #agifa705#2;
   #agifa709#5 = #agifa706#2;
   |SI acota = 0;
      |SI TipoCampo1 = "A";
         #agifa709#6 = "E";
      |SINO;
         #agifa709#6 = TipoCampo1;
      |FINSI;
   |SINO;
      #agifa709#6 = "A";
   |FINSI;

   |GRABA 020#agifa709.n;
   |SI acota = 0;
      |ENTLINEAL #1#agifa709,-5,7,22,1,inf3,sup3;
   |SINO;
      |ENTLINEAL #1#agifa709,-5,7,22,1,InfAcota,SupAcota;
   |FINSI;
|FPRC;

|PROCESO Selec;

   |SI FSalida = 10;
      aAlfa = "hc" + Usuario; |NOME_DAT #agifa708#aAlfa#;
      |DELINDEX #agifa708;

      aAlfa = "gc" + Usuario; |NOME_DAT #agifa700#aAlfa#;
      |ABRE #agifa700;
      |ABRE #agifa702;
      |ABRE #agifa708;
      |ABRE #agifa709;

      SwDep = 0;
      |SI Campo = 3;  TipoCampo1 = "C"; TipoCampo2 = "C"; |FINSI;
      |SI Campo = 6;  TipoCampo1 = "D"; TipoCampo2 = "D"; |FINSI;
      |SI Campo = 8;  TipoCampo1 = "I"; TipoCampo2 = "I"; |FINSI;
      |SI Campo = 15; TipoCampo1 = "A"; TipoCampo2 = "A"; SwDep = 1; |FINSI;
      Linea = 1;
      |BUCLE Ficheros;

      |PUSHV 0501 2380;
      |PINPA #0#0;
      |PINPA #0#1;
      Salir = 0;
      |ENTLINEAL #1#agifa709,-5,7,22,1,inf3,sup3;
      |ENTLINEAL #2#agifa708,-1,4,13,1,inf2,sup2;

      |POPV;

      |CIERRA #agifa709;
      |CIERRA #agifa708;
      |CIERRA #agifa702;
      |CIERRA #agifa700;

      Comodin = "";
      |SI SwDep = 1; SwDep = 0; TipoCampo1 = "E"; TipoCampo2 = "E"; |FINSI;
      |BUCLE Interpreta;
      |SI TipoCampo1 = "C"; #agifa706#3  = Comodin; |PINTA #agifa706#3;  |FINSI;
      |SI TipoCampo1 = "D"; #agifa706#6  = Comodin; |PINTA #agifa706#6;  |FINSI;
      |SI TipoCampo1 = "I"; #agifa706#8  = Comodin; |PINTA #agifa706#8;  |FINSI;
      |SI TipoCampo1 = "E"; #agifa706#15 = Comodin; |PINTA #agifa706#15; |FINSI;

      |SI Comodin = ""; |ERROR; |FINSI;
      |PTEC 808; |PTEC 809;
   |FINSI;
   |SI FSalida = 11; |Y Campo = 8;
      |PUSHV 0501 2380;
      |CLS;
      |PINPA #0#agifa717; |PINDA #0#agifa717;
      |ATRI R; |PINTA 0502, " EDICION DE MEMORIAS PARA ENLACE      ";
      |ATRI N; |PINTA 0535, #agifa704#0;
      |ATRI N; |PINTA 0540, #agifa704#1;
      |ENTLINEAL #1#agifa717,-2,1,20,1,inf717,sup717;
      |POPV;
   |FINSI;
|FPRC;

|PROCESO Acotacion;
   Comodin = #agifa709#2; |QBF Comodin;
   |SI Comodin ! "";
      Comodin1 = #agifa709#2; |QBF Comodin1;
      Comodin1 = Comodin1 - "][";
      |SI FSalida ! 0;
         nPosic = FSalida;
         #agifa707#15 = #agifa704#0;
         #agifa707#0  = 1;
         |LEE 010#agifa707.=;
         |SI FSalida ! 0;
            LinAcot = 1;
         |SINO;
            |PARA; |SI FSalida = 0; |Y #agifa707#15 = #agifa704#0; |HACIENDO;
               LinAcot = #agifa707#0 + 1;
               |LEE 010#agifa707.s;
            |SIGUE;
         |FINSI;

         |DDEFECTO #agifa707;
         #agifa707#15 = #agifa704#0;
         #agifa707#16 = #agifa709#0;
         #agifa707#0 = LinAcot;
         Calc = ((nPosic / 100) ! 0) + 99;
         Comodin2 = Comodin1 % Calc; Comodin2 = Comodin2 - "[";
         #agifa707#13 = Comodin2; Comodin1 = Comodin1 - Comodin2;
         Comodin2 = Comodin1 - "[";
         Comodin2 = Comodin2 - "]";
         #agifa707#14 = Comodin2;

         |DBASE Direc; |QBF Direc;
         Direc = Direc + "def/" + #agifa707#13; |QBF Direc;
         Direc = Direc + ".mas"; |QBF Direc;
         |CARGA_DEF Direc, referen@;
         |SI FSalida = 0;
            |ABRE #referen@;
            Comodin1 = "|TITULO";
            #agifa707#1 = #referen@#Comodin1#;
            Comodin1 = #agifa707#14; |QBF Comodin1;
            Comodin1 = ("000" + Comodin1) % -103;
            Comodin2 = "|C" + Comodin1 + "TIPO";
            #agifa707#11 = #referen@#Comodin2#;
            Comodin2 = "|C" + Comodin1 + "LONGITUD";
            #agifa707#12 = #referen@#Comodin2#;
            Comodin2 = "|C" + Comodin1 + "NOMBRE";
            #agifa707#2 = #referen@#Comodin2#;
            Comodin2 = "|C" + Comodin1 + "MINIMO";
            |SI #agifa707#11 = "A"; #agifa707#3 = #referen@#Comodin2#; |FINSI;
            |SI #agifa707#11 = "N"; #agifa707#5 = #referen@#Comodin2#; |FINSI;
            |SI #agifa707#11 = "F"; #agifa707#7 = "01.01.1900";        |FINSI;
            Comodin2 = "|C" + Comodin1 + "MAXIMO";
            |SI #agifa707#11 = "A"; #agifa707#4 = #referen@#Comodin2#; |FINSI;
            |SI #agifa707#11 = "N"; #agifa707#6 = #referen@#Comodin2#; |FINSI;
            |SI #agifa707#11 = "F"; #agifa707#8 = "31.12.2999";        |FINSI;

            |SI #agifa707#11 = "A";
               Comodin = " " * #agifa707#12;
               Comodin1 = #agifa707#3; |QBF Comodin1;
               Comodin2 = #agifa707#4; |QBF Comodin2;
            |FINSI;

            |SI #agifa707#11 = "N";
               Comodin = "";
               Comodin1 = #agifa707#5; |QBF Comodin1;
               Comodin2 = #agifa707#6; |QBF Comodin2;
            |FINSI;

            |SI #agifa707#11 = "F";
               Comodin = "";
               Comodin1 = "   " + #agifa707#7; |QBF Comodin1;
               Comodin2 = "   " + #agifa707#8; |QBF Comodin2;
            |FINSI;

            |SI #agifa707#11 ! "F";
               Calc = 0 - (#agifa707#12 + 100);
               Comodin1 = (Comodin + Comodin1) % Calc;
               Comodin2 = (Comodin + Comodin2) % Calc;
            |FINSI;
            #agifa707#9  = Comodin1;
            #agifa707#10 = Comodin2;

            |GRABA 020#agifa707.n;
            |CIERRA #referen@;
            |DESCARGA_DEF #referen@;
         |FINSI;
      |FINSI;
   |FINSI;
|FPRC;

|DEFBUCLE Acotacion;
#agifa709#1;
;
#agifa704#0,#agifa705#2,#agifa706#2,"A",001;
#agifa704#0,#agifa705#2,#agifa706#2,"A",999;
;
NULL,Acotacion;
|FIN;

|PROCESO BorraAcot;
   |BORRA 020#agifa707.a;
|FPRC;

|DEFBUCLE BorraAcot;
#agifa707#1;
;
#agifa704#0,001;
#agifa704#0,999;
;
NULL,BorraAcot;
|FIN;

|PROCESO EscogeFich;

      ModoEntrada = (FEntrada / 100) ! 0;
      |SI ModoEntrada = 1;

         aAlfa = "hc" + Usuario; |NOME_DAT #agifa708#aAlfa#;
         |DELINDEX #agifa708;

         |ABRE #agifa700;
         |ABRE #agifa702;
         |ABRE #agifa708;
         |ABRE #agifa709;

         |BUCLE BorraAcot;
         Linea = 1;
         TipoCampo1 = " "; TipoCampo2 = "z";
         |BUCLE Ficheros;
         acota = 1; TipoCampo1 = "A"; TipoCampo2 = "A";
         #agifa705#2 = 1; #agifa706#2 = 1;

         |PUSHV 0501 2380;
         |PINPA #0#0;
         |PINPA #0#1;
         |ENTLINEAL #1#agifa709,-5,7,22,1,InfAcota,SupAcota;
         |ENTLINEAL #2#agifa708,-1,4,13,1,inf2,sup2;

         acota = 0;
         |PINDA #0#agifa707;
         |POPV;

         |CIERRA #agifa709;
         |CIERRA #agifa708;
         |CIERRA #agifa700;

         |BUCLE Acotacion;
         #agifa707#15 = #agifa704#0;
         #agifa707#0  = 1;
         |LEE 000#agifa707.];

      |SINO;

         TipoDato = #agifa707#11; LongDato = #agifa707#12;
         |SI TipoDato = "A";
            |CAMPO_ANCHO #agifa707#3,1,LongDato;
            |CAMPO_MAXIMO #agifa707#3,1,"#";
            |CAMPO_ANCHO #agifa707#4,1,LongDato;
            |CAMPO_MAXIMO #agifa707#4,1,"#";
            |C_M #agifa707#3,1,"S"; |C_V #agifa707#3,1,"S"; |PINTA #agifa707#3;
            |C_M #agifa707#4,1,"S"; |C_V #agifa707#4,1,"S"; |PINTA #agifa707#4;
            |C_M #agifa707#5,1,"N"; |C_V #agifa707#5,1,"N";
            |C_M #agifa707#6,1,"N"; |C_V #agifa707#6,1,"N";
            |C_M #agifa707#7,1,"N"; |C_V #agifa707#7,1,"N";
            |C_M #agifa707#8,1,"N"; |C_V #agifa707#8,1,"N";
         |FINSI;
         |SI TipoDato = "N";
            |C_M #agifa707#3,1,"N"; |C_V #agifa707#3,1,"N";
            |C_M #agifa707#4,1,"N"; |C_V #agifa707#4,1,"N";
            |C_M #agifa707#5,1,"S"; |C_V #agifa707#5,1,"S"; |PINTA #agifa707#5;
            |C_M #agifa707#6,1,"S"; |C_V #agifa707#6,1,"S"; |PINTA #agifa707#6;
            |C_M #agifa707#7,1,"N"; |C_V #agifa707#7,1,"N";
            |C_M #agifa707#8,1,"N"; |C_V #agifa707#8,1,"N";
         |FINSI;
         |SI TipoDato = "F";
            |C_M #agifa707#3,1,"N"; |C_V #agifa707#3,1,"N";
            |C_M #agifa707#4,1,"N"; |C_V #agifa707#4,1,"N";
            |C_M #agifa707#5,1,"N"; |C_V #agifa707#5,1,"N";
            |C_M #agifa707#6,1,"N"; |C_V #agifa707#6,1,"N";
            |C_M #agifa707#7,1,"S"; |C_V #agifa707#7,1,"S"; |PINTA #agifa707#7;
            |C_M #agifa707#8,1,"S"; |C_V #agifa707#8,1,"S"; |PINTA #agifa707#8;
         |FINSI;
      |FINSI;
|FPRC;

|PROCESO TomaValor; |TIPO 2;
   nFlag = 0 +. 1;
   |SI nFlag < 0; |ACABA; |FINSI;

   |SI TipoDato = "A"; #agifa707#9 = #agifa707#3; #agifa707#10 = #agifa707#4; |FINSI;
   |SI TipoDato = "N"; #agifa707#9 = #agifa707#5; #agifa707#10 = #agifa707#6; |FINSI;
   |SI TipoDato = "F"; #agifa707#9 = "   " + #agifa707#7; #agifa707#10 = "   "+ #agifa707#8; |FINSI;

   |SI Campo = 4; |O Campo = 6; |O Campo = 8;
      |C_M #agifa707#3,1,"N"; |C_V #agifa707#3,1,"N";
      |C_M #agifa707#4,1,"N"; |C_V #agifa707#4,1,"N";
      |C_M #agifa707#5,1,"N"; |C_V #agifa707#5,1,"N";
      |C_M #agifa707#6,1,"N"; |C_V #agifa707#6,1,"N";
      |C_M #agifa707#7,1,"N"; |C_V #agifa707#7,1,"N";
      |C_M #agifa707#8,1,"N"; |C_V #agifa707#8,1,"N";
                              |C_V #agifa707#9,1,"S";
                              |C_V #agifa707#10,1,"S";
   |FINSI;
|FPRC;

|PROCESO MiraPath;
  |SI Campo ! 0;
   |SI FSalida = 10;
      |DBASS Comodin; |QBF Comodin;
      Comodin = Comodin + "contagen/";
      #agifa704#6 = Comodin;
      |PINTA #agifa704#6;
   |FINSI;

   Comodin = #agifa704#6; |QBF Comodin;
   aLong = Comodin % 0; nLong = aLong;
   Calc = (nLong * 100) + 1;
   Comodin1 = Comodin % Calc;
   |SI Comodin1 ! "/"; |Y Comodin1 ! "\";
      Comodin = Comodin + "/";
      #agifa704#6 = Comodin; |PINTA #agifa704#6;
   |FINSI;
|FINSI;

   |BLANCO 0904 0976;
   aAlfa = #agifa704#6; |QBF aAlfa; aAlfa = aAlfa < aAlfa;
   aAlfa = aAlfa - "contagen";
   |SI FSalida ! 0; |O aAlfa = "";
      |PINTA 0904, " Libro IVA :                                                             ";
      #agifa704#9 = "N";
      |C_V #agifa704#9,  1, "N"; |C_M #agifa704#9,  1, "N";
      |C_V #agifa704#10, 1, "N"; |C_M #agifa704#10, 1, "N";
      |C_V #agifa704#11, 1, "N"; |C_M #agifa704#11, 1, "N";
      |C_P #agifa704#14,1,0917; |C_P #agifa704#15,1,0920;
      |C_M #agifa704#14,1,"S";  |C_V #agifa704#14,1,"S"; |PINTA #agifa704#14;
      |C_V #agifa704#15,1,"S"; |PINTA #agifa704#15;
   |SINO;
      |PINTA 0904, " Enlace intracomunitario     Libro                  Serie                ";
      |C_V #agifa704#9,  1, "S"; |C_M #agifa704#9,  1, "S"; |PINTA #agifa704#9;
      |C_V #agifa704#10, 1, "S"; |C_M #agifa704#10, 1, "S"; |PINTA #agifa704#10;
      |C_V #agifa704#11, 1, "S"; |C_M #agifa704#11, 1, "S"; |PINTA #agifa704#11;
      |C_V #agifa704#12, 1, "S";                            |PINTA #agifa704#12;
      |C_V #agifa704#13, 1, "S";                            |PINTA #agifa704#13;
      |C_M #agifa704#14, 1, "N"; |C_V #agifa704#14, 1, "N";
   |FINSI;
|FPRC;

|PROCESO MiraEmpresas;
   Tecla = FSalida;
   |SI Tecla = 2; |ACABA; |FINSI;
   Comodin1 = Comodin + "def/canempre.mas";
   |CARGA_DEF Comodin1 , canempr@;
   |SI FSalida = 0;
      Comodin1 = Comodin + "fich/";
      |PATH_DAT #12 Comodin1;
      |ABRE #canempr@;
      |SI Tecla = 10;
         |CONSULTA_CLAVE #1#canempr@;
         |SI FSalida ] 0;
            #agifa704#4 = #canempr@#2; |PINTA #agifa704#4;
            #agifa704#5 = #canempr@#3; |PINTA #agifa704#5;
            MaxDig = 0;
            |SI MaxDig < #canempr@#14; MaxDig = #canempr@#14; Nivel = 1; |FINSI;
            |SI MaxDig < #canempr@#15; MaxDig = #canempr@#15; Nivel = 2; |FINSI;
            |SI MaxDig < #canempr@#16; MaxDig = #canempr@#16; Nivel = 3; |FINSI;
            |SI MaxDig < #canempr@#17; MaxDig = #canempr@#17; Nivel = 4; |FINSI;
            |SI MaxDig < #canempr@#18; MaxDig = #canempr@#18; Nivel = 5; |FINSI;
            |SI MaxDig < #canempr@#19; MaxDig = #canempr@#19; Nivel = 6; |FINSI;
         |FINSI;
      |SINO;
         #canempr@#2 = #agifa704#4;
         #canempr@#3 = #agifa704#5;
         |LEE 010#canempr@.=;
         |SI FSalida ! 0;
            |MENAV "    No existe empresa";
            |ERROR;
         |FINSI;
      |FINSI;
      |PINTA 0831, #canempr@#1;
      MaxDig = 0;
      |SI MaxDig < #canempr@#14; MaxDig = #canempr@#14; Nivel = 1; |FINSI;
      |SI MaxDig < #canempr@#15; MaxDig = #canempr@#15; Nivel = 2; |FINSI;
      |SI MaxDig < #canempr@#16; MaxDig = #canempr@#16; Nivel = 3; |FINSI;
      |SI MaxDig < #canempr@#17; MaxDig = #canempr@#17; Nivel = 4; |FINSI;
      |SI MaxDig < #canempr@#18; MaxDig = #canempr@#18; Nivel = 5; |FINSI;
      |SI MaxDig < #canempr@#19; MaxDig = #canempr@#19; Nivel = 6; |FINSI;
      |CIERRA #canempr@;
      |DESCARGA_DEF #canempr@;
   |SINO;
      |MENAV "    No puedo abrir el fichero de empresas";
      |ERROR;
   |FINSI;
|FPRC;

|PROCESO Comprueba;
   |HAZ PideModoFecha;
   |SI FSalida = 0;
      |HAZ EntraLineas;
   |FINSI;
|FPRC;

|PROCESO Mayus; |TIPO 0;
    #Fichero@#Campo# = #Fichero@#Campo# > #Fichero@#Campo#;
    |PINTA #Fichero@#Campo#;
|FPRC;

|PROCESO BajaL;
   |BORRA 020#agifa706.a;
|FPRC;

|DEFBUCLE BajaL;
#agifa706#1;
;
#agifa704#0,#agifa705#2,0001;
#agifa704#0,#agifa705#2,9999;
;
NULL,BajaL;
|FIN;

|PROCESO BajaLin; |TIPO 1;
   ModoEntrada = (FEntrada / 100) ! 0;
   |SI ModoEntrada = 3; |BUCLE BajaL; |FINSI;
|FPRC;

|PROCESO BorraExclus;
   |BORRA 020#agifa723.a;
|FPRC;

|DEFBUCLE BorraExclus;
#agifa723#1;
;
#agifa707#15,#agifa707#0,001;
#agifa707#15,#agifa707#0,999;
;
NULL,BorraExclus;
|FIN;

|PROCESO BajaAcota; |TIPO 1;
   ModoEntrada = (FEntrada / 100) ! 0;
   |SI ModoEntrada = 3;
      |ABRE #agifa709; |ABRE #agifa723;
      #agifa709#3 = #agifa707#15;
      #agifa709#4 = 1;
      #agifa709#5 = 1;
      #agifa709#6 = "A";
      #agifa709#0 = #agifa707#16;
      |LEE 010#agifa709.=;
      |SI FSalida = 0;
         |BORRA 020#agifa709.a;
      |FINSI;
      |CIERRA #agifa709;
      |BUCLE BorraExclus;
      |CIERRA #agifa723;
   |FINSI;
|FPRC;

|PROCESO MontaCuenta;
   |HAZ EsPCEGroup;
   |SI FSalida = 0; |ACABA; |FINSI;

   Comodin = #agifa706#3; |QBF Comodin;
   Comodin = Comodin - ".";
   |SI FSalida ! 0;
      aLong = Comodin % 0; nLong = aLong;
      Calc = ((FSalida / 100) ! 0) + 99;
      Parte1 = Comodin % Calc;
      Parte2 = Comodin - Parte1;
      Calc = MaxDig - nLong;
      Comodin = "0" * Calc;
      #agifa706#3 = Parte1 + Comodin + Parte2;
      |PINTA #agifa706#3;
   |FINSI;
|FPRC;

|PROCESO agifa723;
   |SALVA_FICHA #agifa723;
   #agifa723#0 = #agifa710#0;
   |GRABA 020#agifa723.n;
   |REPON_FICHA #agifa723;
|FPRC;

|DEFBUCLE agifa723;
#agifa723#1;
;
#agifa704#0,001,001;
#agifa704#0,999,999;
;
NULL,agifa723;
|FIN;

|PROCESO agifa718;
   |SALVA_FICHA #agifa718;
   #agifa718#0 = #agifa710#0;
   |GRABA 020#agifa718.n;
   |REPON_FICHA #agifa718;
|FPRC;

|DEFBUCLE agifa718;
#agifa718#1;
;
#agifa704#0,"               ",001;
#agifa704#0,"zzzzzzzzzzzzzzz",999;
;
NULL,agifa718;
|FIN;

|PROCESO agifa717;
   |SALVA_FICHA #agifa717;
   #agifa717#0 = #agifa710#0;
   |GRABA 020#agifa717.n;
   |REPON_FICHA #agifa717;
|FPRC;

|DEFBUCLE agifa717;
#agifa717#1;
;
#agifa704#0,"               ";
#agifa704#0,"zzzzzzzzzzzzzzz";
;
NULL,agifa717;
|FIN;

|PROCESO agifa709;
   |SALVA_FICHA #agifa709;
   #agifa709#3 = #agifa710#0;
   |GRABA 020#agifa709.n;
   |REPON_FICHA #agifa709;
|FPRC;

|DEFBUCLE agifa709;
#agifa709#1;
;
#agifa704#0,000001,0001," ",001;
#agifa704#0,999999,9999,"z",999;
;
NULL,agifa709;
|FIN;

|PROCESO agifa707;
   |SALVA_FICHA #agifa707;
   #agifa707#15 = #agifa710#0;
   |GRABA 020#agifa707.n;
   |REPON_FICHA #agifa707;
|FPRC;

|DEFBUCLE agifa707;
#agifa707#1;
;
#agifa704#0,001;
#agifa704#0,999;
;
NULL,agifa707;
|FIN;

|PROCESO agifa706;
   |SALVA_FICHA #agifa706;
   #agifa706#0 = #agifa710#0;
   |GRABA 020#agifa706.n;
   |REPON_FICHA #agifa706;
|FPRC;

|DEFBUCLE agifa706;
#agifa706#1;
;
#agifa704#0,#agifa705#2,0001;
#agifa704#0,#agifa705#2,9999;
;
NULL,agifa706;
|FIN;

|PROCESO agifa705;
   |SALVA_FICHA #agifa705;
   #agifa705#0 = #agifa710#0;
   |GRABA 020#agifa705.n;
   |REPON_FICHA #agifa705;
   |BUCLE agifa706;
|FPRC;

|DEFBUCLE agifa705;
#agifa705#1;
;
#agifa704#0,000001;
#agifa704#0,999999;
;
NULL,agifa705;
|FIN;

|PROCESO Copia;
   |SALVA_FICHA #agifa704;
   #agifa704#0 = #agifa710#0;
   #agifa704#1 = #agifa710#1;
   |GRABA 020#agifa704.n;
   |REPON_FICHA #agifa704;
   |BUCLE agifa705;
   |BUCLE agifa707;
   |BUCLE agifa709;
   |BUCLE agifa717; |BUCLE agifa718;
   |BUCLE agifa723;
|FPRC;

|PROCESO MiraCopia;
   |SI FSalida = 10;
      |PUSHV 1032 1360;
      |PINPA #0#agifa710;
      |PINDA #0#agifa710;
      |ENDATOS #1#agifa710;
      |SI FSalida = 0;
         |HAZ Copia;
         #agifa704#0 = #agifa710#0;
         |LEE 010#agifa704.=;
         |SI FSalida = 0;
            |PINPA #0#0;
            |PINDA #0#0;
         |FINSI;
      |FINSI;
      |POPV;
   |FINSI;
|FPRC;

|PROCESO PintaApu; |TIPO 13;
   |ENTLINEAL #1#agifa706,-3,7,22,1,inf1,sup1;
   |HAZ PintaDatos;
|FPRC;

|PROCESO AntesTipo; |TIPO 7;
   |PUSHV 1129 1777;
   |BLANCO 1129 1777; |CUADRO 1129 1777;
   |ATRI R;
   |PINTA 1133, " B - Base              P - Cuota de IRPF  ";
   |PINTA 1233, " I - Cuota de Iva      D - Descuento      ";
   |PINTA 1333, " R - Cuota de Recargo  F - Total Registro ";
   |ATRI I;
   |PINTA 1433, " Para los enlaces de IVA es INDISPENSABLE ";
   |PINTA 1533, " que  la primera  linea  sea  la del Total";
   |PINTA 1633, " registro para su correcto funcionamiento ";
   |ATRI N;
|FPRC;

|PROCESO TrasTipo;
   |POPV;
   |SI #agifa706#13 = "B";
      |C_M #agifa706#16,1,"S";
   |SINO;
      |C_M #agifa706#16,1,"N"; #agifa706#16 = " ";
   |FINSI;
|FPRC;

|PROCESO AntesConcepto; |TIPO 7;
   ConcepAntes = #agifa706#5;
|FPRC;

|PROCESO BorraTempo;
   |BORRA 020#agifa709.a;
|FPRC;

|DEFBUCLE BorraTempo;
#agifa709#1;
;
#agifa706#0,#agifa706#1,#agifa706#2,"D",001;
#agifa706#0,#agifa706#1,#agifa706#2,"D",999;
;
NULL,BorraTempo;
|FIN;

|PROCESO TraeteConcepto;
   |SI ConcepAntes ! #agifa706#5;
      ConcepAntes = #agifa706#5;
      |ABRE #agifa709;
      |BUCLE BorraTempo;
      Comodin = #agifa704#6; |QBF Comodin;
      Comodin1 = Comodin - "contagen/";
      |SI FSalida ! 0;
         Comodin = Comodin1 + "modelos/";
         Comodin1 = Comodin + "def/dsmom030.mas";
         Comodin2 = Comodin + "fich/";
      |SINO;
         Comodin1 = Comodin + "def/caconcep.mas";
         Comodin2 = Comodin + "fich/" + (("00000" + #agifa704#4) % -105) + #agifa704#5 + "/";
      |FINSI;
      |CARGA_DEF Comodin1, caconce@;
      |SI FSalida = 0;
         |PATH_DAT #11 Comodin2;
         |ABRE #caconce@;
         #caconce@#0 = #agifa706#5;
         |LEE 000#caconce@.=;
         |SI FSalida = 0;
            #agifa706#6 = #caconce@#1; |PINTA #agifa706#6;
         |FINSI;
         |CIERRA #caconce@; |DESCARGA_DEF #caconce@;
      |FINSI;
      |DDEFECTO #agifa709;
      #agifa709#0 = 10;
      #agifa709#1 = #agifa706#6;
      #agifa709#2 = #agifa706#6;
      #agifa709#3 = #agifa706#0;
      #agifa709#4 = #agifa706#1;
      #agifa709#5 = #agifa706#2;
      #agifa709#6 = "D";
      |GRABA 020#agifa709.n;
      |CIERRA #agifa709;
   |FINSI;
|FPRC;

|PROCESO RecCampos;
   #agifa704#0 = #agifa707#15;
   |LEE 000#agifa704.=;
   |SI FSalida = 0;
      |DBASE Comodin; |QBF Comodin;
      Comodin = Comodin + "def/" + #agifa707#13 + ".mas";
      |CARGA_DEF Comodin, referen@;
      |SI FSalida = 0;
         Comodin  = ("000" + #agifa707#14) % -103;
         Comodin1 = "|C" + Comodin + "LONGITUD";
         Comodin1 = #referen@#Comodin1#;
         |SI Comodin1 ! #agifa707#12;
            #agifa707#12 = Comodin1; |GRABA 020#agifa707.a;
         |FINSI;
         |DESCARGA_DEF #referen@;
      |FINSI;
   |FINSI;
|FPRC;

|DEFBUCLE RecCampos;
#agifa707#1;
;
INICIO;
FINAL;
be;
NULL,RecCampos;
|FIN;

|PROCESO RecalcCampos; |TIPO 8;
   |ABRE #agifa704; |ABRE #agifa707;
   |BUCLE RecCampos;
   |CIERRA #agifa707; |CIERRA #agifa704;
|FPRC;

|RUTINA inf723;
   #agifa723#0 = #agifa707#15;
   #agifa723#1 = #agifa707#0;
   #agifa723#2 = 1;
|FRUT;

|RUTINA sup723;
   #agifa723#0 = #agifa707#15;
   #agifa723#1 = #agifa707#0;
   #agifa723#2 = 999;
|FRUT;

|PROCESO Exclus; |TIPO 3;
   |PUSHV 0959 1979;
   |SI #agifa707#11 = "A";
      |C_V #agifa723#3,1,"S"; |C_M #agifa723#3,1,"S";
   |SINO;
      |C_V #agifa723#3,1,"N"; |C_M #agifa723#3,1,"N";
   |FINSI;
   |SI #agifa707#11 = "N";
      |C_V #agifa723#4,1,"S"; |C_M #agifa723#4,1,"S";
   |SINO;
      |C_V #agifa723#4,1,"N"; |C_M #agifa723#4,1,"N";
   |FINSI;
   |SI #agifa707#11 = "F";
      |C_V #agifa723#5,1,"S"; |C_M #agifa723#5,1,"S";
   |SINO;
      |C_V #agifa723#5,1,"N"; |C_M #agifa723#5,1,"N";
   |FINSI;
   |C_V #agifa723#6,1,"N";
   |ENTLINEAL #1#agifa723,-3,1,18,1,inf723,sup723;
   |C_V #agifa723#3,1,"N"; |C_M #agifa723#3,1,"N";
   |C_V #agifa723#4,1,"N"; |C_M #agifa723#4,1,"N";
   |C_V #agifa723#5,1,"N"; |C_M #agifa723#5,1,"N";
   |C_V #agifa723#6,1,"S";
   |POPV;
|FPRC;

|PROCESO AntesNumAcum; |TIPO 7;
   |SI #agifa706#13 = "F";
      |C_M #agifa706#14,1,"N";
   |SINO;
      |C_M #agifa706#14,1,"S";
   |FINSI;
|FPRC;

|PROCESO TrasNumAcum;
   |SI #agifa706#13 ! "B"; |Y #agifa706#14 = 6;
      |AVISO; |ERROR;
   |FINSI;
|FPRC;

|PROCESO TrasLibro704;
   |SI FSalida = 2; |ACABA; |FINSI;
   nTecla = FSalida;
   |SI #agifa704#2 = "CC"; |ACABA; |FINSI;

   Comodin  = #agifa704#6; |QBF Comodin; Comodin  = Comodin + "def/";
   Comodin1 = Comodin + "calibros.mas"; |CARGA_DEF Comodin1, calibro@;

   Comodin = #agifa704#6; |QBF Comodin;
   Comodin1 = Comodin + "fich/" + ((("00000" + #agifa704#4) % -105) + #agifa704#5) + "/";
   |PATH_DAT #20 Comodin1;
   |ABRE #calibro@;
   |SI nTecla = 10;
      #calibro@#0 = #agifa704#14;
      |LEE 000#calibro@.];
      |CONSULTA_CLAVE #1#calibro@;
      |SI FSalida = 0;
         #agifa704#14 = #calibro@#0; |PINTA #agifa704#14;
         #agifa704#15 = #calibro@#1; |PINTA #agifa704#15;
      |FINSI;
   |FINSI;
   #calibro@#0 = #agifa704#14;
   |LEE 000#calibro@.=;
   |SI FSalida = 0;
      |SI #calibro@#2 = "S"; |Y #agifa704#2 ! "FC";
         |MENAV "    Tipo de libro incorrecto";
         |ERROR;
      |FINSI;
      |SI #calibro@#2 = "R"; |Y #agifa704#2 ! "FV"; |Y #agifa704#2 ! "FD";
       |Y #agifa704#2 ! "TI"; |Y #agifa704#2 ! "CC"; |Y #agifa704#2 ! "CR";
         |MENAV "    Tipo de libro incorrecto";
         |ERROR;
      |FINSI;
      #agifa704#15 = #calibro@#1; |PINTA #agifa704#15;
   |SINO;
      |MENAV "    Libro inexistente";
      |ERROR;
   |FINSI;
   |CIERRA #calibro@; |DESCARGA_DEF #calibro@;
|FPRC;

|PROCESO TrasSerie704;
   |SI #agifa704#2 = "CC"; |ACABA; |FINSI;
   |SI #agifa704#9 = "N";  |ACABA; |FINSI;

   |PINTA 0420, "                                    ";
   Comodin  = #agifa704#6; |QBF Comodin; Comodin  = Comodin + "def/";
   Comodin1 = Comodin + "caivases.mas"; |CARGA_DEF Comodin1, caivses@;

   Comodin = #agifa704#6; |QBF Comodin;
   Comodin1 = Comodin + "fich/" + ((("00000" + #agifa704#4) % -105) + #agifa704#5) + "/";
   |PATH_DAT #21 Comodin1;
   |ABRE #caivses@;
   #caivses@#0 = #agifa704#11;
   |SI #agifa704#2 ! "FC";
      #caivses@#1 = "S";
   |SINO;
      #caivses@#1 = "R";
   |FINSI;
   |LEE 000#caivses@.=;
   |SI FSalida = 0;
      #agifa704#13 = #caivses@#2; |PINTA #agifa704#13;
   |SINO;
      |MENAV "    Serie inexistente";
      |ERROR;
   |FINSI;
   |CIERRA #caivses@; |DESCARGA_DEF #caivses@;
|FPRC;

|PROCESO CogeDatos;
   Comodin = #agifa709#1; |QBF Comodin;
   |SI #agifa709#6 = "C"; aCuenta = aCuenta + Comodin; |FINSI;
   |SI #agifa709#6 = "D"; aDescri = aDescri + Comodin; |FINSI;
   |SI #agifa709#6 = "I"; aImport = aImport + Comodin; |FINSI;
   |SI #agifa709#6 = "E"; aDepart = aDepart + Comodin; |FINSI;
|FPRC;

|DEFBUCLE CogeDatos;
#agifa709#1;
;
#agifa706#0, #agifa706#1, #agifa706#2, " ", 001;
#agifa706#0, #agifa706#1, #agifa706#2, "z", 999;
;
NULL,CogeDatos;
|FIN;

|PROCESO PintaDatos; |TIPO 13;

   aCuenta = ""; aDescri = ""; aImport = ""; aDepart = "";
   |BUCLE CogeDatos;
   ||BLANCO 1130 1676; |CUADRO 1029 1777;
   ||PINPA #0#agifa705;
   |SALVA_FICHA #agifa705;
   |ENTLINEAL #1#agifa705,-2,7,16,1,inf,sup;
   |REPON_FICHA #agifa705;
   |ATRI R; |PINTA 1130, " Cuenta ....                              A"; |ATRI N;
   aCuenta = aCuenta % 0145; |PINTA 1231, aCuenta;
   |ATRI R; |PINTA 1330, " Descripcion "; |ATRI N;
   aDescri = aDescri % 0145; |PINTA 1431, aDescri;
   |ATRI R; |PINTA 1530, " Importe ... "; |ATRI N;
   aImport = aImport % 0145; |PINTA 1631, aImport;
   |ATRI R; |PINTA 1730, " Dp "; |ATRI N;
   aDepart = aDepart % 0141; |PINTA 1735, aDepart
|FPRC;

|PROCESO MiraDep; |TIPO 7;
   |CAMPO_ANCHO #agifa706#15,1,2;
   |CAMPO_MAXIMO #agifa706#15,1,"#";
|FPRC;

|PROCESO ConsultaLibro; |TIPO 66;
   |CONSULTA_CLAVE #1#calibro@;
   #agifa704#14 = #calibro@#0; |PINTA #agifa704#14;
   #agifa704#15 = #calibro@#1; |PINTA #agifa704#15;
|FPRC;

|PROCESO PideLibro;
   |SI FSalida = 2; |ACABA; |FINSI;

   |C_V #agifa704#9,  0, aAlfa;
   |SI aAlfa ! "N";
      |PUSHV 0901 0980;
      |PINTA 0904, " Libro IVA :                ";
      |C_P #agifa704#14,1,0917; |C_P #agifa704#15,1,0920;
      |C_M #agifa704#14,1,"S";  |C_V #agifa704#14,1,"S"; |PINTA #agifa704#14;
      |C_M #agifa704#15,1,"S";  |C_V #agifa704#15,1,"S"; |PINTA #agifa704#15;
      |PARA; |SI; |HACIENDO;
         |ENCAMPO #14#agifa704;
         |SI FSalida = 2; |O FSalida = 7; |SAL; |FINSI;

         Comodin  = #agifa704#6; |QBF Comodin; Comodin  = Comodin + "def/";
         Comodin1 = Comodin + "calibros.mas"; |CARGA_DEF Comodin1, calibro@;
         Comodin = #agifa704#6; |QBF Comodin;
         Comodin1 = Comodin + "fich/" + ((("00000" + #agifa704#4) % -105) + #agifa704#5) + "/";
         |PATH_DAT #20 Comodin1; |ABRE #calibro@;
         |SI FSalida = 10;
            |CONSULTA_CLAVE #1#calibro@;
            #agifa704#14 = #calibro@#0;
            #agifa704#15 = #calibro@#1;
            FSalida = 0;
         |FINSI;
         |SI FSalida = 0;
            #calibro@#0 = #agifa704#14;
            |LEE 000#calibro@.=;
            |SI FSalida = 0;
               |SI #calibro@#2 ! "S"; |Y #agifa704#2 = "FC";
                  |MENAV "    Tipo de libro incorrecto"; |VETE Sigue;
               |FINSI;
               |SI #calibro@#2 = "R"; |Y #agifa704#2 ! "FV"; |Y #agifa704#2 ! "FD";
                |Y #agifa704#2 ! "TI"; |Y #agifa704#2 ! "CC";
                  |MENAV "    Tipo de libro incorrecto"; |VETE Sigue;
               |FINSI;
               #agifa704#15 = #calibro@#1; |PINTA #agifa704#15;
            |SINO;
               |MENAV "    Libro inexistente";  |VETE Sigue;
            |FINSI;
            |CONFI "    NConforme ? ";
            |SI FSalida = 0; |SAL; |FINSI;
   |ET Sigue;
         |FINSI;
         |CIERRA #calibro@; |DESCARGA_DEF #calibro@;
      |SIGUE;

      Calc = FSalida;
      |C_P #agifa704#14,1,0540; |C_P #agifa704#15,1,0550;
      |C_M #agifa704#14,1,"N";  |C_V #agifa704#14,1,"N";
      |C_M #agifa704#15,1,"N";  |C_V #agifa704#15,1,"N";
      |POPV;

      |SI Calc = 2; |O Calc = 7; |POSICIONATE #agifa704#8; |ACABA; |FINSI;
   |FINSI;

   eaTipoEnlace = #agifa704#2;

   |PUSHV 0501 2380;
   |BLANCO 1215 1470;
   #agifa734#0 = #agifa704#19;
   #agifa734#1 = #agifa704#20;
   |PINPA #0#agifa734; |PINDA #0#agifa734;
   |ENDATOS #1#agifa734;
   |SI FSalida = 0;
      #agifa704#19 = #agifa734#0;
      #agifa704#20 = #agifa734#1;
   |SINO;
      |POSICIONATE #agifa704#8;
   |FINSI;

   |C_M #agifa704#19, 1, "N"; |C_V #agifa704#19, 1, "N";
   |POPV;
   |SI Calc = 2; |O Calc = 7; |POSICIONATE #agifa704#8; |FINSI;
|FPRC;

|PROCESO Clave340; |TIPO 66;
     eaTipoEnlace = #agifa704#2;
     |HAZ PoPup340;
     |SI eaAlfa ! "";
          #agifa734#0 = eaAlfa % 101; |PINTA #agifa734#0;
          #agifa734#1 = eaAlfa % 3; |PINTA #agifa734#1;
     |FINSI;
|FPRC;

|PROCESO AntesAlbar; |TIPO 7;
   |C_M #agifa704#8,1,"S"; |ACABA;
/*
   |SI #agifa704#2 = "CC";
      |C_M #agifa704#8,1,"N"; #agifa704#8 = "N"; |PINTA #agifa704#8;
   |SINO;
      |C_M #agifa704#8,1,"S";
   |FINSI;
*/
|FPRC;

|PROCESO MiraValor;
   |BLIN 4;
   |SI #agifa706#16 = " "; |ACABA; |FINSI;

   |SI #agifa704#8 = "S";
      |HAZ EsViarsa;
      |SI FSalida ! 0;
         |HAZ EsVipei;
         |SI FSalida ! 0;
            |HAZ EsConstru;
            |SI FSalida ! 0;
               |HAZ EsPalmHotel;
               |SI FSalida ! 0;
                  |HAZ EsCampoJerez;
                  |SI FSalida ! 0;
                     |SI #agifa706#16 = "C"; |O #agifa706#16 = "A"; |O #agifa706#16 = "L";
                        |MENAV "    Valor incorrecto.Solo puede ser <S>erie, <F>amilia o Blanco"; |ERROR;
                     |FINSI;
                  |FINSI;
               |FINSI;
            |SINO;
               |SI #agifa704#2 = "FC";
                  |SI #agifa706#16 = "C";
                     |MENAV "    Valor incorrecto.Solo <S>erie,<F>amilia,<A>uxiliar,<L>Almacen o Blanco"; |ERROR;
                  |FINSI;
               |SINO;
                  |SI #agifa706#16 = "C"; |O #agifa706#16 = "L";
                     |MENAV "    Valor incorrecto.Solo puede ser <S>erie, <F>amilia, <A>uxiliar o Blanco"; |ERROR;
                  |FINSI;
               |FINSI;
            |FINSI;
         |SINO;
            |SI #agifa706#16 = "C"; |O #agifa706#16 = "L";
               |MENAV "    Valor incorrecto.Solo puede ser <S>erie, <F>amilia, <A>uxiliar o Blanco"; |ERROR;
            |FINSI;
         |FINSI;
      |SINO;
         |SI #agifa706#16 = "C"; |O #agifa706#16 = "L";
            |MENAV "    Valor incorrecto.Solo puede ser <S>erie, <F>amilia, <A>uxiliar o Blanco"; |ERROR;
         |FINSI;
      |FINSI;
   |SINO;
      |SI #agifa704#2 = "FV"; |O #agifa704#2 = "FC"; |O #agifa704#2 = "FD"; |O #agifa704#2 = "TI";
         |SI #agifa706#16 ! "S";
            |MENAV "    Valor incorrecto.Solo puede ser <S>erie o Blanco"; |ERROR;
         |FINSI;
      |SINO;
         |SI #agifa706#16 ! "C";
            |MENAV "    Valor incorrecto.Solo puede ser <C>aja o Blanco"; |ERROR;
         |FINSI;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO TomaDecims; |TIPO 13;
   |SI #agifa707#11 ! "N"; |ACABA; |FINSI;
   nLong = 0;

   |DBASE aAlfa; |QBF aAlfa;
   aAlfa = aAlfa + "def/" + #agifa707#13;
   |CARGA_DEF aAlfa, RefDato@;
   |SI FSalida = 0;
      aAlfa = "|C" + (("000" + #agifa707#14) % -103) + "MINIMO";
      aAlfa = #RefDato@#aAlfa#;
      aAlfa = aAlfa - ".";
      |SI FSalida ! 0;
         nCalc = FSalida; nCalc1 = nCalc + 98; aAlfa = aAlfa % nCalc1; |QBF aAlfa;
         aLong = aAlfa % 0; nLong = aLong;
         aAlfa1 = "9" * nLong;
         |SI aAlfa ! aAlfa1;
            aAlfa = "|C" + (("000" + #agifa707#14) % -103) + "MAXIMO";
            aAlfa = #RefDato@#aAlfa#;
            aAlfa = aAlfa - ".";
            |SI FSalida ! 0;
               nCalc1 = FSalida; nCalc1 = nCalc1 + 98; aAlfa = aAlfa % nCalc1; |QBF aAlfa;
            |FINSI;
            aLong = aAlfa % 0; nCalc1 = aLong;
            nCalc2 = (nCalc / 100) ! 0;
            |SI nCalc1 > nCalc2; nCalc = (nCalc1 + 1) * 100; |FINSI;
            nCalc1 = (nCalc / 100) ! 0; nLong = 15 - nCalc1;
         |FINSI;
      |FINSI;
      |DESCARGA_DEF #RefDato@;
   |FINSI;
   nDeci_nDec = nLong;
|FPRC;

|PROCESO Mensa; |TIPO 7;
   |SI #agifa704#8 = "S";
      |HAZ EsViarsa;
      |SI FSalida ! 0;
         |HAZ EsVipei;
         |SI FSalida ! 0;
            |HAZ EsConstru;
            |SI FSalida ! 0;
               |HAZ EsCampoJerez;
               |SI FSalida ! 0;
                  aAlfa = "    Recoger cuenta analitica: <S> De la serie, <F> De la familia, <C> De la caja";
               |SINO;
                  aAlfa = "    Recoger cta.analitica:<S> De serie,<F> De familia,<C> De caja, <A> Auxiliar ";
               |FINSI;
            |SINO;
               |SI #agifa704#2 = "FC";
                  aAlfa = "    Recoger cuenta analitica: <S> Serie, <F> Familia, <C> Caja, <L> Almacen";
               |SINO;
                  aAlfa = "    Recoger cuenta analitica: <S> De la serie, <F> De la familia, <C> De la caja";
               |FINSI;
            |FINSI;
         |SINO;
              aAlfa = "    Recoger cta.analitica:<S> De serie,<F> De familia,<C> De caja, <A> Auxiliar ";
         |FINSI;
      |SINO;
         aAlfa = "    Recoger cta.analitica:<S> De serie,<F> De familia,<C> De caja, <A> Auxiliar ";
      |FINSI;
      |MENSA aAlfa;
   |SINO;
      aAlfa = "    Recoger cta.analitica:<S> De serie, < > No recogerla ";
   |FINSI;
|FPRC;

|PROCESO MiraCmpClave; |TIPO 11;
   |PINTA 0915, aCmpClv;

   |SI FSalida = 12;
      |SI #agifa704#2 = "FV";
         |SI #agifa704#8 = "S";
            aFichP = "agifa071"; aFichC = "agifa010";
         |SINO;
            aFichP = "agifa134"; aFichC = "agifa134";
         |FINSI;
      |FINSI;
      |SI #agifa704#2 = "FC";
         |SI #agifa704#8 = "S";
            aFichP = "agifa077"; aFichC = "agifa080";
         |SINO;
            aFichP = "agifa079"; aFichC = "agifa079";
         |FINSI;
      |FINSI;
      |SI #agifa704#2 = "FD";
         |SI #agifa704#8 = "S";
            aFichP = "agifa084"; aFichC = "agifa069";
         |SINO;
            aFichP = "agifa084"; aFichC = "agifa084";
         |FINSI;
      |FINSI;
      |SI #agifa704#2 = "TI";
         |SI #agifa704#8 = "S";
            aFichP = "agifa502"; aFichC = "agifa501";
         |SINO;
            aFichP = "agifa501"; aFichC = "agifa501";
         |FINSI;
      |FINSI;
      |SI #agifa704#2 = "CC";
         aFichP = "agifa509"; aFichC = "agifa509";
      |FINSI;
      |SI #agifa704#2 = "CR";
         |SI #agifa704#8 = "S";
            aFichP = "agifa572"; aFichC = "agifa571";
         |SINO;
            aFichP = "agifa571"; aFichC = "agifa571";
         |FINSI;
      |FINSI;
      aAlfa = #agifa707#13; |QBF aAlfa;
      |SI aAlfa = aFichP; |O aAlfa = aFichC;
         |SI #agifa704#17 ! 999;
            aAlfa = "    N" + &191 + " Desea cambiar el campo clave del enlace ? ";
            |CONFI aAlfa;
            |SI FSalida = 0;
               aAlfa = " Campo clave enlace : [" + #agifa707#1; |QBF aAlfa;
               aAlfa = aAlfa + "][" + #agifa707#2; |QBF aAlfa;
               aCmpClv = aAlfa + "]";
               |PINTA 0915, aCmpClv;
               #agifa704#16 = #agifa707#13; #agifa704#17 = #agifa707#14;
            |FINSI;
         |SINO;
            aAlfa = " Campo clave enlace : [" + #agifa707#1; |QBF aAlfa;
            aAlfa = aAlfa + "][" + #agifa707#2; |QBF aAlfa;
            aCmpClv = aAlfa + "]";
            |PINTA 0915, aCmpClv;
            #agifa704#16 = #agifa707#13; #agifa704#17 = #agifa707#14;
         |FINSI;
         |ERROR;
      |SINO;
         nSwErr = 1;
         |SI aAlfa = "agifa134"; |Y #agifa707#14 = 48; nSwErr = 0; |FINSI;
         |SI aAlfa = "agifa079"; |Y #agifa707#14 = 48; nSwErr = 0; |FINSI;
         |SI nSwErr = 0;
            |SI #agifa704#17 ! 999;
               aAlfa = "    N" + &191 + " Desea cambiar el campo clave del enlace ? ";
               |CONFI aAlfa;
               |SI FSalida = 0;
                  aAlfa = " Campo clave enlace : [" + #agifa707#1; |QBF aAlfa;
                  aAlfa = aAlfa + "][" + #agifa707#2; |QBF aAlfa;
                  aCmpClv = aAlfa + "]";
                  |PINTA 0915, aCmpClv;
                  #agifa704#16 = #agifa707#13; #agifa704#17 = #agifa707#14;
               |FINSI;
            |SINO;
               aAlfa = " Campo clave enlace : [" + #agifa707#1; |QBF aAlfa;
               aAlfa = aAlfa + "][" + #agifa707#2; |QBF aAlfa;
               aCmpClv = aAlfa + "]";
               |PINTA 0915, aCmpClv;
               #agifa704#16 = #agifa707#13; #agifa704#17 = #agifa707#14;
            |FINSI;
            |ERROR;
         |FINSI;
      |FINSI;
   |FINSI;
   |SI FSalida = 13; |Y #agifa704#17 ! 999;
      aAlfa = "    N" + &191 + " Desea vaciar el campo clave del enlace ? ";
      |CONFI aAlfa;
      |SI FSalida = 0;
         #agifa704#16 = ""; #agifa704#17 = 999;
         |GRABA 020#agifa704.a;
      |FINSI;
      aCmpClv = &196 * 60; |PINTA 0915, aCmpClv;
      |ERROR;
   |FINSI;
|FPRC;

|PROCESO PideModoFecha;
   |PUSHV 0515 2265;
   |BLANCO 0515 2265;
   |CUADRO 0616 2264;
   |ATRI R; |PINTA 0617, " SELECCIONE EL FORMATO DE FECHAS A USAR "; |ATRI N;
   |PINTA 0717, "A) Automatico. La fecha definida en el enlace ";
   |PINTA 0817, "   se grabará como fecha contable y en la     ";
   |PINTA 0917, "   fecha de registro se grabará la fecha del  ";
   |PINTA 1017, "   documento.                                 ";
   |PINTA 1117, "B) Manual. Se pedirá una fecha en el momento  ";
   |PINTA 1217, "   de enlazar y esta se grabará en la fecha de";
   |PINTA 1317, "   registro, la fecha definida en el enlace se";
   |PINTA 1417, "   grabará como fecha contable.";
   |PINTA 1517, "C) Manual contable. Se pedirá una fecha en el ";
   |PINTA 1617, "   momento de enlazar y esta se grabará en la ";
   |PINTA 1717, "   fecha de registro y como fecha contable.   ";
   |PINTA 1817, "D) Manual periodo. Se pedirá una fecha en el  ";
   |PINTA 1917, "   momento de enlazar y esta se grabará en la ";
   |PINTA 2017, "   fecha contable.                            ";
   |PINTA 2117, " Formato de fechas (A/B/C/D) : ";

   FSalida = 1;
   |PARA; |SI FSalida ! 0; |O aFormato = " "; |HACIENDO;
      aFormato = #agifa704#18;
      E_sup = 1; E_inf = "ABCDabcd";
      aFormato = 2148 ? 0;
   |SIGUE;
   aFormato = aFormato > aFormato;
   #agifa704#18 = aFormato;
   |POPV;

   |ATRI I;
   |SI #agifa704#18 = "A"; |PINTA 0545, " Formato fechas automatico      "; |FINSI;
   |SI #agifa704#18 = "B"; |PINTA 0545, " Formato fechas manual          "; |FINSI;
   |SI #agifa704#18 = "C"; |PINTA 0545, " Formato fechas manual contable "; |FINSI;
   |SI #agifa704#18 = "D"; |PINTA 0545, " Formato fechas manual periodo  "; |FINSI;
   |ATRI N;
|FPRC;

|PROCESO MiraIntracom;
   |SI #agifa704#9 = "S";
      |C_V #agifa704#10, 1, "S"; |C_M #agifa704#10, 1, "S"; |PINTA #agifa704#10;
      |C_V #agifa704#11, 1, "S"; |C_M #agifa704#11, 1, "S"; |PINTA #agifa704#11;
   |SINO;
      |C_V #agifa704#10, 1, "N"; |C_M #agifa704#10, 1, "N";
      |C_V #agifa704#11, 1, "N"; |C_M #agifa704#11, 1, "N";
   |FINSI;
|FPRC;
