|FICHEROS;
     pcegm004 #4; ||Ped. Cab
     pcegm005 #5; ||Ped. Lin
     pcegm012 #12; ||Aux. Art
     agifa017 #17;
     agifa019 #19;
     dsm00024 #24;
     pcegm042 #42;
     agifa142 #142;
|FIN;

|CAMPOS;
     #19#15  art_pser;  #17#42  alm_pser;
     #19#182 art_pser2; #17#44  alm_pser2;
     #19#16  art_prec;  #17#43  alm_prec;
     #19#183 art_prec2; #17#45  alm_prec2;
     #19#17  art_pval;  #17#4   alm_pval;
     #19#11  art_nece;  #17#50  alm_nece;
     #19#12  art_rese;  #17#8   alm_rese;
     #19#14  art_depo;  #17#10  alm_depo;
     #19#184 art_depo2; #17#46  alm_depo2;
     #19#13  art_fabr;  #17#9   alm_fabr;
     #19#10  art_vsto;  #17#3   alm_vsto;
     #19#7   art_mini;  #17#6   alm_mini;
     #19#8   art_maxi;  #17#7   alm_maxi;
     #19#6   art_tota;  #17#5   alm_tota;
     #19#185 art_tota2; #17#47  alm_tota2;
     #19#104 art_disp;  #17#39  alm_disp;
     #19#193 art_disp2; #17#48 alm_disp2;
     #19#9   art_pcm;   #17#69 alm_pcm;
     #24#9   par_ereal; #24#10  par_ereal2;
     #24#11  par_sreal; #24#12  par_sreal2;
     #24#18  par_prec2;  #24#19  par_prec;
     #24#16  par_pser;  #24#17  par_pser2;
     #24#20  par_depo;  #24#21  par_depo2;
     #24#22  par_tota;  #24#23  par_tota2;
     #24#31  par_disp;  #24#32  par_disp2;
     #24#14  par_merma;
|FIN;

|VARIABLES;
     aSitu = "";
     aAlfa = "";
     &eaDarti = "";
     &eaHarti = "";
     &efDfecha = @;
     &efHfecha = @;
     &eaRecupera = "";

     aArti = "";
     nAlma = 0;
     aParti = "";
     nUni = 0;
     nUni2 = 0;
     nUniRes = 0;
     nError = 0;
|FIN;

|PROCESO LeeArti;
     |DDEFECTO #19;
     #19#0 = aArti;
     |LEE 101#19=;

     nError = 0;
     |SI eaRecupera = "N"; |Y FSalida ! 0;
          nError = 1; |ACABA;
     |FINSI;

     |SI FSalida ! 0; |GRABA 020#19b; |FINSI;

     |DDEFECTO #17;
     #17#0 = aArti;
     #17#1 = nAlma;
     |LEE 101#17=;
     |SI FSalida ! 0; |GRABA 020#17b; |FINSI;

     |SI #19#180 = "S";       || Si hay partidas
          |DDEFECTO #24;
          #24#0 = aArti;
          #24#1 = nAlma;
          #24#2 = aParti;
          |LEE 101#24=;
          |SI FSalida ! 0; |GRABA 020#24b; |FINSI;
     |FINSI;
|FPRC;

|PROCESO GrabaArti;
     |GRABA 020#17a;
     |GRABA 020#19a;
     |SI #19#180 = "S";
          |GRABA 020#24a;     || Si hay partidas
     |FINSI;
     |LIBERA #17;
     |LIBERA #19;
|FPRC;

|PROCESO StockPed;
     |SI aSitu = "C"; |Y #5#5 > 0;
          art_rese = art_rese + nUniRes;
          alm_rese = alm_rese + nUniRes;

          art_pser = art_pser + nUni;
          alm_pser = alm_pser + nUni;
          art_disp = art_disp - nUniRes;
          alm_disp = alm_disp - nUniRes;
     |FINSI;

     |SI #5#5 > 0;
          |DDEFECTO #12;
          #12#0 = #19#0;
          |LEE 101#12=;
          |SI FSalida ! 0; |GRABA 020#12b; |FINSI;
          #12#1 = #12#1 + nUni;
          |GRABA 020#12a;
          |LIBERA #12;
     |FINSI;

     |HAZ ValoraStock;
|FPRC;

|PROCESO pcegm005;
     |SI #4#70 = "R";
          |ACABA;
     |FINSI;
     |SI #4#76 = 0; |Y #4#70 = "C";
          |ACABA;
     |FINSI;

     |SI #5#2 ] eaDarti; |Y #5#2 [ eaHarti;
          aSitu = #4#70;

          aArti = #5#2;
          nAlma = #5#3;
          aParti = #5#45;
          nUni = #5#5  - #5#43;
          nUniRes = #5#60;
          |HAZ LeeArti;
          |SI nError = 0;
               |HAZ StockPed;
               |HAZ GrabaArti;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE pcegm004;
     #4#1;
     1;
     "     ", 000001, efDfecha;
     "zzzzz", 999999, efHfecha;
     ;
     NULL, NULL, pcegm005;
|FIN;

|PROCESO Borra12;
     #12#1 = 0;
     |GRABA 020#12a;
     |LIBERA #12;
|FPRC;

|DEFBUCLE Borra12;
     #12#1;
     ;
     eaDarti;
     eaHarti;
     be;
     NULL, Borra12;
|FIN;

|PROCESO pcegm042;
     |SI #42#22 = "C"; |Y #42#16 = 0;
          |ACABA;
     |FINSI;
     |DDEFECTO #17;
     |DDEFECTO #19;
     #19#0 = #42#7;
     |LEE 101#19=;
     |SI FSalida ! 0; |GRABA 020#19b; |FINSI;

     #17#0 = #42#7;
     #17#1 = 1;
     |LEE 101#17=;
     |SI FSalida ! 0; |GRABA 020#17b; |FINSI;

     nUni = 1;           ||Si el pedido esta servido
     #4#95 = #42#0;      ||no suma al P.Servir
     #4#96 = #42#1;
     |LEE 000#4=;
     |SI FSalida = 0;
          #5#28 = #4#25;
          #5#0 = #4#0;
          #5#1 = 1;
          |LEE 000#5];
          |SI FSalida = 0; |Y #5#28 = #4#25; |Y #5#0 = #4#0;
               nUni = #5#5  - #5#43;
          |FINSI;
     |FINSI;

     #19#15 = #19#15 + nUni;
     #17#42 = #17#42 + nUni;


     #19#12 = #19#12 + 1;
     #19#6 = #19#6 + 1;
     #17#8 = #17#8 + 1;
     #17#5 = #17#5 + 1;
     |HAZ ValoraStock;
     |GRABA 020#17a;
     |GRABA 020#19a;
     |LIBERA #17;
     |LIBERA #19;
|FPRC;

|DEFBUCLE pcegm042;
     #42#5;
     ;
     eaDarti;
     eaHarti;
     be;
     NULL, pcegm042;
|FIN;

|PROGRAMA;
     |BUCLE Borra12;

     |ABRE #142; |LEE 000#142p; |CIERRA #142;
     |ABRE #17;
     |ABRE #19;
     |ABRE #24;
     |ABRE #12;
     |BUCLE pcegm004;
/*
Quitado Stock segun  003308/00605
     |ABRE #4; |SELECT #10#4;
     |ABRE #5;
     |BUCLE pcegm042;
     |CIERRA #5;
     |CIERRA #4;
*/
     |CIERRA #12;
     |CIERRA #24;
     |CIERRA #19;
     |CIERRA #17;
|FPRO;
