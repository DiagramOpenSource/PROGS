|FICHEROS;
     goalbpa4 #0;
     goalbpa5 #1;
     goalbpa6 #2,MANTE;
     goparame #7;
     agifa027 #8;
     agifa007 #9;
     gotmpalb #17,MANTE;
     agifa142 #41;
     gopre002 #10;
     gopre003 #11;
     agifa019 #12;
     agifa017 #13;
     dsm00054 #54;
     dsm00055 #55;
     referen@;
|FIN;

--------------------------------------------------------------------------------
|VARIABLES;
     &enCodigo = 0;
     &enForma = 0;
     nModoCab = 0;
     nLinParti = 0;
     &eaTipo = "";
     &eaFichero = "";
     &Tempo = "";
     &eaFicImpre    = "";
     &enError = 0;
     nLin = 0;
     nTecla = 0;
     nBotImp        = 0;
     aGuarda        = "";
     aInforme       = "";
     &efFecha       = @;
     nMiErr         = 0;
     aAlfa          = "";
     &Flag          = 0;
     &xSerie        = "";
     &cCodMonBase   = "";
     &cCodMonTrab   = "";
     &cCodMonDe     = "";
     &cCodMonA      = "";
     &cCodMonConv   = "";
     &cCodMonActu   = "";
     &cDesMonBase   = "";
     &cDesMonTrab   = "";

     &ser_alb       = "";
     &eaSer         = "";
     &cSerie        = "";
     &cParam        = "";
     &cSerieExpe    = "";
     &cSeriePres    = "";
     &cSerieAlba    = "";
     &cSuAlbaran    = "";
     &cProveAlba    = "";
     &cNombrAlba    = "";
     &cUsu          = "";
     &cNumCap       = "";
     &xCodArti      = "";
     &xDesArti      = "";

     &nDeci_PBase   = 0;
     &nDeci_TBase   = 0;
     &nDeci_PTrab   = 0;
     &nDeci_ITrab   = 0;
     &nDeci_TTrab   = 0;
     &nDeci_TotVis  = 0;
     &nEurComTrab   = 0;
     &nEurComBase   = 0;
     &nEurVenTrab   = 0;
     &nEurVenBase   = 0;
     &nPreComTrab   = 0;
     &nPreComBase   = 0;
     &nPreVenTrab   = 0;
     &nPreVenBase   = 0;
     &nPrecioComp   = 0;
     &nPrecioVent   = 0;

     &nNumerAlba    = 0;
     &nTotComTra    = 0;
     &nTotVenTra    = 0;
     &nTotComBas    = 0;
     &nTotVenBas    = 0;
     &nLinLin       = 0;
     &num_alb       = 0;
     &enDocu        = 0;
     &nNumero       = 0;
     &nError        = 0;
     &nAbono        = 0;
     &def_alm       = 0;
     &n_dec         = 0;
     &nErrorSal     = 0;
     &xDocTras      = 0;
     &xLinDocu      = 0;
     &xCanArti      = 0;
     &xAlmEntr      = 0;
     &xAlmSali      = 0;
     &xForma        = 0;

     &fFechaAlba    = @;
     &xFecDocu      = @;

     nModo          = 0;
     nLinea         = 0;
     nLineas        = 0;
     nSalida        = 0;
     nHay           = 0;
     nPedido        = 0;
     nMovimi        = 0;

     cDesSer        = "";
     alfa           = "";
     cFich          = "";
     cModulo        = "";
     cLinPar        = "";
     cLinCap        = "";

     {-1}menu       = "";
     menu1          = "2400";
     menu2          = "1";
     menu3          = "Contador:  ";
     menu4          = "AM";
     menu5          = " Automatico ";
     menu6          = " Manual ";
     {500}fiebdc    = "";

     nCopias        = 0;
     nAccion        = 0;
     nBotAmpli      = 0;
     nPrecio        = 0;
     nModoEnt       = 0;
|FIN;

|PROCESO CtrlFec;
     ||컴컴컴컴컴컴컴횮ontrol Cierre
     efFecha = #0#2;
     |HAZ EstaCerrado;
     |SI FSalida = 0;
          |ERROR; |ACABA;
     |FINSI;
     ||컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|FPRC;
--------------------------------------------------------------------------------
|PROCESO PintPant; |TIPO 7;
     nModo = (FEntrada / 100) ! 0;
     |ENTLINEAL #1#2, -4, 7, 20, 0, MinAlb, MaxAlb;
     |SI nModo = 1;
          |ABRE #7; |LEE 000#7p; |CIERRA #7;
          #1#8 = #7#22;
     |FINSI;
|FPRC;
--------------------------------------------------------------------------------
|PROCESO MinAlb;
     #2#34 = "A";
     #2#4 = #1#0;
     #2#5 = #1#1;
     #2#6 = #1#2;
     #2#7 = 1;
|FPRC;
--------------------------------------------------------------------------------
|PROCESO MaxAlb;
     #2#34 = "A";
     #2#4 = #1#0;
     #2#5 = #1#1;
     #2#6 = #1#2;
     #2#7 = 999;
|FPRC;
--------------------------------------------------------------------------------
|PROCESO Pinta04; |TIPO 14;
     aAlfa = #7#68; |QBF aAlfa;
     |SI aAlfa ! "";
          |C_V #0#9, 1, "S";
          |C_A #7#68, 1, 14;
          |PINTA 0644, #7#68;
          |PINTA #0#9;
     |FINSI;
|FPRC;

|PROCESO Moneda; |TIPO 13;
     |ABRE #7; |LEE 000#7p; |CIERRA #7;
     |SI #7#141 = "O";
          |ATRI R; |PINTA 1406, " O.T.       "; |ATRI 0;
          |ATRI R; |PINTA 1419, " O.E.       "; |ATRI 0;
     |FINSI;

     nModo = (FEntrada/100)!0;

     |HAZ MonBas;

     |ENTLINEAL #1#2, -5, 7, 20, 0, MinAlb, MaxAlb;

     |SI #7#62 ! "S"; |ACABA; |FINSI;

     |SI nModo = 4;
          |ESTADO_CONTROL nBotImp, "ENABLE";
     |SINO;
          |ESTADO_CONTROL nBotImp, "DISABLE";
     |FINSI;
/*
     aAlfa = #7#68; |QBF aAlfa;
     |SI aAlfa ! "";
          |C_V #0#9, 1, "S";
          |PINTA 0444, #7#68;
          |PINTA #0#9;
     |FINSI;
*/
|FPRC;

--------------------------------------------------------------------------------
|PROCESO AltaCont; |TIPO 0;
     |SI nModo = 1;
          |MENAV "0000Alta no permitida...";
          |ERROR; |ACABA;



          |MENU menu;

          |SI FSalida = 0;
               |ERROR;
               |ACABA;
          |FINSI;

          |SI FSalida = 1;
               |ABRE #8;
               #8#2 = #0#0;                            ||Serie.
               #8#0 = "movcenal";
               |LEE 101#8=;

               |SI FSalida = 0;
                    nMovimi = #8#1;
                    |SI nMovimi < 500000;
                         nMovimi = 500000;
                    |FINSI;
                    #8#1 = nMovimi + 1;
                    |GRABA 020#8a;
               |SINO;
                    #8#1 = 500002;
                    nMovimi = 500001;
                    |GRABA 020#8n;
               |FINSI;
               |CIERRA #8;
               #0#1  = nMovimi;
          |FINSI;
     |FINSI;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO MiraSeri; |TIPO 7;
     |HAZ MonBas;
     cParam = PARAMETRO;
     nModo = (FEntrada/100)!0;

     |SI nModo = 2;
          |SI cParam = "MOVIMIENTO";
               |C_M #0#1, 1, "N";
               #0#0 = cSerieAlba;
               #0#1 = nNumerAlba;
               |PINTA #0#0;|PINTA #0#1;
          |FINSI;
     |FINSI;
     |SI nModo ! 4;
          |ESTADO_CONTROL nBotImp, "DISABLE";
     |FINSI;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO Partidas; |TIPO 11;

     |SI FSalida = 10;
          nModo = (FEntrada/100)!0;
          nLinLin = #1#2;

          |SI nModo = 4;
               |ENTLINEAL #1#2, 5, 4, 20, 0, MinAlb, MaxAlb;
          |FINSI;

          |SI nModo = 2;
               |ENTLINEAL #1#2, 5, 2, 20, 0, MinAlb, MaxAlb;
          |FINSI;

          |ERROR10;
          |HAZ BS004;

     |FINSI;


|FPRC;
-----------------------------------------------------------------------------
|PROCESO BajaAlb;
     |ABRE #7; |LEE 000#7p; |CIERRA #7;

     xForma = -1;
     xDocTras = #0#1;
     xSerie   = #0#0;
     xFecDocu = #0#2;
     xLinDocu = #2#35;
     xCodArti = #1#3;
     xDesArti = #1#4;
     xCanArti = #2#10;
     xAlmEntr = #2#17;
     xAlmSali = #1#8;
     |SI #1#8 ! #2#17;
          |SUB_EJECUTA_NP "gomoval1";
     |FINSI;

     |HAZ BajaMate2;

     |SI #2#26 = #7#36;
          |HAZ BajaPalet2;
     |FINSI;

     |SI #2#26 = #7#37;
          |HAZ BajaSacas2;
     |FINSI;

     |SI #2#26 = #7#38;
          |HAZ BajaAlqu2;
     |FINSI;

     |SI #2#26 = #7#39;
          |HAZ BajaCase2;
     |FINSI;

     |BORRA 020#2a;

|FPRC;
-----------------------------------------------------------------------------
|DEFBUCLE BajaAlb;
     #2#1;
     ;
     "A", #1#0, #1#1, #1#2,   1;
     "A", #1#0, #1#1, #1#2, 999;
     ;
     NULL, BajaAlb;
|FIN;
-----------------------------------------------------------------------------
|PROCESO AlmaDepo;
     |SI #1#8 = #7#51;
          |MENAV "0000Existen movimientos de deposito";
          |ERROR;
          nMiErr = 1;
     |FINSI;
|FPRC;

|PROCESO BajaCab; |TIPO 2;
     |ABRE #7; |LEE 000#7p; |CIERRA #7;

     nModoCab = (FEntrada/100)!0;
     nMiErr = 0;
     |SI nModoCab = 3;
          |BUCLELIN 2 AlmaDepo #0;
          |SI nMiErr ! 0; |ERROR; |ACABA; |FINSI;
          |HAZ BajaTotal;
     |FINSI;
|FPRC;

|PROCESO BajaLin; |TIPO 2;
     nModo = (FEntrada/100) ! 0;
     Flag = 0 +. 1;

     |SI nModoCab = 3; |ACABA; |FINSI;

     |SI Flag = -1; |Y nModo = 3;
          |MENAV "0000Baja de linea no permitida, borre la ficha completa...";
     |FINSI;

     |SI nModo ! 2; |ERROR; |ACABA; |FINSI;  || No permite la baja

     |ABRE #7; |LEE 000#7p; |CIERRA #7;

/*
     |SI nModo = 3;
          |SI #1#8 = #7#51;
               |MENAV "0000Movimientos de deposito. Baja anulada";
               |ERROR; |ACABA;
          |FINSI;

          cModulo = #0#0;
          |QBF cModulo;
          cModulo = cModulo + #0#1;
          |QBF cModulo;
          cModulo = "agifa077;"+cModulo;
          |PINTA #0#0;|PINTA #0#1;
          |BUCLE BajaAlb;

          |ABRE #54;
          #54#2 = #0#0;
          #54#0 = #0#1;
          |LEE 101#54=;
          |SI FSalida = 0;
             |BORRA 020#54a; |LIBERA #54;
          |FINSI;
          |CIERRA #54;
     |FINSI;
*/
|FPRC;
-----------------------------------------------------------------------------
|PROCESO AlbBaja;
     |PUSHV 01012380;
     |CLS;
     |PTEC 802;|PTEC 802;|PTEC 802;|PTEC 802;|PTEC 811;|PTEC 811;
     |SUB_EJECUTA_NP cModulo;
     |POPV;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO ImpParPar;
     cNumCap = "";
     |SELECT #4#11;
     #11#0 = #2#0;
     #11#1 = #2#1;
     #11#4 = #2#8;
     |LEE 000#11=;

     |SI FSalida = 0;
          |SELECT #5#10;
          #10#12 = #11#2;
          |LEE 000#10=;

          |SI FSalida = 0;
               cLinCap = #10#2;
               |QBT cLinCap;
               cLinPar = #11#3;
               |QBT cLinPar;
               cNumCap = cLinCap+"."+cLinPar;
          |FINSI;

     |FINSI;

     |PRINT;
|FPRC;
-----------------------------------------------------------------------------
|DEFBUCLE ImpParPar;
     #2#1;
     ;
     "A", #0#0, #0#1,   1,   1;
     "A", #0#0, #0#1, 999, 999;
     ;
     NULL, ImpParPar;
|FIN;
-------------------------------------------------------------------------------
|PROCESO ConfiMate; |TIPO 3;

     |ABRE #7;
     #7#0 = "A";
     |LEE 000#7=;

     |SI FSalida = 0;

          |SI #7#19 = "N";
               |CIERRA #7;
               |ACABA;
          |FINSI;

     |FINSI;

     cUsu = Usuario % 810;
     FSalida = 1;

     |SI #7#20 = "S"
          |CONFI "0000NDESEA IMPRIMIR EL VISADO DEL DOCUMENTO";

          |SI FSalida = -1;
               |CIERRA #7;
               |ACABA;
          |FINSI;

     |FINSI;

     |PARA nCopias = 1; |SI nCopias [ #7#33; |HACIENDO nCopias = nCopias + 1;

          |MENAV "0000INTRODUZCA EL DOCUMENTO EN LA IMPRESORA";
          |IMPRE 0;

          |INFOR "gomatcon"

          |SI FSalida = 0;
               |ABRE #11;
               |ABRE #10;
               |BUCLE ImpParPar;
               |PIEINF;
               |FININF;
               |CIERRA #10;
               |CIERRA #11;
          |FINSI;

          |FINIMP;

     |SIGUE;

     |CIERRA #7;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO PintaLa;
     |HAZ PintPant;
     FSalida = "";
|FPRC;
-----------------------------------------------------------------------------
|PROCESO BI004; |TIPO 80;
     |ABRE #7; |LEE 000#7p; |CIERRA #7;
     |HAZ MonBas;
     |CLS;

     |CONTROL_SIMPLE 0, "BOTON,F2 - Asignar Partidas", 2430, 2450, F2004;
     nBotAmpli = FSalida;
     |ESTADO_CONTROL nBotAmpli, "HIDE";           ||"SHOW""HIDE""ENABLE""DISABLE".

     |CONTROL_SIMPLE 0, "BOTON, Imprimir", 0563, 0575, Impresion1;
     nBotImp = FSalida;
     |SI #7#62 = "S";
          |ESTADO_CONTROL nBotImp, "SHOW";
     |SINO;
          |ESTADO_CONTROL nBotImp, "HIDE";
     |FINSI;
|FPRC;
------------------------------------------------------------------------------
|PROCESO BF004; |TIPO 90;
     |FIN_CONTROL_WINDOWS nBotAmpli;
     |FIN_CONTROL_WINDOWS nBotImp;
     |PULSATECLA;
|FPRC;
------------------------------------------------------------------------------
|PROCESO BS004; |TIPO 7;
     |SI #1#3 ! "                    ";
          |ESTADO_CONTROL nBotAmpli, "SHOW"; ||"SHOW""HIDE""ENABLE""DISABLE".
     |FINSI;
|FPRC;
-------------------------------------------------------------------------------
|PROCESO BH_11; |TIPO 11;
     nTecla = FSalida;
     |ESTADO_CONTROL nBotAmpli, "HIDE";           ||"SHOW""HIDE""ENABLE""DISABLE".
     |SI nTecla = 25; || Ctrl-F7
          |HAZ CreaTempo;
          eaFichero = Tempo;
          |SUB_EJECUTA_NP "psion066";
          |HAZ BoraTempo;
          |SI enError = 0; |HAZ ImportaPDA; |FINSI;
          |ERROR; |ACABA;
     |FINSI;
|FPRC;
-------------------------------------------------------------------------------
|PROCESO BH_0; |TIPO 0;
     nModo = (FEntrada/100)!0;

     |SI nModo = 2;
          |C_M #1#3, 1, "N";
     |SINO;
          |C_M #1#3, 1, "S";
     |FINSI;

     |ESTADO_CONTROL nBotAmpli, "HIDE";           ||"SHOW""HIDE""ENABLE""DISABLE".
|FPRC;
-------------------------------------------------------------------------------
|PROCESO F2004;
     |PTEC 824;
     FSalida = 10;
|FPRC;
-------------------------------------------------------------------------------
|PROCESO Pendiente; |TIPO 0;
     #1#7 = #1#5 - #1#6;
     |PINTA #1#6;
     |PINTA #1#7;

     |ABRE #12;
     #12#0 = #1#3;                                ||Codigo Articulo.
     |LEE 000#12=;
     |SI FSalida = 0;
          cCodMonDe = cCodMonBase;
          cCodMonA  = #0#6;
          nModo = (FEntrada / 100) ! 0;
          |SI nModo = 1;
             nPrecioComp = #12#9;
             |HAZ DemonAmon;
             #1#9 = nPreComTrab;                     ||Precio medio de Compra.
          |FINSI;
          #1#10 = #1#5 * #1#9;
     |FINSI;
     |CIERRA #12;

     |ABRE #13;
     #13#0 = #1#3;
     #13#1 = #1#8;
     |LEE 000#13=;
     |CIERRA #13;

     |SI #13#5 < #1#5;
          aAlfa = "0000Superado el Stock. Total: " + #13#5;
          |MENAV aAlfa;
     |FINSI;
|FPRC;
-------------------------------------------------------------------------------

|PROCESO TomaPrecio;
   nModoEnt = (FEntrada / 100) ! 0;
   |SI nModoEnt ! 1; |ACABA; |FINSI;

   |ABRE #agifa019;
   #agifa019#0 = #goalbpa5#3;
   |LEE 000#agifa019.=;
   |SI FSalida = 0;
      #goalbpa5#9 = #agifa019#28; |PINTA #goalbpa5#9;
   |FINSI;
   |CIERRA #agifa019;
|FPRC;

|PROCESO Lineas;
     |SI eaTipo = "ENTRADAS"; |Y #1#5 ] 0; |PRINT; |FINSI;
     |SI eaTipo = "SALIDAS"; |Y #1#5 < 0; |PRINT; |FINSI;
|FPRC;

|PROCESO Impresion1;
     |LEE 000#0=;
     |SI FSalida ! 0; |ACABA; |FINSI;
     |HAZ Impresion;
|FPRC;

|PROCESO Impresion; |TIPO 30;
     aAlfa = "0000SIMPRIMIR:" +&13+ "Entradas = SI" + &13 + "Salidas = NO";
     |CONFI aAlfa;
     |SI FSalida = 0;
          eaTipo = "ENTRADAS";
     |SINO;
          eaTipo = "SALIDAS";
     |FINSI;

     aInforme = #7#63; |QBF aInforme;
     |SI eaFicImpre = "";
          |SI #7#62 ! "S"; |ACABA; |FINSI;
          |IMPRE 0;
     |SINO;
          Impresora = eaFicImpre;
          |IMPRE -77;
     |FINSI;
     |SI FSalida = 0;
          |INFOR aInforme;
          |SI FSalida = 0;
               |BUCLELIN 2 Lineas #0;
               |PIEINF;
               |FININF;
          |SINO;
               aInforme = "0000No existe informe [" + aInforme + "]";
               |MENAV aInforme;
          |FINSI;
          |FINIMP;
     |FINSI;
|FPRC;

|PROCESO ImportaPDA;
     |DDEF aAlfa; aAlfa = aAlfa + "goalbpa5";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida ! 0; |ACABA; |FINSI;
     |ABRE #referen@;
     #referen@#0 = #0#0;
     #referen@#1 = #0#1;
     #referen@#2 = 999;
     |LEE 000#referen@.];
     |SI FSalida = 0;
          |LEE 000#referen@.a;
     |SINO;
          |LEE 000#referen@.u;
     |FINSI;
     |SI FSalida = 0; |Y #referen@#0 = #0#0; |Y #referen@#1 = #0#1;
          nLin = #referen@#2 + 1;
     |SINO;
          nLin = 1;
     |FINSI;
     |CIERRA #referen@;
     |DESCARGA_DEF #referen@;

     |DDEF aAlfa; aAlfa = aAlfa + "psion067";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida ! 0; |ACABA; |FINSI;
     |NOME_DAT #referen@#eaFichero#;
     |ABRE #referen@;
     |LEE 000#referen@.p;
     |PARA; |SI FSalida = 0; |HACIENDO;
          #1#0 = #0#0;
          #1#1 = #0#1;
          #1#2 = nLin;
          |GRABA 020#1b;
          #1#3 = #referen@#0; ||Arti
          #1#4 = #referen@#1; ||Des
          #1#8 = #referen@#2; ||Alma
          #1#5 = #referen@#3; ||Uni
          #1#7 = #referen@#3; ||Uni
          FEntrada = 100;     ||simula alta
          |HAZ TomaPrecio;
          |GRABA 020#1a;
          |LIBERA #1;
          nLin = nLin + 1;
          |LEE 000#referen@.s;
     |SIGUE;
     |CIERRA #referen@;
     |DELINDEX #referen@;
     |DESCARGA_DEF #referen@;
     |PONCONTROL 23, "SI"
     |PTEC 809;
     |PTEC 808;
|FPRC;

|PROCESO LineaParti;
     |PRINT;
     nLinParti = 1;
|FPRC;

|DEFBUCLE LineaParti;
     #2#1;
     ;
     "A", #1#0, #1#1, #1#2, 001;
     "A", #1#0, #1#1, #1#2, 999;
     ;
     NULL, LineaParti;
|FIN;

|PROCESO LineaAlba;
     nLinParti = 0;
     |BUCLE LineaParti;
     |SI nLinParti = 0;
          |DDEFECTO #2;
          |PRINT;
     |FINSI;
|FPRC;
--------------------------------------------------------
|PROCESO BorraPartida;
     |BORRA 020#2a;

     #55#28 = #2#32;
     #55#27 = #2#19;
     #55#11 = #2#35;
     |LEE 101#55=;
     |SI FSalida = 0;
          enCodigo = #55#27;
          enForma = -1;
          |HAZ AcumulaME_MS;
          |BORRA 020#55a;
     |FINSI;

     #55#28 = #2#32;
     #55#27 = #2#19;
     #55#11 = 1;
     |LEE 101#55];
     |SI FSalida = 0; |Y #55#28 = #2#32; |Y #55#27 = #2#19;
          || Tiene lineas
     |SINO;
          || No tiene, borra la cabecera
          #54#2 = #2#32;
          #54#0 = #2#19;
          |BORRA 000#54c;
     |FINSI;
|FPRC;

|DEFBUCLE BorraPartida;
     #2#1;
     ;
     "A", #1#0, #1#1, #1#2, 1;
     "A", #1#0, #1#1, #1#2, 999;
     be;
     NULL, BorraPartida;
|FIN;

|PROCESO BorraLin;
     |BUCLE BorraPartida;
|FPRC;

|DEFBUCLE BorraLin;
     #1#1;
     ;
     #0#0, #0#1, 001;
     #0#0, #0#1, 999;
     ;
     NULL, BorraLin;
|FIN;

|PROCESO BajaTotal;
     |ABRE #55;
     |ABRE #54;
     |BUCLE BorraLin;
     |CIERRA #54;
     |CIERRA #55;
|FPRC;
