|FICHEROS;
     dsm00131 #0;
     referen@ #1;
     dsw00068 #68;
|FIN;

|VARIABLES;
     aAlfa = "";
     aSerie = "";
     aClave = "";
     aPtec = "";
     nLin = 0;
     nModo = 0;
     nPtec = 0;
|FIN;

|PROCESO MaxConsu66;
     #0#0 = aSerie;
     #0#1 = aClave;
     #0#2 = 999;
|FPRC;

|PROCESO MinConsu66;
     #0#0 = aSerie;
     #0#1 = aClave;
     #0#2 = 1;
|FPRC;

|PROCESO Consu66; |TIPO 66;
     aSerie = #0#0;
     aClave = #0#1;
     |CONSULTA_F_CLAVE #1#0, MinConsu66, MaxConsu66;
     |SI FSalida = 0;
          |ERROR;
          nLin = #0#2;
          |PTEC 802;
          aAlfa = ("000" + nLin) % -103;
          aPtec = aAlfa % 301; nPtec = &aPtec;
          |PTEC nPtec;
          aPtec = aAlfa % 201; nPtec = &aPtec;
          |PTEC nPtec;
          aPtec = aAlfa % 101; nPtec = &aPtec;
          |PTEC nPtec;
     |FINSI;
|FPRC;

|PROCESO PonDes0; |TIPO 0;
     nModo = (FEntrada / 100) ! 0;
     |ABRE #68;
     #68#0 = #0#1;
     |LEE 000#68=;
     |SI FSalida = 0; |Y nModo = 1;
          #0#3 = #68#1;
     |FINSI;
     |CIERRA #68;
|FPRC;

|PROCESO CheqAct; |TIPO 0;
     |SI #0#9 = "S";
          |DDEF aAlfa; aAlfa = aAlfa + "dsm00131";
          |CARGA_DEF aAlfa, referen@;
          |SI FSalida = 0;
               |ABRE #1;
               |SELECT #2#1;
               #1#0 = #0#0;
               #1#1 = #0#1;
               #1#5 = #0#5;
               |LEE 000#1];
               |PARA; |SI FSalida = 0; |Y #1#0 = #0#0; |Y #1#1 = #0#1; |Y #1#5 = #0#5;
                         |HACIENDO;
                    |SI #1#2 ! #0#2; |Y #1#9 = "S";
                         aAlfa = "0000Ya existe linea activa: " + #1#2;
                         |MENAV aAlfa;
                         |ERROR;
                    |FINSI;
                    |LEE 000#1s;
               |SIGUE;
               |CIERRA #1;
               |DESCARGA_DEF #referen@;
          |FINSI;
     |FINSI;
|FPRC;
