|FICHEROS;
     iber0028 #0;
     referen@ #1;
     refere2@ #2;
     refere3@ #3;
     refere4@ #4;
     iber0019 #19;
     ib__data #20;

     dsm00201 #201; ||Parametros de Correo Centros

     agift555 #555;
     iber0023 #100; ||Historico

||컴컴 A Exportar 컴컴컴컴컴컴컴컴컴컴컴

     agifa512 #512; ||Pagos
     agifa513 #513; ||Cobros
     iber0003 #103; ||Ped. Repo
     iber0004 #104; || ' '
     agifa077 #77;  ||Alb. Comp
     agifa080 #80;  || ' '
     agifa010 #10;  ||Alb Vta
     agifa071 #71;  || ' '
     dsm00047 #47;  || ' '
     agifa084 #84;  ||Fact Directa
     agifa069 #69;  || ' '
     dsm00048 #480;  || ' '
     agifa501 #501; ||Tiquets
     agifa502 #502; || ' '
     dsm00051 #503; || ' '
     dsm00056 #56;  ||Entrada Valorada
     dsm00057 #57;  || ' '
     dsm00043 #43;  ||Regu.Existencias
     dsm00044 #44;  || ' '
     dsm00054 #54;  ||Movi.Almacenes
     dsm00055 #55;  || ''
     agifa509 #509; || Resumen Caja
     agifa090 #90;  || Programaciones
     agifa074 #74;  || ''
     dsm00052 #52;  || ''
     dsm00067 #67;  || ''
|FIN;

|VARIABLES;
     &qFichero = "";
     aFicBorrar = "";

     fFecha    = @;
     aParam    = "";
     a1        = "";
     a2        = "";
     aTar      = "";
     aEmp      = "";
     aFic      = "";
     aFic2     = "";
     aFic3     = "";
     aFic4     = "";
     aDef      = "";
     aAlfa     = "";
     aPath     = "";
     aOrg      = "";
     aDes      = "";
     nCentro   = 0;
     aCentro   = "";
     nCampo1   = 0;
     nCampo2   = 0;
     nCampo3   = 0;
     nCampo4   = 0;
     i         = 0;
     nLin      = 0;

     aFecha = "";
     aHora = "";
     aVarHora = "";
     aFichero = "";
     aNomPaq = "";
     aLong = "";
     nLong = 0;
     aTipo = "";
     aNombre = "";
     nHandle = 0;
     nBytes = 0;
     nCampo = 0;
     aConta = "";
     aOrigen = "";
     aDVers = "";
     aDirOri = "";
     nConta = 0;
     aCampo = "";
     aLetra = "";
     aDBase = "";
     aDMenu = "";
     aDNMen = "002472.men";
     aDAlfa = "";
     nDHand = 0;
     nSwTar = 0;
     aDsk = "";
     aTxt = "";
     aPathPaq = "";
     aFicPaq = "";
     aFicTxt = "";
     nSwAcaba = 0;
     aMenLog = "";
     nErrLog = 0;
     aMensaje = "";
     aFicEnv = "";
|FIN;

|PROCESO CargaDef;
     |DDEF aDef;
     aDef = aDef + aFic;
     |CARGA_DEF aDef, referen@;
     |SI FSalida ! 0;
          aAlfa = "0000 Error al cargar " + aDef;
          |MENAV aAlfa;
     |FINSI;
|FPRC;

|PROCESO CargaDef2;
     |DDEF aDef;
     aDef = aDef + aFic2;
     |CARGA_DEF aDef, refere2@;
     |SI FSalida ! 0;
          aAlfa = "0000 Error al cargar " + aDef;
          |MENAV aAlfa;
     |FINSI;
|FPRC;

|PROCESO CargaDef3;
     |DDEF aDef;
     aDef = aDef + aFic3;
     |CARGA_DEF aDef, refere3@;
     |SI FSalida ! 0;
          aAlfa = "0000 Error al cargar " + aDef;
          |MENAV aAlfa;
     |FINSI;
|FPRC;

|PROCESO CargaDef4;
     |DDEF aDef;
     aDef = aDef + aFic4;
     |CARGA_DEF aDef, refere4@;
     |SI FSalida ! 0;
          aAlfa = "0000 Error al cargar " + aDef;
          |MENAV aAlfa;
     |FINSI;
|FPRC;

|PROCESO NomeDat;
     |PATH_DAT #1 aPath;
     aAlfa = "exp" + (aFic % -105);
     |NOME_DAT #1 aAlfa;
     aAlfa = "|NC";
     aAlfa = #referen@#aAlfa#;
     nCampo1 = aAlfa; nCampo1 = nCampo1 - 1;
     |DELINDEX #1;
     |ABRE #referen@;
|FPRC;

|PROCESO NomeDat2;
     |PATH_DAT #2 aPath;
     aAlfa = "exp" + (aFic2 % -105);
     |NOME_DAT #2 aAlfa;
     aAlfa = "|NC";
     aAlfa = #refere2@#aAlfa#;
     nCampo2 = aAlfa; nCampo2 = nCampo2 - 1;
     |DELINDEX #2;
     |ABRE #refere2@;
|FPRC;

|PROCESO NomeDat3;
     |PATH_DAT #3 aPath;
     aAlfa = "exp" + (aFic3 % -105);
     |NOME_DAT #3 aAlfa;
     aAlfa = "|NC";
     aAlfa = #refere3@#aAlfa#;
     nCampo3 = aAlfa; nCampo3 = nCampo3 - 1;
     |DELINDEX #3;
     |ABRE #refere3@;
|FPRC;

|PROCESO NomeDat4;
     |PATH_DAT #4 aPath;
     aAlfa = "exp" + (aFic4 % -105);
     |NOME_DAT #4 aAlfa;
     aAlfa = "|NC";
     aAlfa = #refere4@#aAlfa#;
     nCampo4 = aAlfa; nCampo4 = nCampo4 - 1;
     |DELINDEX #4;
     |ABRE #refere4@;
|FPRC;

|PROCESO DescargaDef;
     |CIERRA #referen@;
     |DESCARGA_DEF #referen@;
|FPRC;

|PROCESO DescargaDef2;
     |CIERRA #refere2@;
     |DESCARGA_DEF #refere2@;
|FPRC;

|PROCESO DescargaDef3;
     |CIERRA #refere3@;
     |DESCARGA_DEF #refere3@;
|FPRC;

|PROCESO DescargaDef4;
     |CIERRA #refere4@;
     |DESCARGA_DEF #refere4@;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO agifa512;
     #512#9 = "S";
     #512#10 = fFecha;
     |GRABA 020#512a;
     |PARA i = 0; |SI i [ nCampo1; |HACIENDO i = i + 1;
          #1i = #512i;
     |SIGUE;
     |GRABA 020#1n;
|FPRC;

|DEFBUCLE agifa512;
     #512#1;
     9;
     "     ", 000001, "N";
     "zzzzz", 999999, "N";
     be;
     NULL, agifa512;
|FIN;

|PROCESO agifa513;
     #513#9 = "S";
     #513#10 = fFecha;
     |GRABA 020#513a;
     |PARA i = 0; |SI i [ nCampo1; |HACIENDO i = i + 1;
          #1i = #513i;
     |SIGUE;
     |GRABA 020#1n;
|FPRC;

|DEFBUCLE agifa513;
     #513#1;
     9;
     "     ", 000001, "N";
     "zzzzz", 999999, "N";
     be;
     NULL, agifa513;
|FIN;

|PROCESO iber0004;
     |PARA i = 0; |SI i [ nCampo2; |HACIENDO i = i + 1;
          #2i = #104i;
     |SIGUE;
     |GRABA 020#2n;
|FPRC;

|PROCESO iber0003;
     #103#2 = "S";
     #103#3 = fFecha;
     |GRABA 020#103a;
     |PARA i = 0; |SI i [ nCampo1; |HACIENDO i = i + 1;
          #1i = #103i;
     |SIGUE;
     |GRABA 020#1n;
|FPRC;

|DEFBUCLE iber0003;
     #103#1;
     2;
     00001, "01.01.0000", "N";
     99999, "31.12.9999", "N";
     be;
     NULL, iber0003, iber0004;
|FIN;

|PROCESO agifa080;
     |PARA i = 0; |SI i [ nCampo2; |HACIENDO i = i + 1;
          #2i = #80i;
     |SIGUE;
     |GRABA 020#2n;
|FPRC;

|PROCESO agifa077;
     #77#75 = "S";
     #77#76 = fFecha;
     |GRABA 020#77a;
     |PARA i = 0; |SI i [ nCampo1; |HACIENDO i = i + 1;
          #1i = #77i;
     |SIGUE;
     |GRABA 020#1n;
|FPRC;

|DEFBUCLE agifa077;
     #77#1;
     75;
     "     ", 000001, "N";
     "zzzzz", 999999, "N";
     be;
     NULL, agifa077, agifa080;
|FIN;

|PROCESO dsm00047;
     |PARA i = 0; |SI i [ nCampo3; |HACIENDO i = i + 1;
          #3i = #47i;
     |SIGUE;
     |GRABA 020#3n;
|FPRC;

|DEFBUCLE dsm00047;
     #47#1;
     ;
     #71#29, #71#0, #71#1, 001;
     #71#29, #71#0, #71#1, 999;
     ;
     NULL, dsm00047;
|FIN;

|PROCESO agifa071;
     |PARA i = 0; |SI i [ nCampo2; |HACIENDO i = i + 1;
          #2i = #71i;
     |SIGUE;
     |GRABA 020#2n;
     |BUCLE dsm00047;
|FPRC;

|PROCESO agifa010;
     #10#58 = "S";
     #10#59 = fFecha;
     |GRABA 020#10a;
     |PARA i = 0; |SI i [ nCampo1; |HACIENDO i = i + 1;
          #1i = #10i;
     |SIGUE;
     |GRABA 020#1n;
|FPRC;

|DEFBUCLE agifa010;
     #10#1;
     58;
     "     ", 000001, "N";
     "zzzzz", 999999, "N";
     be;
     NULL, agifa010, agifa071;
|FIN;

|PROCESO dsm00048;
     |PARA i = 0; |SI i [ nCampo3; |HACIENDO i = i + 1;
          #3i = #480i;
     |SIGUE;
     |GRABA 020#3n;
|FPRC;

|DEFBUCLE dsm00048;
     #480#1;
     ;
     #69#20, #69#0, #69#1, 001;
     #69#20, #69#0, #69#1, 999;
     ;
     NULL, dsm00048;
|FIN;

|PROCESO agifa069;
     |PARA i = 0; |SI i [ nCampo2; |HACIENDO i = i + 1;
          #2i = #69i;
     |SIGUE;
     |GRABA 020#2n;
     |BUCLE dsm00048;
|FPRC;

|PROCESO agifa084;
     #84#61 = "S";
     #84#62 = fFecha;
     |GRABA 020#84a;
     |PARA i = 0; |SI i [ nCampo1; |HACIENDO i = i + 1;
          #1i = #84i;
     |SIGUE;
     |GRABA 020#1n;
|FPRC;

|DEFBUCLE agifa084;
     #84#1;
     61;
     "     ", 000001, "N";
     "zzzzz", 999999, "N";
     be;
     NULL, agifa084, agifa069;
|FIN;

|PROCESO dsm00051;
     |PARA i = 0; |SI i [ nCampo3; |HACIENDO i = i + 1;
          #3i = #503i;
     |SIGUE;
     |GRABA 020#3n;
|FPRC;

|DEFBUCLE dsm00051;
     #503#1;
     ;
     #502#20, #502#0, #502#1, 001;
     #502#20, #502#0, #502#1, 999;
     ;
     NULL, dsm00051;
|FIN;

|PROCESO agifa502;
     |PARA i = 0; |SI i [ nCampo2; |HACIENDO i = i + 1;
          #2i = #502i;
     |SIGUE;
     |GRABA 020#2n;
     |BUCLE dsm00051;
|FPRC;

|PROCESO agifa501;
     #501#44 = "S";
     #501#45 = fFecha;
     |GRABA 020#501a;
     |PARA i = 0; |SI i [ nCampo1; |HACIENDO i = i + 1;
          #1i = #501i;
     |SIGUE;
     |GRABA 020#1n;
|FPRC;

|DEFBUCLE agifa501;
     #501#1;
     44;
     "     ", 000001, "N";
     "zzzzz", 999999, "N";
     be;
     NULL, agifa501, agifa502;
|FIN;

|PROCESO dsm00057;
     |PARA i = 0; |SI i [ nCampo2; |HACIENDO i = i + 1;
          #2i = #57i;
     |SIGUE;
     |GRABA 020#2n;
|FPRC;

|PROCESO dsm00056;
     #56#3 = "S";
     #56#4 = fFecha;
     |GRABA 020#56a;
     |PARA i = 0; |SI i [ nCampo1; |HACIENDO i = i + 1;
          #1i = #56i;
     |SIGUE;
     |GRABA 020#1n;
|FPRC;

|DEFBUCLE dsm00056;
     #56#1;
     3;
     "     ", 000001, "N";
     "zzzzz", 999999, "N";
     be;
     NULL, dsm00056, dsm00057;
|FIN;

|PROCESO dsm00044;
     |PARA i = 0; |SI i [ nCampo2; |HACIENDO i = i + 1;
          #2i = #44i;
     |SIGUE;
     |GRABA 020#2n;
|FPRC;

|PROCESO dsm00043;
     #43#5 = "S";
     #43#6 = fFecha;
     |GRABA 020#43a;
     |PARA i = 0; |SI i [ nCampo1; |HACIENDO i = i + 1;
          #1i = #43i;
     |SIGUE;
     |GRABA 020#1n;
|FPRC;

|DEFBUCLE dsm00043;
     #43#1;
     5;
     "     ", 000001, "N";
     "zzzzz", 999999, "N";
     be;
     NULL, dsm00043, dsm00044;
|FIN;

|PROCESO dsm00055;
     |PARA i = 0; |SI i [ nCampo2; |HACIENDO i = i + 1;
          #2i = #55i;
     |SIGUE;
     |GRABA 020#2n;
|FPRC;

|PROCESO dsm00054;
     #54#3 = "S";
     #54#4 = fFecha;
     |GRABA 020#54a;
     |PARA i = 0; |SI i [ nCampo1; |HACIENDO i = i + 1;
          #1i = #54i;
     |SIGUE;
     |GRABA 020#1n;
|FPRC;

|DEFBUCLE dsm00054;
     #54#1;
     3;
     "     ", 000001, "N";
     "zzzzz", 999999, "N";
     be;
     NULL, dsm00054, dsm00055;
|FIN;

|PROCESO agifa509;
     #509#60 = "S";
     #509#61 = fFecha;
     |GRABA 020#509a;
     |PARA i = 0; |SI i [ nCampo1; |HACIENDO i = i + 1;
          #1i = #509i;
     |SIGUE;
     |GRABA 020#1n;
|FPRC;

|DEFBUCLE agifa509;
     #509#1;
     60, 56;
     00001, 00001, "01.01.0000", "N", "N";
     99999, 99999, "31.12.9999", "N", "N";
     be;
     NULL, agifa509;
|FIN;

|PROCESO dsm00067;
     |PARA i = 0; |SI i [ nCampo4; |HACIENDO i = i + 1;
          #4i = #67i;
     |SIGUE;
     |GRABA 020#4n;
|FPRC;

|PROCESO dsm00052;
     |PARA i = 0; |SI i [ nCampo3; |HACIENDO i = i + 1;
          #3i = #52i;
     |SIGUE;
     |GRABA 020#3n;
|FPRC;

|DEFBUCLE dsm00052;
     #52#1;
     ;
     #74#9, #74#0, #74#1, 001;
     #74#9, #74#0, #74#1, 999;
     ;
     NULL, dsm00052;
|FIN;

|DEFBUCLE dsm00067;
     #67#1;
     ;
     #74#9, #74#0, #74#1, "               ";
     #74#9, #74#0, #74#1, "zzzzzzzzzzzzzzz";
     ;
     NULL, dsm00067;
|FIN;

|PROCESO agifa074;
     |BUCLE dsm00052;
     |BUCLE dsm00067;
     |PARA i = 0; |SI i [ nCampo2; |HACIENDO i = i + 1;
          #2i = #74i;
     |SIGUE;
     |GRABA 020#2n;
|FPRC;

|PROCESO agifa090;
     #90#21 = "S";
     #90#22 = fFecha;
     |GRABA 020#90a;
     |PARA i = 0; |SI i [ nCampo1; |HACIENDO i = i + 1;
          #1i = #90i;
     |SIGUE;
     |GRABA 020#1n;
|FPRC;

|DEFBUCLE agifa090;
     #90#1;
     10, 21;
     "     ", 000001, "S", "N";
     "zzzzz", 999999, "S", "N";
     be;
     NULL, agifa090, agifa074;
|FIN;

|PROCESO ibdata;
     |PARA i = 0; |SI i [ nCampo1; |HACIENDO i = i + 1;
          #1i = #20i;
          #2i = #20i;
     |SIGUE;
     |GRABA 020#1n;
     |GRABA 000#2n;
     |BORRA 020#20a;
|FPRC;

|DEFBUCLE ibdata;
     #20#1;
     ;
     INICIO;
     FINAL;
     be;
     NULL, ibdata;
|FIN;

|PROCESO iber0019;
     aAlfa = "ib" + (("00" + #19#1) % -102) + "data";
     |NOME_DAT #20 aAlfa;
     |BUCLE ibdata;
|FPRC;

|DEFBUCLE iber0019;
     #19#1;
     ;
     nCentro, 01;
     nCentro, 99;
     ;
     NULL, iber0019;
|FIN;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO Exporta;
     aPath = #555#2; |QBF aPath;
     aPath = aPath + "/";
     |MKDIR aPath;
     ||컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
     aFic = "ib__data";
     |HAZ CargaDef;
     |SI FSalida = 0;
          nCentro = aCentro;
          |HAZ NomeDat;
          aFic2 = "ib__data";
          |HAZ CargaDef2;
          |SI FSalida = 0;
               |ABRE #2;
               |BUCLE iber0019;
               |CIERRA #2;
               |HAZ DescargaDef2;
          |FINSI;
          |HAZ DescargaDef;
     |FINSI;
     ||컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
     aFic = "agifa512";
     |HAZ CargaDef;
     |SI FSalida = 0;
          |HAZ NomeDat;
          |BUCLE agifa512;
          |HAZ DescargaDef;
     |FINSI;
     ||컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
     aFic = "agifa513";
     |HAZ CargaDef;
     |SI FSalida = 0;
          |HAZ NomeDat;
          |BUCLE agifa513;
          |HAZ DescargaDef;
     |FINSI;
     ||컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
     aFic = "iber0003";
     |HAZ CargaDef;
     |SI FSalida = 0;
          aFic2 = "iber0004";
          |HAZ CargaDef2;
          |SI FSalida = 0;
               |HAZ NomeDat;
               |HAZ NomeDat2;
               |BUCLE iber0003;
               |HAZ DescargaDef2;
          |FINSI;
          |HAZ DescargaDef;
     |FINSI;
     ||컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
     aFic = "agifa077";
     |HAZ CargaDef;
     |SI FSalida = 0;
          aFic2 = "agifa080";
          |HAZ CargaDef2;
          |SI FSalida = 0;
               |HAZ NomeDat;
               |HAZ NomeDat2;
               |BUCLE agifa077;
               |HAZ DescargaDef2;
          |FINSI;
          |HAZ DescargaDef;
     |FINSI;
     ||컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
     aFic = "agifa010";
     |HAZ CargaDef;
     |SI FSalida = 0;
          aFic2 = "agifa071";
          |HAZ CargaDef2;
          |SI FSalida = 0;
               aFic3 = "dsm00047";
               |HAZ CargaDef3;
               |SI FSalida = 0;
                    |HAZ NomeDat;
                    |HAZ NomeDat2;
                    |HAZ NomeDat3;
                    |BUCLE agifa010;
                    |HAZ DescargaDef3;
               |FINSI;
               |HAZ DescargaDef2;
          |FINSI;
          |HAZ DescargaDef;
     |FINSI;
     ||컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
     aFic = "agifa084";
     |HAZ CargaDef;
     |SI FSalida = 0;
          aFic2 = "agifa069";
          |HAZ CargaDef2;
          |SI FSalida = 0;
               aFic3 = "dsm00048";
               |HAZ CargaDef3;
               |SI FSalida = 0;
                    |HAZ NomeDat;
                    |HAZ NomeDat2;
                    |HAZ NomeDat3;
                    |BUCLE agifa084;
                    |HAZ DescargaDef3;
               |FINSI;
               |HAZ DescargaDef2;
          |FINSI;
          |HAZ DescargaDef;
     |FINSI;
     ||컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
     aFic = "agifa501";
     |HAZ CargaDef;
     |SI FSalida = 0;
          aFic2 = "agifa502";
          |HAZ CargaDef2;
          |SI FSalida = 0;
               aFic3 = "dsm00051";
               |HAZ CargaDef3;
               |SI FSalida = 0;
                    |HAZ NomeDat;
                    |HAZ NomeDat2;
                    |HAZ NomeDat3;
                    |BUCLE agifa501;
                    |HAZ DescargaDef3;
               |FINSI;
               |HAZ DescargaDef2;
          |FINSI;
          |HAZ DescargaDef;
     |FINSI;
     ||컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
     aFic = "dsm00056";
     |HAZ CargaDef;
     |SI FSalida = 0;
          aFic2 = "dsm00057";
          |HAZ CargaDef2;
          |SI FSalida = 0;
               |HAZ NomeDat;
               |HAZ NomeDat2;
               |BUCLE dsm00056;
               |HAZ DescargaDef2;
          |FINSI;
          |HAZ DescargaDef;
     |FINSI;
     ||컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
     aFic = "dsm00043";
     |HAZ CargaDef;
     |SI FSalida = 0;
          aFic2 = "dsm00044";
          |HAZ CargaDef2;
          |SI FSalida = 0;
               |HAZ NomeDat;
               |HAZ NomeDat2;
               |BUCLE dsm00043;
               |HAZ DescargaDef2;
          |FINSI;
          |HAZ DescargaDef;
     |FINSI;
     ||컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
     aFic = "dsm00054";
     |HAZ CargaDef;
     |SI FSalida = 0;
          aFic2 = "dsm00055";
          |HAZ CargaDef2;
          |SI FSalida = 0;
               |HAZ NomeDat;
               |HAZ NomeDat2;
               |BUCLE dsm00054;
               |HAZ DescargaDef2;
          |FINSI;
          |HAZ DescargaDef;
     |FINSI;
     ||컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
     aFic = "agifa509";
     |HAZ CargaDef;
     |SI FSalida = 0;
          |HAZ NomeDat;
          |BUCLE agifa509;
          |HAZ DescargaDef;
     |FINSI;
     ||컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
     aFic = "agifa090";
     |HAZ CargaDef;
     |SI FSalida = 0;
          aFic2 = "agifa074";
          |HAZ CargaDef2;
          |SI FSalida = 0;
               aFic3 = "dsm00052";
               |HAZ CargaDef3;
               |SI FSalida = 0;
                    aFic4 = "dsm00067";
                    |HAZ CargaDef4;
                    |SI FSalida = 0;
                         |HAZ NomeDat;
                         |HAZ NomeDat2;
                         |HAZ NomeDat3;
                         |HAZ NomeDat4;
                         |BUCLE agifa090;
                         |HAZ DescargaDef4;
                    |FINSI;
                    |HAZ DescargaDef3;
               |FINSI;
               |HAZ DescargaDef2;
          |FINSI;
          |HAZ DescargaDef;
     |FINSI;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
  El Nombre del Fichero:  yymmdd + empresa + "." + Linea Histo
           digitos....   Fecha(6)   (5)             (3)
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO UltHistorico;
     #100#0 = "E";
     #100#6 = aCentro;
     #100#1 = fFecha;
     #100#2 = 999;
     |LEE 000#100];
     |SI FSalida = 0;
          |LEE 000#100a;
     |SINO;
          |LEE 000#100u;
     |FINSI;
     |SI FSalida = 0; |Y #100#0 = "E"; |Y #100#6 = aCentro; |Y #100#1 = fFecha;
          nLin = #100#2 + 1;
     |SINO;
          nLin = 1;
     |FINSI;
|FPRC;

|PROCESO Paquete;
     aPath = #555#2; |QBF aPath;
     aPath = aPath + "/";

     |ABRE #100;
     |HAZ UltHistorico;

     |DFICE aEmp;
     aEmp = aEmp % -205;

     aFic = (fFecha % -102) + (fFecha % 402) + (fFecha % 102);

     aAlfa = ("000" + nLin) % -103;
     aTar = aFic + aEmp + "." + aAlfa;    ||->Nombre del Fichero

     a1 = aPath + aTar + " *.dat *.ixx *.ddx";
     a2 = aPath;
     |ATAR a1, a2;

     a1 = aPath + aTar;
     |COMPRIME a1;
     |FBORRA a1;
     a2 = aPath + aFic + aEmp + ".gz";
     |RENOMBRA_FICHERO a2, a1;

     aFicEnv = aPath + aTar;

     aFic = aPath + aTar;
     |XABRE "E", aFic, 0;
     |SI FSalida ! 0;
          aAlfa = "0000No puede compactar... " + aTar;
          |MENAV aAlfa;
          aTar = "ERROR EN TAR";
     |SINO;
          aFic = aPath;
          |_PDIR aFic;
          |PARA; |SI FSalida = 0; |HACIENDO;
               aAlfa = aFic % -103;
               |SI aAlfa = "ddx"; |O aAlfa = "ixx"; |O aAlfa = "dat";
                    aAlfa = aFic % -1003;
                    |SI aAlfa = "exp"; |FBORRA aFic; |FINSI;
               |FINSI;
               |_SDIR aFic;
          |SIGUE;
     |FINSI;

     |HORA aAlfa;
     |DDEFECTO #100;
     #100#0 = "E";
     #100#1 = fFecha;
     #100#2 = nLin;
     #100#3 = aAlfa;
     #100#4 = Usuario % 810;
     #100#5 = aTar;
     #100#6 = aCentro;
     |GRABA 020#100n;
     |CIERRA #100;

     ||Poner el TXT ... i juntalos.

     nSwAcaba = 0;
     |HAZ CreaTxt;

     |SI nSwAcaba = 0;
          |SI nSwTar = 1;
               qFichero = aPath + aTar + ".tar";      || Envio por Correo
               |SUB_EJECUTA "dsm00205";
               aFicBorrar = aPath + aTar;
               |FBORRA aFicBorrar;
               aFicBorrar = aPath + aTar + ".txt";
               |FBORRA aFicBorrar;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Tipo3; |TIPO 3;
     |SI #0#0 = "NO"; |ACABA; |FINSI;
     |DFICE aCentro;
     aCentro = aCentro % -403;

     fFecha = ~;
     aFecha = fFecha;
     |HORA aHora;
     aVarHora = aHora % 105;

     |ABRE #555; |LEE 000#555p; |CIERRA #555;
     aPath = #555#2; |QBF aPath;
     |SI aPath = "";
          |MENAV "0000Directorio no indicado...";
          |ACABA;
     |FINSI;

     |HAZ Exporta;

     |HAZ Paquete;
|FPRC;

|PROGRAMA;
     |SI aParam ! "";
          #0#0 = "SI";
          |HAZ Tipo3;
     |SINO;
          |MANTE #0;
     |FINSI;
|FPRO;


______________________________________________________________________

|PROCESO CreaTxt;
     aTipo = "60";

     |ABRE #dsm00201;
     |LEE 010#dsm00201.p;
     |SI FSalida ! 0;
          |MENAV "0000No se han establecido los parametros de envio";
          nSwAcaba = 1;
          |CIERRA #dsm00201;
          |ACABA;
     |SINO;
          nSwAcaba = 0;
     |FINSI;
     |CIERRA #dsm00201;


     aOrigen = #dsm00201#6;
     |QBF aOrigen;
     aDirOri = #dsm00201#7;
     |QBF aDirOri;
     aFichero = aFicEnv;
     |QBF aFichero;


     |HAZ SacaNombre;

     aPathPaq = aFichero - aNomPaq;
     aNombre = aNomPaq;
     |XABRE "B", aFichero, nHandle;
     |SI FSalida < 0;
          aMenLog = "    Longitud de [" + aFichero + "] inaccesible.";
          nErrLog = 1;
          |HAZ Log;
          |ACABA;
     |SINO;
          nBytes = 0;
          |XPOSICION nHandle, nBytes, 2;
          |XCIERRA nHandle;
     |FINSI;

     |HAZ SacaVersion;

     aFicTxt = aFichero + ".txt";
     |XABRE "W", aFicTxt, nHandle;
     |SI FSalida < 0;
          aMenLog = "    No se pudo crear [" + aFicTxt + "].";
          nErrLog = 1;
          |HAZ Log;
     |SINO;
          aAlfa = aTipo;  |XGRABA nHandle, aAlfa;
          aAlfa = aFecha; |XGRABA nHandle, aAlfa;
          aAlfa = aVarHora;  |XGRABA nHandle, aAlfa;
          aAlfa = "PAQ." + aNombre;
          |XGRABA nHandle, aAlfa;
          |PARA nCampo = 1; |SI nCampo [ 12; |HACIENDO nCampo = nCampo + 1;
               aAlfa = "";         || Des + Obs
               |XGRABA nHandle, aAlfa;
          |SIGUE;
          aAlfa = aNombre; |XGRABA nHandle, aAlfa;
          aAlfa = nBytes;  |XGRABA nHandle, aAlfa;
          aConta = aNombre % -103;
          |QBF aConta;
          |XGRABA nHandle, aConta;
          |XGRABA nHandle, aOrigen;
          |XGRABA nHandle, aDVers;
          aAlfa = aDirOri; |XGRABA nHandle, aAlfa;
          |XCIERRA nHandle;
     |FINSI;
     ||Falta unir el paquete con el txt, creando el paquete bueno.(*.tar)
     |HAZ CreaPaqTgz;
|FPRC;

|PROCESO Log;
     aMensaje = aMenLog;
     |MENAV aMensaje;
|FPRC;

|PROCESO SacaNombre;
     aNomPaq = "";
     aLong = aFichero % A0;
     nLong = aLong;
     |PARA nConta = 1; |SI nConta [ nLong; |HACIENDO nConta = nConta + 1;
          |SI nConta [ 99;
               aCampo = ("00" + nConta) % -102;
               aCampo = "-" + aCampo + "01";
               nCampo = aCampo;
               aLetra = aFichero % nCampo;
               |SI aLetra ! "/"; |Y aLetra ! "\";
                    aNomPaq = aLetra + aNomPaq;
               |SINO;
                    |SAL;
               |FINSI;
          |SINO;
               aNomPaq = "";
               |SAL;
          |FINSI;
     |SIGUE;
|FPRC;


|PROCESO SacaVersion;
     aDVers = "00.00.000";
     |DBASE aDBase;
     aDMenu = aDBase + "/" + aDNMen;
     |XABRE "U", aDMenu, nDHand;
     |SI FSalida ] 0;
          |XLEE nDHand, 250, aDAlfa;
          aDVers = (aDAlfa % -105) + "." + (aDAlfa % 403);
          |XCIERRA nDHand;
     |FINSI;
|FPRC;


|PROCESO CreaPaqTgz;
     ||Une el txt y el paquete, con un ATAR, luego los comprime.
     aDsk = aNombre;
     aTxt = aNombre + ".txt";
     aFicPaq = aFichero + ".tar";
     aAlfa = aFicPaq + " " + aDsk + " " + aTxt;
     |ATAR aAlfa, aPathPaq;
     |SI FSalida = 0;
          nSwTar = 1;
     |SINO;
          nSwTar = 0;
          aMenLog = "    Problemas al comprimir [" + aFicPaq + "]";
          nErrLog = 1;
          |HAZ Log;
     |FINSI;
|FPRC;
