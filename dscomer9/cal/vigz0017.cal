|FICHEROS;
vigz0017 #0;
agifa071 #1;
agifa010 #2;
agifa019 #3;
agifa025 #4;
vigw0015 #5;   ||Temporal.
agifa024 #6;
agifa007;
vigm0043 #43;
|FIN;

|VARIABLES;
nSwPie = 0;
&Tempo = "";
aSerie = "";
informe   = "vigz0017";
fecha     = @;
fecha_inf = "";
fecha_sup = "";
&zona     = "";
&repres   = "";
&cliente  = "";
mes       = "";
mes1      = 0;
i         = 0;
sw        = 0;
&swlin    = 0;
&t1       = 0;
&t2       = 0;
&t3       = 0;
&t4       = 0;
&t5       = 0;
&t6       = 0;
&t7       = 0;
&t8       = 0;
&t9       = 0;
&t10      = 0;
&t11      = 0;
&t12      = 0;
&t13      = 0;
&tr1      = 0;
&tr2      = 0;
&tr3      = 0;
&tr4      = 0;
&tr5      = 0;
&tr6      = 0;
&tr7      = 0;
&tr8      = 0;
&tr9      = 0;
&tr10     = 0;
&tr11     = 0;
&tr12     = 0;
&tr13     = 0;
&tc1      = 0;
&tc2      = 0;
&tc3      = 0;
&tc4      = 0;
&tc5      = 0;
&tc6      = 0;
&tc7      = 0;
&tc8      = 0;
&tc9      = 0;
&tc10     = 0;
&tc11     = 0;
&tc12     = 0;
&tc13     = 0;
&tt1      = 0;
&tt2      = 0;
&tt3      = 0;
&tt4      = 0;
&tt5      = 0;
&tt6      = 0;
&tt7      = 0;
&tt8      = 0;
&tt9      = 0;
&tt10     = 0;
&tt11     = 0;
&tt12     = 0;
&tt13     = 0;
|FIN;

|PROCESO EsInterno;
     |ABRE #agifa007;
     #agifa007#26 = aSerie;
     |LEE 000#agifa007.=;
     |CIERRA #agifa007;

     |SI #agifa007#37 = "S";
          FSalida = 0;
     |SINO;
          FSalida = 1;
     |FINSI;
|FPRC;

|CALCULO ao;|TIPO 7;
fecha = ~;
#0#0 = fecha % 0704;
|PINTA #0#0;
|FCAL;

|CALCULO pasa_lin;
|ABRE #2;
#2#52 = #1#29;
#2#0 = #1#0;
|LEE 000#2=;
|CIERRA #2;

aSerie = #agifa010#52;
|HAZ EsInterno;
|SI FSalida = 0; |ACABA; |FINSI;

|ABRE #3;
#3#0 = #1#2;
|LEE 000#3=;
|CIERRA #3;

|ABRE #4;
#4#0 = #2#6;
|LEE 000#4=;
|CIERRA #4;

|ABRE #6;
#6#0 = #2#3;
|LEE 000#6=;
|CIERRA #6;

fecha_inf = "01.01." + #0#0;
fecha_sup = "31.12." + #0#0;
|SI #2#1 ] fecha_inf;|Y #2#1 [ fecha_sup;
    |SI #2#6 ] #0#7;|Y #2#6 [ #0#8;
        |SI #6#3 ] #0#9;|Y #6#3 [ #0#10;
            |SI #2#3 ] #0#11;|Y #2#3 [ #0#12;
                |ABRE #5;
                #5#16 = #2#6;
                #5#17 = #2#3;
                #5#0  = #6#3;
                #5#1  = #1#2;
                |LEE 000#5=;
                |SI FSalida ! 0;
                    |DDEFECTO #5;
                    #5#16 = #2#6;
                    #5#17 = #2#3;
                    #5#0  = #6#3;
                    #5#1  = #1#2;
                    |GRABA 000#5c;
                    |LIBERA #5;
                |FINSI;
                mes  = #2#1 % 402;
                mes1 = mes + 2;
                #5#16 = #2#6;
                #5#17 = #2#3;
                #5#0  = #6#3;
                #5#1  = #1#2;
                #5#2  = #3#1;
                #5mes1 = #5mes1 + #1#5;
                #5#15  = #5#15 + #1#5;
                |GRABA 000#5a;
                |LIBERA #5;
                |PARA i = 0;|SI i = 17;|HACIENDO i = i + 1;
                      #5i = "";
                |SIGUE;
                |CIERRA #5;
            |FINSI;
        |FINSI;
    |FINSI;
|FINSI;
|FCAL;

|DEFBUCLE lee_lin;
#1#1;
2;
#0#1 , 000001,    1 , #0#3;
#0#2 , 999999, 999 , #0#4;
be;
NULL,pasa_lin;
|FIN;

|CALCULO imprime;
|SI sw = 0;
    sw = 1;
    repres  = #5#16;
    zona    = #5#0;
    cliente = #5#17;
    swlin = 3;  ||Datos Representante
    |PRINT;
    swlin = 0;
    swlin = 2;  ||Datos Zona
    |PRINT;
    swlin = 0;
    swlin = 5;  ||Datos Cliente
    |PRINT;
    swlin = 0;
|FINSI;

|SI sw = 1;

    |SI repres ! #5#16;
        swlin = 6;   ||Totales Cliente
        |PRINT;
        swlin = 0;
        swlin = 1;   ||Totales Zona
        |PRINT;
        swlin = 0;
        swlin = 4;   ||Totales Representante
        |PRINT;
        swlin = 0;
        |PIEINF;
        repres  = #5#16;
        zona    = #5#0;
        cliente = #5#17;
        swlin = 3;   ||Datos Representante
        |PRINT;
        swlin = 0;
        swlin = 2;   ||Datos Zona
        |PRINT;
        swlin = 0;
        swlin = 5;   ||Datos Cliente
        |PRINT;
        swlin = 0;
        t1 = 0;
        t2 = 0;
        t3 = 0;
        t4 = 0;
        t5 = 0;
        t6 = 0;
        t7 = 0;
        t8 = 0;
        t9 = 0;
        t10 = 0;
        t11 = 0;
        t12 = 0;
        t13 = 0;

        tr1 = 0;
        tr2 = 0;
        tr3 = 0;
        tr4 = 0;
        tr5 = 0;
        tr6 = 0;
        tr7 = 0;
        tr8 = 0;
        tr9 = 0;
        tr10 = 0;
        tr11 = 0;
        tr12 = 0;
        tr13 = 0;

        tc1 = 0;
        tc2 = 0;
        tc3 = 0;
        tc4 = 0;
        tc5 = 0;
        tc6 = 0;
        tc7 = 0;
        tc8 = 0;
        tc9 = 0;
        tc10 = 0;
        tc11 = 0;
        tc12 = 0;
        tc13 = 0;
    |FINSI;

    |SI zona ! #5#0;
        swlin = 6;  ||Totales Cliente
        |PRINT;
        swlin = 0;
        swlin = 1;  ||Totales Zona
        |PRINT;
        swlin = 0;
        zona = #5#0;
        cliente = #5#17;
        swlin = 2;  ||Datos Zona
        |PRINT;
        swlin = 0;
        swlin = 5;  ||Datos Cliente
        |PRINT;
        swlin = 0;
        t1 = 0;
        t2 = 0;
        t3 = 0;
        t4 = 0;
        t5 = 0;
        t6 = 0;
        t7 = 0;
        t8 = 0;
        t9 = 0;
        t10 = 0;
        t11 = 0;
        t12 = 0;
        t13 = 0;
        tc1 = 0;
        tc2 = 0;
        tc3 = 0;
        tc4 = 0;
        tc5 = 0;
        tc6 = 0;
        tc7 = 0;
        tc8 = 0;
        tc9 = 0;
        tc10 = 0;
        tc11 = 0;
        tc12 = 0;
        tc13 = 0;
    |FINSI;

    |SI cliente ! #5#17;
        swlin = 6;   ||Totales Cliente
        |PRINT;
        swlin = 0;
        cliente = #5#17;
        swlin = 5;   ||Datos Cliente
        |PRINT;
        swlin = 0;

        tc1 = 0;
        tc2 = 0;
        tc3 = 0;
        tc4 = 0;
        tc5 = 0;
        tc6 = 0;
        tc7 = 0;
        tc8 = 0;
        tc9 = 0;
        tc10 = 0;
        tc11 = 0;
        tc12 = 0;
        tc13 = 0;
    |FINSI;

|FINSI;

t1 = t1 + #5#3;
t2 = t2 + #5#4;
t3 = t3 + #5#5;
t4 = t4 + #5#6;
t5 = t5 + #5#7;
t6 = t6 + #5#8;
t7 = t7 + #5#9;
t8 = t8 + #5#10;
t9 = t9 + #5#11;
t10 = t10 + #5#12;
t11 = t11 + #5#13;
t12 = t12 + #5#14;
t13 = t13 + #5#15;

tr1 = tr1 + #5#3;
tr2 = tr2 + #5#4;
tr3 = tr3 + #5#5;
tr4 = tr4 + #5#6;
tr5 = tr5 + #5#7;
tr6 = tr6 + #5#8;
tr7 = tr7 + #5#9;
tr8 = tr8 + #5#10;
tr9 = tr9 + #5#11;
tr10 = tr10 + #5#12;
tr11 = tr11 + #5#13;
tr12 = tr12 + #5#14;
tr13 = tr13 + #5#15;

tc1 = tc1 + #5#3;
tc2 = tc2 + #5#4;
tc3 = tc3 + #5#5;
tc4 = tc4 + #5#6;
tc5 = tc5 + #5#7;
tc6 = tc6 + #5#8;
tc7 = tc7 + #5#9;
tc8 = tc8 + #5#10;
tc9 = tc9 + #5#11;
tc10 = tc10 + #5#12;
tc11 = tc11 + #5#13;
tc12 = tc12 + #5#14;
tc13 = tc13 + #5#15;

tt1 = tt1 + #5#3;
tt2 = tt2 + #5#4;
tt3 = tt3 + #5#5;
tt4 = tt4 + #5#6;
tt5 = tt5 + #5#7;
tt6 = tt6 + #5#8;
tt7 = tt7 + #5#9;
tt8 = tt8 + #5#10;
tt9 = tt9 + #5#11;
tt10 = tt10 + #5#12;
tt11 = tt11 + #5#13;
tt12 = tt12 + #5#14;
tt13 = tt13 + #5#15;
|PRINT;
|FCAL;

|DEFBUCLE impresion;
#5#1;
;
INICIO;
FINAL;
be;
NULL,imprime;
|FIN;

|PROCESO HistoTras;
     aSerie = #43#0;
     |HAZ EsInterno;
     |SI FSalida = 0; |ACABA; |FINSI;

     |ABRE #3;
     #3#0 = #43#12;
     |LEE 000#3=;
     |CIERRA #3;

     |ABRE #4;
     #4#0 = #43#10;
     |LEE 000#4=;
     |CIERRA #4;

     |ABRE #6;
     #6#0 = #43#8;
     |LEE 000#6=;
     |CIERRA #6;

     fecha_inf = "01.01." + #0#0;
     fecha_sup = "31.12." + #0#0;
     |SI #43#6 ] fecha_inf;|Y #43#6 [ fecha_sup;
         |SI #43#10 ] #0#7;|Y #43#10 [ #0#8;
             |SI #43#9 ] #0#9;|Y #43#9 [ #0#10;
                 |SI #43#8 ] #0#11;|Y #43#8 [ #0#12;
                     |DDEFECTO #5;
                     |ABRE #5;
                     #5#16 = #43#10;
                     #5#17 = #43#8;
                     #5#0  = #43#9;
                     #5#1  = #43#12;
                     |LEE 000#5=;
                     |SI FSalida ! 0; |GRABA 020#5b; |FINSI;
                     mes  = #43#6 % 402;
                     mes1 = mes + 2;
                     #5#16 = #43#10;
                     #5#17 = #43#8;
                     #5#0  = #43#9;
                     #5#1  = #43#12;
                     #5#2  = #3#1;
                     #5mes1 = #5mes1 + #43#13;
                     #5#15  = #5#15 + #43#13;
                     |GRABA 020#5a;
                     |LIBERA #5;
                     |CIERRA #5;
                 |FINSI;
             |FINSI;
         |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE HistoTras;
     #43#1;
     12;
     #0#1, 000000, 001, #0#3;
     #0#2, 999999, 999, #0#4;
     ;
     NULL, HistoTras;
|FIN;

|CALCULO imprimeCR;
     nSwPie = 1;
     |PRINT;
|FCAL;

|DEFBUCLE impresionCR;
#5#1;
;
INICIO;
FINAL;
;
NULL,imprimeCR;
|FIN;

|CALCULO alba0015;|TIPO 3;
|SI #0#5 = "SI";|O #0#5 = "si";
     |HAZ CreaTempo; |NOME_DAT #5 Tempo;
     |DELINDEX #5;

     |SI #0#13 = "N";
          |IMPRE 0;
          |SI FSalida = 0;
              |INFOR informe;
              |SI FSalida = 0;
                  |BUCLE lee_lin;
                  |BUCLE HistoTras;
                  |BUCLE impresion;
                  swlin = 6;  ||Totales Cliente
                  |PRINT;
                  swlin = 0;
                  swlin = 1;  ||Totales Zona
                  |PRINT;
                  swlin = 0;
                  swlin = 4;  ||Totales Representante
                  |PRINT;
                  swlin = 0;
                  |PIEINF;
                  swlin = 10;
                  |PIEINF;
                  swlin = 0;
              |FINSI;
              |FININF;
          |FINSI;
          |FINIMP;
     |SINO;
         nSwPie = 1;
         Impresora = "CrystalReport";
         |IMPRE -1;
         |SI FSalida = 0;
             informe   = "vigzcr17";
             |INFOR informe;
             |SI FSalida = 0;
                 |BUCLE lee_lin;
                 |BUCLE HistoTras;
                 |BUCLE impresionCR;
                 |SI nSwPie = 1;
                      |PIEINF;
                 |FINSI;
             |FINSI;
             |FININF;
             |FINIMP;
         |FINSI;

     |FINSI;
     |HAZ BoraTempo; |DELINDEX #5;
|FINSI;
|FCAL;
