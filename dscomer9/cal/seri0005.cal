|FICHEROS;
     seri0005 #0;
     dsm00003 #3;
     seri0006 #6;
     agifa007 #7;
     dsz99984 #11
     agifa024 #24;
     agifa025 #25;
     agifa069 #69;
     agifa072 #72;
     agifa079 #79;
     agifa084 #84;
     agifa091 #91,MANTE;
     agifm001 #101;
     agifm002 #102;
     agifa112 #112;
     agifa133 #133;
     agifa142 #142;
     agifa177 #177;
     dsm00225 #225,MANTE;
     tmp00000 #500;      ||Tmp para formas de pago
     dscam044@;
     dscam045@;
     dscam051@;
|FIN;

|VARIABLES;
     &enVtoDir =  0;
     &Tempo = "";
     &enErrCarte = 0;
     &eaProg = "";
     &enDirEnt = 0;
     &eaNomFic = "";
     aCR = "";
     aLF = "";
     aTAB = "";
     nHandle = 0;
     aRuta = "";
     aAlfa = "";
     aDato = "";
     aCod = "";
     aReci = "";
     aDes = "";
     nFin = 0;
     nCampo = 0;
     nVenci = 0;
     nVto = 0;
     i = 0;
     nCamVenci = 0;
     aPlazo = "";
     aDias = "";
     nCamVto = 0;
     nNume = 0;
     nOk = 0;
     aCar = "";
     aCod1 = "";
     aCod2 = "";
     aTmp = "";
     nNumCar = 0;
     nCar = 0;
     nSw = 0;
     aFic = "";
     nLinea = 0;
     nXls = 0;
     nSal = 0;
     nRecibo = 0;
     aSerie = "";
     aResul = "";
     aLon = "";
     nPos = 0;
     nCamFec = 0;
     nCamImp = 0;
     nNumRecibos = 0;
     aGraFP = "";
     aGraCli = "";
     aGraPrv = "";
     aTmp500 = "";
     nVtoAnt = 0;
     nVtoAnt1 = 0;
     aEmp = "";
     aBase = "";
     nEmpresa = "";
     aTmp6 = "";
     ||---------------------variable a poner a inicializar al importar
     aTipo = "";
     aCodigo = "";
     aNomComer = "";
     aNif = "";
     aEstado = "";
     aNomFis = "";
     aDirSocial = "";
     aCp = "";
     aDesLoca = "";
     aDesPrv = "";
     aIdPais = "";
     aDesPais = "";
     aTlf1 = "";
     aTlf2 = "";
     aWeb = "";
     aFax = "";
     aMail = "";
     aObs1 = "";
     aObs2 = "";
     aCta = "";
     aDivisa = "";
     aFPago = "";
     aDtoe = "";
     aDtop = "";
     aDia1 = "";
     aDia2 = "";
     aDia3 = "";
     aMesNo = "";
     aFecAlt = "";
     aRepre = "";
     aRecargo = "";
     aEntidad = "";
     aAgencia = "";
     aDC = "";
     aCtaBan = "";
     aActivo = "";
     aIrpf = "";
{200}aValor = "";
     aCtaCon = "";
|FIN;

|PROCESO Bdscam045;
     |SI #84#48 ] #dscam045@#4; |Y #84#48 [ #dscam045@#5;
          aEmp = ("00000" + #dscam045@#6) % -105;
          aAlfa = aBase + "dscarter/fich/" + aEmp + "/";
          |PATH_DAT #dscam051@#aAlfa#;
          #dscam044@#0 = #dscam045@#0;
          |LEE 020#dscam044@.=;
          |SI FSalida = 0;
               |ABRE #dscam051@;
               |LEE 000#dscam051@.p;
               |CIERRA #dscam051@;
               aCtaCon = #dscam051@#4;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE Bdscam045;
     #dscam045@#1002;
     2;
     nEmpresa, 001, "V";
     nEmpresa, 999, "V";
     ;
     NULL, Bdscam045;
|FIN;

|PROCESO CtaCon;
     aCtaCon = "";
     |DBASS aBase;
     aAlfa = aBase + "dscarter/def/dscam045";
     |CARGA_DEF aAlfa, dscam045@;
     |SI FSalida = 0;
          aAlfa = aBase + "dscarter/def/dscam044";
          |CARGA_DEF aAlfa, dscam044@;
          |SI FSalida = 0;
               aAlfa = aBase + "dscarter/def/dscam051";
               |CARGA_DEF aAlfa, dscam051@;
               |SI FSalida = 0;
                    aAlfa = aBase + "dscarter/fich/";
                    |PATH_DAT #dscam044@#aAlfa#;
                    |PATH_DAT #dscam045@#aAlfa#;
                    |ABRE #dscam044@;
                    |BUCLE Bdscam045;
                    |CIERRA #dscam044@;
                    |DESCARGA_DEF #dscam051@;
               |FINSI;
               |DESCARGA_DEF #dscam044@;
          |FINSI;
          |DESCARGA_DEF #dscam045@;
     |FINSI;
|FPRC;

|PROCESO QuitaLetra;
     aResul = "";
     aLon = aAlfa % A0;
     |PARA i = 1; |SI i [ aLon; |HACIENDO i = i + 1;
          nPos = i * 100 + 1;
          aCar = aAlfa % nPos;
          |SI aCar ] "0"; |Y aCar [ "9";
               aResul = aResul + aCar;
          |FINSI;
     |SIGUE;
     aAlfa = aResul;
|FPRC;

|PROCESO GraFacSub;
     |HAZ GraFacCom;
|FPRC;

|PROCESO GraFacCom;
     |DDEFECTO #79;
     #79#66 = aSerie;
     #79#0 = aValor1;
     |LEE 101#79=;
     |SI FSalida = 0;
          |HAZ MiraRecCompra;
          |SI enErrCarte ! 0;
               aAlfa = "0000Fac. com.:" + #79#66 + "/" + #79#0 + ", recibo con movimientos, no actualiza...";
               |MENAV aAlfa;
               |LIBERA #79;
               |ACABA;
          |FINSI;
     |SINO;
          |GRABA 020#79b;
     |FINSI;
     #79#74 = aValor2;
     aAlfa = (aValor3 % 102) + "." + (aValor3 % 402) + "." + (aValor3 % 704);
     #79#1 = aAlfa;
     aAlfa = aValor5; |QBT aAlfa; aAlfa = ("00" + aAlfa) % -102;
     #79#11 = aAlfa;
     #79#12 = aValor6;
     #79#18 = aValor7;
     nNume = aValor8; #79#18 = #79#18 + nNume;
     nNume = aValor9; #79#18 = #79#18 + nNume;
     nNume = aValor10; #79#18 = #79#18 + nNume;
     #79#17 = aValor11;
     nNume = aValor12; #79#17 = #79#17 + nNume;
     nNume = aValor13; #79#17 = #79#17 + nNume;
     nNume = aValor14; #79#17 = #79#17 + nNume;
     nNume = aValor15; #79#17 = #79#17 + nNume;
     nNume = aValor16; #79#17 = #79#17 + nNume;
     nNume = aValor17; #79#17 = #79#17 + nNume;
     nNume = aValor18; #79#17 = #79#17 + nNume;
     #79#6 = aValor19;
     nNume = aValor20; #79#17 = #79#17 + nNume;
     nNume = aValor21; #79#17 = #79#17 + nNume;
     nNume = aValor22; #79#17 = #79#17 + nNume;
     nNume = aValor23; #79#17 = #79#17 + nNume;
     |SI aValor28 ! 0;
          #79#21 = aValor24;
     |SINO;
          #79#47 = aValor24;
     |FINSI;
     #79#24 = aValor25;
     #79#27 = aValor26;
     #79#49 = aValor27;
     #79#56 = aValor28;
     #79#58 = aValor29;
     #79#60 = aValor30;
     #79#62 = aValor31;
     #79#22 = aValor32;
     #79#29 = aValor33;
     #79#25 = aValor34; #79#79 = #79#79 + #79#25;
     #79#28 = aValor35; #79#79 = #79#79 + #79#28;
     #79#50 = aValor36; #79#79 = #79#79 + #79#50;
     #79#57 = aValor40;
     #79#59 = aValor41;
     #79#61 = aValor42;
     #79#63 = aValor43;
     #79#23 = aValor44;
     #79#30 = aValor45;
     #79#26 = aValor46; #79#30 = #79#30 + #79#26;
     #79#55 = aValor47; #79#30 = #79#30 + #79#55;
     #79#51 = aValor48; #79#30 = #79#30 + #79#51;
     #79#67 = aValor49;
     #79#31 = aValor50;
     #79#3 = aValor57;
     aAlfa = ("000000" + aValor61) % -106;
     #79#2 = aAlfa;
     #79#81 = #79#17;
     #79#82 = #79#18;
     #79#85 = #79#21;
     #79#86 = #79#22;
     #79#87 = #79#23;
     #79#88 = #79#24;
     #79#89 = #79#25;
     #79#90 = #79#26;
     #79#91 = #79#27;
     #79#92 = #79#28;
     #79#93 = #79#29;
     #79#94 = #79#30;
     #79#95 = #79#31;
     #79#96 = #79#49;
     #79#97 = #79#50;
     #79#98 = #79#51;
     #79#102 = #79#55;
     #79#103 = #79#67;
     #79#104 = #79#17;
     #79#105 = #79#18;
     #79#108 = #79#21;
     #79#109 = #79#22;
     #79#110 = #79#23;
     #79#111 = #79#24;
     #79#112 = #79#25;
     #79#113 = #79#26;
     #79#114 = #79#27;
     #79#115 = #79#28;
     #79#116 = #79#29;
     #79#117 = #79#30;
     #79#118 = #79#31;
     #79#119 = #79#49;
     #79#120 = #79#50;
     #79#121 = #79#51;
     #79#125 = #79#55;
     #79#126 = #79#67;

     #79#75 = "EUR";
     #79#76 = 1;
     #79#77 = "B";
     #79#78 = "EUR";
     #79#79 = 1;

     |HAZ BorraRecCompra;
     |HAZ VenciComp;
     #79#45 = "S";
     |SI #79#48 = "S";
          aAlfa = "0000La Fac.Com. [" + #79#66 + "/" + (("000000"+#79#0)%-106) + "] esta contabilizada...";
          |MENAV aAlfa;
          #79#48 = "N";
     |FINSI;
     |GRABA 020#79a;
     |LIBERA #79;

     |ABRE #91;
     #91#0 = #79#11;
     |LEE 000#91=;
     |SI FSalida ! 0; |DDEFECTO #91; |FINSI;
     |CIERRA #91;

     |DDEFECTO #11;
     #11#0 = #79#0;
     #11#17 = #79#66;
     |PARA i = 1;|SI i [ 12; |HACIENDO i = i + 1;
          nCamImp = i + 32;
          |SI #79nCamImp ! 0; nNumRecibos = i; |FINSI;
     |SIGUE;
     |SI #79#146 ! 0; nNumRecibos = nNumRecibos + 1; |FINSI;

     |HAZ AbreRecCompra;
     |PARA i = 1;|SI i [ 12; |HACIENDO i = i + 1;
          nCamImp = i + 32;
          |SI #79nCamImp = 0; |O i > 12; |SAL; |FINSI;
          |SI i [ 6;
               nCamFec = i + 67;
          |SINO;
               nCamFec = i + 122;
          |FINSI;
          #11#7 = #79#1;
          #11#8 = #79nCamFec;
          #11#9 = #79nCamImp;
          #11#1 = i;
          #11#2 = #79#2;
          #11#3 = #79#3;
          #11#4 = #79#9;
          #11#12 = #79#12;
          #11#18 = #91#69;      ||Tipo de Recibo
          #11#21 = #91#69;
          #11#23 = nNumRecibos;
          #11#24 = #91#0;
          #11#25 = #91#1;

          |ABRE #177;
          #177#0 = #11#18;
          |LEE 000#177=;
          |CIERRA #177;

          #11#15 = #177#3;      ||Cuenta
          |HAZ RecCompra;
     |SIGUE;
     |SI #79#146 ! 0;
          #11#7 = #79#1;
          #11#8 = #79#147;
          #11#9 = #79#146;
          #11#1 = i;
          #11#2 = #79#2;
          #11#3 = #79#3;
          #11#4 = #79#9;
          #11#12 = #79#12;
          #11#18 = #91#73;      ||Tipo de Recibo
          #11#21 = #91#73;
          #11#23 = nNumRecibos;
          #11#24 = #91#0;
          #11#25 = #91#1;

          |ABRE #177;
          #177#0 = #11#18;
          |LEE 000#177=;
          |CIERRA #177;

          #11#15 = #177#3;      ||Cuenta

          |HAZ RecCompra;
     |FINSI;
     |HAZ CierraRecCompra;
|FPRC;

|PROCESO GraFacVta;
     |DDEFECTO #84;
     #84#0 = aValor3;
     aAlfa = aValor55; |HAZ QuitaLetra;
     #84#48 = aAlfa;
     |LEE 101#84=;
     |SI FSalida = 0;
          eaProg = "agifa084";
          |HAZ MiraRecVenta;
          |SI enErrCarte ! 0;
               aAlfa = "0000Fac. vta.:" + #84#48 + "/" + #84#0 + ", recibo con movimientos, no actualiza...";
               |MENAV aAlfa;
               |LIBERA #84;
               |ACABA;
          |FINSI;
     |SINO;
          |GRABA 020#84b;
     |FINSI;
     aAlfa = (aValor4 % 102) + "." + (aValor4 % 402) + "." + (aValor4 % 704);
     #84#1 = aAlfa;
     #84#40 = aValor5;
     #84#15 = aValor6;
     nNume = aValor7; #84#15 = #84#15 + nNume;
     nNume = aValor8; #84#15 = #84#15 + nNume;
     nNume = aValor9; #84#15 = #84#15 + nNume;
     #84#5 = aValor19;
     #84#7 = aValor20;
     |SI aValor27 ! 0;
          #84#16 = aValor23;
     |SINO;
          #84#28 = aValor23;
     |FINSI;
     #84#19 = aValor24;
     #84#22 = aValor25;
     #84#42 = aValor26;
     #84#50 = aValor27;
     #84#52 = aValor28;
     #84#54 = aValor29;
     #84#55 = aValor30;
     #84#17 = aValor31;
     #84#20 = aValor32;
     #84#23 = aValor33;
     #84#43 = aValor34;
     #84#51 = aValor39;
     #84#53 = aValor40;
     #84#55 = aValor41;
     #84#57 = aValor42;
     #84#18 = aValor43;
     #84#21 = aValor44;
     #84#49 = aValor45;
     #84#44 = aValor46;
     #84#41 = aValor49;
     aAlfa = aValor54; |QBT aAlfa; aAlfa = ("00" + aAlfa) % -102;
     #84#8 = aAlfa;
     #84#25 = aValor59;
     #84#24 = aValor60;
     #84#63 = aValor63;
     #84#4 = aValor65;
     #84#60 = aValor71;
     aAlfa = aValor73; |QBT aAlfa; aAlfa = ("000000" + aAlfa) % -106;
     #84#3 = aAlfa;

     |DDEFECTO #24;
     #24#0 = #84#3;
     |LEE 000#24=;

     #84#29 = #24#1;
     #84#30 = #24#5;
     #84#31 = #24#6;
     #84#33 = #24#7;
     #84#64 = #24#180;
     #84#70 = #84#15;
     #84#71 = #84#41;
     #84#72 = #84#15;
     #84#73 = #84#41;
     #84#74 = #84#15;
     #84#75 = #84#41;
     #84#88 = #24#22;
     #84#89 = #24#23;
     #84#90 = #24#24;
     #84#91 = 1;

     #84#10 = "S";
     #84#65 = "EUR";
     #84#66 = 1;
     #84#67 = "B";
     #84#68 = "EUR";
     #84#69 = 1;
     |SI #84#39 = "S";
          aAlfa = "0000La Fac.Vta. [" + #84#48 + "/" + (("000000"+#84#0)%-106) + "] esta contabilizada...";
          |MENAV aAlfa;
          #84#39 = "N";
     |FINSI;
     |GRABA 020#84a;
     |LIBERA #84;

     |DDEFECTO #69;
     #69#20 = #84#48;
     #69#0 = #84#0;
     #69#1 = 1;
     |LEE 1010#69=;
     |SI FSalida ! 0; |GRABA 020#69b; |FINSI;
     #69#2 = "EXP";
     #69#3 = 1;
     #69#4 = "Factura importada";
     #69#5 = 1;
     #69#6 = #84#15;
     #69#7 = #84#15;
     #69#9 = #84#15;
     #69#11 = 2;
     #69#15 = #84#3;
     #69#26 = #84#15;
     #69#27 = #84#15;
     #69#28 = #84#15;
     #69#29 = #84#15;
     |GRABA 020#69a;
     |LIBERA #69;

     eaProg = "agifa084"; |HAZ BorraRecVenta;
     |HAZ BorraVenciDir;

     enVtoDir =  0;
     |SI aValor63 ! 0;   || Tiene Importe Cobrado
          |ABRE #133;
          #133#0 = #84#0;
          #133#4 = #84#48;
          #133#1 = 1;
          #133#2 = #84#63;
          #133#3 = #84#1;
          |GRABA 020#133n;
          enVtoDir =  1;
     |FINSI;

     nNume = (#84#41 - #84#63) ! 2;
     |SI nNume > 0;
          |HAZ VenciDir;
     |FINSI;

     |ABRE #133;
     nVto = 0;
     #133#0 = #84#0;
     #133#4 = #84#48;
     #133#1 = 0;
     |LEE 000#133];
     |PARA ; |SI FSalida = 0; |Y #133#0 = #84#0;|Y #133#4 = #84#48; |HACIENDO;
          nVto = nVto + 1;
          |LEE 001#133s;
     |SIGUE;

     |HAZ AbreRecVenta;
     |ABRE #177;
     nRecibo = 0;
     #133#0 = #84#0;
     #133#4 = #84#48;
     #133#1 = 0;
     |LEE 000#133];
     |PARA ; |SI FSalida = 0; |Y #133#0 = #84#0;|Y #133#4 = #84#48; |HACIENDO;
          |DDEFECTO #11;
          #11#17 = #84#48;
          #11#0  = #84#0;
          #11#1  = #133#1;           || Linea;
          #11#2  = #84#3;            || cliente
          #11#3  = #84#4;            || nombre del cliente
          #11#4  = #24#29;           || Banco
          #11#5  = "S";             || domiciliado
          #11#6  = "N";             || aceptado
          #11#7  = #84#1;            || fecha de emision
          #11#8  = #133#3;           || Fecha de vencimiento
          #11#9  = #133#2;           || Importe
          #11#10 = "N";            || Impreso
          #11#11 = "N";            || Contabilizado
          #11#12 = #84#40;

          |ABRE #91;
          |DDEFECTO #91;
          #91#0 = #84#8;
          |LEE 000#91=;
          |CIERRA #91;
          |SI #142#63 = "S";
               #177#0 = #91#69;
               |LEE 000#177=;
               |SI FSalida = 0;
                    #11#12 = #177#3;     || NUMERO CTA.CONTABLE.
               |SINO;
                    #11#12 = #84#40;     || NUMERO CTA.CONTABLE.
               |FINSI;
          |SINO;
               #11#12 = #84#40;          || NUMERO CTA.CONTABLE.
          |FINSI;
          #11#13 = "N";            || Cobrado
          #11#14 = "N";            || Impagado
          #11#15 = #24#161;         || A aceptar
          #11#16 = "01.01.0000";   || fecha de cobro
          #11#18 = #84#40;          || Cta
          #11#21 = #91#69;          || Tipo de Recibo (forma de pago)
          nRecibo = nRecibo + 1;
          |SI nRecibo = nVto; |Y #91#70 ! 0;
               #11#21 = #91#73;     || Tipo de Recibo (Fianza retenida)
          |FINSI;
          #11#22 = "Pdte. Cobro";
          #11#23 = nVto;
          #11#24 = #91#0;
          #11#25 = #91#1;

          #11#26 = "";
          #11#27 = "";
          #11#29 = "";
          #11#28 = "";

          #84#63 = 0;    || Para que cree correcto los recibos en cartera
          eaProg = "agifa084";
          |HAZ RecVenta;
          |LEE 000#133s;
     |SIGUE;
     |CIERRA #177;
     |CIERRA #133;
     enDirEnt = #agifa084#91; |HAZ CierraRecVenta;

||realiza el cobro y lo contabiliza
     |SI aValor63 ! 0;
          |DFICE aAlfa; aAlfa = aAlfa % -205; nEmpresa = aAlfa;
          |HAZ CtaCon;
          aAlfa = ":dscarter/dscaz001.tab;" + #84#48 + ":" + #84#0 + ":" + 1;
          ||                    Fecha Fac    Importe         F.Cobro       CtaConta
          aAlfa = aAlfa + ":" + #84#1 + ":" + aValor63 + ":" + #84#1 + ":" + aCtaCon + ":" + nEmpresa;

          ||SUB_EJECUTA aAlfa; se despirula la lectura del txt
          || lo grabo en un temporal y despues realizo el cobro

          #6#0 = #84#48;
          #6#1 = #84#0;
          #6#2 = #84#1;
          #6#3 = aValor63;
          #6#4 = aCtaCon;
          #6#5 = nEmpresa;
          |GRABA 020#6n;
     |FINSI;
|FPRC;

|PROCESO ImportaXls;
     |QBF aFic;
     |SI aFic = ""; |ACABA; |FINSI;

     |SI nSw = 3; |PINTA 1602, "Facturas ventas                "; |FINSI;
     |SI nSw = 4; |PINTA 1602, "Facturas compras               "; |FINSI;
     |SI nSw = 5; |PINTA 1602, "Facturas subcontratacion       "; |FINSI;

     |XABRE "CE", aFic, 0;
     |SI FSalida < 0
          |MENAV "0000No puedo abrir el fichero a importar";
     |SINO;
          eaNomFic = aFic;
          |HAZ Xls2Txt;
          aFic = eaNomFic;
          |HAZ ImportaFic;
          |FBORRA aFic;
     |FINSI;
|FPRC;

|PROCESO GraPrv;
     aGraPrv = "N";
     |SI aActivo ! 0; |ACABA; |FINSI;

     |DDEFECTO #112;
     |QBT aCodigo;
     aCodigo = ("000000" + aCodigo) % -106;
     #112#0 = aCodigo;
     |LEE 101#112=;
     |SI FSalida ! 0; |GRABA 020#112b; |FINSI;
     #112#1 = aNomFis;
     #112#2 = aNomComer;
     #112#3 = aDirSocial;
     #112#4 = aDesLoca;
     #112#5 = aDesPrv;
     #112#6 = aTlf1;
     #112#7 = aFax;
     #112#9 = aNif;
     #112#10 = aCta;
     |QBT aFPago; aFPago = ("00" + aFPago) % -102;
     #112#17 = aFPago;
     #112#18 = aMesNo;
     #112#19 = aDia1;
     #112#20 = aDia2;
     #112#21 = aDia3;
     #112#24 = aDtoe;
     #112#25 = aDtop;
     #112#26 = aObs1;
     #112#81 = aDivisa;
     |QBF aDesPais;
     |SI aDesPais ! "ESPA¥A";
          #112#108 = aCp;
          aCp = "00000";
     |FINSI;
     aCod1 = aCp % 102;
     aCod2 = aCp % 303;
     #112#74 = aCod1;
     #112#75 = aCod2;
     #112#76 = aCp;
     #112#78 = aIrpf;
     #112#83 = aTlf2;
     #112#84 = aMail;
     |HAZ BuscaPais; #112#89 = #225#0;
     #112#101 = aDirSocial;
     #112#102 = aCod1;
     #112#103 = aCod2;
     #112#105 = aDesLoca;
     #112#104 = aDesPrv;
     #112#107 = aCp;
     #112#109 = aWeb;
     |GRABA 020#112a;
     |LIBERA #112;
     aGraPrv = "S";
|FPRC;

|PROCESO ActPrv;
     |SI aGraPrv = "N"; |ACABA; |FINSI;

     |LEE 121#112=;
     |SI FSalida = 0;
          #112#14 = aEntidad;
          #112#15 = aAgencia;
          #112#13 = aDC;
          #112#12 = aCtaBan;
          |GRABA 020#112a;
          |LIBERA #112;
     |FINSI;
|FPRC;

|PROCESO CarPrv;
     |SI nNumCar ] 1; |Y nNumCar < 3; aTipo = aTipo + aCar; |FINSI;
     |SI aTipo = 40;
          |SI nNumCar ] 9; |Y nNumCar < 209; aNomComer = aNomComer + aCar; |FINSI;
          |SI nNumCar ] 209; |Y nNumCar < 230; aCodigo = aCodigo + aCar; |FINSI;
          |SI nNumCar ] 233; |Y nNumCar < 248; aNif = aNif + aCar; |FINSI;
          |SI nNumCar ] 258; |Y nNumCar < 259; aActivo = aActivo + aCar; |FINSI;
          |SI nNumCar ] 269; |Y nNumCar < 369; aNomFis = aNomFis + aCar; |FINSI;
          |SI nNumCar ] 369; |Y nNumCar < 569; aDirSocial = aDirSocial + aCar; |FINSI;
          |SI nNumCar ] 769; |Y nNumCar < 784; aCp = aCp + aCar; |FINSI;
          |SI nNumCar ] 784; |Y nNumCar < 834; aDesLoca = aDesLoca + aCar; |FINSI;
          |SI nNumCar ] 839; |Y nNumCar < 889; aDesPrv = aDesPrv + aCar; |FINSI;
          |SI nNumCar ] 889; |Y nNumCar < 892; aIdPais = aIdPais + aCar; |FINSI;
          |SI nNumCar ] 892; |Y nNumCar < 942; aDesPais = aDesPais + aCar; |FINSI;
          |SI nNumCar ] 942; |Y nNumCar < 962; aTlf1 = aTlf1 + aCar; |FINSI;
          |SI nNumCar ] 962; |Y nNumCar < 982; aTlf2 = aTlf2 + aCar; |FINSI;
          |SI nNumCar ] 982; |Y nNumCar < 1002; aFax = aFax + aCar; |FINSI;
          |SI nNumCar ] 1002; |Y nNumCar < 1202; aWeb = aWeb + aCar; |FINSI;
          |SI nNumCar ] 1202; |Y nNumCar < 1302; aMail = aMail + aCar; |FINSI;
          |SI nNumCar ] 1312; |Y nNumCar < 1512; aObs1 = aObs1 + aCar; |FINSI;
          |SI nNumCar ] 1512; |Y nNumCar < 1524; aCta = aCta + aCar; |FINSI;
          |SI nNumCar ] 1524; |Y nNumCar < 1530; aDivisa = aDivisa + aCar; |FINSI;
          |SI nNumCar ] 1595; |Y nNumCar < 1600; aFPago = aFPago + aCar; |FINSI;
          |SI nNumCar ] 1710; |Y nNumCar < 1716; aDtoe = aDtoe + aCar; |FINSI;
          |SI nNumCar ] 1716; |Y nNumCar < 1722; aDtop = aDtop + aCar; |FINSI;
          |SI nNumCar ] 1724; |Y nNumCar < 1730; aIrpf = aIrpf + aCar; |FINSI;
          |SI nNumCar ] 1730; |Y nNumCar < 1733; aDia1 = aDia1 + aCar; |FINSI;
          |SI nNumCar ] 1733; |Y nNumCar < 1736; aDia2 = aDia2 + aCar; |FINSI;
          |SI nNumCar ] 1736; |Y nNumCar < 1739; aDia3 = aDia3 + aCar; |FINSI;
          |SI nNumCar ] 1739; |Y nNumCar < 1742; aMesNo = aMesNo + aCar; |FINSI;
     |FINSI;
     |SI aTipo = 51;
          |SI nNumCar ] 9; |Y nNumCar < 13; aEntidad = aEntidad + aCar; |FINSI;
          |SI nNumCar ] 13; |Y nNumCar < 17; aAgencia = aAgencia + aCar; |FINSI;
          |SI nNumCar ] 17; |Y nNumCar < 19; aDC = aDC + aCar; |FINSI;
          |SI nNumCar ] 19; |Y nNumCar < 29; aCtaBan = aCtaBan + aCar; |FINSI;
     |FINSI;
|FPRC;

|PROCESO GraCli;
     aGraCli = "N";
     |SI aEstado ! 3; |ACABA; |FINSI;

     |DDEFECTO #24;
     |QBT aCodigo;
     aCodigo = ("000000" + aCodigo) % -106;
     #24#0 = aCodigo;
     |LEE 101#24=;
     |SI FSalida ! 0; |GRABA 020#24b; |FINSI;
     #24#1 = aNomFis;
     #24#2 = aNomComer;
     #24#5 = aDirSocial; #24#8 = aDirSocial; #24#11 = aDirSocial;
     #24#6 = aDesLoca;
     #24#7 = aDesPrv;
     #24#9 = aDesLoca;
     #24#10 = aDesPrv;
     #24#12 = aDesLoca;
     #24#13 = aDesPrv;
     #24#14 = aDesPais;
     #24#15 = aNif;
     #24#16 = aCta;
     #24#17 = aTlf1;
     #24#18 = aFax;
     |QBT aFPago; aFPago = ("00" + aFPago) % -102;
     #24#20 = aFPago;
     #24#21 = aMesNo;
     #24#22 = aDia1;
     #24#23 = aDia2;
     #24#24 = aDia3;
     |QBT aRepre; aRepre = ("00" + aRepre) % -102;
     #24#25 = aRepre;
     #24#37 = aDtoe;
     #24#47 = aRecargo;
     #24#38 = aDtop;
     #24#53 = aObs1;
     aFecAlt = (aFecAlt % 102) + "." + (aFecAlt % 402) + "." + (aFecAlt % 704);
     #24#159 = aFecAlt;
     #24#160 = aObs2;
     |QBF aDesPais;
     |SI aDesPais ! "ESPA¥A";
          #24#211 = aCp;
          aCp = "00000";
     |FINSI;
     aCod1 = aCp % 102;
     aCod2 = aCp % 303;
     #24#178 = aCod1;
     #24#179 = aCod2;
     #24#180 = aCp;
     #24#181 = aCod1;
     #24#182 = aCod2;
     #24#183 = aCp;
     #24#184 = aCod1;
     #24#185 = aCod2;
     #24#186 = aCp;
     #24#192 = aDivisa;
     #24#196 = aTlf2;
     #24#197 = aMail;
     #24#214 = aWeb;
     |HAZ BuscaPais; #24#205 = #225#0;
     |GRABA 020#24a;
     |LIBERA #24;
     aGraCli = "S";

     #101#0 = #24#3;
     |LEE 000#101=; || Zona
     |SI FSalida ! 0; |DDEFECTO #101; |FINSI;

     #102#0 = #24#189;
     |LEE 000#102=; ||Ruta
     |SI FSalida ! 0; |DDEFECTO #102; |FINSI;

     #25#0 = #24#25;
     |LEE 000#25=;
     |SI FSalida ! 0; |DDEFECTO #25; |FINSI;

     |DDEFECTO #3;
     #3#0 = #24#0;
     #3#1 = 1;
     |LEE 101#3=;
     |SI FSalida ! 0; |GRABA 021#3b; |FINSI;
     #3#2 = #24#5;
     #3#3 = #24#6;
     #3#4 = #24#178;
     #3#5 = #24#179;
     #3#6 = #24#180;
     #3#7 = #24#7;
     #3#8 = #24#14;
     #3#10 = #24#2;
     #3#11 = #24#3;
     #3#12 = #101#1;
     #3#13 = #24#17;
     #3#14 = #24#25;
     #3#15 = #25#1;
     #3#16 = #24#189;
     #3#17 = #102#1;
     #3#19 = #24#205;
     #3#20 = #24#196;
     #3#21 = #24#18;
     #3#22 = #24#36;
     #3#23 = #24#211;
     #3#24 = #24#197;
     |GRABA 021#3a;
     |LIBERA #3;
|FPRC;

|PROCESO ActCli;
     |SI aGraCli = "N"; |ACABA; |FINSI;

     |LEE 121#24=;
     |SI FSalida = 0;
          #24#32 = aEntidad;
          #24#33 = aAgencia;
          #24#31 = aDC;
          #24#30 = aCtaBan;
          |GRABA 020#24a;
          |LIBERA #24;
     |FINSI;
|FPRC;

|PROCESO CarCli;
     |SI nNumCar ] 1; |Y nNumCar < 3; aTipo = aTipo + aCar; |FINSI;
     |SI aTipo = 30;
          |SI nNumCar ] 14; |Y nNumCar < 64; aNomComer = aNomComer + aCar; |FINSI;
          |SI nNumCar ] 64; |Y nNumCar < 85; aCodigo = aCodigo + aCar; |FINSI;
          |SI nNumCar ] 88; |Y nNumCar < 103; aNif = aNif + aCar; |FINSI;
          |SI nNumCar ] 103; |Y nNumCar < 106; aEstado = aEstado + aCar; |FINSI;
          |SI nNumCar ] 117; |Y nNumCar < 317; aNomFis = aNomFis + aCar; |FINSI;
          |SI nNumCar ] 317; |Y nNumCar < 517; aDirSocial = aDirSocial + aCar; |FINSI;
          |SI nNumCar ] 717; |Y nNumCar < 732; aCp = aCp + aCar; |FINSI;
          |SI nNumCar ] 732; |Y nNumCar < 782; aDesLoca = aDesLoca + aCar; |FINSI;
          |SI nNumCar ] 787; |Y nNumCar < 837; aDesPrv = aDesPrv + aCar; |FINSI;
          |SI nNumCar ] 837; |Y nNumCar < 840; aIdPais = aIdPais + aCar; |FINSI;
          |SI nNumCar ] 840; |Y nNumCar < 890; aDesPais = aDesPais + aCar; |FINSI;
          |SI nNumCar ] 890; |Y nNumCar < 910; aTlf1 = aTlf1 + aCar; |FINSI;
          |SI nNumCar ] 910; |Y nNumCar < 930; aTlf2 = aTlf2 + aCar; |FINSI;
          |SI nNumCar ] 930; |Y nNumCar < 1130; aWeb = aWeb + aCar; |FINSI;
          |SI nNumCar ] 1140; |Y nNumCar < 1160; aFax = aFax + aCar; |FINSI;
          |SI nNumCar ] 1160; |Y nNumCar < 1260; aMail = aMail + aCar; |FINSI;
          |SI nNumCar ] 1260; |Y nNumCar < 1320; aObs1 = aObs1 + aCar; |FINSI;
          |SI nNumCar ] 1320; |Y nNumCar < 1380; aObs2 = aObs2 + aCar; |FINSI;
          |SI nNumCar ] 1510; |Y nNumCar < 1522; aCta = aCta + aCar; |FINSI;
          |SI nNumCar ] 1522; |Y nNumCar < 1528; aDivisa = aDivisa + aCar; |FINSI;
          |SI nNumCar ] 1593; |Y nNumCar < 1598; aFPago = aFPago + aCar; |FINSI;
          |SI nNumCar ] 1708; |Y nNumCar < 1714; aDtoe = aDtoe + aCar; |FINSI;
          |SI nNumCar ] 1714; |Y nNumCar < 1720; aDtop = aDtop + aCar; |FINSI;
          |SI nNumCar ] 1722; |Y nNumCar < 1725; aDia1 = aDia1 + aCar; |FINSI;
          |SI nNumCar ] 1725; |Y nNumCar < 1728; aDia2 = aDia2 + aCar; |FINSI;
          |SI nNumCar ] 1728; |Y nNumCar < 1731; aDia3 = aDia3 + aCar; |FINSI;
          |SI nNumCar ] 1731; |Y nNumCar < 1734; aMesNo = aMesNo + aCar; |FINSI;
          |SI nNumCar ] 1734; |Y nNumCar < 1744; aFecAlt = aFecAlt + aCar; |FINSI;
          |SI nNumCar ] 1770; |Y nNumCar < 1775; aRepre = aRepre + aCar; |FINSI;
          |SI nNumCar ] 1832; |Y nNumCar < 1833; aRecargo = aRecargo + aCar; |FINSI;
     |FINSI;
     |SI aTipo = 51;
          |SI nNumCar ] 9; |Y nNumCar < 13; aEntidad = aEntidad + aCar; |FINSI;
          |SI nNumCar ] 13; |Y nNumCar < 17; aAgencia = aAgencia + aCar; |FINSI;
          |SI nNumCar ] 17; |Y nNumCar < 19; aDC = aDC + aCar; |FINSI;
          |SI nNumCar ] 19; |Y nNumCar < 29; aCtaBan = aCtaBan + aCar; |FINSI;
     |FINSI;
|FPRC;

|PROCESO BuscaPais;
     nOk = -1;
     |QBT aIdPais;

     |ABRE #225;
     |LEE 000#225p;
     |PARA; |SI FSalida = 0; |HACIENDO;
          aAlfa = #225#5; |QBT aAlfa;
          |SI aAlfa = aIdPais;
               nOk = 0; |SAL;
          |FINSI;
          |LEE 000#225s;
     |SIGUE;

     |SI nOk ! 0;
          |MENAV "0000No se encuentra idioma en fichero de paises...";
          |PUSHV 0501 2380;
          |DDEFECTO #225;
          |C_M #225#5, 1, "N";
          #225#5 = aIdPais;
          #225#1 = aDesPais;
          |PINPA #0#225;
          |PINDA #0#225;
      |ET OtroPais;
          |ENCAMPO #0#225;
          |SI FSalida = 0; |O FSalida = 6; || 6= cuando consulta F11
               |GRABA 000#225b;
               |SI FSalida = 100;
                    |LEE 121#225=;
                    #225#5 = aIdPais;
                    |PINDA #0#225;
               |FINSI;
               |SI FSalida ! 0; |VETE OtroPais; |FINSI;
               |ENDATOS #1#225;
               |SI FSalida = 0;
                    |GRABA 020#225a;
               |SINO;
                    |BORRA 020#225c;
                    |MENAV "0000Debe de indicar el pais...";
                    |VETE OtroPais;
               |FINSI;
               |LIBERA #225;
          |SINO;
              |MENAV "0000Debe de indicar el pais...";
              |VETE OtroPais;
          |FINSI;
          |POPV;
     |FINSI;
     |CIERRA #225;
|FPRC;

|PROCESO QuitaRarosImp;
     nCar = &aCar;
     |SI nCar = 241; aCar = "¤"; |FINSI;
     |SI nCar = 209; aCar = "¥"; |FINSI;
     |SI nCar = 208; aCar = "¥"; |FINSI; ||no se porque
     |SI nCar = 225; aCar = " "; |FINSI;
     |SI nCar = 233; aCar = "‚"; |FINSI;
     |SI nCar = 237; aCar = "¡"; |FINSI;
     |SI nCar = 243; aCar = "¢"; |FINSI;
     |SI nCar = 250; aCar = "£"; |FINSI;
     |SI nCar = 193; aCar = "A"; |FINSI;
     |SI nCar = 201; aCar = "E"; |FINSI;
     |SI nCar = 205; aCar = "I"; |FINSI;
     |SI nCar = 211; aCar = "O"; |FINSI;
     |SI nCar = 218; aCar = "U"; |FINSI;
     |SI nCar = 186; aCar = "§"; |FINSI;
     |SI nCar = 170; aCar = "¦"; |FINSI;
     |SI nCar = 176; aCar = "°"; |FINSI;     ||Euro
|FPRC;

|PROCESO Dato;
     |SI aCar = aTAB;
          IaValor = IaValor + 1;
     |SINO;
          aValor = aValor + aCar;
     |FINSI;
|FPRC;

|PROCESO IniVar;
     IaValor = aValor1<-;
     |PARA i = 1; |SI i [ 200; |HACIENDO i = i + 1;
          aValor = "";
          IaValor = IaValor + 1;
     |SIGUE;
     IaValor = aValor1<-;

     nNumCar = 0;
     aTipo = "";
     aCodigo = "";
     aNomComer = "";
     aNif = "";
     aEstado = "";
     aNomFis = "";
     aDirSocial = "";
     aCp = "";
     aDesLoca = "";
     aDesPrv = "";
     aIdPais = "";
     aDesPais = "";
     aTlf1 = "";
     aTlf2 = "";
     aWeb = "";
     aFax = "";
     aMail = "";
     aObs1 = "";
     aObs2 = "";
     aCta = "";
     aDivisa = "";
     aFPago = "";
     aDtoe = "";
     aDtop = "";
     aDia1 = "";
     aDia2 = "";
     aDia3 = "";
     aMesNo = "";
     aFecAlt = "";
     aRepre = "";
     aRecargo = "";
     aEntidad = "";
     aAgencia = "";
     aDC = "";
     aCtaBan = "";
     aActivo = "";
     aIrpf = "";
|FPRC;

|PROCESO FinTxt;
     |SI nSw = 1;
          |SI aTipo = 30; |HAZ GraCli; |FINSI;
          |SI aTipo = 51; |HAZ ActCli; |FINSI;
     |FINSI;
     |SI nSw = 2;
          |SI aTipo = 40; |HAZ GraPrv; |FINSI;
          |SI aTipo = 51; |HAZ ActPrv; |FINSI;
     |FINSI;
     |SI nLinea > 1; |Y aValor1 ! "";
          |SI nSw = 3; |HAZ GraFacVta; |FINSI;
          |SI nSw = 4; |HAZ GraFacCom; |FINSI;
          |SI nSw = 5; |HAZ GraFacSub; |FINSI;
     |FINSI;
     |HAZ IniVar;
|FPRC;

|PROCESO Caracter;
     |SI aCar = aCR; |ACABA; |FINSI;

     |SI aCar = aLF;
          nLinea = nLinea + 1; |PINTA 2615, nLinea;
          |HAZ FinTxt;
     |SINO;
          |HAZ QuitaRarosImp;
          nNumCar = nNumCar + 1;
          |SI nSw = 1; |HAZ CarCli; |FINSI;
          |SI nSw = 2; |HAZ CarPrv; |FINSI;
          |SI nSw = 3; |HAZ Dato; |FINSI;
          |SI nSw = 4; |HAZ Dato; |FINSI;
          |SI nSw = 5; |HAZ Dato; |FINSI;
     |FINSI;
|FPRC;

|PROCESO ImportaFic;
     |QBF aFic;
     |SI aFic = ""; |ACABA; |FINSI;

     |HAZ IniVar;
     nLinea = 0;
     |SI nSw = 1; |PINTA 1602, "Clientes                       "; |FINSI;
     |SI nSw = 2; |PINTA 1602, "Proveedores                    "; |FINSI;

     |XABRE "B", aFic, nHandle;
     |SI FSalida ] 0;
          |XLEE nHandle, 250, aTmp;
          |PARA; |SI FSalida > 0; |HACIENDO;
               |PARA; |SI aTmp ! ""; |HACIENDO;
                    aCar = aTmp % 101;
                    |SI aTmp = aCar;
                         aTmp = ""; ||con un caracter falla: "aTmp = aTmp % 2"
                    |SINO;
                         aTmp = aTmp % 2;
                    |FINSI;
                    |HAZ Caracter;
               |SIGUE;
               |XLEE nHandle, 250, aTmp;
          |SIGUE;
          |XCIERRA nHandle;
          |HAZ FinTxt;
     |SINO;
          |SI nSw = 1; |MENAV "0000No existe fichero cliente..."; |FINSI;
          |SI nSw = 2; |MENAV "0000No existe fichero proveedores..."; |FINSI;
     |FINSI;
|FPRC;

|PROCESO VtoAuto;
     nFin = #91#3 + 1;
     |PARA i = 1;|SI i < nFin;|HACIENDO i = i + 1;
          nCampo = i + 5;
          nVenci = i * #91#4;
          #91nCampo = nVenci + #91#2;
     |SIGUE;
     |PARA nFin = nFin + 5;|SI nFin < 59;|HACIENDO nFin = nFin + 1;
          #91nFin = 0;
     |SIGUE;
|FPRC;

|PROCESO FPago;
     aTipo = aDato % 102;
     |SI aTipo = "20";
          nCamVenci = 6;
          aCod = aDato %  405; |QBT aCod; aCod = ("00" + aCod) % -102;
          aReci = aDato % 910;
          aDes = aDato % 1999;
          |DDEFECTO #91;
          #91#0 = aCod;
          |LEE 101#91=;
          |SI FSalida ! 0;
               |GRABA 020#91b;
               #91#1 = aDes;
               #91#2 = 0;
               #91#3 = 0;
               #91#4 = 0;
               #91#69 = aReci;
               |GRABA 020#91a;
               |LIBERA #91;
               #500#0 = #91#0;
               |GRABA 020#500n;
               nVtoAnt = 0;
               aGraFP = "S";
          |SINO;
               aGraFP = "N";
          |FINSI;
     |FINSI;
     |SI aTipo = "21"; |Y aGraFP = "S";
          aCod = aDato %  405; |QBT aCod; aCod = ("00" + aCod) % -102;
          aPlazo = aDato % 905;
          aDias = aDato % 1404; nVto = aDias;

          |DDEFECTO #91;
          #91#0 = aCod;
          |LEE 101#91=;
          |SI FSalida ! 0; |GRABA 020#91a; |FINSI;
          #91#3 = #91#3 + 1;
          |SI #91#3 = 1;
               #91#2 = 0;     ||Salto Inicial
               #91#4 = 0;     ||Intervalo
               |SI aDias ! 1;
                    #91#4 = aDias;
               |FINSI;
               |HAZ VtoAuto;
               nVtoAnt1 = aDias;
          |FINSI;
          |SI #91#3 = 2;
               nNume = nVto - nVtoAnt;
               #91#4 = nNume;
               #91#2 = nVtoAnt - #91#4;
               |HAZ VtoAuto;
          |FINSI;
          |SI #91#3 > 2;
               nNume = nVto - nVtoAnt;
               #91#4 = nNume;
               #91#2 = nVtoAnt1 - #91#4;
               |HAZ VtoAuto;
          |FINSI;

          nVtoAnt = nVto;
          |GRABA 020#91a;
          |LIBERA #91;
     |FINSI;
|FPRC;

|PROCESO PideTipoRecibo;
     #91#0 = #500#0;
     |LEE 121#91=;
     |SI FSalida = 0;
          |PUSHV 0501 2380;
          |PINPA #0#91;
          |PINDA #0#91;
          |SI #91#69 = 0; #91#69 = 1; |FINSI;
          |PARA; |SI; |HACIENDO;
               |ENCAMPO #69#91;
               |SI FSalida = 0;
                    #177#0 = #91#69;
                    |LEE 000#177=;
                    |SI FSalida = 0;
                         |CONFI "0000SConfirma la modificacion S/N.:";
                         |SI FSalida = 0;
                              |GRABA 020#91a;
                              |LIBERA #91;
                              |SAL;
                         |FINSI;
                    |SINO;
                         |MENAV "0000No existe tipo recibo...";
                    |FINSI;
               |SINO;
                    |MENAV "0000Debe confirmar el tipo de recibo...";
               |FINSI;
          |SIGUE;
          |POPV;
     |FINSI;
|FPRC;

|DEFBUCLE PideTipoRecibo;
     #500#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, PideTipoRecibo;
|FIN;

|PROCESO CobrayConta;
     aAlfa = ":dscarter/dscaz001.tab;" + #6#0 + ":" + #6#1 + ":" + 1;
     ||                    Fecha Fac    Importe       F.Cobro     CtaConta
     aAlfa = aAlfa + ":" + #6#2 + ":" + #6#3 + ":" + #6#2 + ":" + #6#4 + ":" + #6#5;

     |SUB_EJECUTA aAlfa;
|FPRC;

|DEFBUCLE CobrayConta;
     #6#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, CobrayConta;
|FIN;

|PROCESO Tipo3; |TIPO 3;
     |ABRE #142; |LEE 000#142p; |CIERRA #142;

     |HAZ CreaTempo; |NOME_DAT #6 Tempo; |DELINDEX #6; aTmp6 = Tempo;

     |DBASS aFic; aFic = aFic + Usuario + ".txt";

     aAlfa = #0#1; |QBF aAlfa;
     |SI aAlfa ! "";
          |PINTA 1602, "Forma pago                     ";
          |RECIBE_FICHERO aAlfa, aFic;
          |XABRE "", aFic, nHandle;
          |SI FSalida ] 0;
               |HAZ CreaTempo; |NOME_DAT #500 Tempo; aTmp500 = Tempo;
               |ABRE #500;
               |ABRE #91;
               |XLEE nHandle, 250, aDato;    || se desprecia la 1§ linea
               |XLEE nHandle, 250, aDato;
               |PARA; |SI FSalida ] 0; |HACIENDO;
                    nLinea = nLinea + 1; |PINTA 1615, nLinea;
                    nCamVto = 6;
                    |HAZ FPago;
                    |XLEE nHandle, 250, aDato;
               |SIGUE;
               |LEE 000#500=;
               |SI FSalida = 0;
                    |MODO_RELACION #91, 1, "agifa177", "N", "S";
                    |ABRET #177;   || la relacion cierra el fichero
                    |BUCLE PideTipoRecibo;
                    |CIERRAT #177;
               |FINSI;
               |CIERRA #91;
               |CIERRA #500;
               Tempo = aTmp500; |HAZ BoraTempo; |DELINDEX #500;
               |XCIERRA nHandle;
          |SINO;
               |MENAV "0000No se puede abrir el fichero formas de pago";
          |FINSI;
          |FBORRA aFic;
     |FINSI;

     aAlfa = #0#2; |QBF aAlfa;
     |SI aAlfa ! "";
          |RECIBE_FICHERO aAlfa, aFic;
          |ABRE #3;
          |ABRE #24;
          |ABRE #25;
          |ABRE #101;
          |ABRE #102;
          |ABRE #24;
          nSw = 1; |HAZ ImportaFic;
          |CIERRA #102;
          |CIERRA #101;
          |CIERRA #25;
          |CIERRA #24;
          |CIERRA #3;
          |FBORRA aFic;
     |FINSI;

     aAlfa = #0#3; |QBF aAlfa;
     |SI aAlfa ! "";
          |RECIBE_FICHERO aAlfa, aFic;
          |ABRE #112;
          nSw = 2; |HAZ ImportaFic;
          |CIERRA #112;
          |FBORRA aFic;
     |FINSI;

     |ABRE #84;
     |ABRE #69;
     |ABRE #24;
     |ABRE #6;
     aFic = #0#4; nSw = 3; |HAZ ImportaXls;
     |CIERRA #6;
     |CIERRA #24;
     |CIERRA #69;
     |CIERRA #84;

     |ABRE #79;
     |ABRE #72;
     aSerie = #0#5;
     aFic = #0#6; nSw = 4; |HAZ ImportaXls;

     aSerie = #0#7;
     aFic = #0#8; nSw = 5; |HAZ ImportaXls;
     |CIERRA #72;
     |CIERRA #79;

     |BUCLE CobrayConta;
     Tempo = aTmp6; |HAZ BoraTempo; |DELINDEX #6;
|FPRC;

|PROCESO Browse; |TIPO 0;
     |SI FSalida ! 13; |ACABA; |FINSI;

     |SI Campo = 6; |O Campo = 8; |O Campo = 4;
          aRuta = "F*.xls*";
     |SINO;
          aRuta = "F*.txt";
     |FINSI;

     |BROWSE aRuta;

     aRuta = aRuta % 2; |QBF aRuta;
     |SI aRuta = "F"; aRuta = ""; |FINSI;

     |QBF aRuta;
     |SI aRuta = "";
          |ERROR;
     |SINO;
          #0Campo = aRuta;
          |PINTA #0Campo;
     |FINSI;
|FPRC;

|PROCESO FaCom; |TIPO 0;
     aAlfa = #0#6; |QBF aAlfa;
     |SI aAlfa = "";
          |C_M #0#5, 1, "N";
     |SINO;
          |C_M #0#5, 1, "S";
     |FINSI;
|FPRC;

|PROCESO FaSub; |TIPO 0;
     aAlfa = #0#8; |QBF aAlfa;
     |SI aAlfa = "";
          |C_M #0#7, 1, "N";
     |SINO;
          |C_M #0#7, 1, "S";
     |FINSI;
|FPRC;

|PROCESO Serie; |TIPO 0;
     |SI FSalida = 2; |ACABA; |FINSI;
     |C_M #0Campo, 0, aAlfa;
     |SI aAlfa = "S";
          |ABRE #7;
          #7#26 = #0Campo;
          |LEE 000#7=;
          |SI FSalida ! 0;
               |MENAV "0000Serie inexistente...";
               |ERROR;
          |FINSI;
          |CIERRA #7;
     |FINSI;
|FPRC;

|PROGRAMA;
     aCR = &13; aLF = &10; aTAB = &9;
     |CLS;
     |CABEZA "Importacion ficheros";
     |ABRE #0;
     |LEE 101#0p;
     |SI FSalida ! 0; |GRABA 020#0b; |FINSI;
     |PINPA #0#0;
     |PINDA #0#0;
     |ENDATOS #1#0;
     |SI FSalida = 0; |GRABA 020#0a; |FINSI;
     |CIERRA #0;
|FPRO;
