     Pdte Asignar

|FICHEROS;
     gesiz006 #0;
     dsm00003 #3;
     gesim001 #6;
     gesiz007 #16,MANTE; ||Procesar Aviso
     gesim005 #17;
     gesim006 #18;
     gesim007 #19;
     gesim010 #20;
     gesim021 #21;
     gesim012 #12;
     gesim003 #22;
     agifa024 #24;
     agifa019 #119;

     &refera1@ #1001;
     &refera2@ #1002;
     &refera3@ #1003;
     refelin@ #1005;
|FIN;

|VARIABLES;
     &eaArti = "";
     &enLin19 = 0;
     &enPestana = 0;
     &eaClave1 = "";
     &eaCliDoc = "";
     &eaAuto = "";
     &enModo = 0;
     &enError = 0;
     &eaMatricula = "";
     &eaSerAviso = "";
     &enNumAviso = 0;
     v0 = "000000";
     v1 = "                              ";
     v2 = 0;
     aPath = "";
     i = 0;
     nPanta = 0;
     aAlfa = "";
     nRango = 0;
     nPos1 = 0;
     nPos2 = 0;
     nPrecio = 0;
     nDto = 0;
     nVentana = 0;
 {-1}aVent = "";
     aVent1 = 0;
     aVent2 = 0;
     aVent3 = 0;
     aVent4 = 0;
     aVent5 = "";

     aEstadoBtn = "";
     nPestana = 0;
     nBtnSalir1 = 0;
     nBtnAsgMat1 = 0;
     nBtnModi1 = 0;
     nBtnProcesa1 = 0;
     nBtnImpre1 = 0;
     nBtnHisto1 = 0;
     nBtnSMS1 = 0;
     nEvtFoco = 0;
     &enGrida1 = 0;
     &enGrida2 = 0;
     &enGrida3 = 0;
|FIN;

|PROCESO TieneLineas;
     |SI #0#0 ! v0;
          |SI #0#1 ! v1;
               |SELECT #8#refelin@;
          |SINO;
               |SELECT #9#refelin@;
          |FINSI;
     |SINO;
          |SI #0#1 ! v1;
               |SI #0#0 ! v0;
                    |SELECT #10#refelin@;
               |SINO;
                    |SELECT #11#refelin@;
               |FINSI;
          |SINO;
               |SI #0#0 ! v0;
                    |SELECT #12#refelin@;
               |SINO;
                    |SELECT #13#refelin@;
               |FINSI;
          |FINSI;
     |FINSI;
     #refelin@#0 = "     ";
     #refelin@#1 = 000000;
     #refelin@#5 = #0#0;
     #refelin@#22 = #0#1;
     #refelin@#19 = #0#2;
     #refelin@#24 = "P";
     |SI #0#0 = "000000"; #refelin@#5# = "      "; |FINSI;
     aAlfa = #refelin@#5;
     |LEE 000#refelin@.];
     |SI FSalida ! 0; |O #refelin@#22 ! #0#1;
               |O #refelin@#19 ! #0#2; |O #refelin@#24 ! "P";
          |SI aAlfa = "      ";
               FSalida = 0;
          |SINO;
               |SI aAlfa ! #refelin@#5;
                    FSalida = 1;
               |SINO;
                    FSalida = 0;
               |FINSI;
          |FINSI;
     |SINO;
          FSalida = 0;
     |FINSI;
|FPRC;

|PROCESO EventoFoco1;
     enPestana = 1;
|FPRC;

|PROCESO BtnAsgMat1;
     |HAZ TieneLineas;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |LEE 000#refera1@.=;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |SALVA_DATOS #refera1@;
     |REPON_DATOS #17;
     |HAZ AsignaMatri;
     |SI enError = 0; |HAZ Refresca1; |FINSI;
|FPRC;

|PROCESO BtnModi1;
     |HAZ TieneLineas;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |LEE 000#refera1@.=;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |SALVA_DATOS #refera1@;
     |REPON_DATOS #17;
     enModo = 2; |HAZ EditaAviso;
     |SI enError = 0; |HAZ Refresca1; |FINSI;
|FPRC;

|PROCESO BtnProcesa1;
     |HAZ TieneLineas;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |LEE 000#refera1@.=;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |ABRE #17;
     #17#0 = #refera1@#0;
     #17#1 = #refera1@#1;
     |LEE 121#17=;
     #16#0 = #17#0;
     #16#1 = #17#1;
     #16#2 = #17#5;
     #16#3 = #17#6;
     #16#4 = #17#7;
     #16#5 = #17#8;
     #16#6 = #17#9;
     #16#7 = #17#10;
     #16#8 = #17#11;
     #16#9 = #17#12;
     #16#10 = #17#13;
     #16#11 = #17#14;
     #16#12 = #17#15;
     #16#13 = #17#16;
     #16#14 = #17#18;
     #16#15 = #17#19;

     |DDEFECTO #24;
     |ABRE #24;
     #24#0 = #16#2;
     |LEE 020#24=;
     |CIERRA #24;
     |DDEFECTO #3;
     |ABRE #3;
     #3#0 = #16#2;
     #3#1 = #16#3;
     |LEE 020#3=
     |CIERRA #3;
     |DDEFECTO #12;
     |ABRE #12;
     #12#0 = #16#14;
     |LEE 020#12=;
     |CIERRA #12;
     |DDEFECTO #22;
     |ABRE #22;
     #22#0 = #16#15;
     |LEE 020#22=;
     |CIERRA #22;

     #16#16 = #24#1;
     #16#17 = #3#2;
     #16#18 = #12#1;
     #16#19 = #22#1;
     #16#20 = #17#64;
     #16#21 = #17#66;
     #16#22 = #17#71;
     |HAZ ProcesaAviso;
     |SI enError = 0;
          |HORA aAlfa;
          |ABRET #18;
          |ABRET #19;
          |DDEFECTO #18;
          #18#0 = #17#0;
          #18#1 = #17#1;
          #18#2 = 1;
          #18#3 = "A";
          #18#4 = Usuario % 810;
          #18#5 = ~;
          #18#6 = aAlfa;
          #18#7 = #16#20;
          #18#10 = #16#15;
          #18#11 = #16#14;
          #18#12 = #16#4;
          #18#13 = #16#5;
          #18#14 = #16#6;
          #18#15 = #16#7;
          #18#16 = #16#8;
          #18#17 = #16#9;
          #18#18 = #16#10;
          #18#19 = #16#11;
          #18#20 = #16#12;
          #18#21 = #16#13;
          #18#39 = #17#5;
          #18#40 = #17#21;
          #18#41 = #17#22;
          #18#42 = #17#45;
          #18#43 = #17#46;
          |DDEFECTO #12;
          |ABRE #12;
          #12#0 = #16#14;
          |LEE 020#12=;
          |CIERRA #12;
          |DDEFECTO #24;
          |ABRE #24;
          #24#0 = #17#5;
          |LEE 020#24=;
          |CIERRA #24;
          |DDEFECTO #21;
          |ABRE #21;
          #21#0 = #18#39;
          |LEE 020#21=;
          |CIERRA #21;
          #18#44 = #12#5;
          #18#45 = #21#3;
          eaArti = #18#44; |HAZ LeeArti;
          #18#46 = #119#18;
          #18#47 = #18#45 * #18#46;
          #18#50 = #12#3;
          #18#51 = #12#4;
          eaArti = #18#50; |HAZ LeeArti;
          #18#52 = #119#18;
          #18#53 = #18#51 * #18#52;
          #18#56 = #12#6;
          #18#57 = #21#2;
          eaArti = #18#56; |HAZ LeeArti;
          #18#58 = #119#18;
          #18#59 = #18#57 * #18#58;
          #18#62 = #16#21;
          #18#63 = #16#22;
          |SI #18#63 = "N"; #18#64 = "3"; |FINSI;
          |SI #18#63 = "U"; #18#64 = "2"; |FINSI;
          |SI #18#63 = "E"; #18#64 = "1"; |FINSI;
          |GRABA 020#18n;
          |HAZ ActProdu2;
          enLin19 = 0;
          |HAZ Defecto19_0;
          |CIERRAT #19;
          |CIERRAT #18;

          #17#64 = #16#20;
          #17#66 = #16#21;
          #17#71 = #16#22;
          #17#24 = "T";
          |SI #17#71 = "N"; #17#72 = "3"; |FINSI;
          |SI #17#71 = "U"; #17#72 = "2"; |FINSI;
          |SI #17#71 = "E"; #17#72 = "1"; |FINSI;
          |GRABA 020#17a;
          |HAZ RecalAviso;

          #refera2@#1 = 0; |REFRESCACONTROL enGrida3;
          #refera1@#1 = 0; |REFRESCACONTROL enGrida2;
          |REFRESCACONTROL enGrida1;
          |HAZ Refresca2;
     |FINSI;
     |CIERRA #17;
|FPRC;

|PROCESO BtnImpre1;
     |HAZ TieneLineas;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |LEE 000#refera1@.=;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |SALVA_DATOS #refera1@;
     |REPON_DATOS #17;
     |HAZ ImpreAviso;
|FPRC;
/*
|PROCESO BtnSMS1;
     |HAZ TieneLineas;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |LEE 000#refera1@.=;
     |SI FSalida ! 0; |ACABA; |FINSI;    ||Anna 08.02.2013. Lo quito por que esta heredado
                                         ||De inforalba y aqui no tiene sentido
     |ABRE #17;
     #17#0 = #refera1@#0;
     #17#1 = #refera1@#1;
     |LEE 000#17=;
     |SI FSalida = 0;
          |HAZ EnvioSMS;
     |FINSI;
     |CIERRA #17;
|FPRC;
*/
|PROCESO BtnHisto1;
     |HAZ TieneLineas;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |LEE 000#refera1@.=;
     |SI FSalida ! 0; |ACABA; |FINSI;

     eaMatricula = #refera1@#22;
     eaSerAviso = #refera1@#0;
     enNumAviso = #refera1@#1;
     |HAZ HistoMaquina;
|FPRC;

|PROCESO EstadoBotonIni;
     |ESTADO_CONTROL nBtnSalir1, aEstadoBtn;
     |ESTADO_CONTROL nBtnAsgMat1, aEstadoBtn;
     |ESTADO_CONTROL nBtnModi1, aEstadoBtn;
     |ESTADO_CONTROL nBtnProcesa1, aEstadoBtn;
     |ESTADO_CONTROL nBtnImpre1, aEstadoBtn;
     |ESTADO_CONTROL nBtnHisto1, aEstadoBtn;
 ||  |ESTADO_CONTROL nBtnSMS1, aEstadoBtn;     || Anna. 08.02.2013 quitado por que no se usa

     || bloquea/desbloquea todas las pesta¤as
     aAlfa = nPanta;
     |MAINCOMMAND 32913, "-1", "-1", aAlfa, "-1", "-1";
     |SI FSalida > 0;
          nPestana = FSalida;
          |ESTADO_CONTROL nPestana, aEstadoBtn
     |FINSI;
|FPRC;

|PROCESO Evento11;
     |HAZ TieneLineas;   ||para que no refresque los lineales sino hay datos
     |SI FSalida ! 0; |ACABA; |FINSI;

     |SI FSalida = 1; |O FSalida = 2;
          |LEE 000#refera1@.=;
          |SI FSalida = 0;
               eaCliDoc = #refera1@#5;
               #0#6 = #refera1@#7;
               #0#7 = #refera1@#8;
               #0#8 = #refera1@#9;
          |SINO;
               #0#6 = "";
               #0#7 = "";
               #0#8 = "";
          |FINSI;
          #0#9 = "";
          #0#10 = "";
          #0#11 = "";
          #0#12 = "";
          #0#13 = "N";
          #0#14 = "N";
          #0#15 = "";
          #0#16 = "";
          #0#17 = "";
          #0#18 = "";
          #0#19 = "N";
          #0#20 = "N";
          #0#21 = "";
          #0#22 = "";
          #0#23 = "";
          #0#24 = "";
          #0#25 = "N";
          #0#26 = "N";

          |HAZ PinCam1;

          #refera2@#1 = 0; |REFRESCACONTROL enGrida3;
          |REFRESCACONTROL enGrida2;
     |FINSI;
|FPRC;

|PROCESO Evento12;
     |HAZ TieneLineas;   ||para que no refresque los lineales sino hay datos
     |SI FSalida ! 0; |ACABA; |FINSI;

     |SI FSalida = 1; |O FSalida = 2;
          |LEE 000#refera2@.=;
          |SI FSalida = 0;
               #0#9 = #refera2@#44;
               #0#10 = #refera2@#45;
               #0#11 = #refera2@#46;
               #0#12 = #refera2@#47;
               #0#13 = #refera2@#48;
               #0#14 = #refera2@#49;
               #0#15 = #refera2@#50;
               #0#16 = #refera2@#51;
               #0#17 = #refera2@#52;
               #0#18 = #refera2@#53;
               #0#19 = #refera2@#54;
               #0#20 = #refera2@#55;
               #0#21 = #refera2@#56;
               #0#22 = #refera2@#57;
               #0#23 = #refera2@#58;
               #0#24 = #refera2@#59;
               #0#25 = #refera2@#60;
               #0#26 = #refera2@#61;
          |SINO;
               #0#9 = "";
               #0#10 = "";
               #0#11 = "";
               #0#12 = "";
               #0#13 = "";
               #0#14 = "";
               #0#15 = "";
               #0#16 = "";
               #0#17 = "";
               #0#18 = "";
               #0#19 = "";
               #0#20 = "";
               #0#21 = "";
               #0#22 = "";
               #0#23 = "";
               #0#24 = "";
               #0#25 = "";
               #0#26 = "";
          |FINSI;
          |HAZ PinCam1;

          |REFRESCACONTROL enGrida3;
     |FINSI;
|FPRC;

|PROCESO Evento13;
     |SI FSalida = 1; |O FSalida = 2;
          |LEE 000#refera3@.=;
     |FINSI;
|FPRC;

|PROCESO Min11;
     #refera1@#0 = "     ";
     #refera1@#1 = 000000;
     #refera1@#5 = #0#0;
     #refera1@#22 = #0#1;
     #refera1@#19 = #0#2;
     #refera1@#24 = "P";
     |SI #0#0 = "000000"; #refera1@#5# = "      "; |FINSI;
|FPRC;

|PROCESO Max11;
     #refera1@#0 = "zzzzz";
     #refera1@#1 = 999999;
     #refera1@#5 = #0#0;
     #refera1@#22 = #0#1;
     #refera1@#19 = #0#2;
     #refera1@#24 = "P";
     |SI #0#0 = "000000"; #refera1@#5# = "zzzzzz"; |FINSI;
     |SI #0#1 = "                              "; #refera1@#22# = "zzzzzzzzzzzzzzzzzzzzzzzzzzzzzz"; |FINSI;
     |SI #0#2 = 0; #refera1@#19# = 99999; |FINSI;
|FPRC;

|PROCESO Min12;
     #refera2@#0 = #refera1@#0;
     #refera2@#1 = #refera1@#1;
     #refera2@#2 = 1;
|FPRC;

|PROCESO Max12;
     #refera2@#0 = #refera1@#0;
     #refera2@#1 = #refera1@#1;
     #refera2@#2 = 999;
|FPRC;

|PROCESO Min13;
     #refera3@#0 = #refera2@#0;
     #refera3@#1 = #refera2@#1;
     #refera3@#2 = #refera2@#2;
     #refera3@#3 = 1;
|FPRC;

|PROCESO Max13;
     #refera3@#0 = #refera2@#0;
     #refera3@#1 = #refera2@#1;
     #refera3@#2 = #refera2@#2;
     #refera3@#3 = 999;
|FPRC;

|PROCESO Actualiza1;
     |DESTRUYECONTROL enGrida1;
     |PINPA #1#0; nPanta = FSalida;
     nRango = 4 + 8 + 16 + 32;
     nPos1 = 0602;
     nPos2 = 1398;
     |SI #0#0 ! v0;
          |SI #0#1 ! v1;
               |LINEAL_SIMPLE #8#refera1@, nRango, nPos1, nPos2, Min11, Max11, Evento11;
          |SINO;
               |LINEAL_SIMPLE #9#refera1@, nRango, nPos1, nPos2, Min11, Max11, Evento11;
          |FINSI;
     |SINO;
          |SI #0#1 ! v1;
               |SI #0#0 ! v0;
                    |LINEAL_SIMPLE #10#refera1@, nRango, nPos1, nPos2, Min11, Max11, Evento11;
               |SINO;
                    |LINEAL_SIMPLE #11#refera1@, nRango, nPos1, nPos2, Min11, Max11, Evento11;
               |FINSI;
          |SINO;
               |SI #0#0 ! v0;
                    |LINEAL_SIMPLE #12#refera1@, nRango, nPos1, nPos2, Min11, Max11, Evento11;
               |SINO;
                    |LINEAL_SIMPLE #13#refera1@, nRango, nPos1, nPos2, Min11, Max11, Evento11;
               |FINSI;
          |FINSI;
     |FINSI;
     enGrida1 = FSalida;
     #refera2@#1 = 0; |REFRESCACONTROL enGrida3;
     #refera1@#1 = 0; |REFRESCACONTROL enGrida2;
     |REFRESCACONTROL enGrida1;

     aEstadoBtn = "ENABLE"; |HAZ EstadoBotonIni;
|FPRC;

|PROCESO PinCam1;
     |PINPA #1#0;
     |PINTA 1409, #0#6;
     |PINTA 1509, #0#7;
     |PINTA 1609, #0#8;

     |PINTA 3125, #0#9;
     |PINTA 3147, #0#10;
     |PINTA 3159, #0#11;
     |PINTA 3171, #0#12;
     |PINTA 3184, #0#13;
     |PINTA 3193, #0#14;

     |PINTA 3225, #0#15;
     |PINTA 3247, #0#16;
     |PINTA 3259, #0#17;
     |PINTA 3271, #0#18;
     |PINTA 3284, #0#19;
     |PINTA 3293, #0#20;

     |PINTA 3325, #0#21;
     |PINTA 3347, #0#22;
     |PINTA 3359, #0#23;
     |PINTA 3371, #0#24;
     |PINTA 3384, #0#25;
     |PINTA 3393, #0#26;
|FPRC;

|PROCESO PintaPan1;
     |DDEF aPath;
     aAlfa = aPath + "gesim005"; |CARGA_DEF aAlfa, refera1@;
     |CARGA_DEF aAlfa, refelin@;
     aAlfa = aPath + "gesim006"; |CARGA_DEF aAlfa, refera2@;
     aAlfa = aPath + "gesim007"; |CARGA_DEF aAlfa, refera3@;
     |ABRET #refera1@;
     |ABRET #refera2@;
     |ABRET #refera3@;
     |ABRET #refelin@;

     |PINPA #1#0; nPanta = FSalida;

     nRango = 4 + 8 + 16 + 32;
     nPos1 = 2402;
     nPos2 = 2998;
     |LINEAL_SIMPLE #1#refera3@, nRango, nPos1, nPos2, Min13, Max13, Evento13;
     enGrida3 = FSalida;

     nRango = 4 + 8 + 16 + 32;
     nPos1 = 1702;
     nPos2 = 2398;
     |LINEAL_SIMPLE #1#refera2@, nRango, nPos1, nPos2, Min12, Max12, Evento12;
     enGrida2 = FSalida;
/*
     nRango = 4 + 8 + 16 + 32;
     nPos1 = 0602;
     nPos2 = 1398;
     |LINEAL_SIMPLE #1#refera1@, nRango, nPos1, nPos2, Max11, Min11, Evento11;
     enGrida1 = FSalida;
*/
     |CONTROL_SIMPLE nPanta, "EVENTOPAN", 0000, 0000, EventoFoco1;
     nEvtFoco = FSalida;

     |CONTROL_SIMPLE nPanta, "BOTON,Asigna Maq.", 0501, 0513, BtnAsgMat1;
     nBtnAsgMat1 = FSalida;
     |CONTROL_SIMPLE nPanta, "BOTON,Modificar", 0514, 0526, BtnModi1;
     nBtnModi1 = FSalida;
     |CONTROL_SIMPLE nPanta, "BOTON,Procesar", 0527, 0539, BtnProcesa1;
     nBtnProcesa1 = FSalida;
     |CONTROL_SIMPLE nPanta, "BOTON,Imprimir", 0540, 0552, BtnImpre1;
     nBtnImpre1 = FSalida;
     |CONTROL_SIMPLE nPanta, "BOTON,Historial Maq.", 0553, 0565, BtnHisto1;
     nBtnHisto1 = FSalida;
   ||  |CONTROL_SIMPLE nPanta, "BOTON,Envio SMS", 0566, 0578, BtnSMS1;           || Anna. 08.02.2013 quitado por que no se usa
   ||  nBtnSMS1 = FSalida;

     |CONTROL_SIMPLE nPanta, "BOTON,{{207}} Salir", 3688, 3698, BtnSalir;
     nBtnSalir1 = FSalida;

     |HAZ PinCam1;

     |SI eaAuto = "";
          aEstadoBtn = "DISABLE"; |HAZ EstadoBotonIni;
     |FINSI;
|FPRC;

|PROCESO DestruyePan1;
/*
     |DESTRUYECONTROL enGrida1;
     |DESTRUYECONTROL enGrida2;
     |DESTRUYECONTROL enGrida3;

     |FIN_CONTROL_WINDOWS nEvtFoco;
     |FIN_CONTROL_WINDOWS nBtnAsgMat1;
     |FIN_CONTROL_WINDOWS nBtnModi1;
     |FIN_CONTROL_WINDOWS nBtnProcesa1;
     |FIN_CONTROL_WINDOWS nBtnImpre1;
     |FIN_CONTROL_WINDOWS nBtnHisto1;
     |FIN_CONTROL_WINDOWS nBtnSMS1;

     |FIN_CONTROL_WINDOWS nBtnSalir1;
*/

     |CIERRAT #refera3@;
     |CIERRAT #refera2@;
     |CIERRAT #refera1@;
     |CIERRAT #refelin@;
     |DESCARGA_DEF #refera3@;
     |DESCARGA_DEF #refera2@;
     |DESCARGA_DEF #refelin@;
     |DESCARGA_DEF #refera1@;
|FPRC;
