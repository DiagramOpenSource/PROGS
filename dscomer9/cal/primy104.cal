
|FICHEROS;
     primy004 #0;    ||este def
     primw001 #1;    ||Temporal para almacenar los valores.

     agifa010 #10;   ||Albaranes Vtas. CAB
     agifa071 #71;   ||Albaranes Vtas. LIN
     agifa048 #480;  ||Escandallos.
     agifa019 #19;   ||Articulos.
|FIN;

|VARIABLES;
     aInforme  = "primy104";
     nHay      = 0;
     nCoste    = 0;
     aAlfa     = "";
     nPvp      = 0;
|FIN;

|PROCESO Tmp;
     nHay = 1;
     |PRINT;
|FPRC;

|DEFBUCLE Tmp;
     #1#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Tmp;
|FIN;

|PROCESO agifa071;
     |SI #71#2 < #0#3; |O #71#2 > #0#4; |ACABA; |FINSI;

     |DDEFECTO #1;
     #1#11 = #10#6;
     #1#12 = #71#2;
     |SI #0#9 = "D";
          #1#13 = #71#29;
          #1#14 = #71#0;
          #1#15 = #71#1;
     |FINSI;
     |LEE 101#1=;
     |SI FSalida ! 0; |GRABA 020#1b; |FINSI;

     #19#0 = #71#2;
     |LEE 000#19=;
     |SI FSalida ! 0; |DDEFECTO #19; |FINSI;
     aAlfa = #19#127; |QBF aAlfa;
     |SI aAlfa = "F";
          #480#0 = #71#2;
          |LEE 000#480=;
          |SI FSalida ! 0; |DDEFECTO #480; |FINSI;
          nCoste = #480#8;
          ||TODO CCC
          ||DDEFECTO #19;
     |SINO;
          nCoste = #19#164;
     |FINSI;
     #1#0 = #71#2;
     #1#1 = #1#1 + #71#5;             || Uni Venta
     #1#2 = #1#2 + (#71#5 * nCoste)   || Coste
     #1#3 = #1#3 + #71#37;            || Imp Venta
     #1#4 = #1#3 - #1#2;              || Imp Margen
     #1#10 = #1#1 * #19#19;           || Produc.

     nCoste = #1#3 / #1#1;            ||Coste Venta
     nPvp = #19#147 < #19#150;        ||Tarifa PVP4


     #1#5 = (#1#3 / #1#2) - 1;        || % Marg

     #1#6 = (nCoste * 100 / nPvp) - 100;     || % Dif.  Esta es la formula Buena

     ||#1#6 = #1#5 - (#1#3-(#1#1*nPvp))/#1#2;    || % Dif. YA no es esta formula

     #1#8 = (#1#10 / #1#2) - 1;       || % Vta
     #1#9 = #19#19;                   || PVP2

     |GRABA 020#1a;
     |LIBERA #1;
|FPRC;

|DEFBUCLE agifa010;
     #agifa010#4;
     6;
     #0#7, #0#5, 000000, #0#1;
     #0#8, #0#6, 999999, #0#2;
     ;
     NULL, NULL, agifa071;
|FIN;

|PROCESO Tipo3;
     aAlfa = Usuario; |QBF aAlfa;
     |NOME_DAT #1 aAlfa;
     |DELINDEX #1;

     |IMPRE 0;
     |SI FSalida = 0;
          |INFOR aInforme;
          |SI FSalida = 0;
               |ABRE #19;
               |ABRE #480;
               |ABRE #1;
               |BUCLE agifa010;
               |CIERRA #1;
               |CIERRA #480;
               |CIERRA #19;
               |BUCLE Tmp;
               |SI nHay = 1; |PIEINF; |FINSI;
               |FININF;
          |FINSI;
          |FINIMP;
     |FINSI;

     |DELINDEX #1;
|FPRC;

|PROGRAMA;
     |ABRE #0;
     |LEE 000#0p;
     |SI FSalida ! 0; |GRABA 020#0b; |FINSI;

     |CLS;
     |PINPA #0#0;
     |PINDA #0#0;
     |ENDATOS #2#0;
     |SI FSalida = 0;
          |HAZ Tipo3;
          |GRABA 020#0a;
     |FINSI;

     |CIERRA #0;
|FPRO;
