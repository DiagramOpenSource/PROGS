|FICHEROS;
     abyz0007 #0;
     dsm00003 #3; || Dir Ent
     abym0004 #4;
     abym0005 #5;
     agifa019 #19;
     dsm00020 #20; || Agencia Trans
     agifa024 #24;
     agifa025 #25;
     agifa084 #84;
     agifa069 #69;
     agifa321 #321;
     agifa324 #324;
     tempo134 #134;      || Tmp impresion
|FIN;

|VARIABLES;
     &eaFichero = "";
     &enForma = 0;
     &enCoste = 0;
     &eaProgVta= "";
     &enSwMenu = 0;
     &aDivisa = "";
     &aMoneda = "";

     aA¤o = "";
     aMes = "";
     aDia = "";
     aTmp = "";
     aFecha = "";
     aCliente = "";
     nDirEnt = 0;
     nLinea = 0;
     nMesSelec = 0;
     nMes = 0;
     i = 0;
     nInc = 0;
     nMesIni = 0;
     fFecha = @;
     aAlfa = "";
     aTitulo = "";
|FIN;

|PROCESO DefeMes; |TIPO 7;
     |SI #0#4 ! 0; |ACABA; |FINSI;
     fFecha = ~;
     aAlfa = fFecha % 402;
     #0#4 = aAlfa;
     aAlfa = fFecha % -104;
     #0#5 = aAlfa;
     |PINTA #0#4;
     |PINTA #0#5;
|FPRC;

|PROCESO CreaTitulo;
     |DDEFECTO #19;
     |ABRE #19;
     #19#0 = "";
     |LEE 000#19=;
     |CIERRA #19;

     nLinea = nLinea + 1;
     |DDEFECTO #69;
     #69#20 = #84#48;
     #69#0 = #84#0;
     #69#1 = nLinea;
     #69#3 = 1;
     #69#4 = aTitulo;
     #69#11 = #19#30;
     #69#13 = #19#2;
     #69#15 = #84#3;
     #69#16 = #84#34;
     #69#17 = #84#35;

     enForma = 1;
     eaProgVta = "agifa084";
     |HAZ AcumulaFC;
     #69#14 = enCoste;
     |HAZ TotalLin69;
     |GRABA 020#69n;
|FPRC;

|PROCESO Lin;
     |SI aTitulo ! "";
          |HAZ CreaTitulo;
          aTitulo = "";
     |FINSI;

     |DDEFECTO #19;
     |ABRE #19;
     #19#0 = #5#3;
     |LEE 000#19=;
     |CIERRA #19;

     nLinea = nLinea + 1;
     |DDEFECTO #69;
     #69#20 = #84#48;
     #69#0 = #84#0;
     #69#1 = nLinea;
     #69#2 = #5#3;
     #69#3 = 1;
     #69#4 = #5#4;
     #69#5 = 1;
     #69#6 = #5#5;
     #69#11 = #19#30;
     #69#13 = #19#2;
     #69#15 = #84#3;
     #69#16 = #84#34;
     #69#17 = #84#35;

     enForma = 1;
     eaProgVta = "agifa084";
     |HAZ AcumulaFC;
     #69#14 = enCoste;
     |HAZ TotalLin69;
     |GRABA 020#69n;
|FPRC;

|PROCESO Cab;
     nMesSelec = #0#4;
     nMesIni = #4#10;
     |SI nMesIni = 0; nMesIni = (A\(#4#5 % 402)); |FINSI;
     nInc = 1;
     |SI #4#9 = "M"; nInc = 1; |FINSI;
     |SI #4#9 = "B"; nInc = 2; |FINSI;
     |SI #4#9 = "T"; nInc = 3; |FINSI;
     |SI #4#9 = "S"; nInc = 6; |FINSI;
     |SI #4#9 = "A"; nInc = 12; |FINSI;
     |PARA i = nMesIni; |SI; |HACIENDO i = i + nInc;
          nMes = i;
          |SI i > 12; nMes = i - 12; |FINSI;
          |SI nMes = nMesIni; |Y i ! nMesIni; |SAL; |FINSI;
          |SI nMes = nMesSelec;
               aFecha = "01." + (("00" + nMes) % -102) + "." + (#0#5 % -104);
              |SAL;
          |FINSI;
     |SIGUE;

     |DDEFECTO #24;
     |ABRE #24;
     #24#0 = #4#2;
     |LEE 000#24=;
     |CIERRA #24;
     |ABRE #25;
     #25#0 = #24#25;
     |LEE 000#25=;
     |CIERRA #25;

     aCliente = #4#2;
     nDirEnt = #4#3;
     nLinea = 0;

     |DDEFECTO #84;
     #84#48 = #4#0
     enSwMenu = 1; |HAZ ContaFD7;
     |GRABA 020#84b;
     #84#1 = aFecha;
     #84#3 = #24#0;
     #84#4 = #24#1;
     #84#5 = #24#37;
     #84#6 = #25#0;
     #84#7 = #24#38;
     #84#8 = #4#7;
     #84#29 = #24#1;
     #84#30 = #24#8;
     #84#31 = #24#9;
     #84#32 = #24#156;
     #84#33 = #24#10;
     #84#34 = #25#7;
     #84#35 = #24#4;
     #84#36 = #24#47;
     #84#40 = #24#16;
     #84#60 = #24#15;
     #84#64 = #24#183;
     #84#65 = #24#192;

     #324#0 = #84#65;
     |LEE 000#324=;
     #84#66 = #324#2;

     #84#67 = #24#193;
     #84#68 = #321#9;

     #324#0 = #84#68;
     |LEE 000#324=;
     #84#69 = #324#2;

     #84#78 = #24#202;
     #84#88 = #24#23;
     #84#89 = #24#24;
     #84#90 = #24#25
     #84#91 = #4#3;
     aAlfa = ("000000" + #4#1) % -106;
     #84#94 = #4#0 + "/" + aAlfa;

     #20#0 = #84#78;
     |LEE 000#20=;
     |SI FSalida = 0;
          #84#9 = #20#1;
     |FINSI;
     #3#0 = #84#3;
     #3#1 = #84#91;
     |LEE 000#3=;
     |SI FSalida = 0;
          #84#2 = #3#10;
          #84#29 = #3#10;
          #84#30 = #3#2;
          #84#31 = #3#3;
          #84#64 = #3#6;
          #84#33 = #3#7;
     |FINSI;

     aDivisa = #84#65;
     aMoneda = #84#67;
     |HAZ Divisas084;

     #134#0 = #84#48;
     #134#1 = #84#0;
     |GRABA 020#134n;

     aTitulo = "Mantenimiento de contrato " + #4#0 + "/" + (("000000" + #4#1)%-106);
|FPRC;

|PROCESO FinCab;
     |HAZ LimCabAgifa084;
     |BUCLELIN 0 CalCabAgifa084 #84;
     |GRABA 020#84a;
     |LIBERA #84;
|FPRC;

|PROCESO Filtro;
     || cheq fecha alta
     aDia = #4#5 % 102;
     aMes = #4#5 % 402;
     aA¤o = #4#5 % -104;
     |SI aA¤o > #0#5; |ACABA; |FINSI;
     |SI aA¤o = #0#5;
          |SI aMes > #0#4; |ACABA; |FINSI;
     |FINSI;

     || cheq fecha baja
     aFecha = #4#6;
     |SI aFecha = "01.01.0000"; aFecha = "31.12.9999"; |FINSI;
     aDia = aFecha % 102;
     aMes = aFecha % 402;
     aA¤o = aFecha % -104;
     |SI aA¤o < #0#5; |ACABA; |FINSI;
     |SI aA¤o = #0#5;
          |SI aMes < #0#4; |ACABA; |FINSI;
     |FINSI;

     || cheq periodo
     aFecha = "";
     nMesSelec = #0#4;
     nMesIni = #4#10;
     |SI nMesIni = 0; nMesIni = (A\(#4#5 % 402)); |FINSI;
     nInc = 1;
     |SI #4#9 = "M"; nInc = 1; |FINSI;
     |SI #4#9 = "B"; nInc = 2; |FINSI;
     |SI #4#9 = "T"; nInc = 3; |FINSI;
     |SI #4#9 = "S"; nInc = 6; |FINSI;
     |SI #4#9 = "A"; nInc = 12; |FINSI;
     |PARA i = nMesIni; |SI; |HACIENDO i = i + nInc;
          nMes = i;
          |SI i > 12; nMes = i - 12; |FINSI;
          |SI nMes = nMesIni; |Y i ! nMesIni; |SAL; |FINSI;
          |SI nMes = nMesSelec;
               aFecha = "01." + (("00" + nMes) % -102) + "." + (#0#5 % -104);
              |SAL;
          |FINSI;
     |SIGUE;
     |SI aFecha = ""; |ERROR; |FINSI;
|FPRC;


|DEFBUCLE Alarmas;
     #4#1;
     ;
     #0#0, #0#2;
     #0#1, #0#3;
     ;
     NULL, Filtro, NULL, NULL, NULL, Cab, Lin, FinCab;
     #4#2, #4#3;
|FIN;

|PROCESO Tipo3; |TIPO 3;
     |ABRE #321; |LEE 000#321p; |CIERRA #321;
     aTmp = Usuario;
     |NOME_DAT #134 aTmp;
     |DELINDEX #134;
     |ABRE #134;
     |ABRE #84
     |ABRE #69;
     |ABRE #3;
     |ABRE #20;
     |BUCLE Alarmas;
     |SI aCliente ! "";
          |HAZ LimCabAgifa084;
          |BUCLELIN 0 CalCabAgifa084 #84;
          |GRABA 020#84a;
          |LIBERA #84;

          |CONFI "0000SImprimir Facturas";
          |SI FSalida = 0;
               eaFichero = aTmp;
               |SUB_EJECUTA_NP "agifa086";
          |FINSI;
     |FINSI;
     |CIERRA #20;
     |CIERRA #3;
     |CIERRA #69;
     |CIERRA #84;
     |CIERRA #134;
     |DELINDEX #134;
|FPRC;
