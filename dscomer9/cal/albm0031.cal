|FICHEROS;
   albm0031 #0;
   albm0032 #1;

   albm0029 #10,MANTE;
   albm0030 #11;
   albm0043 #12,MANTE;

   dsm00024 #20;
   agifa017 #50;
   agifa019 #51;
   agifa112 #52;

   artialm@ #100;

   albw0041 #41,MANTE;   ||Aux. Ordenes en Mezc
   albm0037 #37;         ||Orden (C)
   albm0060 #60;         ||Rel. Orden/Mezclada

   albw0047 #666;        ||AuxSelFormulasMezcla
   albm0045 #45;

   agifa324 #324;
|FIN;

|VARIABLES;
     &EURODB = 0;
     nNumero = 0;
     nSwHayPartidas = 0;
     aID = "";
     nID = 0;

     aForAnt = "";
     aTempo666 = "";
     nSwHay = 0;
     nSalida = 0;
     aTempo41 = "";
     &Tempo = "";

 {-1}aMenuParti = "";
     aMenuParti1 = "2640";
     aMenuParti2 = "1";
     aMenuParti3 = "Contador Partida:";
     aMenuParti4 = "AM";
     aMenuParti5 = " Automatico ";
     aMenuParti6 = " Manual ";

     &enSw = 0;

     Modo   = 0;
     nModoEnt = 0;
     nModo  = 0;
     nCalc  = 0;
     nDocum = 0;
     nSwError = 0;
     nAntKgReal = 0;

     nPos1  = 0;
     nPos2  = 0;
     nFlag = 0;
     nGridPart = 0;

     aAlfa = "";
     aAntArt = "";

     &enAlbeAlm = 0;
     &eaTipoMov = "";
     &eaAlbePar = "";
     nModoPar = 0;
     aPartida = "";
     aPrograma = "";
     aFormula = "";
     aMensaje = "";
|FIN;

|PROCESO Tipo2m31; |TIPO 2;
   Modo = (FEntrada / 100) ! 0;
   nFlag = 0 +. 1;
   |SI Modo = 2; |O Modo = 3;
      |SI nFlag < 0;
         |SI #albm0031#16 = "S";
            |MENAV "    Mezclada finalizada.";
            |ERROR; |ACABA;
         |SINO;
            |SI Modo = 3;
               |HAZ Baja;
            |FINSI;
         |FINSI;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO albm0043_borra;
     |BORRA 020#albm0043.a;
     |LIBERA #albm0043;
|FPRC;

|DEFBUCLE albm0043_borra;
 #albm0043#1;
 ;
 #albm0031#0, 01, "               ";
 #albm0031#0, 99, "zzzzzzzzzzzzzzz";
 ;
 NULL, albm0043_borra;
|FIN;

|PROCESO albm0032_borra;
     |BORRA 020#albm0032.a;
     |LIBERA #albm0032;
|FPRC;

|DEFBUCLE albm0032_borra;
 #albm0032#1;
 ;
 #albm0031#0, 01;
 #albm0031#0, 99;
 ;
 NULL, albm0032_borra;
|FIN;

|PROCESO Baja;
     |BUCLE albm0032_borra;
     |BUCLE albm0043_borra;
|FPRC;

|PROCESO Tipo2m32; |TIPO 2;
   Modo = (FEntrada / 100) ! 0; nFlag = 0 +. 1;
   |SI nFlag < 0;
      |REFRESCACONTROL nGridPart;
      |SI Modo = 1;
         #albm0032#4 = #albm0031#11; |PINTA #albm0032#4;
         #albm0032#5 = #albm0031#12; |PINTA #albm0032#5;
         |C_M #albm0032#2,1,"S";
      |SINO;
         |C_M #albm0032#2,1,"N";
      |FINSI;
   |SINO;
      |DESTRUYECONTROL nGridPart;

      nPos1 = 2419; nPos2 = 2785;
      nModo = 1 + 2 + 4 + 8 + 16;
      |LINEAL_SIMPLE #1#albm0043,nModo,nPos1,nPos2,ClaveInf,ClaveSup,Evento;

      nPos1 = 2419; nPos2 = 2785;
      nModo = 2 + 4 + 8 + 16 + 32;
      |LINEAL_SIMPLE #1#albm0043,nModo,nPos1,nPos2,ClaveInf,ClaveSup,Evento;
      nGridPart = FSalida;
   |FINSI;
/*
   #albm0031#14 = #albm0031#14 +. #albm0032#9; |PINTA #albm0031#14;

   |ABRE #agifa019;
   #agifa019#0 = #albm0032#2;
   |LEE 101#agifa019.=;
   |SI FSalida = 0;
      #agifa019#12  = #agifa019#12 +. #albm0032#9;
      #agifa019#104 = #agifa019#104 -. #albm0032#9;
      |GRABA 020#agifa019.a; |LIBERA #agifa019;
   |FINSI;
   |CIERRA #agifa019;

   |ABRE #agifa017;
   #agifa017#0 = #albm0032#2;
   #agifa017#1 = #albm0032#4;
   |LEE 101#agifa017.=;
   |SI FSalida = 0;
      #agifa017#8  = #agifa017#8  +. #albm0032#9;
      #agifa017#39 = #agifa017#39 -. #albm0032#9;
      |GRABA 020#agifa017.a; |LIBERA #agifa017;
   |FINSI;
   |CIERRA #agifa017;
*/
|FPRC;

|PROCESO ClaveInf;
   #albm0043#0 = #albm0032#0;
   #albm0043#1 = #albm0032#1;
   #albm0043#2 = " " * 15;
|FPRC;

|PROCESO ClaveSup;
   #albm0043#0 = #albm0032#0;
   #albm0043#1 = #albm0032#1;
   #albm0043#2 = "z" * 15;
|FPRC;

|PROCESO Evento;
|FPRC;

|PROCESO Tipo13m31; |TIPO 13;
   |SI nGridPart = 0;
      |ABRE #albm0043;
      nPos1 = 2419; nPos2 = 2785;
      nModo = 2 + 4 + 8 + 16 + 32;
      |LINEAL_SIMPLE #1#albm0043,nModo,nPos1,nPos2,ClaveInf,ClaveSup,Evento;
      nGridPart = FSalida;
   |SINO;
      |REFRESCACONTROL nGridPart;
   |FINSI;
|FPRC;

|PROCESO Tipo9; |TIPO 9;
   |DESTRUYECONTROL nGridPart;
   |CIERRA #albm0043;
|FPRC;

|CALCULO VuelcaF;

   #dsm00024#0 = #albm0030#2;
   #dsm00024#1 = #albm0031#11;
   #dsm00024#2 = "";
   |LEE 000#dsm00024.];
   |SI FSalida = 0; |Y #dsm00024#0 = #albm0030#2; |Y #dsm00024#1 = #albm0031#11;
   |SINO;
      aAlfa = "    No hay ninguna partida del articulo " + #albm0030#2; |QBF aAlfa;
      aAlfa = aAlfa + " en el almacen " + #albm0031#11;
      |MENAV aAlfa;
   |FINSI;

   #albm0029#0 = #albm0030#0;
   |LEE 000#albm0029.=;
   |SI FSalida ! 0; |DDEFECTO #albm0029; |FINSI;

   nCalc = ((#albm0030#4 * #albm0031#13) / #albm0029#2) ! 2;

   |DDEFECTO #albm0032;
   #albm0032#0  = #albm0031#0;
   #albm0032#1  = #albm0030#1;
   |LEE 101#albm0032.=;
   |SI FSalida ! 0;
      |DDEFECTO #albm0032;
      #albm0032#0  = #albm0031#0;
      #albm0032#1  = #albm0030#1;
      |GRABA 020#albm0032.b;
   |FINSI;

   #albm0032#2  = #albm0030#2;
   #albm0032#3  = #albm0030#3;
   #albm0032#4  = #albm0031#11;
   #albm0032#5  = #albm0031#12;
   #albm0032#7  = nCalc;
   |GRABA 020#albm0032.a;
   |LIBERA #albm0032;
|FCAL;

|DEFBUCLE VuelcaF;
#albm0030#1;
;
#albm0031#3,01;
#albm0031#3,99;
;
NULL,VuelcaF;
|FIN;

|PROCESO AntKGReal; |TIPO 7;
   nAntKgReal = #albm0031#13;
|FPRC;

|PROCESO RecalcKg;
   |SELECT #2#albm0030;
   #albm0030#0 = #albm0031#3;
   #albm0030#2 = #albm0032#2;
   |LEE 000#albm0030.=;
   |SI FSalida = 0;
      #albm0029#0 = #albm0030#0;
      |LEE 000#albm0029.=;
      |SI FSalida ! 0; |DDEFECTO #albm0029; |FINSI;
   |FINSI;
   |SELECT #1#albm0030;

   nCalc = ((#albm0030#4 * #albm0031#13) / #albm0029#2) ! 2;

   #albm0032#7 = nCalc;
   |GRABA 020#albm0032.a;
|FPRC;

|DEFBUCLE RecalcKg;
#albm0032#1;
;
#albm0031#0,01;
#albm0031#0,99;
;
NULL,RecalcKg;
|FIN;

|CALCULO VuelcaForm;
   |SI #albm0031#13 ! nAntKgReal;
      |ABRE #albm0029; |ABRE #albm0030;
      |BUCLE RecalcKg;
      |CIERRA #albm0029; |CIERRA #albm0030;
   |FINSI;

   Modo = (FEntrada / 100) ! 0;
   |SI Modo = 1;
      |ABRE #albm0029;   |ABRE #albm0032;   |ABRE #dsm00024;
      |BUCLE VuelcaF;
      |CIERRA #albm0032; |CIERRA #albm0029; |CIERRA #dsm00024;
   |FINSI;
|FCAL;

|CALCULO MiraArtAlmPart;
   |SI FSalida = 10;
      aAlfa = "SELECT * FROM dsm00024 INTO sq" + Usuario + ".def WHERE ";
      |SI Campo = 2; nPos1 = 1732; |FINSI;
      |SI Campo = 4;
         aAlfa = aAlfa + "0 == '" + #albm0032#2; nPos1 = 1832;
      |FINSI;
      |SI Campo = 6;
         aAlfa = aAlfa + "0 == '" + #albm0032#2 + "' AND 1 == " + #albm0032#4; nPos1 = 1932;
      |FINSI;
      nPos2 = 2380; |HAZ Sql;
   |FINSI;
|FCAL;

|CALCULO Sql;
      |SQL aAlfa;
      |SI FSalida = 0;
         |DBASE aAlfa; |QBF aAlfa; aAlfa = aAlfa + "def/sq" + Usuario + ".mas";
         |CARGA_DEF aAlfa, artialm@;
         |SI FSalida = 0;
            |DFICE aAlfa; |QBF aAlfa; |PATH_DAT #100 aAlfa;
            |ABRE #artialm@;
            nModo = 2 + 4 + 8 + 16;
            |LINEAL_SIMPLE #1#artialm@,nModo,nPos1,nPos2,NULL,NULL,NULL;
            |SI FSalida = 0;
               #albm0032#4 = #artialm@#1; |PINTA #albm0032#4;
||               #albm0032#6 = #artialm@#2; |PINTA #albm0032#6;
            |SINO;
               |ERROR;
            |FINSI;
            |CIERRA #artialm@; |DESCARGA_DEF #artialm@;
         |FINSI;
         |DBASE aAlfa; |QBF aAlfa; aAlfa = aAlfa + "def/sq" + Usuario + ".mas"; |FBORRA aAlfa;
      |FINSI;
|FCAL;

|PROCESO QuitaReserva;
||   |SI #albm0032#9 = 0; |ACABA; |FINSI;

   #agifa019#0 = #albm0032#2;
   |LEE 101#agifa019.=;
   |SI FSalida = 0;
||      #agifa019#12  = #agifa019#12 - #albm0032#9;
||      #agifa019#104 = #agifa019#104 + #albm0032#9;
||      |GRABA 020#agifa019.a; |LIBERA #agifa019;
   |FINSI;

   #agifa017#0 = #albm0032#2;
   #agifa017#1 = #albm0032#4;
   |LEE 101#agifa017.=;
   |SI FSalida = 0;
||      #agifa017#8  = #agifa017#8  - #albm0032#9;
||      #agifa017#39 = #agifa017#39 + #albm0032#9;
      |GRABA 020#agifa017.a; |LIBERA #agifa017;
   |FINSI;
|FPRC;

|DEFBUCLE QuitaReserva;
#albm0032#1;
;
#albm0031#0,01;
#albm0031#0,99;
;
NULL,QuitaReserva;
|FIN;

|PROCESO Tipo1m31; |TIPO 1;
   Modo = (FEntrada / 100) ! 0;
   ||SI Modo = 3; |Y #albm0031#16 = "N"; |BUCLE QuitaReserva; |FINSI;
|FPRC;

|PROCESO TomaPartida;
   |ABRE #dsm00024; |ABRE #agifa112;
   #dsm00024#0 = #albm0032#2;
   #dsm00024#1 = #albm0032#4;
   #dsm00024#2 = #albm0032#6;
   |LEE 000#dsm00024.=;
   |SI FSalida = 0;
      #agifa112#0 = #dsm00024#3;
      |LEE 000#agifa112.=;

||      #albm0032#10 = #dsm00024#3; |PINTA #albm0032#10;
||      #albm0032#11 = #agifa112#2; |PINTA #albm0032#11;
||      #albm0032#14 = (#dsm00024#33 / #dsm00024#22) ! 2;
||      |PINTA #albm0032#14;
   |FINSI;
   |CIERRA #dsm00024; |CIERRA #agifa112;
|FPRC;


|PROCESO Tipo0C0m31; |TIPO 0;
/*
     aMensaje = "0000FSalida = " + FSalida;
     |MENAV aMensaje;
*/
|FPRC;


|PROCESO Docum; |TIPO 7;
   Modo = (FEntrada / 100) ! 0;
   |SI Modo ! 1; |ACABA; |FINSI;

   |ABRE #albm0045;
   #albm0045#0 = 1;      ||Siempre Almacen 1. Es decir la propia fabrica
   #albm0045#1 = "mezcladas";
   |LEE 101#albm0045.=;
   |SI FSalida ! 0; |GRABA 020#albm0045.b; |FINSI;
   nDocum = #albm0045#2 + 1;
   #albm0045#2 = nDocum;
   |GRABA 020#albm0045.a;
   |LIBERA #albm0045;
   |CIERRA #albm0045;
   #albm0031#0 = nDocum;

/*
   |ABRE #albm0031;
   |LEE 000#albm0031.u;
   nDocum = #albm0031#0 + 1;
   |CIERRA #albm0031;
   |DDEFECTO #albm0031;
   #albm0031#0 = nDocum;
*/
|FPRC;

|PROCESO MiraPartidas;
   #dsm00024#0 = #albm0032#2;
   #dsm00024#1 = #albm0032#4;
   #dsm00024#2 = #albm0032#6;
   |LEE 000#dsm00024.=;
   |SI FSalida = 0;
||      |SI #albm0032#8 > #dsm00024#31;
||         nSwError = 2; |ERROR10;
||      |FINSI;
   |SINO;
      nSwError = 1; |ERROR10;
   |FINSI;
|FPRC;

|DEFBUCLE MiraPartidas;
#albm0032#1;
;
#albm0031#0,01;
#albm0031#0,99;
;
NULL,MiraPartidas;
|FIN;

|PROCESO Tipo3m31; |TIPO 3;
   |ABRE #dsm00024;
   nSwError = 0;
   ||BUCLE MiraPartidas;
   |SI nSwError = 1;
      aAlfa = "    La partida de la linea " + #albm0032#1 + " no existe.";
   |FINSI;
   |SI nSwError = 2;
      aAlfa = "    La linea " + #albm0032#1 + " tiene previsiones por encima del stock disponible.";
   |FINSI;
   |SI nSwError ! 0; |MENAV aAlfa; |FINSI;
   |CIERRA #dsm00024;
|FPRC;

|PROCESO ImprimePar;
   enSw = 3; |PRINT;
|FPRC;

|DEFBUCLE ImprimePar;
#albm0043#1;
;
#albm0032#0, #albm0032#1, "               ";
#albm0032#0, #albm0032#1, "zzzzzzzzzzzzzzz";
;
NULL,ImprimePar;
|FIN;

|PROCESO ImprimeLin;
   enSw = 1; |PRINT;
   |ABRE #albm0043;
   |DDEFECTO #albm0043;
   #albm0043#0 = #albm0032#0;
   #albm0043#1 = #albm0032#1;
   |LEE 000#albm0043.];
   |SI FSalida = 0; |Y #albm0043#0 = #albm0032#0; |Y #albm0043#1 = #albm0032#1;
      enSw = 2; |PRINT;
      |BUCLE ImprimePar;
      enSw = 4; |PRINT;
      enSw = 0; |PRINT;
   |FINSI;
   |CIERRA #albm0043;
|FPRC;

|DEFBUCLE ImprimeLin;
#albm0032#1;
;
#albm0031#0,01;
#albm0031#0,99;
;
NULL,ImprimeLin;
|FIN;

|PROCESO Imprime; |TIPO 4;
   |IMPRE 0;
   |SI FSalida = 0;
      |INFOR "albm0031";
      |SI FSalida = 0;
         enSw = 0; |PRINT;
         |BUCLE ImprimeLin;
         |PIEINF; |FININF;
      |FINSI;
      |FINIMP;
      #albm0031#15 = "S"; |PINTA #albm0031#15;
      |GRABA 020#albm0031.a;
   |FINSI;
|FPRC;

|PROCESO Boton1; |TIPO 0;
|FPRC;

|PROCESO Refresca; |TIPO 77;
   |SI FSalida = 1;
      |LEE 000#albm0032.c;
      |REFRESCACONTROL nGridPart;
   |FINSI;
|FPRC;

|PROCESO MiraPartida; |TIPO 0;
     nModoEnt = (FEntrada / 100) ! 0;
|FPRC;

|PROCESO Partida; |TIPO 7;
     nModoPar = (FEntrada / 100) ! 0;
     ||ÄÄ
     |C_M #0#20, 1, "S";
     |SI nModoPar = 1; |Y #0#19 = "S";
          |MENU aMenuParti;
          |SI FSalida = 1;
               enAlbeAlm = #0#11;
               |SI #0#19 = "S";
                    eaTipoMov = "entrada";
               |SINO;
                    eaTipoMov = "mezcladas";
               |FINSI;
               |HAZ AlbeDamePartida;
               #0#20 = "M" + eaAlbePar;
               |PINTA #0#20;
          |FINSI;
     |FINSI;
     |SI nModoPar = 1; |Y #0#19 = "N";
          aAlfa = #0#0;
          #0#20 = "M" + aAlfa;
          |PINTA #0#20;
          |C_M #0#20, 1, "N";
     |FINSI;
     |SI nModoPar ! 1; |C_M #0#20, 1, "N"; |FINSI;
     ||ÄÄ
|FPRC;

|PROCESO agifa019_666;
     |DDEFECTO #666;
     #666#0 = #agifa019#0;
     |LEE 101#666=;
     |SI FSalida ! 0; |GRABA 020#666b; |FINSI;

     #666#1 = #agifa019#1;
     #666#2 = #agifa019#125;
     |GRABA 020#666a;
     |LIBERA #666;
|FPRC;

|DEFBUCLE agifa019_666;
 #agifa019#1;
 125;
 "                    ", "M ";
 "zzzzzzzzzzzzzzzzzzzz", "M ";
 ;
 NULL, agifa019_666;
|FIN;

|PROCESO SelFormula; |TIPO 66;
     ||ARA
     |HAZ CreaTempo; aTempo666 = Tempo;
     |NOME_DAT #666 aTempo666; |DELINDEX #666;
     |ABRE #666;
     |BUCLE agifa019_666;
     |LEE 000#666p;

     |CONSULTA_CLAVE #1#666;
     |SI FSalida = 0;
          #albm0031#3 = #666#0;
          #albm0031#4 = #666#1;
          |PINTA #albm0031#3;
          |PINTA #albm0031#4;
     |FINSI;
     |CIERRA #666;
     |DELINDEX #666; Tempo = aTempo666; |HAZ BoraTempo;
|FPRC;

|PROCESO FormulaTipo7; |TIPO 7;
     aForAnt = #albm0031#3;
     |QBF aForAnt;
|FPRC;

|PROCESO Miraalbm0043;
     nSwHayPartidas = 1;
     |ERROR10;
|FPRC;

|DEFBUCLE Miraalbm0043;
 #albm0043#1;
 ;
 #albm0031#0, 01, "               ";
 #albm0031#0, 99, "zzzzzzzzzzzzzzz";
 ;
 NULL, Miraalbm0043;
|FIN;

|PROCESO MiraHayPartidas;
     |BUCLE Miraalbm0043;
|FPRC;

|PROCESO BorraLinMez;
     |BUCLE albm0032_borra;
|FPRC;

|PROCESO AltaFormula; |TIPO 0;
     ||ARA
     aFormula = #albm0031#3;
     |QBF aFormula;
     |SI aFormula ! "";
          |ABRE #albm0029;
          #albm0029#0 = #albm0031#3;
          |LEE 000#albm0029.=;
          |SI FSalida ! 0;
               aMensaje = "0000SNo existe esta formula, desea crearla?";
               |CONFI aMensaje;
               |SI FSalida = 0;
                    |PUSHV 0501 2380;
                    |DDEFECTO #albm0029;
                    |PINPA #0#albm0029;
                    #albm0029#0 = #albm0031#3;
                    |ABRE #agifa019;
                    #agifa019#0 = #albm0031#3;
                    |LEE 101#agifa019.=;
                    |SI FSalida = 0;
                         #albm0029#1 = #agifa019#1;
                    |FINSI;
                    |CIERRA #agifa019;
                    |PINDA #0#albm0029;
                    |ENDATOS #1#albm0029;
                    |SI FSalida = 0;
                         |GRABA 020#albm0029.n;
                         |LIBERA #albm0029;
                    |SINO;
                         aMensaje = "0000Introduzca la Formula para la mezclada";
                         |MENAV aMensaje;
                         |ERROR;
                         |ACABA;
                    |FINSI;
                    |POPV;
                    #albm0031#4 = #albm0029#1;
                    |PINTA #albm0031#4;
               |SINO;
                    |ERROR;
                    |ACABA;
               |FINSI;
          |SINO;
               #albm0031#4 = #albm0029#1;
               |PINTA #albm0031#4;
          |FINSI;
          |CIERRA #albm0029;

          nModo = (FEntrada/100) ! 0;
          |SI nModo = 2;

               |SI aFormula ! aForAnt;
                    nSwHayPartidas = 0;
                    |HAZ MiraHayPartidas;         ||Miro en albm0042

                    |SI nSwHayPartidas = 1;
                         aMensaje = "0000No se puede cambiar la Formula de la Mezclada. Ya se han introducido Partidas";
                         |MENAV aMensaje;
                         #albm0031#3 = aForAnt;
                         |PINTA #albm0031#3;
                         |ERROR;
                         |ACABA;
                    |SINO;
                         aMensaje = "0000NCambio de Formula para la Mezclada. Continuar?";
                         |CONFI aMensaje;
                         |SI FSalida = 0;
                              |HAZ BorraLinMez;

                              |ABRE #albm0029;   |ABRE #albm0032;   |ABRE #dsm00024;
                              |BUCLE VuelcaF;
                              |CIERRA #albm0032; |CIERRA #albm0029; |CIERRA #dsm00024;

                              aAlfa = "|IDGRID";
                              aID = #albm0032#aAlfa#;
                              nID = aID;
                              |REFRESCACONTROL nID;
                              |PULSATECLA;

                              ||ARA
                         |SINO;
                              #albm0031#3 = aForAnt;
                              |PINTA #albm0031#3;
                              |ERROR;
                              |ACABA;
                         |FINSI;
                    |FINSI;
               |FINSI;
          |FINSI;
     |SINO;
          aMensaje = "0000Introduzca la Formula para la mezclada";
          |MENAV aMensaje;
          |ERROR;
     |FINSI;
|FPRC;

|PROCESO Tipo80; |TIPO 80;

     |ABRE #agifa324;
     |DDEFECTO #agifa324;
     #agifa324#0 = "EUR";
     |LEE 000#agifa324.=;
     EURODB = #agifa324#9;
     |CIERRA #agifa324;



     FSalida = 2899;
|FPRC;

|PROCESO Orden; |TIPO 0;
     |SI #albm0031#23 ! 0;
          |ABRE #albm0037;
          |DDEFECTO #albm0037;
          #albm0037#0 = #albm0031#23;
          #albm0037#16 = #albm0031#24;
          |LEE 000#albm0037.=;
          |SI FSalida = 0;
               |SI #albm0037#15 = "S";
                    aMensaje = "0000La orden [" + #albm0031#24# + "/" + #albm0031#23 + "] esta Finalizada";
                    |MENAV aMensaje;
                    |ERROR;
               |SINO;
                    |HAZ MeteOrden;
               |FINSI;
          |SINO;
               aMensaje = "0000No existe la orden: " + #albm0031#24# + "/" + #albm0031#23;
               |MENAV aMensaje;
               |ERROR;
          |FINSI;
          |CIERRA #albm0037;
     |FINSI;
|FPRC;

|PROCESO MeteOrden;
     |ABRE #albm0060;
     |DDEFECTO #albm0060;
     #albm0060#2 = #albm0031#24;
     #albm0060#0 = #albm0031#23;
     #albm0060#3 = "";
     #albm0060#1 = #albm0031#0;
     |LEE 101#albm0060.=;
     |SI FSalida ! 0;
          |GRABA 020#albm0060.n;
     |FINSI;
     |LIBERA #albm0060;
     |CIERRA #albm0060;
|FPRC;

|PROCESO albw0041;
     nSwHay = 1;
     |DDEFECTO #albm0060;
     #albm0060#2 = #albw0041#7;
     #albm0060#0 = #albw0041#0;
     #albm0060#3 = "";
     #albm0060#1 = #albm0031#0;
     |LEE 101#albm0060.=;
     |SI FSalida ! 0;
          |GRABA 020#albm0060.n;
     |FINSI;
     |LIBERA #albm0060;
|FPRC;

|DEFBUCLE albw0041;
 #albw0041#1;
 6;
 "     ", 000000, "*";
 "zzzzz", 999999, "*";
 ;
 NULL, albw0041;
|FIN;

|PROCESO Act_Orden60;
     |ABRE #albm0060;
     |BUCLE albw0041;
     |CIERRA #albm0060;
|FPRC;

|PROCESO Min41;
     #albw0041#0 = 000000;
     #albw0041#7 = "     ";
|FPRC;

|PROCESO Max41;
     #albw0041#0 = 999999;
     #albw0041#7 = "zzzzz";
|FPRC;

|PROCESO SelOrden; |TIPO 66;
     |HAZ CreaTemporal;
     |ABRE #albw0041;
     |HAZ RellenaTemporal;
     |HAZ ActTemporal;
     |HAZ Orden;

     |PUSHV 0501 2380;
     |ENTLINEAL #1#albw0041, 1, 4, 22, 1, Min41, Max41;
     nSalida = FSalida;
     |POPV;
     |CIERRA #albw0041;
     |SI nSalida = 0;
          |HAZ Borra60;
          nSwHay = 0;
          |HAZ Act_Orden60;
          |SI nSwHay = 0;
               #albm0031#23 = 0;
               #albm0031#24 = "";
               |PINTA #albm0031#23;
               |PINTA #albm0031#24;
          |FINSI;
     |FINSI;
     |HAZ DestruyeTemporal;
|FPRC;

|PROCESO CreaTemporal;
     |HAZ CreaTempo; aTempo41 = Tempo;
     |NOME_DAT #41 aTempo41; |DELINDEX #41;
|FPRC;

|PROCESO albm0037;
     |DDEFECTO #albw0041;
     #albw0041#0 = #albm0037#0;
     #albw0041#7 = #albm0037#16;
     |LEE 101#albw0041.=;
     |SI FSalida ! 0; |GRABA 020#albw0041.b; |FINSI;

     #albw0041#1 = #albm0037#1;
     #albw0041#2 = #albm0037#2;
     #albw0041#3 = #albm0037#3;
     #albw0041#4 = #albm0037#12;
     #albw0041#5 = #albm0037#15;
     #albw0041#6 = "";

     |GRABA 020#albw0041.a;
     |LIBERA #albw0041;
|FPRC;

|DEFBUCLE albm0037;
 #albm0037#1;
 15;
 "     ", 000000, "N";
 "zzzzz", 999999, "N";
 ;
 NULL, albm0037;
|FIN;

|PROCESO RellenaTemporal;
     |ABRE #albw0041;
     |BUCLE albm0037;
|FPRC;

|PROCESO albm0060;
     |DDEFECTO #albw0041;
     #albw0041#7 = #albm0060#2;
     #albw0041#0 = #albm0060#0;
     |LEE 101#albw0041.=;
     |SI FSalida ! 0; |GRABA 020#albw0041.b; |FINSI;

     #albw0041#6 = "*";
     |GRABA 020#albw0041.a;
     |LIBERA #albw0041;
|FPRC;

|DEFBUCLE albm0060;
 #albm0060#2;
 3;
 #albm0031#0, "";
 #albm0031#0, "";
 ;
 NULL, albm0060;
|FIN;

|PROCESO ActTemporal;
     |BUCLE albm0060;
|FPRC;

|PROCESO albm0060_borra;
     |BORRA 020#albm0060.a;
|FPRC;

|DEFBUCLE albm0060_borra;
 #albm0060#2;
 3;
 #albm0031#0, "";
 #albm0031#0, "";
 be;
 NULL, albm0060_borra;
|FIN;

|PROCESO Borra60;
     |BUCLE albm0060_borra;
|FPRC;


|PROCESO DestruyeTemporal;
     |DELINDEX #41; Tempo = aTempo41; |HAZ BoraTempo;
|FPRC;


|PROCESO Selecciona; |TIPO 0;
     |SI FSalida = 0; |Y #41Campo = Contenido;
          |SI #41#6 = "*";
               #41#6 = "";
          |SINO;
               #41#6 = "*";
          |FINSI;
          |GRABA 020#41a;
          |PINTA #41#6;
     |FINSI;
|FPRC;

|PROCESO Tipo11m31; |TIPO 11;
     |SI FSalida = 1; FSalida = 7; |FINSI;
     |HAZ Tipo12m31;
|FPRC;


|PROCESO Tipo12m31; |TIPO 12;
     Modo = (FEntrada / 100) ! 0;
     |SI Modo ! 1; |ACABA; |FINSI;

     |SI FSalida = 7;
          nNumero = #albm0031#0;

          |ABRE #albm0045;
          #albm0045#0 = 1;      ||Siempre Almacen 1. Es decir la propia fabrica
          #albm0045#1 = "mezcladas";
          |LEE 101#albm0045.=;
          |SI FSalida = 0;
               |SI nNumero = #albm0045#2;
                    nNumero = nNumero - 1;
                    #albm0045#2 = nNumero;
                    |GRABA 020#albm0045.a;
               |FINSI;
          |FINSI;
          |LIBERA #albm0045;
          |CIERRA #albm0045;
     |FINSI;
|FPRC;
