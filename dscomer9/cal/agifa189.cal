|FICHEROS;
     agifa189 #0;
     agifa017 #17;
     agifa019 #19;
     dsm00024 #24;
     tempo044 #44,MANTE;
     agifa049 #49;
     dsm00052 #52;
     agifa065 #65;
     dsm00067 #67;
     agifa074 #74;
     dsw00076 #76;
     agifa090 #90;
     agifa142 #142;
     agifa048 #148;
     dsm00238 #238;
     dsm00241 #241;
     agifa112 #112;
     dsm00005 #905;
     dsm00004 #904;
     dsm00006 #906;
     dsm00010 #910;

     dsm00024@;
     referen@ #100;

     coima001@;
     coima003@;
     coima008@;
     coima029@;

     gestrw01@;
|FIN;

|VARIABLES;
     aPrv = "";
     nSwGesisat = 0;
     nUniCom = 0;
     nUniEnt = 0;
     nUniDes = 0;
     nUniAcu = 0;
     nPdte = 0;
     nPdte2 = 0;
     nSwAgr = 0;
     &enMtsGestral = 0;
     &enUniGestral = 0;
     &enUniDefe = 0;
     nSwGestral = 0;
     nSwDefelino = 0;
     nSwBerria = 0;
     nSwGrupoSolar = 0;
     nSwRodacal = 0;
     nSwCoimasa = 0;
     &eaFicVertical = "";
     nPdt = 0;
     nFab = 0;
     nFin = 0;
     aPath = "";
     &eaFicArtic = "";
     &eaFicCompo = "";
     nGrabaPDA = 0;
     aTmp76 = "";
     nPen = 0;
     nImpo = 0;
     nUni0 = 0;
     nSto = 0;
     nValor = 0;
     nSwPcm = 0;
     nPcm = 0;

     aTmpDefe = "";
     nLin = 0;
     nLinPrime = 0;
     nLinPrime1 = 0;
     nModo = 0;
     nUniSto = 0;
     nNume = 0;
     nAntes = 0;
     nAntes2 = 0;
     &Tempo         = "";
     aTempo0        = "";
     aTempo44       = "";
     aTempo905      = "";
     &aDesdeEsc     = "";          || Del agifa190
     &aHastaEsc     = "";
     &nDesdeOrden   = 0;
     &nHastaOrden   = 0;
     &fDesdeFecha   = @;
     &fHastaFecha   = @;
     &aDesdeSer     = "";
     &aHastaSer     = "";

     &nDeci_Uni     = 0;

     {-1}menu       = "";
     menu1          = "2400";
     menu2          = "5";
     menu3          = "Entrada:";
     menu4          = "OAFMSPG";
     menu5          = "Aut. Orden";
     menu6          = "Aut. Articulo";
     menu7          = "Aut. Fecha";
     menu8          = "Manual";
     menu9          = "Simple";
     menu10         = "PDA";
     menu11         = "Agrupada";
     {-1}Menu       = "";
     Menu1          = "2400";
     Menu2          = "1";
     Menu3          = " ";
     Menu4          = "ARC";
     Menu5          = " Actualizar ";
     Menu6          = " Repasar ";
     Menu7          = " Cancelar ";

     aParam         = "";
     aFic           = "";
     nTota          = 0;
     nTota2         = 0;
     aAlfa          = "";
     aFin           = "";
     nLong          = 0;
     aParti         = "";
     nFactor        = 0;
     nUni           = 0;
     nUn2           = 0;
     nUni1          = 0;
     nUni2          = 0;
     nError = 0;
     aTmpGestral = "";
     nGesAlma = 0;
|FIN;

|INCLUYE i_varart;
--------------------------------------------------------------------------
|PROCESO GesAlma;
     |DDEF aAlfa;
     aAlfa = aAlfa + "gestrm11";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          #referen@#0 = #0#11;
          #referen@#1 = #0#0;
          |LEE 000#referen@.=;
          |SI FSalida ! 0; |DDEFECTO #referen@; |FINSI;
          |CIERRA #referen@;
          nGesAlma = #referen@#4;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;
--------------------------------------------------------------------------
|PROCESO GrabaLin;
     #0#2 = #74#2;
     #0#3 = #74#3;
     #0#4 = #74#4;
     #0#5 = #74#5;
     #0#6 = #90#2;
     |SI nSwGestral = 0;
          |HAZ GesAlma;
          #0#10 = nGesAlma;
     |SINO;
          #0#10 = #74#7;
     |FINSI;
     #0#14 = #74#10;
     |DDEFECTO #19;
     #19#0 = #0#2;
     |LEE 000#19=;

     #0#15 = #19#180;
     #0#16 = #19#204;
     |SI #0#16 = "S";
          |HAZ FactorMulti;
          #0#12 = #0#7;
          #0#7 = #0#7 * nFactor;
          #0#13 = nFactor;
     |FINSI;
     #0#7 = #0#7 + nUni;
     |GRABA 020#0a;
     |LIBERA #0;
|FPRC;

|PROCESO BuscaArtPen;
     nPen = #74#4 - #74#5;
     |SI nPen [ 0; |ACABA; |FINSI;

     |SI #74#2 = #referen@#0; ||Arti
          nGrabaPDA = 1;
          |DDEFECTO #76;
          #76#0 = #74#9;
          #76#1 = #74#0;
          #76#2 = #74#1;
          |LEE 101#76=;
          |SI FSalida ! 0; |GRABA 020#76b; |FINSI;
          nPen = #74#4 - #74#5 - #76#3;
          |SI nPen > 0;
               |DDEFECTO #0;
               #0#11 = #74#9;
               #0#0 = #74#0;
               #0#1 = #74#1;
               |LEE 101#0=;
               |SI FSalida ! 0; |GRABA 020#0b; |FINSI;
               |SI #referen@#3 > nPen;
                    #76#3 = #76#3 + nPen;
                    nUni = nPen;
                    |HAZ GrabaLin;
                    #referen@#3 = #referen@#3 - nPen;
               |SINO;
                    #76#3 = #76#3 + #referen@#3;
                    nUni = #referen@#3;
                    |HAZ GrabaLin;
                    #referen@#3 = 0;
               |FINSI;
               |LIBERA #0;
               |GRABA 020#referen@.a;
          |FINSI;
          |GRABA 020#76a;
          |LIBERA #76;
     |FINSI;
     |SI #referen@#3 [ 0; |ERROR10; |FINSI;
|FPRC;

|PROCESO RestoPDA;
     |ABRE #74;
     #74#9 = #76#0;
     #74#0 = #76#1;
     #74#1 = #76#2;
     |LEE 121#74=;
     |SI FSalida = 0;
          #0#11 = #74#9;
          #0#0 = #74#0;
          #0#1 = #74#1;
          |LEE 121#0=;
          |SI FSalida = 0;
               nUni = #referen@#3;
               |HAZ GrabaLin;
               |LIBERA #0;
          |FINSI;
     |FINSI;
     |CIERRA #74;
|FPRC;

|DEFBUCLE BuscaArtPen;
     #90#2;
     10;
     "01.01.0000", "     ", 000001, "N";
     "31.12.9999", "zzzzz", 999999, "N";
     ;
     NULL, NULL, BuscaArtPen;
|FIN;

|PROCESO CalcuCompo;
     |SI #0#7 > 0;
          |HAZ Componentes;
     |FINSI;
|FPRC;

|DEFBUCLE CalcuCompo;
     #0#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, CalcuCompo;
|FIN;

|PROCESO ImportaPDA;
     |ABRE #76;

     |DDEF aAlfa; aAlfa = aAlfa + "psion067";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida ! 0; |ACABA; |FINSI;
     |ABRE #19;
     |ABRE #0;
     |NOME_DAT #referen@#eaFichero#;
     |ABRE #referen@;
     |LEE 000#referen@.p;
     |PARA; |SI FSalida = 0; |HACIENDO;
          |SI #referen@#3 > 0;
               nGrabaPDA = 0;
               |BUCLE BuscaArtPen;
               |SI #referen@#3 > 0;
                    |SI nGrabaPDA = 0;
                         aAlfa = "0000Articulo:" + #referen@#0 +&13+" Sin orden de fabricacion!";
                         |MENAV aAlfa;
                    |SINO;
                         |HAZ RestoPDA;||Si queda algo se lo asigna al ultimo
                    |FINSI;
               |FINSI;
          |FINSI;
          |LEE 000#referen@.s;
     |SIGUE;
     |CIERRA #referen@;
     |DELINDEX #referen@;
     |CIERRA #0;
     |CIERRA #19;
     |DESCARGA_DEF #referen@;

     |CIERRA #76;
     |BUCLE CalcuCompo;
|FPRC;

|PROCESO CoimaCheq;
     nError = 1;

     |ABRE #19;
     #19#0 = #0#2;
     |LEE 020#19=;
     |CIERRA #19;

     |DDEF aPath;
     aAlfa = aPath + "coima001"; |CARGA_DEF aAlfa, coima001@;
     aAlfa = aPath + "coima003"; |CARGA_DEF aAlfa, coima003@;
     aAlfa = aPath + "coima029"; |CARGA_DEF aAlfa, coima029@;
     |SI FSalida = 0;
          |ABRE #coima001@; |LEE 000#coima001@.p; |CIERRA #coima001@;
          |ABRE #coima029@;
          #coima029@#0 = #0#2;
          #coima029@#1 = "F";
          |LEE 000#coima029@.=;
          |SI FSalida = 0;
               nFin = #coima029@#3;
          |SINO;
               nFin = #coima001@#1;
          |FINSI;
          |CIERRA #coima029@;

          |ABRE #coima003@;
          #coima003@#0 = "F";
          #coima003@#1 = #0#11;
          #coima003@#2 = #0#0;
          #coima003@#3 = #0#1;
          #coima003@#4 = 0;
          #coima003@#5 = 0;
          |LEE 000#coima003@.];
          |PARA; |SI FSalida = 0; |Y #coima003@#0 = "F"; |Y #coima003@#1 = #0#11;
                    |Y #coima003@#2 = #0#0; |Y #coima003@#3 = #0#1; |HACIENDO;
               |SI #coima003@#6 = nFin; |Y #coima003@#15 = "N";
                    nError = 0;
               |FINSI;
               |LEE 000#coima003@.s;
          |SIGUE;
          |CIERRA #coima003@;
          |DESCARGA_DEF #coima029@;
          |DESCARGA_DEF #coima003@;
          |DESCARGA_DEF #coima001@;
     |SINO;
          |MENAV "0000Error al cargar 'coima???'";
     |FINSI;
     |SI nError = 1;
          |MENAV "0000No se ha realizado el ultimo proceso de fabricación...";
     |FINSI;
|FPRC;

|PROCESO CoimaHisto;
     nPdt = #coima003@#7 - #coima003@#8;
     |SI nPdt ] nFab;
          #coima003@#8 = #coima003@#8 + nFab;
          |SI #coima003@#8 = #coima003@#7;
               #coima003@#15 = "S";
          |FINSI;
          nFab = 0;
     |SINO;
          #coima003@#8 = #coima003@#8 + nPdt;
          #coima003@#15 = "S";
          nFab = nFab - nPdt;
     |FINSI;
     |GRABA 020#coima003@.a;
     |LIBERA #coima003@;
     |SI nFab = 0; |ERROR10; |FINSI;
|FPRC;

|DEFBUCLE CoimaHisto;
     #coima003@#4006;
     15;
     "F", #0#11, #0#0, #0#1, nFin, "01.01.0000", "N";
     "F", #0#11, #0#0, #0#1, nFin, "31.12.9999", "N";
     be;
     NULL, CoimaHisto;
|FIN;

|PROCESO CoimaHistoFin;
     #coima003@#15 = "S";
     |GRABA 020#coima003@.a;
     |LIBERA #coima003@;
|FPRC;

|DEFBUCLE CoimaHistoFin;
     #coima003@#4006;
     15;
     "F", #0#11, #0#0, #0#1, 00, "01.01.0000", "N";
     "F", #0#11, #0#0, #0#1, 99, "31.12.9999", "N";
     be;
     NULL, CoimaHistoFin;
|FIN;

|PROCESO CoimaActFab;
     |DDEF aPath;
     aAlfa = aPath + "coima001"; |CARGA_DEF aAlfa, coima001@;
     aAlfa = aPath + "coima003"; |CARGA_DEF aAlfa, coima003@;
     aAlfa = aPath + "coima029"; |CARGA_DEF aAlfa, coima029@;
     |SI FSalida ! 0;
          |MENAV "0000ERROR al cargar 'coima0??'..."; |ACABA;
     |FINSI;
     |ABRE #coima001@; |LEE 000#coima001@.p; |CIERRA #coima001@;
     |ABRE #coima029@;
     #coima029@#0 = #0#2;
     #coima029@#1 = "F";
     |LEE 000#coima029@.=;
     |SI FSalida = 0;
          nFin = #coima029@#3;
     |SINO;
          nFin = #coima001@#1;
     |FINSI;
     |CIERRA #coima029@;
     nFab = #0#7 + #0#17;
     |BUCLE CoimaHisto;
     nNume = #0#4 - #0#5 - #0#7 - #0#17;
     |SI nNume [ 0;    ||entran todas
          |BUCLE CoimaHistoFin;
     |FINSI;

     |DESCARGA_DEF #coima029@;
     |DESCARGA_DEF #coima003@;
     |DESCARGA_DEF #coima001@;
|FPRC;

|PROCESO HistoVer;
     |DDEFECTO #906;
     #906#0 = #904#0;
     #906#1 = #0#10;
     #906#2 = #0#9;
     #906#3 = "FB";
     #906#4 = #0#11;
     #906#5 = #0#0;
     #906#6 = #905#3;
     #906#7 = #904#2;
     |LEE 101#906=;
     |SI FSalida ! 0; |GRABA 020#906b; |FINSI;
     #906#8 = #904#3;
     #906#9 = #906#9 + nUni;
     #906#10 = #19#9;
     |GRABA 020#906a;
     |LIBERA #906;
|FPRC;

|PROCESO ActVerArg;
     nPdte = #referen@#6 - #referen@#12;
     |SI nUniAcu > nPdte;
          #referen@#12 = #referen@#12 + nPdte;
          nUniAcu = nUniAcu - nPdte;
          nUni = nPdte;
     |SINO;
          #referen@#12 = #referen@#12 + nUniAcu;
          nUni = nUniAcu;
          nUniAcu = 0;
     |FINSI;
     |GRABA 020#referen@.a;
     |LIBERA #referen@;

     |DDEFECTO #904;
     #904#0 = #905#16;
     #904#1 = #0#10;
     #904#2 = #905#4;
     |LEE 101#904=;
     |SI FSalida ! 0; |GRABA 020#904b; |FINSI;
     #904#12 = #904#12 + nUni;
     #904#13 = #904#13 + nUni;
     |GRABA 020#904a;
     |LIBERA #904;

     |HAZ HistoVer;
     |SI nLinPrime = 0; nLinPrime = #referen@#3; |FINSI;
|FPRC;

|DEFBUCLE ActVerArg;
     #referen@#1005;
     16;
     "T5", #905#1, #905#2, 00000, #905#4, #905#16;
     "T5", #905#1, #905#2, 99999, #905#4, #905#16;
     be;
     NULL, ActVerArg;
|FIN;

|PROCESO ActVertical0;
     #0#11 = #905#1;
     #0#0 = #905#2;
     #0#1 = #905#3;
     |LEE 020#0=;

     |SI nSwAgr = 0;
          #referen@#0 = "T5";
          #referen@#1 = #905#1;
          #referen@#2 = #905#2;
          #referen@#3 = #905#3;
          #referen@#4 = #905#4;
          |LEE 121#referen@.=;
          |SI FSalida = 0;
               #referen@#12 = #referen@#12 + #905#6;
               |GRABA 020#referen@.a;
               |LIBERA #referen@;

               |DDEFECTO #904;
               #904#0 = #905#16;
               #904#1 = #0#10;
               #904#2 = #905#4;
               |LEE 101#904=;
               |SI FSalida ! 0; |GRABA 020#904b; |FINSI;
               #904#12 = #904#12 + #905#6;
               #904#13 = #904#13 + #905#6;
               |GRABA 020#904a;
               |LIBERA #904;

               nUni = #905#6;
               |HAZ HistoVer;
          |FINSI;
     |SINO;
          nLinPrime = 0;
          nUniAcu = #905#6;
          |ABRE #0;
          |BUCLE ActVerArg;
          |CIERRA #0;
          |SI nUniAcu > 0; |Y nLinPrime > 0;
               || Entrada > a Fabricar: resto acumula en la 1§
               #referen@#0 = "T5";
               #referen@#1 = #905#1;
               #referen@#2 = #905#2;
               #referen@#3 = nLinPrime;
               #referen@#4 = #905#4;
               |LEE 121#referen@.=;
               |SI FSalida = 0;
                    #referen@#12 = #referen@#12 + nUniAcu;
                    |GRABA 020#referen@.a;
                    |LIBERA #referen@;
               |FINSI;
               |DDEFECTO #904;
               #904#0 = #905#16;
               #904#1 = #0#10;
               #904#2 = #905#4;
               |LEE 101#904=;
               |SI FSalida ! 0; |GRABA 020#904b; |FINSI;
               #904#12 = #904#12 + nUniAcu;
               #904#13 = #904#13 + nUniAcu;
               |GRABA 020#904a;
               |LIBERA #904;

               nUni = nUniAcu;
               |HAZ HistoVer;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE ActVertical0;
     #905#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, ActVertical0;
|FIN;

|PROCESO ActVertical;
     |DDEF aAlfa;
     aAlfa = aAlfa + "dsm00005";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRET #referen@;
          |ABRE #0;
          |ABRE #74;
          |ABRE #904;
          |ABRE #906;
          |BUCLE ActVertical0;
          |CIERRA #906;
          |CIERRA #904;
          |CIERRA #74;
          |CIERRA #0;
          |CIERRAT #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;
--------------------------------------------------------------------------
|PROCESO tempo044;
    |PRINT;
|FPRC;

|DEFBUCLE tempo044;
     #44#1;
     ;
     INICIO;
     FINAL;
     be;
     NULL,tempo044;
|FIN;

|PROCESO Imprimir;
     |IMPRE 1;
     |SI FSalida ] 0;
          |INFOR "agifa189";
          |SI FSalida = 0;
               |BUCLE tempo044;
          |FINSI;
          |PIEINF;
          |FININF;
     |FINSI;
     |FINIMP;
|FPRC;
ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
|PROCESO RestoComponentes;
     |DDEFECTO #19;
     #19#0 = #52#3;
     |LEE 101#19=;
     |SI FSalida ! 0; |GRABA 020#19b; |FINSI;
     |DDEFECTO #17;
     #17#0 = #52#3;
     #17#1 = #52#5;
     |LEE 101#17=;
     |SI FSalida ! 0; |GRABA 020#17b; |FINSI;
     |SI #19#180 = "S";
          |DDEFECTO #24;
          #24#0 = #52#3;
          #24#1 = #52#5;
          #24#2 = #52#8;
          |LEE 101#24=;
          |SI FSalida ! 0; |GRABA 020#24b; |FINSI;
     |FINSI;
     nUni1 = #52#4 - #52#7;
     nUni2 = #52#9 - #52#10;

     #19#104 = #19#104 + nUni1;    || Dispo
     #19#193 = #19#193 + nUni2;

     #17#39 = #17#39 + nUni1;      ||Disp
     #17#48 = #17#48 - nUni2;

     #19#12 = #19#12 - nUni1;      ||Res
     #17#8 = #17#8 - nUni1;        ||Res

     |SI #17#5 < 0;
          |BLANCO 13251760;
          |CUADRO 13251760;
          |PUSHV 0501 2380;
          |ATRI R;
          |PINTA 1326, " FALTA MATERIA                    ";
          |ATRI I;
          aAlfa = "Escandallo:" + #0#2;
          |PINTA 1427, aAlfa;
          aAlfa = "Componente:" + #19#0;
          |PINTA 1527, aAlfa;
          |ATRI S;
          aAlfa = " Stock    = " + #17#5;
          |PINTA 1627, aAlfa;
          |PAUSA;
          |ATRI 0;
          |POPV;
     |FINSI;

     |HAZ ValoraStock;
     |GRABA 020#19a;
     |GRABA 020#17a;
     |LIBERA #17;
     |LIBERA #19;
     |SI #19#180 = "S";
          |GRABA 020#24a;
          |LIBERA #24;
     |FINSI;
|FPRC;

|DEFBUCLE RestoComponentes;
     #52#1;
     ;
     #90#20, #90#0,   1,    1;
     #90#20, #90#0, 999, 9999;
     ;
     NULL, RestoComponentes;
|FIN;

|PROCESO HistoCompo;
     |DDEFECTO #65;
     #65#0 = #52#3;
     #65#1 = #0#9;
     #65#2 = "SF";
     #65#3 = #52#0;
     aAlfa = (("00" + #52#1) % -102) + (("000" + #52#2) % -103);
     #65#4 = aAlfa;
     #65#11 = #52#6;
     |LEE 101#65=;
     |SI FSalida = 0;
          |BORRA 020#65a;     || modificado para inforpor
          #65#6 = #65#6 - nUni1;
          #65#17 = #65#17 - nUni2;
          ||GRABA 101#65a;    modificado para inforpor
          |GRABA 020#65n;
     |SINO;
          #65#5 = #44#6;
          #65#6 = -nUni1;
          #65#7 = #19#6;
          #65#8 = #19#9;
          #65#9 = #44#7;
          #65#10 = aPrv;

          #65#14 = #65#9;
          #65#18 = #44#11;
          #65#17 = -nUni2;
          #65#20 = #19#207;
          |GRABA 121#65n;
     |FINSI;
     |LIBERA #65;
|FPRC;

|PROCESO CompruFab;
     |SI nSwGestral = 0;
          |SI #74#4 > #74#5; |O #74#13 > #74#14;
               aFin = "N";
               |ERROR10;
          |FINSI;
     |SINO;
          |SI #74#4 > #74#5;
               aFin = "N";
               |ERROR10;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO UltLin52;
     |SALVA_FICHA #52;
     #52#6 = #44#8;
     #52#0 = #44#0;
     #52#1 = #44#1;
     #52#2 = 999;
     |LEE 000#52];
     |SI FSalida = 0;
          |LEE 000#52a;
     |SINO;
          |LEE 000#52u;
     |FINSI;
     |SI FSalida = 0; |Y #52#6 = #44#8; |Y #52#0 = #44#0; |Y #52#1 = #44#1;
          nLin = #52#2 + 1;
     |SINO;
          nLin = 1;
     |FINSI;
     |REPON_FICHA #52;
|FPRC;

|PROCESO ActComponentes;
     |DDEFECTO #19;
     #19#0 = #44#3;
     |LEE 101#19=;
     |SI FSalida ! 0; |GRABA 020#19b; |FINSI;
     |DDEFECTO #17;
     #17#0 = #44#3;
     #17#1 = #44#6;
     |LEE 101#17=;
     |SI FSalida ! 0; |GRABA 020#17b; |FINSI;

     aPrv = "";
     |SI #44#14 = "S";
          |DDEFECTO #24;
          #24#0 = #44#3;
          #24#1 = #44#6;
          #24#2 = #44#11;
          |LEE 101#24=;
          |SI FSalida ! 0; |GRABA 020#24b; |FINSI;
          aPrv = #24#3; |QBF aPrv;
     |FINSI;
     |SI aPrv = ""; aPrv = #19#27; |FINSI;

     nUni1 = #44#5;
     nUni2 = #44#10;
     |SI #44#16 = "S";   || Multi
          nUni1 = #44#17;
          nUni2 = 0;
     |FINSI;

     #19#6 = #19#6 - nUni1;        ||Tota
     #19#185 = #19#185 - nUni2;

     #17#5 = #17#5 - nUni1;        ||Tota
     #17#47 = #17#47 - nUni2;

     #19#12 = #19#12 - nUni1;      ||Res
     #17#8 = #17#8 - nUni1;        ||Res

     #24#11 = #24#11 + nUni1;      ||Salida
     #24#12 = #24#12 + nUni2;

     |HAZ ValoraStock;
     |GRABA 020#19a;
     |GRABA 020#17a;
     |LIBERA #17;
     |LIBERA #19;
     |SI #44#14 = "S";
          |GRABA 020#24a;
          |LIBERA #24;
     |FINSI;

     |SELECT #2#52;
     |DDEFECTO #52;
     #52#6 = #44#8;  || Ser
     #52#0 = #44#0;  || Numero
     #52#1 = #44#1;  || Linea
     #52#3 = #44#3;  || Arti
     #52#5 = #44#6;  || Alma
     #52#8 = #44#11; || Parti
     |LEE 101#52=;
     |SI FSalida ! 0;
          |SELECT #1#52;
          |HAZ UltLin52;
          #52#2 = nLin;
          |GRABA 020#52b;
     |FINSI;
     |SI FSalida = 0;
          #52#8 = #44#11;
          #52#7 = #52#7 + nUni1;
          #52#10 = #52#10 + nUni2;
          |GRABA 020#52a;
          |LIBERA #52;
     |FINSI;

     |HAZ HistoCompo;
|FPRC;

|DEFBUCLE ActComponentes;
     #44#1;
     ;
     #0#11, #0#0, #0#1, 1;
     #0#11, #0#0, #0#1, 9999;
     ;
     NULL, ActComponentes;
|FIN;

|PROCESO Historico;
     #148#0 = #74#2;
     |LEE 000#148=;

     |DDEFECTO #65;
     #65#0 = #74#2;
     #65#1 = #0#9;
     #65#2 = "FB";
     #65#3 = #74#0;
     #65#4 = #74#1;
     #65#11 = #74#9;
     |LEE 101#65=;
     |SI FSalida = 0;
          |BORRA 020#65a;
          #65#6 = #65#6 + nUniSto;
          #65#17 = #65#17 + #0#18;
          ||GRABA 101#65a;    modificado para inforpor
          |GRABA 020#65n;
     |SINO;
          #65#5 = #0#10;
          #65#6 = nUniSto;
          #65#7 = #19#6;
          #65#8 = #19#9;
          #65#9 = #148#9;
          || No hace falta segun: Subtiquet nro. 00300.0001 Cliente: 000678
          ||||SI nSwRodacal = 0; #65#9 = #65#9 * #19#4; |FINSI; ||Modulo
          #65#10 = aPrv;
          #65#14 = #65#9;
          #65#17 = #0#18;
          #65#18 = #0#14;
          |GRABA 121#65n;
     |FINSI;
     |LIBERA #65;
|FPRC;

|PROCESO Pcm;
     nImpo = #65#6 * #65#9;
     nUni0 = #65#6;
     nSwPcm = 0;

     |SI nSto > 0; |Y nImpo > 0;
          nSwPcm = 1;
     |SINO;
          |SI #142#148 = "S"; nSwPcm = 1;|FINSI;
     |FINSI;

     |SI nSwPcm = 1;
          |SI nUni0 = 0;
               nPcm = #65#9;
          |SINO;
               nPcm = nUni0 * #65#9;
          |FINSI;
          nPcm = nPcm + nValor;
          nPcm = nPcm / (nSto + nUni0);
     |SINO;
         nPcm = #65#9;
     |FINSI;

     |SI nPcm ! 0;  |Y #142#30 ! "X";
          #19#9 = nPcm;
     |FINSI;
|FPRC;

|PROCESO Actualiza;
     |SI #0#7 = 0; |Y #0#17 = 0;
          |ACABA;
     |FINSI;

     #74#9 = #0#11;
     #74#0 = #0#0;
     #74#1 = #0#1;
     |LEE 121#74=;
     |SI FSalida = 0;
          |DDEFECTO #19;
          #19#0 = #0#2;
          |LEE 101#19=;
          |SI FSalida ! 0; |GRABA 020#19b; |FINSI;
          |HAZ ValoraStock;
          nSto = #19#6;
          nValor = #19#10;
          |DDEFECTO #17;
          #17#0 = #0#2;
          #17#1 = #0#10;
          |LEE 101#17=;
          |SI FSalida ! 0; |GRABA 020#17b; |FINSI;
          |SI #0#15 = "S";
               |DDEFECTO #24;
               #24#0 = #0#2;
               #24#1 = #0#10;
               #24#2 = #0#14;
               |LEE 101#24=;
               |SI FSalida ! 0; |GRABA 020#24b; |FINSI;
               |SI #24#4 = "01.01.0000"; #24#4 = #0#9; |FINSI;
               #24#27 = #0#22;
          |FINSI;
          |SI #0#16 = "S";    || Multi
               nUni = #0#12;
          |SINO;
               nUni = #0#7;
          |FINSI;
          nUn2 = #0#18;
          nUniSto = nUni;
          |SI nSwRodacal = 0;
               nUniSto = nUni/#19#4; || Especial para el modulo
          |FINSI;

          nTota = #0#4 - #0#5 - #0#7;|| Ajuste Fabricadas
          |SI nTota < 0;               || se puede entrar mas de lo ordenado
               nUni = nUni + nTota;    || y el articulo queda negativo en Fab.
          |SINO;
               nTota = 0;
          |FINSI;
          nTota2 = #0#19 - #0#20 - #0#18;|| Ajuste Fabricadas
          |SI nTota < 0;               || se puede entrar mas de lo ordenado
               nUn2 = nUn2 + nTota2;    || y el articulo queda negativo en Fab.
          |SINO;
               nTota2 = 0;
          |FINSI;

          #19#13 = #19#13 - nUni;       ||Fab
          #19#6 =  #19#6 + nUniSto;        ||Tota
          #19#185 = #19#185 + nUn2;
          #19#104 = #19#104 + nUniSto;     ||Dis
          #19#193 = #19#193 + nUn2;

          #17#9 = #17#9 - nUni;         ||Fab
          #17#5 =  #17#5 + nUniSto;        ||Tota
          #17#47 = #17#47 + nUn2;
          #17#39 = #17#39 + nUniSto;       ||Dis
          #17#48 = #17#48 + nUn2;

          #24#9 = #24#9 + nUniSto;
          #24#10 = #24#10 + nUn2;

          |SI #0#17 ! 0; ||Despreciar
               #74#4 = #74#4 - #0#17;
               #19#13 = #19#13 - (#0#17*#0#13);       ||Fab
               #17#9 = #17#9 - (#0#17*#0#13);         ||Fab
               |GRABA 020#74a;
          |FINSI;
          |SI #0#21 ! 0; ||Despreciar
               #74#13 = #74#13 - #0#21;
               |GRABA 020#74a;
          |FINSI;
          |HAZ ValoraStock;
          |GRABA 020#19a;
          |GRABA 020#17a;
          |SI #0#15 = "S";
               |GRABA 020#24a;
               |LIBERA #24;
          |FINSI;
          |SI #0#7 ! 0; |O #0#18 ! 0;
               |HAZ Historico;
               |HAZ Pcm;
               |HAZ ValoraStock;
               |GRABA 020#19a;
               |GRABA 020#17a;
               |BUCLE ActComponentes;
               #74#12 = -nTota;
               #74#16 = -nTota2;
               #74#5 = #74#5 + nUni + #74#12;
               #74#14 = #74#14 + nUn2 + #74#16;

               |SI nSwBerria = 0;
                    #74#10 = #0#14;
               |FINSI;
               |GRABA 020#74a;

               |SI #0#15 = "S";
                    |DDEFECTO #67;
                    #67#0 = #74#9;
                    #67#1 = #74#0
                    #67#2 = #74#1;
                    #67#3 = #0#14;
                    |LEE 101#67=;
                    |SI FSalida ! 0; |GRABA 020#67b; |FINSI;
                    #67#6 = #67#6 + #74#12;
                    #67#4 = #67#4 + nUni + #74#12;
                    |GRABA 020#67a;
                    |LIBERA #67;
               |FINSI;
          |FINSI;
          |LIBERA #17;
          |LIBERA #19;
     |FINSI;
     |LIBERA #74;


     #90#20 = #0#11;
     #90#0 = #0#0;
     |LEE 121#90=;
     |SI FSalida = 0;
          aFin = "S";
          |BUCLELIN 2 CompruFab #90;
          #90#10 = aFin;
          |GRABA 020#90a;
          |LIBERA #90;
          |SI #90#10 = "S";
               |BUCLE RestoComponentes;
          |FINSI;
     |FINSI;

     |SI nSwGrupoSolar = 0; |HAZ GrSolActFab; |FINSI;
     |SI nSwCoimasa = 0; |HAZ CoimaActFab; |FINSI;
|FPRC;

|DEFBUCLE Actualiza;
     #0#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Actualiza;
|FIN;
ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
|PROCESO GrabaComAgr;
     |DDEFECTO #19;
     #19#0 = #44#3;
     |LEE 101#19=;
     |SI FSalida ! 0; |GRABA 020#19b; |FINSI;
     |DDEFECTO #17;
     #17#0 = #44#3;
     #17#1 = #44#6;
     |LEE 101#17=;
     |SI FSalida ! 0; |GRABA 020#17b; |FINSI;
     |SI #44#14 = "S";
          |DDEFECTO #24;
          #24#0 = #44#3;
          #24#1 = #44#6;
          #24#2 = #44#11;
          |LEE 101#24=;
          |SI FSalida ! 0; |GRABA 020#24b; |FINSI;
     |FINSI;
     nUni1 = nUniAcu;

     #19#6 = #19#6 - nUni1;        ||Tota
     #19#185 = #19#185 - nUni2;

     #17#5 = #17#5 - nUni1;        ||Tota
     #17#47 = #17#47 - nUni2;

     #19#12 = #19#12 - nUni1;      ||Res
     #17#8 = #17#8 - nUni1;        ||Res

     #24#11 = #24#11 + nUni1;      ||Salida
     #24#12 = #24#12 + nUni2;

     |HAZ ValoraStock;
     |GRABA 020#19a;
     |GRABA 020#17a;
     |LIBERA #17;
     |LIBERA #19;
     |SI #44#14 = "S";
          |GRABA 020#24a;
          |LIBERA #24;
     |FINSI;

     #52#8 = #44#11;
     #52#7 = #52#7 + nUni1;
     #52#10 = #52#10 + nUni2;
     |GRABA 020#52a;
     |LIBERA #52;

     |HAZ HistoCompo;
|FPRC;

|PROCESO ActCompoAgr;
     |SI #52#7 < #52#4;
          nPdte = #52#4 - #52#7;
          |SI nUniCom > nPdte;
               nUniAcu = nPdte;
          |SINO;
               nUniAcu = nUniCom;
          |FINSI;
          nUniCom = nUniCom - nUniAcu;
          |HAZ GrabaComAgr;
     |FINSI;
     |SI nLinPrime = 0; nLinPrime = #52#1; nLinPrime1 = #52#2; |FINSI;
|FPRC;

|DEFBUCLE ActCompoAgr;
     #52#1;
     11;
     #44#8, #44#0, 001, 001, #44#18;
     #44#8, #44#0, 999, 999, #44#18;
     be;
     NULL, ActCompoAgr;
|FIN;

|PROCESO ActCompoAgr0;
     nLinPrime = 0;
     |SI #44#16 = "S";   || Multi
          nUniCom = #44#17;
     |SINO;
          nUniCom = #44#5;
     |FINSI;
     |SI nUniCom = 0; |ACABA; |FINSI;

     nUni2 = 0;
     |SI nUniCom > 0;
          |BUCLE ActCompoAgr;
     |FINSI;
     |SI nUniCom > 0; |Y nLinPrime > 0;
          |ABRE #52;
          #52#6 = #44#8;
          #52#0 = #44#0;
          #52#1 = nLinPrime;
          #52#2 = nLinPrime1;
          |LEE 121#52=;
          nUniAcu = nUniCom;
          |HAZ GrabaComAgr;
          |CIERRA #52;
     |FINSI;
     |BORRA 020#44a;
|FPRC;

|DEFBUCLE ActCompoAgr0;
     #44#1;
     18;
     #0#11, #0#0, #0#1, 0001, #0#2;
     #0#11, #0#0, #0#1, 9999, #0#2;
     ;
     NULL, ActCompoAgr0;
|FIN;

|PROCESO ActAgrLin;
     |SI #74#5 < #74#4;
          nPdte = #74#4 - #74#5;
          |SI nUniEnt > nPdte;
               nUniAcu = nPdte;
          |SINO;
               nUniAcu = nUniEnt;
          |FINSI;
          nUniEnt = nUniEnt - nUniAcu;
          nUniSto = nUniAcu;

          |DDEFECTO #19;
          #19#0 = #0#2;
          |LEE 101#19=;
          |SI FSalida ! 0; |GRABA 020#19b; |FINSI;
          |HAZ ValoraStock;
          nSto = #19#6;
          nValor = #19#10;
          |DDEFECTO #17;
          #17#0 = #0#2;
          #17#1 = #0#10;
          |LEE 101#17=;
          |SI FSalida ! 0; |GRABA 020#17b; |FINSI;

          aPrv = "";
          |SI #0#15 = "S";
               |DDEFECTO #24;
               #24#0 = #0#2;
               #24#1 = #0#10;
               #24#2 = #0#14;
               |LEE 101#24=;
               |SI FSalida ! 0; |GRABA 020#24b; |FINSI;
               aPrv = #24#3; |QBF aPrv;
          |FINSI;
          |SI aPrv = ""; aPrv = #19#27; |FINSI;

          #19#13 = #19#13 - nUniAcu;       ||Fab
          #19#6 =  #19#6 + nUniAcu;        ||Tota
          #19#185 = #19#185 + #0#18;
          #19#104 = #19#104 + nUniAcu;     ||Dis
          #19#193 = #19#193 + #0#18;

          #17#9 = #17#9 - nUniAcu;         ||Fab
          #17#5 =  #17#5 + nUniAcu;        ||Tota
          #17#47 = #17#47 + #0#18;
          #17#39 = #17#39 + nUniAcu;       ||Dis
          #17#48 = #17#48 + #0#18;

          #24#9 = #24#9 + nUniAcu;
          #24#10 = #24#10 + #0#18;
          |HAZ ValoraStock;
          |GRABA 020#19a;
          |GRABA 020#17a;
          |SI #0#15 = "S";
               |GRABA 020#24a;
               |LIBERA #24;
          |FINSI;
          |SI nUniAcu ! 0;
               |HAZ Historico;
               |HAZ Pcm;
               |HAZ ValoraStock;
               |GRABA 020#19a;
               |GRABA 020#17a;
               #74#12 = 0;
               #74#5 = #74#5 + nUniAcu;
               |GRABA 020#74a;
               |BUCLE ActCompoAgr0;

               |SI #0#15 = "S";
                    |DDEFECTO #67;
                    #67#0 = #74#9;
                    #67#1 = #74#0
                    #67#2 = #74#1;
                    #67#3 = #0#14;
                    |LEE 101#67=;
                    |SI FSalida ! 0; |GRABA 020#67b; |FINSI;
                    #67#4 = #67#4 + nUniAcu;
                    |GRABA 020#67a;
                    |LIBERA #67;
               |FINSI;
          |FINSI;
          |LIBERA #17;
          |LIBERA #19;
     |FINSI;
     |LIBERA #74;
     |SI nLinPrime = 0; nLinPrime = #74#1; |FINSI;
|FPRC;

|DEFBUCLE ActAgrLin;
     #74#1;
     2;
     #0#11, #0#0, 001, #0#2;
     #0#11, #0#0, 999, #0#2;
     be;
     NULL, ActAgrLin;
|FIN;

|PROCESO ActAgrLinDes;
     nPdte = #74#4 - #74#5;
     nPdte2 = #74#13 - #74#14;

     |DDEFECTO #19;
     #19#0 = #0#2;
     |LEE 101#19=;
     |SI FSalida ! 0; |GRABA 020#19b; |FINSI;
     |DDEFECTO #17;
     #17#0 = #0#2;
     #17#1 = #0#10;
     |LEE 101#17=;
     |SI FSalida ! 0; |GRABA 020#17b; |FINSI;

     #19#13 = #19#13 - nPdte;       ||Fab
     #17#9 = #17#9 - nPdte;         ||Fab
     #74#4 = #74#4 - nPdte;
     #74#13 = #74#13 - nPdte;
     |GRABA 020#74a;

     |HAZ ValoraStock;
     |GRABA 020#19a;
     |GRABA 020#17a;
     |GRABA 020#74a;
     |SI nLinPrime = 0; nLinPrime = #74#1; |FINSI;
|FPRC;

|DEFBUCLE ActAgrLinDes;
     #74#1;
     2;
     #0#11, #0#0, 001, #0#2;
     #0#11, #0#0, 999, #0#2;
     be;
     NULL, ActAgrLinDes;
|FIN;

|PROCESO ActAgr;
     |SI #0#16 = "S";    || Multi
          nUniEnt = #0#12;
     |SINO;
          nUniEnt = #0#7;
     |FINSI;
     nLinPrime = 0;
     |SI nUniEnt > 0;
          |BUCLE ActAgrLin;
     |FINSI;
     |SI nUniEnt > 0; |Y nLinPrime > 0;
          || Entrada > a Fabricar: resto acumula en la 1§
          |ABRE #74;
          #74#9 = #0#11;
          #74#0 = #0#0;
          #74#1 = nLinPrime;
          |LEE 121#74=;
          |SI FSalida = 0;
               |DDEFECTO #19;
               #19#0 = #0#2;
               |LEE 101#19=;
               |SI FSalida ! 0; |GRABA 020#19b; |FINSI;
               |HAZ ValoraStock;
               nSto = #19#6;
               nValor = #19#10;
               |DDEFECTO #17;
               #17#0 = #0#2;
               #17#1 = #0#10;
               |LEE 101#17=;
               |SI FSalida ! 0; |GRABA 020#17b; |FINSI;
               |SI #0#15 = "S";
                    |DDEFECTO #24;
                    #24#0 = #0#2;
                    #24#1 = #0#10;
                    #24#2 = #0#14;
                    |LEE 101#24=;
                    |SI FSalida ! 0; |GRABA 020#24b; |FINSI;
               |FINSI;

               nUniAcu = nUniEnt;
               nUniSto = nUniAcu;

               |SI nSwRodacal = 0;
                    nUniAcu = nUniAcu / #19#4; || Especial para el modulo
               |FINSI;

               #19#6 =  #19#6 + nUniAcu;        ||Tota
               #19#185 = #19#185 + #0#18;
               #19#104 = #19#104 + nUniAcu;     ||Dis
               #19#193 = #19#193 + #0#18;

               #17#5 =  #17#5 + nUniAcu;        ||Tota
               #17#47 = #17#47 + #0#18;
               #17#39 = #17#39 + nUniAcu;       ||Dis
               #17#48 = #17#48 + #0#18;

               #24#9 = #24#9 + nUniAcu;
               #24#10 = #24#10 + #0#18;

               |HAZ ValoraStock;
               |GRABA 020#19a;
               |GRABA 020#17a;
               |SI #0#15 = "S";
                    |GRABA 020#24a;
                    |LIBERA #24;
               |FINSI;
               |SI nUniAcu ! 0;
                    |HAZ Historico;
                    |HAZ Pcm;
                    |HAZ ValoraStock;
                    |GRABA 020#19a;
                    |GRABA 020#17a;
                    #74#12 = nUniAcu;
                    #74#5 = #74#5 + nUniAcu;
                    |GRABA 020#74a;
                    |BUCLE ActComponentes;

                    |SI #0#15 = "S";
                         |DDEFECTO #67;
                         #67#0 = #74#9;
                         #67#1 = #74#0
                         #67#2 = #74#1;
                         #67#3 = #0#14;
                         |LEE 101#67=;
                         |SI FSalida ! 0; |GRABA 020#67b; |FINSI;
                         #67#6 = #67#6 + nUniAcu;
                         #67#4 = #67#4 + nUniAcu;
                         |GRABA 020#67a;
                         |LIBERA #67;
                    |FINSI;
               |FINSI;
               |LIBERA #17;
               |LIBERA #19;
          |FINSI;
          |CIERRA #74;
     |FINSI;

     |SI #0#16 = "S";
          nUniDes = #0#17 * #0#13;
     |SINO;
          nUniDes = #0#17;
     |FINSI;
     |SI nUniDes > 0;
          |BUCLE ActAgrLinDes;
     |FINSI;

     #90#20 = #0#11;
     #90#0 = #0#0;
     |LEE 121#90=;
     |SI FSalida = 0;
          aFin = "S";
          |BUCLELIN 2 CompruFab #90;
          #90#10 = aFin;
          |GRABA 020#90a;
          |LIBERA #90;
          |SI #90#10 = "S";
               |BUCLE RestoComponentes;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE ActAgr;
     #0#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, ActAgr;
|FIN;
ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
|PROCESO RelleParti44; |TIPO 6;
     |SI #44#14 = "S";
          |SI #142#243 = "N";
               aAlfa = #44#11; |QBF aAlfa;
               |SI aAlfa = "";
                    |MENAV "0000Partida blanco no permitida...";
                    |ERROR; |ACABA;
               |FINSI;
          |FINSI;
          |SI #142#122 = "S";
               aAlfa = #44#11; |QBF aAlfa;
               aAlfa = (#142#121 * #142#120) + aAlfa;;
               nLong = -(100 + #142#120);
               #44#11 = aAlfa % nLong;
               |PINTA #44#11;
          |FINSI;
     |FINSI;
     |SI FSalida = 9;
          eaArticulo = #44#3;
          enAlmacen = #44#6;
          efFecha = #0#9;
          |HAZ ConsultaPartida;
          |SI eaPartida = "";
               |ERROR;
          |SINO;
               #44#11 = eaPartida;
               |PINTA #44#11;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Tipo0_44; |TIPO 0;
     |SI #44#15 = "S"; || Doble
          #44#10 = #44#5 * #44#13;
          |PINTA #44#10;
     |FINSI;
     |SI #44#16 = "S"; || Multi
          #44#17 = #44#5 * #44#12;
     |FINSI;
|FPRC;

|PROCESO Tipo7_44; |TIPO 7;
     aAlfa = #44#14;
     |C_M #44#11, 1, aAlfa;
     aAlfa = #44#15;
     |C_M #44#10, 1, aAlfa;
     |SI #44#14 = "S";            || Partida
          |MODO_RELACION #44, 3, "dsm00024", "S", "S";
     |SINO;
          |MODO_RELACION #44, 3, "dsm00024", "N", "N";
     |FINSI;
|FPRC;

|PROCESO Defecto_44; |TIPO 0;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo ! 1; |ACABA; |FINSI;
     |ABRE #19;
     #19#0 = #44#3;
     |LEE 020#19=;
     |CIERRA #19;
     |ABRE #49; |SELECT #2#49;
     |DDEFECTO #49;
     #49#2 = #44#3;
     #49#0 = #0#2;
     |LEE 000#49=;
     |SI FSalida = 0;
          #44#7 = #49#5;    || Precio
     |SINO;
          #44#7 = #19#9;
     |FINSI;
     |CIERRA #49;
     #44#14 = #19#180; || Parti s/n
     #44#15 = #19#179; || Doble s/n
     #44#16 = #19#204; || Multi s/n

     |SI #44#15 = "S";
          |HAZ FactorDoble;
          #44#13 = nFactor;
     |FINSI;

     |SI #44#16 = "S";
          |HAZ FactorMulti;
          #44#12 = nFactor;
     |FINSI;
     #44#18 = #0#2;
     |HAZ Tipo7_44;
|FPRC;

|PROCESO Min44;
     #44#8 = #0#11;
     #44#0 = #0#0;
     #44#1 = #0#1;
     #44#2 = 1;
|FPRC;

|PROCESO Max44;
     #44#8 = #0#11;
     #44#0 = #0#0;
     #44#1 = #0#1;
     #44#2 = 9999;
|FPRC;

|PROCESO BuscaPartida;
     |SI #142#122 = "S";
          aParti = #142#121 * #142#120;
          aParti = (aParti + "1") % -115;
     |FINSI;

     |ABRE #24; |SELECT #2#24;
     #24#27 = "01.01.0000";
     #24#0 = #19#0;
     #24#1 = #44#6;
     |LEE 000#24];
     |PARA; |SI FSalida = 0; |Y #24#0 = #19#0; |Y #24#1 = #44#6; |HACIENDO;
          |SI #24#23 > 0;       ||ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ Hay Stock
               aParti = #24#2;
               |SAL;
          |FINSI;
          |LEE 000#24s;
     |SIGUE;
     |CIERRA #24;
|FPRC;

|PROCESO FactorMulti;
     |ABRE #241; |SELECT #2#241;
     |DDEFECTO #241;
     #241#0 = #19#5;
     #241#2 = #19#207;
     |LEE 000#241=;
     |CIERRA #241;
     |SI #241#6 = "D";
          nFactor = 1 * #241#5;
     |SINO;
          nFactor = 1 / #241#5;
     |FINSI;
|FPRC;

|PROCESO FactorDoble;
     |ABRE #238;
     |DDEFECTO #238;
     #238#0 = #19#201;
     |LEE 000#238=;
     |CIERRA #238;
     nFactor = 1;
     |SI #238#8 ] 1; nFactor = #238#9; |FINSI;
     |SI #238#8 ] 2; nFactor = nFactor * #238#10; |FINSI;
     |SI #238#8 = 3; nFactor = nFactor * #238#11; |FINSI;
|FPRC;

|PROCESO dsm00052;
     #19#0 = #52#3;
     |LEE 020#19=;

     |DDEFECTO #44;
     #44#8 = #0#11; || #52#6;
     #44#0 = #0#0;  || #52#0;
     #44#1 = #0#1;  || #52#1;
     #44#2 = #52#2;
     |LEE 101#44=;
     |SI FSalida ! 0; |GRABA 020#44b; |FINSI;

     #44#3 = #52#3;
     #44#18 = #52#11;
     aAlfa = #44#18; |QBF aAlfa;           ||Para que no de error
     |SI aAlfa = ""; #44#18 = #0#2;|FINSI; ||antes no existia #52#11

     #44#4 = #44#4 + ((#52#4 * #0#7) / #0#4);
     #44#5 = #44#4 > #0#8;

     #44#9 = #44#9 + ((#52#9 * #0#7) / #0#4);
     #44#10 = #44#9 > #0#8;

     #44#6 = #52#5; ||Almacen

     |DDEFECTO #49;
     #49#2 = #44#3;
     #49#0 = #44#18;
     |LEE 000#49=;
     |SI FSalida = 0;
          #44#7 = #49#5;    || Precio
     |SINO;
          #44#7 = #19#9;
     |FINSI;

     #44#14 = #19#180; || Parti s/n
     #44#15 = #19#179; || Doble s/n
     #44#16 = #19#204; || Multi s/n

/*
     |SI #44#14 = "S";
          |HAZ BuscaPartida;
          #44#11 = aParti;
     |FINSI;
*/
     #44#11 = #52#8;

     |SI #44#15 = "S";
          |HAZ FactorDoble;
          #44#13 = nFactor;
     |FINSI;

     |SI #44#16 = "S";
          |HAZ FactorMulti;
          #44#12 = nFactor;
          #44#17 = #44#5;
          #44#5 = #44#5 / nFactor;
          #44#4 = #44#4 / nFactor;
     |FINSI;
     #44#19 = #19#1;
     |GRABA 020#44a;
     |LIBERA #44;
|FPRC;

|DEFBUCLE dsm00052;
     #52#1;
     ;
     #0#11, #0#0, nLin, 001;
     #0#11, #0#0, nLin, 999;
     ;
     NULL, dsm00052;
|FIN;

|PROCESO LinOrdenArti;
     nLin = #74#1;
     |BUCLE dsm00052;
|FPRC;

|DEFBUCLE LinOrdenArti;
     #74#1;
     2;
     #0#11, #0#0, 001, #0#2;
     #0#11, #0#0, 999, #0#2;
     ;
     NULL, LinOrdenArti;
|FIN;

|PROCESO Componentes;
     |ABRE #49; |SELECT #2#49;
     |ABRE #44;
     |ABRE #19;
     #44#8 = #0#11;
     #44#0 = #0#0;
     #44#1 = #0#1;
     #44#2 = 0;
     |LEE 000#44];
     |SI FSalida ! 0; |O #44#8 ! #0#11; |O #44#0 ! #0#0; |O #44#1 ! #0#1;
          |SI nSwAgr = 1;
               |BUCLE LinOrdenArti;
          |SINO;
               nLin = #0#1;
               |BUCLE dsm00052;
          |FINSI;
     |FINSI;
     |CIERRA #19;
     |CIERRA #44;
     |CIERRA #49;

     |SI menu2 ! 5; |Y #0#7 ! 0;          ||Simple
          |PUSHV 0501 2380;
          |ENTLINEAL #1#44 , -4 , 2 , 22 , 1 , Min44, Max44;
          |POPV;

          |HAZ EsBsegui;
          |SI FSalida = 0;
               |HAZ Imprimir;
          |FINSI;
     |FINSI;

     || para este cliente se muestra el desglose tambien para el simple
     |SI nSwGesisat = 0; |Y menu2 = 5; |Y #0#7 ! 0;
          |PUSHV 0501 2380;
          |ENTLINEAL #1#44 , -4 , 2 , 22 , 1 , Min44, Max44;
          |POPV;
     |FINSI;


     |SI nSwDefelino = 0;
          enUniDefe = #0#7;
          aAlfa = "defelw05;ENT"+#0#11+(("000000"+#0#0)%-106)+(("000"+#0#1)%-103)+#0#2+#0#9+aTmpDefe;
          |SUB_EJECUTA_NP aAlfa;
     |FINSI;
|FPRC;

|PROCESO BorraComponentes;
     |ABRE #44;
     #44#8 = #0#11;
     #44#0 = #0#0;
     #44#1 = #0#1;
     #44#2 = 0;
     |LEE 000#44];
     |PARA; |SI FSalida = 0; |Y #44#8 = #0#11; |Y #44#0 = #0#0;
               |Y #44#1 = #0#1; |HACIENDO;
          |BORRA 020#44a;
          |LEE 000#44s;
     |SIGUE;
     |CIERRA #44;
|FPRC;
ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
|PROCESO CheqManual;
     aAlfa = #0#14; |QBF aAlfa;

     |SI Campo = 14; |Y #0#15 = "S";
          |SI #0Campo ! Contenido; |O aAlfa = "";
               |ABRE #24;
               #24#0 = #0#2;
               #24#1 = #0#10;
               #24#2 = #0#14;
               |LEE 000#24=;
               |SI FSalida = 0;
                    #0#22 = #24#27; |PINTA #0#22;
               |SINO;
                    #0#22 = ~; |PINTA #0#22;
               |FINSI;
               |CIERRA #24;
          |FINSI;
     |FINSI;

     |SI menu2 ! 4; |ACABA; |FINSI;

     |SI Campo = 7; |Y #0Campo ! Contenido;
          nTota = #0#4 - #0#5 - #0#7;
          |SI nTota < 0;
               nTota = -nTota;
               aAlfa = "0000NSe supera en: " + nTota +&13+"Continuar:";
               |CONFI aAlfa;
               |SI FSalida = 0;
                    #0#17 = 0; |PINTA #0#17;
               |SINO;
                    |ERROR;
               |FINSI;
          |FINSI;
     |FINSI;

     |SI Campo = 14;
          nNume = #0#4 - #0#5 - #0#7;
          |SI nNume > 0;
               |AVISO;
               aAlfa = "unidades";
               |SI #19#179 = "S"; aAlfa = #238#3; |QBF aAlfa; |FINSI;
               aAlfa = "0000NDespreciar resto de " + aAlfa + ":" + nNume;
               |CONFI aAlfa;
               |SI FSalida = 0;
                    #0#17 = #0#4 - #0#5 - #0#7;
               |SINO;
                    #0#17 = 0;
               |FINSI;
               |PINTA #0#17;
          |FINSI;
          |SI nSwGestral = 0;
               nNume = #0#19 - #0#20 - #0#18;
               |SI nNume > 0;
                    aAlfa = #238#2; |QBF aAlfa;
                    aAlfa = "0000NDespreciar resto de " + aAlfa +":" + nNume;
                    |CONFI aAlfa;
                    |SI FSalida = 0;
                         #0#21 = #0#19 - #0#20 - #0#18;
                    |SINO;
                         #0#21 = 0;
                    |FINSI;
               |FINSI;
          |FINSI;
          |GRABA 020#0a;
          |HAZ Componentes;

     |FINSI;
|FPRC;

|PROCESO UniEnt2; |TIPO 7;
     |SI nSwGestral = 0;
          |SI #0#7 = 0; |Y #0#18 = 0;
               nNume = #0#19 - #0#20;
               |SI nNume > 0; #0#18 = nNume; |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Unidad2; |TIPO 0;
     |SI FSalida = 2; |ACABA; |FINSI;
     |C_M #0#18, 0, aAlfa;
     |SI nSwGestral = 0; |Y aAlfa = "S";
          enUniGestral = #0#18;
          enAlmacen = #0#10
          aAlfa = "gestrw01;"+#0#11+(("000000"+#0#0)%-106)+(("000"+#0#1)%-103)+aTmpGestral;
          |SUB_EJECUTA_NP aAlfa;
          #0#18 = enUniGestral; |PINTA #0#18;
          #0#7 = enMtsGestral; |PINTA #0#7;
     |FINSI;
|FPRC;

|PROCESO UniMulti; |TIPO 0;
     #0#12 = #0#7 / #0#13;
|FPRC;

|PROCESO RellenaParti; |TIPO 6;
     |SI #0#15 = "S";
          |SI #142#244 = "N";
               aAlfa = #0#14; |QBF aAlfa;
               |SI aAlfa = "";
                    |MENAV "0000Partida blanco no permitida...";
                    |ERROR; |ACABA;
               |FINSI;
          |FINSI;

          |SI #142#122 = "S";
               aAlfa = #0#14; |QBF aAlfa;
               aAlfa = (#142#121 * #142#120) + aAlfa;;
               nLong = -(100 + #142#120);
               #0#14 = aAlfa % nLong;
               |PINTA #0#14;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO PintaModi; |TIPO 7;
     |ABRE #19;
     #19#0 = #0#2;
     |LEE 000#19=;
     |CIERRA #19;

     #0#15 = #19#180;
     #0#16 = #19#204;

     |SI #0#15 = "S";            || Partida
          |C_M #0#14, 1, "S"; |PINTA #0#14;
          |C_M #0#22, 1, "S"; |PINTA #0#14;
          |MODO_RELACION #0, 1, "dsm00024", "S", "S";
     |SINO;
          |C_M #0#14, 1, "N";
          |C_M #0#22, 1, "N";
          |MODO_RELACION #0, 1, "dsm00024", "N", "N";
     |FINSI;

     |SI #19#179 = "S";
          |ABRE #238;
          #238#0 = #19#201;
          |LEE 000#238=;
          |CIERRA #238;
          |C_A #238#3, 1, 10;
          |C_A #238#2, 1, 10;
          aAlfa = #238#3; |QBF aAlfa;
          aAlfa = (aAlfa + "..........") % 110; aAlfa = "³" + aAlfa;
          |PINTA 1147, aAlfa;
          aAlfa = #238#2; |QBF aAlfa;
          aAlfa = (aAlfa + "..........") % 110; aAlfa = "³" + aAlfa;
          |PINTA 1247, aAlfa;
          |C_V #0#18, 1, "S";
          |PINTA #0#18;
     |SINO;
          |PINTA 1147, "³Unidades.. ";
          |PINTA 1247, "³                           ";
          |C_V #0#18, 1, "N";
     |FINSI;
|FPRC;

|PROCESO Unidad7; |TIPO 7;
     |SI menu2 = 4; |Y #0Campo = Contenido;
          |SI nSwGrupoSolar = 0; |HAZ GrSolFabrica; |FINSI;
     |FINSI;
     |ABRE #19;
     #19#0 = #0#2;
     |LEE 000#19=;
     |CIERRA #19;
     |SI #19#176 = "S";
          |C_M #0#7, 1, "N";
          eaTipo      = "T6";
          eaSerie     = #0#11;
          enCodigo    = #0#0;
          enLinea     = #0#1;
          eaArticulo  = #0#2;
          enAlmacen   = #0#10;
          enUnidades  = #0#7;
          efFecha     = #0#9;
          eaFicVertical = aTempo905;
          |SI nSwAgr = 1; eaTipo = "T66"; |FINSI;
          |SUB_EJECUTA_NP "dsz00002";
          #0#10 = enAlmacen; |PINTA #0#10;
          #0#7 = enUnidades; |PINTA #0#7;
     |SINO;
          |C_M #0#7, 1, "S";
          |SI nSwGestral = 0; |Y  #19#179 = "S";
               |C_M #0#7, 1, "N";
               |C_M #0#14, 1, "N";
               |C_M #0#22, 1, "N";
               |MODO_RELACION #0, 1, "dsm00024", "N", "N";
               #0#15 = "N";
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Linea; |TIPO 0;
     |SI nSwCoimasa = 0; |Y menu2 = 4;  || Entrada manual
          |ABRE #74;
          #74#9 = #0#11;
          #74#0 = #0#0;
          #74#1 = #0#1;
          |SI FSalida = 0;
               #0#2 = #74#2;
               |HAZ CoimaCheq;
               |SI nError = 1; |ERROR; |ACABA; |FINSI;
          |FINSI;
          |CIERRA #74;
     |FINSI;
|FPRC;

|PROCESO Tecla; |TIPO 6;
     |SI nSwCoimasa = 0; |Y #0#0 ! 0;
          nError = 0;
          |SI menu2 ! 4;
               |HAZ CoimaCheq;
          |FINSI;
          |SI nError = 1; |ERROR; |ACABA; |FINSI;
     |FINSI;

     |SI menu2 = 4; |O #0#0 = 0; |ACABA; |FINSI;   || Manual

     |SI #0Campo = Contenido;
        |ET Otra00;
           |ENCAMPO #9#0;
           |SI FSalida = 7; |VETE Fin; |FINSI;
           |SI FSalida = 3; FSalida = 0; |FINSI;
           |SI FSalida = 2; |VETE Otra00; |FINSI;
        |ET Otra;
           nAntes = #0#7; nAntes2 = #0#18;

           |SI nSwGrupoSolar = 0; |HAZ GrSolFabrica; |FINSI;

           |ENCAMPO #7#0;
           |SI FSalida = 7; |VETE Fin; |FINSI;
           |SI FSalida = 3; FSalida = 0; |FINSI;
           |SI FSalida = 2; |VETE Otra00; |FINSI;
           |SI FSalida = 0; |O nAntes ! #0#7;
               |C_M #0#7, 0, aAlfa;
               |SI aAlfa = "S";
                    nTota = #0#4 - #0#5 - #0#7;
                    |SI nTota < 0;
                         nTota = -nTota;
                         aAlfa = "0000NSe supera en: " + nTota +&13+"Continuar:";
                         |CONFI aAlfa;
                         |SI FSalida = 0;
                              #0#17 = 0; |PINTA #0#17;
                         |SINO;
                              |VETE Otra;
                         |FINSI;
                    |FINSI;
               |FINSI;
            |ET Otra01;
               |ENCAMPO #18#0;
               |SI FSalida = 7; |VETE Fin; |FINSI;
               |SI FSalida = 3; FSalida = 0; |FINSI;
               |SI FSalida = 2; |VETE Otra; |FINSI;
            |ET Otra1;
               |ENCAMPO #8#0;
               |SI FSalida = 7; |VETE Fin; |FINSI;
               |SI FSalida = 3; FSalida = 0; |FINSI;
               |SI FSalida = 2;
                    |C_V #0#18, 0, aAlfa;
                    |SI aAlfa = "S";
                         |VETE Otra01;
                    |SINO;
                         |VETE Otra;
                    |FINSI;
               |FINSI;
            |ET Otra3;
               |ENCAMPO #14#0;
               |SI FSalida = 7; |VETE Fin; |FINSI;
               |SI FSalida = 3; FSalida = 0; |FINSI;
               |SI FSalida = 2; |VETE Otra1; |FINSI;

               |ENCAMPO #22#0;
               |SI FSalida = 7; |VETE Fin; |FINSI;
               |SI FSalida = 3; FSalida = 0; |FINSI;
               |SI FSalida = 2; |VETE Otra3; |FINSI;

            |ET Otra4;
               |SI FSalida = 0;
                    nNume = #0#4 - #0#5 - #0#7;
                    |SI nNume > 0;
                         |AVISO;
                         aAlfa = "unidades";
                         |SI #19#179 = "S"; aAlfa = #238#3; |QBF aAlfa; |FINSI;
                         aAlfa = "0000NDespreciar resto de " + aAlfa + ":" + nNume;
                         |CONFI aAlfa;
                         |SI FSalida = 0;
                              #0#17 = #0#4 - #0#5 - #0#7;
                         |SINO;
                              #0#17 = 0;
                         |FINSI;
                         |PINTA #0#17;
                    |FINSI;
                    |SI nSwGestral = 0;
                         nNume = #0#19 - #0#20 - #0#18;
                         |SI nNume > 0;
                              aAlfa = #238#2; |QBF aAlfa;
                              aAlfa = "0000NDespreciar resto de " + aAlfa +":" + nNume;
                              |CONFI aAlfa;
                              |SI FSalida = 0;
                                   #0#21 = #0#19 - #0#20 - #0#18;
                              |SINO;
                                   #0#21 = 0;
                              |FINSI;
                         |FINSI;
                    |FINSI;
                    |GRABA 020#0a;
                    |SI nAntes ! #0#7; |O nAntes2 ! #0#18;
                         |HAZ BorraComponentes;
                    |FINSI;
                    |HAZ Componentes;
               |SINO;
                    |MENAV "0000Anulado...";
               |FINSI;
          |SINO;
               |SI #0#7 ! 0;
                    |MENAV "0000Anulado...";
               |FINSI;
          |FINSI;
          |PINTA #0#7;
          |PINTA #0#8;
          |PINTA #0#9;
          |PINTA #0#14;
     |FINSI;
  |ET Fin;
|FPRC;
ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
|PROCESO Min0;
     #0#11 = "     ";
     #0#0 = 0;
     #0#1 = 1;
     #0#2 = " " * 20;
     #0#6 = "01.01.0000";
|FPRC;

|PROCESO Max0;
     #0#11 = "zzzzz";
     #0#0 = 999999;
     #0#1 = 999;
     #0#2 = "z" * 20;
     #0#6 = "31.12.9999";
|FPRC;

|PROCESO agifa074;
     |SI #74#2 < aDesdeEsc; |O #74#2 > aHastaEsc;
          |ACABA;
     |FINSI;
     |SI #74#5 ] #74#4;
          |ACABA;
     |FINSI;

     |DDEFECTO #19;
     #19#0 = #74#2;
     |LEE 000#19=;

     |DDEFECTO #0;
     #0#11 = #74#9;
     #0#0 = #74#0;
     #0#1 = #74#1;
     #0#2 = #74#2;
     |LEE 000#0=;
     |SI FSalida ! 0; |GRABA 020#0b; |FINSI;
     #0#3 = #74#3;
     #0#4 = #0#4 + #74#4;     ||fabricar
     #0#5 = #0#5 + #74#5;     ||fabricado
     #0#6 = #90#2;
     |SI nSwGestral = 0;
          |HAZ GesAlma;
          #0#10 = nGesAlma;
     |SINO;
          #0#10 = #74#7;
     |FINSI;
     #0#14 = #74#10;
     #0#15 = #19#180;
     #0#16 = #19#204;
     |SI #0#16 = "S";
          |HAZ FactorMulti;
          #0#12 = #0#7;
          #0#7 = #0#7 * nFactor;
          #0#13 = nFactor;
     |FINSI;
     #0#19 = #0#19 + #74#13;
     #0#20 = #0#20 + #74#14;
     |GRABA 020#0a;
     |LIBERA #0;
|FPRC;

|DEFBUCLE agifa090;
     #90#2;
     10;
     fDesdeFecha, aDesdeSer, nDesdeOrden, "N";
     fHastaFecha, aHastaSer, nHastaOrden, "N";
     ;
     NULL, NULL, agifa074;
|FIN;

|PROCESO Agrupa;
     nSwAgr = 1;
     |DELINDEX #0;
     |ABRE #19;
     |ABRE #238;
     |ABRE #0;
     |SELECT #5#0;
     |BUCLE agifa090;
     |CIERRA #0;
     |CIERRA #238;
     |CIERRA #19;
|FPRC;

|PROGRAMA;
     aParam = PARAMETRO; |QBF aParam;

     |HAZ EsBsegui;
     |SI FSalida = 0;
          |SUB_EJECUTA_NP "bsez0003;NOMEQUITES";
     |FINSI;

     |HAZ EsRodacal; nSwRodacal = FSalida;
     |HAZ EsGrupoSolar; nSwGrupoSolar = FSalida;
     |HAZ EsCoimasa; nSwCoimasa = FSalida;
     |HAZ EsBerria; nSwBerria = FSalida;
     |HAZ EsDefelino; nSwDefelino = FSalida;
     |HAZ EsGestral; nSwGestral = FSalida;
     |HAZ EsGesisat; nSwGesisat = FSalida;

     |ABRE #142; |LEE 000#142p; |CIERRA #142;
     |ABRE #910; |LEE 000#910p; |CIERRA #910;
     nDeci_Uni = #142#8;

     |HAZ CreaTempo; aTempo0 = Tempo; |NOME_DAT #0 aTempo0; |DELINDEX #0;
     |HAZ CreaTempo; aTempo44 = Tempo; |NOME_DAT #44 aTempo44; |DELINDEX #44;
     |HAZ CreaTempo; aTempo905 = Tempo; |NOME_DAT #905 aTempo905; |DELINDEX #905;
     |HAZ CreaTempo; aTmpDefe = Tempo;
     |SI nSwGestral = 0;
          |DDEF aAlfa; aAlfa = aAlfa + "gestrw01";
          |CARGA_DEF aAlfa, gestrw01@;
          |HAZ CreaTempo; aTmpGestral = Tempo;
          |NOME_DAT #gestrw01@#Tempo#; |DELINDEX #gestrw01@;
     |FINSI;

     |SI nSwGrupoSolar = 0; |HAZ GrSolCreaTmp; |FINSI;
     |SI nSwDefelino = 0;
          aAlfa = "defelw05;INI" + aTmpDefe;
          |SUB_EJECUTA_NP aAlfa;
     |FINSI;

     |SI aParam = "PLANIFICACION";

              ||Lo llama agifa190

     |SINO;
          aDesdeEsc     = " " * 20;
          aHastaEsc     = "z" * 20;
          nDesdeOrden   = 000000;
          nHastaOrden   = 999999;
          fDesdeFecha   = "01.01.0000";
          fHastaFecha   = "31.12.9999";
          aDesdeSer     = "     ";
          aHastaSer     = "zzzzz";
     |FINSI;

     |PINPA #0#0;
     |ENTLINEAL #1#0 , -1 , 7 , 22 , 0 , Min0, Max0;

     |ABRE #19;
     |ABRE #238;
     |ABRE #0;
     |BUCLE agifa090;
     |CIERRA #0;
     |CIERRA #238;
     |CIERRA #19;

     |C_M #0#11, 1, "N";
     |C_M #0#0, 1, "N";
     |C_M #0#2, 1, "N";
     |C_M #0#6, 1, "N";

     ||*** la opcion agrupada solo esta para la division vertical
     ||*** faltaria terminarla para la estandar: uni. multiples/doble stock
     |SI #910#1 = "N"; menu4 = "OAFMSP"; |FINSI;

     ||*** Estos modulos no tienen la agrupada
     |SI nSwRodacal = 0; |O nSwGrupoSolar = 0; |O nSwCoimasa = 0;
               |O nSwBerria = 0; |O nSwGestral = 0;
          menu4 = "OAFMSP";
     |FINSI;

     |SI nSwDefelino = 0; menu2 = 7; |FINSI;

     |MENU menu;
     menu2 = FSalida;
     |SI menu2 = 4; |DELINDEX #0; |FINSI;

     |SI menu2 = 7; menu2 = 2; |HAZ Agrupa; |FINSI;

     Campo = 0;
     |PARA Menu2 = 2; |SI Menu2 = 2; |HACIENDO;
          |SI menu2 = 1; ||Orden
               |C_M #0#0, 1, "S";
               Campo = 0;
               |ENTLINEAL #4#0 , -1 , 4 , 22 , 0 , Min0, Max0;
          |FINSI;
          |SI menu2 = 2; ||Arti
               |C_M #0#2, 1, "S";
               |ENTLINEAL #2#0 , -1 , 4 , 22 , 0 , Min0, Max0;
          |FINSI;
          |SI menu2 = 3; ||Fecha
               |C_M #0#6, 1, "S";
               |ENTLINEAL #3#0 , -1 , 4 , 22 , 0 , Min0, Max0;
          |FINSI;
          |SI menu2 = 4; ||Manu
               |C_M #0#0, 1, "S"; |C_M #0#1, 1, "S";
               |C_M #0#11, 1, "S"; |C_M #0#1, 1, "S";
               |C_M #0#1, 1, "S"; |C_M #0#1, 1, "S";
               |ENTLINEAL #1#0 , -1 , 2 , 22 , 0 , Min0, Max0;
          |FINSI;
          |SI menu2 = 5; ||Simple
               |C_M #0#0, 1, "S";
               |ENTLINEAL #4#0 , -1 , 4 , 22 , 0 , Min0, Max0;
          |FINSI;
          |SI menu2 = 6; ||PDA;
               |HAZ CreaTempo; aTmp76 = Tempo; |NOME_DAT #76#aTmp76#; |DELINDEX #76;
               |HAZ CreaTempo; eaFichero = Tempo;
               |SUB_EJECUTA_NP "psion066";
               |HAZ BoraTempo;
               menu2 = 5;     || Para que no ense¤e los compoentes
               |SI enError = 0; |HAZ ImportaPDA; |FINSI;
               |DELINDEX #76; Tempo = aTmp76; |HAZ BoraTempo;
               |ENTLINEAL #4#0 , -1 , 7 , 22 , 0 , Min0, Max0;
               menu2 = 1;     || Como si fuera por Orden
          |FINSI;
          |MENU Menu;
          Menu2 = FSalida;
     |SIGUE;

     |SI Menu2 = 1;
          |ABRE #24;
          |ABRE #90;
          |ABRET #74;
          |ABRE #17;
          |ABRE #19;
          |ABRE #65;
          |ABRE #52;
          |ABRE #67;
          |ABRE #148;
          |SI nSwAgr = 0;
               |BUCLE Actualiza;
          |SINO;
               |BUCLE ActAgr;
          |FINSI;
          |HAZ ActVertical;
          |CIERRA #148;
          |CIERRA #67;
          |CIERRA #52;
          |CIERRA #65;
          |CIERRA #19;
          |CIERRA #17;
          |CIERRAT #74;
          |CIERRA #90;
          |CIERRA #24;

          |HAZ EsConstru;
          |SI FSalida = 0;
               eaFicArtic = aTempo0;
               eaFicCompo = aTempo44;
               |SUB_EJECUTA_NP "guerz082";
          |FINSI;
          |SI nSwDefelino = 0;
               aAlfa = "defelw05;ACT" + aTmpDefe;
               |SUB_EJECUTA_NP aAlfa;
          |FINSI;
          |SI nSwGestral = 0;
               aAlfa = "gestrw01;ACT"+#0#11+(("000000"+#0#0)%-106)+(("000"+#0#1)%-103)+aTmpGestral;
               |SUB_EJECUTA_NP aAlfa;
          |FINSI;
     |FINSI;

     |SI nSwGrupoSolar = 0; |HAZ GrSolBorraTmp; |FINSI;

     |DELINDEX #0;  Tempo = aTempo0;  |HAZ BoraTempo;
     |DELINDEX #44; Tempo = aTempo44; |HAZ BoraTempo;
     |DELINDEX #905; Tempo = aTempo905; |HAZ BoraTempo;
     |SI nSwGestral = 0;
          |DELINDEX #gestrw01@; Tempo = aTmpGestral; |HAZ BoraTempo;
          |DESCARGA_DEF #gestrw01@;
     |FINSI;
     Tempo = aTmpDefe; |HAZ BoraTempo;
|FPRO;
