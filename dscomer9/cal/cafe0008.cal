|FICHEROS;
     cafe0008 #0;
     agis0003 #2;
     agifa010 #10;
     agifa025 #25;
     dscamrec@ #600;
     agifa324  #601;
     agifa024 #1;
     dsm00289 #289;
|FIN;

|VARIABLES;
     &eaCta = "";
     &eswCta = 0;
     &eaRefer = "";
     nModiImpre = 0;
     &eaTag = "";
     &enSigno = 0;
     &Tempo = "";
     nCalc  = 0;

     aRefer    = "";
     aTempo148 = "";
     aTempo600 = "";
     &eaCli       = "";
     &enTiva      = 0;
     &enIva       = 0;
     &enRec       = 0;
     &aCPath = ""; &aCNome = "";
     &nDeci_Div = 0;
     &enErr   = 0;
     &TipoCta = "";
     &Cliente = "";
     &SPedido = "";
     &NPedido = 0;
     &PPedido = "";
     &FPedido = @;
     &TPedido = 0;
     &BAdela  = 0;
     &aTmp148 = "";

     nSwError = 0;
     Divisa = ""; CambioBase = 0; CambioDiv = 0;
     cta       = "";
     alfa      = "";
     total     = 0;
     impo      = 0;
     dto       = 0;
     modo      = 0;
     hay       = 0;
     actual    = 0;
     tped      = 0;
     trec      = 0;
     entra     = 0;
     nBase     = 0;
     nEuro     = 0;
     nFlag     = 0;

     aPath = ""; aDef00 = ""; aMensa = "";
     aAlfa = ""; aAlfa1 = ""; aAlfa2 = ""; aAlfa3 = "";
     ||Comodin = ""; aSubProg = ":dscarter/dsrecibo";
     Comodin = ""; aSubProg = ":dscarter/caft0008";
     nHandle = 0;
     i = 0;

     &encaft0008Cuantos = 0;
     ncafe0008Cuantos = 0;
     aMensa1 = "";
|FIN;

|PROCESO HallaMoneda;
          |DDEFECTO #10;
          |ABRE #10;
          #10#52 = #2#20;
          #10#0 = #2#17;
          |LEE 020#10=;
          |CIERRA #10;
          Divisa  = #10#68;
          CambioBase = #10#69;
          CambioDiv = #10#74;
|FPRC;

|PROCESO agis0002;
     nFlag = -1;

     |DBASS aAlfa;
     aAlfa = aAlfa + "dscarter/fich/dscam000.dat";
     |XABRE "E", aAlfa, nHandle;
     |SI FSalida = 0;
        |DBASS aPath;
        aPath = aPath + "dscarter/";
        aDef00 = aPath + "def/dscamrec";

        |CARGA_DEF aDef00, dscamrec@;
        |SI FSalida ! 0;
           aMensa = "0000Error al cargar:" + aDef00;
           |MENAV aMensa;
           aDef00 = "";
        |SINO;
           |HAZ CreaTempo; aTempo600 = Tempo;
           |PATH_DAT #600 aPath; |NOME_DAT #600 aTempo600; |DELINDEX #600;
           |ABRE #600;
           aCPath = aPath; aCNome = aTempo600;
        |FINSI;

        |HAZ HallaMoneda;

        |DFICE Comodin;
        Comodin = Comodin % -106;
        Comodin = Comodin % 0105;

        |SI #agis0003#30 = "A";
           |ABRE #agifa010; |ABRE #agifa025;
           #agifa010#52 = #agis0003#20;
           #agifa010#0  = #agis0003#17;
           |LEE 101#agifa010.=;
           |SI FSalida ! 0; |DDEFECTO #agifa010; |FINSI;

           #agifa025#0 = #agifa010#6;
           |LEE 000#agifa025.=;
           |SI FSalida ! 0; |DDEFECTO #agifa025; |FINSI;
           |CIERRA #agifa010; |CIERRA #agifa025;
        |FINSI;

        |ABRE #agifa324;
        |ABRE #agifa024;
        #agifa324#0 = Divisa;
        #agifa024#0 = #agis0003#2;   ||cli
        |LEE 020#agifa324.=;
        |LEE 020#agifa024.=;
        |CIERRA #agifa324;
        |CIERRA #agifa024;
        nDeci_Div = #agifa324#7;
        |DDEFECTO #dscamrec@;
      ||#600#0  =              ||Libro
        #600#1  = #2#20;        ||Serie
        #600#2  = #2#17;       ||Fact
        #600#3  = #agis0003#18;||N§ Rec
        #600#4  = #agis0003#8; ||F.V
        #600#5  = #agis0003#7; ||F.E
        #600#6  = #agis0003#12;||Cuenta Cli
        #600#7  = #agis0003#3; ||Nom Cli
        #600#8  = #agis0003#4; ||Nom Banco
        #600#9  = #agifa024#32;      ||Entidad
        #600#10 = #agifa024#33;      ||Sucursal
        #600#11 = #agifa024#31;      ||DC
        #600#12 = #agifa024#30;      ||Cuenta
        #600#13 = #agis0003#22;||Tipo Rec
      ||#600#14 =      ||Departa
        #600#15 = #agis0003#9; ||Importe
        #600#16 = #agis0003#15;||A aceptar
        #600#17 = #agis0003#6; ||Aceptado
        #600#18 = #agis0003#2; ||Cliente
        |SI #agis0003#30 = "A";
           #600#19 = #agifa010#6; ||Representante
           #600#20 = #agifa025#1; || Nombre representante
        |FINSI;
        #600#21 = #agifa024#3; ||Zona
        #600#22 = 1;           ||Documento
      ||#600#23 =      ||Empresa Contable
      ||#600#24 =      ||Periodo
        #600#25 = Comodin;       ||Empresa ges
      ||#600#26 =      ||A cuenta
        #600#27 = "V";         ||Tipo
        |SI nFlag > 0;
           #600#28 = "A";         ||Ope
        |SINO;
           #600#28 = "B";
        |FINSI;
        #600#29 = #agifa324#0;      ||Divisa
        #600#30 = #agifa324#1;      ||Nombre
        #600#31 = CambioDiv;        ||Cambio Divisa
        #600#32 = CambioBase;       ||Cambio Base
        #600#33 = #agifa024#203;
        #600#34 = 0;
        #600#35 = "A";
        #600#36 = #agis0003#28;
        #600#37 = aRefer;
        #600#38 = #agis0003#16;
        #600#39 = #agis0003#10;
        aAlfa = "|NC"; aAlfa = #600#aAlfa#;
        |SI aAlfa > 48;
             #600#48 = #agifa024#215;
             #600#49 = #agifa024#216;
        |FINSI;
        |SI aAlfa > 50;
             #600#50 = #agifa024#217;
             |ABRE #289;
             #289#0 = #agifa024#0;
             |LEE 000#289=;
             |SI FSalida ! 0; |DDEFECTO #289; |FINSI;
             |CIERRA #289;
             #600#51 = #289#1;
        |FINSI;

        |GRABA 020#600n;
        |SI FSalida = 0;
             ncafe0008Cuantos = ncafe0008Cuantos + 1;
             |SUB_EJECUTA_NP aSubProg;
        |FINSI;

        |SI aDef00 ! "";
             |CIERRA #600;
             |DELINDEX #600;
             |DESCARGA_DEF #dscamrec@;
        |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE agis0002;
     #2#1;
     16, 22, 13;
     "A", "     ", 000001, 001, #0#0, 2, "N";
     "A", "zzzzz", 999999, 999, #0#1, 2, "N";
     ;
     NULL, agis0002;
|FIN;

|PROCESO Tipo3; |TIPO 3;
     |BUCLE agis0002;

     aMensa1 = "0000Borrados [" + encaft0008Cuantos + "] recibos de [" + ncafe0008Cuantos + "] entregas.";
     |MENAV aMensa1;
|FPRC;
