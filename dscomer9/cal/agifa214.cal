|FICHEROS;
     agifa214 #0;
     agifa215 #1;
     agifa073 #2;
     agifa067 #3;
     agifa019 #4;
     agifa104 #5;
     agifa081 #6;
     dsm00005 #905;
     dsm00010 #910;
     dsw00022 #922;
     agifa081 #81;
     agifa104 #104;
|FIN;

|VARIABLES;
     nLinV = 0;
     &eaTempo020    = "";
     &eaTempo922    = "";
     &enSwArtiElem  = 0;
     nPrecio        = 0;
     nTprecio       = 0;
     nElementos     = 0;
     nTuniPedi      = 0;
     nUniPedi       = 0;
     nSwElemento    = 0;
     nUniPen        = 0;
     aAlfa          = "";
     &salida        = 0;
     &cliente       = "";          ||Se aprovecha Variabe Externa
     &correcto      = "N";
     &fichero       = "";
     &programa      = "";
     articulo       = "";
     inkey          = 0;
     linea          = 0;
     pendiente      = 0;
     modo           = 0;
     contenido      = 0;
     nPendiente     = 0;
     nNume          = 0;
|FIN;

|INCLUYE i_varart;

|PROCESO T12; |TIPO 12;
|FPRC;

|PROGRAMA;
     |NOME_DAT #1 eaTempo020;
     |NOME_DAT #922 eaTempo922;
     |DDEFECTO #agifa214;
     #agifa214#4 = cliente;
     #agifa214#5 = cliente;
     |PUSHV 0501 2380;
     |PINPA #0#0;
     |ENTLINEAL #1#1 , 2 , 7 , 22 , 0 , pro1 , pro2;
     |PINDA #0#0;
     nSwElemento = 0;
     FSalida = "::ENDATOS::SINBOTONES::";
     |ENDATOS #1#0;
     |SI FSalida = 0;
          |SI nSwElemento ! 0;
               |HAZ ConElemento;
          |SINO;
               articulo = #agifa214#0;
               |SI #agifa214#2 > 0;
                    |PINDA #0#0;
                    #agifa214#4 = cliente;
                    #agifa214#5 = cliente;
                    pendiente   = #agifa214#2;
                    |DELINDEX #1;
                    |ABRE #agifa215;
                    |QBF programa;
                    |HAZ lee_pedido;
                    |CIERRA #agifa215;

                    |SI #agifa214#3 < #agifa214#2;
                         aAlfa = "0000Cantidad en Pedido menor: " + #agifa214#3 + ", haga o modifique un pedido.";
                         |MENAV aAlfa;
                         linea = 0;
                    |FINSI;

                    |SI linea > 0;
                         |PINTA #agifa214#3;
                         |ENTLINEAL #1#1 , 2 , 2 , 22 , 0 , pro1 , pro2;
                         |SI #agifa214#3 > 0;
                              |AVISO;
                              |CONFI "2400NSon Correctos los Valores Entrados : ";
                              |SI FSalida = 0;
                                   correcto = "S";
                              |FINSI;
                         |FINSI;
                    |FINSI;
                    |SI correcto = "N"; |DELINDEX #1; |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
     |POPV;
|FPRO;

|PROCESO pro1;
     #agifa215#0 = #agifa214#0;
     #agifa215#1 = 0;
|FPRC;

|PROCESO pro2;
     #agifa215#0 = #agifa214#0;
     #agifa215#1 = 999;
|FPRC;

|PROCESO Ventas;
     #104#25 = #2#28;
     #104#0 = #2#0;
     |LEE 000#104=;
     |SI FSalida ! 0; |ACABA; |FINSI;

     nPendiente = #agifa073#5 - #agifa073#43;

     |ABRE #5;
     #5#25 = #2#28;
     #5#0  = #2#0;
     |LEE 000#5=;
     |SI FSalida ! 0; |DDEFECTO #0; |FINSI;
                              || este campo ya no es ABONO S/N
                              ||/no obstante, se deja asi para
                              ||/compatibilizar con pedidos importados
                              ||/de versiones 7 o anteriores, en version 8
                              ||/o superior nunca tendra el valor "S"
     |SI #5#34 ! "S";
          |SI nPendiente > 0; |Y #agifa073#20 = cliente;
               |DDEFECTO #agifa215;
               linea = linea + 1;
               #agifa215#0 = #agifa214#0;
               #agifa215#1 = linea;
               #agifa215#2 = #agifa073#28;
               #agifa215#3 = #agifa073#0;
               #agifa215#4 = #agifa073#1;
               #agifa215#5 = nPendiente;
               |SI pendiente ! 0;
                    |SI nPendiente [ pendiente;
                         pendiente   = pendiente - nPendiente;
                         #agifa215#6 = nPendiente;
                         #agifa214#3 = #agifa214#3 + #agifa215#6;
                    |SINO;
                         |SI nPendiente > pendiente;
                              #agifa215#6 = pendiente;
                              pendiente   = 0;
                              #agifa214#3 = #agifa214#3 + #agifa215#6;
                         |FINSI;
                    |FINSI;
               |FINSI;
               |GRABA 021#agifa215.n;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Compras;
     #81#25 = #2#28;
     #81#0 = #2#0;
     |LEE 000#81=;

     |SI #agifa067#38 ! #agifa067#5;
          |DDEFECTO #agifa215;
          linea = linea + 1;
          #agifa215#0 = #agifa214#0;
          #agifa215#1 = linea;
          #agifa215#2 = #agifa067#28;
          #agifa215#3 = #agifa067#0;
          #agifa215#4 = #agifa067#1;
          #agifa215#5 = #agifa067#5 - #agifa067#38;
          |SI pendiente ! 0;
               nPendiente = #agifa067#5 - #agifa067#38;
               |SI nPendiente [ pendiente;
                    pendiente = pendiente - nPendiente;
                    #agifa215#6 = nPendiente;
                    #agifa214#3 = #agifa214#3 + nPendiente;
               |SINO;
                    |SI nPendiente > pendiente;
                         #agifa215#6 = pendiente;
                         pendiente = 0;
                         #agifa214#3= #agifa214#3 + #agifa215#6;
                    |FINSI;
               |FINSI;
          |FINSI;
          |GRABA 021#agifa215.n;
     |FINSI;
|FPRC;

|DEFBUCLE Ventas;
     #2#3;
     ;
     #0#0 , "     " ,       0 , #0#4;
     #0#0 , "zzzzz" ,  999999 , #0#4;
     ;
     NULL , Ventas;
|FIN;

|DEFBUCLE Compras;
     #agifa067#3;
     ;
     #agifa214#0 , "     " ,       0 , #agifa214#5;
     #agifa214#0 , "zzzzz" ,  999999 , #agifa214#5;
     ;
     NULL , Compras;
|FIN;


|PROCESO lee_pedido;
     |ATRI P;
     |MENSA "0000Buscando en pedidos ...";
     |ATRI 0;
     linea = 0;
     |SI programa = "agifa210";
          |ABRE #104;
          |BUCLE Ventas;
          |CIERRA #104;
     |SINO;
          |ABRE #81;
          |BUCLE Compras;
          |CIERRA #81;
     |FINSI;
     |BLIN 4;
|FPRC;

|PROCESO mod; |TIPO 0;
     modo = (FEntrada / 100) ! 0;
     |SI modo = 1;
          |CAMPO_MODIFICA #agifa215#2 , 1 , "S";
          |CAMPO_MODIFICA #agifa215#3 , 1 , "S";
          |CAMPO_MODIFICA #agifa215#4 , 1 , "S";
     |SINO;
          |CAMPO_MODIFICA #agifa215#2 , 1 , "N";
          |CAMPO_MODIFICA #agifa215#3 , 1 , "N";
          |CAMPO_MODIFICA #agifa215#4 , 1 , "N";
     |FINSI;
|FPRC;

|PROCESO tipo2215; |TIPO 2;
     #agifa214#3 = #agifa214#3 +. #agifa215#6;
     |PINTA #agifa214#3;
|FPRC;

|PROCESO sirve_mas; |TIPO 0;
     contenido = Contenido;
     |SI #agifa215#6 > #agifa215#5;
          #agifa215#6 = #agifa215#5;    |PINTA #agifa215#6;
     |SINO;
          nNume = #agifa214#3 + #agifa215#6;
          |SI nNume > #agifa214#2;
               |CONFI "2400Se esta superando la cantidad Pedida, Servir : ";
               |SI FSalida ! 0;
                    |ERROR;
                    ||#agifa215#6 = contenido; |PINTA  #agifa215#6;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO mira_ped; |TIPO 0;
     modo = (FEntrada / 100) ! 0;
     |SI modo = 1;
          |SI programa = "agifa210";
               |ABRE #agifa073;
               #agifa073#28 = #agifa215#2;
               #agifa073#0  = #agifa215#3;
               #agifa073#1  = #agifa215#4;
               |LEE 001#agifa073.=;
               |SI FSalida ! 0;  |DDEFECTO #agifa073;  |FINSI;
               nPendiente = #agifa073#5 - #agifa073#43;
               |SI FSalida ! 0; |O #agifa073#2 ! #agifa214#0;
                                |O #agifa073#20 ! #agifa214#4;
                                |O nPendiente [ 0;
                    |SI FSalida ! 0;
                         |MENAV "0000Pedido Inexistente";
                    |SINO;
                         |SI #agifa073#2 ! #agifa214#0;
                              |MENAV "0000El Articulo no coincide con el del Pedido";
                         |SINO;
                              |SI nPendiente [ 0;
                                   |MENAV "0000No quedan Unidades por Servir";
                              |SINO;
                                   |MENAV "0000El Cliente no coincide con el del Pedido";
                              |FINSI;
                         |FINSI;
                    |FINSI;
                    |CIERRA #agifa073;
                    |ERROR;
                    |ACABA;
               |SINO;
                    #agifa215#5 = nPendiente;        |PINTA #agifa215#5;
                    #agifa215#6 = nPendiente;        |PINTA #agifa215#6;
               |FINSI;
               |CIERRA #agifa073;
          |SINO;
               |ABRE #agifa067;
               #agifa067#28 = #agifa215#2;
               #agifa067#0  = #agifa215#3;
               #agifa067#1  = #agifa215#4;
               |LEE 001#agifa067.=;
               |SI FSalida ! 0;  |DDEFECTO #agifa067;  |FINSI;
               nPendiente = #agifa067#5 - #agifa067#38;
               |SI FSalida ! 0; |O #agifa067#2 ! #agifa214#0;
                                |O #agifa067#20 ! #agifa214#5;
                                |O nPendiente [ 0;
                    |SI FSalida ! 0;
                         |MENAV "0000Pedido Inexistente";
                    |SINO;
                         |SI #agifa067#2 ! #agifa214#0;
                              |MENAV "0000El Articulo no coincide con el del Pedido";
                         |SINO;
                              |SI nPendiente [ 0;
                                   |MENAV "0000No quedan Unidades por Servir";
                              |SINO;
                                   |MENAV "0000El Cliente no coincide con el del Pedido";
                              |FINSI;
                         |FINSI;
                    |FINSI;
                    |CIERRA #agifa067;
                    |ERROR;
                    |ACABA;
               |SINO;
                    #agifa215#5 = nPendiente;        |PINTA #agifa215#5;
                    #agifa215#6 = nPendiente;        |PINTA #agifa215#6;
               |FINSI;
               |CIERRA #agifa067;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Calc6214; |TIPO 6;
     inkey = FSalida;

     |SI inkey = 10;
          |ABRE #4;
          |SELECT #6#4;
          #4#134 = #0#0;
          |LEE 040#4=;
          |SI FSalida = 0;
               #0#0 = #4#0; |PINTA #0#0;
          |SINO;
               |MENAV "0000No existe codigo articulo proveedor...";
               |ERROR;
          |FINSI;

          |SELECT #1#4;
          |CIERRA #4;
          |ACABA;
     |FINSI;

     eaArticulo = #0Campo;
     |HAZ LlenaArticulo;
     |SI FSalida = 0;
          #0Campo = eaArticulo;
          |PINTA #0Campo;
     |SINO;
          |ERROR; |ACABA;
     |FINSI;
|FPRC;

|PROCESO PideArt214;  |TIPO 7;
     |ABRE #910;
     |LEE 040#910p;
     |SI FSalida ! 0;  |DDEFECTO #910;  |FINSI;
     |CIERRA #910;

     |SI #910#2 [ 2;    |ACABA;  |FINSI;

     eAlfa = #0Campo;
     |SUB_EJECUTA_NP "dsz99990";                 || Por Pantalla
     |SI eAlfa = "-1";  |PTEC 807;  |ACABA;  |FINSI;
     |SI eAlfa = "-2";              |ACABA;  |FINSI;

     eaArticulo = eAlfa;      ||  700000-4215

     #0Campo = eAlfa;
     |PINTA #0Campo;
     |PTEC 802;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO Reparte905;
     nUniPen = #905#11 - #905#12;
     |SI nUniPen = 0; |ACABA; |FINSI;
     |SALVA_FICHA #905;

     #905#0 = "W3";
     #905#1 = eaSerie;
     #905#2 = enCodigo;
     #905#3 = enLinea;
     |LEE 101#905=;
     |SI FSalida = 0; |Y #905#6 > 0;
          |SI #905#6 > nUniPen;
               nUniPedi = nUniPen;
               #905#6 = #905#6 - nUniPedi;
          |SINO;
               nUniPedi = #905#6;
               #905#6 = 0;
          |FINSI;
          nTuniPedi = nTuniPedi + nUniPedi;
          |GRABA 020#905a;
          |LIBERA #905;
          nPrecio = #905#7;
          nElementos = nElementos + 1;
          nTprecio =  nTprecio + #905#7;
          |REPON_FICHA #905;
          |DDEFECTO #922;
          #922#0 = "W3";
          #922#1 = #905#1;
          #922#2 = #905#2;
          #922#3 = #905#3;
          #922#4 = #905#4;
          #922#5 = #905#5;
          #922#6 = nUniPedi;
          #922#7 = nPrecio;
          #922#10= #905#10;
          |GRABA 020#922n;
     |SINO;
          |REPON_FICHA #905;
     |FINSI;
     |LIBERA #905;
|FPRC;

|DEFBUCLE Reparte905;
     #905#1;
     ;
     "PC", #1#2, #1#3, nLinV, "      ";
     "PC", #1#2, #1#3, nLinV, "zzzzzz";
     ;
     NULL, Reparte905;
|FIN;

|PROCESO Reparte215
     nTuniPedi = 0;
     nPrecio = 0;
     nElementos = 0;
     nTprecio = 0;
     nLinV = #1#4;
     |BUCLE Reparte905;
     #1#6 = nTuniPedi;
     #1#7 = nTprecio/nElementos;
     |GRABA 020#1a;
|FPRC;

|DEFBUCLE Reparte215;
     #1#1;
     ;
     #0#0, 001;
     #0#0, 999;
     be;
     NULL, Reparte215;
|FIN;

|PROCESO BorraW3;
     |BORRA 020#905a;
|FPRC;

|DEFBUCLE BorraW3;
     #905#1;
     ;
     "W3", eaSerie, enCodigo, enLinea, "      ";
     "W3", eaSerie, enCodigo, enLinea, "zzzzzz";
     b;
     NULL, BorraW3;
|FIN;

|PROCESO dsm00005;
     nUniPen = #905#11 - #905#12;
     |SI nUniPen = 0; |ACABA; |FINSI;

     |SALVA_FICHA #905;

     #905#0 = "W3";
     #905#1 = eaSerie;
     #905#2 = enCodigo;
     #905#3 = enLinea;
     |LEE 101#905=;
     |SI FSalida ! 0; |GRABA 020#905b; |FINSI;
     #905#6 = 0;
     #905#7 = 0;
     #905#8 = 0;
     #905#12 = #905#12 + nUniPen; || Campo utilizado para Total Pendiente
     |GRABA 020#905a;
     |LIBERA #905;

     |REPON_FICHA #905;
|FPRC;

|DEFBUCLE dsm00005;
     #905#1;
     ;
     "PC", #3#28, #3#0, nLinV, "      ";
     "PC", #3#28, #3#0, nLinV, "zzzzzz";
     ;
     NULL, dsm00005;
|FIN;

|PROCESO CargaPendientes;
     |SI #agifa067#38 ! #agifa067#5;
          |DDEFECTO #agifa215;
          linea = linea + 1;
          #agifa215#0 = #agifa214#0;
          #agifa215#1 = linea;
          #agifa215#2 = #agifa067#28;
          #agifa215#3 = #agifa067#0;
          #agifa215#4 = #agifa067#1;
          #agifa215#5 = #agifa067#5 - #agifa067#38;
          |GRABA 021#agifa215.n;
          nLinV = #3#1;
          |BUCLE dsm00005;
     |FINSI;
|FPRC;

|PROCESO LeeCab081;
     #6#25 = #3#28;
     #6#0 = #3#0;
     |LEE 000#6=;
|FPRC;

|DEFBUCLE CargaPendientes;
     #agifa067#3;
     ;
     #agifa214#0 , "     " ,       0 , #agifa214#5;
     #agifa214#0 , "zzzzz" ,  999999 , #agifa214#5;
     ;
     NULL , LeeCab081, NULL, NULL, NULL, CargaPendientes;
     #6#1;
|FIN;

|PROCESO AseguraArticu; |TIPO 0;
     |ABRE #4;
     #4#0 = #0#0;
     |LEE 040#4=;
     |SI FSalida ! 0;  |DDEFECTO #4;  |FINSI;
     |CIERRA #4;
     |SI #4#176 = "S";
          nSwElemento = 1;
          |C_M #0#2, 1, "N"; |PINTA #0#2;
     |FINSI;
|FPRC;

|PROCESO ConElemento;
     |BUCLE BorraW3;          || Por si las moscas
     nSwElemento = 1;
     eaTipo      = "W3";
     eaArticulo  = #0#0;
     |DELINDEX #1;
     |ABRE #905;
     |ABRE #1;
     |ABRE #6;

     |BUCLE CargaPendientes;
     |CIERRA #6;
     |CIERRA #1;
     |CIERRA #905;
     |SI linea = 0;
          |MENAV "0000No hay unidades pendientes...";
     |SINO;
          |SUB_EJECUTA_NP "dsz00002";
          #0#2 = enUnidades; |PINTA #0#2;
          #0#3 = enUnidades; |PINTA #0#3;
     |FINSI;
     |SI #0#2 > 0;
          |DELINDEX #922;

          |ABRE #922;
          |BUCLE Reparte215;
          |CIERRA #922;

          |PINPA #0#0;
          |PINDA #0#0;
          |ENTLINEAL #1#1 , 2 , 4 , 22 , 0 , pro1 , pro2;
          |CONFI "2400NSon Correctos los Valores Entrados";

          |SI FSalida = 0;
               correcto = "S";
               enSwArtiElem = 1;
          |SINO;
               |DELINDEX #922;
          |FINSI;
     |FINSI;
     |SI correcto ! "S";
          |DELINDEX #1;
     |FINSI;
     |BUCLE BorraW3;
|FPRC;
