|FICHEROS;
     tecaz023 #0,MANTE;
     agifa017 #17;
     agifa019 #19;
     agifa142 #142;
|FIN;

|VARIABLES;
     &enTiva = 0;
     &efFiva = @;
     &eaDiva = "";
     &enIva = 0;
     &enRec = 0;
     aGuarda = "";
     nRedo = 0;
     &nDeci_PreBase  = 0;   || Decimales en el Precio en moneda base
     &nDeci_PreDiv  = 0;
     &nDeci_Base = 0;
     factordec = 0;
     calpre = 0;
     precio = 0;
     &pvp1   = 0;
     &pvp2   = 0;
     &pvp3   = 0;
     &pvp4   = 0;
     &pvp5   = 0;
     &pvp6   = 0;
     m1     = 0;
     m2     = 0;
     m3     = 0;
     m4     = 0;
     m5     = 0;
     m6     = 0;
     i      = 0;
|FIN;

|PROCESO actudemas1; |TIPO 0;
     |SI FSalida = 9;
          #0#9  = #0#8;
          #0#10 = #0#8;
          #0#11 = #0#8;
          #0#12 = #0#8;
          #0#13 = #0#8;
          |PINTA #0#9;
          |PINTA #0#10;
          |PINTA #0#11;
          |PINTA #0#12;
          |PINTA #0#13;
          |ERROR;
     |FINSI;
|FPRC;

|PROCESO CalPre1;
     #17#71 = #0#21;
     |SI Campo ] 14; |Y Campo [ 19; |Y #0#20 = "G"; |Y #0Campo > 100;
          |MENAV "0000Porcentaje incorrecto debe ser menor de 100";
     |FINSI;

     |SI calpre = 1; precio = #17#69; |FINSI;
     |SI calpre = 2; precio = #17#79; |FINSI;
     |SI calpre = 3; precio = #17#80; |FINSI;
     |SI #142#125 = "N";
          pvp1 = #0#2;
          pvp2 = #0#3;
          pvp3 = #0#4;
          pvp4 = #0#5;
          pvp5 = #0#6;
          pvp6 = #0#7;
          |SI #0#20 = "S";
               |SI #0#14 ! 0; pvp1 = precio > #0#14; |FINSI;
               |SI #0#15 ! 0; pvp2 = precio > #0#15; |FINSI;
               |SI #0#16 ! 0; pvp3 = precio > #0#16; |FINSI;
               |SI #0#17 ! 0; pvp4 = precio > #0#17; |FINSI;
               |SI #0#18 ! 0; pvp5 = precio > #0#18; |FINSI;
               |SI #0#19 ! 0; pvp6 = precio > #0#19; |FINSI;
          |SINO;
               |SI #0#14 ! 0; pvp1 = (precio * 100) / (100 - #0#14); |FINSI;
               |SI #0#15 ! 0; pvp2 = (precio * 100) / (100 - #0#15); |FINSI;
               |SI #0#16 ! 0; pvp3 = (precio * 100) / (100 - #0#16); |FINSI;
               |SI #0#17 ! 0; pvp4 = (precio * 100) / (100 - #0#17); |FINSI;
               |SI #0#18 ! 0; pvp5 = (precio * 100) / (100 - #0#18); |FINSI;
               |SI #0#19 ! 0; pvp6 = (precio * 100) / (100 - #0#19); |FINSI;
          |FINSI;
     |SINO;
          |SI #0#20 = "S";
               pvp1 = precio > #0#14;
               pvp2 = precio > #0#15;
               pvp3 = precio > #0#16;
               pvp4 = precio > #0#17;
               pvp5 = precio > #0#18;
               pvp6 = precio > #0#19;
          |SINO;
               pvp1 = (precio * 100) / (100 - #0#14);
               pvp2 = (precio * 100) / (100 - #0#15);
               pvp3 = (precio * 100) / (100 - #0#16);
               pvp4 = (precio * 100) / (100 - #0#17);
               pvp5 = (precio * 100) / (100 - #0#18);
               pvp6 = (precio * 100) / (100 - #0#19);
          |FINSI;
     |FINSI;

     enTiva = #19#30;
     efFiva = ~;
     |HAZ SacaIVA;

     |SI #142#125 = "N";
          |SI #17#57 = "S"; |Y #0#14 ! 0; pvp1 = pvp1 > enIva; |FINSI;
          |SI #17#58 = "S"; |Y #0#15 ! 0; pvp2 = pvp2 > enIva; |FINSI;
          |SI #17#59 = "S"; |Y #0#16 ! 0; pvp3 = pvp3 > enIva; |FINSI;
          |SI #17#60 = "S"; |Y #0#17 ! 0; pvp4 = pvp4 > enIva; |FINSI;
          |SI #17#61 = "S"; |Y #0#18 ! 0; pvp5 = pvp5 > enIva; |FINSI;
          |SI #17#62 = "S"; |Y #0#19 ! 0; pvp6 = pvp6 > enIva; |FINSI;
     |SINO;
          |SI #17#57 = "S"; pvp1 = pvp1 > enIva; |FINSI;
          |SI #17#58 = "S"; pvp2 = pvp2 > enIva; |FINSI;
          |SI #17#59 = "S"; pvp3 = pvp3 > enIva; |FINSI;
          |SI #17#60 = "S"; pvp4 = pvp4 > enIva; |FINSI;
          |SI #17#61 = "S"; pvp5 = pvp5 > enIva; |FINSI;
          |SI #17#62 = "S"; pvp6 = pvp6 > enIva; |FINSI;
     |FINSI;
     |SI #17#71 > 0;
          |HAZ Redondeo1;
     |FINSI;

     pvp1 = pvp1 ! nDeci_PreBase;
     pvp2 = pvp2 ! nDeci_PreBase;
     pvp3 = pvp3 ! nDeci_PreBase;
     pvp4 = pvp4 ! nDeci_PreBase;
     pvp5 = pvp5 ! nDeci_PreBase;
     pvp6 = pvp6 ! nDeci_PreBase;

     #0#8 = pvp1;   |PINTA #0#8;
     #0#9 = pvp2;   |PINTA #0#9;
     #0#10 = pvp3;  |PINTA #0#10;
     #0#11 = pvp4;  |PINTA #0#11;
     #0#12 = pvp5;  |PINTA #0#12;
     #0#13 = pvp6;  |PINTA #0#13;
|FPRC;

|CALCULO Redondeo1;|TIPO 0;
     pvp1 = pvp1 ! nDeci_PreBase;
     pvp2 = pvp2 ! nDeci_PreBase;
     pvp3 = pvp3 ! nDeci_PreBase;
     pvp4 = pvp4 ! nDeci_PreBase;
     pvp5 = pvp5 ! nDeci_PreBase;
     pvp6 = pvp6 ! nDeci_PreBase;
     |SI #17#71 > 0;
          factordec = 1; ||Necesario redondeo divisas
          |PARA i = 1;|SI i [ nDeci_PreBase;|HACIENDO i = i + 1;
               factordec = factordec * 10;
          |SIGUE;
          pvp1 = (pvp1 * factordec) ! 0;
          pvp2 = (pvp2 * factordec) ! 0;
          pvp3 = (pvp3 * factordec) ! 0;
          pvp4 = (pvp4 * factordec) ! 0;
          pvp5 = (pvp5 * factordec) ! 0;
          pvp6 = (pvp6 * factordec) ! 0;

          nRedo = #17#71 * factordec;

          m1 = pvp1 $ nRedo;
          m2 = pvp2 $ nRedo;
          m3 = pvp3 $ nRedo;
          m4 = pvp4 $ nRedo;
          m5 = pvp5 $ nRedo;
          m6 = pvp6 $ nRedo;

          |SI m1 ! 0;    pvp1 = pvp1 + nRedo - m1; |FINSI;
          |SI m2 ! 0;    pvp2 = pvp2 + nRedo - m2; |FINSI;
          |SI m3 ! 0;    pvp3 = pvp3 + nRedo - m3; |FINSI;
          |SI m4 ! 0;    pvp4 = pvp4 + nRedo - m4; |FINSI;
          |SI m5 ! 0;    pvp5 = pvp5 + nRedo - m5; |FINSI;
          |SI m6 ! 0;    pvp6 = pvp6 + nRedo - m6; |FINSI;

          pvp1 = pvp1 / factordec;
          pvp2 = pvp2 / factordec;
          pvp3 = pvp3 / factordec;
          pvp4 = pvp4 / factordec;
          pvp5 = pvp5 / factordec;
          pvp6 = pvp6 / factordec;
     |FINSI;
|FCAL;

|PROCESO CargaDatos1;
     #19#0 = #17#0;
     |LEE 020#19=;

     calpre = #142#60;
     #0#0 = #17#0;
     #0#1 = #17#40;

     #0#2 = #17#51;
     #0#3 = #17#52;
     #0#4 = #17#53;
     #0#5 = #17#54;
     #0#6 = #17#55;
     #0#7 = #17#56;

     #0#14 = #17#72;
     #0#15 = #17#73;
     #0#16 = #17#74;
     #0#17 = #17#75;
     #0#18 = #17#76;
     #0#19 = #17#77;

     #0#20 = #17#70;
     #0#21 = #17#71;
|FPRC;

|PROCESO Termina1; |TIPO 3;
     #17#72 = #0#14;
     #17#73 = #0#15;
     #17#74 = #0#16;
     #17#75 = #0#17;
     #17#76 = #0#18;
     #17#77 = #0#19;

     #17#70 = #0#20;
     #17#71 = #0#21;

     #17#51 = #0#8;
     #17#52 = #0#9;
     #17#53 = #0#10;
     #17#54 = #0#11;
     #17#55 = #0#12;
     #17#56 = #0#13;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO CalPreTeca023;
     aGuarda = FEntrada;
     |PUSHV 0501 2380;
     |HAZ CargaDatos1;
     |HAZ CalPre1;
     |PINPA #0#0;
     |PINDA #0#0;
     |ENDATOS #1#0;
     |POPV;

     FEntrada = aGuarda;
|FPRC;

|PROCESO CalPreTeca077;
     |PUSHV 0501 2380;
     |HAZ CargaDatos1;
     |HAZ CalPre1;
     |SI #142#76 = "S";
          |SI #17#51 ! #0#8; |O #17#52 ! #0#9; |O #17#53 ! #0#10;
               |O #17#54 ! #0#11; |O #17#55 ! #0#12; |O #17#56 ! #0#13;
               |PINPA #0#0;
               |PINDA #0#0;
               |ENDATOS #1#0;
          |FINSI;
     |FINSI;
     |POPV;
|FPRC;
