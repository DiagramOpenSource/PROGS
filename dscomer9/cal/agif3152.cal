          Modulos: Tpv, PCEGroup, Taller9, Aparecida, Coimasa

|FICHEROS;
     agifa154 #154;       ||Linas Ajuste Articulos

     dsm00255@ #255;     ||Modulo TPV
     dsm00256@ #256;

     referen@;
|FIN;

|VARIABLES;
     &eaFic = "";
     &eaOrg = "";
     &eaDes = "";
     &enErr = 0;
     nSw = 0;
     aAlfa = "";
     aDef = "";
     &CambDesc = "";
     &tabla = 0;
     &tipo = " ";
     &sust = "";
|FIN;

|PROCESO coima021;
     #154#2 = #referen@#5;
     #154#0 = tabla;
     #154#6 = tipo;
     |LEE 000#154=;
     |SI FSalida = 0;
          #referen@#5 = #154#3;
          |GRABA 020#referen@.a;
     |FINSI;

     #154#2 = #referen@#24;
     #154#0 = tabla;
     #154#6 = tipo;
     |LEE 000#154=;
     |SI FSalida = 0;
          #referen@#24 = #154#3;
          |GRABA 020#referen@.a;
     |FINSI;

     |LIBERA #referen@;
|FPRC;

|DEFBUCLE coima021;
     #referen@#1005;
     ;
     000, 000, 000, 000, 001;
     999, 999, 999, 999, 999;
     be;
     NULL, coima021;
|FIN;

|PROCESO coima003;
     #154#2 = #referen@#13;
     #154#0 = tabla;
     #154#6 = tipo;
     |LEE 000#154=;
     |SI FSalida = 0;
          #referen@#13 = #154#3;
          |SI CambDesc = "S"; #referen@#14 = #154#5; |FINSI;
          |GRABA 020#referen@.a;
     |FINSI;
     |LIBERA #referen@;
|FPRC;

|DEFBUCLE coima003;
     #referen@#1006;
     ;
     " ", "     ", 000000, 001, 000000, 000;
     "z", "zzzzz", 999999, 999, 999999, 999;
     be;
     NULL, coima003;
|FIN;

|PROCESO con0g017;
     #154#2 = #referen@#3;
     #154#0 = tabla;
     #154#6 = tipo;
     |LEE 000#154=;
     |SI FSalida = 0;
          #referen@#3 = #154#3;
          |SI CambDesc = "S"; #referen@#4 = #154#5; |FINSI;
          |GRABA 020#referen@.a;
     |FINSI;
     |LIBERA #referen@;
|FPRC;

|DEFBUCLE con0g017;
     #referen@#1005;
     ;
     "     ", 0       , 0001, 0000, 000;
     "zzzzz", 99999999, 9999, 9999, 999;
     be;
     NULL, con0g017;
|FIN;

|PROCESO con0g012;
     #154#2 = #referen@#3;
     #154#0 = tabla;
     #154#6 = tipo;
     |LEE 000#154=;
     |SI FSalida = 0;
          #referen@#3 = #154#3;
          |SI CambDesc = "S"; #referen@#4 = #154#5; |FINSI;
          |GRABA 020#referen@.a;
     |FINSI;
     |LIBERA #referen@;
|FPRC;

|DEFBUCLE con0g012;
     #referen@#1004;
     ;
     "     ", 0       , 0001, 0000;
     "zzzzz", 99999999, 9999, 9999;
     be;
     NULL, con0g012;
|FIN;

|PROCESO conp0626;
     #154#2 = #referen@#2;
     #154#0 = tabla;
     #154#6 = tipo;
     |LEE 000#154=;
     |SI FSalida = 0;
          #referen@#2 = #154#3;
          |SI CambDesc = "S"; #referen@#3 = #154#5; |FINSI;
          |GRABA 020#referen@.a;
     |FINSI;
     |LIBERA #referen@;
|FPRC;

|DEFBUCLE conp0626;
     #referen@#1003;
     ;
     "     ", "      ", 0001;
     "zzzzz", "zzzzzz", 9999;
     be;
     NULL, conp0626;
|FIN;

|PROCESO con00626;
     #154#2 = #referen@#2;
     #154#0 = tabla;
     #154#6 = tipo;
     |LEE 000#154=;
     |SI FSalida = 0;
          #referen@#2 = #154#3;
          |SI CambDesc = "S"; #referen@#3 = #154#5; |FINSI;
          |GRABA 020#referen@.a;
     |FINSI;
     |LIBERA #referen@;
|FPRC;

|DEFBUCLE con00626;
     #referen@#1003;
     ;
     "     ", "      ", 0001;
     "zzzzz", "zzzzzz", 9999;
     be;
     NULL, con00626;
|FIN;
--------------------------------------------------------------------
|PROCESO pcegm012;
     |SI sust = "S";
          |BORRA 020#referen@.a;
     |FINSI;
     #referen@#0 = #154#3;
     |GRABA 000#referen@.n;
     |SI FSalida ! 0;
          enErr = FSalida;
          eaFic = "pcegm012";
          eaOrg = #154#2;
          eaDes = #154#3;
          |HAZ Print;
     |FINSI;
     |LIBERA #referen@;
|FPRC;

|DEFBUCLE pcegm012;
     #referen@#1001;
     ;
     #154#2;
     #154#2;
     be;
     NULL, pcegm012;
|FIN;

|PROCESO pcegm005;
     #154#2 = #referen@#2;
     #154#0 = tabla;
     #154#6 = tipo;
     |LEE 000#154=;
     |SI FSalida = 0;
          #referen@#2 = #154#3;
          |SI CambDesc = "S"; #referen@#4 = #154#5; |FINSI;
          |GRABA 020#referen@.a;
     |FINSI;
     |LIBERA #referen@;
|FPRC;

|DEFBUCLE pcegm005;
     #referen@#1003;
     ;
     "     ", 000001, 001;
     "zzzzz", 999999, 999;
     be;
     NULL, pcegm005;
|FIN;

|PROCESO pcegm003;
     #154#2 = #referen@#2;
     #154#0 = tabla;
     #154#6 = tipo;
     |LEE 000#154=;
     |SI FSalida = 0;
          #referen@#2 = #154#3;
          |SI CambDesc = "S"; #referen@#4 = #154#5; |FINSI;
          |GRABA 020#referen@.a;
     |FINSI;
     |LIBERA #referen@;
|FPRC;

|DEFBUCLE pcegm003;
     #referen@#1003;
     ;
     "     ", 000001, 001;
     "zzzzz", 999999, 999;
     be;
     NULL, pcegm003;
|FIN;
--------------------------------------------------------------------
|PROCESO dsm00256;
     |BORRA 020#256a;
     #256#0 = #154#3;
     |GRABA 000#256n;
     |SI FSalida ! 0;
          enErr = FSalida;
          eaFic = "dsm00256";
          eaOrg = #154#2;
          eaDes = #154#3;
          |HAZ Print;
     |FINSI;
     |LIBERA #256;
|FPRC;

|DEFBUCLE dsm00256;
     #256#1002;
     ;
     #255#0, 001;
     #255#0, 999;
     be;
     NULL, dsm00256;
|FIN;

|PROCESO dsm00255;
     |BUCLE dsm00256;

     |BORRA 020#255a;
     #255#0 = #154#3;
     |GRABA 000#255n;
     |SI FSalida ! 0;
          enErr = FSalida;
          eaFic = "dsm00255";
          eaOrg = #154#2;
          eaDes = #154#3;
          |HAZ Print;
     |FINSI;
     |LIBERA #255;
|FPRC;

|DEFBUCLE dsm00255;
     #255#1001;
     ;
     #154#2;
     #154#2;
     be;
     NULL, dsm00255;
|FIN;

|PROCESO aparm009;
     |SI sust = "S";
          |BORRA 020#referen@.a;
     |FINSI;
     #referen@#31 = #154#3;
     |GRABA 020#referen@.n;
     |LIBERA #referen@;
|FPRC;

|DEFBUCLE aparm009;
     #referen@#1001;
     ;
     #154#2;
     #154#2;
     be;
     NULL, aparm009;
|FIN;

|PROCESO coima010;
     |SI sust = "S";
          |BORRA 020#referen@.a;
     |FINSI;
     #referen@#0 = #154#3;
     |GRABA 020#referen@.n;
     |LIBERA #referen@;
|FPRC;

|DEFBUCLE coima010;
     #referen@#1002;
     ;
     #154#2, 001;
     #154#2, 999;
     be;
     NULL, coima010;
|FIN;

|PROCESO coima027;
     |SI sust = "S";
          |BORRA 020#referen@.a;
     |FINSI;
     #referen@#0 = #154#3;
     |GRABA 000#referen@.n;
     |SI FSalida ! 0;
          enErr = FSalida;
          eaFic = "coima027";
          eaOrg = #154#2;
          eaDes = #154#3;
          |HAZ Print;
     |FINSI;
     |LIBERA #referen@;
|FPRC;

|DEFBUCLE coima027;
     #referen@#1002;
     ;
     #154#2, 00000;
     #154#2, 99999;
     be;
     NULL, coima027;
|FIN;

|PROCESO coima029;
     |SI sust = "S";
          |BORRA 020#referen@.a;
     |FINSI;
     #referen@#0 = #154#3;
     |GRABA 000#referen@.n;
     |SI FSalida ! 0;
          enErr = FSalida;
          eaFic = "coima029";
          eaOrg = #154#2;
          eaDes = #154#3;
          |HAZ Print;
     |FINSI;
     |LIBERA #referen@;
|FPRC;

|DEFBUCLE coima029;
     #referen@#1001;
     ;
     #154#2;
     #154#2;
     be;
     NULL, coima029;
|FIN;

|PROCESO coima043;
     |SI sust = "S";
          |BORRA 020#referen@.a;
     |FINSI;
     #referen@#1 = #154#3;
     |SI CambDesc = "S"; #referen@#3 = #154#5; |FINSI;
     |GRABA 020#referen@.n;
     |LIBERA #referen@;
|FPRC;

|DEFBUCLE coima043;
     #referen@#1002;
     ;
     "   ", #154#2;
     "zzz", #154#2;
     be;
     NULL, coima043;
|FIN;

|PROCESO Tabla;     || Ficheros con clave articulo
     |SI nSw = 1; |BUCLE dsm00255; |FINSI;
     |SI nSw = 2; |BUCLE pcegm012; |FINSI;
     |SI nSw = 3; |BUCLE aparm009; |FINSI;
     |SI nSw = 4; |BUCLE coima010; |FINSI;
     |SI nSw = 5; |BUCLE coima027; |FINSI;
     |SI nSw = 6; |BUCLE coima029; |FINSI;
     |SI nSw = 7; |BUCLE coima043; |FINSI;
|FPRC;

|DEFBUCLE Tabla;
     #154#1;
     6;
     tabla ,     0, tipo;
     tabla , 99999, tipo;
     ;
     NULL , Tabla;
|FIN;

|PROCESO Modulos;
     |DDEF aDef;

     |HAZ EsTpv;
     |SI FSalida = 0;
          aAlfa = aDef + "dsm00255";
          |CARGA_DEF aAlfa, dsm00255@;
          |SI FSalida = 0;
               aAlfa = aDef + "dsm00256";
               |CARGA_DEF aAlfa, dsm00256@;
               |SI FSalida = 0;
                    nSw = 1; |BUCLE Tabla;
                    |DESCARGA_DEF #dsm00256@;
               |FINSI;
               |DESCARGA_DEF #dsm00255@;
          |FINSI;
     |FINSI;

     |HAZ EsPCEGroup;
     |SI FSalida = 0;
          |ABRE #154; |SELECT #4#154;
          aAlfa = aDef + "pcegm003";
          |CARGA_DEF aAlfa, referen@;
          |SI FSalida = 0;
               |BUCLE pcegm003;
               |DESCARGA_DEF #referen@;
          |FINSI;
          aAlfa = aDef + "pcegm005";
          |CARGA_DEF aAlfa, referen@;
          |SI FSalida = 0;
               |BUCLE pcegm005;
               |DESCARGA_DEF #referen@;
          |FINSI;
          |CIERRA #154;
          aAlfa = aDef + "pcegm012";
          |CARGA_DEF aAlfa, referen@;
          |SI FSalida = 0;
               nSw = 2; |BUCLE Tabla;
               |DESCARGA_DEF #referen@;
          |FINSI;
     |FINSI;

     |HAZ EsTaller;
     |SI FSalida = 0;
          |ABRE #154; |SELECT #4#154;
          aAlfa = aDef + "conp0626";
          |CARGA_DEF aAlfa, referen@;
          |SI FSalida = 0;
               |BUCLE conp0626;
               |DESCARGA_DEF #referen@;
          |FINSI;
          aAlfa = aDef + "con00626";
          |CARGA_DEF aAlfa, referen@;
          |SI FSalida = 0;
               |BUCLE con00626;
               |DESCARGA_DEF #referen@;
          |FINSI;
          aAlfa = aDef + "con0g012";
          |CARGA_DEF aAlfa, referen@;
          |SI FSalida = 0;
               |BUCLE con0g012;
               |DESCARGA_DEF #referen@;
          |FINSI;
          aAlfa = aDef + "con0g017";
          |CARGA_DEF aAlfa, referen@;
          |SI FSalida = 0;
               |BUCLE con0g017;
               |DESCARGA_DEF #referen@;
          |FINSI;
          |CIERRA #154;
     |FINSI;

     |HAZ EsAparecida;
     |SI FSalida = 0;
          aAlfa = aDef + "aparm009";
          |CARGA_DEF aAlfa, referen@;
          |SI FSalida = 0;
               nSw = 3; |BUCLE Tabla;
               |DESCARGA_DEF #referen@;
          |FINSI;
     |FINSI;

     |HAZ EsCoimasa;
     |SI FSalida = 0;
          |ABRE #154; |SELECT #4#154;
          aAlfa = aDef + "coima003";
          |CARGA_DEF aAlfa, referen@;
          |SI FSalida = 0;
               |BUCLE coima003;
               |DESCARGA_DEF #referen@;
          |FINSI;
          aAlfa = aDef + "coima021";
          |CARGA_DEF aAlfa, referen@;
          |SI FSalida = 0;
               |BUCLE coima021;
               |DESCARGA_DEF #referen@;
          |FINSI;
          |CIERRA #154;

          aAlfa = aDef + "coima010";
          |CARGA_DEF aAlfa, referen@;
          |SI FSalida = 0;
               nSw = 4; |BUCLE Tabla;
               |DESCARGA_DEF #referen@;
          |FINSI;
          aAlfa = aDef + "coima027";
          |CARGA_DEF aAlfa, referen@;
          |SI FSalida = 0;
               nSw = 5; |BUCLE Tabla;
               |DESCARGA_DEF #referen@;
          |FINSI;
          aAlfa = aDef + "coima029";
          |CARGA_DEF aAlfa, referen@;
          |SI FSalida = 0;
               nSw = 6; |BUCLE Tabla;
               |DESCARGA_DEF #referen@;
          |FINSI;
          aAlfa = aDef + "coima043";
          |CARGA_DEF aAlfa, referen@;
          |SI FSalida = 0;
               nSw = 7; |BUCLE Tabla;
               |DESCARGA_DEF #referen@;
          |FINSI;
     |FINSI;
|FPRC;
