|FICHEROS;
     malpe081 #81;
     malpe085 #85;
     malpe091 #91;
|FIN;

|VARIABLES;
     aImp = "";
     aAlfa = "";
     aSer = "";
     nNum = 0;
     nLin = 0;
     aFic = "";
     aIP = "";
     {1}aContiene = "";
     {1}aLocal = "";
     aOrg = "";
     aDes = "";
     aMd5Org = "";
     aMd5Des = "";
     aExe = "";
     aBase = "";
     aEjecuta = "";
|FIN;

|PROCESO CopiaRemoto;
     aContiene = aOrg;
     |ESPECIFICA "MD5", aContiene;
     aMd5Org = FSalida;
     aContiene = aDes;
     |ESPECIFICA "REMOTOMD5", aContiene;
     aMd5Des = FSalida;
     |SI aMd5Org ! aMd5Des; |ENVIA_FICHERO aOrg, aDes; |FINSI;
|FPRC;

|PROCESO CopiaLocal;
     aContiene = aOrg;
     |ESPECIFICA "MD5", aContiene;
     aMd5Org = FSalida;
     aContiene = aDes;
     |ESPECIFICA "MD5", aContiene;
     aMd5Des = FSalida;
     |SI aMd5Org ! aMd5Des; |COPIA_FICHERO aOrg, aDes; |FINSI;
|FPRC;

|PROCESO CopiaExe;
     aExe = "dsprint.exe";
     |DBASE aAlfa;
     aOrg = aAlfa + "plugins/" + aExe;
     |SI aIP = "";
          |DBASS aBase;
          aAlfa = aBase + "bin/";
          aDes = aAlfa + aExe;
          |HAZ CopiaLocal;
     |SINO;
          |ESPECIFICA "RBASS", aLocal;
          aBase = aLocal;
          aAlfa = aBase + "bin/";
          aDes = aAlfa + aExe;
          |HAZ CopiaRemoto;
     |FINSI;
|FPRC;

|PROCESO Imprime;
     aImp = #81#26; |QBF aImp;
     aFic = #81#25; |QBF aFic;
     aAlfa = aFic % -101;
     |SI aAlfa ! "/"; |Y aAlfa ! "\"; aFic = aFic + "/"; |FINSI;

     aFic = aFic + #85#11; |QBF aFic;

     |XABRE "E", aFic, 0;
     |SI FSalida < 0; |ACABA; |FINSI;

     aExe = "dsprint.exe";
     |DBASE aAlfa;
     aOrg = aAlfa + "plugins/" + aExe;
     |SI aIP = "";
          |DBASS aBase;
          aAlfa = aBase + "bin/";
          aExe = aAlfa + aExe;
          aDes = "\DOCUMENTOS\DSCOMER9\";
          |MKDIR aDes;
          aDes = aDes + #85#11; |QBF aDes;
          |COPIA_FICHERO aFic, aDes;
     |SINO;
          |ESPECIFICA "RBASS", aLocal;
          aBase = aLocal;
          aAlfa = aBase + "bin/";
          aExe = aAlfa + aExe;
          aDes = "\DOCUMENTOS\DSCOMER9\";
          |RMKDIR aDes;
          aDes = aDes + #85#11;
          |ENVIA_FICHERO aFic, aDes;
     |FINSI;
     |SI FSalida = 0;
          aEjecuta = aExe + " " + aDes + " " + &34 + aImp + &34;
          |SI aIP = "";
               |SYSTEM aEjecuta;
          |SINO;
               |RSYSTEM aEjecuta;
          |FINSI;
     |SINO;
          |MENAV "0000Error al copiar fichero...";
     |FINSI;
|FPRC;

|PROCESO AlbaLin;
     |SI #91#79 = "S";
          #85#0 = #91#2;
          #85#1 = #91#3;
          #85#2 = #91#49;
          |LEE 000#85=;
          |SI FSalida = 0;
               |HAZ Imprime;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE AlbaLin;
     #91#1;
     ;
     aSer, nNum, 001;
     aSer, nNum, 999;
     ;
     NULL, AlbaLin;
|FIN;

|PROGRAMA;
     aAlfa = PARAMETRO % 105; aSer = aAlfa;
     aAlfa = PARAMETRO % 606; nNum = aAlfa;
     aAlfa = PARAMETRO % 1203; nLin = aAlfa;

     |ABRE #81; |LEE 000#81p; |CIERRA #81;

     aIP = ""; |IP_REMOTO aIP; |QBF aIP;
     |HAZ CopiaExe;

     |ABRE #85;
     |BUCLE AlbaLin;
     |CIERRA #85;
|FPRO;
