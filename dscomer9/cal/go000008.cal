|FICHEROS;
     go000008 #0;
     gocercap #1;
     gocerlip #2;
     gocerhip #3;
     go000004 #4;
     go000005 #5;

     go000009 #9,MANTE;  || Consumidos
     go000010 #10,MANTE; || Sin consumo
     go000011 #11,MANTE; || Consumido sin Presupuesto

     go000012 #12; || Articulos Presupuesto Agrupados por articulo
     go000013 #13; || Articulos Presupuesto detallado
     go000014 #14; || Historico de Sustitutivos

     go000015 #15; || Para guardar
     go000016 #16;
     go000017 #17;
     go000018 #18;
     goparame #100;
     go000020 #120;
     go000021 #121;
     go000022 #122; ||Historico

     go000019 #19;  ||Articulos Excluidos
     gopre004 #20;
     gopartia #21;
     gopre003 #22;
     gopre001 #23;
     gopre002 #24;
     goarticu #25;
     gopre021 #26;
     gopartia@;     || Tmp registros tratados del gopartia
     goarticu@;     || Tmp articulos gopartia

     referen@; || Auxliares
     refere1@;
     refere2@;
     refere3@;
|FIN;

|VARIABLES;
     &eaSerPre = "";
     &enNumPre = 0;
     &eaCapi = "";
     &enAgrupa = 0;
     &eaDesCa = "";
     aSustiAnt = "";
     nNumLinea = 0;
     i = 0;
     nSal = 0;
     nForma = 0;
     nLin11 = 0;
     nUniReparto = 0;
     nSwPonSusti = 0;
     nTotaPen = 0;
     nLinSus = 0;
     nQuita = 0;
     nPen = 0;
     nCal = 0;
     aCam12 = "";
     aCam0 = "";
     aCam1 = "";
     aCam13 = "";
     aCam11 =  "";
     aCam6 = "";
     aEsBlanco = "";
     nHay = 0;
     nLinea = 0;
     &nDeci_Medi = 0;
     &nDeci_Meda = 0;
     aDef = "";
     nUni = 0;
     nUniAnt = 0;
     aDesParti = "";
     aCapi = "";
     aParti = "";
     aTmp1 = "";
     aTmp2 = "";
     aTmp9 = "";
     aTmp10 = "";
     aTmp11 = "";
     aTmp12 = "";
     aTmp13 = "";
     aTmp11_2 = "";
     aFecha = "";
     aAlfa = "";
     &Tempo = "";
     {-1}aMenu = "";
     aMenu1 = "2400";
     aMenu2 = "1";
     aMenu3 = " ";
     aMenu4 = "CSPAnG";
     aMenu5 = " Consumidos ";
     aMenu6 = " Sin Consumo ";
     aMenu7 = " Sin Presupuesto ";
     aMenu8 = " Aceptar ";
     aMenu9 = " Cancelar";
     aMenu19 = "Guardar";
     nHayAlgo = 0;
     nAgrupa = 0;
     aD = "";
     aH = "";
     aArti = "";
     nActualizado = 0;
     nInfor = -1;
     nImpre = -1;
     &enUni = 0; || Para el informe
     &enTipo = 0;||  ''
     nPrime = 0;
|FIN;

|PROCESO FinImprime;
     |SI nPrime = 0; |ACABA; |FINSI;
     |SI nInfor = 0;
          |PIEINF;
          |FININF;
     |FINSI;
     |SI nImpre = 0;
          |FINIMP;
     |FINSI;
|FPRC;

|PROCESO Imprime;
     |SI nPrime = 0;
          nPrime = 1;
          |CONFI "0000SImprimir Errores reparto:";
          |SI FSalida = 0;
               |IMPRE 0;
               nImpre = FSalida;
               |SI FSalida = 0;
                    |INFOR "go000008";
                    nInfor = FSalida;
               |FINSI;
          |FINSI;
     |FINSI;
     |SI nInfor = 0;
          |PRINT;
     |FINSI;
|FPRC;

|PROCESO RefeGopartia;
     |SI #gopartia@#34 = "T"; ||Los de nominas no se tratan
          |ACABA;
     |FINSI;
     |SI nUni = 0; |ACABA; |FINSI;

     #21#34 = #gopartia@#34;
     #21#4 = #gopartia@#4;
     #21#5 = #gopartia@#5;
     #21#6 = #gopartia@#6;
     #21#7 = #gopartia@#7;
     |LEE 121#21=;
     |SI FSalida ! 0;
          enTipo = 4; |HAZ Imprime;
          |ACABA;
     |FINSI;

     |SI #21#10 < 0; |ACABA; |FINSI;    ||Negativa

     |SI nUni ] #21#10;
          nUni = nUni - #21#10;
          #21#8 = aParti;
          #21#9 = aDesParti;
          #21#33 = aCapi;
          |GRABA 020#21a;
          |LIBERA #21;
     |SINO;
          #21#10 = #21#10 - nUni;       || lo que queda pendiente
          |GRABA 020#21a;
          |LIBERA #21;

          |SALVA_DATOS #21;             || lo asignado (a una nueva linea)
          |PARA FSalida = 0; |SI FSalida = 0; |HACIENDO;
               nLinea = #21#7;
               |SI #21#34 ! #gopartia@#34; |O #21#4 ! #gopartia@#4;
                         |O #21#5 ! #gopartia@#5; |O #21#6 ! #gopartia@#6;
                         |O #21#7 ! #gopartia@#7;
                    |SAL;
               |FINSI;
               |LEE 000#21s;
          |SIGUE;
          |REPON_DATOS #21;

          #21#7 = nLinea + 1;
          #21#8 = aParti;
          #21#9 = aDesParti;
          #21#33 = aCapi;
          |GRABA 020#21n;
     |FINSI;
|FPRC;

|DEFBUCLE RefeGopartia;
     #gopartia@#1005;
     8, 33, 20;
     " ", "     ", 000001, 001, 001, aD, aD, aArti;
     "z", "zzzzz", 999999, 999, 999, aH, aH, aArti;
     ;
     NULL, RefeGopartia;
|FIN;

|PROCESO AsigSinPresu;
     |SI #11#5 = 0;
          |ACABA;
     |FINSI;
     aArti = #11#2;
     nUni = #11#5;
     aCapi = #11#0;
     aParti = #11#1;
     aDesParti = #11#6;
     |BUCLE RefeGopartia;
     |SI nUni ! 0;
          enTipo = 3;
          enUni = nUni;
          |HAZ Imprime;
     |FINSI;
|FPRC;

|PROCESO AsigSinConsumo;
     |SI #10#8 = 0;
          |ACABA;
     |FINSI;
     aArti = #10#5;
     nUni = #10#8;
     aCapi = #10#0;
     aParti = #10#1;
     aDesParti = #10#9;
     |BUCLE RefeGopartia;
     |SI nUni ! 0;
          enTipo = 2;
          enUni = nUni;
          |HAZ Imprime;
     |FINSI;
|FPRC;

|PROCESO AsigConsumido;
     |SI #9#8 = "T"; |O #9#7 = 0;
          |ACABA;
     |FINSI;
     aArti = #9#2;
     nUni = #9#7;
     aCapi = #9#0;
     aParti = #9#1;
     aDesParti = #9#9;
     |BUCLE RefeGopartia;
     |SI nUni ! 0;
          enTipo = 1;
          enUni = nUni;
          |HAZ Imprime;
     |FINSI;
|FPRC;

|DEFBUCLE AsigConsumido;
     #9#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, AsigConsumido;
|FIN;

|DEFBUCLE AsigSinConsumo;
     #10#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, AsigSinConsumo;
|FIN;

|DEFBUCLE AsigSinPresu;
     #11#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, AsigSinPresu;
|FIN;

|PROCESO Crealos;
     |SI nActualizado = 0;
          |MENAV "0000Ya esta actualizado...";
          |ACABA;
     |FINSI;
     |HAZ Guardalo;

     |ABRE #122;
     #122#0 = #0#0;
     #122#1 = #0#1;
     #122#2 = #0#2;
     #122#3 = #0#3;
     #122#4 = Usuario % 810;
     #122#5 = ~;
     |GRABA 020#122n;
     |CIERRA #122;

     |ABRE #21;
     |BUCLE AsigConsumido;
     |BUCLE AsigSinConsumo;
     |BUCLE AsigSinPresu;
     |CIERRA #21;

     |HAZ FinImprime;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO NoPresupu;
     #goarticu@#0 = #13#2;
     |LEE 000#goarticu@.=;
     |SI FSalida = 0; |ACABA; |FINSI;

     |DDEFECTO #10;
     #10#0 = #13#0;
     #10#1 = #13#1;
     #10#2 = #13#2;
     #10#14 = 1;
     |LEE 101#10=;
     |SI FSalida ! 0; |GRABA 020#10b; |FINSI;
     #10#3 = #13#3;
     #10#4 = #10#4 + #13#4;
     #10#9 = #13#6;
     #10#10 = #13#7;
     #10#11 = #13#8;
     #10#12 = #13#9;
     |GRABA 020#10a;
     |LIBERA #10;
|FPRC;

|DEFBUCLE NoPresupu;
     #13#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, NoPresupu;
|FIN;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO Consumidos;
     |DDEFECTO #24; |SELECT #3#24;
     #24#0 = #21#0;
     #24#1 = #21#1;
     #24#3 = aCapi;
     |LEE 000#24=;

     |DDEFECTO #26;
     #26#0 = #24#0;
     #26#1 = #24#1;
     #26#2 = #24#14;
     |LEE 000#26=;

     |DDEFECTO #22; |SELECT #2#22;
     #22#0 = #21#0;
     #22#1 = #21#1;
     #22#2 = aCapi;
     #22#4 = aParti;
     |LEE 000#22=;
     |DDEFECTO #9;
     #9#0 = aCapi;
     #9#1 = aParti;
     #9#2 = #21#20;
     |LEE 101#9=;
     |SI FSalida ! 0; |GRABA 020#9b; |FINSI;
     #9#3 = #21#30;
     #9#4 = #13#5;    || presu
     #9#5 = #13#4;    || calculo
     |SI #21#34 = "T"; |O #21#34 = "S";
          #9#6 = #9#6 + #21#10;
     |SINO;
          #9#6 = -#5#6;    || asignadas
     |FINSI;
     #9#7 = #9#6;     || a descontar
     #9#8 = #21#34;
     #9#9 = #22#5;   ||#21#9;
     #9#10 = #24#13;
     #9#11 = #24#14;
     #9#12 = #26#3;
     |GRABA 020#9a;
     |LIBERA #9;
|FPRC;

|PROCESO SinPresu;
     |DDEFECTO #24; |SELECT #3#24;
     #24#0 = #21#0;
     #24#1 = #21#1;
     #24#3 = aCapi;
     |LEE 000#24=;

     |DDEFECTO #26;
     #26#0 = #24#0;
     #26#1 = #24#1;
     #26#2 = #24#14;
     |LEE 000#26=;

     |DDEFECTO #22; |SELECT #2#22;
     #22#0 = #21#0;
     #22#1 = #21#1;
     #22#2 = aCapi;
     #22#4 = aParti;
     |LEE 000#22=;

     |DDEFECTO #11;
     #11#2 = #21#20;
     |SELECT #2#11;
     |LEE 101#11=;
     |SI FSalida ! 0;
          nLinea = nLinea + 1;
          #11#7 = nLinea;
          |GRABA 020#11b;
     |FINSI;
     #11#0 = aCapi;
     #11#1 = aParti;
     |SI FSalida ! 0; |GRABA 020#11b; |FINSI;
     #11#3 = #21#30;
     #11#4 = -#5#6;   || pendientes
     #11#5 = 0;               || asignadas
     #11#6 = #22#5;
     #11#8 = -#5#6;  ||consumidas
     #11#11 = #24#13;
     #11#12 = #24#14;
     #11#13 = #26#3;
     |SI #11#8 = 0;
          |BORRA 020#11c;
     |SINO;
          |GRABA 020#11a;
     |FINSI;

     |LIBERA #11;
|FPRC;

|PROCESO gopartiaNormal;
     |DDEFECTO #5;
     #5#3 = #0#2;
     #5#0 = #0#3;
     #5#1 = #21#20;
     |LEE 000#5=;

     |SI #21#34 = "T";        || Se introducen desde nominas,
          |HAZ Consumidos; |ACABA;  || solo son para consulta
     |FINSI;
     |SI #21#34 = "S";
          |HAZ Consumidos; |ACABA;
     |FINSI;

     #12#2 = #21#20;
     |LEE 000#12=;
     |SI FSalida ! 0;    || No esta en el presupuesto
          |HAZ SinPresu;
     |SINO;
          #5#3 = #0#2;
          #5#0 = #0#3;
          #5#1 = #21#20;
          |LEE 000#5=;
          |SI FSalida = 0;    || con consumo
               |HAZ Consumidos;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO gopartiaBlanco;
     aCapi = #13#0;
     aParti = #13#1;
     |HAZ gopartiaNormal;
     nHayAlgo = 1;
|FPRC;

|DEFBUCLE gopartiaBlanco;
     #13#2;
     ;
     #21#20;
     #21#20;
     ;
     NULL, gopartiaBlanco;
|FIN;

|PROCESO gopartia;
     #19#0 = #0#0;
     #19#1 = #0#1;
     #19#2 = #21#20;
     |LEE 000#19=;
     |SI FSalida = 0; |ACABA; |FINSI; ||Articulo excluido

     aAlfa = #21#8 + #21#33; |QBF aAlfa;
     |SI aAlfa ! ""; |Y #21#34 ! "T";
          |ACABA;
     |FINSI;

     ||--- graba los 2 temporales
     |SALVA_DATOS #21;
     |REPON_DATOS #gopartia@;
     |LEE 000#gopartia@.=;
     |SI FSalida ! 0;|GRABA 020#gopartia@.n; |FINSI;
     #goarticu@#0 = #21#20;
     |LEE 000#goarticu@.=;
     |SI FSalida ! 0;
          |DDEFECTO #25;
          #25#0 = #21#20;
          |LEE 000#25=;
          |SALVA_DATOS #25;
          |REPON_DATOS #goarticu@;
          |GRABA 020#goarticu@.n;
     |FINSI;

     |DDEFECTO #13;
     |SI aEsBlanco = "S";
          aCapi = "";
          aParti = "";
          |SELECT #2#13;
          #13#2 = #21#20;
          |LEE 000#13=;
          nHayAlgo = 0;
          |BUCLE gopartiaBlanco;
          |SI nHayAlgo = 0;
               |HAZ gopartiaNormal;
          |FINSI;
     |SINO;
          |SELECT #1#13;
          #13#0 = aCapi;
          #13#1 = aParti;
          #13#2 = #21#20;
          |LEE 000#13=;
          |HAZ gopartiaNormal;
     |FINSI;
|FPRC;

|DEFBUCLE gopartia;
     #21#3;
     28;
     #1#4, #1#5, #1#0, #1#1, aCapi, aParti, #2#8;
     #1#4, #1#5, #1#0, #1#1, aCapi, aParti, #2#9;
     ;
     NULL, gopartia;
|FIN;

|PROCESO gocerhip2;
     aEsBlanco = "N";
     aCapi = #3#14;
     aParti = #3#4;
     |BUCLE gopartia;
     aEsBlanco = "S";
     aCapi = "";
     aParti = "";
     |BUCLE gopartia;
|FPRC;

|DEFBUCLE gocerhip2;
     #3#1;
     ;
     #2#0, #2#1, #2#2, 001;
     #2#0, #2#1, #2#2, 999;
     ;
     NULL, gocerhip2;
|FIN;

|PROCESO gocerlip;
     |BUCLE gocerhip2;
|FPRC;

|DEFBUCLE gocerlip;
     #2#1;
     ;
     #1#0, #1#1, 001;
     #1#0, #1#1, 999;
     ;
     NULL, gocerlip;
|FIN;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO gopre004;
     #19#0 = #20#0;
     #19#1 = #20#1;
     #19#2 = #20#5;
     |LEE 000#19=;
     |SI FSalida = 0; |ACABA; |FINSI; || Articulos Excluidos

     |SELECT #2#22;
     #22#0 = #20#0;
     #22#1 = #20#1;
     #22#2 = #20#2;
     #22#4 = #20#3;
     |LEE 020#22=;

     |DDEFECTO #24; |SELECT #3#24;
     #24#0 = #20#0;
     #24#1 = #20#1;
     #24#3 = #20#2;
     |LEE 000#24=;

     |DDEFECTO #26;
     #26#0 = #24#0;
     #26#1 = #24#1;
     #26#2 = #24#14;
     |LEE 000#26=;

     |DDEFECTO #22; |SELECT #2#22;
     #22#0 = #20#0;
     #22#1 = #20#1;
     #22#2 = #20#2;
     #22#4 = #20#3;
     |LEE 000#22=;

     |DDEFECTO #12;
     #12#2 = #20#5;
     |LEE 101#12=;
     |SI FSalida ! 0; |GRABA 020#12b; |FINSI;
     #12#0 = #20#2;
     #12#1 = #20#3;
     #12#3 = #20#6;
     #12#4 = #12#4 + (#20#8 * #3#7);
     #12#5 = #12#5 + (#20#8 * #22#7);
     #12#6 = #3#5;
     #12#7 = #24#13;
     #12#8 = #24#14;
     #12#9 = #26#3;
     |GRABA 020#12a;
     |LIBERA #12;

     |DDEFECTO #13;
     #13#0 = #20#2;
     #13#1 = #20#3;
     #13#2 = #20#5;
     |LEE 101#13=;
     |SI FSalida ! 0; |GRABA 020#13b; |FINSI;
     #13#3 = #20#6;
     #13#4 = #13#4 + (#20#8 * #3#7);
     #13#5 = #13#5 + (#20#8 * #22#7);
     #13#6 = #3#5;
     #13#7 = #24#13;
     #13#8 = #24#14;
     #13#9 = #26#3;
     |GRABA 020#13a;
     |LIBERA #13;
|FPRC;

|DEFBUCLE gopre004;
     #20#1;
     ;
     #3#0, #3#1, #3#14, #3#4, 001;
     #3#0, #3#1, #3#14, #3#4, 999;
     ;
     NULL, gopre004;
|FIN;

|PROCESO gocerhip;
     |BUCLE gopre004;
|FPRC;

|DEFBUCLE gocerhip;
     #3#1;
     ;
     #0#0, #0#1, 001, 001;
     #0#0, #0#1, 999, 999;
     ;
     NULL, gocerhip;
|FIN;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO Pendientes;
     |SALVA_DATOS #4;
     |REPON_DATOS #referen@;
     |GRABA 020#referen@.n;
     nHay = 1;
|FPRC;

|DEFBUCLE Pendientes;
     #4#1;
     1, 8;
     #0#2, "01.01.0000", "S", 0;
     #0#2, "31.12.9999", "S", 0;
     ;
     NULL, Pendientes;
|FIN;

|PROCESO Actualiza11Global;
     |ABRE #11;
     #11#2 = #10#5;
     #11#7 = 1;
     |LEE 101#11];
     |PARA; |SI FSalida = 0; |Y #11#2 = #10#5; |Y nUni > 0; |HACIENDO;
          |SI nUni > #11#4;
               nQuita = #11#4;
               #11#4 = #11#4 - nUni;
               #11#10 = #11#10 + nUni;
               nUni = nUni - nQuita;
          |SINO;
               #11#4 = #11#4 - nUni;
               #11#10 = #11#10 + nUni;
               nUni = 0;
          |FINSI;
          |SI #11#10 ] #11#8;
               #11#9 = "N";
          |SINO;
               #11#9 = "S";
          |FINSI;
          |GRABA 020#11a;
          |LEE 000#11a;
     |SIGUE;
     |CIERRA #11;
|FPRC;

|PROCESO Actualiza11;
     |ABRE #11;
     #11#2 = #10#5;
     #11#7 = 1;
     |LEE 101#11];
     |SI FSalida = 0; |Y #11#2 = #10#5;
          #11#10 = #11#10 + nUni;
          #11#4 = #11#4 - nUni;
          |SI #11#10 ] #11#8;
               #11#9 = "N";
          |SINO;
               #11#9 = "S";
          |FINSI;
          |GRABA 020#11a;
     |FINSI;
     |CIERRA #11;
|FPRC;

|PROCESO Tecla9; |TIPO 0;
     |SI FSalida = 0; |Y #9Campo = Contenido; |Y #9#8 ! "T";
          |ENCAMPO #7#9;
          |SI FSalida = 0; |GRABA 020#9a; |FINSI;
     |FINSI;
|FPRC;

|PROCESO TotaCalcu;
     nCal = nCal + #refere3@#4;
|FPRC;

|DEFBUCLE TotaCalcu;
     #refere3@#1004;
     ;
     "                    ", "                    ", #10#2, 001;
     "zzzzzzzzzzzzzzzzzzzz", "zzzzzzzzzzzzzzzzzzzz", #10#2, 999;
     ;
     NULL, TotaCalcu;
|FIN;

|PROCESO Reparte;
     nUni = (nTotaPen * #refere3@#4 / nCal) ! nDeci_Medi;
     nUniReparto = nUniReparto - nUni;
     #refere3@#5 = #10#5;
     #refere3@#6 = #10#6;
     #refere3@#8 = #refere3@#8 + nUni;
     |HAZ PendientesSin;
     #refere3@#7 = nPen;
     |GRABA 020#refere3@.a;
     |LIBERA #refere3@;

     |HAZ Actualiza11Global;
|FPRC;

|PROCESO FinReparte;
     |SI nUniReparto ! 0;
          nUni = nUniReparto;
          |HAZ Actualiza11;
     |FINSI;
|FPRC;

|DEFBUCLE Reparte;
     #refere3@#1004;
     ;
     "                    ", "                    ", #10#2, 001;
     "zzzzzzzzzzzzzzzzzzzz", "zzzzzzzzzzzzzzzzzzzz", #10#2, 999;
     be;
     NULL, Reparte, NULL, NULL, FinReparte;
|FIN;

|PROCESO Reparte10;
     nCal = 0;
     nPen = 0;
     |DDEF aAlfa;
     aAlfa = aAlfa + "go000010";
     |CARGA_DEF aAlfa, refere3@;
     |SI FSalida = 0;
          |NOME_DAT #refere3@#aTmp10#;
          nUniReparto = nUni;
          nTotaPen = nUni;
          |BUCLE TotaCalcu;
          |BUCLE Reparte;
          |DESCARGA_DEF #refere3@;
     |FINSI;
|FPRC;

|PROCESO GraSustituto;
     aAlfa = #10#2; |QBF aAlfa; |SI aAlfa = ""; |ACABA; |FINSI;
     aAlfa = #10#5; |QBF aAlfa; |SI aAlfa = ""; |ACABA; |FINSI;
     |ABRE #14;
     |SELECT #2#14;
     #14#0 = #10#2;
     #14#3 = #10#5;
     |LEE 000#14=;
     |SI FSalida ! 0;
          |SELECT #1#14;
          #14#0 = #10#2;
          #14#2 = 999;
          |LEE 000#14];
          |SI FSalida = 0;
               |LEE 000#14a;
          |SINO;
               |LEE 000#14u;
          |FINSI;
          |SI FSalida = 0; |Y #14#0 = #10#2;
               nLinSus = #14#2 + 1;
          |SINO;
               nLinSus = 1;
          |FINSI;
          |DDEFECTO #14;
          #14#0 = #10#2;
          #14#1 = #10#3;
          #14#2 = nLinSus;
          #14#3 = #10#5;
          #14#4 = #10#6;
          |GRABA 020#14n;
     |FINSI;
     |CIERRA #14;
|FPRC;

|PROCESO EstaConsumido;
     |ABRE #9;
     #9#0 = #10#0;
     #9#1 = #10#1;
     #9#2 = #10#2;
     |LEE 000#9=;
     nSal = FSalida;
     |CIERRA #9;
     FSalida = nSal;
|FPRC;

|PROCESO Actualiza9;
     |ABRE #9;
     #9#0 = #10#0;
     #9#1 = #10#1;
     #9#2 = #10#5;
     |LEE 101#9=;
     |SI FSalida = 0;
          |DDEFECTO #22;
          |ABRE #22; |SELECT #2#22;
          #22#0 = #0#0;
          #22#1 = #0#1;
          #22#2 = #10#0;
          #22#4 = #10#1;
          |LEE 000#22=;
          |CIERRA #22;
          |DDEFECTO #20;
          |ABRE #20; |SELECT #3#20;
          #20#0 = #0#0;
          #20#1 = #0#1;
          #20#3 = #10#1;
          #20#5 = #10#2;
          |LEE 000#20=;
          |CIERRA #20;

          |SI nForma = 1;
               #9#4 = #9#4 + (#20#8 * #22#7);
               #9#5 = #9#5 + #10#4;
          |SINO;
               #9#4 = #9#4 - (#20#8 * #22#7);
               #9#5 = #9#5 - #10#4;
          |FINSI;
          |GRABA 020#9a;
     |FINSI;
     |CIERRA #9;
|FPRC;

|PROCESO DupliLinea;
     |SI #referen@#2 = #10#2; |Y #referen@#14 = 1;
          |SALVA_FICHA #referen@;

          #referen@#0 = #10#0;
          #referen@#1 = #10#1;
          #referen@#2 = #10#2;
          #referen@#14 = 999;
          |LEE 000#referen@.];
          |SI FSalida = 0;
               |LEE 000#referen@.a;
          |SINO;
               |LEE 000#referen@.u;
          |FINSI;
          |SI FSalida = 0; |Y #referen@#0 = #10#0; |Y #referen@#1 = #10#1;
                    |Y #referen@#2 = #10#2;
               nLinea = #referen@#14 + 1;
          |SINO;
               nLinea = 1;
          |FINSI;

          |REPON_FICHA #referen@;
          #referen@#14 = nLinea;
          #referen@#5 = "";
          |GRABA 020#referen@.n;
     |FINSI;
|FPRC;

|DEFBUCLE DupliLinea;
     #referen@#1004;
     ;
     aD, aD, aD, 001;
     aH, aH, aH, 999;
     ;
     NULL, DupliLinea;
|FIN;

|PROCESO Excluir;
     |BORRA 020#referen@.a;
|FPRC;

|DEFBUCLE Excluir;
     #referen@#1004;
     2;
     aD, aD, aD, 001, #10#2;
     aH, aH, aH, 999, #10#2;
     ;
     NULL, Excluir;
|FIN;

|PROCESO Tecla10_11; |TIPO 11;
     |SI FSalida = 10; ||F2 duplicar
          |DDEF aAlfa;
          aAlfa = aAlfa + "go000010";
          |CARGA_DEF aAlfa, referen@;
          |SI FSalida = 0;
               |NOME_DAT #referen@#aTmp10#;
               |BUCLE DupliLinea;
               |DESCARGA_DEF #referen@;
          |FINSI;
          |PONCONTROL 23, "SI";
     |FINSI;
     |SI FSalida = 13; ||F5 excluir
          |DDEF aAlfa;
          aAlfa = aAlfa + "go000010";
          |CARGA_DEF aAlfa, referen@;
          |SI FSalida = 0;
               |NOME_DAT #referen@#aTmp10#;
               |BUCLE Excluir;
               |DESCARGA_DEF #referen@;
          |FINSI;
          |ABRE #19;
          #19#0 = #0#0;
          #19#1 = #0#1;
          #19#2 = #10#2;
          #19#3 = #10#3;
          |GRABA 040#19n;
          |CIERRA #19;
          |PONCONTROL 23, "SI";
     |FINSI;
|FPRC;

|PROCESO Tecla10_0; |TIPO 0;
     |SI FSalida = 0; |Y #10Campo = Contenido;
          aSustiAnt = #10#5; |QBF aSustiAnt;
          nUniAnt = #10#8;
          nUni = -#10#8;
          |HAZ Actualiza11;
          nForma = -1; |HAZ Actualiza9;
        |ET ET10;
          |ENCAMPO #5#10;
          |SI FSalida = 1; |O FSalida = 7;
               nUni = nUniAnt; |HAZ Actualiza11;
               nForma = -1; |HAZ Actualiza9;
               |ACABA;
          |FINSI;
          |ENCAMPO #8#10;
          |SI FSalida = 2; |VETE ET10; |FINSI;
          |SI FSalida = 0;
               |HAZ GraSustituto;
               |SI aSustiAnt = "";
                    |SI #10#8 = 0; || Si unidades 0 no reparte porcentaje
                         FSalida = 1;
                    |SINO;
                         |CONFI "0000SRepartir por porcentaje?";
                    |FINSI;
               |SINO;              || Si ya tiene sustitutivo no reparte porcentaje
                    FSalida = 1;
               |FINSI;
               nUni = #10#8;
               |SI FSalida ! 0;
                    |GRABA 020#10a;
                    |HAZ Actualiza11;
                    nForma = 1; |HAZ Actualiza9;
                    |SI nSwPonSusti = 1; |HAZ PonSustitu; |FINSI;
                    |LEE 000#10=;
                    |PONCONTROL 23, "SI";
               |SINO;
                    |HAZ Reparte10;
                    |LEE 000#10=;
                    |PONCONTROL 23, "SI";
               |FINSI;
          |SINO;
               nUni = nUniAnt; |HAZ Actualiza11;
               nForma = -1; |HAZ Actualiza9;
          |FINSI;
     |FINSI;
     nSwPonSusti = 0;
|FPRC;

|PROCESO Tecla11; |TIPO 0;
     |SI FSalida = 0; |Y #11Campo = Contenido;
          |SI #11#4 = 0;
               |MENAV "0000No hay unidades pendientes..";
               |SI #11#8 ! 0;
                    |CONFI "0000SDesasignar unidades?";
                    |SI FSalida = 0;
                         #11#4 = #11#4 + #11#5;
                         #11#5 = 0;
                         |PINTA #11#4;
                         |PINTA #11#5;
                         |GRABA 020#11a;
                    |FINSI;
               |FINSI;
               |ERROR; |ACABA;
          |FINSI;
          |SI #11#5 ! 0;
               |MENAV "0000Tiene unidades asignadas...";
               |ERROR; |ACABA;
          |FINSI;
      |ET ET110;
          |ENCAMPO #0#11;
          |SI FSalida = 1; |O FSalida = 7; |ACABA; |FINSI;
      |ET ET111;
          |ENCAMPO #1#11;
          |SI FSalida = 1; |O FSalida = 7; |ACABA; |FINSI;
          |SI FSalida = 2; |VETE ET110; |FINSI;
          |SI #11#5 = 0;
               #11#5 = #11#8;
          |FINSI;
          |ENCAMPO #5#11;
          |SI FSalida = 1; |O FSalida = 7; |ACABA; |FINSI;
          |SI FSalida = 2; |VETE ET111; |FINSI;
          |SI #11#5 = 0; |ACABA; |FINSI;

          || Se crea una nueva linea y actualiza la actual
          aCam12 = #11#12;
          aCam0 = #11#0;
          aCam1 = #11#1;
          aCam13 = #11#13;
          aCam11 = #11#11;
          aCam6 = #11#6;
          |DDEF aAlfa; aAlfa = aAlfa + "go000011";
          |CARGA_DEF aAlfa, referen@;
          |SI FSalida = 0;
               |NOME_DAT #referen@#aTmp11#;
               |ABRE #referen@;
               #referen@#2 = #11#2;
               #referen@#7 = 999;
               |LEE 000#referen@.];
               |SI FSalida = 0;
                    |LEE 000#referen@.a;
               |SINO;
                    |LEE 000#referen@.u;
               |FINSI;
               nLin11 = #referen@#7 + 1;
               |SI FSalida = 0; |Y #referen@#2 = #11#2;
                    |DDEFECTO #referen@;
                    #referen@#2 = #11#2;
                    #referen@#3 = #11#3;
                    #referen@#4 = #11#4 - #11#5;         ||Pend
                    #referen@#7 = nLin11;
                    #referen@#8 = #11#8 - #11#5;         ||Consu
                    #referen@#14 = "S";
                    |SI #referen@#4 ! 0; || no hay pendientes no crea linea
                         |GRABA 020#referen@.n;
                    |FINSI;
               |SINO;
                    || Nunca puede pasar esto
               |FINSI;
               nUni = #11#5;
               |LEE 020#11=;
               #11#4 = #11#4 - nUni;
               #11#5 = nUni;
               #11#12 = aCam12;
               #11#0 = aCam0;
               #11#1 = aCam1;
               #11#13 = aCam13;
               #11#11 = aCam11;
               #11#6 = aCam6;
               |GRABA 020#11a;

               |CIERRA #referen@;
               |DESCARGA_DEF #referen@;

               |PONCONTROL 23, "SI";
               |PTEC 809; ||Flecha abajo
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Fun11; |TIPO 11;
     |SI FSalida = 13;   ||F5
          |SI #11#14 = "N";
               |MENAV "0000Solo se pueden borrar las lineas nuevas creadas...";
               |ERROR; |ACABA;
          |FINSI;

          |CONFI "0000NBorrar linea?";
          |SI FSalida ! 0; |ACABA; |FINSI;

          || Acumula a la linea anterior
          |DDEF aAlfa; aAlfa = aAlfa + "go000011";
          |CARGA_DEF aAlfa, referen@;
          |SI FSalida = 0;
               |NOME_DAT #referen@#aTmp11#;
               |ABRE #referen@;
               #referen@#2 = #11#2;
               #referen@#7 = #11#7;
               |LEE 000#referen@.=;
               |LEE 000#referen@.a;
               |SI FSalida = 0; |Y #referen@#2 = #11#2;
                    #referen@#4 = #referen@#4 + #referen@#5;
                    #referen@#5 = 0;
                    |GRABA 020#referen@.a;
               |FINSI;
               |CIERRA #referen@;
               |DESCARGA_DEF #referen@;

               |BORRA 020#11a;     || Borra la actual


               |PONCONTROL 23, "SI" ;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Mi22;
     #22#0 = #0#0;
     #22#1 = #0#1;
     #22#2 = #11#0;
     #22#4 = " " * 20;
|FPRC;

|PROCESO Ma22;
     #22#0 = #0#0;
     #22#1 = #0#1;
     #22#2 = #11#0;
     #22#4 = "z" * 20;
|FPRC;

|PROCESO Mi26;
     #26#0 = #0#0;
     #26#1 = #0#1;
     #26#2 = 001;
|FPRC;

|PROCESO Ma26;
     #26#0 = #0#0;
     #26#1 = #0#1;
     #26#2 = 999;
|FPRC;

|PROCESO PresCapi;
     |SI nAgrupa > 0;
          |SI #24#14 ! nAgrupa; |ACABA; |FINSI;
     |FINSI;
     nNumLinea = nNumLinea + 1;
     |SALVA_DATOS #24;
     |REPON_DATOS #refere1@;
     #refere1@#2 = nNumLinea;
     |GRABA 020#refere1@.n;
|FPRC;

|DEFBUCLE PresCapi;
     #24#1;
     ;
     #0#0, #0#1, 001;
     #0#0, #0#1, 999;
     ;
     NULL, PresCapi;
|FIN;

|PROCESO PresParti;
     nNumLinea = nNumLinea + 1;
     |SALVA_DATOS #22;
     |REPON_DATOS #refere1@;
     #refere1@#3 = nNumLinea;
     |GRABA 020#refere1@.n;
|FPRC;

|DEFBUCLE PresParti;
     #22#1;
     ;
     #0#0, #0#1, #11#0, 001;
     #0#0, #0#1, #11#0, 999;
     ;
     NULL, PresParti;
|FIN;

|PROCESO CheqCapi11; |TIPO 0;
     aAlfa = #11#0; |QBF aAlfa;
     |SI aAlfa = "";
          eaCapi = #11#0;
          enAgrupa = #26#2;
          eaSerPre = #0#0;
          enNumPre = #0#1;
          |HAZ MuestraAgrupa;
          |SI enAgrupa = -1; |ERROR; |ACABA; |FINSI;

          |SI enAgrupa = 0;
               #11#12 = 0;
               #11#13 = "";
          |SINO;
               #11#12 = enAgrupa;
               #11#13 = eaDesCa;
          |FINSI;
          |PINTA #11#12;
          |PINTA #11#13;

          |SI enAgrupa > 0; |O #23#49 = "N";
               |DDEF aAlfa;
               aAlfa = aAlfa + "gopre002";
               |CARGA_DEF aAlfa, refere1@;
               |SI FSalida = 0;
                    |HAZ CreaTempo; |NOME_DAT #refere1@#Tempo#; |DELINDEX #refere1@;
                    |ABRE #refere1@; |SELECT #6#refere1@;
                    nNumLinea = 0;
                    |BUCLE PresCapi;
                    #refere1@#0 = #0#0;
                    #refere1@#1 = #0#1;
                    #refere1@#12 = #11#0;
                    |LEE 000#refere1@.];
                    |CONSULTA_CLAVE #1#refere1@;
                    |SI FSalida = 0;
                         #11#0 = #refere1@#12;
                         #11#11 = #refere1@#13;
                         |PINTA #11#0;
                         |PINTA #11#11;
                    |SINO;
                         nAgrupa = -1;
                    |FINSI;
                    |CIERRA #refere1@;
                    |DELINDEX #refere1@; |HAZ BoraTempo;
                    |DESCARGA_DEF #refere1@;
               |FINSI;
               |SI nAgrupa = -1; |ERROR; |ACABA; |FINSI;
          |SINO;
               #11#0 = eaCapi;
               #11#11 = eaDesCa;
               |PINTA #11#0;
               |PINTA #11#11;
          |FINSI;

          |DDEF aAlfa;
          aAlfa = aAlfa + "gopre003";
          |CARGA_DEF aAlfa, refere1@;
          |SI FSalida = 0;
               |HAZ CreaTempo; |NOME_DAT #refere1@#Tempo#; |DELINDEX #refere1@;
               |ABRE #refere1@;
               nNumLinea = 0;
               |BUCLE PresParti;
               |SELECT #2#refere1@;
               #refere1@#0 = #0#0;
               #refere1@#1 = #0#1;
               #refere1@#2 = #11#0;
               #refere1@#4 = #11#1;
               |LEE 000#refere1@.];
               |CONSULTA_CLAVE #1#refere1@;
               |SI FSalida = 0;
                    #11#1 = #refere1@#4;
                    #11#6 = #refere1@#5;
                    |PINTA #11#1;
                    |PINTA #11#6;
                    |GRABA 020#11a;
                    |PTEC 802;
               |SINO;
                    nAgrupa = -1;
               |FINSI;
               |CIERRA #refere1@;
               |DELINDEX #refere1@; |HAZ BoraTempo;
               |DESCARGA_DEF #refere1@;
          |FINSI;
          |SI nAgrupa = -1; |ERROR; |ACABA; |FINSI;
     |FINSI;

     |ABRE #24; |SELECT #3#24;
     #24#0 = #0#0;
     #24#1 = #0#1;
     #24#3 = #11#0;
     |LEE 000#24=;
     |SI FSalida ! 0;
          |MENAV "0000No existe Capitulo en el presupuesto";
          |ERROR;
     |SINO;
          |DDEFECTO #26;
          |ABRE #26;
          #26#0 = #24#0;
          #26#1 = #24#1;
          #26#2 = #24#14;
          |LEE 000#26=;
          |CIERRA #26;

          #11#12 = #24#14; |PINTA #11#12;
          #11#13 = #26#3;  |PINTA #11#13;
          #11#11 = #24#13; |PINTA #11#11;
     |FINSI;
     |CIERRA #24;
|FPRC;

|PROCESO Min24;
     #24#0 = #0#0;
     #24#1 = #0#1;
     #24#2 = 1;
|FPRC;

|PROCESO Max24;
     #24#0 = #0#0;
     #24#1 = #0#1;
     #24#2 = 999;
|FPRC;

|PROCESO ConsuCapi11; |TIPO 66;
     |ABRE #24; |SELECT #3#24;
     #24#0 = #0#0;
     #24#1 = #0#1;
     #24#3 = #11#0;
     |LEE 000#24];
     |CONSULTA_F_CLAVE #1#24, Min24, Max24;
     |SI FSalida = 0;
          #11#0 = #24#3; |PINTA #11#0;
     |SINO;
          |ERROR;
     |FINSI;
     |CIERRA #24;
|FPRC;

|PROCESO CheqParti11; |TIPO 0;
     aAlfa = #11#1; |QBF aAlfa;
     |SI aAlfa = ""; |ACABA; |FINSI;
     |ABRE #22; |SELECT #2#22;
     #22#0 = #0#0;
     #22#1 = #0#1;
     #22#2 = #11#0;
     #22#4 = #11#1;
     |LEE 000#22=;
     |SI FSalida ! 0;
          |MENAV "0000No existe Partida en el presupuesto";
          |ERROR;
     |SINO;
          #11#6 = #22#5; |PINTA #11#6;
     |FINSI;
     |CIERRA #22;
|FPRC;

|PROCESO Min22;
     #22#0 = #0#0;
     #22#1 = #0#1;
     #22#2 = #11#0;
     #22#3 = 1;
|FPRC;

|PROCESO Max22;
     #22#0 = #0#0;
     #22#1 = #0#1;
     #22#2 = #11#0;
     #22#3 = 999;
|FPRC;

|PROCESO ConsuParti11; |TIPO 66;
     |ABRE #22; |SELECT #2#22;
     #22#0 = #0#0;
     #22#1 = #0#1;
     #22#2 = #11#0;
     #22#4 = #11#1;
     |LEE 000#22];
     |CONSULTA_F_CLAVE #1#22, Min22, Max22;
     |SI FSalida = 0;
          #11#0 = #22#2; |PINTA #11#0;
          #11#1 = #22#4; |PINTA #11#1;
     |SINO;
          |ERROR;
     |FINSI;
     |CIERRA #22;
|FPRC;

|PROCESO PonSustitutivo;
     aAlfa = #referen@#5; |QBF aAlfa;
     |SI aAlfa = "";
          #referen@#5 = #10#5;
          #referen@#6 = #10#6;
          |GRABA 020#referen@.a;
     |FINSI;
     |LIBERA #referen@;
|FPRC;

|DEFBUCLE PonSustitutivo;
     #referen@#1004;
     ;
     "                    ", "                    ", #10#2, 001;
     "zzzzzzzzzzzzzzzzzzzz", "zzzzzzzzzzzzzzzzzzzz", #10#2, 999;
     be;
     NULL, PonSustitutivo;
|FIN;

|PROCESO PonSustitu;
     |DDEF aAlfa;
     aAlfa = aAlfa + "go000010";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |NOME_DAT #referen@#aTmp10#;
          |BUCLE PonSustitutivo;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|PROCESO Max14;
     #14#0 = #10#2;
     #14#3 = "z" * 20;
|FPRC;

|PROCESO Min14;
     #14#0 = #10#2;
     #14#3 = " " * 20;
|FPRC;

|PROCESO CheqSusti; |TIPO 0;
     |SI FSalida = 13; ||F5;
          |ABRE #14;
          |SELECT #2#14;
          #14#0 = #10#2;
          #14#3 = #10#5;
          |LEE 000#14];
          |CONSULTA_F_CLAVE #2#14, Min14, Max14;
          |SI FSalida = 0;
               #10#5 = #14#3; |PINTA #10#5;
               #10#6 = #14#4; |PINTA #10#6;
          |SINO;
               |ERROR;
          |FINSI;
          |CIERRA #14;
          |ACABA;
     |FINSI;

     |SI #10#2 = #10#5;
          |MENAV "0000No puede ser el mismo articulo...";
          |ERROR; |ACABA;
     |FINSI;

     |ABRE #goarticu@;
     #goarticu@#0 = #10#5;
     |LEE 000#goarticu@.=;
     |SI FSalida ! 0;
          |MENAV "0000El articulo no se ha consumido";
          |ERROR;
     |SINO;
          #10#6 = #goarticu@#1; |PINTA  #10#6;
          |HAZ PendientesSin;
          #10#7 = nPen;
          #10#8 = nPen;
          |PINTA #10#7;
          |PINTA #10#8;
          |SI #10Campo ! Contenido;
               |CONFI "0000SAsignar sustitutivo a todas las partidas con articulos blanco";
               |SI FSalida = 0;
                    nSwPonSusti = 1;
               |FINSI;
          |FINSI;
     |FINSI;
     |CIERRA #goarticu@;
|FPRC;

|PROCESO CheqAsigna10; |TIPO 0;
     |SI #10#8 > #10#7;
          |MENAV "0000No se pueden asignar mas de las consumidas...";
          |ERROR;
     |FINSI;
|FPRC;

|PROCESO PendientesSin;
     nPen = 0;
     |ABRE #11;
     #11#2 = #10#5;
     #11#7 = 1;
     |LEE 000#11];
     |PARA; |SI FSalida = 0; |Y #11#2 = #10#5; |HACIENDO;
          nPen = nPen + #11#4;
          |LEE 000#11s;
     |SIGUE;
     |CIERRA #11;
|FPRC;

|PROCESO ConsuSusti; |TIPO 66;
     |ABRE #goarticu@;
     #goarticu@#0 = #10#5;
     |LEE 000#goarticu@.];
     |CONSULTA_CLAVE #1#goarticu@;
     |SI FSalida = 0;
          #10#5 = #goarticu@#0; |PINTA #10#5;
     |SINO;
          |ERROR;
     |FINSI;
     |CIERRA #goarticu@;
|FPRC;

|PROCESO ConsuArt9; |TIPO 66;
     |DDEF aAlfa;
     aAlfa = aAlfa + "go000009";
     |CARGA_DEF aAlfa, refere1@;
     |SI FSalida = 0;
          |NOME_DAT #refere1@#aTmp9#;
          |ABRE #refere1@;
          #refere1@#0 = #9#0;
          #refere1@#1 = #9#1;
          #refere1@#2 = #9#2;
          |LEE 000#refere1@.];
          |CONSULTA_CLAVE #1#refere1@;
          |SI FSalida = 0;
               #9#0 = #refere1@#0;
               #9#1 = #refere1@#1;
               #9#2 = #refere1@#2;
               |LEE 000#9=;
               |PONCONTROL 23, "SI";
          |SINO;
               |ERROR;
          |FINSI;
          |CIERRA #refere1@;
          |DESCARGA_DEF #refere1@;
     |FINSI;
|FPRC;

|PROCESO ConsuArt10; |TIPO 66;
     |DDEF aAlfa;
     aAlfa = aAlfa + "go000010";
     |CARGA_DEF aAlfa, refere1@;
     |SI FSalida = 0;
          |NOME_DAT #refere1@#aTmp10#;
          |ABRE #refere1@;
          #refere1@#0 = #10#0;
          #refere1@#1 = #10#1;
          #refere1@#2 = #10#2;
          |LEE 000#refere1@.];
          |CONSULTA_CLAVE #1#refere1@;
          |SI FSalida = 0;
               #10#0 = #refere1@#0;
               #10#1 = #refere1@#1;
               #10#2 = #refere1@#2;
               #10#14 = #refere1@#14;
               |LEE 000#10=;
               |PONCONTROL 23, "SI";
          |SINO;
               |ERROR;
          |FINSI;
          |CIERRA #refere1@;
          |DESCARGA_DEF #refere1@;
     |FINSI;
|FPRC;

|PROCESO CargaVisibles;
     |SALVA_DATOS #refere1@;
     |REPON_DATOS #refere2@;
     |GRABA 020#refere2@.n;
|FPRC;

|DEFBUCLE CargaVisibles;
     #refere1@#3003;
     ;
     "S", "                    ", 001;
     "S", "zzzzzzzzzzzzzzzzzzzz", 999;
     ;
     NULL, CargaVisibles;
|FIN;

|PROCESO ConsuArt11; |TIPO 66;
     |HAZ CreaTempo; aTmp11_2 = Tempo;
     |DDEF aDef;
     aAlfa = aDef + "go000011";
     |CARGA_DEF aAlfa, refere2@;
     |SI FSalida = 0;
          aAlfa = aDef + "go000011";
          |CARGA_DEF aAlfa, refere1@;
          |SI FSalida = 0;
               |NOME_DAT #refere1@#aTmp11#;
               |NOME_DAT #refere2@#aTmp11_2#;
               |DELINDEX #refere2@;
               |ABRE #refere2@;
               |BUCLE CargaVisibles;
               #refere2@#2 = #11#2;
               #refere2@#7 = #11#7;
               |LEE 000#refere2@.=;
               |CONSULTA_CLAVE #3#refere2@;
               |SI FSalida = 0;
                    #11#0 = #refere2@#0;
                    #11#1 = #refere2@#1;
                    #11#2 = #refere2@#2;
                    |LEE 000#11=;
                    |PONCONTROL 23, "SI";
               |SINO;
                    |ERROR;
               |FINSI;
               |CIERRA #refere2@;
               |DESCARGA_DEF #refere1@;
          |FINSI;
          |DELINDEX #refere2@;
          |DESCARGA_DEF #refere2@;
     |FINSI;
     Tempo = aTmp11_2; |HAZ BoraTempo;
|FPRC;

|PROCESO Min;
     #9#0 = " " * 20;
     #9#1 = " " * 20;
     #9#2 = " " * 20;
     #10#0 = " " * 20;
     #10#1 = " " * 20;
     #10#2 = " " * 20;
     #10#14 = 1;
     #11#2 = " " * 20;
     #11#7 = 1;
     #11#9 = "S";
|FPRC;

|PROCESO Max;
     #9#0 = "z" * 20;
     #9#1 = "z" * 20;
     #9#2 = "z" * 20;
     #10#0 = "z" * 20;
     #10#1 = "z" * 20;
     #10#2 = "z" * 20;
     #10#14 = 999;
     #11#2 = "z" * 20;
     #11#7 = 999;
     #11#9 = "S";
|FPRC;

|PROCESO Descarga15;
     |PARA i = 0; |SI i [ 12; |HACIENDO i = i + 1;
          #9i = #15i;
     |SIGUE;
     |GRABA 020#9n;
|FPRC;

|PROCESO Descarga16;
     #19#0 = #16#13;
     #19#1 = #16#14;
     #19#2 = #16#2;
     |LEE 000#19=;
     |SI FSalida = 0; |ACABA; |FINSI;

     |PARA i = 0; |SI i [ 12; |HACIENDO i = i + 1;
          #10i = #16i;
     |SIGUE;
     #10#13 = #16#16;
     #10#14 = #16#17;
     |GRABA 020#10n;
|FPRC;

|PROCESO Descarga17;
     |PARA i = 0; |SI i [ 14; |HACIENDO i = i + 1;
          #11i = #17i;
     |SIGUE;
     |SI #11#8 ! 0;
          |GRABA 020#11n;
     |FINSI;
|FPRC;

|PROCESO Descarga20;
     |PARA i = 0; |SI i [ 55; |HACIENDO i = i + 1;
          #gopartia@#i# = #120i;
     |SIGUE;
     |GRABA 020#gopartia@.n;
|FPRC;

|DEFBUCLE Descarga15;
     #15#1;
     ;
     #0#0, #0#1, #0#2, aD, aD, aD;
     #0#0, #0#1, #0#2, aH, aH, aH;
     ;
     NULL, Descarga15;
|FIN;

|DEFBUCLE Descarga16;
     #16#1;
     ;
     #0#0, #0#1, #0#2, aD, aD, aD, 001;
     #0#0, #0#1, #0#2, aH, aH, aH, 999;
     ;
     NULL, Descarga16;
|FIN;

|DEFBUCLE Descarga17;
     #17#1;
     ;
     #0#0, #0#1, #0#2, aD, 001;
     #0#0, #0#1, #0#2, aH, 999;
     ;
     NULL, Descarga17;
|FIN;

|DEFBUCLE Descarga20;
     #120#1;
     ;
     #0#0, #0#1, #0#2, " ", "     ", 000001, 001, 001;
     #0#0, #0#1, #0#2, "z", "zzzzz", 999999, 999, 999;
     ;
     NULL, Descarga20;
|FIN;

|PROCESO DescargaArt;
     |PARA i = 0; |SI i [ 208; |HACIENDO i = i + 1;
          #goarticu@#i# = #121i;
     |SIGUE;
     |GRABA 020#goarticu@.n;
|FPRC;

|DEFBUCLE DescargaArt;
     #121#1;
     ;
     #0#0, #0#1, #0#2, aD;
     #0#0, #0#1, #0#2, aH;
     ;
     NULL, DescargaArt;
|FIN;

|PROCESO Tipo3; |TIPO 3;
     |DDEF aAlfa;
     aAlfa = aAlfa + "go000004";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida ! 0;
          |MENAV "0000Error al cargar 'go000004'";
          |ACABA;
     |FINSI;

     |SI #0#5 = "N";
          |HAZ CreaTempo;
          |NOME_DAT #referen@#Tempo#; |DELINDEX #referen@;
          |ABRE #referen@;
          |BUCLE Pendientes;
          |LEE 000#referen@.p;
          |SI nHay ! 0;
               |CONSULTA_CLAVE #1#referen@;
               |SI FSalida = 0;
                    aFecha = #4#0;
                    #0#3 = #4#0;
               |FINSI;
          |SINO;
               |MENAV "0000No hay inventario para este almacen";
          |FINSI;
          |CIERRA #referen@;
          |DELINDEX #referen@; |HAZ BoraTempo;
          |DESCARGA_DEF #referen@;
     |SINO;
          aFecha = #0#3;
     |FINSI;

     |SI aFecha = ""; |ACABA; |FINSI;

     |DDEF aDef;
     aAlfa = aDef + "gopartia";
     |CARGA_DEF aAlfa, gopartia@;
     |SI FSalida ! 0;
          |MENAV "0000Error al cargar 'gopartia'";
          |ACABA;
     |FINSI;
     aAlfa = aDef + "goarticu";
     |CARGA_DEF aAlfa, goarticu@;
     |SI FSalida ! 0;
          |MENAV "0000Error al cargar 'goarticu'";
          |ACABA;
     |FINSI;

     |HAZ CreaTempo; aTmp1 = Tempo; |NOME_DAT #gopartia@#Tempo#; |DELINDEX #gopartia@;
     |HAZ CreaTempo; aTmp2 = Tempo; |NOME_DAT #goarticu@#Tempo#; |DELINDEX #goarticu@;
     |HAZ CreaTempo; aTmp9 = Tempo; |NOME_DAT #9#Tempo#; |DELINDEX #9;
     |HAZ CreaTempo; aTmp10 = Tempo; |NOME_DAT #10#Tempo#; |DELINDEX #10;
     |HAZ CreaTempo; aTmp11 = Tempo; |NOME_DAT #11#Tempo#; |DELINDEX #11;
     |HAZ CreaTempo; aTmp12 = Tempo; |NOME_DAT #12#Tempo#; |DELINDEX #12;
     |HAZ CreaTempo; aTmp13 = Tempo; |NOME_DAT #13#Tempo#; |DELINDEX #13;

     |ABRE #1;
     #1#0 = #0#0;
     #1#1 = #0#1;
     |LEE 020#1=;
     |CIERRA #1;

     |ABRE #4;
     #4#4 = #0#2;
     #4#0 = #0#3;
     |LEE 020#4=;
     |CIERRA #4;

     |ABRE #23;
     #23#0 = #1#0;
     #23#1 = #1#1;
     |LEE 020#23=;
     |CIERRA #23;
     nDeci_Medi = #23#24;

     |ABRE #100; |LEE 000#100p; |CIERRA #100;
     nDeci_Meda = #100#115;

     |ABRE #122;
     #122#0 = #0#0;
     #122#1 = #0#1;
     #122#2 = #0#2;
     #122#3 = #0#3;
     |LEE 000#122=;
     nActualizado = FSalida;
     |SI FSalida = 0;
          |MENAV "0000Reparto ya actualizado...";
          #0#5 = "S"; || lo cargo del guardado
     |FINSI;
     |CIERRA #122;

     |SI #0#5 = "N";
          |ABRE #19;
          |ABRE #12;
          |ABRE #22;
          |ABRE #24;
          |ABRE #26;
          |ABRE #13;
          |BUCLE gocerhip;  || Carga Art. Presupuestados
          |CIERRA #13;
          |CIERRA #26;
          |CIERRA #24;
          |CIERRA #22;
          |CIERRA #12;

          |ABRE #5;
          |ABRE #9;
          |ABRE #11;
          |ABRE #12;
          |ABRET #13;
          |ABRE #25;
          |ABRE #gopartia@;
          |ABRE #goarticu@;
          |DDEFECTO #goarticu@;    ||Pongo el articulo blanco
          |GRABA 020#goarticu@.n;
          |ABRE #24;
          |ABRE #26;
          |ABRE #22;
          |BUCLE gocerlip; || Carga del gopartia (consumidos)
          |CIERRA #22;
          |CIERRA #24;
          |CIERRA #26;
          |CIERRA #goarticu@;
          |CIERRA #gopartia@;
          |CIERRA #25;
          |CIERRA #12;
          |CIERRAT #13;
          |CIERRA #11;
          |CIERRA #9;
          |CIERRA #5;

          |ABRE #10;
          |ABRE #goarticu@;
          |BUCLE NoPresupu;   || Carga los NO presupuestados
          |CIERRA #goarticu@;
          |CIERRA #10;
          |CIERRA #19;
     |SINO;
          |ABRE #9;
          |ABRE #10;
          |ABRE #11;
          |ABRE #goarticu@;
          |ABRE #gopartia@;
          |BUCLE Descarga15;
          |ABRE #19;
          |BUCLE Descarga16;
          |CIERRA #19;
          |BUCLE Descarga17;
          |BUCLE Descarga20;
          |BUCLE DescargaArt;
          |CIERRA #gopartia@;
          |CIERRA #goarticu@;
          |CIERRA #11;
          |CIERRA #10;
          |CIERRA #9;
     |FINSI;
     |PINPA #0#9;
     |ENTLINEAL #1#9, 3, 7, 17, 0, Min, Max;

     |PARA; |SI; |HACIENDO;
          |MENU aMenu;
          aMenu2 = FSalida;
          |SI aMenu2 = 1; |PINPA #0#9; |ENTLINEAL #1#9, 3, 4, 17, 0, Min, Max; |FINSI;
          |SI aMenu2 = 2; |PINPA #0#10; |ENTLINEAL #1#10, 3, 4, 16, 0, Min, Max; |FINSI;
          |SI aMenu2 = 3; |PINPA #0#11; |ENTLINEAL #3#11, 2, 4, 17, 0, Min, Max; |FINSI;
          |SI aMenu2 = 6;
               |SI nActualizado = 0;
                    |MENAV "0000Ya esta actualizado...";
               |SINO;
                    |HAZ Guardalo;
                    |MENAV "0000Reparto guardado...";
               |FINSI;
          |FINSI;
          |SI aMenu2 ! 1; |Y aMenu2 ! 2; |Y aMenu2 ! 3; |SAL; |FINSI;
     |SIGUE;
     |SI aMenu2 = 4; |HAZ Crealos; |FINSI;
     |SI aMenu2 = 5; |MENAV "0000Proceso cancelado..."; |FINSI;

     |DELINDEX #9; Tempo = aTmp9; |HAZ BoraTempo;
     |DELINDEX #10; Tempo = aTmp10; |HAZ BoraTempo;
     |DELINDEX #11; Tempo = aTmp11; |HAZ BoraTempo;
     |DELINDEX #12; Tempo = aTmp12; |HAZ BoraTempo;
     |DELINDEX #13; Tempo = aTmp13; |HAZ BoraTempo;
     |DELINDEX #goarticu@; Tempo = aTmp2; |HAZ BoraTempo;
     |DELINDEX #gopartia@; Tempo = aTmp1; |HAZ BoraTempo;
     |DESCARGA_DEF #goarticu@;
     |DESCARGA_DEF #gopartia@;
|FPRC

|PROCESO Graba15;
     |PARA i = 0; |SI i [ 12; |HACIENDO i = i + 1;
          #15i = #9i;
     |SIGUE;
     #15#13 = #0#0;
     #15#14 = #0#1;
     #15#15 = #0#2;
     |GRABA 020#15n;
|FPRC;

|PROCESO Graba16;
     |PARA i = 0; |SI i [ 12; |HACIENDO i = i + 1;
          #16i = #10i;
     |SIGUE;
     #16#13 = #0#0;
     #16#14 = #0#1;
     #16#15 = #0#2;
     #16#16 = #10#13;
     #16#17 = #10#14;
     |GRABA 020#16n;
|FPRC;

|PROCESO Graba17;
     |PARA i = 0; |SI i [ 14; |HACIENDO i = i + 1;
          #17i = #11i;
     |SIGUE;
     #17#15 = #0#0;
     #17#16 = #0#1;
     #17#17 = #0#2;
     |GRABA 020#17n;
|FPRC;

|PROCESO Graba20;
     |PARA i = 0; |SI i [ 55; |HACIENDO i = i + 1;
          #120i = #gopartia@#i#;
     |SIGUE;
     #120#56 = #0#2;
     |GRABA 020#120n;
|FPRC;

|PROCESO Graba21;
     |PARA i = 0; |SI i [ 208; |HACIENDO i = i + 1;
          #121i = #goarticu@#i#;
     |SIGUE;
     #121#209 = #0#0;
     #121#210 = #0#1;
     #121#211 = #0#2;
     |GRABA 020#121n;
|FPRC;

|DEFBUCLE Graba15;
     #9#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Graba15;
|FIN;

|DEFBUCLE Graba16;
     #10#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Graba16;
|FIN;

|DEFBUCLE Graba17;
     #11#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Graba17;
|FIN;

|DEFBUCLE Graba20;
     #gopartia@#1005;
     ;
     " ", "     ", 000001, 001, 001;
     "z", "zzzzz", 999999, 999, 999;
     ;
     NULL, Graba20;
|FIN;

|DEFBUCLE Graba21;
     #goarticu@#1001;
     ;
     aD;
     aH;
     ;
     NULL, Graba21;
|FIN;

|PROCESO Borra15;
     |BORRA 020#15a;
|FPRC;

|PROCESO Borra16;
     |BORRA 020#16a;
|FPRC;

|PROCESO Borra17;
     |BORRA 020#17a;
|FPRC;

|PROCESO Borra20;
     |BORRA 020#120a;
|FPRC;

|PROCESO Borra21;
     |BORRA 020#121a;
|FPRC;

|DEFBUCLE Borra15;
     #15#1;
     ;
     #0#0, #0#1, #0#2, aD, aD, aD;
     #0#0, #0#1, #0#2, aH, aH, aH;
     be;
     NULL, Borra15;
|FIN;

|DEFBUCLE Borra16;
     #16#1;
     ;
     #0#0, #0#1, #0#2, aD, aD, aD, 001;
     #0#0, #0#1, #0#2, aH, aH, aH, 999;
     be;
     NULL, Borra16;
|FIN;

|DEFBUCLE Borra17;
     #17#1;
     ;
     #0#0, #0#1, #0#2, aD, 001;
     #0#0, #0#1, #0#2, aH, 999;
     be;
     NULL, Borra17;
|FIN;

|DEFBUCLE Borra20;
     #120#1;
     ;
     #0#0, #0#1, #0#2, " ", "     ", 000001, 001, 001;
     #0#0, #0#1, #0#2, "z", "zzzzz", 999999, 999, 999;
     be;
     NULL, Borra20;
|FIN;

|DEFBUCLE Borra21;
     #121#1;
     ;
     #0#0, #0#1, #0#2, aD;
     #0#0, #0#1, #0#2, aH;
     be;
     NULL, Borra21;
|FIN;

|PROCESO Guardalo;
     |DDEFECTO #18;
     |ABRE #18;
     #18#0 = #0#0;
     #18#1 = #0#1;
     #18#2 = #0#2;
     |LEE 101#18=;
     |SI FSalida ! 0; |GRABA 020#18b; |FINSI;
     #18#3 = ~;
     |HORA aAlfa;
     #18#4 = aAlfa;
     #18#5 = Usuario % 810;
     #18#6 = #0#3;
     |GRABA 020#18a;
     |CIERRA #18;
     |BUCLE Borra15;
     |BUCLE Borra16;
     |BUCLE Borra17;
     |BUCLE Borra20;
     |BUCLE Borra21;
     |ABRE #15;
     |ABRE #16;
     |ABRE #17;
     |ABRE #120;
     |ABRE #121;
     |BUCLE Graba15;
     |BUCLE Graba16;
     |BUCLE Graba17;
     |BUCLE Graba20;
     |BUCLE Graba21;
     |CIERRA #121;
     |CIERRA #120;
     |CIERRA #15;
     |CIERRA #16;
     |CIERRA #17;
|FPRC;

|PROCESO Consulta; |TIPO 0;
     |SI FSalida = 13;
          |ABRE #18;
          #18#0 = #0#0;
          #18#1 = #0#1;
          #18#2 = #0#2;
          |LEE 000#18];
          |CONSULTA_CLAVE #1#18;
          |SI FSalida = 0;
               #0#0 = #18#0; |PINTA #0#0;
               #0#1 = #18#1; |PINTA #0#1;
               #0#2 = #18#2; |PINTA #0#2;
               #0#3 = #18#6;
               #0#5 = "S"; |PINTA #0#5;
          |SINO;
               |ERROR;
          |FINSI;
          |CIERRA #18;
     |FINSI;
|FPRC;

|PROCESO Restaurar;
     |SI #0#5 = "S"; |Y FSalida = 0;
          |ABRE #18;
          #18#0 = #0#0;
          #18#1 = #0#1;
          #18#2 = #0#2;
          |LEE 000#18=;
          |SI FSalida ! 0;
               |MENAV "0000No existe Reparto guardado...";
               |ERROR;
          |SINO;
               #0#3 = #18#6;
          |FINSI;
          |CIERRA #18;
     |FINSI;
|FPRC;

|PROGRAMA;
     aD = " " * 20;
     aH = "z" * 20;
     |CLS;
     |ABRE #0;
     |LEE 101#0p;
     |SI FSalida ! 0; |GRABA 020#0b; |FINSI;
     |PINPA #0#0;
     |PINDA #0#0;
     #0#5 = "N"
     |ENDATOS #1#0;
     |CIERRA #0;
|FPRO;
