/*
|FICHEROS;
     fergay05 #0;
     fergam02 #2;
     fergam06 #6;
     fergam07 #7;
     fergam08 #8;
     agifa019 #19;
     agifa049 #49;
     agifa060 #60;
     agifa073 #73;
     agifa104 #104;
     agifa210 #210;
     agifa211 #211;
|FIN;

|VARIABLES;
     aFecElabora = "";
     aFecArmado = "";
     aFecPilote = "";
     aCompo = "";
     nHay = 0;

     aAlfa = "";
     aAlfa1 = "";
     aHojaExcel = "";
     aBase = "";
     aOrigen = "";
     aDestino = "";
     aDestinoTrab = "";
     aIPRemoto = "";
     aPath = "";
     {1}aVersion = "";
     aLongitud = "";
     nLongitud = 0;
     aPos = "";
     nPos = 0;
     nCaracter = 0;
     aCaracter = "";
     aResultado = "";
     aHoja = "";
     nLinea = 0;
     aLF = "";
     aIP = "";
     {1}aLocal = "";
     aExe = "dsabreextension.exe";
     aOrg = "";
     aDes = "";
     aFic = "";
     nHandle = 0;
|FIN;

|PROCESO PresentaDoc;
     |DBASE aAlfa;
     aOrg = aAlfa + "plugins/" + aExe;

     aIP = ""; |IP_REMOTO aIP;
     |SI aIP = "";
          |DBASS aBase;
          aAlfa = aBase + "bin/" + aExe + " " + aFic;
          |SYSTEM aAlfa;
     |SINO;
          |ESPECIFICA "RBASS", aLocal;
          aBase = aLocal;
          aDes = aBase + "bin/" + aExe;
          |ENVIA_FICHERO aOrg, aDes;
          aAlfa = aDes;

          aOrg = aFic;
          aDes = aBase + "tmp/" + Usuario + ".csv";
          |ENVIA_FICHERO aOrg, aDes;
          aAlfa = aAlfa + " " + aDes;

          |RSYSTEM aAlfa;
     |FINSI;
|FPRC;

|PROCESO Lineas;
     nLinea = nLinea + 1;

     aAlfa = #210#1;               |XGRABA nHandle, aAlfa;
     aAlfa = ";" + &34+#210#3+&34; |XGRABA nHandle, aAlfa;
     aAlfa = ";" + #210#4;         |XGRABA nHandle, aAlfa;
     aAlfa = ";" + #104#0;         |XGRABA nHandle, aAlfa;
     aAlfa = ";" + #19#1;          |XGRABA nHandle, aAlfa;
     aAlfa = ";" + #60#1;          |XGRABA nHandle, aAlfa;
     aAlfa = ";" + #73#5;          |XGRABA nHandle, aAlfa;

     aAlfa = ";" + #210#1;          |XGRABA nHandle, aAlfa;

     aAlfa1 = #73#52; |QBF aAlfa1;
     aAlfa1 = aAlfa1 + "/" + (("000000" + #73#0) % -106);
     aAlfa = ";" + aAlfa1;          |XGRABA nHandle, aAlfa;

     aAlfa = ";" + aFecElabora;    |XGRABA nHandle, aAlfa;
     aAlfa = ";" + aFecArmado;     |XGRABA nHandle, aAlfa;
     aAlfa = ";" + aFecPilote;     |XGRABA nHandle, aAlfa;
     aAlfa = ";" + #104#1;         |XGRABA nHandle, aAlfa;
     aAlfa = ";" + #104#51;        |XGRABA nHandle, aAlfa;
     aAlfa = ";" + #104#53;        |XGRABA nHandle, aAlfa;
     aAlfa = ";" + #104#54;        |XGRABA nHandle, aAlfa;
     |XGRABA nHandle, aLF;
|FPRC;

|PROCESO fergam08;
     |SI aCompo ! "";
          |SI aFecElabora > #8#3; |O aFecElabora = "";
               aFecElabora = #8#3;
          |FINSI;
     |SINO;
          #2#0 = #8#4;
          |LEE 000#2=;
          |SI FSalida ! 0; |DDEFECTO #2; |FINSI;

          |SI #2#2 = "S";
               |SI aFecArmado > #8#3; |O aFecArmado = "";
                    aFecArmado = #8#3;
               |FINSI;
          |FINSI;

          |SI #2#5 = "S";
               |SI aFecPilote > #8#3; |O aFecPilote = "";
                    aFecPilote = #8#3;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE fergam08;
     #8#1;
     ;
     #7#0, #7#1, 001;
     #7#0, #7#1, 999;
     ;
     NULL, fergam08;
|FIN;

|PROCESO fergam07;
     aCompo = #7#2; |QBF aCompo;
     |BUCLE fergam08;
|FPRC;

|DEFBUCLE fergam07;
     #7#1;
     ;
     #6#0, 001;
     #6#0, 999;
     ;
     NULL, fergam07;
|FIN;

|PROCESO fergam06;
     nHay = 1;
     |BUCLE fergam07;
|FPRC;

|DEFBUCLE fergam06;
     #6#3;
     ;
     #211#31, #211#12, 000001;
     #211#31, #211#12, 999999;
     ;
     NULL, fergam06;
|FIN;

|PROCESO agifa071;
     aFecElabora = "";
     aFecElabora = "";
     aFecArmado = "";
     aFecPilote = "";

     #104#25 = #211#31;
     #104#0 = #211#12;
     |LEE 000#104=;
     |SI FSalida = 0;
          #73#28 = #211#31;
          #73#0 = #211#12;
          #73#1 = 1;
          |LEE 000#73=;
          |SI FSalida = 0;
               nHay = 0;
               |BUCLE fergam06;

               |SI nHay ! 0;

                    #60#0 = #73#18;
                    |LEE 000#60=;
                    |SI FSalida ! 0; |DDEFECTO #60; |FINSI;

                    #19#0 = #73#2;
                    |LEE 000#19=;
                    |SI FSalida ! 0; |DDEFECTO #19; |FINSI;

                    |HAZ Lineas;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE agifa210;
     #210#7;
     3;
     #0#0, #0#4, 000001, #0#2;
     #0#1, #0#5, 999999, #0#3;
     ;
     NULL, NULL, NULL, NULL, NULL, NULL, agifa071;
     #210#4;
|FIN;

|PROCESO Titulos;
     aAlfa = "Fecha Albarán;Cliente;Nombre;Nº Pedido;Descripción Artículo;Descripción Familia;";
     |XGRABA nHandle, aAlfa;
     aAlfa = "Unidades;Fecha Albarán;Nº Albarán;Fecha Elaborado;Fecha Armado;Fecha Pilotes;Fecha Pedido;Usuario Pedido;";
     |XGRABA nHandle, aAlfa;
     aAlfa = "Observación1;Observación2";
     |XGRABA nHandle, aAlfa;
     |XGRABA nHandle, aLF;
|FPRC;

|PROCESO T3; |TIPO 3;
     aLF = &13; aLF = aLF + &10;
     |DFICE aAlfa;
     aFic = aAlfa + Usuario + ".csv";
     |XABRE "WB", aFic, nHandle;
     |SI FSalida ] 0;
          |HAZ Titulos;

          nLinea = 1;
          |ABRE #104;
          |ABRE #73;
          |ABRE #60;
          |ABRE #19;
          |ABRE #2;
          |BUCLE agifa210;
          |CIERRA #2;
          |CIERRA #19;
          |CIERRA #60;
          |CIERRA #73;
          |CIERRA #104;

          |XCIERRA nHandle;
          |HAZ PresentaDoc;
     |FINSI;
|FPRC;
*/
