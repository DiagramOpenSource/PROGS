|FICHEROS;
     abyz0006 #0;
     abym0001 #1;
     abym0002 #2;
     abym0003 #3;
     abyw0004 #4; ||Tmp

     agifa019 #19;
     dsm00020 #20; || Agencia Trans
     agifa024 #24;
     agifa025 #25;
     agifa084 #84;
     agifa069 #69;
     agifa321 #321;
     agifa324 #324;
     tempo134 #134;      || Tmp impresion
|FIN;

|VARIABLES;
     nCto = 0;
     aAlfa = "";
     &eaSerPlan = "";
     &enNumPlan = 0;
     &eaTipPlan = "";
     &enVisPlan = 0;
     &enForma = 0;
     &eaProgVta = "";
     &enCoste = 0;
     &enSwMenu = 0;
     &aDivisa = "";
     &aMoneda = "";
     &eaFichero = "";
     aCliente = "";
     aTmp = "";
     nDirEnt = 0;
     nLinea = 0;
     aSer = "";
     aTitulo = "";
     nContaLin = 0;
|FIN;

|PROCESO CreaTitulo;
     |DDEFECTO #19;
     |ABRE #19;
     #19#0 = "";
     |LEE 000#19=;
     |CIERRA #19;

     |DDEFECTO #69;
     #69#20 = #84#48;
     #69#0 = #84#0;
     #69#1 = nLinea;
     #69#3 = #2#25;
     #69#4 = aTitulo;
     #69#11 = #19#30;
     #69#13 = #19#2;
     #69#15 = #84#3;
     #69#16 = #84#34;
     #69#17 = #84#35;

     enForma = 1;
     eaProgVta = "agifa084";
     |HAZ AcumulaFC;
     #69#14 = enCoste;
     |HAZ TotalLin69;
     |GRABA 020#69n;
|FPRC;

|PROCESO abym0003;
     nContaLin = nContaLin + 1;
     |SI nContaLin > 1; |ACABA; |FINSI;  || SOlo se factura la 1 linea
     ||||SI #3#11 = "N"; |ACABA; |FINSI;

     nLinea = nLinea + 1;
     |SI aTitulo ! "";
          |HAZ CreaTitulo;
          aTitulo = "";
          nLinea = nLinea + 1;
     |FINSI;

     |DDEFECTO #19;
     |ABRE #19;
     #19#0 = #3#5;
     |LEE 000#19=;
     |CIERRA #19;

     |DDEFECTO #69;
     #69#20 = #84#48;
     #69#0 = #84#0;
     #69#1 = nLinea;
     #69#2 = #3#5;
     #69#3 = 1;
     #69#4 = #3#6;
     #69#5 = #3#7;
     #69#6 = #3#8;
     #69#26 = #3#8;
     #69#11 = #19#30;
     #69#13 = #19#2;
     #69#15 = #84#3;
     #69#16 = #84#34;
     #69#17 = #84#35;

     enForma = 1;
     eaProgVta = "agifa084";
     |HAZ AcumulaFC;
     #69#14 = enCoste;
     |HAZ TotalLin69;
     |GRABA 020#69n;
|FPRC;

|PROCESO abym0002;
     |SI #2#18 ! "V"; |Y eaSerPlan = "";
          |ERROR; |ACABA;
     |FINSI;

     |DDEFECTO #24;
     |ABRE #24;
     #24#0 = #2#4;
     |LEE 000#24=;
     |CIERRA #24;
     |DDEFECTO #25;
     |ABRE #25;
     #25#0 = #24#25;
     |LEE 000#25=;
     |CIERRA #25;
     |DDEFECTO #1;
     #1#0 = #2#0;
     #1#1 = #2#1;
     |LEE 000#1=;

     |SI aCliente ! #2#4; |O nDirEnt ! #2#20; |O #1#19 = "N"; |O aSer ! #2#0;
          |SI aCliente ! "";
               |HAZ LimCabAgifa084;
               |BUCLELIN 0 CalCabAgifa084 #84;
               |GRABA 020#84a;
               |LIBERA #84;
          |FINSI;
          nCto = 0;
          aCliente = #2#4;
          nDirEnt = #2#20;
          aSer = #2#0;
          nLinea = 0;

          |DDEFECTO #84;
          #84#48 = #2#0
          enSwMenu = 1; |HAZ ContaFD7;
          |GRABA 020#84b;
          #84#1 = ~;
          #84#3 = #24#0;
          #84#4 = #24#1;
          #84#5 = #24#37;
          #84#6 = #25#0;
          #84#7 = #24#38;
          #84#8 = #1#9;
          #84#29 = #24#1;
          #84#30 = #24#8;
          #84#31 = #24#9;
          #84#32 = #24#156;
          #84#33 = #24#10;
          #84#34 = #25#7;
          #84#35 = #24#4;
          #84#36 = #24#47;
          #84#40 = #24#16;
          #84#60 = #24#15;
          #84#64 = #24#183;
          #84#65 = #24#192;

          #324#0 = #84#65;
          |LEE 000#324=;
          #84#66 = #324#2;

          #84#67 = #24#193;
          #84#68 = #321#9;

          #324#0 = #84#68;
          |LEE 000#324=;
          #84#69 = #324#2;

          #84#78 = #24#202;
          #84#88 = #24#23;
          #84#89 = #24#24;
          #84#90 = #24#25
          #84#91 = #2#20;
          aAlfa = (("000000" + #2#1) % -106);
          #84#93 = #2#0 + "/" + aAlfa;

          #20#0 = #84#78;
          |LEE 000#20=;
          |SI FSalida = 0;
               #84#9 = #20#1;
          |FINSI;
          #3#0 = #84#3;
          #3#1 = #84#91;
          |LEE 000#3=;
          |SI FSalida = 0;
               #84#2 = #3#10;
               #84#29 = #3#10;
               #84#30 = #3#2;
               #84#31 = #3#3;
               #84#64 = #3#6;
               #84#33 = #3#7;
          |FINSI;

          aDivisa = #84#65;
          aMoneda = #84#67;
          |HAZ Divisas084;

          #134#0 = #84#48;
          #134#1 = #84#0;
          |GRABA 020#134n;
     |FINSI;
     #2#8 = #84#48;
     #2#9 = #84#0;
     #2#18 = "F";
     |GRABA 0203#2a;
     |LIBERA #2;

     nCto = nCto + 1;
     |SI nCto ] 2; #84#93 = "VARIOS"; |FINSI;

     aTitulo = "Mantenimiento de contrato " + #2#0 + "/" + (("000000" + #2#1)%-106);
     nContaLin = 0;
|FPRC;

|DEFBUCLE abym0002;
     #2#4;
     2, 18, 7, 0, 1;
     #0#2, 0001, #0#0, "R", "V", "S", #0#4, #0#6;
     #0#3, 9999, #0#1, "R", "V", "S", #0#5, #0#7;
     ;
     NULL, abym0002, abym0003;
|FIN;

|PROCESO abyw0004;
     #2#0 = #4#0;
     #2#1 = #4#1;
     #2#2 = #4#2;
     #2#3 = #4#3;
     |LEE 121#2=;
     |SI FSalida = 0; |Y #2#18 = "V";
          |HAZ abym0002;
          |BUCLELIN 0 abym0003 #2;
          |GRABA 020#2a;
     |FINSI;
     |LIBERA #2;
|FPRC;

|DEFBUCLE abyw0004;
     #4#4;
     ;
     INICIO;
     FINAL;
     ;
     NULL, abyw0004;
|FIN;

|PROCESO Tipo3; |TIPO 3;
     aTmp = Usuario;
     |NOME_DAT #134 aTmp;
     |DELINDEX #134;
     |ABRE #134;
     |ABRE #69;
     |ABRE #84;
     |ABRE #20;
     |ABRE #3;
     |ABRE #1;
     |SI eaFichero ! "";
          |NOME_DAT #4 eaFichero;
          |ABRE #2;
          |BUCLE abyw0004;
          |CIERRA #2;
     |SINO;
          |SI eaSerPlan = "";
               |BUCLE abym0002;
          |SINO;
               |ABRE #2;
               #2#0 = eaSerPlan;
               #2#1 = enNumPlan;
               #2#2 = eaTipPlan;
               #2#3 = enVisPlan;
               |LEE 121#2=;
               |SI FSalida = 0;
                    |HAZ abym0002;
                    |BUCLELIN 0 abym0003 #2;
                    |GRABA 020#2a;
               |FINSI;
               |CIERRA #2;
          |FINSI;
     |FINSI;
     |SI aCliente ! "";
          |HAZ LimCabAgifa084;
          |BUCLELIN 0 CalCabAgifa084 #84;
          |GRABA 020#84a;
          |LIBERA #84;

          |CONFI "0000SImprimir Facturas";
          |SI FSalida = 0;
               eaFichero = aTmp;
               |SUB_EJECUTA_NP "agifa086";
          |FINSI;
     |FINSI;
     |CIERRA #84;
     |CIERRA #69;
     |CIERRA #20;
     |CIERRA #1;
     |CIERRA #3;
     |CIERRA #134;
     |DELINDEX #134;
|FPRC;

|PROGRAMA;
     |SI eaFichero ! ""; |O eaSerPlan ! "";
          |HAZ Tipo3;
     |SINO;
          |MANTE #0;
     |FINSI;
|FPRO;
