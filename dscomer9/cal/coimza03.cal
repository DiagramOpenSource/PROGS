|FICHEROS;
     coimw004 #1,MANTE;
     agifa017 #17;
     agifa019 #19;
     dsm00052 #52;
     agifa074 #74;
|FIN;

|VARIABLES;
     nForma = 1;
     nCanti = 0;
     nAntes = 0;
|FIN;

|PROCESO ActCompo;
     #19#0 = #52#3;
     |LEE 121#19=;
     |SI FSalida = 0;
          #17#0 = #52#3;
          #17#1 = #52#5;
          |LEE 121#17=;
          |SI FSalida = 0;
               #19#12 = #19#12 + (#52#4 * nForma);
               #19#104 = #19#104 - (#52#4 * nForma);
               #19#193 = #19#193 - (#52#9 * nForma);

               #17#8 = #17#8 + (#52#4 * nForma);
               #17#39 = #17#39 - (#52#4 * nForma);
               #17#48 = #17#48 - (#52#9 * nForma);

               |HAZ ValoraStock;
               |GRABA 020#17a;
               |GRABA 020#19a;
               |LIBERA #17;
          |FINSI;
          |LIBERA #19;
     |FINSI;
     |LIBERA #17;
     |LIBERA #19;
|FPRC;

|PROCESO dsm00052;
     nForma = -1; |HAZ ActCompo;

     #52#4 = #74#4 * #52#4 / nAntes;
     #52#9 = #74#4 * #52#9 / nAntes;
     |GRABA 020#52a;

     nForma = 1; |HAZ ActCompo;
|FPRC;

|DEFBUCLE dsm00052;
     #52#1;
     ;
     #74#9, #74#0, #74#1, 001;
     #74#9, #74#0, #74#1, 999;
     be;
     NULL, dsm00052;
|FIN;

|PROCESO RecalOrdenFab;
     |ABRE #74;
     #74#9 = #1#1;
     #74#0 = #1#2;
     #74#1 = #1#3;
     |LEE 121#74=;
     |SI FSalida = 0;
          nAntes = #74#4;
          #74#4 = #1#12;
          |SI #74#5 > 0;
               #74#5 = #1#12;
          |FINSI;

          |ABRE #17;
          |ABRE #19;
          |BUCLE dsm00052;
          |CIERRA #19;
          |CIERRA #17;

          |GRABA 020#74a;
          |LIBERA #74;
     |FINSI;
     |CIERRA #74;
|FPRC;
