          ||  Limite 48 def !!!

|FICHEROS;
     sctrz056 #0;
     sctrm003 #3;
     sctrm006 #6;
     sctrm007 #7;
     sctrm008 #8;
     sctrm010 #10;
     sctrm012 #12;
     sctrw013 #13;  ||Tmp Trayectos Servicios
     sctrw014 #14;  ||Tmp Tarifa
     sctrw015 #15;  ||Tmp Rese Lin
     sctrw016 #16;  ||Tmp Rese espera
     sctrm017 #17;
     sctrm018 #18;
     sctrm019 #19;
     sctrm020 #20;
     sctrm023 #23;
     sctrm024 #24;
     sctrm026 #26;
     sctrm030 #30;
     sctrm031 #31;
     sctrm036 #36;
     sctrm037 #37;
     sctrm038 #38;
     sctrm040 #40;
     sctrm041 #41;
     sctrm042 #42;
     sctrm047 #47;
     sctrm046 #46;
     sctrm050 #50;
     sctrm052 #52; ||Rese C
     sctrm053 #53; ||Rese L
     sctrm001 #100;
     sctrm015 #115;
     sctrm016 #116;
     sctrw017 #117;       ||Tmp Dias Sugeridos
     sctrz057 #157,MANTE; ||Pan Rese
     sctrz058 #158,MANTE; ||Pan ReseLin
     sctrz059 #159,MANTE; ||Pan 1 Vta Dire
     sctrz060 #160,MANTE; ||Pan 2 Vta Indire
     sctrz061 #161;       ||Pan Datos Generales
     sctrz062 #162,MANTE; ||Pan Busqueda
     sctrz063 #163,MANTE; ||Pan Anula
     sctrz064 #164;       ||Pan Datos Anula
     sctrz068 #168,MANTE; ||Pan 3 Vta Grupo
     ||sctrz072 #172,MANTE; ||Pan Cobro Reserva
     agifa324 #324;
     referen@ #500;
     refecon@; || el grid de consulta
|FIN;

|CAMPOS;
     #160#162 PROVINCIA;
|FIN;

|VARIABLES;
     JUAN = 0;
     aFecNace = "";
     nSal = 0;
     &eaModo = "";
     &enReserva = 0;
     &eaAgeApi = "";
     &enLinApi = 0;
     nLineaSer = 0;
     aAgencia = "";
     nAncho = 0;
     nTipo_Viaje = 0;
     fFecha_Vuelta = @;
     fFechaSalida = @;
     fFechaVuelta = @;
     &enDtoAuto = 0;
     &enTotBillete = 0;
     &enIncBillete = 0;
     &efFechaViaje = @;
     &enLinea = 0;
     &eaSentido = "";
     &enPax = 0;
     &eaBloqueado = "";
     &enSwVuelta = 0;
     nImpDtoAuto = 0;
     nConta = 0;
     nSwTempoFRese = 0;
     aSwAplicaSuple = "";
     nSwSuple = 0;
     nOk = 0;
     &eaMensaje = "";
     &eaAlfa = "";
     &enIntercambiador = 0;
     &eaTitulo = "";
     &eaClave = "";
     &eaNomLogo ="";
     &enPantaLogo = 0;
     &enCtrFin = 0;
     &eaCtrTxt = "";
     &enTeclaOK = 0;
     &Tempo = "";
     &enModoCab = 0;
     nModoLin = 0;
     nPanta = 0;
     nPantaCab = 0;
     nPantaLin = 0;
     nPanReseDir = 0;
     nRango = 0;
     nGridCab = 0;
     nGridLin = 0;
     nGridTra = 0;
     nGridCon = 0;
     nGridEspe = 0;
     nBtnAlta = 0;
     nBtnModi = 0;
     nBtnBaja = 0;
     nBtnCons = 0;
     nBtnImpr = 0;
     nBtnIda = 0;
     nBtnVuelta = 0;
     nBtnAltaLin = 0;
     nBtnModiLin = 0;
     nBtnBajaLin = 0;
     nBtnConsLin = 0;
     nBtnDatoGen = 0;
     nBtnBusca = 0;
     nBtnBuscaTpv = 0;
     nBtnAnula = 0;
     nBtnDatoAnula = 0;
     nBtnDatoWeb = 0;
     nBtnModiCon = 0;
     nBtnBajaCon = 0;
     nBtnConsCon = 0;
     nBtnImprCon = 0;
     nBtnCobro = 0;
     nBtnCobroRese = 0;
     nLbl159_1 = -1;
     nLbl159_2 = -1;
     nLbl159_3 = -1;
     nLbl159_4 = -1;
     nLbl159_5 = -1;
     i = 0;
     j = 0;
     fFecha = @;
     fDesde = @;
     fHasta = @;
     nReg0 = 0;
     nReg1 = 0;
     nRegLin0 = 0;
     nRegLin1 = 0;
     nBloquea = 0;
     nId = 0;
     nLin = 0;
     aConte = "";
     nHay = 0;
     aInforme = "";
     aAlfa = "";
     aTemporada = "";
     aTmp13 = "";
     aTmp13b = "";
     aTmp14 = "";
     aTmp15 = "";
     aTmp117 = "";
     aTmpCon = "";
     aHora = "";
     aMinu = "";
     nHora = 0;
     nMinu = 0;
     aDias = "";
     aDiaS = "";
     aDiaV = "";
     aDiaSemanaN = "";
     aDiaSemanaL = "";
     nNume = 0;
     aGuarda = "";
     nSwBusServi = 0;
     nSwVuelta = 0;
     aPobOrg = "";
     aPobDes = "";
     nError = 0;
     nImpoS = 0;
     nImpoV = 0;
     nImpo = 0;
     nPax = 0;
     nForma = 0;
     nSwFin = 0;
     nSw = 0;
     nSwBorra = 0;
     nSwActualiza = 0;
     aTipoAct = "";
     fSalida = @;
     nRese = 0;
     nCampo = 0;
     nTieneLineasLin = 0;
     aLon = "";
     nPos = 0;
     aDia = "";
     aClaveFecInf = "";
     &eaCamCab = "";
     aCamLin = "";
     nImpTasa = 0;
     nImpBillete = 0;
     nImpSupleI = 0;
     nImpSupleV = 0;
     nSwTmp2Lin = 0;
     nPaxOrg = 0;
     nImpOrg = 0;
     nContaRese = 0;
     nDias = 0;
     nHoras = 0;
     nHoras1 = 0;
     nHoras2 = 0;
     fHoy = @;
     {99}nReseImpre = 0;
     nImpEntrega = 0;
     nSwSugeridos = 0;
     aMensa = "";
     nBtnRecalRese = 0;
     nNumPrimeRese = 0;
|FIN;

|PROCESO BtnRecalRese;
     |SI #157#83 = "S"; |O #157#143 = "S";
          |MENAV "0000La reserva esta facturada no se puede recalcular.";
     |SINO;
          |CONFI "0000N¨Recalcular importe de la reserva?";
          |SI FSalida = 0;
               |HAZ Recalcula;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO DiaSemana;
     |SI fFecha = "01.01.0000";
          aDiaSemanaN = ""; aDiaSemanaL = "";
     |SINO;
          fFecha = fFecha % A1; aAlfa = fFecha % 1102;
          |SI aAlfa = "Lu"; aDiaSemanaN = "1"; aDiaSemanaL = "L"; |FINSI;
          |SI aAlfa = "Ma"; aDiaSemanaN = "2"; aDiaSemanaL = "M"; |FINSI;
          |SI aAlfa = "Mi"; aDiaSemanaN = "3"; aDiaSemanaL = "X"; |FINSI;
          |SI aAlfa = "Ju"; aDiaSemanaN = "4"; aDiaSemanaL = "J"; |FINSI;
          |SI aAlfa = "Vi"; aDiaSemanaN = "5"; aDiaSemanaL = "V"; |FINSI;
          |SI aAlfa = "Sa"; aDiaSemanaN = "6"; aDiaSemanaL = "S"; |FINSI;
          |SI aAlfa = "Do"; aDiaSemanaN = "7"; aDiaSemanaL = "D"; |FINSI;
     |FINSI;
|FPRC;

|PROCESO FormaHora;
     aHora = aAlfa % 102; nHora = aHora; nHora = nHora $ 24;
     aMinu = aAlfa % 402; nMinu = aMinu; nMinu = nMinu $ 60;
     aAlfa = (("00" + nHora)%-102) + ":" + (("00" + nMinu)%-102);
|FPRC;

|PROCESO BuscaTempo;
     |SI nSwTempoFRese = 1;
          |SI #157#1 ] #8#2; |Y #157#1 [ #8#3;
               aTemporada = #8#0;
               |ERROR10;
          |FINSI;
     |SINO;
          |SI nSwVuelta = 0;
               |SI #157#20 ] #8#2; |Y #157#20 [ #8#3;
                    aTemporada = #8#0;
                    |ERROR10;
               |FINSI;
          |SINO;
               |SI #157#26 ] #8#2; |Y #157#26 [ #8#3;
                    aTemporada = #8#0;
                    |ERROR10;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE BuscaTempo;
     #8#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, BuscaTempo;
|FIN;

|PROCESO BtnDatoGen;
     |LEE 020#52=;
/*
     |VENTANA 0901, 2898, -1, 17, "Datos Generales";
     |HAZ PushVenModal;
     |PARA i = 0; |SI i < eaCamCab; |HACIENDO i = i + 1;
          #161i = #52i;
     |SIGUE;
     |PINPA #0#161;
     |PINDA #0#161;
     |PAUSA;
     |HAZ PopVenModal;
*/
     |HAZ BtnDatoGen2;
|FPRC;

|PROCESO BtnModiCon;
     |LEE 000#refecon@.=;
     |SI FSalida ! 0; |ACABA; |FINSI;

     #52#0 = #refecon@#0;
     |HAZ BtnModi;

     |BORRA 020#refecon@.a;
     |SALVA_DATOS #52;
     |REPON_DATOS #refecon@;
     |GRABA 020#refecon@.n;
     |REFRESCACONTROL nGridCon;
|FPRC;

|PROCESO BtnBajaCon;
     |LEE 000#refecon@.=;
     |SI FSalida ! 0; |ACABA; |FINSI;

     #52#0 = #refecon@#0;
     |HAZ BtnBaja;
     |SI nSwBorra = 0;
          |BORRA 020#refecon@.a;
          |REFRESCACONTROL nGridCon;
          |HAZ TieneLineasCon;
     |FINSI;
|FPRC;

|PROCESO BtnConsCon;
     |LEE 000#refecon@.=;
     |SI FSalida ! 0; |ACABA; |FINSI;

     #52#0 = #refecon@#0;
     |HAZ BtnCons;
|FPRC;

|PROCESO BtnImprCon;
     |LEE 000#refecon@.=;
     |SI FSalida ! 0; |ACABA; |FINSI;

     #52#0 = #refecon@#0;
     |HAZ BtnImpr;
|FPRC;

|PROCESO TieneLineasCon;
     |DDEF aAlfa;
     aAlfa = aAlfa + "sctrm052";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |NOME_DAT #referen@#aTmpCon#;
          |ABRE #referen@;
          |LEE 000#referen@.p;
          |SI FSalida = 0;
               |ESTADO_CONTROL nBtnModiCon, "ENABLE";
               |ESTADO_CONTROL nBtnBajaCon, "ENABLE";
               |ESTADO_CONTROL nBtnConsCon, "ENABLE";
               |ESTADO_CONTROL nBtnImprCon, "ENABLE";
          |SINO;
               |ESTADO_CONTROL nBtnModiCon, "DISABLE";
               |ESTADO_CONTROL nBtnBajaCon, "DISABLE";
               |ESTADO_CONTROL nBtnConsCon, "DISABLE";
               |ESTADO_CONTROL nBtnImprCon, "DISABLE";
          |FINSI;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|PROCESO EvenCon;
     |SI FSalida = 1; |O FSalida = 2;
          |SELECT #1#refecon@;
          |LEE 000#refecon@.=;
          |HAZ TieneLineasCon;
     |FINSI;
     |SI FSalida = 4;
          |HAZ BtnConsCon;
     |FINSI;
|FPRC;

|PROCESO ConsuRese;
     |SALVA_DATOS #52;
     |REPON_DATOS #refecon@;
     |GRABA 020#refecon@.n;
|FPRC;

|DEFBUCLE ConsuRese;
     #52#1;
     42, 4, 43, 46, 20, 75, 22, 8, 12, 45;
     #162#0, #162#2, #162#4, #162#6, #162#8, #162#10, #162#12, #162#14, #162#16, #162#18, #162#20;
     #162#1, #162#3, #162#5, #162#7, #162#9, #162#11, #162#13, #162#15, #162#17, #162#19, #162#21;
     ;
     NULL, ConsuRese;
|FIN;

|PROCESO BtnBusca;
     |SALVA_DATOS #52;
     |VENTANA 1009, 2591, -1, 17, "Busqueda de Reservas";
     |HAZ PushVenModal;
     |DDEFECTO #162;
     #162#10 = ~;
     aAlfa = "01.01." + (#162#10 % 704);
     #162#10 = aAlfa;
     aAlfa = "31.12." + (#162#10 % 704);
     #162#11 = aAlfa;
     |PINPA #0#162;
     |PINDA #0#162;
     |ENDATOS #1#162;
     |SI FSalida = 0;
          |DDEF aAlfa; aAlfa = aAlfa + "sctrm052";
          |CARGA_DEF aAlfa, refecon@;
          |SI FSalida = 0;
               |HAZ CreaTempo; |NOME_DAT #refecon@#Tempo#; aTmpCon = Tempo; |DELINDEX #refecon@;
               |ABRE #refecon@;
               eaMensaje = "Buscandor reservas...";
               |HAZ IniMensaje;
               |BUCLE ConsuRese;
               |HAZ FinMensaje;
               |LEE 000#refecon@.p;
               |SI FSalida = 0;
                    |VENTANA 0901, 2898, -1, 17, "Consulta Reservas";
                    |HAZ PushVenModal;

                    |CONTROL_SIMPLE 0, "BOTON,{{197}}Modificar", 1002, 1012, BtnModiCon;
                    nBtnModiCon = FSalida;
                    |CONTROL_SIMPLE 0, "BOTON,{{199}}Baja", 1014, 1024, BtnBajaCon;
                    nBtnBajaCon = FSalida;
                    |CONTROL_SIMPLE 0, "BOTON,{{155}}Consulta", 1026, 1036, BtnConsCon;
                    nBtnConsCon = FSalida;
                    |CONTROL_SIMPLE 0, "BOTON,{{205}}Impresi¢n", 1038, 1048, BtnImprCon;
                    nBtnImprCon = FSalida;
                    nRango = 4 + 8 + 16 + 32;
                    |LINEAL_SIMPLE #1#refecon@, nRango, 1102, 2697, NULL, NULL, EvenCon;
                    nGridCon = FSalida;
                    enCtrFin = nGridCon;
                    |HAZ EsperaFin;

                    |HAZ PopVenModal;
               |SINO;
                    |MENAV "0000Selecci¢n vacia...";
               |FINSI;
               |CIERRA #refecon@;
               Tempo = aTmpCon; |HAZ BoraTempo; |DELINDEX #refecon@;
          |FINSI;
     |FINSI;
     |HAZ PopVenModal;
     |REPON_DATOS #52;
     |LEE 020#52=;
     |REFRESCACONTROL nGridCab;
|FPRC;

|PROCESO BtnBuscaTpv;
     |MENAV "0000En estudio...";
|FPRC;

|PROCESO BusReseEspera;
     |SI #52#0 ! nRese;
          |SI #52#52 = "L";
               #16#0 = "";
               |PARA i = 0; |SI i < eaCamCab; |HACIENDO i = i + 1;
                    nCampo = i + 1;
                    #16nCampo = #52i;
               |SIGUE;
               |GRABA 020#16n;
          |FINSI;
    |FINSI;
|FPRC;

|DEFBUCLE BusReseEspera;
     #52#2;
     8, 12, 21;
     fSalida, 000000, 0000000, aPobOrg, aPobDes, aHora;
     fSalida, 999999, 9999999, aPobOrg, aPobDes, aHora;
     ;
     NULL, BusReseEspera;
|FIN;

|PROCESO BtnConsEspe;
     #52#0 = #16#1;
     |HAZ BtnCons;
|FPRC;

|PROCESO EvenEspe;
     |SI FSalida = 4;
          |SI #16#0 = " ";
               #16#0 = "*";
          |SINO;
               #16#0 = "";
          |FINSI;
          |PINTA #16#0;
          |GRABA 020#16a;
     |FINSI;
|FPRC;

|PROCESO TmpReseEspera;
     #52#0 = #16#1;
     |LEE 121#52=;
     |SI FSalida = 0;
          #26#0 = #52#96;
          #26#2 = #52#75;
          #26#4 = #52#101;
          #26#5 = #52#22;
          nNume = #52#20 - #52#99 + 1;
          #26#7 = nNume;
          |LEE 000#26=;
          |SI FSalida ! 0;
               aAlfa = "0000No existe viaje ida para esa fecha. Reserva:" + #52#0;
               |MENAV aAlfa;
          |SINO;
               nNume = #26#20 - #26#26;
               |SI nNume < #52#19;
                    aAlfa = "0000No hay Pax libres para el viaje de ida. Reserva:" + #52#0;
                    |MENAV aAlfa;
               |SINO;
                    nSwActualiza = 1;
                    aTipoAct = "I";
                    nForma = 1;
                    |HAZ Actualiza;
                    #52#52 = "P";
                    |GRABA 020#52a;
               |FINSI;
          |FINSI;
          |SI #52#26 ! "01.01.0000";
               #26#0 = #52#105;
               #26#2 = #52#60;
               #26#4 = #52#102;
               #26#5 = #52#28;
               nNume = #52#26 - #52#100 + 1;
               #26#7 = nNume;
               |LEE 000#26=;
               |SI FSalida ! 0;
                    aAlfa = "0000No existe viaje vuelta para esa fecha. Reserva:" + #52#0;
                    |MENAV aAlfa;
               |SINO;
                    nNume = #26#20 - #26#26;
                    |SI nNume < #52#19;
                         aAlfa = "0000No hay Pax libres para el viaje de vuelta. Reserva:" + #52#0;
                         |MENAV aAlfa;
                    |SINO;
                         nSwActualiza = 1;
                         aTipoAct = "V";
                         nForma = 1;
                         |HAZ Actualiza;
                         #52#53 = "P";
                         |GRABA 020#52a;
                    |FINSI;
               |FINSI;
          |FINSI;
          |LIBERA #52;
     |FINSI;
     nSwActualiza = 0;
|FPRC;

|DEFBUCLE TmpReseEspera;
     #16#1;
     0;
     0000000, "*";
     9999999, "*";
     ;
     NULL, TmpReseEspera;
|FIN;

|PROCESO ReseEspera;
     nRese = #52#0;
     fSalida = #52#20;
     aPobOrg = #52#8;
     aPobDes = #52#12;
     aHora =  #52#21;
     |HAZ CreaTempo; |NOME_DAT #16 Tempo; |DELINDEX #16; |ABRE #16;
     |BUCLE BusReseEspera;
     |LEE 000#16p;
     |SI FSalida = 0;
          |VENTANA 0901, 2898, -1, 17, "Reservas en Espera";
          |HAZ PushVenModal;

          |CONTROL_SIMPLE 0, "BOTON,{{155}}Consulta", 1002, 1012, BtnConsEspe;
          |CONTROL_SIMPLE 0, "LABEL,{{003}}(Doble click marca/desmarca)", 1068, 1098, NULL;
          nRango = 4 + 8 + 16 + 32;
          |LINEAL_SIMPLE #1#16, nRango, 1102, 2697, NULL, NULL, EvenEspe;
          nGridEspe = FSalida;
          enCtrFin = nGridEspe;
          |HAZ EsperaFin;

          |ABRE #26;
          |BUCLE TmpReseEspera;
          |CIERRA #26;

          |HAZ PopVenModal;
     |FINSI;
     |HAZ BoraTempo; |CIERRA #16; |DELINDEX #16;
|FPRC;

|PROCESO ImpAnula; |TIPO 0;
     |SI #163#1 = "P";
          nNume = #52#32 - #52#108;
          |SI #163#4 > nNume;
               aAlfa = "0000Se supera el total:" + nNume;
               |MENAV aAlfa;
               |ERROR; nError = 1;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO TipoTranAnula; |TIPO 0;
     |SI #163#1 = "T";
          |SI nHoras > #100#20;
               nImpo = (#52#32 - #52#108) * #100#21 / 100;
          |SINO;
               nImpo = (#52#32 - #52#108) * #100#22 / 100;
          |FINSI;
          #163#4 = nImpo; |PINTA #163#4;
          |C_M #163#4, 1, "N"; |PINTA #163#4;
     |FINSI;
     |SI #163#1 = "P";
          |C_M #163#4, 1, "S"; |PINTA #163#4;
     |FINSI;
     |SI #163#1 = "C";
          #163#4 = #52#32; |PINTA #163#4;
          |C_M #163#4, 1, "N"; |PINTA #163#4;
     |FINSI;
|FPRC;

|PROCESO CheqTipoAnula; |TIPO 0;
     nError = 0;
     fHoy = ~;
     |HORA aHora;
     aAlfa = fHoy % 704; nNume = aAlfa - 1;
     |SI #163#0 = "T"; |O #163#0 = "S";
          nDias = fHoy - nNume;
          aHora = aHora % 102;
          nHoras1 = nDias * 24 + aHora;
          nDias = #52#20 - nNume;
          aHora = #52#21 % 102;
          nHoras2 = nDias * 24 + aHora;
          nHoras = nHoras2 - nHoras1;
          |SI nHoras < #100#19;
               |MENAV "0000No se permite la devoluci¢n, tope horas para salida inferior al m¡nimo exigido...";
               eaTitulo = "Clave para anulaci¢n reserva";
               |HAZ PideClave;
               |SI eaClave ! #100#29;
                    |MENAV "0000Clave incorrecta...";
                    |ERROR; nError = 1;
               |FINSI;
          |FINSI;
     |SINO;
          |SI #52#26 ! "01.01.0000";
               nDias = fHoy - nNume;
               nHoras1 = nDias * 24 + (aHora % 102);
               nDias = #52#26 - nNume;
               nHoras2 = nDias * 24 + (#52#27 % 102);
               nHoras = nHoras2 - nHoras1;
               |SI nHoras < #100#19;
                    |MENAV "0000No se permite la devoluci¢n, tope horas para salida inferior al m¡nimo exigido...";
                    |ERROR; nError = 1;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO AnulaRese;
     |HAZ CheqTipoAnula;
     |SI nError = 0; |HAZ ImpAnula; |FINSI;
     |SI nError = 0;
          nSwActualiza = 1;
          |SI #163#0 = "S"; |O #163#0 = "T";
               |SI #52#52 ! "A";
                    #52#52 = "A";
                    aTipoAct = "I";
                    nForma = -1;
                    |HAZ Actualiza;

                    enPax = -1;
                    enLinea = #52#75;
                    eaSentido = #52#101;
                    nNume = #52#20 - #52#99 + 1;
                    efFechaViaje = nNume;
                    |HAZ CtrlViajerosAct;
               |FINSI;
          |FINSI;
          |SI #163#0 = "R"; |O #163#0 = "T";
               |SI #52#53 ! "A";
                    #52#53 = "A";
                    aTipoAct = "V";
                    nForma = -1;
                    |HAZ Actualiza;

                    |SI #52#26 ! "01.01.0000";
                         enPax = -1;
                         enLinea = #52#80;
                         eaSentido = #52#102;
                         nNume = #52#26 - #52#100 + 1;
                         efFechaViaje = nNume;
                         |HAZ CtrlViajerosAct;
                    |FINSI;
               |FINSI;
          |FINSI;
          nSwActualiza = 0;
          #52#63 = #163#0;
          #52#64 = ~;
          |HORA aAlfa;
          #52#65 = aAlfa;
          #52#66 = #47#0;
          #52#67 = #163#3;
          #52#68 = #47#3;
          #52#69 = #46#1;
          #52#72 = #163#4;
          #52#112 = #163#1;
          |SI #52#63 = "T"; |O #52#63 = "S";
               #52#73 = "01.01.0000"
               #52#74 = 0;
               #52#77 = 0;
               #52#103 = 0;
               #52#122 = 0;
          |FINSI;
          |SI #52#63 = "T"; |O #52#63 = "R";
               #52#78 = "01.01.0000"
               #52#79 = 0;
               #52#82 = 0;
               #52#104 = 0;
               #52#123 = 0;
          |FINSI;
          |GRABA 020#52a;
          |LIBERA #52;
          |HAZ ReseEspera;
     |FINSI;
|FPRC;

|PROCESO BtnAnula;
     |HAZ Oficina;
     |SI #100#27 < #47#2;
          |MENAV "0000Usuario no permitido...";
          |ACABA;
     |FINSI;

     |LEE 020#52=;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |SI #52#63 = "T";
          |MENAV "0000La reserva esta anulada...";
          |SI #52#89 = "N";
               |CONFI "0000N¨Quiere restaurar la reserva?";
               |SI FSalida = 0;
                    |LEE 120#52=;
                    |SI FSalida = 0;
                         #52#52 = "P";
                         #52#53 = "P";
                         #52#63 = "";
                         #52#64 = "01.01.0000";
                         #52#65 = "";
                         #52#66 = "";
                         #52#67 = "";
                         #52#68 = 0;
                         #52#69 = "";
                         #52#72 = 0;
                         #52#112 = "";
                         |GRABA 020#52a;
                         |LIBERA #52;

                         enPax = 1;
                         enLinea = #52#75;
                         eaSentido = #52#101;
                         nNume = #52#20 - #52#99 + 1;
                         efFechaViaje = nNume;
                         |HAZ CtrlViajerosAct;
                         |SI #52#17 ] 2; |Y #52#26 ! "01.01.0000";
                              enPax = 1;
                              enLinea = #52#80;
                              eaSentido = #52#102;
                              nNume = #52#26 - #52#100 + 1;
                              efFechaViaje = nNume;
                              |HAZ CtrlViajerosAct;
                         |FINSI;

                         |REFRESCACONTROL nGridCab;
                    |FINSI;
               |FINSI;
          |FINSI;
     |SINO;
          |LEE 120#52=;
          |SI FSalida ! 0; |ACABA; |FINSI;
          |SALVA_DATOS #52;

          |VENTANA 1501, 2598, -1, 17, "Anulaci¢n de Reserva";
          |HAZ PushVenModal;

          |DDEFECTO #163;
          #163#2 = #52#0;
          #163#3 = #52#67;
          #163#4 = #52#72;
          #163#5 = #52#32;
          #163#6 = #52#108;
          |PINPA #0#163;
          |PINDA #0#163;
          |PARA; |SI; |HACIENDO;
               |ENDATOS #1#163;
               |SI FSalida ! 0;
                    |SAL;
               |SINO;
                    |SI #163#1 = " ";
                         |MENAV "0000Debe de indicar el tipo de transacci¢n...";
                    |SINO;
                         |SI #163#4 = 0;
                              |CONFI "0000N¨Esta seguro que el importe es 0?";
                         |SINO;
                              FSalida = 0;
                         |FINSI;
                         |SI FSalida = 0;
                              |HAZ AnulaRese;
                              |SAL;
                         |FINSI;
                    |FINSI;
               |FINSI;
          |SIGUE;
          |HAZ PopVenModal;

          |LIBERA #52;
          |REPON_DATOS #52;
          |SELECT #8#52;
          |LEE 020#52=;

          |REFRESCACONTROL nGridCab;
     |FINSI;
|FPRC;

|PROCESO BtnDatoAnula;
     |LEE 020#52=;

     |SI #52#52 = "A"; |O #52#53 = "A";
          |VENTANA 1401, 2598, -1, 17, "Datos Anulaci¢n de la Reserva";
          |HAZ PushVenModal;

          |PARA i = 0; |SI i < eaCamCab; |HACIENDO i = i + 1;
               #164i = #52i;
          |SIGUE;

          |PINPA #0#164;
          |PINDA #0#164;
          |PAUSA;

          |HAZ PopVenModal;
     |SINO;
          |MENAV "0000La reserva no esta anulada...";
     |FINSI;
|FPRC;

|PROCESO BtnDatoWeb;
     |LEE 020#52=;
     |MENAV "0000En estudio...";
|FPRC;
------------------------------------------------------------------------
|PROCESO Entrega159; |TIPO 0;
     |SI #159#114 > #159#32;
          |MENAV "0000Importe incorrecto, supera al total localizador...";
          |ERROR;
     |SINO;
          #159#115 = #159#32 - #159#114; |PINTA #159#115;
     |FINSI;
|FPRC;

|PROCESO FPagoRese159; |TIPO 0;
     |SI #159#113 = "T";
          |C_M #159#118, 1, "S"; |PINTA #159#118;
          |C_M #159#119, 1, "S"; |PINTA #159#119;
          |C_M #159#120, 1, "S"; |PINTA #159#120;
     |SINO;
          |C_M #159#118, 1, "N"; |PINTA #159#118;
          |C_M #159#119, 1, "N"; |PINTA #159#119;
          |C_M #159#120, 1, "N"; |PINTA #159#120;
     |FINSI;
|FPRC;

|PROCESO FCobro159; |TIPO 0;
     |SI #159#38 = "T";
          |C_M #159#39, 1, "S"; |PINTA #159#39;
          |C_M #159#40, 1, "S"; |PINTA #159#40;
          |C_M #159#41, 1, "S"; |PINTA #159#41;
     |SINO;
          |C_M #159#39, 1, "N"; |PINTA #159#39;
          |C_M #159#40, 1, "N"; |PINTA #159#40;
          |C_M #159#41, 1, "N"; |PINTA #159#41;
     |FINSI;
     |SI #159#38 = "R";
          |SI #159#113 = " "; #159#113 = "M"; |FINSI;
          |SI nLbl159_1 < 0;
               |CONTROL_SIMPLE nPanReseDir, "LABEL,{{001}}F.pago reserva", 0828, 0842, NULL;
               nLbl159_1 = FSalida;
               |CONTROL_SIMPLE nPanReseDir, "LABEL,{{002}}Met lico", 0848, 0858, NULL;
               nLbl159_2 = FSalida;
               |CONTROL_SIMPLE nPanReseDir, "LABEL,{{002}}Tarjeta", 0948, 0958, NULL;
               nLbl159_3 = FSalida;
               |CONTROL_SIMPLE nPanReseDir, "LABEL,{{001}}Importe entregado", 1028, 1044, NULL;
               nLbl159_4 = FSalida;
               |CONTROL_SIMPLE nPanReseDir, "LABEL,{{001}}Importe pendiente", 1128, 1144, NULL;
               nLbl159_5 = FSalida;
          |FINSI;
          |C_V #159#113, 1, "S"; |PINTA #159#113;
          |C_V #159#114, 1, "S"; |PINTA #159#114;
          |C_V #159#115, 1, "S"; |PINTA #159#115;
          |C_V #159#39, 1, "N";
          |C_V #159#40, 1, "N";
          |C_V #159#41, 1, "N";
          |C_V #159#118, 1, "S"; |PINTA #159#118;
          |C_V #159#119, 1, "S"; |PINTA #159#119;
          |C_V #159#120, 1, "S"; |PINTA #159#120;
          #159#115 = #159#32 - #159#114; |PINTA #159#115;
     |SINO;
          |SI nLbl159_1 ] 0;
               |FIN_CONTROL_WINDOWS nLbl159_1;
               |FIN_CONTROL_WINDOWS nLbl159_2;
               |FIN_CONTROL_WINDOWS nLbl159_3;
               |FIN_CONTROL_WINDOWS nLbl159_4;
               |FIN_CONTROL_WINDOWS nLbl159_5;
               nLbl159_1 = -1;
          |FINSI;
          |C_V #159#113, 1, "N";
          |C_V #159#114, 1, "N";
          |C_V #159#115, 1, "N";
          |C_V #159#118, 1, "N";
          |C_V #159#119, 1, "N";
          |C_V #159#120, 1, "N";
          |C_V #159#39, 1, "S"; |PINTA #159#39;
          |C_V #159#40, 1, "S"; |PINTA #159#40;
          |C_V #159#41, 1, "S"; |PINTA #159#41;
     |FINSI;
|FPRC;

|PROCESO CobroReseDir;
     |VENTANA 2001, 3098, -1, 17, "Cobro Reserva Directa";
     |HAZ PushVenModal;
     |PARA i = 0; |SI i < eaCamCab; |HACIENDO i = i + 1;
          #159i = #52i;
     |SIGUE;

     aAlfa = #100#38;
     |C_M #159#42, 1, aAlfa;

     |C_P #159#39, 0, nPos; |C_P #159#118, 1, nPos;
     |C_P #159#40, 0, nPos; |C_P #159#119, 1, nPos;
     |C_P #159#41, 0, nPos; |C_P #159#120, 1, nPos;
     |PINPA #0#159; nPanReseDir = FSalida;
     |PINDA #0#159;
     |HAZ FCobro159;
     |HAZ FPagoRese159;
     |ENDATOS #1#159;
     nError = FSalida;
     |SI FSalida = 0;
          |SI #159#38 ! "T";
               #159#39 = "";
               #159#40 = 0;
               #159#41 = 0;
               |SI #159#38 = "R";
                    |SI #159#113 ! "T";
                         #159#113 = "M";
                         #159#118 = "";
                         #159#119 = 0;
                         #159#120 = 0;
                    |FINSI;
               |SINO;
                    #159#113 = "";
                    #159#114 = 0;
                    #159#115 = 0;
               |FINSI;
          |SINO;
               #159#114 = 0;
               #159#115 = 0;
               #159#118 = "";
               #159#119 = 0;
               #159#120 = 0;
          |FINSI;
          |PARA i = 0; |SI i < eaCamCab; |HACIENDO i = i + 1;
               #52i = #159i;
          |SIGUE;
     |FINSI;
     |HAZ PopVenModal;
     nLbl159_1 = -1;
|FPRC;

|PROCESO BuscaBono160;
     |SI #160#45 ] #40#3; |Y #160#45 [ #40#4;
          nLin = #40#1;
          |ERROR10;
     |FINSI;
|FPRC;

|DEFBUCLE BuscaBono160;
     #40#1;
     ;
     #160#43, 000;
     #160#43, 999;
     ;
     NULL, BuscaBono160;
|FIN;

|PROCESO BonoI; |TIPO 0;
     |SI #52#6 = 2;
          |SI #36#50 = "S";
               |SI #160#45 = 0;
                    |MENAV "0000Debe de introducir el bono.";
                    |ERROR;
               |SINO;
                    |ABRE #41; |SELECT #2#41;
                    #41#0 = #160#43;
                    #41#2 = #160#45;
                    |LEE 000#41=;
                    |SI FSalida = 0;
                         |MENAV "0000El bono ya ha sido utilizado...";
                         |ERROR;
                    |SINO;
                         nLin = 0;
                         |BUCLE BuscaBono160;
                         |SI nLin = 0;
                              ||CONFI "0000NBono no asigando, ¨desea continuar?";
                              ||SI FSalida ! 0; |ERROR; |FINSI;
                              |MENAV "0000Este bono no lo tiene asignado.";
                              |ERROR;
                         |FINSI;
                    |FINSI;
                    |CIERRA #41;
               |FINSI;
          |SINO;
               |SI #160#45 ! 0;
                    ||MENAV "0000La agencia no tiene control de bonos...";
                    ||ERROR;
               |FINSI;
          |FINSI;
     |SINO;
          #160#45 = 0; |PINTA #160#45;
     |FINSI;
|FPRC;

|PROCESO Agencia; |TIPO 0;
     nError = 0;
     |DDEFECTO #36;
     |ABRE #36;
     #36#1 = #160#43;
     |LEE 000#36=;
     |SI FSalida ! 0;
          |SI nSw = 0;
               |MENAV "0000No existe c¢digo cliente...";
               nError = 1;
          |FINSI;
     |SINO;
          |SI nSw = 0;
               |SI #36#70 ! "S";
                    |MENAV "0000A esta agencia no se le permiten ventas indirectas...";
                    nError = 1;
               |FINSI;
               |SI #36#46 ! #160#94;
                    aAlfa = "0000La divisa de la agencia [" + #36#46 + "] es distinta a la reserva [" + #160#94 + "].";
                    |MENAV aAlfa;
                    nError = 1;
               |FINSI;
          |FINSI;
     |FINSI;
     |CIERRA #36;
     #160#44 = #36#2; |PINTA #160#44;
     #160#49 = #36#4; |PINTA #160#49;
     #160#50 = #36#6; |PINTA #160#50;
     #160#51 = #36#20; |PINTA #160#51;
     PROVINCIA = #36#7; |PINTA PROVINCIA;
     |SI nError = 0;
          nSw = 1; |HAZ Provincia; nSw = 0;
          |PINTA 911, #36#5;
     |FINSI;
     |SI nError = 1; |ERROR; |ACABA; |FINSI;
|FPRC;

|PROCESO AgenPob;
     |SALVA_DATOS #36;
     |REPON_DATOS #referen@;
     |GRABA 020#referen@.n;
     nHay = nHay + 1;
|FPRC;

|DEFBUCLE AgenPob;
     #36#1;
     7;
     "      ", #6#0;
     "zzzzzz", #6#0;
     ;
     NULL, AgenPob;
|FIN;

|PROCESO Provincia; |TIPO 0;
     nError = 0;
     |DDEFECTO #6;
     |ABRE #6;
     #6#0 = PROVINCIA;
     |LEE 000#6=;
     |SI FSalida ! 0;
          |SI nSw = 0; |Y PROVINCIA ! 0;
               |MENAV "0000No existe c¢digo de provincia...";
               nError = 1;
          |FINSI;
     |SINO;
          |SI nSw = 0; |Y aConte ! #160Campo; |Y PROVINCIA ! 0;
               |DDEF aAlfa;
               aAlfa = aAlfa + "sctrm036";
               |CARGA_DEF aAlfa, referen@;
               |SI FSalida = 0;
                    |HAZ CreaTempo;
                    |NOME_DAT #referen@#Tempo#; |DELINDEX #referen@; |ABRE #referen@;
                    nHay = 0;
                    |BUCLE AgenPob;
                    |SI nHay = 0;
                         |MENAV "0000No existe agencia en esta provincia...";
                         nError = 1;
                    |FINSI;
                    |SI nHay = 1;
                         #160#43 = #referen@#1; |PINTA #160#43;
                         #160#44 = #referen@#2; |PINTA #160#44;
                         |PTEC 802;
                    |FINSI;
                    |SI nHay > 1;
                         |LEE 000#referen@.p;
                         |CONSULTA_CLAVE #1#referen@;
                         |SI FSalida = 0;
                              #160#43 = #referen@#1; |PINTA #160#43;
                              #160#44 = #referen@#2; |PINTA #160#44;
                              |PTEC 802;
                         |SINO;
                              nError = 1;
                         |FINSI;
                    |FINSI;
                    |CIERRA #referen@; |HAZ BoraTempo; |DELINDEX #referen@;
                    |DESCARGA_DEF #referen@;
               |FINSI;
          |FINSI;
     |FINSI;
     |CIERRA #6;
     |PINTA 721, #6#1;
     |SI nError = 1; |ERROR; |ACABA; |FINSI;
|FPRC;

|PROCESO Conte160; |TIPO 7;
     aConte = #160Campo;
|FPRC;

|PROCESO CobroReseInd;
     |VENTANA 1901, 3098, -1, 17, "Cobro Reserva Indirecta";
     |HAZ PushVenModal;
     |PARA i = 0; |SI i < eaCamCab; |HACIENDO i = i + 1;
          #160i = #52i;
     |SIGUE;

     |DDEFECTO #36;
     |ABRE #36;
     #36#1 = #52#43;
     |LEE 000#36=;
     |CIERRA #36;
     PROVINCIA = #36#7;

     aAlfa = #100#38;
     |C_M #160#42, 1, aAlfa;

     |SI enModoCab = 1; |Y nContaRese > 1;
          |SI #160#45 > 0; #160#45 = #160#45 + 1; |FINSI;
          |C_M PROVINCIA, 1, "N";
          |C_M #160#43, 1, "N";
          |C_M #160#46, 1, "N";
          |C_M #160#47, 1, "N";
          |C_M #160#48, 1, "N";
     |SINO;
          |C_M PROVINCIA, 1, "S";
          |C_M #160#43, 1, "S";
          |C_M #160#46, 1, "S";
          |C_M #160#47, 1, "S";
          |C_M #160#48, 1, "S";
     |FINSI;
     |PINPA #0#160;
     |PINDA #0#160;
     nSw = 1;
     |HAZ Provincia;
     |HAZ Agencia;
     nSw = 0;
     |ENDATOS #1#160;
     nError = FSalida;
     |SI FSalida = 0;
          aAlfa = #52#126;
          |PARA i = 0; |SI i < eaCamCab; |HACIENDO i = i + 1;
               #52i = #160i;
          |SIGUE;
          |SI aAlfa ! #52#126;
               |SI #52#126 = "N";
                    |SI enModoCab = 1;
                         #52#38 = "M";
                         #52#114 = 0;
                         #52#115 = 0;
                   |FINSI;
               |SINO;
                    #52#38 = "R";
                    #52#115 = #52#32;
                    #52#114 = 0;
               |FINSI;
          |FINSI;
     |FINSI;
     |HAZ PopVenModal;
|FPRC;

|PROCESO BuscaBono168;
     |SI #168#45 ] #40#3; |Y #168#45 [ #40#4;
          nLin = #40#1;
          |ERROR10;
     |FINSI;
|FPRC;

|DEFBUCLE BuscaBono168;
     #40#1;
     ;
     #10#2, 000;
     #10#2, 999;
     ;
     NULL, BuscaBono168;
|FIN;

|PROCESO BonoG; |TIPO 0;
     |ABRE #10;
     #10#0 = #168#56;
     |LEE 000#10=;
     |SI FSalida ! 0; |DDEFECTO #10; |FINSI;
     |CIERRA #10;

     |SI #52#6 = 3;
          |SI #36#50 = "S";
               |SI #168#45 ! 0;
                    |ABRE #41; |SELECT #2#41;
                    #41#0 = #10#2;
                    #41#2 = #168#45;
                    |LEE 000#41=;
                    |SI FSalida = 0;
                         |MENAV "0000El bono ya ha sido utilizado...";
                         |ERROR;
                    |SINO;
                         nLin = 0;
                         |BUCLE BuscaBono160;
                         |SI nLin = 0;
                              ||CONFI "0000NBono no asigando, ¨desea continuar?";
                              ||SI FSalida ! 0; |ERROR; |FINSI;
                              |MENAV "0000Este bono no lo tiene asignado.";
                              |ERROR;
                         |FINSI;
                    |FINSI;
                    |CIERRA #41;
               |FINSI;
          |SINO;
               |SI #168#45 ! 0;
                    ||MENAV "0000La agencia no tiene control de bonos...";
                    ||ERROR;
               |FINSI;
          |FINSI;
     |SINO;
          #168#45 = 0; |PINTA #168#45;
     |FINSI;
|FPRC;

|PROCESO DivisaSocio; |TIPO 0;
     |ABRE #324;
     #324#0 = #168#60;
     |LEE 000#324=;
     |SI FSalida = 0;
          |PINTA 921, #324#1;
          |SI #168#60 ! #168#94;
               |SI nSw = 0;
                    aAlfa = "0000La divisa del socio [" + #168#60 + "] es distinta a la reserva [" + #168#94 + "].";
                    |MENAV aAlfa;
                    |ERROR;
               |FINSI;
          |FINSI;
     |SINO;
          |SI nSw = 0;
               |MENAV "0000No existe c¢digo divisa...";
               |ERROR;
          |FINSI;
     |FINSI;
     |CIERRA #324;
|FPRC;

|PROCESO Socio; |TIPO 0;
     |ABRE #10;
     #10#0 = #168#56;
     |LEE 000#10=;
     |SI FSalida = 0;
          |SI aConte ! #168Campo;
               #168#60 = #10#3; |PINTA #168#60;
               nSw = 1; |HAZ DivisaSocio; nSw = 0;
          |FINSI;
          #168#57 = #10#1; |PINTA #168#57;
     |SINO;
          |MENAV "0000No existe c¢digo de socio...";
          |ERROR;
     |FINSI;
     |CIERRA #10;
|FPRC;

|PROCESO Conte168; |TIPO 7;
     aConte = #168Campo;
|FPRC;

|PROCESO CobroReseGru;
     |VENTANA 1901, 3098, -1, 17, "Cobro Reserva Grupo";
     |HAZ PushVenModal;
     |PARA i = 0; |SI i < eaCamCab; |HACIENDO i = i + 1;
          #168i = #52i;
     |SIGUE;

     aAlfa = #100#38;
     |C_M #168#42, 1, aAlfa;

     |SI enModoCab = 1; |Y nContaRese > 1;
          |SI #168#45 > 0; #168#45 = #168#45 + 1; |FINSI;
          |C_M #168#56, 1, "N";
          |C_M #168#60, 1, "N";
     |SINO;
          |C_M #168#56, 1, "S";
          |C_M #168#60, 1, "S";
     |FINSI;
     |PINPA #0#168;
     |PINDA #0#168;
     nSw = 1; |HAZ DivisaSocio; nSw = 0;
     |ENDATOS #1#168;
     nError = FSalida;
     |SI FSalida = 0;
          |PARA i = 0; |SI i < eaCamCab; |HACIENDO i = i + 1;
               #52i = #168i;
          |SIGUE;
     |FINSI;
     |HAZ PopVenModal;
|FPRC;

|PROCESO BuscaBono;
     |SI #52#45 ] #40#3; |Y #52#45 [ #40#4;
          nLin = #40#1;
          |ERROR10;
     |FINSI;
|FPRC;

|DEFBUCLE BuscaBono;
     #40#1;
     ;
     #52#43, 000;
     #52#43, 999;
     ;
     NULL, BuscaBono;
|FIN;

|PROCESO Actualiza;
     |SI #52#6 = 1; |O #52#6 = 2;
          #52#56 = #100#30;
          #52#57 = #100#31;
     |FINSI;

     |ABRE #50;
     |ABRE #26;
     |SI nSwActualiza = 0; |O aTipoAct = "I";
          #26#0 = #52#96;
          #26#2 = #52#75;
          #26#4 = #52#101;
          #26#5 = #52#22;
          nNume = #52#20 - #52#99 + 1;
          #26#7 = nNume;
          |LEE 101#26=;
          |SI FSalida = 0;
               |SI #52#52 = "L";
                    #26#38 = #26#38 + (#52#19 * nForma);
               |SINO;
                    #26#26 = #26#26 + (#52#19 * nForma);
               |FINSI;
               |SI #26#26 ] #26#20;
                    #26#24 = "C";
               |SINO;
                    #26#24 = "A";
               |FINSI;
               |GRABA 020#26a;
               |SI #26#27 ! 0; |Y #52#74 = 0; |Y #52#128 = "S";
                    #50#0 = #26#7;
                    #50#1 = #26#27;
                    |LEE 101#50=;
                    |SI FSalida = 0;
                         #50#20 = #50#20 + (#52#19 * nForma);
                         |GRABA 020#50a;
                         |LIBERA #50;

                         |SI nForma = -1; |Y #52#52 = "A";
                              #52#73 = "01.01.0000";
                              #52#74 = 0;
                              #52#77 = 0;
                              #52#103 = 0;
                              #52#122 = 0;
                         |SINO;
                              |SI #52#52 ! "L";
                                   #52#73 = #50#0;
                                   #52#74 = #50#1;
                                   #52#77 = #50#2;
                                   |SI #52#103 = 0; |Y nForma = 1;
                                        || eaAlfa = "Intercambiador ida";
                                        || |HAZ PideIntercambiador;
                                        || #52#103 = enIntercambiador;
                                   |FINSI;
                              |FINSI;
                         |FINSI;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
     |SI nSwActualiza = 0; |O aTipoAct = "V";
          |SI #52#17 > 1; |Y #52#26 ! "01.01.0000";
               #26#0 = #52#105;
               #26#2 = #52#75;
               #26#4 = #52#102;
               #26#5 = #52#28; || #52#22;
               nNume = #52#26 - #52#100 + 1;
               #26#7 = nNume;
               |LEE 101#26=;
               |SI FSalida = 0;
                    |SI #52#52 = "L";
                         #26#38 = #26#38 + (#52#19 * nForma);
                    |SINO;
                         #26#26 = #26#26 + (#52#19 * nForma);
                    |FINSI;
                    |SI #26#26 ] #26#20;
                         #26#24 = "C";
                    |SINO;
                         #26#24 = "A";
                    |FINSI;
                    |GRABA 020#26a;
                    |SI #26#27 ! 0; |Y #52#79 = 0; |Y #52#129 = "S";
                         #50#0 = #26#7;
                         #50#1 = #26#27;
                         |LEE 101#50=;
                         |SI FSalida = 0;
                              #50#20 = #50#20 + (#52#19 * nForma);
                              |GRABA 020#50a;
                              |LIBERA #50;

                              |SI nForma = -1; |Y #52#53 = "A";
                                   #52#78 = "01.01.0000";
                                   #52#79 = 0;
                                   #52#82 = 0;
                                   #52#104 = 0;
                                   #52#123 = 0;
                              |SINO;
                                   |SI #52#53 ! "L";
                                        #52#78 = #50#0;
                                        #52#79 = #50#1;
                                        #52#82 = #50#2;
                                        |SI #52#104 = 0; |Y nForma = 1;
                                             || eaAlfa = "Intercambiador vuelta";
                                             || |HAZ PideIntercambiador;
                                             || #52#104 = enIntercambiador;
                                        |FINSI;
                                   |FINSI;
                              |FINSI;
                         |FINSI;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
     |CIERRA #26;
     |CIERRA #50;

     |HAZ ActualizaBono;
|FPRC;

|PROCESO ActualizaBono;
     |SI #52#0 = 0; |Y nNumPrimeRese = 0; || en alta es #52#0 = 0
          |ACABA;
     |FINSI;

     |ABRE #36;
     #36#1 = #52#43;
     |LEE 000#36=;
     |SI FSalida ! 0; |DDEFECTO #36; |FINSI;
     |CIERRA #36;

     |SI #52#45 ! 0; |Y #36#50 = "S";
          |SI nForma = -1;
               |ABRE #41; |SELECT #2#41;
               #41#0 = #52#43;
               #41#2 = #52#45;
               |LEE 101#41=;
               |SI FSalida = 0;
                    |BORRA 020#41a;
               |FINSI;
               |CIERRA #41;
          |SINO;
               nLin = 0;
               |BUCLE BuscaBono;
               |SI nLin ! 0;
                    |ABRE #41;
                    #41#0 = #52#43;
                    #41#1 = nLin;
                    #41#2 = #52#45;
                    |SI nNumPrimeRese = 0;
                         #41#3 = #52#0;
                    |SINO;
                         #41#3 = nNumPrimeRese;
                    |FINSI;
                    |GRABA 020#41n;
                    |CIERRA #41;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Comision;
     |HAZ Oficina;
     |SI enModoCab ! 1; |Y #47#3 ! #52#4;
          |ACABA;
     |FINSI;

     #52#55 = 0;
     #52#121 = 0;
     #52#153 = 0;

     aAgencia = #52#43;
     nLineaSer = #52#75;

     |SI #52#6 ] 2; |O #46#21 = "S";
          |ABRE #38;
          #38#0 = aAgencia;
          #38#2 = nLineaSer;
          |LEE 000#38=;
          |SI FSalida = 0;
               #52#55 = #38#4;
          |SINO;
               |ABRE #12;
               #12#0 = nLineaSer;
               |LEE 000#12=;
               |SI FSalida = 0;
                    #52#55 = #12#9;
               |FINSI;
               |CIERRA #12;
          |FINSI;
          |CIERRA #38;
     |FINSI;

     |ABRE #12;
     #12#0 = nLineaSer;
     |LEE 000#12=;
     |SI FSalida = 0;
          #52#121 = #12#20;
     |FINSI;
     |CIERRA #12;

     |SI #52#6 = 4; |O #52#6 = 5;
          |ABRE #38;
          #38#0 = #52#151;
          #38#2 = #52#75;
          |LEE 000#38=;
          |SI FSalida = 0;
               #52#153 = #38#4;
          |SINO;
               |ABRE #12;
               #12#0 = #52#75;
               |LEE 000#12=;
               |SI FSalida = 0;
                    #52#153 = #12#9;
               |FINSI;
               |CIERRA #12;
          |FINSI;
          |CIERRA #38;
     |FINSI;
|FPRC;

|PROCESO TotalLin; |TIPO 0;
     #158#11 = #158#9 + #158#10 + #158#13; |PINTA #158#11;
|FPRC;

|PROCESO DatoTarifa;
     aAlfa = (("00" + #158#7) % -102) + "." + (("0000" + #158#8) % -104);
     #14#0 = aAlfa;
     |LEE 000#14=;
     |SI FSalida ! 0;
          |MENAV "0000No existe tarifa a aplicar...";
          |ERROR;
     |SINO;
          |HAZ PintaCamposLin;

          #158#9 = #14#5; |PINTA #158#9;
          #158#10 = #14#6; |PINTA #158#10;
          #158#14 = #14#3; |PINTA #158#14;
          #158#15 = #14#4; |PINTA #158#15;
          |HAZ DtoAuto; #158#16 = enDtoAuto

          enTotBillete = #158#9 + #158#10; |HAZ IncDisBillete;
          nImpDtoAuto = #158#9 * #158#16 / 100;
          #158#13 = enIncBillete - nImpDtoAuto; |PINTA #158#13;
          |HAZ TotalLin;
     |FINSI;
|FPRC;

|PROCESO TipoTari66; |TIPO 66;
     |C_M #158Campo, 0, aAlfa;
     |SI aAlfa = "N";
          |AVISO;
     |SINO;
          aAlfa = (("00" + #158#7) % -102) + "." + (("0000" + #158#8) % -104);
          #14#0 = aAlfa;
          |LEE 000#14];
          |CONSULTA_CLAVE #1#14;
          |SI FSalida = 0;
               aAlfa = #14#0; aAlfa = aAlfa % 102;
               #158#7 = aAlfa; |PINTA #158#7;
               aAlfa = #14#0; aAlfa = aAlfa % 404;
               #158#8 = aAlfa; |PINTA #158#8;
          |SINO;
               |ERROR;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO TipoTari0;
     |SI FSalida = 2; |ACABA; |FINSI;
     |C_M #158Campo, 0, aAlfa;
     |SI aAlfa = "S";
          |HAZ DatoTarifa;
     |FINSI;
|FPRC;

|PROCESO GrupoTari66; |TIPO 66;
     |C_M #158Campo, 0, aAlfa;
     |SI aAlfa = "N";
          |AVISO;
     |SINO;
          aAlfa = (("00" + #158#7) % -102) + "." + (("0000" + #158#8) % -104);
          #14#0 = aAlfa;
          |LEE 000#14];
          |CONSULTA_CLAVE #1#14;
          |SI FSalida = 0;
               aAlfa = #14#0; aAlfa = aAlfa % 102;
               #158#7 = aAlfa; |PINTA #158#7;
               aAlfa = #14#0; aAlfa = aAlfa % 404;
               #158#8 = aAlfa; |PINTA #158#8;
          |SINO;
               |ERROR;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO GrupoTari0;
     |C_M #158Campo, 0, aAlfa;
     |SI aAlfa = "S";
          |ABRE #7;
          #7#0 = #158#7;
          |LEE 000#7=;
          |SI FSalida ! 0;
               |MENAV "0000No existe c¢digo grupo tarifa...";
               |ERROR;
          |SINO;
               |HAZ DatoTarifa;
          |FINSI;
          |CIERRA #7;
     |FINSI;
|FPRC;

|PROCESO Nombre; |TIPO 0;
     aAlfa = #158#3; |QBF aAlfa;
     |SI aAlfa = "";
          |MENAV "0000El nombre es obligatorio...";
          |ERROR;
     |FINSI;
|FPRC;

|PROCESO Documento0; |TIPO 0;
     aAlfa = #158#2; |QBF aAlfa;
     aAlfa = aAlfa > "";
     #158#2 = aAlfa; |PINTA #158#2;
     |SI aAlfa ! "";
          |ABRE #42;
          #42#5 = #158#17;
          #42#0 = #158#2;
          |LEE 000#42=;
          |SI FSalida = 0;
               #158#3 = #42#1; |PINTA #158#3;
               #158#4 = #42#2; |PINTA #158#4;
               #158#5 = #42#3; |PINTA #158#5;
               #158#18 = #42#4; |PINTA #158#18;
          |FINSI;
          |CIERRA #42;
     |FINSI;
|FPRC;

|PROCESO Min42;
     #42#5 = #158#17;
     #42#0 = " " * 20;
|FPRC;

|PROCESO Max42;
     #42#5 = #158#17;
     #42#0 = "z" * 20;
|FPRC;

|PROCESO Documento66; |TIPO 66;
     |ABRE #42;
     #42#5 = #158#17;
     #42#0 = 0;
     |LEE 000#42];
     |CONSULTA_F_CLAVE #1#42, Min42, Max42;
     |SI FSalida = 0;
          #158#2 = #42#0; |PINTA #158#2;
     |SINO;
          |ERROR;
     |FINSI;
     |CIERRA #42;
|FPRC;

|PROCESO TipoDoc; |TIPO 66;
     |VARIABLES; {20} aPopup = ""; |FINSI;
     aPopup1 = "-1";  || Si fuera -1 en la posicion
     aPopup2 = 5
     aPopup3 = "0.- DNI";
     aPopup4 = "1.- NIE";
     aPopup5 = "2.- Pasaporte";
     aPopup6 = "3.- Billete Identidad";
     aPopup7 = "4.- Otros";
     IaPopup = aPopup1  <-;
     |ESPECIFICA "TRACKPOPUP", aPopup;
     nSal = FSalida;
     |SI nSal [ 0;
          |ERROR;
     |SINO;
          nSal = nSal - 1;
          #158#17 = nSal; |PINTA #158#17;
     |FINSI;
|FPRC;

|PROCESO ConteLin; |TIPO 7;
     aConte = #158Campo;
|FPRC;

|PROCESO PintaCamposLin;
     |ABRE #7;
     #7#0 = #158#7;
     |LEE 000#7=;
     |SI FSalida ! 0; |DDEFECTO #7; |FINSI;
     |CIERRA #7;

     |ABRE #17;
     #17#0 = #157#96;
     #17#2 = #158#7;
     #17#4 = #158#8;
     |LEE 000#17=;
     |SI FSalida ! 0; |DDEFECTO #17; |FINSI;
     |CIERRA #17;

     |PINTA 1020, #7#1;
     |PINTA 1068, #17#5;
|FPRC;

|PROCESO Lineas;
     #157#36 = #157#36 + #15#13;

     #15#11 = #15#9 + #15#10 + #15#13;
     |SI #115#5 = "S";
          #157#32 = #157#32 + (#15#11 - (#15#11 * #115#2 / 100));
     |SINO;
          #157#32 = #157#32 + #15#10 + (#15#9 + #15#13 - ((#15#9 + #15#13) * #115#2 / 100));
     |FINSI;
|FPRC;

|DEFBUCLE Lineas;
     #15#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Lineas;
|FIN;

|PROCESO EvtTari;
     |SI FSalida = 1; |O FSalida = 2;
          |LEE 000#14=;
     |FINSI;
     |SI FSalida = 4;
          |SI nModoLin ! 4;
               aAlfa = #14#0; aAlfa = aAlfa % 102;
               #158#7 = aAlfa; |PINTA #158#7;
               aAlfa = #14#0; aAlfa = aAlfa % 404;
               #158#8 = aAlfa; |PINTA #158#8;
               |HAZ GrupoTari0;
               |HAZ TipoTari0;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO CheqNacimiento; |TIPO 0;
     |SI FSalida ! 2;
          aFecNace = (("00"+#158#19)%-102)+"."+(("00"+#158#20)%-102)+"."+(("0000"+#158#21)%-104);
          fFecha = aFecNace;
          nNume = fFecha; fFecha = nNume;
          aAlfa = fFecha;
          |SI aAlfa ! aFecNace;
               |MENAV "0000Fecha nacimiento incorrecta...";
               |ERROR;
               FSalida = 1;
          |SINO;
              #158#18 = aFecNace;
               FSalida = 0;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO EditaLin;
     |SI #157#6 = 4; |O #157#6 = 5;
          |C_M #158#9, 1, "S";
          |C_M #158#10, 1, "S";
     |SINO;
          |C_M #158#9, 1, "N";
          |C_M #158#10, 1, "N";
          |HAZ CargaTari;
     |FINSI;

     nRegLin0 = #15#0;
     nRegLin1 = #15#1;

     |SI nModoLin = 1; |VENTANA 1601, 3398, -1, 17, "Nuevo Pax Reserva"; |FINSI;
     |SI nModoLin = 2; |VENTANA 1601, 3398, -1, 17, "Modifica Pax Reserva"; |FINSI;
     |SI nModoLin = 4; |VENTANA 1601, 3398, -1, 17, "Consulta Pax Reserva"; |FINSI;
     |HAZ PushVenModal;

     |SI nModoLin = 1;
          |LEE 000#15u;
          |SI FSalida = 0;
               nLin = #15#1 + 1;
          |SINO;
               nLin = 1;
          |FINSI;
          |DDEFECTO #15;
          #15#0 = #157#0;
          #15#1 = nLin;
          |GRABA 020#15b;
          |DDEFECTO #158;
          #158#0 = #157#0;
          #158#1 = nLin;
          |LEE 000#14p;
          |SI FSalida = 0;
               aAlfa = #14#0 % 102;
               #158#7 = aAlfa;
               aAlfa = #14#0 % 404;
               #158#8 = aAlfa;
               #158#9 = #14#5;
               #158#10 = #14#6;
               |HAZ DtoAuto; #158#16 = enDtoAuto

               enTotBillete = #158#9 + #158#10; |HAZ IncDisBillete;
               nImpDtoAuto = #158#9 * #158#16 / 100;
               #158#13 = enIncBillete - nImpDtoAuto;
               #158#11 = #158#9 + #158#10 + #158#13;
          |FINSI;
     |SINO;
          |PARA i = 0; |SI i < aCamLin; |HACIENDO i = i + 1;
               #158i = #15i;
          |SIGUE;
          aAlfa = #158#18 % 102; #158#19 = aAlfa;
          aAlfa = #158#18 % 402; #158#20 = aAlfa;
          aAlfa = #158#18 % 704; #158#21 = aAlfa;
     |FINSI;

     |SI #47#2 = 1;      || Nivel usuario
          |C_M #158#13, 1, "N";
     |SINO;
          |SI #158#16 ! 0;    || Si hay Dto auto
               |C_M #158#13, 1, "N";
          |SINO;
               |C_M #158#13, 1, "S";
          |FINSI;
     |FINSI;

     |LEE 000#14p;
     |SI FSalida = 0;
          |C_M #158#7, 1, "S";
          |C_M #158#8, 1, "S";
          |C_M #158#9, 1, "N";
          |C_M #158#10, 1, "N";
     |SINO;
          |C_M #158#7, 1, "N";
          |C_M #158#8, 1, "N";
          |C_M #158#9, 1, "S";
          |C_M #158#10, 1, "S";
     |FINSI;
     |PINPA #0#158; nPantaLin = FSalida;
     |PINDA #0#158;
     nRango = 4 + 8 + 16 + 32;
     |LINEAL_SIMPLE #1#14, nRango, 1302, 2199, NULL, NULL, EvtTari;
     |HAZ PintaCamposLin;
  |ET OtraLin;
     |SI nModoLin = 1; |ENDATOS #1#158; |FINSI;
     |SI nModoLin = 2; |ENDATOS #2#158; |FINSI;
     |SI nModoLin = 4; |PAUSA; |FINSI;
     |SI FSalida = 0; |Y nModoLin ! 4;
          aAlfa = #158#3; |QBF aAlfa;
          |SI aAlfa = "";
               |MENAV "0000El nombre es obligatorio...";
               |VETE OtraLin;
          |FINSI;
          |HAZ CheqNacimiento;
          |SI FSalida ! 0;
               |VETE OtraLin;
          |FINSI;

          |SI #157#6 = 4; |O #157#6 = 5;
          |SINO;
               aAlfa = (("00" + #158#7) % -102) + "." + (("0000" + #158#8) % -104);
               #14#0 = aAlfa;
               |LEE 000#14=;
               |SI FSalida ! 0;
                    |MENAV "0000No existe tarifa a aplicar...";
                    |VETE OtraLin;
               |FINSI;
          |FINSI;

          #15#0 = #158#0;
          #15#1 = #158#1;
          |LEE 121#15=;
          #15#11 = #15#9 + #15#10 + #15#13

          |ABRE #115;
          #115#0 = #157#33;
          |LEE 000#115=;
          |SI FSalida ! 0; |DDEFECTO #115; |FINSI;
          |CIERRA #115;

          |PARA i = 0; |SI i < aCamLin; |HACIENDO i = i + 1;
               #15i = #158i;
          |SIGUE;
          |GRABA 020#15a;

          #157#36 = 0; #157#32 = 0;
          |BUCLE Lineas;
          |PINTA #157#32;

          nRegLin0 = #15#0;
          nRegLin1 = #15#1;
     |SINO;
          |SI nModoLin = 1;
               #15#0 = #158#0;
               #15#1 = #158#1;
               |BORRA 020#15c;
          |FINSI;
     |FINSI;
     |LIBERA #15;

     |HAZ PopVenModal;

     #15#0 = nRegLin0;
     #15#1 = nRegLin1;
     |LEE 000#15=;
     |REFRESCACONTROL nGridLin;
|FPRC;

|PROCESO BtnAltaLin;
     nModoLin = 1; |HAZ EditaLin;
     |HAZ TieneLineasLin;
|FPRC;

|PROCESO BtnModiLin;
     |LEE 100#15=;
     |SI FSalida ! 0; |ACABA; |FINSI;
     nModoLin = 2; |HAZ EditaLin;
|FPRC;

|PROCESO BtnBajaLin;
     |LEE 100#15=;
     |SI FSalida ! 0; |ACABA; |FINSI;
     aAlfa = "0000N¨Borrar l¡nea reserva: " + #15#1 + "?";
     |CONFI aAlfa;
     |SI FSalida = 0;
          |BORRA 020#15a;
          #157#36 = 0; #157#32 = 0;
          |BUCLE Lineas;
          |PINTA #157#32;
          |HAZ TieneLineasLin;
          |REFRESCACONTROL nGridLin;
     |FINSI;
     |LIBERA #15;
|FPRC;

|PROCESO BtnConsLin;
     |LEE 000#15=;
     |SI FSalida ! 0; |ACABA; |FINSI;
     nModoLin = 4; |HAZ EditaLin;
|FPRC;

|PROCESO TieneLineasLin;
     |DDEF aAlfa;
     aAlfa = aAlfa + "sctrw015";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |NOME_DAT #referen@#aTmp15#;
          |ABRE #referen@;
          |LEE 000#referen@.p;
          nTieneLineasLin = FSalida;
          |SI FSalida = 0;
               |SI enModoCab = 4;
                    |ESTADO_CONTROL nBtnAltaLin, "DISABLE";
                    |ESTADO_CONTROL nBtnModiLin, "DISABLE";
                    |ESTADO_CONTROL nBtnBajaLin, "DISABLE";
                    |ESTADO_CONTROL nBtnConsLin, "ENABLE";
               |SINO;
                    |ESTADO_CONTROL nBtnAltaLin, "ENABLE";
                    |ESTADO_CONTROL nBtnModiLin, "ENABLE";
                    |ESTADO_CONTROL nBtnBajaLin, "ENABLE";
                    |ESTADO_CONTROL nBtnConsLin, "ENABLE";
               |FINSI;
          |SINO;
               |SI enModoCab = 4;
                    |ESTADO_CONTROL nBtnAltaLin, "DISABLE";
                    |ESTADO_CONTROL nBtnModiLin, "DISABLE";
                    |ESTADO_CONTROL nBtnBajaLin, "DISABLE";
                    |ESTADO_CONTROL nBtnConsLin, "DISABLE";
               |SINO;
                    |ESTADO_CONTROL nBtnAltaLin, "ENABLE";
                    |ESTADO_CONTROL nBtnModiLin, "DISABLE";
                    |ESTADO_CONTROL nBtnBajaLin, "DISABLE";
                    |ESTADO_CONTROL nBtnConsLin, "DISABLE";
               |FINSI;
          |FINSI;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|PROCESO Evento13;
     |SI FSalida = 1; |O FSalida = 2;
          |SELECT #1#13;
          |LEE 000#13=;
     |FINSI;
     |SI FSalida = 4; |Y enModoCab ! 4;
/*
          |SI #13#2 = "I";
               nSwVuelta = 0;
          |SINO;
               nSwVuelta = 1;
          |FINSI;
*/
          nError = 1;

          |SI nSwVuelta = 0; |Y #157#20 ! "01.01.0000";
               |ABRE #26;
               #26#0 = #157#96;
               #26#2 = #13#1;
               #26#4 = #157#101;
               #26#5 = #13#3;
               nNume = #157#20 - #13#11 + 1;
               #26#7 = nNume;
               |LEE 000#26=;
               |SI FSalida ! 0;
                    |MENAV "0000No existe viaje para esa fecha...";
               |SINO;
                    |SI #26#24 = "S"; |O #26#24 = "C";
                         |SI #26#24 = "S";
                              |MENAV "0000El servicio para ese dia esta suspendido...";
                         |FINSI;
                         |SI #26#24 = "C";
                              |MENAV "0000El servicio para ese dia esta cerrado...";
                         |FINSI;
                    |SINO;
                         nNume = #26#20 - #26#26;
                         |SI nNume < #157#19;
                              |CONFI "0000SNo hay Pax libres para ese viaje, desea incluirla la reserva en la lista de espera?";
                              |SI FSalida = 0;
                                   #157#52 = "L"; |PINTA #157#52;
                                   nError = 0;
                              |FINSI;
                         |SINO;
                              #157#52 = "P"; |PINTA #157#52;
                              nError = 0;
                         |FINSI;
                    |FINSI;
               |FINSI;
               |CIERRA #26;
          |FINSI;

          |SI nSwVuelta = 1; |Y #157#26 ! "01.01.0000";
               |ABRE #26;
               #26#0 = #157#105;
               #26#2 = #13#1;
               #26#4 = #157#102;
               #26#5 = #13#3;
               nNume = #157#26 - #13#11 + 1;
               #26#7 = nNume;
               |LEE 000#26=;
               |SI FSalida ! 0;
                    |MENAV "0000No existe viaje vuelta para esa fecha...";
               |SINO;
                    |SI #26#24 = "S"; |O #26#24 = "C";
                         |SI #26#24 = "S";
                              |MENAV "0000El servicio para ese dia esta suspendido...";
                         |FINSI;
                         |SI #26#24 = "C";
                              |MENAV "0000El servicio para ese dia esta cerrado...";
                         |FINSI;
                    |SINO;
                         nNume = #26#20 - #26#26;
                         |SI nNume < #157#19;
                              |CONFI "0000SNo hay Pax libres para ese viaje de vuelta, desea incluirla la reserva en la lista de espera?";
                              |SI FSalida = 0;
                                   #157#53 = "L"; |PINTA #157#53;
                                   nError = 0;
                              |FINSI;
                         |SINO;
                              #157#53 = "P"; |PINTA #157#53;
                              nError = 0;
                         |FINSI;
                    |FINSI;
               |FINSI;
               |CIERRA #26;
          |FINSI;
          |SI nError = 0; |HAZ AsignaServi; |FINSI;
     |FINSI;
|FPRC;

|PROCESO Evento15;
     |SI FSalida = 1; |O FSalida = 2;
          |SELECT #1#15;
          |LEE 000#15=;
          |HAZ TieneLineasLin;
     |FINSI;
     |SI FSalida = 4;
          |HAZ BtnConsLin;
     |FINSI;
|FPRC;

|PROCESO Divisa; |TIPO 0;
     |ABRE #324;
     #324#0 = #157#94;
     |LEE 000#324=;
     |SI FSalida = 0;
          #157#95 = #324#1; |PINTA #157#95;
          |SI enModoCab = 1; |O #157Campo ! Contenido;
               |HAZ ValorDivisa;
          |FINSI;
          |SI enModoCab = 2; |Y #157#6 = 2;
               |ABRE #36;
               #36#1 = #157#43;
               |LEE 000#36=;
               |SI FSalida ! 0; |DDEFECTO #36; |FINSI;
               |CIERRA #36;
               |SI #36#46 ! #157#94;
                    aAlfa = "0000La divisa de la agencia [" + #36#46 + "] es distinta a la reserva [" + #157#94 + "].";
                    |MENAV aAlfa;
                    |ERROR;
               |FINSI;
          |FINSI;
          |SI enModoCab = 2; |Y #157#6 = 3;
               |SI #157#60 ! #157#94;
                    aAlfa = "0000La divisa del socio [" + #157#60 + "] es distinta a la reserva [" + #157#94 + "].";
                    |MENAV aAlfa;
                    |ERROR;
               |FINSI;
          |FINSI;
     |SINO;
          |MENAV "0000No existe c¢digo de divisa...";
          |ERROR;
     |FINSI;
     |CIERRA #324;
|FPRC;

|PROCESO Reduccion; |TIPO 0;
     |SI FSalida = 2; |Y enModoCab = 1; |ACABA; |FINSI;

     |SI aConte ! #157#33; |O enModoCab = 1;
          |ABRE #115;
          #115#0 = #157#33;
          |LEE 000#115=;
          |SI FSalida = 0;
               |ABRE #116;
               #116#0 = #157#33;
               #116#1 = "R";
               #116#2 = #157#75;
               |LEE 000#116=;
               |SI FSalida ! 0;
                    aAlfa = "0000La reducci¢n no es aplicable a la l¡nea servicio: " + #157#75;
                    |MENAV aAlfa;
               |SINO;
                    #157#34 = #115#1; |PINTA #157#34;
                    #157#35 = #115#2; |PINTA #157#35;

                    #157#36 = 0; #157#32 = 0;
                    |BUCLE Lineas;
                    |PINTA #157#32;
               |FINSI;
               |CIERRA #116;
          |SINO;
               |MENAV "0000No existe c¢digo de reducci¢n...";
               |ERROR;
          |FINSI;
          |CIERRA #115;
     |FINSI;
|FPRC;

|PROCESO RFreTrayectos;
     |PARA j = 12; |SI j [ 21; |HACIENDO j = j + 1;
          |SI #referen@#j# ! "     "; |Y j = i;
               #13#0 = #31#0;
               #13#1 = #31#1;
               #13#2 = #31#2;
               #13#3 = #30#6;
               #13#4 = #30#7;
               #13#5 = #31i;
               #13#6 = #referen@#j#;
               #13#7 = #referen@#11; || #30#14;
               #13#11 = #31#11;
               |GRABA 000#13n;
               nHay = 1;
          |FINSI;
     |SIGUE;
|FPRC;

|DEFBUCLE RFreTrayectos;
     #referen@#1006;
     9, 6;
     #31#0, #31#1, #31#2, #31#3, #31#4, 000, "D", aPobDes;
     #31#0, #31#1, #31#2, #31#3, #31#4, 999, "D", aPobDes;
     ;
     NULL, RFreTrayectos;
|FIN;

|PROCESO FreTrayectos;
     |PARA i = 12; |SI i [ 21; |HACIENDO i = i + 1;
          |SI #31i ! "     ";
               nLin = i - 11;
               enSwVuelta = nSwVuelta;
               |HAZ LeeEl29;
               |SI FSalida = 0;
                    #30#0 = #31#0;
                    #30#1 = #31#1;
                    #30#2 = #31#2;
                    #30#3 = #31#3;
                    #30#4 = #31#4;
                    #30#5 = nLin;
                    |LEE 000#30=;
                    |SI FSalida = 0;
                         nHay = 0;
                         |BUCLE RFreTrayectos;
                         ||SI nHay ! 0; |SAL; |FINSI;
                    |FINSI;
               |FINSI;
          |FINSI;
     |SIGUE;
|FPRC;

|DEFBUCLE FreTrayectos;
     #31#1;
     9, 6;
     "          ", 000, " " , 000, 00, 000, "O", aPobOrg;
     "zzzzzzzzzz", 999, "z" , 999, 99, 999, "O", aPobOrg;
     ;
     NULL, FreTrayectos;
|FIN;

|PROCESO PeriServi;
     nHay = 0;
     |SI nSwVuelta = 0;  || Org -> Des
          |SI #157#20 = "01.01.0000";
               fFecha = #157#1;
          |SINO;
               fFecha = #157#20;
          |FINSI;
          |SI fFecha ] #24#5; |Y fFecha [ #24#6;
               nHay = 1;
               #13#8 = #24#5;
               #13#9 = #24#6;
               #13#10 = #24#7;
          |FINSI;
     |SINO;    || Des -> Org
          fFecha = #157#26;
          |SI fFecha ] #24#5; |Y fFecha [ #24#6;
               nHay = 1;
               #13#8 = #24#5;
               #13#9 = #24#6;
               #13#10 = #24#7;
          |FINSI;
     |FINSI;

     |SI nHay = 1;
          |SALVA_DATOS #13;
          |REPON_DATOS #referen@;
          nConta = nConta + 1;
          #referen@#12 = nConta;
          |GRABA 020#referen@.n;
     |FINSI;
|FPRC;

|DEFBUCLE PeriServi;
     #24#1;
     8;
     #13#0, #13#1, #13#2, #13#3, 00, "S";
     #13#0, #13#1, #13#2, #13#3, 99, "S";
     ;
     NULL, PeriServi;
|FIN;

|PROCESO TmpTrayectos;
     |BUCLE PeriServi;
|FPRC;

|DEFBUCLE TmpTrayectos;
     #13#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, TmpTrayectos;
|FIN;

|PROCESO CargaTrayectos;
     |CIERRA #13; |DELINDEX #13; |ABRE #13;
     |SI nSwVuelta = 0;
          aPobOrg = #157#8; aPobDes = #157#12;
     |SINO;
          aPobOrg = #157#12; aPobDes = #157#8;
     |FINSI;
     |DDEF aAlfa;
     aAlfa = aAlfa + "sctrm031";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #30;
          |BUCLE FreTrayectos;
          |CIERRA #30;
          |DESCARGA_DEF #referen@;
          |SI nSwBusServi = 0;
               || sctrm024 puede contener mas de 1 registro por cada uno del sctrw013
               || por eso se regraba el sctrw013 con todos los posibles

               |DDEF aAlfa; aAlfa = aAlfa + "sctrw013";
               |CARGA_DEF aAlfa, referen@;
               |SI FSalida = 0;
                    |HAZ CreaTempo; |NOME_DAT #referen@#Tempo#; aTmp13b = Tempo; |DELINDEX #referen@;
                    |ABRE #referen@;

                    nConta = 0;
                    |BUCLE TmpTrayectos;

                    |CIERRA #13; |DELINDEX #13; |ABRE #13;
                    |LEE 000#referen@.p;
                    |PARA; |SI FSalida = 0; |HACIENDO;
                         |SALVA_DATOS #referen@;
                         |REPON_DATOS #13;
                         |GRABA 020#13n;
                         |LEE 000#referen@.s;
                    |SIGUE;

                    |CIERRA #referen@;
                    Tempo = aTmp13b; |HAZ BoraTempo; |DELINDEX #referen@;
                    |DESCARGA_DEF #referen@;
               |FINSI;
          |FINSI;
     |FINSI;

     |LEE 000#13p;
     |REFRESCACONTROL nGridTra;
     |PULSATECLA;
|FPRC;

|PROCESO TraficoDiario;
     #117#0 = #26#0;
     #117#1 = #26#2;
     #117#2 = #26#4;
     #117#3 = #26#5;
     #117#4 = #26#6;
     nNume = #13#11 - 1;
     #117#5 = #26#7 + nNume;
     #117#6 = #26#8;
     #117#7 = #13#5;     ||#26#17;
     #117#8 = #13#6;     ||#26#18;
     #117#9 = #26#19;
     #117#10 = #13#11;
     |GRABA 000#117n;
|FPRC;

|DEFBUCLE TraficoDiario;
     #26#1;
     ;
     #13#0, #13#1, #13#2, #13#3, fDesde;
     #13#0, #13#1, #13#2, #13#3, fHasta;
     ;
     NULL, TraficoDiario;
|FIN;

|PROCESO TmpTrayectos2;
     |BUCLE TraficoDiario;
|FPRC;

|DEFBUCLE TmpTrayectos2;
     #13#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, TmpTrayectos2;
|FIN;

|PROCESO BtnCancela;
     enTeclaOK = 1; |PTEC 807;
|FPRC;

|PROCESO EvtDiasSugeridos;
     |SI FSalida = 1; |O FSalida = 2;
          |LEE 000#117=;
     |FINSI;
     |SI FSalida = 4;
          #13#0 = #117#0;
          #13#1 = #117#1;
          #13#2 = #117#2;
          #13#3 = #117#3;
          #13#4 = #117#4;
          #13#5 = #117#7;
          #13#6 = #117#8;
          #13#7 = #117#9;
          #13#11 = #117#10;
          |HAZ AsignaServi;
          |SI nSwVuelta = 0;
               #157#20 = #117#5;
          |SINO;
               #157#26 = #117#5;
          |FINSI;
          |PTEC 807;
     |FINSI;
|FPRC;

|PROCESO DiasSugeridos;
     |HAZ CreaTempo;
     |NOME_DAT #117 Tempo; |DELINDEX #117; aTmp117 = Tempo; |ABRE #117;

     |SI nSwVuelta = 0;
          fDesde = #157#20;
          fHasta = #157#20 + #100#14;
     |SINO;
          fDesde = #157#26;
          fHasta = #157#26 + #100#14;
     |FINSI;
     |SI nSwSugeridos = 2;
          fDesde = fDesde + 1;
          fHasta = fHasta + 1;
     |FINSI;

     |BUCLE TmpTrayectos2;
     |LEE 000#117p;
     |SI FSalida = 0;
          |VENTANA 1601, 3399, -1, 17, "Dias Sugeridos Viaje";
          |HAZ PushVenModal;
          |CONTROL_SIMPLE 0, "LABEL,{{003}}(Doble click/ENTER selecciona, ESC cancela)", 1602, 1664, NULL;
          |CONTROL_SIMPLE 0, "BOTON,{{207}}Cancelar", 3372, 3382, BtnCancela;
          nRango = 4 + 8 + 16 + 32;
          |LINEAL_SIMPLE #1#117, nRango, 1702, 3198, NULL, NULL, EvtDiasSugeridos;
          enCtrFin = FSalida; eaCtrTxt = "{{206}}Aceptar"; |HAZ EsperaFin;
          |HAZ PopVenModal;
          |SI enTeclaOK = 0;
               #13#0 = #117#0;
               #13#1 = #117#1;
               #13#2 = #117#2;
               #13#3 = #117#3;
               #13#4 = #117#4;
               #13#5 = #117#7;
               #13#6 = #117#8;
               #13#7 = #117#9;
               #13#11 = #117#10;
               |SI nSwVuelta = 0;
                    #157#20 = #117#5;
               |SINO;
                    #157#26 = #117#5;
               |FINSI;
               |HAZ AsignaServi;
          |SINO;
               nError = 1;
          |FINSI;
     |SINO;
          |MENAV "0000No existe trayecto para la salida / llegada...";
          nError = 1;
     |FINSI;
     |PINTA #157#20;
     |PINTA #157#26;
     |CIERRA #117; Tempo = aTmp117; |HAZ BoraTempo; |DELINDEX #117;
|FPRC;

|PROCESO NumPax; |TIPO 0;
     |SI enModoCab = 1; |Y FSalida = 2; |ACABA; |FINSI;

     |SI #157#19 = 0;
          |MENAV "0000El pax no puede ser '0'...";
          |ERROR;
     |FINSI;
|FPRC;

|PROCESO TipoViaje; |TIPO 0;
     |SI #157#17 = 1;
          |C_M #157#26, 1, "N"; |PINTA #157#26;
     |SINO;
          |C_M #157#26, 1, "S"; |PINTA #157#26;
     |FINSI;
     |HAZ PintaCampos;

     |SI aConte = #157Campo; |Y enModoCab = 1;
          |HAZ Recalcula;
     |FINSI;
|FPRC

|PROCESO PobDes; |TIPO 0;
     |SI FSalida = 2;
          |ABRE #3;
          #3#0 = #157#12;
          |LEE 000#3=;
          |SI FSalida ! 0;
               #157#12 = ""; |PINTA #157#12;
          |FINSI;
          |CIERRA #3;
          |ACABA;
     |FINSI;
     nError = 0;
     |ABRE #3;
     #3#0 = #157#12;
     |LEE 000#3=;
     |SI FSalida = 0;
          #157#13 = #3#1; |PINTA #157#13;
          #157#14 = #3#2; |PINTA #157#14;
          #157#15 = #3#4; |PINTA #157#15;
          |SI aConte ! #157#12;
               |HAZ DatosSalida;
               |HAZ DatosVuelta;
          |FINSI;
     |SINO;
          |MENAV "0000No existe c¢digo de poblaci¢n...";
          nError = 1;
     |FINSI;
     |CIERRA #3;
     |SI nError = 0;
          |SI aConte = #157Campo; |Y enModoCab = 1;
               |HAZ Recalcula;
          |FINSI;
     |SINO;
          |ERROR;
     |FINSI;
|FPRC;

|PROCESO AsignaServi;
     |SI nSwVuelta = 0;
          #157#21 = #13#5; |PINTA #157#21;
          #157#22 = #13#3; |PINTA #157#22;

          #157#99 = #13#11;
          #157#101 = #13#2;

          |SI #157#99 = 2;
               #157#23 = #157#20; |PINTA #157#23;
          |SINO;
               nNume = #157#20;
               nNume = nNume + (#13#7 - 1);
               fFecha = nNume;
               #157#23 = fFecha; |PINTA #157#23;
          |FINSI;
          #157#24 = #13#6; |PINTA #157#24;
          #157#75 = #13#1;
          |ABRE #12;
          #12#0 = #157#75;
          |LEE 000#12=;
          |SI FSalida ! 0; |DDEFECTO #12; |FINSI;
          |CIERRA #12;
          #157#76 = #12#1;
          ||horas viaje
          nNume = (#157#23 - #157#20) * 24 * 60;
          |SI nNume = 0;
               aAlfa = #157#24; |HAZ FormaHora;
               nNume = nMinu + (nHora * 60);
               aAlfa = #157#21; |HAZ FormaHora;
               nNume = nNume - (nMinu + (nHora * 60));
          |SINO;
               nNume = nNume - (24 * 60);
               aAlfa = #157#24; |HAZ FormaHora;
               nNume = nNume + nMinu + (nHora * 60);
               aAlfa = #157#21; |HAZ FormaHora;
               nNume = nNume + (24 * 60) - (nMinu + (nHora * 60));
          |FINSI;
          nMinu = nNume $ 60;
          nHora = (nNume - nMinu) / 60;
          aAlfa = (("00" + nHora) % -102) + ":" + (("00" + nMinu) % -102);
          #157#25 = aAlfa; |PINTA #157#25;
     |SINO;
          #157#27 = #13#5; |PINTA #157#27;
          #157#28 = #13#3; |PINTA #157#28;

          #157#100 = #13#11;
          #157#102 = #13#2;

          |SI #157#100 = 2;
               #157#29 = #157#26; |PINTA #157#29;
          |SINO;
               nNume = #157#26;
               nNume = nNume + (#13#7 - 1);
               fFecha = nNume;
               #157#29 = fFecha; |PINTA #157#29;
          |FINSI;
          #157#30 = #13#6; |PINTA #157#30;
          #157#80 = #13#1;
          |ABRE #12;
          #12#0 = #157#80;
          |LEE 000#12=;
          |SI FSalida ! 0; |DDEFECTO #12; |FINSI;
          |CIERRA #12;
          #157#81 = #12#1;
          ||horas viaje
          nNume = (#157#29 - #157#26) * 24 * 60;
          |SI nNume = 0;
               aAlfa = #157#30; |HAZ FormaHora;
               nNume = nMinu + (nHora * 60);
               aAlfa = #157#27; |HAZ FormaHora;
               nNume = nNume - (nMinu + (nHora * 60));
          |SINO;
               nNume = nNume - (24 * 60);
               aAlfa = #157#30; |HAZ FormaHora;
               nNume = nNume + nMinu + (nHora * 60);
               aAlfa = #157#27; |HAZ FormaHora;
               nNume = nNume + (24 * 60) - (nMinu + (nHora * 60));
          |FINSI;
          nMinu = nNume $ 60;
          nHora = (nNume - nMinu) / 60;
          aAlfa = (("00" + nHora) % -102) + ":" + (("00" + nMinu) % -102);
          |SI #157#30 = "     ";
               #157#31 = ""; |PINTA #157#31;
          |SINO;
               #157#31 = aAlfa; |PINTA #157#31;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO CambiaDias;     || Le suma el N§ dias trayecto
     aAlfa = "";
     aLon = aDias % A0;
     |PARA i = 1; |SI i [ aLon; |HACIENDO i = i + 1;
          nPos = i * 100 + 1;
          aDia = aDias % nPos;
          nNume = aDia + #13#11 - 1;
          nNume = nNume - 1;
          nNume = nNume $ 7;
          nNume = nNume + 1;
          aAlfa = aAlfa + nNume;
     |SIGUE;
     aDias = aAlfa;
|FPRC;

|PROCESO BuscaServi;
     |SI nSwVuelta = 0;
          fFecha = #157#20;
     |SINO;
          fFecha = #157#26;
     |FINSI;

     fDesde = #13#8 + (#13#11 - 1);
     fHasta = #13#9 + (#13#11 - 1);
     |SI fFecha ] fDesde; |Y fFecha [ fHasta;
          aDias = #13#10; |QBF aDias;
          |SI aDias = "*";
               nHay = nHay + 1;
          |SINO;
               |HAZ CambiaDias;
               aAlfa = aDias - aDiaSemanaN;
               |SI FSalida > 0;
                    nHay = nHay + 1;
               |FINSI;
          |FINSI;
     |FINSI;
     |SI nHay ] 1;
          |HAZ AsignaServi;
          |ERROR10;
     |FINSI;
|FPRC;

|DEFBUCLE BuscaServi;
     #13#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, BuscaServi;
|FIN;

|PROCESO TariSuple;
     |SI nSwSuple = 1; |Y #18#14 = "S"; |ACABA; |FINSI;
     |SI nSwSuple = 2; |Y #18#14 = "N"; |ACABA; |FINSI;

     |SI #157#17 < #18#15; |O #157#17 > #18#16; |ACABA; |FINSI;


     |SI #157#26 = "01.01.0000";
          |SI #157#101 ! #18#13;
               |ACABA;
          |FINSI;
          |SI #157#20 < #18#11; |O #157#20 > #18#12;
               |ACABA;
          |FINSI;
          nOk = 1;
     |SINO;
          nOk = 0;
          |SI #157#20 ] #18#11; |Y #157#20 [ #18#12; |Y #157#101 = #18#13;
               nOk = 1;
          |FINSI;
          |SI #157#26 ] #18#11; |Y #157#26 [ #18#12; |Y #157#102 = #18#13;
                     |Y #157#17 ! 2;
               nOk = 2;
          |FINSI;
          |SI nOk = 0; |ACABA; |FINSI;
     |FINSI;

     nHay = 0;
     |SI #18#7 = "I"; |O #18#7 = "T";
          aDias = #18#8; |QBF aDias;
          |SI aDias = "*";
               nHay = 1;
               nImpoS = nImpoS + #18#9;
          |SINO;
               |SI nOk = 2; |Y #18#7 = "T";
                    aAlfa = aDias - aDiaV;
                    |SI FSalida > 0; nHay = 2; |FINSI;
               |FINSI;

               |SI nOk = 1;
                    aAlfa = aDias - aDiaS;
                    |SI FSalida > 0; nHay = 1; |FINSI;
               |FINSI;

               |SI nHay = 1; nImpoS = nImpoS + #18#9; |FINSI;
               |SI nHay = 2; nImpoV = nImpoV + #18#9; |FINSI;
          |FINSI;
     |FINSI;

     |SI #18#7 = "V"; |Y #157#17 = 3;   || ida y vuelta Cerrada
          aDias = #18#8; |QBF aDias;
          |SI aDias = "*";
               nHay = 1;
          |SINO;
               aAlfa = aDias - aDiaV;
               |SI FSalida > 0; nHay = 1; |FINSI;
          |FINSI;
          |SI nHay = 1; nImpoV = nImpoV + #18#9; |FINSI;
     |FINSI;

     |SI #18#7 = "O"; |Y #157#17 = 2;   || ida cerrada y vuelta Abierta
          aDias = #18#8; |QBF aDias;
          |SI aDias = "*";
               nHay = 1;
          |SINO;
               aAlfa = aDias - aDiaV;
               |SI FSalida > 0; nHay = 1; |FINSI;
          |FINSI;
          |SI nHay = 1; nImpoV = nImpoV + #18#9; |FINSI;
     |FINSI;

     |SI nSwSuple = 1; |Y nHay ! 0;
          |ERROR10;
     |FINSI;
|FPRC;

|DEFBUCLE TariSuple;
     #18#1;
     ;
     #20#0, #20#1, #20#2, 000;
     #20#0, #20#1, #20#2, 999;
     ;
     NULL, TariSuple;
|FIN;

|PROCESO TipTariFec;
     nNume = #157#20 - #157#99 + 1;
     fFecha = nNume;
     |SI fFecha ] #19#8; |Y fFecha [ #19#9;
          aDias = #19#7; |QBF aDias;
          |SI aDias = "*";
               nHay = 1;
          |SINO;
               aAlfa = aDias - aDiaS;
               |SI FSalida > 0; nHay = 1; |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE TipTariFec;
     #19#1;
     ;
     #20#0, #20#1, #20#2, 000;
     #20#0, #20#1, #20#2, 999;
     ;
     NULL, TipTariFec;
|FIN;

|PROCESO TariTrayectos;
     #17#0 = #20#0;
     #17#2 = #20#1;
     #17#4 = #20#2;
     |LEE 000#17=;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |SI #17#9 = "N"; |ACABA; |FINSI;

     |SI #157#17 = 1; |O #157#17 = 3;
          |SI #17#14 = "A"; |ACABA; |FINSI;
     |SINO;
          |SI #17#14 = "C"; |ACABA; |FINSI;
     |FINSI;

     |SI #17#11 ! 0;
          nNume = #157#20 - #157#1;
          |SI nNume > #17#11; |ACABA; |FINSI;
     |FINSI;

     |SI #157#17 ! 1; |Y #17#7 = "S"; |ACABA; |FINSI;

     nHay = 0;
     |BUCLE TipTariFec;
     |SI nHay = 0; |ACABA; |FINSI;

     #7#0 = #17#2;
     |LEE 000#7=;
     |SI FSalida ! 0; |DDEFECTO #7; |FINSI;

     aAlfa = (("00" + #20#1) % -102) + "." + (("0000" + #20#2) % -104);
     #14#0 = aAlfa;
     #14#1 = #7#1;
     |SI #157#17 = 1;
          #14#2 = #20#7;
     |SINO;
          #14#2 = #20#8;
     |FINSI;
     nImpoS = 0; nImpoV = 0;
     |SI aSwAplicaSuple = "S";
          nSwSuple = 1; |BUCLE TariSuple;
          nSwSuple = 2; |BUCLE TariSuple;
     |FINSI;

     #14#3 = nImpoS;
     #14#4 = nImpoV;
     #14#5 = #14#2;

     |SI #157#20 ] #12#22; |Y #157#20 [ #12#23;
          #14#6 = #12#18;
     |SINO;
          #14#6 = 0;
     |FINSI;
     #14#6 = #14#6 + #14#3 + #14#4;

     #14#7 = #14#5 + #14#6;
     |GRABA 000#14n;
|FPRC;

|DEFBUCLE TariTrayectos;
     #20#1;
     ;
     aTemporada, 00, 0000, 000, #157#94, #157#8, #157#12;
     aTemporada, 99, 9999, 999, #157#94, #157#8, #157#12;
     ;
     NULL, TariTrayectos;
|FIN;

|PROCESO CargaTari;
     nNume = #157#26 - #157#100 + 1;
     fFecha = nNume; |HAZ DiaSemana; aDiaV = aDiaSemanaL;
     nNume = #157#20 - #157#99 + 1;
     fFecha = nNume; |HAZ DiaSemana; aDiaS = aDiaSemanaL;
     |CIERRA #14; |DELINDEX #14; |ABRE #14;

     |ABRE #12;
     #12#0 = #157#75;
     |LEE 000#12=;
     |SI FSalida ! 0; |DDEFECTO #12; |FINSI;
     |CIERRA #12;

     aSwAplicaSuple = "S";
     |ABRE #3;
     #3#0 = #157#8;
     |LEE 020#3=;
     |SI #3#7 = "N";
          aSwAplicaSuple = "N";
     |SINO;
          #3#0 = #157#12;
          |LEE 020#3=;
          |SI #3#7 = "N";
               aSwAplicaSuple = "N";
          |FINSI;
     |FINSI;
     |CIERRA #3;

     nSwTempoFRese = 1;
     |BUCLE BuscaTempo;
     nSwTempoFRese = 0;

     |ABRE #17;
     |ABRE #7;
     |BUCLE TariTrayectos;
     |CIERRA #7;
     |CIERRA #17;
|FPRC;

|PROCESO DatosSalida;
     |SI #157#20 = "01.01.0000";
          |ACABA;
     |FINSI;

     |SI #157#6 = 4; |O #157#6 = 5; |ACABA; |FINSI;

     nSwVuelta = 0; |HAZ CargaTrayectos;
     nHay = 0; aDias = "";

     |BUCLE BuscaServi;
     |HAZ PintaCampos;
     nError = 0;
     |SI nHay = 0;
          nSwSugeridos = 1;
          |MENAV "0000No existe trayecto para la salida / llegada...";
       |ET SugeridosSal;
          |CONFI "0000S¨Desea visualizar los siguientes posibles dias?";
          |SI FSalida = 0;
               nSwBusServi = 1;
               |HAZ CargaTrayectos;
               |HAZ DiasSugeridos;
               nSwBusServi = 0;
               |HAZ CargaTrayectos;
          |SINO;
               nError = 1;
          |FINSI;
     |FINSI;
     |SI nError = 0;
          |ABRE #26;
          #26#0 = #157#96;
          #26#2 = #157#75;
          #26#4 = #157#101;
          #26#5 = #157#22;
          nNume = #157#20 - #157#99 + 1;
          #26#7 = nNume;
          |LEE 000#26=;
          |SI FSalida ! 0;
               |MENAV "0000No existe viaje para esa fecha...";
               |ERROR;
          |SINO;
               |SI #26#24 = "S";
                    |MENAV "0000El servicio para ese dia esta suspendido...";
                    nSwSugeridos = 2;
                    |VETE SugeridosSal;
               |FINSI;
               |SI #26#24 = "C";
                    |MENAV "0000El servicio para ese dia esta cerrado...";
                    nSwSugeridos = 2;
                    |VETE SugeridosSal;
               |FINSI;
               nNume = #26#20 - #26#26;
               |SI nNume < #157#19;
                    |CONFI "0000SNo hay Pax libres para ese viaje, desea incluirla la reserva en la lista de espera?";
                    |SI FSalida = 0;
                         #157#52 = "L"; |PINTA #157#52;
                    |SINO;
                         nError = 1;
                    |FINSI;
               |SINO;
                    #157#52 = "P"; |PINTA #157#52;
               |FINSI;
          |FINSI;
          |CIERRA #26;
     |FINSI;
|FPRC;

|PROCESO DatosVuelta;
     nError = 0;

     |SI #157#6 = 4; |O #157#6 = 5; |ACABA; |FINSI;

     |SI #157#26 ! "01.01.0000";
          nSwVuelta = 1;
          |HAZ CargaTrayectos;
          fFecha = #157#26; |HAZ DiaSemana;
          nHay = 0; aDias = "";
          |BUCLE BuscaServi;
          |HAZ PintaCampos;
          nError = 0;
          |SI nHay = 0;
               |MENAV "0000No existe trayecto para la salida / llegada...";
               nSwSugeridos = 1;
            |ET SugeridosVuelta;
               |CONFI "0000S¨Desea visualizar los siguientes posibles dias?";
               |SI FSalida = 0;
                    nSwBusServi = 1;
                    |HAZ CargaTrayectos;
                    |HAZ DiasSugeridos;
                    nSwBusServi = 0;
                    |HAZ CargaTrayectos;
               |SINO;
                    nError = 1;
               |FINSI;
          |FINSI;
          |SI nError = 0;
               |ABRE #26;
               #26#0 = #157#105;
               #26#2 = #157#80;
               #26#4 = #157#102;
               #26#5 = #157#28;
               nNume = #157#26 - #157#100 + 1;
               #26#7 = nNume;
               |LEE 000#26=;
               |SI FSalida ! 0;
                    |MENAV "0000No existe viaje vuelta para esa fecha...";
                    nError = 1;
               |SINO;
                    |SI #26#24 = "S";
                         |MENAV "0000El servicio para ese dia esta suspendido...";
                         nSwSugeridos = 2;
                         |VETE SugeridosVuelta;
                    |FINSI;
                    |SI #26#24 = "C";
                         |MENAV "0000El servicio para ese dia esta cerrado...";
                         nSwSugeridos = 2;
                         |VETE SugeridosVuelta;
                    |FINSI;
                    nNume = #26#20 - #26#26;
                    |SI nNume < #157#19;
                         |CONFI "0000SNo hay Pax libres para ese viaje de vuelta, desea incluirla la reserva en la lista de espera?";
                         |SI FSalida = 0;
                              #157#53 = "L"; |PINTA #157#53;
                         |SINO;
                              nError = 1;
                         |FINSI;
                    |SINO;
                         #157#53 = "P"; |PINTA #157#53;
                    |FINSI;
               |FINSI;
               |CIERRA #26;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO FecVuelta; |TIPO 0;
||     |SI #157#26 = "01.01.0000";
||          |C_M #157#104, 1, "N"; |PINTA #157#104;
||     |SINO;
||          |C_M #157#104, 1, "S"; |PINTA #157#104;
||     |FINSI;
     |SI FSalida = 2; |Y enModoCab = 1; |ACABA; |FINSI;
     |SI #157#17 = 3; |Y #157#26 = "01.01.0000";
          |MENAV "0000Debe de indicar una fecha de vuelta...";
          |ERROR; |ACABA;
     |FINSI;
     nError = 0;
     |SI #157#26 ! aConte;
          |SI #157#26 = "01.01.0000"; |Y #157#17 = 2;
               #157#27 = ""; |PINTA #157#27;
               #157#28 = ""; |PINTA #157#28;
               #157#29 = ""; |PINTA #157#29;
               #157#30 = ""; |PINTA #157#30;
               #157#80 = 0;
               #157#81 = "";
               #157#31 = ""; |PINTA #157#31;
               #157#100 = 0;
               #157#102 = "";
               nSwVuelta = 1;
               |HAZ PintaCampos;
          |SINO;
               |SI #157#26 < #157#20;
                    |MENAV "0000La fecha vuelta no puede ser inferior a la de salida...";
                    |ERROR; |ACABA;
               |FINSI;
               nSwVuelta = 1;
               |BUCLE BuscaTempo;
               #157#105 = aTemporada;
               |HAZ PintaCampos;
               |HAZ DatosVuelta;
          |FINSI;
     |FINSI;
     |SI nError = 0;
          fHoy = ~;
          |SI #157#6 = 4; |O #157#6 = 5;
          |SINO;
               |SI #157#26 ! "01.01.0000"; |Y #157#26 ] fHoy;
                    enLinea = #157#80;
                    eaSentido = #157#102;
                    nNume = #157#26 - #157#100 + 1;
                    efFechaViaje = nNume;
                    |HAZ CtrlViajerosCheq;
                    |SI eaBloqueado = "S";
                         |MENAV "0000Servicio bloqueado para esta fecha...";
                         |ERROR; |ACABA;
                    |FINSI;
                    |SI enPax < #157#19;
                         aAlfa = "0000Se supera el pax disponible: " + enPax;
                         |MENAV aAlfa;
                         |ERROR; |ACABA;
                    |FINSI;
               |FINSI;
          |FINSI;

          |ABRE #12;
          #12#0 = #157#75;
          |LEE 000#12=;
          |SI FSalida ! 0; |DDEFECTO #12; |FINSI;
          |CIERRA #12;
          aAlfa = #12#17;
          |C_M #157#33, 1, aAlfa; |PINTA #157#33;

          |SI enModoCab = 1;
               |SI #157#17 > 1;
                    |ESTADO_CONTROL nBtnIda, "ENABLE";
                    |ESTADO_CONTROL nBtnVuelta, "DISABLE";
               |FINSI;
               |HAZ TieneLineasLin;
               |SI nTieneLineasLin ! 0;
                    |PARA nPax = 1; |SI nPax [ #157#19; |HACIENDO nPax = nPax + 1;
                         nModoLin = 1; |HAZ EditaLin;
                    |SIGUE;
               |FINSI;
          |FINSI;
     |SINO;
          |ERROR;
     |FINSI;
|FPRC;

|PROCESO FecSalida; |TIPO 0;
     nSwVuelta = 0;
     |SI FSalida = 2; |Y enModoCab = 1; |ACABA; |FINSI;
     |SI #157#20 = "01.01.0000";
          |MENAV "0000Debe de indicar una fecha...";
          |ERROR; |ACABA;
     |FINSI;
     |SI #157#20 < #157#1; |Y aClaveFecInf = "";
          |MENAV "0000Fecha salida inferior a la reserva...";
          eaTitulo = "Clave para reserva";
          |HAZ PideClave;
          |SI eaClave ! #100#16;
               |MENAV "0000Clave incorrecta...";
               |ERROR; |ACABA;
          |SINO;
               aClaveFecInf = eaClave;
          |FINSI;
     |FINSI;
     nError = 0;
     |SI #157#20 ! aConte; |O JUAN = 1;
          nSwVuelta = 0;
          |BUCLE BuscaTempo;
          #157#96 = aTemporada; |PINTA #157#96;
          |HAZ PintaCampos;
          fFecha = #157#20; |HAZ DiaSemana;
          |HAZ DatosSalida;
     |FINSI;

     fHoy = ~;
     |SI nError = 0;
          |SI #157#6 = 4; |O #157#6 = 5;
          |SINO;
               |SI #157#20 ] fHoy;
                    enLinea = #157#75;
                    eaSentido = #157#101;
                    nNume = #157#20 - #157#99 + 1;
                    efFechaViaje = nNume;
                    |HAZ CtrlViajerosCheq;
                    |SI eaBloqueado = "S";
                         |MENAV "0000Servicio bloqueado para esta fecha...";
                         |ERROR; |ACABA;
                    |FINSI;
                    |SI enPax < #157#19;
                         aAlfa = "0000Se supera el pax disponible: " + enPax;
                         |MENAV aAlfa;
                         |ERROR; |ACABA;
                    |FINSI;
               |FINSI;
          |FINSI;

          |SI enModoCab = 1;
               aAlfa  = "|X000"; aAlfa = #157aAlfa; nId = aAlfa;
               |ESTADO_CONTROL nId, "ENABLE";
               |ESTADO_CONTROL nBtnAltaLin, "ENABLE";
               |SI #157#17 > 1;
                    |ESTADO_CONTROL nBtnVuelta, "ENABLE";
               |FINSI;
          |FINSI;
          |SI #157#20 ! aConte;
               |HAZ Recalcula;
          |FINSI;
     |SINO;
          |ERROR;
     |FINSI;
|FPRC;

|PROCESO PobOrg; |TIPO 0;
     |SI FSalida = 2; |ACABA; |FINSI;
     nError = 0;
     |ABRE #3;
     #3#0 = #157#8;
     |LEE 000#3=;
     |SI FSalida = 0;
          #157#9 = #3#1; |PINTA #157#9;
          #157#10 = #3#2; |PINTA #157#10;
          #157#11 = #3#4; |PINTA #157#11;
          |SI aConte ! #157#8; |Y #157#12 ! "    ";
               |HAZ DatosSalida;
          |FINSI;
     |SINO;
          |MENAV "0000No existe c¢digo de poblaci¢n...";
          nError = 1;
     |FINSI;
     |CIERRA #3;
     |SI nError = 0;
          |SI aConte = #157Campo; |Y enModoCab = 1;
               |HAZ Recalcula;
          |FINSI;
     |SINO;
          |ERROR;
     |FINSI;
|FPRC;

|PROCESO Conte; |TIPO 7;
     aConte = #157Campo;
|FPRC;

|PROCESO Valida; |TIPO 7;
     |SI enModoCab = 1;
          aAlfa  = "|X000"; aAlfa = #157aAlfa; nId = aAlfa;
          |ESTADO_CONTROL nId, "DISABLE";
     |FINSI;
|FPRC;

|PROCESO PintaCampos;
     aGuarda = #157#5;
     |C_A #157#5, 0, nAncho;
     |C_A #157#5, 1, 8;

     |SI #157#6 = 1; #157#5 = "Directa"; |FINSI;
     |SI #157#6 = 2; #157#5 = "Indirecta"; |FINSI;
     |SI #157#6 = 3; #157#5 = "Grupo"; |FINSI;
     |SI #157#6 = 4; #157#5 = "Externa Directa"; |FINSI;
     |SI #157#6 = 5; #157#5 = "Enterna Indirecta"; |FINSI;
     |PINTA 770, #157#5;

     |SI #157#17 = 1; #157#18 = "Ida Cerrada"; |FINSI;
     |SI #157#17 = 2; #157#18 = "Ida Cerrada Vuelta Abierta"; |FINSI;
     |SI #157#17 = 3; #157#18 = "Ida y Vuelta Cerrada"; |FINSI;
     |PINTA #157#18;

     |SI #157#20 = "01.01.0000";
          #157#5 = "";
     |SINO;
          fFecha = #157#20 % A1; aAlfa = fFecha % 11; #157#5 = aAlfa;
     |FINSI;
     |PINTA 1345, #157#5;

     |SI #157#23 = "01.01.0000";
          #157#5 = "";
     |SINO;
          fFecha = #157#23 % A1; aAlfa = fFecha % 11; #157#5 = aAlfa;
     |FINSI;
     |PINTA 1386, #157#5;

     |SI #157#26 = "01.01.0000";
          #157#5 = "";
     |SINO;
          fFecha = #157#26 % A1; aAlfa = fFecha % 11; #157#5 = aAlfa;
     |FINSI;
     |PINTA 1486, #157#5;

     |ABRE #23;
     #23#0 = #157#96;
     #23#2 = #157#75;
     #23#4 = "I";
     #23#5 = #157#22;
     |LEE 000#23=;
     |SI FSalida ! 0; |DDEFECTO #23; |FINSI;
     |CIERRA #23;
     |PINTA 1423, #23#6;

     #157#5 = aGuarda;
     |C_A #157#5, 1, nAncho;
|FPRC;

|PROCESO Borra53;
     |BORRA 020#53a;
|FPRC;

|DEFBUCLE Borra53;
     #53#1;
     ;
     #52#0, 001;
     #52#0, 999;
     ;
     NULL, Borra53;
|FIN;

|PROCESO CuentaLineas;
     nLin = nLin + 1;
|FPRC;

|DEFBUCLE CuentaLineas;
     #15#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, CuentaLineas;
|FIN;

|PROCESO NumViajeDia;
     |DDEF aAlfa;
     aAlfa = aAlfa + "sctrm052";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          |SELECT #5#referen@;
          #referen@#1 = #52#1;
          #referen@#7 = 9999;
          #referen@#0 = 0;
          |LEE 000#referen@.];
          |SI FSalida = 0;
               |LEE 000#referen@.a;
          |SINO;
               |LEE 000#referen@.u;
          |FINSI;
          |SI FSalida = 0; |Y #referen@#1 = #52#1
               nLin = #referen@#7 + 1;
          |SINO;
               nLin = 1;
          |FINSI;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|PROCESO CheqTariLin;
     |LEE 000#14p;
     |SI FSalida = 0;
          aAlfa = (("00" + #15#7) % -102) + "." + (("0000" + #15#8) % -104);
          #14#0 = aAlfa;
          |LEE 000#14=;
          |SI FSalida ! 0;
               aAlfa = "0000No existe tarifa a aplicar al N§ Pax: " + #15#1;
               |MENAV aAlfa;
               nError = 1;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE CheqTariLin;
     #15#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, CheqTariLin;
|FIN;

|PROCESO Tmp2Lin;
     |SI nSwTmp2Lin = 1;
          #52#36 = #52#36 + #15#13;

          #115#0 = #52#33;
          |LEE 000#115=;
          |SI FSalida ! 0; |DDEFECTO #115; |FINSI;

          |SI #115#5 = "S";
               #52#32 = #52#32 + (#15#11 - (#15#11 * #115#2 / 100));
          |SINO;
               #52#32 = #52#32 + #15#10 + (#15#9 + #15#13 - ((#15#9 + #15#13) * #115#2 / 100));
          |FINSI;
     |SINO;
          |PARA i = 0; |SI i < aCamLin; |HACIENDO i = i + 1;
               #53i = #15i;
          |SIGUE;
          #53#1 = 1;

          aAlfa = (("00" + #53#7) % -102) + "." + (("0000" + #53#8) % -104);
          #14#0 = aAlfa;
          |LEE 000#14=;
          |SI FSalida = 0; |Y enModoCab = 1;
               #53#9 = #14#5;
               #12#0 = #52#75;
               |LEE 000#12=;
               |SI FSalida ! 0; |DDEFECTO #12; |FINSI;
               |SI #52#20 > #12#22; |Y #52#20 [ #12#23;
                    #53#10 = #14#6;
               |FINSI;
               #53#14 = #14#3;
               #53#15 = #14#4;
          |FINSI;
          #53#11 = #53#9 + #53#10 + #53#13;
          #53#0 = #52#0;
          |GRABA 020#53n;

          #52#36 = #52#36 + #53#13;

          #115#0 = #52#33;
          |LEE 000#115=;
          |SI FSalida ! 0; |DDEFECTO #115; |FINSI;

          |SI #115#5 = "S";
               #52#32 = #52#32 + (#53#11 - (#53#11 * #115#2 / 100));
          |SINO;
               #52#32 = #52#32 + #53#10 + (#53#9 + #53#13 - ((#53#9 + #53#13) * #115#2 / 100));
          |FINSI;
          nImpBillete = #53#9;
          nImpTasa = #53#10;
          nImpSupleI = #53#14;
          nImpSupleV = #53#15;

          aAlfa = #53#2; |QBF aAlfa;
          |SI aAlfa ! "";
               |DDEFECTO #42;
               #42#5 = #53#17;
               #42#0 = #53#2;
               |LEE 101#42=;
               |SI FSalida ! 0; |GRABA 020#42b; |FINSI;
               #42#1 = #53#3;
               #42#2 = #53#4;
               #42#3 = #53#5;
               #42#4 = #53#18;
               |GRABA 020#42a;
               |LIBERA #42;
          |FINSI;

          |ERROR10;
          |BORRA 020#15a;
     |FINSI;
|FPRC;

|DEFBUCLE Tmp2Lin;
     #15#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Tmp2Lin;
|FIN;

|PROCESO Lin2Tmp;
     |PARA i = 0; |SI i < aCamLin; |HACIENDO i = i + 1;
          #15i = #53i;
     |SIGUE;
     |GRABA 020#15n;
|FPRC;

|DEFBUCLE Lin2Tmp;
     #53#1;
     ;
     #52#0, 00;
     #52#0, 99;
     ;
     NULL, Lin2Tmp;
|FIN;

|PROCESO RecalLin;
     |LEE 000#14p;
     |SI FSalida = 0;
          || busca una tarifa con grupo igual y actualiza el tipo
          nHay = 0;
          |PARA; |SI FSalida = 0; |HACIENDO;
               aAlfa = #14#0 % 102;
               |SI aAlfa = #15#7;       ||grupo
                    nHay = 1; |SAL;
               |FINSI;
               |LEE 000#14s;
          |SIGUE;
          |SI nHay = 0;
               #15#9 = 0;
               #15#10 = 0;
               #15#14 = 0;
               #15#15 = 0;
               aAlfa = "0000No existe tarifa a aplicar al N§ Pax: " + #15#1;
               |MENAV aAlfa;
          |SINO;
               aAlfa = #14#0 % 404;
               #15#8 = aAlfa;      ||tipo tarifa
               #15#9 = #14#5;
               #15#10 = #14#6;
               #15#14 = #14#3;
               #15#15 = #14#4;
          |FINSI;
     |SINO;
          #15#7 = 0;
          #15#8 = 0;
     |FINSI;

     enTotBillete = #15#9 + #15#10; |HAZ IncDisBillete;
     nImpDtoAuto = #15#9 * #15#16 / 100;
     #15#13 = enIncBillete - nImpDtoAuto;
     #15#11 = #15#9 + #15#10 + #15#13;
     |GRABA 020#15a;

     #157#36 = #157#36 + #15#13;

     #115#0 = #157#33;
     |LEE 000#115=;
     |SI FSalida ! 0; |DDEFECTO #115; |FINSI;

     |SI #115#5 = "S";
          #157#32 = #157#32 + (#15#11 - (#15#11 * #115#2 / 100));
     |SINO;
          #157#32 = #157#32 + #15#10 + (#15#9 + #15#13 - ((#15#9 + #15#13) * #115#2 / 100));
     |FINSI;
|FPRC;

|DEFBUCLE RecalLin;
     #15#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, RecalLin;
|FIN;

|PROCESO Recalcula;
     |LEE 000#15p;
     |SI FSalida = 0;
          |HAZ CargaTari;
          #157#36 = 0; #157#32 = 0;
          |ABRE #115;
          |BUCLE RecalLin;
          |CIERRA #115;
          |PINTA #157#36;
          |PINTA #157#32;
     |FINSI;
|FPRC;

|PROCESO UltRese;
     |SELECT #1#52;
     |SALVA_DATOS #52;
     |LEE 000#52u;
     |SI FSalida = 0;
          nLin = #52#0 + 1;
     |SINO;
          nLin = 1;
     |FINSI;
     |DDEFECTO #52;
     #157#0 = nLin;
     |REPON_DATOS #52;
|FPRC;

|PROCESO BtnIda;
     |ESTADO_CONTROL nBtnVuelta, "ENABLE";
     |ESTADO_CONTROL nBtnIda, "DISABLE";
     nSwVuelta = 0; |HAZ CargaTrayectos;
|FPRC;

|PROCESO BtnVuelta;
     |ESTADO_CONTROL nBtnVuelta, "DISABLE";
     |ESTADO_CONTROL nBtnIda, "ENABLE";
     nSwVuelta = 1; |HAZ CargaTrayectos;
|FPRC;

|PROCESO BtnCobro;
     |SI #52#6 = 1;
          |VENTANA 2301, 3398, -1, 17, "Cobro Reserva Directa";
          |HAZ PushVenModal;
          |PARA i = 0; |SI i < eaCamCab; |HACIENDO i = i + 1;
               #159i = #52i;
          |SIGUE;
          |C_P #159#39, 0, nPos; |C_P #159#118, 1, nPos;
          |C_P #159#40, 0, nPos; |C_P #159#119, 1, nPos;
          |C_P #159#41, 0, nPos; |C_P #159#120, 1, nPos;
          |PINPA #0#159; nPanReseDir = FSalida;
          |PINDA #0#159;
          |HAZ FCobro159;
          |HAZ FPagoRese159;
          |PAUSA;
          |HAZ PopVenModal;
     |FINSI;
     |SI #52#6 = 2;
          |VENTANA 2201, 3398, -1, 17, "Cobro Reserva Indirecta";
          |HAZ PushVenModal;
          |PARA i = 0; |SI i < eaCamCab; |HACIENDO i = i + 1;
               #160i = #52i;
          |SIGUE;
          |PINPA #0#160;
          |PINDA #0#160;
          |PAUSA;
          |HAZ PopVenModal;
     |FINSI;
     |SI #52#6 = 3;
          |VENTANA 2201, 3398, -1, 17, "Cobro Reserva Grupo";
          |HAZ PushVenModal;
          |PARA i = 0; |SI i < eaCamCab; |HACIENDO i = i + 1;
               #168i = #52i;
          |SIGUE;
          |PINPA #0#168;
          |PINDA #0#168;
          nSw = 1; |HAZ DivisaSocio; nSw = 0;
          |PAUSA;
          |HAZ PopVenModal;
     |FINSI;
|FPRC;

|PROCESO ResePdtCobro;
     |SI enModoCab = 1;
          #52#38 = "R";
          #52#113 = "M";
          #52#114 = 0;
          #52#115 = #52#32;
     |FINSI;
|FPRC;

|PROCESO OfiCobroInd;
     |SI #52#38 ! "R";
          |SI #52#6 = 2; |Y #52#126 = "S";
               |SI #52#127 = 0;
                    #52#127 = #52#4;
               |FINSI;
          |SINO;
               #52#127 = 0;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO CreaReservas;
     InReseImpre = nReseImpre1<-;
     nPaxOrg = #52#19;
     nImpOrg = #52#32;
     nImpEntrega = #52#114;
     |ABRE #12;
     |ABRE #42;
     |ABRE #115;
     |PARA nContaRese = 1; |SI nContaRese [ nPaxOrg; |HACIENDO nContaRese = nContaRese + 1;
          |HAZ UltRese;
          #52#0 = #157#0;
          #52#19 = 1;
          #52#106 = nPaxOrg;
          #52#107 = nImpOrg;
          |GRABA 020#52b;

          |SI nNumPrimeRese = 0;
               nNumPrimeRese = #52#0;
          |FINSI;

          #52#36 = 0; #52#32 = 0;
          nSwTmp2Lin = 2; |BUCLE Tmp2Lin;
          #52#108 = nImpTasa;
          #52#109 = nImpBillete;
          #52#110 = nImpSupleI;
          #52#111 = nImpSupleV;
          |SI nContaRese > 1;
               |SI #52#6 = 2; |HAZ CobroReseInd; |FINSI;
               |SI #52#6 = 3; |HAZ CobroReseGru; |FINSI;
               |SI #52#126 = "S"; |HAZ ResePdtCobro; |FINSI;
               |HAZ OfiCobroInd;
          |SINO;
               |SI #52#126 = "S"; |HAZ ResePdtCobro; |FINSI;
          |FINSI;
          |SI #52#6 = 1; |Y #52#38 = "R";
               |SI nImpEntrega > #52#32;
                    #52#114 = #52#32;
                    #52#117 = ~;
                    nImpEntrega = nImpEntrega - #52#32;
               |SINO;
                    #52#114 = nImpEntrega;
                    #52#117 = "01.01.0000";
                    nImpEntrega = 0;
               |FINSI;
               #52#115 = #52#32 - #52#114;
          |FINSI;

          enPax = 1;
          enLinea = #52#75;
          eaSentido = #52#101;
          nNume = #52#20 - #52#99 + 1;
          efFechaViaje = nNume;
          |HAZ CtrlViajerosAct;
          |SI #52#17 ] 2; |Y #52#26 ! "01.01.0000";
               enPax = 1;
               enLinea = #52#80;
               eaSentido = #52#102;
               nNume = #52#26 - #52#100 + 1;
               efFechaViaje = nNume;
               |HAZ CtrlViajerosAct;
          |FINSI;

          |GRABA 020#52a;
          |LIBERA #52;
          nReseImpre = #52#0;
          InReseImpre = InReseImpre + 1;
     |SIGUE;
     |CIERRA #115;
     |CIERRA #42;
     |CIERRA #12;
     |HAZ Imprime;
|FPRC;

|PROCESO EnHojaRuta;
     aMensa = "N";
     |SI #52#128 = "N";
          |CONFI "0000NNo viaja en la Ida, ¨habilitamos para cambiar la fecha?";
          |SI FSalida = 0;
               #157#128 = "S";
               aMensa = "S";
          |FINSI;
     |FINSI;
     |SI #52#129 = "N"
          |CONFI "0000NNo viaja en la Vuelta, ¨habilitamos para cambiar la fecha?";
          |SI FSalida = 0;
               #157#129 = "S";
               aMensa = "S";
          |FINSI;
     |FINSI;

     |C_M #157#8, 1, "S";
     |C_M #157#12, 1, "S";
     |C_M #157#17, 1, "S";
     |C_M #157#19, 1, "S";
     |C_M #157#20, 1, "S";
     |C_M #157#26, 1, "S";

     |SI #157#74 ! 0; |O #157#79 ! 0;
          |SI aMensa = "N";
               |MENAV "0000Reserva incluida en hoja de ruta...";
          |FINSI;
          |SI #157#74 ! 0;
               |C_M #157#8, 1, "N";
               |C_M #157#12, 1, "N";
               |C_M #157#17, 1, "N";
               |C_M #157#19, 1, "N";
               |SI aMensa = "N";
                    |C_M #157#20, 1, "N";
               |FINSI;
          |FINSI;
          |SI #157#79 ! 0;
               |SI aMensa = "N";
                    |C_M #157#26, 1, "N";
               |FINSI;
          |FINSI;
          |SI #157#17 = 2; |O #157#17 = 3;
               |SI #157#79 = 0;
                    |C_M #157#17, 1, "S";
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Edita;
     |CIERRA #15; |DELINDEX #15; |ABRE #15;
     |CIERRA #13; |DELINDEX #13; |ABRE #13;
     |REFRESCACONTROL nGridTra;

     |SELECT #1#52;
     nSwVuelta = 0;
     nReg0 = #52#0;

     |SI enModoCab = 1; |VENTANA 0501, 3398, -1, 17, "Nueva Reserva"; |FINSI;
     |SI enModoCab = 2; |VENTANA 0501, 3398, -1, 17, "Modifica Reserva"; |FINSI;
     |SI enModoCab = 4; |VENTANA 0501, 3398, -1, 17, "Consulta Reserva"; |FINSI;
     |HAZ PushVenModal;

     |HAZ Oficina;
     |SI enModoCab = 1;
          |HORA aAlfa;
          |DDEFECTO #157;
          #157#0 = 0;
          #157#1 = ~;
          #157#2 = aAlfa;
          #157#3 = #47#0;
          #157#4 = #46#0;
          #157#5 = #46#1;
          #157#58 = #157#1 + #100#15;
          #157#94 = #46#18;
          |SI #46#21 = "S";
               #157#43 = #46#20;
               |ABRE #36;
               #36#1 = #157#43;
               |LEE 000#36=;
               |SI FSalida ! 0; |DDEFECTO #36; |FINSI;
               |CIERRA #36;
               #157#44 = #36#2;
          |FINSI;
          |ABRE #324;
          #324#0 = #157#94;
          |LEE 000#324=;
          |CIERRA #324;
          #157#95 = #324#1;
     |SINO;
          |PARA i = 0; |SI i < eaCamCab; |HACIENDO i = i + 1;
               #157i = #52i;
          |SIGUE;
          |BUCLE Lin2Tmp;
          |LEE 000#15p;
     |FINSI;

     |SI enModoCab = 2;
          |HAZ EnHojaRuta;
          nTipo_Viaje = #157#17;
          fFecha_Vuelta = #157#26;
     |FINSI;

     |SI #100#28 = #46#15;
          |C_M #157#6, 1, "N";
          |SI enModoCab = 1; #157#6 = 2; |FINSI;
     |FINSI;

     |PINPA #0#157; nPantaCab = FSalida;
     |PINDA #0#157;
     |HAZ PintaCampos;

     |CONTROL_SIMPLE nPantaCab, "BOTON,{{193}}Alta", 1518, 1528, BtnAltaLin;
     nBtnAltaLin = FSalida;
     |CONTROL_SIMPLE nPantaCab, "BOTON,{{197}}Modificar", 1530, 1540, BtnModiLin;
     nBtnModiLin = FSalida;
     |CONTROL_SIMPLE nPantaCab, "BOTON,{{199}}Baja", 1542, 1552, BtnBajaLin;
     nBtnBajaLin = FSalida;
     |CONTROL_SIMPLE nPantaCab, "BOTON,{{155}}Consulta", 1554, 1564, BtnConsLin;
     nBtnConsLin = FSalida;
     |CONTROL_SIMPLE nPantaCab, "BOTON,{{155}}Cobro", 2269, 2279, BtnCobro;
     nBtnCobro = FSalida;
     |CONTROL_SIMPLE nPantaCab, "BOTON,{{155}}Cobro Reserva", 2281, 2298, BtnCobroRese;
     nBtnCobroRese = FSalida;
     |SI enModoCab = 4;
          |ESTADO_CONTROL nBtnCobro, "ENABLE";
     |SINO;
          |ESTADO_CONTROL nBtnCobro, "DISABLE";
     |FINSI;

     |CONTROL_SIMPLE nPantaCab, "BOTON,{{230}}Ida", 2344, 2354, BtnIda;
     nBtnIda = FSalida;
     |CONTROL_SIMPLE nPantaCab, "BOTON,{{229}}Vuelta", 2356, 2366, BtnVuelta;
     nBtnVuelta = FSalida;

     |CONTROL_SIMPLE nPantaCab, "BOTON,{{137}}Recalcular Precio", 2381, 2398, BtnRecalRese;
     nBtnRecalRese = FSalida;
     |SI enModoCab = 2;
          |ESTADO_CONTROL nBtnRecalRese, "ENABLE";
     |SINO;
          |ESTADO_CONTROL nBtnRecalRese, "DISABLE";
     |FINSI;

     |HAZ TieneLineasLin;
     |SI enModoCab = 1;
          |ESTADO_CONTROL nBtnCobroRese, "DISABLE";
          |ESTADO_CONTROL nBtnAltaLin, "DISABLE";
          |ESTADO_CONTROL nBtnIda, "DISABLE";
          |ESTADO_CONTROL nBtnVuelta, "DISABLE";
     |SINO;
          nSwVuelta = 0; |HAZ CargaTrayectos;
          |SI #157#17 = 1;
               |ESTADO_CONTROL nBtnIda, "DISABLE";
               |ESTADO_CONTROL nBtnVuelta, "DISABLE";
          |SINO;
               |ESTADO_CONTROL nBtnIda, "DISABLE";
               |ESTADO_CONTROL nBtnVuelta, "ENABLE";
          |FINSI;
          |SI #157#38 ! "R";
               |ESTADO_CONTROL nBtnCobroRese, "DISABLE";
          |FINSI;
     |FINSI;

     nRango = 4 + 8 + 16 + 32;
     |LINEAL_SIMPLE #1#15, nRango, 1602, 2266, NULL, NULL, Evento15;
     nGridLin = FSalida;
     |LINEAL_SIMPLE #1#13, nRango, 2402, 3298, NULL, NULL, Evento13;
     nGridTra = FSalida;

     nBloquea = 0;
     aClaveFecInf = "";
     fFechaSalida = #157#20;
     fFechaVuelta = #157#26;
 |ET Otra;
     |SI enModoCab = 1; |ENDATOS #1#157; |FINSI;
     |SI enModoCab = 2; |ENDATOS #2#157; |FINSI;
     |SI enModoCab = 4; |PAUSA; |FINSI;
     |SI FSalida = 0; |Y enModoCab ! 4;
          |SI #157#19 = 0; FSalida = "1"; |FINSI;
          |SI FSalida = 0;
               |ABRE #46;
               #46#0 = #157#4;
               |LEE 000#46=;
               |CIERRA #46;

               |SI #157#94 ! #46#18;
                    |MENAV "0000La reserva no se graba, ya que la moneda no es la de la oficina...";
                    FSalida = "1";
               |FINSI;
          |FINSI;
     |FINSI;
     |SI FSalida = 0; |Y enModoCab ! 4;
          nLin = 0;
          |BUCLE CuentaLineas;
          |SI nLin ! #157#19;
               aAlfa = "0000Las lineas: " + nLin + " no se corresponden con el pax: " + #157#19;
               |MENAV aAlfa;
               |SI enModoCab = 1;
                    aAlfa  = "|X000"; aAlfa = #157aAlfa; nId = aAlfa;
                    |ESTADO_CONTROL nId, "ENABLE";
               |FINSI;
               |VETE Otra;
          |FINSI;

          |SI #157#6 = 4; |O #157#6 = 5;
          |SINO;
               |HAZ CargaTari;
               nError = 0;
               |BUCLE CheqTariLin;
               |SI nError ! 0; |VETE Otra; |FINSI;
          |FINSI;

          |SI enModoCab = 2;
               #52#0 = #157#0;
               |LEE 121#52=;
               nForma = -1; |HAZ Actualiza;

               enPax = -1;
               enLinea = #52#75;
               eaSentido = #52#101;
               nNume = #52#20 - #52#99 + 1;
               efFechaViaje = nNume;
               |HAZ CtrlViajerosAct;
               |SI #52#17 ] 2; |Y #52#26 ! "01.01.0000";
                    enPax = -1;
                    enLinea = #52#80;
                    eaSentido = #52#102;
                    nNume = #52#26 - #52#100 + 1;
                    efFechaViaje = nNume;
                    |HAZ CtrlViajerosAct;
               |FINSI;

||Cuando tenemos un billete open al modificar la fecha de vuelta, si esta estaba en una fecha con la
||hoja de ruta confeccionada debe eliminar los datos del autobús, intercambiador y antena, para
||poder incluirla en una nueva hoja de ruta
               |SI nTipo_Viaje = 2; |Y #157#17 = 2;
                    |SI fFecha_Vuelta ! #157#26;
                         #157#78 = "01.01.0000";
                         #157#79 = 0;
                         #157#82 = 0;
                         #157#104 = 0;
                         #157#123 = 0;
                         #157#125 = 0;
                         #157#138 = 0;
                         #157#140 = 0;
                    |FINSI;
               |FINSI;
          |FINSI;
||---
          |PARA i = 0; |SI i < eaCamCab; |HACIENDO i = i + 1;
               #52i = #157i;
          |SIGUE;
          |SI enModoCab = 1;
               |HAZ NumViajeDia;
               #52#7 = nLin;
               aAlfa = (#52#1 % 704) + (#52#1 % 402) + (#52#1 % 102) + (("0000" + #52#7) % -104);
               #52#42 = aAlfa;
          |SINO;
               |SI fFechaSalida ! #157#20; |O fFechaVuelta ! #157#26;
                    |HORA aHora;
                    aAlfa = Usuario % 810;
                    #52#131 = fFechaSalida;
                    #52#132 = fFechaVuelta;
                    #52#133 = ~;
                    #52#134 = aAlfa;
                    #52#135 = aHora;
               |FINSI;
          |FINSI;
          nContaRese = 1;
          nError = 0;
          ||SI #52#117 = "01.01.0000";
               |SI #52#6 = 1; |O #52#6 = 4; |HAZ CobroReseDir; |FINSI;
               |SI #52#6 = 2; |O #52#6 = 5; |HAZ CobroReseInd; |FINSI;
               |SI #52#6 = 3; |HAZ CobroReseGru; |FINSI;
               |HAZ OfiCobroInd;
               |SI nError = 0;
                    |SI #52#126 = "S"; |HAZ ResePdtCobro; |FINSI;
               |FINSI;
               |SI nError ! 0; |Y enModoCab = 1;
                    |MENAV "0000Se anula la reserva...";
               |FINSI;
               |SI nError ! 0; |Y enModoCab = 2;
                    #52#0 = #157#0;
                    |LEE 121#52=;
                    |MENAV "0000Se anulan los datos modificados de la 1¦ pantalla...";
                    nError = 0;
               |FINSI;
          ||FINSI;
          |SI nError = 0;
               |HAZ Comision;
               nForma = 1; |HAZ Actualiza;
               |BUCLE Borra53;
               |ABRE #115;
               |ABRE #42;
               |ABRE #12;
               #52#36 = 0; #52#32 = 0;
               nSwTmp2Lin = 1; |BUCLE Tmp2Lin;
               |SI enModoCab = 1;
                    |SI #52#38 ! "R";
                         aAlfa = Usuario % 810;
                         #52#160 = aAlfa;
                    |FINSI;
                    nNumPrimeRese = 0;
                    |HAZ CreaReservas;
                    |HAZ ActualizaBono;
                    nNumPrimeRese = 0;
               |SINO;
                    #52#36 = 0; #52#32 = 0;
                    nSwTmp2Lin = 2; |BUCLE Tmp2Lin;
                    #52#108 = nImpTasa;
                    #52#109 = nImpBillete;
                    #52#110 = nImpSupleI;
                    #52#111 = nImpSupleV;
                    |SI #52#6 = 1; |Y #52#38 = "R";
                         #52#115 = #52#32 - #52#114;
                    |FINSI;
                    |SI #52#115 = 0;    || esta liquidada
                         aAlfa = #52#160; |QBF aAlfa;
                         |SI aAlfa = "";
                              aAlfa = Usuario % 810;
                              #52#160 = aAlfa;
                         |FINSI;
                    |FINSI;
                    |GRABA 020#52a;

                    enPax = 1;
                    enLinea = #52#75;
                    eaSentido = #52#101;
                    nNume = #52#20 - #52#99 + 1;
                    efFechaViaje = nNume;
                    |HAZ CtrlViajerosAct;
                    |SI #52#17 ] 2; |Y #52#26 ! "01.01.0000";
                         enPax = 1;
                         enLinea = #52#80;
                         eaSentido = #52#102;
                         nNume = #52#26 - #52#100 + 1;
                         efFechaViaje = nNume;
                         |HAZ CtrlViajerosAct;
                    |FINSI;
               |FINSI;
               |CIERRA #12;
               |CIERRA #42;
               |CIERRA #115;
          |FINSI;

          |SI enModoCab = 2;
               |CONFI "0000S¨Imprimir billete?";
               |SI FSalida = 0; |HAZ Imprime; |FINSI;
          |FINSI;

          nReg0 = #52#0;
     |SINO;
          nSwFin = 1;
     |FINSI;
     |LIBERA #52;

     |HAZ PopVenModal;

     |SELECT #8#52;
     #52#0 = nReg0;
     |LEE 000#52=;
     |REFRESCACONTROL nGridCab;
|FPRC;

|PROCESO BtnAlta;
     |PARA nSwFin = 0; |SI nSwFin = 0; |HACIENDO;
          enModoCab = 1; |HAZ Edita;
          |HAZ TieneLineas;
     |SIGUE;
|FPRC;

|PROCESO BtnModi;
     |LEE 100#52=;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |SI #52#63 ! " ";
          |MENAV "0000La reserva esta anulada...";
          enModoCab = 4; |HAZ Edita;
     |SINO;
          |SI #52#83 = "S";
/*
 Comentado hasta nuevo estudio

               |MENAV "0000La reserva esta facturada, no se puede modificar...";
               |ACABA;
*/

/*
               |HAZ Oficina;
               |SI #47#2 ! 0;
                    |MENAV "0000La reserva esta facturada, no se puede modificar...";
                    |ACABA;
               |FINSI;
               eaTitulo = "Clave para modificar reserva facturada";
               |HAZ PideClave;
               |SI eaClave ! #100#16;
                    |MENAV "0000Clave incorrecta...";
                    |ACABA;
               |FINSI;
*/
          |FINSI;

          enModoCab = 2; |HAZ Edita;
     |FINSI;
|FPRC;

|PROCESO BtnBaja;
     |HAZ Oficina;
     |SI #100#27 ! #47#2;
          |MENAV "0000Usuario no permitido...";
          |ACABA;
     |FINSI;

     nSwBorra = 1;
     |LEE 100#52=;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |SI #52#83 ! "N";
          |MENAV "0000La reserva esta facturada, no se puede anular...";
     |SINO;
          aAlfa = "0000N¨Borrar reserva: " + #52#0 + "?";
          |CONFI aAlfa;
          |SI FSalida = 0;
               nForma = -1; |HAZ Actualiza;
               |BORRA 020#52a;
               nSwBorra = FSalida;
               |BUCLE Borra53;

               enPax = -1;
               enLinea = #52#75;
               eaSentido = #52#101;
               nNume = #52#20 - #52#99 + 1;
               efFechaViaje = nNume;
               |HAZ CtrlViajerosAct;
               |SI #52#17 ] 2; |Y #52#26 ! "01.01.0000";
                    enPax = -1;
                    enLinea = #52#80;
                    eaSentido = #52#102;
                    nNume = #52#26 - #52#100 + 1;
                    efFechaViaje = nNume;
                    |HAZ CtrlViajerosAct;
               |FINSI;

               |HAZ TieneLineas;
               |REFRESCACONTROL nGridCab;
          |FINSI;
     |FINSI;
     |LIBERA #52;
|FPRC;

|PROCESO BtnCons;
     |LEE 000#52=;
     |SI FSalida ! 0; |ACABA; |FINSI;
     enModoCab = 4; |HAZ Edita;
|FPRC;

|PROCESO ReseLin;
     nHay = 1;
     |PRINT;
|FPRC;

|DEFBUCLE ReseLin;
     #53#1;
     ;
     #52#0, 001;
     #52#0, 999;
     ;
     NULL, ReseLin;
|FIN;

|PROCESO Imprime;
     aInforme = #47#4; |QBF aInforme;
     Impresora = "CrystalReport";
     |IMPRE -1;
     |SI FSalida = 0;
          |INFOR aInforme;
          |SI FSalida = 0;
               |SI enModoCab = 1;
                    InReseImpre = nReseImpre1<-;
                    |PARA nContaRese = 1; |SI nContaRese [ nPaxOrg; |HACIENDO nContaRese = nContaRese + 1;
                         #52#0 = nReseImpre;
                         |LEE 020#52=;
                         |BUCLE ReseLin;
                         |SI nHay = 0; |PRINT; |FINSI;
                         InReseImpre = InReseImpre + 1;
                    |SIGUE;
                    |PIEINF;
               |SINO;
                    |BUCLE ReseLin;
                    |SI nHay = 0; |PRINT; |FINSI;
                    |PIEINF;
               |FINSI;
               |FININF;
          |SINO;
               aAlfa = "0000Error en informe '" + aInforme + "'...";
               |MENAV aAlfa;
          |FINSI;
          |FINIMP;
     |FINSI;
|FPRC;

|PROCESO BtnImpr;
     |LEE 000#52=;
     |SI FSalida ! 0; |ACABA; |FINSI;
     enModoCab = 0;
     |HAZ Imprime;
|FPRC;

|PROCESO Evento52;
     |SI FSalida = 1; |O FSalida = 2;
          |SELECT #8#52;
          |LEE 000#52=;
          |HAZ TieneLineas;
     |FINSI;
     |SI FSalida = 4;
          |HAZ BtnCons;
          |SELECT #8#52;
     |FINSI;
|FPRC;

|PROCESO TieneLineas;
     |DDEF aAlfa;
     aAlfa = aAlfa + "sctrm052";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          |LEE 000#referen@.p;
          |SI FSalida = 0;
               |ESTADO_CONTROL nBtnModi, "ENABLE";
               |ESTADO_CONTROL nBtnBaja, "ENABLE";
               |ESTADO_CONTROL nBtnCons, "ENABLE";
               |ESTADO_CONTROL nBtnImpr, "ENABLE";
               |ESTADO_CONTROL nBtnDatoGen, "ENABLE";
               |ESTADO_CONTROL nBtnBusca, "ENABLE";
               |ESTADO_CONTROL nBtnBuscaTpv, "ENABLE";
               |ESTADO_CONTROL nBtnAnula, "ENABLE";
               |ESTADO_CONTROL nBtnDatoAnula, "ENABLE";
               |ESTADO_CONTROL nBtnDatoWeb, "ENABLE";
          |SINO;
               |ESTADO_CONTROL nBtnModi, "DISABLE";
               |ESTADO_CONTROL nBtnBaja, "DISABLE";
               |ESTADO_CONTROL nBtnCons, "DISABLE";
               |ESTADO_CONTROL nBtnImpr, "DISABLE";
               |ESTADO_CONTROL nBtnDatoGen, "DISABLE";
               |ESTADO_CONTROL nBtnBusca, "DISABLE";
               |ESTADO_CONTROL nBtnBuscaTpv, "DISABLE";
               |ESTADO_CONTROL nBtnAnula, "DISABLE";
               |ESTADO_CONTROL nBtnDatoAnula, "DISABLE";
               |ESTADO_CONTROL nBtnDatoWeb, "DISABLE";
          |FINSI;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|PROCESO LogoPanta;
     eaNomLogo = #100#1;
     |HAZ TraeLogoPan;
     enPantaLogo = nPanta;
     |HAZ PintaLogoPan;
|FPRC;

|PROCESO Oficina;
     aAlfa = Usuario % 810;
     |ABRE #47;
     #47#0 = aAlfa;
     |LEE 000#47=;
     |SI FSalida = 0;
          |ABRE #46;
          #46#0 = #47#3;
          |LEE 000#46=;
          |SI FSalida ! 0;
               nError = 1;
               aAlfa = "0000Oficina no dada de alta:" + #46#0;
               |MENAV aAlfa;
          |FINSI;
          |CIERRA #46;
     |SINO;
          nError = 1;
          aAlfa = "0000Usuario no dado de alta:" + aAlfa;
          |MENAV aAlfa;
     |FINSI;
     |CIERRA #47;
|FPRC;

|PROGRAMA;
     |HAZ Oficina;
     |SI nError ! 0; |ACABA; |FINSI;

     |ABRE #100; |LEE 000#100p; |CIERRA #100;

     aAlfa = "|NC";
     eaCamCab = #52aAlfa;
     aCamLin = #53aAlfa;

     |PINPA #0#0; nPanta = FSalida;
     |PINDA #0#0;
     |HAZ LogoPanta;

     |CONTROL_SIMPLE nPanta, "BOTON,{{193}}Alta", 1002, 1012, BtnAlta;
     nBtnAlta = FSalida;
     |CONTROL_SIMPLE nPanta, "BOTON,{{197}}Modificar", 1014, 1024, BtnModi;
     nBtnModi = FSalida;
     |CONTROL_SIMPLE nPanta, "BOTON,{{199}}Baja", 1026, 1036, BtnBaja;
     nBtnBaja = FSalida;
     |CONTROL_SIMPLE nPanta, "BOTON,{{155}}Consulta", 1038, 1048, BtnCons;
     nBtnCons = FSalida;
     |CONTROL_SIMPLE nPanta, "BOTON,{{205}}Impresi¢n", 1050, 1060, BtnImpr;
     nBtnImpr = FSalida;

     |CONTROL_SIMPLE nPanta, "BOTON,{{137}}Datos Generales", 2902, 2918, BtnDatoGen;
     nBtnDatoGen = FSalida;
     |CONTROL_SIMPLE nPanta, "BOTON,{{155}}Busqueda", 2920, 2930, BtnBusca;
     nBtnBusca = FSalida;
     |CONTROL_SIMPLE nPanta, "BOTON,{{155}}Busqueda TPV Virtual", 2932, 2948, BtnBuscaTpv;
     nBtnBuscaTpv = FSalida;
     |CONTROL_SIMPLE nPanta, "BOTON,{{199}}Anulaci¢n", 2950, 2960, BtnAnula;
     nBtnAnula = FSalida;
     |CONTROL_SIMPLE nPanta, "BOTON,{{137}}Datos Anulaci¢n", 2962, 2978, BtnDatoAnula;
     nBtnDatoAnula = FSalida;
     |CONTROL_SIMPLE nPanta, "BOTON,{{137}}Datos Web TPV Virtual", 2980, 2998, BtnDatoWeb;
     nBtnDatoWeb = FSalida;

     |HAZ CreaTempo; |NOME_DAT #13 Tempo; aTmp13 = Tempo; |DELINDEX #13;
     |HAZ CreaTempo; |NOME_DAT #14 Tempo; aTmp14 = Tempo; |DELINDEX #14;
     |HAZ CreaTempo; |NOME_DAT #15 Tempo; aTmp15 = Tempo; |DELINDEX #15;
     |ABRE #13;
     |ABRE #14;
     |ABRE #15;
     |ABRET #52;
     |ABRET #53;
     |SI eaModo = "CONSULTA";
          #52#0 = enReserva;
          |LEE 020#52=;
          |SI FSalida = 0;
               enModoCab = 4; |HAZ Edita;
          |FINSI;
     |SINO;
          |HAZ TieneLineas;
          nRango = 4 + 8 + 16 + 32;
          |LINEAL_SIMPLE #8#52, nRango, 1102, 2899, NULL, NULL, Evento52;
          nGridCab = FSalida;
          enCtrFin = nGridCab;
          |HAZ EsperaFin;
          |PULSATECLA;
          |DESTRUYECONTROL nGridCab;
     |FINSI;
     |CIERRAT #53;
     |CIERRAT #52;
     |CIERRA #15; Tempo = aTmp15; |HAZ BoraTempo; |DELINDEX #15;
     |CIERRA #14; Tempo = aTmp14; |HAZ BoraTempo; |DELINDEX #14;
     |CIERRA #13; Tempo = aTmp13; |HAZ BoraTempo; |DELINDEX #13;
|FPRO;
