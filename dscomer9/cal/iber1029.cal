
    ESTA AQUI POR PROBLEMAS CON PROCESOS DUPLICADOS....


|FICHEROS;
     agifa077 #77;  ||Alb. Comp
     agifa080 #80;  || ''
     dsm00057 #57;
     dsm00044 #44;
     dsm00055 #55;
     agifa081 #81;  ||Ped. Comp
     agifa067 #67;  || ''
     agifa019 #19;
     agifa017 #17;
|FIN;

|VARIABLES;
     &eaDocu   = "";
     &eaSer    = "";
     &enNum    = 0;
     &enLin    = 0;

     &enForma  = 1;

     aParam    = "";

     nPPort1   = 0;
     nPPort2   = 0;
     importe   = 0;
     importeD  = 0;
     enUnidPend= 0;
     enUnidPend2= 0;
     nForma    = 0;
     nImpDiv   = 0;
|FIN;

|PROCESO tot_ped_div;
     #81#34  = #81#11 / #81#33 * #81#28;   ||convierte totales a divisa
     #81#35  = #81#12 / #81#33 * #81#28;
     #81#36  = #81#13 / #81#33 * #81#28;
     |SI #81#29 = "B";  || Asigna campos visual. y no visual. en el pedido segun la moneda de trabajo
          #81#37 = #81#11;
          #81#38 = #81#12;
          #81#39 = #81#13;
          #81#40 = #81#34;
          #81#41 = #81#35;
          #81#42 = #81#36;
     |SINO;
          #81#37 = #81#34;
          #81#38 = #81#35;
          #81#39 = #81#36;
          #81#40 = #81#11;
          #81#41 = #81#12;
          #81#42 = #81#13;
   |FINSI;
|FPRC;

|PROCESO ActuaPedido;
     importe = #81#13;                || Imp Servido (C)
     |SI #19#196 = 2;
          #81#13 = #67#46 * #67#6;
     |SINO;
          #81#13 = #67#38 * #67#6;
     |FINSI;
     #81#13 = ((((#81#13 < #67#8) < #67#27) < #81#5) < #81#17) < #81#6;
     #81#13   = importe - #81#13;         || Imp Servido (C)

     #67#38 = #67#38 + #80#5;
     #67#46 = #67#46 + #80#36;
     #67#12 = #67#12 + #80#22;
     #67#42 = #67#12 + #80#24;

     #81#11 = #81#11 - #67#9;
     #67#5  = #67#37 +  #67#12;
     #67#41 = #67#45 + #67#44;
     |SI #19#196 = 2;
          #67#7 = #67#41 * #67#6;
     |SINO;
          #67#7 = #67#5 * #67#6;
     |FINSI;
     #67#9  = ((((#67#7 < #67#8) < #67#27) < #81#5) < #81#6);
     #81#11 = #81#11 + #67#9;

     #67#33 = #67#9 / #81#33 * #81#28;
     |SI #81#29 = "D";
         #67#36 = #67#9;
     |SINO;
         #67#36 = #67#34;
     |FINSI;

     |SI #19#196 = 2;
          importe = #67#46 * #67#6;
     |SINO;
          importe = #67#38 * #67#6;
     |FINSI;
     importe = ((((importe < #67#8) < #67#27) < #81#5) < #81#17) < #81#6;

     #67#11 = #67#9  - importe;         || Imp. Pdte (L)
     #81#13 = #81#13 + importe;         || Imp Servido (C)
     #81#12 = #81#11 - #81#13;          || Imp Pdte serv (C)
     #81#24 = #81#24 + #80#5;           || Ctrl Servido (C)

     |ABRE #19;
     |ABRE #17;
     #19#0 = #80#2;
     |LEE 101#19=;
     |SI FSalida ! 0; |GRABA 020#19b; |FINSI;
     #17#0 = #80#2;
     #17#1 = #80#3;
     |LEE 101#17=;
     |SI FSalida ! 0; |GRABA 020#17n; |FINSI;
     #19#16 = #19#16 - (#80#5 - #80#22);
     #19#183 = #19#183 - (#80#36 - #80#24);

     #17#43 = #17#43 - (#80#5 - #80#22);
     #17#45 = #17#45 - (#80#36 - #80#24);
     |GRABA 020#19a;
     |GRABA 020#17a;
     |CIERRA #19;
     |CIERRA #17;
|FPRC;

|PROCESO AdjPedido;
     |ABRE #81;
     |ABRE #67;
     #81#25 = #80#29;
     #81#0 = #80#12;
     |LEE 101#81=;
     |SI FSalida = 0;
          #67#28 = #80#29;
          #67#0 = #80#12;
          #67#1 = #80#21;
          |LEE 101#67=;
          |SI FSalida = 0;
               |HAZ ActuaPedido;
               |HAZ tot_ped_div;
               |GRABA 020#67a;
          |FINSI;
          |GRABA 020#81a;
     |FINSI;
     |CIERRA #81;
     |CIERRA #67;
|FPRC;

|PROCESO LinAlba;
     enForma = 1;            ||| |HAZ AcumulaCabAC;
     eaDocu = "agifa077";
     |HAZ StockEntra;
|FPRC;

|PROCESO Restaura0;
     #67#12 = #67#12 - #80#22;||Vari
     #67#38 = #67#38 - #80#5; ||Recib
     #67#5 =  #67#37 + #67#12; ||Uni

     |ABRE #19;
     |ABRE #17;
     #19#0 = #80#2;
     |LEE 101#19=;
     |SI FSalida ! 0; |GRABA 020#19b; |FINSI;
     #17#0 = #80#2;
     #17#1 = #80#3;
     |LEE 101#17=;
     |SI FSalida ! 0; |GRABA 020#17n; |FINSI;
     #19#16 = #19#16 + (#80#5 - #80#22);
     #19#183 = #19#183 + (#80#36 - #80#24);

     #17#43 = #17#43 + (#80#5 - #80#22);
     #17#45 = #17#45 + (#80#36 - #80#24);
     |GRABA 020#19a;
     |GRABA 020#17a;
     |CIERRA #19;
     |CIERRA #17;
|FPRC;

|PROCESO Restaura;
     |ABRE #81;
     |ABRE #67;
     #81#25 = #80#29;
     #81#0 = #80#12;
     |LEE 121#81=;
     |SI FSalida = 0;
          #67#28 = #80#29;
          #67#0 = #80#12;
          #67#1 = #80#21;
          |LEE 121#67=;
          |SI FSalida = 0;
               |HAZ Restaura0;
               |GRABA 020#67a;
          |FINSI;
          |HAZ CalCabAgifa081;
          |GRABA 020#81a;
     |FINSI;
     |CIERRA #81;
     |CIERRA #67;
|FPRC;

|PROCESO LinBajaAlba;
     enForma = -1;
     eaDocu = "agifa077";
     |HAZ StockEntra;

     eaDocu = "agifa080";
     |HAZ StockEntra;

||||     |HAZ AcumulaCabAC;
||||     |HAZ AcumulaAC;
     |SI #80#12 ! 0;
          |HAZ Restaura;
     |FINSI;
     |BORRA 020#80a
|FPRC;

|PROGRAMA;
     aParam = PARAMETRO; |QBF aParam;

     |SI aParam = "ACBAJA";
          |ABRE #77;
          #77#50 = eaSer;
          #77#0 = enNum;
          |LEE 121#77=;
          |SI FSalida = 0;
               |BUCLELIN 0 LinBajaAlba #77;
               |BORRA 020#77a;
          |FINSI;
          |CIERRA #77;
     |FINSI;

     |SI aParam = "AC";
          |SI enLin ! 0;
               |ABRE #77;
               #77#50 = eaSer;
               #77#0 = enNum;
               |LEE 000#77=;
               |CIERRA #77;

               |ABRE #80;
               #80#27 = eaSer;
               #80#0 = enNum;
               #80#1 = enLin;
               |LEE 000#80=;
               |SI FSalida = 0;
                    enForma = 1; |||||||HAZ AcumulaAC;
                    eaDocu = "agifa077";
                    |HAZ StockEntra;
                    |SI #80#12 ! 0;
                         |HAZ AdjPedido;
                    |FINSI;
               |FINSI;
               |CIERRA #80;
          |SINO;
               |ABRE #77;
               #77#50 = eaSer;
               #77#0 = enNum;
               |LEE 000#77=;
               |SI FSalida = 0;
                    |BUCLELIN 2 LinAlba #77;
               |FINSI;
               |CIERRA #77;
          |FINSI;
     |FINSI;
     |SI aParam = "EV";
          |ABRE #57;
          #57#28 =  eaSer;
          #57#27 = enNum;
          #57#14 = enLin;
          |LEE 000#57=;
          |SI FSalida = 0;
               enForma = 1; |HAZ AcumulaEV;
          |FINSI;
          |CIERRA #57;
     |FINSI;
     |SI aParam = "ES";
          |ABRE #44;
          #44#21 = eaSer;
          #44#18 = enNum;
          #44#8 = enLin;
          |LEE 000#44=;
          |SI FSalida = 0;
               enForma = 1; |HAZ AcumulaES_SS;
          |FINSI;
          |CIERRA #44;
     |FINSI;
     |SI aParam = "ME";
          |ABRE #55;
          #55#28 = eaSer;
          #55#27 = enNum;
          #55#11 = enLin;
          |LEE 000#55=;
          |SI FSalida = 0;
               enForma = 1; |HAZ AcumulaME_MS;
          |FINSI;
          |CIERRA #55;
     |FINSI;
|FPRO;
