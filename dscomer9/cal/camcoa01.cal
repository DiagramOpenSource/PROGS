 GenMasivo, GenTiquetT, GenTiquetC

|FICHEROS;
     camcoz02 #2,MANTE;  ||Acceso Caja
     camcor17 #17;
     agifa019 #19;
     camcor22 #22,MANTE;
     agifa024 #24;
     agifa027 #27;
     camcor30 #30,MANTE;
     dsm00058 #58;
     dsm00060 #60;
     dsm00061 #61;
     camcow01 #100;      ||Tmp Masivo
     agifa142 #142;
     agifa501 #501;
     agifa502 #502;
     agifa505 #505;
     agifa508 #508;
     agifa509 #509;
     agifa510 #510;
     agifa514 #514;
     agifa515 #515;
     agifa516 #516;
     agifa517 #517;
     agifa571 #571;
     agifa572 #572;
     tmp00000 #1000;     ||Tmp Tickets impresos

     &referec@;     ||Grid Camisas
     &referet@;     ||Grid Trajes
|FIN;

|VARIABLES;
     &Tempo = "";
     &EURODB = 0;
     &enForma = 0;
     &eaCli = "";
     &enTiva = 0;
     &efFiva = @;
     &enIva = 0;
     &enRec = 0;
     aAlfa = "";
     nError = 0;
     nCaja = 0;
     nHandle = 0;
     nCajero = 0;
     fHoy = @;
     aCli = "";
     nNume = 0;
     nPeriodo = 0;
     i = 0;
     j = 0;
     aHora = "";
     nNumDoc = 0;
     aClave = "";
     nLin = 0;
     aSer = "";
     nTarjeta = 0;
     &efFecha = @;
     &eaArticulo = "";
     &enImpVta = 0;
     &enImpMar = 0;
     &enImpCliCom = 0;
     &enImpCliDto = 0;
     &enImpCliMar = 0;
     &enImpCliFac = 0;
     &eaCliente = "";
     nMargen = 0;
     nImpo = 0;
     nPuntos = 0;
     nAbo = 0;
     nDto = 0;
     nMes = 0;
     aTmp1000 = "";
     aArti = "";
|FIN;

|PROCESO ActuaDeuda;
     |ABRE #571;
     |ABRE #572;
     |DDEFECTO #571;
     #571#0 = #501#1;
     |LEE 101#571=;
     |SI FSalida ! 0;
          #571#1 = #24#1;
          |GRABA 021#571b;
     |FINSI;
     #571#2 = #571#2 + #501#41;
     #571#4 = #571#4 + #501#41;

     #572#0 = #571#0;
     #572#1 = 9999;
     |LEE 001#572];
     |SI FSalida = 0;
          |LEE 001#572a;
     |SINO;
          |LEE 001#572u;
     |FINSI;
     |SI FSalida = 0; |Y #571#0 = #572#0;
          nNume = #572#1 + 1;
     |SINO;
          nNume = 1;
     |FINSI;
     |DDEFECTO #572;
     #572#0 = #571#0;
     #572#1 = nNume;
     #572#2 = #501#57;        ||Serie
     #572#3 = #501#0;         ||Registro
     #572#4 = #501#58;        ||Documento
     #572#5 = #501#14;        ||Fecha
     #572#6 = #501#12;        ||Caja
     #572#7 = #501#33;        ||Cajero
     #572#8 = #501#41;        ||Importe
     #572#9 = #501#41;        ||Importe Pdte
     #572#10 = #501#9;        ||Importe Total
     #572#13 = #501#36;
     |GRABA 021#572n;
     |GRABA 021#571a;
     |CIERRA #572;
     |CIERRA #571;
|FPRC;

|PROCESO PuntosCli;
     |SI #501#9 ] #58#1;
          nPuntos = #58#3;
     |FINSI;
     |SI #501#9 ] #58#1; |Y #501#9 [ #58#2;
          |ERROR10;
     |FINSI;
|FPRC;

|DEFBUCLE PuntosCli;
     #58#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, PuntosCli;
|FIN;

|PROCESO ActCab;
     |DFICE aAlfa;
     aAlfa = aAlfa % -205;
     |DDEFECTO #509;
     |ABRE #509;
     #509#63 = aAlfa;
     #509#0 = nCaja;
     #509#1 = fHoy;
     |LEE 101#509=;
     |SI FSalida ! 0; |GRABA 020#509b; |FINSI;
     |SI #501#9 > 0;
          |SI #501#3 > 0; nAbo = 1; |SINO; nAbo = -1; |FINSI;
          #501#3 = #501#3 * nAbo;
          nDto = (((#501#3 < #501#17) < #501#19) < #501#18) * nAbo;
          #501#3 = #501#3 * nAbo;
          nDto = #501#3 - nDto;   || Total Dto Cabecera
          ||---------------------Cliente
          |DDEFECTO #24;
          |ABRE #24;
          #24#0 = #501#1;
          |LEE 101#24=;
          |SI FSalida ! 0; |GRABA 020#24b; |FINSI;
          aAlfa = #501#14 % A402;
          nMes = ((aAlfa - 1) * 4) + 54;
          nNume = #501#3 - nDto;
          |SI #501#35 = "A";
               #24#50 = #24#50 + nNume;
          |SINO;
               |SI #142#115 = "N";
                    nImpo = (nNume * 100) / (100 - #501#18);
                    nDto = nDto + (nNume - nImpo);
               |SINO;
                    nImpo = nNume;
               |FINSI;
               #24nMes = #24nMes + nImpo;
               nMes = nMes + 1;
               #24nMes = #24nMes + nDto;
               nMes = nMes + 1;
               #24nMes = #24nMes + #501#8;
               #24#102 = #24#102 + nImpo;
               #24#103 = #24#103 + nDto;
               #24#104 = #24#104 + #501#8;
               nAbo = (FEntrada / 100) ! 0;
               |SI nAbo = 1;
                    #24#45 = #501#14;
               |FINSI;
               #24#46 = nNume;
               #24#110 = #24#110 + nNume;

               enImpCliCom = nImpo;
               enImpCliDto = nDto;
               enImpCliMar = #501#8;
               enImpCliFac = nNume;
               eaCliente = #501#1;
               efFecha = #501#14;
               |HAZ AcumulaCli;
          |FINSI;
          |GRABA 020#24a;
          |CIERRA #24;
          ||--------------------Resumen
          |SI #501#35 = "T"; |O #501#35 = "F"; |O #501#35 = "A";
               #509#24 = #509#24 + #501#9;   ||Venta con imp.
               #509#25 = #509#25 + #501#4;   ||Total iva
               #509#26 = #509#26 + (#501#22+#501#25+#501#47+#501#50+#501#53);
               #509#27 = #509#24 - #509#25 - #509#26;
               #509#28 = #509#28 + #501#28;  ||Total dto
               #509#29 = #509#29 + #501#3;   ||Total bruto
          |FINSI;
          #509#84 = #509#84 + #501#66;  ||Vales
          nNume = nPeriodo + 29;
          #509nNume = #509nNume;
          nNume = nNume + 10;
          #509nNume = #509nNume + (#501#9 - #501#4);
          |SI #505#163 = "S"; |O #501#9 > 0;
               #509#52 = #509#52 + (#501#38);     ||Efectivo
               #509#55 = #509#55 + (#501#38 + #501#40 + #501#39);
          |FINSI;
          #509#53 = #509#53 + #501#40;            ||Tarjeta
          #509#54 = #509#54 + #501#39;            ||Cheque
          #509#58 = #509#58 + #501#41;            ||Pendiente de credito
          #509#57 = #509#57 + #501#15;            ||Restos no  cobrados
          ||----------------------Tarjeta
          |SI #501#40 ! 0;
               |DDEFECTO #515;
               |ABRE #515;
               #515#0 = #501#46;
               |LEE 101#515=;
               |SI FSalida ! 0;    |GRABA 021#515b; |FINSI;
               #515#2 = #515#2 + #501#40;    ||Total Ptas cargadas
               #515#3 = #501#14;                  ||Fecha Ult. Oper.
               #515#4 = #501#40;                  ||Ptas Cargadas
               |GRABA 021#515a;
               |CIERRA #515;

               |DDEFECTO #516;
               |ABRE #516;
               #516#0 = #501#46;
               #516#1 = #501#14;
               |LEE 101#516=;
               |SI FSalida ! 0;    |GRABA 021#516b; |FINSI;
               #516#2 = #516#2 + #501#40;    ||Total Ptas cargadas
               |GRABA 021#516a;
               |CIERRA #516;
          |FINSI;
     |FINSI;
     |SI #501#35 = "T";                     ||Tiquet;
          #509#6 = #509#6 + 1;
          #509#15 = #509#15 + #501#9;
     |FINSI;
     |GRABA 021#509a;
     |CIERRA #509;

     |SI #501#41 ! 0;
          |HAZ ActuaDeuda;
     |FINSI;
     ||컴컴컴컴컴컴컴컴컴컴컴컴횾untos Cliente
     nPuntos = 0;
     |BUCLE PuntosCli;
     |SI nPuntos ! 0;
          |ABRE #60;
          |ABRE #61;
          |DDEFECTO #60;
          #60#0 = #501#1;
          |LEE 101#60=;
          |SI FSalida ! 0; |GRABA 020#60b; |FINSI;

          #61#0 = #60#0;
          #61#1 = 99999;
          |LEE 000#61];
          |SI FSalida = 0;
               |LEE 000#61a;
          |SINO;
               |LEE 000#61u;
          |FINSI;
          |SI FSalida = 0; |Y #60#0 = #61#0;
               nLin = #61#1 + 1;
          |SINO;
               nLin = 1;
          |FINSI;
          |DDEFECTO #61;
          #61#0 = #60#0;
          #61#1 = nLin;
          #61#2 = #501#35;
          #61#3 = #501#57;
          #61#4 = #501#58
          #61#5 = #501#14;
          #61#6 = #501#9;
          #61#7 = nPuntos;
          |GRABA 020#61n;

          #60#1 = #60#1 + #61#6;
          #60#2 = #60#2 + #61#7;
          |GRABA 020#60a;
          |CIERRA #60;
          |CIERRA #61;
     |FINSI;
|FPRC;

|PROCESO ActImpoArti;
     |ABRE #19;
     aAlfa = #501#14 % A402;
     nMes = ((aAlfa - 1) * 5) + 35;
     #19#0 = #502#2;
     |LEE 101#19=;
     |SI FSalida = 0;
          |SI #19#194 = 2;
               nImpo = ((((#502#29 * #502#10) < #502#14) < #501#17) < #501#19);
          |SINO;
               nImpo = ((((#502#5 * #502#10) < #502#14) < #501#17) < #501#19);
          |FINSI;
          |SI #142#115 = "S";
               nImpo = nImpo < #501#18;
          |FINSI;
          nMargen = nImpo - #502#23;
          #19nMes = #19nMes + nImpo;
          #19#95 = #19#95 + nImpo;
          nMes = nMes + 1;
          #19nMes = #19nMes + nMargen;
          #19#96 = #19#96 + nMargen;
          |GRABA 020#19a;

          efFecha = #501#14;
          eaArticulo = #502#2;
          enImpVta = nImpo;
          enImpMar = nMargen;
          |HAZ AcumulaArt;
     |FINSI;
     |CIERRA #19;
|FPRC;

|PROCESO NumDoc;
     |SI #142#137 = "F";
          aClave = "vtiquet";
          nNumDoc = 0;
          |ABRE #508;
          #508#0 = aClave;  aClave = #508#0;  ||para que lo rellene de blancos
          #508#1 = aSer;
          |LEE 101#508];
          |PARA; |SI FSalida = 0; |Y #508#0 = aClave; |Y #508#1 = aSer; |HACIENDO;
               |SI #508#3 = #501#14;
                    nNumDoc = #508#2;
                    |BORRA 021#508a;
                    |SAL;
               |FINSI;
               |LIBERA #508;
               |LEE 101#508s;
          |SIGUE;
          |CIERRA #508;
          |SI nNumDoc = 0;
               |ABRE #27;
               #27#0 = aClave;
               #27#2 = aSer;
               |LEE 101#27=;
               |SI FSalida ! 0;
                    #27#1 = 1;
                    |GRABA 021#27b;
               |FINSI;
               nNumDoc = #27#1;
               #27#1 = #27#1 + 1;
               |GRABA 021#27a;
               |CIERRA #27;
          |FINSI;
     |SINO;
          |SELECT #2#501;
          #501#35 = "T";
          #501#58 = 999999;
          |LEE 000#501];
          |SI FSalida = 0;
               |LEE 000#501a;
          |SINO;
               |LEE 000#501u;
          |FINSI;
          |SI FSalida = 0; |Y #501#57 = aSer; |Y #501#35 = "T";
               nNumDoc = #501#58 + 1;
          |SINO;
               nNumDoc = 1;
          |FINSI;
          |SELECT #1#501;
     |FINSI;
|FPRC;

|PROCESO CreaCab;
     nLin = 0;
     |ABRE #517; |LEE 000#517p; |CIERRA #517;
     |ABRE #142; |LEE 000#142p; |CIERRA #142;

     aSer = #505#105; ||Serie oficial
     |HAZ NumDoc;

     #501#36 = #505#112;
     #501#0 = 999999;
     |LEE 000#501];
     |SI FSalida = 0;
          |LEE 000#501a;
     |SINO;
          |LEE 000#501u;
     |FINSI;
     |SI FSalida = 0; |Y #501#36 = #505#112;
          nNume = #501#0 + 1;
     |SINO;
          nNume = 1;
     |FINSI;
     |DDEFECTO #501;
     #501#36 = #505#112;
     #501#0 = nNume;
     |GRABA 020#501b;

     |ABRE #24;
     #24#0 = aCli;
     |LEE 000#24=;
     |SI FSalida ! 0; |DDEFECTO #24; |FINSI;
     |CIERRA #24;

     #501#1 = #24#0;
     #501#7 = #24#15;
     #501#12 = nCaja;
     #501#14 = fHoy;
     ||#501#17 = #24#37;
     ||#501#18 = #24#38;
     ||#501#19 = #24#156;
     |SI #505#34 = "N";
          #501#29 = "N";
     |SINO;
          #501#29 = #24#47;
     |FINSI;
     #501#32 = #505#87;
     #501#33 = nCajero;
     #501#34 = aHora;
     #501#35 = "T";
     #501#46 = nTarjeta;
     #501#57 = aSer;
     #501#58 = nNumDoc;

     |SI nTarjeta ! 0;
          |ABRE #515;
          #515#0 = nTarjeta;
          |LEE 000#515=;
          |SI FSalida ! 0; |DDEFECTO #515; |FINSI;
          |CIERRA #515;
          #501#42 = #515#5;
     |FINSI;

     |GRABA 020#501a;

     #1000#0 = #501#36;
     #1000#1 = #501#0;
     |GRABA 020#1000n;
|FPRC;

|PROCESO AcumuLin;
     #502#9 = #501#14;

     enTiva = #19#30;
     eaCli = #502#4;
     efFiva = #502#9;
     |HAZ IVACli;
     #502#10 = #502#6 / (1+(enIva/100));
     #502#11 = #19#2;
     #502#12 = #19#3;
     #502#13 = #19#30;
     #502#15 = #501#12;
     #502#16 = #501#34;
     #502#17 = #501#33;
     #502#18 = "T";
     #502#19 = enIva;
     #502#21 = #502#7 / (1+(enIva/100));
     #502#22 = #19#128;
     enForma = 1;
     |HAZ AcumulaTPV;

     ||-----------------------------
     #502#42 = #502#5 * #19#208; ||P.Verde
     #502#23 = #19#9 * #502#5;         ||Coste linea

     #501#3 = #501#3 + #502#21;        ||Total bruto
     nNume = ((#502#21 < #501#17) < #501#19) < #501#18;
     #501#28 = #501#28 + (#502#21 - nNume);    ||Total descuentos
     |SI #502#13 = 0;
          #501#30 = #501#30 + nNume;      ||Exenta
     |FINSI;
     |SI #502#13 = 1;
           #501#20 = #501#20 + nNume;
           #501#21 = #501#21 + ((nNume % enIva)!EURODB);
           |SI #501#29 = "S";            ||Tiene recargo
                #501#22 = #501#22 + ((nNume % enRec)!EURODB);
           |FINSI;
     |FINSI;
     |SI #502#13 = 2;
          #501#23 = #501#23 + nNume;    || Base imponible s/decimales
          #501#24 = #501#24 + ((nNume % enIva)!EURODB);
          |SI #501#29 = "S";            ||Tiene recargo
               #501#25 = #501#25 + ((nNume % enRec)!EURODB);
          |FINSI;
     |FINSI;
     |SI #502#13 = 3;
          #501#26 = #501#26 + nNume;
          #501#27 = #501#27 + ((nNume % enIva)!EURODB);
          |SI #501#29 = "S";            ||Tiene recargo
               #501#47 = #501#47 + ((nNume % enRec)!EURODB);
          |FINSI;
     |FINSI;
     |SI #502#13 = 4;
          #501#48 = #501#48 + nNume;
          #501#49 = #501#49 + ((nNume % enIva)!EURODB);
          |SI #501#29 = "S";            ||Tiene recargo
               #501#50 = #501#50 + ((nNume % enRec)!EURODB);
          |FINSI;
     |FINSI;
     |SI #502#13 = 5;
          #501#51 = #501#51 + nNume;
          #501#52 = #501#52 + ((nNume % enIva)!EURODB);
          |SI #501#29 = "S";            ||Tiene recargo
               #501#53 = #501#53 + ((nNume % enRec)!EURODB);
          |FINSI;
     |FINSI;
     #501#77 = #501#77 + #502#42;
     #501#4 = #501#21+#501#22+#501#24+#501#25+#501#27+#501#47+#501#49+#501#50+#501#52+#501#53;
     #501#9 = #501#3 + #501#4;
     #501#76 = #501#76 + #502#5;

     |GRABA 020#502n;
     |HAZ ActImpoArti;
|FPRC;

|PROCESO CreaLinT;
     aArti = "";
     |SI #30#22 = 0; |Y #30#23 = 0; |Y #30#24 ! 0;
          aArti = #17#18;
     |FINSI;
     |SI #30#22 ! 0; |Y #30#23 ! 0;
          aArti = #17#7;
     |FINSI;
     |SI #30#22 = 0; |Y #30#23 ! 0;
          aArti = #17#8;
     |FINSI;
     |SI #30#22 ! 0; |Y #30#23 = 0;
          aArti = #17#9;
     |FINSI;
     |SI #30#6 = "P"; aArti = #17#19; |FINSI;
     |SI #30#6 = "C"; aArti = #17#20; |FINSI;
     |ABRE #19;
     #19#0 = aArti;
     |LEE 000#19=;
     |SI FSalida ! 0; |DDEFECTO #19; |FINSI;
     |CIERRA #19;

     nLin = nLin + 1;
     #502#20 = #501#36;
     #502#0 = #501#0;
     #502#1 = nLin;
     #502#2 = #19#0;
     #502#3 = #501#32;
     #502#4 = #501#1;
     #502#5 = 1;
     #502#6 = #30#29;
     #502#7 = #30#29;
     aAlfa = #19#1; |QBF aAlfa;
     aAlfa = aAlfa + " pedido " + (("000000" + #30#0) % -106);
     #502#8 = aAlfa;

     |HAZ AcumuLin;

     #501#10 = #501#10 + #30#30;
     |SI #30#21 = "E";
          #501#31 = "E";
          #501#38 = #501#38 + #30#30;
     |SINO;
          #501#31 = "T";
          #501#40 = #501#40 + #30#30;
     |FINSI;
     #501#41 = #501#41 + #30#33;
     |GRABA 020#501a;
|FPRC;

|PROCESO CreaLinC;
     |ABRE #19;
     #19#0 = #17#6;
     |LEE 000#19=;
     |SI FSalida ! 0; |DDEFECTO #19; |FINSI;
     |CIERRA #19;

     nLin = nLin + 1;
     #502#20 = #501#36;
     #502#0 = #501#0;
     #502#1 = nLin;
     #502#2 = #19#0;
     #502#3 = #501#32;
     #502#4 = #501#1;
     #502#5 = #22#15;
     #502#6 = #22#100;
     #502#7 = #22#80;
     aAlfa = #19#1; |QBF aAlfa;
     aAlfa = aAlfa + " pedido " + (("000000" + #22#0) % -106);
     #502#8 = aAlfa;

     |HAZ AcumuLin;

     #501#10 = #501#10 + #22#81;
     |SI #22#82 = "E";
          #501#31 = "E";
          #501#38 = #501#38 + #22#81;
     |SINO;
          #501#31 = "T";
          #501#40 = #501#40 + #22#81;
     |FINSI;
     #501#41 = #501#41 + #22#84;
     |GRABA 020#501a;
|FPRC;

|PROCESO TmpGenera;
     |SI aCli ! #100#5;
          |SI aCli ! ""; |HAZ ActCab; |FINSI;
          aCli = #100#5;
          nTarjeta = #100#9;
          |HAZ CreaCab;
          |SI nError ! 0; |ERROR10; |ACABA; |FINSI;
     |FINSI;
     |SI #100#1 = "C";
          #22#0 = #100#2;
          |LEE 121#22=;
          |SI FSalida = 0;
               |HAZ CreaLinC;
               |SI nError = 0;
                    #22#86 = #501#36;
                    #22#87 = #501#0;
                    |GRABA 020#22a;
               |FINSI;
          |FINSI;
     |SINO;
          #30#0 = #100#2;
          |LEE 121#30=;
          |SI FSalida = 0;
               |HAZ CreaLinT;
               |SI nError = 0;
                    #30#34 = #501#36;
                    #30#35 = #501#0;
                    |GRABA 020#30a;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE TmpGenera;
     #100#3;
     ;
     "*", "      ", " ", 000001;
     "*", "zzzzzz", "z", 999999;
     ;
     NULL, TmpGenera;
|FIN;


|PROCESO Horario;
     |ABRE #510;
     #510#0 = #505#18;
     |LEE 000#510=;
     |CIERRA #510;

     nPeriodo = 0;
     |PARA i = 1; |SI i [ 19; |HACIENDO i = i + 2;
          j = i + 1;
          nPeriodo = nPeriodo + 1;
          |SI nNume ] #510#i#; |Y nNume [ #510#j#;
               aAlfa = "";
               |SAL;
          |FINSI;
     |SIGUE;
|FPRC;

|PROCESO PideCajero;
     nError = 1;
     aAlfa = #17#14; |QBF aAlfa;
     |XABRE "C", aAlfa, nHandle;
     |SI FSalida = 0;
          |XLEE nHandle, 250, aAlfa;
          nCaja = aAlfa;
          |XCIERRA nHandle;

          |ABRE #505;
          #505#0 = nCaja;
          |LEE 000#505=;
          |SI FSalida = 0;
               |SI #505#23 = "N";
                    aAlfa = "0000Error la caja:" + nCaja + " no esta abierta...";
                    |MENAV aAlfa;
               |SINO;
                    |VENTANA 1235, 1965, -1, 17, "Introduzca el cajero";
                    |HAZ PushVenModal;
                    |DDEFECTO #2;
                    #2#0 = nCaja;
                    #2#1 = #505#24;
                    |PINPA #0#2;
                    |PINDA #0#2;
                    |ENDATOS #1#2;
                    |SI FSalida = 0;
                         |HORA aHora;
                         aAlfa = (aHora % 102) + (aHora % 402);
                         nNume = aAlfa;
                         aAlfa = "0000La hora no esta entre los limites definidos en HORARIOS";
                         |HAZ Horario;
                         |SI aAlfa ! "";
                              |MENAV aAlfa;
                         |SINO;
                              nCajero = #2#2;
                              fHoy = ~;
                              |SI fHoy ! #2#1;
                                   aAlfa = "0000NLa fecha de la caja:" + #2#1 + " es distinta a la actual:" + fHoy + ". 쭯ontinuar?";
                                   |CONFI aAlfa;
                                   nError = FSalida;
                              |SINO;
                                   nError = 0;
                              |FINSI;
                         |FINSI;
                    |FINSI;
                    |HAZ PopVenModal;
               |FINSI;
          |SINO;
               aAlfa = "0000Error no existe la caja:" + nCaja + " ...";
               |MENAV aAlfa;
          |FINSI;
          |CIERRA #505;
     |SINO;
          |MENAV "0000Error al leer el fichero caja...";
          nError = 1;
     |FINSI;
|FPRC;

|PROCESO GenMasivo;
     |HAZ PideCajero;
     |SI nError ! 0; |ACABA; |FINSI;

     |HAZ CreaTempo; aTmp1000 = Tempo;
     |NOME_DAT #1000 Tempo; |DELINDEX #1000; |ABRE #1000;

     |ABRE #501;
     |ABRE #502;
     aCli = "";
     |BUCLE TmpGenera;
     |SI aCli ! ""; |HAZ ActCab; |FINSI;
     |CIERRA #502;
     |CIERRA #501;

     |HAZ ImprimeTicket;
     |CIERRA #1000; |DELINDEX #1000; Tempo = aTmp1000; |HAZ BoraTempo;
|FPRC;

|PROCESO GenTiquetT;
     |HAZ PideCajero;
     |SI nError ! 0; |ACABA; |FINSI;

     |HAZ CreaTempo; aTmp1000 = Tempo;
     |NOME_DAT #1000 Tempo; |DELINDEX #1000; |ABRE #1000;

     |ABRE #501;
     |ABRE #502;
     #30#0 = #referet@#0;
     |LEE 121#30=;
     |SI FSalida = 0;
          aCli = #30#3;
          nTarjeta = #30#32;
          |HAZ CreaCab;
          |SI nError = 0;
               |HAZ CreaLinT;
               |SI nError = 0;
                    #30#34 = #501#36;
                    #30#35 = #501#0;
                    |GRABA 020#30a;
                    |SI aCli ! ""; |HAZ ActCab; |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
     |CIERRA #502;
     |CIERRA #501;

     |HAZ ImprimeTicket;
     |CIERRA #1000; |DELINDEX #1000; Tempo = aTmp1000; |HAZ BoraTempo;
|FPRC;

|PROCESO GenTiquetC;
     |HAZ PideCajero;
     |SI nError ! 0; |ACABA; |FINSI;

     |HAZ CreaTempo; aTmp1000 = Tempo;
     |NOME_DAT #1000 Tempo; |DELINDEX #1000; |ABRE #1000;

     |ABRE #501;
     |ABRE #502;
     #22#0 = #referec@#0;
     |LEE 121#22=;
     |SI FSalida = 0;
          aCli = #22#3;
          nTarjeta = #22#83;
          |HAZ CreaCab;
          |SI nError = 0;
               |HAZ CreaLinC;
               |SI nError = 0;
                    #22#86 = #501#36;
                    #22#87 = #501#0;
                    |GRABA 020#22a;
                    |SI aCli ! ""; |HAZ ActCab; |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
     |CIERRA #502;
     |CIERRA #501;

     |HAZ ImprimeTicket;
     |CIERRA #1000; |DELINDEX #1000; Tempo = aTmp1000; |HAZ BoraTempo;
|FPRC;

|PROCESO ImprimeTicket;
     aAlfa = "agifa578;" + aTmp1000;
     |SUB_EJECUTA_NP aAlfa;
|FPRC;
