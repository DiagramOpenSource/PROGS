|FICHEROS;
     agifa111 #0;
     agifa019 #1;
     agifa321;
     agifa324;
|FIN;

|VARIABLES;
     i = 0;
     &nDeci_Pre = 0;
     nSwAparecida = 0;
     &eaArticulo = "";
     &pvp1       = 0;
     &pvp2       = 0;
     &pvp3       = 0;
     &pvp4       = 0;
     &pvp5       = 0;
     &pvp6       = 0;
     &nDeci_PreDiv  = 0;
     &nDeci_Base    = 0;
     &nDeci_PreBase = 0;
     aAlfa     = "";
     total1    = 0;
     total2    = 0;
     total3    = 0;
     total4    = 0;
     total5    = 0;
     total6    = 0;
     m1        = 0;
     m2        = 0;
     m3        = 0;
     m4        = 0;
     m5        = 0;
     m6        = 0;
     nRedon    = 0;
     nMulti    = 1000000;
|FIN;

|PROCESO Llenalo; |TIPO 0;
     aAlfa = #0#6;
     |QBF aAlfa;
     |SI aAlfa ! "";
          aAlfa = ("000000" + aAlfa) % -106;
          #0#6 = aAlfa; |PINTA #0#6;
     |FINSI;
|FPRC;

|PROCESO LlenaArt; |TIPO 6;
     eaArticulo = #0Campo;
     |HAZ LlenaArticulo;
     |SI FSalida = 0;
          #0Campo = eaArticulo;
          |PINTA #0Campo;
     |SINO;
          |ERROR; |ACABA;
     |FINSI;
|FPRC;

|PROCESO Divisa;
     |ABRE #agifa321;
     |ABRE #agifa324;
     |LEE 000#agifa321.p;
     #agifa324#0 = #agifa321#9;
     |LEE 000#agifa324.=;
     |CIERRA #agifa324;
     |CIERRA #agifa321;
     nDeci_PreDiv = #agifa324#9;
     nDeci_Base = #agifa324#7;
     nDeci_PreBase = #agifa324#9;
     nDeci_Pre = #agifa324#9;
|FPRC;

|CALCULO redondeo;
     m1 = 0; m2 = 0; m3 = 0;  m4 = 0; m5 = 0; m6 = 0;

     nRedon = #1#109 * nMulti;

     |SI nRedon ! 0;
          m1 = #1#18 * nMulti;
          m1 = m1 $ nRedon;

          m2 = #1#19 * nMulti;
          m2 = m2 $ nRedon;

          m3 = #1#20 * nMulti;
          m3 = m3 $ nRedon;

          m4 = #1#147 * nMulti;
          m4 = m4 $ nRedon;

          m5 = #1#148 * nMulti;
          m5 = m5 $ nRedon;

          m6 = #1#149 * nMulti;
          m6 = m6 $ nRedon;

          |SI m1 ! 0;
               m1 = nRedon - m1;
               #1#18 = #1#18 + (m1/nMulti);
          |FINSI;

          |SI m2 ! 0;
               m2 = nRedon - m2;
               #1#19 = #1#19 + (m2/nMulti);
          |FINSI;

          |SI m3 ! 0;
               m3 = nRedon - m3;
               #1#20 = #1#20 + (m3/nMulti);
          |FINSI;

          |SI m4 ! 0;
               m4 = nRedon - m4;
               #1#147 = #1#147 + (m4/nMulti);
          |FINSI;

          |SI m5 ! 0;
               m5 = nRedon - m5;
               #1#148 = #1#148 + (m5/nMulti);
          |FINSI;

          |SI m6 ! 0;
               m6 = nRedon - m6;
               #1#149 = #1#149 + (m6/nMulti);
          |FINSI;
     |FINSI;
|FCAL;

|CALCULO cambia;
     |SI #0#8 = "S";
          total1 = #1#18  % #0#9;
          total2 = #1#19  % #0#10;
          total3 = #1#20  % #0#11;
          total4 = #1#147 % #0#12;
          total5 = #1#148 % #0#13;
          total6 = #1#149 % #0#14;
     |FINSI;

     |SI #0#8 = "N";
          total1 = #0#9;
          total2 = #0#10;
          total3 = #0#11;
          total4 = #0#12;
          total5 = #0#13;
          total6 = #0#14;
     |FINSI;

     |SI #0#8 = "G";
          #1#18 = (#1#18 * 100) / (100 - #0#9);
          #1#19 = (#1#19 * 100) / (100 - #0#10);
          #1#20 = (#1#20 * 100) / (100 - #0#11);
          #1#147 = (#1#147 * 100) / (100 - #0#12);
          #1#148 = (#1#148 * 100) / (100 - #0#13);
          #1#149 = (#1#149 * 100) / (100 - #0#14);
     |SINO;
          #1#18  = #1#18 + total1;
          #1#19  = #1#19 + total2;
          #1#20  = #1#20 + total3;
          #1#147 = #1#147 + total4;
          #1#148 = #1#148 + total5;
          #1#149 = #1#149 + total6;
     |FINSI;

     |SI nSwAparecida = 0;
          eaArticulo = #1#0;
          pvp1 = #1#18;
          pvp2 = #1#19;
          pvp3 = #1#20;
          pvp4 = #1#147;
          pvp5 = #1#148;
          pvp6 = #1#149;
          |SUB_EJECUTA_NP "aparm009;AUTO";
     |FINSI;

     |HAZ redondeo;
     |GRABA 020#1a;
     |LIBERA #1;
|FCAL;


|DEFBUCLE agifa019;
     #1#1;
     2,3,27;
     #0#0,#0#2,#0#4,#0#6;
     #0#1,#0#3,#0#5,#0#7;
     be;
     NULL,cambia;
|FIN;

|CALCULO Inicio;|TIPO 3;
     |HAZ EsAparecida;
     nSwAparecida = FSalida;

     |BUCLE agifa019;
|FCAL;

|PROGRAMA;
     |HAZ Divisa;

     || Cambio nMulti por el valor segun los decimales
     || ya que con numeros muy grandes falla el modulo: $
     || 3000000001 $ 1000000  da negativo

     nMulti = 1;
     |PARA i = 1; |SI i [ nDeci_PreBase; |HACIENDO i = i + 1;
          nMulti = nMulti * 10;
     |SIGUE;

     |MANTE #0;
|FPRO;
