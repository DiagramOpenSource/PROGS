|FICHEROS;
     platz001 #0;
     platm035 #35;
     agifa019 #19;
|FIN;

|VARIABLES;
     &enError = 0;
     &eaRuta = "";
     &eaAlfa = "";

     aSepara = "";
     aFin = "";
     aTipo = "";
     aAlfa = "";
     aCampos = "";
     nHandle = 0;
     i = 0;
     nPrime = 0;
     aIP = "";
     aOrg = "";
|FIN;

|PROCESO Dato;
     |QBF aAlfa;
     |SI aTipo = "A";
          eaAlfa = aAlfa; |HAZ QuitaRarosExp; aAlfa = eaAlfa;
          |SI nPrime = 0;
               aAlfa = &34 + aAlfa + &34;
          |SINO;
               aAlfa = aSepara + &34 + aAlfa + &34;
          |FINSI;
     |SINO;
          |SI nPrime ! 0;
               aAlfa = aSepara + aAlfa;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO agifa019;
     nPrime = 0;
     |PARA i = 0; |SI i < aCampos; |HACIENDO i = i + 1;
          #35#0 = i;
          |LEE 000#35=;
          |SI FSalida = 0; |Y #35#2 = "*";
               aAlfa = ("000" + i) % -103;
               aAlfa = "|C" + aAlfa + "TIPO";
               aTipo = #19aAlfa;
               aAlfa = #19i;
               |HAZ Dato;
               |XGRABA nHandle, aAlfa;
               nPrime = 1;
          |FINSI;
     |SIGUE;
     |SI nPrime = 1; |XGRABA nHandle, aFin; |FINSI;
|FPRC;

|DEFBUCLE agifa019;
     #19#1;
     ;
     #0#3;
     #0#4;
     ;
     NULL, agifa019;
|FIN;

|PROCESO Nombres;
     |SI #0#1 ! "S"; |ACABA; |FINSI;

     nPrime = 0;
     |PARA i = 0; |SI i < aCampos; |HACIENDO i = i + 1;
          #35#0 = i;
          |LEE 000#35=;
          |SI FSalida = 0; |Y #35#2 = "*";
               aTipo = "A";
               aAlfa = #35#1;
               |HAZ Dato;
               |XGRABA nHandle, aAlfa;
               nPrime = 1;
          |FINSI;
     |SIGUE;
     |SI nPrime = 1; |XGRABA nHandle, aFin; |FINSI;
|FPRC;

|PROCESO T3; |TIPO 3;
     |DFICE aAlfa;
     aOrg = #0#2; |QBF aOrg;
     |XABRE "WB", aOrg, nHandle;
     |SI FSalida ] 0;
          aAlfa = "|NC";
          aCampos = #19#aAlfa#;
          |ABRE #35;
          |HAZ Nombres;
          |BUCLE agifa019;
          |CIERRA #35;
          |XCIERRA nHandle;

          aAlfa = #0#5; |QBF aAlfa;
          |SI aAlfa ! "";
               aAlfa = aAlfa + " " + aOrg;
               |SYSTEM aAlfa;
          |FINSI;
     |SINO;
          |MENAV "0000Error al crear destino...";
     |FINSI;
|FPRC;

|PROCESO Fichero; |TIPO 0;
/*
     |SI FSalida = 13;
          |HAZ DsSelect;
          |SI enError = 0;
               #0Campo = eaRuta; |PINTA #0Campo;
          |FINSI;
          |ERROR;
     |FINSI;
*/
|FPRC;

|PROGRAMA;

     |IP_REMOTO aIP;
     aSepara = ";"
     aFin = &13 + &10;

     |ABRE #0;
     |LEE 101#0p;
     |SI FSalida ! 0; |GRABA 020#0b; |FINSI;

     |SI PARAMETRO = "menu";
          |PINPA #0#0;
          |PINDA #0#0;
          |ENDATOS #1#0;
          |SI FSalida = 0;
               |GRABA 020#0a;
          |FINSI;
     |SINO;
          |HAZ T3;
     |FINSI;

     |CIERRA #0;
|FPRO;
