  ----------------------  AGIFA010 (ALBARANES VENTAS CABECERAS) -------

|FICHEROS;
     dszrec01;
     agifa010 #10; ||#0;
     agifa071 #71; ||#3;
     agifa024;
     agifa142;
     agifa019 #19; || #2;
     fries027 #27;
     referen@;
|FIN;

|VARIABLES;
     &nDeci_BaseMx = 0;
     nSwOrts = 0;
     nComi = 0;
     aPath = "";
     nCanon = 0;
     nSwBolilla = 0;
     &enForma = 0;
     aBaseRec01 = "";
     aMasRec01 = "";
     aCampo207 = "";

     nBasRete = 0;
     nImporDescue1 = 0;
     nImporDescue2 = 0;
     nImporDescue3 = 0;
     nImporMoneda1 = 0;
     nImporMoneda2 = 0;
     nDescuMoneda1 = 0;
     nDescuMoneda2 = 0;

     aDef          = "";
     &nDeci_IVA    = 0;
     &nDeci_IVADiv = 0;
     nError        = 0;
     nNume         = 0;
     nCanti        = 0;
     nMargen       = 0;
     nBrutoMoneda1 = 0;
     nBrutoMoneda2 = 0;

     &eaCli        = "";
     &enTiva       = 0;
     &enIva        = 0;
     &enRec        = 0;
     &efFiva = @;
     nImpDiv       = 0;
     nMult         = 0;
     nTotPVerde = 0;
     nPreTon = 0;
     aAlfa = "";
     nSwAlba = 0;
     nSwBsegui = 0;
|FIN;

|PROCESO BseVerdeBase1;  || Modulo
     |HAZ EsAlbadis; nSwAlba = FSalida;
     |HAZ EsBsegui; nSwBsegui = FSalida;
     |HAZ EsBolillas; nSwBolilla = FSalida;

     |SI nSwAlba ! 0; |Y nSwBsegui ! 0; |Y nSwBolilla ! 0;
               |Y #agifa142#177 ! "S";
          |ACABA;
     |FINSI;

     nBrutoMoneda1 = nBrutoMoneda1 + #agifa071#62;
     nBrutoMoneda2 = nBrutoMoneda2 + #agifa071#62;
     nTotPVerde = #agifa010#94;
|FPRC;

|PROCESO IvasAgifa010;
     efFiva = #agifa010#1;
     |HAZ IVACli;

     |SI enTiva = 0;
         #agifa010#28 = #agifa010#28 +. nBrutoMoneda1;
         #dszrec01#00 = #dszrec01#00 +. nBrutoMoneda2;
     |FINSI;

     |SI enTiva = 1;
         #agifa010#16 = #agifa010#16 +. nBrutoMoneda1;
         nNume        = #agifa010#16;
         #agifa010#17 = #agifa010#16 % enIva;
         |SI #agifa010#36 = "S";
             #agifa010#18 = nNume % enRec;
         |FINSI;

         #dszrec01#1  = #dszrec01#1  +. nBrutoMoneda2;
         nNume        = #dszrec01#1;
         #dszrec01#2  = #dszrec01#1 % enIva;
         |SI #agifa010#36 = "S";
             #dszrec01#3 = nNume % enRec;
         |FINSI;
     |FINSI;

     |SI enTiva = 2;
         #agifa010#19 = #agifa010#19 +. nBrutoMoneda1;
         nNume        = #agifa010#19;
         #agifa010#20 = #agifa010#19 % enIva;
         |SI #agifa010#36 = "S";
             #agifa010#21 = nNume % enRec;
         |FINSI;

         #dszrec01#4  = #dszrec01#4  +. nBrutoMoneda2;
         nNume        = #dszrec01#4;
         #dszrec01#5  = #dszrec01#4 % enIva;
         |SI #agifa010#36 = "S";
             #dszrec01#6 = nNume % enRec;
         |FINSI;
     |FINSI;

     |SI enTiva = 3;
         #agifa010#22 = #agifa010#22 +. nBrutoMoneda1;
         nNume        = #agifa010#22;
         #agifa010#23 = #agifa010#22 % enIva;
         |SI #agifa010#36 = "S";
             #agifa010#54 = nNume % enRec;
         |FINSI;

         #dszrec01#7  = #dszrec01#7  +. nBrutoMoneda2;
         nNume        = #dszrec01#7;
         #dszrec01#8  = #dszrec01#7 % enIva;
         |SI #agifa010#36 = "S";
             #dszrec01#9 = nNume % enRec;
         |FINSI;
     |FINSI;

     |SI enTiva = 4;
         #agifa010#44 = #agifa010#44 +. nBrutoMoneda1;
         nNume        = #agifa010#44;
         #agifa010#45 = #agifa010#44 % enIva;
         |SI #agifa010#36 = "S";
             #agifa010#46 = nNume % enRec;
         |FINSI;

         #dszrec01#10 = #dszrec01#10 +. nBrutoMoneda2;
         nNume        = #dszrec01#10;
         #dszrec01#11 = #dszrec01#10 % enIva;
         |SI #agifa010#36 = "S";
             #dszrec01#12 = nNume % enRec;
         |FINSI;
     |FINSI;

     |SI enTiva = 5;
         #agifa010#47 = #agifa010#47 +. nBrutoMoneda1;
         nNume        = #agifa010#47;
         #agifa010#48 = #agifa010#47 % enIva;
         |SI #agifa010#36 = "S";
             #agifa010#49 = nNume % enRec;
         |FINSI;

         #dszrec01#13 = #dszrec01#13 +. nBrutoMoneda2;
         nNume        = #dszrec01#13;
         #dszrec01#14 = #dszrec01#13 % enIva;
         |SI #agifa010#36 = "S";
             #dszrec01#15 = nNume % enRec;
         |FINSI;
     |FINSI;

|FPRC;

|PROCESO IvaRestoAgifa010;
     eaCli         = #agifa010#3;

     nBrutoMoneda1 = #agifa010#11;
     nBrutoMoneda2 = #agifa010#81;
     enTiva        = #agifa010#12;
     |HAZ IvasAgifa010;

     nBrutoMoneda1 = #agifa010#13;
     nBrutoMoneda2 = #agifa010#82;
     enTiva        = #agifa010#14;
     |HAZ IvasAgifa010;
|FPRC;

|PROCESO LimCabAgifa010;
     |ABRE #agifa142; |LEE 000#agifa142.p; |CIERRA #agifa142;
     |DDEFECTO #dszrec01;
     #agifa010#15 = 0;
     #agifa010#37 = 0;
     #agifa010#16 = 0;
     #agifa010#17 = 0;
     #agifa010#18 = 0;
     #agifa010#19 = 0;
     #agifa010#20 = 0;
     #agifa010#21 = 0;
     #agifa010#22 = 0;
     #agifa010#23 = 0;
     #agifa010#24 = 0;
     #agifa010#25 = 0;
     #agifa010#26 = 0;

     |HAZ EsOrts;
     |SI FSalida = 0;
          |HAZ OrtsComiAlbCero;
     |FINSI;

     #agifa010#28 = 0;
     #agifa010#37 = 0;
     #agifa010#44 = 0;
     #agifa010#45 = 0;
     #agifa010#46 = 0;
     #agifa010#47 = 0;
     #agifa010#48 = 0;
     #agifa010#49 = 0;
     #agifa010#54 = 0;
     #agifa010#67 = 0;
     #agifa010#75 = 0;
     #agifa010#76 = 0;
     #agifa010#94 = 0;
     #agifa010#96 = 0;
     |SI #agifa010#70 = "D";
          #agifa010#11 = #agifa010#81 / #agifa010#69 * #agifa010#74;
          #agifa010#13 = #agifa010#82 / #agifa010#69 * #agifa010#74;
     |SINO;
          #agifa010#81 = #agifa010#11 * #agifa010#69 / #agifa010#74;
          #agifa010#82 = #agifa010#13 * #agifa010#69 / #agifa010#74;
     |FINSI;
     |HAZ IvaRestoAgifa010;
|FPRC;

|PROCESO ComiMalpesa;
     |DDEF aDef;
     aDef = aDef + "malpe091";
     |CARGA_DEF aDef, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          #referen@#29 = #agifa071#29;
          #referen@#0 = #agifa071#0;
          #referen@#1 = #agifa071#1;
          |LEE 000#referen@.=;
          |CIERRA #referen@;
          nNume = (#referen@#67 * #referen@#5);
          nNume = ((nNume < #agifa010#5) < #agifa010#32) < #agifa010#7;
          nNume = nNume % #referen@#10;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|PROCESO CalCabAgifa010;
     |SI #agifa071#9 ] 0;
          nError = 1;
     |SINO;
          nError = -1;
     |FINSI;
     #agifa071#9   = #agifa071#9 * nError;
     #agifa071#37  = #agifa071#37 * nError;

     nCanti = #agifa071#9 < #agifa010#5;
     nCanti = nCanti < #agifa010#32;
     |SI #agifa142#115 = "S";
          nCanti = nCanti < #agifa010#7;
     |FINSI;
     nCanti = nCanti * nError;
     |SI #agifa019#194 = 1;
         nMargen = #agifa071#5 * #agifa019#9;
     |SINO;
         nMargen = #agifa071#48 * #agifa019#9;
     |FINSI;
     nMargen = nCanti - nMargen;
     #agifa010#37 = #agifa010#37 + nMargen;

     #agifa071#9  = #agifa071#9  * nError;
     #agifa071#37 = #agifa071#37 * nError;
     ||----------------------------

     #agifa010#15 = #agifa010#15 +. #agifa071#9;
     #agifa010#75 = #agifa010#75 +. #agifa071#37;
     #agifa010#94 = #agifa010#94 +. #agifa071#62;

     nBrutoMoneda1 = #agifa071#9;
     nImporDescue1 = (nBrutoMoneda1 % #agifa010#5) ! nDeci_IVA;
     nBrutoMoneda1 = nBrutoMoneda1 - nImporDescue1;
     nImporDescue2 = (nBrutoMoneda1 % #agifa010#32) ! nDeci_IVA;
     nBrutoMoneda1 = nBrutoMoneda1 - nImporDescue2;
     nImporDescue3 = (nBrutoMoneda1 % #agifa010#7) ! nDeci_IVA;
     nBrutoMoneda1 = nBrutoMoneda1 - nImporDescue3;
     nDescuMoneda1 = nImporDescue1 + nImporDescue2 + nImporDescue3;

     nBrutoMoneda2 = #agifa071#37;
     nImporDescue1 = (nBrutoMoneda2 % #agifa010#5) ! nDeci_IVA;
     nBrutoMoneda2 = nBrutoMoneda2 - nImporDescue1;
     nImporDescue2 = (nBrutoMoneda2 % #agifa010#32) ! nDeci_IVA;
     nBrutoMoneda2 = nBrutoMoneda2 - nImporDescue2;
     nImporDescue3 = (nBrutoMoneda2 % #agifa010#7) ! nDeci_IVA;
     nBrutoMoneda2 = nBrutoMoneda2 - nImporDescue3;
     nDescuMoneda2 = nImporDescue1 + nImporDescue2 + nImporDescue3;
/*
     nBrutoMoneda1 = (#agifa071#9  < #agifa010#5) ! nDeci_IVA;
     nBrutoMoneda1 = (nBrutoMoneda1 < #agifa010#32) ! nDeci_IVA;
     nBrutoMoneda1 = (nBrutoMoneda1 < #agifa010#7) ! nDeci_IVA;

     nBrutoMoneda2 = (#agifa071#37 < #agifa010#5) ! nDeci_IVADiv;
     nBrutoMoneda2 = (nBrutoMoneda2 < #agifa010#32) ! nDeci_IVADiv;
     nBrutoMoneda2 = (nBrutoMoneda2 < #agifa010#7) ! nDeci_IVADiv;
*/
     |HAZ BseVerdeBase1;

     eaCli         = #agifa010#3;
     enTiva        = #agifa071#11;
     |HAZ IvasAgifa010;

     |SI #agifa071#63 = -1; ||Linea canon
          nCanon = #agifa071#9 + (#agifa071#9 % enIva);
          |SI #agifa010#36 = "S";
               nCanon = nCanon + (#agifa071#9 % enRec);
          |FINSI;
          #agifa010#96 =  #agifa010#96 +. nCanon;
     |FINSI;
     ||----------------------------
     |HAZ EsMalpesa;
     |SI FSalida = 0;
          nNume = 0;
          |HAZ ComiMalpesa;
     |SINO;
          nNume = nBrutoMoneda1 % #agifa071#10;
     |FINSI;
     #agifa010#26 = #agifa010#26 +. nNume;
     ||----------------------------
     |HAZ EsOrts;
     |SI FSalida = 0;
           nSwOrts = 0; |HAZ OrtsComiAlbTota;
     |FINSI;

     #agifa010#25 = #agifa010#25 +. nDescuMoneda1;
/*
     |SI #agifa010#15 > 0;
         nError = 1;
     |SINO;
         nError = -1;
         #agifa010#15 = -#agifa010#15;
         #agifa010#75 = -#agifa010#75;
     |FINSI;

     #agifa010#25 = #agifa010#15 < #agifa010#5;
     #agifa010#25 = #agifa010#25 < #agifa010#32;
     #agifa010#25 = #agifa010#25 < #agifa010#7;

     #agifa010#25 = #agifa010#25 * nError;
     #agifa010#15 = #agifa010#15 * nError;
     #agifa010#25 = #agifa010#15 - #agifa010#25;
*/

     #agifa010#24 = #agifa010#17 + #agifa010#18 + #agifa010#20 + #agifa010#21 + #agifa010#23 + #agifa010#54 + #agifa010#45 + #agifa010#46 + #agifa010#48 + #agifa010#49;

     #dszrec01#17 = #dszrec01#17 +. nDescuMoneda2;

/*
     #dszrec01#17 = #agifa010#75 < #agifa010#5;
     #dszrec01#17 = #dszrec01#17 < #agifa010#32;
     #dszrec01#17 = #dszrec01#17 < #agifa010#7;
     #dszrec01#17 = #dszrec01#17 * nError;

     #agifa010#75 = #agifa010#75 * nError;
     #dszrec01#17 = #agifa010#75 - #dszrec01#17;
*/

     #dszrec01#16 = #dszrec01#02 + #dszrec01#03 + #dszrec01#05 + #dszrec01#06 + #dszrec01#08 + #dszrec01#09 + #dszrec01#11 + #dszrec01#12 + #dszrec01#14 + #dszrec01#15;

     #agifa010#67 =  (#agifa010#15 - #agifa010#25) + (#agifa010#11 + #agifa010#13 + #agifa010#24);
     #agifa010#67 = #agifa010#67 + nTotPVerde;  || modulo

     #agifa010#76 =  (#agifa010#75 - #dszrec01#17) + (#agifa010#81 + #agifa010#82 + #dszrec01#16);
     #agifa010#76 = #agifa010#76 + nTotPVerde;  || modulo

     |SI #agifa010#70 = "D";
         #agifa010#77 = #agifa010#75;
         #agifa010#78 = #agifa010#76;
         #agifa010#79 = #agifa010#15;
         #agifa010#80 = #agifa010#67;
     |SINO;
         #agifa010#77 = #agifa010#15;
         #agifa010#78 = #agifa010#67;
         #agifa010#79 = #agifa010#75;
         #agifa010#80 = #agifa010#76;
     |FINSI;

     |DDEFECTO #agifa024;
     #agifa024#0 = #agifa010#3;
     |LEE 000#agifa024.=;
     |SI FSalida = 102;
          |ABRE #agifa024;
          #agifa024#0 = #agifa010#3;
          |LEE 000#agifa024.=;
          |CIERRA #agifa024;
     |FINSI;
     aCampo207 = #agifa024#207;

     nBasRete = #agifa010#28 + #agifa010#16 + #agifa010#19 + #agifa010#22 + #agifa010#44 + #agifa010#47;
     |SI aCampo207 = "N";
          nBasRete = nBasRete + #agifa010#17 + #agifa010#20 + #agifa010#23 + #agifa010#45 + #agifa010#48;
          nBasRete = nBasRete + #agifa010#18 + #agifa010#21 + #agifa010#54 + #agifa010#46 + #agifa010#49;
     |FINSI;
     #dszrec01#19 = nBasRete;
     #dszrec01#20 = nBasRete / #agifa010#69 * #agifa010#74
|FPRC;

|| ----------------------  FIN AGIFA010 ---------------------------------

  ----------------------  TMP00010 (ALBARANES VENTAS CABECERAS IMPRESION )

|FICHEROS;
     tmp00010;
     tmp00071;
|FIN;

|PROCESO IvasTmp00010;
     |HAZ IVACli;

     |SI enTiva = 0;
         #tmp00010#28 = #tmp00010#28 +. nBrutoMoneda1;
         #dszrec01#00 = #dszrec01#00 +. nBrutoMoneda2;
     |FINSI;

     |SI enTiva = 1;
         #tmp00010#16 = #tmp00010#16 +. nBrutoMoneda1;
         nNume        = #tmp00010#16;
         #tmp00010#17 = #tmp00010#16 % enIva;
         |SI #tmp00010#36 = "S";
             #tmp00010#18 = nNume % enRec;
         |FINSI;

         #dszrec01#1  = #dszrec01#1  +. nBrutoMoneda2;
         nNume        = #dszrec01#1;
         #dszrec01#2  = #dszrec01#1 % enIva;
         |SI #tmp00010#36 = "S";
             #dszrec01#3 = nNume % enRec;
         |FINSI;
     |FINSI;

     |SI enTiva = 2;
         #tmp00010#19 = #tmp00010#19 +. nBrutoMoneda1;
         nNume        = #tmp00010#19;
         #tmp00010#20 = #tmp00010#19 % enIva;
         |SI #tmp00010#36 = "S";
             #tmp00010#21 = nNume % enRec;
         |FINSI;

         #dszrec01#4  = #dszrec01#4  +. nBrutoMoneda2;
         nNume        = #dszrec01#4;
         #dszrec01#5  = #dszrec01#4 % enIva;
         |SI #tmp00010#36 = "S";
             #dszrec01#6 = nNume % enRec;
         |FINSI;
     |FINSI;

     |SI enTiva = 3;
         #tmp00010#22 = #tmp00010#22 +. nBrutoMoneda1;
         nNume        = #tmp00010#22;
         #tmp00010#23 = #tmp00010#22 % enIva;
         |SI #tmp00010#36 = "S";
             #tmp00010#54 = nNume % enRec;
         |FINSI;

         #dszrec01#7  = #dszrec01#7  +. nBrutoMoneda2;
         nNume        = #dszrec01#7;
         #dszrec01#8  = #dszrec01#7 % enIva;
         |SI #tmp00010#36 = "S";
             #dszrec01#9 = nNume % enRec;
         |FINSI;
     |FINSI;

     |SI enTiva = 4;
         #tmp00010#44 = #tmp00010#44 +. nBrutoMoneda1;
         nNume        = #tmp00010#44;
         #tmp00010#45 = #tmp00010#44 % enIva;
         |SI #tmp00010#36 = "S";
             #tmp00010#46 = nNume % enRec;
         |FINSI;

         #dszrec01#10 = #dszrec01#10 +. nBrutoMoneda2;
         nNume        = #dszrec01#10;
         #dszrec01#11 = #dszrec01#10 % enIva;
         |SI #tmp00010#36 = "S";
             #dszrec01#12 = nNume % enRec;
         |FINSI;
     |FINSI;

     |SI enTiva = 5;
         #tmp00010#47 = #tmp00010#47 +. nBrutoMoneda1;
         nNume        = #tmp00010#47;
         #tmp00010#48 = #tmp00010#47 % enIva;
         |SI #tmp00010#36 = "S";
             #tmp00010#49 = nNume % enRec;
         |FINSI;

         #dszrec01#13 = #dszrec01#13 +. nBrutoMoneda2;
         nNume        = #dszrec01#13;
         #dszrec01#14 = #dszrec01#13 % enIva;
         |SI #tmp00010#36 = "S";
             #dszrec01#15 = nNume % enRec;
         |FINSI;
     |FINSI;

|FPRC;

|PROCESO IvaRestoTmp00010;
     eaCli         = #tmp00010#3;

     nBrutoMoneda1 = #tmp00010#11;
     nBrutoMoneda2 = #tmp00010#81;
     enTiva        = #tmp00010#12;
     |HAZ IvasTmp00010;

     nBrutoMoneda1 = #tmp00010#13;
     nBrutoMoneda2 = #tmp00010#82;
     enTiva        = #tmp00010#14;
     |HAZ IvasTmp00010;
|FPRC;

|PROCESO LimCabTmp00010;
     |DDEFECTO #dszrec01;

     #tmp00010#15 = 0;
     #tmp00010#37 = 0;
     #tmp00010#16 = 0;
     #tmp00010#17 = 0;
     #tmp00010#18 = 0;
     #tmp00010#19 = 0;
     #tmp00010#20 = 0;
     #tmp00010#21 = 0;
     #tmp00010#22 = 0;
     #tmp00010#23 = 0;
     #tmp00010#24 = 0;
     #tmp00010#25 = 0;
     #tmp00010#26 = 0;
     #tmp00010#28 = 0;
     #tmp00010#37 = 0;
     #tmp00010#44 = 0;
     #tmp00010#45 = 0;
     #tmp00010#46 = 0;
     #tmp00010#46 = 0;
     #tmp00010#48 = 0;
     #tmp00010#49 = 0;
     #tmp00010#54 = 0;
     #tmp00010#67 = 0;
     #tmp00010#75 = 0;
     #tmp00010#76 = 0;
     #tmp00010#94 = 0;
     #tmp00010#96 = 0;
     |HAZ IvaRestoTmp00010;
|FPRC;

|PROCESO CalCabTmp00010;
     ||----------------------------  Margen

     |SI #tmp00071#9 ] 0;
          nError = 1;
     |SINO;
          nError = -1;
          #tmp00071#9   = -#tmp00071#9;
          #tmp00071#37  = -#tmp00071#37;
     |FINSI;

     nCanti = #tmp00071#9 < #tmp00010#5;
     nCanti = nCanti < #tmp00010#32;
     |SI #agifa142#115 = "S";
          nCanti = nCanti < #tmp00010#7;
     |FINSI;
     nCanti = nCanti * nError;
     |SI #agifa019#194 = 1;
         nMargen = #tmp00071#5 * #agifa019#9;
     |SINO;
         nMargen = #tmp00071#48 * #agifa019#9;
     |FINSI;
     nMargen      = nCanti - nMargen;
     #tmp00010#37 = #tmp00010#37 + nMargen;
     ||----------------------------

     #tmp00071#9  = #tmp00071#9  * nError;
     #tmp00071#37 = #tmp00071#37 * nError;

     #tmp00010#15 = #tmp00010#15 +. #tmp00071#9;
     #tmp00010#75 = #tmp00010#75 +. #tmp00071#37;
     #tmp00010#94 = #tmp00010#94 +. #tmp00071#62;

     nBrutoMoneda1 = (#tmp00071#9  < #tmp00010#5) ! nDeci_IVA;
     nBrutoMoneda1 = (nBrutoMoneda1  < #tmp00010#32) ! nDeci_IVA;
     nBrutoMoneda1 = (nBrutoMoneda1  < #tmp00010#7) ! nDeci_IVA;

     nBrutoMoneda2 = (#tmp00071#37 < #tmp00010#5) ! nDeci_IVADiv;
     nBrutoMoneda2 = (nBrutoMoneda2 < #tmp00010#32) ! nDeci_IVADiv;
     nBrutoMoneda2 = (nBrutoMoneda2 < #tmp00010#7) ! nDeci_IVADiv;

     eaCli         = #tmp00010#3;
     enTiva        = #tmp00071#11;
     |HAZ IvasTmp00010;

     |SI #agifa071#63 = -1; ||Linea canon
          nCanon = #agifa071#9 + (#agifa071#9 % enIva);
          |SI #tmp00010#36 = "S";
               nCanon = nCanon + (#agifa071#9 % enRec);
          |FINSI;
          #tmp00010#94 =  #agifa010#94 +. nCanon;
     |FINSI;

     nNume = nBrutoMoneda1 % #tmp00071#10;
     #tmp00010#26 = #tmp00010#26 +. nNume;
     |SI #tmp00010#15 > 0;
         nError = 1;
     |SINO;
         nError = -1;
         #tmp00010#15 = -#tmp00010#15;
         #tmp00010#75 = -#tmp00010#75;
     |FINSI;

     #tmp00010#25 = #tmp00010#15 < #tmp00010#5;
     #tmp00010#25 = #tmp00010#25 < #tmp00010#32;
     #tmp00010#25 = #tmp00010#25 < #tmp00010#7;

     #tmp00010#25 = #tmp00010#25 * nError;
     #tmp00010#15 = #tmp00010#15 * nError;
     #tmp00010#25 = #tmp00010#15 - #tmp00010#25;
     #tmp00010#24 = #tmp00010#17 + #tmp00010#18 + #tmp00010#20 + #tmp00010#21;
     #tmp00010#24 = #tmp00010#24 + #tmp00010#23 + #tmp00010#54 + #tmp00010#45;
     #tmp00010#24 = #tmp00010#24 + #tmp00010#46 + #tmp00010#48 + #tmp00010#49;

     #dszrec01#17 = #tmp00010#75 < #tmp00010#5;
     #dszrec01#17 = #dszrec01#17 < #tmp00010#32;
     #dszrec01#17 = #dszrec01#17 < #tmp00010#7;

     #dszrec01#17 = #dszrec01#17 * nError;
     #tmp00010#75 = #tmp00010#75 * nError;
     #dszrec01#17 = #tmp00010#75 - #dszrec01#17;
     #dszrec01#16 = #dszrec01#02 + #dszrec01#03 + #dszrec01#05 + #dszrec01#06;
     #dszrec01#16 = #dszrec01#16 + #dszrec01#08 + #dszrec01#09 + #dszrec01#11;
     #dszrec01#16 = #dszrec01#16 + #dszrec01#12 + #dszrec01#14 + #dszrec01#15;

     #tmp00010#67 =  (#tmp00010#15 - #tmp00010#25);
     #tmp00010#67 =  #tmp00010#67 + (#tmp00010#11 + #tmp00010#13 + #tmp00010#24);

     #tmp00010#76 =  (#tmp00010#75 - #dszrec01#17);
     #tmp00010#76 =  #tmp00010#76 + (#tmp00010#81 + #tmp00010#82 + #dszrec01#16);

     |SI #tmp00010#70 = "D";
         #tmp00010#77 = #tmp00010#75;
         #tmp00010#78 = #tmp00010#76;
         #tmp00010#79 = #tmp00010#15;
         #tmp00010#80 = #tmp00010#67;
     |SINO;
         #tmp00010#77 = #tmp00010#15;
         #tmp00010#78 = #tmp00010#67;
         #tmp00010#79 = #tmp00010#75;
         #tmp00010#80 = #tmp00010#76;
     |FINSI;
|FPRC;

|| ----------------------  FIN TMP00010 ---------------------------------

|PROCESO TotalLin71;
     |ABRE #19;
     #19#0 = #71#2;
     |LEE 000#19=;
     |SI FSalida !0; |DDEFECTO #19; |FINSI;
     |CIERRA #19;

     nPreTon = 1;
     |HAZ EsVigor;
     |SI FSalida = 0;
          aAlfa = #19#110; |QBF aAlfa;   || Alfanumerico1
          aAlfa = aAlfa > "";
          |SI aAlfa = "S"; nPreTon = 1000; |FINSI;
     |FINSI;

     #71#62 = #71#5 * #19#208; ||Punto Verde

     |SI #10#70 = "D";                    || Si mon. de trabajo es divisa ...
          #71#6  = #71#36 / #10#69 * #10#74; || Recalculo precio en mon. base
          #71#38 = #71#6;                  || Precio visual, en mon. base
     |SINO;                              || Si mon. de trabajo es mon. base
          #71#36 = #71#6 / #10#74 * #10#69;  || Recalculo precio en divisa
          #71#38 = #71#36;                 || Precio visual, en divisa
     |FINSI;

     |SI #19#194 = 2;
         #71#7    = #71#48 * #71#6 / nPreTon;
         nImpDiv = (#71#48 * #71#36 / nPreTon) ! nDeci_IVADiv;
     |SINO;
          #71#7    = #71#5 * #71#6 / nPreTon;
          nImpDiv = (#71#5 * #71#36 / nPreTon) ! nDeci_IVADiv;
     |FINSI;

     || nMult corrige el error del redondeo para negativos
     |SI #71#7 < 0; nMult = -1; |SINO; nMult = 1; |FINSI;

     #71#7    = #71#7    * nMult;
     nImpDiv = nImpDiv * nMult;

     |HAZ EsMalpesa;
     |SI FSalida = 0;
          #71#9 = #71#7;
          #71#37 = nImpDiv;
     |SINO;
          #71#9  = (((#71#7 < #71#8) < #71#33));
          #71#37 = (((nImpDiv < #71#8) < #71#33));
     |FINSI;

     #71#7  = #71#7 * nMult;
     #71#9  = #71#9 * nMult;
     #71#37 = #71#37 * nMult;
     ||컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴

     |SI #10#70 = "D";     || Si la moneda de trabajo es la divisa ...
          #71#39 = #71#9;   || el campo visualiz. es el importe en moneda base
     |SINO;               || Si la moneda de trabajo es la moneda base ...
          #71#39 = #71#37;  || el campo visualiz. es el importe en divisa
     |FINSI;
|FPRC;
----------------------------------------------------------------------
     Calculo igual al CalCabAgifa010, solo cambia el +. por enForma
----------------------------------------------------------------------
|PROCESO CalCabAgifa010_2;
     |SI #agifa071#9 ] 0;
          nError = 1;
     |SINO;
          nError = -1;
     |FINSI;
     #agifa071#9   = #agifa071#9 * nError;
     #agifa071#37  = #agifa071#37 * nError;

     nCanti = #agifa071#9 < #agifa010#5;
     nCanti = nCanti < #agifa010#32;
     |SI #agifa142#115 = "S";
          nCanti = nCanti < #agifa010#7;
     |FINSI;
     nCanti = nCanti * nError;
     |SI #agifa019#194 = 1;
         nMargen = #agifa071#5 * #agifa019#9;
     |SINO;
         nMargen = #agifa071#48 * #agifa019#9;
     |FINSI;
     nMargen = nCanti - nMargen;
     #agifa010#37 = #agifa010#37 + nMargen;

     #agifa071#9  = #agifa071#9  * nError;
     #agifa071#37 = #agifa071#37 * nError;
     ||----------------------------

     #agifa010#15 = #agifa010#15 + (#agifa071#9 * enForma);
     #agifa010#75 = #agifa010#75 + (#agifa071#37 * enForma);
     #agifa010#94 = #agifa010#94 + (#agifa071#62 * enForma);

     nBrutoMoneda1 = #agifa071#9;
     nImporDescue1 = (nBrutoMoneda1 % #agifa010#5) ! nDeci_IVA;
     nBrutoMoneda1 = nBrutoMoneda1 - nImporDescue1;
     nImporDescue2 = (nBrutoMoneda1 % #agifa010#32) ! nDeci_IVA;
     nBrutoMoneda1 = nBrutoMoneda1 - nImporDescue2;
     nImporDescue3 = (nBrutoMoneda1 % #agifa010#7) ! nDeci_IVA;
     nBrutoMoneda1 = nBrutoMoneda1 - nImporDescue3;
     nDescuMoneda1 = nImporDescue1 + nImporDescue2 + nImporDescue3;

     nBrutoMoneda2 = #agifa071#37;
     nImporDescue1 = (nBrutoMoneda2 % #agifa010#5) ! nDeci_IVA;
     nBrutoMoneda2 = nBrutoMoneda2 - nImporDescue1;
     nImporDescue2 = (nBrutoMoneda2 % #agifa010#32) ! nDeci_IVA;
     nBrutoMoneda2 = nBrutoMoneda2 - nImporDescue2;
     nImporDescue3 = (nBrutoMoneda2 % #agifa010#7) ! nDeci_IVA;
     nBrutoMoneda2 = nBrutoMoneda2 - nImporDescue3;
     nDescuMoneda2 = nImporDescue1 + nImporDescue2 + nImporDescue3;
/*
     nBrutoMoneda1 = (#agifa071#9  < #agifa010#5) ! nDeci_IVA;
     nBrutoMoneda1 = (nBrutoMoneda1 < #agifa010#32) ! nDeci_IVA;
     nBrutoMoneda1 = (nBrutoMoneda1 < #agifa010#7) ! nDeci_IVA;

     nBrutoMoneda2 = (#agifa071#37 < #agifa010#5) ! nDeci_IVADiv;
     nBrutoMoneda2 = (nBrutoMoneda2 < #agifa010#32) ! nDeci_IVADiv;
     nBrutoMoneda2 = (nBrutoMoneda2 < #agifa010#7) ! nDeci_IVADiv;
*/
     |HAZ BseVerdeBase1;

     eaCli         = #agifa010#3;
     enTiva        = #agifa071#11;
     |HAZ IvasAgifa010_2;


     |SI #agifa071#63 = -1; ||Linea canon
          nCanon = #agifa071#9 + (#agifa071#9 % enIva);
          |SI #agifa010#36 = "S";
               nCanon = nCanon + (#agifa071#9 % enRec);
          |FINSI;
          #agifa010#94 =  #agifa010#94 + (nCanon * enForma);
     |FINSI;
     ||----------------------------
     |HAZ EsMalpesa;
     |SI FSalida = 0;
          nNume = 0;
          |HAZ ComiMalpesa;
     |SINO;
          nNume = nBrutoMoneda1 % #agifa071#10;
     |FINSI;
     #agifa010#26 = #agifa010#26 + (nNume * enForma);
     ||----------------------------
     |HAZ EsOrts;
     |SI FSalida = 0;
          nSwOrts = 1; |HAZ OrtsComiAlbTota;
     |FINSI;

     #agifa010#25 = #agifa010#25 + (nDescuMoneda1 * enForma);
/*
     |SI #agifa010#15 > 0;
         nError = 1;
     |SINO;
         nError = -1;
         #agifa010#15 = -#agifa010#15;
         #agifa010#75 = -#agifa010#75;
     |FINSI;

     #agifa010#25 = #agifa010#15 < #agifa010#5;
     #agifa010#25 = #agifa010#25 < #agifa010#32;
     #agifa010#25 = #agifa010#25 < #agifa010#7;

     #agifa010#25 = #agifa010#25 * nError;
     #agifa010#15 = #agifa010#15 * nError;
     #agifa010#25 = #agifa010#15 - #agifa010#25;
*/

     #agifa010#24 = #agifa010#17 + #agifa010#18 + #agifa010#20 + #agifa010#21 + #agifa010#23 + #agifa010#54 + #agifa010#45 + #agifa010#46 + #agifa010#48 + #agifa010#49;

     #dszrec01#17 = #dszrec01#17 + (nDescuMoneda2 * enForma);

/*
     #dszrec01#17 = #agifa010#75 < #agifa010#5;
     #dszrec01#17 = #dszrec01#17 < #agifa010#32;
     #dszrec01#17 = #dszrec01#17 < #agifa010#7;
     #dszrec01#17 = #dszrec01#17 * nError;

     #agifa010#75 = #agifa010#75 * nError;
     #dszrec01#17 = #agifa010#75 - #dszrec01#17;
*/

     #dszrec01#16 = #dszrec01#02 + #dszrec01#03 + #dszrec01#05 + #dszrec01#06 + #dszrec01#08 + #dszrec01#09 + #dszrec01#11 + #dszrec01#12 + #dszrec01#14 + #dszrec01#15;

     #agifa010#67 =  (#agifa010#15 - #agifa010#25) + (#agifa010#11 + #agifa010#13 + #agifa010#24);
     #agifa010#67 = #agifa010#67 + nTotPVerde;  || modulo

     #agifa010#76 =  (#agifa010#75 - #dszrec01#17) + (#agifa010#81 + #agifa010#82 + #dszrec01#16);
     #agifa010#76 = #agifa010#76 + nTotPVerde;  || modulo

     |SI #agifa010#70 = "D";
         #agifa010#77 = #agifa010#75;
         #agifa010#78 = #agifa010#76;
         #agifa010#79 = #agifa010#15;
         #agifa010#80 = #agifa010#67;
     |SINO;
         #agifa010#77 = #agifa010#15;
         #agifa010#78 = #agifa010#67;
         #agifa010#79 = #agifa010#75;
         #agifa010#80 = #agifa010#76;
     |FINSI;


     |DDEFECTO #agifa024;
     #agifa024#0 = #agifa010#3;
     |LEE 000#agifa024.=;
     |SI FSalida = 102;
          |ABRE #agifa024;
          #agifa024#0 = #agifa010#3;
          |LEE 000#agifa024.=;
          |CIERRA #agifa024;
     |FINSI;
     aCampo207 = #agifa024#207;

     nBasRete = #agifa010#28 + #agifa010#16 + #agifa010#19 + #agifa010#22 + #agifa010#44 + #agifa010#47;
     |SI aCampo207 = "N";
          nBasRete = nBasRete + #agifa010#17 + #agifa010#20 + #agifa010#23 + #agifa010#45 + #agifa010#48;
          nBasRete = nBasRete + #agifa010#18 + #agifa010#21 + #agifa010#54 + #agifa010#46 + #agifa010#49;
     |FINSI;
     #dszrec01#19 = nBasRete;
     #dszrec01#20 = nBasRete / #agifa010#69 * #agifa010#74
|FPRC;

|PROCESO IvasAgifa010_2;      ||igual que IvasAgifa010 pero con enForma
     |HAZ IVACli;

     |SI enTiva = 0;
         #agifa010#28 = #agifa010#28 + (nBrutoMoneda1 * enForma);
         #dszrec01#00 = #dszrec01#00 + (nBrutoMoneda2 * enForma);
     |FINSI;

     |SI enTiva = 1;
         #agifa010#16 = #agifa010#16 + (nBrutoMoneda1 * enForma);
         nNume        = #agifa010#16;
         #agifa010#17 = #agifa010#16 % enIva;
         |SI #agifa010#36 = "S";
             #agifa010#18 = nNume % enRec;
         |FINSI;

         #dszrec01#1  = #dszrec01#1  + (nBrutoMoneda2 * enForma);
         nNume        = #dszrec01#1;
         #dszrec01#2  = #dszrec01#1 % enIva;
         |SI #agifa010#36 = "S";
             #dszrec01#3 = nNume % enRec;
         |FINSI;
     |FINSI;

     |SI enTiva = 2;
         #agifa010#19 = #agifa010#19 + (nBrutoMoneda1 * enForma);
         nNume        = #agifa010#19;
         #agifa010#20 = #agifa010#19 % enIva;
         |SI #agifa010#36 = "S";
             #agifa010#21 = nNume % enRec;
         |FINSI;

         #dszrec01#4  = #dszrec01#4  + (nBrutoMoneda2 * enForma);
         nNume        = #dszrec01#4;
         #dszrec01#5  = #dszrec01#4 % enIva;
         |SI #agifa010#36 = "S";
             #dszrec01#6 = nNume % enRec;
         |FINSI;
     |FINSI;

     |SI enTiva = 3;
         #agifa010#22 = #agifa010#22 + (nBrutoMoneda1 * enForma);
         nNume        = #agifa010#22;
         #agifa010#23 = #agifa010#22 % enIva;
         |SI #agifa010#36 = "S";
             #agifa010#54 = nNume % enRec;
         |FINSI;

         #dszrec01#7  = #dszrec01#7  + (nBrutoMoneda2 * enForma);
         nNume        = #dszrec01#7;
         #dszrec01#8  = #dszrec01#7 % enIva;
         |SI #agifa010#36 = "S";
             #dszrec01#9 = nNume % enRec;
         |FINSI;
     |FINSI;

     |SI enTiva = 4;
         #agifa010#44 = #agifa010#44 + (nBrutoMoneda1 * enForma);
         nNume        = #agifa010#44;
         #agifa010#45 = #agifa010#44 % enIva;
         |SI #agifa010#36 = "S";
             #agifa010#46 = nNume % enRec;
         |FINSI;

         #dszrec01#10 = #dszrec01#10 + (nBrutoMoneda2 * enForma);
         nNume        = #dszrec01#10;
         #dszrec01#11 = #dszrec01#10 % enIva;
         |SI #agifa010#36 = "S";
             #dszrec01#12 = nNume % enRec;
         |FINSI;
     |FINSI;

     |SI enTiva = 5;
         #agifa010#47 = #agifa010#47 + (nBrutoMoneda1 * enForma);
         nNume        = #agifa010#47;
         #agifa010#48 = #agifa010#47 % enIva;
         |SI #agifa010#36 = "S";
             #agifa010#49 = nNume % enRec;
         |FINSI;

         #dszrec01#13 = #dszrec01#13 + (nBrutoMoneda2 * enForma);
         nNume        = #dszrec01#13;
         #dszrec01#14 = #dszrec01#13 % enIva;
         |SI #agifa010#36 = "S";
             #dszrec01#15 = nNume % enRec;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO OrtsComiAlbTota;
     nComi = 0;
     |DDEF aPath;
     aAlfa = aPath + "ortsm022";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          #referen@#0 = "A";
          #referen@#1 = #agifa071#29;
          #referen@#2 = #agifa071#0;
          #referen@#3 = #agifa071#1;
          |LEE 000#referen@.=;
          |SI FSalida = 0;
               nComi = #referen@#7;
          |FINSI;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |SINO;
          |MENAV "0000Error al cargar 'ortsm022'...";
     |FINSI;

     aAlfa = aPath + "ortsm021";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          #referen@#0 = "A";
          #referen@#1 = #agifa010#52;
          #referen@#2 = #agifa010#0;
          |LEE 000#referen@.=;
          |SI FSalida = 0;
               nNume = nBrutoMoneda1 % nComi;
               |SI nSwOrts = 0;
                    #referen@#6 = (#referen@#6 +. nNume) ! nDeci_BaseMx;
               |SINO;
                    #referen@#6 = (#referen@#6 + (nNume * enForma)) ! nDeci_BaseMx;
               |FINSI;
               |GRABA 020#referen@.a;
          |FINSI;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |SINO;
          |MENAV "0000Error al cargar 'ortsm021'...";
     |FINSI;
|FPRC;

|PROCESO OrtsComiAlbCero;
     aAlfa = aPath + "ortsm021";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          #referen@#0 = "A";
          #referen@#1 = #agifa010#52;
          #referen@#2 = #agifa010#0;
          |LEE 000#referen@.=;
          |SI FSalida = 0;
               #referen@#6 = 0;
               |GRABA 020#referen@.a;
          |FINSI;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |SINO;
          |MENAV "0000Error al cargar 'ortsm021'...";
     |FINSI;
|FPRC;
