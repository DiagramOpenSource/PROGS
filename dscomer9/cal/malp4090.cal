          || Comisiones

|FICHEROS;
     agifa019 #2;
     malpe136 #3;  ||comision repre
     agifa128 #4;  ||Comi clientes
     malpe209 #209;
|FIN;

|VARIABLES;
     &eaTieneComi = "";
     &enComision1 = 0;
     &enComision2 = 0;
     &eaArticulo = "";
     &eaTipoCli = "";
     &efFecha = @;
     &eaRemanente = "";
     &enDto = 0;
     &eaTipoComi = "";

     descu = 0;
     comi1 = 0;
     comi2 = 0;
     comi3 = 0;
     Comi3 = 0;
     aAlfa = "";
     menor = 0;
     menor_2 = 0;
     comi3_2 = 0;
     pc = 0;
     pcr = 0;
     tf = 0;
     nNume = 0;
     Comi3_2 = 0;
     Menor = 0;
|FIN;

|PROCESO BusComi;
     |SI eaTieneComi = "N";
          enComision1 = 0;
          enComision2 = 0;
          |ACABA;
     |FINSI;

     |ABRE #2;
     #2#0 = eaArticulo;
     |LEE 020#2=;
     |CIERRA #2;

     |DDEFECTO #4;
     |ABRE #4;
     #4#0 = eaTipoCli;
     |LEE 000#4=;
     |CIERRA #4;

     descu = enDto;
     comi1 = #2#31;
     comi2 = #4#1;
     comi3 = 0;
     Comi3 = 0;

     aAlfa = efFecha; aAlfa = aAlfa % -104;

     |SI #2#181 = "N";
          |HAZ ComiLadrillo4;
     |SINO;
          |HAZ ComiMortero4;
     |FINSI;
|FPRC;

|PROCESO ComiLadrillo4;
     |ABRE #3;
     #3#0 = eaTipoComi;
     #3#62 = aAlfa;
     #3#63 = eaRemanente;
     |LEE 000#3=;
     |SI FSalida = 0;
          menor = 100;
          menor_2 = 0;
          comi3_2 = 0;
          |PARA pc = 1;|SI pc < 40;|HACIENDO pc = pc + 2;
               pcr = pc + 1;
               nNume = (pc-1)/2+42;
               |SI #3pc ! 0;|Y #3pcr ! 0;
                    tf = #3pc;
                    |SI tf ] descu;|Y tf < menor;
                         menor = tf;
                         comi3 = #3pcr;
                         Comi3 = #3nNume;
                    |SINO;
                         |SI menor_2 = 0; |Y comi3_2 = 0;
                              menor_2 = tf;
                              comi3_2 = #3pcr;
                              Comi3_2 = #3nNume;
                         |FINSI;
                    |FINSI;
               |SINO;
                    |SI menor_2 = 0; |Y comi3_2 = 0;
                         tf = #3pc;
                         menor_2 = tf;
                         comi3_2 = #3pcr;
                         Comi3_2 = #3nNume;
                    |FINSI;
                    pc = 40;
               |FINSI;
          |SIGUE;
          comi3 = comi3_2 - ((descu-menor_2)*((comi3_2-comi3)/(menor-menor_2)));
          Comi3 = Comi3_2 - ((descu-menor_2)*((Comi3_2-Comi3)/(menor-menor_2)));
     |FINSI;
     |CIERRA #3;

     menor = 100;
     |SI comi1 > 0;
          menor = comi1;
          Menor = comi1;
     |FINSI;
     |SI comi2 > 0;|Y comi2 < menor;
          menor = comi2;
          Menor = comi2;
     |FINSI;
     |SI comi3 > 0;|Y comi3 < menor;
          menor = comi3;
          Menor = Comi3;
     |FINSI;
     |SI menor = 100;
          menor = 0;
          Menor = 0;
     |FINSI;
     enComision1 = menor;
     enComision2 = Menor;
|FPRC;

|PROCESO ComiMortero4;
     |ABRE #209;
     #209#0 = eaTipoComi;
     #209#62 = aAlfa;
     #209#63 = eaRemanente;
     |LEE 000#209=;
     |SI FSalida = 0;
          menor = 100;
          menor_2 = 0;
          comi3_2 = 0;
          |PARA pc = 1;|SI pc < 40;|HACIENDO pc = pc + 2;
               pcr = pc + 1;
               nNume = (pc-1)/2+42;
               |SI #209pc ! 0;|Y #209pcr ! 0;
                    tf = #209pc;
                    |SI tf ] descu;|Y tf < menor;
                         menor = tf;
                         comi3 = #209pcr;
                         Comi3 = #209nNume;
                    |SINO;
                         |SI menor_2 = 0; |Y comi3_2 = 0;
                              menor_2 = tf;
                              comi3_2 = #209pcr;
                              Comi3_2 = #209nNume;
                         |FINSI;
                    |FINSI;
               |SINO;
                    |SI menor_2 = 0; |Y comi3_2 = 0;
                         tf = #209pc;
                         menor_2 = tf;
                         comi3_2 = #209pcr;
                         Comi3_2 = #209nNume;
                    |FINSI;
                    pc = 40;
               |FINSI;
          |SIGUE;
          comi3 = comi3_2 - ((descu-menor_2)*((comi3_2-comi3)/(menor-menor_2)));
          Comi3 = Comi3_2 - ((descu-menor_2)*((Comi3_2-Comi3)/(menor-menor_2)));
     |FINSI;
     |CIERRA #209;

     menor = 100;
     |SI comi1 > 0;
          menor = comi1;
          Menor = comi1;
     |FINSI;
     |SI comi2 > 0;|Y comi2 < menor;
          menor = comi2;
          Menor = comi2;
     |FINSI;
     |SI comi3 > 0;|Y comi3 < menor;
          menor = comi3;
          Menor = Comi3;
     |FINSI;
     |SI menor = 100;
          menor = 0;
          Menor = 0;
     |FINSI;
     enComision1 = menor;
     enComision2 = Menor;
|FPRC;
