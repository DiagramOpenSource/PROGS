|FICHEROS;
     agifa029 #29;
     agifa017 #17;
     agifa019 #19;
     agifa724 #724;
     dsz99934 #123,MANTE;
     referen@;
     referen2@;
|FIN;

|VARIABLES;
     &Tempo = "";
     &eaArticulo= "";
     &enAlmaObra = 0;
     &enAlmaCompras = 0;
     &enAlmaDepo = 0;
     aAlfa = "";
     aDef = "";
     aCta64 = "";
     aCta65 = "";
     nAlmacen = 0;
     aMasAlma = "";
|FIN;

|PROCESO NoPregunta; |TIPO 12;
|FPRC;

|PROCESO Carga1Def;
     |DDEF aAlfa;
     aAlfa = aAlfa + aDef;
     |CARGA_DEF aDef, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          FSalida = 0;
     |FINSI;
|FPRC;

|PROCESO Descarga1Def;
     |CIERRA #referen@;
     |DESCARGA_DEF #referen@;
|FPRC;

|PROCESO Carga2Def;
     |DDEF aAlfa;
     aAlfa = aAlfa + aDef;
     |CARGA_DEF aDef, referen2@;
     |SI FSalida = 0;
          |ABRE #referen2@;
          FSalida = 0;
     |FINSI;
|FPRC;

|PROCESO Descarga2Def;
     |CIERRA #referen2@;
     |DESCARGA_DEF #referen2@;
|FPRC;

|PROCESO ObraAltaAlm;
     aDef = "goparame";
     |HAZ Carga1Def;
     |SI FSalida = 0;
          |LEE 0000#referen@.p;
          aCta64 = #referen@#64;
          aCta65 = #referen@#65;
          |HAZ Descarga1Def;
     |FINSI;

     |ABRE #29;
     #29#0 = enAlmaCompras;
     |LEE 000#29=;
     |CIERRA #29;

     |ABRE #17;
     |DDEFECTO #17;
     #17#0 = #19#0;
     #17#1 = #29#0;
     |LEE 000#17=;
     |SI FSalida ! 0;
          #17#40 = #19#1;
          #17#41 = #29#1;
          |GRABA 020#17n;
     |FINSI;
     |CIERRA #17;

     |ABRE #724;
     |DDEFECTO #724;
     #724#0 = #19#0;
     |LEE 000#724=;
     |SI FSalida ! 0;
          #724#1 = #19#1;
          #724#2 = aCta65;
          #724#3 = aCta64;
          |GRABA 020#724n;
     |FINSI;
     |CIERRA #724;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO PideAlmaCompra;
     aDef = "goparame";
     |HAZ Carga1Def;
     |SI FSalida = 0;
          |LEE 0000#referen@.p;
          enAlmaCompras = #referen@#22;
          enAlmaDepo = #referen@#51;
          aMasAlma = #referen@#76;
          |HAZ Descarga1Def;
     |FINSI;

     |ABRE #29;
     #29#0 = enAlmaCompras;
     |LEE 000#29=;
     |CIERRA #29;

     #123#0 = #29#0;
     #123#1 = #29#1;
     |SI aMasAlma = "S";
          #123#0 = enAlmaCompras;

          aDef = "goenvm02";
          |HAZ Carga1Def;
          |SI FSalida = 0;
               aAlfa = Usuario % 810;
               #referen@#0 = aAlfa;
               |LEE 000#referen@.=;
               |SI FSalida = 0;
                    #123#0 = #referen@#3;
               |FINSI;
               |CIERRA #referen@;
               |HAZ Descarga1Def;
          |FINSI;
          |CLS;
          |PINPA #0#123;
          |PINDA #0#123;

          aDef = "goparam5";
          |HAZ Carga1Def;
          |SI FSalida = 0;
            |ET OtroAlmaCom;
               |PARA FSalida = 1; |SI FSalida ! 0; |HACIENDO;
                    |ENDATOS #2#123;
               |SIGUE;
               #referen@#0 = #123#0;
               |LEE 000#referen@.=;
               |SI FSalida ! 0;
                    |MENAV "0000No existe Almacen en parametros construccion";
                    |VETE OtroAlmaCom;
               |FINSI;
               enAlmaDepo = #referen@#2;
               enAlmaCompras = #referen@#0;
               |HAZ Descarga1Def;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO AlmCentral;
     |DDEFECTO #17;
     #17#0 = eaArticulo;
     #17#1 = #referen@#0;
     |LEE 000#17=;
     #referen2@#0 = #17#0;
     #referen2@#1 = #17#1;
     #referen2@#2 = #17#41;
     #referen2@#3 = #17#5;
     #referen2@#4 = #17#39;
     |GRABA 020#referen2@.n;
|FPRC;

|DEFBUCLE AlmCentral;
     #referen@#1001;
     ;
     00000;
     99999;
     ;
     NULL, AlmCentral;
|FIN;

|PROCESO PideAlmaCompra2;
     aDef = "goparam5";
     |HAZ Carga1Def;
     |SI FSalida = 0;
          aDef = "guerw048";
          |HAZ Carga2Def;
          |SI FSalida = 0;
               |HAZ CreaTempo;
               |NOME_DAT #referen2@#Tempo#; |DELINDEX #referen2@;
               |ABRE #referen2@;
               |ABRE #17;
               |BUCLE AlmCentral;
               |CIERRA #17;
               #referen2@#0 = eaArticulo;
               #referen2@#1 = enAlmaCompras;
               |LEE 000#referen@.];
               |CONSULTA_CLAVE #1#referen2@;
               |SI FSalida = 0;
                    enAlmaCompras = #referen2@#1;
               |FINSI;
               |CIERRA #referen2@;
               |DELINDEX #referen2@; |HAZ BoraTempo;
               |HAZ Descarga2Def;
          |FINSI;
          |HAZ Descarga1Def;
     |FINSI;
|FPRC;

|PROCESO PideAlmaObra;
     |CLS;
     |PINPA #0#123;
     |ATRI I;
     |PINTA 0718,"Almacen de la Obra:";
     |ATRI 0;
     |PINDA #0#123;
     aDef = "goparam5";
     |HAZ Carga1Def;
     |SI FSalida = 0;
       |ET OtroAlmaObra;
          |PARA FSalida = 1; |SI FSalida ! 0; |HACIENDO;
               |ENDATOS #2#123;
          |SIGUE;
          #referen@#0 = #123#0;
          |LEE 000#referen@.=;
          |SI FSalida = 0;
               |AVISO;
               |MENAV "0000ATENCION. Almacen definido como Central...";
               ||VETE OtroAlmaObra;
          |FINSI;
          enAlmaObra = #123#0;
          |HAZ Descarga1Def;
     |FINSI;
|FPRC;
