|FICHEROS;
     referen@ #1;
     agifa154 #154;
     dscam003@;
     dscam044@;
     dscam045@;
|FINS;

|VARIABLES;
     &eaSer = "";
     &enNum = 0;
     &eaCli = "";
     &eaDes = "";
     &eaTipo = "";

     &eaCliOrg = "";
     &eaCliDes = "";
     &CambDesc = "";
     &eaNom = "";
     aAlfa = "";
     aFic = "";
     aEmp = "";
     nEmpresa = 0;
     aBase = "";
     aCta = "";
|FIN;

|PROCESO con00655;
     |SI #1#1 = eaCliOrg; #1#1 = eaCliDes; |FINSI;
     |SI #1#2 = eaCliOrg; #1#2 = eaCliDes; |FINSI;
     |SI #1#3 = eaCliOrg; #1#3 = eaCliDes; |FINSI;
     |GRABA 020#1a;
     |LIBERA #1;
|FPRC;

|DEFBUCLE con00655;
     #1#1001;
     ;
     "                         ";
     "zzzzzzzzzzzzzzzzzzzzzzzzz";
     be;
     NULL, con00655;
|FIN;

|PROCESO con00671;
     |SI #1#1 = eaCliOrg; #1#1 = eaCliDes; |FINSI;
     |SI #1#2 = eaCliOrg; #1#2 = eaCliDes; |FINSI;
     |GRABA 020#1a;
     |LIBERA #1;
|FPRC;

|DEFBUCLE con00671;
     #1#1002;
     ;
     "          ", "01.01.0000";
     "zzzzzzzzzz", "31.12.9999";
     be;
     NULL, con00671;
|FIN;

|PROCESO con00623;
     |SI #1#3 = eaCliOrg;
          #1#3 = eaCliDes;
          |SI CambDesc = "S"; #1#4 = eaNom; |FINSI;
          |GRABA 020#1a;
     |FINSI;
     |LIBERA #1;
|FPRC;

|DEFBUCLE con00623;
     #1#1002;
     ;
     "     ", 000001;
     "zzzzz", 999999;
     be;
     NULL, con00623;
|FIN;

|PROCESO conp0625;
     |SI #1#11 = eaCliOrg;
          #1#11 = eaCliDes;
          |SI CambDesc = "S"; #1#19 = eaNom; |FINSI;
          |GRABA 020#1a;
     |FINSI;
     |LIBERA #1;
|FPRC;

|DEFBUCLE conp0625;
     #1#1002;
     ;
     "     ", "      ";
     "zzzzz", "zzzzzz";
     be;
     NULL, conp0625;
|FIN;

|PROCESO con00625;
     |SI #1#11 = eaCliOrg;
          #1#11 = eaCliDes;
          |SI CambDesc = "S"; #1#19 = eaNom; |FINSI;
          |GRABA 020#1a;
     |FINSI;
     |LIBERA #1;
|FPRC;

|DEFBUCLE con00625;
     #1#1002;
     ;
     "     ", "      ";
     "zzzzz", "zzzzzz";
     be;
     NULL, con00625;
|FIN;

|PROCESO con00637;
     |SI #1#3 = eaCliOrg;
          #1#3 = eaCliDes;
          |SI CambDesc = "S"; #1#4 = eaNom; |FINSI;
          |GRABA 020#1a;
     |FINSI;
     |LIBERA #1;
|FPRC;

|DEFBUCLE con00637;
     #1#1002;
     ;
     "     ", 000001;
     "zzzzz", 999999;
     be;
     NULL, con00637;
|FIN;

|PROCESO con00601;
     |SI #1#1 = eaCliOrg;
          #1#1 = eaCliDes;
          |GRABA 020#1a;
     |FINSI;
     |LIBERA #1;
|FPRC;

|DEFBUCLE con00601;
     #1#1001;
     ;
     "          ";
     "zzzzzzzzzz";
     be;
     NULL, con00601;
|FIN;

|PROCESO con00683;
     |ABRE #1;
     |LEE 101#1p;
     |SI FSalida = 0;
          |SI #1#3 = eaCliOrg; #1#3 = eaCliDes; |FINSI;
          |SI #1#4 = eaCliOrg; #1#4 = eaCliDes; |FINSI;
          |SI #1#5 = eaCliOrg; #1#5 = eaCliDes; |FINSI;
          |GRABA 020#1a;
     |FINSI;
     |CIERRA #1;
|FPRC;

|PROCESO con00663;
     |SI #1#3 = eaCliOrg;
          #1#3 = eaCliDes;
          |SI CambDesc = "S"; #1#5 = eaNom; |FINSI;
          |GRABA 020#1a;
     |FINSI;
     |LIBERA #1;
|FPRC;

|DEFBUCLE con00663;
     #1#1002;
     ;
     "     ", 000001;
     "zzzzz", 999999;
     be;
     NULL, con00663;
|FIN;

|PROCESO con00664;
     |SI #1#3 = eaCliOrg;
          #1#3 = eaCliDes;
          |SI CambDesc = "S"; #1#5 = eaNom; |FINSI;
          |GRABA 020#1a;
     |FINSI;
     |LIBERA #1;
|FPRC;

|DEFBUCLE con00664;
     #1#1002;
     ;
     "     ", 000001;
     "zzzzz", 999999;
     be;
     NULL, con00664;
|FIN;

|PROCESO con00670;
     |SI #1#11 = eaCliOrg;
          #1#11 = eaCliDes;
          |SI CambDesc = "S"; #1#19 = eaNom; |FINSI;
          |GRABA 020#1a;
     |FINSI;
     |LIBERA #1;
|FPRC;

|DEFBUCLE con00670;
     #1#1002;
     ;
     "          ", "01.01.0000";
     "zzzzzzzzzz", "31.12.9999";
     be;
     NULL, con00670;
|FIN;

|PROCESO CargaDef;
     aAlfa = "0000Procesando fichero:" + aFic;
     |MENSA aAlfa;

     |DDEF aAlfa;
     aAlfa = aAlfa + aFic;
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida ! 0;
          aAlfa = "0000ERROR al Carga: " + aAlfa;
          |MENAV aAlfa;
     |FINSI;
|FPRC;

|PROCESO TallerCamCli;
     aFic = "con00655"; |HAZ CargaDef;
     |SI FSalida = 0;
          |BUCLE con00655;
          |DESCARGA_DEF #referen@;
     |FINSI;
     aFic = "con00671"; |HAZ CargaDef;
     |SI FSalida = 0;
          |BUCLE con00671;
          |DESCARGA_DEF #referen@;
     |FINSI;
     aFic = "con00623"; |HAZ CargaDef;
     |SI FSalida = 0;
          |BUCLE con00623;
          |DESCARGA_DEF #referen@;
     |FINSI;
     aFic = "conp0625"; |HAZ CargaDef;
     |SI FSalida = 0;
          |BUCLE conp0625;
          |DESCARGA_DEF #referen@;
     |FINSI;
     aFic = "con00625"; |HAZ CargaDef;
     |SI FSalida = 0;
          |BUCLE con00625;
          |DESCARGA_DEF #referen@;
     |FINSI;
     aFic = "con00637"; |HAZ CargaDef;
     |SI FSalida = 0;
          |BUCLE con00637;
          |DESCARGA_DEF #referen@;
     |FINSI;
     aFic = "con00601"; |HAZ CargaDef;
     |SI FSalida = 0;
          |BUCLE con00601;
          |DESCARGA_DEF #referen@;
     |FINSI;
     aFic = "con00683"; |HAZ CargaDef;
     |SI FSalida = 0;
          |HAZ con00683;
          |DESCARGA_DEF #referen@;
     |FINSI;
     ||**
     aFic = "con00663"; |HAZ CargaDef;
     |SI FSalida = 0;
          |BUCLE con00663;
          |DESCARGA_DEF #referen@;
     |FINSI;
     aFic = "con00664"; |HAZ CargaDef;
     |SI FSalida = 0;
          |BUCLE con00664;
          |DESCARGA_DEF #referen@;
     |FINSI;
     aFic = "con00670"; |HAZ CargaDef;
     |SI FSalida = 0;
          |BUCLE con00670;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;
-----------------------------------------------------------------------
|PROCESO pcegm004;
     #referen@#4 = eaCliDes;
     |SI CambDesc = "S";
          #referen@#8 = eaNom;
     |FINSI;
     |GRABA 020#referen@.a;
     |LIBERA #referen@;
|FPRC;

|DEFBUCLE pcegm004;
     #referen@#1002;
     4;
     "     ", 000001, eaCliOrg;
     "zzzzz", 999999, eaCliOrg;
     be;
     NULL, pcegm004;
|FIN;

|PROCESO pcegm002;
     #referen@#3 = eaCliDes;
     |SI CambDesc = "S";
          #referen@#4 = eaNom;
     |FINSI;
     |GRABA 020#referen@.a;
     |LIBERA #referen@;
|FPRC;

|DEFBUCLE pcegm002;
     #referen@#1002;
     3;
     "     ", 000001, eaCliOrg;
     "zzzzz", 999999, eaCliOrg;
     be;
     NULL, pcegm002;
|FIN;

|PROCESO Pcegroup;
     aFic = "pcegm002"; |HAZ CargaDef;
     |SI FSalida = 0;
          |BUCLE pcegm002;
          |DESCARGA_DEF #referen@;
     |FINSI;
     aFic = "pcegm004"; |HAZ CargaDef;
     |SI FSalida = 0;
          |BUCLE pcegm004;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|PROCESO Recibos;
     |SI CambDesc = "S"; #dscam003@#6 = #154#5; |FINSI;
     #dscam003@#32 = eaCli;
     |GRABA 020#dscam003@.a;
|FPRC;

|DEFBUCLE Recibos;
     #dscam003@#12006;
     69;
     eaSer, enNum, 000, "01.01.0000", "            ", "      ", aCta;
     eaSer, enNum, 999, "31.12.9999", "zzzzzzzzzzzz", "zzzzzz", aCta;
     be;
     NULL, Recibos;
|FIN;

|PROCESO dscam045;
     |SI eaSer ] #dscam045@#4; |Y eaSer [ #dscam045@#5;
          aEmp = ("00000" + #dscam045@#6) % -105;
          aAlfa = aBase + "dscarter/fich/" + aEmp + "/";
          |PATH_DAT #dscam003@#aAlfa#;
          #dscam044@#0 = #dscam045@#0;
          |LEE 020#dscam044@.=;
          |SI FSalida = 0;
               |BUCLE Recibos;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE dscam045;
     #dscam045@#1002;
     2;
     nEmpresa, 001, "V";
     nEmpresa, 999, "V";
     ;
     NULL, dscam045;
|FIN;

|PROCESO CambiaCartera;
     |SI eaTipo = "P"; aCta = "P"; |FINSI;
     |SI eaTipo = "A"; aCta = "A"; |FINSI;
     |SI eaTipo = "D"; aCta = " "; |FINSI;
     |SI eaTipo = "F"; aCta = " "; |FINSI;

     |DBASS aBase;
     aAlfa = aBase + "dscarter/def/dscam045";
     |CARGA_DEF aAlfa, dscam045@;
     |SI FSalida = 0;
          aAlfa = aBase + "dscarter/def/dscam044";
          |CARGA_DEF aAlfa, dscam044@;
          |SI FSalida = 0;
               aAlfa = aBase + "dscarter/def/dscam003";
               |CARGA_DEF aAlfa, dscam003@;
               |SI FSalida = 0;
                    |DFICE aAlfa;
                    aAlfa = aAlfa % -205;
                    nEmpresa = aAlfa;
                    aAlfa = aBase + "dscarter/fich/";
                    |PATH_DAT #dscam044@#aAlfa#;
                    |PATH_DAT #dscam045@#aAlfa#;
                    |ABRE #dscam044@;
                    |BUCLE dscam045;
                    |CIERRA #dscam044@;
                    |DESCARGA_DEF #dscam003@;
               |FINSI;
               |DESCARGA_DEF #dscam044@;
          |FINSI;
          |DESCARGA_DEF #dscam045@;
     |FINSI;
|FPRC;
