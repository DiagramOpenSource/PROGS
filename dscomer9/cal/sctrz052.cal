|FICHEROS;
     sctrz052 #0;
     sctrm043 #43;
     sctrm054 #54;
     sctrm055 #55;
     sctrm056 #56;
     sctrm058 #58;
     sctrm036 #36;
     tmp00000 #99;  ||Tmp Impresion
     sctrm001 #100;
|FIN;

|VARIABLES;
     &eaNomLogo = "";
     &enPantaLogo = 0;
     &eaSerie = "";
     &enNumero = 0;
     &enTipo = 0;
     &eaTmpImp = "";
     nPanta = 0;
     aAlfa = "";
     aInforme = "";
     aInfoAntes = "";
     nHay = 0;
|FIN;

|PROCESO Vtos;
     |PRINT;
|FPRC;

|DEFBUCLE Vtos;
     #56#1;
     ;
     #54#0, #54#1, 001;
     #54#0, #54#1, 999;
     ;
     NULL, Vtos;
|FIN;

|PROCESO Lineas;
     |PRINT;
|FPRC;

|DEFBUCLE Lineas;
     #55#1;
     ;
     #54#0, #54#1, 0001;
     #54#0, #54#1, 9999;
     ;
     NULL, Lineas;
|FIN;

|DEFBUCLE LineasViajes;
     #58#1;
     ;
     #54#0, #54#1, 001;
     #54#0, #54#1, 999;
     ;
     NULL, Lineas;
|FIN;

|PROCESO Facturas;
     #43#26 = #54#0;
     |LEE 000#43=
     |SI FSalida ! 0; |DDEFECTO #43; |FINSI;

     #36#1 = #54#3;
     |LEE 000#36=;
     |SI #36#28 < #0#10; |O #36#28 > #0#11;
          |ACABA;
     |FINSI;

     |SI #54#13 = "F";
          aInforme = #43#22;
     |SINO;
          aInforme = #43#23;
     |FINSI;
     |QBF aInforme;

     |SI aInforme ! aInfoAntes; |Y aInfoAntes ! "";
          |PIEINF;
          |FININF;
          nHay = 0;
     |FINSI;
     aInfoAntes = aInforme;

     |SI nHay = 0;
          |INFOR aInforme;
          |SI FSalida ! 0;
               aAlfa = "0000Error en informe '" + aInforme + "'.";
               |MENAV aAlfa;
               |ERROR10; |ACABA;
          |FINSI;
     |FINSI;

     nHay = 1;
     enTipo = 1;
     |SI #54#13 = "V";
          |BUCLE LineasViajes;
     |SINO;
          |BUCLE Lineas;
     |FINSI;
/*
     enTipo = 2; |BUCLE Vtos;
*/
|FPRC;

|DEFBUCLE Facturas;
     #54#1;
     2, 3, 14;
     #0#0, #0#2, #0#4, #0#6, #0#8;
     #0#1, #0#3, #0#5, #0#7, #0#9;
     be;
     NULL, Facturas;
|FIN;

|PROCESO Tmp;
     #54#0 = #99#0;
     #54#1 = #99#1;
     |LEE 020#54=;
     |SI FSalida = 0;
          |HAZ Facturas;
     |FINSI;
|FPRC;

|DEFBUCLE Tmp;
     #99#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Tmp;
|FIN;

|PROCESO T3; |TIPO 3;
     Impresora = "CrystalReport";
     |IMPRE -1;
     |SI FSalida = 0;
          |ABRE #43;
          |SI eaSerie ! "";
               |ABRE #54;
               #54#0 = eaSerie;
               #54#1 = enNumero;
               |LEE 121#54=;
               |SI FSalida = 0;
                    |HAZ Facturas;
               |FINSI;
               |CIERRA #54;
          |SINO;
               |SI eaTmpImp ! "";
                    |NOME_DAT #99 eaTmpImp;
                    |ABRE #54;
                    |BUCLE Tmp;
                    |CIERRA #54;
               |SINO;
                    |ABRE #36;
                    |BUCLE Facturas;
                    |CIERRA #36;
               |FINSI;
          |FINSI;
          |CIERRA #43;
          |SI nHay ! 0;
               |PIEINF;
               |FININF;
          |FINSI;
          |FINIMP;
     |FINSI;
|FPRC;

|PROCESO LogoPanta;
     eaNomLogo = #100#1;
     |HAZ TraeLogoPan;
     enPantaLogo = nPanta;
     |HAZ PintaLogoPan;
|FPRC;

|PROGRAMA;
     |SI eaSerie ! ""; |O eaTmpImp ! "";
          |HAZ T3;
     |SINO;
          |ABRE #100; |LEE 000#100p; |CIERRA #100;
          |PINPA #0#0; nPanta = FSalida;
          |PINDA #0#0;
          |HAZ LogoPanta;
          |ENDATOS #1#0;
     |FINSI;
|FPRO;
