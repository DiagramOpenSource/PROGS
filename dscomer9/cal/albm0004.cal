|FICHEROS;
     albm0004 #4,MANTE;
     agifa142 #142;
     agifa073 #73;
     agifa019 #19;
     agifa024 #24;
|FIN;

|VARIABLES;
     &eaRieSuma    = "";
     aHora         = "";
     aAlfa         = "";

     nForma        = 0;
     nTries        = 0;
     nVentana      = 0;

     &nRieUtili    = 0;
     &nRieTotal    = 0;
     &nMasRies     = 0;
     &eaTag        = "";
     &eaCodCliente = "";
     &eaNomCliente = "";
     &eaSw2Stock   = "";
     &cli_dt       = "";
     &art_dt       = "";
     &pvp_ve       = 0;
     &nDeci_PreVis = 2;
     &dtos_1       = 0;
     &dtos_2       = 0;
     &dto_pt       = 0;
     &aParam       = "";
     &enDirEnt     = 0;
     &tarifa       = 0;
     &fed_dt       = @;
     &fam_dt       = "";
     &iva_dt       = 0;
|FIN;

|PROCESO Hora;  |TIPO 7;
     |SI #4#1 = "        ";
         |HORA aHora;
         #4#1 = aHora;  |PINTA #4#1;
     |FINSI;
|FPRC;

|PROCESO Relleno;  |TIPO 6;
     aAlfa = #4#2;  |QBT aAlfa;
     aAlfa = ("000000" + aAlfa) % -106;
     #4#2  = aAlfa;
     |PINTA #4#2;
|FPRC;

|PROCESO Conversion; |TIPO 7;
     |DDEFECTO #73;
     #73#5  = #4#6;
     #73#44 = #4#7;
     #73#2  = #4#3;
     #73#3  = #4#4;

     |HAZ DobleUniV;
     |SI eaSw2Stock = "S";
          #4#6 = #73#5;   |PINTA #4#6;
          #4#7 = #73#44;  |PINTA #4#6;
          |C_M #4#6, 1, "N";
          |C_M #4#7, 1, "N";
          |ACABA;
     |FINSI;
|FPRC;

|PROCESO CogePrecio;  |TIPO 7;
     |ABRE #24;
     #24#0    = #4#2;
     |LEE 040#24=;
     |SI FSalida ! 0;  |DDEFECTO #24;  |FINSI;
     |CIERRA #24;

     |ABRE #19;
     #19#0 = #4#3;
     |LEE 040#19=;
     |SI FSalida ! 0;  |DDEFECTO #19;  |FINSI;
     |CIERRA #19;

     fed_dt       = #4#0;
     cli_dt       = #4#2;
     art_dt       = #4#3;
     fam_dt       = #19#2;
     iva_dt       = #19#30;
     pvp_ve       = #4#8;
     dtos_1       = #4#9;
     dtos_2       = #4#10;
     aParam       = "";
     enDirEnt     = 1;
     tarifa       = #24#39;
     nDeci_PreVis = 2;

     |HAZ calcdtos;

     #4#8     = pvp_ve - dto_pt;
     #4#9     = dtos_1;
     #4#10    = dtos_2;

     |PINTA #4#8;
     |PINTA #4#9;
     |PINTA #4#10;
|FPRC;

|PROCESO Importe;  |TIPO 7;
     #4#11 = (((#4#6 * #4#8) < #4#9) < #4#10);
     |PINTA #4#11;
|FPRC;

|PROCESO Tipo2;  |TIPO 2;
     nForma       = 0 +. 1;
     nDeci_PreVis = 2;
     |SI nForma ! 1;  |ACABA;  |FINSI;

     |ABRE #142;
     |LEE 000#142p;
     |SI FSalida ! 0;  |DDEFECTO #142;  |FINSI;
     |CIERRA #142;

     eaCodCliente = #4#2;
     eaNomCliente = #4#14;
     eaTag = "";  |HAZ SacaRiesgo;

     |SI eaRieSuma = "S"; nRieUtili = nRieUtili + #4#11; |FINSI;
     nTries    = nRieTotal + nMasRies;
     |SI nRieUtili ] nTries; |Y #142#166 = "S";
          |SI #142#167 = "N";
               |MENAV "0000Se supera el Riesgo Limite del cliente";
          |FINSI;
          |SI #142#167 = "S";  |O #142#167 = "P";
               |VENTANA 0501, 2699, -1, -1, "";
               nVentana = FSalida;
               |HAZ AvisaRiesgo;
               |FINVENTANA nVentana;
          |FINSI;
     |FINSI;

     |ABRE #24;
     #24#0    = #4#2;
     |LEE 040#24=;
     |SI FSalida ! 0;  |DDEFECTO #24;  |FINSI;
     |CIERRA #24;

     fed_dt   = #4#0;
     cli_dt   = #4#2;
     art_dt   = #4#3;
     fam_dt   = #19#2;
     iva_dt   = #19#30;
     pvp_ve   = #4#8;
     dtos_1   = #4#9;
     dtos_2   = #4#10;
     enDirEnt = 1;
     tarifa   = #24#39;
     aParam   = "grapre";

     |HAZ calcdtos;
|FPRC;
