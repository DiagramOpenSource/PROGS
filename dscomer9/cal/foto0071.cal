|FICHEROS;
     foto0071 #0;

     expor024 #1;        ||Cliente a importar
     agifa024 #11;

     expor019 #2;        ||Articulo a importar
     agifa019 #12;

     expor112 #3;        ||Proveedor a importar
     agifa112 #13;

     expor025 #4;        ||Comisionista a importar
     agifa025 #14;

     expor010 #5;        ||Fichero de Albaranes
     agifa010 #15;
     expor071 #6;        ||Fichero de lineas de albaran
     agifa071 #16;

     expor084 #9;        ||Factura contado
     agifa084 #19;
     expor069 #10;       ||Linea factura contado
     agifa069 #20;

     expor501 #21;       ||Tiquets
     agifa501 #31;
     expor502 #22;       ||Linea Tiquets
     agifa502 #32;

     expor513 #23;       ||Cobros
     agifa513 #33;

     expor512 #24;       ||Pagos
     agifa512 #34;

     expor509 #25;        ||resumen de caja
     agifa509 #35;

     expor001 #26;       ||Cod.Barras
     dsl00001 #36;

     agifa017 #17;     || Stocks de almacenes
     agifa065 #18;     || Historico
     expor065 #38;
     foto0075 #50;     || Fichero CONTROL CAMINO EXPORT/IMPORT
     agif0041 #60;     || Fichero de empresas
     testigo  #61;     || testigo, y control de empresas
     agifv009 #77;     || Serie para separar tike importacion.

     foto0x18 #118;      || Cabecera F
     foto0x19 #128;      || Cabecera R
     foto0015 #138;      || Cabecera Sobres

     foto0z18 #119;      || Lineas F
     foto0z19 #129;      || Lineas R
     foto0016 #139;      || Lineas Sobres
|FIN;

|INCLUYE i_varart;

|VARIABLES;
     &eaNomDef = "";
     &enCamposDef = 0;
     n024 = 0; n019 = 0; n112 = 0; n025 = 0; n010 = 0; n071 = 0; n565 = 0;
     n084 = 0; n069 = 0; n501 = 0; n502 = 0; n513 = 0; n512 = 0; n509 = 0;
     n001 = 0; n015 = 0; n016 = 0;
     nLinea = 0;
     ddx = "";
     fich = "";
     org = "";
     num = 0;
     bufer = 0;
     err = 0;
     fdes = "";
     des = "";
     fdef = "";
     def = "";
     exp = 0;

     i = 0;
     mensaje1= "0000ATENCION No puedo abrir fichero de control EXPORT/IMPORT";
     mensaje2 = "0000ATENCION Debe informar del CONTROL CAMINO EXPORT/IMPORT";
     mensaje = "";
     path = "";
     mensa = "";
     mes = 0;
     fmes = "  ";
     blanco = "                         ";
     blanco1 = "                    ";
     baseimp = 0;
     margen = 0;
     empresa = "";
     camino = "";
     pintar = "";
     hora = "";
     horat = "";
     importa = 0;
     fechaimp = @;
     abo = 0;
     jj   =0;
     victt=0;
     victa=0;
     victb=0;
     acuta=0;
     acutb=0;
     acua =0;
     acub =0;
     cabt =0;
     fp   =0;
     tt   =0;
     ffs  =0;
     vics ="";
     vicr ="";
     vicl =0;
     vicss="";
     vicrr="";
     vicll=0;
     porc =0;
     acu  =0;
     ll   ="";
     nUltima = 0;
     nSalida = 0;
     atar = "";
     atar2 = "";
     atar3 = "";
     atar4 = "";
     atgz = "";
     asystem = "";
     asystem2 = "";
     noborres = 0;
     aexpor = "";
     aexpor2 = "";
     conoscar = ""; ||Carlos
|FIN;

||============================= COD BARRAS ================================
|PROCESO CodBarra;
     |PINTA 2163 , blanco1;
     |PINTA 2163 , #26#1;
     |DDEFECTO #36;
     |SELECT #2#36;
     #36#3 = #26#3;
     |LEE 000#36=;
     |SI FSalida ! 0;
          |SELECT #1#36;
          |LEE 000#36u;
          |SI FSalida = 0;
               nUltima = #36#0 + 1;
          |SINO;
               nUltima = 1;
          |FINSI;
          |PARA i = 1; |SI i [ n001; |HACIENDO i = i + 1;
              #36i = #26i;
          |SIGUE;
          #36#0 = nUltima;
          #36#4 = "S";
          #36#5 = ~;
          |GRABA 020#36n;
     |FINSI;
|FPRC;

||============================= CLIENTES ==================================

|PROCESO miracli;
     |PINTA 2163 , blanco1;
     |PINTA 2163 , #1#0;
     |DDEFECTO #11;
     #11#0 = #1#0;         ||igualo el fichero de clientes
     |LEE 101#11=;       ||Miro si ya existe el cliente
     |SI FSalida ! 0;    ||Si no existe lo grabo como corriente
          |GRABA 021#11b;
     |FINSI;
     |PARA i = 1; |SI i [ 44; |HACIENDO i = i + 1;
           #11i = #1i;
     |SIGUE;
     #11#47 = #1#47;          ||Regimen equivalencia
     #11#52 = #1#52;          ||Capacidad estimada de compra
     #11#53 = #1#53;          ||Observaciones1
     |PARA i = 156; |SI i [ n024; |HACIENDO i = i + 1;
          #11i = #1i;
     |SIGUE;
     #11#175 = "N";             ||Exportado
     #11#176 = "00.00.0000";    ||Fecha Exportcion
     |GRABA 021#11a;
     |LIBERA #11;
|FPRC;

||============================= ARTICULOS =================================

|PROCESO miraarti;
     |PINTA 2163 , blanco1;
     |PINTA 2163 , #2#0;
     |DDEFECTO #12;
     #12#0 = #2#0;    ||igualo el fichero de articulos
     |LEE 101#12=;  ||Miro si ya existe el articulo
     |SI FSalida ! 0; ||Si el articulo no existe
          |GRABA 021#12b;
     |FINSI;
     |PARA i = 1; |SI i [ 5; |HACIENDO i = i + 1;
          #12i = #2i;
     |SIGUE;
     #12#9=#2#9;    ||P.C.M
     |PARA i = 18; |SI i [ 23; |HACIENDO i = i + 1;
          #12i = #2i;
     |SIGUE;
     #12#30 = #2#30;  ||Tipo de iva
     #12#31 = #2#31;  ||%comision
     #12#102 = #2#102;     ||Peso por caja
     #12#103 = #2#103;     ||%royalti

     |PARA i = 105; |SI i [ 128; |HACIENDO i = i + 1;
          #12i = #2i;
     |SIGUE;

     |PARA i = 133; |SI i [ n019; |HACIENDO i = i + 1;
          #12i = #2i;
     |SIGUE;

     #12#130 = #2#130;     ||Iva 1
     #12#131 = #2#131;     ||Iva 2
     #12#132 = #2#132;     ||Iva 3
     #12#123 = "N";
     #12#124 = "00.00.0000";
     |GRABA 021#12a;
     |LIBERA #12;
|FPRC;

||============================= PROVEEDORES ===============================

|PROCESO miraprove;
     |PINTA 2163 , blanco1;
     |PINTA 2163 , #3#0;
     |DDEFECTO #13;
     #13#0 = #3#0;    ||igualo el fichero de proveedores
     |LEE 101#13=;  ||Miro si ya existe el proveedor
     |SI FSalida ! 0; ||Si el Proveedor ya existe
          |GRABA 021#13b;
     |FINSI;
     |PARA i = 1; |SI i [ 26; |HACIENDO i = i + 1;
          #13i = #3i;
     |SIGUE;
     #13#41 = #3#41;  ||Dto acumulado
     #13#42 = #3#42;  ||Codigo de grupo
     |PARA i = 57; |SI i [ n112; |HACIENDO i = i + 1;
          #13i = #3i;
     |SIGUE;
     #13#71 = "N";
     #13#72 = "00.00.0000";
     |GRABA 021#13a;
     |LIBERA #13;
|FPRC;

||============================= COMISIONISTAS =============================

|PROCESO miracomis;
     |PINTA 2163 , blanco1;
     |PINTA 2163 , #4#0;
     |DDEFECTO #14;
     #14#0 = #4#0;    ||igualo el fichero de comision
     |LEE 101#14=;  ||Miro si ya existe la comision
     |SI FSalida ! 0; ||Si el comision existe
          |GRABA 021#14b;
     |FINSI;
     |PARA i = 1; |SI i [ 10; |HACIENDO i = i + 1;
          #14i = #4i;
     |SIGUE;
     #14#39 = #4#39;  ||%IRPF
     #14#54 = "N";
     #14#55 = "00.00.0000";
     |PARA i = 56; |SI i [ n025; |HACIENDO i = i + 1;
          #14i = #4i;
     |SIGUE;
     |GRABA 021#14a;
     |LIBERA #14;
|FPRC;

||============================= HISTORICO =================================
|PROCESO mirahis;
     |PINTA 2163 , blanco1;
     |PINTA 2163 , #38#0;
     |DDEFECTO #18;
     |PARA i = 0; |SI i [ n565; |HACIENDO i = i + 1;
          #18i = #38i;
     |SIGUE;
     #18#15 = "S";
     #18#16 = ~;
     |GRABA 000#18n;
|FPRC;

||=============================== ALBARANES ===============================
|PROCESO miralin;        |Lineas de albaran
     |DDEFECTO #16;
     |PARA i = 0; |SI i [ n071; |HACIENDO i = i + 1;
          #16i = #6i;
     |SIGUE;
     |GRABA 021#16c;
     |LIBERA #16;

     ||Aqui Actualizo el Articulo
     |DDEFECTO #12;
     #12#0 = #6#2;
     |LEE 101#12=;
     ||Leo en articulos
     |SI FSalida ! 0; |Y #0#17 = "S";
          |GRABA 021#12b;
     |FINSI;
     fmes = #5#1 % A402;
     mes = fmes - 1;     mes = mes * 5;      mes = mes + 34;
     |SI #5#43="N";      ||No es abono
          abo = 1;
     |SINO;
          abo = -1;
     |FINSI;
          #12mes = #12mes + (#6#5 * abo);
          #12#94  = #12#94  + (#6#5 * abo);      ||Total unidades
          #12#6   = #12#6   - (#6#5 * abo);        ||Stock total
          #12#11  = #12#11  + (#6#5 * abo);      ||Necesidades
          #12#104 = #12#104 - (#6#5 * abo);    ||Stock disponible
          #12#10  = #12#6   * #12#9;      ||Valor stock
     |SI #0#17 = "S";
          |GRABA 021#12a;
          |LIBERA #12;
     |FINSI;

     ||Aqui Actualizo el almacen

     |DDEFECTO #17;
     #17#0 = #6#2;
     #17#1 = #6#3;
     |LEE 101#17=;
     |SI FSalida ! 0; |Y #0#19 = "S";
          |GRABA 021#17b;
     |FINSI;
     mes = fmes - 1; mes = mes * 2; mes = mes + 11;
          #17mes = #17mes + (#6#5 * abo);      ||Salida unidades
          #17#35 = #17#35 + (#6#5 * abo);      ||Total salidas
          #17#5  = #17#5  - (#6#5 * abo);        ||Stock total
          #17#39 = #17#39 - (#6#5 * abo);      ||Stock disponible
          #17#3  = #17#5  * #12#9;       ||Valor stock=total*PCM
          #7#50 = #7#42 + #7#6 - #7#43 - #7#39; || necesidades
          #7#50 = #7#50 - #7#4 - #7#9 - #7#8;
     |SI #0#19 = "S";
          |GRABA 021#17a;
          |LIBERA #17;
     |FINSI;

     |SI #0#18 = "S";

          ||Empiezo con el historico
          |DDEFECTO #18;
          #18#0 = #6#2;    ||Articulo
          #18#1 = #5#1;    ||Fecha
          |SI #5#43 = "N";      ||Si no es abono
               #18#2 = "AV";    ||Codigo de la operacion
               #18#6 = -#6#5;    ||Unidades
          |SINO;
               #18#2 = "BV";
               #18#6 = #6#5;
          |FINSI;
          #18#7 = #17#5;        ||Stock resultante
          #18#3 = #6#0;         ||Numero albaran
          #18#4 = #6#1;         ||Numero de linea
          #18#5 = #6#3;         ||Almacen
          #18#8 = #12#9;        ||P.C.M
          #18#9 = #6#6;         ||Precio articulo
          #18#10 = #5#3;        ||cliente
          #18#11 = #5#52;       ||Serie
          |GRABA 021#18n;
     |FINSI;
|FPRC;

|DEFBUCLE miralin;
     #6#1;
     ;
     #5#52, #5#0, 001;
     #5#52, #5#0, 999;
     ;
     NULL, miralin;
|FIN;

|PROCESO miraalba;       ||Cabeceras de albaran
     |PINTA 2163 , blanco1;
     pintar = #5#44 + " / " + #5#0;
     |PINTA 2163 , pintar;
     |DDEFECTO #15;
     #15#52 = #5#52;
     #15#0 = #5#0;
     |LEE 000#15=;
     |SI FSalida=0;
          mensa ="0000El albaran numero : "+#5#52 + "/" + #5#0+"  YA EXISTE";
          |MENAV mensa;
          |ACABA;
     |FINSI;
     |PARA i = 0; |SI i [ n010; |HACIENDO i = i + 1;
          #15i = #5i;
     |SIGUE;
     |GRABA 021#15c;     ||Grabo el albaran

     ||Aqui Actualizo el cliente del albaran

     #11#0=#15#3;
     |LEE 101#11=;
     |SI FSalida = 0; |Y #0#16 = "S";
          |SI #5#43 = "N"; ||Si no es abono
               #11#50=#11#50+#15#16+#15#19+#15#22+#15#28; ||Pendiente facturar
               enImpCliPen=#11#50+#15#16+#15#19+#15#22+#15#28; ||Pendiente facturar
          |SINO;
               #11#50=#11#50-#15#16-#15#19-#15#22-#15#28; ||Pendiente facturar
               enImpCliPen=#11#50-#15#16-#15#19-#15#22-#15#28; ||Pendiente facturar
          |FINSI;
          eaCliente = #15#3;
          efFecha = #15#1;
          |HAZ AcumulaCli;
          |GRABA 021#11a;
          |LIBERA #11;
     |FINSI;
     |BUCLE miralin;         ||Graba las lineas albaran
|FPRC;

||=============================== FACTURAS ================================
|PROCESO miralinfac;        |Lineas de factura
     |DDEFECTO #20;
     |PARA i = 0; |SI i [ n069; |HACIENDO i = i + 1;
        #20i = #10i;
     |SIGUE;
     |GRABA 021#20c;      || Grabo linea de factura contado nueva
     |LIBERA #20;

     |DDEFECTO #12;
     #12#0 = #10#2;  || Cargo codigo de articulo de lineas de factura pase
     |LEE 101#12=;       ||Leo en articulos
     |SI FSalida ! 0; |Y #0#17 ="S";
          #12#1 = #10#4;
          |GRABA 021#12b;
     |FINSI;
     mes = fmes - 1;
     mes = mes * 5;              || Numero de unidades por mes
     mes = mes + 34;             || Primer campo
     #12mes = #12mes + #10#5;      ||Venta unidadades mes
     mes = mes + 1;
     #12mes = #12mes + #10#9;      ||Venta ptas mes
     mes = mes + 1;
     #12mes=#12mes+ (#10#9-#10#14);  ||Margen agosto (ventas - coste)
     #12#96=#12#96+ (#10#9-#10#14);  || Margen total año
     #12#94=#12#94+#10#5;      ||Total unidades
     #12#95=#12#95+#10#9;      ||Total ventas ptas (sin iva)
     #12#6=#12#6-#10#5;        ||Stock total
     #12#11=#12#11+#10#5;      ||Necesidades
     #12#104=#12#104-#10#5;    ||Stock disponible
     #12#10=#12#6*#12#9;       ||Valor stock
     #12#24=#9#1;              ||Ultima fecha de venta
     #12#25=#10#5;             ||Unidades ultima venta
     |SI #0#17 = "S";
         |GRABA 021#12a;     || Grabo articulos
         |LIBERA #12;
     |FINSI;

     |DDEFECTO #17;
     #17#0=#10#2;         || Stocks almacenes
     #17#1=#10#3;
     |LEE 101#17=;
     |SI FSalida ! 0; |Y #0#19 ="S";
          |GRABA 021#17b;
     |FINSI;
     mes = fmes - 1;  mes = mes * 2; mes = mes + 11;
     #17mes=#17mes+#10#5;      ||Salida unidades mes
     #17#35=#17#35+#10#5;      ||Total salidas
     #17#5=#17#5-#10#5;        ||Stock total
     #17#39=#17#39-#10#5;      ||Stock disponible
     #17#3=#17#5*#12#9;        ||Valor stock=total*PCM
     #7#50 = #7#42 + #7#6 - #7#43 - #7#39; || necesidades
     #7#50 = #7#50 - #7#4 - #7#9 - #7#8;
     |SI #0#19 = "S";
          |GRABA 021#17a;
          |LIBERA #17;
     |FINSI;

     |SI #0#18 = "S";
          |DDEFECTO #18;
        ||Empiezo co el historico
          #18#0=#10#2;   ||Articulo
          #18#1=#9#1;    ||Fecha
          #18#2="FC";          ||Codigo de la operacion (Factura contado)
          #18#6=-#10#5;        ||Unidades
          #18#7=#17#5;         ||Stock resultante
          #18#3=#9#0;          ||Numero albaran
          #18#4=#10#1;         ||Numero de linea
          #18#5=#10#3;         ||Almacen
          #18#8=#12#9;         ||P.C.M
          #18#9=#10#6;         ||Precio articulo
          #18#10=#9#3;         ||cliente (cab.factura)
          #18#11=#9#48;        ||Serie  (cab.factura)
          |GRABA 021#18n;      || Grabo una clave nueva en historico de articulos
     |FINSI;
|FPRC;

|DEFBUCLE miralinfac;
     #10#1;
     ;
     #9#48, #9#0, 001;
     #9#48, #9#0, 999;
     ;
     NULL, miralinfac;
|FIN;

|PROCESO mirafact;       ||Cabeceras de factura
     |PINTA 2163 , blanco1;
     pintar = #9#48 + " / " + #9#0;
     |PINTA 2163 , pintar;
     |DDEFECTO #19;
     #19#48 = #9#48;
     #19#0 = #9#0;
     |LEE 000#19=;
     |SI FSalida=0;
          mensa ="0000La Factura numero : "+#9#48 + "/" +#9#0+"  YA EXISTE";
          |MENAV mensa;
          |ACABA;
     |FINSI;
     |PARA i = 0; |SI i [ n084; |HACIENDO i = i + 1;
        #19i = #9i;
     |SIGUE;

     || Empiezo a actualizar lo que depende directamente de la cabecera

     |DDEFECTO #11;
     #11#0 = #9#3;               || Busco en el fichero de clientes
     |LEE 111#11=;
     |SI FSalida ! 0; |Y #0#16 = "S";
          |GRABA 021#11b;
     |FINSI;
     baseimp= #9#16+#9#19+#9#22+#9#28;|| Me servira para varias actualizaciones
     baseimp = baseimp+#9#42+#9#45;  || (Suma de las bases imponibles)
     #11#45 = #9#1;                  || Fecha ultima compra
     #11#46 = #11#46 + baseimp;      || Importe ultima compra
     #11#102 = #11#102 + baseimp;    || Total compras año
     #11#110 = #11#110 + #9#41;      || Total facturado   (Total factura)
     fmes = #9#1 % A402; mes = fmes - 1; mes = mes * 4; mes = mes + 54;
     #11mes = #11mes + baseimp;      || Compras en el mes de la venta
     mes = mes + 2;
     #11mes = #11mes + #9#37;        || Margen en el mes en concreto
     #11#104 = #11#104 + #9#37;      || Total margen
     |SI #0#16 = "S";
          |GRABA 021#11a;
          |LIBERA #11;
     |FINSI;
       || Ahora me voy a cada una de las lineas de la factura en concreto
     |GRABA 021#19c;

     enImpCliCom = baseimp;
     enImpCliFac = #9#41;
     enImpCliMar = #9#37;
     eaCliente = #0#2;
     efFecha = #0#1;
     |HAZ AcumulaCli;
     |BUCLE miralinfac;
|FPRC;

||============================== TIQUETS ==================================
|PROCESO miralintpv;        ||Lineas de tiquets

     |DDEFECTO #32;
     |PARA i = 0; |SI i [ n502; |HACIENDO i = i + 1;
          #32i=#22i;
     |SIGUE;
          #32#9 = #31#14;
/*
     |HAZ vic;

     #32#20=vics;
     #32#0 =vicr;
     #32#1 =vicl;
*/
     |GRABA 021#32c;
     |LIBERA #32;

     |DDEFECTO #12;
     #12#0 = #22#2;        || Cargo codigo de articulo de lineas de tpv pase
     |LEE 101#12=;       ||Leo en articulos
     |SI FSalida ! 0; |Y #0#17 = "S";
          |GRABA 021#12b;
     |FINSI;
          mes=fmes-1;
          mes=mes*5;              || Numero de unidades por mes
          mes=mes+34;             || Primer campo
          #12mes=#12mes+#22#5;      ||Venta unidadades mes
          mes=mes+1;
          #12mes=#12mes+#22#21;      ||Venta ptas mes (sin iva)
          mes=mes+1;
          margen = #22#21 - (#22#5*#12#9);   || Calculo el margen
          #12mes=#12mes+ margen;             ||Margen agosto (base imponible - coste)
          #12#96=#12#96+ margen;             || Margen total año
          #12#94=#12#94+#22#5;       ||Total unidades
          #12#95=#12#95+#22#21;      ||Total ventas ptas (sin iva)
          #12#6=#12#6-#22#5;         ||Stock total
          #12#11=#12#11+#22#5;       ||Necesidades
          #12#104=#12#104-#22#5;     ||Stock disponible
          #12#10=#12#6*#12#9;        ||Valor stock
          #12#24=#21#1;              ||Ultima fecha de venta
          #12#25=#22#5;              ||Unidades ultima venta

     |SI #0#17 ="S";
          |GRABA 021#12a;     || Grabo articulos
          |LIBERA #12;
     |FINSI;

    || Stocks almacenes
     |DDEFECTO #17;
     #17#0=#22#2;         || Articulo
     #17#1=#22#3;         || Almacen
     |LEE 101#17=;
     |SI FSalida ! 0; |Y #0#19 ="S";            || Si existo actualizo
          |GRABA 021#17b;
     |FINSI;
          mes=fmes-1;
          mes=mes*2;
          mes=mes+11;
          #17mes=#17mes+#22#5;      ||Salida unidades mes
          #17#35=#17#35+#22#5;      ||Total salidas
          #17#5=#17#5-#22#5;        ||Stock total
          #17#39=#17#39-#22#5;      ||Stock disponible
          #17#3=#17#5*#12#9;        ||Valor stock=total*PCM
          #7#50 = #7#42 + #7#6 - #7#43 - #7#39; || necesidades
          #7#50 = #7#50 - #7#4 - #7#9 - #7#8;
     |SI #0#19 = "S";
          |GRABA 021#17a;
          |LIBERA #17;
     |FINSI;
     ||Empiezo co el historico

     |SI #0#18 ! "S";    |ACABA;   |FINSI;
     |DDEFECTO #18;
     #18#0=#22#2;   ||Articulo
     #18#1=#21#14;    ||Fecha
     #18#2 = "TI";          ||Codigo de la operacion (Factura contado)
     #18#6 = -#22#5;        ||Unidades
     #18#7 = #17#5;         ||Stock resultante
     #18#3 = #22#0;         ||Numero de tiquet (si es en blanco no tendra numero)
     #18#4 = #22#1;         ||Numero de linea
     #18#5 = #22#3;         ||Almacen
     #18#8 = #12#9;         ||P.C.M
     #18#9 = #22#6;         ||Precio articulo
     #18#10 = #21#1;        ||cliente (cab.tiquet)
     #18#11 = #21#36;        ||Serie  (cab.factura)
     |GRABA 021#18n;
|FPRC;

|DEFBUCLE miralintpv;
     #22#1;
     ;
     #21#36, #21#0, 001;
     #21#36, #21#0, 999;
     ;
     NULL, miralintpv;
|FIN;

|PROCESO miratpv;

       |HAZ fop;            || Ver si forma de pago entra en los planes.

       victt=victt+ #21#9;
       victb=victt % porc;
       victa=victt - victb;

     |PINTA 2163 , blanco1;
     pintar = #21#36 + " / " + #21#0;
     |PINTA 2163 , pintar;
     |DDEFECTO #31;

     #31#36 = #21#36;      || Serie tiquet antes era #31#42=#21#36 y estaba mal
     #31#0 = #21#0;        ||
     |LEE 000#31=;
     |SI FSalida = 0;
          mensa ="0000El Tiquet numero : "+#21#36 + "/" +#21#0+"  YA EXISTE";
          |MENAV mensa;
          |ACABA;
     |FINSI;
     |PARA i = 0; |SI i [ n501; |HACIENDO i = i + 1;
           #31i = #21i;
     |SIGUE;
     #31#6 = "N";     ||contabilizado
     #31#13 = "S";    ||impreso
     |GRABA 021#31b;      || Graba una cabecera nueva de factura contado
   || Empiezo a actualizar lo que depende directamente de la cabecera
     |DDEFECTO #11;
     #11#0=#21#1;               || Busco en el fichero de clientes
     |LEE 111#11=;
     |SI FSalida ! 0; |Y  #0#16 = "S";
          |GRABA 021#11b;
     |FINSI;
     baseimp= #21#20 + #21#23 + #21#26+#21#30; || Me servira para varias actualizaciones
     baseimp = baseimp + #21#48 + #21#51;      || (Suma de las bases imponibles)
            #11#45 = #21#14;                   || Fecha ultima compra
            #11#46 = #11#46 + baseimp;         || Importe ultima compra

            #11#102 = #11#102 + baseimp;    || Total compras año
            #11#110 = #11#110 + #21#9;      || Total facturado   (Total factura)

            fmes=#21#14 % A402;
            mes=fmes-1;
            mes=mes*4;          || Numero de elementos por mes
            mes=mes+54;         ||
            #11mes = #11mes + baseimp;      || Compras en el mes de la venta
            mes = mes + 2;
            #11mes = #11mes +#21#8;         || Margen en el mes en concreto

            #11#104 = #11#104 + #21#8;      || Total margen
     |SI #0#16 = "S";
          |GRABA 021#11a;
          |LIBERA #11;
     |FINSI;
     || Ahora me voy a cada una de las lineas de la factura en concreto
     |BUCLE miralintpv;

          |SI cabt ! 0;
             #31#9=acuta;
             |GRABA 020#31a;
             |LIBERA #31;
             |DDEFECTO #31;
             #31#36 = vicss;      || Serie tiquet antes era #31#42=#21#36 y estaba mal
             #31#0  = vicrr;      ||
             |LEE 000#31=;
            |SI FSalida = 0;
             mensa ="0000El Tiquet numero : "+vics + "/" +vicr+"  YA EXISTE";
             |MENAV mensa;
             |ACABA;
            |FINSI;
             |PARA i = 0; |SI i [ n501; |HACIENDO i = i + 1;
             #31i = #21i;
             |SIGUE;
             #31#6 = "N";     ||contabilizado
             #31#13 = "S";    ||impreso
             #31#9=acutb;
                   #31#36 = vicss;
                   #31#0  = vicrr;
             |GRABA 021#31b;      || Graba una cabecera nueva de factura contado
          |FINSI;
  |LIBERA #31;
  acuta=0;
  acutb=0;
  cabt =0;
  tt   =0;
  fp   =0;

|FPRC;
|| **********************


|| **********************
||============================= COBROS ====================================

|PROCESO miracobro;
     |PINTA 2163 , blanco1;
     pintar = #23#14 + " / " + #23#0;
     |PINTA 2163 , pintar;
     |DDEFECTO #33;
     |PARA i = 0; |SI i [ n513; |HACIENDO i = i + 1;
          #33i = #23i;
     |SIGUE;
     #33#15 = "N";       ||Cotabilizado
     |GRABA 001#33n;
     |SI FSalida ! 0;
          mensaje="0000El Cobro numero "+#23#14+"  -  "+#23#0+"  Ya existe, y no se grabara";
          |MENAV mensaje;
     |FINSI;
|FPRC;

|PROCESO mirapago;
     |DDEFECTO #34;
     |PINTA 2163 , blanco1;
     pintar = #24#12 + " / " + #24#0;
     |PINTA 2163 , pintar;
     |PARA i = 0; |SI i [ n512; |HACIENDO i = i + 1;
          #34i = #24i;
     |SIGUE;
     #34#13 = "N";       ||Contabilizado
     |GRABA 001#34n;
     |SI FSalida ! 0;
          mensaje="0000El pago numero "+#24#12+"  -  "+#24#0+" Ya existe, y no se grabara";
          |MENAV mensaje;
     |FINSI;
|FPRC;

|PROCESO pasar509;
     |DDEFECTO #35;
     |PARA i = 0; |SI i [ n509; |HACIENDO i = i + 1;
          #35i = #25i;
     |SIGUE;
     #35#60 = "S";
     #35#61 = fechaimp;
     |GRABA 001#35n;
     |LIBERA #35;
|FPRC;

********************
|DEFBUCLE 0;        ||CLientes #1
#1#1;
;
"      ";
"zzzzzz";
e;
NULL,miracli;
|FIN;

|DEFBUCLE 1;        ||Articulos #2
#2#1;
;
"                    ";
"zzzzzzzzzzzzzzzzzzzz";
e;
NULL,miraarti;
|FIN;

|DEFBUCLE 2;        ||Proveedor #3
#3#1;
;
"    ";
"zzzz";
e;
NULL,miraprove;
|FIN;

|DEFBUCLE 3;        ||Comisionista #4
#4#1;
;
"  ";
"zz";
e;
NULL,miracomis;
|FIN;

|DEFBUCLE 4;        ||Albaranes #5
#5#1;
;
"  " ,       0;
"zz" ,  999999;
e;
NULL,miraalba;
|FIN;

|DEFBUCLE 5;            ||Facturas de contado #9 (importar)
#9#1;
;
"  " ,       0;
"zz" ,  999999;
e;
NULL,mirafact;
|FIN;

|DEFBUCLE 6;            ||Tiquet #21 (importar)
#21#1;
;
"  " ,       0;
"zz" ,  999999;
e;
NULL,miratpv;
|FIN;

|DEFBUCLE 7;        ||Historico
#38#1;
;
"                    ","01.01.1900","  ",000000,00000,"  ";
"zzzzzzzzzzzzzzzzzzzz","31.12.9999","zz",999999,99999,"zz";
e;
NULL,mirahis;
|FIN;

|DEFBUCLE CodBarra;
     #26#1;
     ;
     0;
     9999999;
     e;
     NULL, CodBarra;
|FIN;

|DEFBUCLE pasares;
#25#1;
;
0  ,  0 , "00.00.0000";
99 , 99 , "31.12.9999";
e;
NULL , pasar509;
|FIN;

|PROCESO clien;     ||Clientes
     |PINTA 2124,blanco;
     |PINTA 2124,"Clientes";
     |PATH_DAT #1 path;    || Marco camino clientes exportacion
     |ABRE #1;      |CIERRA #1;
     |ABRE #11;
     |BUCLE 0;
     |LIBERA #11;
     |CIERRA #11;
importa = 1;
|FPRC;

|PROCESO arti;      ||Articulo
     |PINTA 2124,blanco;
     |PINTA 2124,"Articulos";
     |PATH_DAT #2 path;    || Marco camino articulos exportacion
     |ABRE #2;      |CIERRA #2;
     |ABRE #12;
     |BUCLE 1;
     |LIBERA #12;
     |CIERRA #12;
importa = 1;
|FPRC;

|PROCESO prove;     ||Proveedores
     |PINTA 2124,blanco;
     |PINTA 2124,"Proveedores";
     |PATH_DAT #3 path;    || Marco camino proveedores exportacion
     |ABRE #3;      |CIERRA #3;
     |ABRE #13;
     |BUCLE 2;
     |LIBERA #13;
     |CIERRA #13;
importa = 1;
|FPRC;

|PROCESO comis;     ||Comisionistas
     |PINTA 2124,blanco;
     |PINTA 2124,"Comisionistas";
     |PATH_DAT #4 path;    || Marco camino comisionistas exportacion
     |ABRE #4;      |CIERRA #4;
     |ABRE #14;
     |BUCLE 3;
     |LIBERA #14;
     |CIERRA #14;
importa = 1;
|FPRC;

|PROCESO histo;     ||Historico
     |PINTA 2124,blanco;
     |PINTA 2124,"Historico";
     |PATH_DAT #38 path;    || Marco camino clientes exportacion
     |ABRE #38;
     |SI FSalida = 0;
         |ABRE #18;
         |BUCLE 7;
         |CIERRA #18;
         importa = 1;
     |FINSI;
|FPRC;

|PROCESO alba; ||albaranes
     |PINTA 2124,blanco;
     |PINTA 2124,"Albaranes";
     |PATH_DAT #5 path;      || Marco camino del fichero de albaranes a importar
     |PATH_DAT #6 path;      || Marco camino del fichero de albaranes Lin. a importar
     |ABRE #5;      |CIERRA #5;     || Abro fichero de albaranes a importar
     |ABRE #6;      |CIERRA #6;     || Abro fichero de lin albaranes a importar
     |ABRE #15;     ||ALbaranes
     |ABRE #16;     ||Lineas de albaran
     |BUCLE 4;
     |CIERRA #15;
     |CIERRA #16;
importa = 1;
|FPRC;

|PROCESO cont; ||Facturas de contado
     |PINTA 2124,blanco;
     |PINTA 2124,"Facturas ";
     |PATH_DAT #9 path;      || Marco camino del fichero de facturas a importar
     |PATH_DAT #10 path;      || Marco camino del fichero de facturas Lin. a importar
     |ABRE #9;      |CIERRA #9;   || Abro fichero de facturas a importar
     |ABRE #10;     |CIERRA #10;  || Abro fichero de lin facturas a importar
     |ABRE #19;     ||Facturas contado
     |ABRE #20;     ||Lineas de factura contado
     |BUCLE 5;
     |CIERRA #15;
     |CIERRA #16;
importa = 1;
|FPRC;

|PROCESO tique;     ||Tiquets
     |PINTA 2124,blanco;
     |PINTA 2124,"Tiquets  ";
     |PATH_DAT #21 path;      || Marco camino del fichero de tiquets a importar
     |PATH_DAT #22 path;      || Marco camino del fichero de tiquets Lin. a importar
     |ABRE #21;     |CIERRA #21;      || Abro fichero de tiquets a importar
     |ABRE #22;     |CIERRA #22;      || Abro fichero de lin tiquets a importar
     |ABRE #31;     ||tiquets
     |ABRE #32;     ||Lineas de tiquets
     |BUCLE 6;
     |CIERRA #32;
     |CIERRA #31;
importa = 1;
|FPRC;

|PROCESO cobro;     ||Cobros
     |PINTA 2124,blanco;
     |PINTA 2124,"Cobros";
     |PATH_DAT #23 path;    || Marco camino cobros exportacion
     |ABRE #23;
     |ABRE #33;
     |LEE 001#23p;
     |PARA ; |SI FSalida = 0; |HACIENDO;
          |HAZ miracobro;
          |LEE 001#23s;
     |SIGUE;
     |CIERRA #33;
     |CIERRA #23;
importa = 1;
|FPRC;

|PROCESO pagos;     ||Pagos
     |PINTA 2124,blanco;
     |PINTA 2124,"Pagos";
     |PATH_DAT #24 path;    || Marco camino Pagos exportacion
     |ABRE #24;
     |ABRE #34;
     |LEE 001#24p;
     |PARA ;|SI FSalida = 0; |HACIENDO;
          |HAZ mirapago;
          |LEE 001#24s;
     |SIGUE;
     |CIERRA #34;
     |CIERRA #24;
importa = 1;
|FPRC;

|PROCESO Barra;
     |PINTA 2124,blanco;
     |PINTA 2124,"Cod.Barras";
     |PATH_DAT #26 path;    || Marco camino comisionistas exportacion
     |ABRE #26;      |CIERRA #26;
     |ABRE #36;
     |BUCLE CodBarra;
     |LIBERA #36;
     |CIERRA #36;
importa = 1;
|FPRC;

|PROCESO testig;
     |SI importa = 1;    ||Es se¤al de que ha podido importar datos
          |PATH_DAT #61 path;
          |ABRE #61;
          |LEE 101#61=;
          #61#4 = "S";
          fechaimp = ~;
          #61#5 = fechaimp;
          |HORA hora;
          horat = hora % 102 + hora % 402;
          #61#6 = horat;
          |GRABA 001#61a;
          |LIBERA #61;
          |CIERRA #61;
     |FINSI;
|FPRC;

|PROCESO cierre;
     |PATH_DAT #25 path;
     |ABRE #25;     |CIERRA #25;
     |ABRE #35;
     |BUCLE pasares;
     |CIERRA #35;
|FPRC;


|PROCESO vic;       || Ver donde se acumula.......................

   |ACABA;

   |SI fp = 1; vics=#22#20; vicr=#22#0; vicl=#22#1; |ACABA; |FINSI;

   |SI tt = 0; tt=1; vics=#22#20; vicr=#22#0; vicl=#22#1; acuta=acuta+#22#7; acua=acua+#22#7; |ACABA; |FINSI;
   acu=acub + #22#7;
   |SI acu > victb; vics=#22#20; vicr=#22#0; vicl=#22#1; acuta=acuta+#22#7; acua=acua+#22#7; |ACABA; |FINSI;

   acutb = acutb + #22#7;
   acub  = acub  + #22#7;

   |SI cabt = 0;
       cabt = 1;
       |ABRE #77;
       |DDEFECTO #77;
       |LEE 101#77p;
       ffs=FSalida;
       vicss=#77#1;
       vicrr=#77#2;
       vicll=0;
       jj = #77#2;
       jj =jj+1;
       #77#2 = jj;
       ll = jj;
       |QBF ll;
       #77#2 = ("000000" + ll) %-106;
       |SI ffs = 0;   |GRABA 020#77a; |FINSI;
       |SI ffs ! 0;   |GRABA 020#77n; |FINSI;
       |LIBERA #77;
       |CIERRA #77;
   |FINSI;
       vics=vicss;
       vicr=vicrr;
       vicll=vicll+1;
       vicl=vicll;
|FPRC;

|PROCESO fop;
      |ABRE #77;
      |DDEFECTO #77;
      |LEE 000#77p;
      |SI FSalida ! 0;
          porc=0;
          fp=0;
          #77#1="  ";
          #77#2="000000";
          #77#3=" ";
          #77#4=" ";
          #77#5=" ";
          #77#6=" ";
          #77#7=0;
          |GRABA 020#77b;
      |FINSI;
      porc=#77#7;
      |SI #21#31 =  #77#3;
          fp=1;
      |FINSI;
      |SI #21#31 =  #77#4;
          fp=1;
      |FINSI;
      |SI #21#31 =  #77#5;
          fp=1;
      |FINSI;
      |SI #21#31 =  #77#6;
          fp=1;
      |FINSI;
      |CIERRA #77;
|FPRC;
=======================================================================
|PROCESO Importa;
     importa = 0;
     |SI #0#6 = "S";     |HAZ clien;    |FINSI;
     |SI #0#7 = "S";     |HAZ arti;     |FINSI;
     |SI #0#8 = "S";     |HAZ prove;    |FINSI;
     |SI #0#9 = "S";     |HAZ comis;    |FINSI;
     |SI #0#22 = "S";     |HAZ histo;    |FINSI;
     |ABRE #11;     ||Abro clientes
     |ABRE #12;     ||Articulos
     |ABRE #17;     ||Almacenes
     |ABRE #18;     ||Historico
     |SI #0#10 = "S";    |HAZ alba;     |FINSI;
     |SI #0#11 = "S";    |HAZ cont;     |FINSI;
     |SI #0#12 = "S";    |HAZ tique;    |FINSI;
     |CIERRA #11;
     |CIERRA #12;
     |CIERRA #17;
     |CIERRA #18;
     |SI #0#13 = "S";    |HAZ cobro;    |FINSI;
     |SI #0#14 = "S";    |HAZ pagos;    |FINSI;
     |SI #0#23 = "S";    |HAZ Barra;    |FINSI;
     |SI importa = 1;    |HAZ testig;   |FINSI;
     |HAZ cierre;
|FPRC;

|PROCESO agifa556;

     path = #50#1; |QBF path;
     |SI path = ""; |ACABA; |FINSI;
     noborres = 0;

     |HAZ descompresion;
     |PATH_DAT #61 path;
     |ABRE #61;
     |LEE 001#61p;
     |SI FSalida ! 0;
          mensaje = "0000No encuentro testigo para tienda: " + #50#0;
          noborres = 1;
          |MENAV mensaje;
          |CIERRA #61;
          |ACABA;
     |FINSI;
     |SI #61#0 = #50#0;
          |PINTA 1535 , #61#1;
          |SI #61#4 = "S";
               |AVISO;
               |PINTA 1635 , #61#5;
               hora = #61#6;
               horat = hora % 102 + ":" + hora % 302;
               |PINTA 1735 , horat;
               hora = "";
               horat =  "";
               |CONFI "2400N!!ATENCION!! Esta Empresa ya ha sido importada, Repetir Importacion :";
               |SI FSalida ! 0; |ACABA;  |FINSI;
          |FINSI;
          |HAZ Importa;
           ||davith. Importacion de sobres------
          |HAZ ImportaSobres;
          |CIERRAT #61;
          |HAZ borracomp;
     |SINO;
          mensaje = "0000Esta empresa No se corresponde con la empresa de importacion:" + #61#0;
          |MENAV mensaje;
     |FINSI;
     |CIERRA #61;
|FPRC;

|DEFBUCLE agifa556;
     #50#1;
     ;
     #0#20;
     #0#21;
     ;
     NULL, agifa556;
|FIN;

|PROCESO LineasF;
  #139#0=#119#0;
  #139#1=#119#1;
  |LEE 000#139=;   ||FindKey...
  nSalida=FSalida;
  |PARA i=0; |SI i [ n016; |HACIENDO i=i+1;
     #139i=#119i;
  |SIGUE;
  |SI nSalida=0;
      |GRABA 020#139a;
  |SINO;
      |GRABA 020#139n;
  |FINSI;
|FPRC;

|DEFBUCLE LineasF;
  #119#1;
  ;
  #118#0,1;
  #118#0,999;
  be;
  NULL,LineasF;
|FIN;

|PROCESO SobresF;
  #138#0=#118#0;
  |LEE 000#138=;   ||FindKey...
  nSalida=FSalida;
   |SI nSalida!0; ||No encontrado
     |PARA i=0; |SI i [ n015; |HACIENDO i=i+1;
       #138i=#118i;
     |SIGUE;
     |GRABA 022#138n;
     |BUCLE LineasF;
   |SINO;
    |SI #138#5 ! "R"; ||Si ya esta recogido no se hace nada
     |PARA i=0; |SI i [ n015; |HACIENDO i=i+1;
       #138i=#118i;
     |SIGUE;
     |SI nSalida=0; ||Encontrado
       |GRABA 022#138a;
     |SINO;         ||No encontrado
       |GRABA 022#138n;
     |FINSI;
     |BUCLE LineasF;
    |FINSI;
   |FINSI;
|FPRC;

|DEFBUCLE SobresF;
  #118#1;
  1,16;
  #0#29,#0#27,#0#25;
  #0#30,#0#28,#0#26;
  be;
  NULL,SobresF;
|FIN;

|PROCESO LineasR;
  #139#0=#129#0;
  #139#1=#129#1;
  |LEE 000#139=;   ||FindKey...
  nSalida=FSalida;
  |PARA i=0; |SI i [ n016; |HACIENDO i=i+1;
     #139i=#129i;
  |SIGUE;
  |SI nSalida=0;
      |GRABA 020#139a;
  |SINO;
      |GRABA 020#139n;
  |FINSI;
|FPRC;

|DEFBUCLE LineasR;
  #129#1;
  ;
  #128#0,1;
  #128#0,999;
  be;
  NULL,LineasR;
|FIN;

|PROCESO SobresR;
  #138#0=#128#0;
  |LEE 000#138=;   ||FindKey...
  |SI FSalida ! 0;
    |PARA i=0; |SI i [ n015; |HACIENDO i=i+1;
      #138i=#128i;
    |SIGUE;
    |GRABA 020#138n;
    |BUCLE LineasR;
  |FINSI;
|FPRC;

|DEFBUCLE SobresR;
  #128#1;
  1,16;
  #0#36,#0#34,#0#32;
  #0#37,#0#35,#0#33;
  be;
  NULL,SobresR;
|FIN;

|PROCESO ImportaSobres;
     ||SobresF. davith,------------------------------------------------------
     |SI #0#24 = "S";|O #0#24 = "s";
       |PINTA 2124, blanco;
       |PINTA 2124, "Sob. fact.";
       |PATH_DAT #118 path;|PATH_DAT #119 path;
       |ABRE #118; ||Cabecera F
       |ABRE #119; ||Lineas F
       |ABRE #138;
       |ABRE #139;
       |BUCLE SobresF;
       |CIERRA #138;
       |CIERRA #139;
       |CIERRA #118;
       |CIERRA #119;
     |FINSI;

     ||SobresR
     |SI #0#31 = "S";|O #0#31 = "s";
       |PINTA 2124, blanco;
       |PINTA 2124, "Sob. recog.";
       |PATH_DAT #128 path;|PATH_DAT #129 path;
       |ABRE #128; ||Cabecera R
       |ABRE #129; ||Lineas R
       |ABRE #138;
       |ABRE #139;
       |BUCLE SobresR;
       |CIERRA #138;
       |CIERRA #139;
       |CIERRA #128;
       |CIERRA #129;
     |FINSI;
|FPRC;

|PROCESO inicio;|TIPO 3;
     |SI #0#15 ! "SI"; |ACABA;  |FINSI;
     |HAZ BusCampos;
     |SI err ! 0;
          |MENAV "0000Proceso Abortado...";
     |SINO;
          |CONFI "0000SRecibir datos desde delegaciones ahora: ";
          |SI FSalida = 0;
             |MENAV "0000Atencion!! Debe estar conectado a internet";
             |SUB_EJECUTA "foto0101.tab"; ||Recibe tantas veces como dele. haya
          |FINSI;
          |BUCLE agifa556;
     |FINSI;

     |CONFI "    NRecalcular stocks a continuacion (S/N): ";
     |SI FSalida=0;
         |SUB_EJECUTA "agifa068.tab";
     |FINSI;
|FPRC;
=======================================================================
|PROCESO LeeDDX;
     fdef = def + fich; fdes = org + fich;
     |LEEDEDEF fdef, fdes;
     |SI exp = 1; |Y FSalida = -1;
          fich = fdes + ".dat"; |FBORRA fich;
          fich = fdes + ".ixx"; |FBORRA fich;
          fich = fdes + ".ddx"; |FBORRA fich;
          |LEEDEDEF fdef, fdes;
          |MENAV "0000Fichero exportacion reparado...";
     |FINSI;
     eaNomDef = fich;
     |HAZ CamposDef;
     num = enCamposDef;
|FPRC;

|PROCESO BusCampos;
     |DFICE org; |QBF org;
     |DBASE des; |QBF des;
     |DDEF  def; |QBF def;
     err = 0;

     exp = 0; fich = "agifa024"; |HAZ LeeDDX; n024 = num;
     exp = 1; fich = "expor024"; |HAZ LeeDDX;
     |SI n024 ! num;
          |MENAV "0000Fichero enlace Clientes incorrecto..."; err = 1;
     |FINSI;

     exp = 0; fich = "agifa019"; |HAZ LeeDDX; n019 = num;
     exp = 1; fich = "expor019"; |HAZ LeeDDX;
     |SI n019 ! num;
          |MENAV "0000Fichero enlace Articulos incorrecto..."; err = 1;
     |FINSI;

     exp = 0; fich = "agifa112"; |HAZ LeeDDX; n112 = num;
     exp = 1; fich = "expor112"; |HAZ LeeDDX;
     |SI n112 ! num;
          |MENAV "0000Fichero enlace Proveedores incorrecto..."; err = 1;
     |FINSI;

     exp = 0; fich = "agifa025"; |HAZ LeeDDX; n025 = num;
     exp = 1; fich = "expor025"; |HAZ LeeDDX;
     |SI n025 ! num;
          |MENAV "0000Fichero enlace Representantes incorrecto..."; err = 1;
     |FINSI;

     exp = 0; fich = "agifa010"; |HAZ LeeDDX; n010 = num;
     exp = 1; fich = "expor010"; |HAZ LeeDDX;
     |SI n010 ! num;
          |MENAV "0000Fichero enlace Albaran (C) incorrecto..."; err = 1;
     |FINSI;

     exp = 0; fich = "agifa071"; |HAZ LeeDDX; n071 = num;
     exp = 1; fich = "expor071"; |HAZ LeeDDX;
     |SI n071 ! num;
          |MENAV "0000Fichero enlace Albaran (L) incorrecto..."; err = 1;
     |FINSI;

     exp = 0; fich = "agifa084"; |HAZ LeeDDX; n084 = num;
     exp = 1; fich = "expor084"; |HAZ LeeDDX;
     |SI n084 ! num;
          |MENAV "0000Fichero enlace Facturas (C) incorrecto..."; err = 1;
     |FINSI;

     exp = 0; fich = "agifa069"; |HAZ LeeDDX; n069 = num;
     exp = 1; fich = "expor069"; |HAZ LeeDDX;
     |SI n069 ! num;
          |MENAV "0000Fichero enlace Facturas (L) incorrecto..."; err = 1;
     |FINSI;

     exp = 0; fich = "agifa501"; |HAZ LeeDDX; n501 = num;
     exp = 1; fich = "expor501"; |HAZ LeeDDX;
     |SI n501 ! num;
          |MENAV "0000Fichero enlace TPV (C) incorrecto..."; err = 1;
     |FINSI;

     exp = 0; fich = "agifa502"; |HAZ LeeDDX; n502 = num;
     exp = 1; fich = "expor502"; |HAZ LeeDDX;
     |SI n502 ! num;
          |MENAV "0000Fichero enlace TPV (L) incorrecto..."; err = 1;
     |FINSI;

     exp = 0; fich = "agifa513"; |HAZ LeeDDX; n513 = num;
     exp = 1; fich = "expor513"; |HAZ LeeDDX;
     |SI n513 ! num;
          |MENAV "0000Fichero enlace Cobros incorrecto..."; err = 1;
     |FINSI;

     exp = 0; fich = "agifa512"; |HAZ LeeDDX; n512 = num;
     exp = 1; fich = "expor512"; |HAZ LeeDDX;
     |SI n512 ! num;
          |MENAV "0000Fichero enlace Pagos incorrecto..."; err = 1;
     |FINSI;

     exp = 0; fich = "agifa509"; |HAZ LeeDDX; n509 = num;
     exp = 1; fich = "expor509"; |HAZ LeeDDX;
     |SI n509 ! num;
          |MENAV "0000Fichero enlace Resumen incorrecto..."; err = 1;
     |FINSI;

     exp = 0; fich = "agifa065"; |HAZ LeeDDX; n565 = num;
     exp = 1; fich = "expor065"; |HAZ LeeDDX;
     |SI n565 ! num;
          |MENAV "0000Fichero enlace Historico incorrecto..."; err = 1;
     |FINSI;

     exp = 0; fich = "dsl00001"; |HAZ LeeDDX; n001 = num;
     exp = 1; fich = "expor001"; |HAZ LeeDDX;
     |SI n001 ! num;
          |MENAV "0000Fichero enlace Cod.Barras incorrecto..."; err = 1;
     |FINSI;

     exp = 0; fich = "foto0015"; |HAZ LeeDDX; n015 = num;
     exp = 1; fich = "foto0x18"; |HAZ LeeDDX;
     |SI n015 ! num;
          |MENAV "0000Fichero enlace Cab. Sobres incorrecto..."; err = 1;
     |FINSI;
     exp = 1; fich = "foto0x19"; |HAZ LeeDDX;
     |SI n015 ! num;
          |MENAV "0000Fichero enlace Cab. Sobres incorrecto..."; err = 1;
     |FINSI;

     exp = 0; fich = "foto0016"; |HAZ LeeDDX; n016 = num;
     exp = 1; fich = "foto0z18"; |HAZ LeeDDX;
     |SI n016 ! num;
          |MENAV "0000Fichero enlace Lin. Sobres incorrecto..."; err = 1;
     |FINSI;
     exp = 1; fich = "foto0z19"; |HAZ LeeDDX;
     |SI n016 ! num;
          |MENAV "0000Fichero enlace Lin. Sobres incorrecto..."; err = 1;
     |FINSI;
|FPRC;

|PROCESO DefectosF; ||davith.
|SI #0#24 = "N";|O #0#24 = "n";
  |C_M #0#25, 1, "N";
  |C_M #0#26, 1, "N";
  |C_M #0#27, 1, "N";
  |C_M #0#28, 1, "N";
  |C_M #0#29, 1, "N";
  |C_M #0#30, 1, "N";
|SINO;
  |C_M #0#25, 1, "S";
  |C_M #0#26, 1, "S";
  |C_M #0#27, 1, "S";
  |C_M #0#28, 1, "S";
  |C_M #0#29, 1, "S";
  |C_M #0#30, 1, "S";
|FINSI;
|FPRC;

|PROCESO DefectosR; ||davith.
|SI #0#31 = "N";|O #0#31 = "n";
  |C_M #0#32, 1, "N";
  |C_M #0#33, 1, "N";
  |C_M #0#34, 1, "N";
  |C_M #0#35, 1, "N";
  |C_M #0#36, 1, "N";
  |C_M #0#37, 1, "N";
|SINO;
  |C_M #0#32, 1, "S";
  |C_M #0#33, 1, "S";
  |C_M #0#34, 1, "S";
  |C_M #0#35, 1, "S";
  |C_M #0#36, 1, "S";
  |C_M #0#37, 1, "S";
|FINSI;
|FPRC;


|PROCESO descompresion;
     noborres = 0;
     |MENSA "0000Descomprimiendo los datos...";
     atgz = path + "expor";
     atgz = atgz + #50#0;
     |QBF atgz;
     atar = atgz + ".tar";
     atgz = atgz + ".tgz";
     |QBF atgz;
     |QUE_SISTEMA asystem;
     |SI asystem = "ESBSD";
        asystem2 = "chmod 777 " + atgz;
        |SYSTEM asystem2;
     |FINSI;
     |DESCOMPRIME atgz;
     |SI FSalida = 0;
        atar2 = atar + " *.dat"; ||Si *.* se cuelga
        atar3 = atar + " *.ixx"; ||Si *.* se cuelga
        atar4 = atar + " *.ddx"; ||Si *.* se cuelga
        |QBF atar2;
        |QBF atar3;
        |QBF atar4;
        |SI asystem = "ESBSD";
            asystem2 = "chmod 777 " + path + "*.*";
            |SYSTEM asystem2;
        |FINSI;
        |DETAR atar2,path;
        |DETAR atar3,path;
        |DETAR atar4,path;
        |SI asystem = "ESBSD";
            |SYSTEM asystem2;
        |FINSI;
     |SINO;
        mensaje = "0000Error al descomprimir los datos de la tienda " + #50#0;
        |MENAV mensaje;
        noborres = 1;
        |ERROR;
     |FINSI;
|FPRC;

|PROCESO borracomp;
     |MENSA "0000Borrando comprimidos....";
     |FBORRA atar; ||Borro el tar
     |SI noborres = 0;
        |FBORRA atgz; ||Borro el tgz
     |FINSI;
     aexpor = path + "testigo.dat";
     |FBORRA aexpor;
     aexpor = path + "testigo.ddx";
     |FBORRA aexpor;
     aexpor = path + "testigo.ixx";
     |FBORRA aexpor;
     |PARA i=1;|SI i < 10;|HACIENDO i = i + 1;
         aexpor = path + "expor00" + i;
         aexpor2 = aexpor + ".dat";
         |FBORRA aexpor2;
         aexpor2 = aexpor + ".ixx";
         |FBORRA aexpor2;
         aexpor2 = aexpor + ".ddx";
         |FBORRA aexpor2;
     |SIGUE;
    |PARA i=10;|SI i < 100;|HACIENDO i = i + 1;
        aexpor = path + "expor0" + i;
        aexpor2 = aexpor + ".dat";
        |FBORRA aexpor2;
        aexpor2 = aexpor + ".ixx";
        |FBORRA aexpor2;
        aexpor2 = aexpor + ".ddx";
        |FBORRA aexpor2;
    |SIGUE;
    |PARA i=100;|SI i < 1000;|HACIENDO i = i + 1;
        aexpor = path + "expor" + i;
        aexpor2 = aexpor + ".dat";
        |FBORRA aexpor2;
        aexpor2 = aexpor + ".ixx";
        |FBORRA aexpor2;
        aexpor2 = aexpor + ".ddx";
        |FBORRA aexpor2;
    |SIGUE;
    aexpor= path + "foto0x18";
    aexpor2 = aexpor + ".dat";
    |FBORRA aexpor2;
    aexpor2 = aexpor + ".ixx";
    |FBORRA aexpor2;
    aexpor2 = aexpor + ".ddx";
    |FBORRA aexpor2;
    aexpor= path + "foto0z18";
    aexpor2 = aexpor + ".dat";
    |FBORRA aexpor2;
    aexpor2 = aexpor + ".ixx";
    |FBORRA aexpor2;
    aexpor2 = aexpor + ".ddx";
    |FBORRA aexpor2;
    aexpor= path + "foto0x19";
    aexpor2 = aexpor + ".dat";
    |FBORRA aexpor2;
    aexpor2 = aexpor + ".ixx";
    |FBORRA aexpor2;
    aexpor2 = aexpor + ".ddx";
    |FBORRA aexpor2;
    aexpor= path + "foto0z19";
    aexpor2 = aexpor + ".dat";
    |FBORRA aexpor2;
    aexpor2 = aexpor + ".ixx";
    |FBORRA aexpor2;
    aexpor2 = aexpor + ".ddx";
    |FBORRA aexpor2;
|FPRC;
