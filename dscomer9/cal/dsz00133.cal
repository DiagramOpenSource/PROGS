|FICHEROS;
     dsz00133 #0;
     agifa024 #24;
     dsm00282 #282,MANTE;
     dscam003@;
     dscam044@;
     dscam045@;
     dsm00282@;
|FIN;

|VARIABLES;
     aTmp        = "";
     aAlfa       = "";
     aEmp        = "";
     aBase       = "";
     aEstado     = "";
     aDef        = "";

     nPdte       = 0;
     nEmpresa    = 0;
     nTota       = 0;
     nPos        = 0;
     nModo       = 0;
     nDia        = 0;

     fFecha      = @;

     &eaCliente  = "";
     &enDocu     = 0;
     &nDeci_Base = 0;
     &Tempo      = "";
|FIN;

|PROCESO DefFecha; |TIPO 7;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 1;
          #282#1 = ~;
     |FINSI;
|FPRC;

|PROCESO T11; |TIPO 11;
     |SI FSalida = 13;
          |ABRE #24;
          #24#0 = eaCliente;
          |LEE 121#24=;
          |SI FSalida = 0;
               |SI #24#49 < 0;  #24#49 = 0;  |FINSI;
               |SI #24#49 > 2;  #24#49 = 0;  |FINSI;

               #24#49 = (#24#49 + 1) $ 3;
               |GRABA 020#24a;
               |LIBERA #24;
               |HAZ PintaEstado;
               |ERROR;
          |FINSI;
          |CIERRA #24;
     |FINSI;
|FPRC;

|PROCESO Max282;
     #282#0 = #dsz00133#10;
     #282#1 = "01.01.2000";
|FPRC;

|PROCESO Min282;
     #282#0 = #dsz00133#10;
     #282#1 = "31.12.9999";
|FPRC;

|PROCESO T0; |TIPO 0;
     |SI FSalida = 0;
         |SI #dsz00133#10 = "      ";
             #dsz00133#10 = eaCliente;
         |FINSI;

         |ENTLINEAL #1#282, 1, 2, 23, 0, Min282, Max282;
     |FINSI;
|FPRC;

|PROCESO T7; |TIPO 7;
     |SI #dsz00133#10 = "      ";
         #dsz00133#10 = eaCliente;
     |FINSI;

     |ENTLINEAL #1#282, 1, 7, 23, 0, Min282, Max282;

     |ABRE #282;
     #282#0 = #dsz00133#10;
     #282#1 = "31.12.9999";
     |LEE 000#282];
     |SI FSalida ! 0; |O #282#0 ! #dsz00133#10;
          |DDEFECTO #282;
     |FINSI;
     |PINTA #282#2;
     |PINTA #282#3;
     |PINTA #282#4;
     |PINTA #282#5;
     |CIERRA #282;
|FPRC;


|PROCESO Recibos;
     aAlfa = #dscam003@#0 % 102;
     |SI aAlfa = "TF";  |O aAlfa = "IN";
         |ACABA;
     |FINSI;

     |SI #dscam003@#14 ! "I";  |Y #dscam003@#14 ! "C";  |Y #dscam003@#14 ! "P";
         |ACABA;
     |FINSI;

     nPdte = #dscam003@#65 ! nDeci_Base;
     |SI nPdte ! 0;
          |SI #dscam003@#46 = 0; |O #dscam003@#46 = nEmpresa;
               #0#8  = #dscam045@#6;
               #0#0  = #dscam003@#40;
               #0#1  = #dscam003@#99
               #0#2  = #dscam003@#3;
               #0#3  = #dscam003@#26;
               #0#4  = #dscam003@#65;
               #0#5  = #dscam003@#0;
               #0#6  = #dscam003@#1;
               #0#7  = #dscam003@#2;
               #0#9  = #dscam003@#36;
               #0#10 = #dscam003@#32;
               |GRABA 020#0n;
               |LIBERA #0;

               |SI FSalida = 0;
                    nTota = nTota + #0#4;
               |FINSI;
          |FINSI;
     |FINSI;

     |PULSATECLA;
|FPRC;

|DEFBUCLE Recibos;
     #dscam003@#1001;
     5;
     000000001, #agifa024#16;
     999999999, #agifa024#16;
     ;
     NULL, Recibos;
|FIN;

|PROCESO dscam045;
     aAlfa = ("00000" + #dscam045@#6) % -105;
     |SI aAlfa = aEmp;  |ACABA;  |FINSI;

     aEmp = ("00000" + #dscam045@#6) % -105;
     aAlfa = aBase + "dscarter/fich/" + aEmp + "/";
     |PATH_DAT #dscam003@#aAlfa#;

     |BUCLE Recibos;
|FPRC;

|DEFBUCLE dscam045;
     #dscam045@#2001;
     0, 2;
     00001, nEmpresa, "V";
     99999, nEmpresa, "V";
     ;
     NULL, dscam045;
|FIN;

|PROCESO CargaPdte;
     nTota = 0;

     |DBASS aBase;
     aAlfa = aBase + "dscarter/def/dscam045";
     |CARGA_DEF aAlfa, dscam045@;
     |SI FSalida = 0;
          aAlfa = aBase + "dscarter/def/dscam044";
          |CARGA_DEF aAlfa, dscam044@;
          |SI FSalida = 0;
               aAlfa = aBase + "dscarter/def/dscam003";
               |CARGA_DEF aAlfa, dscam003@;
               |SI FSalida = 0;
                    |DFICE aAlfa;
                    aAlfa = aAlfa % -205;
                    nEmpresa = aAlfa;
                    aAlfa = aBase + "dscarter/fich/";
                    |PATH_DAT #dscam045@#aAlfa#;
                    |BUCLE dscam045;
                    |DESCARGA_DEF #dscam003@;
               |FINSI;
               |DESCARGA_DEF #dscam044@;
          |FINSI;
          |DESCARGA_DEF #dscam045@;
     |FINSI;
|FPRC;

|PROCESO Min;
     #0#0 = 999999999;
     #0#8 = 1;
|FPRC;

|PROCESO Max;
     #0#0 = 000000001;
     #0#8 = 99999;
|FPRC;

|PROCESO PintaEstado;
     |SI #24#49 < 0;  #24#49 = 0;  |FINSI;
     |SI #24#49 > 2;  #24#49 = 0;  |FINSI;

     aEstado = "         ";
     |SI #24#49 = 1;
          aEstado = "CORTADO  ";
     |SINO;
          |SI #24#49 = 2;
               aEstado = "BLOQUEADO";
          |FINSI;
     |FINSI;

     |C_A #24#16, 1, 9;
     #24#16 = aEstado;
     |PINTA 1850, #24#16;
|FPRC;

|PROGRAMA;
|DEBUG;
     |ABRE #24;
     #24#0 = eaCliente;
     |LEE 000#24=;
     |CIERRA #24;

     |DDEF aDef;
     aDef = aDef + "dsm00282.mas";
     |CARGA_DEF aDef, dsm00282@;

     |ABRE #dsm00282;
     |ABRE #dsm00282@;
     |SELECT #2#dsm00282;
     |LEE 000#dsm00282.p;
     |PARA;  |SI FSalida = 0;  |HACIENDO;
          |SI #dsm00282#1 ] "01.01.2000";
              |SAL;
          |FINSI;

          fFecha = "01.01.2000";
          |PARA;  |SI;  |HACIENDO;
               #dsm00282@#0 = #dsm00282#0;
               #dsm00282@#1 = fFecha;
               |LEE 000#dsm00282@.=;
               |SI FSalida ! 0;
                   |DDEFECTO #dsm00282@;
                    #dsm00282@#0 = #dsm00282#0;
                    #dsm00282@#1 = fFecha;
                    #dsm00282@#2 = #dsm00282#2;
                    #dsm00282@#3 = #dsm00282#3;
                    #dsm00282@#4 = #dsm00282#4;
                    #dsm00282@#5 = #dsm00282#5;
                    |GRABA 020#dsm00282@.n;
                    |LIBERA #dsm00282@;

                    |BORRA 020#dsm00282.a;
                    |LIBERA #dsm00282;

                    |SAL;
               |FINSI;
               nDia   = fFecha;
               nDia   = nDia + 1;
               fFecha = nDia;
          |SIGUE;

          |LEE 000#dsm00282.s;
     |SIGUE;
     |CIERRA #dsm00282;


     |HAZ DecimalesBase;
     |PINPA #0#0;
     |PINPA #0#282;
     |HAZ CreaTempo;
     |NOME_DAT #0 Tempo; |DELINDEX #0; aTmp = Tempo;
     |ABRE #0;

     |HAZ CargaPdte;

     |HAZ PintaEstado;

     |C_P #0#4, 0, nPos;
     |C_P #0#4, 1, 0768;
     #0#4 = nTota; |PINTA #0#4;
     |C_P #0#4, 1, nPos;

     |ENTLINEAL #1#0, 1, 4, 17, 0, Min, Max;
     |CIERRA #0;
     Tempo = aTmp; |HAZ BoraTempo; |DELINDEX #0;
|FPRO;
