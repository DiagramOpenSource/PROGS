     GuiCreaLineas

|FICHEROS;
     agifa071 #0;
     agifa010 #1;
     agifa019 #2;
     referen1@;
|FIN;

|VARIABLES;
     &enUltLin = 0;
     &enForma = 0;
     &enCoste = 0;
     nMarca = 0;
     nLin = 0;
     nUni = 0;
     aAlfa = "";
     aArtEnv = "";
     aArtUni = "";
     aDato = "";
     aArti = "";
|FIN;

|RUTINA GuiCreaLineas0;
     |DDEF aAlfa; aAlfa = aAlfa + "agifa071";
     |CARGA_DEF aAlfa, referen1@;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |DDEFECTO #2;
     |ABRE #2;
     #2#0 = aArti;
     |LEE 000#2=;
     |CIERRA #2;

     |ABRE #referen1@;
     #referen1@#29 = #0#29;
     #referen1@#0 = #0#0;
     #referen1@#1 = nLin;
     |LEE 000#referen1@.=;
     |SI FSalida = 0;
          |SALVA_DATOS #0;
          |SALVA_DATOS #referen1@;
          |REPON_DATOS #0;
          #0#1 = #referen1@#1;
          enForma = -1;
          |HAZ CalCabAgifa010_2;
          |HAZ AcumulaAV;
          |REPON_DATOS #0;
     |SINO;
          #referen1@#1 = 999;
          |LEE 000#referen1@.];
          |SI FSalida = 0;
               |LEE 000#referen1@.a;
          |SINO;
               |LEE 000#referen1@.u;
          |FINSI;
          |SI FSalida = 0; |Y #referen1@#29 = #0#29;  |Y #referen1@#0 = #0#0;
               nLin = #referen1@#1 + 1;
          |SINO;
               nLin = 1;
          |FINSI;
          |SI nLin = #0#1; nLin = nLin + 1; |FINSI;
          #referen1@#29 = #0#29;
          #referen1@#0 = #0#0;
          #referen1@#1 = nLin;
          |GRABA 020#referen1@.b;
     |FINSI;

     |SALVA_DATOS #0;
     |REPON_DATOS #referen1@;

     #referen1@#1 = nLin;
     #referen1@#2 = #2#0;
     #referen1@#4 = #2#1;
     #referen1@#5 = nUni;
     #referen1@#6 = #2#18;
     #referen1@#8 = 0;
     #referen1@#11 = #2#30;
     #referen1@#13 = #2#2;
     #referen1@#14 = enCoste;
     #referen1@#33 = 0;
     #referen1@#36 = #referen1@#6;
     #referen1@#63 = -2;
     #referen1@#64 = 0;
     #referen1@#65 = 0;
     #referen1@#66 = 0;

     |SALVA_DATOS #0;

     |SALVA_DATOS #referen1@;
     |REPON_DATOS #0;
     #0#1 = #referen1@#1;
     enForma = 1;

     |HAZ TotalLin71;
     |HAZ CalCabAgifa010_2;
     |HAZ AcumulaAV;

     |SALVA_DATOS #0;
     |REPON_DATOS #referen1@;
     |GRABA 020#referen1@.a;

     |REPON_DATOS #0;

     |CIERRA #referen1@;
     |DESCARGA_DEF #referen1@;
|FRUT;

|PROCESO LineasAlba;
     |ABRE #2;
     #2#0 = #0#2;
     |LEE 000#2=;
     |CIERRA #2;

     nMarca = #2#126;
     |DDEF aAlfa;
     aAlfa = aAlfa + "guillm01";
     |CARGA_DEF aAlfa, referen1@;
     |SI FSalida = 0;
          |DDEFECTO #referen1@;
          |ABRE #referen1@;
          #referen1@#0 = #0#2;
          |LEE 000#referen1@.=;
          |CIERRA #referen1@;

          aArtEnv = #referen1@#1; |QBF aArtEnv;
          aArtUni = #referen1@#2; |QBF aArtUni;
          |DESCARGA_DEF #referen1@;
     |FINSI;

     aDato = #0#47;
     #0#47 = ""; || Se guardan las lineas creadas en este campo
     |SI aArtEnv ! "";
          nUni = #0#66 + #0#5;
          aArti = aArtEnv;
          aAlfa = aDato % 103; nLin = aAlfa;

          |HAZ GuiCreaLineas0;

          aAlfa = ("000" + nLin) % -103;
          #0#47 = aAlfa;
     |FINSI;
     |SI aArtUni ! "";
          nUni = (#0#66 + #0#5) * nMarca;
          aArti = aArtUni;
          aAlfa = aDato % 403; nLin = aAlfa;

          |HAZ GuiCreaLineas0;

          aAlfa = #0#47 % 103;
          aAlfa = aAlfa + (("000" + nLin) % -103);
          #0#47 = aAlfa;
     |FINSI;
     |GRABA 020#0a;
     |LIBERA #0;
|FPRC;

|DEFBUCLE LineasAlba;
     #0#1;
     63;                      || las negativas son lineas de promocion
     #1#52, #1#0, 001, 0;
     #1#52, #1#0, enUltLin, 999;
     be;
     NULL, LineasAlba;
|FIN;

|PROCESO GuiCreaLineas;
     |BUCLE LineasAlba;
|FPRC;
