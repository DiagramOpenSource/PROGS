     || Modificar gestrm05

|FICHEROS;
     gestrm05 #0;
     gestrm01 #1;
     agifa019 #19;
     gestrm06 #106,MANTE;
     gestrm07 #107,MANTE;
     tmp2t600 #600; ||Tmp Escandallos a recalcular
|FIN;

|VARIABLES;
     &Tempo = "";
     aArti = "";
     aEscan = "";
     nTpeso = 0;
     nTcoste = 0;
     nTpasada = 0;
     nPre = 0;
|FIN;

|PROCESO XPreVenta;
     #0#25 = #0#24 / (1 - (#0#26 / 100));
|FPRC;

|PROCESO XCosteAcabado;
     #0#22 = #0#25 * #0#9 / 100;
|FPRC;

|PROCESO XPreTeje;
/*
     #0#11 = #0#12 * 166.386;
*/
|FPRC;

|PROCESO XPreTejeEuro;
     #0#12 = #0#11 * #0#13 * #0#33 / 100 / 166.386 * (1+ (#0#5/100));
     #0#34 = #0#11 * #0#13 * #0#33 / 100 / 166.386;
|FPRC;

|PROCESO XCosteTeje;
     #0#17 = ((#0#12 * #0#13 + #0#31) / 100) * (1 + (#0#5/100));
|FPRC;

|PROCESO XCosteMermaTeje;
     #0#18 = (#0#16 + #0#12) * (#0#5 / 100);
|FPRC;

|PROCESO XCosteComiCrudo;
     #0#19 = (#0#16 + #0#17) * (#0#6 / 100);
|FPRC;

|PROCESO XCosteTotaTeje;
     #0#20 = #0#16 + #0#12 + #0#18 + #0#19;
|FPRC;

|PROCESO XCosteMermaAcaba;
     #0#21 = #0#20 * #0#9 / 100;
|FPRC;

|PROCESO XCosteTotaAcaba;
     #0#23 = #0#21 + #0#10;
|FPRC;

|PROCESO XCosteTotaTejeAcaba;
     #0#24 = #0#20 + #0#23 + #0#32;
|FPRC;

|PROCESO XMargen;
     #0#26 = ((#0#25 - #0#24) / #0#25) * 100;
|FPRC;

|PROCESO XMargenEuro;
     #0#27 = #0#25 - #0#24;
|FPRC

|PROCESO XPreTejeDra;
     #0#28 = ((#0#25 - #0#24) * 100 / #0#13 / #0#33 * 166.386) + #0#11;
|FPRC;

|PROCESO XComPreVta;
     nPre = #0#28 * #0#31 * #0#13 / 100 / 166.386;
     nPre = nPre + #0#16;
     nPre = nPre * (1 + ((#0#5 + #0#6)/100));
     nPre = nPre * (1 + (#0#9/100)) + #0#22 + (#0#25 * #0#14 / 100);
     #0#30 = nPre;
|FPRC;

|PROCESO XCosComiVta;
     #0#32 = #0#25 * #0#14 / 100;
|FPRC;

|PROCESO XMetricoTrm;
     #107#6 = (#107#4 * #0#2 * 100) / (#107#5 / 1000) * (1 + (#0#5/100));
|FPRC;

|PROCESO XMetricoUrd; |TIPO 0;
     #106#6 = (#106#4 * #0#2 * 100) / (#106#5 / 1000) * (1 + (#0#5/100));
|FPRC;

|PROCESO XRecalTrm;
     nTpeso = nTpeso + (#107#6 * #107#9 / 100);
     nTcoste = nTcoste + #107#8;
     nTpasada = nTpasada + (#107#4 * #107#9 / 100);
|FPRC;

|DEFBUCLE XRecalTrm;
     #107#1;
     ;
     #0#0, 00;
     #0#0, 99;
     ;
     NULL, XRecalTrm;
|FIN;

|PROCESO XRecalUrd;
     nTpeso = nTpeso + #106#6;
     nTcoste = nTcoste + #106#8;
     nTpasada = nTpasada + #106#4;
|FPRC;

|DEFBUCLE XRecalUrd;
     #106#1;
     ;
     #0#0, 00;
     #0#0, 99;
     ;
     NULL, XRecalUrd;
|FIN;

|PROCESO XRecalcula;
     nTpeso = 0;
     nTcoste = 0;
     nTpasada = 0;
     |BUCLE XRecalTrm;
     #0#33 = nTpasada;
     |BUCLE XRecalUrd;
     #0#15 = nTpeso;
     #0#16 = nTcoste;
     #0#31 = nTpasada;
     |HAZ XPreTejeEuro;
     |HAZ XCosteTeje;
     |HAZ XCosteMermaTeje;
     |HAZ XCosteComiCrudo;
     |HAZ XCosteTotaTeje;
     |HAZ XCosteMermaAcaba;
     |HAZ XCosteTotaAcaba;
     |HAZ XCosteTotaTejeAcaba;
     |HAZ XMargen;
     |HAZ XPreVenta;
     |HAZ XMargenEuro;
     |HAZ XPreTejeDra;
     |HAZ XComPreVta;
     |HAZ XComPreVta;
|FPRC;

|PROCESO XActCosTrm;
     #19#0 = #107#2;
     |LEE 020#19=;
     |SI FSalida ! 0; |DDEFECTO #19; |FINSI;

     |SI #1#32 = "U";
          #107#7 = #19#133;
     |SINO;
          #107#7 = #19#9;
     |FINSI;
     #107#8 = #107#6 * #107#7 / 1000;
     |GRABA 020#107a;
|FPRC;

|DEFBUCLE XActCosTrm;
     #107#1;
     ;
     aEscan, 00;
     aEscan, 99;
     be;
     NULL, XActCosTrm;
|FIN;

|PROCESO XActCosUrd;
     #19#0 = #106#2;
     |LEE 020#19=;
     |SI FSalida ! 0; |DDEFECTO #19; |FINSI;

     |SI #1#32 = "U";
          #106#7 = #19#133;
     |SINO;
          #106#7 = #19#9;
     |FINSI;
     #106#8 = #106#6 * #106#7 / 1000;
     |GRABA 020#106a;
|FPRC;

|DEFBUCLE XActCosUrd;
     #106#1;
     ;
     aEscan, 00;
     aEscan, 99;
     be;
     NULL, XActCosUrd;
|FIN;

|PROCESO Tmp;
     aEscan = #600#0;
     |BUCLE XActCosUrd;
     |BUCLE XActCosTrm;

     #0#0 = aEscan;
     |LEE 101#0=;
     |SI FSalida = 0;
          |HAZ XRecalcula;
          |GRABA 020#0a;
          |LIBERA #0;
     |FINSI;
|FPRC;

|DEFBUCLE Tmp;
     #600#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Tmp;
|FIN;

|PROCESO XUrdimbre;
     #600#0 = #106#0;
     |GRABA 000#600n;
|FPRC;

|DEFBUCLE XUrdimbre;
     #106#2;
     ;
     aArti;
     aArti;
     ;
     NULL, XUrdimbre;
|FIN;

|PROCESO XTrama;
     #600#0 = #107#0;
     |GRABA 000#600n;
|FPRC;

|DEFBUCLE XTrama;
     #107#2;
     ;
     aArti;
     aArti;
     ;
     NULL, XTrama;
|FIN;

|PROGRAMA;
     |MENSA "0000Actualizando coste escandallos...";
     aArti = PARAMETRO;
     |ABRE #1; |LEE 000#1p; |CIERRA #1;
     |ABRE #19;
     #19#0 = aArti;
     |LEE 000#19=;
     |SI FSalida = 0;
          |SI #19#125 = #1#45; |O #19#125 = #1#46;
               |HAZ CreaTempo; |NOME_DAT #600 Tempo; |DELINDEX #600;
               |ABRE #600;
               |BUCLE XUrdimbre;
               |BUCLE XTrama;
               |ABRE #0;
               |BUCLE Tmp;
               |CIERRA #0;
               |CIERRA #600; |DELINDEX #600; |HAZ BoraTempo;
          |FINSI;
     |FINSI;
     |CIERRA #19;
     |MENSA "0000.";
|FPRO;
