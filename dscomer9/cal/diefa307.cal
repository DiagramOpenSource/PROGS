|FICHEROS;
     diefa307 #0; ||Este Def.
     diefa114 #1; ||Temporal recibos venta
     agifa024 #2; ||Clientes.
     agifa134 #3; ||Facturas. (C).
     agifa059 #4; ||Facturas. (L).
     agifa010 #5; ||Albaranes. (C).

     dscam045@ #100; ||Control recibos gestion
     dscam003@ #101; ||Recibos Venta Cartera
|FIN;

|VARIABLES;
     &Tempo = "";
     aTmp1 = "";
     swImp = 0;
     swNo  = 0;
     fFech = @;
     fUltima = @;

     aAlfa  = "";
     aAlfa1 = "";
|FIN;

|PROCESO agifa134;
     #5#52 = #4#15; ||Serie.
     #5#0  = #4#2;  ||N§ Albaran.
     |LEE 000#5=;
     |SI FSalida = 0;
          |SI #5#88 < #0#12; |O #5#88 > #0#13; |ACABA; |FINSI;
          fFech = #5#57;

          |SI fUltima < fFech; fUltima = fFech; |FINSI;

          |ERROR;
     |FINSI;
|FPRC;

|PROCESO RecibosVenta;
     #2#0 = #1#2; ||Cliente.
     |LEE 000#2=;
     |SI FSalida ! 0; |ACABA; |FINSI;
     |SI #2#3 < #0#8; |O #2#3 > #0#9; |ACABA; |FINSI; || Zona.

     |SI #2#41 < #0#21; |O #2#41 > #0#22; |ACABA; |FINSI; ||Tipo Factu

 |||  |SI #2#158 < #0#19; |O #2#158 > #0#20; |ACABA; |FINSI; ||Grupo

     #3#49 = #1#17;  || Serie.
     #3#0  = #1#0;   || N§ Factura.
     |LEE 000#3=;
     |SI FSalida ! 0; |ACABA; |FINSI;
     |SI #3#1 < #0#0;  |O #3#1 > #0#1;  |ACABA; |FINSI; || F.Factura.
     |SI #3#7 < #0#10; |O #3#7 > #0#11; |ACABA; |FINSI; || Representante.
     swNo = 0;
     fUltima = "01.01.0000";
     |BUCLELIN 2agifa134#3;

     |SI fUltima ] #0#14; |Y fUltima [ #0#15;
          |PRINT;
          swImp = 1;
     |FINSI;
|FPRC;

|DEFBUCLE RecibosVenta;
     #1#2;                     ||        Principal          -
     2,13,21;                  || Serie F , N§ Fac , N§ Rec - Cliente , Cobrado
     #0#2,#0#4,  0,#0#6,#0#18,#0#16;
     #0#3,#0#5,999,#0#7,#0#18,#0#17;
     ;
     NULL,RecibosVenta;
|FIN;

|PROCESO RellenaTempo;
   |SI #dscam003@#14 = "A"; |O #dscam003@#14 = "D"; |O #dscam003@#69 ! " "; |ACABA; |FINSI;

   |DDEFECTO #diefa114;
   #diefa114#0  = #dscam003@#1;
   #diefa114#1  = #dscam003@#2;
   #diefa114#2  = #dscam003@#32;
   #diefa114#3  = #dscam003@#6;
   #diefa114#4  = #dscam003@#7;
   #diefa114#5  = "N";
   #diefa114#6  = #dscam003@#29;
   #diefa114#7  = #dscam003@#4;
   #diefa114#8  = #dscam003@#3;
   #diefa114#9  = #dscam003@#64;
   #diefa114#10 = #dscam003@#48;
   #diefa114#11 = "N";
   #diefa114#12 = #dscam003@#5;
   |SI #dscam003@#14 = "L"; |O #dscam003@#14 = "R"; |O #dscam003@#14 = "M";
    |O #dscam003@#14 = "T"; |O #dscam003@#14 = "E";
      #diefa114#13 = "S";
   |SINO;
      #diefa114#13 = "N";
   |FINSI;
   |SI #dscam003@#14 = "I"; #diefa114#14 = "S"; |FINSI;
   #diefa114#15 = #dscam003@#28;
   #diefa114#16 = #dscam003@#26;
   #diefa114#17 = #dscam003@#0;
   #diefa114#18 = #dscam003@#50;
   #diefa114#19 = #dscam003@#61;
   #diefa114#20 = #dscam003@#63;
   #diefa114#21 = #dscam003@#12;
   aAlfa1 = #dscam003@#15; |QBF aAlfa1; aAlfa1 = aAlfa1 - "Recibo ";
   #diefa114#22 = aAlfa1;
   #diefa114#23 = "N";
   #diefa114#24 = #dscam003@#40;
   |GRABA 020#diefa114.n;
|FPRC;

|DEFBUCLE RellenaTempo;
#dscam003@#6005;
12,4,32;
00,#0#2,#0#4,000," ",#0#16,#0#0,#0#6;
99,#0#3,#0#5,999,"z",#0#17,#0#1,#0#7;
;
NULL,RellenaTempo;
|FIN;

|PROCESO EmpCartera;
   aAlfa1 = ("00000" + #dscam045@#6) % -105;
   aAlfa1 = aAlfa + "dscarter/fich/" + aAlfa1 + "/";
   |PATH_DAT #101 aAlfa1;

   |BUCLE RellenaTempo;
|FPRC;

|DEFBUCLE EmpCartera;
#dscam045@#1002;
2;
#48#0,001,"V";
#48#0,999,"V";
;
NULL,EmpCartera;
|FIN;

|PROCESO CargaCar;
     |DBASS aAlfa; |QBF aAlfa;
     aAlfa1 = aAlfa + "dscarter/def/dscam045.mas";
     |CARGA_DEF aAlfa1, dscam045@;
     |SI FSalida ! 0;
        |MENAV "    Problemas al cargar el def de control de recibos de cartera";
        |ERROR; |ACABA;
     |FINSI;

     aAlfa1 = aAlfa + "dscarter/def/dscam003.mas";
     |CARGA_DEF aAlfa1, dscam003@;
     |SI FSalida ! 0;
        |DESCARGA_DEF #dscam045@;
        |MENAV "    Problemas al cargar el def de recibos de cartera";
        |ERROR; |ACABA;
     |FINSI;

     aAlfa1 = aAlfa + "dscarter/fich/"; |PATH_DAT #100 aAlfa1;

     |BUCLE EmpCartera;

     |DESCARGA_DEF #dscam003@; |DESCARGA_DEF #dscam045@;
|FPRC;

|PROCESO ejec; |TIPO 3;
     |HAZ CreaTempo; aTmp1 = Tempo;
     |NOME_DAT #1 aTmp1; |DELINDEX #1;

     |ABRE #1; |HAZ CargaCar; |CIERRA #1;

     |IMPRE 0;
     |SI FSalida ! 0; |ACABA; |FINSI;
     |INFOR "diefa307";
     |SI FSalida ! 0; |FINIMP; |ACABA; |FINSI;

     |ABRE #2;
     |ABRE #3;
     |ABRE #5;
     |BUCLE RecibosVenta;
     |CIERRA #2;
     |CIERRA #3;
     |CIERRA #5;
     |SI swImp = 1;
          |PIEINF;
     |FINSI;
     |FININF;
     |FINIMP;
     Tempo = aTmp1; |HAZ BoraTempo; |DELINDEX #1;
|FPRC;
