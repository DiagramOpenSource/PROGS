
|FICHEROS;
malpe030#0;
malpe031#1;
malpe104#2;
agifa019#3;
malpe032#4;
malpe033#5;
malpe034#6;
|FIN;

|VARIABLES;
     mes = 0;
     sig = 0;
     alfa1 = "";
     alfa2 = "";
     alfa = "";
     mesalfa = 0;
     texto = 0;
     texto1 = 0;
     anterior = "000000";
     posterior = "999999";
     campobase = 0;
     campobase_mas = 0;
     campobase_mas1 = 0;
     campobase_mas2 = 0;
     campobase2 = 0;
     i = 0;
     j = 0;
     k = 0;
     n = 0;
     m = 0;
|FIN;

|PROCESO pon_todos;
|PARA mes = 0;|SI mes < 12;|HACIENDO mes = mes+1;
     sig = mes + 1;
     #0sig = #0mes + 0.001;
     |PINTA #0sig;
|SIGUE;

|PARA mes = 0;|SI mes < 12;|HACIENDO mes = mes+1;
     alfa1 = #0mes % A402;
     alfa2 = #0mes % A704;
     alfa = alfa2 + alfa1;
     mesalfa = mes + 12;
     #0mesalfa = alfa;
     |PINTA #0mesalfa;
|SIGUE;
|FPRC;

|PROCESO pon_base;
alfa1 = #0#24;
alfa2 = #0#25;
alfa = alfa2 + alfa1;
#0#26 = alfa;
|FPRC;

|PROCESO di_marca;
#1#4 = #3#126;
|FPRC;

|DEFBUCLE marca;
#3#1;
;
#1#0;
#1#0;
;
NULL,di_marca;
|FIN;

|PROCESO ver_rango;

alfa1 = #2#4 % A402;
alfa2 = #2#4 % A704;
alfa = alfa2 + alfa1;
|SI alfa < #0#12;
 alfa = anterior;
|FINSI;
|SI alfa > #0#23;
 alfa = posterior;
|FINSI;
#1#0 = #2#8;
#1#1 = alfa;
|LEE 040#1=;
 |SI FSalida ! 0;
  |DDEFECTO #1;
  #1#0 = #2#8;
  #1#1 = alfa;
  |GRABA 020#1c;
 |FINSI;
#1#2 = #1#2 + (#2#5 - #2#7);
 |SI #2#12 ! "               ";
 #1#3 = #1#3 + (#2#5 - #2#7);
 |FINSI;
|BUCLE marca;
|SI #1#4 ] #0#27; |Y #1#4 [ #0#28;
     || aqui veo si la marca esta en los limites
     |GRABA 020#1a;
|FINSI;

|FPRC;

|PROCESO fich4;
#4#0 = #1#4;
#4#1 = #1#1;
|LEE 040#4=;
 |SI FSalida ! 0;
  |DDEFECTO #4;
  #4#0 = #1#4;
  #4#1 = #1#1;
  |GRABA 020#4c;
 |FINSI;
#4#2 = #4#2 + #1#2;
#4#3 = #4#3 + #1#3;
|GRABA 020#4a;
|FPRC;


|PROCESO escribe_mes;
#6#0 = #5#0;
#6#1 = #5#13;   ||anterior
#6#18 = #5#30;  || anterior reservado
#6#35 ="Anterior";
|PARA i = 1;|SI i < campobase;|HACIENDO i = i+1;  ||anteriores a la base
 j = i - 1;
 k = i + 1;
 m = k + 17;
 n = i + 17;
 texto1 = i + 11;
 texto = i + 35;
 #6texto = #0texto1;
 #6k = #5i;
 #6m = #5n;
|SIGUE;
campobase_mas = campobase + 1;
campobase_mas2 = campobase_mas  + 17;
texto = campobase_mas + 34;
#6texto = "Ant.Base";
#6campobase_mas = #5#14;
texto = texto + 1;
#6texto = "Mes Curso";
#6campobase_mas2 = #5#31;
campobase_mas1 = campobase_mas + 1;
|PARA i = campobase_mas1;|SI i < 15;|HACIENDO i = i + 1; ||posteriores a la base
 m = i + 17;
 j = i - 2;
 n = j + 17;
 texto = i + 35;
 texto1 = i + 10;
 #6texto = #0texto1;
 #6i = #5j;
 #6m = #5n;
|SIGUE;
#6#15 = #5#15;
#6#16 = #5#16;
#6#17 = #5#17;

|PRINT;

|FPRC;

|DEFBUCLE lee_fich;
#2#3;
;
"             ",01,"               ","01.01.1900","N";
"zzzzzzzzzzzzz",99,"zzzzzzzzzzzzzzz","31.12.9999","N";
;
NULL,ver_rango;
|FIN;


|DEFBUCLE lee_marca;
#1#1;
;
"             " , "      ";
"zzzzzzzzzzzzz" , "zzzzzz";
;
NULL,fich4;
|FIN;



|PROCESO dato;
#5#0 = #4#0;
|LEE 040#5=;
 |SI FSalida ! 0;
  |DDEFECTO #5;
  #5#0 = #4#0;
  |GRABA 020#5c;
 |FINSI;
|SI #4#1 = anterior;
 #5#13 = #5#13 + #4#2; || pend.serv.anterior
 #5#30 = #5#30 + #4#3;   ||resv.anterior
 #5#47 = #5#13 - #5#30;
 #5#14 = #5#14 + #4#2; ||pend.serv.ant.base
 #5#31 = #5#31 + #4#3;
 #5#46 = #5#14 - #5#31;
|FINSI;
|SI #4#1 = posterior;
 #5#15 = #5#15 + #4#2;
 #5#32 = #5#32 + #4#3;
 #5#49 = #5#15 - #5#42;
|FINSI;
|SI #4#1 ! anterior;|Y #4#1 ! posterior;
 |SI #4#1 = #0#12;
  #5#1 = #5#1 + #4#2;
  #5#18 = #5#18 + #4#3;
  #5#35 = #5#1 - #5#18;
 |SINO;
   |SI #4#1 = #0#13;
    #5#2 = #5#2 + #4#2;
    #5#19 = #5#19 + #4#3;
    #5#36 = #5#2 - #5#19;
   |SINO;
    |SI #4#1 = #0#14;
     #5#3 = #5#3 + #4#2;
     #5#20 = #5#20 + #4#3;
     #5#37 = #5#3 - #5#20;
    |SINO;
     |SI #4#1 = #0#15;
      #5#4 = #5#4 + #4#2;
      #5#21 = #5#21 +#4#3;
      #5#38 = #5#4 - #5#21;
     |SINO;
      |SI #4#1 = #0#16;
       #5#5 = #5#5 + #4#2;
       #5#22 = #5#22 + #4#3;
       #5#39 = #5#5 - #5#22;
      |SINO;
       |SI #4#1 = #0#17;
        #5#6 = #5#6 + #4#2;
        #5#23 = #5#23 + #4#3;
        #5#40 = #5#6 - #5#23;
       |SINO;
         |SI #4#1 = #0#18;
          #5#7 = #5#7 + #4#2;
          #5#24 = #5#24 + #4#3;
          #5#41 = #5#7 - #5#24;
         |SINO;
          |SI #4#1 = #0#19;
           #5#8 = #5#8 + #4#2;
           #5#25 = #5#25 + #4#3;
           #5#42 = #5#8 - #5#25;
          |SINO;
           |SI #4#1 = #0#20;
            #5#9 = #5#9 + #4#2;
            #5#26 = #5#26 + #4#3;
            #5#43 = #5#9 - #5#26;
           |SINO;
            |SI #4#1 = #0#21;
             #5#10 = #5#10 + #4#2;
             #5#27 = #5#27 + #4#3;
             #5#44 = #5#10 - #5#27;
            |SINO;
             |SI #4#1 = #0#22;
              #5#11 = #5#11 + #4#2;
              #5#28 = #5#28 + #4#3;
              #5#45 = #5#11 - #5#28;
             |SINO;
              |SI #4#1 = #0#23;
               #5#12 = #5#12 + #4#2;
               #5#29 = #5#29 + #4#3;
               #5#46 = #5#12 - #5#29;
              |FINSI;
             |FINSI;
            |FINSI;
           |FINSI;
          |FINSI;
         |FINSI;
        |FINSI;
       |FINSI;
      |FINSI;
     |FINSI;
    |FINSI;
   |FINSI;
 |SI #4#1 < #0#26; ||anterior a la base
  ||#5#13 = #5#13 + #4#2;
  ||#5#30 = #5#30 + #4#3;
  ||#5#47 = #5#13 - #5#30;
  #5#14 = #5#14 + #4#2; ||anterior a la base
  #5#31 = #5#31 + #4#3;
  #5#48 = #5#14 - #5#31;
 |SINO;
      |SI #4#1 > #0#26;||mayor que la clave
            #5#16 = #5#16 + #4#2;
            #5#33 = #5#33 + #4#3;
            #5#50 = #5#16 - #5#33;
       |FINSI;
 |FINSI;
|FINSI;
#5#17 = #5#14 + #5#16 + #5#15;
#5#34 = #5#31 + #5#32 + #5#33;
#5#51 = #5#48 + #5#50 + #5#49;
|GRABA 020#5a;
|FPRC;


|DEFBUCLE pon_dato;
#4#1;
;
"   ","      ";
"zzz","zzzzzz";
;
NULL,dato;
|FIN;

|DEFBUCLE pon_mes;
#5#1;
;
"   ";
"zzz";
;
NULL, escribe_mes;
|FIN;

|PROCESO busca_base;
|PARA i = 12;|SI i [ 23;|HACIENDO i = i+1;
    |SI #0i = #0#26;
     campobase = i - 11;
    |FINSI;
|SIGUE;
|FPRC;

|PROCESO tipo3;|TIPO 3;
     |IMPRE 0;
     |SI FSalida = 0;
          |INFOR "malpe030";
          |SI FSalida ! 0;
               |MENAV "0000Falta informe [malpe030]";
          |SINO;
               |DELINDEX #1;
               |DELINDEX #4;
               |DELINDEX #5;

               |ABRE #1;
               |BUCLE lee_fich;
               |CIERRA #1;

               |ABRE #4;
               |BUCLE lee_marca;
               |CIERRA #4;

               |ABRE #5;
               |BUCLE pon_dato;
               |CIERRA #5;

               |HAZ busca_base;
               |BUCLE pon_mes;
               |PIEINF;
          |FINSI;
          |FININF;
     |FINSI;
     |FINIMP;
|FPRC;
