|FICHEROS;
     agifa016 #0;
     agifa077 #1;
     agifa080 #2;
     agifa112 #3;
     agifa007 #40;
     dsm00010 #910;
     dsm00083 #83;
     tlfm0001@ #101;
     tlfm0002@ #102;

     referen@;
     agifa080@;
|FIN;

|INCLUYE i_varart;

|VARIABLES;
     &eaImpElige = "";
     &enRucoLin = 0;
     nSwRucomar = 0;
     &PRMNT_Imp = "";
     nSwSebaLopez = 0; || Modulo 004032
     &eaSLenvase = ""; &eaSLdesenv = ""; &enSLbruto = 0;
     &enSLnumenv = 0; &enSLtara = 0; &enSLneto = 0;

     aPath = "";
     nSal1 = 0;
     nSal2 = 0;
     i = 0;
     nSalida    = 0;
     nCampos    = 0;
     nSwSematel = 0;
     nSwSanchez = 0;

     &eaIMEI      = "";
     &eaABO       = "";
     &eaICC       = "";
     &enSwIMEI    = 0;

     &enBogeRefe = 0;
     &enBogeAlba = 0;
     &enBogeLin = 0;

     &enNumero = 0;

     &eaSerieDelega = "";

     &eaDoc = "";
     nSwPackList = 0;

     &enSwi    = 0;
     &eaImpre  = "";

     &aDivisa     = "";
     &aMoneda     = "";
     &enCodig     = 0;
     &eaNArticulo = "";

     &ser_ped     = "";
     &num_ped     = 0;
     &enPantalla  = 0;

     nNume = 0;
     aAlfa = "";
     informe = "";
     &informe1 = "";
     &iva1 = 0;
     &iva2 = 0;
     &iva3 = 0;
     &iva4 = 0;
     &iva5 = 0;
     &re1 = 0;
     &re2 = 0;
     &re3 = 0;
     &re4 = 0;
     &re5 = 0;
     &bl  = "                              ";
|FIN;

컴컴컴컴컴컴컴컴컴컴컴컴Modulo 004159컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO Agrupador;
     nSalida = 1;
     |LEE 000#2p;
     |PARA; |SI FSalida = 0; |HACIENDO;
          |SI #2#2 = #agifa080@#2; |Y #2#39 = #agifa080@#39; |Y #agifa080@#39!0;
               nSalida = 0; |SAL;
          |FINSI;
          |LEE 000#2s;
     |SIGUE;

     |SI nSalida = 0;
          #2#6 = #2#6 + #agifa080@#6;   ||Precio
          #2#7 = #2#7 + #agifa080@#7;   ||Impo
          #2#9 = #2#9 + #agifa080@#9;   ||Total
          #2#30 = #2#30 + #agifa080@#30;||Precio Div
          #2#31 = #2#31 + #agifa080@#31;||Total Div
          |GRABA 020#2a;
     |SINO;
          aAlfa = "|NC"; aAlfa = #2#aAlfa#;
          nCampos = aAlfa; nCampos = nCampos - 1;
          |PARA i = 0; |SI i [ nCampos; |HACIENDO i = i + 1;
               #2i = #agifa080@#i#;
          |SIGUE;
          |GRABA 020#2n;
     |FINSI;
|FPRC;

|DEFBUCLE Agrupador;
     #agifa080@#1003;
     ;
     #1#50, #1#0, 001;
     #1#50, #1#0, 999;
     ;
     NULL, Agrupador;
|FIN;

|PROCESO AgruArtiIni;
     |DDEF aAlfa;
     aAlfa = aAlfa + "agifa080";
     |CARGA_DEF aAlfa, agifa080@;
     nSwSanchez = FSalida;
     |SI FSalida ! 0; |ACABA; |FINSI;

     aAlfa = Usuario;
     |NOME_DAT #2 aAlfa;
     |DELINDEX #2;
     |ABRE #2;
     |BUCLE Agrupador;
     |CIERRA #2;
|FPRC;

|PROCESO AgruArtiFin;
     |DESCARGA_DEF #agifa080@;
     |DELINDEX #2;
|FPRC;

컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴

|PROCESO BogeVariables;
     |DDEF aAlfa;
     aAlfa = aAlfa + "bogem024";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          |SELECT #2#referen@;
          #referen@#18 = #1#50;
          #referen@#19 = #1#0;
          |LEE 000#referen@.=;
          |SI FSalida = 0;
               enBogeRefe = #referen@#0;
               enBogeAlba = #referen@#17;
               enBogeLin = #2#1/3; || Multiplo de 3
               nNume = enBogeLin ! 0;
               |SI nNume ! enBogeLin; enBogeLin = enBogeLin + 1; |FINSI;
          |FINSI;
          |CIERRA #referen@;

          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|PROCESO DesAmpli;
     enSwi = 1;
     enSwDA = 1;
     |PRINT;
     enSwDA = 0;
     enSwi = 0;
|FPRC;

|DEFBUCLE DesAmpli;
     #83#1;
     ;
     "A", #2#27, #2#0, #2#1, 001;
     "A", #2#27, #2#0, #2#1, 999;
     ;
     NULL, DesAmpli;
|FIN;

|PROCESO IVAS;
     eaPrv = #1#3;
     efFiva = #1#1;
     enTiva = 1;  |HAZ IVAPrv; iva1 = enIva; re1 = enRec;
     enTiva = 2;  |HAZ IVAPrv; iva2 = enIva; re2 = enRec;
     enTiva = 3;  |HAZ IVAPrv; iva3 = enIva; re3 = enRec;
     enTiva = 4;  |HAZ IVAPrv; iva4 = enIva; re4 = enRec;
     enTiva = 5;  |HAZ IVAPrv; iva5 = enIva; re5 = enRec;
|FPRC;

|PROCESO prnalb1;|TIPO 0;
     |SI nSwSanchez = 0; |HAZ AgruArtiIni; |FINSI;

     eaSerLog = #1#50;
     eaNumLog = (A\("000000" + #1#0) % -106);
     eaTipLog = "AC";
     |HAZ ImprimeLog;

     |SI nSwPackList = 0;
          eaDoc = "AC" + #1#46 + #1#0;
          |HAZ PackListVar;
     |FINSI;

     |HAZ IVAS;
     aDivisa = #agifa077#56;
     aMoneda = #agifa077#58;
     |HAZ Divisas077;

     |SI #3#0 ! #1#3;
         #3#0 = #1#3;
         |LEE 021#3=;
         |SI FSalida ! 0;  |DDEFECTO #3;  |FINSI;
     |FINSI;

     #40#26 = #1#50;
     |LEE 001#40=;
     |SI FSalida ! 0;  |DDEFECTO #40;  |FINSI;

     |SI #1#42 = "N";
         informe = #40#6; |QBF informe;
     |SINO;
         informe = #40#7; |QBF informe;
     |FINSI;
     informe1 = (informe % 0104) + "5" + (informe % 0603); |QBF informe1;

     |SI nSwRucomar = 0; |HAZ RucoNumLin; |FINSI;

     |INFOR informe;
     |SI FSalida ! 0;  |ERROR10;  |FINSI;

     |SI #910#19 = "S";  |HAZ AbreTemporales;  |FINSI;
|FPRC;

|PROCESO prnalbl;|TIPO 0;
     enArtImp = #2#2; |QBF enArtImp;

     |HAZ EsAparecida;
     |SI FSalida = 0;
          eaArticulo = #2#2;
          |HAZ ImpAparecida;
     |FINSI;

     |SI #910#19 = "N";
          |SI nSwSebaLopez = 0;
               |HAZ SebaLopezVar;
          |FINSI;

          |HAZ BogeVariables;

          |PRINT;

          |SI nSwSematel = 0;
               |HAZ ImpreIMEI;
          |FINSI;

          |BUCLE DesAmpli;
          |ACABA;
     |FINSI;

     eaTipo      = "AC";
     eaSerie     = #2#27;
     enCodig     = #2#0;
     enLinea     = #2#1;
     eaArticulo  = #2#2;
     eaNArticulo = #2#4;
     enUnidades  = #2#5;
     enPrecio    = #2#6;
     enDto1      = #2#8;
     enDto2      = #2#26;
     |HAZ TrataCompo;
|FPRC;

|PROCESO prnalb2;|TIPO 0;
     |SI #910#19 = "S";  |HAZ ElRemate;  |FINSI;

     |PIEINF;
     |FININF;

     |SI nSwSanchez = 0; |HAZ AgruArtiFin; |FINSI;
|FPRC;

|DEFBUCLE agifa077_3;
     #1#3;
     ;
     #0#0, #0#4, #0#8, #0#2;
     #0#1, #0#5, #0#9, #0#3;
     e;
     NULL,  prnalb1,  prnalbl,  prnalb2;
|FIN;

|DEFBUCLE agifa077_1;
     #1#1;
     ;
     ser_ped, num_ped;
     ser_ped, num_ped;
     e;
     NULL,  prnalb1,  prnalbl,  prnalb2;
|FIN;

|PROCESO Tipo3;  |TIPO 3;
     |SI eaFicImpre = "";
        |SI eaImpre ! ""
           Impresora = eaImpre;
           |IMPRE -1;
        |SINO;
           |IMPRE 1;
        |FINSI;
     |SINO;
          Impresora = eaFicImpre;
          |IMPRE -77;
     |FINSI;
     eaImpElige = Impresora;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |ABRE #3;
     |ABRE #40;
     |SI ser_ped = ""; |Y num_ped = 0;
          |BUCLE agifa077_3;
     |SINO;
          |BUCLE agifa077_1;
     |FINSI;
     |CIERRA #40;
     |CIERRA #3;

     |FINIMP;
|FPRC;

|PROGRAMA;
     |SI PRMNT_Imp ! "";
          ser_ped = PRMNT_Imp % 105; aAlfa = PRMNT_Imp % 606;
          num_ped = aAlfa;
     |FINSI;

     |HAZ MiraLogos; || Copia Logos para el Crystal

     enPantalla  = 0;

     |HAZ EsPackList; nSwPackList = FSalida;
     |HAZ EsSematel; nSwSematel = FSalida;
     |HAZ EsSebaLopez; nSwSebaLopez = FSalida;
     |HAZ EsRucomar; nSwRucomar = FSalida;
     |HAZ EsSanchez; nSwSanchez = FSalida;

     |ABRE #910;
     |LEE 040#910p;
     |SI FSalida ! 0;  |DDEFECTO #910;  |FINSI;
     |CIERRA #910;

     |SI ser_ped = ""; |Y num_ped = 0;
         |CLS;
         |CABEZA "Imp.Albaranes";
         |PINPA #0#0;
         |PINDA #0#0;
         |ENDATOS #1#0;
         |SI FSalida = 0;  |HAZ Tipo3;  |FINSI;
     |SINO;
         #0#8 = ser_ped;
         #0#9 = ser_ped;
         #0#2 = num_ped;
         #0#3 = num_ped;
         |HAZ Tipo3;
     |FINSI;
|FPRO;

|PROCESO ImpreIMEI;
     |DDEF aPath;
     aAlfa = aPath + "tlfm0001";
     |CARGA_DEF aAlfa, tlfm0001@;
     |SI FSalida ! 0;
          |MENAV "0000Error al cargar 'tlfm0001'";
     |SINO;
          aAlfa = aPath + "tlfm0002"
          |CARGA_DEF aAlfa, tlfm0002@;
          |SI FSalida ! 0;
               |MENAV "0000Error al cargar 'tlfm0002'";
          |SINO;
               enSwIMEI = 1;
               |ABRE #101; |SELECT #3#101;
               |ABRE #102; |SELECT #3#102;
               |PARA i = 1; |SI i [ 99; |HACIENDO i = i + 1;
                    eaIMEI = ""; eaABO = ""; eaICC = "";
                    #101#49 = #2#27;
                    #101#50 = #2#0;
                    #101#51 = #2#1;
                    #101#52 = i;
                    |LEE 000#101=;
                    nSal1 = FSalida;
                    |SI FSalida = 0; eaIMEI = #101#0; |FINSI;
                    #102#44 = #2#27;
                    #102#45 = #2#0;
                    #102#46 = #2#1;
                    #102#47 = i;
                    |LEE 000#102=;
                    nSal2 = FSalida;
                    |SI FSalida = 0; eaABO = #102#3; eaICC = #102#4; |FINSI;
                    |SI nSal1 ! 0; |Y nSal2 ! 0;
                         |SAL;
                    |SINO;
                         |PRINT;
                    |FINSI;
               |SIGUE;
               |CIERRA #101;
               |CIERRA #102;
               enSwIMEI = 0;
               |DESCARGA_DEF #tlfm0002@;
          |FINSI;
          |DESCARGA_DEF #tlfm0001@;
     |FINSI;
|FPRC;

|PROCESO SebaLopezVar;
     eaSLenvase = "";
     eaSLdesenv = "";
     enSLbruto = 0;
     enSLnumenv = 0;
     enSLtara = 0;
     enSLneto = 0;

     |DDEF aAlfa;
     aAlfa = aAlfa + "sebalo05";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          #referen@#0 = #2#27;
          #referen@#1 = #2#0;
          #referen@#2 = #2#1;
          |LEE 000#referen@.=;
          |SI FSalida = 0;
               eaSLenvase = #referen@#3;
               eaSLdesenv = #referen@#4;
               enSLbruto = #referen@#8;
               enSLnumenv = #referen@#5;
               enSLtara = #referen@#6;
               enSLneto = #referen@#7;
          |FINSI;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC,

|PROCESO RucoNumLin;
     |DDEF aAlfa;
     aAlfa = aAlfa + "rucom014";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@; |SELECT #2#referen@;
          #referen@#2 = #1#50;
          #referen@#14 = #1#0;
          |LEE 000#referen@.=;
          |SI FSalida = 0;
               enRucoLin = #referen@#0;
          |SINO;
               enRucoLin = 0;
          |FINSI;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;
