|FICHEROS;
     goindice #0;
     gosecive #1;
     gofamive #2;
     gosubive #3;
     goapaive #4;
     goinform #5;
     goartive #14;
|FIN;
--------------------------------------------------------------------------------
|VARIABLES;
     &eaPartida = "";
     &cCodMonBase   = "";
     &cCodMonTrab   = "";
     &cCodMonConv   = "";
     &cCodMonActu   = "";
     &cPart         = "";
     &cPartAct      = "";

     &nDeci_PBase   = 0;
     &nDeci_TBase   = 0;
     &nDeci_PTrab   = 0;
     &nDeci_TTrab   = 0;
     &nDeci_TotVis  = 0;
     &nEurComTrab   = 0;
     &nEurComBase   = 0;
     &nEurVenTrab   = 0;
     &nEurVenBase   = 0;
     &nPreComTrab   = 0;
     &nPreComBase   = 0;
     &nPreVenTrab   = 0;
     &nPreVenBase   = 0;
     &nPrecioComp   = 0;
     &nPrecioVent   = 0;

     cCadena        = "";
     cParam         = "";
     cGraba         = "";
     cCodigo        = "";
     cDescri        = "";
     cDirBase       = "";
     cDirEmpr       = "";
     cDirApli       = "";
     cEjecuta       = "";
     cFichero       = "";
     cUsuario       = "";
     cOrigen        = "";
     cDestino       = "";
     cIp            = "";
     cSeccion       = "";
     cFamilia       = "";
     cSubFam        = "";
     cCapitulo      = "";
     cArticulo      = "";
     cParametro     = "";
     cPathApli      = "";
     cPathDsin      = "";
     {500}fiebdc    = "";

     f              = 0;
|FIN;
-------------------------------------------------------------------------------------
|PROCESO GrabArti;
     cCadena = #14#0;
     |QBF cCadena;

     |SI cCadena ! "";
          cCadena = &9 + &9 + &9 + &9 + cCadena + " -> " + #14#1;
          |QBF cCadena;
          |XGRABA f, cCadena;
     |FINSI;

|FPRC;

-------------------------------------------------------------------------------
|DEFBUCLE MiraArti;
     #14#5;
     ;
     #4#0, "                    ";
     #4#0, "zzzzzzzzzzzzzzzzzzzz";
     ;
     NULL, GrabArti;
|FIN;
-------------------------------------------------------------------------------------
|PROCESO GrabCapi;
     cCadena = #4#0;
     |QBF cCadena;
     |SI cCadena ! "";
          cCadena = &9 + &9 + &9 + cCadena + "  -  " + #4#1;
          |QBF cCadena;
          cCadena = cCadena > " ";
          |XGRABA f, cCadena;
          |SI FSalida ! -1;
               |BUCLE MiraArti;
          |FINSI;
     |FINSI;
|FPRC;
-------------------------------------------------------------------------------------
|DEFBUCLE MiraCapi;
     #4#4;
     ;
     #3#0;
     #3#0;
     ;
     NULL, GrabCapi;
|FIN;
-------------------------------------------------------------------------------------
|PROCESO GrabSubfa;
     cCadena = #3#0;
     |QBF cCadena;
     |SI cCadena ! "";
          cCadena = &9 + &9 + cCadena + "  -  " + #3#1;
          |QBF cCadena;
          cCadena = cCadena > " ";
          |XGRABA f, cCadena;
          |SI FSalida ! -1;
               |BUCLE MiraCapi;
          |FINSI;
     |FINSI;
|FPRC;
-------------------------------------------------------------------------------------
|DEFBUCLE MiraSubfa;
     #3#4;
     ;
     #2#0;
     #2#0;
     ;
     NULL, GrabSubfa;
|FIN;
-------------------------------------------------------------------------------------
|PROCESO GrabFamil;
     cCadena = #2#0;
     |QBF cCadena;
     |SI cCadena ! "";
          cCadena = &9 + cCadena + "  -  " + #2#1;
          |QBF cCadena;
          cCadena = cCadena > " ";
          |XGRABA f, cCadena;
          |SI FSalida ! -1;
               |BUCLE MiraSubfa;
          |FINSI;
     |FINSI;
|FPRC;
-------------------------------------------------------------------------------------
|DEFBUCLE MiraFami;
     #2#4;
     ;
     #1#0;
     #1#0;
     ;
     NULL, GrabFamil;
|FIN;
-------------------------------------------------------------------------------------
|PROCESO GrabSecc;
     cCadena = #1#0;
     |QBF cCadena;
     |SI cCadena ! "";
          cCadena = cCadena + "  -  " + #1#1;
          |QBF cCadena;
          cCadena = cCadena > " ";
          |XGRABA f, cCadena;
          |SI FSalida ! -1;
               |BUCLE MiraFami;
          |FINSI;
     |FINSI;
|FPRC;
-------------------------------------------------------------------------------------
|DEFBUCLE MiraSecc;
     #1#1;
     ;
     " ";
     "z";
     ;
     NULL, GrabSecc;
|FIN;
-------------------------------------------------------------------------------------
|PROCESO Inicio; |TIPO 0;
     |SI #0#3 = "S";
          cSeccion = ""; cFamilia = ""; cSubFam = ""; cCapitulo = "";
          cArticulo = "";
          cParametro = PARAMETRO;
          cUsuario = Usuario % 810;
          |ABRE #5;
          #5#0 = cUsuario;
          |LEE 000#5=;

          |SI FSalida = 0;
               cDirApli = #5#3;
               |DFICE cDirEmpr;
               |QBF cDirEmpr;
               |QBF cDirApli;
               cFichero = cDirEmpr + "arbol.txt";

               |SI cParametro = "CREA"
                    |XABRE "W", cFichero, f;

                    |SI FSalida = -1;
                         |MENAV "0000EL FICHERO NO EXISTE O ESTA SIENDO UTILIZADO";
                         |ACABA;
                    |SINO;
                         |MENSA "0000UN MOMENTO GENERANDO INDICE BANCO DE DATOS";
                         |BUCLE MiraSecc;
                         |XCIERRA  f;
                         |HAZ PasaFich
                    |FINSI;

               |SINO;

                    |ABRE #5;
                    cUsuario = Usuario % 810;
                    |QBF cUsuario;
                    #5#0 = cUsuario;
                    |LEE 000#5=;

                    |SI FSalida ! 0;
                         |MENAV "0000PARAMETROS DS-INFORMES NO DEFINIDOS";
                         |ERROR;
                         |ACABA;
                    |FINSI;

                    cPathApli = #5#2;
                    cPathDsin = #5#3;
                    |CIERRA #5;
                    |QBF cPathApli;
                    |QBF cPathDsin;
                    cPathApli = cPathApli + "\msaccess.exe"
                    cUsuario = Usuario % 103;
                    cUsuario = cPathDsin + "\partida." + cUsuario;

                    cIp = "";
                    |IP_REMOTO cIp;

                    |SI cIp ! "";
                         cEjecuta = cPathDsin + "\wait.exe ";
                         cEjecuta = cEjecuta + cPathApli + " " + cPathDsin + "\dsbanco.mde" + ";" + cUsuario;
                    |SINO;
                         cEjecuta = cPathDsin + "\wait.exe ";
                         cEjecuta = cEjecuta + cPathApli + " " + cPathDsin + "\dsbanco.mde" + ";" + cUsuario;
                    |FINSI;

                    |RSYSTEM cEjecuta;

                    |HAZ TraeDato;
                    cParam = cPart;
                    |QBF cParam;
                    cParam = cParam % -101;

                    /*comprobamos si es un parametrico*/

                    |SI cParam = "$"; |Y cParametro ! "PRES";    ||Es parametrico.
                         |HAZ CargaIve;

                         |SI FSalida ] 0;
                              |HAZ Parametrico;
                              eaPartida = cPartAct;
                              |SUB_EJECUTA_NP "goartive";
/*

                              |PUSHV 01012380;
                              |CLS;
                              |ABRE #14;
                              #14#0 = cPartAct;
                              |LEE 000#14=;

                              |SI FSalida = 0;
                                   |PINPA #0#14;
                                   |PINDA #0#14;
                                   |ENDATOS #4#14;
                              |FINSI;

                              |POPV;
*/
                              |HAZ LiberaIve;
                         |FINSI;
                    |FINSI;
               |FINSI;
          |FINSI;
          |CIERRA #5;

     |FINSI;
     |PTEC 802;
|FPRC;
-------------------------------------------------------------------------------
|PROCESO TraeDato;
     |XABRE "C", cUsuario, f;
     |XLEE f, 13, cPart;
     |XCIERRA f;
     |XABRE "CW", cUsuario, f;
     |XCIERRA f;
     |QBF cPart;
     cPart = cPart % 221;
     cPart = cPart % -220;

     |SI cPart = "NULL";
          cPart = "";
     |FINSI;

|FPRC;
--------------------------------------------------------------------------------
|PROCESO PasaFich;
     cOrigen = cDirEmpr + "wait.exe";
     cDestino = cDirApli + "\wait.exe"
     |HAZ CopiaFich;
     cOrigen = cDirEmpr + "arbol.txt";
     cDestino = cDirApli + "\arbol.txt"
     |HAZ CopiaFich;
|FPRC;
-------------------------------------------------------------------------------
|PROCESO CopiaFich;
     |IP_REMOTO cIp;
     |QBF cIp;
     |SI cIp = "";
          |COPIA_FICHERO cOrigen, cDestino;
     |SINO;
          |ENVIA_FICHERO cOrigen, cDestino;
     |FINSI;
|FPRC;
-------------------------------------------------------------------------------
|PROCESO Ent7; |TIPO 7;
     cParametro = PARAMETRO;

     |SI cParametro = "PRES";
          |CLS;
     |FINSI;

     |SI cParametro ! "CREA";
          #0#3 = "S";
          |C_M #0#3, 1, "N";
     |FINSI;

|FPRC;
--------------------------------------------------------------------------------
