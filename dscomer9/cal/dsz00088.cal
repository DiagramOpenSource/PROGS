|FICHEROS;
     dsz00088 #10; ||Este
     agifa501 #0;
     agifa502 #1;
     agifa019 #2;
     agifa084 #12;
     agifa069 #13;
     agifa142 #142;
|FIN;

|VARIABLES;
     &aMoneda = "";
     &aDivisa = "";
     nDto = 0;
     nNeto = 0;
     nNume = 0;
     nImpo = 0;
|FIN;

|PROCESO agifa502;
     #13#20 = #0#57;        ||Serie
     #13#0 = #0#58;
     #13#1 = #1#1;
     |LEE 101#13=;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |DDEFECTO #2;
     #2#0 = #13#2;
     |LEE 000#2=;

     |SI #2#194 = 2;
          #13#7 = #1#29 * #13#6;||Importe
          #13#9 = (#1#29 * #13#6) < #13#8;||Imp.Tot
     |SINO;
          #13#7 = #1#5 * #13#6;||Importe
          #13#9 = (#1#5 * #13#6) < #13#8;||Imp.Tot
     |FINSI;

     #13#26 = #13#6;
     #13#27 = #13#9;
     #13#28 = #13#6;
     #13#29 = #13#9;

     |GRABA 020#13a;
     |LIBERA #13;
|FPRC;

|DEFBUCLE agifa502;
     #1#1;
     ;
     #0#36, #0#0, 001;
     #0#36, #0#0, 999;
     ;
     NULL, agifa502;
|FIN;

|PROCESO agifa501;
     #12#48 = #0#57;
     #12#0 = #0#58;
     |LEE 101#12=;
     |SI FSalida ! 0; |ACABA; |FINSI;

     aDivisa = #12#65;
     aMoneda = #12#67;
     |HAZ Divisas084;

     |SI #0#3 > 0; nNume = 1; |SINO; nNume = -1; |FINSI;
     #0#3 = #0#3 * nNume;
     nDto = (((#0#3 < #0#17) < #0#19) < #0#18) * nNume;
     #0#3 = #0#3 * nNume;
     nDto = #0#3 - nDto;
     nNeto = #0#3 - nDto;
     |SI #142#115 = "N";
          nImpo = (nNeto * 100) / (100 - #0#18);
          nDto = nDto + (nNeto - nImpo);
     |FINSI;

     #12#15 = #0#3;             ||Total bruto
     #12#36 = #0#29;            ||Regimen equivalencia || *(3)

     #12#28 = #0#30;            ||Base Exenta

     #12#16 = #0#20;            ||Base Iva 1
     #12#17 = #0#21;            ||Cuota Iva 1
     #12#18 = #0#22;            ||Cuota Rec Iva 1

     #12#19 = #0#23;            ||Base Iva 2
     #12#20 = #0#24;            ||Cuota Iva 2
     #12#21 = #0#25;            ||Cuota Rec Iva 2

     #12#22 = #0#26;            ||Base Iva 3
     #12#23 = #0#27;            || Cuota I.Va. 3
     #12#49 = #0#47;

     #12#42 = #0#48;            ||Base iva 4
     #12#43 = #0#49;            ||Cuota iva 4
     #12#44 = #0#50;            ||Cuota Rec iva 4

     #12#45 = #0#51;            ||Base iva 5
     #12#46 = #0#52;            ||Cuota iva 5
     #12#47 = #0#53;            ||Cuota Reciva 5

     #12#24 = #0#4;             ||Total iva
     #12#25 = nDto;             ||Total descuento
     #12#41 = #0#9;             ||Total factura

     #12#70 = #0#3;    ||Bruto en Divisa
     #12#71 = #0#9;    ||Total Albaran en Divisa
     #12#72 = #0#3;    ||Bruto (vis)
     #12#73 = #0#9;    ||Total (vis)
     #12#74 = #0#3;    ||Bruto (no vis)
     #12#75 = #0#9;    ||Total (no vis)

     |GRABA 020#12a;
     |LIBERA #12;

     |BUCLE agifa502;
|FPRC;

|DEFBUCLE agifa501;
     #0#3;
     ;
     #10#0, "      ", "F", "     ", 000001;
     #10#1, "zzzzzz", "F", "zzzzz", 999999;
     ;
     NULL, agifa501;
|FIN;

|PROCESO Tipo3; |TIPO 3;
     |ABRE #142; |LEE 000#142p; |CIERRA #142;
     |ABRE #12;
     |ABRE #13;
     |ABRE #2;
     |BUCLE agifa501;
     |CIERRA #2;
     |CIERRA #13;
     |CIERRA #12;
|FPRC;
