|FICHEROS;
     guerm207 #0;
     guerm208 #1;
     guerm209 #2; ||Anexo
     guerm204 #204;
     guerm202 #202;
     agifa019 #19;
     agifa024 #24;
     guerm221 #221; ||Anexo Fijo
     referen@;
|FIN;

|VARIABLES;
     aDef = "";
     aSql = "";
     &enSwAnexo = 0;          || para el informe
     nContrato = 0;
     nModo = 0;
  {-1}aMenu = "";
     aMenu1 = "2400";
     aMenu2 = "1";
     aMenu3 = "Opciones: ";
     aMenu4 = "AI";
     aMenu5 = " Anexo ";
     aMenu6 = " Imprimir ";
     nBuffer = 0;
     nPuntero = 0;
     nCalc = 0;
     nLineas = 0;
     aAlfa = "";
     nLin = 0;
     nCol = 0;
     &enCto = 0;
|FIN;

|PROCESO ConTipo7; |TIPO 7;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 1;
          |LEE 000#0u;
          |SI FSalida = 0;
               nContrato = #0#0 + 1;
          |SINO;
               nContrato = 1;
          |FINSI;
          |DDEFECTO #0;
          #0#0 = nContrato;
     |FINSI;
|FPRC;

|PROCESO BorraAnexo;
     |BORRA 020#2a;
|FPRC;

|DEFBUCLE BorraAnexo;
     #2#1;
     ;
     #0#0, 001;
     #0#0, 999;
     ;
     NULL, BorraAnexo;
|FIN;

|PROCESO ConTipo2; |TIPO 2;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 3;
          |BUCLE BorraAnexo;
     |FINSI;
|FPRC;

|PROCESO AnexoFijo;
     #2#0 = #0#0;
     #2#1 = #221#2;
     #2#2 = #221#3;
     |GRABA 020#2n;
|FPRC;

|DEFBUCLE AnexoFijo;
     #221#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, AnexoFijo;
|FIN;

|PROCESO ConTipo3; |TIPO 3;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 1;
          |ABRE #2;
          |BUCLE AnexoFijo;
          |CIERRA #2;
     |FINSI;

     |HAZ Anexo;
     |CONFI "0000NImprimir documento?";
     |SI FSalida = 0;
          |HAZ Imprime;
     |FINSI;
|FPRC;

|PROCESO ConTipo20; |TIPO 20;
     |SI FSalida = "OPCION";
          FSalida = "Opciones";
     |SINO;
          |LEE 000#0=;
          |SI FSalida ! 0; |ACABA; |FINSI;
          |MENU aMenu;
          |SI FSalida = 1;
               |HAZ Anexo;
          |FINSI;
          |SI FSalida = 2;
               |HAZ Imprime;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Anexo;
     enCto = #0#0;
     |SUB_EJECUTA_NP "guerm209";
|FPRC;

|PROCESO ImpAnexo;
     |SI enSwAnexo = 0;
          enSwAnexo = 1;
          |PRINT;
     |FINSI;
     enSwAnexo = 2;
     |PRINT;
|FPRC;

|DEFBUCLE ImpAnexo;
     #2#1;
     ;
     #0#0, 001;
     #0#0, 999;
     ;
     NULL, ImpAnexo;
|FIN;

|PROCESO ImpreLin;
     |PRINT;
|FPRC;

|PROCESO Imprime;
     |IMPRE 0;
     |SI FSalida = 0;
          |INFOR "guerm207";
          |SI FSalida ! 0;
               |MENAV "0000No existe informe 'guerm207'";
          |SINO;
               enSwAnexo = 0;
               |BUCLELIN 2ImpreLin#0;
               |BUCLE ImpAnexo;
               |PIEINF;
               |FININF;
          |FINSI;
          |FINIMP;
     |FINSI;
|FPRC;

|PROCESO ConArt0; |TIPO 0;
     |SI #1Campo ! Contenido;
          |ABRE #24;
          #24#0 = #0#1;
          |LEE 000#24=;
          |CIERRA #24;

          |ABRE #19;
          #19#0 = #1#2;
          |LEE 000#19=;
          |SI FSalida = 0;
               |SI #24#39 = 1; #1#6 = #19#18; #1#8 = #19#21; |FINSI;
               |SI #24#39 = 2; #1#6 = #19#19; #1#8 = #19#22; |FINSI;
               |SI #24#39 = 3; #1#6 = #19#20; #1#8 = #19#23; |FINSI;
               |SI #24#39 = 4; #1#6 = #19#147; #1#8 = #19#150; |FINSI;
               |SI #24#39 = 5; #1#6 = #19#148; #1#8 = #19#151; |FINSI;
               |SI #24#39 = 6; #1#6 = #19#149; #1#8 = #19#152; |FINSI;
          |FINSI;
          |CIERRA #19;
          |CIERRA #19;
          |ABRE #204;
          #204#0 = #0#1;
          #204#1 = #0#2;
          #204#2 = #1#2;
          |LEE 000#204=;
          |SI FSalida = 0;
               #1#6 = #204#6;
               #1#8 = #204#7;
          |FINSI;
          |CIERRA #204;
          |PINTA #1#6;
          |PINTA #1#8;
     |FINSI;
|FPRC;

|PROCESO RellenaObra;
     #1#12 = #0#2;
     #1#13 = #0#1;
     |GRABA 020#1a;
     |LIBERA #1;
|FPRC;

|PROCESO Obra0; |TIPO 0;
     |ABRE #202;
     #202#0 = #0#1;
     #202#2 = #0#2;
     |LEE 000#202=;
     |SI #202#6 = "N";
          |MENAV "0000Obra Cerrada...";
          |ERROR;
     |SINO;
          |BUCLELIN 0 RellenaObra #0;
     |FINSI;
     |CIERRA #202;
|FPRC;

|PROCESO Obra66; |TIPO 66;
     aSql = "SELECT * FROM guerm202 INTO sq" + Usuario + ".def WHERE ";
     aSql = aSql + "6 == S AND 0 == " + #0#1;

     |SQL aSql;
     |SI FSalida = 0;
          |DDEF aDef; |QBF aDef;
          aDef = aDef + "sq" + Usuario + ".mas";
          |CARGA_DEF aDef, referen@;
          |SI FSalida = 0;
               |ABRE #referen@;
               |CONSULTA_CLAVE #1#referen@;
               |SI FSalida = 0;
                    #0#2 = #referen@#2;
                    #0#4 = #referen@#4;
                    |PINTA #0#2;
                    |PINTA #0#4;
               |SINO;
                    |ERROR;
               |FINSI;
               |CIERRA #referen@;
               |DELINDEX #referen@;
               |DESCARGA_DEF #referen@;
               |FBORRA aDef;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO ConPrecio; |TIPO 0;
     |ABRE #204;
     #204#0 = "000000";
     #204#6 = #0#1;
     #204#1 = #0#2;
     #204#2 = #1#2;
     |LEE 101#204=;
     |SI FSalida ! 0;
          |ABRE #19;
          #19#0 = #1#2;
          |LEE 000#19=;
          |CIERRA #19;
          #204#3 = #0#3;
          #204#4 = #0#4;
          #204#5 = #19#1;
          |GRABA 020#204b;
     |FINSI;
     #204#6 = #1#6;
     #204#7 = #1#8;
     |GRABA 020#204a;
     |CIERRA #204;
|FPRC;

|PROCESO CalPreDto; |TIPO 0;
     #1#9 = #1#6 < #1#8;
     |PINTA #1#9;
|FPRC;
