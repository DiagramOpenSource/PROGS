|FICHEROS;
  psion013 #0;
  agifa321 #14;  || Divisas-Parametros.
  agifa324 #15;  || Divisas-Divisas.
  agifa025 #25;
  agifa084 #84;

  dscam045@ #200;
  dscam003@ #201;
  dscam004@ #202;
  dscamrie@ #100;
  dscam038@ #101;
  dscam023@ #102;
|FIN;

|VARIABLES;
     nReci = 0;
     &eaCtaDesprecio = "";
     &eaCuenta = "";
     &efFecha = @;
     &eaTag    = "";
     &aSer     = "";
     &aCli     = "";
     &aNomCli  = "";
     &nImpo    = 0;

     nSwJamaica = 0;
     nCob = 0;
     nEl19 = 0;
     nEl09 = 0;

     aAlfa = "";
     nLinea = 0;
     nNume = 0;
|FIN;

|PROCESO BuscaReci;
     |SI #0#16 = 3; ||Tablet
          nReci = 0;
          |SELECT #12#dscam003@;
          #dscam003@#0 = #0#0;
          #dscam003@#1 = #0#1;
          #dscam003@#2 = #0#2;
          #dscam003@#4 = #0#9;
          #dscam003@#5 = "";
          #dscam003@#32 = "";
          |LEE 000#dscam003@.];
          |PARA; |SI FSalida = 0; |Y #dscam003@#0 = #0#0;
                    |Y #dscam003@#1 = #0#1;
                    |Y #dscam003@#2 = #0#2;
                    |Y #dscam003@#4 = #0#9; |HACIENDO;
               |SI #dscam003@#69 = " ";
                    nReci = #dscam003@#40;
               |FINSI;
               |LEE 000#dscam003@.s;
          |SIGUE;
          |SELECT #1#dscam003@;
     |SINO;
          nReci = #0#7;
     |FINSI;
|FPRC;

|PROCESO JamaEntregaPen;
     |HAZ BuscaReci;
     #dscam003@#40 = nReci;
     |LEE 101#dscam003@.=;
     |SI FSalida = 0;
        nLinea = 1;
        #dscam004@#17 = nReci;
        #dscam004@#3  = 1;
        |LEE 000#dscam004@.];
        |PARA; |SI FSalida = 0; |Y #dscam004@#17 = nReci; |HACIENDO;
           nLinea = #dscam004@#3 + 1;
           |LEE 000#dscam004@.s;
        |SIGUE;
        |DDEFECTO #dscam004@;
        #dscam004@#17 = nReci;
        #dscam004@#3  = nLinea;
        |GRABA 020#dscam004@.b;
        #dscam004@#0 = #0#0;
        #dscam004@#1 = #0#1;
        #dscam004@#2 = #0#2;
        #dscam004@#4 = eaCtaDesprecio;
        #dscam004@#5 = "COB";
        #dscam004@#6 = efFecha;
        #dscam004@#7 = #dscam003@#23;
        #dscam004@#8 = nNume;
        #dscam004@#25 = #dscam003@#61;
        #dscam004@#26 = nNume * #dscam003@#59;
        #dscam004@#33 = 1;
        |GRABA 020#dscam004@.a; |LIBERA #dscam004@;

        #dscam003@#23 = #dscam003@#23 + nNume;
        #dscam003@#61 = #dscam003@#61 + (nNume * #dscam003@#59);
        #dscam003@#31 = #dscam003@#31 - nNume;
        #dscam003@#65 = #dscam003@#65 - (nNume * #dscam003@#59);
        #dscam003@#26 = ~;
        |SI #dscam003@#31 = 0;
           #dscam003@#14 = "L";
           #dscam003@#15 = "Recibo Liquidado";
        |SINO;
           |SI #dscam003@#23 ! 0;
              #dscam003@#14 = "C";
              #dscam003@#15 = "Cobrado parcialmente";
           |FINSI;
        |FINSI;
        |SI #0#8 ! 0;
             #dscam003@#12 = 3; || Tipo Recibo
             #dscam003@#99 = #0#9; || F.Emision
        |FINSI;
        |GRABA 020#dscam003@.a; |LIBERA #dscam003@;
     |FINSI;

     aSer = #dscam003@#0;
     aCli = #dscam003@#32;
     aNomCli = #dscam003@#6;
     nImpo = -nNume;
     eaTag   = "CB"; |HAZ Riesgos;
|FPRC;

|CALCULO pasecob;
     |HAZ LeeDivisa;

     |DDEFECTO #84;
     #84#48 = #0#0;
     #84#0 = #0#1;
     |LEE 000#84=;
     |DDEFECTO #25;
     #25#0 = #84#6;
     |LEE 000#25=;

     |DBASS aAlfa; aAlfa = aAlfa + "dscarter/def/dscam045.mas";
     |CARGA_DEF aAlfa, dscam045@;
     |SI FSalida = 0;
        |DBASS aAlfa; aAlfa = aAlfa + "dscarter/fich/"; |PATH_DAT #200 aAlfa;
        |ABRE #dscam045@;
        |DBASS aAlfa; aAlfa = aAlfa + "dscarter/def/dscam003.mas";
        |CARGA_DEF aAlfa, dscam003@;
        |SI FSalida = 0;
           |DBASS aAlfa; aAlfa = aAlfa + "dscarter/def/dscam004.mas";
           |CARGA_DEF aAlfa, dscam004@;
           |SI FSalida = 0;
              aAlfa = "";
              #dscam045@#0 = #48#0;
              #dscam045@#1 = 1;
              |LEE 000#dscam045@.];
              |PARA; |SI FSalida = 0; |Y #dscam045@#0 = #48#0; |HACIENDO;
                 |SI #dscam045@#4 [ #0#0; |Y #dscam045@#5 ] #0#0;
                    |DBASS aAlfa; aAlfa = aAlfa + "dscarter/fich/" + (("00000" + #dscam045@#6) % -105) + "/";
                    |SAL;
                 |FINSI;
                 |LEE 000#dscam045@.s;
              |SIGUE;
              |SI aAlfa ! "";
                 |PATH_DAT #201 aAlfa; |PATH_DAT #202 aAlfa;
                 |ABRE #dscam003@;   |ABRE #dscam004@;
                 |HAZ BuscaReci;
                 #dscam003@#40 = nReci;
                 |LEE 101#dscam003@.=;
                 |SI FSalida = 0;
                    nLinea = 1;
                    #dscam004@#17 = nReci;
                    #dscam004@#3  = 1;
                    |LEE 000#dscam004@.];
                    |PARA; |SI FSalida = 0; |Y #dscam004@#17 = nReci; |HACIENDO;
                       nLinea = #dscam004@#3 + 1;
                       |LEE 000#dscam004@.s;
                    |SIGUE;
                    |DDEFECTO #dscam004@;
                    #dscam004@#17 = nReci;
                    #dscam004@#3  = nLinea;
                    |GRABA 020#dscam004@.b;
                    #dscam004@#0 = #0#0;
                    #dscam004@#1 = #0#1;
                    #dscam004@#2 = #0#2;
                    #dscam004@#4 = eaCuenta;
                    #dscam004@#5 = "COB";
                    #dscam004@#6 = efFecha;
                    #dscam004@#7 = #dscam003@#23;
                    #dscam004@#8 = #0#5;
                    #dscam004@#25 = #dscam003@#61;
                    #dscam004@#26 = #0#5 * #dscam003@#59;
                    #dscam004@#33 = 1;
                    |GRABA 020#dscam004@.a; |LIBERA #dscam004@;

                    #dscam003@#23 = #dscam003@#23 + #0#5;
                    #dscam003@#61 = #dscam003@#61 + (#0#5 * #dscam003@#59);
                    #dscam003@#31 = #dscam003@#31 - #0#5;
                    #dscam003@#65 = #dscam003@#65 - (#0#5 * #dscam003@#59);
                    #dscam003@#26 = ~;
                    |SI #dscam003@#31 = 0;
                       #dscam003@#14 = "L";
                       #dscam003@#15 = "Recibo Liquidado";
                    |SINO;
                       |SI #dscam003@#23 ! 0;
                          #dscam003@#14 = "C";
                          #dscam003@#15 = "Cobrado parcialmente";
                       |FINSI;
                    |FINSI;
                    |SI #0#8 ! 0;
                         #dscam003@#12 = #0#8; || Tipo Recibo
                         #dscam003@#99 = #0#9; || F.Emision
                    |FINSI;
                    #dscam003@#33 = #25#0;
                    #dscam003@#34 = #25#1;
                    |GRABA 020#dscam003@.a; |LIBERA #dscam003@;
                 |FINSI;

                 aSer = #dscam003@#0;
                 aCli = #dscam003@#32;
                 aNomCli = #dscam003@#6;
                 nImpo = -#0#5;
                 eaTag   = "CB"; |HAZ Riesgos;

                 |SI nSwJamaica = 0;
                      nNume = #0#4 - #0#5;
                      |SI #0#6 = "S"; |Y nNume ! 0;
                         |HAZ JamaEntregaPen;
                      |FINSI;
                 |FINSI;
                 |CIERRA #dscam003@; |CIERRA #dscam004@;

              |FINSI;
              |DESCARGA_DEF #dscam004@;
           |FINSI;
           |DESCARGA_DEF #dscam003@;
        |FINSI;
        |CIERRA #dscam045@; |DESCARGA_DEF #dscam045@;

        #0#7 = nReci;
        #0#10 = "S";
        |GRABA 020#0a;
     |FINSI;
     |LIBERA #0;
|FCAL;

|DEFBUCLE pasecobros;
     #0#1;
     6, 10;
     "     " ,       0 , 000 , 00, "S", "N";
     "zzzzz" ,  999999 , 999 , 99, "S", "N";
     be;
     NULL,pasecob;
|FIN;

|DEFBUCLE CobrosJamaica;
     #0#1;
     10;
     "     " ,       0 , 000 , 00, "N";
     "zzzzz" ,  999999 , 999 , 99, "N";
     be;
     NULL,pasecob;
|FIN;

|PROGRAMA;
     |HAZ EsJamaica; nSwJamaica = FSalida;

     |ABRE #84;
     |ABRE #25;
     |SI nSwJamaica = 0;
          |BUCLE CobrosJamaica;
     |SINO;
          |BUCLE pasecobros;
     |FINSI;
     |CIERRA #25;
     |CIERRA #84;
|FPRO;

|PROCESO LeeDivisa;
     |ABRE #14;
     |ABRE #15;
     #14#0 = "A";
     |LEE 001#14=;
     |SI FSalida ! 0; |DDEFECTO #14; |FINSI;
     #15#0 = #14#9;
     |LEE 001#15=;
     |SI FSalida ! 0; |DDEFECTO #15; |FINSI;
     |LIBERA #14;
     |LIBERA #15;
     |CIERRA #14;
     |CIERRA #15;
|FPRC;
