     AsignaCobro ->   Llamado por pcegz046 y pcegz047
     AsignaCobroN43 ->   Llamado por pcegz050
     AsignaCobroN43Rec -> Llamado por pcegz050
|FICHEROS;
     pcegm004 #4;
     pcegm005 #5;
     agifa017 #17;
     agifa019 #19;
     agifa024 #24;
     pcegm029 #29;
     pcegm033 #33;
     pcegm034 #34;
     pcegm035 #35;
     agis0002 #102;
     agifa142 #142;
     agifa177 #177;
     agifa324 #324;
     :/dscarter/def/dscam003 #3;
     :/dscarter/def/dscam004 #104;
     dscamrec@ #600;
     agifa324;
     dsm00289 #289;
|FIN;

|VARIABLES;
     &aCPath = "";
     &aCNome = "";
     &eaTag = "";
     &Tempo = "";
     &eaSerie = "";
     &enPedido = 0;
     &efFecha = @;
     nCambio = 0;
     fFecha = @;
     Divisa = "";
     CambioBase = 0;
     CambioDiv = 0;
     aTempo600 = "";
     nHandle = 0;
     aPath = "";
     aAlfa = "";
     aDef00 = "";
     aSubProg = ":dscarter/dsrecibo";
     aMensa = "";
     aEmp = "";
     &nDeci_Div = 0;
     fCobro = @;
     fVto = @;
     nCobrado = 0;
     nCob = 0;
     aCta = "";
     nEntrega = 0;
     nTipoRec = 0;
|FIN;

|PROCESO ActStock;
     |DDEFECTO #19;
     |DDEFECTO #17;
     #19#0 = #5#2;
     |LEE 101#19=;
     |SI FSalida ! 0; |GRABA 020#19b; |FINSI;
     #17#0 = #5#2;
     #17#1 = #5#3;
     |LEE 101#17=;
     |SI FSalida ! 0; |GRABA 020#17b; |FINSI;
     #19#15 = #19#15 + #5#5;
     #19#182 = #19#182 + #5#44;
     #17#42 = #17#42 + #5#5;
     #17#44 = #17#44 + #5#44;
     |GRABA 020#19a;
     |GRABA 020#17a;
     |LIBERA #17;
     |LIBERA #19;
|FPRC;

|PROCESO HallaMoneda;
     Divisa  = #4#35;
     CambioBase = #4#41;
     CambioDiv = #4#36;
|FPRC;

|PROCESO EntregaCartera;
     |DFICE aAlfa;
     aEmp = aAlfa % -205;

     |DBASS aAlfa;
     aAlfa = aAlfa + "dscarter/fich/dscam000.dat";
     |XABRE "E", aAlfa, nHandle;
     |SI FSalida = 0;
          |DBASS aPath;
          aPath = aPath + "dscarter/";
          aDef00 = aPath + "def/dscamrec";

          |CARGA_DEF aDef00, dscamrec@;
          |SI FSalida ! 0;
               aMensa = "0000Error al cargar:" + aDef00;
               |MENAV aMensa;
          |SINO;
               |HAZ CreaTempo; aTempo600 = Tempo;
               |PATH_DAT #600 aPath; |NOME_DAT #600 aTempo600; |DELINDEX #600;
               |ABRE #600;
               aCPath = aPath; aCNome = aTempo600;

               |HAZ HallaMoneda;

               |ABRE #agifa324;
               #agifa324#0 = Divisa;
               |LEE 020#agifa324.=;
               |CIERRA #agifa324;
               |ABRE #agifa024;
               #agifa024#0 = #agis0002#2;
               |LEE 000#agifa024.=;
               |CIERRA #agifa024;

               nDeci_Div = #agifa324#7;
               |DDEFECTO #dscamrec@;
               ||#600#0  =              ||Libro
               #600#1  = #102#20;     ||Serie
               #600#2  = #102#17;     ||Fact
               #600#3  = #agis0002#18;||N§ Rec
               #600#4  = #agis0002#8; ||F.V
               #600#5  = #agis0002#7; ||F.E
               #600#6  = #agis0002#12;||Cuenta Cli
               #600#7  = #agis0002#3; ||Nom Cli
               #600#8  = #agis0002#4; ||Nom Banco
               #600#9  = #agifa024#32;      ||Entidad
               #600#10 = #agifa024#33;      ||Sucursal
               #600#11 = #agifa024#31;      ||DC
               #600#12 = aCta;              ||Cuenta
               #600#13 = #agis0002#22;||Tipo Rec
               ||#600#14 =      ||Departa
               #600#15 = #agis0002#9; ||Importe
               #600#16 = #agis0002#15;||A aceptar
               #600#17 = #agis0002#6; ||Aceptado
               #600#18 = #agis0002#2; ||Cliente
               #600#21 = #agifa024#3; ||Zona
               #600#22 = 1;           ||Documento
               ||#600#23 =      ||Empresa Contable
               ||#600#24 =      ||Periodo
               #600#25 = aEmp;       ||Empresa ges
               ||#600#26 =      ||A cuenta
               #600#27 = "V";         ||Tipo
               #600#28 = "A";         ||Ope
               #600#29 = #agifa324#0;      ||Divisa
               #600#30 = #agifa324#1;      ||Nombre
               #600#31 = CambioDiv;        ||Cambio Divisa
               #600#32 = CambioBase;       ||Cambio Base
               #600#33 = #agifa024#203;
               #600#34 = 0;
               #600#35 = "P";
               #600#36 = #agis0002#28;
               #600#38 = #agis0002#16;
               #600#39 = #agis0002#10;
               aAlfa = "|NC"; aAlfa = #600#aAlfa#;
               |SI aAlfa > 48;
                    #600#48 = #agifa024#215;
                    #600#49 = #agifa024#216;
               |FINSI;
               |SI aAlfa > 50;
                    #600#50 = #agifa024#217;
                    |ABRE #289;
                    #289#0 = #agifa024#0;
                    |LEE 000#289=;
                    |SI FSalida ! 0; |DDEFECTO #289; |FINSI;
                    |CIERRA #289;
                    #600#51 = #289#1;
               |FINSI;
               |GRABA 020#600n;
               |SUB_EJECUTA_NP aSubProg;

               |CIERRA #600;
               |DELINDEX #600;
               |DESCARGA_DEF #dscamrec@;

               |HAZ BoraTempo;
          |FINSI;

          eaTag = "RAP";
          |HAZ Riesgos;
     |FINSI;
|FPRC;

|PROCESO EntregaPedido;
     |DDEFECTO #24;
     #24#0 = #4#4;
     |LEE 000#24=;

     |ABRE #102;
     #102#30 = "P";
     #102#20 = #4#25;
     #102#17 = #4#0;
     |LEE 000#102];
     |SI FSalida = 0; |Y #102#30 = "P"; |Y #102#20 = #4#25; |Y #102#17 = #4#0;
          nEntrega = #102#18 + 1;
     |SINO;
          nEntrega = 1;
     |FINSI;
     |DDEFECTO #102;
     #102#30 = "P";
     #102#20 = #4#25;
     #102#17 = #4#0;
     #102#18 = nEntrega;

     #102#2 = #24#0;
     #102#3 = #24#1;
     #102#4 = #24#29;
     #102#7 = #4#1;
     #102#12 = #24#16;
     #102#24 = #4#9;
     #102#9 = nCobrado;
     #102#16 = fCobro;
     #102#8 = fVto;
     #102#22 = nTipoRec;
     #102#28 = aCta;
     |GRABA 020#102n;
     |CIERRA #102;
|FPRC;

|PROCESO AsignaCobro;
     |ABRE #33; |LEE 000#33p; |CIERRA #33;
     |ABRE #177;
     #177#0 = #33#10;
     |LEE 000#177=;
     |CIERRA #177;
     aCta = #177#3;
     nTipoRec = #33#10;

     #29#40 = #34#0;
     |GRABA 020#29a;

     #34#11 = "C";
     #34#12 = #29#0;
     #34#13 = #29#28;
     #34#14 = #29#29;
     #34#15 = #29#30;
     |GRABA 020#34a;

     |ABRE #4;
     |ABRE #24;
     #4#25 = #29#28;
     #4#0 = #29#29;
     |LEE 121#4=;
     |SI FSalida = 0;
          |SI #34#3 ] #4#11;  || Importe > Cobro
               #4#70 = "C";
               #4#76 = 1;
               |GRABA 020#4a;
               |ABRE #17;
               |ABRE #19;
               |BUCLELIN 2 ActStock #4;
               |CIERRA #19;
               |CIERRA #17;
          |FINSI;
          |LIBERA #4;

          nCobrado = #34#3;
          fCobro = #34#1;
          fVto = #34#1;
          |HAZ EntregaPedido;
          |HAZ EntregaCartera;

          fFecha = ~;
          |SI #4#66 [ fFecha; |Y #4#70 = "C";
               eaSerie = #4#25;
               enPedido = #4#0;
               efFecha = #4#66;
               |SUB_EJECUTA_NP "pcegz018";
          |FINSI;
     |FINSI;
     |CIERRA #24;
     |CIERRA #4;
|FPRC;

|PROCESO AsignaCobroN43;
     |ABRE #33; |LEE 000#33p; |CIERRA #33;
     |ABRE #177;
     #177#0 = #33#9;
     |LEE 000#177=;
     |CIERRA #177;
     aCta = #177#3;
     nTipoRec = #33#9;

     |ABRE #24;

     #35#14 = #4#25;
     #35#15 = #4#0;
     |GRABA 020#35a;

     |SI #35#7 ] #4#11;
          #4#70 = "C";
          #4#76 = 1;
          |GRABA 020#4a;
     |FINSI;
     |LIBERA #4;

     nCobrado = #35#7;
     fCobro = #35#2;
     fVto = #35#2;
     |HAZ EntregaPedido;
     |HAZ EntregaCartera;

     fFecha = ~;
     |SI #4#66 [ fFecha; |Y #4#70 = "C";
          eaSerie = #4#25;
          enPedido = #4#0;
          efFecha = #4#66;
          |SUB_EJECUTA_NP "pcegz018";
     |FINSI;
     |CIERRA #24;
|FPRC;

|PROCESO AsignaCobroN43Rec;
     |ABRE #33; |LEE 000#33p; |CIERRA #33;
     |ABRE #177;
     #177#0 = #33#9;
     |LEE 000#177=;
     |CIERRA #177;
     aCta = #177#3;
     nTipoRec = #33#9;

     #35#16 = #3#40;
     |GRABA 020#35a;

     |DDEFECTO #324;
     |ABRE #324;
     #324#0 = #3#57;
     |LEE 000#324=;
     nCambio = #324#2;
     |CIERRA #324;

     #104#17 = #3#40;
     #104#3 = 99;
     |LEE 000#104];
     |SI FSalida = 0;
          |LEE 000#104a;
     |SINO;
          |LEE 000#104u;
     |FINSI;
     |SI FSalida = 0; |Y #104#17 = #3#40;
          nCob = #104#3 + 1;
     |SINO;
          nCob = 1;
     |FINSI;
     |DDEFECTO #104;
     #104#17 = #3#40;
     #104#3 = nCob;

     #104#0 = #3#0;
     #104#1 = #3#1;
     #104#2 = #3#2;
     #104#4 = "";      ||Cuenta
     #104#6 = #35#2;

     nCobrado = #35#7;

     #104#7 = nCobrado; || Liquidado
     #104#25 = #104#7 * nCambio;

     #104#8 = nCobrado;     || Cobrado
     #104#26 = #104#8 * nCambio;

     #104#10 = 0;     || Gastos
     #104#28 = #104#10 * nCambio;

     #104#12 = 0;     || Gastos nego
     #104#29 = #104#12 * nCambio;

     #104#33 = nCambio;


     #3#23 = #3#23 + nCobrado;    || Liquidado
     #3#61 = #3#23 * nCambio;

     #3#24 = 0;      || Gastos
     #3#62 = #3#23 * nCambio;

     #3#31 = #3#31 - nCobrado;    || Pendiente
     #3#65 = #3#31 * nCambio;

     |SI #3#31 [ 0;
          #3#14 = "L";
          #3#15 = "Recio Liquidado";

          #104#5 = "COB";
     |SINO;
          #104#5 = "COP";
     |FINSI;
     |GRABA 020#3a;


     |GRABA 020#104n;
|FPRC;
