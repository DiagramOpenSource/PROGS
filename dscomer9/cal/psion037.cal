|FICHEROS;
     psion001 #1;
     psion004 #4;
     psion005 #5;
     agifa019 #19;
     agifa041 #41;
     agifa081 #81;
     agifa067 #67;
     agifa112 #112;
     agifa142 #142;
     agifa321 #321;
     agifa324 #324;
|FIN;

|VARIABLES;
     &enForma = 1;
     &eaDocu = "";
     &aDivisa = "";
     &aMoneda = "";
     &enImpPrvPed = 0;
     &efFecha = @;
     &eaProve = "";
     aSerie = "";
     nNume = 0;
     fmes1 = "";
     mes = 0;
     nImpo = 0;
     nForma = 1;
     aDatos = "";
     nCodEmp = 0;
     aDirEmp = "";
|FIN;

|PROCESO ActProv;
     |DDEFECTO #112;
     |ABRE #112;
     #112#0 = #81#4;
     |LEE 101#112=;
     |SI FSalida ! 0;
          #112#1 = #4#5;      || nombre fiscal
          #112#2 = #4#5;      || nombre comercial
          |GRABA 020#112b;
     |FINSI;

     |DDEFECTO #19;
     |ABRE #19;
     #19#0 = #67#2;
     |LEE 000#19=;
     |CIERRA #19;

     fmes1 = #81#1 % A402;
     mes = fmes1 + 42;
     |SI #19#196 = 2;
          nImpo = (((((#67#41 * #67#6) < #67#8) < #67#27) < #67#57) < #81#5) < #81#17;
     |SINO;
          nImpo = (((((#67#5 * #67#6) < #67#8) < #67#27) < #67#57) < #81#5) < #81#17;
     |FINSI;
     |SI #142#114 = "S";
          nImpo = nImpo < #81#6;
     |FINSI;
     #112mes = #112mes + (nImpo * nForma);
     #112#55 = #112#55 + (nImpo * nForma);

     |GRABA 020#112a;
     |LIBERA #112;
     |CIERRA #112;

     enImpPrvPed = nImpo * nForma;
     efFecha = #81#1;
     eaProve = #81#4;
     |HAZ AcumulaPrv;
|FPRC;

|PROCESO psion005;
     |DDEFECTO #19;
     |ABRE #19;
     #19#0 = #5#4;
     |LEE 000#19=;
     |CIERRA #19;

     |DDEFECTO #67;
     #67#28 = #5#2;
     #67#0 = #5#1;
     #67#1 = #5#3;
     |GRABA 000#67b;
     |SI FSalida ! 0; |ACABA; |FINSI;
     #67#2 = #5#4;
     #67#4 = #5#5;
     #67#5 = #5#6; #67#37 = #5#6;
     #67#6 = #5#7; #67#33 = #5#7;
     #67#8 = #5#8;
     #67#14 = #5#9;
     #67#3 = #5#11;
     |SI #67#3 = 0; #67#3 = 1; |FINSI;
     #67#42 = #5#12;
     #67#27 = #5#13;
     #67#57 = 0;

     #67#13 = #81#2; ||F.Ent
     #67#18 = #19#2;
     #67#20 = #81#4;
     #67#26 = #81#9;

     |GRABA 020#67a;
     |LIBERA #67;
     eaDocu = "agifa067";
     enForma = 1;
     |HAZ StockEntra;
|FPRC;

|PROCESO psion004;
     |SI aSerie ! #4#2; |O nNume ! #4#3;
          |SI aSerie ! "";
               |HAZ CalCabAgifa081;
               |HAZ ActProv;
          |FINSI;
          aSerie = #4#2;
          nNume = #4#3;
     |FINSI;

     |DDEFECTO #112;
     |ABRE #112;
     #112#0 = #4#4;
     |LEE 000#112=;
     |CIERRA #112;

     |DFICE aDirEmp;
     |DFICB aDatos;
     aDirEmp = aDirEmp % -205;
     nCodEmp = aDirEmp;
     |PATH_DAT #41 aDatos;
     |ABRE #41;
     #41#0 = nCodEmp;
     |LEE 000#41=;
     |CIERRA #41;

     |DDEFECTO #81;
     #81#25 = #4#2;
     #81#0 = #4#1;
     |GRABA 000#81b;
     |SI FSalida ! 0; |ACABA; |FINSI;
     #81#1 = #4#3;
     #81#4 = #4#4;
     #81#8 = #112#2;          || nombre comercial
     #81#5 = #4#11;
     #81#17 = #4#13;
     #81#6 = #4#12;
     #81#2 = #4#33;
     #81#9 = #4#37;
     #81#15 = #4#34;

     #81#19 = #41#1;        || nombre de la empresa
     #81#18 = #41#2;        || direccion de la empresa
     #81#20 = #41#3;        || poblacion de la empresa
     #81#21 = #41#4;        || provincia de la empresa
     #81#27 = aDivisa;
     #81#28 = #324#3;
     #81#29 = aMoneda;
     #81#32 = aDivisa;
     #81#33 = #324#3;

     |GRABA 020#81a;
     |LIBERA #81;
|FPRC;

|DEFBUCLE psion004;
     #4#1;
     ;
     "C", "     ", 000001;
     "C", "zzzzz", 999999;
     ;
     NULL, psion004, psion005;
|FIN;

|PROGRAMA;
     |ABRE #321; |LEE 000#321p; |CIERRA #321;
     |ABRE #324;
     #324#0 = #321#9;
     |LEE 000#324=;
     |CIERRA #324;

     aMoneda = "B";
     aDivisa = #324#0;
     |HAZ Divisas081;

     |ABRE #142; |LEE 000#142p; |CIERRA #142;

     |ABRE #81;
     |ABRE #67;
     |BUCLE psion004;
     |SI aSerie ! "";
          |HAZ CalCabAgifa081;
          |HAZ ActProv;
     |FINSI;
     |CIERRA #67;
     |CIERRA #81;
|FPRO;
