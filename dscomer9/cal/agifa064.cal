|FICHEROS;
     agifa064 #0;
     agifa065 #1;
     agifa029 #2;
     dsm00006 #906;

     dsm00006@ #6;
     agifa065@ #65;
|FIN;

|VARIABLES;
     aAlfa = "";
     aConver = "";
     nPreDto = 0;
     nPre = 0;
     nPcm = 0;
     aCodCompo = "";
     aNomCompo = "";
     nUnidades = 0;
     nPrecio   = 0;
     nSwDocu   = 0;

     documento = 0;
     linea = 0;
     almacen = 0;
     b = "  ";
     c = 0;
     stock = 0;
     stock2 = 0;
     k = 0;
     num0 = "";
     num1 = @;
     num2 = "";
     num3 = 0;
     num4 = 0;
     num5 = 0;
     num6 = 0;
     num7 = 0;
     num8 = 0;
     num9 = 0;
     num10 = "";
     num11 = "";
     num14 = 0;
     num18 = "";
     arti = "";
     arti1 = "";
     fecha =@;
     alma = 0;
     alma1 = 0;
     aPar = "";
     aPar1 = "";
     &eaArticulo = "";
     &cierre = 0;
     &descie = @;
     &hascie = @;

     aBase = "";
     aPathDef = "";
     aDatos = "";
     aDef = "";
     aMensaje = "";
|FIN;

|PROCESO Llena064; |TIPO 6;
     eaArticulo = #0Campo;
     |HAZ LlenaArticulo;
     |SI FSalida = 0;
          #0Campo = eaArticulo;
          |PINTA #0Campo;
     |SINO;
          |ERROR; |ACABA;
     |FINSI;
|FPRC;

|PROCESO tipo7; |TIPO 7;
 |SI cierre = 1;
     |C_M #0#0,1,"N";
     |C_M #0#1,1,"N";
     |C_M #0#2,1,"N";
     |C_M #0#3,1,"N";
     #0#2 = descie; |PINTA #0#2;
     #0#3 = hascie; |PINTA #0#3;
     #0#4 = "S";    |PINTA #0#4;
     #0#5 = "SI";   |PINTA #0#5;
     #0#6 = hascie; |PINTA #0#6;
 |FINSI;
|FPRC;

|PROCESO mayus; |TIPO 0;
 #0Campo = #0Campo > " ";
 |PINTA #0Campo;
|FPRC;

|PROCESO BorroCompo;
     |SI #0#4 = "S"; |Y #906#9 ! 0;
          aCodCompo = #906#7;
          aNomCompo = #906#8;
          nUnidades = #906#9;
          nPrecio   = #906#10;

          |DDEFECTO #6;
          #6#0  = arti1;
          #6#1  = almacen;
          #6#2  = #0#6;
          #6#3  = "SA";
          #6#4  = "";
          #6#5  = documento;
          #6#6  = linea;
          #6#7  = aCodCompo;
          |LEE 101#6=;
          |SI FSalida ! 0;
              #6#8  = aNomCompo;
              |GRABA 020#6b;
          |FINSI;

          #6#9 = #6#9 + nUnidades;
          #6#10 = nPrecio;
          |GRABA 020#6a;
          |LIBERA #6;
     |FINSI;

     |BORRA 020#906a;
|FPRC;

|DEFBUCLE dsm00006;
     #906#1;
     ;
     #1#0, #1#5, #1#1, #1#2, #1#11, #1#3, #1#4, "      ";
     #1#0, #1#5, #1#1, #1#2, #1#11, #1#3, #1#4, "zzzzzz";
     be;
     NULL, BorroCompo;
|FIN;

|CALCULO borfich;
     |SI nSwDocu = 0;
          documento = documento + 1;
          nSwDocu   = 1;
     |FINSI;
     linea = almacen;

     arti = #1#0;
     alma = #1#5;
     aPar = #1#18;
     k = k + 1;
     |SI k = 1;
         arti1 = arti;
         alma1 = alma;
         aPar1 = aPar;
     |FINSI;

     num0  = #1#0;   ||Me guardo los valores para seguir borraNDO
     num1  = #1#1;
     num2  = #1#2;
     num3  = #1#3;
     num4  = #1#4;
     num5  = #1#5;
     num6  = #1#6;
     num7  = #1#7;
     num8  = #1#8;
     num9  = #1#9;
     num10 = #1#10;
     num11 = #1#11;
     num14 = #1#14;
     num18 = #1#18;

     |SI arti1 ! arti;|O alma1 ! alma; |O aPar1 ! aPar;
         |SALVA_FICHA #1;
         #1#0      = arti1;
         #1#1      = #0#6;         || Fecha final
         #1#2      = "SA";         || Operacion Saldo inicial
         #1#3      = documento;    || Documento inicial
         #1#4      = linea;        || Numero de linea
         #1#5      = almacen;      || Almacen
         #1#6      = stock;
         #1#7      = stock;
         #1#8      = nPcm;
         #1#9      = nPre;
         #1#10     = "";
         #1#11     = "";
         #1#14     = nPreDto;
         #1#17     = stock2;
         #1#18     = aPar1;
         #1#19     = "";
         #1#20     = aConver;
         #1#21     = "";
         |SI #0#4 = "S";
              |SI stock ! 0; |O stock2 ! 0;
                   |GRABA 021#1n;
              |FINSI;
        |FINSI;
        |REPON_FICHA #1;

         #1#0 = num0;   ||Me guardo los valores para seguir borraNDO
         #1#1 = num1;
         #1#2 = num2;
         #1#3 = num3;
         #1#4 = num4;
         #1#5 = num5;
         #1#6 = num6;
         #1#7 = num7;
         #1#8 = num8;
         #1#9 = num9;
         #1#10 = num10;
         #1#11 = num11;
         #1#14 = num14;
         #1#18 = num18;
         arti1 = arti;
         alma1 = alma;
         aPar1 = aPar;
         stock = 0;
         stock2 = 0;
         documento = documento + 1;
     |FINSI;

     fecha = #0#6;
     arti1 = #1#0;
     alma1 = #1#5;
     aPar1 = #1#18;
     stock = stock + #1#6;
     stock2 = stock2 + #1#17;
     nPcm = #1#8;
     nPre = #1#9;
     nPreDto = #1#14;
     aConver = #1#20;

     |BUCLE dsm00006;

     |BORRA 001#1a;
|FCAL;

|PROCESO finhist;
     #1#0 = arti1;
     #1#1 = fecha;        ||Fecha final
     #1#2 = "SA";         ||Operacion Saldo inicial
     #1#3 = documento;    ||Documento inicial
     #1#4 = linea;        ||Numero de linea
     #1#5 = almacen;      ||Almacen
     #1#6 = stock;
     #1#7 = stock;
     #1#8 = nPcm;
     #1#9 = nPre;
     #1#10 = "";
     #1#11 = "";
     #1#14 = nPreDto;
     #1#17 = stock2;
     #1#18 = aPar1;
     #1#19 = "";
     #1#20 = aConver;
     #1#21 = "";
     |SI #0#4 = "S";
          |SI stock ! 0; |O stock2 ! 0;
               |GRABA 021#1n;
          |FINSI;
     |FINSI;
     k = 0;
     stock = 0;
     stock2 = 0;
|FPRC;

|DEFBUCLE agifa065;
     #1#1
     5;
     #0#0 , #0#2 , b  , c     ,  0     , "     ", almacen;
     #0#1 , #0#3 , Azz, 999999,  99999 , "zzzzz", almacen;
     be;
     NULL, NULL, NULL, NULL, NULL, borfich;
     #1#0, #1#18;
|FIN;

|PROCESO Procesa;
     |ABRE #65;
     |ABRE #2;
     |ABRE #6;
     |ABRET #1;
     |PARA  almacen = 1;|SI almacen [ 99999;|HACIENDO almacen = almacen + 1;
          #2#0 = almacen;
          |LEE 000#2=;
          |SI FSalida = 0;
               |BUCLE agifa065;
               |HAZ finhist;
          |FINSI;
     |SIGUE;
     |CIERRAT #1;
     |CIERRA #6;
     |CIERRA #2;
     |CIERRA #65;
|FPRC;

|CALCULO borra;|TIPO 3;
     |SI #0#5 = "SI";
          |DBASE aBase;
          |QBF aBase;
          aPathDef = aBase + "def/";
          |DFICE aDatos;
          |QBF aDatos;
          aDef = aPathDef + "agifa065";
          |CARGA_DEF aDef, agifa065@;
          |SI FSalida = 0;
               aDef = aPathDef + "dsm00006";
               |CARGA_DEF aDef, dsm00006@;
               |SI FSalida = 0;
                    |HAZ Procesa;
                    |DESCARGA_DEF #dsm00006@;
               |SINO;
                    aMensaje = "0000Problemas CARGA_DEF: " + aDef;
                    |MENAV aMensaje;
               |FINSI;
               |DESCARGA_DEF #agifa065@;
          |SINO;
               aMensaje = "0000Problemas CARGA_DEF: " + aDef;
               |MENAV aMensaje;
          |FINSI;
     |FINSI;
|FCAL;
