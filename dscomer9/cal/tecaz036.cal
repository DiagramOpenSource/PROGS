|FICHEROS;
     tecaz036 #0;
     tecaw025 #25;
     agifa077 #77; ||Alb.Com. C
     agifa080 #80; ||Alb.Com. L
     agifa079 #79; ||Fac.Com. C
     agifa072 #72; ||Fac.Com. L
|FIN;

|VARIABLES;
     &enTiva = 0;
     &efFiva = @;
     &eaDiva = "";
     &enIva = 0;
     &enRec = 0;
     &nDeci_PreDiv = 0;
     &aDivisa = "";
     &aMoneda = "";
     aAlfa = "";
     nTiva = 0;
     nTotFacAnt = 0;
     nMal = 0;
     nOk = 0;
|FIN;

|PROCESO LeeIVA;
     enTiva = nTiva;
     efFiva = #77#1;
     |HAZ SacaIVA;
|FPRC;

|PROCESO agifa079Fin;
     |GRABA 020#79a;
     |LIBERA #79;

     |SI nTotFacAnt = #79#31;
          nOk = nOk + 1;
          |PINTA 2201, nOk;
     |SINO;
          nMal = nMal + 1;
          |PINTA 2301, nMal;
          #25#0 = #79#66;
          #25#1 = #79#0;
          |LEE 101#25=;
          |SI FSalida ! 0; |GRABA 020#25b; |FINSI;
          #25#2 = #79#1;
          #25#3 = #79#2;
          #25#4 = #79#3;
          #25#5 = nTotFacAnt;
          #25#6 = #79#31;
          |GRABA 020#25a;
          |LIBERA #25;
     |FINSI;
|FPRC;

|PROCESO agifa072;
     |DDEFECTO #77;
     #77#50 = #72#17;
     #77#0 = #72#2;
     |LEE 000#77=;

     #72#3 = #77#15;
     #72#4 = #77#25;
     #72#5 = #77#11;
     #72#6 = #77#13;
     #72#7 = #77#16;
     #72#8 = #77#19;
     #72#9 = #77#22;
     #72#10 = #77#24;
     #72#11 = #77#55;
     #72#13 = #77#16 + #77#19 + #77#22 + #77#43 + #77#46;
     #72#14 = #77#43;
     #72#15 = #77#46;
     #72#21 = #77#63;
     #72#22 = #77#25 * #77#57;
     #72#23 = #77#69;
     #72#24 = #72#13 * #77#57;
     #72#25 = #77#24 * #77#57;
     #72#26 = #77#64;
     #72#27 = #77#63;
     #72#28 = #77#25 * #77#57;
     #72#23 = #77#69;
     #72#24 = #72#13 * #77#57;
     #72#31 = #77#24 * #77#57;
     #72#32 = #77#64;
     #72#33 = #77#15;
     #72#34 = #77#25;
     #72#35 = #77#11;
     #72#36 = #77#16 + #77#19 + #77#22 + #77#43 + #77#46;
     #72#37 = #77#24;
     #72#38 = #77#55;
     |GRABA 020#72a;
     |LIBERA #72;

     #79#17 = #79#17 + #77#25;
     #79#18 = #79#18 + #77#15;
     #79#19 = #79#19 + #77#11;
     #79#20 = #79#20 + #77#13;
     #79#21 = #79#21 + #77#16;
     #79#22 = #79#22 + #77#17;
     #79#24 = #79#24 + #77#19;
     #79#25 = #79#25 + #77#20;
     #79#27 = #79#27 + #77#22;
     #79#28 = #79#28 + #77#23;
     #79#29 = #79#29 + #77#24;
     #79#31 = #79#31 + #77#55;
     #79#47 = #79#47 + #77#28;
     #79#49 = #79#49 + #77#43;
     #79#50 = #79#50 + #77#44;
     #79#52 = #79#52 + #77#46;
     #79#53 = #79#53 + #77#47;
     #79#81 = #79#81 + #72#22;
     #79#82 = #79#82 + #77#63;
     #79#83 = #79#83 + #77#69;
     #79#84 = #79#84 + #77#70;
     #79#85 = #79#85 + #77#16 * #77#57;
     #79#86 = #79#86 + #77#17 * #77#57;
     #79#88 = #79#88 + #77#19 * #77#57;
     #79#89 = #79#89 + #77#20 * #77#57;
     #79#91 = #79#91 + #77#22 * #77#57;
     #79#92 = #79#92 + #77#23 * #77#57;
     #79#93 = #79#93 + #77#24 * #77#57;
     #79#95 = #79#95 + #77#64;
     #79#96 = #79#96 + #77#43 * #77#57;
     #79#97 = #79#97 + #77#44 * #77#57;
     #79#99 = #79#99 + #77#46 * #77#57;
     #79#100 = #79#100 + #77#47 * #77#57;
     #79#104 = #79#104 + #72#22;
     #79#105 = #79#105 + #77#63;
     #79#106 = #79#106 + #77#69;
     #79#107 = #79#107 + #77#70;
     #79#108 = #79#108 + #77#16 * #77#57;
     #79#109 = #79#109 + #77#17 * #77#57;
     #79#111 = #79#111 + #77#19 * #77#57;
     #79#112 = #79#112 + #77#20 * #77#57;
     #79#114 = #79#114 + #77#22 * #77#57;
     #79#115 = #79#115 + #77#23 * #77#57;
     #79#116 = #79#116 + #77#24 * #77#57;
     #79#118 = #79#118 + #77#64;
     #79#119 = #79#119 + #77#43 * #77#57;
     #79#120 = #79#120 + #77#44 * #77#57;
     #79#122 = #79#122 + #77#46 * #77#57;
     #79#123 = #79#123 + #77#47 * #77#57;
|FPRC;

|PROCESO agifa079;
     |SI #79#75 ! "USD";
          |ERROR; |ACABA;
     |FINSI;

     aDivisa = #79#75;
     aMoneda = #79#77;
     |HAZ Divisas079;

     nTotFacAnt = #79#31;
     #79#17 = 0;
     #79#18 = 0;
     #79#19 = 0;
     #79#20 = 0;
     #79#21 = 0;
     #79#22 = 0;
     #79#24 = 0;
     #79#25 = 0;
     #79#27 = 0;
     #79#28 = 0;
     #79#29 = 0;
     #79#31 = 0;
     #79#47 = 0;
     #79#49 = 0;
     #79#50 = 0;
     #79#52 = 0;
     #79#53 = 0;
     #79#81 = 0;
     #79#82 = 0;
     #79#83 = 0;
     #79#84 = 0;
     #79#85 = 0;
     #79#86 = 0;
     #79#88 = 0;
     #79#89 = 0;
     #79#91 = 0;
     #79#92 = 0;
     #79#93 = 0;
     #79#95 = 0;
     #79#96 = 0;
     #79#97 = 0;
     #79#99 = 0;
     #79#100 = 0;
     #79#104 = 0;
     #79#105 = 0;
     #79#106 = 0;
     #79#107 = 0;
     #79#108 = 0;
     #79#109 = 0;
     #79#111 = 0;
     #79#112 = 0;
     #79#114 = 0;
     #79#115 = 0;
     #79#116 = 0;
     #79#118 = 0;
     #79#119 = 0;
     #79#120 = 0;
     #79#122 = 0;
     #79#123 = 0;
|FPRC;

|DEFBUCLE agifa079;
     #79#1;
     ;
     INICIO;
     FINAL;
     be;
     NULL, agifa079, agifa072, agifa079Fin;
|FIN;

|PROCESO agifa077Fin;
     #77#25 = #77#15 - (((#77#15 < #77#5) < #77#32) < #77#7);

     #77#16 = (((#77#16 < #77#5) < #77#32) < #77#7);
     #77#19 = (((#77#19 < #77#5) < #77#32) < #77#7);
     #77#22 = (((#77#22 < #77#5) < #77#32) < #77#7);
     #77#28 = (((#77#28 < #77#5) < #77#32) < #77#7);
     #77#43 = (((#77#43 < #77#5) < #77#32) < #77#7);
     #77#46 = (((#77#46 < #77#5) < #77#32) < #77#7);

     |SI #77#12=1; #77#16 = #77#16 + #77#11; |FINSI;
     |SI #77#12=2; #77#19 = #77#19 + #77#11; |FINSI;
     |SI #77#12=3; #77#22 = #77#22 + #77#11; |FINSI;
     |SI #77#12=0; #77#28 = #77#28 + #77#11; |FINSI;
     |SI #77#12=4; #77#43 = #77#43 + #77#11; |FINSI;
     |SI #77#12=5; #77#46 = #77#46 + #77#11; |FINSI;

     |SI #77#14=1; #77#16 = #77#16 + #77#13; |FINSI;
     |SI #77#14=2; #77#19 = #77#19 + #77#13; |FINSI;
     |SI #77#14=3; #77#22 = #77#22 + #77#13; |FINSI;
     |SI #77#14=0; #77#28 = #77#28 + #77#13; |FINSI;
     |SI #77#14=4; #77#43 = #77#43 + #77#13; |FINSI;
     |SI #77#14=5; #77#46 = #77#46 + #77#13; |FINSI;

     nTiva = 1; |HAZ LeeIVA; #77#17 = #77#16 % enIva;
     nTiva = 2; |HAZ LeeIVA; #77#20 = #77#19 % enIva;
     nTiva = 3; |HAZ LeeIVA; #77#23 = #77#22 % enIva;
     nTiva = 4; |HAZ LeeIVA; #77#44 = #77#43 % enIva;
     nTiva = 5; |HAZ LeeIVA; #77#47 = #77#46 % enIva;

     #77#24 = #77#17 + #77#20 + #77#23 + #77#44 + #77#47;

     #77#55 = #77#15 - #77#25 + #77#11 + #77#13 + #77#24;
     #77#68 = #77#55;

     #77#64 = #77#55 * #77#57;
     #77#66 = #77#64;

     |GRABA 020#77a;
     |LIBERA #77;
|FPRC;

|PROCESO agifa080;
     #80#6 = #80#30 / #77#57;
     #80#7 = #80#6 * #80#5;
     #80#9 = ((#80#7 < #80#8) < #80#26) < #80#45;
     #80#31 = (((#80#30 * #80#5) < #80#8) < #80#26) < #80#45;
     #80#32 = #80#6;
     #80#33 = #80#9;
     |GRABA 020#80a;
     |LIBERA #80;

     #77#15 = #77#15 + #80#9;
     |SI #80#11 = 1; #77#16 = #77#16 + #80#9; |FINSI;
     |SI #80#11 = 2; #77#19 = #77#19 + #80#9; |FINSI;
     |SI #80#11 = 3; #77#22 = #77#22 + #80#9; |FINSI;
     |SI #80#11 = 0; #77#28 = #77#28 + #80#9; |FINSI;
     |SI #80#11 = 4; #77#43 = #77#43 + #80#9; |FINSI;
     |SI #80#11 = 5; #77#46 = #77#46 + #80#9; |FINSI;
     #77#63 = #77#63 + #80#31;
     #77#65 = #77#65 + #80#31;
     #77#67 = #77#67 + #80#9;
|FPRC;

|PROCESO agifa077;
     |SI #77#56 ! "USD";
          |ERROR; |ACABA;
     |FINSI;

     aDivisa = #77#56;
     aMoneda = #77#58;
     |HAZ Divisas077;

     ||29.06.06. Descomentado, segun llamada de Jordi Diaz
     ||nDeci_PreDiv = 4;   ||Forzado a 4 segun Jordi

     #77#15 = 0;
     #77#16 = 0;
     #77#17 = 0;
     #77#19 = 0;
     #77#20 = 0;
     #77#22 = 0;
     #77#23 = 0;
     #77#24 = 0;
     #77#24 = 0;
     #77#28 = 0;
     #77#43 = 0;
     #77#44 = 0;
     #77#46 = 0;
     #77#47 = 0;
     #77#55 = 0;
     #77#63 = 0;
     #77#64 = 0;
     #77#65 = 0;
     #77#66 = 0;
     #77#67 = 0;
     #77#68 = 0;
|FPRC;

|DEFBUCLE agifa077;
     #77#1;
     ;
     INICIO;
     FINAL;
     be;
     NULL, agifa077, agifa080, agifa077Fin;
|FIN;

|PROCESO Tipo3; |TIPO 3;
     |DELINDEX #25;

     |BUCLE agifa077;

     |ABRE #77;
     |ABRE #25;
     |BUCLE agifa079;
     |CIERRA #25;
     |CIERRA #77;

     |SI nMal = 0;
          aAlfa = "0000No se ha encontrado errores en " + nOk + " facturas";
     |SINO;
          aAlfa = "0000Facturas erroneas:" + nMal + ", correctas:" + nOk;
          |MENAV aAlfa;
     |FINSI;
|FPRC;
