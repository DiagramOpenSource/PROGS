|FICHEROS;
     diaz0010,MANTE;
     diam0009;
     diam0015;
     diam0020,MANTE;
     diam0021,MANTE;
     agifa038;

     referen@;
|FIN;

|VARIABLES;
     &Tempo = "";
     aCampos = "";
     aTmp17 = "";
     aEstado = "";
     nTipo = 0;
     nNume = 0;
     nSw = 0;
     nLinFin = 0;
     i = 0;
     aID = "";
     nID = 0;
     fFecha      = ~;
     nCampo1     = 0;
     nCampo2     = 0;
     nError      = 0;
     nRango      = 0;
     nCalcu1     = 0;
     nCalcu2     = 0;
     nResta      = 0;
     nLinea      = 0;
     nSwHay      = 0;
     nSubBoton1  = 0;
     nSubBoton2  = 0;
     nSubBoton3  = 0;
     nSubBoton4  = 0;
     nSubBoton5  = 0;
     nSubBoton6  = 0;
     nSubBoton7  = 0;
     nSubBoton8  = 0;
     nSubBoton9  = 0;
     nSubBoton11 = 0;
     nSubBoton12 = 0;
     nSubBoton13 = 0;
     nSubVentana = 0;
     nHandle     = 0;
     nPosIni     = 0;
     nPosFin     = 0;

     aTecla      = "";
     aAlfa       = "";
     aAlfa1      = "";
     aAlfa2      = "";
     aAlfa3      = "";
     aFam        = "";
     aEsc1       = "";
     aEsc2       = "";
     aRetu       = "";
     aOrigen        = "";
     aDestino       = "";
     aRuta          = "";
     aExtension     = "";
     aBase          = "";
     aDirDocumentos = "";
     aPunto         = "";
     aAbre          = "";
     aDocumentos    = "";

     &enPanta    = 0;
     &enSalida   = 0;
|FIN;

|PROCESO Tipo80z09;  |TIPO 80;
     ||FSalida = 4399;
|FPRC;

|PROCESO ClaveBaja18;
     #diam0021#0 = #diaz0010#0;
     #diam0021#1 = #diaz0010#1;
     #diam0021#2 = #diaz0010#13;
     #diam0021#3 = 10;
|FPRC;

|PROCESO ClaveAlta18;
     #diam0021#0 = #diaz0010#0;
     #diam0021#1 = #diaz0010#1;
     #diam0021#2 = #diaz0010#13;
     #diam0021#3 = 999;
|FPRC;

|PROCESO diam0021;
     #diaz0010#105 = #diaz0010#105 + #diam0021#7;
|FPRC;

|DEFBUCLE diam0021;
     #diam0021#1;
     ;
     #diaz0010#0, #diaz0010#1, #diaz0010#13, 001;
     #diaz0010#0, #diaz0010#1, #diaz0010#13, 999;
     ;
     NULL, diam0021;
|FIN;

|PROCESO CalculaPresupuesto;
     #diaz0010#105 = 0;
     |BUCLE diam0021;

     |PINTA #diaz0010#105;
|FPRC;

|PROCESO SacaPresupuesto;  |TIPO 0;
     |SI FSalida ! 10;
         |HAZ CalculaPresupuesto;
         |ACABA;
     |FINSI;

     |VENTANA 0501, 2599, -1, -1, "";
     nSubVentana = FSalida;

     |ABRET #diam0021;

     |SI #diaz0010#117 = "M";  nRango = 1 + 4 + 8 + 16;  |FINSI;
     |SI #diaz0010#117 = "A";  nRango = 4 + 8 + 16;      |FINSI;

     nPosIni     = 0701;
     nPosFin     = 2399;

     |CONTROL_SIMPLE 0, "BOTON,{{137}} Descri. Ampliada", 0601, 0620, SubBoton7;
     nSubBoton7 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{137}} Copia Productos", 0622, 0640, SubBoton8;
     nSubBoton8 = FSalida;

     |SI #diaz0010#117 = "A";
          |ESTADO_CONTROL nSubBoton7, "DISABLE";
          |ESTADO_CONTROL nSubBoton8, "DISABLE";
     |FINSI;

     |LINEAL_SIMPLE #1#diam0021, nRango, nPosIni, nPosFin, ClaveBaja18, ClaveAlta18, Evento18;

     |CIERRAT #diam0021;


     |FIN_CONTROL_WINDOWS nSubBoton7;
     |FIN_CONTROL_WINDOWS nSubBoton8;
     |FINVENTANA nSubVentana;

     |HAZ CalculaPresupuesto;

     |HAZ Ajusta;

     |ERROR;
|FPRC;

|PROCESO SacaPresu;
     |VENTANA 0501, 2599, -1, -1, "";
     nSubVentana = FSalida;

     nRango = 4 + 8 + 16;

     nPosIni     = 0701;
     nPosFin     = 2399;

     |ABRET #diam0021;
     |LINEAL_SIMPLE #1#diam0021, nRango, nPosIni, nPosFin, ClaveBaja18, ClaveAlta18, Evento18;
     |CIERRAT #diam0021;

     |FINVENTANA nSubVentana;

     |ERROR;
|FPRC;

|PROCESO ClaveBaja17;
     #diam0020#0 = #diaz0010#0;
     #diam0020#1 = #diaz0010#1;
     #diam0020#2 = #diaz0010#13;
     ||#diam0020#3 = #diaz0010#nCampo1#;
     #diam0020#4 = 1;
|FPRC;

|PROCESO ClaveAlta17;
     #diam0020#0 = #diaz0010#0;
     #diam0020#1 = #diaz0010#1;
     #diam0020#2 = #diaz0010#13;
     ||#diam0020#3 = "zzz";
     #diam0020#4 = 999;
|FPRC;

|PROCESO diam0020;
     |SI #diam0020#3 = #diaz0010#32;
          #diaz0010#34 = #diaz0010#34 + #diam0020#7;
          #diaz0010#35 = #diam0020#8;
          #diaz0010#36 = #diaz0010#34 * #diaz0010#35;
     |FINSI;
     |SI #diam0020#3 = #diaz0010#37;
          #diaz0010#39 = #diaz0010#39 + #diam0020#7;
          #diaz0010#40 = #diam0020#8;
          #diaz0010#41 = #diaz0010#39 * #diaz0010#40;
     |FINSI;
     |SI #diam0020#3 = #diaz0010#42;
          #diaz0010#44 = #diaz0010#44 + #diam0020#7;
          #diaz0010#45 = #diam0020#8;
          #diaz0010#46 = #diaz0010#44 * #diaz0010#45;
     |FINSI;
     |SI #diam0020#3 = #diaz0010#47;
          #diaz0010#49 = #diaz0010#49 + #diam0020#7;
          #diaz0010#50 = #diam0020#8;
          #diaz0010#51 = #diaz0010#49 * #diaz0010#50;
     |FINSI;
     |SI #diam0020#3 = #diaz0010#52;
          #diaz0010#54 = #diaz0010#54 + #diam0020#7;
          #diaz0010#55 = #diam0020#8;
          #diaz0010#56 = #diaz0010#54 * #diaz0010#55;
     |FINSI;
     |SI #diam0020#3 = #diaz0010#57;
          #diaz0010#59 = #diaz0010#59 + #diam0020#7;
          #diaz0010#60 = #diam0020#8;
          #diaz0010#61 = #diaz0010#59 * #diaz0010#60;
     |FINSI;
     |SI #diam0020#3 = #diaz0010#67;
          #diaz0010#69 = #diaz0010#69 + #diam0020#7;
          #diaz0010#70 = #diam0020#8;
          #diaz0010#71 = #diaz0010#69 * #diaz0010#70;
          #diaz0010#72 = #diaz0010#72 + #diam0020#11;
          #diaz0010#73 = #diaz0010#72;
          #diaz0010#106 = #diaz0010#106 + #diam0020#7; || km
     |FINSI;
     |SI #diam0020#3 = #diaz0010#74;
          #diaz0010#76 = #diaz0010#76 + #diam0020#9;
          #diaz0010#78 = #diaz0010#78 + #diam0020#11;
     |FINSI;
     |SI #diam0020#3 = #diaz0010#82;
          #diaz0010#84 = #diaz0010#84 + #diam0020#9;
     |FINSI;
     |SI #diam0020#3 = #diaz0010#86;
          #diaz0010#88 = #diaz0010#88 + #diam0020#9;
          #diaz0010#90 = #diaz0010#90 + #diam0020#11;
     |FINSI;
     |SI #diam0020#3 = #diaz0010#94;
          #diaz0010#96 = #diaz0010#96 + #diam0020#9;
          #diaz0010#97 = #diaz0010#96;
     |FINSI;
     |SI #diam0020#3 = #diaz0010#98;
          #diaz0010#100 = #diaz0010#100 + #diam0020#9;
          #diaz0010#101 = #diaz0010#100;
     |FINSI;
     |SI #diam0020#3 = #diam0015#51; |O #diam0020#3 = #diam0015#54; |O #diam0020#3 = #diam0015#57;
               |O #diam0020#3 = #diam0015#60; |O #diam0020#3 = #diam0015#63; |O #diam0020#3 = #diam0015#66;

          #diaz0010#114 = #diaz0010#114 + #diam0020#7; || horas
          #diaz0010#65 = #diam0020#8;
          #diaz0010#64 = #diaz0010#64 + #diam0020#7;
          #diaz0010#66 = #diaz0010#65 * #diaz0010#64;

     |FINSI;
|FPRC;

|DEFBUCLE diam0020;
     #diam0020#1;
     ;
     #diaz0010#0, #diaz0010#1, #diaz0010#13, 001;
     #diaz0010#0, #diaz0010#1, #diaz0010#13, 999;
     ;
     NULL, diam0020;
|FIN;

|PROCESO CalculaDetalle;
     |ABRE #diam0015;
     aAlfa = #diaz0010#1 % -104;
     #diam0015#71 = aAlfa;
     |LEE 000#diam0015.=;
     |CIERRA #diam0015;

     #diaz0010#34 = 0; #diaz0010#39 = 0; #diaz0010#44 = 0; #diaz0010#49 = 0; #diaz0010#54 = 0; #diaz0010#59 = 0;
     #diaz0010#69 = 0; #diaz0010#64 = 0;

     #diaz0010#35 = 0; #diaz0010#40 = 0; #diaz0010#45 = 0; #diaz0010#50 = 0; #diaz0010#55 = 0; #diaz0010#60 = 0;
     #diaz0010#70 = 0; #diaz0010#76 = 0; #diaz0010#84 = 0; #diaz0010#88 = 0; #diaz0010#96 = 0; #diaz0010#100 = 0;

     #diaz0010#36 = 0; #diaz0010#41 = 0; #diaz0010#46 = 0; #diaz0010#51 = 0; #diaz0010#56 = 0; #diaz0010#61 = 0;
     #diaz0010#66 = 0; #diaz0010#71 = 0; #diaz0010#77 = 0; #diaz0010#80 = 0; #diaz0010#85 = 0; #diaz0010#89 = 0;
     #diaz0010#92 = 0; #diaz0010#97 = 0; #diaz0010#101 = 0; #diaz0010#102 = 0;

     #diaz0010#72 = 0; #diaz0010#78 = 0; #diaz0010#90 = 0;
     #diaz0010#73 = 0; #diaz0010#79 = 0; #diaz0010#81 = 0; #diaz0010#91 = 0; #diaz0010#93 = 0;

     #diaz0010#114 = 0; #diaz0010#106 = 0;

     |BUCLE diam0020;


     #diaz0010#77 = #diaz0010#76;
     #diaz0010#79 = #diaz0010#78;
     #diaz0010#85 = #diaz0010#84;
     #diaz0010#89 = #diaz0010#88;
     #diaz0010#91 = #diaz0010#90;

     #diaz0010#80 = #diaz0010#36 + #diaz0010#41 + #diaz0010#46 + #diaz0010#51 + #diaz0010#56 + #diaz0010#61 + #diaz0010#66 + #diaz0010#71 + #diaz0010#77;
     #diaz0010#92 = #diaz0010#85 + #diaz0010#89;
     #diaz0010#102 = #diaz0010#97 + #diaz0010#101;
     #diaz0010#81 = #diaz0010#73 + #diaz0010#79;
     #diaz0010#93 = #diaz0010#91;
     #diaz0010#16 = #diaz0010#81 + #diaz0010#93;
     #diaz0010#17 = #diaz0010#80 + #diaz0010#92 + #diaz0010#102
     #diaz0010#20 = #diaz0010#91;
     #diaz0010#21 = #diaz0010#89;
     #diaz0010#113 = #diaz0010#107 + #diaz0010#108 + #diaz0010#109 + #diaz0010#110 + #diaz0010#111 + #diaz0010#112;

     #diaz0010#19 = 0;
     |SI #diaz0010#16 ! 0; |O #diaz0010#17 ! 0;
          #diaz0010#19 = ((#diaz0010#17 - #diaz0010#16) / #diaz0010#17) * 100;
     |FINSI;

     #diaz0010#22 = 0;
     |SI #diaz0010#20 ! 0; |O #diaz0010#21 ! 0;
          #diaz0010#22 = ((#diaz0010#21 - #diaz0010#20) / #diaz0010#21) * 100;
     |FINSI;
     |PINDA #0#diaz0010;
|FPRC;

|PROCESO Evento17;
     |SI FSalida = 1;
         |LEE 040#diam0020.=;
         |SI FSalida ! 0;
             |ESTADO_CONTROL nSubBoton4, "DISABLE";
             |ESTADO_CONTROL nSubBoton5, "DISABLE";
             |ESTADO_CONTROL nSubBoton6, "DISABLE";
             |ACABA;
         |FINSI;

         aAlfa = #diam0020#14;  |QBF aAlfa;
         |SI aAlfa = "";
             |ESTADO_CONTROL nSubBoton4, "ENABLE";
             |ESTADO_CONTROL nSubBoton5, "DISABLE";
             |ESTADO_CONTROL nSubBoton6, "DISABLE";
         |SINO;
             |ESTADO_CONTROL nSubBoton5, "ENABLE";
             |ESTADO_CONTROL nSubBoton6, "ENABLE";
             |ESTADO_CONTROL nSubBoton4, "DISABLE";
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO SubBoton4;
     |LEE 101#diam0020.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     aRuta = "F";
     |BROWSE aRuta;  |QBF aRuta;
     |SI aRuta = "F";  |ACABA;  |FINSI;

     aRuta = aRuta % 0299;
     aExtension = (aRuta % -103) > "";
     aPunto     = aRuta % -401;
     |SI aPunto ! ".";
         |MENAV "0000 Documento sin Extension. Formato exigido extension de 3 caracteres.";
         |ERROR;
         |ACABA;
     |FINSI;

     |DBASE aBase;  |QBF aBase;
     aDirDocumentos = aBase + "000577/documentos";
     |MKDIR aDirDocumentos;

     aOrigen  = aRuta;
     aAlfa1   = (#diam0020#1 % -104) + (#diam0020#1 % 402) + (#diam0020#1 % 102);
     aAlfa2   = (#diam0020#2 %  102) + (#diam0020#2 % 402) + (#diam0020#2 % 702);
     aAlfa3   = ("000" + #diam0020#4) %  -103;
     aDestino = aDirDocumentos + "/" + #diam0020#0 + aAlfa1 + aAlfa2 + aAlfa3 + "." + aExtension;
     |RECIBE_FICHERO aOrigen, aDestino;

     #diam0020#14   = #diam0020#0 + aAlfa1 + aAlfa2 + aAlfa3 + "." + aExtension;
     #diam0020#15   = Usuario % 0810;

     |GRABA 020#diam0020.a;
     |LIBERA #diam0020;

     |ESTADO_CONTROL nSubBoton5, "ENABLE";
     |ESTADO_CONTROL nSubBoton6, "ENABLE";
     |ESTADO_CONTROL nSubBoton4, "DISABLE";
|FPRC;

|PROCESO SubBoton5;
     |LEE 040#diam0020.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |DBASE aBase;  |QBF aBase;
     aDirDocumentos = aBase + "000577/documentos";
     |MKDIR aDirDocumentos;

     aOrigen  = "C:\DOCUMENTOS";
     |RMKDIR aOrigen;

     aAbre = aOrigen + "\wait.exe";
     |XABRE "EC", aAbre, nHandle;
     |SI FSalida < 0;
         aDestino = aBase + "000577/wait.exe";
         aOrigen  = "C:\DOCUMENTOS\wait.exe";
         |ENVIA_FICHERO aDestino, aOrigen;
         |SI FSalida ! 0;
             |MENAV "      No existe el wait en el directorio de Documentos.";
             |ACABA;
         |FINSI;
     |FINSI;

     aDestino = aDirDocumentos + "/" + #diam0020#14;  |QBF aDestino;
     aOrigen  = "C:\DOCUMENTOS\" + #diam0020#14;      |QBF aOrigen;
     |ENVIA_FICHERO aDestino, aOrigen;
     |SI FSalida = 0;
         |RSYSTEM aOrigen;

         |RECIBE_FICHERO aOrigen, aDestino;

         #diam0020#15 = Usuario % 0810;
     |FINSI;

     |RFBORRA aOrigen;
|FPRC;

|PROCESO SubBoton6;
     |CONFI "0000N Seguro de Borrar el Documento ";
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |LEE 101#diam0020.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |DBASE aDocumentos;  |QBF aDocumentos;
     aDocumentos = aDocumentos + "000577/documentos";
     aDocumentos = aDocumentos + "/" + #diam0020#14;  |QBF aDocumentos;
     |FBORRA aDocumentos;

     #diam0020#14 = "";
     #diam0020#15 = "";

     |GRABA 020#diam0020.a;
     |LIBERA #diam0020;

     |ESTADO_CONTROL nSubBoton4, "ENABLE";
     |ESTADO_CONTROL nSubBoton5, "DISABLE";
     |ESTADO_CONTROL nSubBoton6, "DISABLE";
|FPRC;

|PROCESO CargaFamDeta;
     |PARA i = 0; |SI i < aCampos; |HACIENDO i = i + 1;
          #diam0020#i# = #referen@#i#;
     |SIGUE;
     |SI nTipo = 1;
          |SI #diam0020#3 ! #diam0015#34; |ACABA; |FINSI;
     |FINSI;
     |SI nTipo = 2;
          |SI #diam0020#3 ! #diam0015#40; |ACABA; |FINSI;
     |FINSI;
     |SI nTipo = 3;
          |SI #diam0020#3 ! #diam0015#37; |ACABA; |FINSI;
     |FINSI;
     |SI nTipo = 9;
          |SI #diam0020#3 ! #diam0015#43; |ACABA; |FINSI;
     |FINSI;
     |SI nTipo = 11;
          |SI #diam0020#3 = #diam0015#34; |O #diam0020#3 = #diam0015#40; |O #diam0020#3 = #diam0015#37;
                    |O #diam0020#3 = #diam0015#43;
               |ACABA;
          |FINSI;
     |FINSI;
     |GRABA 020#diam0020.n;
|FPRC;

|DEFBUCLE CargaFamDeta;
     #referen@#1004;
     ;
     #diaz0010#0, #diaz0010#1, #diaz0010#13, 001;
     #diaz0010#0, #diaz0010#1, #diaz0010#13, 999;
     ;
     NULL, CargaFamDeta;
|FIN;

|PROCESO SacaDetalles;
     |C_V #diam0020#10, 1, "S";  |C_M #diam0020#10, 1, "S";
     |C_V #diam0020#11, 1, "S";

     |C_M #diam0020#5,  1, "S";
     |C_M #diam0020#6,  1, "S";
     |C_M #diam0020#7,  1, "S";
     |C_M #diam0020#8,  1, "S";

     nRango = 1 + 4 + 8 + 16;

     |VENTANA 0501, 2599, -1, -1, "";
     nSubVentana = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{137}} Adjuntar Documento", 0601, 0620, SubBoton4;
     nSubBoton4 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{135}} Ver Documento", 0622, 0640, SubBoton5;
     nSubBoton5 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{199}} Borrar Documento", 0642, 0660, SubBoton6;
     nSubBoton6 = FSalida;

     |ESTADO_CONTROL nSubBoton4, "DISABLE";
     |ESTADO_CONTROL nSubBoton5, "DISABLE";
     |ESTADO_CONTROL nSubBoton6, "DISABLE";

     |ABRET #diam0020;
     |LINEAL_SIMPLE #1#diam0020, nRango, 0701, 2399, ClaveBaja17, ClaveAlta17, Evento17;
     |CIERRAT #diam0020;

     |FIN_CONTROL_WINDOWS nSubBoton4;
     |FIN_CONTROL_WINDOWS nSubBoton5;
     |FIN_CONTROL_WINDOWS nSubBoton6;

     |FINVENTANA nSubVentana;

     |HAZ CalculaDetalle;

     |HAZ Ajusta;

     |ERROR;
|FPRC;

|PROCESO SacaDetallesPed;
     |DDEF aAlfa;
     aAlfa = aAlfa + "diam0020";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida ! 0;
          |MENAV "0000Error al cargar 'diam0020'";
          |ACABA;
     |FINSI;

     aAlfa = #diaz0010#1 % -104;
     |ABRE #diam0015;
     #diam0015#71 = aAlfa;
     |LEE 000#diam0015.=;
     |CIERRA #diam0015;

     nRango = 4 + 8 + 16;

     |VENTANA 0501, 2599, -1, -1, "";
     nSubVentana = FSalida;

     |HAZ CreaTempo;
     |NOME_DAT #diam0020#Tempo#;
     |DELINDEX #diam0020;
     aTmp17 = Tempo;
     aAlfa = "|NC"; aCampos = #diam0020#aAlfa#;

     |ABRET #diam0020;
     |BUCLE CargaFamDeta;

     |LINEAL_SIMPLE #1#diam0020, nRango, 0701, 2399, ClaveBaja17, ClaveAlta17, Evento17;
     |CIERRAT #diam0020;

     Tempo = aTmp17; |HAZ BoraTempo; |DELINDEX #diam0020;
     aAlfa = "diam0020";
     |NOME_DAT #diam0020#aAlfa#;

     |FINVENTANA nSubVentana;

     |DESCARGA_DEF #referen@;

     |ERROR;
|FPRC;

|PROCESO Tecnico1;
     |C_M #diaz0010#30, 1, "S";
     |SI #diaz0010#18 = "  ";
         |C_M #diaz0010#30, 1, "N";
         #diaz0010#30 = 0;
         |PINTA #diaz0010#30;
     |FINSI;
|FPRC;

|PROCESO Tecnico2;
     |C_M #diaz0010#31, 1, "S";
     |SI #diaz0010#29 = "  ";
         |C_M #diaz0010#31, 1, "N";
         #diaz0010#31 = 0;
         |PINTA #diaz0010#31;
     |FINSI;
|FPRC;

|PROCESO AltaPorce;
     |PUSHV 0501 2380;

     aAlfa = #diaz0010#1 % -104;

     #diam0009#0 = #diaz0010#nCampo1#;
     #diam0009#5 = aAlfa;
     |LEE 101#diam0009.=;
     |SI FSalida ! 0;
         |DDEFECTO #diam0009;
         #diam0009#0 = #diaz0010#nCampo1#;
         #diam0009#5 = aAlfa;
         |GRABA 020#diam0009.b;
     |FINSI;

     |PINPA #0#diam0009;
     |PINDA #0#diam0009;
     |PINTA 0802, #diam0009#5;
     |ENDATOS #1#diam0009;
     |SI FSalida = 0;
         |GRABA 020#diam0009.a;
     |FINSI;

     |POPV;
|FPRC;

|PROCESO TipoPorce;
     |SI Campo = 30;  nCampo1 = 18;  nCampo2 = 30;  |FINSI;
     |SI Campo = 31;  nCampo1 = 29;  nCampo2 = 31;  |FINSI;

     |SI FSalida = 10;
         |PUSHV 0501 2380;
         aAlfa = #diaz0010#1 % -104;

         |ABRE #diam0009;
         #diam0009#0 = #diaz0010#nCampo1#;
         #diam0009#5 = aAlfa;
         |LEE 040#diam0009.=;
         |SI FSalida ! 0;  |DDEFECTO #diam0009;  |FINSI;

         |PINPA #0#diam0009;
         |PINDA #0#diam0009;
         |PINTA 0802, #diam0009#5;
         |LEETECLA aTecla;

         |CIERRA #diam0009;
         |POPV;

         |ERROR;
         |ACABA;
     |FINSI;

     |SI #diaz0010#nCampo2# ] 4;
         |ERROR;
         |ACABA;
     |FINSI;

     |SI #diaz0010#nCampo2# = 0;  |Y #diaz0010#nCampo1# ! "  ";
         |ERROR;
         |ACABA;
     |FINSI;

     |SI #diaz0010#nCampo2# = 0;  |Y #diaz0010#nCampo1# = "  ";
         |ACABA;
     |FINSI;

     aAlfa = #diaz0010#1 % -104;

     |ABRE #diam0009;
     #diam0009#0 = #diaz0010#nCampo1#;
     #diam0009#5 = aAlfa;
     |LEE 101#diam0009.=;
     |SI FSalida ! 0;
         |HAZ AltaPorce;
     |FINSI;

     |SI #diaz0010#nCampo2# = 1;  |Y #diam0009#1 = 0;
         |MENAV "     No hay asignado porcentaje en el tipo introducido en el a¤o de la fecha.";
         ||HAZ AltaPorce;
         |ERROR;
     |FINSI;

     |SI #diaz0010#nCampo2# = 2;  |Y #diam0009#2 = 0;
         |MENAV "     No hay asignado porcentaje en el tipo introducido en el a¤o de la fecha.";
         ||HAZ AltaPorce;
         |ERROR;
     |FINSI;

     |SI #diaz0010#nCampo2# = 3;  |Y #diam0009#2 = 0;
         |MENAV "     No hay asignado porcentaje en el tipo introducido en el a¤o de la fecha.";
         ||HAZ AltaPorce;
         |ERROR;
     |FINSI;

     |LIBERA #diam0009;
     |CIERRA #diam0009;
|FPRC;

|PROCESO PonKilometros;  |TIPO 7;
|FPRC;

|PROCESO Fentrega; |TIPO 0;
     #diaz0010#28 = #diaz0010#1 + 15;
     |PINTA #diaz0010#28;
|FPRC;


|PROCESO Totales;
|FPRC;

|PROCESO diam0020P;
     |SI nSw = 1; |Y #diam0020#6 = #diam0015#70;
          |ACABA;
     |FINSI;

     nLinea = nLinea + 10;

     |DDEFECTO #diam0021;
     #diam0021#0  = #diaz0010#0;
     #diam0021#1  = #diaz0010#1;
     #diam0021#2  = #diaz0010#13;
     #diam0021#3  = nLinea;
     #diam0021#4  = #diam0020#6 > "";
     #diam0021#5  = #diam0020#7;
     #diam0021#6  = #diam0020#8;
     #diam0021#7  = #diam0020#9;

     |GRABA 020#diam0021.n;
     |LIBERA #diam0021;

     #diaz0010#105 = #diaz0010#105 + #diam0021#7;
|FPRC;

|DEFBUCLE diam0020P;
     #diam0020#1;
     ;
     #diaz0010#0, #diaz0010#1, #diaz0010#13, 001;
     #diaz0010#0, #diaz0010#1, #diaz0010#13, 999;
     be;
     NULL, diam0020P;
|FIN;

|PROCESO Tipo12z09;  |TIPO 12;
     |SI FSalida = 7;
         enSalida = 1;
         |ACABA;
     |FINSI;

     |SI #diaz0010#64 = 0;
         |MENAV "      Presupuesto SIN Desplazamientos.";
     |FINSI;

     |SI #diaz0010#69 = 0;
         |MENAV "      Presupuesto SIN Kilometros.";
     |FINSI;

     |HAZ Ajusta;
|FPRC;


|PROCESO ModoConsulta;
     |CONTROL_SIMPLE enPanta, "BOTON,{{137}} Software", 3703, 3725, SubBoton1;
     nSubBoton1 = FSalida;

     |CONTROL_SIMPLE enPanta, "BOTON,{{137}} Mantenimiento Software", 3803, 3825, SubBoton2;
     nSubBoton2 = FSalida;

     |CONTROL_SIMPLE enPanta, "BOTON,{{137}} Hardware", 3903, 3925, SubBoton3;
     nSubBoton3 = FSalida;

     |CONTROL_SIMPLE enPanta, "BOTON,{{137}} Mantenimeinto Hardware", 4003, 4025, SubBoton9;
     nSubBoton9 = FSalida;

     |CONTROL_SIMPLE enPanta, "BOTON,{{137}} Otros", 4103, 4125, SubBoton11;
     nSubBoton11 = FSalida;

     |CONTROL_SIMPLE enPanta, "BOTON,{{137}} Presupuesto", 1703, 1725, SubBoton12;
     nSubBoton12 = FSalida;

     |CONTROL_SIMPLE enPanta, "BOTON,{{206}} Datos Representantes", 1727, 1749, SubBoton13;
     nSubBoton13 = FSalida;

     |ESTADO_CONTROL nSubBoton13, "DISABLE";

     aEsc1  = &255 + "806";
     aEsc2  = &255 + "807";
     aRetu  = &255 + "802";
     |PARA; |SI;  |HACIENDO;
         FSalida = "::Pantalla Anterior";
         |LEETECLA aTecla;
         |SI aTecla = aEsc1; |SAL;  |FINSI;
         |SI aTecla = aEsc2; |SAL;  |FINSI;
         |SI aTecla = aRetu; |SAL;  |FINSI;
     |SIGUE;
     aTecla = "";

     |FIN_CONTROL_WINDOWS nSubBoton1;
     |FIN_CONTROL_WINDOWS nSubBoton2;
     |FIN_CONTROL_WINDOWS nSubBoton3;
     |FIN_CONTROL_WINDOWS nSubBoton9;
     |FIN_CONTROL_WINDOWS nSubBoton11;
     |FIN_CONTROL_WINDOWS nSubBoton12;
     |FIN_CONTROL_WINDOWS nSubBoton13;

     |PULSATECLA;
|FPRC;
---------------------------------------
|PROCESO CopiaProdu;
     |DDEFECTO #diam0021;
     nLinea = nLinea + 10;

     |DDEFECTO #diam0021;
     #diam0021#0  = #diaz0010#0;
     #diam0021#1  = #diaz0010#1;
     #diam0021#2  = #diaz0010#13;
     #diam0021#3  = nLinea;
     #diam0021#4  = #diam0020#6 > "";
     #diam0021#5  = #diam0020#7;
     #diam0021#6  = #diam0020#8;
     #diam0021#7  = #diam0020#9;
     |GRABA 020#diam0021.n;

     #diaz0010#105 = #diaz0010#105 + #diam0021#7;
|FPRC;

|DEFBUCLE CopiaProdu;
     #diam0020#1;
     ;
     #diaz0010#0, #diaz0010#1, #diaz0010#13, 001;
     #diaz0010#0, #diaz0010#1, #diaz0010#13, 999;
     ;
     NULL, CopiaProdu;
|FIN;

|PROCESO BorraPresu;
     |BORRA 020#diam0021.a;
     |LIBERA #diam0021;
|FPRC;

|DEFBUCLE BorraPresu;
     #diam0021#1;
     ;
     #diaz0010#0, #diaz0010#1, #diaz0010#13, 001;
     #diaz0010#0, #diaz0010#1, #diaz0010#13, 999;
     be;
     NULL, BorraPresu;
|FIN;

|PROCESO ManoAuto; |TIPO 0;
     |SI #diaz0010#117 ! Contenido;
          |SI #diaz0010#117 = "M";
               |BUCLE BorraPresu;
          |FINSI;
          |HAZ Ajusta;
     |FINSI;
|FPRC;

|PROCESO Ajusta;
     |ABRE #diam0020;
     #diam0020#0 = #diaz0010#0;
     #diam0020#1 = #diaz0010#1;
     #diam0020#2 = #diaz0010#13;
     #diam0020#3 = #diaz0010#82;
     #diam0020#4 = 999;
     |LEE 101#diam0020.=;
     |SI FSalida = 0; |BORRA 020#diam0020.a; |FINSI;
     |CIERRA #diam0020;

     |SI #diaz0010#117 = "A";
          #diaz0010#105 = 0;
          nLinea = 0;
          |BUCLE BorraPresu;
          |ABRE #diam0021;
          |BUCLE CopiaProdu;
          |CIERRA #diam0021;
     |FINSI;
     |SI #diaz0010#117 = "M";
          |HAZ CalculaPresupuesto;
          |HAZ CalculaDetalle;
          |SI #diaz0010#17 ! #diaz0010#105;
               |DDEFECTO #diam0020;
               |ABRE #diam0020;
               #diam0020#0 = #diaz0010#0;
               #diam0020#1 = #diaz0010#1;
               #diam0020#2 = #diaz0010#13;
               #diam0020#3 = #diaz0010#82;
               #diam0020#4 = 999;
               |LEE 101#diam0020.=;
               |SI FSalida = 0; |BORRA 020#diam0020.a; |FINSI;
               #diam0020#5 = #diam0015#69;
               #diam0020#6 = #diam0015#70;
               #diam0020#7 = 1;
               #diam0020#8 = #diaz0010#105 - #diaz0010#17;
               #diam0020#9 = #diam0020#8;
               |GRABA 020#diam0020.n;
               |CIERRA #diam0020;
          |FINSI;
     |FINSI;
     |HAZ CalculaDetalle;
     |PINDA #0#diaz0010;
|FPRC;

|PROCESO UltLinea;
     #diam0021#0 = #diaz0010#0;
     #diam0021#1 = #diaz0010#1;
     #diam0021#2 = #diaz0010#13;
     #diam0021#3 = 999;
     |LEE 000#diam0021.];
     |SI FSalida = 0;
          |LEE 000#diam0021.a;
     |SINO;
          |LEE 000#diam0021.u;
     |FINSI;
     |SI FSalida = 0; |Y #diam0021#0 = #diaz0010#0; |Y #diam0021#1 = #diaz0010#1; |Y #diam0021#2 = #diaz0010#13;
          nLinea = #diam0021#3;
     |SINO;
          nLinea = 0;
     |FINSI;
|FPRC;


|PROCESO SubBoton7;  || Descripcion ampliada
     |ESTADO_CONTROL nSubBoton7, "DISABLE";
     |ESTADO_CONTROL nSubBoton8, "DISABLE";

     |ABRE #agifa038;
     |LEE 000#agifa038.p;
     |CONSULTA_CLAVE #1#agifa038;
     |SI FSalida = 0;
          nLinea = #diam0021#3;
          nLinFin = nLinea + 10;
          |PARA i = 1; |SI i [ 6; |HACIENDO i = i + 1;
               aAlfa = #agifa038#i#; |QBF aAlfa;
               |SI aAlfa ! "";
                    nLinea = nLinea + 1;
                    #diam0021#0 = #diaz0010#0;
                    #diam0021#1 = #diaz0010#1;
                    #diam0021#2 = #diaz0010#13;
                    #diam0021#3 = nLinea;
                    |LEE 000#diam0021.=;
                    |PARA; |SI FSalida = 0; |HACIENDO;
                         nLinea = nLinea + 1;
                         #diam0021#3 = nLinea;
                         |LEE 000#diam0021.=;
                    |SIGUE;
                    |DDEFECTO #diam0021;
                    #diam0021#0 = #diaz0010#0;
                    #diam0021#1 = #diaz0010#1;
                    #diam0021#2 = #diaz0010#13;
                    #diam0021#3 = nLinea;
                    #diam0021#4 = aAlfa;
                    |GRABA 020#diam0021.n;
               |FINSI;
          |SIGUE;
     |FINSI;
     |CIERRA #agifa038;

     |HAZ CalculaPresupuesto;

     aAlfa = "|IDGRID";
     aID = #diam0021#aAlfa#;
     nID = aID;
     |REFRESCACONTROL nID;

     |ESTADO_CONTROL nSubBoton7, "ENABLE";
     |ESTADO_CONTROL nSubBoton8, "ENABLE";
|FPRC;

|PROCESO SubBoton8;
     |ESTADO_CONTROL nSubBoton7, "DISABLE";
     |ESTADO_CONTROL nSubBoton8, "DISABLE";

     |CONFI "0000NSeguro de copiar los productos?";
     |SI FSalida = 0;
          |HAZ UltLinea;
          nNume = (nLinea / 10) ! 0;
          nNume = nNume * 10;
          |SI nNume > nLinea;
               nNume = nNume - 10;
          |FINSI;
          nLinea = nNume;     || siempre multiplo de 10
          nSw = 1;
          |BUCLE diam0020P;
          nSw = 0;
     |FINSI;
     |HAZ CalculaPresupuesto;

     aAlfa = "|IDGRID";
     aID = #diam0021#aAlfa#;
     nID = aID;
     |REFRESCACONTROL nID;

     |ESTADO_CONTROL nSubBoton7, "ENABLE";
     |ESTADO_CONTROL nSubBoton8, "ENABLE";
|FPRC;

|PROCESO Evento18;
     |SI FSalida = 1;
          |LEE 040#diam0021.=;
          |SI #diaz0010#117 = "M";
               |ESTADO_CONTROL nSubBoton7, "ENABLE";
               |ESTADO_CONTROL nSubBoton8, "ENABLE";
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Tipo21_7; |TIPO 7;
     |ESTADO_CONTROL nSubBoton7, "DISABLE";
     |ESTADO_CONTROL nSubBoton8, "DISABLE";
|FPRC;

|PROCESO Tipo21_3; |TIPO 3;
     |ESTADO_CONTROL nSubBoton7, "ENABLE";
     |ESTADO_CONTROL nSubBoton8, "ENABLE";
|FPRC;

|PROCESO EstadoBoton;
     |ESTADO_CONTROL nSubBoton1, aEstado;
     |ESTADO_CONTROL nSubBoton2, aEstado;
     |ESTADO_CONTROL nSubBoton3, aEstado;
     |ESTADO_CONTROL nSubBoton9, aEstado;
     |ESTADO_CONTROL nSubBoton11, aEstado;
|FPRC;

|PROCESO SubBoton1;
     aEstado = "DISABLE"; |HAZ EstadoBoton;
     nTipo = 1;
     |HAZ SacaDetallesPed;
     aEstado = "ENABLE"; |HAZ EstadoBoton;
|FPRC;

|PROCESO SubBoton2;
     aEstado = "DISABLE"; |HAZ EstadoBoton;
     nTipo = 2;
     |HAZ SacaDetallesPed;
     aEstado = "ENABLE"; |HAZ EstadoBoton;
|FPRC;

|PROCESO SubBoton3;
     aEstado = "DISABLE"; |HAZ EstadoBoton;
     nTipo = 3;
     |HAZ SacaDetallesPed;
     aEstado = "ENABLE"; |HAZ EstadoBoton;
|FPRC;

|PROCESO SubBoton9;
     aEstado = "DISABLE"; |HAZ EstadoBoton;
     nTipo = 9;
     |HAZ SacaDetallesPed;
     aEstado = "ENABLE"; |HAZ EstadoBoton;
|FPRC;

|PROCESO SubBoton11;
     aEstado = "DISABLE"; |HAZ EstadoBoton;
     nTipo = 11;
     |HAZ SacaDetallesPed;
     aEstado = "ENABLE"; |HAZ EstadoBoton;
|FPRC;

|PROCESO SubBoton12;
     aEstado = "DISABLE"; |HAZ EstadoBoton;
     |HAZ SacaPresu;
     aEstado = "ENABLE"; |HAZ EstadoBoton;
|FPRC;

|PROCESO SubBoton13;
     aEstado = "DISABLE"; |HAZ EstadoBoton;

     |ET Campo18;
         |ENCAMPO #18#diaz0010;
         |SI FSalida = 2;  |VETE Campo18;  |FINSI;

     |ET Campo30;
         |ENCAMPO #30#diaz0010;
         |SI FSalida = 2;  |VETE Campo18;  |FINSI;

     |ET Campo29;
         |ENCAMPO #29#diaz0010;
         |SI FSalida = 2;  |VETE Campo30;  |FINSI;

         |ENCAMPO #31#diaz0010;
         |SI FSalida = 2;  |VETE Campo29;  |FINSI;

     aEstado = "ENABLE"; |HAZ EstadoBoton;
|FPRC;
