|FICHEROS;
     tlfw0002 #0;
     tlfm0001 #1;
     tlfm0002 #2;
     agifa024 #24;
     agifa025 #25;
     agifa112 #112;
     agifa010 #10;
     agifa071 #71;
     agifa059 #59;
     agifa134 #134;
|FIN;

|VARIABLES;
     nSw = 0;
     &enForma = 0;
     &eaArtiAntes = "";
     &eaArticulo = "";
     &enModo = 0;
     &eaHayIMEI = "";
     &eaSerie = "";
     &enCodigo = 0;
     &enLinea = 0;
     &efFecha = @;
     &eaCliente = "";
     &eaNomCli = "";
     &eaRepre = "";
     &eaAbono = "";
     &enAlmacen = 0;
     aAlfa = "";
     aAlf1 = "";
     aAlf2 = "";
     aAlf3 = "";
     aArti = "";
     i = 0;
     nGuarda = 0;
     aImeiAnt = "";
     aAbonoAnt = "";
|FIN;

|PROCESO IMEI7; |TIPO 7;
     aImeiAnt = #0#0;
|FPRC;

|PROCESO Abono7; |TIPO 7;
     aAbonoAnt = #0#1;
|FPRC;

|PROCESO CheqIMEI0; |TIPO 0;
     |SI FSalida = 1;           ||Escape
          |SI enModo = 2;
               |ERROR; |PTEC 802; |PTEC 802; |ACABA;
          |SINO;
               |ERROR; |PTEC 807; |ACABA;
          |FINSI;
     |FINSI;

     |SI FSalida = 2; |ACABA; |FINSI;

     aAlfa = #0#0; |QBF aAlfa;
     |SI aAlfa ! ""; |Y Campo = 0;
          |ABRE #1;
          #1#0 = #0#0;
          |LEE 000#1=;
          |SI FSalida ! 0;
               |MENAV "0000IMEI Inexistente...";
               |ERROR; |ACABA;
          |SINO;
               |SI #1#1 ! #0#3;
                    aAlfa = "0000El IMEI corresponde al articulo:" + #1#1;
                    |MENAV aAlfa;
                    |ERROR; |ACABA;
               |FINSI;
               |SI #1#11 ! enAlmacen;
                    aAlfa = "0000IMEI existente en Almacen: " + #1#11;
                    |MENAV aAlfa;
                    |ERROR; |ACABA;
               |FINSI;
               |SI #1#25 ! eaSerie; |O #1#26 ! enCodigo; |O #1#27 ! enLinea;
                    |SI #1#27 ! 0; |O #1#31 ! 0; |O #1#35 ! 0; |O #1#60 ! 0;
                         |SI #1#60 ! 0;
                              |SI eaCliente ! #1#12;
                                  aAlfa = "0000IMEI reservado al cliente:" + #1#12;
                                  |MENAV aAlfa;
                                  |ERROR; |ACABA;
                              |FINSI;
                         |SINO;
                              |SI eaAbono = "N"; |Y #1#57 = "N";
                                   |MENAV "0000IMEI Vendido...";
                                   |ERROR; |ACABA;
                              |FINSI;
                         |FINSI;
                    |FINSI;
               |FINSI;
               |SI eaAbono = "S";||ABONO
                    |SI #1#57 = "S";
                         |MENAV "0000EL IMEI ya esta abonado...";
                         |ERROR; |ACABA;
                    |FINSI;
                    |SI #1#26 = 0; |Y #1#30 = 0; |Y #1#34 = 0;
                         |MENAV "0000EL IMEI no esta vendido...";
                         |ERROR; |ACABA;
                    |FINSI;
               |FINSI;
          |FINSI;
          |CIERRA #1;
          |SI enModo = 1; |O #0#0 ! aImeiAnt;
               #0#1 = #1#3; |PINTA #0#1;
               #0#2 = #1#4; |PINTA #0#2;
          |FINSI;
     |FINSI;
     aAlfa = #0#1; |QBF aAlfa;
     |SI aAlfa ! ""; |Y Campo = 1;
          |ABRE #2;
          #2#3 = #0#1;
          |LEE 000#2=;
          |SI FSalida ! 0;
               |MENAV "0000Abono Inexistente...";
               |ERROR; |ACABA;
          |SINO;
               |SI #2#1 ! #0#3;
                    aAlfa = "0000El Abono corresponde al articulo:" + #2#1;
                    |MENAV aAlfa;
                    |ERROR; |ACABA;
               |FINSI;
               |SI #2#11 ! enAlmacen;
                    aAlfa = "0000IMEI existente en Almacen: " + #2#11;
                    |MENAV aAlfa;
                    |ERROR; |ACABA;
               |FINSI;
               |SI #2#25 ! eaSerie; |O #2#26 ! enCodigo; |O #2#27 ! enLinea;
                   |SI #2#27 ! 0; |O #2#31 ! 0; |O #2#35 ! 0; |O #2#53 ! 0;
                         |SI #2#53 ! 0;
                              |SI eaCliente ! #2#12;
                                   aAlfa = "0000Abono reservado al cliente:" + #1#12;
                                   |MENAV aAlfa;
                                   |ERROR; |ACABA;
                              |FINSI;
                         |SINO;
                              |SI eaAbono = "N"; |Y #2#50 = "N";
                                   |MENAV "0000Abono Vendido...";
                                   |ERROR; |ACABA;
                              |FINSI;
                         |FINSI;
                   |FINSI;
               |FINSI;
          |FINSI;
          |CIERRA #2;
          |SI enModo = 1; |O #0#1 ! aAbonoAnt;
               #0#0 = #2#0; |PINTA #0#0;
               #0#2 = #2#4; |PINTA #0#2;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO CargaIMEIAlb;
     |DDEFECTO #0;

     |ABRE #1;
     |SELECT #5#1;
     #1#25 = eaSerie;
     #1#26 = enCodigo;
     #1#27 = enLinea;
     |LEE 000#1=;
     |SI FSalida = 0;
          #0#0 = #1#0;
     |FINSI;
     |CIERRA #1;

     |ABRE #2;
     |SELECT #5#2;
     #2#25 = eaSerie;
     #2#26 = enCodigo;
     #2#27 = enLinea;
     |LEE 000#2=;
     |SI FSalida = 0;
          #0#1 = #2#3;
          #0#2 = #2#4;
     |FINSI;
     |CIERRA #2;
     #0#3 = aArti;
|FPRC;

|PROCESO Limpia;
     |PARA i = 12; |SI i [ 22; |HACIENDO i = i + 1;
          |SI #1#59 = 0; #1i = ""; |FINSI;
          |SI #2#52 = 0; #2i = ""; |FINSI;
     |SIGUE;
     |PARA i = 25; |SI i [ 36; |HACIENDO i = i + 1;
          aAlf1 = "|C"+ (("000"+i)%-103) + "TIPO";
          aAlf2 = #1#aAlf1#;
          |SI aAlf2 = "F"; #1i = "01.01.0000"; |SINO; #1i = ""; |FINSI;
          aAlf2 = #2#aAlf1#;
          |SI aAlf2 = "F"; #2i = "01.01.0000"; |SINO; #2i = ""; |FINSI;
     |SIGUE;
     #1#39 = "01.01.0000";

     |SI eaAbono = "S";
          #1#57 = "N"; #1#25 = "99999"; #1#26 = 999999; #1#27 = 999;
          #1#50 = "N"; #1#25 = "99999"; #1#26 = 999999; #1#27 = 999;
     |FINSI;
|FPRC;

|PROCESO BorraAlb;
     |ABRE #1;
     |SELECT #5#1;
     #1#25 = eaSerie;
     #1#26 = enCodigo;
     #1#27 = enLinea;
     |LEE 000#1=;
     |SI FSalida = 0;
          |SELECT #1#1;
          |LEE 121#1=;
          |SI FSalida = 0;
               |HAZ Limpia;
               |GRABA 020#1a;
          |FINSI;
     |FINSI;
     |CIERRA #1;

     |ABRE #2;
     |SELECT #5#2;
     #2#25 = eaSerie;
     #2#26 = enCodigo;
     #2#27 = enLinea;
     |LEE 000#2=;
     |SI FSalida = 0;
          |SELECT #1#2;
          |LEE 121#2=;
          |SI FSalida = 0;
               |HAZ Limpia;
               |GRABA 020#2a;
          |FINSI;
     |FINSI;
     |CIERRA #2;
|FPRC;

|PROCESO EntIMEI12; |TIPO 12;
     |SI FSalida ! 0;
          eaHayIMEI = "N";
          |ACABA;
     |FINSI;
     eaHayIMEI = "S";

     aAlfa = #0#0; |QBF aAlfa;
     |SI aAlfa ! "";
          |ABRE #1;
          #1#0 = #0#0;
          |LEE 121#1=;
          |SI FSalida = 0;
               #1#25 = eaSerie;
               #1#26 = enCodigo;
               #1#27 = enLinea;
               #1#28 = efFecha;
               #1#12 = eaCliente;
               #1#21 = eaRepre;
               #1#57 = eaAbono;
               #1#13 = eaNomCli;

               |DDEFECTO #24;
               |ABRE #24;
               #24#0 = #1#12;
               |LEE 000#24=;
               |CIERRA #24;

               |DDEFECTO #112;
               |ABRE #112;
               #112#0 = #1#5;
               |LEE 000#112=;
               |CIERRA #112;

               |DDEFECTO #25;
               |ABRE #25;
               #25#0 = #1#21;
               |LEE 000#25=;
               |CIERRA #25;

               #1#6 = #112#1;
               |SI eaAbono = "S";
                    #1#13 = "";
                    #1#14 = "";
                    #1#15 = "";
                    #1#16 = "";
                    #1#17 = "";
                    #1#18 = "";
                    #1#19 = "";
                    #1#20 = "";
                    #1#22 = "";
                    #1#12 = "";
                    #1#21 = "";
               |SINO;
                    ||#1#13 = #24#2;
                    #1#14 = #24#32;
                    #1#15 = #24#33;
                    #1#16 = #24#31;
                    #1#17 = #24#29;
                    #1#18 = #24#162;
                    #1#19 = #24#34;
                    #1#20 = #24#30;
                    #1#22 = #25#1;
               |FINSI;
               |GRABA 020#1a;
          |FINSI;
          |CIERRA #1;
     |FINSI;
     aAlfa = #0#1; |QBF aAlfa;
     |SI aAlfa ! "";
          |ABRE #2;
          #2#3 = #0#1;
          |LEE 121#2=;
          |SI FSalida = 0;
               #2#25 = eaSerie;
               #2#26 = enCodigo;
               #2#27 = enLinea;
               #2#28 = efFecha;
               #2#50 = eaAbono;
               #2#12 = eaCliente;
               #2#23 = eaNomCli;
               |GRABA 020#2a;
          |FINSI;
          |CIERRA #2;
     |FINSI;
|FPRC;

|PROCESO MiraArtIMEI;
     |ABRE #1;
     |ABRE #2;
     |SELECT #6#1;
     |SELECT #6#2;
     #1#1 = aArti;
     |LEE 000#1=;
     |SI FSalida ! 0;
          #2#1 = aArti;
          |LEE 000#2=;
          |SI FSalida ! 0;
               eaHayIMEI = "N"; || NO HAY...
          |FINSI;
     |FINSI;
     |CIERRA #1;
     |CIERRA #2;
|FPRC;
----------------------------------------------------------------
|PROCESO PonFac2;
     |SI enForma = 1;
          #2#33 = eaSerie;
          #2#34 = enCodigo;
          #2#35 = #59#1;
          #2#36 = #134#1;
     |SINO;
          #2#33 = "";
          #2#34 = 0;
          #2#35 = 0;
          #2#36 = "01.01.0000";
     |FINSI;
     |GRABA 020#2a;
     |LIBERA #2;
|FPRC;

|DEFBUCLE PonFac2;
     #2#5;
     ;
     #71#29, #71#0, #71#1;
     #71#29, #71#0, #71#1;
     be;
     NULL, PonFac2;
|FIN;

|PROCESO PonFac1;
     |SI enForma = 1;
          #1#33 = eaSerie;
          #1#34 = enCodigo;
          #1#35 = #59#1;
          #1#36 = #134#1;
     |SINO;
          #1#33 = "";
          #1#34 = 0;
          #1#35 = 0;
          #1#36 = "01.01.0000";
     |FINSI;
     |GRABA 020#1a;
     |LIBERA #1;
|FPRC;

|DEFBUCLE PonFac1;
     #1#5;
     ;
     #71#29, #71#0, #71#1;
     #71#29, #71#0, #71#1;
     be;
     NULL, PonFac1;
|FIN;

|PROCESO Albaran;
     |BUCLE PonFac1;
     |BUCLE PonFac2;
|FPRC;

|DEFBUCLE Albaran;
     #10#1
     ;
     #59#15, #59#2;
     #59#15, #59#2;
     ;
     NULL, NULL, Albaran;
|FIN;

|PROCESO Factura;
     |BUCLE Albaran;
|FPRC;

|DEFBUCLE Factura;
     #134#1;
     ;
     eaSerie, enCodigo;
     eaSerie, enCodigo;
     ;
     NULL, NULL, Factura;
|FIN;
----------------------------------------------------------------
|PROGRAMA;
     |SI PARAMETRO = "FACTURA";
          |BUCLE Factura;
          |ACABA;
     |FINSI;

     eaHayIMEI = "S";
     aArti = eaArticulo;
     |HAZ MiraArtIMEI;

     |SI enModo = 2;
          |SI eaArtiAntes ! eaArticulo;
               |HAZ BorraAlb;
               enModo = 1;
          |FINSI;
     |FINSI;
     |SI eaHayIMEI = "N"; |ACABA; |FINSI;

     |SI enModo = 3;
          |HAZ BorraAlb;
          |ACABA;
     |FINSI;

     nSw = 0;
     |SI enModo = 2;
          |SI eaArtiAntes = eaArticulo;
               nSw = 1;
               |HAZ CargaIMEIAlb;
               |HAZ BorraAlb;
          |FINSI;
     |FINSI;

     |SI nSw = 0;
          |HAZ CargaIMEIAlb;
     |FINSI;
     aAlfa = #0#0 + #0#1; |QBF aAlfa;
     |SI enModo = 2; |Y aAlfa = "";
          eaHayIMEI = "N";                 || NO HAY....
     |SINO;
          |PUSHV 0501 2380;
          |BLANCO 1423 2055;
          |PINPA #0#0;
          |PINDA #0#0;
          nGuarda = FEntrada;

          |SI enModo = 4;
               |PAUSA;
          |SINO;
               |ENDATOS #1#0;
          |FINSI;

          FEntrada = nGuarda;
          |POPV;
     |FINSI;
|FPRO;
