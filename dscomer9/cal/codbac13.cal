|FICHEROS;
   codbac13 #0;
   codbar13 #1; ||Parametros codigo barras EAN13
   agifa019 #2;
|FIN;

|VARIABLES;
     codigo = "";
     contador = "";
     an = "";
     n = 0;
     pfija = "";
     pf = 0;

     atmp = "";

     ncontador = 0;
     digcontrol = "";
     tmppfija = "";

     i1        = "";
     i2        = "";
     i3        = "";
     i4        = "";
     i5        = "";
     i6        = "";
     p1        = "";
     p2        = "";
     p3        = "";
     p4        = "";
     p5        = "";
     p6        = "";
     sumai     = 0;
     sumap     = 0;
     base      = 0;
     resto     = 0;
     total     = 0;
     digito    = 0;
|FIN;

|PROCESO calcdig;
    i1 = #2#128 % 101;
    i2 = #2#128 % 301;
    i3 = #2#128 % 501;
    i4 = #2#128 % 701;
    i5 = #2#128 % 901;
    i6 = #2#128 % 1101;
    p1 = #2#128 % 201;
    p2 = #2#128 % 401;
    p3 = #2#128 % 601;
    p4 = #2#128 % 801;
    p5 = #2#128 % 1001;
    p6 = #2#128 % 1201;
    sumai = i1 + i2 + i3 + i4 + i5 + i6;
    sumap = p1 + p2 + p3 + p4 + p5 + p6;
    sumap = sumap * 3;
    total = sumai + sumap;
    base = total / 10;
    resto = total $ 10;
    |SI resto ! 0;
         resto = resto / 10;
         base = (base - resto) + 1;
         base = base * 10;
    |SINO;
         base = base * 10;
    |FINSI;
    digito = base - total;

    digcontrol = digito;
|FPRC;

|PROCESO arts;
   tmppfija = #2#128 % pf;
   |QBF tmppfija;
   |SI #0#0 = "S";|Y pfija = tmppfija; ||Si coincide la parte fija ya creada con la que se va a crear
       |ACABA;
   |FINSI;
   contador = "000000000000" + ncontador;
   contador = contador % n;
   codigo = pfija + contador;
   #2#128 = codigo;
   |HAZ calcdig;
   codigo = codigo + digcontrol;
   #2#128 = codigo;
   |GRABA 021#2a;  ||ojo faltaria comprobar no exista ya codigo de barras clave 4?
   ncontador = ncontador + 1;
|FPRC;

|DEFBUCLE articulos;
#2#1;
;
INICIO;
FINAL;
be;
NULL,arts;
|FIN;

|PROGRAMA;
   |CLS;
   |PINPA #0#0;
   |PINDA #0#0;
   |ENDATOS #2#0;
   |SI FSalida = 0;|Y #0#1 = "S";
       |ABRE #1;
       |LEE 001#1p;
       |SI FSalida = 0;
           pfija = #1#1;
           |QBF pfija;
           an = pfija % A0; ||Longitud parte fija
           ncontador = #1#2;
           n = an;
           pf = (100 + n);
           n = 12 - n;
           n = (100 + n) * -1;
           |BUCLE articulos;
           #1#2 = ncontador;
           |GRABA 021#1a;
       |FINSI;
       |CIERRA #1;
   |SINO;
       |MENAV "0000Proceso NO realizado. No confirmado";
   |FINSI;
|FPRO;
