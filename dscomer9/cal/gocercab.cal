|FICHEROS;
     gocercab #0;
     gocerlin #1;
     gopre001 #2;
     gopre003 #3;
     gocerhis #4,MANTE;
     agifa027 #5;
     agifa084 #6;
     agifa069 #7;
     gopre001 #10;
     gopre002 #11;
     gopre003 #12;
     gopre004 #14;
     agifa019 #19;
     goartive #20;

     gopartia #25;
     goceradm #26,MANTE;
     gomantca #27;
     agifa142 #41;        || Parametros Generales
     goparame #100;
     godeprel #202;
     copgocer@ #222;      || apoyo para CARGADEF

     agifa024 #1024;     || Clientes
     agifa025 #1025;     || Representantes
     gocerc05 #28,MANTE;       || Mediciones Certificacion

     guerm036 #36;
     guerm037 #37;
     guerz025 #38,MANTE;
     gocercab@;

     gopre021;
     gopre022;
     guerm042 #142;
     dsm00003 #33,MANTE;
     agifa133;
     agifa091;      || formas de pago
     agifa134 #134;

     gocerenc #101;
     agifa722 #102;
     agifa704 #104;
     caenlac@ #1000;
     caconas@ #1001;
     camasic@ #1002;

     guerm040 #540;      ||Multifactura Cer.(C)
     guerm041 #541;      ||Multifactura Cer.(L)
     gocerdes #39;
     guerw070 #70;
     go000023 #23;
     gocerhis@ #600;
     gocerrea #150;
     referen@;
|FIN;
-----------------------------------------------------------------------------
|VARIABLES;
     &eaInfTxt = "";
     aDirFijo = "c:\ds000con\";
     &enN5 = 0;
     &enN6 = 0;
     &enN8 = 0;
     &enN9 = 0;
     &enN10 = 0;
     &enN11 = 0;
     &enAp = 0;
     &enBase = 0;
     &enTope = 0;
     &enBasi = 0;
     &enResu = 0;
     &enRete = 0;
     &enSwModoSilencio = 0;
     nSwPrime = 0;
     aPartiPres = "";
     aParDesPres = "";
     aCapiPres = "";
     aSerieFac = "";

     &enTiva = 0;
     &efFiva = @;
     &eaDiva = "";
     &enIva = 0;
     &enRec = 0;
     &eaTexto = "";
     &PRMNT_enVer   = 0;

     &eaParti = "";
     &eaCapi = "";
     &enNumCer = 0;
     nNumCer = 0;
     nHayCerti = 0;
     &eaTitulo = "";
     nBene = 0;
     &Tempo = "";
     aTmp26 = "";
     aTmp70 = "";
     nPos = 0;
     nTotalPor = 0;
     nSumaPor = 0;
     nSumaImp = 0;
     nAux = 0;
     nBase = 0;
     nExenta = 0;
     nGuarda = 0;
     nSwMulti = 0;
     &enSwMenu = 0;
     &eaFicImpre = "";
     &eaPrograma = "";
     nSwDupli   = 0;
     nNumPre    = 0;
     nMax       = 0;
     nSwProdu   = 0;
     nSwError   = 0;
     &efFecha   = @;
     nModoCab   = 0;
     nBoton     = 0;
     &eaSer     = "";
     &enNum     = 0;
     &eaTipo    = "";
     &enEvento  = 0;
     &enEnvio   = 0;
     &eaOrigen  = "";
     &eaDestino = "";
     &eaAsunto  = "";

     dVacio         = "                    ";
     hVacio         = "zzzzzzzzzzzzzzzzzzzz";
     nForma         = 0;
     &eaSerie       = "";
     &enNuPre       = 0;
     &enLinea = 0;
     i              = 0;
     aAlfa1         = "";
     aAlfa          = "";
     aGuarda        = "";
     &aTipCer       = "";
     &cCodMonBase   = "";
     &cDesMonBase   = "";
     &cCodMonTrab   = "";
     &cDesMonTrab   = "";
     &serie         = "";

     &nDeci_PBase   = 0;
     &nDeci_TBase   = 0;
     &nDeci_PTrab   = 0;
     &nDeci_TTrab   = 0;
     &nDeci_TotVis  = 0;
     &nEurComTrab   = 0;
     &nEurComBase   = 0;
     &nEurVenTrab   = 0;
     &nEurVenBase   = 0;
     &nError        = 0;
     &numero        = 0;

     nSal           = 0;
     nLin           = 0;
     nModo          = 0;
     nTipo          = 0;
     nSw            = 0;
     nBotAmpli      = 0;
     nAmp           = 0;
     nLinea         = 0;
     nSwich         = 0;
     nHay           = 0;
     nCont          = 0;

     cTexto         = "";
     cCadena        = "";
     contador       = "";

     {-1}Menu       = "";
     Menu1          = "2400";
     Menu2          = "1";
     Menu3          = "Contador:  ";
     Menu4          = "AM";
     Menu5          = " Automatico ";
     Menu6          = " Manual ";

     fFecIni        = @;
     fFecFin        = @;
     swImp = 0;
     aDef = "";
     nTotCert = 0;
     nNumCert = 0;
     nNume1 = 0;
     nNume2 = 0;
     aMensaje = "";
     aEstado = "";
     nLim = 0;
     &nDeci_Medi = 0;
     &nDeci_Meda = 0;
     aRutaLocal = "";
     aRutaServidor = "";
     nCanal = 0;
     nAlgo = 0;
     &nSUBCAPITULO = 0;
     &nCAPITULO = 0;
     nCAPITULO_ANT = 0;
     &nIV1 = 0; &aFV1 = "";
     &nIV2 = 0; &aFV2 = "";
     &nIV3 = 0; &aFV3 = "";
     &nIV4 = 0; &aFV4 = "";
     &nIV5 = 0; &aFV5 = "";
     &nIV6 = 0; &aFV6 = "";
     &aLinPartida = "";
     &aLinImpre = "";
     nActual = 0;
     &nAcumulado = 0;
     &nAnterior = 0;

     nDiario = 0;
     fFecha = @;
     nDocum = 0;
     nImporte = 0;
     nCalc = 0;
     fich_alta = "";
     enNoModif = 0;

     nPrecio44 = 0;
     nTotal = 0;
     nMiPrecio = 0;
     nPrecio = 0;
     nPrecio31 = 0;
     nPrecio32 = 0;
     nPrecio33 = 0;
     nTotalacer = 0;
     nTotalACert = 0;
     aSerPres = "";
     nNumPres = 0;
     nLinCer = 0;
     nTotalYACert = 0;
     nTotalYACalc = 0;
     aCodigoCli = "";
     aCuentaCli = "";
     aCuenta = "";

     aDato1 = "";
     aDato2 = "";
|FIN;
-----------------------------------------------------------------------------
|PROCESO Pinta; |TIPO 14;
     |PINTA #1#26; |PINTA #1#25; |PINTA #1#24; |PINTA #1#16; |PINTA #1#23;
     |PINTA #1#8; |PINTA #1#14; |PINTA #1#15;
     |PINTA #1#20; |PINTA #1#9; |PINTA #1#12;
     |PINTA #1#10;
     |PINTA #1#21; |PINTA #1#22;
     |HAZ Consulta;
|FPRC;

|PROCESO Mone; |TIPO 14;
     cCodMonTrab = #0#6;
     |HAZ MonBas;

     |SI nSwPrime = 0;
          nSwPrime = 1;
          |HAZ Consulta;
     |FINSI;
|FPRC;
-------------------------------------------------------------------------------
|PROCESO ModPresup; |TIPO 6;
|ACABA;
     |ABRE #gopre001;
     eaTipo = "C"; eaSer = #gocercab#0; enNum = #gocercab#1; |HAZ ModifPres;
     |CIERRA #gopre001;
     |SI enNum = -1; |ERROR; |ACABA; |FINSI;
     #gocercab#1 = enNum; |PINTA #gocercab#1;
|FPRC;
-------------------------------------------------------------------------------
|PROCESO NoDuplica;
     nSwDupli = 1;
     |SI #100#60 = "S";
          nNumPre = 0;
          nMax = #100#59 + #100#54;
          |SI #0#1 ] #100#58; |Y #0#1 [ #100#59;
               nNumPre = #0#1 + #100#54;
          |FINSI;
          |SI #0#1 > #100#59; |Y #0#1 [ nMax;
               nNumPre = #0#1 - #100#54;
          |FINSI;
          |SI nNumPre = 0; |ACABA; |FINSI;

          |DDEF aDef; aDef = aDef + "gocercab";
          |CARGA_DEF aDef, gocercab@;
          |SI FSalida = 0;
               |ABRE #gocercab@;
               #gocercab@#0 = #0#0;
               #gocercab@#1 = nNumPre;
               |LEE 000#gocercab@.=;
               nSwDupli = FSalida;
               |CIERRA #gocercab@;
               |DESCARGA_DEF #gocercab@;
          |FINSI;
          |SI nSwDupli = 0;
               aAlfa = "0000Ya existe: ["+#0#0+"/"+(("000000"+nNumPre)%-106)+"]...";
               |MENAV aAlfa;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Tipo7C4_gocerlin; |TIPO 7;
     |SI #1#7 = "S";
          aSerieFac = #1#4;
          |QBF aSerieFac;
          |SI aSerieFac = "";
               #1#4 = #goparame#13;
               |PINTA #1#4;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO BuscaPre; |TIPO 0;
     |ABRE #goparame; |LEE 000#goparame.p; |CIERRA #goparame;

     nModoCab = (FEntrada / 100) ! 0; || PARA EL BOTON!!!
     nModo = (FEntrada / 100) ! 0;


     |SI nModo = 1;
          |HAZ NoDuplica;
          |SI nSwDupli = 0; |ERROR; |ACABA; |FINSI;
     |FINSI;

     |ABRE #10;
     #10#0 = #2#0;
     #10#1 = #2#1;
     |LEE 000#10=;
     |CIERRA #10;
     nDeci_Medi = #10#24;

     nDeci_Meda = #100#115;

     |SI nModo = 1;
          |C_M #0#7, 1, "S";
     |FINSI;

     |ABRE #2;
     #2#0 = #0#0;
     #2#1 = #0#1;
     |LEE 010#2=;
     |SI FSalida = 0;
          |SI #2#17 = " ";
               |SI #goparame#60 = "N";
                    |MENAV "0000Presupuesto NO asignado a expediente";
                    |ERROR;
                    |ACABA;
               |SINO;
                    #2#0 = #0#0;
                    |SI #0#1 ] #goparame#54; |Y #0#1 < #goparame#56;
                         #2#1 = #gocercab#1 - #goparame#54;
                    |FINSI;
                    |SI #0#1 ] #goparame#56;
                         #2#1 = #gocercab#1 - #goparame#56;
                    |FINSI;
                    |SI #0#1 ] #goparame#58; |Y #0#1 [ #goparame#59;
                         #2#1 = #gocercab#1 + #goparame#54;
                    |FINSI;
                    |LEE 000#2=;
                    |SI FSalida = 0;
                         |SI #2#17 = " ";
                              #2#0 = #0#0;
                              |SI #0#1 ] #goparame#58; |Y #0#1 [ #goparame#59;
                                   #2#1 = #gocercab#1 + #goparame#56;
                              |FINSI;
                              |SI #0#1 ] #goparame#54; |Y #0#1 < #goparame#56;
                                   #2#1 = #gocercab#1 - #goparame#56;
                              |FINSI;
                              |LEE 000#2=;
                              |SI FSalida = 0;
                                   |SI #2#17 = " ";
                                        |MENAV "0000Presupuesto NO asignado a expediente";
                                        |ERROR; |ACABA;
                                   |SINO;
                                        #0#4 = #2#15; #0#5 = #2#16;
                                        |PINTA #0#4;  |PINTA #0#5;
                                   |FINSI;
                              |SINO;
                                   |MENAV "0000Presupuesto NO asignado a expediente";
                                   |ERROR; |ACABA;
                              |FINSI;
                         |SINO;
                              #0#4 = #2#15; #0#5 = #2#16;
                              |PINTA #0#4;  |PINTA #0#5;
                         |FINSI;
                    |SINO;
                         |MENAV "0000Presupuesto NO asignado a expediente";
                         |ERROR; |ACABA;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;

     |CIERRA #2;

     aTipCer = #2#36;
     #0#15 = #2#18;
     #0#12 = #0#11 - #0#10;

     |ABRE #27;
     #27#0 = #0#4;                                ||Serie Exp.
     #27#1 = #0#5;                                ||No. Exped.
     |LEE 000#27=;

     |SI FSalida = 0;
          #0#16 = #27#11;                         ||Almacen.
     |FINSI;

     |CIERRA #27;
     |PINTA #0#12;
     |PINTA #0#15;
     |PINTA #0#16;

|FPRC;
-----------------------------------------------------------------------------
|PROCESO Consulta;
     |ATRI I; |PINTA 1670, "           "; |ATRI 0;
     |ATRI I; |PINTA 1770, "           "; |ATRI 0;
     |SI #0#15 = "A";
          |ENTLINEAL #1#26,-4,7,22,1,minimo,maximo;
     |SINO;
          |ATRI I; |PINTA 1670, "Cant. Medi."; |ATRI 0;
          |ENTLINEAL #1#4,-4,7,22,1,minimo,maximo;
     |FINSI;

     |C_M #1#8, 1, "S";
     |C_M #1#9, 1, "S";
     ||C_M #1#3, 1, "S";

     |ABRE #goparame; |LEE 000#goparame.p; |CIERRA #goparame;
     |SI #goparame#88 = "N";
          |C_M #1#25, 1, "N";
          |C_V #1#25, 1, "N";
          |PINTA 0513, "          ";
     |SINO;
          |C_M #1#25, 1, "S";
          |C_V #1#25, 1, "S";
          |PINTA #1#25;
     |FINSI;

     |SI #goparame#100 = "N";
          |C_V #1#26, 1, "N";
          |PINTA 0502, "   ";
     |SINO;
          |C_V #1#26, 1, "S";
     |FINSI;

     |SI #goparame#143 = "N";
          |C_V #1#27, 1, "N";
          |C_V #1#28, 1, "N";
          |C_V #1#29, 1, "N";
          |PINTA 1702, "                                                       ";
     |FINSI;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO Titulo; |TIPO 7;
     cTexto = #1#10; |QBF cTexto;
     |SI cTexto = "";
          |SI #0#15 ! "A";
               cTexto = #1#1;
               |QBF cTexto;
               cTexto = "000000" + cTexto;
               cTexto = cTexto % -106;
               cTexto = #1#0 + "-" + cTexto;
               cCadena = "CERTIFICACION No: ";
               cCadena = cCadena + #1#2 + "  REFERENTE PTO. No: " + cTexto;
               cTexto = #1#8;
               cTexto = " CORRESPONDIENTE AL PERIODO DEL " + cTexto;
               cCadena = cCadena + cTexto;
               cTexto = #1#9;
               cTexto = " AL " + cTexto;
               cCadena = cCadena + cTexto;
          |SINO;
               cTexto = #1#8;
               cTexto = " CORRESPONDIENTE AL PERIODO DEL " + cTexto;
               cCadena = cCadena + cTexto;
               cTexto = #1#9;
               cTexto = " AL " + cTexto;
               cCadena = "FACTURACION ADMINISTRACION" + cCadena + cTexto;
          |FINSI;
          #1#10 = cCadena;
          |PINTA #1#10;
     |FINSI;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO Alta; |TIPO 0;
     nModo = (FEntrada / 100) ! 0;

     |SI #0#15 = "A";
          |SI #1#7 = "S"; |O #1#25 = "S";
               |ENTLINEAL #1#26,-4,4,22,1,minimo,maximo;
          |SINO;
               |ENTLINEAL #1#26,-4,2,22,1,minimo,maximo;
          |FINSI;
     |SINO;
          |SI #1#7 = "S"; |O #1#25 = "S";
               |ENTLINEAL #1#4 ,-4,4,22,0,minimo,maximo;
          |SINO;
               |ENTLINEAL #1#4 ,-4,2,22,0,minimo,maximo;
          |FINSI;
     |FINSI;

     |HAZ Consulta;

     |SI nModo = 1;
          |HAZ CalcCert;
     |FINSI;
     |PINTA #1#6;
     |PINTA #1#20;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO minimo;
     #4#0 = #1#0;
     #4#1 = #1#1;
     #4#2 = #1#2;
     #4#3 = 1;
     #4#15 = #1#8;

     #26#0 = #1#0;
     #26#1 = #1#1;
     #26#2 = #1#2;
     #26#3 = 1;
     #26#15 = #1#8;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO maximo;
     #4#0 = #1#0;
     #4#1 = #1#1;
     #4#2 = #1#2;
     #4#3 = 999;
     #4#15 = #1#9;

     #26#0 = #1#0;
     #26#1 = #1#1;
     #26#2 = #1#2;
     #26#3 = 999;
     #26#15 = #1#9;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO BorraPart;
     #3#0 = #4#0;                                 ||Serie Pres.
     #3#1 = #4#1;                                 ||N.Presupuesto
     #3#2 = #4#14;                                ||Capi
     #3#3 = #4#22;                                 ||Partida
     |LEE 121#3=;
     |SI FSalida = 0;
          #3#19 = #3#19 + #4#12;                  ||% Pendiente.
          #3#13 = #3#13 - #4#10;                  ||Importe Certificado.
          #3#14 = #3#14 - #4#7;                   ||Unidades Certificadas.
          #3#15 = #3#7  - #3#14;                  ||Unidades Pendientes.
          #3#20 = #3#10 - #3#13;                  ||Importe Pendiente.
          |GRABA 020#3a;
          |LIBERA #3;
     |FINSI;
     |BORRA 020#4a;
|FPRC;
-------------------------------------------------------------------------------
|PROCESO BorraAdmi;
     #25#34 = #26#23;
     #25#4 = #26#24;
     #25#5 = #26#25;
     #25#6 = #26#26;
     #25#7 = #26#27;
     |LEE 121#25=;
     |SI FSalida = 0;
          #25#31 = "N";
          |GRABA 020#25a;
          |LIBERA #25;
     |FINSI;
     |BORRA 020#26a;
     nHay = 1;
|FPRC;

|DEFBUCLE BorraAdmi;
     #26#1;
     ;                                          ||Campos Extras.
     #1#0, #1#1, #1#2,   1;
     #1#0, #1#1, #1#2, 999;
     be;                                         ||b/e Bolqueo-Ordenacion.
     NULL, BorraAdmi;
|FIN;
-------------------------------------------------------------------------------

|DEFBUCLE BorraPart;
     #4#1;
     ;                                          ||Campos Extras.
     #1#0, #1#1, #1#2,   1;
     #1#0, #1#1, #1#2, 999;
     be;                                          ||b/e Bolqueo-Ordenacion.
     NULL, BorraPart;
|FIN;
-------------------------------------------------------------------------------
|PROCESO Boton; |TIPO 7;
     |SI nModoCab = 1;
          |HAZ PonBoton;
     |FINSI;

     |HAZ Consulta;

     |C_P #1#6, 0, nPos;
|FPRC;

|PROCESO SacaCli; |TIPO 0;
     |HAZ QuitaBoton;
     |ABRE #100; |LEE 000#100p; |CIERRA #100;
     nModo = (FEntrada/100)!0;
     |SI nModo = 1;
          #1#11 = #0#2;
          #1#12 = #0#3;
          |PINTA #1#11;
          |SI #goparame#100 = "S";
               |ABRE #2;
               #2#0 = #0#0;
               #2#1 = #0#1;
               |LEE 000#2=;
               |CIERRA #2;
               #1#26 = #2#27;
               |PINTA #1#26;
          |FINSI;
     |FINSI;
     |SI #0#15 = "P"; |Y #100#139 = "S";
          #1#13 = 0;
          |C_V #1#13, 1, "N";
          |PINTA #0#13;
     |FINSI;

     |SI nModo ! 1;
          efFecha = #1#3;
          |HAZ EstaCerrado;
          |SI FSalida = 0;
               |ERROR; |ACABA;
          |FINSI;
     |FINSI;

     |SI #1#7 = "S";
          |C_M #1#26, 1, "N";
          |C_M #1#27, 1, "N";
          |C_M #1#28, 1, "N";
          |C_M #1#29, 1, "N";
     |SINO;
          |C_M #1#26, 1, "S";
          |C_M #1#27, 1, "S";
          |C_M #1#28, 1, "S";
          |C_M #1#29, 1, "S";
     |FINSI;

     |DDEF aAlfa;
     aAlfa = aAlfa + "gocerlin";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          #referen@#0 = #1#0;
          #referen@#1 = #1#1;
          #referen@#2 = 999
          |LEE 000#referen@.];
          |SI FSalida = 0;
               |LEE 000#referen@.a;
          |SINO;
               |LEE 000#referen@.u;
          |FINSI;
          |SI FSalida = 0; |Y #referen@#0 = #1#0; |Y #referen@#1 = #1#1;
               #1#27 = #referen@#27; |PINTA #1#27;
          |FINSI;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|PROCESO BorraMedi;
     |BORRA 020#28a;
|FPRC;

|DEFBUCLE BorraMedi;
     #28#1;
     ;
     #1#0, #1#1, #1#2, 001, 001;
     #1#0, #1#1, #1#2, 999, 999;
     be;
     NULL, BorraMedi;
|FIN;

|PROCESO BorraAstoFact;
   |ABRE #agifa722; |ABRE #agifa704;
   |DDEFECTO #agifa722;
   #agifa722#0 = "FD";         || FACTURA DIRECTA
   #agifa722#1 = #1#4;  || SERIE FACTURA CERTIFICACION
   aDato1 = #agifa722#1;
   aDato2 = #1#5;
   #agifa722#2 = aDato2;        || NUMERO FACTURA CERTIFICACION
   aDato2 = #agifa722#2;
   |LEE 000#agifa722.];
   |SI FSalida = 0; |Y #agifa722#0 = "FD"; |Y #agifa722#1 = aDato1;
   |Y #agifa722#2 = aDato2;
      #agifa704#0 = #agifa722#10;
      |LEE 000#agifa704.=;
      |SI FSalida = 0;
         aAlfa = #agifa704#6; |QBF aAlfa;
         aAlfa = aAlfa + "def/caenlace.mas";
         |CARGA_DEF aAlfa, caenlac@;
         |SI FSalida = 0;
            aAlfa = #agifa704#6; |QBF aAlfa;
            aAlfa = aAlfa + "fich/" + (("00000" + #agifa722#8) % -105) + #agifa722#9 + "/";
            |PATH_DAT #caenlac@#aAlfa#;

            aAlfa = "pu" + Usuario; |NOME_DAT #caenlac@#aAlfa#;
            |DELINDEX #caenlac@; |ABRE #caenlac@;

            nDiario = #agifa722#4;
            fFecha  = #agifa722#5;
            nDocum  = #agifa722#6;
            |BORRA 020#agifa722.a;

            |DDEFECTO #caenlac@;
            #caenlac@#37 = #agifa722#8;
            #caenlac@#38 = #agifa722#9;
            #caenlac@#0 = #agifa722#4;
            #caenlac@#1 = #agifa722#5;
            #caenlac@#2 = #agifa722#6;
            #caenlac@#3 = 0;
            #caenlac@#9 = 0;
            #caenlac@#25 = "S";
            |GRABA 020#caenlac@.n;

            |HAZ CogeVersion;
            aAlfa = #agifa704#6; |QBF aAlfa;
            aAlfa = aAlfa + "fich/" + (("00000" + #agifa722#8) % -105) + #agifa722#9 + "/";
            fich_alta = aAlfa;
            aAlfa1 = #agifa704#6; |QBF aAlfa1;
            aAlfa1 = aAlfa1 - "contagen";
            |SI FSalida ! 0;
               aAlfa1 = ":contagen/dsapunte.tab;";
            |SINO;
               aAlfa1 = ":agicont/dsapunte.tab;";
            |FINSI;
            enNoModif = 100;
            aAlfa = aAlfa1 + aAlfa + ",pu" + Usuario;

            |CIERRA #caenlac@; |DESCARGA_DEF #caenlac@;
            |SUB_EJECUTA_NP aAlfa;
         |FINSI;
      |FINSI;
   |FINSI;
   |CIERRA #agifa704; |CIERRA #agifa722;
|FPRC;

|PROCESO BorraAsto;
   aAlfa = #goparame#84; |QBF aAlfa;
   aAlfa = aAlfa + "def/caenlace.mas";
   |CARGA_DEF aAlfa, caenlac@;
   |SI FSalida = 0;
      aAlfa = #goparame#84; |QBF aAlfa;
      aAlfa = aAlfa + "fich/" + (("00000" + #goparame#85) % -105) + #goparame#86 + "/";
      |PATH_DAT #caenlac@#aAlfa#;
      aAlfa = "pu" + Usuario; |NOME_DAT #caenlac@#aAlfa#;
      |DELINDEX #caenlac@; |ABRE #caenlac@;
      |ABRE #agifa722;
      #agifa722#0 = "CE";         || TIPO PARA CERTIFICACIONES
      #agifa722#1 = #1#0;  || SERIE PRESUPUESTO
      aAlfa = (("000000" + #1#1) % -106) + (("000" + #1#2) % -103);
      #agifa722#2 = aAlfa;        || NUMERO PRESUPUESTO + LINEA CERTIF
      #agifa722#3 = #1#3;  || FECHA FACTURA
      #agifa722#11 = 1;
      #agifa722#8 = #goparame#85;
      #agifa722#9 = #goparame#86;
      |LEE 000#agifa722.=;
      |SI FSalida = 0;
           nDiario = #agifa722#4;
           fFecha  = #agifa722#5;
           nDocum  = #agifa722#6;
           |BORRA 020#agifa722.a;

           |DDEFECTO #caenlac@;
           #caenlac@#37 = #agifa722#8;
           #caenlac@#38 = #agifa722#9;
           #caenlac@#0 = #agifa722#4;
           #caenlac@#1 = #agifa722#5;
           #caenlac@#2 = #agifa722#6;
           #caenlac@#3 = 0;
           #caenlac@#9 = 0;
           #caenlac@#25 = "S";
           #caenlac@#37 = #goparame#85;
           #caenlac@#38 = #goparame#86;
           |GRABA 020#caenlac@.n;
      |SINO;
           nSwError = 1;
      |FINSI;

      |SI nSwError = 0;
           |HAZ CogeVersion;
           aAlfa = #goparame#84; |QBF aAlfa;
           aAlfa = aAlfa + "fich/" + (("00000" + #goparame#85) % -105) + #goparame#86 + "/";
           fich_alta = aAlfa;
           aAlfa1 = #goparame#84; |QBF aAlfa1;
           aAlfa1 = aAlfa1 - "contagen";
           |SI FSalida ! 0;
                aAlfa1 = ":contagen/dsapunte.tab;";
           |SINO;
                aAlfa1 = ":agicont/dsapunte.tab;";
           |FINSI;
           enNoModif = 100;
           aAlfa = aAlfa1 + aAlfa + ",pu" + Usuario;

           |CIERRA #caenlac@;
           |SUB_EJECUTA_NP aAlfa;
           |ABRE #caenlac@; |LEE 000#caenlac@.c;
      |FINSI;
      |CIERRA #agifa722;
      |CIERRA #caenlac@; |DESCARGA_DEF #caenlac@;
   |FINSI;
|FPRC;

|PROCESO Baja; |TIPO 2;
     nModo = (FEntrada/100)!0;
     nTipo = 0 +. 1;
     |ABRE #100; |LEE 000#100p; |CIERRA #100;
     |SI nModo = 3;
          |SI #1#25 = "S";
               |MENAV "0000Linea aprobada...";
               |ERROR; |ACABA;
          |FINSI;
          |SI #1#7 = "S";
               |MENAV "0000Linea facturada...";
               |ERROR; |ACABA;
          |FINSI;
          |SI #0#15 ! "A";
               |ABRE #3;
               |BUCLE BorraPart;
               |CIERRA #3;
          |SINO;
               |ABRE #25;
               |BUCLE BorraAdmi;
               |CIERRA #25;
          |FINSI;
          |BUCLE BorraMedi;
          |HAZ BorraAsto;
     |FINSI;
     |SI nModo ! 3;
          |SI #100#104 = "S";
               |SI #1#20 ! #1#6;
                    |MENAV "0000AVISO: Coste certificacion distinto al total bruto";
               |FINSI;
          |FINSI;
     |FINSI;

     |SI nModo = 2;
          |SI #0#15 = "A";
               |C_M #1#8, 1, "N";
               |C_M #1#9, 1, "N";
          |FINSI;

          ||C_M #1#3, 1, "N";
     |FINSI;

     #0#17 = #0#17 +. #1#15;
     #0#18 = (#0#17*100)/#0#11;
     |PINTA #0#17;
     |PINTA #0#18;
     || si el n§ factura= 0 no esta facturada
     |SI #1#5 = 0; |Y nTipo = 1; #1#7 = "N"; |FINSI;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO MiraFecha;
     |SI fFecIni ] #1#8; |Y fFecIni [ #1#9;
          nHay = 1;
     |FINSI;
|FPRC;
-------------------------------------------------------------------------------
|DEFBUCLE MiraFecha;
     #1#1;
     ;                                          ||Campos Extras.
     #0#0, #0#1,   1;
     #0#0, #0#1, 999;
     ;                                          ||b/e Bolqueo-Ordenacion.
     NULL, MiraFecha;
|FIN;
-------------------------------------------------------------------------------
|PROCESO MiraUlt;
     fFecIni = #1#9;
|FPRC;
-------------------------------------------------------------------------------
|DEFBUCLE MiraUlt;
     #1#1;
     ;                                          ||Campos Extras.
     #0#0, #0#1,   1;
     #0#0, #0#1, 999;
     ;                                          ||b/e Bolqueo-Ordenacion.
     NULL, MiraUlt;
|FIN;
-------------------------------------------------------------------------------

|PROCESO UltFec; |TIPO 7;
     nModo = (FEntrada/100)!0;
     fFecIni = ~;

     |SI nModo = 1; |Y Campo = 8;
          |SALVA_FICHA #1;
          |BUCLE MiraUlt;
          |REPON_FICHA #1;
          #1#8 = fFecIni + 1;
          |PINTA #1#8;
     |FINSI;

|FPRC;
-------------------------------------------------------------------------------
|PROCESO MirFec; |TIPO 0;
     nModo = (FEntrada/100)!0;
     nHay = 0;
     |SI nModo = 1; |Y Campo = 8;
          |SALVA_FICHA #1;
          fFecIni = #1#8;
          |BUCLE MiraFecha;

          |SI nHay = 1;
               |REPON_FICHA #1;
               cTexto = fFecIni;
               cTexto = "0000EXISTE UN PERIDO CON LA FECHA " + cTexto;
               |MENAV cTexto;
               #1#8 = ~;

               |HAZ EsForestales;
               |SI FSalida = 0;
                    || el modulo deja seguir
               |SINO;
                    || *** LA ESTANDAR ***
                    nSwError = 1;
                    |ERROR;
                    |ACABA;
               |FINSI;
          |FINSI;

          |REPON_FICHA #1;
          #1#9 = #1#8 + 1;
     |FINSI;

     |SI Campo = 9; |Y #1#8 > #1#9;
          |MENAV "0000LA FECHA DEBE SE SUPERIOR A LA INICIAL";
          nSwError = 1;
          |ERROR;
          #1#9 = #1#8 + 1;
     |FINSI;
|FPRC;
-------------------------------------------------------------------------------
|PROCESO gocerhis_1;
     #3#0 = #4#0;                                 ||Serie Pres.
     #3#1 = #4#1;                                 ||N.Presupuesto
     #3#2 = #4#14;                                ||Capi
     #3#3 = #4#22;                                 ||Partida
     |LEE 121#3=;
     |SI FSalida = 0;
          #3#13 = #3#13 + #4#10;                  ||Importe Certificado.
          #3#14 = #3#14 + #4#7;                   ||Unidades Certificadas.
          #3#15 = #3#7  - #3#14;                  ||Unidades Pendientes.
          #3#19 = #3#19 - #4#12;                  ||% Pendiente.
          #3#20 = #3#10 - #3#13;                  ||Importe Pendiente.
          |SI #3#15 [  0;
               #3#15 = 0;
               #3#20 = 0;
               #3#19 = 0;
          |FINSI;
          |GRABA 020#3a;
          |LIBERA #3;
     |FINSI;
|FPRC;

|DEFBUCLE gocerhis_1;
     #4#1;
     ;
     #0#0, #0#1, 001, 001;
     #0#0, #0#1, 999, 999;
     ;
     NULL, gocerhis_1;
|FIN;

|PROCESO gopre003_1;
     #3#13 = 0;
     #3#14 = 0;
     #3#15 = #3#7;
     #3#19 = 100;
     #3#20 = #3#10;
     |GRABA 020#3a;
|FPRC;

|DEFBUCLE gopre003_1;
     #3#1;
     ;
     #0#0, #0#1, "                    ", 001;
     #0#0, #0#1, "zzzzzzzzzzzzzzzzzzzz", 999;
     be;
     NULL, gopre003_1;
|FIN;

|PROCESO MiraFacturado;
     |SI #1#7 = "S";
          |ERROR10;
          nSwError = 1;
     |FINSI;
|FPRC;

|PROCESO BajaCer; |TIPO 2;  ||CAB
     nModo = (FEntrada/100)!0;
     nSwError = 0;
     nForma = 0 +. 1;

     |ABRE #150;
     #150#0 = #0#0;
     #150#1 = #0#1;
     #150#2 = #0#4;
     #150#3 = #0#5;
     |LEE 000#150=;
     |SI FSalida = 0;
          |SI nForma = -1;
               |MENAV "0000Certificación realizada por certificaciones resumidas...";
          |FINSI;
          |ERROR; |ACABA;
     |FINSI;
     |CIERRA #150;

     |SI nModo = 3;
          |BUCLELIN 2 MiraFacturado #0;
          |SI nSwError = 1;
               |MENAV "0000Hay lineas facturadas...";
               |ERROR; |ACABA;
          |FINSI;
          ||MENAV "0000ATENCION, SE DARAN DE BAJA LAS FACTURAS EMITIDAS";
     |FINSI;
     |SI nForma = -1;
          |ABRE #2;
          #2#0 = #0#0;
          #2#1 = #0#1;
          |LEE 020#2=;
          |SI FSalida = 0; |Y #2#18 ! "A";
               |BUCLE gopre003_1;
               |ABRE #3;
               |BUCLE gocerhis_1;
               |CIERRA #3;
          |FINSI;
          |CIERRA #2;
     |FINSI;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO Borr;
     |HAZ Baja;
     |SI nError ! 1;
          |BORRA 020#1a;
     |FINSI;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO RFactura; |TIPO 0;
     |ABRE #23;
     #23#0 = #0#4;
     #23#1 = #0#5;
     |LEE 000#23=;
     |SI FSalida = 0; |Y #1#7 = "S";
          #1#7 = "N"; |PINTA #1#7;
          |MENAV "0000Subcontrata interna, no se factura...";
     |FINSI;
     |CIERRA #23;

     |C_M #1#4,  1, "N";
     |C_M #1#5,  1, "N";
     |C_M #1#11, 1, "N";
     |C_M #1#13, 1, "N";
     |C_M #1#15, 1, "N";
     nCont = 0;
     |SI Contenido ! #1#7;
          nCont = 1;
          |SI #1#7 = "S";
               ||C_M #1#3,  1, "S";
               |C_M #1#4,  1, "S";
               |C_M #1#5,  1, "S";
               |C_M #1#11, 1, "S";
               |C_M #1#13, 1, "S";
               ||C_M #1#15, 1, "S";
               #1#11 = #0#2;
               #1#12 = #0#3;
               |PINTA #1#11;
               |PINTA #1#12;
          |SINO;
               |CONFI "0000NDesea borrar la factura";
               |SI FSalida = 0;
                    ||C_M #1#3,  1, "N";
                    |C_M #1#4,  1, "N";
                    |C_M #1#5,  1, "N";
                    |C_M #1#11, 1, "N";
                    |C_M #1#13, 1, "N";
                    |C_M #1#15, 1, "N";
                    |PUSHV 10201480;
                    |HAZ BorraFact;

                    |SI nError ! 1;
                         |HAZ BorraAstoFact;
                         #1#4 = "  ";            ||Serie factura
                         #1#5 = 0;               ||Numero factura
                         |POPV;
                         |PINTA #1#4;
                         |PINTA #1#5;
                    |SINO;
                         |ERROR;
                    |FINSI;
               |SINO;
                    |ERROR;
                    #1#7 = "S";
               |FINSI;

          |FINSI;
     |SINO;
          |SI #1#7 = "S";
               |HAZ ImprimeFactura;
          |FINSI;
     |FINSI;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO ImprimeT;
     nAcumulado = nAcumulado + #1#6;
     |SI nAnterior = 0; |Y #1#6 ! 0;
          nAnterior = #1#2;
     |FINSI;
     |PRINT;
     |SI #1#6 ! 0;
          nAnterior = #1#2;
     |FINSI;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO Imprime;
     |PRINT;
|FPRC;
-------------------------------------------------------------------------------
|PROCESO Imprime_Med;
     |PRINT;
|FPRC;
-------------------------------------------------------------------------------
|DEFBUCLE ImprimeT;
     #1#1;
     ;
     #0#0, #0#1, 1;
     #0#0, #0#1, nActual;
     ;
     NULL, ImprimeT;
|FIN;
-----------------------------------------------------------------------------
|PROCESO LinArti;
     |DDEFECTO #19;
     #19#0 = #26#16;
     |LEE 000#19=;
     eaTipo = #19#126; |QBF eaTipo;
     |SI eaTipo ! "O";
          eaTipo = "M";
     |FINSI;
     |HAZ Imprime;
|FPRC;

|DEFBUCLE LinArti;
     #26#1;
     ;                                          ||Campos Extras.
     #1#0, #1#1, #1#2,   1;
     #1#0, #1#1, #1#2, 999;
     ;                                          ||b/e Bolqueo-Ordenacion.
     NULL, LinArti;
|FIN;
-------------------------------------------------------------------------------
|DEFBUCLE medicion;
     #28#1;
     ;                                          ||Campos Extras.
     #4#0, #4#1, #4#2, #4#3,   1;
     #4#0, #4#1, #4#2, #4#3, 999;
     ;                                          ||b/e Bolqueo-Ordenacion.
     NULL, Imprime_Med;
|FIN;
-------------------------------------------------------------------------------
|PROCESO medicion;
     |BUCLE medicion;
|FPRC;
-------------------------------------------------------------------------------
|DEFBUCLE gocerhis_med;
     #4#1;
     ;                                          ||Campos Extras.
     #1#0, #1#1, nLim,   1;
     #1#0, #1#1, #1#2, 999;
     ;                                          ||b/e Bolqueo-Ordenacion.
     NULL, medicion;
|FIN;
-------------------------------------------------------------------------------
|PROCESO gocerhis_med;
     nLim = 1; || Subtiquet nro. 00455.0008 Cliente: 003226
/*
     |SI #gopre001#36 = "M"; |O #gopre001#36 = "R";
          nLim = 1;
     |SINO;
          nLim = #1#2;
     |FINSI;
*/
     |BUCLE gocerhis_med;
|FPRC;
-------------------------------------------------------------------------------
|PROCESO Imprime2;
     #20#0 = #4#4;
     |LEE 000#20=;
     |SI FSalida ! 0; |DDEFECTO #20; |FINSI;

     |SELECT #6#11;               || to este jaleo pa pilla la agrupacion
     #11#0 = #4#0;         || de capitulos
     #11#1 = #4#1;
     #11#12 = #4#14;
     |LEE 000#11=;
     |SI FSalida ! 0; |DDEFECTO #11; |FINSI;
     |SI #11#14 = 0;
          #11#14 = 999;
     |FINSI;
     aLinPartida = #4#22;
     aLinPartida = ("0000" + aLinPartida) % -104;
     |PRINT;
|FPRC;
-------------------------------------------------------------------------------
|DEFBUCLE gocerhis;
     #4#1;
     ;                                          ||Campos Extras.
     #1#0, #1#1, nLim,   1;
     #1#0, #1#1, #1#2, 999;
     ;                                          ||b/e Bloqueo-Ordenacion.
     NULL, Imprime2;
|FIN;
-------------------------------------------------------------------------------
|PROCESO gocerhis;
     nLim = 1; || Subtiquet nro. 00455.0008 Cliente: 003226
/*
     |SI #gopre001#36 = "M";
          nLim = 1;
     |SINO;
          nLim = #1#2;
     |FINSI;
*/
     |BUCLE gocerhis;
|FPRC;
-------------------------------------------------------------------------------
|PROCESO cogecer;
     nNume1 = #222#2;
     nNume2 = nNumCert;
     |SI nNume1 [ nNume2;
          nTotCert = nTotCert + #222#6;
     |FINSI;
|FPRC;
-------------------------------------------------------------------------------
|DEFBUCLE gocerlin;
     #222#1003;
     ;
     #0#0, #0#1, 1;
     #0#0, #0#1, 999;
     ;
     NULL, cogecer;
|FIN;
-------------------------------------------------------------------------------
|PROCESO gocercbe;
     nNumCert = #1#2;
     |DDEF aDef;
     aDef = aDef + "gocerlin";
     |CARGA_DEF aDef, copgocer@;
     nTotCert = 0;
     |SI FSalida = 0;
          |BUCLE gocerlin;
          |DESCARGA_DEF #copgocer@;
     |FINSI;
     #0#12 = #0#11 - nTotCert;
|FPRC;
-------------------------------------------------------------------------------
|DEFBUCLE gopre022;
     #gopre022#1;
     ;
     #0#0, #0#1, 001, 001;
     #0#0, #0#1, 999, 999;
     ;
     NULL, Imprime;
|FIN;

|PROCESO AnyadeCero;
     #gopre021#0 = #0#0;
     #gopre021#1 = #0#1;
     #gopre021#2 = 999;
     #gopre021#3 = "Sin Agrupacion";
     |PRINT;
     nAlgo = 1;
|FPRC;
-------------------------------------------------------------------------------
|DEFBUCLE gopre021;
     #gopre021#1;
     ;
     #0#0, #0#1, 001;
     #0#0, #0#1, 999;
     ;
     NULL, Imprime, , ,AnyadeCero;
|FIN;
-------------------------------------------------------------------------------
|PROCESO Cert_Access_1;
     aRutaLocal = aDirFijo + "certhist.txt";
     aAlfa1 = #48#0;
     aAlfa1 = "00000" + aAlfa1;
     aAlfa1 = aAlfa1 % -105;
     |DBASE aRutaServidor;
     |QBF aRutaServidor;
     aRutaServidor = aRutaServidor + "fich/" + aAlfa1 + "/certhist.txt";
     |XABRE "E", aRutaServidor, nCanal;
     |SI FSalida ! 0;
          |XABRE "W", aRutaServidor, nCanal;
          |XCIERRA nCanal;
     |FINSI;
     |ENVIA_FICHERO aRutaServidor, aRutaLocal;
     |COPIA_FICHERO aRutaServidor, aRutaLocal;
     |RECIBE_FICHERO aRutaServidor, aRutaLocal;
|FPRC;
-------------------------------------------------------------------------------
|PROCESO Cert_Access_2;
     aRutaLocal = aDirFijo + "certhist_tmp.txt";
     aAlfa1 = #48#0;
     aAlfa1 = "00000" + aAlfa1;
     aAlfa1 = aAlfa1 % -105;
     |DBASE aRutaServidor;
     |QBF aRutaServidor;
     aRutaServidor = aRutaServidor + "fich/" + aAlfa1 + "/certhist_tmp.txt";
     |FBORRA aRutaServidor;
     |RECIBE_FICHERO aRutaLocal, aRutaServidor;
     aAlfa1 = aRutaServidor - "_tmp.txt";
     aAlfa1 = aAlfa1 + ".txt";
     |AFEGIR_FICHERO aRutaServidor, aAlfa1;
|FPRC;
-------------------------------------------------------------------------------
|PROCESO gopre100;
     |SI #11#14 ! nCAPITULO_ANT; |O #11#14 = 0;
          nSUBCAPITULO = 0;
          nCAPITULO = nCAPITULO + 1;
     |FINSI;
     |SI #11#14 = 0;
          nSUBCAPITULO = 0;
     |SINO;
          nSUBCAPITULO = nSUBCAPITULO + 1;
     |FINSI;
     nCAPITULO_ANT = #11#14;

     |PRINT;
|FPRC;

|DEFBUCLE gopre100;
     #11#1;
     ;
     #0#0, #0#1, 001;
     #0#0, #0#1, 999;
     ;
     NULL, gopre100;
|FIN;
-------------------------------------------------------------------------------
|PROCESO guerm042;
     nSwMulti = 1;

     |ABRE #6;
     #6#48 = #142#3;
     #6#0 = #142#4;
     |LEE 000#6=;
     |SI FSalida = 0;
          serie = #142#3;
          numero = #142#4;
          |SUB_EJECUTA_NP "agifa086";
     |FINSI;
     |CIERRA #6;
|FPRC;

|DEFBUCLE guerm042;
     #142#1;
     ;
     #1#0, #1#1, #1#2, "     ", 000001;
     #1#0, #1#1, #1#2, "zzzzz", 999999;
     ;
     NULL, guerm042;
|FIN;

|PROCESO ImprimeVenc;
     |SI nIV1 = 0; |Y aFV1 = "";
          nIV1 = #agifa133#2;
          aFV1 = #agifa133#3;
          |ACABA;
     |FINSI;
     |SI nIV2 = 0; |Y aFV2 = "";
          nIV2 = #agifa133#2;
          aFV2 = #agifa133#3;
          |ACABA;
     |FINSI;
     |SI nIV3 = 0; |Y aFV3 = "";
          nIV3 = #agifa133#2;
          aFV3 = #agifa133#3;
          |ACABA;
     |FINSI;
     |SI nIV4 = 0; |Y aFV4 = "";
          nIV4 = #agifa133#2;
          aFV4 = #agifa133#3;
          |ACABA;
     |FINSI;
     |SI nIV5 = 0; |Y aFV5 = "";
          nIV5 = #agifa133#2;
          aFV5 = #agifa133#3;
          |ACABA;
     |FINSI;
     |SI nIV6 = 0; |Y aFV6 = "";
          nIV6 = #agifa133#2;
          aFV6 = #agifa133#3;
          |ACABA;
     |FINSI;
|FPRC;

|DEFBUCLE agifa133;
     #agifa133#1;
     ;
     #1#4, #1#5, 001;
     #1#4, #1#5, 999;
     ;
     NULL, ImprimeVenc;
|FIN;

|PROCESO ConstruyeVenc;
     nIV1 = 0; aFV1 = "";
     nIV2 = 0; aFV2 = "";
     nIV3 = 0; aFV3 = "";
     nIV4 = 0; aFV4 = "";
     nIV5 = 0; aFV5 = "";
     nIV6 = 0; aFV6 = "";
     |BUCLE agifa133;
|FPRC;

|PROCESO gocerdes;
     |PRINT;
|FPRC;

|DEFBUCLE gocerdes;
     #39#1;
     ;
     #1#0, #1#1, #1#2, 01;
     #1#0, #1#1, #1#2, 99;
     ;
     NULL, gocerdes;
|FIN;

|PROCESO ImprimeFactura;
     |ABRE #goparame; |LEE 000#goparame.p; |CIERRA #goparame;

     |SI #100#99 = "S";  || Agrupa Articulos
          |HAZ IniAgrupaArti;
     |FINSI;

     |SI #1#7 = "S";
          |CONFI "0000N IMPRIMIR FACTURA";
          |SI FSalida = 0;
               nSwMulti = 0;       ||Si no hay registros, como antes
               |BUCLE guerm042;    ||modificado Thu Sep  9 11:56:32 CEST 2004
               |SI nSwMulti = 0;
                    serie = #1#4;
                    numero = #1#5;
                    |SUB_EJECUTA_NP "agifa086";
               |FINSI;
          |SINO;
               ||Tiquet 4077.183
               ||Hay que marcar la factura como impresa y generar los recibos, etc
               enSwModoSilencio = 1;
               nSwMulti = 0;
               |BUCLE guerm042;
               |SI nSwMulti = 0;
                    serie = #1#4;
                    numero = #1#5;
                    |SUB_EJECUTA_NP "agifa086";
               |FINSI;
               enSwModoSilencio = 0;
          |FINSI;
     |FINSI;

     |CONFI "0000N IMPRIMIR LISTADO DE COSTE";
     |SI FSalida = 0;
          |HAZ LisCoste;
     |FINSI;

     |CONFI "0000N IMPRIMIR CERTIFICACION";
     |SI FSalida = 0;
          |ABRE #6;
          #6#48 = #1#4;                           ||Serie de Factura.
          #6#0  = #1#5;
          |LEE 000#6=;
          |SI #100#123 = "S"; |Y #6#10 = "N"; |Y #1#7 = "S";
               |LEE 101#6=;
               |SI #41#47 = "S";
                    |SI #41#146 ! "N"; |O #6#73 ! 0;
                         |HAZ CreaRecibos;
                    |FINSI;
               |FINSI;
               #6#10 = "S";
               |GRABA 020#6a;
               |LIBERA #6;
          |FINSI;

          /* FACTURAS */

          ||SI FSalida = 0;
               |ABRE #agifa091;
               #agifa091#0 = #agifa084#8;
               |LEE 000#agifa091.=;
               |CIERRA #agifa091;

               |ABRE #agifa024;
               #agifa024#0 = #agifa084#3;
               |LEE 000#agifa024.=;
               |CIERRA #agifa024;

               |HAZ InfTxt;
               |SI eaInfTxt = "I";
                    |SUB_EJECUTA_NP "goinform;IMPgofaccab";
                    |INFOR "gofaccab";
                    |PRINT;
                    |PIEINF;
                    |FININF;
                    |SUB_EJECUTA_NP "goinform;ENVgofaccab";
               |SINO;
                    |HAZ TXTgofaccab;
               |FINSI;

               |SUB_EJECUTA_NP "goinform;IMPgofacca2"; ||Totales
               |INFOR "gofacca2";
               |PRINT;
               |PIEINF;
               |FININF;
               |SUB_EJECUTA_NP "goinform;ENVgofacca2";

               |SUB_EJECUTA_NP "goinform;IMPgoadmdes";
               |INFOR "goadmdes";
               |PRINT;
               |PIEINF;
               |FININF;
               |SUB_EJECUTA_NP "goinform;ENVgoadmdes";

               |SI #0#15 = "A";
                    |SUB_EJECUTA_NP "goinform;IMPgoadmlin";
                    |INFOR "goadmlin";
                    |ABRE #19;
                    |BUCLE LinArti;
                    |CIERRA #19;
                    |PIEINF;
                    |FININF;
                    |SUB_EJECUTA_NP "goinform;ENVgoadmlin";
               |SINO;
                    |SUB_EJECUTA_NP "goinform;IMPgofaclin";
                    |INFOR "gofaclin";
                    |BUCLELIN 2 Imprime #6;
                    |PIEINF;
                    |FININF;
                    |SUB_EJECUTA_NP "goinform;ENVgofaclin";
               |FINSI;
          ||FINSI;

          /* CERTIFICACIONES */
          |SI #goparame#101 = "S";
               eaTitulo = #1#10;
          |SINO;
               eaTitulo = "CERTIFICACION N§: " + (("000" + #1#2) % -103);
          |FINSI;

          |SUB_EJECUTA_NP "goinform;IMPgocercbe";
          |HAZ gocercbe;
          |INFOR "gocercbe";
          |PRINT;
          |PIEINF;
          |FININF;
          |SUB_EJECUTA_NP "goinform;ENVgocercbe";

          |SUB_EJECUTA_NP "goinform;IMPgocerlin";
          |INFOR "gocerlin";
          |PRINT;
          |PIEINF;
          |FININF;
          |SUB_EJECUTA_NP "goinform;ENVgocerlin";

          |SUB_EJECUTA_NP "goinform;IMPgocerli2";
          |INFOR "gocerli2";
          |PRINT;
          |PIEINF;
          |FININF;
          |SUB_EJECUTA_NP "goinform;ENVgocerli2";

          |SUB_EJECUTA_NP "goinform;IMPgocerli3";
          |INFOR "gocerli3";
          |HAZ CalcuLLSS;
          |PRINT;
          |PIEINF;
          |FININF;
          |SUB_EJECUTA_NP "goinform;ENVgocerli3";

          |SUB_EJECUTA_NP "goinform;IMPgocerlit";
          |INFOR "gocerlit";
          nActual = #1#2;
          |SALVA_FICHA #1;
          nAcumulado = 0;
          nAnterior = 0;
          |BUCLE ImprimeT;
          |REPON_FICHA #1;
          |PIEINF;
          |FININF;
          |SUB_EJECUTA_NP "goinform;ENVgocerlit";

          |SUB_EJECUTA_NP "goinform;IMPgocerdes";
          |INFOR "gocerdes";
          |BUCLE gocerdes;
          |PIEINF;
          |FININF;
          |SUB_EJECUTA_NP "goinform;ENVgocerdes";

          |SI #0#15 = "A";
               |SUB_EJECUTA_NP "goinform;IMPgoadmlin";
               |INFOR "goadmlin";
               |ABRE #19;
               |BUCLE LinArti;
               |CIERRA #19;
               |PIEINF;
               |FININF;
               |SUB_EJECUTA_NP "goinform;ENVgoadmlin";
          |SINO;
               |SUB_EJECUTA_NP "goinform;IMPgocerhis";
               |INFOR "gocerhis";
               |ABRE #11;
               |ABRE #20;
               |HAZ gocerhis;
               |CIERRA #20;
               |CIERRA #11;
               |PIEINF;
               |FININF;
               |SUB_EJECUTA_NP "goinform;ENVgocerhis";
          |FINSI;

          |SUB_EJECUTA_NP "goinform;IMPgocerhi3";
          |INFOR "gocerhi3";
          |ABRE #11;
          |ABRE #20;
          |HAZ gocerhis;
          |CIERRA #20;
          |CIERRA #11;
          |PIEINF;
          |FININF;
          |SUB_EJECUTA_NP "goinform;ENVgocerhi3";

          |SUB_EJECUTA_NP "goinform;IMPgocermed";
          |INFOR "gocermed";
          |HAZ gocerhis_med;
          |PIEINF;
          |FININF;
          |SUB_EJECUTA_NP "goinform;ENVgocermed";

          |HAZ LeeEmpresa;
          |SUB_EJECUTA_NP "goinform;IMPgoempres";
          |INFOR "goempres";
          |PRINT;
          |PIEINF;
          |FININF;
          |SUB_EJECUTA_NP "goinform;ENVgoempres";
          |SUB_EJECUTA_NP "goinform;IMPgoparlin";
          |INFOR "goparlin";
          |ABRE #10;
          #10#0 = #0#0;
          #10#1 = #0#1;
          |LEE 000#10=;
          |SI FSalida = 0;
               |BUCLELIN 2ImpParti#10;
               |PIEINF;
               |FININF;
          |FINSI;
          |CIERRA #10;
          |SUB_EJECUTA_NP "goinform;ENVgoparlin";

          |SUB_EJECUTA_NP "goinform;IMPgoparli2";
          |INFOR "goparli2";
          |ABRE #10;
          #10#0 = #0#0;
          #10#1 = #0#1;
          |LEE 000#10=;
          |SI FSalida = 0;
               |BUCLELIN 2ImpParti#10;
               |PIEINF;
               |FININF;
          |FINSI;
          |CIERRA #10;
          |SUB_EJECUTA_NP "goinform;ENVgoparli2";

          |SUB_EJECUTA_NP "goinform;IMPgoparcab";
          |INFOR "goparcab";
          |PRINT;
          |PIEINF;
          |FININF;
          |SUB_EJECUTA_NP "goinform;ENVgoparcab";

          |SUB_EJECUTA_NP "goinform;IMPgopre021";
          |INFOR "gopre021";
          nAlgo = 0;
          |BUCLE gopre021;
          |SI nAlgo = 0;
               |HAZ AnyadeCero;
          |FINSI;
          |PIEINF;
          |FININF;
          |SUB_EJECUTA_NP "goinform;ENVgopre021";

          |SUB_EJECUTA_NP "goinform;IMPgopre022";
          |INFOR "gopre022";
          |BUCLE gopre022;
          |PIEINF;
          |FININF;
          |SUB_EJECUTA_NP "goinform;ENVgopre022";

          |HAZ Cert_Access_1;

          |SUB_EJECUTA_NP "goinform;IMPgopre100";
          |INFOR "gopre100";
          nCAPITULO = 0;
          nSUBCAPITULO = 0;
          |BUCLE gopre100;
          |PIEINF;
          |FININF;
          |SUB_EJECUTA_NP "goinform;ENVgopre100";

          |SUB_EJECUTA_NP "goinform;IMPgoparca3";
          |INFOR "goparca3";
          |ABRE #33;
          #33#0 = #2#2;
          #33#1 = #2#52;
          |LEE 000#33=;
          |CIERRA #33;
          |PRINT;
          |PIEINF;
          |FININF;
          |SUB_EJECUTA_NP "goinform;ENVgoparca3";

          |SUB_EJECUTA_NP "goinform;IMPgofacven";
          |INFOR "gofacven";
          |HAZ ConstruyeVenc;
          |PRINT;
          |PIEINF;
          |FININF;
          |SUB_EJECUTA_NP "goinform;ENVgofacven";

          |SUB_EJECUTA_NP "goinform;IMPgopielpd";
          |INFOR "gopielpd";
          |PARA i = 126; |SI i [ 137; |HACIENDO i = i + 1;
               eaTexto = #100i; |QBF eaTexto;
               |SI eaTexto ! ""; |ANSI_OEM eaTexto, eaTexto;|PRINT; |FINSI;
          |SIGUE;
          |PIEINF;
          |FININF;
          |SUB_EJECUTA_NP "goinform;ENVgopielpd";

          |SI #0#15 = "A";
               |SUB_EJECUTA_NP "goinform;RUNCERTIFICACIONES";
          |SINO;
               |SUB_EJECUTA_NP "goinform;RUNgoceradm";
          |FINSI;
          |CIERRA #6;

          |HAZ Cert_Access_2;
     |FINSI;

     |SI #100#99 = "S";  || Agrupa Articulos
          |HAZ FinAgrupaArti;
     |FINSI;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO ImpAmp;
     |SI #11#14 = 0;
          #11#14 = 999;
     |FINSI;

     aLinPartida = #gopre003#3;
     aLinPartida = ("0000" + aLinPartida) % -104;

     |PRINT;
     swImp = 1;
/*
     || en certificaciones no voy a sacar la numeracion esa nueva de  partidas
     || que se le metio a Realsa que es por lo que imprimo el goparli2

     aLinImpre = #gopre003#25;
     |QBF aLinImpre;
     |SI aLinImpre = "";
          aLinImpre = #gopre003#3;
     |SINO;
          aAlfa1 = aLinImpre % 101;
          |PARA; |SI aAlfa1 = "0"; |HACIENDO;
               aLinImpre = aLinImpre - "0";
               aAlfa1 = aLinImpre % 101;
          |SIGUE;
     |FINSI;
*/
|FPRC;
-----------------------------------------------------------------------------
|DEFBUCLE ImpAmp;
     #202#1;
     ;
     #12#4, #11#0, #11#1, #11#12,   1;
     #12#4, #11#0, #11#1, #11#12, 999;
     ;
     NULL, ImpAmp;
|FIN;
-----------------------------------------------------------------------------
|PROCESO ImpPartida;
     swImp = 0;
     |BUCLE ImpAmp;

     |SI swImp = 0;
          #202#4 = "Sin descripci¢n";

          |SI #11#14 = 0;
               #11#14 = 999;
          |FINSI;

          aLinPartida = #gopre003#3;
          aLinPartida = ("0000" + aLinPartida) % -104;
          |PRINT;
     |FINSI;
/*
     || en certificaciones no voy a sacar la numeracion esa nueva de  partidas
     || que se le metio a Realsa que es por lo que imprimo el goparli2

     aLinImpre = #gopre003#25;
     |QBF aLinImpre;
     |SI aLinImpre = "";
          aLinImpre = #gopre003#3;
     |SINO;
          aAlfa1 = aLinImpre % 101;
          |PARA; |SI aAlfa1 = "0"; |HACIENDO;
               aLinImpre = aLinImpre - "0";
               aAlfa1 = aLinImpre % 101;
          |SIGUE;
     |FINSI;
*/
|FPRC;
-----------------------------------------------------------------------------
|DEFBUCLE ImpPartida;
     #12#1;
     ;
     #10#0, #10#1, #11#12,   1;
     #10#0, #10#1, #11#12, 999;
     ;
     NULL,ImpPartida;
|FIN;
-----------------------------------------------------------------------------
|PROCESO ImpParti;
     |BUCLE ImpPartida;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO Escape; |TIPO 11;
     |SI FSalida = 1; |Y Campo ! 2;
          |MENAV "0000DEBE COMPLETAR LA LINEA";
          |ERROR;
     |FINSI;
     |SI FSalida = 10;
          |HAZ ImprimeFactura;
          |ERROR;
     |FINSI;
     |SI FSalida = 11;
          |HAZ Presupuesto;
     |FINSI;
     |SI FSalida = 13; ||F5
          |HAZ PintaBases;
          |ERROR;
     |FINSI;
     |SI FSalida = 14; ||F6
          eaSerie = #1#0;
          enNuPre = #1#1;
          enLinea = #1#2;
          |SUB_EJECUTA_NP "gocerdes";
          |ERROR;
     |FINSI;
     |SI FSalida = 1;
          |HAZ QuitaBoton;
     |FINSI;
|FPRC;
-------------------------------------------------------------------------------
|PROCESO CheqTariAdm;
     |ABRE #37; |SELECT #2#37;
     #37#1 = #26#16;
     #37#0 = #1#3;
     |LEE 000#37];
     |SI FSalida ! 0;
          |LEE 000#37];
          |SI FSalida = 0;
               |LEE 000#37a;
          |SINO;
               |LEE 000#37u;
          |FINSI;
     |FINSI;
     |SI FSalida = 0; |Y #37#1 = #26#16;
          |SI #26#8 ! #37#3;
               aAlfa = "0000!!! ATENCION ­­­" + &13 + "PRECIO TARIFA:["+#37#3+"]";
               |MENAV aAlfa;
          |FINSI;
     |SINO;
          |HAZ AltaTarifa;
          #26#8 = #37#3;                 ||Precio Venta.
     |FINSI;
     |CIERRA #37;
|FPRC;

|PROCESO Tipo25_12; |TIPO 12;
|FPRC;

|PROCESO AltaTarifa;
     |DDEFECTO #38;
     #38#0 = #1#3;
     #38#1 = #26#16;
     #38#2 = #25#30;
     |PUSHV 0501 2380;
     |BLANCO 1317 2265;
     |PINPA #0#38;
     |PINDA #0#38;
     |PARA; |SI; |HACIENDO;
          |ENDATOS #1#38;
          |SI #38#0 < #1#3;
               |MENAV "0000Fecha incorrecta...";
          |SINO;
               |SAL;
          |FINSI;
     |SIGUE;
     |POPV;
     |SELECT #1#37;
     #37#0 = #38#0;
     #37#1 = #38#1;
     #37#2 = #38#2;
     #37#3 = #38#3;
     #37#4 = #38#4;
     |GRABA 020#37n;

     |ABRE #36;
     #36#0 = #37#0;
     |GRABA 000#36n;
     |CIERRA #36;
|FPRC;

|PROCESO TarifaAdm;
     |ABRE #37; |SELECT #2#37;
     #37#1 = #26#16;
     #37#0 = #1#3;
     |LEE 000#37];
     |SI FSalida ! 0;
          |LEE 000#37];
          |SI FSalida = 0;
               |LEE 000#37a;
          |SINO;
               |LEE 000#37u;
          |FINSI;
     |FINSI;
     |SI FSalida = 0; |Y #37#1 = #26#16;
          #26#8 = #37#3;                 ||Precio Venta.
     |SINO;
          |HAZ AltaTarifa;
          #26#8 = #37#3;                 ||Precio Venta.
     |FINSI;
     |CIERRA #37;
|FPRC;

|PROCESO BuscaProdu;
     #26#8 = #14#11 / #14#8;
     nSwProdu = 1;
     |ERROR10;
|FPRC;

|DEFBUCLE BuscaProdu;
     #14#3;
     ; ||Se/Pres       Part,                 Arti
     #25#0, #25#1, "                    ", #25#20 ;
     #25#0, #25#1, "zzzzzzzzzzzzzzzzzzzz", #25#20;
     ;
     NULL, BuscaProdu;
|FIN;

|PROCESO ParCapiPres;
     aPartiPres = ""; aParDesPres = ""; aCapiPres = "";
     |ABRE #3;
     #3#0 = #0#0;
     #3#1 = #0#1;
     #3#2 = "";
     #3#3 = 1;
     |LEE 000#3];
     |SI FSalida = 0; |Y #3#0 = #0#0; |Y #3#1 = #0#1;
          aPartiPres = #3#4;
          aParDesPres = #3#5;
          aCapiPres = #3#2;
     |FINSI;
     |CIERRA #3;
|FPRC;

|PROCESO Partidas;
     |SI nSwich = 1;
          |DDEFECTO #26;
          #26#0  = #25#0;                         ||Serie Presupuesto.
          #26#1  = #25#1;                         ||Nº Presupuesto.
          #26#2 = #1#2;                           ||Nº Cerificacion.
          nLinea = nLinea + 1;
          #26#3 = nLinea;                         ||Linea.
          |LEE 101#26=;
          |SI FSalida ! 0; |GRABA 020#26b; |FINSI;
          #26#14 = #25#33;
          #26#15 = #25#28;                             ||Fecha Documento.
          #26#16 = #25#20;                             ||Articulo.
          #26#8 = #25#11;                    ||Precio Venta.
          |SI #100#100 = "S";
               #26#8 = #25#12;               ||Precio Coste
          |FINSI;

          |SI #100#70 = "A"; |Y #100#100 = "S"; |Y #25#34 = "T";
               || Tiquet 2805/1765
               #26#8 = #25#11;
          |FINSI;

          |SI #100#70 = "A";
               |SI #26#8 = 0;
                    |DDEFECTO #19;
                    |ABRE #19;
                    #19#0 = #25#20;
                    |LEE 000#19=;
                    |CIERRA #19;
                    #26#8 = #19#18; ||PVP1
                    |SI #26#8 = 0;
                         #26#8 = #25#12;
                         aAlfa = "0000El articulo [" + #25#20 + "] no tiene precio venta, se aplica el precio compra.";
                         |MENAV aAlfa;
                    |FINSI;
               |FINSI;
          |SINO;
               nSwProdu = 0;
               |BUCLE BuscaProdu;
               |SI nSwProdu = 0;
                    aAlfa = "0000El articulo [" + #25#20 + "]"+&13+"no esta en el presupuesto...";
                    |MENAV aAlfa;
               |FINSI;
          |FINSI;
          #26#17 = #25#30;                             ||Descripcion Articulo.
          ||ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
          |SI #100#70 = "S";
                |HAZ TarifaAdm;
          |FINSI;
          ||ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
          #26#12 = 100;                                ||Tanto Porcien.
          #26#4  = #25#8;                              ||Partida.
          #26#5  = #25#9;                              ||Desc. Partida.
          #26#18 = #26#18 + #25#10;                    ||Cantidad.
          #26#9  = #26#18 * #26#8;                     ||Importe.
          #26#10 = #26#9 ;                             ||Importe Certificado.
          #26#19 = #25#29;                             ||Tipo Articulo.

          #26#23 = #25#34;
          #26#24 = #25#4;
          #26#25 = #25#5;
          #26#26 = #25#6;
          #26#27 = #25#7;

          || Si la partida o capitulo = "" se pone el 1§ del presupuesto
          || Tiquet 004077/45
          aAlfa = #26#4; |QBF aAlfa;
          |SI aAlfa = ""; #26#4 = aPartiPres; #26#5 = aParDesPres; |FINSI;
          aAlfa = #26#14; |QBF aAlfa;
          |SI aAlfa = ""; #26#14 = aCapiPres; |FINSI;

          || Si la des. articulo esta vacio pongo la del articulo
          aAlfa = #26#17; |QBF aAlfa;
          |SI aAlfa = "";
               |ABRE #19;
               #19#0 = #26#16; |LEE 000#19=;
               |SI FSalida = 0; #26#17 = #19#1; |FINSI;
               |CIERRA #19;
          |FINSI;

          |GRABA 020#26a
          |LIBERA #26;

          ||#1#6 = #1#6 + (#25#10*#25#11); || Tiquet:003465/76
          #1#6 = #1#6 + (#25#10*#26#8);

          #25#31 = "S";
          |GRABA 020#25a;
          |LIBERA #25;
     |FINSI;
     #0#11 = #0#11 + (#25#10*#25#11);
     nHay = 1;
|FPRC;
------------------------------------------------------------------------------
|DEFBUCLE Partidas;
     #25#3;
     28,31;
     #0#4, #0#5, #0#0, #0#1, dVacio, dVacio, #1#8, "N";
     #0#4, #0#5, #0#0, #0#1, hVacio, hVacio, #1#9, "N";
     be;
     NULL, NULL, NULL, NULL, NULL, Partidas;
     #25#28;
|FIN;

-------------------------------------------------------------------------------
|PROCESO LasLineas; |TIPO 0;
     nSwError = 0;
     |HAZ MirFec;
     |SI nSwError = 0;
          |HAZ Admin;
     |FINSI;
     |SI nSwError = 0;
          |HAZ Alta;
     |FINSI;
|FPRC;

|PROCESO Admin; |TIPO 0;
     nHay = 0;
     |SI #1#7 = "N"; |Y #0#15 = "A";
          nModo = (FEntrada/100)!0;
          nSwich = 1;

          |SI nModo = 1; || Si vuelven atras tiquet:3465/227
               |ABRE #25;
               |BUCLE BorraAdmi;
               |CIERRA #25;
               #1#6 = 0;
               |SI nHay = 1; nSwError = 1; |ACABA; |FINSI;
          |FINSI;

          |SI nModo = 2;
               |CONFI "0000NDESEA ACTUALIZAR LAS LINEAS DE ARTICULOS";
               |SI FSalida = 0;
                    |ABRE #25;
                    |BUCLE BorraAdmi;
                    |CIERRA #25;
                    #1#6 = 0;
                    nSwich = 1;
               |SINO;
                    nSwich = 0;
                    nHay = 1;
               |FINSI;
          |FINSI;
          |HAZ ParCapiPres;
          |ABRE #26;
          |ABRE #3;
          #0#11 = 0;
          nLinea = 0;
          |BUCLE Partidas;
          |CIERRA #3;
          |CIERRA #26;

          |SI nSwich = 1;
               |HAZ CalcCert;
          |FINSI;

          |SI nHay = 0;
               |MENAV "0000NO EXISTEN DATOS EN EL PERIODO SOLICITADO";
               |PTEC 806;
               |ACABA;
          |FINSI;
          |PINTA #1#6;
     |FINSI;
|FPRC;
------------------------------------------------------------------------------
|PROCESO DatFac; |TIPO 0;
     enTiva = #1Campo;
     efFiva = #1#3;
     |HAZ SacaIVA;
     |SI eaDiva = "";
          |MENAV "0000No existe tipo iva para esta fecha...";
          |ERROR; |ACABA;
     |SINO;
          #1#14 = enIva; |PINTA #1#14;
     |FINSI;

     |SI #1#7 = "S";
          |SI FSalida = 2;
               |C_M #1#4, 1, "S";
               |C_M #1#5, 1, "S";
               nCont = 1;
          |FINSI;
     |FINSI;
|FPRC;
-------------------------------------------------------------------------------
|PROCESO MiraFactura; |TIPO 7;
     |SI nCont = 0; |ACABA; |FINSI;
     |SI #1#7 = "N"; |ACABA; |FINSI;

     |C_M #1#15, 1, "S";
     |ENCAMPO #15#1;
     |C_M #1#15, 1, "N";

     aGuarda = FEntrada;
     FEntrada = 100;

     #6#48 = #1#4;
     enSwMenu = 0;
     |ABRE #6;
     |HAZ ContaFD7;
     |CIERRA #6;
     contador = #6#0;
     #1#5 = contador;
     |PINTA #1#5;

     FEntrada = aGuarda;
|FPRC;

     /* COMPROBAMOS SI EXISTE EL NUMERO */

|PROCESO CreaFactura; |TIPO 0;
     |SI FSalida = 2; |ACABA; |FINSI;
     |SI nCont = 0; |ACABA; |FINSI;
     |SI #1#7 = "N"; |ACABA; |FINSI;

     aAlfa = "";
     |ABRE #6;
     #6#48 = #1#4;
     #6#0 = #1#5;
     |LEE 000#6=;
     |SI FSalida = 0;
          aAlfa = "0000Factura directa existente...";
     |FINSI;
     |CIERRA #6;
     |SI #41#26 = "S";
          |ABRE #134;
          #134#49 = #1#4;
          #134#0 = #1#5;
          |LEE 000#134=;
          |SI FSalida = 0;
               aAlfa = "0000Factura Venta existente...";
          |FINSI;
          |CIERRA #134;
     |FINSI;

     |SI aAlfa ! ""; |MENAV aAlfa; |ERROR; |ACABA; |FINSI;

     |ABRE #6;
     #6#0 = #1#5;
     #6#48 = #1#4;
     |LEE 000#6=;
     |SI FSalida = 0;
          |MENAV "0000LA NUMERACION EMPLEADA YA EXISTE";
          |ERROR;
     |SINO;
          |HAZ AltaFact;
          |HAZ ImprimeFactura;
     |FINSI;
     |CIERRA #6;
|FPRC;

|PROCESO cogocerhis;
     #4#2 = #1#2;
     #4#7 = 0;
     #4#9 = 0;
     #4#10 = 0;
     #4#11 = 0;
     #4#12 = 0;
     #4#20 = 0;
     #4#21 = 0;
     |GRABA 020#4n;
     |LIBERA #4;
|FPRC;

|DEFBUCLE cogocerhis;
     #4#1;
     ;                                          ||Campos Extras.
     #1#0, #1#1, nLin,   1;
     #1#0, #1#1, nLin, 999;
     ;                                          ||b/e Bolqueo-Ordenacion.
     NULL, cogocerhis;
|FIN;

|PROCESO CopiCerAnt; |TIPO 0;
     nSal = FSalida;
     |SI nSal = 12;
          nLin = #1#2 - 1;
          |SI nLin > 0;
               |BUCLE cogocerhis;
               |ENTLINEAL #1#4,-4,7,22,1,minimo,maximo;
          |FINSI;
          |ERROR;
     |FINSI;
|FPRC;
ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
|PROCESO RecalDetalle;
     |SI #0#15 = "A";
          |DDEFECTO #25;
          #25#34 = #4#23;
          #25#4 = #4#24;
          #25#5 = #4#25;
          #25#6 = #4#26;
          #25#7 = #4#27;
          |LEE 000#25=;
          |||#1#6 = #1#6 + (#25#10*#25#11); || Tiquet:003465/76
          #1#6 = #1#6 + #4#9;
     |SINO;
          #1#6 = #1#6 + #4#10;
     |FINSI;
|FPRC;

|DEFBUCLE RecalDetalle;
     #4#1;
     ;
     #1#0, #1#1, #1#2, 1;
     #1#0, #1#1, #1#2, 999;
     ;
     NULL, RecalDetalle;
|FIN;

|PROCESO RecalLin;
     #1#6 = 0;
     |ABRE #25;
     |BUCLE RecalDetalle;
     |CIERRA #25;
     |GRABA 020#1a;
     #0#10 = #0#10 + #1#6;
||     |HAZ CalcCert;
|FPRC;

|PROCESO gocercabImp;
     |PRINT;
|FPRC;

|PROCESO FicEnvio;
     |DBASS aAlfa;
     eaFicImpre= aAlfa + "spool/";
     aAlfa = Usuario;
     eaFicImpre = eaFicImpre + aAlfa;
     Impresora = eaFicImpre;
     |IMPRE -77;
     |SI FSalida = 0;
          |INFOR "gocerca0";   ||*Correo
          |SI FSalida = 0;
               |BUCLELIN 2 gocercabImp #0;
               |PIEINF;
               |FININF;
          |FINSI;
          |FINIMP;
     |FINSI;
|FPRC;

|PROCESO Recalcula; |TIPO 3;
     #0#10 = 0;
     |BUCLELIN 2 RecalLin #0;
     |GRABA 020#0a;

     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 1;
        enEvento = 4; eaTipo = "04";
        eaAsunto = "Certificacion Pres. '" + #gocercab#0 + "/" + (("000000" + #gocercab#1) % -106);
        eaAsunto = eaAsunto + "' - Expte. '" + #gocercab#4 + "/" + (("000000" + #gocercab#5) % -106) + "'";
        eaOrigen = Usuario % 0810;
        eaPrograma = "gocercab" + #0#0 + #0#1;
        |HAZ FicEnvio;
        |HAZ EnviaEvento;
     |FINSI;
|FPRC;
ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
|PROCESO ConsuPres0; |TIPO 0;
     |HAZ ConsuPres;
     |SI enNuPre ! 0;
          #0#0 = eaSerie; |PINTA #0#0;
          #0#1 = enNuPre; |PINTA #0#1;
     |FINSI;
|FPRC;

|PROCESO Repre; |TIPO 0;
     |C_M #1#11, 0, aEstado;
     |C_M #1#16, 1, aEstado;
     |C_M #1#23, 1, aEstado;
     |C_M #1#24, 1, aEstado;
     |SI aEstado = "S";
          |ABRE #agifa024;
          #agifa024#0 = #1#11;
          |LEE 000#agifa024.=;
          |SI FSalida = 0;
               #1#16 = #agifa024#25;
               #1#24 = #agifa024#20;
          |FINSI;
          |CIERRA #agifa024;
          #1#23 = #1#3;
     |FINSI;
|FPRC;

|PROCESO Obser; |TIPO 0;
     |SI FSalida = 10;
          |PUSHV 0501 2380;
          |BLANCO 0707 1574;
          |CUADRO 0707 1574;
          |CUADRO 0909 1472;
          |ATRI R;
          |PINTA 0812 , " OBSERVACIONES ";
          |ATRI 0;
          |C_V #1#17, 1, "S";
          |C_V #1#18, 1, "S";
          |C_V #1#19, 1, "S";
          |PINTA #1#17;
          |PINTA #1#18;
          |PINTA #1#19;
        |ET E1;
          |ENCAMPO #17#1;
          |SI FSalida = 2; |VETE E4; |FINSI;
        |ET E2;
          |ENCAMPO #18#1;
          |SI FSalida = 2; |VETE E1; |FINSI;
          |ENCAMPO #19#1;
          |SI FSalida = 2; |VETE E2; |FINSI;
        |ET E4;
          |C_V #1#17, 1, "N";
          |C_V #1#18, 1, "N";
          |C_V #1#19, 1, "N";
          |POPV;
          |ERROR;
     |FINSI;
|FPRC;

|PROCESO PonBoton;
     |ESTADO_CONTROL nBoton, "SHOW";
|FPRC;

|PROCESO QuitaBoton;
     |ESTADO_CONTROL nBoton, "HIDE";
|FPRC;

|PROCESO Tipo8; |TIPO 8;
     |CONTROL_SIMPLE 0, "BOTON,F3 - Modifica Presupuesto", 2425, 2450, F3001;
     nBoton = FSalida;
     |HAZ QuitaBoton;
     |ABRE #41; |LEE 000#41p; |CIERRA #41;
|FPRC;

|PROCESO Tipo9; |TIPO 9;
     |FIN_CONTROL_WINDOWS nBoton;
     |PULSATECLA;
|FPRC;

|PROCESO F3001;
     |PTEC 825;
|FPRC;

|PROCESO Presupuesto;
     |ESTADO_CONTROL nBoton, "HIDE";
     |LIBERA #0;
     |LIBERA #1;
     |CIERRAT #0;
     |CIERRAT #1;
     |PTEC 802;
     |PTEC 811
     aAlfa = "gopre001" + &59 + #0#0 + (("000000" + #0#1) % -106);
     |SUB_EJECUTA aAlfa;
     |ABRET #0;
     |ABRET #1;
     |LEE 101#0=;
     |LEE 101#1=;
     |ESTADO_CONTROL nBoton, "SHOW";
     |ERROR;
|FPRC;

|PROCESO CalcCert0; |TIPO 0;
     |SI FSalida = 10;
          |HAZ CalcCert;
     |FINSI;
|FPRC;

|PROCESO CalcCert;
     |DDEFECTO #gopre001;
     |ABRE #gopre001;
     #gopre001#0 = #gocercab#0;
     #gopre001#1 = #gocercab#1;
     |LEE 000#gopre001.=;
     |CIERRA #gopre001;

     |SI #1#15 = 0;
          #1#20 = #1#6 < #gopre001#45;
     |SINO;
          #1#20 = #1#15 < #gopre001#45;
     |FINSI;
     |PINTA #1#20;
|FPRC;

|PROCESO Def_21_22; |TIPO 7;
     aAlfa = #1#21; |QBT aAlfa;
     aAlfa1 = ("000" + #1#2) % -106;
     |SI aAlfa = ""; #1#21 = aAlfa1; |FINSI;

     aAlfa = #1#22; |QBT aAlfa;
     aAlfa1 = "Del " + #1#8 + " al " + #1#9;
     |SI #1#22 = ""; #1#22 = aAlfa1; |FINSI;
|FPRC;

|PROCESO PreParti; |TIPO 0;
     |SI #100#70 = "S";
          |HAZ CheqTariAdm;
     |FINSI;
     |SI #26Campo ! Contenido; |Y #goparame#100 = "N";
          |ABRE #25;
          #25#34 = #26#23;
          #25#4 = #26#24;
          #25#5 = #26#25;
          #25#6 = #26#26;
          #25#7 = #26#27;
          |LEE 101#25=;
          |SI FSalida = 0;
               #25#11 = #26#8;         ||Precio Venta Trab
               #25#13 = #25#11 * #25#10;||Imp Venta Trab
               #25#22 = #26#8;         ||Precio Venta Base
               #25#24 = #25#22 * #25#10;||Imp Venta Base
               |GRABA 020#25a;
          |FINSI;
          |CIERRA #25;
     |FINSI;
     |HAZ TotaAdm;
|FPRC;

|PROCESO TotaAdm; |TIPO 0;
     #26#9 = #26#8 * #26#18;
     |PINTA #26#9;
|FPRC;


|PROCESO AdmTipo2; |TIPO 2;
     nModo = (FEntrada/100)!0;
     nForma = 0 +. 1;
     |SI nModo ! 1;
          eaParti = #26#4;
          eaCapi = #26#14;
          enNumCer = #26#2;
          |HAZ TieneCerti;
          |SI FSalida ! 0;
               |SI nForma = -1;
                    |MENAV "0000NO SE PUEDE MODIFICAR PORQUE EXISTEN MEDICIONES POSTERIORES";
                    |MENAV "0000SE DEBERAN DAR DEBAJA ESTAS ESTAS MEDICIONES.";
               |FINSI;
               |ERROR; |ACABA;
          |FINSI;
     |FINSI;

     #0#10 = #0#10 +. #26#9;

     #1#6 = #1#6 +. #26#9;

     |HAZ CalcCert;
     |PINTA #0#10;

     aAlfa = ("0000" + nPos) % -104;
     aAlfa = aAlfa % 102;
     aAlfa = aAlfa + "69";
     nPos = aAlfa;
     |ATRI R; |PINTA nPos, #1#6; |ATRI 0;

     |SI nModo = 3;
          |ABRE #25;
          #25#34 = #26#23;
          #25#4 = #26#24;
          #25#5 = #26#25;
          #25#6 = #26#26;
          #25#7 = #26#27;
          |LEE 121#25=;
          |SI FSalida = 0;
               #25#31 = "N";
               |GRABA 020#25a;
               |LIBERA #25;
          |FINSI;
          |CIERRA #25;
     |FINSI;
|FPRC;

|PROCESO NoCtrlC; |TIPO 11;
     |SI FSalida = 7;
          |AVISO;
          |ERROR;
     |FINSI;
|FPRC;

|PROCESO AcumuBase;
     #6#48 = #142#3;
     #6#0 = #142#4;
     |LEE 000#6=;
     |SI FSalida = 0;
          nBase = nBase + #6#16 + #6#19 + #6#22 + #6#42 + #6#46;
          nExenta = nExenta + #6#28;
     |FINSI;
|FPRC;

|DEFBUCLE AcumuBase;
     #142#1;
     ;
     #1#0, #1#1, #1#2, "     ", 000001;
     #1#0, #1#1, #1#2, "zzzzz", 999999;
     ;
     NULL, AcumuBase;
|FIN;

|PROCESO PintaBases;
     |PUSHV 05012380;
     aGuarda = #1#6;
     nBase = 0;
     nExenta = 0;
     |ABRE #6;
     |BUCLE AcumuBase;
     |CIERRA #6;
     |BLANCO 0841 1472;
     |CUADRO 0841 1472;
     |CUADRO 0942 1371;
     |ATRI I; |PINTA  0843, "BASES DE FACTURA "; |ATRI 0;
     |PINTA  1044, "Base.......:";
     |PINTA  1144, "Base Exenta:";
     #1#6 = nBase; |PINTA 1058, #1#6;
     #1#6 = nExenta; |PINTA 1158, #1#6;
     #1#6 = nGuarda;
     |PAUSA;
     |POPV;
|FPRC;

|PROCESO MiraCerrado; |TIPO O;
     nModo = (FEntrada / 100) ! 0;
     efFecha = #1#3;
     |HAZ EstaCerrado;
     |SI FSalida = 0;
          |ERROR; |ACABA;
     |FINSI;
|FPRC;


|PROCESO AcumBrutoACert;
     |SI #1#2 ! nLinCer;
          nTotalYACert = nTotalYACert + #1#6;
     |FINSI;
     nTotalACert = nTotalACert + #1#6;
|FPRC;

|DEFBUCLE AcumBrutoACert;
     #1#1;
     ;
     aSerPres, nNumPres, 1;
     aSerPres, nNumPres, nLinCer;
     ;
     NULL, AcumBrutoACert;
|FIN;

|PROCESO ImporteACert; || migue
     |ABRE #gopre001;
     #gopre001#0 = #1#0;
     #gopre001#1 = #1#1;
     |LEE 000#gopre001.=;
     |CIERRA #gopre001;

                                            || 106 gopre002
     |SI #1#15 ! 0;                  || 101 gocerlin
          nMiPrecio = #1#15;           || 5 agifa069
                                            || 105 gopre001
     |SINO;
               aSerPres = #1#0;
               nNumPres = #1#1;
               nLinCer = #1#2;
               nTotalYACert = 0;
               nTotalACert = 0;

               |SALVA_FICHA #1;
               |BUCLE AcumBrutoACert;
               |REPON_FICHA #1;

               nPrecio = nTotalACert;
               nPrecio44 = 0;
               nTotal    = 0;
               nPrecio31 = 0;
               nPrecio32 = 0;
               nPrecio33 = 0;
               nMiPrecio = 0;
               |SI #goparame#100 = "S";
                    nBene = #1#26;
               |SINO;
                    nBene = #gopre001#27;
               |FINSI;

               nPrecio44 = (nPrecio % #gopre001#43) ! 2;
               nTotal = nPrecio - nPrecio44;
               nPrecio31 = (nTotal % #gopre001#26) ! 2;
               nPrecio32 = (nTotal % nBene) ! 2;
               nTotal = nTotal + nPrecio31 + nPrecio32;
               nPrecio33 = (nTotal % #gopre001#28) ! 2;
               nTotal = nTotal - nPrecio33;

               nPrecio = nTotalYACert;
               nPrecio44 = 0;
               nTotalYACalc = 0;
               nPrecio31 = 0;
               nPrecio32 = 0;
               nPrecio33 = 0;

               nPrecio44 = (nPrecio % #gopre001#43) ! 2;
               nTotalYACalc = nPrecio - nPrecio44;
               nPrecio31 = (nTotalYACalc % #gopre001#26) ! 2;
               nPrecio32 = (nTotalYACalc % nBene) ! 2;
               nTotalYACalc = nTotalYACalc + nPrecio31 + nPrecio32;
               nPrecio33 = (nTotalYACalc % #gopre001#28) ! 2;
               nTotalYACalc = nTotalYACalc - nPrecio33;

               nMiPrecio = nTotal - nTotalYACalc;
          ||FINSI;
     |FINSI;
|FPRC;

|PROCESO guerm041;
||ARA
     |ABRE #agifa024;
     |DDEFECTO #agifa024;
     #agifa024#0 = #guerm041#3;
     |LEE 000#agifa024.=;
     |SI FSalida ! 0; |DDEFECTO #agifa024; |FINSI;

     aCodigoCli = #agifa024#0;
     aCuentaCli = #agifa024#16;
     |QBF aCuentaCli;
     |QBF aCodigoCli;
     |CIERRA #agifa024;

     |DDEFECTO #caenlac@;
     #caenlac@#0 = nDiario;
     #caenlac@#1 = fFecha;
     #caenlac@#2 = nDocum;
     nLinea = nLinea + 10;
     #caenlac@#3 = nLinea;

     aAlfa = #gocerenc#3;
     |QBF aAlfa;
     |SI aAlfa = "CLI";
          aCuenta = aCuentaCli;
     |SINO;
          aAlfa = aAlfa % -103;
          |SI aAlfa = "COD";
               aAlfa = #gocerenc#3;
               |QBF aAlfa;
               aAlfa = aAlfa - "COD";
               aAlfa = aAlfa + aCodigoCli;
               aCuenta = aAlfa;
          |SINO;
               aCuenta = #gocerenc#3;
          |FINSI;
     |FINSI;
     #caenlac@#4 = aCuenta;

     #caenlac@#5 = 0;
     #caenlac@#6 = #gocerenc#5;
     aAlfa = #gocerenc#6; |QBF aAlfa;
     |SI #gocerenc#9  = "S";
          aAlfa = aAlfa + " " + #1#0; |QBF aAlfa;
          aAlfa1 = #1#1; aAlfa1 = "000000" + aAlfa1; aAlfa1 = aAlfa1 % -106;
          aAlfa = aAlfa + " " + aAlfa1;
          aAlfa1 = #1#2; aAlfa1 = "000" + aAlfa1; aAlfa1 = aAlfa1 % -103;
          aAlfa = aAlfa + " " + aAlfa1;
     |FINSI;
     #caenlac@#7 = aAlfa;
     #caenlac@#8 = "D";

     nSumaPor = nSumaPor + #guerm041#5;
     |SI nSumaPor = nTotalPor;
          nAux = (nMiPrecio - nSumaImp) ! 2;
     |SINO;
          nAux = (nMiPrecio % #guerm041#5) ! 2;
     |FINSI;
     nSumaImp = nSumaImp + nAux;

     #caenlac@#9 = nAux;
     #caenlac@#37 = #goparame#85;
     #caenlac@#38 = #goparame#86;
     |GRABA 020#caenlac@.n;
|FPRC;

|DEFBUCLE guerm041;
 #guerm041#1;
 ;
 #gocercab#4, #gocercab#5, 001;
 #gocercab#4, #gocercab#5, 999;
 ;
 NULL, guerm041;
|FIN;

|PROCESO Asiento;
     |HAZ ImporteACert;

     |ABRE #gocerenc;
     |LEE 000#gocerenc.p;
     |SI FSalida ! 0;
          |MENAV "    Enlace contable para certificaciones NO definido";
          |CIERRA #gocerenc;
     |FINSI;

     |ABRE #goparame;
     |LEE 000#goparame.p;
     |SI FSalida ! 0;
          |MENAV "    Control de defectos inexistente.";
          |CIERRA #goparame; |CIERRA #gocerenc; |ACABA;
     |FINSI;

     aCuenta = "";
     |ABRE #agifa024;
     #agifa024#0 = #gopre001#2;
     |LEE 000#agifa024.=;
     |SI FSalida = 0;
          aCodigoCli = #gopre001#2;
          aCuentaCli = #agifa024#16;
          |QBF aCuentaCli;
          |QBF aCodigoCli;
     |FINSI;
     |CIERRA #agifa024;

     aAlfa = #goparame#84; |QBF aAlfa;
     aAlfa = aAlfa + "def/caenlace.mas";
     |CARGA_DEF aAlfa, caenlac@;
     |SI FSalida = 0;
          aAlfa = #goparame#84; |QBF aAlfa;
          aAlfa = aAlfa + "def/caconasi.mas";
          |CARGA_DEF aAlfa, caconas@;
          |SI FSalida = 0;
               aAlfa = #goparame#84; |QBF aAlfa;
               aAlfa = aAlfa + "def/camaasic.mas";
               |CARGA_DEF aAlfa, camasic@;
               |SI FSalida = 0;
                    aAlfa = #goparame#84; |QBF aAlfa;
                    aAlfa = aAlfa + "fich/" + (("00000" + #goparame#85) % -105) + #goparame#86 + "/";
                    |PATH_DAT #caenlac@#aAlfa#; |PATH_DAT #camasic@#aAlfa#;
                    |PATH_DAT #caconas@#aAlfa#;
                    aAlfa = "pu" + Usuario; |QBF aAlfa; |NOME_DAT #caenlac@#aAlfa#;
                    |DELINDEX #caenlac@; |ABRE #caenlac@;
                    |ABRE #caconas@; |ABRE #camasic@; |ABRE #agifa722;

                    nSwError = 0;
                    |SI #1#25 = "N";
                         #agifa722#0 = "CE";         || TIPO PARA CERTIFICACIONES
                         #agifa722#1 = #1#0;  || SERIE PRESUPUESTO
                         aAlfa = (("000000" + #1#1) % -106) + (("000" + #1#2) % -103);
                         #agifa722#2 = aAlfa;        || NUMERO PRESUPUESTO + LINEA CERTIF
                         #agifa722#3 = #1#3;  || FECHA FACTURA
                         #agifa722#11 = 1;
                         #agifa722#8 = #goparame#85;
                         #agifa722#9 = #goparame#86;
                         |LEE 000#agifa722.=;
                         |SI FSalida = 0;
                              nDiario = #agifa722#4;
                              fFecha  = #agifa722#5;
                              nDocum  = #agifa722#6;
                              |BORRA 020#agifa722.a;

                              |DDEFECTO #caenlac@;
                              #caenlac@#37 = #agifa722#8;
                              #caenlac@#38 = #agifa722#9;
                              #caenlac@#0 = #agifa722#4;
                              #caenlac@#1 = #agifa722#5;
                              #caenlac@#2 = #agifa722#6;
                              #caenlac@#3 = 0;
                              #caenlac@#9 = 0;
                              #caenlac@#25 = "S";
                              #caenlac@#37 = #goparame#85;
                              #caenlac@#38 = #goparame#86;
                              |GRABA 020#caenlac@.n;
                         |SINO;
                              nSwError = 1;
                         |FINSI;
                    |SINO;
                         nDiario = #gocerenc#7;
                         fFecha  = #1#3;

                         |LEE 101#caconas@.p;
                         |SI FSalida ! 0;
                              |DDEFECTO #caconas@;
                              |GRABA 020#caconas@.n;
                              |LEE 101#caconas@.p;
                         |FINSI;

                         #caconas@#1 = #caconas@#1 + 1;
                         aAlfa = "|NC"; nCalc = #caconas@#aAlfa#;
                         |SI nCalc > 2; #caconas@#2 = #caconas@#2 + 1; |FINSI;
                         nDocum = #caconas@#1;

                         |GRABA 020#caconas@.a;
                         |LIBERA #caconas@;

                         #camasic@#0 = nDiario;
                         #camasic@#1 = fFecha;
                         #camasic@#2 = nDocum;
                         |LEE 000#camasic@.=;
                         |SI FSalida = 0;
                              #camasic@#0 = nDiario;
                              #camasic@#1 = fFecha;
                              #camasic@#2 = 999999;
                              |LEE 000#camasic@.];
                              |SI FSalida = 0;
                                   |SI #camasic@#0 = nDiario; |Y #camasic@#1 = fFecha;
                                        nDocum = 1;
                                   |SINO;
                                        |LEE 000#camasic@.a;
                                        |SI FSalida = 0;
                                             |SI #camasic@#0 = nDiario; |Y #camasic@#1 = fFecha;
                                                  nDocum = #camasic@#2 + 1;
                                             |SINO;
                                                  nDocum = 1;
                                             |FINSI;
                                        |SINO;
                                             nDocum = 1;
                                        |FINSI;
                                   |FINSI;
                              |SINO;
                                   |LEE 000#camasic@.u;
                                   |SI FSalida = 0;
                                        |SI #camasic@#0 = nDiario; |Y #camasic@#1 = fFecha;
                                             nDocum = #camasic@#2 + 1;
                                        |SINO;
                                             nDocum = 1;
                                        |FINSI;
                                   |SINO;
                                        nDocum = 1;
                                   |FINSI;
                              |FINSI;
                         |FINSI;

                         |DDEFECTO #agifa722;
                         #agifa722#0 = "CE";         || TIPO PARA CERTIFICACIONES
                         #agifa722#1 = #1#0;  || SERIE PRESUPUESTO
                         aAlfa = (("000000" + #1#1) % -106) + (("000" + #1#2) % -103);
                         #agifa722#2 = aAlfa;        || NUMERO PRESUPUESTO + LINEA CERTIF
                         #agifa722#3 = #1#3;  || FECHA FACTURA
                         #agifa722#11 = 1;
                         #agifa722#8 = #goparame#85;
                         #agifa722#9 = #goparame#86;
                         |LEE 000#agifa722.=;
                         |SI FSalida = 0;
                              nSwError = 1;
                         |SINO;
                              |DDEFECTO #agifa722;
                              #agifa722#0 = "CE";         || TIPO PARA CERTIFICACIONES
                              #agifa722#1 = #1#0;  || SERIE PRESUPUESTO
                              aAlfa = (("000000" + #1#1) % -106) + (("000" + #1#2) % -103);
                              #agifa722#2 = aAlfa;        || NUMERO PRESUPUESTO + LINEA CERTIF
                              #agifa722#3 = #1#3;  || FECHA FACTURA
                              #agifa722#4 = nDiario;
                              #agifa722#5 = fFecha;
                              #agifa722#6 = nDocum;
                              #agifa722#7 = 10;
                              #agifa722#8 = #goparame#85;
                              #agifa722#9 = #goparame#86;
                              #agifa722#11 = 1;
                              |GRABA 020#agifa722.n;

                              ||ARA.
                              ||TODO CCC.

                              nLinea = 0;

                              |ABRE #guerm040;
                              |DDEFECTO #guerm040;
                              #guerm040#0 = #gocercab#4;
                              #guerm040#1 = #gocercab#5;
                              |LEE 000#guerm040.=;
                              |SI FSalida = 0;
                                   nTotalPor = #guerm040#2;
                                   nSumaPor = 0;
                                   nSumaImp = 0;
                                   |BUCLE guerm041;
                              |SINO;
                                   |DDEFECTO #caenlac@;
                                   #caenlac@#0 = nDiario;
                                   #caenlac@#1 = fFecha;
                                   #caenlac@#2 = nDocum;
                                   nLinea = nLinea + 10;
                                   #caenlac@#3 = nLinea;

                                   aAlfa = #gocerenc#3;
                                   |QBF aAlfa;
                                   |SI aAlfa = "CLI";
                                        aCuenta = aCuentaCli;
                                   |SINO;
                                        aAlfa = aAlfa % -103;
                                        |SI aAlfa = "COD";
                                             aAlfa = #gocerenc#3;
                                             |QBF aAlfa;
                                             aAlfa = aAlfa - "COD";
                                             aAlfa = aAlfa + aCodigoCli;
                                             aCuenta = aAlfa;
                                        |SINO;
                                             aCuenta = #gocerenc#3;
                                        |FINSI;
                                   |FINSI;
                                   #caenlac@#4 = aCuenta;

                                   #caenlac@#5 = 0;
                                   #caenlac@#6 = #gocerenc#5;
                                   aAlfa = #gocerenc#6; |QBF aAlfa;
                                   |SI #gocerenc#9  = "S";
                                        aAlfa = aAlfa + " " + #1#0; |QBF aAlfa;
                                        aAlfa1 = #1#1; aAlfa1 = "000000" + aAlfa1; aAlfa1 = aAlfa1 % -106;
                                        aAlfa = aAlfa + " " + aAlfa1;
                                        aAlfa1 = #1#2; aAlfa1 = "000" + aAlfa1; aAlfa1 = aAlfa1 % -103;
                                        aAlfa = aAlfa + " " + aAlfa1;
                                   |FINSI;
                                   #caenlac@#7 = aAlfa;
                                   #caenlac@#8 = "D";
                                   #caenlac@#9 = nMiPrecio;      || importe
                                   #caenlac@#37 = #goparame#85;
                                   #caenlac@#38 = #goparame#86;
                                   |GRABA 020#caenlac@.n;
                              |FINSI;
                              |CIERRA #guerm040;

                              |DDEFECTO #caenlac@;
                              #caenlac@#0 = nDiario;
                              #caenlac@#1 = fFecha;
                              #caenlac@#2 = nDocum;
                              nLinea = nLinea + 10;
                              #caenlac@#3 = nLinea;

                              aAlfa = #gocerenc#4;
                              |QBF aAlfa;
                              |SI aAlfa = "CLI";
                                   aCuenta = aCuentaCli;
                              |SINO;
                                   aAlfa = aAlfa % -103;
                                   |SI aAlfa = "COD";
                                        aAlfa = #gocerenc#4;
                                        |QBF aAlfa;
                                        aAlfa = aAlfa - "COD";
                                        aAlfa = aAlfa + aCodigoCli;
                                        aCuenta = aAlfa;
                                   |SINO;
                                        aCuenta = #gocerenc#4;
                                   |FINSI;
                              |FINSI;
                              #caenlac@#4 = aCuenta;

                              #caenlac@#5 = 0;
                              #caenlac@#6 = #gocerenc#5;
                              aAlfa = #gocerenc#6; |QBF aAlfa;
                              |SI #gocerenc#9  = "S";
                                   aAlfa = aAlfa + " " + #1#0; |QBF aAlfa;
                                   aAlfa1 = #1#1; aAlfa1 = "000000" + aAlfa1; aAlfa1 = aAlfa1 % -106;
                                   aAlfa = aAlfa + " " + aAlfa1;
                                   aAlfa1 = #1#2; aAlfa1 = "000" + aAlfa1; aAlfa1 = aAlfa1 % -103;
                                   aAlfa = aAlfa + " " + aAlfa1;
                              |FINSI;
                              ||SI #gotipoho#10 = "S"; aAlfa = aAlfa + " " + #gopaexca#1; |QBF aAlfa; |FINSI;
                              #caenlac@#7 = aAlfa;
                              #caenlac@#8 = "H";
                              #caenlac@#9 = nMiPrecio;      || importe
                              #caenlac@#37 = #goparame#85;
                              #caenlac@#38 = #goparame#86;
                              |GRABA 020#caenlac@.n;
                         |FINSI;
                    |FINSI;

                    |SI nSwError = 0;
                         |HAZ CogeVersion;
                         aAlfa = #goparame#84; |QBF aAlfa;
                         aAlfa = aAlfa + "fich/" + (("00000" + #goparame#85) % -105) + #goparame#86 + "/";
                         fich_alta = aAlfa;
                         aAlfa1 = #goparame#84; |QBF aAlfa1;
                         aAlfa1 = aAlfa1 - "contagen";
                         |SI FSalida ! 0;
                              aAlfa1 = ":contagen/dsapunte.tab;";
                         |SINO;
                              aAlfa1 = ":agicont/dsapunte.tab;";
                         |FINSI;
                         enNoModif = 100;
                         aAlfa = aAlfa1 + aAlfa + ",pu" + Usuario;

                         |CIERRA #caenlac@;
                         |SUB_EJECUTA_NP aAlfa;
                         |ABRE #caenlac@; |LEE 000#caenlac@.c;
                    |FINSI;
                    |CIERRA #agifa722;
                    |CIERRA #camasic@; |DESCARGA_DEF #camasic@;
                    |CIERRA #caconas@; |DESCARGA_DEF #caconas@;
                    |CIERRA #caenlac@; |DELINDEX #caenlac@; |DESCARGA_DEF #caenlac@;
               |FINSI;
          |FINSI;
     |SINO;
          |CIERRA #goparame; |CIERRA #gocerenc; |ACABA;
     |FINSI;

     |CIERRA #gocerenc; |CIERRA #goparame;
|FPRC;

|PROCESO Aprobada; |TIPO 0;
     |ABRE #23;
     #23#0 = #0#4;
     #23#1 = #0#5;
     |LEE 000#23=;
     |SI FSalida = 0; |Y #1#25= "S";
          #1#25 = "N"; |PINTA #1#25;
          |MENAV "0000Subcontrata interna, no se puede aprobar...";
     |FINSI;
     |CIERRA #23;
     |SI #goparame#88 = "S";
          |SI #1#25 = "N";
               |C_M #1#7, 1, "N";
               |HAZ Asiento;
          |SINO;
               |C_M #1#7, 1, "S";
               |GRABA 020#1a;
               |HAZ Asiento;
          |FINSI;
     |SINO;
          |C_M #1#7, 1, "S";
     |FINSI;
|FPRC;

----------------------
|PROCESO Agrupalos;
     #70#0 = #26#0;
     #70#1 = #26#1;
     #70#2 = #26#2;
     #70#4 = #26#4;
     #70#14 = #26#14;
     #70#16 = #26#16;
     #70#15 = "31.12.9999";
     |LEE 000#70];
     |SI FSalida = 0;
          |LEE 000#70a;
     |SINO;
          |LEE 000#70u;
     |FINSI;
     |SI FSalida = 0; |Y #70#0 = #26#0; |Y #70#1 = #26#1; |Y #70#2 = #26#2;
               |Y #70#4 = #26#4; |Y #70#14 = #26#14; |Y #70#16 = #26#16;
               |Y #26#18 < 0;
          #70#7 = #70#7 + #26#7;
          #70#9 = #70#9 + #26#9;
          #70#10 = #70#10 + #26#10;
          #70#11 = #70#11 + #26#11;
          #70#18 = #70#18 + #26#18;
          |SI #70#18 = 0;
               |BORRA 020#70c;
          |SINO;
               |GRABA 020#70a;
          |FINSI;
     |SINO;
          |PARA i = 0; |SI i [ 27; |HACIENDO i = i + 1;
               #70i = #26i;
          |SIGUE;
          |GRABA 020#70n;
     |FINSI;
|FPRC;

|DEFBUCLE Agrupalos;
     #26#1;
     ;
     #1#0, #1#1, #1#2,   1;
     #1#0, #1#1, #1#2, 999;
     ;
     NULL, Agrupalos;
|FIN;

|PROCESO TmpAgrupa;
     |PARA i = 0; |SI i [ 27; |HACIENDO i = i + 1;
          #26i = #70i;
     |SIGUE;
     |GRABA 020#26n;
|FPRC;

|DEFBUCLE TmpAgrupa;
     #70#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, TmpAgrupa;
|FIN;

|PROCESO IniAgrupaArti;
     |HAZ CreaTempo; aTmp70 = Tempo;
     |HAZ CreaTempo; aTmp26 = Tempo;

     |NOME_DAT #70aTmp70; |DELINDEX #70;
     |ABRE #70;
     |SELECT #2#70;
     |BUCLE Agrupalos;
     |CIERRA #70;

     |NOME_DAT #26aTmp26; |DELINDEX #26;
     |ABRE #26;
     |BUCLE TmpAgrupa;
     |CIERRA #26;
     |DELINDEX #70; aTmp70 = Tempo; |HAZ BoraTempo;
|FPRC;

|PROCESO FinAgrupaArti;
     |DELINDEX #26; aTmp26 = Tempo; |HAZ BoraTempo;
     aAlfa = "gocerhis";
     |NOME_DAT #26#aAlfa#;
     |PONCONTROL 23, "SI";
|FPRC;

|PROCESO LisCoste;
     || Cambiado calculo de impresion al programa guerz078
     || porque sino salia mal la impresion del access (no se porque)
     || lunes,  5 de enero de 2009, 07:35:19 CET

     eaSerie = #1#0;
     enNuPre = #1#1;
     enLinea = #1#2;
     |SUB_EJECUTA_NP "guerz078";
|FPRC;

|PROCESO CertiPosterior;
     |SI #gocerhis@#4 = eaParti; |Y #gocerhis@#14 = eaCapi;
          |SI #gocerhis@#7 ! 0;
               nHayCerti = 1;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE CertiPosterior;
     #gocerhis@#1004;
     ;
     #0#0, #0#1, nNumCer, 1;
     #0#0, #0#1, 999, 999;
     ;
     NULL, CertiPosterior;
|FIN;

|PROCESO TieneCerti;
     nHayCerti = 0;
     |DDEF aAlfa; aAlfa = aAlfa + "gocerhis";
     |CARGA_DEF aAlfa, gocerhis@;
     |SI FSalida = 0;
          nNumCer = enNumCer + 1;
          |BUCLE CertiPosterior;
          |DESCARGA_DEF #gocerhis@;
     |FINSI;
     FSalida = nHayCerti;
|FPRC;

|PROCESO IVAlin_66; |TIPO 66;
     enTiva = #1Campo;
     efFiva = #1#3;
     |HAZ ConsuIVA;
     |SI eaDiva = "";
          |ERROR;
     |SINO;
          #0Campo = enTiva; |PINTA #0Campo;
     |FINSI;
|FPRC;

|PROCESO Tipo13; |TIPO 13;
     |ABRE #100; |LEE 000#100p; |CIERRA #100;
     |SI #100#141 = "O";
          |PINTA 602, "O.E........:"; |ATRI 0;
          |PINTA 702, "O.T........:"; |ATRI 0;
     |FINSI;
|FPRC;
