|FICHEROS;
     agifa292 #0;
     agifa293 #1;
     dsm00010 #910;
     agifa142 #142;
     agifa019 #19;
     dsw00032 #32; || Tmp
     dsz00082 #82; || Pantalla Nivel
     agifa292@;
     agifa293a@;
     agifa293b@;
|FIN;

|VARIABLES;
     nSwBorra = 0;
     nNivel = 0;
     nModo = 0;
     nSw = 0;
     &Tempo = "";
     nLin = 0;
     aDef = "";
     aAlfa = "";
     nHay = 0;
     &eaDes = "";
     &enAlta = 0;
     &eaArticulo = "";
     &eAlfa  = "";
     &eAlfa1 = "";
     &eAlfa2 = "";
     &eAlfa3 = "";
     &eAlfa4 = "";
     &eaArtiSeri = "";
     aArtEqui = "";
     aArtPrin = "";
     nPrime = 0;
|FIN;

|PROCESO Calc6292;  |TIPO 6;
     eaArtiSeri = #0Campo;
     |HAZ Seripafer;       ||Modulo 000184
     #0Campo = eaArtiSeri;

     enAlta = 1;
     eaArticulo = #0Campo;
     |HAZ LlenaArticulo;
     |SI FSalida = 0;
          #0Campo = eaArticulo;
          |PINTA #0Campo;
     |SINO;
          |ERROR; |ACABA;
     |FINSI;
|FPRC;

|PROCESO PideArt292;  |TIPO 7;
     |ABRE #910;
     |LEE 040#910p;
     |SI FSalida ! 0;  |DDEFECTO #910;  |FINSI;
     |CIERRA #910;

     |SI #910#2 [ 2;    |ACABA;  |FINSI;

     eAlfa = #0Campo;
     |SUB_EJECUTA_NP "dsz99990";                 || Por Pantalla
     |SI eAlfa = "-1";  |PTEC 807;  |ACABA;  |FINSI;
     |SI eAlfa = "-2";              |ACABA;  |FINSI;

     eaArticulo = eAlfa;      ||  700000-4215

     #0Campo = eAlfa;
     |PINTA #0Campo;
     |PTEC 802;
|FPRC;

|PROCESO Min;
     #1#0 = #0#0;
     #1#1 = 1;
|FPRC;

|PROCESO Max;
     #1#0 = #0#0;
     #1#1 = 99;
|FPRC;

|PROCESO HayLin;
     nHay = 1;
|FPRC;

|DEFBUCLE HayLin;
     #1#1;
     ;
     #0#0, 01;
     #0#0, 99;
     ;
     NULL, HayLin;
|FIN;

|PROGRAMA;
     |SI eaArticulo = "";
          |MANTE #0;
     |SINO;
           |ABRE #0;
           #0#0 = eaArticulo;
           |LEE 101#0=;
           |SI FSalida ! 0; |GRABA 020#0b; |FINSI;
           |PINPA #0#0;
           |PINDA #0#0;
           |ENTLINEAL #1#1, 2, 2, 22, 0, Min, Max;
           |BUCLE HayLin;
           |SI nHay ! 0;
               #0#1 = eaDes;
               |GRABA 020#0a;
           |SINO;
               |BORRA 020#0c;
           |FINSI;
           |CIERRA #0;
     |FINSI;
|FPRO;

|PROCESO Tipo20; |TIPO 20;
     |SI FSalida = "OPCION";
          |ABRE #142; |LEE 000#142p; |CIERRA #142;
          |SI #142#249 = "S";
               FSalida = "G.Equiv.";
          |SINO;
               FSalida = "";  || Sin boton
          |FINSI;
     |SINO;
          |LEE 101#0=;
          |SI FSalida ! 0; |ACABA; |FINSI;
          nSwBorra = 0;
          |HAZ GeneraEquiv;
          |GRABA 020#0a;
     |FINSI;
|FPRC;

|PROCESO Tipo3; |TIPO 3;
     |ABRE #142; |LEE 000#142p; |CIERRA #142;
     |SI #142#249 = "S";
          |CONFI "0000NGenerar Equivalencias inversas";
     |SINO;
          FSalida = -1;
     |FINSI;
     |SI FSalida = 0;
          nSwBorra = 0;
          |HAZ GeneraEquiv;
     |FINSI;
|FPRC;


|PROCESO CheqEquiLin; |TIPO 0;
     nModo = (FEntrada / 100) ! 0;
     |SI #1#2 = #1#0;
          |MENAV "0000Este es el articulo principal...";
          |SI nModo = 1;
               |ERROR; |ACABA;
          |FINSI;
     |FINSI;

     |SI nModo = 1;
          |DDEF aDef;
          aAlfa = aDef + "agifa293";
          |CARGA_DEF aAlfa, agifa293a@;
          |SI FSalida = 0;
               |ABRE #agifa293a@;
               |SELECT #2#agifa293a@;
               #agifa293a@#2 = #1#2;
               #agifa293a@#0 = #1#0;
               |LEE 000#agifa293a@.=;
               |SI FSalida = 0;
                    |MENAV "0000No se puede repetir...";
                    |ERROR;
               |FINSI;
               |CIERRA #agifa293a@;
               |DESCARGA_DEF #agifa293a@;
          |FINSI;
     |FINSI;
|FPRC;
||******************************
|PROCESO Crea;
     |SELECT #2#agifa293b@;
     #agifa293b@#2 = aArtEqui;
     #agifa293b@#0 = aArtPrin;
     |LEE 000#agifa293b@.=;
     |SI FSalida = 0; |ACABA; |FINSI;

     |SELECT #1#agifa293b@;
     #agifa293b@#0 = aArtPrin;
     #agifa293b@#1 = 99;
     |LEE 000#agifa293b@.];
     |SI FSalida = 0;
          |LEE 000#agifa293b@.a;
     |SINO;
          |LEE 000#agifa293b@.u;
     |FINSI;
     |SI FSalida = 0; |Y #agifa293b@#0 = aArtPrin;
          nLin = #agifa293b@#1 + 1;
     |SINO;
          nLin = 1;
     |FINSI;
     |DDEFECTO #agifa293b@;
     #agifa293b@#0 = aArtPrin;
     #agifa293b@#1 = nLin;
     #agifa293b@#2 = aArtEqui;
     |DDEFECTO #19;
     #19#0 = #agifa293b@#2;
     |LEE 000#19=;
     #agifa293b@#3 = #19#1;
     |GRABA 020#agifa293b@.n;

     |DDEFECTO #agifa292@;
     #agifa292@#0 = #agifa293b@#0;
     |LEE 000#agifa292@.=;
     |SI FSalida ! 0;
          |DDEFECTO #19;
          #19#0 = #agifa292@#0;
          |LEE 000#19=;
          #agifa292@#1 = #19#1;
          |GRABA 020#agifa292@.n;
     |FINSI;
|FPRC;

|PROCESO Borra;
     |SELECT #2#agifa293b@;
     #agifa293b@#2 = aArtEqui;
     #agifa293b@#0 = aArtPrin;
     |LEE 101#agifa293b@.=;
     |SI FSalida = 0;
          |BORRA 020#agifa293b@.a;

          |SELECT #1#agifa293b@;
          #agifa293b@#0 = aArtPrin;
          #agifa293b@#1 = 0;
          |LEE 000#agifa293b@.];
          |SI FSalida ! 0; |O #agifa293b@#0 ! aArtPrin;
               #agifa292@#0 = aArtPrin;
               |LEE 101#agifa292@.=;
               |SI FSalida = 0;
                    |BORRA 020#agifa292@.a;
               |FINSI;
               |LIBERA #agifa292@;
          |FINSI;
     |FINSI;
     |LIBERA #agifa293b@;
|FPRC;

|PROCESO CreaEquiva;
     |SI aArtPrin ! aArtEqui;
          nNivel = nNivel + 1;
          |SI nSwBorra = 1;
               |HAZ Borra;
          |SINO;
               |HAZ Crea;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO LinEquiva2;
     |SI nNivel < #0#2;
          |SI nPrime = 0;
               nPrime = 1;
               aArtPrin = #1#2;
               aArtEqui = #1#0;
               |HAZ CreaEquiva;
          |FINSI;
          |SI nNivel < #0#2;
               aArtPrin = #1#2;
               aArtEqui = #agifa293a@#2;
               |HAZ CreaEquiva;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE LinEquiva2;
     #agifa293a@#1002;
     ;
     #1#0, 01;
     #1#0, 99;
     ;
     NULL, LinEquiva2;
|FIN;

|PROCESO LinEquiva1;
     nPrime = 0;
     nNivel = 0;
     |BUCLE LinEquiva2;
|FPRC;

|PROCESO GeneraEquiv;         || Hay una copia en el dsz00082
     |SI nSwBorra = 0;
          |PUSHV 0501 2380;
          #82#0 = 1;
          #82#1 = #0#0;
          #82#2 = #0#1;
          |PINPA #0#82;
          |PINDA #0#82;
          |ENCAMPO #0#82;
          |SI FSalida ! 0; |POPV; |ACABA; |FINSI;
          #0#2 = #82#0; || Nivel
     |FINSI;

     |DDEF aDef;
     aAlfa = aDef + "agifa292";
     |CARGA_DEF aAlfa, agifa292@;
     |SI FSalida = 0;
          aAlfa = aDef + "agifa293";
          |CARGA_DEF aAlfa, agifa293a@;
          |SI FSalida = 0;
               aAlfa = aDef + "agifa293";
               |CARGA_DEF aAlfa, agifa293b@;
               |SI FSalida = 0;
                    |ABRE #agifa292@;
                    |ABRE #agifa293b@;
                    |ABRE #19;
                    |BUCLELIN 0 LinEquiva1 #0;
                    |CIERRA #19;
                    |CIERRA #agifa292@;
                    |CIERRA #agifa293b@;
                    |DESCARGA_DEF #agifa293b@;
               |FINSI;
               |DESCARGA_DEF #agifa293a@;
          |FINSI;
          |DESCARGA_DEF #agifa292@;
     |FINSI;

     |SI nSwBorra = 0; |POPV; |FINSI;
|FPRC;

|PROCESO Tipo2; |TIPO 2;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 3;
          |ABRE #142; |LEE 000#142p; |CIERRA #142;
          |SI #142#249 = "S";
               |CONFI "0000NBorrar Equivalencias inversas generadas?";
          |SINO;
               FSalida = -1;
          |FINSI;
          |SI FSalida = 0;
               nSwBorra = 1;
               |HAZ GeneraEquiv;
          |FINSI;
     |FINSI;
|FPRC;
