|FICHEROS;
     dsz00019 #0;
     dsm00010 #910;
     dsz00020 #20,MANTE;
     dsz00021 #21,MANTE;
     dsz00022 #22,MANTE;
     dsm00071 #71; || Nivel_1
     agifa019 #19;
     agifa017 #17;
     dsm00004 #904;
     dsm00015 #915;
     dsm00016 #916;
     agifa029 #29;
     agifa142 #142;
|FIN;

|VARIABLES;
     &enTiva = 0;
     &efFiva = @;
     &eaDiva = "";
     &enIva = 0;
     &enRec = 0;
     &enSwMalo = 0;
     &eAlfa    = "";
     nNume     = 0;
     aAlfa     = "";
     nBoton1   = 0;
     nBoton2   = 0;
     nBoton3   = 0;
     aTitulo1  = "";
     aTitulo2  = "";
     aTitulo3  = "";
     aEstado   = "";
     nPosi     = 0;
     nSw       = 0;
     aDes1     = "";
     aDes2     = "";
     aDes3     = "";
     aDes4     = "";
     aDes      = "";
     aCod1     = "";
     aCod2     = "";
     aCod3     = "";
     aCod4     = "";
     aCod      = "";
     aBlanco   = "";
     i         = 0;
     j         = 0;
     aDesde    = "";
     aHasta    = "";
     aEspacio  = "";
     nSal = 0;
     nLon = 0;
|FIN;

|PROCESO BorraBlancos;
     |SI #910#10 ! " ";
          |ABRE #20;
          #20#0 = "";
          |BORRA 000#20c;
          |CIERRA #20;
     |FINSI;
     |SI #910#14 ! " ";
          |ABRE #21;
          #21#0 = "";
          |BORRA 000#21c;
          |CIERRA #21;
     |FINSI;
     |SI #910#18 ! " ";
          |ABRE #22;
          #22#0 = "";
          |BORRA 000#22c;
          |CIERRA #22;
     |FINSI;
|FPRC;

|PROCESO Longi; |TIPO 0;
     |SI FSalida = 2; |O FSalida = 3; |ACABA; |FINSI;
     nLon = 0;
     |C_V #0#6, 0, aAlfa; |SI aAlfa = "S"; nLon = nLon + #0#6; |FINSI;
     |C_V #0#7, 0, aAlfa; |SI aAlfa = "S"; nLon = nLon + #0#7; |FINSI;
     |C_V #0#8, 0, aAlfa; |SI aAlfa = "S"; nLon = nLon + #0#8; |FINSI;
     |C_V #0#9, 0, aAlfa; |SI aAlfa = "S"; nLon = nLon + #0#9; |FINSI;
     |SI nLon > 50;
          |MENAV "0000La longitiud no puede superar los 50 caracteres...";
          |ERROR;
     |FINSI;
|FPRC;

|PROCESO CodigoBarra;
     |SI #910#33 = "S";
         eAlfa = #19#0;
         |SUB_EJECUTA_NP "dsz99990;B";
         #19#128 = eAlfa;
     |SINO;
         #19#128 = #19#0;
     |FINSI;
|FPRC;

|PROCESO dsm00016;
     |DDEFECTO #904;
     #904#0 = aCod;
     #904#1 = 1;
     #904#2 = #916#3;
     |LEE 101#904=;
     #904#3 = aDes;
     |SI FSalida = 0;
          |SI #0#1 = "S"; |GRABA 020#904a; |FINSI;
     |SINO;
          |GRABA 020#904n;
     |FINSI;
     |LIBERA #904;
|FPRC;

|DEFBUCLE dsm00015;
     #915#1;
     ;
     aCod1, aDesde, aDesde, aDesde;
     aCod1, aHasta, aHasta, aHasta;
     ;
     NULL, NULL, dsm00016;
|FIN;

|PROCESO Descripcion;
     nSw = 1;
     aDes = "";
     |SI #0#6 = 0; aDes1 = ""; |SINO; nPosi = #0#6 + 100; aDes1 = (aDes1 + aBlanco) % nPosi; |FINSI;
     |SI #0#7 = 0; aDes2 = ""; |SINO; nPosi = #0#7 + 100; aDes2 = (aDes2 + aBlanco) % nPosi; |FINSI;
     |SI #0#8 = 0; aDes3 = ""; |SINO; nPosi = #0#8 + 100; aDes3 = (aDes3 + aBlanco) % nPosi; |FINSI;
     |SI #0#9 = 0; aDes4 = ""; |SINO; nPosi = #0#9 + 100; aDes4 = (aDes4 + aBlanco) % nPosi; |FINSI;
     |SI #0#19 = "S";
          |QBF aDes1;
          |QBF aDes2;
          |QBF aDes3;
          |QBF aDes4;
     |FINSI;
     |PARA; j = 2; |SI j [ 5; |HACIENDO j = j + 1;
          |PARA; i = 1; |SI i [ 4; |HACIENDO i = i + 1;
               |SI #0j = i;
                    |SI aDes = ""; aEspacio = ""; |SINO; aEspacio = " "; |FINSI;
                    |SI i = 1; aDes = aDes + aEspacio + aDes1; |FINSI;
                    |SI i = 2; aDes = aDes + aEspacio + aDes2; |FINSI;
                    |SI i = 3; aDes = aDes + aEspacio + aDes3; |FINSI;
                    |SI i = 4; aDes = aDes + aEspacio + aDes4; |FINSI;
               |FINSI;
          |SIGUE;
     |SIGUE;
     |SI #0#6 = 0; aCod1 = ""; |SINO; nPosi = 100 + #910#4; aCod1 = aCod1 % nPosi; |FINSI;
     |SI #0#7 = 0; aCod1 = ""; |SINO; nPosi = 100 + #910#8; aCod2 = aCod2 % nPosi; |FINSI;
     |SI #0#8 = 0; aCod1 = ""; |SINO; nPosi = 100 + #910#12; aCod3 = aCod3 % nPosi; |FINSI;
     |SI #0#9 = 0; aCod1 = ""; |SINO; nPosi = 100 + #910#16; aCod4 = aCod4 % nPosi; |FINSI;

     aCod = aCod1 + aCod2 + aCod3 + aCod4;

     |DDEFECTO #19;
     #19#0 = aCod;
     |LEE 101#19=;
     nSal = FSalida;
     #19#1 = aDes;
     #19#125 = #0#10; ||Linea
     #19#2   = #0#11; ||Familia
     #19#3   = #0#12; ||Subfam
     #19#126 = #0#13; ||Marca
     #19#134 = #0#14; ||Art Prv
     #19#27  = #0#15; ||Prv
     #19#30  = #0#16; ||IVA
     #19#130 = #0#17; ||IVA S/N
     #19#131 = #0#17; ||IVA S/N
     #19#132 = #0#17; ||IVA S/N
     #19#153 = #0#17; ||IVA S/N
     #19#154 = #0#17; ||IVA S/N
     #19#155 = #0#17; ||IVA S/N

     #19#18  = #916#5;
     #19#19  = #916#6;
     #19#20  = #916#7;
     #19#147 = #916#8;
     #19#148 = #916#9;
     #19#149 = #916#10;
     #19#165 = #915#3;
     #19#28  = #916#11;
     #19#163 = #916#12;
     #19#133 = #916#13;
     #19#164 = #916#14;
     #19#175 = "S";
     #19#176 = #910#19;
     #19#177 = #0#20;
     |HAZ CodigoBarra;
     |SI nSal = 0;
          |SI #0#1 = "S"; |GRABA 020#19a; |FINSI;
     |SINO;
          |GRABA 020#19n;
     |FINSI;
     |LIBERA #19;

     #29#1 = 1;
     |LEE 000#29=;

     |DDEFECTO #17;
     #17#0 = aCod;
     #17#1 = 1;
     |LEE 101#17=;
     #17#40 = aDes;
     #17#41 = #29#1;
     |SI FSalida = 0;
          |SI #0#1 = "S"; |GRABA 020#17a; |FINSI;
     |SINO;
          |GRABA 020#17n;
     |FINSI;
     |LIBERA #17;

     aDesde = " " * 20;
     aHasta = "z" * 20;
     |BUCLE dsm00015;
|FPRC;

|PROCESO Nivel_4;
     aCod4 = #22#0;
     aDes4 = #22#1;
     |HAZ Descripcion;
|FPRC;

|DEFBUCLE Nivel_4;
     #22#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Nivel_4;
|FIN;

|PROCESO Nivel_3;
     aCod3 = #21#0;
     aDes3 = #21#1;
     nSw = 0;
     |BUCLE Nivel_4;
     |SI nSw = 0;
          |HAZ Descripcion;
     |FINSI;
|FPRC;

|DEFBUCLE Nivel_3;
     #21#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Nivel_3;
|FIN;

|PROCESO Nivel_2;
     aCod2 = #20#0;
     aDes2 = #20#1;
     nSw = 0;
     |BUCLE Nivel_3;
     |SI nSw = 0;
          |HAZ Descripcion;
     |FINSI;
|FPRC;

|DEFBUCLE Nivel_2;
     #20#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Nivel_2;
|FIN;

|PROCESO Tipo3;
     aAlfa = "";
     |ABRE #71;
     #71#0 = #0#18;
     |LEE 000#71=;
     |SI FSalida ! 0;
          aAlfa = "0000Codigo Nivel_1 no definido...";
     |SINO;
          |SI #910#8 ! 0;
               |ABRE #20;
               |LEE 000#20p;
               |SI FSalida ! 0; aAlfa = "0000Codigos Nivel_2 no definidos"; |FINSI;
               |CIERRA #20;
          |FINSI;
          |SI #910#12 ! 0;
               |ABRE #21;
               |LEE 000#21p;
               |SI FSalida ! 0; aAlfa = "0000Codigos Nivel_3 no definidos"; |FINSI;
               |CIERRA #21;
          |FINSI;
          |SI #910#16 ! 0;
               |ABRE #22;
               |LEE 000#22p;
               |SI FSalida ! 0; aAlfa = "0000Codigos Nivel_4 no definidos"; |FINSI;
               |CIERRA #22;
          |FINSI;
     |FINSI;
     |CIERRA #71;
     |SI aAlfa ! "";
          |MENAV aAlfa;
     |SINO;
          |ABRE #29;
          |ABRE #17;
          |ABRE #19;
          |ABRE #904;
          |ABRE #915;
          aBlanco = " " * 20;
          aCod1 = #71#0;
          aDes1 = #71#1;
          |BUCLE Nivel_2;
          |CIERRA #915;
          |CIERRA #904;
          |CIERRA #19;
          |CIERRA #17;
          |CIERRA #29;
     |FINSI;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO Caracter20; |TIPO 0;
     |SI #910#5 ! "N";  |ACABA;  |FINSI;

     eAlfa = #20Campo;  |QBF eAlfa;  |SUB_EJECUTA_NP "dsz99990;C";
     |SI enSwMalo = 1;
         |MENAV "     Introduccion Erronea";
         |ERROR;
     |FINSI;
|FPRC;

|PROCESO Caracter21; |TIPO 0;
     |SI #910#13 ! "N";  |ACABA;  |FINSI;

     eAlfa = #21Campo;  |QBF eAlfa;  |SUB_EJECUTA_NP "dsz99990;C";
     |SI enSwMalo = 1;
         |MENAV "     Introduccion Erronea";
         |ERROR;
     |FINSI;
|FPRC;

|PROCESO Caracter22; |TIPO 0;
     |SI #910#17 ! "N";  |ACABA;  |FINSI;

     eAlfa = #22Campo;  |QBF eAlfa;  |SUB_EJECUTA_NP "dsz99990;C";
     |SI enSwMalo = 1;
         |MENAV "     Introduccion Erronea";
         |ERROR;
     |FINSI;
|FPRC;

|PROCESO Min;
     #20#0 = " " * 20;
     #21#0 = " " * 20;
     #22#0 = " " * 20;
|FPRC;

|PROCESO Max;
     #20#0 = "z" * 20;
     #21#0 = "z" * 20;
     #22#0 = "z" * 20;
|FPRC;

|PROCESO EstadoBoton;
     |ESTADO_CONTROL nBoton1, aEstado;
     |ESTADO_CONTROL nBoton2, aEstado;
     |ESTADO_CONTROL nBoton3, aEstado;
|FPRC;

|PROCESO Tecla; |TIPO 6;
     |SI FSalida ! 10; |Y FSalida ! 11; |Y FSalida ! 12; |ACABA; |FINSI;

     |SI #910#8 = 0; |Y FSalida = 10; |ACABA; |FINSI;
     |SI #910#12 = 0; |Y FSalida = 11; |ACABA; |FINSI;
     |SI #910#16 = 0; |Y FSalida = 12; |ACABA; |FINSI;


     aEstado = "DISABLE"; |HAZ EstadoBoton;
     |PUSHV 0501 2380;
     |SI FSalida = 10;
          |PINPA #0#20;
          nPosi = 1639 + #910#8;
          |C_P #20#1, 1, nPosi; nPosi = nPosi -200 + 9;
          |ATRI R; |PINTA 1439, #910#7; |PINTA nPosi, "Descripcion"; |ATRI 0;
          |ENTLINEAL #1#20, -1, 2, 22, 0, Min, Max;
     |FINSI;
     |SI FSalida = 11;
          |PINPA #0#21;
          nPosi = 1639 + #910#12;
          |C_P #21#1, 1, nPosi; nPosi = nPosi -200 + 9;
          |ATRI R; |PINTA 1439, #910#11; |PINTA nPosi, "Descripcion"; |ATRI 0;
          |ENTLINEAL #1#21, -1, 2, 22, 0, Min, Max;
     |FINSI;
     |SI FSalida = 12;
          |PINPA #0#22;
          nPosi = 1639 + #910#16;
          |C_P #22#1, 1, nPosi; nPosi = nPosi -200 + 9;
          |ATRI R; |PINTA 1439, #910#15; |PINTA nPosi, "Descripcion"; |ATRI 0;
          |ENTLINEAL #1#22, -1, 2, 22, 0, Min, Max;
     |FINSI;
     |POPV;
     aEstado = "ENABLE"; |HAZ EstadoBoton;
     |ERROR;
|FPRC;

|PROCESO PulsaF2;
     |PTEC 824;
|FPRC;
|PROCESO PulsaF3;
     |PTEC 825;
|FPRC;
|PROCESO PulsaF4;
     |PTEC 826;
|FPRC;

|PROCESO Caracter19;  |TIPO 0;
     |SI #910#5 ! "N";  |ACABA;  |FINSI;

     eAlfa = #0Campo;  |QBF eAlfa;  |SUB_EJECUTA_NP "dsz99990;C";
     |SI enSwMalo = 1;
         |MENAV "     Introduccion Erronea";
         |ERROR;
     |FINSI;
|FPRC;

|PROCESO IVA019_66; |TIPO 66;
     enTiva = #0Campo;
     efFiva = ~;
     |HAZ ConsuIVA;
     |SI eaDiva = "";
          |ERROR;
     |SINO;
          #0Campo = enTiva; |PINTA #0Campo;
     |FINSI;
|FPRC;

|PROCESO IVA019_0; |TIPO 0;
     enTiva = #0Campo;
     efFiva = ~;
     |HAZ SacaIVA;
     |SI eaDiva = "";
          |MENAV "0000No existe tipo iva para esta fecha...";
          |ERROR; |ACABA;
     |FINSI;
|FPRC;

|PROCESO Tabla66; |TIPO 66;
     |ABRE #915;
     #915#0 = #0#20;
     |LEE 000#915];
     |CONSULTA_CLAVE #1#915;
     |SI FSalida = 0;
          #0#20 = #915#0; |PINTA #0#20;
     |SINO;
          |ERROR;
     |FINSI;
     |CIERRA #915;
|FPRC;

|PROCESO Tabla0; |TIPO 0;
     |SI #0#20 ! "   "; |Y #0#20 ! "000";
          |ABRE #915;
          #915#0 = #0#20;
          |LEE 000#915=;
          |SI FSalida ! 0;
               |MENAV "0000No existe tabla defectos...";
               |ERROR;
          |FINSI;
          |CIERRA #915;
     |FINSI;
|FPRC;

|PROGRAMA;
     |ABRE #910; |LEE 000#910p; |CIERRA #910;
     |ABRE #142; |LEE 000#142p; |CIERRA #142;
     |CLS;

     |SI #910#8 = 0; |C_V #0#3, 1, "N"; |C_V #0#7, 1, "N"; |FINSI;
     |SI #910#12 = 0; |C_V #0#4, 1, "N"; |C_V #0#8, 1, "N"; |FINSI;
     |SI #910#16 = 0; |C_V #0#5, 1, "N"; |C_V #0#9, 1, "N"; |FINSI;

     nNume = #910#4;
     aAlfa = "\" + #910#6 + "+#";
     |CAMPO_ANCHO  #0#18, 1, nNume;
     |CAMPO_MAXIMO #0#18, 1, aAlfa;

     nNume = #910#8;
     aAlfa = "\" + #910#10 + "+#";
     |CAMPO_ANCHO  #20#0, 1, nNume;
     |CAMPO_MAXIMO #20#0, 1, aAlfa;

     nNume = #910#12;
     aAlfa = "\" + #910#14 + "+#";
     |CAMPO_ANCHO  #21#0, 1, nNume;
     |CAMPO_MAXIMO #21#0, 1, aAlfa;

     nNume = #910#16;
     aAlfa = "\" + #910#18 + "+#";
     |CAMPO_ANCHO  #22#0, 1, nNume;
     |CAMPO_MAXIMO #22#0, 1, aAlfa;

     |HAZ BorraBlancos;

     |ABRE #0;
     |LEE 101#0p;
     |SI FSalida ! 0; |GRABA 020#0b; |FINSI;

     #0#18 = "";
     #0#2 = #910#29;
     #0#3 = #910#30;
     #0#4 = #910#31;
     #0#5 = #910#32;

     aTitulo1 = "LBOTON,F2. Edita " + #910#7;  |QBF aTitulo1;
     aTitulo2 = "LBOTON,F3. Edita " + #910#11; |QBF aTitulo2;
     aTitulo3 = "LBOTON,F4. Edita " + #910#15; |QBF aTitulo3;

     |CONTROL_SIMPLE 0, aTitulo1, 1051, 1065, PulsaF2; nBoton1 = FSalida;
     |CONTROL_SIMPLE 0, aTitulo2, 1151, 1165, PulsaF3; nBoton2 = FSalida;
     |CONTROL_SIMPLE 0, aTitulo3, 1251, 1265, PulsaF4; nBoton3 = FSalida;


     #0#16 = #142#239;

     |PINPA #0#0;

     |SI #910#44 = "T";
          |PINTA 2141, "Tabla Defectos:";
     |SINO;
          |C_V #0#20, 1, "N";
     |FINSI;

     |PINDA #0#0;

     |SI #910#8 = 0;
          |ESTADO_CONTROL nBoton1, "HIDE";
     |FINSI;
     |SI #910#12 = 0;
          |ESTADO_CONTROL nBoton2, "HIDE";
     |FINSI;
     |SI #910#16 = 0;
          |ESTADO_CONTROL nBoton3, "HIDE";
     |FINSI;

     aAlfa = #910#3;
     |PINTA 0714, aAlfa
     |ENDATOS #2#0;
     |SI FSalida = 0;
          |HAZ Tipo3;
          |GRABA 020#0a;
     |FINSI;
     |CIERRA #0;
     |FIN_CONTROL_WINDOWS nBoton3;
     |FIN_CONTROL_WINDOWS nBoton2;
     |FIN_CONTROL_WINDOWS nBoton1;
     |PULSATECLA;
|FPRO;
