|FICHEROS;
     agifc572 #0;
     agifa065 #1;
     agifa010 #2;
     agifa084 #3;
     agifa077 #4;
     agifa036 #5;
     agifa071 #6;
     agifa069 #7;
     agifa080 #8;
     agifa070 #9;
     agifa142 #142;
     agifa321 #321;
     agifa324 #324;

     agrom011@;
|FIN;

|VARIABLES;
     &Tempo = "";
     aTmp0 = "";
     aDef = "";
     nDeci_Base = 0;
     nDeci_PreBase = 0;
     aAlfa  = "";
     mensaje = "0000NO EXISTE DOCUMENTO !!";
     valida  = "2300SSon Correctos los valores introducidos S/N.: ";
     ser = "";
     art = "";
     lin = 0;
     doc = 0;
     alm = 0;
     uni = 0;
     sto = 0;
     pco = 0;
     pvt = 0;
     cli = "";
     nRecal = 0;
|FIN;

|PROCESO Recal;
     nRecal = 0;
     |SI #0#2 < "01.07.2010"; |Y #0#3 ] "01.07.2010";
          nRecal = 1;
     |FINSI;
     |SI #0#2 ] "01.07.2010"; |Y #0#3 < "01.07.2010";
          nRecal = 1;
     |FINSI;
     |SI nRecal = 1; |Y #0#4 = "AV";
          |HAZ LimCabAgifa010;
          |BUCLELIN 2 CalCabAgifa010 #2;
          |GRABA 020#2a;
          |LIBERA #2;
     |FINSI;
     |SI nRecal = 1; |Y #0#4 = "FC";
          |HAZ LimCabAgifa084;
          |BUCLELIN 2 CalCabAgifa084 #3;
          |GRABA 020#3a;
          |LIBERA #3;
     |FINSI;
     |SI nRecal = 1; |Y #0#4 = "AC";
          |HAZ LimCabAgifa077;
          |BUCLELIN 2 CalCabAgifa077 #4;
          |GRABA 020#4a;
          |LIBERA #4;
     |FINSI;
     |SI nRecal = 1; |Y #0#4 = "DP";
          |HAZ LimCabAgifa036;
          |BUCLELIN 2 CalCabAgifa036 #5;
          |GRABA 020#5a;
          |LIBERA #5;
     |FINSI;
|FPRC;

|PROCESO Bagrom011;
     #agrom011@#4 = #0#3;
     |GRABA 020#agrom011@.a;
     |LIBERA #agrom011@;
|FPRC;

|DEFBUCLE Bagrom011;
     #agrom011@#1003;
     ;
     #0#0, #0#1, 001;
     #0#0, #0#1, 999;
     be;
     NULL, Bagrom011;
|FIN;

|PROCESO agrom011;
     |DDEF aDef;
     aDef = aDef + "agrom011";
     |CARGA_DEF aDef, agrom011@;
     |SI FSalida = 0;
          |BUCLE Bagrom011;
          |DESCARGA_DEF #agrom011@;
     |FINSI;
|FPRC;

|PROCESO LeeDecimBase;
     |ABRE #agifa321;
     |ABRE #agifa324;
     |LEE 001#agifa321.p;
     #agifa324#0 = #agifa321#9; ||Igualo a moneda base
     |LEE 001#agifa324.=;
     nDeci_Base = #agifa324#7;  ||Decimales moneda base
     nDeci_PreBase = #agifa324#9;  ||Decimales precio de moneda base
     |CIERRA #agifa321;
     |CIERRA #agifa324;
|FPRC;

||*********************** ALBARANES VTA;
|PROCESO cabv;
   #2#1 = #0#3;
   |GRABA 020#2a;
|FPRC;

|PROCESO linv;
|DDEFECTO #1;
#1#0  = #6#2;||articulo;
art   = #6#2;
#1#1  = #0#2;||Fecha anterior;
#1#2  = "AV";
#1#3  = #0#1;||n documento;
doc   = #0#1;
#1#4  = #6#1;||linea
lin   = #6#1;
#1#11 = #0#0;||serie;
ser   = #0#0;
|LEE 101#1=;
|SI FSalida = 0;
     alm = #1#5;
     uni = #1#6;
     sto = #1#7;
     pco = #1#8;
     pvt = #1#9;
     cli = #1#10;
     |BORRA 020#1a;
     |DDEFECTO #1;
     #1#0  = art;
     #1#1  = #0#3;
     #1#2  = "AV";
     #1#3  = doc;
     #1#4  = lin;
     #1#11 = ser;
     #1#5  = alm;
     #1#6  = uni;
     #1#7  = sto;
     #1#8  = pco;
     #1#9  = pvt;
     #1#10 = cli;
     |GRABA 020#1n;
|FINSI;
|FPRC;

|DEFBUCLE venta;
#2#1;
;
#0#0,#0#1;
#0#0,#0#1;
be;
NULL,cabv,linv, Recal;
|FIN;


||*********************** FACTURAS CONTADO;
|PROCESO FinCab;
     |HAZ Recal;
     |SI #0#6 ! "S"; |ACABA; |FINSI;
     |HAZ VenciDir;
|FPRC;

|PROCESO cabc;
     #3#1 = #0#3;
     |GRABA 020#3a;
|FPRC;

|PROCESO linc;
     |DDEFECTO #1;
     #1#0  = #7#2;||articulo;
     art   = #7#2;
     #1#1  = #0#2;||Fecha anterior;
     #1#2  = "FC";
     #1#3  = #0#1;||n documento;
     doc   = #0#1;
     #1#4  = #7#1;||linea
     lin   = #7#1;
     #1#11 = #0#0;||serie;
     ser   = #0#0;
     |LEE 101#1=;
     |SI FSalida = 0;
          alm = #1#5;
          uni = #1#6;
          sto = #1#7;
          pco = #1#8;
          pvt = #1#9;
          cli = #1#10;
          |BORRA 020#1a;
          |DDEFECTO #1;
          #1#0  = art;
          #1#1  = #0#3;
          #1#2  = "FC";
          #1#3  = doc;
          #1#4  = lin;
          #1#11 = ser;
          #1#5  = alm;
          #1#6  = uni;
          #1#7  = sto;
          #1#8  = pco;
          #1#9  = pvt;
          #1#10 = cli;
          |GRABA 020#1n;
     |FINSI;
|FPRC;

|DEFBUCLE conta;
     #3#1;
     ;
     #0#0,#0#1;
     #0#0,#0#1;
     be;
     NULL, cabc, linc, FinCab;
|FIN;


||*********************** ALBARANES COMPRA;
|PROCESO cabco;
   #4#1 = #0#3;
   |GRABA 020#4a;
|FPRC;

|PROCESO linco;
|DDEFECTO #1;
#1#0  = #8#2;||articulo;
art   = #8#2;
#1#1  = #0#2;||Fecha anterior;
#1#2  = "AC";
#1#3  = #0#1;||n documento;
doc   = #0#1;
#1#4  = #8#1;||linea
lin   = #8#1;
#1#11 = #0#0;||serie;
ser   = #0#0;
|LEE 101#1=;
|SI FSalida = 0;
     alm = #1#5;
     uni = #1#6;
     sto = #1#7;
     pco = #1#8;
     pvt = #1#9;
     cli = #1#10;
     |BORRA 020#1a;
     |DDEFECTO #1;
     #1#0  = art;
     #1#1  = #0#3;
     #1#2  = "AC";
     #1#3  = doc;
     #1#4  = lin;
     #1#11 = ser;
     #1#5  = alm;
     #1#6  = uni;
     #1#7  = sto;
     #1#8  = pco;
     #1#9  = pvt;
     #1#10 = cli;
     |GRABA 020#1n;
|FINSI;
|FPRC;

|DEFBUCLE compra;
#4#1;
;
#0#0,#0#1;
#0#0,#0#1;
be;
NULL,cabco,linco, Recal;
|FIN;

||*********************** DEPOSITOS VENTA;
|PROCESO cabd;
   #5#1 = #0#3;
   |GRABA 020#5a;
|FPRC;

|PROCESO lind;
|DDEFECTO #1;
#1#0  = #9#2;||articulo;
art   = #9#2;
#1#1  = #0#2;||Fecha anterior;
#1#2  = "DP";
#1#3  = #0#1;||n documento;
doc   = #0#1;
#1#4  = #9#1;||linea
lin   = #9#1;
#1#11 = #0#0;||serie;
ser   = #0#0;
|LEE 101#1=;
|SI FSalida = 0;
     alm = #1#5;
     uni = #1#6;
     sto = #1#7;
     pco = #1#8;
     pvt = #1#9;
     cli = #1#10;
     |BORRA 020#1a;
     |DDEFECTO #1;
     #1#0  = art;
     #1#1  = #0#3;
     #1#2  = "DP";
     #1#3  = doc;
     #1#4  = lin;
     #1#11 = ser;
     #1#5  = alm;
     #1#6  = uni;
     #1#7  = sto;
     #1#8  = pco;
     #1#9  = pvt;
     #1#10 = cli;
     |GRABA 020#1n;
|FINSI;
|FPRC;

|DEFBUCLE deposito;
#5#1;
;
#0#0,#0#1;
#0#0,#0#1;
be;
NULL,cabd,lind, Recal;
|FIN;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO lin_temp;
     |SI #0#4 = "AV";
          |BUCLE venta;
     |FINSI;

     |SI #0#4 = "FC";
         |BUCLE conta;
     |FINSI;

     |SI #0#4 = "AC";
         |BUCLE compra;
     |FINSI;

     |SI #0#4 = "DP";
         |BUCLE deposito;
     |FINSI;
|FPRC;

|DEFBUCLE tempo;
     #0#1;
     ;
     001;
     999;
     be;
     NULL,lin_temp;
|FIN;

|PROCESO Venci; |TIPO 7;
     |SI #0#4 = "FC";
          aAlfa = #142#47;
          |C_M #0#6, 1, aAlfa;
     |SINO;
          |C_M #0#6, 1, "N";
     |FINSI;
|FPRC;

|PROCESO mira;|TIPO 0;
     |SI #0#4 = "AV";
         |ABRE #2;
         #2#0  = #0#1;
         #2#52 = #0#0;
         |LEE 101#2=;
         |SI FSalida = 0;
             #0#2 = #2#1;
             |PINTA #0#2;
         |SINO;
             |MENAV mensaje;
             |ERROR;
         |FINSI;
         |CIERRA #2;
     |FINSI;

     |SI #0#4 = "FC";
         |ABRE #3;
         #3#0  = #0#1;
         #3#48 = #0#0;
         |LEE 101#3=;
         |SI FSalida = 0;
             #0#2 = #3#1;
             |PINTA #0#2;
         |SINO;
             |MENAV mensaje;
             |ERROR;
         |FINSI;
         |CIERRA #3;
     |FINSI;

     |SI #0#4 = "AC";
         |ABRE #4;
         #4#0  = #0#1;
         #4#50 = #0#0;
         |LEE 101#4=;
         |SI FSalida = 0;
             #0#2 = #4#1;
             |PINTA #0#2;
         |SINO;
             |MENAV mensaje;
             |ERROR;
         |FINSI;
         |CIERRA #4;
     |FINSI;

     |SI #0#4 = "DP";
         |ABRE #5;
         #5#0  = #0#1;
         #5#46 = #0#0;
         |LEE 101#5=;
         |SI FSalida = 0;
             #0#2 = #5#1;
             |PINTA #0#2;
         |SINO;
             |MENAV mensaje;
             |ERROR;
         |FINSI;
         |CIERRA #5;
     |FINSI;
|FPRC;

|PROCESO pro1;
     #0#5 = 1;
|FPRC;

|PROCESO pro2;
     #0#5 = 999;
|FPRC;

|PROGRAMA;
     |ABRE #142; |LEE 000#142p; |CIERRA #142;
     |HAZ LeeDecimBase;

     |CLS;
     |HAZ CreaTempo; aTmp0 = Tempo;
     |NOME_DAT #0 aTmp0; |DELINDEX #0;
     |ENTLINEAL #1#0, -1, 1, 22, 1, pro1, pro2;
     |CONFI valida;
     |SI FSalida = 0;
          |ABRE #1;
          |BUCLE tempo;
          |CIERRA #1;
     |FINSI;
     Tempo = aTmp0; |HAZ BoraTempo; |DELINDEX #0;
|FPRO;
