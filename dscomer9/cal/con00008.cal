|FICHEROS;
   con00008 #0;
   agifa142 #1;
   agifa007 #2;

   Referen@ #100;
|FIN;

|VARIABLES;
   aAlfa  = "";
   aAlfa1 = "";
   aAlfa2 = "";
   aCuenta = "";
   nTecla = 0;
   nModo  = 0;
   aLong  = "";

   nCampo = 0;
   nCalc  = 0;
   nCalc1 = 0;
   nMaxDigit = 0;
   nNivel    = 0;
   nLong     = 0;

   nNivel1 = 0;
   nNivel2 = 0;
   nNivel3 = 0;
   nNivel4 = 0;
   nNivel5 = 0;
   nNivel6 = 0;

   nPosEmpVta = 0;
   nPosCCbVta = 0;
   nPosCAnVta = 0;

   nPosEmpCos = 0;
   nPosCCbCos = 0;
   nPosCAnCos = 0;
|FIN;

|PROCESO PintaEmpresa;
      nCalc = #con00008#nCampo#;
      nCalc1 = ((nCalc / 10) - 0.49) ! 0; #Referen@#2 = nCalc1;
      nCalc1 = nCalc - (nCalc1 * 10);     #Referen@#3 = nCalc1;
      |LEE 000#Referen@.=;
      |SI FSalida ! 0; |DDEFECTO #Referen@; |FINSI;

      nNivel1 = #Referen@#14; nNivel2 = #Referen@#15;
      nNivel3 = #Referen@#16; nNivel4 = #Referen@#17;
      nNivel5 = #Referen@#18; nNivel6 = #Referen@#19;
      nMaxDigit = 0;
      |SI #Referen@#14 ] nMaxDigit; nMaxDigit = #Referen@#14; |FINSI;
      |SI #Referen@#15 ] nMaxDigit; nMaxDigit = #Referen@#15; |FINSI;
      |SI #Referen@#16 ] nMaxDigit; nMaxDigit = #Referen@#16; |FINSI;
      |SI #Referen@#17 ] nMaxDigit; nMaxDigit = #Referen@#17; |FINSI;
      |SI #Referen@#18 ] nMaxDigit; nMaxDigit = #Referen@#18; |FINSI;
      |SI #Referen@#19 ] nMaxDigit; nMaxDigit = #Referen@#19; |FINSI;
      |SI nCampo = 3; nCalc = nPosEmpVta; |FINSI;
      |SI nCampo = 8; nCalc = nPosEmpCos; |FINSI;
      nCalc = nCalc + 7;
      |PINTA nCalc, #Referen@#1;
|FPRC;

|PROCESO PintaCuenta;
      aAlfa = #agifa142#151; |QBF aAlfa;
      nCalc = nCampo + 1;
      aAlfa = aAlfa + "fich/" + (("000000" + #con00008#nCalc#) % -106);
      |QBF aAlfa; aAlfa = aAlfa + "/"; |PATH_DAT #Referen@#aAlfa#;
      |ABRE #Referen@;
      #Referen@#0 = #con00008#nCampo#;
      |LEE 000#Referen@.=;
      |SI FSalida ! 0; |DDEFECTO #Referen@; |FINSI;
      |SI nCampo = 2; nCalc = nPosCCbVta; |FINSI;
      |SI nCampo = 7; nCalc = nPosCCbCos; |FINSI;
      nCalc = nCalc + 13;
      |PINTA nCalc, #Referen@#2;
      |CIERRA #Referen@;
|FPRC;

|PROCESO PintaAnalit;
      aAlfa = #agifa142#151; |QBF aAlfa;
      nCalc = nCampo - 1;
      aAlfa = aAlfa + "fich/" + (("000000" + #con00008#nCalc#) % -106);
      |QBF aAlfa; aAlfa = aAlfa + "/"; |PATH_DAT #Referen@#aAlfa#;
      |ABRE #Referen@;
      #Referen@#0 = #con00008#nCampo#;
      |LEE 000#Referen@.=;
      |SI FSalida ! 0; |DDEFECTO #Referen@; |FINSI;
      |SI nCampo = 4; nCalc = nPosCAnVta; |FINSI;
      |SI nCampo = 9; nCalc = nPosCAnCos; |FINSI;
      nCalc = nCalc + 8;
      |PINTA nCalc, #Referen@#1;
      |CIERRA #Referen@;
|FPRC;

|PROCESO Tipo13; |TIPO 13;
   |SI nPosEmpVta = 0;
      |C_P #con00008#3, 0, nPosEmpVta; |C_P #con00008#8, 0, nPosEmpCos;
      |C_P #con00008#2, 0, nPosCCbVta; |C_P #con00008#7, 0, nPosCCbCos;
      |C_P #con00008#4, 0, nPosCAnVta; |C_P #con00008#9, 0, nPosCAnCos;
   |FINSI;

   |ABRE #agifa142;
   |LEE 000#agifa142.p;
   |SI FSalida ! 0; |DDEFECTO #agifa142; |FINSI;
   |CIERRA #agifa142;

   |HAZ MiraTLin;

   aAlfa = #agifa142#151; |QBF aAlfa;
   aAlfa = aAlfa + "def/canempre.mas";
   |CARGA_DEF aAlfa, Referen@;
   |SI FSalida = 0;
      aAlfa = #agifa142#151; |QBF aAlfa;
      aAlfa = aAlfa + "fich/"; |QBF aAlfa; |PATH_DAT #Referen@#aAlfa#;
      |ABRE #Referen@;
      nCampo = 3; |HAZ PintaEmpresa;
      nCampo = 8; |HAZ PintaEmpresa;
      |CIERRA #Referen@; |DESCARGA_DEF #Referen@;
   |FINSI;

   aAlfa = #agifa142#151; |QBF aAlfa;
   aAlfa = aAlfa + "def/cacuenta.mas";
   |CARGA_DEF aAlfa, Referen@;
   |SI FSalida = 0;
      nCampo = 2; |HAZ PintaCuenta;
      nCampo = 7; |HAZ PintaCuenta;
     |DESCARGA_DEF #Referen@;
   |FINSI;

   aAlfa = #agifa142#151; |QBF aAlfa;
   aAlfa = aAlfa + "def/anm00001.mas";
   |CARGA_DEF aAlfa, Referen@;
   |SI FSalida = 0;
      nCampo = 4; |HAZ PintaAnalit;
      nCampo = 9; |HAZ PintaAnalit;
      |DESCARGA_DEF #Referen@;
   |FINSI;

   |PINTA 0821, #agifa007#27;

   |PINTA #con00008#0; |PINTA #con00008#1; |PINTA #con00008#2;
   |PINTA #con00008#3; |PINTA #con00008#4; |PINTA #con00008#5;
   |PINTA #con00008#6;
|FPRC;

|PROCESO EmprContable;
   |SI FSalida = 2; |ACABA; |FINSI;
   nTecla = FSalida;

   |ABRE #agifa142;
   |LEE 000#agifa142.p;
   |SI FSalida ! 0; |DDEFECTO #agifa142; |FINSI;

   aAlfa = #agifa142#151; |QBF aAlfa;
   aAlfa = aAlfa + "def/canempre.mas";
   |CARGA_DEF aAlfa, Referen@;
   |SI FSalida = 0;
      |ABRE #Referen@;
      aAlfa = #agifa142#151; |QBF aAlfa;
      aAlfa = aAlfa + "fich/"; |QBF aAlfa; |PATH_DAT #Referen@#aAlfa#;
      |SI nTecla = 10;
         |LEE 000#Referen@.];
         |CONSULTA_CLAVE #1#Referen@;
         |SI FSalida = 0;
            aAlfa = (("00000" + #Referen@#2) % -105) + #Referen@#3;
            #con00008#Campo# = aAlfa; |PINTA #con00008#Campo#;
            |SI Campo = 3; nCalc = nPosEmpVta; |FINSI;
            |SI Campo = 8; nCalc = nPosEmpCos; |FINSI;
            nCalc = nCalc + 7;
            |PINTA nCalc, #Referen@#1;
         |FINSI;
         |ERROR;
      |SINO;
         nCalc = #con00008#Campo#;
         nCalc1 = ((nCalc / 10) - 0.49) ! 0;      #Referen@#2 = nCalc1;
         nCalc1 = nCalc - (nCalc1 * 10); #Referen@#3 = nCalc1;
         |LEE 000#Referen@.=;
         |SI FSalida ! 0;
            |MENAV "    Empresa contable inexistente"; |ERROR;
         |SINO;
            aAlfa = (("00000" + #Referen@#2) % -105) + #Referen@#3;
            #con00008#Campo# = aAlfa; |PINTA #con00008#Campo#;
            |SI Campo = 3; nCalc = nPosEmpVta; |FINSI;
            |SI Campo = 8; nCalc = nPosEmpCos; |FINSI;
            nCalc = nCalc + 7;
            |PINTA nCalc, #Referen@#1;
         |FINSI;
      |FINSI;

      nNivel1 = #Referen@#14; nNivel2 = #Referen@#15;
      nNivel3 = #Referen@#16; nNivel4 = #Referen@#17;
      nNivel5 = #Referen@#18; nNivel6 = #Referen@#19;
      nMaxDigit = 0;
      |SI #Referen@#14 ] nMaxDigit; nMaxDigit = #Referen@#14; |FINSI;
      |SI #Referen@#15 ] nMaxDigit; nMaxDigit = #Referen@#15; |FINSI;
      |SI #Referen@#16 ] nMaxDigit; nMaxDigit = #Referen@#16; |FINSI;
      |SI #Referen@#17 ] nMaxDigit; nMaxDigit = #Referen@#17; |FINSI;
      |SI #Referen@#18 ] nMaxDigit; nMaxDigit = #Referen@#18; |FINSI;
      |SI #Referen@#19 ] nMaxDigit; nMaxDigit = #Referen@#19; |FINSI;
      |CIERRA #Referen@; |DESCARGA_DEF #Referen@;
   |FINSI;
|FPRC;

|PROCESO SacaNivel;
   |QBF aCuenta; nNivel = 0;
   aLong = aCuenta % 0; nLong = aLong;
   |SI nLong = nNivel1; nNivel = 1; |FINSI;
   |SI nLong = nNivel2; nNivel = 2; |FINSI;
   |SI nLong = nNivel3; nNivel = 3; |FINSI;
   |SI nLong = nNivel4; nNivel = 4; |FINSI;
   |SI nLong = nNivel5; nNivel = 5; |FINSI;
   |SI nLong = nNivel6; nNivel = 6; |FINSI;
|FPRC;

|PROCESO ConsCuenta;
   |SI FSalida = 2; |ACABA; |FINSI;
   nTecla = FSalida;

   |ABRE #agifa142;
   |LEE 000#agifa142.p;
   |SI FSalida ! 0; |DDEFECTO #agifa142; |FINSI;

   aAlfa = #con00008#Campo#; |QBF aAlfa;
   aAlfa1 = ""; aAlfa2 = "";
   aAlfa = aAlfa - ".";
   |PARA; |SI FSalida ! 0; |HACIENDO;
      nCalc1 = FSalida + 98;               aAlfa2 = aAlfa % nCalc1;
      nCalc1 = ((FSalida / 100) ! 0) + 99; aAlfa1 = aAlfa % nCalc1;
      aAlfa = aAlfa % 0; nCalc1 = aAlfa;
      nCalc1 = nMaxDigit - nCalc1;
      aAlfa = aAlfa1 + ("0" * nCalc1) + aAlfa2;
      aAlfa = aAlfa - ".";
   |SIGUE;
   #con00008#Campo# = aAlfa; |PINTA #con00008#Campo#;

   aAlfa = #agifa142#151; |QBF aAlfa;
   aAlfa = aAlfa + "def/cacuenta.mas";
   |CARGA_DEF aAlfa, Referen@;
   |SI FSalida = 0;
      aAlfa = #agifa142#151; |QBF aAlfa;
      nCalc = Campo + 1;
      aAlfa = aAlfa + "fich/" + (("000000" + #con00008#nCalc#) % -106);
      |QBF aAlfa; aAlfa = aAlfa + "/"; |PATH_DAT #Referen@#aAlfa#;
      |ABRE #Referen@;
      #Referen@#0 = #con00008#Campo#;
      |SI nTecla = 10;
         |LEE 000#Referen@.];
         |CONSULTA_CLAVE #1#Referen@;
         |SI FSalida = 0;
            #con00008#Campo# = #Referen@#0; |PINTA #con00008#Campo#;
            |SI Campo = 2; nCalc = nPosCCbVta; |FINSI;
            |SI Campo = 7; nCalc = nPosCCbCos; |FINSI;
            nCalc = nCalc + 13;
            |PINTA nCalc, #Referen@#2;
         |FINSI;
         |ERROR;
      |SINO;
         #Referen@#0 = #con00008#Campo#;
         aCuenta = #Referen@#0; nNivel = 0; |HAZ SacaNivel;
         #Referen@#1 = nNivel;
         |LEE 000#Referen@.=;
         |SI FSalida ! 0;
            |MENAV "    Cuenta contable inexistente"; |ERROR;
         |SINO;
            #con00008#Campo# = #Referen@#0; |PINTA #con00008#Campo#;
            |SI Campo = 2; nCalc = nPosCCbVta; |FINSI;
            |SI Campo = 7; nCalc = nPosCCbCos; |FINSI;
            nCalc = nCalc + 13;
            |PINTA nCalc, #Referen@#2;
         |FINSI;
      |FINSI;
      |CIERRA #Referen@; |DESCARGA_DEF #Referen@;
   |FINSI;
   |CIERRA #agifa142;
|FPRC;

|PROCESO ConsAnalit;
   |SI FSalida = 2; |ACABA; |FINSI;
   nTecla = FSalida;

   |ABRE #agifa142;
   |LEE 000#agifa142.p;
   |SI FSalida ! 0; |DDEFECTO #agifa142; |FINSI;

   aAlfa = #agifa142#151; |QBF aAlfa;
   aAlfa = aAlfa + "def/anm00001.mas";
   |CARGA_DEF aAlfa, Referen@;
   |SI FSalida = 0;
      aAlfa = #agifa142#151; |QBF aAlfa;
      nCalc = Campo - 1;
      aAlfa = aAlfa + "fich/" + (("000000" + #con00008#nCalc#) % -106);
      |QBF aAlfa; aAlfa = aAlfa + "/"; |PATH_DAT #Referen@#aAlfa#;
      |ABRE #Referen@;
      #Referen@#0 = #con00008#Campo#;
      |SI nTecla = 10;
         |LEE 000#Referen@.];
         |CONSULTA_CLAVE #1#Referen@;
         |SI FSalida = 0;
            #con00008#Campo# = #Referen@#0; |PINTA #con00008#Campo#;
            |SI Campo = 4; nCalc = nPosCAnVta; |FINSI;
            |SI Campo = 9; nCalc = nPosCAnCos; |FINSI;
            nCalc = nCalc + 8;
            |PINTA nCalc, #Referen@#1;
         |FINSI;
         |ERROR;
      |SINO;
         #Referen@#0 = #con00008#Campo#;
         |LEE 000#Referen@.=;
         |SI FSalida ! 0;
            |MENAV "    Cuenta analitica inexistente"; |ERROR;
         |SINO;
            #con00008#Campo# = #Referen@#0; |PINTA #con00008#Campo#;
            |SI Campo = 4; nCalc = nPosCAnVta; |FINSI;
            |SI Campo = 9; nCalc = nPosCAnCos; |FINSI;
            nCalc = nCalc + 8;
            |PINTA nCalc, #Referen@#1;
         |FINSI;
      |FINSI;
      |CIERRA #Referen@; |DESCARGA_DEF #Referen@;
   |FINSI;
   |CIERRA #agifa142;
|FPRC;

|PROCESO MiraTLin;
   nModo = (FEntrada / 100) ! 0;
   |SI nModo ! 4;
      |SI #con00008#6 < 0; |O #con00008#6 > 5;  |ERROR; |ACABA; |FINSI;
   |FINSI;

   |ATRI I;
   |SI #con00008#6 = 0; |PINTA 0857, "Seccion ventas "; |FINSI;
   |SI #con00008#6 = 1; |PINTA 0857, "Mano de obra   "; |FINSI;
   |SI #con00008#6 = 2; |PINTA 0857, "Piezas         "; |FINSI;
   |SI #con00008#6 = 3; |PINTA 0857, "Serv.exteriores"; |FINSI;
   |SI #con00008#6 = 4; |PINTA 0857, "Lubricantes    "; |FINSI;
   |SI #con00008#6 = 5; |PINTA 0857, "Canon          "; |FINSI;
   |ATRI N;
|FPRC;
