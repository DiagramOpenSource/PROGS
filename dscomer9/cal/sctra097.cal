  ActualizaReserva, ActualizaTodas, ActualizaTodasGes

|FICHEROS;
     sctrm036 #36;
     sctrm052 #52;
     sctrm053 #53;
     sctrm068 #68;
     sctrm079 #79;
     sctrm080 #80;
     sctrm081 #81;
     sctrm084 #84;
     sctrm015 #115;
|FINS;

|VARIABLES;
     aAlfa = "";
     nTotBillete = 0;
     nImpDtoAuto = 0;
     nIncBillete = 0;
     nGrupo = 0;
     nTipo = 0;
     aAgencia = "";
     nImpoLocaOrg = 0;
     nSw = 0;
     fFecha = "";
     aLocalizador = "";
|FIN;

|PROCESO ReseCreadasGes;
     |SI nSw = 1;
          nImpoLocaOrg = nImpoLocaOrg + #52#32;
     |SINO;
          #52#107 = nImpoLocaOrg;
          ||#52#114 = #52#32;
          #52#115 = #52#32;        || porque ya esta cobrada
          |GRABA 020#52a;
     |FINSI;
|FPRC;

|DEFBUCLE ReseCreadasGes;
     #52#5;
     42;
     fFecha, 0000, 0000000, aLocalizador;
     fFecha, 9999, 9999999, aLocalizador;
     be;
     NULL, ReseCreadasGes;
|FIN;

|PROCESO ActualizaTodasGes;
     aLocalizador = #52#42;
     fFecha = #52#1;

     nImpoLocaOrg = 0;
     nSw = 1; |BUCLE ReseCreadasGes;
     nSw = 2; |BUCLE ReseCreadasGes;
|FPRC;

|PROCESO ReseCreadas;
     #52#0 = #84#1;
     |LEE 101#52=;
     |SI FSalida = 0;
          |SI nSw = 1;
               nImpoLocaOrg = nImpoLocaOrg + #52#32;
          |SINO;
               #52#107 = nImpoLocaOrg;
               ||#52#114 = #52#32;
               #52#115 = #52#32;        || porque ya esta cobrada
               |GRABA 020#52a;
          |FINSI;
          |LIBERA #52;
     |FINSI;
|FPRC;

|DEFBUCLE ReseCreadas;
     #84#1;
     ;
     #79#0, 0000000;
     #79#0, 9999999;
     ;
     NULL, ReseCreadas;
|FIN;

|PROCESO ActualizaTodas;
     nImpoLocaOrg = 0;
     nSw = 1; |BUCLE ReseCreadas;
     nSw = 2; |BUCLE ReseCreadas;
|FPRC;

|PROCESO Lineas;
     #52#36 = #52#36 + #53#13;

     #53#11 = #53#9 + #53#10 + #53#13;
     |SI #115#5 = "S";
          #52#32 = #52#32 + (#53#11 - (#53#11 * #115#2 / 100));
     |SINO;
          #52#32 = #52#32 + #53#10 + (#53#9 + #53#13 - ((#53#9 + #53#13) * #115#2 / 100));
     |FINSI;
     |GRABA 020#53a;

     #52#108 = #53#10;
     #52#109 = #53#9;
     #52#110 = #53#14;
     #52#111 = #53#15;
|FPRC;

|PROCESO sctrm068;
     |SI #68#2 ! 0;
          |SI #68#2 ! #80#3; |ACABA; |FINSI;                    || Linea
          |SI #80#5 < #68#3; |O #80#5 > #68#4; |ACABA; |FINSI; || Servicio
     |FINSI;
     |SI #79#15 < #68#5; |O #79#15 > #68#7; |ACABA; |FINSI;       || F.Rese
     |SI #79#16 < #68#6; |O #79#16 > #68#8;; |ACABA; |FINSI;       || H.Rese

     nIncBillete = nIncBillete + ((nTotBillete * #68#10 / 100)!0);
|FPRC;

|DEFBUCLE sctrm068;
     #68#2;
     11;
     #80#16, #80#2, 0000000, #80#4;
     #80#16, #80#2, 9999999, #80#4;
     ;
     NULL, sctrm068;
|FIN;

|PROCESO IncDisBillete;
     nIncBillete = 0;
     |BUCLE sctrm068;
|FPRC;

|PROCESO ActualizaReserva;
     aAlfa = #81#3 % 102; nGrupo = aAlfa;
     aAlfa = #81#3 % 404; nTipo = aAlfa;

     #53#7 = nGrupo;
     #53#8 = nTipo
     #53#9 = #81#8;
     #53#10 = #81#9;
     #53#11 = 0;
     #53#14 = #81#6;
     #53#15 = #81#7;
     #53#16 = #81#11;

     nTotBillete = #53#9 + #53#10; |HAZ IncDisBillete;
     nImpDtoAuto = #53#9 * #53#16 / 100;
     #53#13 = nIncBillete - nImpDtoAuto;
     |GRABA 020#53a;

     |ABRE #115;
     #115#0 = #52#33;
     |LEE 000#115=;
     |SI FSalida ! 0; |DDEFECTO #115; |FINSI;
     |CIERRA #115;

     #52#36 = 0; #52#32 = 0;
     |HAZ Lineas;

     |ABRE #36;
     #36#1 = #52#43;
     |LEE 000#36=;
     |SI FSalida ! 0; |DDEFECTO #36; |FINSI;
     |CIERRA #36;

     aAgencia = #52#43; |QBF aAgencia;
     |SI aAgencia = ""; |O #36#73 = "N";
          #52#72 = #52#32;
     |FINSI;
     |GRABA 020#52a;
|FPRC;
