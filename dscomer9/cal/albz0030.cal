|FICHEROS;
     albz0030 #0;

     albm0031 #31;       ||Introd.Mezcladas CAB
     albm0032 #32;       ||Introd.Mezcladas LIN
     albm0043 #43;       ||Partidas.Introd.Mezc

     albm0060 #60;       ||Rel. Orden/Mezclada

     albm0037 #37;       ||Orden CAB
     albm0038 #38;       ||Orden LIN

     albm0046 #46;       ||Art./Alm./PartidaCAB
|FIN;

|VARIABLES;
     &enMezclada = 0;
     aEjecuta = "";

     nKg = 0;
     nImporte = 0;
     nMezAnt = 0;

     nExiste = 0;
     aMensaje = "";
     aParametro = "";
     aDesdePar = "";
     aHastaPar = "";
     nAlmacen = 0;

     &enPrecioPar = 0;
     &eaParRecalculo;
     &enAlmRecalculo;

     nPrecio = 0;
|FIN;

|PROGRAMA;
     aParametro = PARAMETRO;
     |QBF aParametro;

     |SI aParametro = "";
          |CLS;
          |ABRE #0;
          |DDEFECTO #0;
          |LEE 101#0p;
          nExiste = FSalida;
          |PINPA #0#0;
          |PINDA #0#0;
          |ENDATOS #1#0;
          |SI FSalida = 0;
               |SI nExiste = 0;
                    |GRABA 020#0a;
               |SINO;
                    |GRABA 020#0n;
               |FINSI;
               aDesdePar = #albz0030#3;
               aHastaPar = #albz0030#4;
               nAlmacen = #albz0030#1;

               |HAZ Principal;
          |FINSI;
          |LIBERA #0;
          |CIERRA #0;
     |SINO;
          aDesdePar = eaParRecalculo;
          aHastaPar = eaParRecalculo;
          nAlmacen = enAlmRecalculo;

          |HAZ Principal;
     |FINSI;
|FPRO;

|PROCESO albm0038;
     |SI #albm0038#4 = #albm0032#4;      ||ALMACEN
      |Y #albm0038#6 = #albm0043#2;      ||Y PARTIDA
          #albm0038#14 = nPrecio;
          #albm0038#15 = #albm0038#14 * #albm0038#9;
          |GRABA 020#albm0038.a;
     |FINSI;
|FPRC;

|DEFBUCLE albm0038;
 #albm0038#1;
 ;
 #albm0060#2, #albm0060#0, 01;
 #albm0060#2, #albm0060#0, 99;
 be;
 albm0038;
|FIN;

|PROCESO albm0060;
     |BUCLE albm0038;
|FPRC;

|DEFBUCLE albm0060;
 #albm0060#2;
 3;
 #albm0043#0, "";
 #albm0043#1, "";
 ;
 NULL, albm0060;
|FIN;

|PROCESO albm0043;
     #albm0032#0 = #albm0043#0;
     #albm0032#1 = #albm0043#1;
     |LEE 000#albm0032.=;
     |SI FSalida = 0; |Y #albm0032#4 = nAlmacen;
          |SI aParametro = "";
               |HAZ DamePrecio;
          |SINO;
               nPrecio = enPrecioPar;
          |FINSI;
          #albm0043#9 = nPrecio;
          #albm0043#10 = #albm0043#9 * #albm0043#4;         ||Precio * Kg.
          |GRABA 020#albm0043.a;

          |BUCLE albm0060;
     |FINSI;
|FPRC;

|DEFBUCLE albm0043;
 #albm0043#1;
 ;
 000001, 01, aDesdePar;
 999999, 99, aHastaPar;
 be;
 NULL, albm0043;
|FIN;

|PROCESO albm0043_dos;

     |SI aParametro = "";

          |SI #albm0043#0 ! nMezAnt;
               nKg = 0;
               nImporte = 0;
               nMezAnt = #albm0043#0;
          |FINSI;

          nKg = nKg + #albm0043#4;
          nImporte = nImporte + #albm0043#10;

          |DDEFECTO #albm0031;
          #albm0031#0 = #albm0043#0;
          |LEE 101#albm0031.=;
          |SI FSalida = 0;
               #albm0031#14 = nKg;
               #albm0031#21 = nImporte;
               #albm0031#22 = #albm0031#21 / #albm0031#14;
               |GRABA 020#albm0031.a;
               |LIBERA #albm0031;
          |FINSI;
     |SINO;
          enMezclada = #albm0043#0;
          aEjecuta = "albz0020;AUTO";
          |SUB_EJECUTA aEjecuta;
     |FINSI;
|FPRC;

|DEFBUCLE albm0043_dos;
 #albm0043#1;
 ;
 000001, 01, aDesdePar;
 999999, 99, aHastaPar;
 ;
 NULL, albm0043_dos;
|FIN;


|PROCESO Principal;
     |ABRE #albm0046;
     |ABRE #albm0031;
     |ABRE #albm0032;
     |BUCLE albm0043;
     nMezAnt = -1;
     |BUCLE albm0043_dos;
     |CIERRA #albm0031;
     |CIERRA #albm0032;
     |CIERRA #albm0046;
|FPRC;

|PROCESO DamePrecio;
     |DDEFECTO #albm0046;
     #albm0046#1 = #albm0032#4;
     #albm0046#2 = #albm0043#2;
     |LEE 000#albm0046.=;
     nPrecio = #albm0046#38;
|FPRC;
