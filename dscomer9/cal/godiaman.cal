|FICHEROS;
   godiaman,MANTE;
   godiacal,MANTE;
   godiama1,MANTE; ||= godiaman
   godiaca1,MANTE; ||= godiacal

   godiaman@ #0;
   godiacaj #1,MANTE;
   godiacal@ #2;
/*
   godiatm1 #3,MANTE;
   godiatm2 #4,MANTE;
   godiatm3 #5,MANTE;
   godiatm4 #6,MANTE;
*/
   godiatm6 #7,MANTE;

   gomantho #10;
   gopre001 #11;
   gopre002 #12;
   gopre003 #13;
   agifa142 #14;
   godiatas #16;
   agifa112 #17;
   agifa019 #19;
   godiafpa #20;
   agifa724 #21;
   gopartia #22;
   gomantl1 #23;
   || godiatmp #24;

   gosubcoc #30;
   gosubaux #31;
   goparame #200;
   godiavar;
   gosubcoc@;

   canempre@ #100;
   cacuenta@ #101;

   agifa079 #79;
   agifa704;
   agifa716;
   agifa077;
   agifa080;
   agifa072;
   agifa321;
   agifa324;

   godiatm5;

   agifa722;
   agifa112@;

   referen@;
|FIN;

|VARIABLES;
     &enTiva = 0;
     &efFiva = @;
     &eaDiva = "";
     &enIva = 0;
     &enRec = 0;
     &eaSerExp = "";     || Llama guerz084
     &enNumExp = 0;      || ''
     &eaSerPre = "";     || ''
     &enNumPre = 0;      || ''
     &enSubcon = 0;      || ''
     nHay = 0;
     aSer = "";
     nNum = 0;
     aSerEx = "";
     nNumEx = 0;
     aA쨚 = "";

  nSal = 0;
  &Tempo = "";
  nError = 0;
  nSubcon = 0;
  aParam = "";
     {-1}menu = "";
     menu1 = "1516";
     menu2 = "1";
     menu3 = "Contador:  ";
     menu4 = "AM";
     menu5 = " Automatico ";
     menu6 = " Manual ";
   &decim_divisa    = 0; || Decimales de la divisa
   &precio_divisa   = 0; || Decimales del precio en divisa

   &nDeci_Div       = 0; || Decimales en Totales de la divisa
   &nDeci_PreVis    = 0; || Decimales en el Precio visual. (lineas)
   &nDeci_ImpVis    = 0; || Decimales en el Importe visual. (lineas)
   &nDeci_Base      = 0; || Decimales en Totales de la moneda base
   &decim_base      = 0;  || Decimales de la moneda base
   &precio_base     = 0; || Decimales del precio en moneda base
   &nDeci_PreDiv    = 0;
   &nDeci_PreBase   = 0;
   &nDeci_BaseMx    = 0;
   &nDeci_PreBaseMx = 0;
   &nDeci_TotVis    = 0;
   &nDeci_TotNoVis  = 0;
   &nDeci_TotVisF   = 0;
   &nDeci_TotNoVisF = 0;
   &nDeci_IVAC      = 0;
   &nDeci_IVACDiv   = 0;
   &nDeci_IVACImp   = 0;

   &enModiFac = 0;
   nAsigna = 0;
   &efFecha   = @;
   &eaUsuario = "";
   &eaDocu    = "";
   &enForma   = 0;
   &eaFecha   = "";
   &enDDocum  = 0;
   &enHDocum  = 0;
   &enErrCarte = 0;

   aCapitulo = "";
   aPartida  = "";

   FEstado     = 0;
   nSw         = 0;
   ModoEntrada = 0;
   nFlag  = 0;
   nPosic = 0;
   aSerie = "";
   nFactura = 0;
   nSwLin   = 0;

   nLinea  = 0;
   nSalir  = 0;
   nTmp    = 0;
   nNivel  = 0;
   nTecla  = 0;
   nLong   = 0;
   nParte  = 0;
   nParte1 = 0;
   nParte2 = 0;
   nCalc   = 0;
   nCont   = 0;
   SwAct   = 0;
   nImporte = 0;
   nTotalFact = 0;
   nFP = 0;
   aUs = "";
   aAlfa   = "";
   aAlfa1  = "";
   aLong   = "";
   aParte1 = "";
   aParte2 = "";
   aProve = "";
|FIN;

|PROCESO CtrlFec; |TIPO 0;
     ||컴컴컴컴컴컴컴횮ontrol Cierre
     efFecha = #0#1;
     |HAZ EstaCerrado;
     |SI FSalida = 0;
          |ERROR; |ACABA;
     |FINSI;
     ||컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|FPRC;

|RUTINA inf2;
   #godiacal@#0  = #godiaman@#0;
   #godiacal@#15 = #godiaman@#1;
   #godiacal@#1  = #godiacaj#1;
   #godiacal@#2  = 00001;
|FRUT;

|RUTINA sup2;
   #godiacal@#0  = #godiaman@#0;
   #godiacal@#15 = #godiaman@#1;
   #godiacal@#1  = #godiacaj#1;
   #godiacal@#2  = 99999;
|FRUT;

|PROCESO Tipo3; |TIPO 3;
     |SI nError = 0;
          |ENTLINEAL #1#godiacal@,-4,1,22,0,inf2,sup2;
          FEstado = FSalida;
     |FINSI;
|FPRC;

|PROCESO Tipo12; |TIPO 12;
|FPRC;

|PROCESO Tipo0; |TIPO 0;
     nError = 0;
|FPRC;

|PROCESO Tipo11; |TIPO 11;

|| PARA BORRAR ........
   |SI FSalida = 9;
      #godiacaj#35 = "N";
      #godiacaj#19 = "";
      #godiacaj#20 = 0;
      #godiacaj#21 = 0;
      #godiacaj#22 = "";
      #godiacaj#23 = "";
      #godiacaj#24 = 0;
      |GRABA 020#godiacaj.a;
      |ERROR;
   |FINSI;
|| FIN PARA BORRAR ........

   |SI FSalida = 10; ||F2
      aAlfa = " Actualizando el documento numero " + #godiacaj#1;
      |ATRI R; |PINTA 2310, aAlfa; |ATRI N;
      eaUsuario = #godiaman@#0;
      eaFecha   = #godiaman@#1;
      enDDocum  = #godiacaj#1; enHDocum = #godiacaj#1;
      enModiFac = 1; || Presenta totales facturas a modificar
      |SUB_EJECUTA_NP "godiaact.tab;param";
      enModiFac = 0;
      aAlfa = "                                           "; |PINTA 2310, aAlfa;
      |LEE 000#godiacaj.=;
      |PINTA #godiacaj#32; |PINTA #godiacaj#33;
      |ERROR;
   |FINSI;

     |SI FSalida = 11;  ||F3
          |ABRE #agifa079;
          #agifa079#66 = #godiacaj#32;
          #agifa079#0 = #godiacaj#33;
          |LEE 000#agifa079.=;
          |SI FSalida = 0;
               |PUSHV 0101 2380;
               |CLS;
               |PINPA #0#agifa079;
               |PINDA #0#agifa079;
               |PAUSA;
               |POPV;
          |FINSI;
          |CIERRA #agifa079;
          |ERROR;
     |FINSI;
|FPRC;

|PROCESO Tipo13; |TIPO 13;
   |HAZ PintaLin;

     |ABRE #200; |LEE 000#200p; |CIERRA #200;
     |SI #200#141 = "O";
          |PINTA 1829, "O.T........:";
          |PINTA 1855, "O.E........:";
     |FINSI;
|FPRC;

|RUTINA inf1;
   #godiacaj#0 = #godiaman@#0;
   #godiacaj#1 = 0000000001;
   #godiacaj#2 = #godiaman@#1;
|FRUT;

|RUTINA sup1;
   #godiacaj#0 = #godiaman@#0;
   #godiacaj#1 = 9999999999;
   #godiacaj#2 = #godiaman@#1;
|FRUT;

|PROCESO MiraCuenta; |TIPO 6;
   nTecla = FSalida;

   nCalc = 0;
   |SI #canempre@#14 > nCalc; nCalc = #canempre@#14; nNivel = 1; |FINSI;
   |SI #canempre@#15 > nCalc; nCalc = #canempre@#15; nNivel = 2; |FINSI;
   |SI #canempre@#16 > nCalc; nCalc = #canempre@#16; nNivel = 3; |FINSI;
   |SI #canempre@#17 > nCalc; nCalc = #canempre@#17; nNivel = 4; |FINSI;
   |SI #canempre@#18 > nCalc; nCalc = #canempre@#18; nNivel = 5; |FINSI;
   |SI #canempre@#19 > nCalc; nCalc = #canempre@#19; nNivel = 6; |FINSI;

   aAlfa = #Fichero@#Campo#; |QBF aAlfa;
   aAlfa1 = aAlfa;
   aAlfa1 = aAlfa1 - ".";
   |SI FSalida ! 0;
      nParte = FSalida;
      nParte1 = 100 + (((nParte / 100) ! 0) - 1);
      nParte2 = ((((nParte / 100) ! 0) + 1) * 100) + 99;
      aParte1 = aAlfa % nParte1;
      aParte2 = aAlfa % nParte2;
      |QBF aParte2;
      aAlfa1 = aParte1 + aParte2;
      aLong = aAlfa1 % 0; nLong = aLong;
      nLong = nCalc - nLong; aLong = "0" * nLong;
      aAlfa = aParte1 + aLong + aParte2;
      #Fichero@#Campo# = aAlfa;
   |FINSI;

   |SI nTecla = 10;
      #cacuenta@#0 = #Fichero@#Campo#; |LEE 000#cacuenta@.];
      |CONSULTA_CLAVE #1#cacuenta@;
      #Fichero@#Campo# = #cacuenta@#0;
   |FINSI;
   |PINTA #Fichero@#Campo#;

   |SI Campo = 5; nPosic =  942; |FINSI;
   |SI Campo = 8; nPosic = 1042; |FINSI;

   #cacuenta@#0 = #Fichero@#Campo#;
   #cacuenta@#1 = nNivel;
   |LEE 000#cacuenta@.=;
   |SI FSalida ! 0;
      |MENAV "    Cuenta inexistente"; |ERROR;
   |SINO;
      |PINTA nPosic, #cacuenta@#2;
      |SI Campo = 5; #godiacaj#40 = #cacuenta@#2; |FINSI;
      |SI Campo = 8; #godiacaj#41 = #cacuenta@#2; |FINSI;
   |FINSI;
|FPRC;
/*
|RUTINA infTmp1;
   #godiatm1#0 = "     "; #godiatm1#1 = 1;
   |SI FSalida = "POSICION";
       #godiatm1#0 = #godiacal@#5;
       #godiatm1#1 = #godiacal@#5;
   |FINSI;
|FRUT;

|RUTINA supTmp1;
   #godiatm1#0 = "zzzzz"; #godiatm1#1 = 999999;
|FRUT;

|RUTINA infTmp2;
   #godiatm2#0 = #godiacal@#5;
   #godiatm2#1 = #godiacal@#6;
   #godiatm2#2 = "     ";
   #godiatm2#3 = 1;
|FRUT;

|RUTINA supTmp2;
   #godiatm2#0 = #godiacal@#5;
   #godiatm2#1 = #godiacal@#6;
   #godiatm2#2 = "zzzzz";
   #godiatm2#3 = 999999;
|FRUT;

|RUTINA infTmp3;
   #godiatm3#0 = #godiacal@#5;
   #godiatm3#1 = #godiacal@#6;
   #godiatm3#2 = #godiacal@#7;
   #godiatm3#3 = #godiacal@#8;
   #godiatm3#4 = " " * 20;
   #godiatm3#5 = " " * 50;
|FRUT;

|RUTINA supTmp3;
   #godiatm3#0 = #godiacal@#5;
   #godiatm3#1 = #godiacal@#6;
   #godiatm3#2 = #godiacal@#7;
   #godiatm3#3 = #godiacal@#8;
   #godiatm3#4 = "z" * 20;
   #godiatm3#5 = "z" * 50;
|FRUT;

|RUTINA infTmp4;
   #godiatm4#0 = #godiacal@#5;
   #godiatm4#1 = #godiacal@#6;
   #godiatm4#2 = #godiacal@#7;
   #godiatm4#3 = #godiacal@#8;
   #godiatm4#4 = #godiacal@#9;
   #godiatm4#5 = " " * 20;
   #godiatm4#6 = " " * 50;
|FRUT;

|RUTINA supTmp4;
   #godiatm4#0 = #godiacal@#5;
   #godiatm4#1 = #godiacal@#6;
   #godiatm4#2 = #godiacal@#7;
   #godiatm4#3 = #godiacal@#8;
   #godiatm4#4 = #godiacal@#9;
   #godiatm4#5 = "z" * 20;
   #godiatm4#6 = "z" * 50;
|FRUT;
*/
|PROCESO Min10;
     #10#9 = "C";
     #10#0 = "     ";
     #10#1 = 1;
|FPRC;

|PROCESO Max10;
     #10#9 = "C";
     #10#0 = "zzzzz";
     #10#1 = 999999;
|FPRC;

|PROCESO Tempo1; |TIPO 7;
     |SI eaSerExp ! "";
          |ABRE #10;
          #10#0 = eaSerExp;
          #10#1 = enNumExp;
          |LEE 020#10=;
          |CIERRA #10;

          #godiacal@#5  = #10#0; |PINTA #godiacal@#5;
          #godiacal@#6  = #10#1; |PINTA #godiacal@#6;
          #godiacal@#22 = #10#2;
          #godiacal@#23 = #10#8;
          #godiacal@#24 = #10#11;
     |SINO;
          |SI FSalida = 2; |ACABA; |FINSI;
/*
          nSalir = 0;
          |PUSHV 1530 2278;
          |ATRI R; |PINTA 1531, " SELECCIONE UN EXPEDIENTE "; |ATRI N;
          |ENTLINEAL #1#godiatm1,-2,4,22,1,infTmp1,supTmp1;
          |SI nSalir = 0; |PTEC 807; |FINSI;
               #godiacal@#5  = #godiatm1#0; |PINTA #godiacal@#5;
               #godiacal@#6  = #godiatm1#1; |PINTA #godiacal@#6;

               #godiacal@#22 = #godiatm1#3; #godiacal@#23 = #godiatm1#4;
               #godiacal@#24 = #godiatm1#5;
          |POPV;
*/
          |ABRE #10; |SELECT #4#10;
          #10#9 = "C";
          #10#0 = #godiacal@#5;
          #10#1 = #godiacal@#6;
          |LEE 000#10];
          |CONSULTA_F_CLAVE #4#10, Min10, Max10;
          |SI FSalida = 0;
               #godiacal@#5  = #10#0; |PINTA #godiacal@#5;
               #godiacal@#6  = #10#1; |PINTA #godiacal@#6;

               #godiacal@#22 = #10#2;
               #godiacal@#23 = #10#8;
               #godiacal@#24 = #10#11;
               nSalir = 1;
          |SINO;
               nSalir = 0; |PTEC 807;
          |FINSI;
          |CIERRA #10;
     |FINSI;
|FPRC;

|PROCESO Tempo2; |TIPO 7;
     nAsigna = 0;
     nSal = FSalida;
     |SI eaSerPre ! "";
          #godiacal@#7 = eaSerPre; |PINTA #godiacal@#7;
          #godiacal@#8 = enNumPre; |PINTA #godiacal@#8;
          |SI aParam = "subcontratista";;
               #godiacal@#28 = enSubcon; |PINTA #godiacal@#28;
          |FINSI;
     |FINSI;

     |SI nSal = 2; |O nSalir = 0; |ACABA; |FINSI;
     nSalir = 0;
     |SI aParam = "subcontratista";
          |SI eaSerPre ! "";
               #godiacal@#7 = eaSerPre; |PINTA #godiacal@#7;
               #godiacal@#8 = enNumPre; |PINTA #godiacal@#8;
               #godiacal@#28 = enSubcon; |PINTA #godiacal@#28;
          |SINO;
               |HAZ SeleProve;
               |SI nSalir = 0;
                    |PTEC 807;
               |SINO;
                    |HAZ SeleSubcontra;
                    |SI nSalir = 0; |PTEC 807; |FINSI;
               |FINSI;
          |FINSI;
     |SINO;
          |SI eaSerPre ! "";
               #godiacal@#7 = eaSerPre; |PINTA #godiacal@#7;
               #godiacal@#8 = enNumPre; |PINTA #godiacal@#8;
          |SINO;
/*
               |PUSHV 1530 2278;
               |ATRI R; |PINTA 1531, " SELECCIONE UN PRESUPUESTO "; |ATRI N;
               |ENTLINEAL #1#godiatm2,-4,4,22,1,infTmp2,supTmp2;
               |SI nSalir = 0; |PTEC 807; |FINSI;
               |POPV;
               #godiacal@#7 = #godiatm2#2; |PINTA #godiacal@#7;
               #godiacal@#8 = #godiatm2#3; |PINTA #godiacal@#8;
*/
               |HAZ SelecPres;
               |SI nSalir = 0; |PTEC 807; |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Tempo3; |TIPO 7;
     |SI eaSerExp = "";
          |SI FSalida = 2; |O nAsigna ! 0; |O nSalir = 0; |ACABA; |FINSI;
/*
          nSalir = 0;
          |PUSHV 1530 2278;
          |ATRI R; |PINTA 1530, " SELECCIONE UN CAPITULO "; |ATRI N;
          |ENTLINEAL #1#godiatm3,-5,4,22,1,infTmp3,supTmp3;
          |SI nSalir = 0; |PTEC 807; |FINSI;
          |POPV;
          #godiacal@#9  = #godiatm3#4; |PINTA #godiacal@#9;
          #godiacal@#13 = #godiatm3#5; |PINTA #godiacal@#13;
*/
          |HAZ SelecCapi;
          |SI nSalir = 0; |PTEC 807; |FINSI;
     |FINSI;
|FPRC;

|PROCESO Tempo4; |TIPO 7;
     |SI eaSerExp = "";
          |SI FSalida = 2; |O nAsigna ! 0; |O nSalir = 0; |ACABA; |FINSI;
/*
          nSalir = 0;
          |PUSHV 1530 2278;
          |ATRI R; |PINTA 1530, " SELECCIONE UNA PARTIDA "; |ATRI N;
          |ENTLINEAL #1#godiatm4,-6,4,22,1,infTmp4,supTmp4;
          |SI nSalir = 0; |PTEC 807; |FINSI;
          |POPV;
          #godiacal@#10 = #godiatm4#5; |PINTA #godiacal@#10;
          #godiacal@#14 = #godiatm4#6; |PINTA #godiacal@#14;
*/
          |HAZ SelecParti;
          |SI nSalir = 0; |PTEC 807; |FINSI;
     |FINSI;
|FPRC;
/*
|PROCESO RellTmp4;
   #godiatm4#0 = #gomantho#0;
   #godiatm4#1 = #gomantho#1;
   #godiatm4#2 = #gopre003#0;
   #godiatm4#3 = #gopre003#1;
   #godiatm4#4 = #gopre002#12;
   #godiatm4#5 = #gopre003#4;
   #godiatm4#6 = #gopre003#5;
   |LEE 000#godiatm4.=;
   |SI FSalida ! 0;
      |DDEFECTO #godiatm4;
      #godiatm4#0 = #gomantho#0;
      #godiatm4#1 = #gomantho#1;
      #godiatm4#2 = #gopre003#0;
      #godiatm4#3 = #gopre003#1;
      #godiatm4#4 = #gopre002#12;
      #godiatm4#5 = #gopre003#4;
      #godiatm4#6 = #gopre003#5;

      |GRABA 020#godiatm4.n;
   |FINSI;
|FPRC;

|DEFBUCLE RellTmp4;
#gopre003#1;
;
#gopre002#0,#gopre002#1,#gopre002#12,001;
#gopre002#0,#gopre002#1,#gopre002#12,999;
;
NULL,RellTmp4;
|FIN;

|PROCESO RellTmp3;
   #godiatm3#0 = #gomantho#0;
   #godiatm3#1 = #gomantho#1;
   #godiatm3#2 = #gopre002#0;
   #godiatm3#3 = #gopre002#1;
   #godiatm3#4 = #gopre002#12;
   #godiatm3#5 = #gopre002#13;
   |LEE 000#godiatm3.=;
   |SI FSalida ! 0;
      |DDEFECTO #godiatm3;
      #godiatm3#0 = #gomantho#0;
      #godiatm3#1 = #gomantho#1;
      #godiatm3#2 = #gopre002#0;
      #godiatm3#3 = #gopre002#1;
      #godiatm3#4 = #gopre002#12;
      #godiatm3#5 = #gopre002#13;
      |GRABA 020#godiatm3.n;

      |BUCLE RellTmp4;
   |FINSI;
|FPRC;

|DEFBUCLE RellTmp3;
#gopre002#1;
;
#gopre001#0,#gopre001#1,001;
#gopre001#0,#gopre001#1,999;
;
NULL,RellTmp3;
|FIN;

|PROCESO RellTmp2;
   #gopre001#0 = #gomantl1#3;
   #gopre001#1 = #gomantl1#4;
   |LEE 000#gopre001.=;
   |SI FSalida = 0;
      #godiatm2#0 = #gomantho#0;
      #godiatm2#1 = #gomantho#1;
      #godiatm2#2 = #gopre001#0;
      #godiatm2#3 = #gopre001#1;
      |LEE 000#godiatm2.=;
      |SI FSalida ! 0;
         |DDEFECTO #godiatm2;
         #godiatm2#0 = #gomantho#0;
         #godiatm2#1 = #gomantho#1;
         #godiatm2#2 = #gopre001#0;
         #godiatm2#3 = #gopre001#1;
         #godiatm2#4 = #gopre001#8;
         |GRABA 020#godiatm2.n;

         |BUCLE RellTmp3;
      |FINSI;
   |FINSI;
|FPRC;

|DEFBUCLE RellTmp2;
#gomantl1#1;
;
#gomantho#0,#gomantho#1,000;
#gomantho#0,#gomantho#1,999;
;
NULL,RellTmp2;
|FIN;

|PROCESO RellTmp1;
   #godiatm1#0  = #gomantho#0;
   #godiatm1#1  = #gomantho#1;
   |LEE 000#godiatm1.=;
   |SI FSalida ! 0;
      |DDEFECTO #godiatm1;
      #godiatm1#0  = #gomantho#0;
      #godiatm1#1  = #gomantho#1;
      #godiatm1#2  = #gomantho#29;
      #godiatm1#3  = #gomantho#2;
      #godiatm1#4  = #gomantho#8;
      #godiatm1#5  = #gomantho#11;
      |GRABA 020#godiatm1.n;

      |BUCLE RellTmp2;
   |FINSI;
|FPRC;

|DEFBUCLE RellTmp1;
#gomantho#1;
9;
"     ",000000,"C";
"zzzzz",999999,"C";
;
NULL,RellTmp1;
|FIN;

|PROCESO RellenaTempo;
   |BUCLE RellTmp1;
|FPRC;

|PROCESO ConsuExp; |TIPO 66;
     |SI nSalir = 0;
     |CONSULTA_CLAVE #1#godiatm1;
     |SI FSalida ! 0; |ERROR; |SINO; |HAZ Salir1; |FINSI;
     |FINSI;
|FPRC;

|PROCESO Salir1;
   |SI FSalida = 0;
      |DDEFECTO #godiatm2;
      #godiatm2#0 = #godiatm1#0;
      #godiatm2#1 = #godiatm1#1;
      |LEE 000#godiatm2.];
      |SI FSalida ! 0; |O #godiatm2#0 ! #godiatm1#0; |O #godiatm2#1 ! #godiatm1#1;
         |MENAV "    Este Expediente no tiene presupuestos"; |ERROR; |ACABA;
      |FINSI;
      |SI nSalir = 0; |PTEC 807; nSalir = 1; |FINSI;
   |FINSI;
|FPRC;

|PROCESO Salir2;
   |SI FSalida = 0;
      |CONFI "0000NAsignar a Capitulo-Partida";
      nAsigna = FSalida;
      |SI FSalida ! 0;
           |ERROR; |PTEC 807; nSalir = 1;
      |SINO;
           |DDEFECTO #godiatm3;
           #godiatm3#0 = #godiatm2#0;
           #godiatm3#1 = #godiatm2#1;
           #godiatm3#2 = #godiatm2#2;
           #godiatm3#3 = #godiatm2#3;
           |LEE 000#godiatm3.];
           |SI FSalida ! 0; |O #godiatm3#0 ! #godiatm2#0; |O #godiatm3#1 ! #godiatm2#1;
            |O #godiatm3#2 ! #godiatm2#2; |O #godiatm3#3 ! #godiatm2#3;
              |MENAV "    Este presupuesto no tiene capitulos"; |ERROR; |ACABA;
           |FINSI;
           |SI nSalir = 0; |PTEC 807; nSalir = 1; |FINSI;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO Salir3;
   |SI FSalida = 0;
      |DDEFECTO #godiatm4;
      #godiatm4#0 = #godiatm3#0;
      #godiatm4#1 = #godiatm3#1;
      #godiatm4#2 = #godiatm3#2;
      #godiatm4#3 = #godiatm3#3;
      #godiatm4#4 = #godiatm3#4;
      |LEE 000#godiatm4.];
      |SI FSalida ! 0; |O #godiatm4#0 ! #godiatm3#0; |O #godiatm4#1 ! #godiatm3#1;
       |O #godiatm4#2 ! #godiatm3#2; |O #godiatm4#3 ! #godiatm3#3;
       |O #godiatm4#4 ! #godiatm3#4;
         |MENAV "    Este capitulo no tiene partidas"; |ERROR; |ACABA;
      |FINSI;
      |SI nSalir = 0; |PTEC 807; nSalir = 1; |FINSI;
   |FINSI;
|FPRC;

|PROCESO Salir4;
   |SI FSalida = 0; |Y nSalir = 0; |PTEC 807; nSalir = 1; |FINSI;
|FPRC;
*/
|PROCESO Tipo2L; |TIPO 2;
   enTiva = #godiacal@#12;
   efFiva = #0#1;
   |HAZ SacaIVA;
   |SI eaDiva ! "";
      #godiacal@#16 = (#godiacal@#11 % enIva)  ! 2;
      |SI #agifa112#93 = "S";
         |SI #agifa112#86 = "B";
            #godiacal@#18 = (#godiacal@#11 % #godiacaj#36) ! 2;
         |SINO;
            #godiacal@#18 = ((#godiacal@#11 + #godiacal@#16) % #godiacaj#36) ! 2;
         |FINSI;
      |SINO;
         |SI #godiacal@#16 ! 0;
            |SI #agifa112#86 = "B";
               #godiacal@#18 = (#godiacal@#11 % #godiacaj#36) ! 2;
            |SINO;
               #godiacal@#18 = ((#godiacal@#11 + #godiacal@#16) % #godiacaj#36) ! 2;
            |FINSI;
         |SINO;
            #godiacal@#17 = 0; #godiacal@#18 = 0;
         |FINSI;
      |FINSI;

      |SI #godiacal@#18 ! 0;
         |SI #agifa112#86 = "B";
            #godiacaj#11 = #godiacaj#11 +. #godiacal@#11;
         |SINO;
            #godiacaj#11 = #godiacaj#11 +. (#godiacal@#11 + #godiacal@#16);
         |FINSI;
         #godiacaj#12 = #godiacaj#12 +. #godiacal@#18;
      |FINSI;

      nCalc = #godiacal@#12; nCalc = nCalc + 13; || Base imponible
      |SI enIva  = 0; nCalc = 13; |FINSI;
      #godiacaj#nCalc# = #godiacaj#nCalc# +. #godiacal@#11;

      |SI enIva ! 0;
         nCalc = #godiacal@#12; nCalc = nCalc + 18; || % IVA
         |SI #godiacaj#nCalc# = 0; #godiacaj#nCalc# = enIva; |FINSI;

         nCalc = #godiacal@#12; nCalc = nCalc + 23; || Cuota IVA
         #godiacaj#nCalc# = #godiacaj#nCalc# +. #godiacal@#16;
      |FINSI;

      #godiacaj#9  = #godiacaj#13 + #godiacaj#14 + #godiacaj#15 + #godiacaj#16;
      #godiacaj#9  = #godiacaj#9  + #godiacaj#17 + #godiacaj#18;

      #godiacaj#10 = #godiacaj#24 + #godiacaj#25 + #godiacaj#26;
      #godiacaj#10 = #godiacaj#10 + #godiacaj#27 + #godiacaj#28;
      |PINTA #godiacaj#9;  |PINTA #godiacaj#10;
      |PINTA #godiacaj#11; |PINTA #godiacaj#12;
   |FINSI;
|FPRC;

|PROCESO PintaCab;
   |ENTLINEAL #1#godiacaj,-3,7,14,0,inf1,sup1;
   #godiacaj#0 = #godiaman@#0;
   #godiacaj#1 = 1;
   #godiacaj#2 = #godiaman@#1;
   |LEE 000#godiacaj.];
   |SI FSalida ! 0; |O #godiacaj#0 ! #godiaman@#0; |O #godiacaj#2 ! #godiaman@#1;
      |DDEFECTO #godiacaj;
   |FINSI;
   |PINDA #0#godiacaj;
|FPRC;

|PROCESO PintaLin;
   #godiatas#0 = #godiacaj#3;
   |LEE 000#godiatas.=;
   |SI FSalida = 0;
      |PINTA 1332, #godiatas#1;
      aAlfa = #godiatas#2; #godiacal@#12 = 0; |C_M #godiacal@#12,1,aAlfa;
      aAlfa = #godiatas#3; #godiacal@#17 = 0; |C_M #godiacal@#17,1,aAlfa;
   |FINSI;

   |ENTLINEAL #1#godiacal@,-4,7,22,0,inf2,sup2;
   #godiacal@#0  = #godiaman@#0;
   #godiacal@#15 = #godiaman@#1;
   #godiacal@#1  = #godiacaj#1;
   #godiacal@#2  = 00001;
   |LEE 000#godiacal@.];
   |SI FSalida ! 0; |O #godiacal@#0 ! #godiaman@#0; |O #godiacal@#15 ! #godiaman@#1;
   |O #godiacal@#1 ! #godiacaj#1;
      |DDEFECTO #godiacal@;
   |FINSI;
   |PINDA #0#godiacal@;
|FPRC;

|RUTINA inffpa;
   #godiafpa#0 = #godiacaj#1;
   #godiafpa#1 = 1;
|FRUT;

|RUTINA supfpa;
   #godiafpa#0 = #godiacaj#1;
   #godiafpa#1 = 99;
|FRUT;

|PROCESO BorraVtos;
   |BORRA 020#godiafpa.a;
|FPRC;

|DEFBUCLE BorraVtos;
#godiafpa#1;
;
#godiacaj#1,01;
#godiacaj#1,99;
;
NULL,BorraVtos;
|FIN;

|PROCESO Tipo11cal; |TIPO 11;
   |SI nSw = 10;
      |SI FSalida = 10;
          |MENSA "     ";
          |HAZ Tempo3; |HAZ Tempo4;
          |ABRE #gopartia;
          #gopartia#34 = "C";
          #gopartia#4  = #godiacal@#19;
          #gopartia#5  = #godiacal@#20;
          #gopartia#6  = #godiacal@#21;
          #gopartia#7  = 1;
          |LEE 101#gopartia.=;
          |SI FSalida = 0;
             #gopartia#8  = #godiacal@#10;
             #gopartia#9  = #godiacal@#14;
             #gopartia#33 = #godiacal@#9;
             |GRABA 020#gopartia.a; |LIBERA #gopartia;
          |FINSI;
          |CIERRA #gopartia;
          |GRABA 020#godiacal@.a;
      |FINSI;
      |MENSA "    <F2> Cambiar capitulo y partida ";
   |FINSI;
|FPRC;

|PROCESO EsSubcon;
     nSubcon = #2#28;
     |ERROR10;
|FPRC;

|DEFBUCLE EsSubcon;
     #2#1004;
     ;
     #1#0, #1#2, #1#1, 00001;
     #1#0, #1#2, #1#1, 99999;
     ;
     NULL, EsSubcon;
|FIN;

|PROCESO Tipo2C; |TIPO 2;
   ModoEntrada = (FEntrada / 100) ! 0;
   nFlag = 0 +. 1;

   nError = 0;
   |SI ModoEntrada ! 1;
     |BUCLE EsSubcon;
     |SI aParam = "subcontratista";
          |SI nSubcon = 0;
               |SI nFlag = -1;
                    |MENAV "0000El registro no es de subcontratista";
               |FINSI;
               nError = 1;
               |ERROR; |ACABA;
          |FINSI;
     |SINO;
          |SI nSubcon ! 0;
               |SI nFlag = -1;
                    |MENAV "0000El registro es de subcontratista";
               |FINSI;
               nError = 1;
               |ERROR; |ACABA;
          |FINSI;
     |FINSI;
   |FINSI;

   |SI ModoEntrada ! 1;
      |SI nFlag < 0;
         |SI #godiacaj#35 = "S";
            |SI ModoEntrada = 3;
               |CONFI "    NEste documento ya esta actualizado.  Continuar ?";
               |SI FSalida = 0;
                  aSerie = #godiacaj#32; nFactura = #godiacaj#33;
                  |ABRE #agifa079;
                  #agifa079#66 = aSerie; #agifa079#0  = nFactura;
                  |LEE 000#agifa079.=;
                  |CIERRA #agifa079;
                  |HAZ MiraRecCompra;
                  |SI enErrCarte = 0;
                     |HAZ DeshazFactura; ||BUCLE BorraLin;
                  |SINO;
                     |MENAV "    Recibos con movimientos. No se dara de baja la factura";
                     nError = 1;
                     |ERROR; |ACABA;
                  |FINSI;
               |SINO;
                  nError = 1;
                  |ERROR; |ACABA;
               |FINSI;
            |FINSI;
            |SI ModoEntrada = 2;
               nSw = 10;
               |MENSA "    <F2> Cambiar capitulo y partida ";
               |ENTLINEAL #1#godiacal@,-4,4,22,0,inf2,sup2;
               nSw = 0;
               |ERROR; |PTEC 807;
            |FINSI;
         |SINO;
            nTotalFact = #godiacaj#9 + #godiacaj#10 - #godiacaj#12;
            nFP = #godiacaj#39;
         |FINSI;
      |SINO;
         |SI #godiacaj#35 = "N";
            nCalc = #godiacaj#9 + #godiacaj#10 - #godiacaj#12;
            |SI nTotalFact ! nCalc;|O nFP ! #godiacaj#39;
               |ABRE #godiafpa;
               |BUCLE BorraVtos;
               nDeci_Base = 2; nDeci_BaseMx = 2;
               nCalc = #godiacaj#9 + #godiacaj#10 - #godiacaj#12;
               |DDEFECTO #agifa079;
               #agifa079#66 = "zzzzz";
               #agifa079#0  = -1;
               #agifa079#1  = #godiacaj#2;
               #agifa079#2  = #godiacaj#4;
               #agifa079#11 = #godiacaj#39;
               #agifa079#31 = nCalc;
               #agifa079#14 = #agifa112#19;
               #agifa079#15 = #agifa112#20;
               #agifa079#16 = #agifa112#21;
               |HAZ VenciComp;
               |PARA nCont = 1; |SI nCont [ 12; |HACIENDO nCont = nCont + 1;
                  nCalc = nCont + 32;
                  |SI nCalc > 44;           |SAL; |FINSI;
                  |SI #agifa079#nCalc# = 0; |SAL; |FINSI;
                  |DDEFECTO #godiafpa;
                  #godiafpa#0 = #godiacaj#1;
                  #godiafpa#1 = nCont;
                  #godiafpa#3 = #agifa079#nCalc#;
                  nCalc = nCont + 67;
                  |SI nCalc > 73; nCalc = nCalc + 55; |FINSI;
                  #godiafpa#2 = #agifa079#nCalc#;
                  |GRABA 020#godiafpa.n;
               |SIGUE;
            |FINSI;
            |PUSHV 0501 2380;
            |ENTLINEAL #1#godiafpa,-2,2,17,1,inffpa,supfpa;
            |POPV;
         |FINSI;
      |FINSI;
   |SINO;
      |SI nFlag > 0; |Y FEstado < 0; |Y #godiacaj#9 = 0; |Y #godiacaj#10 = 0;
         nError = 1;
         |ERROR; ||PTEC 807;
         |ACABA;
      |FINSI;
      |SI nFlag > 0;
         |ABRE #agifa112;
         #agifa112#0 = #godiacaj#4;
         |LEE 000#agifa112.=;
         |SI FSalida ! 0; |DDEFECTO #agifa112; |FINSI;
         |CIERRA #agifa112;

         nDeci_Base = 2; nDeci_BaseMx = 2;
         nCalc = #godiacaj#9 + #godiacaj#10 - #godiacaj#12;
         |DDEFECTO #agifa079;
         #agifa079#66 = "zzzzz";
         #agifa079#0  = -1;
         #agifa079#1  = #godiacaj#2;
         #agifa079#2  = #godiacaj#4;
         #agifa079#11 = #godiacaj#39;
         #agifa079#31 = nCalc;
         #agifa079#14 = #agifa112#19;
         #agifa079#15 = #agifa112#20;
         #agifa079#16 = #agifa112#21;
         |HAZ VenciComp;
         |ABRE #godiafpa;
         |BUCLE BorraVtos;
         |PARA nCont = 1; |SI nCont [ 12; |HACIENDO nCont = nCont + 1;
            nCalc = nCont + 32;
            |SI nCalc > 44;           |SAL; |FINSI;
            |SI #agifa079#nCalc# = 0; |SAL; |FINSI;
            |DDEFECTO #godiafpa;
            #godiafpa#0 = #godiacaj#1;
            #godiafpa#1 = nCont;
            #godiafpa#3 = #agifa079#nCalc#;
            nCalc = nCont + 67;
            |SI nCalc > 73; nCalc = nCalc + 55; |FINSI;
            #godiafpa#2 = #agifa079#nCalc#;
            |GRABA 020#godiafpa.n;
         |SIGUE;
         |PUSHV 0501 2380;
         |ENTLINEAL #1#godiafpa,-2,2,17,1,inffpa,supfpa;
         |POPV;
         |CIERRA #godiafpa;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO MiraSiAct;
   SwAct = 1; |ERROR10;
|FPRC;

|DEFBUCLE MiraSiAct;
#godiacaj#2;
;
#godiaman@#0, #godiaman@#1, 0000000001, "N";
#godiaman@#0, #godiaman@#1, 9999999999, "N";
;
NULL,MiraSiAct;
|FIN;

|PROCESO BorraLin;
   |BORRA 020#godiacal@.a;

   |ABRE #22;
   |ABRE #31;
   #22#34 = "C";
   #22#4  = #godiacal@#19;
   #22#5  = #godiacal@#20;
   #22#6  = 1;
   #22#7  = 1;
   |LEE 101#22];
   |PARA; |SI FSalida = 0; |HACIENDO;
          |SI #22#34 = "C"; |Y #22#4  = #godiacal@#19; |Y #22#5  = #godiacal@#20;
               |BORRA 000#22c;

               #31#0 = #22#34;
               #31#1 = #22#4;
               #31#2 = #22#5;
               #31#3 = #22#6;
               #31#4 = #22#7;
               |BORRA 000#31c;
          |SINO;
               |SAL;
          |FINSI;
          |LIBERA #22;
          |LEE 101#22s;
   |SIGUE;
   |CIERRA #31;
   |CIERRA #22;
|FPRC;

|DEFBUCLE BorraLin;
#godiacal@#1004;
;
#godiacaj#0, #godiacaj#2, #godiacaj#1, 00001;
#godiacaj#0, #godiacaj#2, #godiacaj#1, 99999;
be;
NULL,BorraLin;
|FIN;

|PROCESO BorraEnlace;
   |ABRE #agifa704;
   #agifa704#0 = #godiatas#4;
   |LEE 000#agifa704.=;
   |SI FSalida = 0;
      |SI #agifa704#8 = "S";
         nSwLin = 1;
      |SINO;
         nSwLin = 0;
      |FINSI;
   |FINSI;
   |CIERRA #agifa704;

   aAlfa = "ac" + Usuario; |NOME_DAT #agifa716#aAlfa#;
   |DELINDEX #agifa716; |ABRE #agifa716;
   |DDEFECTO #agifa716;
   #agifa716#15 = #godiatas#4; #agifa716#0 = 1;
   #agifa716#11 = "A";         #agifa716#12 = 5;
   |SI nSwLin = 0;
      #agifa716#13 = "agifa079";  #agifa716#14 = 66;
   |SINO;
      #agifa716#13 = "agifa080";  #agifa716#14 = 28;
   |FINSI;
   #agifa716#3 = aSerie; #agifa716#4 = aSerie;
   |GRABA 020#agifa716.n;
   |DDEFECTO #agifa716;
   #agifa716#15 = #godiatas#4; #agifa716#0 = 2;
   #agifa716#11 = "N";         #agifa716#12 = 6;
   |SI nSwLin = 0;
      #agifa716#13 = "agifa079";  #agifa716#14 = 0;
   |SINO;
      #agifa716#13 = "agifa080";  #agifa716#14 = 25;
   |FINSI;
   #agifa716#5 = nFactura; #agifa716#6 = nFactura;
   |GRABA 020#agifa716.n;
   |LIBERA #agifa716; |CIERRA #agifa716;
   aAlfa = #godiatas#4; |QBF aAlfa;
   aAlfa = aAlfa + ("*" + (#godiacaj#2 % -104));
   aAlfa = "agifa711.tab;" + aAlfa + ",B";
   |SUB_EJECUTA_NP aAlfa;
|FPRC;

|PROCESO BorraLAlb;
   |SI nSw = 1;
      eaDocu = "agifa077"; enForma = -1; |HAZ StockEntra;
   |SINO;
      eaDocu = "agifa080"; enForma = -1; |HAZ StockEntra;
      #gopartia#34 = "C";
      #gopartia#4  = #godiacal@#19;
      #gopartia#5  = #godiacal@#20;
      #gopartia#6  = #agifa080#1;
      #gopartia#7  = 1;
      |LEE 101#gopartia.=;
      |SI FSalida = 0;
         |BORRA 020#gopartia.a; |LIBERA #gopartia;
         #31#0 = #22#34;
         #31#1 = #22#4;
         #31#2 = #22#5;
         #31#3 = #22#6;
         #31#4 = #22#7;
         |BORRA 000#31c;
      |FINSI;
      |BORRA 020#agifa080.a;
   |FINSI;
|FPRC;

|DEFBUCLE BorraLAlb;
#agifa080#1;
;
#agifa077#50, #agifa077#0, 001;
#agifa077#50, #agifa077#0, 999;
be;
NULL,BorraLAlb;
|FIN;

|PROCESO BorraAlb;
   |ABRE #agifa077; |ABRE #gopartia;
   #agifa077#50 = #agifa072#17;
   #agifa077#0  = #agifa072#2;
   |LEE 101#agifa077.=;
   |SI FSalida = 0;
      |ABRE #31;
      nSw = 1; |BUCLE BorraLAlb;
      nSw = 2; |BUCLE BorraLAlb;
      |CIERRA #31;

      |ABRE #agifa112;
      #agifa112#0 = #agifa077#3;
      |LEE 101#agifa112.=;
      |SI FSalida = 0;
         aAlfa = #agifa077#1; |QBF aAlfa;
         aAlfa = aAlfa % 0402; nCalc = aAlfa;
         nCalc = nCalc + 26;
         #agifa112#nCalc# = #agifa112#nCalc# - #agifa077#65;
         |GRABA 020#agifa112.a; |LIBERA #agifa112;
      |FINSI;
      |CIERRA #agifa112;

      |BORRA 020#agifa077.a; |LIBERA #agifa077;
   |FINSI;
   |CIERRA #agifa077; |CIERRA #gopartia;
|FPRC;

|PROCESO BorraLFactura;
   |HAZ BorraAlb;
   |BORRA 020#agifa072.a;
|FPRC;

|DEFBUCLE BorraLFactura;
#agifa072#1;
;
#agifa079#66, #agifa079#0, 001;
#agifa079#66, #agifa079#0, 999;
be;
NULL,BorraLFactura;
|FIN;

|PROCESO BorraFactura;
   |ABRE #agifa079;
   #agifa079#66 = aSerie;
   #agifa079#0  = nFactura;
   |LEE 101#agifa079.=;
   |SI FSalida = 0;
      |HAZ BorraRecCompra;
      |BUCLE BorraLFactura;
      |BORRA 020#agifa079.a; |LIBERA #agifa079;
   |FINSI;
   |CIERRA #agifa079;

   aAlfa1 = #agifa079#1; |QBF aAlfa1; aAlfa1 = aAlfa1 % -104; nSw = 0;
   |ABRE #agifa722;
   #agifa722#0  = "FC";
   #agifa722#1  = #agifa079#66;
   #agifa722#2  = #agifa079#0;
   #agifa722#3  = "";
   #agifa722#11 = 1;
   |LEE 000#agifa722.];
   FEstado = FSalida;
   aAlfa  = #agifa722#1; aAlfa = aAlfa % 0105;
   nCalc = #agifa722#2;
   FSalida = FEstado;
   |PARA; |SI FSalida = 0; |Y #agifa722#0 = "FC"; |Y aAlfa = #agifa079#66;
    |Y nCalc = #agifa079#0; |HACIENDO;
      aAlfa = #agifa722#3; |QBF aAlfa;
      |SI aAlfa = aAlfa1; nSw = 1; |SAL; |FINSI;
      |LEE 000#agifa722.s;
      FEstado = FSalida;
      aAlfa  = #agifa722#1; aAlfa = aAlfa % 0105; nCalc = #agifa722#2;
      FSalida = FEstado;
   |SIGUE;
   |SI nSw = 1;
      |BORRA 020#agifa722.a;
   |FINSI;
   |CIERRA #agifa722;
|FPRC;

|PROCESO DeshazFactura;
   |HAZ BorraEnlace;
   |HAZ BorraFactura;
|FPRC;

|PROCESO Tipo1; |TIPO 1;
   ModoEntrada = (FEntrada / 100) ! 0;
   |SI ModoEntrada = 3; |BUCLE BorraLin; |FINSI;
|FPRC;

|PROCESO TomaIVA;
   #godiatas#0 = #godiacaj#3;
   |LEE 000#godiatas.=;
   aAlfa = #godiatas#2; |C_M #godiacal@#12,1,aAlfa;

   #agifa019#0 = #godiacal@#3;
   |LEE 000#agifa019.=;
   |SI FSalida ! 0; |DDEFECTO #agifa019; |FINSI;
   |SI #godiatas#2 = "S";
      #godiacal@#12 = #agifa019#30;
   |SINO;
      #godiacal@#12 = 0;
   |FINSI;
|FPRC;

|PROCESO TomaRet;
   ModoEntrada = (FEntrada / 100) ! 0;

   #godiatas#0 = #godiacaj#3;
   |LEE 000#godiatas.=;

   |ABRE #agifa112;
   #agifa112#0 = #godiacaj#4;
   |LEE 000#agifa112.=;
   |SI FSalida ! 0; |DDEFECTO #agifa112; |FINSI;
   #godiacaj#30 = #agifa112#78; |PINTA #godiacaj#30;
   #godiacaj#36 = #agifa112#78; |PINTA #godiacaj#36;

   |SI ModoEntrada = 1;
      #godiacaj#37 = #agifa112#2;  |PINTA #godiacaj#37;
      #godiacaj#38 = #agifa112#9;  |PINTA #godiacaj#38;
   |FINSI;

   |CIERRA #agifa112;
|FPRC;

|PROCESO MiraTipoAs;
   #godiatas#0 = #godiacaj#3;
   |LEE 000#godiatas.=;
   |SI #godiatas#3 = "N";
      #godiacaj#30 = 0; |PINTA #godiacaj#30;
      #godiacaj#36 = 0; |PINTA #godiacaj#36;
   |FINSI;
|FPRC;

|PROCESO MiraCtaGasto;
   aAlfa = "C";
   |ABRE #agifa724;
   #agifa724#0 = #godiacal@#3;
   |LEE 000#agifa724.=;
   |SI FSalida = 0;
      |SI aAlfa = "V";
         aAlfa = #agifa724#2; |QBF aAlfa;
         |SI #agifa142#183 = "N"; |Y aAlfa = "";
            |MENAV "    Cuenta ingreso del articulo en blanco"; |ERROR;
         |FINSI;
      |FINSI;
      |SI aAlfa = "C";
         aAlfa = #agifa724#3; |QBF aAlfa;
         |SI #agifa142#184 = "N"; |Y aAlfa = "";
            |MENAV "    Cuenta gasto del articulo en blanco";
            |ERROR;
         |FINSI;
      |FINSI;
   |SINO;
      |SI #agifa142#183 = "N"; |O #agifa142#184 = "N";
         |MENAV "    Cuenta articulo inexistente "; |ERROR;
      |FINSI;
   |FINSI;
   |CIERRA #agifa724;
|FPRC;

|PROCESO Param_Divisas; |TIPO 0;
     |ABRE #agifa321;
     |LEE 000#agifa321.p;
     |SI FSalida ! 0; |DDEFECTO #agifa321; |FINSI;
     |CIERRA #agifa321;

     |ABRE #agifa324;
     #agifa324#0 = #agifa321#9;
     |LEE 001#agifa324.=;   || Leo la moneda base

     decim_base = #agifa324#7;    ||Asigno los decimales de la moneda base
     precio_base = #agifa324#9;   ||Asigno los decimales del precio en la mon. base
     #agifa077#61 = #agifa321#9;
     #agifa077#62 = #agifa324#3;

     #agifa324#0 = #agifa077#56;
     |LEE 001#agifa324.=;   || Leo la divisa
     |CIERRA #agifa324;

     decim_divisa = #agifa324#7;  || Decimales de la divisa
     precio_divisa = #agifa324#9;  || Decimales en el precio de la divisa
     nDeci_Div = decim_divisa;   || Decimales de la divisa
     nDeci_PreDiv = precio_divisa;  || Decimales en el precio de la divisa
     |SI #agifa077#58 = "B";   ||Si trabajo con la moneda base ...
          nDeci_PreVis   = precio_divisa;
          nDeci_ImpVis   = decim_divisa;
          nDeci_Base     = decim_base;
          nDeci_PreBase  = precio_base;
          nDeci_BaseMx  = decim_base;
          nDeci_PreBaseMx = precio_base;
          nDeci_TotVis   = decim_base;
          nDeci_TotNoVis = decim_divisa;
          nDeci_TotVisF  = decim_base;
          nDeci_TotNoVisF = decim_divisa;
     |SINO;     ||Si trabajo con la divisa ...
          nDeci_PreVis   = precio_base;
          nDeci_ImpVis   = decim_base;
          nDeci_Base     = decim_base;
          nDeci_PreBase  = precio_base;
         |SI #agifa077#57 = 1;
              nDeci_BaseMx    = decim_base;    || sin triangulacion
              nDeci_PreBaseMx = precio_base;
         |SINO;
              nDeci_BaseMx    = #agifa321#10;  || con triangulacion
              nDeci_PreBaseMx = #agifa321#11;
         |FINSI;
          nDeci_TotVis     = decim_divisa;
          nDeci_TotVisF    = decim_divisa;
          nDeci_TotNoVis   = decim_base;
          nDeci_TotNoVisF  = decim_base;
     |FINSI;
     nDeci_IVAC = #agifa321#13 + nDeci_BaseMx;
     nDeci_IVACDiv = #agifa321#13 + nDeci_Div;
     nDeci_IVACImp = #agifa321#13 + nDeci_ImpVis;
|FPRC;
/*
|PROCESO LineasCaja;
   |DDEFECTO #godiatmp;
   #godiatmp#0 = #godiacal@#19;
   #godiatmp#1 = #godiacal@#20;
   #godiatmp#2 = #godiacal@#21;
   #godiatmp#3 = #godiacal@#0;
   #godiatmp#4 = #godiacal@#15;
   #godiatmp#5 = #godiacal@#1;
   #godiatmp#6 = #godiacal@#2;
   |GRABA 020#godiatmp.n;
|FPRC;

|DEFBUCLE LineasCaja;
#godiacal@#1;
;
INICIO;
FINAL;
;
NULL, LineasCaja;
|FIN;
*/
|PROGRAMA;
   aParam = PARAMETRO;
   |SI aParam = "subcontratista";
     |REFERENCIA_DEF godiaman@, #godiama1;
     |REFERENCIA_DEF godiacal@, #godiaca1;
   |SINO;
      |REFERENCIA_DEF godiaman@, #godiaman;
      |REFERENCIA_DEF godiacal@, #godiacal;
   |FINSI;

   |ABRE #agifa142;
   |LEE 000#agifa142.p;
   |SI FSalida ! 0;
      |MENAV "    Datos de contabilidad inexistentes en parametros generales";
      |CIERRA #agifa142; |ACABA;
   |FINSI;
   |CIERRA #agifa142;

   |ABRE #godiatm5;
   |LEE 000#godiatm5.p;
   |SI FSalida ! 0;
      |MENSA "    Regenerando el fichero de vinculos con albaranes";
      |SUB_EJECUTA "godiarec.tab;AUTO";
      |BLIN 4;
   |FINSI;
   |CIERRA #godiatm5;

   aAlfa = #agifa142#151; |QBF aAlfa;
   aAlfa1 = aAlfa + "def/canempre.mas";
   |CARGA_DEF aAlfa1, canempre@;
   |SI FSalida ! 0;
      |MENAV "    Problemas para encontrar la empresa de contabilidad";
      |ACABA;
   |FINSI;
   aAlfa1 = aAlfa + "def/cacuenta.mas"; |CARGA_DEF aAlfa1, cacuenta@;

   aAlfa1 = aAlfa + "fich/";        |PATH_DAT #100 aAlfa1;
   nCalc = #agifa142#152; aAlfa1 = nCalc; aAlfa1 = ("000000" + aAlfa1) % -106;
   aAlfa1 = aAlfa + "fich/" + aAlfa1 + "/"; |PATH_DAT #101 aAlfa1;
   |ABRE #canempre@; |ABRE #cacuenta@;
   nCalc = #agifa142#152; aAlfa1 = nCalc; aAlfa1 = ("000000" + aAlfa1) % -106;
   aAlfa1 = aAlfa1 % -101; #canempre@#3 = aAlfa1;
   nCalc = #agifa142#152; aAlfa1 = nCalc; aAlfa1 = ("000000" + aAlfa1) % -106;
   aAlfa1 = aAlfa1 % 0105; #canempre@#2 = aAlfa1;
   |LEE 000#canempre@.=;
/*
   |ABRE #godiatmp;
   |LEE 000#godiatmp.p;
   |SI FSalida ! 0;
      |MENSA "    Revisando temporal de apoyo sobre albaranes";
      |BUCLE LineasCaja;
   |FINSI:
   |CIERRA #godiatmp;
*/
/*
   |MENSA "    Cargando temporales de expedientes, capitulos y partidas";
   |ABRE #gopre001;
   aAlfa = "j1" + Usuario; |NOME_DAT #godiatm1#aAlfa#;
   |DELINDEX #godiatm1; |ABRE #godiatm1;
   aAlfa = "j2" + Usuario; |NOME_DAT #godiatm2#aAlfa#;
   |DELINDEX #godiatm2; |ABRE #godiatm2;
   aAlfa = "j3" + Usuario; |NOME_DAT #godiatm3#aAlfa#;
   |DELINDEX #godiatm3; |ABRE #godiatm3;
   aAlfa = "j4" + Usuario; |NOME_DAT #godiatm4#aAlfa#;
   |DELINDEX #godiatm4; |ABRE #godiatm4;
   |SI eaSerExp = "";
||          |HAZ RellenaTempo;
   |FINSI;
   |CIERRA #gopre001;
   |BLIN 4;
*/
   |ABRE #godiacaj; |ABRE #godiacal@; |ABRE #godiatas;
   |ABRET #agifa019;
   |ABRE #gopre001; |ABRE #gopre002; |ABRE #gopre003; |ABRE #gomantho;

   |CLS;
   |CABEZA " Control caja ";

   |PINPA #0#0; |PINDA #0#0;
   aUs = Usuario % 0810; #godiaman@#0 = aUs;
   |HAZ PintaCab; |HAZ PintaLin;

   |HAZ Param_Divisas;

   |ENDATOS #1#0;
   |SI FSalida = 0;
   ||컴컴컴컴컴컴컴횮ontrol Cierre
   efFecha = #0#1;
   |HAZ EstaCerrado;
   |SI FSalida ! 0;
        FSalida = 0;
        |PARA; |SI FSalida = 0; |HACIENDO;
           |HAZ PintaLin;
           |ENTLINEAL #1#godiacaj,-3,1,14,0,inf1,sup1;
           SwAct = 0; |BUCLE MiraSiAct;
           |SI SwAct ! 0;
              |CONFI "    NActualizar registros ? ";
              |SI FSalida = 0;
                 eaUsuario = #godiaman@#0;
                 eaFecha   = #godiaman@#1;
                 enDDocum  = 1; enHDocum = 9999999999;
                 |SUB_EJECUTA_NP "godiaact.tab;param";
              |FINSI;
           |FINSI;
           |ENDATOS #1#0;
        |SIGUE;
   |FINSI;
   |FINSI;
   |CIERRA #gopre001; |CIERRA #gopre002; |CIERRA #gopre003; |CIERRA #gomantho;
   |CIERRAT #agifa019;
   |CIERRA #godiatas;
   |CIERRA #godiacaj;  |CIERRA #godiacal@;
/*
   |CIERRA #godiatm4;  |CIERRA #godiatm3;
   |CIERRA #godiatm2;  |CIERRA #godiatm1;
*/
   |CIERRA #canempre@; |DESCARGA_DEF #canempre@;
   |CIERRA #cacuenta@; |DESCARGA_DEF #cacuenta@;
|FPRO;

|PROCESO PonUnits;
   |SI FSalida = 10;
      |PUSHV 2240 2380;

      #godiatm6#0 = #godiacal@#26;
      #godiatm6#1 = #godiacal@#27;
      |SI #godiatm6#1 = 0;
         #godiacal@#26 = 1;
         #godiacal@#27 = #godiacal@#11;
      |FINSI;

      |PINPA #0#godiatm6; |PINDA #0#godiatm6;
      |ENDATOS #1#godiatm6;
      |SI FSalida = 0;
         #godiacal@#26 = #godiatm6#0;
         #godiacal@#27 = #godiatm6#1;
         #godiacal@#11 = #godiacal@#26 * #godiacal@#27;
      |SINO;
         |ERROR;
      |FINSI;

      |POPV;
      |PINTA #godiacal@#11;
   |SINO;
      #godiacal@#26 = 1;
      #godiacal@#27 = #godiacal@#11;
   |FINSI;

     |ABRE #agifa019;
     #agifa019#0 = #godiacal@#3;
     |LEE 020#agifa019.=;
     |CIERRA #agifa019;
     |ABRE #godiavar;
     #godiavar#0 = #agifa019#125;
     |LEE 000#godiavar.=;
     |SI FSalida = 0;
          |C_M #godiacal@#29, 1, "S";
          |SI #godiacal@#Campo# ! Contenido;
               #godiacal@#29 = #godiacal@#11;
               |PINTA #godiacal@#29;
          |FINSI;
          #godiacal@#30 = "S";
     |SINO;
          |C_M #godiacal@#29, 1, "N";
          #godiacal@#29 = 0; |PINTA #godiacal@#29;
          #godiacal@#30 = "N";
     |FINSI;
     |CIERRA #godiavar;
|FPRC;

|PROCESO Chequea0; |TIPO 0;
     |SI #godiacal@#30 = "S"; |Y #godiacal@#29 = 0;
          |CONFI "0000NPVP igual a 0. 풠ontinuar?";
          |SI FSalida ! 0; |ERROR; |FINSI;
     |FINSI;
|FPRC;

|PROCESO ContaFac0; |TIPO 0;
     |SI #1#33 ! 0;
          |ABRE #79;
          #79#66 = #1#32;
          #79#0 = #1#33;
          |LEE 000#79=;
          |SI FSalida = 0;
               |MENAV "0000Factura existente...";
               |ERROR;
          |FINSI;
          |CIERRA #79;
     |FINSI;
|FPRC;

|PROCESO ContaFac7; |TIPO 7;
     |ABRE #16;
     #16#0 = #1#3;
     |LEE 020#16=;
     |CIERRA #16;
     |SI #16#6 = "N";
          |C_M #1#33, 1, "N";
          #1#33 = 0; |PINTA #1#33;
     |SINO;
          |MENU menu;
          |SI FSalida = 1;
               |C_M #1#33, 1, "N";
               #1#33 = 0; |PINTA #1#33;
          |SINO;
               |C_M #1#33, 1, "S";
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Tipo66; |TIPO 66;
     |SALVA_FICHA #1;
     |LEE 000#1p;
     |CONSULTA_CLAVE #1#1;
     |REPON_FICHA #1;
|FPRC;

|PROCESO Subcontrata1;
     |SALVA_DATOS #30;
     |REPON_DATOS #gosubcoc@;
     |GRABA 020#gosubcoc@.n;
     nSalir = 1;
|FPRC;

|DEFBUCLE Subcontrata1;
     #30#3;
     2, 20;
     #23#3, #23#4, aProve, "N";
     #23#3, #23#4, aProve, "N";
     ;
     NULL, Subcontrata1;
|FIN;

|PROCESO LinExpe1;
     |BUCLE Subcontrata1;
|FPRC;

|DEFBUCLE LinExpe1;
     #23#1;
     ;
     aSerEx, nNumEx, 001;
     aSerEx, nNumEx, 999;
     ;
     NULL, LinExpe1;
|FIN;

|PROCESO SeleSubcontra;
     |DDEF aAlfa;
     aAlfa = aAlfa + "gosubcoc";
     |CARGA_DEF aAlfa, gosubcoc@;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |HAZ CreaTempo;
     |NOME_DAT #gosubcoc@#Tempo#;
     |DELINDEX #gosubcoc@;

     |ABRE #gosubcoc@;
     aSerEx = #2#5; nNumEx = #2#6;
     |BUCLE LinExpe1;
     |SI nSalir = 0;
          |MENAV "0000No existen subcontratas para este proveedor";
     |SINO;
          #gosubcoc@#0 = #2#28;
          |LEE 000#gosubcoc@.];
          |CONSULTA_CLAVE #1#gosubcoc@;
          |SI FSalida = 0;
               #2#28 = #gosubcoc@#0; |PINTA #2#28;
               #2#7 = #gosubcoc@#4; |PINTA #2#7;
               #2#8 = #gosubcoc@#5; |PINTA #2#8;
               nSalir = 1;
          |SINO;
               nSalir = 0;
          |FINSI;
     |FINSI;
     |CIERRA #gosubcoc@;
     |DELINDEX #gosubcoc@;

     |DESCARGA_DEF #gosubcoc@;
|FPRC;

|PROCESO Subcontrata;
     #17#0 = #30#2;
     |LEE 000#17=;
     |SI FSalida = 0;
          |SALVA_DATOS #17;
          |REPON_DATOS #agifa112@;
          |GRABA 020#agifa112@.n;
          nSalir = 1;
     |FINSI;
|FPRC;

|DEFBUCLE Subcontrata;
     #30#3;
     20;
     #23#3, #23#4, "N";
     #23#3, #23#4, "N";
     ;
     NULL, Subcontrata;
|FIN;

|PROCESO LinExpe;
     |BUCLE Subcontrata;
|FPRC;

|DEFBUCLE LinExpe;
     #23#1;
     ;
     aSerEx, nNumEx, 001;
     aSerEx, nNumEx, 999;
     ;
     NULL, LinExpe;
|FIN;

|PROCESO SeleProve;
     |DDEF aAlfa;
     aAlfa = aAlfa + "agifa112";
     |CARGA_DEF aAlfa, agifa112@;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |HAZ CreaTempo;
     |NOME_DAT #agifa112@#Tempo#;
     |DELINDEX #agifa112@;

     |ABRE #agifa112@;
     |ABRE #17;
     aSerEx = #2#5; nNumEx = #2#6;
     |BUCLE LinExpe;
     |CIERRA #17;
     |SI nSalir = 0;
          |MENAV "0000No existen subcontratas para este expediente";
     |SINO;
          |LEE 000#agifa112@.p;
          |CONSULTA_CLAVE #1#agifa112@;
          |SI FSalida = 0;
               aProve = #agifa112@#0;
               nSalir = 1;
          |SINO;
               nSalir = 0;
          |FINSI;
     |FINSI;
     |CIERRA #agifa112@;
     |DELINDEX #agifa112@;
     |DESCARGA_DEF #agifa112@;
|FPRC;

|PROCESO Referencia; |TIPO 0;
     aAlfa = #1#7; |QBF aAlfa;
     |SI aAlfa = ""; |ACABA; |FINSI;

     aA쨚 = #0#1 % -104;
     |ABRE #79;
     |SELECT #4#79;
     #79#2 = #1#4;
     #79#74 = #1#7;
     |LEE 000#79];
     |PARA; |SI FSalida = 0; |Y #79#2 = #1#4; |Y #79#74 = #1#7; |HACIENDO;
          aAlfa = #79#1 % -104;
          |SI aA쨚 = aAlfa;
               aAlfa = ("000000" + #79#0) % -106;
               aAlfa = "0000Codigo existente en Factura:" + #79#66 + "/" + aAlfa;
               |MENAV aAlfa
               |ERROR;
               |SAL;
          |FINSI;
          |LEE 000#79s;
     |SIGUE;
     |CIERRA #79;
|FPRC;

|PROCESO CargaPres;
     #11#0 = #23#3;
     #11#1 = #23#4;
     |LEE 020#11=;
     |SI FSalida = 0;
          |SALVA_DATOS #11;
          |REPON_DATOS #referen@;
          |GRABA 020#referen@.n;
          nHay = 1;
     |FINSI;
|FPRC;

|DEFBUCLE CargaPres;
     #23#1;
     10;
     aSer, nNum, 001, "C";
     aSer, nNum, 999, "C";
     ;
     NULL, CargaPres;
|FIN;

|PROCESO SelecPres;
     |DDEF aAlfa;
     aAlfa = aAlfa + "gopre001";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |HAZ CreaTempo;
          |NOME_DAT #referen@#Tempo#; |DELINDEX #referen@;
          |ABRE #referen@;
          |ABRE #11;
          nHay = 0;
          aSer = #godiacal@#5;
          nNum = #godiacal@#6;
          |BUCLE CargaPres;
          |CIERRA #11;
          |SI nHay ! 0;
               #referen@#0 = #godiacal@#7;
               #referen@#1 = #godiacal@#8;
               |LEE 000#referen@.];
               |CONSULTA_CLAVE #1#referen@;
               |SI FSalida = 0;
                    #godiacal@#7 = #referen@#0; |PINTA #godiacal@#7;
                    #godiacal@#8 = #referen@#1; |PINTA #godiacal@#8;
                    nSalir = 1;
                    |CONFI "0000NAsignar a Capitulo-Partida";
                    nAsigna = FSalida;
               |SINO;
                    nSalir = 0;
               |FINSI;
          |SINO;
               |MENAV "0000Expediente sin presupuestos en curso...";
               nSalir = 0;
          |FINSI;
          |CIERRA #referen@;
          |HAZ BoraTempo; |DELINDEX #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|PROCESO CargaCapi;
     |SALVA_DATOS #12;
     |REPON_DATOS #referen@;
     |GRABA 020#referen@.n;
     nHay = 1;
|FPRC;

|DEFBUCLE CargaCapi;
     #12#1;
     ;
     aSer, nNum, 001;
     aSer, nNum, 999
     ;
     NULL, CargaCapi;
|FIN;

|PROCESO SelecCapi;
     |DDEF aAlfa;
     aAlfa = aAlfa + "gopre002";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |HAZ CreaTempo;
          |NOME_DAT #referen@#Tempo#; |DELINDEX #referen@;
          |ABRE #referen@;
          nHay = 0;
          aSer = #godiacal@#7;
          nNum = #godiacal@#8;
          |BUCLE CargaCapi;
          |SI nHay ! 0;
               |SELECT #6#referen@;
               #referen@#0 = #godiacal@#7;
               #referen@#1 = #godiacal@#8;
               #referen@#12 = #godiacal@#9;
               |LEE 000#referen@.];
               |CONSULTA_CLAVE #6#referen@;
               |SI FSalida = 0;
                    #godiacal@#9  = #referen@#12; |PINTA #godiacal@#9;
                    #godiacal@#13 = #referen@#13; |PINTA #godiacal@#13;
               |SINO;
                    nSalir = 0;
               |FINSI;
          |SINO;
               |MENAV "0000Presupuesto sin capitulos...";
               nSalir = 0;
          |FINSI;
          |CIERRA #referen@;
          |HAZ BoraTempo; |DELINDEX #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|PROCESO CargaParti;
     |SALVA_DATOS #13;
     |REPON_DATOS #referen@;
     |GRABA 020#referen@.n;
     nHay = 1;
|FPRC;

|DEFBUCLE CargaParti;
     #13#1;
     ;
     aSer, nNum, #godiacal@#9, 001;
     aSer, nNum, #godiacal@#9, 999
     ;
     NULL, CargaParti;
|FIN;

|PROCESO SelecParti;
     |DDEF aAlfa;
     aAlfa = aAlfa + "gopre003";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |HAZ CreaTempo;
          |NOME_DAT #referen@#Tempo#; |DELINDEX #referen@;
          |ABRE #referen@;
          nHay = 0;
          aSer = #godiacal@#7;
          nNum = #godiacal@#8;
          |BUCLE CargaParti;
          |SI nHay ! 0;
               |SELECT #2#referen@;
               #referen@#0 = #godiacal@#7;
               #referen@#1 = #godiacal@#8;
               #referen@#2 = #godiacal@#9;
               #referen@#4 = #godiacal@#10;
               |LEE 000#referen@.];
               |CONSULTA_CLAVE #2#referen@;
               |SI FSalida = 0;
                    #godiacal@#10 = #referen@#4; |PINTA #godiacal@#10;
                    #godiacal@#14 = #referen@#5; |PINTA #godiacal@#14;
               |SINO;
                    nSalir = 0;
               |FINSI;
          |SINO;
               |MENAV "0000Presupuesto sin partidas...";
               nSalir = 0;
          |FINSI;
          |CIERRA #referen@;
          |HAZ BoraTempo; |DELINDEX #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|PROCESO IVAaca_66; |TIPO 66;
     enTiva = #godiaca1#Campo#;
     efFiva = #godiaman#1;
     |HAZ ConsuIVA;
     |SI eaDiva = "";
          |ERROR;
     |SINO;
          #godiaca1#Campo# = enTiva; |PINTA #godiaca1#Campo#;
     |FINSI;
|FPRC;

|PROCESO IVAaca_0; |TIPO 0;
     enTiva = #godiaca1#Campo#;
     efFiva = #godiaman#1;
     |HAZ SacaIVA;
     |SI eaDiva = "";
          |MENAV "0000No existe tipo iva para esta fecha...";
          |ERROR; |ACABA;
     |FINSI;
|FPRC;
