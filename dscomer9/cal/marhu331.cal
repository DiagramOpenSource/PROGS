|FICHEROS;
     marhu331 #0;
     marhu328 #328,MANTE;
     agifa133 #133;
     agifa134 #134;
     agifa321 #321;
     agifa324 #324;
     dscam045@ #45;
     dscam016@ #16;
     dscam017@ #17;
     dscam003@ #3;
     agifa059 #10;
     agifa010 #11;
|FIN;

|VARIABLES;
     &enNumReci    = 0;
     &enNumCartera = 0;
     &eaProg   = "";
     &Tempo    = "";
     aTempo328 = "";
     qAlbar    = 0;
     qCampo    = 0;
     dCampo    = 0;
     nCampo    = 0;
     &eaCampo  = "";
     &eaSecu1  = "";
     &eaSecu2  = "";
     &nDeci_Base = 0;
     &nDeci_Div  = 0;
     nErr      = 0;
     aPath     = "";
     aInforme  = "";
     &eaImprime= "";
     &ser_fac  = "";
     &num_fac  = 0;
     &reimp    = "";
     aAlfa     = "";
     nCam      = 0;
     i         = 0;
     nLin      = 0;
     aEmpre    = "";
     aEmpreAnt = "";
     nEmpre    = 0;
     nReme     = 0;
     aDef1     = "";
     aDef2     = "";
     aDef3     = "";
     aDef4     = "";
     aAlf1     = "";
     aAlf2     = "";
     aAlf3     = "";
     aAlf4     = "";
     aAlf5     = "";
     aAlf6     = "";
     aAlf7     = "";
|FIN;

|PROCESO Comprueba;
     eaCampo = #0Campo;
     |HAZ comprueba;
|FPRC;

|PROCESO UltLin;
     #17#0 = nReme;
     #17#1 = 999;
     |LEE 000#17];
     |SI FSalida = 0;
          |LEE 000#17a;
     |SINO;
          |LEE 000#17u;
     |FINSI;
     |SI FSalida = 0; |Y #17#0 = nReme;
          nLin = #17#1 + 1;
     |SINO;
          nLin = 1;
     |FINSI;
|FPRC;

|PROCESO BuscaEmpre;
     |SI #45#2 = "V";
          |SI #328#0 ] #45#4 ; |Y #328#0 [ #45#5;
               aEmpre = ("00000" + #45#6) % -105;
               |ERROR10;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE BuscaEmpre;
     #45#1002;
     ;
     nEmpre, 001;
     nEmpre, 999;
     ;
     NULL, BuscaEmpre;
|FIN;

|PROCESO GrabaCartera;
     aEmpre = "";
     |BUCLE BuscaEmpre;
     |SI aEmpre = "";
          aAlfa = "0000NO EXISTE serie [" + #328#0 + "] en Cartera....";
          |MENAV aAlfa;
     |SINO;
          |ABRE #324;
          #324#0 = #328#9;
          |LEE 020#324=;
          |CIERRA #324;
          nDeci_Div = #324#7;

          aAlfa = aPath + "dscarter/fich/" + aEmpre + "/";
          |PATH_DAT #16 aAlfa;
          |PATH_DAT #17 aAlfa;
          |PATH_DAT #3  aAlfa;
          |ABRE #16;
          |ABRE #17;
          |ABRE #3;
          |SELECT #6#3;
          #3#27 = 0;
          #3#0 = #328#0;
          #3#1 = #328#1;
          #3#2 = #328#2;
          #3#69 = " ";
          #3#40 = 1;
          |LEE 121#3];
          |SI FSalida = 0; |Y #3#0 = #328#0; |Y #3#1 = #328#1; |Y #3#2 = #328#2;
               #3#33 = #0#71;
               #3#14 = "M";
               #3#15 = "Gestionado por Cobrador";
               |GRABA 020#3a;
          |FINSI;
          |SI aEmpreAnt ! aEmpre;
               aEmpreAnt = aEmpre;
               |LEE 000#16u;
               |SI FSalida = 0;
                    nReme = #16#0 + 1;
               |SINO;
                    nReme = 1;
               |FINSI;
               |DDEFECTO #16;
               #16#0 = nReme;
               #16#1 = #0#71; || Cobrador
               #16#2 = #0#73; || Fecha
               |GRABA 020#16b;
          |SINO;
               #16#0 = nReme;
               |LEE 121#16=;
          |FINSI;
          |HAZ UltLin;
          |DDEFECTO #17;
          #17#0 = nReme;
          #17#1 = nLin;
          #17#3 = #328#0;
          #17#4 = #328#1;
          #17#5 = #328#2;
          #17#6 = #328#8;
          #17#7 = #328#6;
          #17#9 = #3#40;      || Documento
          #17#10 = #134#58;   || Divisa;
          #17#11 = #134#59;   || Cambio;
          |GRABA 020#17n;
          #16#3 = #16#3 + 1;
          #16#4 = #16#4 + #328#10;
          |GRABA 020#16a;
          |CIERRA #16;
          |CIERRA #17;
          |CIERRA #3;
     |FINSI;
|FPRC;

|DEFBUCLE GrabaCartera;
     #328#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, GrabaCartera;
|FIN;

|PROCESO DesCargaDef331;
     |SI aDef4 ! ""; |DESCARGA_DEF #dscam003@; |FINSI;
     |SI aDef3 ! ""; |DESCARGA_DEF #dscam017@; |FINSI;
     |SI aDef2 ! ""; |DESCARGA_DEF #dscam016@; |FINSI;
     |SI aDef1 ! ""; |DESCARGA_DEF #dscam045@; |FINSI;
|FPRC;

|PROCESO CargaDef331;
     nErr = 1;
     aDef1 = aPath + "dscarter/def/dscam045";
     |CARGA_DEF aDef1, dscam045@;
     |SI FSalida ! 0;
          aAlfa = "0000Error al cargar " + aDef1;
          |MENAV aAlfa; aDef1 = "";
          |HAZ DesCargaDef331; |ACABA;
     |FINSI;

     aDef2 = aPath + "dscarter/def/dscam016";
     |CARGA_DEF aDef2, dscam016@;
     |SI FSalida ! 0;
          aAlfa = "0000Error al cargar " + aDef2;
          |MENAV aAlfa; aDef2 = "";
          |HAZ DesCargaDef331; |ACABA;
     |FINSI;

     aDef3 = aPath + "dscarter/def/dscam017";
     |CARGA_DEF aDef3, dscam017@;
     |SI FSalida ! 0;
          aAlfa = "0000Error al cargar " + aDef3;
          |MENAV aAlfa; aDef3 = "";
          |HAZ DesCargaDef331; |ACABA;
     |FINSI;

     aDef4 = aPath + "dscarter/def/dscam003";
     |CARGA_DEF aDef4, dscam003@;
     |SI FSalida ! 0;
          aAlfa = "0000Error al cargar " + aDef4;
          |MENAV aAlfa; aDef4 = "";
          |HAZ DesCargaDef331; |ACABA;
     |FINSI;

     aAlfa = aPath + "dscarter/fich/";
     |PATH_DAT #45 aAlfa;
     nErr = 0;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO ImpreReci;
     enNumReci = #133#1;
     eaProg = "marhu331";
     |HAZ MiraRecVenta;

     eaImprime = #0#82; |QBF eaImprime;
     Impresora = eaImprime;
     |IMPRE -1;
     |SI FSalida = 0;
          aInforme = #0#75; |QBF aInforme;
          |INFOR aInforme;
          |SI FSalida = 0;
               |PRINT;
               |PIEINF;
               |FININF;
          |FINSI;
          |FINIMP;
     |FINSI;
|FPRC;

|PROCESO ImpreResto;
     |SI #328#7 ! "S";
          #134#49 = #328#0;
          #134#0 = #328#1;
          |LEE 020#134=;

          #133#4 = #328#0;
          #133#0 = #328#1;
          #133#1 = #328#2;
          |LEE 020#133=;

          |HAZ ImpreReci;
     |FINSI;
|FPRC;

|DEFBUCLE ImpreResto;
     #328#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, ImpreResto;
|FIN;

|PROCESO Impresion;
     |ABRE #328;
     |PARA i = 0; |SI i [ 68; |HACIENDO i = i + 2;
          nCam = i + 1;
          nCampo = i;
          qCampo = (nCampo/2) ! 0;
          qCampo = qCampo + 83;
          |ABRE #134;
          #134#49 = #0i;
          #134#0 = #0nCam;
          |LEE 000#134=;
          |SI FSalida = 0;
               |CIERRA #134;
               |ABRE #10;
               #10#14 = #134#49;
               #10#0  = #134#0;
               #10#1  = 1;
               |LEE 000#10=;
               |SI FSalida = 0;
                    |ABRE #11;
                    #11#52 = #10#15;
                    #11#0  = #10#2;
                    |LEE 101#11=;
                    |SI  FSalida = 0;
                         #11#2 = #0qCampo;
                         |GRABA 020#11a;
                    |FINSI;
                    |CIERRA #11;
               |FINSI;
               |CIERRA #10;
               eaImprime = #0#81; |QBF eaImprime;
               ser_fac = #134#49;
               num_fac = #134#0;
               reimp = #134#45;
               |SUB_EJECUTA_NP "agifa136";


               |SI #134#11 = #0#72;
                    |ABRE #133;
                    #133#4 = #134#49;
                    #133#0 = #134#0;
                    #133#1 = 1;
                    |LEE 000#133];
                    |PARA; |SI FSalida = 0; |Y #133#4 = #134#49; |Y #133#0 = #134#0; |HACIENDO;
                         #328#0 = #133#4;
                         #328#1 = #133#0;
                         #328#2 = #133#1;
                         |LEE 000#328=;
                         |SI FSalida = 0;
                              |HAZ ImpreReci;
                              #328#7 = "S";
                              |GRABA 020#328a;
                         |FINSI;
                         |LEE 000#133s;
                    |SIGUE;
                    |CIERRA #133;
               |FINSI;
          |FINSI;
          |CIERRA #134;
     |SIGUE;
     |CIERRA #328;
     |ABRE #134;
     |ABRE #133;
     |BUCLE ImpreResto;
     |CIERRA #133;
     |CIERRA #134;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO ReciCartera;
     aEmpre = "";
     |BUCLE BuscaEmpre;
     |SI aEmpre = "";
          aAlfa = "0000NO EXISTE serie [" + #328#0 + "] en Cartera....";
          |MENAV aAlfa;
     |SINO;
          aAlfa = aPath + "dscarter/fich/" + aEmpre + "/";
          |PATH_DAT #3 aAlfa;
          |ABRE #324;
          #324#0 = #328#9;
          |LEE 020#324=;
          |CIERRA #324;
          nDeci_Div = #324#7;

          |ABRE #3;
          |SELECT #6#3;
          #3#27 = 0;
          #3#0 = #328#0;
          #3#1 = #328#1;
          #3#2 = #328#2;
          #3#69 = " ";
          #3#40 = 1;
          |LEE 020#3];
          |SI FSalida = 0; |Y #3#0 = #328#0; |Y #3#1 = #328#1; |Y #3#2 = #328#2;
               |SI #3#14 = "P"; |O #3#14 = "C";  || Pendiente/CobroParcial
                    #328#6 = #3#31;
                    #328#10 = #3#65;
                    #328#11 = #3#40;
                    #0#76 = #0#76 + #3#31;
                    |GRABA 020#328a;
               |SINO;
                    |BORRA 020#328a;
               |FINSI;
          |SINO;
               |BORRA 020#328a;
          |FINSI;
          |CIERRA #3;
     |FINSI;
|FPRC;

|DEFBUCLE ReciCartera;
     #328#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, ReciCartera;
|FIN;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO CompruReci; |TIPO 0;
     |HAZ CargaDef331;
     |SI nErr ! 0; |ACABA; |FINSI;
     aEmpre = "";
     |BUCLE BuscaEmpre;
     |SI aEmpre = "";
          aAlfa = "0000NO EXISTE serie [" + #328#0 + "] en Cartera....";
          |MENAV aAlfa;
          |ERROR;
     |SINO;
          aAlfa = aPath + "dscarter/fich/" + aEmpre + "/";
          |PATH_DAT #3  aAlfa;
          |ABRE #3;
          |SELECT #6#3;
          #3#27 = 0;
          #3#0  = #328#0;
          #3#1  = #328#1;
          #3#2  = #328#2;
          #3#69 = " ";
          #3#40 = 1;
          |LEE 101#3];
          |SI FSalida ! 0; |O #3#27 ! 0; |O #3#0 ! #328#0; |O #3#1 ! #328#1; |O #3#2 ! #328#2;
               |MENAV "0000NO EXISTE recibo en Cartera...";
               |ERROR;
          |SINO;
               |SI #3#14 ! "P"; |Y #3#14 ! "C";  || Pendiente/CobroParcial
                    aAlfa = "0000Recibo en Situacion: " + &10 + "[" + #3#15 +"]";
                    |MENAV aAlfa;
                    |ERROR;
               |FINSI;
          |FINSI;
          |CIERRA #3;
          |HAZ DesCargaDef331;
     |FINSI;
|FPRC;

|PROCESO Tipo2; |TIPO 2;
     #0#76 = #0#76 +. #328#6;
     |PINTA #0#76;
|FPRC;

|PROCESO Min;
     #328#0 = "  ";
     #328#1 = 1;
     #328#2 = 1;
|FPRC;

|PROCESO Max;
     #328#0 = "zz";
     #328#1 = 999999;
     #328#2 = 999;
|FPRC;

|PROCESO Tipo3;
     |HAZ CreaTempo; aTempo328 = Tempo;
     |NOME_DAT #328 aTempo328; |DELINDEX #328;

     #0#76 = 0;

     |ABRE #133;
     |ABRE #134;
     |ABRE #328;
     |PARA i = 0; |SI i [ 68; |HACIENDO i = i + 2;
          nCam = i + 1;
          #134#49 = #0i;
          #134#0 = #0nCam;
          |LEE 000#134=;
          |SI FSalida = 0; |Y #134#11 = #0#72;
               #133#4 = #134#49;
               #133#0 = #134#0;
               #133#1 = 1;
               |LEE 000#133];
               |PARA; |SI FSalida = 0; |Y #133#4 = #134#49; |Y #133#0 = #134#0; |HACIENDO;
                    #328#0 = #133#4;
                    #328#1 = #133#0;
                    #328#2 = #133#1;
                    #328#3 = #134#1;
                    #328#4 = #134#2;
                    #328#5 = #134#3;
                  ||  #328#6 = #133#2;
                    #328#8 = #133#3;
                    #328#9 = #134#58;
                    |GRABA 020#328n;
                    |LEE 000#133s;
               |SIGUE;
          |FINSI;
     |SIGUE;
     |CIERRA #328;
     |CIERRA #133;
     |CIERRA #134;

     |HAZ CargaDef331;
     |SI nErr = 0;
          |BUCLE ReciCartera;
          |HAZ DesCargaDef331;
     |FINSI;
     |PINPA #0#328;
     |C_V #0#76, 1, "S";
     |PINTA #0#76;
     |ENTLINEAL #1#328, -1, 2, 22, 0, Min, Max;
     |CONFI "2400SContinuar con la Impresion...";
     |SI FSalida = 0;
          |HAZ Impresion;
          /*
               |HAZ CargaDef331;
               |SI nErr = 0;
                    |ABRE #134;
                    |BUCLE GrabaCartera;
                    |CIERRA #134;
                    |HAZ DesCargaDef331;
               |FINSI;
          */
     |FINSI;
     |DELINDEX #328;  Tempo = aTempo328; |HAZ BoraTempo;
|FPRC;

|PROGRAMA;
     |ABRE #321; |LEE 000#321p; |CIERRA #321;
     |ABRE #324;
     #324#0 = #321#9;
     |LEE 000#324=;
     |CIERRA #324;
     nDeci_Base = #324#7;

     |DFICE aAlfa; |QBF aAlfa; aAlfa = aAlfa % -106; aAlfa = aAlfa % 0105;
     nEmpre = aAlfa;
     |DBASS aPath;

     |ABRE #0;
     |LEE 101#0p;
     |SI FSalida = 0;
          aAlf1 = #0#75;
          aAlf2 = #0#77;
          aAlf3 = #0#78;
          aAlf4 = #0#79;
          aAlf5 = #0#80;
          aAlf6 = #0#81;
          aAlf7 = #0#82;
     |SINO;
          |GRABA 020#0b;
     |FINSI;
     |DDEFECTO #0;
     #0#75 = aAlf1;
     #0#77 = aAlf2;
     #0#78 = aAlf3;
     #0#79 = aAlf4;
     #0#80 = aAlf5;
     #0#81 = aAlf6;
     #0#82 = aAlf7;
     |CLS;
     |PINPA #0#0;
     |PINDA #0#0;
     |ENDATOS #1#0;
     |SI FSalida = 0;
          |HAZ Tipo3;
          |GRABA 020#0a;
     |FINSI;
     |CIERRA #0;
|FPRO;

|PROCESO verbultos; |TIPO 0;
     nCampo = Campo;
     qCampo = (nCampo/2) ! 0;
     dCampo = nCampo / 2;
     |SI qCampo = dCampo; |ACABA; |FINSI;
     |ABRE #10;
     qCampo = qCampo - 1;
     qCampo = qCampo + 83;
     qAlbar = nCampo + 1;
     #10#14 = #0qAlbar;
     #10#0  = #0nCampo;
     #10#1  = 1;
     |LEE 000#10=;
     |SI  FSalida = 0;
          |ABRE #11;
          #11#52 = #10#15;
          #11#0  = #10#2;
          |LEE 000#11=;
          |SI  FSalida = 0;
               #0qCampo = #11#2;
          |FINSI;
          |CIERRA #11;
     |FINSI;
     |PINTA #0qCampo;
     |CIERRA #10;
|FPRC;
