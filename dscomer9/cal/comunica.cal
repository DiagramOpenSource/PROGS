|FICHEROS;
    comunica #0;
|FIN;

|VARIABLES;
    cuenta = 0;
    aParam = "";
    alfa1 = "";
    alfa2 = "";
    alfa3 = "";
    alfa4 = "";
    alfa5 = "";
    alfa6 = "";
    nume1 = 0;
    nume2 = 0;
    nume3 = 0;
    nume4 = 0;
    nume5 = 0;
    nume6 = 0;
    salida = 0;
    ya_esta = 0;

    fabre = "";
    fcanl = "";
    field = "";
    ffich = "";
    fexit = 0;
    fcont = 0;
    contador = 0;
|FIN;

|PROCESO carga;
    alfa1 = #0#0;        || puerta
    nume1 = #0#2;        || velocidad
    alfa2 = #0#3;        || paridad
    nume2 = #0#4;        || bits
    nume3 = #0#5;        || bits stop
    nume4 = #0#6;        || tamanyo buffer (maximo 32000)
    nume5 = #0#7;        || nro. caracteres a leer
    alfa6 = "";          || destino de la lectura
|FPRC;

|PROCESO tipo3;
     cuenta = 0;
     Pos = -1;
     fabre = #0#8;   |QBF fabre;
     fabre = "wb  " + fabre;
     |FABRE fabre;
     |SI FSalida < 0;  |ACABA;  |FINSI;
     fcanl = FSalida;

     |HAZ carga;

     |INICIOCOM alfa1, nume1, alfa2, nume2, nume3, nume4;
     |SI FSalida < 0;
          |MENAV "0000Error en puerto...";
          |ACABA;
     |FINSI;

     alfa1 = FSalida;

     ya_esta = 0;
     |PARA; |SI ya_esta = 0; |HACIENDO;
|VARIABLES;
    {-1}nMPausa = 0;
|FIN;
            InMPausa = #0#13;
            |ESPECIFICA "MSLEEP",nMPausa;
            |LEECOM alfa1, nume5, alfa6;
            salida = FSalida;
            |SI #0#12 = "S";
                 |PINPA #0#0;
                 |PINDA #0#0;
                 |PINTA 1826, salida;
                 |PINTA 1906, alfa6;
            |FINSI;
            |SI salida ! 0;
                field = fcanl + " " + alfa6;
                |FGRABA field;
                cuenta = cuenta + 1;
                |SI cuenta ] #0#11; ya_esta = 1; |FINSI;
            |FINSI;
            |SI #0#1 = "S";
                |MENSA "    Pulse ESC o CRTL-C para terminar ...";
                |PAUSA;
                |SI FSalida = 1;|O FSalida = 7;
                    ya_esta = 1;
                |FINSI;
                |BLIN 4;
            |FINSI;
            |SI salida = 0;|Y #0#1 = "N";
                contador = contador + 1;
                |SI contador > #0#9;
                    ya_esta = 1;
                |FINSI;
            |SINO;
                contador = 0;
            |FINSI;
     |SIGUE;
     |FINCOM alfa1;
     |FCIERRA fcanl;
|FPRC;

|PROGRAMA;
     aParam = PARAMETRO;
     |SI aParam ! "";
          |ABRE #0;
          |LEE 101#0p;
          |HAZ tipo3;
          |CIERRA #0;
     |SINO;
          |CLS;
          |ABRE #0;
          |LEE 101#0p;
          |SI FSalida ! 0; |GRABA 020#0b; |FINSI;

          |PINPA #0#0;
          |PINDA #0#0;
          |ENDATOS #2#0;
          |SI FSalida = 0;
               |HAZ tipo3;
               |GRABA 020#0a;
          |FINSI;
          |CIERRA #0;
     |FINSI;
|FPRO;
