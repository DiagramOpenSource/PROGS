
 TIPO : Prepedido 'X'  Pedido 'P'   Albaran 'A'   Deposito 'D'
        Prepedido Construccion 'C'

|FICHEROS;
     agifa019 #19;
     dsm00083 #83,MANTE; || Este
     agi00028 #28;
     agifa067 #67;
     agifa080 #80;

     dsm00081 #81;
     dsm00082 #82;

     dsw00054 #540; ||Tmp Cod. Barras Tecatel
     dsw00055 #550;
     agifa219 #219;
     agifa220 #220;
     dsm00139 #139;
     dsm00279 #279;
|FIN;

|VARIABLES;
     &enSwFuerzaDA = 0;
     nLinCopia = 0;
     nBoton1 = 0;
     nBoton2 = 0;
     &aArtiDA  = ""; || Controla si cambia el articulo
                     || solo se utiliza en este calculo
     nTecla    = 0;
     nForma    = 0;
     &aTipoDA  = "";
     nSwTieneDA= 0;
     aSer      = "";
     nNume     = 0;
     nLin      = 0;
     nLinea    = 0;
     aArti     = "";
     nModo     = 0;

     aAlfa     = "";
     aDef100   = "";

     aDato     = "";
     aReg      = "";
     nPos      = 0;
     aLon      = "";
     i         = 0;
     nLon      = 0;
     n2Lin     = 0;
     nHay      = 0;
|FIN;

|RUTINA Inf;
     #83#0 = aTipoDA;
     #83#1 = aSer;
     #83#2 = nNume;
     #83#3 = nLin;
     #83#4 = 001;
|FRUT;

|RUTINA Sup;
     #83#0 = aTipoDA;
     #83#1 = aSer;
     #83#2 = nNume;
     #83#3 = nLin;
     #83#4 = 999;
|FRUT;

|PROCESO BorraDAC;
     |BORRA 020#83a;
|FPRC;

|DEFBUCLE BorraDAC;
     #83#1;
     ;
     aTipoDA, aSer, nNume, nLin, 001;
     aTipoDA, aSer, nNume, nLin, 999;
     be;
     NULL, BorraDAC;
|FIN;

|PROCESO GrabaLinDAC;
     nLinea = nLinea + 1;
     #83#0 = aTipoDA;
     #83#1 = aSer;
     #83#2 = nNume;
     #83#3 = nLin;
     #83#4 = nLinea;
     #83#5 = #82#2;
     |GRABA 020#83n;
|FPRC;

|PROCESO AltaDACLin;
     |BUCLE BorraDAC;
     |ABRE #81;
     #81#0 = aArti;
     |LEE 000#81=;
     |SI FSalida = 0; |Y #81#2 = "S";
          nLinea = 0;
          |ABRE #83;
          |BUCLELIN 2 GrabaLinDAC #81;
          |CIERRA #83;
     |FINSI;
     |CIERRA #81;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|RUTINA VarDAC;
     |SI aTipoDA = "D";
          aSer = #139#27;
          nNume = #139#0;
          nLin = #139#1;
          aArti = #139#2;
     |FINSI;
     |SI aTipoDA = "X";
          aSer = "";
          nNume = #28#0;
          nLin = #28#1;
          aArti = #28#2;
     |FINSI;
     |SI aTipoDA = "P";
          aSer = #67#28;
          nNume = #67#0;
          nLin = #67#1;
          aArti = #67#2;
     |FINSI;
     |SI aTipoDA = "A";
          aSer = #80#27;
          nNume = #80#0;
          nLin = #80#1;
          aArti = #80#2;
     |FINSI;
     aAlfa = aTipoDA % 101;
     |SI aAlfa = "C";
          aSer = "";
          nNume = (A\(aTipoDA % 206));
          nLin = (A\(aTipoDA % 803));
          aArti = aTipoDA % -120;
          aTipoDA = "C";
     |FINSI;
     |ABRE #81;
     #81#0 = aArti;
     |LEE 000#81=;
     |SI FSalida = 0;
          nSwTieneDA = 0;
     |SINO;
          nSwTieneDA = -1;
     |FINSI;
     |CIERRA #81;
|FRUT;

|PROCESO VerDAC;
     nModo = (FEntrada / 100) ! 0;

     |HAZ VarDAC;
     |PUSHV 0501 2380;
     |HAZ PonBotonDA;
     |ENTLINEAL #1#83, -5, nModo, 22, 1, Inf, Sup;
     |HAZ QuitaBotonDA;
     |POPV;
|FPRC;

|PROCESO BajaDAC;
     nModo = (FEntrada / 100) ! 0;

     |HAZ VarDAC;
     |BUCLE BorraDAC;
|FPRC;

|PROCESO AltaDAC;
     nModo = (FEntrada / 100) ! 0;
     |HAZ VarDAC;
     |SI nSwTieneDA = 0; |O enSwFuerzaDA = 1;
          |SI nModo = 1;
               |HAZ AltaDACLin;
          |FINSI;
          |PUSHV 0501 2380;
          |HAZ PonBotonDA;
          |HAZ EsTecatel;
          |SI FSalida = 0;
               |MENSA "0000<F5> Introduccion Codigo Barras";
          |FINSI;

          |ENTLINEAL #1#83, -5, 2, 22, 1, Inf, Sup;
          |HAZ QuitaBotonDA;
          |POPV;
     |FINSI;
|FPRC;

|PROCESO DescriDAC;
     |ABRE #279; |LEE 000#279p; |CIERRA #279;

     nModo = (FEntrada / 100) ! 0;
     |HAZ VarDAC;

     |SI aArtiDA ! aArti; |Y nModo = 1;
          |HAZ AltaDACLin;
          nModo = 1;
     |FINSI;

     |SI nModo = 1; |Y #81#2 = "S"; |Y nSwTieneDA = 0;
          |SI aTipoDA = "X"; |Y #279#16 = "N";
               #28#3 = #81#1;
               |PINTA #28#3;
          |FINSI;
          |SI aTipoDA = "P"; |Y #279#16 = "N";
               #67#4 = #81#1;
               |PINTA #67#4;
          |FINSI;
          |SI aTipoDA = "A"; |Y #279#16 = "N";
               #80#4 = #81#1;
               |PINTA #80#4;
          |FINSI;
          |SI aTipoDA = "D"; |Y #279#16 = "N";
               #139#4 = #81#1;
               |PINTA #139#4;
          |FINSI;
     |FINSI;
     aArtiDA  = aArti;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
                     SOLO TECATEL 000323
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO UltimoCBC;
     #550#0 = #540#0;
     #550#1 = 9999;
     |LEE 000#550];
     |SI FSalida = 0;
          |LEE 000#550a;
     |SINO;
          |LEE 000#550u;
     |FINSI;
     |SI FSalida = 0; |Y #550#0 = #540#0;
          n2Lin = #550#1 + 1;
     |SINO;
          n2Lin = 1;
     |FINSI;
|FPRC;

|PROCESO UltimaLinDAC;
     #83#0 = aTipoDA;
     #83#1 = aSer;
     aTipoDA = #83#0; aSer = #83#1; ||Formateo
     #83#2 = nNume;
     #83#3 = nLin;
     #83#4 = 999;
     |LEE 000#83];
     |SI FSalida = 0;
          |LEE 000#83a;
     |SINO;
          |LEE 000#83u;
     |FINSI;
     |SI #83#0 = aTipoDA; |Y #83#1 = aSer; |Y #83#2 = nNume; |Y #83#3 = nLin;
          n2Lin = #83#4 + 1;
     |SINO;
          n2Lin = 1;
     |FINSI;
|FPRC;

|PROCESO CargaBarC;
     aAlfa = #83#5; |QBF aAlfa;
     aLon = aAlfa % A0;
     aReg = "";
     nHay = 0;
     |PARA i = 1; |SI i [ aLon; |HACIENDO i = i + 1;
          nPos = i * 100 + 1;
          aDato = aAlfa % nPos;
          |SI aDato = "|";
               #540#0 = aReg;
               |HAZ UltimoCBC;
               #550#0 = aReg;
               #550#1 = n2Lin;
               |GRABA 020#550n;
               aReg = "";
               nHay = 1;
          |SINO;
               aReg = aReg + aDato;
          |FINSI;
     |SIGUE;
     |SI nHay ! 0; |BORRA 020#83a; |FINSI;
|FPRC;

|DEFBUCLE CargaBarC;
     #83#1;
     ;
     aTipoDA, aSer, nNume, nLin, 001;
     aTipoDA, aSer, nNume, nLin, 999;
     ;
     NULL, CargaBarC;
|FIN;

|PROCESO GrabaCodBarC;
     |HAZ UltimoCBC;
     |SI n2Lin ! 1;
          |AVISO;
          aAlfa = "0000N" + #540#0 + &13 + "El codigo existe. Continuar?";
          |CONFI aAlfa;
          |SI FSalida ! 0; |ACABA; |FINSI;
     |FINSI;
     #550#0 = #540#0;
     #550#1 = n2Lin;
     |GRABA 020#550n;
|FPRC;

|PROCESO DesCargaBarC;
     aAlfa = aReg + #550#0 + "|";
     aLon = aAlfa % A0;
     |SI aLon > nLon;
          |HAZ UltimaLinDAC;
          #83#0 = aTipoDA;
          #83#1 = aSer;
          #83#2 = nNume;
          #83#3 = nLin;
          #83#4 = n2Lin;
          #83#5 = aReg;
          |GRABA 020#83n;
          aReg = #550#0 + "|";
     |SINO;
          aReg = aReg + #550#0 + "|";
     |FINSI;
|FPRC;

|DEFBUCLE DesCargaBarC;
     #550#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, DesCargaBarC;
|FIN;

|PROCESO TecaCodBarC; |TIPO 11;
     nTecla = FSalida;

     |SI nTecla = 10;
          |HAZ DefeCompra;
          |ERROR;
     |FINSI;
     |SI nTecla = 11;
          |HAZ DefeVenta;
          |ERROR;
     |FINSI;

     |HAZ EsTecatel;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |SI nTecla = 13;   ||F5
          |PUSHV 0501 2380;
          aAlfa = Usuario; |QBF aAlfa;
          |NOME_DAT #550 aAlfa; |DELINDEX #550;
          |ABRE #550;
          |BUCLE CargaBarC;
          |DDEFECTO #540;
          |PINPA #0#540;
          |PINDA #0#540;
          |PARA; |SI; |HACIENDO;
               |ENCAMPO #0#540;
               |SI FSalida ! 0; |SAL; |FINSI;
               |HAZ GrabaCodBarC;
          |SIGUE;

          aLon = #83#5;
          aLon = aLon % A0;
          nLon = aLon;
          aReg = "";
          |BUCLE DesCargaBarC;
          |SI aReg ! "";
               nLon = 0;
               |HAZ DesCargaBarC;
          |FINSI;
          |CIERRA #550;
          |DELINDEX #550;
          |POPV;
          |PTEC 807;
     |FINSI;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO F2_83;
     |PTEC 824;
|FPRC;

|PROCESO F3_83;
     |PTEC 825;
|FPRC;

|PROCESO PonBotonDA;
     |CONTROL_SIMPLE 0, "BOTON,F2 - Establecer prede. compra", 1227, 1251, F2_83;
     nBoton1 = FSalida;
     |CONTROL_SIMPLE 0, "BOTON,F3 - Establecer prede. venta", 1253, 1277, F3_83;
     nBoton2 = FSalida;
|FPRC;

|PROCESO QuitaBotonDA;
     |FIN_CONTROL_WINDOWS nBoton2;
     |FIN_CONTROL_WINDOWS nBoton1;
     |PULSATECLA;
|FPRC;

|PROCESO EntraLin83; |TIPO 7;
     |ESTADO_CONTROL nBoton1, "ENABLE";
     |ESTADO_CONTROL nBoton2, "ENABLE";
|FPRC;

|PROCESO SalLin83; |TIPO 0;
     |ESTADO_CONTROL nBoton1, "DISABLE";
     |ESTADO_CONTROL nBoton2, "DISABLE";
|FPRC;

|PROCESO DefeCompra;
     |CONFI "0000N쭱stablecer como predeterminada en compras?";
     |SI FSalida ! 0; |ACABA; |FINSI;

     |ABRE #19;
     #19#0 = aArti;
     |LEE 000#19=;
     |CIERRA #19;

     nLinCopia = 1;
     |ABRE #81;
     |ABRE #82;
     |SALVA_FICHA #83;
     #83#4 = 1;
     |LEE 000#83];
     |PARA; |SI aTipoDA = #83#0; |Y aSer = #83#1; |Y nNume = #83#2;
               |Y nLin = #83#3; |Y FSalida = 0; |HACIENDO;
          |DDEFECTO #81;
          #81#0 = #19#0;
          #81#1 = #19#1;
          |LEE 000#81=;
          |SI FSalida ! 0; |GRABA 020#81n; |FINSI;
          #82#0 = #81#0;
          #82#1 = nLinCopia;
          |LEE 101#82=;
          #82#2 = #83#5;
          |SI FSalida = 0; |GRABA 020#82a; |FINSI;
          |SI FSalida ! 0; |GRABA 020#82n; |FINSI;
          |LIBERA #82;
          nLinCopia = nLinCopia + 1;
          |LEE 000#83s;
     |SIGUE;
     #82#1 = nLinCopia;
     |LEE 101#82];
     |PARA; |SI #82#0 = #81#0; |Y FSalida = 0; |HACIENDO;
          |BORRA 020#82a;
          |LIBERA #82;
          |LEE 101#82s;
     |SIGUE;
     |REPON_FICHA #83;
     |CIERRA #82;
     |CIERRA #81;
     |MENAV "0000Proceso Terminado";
|FPRC;

|PROCESO DefeVenta;
     |CONFI "0000N쭱stablecer como predeterminada en ventas?";
     |SI FSalida ! 0; |ACABA; |FINSI;

     |ABRE #19;
     #19#0 = aArti;
     |LEE 000#19=;
     |CIERRA #19;

     nLinCopia = 1;
     |ABRE #219;
     |ABRE #220;
     |SALVA_FICHA #83;
     #83#4 = 1;
     |LEE 000#83];
     |PARA; |SI aTipoDA = #83#0; |Y aSer = #83#1; |Y nNume = #83#2;
               |Y nLin = #83#3; |Y FSalida = 0; |HACIENDO;
          |DDEFECTO #219;
          #219#0 = #19#0;
          #219#1 = #19#1;
          |LEE 000#219=;
          |SI FSalida ! 0; |GRABA 020#219n; |FINSI;
          #220#0 = #219#0;
          #220#1 = nLinCopia;
          |LEE 101#220=;
          #220#2 = #83#5;
          |SI FSalida = 0; |GRABA 020#220a; |FINSI;
          |SI FSalida ! 0; |GRABA 020#220n; |FINSI;
          |LIBERA #220;
          nLinCopia = nLinCopia + 1;
          |LEE 000#83s;
     |SIGUE;
     #220#1 = nLinCopia;
     |LEE 101#220];
     |PARA; |SI #220#0 = #219#0; |Y FSalida = 0; |HACIENDO;
          |BORRA 020#220a;
          |LIBERA #220;
          |LEE 101#220s;
     |SIGUE;
     |REPON_FICHA #83;
     |CIERRA #220;
     |CIERRA #219;
     |MENAV "0000Proceso Terminado";
|FPRC;
