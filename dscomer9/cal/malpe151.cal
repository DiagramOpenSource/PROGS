|FICHEROS;
     malpe151 #0;
     malpe152 #1;
     malpe136 #3;
     agifa128 #4;
     agifa007 #7
     agifa019 #19;
     agifa024 #24,MANTE;
     agifa025 #25;
     agifa027 #27;
     malpe001 #10,MANTE;
     malpe081 #81;
     malpe083 #83;
     malpe087 #87,MANTE; || Pedido C
     malpe088 #88;       || Pedido L
     malpe084 #84;
     malpe085 #85;
     malpe104 #104,MANTE;
     agifa142 #142;
     malpe149 #149;
     malpe150 #150;
     agifa321 #321;
     agifa324 #324;
     malpe401 #401;
     malpe137 #137;
     malpe209 #209;
     malpe700 #700;
     referen@;
|FIN;

|VARIABLES;
     nRemanente = 0;
     aRepre = "";
     nNuevo = 0;
     nPos = 0;
     nLinIni = 0;
     nLinPed = 0;
     &eaTieneComi = "";
     &enComision1 = 0;
     &enComision2 = 0;
     &eaTipoCli = "";
     &eaRemanente = "";
     &eaTipoComi = "";
     &eaArticulo = "";
     &enDto = 0;
     nComi1 = 0;
     nComi2 = 0;
     nPorce1 = 0;
     nPorce2 = 0;
     nSal = 0;
     aCli = 0;
     aFic = "";
     aSql = "";
     aDef = "";
     nNume = 0;
     nLin = 0;
     nDias = 0;
     fFecha = @;
     nUni = 0;
     nInc = 0;
     nLin401 = 0;
     &enForma = 0;
     &aMoneda = "";
     &aDivisa = "";
     &Tempo = "";
     &eaCliente = "";
     &efFecha = @;
     &enImpCliPed = 0;
     aSerie = "";
     Tmp0 = "";
     Tmp1 = "";
     nError = 0;
     nHay = 0;
     i = 0;
 {-1}aMenu          = "";
     aMenu1         = "2400";
     aMenu2         = "1";
     aMenu3         = " Contador: ";
     aMenu4         = "AM";
     aMenu5         = " Automatico ";
     aMenu6         = " Manual ";
     aClave = "";
     nConta = 0;
     aAlfa = "";
     mes = 0;
     fmes = "";
     nImpo = 0;
     nForma = 0;
     menor = 0;
     menor_2 = 0;
     comi3_2 = 0;
     pc = 0;
     pcr = 0;
     comi3 = 0;
     tf = 0;
     dsecu = 0;
     comi1 = 0;
     comi2 = 0;
     descu = 0;
|FIN;

|CALCULO lpsubcom0;
     nRemanente = 0;
     |SI #88#55 = "N";
          #88#10 = 0;
          |ACABA;
     |FINSI;

     descu = #88#8;
     comi1 = #19#31;
     comi2 = 0;

     |ABRE #4;
     #4#0 = #88#19;
     |LEE 000#4=;
     |SI 0 = FSalida
          comi2 = #4#1;
     |FINSI;
     |CIERRA #4;

     #88#17 = #87#16;

     |SI #19#181 = "N";
          |HAZ ComiLadril;
     |SINO;
          |HAZ ComiMorte;
     |FINSI;
|FCAL;

|PROCESO ComiLadril;
     |ABRE #3;
     comi3 = 0;
     #3#0 = #88#17;
     aAlfa = #87#1; aAlfa = aAlfa % -104;
     #3#62 = aAlfa;
     #3#63 = #87#73;
     |LEE 000#3=;
     |SI 0 = FSalida;
          menor = 100;
          menor_2 = 0;
          comi3_2 = 0;
          |PARA pc = 1;|SI pc < 40;|HACIENDO pc = pc + 2;
               pcr = pc + 1;
               |SI #3pc ! 0;|Y #3pcr ! 0;
                    tf = #3pc;
                    |SI tf ] descu;|Y tf < menor;
                         menor = tf;
                         comi3 = #3pcr;
                    |SINO;
                         |SI menor_2 = 0; |Y comi3_2 = 0;
                              menor_2 = tf;
                              comi3_2 = #3pcr;
                         |FINSI;
                    |FINSI;
               |SINO;
                    |SI menor_2 = 0; |Y comi3_2 = 0;
                         tf = #3pc;
                         menor_2 = tf;
                         comi3_2 = #3pcr;
                    |FINSI;
                    pc = 40;
               |FINSI;
          |SIGUE;
          comi3 = comi3_2 - ((descu-menor_2)*((comi3_2-comi3)/(menor-menor_2)));
     |FINSI;
     |CIERRA #3;

     menor = 100;
     |SI comi1 > 0;
          menor = comi1;
     |FINSI;
     |SI comi2 > 0;|Y comi2 < menor;
          menor = comi2;
     |FINSI;
     |SI comi3 > 0;|Y comi3 < menor;
          menor = comi3;
     |FINSI;
     |SI menor = 100;
          menor = 0;
     |FINSI;
     #88#10 = menor;
     nRemanente = #3#64;
|FPRC;

|PROCESO ComiMorte;
     |ABRE #209;
     comi3 = 0;
     #209#0 = #88#17;
     aAlfa = #87#1; aAlfa = aAlfa % -104;
     #209#62 = aAlfa;
     #209#63 = #87#73;
     |LEE 000#209=;
     |SI 0 = FSalida;
          menor = 100;
          menor_2 = 0;
          comi3_2 = 0;
          |PARA pc = 1;|SI pc < 40;|HACIENDO pc = pc + 2;
               pcr = pc + 1;
               |SI #209pc ! 0;|Y #209pcr ! 0;
                    tf = #209pc;
                    |SI tf ] descu;|Y tf < menor;
                         menor = tf;
                         comi3 = #209pcr;
                    |SINO;
                         |SI menor_2 = 0; |Y comi3_2 = 0;
                              menor_2 = tf;
                              comi3_2 = #209pcr;
                         |FINSI;
                    |FINSI;
               |SINO;
                    |SI menor_2 = 0; |Y comi3_2 = 0;
                         tf = #209pc;
                         menor_2 = tf;
                         comi3_2 = #209pcr;
                    |FINSI;
                    pc = 40;
               |FINSI;
          |SIGUE;
          comi3 = comi3_2 - ((descu-menor_2)*((comi3_2-comi3)/(menor-menor_2)));
     |FINSI;
     |CIERRA #209;

     menor = 100;
     |SI comi1 > 0;
          menor = comi1;
     |FINSI;
     |SI comi2 > 0;|Y comi2 < menor;
          menor = comi2;
     |FINSI;
     |SI comi3 > 0;|Y comi3 < menor;
          menor = comi3;
     |FINSI;
     |SI menor = 100;
          menor = 0;
     |FINSI;
     #88#10 = menor;

     nRemanente = #209#64;
|FPRC;

|PROCESO Remanente0;
     |SI #88#43 ! 0; |ACABA; |FINSI;

     |SI #87#73 = "N";
          #88#65 = "N";
          #88#66 = 0;
          #88#67 = 0;
          |ACABA;
     |FINSI;

     |ABRE #81; |LEE 000#81p; |CIERRA #81;

     efFecha = #87#1;
     eaRemanente = #87#73;
     eaTieneComi = #88#55;
     eaArticulo = #88#2;
     eaTipoCli = #88#19;
     enDto = #88#8;
     eaTipoComi = #87#16;
     |HAZ BusComi0;
     nComi1 = enComision1;
     nComi2 = enComision2;

     |DDEFECTO #137;
     |ABRE #137;
     #137#0 = #87#7;
     |LEE 101#137=;
     |SI FSalida ! 0; |GRABA 020#137b; |FINSI;

     nPorce1 = (#88#5 * #88#59) * #88#8 / 100;
     nPorce2 = (#88#5 * #88#59) * nRemanente / 100;
     nImpo = nPorce2 - nPorce1;
     |SI #88#8 = nRemanente;
          #88#65 = "N";
          #88#66 = 0;
          #88#67 = nComi1;
     |FINSI;
     |SI #88#8 < nRemanente;
          #88#65 = "A";
          #88#66 = nImpo;
          #88#67 = nComi1;
          #137#3 = #137#3 + (nImpo * nForma);
     |FINSI;
     |SI #88#8 > nRemanente;
          #88#65 = "C";
          #88#66 = nImpo;
          #88#67 = nComi1;
          #137#2 = #137#2 + (nImpo * nForma);
     |FINSI;
     #137#7 = #137#1 + #137#3 + #137#2 - #137#6;
     #137#8 = #137#1 + #137#5 + #137#4 - #137#6;
     |GRABA 020#137a;
     |CIERRA #137;

     |SI #137#7 < 0;
          #88#10 = nComi2;
     |FINSI;

|FPRC;

|PROCESO CargaCabPed;
     |ABRE #24;
     #24#0 = #0#75;
     |LEE 020#24=
     |CIERRA #24;

     |ABRE #7;
     #7#26 = #0#24;
     |LEE 000#7=;
     |CIERRA #7;

     |ABRE #700;
     #700#0 = #0#3;
     #700#1 = "";
     |LEE 000#700];
     |SI FSalida = 0; |Y #700#0 = #0#3;
          aRepre = #700#1;
     |SINO;
          aRepre = #24#25;
     |FINSI;
     |CIERRA #700;

     |ABRE #25;
     #25#0 = aRepre;
     |LEE 000#25=;
     |CIERRA #25;

     |SI nNuevo = 0;
          #87#1 = ~;
          #87#2 = #0#18;
     |FINSI;
     #87#4 = #24#0;
     #87#7 = aRepre;
     #87#8 = #24#2;
     #87#9 = #24#20;     ||#0#11;
     #87#14 = #0#66;
     #87#16 = #25#7;
     #87#17 = #24#156;
     #87#19 = #0#64;
     #87#20 = #0#68;
     #87#21 = #0#69;
     #87#22 = #24#47;
     #87#23 = #24#41;
     #87#35 = #24#192;

     #324#0 = #87#35;
     |LEE 000#324=;

     #87#36 = #324#2; ||Cambio div
     #87#37 = #24#193
     #87#40 = #321#9;

     #324#0 = #87#40;
     |LEE 000#324=;

     #87#41 = #324#2; ||Cambio base
     #87#59 = #0#67;
     #87#60 = #0#15;
     #87#61 = #0#16;
     #87#62 = #0#18;
     #87#63 = #0#76;

     |ABRE #10;
     #10#0 = #87#4;
     #10#1 = #87#63;
     |LEE 000#10=;
     |CIERRA #10;

     #87#64 = #10#2;
     #87#65 = #10#3;
     #87#66 = #10#4;
     #87#67 = #0#77;
     #87#14 = #10#5;
     #87#20 = #10#6;
     aAlfa = (("00" + #10#8) % -102) + (("000" + #10#9) % -103);
     #87#59 = aAlfa;
     #87#21 = #10#7;

     #87#74 = #0#0;
     |GRABA 020#87a;
     aMoneda = #87#37;
     aDivisa =  #87#35;
     |HAZ Divisas104;
|FPRC;

|PROCESO malpe401_1;
     nLin401 = #401#1;
     |ERROR10;
|FPRC;

|DEFBUCLE malpe401_1;
     #401#3;
     ;
     #88#3, "01.01.0000", #104#4;
     #88#3, #104#4, "31.12.9999";
     be;
     NULL, malpe401_1;
|FIN;

|PROCESO ActCiclos_1;
     nLin401 = 0;
     |BUCLE malpe401_1;
     |ABRE #401;
     |SI nLin401 ! 0;
          |SELECT #1#401;
          #401#0 = #88#3;
          #401#1 = nLin401;
          |LEE 121#401=;
          |SI FSalida = 0;
               #401#6 = #401#6 + ((nUni/#84#2) * nInc);
               #401#7 = #401#5 - #401#6;
               |GRABA 020#401a;
          |FINSI;
          |SI nInc = 1; |Y #401#7 < 0;
               aAlfa = "0000Linea de servicio:" + ("000" + nLin)+&13+"No entra en ciclo. Revisar";
               ||MENAV aAlfa;
          |FINSI;
     |SINO;
          |SI nInc = 1;
               aAlfa = "0000Linea de servicio:" + ("000" + nLin)+&13+"No encuentra ciclo. Revisar";
               ||MENAV aAlfa;
          |FINSI;
     |FINSI;
     |CIERRA #401;
|FPRC;

|PROCESO CargaLinPed;
     nLinPed = nLinPed + 1;
     |DDEFECTO #88;
     #88#28 = #87#25;
     #88#0 = #87#0;
     #88#1 = nLinPed;    || #150#1;
     #88#2 = #150#2;
     #88#45 = #150#3;
          || = #150#4
     #88#4 = #150#5;
     #88#5 = #150#6;
          || = #150#7
     #88#59 = #150#8;
     #88#8 = #150#9;
          || #150#10
     |SI #150#10 = "S";
          #88#60 = #150#11; || Portes
     |FINSI;

     |DDEFECTO #19;
     |ABRE #19;
     #19#0 = #88#2;
     |LEE 000#19=;
     |CIERRA #19;
     |DDEFECTO #83;
     |ABRE #83;
     #83#0 = #88#2;
     |LEE 000#83=;
     |CIERRA #83;
     |DDEFECTO #85;
     |ABRE #85;
     #85#0 = #88#2;
     #85#1 = #88#3;
     #85#2 = #88#45;
     |LEE 000#85=;
     |SI FSalida ! 0;
          #85#3 = #19#102;
          #85#4 = #19#4;
          |GRABA 020#85n;
     |FINSI;
     |CIERRA #85;

     #88#57 = #88#5 / #85#4;

     #88#13 = #87#2;
     #88#14 = #19#30;
     #88#17 = #87#16;
     #88#18 = #19#2;
     #88#19 = #24#4;
     #88#20 = #24#0;
     #88#26 = #87#9;
     #88#54 = #83#3;
     #88#55 = #83#2;
     #88#56 = #83#4;

     #88#58 = #88#59 < #88#8;
     #88#6 = #88#58 + #88#60;

     #88#62 = "D";
     #88#63 = #88#5;

     #88#16 = #87#7;
     #88#17 = #87#16;
     #88#20 = #87#4;

     |HAZ lpsubcom0;
     |HAZ Remanente0;
     |GRABA 020#88n;

     |ABRE #84;
     #84#0 = #88#2;
     #84#1 = #88#3;
     |LEE 000#84=;
     |SI FSalida ! 0; |GRABA 020#84n; |FINSI;
     |CIERRA #84;

     nUni = #88#5;
     |SI nUni < 0; nUni = -nUni; |FINSI;
     nDias = #88#62;
     |SI #88#62 = "D  "; nDias = 1; |FINSI;
     |SI #88#62 = "S  "; nDias = 7; |FINSI;
     |SI #88#62 = "Q  "; nDias = 15; |FINSI;
     |SI #88#62 = "M  "; nDias = 30; |FINSI;
     nLin = 0;
     fFecha = #88#61;
     |ABRE #104;
     |PARA i = nUni; |SI i > 0; |HACIENDO i = i - #88#63;
          nLin = nLin + 1;
          |DDEFECTO #104;
          #104#0 = #88#28;
          #104#1 = #88#0;
          #104#2 = #88#1;
          #104#3 = nLin;
          #104#4 = fFecha;
          |SI i < #88#63;
               #104#5 = i;
          |SINO;
               #104#5 = #88#63;
          |FINSI;
          #104#8 = #88#2;
          #104#9 = #88#3;
          #104#10 = #88#45;
          |GRABA 020#104n;

          nInc = 1;
          nUni = #104#5;
          |HAZ ActCiclos_1;
          nNume = fFecha; nNume = fFecha + nDias;
          fFecha = nNume;
     |SIGUE;
     |CIERRA #104;

     enForma = 1;
     |HAZ AcumulaLin;
|FPRC;

|PROCESO ActuCli;
     |SI #88#1 < nLinIni;
          |ACABA;
     |FINSI;
     |DDEFECTO #19;
     #19#0 = #88#2;
     |LEE 000#19=;

     #24#0 = #87#4;
     |LEE 101#24=;
     |SI FSalida = 0;
          |SI #19#194 = 2;
               nImpo = ((((#88#44 * #88#6) < #88#8) < #88#29) < #87#5) < #87#17;
          |SINO;
               nImpo = ((((#88#5 * #88#6) < #88#8) < #88#29) < #87#5) < #87#17;
          |FINSI;
          |SI #142#115 = "S";
               nImpo = nImpo < #87#6;
          |FINSI;
          nImpo = nImpo * nForma;
          fmes = #87#1 % A402;
          mes = fmes - 1;
          mes = mes * 3;
          mes = mes + 114;
          #24mes = #24mes   + nImpo;     || VENTA.
          #24#150 = #24#150 + nImpo;
          |GRABA 020#24a;

          eaCliente = #malpe087#4;
          efFecha = #malpe087#1;
          enImpCliPed = nImpo;
          |HAZ AcumulaCli;
     |FINSI;
|FPRC;

|PROCESO BorraMalpe104;
     |BORRA 020#104a;
|FPRC;

|DEFBUCLE BorraMalpe104;
     #104#1;
     ;
     #88#28, #88#0, #88#1, 001;
     #88#28, #88#0, #88#1, 999;
     be;
     NULL, BorraMalpe104;
|FIN;

|PROCESO BorraLin;
     enForma = -1;
     |HAZ AcumulaLin;
     |BORRA 020#88a;
     |BUCLE BorraMalpe104;
|FPRC;

|PROCESO CreaPedido;
     nError = 1;
     |PUSHV 0101 2380;

     |ABRE #324;
     |ABRE #87;
     |ABRE #88;
     |DDEFECTO #87;
     #87#25 = #0#24;
     #87#0 = #0#25;
     |GRABA 101#87b;
     |SI FSalida = 0;
          nForma = 1;
          nLinPed = 0;
          nLinIni = nLinPed;
          nNuevo = 0;
          |HAZ CargaCabPed;
          |BUCLELIN 2 CargaLinPed #149;
          |HAZ PCalCabMalpe087;
          |CLS;
          |PINPA #0#87;
          |PINDA #0#87;
          |ENDATOS #2#87;
          |SI FSalida = 0;
               |GRABA 020#87a;
               nForma = 1;
               |ABRE #24;
               |ABRE #19;
               |BUCLELIN 2 ActuCli #87;
               |GRABA 020#87a;
               |CIERRA #19;
               |CIERRA #24;
               nError = 0;
          |SINO;
               |BUCLELIN 0 BorraLin #87;
               |BORRA 020#87c;
          |FINSI;
     |SINO;
          |SI FSalida = 100; || Ya Existe
               |LEE 121#87=;
               |SI FSalida = 0;
                    |SI #0#75 ! #87#4; |O #0#76 ! #87#63;
                         aAlfa = "0000Pedido con Cliente:"+#87#4+ " Obra:" + #87#63;
                         |MENAV aAlfa;
                         FSalida = 1;
                    |FINSI;
               |FINSI;
               |SI FSalida = 0;
                    |CONFI "0000NPedido Existente, a¤adir lineas al pedido?";
                    |SI FSalida = 0;
                         |HAZ LaClave;
                    |FINSI;
                    |SI FSalida = 0;
                         nForma = 1;

                         #88#28 = #87#25;
                         #88#0 = #87#0;
                         #88#1 = 999;
                         |LEE 000#88];
                         |SI FSalida = 0;
                              |LEE 000#88a;
                         |SINO;
                              |LEE 000#88u;
                         |FINSI;
                         |SI FSalida = 0; |Y #88#28 = #87#25; |Y #88#0 = #87#0;
                              nLinPed = #88#1;
                         |SINO;
                              nLinPed = 0;
                         |FINSI;
                         nLinIni = nLinPed;
                         nNuevo = 1;
                         |HAZ CargaCabPed;
                         |BUCLELIN 2 CargaLinPed #149;
                         |HAZ PCalCabMalpe087;

                         |CLS;
                         |PINPA #0#87;
                         |PINDA #0#87;
                         |ENDATOS #2#87;
                         |SI FSalida = 0;
                              |GRABA 020#87a;
                              nForma = 1;
                              |ABRE #24;
                              |ABRE #19;
                              |BUCLELIN 2 ActuCli #87;
                              |GRABA 020#87a;
                              |CIERRA #19;
                              |CIERRA #24;
                              nError = 0;
                         |FINSI;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
     |CIERRA #88;
     |CIERRA #87;
     |CIERRA #324;
     |POPV;
|FPRC;

|PROCESO Contador;
     |SI #142#137 = "F";
          |ABRE #27;
          #27#2 = aSerie;
          #27#0 = aClave;
          |LEE  101#27=;
          |SI FSalida ! 0;
               #27#1 = 1;
               |GRABA 020#27b;
          |FINSI;
          nConta = #27#1;
          #27#1 = #27#1 + 1;
          |GRABA 020#27a;
          |CIERRA #27;
     |FINSI;
|FPRC;

|PROCESO AsignaPedi; ||F4
     |SI #0#74 = "S";
          |MENAV "0000Oferta asignada a pedido...";
          |ERROR; |ACABA;
     |FINSI;
     |ABRE #24;
     #24#0 = #0#75;
     |LEE 000#24=;
     |SI FSalida ! 0;
          |MENAV "0000Debe de Asignar el Cliente...";
          |HAZ AsignaCli;
          |SI nError ! 0; |ERROR; |ACABA; |FINSI;
     |FINSI;
     |CIERRA #24;
     |ABRE #10;
     #10#0 = #0#75;
     #10#1 = #0#76;
     |LEE 000#10=;
     |SI FSalida ! 0;
          |MENAV "0000Debe de Asignar la Obra...";
          |HAZ AsignaObra;
          |SI nError ! 0; |ERROR; |ACABA; |FINSI;
     |FINSI;
     |CIERRA #10;

     |HAZ Bloquea149;
     |ABRE #87;
     nError = 1;
     |SI #142#85 = "S"; #0#24 = #142#186; |FINSI; || Serie por defecto
     |ENCAMPO #24#0;
     |SI FSalida = 0;
          |MENU aMenu;
          |SI FSalida = 1;
               nConta = 1;
               aSerie = #0#24;
               #87#25 = aSerie;
               #87#0 = 999999;
               |LEE 000#87];
               |SI FSalida = 0;
                    |LEE 000#87a;
               |SINO;
                    |LEE 000#87u;
               |FINSI;
               |SI FSalida  = 0; |Y #87#25 = aSerie;
                    nConta = #87#0 + 1;
               |FINSI;

               aClave = "vpedido";
               |HAZ Contador;

               #0#25 = nConta;
               nError = 0;
          |FINSI;
          |SI FSalida = 2;
               |ENCAMPO #25#0;
               |SI FSalida = 0;
                    nError = 0;
               |FINSI;
          |FINSI;
     |FINSI;
     |CIERRA #87;

     |SI nError = 0;
          |HAZ CreaPedido;
          |SI nError = 0;
               #0#74 = "S";
               |GRABA 020#0a;
          |FINSI;
     |FINSI;

     |HAZ Actualiza149;
     |PINTA #0#24;
     |PINTA #0#25;
|FPRC;

|VARIABLES
     Comodin1 = ""; Comodin2 = "";
     Cont = 0; Digito1 = 0; Digito2 = 0; Calc = 0; aCaracter = "";
     eaEntidad = ""; eaSucursal = ""; eaCuenta = ""; eaDC = "";
|FIN;

|PROCESO DigitoCtrl;
     eaEntidad = #24#32; |QBF eaEntidad; eaEntidad = eaEntidad % 104;
     eaSucursal = #24#33; |QBF eaSucursal; eaSucursal = eaSucursal % 104;
     eaCuenta = #24#30; |QBF eaCuenta; eaCuenta = eaCuenta % 110;
     eaDC = "";
     
     Digito1 = 0; Digito2 = 0;
     Comodin1 = ""; Comodin2 = "";

     |PARA Cont = 1; |SI Cont [ 4; |HACIENDO Cont = Cont + 1;
        Calc = 0 - ((100 * Cont) + 1);
        aCaracter = eaSucursal % Calc;
        |SI aCaracter = ""; aCaracter = "0"; |FINSI;
        Comodin1 = Comodin1 + aCaracter;
     |SIGUE;
     |PARA Cont = 1; |SI Cont [ 4; |HACIENDO Cont = Cont + 1;
        Calc = 0 - ((100 * Cont) + 1);
        aCaracter = eaEntidad % Calc;
        |SI aCaracter = ""; aCaracter = "0"; |FINSI;
        Comodin1 = Comodin1 + aCaracter;
     |SIGUE;

     |PARA Cont = 1; |SI Cont [ 8; |HACIENDO Cont = Cont + 1;
        Calc = (100 * Cont) + 1;
        aCaracter = Comodin1 % Calc; Calc = aCaracter;
        |SI Cont = 1; Digito1 = Digito1 + (Calc * 6);  |FINSI;
        |SI Cont = 2; Digito1 = Digito1 + (Calc * 3);  |FINSI;
        |SI Cont = 3; Digito1 = Digito1 + (Calc * 7);  |FINSI;
        |SI Cont = 4; Digito1 = Digito1 + (Calc * 9);  |FINSI;
        |SI Cont = 5; Digito1 = Digito1 + (Calc * 10); |FINSI;
        |SI Cont = 6; Digito1 = Digito1 + (Calc * 5);  |FINSI;
        |SI Cont = 7; Digito1 = Digito1 + (Calc * 8);  |FINSI;
        |SI Cont = 8; Digito1 = Digito1 + (Calc * 4);  |FINSI;
     |SIGUE;

     Digito1 = 11 - (Digito1 $ 11);
     |SI Digito1 = 10; Digito1 = 1; |FINSI;
     |SI Digito1 = 11; Digito1 = 0; |FINSI;

     |PARA Cont = 1; |SI Cont [ 10; |HACIENDO Cont = Cont + 1;
        Calc = 0 - ((100 * Cont) + 1);
        aCaracter = eaCuenta % Calc;
        |SI aCaracter = ""; aCaracter = "0"; |FINSI;
        Comodin2 = Comodin2 + aCaracter;
     |SIGUE;

     |PARA Cont = 1; |SI Cont [ 10; |HACIENDO Cont = Cont + 1;
        Calc = (100 * Cont) + 1;
        aCaracter = Comodin2 % Calc; Calc = aCaracter;
        |SI Cont = 1;  Digito2 = Digito2 + (Calc * 6);  |FINSI;
        |SI Cont = 2;  Digito2 = Digito2 + (Calc * 3);  |FINSI;
        |SI Cont = 3;  Digito2 = Digito2 + (Calc * 7);  |FINSI;
        |SI Cont = 4;  Digito2 = Digito2 + (Calc * 9);  |FINSI;
        |SI Cont = 5;  Digito2 = Digito2 + (Calc * 10); |FINSI;
        |SI Cont = 6;  Digito2 = Digito2 + (Calc * 5);  |FINSI;
        |SI Cont = 7;  Digito2 = Digito2 + (Calc * 8);  |FINSI;
        |SI Cont = 8;  Digito2 = Digito2 + (Calc * 4);  |FINSI;
        |SI Cont = 9;  Digito2 = Digito2 + (Calc * 2);  |FINSI;
        |SI Cont = 10; Digito2 = Digito2 + (Calc * 1);  |FINSI;
     |SIGUE;

     Digito2 = 11 - (Digito2 $ 11);
     |SI Digito2 = 10; Digito2 = 1; |FINSI;
     |SI Digito2 = 11; Digito2 = 0; |FINSI;

     eaDC = Digito1 + Digito2;
|FPRC;

|PROCESO AsignaCamCli;
     #24#1 = #0#64;
     #24#2 = #0#64;
     #24#5 = #0#66;
     #24#6 = #0#68;
     aAlfa = #0#67 % 102;
     #24#178 = aAlfa;
     aAlfa = #0#67 % 303;
     #24#179 = aAlfa;
     #24#180 = #0#67;
     #24#7 = #0#69;
     #24#8 = #0#70;
     #24#9 = #0#72;
     aAlfa = #0#71 % 102;
     #24#181 = aAlfa;
     aAlfa = #0#71 % 303;
     #24#182 = aAlfa;

     #24#184 = #24#181;
     #24#185 = #24#182;
     #24#186 = #24#183;

     #24#10 = #0#73;
     #24#11 = #24#8;
     #24#12 = #24#9;
     #24#13 = #24#10;

     aAlfa = "000000000000" + #24#0;
     |QBT aAlfa;
     nPos = -(100 + (#142#11 - 2));
     aAlfa = aAlfa % nPos;
     aAlfa = "43" + aAlfa;
     #24#16 = aAlfa;

     aAlfa = #0#29 - "+34"; |QBT aAlfa;
     #24#17 = aAlfa;
     aAlfa = #0#30 - "+34"; |QBT aAlfa;
     #24#18 = aAlfa;

     aAlfa = #0#13 % 0104;
     #24#32 = aAlfa;
     aAlfa = #0#13 % 0504;
     #24#33 = aAlfa;
     aAlfa = #0#13 % 1110;
     #24#30 = aAlfa;
     |HAZ DigitoCtrl;
     #24#31 = eaDC;

     #24#20 = #0#11;
     #24#22 = #0#17;

     #24#15 = #0#65; |C_M #24#15, 1, "N";
|FPRC;

|PROCESO AsignaCamObra;
     |ABRE #24
     #24#0 = #0#75;
     |LEE 020#24=;
     |CIERRA #24;

     #10#0 = #0#75;
     #10#1 = #0#76;

||     #10#2 = #0#38 % 140;
||     #10#3 = #0#38 % -120;
     #10#2 = #0#54 % 140;
     #10#3 = #0#54 % -110;

     #10#4 = "";
     #10#5 = #0#50;
     #10#6 = #0#52;
     #10#7 = #0#53;
     aAlfa = #0#51; aAlfa = aAlfa % 102;
     #10#8 = aAlfa;
     aAlfa = #0#51; aAlfa = aAlfa % -103;
     #10#9 = aAlfa;
     #10#10 = #0#61;
     #10#11 = #0#77;
     #10#12 = #0#46;
     #10#13 = #0#47;
     #10#14 = #0#49;
     #10#15 = #24#1;
     #10#18 = #0#57;
     #10#19 = #0#58;
     aAlfa = #0#56; aAlfa = aAlfa % 102;
     #10#20 = aAlfa;
     aAlfa = #0#56; aAlfa = aAlfa % -103;
     #10#21 = aAlfa;
     #10#24 = #0#60;
     aAlfa = #0#55; aAlfa = aAlfa % 3535;
     #10#27 = aAlfa;
     #10#32 = #0#48;
     #10#34 = #0#63;
     #10#35 = #0#62;
     #10#36 = #0#1;
     #10#37 = #0#3;
     #10#39 = #0#2;
     aAlfa = #0#55 % 135;
     #10#17 = aAlfa;
     aAlfa = #0#55 % 36;
     #10#27 = aAlfa;
     #10#41 = #149#78;
     #10#42 = #149#79;
|FPRC;

|PROCESO Bloquea149;
     #149#0 = #0#0;
     |LEE 121#149=;
     |SI FSalida = 0;
          #0#75 = #149#75;
          #0#76 = #149#76;
          #0#24 = #149#24;
          #0#25 = #149#25;
          #0#74 = #149#74;
          |GRABA 020#0a;
          |PINTA #0#75;
          |PINTA #0#76;
          |PINTA #0#24;
          |PINTA #0#25;
     |FINSI;
|FPRC;

|PROCESO Actualiza149;
     |DDEFECTO #10;
     |ABRE #10;
     #10#0 = #0#75;
     #10#1 = #0#76;
     |LEE 000#10=;
     |CIERRA #10;

     |LEE 020#0=;
     #149#75 = #0#75;
     #149#76 = #0#76;
     #149#24 = #0#24;
     #149#25 = #0#25;
     #149#74 = #0#74;
     |GRABA 020#149a;
     |LIBERA #149;
|FPRC;

|PROCESO AsignaObra; ||F3
     |SI #0#74 = "S";
          |MENAV "0000Oferta asignada a pedido...";
          |ERROR; |ACABA;
     |FINSI;
     |HAZ AsignaCli;
     |SI nError = 0;
          nError = 1;
          |HAZ Bloquea149;
          |SI #0#76 = 0; #0#76 = 1; |FINSI;
          |ENCAMPO #76#0;
          |SI FSalida = 0; |O FSalida = 6;
               |ABRE #10;
               #10#0 = #0#75;
               #10#1 = #0#76;
               |LEE 000#10=;
               |SI FSalida = 0;
                    |GRABA 020#0a;
                    nError = 0;
               |SINO;
                    |PUSHV 0101 2380;
                    |CLS;
                    |HAZ AsignaCamObra;
                    |PINPA #0#10;
                    |PINDA #0#10;
                    |GRABA 020#10b;
                    |SI FSalida = 0;
                         |CONFI "0000SConfirma alta (S/N).:";
                         |SI FSalida = 0;
                              |ENDATOS #2#10;
                              |SI FSalida  = 0;
                                   |GRABA 020#10a;
                                   |GRABA 020#0a;
                                   nError = 0;
                              |SINO;
                                   |BORRA 000#10c;
                              |FINSI;
                         |SINO;
                              |BORRA 000#10c;
                         |FINSI;
                    |FINSI;
                    |POPV;
               |FINSI;
               |CIERRA #10;
          |FINSI;
          |HAZ Actualiza149;
     |FINSI;
     |PINTA #0#75
     |PINTA #0#76
|FPRC;

|PROCESO Min24;
     #24#15 = #0#65;
|FPRC;

|PROCESO Max24;
     #24#15 = #0#65;
|FPRC;

|PROCESO AsignaCli; ||F2
     |SI #0#74 = "S";
          |MENAV "0000Oferta asignada a pedido...";
          |ERROR; |ACABA;
     |FINSI;
     |HAZ Bloquea149;
     nError = 1;
     |ABRE #24;
     |SELECT #4#24;
     aAlfa = #0#65; |QBF aAlfa;
     #24#15 = #0#65;
     |LEE 000#24=;
     |SI FSalida = 0; |Y aAlfa ! "";
          aAlfa = #24#0;
          |LEE 000#24s;       ||Hay mas de un NIF igual
          |SI #24#15 = #0#65;
               |LEE 000#24=;
               |CONSULTA_F_CLAVE #4#24, Min24, Max24;
               |SI FSalida ! 0;
                    nError = 1;
               |SINO;
                    #0#75 = #24#0;
                    |PINTA #0#75;
                    |GRABA 020#0a;
                    nError = 0;
               |FINSI;
          |SINO;
               #0#75 = aAlfa;
               |PINTA #0#75;
               |GRABA 020#0a;
               nError = 0;
          |FINSI;
     |SINO;
          |ENCAMPO #75#0;
          |SELECT #1#24;
          #24#0 = #0#75;
          |LEE 000#24=;
          |SI FSalida = 0;
               |GRABA 020#0a;
               nError = 0;
          |SINO;
               |PUSHV 0101 2380;
               |CLS;
               |HAZ AsignaCamCli;
               |PINPA #0#24;
               |PINDA #0#24;
               |GRABA 020#24b;
               |SI FSalida = 0;
                    |CONFI "0000SConfirma alta (S/N).:";
                    |SI FSalida = 0;
                         |ENDATOS #2#24;
                         |SI FSalida  = 0;
                              |GRABA 020#24a;
                              |GRABA 020#0a;
                              nError = 0;
                         |SINO;
                              |BORRA 020#24c;
                         |FINSI;
                    |SINO;
                         |BORRA 020#24c;
                    |FINSI;
               |FINSI;
               |POPV;
          |FINSI;
     |FINSI;
     |CIERRA #24;

     |HAZ Actualiza149;
     |PINTA #0#75
|FPRC;

|PROCESO Min10;
     #10#0 = #0#75;
     #10#1 = 1;
|FPRC;

|PROCESO Max10;
     #10#0 = #0#75;
     #10#1 = 9999;
|FPRC;

|PROCESO Tipo151_66; |TIPO 66;
     |SI Campo = 75;
          |ABRE #24;
          #24#0 = #0#75;
          |LEE 000#24];
          |CONSULTA_CLAVE #1#24;
          |SI FSalida = 0;
               #0#75 = #24#0; |PINTA #0#75;
          |SINO;
               |ERROR;
          |FINSI;
          |CIERRA #24;
     |FINSI;
     |SI Campo = 76;
          |ABRE #10;
          #10#0 = #0#75;
          #10#1 = #0#76;
          |LEE 000#10];
          |CONSULTA_F_CLAVE #1#10, Min10, Max10;
          |SI FSalida = 0;
               #0#75 = #10#0; |PINTA #0#75;
               #0#76 = #10#1; |PINTA #0#76;
          |SINO;
               |ERROR;
          |FINSI;
          |CIERRA #10;
     |FINSI;
|FPRC;

|PROCESO Tipo151_11; |TIPO 11;
     |SI FSalida = 10; |HAZ PintaObse; |HAZ AsignaCli; |FINSI;
     |SI FSalida = 11; |HAZ PintaObse; |HAZ AsignaObra; |FINSI;
     |SI FSalida = 12; |HAZ PintaObse; |HAZ AsignaPedi; |FINSI;
     |SI FSalida = 13; |HAZ VerOferta; |FINSI;
|FPRC;

|PROCESO Tipo151_0; |TIPO 0;
     |SI #0Campo = Contenido; |Y FSalida = 0;
          |ENTLINEAL #1#1, 1, 4, 22, 0, Min1, Max1;
          |ERROR;
     |FINSI;
|FPRC;

|PROCESO Tipo151_7; |TIPO 7;
     |ENTLINEAL #1#1, 1, 7, 22, 0, Min1, Max1;
|FPRC;

|PROCESO OfertaLin;
     |PARA i = 0; |SI i [ 11; |HACIENDO i = i + 1;
          #1i = #150i;
     |SIGUE;
     |GRABA 020#1n;
|FPRC;

|PROCESO OfertaCab;
     |PARA i = 0; |SI i [ 77; |HACIENDO i = i + 1;
          #0i = #149i;
     |SIGUE;
     |GRABA 020#0n;
     nHay = 1;
|FPRC;

|DEFBUCLE Ofertas;
     #149#1;
     74;
     "             ", "N";
     "zzzzzzzzzzzzz", "N";
     ;
     NULL, OfertaCab, OfertaLin;
|FIN;

|PROCESO Min1;
     #1#0 = #0#0;
     #1#1 = 001;
|FPRC;

|PROCESO Max1;
     #1#0 = #0#0;
     #1#1 = 999;
|FPRC;

|PROCESO Min0;
     #0#0 = " " * 13;
|FPRC;

|PROCESO Max0;
     #0#0 = "z" * 13;
|FPRC;

|PROGRAMA;
     |CLS;
     |PINPA #0#0;
     |PINDA #0#0;
     |ENTLINEAL #1#0, 1, 7, 13, 0, Min0, Max0;
     |ENTLINEAL #1#1, 1, 7, 22, 0, Min1, Max1;

     |HAZ CreaTempo; Tmp0 = Tempo; |NOME_DAT #0 Tempo; |DELINDEX #0;
     |HAZ CreaTempo; Tmp1 = Tempo; |NOME_DAT #1 Tempo; |DELINDEX #1;
     |ABRE #0;
     |ABRE #1;
     |MENSA "0000Cargando ofertas pendientes...";
     |BUCLE Ofertas;
     |CIERRA #1;
     |CIERRA #0;
     |SI nHay = 0;
          |MENAV "0000No hay ofertas pendientes de actualizar...";
     |SINO;
          |ABRE #142; |LEE 000#142p; |CIERRA #142;
          |ABRE #321; |LEE 000#321=; |CIERRA #321;
          |ABRE #149;
          |ENTLINEAL #1#0, 1, 4, 13, 0, Min0, Max0;
          |CIERRA #149;
     |FINSI;

     Tempo = Tmp0; |HAZ BoraTempo; |DELINDEX #0;
     Tempo = Tmp1; |HAZ BoraTempo; |DELINDEX #1;
|FPRO;

|PROCESO LaClave;
     |ABRE #81; |LEE 000#81p; |CIERRA #81;
     |PUSHV 2401 2480;
     |ATRI S;
     |PINTA 2425, " Introduzca Clave:             ";
     |ATRI 0;
     E_sup = 10;
     E_inf = "";
     aAlfa = "";
     aAlfa = 2445 ? -1;
     |SI FSalida ! 0; aAlfa = ""; |FINSI;
     |POPV;

     |SI aAlfa ! #81#1;
          |MENAV "0000Clave incorrecta...";
          FSalida = 1;
     |SINO;
          FSalida = 0;
     |FINSI;
|FPRC;

|PROCESO PintaObse;
     |ABRE #149;
     #149#0 = #0#0;
     |LEE 020#149=;
     |CIERRA #149;

     |PUSHV 0501 2380;
     |BLANCO 0914 1977;
     |CUADRO 0914 1977;

     |ATRI S; |PINTA 915, " NOTA "; |ATRI 0;
     |PINTA 1016, #149#39;
     |ATRI S; |PINTA 1115, " OBSERVACIONES "; |ATRI 0;
     |PINTA 1216, #149#40;
     |PINTA 1316, #149#41;
     |PINTA 1416, #149#42;
     |PINTA 1516, #149#43;
     |ATRI S; |PINTA 1615, " OBSERVACIONES FABRICA "; |ATRI 0;
     |PINTA 1716, #149#44;

     |PINTA 1847, "Pulse 'Fin' para continuar...";
     |PARA aAlfa = ""; |SI aAlfa ! "816"; |HACIENDO;
          |LEETECLA aAlfa;
          aAlfa = aAlfa % 2;
     |SIGUE;
     |POPV;
|FPRC;

|PROCESO VerOferta;
     |PUSHV 0501 2380;
     |ABRE #149;
     #149#0 = #0#0;
     |LEE 020#149=;
     |CIERRA #149;
     |PINPA #0#149;
     |PINDA #0#149;
     |ENDATOS #4#149;
     |POPV;
|FPRC;
