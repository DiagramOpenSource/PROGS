     En el cliprw06.cal esta el original !!!

|FICHEROS;
     cliprw07 #0;
     clipr001 #1;   ||Empresa
     cliprw06 #6;   ||Tmp errores
     clipr007 #7;   ||Cto
     clipr015 #15;  ||Centro
     clipr079 #79;  ||Centros cto
     agifa041 #41;
     clipr999 #999;
     clipr054 #54;
     clipr055 #55;
     clipr084 #84;
     agifa040 #40;
|FIN;

|VARIABLES;
     nSal = 0;
     &Tempo = "";
     &enError = 0;
     &eaError = "";
     nSwCheck = 0;
     nError = 0;
     nInfor = 1;
     nImpre = 1;
     aAtri = "N";
  {1}aLocal = "";
  {1}aContiene = "";
     nPrime2 = 0;
     aEmpAnt = "";
     aPath = "";
     aFin = "";
     aTab = "";
     nBoton1 = 0;
     aRuta = "";
     aFic = "";
     aAlfa = "";
     aEmp = "";
     fFecha = @;
     nHandle = 0;
     nHandleA = 0;
     nHandleB = 0;
     nHandle1 = 0;
     nHandle2 = 0;
     nHandle2b = 0;
     nHandle3 = 0;
     nHayA = 0;
     nHayB = 0;
     nHay1 = 0;
     nHay2 = 0;
     nHay2b = 0;
     nHay3 = 0;
     nFila1 = 1;
     nFila2 = 1;
     nFila2b = 1;
     nFila3 = 1;
     aDato = "";
     aMd5Org = "";
     aMd5Des = "";
     aOrg = "";
     aDes = "";
     aBase = "";
     aBaseOrg = "";
     aIP = "";
     aExe = "";
     aPathDes = "";
     aDocumen = "";
     aFormato = "";
     nCentros = 0;
     aBaseDatos = "";
     i = 0;
     j = 0;
|FIN;

|PROCESO QuitaRaros;
     |ANSI_OEM aAlfa, aAlfa;
|FPRC;

|PROCESO CopiaFichero;
     |COPIA_FICHERO aOrg, aDes;
|FPRC;

|PROCESO RCopiaFichero;
     |ENVIA_FICHERO aOrg, aDes;
|FPRC;

|PROCESO RCopiaExe;
     aContiene = aOrg;
     |ESPECIFICA "MD5", aContiene;
     aMd5Org = FSalida;

     aContiene = aDes;
     |ESPECIFICA "REMOTOMD5", aContiene;
     aMd5Des = FSalida;

     |SI aMd5Org ! aMd5Des;
          |ENVIA_FICHERO aOrg, aDes;
     |FINSI;
|FPRC;

|PROCESO CopiaExe;
     aContiene = aOrg;
     |ESPECIFICA "MD5", aContiene;
     aMd5Org = FSalida;

     aContiene = aDes;
     |ESPECIFICA "MD5", aContiene;
     aMd5Des = FSalida;

     |SI aMd5Org ! aMd5Des;
          |COPIA_FICHERO aOrg, aDes;
     |FINSI;
|FPRC;

|PROCESO FicAccess;
     ||CIF DEL SERVICIO DE PREVENCIÓN.
     aAlfa = #41#5 + aTab;
     |XGRABA nHandle, aAlfa;

     ||REFERENCIA (FECHA)
     fFecha = #0#3;
     aAlfa = (fFecha % 102) + "/" + (fFecha % 402) + "/" + (fFecha % 704) + aTab;
     |XGRABA nHandle, aAlfa;

     ||CIF DE LA EMPRESA
     aAlfa = #1#9 + aTab;
     |XGRABA nHandle, aAlfa;

     ||RAZON SOCIAL (SERVICIO DE PREVENCIÓN)
     aAlfa = #41#1 + aTab;
     |HAZ QuitaRaros;
     |XGRABA nHandle, aAlfa;

     ||NOMBRE DE LA EMPRESA.
     aAlfa = #7#4 + aTab;
     |HAZ QuitaRaros;
     |XGRABA nHandle, aAlfa;

     ||DOMICILIO
     aAlfa = #1#14 + aTab;
     |HAZ QuitaRaros;
     |XGRABA nHandle, aAlfa;

     ||LOCALIDAD
     aAlfa = #1#15 + aTab;
     |HAZ QuitaRaros;
     |XGRABA nHandle, aAlfa;

     ||PROVINCIA
     aAlfa = #1#19 + aTab;
     |HAZ QuitaRaros;
     |XGRABA nHandle, aAlfa;

     ||TELÉFONO
     aAlfa = #1#20 + aTab;
     |XGRABA nHandle, aAlfa;

     ||CODIGO POSTAL
     aAlfa = #1#18 + aTab;
     |XGRABA nHandle, aAlfa;

     ||PLANTILLA
     aAlfa = #1#13 + aTab;
     |XGRABA nHandle, aAlfa;

     ||FECHA DEL CONCIERTO
     aAlfa = (#7#2 % 102) + "/" + (#7#2 % 402) + "/" + (#7#2 % 704) + aTab;
     |XGRABA nHandle, aAlfa;

     ||DURACIÓN
     aAlfa = "1 AÑO" + aTab;
     |XGRABA nHandle, aAlfa;

     ||FECHA DE BAJA
     aAlfa = (#7#95 % 102) + "/" + (#7#95 % 402) + "/" + (#7#95 % 704) + aTab;
     |XGRABA nHandle, aAlfa;

     ||CNAE93
     aAlfa = #1#12 + aTab;
     |XGRABA nHandle, aAlfa;

     |DDEFECTO #54;
     #54#0 = #1#12;
     |LEE 000#54=;

     ||ACTIVIDAD
     aAlfa = #54#1 + aTab;
     |HAZ QuitaRaros;
     |XGRABA nHandle, aAlfa;

     ||ACTIVIDAD PREVENTIVA
     |SI #7#98 = "2";
          aAlfa = "2- EVALUACION INICIAL Y PLANIFICACION";
     |SINO;
          aAlfa = "4-SOLO ALGUNA ESPECIALIDAD PREVENTIVA (2)";
     |FINSI;
     aAlfa = aAlfa + aTab;
     |XGRABA nHandle, aAlfa;

     ||(2) INDICAR QUE ESPECIALIDAD PREVENTIVA
     |SI #7#98 = "4";
          aAlfa = "VIGILANCIA DE LA SALUD" + aTab;
     |SINO;
          aAlfa = aTab;
     |FINSI;
     |XGRABA nHandle, aAlfa;

     ||VIGILANCIA DE LA SALUD (1)
     aAlfa = #7#97 + aTab;  || (*)
     |HAZ QuitaRaros;
     |XGRABA nHandle, aAlfa;

     ||INCLUIDA EN ANEXO (1)
     aAlfa = #7#55 + aTab + aFin;
     |HAZ QuitaRaros;
     |XGRABA nHandle, aAlfa;
|FPRC

|PROCESO FicheroA;
     nHayA = 1;
     nHandle = nHandleA;
     |HAZ FicAccess;
|FPRC;

|PROCESO FicheroB;
     nHayB = 1;
     nHandle = nHandleB;
     |HAZ FicAccess;
|FPRC;

|PROCESO IniFormatos;
     aAlfa = "[FICHERO]#" + aPathDes + "clipersal1.doc" + aFin;
     |XGRABA nHandle1, aAlfa;
     aAlfa = "[FICHERO]#" + aPathDes + "clipersal2.doc" + aFin;
     |XGRABA nHandle2, aAlfa;
     aAlfa = "[FICHERO]#" + aPathDes + "clipersal2b.doc" + aFin;
     |XGRABA nHandle2b, aAlfa;
     aAlfa = "[FICHERO]#" + aPathDes + "clipersal3.doc" + aFin;
     |XGRABA nHandle3, aAlfa;
|FPRC;

|PROCESO FinFormatos;
     || Borra la tabla inicial
     aAlfa = "T" + aFin + "}1}1}1}+A" + aFin + "[B]" + aFin;
     |XGRABA nHandle1, aAlfa;

     aAlfa = "T" + aFin + "}1}1}1}+A" + aFin + "[B]" + aFin;
     |XGRABA nHandle2, aAlfa;

     aAlfa = "T" + aFin + "}1}1}1}+A" + aFin + "[B]" + aFin;
     |XGRABA nHandle2b, aAlfa;

     aAlfa = "T" + aFin + "}1}1}1}+A" + aFin + "[B]" + aFin;
     |XGRABA nHandle3, aAlfa;
|FPRC;

|PROCESO CreaTablaForma1;
     nHay1 = 1;

     aAlfa = aDato; |HAZ QuitaRaros; aDato = aAlfa;

     nFila1 = nFila1 + 1;
     aAlfa = "T" + aFin + "}1}1}1}+G" + aFin + aFin;
     aAlfa = aAlfa + "T" + aFin + "}1}1}1}+P" + aFin + aFin;
     |SI aAtri = "S";
          aAlfa = aAlfa + "T" + aFin + "}1}" + nFila1 + "}1}+A" + aFin + aDato + aFin;
     |SINO;
          aAlfa = aAlfa + "T" + aFin + "}1}" + nFila1 + "}1}" + aFin + aDato + aFin;
     |FINSI;
     |XGRABA nHandle1, aAlfa;
|FPRC;

|PROCESO CreaTablaForma2;
     nHay2 = 1;

     aAlfa = aDato; |HAZ QuitaRaros; aDato = aAlfa;

     nFila2 = nFila2 + 1;
     aAlfa = "T" + aFin + "}1}1}1}+G" + aFin + aFin;
     aAlfa = aAlfa + "T" + aFin + "}1}1}1}+P" + aFin + aFin;
     |SI aAtri = "S";
          aAlfa = aAlfa + "T" + aFin + "}1}" + nFila2 + "}1}+A" + aFin + aDato + aFin;
     |SINO;
          aAlfa = aAlfa + "T" + aFin + "}1}" + nFila2 + "}1}" + aFin + aDato + aFin;
     |FINSI;
     |XGRABA nHandle2, aAlfa;
|FPRC;

|PROCESO CreaTablaForma2b;
     nHay2b = 1;

     aAlfa = aDato; |HAZ QuitaRaros; aDato = aAlfa;

     nFila2b = nFila2b + 1;
     aAlfa = "T" + aFin + "}1}1}1}+G" + aFin + aFin;
     aAlfa = aAlfa + "T" + aFin + "}1}1}1}+P" + aFin + aFin;
     |SI aAtri = "S";
          aAlfa = aAlfa + "T" + aFin + "}1}" + nFila2b + "}1}+A" + aFin + aDato + aFin;
     |SINO;
          aAlfa = aAlfa + "T" + aFin + "}1}" + nFila2b + "}1}" + aFin + aDato + aFin;
     |FINSI;
     |XGRABA nHandle2b, aAlfa;
|FPRC;

|PROCESO CreaTablaForma3;
     nHay3 = 1;

     aAlfa = aDato; |HAZ QuitaRaros; aDato = aAlfa;

     nFila3 = nFila3 + 1;
     aAlfa = "T" + aFin + "}1}1}1}+G" + aFin + aFin;
     aAlfa = aAlfa + "T" + aFin + "}1}1}1}+P" + aFin + aFin;
     |SI aAtri = "S";
          aAlfa = aAlfa + "T" + aFin + "}1}" + nFila3 + "}1}+A" + aFin + aDato + aFin;
     |SINO;
          aAlfa = aAlfa + "T" + aFin + "}1}" + nFila3 + "}1}" + aFin + aDato + aFin;
     |FINSI;
     |XGRABA nHandle3, aAlfa;
|FPRC;

|PROCESO Formato1;
     aAtri = "S";
     aDato = "[A]101 [T]EMPRESA: " + #1#1;
     |HAZ CreaTablaForma1;
     aAtri = "N";

     aDato = "Domicilio Social: " + #1#14; |QBF aDato;
     aDato = aDato + "; " + #1#18 + " " + #1#15;
     |QBF aDato;
     aDato = aDato + "-" + #1#19;
     |QBF aDato;
     |HAZ CreaTablaForma1;

     aDato = "CIF: " + #1#9;
     |HAZ CreaTablaForma1;

     aDato = "Tlfno: " + #1#20;
     |HAZ CreaTablaForma1;

     aDato = "Trabajadores: " + #1#13;
     |HAZ CreaTablaForma1;

     aDato = "Actividad: " + #1#12 + ". " + #1#54;
     |QBF aDato;
     |HAZ CreaTablaForma1;

     aDato = " ";
     |HAZ CreaTablaForma1;

     fFecha = #7#2;
     aAlfa = fFecha;
     fFecha = fFecha % A2;
     aAlfa = fFecha - aAlfa;
     aDato = "CONCERTO A FECHA " + aAlfa + " EN EL SIGUIENTE CENTRO DE TRABAJO.";
     |HAZ CreaTablaForma1;

     aDato = " ";
     |HAZ CreaTablaForma1;

     aDato = #15#2;
     |QBF aDato;
     |SI aDato = "ITINERANTE";
          aDato = "ITINERANTE.";
     |SINO;
          aDato = #15#2
          |QBF aDato;
          aDato = aDato + "; " + #15#6 + " " + #15#3
          |QBF aDato;
          aDato = aDato + "-" + #15#7;
          |QBF aDato;
     |FINSI;
     |HAZ CreaTablaForma1;

     |SI #7#98 = "2";
          aDato = "Actividad Preventiva: Evaluacion Inicial y Planificacion Preventiva";
     |SINO;
          aDato = "Actividad Preventiva: Solo alguna especialidad preventiva";
     |FINSI;
     |HAZ CreaTablaForma1;

     |SI #7#55 = "S";
          aDato = "Anexo I: Si";
     |SINO;
          aDato = "Anexo I: No";
     |FINSI;
     |HAZ CreaTablaForma1;

     ||SI #7#97 = "S";  *
     |SI #15#25 = "S";
          aDato = "Vigilancia de la Salud: Si";
     |SINO;
          aDato = "Vigilancia de la Salud: No";
     |FINSI;
     |HAZ CreaTablaForma1;

     aDato = " ";
     |HAZ CreaTablaForma1;
     |HAZ CreaTablaForma1;
|FPRC;

|PROCESO Formato2;
     |SI nPrime2 = 0;
          nPrime2 = 1;
          aAtri = "S";
          aDato = "[A]101 [T]EMPRESA: " + #1#1;
          |HAZ CreaTablaForma2;
          aAtri = "N";

          aDato = "Domicilio Social: " + #1#14; |QBF aDato;
          aDato = aDato + "; " + #1#18 + " " + #1#15;
          |QBF aDato;
          aDato = aDato + "-" + #1#19;
          |QBF aDato;
          |HAZ CreaTablaForma2;

          aDato = "Actividad: " + #1#12 + ". " + #1#54;
          |QBF aDato;
          |HAZ CreaTablaForma2;

          aDato = "CIF: " + #1#9;
          |HAZ CreaTablaForma2;

          aDato = " ";
          |HAZ CreaTablaForma2;
     |FINSI;

     fFecha = #15#47;
     aAlfa = fFecha;
     fFecha = fFecha % A2;
     aAlfa = fFecha - aAlfa;
     aDato = "ABRE NUEVO CENTRO CON FECHA " + aAlfa + " SITO EN: "
     |HAZ CreaTablaForma2;

     aDato = " ";
     |HAZ CreaTablaForma2;

     aAtri = "S";
     aDato = "[A]100 [T] " + #15#10;
     |HAZ CreaTablaForma2;
     aAtri = "N";

     aDato = #15#2;
     |QBF aDato;
     |SI aDato = "ITINERANTE";
          aDato = "ITINERANTE.";
     |SINO;
          aDato = #15#2
          |QBF aDato;
          aDato = aDato + "; " + #15#6 + " " + #15#3
          |QBF aDato;
          aDato = aDato + "-" + #15#7;
          |QBF aDato;
     |FINSI;
     |HAZ CreaTablaForma2;

     aDato = "Actividad: " + #15#36 + " " + #15#37;
     |HAZ CreaTablaForma2;

     aDato = "Tlfno: " + #15#8;
     |HAZ CreaTablaForma2;

     |SI #7#98 = "2";
          aDato = "Actividad Preventiva: Evaluacion Inicial y Planificacion Preventiva";
     |SINO;
          aDato = "Actividad Preventiva: Solo alguna especialidad preventiva";
     |FINSI;
     |HAZ CreaTablaForma2;

     |SI #7#55 = "S";
          aDato = "Anexo I: Si";
     |SINO;
          aDato = "Anexo I: No";
     |FINSI;
     |HAZ CreaTablaForma2;

     ||SI #7#97 = "S"; *
     |SI #15#25 = "S";
          aDato = "Vigilancia de la Salud: Si";
     |SINO;
          aDato = "Vigilancia de la Salud: No";
     |FINSI;
     |HAZ CreaTablaForma2;

     aDato = " ";
     |HAZ CreaTablaForma2;
     |HAZ CreaTablaForma2;
|FPRC;

|PROCESO Formato2b;
     aAtri = "S";
     aDato = "[A]101 [T]EMPRESA: " + #1#1;
     |HAZ CreaTablaForma2b;
     aAtri = "N";

     aDato = "Domicilio Social: " + #1#14; |QBF aDato;
     aDato = aDato + "; " + #1#18 + " " + #1#15;
     |QBF aDato;
     aDato = aDato + "-" + #1#19;
     |QBF aDato;
     |HAZ CreaTablaForma2b;

     aDato = "CIF: " + #1#9;
     |HAZ CreaTablaForma2b;

     aDato = "Tlfno: " + #1#20;
     |HAZ CreaTablaForma2b;

     aDato = " ";
     |HAZ CreaTablaForma2b;

     fFecha = #15#39;
     aAlfa = fFecha;
     fFecha = fFecha % A2;
     aAlfa = fFecha - aAlfa;
     aDato = "CAUSA BAJA CON FECHA " + aAlfa + " EL SIGUIENTE CENTRO";
     |HAZ CreaTablaForma2b;

     aDato = " ";
     |HAZ CreaTablaForma2b;

     aAtri = "S";
     aDato = "[A]100 [T] " + #15#10;
     |HAZ CreaTablaForma2b;
     aAtri = "N";

     aDato = #15#2;
     |QBF aDato;
     |SI aDato = "ITINERANTE";
          aDato = "ITINERANTE.";
     |SINO;
          aDato = #15#2
          |QBF aDato;
          aDato = aDato + "; " + #15#6 + " " + #15#3
          |QBF aDato;
          aDato = aDato + "-" + #15#7;
          |QBF aDato;
     |FINSI;
     |HAZ CreaTablaForma2b;

     aDato = "Actividad: " + #15#36 + " " + #15#37;
     |HAZ CreaTablaForma2b;

     aDato = " ";
     |HAZ CreaTablaForma2b;
     |HAZ CreaTablaForma2b;
|FPRC;

|PROCESO LeeDirAnt;
     |ABRE #84;
     #84#0 = #15#0;
     #84#8 = #15#1;
     #84#1 = 99;
     |LEE 000#84];
     |SI FSalida = 0;
          |LEE 000#84a;
     |SINO;
          |LEE 000#84u;
     |FINSI;
     |SI #84#0 ! #15#0; |O #84#8 ! #15#1; |DDEFECTO #84; |FINSI;
     |CIERRA #84;
|FPRC;

|PROCESO Formato3;
     aAtri = "S";
     aDato = "[A]101 [T]EMPRESA: " + #1#1;
     |HAZ CreaTablaForma3;
     aAtri = "N";

     aDato = "Domicilio Social: " + #1#14; |QBF aDato;
     aDato = aDato + "; " + #1#18 + " " + #1#15;
     |QBF aDato;
     aDato = aDato + "-" + #1#19;
     |QBF aDato;
     |HAZ CreaTablaForma3;

     aDato = "Actividad: " + #1#12 + ". " + #1#54;
     |HAZ CreaTablaForma3;

     aDato = "CIF: " + #1#9;
     |HAZ CreaTablaForma3;

     aDato = "Tlfno: " + #15#8;
     |HAZ CreaTablaForma3;

     aDato = " ";
     |HAZ CreaTablaForma3;

     fFecha = #15#47;
     aAlfa = fFecha;
     fFecha = fFecha % A2;
     aAlfa = fFecha - aAlfa;
     aDato = "TRASLADA DOMICILIO SOCIAL Y CENTRO DE TRABAJO CON FECHA  " + aAlfa + " De:"
     |HAZ CreaTablaForma3;

/*Subtiquet nro. 01396.0002*/
     |HAZ LeeDirAnt;

     aDato = " ";
     |HAZ CreaTablaForma3;

     aDato = #84#2; |QBF aDato;
     aDato = aDato + "; " + #84#6 + " " + #84#3;
     |QBF aDato;
     aDato = aDato + "-" + #84#7;
     |QBF aDato;
     |HAZ CreaTablaForma3;

     aDato = " ";
     |HAZ CreaTablaForma3;

     aDato = "A:";
     |HAZ CreaTablaForma3;
/**/
     aDato = " ";
     |HAZ CreaTablaForma3;

     aAtri = "S";
     aDato = "[A]100 [T] " + #15#10;
     |HAZ CreaTablaForma3;
     aAtri = "N";

     aDato = #15#2;
     |QBF aDato;
     |SI aDato = "ITINERANTE";
          aDato = "ITINERANTE.";
     |SINO;
          aDato = #15#2
          |QBF aDato;
          aDato = aDato + "; " + #15#6 + " " + #15#3
          |QBF aDato;
          aDato = aDato + "-" + #15#7;
          |QBF aDato;
     |FINSI;
     |HAZ CreaTablaForma3;

     aDato = "Actividad: " + #15#36 + " " + #15#37;
     |HAZ CreaTablaForma3;

     aDato = " ";
     |HAZ CreaTablaForma3;
     |HAZ CreaTablaForma3;
|FPRC;


|PROCESO FormVari1a;
     aAtri = "S";
     aDato = "[A]101 [T]EMPRESA: " + #1#1;
     |HAZ CreaTablaForma1;
     aAtri = "N";

     aDato = "Domicilio Social: " + #1#14; |QBF aDato;
     aDato = aDato + "; " + #1#18 + " " + #1#15;
     |QBF aDato;
     aDato = aDato + "-" + #1#19;
     |QBF aDato;
     |HAZ CreaTablaForma1;

     aDato = "CIF: " + #1#9;
     |HAZ CreaTablaForma1;

     aDato = "Tlfno: " + #1#20;
     |HAZ CreaTablaForma1;

     aDato = "Trabajadores: " + #1#13;
     |HAZ CreaTablaForma1;

     aDato = "Actividad: " + #1#12 + ". " + #1#54;
     |HAZ CreaTablaForma1;

     aDato = " ";
     |HAZ CreaTablaForma1;

     fFecha = #7#2;
     aAlfa = fFecha;
     fFecha = fFecha % A2;
     aAlfa = fFecha - aAlfa;
     |SI nCentros = 1;
          aDato = "CONCERTO A FECHA " + aAlfa + " EL SIGUIENTE CENTRO DE TRABAJO.";
     |SINO;
          aDato = "CONCERTO A FECHA " + aAlfa + " LOS SIGUIENTES CENTROS DE TRABAJO.";
     |FINSI;
     |HAZ CreaTablaForma1;
     aDato = " ";
     |HAZ CreaTablaForma1;
|FPRC;

|PROCESO FormVari1b;
     aDato = #15#2;
     |QBF aDato;
     |SI aDato = "ITINERANTE";
          aDato = #79#3 +".ITINERANTE.";
     |SINO;
          aDato = #79#3 + "." + #15#2
          |QBF aDato;
          aDato = aDato + "; " + #15#6 + " " + #15#3
          |QBF aDato;
          aDato = aDato + "-" + #15#7;
          |QBF aDato;
     |FINSI;
     |HAZ CreaTablaForma1;
|FPRC;

|PROCESO FormVari1c;
     |SI #7#98 = "2";
          aDato = "Actividad Preventiva: Evaluacion Inicial y Planificacion Preventiva";
     |SINO;
          aDato = "Actividad Preventiva: Solo alguna especialidad preventiva";
     |FINSI;
     |HAZ CreaTablaForma1;

     |SI #7#55 = "S";
          aDato = "Anexo I: Si";
     |SINO;
          aDato = "Anexo I: No";
     |FINSI;
     |HAZ CreaTablaForma1;

     ||SI #7#97 = "S";  (*)
     |SI #15#25 = "S";
          aDato = "Vigilancia de la Salud: Si";
     |SINO;
          aDato = "Vigilancia de la Salud: No";
     |FINSI;
     |HAZ CreaTablaForma1;

     aDato = " ";
     |HAZ CreaTablaForma1;
     |HAZ CreaTablaForma1;
|FPRC;

|PROCESO CentroForma1;
     #15#0 = #79#5;
     #15#1 = #79#3;
     |LEE 101#15=;
     |SI FSalida = 0; |Y #15#48 = "N";
          #15#48 = "S";
          |GRABA 020#15a;
          |SI #79#2 = 1;
             ||  |SI #79#4 ! #1#14;
                    |HAZ FormVari1b;
             ||  |FINSI;
          |SINO;
               |HAZ FormVari1b;
          |FINSI;
     |FINSI;
     |LIBERA #15;
|FPRC;

|DEFBUCLE CentroForma1;
     #79#1;
     ;
     #7#0, #7#1,  1;
     #7#0, #7#1, 99;
     ;
     NULL, CentroForma1;
|FIN;

|PROCESO NumCentros;
     nCentros = nCentros + 1;
|FPRC;


|DEFBUCLE NumCentros;
     #79#1;
     ;
     #7#0, #7#1,  1;
     #7#0, #7#1, 99;
     ;
     NULL, NumCentros;
|FIN;

|PROCESO Contrato;
     |SI #7#113 = "P";
          |DDEFECTO #1;
          #1#0 = #7#3;
          |LEE 000#1=;
          |SI FSalida = 0;
               |DDEFECTO #54;
               #54#0 = #1#12;
               |LEE 000#54=;
               |SI nSwCheck = 1;
                    |HAZ CheckAccess;
               |SINO;
                    |HAZ FicheroA;
                    #7#113 = "E";
                    |GRABA 020#7a;

                    nCentros = 0;
                    |BUCLE NumCentros;
                    |SI nCentros = 1;
                         || Verificamos si tiene un centro y la direccion es diferente
                         #15#0 = #7#3;
                         #15#1 = 1;
                         |LEE 101#15=;
                         |SI FSalida = 0;
                              #15#49 = "S";
                              |GRABA 020#15a;
                              |LIBERA #15;
                         |FINSI;
                         |SI #1#14 ! #15#2; |Y FSalida = 0;
                              |SI #15#48 = "N";
                                   |HAZ Formato1;
                              |FINSI;
                         |FINSI;
                    |SINO;
                         |SI nCentros > 1; ||Si tiene mas de un centro;
                              |HAZ FormVari1a;
                              |BUCLE CentroForma1;
                              |HAZ FormVari1c;
                         |FINSI;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
     |SI #7#114 = "P";
          |DDEFECTO #1;
          #1#0 = #7#3;
          |LEE 000#1=;

          |DDEFECTO #54;
          #54#0 = #1#12;
          |LEE 000#54=;
          |SI nSwCheck = 1;
               |HAZ CheckAccess;
          |SINO;
               |HAZ FicheroB;
               #7#114 = "E";
               |GRABA 020#7a;
          |FINSI;
     |FINSI;
     |LIBERA #7;
|FPRC;

|DEFBUCLE ContratoAlta;
     #7#1;
     113;
     "     ", 0000000, "P";
     "zzzzz", 9999999, "P";
     be;
     NULL, Contrato;
|FIN;

|DEFBUCLE ContratoBaja;
     #7#1;
     114;
     "     ", 0000000, "P";
     "zzzzz", 9999999, "P";
     be;
     NULL, Contrato;
|FIN;

|PROCESO Centros;
     |SI aEmpAnt ! #15#0;
          aEmpAnt = #15#0;
          nPrime2 = 0;
     |FINSI;

     |SELECT #2#79;
     |DDEFECTO #79;
     #79#5 = #15#0;
     #79#3 = #15#1;
     |LEE 000#79=;
     |SI FSalida = 0;
          |SI #15#49 = "N";
               |DDEFECTO #7;
               #7#0 = #79#0;
               #7#1 = #79#1;
               |DDEFECTO #1;
               #1#0 = #15#0;
               |LEE 000#1=;
               |SI #15#38 = "S";
                    |HAZ Formato2b;
                    #15#49 = "S";
                    |GRABA 020#15a;
               |SINO;
                    |SI #15#47 ! "01.01.0000";
                         |HAZ Formato2;
                         #15#49 = "S";
                         |GRABA 020#15a;
                    |FINSI;
               |FINSI;
          |FINSI;
          |SI #15#50 = "N";
               |DDEFECTO #7;
               #7#0 = #79#0;
               #7#1 = #79#1;
               |DDEFECTO #1;
               #1#0 = #15#0;
               |LEE 000#1=;
               |HAZ Formato3;
               #15#50 = "S";
               |GRABA 020#15a;
          |FINSI;
     |FINSI;
     |LIBERA #15;
     |SELECT #1#79;
|FPRC;

|DEFBUCLE Centros;
     #15#1;
     ;
     INICIO;
     FINAL;
     be;
     NULL, Centros;
|FIN;

|PROCESO Asigna;
     aOrg = aBaseOrg + "plugins/" + aDocumen;
     aDes = aPathDes + aDocumen;
     |SI aIP = ""; |HAZ CopiaFichero; |SINO; |HAZ RCopiaFichero; |FINSI;

     aOrg = aPath + aFormato + ".txt";
     aDes = aPathDes + aFormato + ".txt";
     |SI aIP = ""; |HAZ CopiaFichero; |SINO; |HAZ RCopiaFichero; |FINSI;

     aExe = aBase + "bin/dsxml.exe " + aDes;
     |SI aIP = ""; |SYSTEM aExe; |SINO; |RSYSTEM aExe; |FINSI;

     |SI aIP = "";
          |FBORRA aDes;
          aAlfa = aPathDes + aFormato + ".LCK";
          |FBORRA aAlfa;
     |SINO;
          |RFBORRA aDes;
          aAlfa = aPathDes + aFormato + ".LCK";
          |RFBORRA aAlfa;
     |FINSI;
|FPRC;

|PROCESO Access;
     |SI aIP = "";
          |HAZ CopiaFichero;
          aOrg = aBaseOrg + "plugins/clipersal.mdb";
          aDes = aPathDes + aBaseDatos;
          |HAZ CopiaFichero;
     |SINO;
          |HAZ RCopiaFichero;
          aOrg = aBaseOrg + "plugins/clipersal.mdb";
          aDes = aPathDes + aBaseDatos;
          |HAZ RCopiaFichero;
     |FINSI;

     aExe = #999#14; |QBF aExe;
     aAlfa = aExe % -101;
     |SI aAlfa ! "\"; |Y aAlfa ! "/"; aExe = aExe + "\"; |FINSI;
     aExe = aExe + "msaccess.exe " + aPathDes + aBaseDatos;

     |SI aIP = ""; |SYSTEM aExe; |SINO; |RSYSTEM aExe; |FINSI;
|FPRC;

|PROCESO CheckAccess;
     nSal = FSalida;
     #6#0 = #1#0;
     #6#1 = #1#1;
     |LEE 000#6=;
     |SI FSalida = 0;
          |ACABA;
     |SINO;
          |GRABA 020#6n;
     |FINSI;

     FSalida = nSal;
     enError = 0;
     |SI FSalida ! 0;
          enError = 1;
          eaError = "No existe codigo CNAE en clipr054";
          |HAZ ImpreErrAcces;
     |SINO;
          aAlfa = #54#1; |QBF aAlfa;
          |SI aAlfa = "";
               enError = 2;
               eaError = "No hay descripcion del CNAE en clipr054";
               |HAZ ImpreErrAcces;
          |FINSI;
     |FINSI;

     #40#0 = #1#16
     |LEE 000#40=;
     |SI FSalida ! 0;
          enError = 3;
          eaError = "No existe PROVINCIA en el agifa040";
          |HAZ ImpreErrAcces;
     |SINO;
          aAlfa = #40#1; |QBF aAlfa;
          |SI aAlfa = "";
               enError = 4;
               eaError = "No hay descripcion PROVINCIA en el agifa040";
               |HAZ ImpreErrAcces;
          |FINSI;
          aAlfa = #1#19; |QBF aAlfa;
          |SI aAlfa = "";
               enError = 5;
               eaError = "No hay descripcion PROVINCIA en el clipr001";
               |HAZ ImpreErrAcces;
          |FINSI;
     |FINSI;

     #55#0 = #1#16
     #55#1 = #1#17
     |LEE 000#55=;
     |SI FSalida ! 0;
          enError = 6;
          eaError = "No existe POBLACION en el clipr055";
          |HAZ ImpreErrAcces;
     |SINO;
          aAlfa = #55#2; |QBF aAlfa;
          |SI aAlfa = "";
               enError = 7;
               eaError = "No hay descripcion POBLACION en el clipr055";
               |HAZ ImpreErrAcces;
          |FINSI;
          aAlfa = #1#15; |QBF aAlfa;
          |SI aAlfa = "";
               enError = 8;
               eaError = "No hay descripcion POBLACION en el clipr001";
               |HAZ ImpreErrAcces;
          |FINSI;
     |FINSI;

     |SI enError ! 1;
          nError = 1;
     |FINSI;
|FPRC;

|PROCESO ImpreErrAcces;
     |SI nError = 0;
          nError = 1;
          |IMPRE 0;
          nImpre = FSalida;
          |SI FSalida = 0;
               |INFOR "erracces";
               nInfor = FSalida;
               |SI FSalida ! 0;
                    |MENAV "0000Error en informe 'erracces'";
               |FINSI;
          |FINSI;
     |FINSI;
     |SI nImpre = 0; |Y nInfor = 0;
          |PRINT;
     |FINSI;
|FPRC;

|PROCESO Tipo3; |TIPO 3;
     nError = 0;
     nSwCheck = 1;
     |ABRE #1;
     |ABRE #15;
     |ABRE #54;
     |ABRE #55
     |ABRE #40;
     |HAZ CreaTempo; |NOME_DAT #6 Tempo; |DELINDEX #6;
     |ABRE #6;
     |BUCLE ContratoAlta;
     |BUCLE ContratoBaja;
     |CIERRA #6;
     |DELINDEX #6;
     |CIERRA #40;
     |CIERRA #55;
     |CIERRA #54;
     |CIERRA #15;
     |CIERRA #1;

     |SI nError ! 0;
          |SI nInfor = 0; |PIEINF; |FININF; |FINSI;
          |SI nImpre = 0; |FINIMP; |FINSI;

          |CONFI "0000N¿Continuar con la exportación?";
          |SI FSalida ! 0; |ACABA; |FINSI;
     |FINSI;
     nSwCheck = 0;

     aFin = &13;
     aFin = aFin + &10;
     aTab = &9;

     aIP = "";
     |IP_REMOTO aIP;

     aPathDes = #0#0; |QBF aPathDes;
     aAlfa = aPathDes % -101;
     |SI aAlfa ! "\"; |Y aAlfa ! "/"; aPathDes = aPathDes + "\"; |FINSI;

     |DBASE aBaseOrg;
     aOrg = aBaseOrg + "plugins/dsxml.exe";

     |SI aIP = "";
          |DBASS aBase;
          aDes = aBase + "bin/dsxml.exe";
          |HAZ CopiaExe;
     |SINO;
          |ESPECIFICA "RBASS", aLocal;
          aBase = aLocal;
          aDes = aBase + "bin/dsxml.exe";
          |HAZ RCopiaExe;
     |FINSI;

     |DFICE aPath;
     aEmp = aPath % -205;
     aAlfa = aBaseOrg + "fich/";
     |PATH_DAT #41 aAlfa;
     |ABRE #41;
     #41#0 = aEmp;
     |LEE 020#41=;
     |CIERRA #41;

     aFic = aPath + "accessA.txt";
     |XABRE "WB", aFic, nHandleA;
     |SI FSalida < 0;
          |MENAV "0000Error al crear fichero exportacionA";
     |SINO;
          aFic = aPath + "accessB.txt";
          |XABRE "WB", aFic, nHandleB;
          |SI FSalida < 0;
               |MENAV "0000Error al crear fichero exportacionB";
          |SINO;
               aFic = aPath + "formato1.txt";
               |XABRE "WB", aFic, nHandle1;
               |SI FSalida < 0;
                    |MENAV "0000Error al crear fichero exportacion1";
               |SINO;
                    aFic = aPath + "formato2.txt";
                    |XABRE "WB", aFic, nHandle2;
                    |SI FSalida < 0;
                         |MENAV "0000Error al crear fichero exportacion2";
                    |SINO;
                         aFic = aPath + "formato2b.txt";
                         |XABRE "WB", aFic, nHandle2b;
                         |SI FSalida < 0;
                              |MENAV "0000Error al crear fichero exportacion2b";
                         |SINO;
                              aFic = aPath + "formato3.txt";
                              |XABRE "WB", aFic, nHandle3;
                              |SI FSalida < 0;
                                   |MENAV "0000Error al crear fichero exportacion3";
                              |SINO;
                                   |HAZ IniFormatos;
                                   |ABRE #1;
                                   |ABRE #15;
                                   |ABRE #54;
                                   |BUCLE ContratoAlta;
                                   |BUCLE ContratoBaja;
                                   |ABRE #7;
                                   |ABRE #79;
                                   |BUCLE Centros;
                                   |CIERRA #79;
                                   |CIERRA #7;
                                   |CIERRA #54;
                                   |CIERRA #15;
                                   |CIERRA #1;
                                   |HAZ FinFormatos;
                                   |XCIERRA nHandle3;
                              |FINSI;
                              |XCIERRA nHandle2b;
                         |FINSI;
                         |XCIERRA nHandle2;
                    |FINSI;
                    |XCIERRA nHandle1;
               |FINSI;
               |XCIERRA nHandleB;
          |FINSI;
          |XCIERRA nHandleA;
     |SINO;
          |MENAV "0000Error al abrir fichero exportacion access...";
     |FINSI;

     |SI nHayA ! 0;
          aOrg = aPath + "accessA.txt";
          aDes = aPathDes + "alta.txt";
          aBaseDatos = "alta.mdb";
          |HAZ Access;
     |FINSI;
     |SI nHayB ! 0;
          aOrg = aPath + "accessB.txt";
          aDes = aPathDes + "baja.txt";
          aBaseDatos = "baja.mdb";
          |HAZ Access;
     |FINSI;

     |SI nHay1 ! 0;
          aFormato = "formato1";
          aDocumen = "clipersal1.doc";
          |HAZ Asigna;
     |FINSI;
     |SI nHay2 ! 0;
          aFormato = "formato2";
          aDocumen = "clipersal2.doc";
          |HAZ Asigna;
     |FINSI;
     |SI nHay2b ! 0;
          aFormato = "formato2b";
          aDocumen = "clipersal2b.doc";
          |HAZ Asigna;
     |FINSI;
     |SI nHay3 ! 0;
          aFormato = "formato3";
          aDocumen = "clipersal3.doc";
          |HAZ Asigna;
     |FINSI;
|FPRC;

|PROCESO Browser; |TIPO 0;
     |SI FSalida ! 10; |ACABA; |FINSI;

     aRuta = "D*.*";

     |BROWSE aRuta;

     aRuta = aRuta % 2; |QBF aRuta;
     |SI aRuta = "D"; aRuta = ""; |FINSI;

     |QBF aRuta;
     |SI aRuta = "";
          |ERROR;
     |SINO;
          #0#0 = aRuta;
          |PINTA #0#0;
     |FINSI;
|FPRC;

|PROCESO Boton1;
     |PTEC 824;
|FPRC;

|PROGRAMA;
     |ABRE #999; |LEE 000#999p; |CIERRA #999;
     aAlfa = #999#14; |QBF aAlfa;
     |SI aAlfa = "";
          |MENAV "0000No esta indicado en parametros el path de office";
     |FINSI;

     |CLS;
     |CONTROL_SIMPLE 0, "BOTON,Carpeta", 1016, 1023, Boton1;
     nBoton1 = FSalida;
     |ABRE #0;
     |LEE 101#0p;
     |SI FSalida ! 0; |GRABA 020#0b; |FINSI;
     |PINPA #0#0;
     |PINDA #0#0;
     |ENDATOS #1#0;
     |SI FSalida = 0;
          |GRABA 020#0a;
     |FINSI;
     |CIERRA #0;
     |FIN_CONTROL_WINDOWS nBoton1;
     |PULSATECLA;
|FPRO;
