          || Comunes, CreOfePedi

|FICHEROS;
     ialbz008 #0;
     ialbz009 #9;        || Pantalla Espera

     agifa019 #19;
     agifa024 #24;
     dsm00053 #53;
     agifa073 #73;
     agifa104 #104;
     dsm00113 #113;
     agifa142 #142;
     agifa146 #146;
     agifa147 #147;
     dsm00114;
|FIN;

|VARIABLES;
     &eaCli = "";
     &eaAlfa = "";
     &eaProg = "";
     &Tempo = "";
     &enTiva = 0;
     &efFiva = @;
     &eaDiva = "";
     &enIva = 0;
     &enRec = 0;
 {-1}aVent = "";
     aVent1 = 0;
     aVent2 = 0;
     aVent3 = 0;
     aVent4 = 0;
     aVent5 = "";
     nVenEspera = -1;

     &enSwMenu = 0;
     &enForma = 0;
     &eaReservado = "";
     &nImpo = 0;
     &aDivisa = "";
     &aMoneda = "";
     &eaCliente = "";
     &efFecha = @;
     &enImpCliPed = 0;
     &eaTag = "";
     &eaRegNuevo = "";
     nSal = 0;
     nCalc = 0;
     nCampo = 0;
     aAlfa = "";
     nHandle = 0;
|FIN;

|PROCESO BtnSalir;
     |PTEC 807;
|FPRC;

|PROCESO GrabaCabPed;
     #104#1 = ~;
     #104#4 = #146#3;      ||  Cliente.
     #104#5 = #146#5;      ||  Dto.
     #104#6 = #146#7;      ||  Dto.P.P.
     #104#7 = #146#6;      ||  Representante 1.
     #104#8 = #146#4;      ||  Nombre Cliente.
     #104#9 = #146#8;      ||  Forma de pago.
     #104#14 = #146#30;     ||  Direccion Entrega.
     #104#16 = #146#34;     ||  Tipo de comision.
     #104#17 = #146#32;     ||  Dto.Acumulado.
     #104#18 = #146#35;     ||  Tipo de cliente.
     #104#19 = #146#29;     ||  Entregar a.
     #104#20 = #146#31;     ||  Poblacion Entrega.
     #104#21 = #146#33;     ||  Provincia Entrega.
     #104#22 = #146#36;     ||  Regimen de equivalencia S/N.
     #104#15 = "PROVENIENTE DE FACTURA PROFORMA " + #146#48 + "/" + #146#0;
     #104#35 = #146#65;
     #104#36 = #146#66;
     #104#37 = #146#67;
     #104#40 = #146#68;
     #104#41 = #146#69;
     #104#57 = #146#80;     || Dir Ent.
     #104#59 = #146#81;     || C.P
     #104#61 = #146#85;
     #104#64 = #146#86;
     |GRABA 020#104a;

     aDivisa = #104#35;
     aMoneda = #104#37;
     |HAZ Divisas104;
|FPRC;

|PROCESO DesAmpli;
     #53#0 = "P";
     #53#1 = #73#28;
     #53#2 = #73#0;
     #53#3 = #73#1;
     |GRABA 020#53n;
|FPRC;

|DEFBUCLE DesAmpli;
     #53#1;
     ;
     "X", #147#20, #147#0, #147#1, 0001;
     "X", #147#20, #147#0, #147#1, 9999;
     ;
     NULL, DesAmpli;
|FIN;

|PROCESO GrabaLinPed;
     |DDEFECTO #73;
     #73#28 = #104#25;     ||  Serie.
     #73#0 = #104#0;
     #73#1 = #147#1;     ||  Numero de linea.
     #73#2 = #147#2;     ||  Codigo articulo.
     #73#3 = #147#3;     ||  Numero de almacen.
     #73#4 = #147#4;     ||  Descripcion articulo.
     #73#5 = #147#5;     ||  Unidades.
     #73#6 = #147#6;     ||  Precio.
     #73#8 = #147#8;     ||  Dto.1 Linea.
     #73#10 = #147#10;    ||  % Comision.
     #73#14 = #147#11;    ||  Tipo de IVA.
     #73#16 = #146#6;     ||  Representante 1.
     #73#17 = #147#16;    ||  Tipo comision.
     #73#18 = #147#13;    ||  Familia.
     #73#19 = #147#17;    ||  Tipo cliente.
     #73#20 = #147#15;    ||  Cliente.
     #73#23 = #146#5;     ||  Dto.
     #73#24 = #146#7;     ||  Dto.P.P.
     #73#25 = #146#32;    ||  Dto.Acumulado.
     #73#26 = #146#8;    ||  Forma de pago.
     #73#27 = #147#18;    ||  Ampliacion de descripcion.
     #73#29 = #147#21;    ||  % Dto. 2
     #73#35 = #147#22;
     #73#36 = #147#23;
     #73#38 = #147#24;  || PRECIO EN DIVISA
     #73#42 = #73#5;
     #73#44 = #147#28;
     #73#45 = #147#29;
     #73#46 = #147#30;
     #73#48 = #73#44;
     #73#50 = #147#31;
     #73#51 = #147#32;
     #73#52 = #147#33;
     #73#53 = #147#34;
     #73#54 = #147#35;
     #73#55 = #147#36;
     |GRABA 020#73n;

     |BUCLE DesAmpli;

     enForma = 1;
     eaReservado = #73#22;
     |HAZ AcumulaPV;
|FPRC;

|PROCESO CalcConIva;
     #113#0 = #104#4;
     #113#1 = #73#14;
     |LEE 000#113=;
     |SI FSalida = 0;
          nCalc = #73#11 % #113#3;
          |SI #24#47 = "S";
               nCalc = nCalc + (#73#11 % #113#4);
          |FINSI;
     |SINO;
          enTiva = #73#14;
          efFiva = #104#1;
          |HAZ SacaIVA;
          nCalc = #73#11 % enIva;
          |SI #24#47 = "S";
               nCalc = nCalc + (#73#11 % enRec);
          |FINSI;
     |FINSI;
     nImpo = nImpo + (#73#11 + nCalc);
|FPRC;

|PROCESO ActCli;
     |DDEFECTO #19;
     #19#0 = #73#2;
     |LEE 000#19=;

     |SI #19#194 = 2;
          nImpo = ((((#73#44 * #73#6) < #73#8) < #73#29) < #104#5) < #104#17;
     |SINO;
          nImpo = ((((#73#5 * #73#6) < #73#8) < #73#29) < #104#5) < #104#17;
     |FINSI;

     #24#0 = #104#4;
     |LEE 121#24=;
     |SI FSalida = 0;
          |SI #142#115 = "S"; nImpo = nImpo < #104#6; |FINSI;
          aAlfa = #104#1 % A402;
          nCampo = aAlfa;
          nCampo = (nCampo - 1) * 3 + 114;
          #24nCampo = #24nCampo + #104#11;
          #24#150 = #24#150 + #104#11;
          |GRABA 020#24a;
          |LIBERA #24;
     |FINSI;

     eaCliente = #104#4;
     efFecha = #104#1;
     enImpCliPed = nImpo;
     |HAZ AcumulaCli;
|FPRC;

|PROCESO CreOfePedi;
     |ABRE #104;
     |ABRE #73;

     enSwMenu = 1;
     #104#25 = #146#48;
     |HAZ ContaPV7;
     |GRABA 000#104b;
     nSal = FSalida;
     |SI FSalida = 0;
          |HAZ GrabaCabPed;
          |ABRE #53;
          |BUCLELIN 0GrabaLinPed#146;
          |CIERRA #53;
          |HAZ CalCabAgifa104;
          |ABRE #19;
          |ABRE #24;
          |BUCLELIN 2 ActCli #104;
          |CIERRA #24;
          |CIERRA #19;

          #146#60 = #104#25;  ||  Serie.
          #146#61 = ("000000" + #104#0) % -106;   ||  Factura.
          #146#62 = "P";    ||  Tipo de documento asignado (Pedido).

          |ABRE #dsm00113;
          nImpo = 0; |BUCLELIN 2 CalcConIva #104;
          |CIERRA #dsm00113;
          eaTag = "PE"; |HAZ Riesgos;
          eaRegNuevo = #104#25 + (("000000"+#104#0)%-106);
          ||컴컴컴컴컴컴Automatizacion Empresas
          |ABRE #dsm00114; |LEE 000#dsm00114.p; nSal = FSalida; |CIERRA #dsm00114;
          |SI nSal = 0;
               eaCli = #104#4;
               aAlfa = "dsz99983;PEDALTA" + #104#25 + (("000000" + #104#0) % -106);
               |SUB_EJECUTA aAlfa;
          |FINSI;
          ||컴컴컴컴컴
     |SINO;
          aAlfa = "0000Ya existe el pedido: "+#104#25+"/"+(("000000"+#104#0)%-106);
          |MENAV aAlfa;
     |FINSI;
     |CIERRA #73;
     |CIERRA #104;

     FSalida = nSal;
|FPRC;


|PROCESO EjecutaProg;
     |HAZ CreaTempo;
     aAlfa = eaProg + Tempo;

     |SUB_EJECUTA aAlfa;

     |HAZ BoraTempo;

     eaAlfa = "";

     |DFICE aAlfa;
     aAlfa = aAlfa + Tempo;
     |XABRE "", aAlfa, nHandle;
     |SI FSalida = 0;
          |XLEE nHandle, 250, eaAlfa;
          |XCIERRA nHandle;
          |FBORRA aAlfa;
     |FINSI;
|FPRC;
