|FICHEROS;
     agifa080 #0; ||LIN
     agifa077 #1; ||CAB
     agifa112 #6;
     ||agifa065 #9;
     agifa007 #11;   || Fichero de series;
     agitp001 #12;   || Tarifas Actualizadas Proveedor / Articulo.
     agifa142 #142;  || Param. Gen.
     agifa321 #15;   || DIV - Parametros
     agifa029 #29;
     gosubcoc #50;       ||Subcontrata cab.
     gosubpar #51;       ||Subcontratas partidas.
     goparame #52;       ||Parametros Obras.
     gopartia #54;
     gopre001 #55;
     gosubdes #61;
     gotmppar #62;  || Temp. Partidas Subcon.
     gomantl1 #63;
     goenvm02;
|FIN;
-----------------------------------------------------------------------------
|VARIABLES;
     aAlfa = "";
     aSerExp        = "";
     nNumExp        = 0;
     nContra        = 0;
     &cCodMonTrab   = "";
     &cCodMonDe     = "";
     &cCodMonA      = "";
     &nPrecioComp   = 0;
     &nDeci_PBase   = 0;
     &nDeci_TBase   = 0;
     &nDeci_PTrab   = 0;
     &nDeci_TTrab   = 0;
     &Envase    = "";
     &Unidades1 = 0;
     &Unidades2 = 0;
     &VArticulo = "";
     nNume      = 0;
     nModo      = 0;
     nPrecio         = 0;
     nCanCer         = 0;
     &nDeci_Base     = 0;   || Decimales en Totales de la moneda base
     &nDeci_PreBase  = 0;   || Decimales en el Precio en moneda base
     &nDeci_BaseMx   = 0;   || Decimales en Totales de la moneda base (Maxima precision)
     &nDeci_PreBaseMx= 0;   || Decimales en el Precio en moneda base (Maxima precision)
     &nDeci_Div      = 0;   || Decimales en Totales de la divisa
     &nDeci_PreDiv   = 0;   || Decimales en el Precio en divisa
     &nDeci_TotVis   = 0;   || Decimales en Totales visibles (el de la moneda de trabajo)
     &nDeci_TotNoVis = 0;   || Decimales en Totales no visibles (el de la otra moneda)
     &nDeci_PreVis   = 0;   || Decimales en el Precio visual. (lineas)
     &nDeci_ImpVis   = 0;   || Decimales en el Importe visual. (lineas)
     tecla      = "";
     &ac_divisa = ""; ||
     mensa      = ""; || Linea de visualizacion
     &pintado   = 0;|| Controla el pintado de mensa para que solo lo haga 1 vez
     titdiv = "";   || Encabezado de precio e imp. con la divisa "Imp.Tot(USD)"
     precio = 0;
     forma = 0;
     dto1 = 0;
     dto2 = 0;
     alfa = "";
     Unidades = 0;
     asto = 0;
     salida    = 0;
     descu = 0;
     imneto = 0;
     tf = 0;
     articulo = " ";
     fmes = "  ";
     mes = 0;
     mensaje3 = "";
     a = 0;
     sto = 0;
     vacio = "                    ";
     previo = 0;
     de = 0;
     pm = 0;
     pe = 0;
     m1 = 0;
     m2 = 0;
     m3 = 0;
     canti2 = 0;
     &n_dec = 0;
     &n_pre = 0;
     neto = 0;
     &def_alm = 0;
     &recoge   = "";     || Viene de agifa077
     campo = 0;
     mensaje5 = "0000 Albaran para exportacion Tipo iva = 0 !!";
     expor = "";
     serie     = "";
     serie_o   = "";
     albaran   = 0;
     albaran_o = 0;
     alfa1     = "";
     alfa2     = "";
     fiac      = "  ";
     guarda    = "  ";
     relleno   = "                                       ";
     aponer    = "  ";
     nerror    = 0;
     &LineaD  = 0;   || Lo utilizo en solis008
     nlinea    = 0;
     i         = 0;
     aprograma = "";
     impret = 0;
     &c_prove   = "";
     &c_artic   = "";
     &c_serie   = "";
     &entrada   = 0;
     inkey      = 0;
     &codiBarra = "";
     &r_arti    = "";
     &aRecoge      = "N";
     &aModalidad   = "C";  || Compras
     &aProceso     = "agifa080";
     cUni           = "";
|FIN;
-----------------------------------------------------------------------------
|INCLUYE i_varart;
|INCLUYE i_cdbarr;
-----------------------------------------------------------------------------
|PROCESO civaalb;
     inkey = FSalida;
     |SI inkey = 15;
          eaPrv = "";
          enTiva = #0#11;
          efFiva = #1#1;
          |HAZ IVAPrv;
          #0#6 = #0#6 / (1 + enIva/100);
          |HAZ visual_precio;
     |FINSI;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO liinfos;|TIPO 0;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO licogeas;|TIPO 0;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO defeclis;|TIPO 0;
     #0#15 = #1#3;
     |HAZ mirespor;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO totlis;|TIPO 0;
     |HAZ TotalLin80;
     |HAZ visual_importe;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO Conversion;  |TIPO 7;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO GrabaElemento;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO liacartiC;|TIPO 2;
     nModo = (FEntrada / 100) !0;
     enForma = 0 +. 1;
     |SI #0#19 = "S"; |O #1#38 = "S";
          |SI enForma < 0;
               |SI #0#19 = AS;
                    |MENAV "0000Esta linea proviene de un Pedido (use la opcion adecuada)";
               |FINSI;
               |SI #1#38 = AS;
                    |MENAV "0000Este albaran esta FACTURADO";
               |FINSI;
          |FINSI;
          |ERROR;
          |ACABA;
     |FINSI;
     |ABRE #50;
     #50#0 = #1#54;
     |LEE 000#50=;
     |SI FSalida ! 0;
          |MENAV "0000No existe subcontrata...";
          |ERROR;
          |ACABA;
     |FINSI;
     |CIERRA #50;

     |ABRE #51;
     |SELECT #2#51;
     #51#0 = #1#54;                               ||N Contrata.
     #51#2 = #0#21;                               ||Linea Pedido.
     #51#3 = #0#37;
     |LEE 101#51=;
     |SI FSalida = 0;
          cCodMonDe = #1#56;              ||Moneda Contrata
          cCodMonA  = #50#8;              ||Moneda Trabajo
          nPrecioComp = #0#31;            ||Precio
          |HAZ DemonAmon;
          #51#9  = #51#9  +. nPrecioComp;         ||Importe  Certificado.
          #51#16 = #51#16 +. #0#5;                ||Cantidad Certificada.
          |GRABA 020#51a;
     |FINSI;
     |CIERRA #51;

     |HAZ CompoPartida;

     imneto = #0#9 < #1#5;
     imneto = imneto < #1#32;
     imneto = imneto < #1#7;
     #1#15 = #1#15 +. #0#9;
     impret = #0#9 % #1#52;
     #1#53 = #1#53 +. impret;
     ||컴컴컴컴컴컴컴컴컴컴컴컴컴
     |HAZ CalCabAgifa077;
     |SI enForma = 1;
          |HAZ pantcomp;
     |FINSI;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO Min12;
     #12#0 = #1#3;
     #12#2 = " " * 20;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO Max12;
     #12#0 = #1#3;
     #12#2 = "z" * 20;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO art6alc;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO nomodif5; |TIPO 0;
     nModo = (FEntrada / 100) ! 0;
     |SI #0#37 = vacio;
          |CAMPO_MODIFICA #0#3,  1, "N";
          |CAMPO_MODIFICA #0#5,  1, "N";
          |SI #1#58 = "B"; || Si la moneda de trabajo es la moneda base
            |CAMPO_MODIFICA #0#6,  1, "N";
          |SINO;
            |CAMPO_MODIFICA #0#30,  1, "N";
          |FINSI;
          |CAMPO_MODIFICA #0#8,  1, "N";
          |CAMPO_MODIFICA #0#26,  1, "N";
          |CAMPO_MODIFICA #0#10, 1, "N";
          |CAMPO_MODIFICA #0#11, 1, "N";
     |SINO;
          |CAMPO_MODIFICA #0#3,  1, "S";
          |CAMPO_MODIFICA #0#5,  1, "S";
          |SI #1#58 = "B";
            |CAMPO_MODIFICA #0#6,  1, "S";
          |SINO;
            |CAMPO_MODIFICA #0#30,  1, "S";
          |FINSI;
          |CAMPO_MODIFICA #0#8,  1, "S";
          |CAMPO_MODIFICA #0#26,  1, "S";
          |CAMPO_MODIFICA #0#10, 1, "S";
          |CAMPO_MODIFICA #0#11, 1, "S";
     |FINSI;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO decim;
     #0#5 = #0#5 ! n_dec;
     |PINTA #0#5;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO decim1;
     |SI #1#58 = "D";  || Si la moneda de trabajo es la divisa ...
         #0#6 = #0#30 / #1#57 * #1#62;  || ... recalculo en funcion de la divisa
     |SINO;
         #0#30 = #0#6 / #1#62 * #1#57; || .. recalculo en funcion de la moneda base
     |FINSI;

     |HAZ visual_precio; || Visualiza el precio
     |HAZ PintaUniMediC;
|FPRC;
-----------------------------------------------------------------------------
|| *********************** *(1)
|PROCESO leeotroC; |TIPO 11;
     inkey = FSalida;
     nModo = (FEntrada/100) !0;
     |SI inkey = 9;
          |PUSHV 501 2380;
          |PINPA #0#1;
          |PINDA #0#1;
          |PAUSA;
          |POPV;
          |ERROR;
          Control = "agifa080";
     |FINSI;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO param;|TIPO 7;
     |DDEFECTO #11;
     |ABRE #11;
     #11#0 = #0#27;
     |LEE 001#11=;
     |CIERRA #11;
     expor = #11#30;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO mirespor;|TIPO 0
     |SI #0#11 ! 0; |Y expor = "S";
          |MENSA mensaje5;
          #0#11 = 0;
          |PINTA #0#11;
     |FINSI;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO Mensaje;
     |PUSHV 0501 2380;
     |AVISO;
     |COLOR 0, 0; |ATRI 0;
     |BLANCO 0815 1265;
     |COLOR 4, 0; |ATRI 0;
     |D_CUADRO 0815,1265;
     |PINTA 1017, alfa;
     |ATRI 0;
     |PAUSA;
     |POPV;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO cambipre; |TIPO 0;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO cambidto;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO pantcomp;|TIPO 13;
     |HAZ visual_totales; || Visualiza los totales
     |SI #142#148 = "S";
          |PINTA 1327, "Portes:"
     |FINSI;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO LinDiv;  |TIPO 7;
     |ABRE #agifa321;
     |LEE 001#agifa321.p;  || Leo parametros de divisa
     |SI ac_divisa = "S"; |Y pintado = 0; || Si divisas estan activadas y no he pintado ...
       |SI #1#58 = "D";   || Si la moneda de trabajo es la divisa la pinto en
         |ATRI R;         || el encabezado del precio y el importe
         titdiv = "Precio" + "(" + #1#56 + ")";
         |PINTA 1444,titdiv;
         titdiv = "I.Tot." + "(" + #1#56 + ")";
         |PINTA 1468,titdiv;
         |ATRI r;
       |FINSI;
       |SI #agifa321#4 = "S";  || Si la visualizacion esta activada ...
         mensa = "Precio:            Imp.:              T.Bruto:             T.ALB:             ";
         |PINTA 1102,mensa;  || ... pinto la linea de visualizacion
         |PINTA #0#32; || Pinto precio visual
         |PINTA #0#33; || Pinto importe visual
         |SI #1#58 = "D"; || Si la moneda de trabajo es la divisa
           |PINTA 1149,#1#67;
           |PINTA 1168,#1#68;
         |SINO;
           |PINTA 1149,#1#63;
           |PINTA 1168,#1#64;
         |FINSI;
         pintado = 1;  || Ya hemos pintado
       |FINSI;
     |FINSI;
     |CIERRA #agifa321;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO upc_div;
     |SI eaDivisa = #1#56;
          #0#6 = #0#30 * #1#62 / #1#57;
     |SINO;
          #0#30 = #0#6 / #1#62 * #1#57;
     |FINSI;
     |HAZ visual_precio;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO visual_precio; || Pinta el precio visual.
     |SI #1#58 = "D";  || Si la moneda de trabajo es la divisa ...
          #0#32 = #0#6;   || ... el campo visualiz. es el precio en moneda base
          |PINTA #0#30;
     |SINO;            || Si la moneda de trabajo es la moneda base ...
          #0#32 = #0#30;  || ... el campo visual. es el precio en divisa
          |PINTA #0#6;
     |FINSI;
     |SI ac_divisa = "S"; |Y #agifa321#4= "S";
          |PINTA #0#32; || Si las divisas y la visualizacion estan activadas, pinto
     |FINSI;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO visual_importe;  || Pinta el importe visual
     |SI #1#58 = "D";  || Si la moneda de trabajo es la divisa ...
          #0#33 = #0#9;   || el campo visualiz. es el importe en moneda base
          |PINTA #0#31;
     |SINO;            || Si la moneda de trabajo es la moneda base ...
          #0#33 = #0#31;  || el campo visualiz. es el importe en divisa
          |PINTA #0#9;
     |FINSI;
     |SI ac_divisa = "S"; |Y #agifa321#4= "S";
          |PINTA #0#33; || Si las divisas y la visualizacion estan activadas, pinto
     |FINSI;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO visual_totales;
          |ABRE #agifa321;
          |LEE 001#agifa321.p;
          |SI #1#58 = "D";
               |SI ac_divisa = "S"; |Y #agifa321#4= "S";
                    |PINTA 1149,#1#67;
                    |PINTA 1168,"        ";
                    |PINTA 1168,#1#68;
               |FINSI;
               |CIERRA #agifa321;
               |PINTA 1349,#1#63;
               |PINTA 1366,#1#64;
          |SINO;
               |SI ac_divisa = "S"; |Y #agifa321#4= "S";
                    |PINTA 1149,#1#63;
                    |PINTA 1168,"        ";
                    |PINTA 1168,#1#64;
              |FINSI;
              |CIERRA #agifa321;
              |PINTA 1349,#1#15;
              |PINTA 1366,#1#55;
          |FINSI;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO CogeValores80;  |TIPO 7;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO PideArt80;  |TIPO 7;
|FPRC;
-------------------------------------------------------------------------------
|PROCESO Calc680;  |TIPO 6;
|FPRC;
-------------------------------------------------------------------------------
|PROCESO Tipo080;
     |HAZ nomodif5;
|FPRC;
-------------------------------------------------------------------------------
|PROCESO Multi80; |TIPO 66;
|FPRC;
-------------------------------------------------------------------------------
|PROCESO Tipo11080;  |TIPO 11;
|FPRC;
-------------------------------------------------------------------------------
|PROCESO cierre; |TIPO 0;
|FPRC;
-------------------------------------------------------------------------------
|PROCESO Partidas; |TIPO 7;
     nModo = (FEntrada/100)!0;

     |C_M #0#37, 1, "N";
     |ABRE #62;
     #62#1 = #0#2;
     #62#3 = #0#37;
     |LEE 000#62];
     |CONSULTA_CLAVE #1#62;
     |SI FSalida = 0;
          |SI #0#37 ! #62#3; |O #0#2 ! #62#1; |O nModo = 1;
               #0#37 = #62#3; |PINTA #0#37;
               #0#2 = #62#1;  |PINTA #0#2;
               #0#21 = #62#2;
               |HAZ LaPartida;
          |SINO;
               #0#37 = #62#3; |PINTA #0#37;
               #0#2 = #62#1;  |PINTA #0#2;
               #0#21 = #62#2;
          |FINSI;
          |PTEC 802;
     |SINO;
          |ERROR;
          |PTEC 807;
     |FINSI;
     |C_M #0#37, 1, "S";
|FPRC;

|PROCESO LaPartida;
     |ABRE #52; |LEE 000#52p; |CIERRA #52;

     #0#3 = #52#22;                          ||Almacen Central
     |ABRE #goenvm02;
     aAlfa = Usuario % 810;
     #goenvm02#0 = aAlfa;
     |LEE 000#goenvm02.=;
     |SI FSalida = 0;
          #0#3 = #goenvm02#3;
     |FINSI;
     |CIERRA #goenvm02;

     |ABRE #50;
     #50#0 = #1#54;
     |LEE 000#50=;
     |SI FSalida = 0;
          cCodMonTrab = #50#8;
          |HAZ MonBas;
          |ABRE #51;
          |SELECT #3#51;
          #51#0 = #1#54;                               ||N.Contrata
          #51#1 = #0#2;
          #51#3 = #0#37;
          |LEE 101#51=;
          |SI FSalida = 0;
               |SI #51#9 = #51#12; |O #51#16 = #51#14;
                    |MENAV "0000LA PARTIDA SE ENCUENTRA TOTALMENTE CERTIFICADA";
               |FINSI;
               precio = #51#13;                        ||Precio Contratado
               #0#4 = #51#4;                      ||Descripcion de Partida
               #0#6 = precio;
               #0#21 = #51#2;                     ||Linea Partida
               cCodMonDe = #50#8;              ||Moneda Contrata
               cCodMonA  = #1#56;              ||Moneda Trabajo
               nPrecioComp = #0#6;             ||Precio
               |HAZ DemonAmon;
               #0#6 = nPrecioComp;
          |FINSI;
          |CIERRA #51;
          |HAZ visual_precio;
          |PINTA #0#4; |PINTA #0#6;
          |ATRI R;
          cUni = #51#6;
          cUni = "Cant. " + #51#6;
          |PINTA 1434, cUni;
          |ATRI 0;
     |FINSI;
     |CIERRA #50;
|FPRC;
-------------------------------------------------------------------------------
-------------------------------------------------------------------------------
|PROCESO CanPen; |TIPO 0;
     |ABRE #51;
     |SELECT #3#51;
     #51#0 = #1#54;                               ||N.Contrata
     #51#3 = #0#37;                               ||Partida
     |LEE 000#51=;
     |SI FSalida = 0;
          nCanCer = #0#5 + #51#16;
          |SI nCanCer > #51#14;
               |MENAV "0000ESTA SUPERANDO LA CANTIDAD CONTRATADA.";
          |FINSI;
     |FINSI;
     |CIERRA #51;
|FPRC;
-------------------------------------------------------------------------------
|PROCESO Tipo5_080;  |TIPO 5;
     |HAZ actalc;
|FPRC;
-------------------------------------------------------------------------------

|PROCESO gosubdes;
     #51#0 = nContra;
     #51#1 = #0#2;
     #51#2 = #0#21;
     |LEE 020#51=;

     |DDEFECTO #54;
     #54#0 = #50#4;
     #54#1 = #50#5;
     #54#2 = aSerExp;
     #54#3 = nNumExp;
     #54#4 = #0#27;
     #54#5 = #0#0;
     #54#6 = #0#1;
     #54#7 = #61#3;
     #54#8 = #0#37;
     #54#9 = #0#4;
     #54#10 = #0#5 * #51#5;
     #54#11 = #51#10;
     #54#12 = #51#7;
     #54#13 = #54#10 * #51#10;
     #54#14 = #54#10 * #51#11;
     #54#15 = #50#6;
     #54#16 = #50#7;
     #54#17 = #29#0;
     #54#18 = #29#1;
   ||#54#19 =
   ||#54#20 =
     #54#21 = #1#56;
     #54#26 = "C";
     #54#28 = #1#1;
     #54#29 = "S";
     #54#30 = "SUBCONTRATA";                 ||Descripcion.
     #54#33 = #51#1;
     #54#34 = "S";
     |SI enForma = 1;
          |GRABA 020#54n;
     |SINO;
          |BORRA 020#54c;
     |FINSI;
|FPRC;

|DEFBUCLE gosubdes;
     #61#1;
     ;
     nContra, #0#2, #0#37, 001;
     nContra, #0#2, #0#37, 999;
     ;
     NULL, gosubdes;
|FIN;

|PROCESO gomantl1;
     aSerExp = #63#0;
     nNumExp = #63#1;
     |ERROR10;
|FPRC;

|DEFBUCLE gomantl1;
     #63#2;
     ;
     "     ", 000001, #50#4, #50#5;
     "zzzzz", 999999, #50#4, #50#5;
     ;
     NULL, gomantl1;
|FIN;

|PROCESO CompoPartida;
     nContra = #1#54
     |ABRE #50;
     #50#0 = nContra;
     |LEE 020#50=;
     |SI FSalida = 0;
          |BUCLE gomantl1;

          |ABRE #29;
          #29#0 = aSerExp;
          |LEE 000#29=;
          |CIERRA #29;

          |ABRE #54;
          |ABRE #51;
          |BUCLE gosubdes;
          |CIERRA #51;
          |CIERRA #54;
     |FINSI;
     |CIERRA #50;
|FPRC;

|PROCESO IVAcel_66; |TIPO 66;
     enTiva = #0Campo;
     efFiva = #1#1;
     |HAZ ConsuIVA;
     |SI eaDiva = "";
          |ERROR;
     |SINO;
          #0Campo = enTiva; |PINTA #0Campo;
     |FINSI;
|FPRC;

|PROCESO IVAcel_0; |TIPO 0;
     enTiva = #0Campo;
     efFiva = #1#1;
     |HAZ SacaIVA;
     |SI eaDiva = "";
          |MENAV "0000No existe tipo iva para esta fecha...";
          |ERROR; |ACABA;
     |FINSI;
|FPRC;
