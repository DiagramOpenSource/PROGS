     CALCULOS LLAMADOS POR tecaz020 Y tecaz021


|FICHEROS;
     agifm003 #3;   || Grupo Cli/Prv
     agifa010 #10;
     tecam020 #20;  || Control
     tecam021 #21;  || Repre.
     tecam022 #22;  || Libreta Dir
     agifa025 #25;
     tecaw027 #27;  || Libreta Dir a exportar
     tecaw028 #28;  || Ctrl. pedido a exportar
     tecaw029 #29;       || Tmp
     tecam039 #39;  || Resul. Visitas
     web10058 #58;  || Hist.
     web10057 #57;
     agifa071 #71;
     agifa073 #73;
     agifa091 #91;
     agifa128 #128;
     dsm00225 #225;
     dsm00020 #200;

     tecam039@ #1;
     referen@ #2;
|FIN;

|VARIABLES;
     aFin = "";
     &eaDRepre = "";
     &eaHRepre = "";
     aCampos = "";
     nHandle = 0;
     aAlfa = "";
     &eaNomeDat = "";
     &aPath = "";
     i = 0;
     nUni = 0;
     nHay = 0;
 {2}&aPuntero  = "";
     &enHayAgencia = 0;
     &enHayTablaResu = 0;
     &enHayLibreta = 0;
     &enHayGruCliPrv = 0;
     &enHayComiCli = 0;
     &enHayPais = 0;
     &enHayFPago = 0;
     aDef = "";
     aSql = "";
|FIN;

|PROCESO Libreta;
     aAlfa = #21#0 + "-" + #22#0;
     #27#0 = aAlfa;
     |PARA i = 1; |SI i [ 4; |HACIENDO i = i + 1;
          #27i = #22i;
     |SIGUE;
     #27#5 = #25#1;
     |GRABA 020#27n;
     nHay = 1;
|FPRC;

|DEFBUCLE Libreta;
     #22#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Libreta;
|FIN;

|PROCESO LibretaDir;
     nHay = 0;
     aPath = #20#0; |QBF aPath;
     |DFICE aAlfa;
     aPath = aPath + (aAlfa % -205) + "/";
     |PATH_DAT #27#aPath#;
     |DELINDEX #27;

     |SALVA_FICHA #22;

     |ABRE #27;
     |BUCLE Libreta;
     |CIERRA #27;

     |REPON_FICHA #22;

     |SI nHay ! 0;
          aAlfa = #20#1; |QBF aAlfa;
          |MKDIR aAlfa;
          aPuntero1 = "tecaw027";
          aPuntero2 = aAlfa + "comercial";
          IaPuntero = aPuntero1<-;
          |ESPECIFICA "EXPORTAPLB", aPuntero;
          |HAZ ExportaTxt;

          |DELINDEX #27;
     |FINSI;
     enHayLibreta = nHay;
|FPRC;
-------------------------
|PROCESO web10058;
     |SI #58#13 = "S";
          |ACABA;
     |FINSI;

     |DDEFECTO #28;
     #28#0 = #57#21;
     #28#1 = #58#3;
     #28#2 = #57#14;
     #28#3 = #57#15;

     |DDEFECTO #71;
     |SELECT #4#71;
     #71#31 = #57#14;
     #71#12 = #57#15;
     #71#21 = #58#3;
     |LEE 000#71=;
     |SI FSalida = 0;
          |DDEFECTO #10;
          #10#52 = #71#29;
          #10#0 = #71#0;
          |LEE 000#10=;

          #28#4 = #71#29;
          #28#5 = #71#0;
          #28#6 = #71#1;

          #28#8 = #10#1;
          |SI FSalida ! 0;
               #28#8 = "";
          |FINSI;
          #28#9 = #10#9;
     |FINSI;


     #73#28 = #57#14;
     #73#0 = #57#15;
     #73#1 = #58#3;
     |LEE 000#73=;
     |SI FSalida = 0;
          nUni = #73#5 - #73#43;
          |SI nUni [ 0;
               #58#13 = "S";
               |GRABA 020#58a;
          |FINSI;
          #28#7 = #73#43;
     |FINSI;
     |LIBERA #58;

     |GRABA 020#28n;
     nHay = 1;
|FPRC;

|DEFBUCLE web10057;
     #57#1;
     19;
     "      ", "01.01.0000", "        ", "             ", #21#0;
     "zzzzzz", "31.12.9999", "zzzzzzzz", "zzzzzzzzzzzzz", #21#0;
     be;
     NULL, NULL, web10058;
|FIN;

|PROCESO Representante1;
     aAlfa = "tecw28" + #21#0;
     |NOME_DAT #28#aAlfa#;
     |DELINDEX #28;

     |ABRE #28;
     |BUCLE web10057;
     |CIERRA #28;
|FPRC;

|DEFBUCLE Representante1;
     #21#1;
     ;
     eaDRepre;
     eaHRepre;
     ;
     NULL, Representante1;
|FIN;

|PROCESO CtrlPedido;
     nHay = 0;
     aPath = #20#1; |QBF aPath;
     |PATH_DAT #28#aPath#;
     |ABRE #73;
     |ABRE #71;
     |ABRE #10;
     |BUCLE Representante1;
     |CIERRA #10;
     |CIERRA #71;
     |CIERRA #73;
|FPRC;
---------------------
|PROCESO tecam039;
     aAlfa = "|NC";
     aAlfa = #39#aAlfa#;

     |PARA i = 0; |SI i < aAlfa; |HACIENDO i = i + 1;
          #tecam039@#i# = #39i;
     |SIGUE;
     |GRABA 020#tecam039@.n;
     nHay = 1;
|FPRC;

|DEFBUCLE tecam039;
     #39#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, tecam039;
|FIN;

|PROCESO TablaResu;
     nHay = 0;
     |DDEF aAlfa;
     aAlfa = aAlfa + "tecam039";
     |CARGA_DEF aAlfa, tecam039@;
     |SI FSalida = 0;
          aPath = #20#0; |QBF aPath;
          |DFICE aAlfa;
          aPath = aPath + (aAlfa % -205) + "/";
          |PATH_DAT #tecam039@#aPath#;
          |DELINDEX #tecam039@;

          |ABRE #tecam039@;
          |BUCLE tecam039;
          |CIERRA #tecam039@;

          |SI nHay ! 0;
               aAlfa = #20#1; |QBF aAlfa;
               |MKDIR aAlfa;
               aPuntero1 = "tecam039";
               aPuntero2 = aAlfa + "tabla_resultados";
               IaPuntero = aPuntero1<-;
               |ESPECIFICA "EXPORTAPLB", aPuntero;
               |HAZ ExportaTxt;
          |FINSI;
          |DELINDEX #tecam039@;
          |DESCARGA_DEF #tecam039@;
     |FINSI;
     enHayTablaResu = nHay;
|FPRC;
------
|PROCESO agifm003;
     #29#0# = #3#0;
     #29#1# = #3#1;
     |GRABA 020#29n;
     nHay = 1;
|FPRC;

|DEFBUCLE agifm003;
     #3#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, agifm003;
|FIN;

|PROCESO GrupoCliPrv;
     nHay = 0;
     aPath = #20#0; |QBF aPath;
     |DFICE aAlfa;
     aPath = aPath + (aAlfa % -205) + "/";
     |PATH_DAT #29 aPath;
     |DELINDEX #29;

     |ABRE #29;
     |BUCLE agifm003;
     |CIERRA #29;

     |SI nHay ! 0;
          aAlfa = #20#1; |QBF aAlfa;
          |MKDIR aAlfa;
          aPuntero1 = "tecaw029";
          aPuntero2 = aAlfa + "grupo_cli_prv";
          IaPuntero = aPuntero1<-;
          |ESPECIFICA "EXPORTAPLB", aPuntero;
          |HAZ ExportaTxt;
     |FINSI;
     enHayGruCliPrv = nHay;
|FPRC;
---
|PROCESO agifa128;
     #29#0 = #128#0;
     #29#1 = #128#2;
     |GRABA 020#29n;
     nHay = 1;
|FPRC;

|DEFBUCLE agifa128;
     #128#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, agifa128;
|FIN;

|PROCESO ComiCli;
     nHay = 0;

     aPath = #20#0; |QBF aPath;
     |DFICE aAlfa;
     aPath = aPath + (aAlfa % -205) + "/";
     |PATH_DAT #29 aPath;
     |DELINDEX #29

     |ABRE #29;
     |BUCLE agifa128;
     |CIERRA #29;

     |SI nHay ! 0;
          aAlfa = #20#1; |QBF aAlfa;
          |MKDIR aAlfa;
          aPuntero1 = "tecaw029";
          aPuntero2 = aAlfa + "comi_tipo_cli";
          IaPuntero = aPuntero1<-;
          |ESPECIFICA "EXPORTAPLB", aPuntero;
          |HAZ ExportaTxt;
    |FINSI;
    |DELINDEX #29;
    enHayComiCli = nHay;
|FPRC;
||--
|PROCESO dsm00225;
     #29#0 = #225#0;
     #29#1 = #225#1;
     |GRABA 020#29n;
     nHay = 1;
|FPRC;

|DEFBUCLE dsm00225;
     #225#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, dsm00225;
|FIN;

|PROCESO Paises;
     nHay = 0;

     aPath = #20#0; |QBF aPath;
     |DFICE aAlfa;
     aPath = aPath + (aAlfa % -205) + "/";
     |PATH_DAT #29 aPath;
     |DELINDEX #29

     |ABRE #29;
     |BUCLE dsm00225;
     |CIERRA #29;

     |SI nHay ! 0;
          aAlfa = #20#1; |QBF aAlfa;
          |MKDIR aAlfa;
          aPuntero1 = "tecaw029";
          aPuntero2 = aAlfa + "paises";
          IaPuntero = aPuntero1<-;
          |ESPECIFICA "EXPORTAPLB", aPuntero;
          |HAZ ExportaTxt;
    |FINSI;
    |DELINDEX #29;
    enHayPais = nHay;
|FPRC;

|PROCESO agifa091;
     #29#0 = #91#0;
     #29#1 = #91#1;
     |GRABA 020#29n;
     nHay = 1;
|FPRC;

|DEFBUCLE agifa091;
     #91#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, agifa091;
|FIN;

|PROCESO FPago;
     nHay = 0;

     aPath = #20#0; |QBF aPath;
     |DFICE aAlfa;
     aPath = aPath + (aAlfa % -205) + "/";
     |PATH_DAT #29 aPath;
     |DELINDEX #29

     |ABRE #29;
     |BUCLE agifa091;
     |CIERRA #29;

     |SI nHay ! 0;
          aAlfa = #20#1; |QBF aAlfa;
          |MKDIR aAlfa;
          aPuntero1 = "tecaw029";
          aPuntero2 = aAlfa + "forma_pago";
          IaPuntero = aPuntero1<-;
          |ESPECIFICA "EXPORTAPLB", aPuntero;
          |HAZ ExportaTxt;
    |FINSI;
    |DELINDEX #29;
    enHayFPago = nHay;
|FPRC;


|PROCESO dsm00020;
     #29#0 = #200#0;
     #29#1 = #200#1;
     |GRABA 020#29n;
     nHay = 1;
|FPRC;

|DEFBUCLE dsm00020;
     #200#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, dsm00020;
|FIN;

|PROCESO Agencias;
     nHay = 0;

     aPath = #20#0; |QBF aPath;
     |DFICE aAlfa;
     aPath = aPath + (aAlfa % -205) + "/";
     |PATH_DAT #29 aPath;
     |DELINDEX #29

     |ABRE #29;
     |BUCLE dsm00020;
     |CIERRA #29;

     |SI nHay ! 0;
          aAlfa = #20#1; |QBF aAlfa;
          |MKDIR aAlfa;
          aPuntero1 = "tecaw029";
          aPuntero2 = aAlfa + "agencias";
          IaPuntero = aPuntero1<-;
          |ESPECIFICA "EXPORTAPLB", aPuntero;
          |HAZ ExportaTxt;
    |FINSI;
    |DELINDEX #29;
    enHayAgencia = nHay;
|FPRC;

|PROCESO ExportaTxt;
     |DDEF aAlfa;
     aAlfa = aAlfa + aPuntero1;
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |PATH_DAT #referen@#aPath#;
          |SI eaNomeDat ! "";
               |NOME_DAT #referen@#eaNomeDat#;
          |FINSI;
          |ABRE #referen@;
          aAlfa = aPuntero2 + ".txt";
          |XABRE "BW", aAlfa, nHandle;
          |SI FSalida ] 0;
               aFin = &13;
               aFin = aFin + &10;
               aAlfa = "|NC";
               aCampos = #referen@#aAlfa#;
               |LEE 000#referen@.p;
               |PARA; |SI FSalida = 0; |HACIENDO;
/*
                    aAlfa = "";
                    |PARA i = 0; |SI i < aCampos; |HACIENDO i = i + 1;
                         aAlfa = aAlfa + #referen@#i# + &9;
                    |SIGUE;
                    aAlfa = aAlfa + aFin;
                    |XGRABA nHandle, aAlfa;
*/
                    |PARA i = 0; |SI i < aCampos; |HACIENDO i = i + 1;
                         aAlfa = #referen@#i# + &9;
                         |XGRABA nHandle, aAlfa;
                    |SIGUE;
                    aAlfa = aFin;
                    |XGRABA nHandle, aAlfa;

                    |LEE 000#referen@.s;
               |SIGUE;
               |XCIERRA nHandle;
          |FINSI;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
     eaNomeDat = "";
|FPRC;
