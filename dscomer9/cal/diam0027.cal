|FICHEROS;
     diam0025 #25;
     diam0027 #27;
     agifa024 #24;
     agifa019 #19;

     :/dsp/def/dspm0004 #104;

     ma000001@ #200;
     diam0027@ #900;
|FIN;

|VARIABLES;
     nGrid27      = 0;
     nDTecnico    = 0;
     nHTecnico    = 0;
     nPosi1       = 0;
     nPosi2       = 0;
     nRango       = 0;
     nTecGuardian = 0;
     nBoton1      = 0;

     aAlfa1       = "";
     aBase        = "";
     aMas         = "";
     aOrigen      = "";
     aDestino     = "";
     aIPRemoto    = "";
     aFichero     = "";
     aDirPdf      = "";
|FIN;

|PROCESO ClaveBaja27;
     #27#13 = nDTecnico;
     #27#0  = 0000;
     #27#1  = 01;
     #27#2  = 00001;
|FPRC;

|PROCESO ClaveAlta27;
     #27#13 = nHTecnico;
     #27#0  = 9999;
     #27#1  = 99;
     #27#2  = 99999;
|FPRC;

|PROCESO ma000001;
     nTecGuardian = #200#60;
|FPRC;

|DEFBUCLE ma000001;
     #200#2002;
     44;
     #27#4,      1,      1;
     #27#4, 999999, 999999;
     ;
     NULL, ma000001;
|FIN;

|PROCESO PonGuardian;
     nTecGuardian = 0;
     aAlfa1       = "";
     |DBASS aAlfa1;
     aAlfa1 = aAlfa1 + "dsman9/def/ma000001.mas";
     |CARGA_DEF aAlfa1, ma000001@;
     |SI FSalida ! 0;
         |MENAV "0000 Error en cargar el Def ma000001.mas";
         |ACABA;
     |FINSI;

     aAlfa1 = "";
     |DBASS aAlfa1;
     aAlfa1 = aAlfa1 + "dsman9/fich/84/";
     |PATH_DAT #200 aAlfa1;

     |BUCLE ma000001;

     |DESCARGA_DEF #ma000001@;
|FPRC;

|PROCESO Evento27;  |TIPO 77;
     |SI FSalida = 1;
         |LEE 000#27=;
         |SI FSalida ! 0;  |ACABA;  |FINSI;
         |HAZ PonGuardian;

         #27#13  = nTecGuardian;
         |GRABA 020#27a;
         |LIBERA #27;

         |ABRE #25;
         #25#0 = #27#3;
         |LEE 000#25=;
         |SI FSalida ! 0;  |DDEFECTO #25;  |FINSI;

         |SI #25#4 = "S";
             |ESTADO_CONTROL nBoton1, "ENABLE";
         |SINO;
             |ESTADO_CONTROL nBoton1, "DISABLE";
         |FINSI;
         |CIERRA #25;

         |ACABA;
     |FINSI;

     |SI FSalida = 4;
         #900#0  = #27#0;
         #900#1  = #27#1;
         #900#2  = #27#2;
         #900#3  = #27#3;
         #900#4  = #27#4;
         #900#5  = #27#5;
         #900#6  = #27#6;
         #900#7  = #27#7;
         #900#8  = #27#8;
         #900#9  = #27#9;
         #900#10 = #27#10;
         #900#11 = #27#11;
         #900#12 = #27#12;
         #900#13 = #27#13;

         |ABRE #24;
         #24#0   = #900#4;
         |LEE 000#24=;
         |CIERRA #24;

         |ABRE #19;
         #19#0   = #900#3;
         |LEE 000#19=;
         |CIERRA #19;

         |PUSHV 0501 2380;
         |PINPA #0#900;
         |PINDA #0#900;
         |PINTA 1221, #19#1;
         |PINTA 1421, #24#1;
         |LEETECLA aAlfa1;
         |POPV;
     |FINSI;
|FPRC;

|PROCESO Boton1;
     aOrigen  = "C:\DOCUMENTOS";           |RMKDIR aOrigen;

     aIPRemoto = "";
     |IP_REMOTO aIPRemoto;  |QBF aIPRemoto;

     |DBASE aBase;  |QBT aBase;
     aFichero = #27#3 + ".pdf";  |QBT aFichero;
     aDirPdf  = aBase + "000577/pdfofertas/" + (("00000" + #48#0) % -105) + "/";
     aDestino = aOrigen + "/" + aFichero;
     aOrigen  = aDirPdf + aFichero;
     |SI aIPRemoto ! "";
         |ENVIA_FICHERO aOrigen, aDestino;
     |SINO;
         |COPIA_FICHERO aOrigen, aDestino;
     |FINSI;

     |SI FSalida = 0;
         |RSYSTEM aDestino;
         |RFBORRA aDestino;
     |FINSI;
|FPRC;

|PROCESO diam0027;
     nTecGuardian = 0;
     |BUCLE ma000001;

     #27#13  = nTecGuardian;
     |GRABA 020#27a;
     |LIBERA #27;
|FPRC;

|DEFBUCLE diam0027;
     #27#1;
     ;
     0000, 00, 000000;
     9999, 99, 999999;
     be;
     NULL, diam0027;
|FIN;

|PROCESO AsignaGuardian;
     nTecGuardian = 0;
     aAlfa1       = "";
     |DBASS aAlfa1;
     aAlfa1 = aAlfa1 + "dsman9/def/ma000001.mas";
     |CARGA_DEF aAlfa1, ma000001@;
     |SI FSalida ! 0;
         |MENAV "0000 Error en cargar el Def ma000001.mas";
         |ACABA;
     |FINSI;

     aAlfa1 = "";
     |DBASS aAlfa1;
     aAlfa1 = aAlfa1 + "dsman9/fich/84/";
     |PATH_DAT #200 aAlfa1;

     |BUCLE diam0027;

     |DESCARGA_DEF #ma000001@;
|FPRC;

|PROGRAMA;
     |CLS;
     |CABEZA "Referencias";

     |MENSA "0000 Cargando Tecnicos Guardianes";
     |HAZ AsignaGuardian;
     |BLIN 04;

     |ABRE #104;
     #104#0 = Usuario % 810;
     |LEE 000#104=;
     |SI FSalida ! 0;  |CIERRA #104;  |ACABA;  |FINSI;
     |CIERRA #104;

     |SI #104#7 = "S";
         nDTecnico = 0;
         nHTecnico = 9999;
     |SINO;
         nDTecnico = #104#10;
         nHTecnico = #104#10;
     |FINSI;

     |DBASE aBase;  |QBF aBase;
     aMas = aBase + "def/diam0027.mas";
     |CARGA_DEF aMas, diam0027@;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |ATRI S;  |PINTA 0503, "Doble Click Pantalla Completa.";  |ATRI s;

     |CONTROL_SIMPLE 0, "BOTON,{{217}} Ver Documento ", 0565, 0579, Boton1;
     nBoton1 = FSalida;

     |ESTADO_CONTROL nBoton1, "DISABLE";

     |ABRET #27;
     |LEE 000#27p;
     nPosi1 = 0601;
     nPosi2 = 2380;
     nRango = 2 + 4 + 8 + 16 + 32;
     |LINEAL_SIMPLE #3#27, nRango, nPosi1, nPosi2, ClaveBaja27, ClaveAlta27, NULL;
     nGrid27 = FSalida;
     |CIERRAT #27;

     |DESTRUYECONTROL nGrid27;

     |DESCARGA_DEF #diam0027@;

     |FIN_CONTROL_WINDOWS nBoton1;
     |PULSATECLA;
|FPRO;
