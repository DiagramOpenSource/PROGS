|FICHEROS;
     berm0001 #1;
     berm0002 #2;
     berm0003 #3;
     berm0005 #5;
     berm0008 #8;
     berm0009 #9,MANTE;
     berm0010 #10;
     berm0016 #16,MANTE;
     agifa017 #17;
     agifa019 #19;
     berw0003 #30;   || Tmp Compo
     agifa048 #480;
     agifa049 #49;
|FIN;

|VARIABLES;
     &enIncPreBerria = 0;
     &eaTempo = "";
     &eaModiKit = "S";
     &eaDes = "";
     aModo = "";
     aSer = "";
     nNum = 0;
     nLin = 0;
     nLinCom = 0;
     aAlfa = "";
     nHay = 0;
     nCuenta = 0;
     nForma = 0;
     nModoPed = 0;
     nModo = 0;
     aArt = "";
     aTieneCompo1 = "";
     aArtDefe = "";
     aTalla = "";
     aColor = "";
     nColor = 0;
     nPega = 0;
     i = 0;
     nCamTermi = 0;
     nCamPega = 0;
     nCamTalla = 0;
     nCamFondo = 0;
     nError = 0;
     nIncPrecio = 0;
     nPosLineal = 0;
|FIN;

|PROCESO berm0009;
     #8#0 = #9#0;
     #8#1 = #9#1;
     #8#2 = #9#2;
     #8#6 = #9#3;
     |LEE 121#8=;

     #9#7 = "N";
     aAlfa = #9#5; |QBF aAlfa;
     |SI #2#26 = "C";
          |SI aAlfa = aArtDefe;
               #8#16 = #9#5;
               #8#17 = #9#6;
               #9#7 = "S";
          |SINO;
               #19#0 = aArtDefe;
               |LEE 000#19=;
               |SI FSalida ! 0; |DDEFECTO #19; |FINSI;
               #8#16 = aArtDefe;
               #8#17 = #19#1;
          |FINSI;
     |FINSI;
     |SI #2#26 = "A";
          #3#0 = aArt;
          #3#1 = #9#3;
          #3#2 = #9#4;
          |LEE 020#3=;
          |PARA nCamTermi = 22; |SI nCamTermi [ 23; |HACIENDO nCamTermi = nCamTermi + 1;
               |PARA nCamFondo = 7; |SI nCamFondo [ 11; |HACIENDO nCamFondo = nCamFondo + 1;
                    |PARA nCamPega = 12; |SI nCamPega [ 21; |HACIENDO nCamPega = nCamPega + 1;
                         |PARA nCamTalla = 24; |SI nCamTalla [ 31; |HACIENDO nCamTalla = nCamTalla + 1;
                              |SI #16#3 = #3nCamFondo;
                                        |Y #16#4 = #3nCamTermi;
                                        |Y #16#5 = #3nCamPega;
                                        |Y #16#6 = #3nCamTalla;
                                   #8#16 = #9#5;
                                   #8#17 = #9#6;
                                   #9#7 = "S";
                              |FINSI;
                         |SIGUE;
                    |SIGUE;
               |SIGUE;
          |SIGUE;
     |FINSI;
     |GRABA 020#8a;
     |GRABA 020#9a;
     |LIBERA #8;
     |LIBERA #9;
|FPRC;

|DEFBUCLE berm0009;
     #9#1;
     ;
     aSer, nNum, nLin, #2#1, 000;
     aSer, nNum, nLin, #2#1, 999;
     be;
     NULL, berm0009;
|FIN;

|PROCESO berm0002;
     |SI #2#24 ! "S"; |Y #2#26 ! "M";
          |BUCLE berm0009;
     |FINSI;
|FPRC;

|DEFBUCLE berm0002;
     #2#1;
     ;
     aArt, 001;
     aArt, 999;
     ;
     NULL, berm0002;
|FIN;

|PROCESO CompoDefecto;
     |ABRE #1;
     #1#0 = aArt;
     |LEE 020#1=;
     |CIERRA #1;

     nPega = 0;
     |PARA i = 37; |SI i [ 46; |HACIENDO i = i + 1;
          |SI #1i = #16#5;
               nPega = i - 36; |SAL;
          |FINSI;
     |SIGUE;
     nColor = #16#4 + #16#3 + nPega;

     aTalla = ("000" + #16#6) % -103;
     aColor = ("000" + nColor) % -103;
     aAlfa = aArtDefe % -101;
     |SI aAlfa ! "."; aArtDefe = aArtDefe + "."; |FINSI;
     aArtDefe = aArtDefe + aTalla + "." + aColor;
     |ABRE #3;
     |ABRE #8;
     |ABRE #19;
     |BUCLE berm0002;
     |CIERRA #19;
     |CIERRA #8;
     |CIERRA #3;
|FPRC;

|PROCESO T12; |TIPO 12;
|FPRC;

|PROCESO Min3;
     #30#0 = 1;
|FPRC;

|PROCESO Max3;
     #30#0 = 999;
|FPRC;

|PROCESO CargaCompo;
     |DDEFECTO #17;
     #17#0 = #49#2;
     #17#1 = #49#9;
     |LEE 000#17=;

     #30#0 = #49#1;
     #30#1 = #480#0;
     #30#2 = #480#1;
     #30#3 = #49#2;
     #30#4 = #49#3;
     #30#5 = #49#12;
     #30#6 = #17#39;
     |GRABA 020#30n;
|FPRC;

|PROCESO DesMarcaDefe;
     |SI nLinCom ! #9#4;
          #9#7 = "N";
          |GRABA 020#9a;
     |FINSI;
|FPRC;

|DEFBUCLE DesMarcaDefe;
     #9#1;
     ;
     #8#0, #8#1, #8#2, #8#6, 001;
     #8#0, #8#1, #8#2, #8#6, 999;
     ;
     NULL, DesMarcaDefe;
|FIN;

|PROCESO HayDefe;
     nCuenta = nCuenta + 1;
     |SI #9#7 = "S";
          nHay = 1;
          |ERROR10;
     |FINSI;
|FPRC;

|DEFBUCLE HayDefe;
     #9#1;
     ;
     #8#0, #8#1, #8#2, #8#6, 001;
     #8#0, #8#1, #8#2, #8#6, 999;
     ;
     NULL, HayDefe;
|FIN;

|PROCESO SacaCompo;
     |PUSHV 0501 2380;
     |PARA; |SI; |HACIENDO;
          |PINPA #0#9;
          |ENTLINEAL #1#9, -5, 4, 22, 0, Min9, Max9;
          nHay = 0;
          nCuenta = 0;
          |BUCLE HayDefe;
          |SI nHay = 0; |Y nCuenta ! 0;
               |MENAV "0000Debe de indicar un articulo como defecto...";
          |SINO;
               |SAL;
          |FINSI;
     |SIGUE;
     |POPV;
|FPRC;

|PROCESO Tecla9_11; |TIPO 11;
     |SI FSalida = 13;
          |SI aModo = "M";
               nLinCom = #9#4;
               |SALVA_FICHA #9;
               |BUCLE DesMarcaDefe;
               |REPON_FICHA #9;
               |SI #9#7 = "N";
                    #8#16 = #9#5;
                    #8#17 = #9#6;
                    #9#7 = "S";
               |SINO;
                    #9#7 = "N";
               |FINSI;
               |GRABA 020#9a;
               |PONCONTROL 23, "SI";
          |SINO;
               |MENAV "0000Opción no valida en consulta...";
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Min9;
     #9#0 = aSer;
     #9#1 = nNum;
     #9#2 = nLin;
     #9#3 = #8#6;
     #9#4 = 001;
|FPRC;

|PROCESO Max9;
     #9#0 = aSer;
     #9#1 = nNum;
     #9#2 = nLin;
     #9#3 = #8#6
     #9#4 = 999;
|FPRC;

|PROCESO Tipo11; |TIPO 11;
     |SI FSalida = 13;
          |SI #8#18 = 1;
               |MENAV "0000Opcion no valida para tipo componente 1 (CUADRO)";
               |ERROR; |ACABA;
          |FINSI;
          |SI #8#13 = "N";
               |SI aModo = "M";
                    |HAZ SacaCompo;
                    |PINTA #8#16;
                    |PINTA #8#17;
                    |GRABA 020#8a;
               |SINO;
                    |PUSHV 0501 2380;
                    |ENTLINEAL #1#9, -5, 4, 22, 1, Min9, Max9;
                    |POPV;
               |FINSI;
          |SINO;
               |MENAV "0000El articulo es final...";
          |FINSI;
          |SI aModo = "M"; |ERROR; |FINSI;
     |FINSI;
     |SI FSalida = 15;
          |HAZ CreaTempo; |NOME_DAT #30 eaTempo; |DELINDEX #30;
          |SI #8#13 = "N";
               aAlfa = #8#16;
          |SINO;
               aAlfa = #8#3;
          |FINSI;
          |ABRE #30;
          |ABRE #480;
          #480#0 = aAlfa;
          |LEE 000#480=;
          |SI FSalida = 0;
               |ABRE #17;
               |BUCLELIN 0 CargaCompo #480;
               |CIERRA #17;
               |PUSHV 0501 2380;
               |ENTLINEAL #1#30, -1, 2, 22, 1, Min3, Max3;
               |POPV;
          |SINO;
               |MENAV "0000El articulo no es un escandallo...";
          |FINSI;
          |CIERRA #480;
          |CIERRA #30;
          |HAZ BoraTempo; |DELINDEX #30;
          |ERROR;
     |FINSI;
|FPRC;

|PROCESO NoAlta; |TIPO 0;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 1;
          |AVISO;
          |ERROR;
     |FINSI;
|FPRC;

|PROCESO Min;
     #8#0 = aSer;
     #8#1 = nNum;
     #8#2 = nLin;
     |SI FSalida = "POSICION";
          #8#6 = nPosLineal;
     |SINO;
          #8#6 = 001;
     |FINSI;
|FPRC;

|PROCESO Max;
     #8#0 = aSer;
     #8#1 = nNum;
     #8#2 = nLin;
     #8#6 = 999;
|FPRC;

|PROCESO Borra9;
     |BORRA 020#9a;
|FPRC;

|DEFBUCLE Borra9;
     #9#1;
     ;
     #8#0, #8#1, #8#2, #8#6, 001;
     #8#0, #8#1, #8#2, #8#6, 999;
     be;
     NULL, Borra9;
|FIN;

|PROCESO Tipo2; |TIPO 2;
     nForma = 0 +. 1;
     nModo = (FEntrada / 100) ! 0;
     |SI #8#13 = "S"; |O nModo = 3;
          |BUCLE Borra9;
     |FINSI;
     |SI nForma = 1; |Y #8#13 = "N";
          |HAZ SacaCompo;
     |FINSI;
|FPRC;

|PROCESO MontaDes;
     |SI #8#18 = 1;
          |DDEFECTO #19;
          |ABRE #19;
          #19#0 = #8#16;
          |LEE 000#19=;
          |CIERRA #19;

          |DDEFECTO #5;
          |ABRE #5;
          #5#0 = #19#110;
          |LEE 000#5=;
          |CIERRA #5;

          eaDes = eaDes + " " + #5#1; |QBF eaDes;
          eaDes = eaDes + " " + (#19#111 % 103);
          |ERROR10;
     |FINSI;
|FPRC;

|DEFBUCLE MontaDes;
     #8#1;
     ;
     aSer, nNum, nLin, 001;
     aSer, nNum, nLin, 999;
     ;
     NULL, MontaDes;
|FIN;

|PROCESO Borra8;
     |BORRA 020#8a;
|FPRC;

|DEFBUCLE Borra8;
     #8#1;
     ;
     aSer, nNum, nLin, 001;
     aSer, nNum, nLin, 999;
     be;
     NULL, Borra8;
|FIN;

|PROCESO TieneCompo1;
     |SI #2#22 = 1;
          |ERROR10;
          aArtDefe = #2#2; |QBF aArtDefe;
          aTieneCompo1 = "S";
     |FINSI;
|FPRC;

|DEFBUCLE TieneCompo1;
     #2#1;
     ;
     aArt, 001;
     aArt, 999;
     ;
     NULL, TieneCompo1;
|FIN;

|PROCESO Fondo; |TIPO 0;
     |ABRE #5;
     #5#0 = #16#3;
     |LEE 000#5=;
     |SI FSalida = 0;
          |SI #5#8 ! "F";
               |MENAV "0000El color no es de fondo...";
               |ERROR;
          |SINO;
               |PARA i = 55; |SI i [ 59; |HACIENDO i = i + 1;
                    |SI #5#0 = #1i; |SAL; |FINSI;
               |SIGUE;
               |SI i > 59;
                    |MENAV "0000No existe color de fondo en el escandallo...";
                    |ERROR;
               |FINSI;
          |FINSI;
     |SINO;
          |MENAV "0000No existe color...";
          |ERROR;
     |FINSI;
     |CIERRA #5;
|FPRC;

|PROCESO Termi; |TIPO 0;
     |ABRE #10;
     #10#0 = #16#4;
     |LEE 000#10=;
     |SI FSalida = 0;
          |SI #10#0 ! #1#60; |Y #10#0 ! #1#61;
               |MENAV "0000No existe terminacion en el escandallo...";
               |ERROR;
          |FINSI;
     |SINO;
          |MENAV "0000No existe terminacion...";
          |ERROR;
     |FINSI;
     |CIERRA #10;
|FPRC;

|PROCESO Pega; |TIPO 0;
     |ABRE #5;
     #5#0 = #16#5;
     |LEE 000#5=;
     |SI FSalida = 0;
          |SI #5#8 ! "P";
               |MENAV "0000El color no es de pegatina...";
               |ERROR;
          |SINO;
               |PARA i = 37; |SI i [ 46; |HACIENDO i = i + 1;
                    |SI #5#0 = #1i; |SAL; |FINSI;
               |SIGUE;
               |SI i > 46;
                    |MENAV "0000No existe color de pegatina en el escandallo...";
                    |ERROR;
               |FINSI;
          |FINSI;
     |SINO;
          |MENAV "0000No existe color...";
          |ERROR;
     |FINSI;
     |CIERRA #5;
|FPRC;

|PROCESO Talla; |TIPO 0;
     |PARA i = 64; |SI i [ 71; |HACIENDO i = i + 1;
          |SI #16#6 = #1i; |SAL; |FINSI;
     |SIGUE;
     |SI i > 71;
          |MENAV "0000No existe talla en el escandallo...";
          |ERROR;
     |FINSI;
|FPRC;

|PROCESO CheqFinalCom;
     |SI #9#7 = "S";
          nHay = 1;
          nIncPrecio = nIncPrecio + #9#8;
     |FINSI;
|FPRC;

|DEFBUCLE CheqFinalCom;
     #9#1;
     ;
     #8#0, #8#1, #8#2, #8#6, 000;
     #8#0, #8#1, #8#2, #8#6, 999;
     ;
     NULL, CheqFinalCom;
|FIN;

|PROCESO CheqFinal;
     |SI #8#18 ! 1;      || que no sea cuadro
          |SI #8#13 = "N";
               nHay = 0;
               |BUCLE CheqFinalCom
          |SINO;
               nHay = 1;
          |FINSI;
          |SI nHay = 0;
               aAlfa = "0000Final no indicado en tipo componente: " + #8#19;
               |QBF aAlfa;
               |MENAV aAlfa;
               nError = 1;
               |SI nPosLineal = 0; nPosLineal = #8#6; |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE CheqFinal;
     #8#1;
     ;
     aSer, nNum, nLin, 000;
     aSer, nNum, nLin, 999;
     ;
     NULL, CheqFinal;
|FIN;

|PROGRAMA;
     aAlfa = PARAMETRO % 101; aModo = aAlfa;
     aAlfa = PARAMETRO % 205; aSer = aAlfa;
     aAlfa = PARAMETRO % 706; nNum = aAlfa;
     aAlfa = PARAMETRO % 1303; nLin = aAlfa;
     aAlfa = PARAMETRO % 1620; aArt = aAlfa;
     aAlfa = PARAMETRO % 3601; nModoPed = aAlfa;

     |SI aModo = "B";
          |BUCLE Borra8;
          |ABRE #16;
          #16#0 = aSer;
          #16#1 = nNum;
          #16#2 = nLin;
          |BORRA 000#16c;
          |CIERRA #16;
          |ACABA;
     |FINSI;

     aTieneCompo1 = "N";
     |BUCLE TieneCompo1;

     |SI nModoPed = 1; |Y aModo = "M"; |Y aTieneCompo1 = "S";
          |ABRE #1;
          #1#0 = aArt;
          |LEE 020#1=;
          |CIERRA #1;

          |DDEFECTO #16;
          |ABRE #16;
          #16#0 = aSer;
          #16#1 = nNum;
          #16#2 = nLin;
          |LEE 101#16=;
          |SI FSalida ! 0; |GRABA 020#16b; |FINSI;

          |ENTLINEAL #1#8, -4, 7, 22, 1, Max, Min;
          |PINTA #8#14;
          |PINTA #8#17;
          |PINDA #0#16;
          |ENDATOS #1#16;
          |SI FSalida = 0; |GRABA 020#16a; |FINSI;
          |CIERRA #16;
          |HAZ CompoDefecto;
     |FINSI;

     |DDEFECTO #16;
     |ABRE #16;
     #16#0 = aSer;
     #16#1 = nNum;
     #16#2 = nLin;
     |LEE 000#16=;
     |CIERRA #16;
     |PINPA #0#8;
     |PINDA #0#16;

     |SI aModo = "M";
          nPosLineal = 1;
          |PARA; |SI; |HACIENDO;
               |ENTLINEAL #1#8, -4, 2, 22, 0, Min, Max;
               nError = 0;
               nIncPrecio = 0;
               nPosLineal = 0;
               |BUCLE CheqFinal;
               |SI nError = 0; |SAL; |FINSI;
          |SIGUE;
          enIncPreBerria = nIncPrecio;
          |SI eaModiKit = "S";
               |QBF eaDes;
               |BUCLE MontaDes;
          |FINSI;
     |SINO;
          |ENTLINEAL #1#8, -4, 4, 22, 0, Min, Max;
     |FINSI;
|FPRO;
