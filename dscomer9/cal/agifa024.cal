  || No a¤adir mas ficheros, el bogew004 peta (ponerlo como referencia)

|FICHEROS;
     agifa024 #0;
     agifa142 #1;
     agifa027 #2;
     agifa162@ #3;
     agifa321 #5;
     agifa324 #6;
     dsm00003 #7,MANTE;
     agifa091 #91;
     dsm00045 #45,MANTE;
     agifa025 #25;
     marhup07@ #30;
     marhup09@ #40;
     agifa010 #10;
     dsm00018 #18;
     agif0041 #41;
     dsm00130 #130,MANTE;
     agifm001 #101;
     agifm002 #102;

     dscam045@ #1000;
     dscam001@ #1001;
     dscam002@ #1002;

     visal100@ #2000;
     visalm01@ #2001;
     visalm36@ #2002;
     visalm00@ #2003;

     agifa024@ #1100;
     referen@ #66;

     auxilia@  #999;
     dsm00248 #143; ||Auditoria.
     dsm00247 #141; ||Pantalla Informe Riesgo.
     agifa065 #65;
     dsm00279 #279;
     dsm00225 #225;

     Ref0001@;
|FIN;

|VARIABLES;
     nSwFergalsan = 0;
     aRutaAntes = "";
     nBtnItemDocCli = -1;
     &enAprobacion = 0;
     nGuarda = 0;
     &enSwWebServiceFace = 0;
     aMensaje = "";

     nSwArchiActivo = 0;
     nSwHayBotonArriba = 0;
     nBotonAAPP = 0;

     &eaSucursal = "";
     &eaEntidad = "";
     &eaDC = "";
     &eaIBAN = "";
     &eaIBANant = "";
     nBotonAnalisis = 0;
     nBtnAux = -1;
     nBtnExtintor = -1;
     nBtnAuxCham = 0;
     nPantaDir = 0;
     nTecla = 0;
     nBotonEva1 = 0;
     nBotonEva2 = 0;
     nBotonEva3 = 0;
     nBotonEva4 = 0;
     nSwEvaristo = 0;
     &PRMNT_aHisto = "";
     nBtnOpciones = -1;
     nBotonPCEG = -1;
     nBotonVigor = -1;
     nSwCambiaDir = 0;
     aNuevo = "";
     aNif = "";
     &eaNif = "";
     nForma = 0;
     nConAu = 0;
     aUs = "";
     &nMasRies  = 0;
     nPosicion = 0;
     aAux = "";
     aLong = "";
     nLong = 0;
     nConta = 0;
     nSaca = 0;
     aSaca = "";
     aLetra = "";

     &enSwRecalAlb = 0;
     aAlta = "";
     nCliente = 0;
     aCliente = "";
     nError = 0;
     nTallerEmp2 = 0;
     nTallerEmp3 = 0;
     &eaTag = "";
     &enSwAltaCli = 0; || Para la replica segun el control de empresas

     &nRieTotal = 0;
     &nRieUtili = 0;
     &eaCodCliente = "";
     &eaNomCliente = "";

     aDef = "";
     nDia1 = 0;
     nDia2 = 0;
     aPath   = "";
     nBtnTramo = 0;
     nBtnFPago = 0;
     nBtnTramo1 = 0;
     nBtnFPago1 = 0;
     nCont   = 0;
     nEmpre  = 0;
     nExiste = 0;
     aDir    = "";
     aParametro = "";
     &endigC   = 0;
     &eaCta    = "";
     &eswCta   = 0;

     nCampo    = 0;
     nCalc     = 0;

     aDest     = "";
     aOrig     = "";

   {1}nPuntero   = 0;
     || NO PONER NINGUNA VARIABLE ENTRE ESTAS DOS ..... SE USAN COMO PUNTEROS
      aNume      = "";

     nReg      = 0;
     &enSwCtrlUsu  = 0;

     nCamCli   = 0;
     nCamAlb   = 0;
     alfa      = "";
     nMod      = 0;
     nFor      = 0;
     swCar1    = 0;
     swCar2    = 0;
     nSal      = 0;
     aAlfa     = "";
     aProg = "";
     &cli = "";
     &ser = "";
     &nDeci_Base = 0;
     &nDeci_PreBase = 0;
     &ext1 = "";
     nModiRec = 0;
     nModiRete = 0;
     &pasa = "C";
     salida = 0;
     &orden = "";
     &mes = 0;
     i = 0;
     tot = 0;
     &modo = 0;
     contador = 0;
     cont = "";
     programa = "";
     sw1 = 0;
     cam_pos = 0;
     cam_vis = "";
     cam_mod = "";
     vis = 0;
     puente = "";
     puente1 = "";
     &registro = "";
     cuen      = "";
     quitar    = 0;
     quitar1   = "";
     &cod_campo = "";
     &num_campo = 0;
     &sw_nom = 0;
     &cod_cli = "";
     &nom_cli = "";
     cod      = 0;

     &eaCodigo     = "";
     &eaTipoCodigo = "CL";

     aAlfa1     = "";
     aAlfa2     = "";
     nNume1     = 0;
     nLongi     = 0;

     {-1}menu = "";
     menu1 = "2400";
     menu2 = "1";
     menu3 = "Contador:  ";
     menu4 = "AM";
     menu5 = " Automatico ";
     menu6 = " Manual ";

 {-1}aUtil  = "";
     aUtil1 = "2400";
     aUtil2 = "1";
     aUtil3 = "";
     aUtil4  = "IOgPDTCRL";
     aUtil5  = "Imprimir";
     aUtil6  = "Observ.";  || aciones
     aUtil7  = "Desglose";
     aUtil8  = "F.Pago";
     aUtil9  = "Direcciones";
     aUtil10 = "Tr. no pago";
     aUtil11 = "Contactos";
     aUtil12 = "Recibos Pdte";
     aUtil13 = "Informe Recibos Pdte";

     nModo  = 0;
     nPas   = 0;

     nCambioAlgo  = 0;
     &eaClPr      = "";
     &eaCodigoNum = "";

     aNifQbf1   = "";
     aNifQbf2   = "";
     nCam114 = 0;

     &eaVarDni  = "";
     &enCalcCif = 0;
     &eaCtaCble = "";
     &enRieConce = 0;
     &enRieDispo = 0;
     &enRieUtil  = 0;
     &eaMensaCad = "";
     &enErrorCad = 0;
     &enOk       = 0;
     &eaCod      = "";
     &eaModo     = "";
|FIN;

|INCLUYE i_varart;

|PROCESO CambioDias; |TIPO 0;
     nModo = (FEntrada / 100) ! 0;
     |SI #0Campo ! Contenido;
          |SI Campo = 22; |O Campo = 23; |O Campo = 24;
               |SI nModo = 2;
                    |MENAV "0000Atención: Las facturas ya realizadas a este cliente no se actualizarán con estos datos.";
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO CambioAlgo_c; |TIPO 0;
     nModo = (FEntrada / 100) ! 0;
     |SI #0Campo ! Contenido;
          nCambioAlgo = 1;
          |SI Campo = 15; |Y nModo = 2;
               |HAZ ModiNIFCIF;
          |FINSI;
          |SI Campo = 30; |Y  nModo = 2;
               |MENAV "0000Atención: Las facturas ya realizadas a este cliente no se actualizarán con estos datos.";
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO totales;|TIPO 0;
     |SI Campo ] 114;
          mes = Campo - 114;
          i = mes $ 3;
          tot = 150 + i;
     |SINO;
          mes = Campo - 54;
          i = mes $ 4;
          tot = 102 + i;
     |FINSI;
     #0tot = #0tot - Contenido + #0Campo;
     |PINTA #0tot;
|FPRC;

|PROCESO Alta1; |TIPO 7;
     modo = (FEntrada / 100) ! 0;
     |SI modo = 1;
          |HAZ LeeDecimBase;
          #0#192 = #agifa321#9; ||Por defecto, cojo como divisa la mon. de trabajo

          |HAZ EsTaller;
          |SI FSalida = 0;
               |DDEF aAlfa; aAlfa = aAlfa + "con00691";
               |CARGA_DEF aAlfa, referen@;
               |SI FSalida = 0;
                    |ABRE #referen@; |LEE 000#referen@.p; |CIERRA #referen@;
                    #0#163 = #referen@#2;
                    |DESCARGA_DEF #referen@;
               |FINSI;
          |FINSI;
     |FINSI;

     |SI nSwArchiActivo = 1;
          |ESTADO_CONTROL nBotonAAPP, "ENABLE";
     |FINSI;
|FPRC;

|PROCESO alta; |TIPO 7;
     nPas = 0;

     |ABRE #agifa142; |LEE 001#agifa142.p; |CIERRA #agifa142;
     modo = (FEntrada / 100) ! 0;

     |SI modo = 0;
          FSalida = 0; |ACABA; || se llama con un encampo desde otro tab
     |FINSI;

     |SI modo = 1;
          eaDocu = "agifa024";
          |HAZ ControlUsu;
          |SI enSwCtrlUsu ! 0;
               |ERROR; |ACABA;
          |FINSI;
     |FINSI;
     |SI modo = 1;
          |MODULO programa; |QBF programa;
          |SI programa = "agifa024";  |Y #1#1 = "S";
               |HAZ menus;
          |FINSI;
     |FINSI;
     |SI PRMNT_aHisto ! "";
          aAlfa = PRMNT_aHisto % 106;

          #0#0 = aAlfa;
          |PTEC 802;
          |PINTA #0#0;
          PRMNT_aHisto = "";
          |ACABA;
     |FINSI;
|FPRC;

|RUTINA menus;
     |MENU menu;
     |SI FSalida = 1;    ||Automatico
          |HAZ EsVipei;
          |SI FSalida = 0;
               |LEE 000#agifa024.u;
               |SI FSalida = 0;
                    nCliente = #agifa024#0;
                    nCliente = nCliente + 1;
               |SINO;
                    nCliente = 1;
               |FINSI;
               aCliente = ("000000" + nCliente) % -106;
               |DDEFECTO #agifa024;
               #agifa024#0 = aCliente;
               |PINTA #agifa024#0;
          |SINO;
               |ABRE #2;
               #2#0 = "clientes";
               |LEE 101#2=;
               |SI FSalida = 0;
                    #2#1 = #2#1 + 1;
                    contador = #2#1;
                    |GRABA 021#2a;
               |SINO;
                    contador = 1;
                    #2#1 = 1;
                    |GRABA 021#2n;
               |FINSI;
               cont = contador;
               cont = ("000000" + cont) % -106;
               #0#0 = cont;
               |PINTA #0#0;
               |||PTEC 802;     ||Provoco un return para saltar de campo
               |LIBERA #2;
               |CIERRA #2;
          |FINSI;
     |FINSI;
|FRUT;

|PROCESO tex; |TIPO 14;
     #0#177 = &178 * 4;
     |CAMPO_MODIFICA #0#177 , 1 , "S";
     |CAMPO_VISUAL #0#177 , 1 , "S";
|FPRC;

||ARA
|PROCESO texto; |TIPO 14;
     |CAMPO_MODIFICA #0#177 , 1 , "N";
     |CAMPO_VISUAL #0#177 , 1 , "N";
     |SI sw1 ! 0; |ACABA; |FINSI;

     |DDEF aDef;
     aDef = aDef + "agifa162";
     |CARGA_DEF aDef, agifa162@;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |ABRE #3;
     #3#0 = "A";
     |LEE 001#3=;
     |SI FSalida = 0;
          |PINDA #1#3;
          sw1 = 1;
          |PARA i = 1; |SI i [ 12; |HACIENDO i = i + 1;
               cam_mod = #3i;
               cam_pos = i + 12;
               cam_pos = #3cam_pos;
               vis = i + 25;
               cam_vis = #3vis;
               |HAZ modifica1;
          |SIGUE;
          sw1 = 0;
     |FINSI;
     |CIERRA #3;
     |DESCARGA_DEF #agifa162@;
|FPRC;


|PROCESO modifica1;
     |SI i = 1;
          |CAMPO_MODIFICA #0#163 , 1 , cam_mod;
          |CAMPO_VISUAL #0#163 , 1 , cam_vis;
          |CAMPO_POSICION #0#163 , 1 , cam_pos;
     |FINSI;
     |SI i = 2;
          |CAMPO_MODIFICA #0#164 , 1 , cam_mod;
          |CAMPO_VISUAL #0#164 ,  1 , cam_vis;
          |CAMPO_POSICION #0#164 , 1 , cam_pos;
     |FINSI;
     |SI i = 3;
          |CAMPO_MODIFICA #0#165 , 1 , cam_mod;
          |CAMPO_VISUAL #0#165 ,  1 , cam_vis;
          |CAMPO_POSICION #0#165 , 1 , cam_pos;
     |FINSI;
     |SI i = 4;
          |CAMPO_MODIFICA #0#166 , 1 , cam_mod;
          |CAMPO_VISUAL #0#166 ,  1 , cam_vis;
          |CAMPO_POSICION #0#166 , 1 , cam_pos;
     |FINSI;
     |SI i = 5;
          |CAMPO_MODIFICA #0#167 , 1 , cam_mod;
          |CAMPO_VISUAL #0#167 ,  1 , cam_vis;
          |CAMPO_POSICION #0#167 , 1 , cam_pos;
     |FINSI;
     |SI i = 6;
          |CAMPO_MODIFICA #0#168 , 1 , cam_mod;
          |CAMPO_VISUAL #0#168 ,  1 , cam_vis;
          |CAMPO_POSICION #0#168 , 1 , cam_pos;
     |FINSI;
     |SI i = 7;
          |CAMPO_MODIFICA #0#169 , 1 , cam_mod;
          |CAMPO_VISUAL #0#169 ,  1 , cam_vis;
          |CAMPO_POSICION #0#169 , 1 , cam_pos;
     |FINSI;
     |SI i = 8;
          |CAMPO_MODIFICA #0#170 , 1 , cam_mod;
          |CAMPO_VISUAL #0#170 ,  1 , cam_vis;
          |CAMPO_POSICION #0#170 , 1 , cam_pos;
     |FINSI;
     |SI i = 9;
          |CAMPO_MODIFICA #0#171 , 1 , cam_mod;
          |CAMPO_VISUAL #0#171 ,  1 , cam_vis;
          |CAMPO_POSICION #0#171 , 1 , cam_pos;
     |FINSI;
     |SI i = 10;
          |CAMPO_MODIFICA #0#172 , 1 , cam_mod;
          |CAMPO_VISUAL #0#172 ,  1 , cam_vis;
          |CAMPO_POSICION #0#172 , 1 , cam_pos;
     |FINSI;
     |SI i = 11;
          |CAMPO_MODIFICA #0#173 , 1 , cam_mod;
          |CAMPO_VISUAL #0#173 ,  1 , cam_vis;
          |CAMPO_POSICION #0#173 , 1 , cam_pos;
     |FINSI;
     |SI i = 12;
          |CAMPO_MODIFICA #0#174 , 1 , cam_mod;
          |CAMPO_VISUAL #0#174 ,  1 , cam_vis;
          |CAMPO_POSICION #0#174 , 1 , cam_pos;
     |FINSI;
|FPRC;

|PROCESO cp;
     puente = #0#178; puente = "00" + puente; puente = puente % -102;
     puente1 = puente;
     puente = #0#179; puente = "000" + puente; puente = puente % -103;
     puente1 = puente1 + puente;
     #0#180 = puente1;
|FPRC;

|PROCESO cp1;
     puente = #0#181; puente = "00" + puente; puente = puente % -102;
     puente1 = puente;
     puente = #0#182; puente = "000" + puente; puente = puente % -103;
     puente1 = puente1 + puente;
     #0#183 = puente1;

     |SI #0Campo ! Contenido;
          #0#211 = puente1; |PINTA #0#211;
          |HAZ EsPCEGroup;
          |SI FSalida = 0;
               |HAZ PCEG_Zona;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO cp2;
     puente = #0#184; puente = "00" + puente; puente = puente % -102;
     puente1 = puente;
     puente = #0#185; puente = "000" + puente; puente = puente % -103;
     puente1 = puente1 + puente;
     #0#186 = puente1;
|FPRC;

|PROCESO marhup07;
     #40#0 = #0#0;
     #40#3 = #30#0;
     |LEE 101#40=;
     nSal = FSalida;
     #40#1 = #0#1;
     #40#2 = 1;
     #40#4 = #30#1;
     |SI nSal = 0; |GRABA 020#40a; |FINSI;
     |SI nSal ! 0; |GRABA 020#40n; |FINSI;
     |LIBERA #40;
|FPRC;

|DEFBUCLE marhup07;
     #30#1001;
     ;
     "  ";
     "zz";
     ;
     NULL,marhup07;
|FIN;

|PROCESO dsm00018Bor;
     |BORRA 020#18a;
|FPRC;

|PROCESO dsm00003Bor;
     |BORRA 020#7a;
|FPRC;

|PROCESO dsm00045Bor;
     |BORRA 020#45a;
|FPRC;

|DEFBUCLE dsm00018Bor;
     #18#1;
     ;
     #0#0, "CL", 001;
     #0#0, "CL", 999;
     be;
     NULL, dsm00018Bor;
|FIN;

|DEFBUCLE dsm00045Bor;
     #45#1;
     ;
     #0#0, 001;
     #0#0, 999;
     be;
     NULL, dsm00045Bor;
|FIN;

|DEFBUCLE dsm00003Bor;
     #7#1;
     ;
     #0#0, 0001;
     #0#0, 9999;
     be;
     NULL, dsm00003Bor;
|FIN;

|PROCESO dsm00130Bor;
     |BORRA 020#130a;
|FPRC;

|DEFBUCLE dsm00130Bor;
     #130#1;
     ;
     #0#0, 01;
     #0#0, 99;
     be;
     NULL, dsm00130Bor;
|FIN;


|PROCESO copia; |TIPO 2;
     enSwAltaCli = (FEntrada/100)!0; || Para el control de empresas
     nForma = 0 +. 1;
     nModo = (FEntrada / 100) ! 0;
     |ABRE #agifa142; |LEE 001#agifa142.p; |CIERRA #agifa142;

     ||Cuando vuelve del boton, el nModo vale CERO.
     |SI nModo = 2; |O nModo = 0;
          |HAZ EsLegiplag;
          |SI FSalida = 0;
               |SI nForma = -1;
                    |ESTADO_CONTROL nBotonAnalisis, "ENABLE";
               |SINO;
                    |ESTADO_CONTROL nBotonAnalisis, "DISABLE";
               |FINSI;
          |FINSI;
     |FINSI;

     eaDocu = "agifa024";
     |HAZ ControlUsu;
     |SI enSwCtrlUsu ! 0;
          |ERROR; |ACABA;
     |FINSI;

     |SI nForma = 1;
          |HAZ CamObliga2;
          |SI FSalida ! 0; |ERROR; |ACABA; |FINSI;
     |FINSI;

     |SI nModo = 3;
         |HAZ CargaContagen;
         |SI enOk = 1;
             eaCod     = #agifa024#0;
             eaCtaCble = #agifa024#16;
             eaTipo    = "C";
             |HAZ BorraCliProv;
             |SI enError = 1;
                 |MENAV "0000Existen movimientos de esta ficha. Se cancela la baja";
                 |ERROR;
                 |ACABA;
             |FINSI;
         |SINO;
             |ABRE #65;
             |SELECT #3#65;
             |DDEFECTO #65;
             #65#10 = #0#0;
             #65#1 = "01.01.0000";
             |LEE 000#65];
             |SI FSalida = 0; |Y #65#10 = #0#0;
                 |CONFI "0000NExisten movimientos de esta ficha. Continuar con la baja?";
                 |SI FSalida ! 0;
                    |ERROR; |ACABA;
                 |FINSI;
             |FINSI;
             |CIERRA #65;
         |FINSI;
     |FINSI;

     |SI enSwAltaCli ! 1;
       ||   |SI nForma = 1; |Y enErrRie ! 0; |ERROR; |ACABA; |FINSI;
          |HAZ Riesgo024;
       ||   |SI enErrRie ! 0; |ERROR; |ACABA; |FINSI;
     |FINSI;

     #0#175 = "N";
     #0#176 = "00.00.0000";

     |SI swCar1 = 1; |Y swCar2 = 1; |Y nModo = 1;
          |ABRE #40;
          |BUCLE marhup07;
          |CIERRA #40;
     |FINSI;

     |SI nModo = 3;
          |BUCLE dsm00018Bor;
          |BUCLE dsm00045Bor;
          |BUCLE dsm00003Bor;
          |BUCLE dsm00130Bor;
          eaCliente = #0#0; |SUB_EJECUTA_NP "dsm00289;B";

          |HAZ EsEvaristo;
          |SI FSalida = 0;
               |HAZ BorraEvaAviso;
          |FINSI;
          |HAZ EsChampi;
          |SI FSalida = 0;
               eaCliente = #7#0;
               enDirEnt = 0;
               |SUB_EJECUTA_NP "champ006;BORRA";
          |FINSI;
          |HAZ EsCamiCor;
          |SI FSalida = 0;
               eaCliente = #0#0;
               |SUB_EJECUTA_NP "camcor20;BORRA";
          |FINSI;
          |HAZ EsExtintor;
          |SI FSalida = 0;
               eaCliente = #0#0;
               |SUB_EJECUTA_NP "extm0002;BAJATODO";
          |FINSI;

/*
          |HAZ EsFergalsan;
          |SI FSalida = 0;
               eaCliente = #0#0;
               |SUB_EJECUTA_NP "fergam17;BORRA";
          |FINSI;
*/
     |SINO;
          |SI nForma = 1;
               |HAZ EsCamiCor;
               |SI FSalida = 0;
                    eaCliente = #0#0;
                    |SUB_EJECUTA_NP "camcor20;SINOEXISTE";
               |FINSI;
               |HAZ EsExtintor;
               |SI FSalida = 0;
                    eaCliente = #0#0;
                    enDirEnt = 1;
                    |SUB_EJECUTA_NP "extm0002;SINOEXISTE";
               |FINSI;
          |FINSI;
     |FINSI;

     |HAZ EsJamaica;
     |SI FSalida = 0; |HAZ RutaPsioa; |FINSI;
     |HAZ EsGesisat;
     |SI FSalida = 0; |HAZ ActGesisat; |FINSI;

     |SI nForma = 1; |Y nBtnOpciones ] 0;  || Del modulo 003308 de PceGroup
          |FIN_CONTROL_WINDOWS nBtnOpciones;
     |FINSI;
|FPRC;

|PROCESO DirEntre;
     |HAZ Graba1Dir;
     |PUSHV 0501 2380;
     |PINPA #0#7; nPantaDir = FSalida;

     |HAZ EsChampi;
     |SI FSalida = 0;
          |CONTROL_SIMPLE nPantaDir, "BOTON,{{137}}Datos Edi", 0570, 0580, AuxChampi;
          nBtnAuxCham = FSalida;
     |FINSI;

     |HAZ EsExtintor;
     |SI FSalida = 0;
          |CONTROL_SIMPLE nPantaDir, "BOTON,{{137}}Auxiliar", 0668, 0678, BtnExtintor;
          nBtnExtintor = FSalida;
     |FINSI;

     |HAZ EsPCEGroup;
     |SI FSalida = 0; |ATRI R; |PINTA 0504, "DIRECCIONES DE FACTURA/ENTREGA"; |ATRI 0;|FINSI;
     |ENTLINEAL #1#7, -2, modo, 22, 0, InfDir, SupDir;

     |SI nBtnAuxCham ! -1; |FIN_CONTROL_WINDOWS nBtnAuxCham; |FINSI;
     |SI nBtnExtintor ! -1; |FIN_CONTROL_WINDOWS nBtnExtintor; |FINSI;

     |POPV;

     |HAZ EsMalpesa;
     |SI modo ! 4; |Y FSalida ! 0; ||****Malpesa no graba la dir1*****
          #0#180 = (("00" + #0#178) % -102) + (("000" + #0#179) % -103);
          #0#183 = (("00" + #0#181) % -102) + (("000" + #0#182) % -103);
          #0#186 = (("00" + #0#184) % -102) + (("000" + #0#185) % -103);

          |ABRE #7;
          |DDEFECTO #7;
          #7#0 = #0#0;
          #7#1 = 1;
          |LEE 101#7=;
          |SI FSalida ! 0; |GRABA 021#7b; |FINSI;
          |LEE 101#0=;
          #0#2 = #7#10;  |PINTA #0#2;
          #0#3 = #7#11;  |PINTA #0#3;
          #0#17 = #7#13; |PINTA #0#3;
          #0#25 = #7#14;
          #0#189 = #7#16;
          #0#205 = #7#19; |PINTA #0#205;
          #0#14 = #7#8; |PINTA #0#14;
          #0#196 = #7#20; |PINTA #0#196;
          #0#18 = #7#21; |PINTA #0#18;
          #0#36 = #7#22;
          #0#211 = #7#23; |PINTA #0#211;
          #0#197 = #7#24; |PINTA #0#197;
          |HAZ EsPCEGroup;    || se graba la dir. factura
          |SI FSalida = 0;
               #0#8 = #7#2; |PINTA #0#8;
               #0#9 = #7#3; |PINTA #0#9;
               #0#181 = #7#4; |PINTA #0#181;
               #0#182 = #7#5; |PINTA #0#182;
               #0#183 = #7#6; |PINTA #0#183;
               #0#10 = #7#7; |PINTA #0#10;
          |SINO;              || la estandar
               #0#5 = #7#2;   |PINTA #0#5;
               #0#6 = #7#3;   |PINTA #0#6;
               #0#178 = #7#4; |PINTA #0#178;
               #0#179 = #7#5; |PINTA #0#179;
               #0#180 = #7#6;
               #0#7 = #7#7;   |PINTA #0#7;
          |FINSI;
          |CIERRA #7;
          |GRABA 020#0a;
          |LIBERA #0;
     |FINSI;
|FPRC;

|PROCESO punto; |TIPO 6;
     |MODULO aProg;
     |SI aProg ! "agifa024"; |ACABA; |FINSI;

     salida = FSalida;
     modo = (FEntrada / 100) ! 0;
     |SI salida = 16;   ||F8
          orden = #0#0;
          pasa = "C";
          |SUB_EJECUTA_NP "agi00009.tab";
          orden = "";
          |ERROR;
     |FINSI;
     |SI salida = 13;   ||F5
          |PUSHV 0501 2380;
          ext1 = #0#16;
          |SUB_EJECUTA_NP "caextrap.run";
          |POPV;
          |ERROR;
     |FINSI;
     |SI salida = 10;
          |HAZ DirEntre;
          |ERROR;
     |FINSI;
     |HAZ LeeDecimBase;

     |C_M #agifa024#1,   1, "S";
     |C_M #agifa024#205, 1, "S";
     |C_M #agifa024#178, 1, "S";
     |C_M #agifa024#15,  1, "S";
     |C_M #agifa024#16,  1, "S";

     |HAZ CargaContagen;
     |SI enOk = 0;  |ACABA;  |FINSI;

     |C_M #agifa024#16, 1, "N";

     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 1;
         |HAZ cuenta;

         eaCtaCble = #agifa024#16;
         eaTipo    = "C";
         |HAZ RecogeCliProvCOD;
         |SI enOk = 0;
             |SI nPas = 0;
                 |POSICIONATE #agifa024#15;
             |FINSI;
         |SINO;
             |C_M #agifa024#1,   1, "N";
             |C_M #agifa024#205, 1, "N";
             |C_M #agifa024#178, 1, "N";
             |C_M #agifa024#15,  1, "N";
         |FINSI;
     |SINO;
         |C_M #agifa024#1,   1, "N";
         |C_M #agifa024#205, 1, "N";
         |C_M #agifa024#178, 1, "N";
         |C_M #agifa024#15,  1, "N";
     |FINSI;
|FPRC;

|PROCESO cuenta; |TIPO 0;
     modo = (FEntrada / 100) ! 0;
     |SI modo = 1;
          eaDocu = "agifa024";
          |HAZ ControlUsu;
          |SI enSwCtrlUsu ! 0;
               |ERROR; |ACABA;
          |FINSI;
     |FINSI;
     |SI modo = 1;
          cod = #0#0;
          |SI cod ! 0;
               cuen = "000000000000" + cod;
               |QBT cuen;
               quitar = -(100 + (#1#11 - 2));
               cuen = cuen % quitar;
               cuen = "43" + cuen;

               |HAZ EsVipei;
               |SI FSalida = 0;
                    |DBASE aAux;
                    |QBF aAux;
                    aAux = aAux + "def/vipem008";
                    |CARGA_DEF aAux, auxilia@;
                    |SI FSalida ! 0;  |ACABA;  |FINSI;

                    |ABRE #auxilia@;
                    |DDEFECTO #auxilia@;
                    |LEE 000#auxilia@.p;

                    |SI #auxilia@#12 = "S";
                         nPosicion = #auxilia@#14;

                         aAux = "";
                         aLong = cuen % A0;
                         nLong = aLong;
                         |SI nLong ] nPosicion;
                              |PARA nConta = 1; |SI nConta [ nLong; |HACIENDO nConta = nConta + 1;
                                   nSaca = 100 * nConta;
                                   nSaca = nSaca + 1;
                                   aSaca = nSaca;
                                   aLetra = cuen % aSaca;
                                   |SI nConta = nPosicion;
                                        aAux = aAux + #auxilia@#13;
                                   |SINO;
                                        aAux = aAux + aLetra;
                                   |FINSI;
                              |SIGUE;
                              cuen = aAux;
                         |SINO;
                              ||Nada. Se pasaria de la longuitud.
                              cuen = cuen + #auxilia@#13;
                         |FINSI;
                    |FINSI;
                    |CIERRA #auxilia@;
                    |DESCARGA_DEF #auxilia@;
               |FINSI;

               #0#16 = cuen;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO T66C16F24; |TIPO 66;
     eaTipo    = "C";
     eaCtaCble = #agifa024#16;
     |HAZ SacaCliProv;
     #agifa024#16 = eaCtaCble;
     |PINTA #agifa024#16;
|FPRC;

|PROCESO T7C16F24; |TIPO 7;
     |HAZ MensaCTA;
|FPRC;

|PROCESO MCta24; |TIPO 0;
     |BLIN 04;

     eaCta = #0Campo;
     |HAZ MFiltraPtos;
     #0Campo = eaCta; |PINTA #0Campo;

     |HAZ MCtaContable;
     |SI eswCta = 1;
         |MENAV "    Error. Longitud de Cuenta fuera de Nivel";
         |ERROR;
         |ACABA;
     |FINSI;

     |SI Contenido ! #agifa024#16;
         nModo = (FEntrada / 100) ! 0;
         |SI nModo = 1;
             eaTipo    = "C";
             eaVarDni  = #agifa024#15;
             eaCtaCble = #agifa024#16;
             |HAZ BuscaCliProv;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO lee_tecla;
     |SI FSalida = 13;   ||F5
          |PUSHV 0501 2380;
          ext1 = #0#16;
          |SUB_EJECUTA_NP "caextrap.run";
          |POPV;
     |FINSI;
|FPRC;

|PROCESO LeeDecimBase; |TIPO 13;
     |HAZ QuitaBotonTra;

     |ABRE #agifa321;
     |ABRE #agifa324;
     |LEE 001#agifa321.p;
     #agifa324#0 = #agifa321#9; ||Igualo a moneda base
     |LEE 001#agifa324.=;
     nDeci_Base = #agifa324#7;  ||Decimales moneda base
     nDeci_PreBase = #agifa324#9;  ||Decimales precio de moneda base
     |CIERRA #agifa321;
     |CIERRA #agifa324;

     |HAZ EsTagloma;
     |SI FSalida = 0;
          |HAZ PinTagloma;
     |FINSI;

     |MODULO aAlfa;
     |SI aAlfa = "dszx0001"; || Del modulo 003308 de PceGroup
          |CONTROL_SIMPLE 0, "BOTON, Opciones", 0558, 0568, BtnOpciones;
          nBtnOpciones = FSalida;
     |FINSI;
|FPRC;

|RUTINA InfDir;
     #7#0 = #0#0;
     #7#1 = 1;
|FRUT;

|RUTINA SupDir;
     #7#0 = #0#0;
     #7#1 = 9999;
|FRUT;

|RUTINA Graba1Dir;
     |HAZ EsMalpesa;
     |SI FSalida = 0; |ACABA; |FINSI;
     ||*********************En Malpesa no se graba la dir1****************
     |ABRE #101;
     #101#0 = #0#3;
     |LEE 000#101=; || Zona
     |CIERRA #101;
     |ABRE #102;
     #102#0 = #0#189;
     |LEE 000#102=; ||Ruta
     |CIERRA #102;
     |ABRE #25;
     #25#0 = #0#25;
     |LEE 000#25=;
     |CIERRA #25;

     |ABRE #7;
     |DDEFECTO #7;
     #7#0 = #0#0;
     #7#1 = 1;
     |LEE 101#7=;
     |SI FSalida ! 0; |GRABA 021#7b; |FINSI;
     #7#2 = #0#5;
     #7#3 = #0#6;
     #7#4 = #0#178;
     #7#5 = #0#179;
     #7#6 = #0#180;
     #7#7 = #0#7;
     #7#8 = #0#14;
     #7#10 = #0#2;
     #7#11 = #0#3;
     #7#12 = #101#1;
     #7#13 = #0#17;
     #7#14 = #0#25;
     #7#15 = #25#1;
     #7#16 = #0#189;
     #7#17 = #102#1;
     #7#19 = #0#205;
     #7#20 = #0#196;
     #7#21 = #0#18;
     #7#22 = #0#36;
     #7#23 = #0#211;
     #7#24 = #0#197;
     |HAZ EsPCEGroup;    || se graba la dir. factura
     |SI FSalida = 0;
          #7#2 = #0#8;
          #7#3 = #0#9;
          #7#4 = #0#181;
          #7#5 = #0#182;
          #7#6 = #0#183;
          #7#7 = #0#10;
     |FINSI;
     |GRABA 021#7a;
     |CIERRA #7;
|FRUT;

|| *****llamada de dsm00003******

|PROCESO xLimita; |TIPO 0;          || INHIBIDO!!!
     |SI Campo = 30;     nLongi = 10;   |FINSI;
     |SI Campo = 31;     nLongi =  2;   |FINSI;
     |SI Campo = 32;     nLongi =  4;   |FINSI;
     |SI Campo = 33;     nLongi =  4;   |FINSI;
     aAlfa1 = #0Campo;
     |QBF aAlfa1;
     aAlfa2 = aAlfa1 % 0;
     nNume1 = aAlfa2;
     |SI nNume1 ! 0;
          |SI nNume1 > nLongi;
               aAlfa2 = "    Longitud de campo fuera de orden, maximo [" + nLongi + "] ...";
               |MENAV aAlfa2;
          |SINO;
               aAlfa2 = "0" * nLongi;
               nNume1 = (nLongi + 100) * -1;
               aAlfa1 = (aAlfa2 + aAlfa1) % nNume1;
               #0Campo = aAlfa1;
               |PINTA #0Campo;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO impclien;
     |LIBERA #0;
     eaCodigoNum = #0#0;
     |SUB_EJECUTA_NP "agifm006;imprime_cli";
     |LEE 121#0=;
|FPRC;

|PROCESO Desglose;
     |PUSHV 0501 2380;
     |PINPA #0#0;
     |PINDA #0#0;
     |BLANCO 0936 1768;
     |ATRI R;  |PINTA 0936, "            DESGLOSE             ";  |ATRI r;
               |PINTA 1036, "Unidades/Euros/Ambos .....:      ";
               |PINTA 1136, "Serie ....................:      ";
               |PINTA 1236, "Forma de Pago ............:      ";
               |PINTA 1336, "Descuento Especial .......:      ";

               |C_M #0#198, 1, "S";  |C_V #0#198, 1, "S";  |C_P #0#198, 1, 1064;
               |C_M #0#199, 1, "S";  |C_V #0#199, 1, "S";  |C_P #0#199, 1, 1164;
               |C_M #0#200, 1, "S";  |C_V #0#200, 1, "S";  |C_P #0#200, 1, 1264;
               |C_M #0#201, 1, "S";  |C_V #0#201, 1, "S";  |C_P #0#201, 1, 1364;

               |PINTA #0#198;
               |PINTA #0#199;
               |PINTA #0#200;
               |PINTA #0#201;

               |ET Campo198;
                   |ENCAMPO #198#0;
                   |SI FSalida = 2;  |VETE Campo198;  |FINSI;

               |ET Campo199;
                   |ENCAMPO #199#0;
                   |SI FSalida = 2;  |VETE Campo198;  |FINSI;

               |ET Campo200
                   |ENCAMPO #200#0;
                   |SI FSalida = 2;  |VETE Campo199;  |FINSI;

                   |ENCAMPO #201#0;
                   |SI FSalida = 2;  |VETE Campo200;  |FINSI;

     |POPV;

     |C_M #0#198, 1, "N";  |C_V #0#198, 1, "N";
     |C_M #0#199, 1, "N";  |C_V #0#199, 1, "N";
     |C_M #0#200, 1, "N";  |C_V #0#200, 1, "N";
     |C_M #0#201, 1, "N";  |C_V #0#201, 1, "N";

     |GRABA 020#0a;
|FPRC;

|RUTINA inf45;
     #45#0 = #0#0;
     #45#1 = 1;
|FRUT;

|RUTINA sup45;
     #45#0 = #0#0;
     #45#1 = 99;
|FRUT;

|PROCESO FPago;
     |PUSHV 0501 2380;
     |ENTLINEAL #1#45, -2, 1, 22, 1, inf45, sup45;
     |POPV;
|FPRC;

|PROCESO Tipo20;  |TIPO 20;
     nModo = (FEntrada / 100) ! 0;
     aAlfa1 = FSalida;

     |SI aAlfa1 = "OPCION";
          |SI nSwArchiActivo = 1;
               |ESTADO_CONTROL nBotonAAPP, "DISABLE";
          |FINSI;
          FSalida = "Opciones";
          |ACABA;
     |FINSI;

     |LEE 101#0=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     eaCodigo = #0#0;

     aUtil4  = "IOgPDTC";     || Estandar

     |HAZ EsDiagram;
     |SI FSalida = 0; aUtil4  = "IOgPDTCRL"; |FINSI;

     |MENU aUtil;
     aUtil2 = FSalida;
     |SI aUtil2 = "1";  |HAZ impclien;  |FINSI;
     |SI aUtil2 = "2";
          |SI nModo = 1; |O nModo = 2;
               |GRABA 020#0a;
          |FINSI;
          |LIBERA #0; |CIERRAT #0;
          |SUB_EJECUTA_NP "dsz99994;MANTE";
          |ABRET #0;
          |SI nModo = 4;
               |LEE 000#0=;
          |SINO;
               |LEE 101#0=;
          |FINSI;
     |FINSI;
     |SI aUtil2 = "3";  |HAZ Desglose;  |FINSI;
     |SI aUtil2 = "4";  |HAZ FPago;  |FINSI;
     |SI aUtil2 = "5"; modo = 2; |HAZ DirEntre; |FINSI;
     |SI aUtil2 = "6"; FSalida = 10; |HAZ TramosMenu; |FINSI;
     |SI aUtil2 = "7";
          eaCodigoNum = #0#0;
          |PUSHV 0501 2380;
          |SUB_EJECUTA_NP "agifm006";
          |POPV;
     |FINSI;

     |LIBERA #0;

     |SI aUtil2 = "8";
          eaCliente = #0#0;
          |SUB_EJECUTA_NP "dsz00133";   || diagram
     |FINSI;

     |SI aUtil2 = "9";
          eaCliente = #0#0;
          |SUB_EJECUTA_NP "dsz00135";
     |FINSI;
|FPRC;

|PROCESO Mayus24;
     #0Campo = #0Campo > #0Campo;
     |PINTA #0Campo;
|FPRC;

|PROCESO Pago;
     |SI #0#200 = "  ";  #0#200 = #0Campo;  |FINSI;
|FPRC;

|PROCESO FormaN;  |TIPO 66;
     |PUSHV 0501 2380;
     |ABRE #91;
     #91#0 = #0#200;
     |LEE 040#91=;
     |SI FSalida ! 0;  |DDEFECTO #91;  |FINSI;
     |PINPA #0#91;
     |PINDA #0#91;
     |CONSULTA #0#91;
     |CIERRA #91;
     |POPV;

     #0#200 = #91#0;
     |PINTA #0#200;
     |PAUSA;
|FPRC;

|PROCESO ser; |TIPO 0;              || VIC 20/07/98
     cli=#0#0;
     ser=#0#199;
     |SUB_EJECUTA_NP "agifv011.tab;por_ejemplo"
|FPRC;
ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
|PROCESO Digito2;
     eaEntidad = #0#32; |QBF eaEntidad; eaEntidad = eaEntidad % 104;
     eaSucursal = #0#33; |QBF eaSucursal; eaSucursal = eaSucursal % 104;
     eaCuenta = #0#30; |QBF eaCuenta; eaCuenta = eaCuenta % 110;
     eaDC = "";
     |HAZ CalculoDC;
     #0#31 = eaDC;
     |PINTA #0#31;
|FPRC;

|PROCESO BotonAnalisis;
     eaCliente = #0#0;
     |SUB_EJECUTA_NP "legiz009";
|FPRC;

|PROCESO BotonPCEG;
     eaCliente = #0#0;
     |SUB_EJECUTA_NP "pcegz005";
|FPRC

|PROCESO BtnAAPP;
     |PUSHV 0501 2380;
     |GRABA 020#0a;
     |LIBERA #0;
     |CIERRAT #0;

     eaCliente = #0#0;
     |SUB_EJECUTA_NP "agifa281";

     |ABRET #0;
     #0#0 = eaCliente;
     |LEE 121#0=;

     |POPV;
|FPRC;

|PROCESO i; |TIPO 8;
     eaMensaCad = "9";
     |HAZ ControlCaducidad;
     |SI enErrorCad = 1;
         |PTEC 807;
         |ACABA;
     |FINSI;

     |ABRE #279; |LEE 000#279p; |CIERRA #279;

     nSwHayBotonArriba = 0;

     |CONTROL_SIMPLE 0, "BOTON, F2.-Tramos", 1724, 1733, BotonTramo;
     nBtnTramo = FSalida;
     |CONTROL_SIMPLE 0, "BOTON, F3.-F.Pago", 1650, 1659, BotonFPag;
     nBtnFPago = FSalida;

     |CONTROL_SIMPLE 0, "BOTON, Tramos", 1724, 1733, BotonTramo1;
     nBtnTramo1 = FSalida;
     |CONTROL_SIMPLE 0, "BOTON, F.Pago", 1650, 1659, BotonFPag1;
     nBtnFPago1 = FSalida;


     |HAZ EsPCEGroup;
     |SI FSalida = 0;
          |CONTROL_SIMPLE 0, "BOTON, Ver Datos", 0570, 0579, BotonPCEG;
          nBotonPCEG = FSalida;
          nSwHayBotonArriba = 1;
     |FINSI;

     |HAZ EsLegiplag;
     |SI FSalida = 0;
          |CONTROL_SIMPLE 0, "BOTON, Analisis", 0570, 0579, BotonAnalisis;
          nBotonAnalisis = FSalida;
          |ESTADO_CONTROL nBotonAnalisis, "DISABLE";
          nSwHayBotonArriba = 1;
     |FINSI;

     |HAZ EsVigor;
     |SI FSalida = 0;
          |CONTROL_SIMPLE 0, "BOTON, Condiciones Venta", 0570, 0679, BotonVigor;
          nBotonVigor = FSalida;
          nSwHayBotonArriba = 1;
     |FINSI;

     |HAZ EsEvaristo;
     nSwEvaristo = FSalida;
     |SI FSalida = 0;
          |CONTROL_SIMPLE 0, "BOTON,F3.- Datos generales", 2308, 2323, EvaF3;
          nBotonEva1 = FSalida;
          |CONTROL_SIMPLE 0, "BOTON,F4.- Articulos pendientes", 2325, 2340, EvaF4;
          nBotonEva2 = FSalida;
          |CONTROL_SIMPLE 0, "BOTON,F6.- Articulos servidos", 2342, 2357, EvaF6;
          nBotonEva3 = FSalida;
          |CONTROL_SIMPLE 0, "BOTON,F7.- Abonos", 2359, 2374, EvaF7;
          nBotonEva4 = FSalida;
     |FINSI;

     |HAZ EsCamiCor;
     |SI FSalida = 0;
          |CONTROL_SIMPLE 0, "BOTON, Auxiliar", 0570, 0679, BtnAux;
          nBtnAux = FSalida;
          nSwHayBotonArriba = 1;
     |FINSI;

     |HAZ EsTagloma;
     |SI FSalida = 0;
          |CONTROL_SIMPLE 0, "BOTON, ItemDoc", 0570, 0580, BtnItemDocCli;
          nBtnItemDocCli = FSalida;
          nSwHayBotonArriba = 1;
     |FINSI;

    ||Modulo Para Marhuenda......................
     aParametro = PARAMETRO;
     |QBF aParametro;
     |SI aParametro = "";
          |DBASE aAlfa;
          aAlfa = aAlfa + "/def/marhup07.mas";
          |XABRE "E", aAlfa, 0;
          |SI FSalida = 0;
               |DBASE aAlfa;
               aAlfa = aAlfa + "/def/marhup07.mas";
               |CARGA_DEF aAlfa, marhup07@;
               |SI FSalida = 0;
                    swCar1 = 1;
               |FINSI;
               |DBASE aAlfa;
               aAlfa = aAlfa + "/def/marhup09.mas";
               |CARGA_DEF aAlfa, marhup09@;
               |SI FSalida = 0;
                    swCar2 = 1;
               |FINSI;
          |FINSI;
     |SINO;
          |CLS;
          |ABRE #0;
          |DDEFECTO #0;
          #0#0 = aParametro;
          |LEE 101#0=;
          nExiste = FSalida;
          |SI nExiste ! 0;
               |GRABA 020#0b;
          |FINSI;
          |PINPA #0#0;
          |PINDA #0#0;
          |ENDATOS #1#0;
          |SI FSalida = 0;
               |GRABA 020#0a;
          |SINO;
               |BORRA 020#0a;
          |FINSI;
          |LIBERA #0;
          |CIERRA #0;
          |PTEC 806;
     |FINSI;

     nSwArchiActivo = 0;
     |HAZ EsArchi;
     |SI FSalida = 0;
          |DBASS aAlfa; |QBF aAlfa;
          aAlfa = aAlfa + "dsarchi/def/dsarm001.mas";
          |CARGA_DEF aAlfa, Ref0001@;
          |SI FSalida = 0;
               |DBASS aAlfa; |QBF aAlfa;
               aAlfa = aAlfa + "dsarchi/fich/"; |PATH_DAT #Ref0001@#aAlfa#;
               |ABRE #Ref0001@;
               |DDEFECTO #Ref0001@;
               |LEE 000#Ref0001@.p;
               |SI FSalida ! 0; |DDEFECTO #Ref0001@; |FINSI;


               |SI #Ref0001@#31 = "S";
                    nSwArchiActivo = 1;

                    ||Miro si esta el parametro  'WEBSERVICEFACE' en dsarchi.ini
                    nGuarda = enAprobacion;
                    enAprobacion = 0;
                    eaPrograma = "WEBSERVICEFACE";
                    |HAZ DSARCHI_INI;
                    enSwWebServiceFace = enAprobacion;
                    enAprobacion = nGuarda;
               |FINSI;
               |CIERRA #Ref0001@;
               |DESCARGA_DEF #Ref0001@;
          |FINSI;

          |SI nSwArchiActivo = 1;
               |SI nSwHayBotonArriba = 0;
                    |CONTROL_SIMPLE 0, "BOTON,AA.PP. FacE", 0570, 0580, BtnAAPP;
               |SINO;
                    |CONTROL_SIMPLE 0, "BOTON,AA.PP. FacE", 0770, 0780, BtnAAPP;
               |FINSI;
               nBotonAAPP = FSalida;
               |ESTADO_CONTROL nBotonAAPP, "DISABLE";
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO f; |TIPO 9;
     |SI swCar2 = 1; |DESCARGA_DEF #marhup09@; |FINSI;
     |SI swCar1 = 1; |DESCARGA_DEF #marhup07@; |FINSI;

     |FIN_CONTROL_WINDOWS nBtnTramo;
     |FIN_CONTROL_WINDOWS nBtnFPago;
     |FIN_CONTROL_WINDOWS nBtnTramo1;
     |FIN_CONTROL_WINDOWS nBtnFPago1;
     |SI nBotonAnalisis ! -1; |FIN_CONTROL_WINDOWS nBotonAnalisis; |FINSI;
     |SI nBotonPCEG ! -1; |FIN_CONTROL_WINDOWS nBotonPCEG; |FINSI;
     |SI nBotonVigor ! -1; |FIN_CONTROL_WINDOWS nBotonVigor; |FINSI;
     |SI nSwEvaristo = 0;
          |FIN_CONTROL_WINDOWS nBotonEva1;
          |FIN_CONTROL_WINDOWS nBotonEva2;
          |FIN_CONTROL_WINDOWS nBotonEva3;
          |FIN_CONTROL_WINDOWS nBotonEva4;
     |FINSI;
     |SI nBtnAux ! -1; |FIN_CONTROL_WINDOWS nBtnAux; |FINSI;
     |SI nSwArchiActivo = 1; |FIN_CONTROL_WINDOWS nBotonAAPP; |FINSI;

     |SI nBtnItemDocCli ! -1; |FIN_CONTROL_WINDOWS nBtnItemDocCli; |FINSI;


     |PULSATECLA;
|FPRC;

|PROCESO Dupli;
     |SI #1#160 = "N"; |ACABA; |FINSI;

     alfa = #0#15; |QBF alfa;
     |SI alfa = ""; |ACABA; |FINSI;
     |DDEF aDef;
     aDef = aDef + "agifa024";
     |CARGA_DEF aDef, agifa024@;
     |SI FSalida = 0;
          |ABRE #agifa024@;
          |SELECT #4#agifa024@;
          #agifa024@#15 = #0#15;
          |LEE 000#agifa024@.];
          |PARA; |SI FSalida = 0; |Y #agifa024@#15 = #0#15; |HACIENDO;
               |SI #agifa024@#0 ! #0#0;
                    |SI #1#160 = "X";
                        alfa = "0000El DNI existe. Codigo: "+ #agifa024@#0+&13+&13;
                        alfa = alfa + " Modifiquelo";
                        |MENAV alfa;
                        |ERROR;
                        |SAL;
                    |FINSI;

                    |SI #1#160 ! "X";
                        |AVISO;
                        alfa = "S0000El DNI existe. Codigo: "+ #agifa024@#0+&13+&13;
                        alfa = alfa + " Continuar buscando duplicados:"
                        |CONFI alfa;
                        |SI FSalida ! 0; |SAL; |FINSI;
                    |FINSI;
               |FINSI;
               |LEE 000#agifa024@.s;
          |SIGUE;
          |DESCARGA_DEF #agifa024@;
     |FINSI;
|FPRC;

|PROCESO Recagifa010;
     nReg = nReg + 1;
     #10nCamAlb = #0nCamCli;
     |GRABA 020#10a;
     |LIBERA #10;
     |SI enSwRecalAlb = 1;
          aAlfa = "dsz99953;" + #10#43 + #10#52 + #10#0;
          |SUB_EJECUTA_NP aAlfa;
     |FINSI;
|FPRC;

|DEFBUCLE Recagifa010;
     #10#3;
     38;
     #0#0, "01.01.0000", "     ", 000001, "N";
     #0#0, "31.12.9999", "zzzzz", 999999, "N";
     be;
     NULL, Recagifa010;
|FIN;

|PROCESO ModiRec; |TIPO 0;
     |SI #0Campo ! Contenido;
          nModiRec = 1;
     |FINSI;
|FPRC;

|PROCESO ModiRete; |TIPO 0;
     |SI #0Campo ! Contenido;
          nModiRete = 1;
     |FINSI;
|FPRC;

|PROCESO BuscaEmpresa;
   aAlfa = aDir + "visalud/fich/" + (("00" + #visalm00@#0) % -102) + "/";
   |PATH_DAT #2002 aAlfa;
   |ABRE #visalm36@;
   |LEE 000#visalm36@.p;
   |SI FSalida = 0; |Y #visalm36@#18 = nEmpre;
      nEmpre = #visalm00@#0; |ERROR10;
   |FINSI;
   |CIERRA #visalm36@;
|FPRC;

|DEFBUCLE BuscaEmpresa;
#visalm00@#1001;
;
00;
99;
;
NULL,BuscaEmpresa;
|FIN;

|PROCESO agifa024_3; |TIPO 30;
     nPas = 0;

     |ABRE #1; |LEE 000#1p; |CIERRA #1;

     |HAZ EsDiagram;
     |SI FSalida = 0; |Y nSwCambiaDir = 1;
          |CONFI "0000NLa dirección entrega a cambiado, ¿cambiar dirección en las facturas?";
          |SI FSalida = 0;
               eaCodCliente = #0#0;
               |SUB_EJECUTA_NP "diaz0020";
          |FINSI;
          nSwCambiaDir = 0;
     |FINSI;

     |SI #1#208 = "S";
         |HAZ CargaContagen;
         |SI enOk = 0;
             aAlfa = "dsz00097;C" + #0#0;   || Alta contabilidad y basica
             |SUB_EJECUTA_NP aAlfa;
         |FINSI;
     |SINO;
          |SI nCambioAlgo ! 0;
               nCambioAlgo = 0;
               eaClPr = "C"; eaCodigoNum = #0#0;
               |SUB_EJECUTA_NP "agifa141";
          |FINSI;
     |FINSI;

     |SI nModiRec = 1;
          nCamCli = 47;
          nCamAlb = 36;
          |CONFI "0000NModificar RECARGO de albaranes no facturados";
          |SI FSalida = 0;
               nReg = 0;
               enSwRecalAlb = 1;
               |BUCLE Recagifa010;
               enSwRecalAlb = 0;
               aAlfa = "0000Modificados [" + nReg + "] registros.";
               |MENAV aAlfa;
          |SINO;
               |MENAV "0000No se efectuaran cambios de RECARGO en los albaranes pendientes";
          |FINSI;
          nModiRec = 0;
     |FINSI;
     |SI nModiRete = 1;
          nCamCli = 206;
          nCamAlb = 91;
          |CONFI "0000NModificar RETENCION de albaranes no facturados";
          |SI FSalida = 0;
               nReg = 0;
               |BUCLE Recagifa010;
               aAlfa = "0000Modificados [" + nReg + "] registros.";
               |MENAV aAlfa;
          |SINO;
               |MENAV "0000No se efectuaran cambios de RETENCION en los albaranes pendientes";
          |FINSI;
          nModiRete = 0;
     |FINSI;
     |HAZ Graba1Dir;

     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 1; |O nModo = 2;
        |HAZ EsOTP;
        |SI FSalida = 0;
           |DBASS aDir; |QBF aDir;
           aAlfa = aDir + "visalud/def/visal100.mas";
           |CARGA_DEF aAlfa, visal100@;
           |SI FSalida = 0;
              aAlfa = aDir + "visalud/def/visalm01.mas"; |CARGA_DEF aAlfa, visalm01@;
              aAlfa = aDir + "visalud/def/visalm36.mas"; |CARGA_DEF aAlfa, visalm36@;
              aAlfa = aDir + "visalud/def/visalm00.mas"; |CARGA_DEF aAlfa, visalm00@;

              aAlfa = aDir + "visalud/fich/"; |PATH_DAT #2003 aAlfa;
              nEmpre = #48#0; |BUCLE BuscaEmpresa;

              aAlfa = aDir + "visalud/fich/" + (("00" + nEmpre) % -102) + "/";
              |PATH_DAT #2000 aAlfa; |PATH_DAT #2001 aAlfa; |PATH_DAT #2002 aAlfa;
              |ABRE #visal100@; |ABRE #visalm01@; |ABRE #visalm36@;

              #visal100@#0 = #agifa024#0;
              |LEE 101#visal100@.=;
              |SI FSalida ! 0;
                 |DDEFECTO #visal100@;
                 #visal100@#0 = #agifa024#0;
                 |GRABA 020#visal100@.b;
              |FINSI;
              #visal100@#1 = #agifa024#1;
              #visal100@#2 = #agifa024#2;
              #visal100@#3 = #agifa024#15;
              #visal100@#4 = #agifa024#3;
              |GRABA 020#visal100@.a; |LIBERA #visal100@;

              #visalm01@#0 = #agifa024#0;
              |LEE 000#visalm01@.=;
              |SI FSalida ! 0;
                 |DDEFECTO #visalm01@;
                 #visalm01@#0  = #agifa024#0;
                 |GRABA 020#visalm01@.b;
              |FINSI;
              #visalm01@#13 = #agifa024#17;
              #visalm01@#14 = #agifa024#18;
              #visalm01@#87 = #agifa024#197;
              |GRABA 020#visalm01@.a; |LIBERA #visalm01@;

              |CIERRA #visalm36@; |DESCARGA_DEF #visalm36@;
              |CIERRA #visalm01@; |DESCARGA_DEF #visalm01@;
              |CIERRA #visal100@; |DESCARGA_DEF #visal100@;
           |FINSI;
        |FINSI;
     |FINSI;

     |HAZ EsTecatel;
     |SI FSalida = 0;    || Para crear el cliente el cartera
          eaTag = "";
          |HAZ Riesgos;
     |FINSI;

     aAlfa = #0#36; |QBF aAlfa;
     |SI nModo = 1; |Y aAlfa ! "";
          |HAZ EsPCEGroup;
          |SI FSalida = 0;
               |DDEF aAlfa;
               aAlfa = aAlfa + "agifm006";
               |CARGA_DEF aAlfa, referen@;
               |SI FSalida ! 0;
                    |MENAV "0000Error al cargar 'agifm006'";
               |SINO;
                    |DDEFECTO #referen@;
                    |ABRE #referen@;
                    #referen@#0 = #0#0;
                    #referen@#1 = 1;
                    |LEE 101#referen@.=;
                    |SI FSalida ! 0; |GRABA 020#referen@.b; |FINSI;
                    #referen@#3 = #0#36;
                    #referen@#4 = #0#17;
                    #referen@#5 = #0#196;
                    #referen@#6 = #0#197;
                    #referen@#8 = #0#18;
                    |GRABA 020#referen@.a;
                    |CIERRA #referen@;
                    |DESCARGA_DEF #referen@;
               |FINSI;
          |FINSI;
     |FINSI;

     |HAZ EsInforAlba;
     |SI FSalida = 0;
          |HAZ InfAlbModCli;
     |FINSI;

     |HAZ CargaContagen;
     |SI enOk = 0;  |ACABA;  |FINSI;

     eaCtaCble = #agifa024#16;
     eaTipo    = "C";
     |HAZ CreaCliProv;
|FPRC;

|PROCESO CodigoSucu; |TIPO 0;
     |SI FSalida = 2; |ACABA; |FINSI;

     nError = 0;
     |DBASS aAlfa; |QBF aAlfa; aAlfa = aAlfa + "dscarter/def/dscam045.mas";
     |CARGA_DEF aAlfa, dscam045@;
     |SI FSalida = 0;
        |C_M #agifa024#29,1,"N"; |C_M #agifa024#162,1,"N"; |C_M #agifa024#34,1,"N";
        |DBASS aAlfa; |QBF aAlfa; aAlfa = aAlfa + "dscarter/def/dscam002.mas";
        |CARGA_DEF aAlfa, dscam002@;

        |DBASS aAlfa; |QBF aAlfa; aAlfa = aAlfa + "dscarter/fich/";
        |PATH_DAT #1000 aAlfa; |ABRE #dscam045@;
        #dscam045@#0 = #48#0;
        #dscam045@#1 = 0;
        |LEE 000#dscam045@.];
        |SI FSalida = 0; |Y #dscam045@#0 = #48#0;
           |DBASS aAlfa; |QBF aAlfa; aAlfa = aAlfa + "dscarter/pan/";
           |PATH_PAN #1002 aAlfa;
           |DBASS aAlfa; |QBF aAlfa; aAlfa = aAlfa + "dscarter/fich/" + (("00000" + #dscam045@#6) % -105) + "/";
           |PATH_DAT #1002 aAlfa; |ABRE #dscam002@;
           #dscam002@#0 = #agifa024#32;
           #dscam002@#1 = #agifa024#33;
           |LEE 000#dscam002@.=;
           |SI FSalida = 0;
              #agifa024#29  = #dscam002@#2; |PINTA #agifa024#29;
              #agifa024#162 = #dscam002@#6; |PINTA #agifa024#162;
              #agifa024#34  = #dscam002@#3; |PINTA #agifa024#34;
           |SINO;
              aAlfa = ("00000" + #dscam045@#6) % -105;
              aAlfa = aAlfa + "," + #agifa024#32 + "/" + #agifa024#33;
              aAlfa = ":" + "dscarter/dscaz089.tab;" + aAlfa;
              |SUB_EJECUTA aAlfa;
              #dscam002@#0 = #agifa024#32;
              #dscam002@#1 = #agifa024#33;
              |LEE 000#dscam002@.=;
              |SI FSalida ! 0;
                 |MENAV "    Sucursal inexistente"; |ERROR;
                 nError = 1;
              |SINO;
                 #agifa024#29  = #dscam002@#2; |PINTA #agifa024#29;
                 #agifa024#162 = #dscam002@#6; |PINTA #agifa024#162;
                 #agifa024#34  = #dscam002@#3; |PINTA #agifa024#34;
              |FINSI;
           |FINSI;
           |CIERRA #dscam002@; |DESCARGA_DEF #dscam002@;
           |CIERRA #dscam045@; |DESCARGA_DEF #dscam045@;
        |FINSI;
     |SINO;
        |C_M #agifa024#29,1,"S"; |C_M #agifa024#162,1,"S"; |C_M #agifa024#34,1,"S";
     |FINSI;
     |SI nError = 0; |Y #0Campo ! Contenido;
          |HAZ Digito2;
          |HAZ CalculaIBAN;
     |FINSI;
/*
     |HAZ EsMalpesa;
     |SI FSalida = 0;
          |HAZ MalpeCliCta0;
     |FINSI;
*/
|FPRC;

|PROCESO Cuenta; |TIPO 0;
     |SI #Campo ! Contenido;
          |HAZ Digito2;
          |HAZ CalculaIBAN;
     |FINSI;
|FPRC;

|PROCESO CodigoBanco;
     |SI FSalida = 2; |ACABA; |FINSI;
     nError = 0;
     |DBASS aAlfa; |QBF aAlfa; aAlfa = aAlfa + "dscarter/def/dscam045.mas";
     |CARGA_DEF aAlfa, dscam045@;
     |SI FSalida = 0;
        |DBASS aAlfa; |QBF aAlfa; aAlfa = aAlfa + "dscarter/def/dscam001.mas";
        |CARGA_DEF aAlfa, dscam001@;

        |DBASS aAlfa; |QBF aAlfa; aAlfa = aAlfa + "dscarter/fich/";
        |PATH_DAT #1000 aAlfa; |ABRE #dscam045@;
        #dscam045@#0 = #48#0;
        #dscam045@#1 = 0;
        |LEE 000#dscam045@.];
        |SI FSalida = 0; |Y #dscam045@#0 = #48#0;
           |DBASS aAlfa; |QBF aAlfa; aAlfa = aAlfa + "dscarter/fich/" + (("00000" + #dscam045@#6) % -105) + "/";
           |PATH_DAT #1001 aAlfa; |ABRE #dscam001@;
           #dscam001@#0 = #agifa024#32;
           |LEE 000#dscam001@.=;
           |SI FSalida = 0;
              #agifa024#29  = #dscam001@#1; |PINTA #agifa024#29;
              #agifa024#216 = #dscam001@#3; |PINTA #agifa024#216;
           |SINO;
              aAlfa = ("00000" + #dscam045@#6) % -105;
              aAlfa = aAlfa + "," + #agifa024#32;
              aAlfa = ":" + "dscarter/dscaz089.tab;" + aAlfa;
              |SUB_EJECUTA_NP aAlfa;
              #dscam001@#0 = #agifa024#32;
              |LEE 000#dscam001@.=;
              |SI FSalida ! 0;
                 |MENAV "    Entidad inexistente"; |ERROR;
                 nError = 1;
              |SINO;
                 #agifa024#29  = #dscam001@#1; |PINTA #agifa024#29;
                 #agifa024#216 = #dscam001@#3; |PINTA #agifa024#216;
              |FINSI;
           |FINSI;
           |CIERRA #dscam001@; |DESCARGA_DEF #dscam001@;
           |CIERRA #dscam045@; |DESCARGA_DEF #dscam045@;
        |FINSI;
     |FINSI;

     |SI nError = 0; |Y #0Campo ! Contenido;
          |HAZ Digito2;
          |HAZ CalculaIBAN;
     |FINSI;
/*
     |HAZ EsMalpesa;
     |SI FSalida = 0;
          |HAZ MalpeCliCta7;
     |FINSI;
*/
|FPRC;

|PROCESO CodigoBanco66; |TIPO 66;
     |DBASS aAlfa; |QBF aAlfa; aAlfa = aAlfa + "dscarter/def/dscam045.mas";
     |CARGA_DEF aAlfa, dscam045@;
     |SI FSalida = 0;
        |DBASS aAlfa; |QBF aAlfa; aAlfa = aAlfa + "dscarter/def/dscam001.mas";
        |CARGA_DEF aAlfa, dscam001@;
        |DBASS aAlfa; |QBF aAlfa; aAlfa = aAlfa + "dscarter/def/dscam002.mas";
        |CARGA_DEF aAlfa, dscam002@;

        |DBASS aAlfa; |QBF aAlfa; aAlfa = aAlfa + "dscarter/fich/";
        |PATH_DAT #1000 aAlfa; |ABRE #dscam045@;
        #dscam045@#0 = #48#0;
        #dscam045@#1 = 0;
        |LEE 000#dscam045@.];
        |SI FSalida = 0; |Y #dscam045@#0 = #48#0;
           |DBASS aAlfa; |QBF aAlfa; aAlfa = aAlfa + "dscarter/fich/" + (("00000" + #dscam045@#6) % -105) + "/";
           |PATH_DAT #1001 aAlfa; |ABRE #dscam001@;
           |PATH_DAT #1002 aAlfa; |ABRE #dscam002@;
           |SI Campo = 32;
              #dscam001@#0 = #agifa024#32;
              |LEE 000#dscam001@.];
              |CONSULTA_CLAVE #1#dscam001@;
              |SI FSalida = 0;
                 #agifa024#32 = #dscam001@#0; |PINTA #agifa024#32;
              |FINSI;
              #dscam001@#0 = #agifa024#32;
              |LEE 000#dscam001@.=;
              |SI FSalida = 0;
                 #agifa024#29  = #dscam001@#1; |PINTA #agifa024#29;
                 #agifa024#216 = #dscam001@#3; |PINTA #agifa024#216;
              |SINO;
                 |MENAV "    Entidad inexistente"; |ERROR;
              |FINSI;
           |FINSI;
           |SI Campo = 33;
              #dscam002@#0 = #agifa024#32;
              #dscam002@#1 = #agifa024#33;
              |LEE 000#dscam002@.];
              |CONSULTA_CLAVE #1#dscam002@;
              |SI FSalida = 0;
                 #agifa024#32 = #dscam002@#0; |PINTA #agifa024#32;
                 #agifa024#33 = #dscam002@#1; |PINTA #agifa024#33;
              |FINSI;
              #dscam002@#0 = #agifa024#32;
              #dscam002@#1 = #agifa024#33;
              |LEE 000#dscam002@.=;
              |SI FSalida = 0;
                 #agifa024#29  = #dscam002@#2; |PINTA #agifa024#29;
                 #agifa024#162 = #dscam002@#6; |PINTA #agifa024#162;
                 #agifa024#34  = #dscam002@#3; |PINTA #agifa024#34;
              |SINO;
                 |MENAV "    Sucursal inexistente"; |ERROR;
              |FINSI;
           |FINSI;
           |CIERRA #dscam001@; |DESCARGA_DEF #dscam001@;
           |CIERRA #dscam002@; |DESCARGA_DEF #dscam002@;
           |CIERRA #dscam045@; |DESCARGA_DEF #dscam045@;
        |FINSI;
     |FINSI;
/*
     |HAZ EsMalpesa;
     |SI FSalida = 0;
          |HAZ MalpeCliCta66;
     |FINSI;
*/
|FPRC;

/*
||Estos proceso YA no se ejecutan AQUI, se ejecutan en el PLB: dsz99949

|PROCESO Clie15; |TIPO 15;
|FPRC;

|PROCESO Clie16; |TIPO 16;
|FPRC;

|PROCESO Clie17; |TIPO 17;
|FPRC;
*/

|PROCESO BotonTramo1;
     |HAZ TramosMenu;
|FPRC;

|PROCESO BotonFPag1;
     |HAZ FPago;
|FPRC;

|PROCESO BotonTramo;
     |PTEC 824;
|FPRC;

|PROCESO BotonFPag;
     |PTEC 825;
|FPRC;

|PROCESO PinBotonTra; |TIPO 7;
     |ABRE #130;
     #130#0 = #0#0;
     #130#1 = 1;
     |LEE 000#130];
     |SI FSalida = 0; |Y #130#0 = #0#0;
          |ESTADO_CONTROL nBtnTramo, "ENABLE";
     |SINO;
          |ESTADO_CONTROL nBtnTramo, "DISABLE";
     |FINSI;
     |CIERRA #130;

     |ABRE #45;
     #45#0 = #0#0;
     #45#1 = 1;
     |LEE 000#45];
     |SI FSalida = 0; |Y #45#0 = #0#0;
          |ESTADO_CONTROL nBtnFPago, "ENABLE";
     |SINO;
          |ESTADO_CONTROL nBtnFPago, "DISABLE";
     |FINSI;
     |CIERRA #45;

     |ESTADO_CONTROL nBtnTramo, "SHOW";
     |ESTADO_CONTROL nBtnFPago, "SHOW";
|FPRC;

|PROCESO PinBotonTra1;
     |ABRE #130;
     #130#0 = #0#0;
     #130#1 = 1;
     |LEE 000#130];
     |SI FSalida = 0; |Y #130#0 = #0#0;
          |ESTADO_CONTROL nBtnTramo1, "ENABLE";
     |SINO;
          |ESTADO_CONTROL nBtnTramo1, "DISABLE";
     |FINSI;
     |CIERRA #130;

     |ABRE #45;
     #45#0 = #0#0;
     #45#1 = 1;
     |LEE 000#45];
     |SI FSalida = 0; |Y #45#0 = #0#0;
          |ESTADO_CONTROL nBtnFPago1, "ENABLE";
     |SINO;
          |ESTADO_CONTROL nBtnFPago1, "DISABLE";
     |FINSI;
     |CIERRA #45;

     |ESTADO_CONTROL nBtnTramo1, "SHOW";
     |ESTADO_CONTROL nBtnFPago1, "SHOW";
|FPRC;

|PROCESO QuitaBotonTra;
     |ESTADO_CONTROL nBtnTramo, "HIDE";
     |ESTADO_CONTROL nBtnFPago, "HIDE";
     |ESTADO_CONTROL nBtnTramo1, "HIDE";
     |ESTADO_CONTROL nBtnFPago1, "HIDE";
|FPRC;

|RUTINA Inf130;
     #130#0 = #0#0;
     #130#1 = 1;
|FRUT;

|RUTINA Max130;
     #130#0 = #0#0;
     #130#1 = 99;
|FRUT;

|PROCESO Tramos; |TIPO 6;
     || solo activo en los campos de la 2 pantalla
     |SI Campo = 37; |O Campo = 38; |O Campo = 156; |O Campo = 190;
               |O Campo = 204; |O Campo = 206; |O Campo = 207;
               |O Campo = 208; |O Campo = 32; |O Campo = 33;
               |O Campo = 30;  |O Campo = 203; |O Campo = 20;
               |O Campo = 21; |O Campo = 22; |O Campo = 23;
               |O Campo = 24; |O Campo = 25; |O Campo = 26;
               |O Campo = 193; |O Campo = 192; |O Campo = 191;
               |O Campo = 53;
           |SI FSalida = 10;
               |PUSHV 0501 2380;
               |ENTLINEAL #1#130, 2, 2, 22, 1, Inf130, Max130;
               |POPV;
               |ERROR;
          |FINSI;
          |SI FSalida = 11;
               |PUSHV 0501 2380;
               |ENTLINEAL #1#45, -2, 1, 22, 1, inf45, sup45;
               |POPV;
               |ERROR;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO TramosMenu;
     |PUSHV 0501 2380;
     |ENTLINEAL #1#130, 2, 2, 22, 1, Inf130, Max130;
     |POPV;
|FPRC;

|PROCESO ChecTramo; |TIPO 0;
     |SI FSalida = 2; |ACABA; |FINSI;
     nDia1 = #130#3 * 31 + #130#2;
     nDia2 = #130#5 * 31 + #130#4;
     |SI nDia1 > nDia2;
          |MENAV "0000Error de entrada.";
          |ERROR;
     |FINSI;
|FPRC;

|PROCESO ChecTramo2; |TIPO 2;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo ! 3;
          nDia1 = #130#3 * 31 + #130#2;
          nDia2 = #130#5 * 31 + #130#4;
          |SI nDia1 > nDia2;
               |MENAV "0000Error de entrada.";
               |ERROR;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO CondEspCli; |TIPO 0;
     nModo = (FEntrada / 100) ! 0;

     |MODULO aAlfa;
     |SI nModo = 4; |Y aAlfa = "agifa024";
          |HAZ Riesgo024;
     |FINSI;
/*
     |SI nModo = 1;
          |HAZ EsTaller;
          |SI FSalida = 0;
               |DDEF aAlfa;
               aAlfa = aAlfa + "con00691";
               |CARGA_DEF aAlfa, referen@;
               |SI FSalida = 0;
                    |ABRE #referen@;
                    |LEE 000#referen@.p;
                    |CIERRA #referen@;
                    #0#167 = #referen@#2;
                    |DESCARGA_DEF #referen@;
               |FINSI;
          |FINSI;
     |FINSI;
*/
|FPRC;

|PROCESO TipoCli0; |TIPO 0;
     |SI FSalida = 0;
          |C_M #0#113, 1, "S";
          |ENCAMPO #113#0;
          |C_M #0#113, 1, "N";
     |FINSI;
|FPRC;

|PROCESO TipoCli14; |TIPO 14;
     |HAZ PintaRefMandato;

     |HAZ EsCongecar;
     |SI FSalida = 0;
          |ATRI 0;
          |PINTA 2104, "Datos a europastry S/N:";
          |ATRI I;
          |C_M #0#111, 1, "S";
          |C_V #0#111, 1, "S";
          |C_P #0#111, 1, 2128;
     |FINSI;
     |HAZ EsTaller;
     |SI FSalida = 0;
          |ATRI 0;
          |PINTA 2104, "Facturar por matricula S/N:";
          |ATRI I;
          |C_M #0#111, 1, "S";
          |C_V #0#111, 1, "S";
     |FINSI;
     |HAZ EsSolar;
     |SI FSalida = 0;
          |ATRI 0;
          |PINTA 2104, "Enviar factura por mail S/N:";
          |ATRI I;
          |C_M #0#112, 1, "S";
          |C_V #0#112, 1, "S";
     |FINSI;
     |HAZ EsPCEGroup;
     |SI FSalida = 0;
          |ATRI 0;
          |PINTA 2104, "Idioma documentos.:";
          |ATRI I;
          |C_M #0#48, 1, "S";
          |C_V #0#48, 1, "S";
     |FINSI;
     |HAZ EsAparecida;
     |SI FSalida = 0;
          |ATRI 0;
          |PINTA 2104, "Auto-Descarga.....:";
          |ATRI I;
          |C_M #0#113, 1, "S";
          |C_V #0#113, 1, "S";
     |FINSI;
     |HAZ EsQDClor;
     |SI FSalida = 0;
          |ATRI 0;
          |PINTA 916, "Boletin:";
          |PINTA 2157, "F.Dir:   Bol:";
          |C_P #0#210, 1, 2163; |PINTA #0#210;
          |ATRI I;
          |C_P #0#113, 1, 924;
          |C_V #0#113, 1, "S";
          |C_M #0#51, 1, "S";
          |C_V #0#51, 1, "S";
     |FINSI;
     |HAZ EsDefelino;
     |SI FSalida = 0;
          |ATRI 0;
          |PINTA 2104, "Paking list en facturas S/N:";
          |ATRI I;
          |C_M #0#112, 1, "S";
          |C_V #0#112, 1, "S";
     |FINSI;
     |HAZ EsExtintor;
     |SI FSalida = 0;
          |ATRI 0;
          |PINTA 2104, "Cliente bloqueado S/N:";
          |ATRI I;
          |C_P #0#111, 1, 2127;
          |C_M #0#111, 1, "S";
          |C_V #0#111, 1, "S";
     |FINSI;
     |HAZ EsEvaristo;
     |SI FSalida = 0;
          |ATRI 0;
          |PINTA 1326, "Intracomunitario:";
          |ATRI I;
     |FINSI;
|FPRC;

|PROCESO Riesgo024;
     eaCodCliente = #0#0;
     eaNomCliente = #0#2;
     nMasRies = 0;

     eaTag = "";  |HAZ SacaRiesgo;
     |SI #agifa142#251 = "S"; |Y eaExisteCliRie = "S";
          eaDocu = "C";
          eaTipo = "C";
          enImpoDoc = 0;
          eaMuestra = "C";
          |HAZ ControlRiesgo;
/*
          |SI enErrRie ! 0; |ACABA; |FINSI;
          |SI enAudito = 0;
               |ABRE #143;
               |LEE 000#143u;
               |SI FSalida = 0;
                    nConAu = #143#0 + 1;
               |SINO;
                    nConAu = 1;
               |FINSI;
               |DDEFECTO #143;
               #143#0 = nConAu;
               #143#12 = "CLIENTE";
               #143#3 = ~;
               #143#4 = #0#0;
               #143#5 = #0#1;
               #143#6 = Usuario % 810;
               #143#7 = #141#0;
               #143#8 = #141#1;
               #143#9 = #141#2;
               #143#10 = #141#3;
               #143#11 = #141#4;
               |GRABA 020#143n;
               |CIERRA #143;
          |FINSI;
*/
     |FINSI;
|FPRC;

|PROCESO PinTagloma;
     |DDEF aAlfa;
     aAlfa = aAlfa + "tagm0025";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          |SELECT #2#referen@;
          #referen@#1 = #0#20;
          |LEE 000#referen@.=;
          |SI FSalida = 0;
               aAlfa = #referen@#2;
          |SINO;
               aAlfa = " " * 25;
          |FINSI;
          |ATRI I; |PINTA 2202, aAlfa; |ATRI 0;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|PROCESO ModiNIFCIF;
     |CONFI "0000SModificar NIF/CIF en documentos";
     |SI FSalida = 0;
          eaCliente = #0#0;
          eaNif = #0#15;
          |SUB_EJECUTA_NP "dsz00096";
     |FINSI;
|FPRC;

|PROCESO T7C15F24; |TIPO 7;
     |HAZ MensaNIF;
|FPRC;

|PROCESO LetraNif24; |TIPO 6;
     |BLIN 04;

     eaPais = #0#205;

     |SI FSalida = 10;
         eaVarDni  = #0Campo;
         |HAZ ConsultaNIFS;
         #0Campo = eaVarDni;
         |PINTA #0Campo;
     |FINSI;

     |SI FSalida = 9;
          eaVarDni  = #0Campo;
          |HAZ CalculoNIFCIF;
          #0Campo = eaVarDni;
          |PINTA #0Campo;
          |ERROR; |ACABA;
     |FINSI;

     eaVarDni  = #0Campo;
     |HAZ CalculoNIFCIF;
     |SI FSalida = 9;
          eaVarDni  = #0Campo;
          |HAZ CalculoNIFCIF;
          #0Campo = eaVarDni;
          |PINTA #0Campo;
          |ERROR; |ACABA;
     |FINSI;

     eaVarDni  = #0Campo;
     |HAZ CalculoNIFCIF;

     aNifQbf1 = #0Campo;   |QBF aNifQbf1;
     aNifQbf2 = eaVarDni;  |QBF aNifQbf2;

     |SI aNifQbf1 ! aNifQbf2; |Y aNifQbf1 ! "";
          aAlfa = "0000NEl NIF puede ser erróneo."+&13+"¿Desea calcularlo?";
          |CONFI aAlfa;
          |SI FSalida = 0;
               #0Campo = eaVarDni; |PINTA #0Campo;
          |FINSI;
     |FINSI;

     |SI nPas = 1;
         nModo = 2;
     |FINSI;

     |SI nModo = 1;
         enOk     = 0;
         eaTipo   = "C";
         eaVarDni = #agifa024#15;
         eaModo   = "1";
         |HAZ RecogeCliProvNIF;
         |SI enOk = 1;
             |MENAV "0000No esta en la base de datos el NIF introducido";
             |ERROR;
         |FINSI;
     |FINSI;

     |SI nModo = 2;
         enOk     = 0;
         eaTipo   = "C";
         eaVarDni = #agifa024#15;
         eaModo   = "2";
         |HAZ RecogeCliProvNIF;
     |FINSI;

     |HAZ Dupli;

     |SI nModo = 1;
         |SI nPas = 0;
             nPas = 1;
             |POSICIONATE #agifa024#2;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO CamObliga; |TIPO 0;
     |SI #279#1 = "S";
          |SI Campo = 1; |O Campo = 15; |O Campo = 5; |O Campo = 6;
                    |O Campo = 7;
               aAlfa = #0Campo; |QBF aAlfa;
               |SI aAlfa = "";
                    |MENAV "0000Campo obligatorio.";
                    |ERROR;
               |FINSI;
          |FINSI;
          |SI Campo = 178;
               |ABRE #225;
               #225#0 = #0#205;
               |LEE 000#225=;
               |CIERRA #225;
               |SI #0Campo = 0; |Y #225#6 = "N";
                    |MENAV "0000Campo obligatorio.";
                    |ERROR;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO CamObliga2;
     nError = 0;
     |SI #279#1 = "S";
          aAlfa = #0#1; |QBF aAlfa;
          |SI aAlfa = "";
               |MENAV "0000Nombre fiscal, campo obligatorio...";
               nError = 1;
          |FINSI;
          aAlfa = #0#15; |QBF aAlfa;
          |SI aAlfa = "";
               |MENAV "0000NIF/CIF, campo obligatorio...";
               nError = 1;
          |FINSI;
          aAlfa = #0#5; |QBF aAlfa;
          |SI aAlfa = "";
               |MENAV "0000Direccion envio, campo obligatorio...";
               nError = 1;
          |FINSI;
          aAlfa = #0#6; |QBF aAlfa;
          |SI aAlfa = "";
               |MENAV "0000Poblacion envio, campo obligatorio...";
               nError = 1;
          |FINSI;
          aAlfa = #0#7; |QBF aAlfa;
          |SI aAlfa = "";
               |MENAV "0000Provincia envio, campo obligatorio...";
               nError = 1;
          |FINSI;
          |ABRE #225;
          #225#0 = #0#205;
          |LEE 000#225=;
          |CIERRA #225;
          |SI #0#178 = 0; |Y #225#6 = "N";
               |MENAV "0000Codigo postal, campo obligatorio...";
               nError = 1;
          |FINSI;
     |FINSI;
     FSalida = nError;
|FPRC;

|PROCESO CambiaDir; |TIPO 0;
     nModo = (FEntrada / 100) ! 0;
     |SI #0Campo ! Contenido; |Y nModo = 2;
          nSwCambiaDir = 1;
     |FINSI;
|FPRC;

|PROCESO Pais0; |TIPO 0;
     |SI #0Campo = Contenido;
          |HAZ EsPCEGroup;
          |SI FSalida = 0;
               |HAZ PCEG_Pais;
          |FINSI;
     |SINO;
          |ABRE #225;
          #225#0 = #0#205;
          |LEE 000#225=;
          |SI FSalida = 0; |Y #225#6 = "S";
               #0#181 = 99; |PINTA #0#181;
               #0#182 = 999; |PINTA #0#182;
               #0#183 = "99999";
               #0#211 = "99999";
          |FINSI;
          |CIERRA #225;

          |HAZ EsPCEGroup;
          |SI FSalida = 0;
               |HAZ PCEG_Zona;
               |HAZ PCEG_Pais;
               |HAZ PCEG_Divisa;
               |ABRE #225;
               #225#0 = #0#205;
               |LEE 000#225=;
               |CIERRA #225;
               #0#14 = #225#1; |PINTA #0#14;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Alfanu1; |TIPO 0;
|FPRC;

|PROCESO PCEG_Zona;
     |DDEF aAlfa;
     aAlfa = aAlfa + "pcegm007";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          #referen@#0 = #0#205;
          #referen@#1 = #0#211;
          |LEE 000#referen@.=;
          |SI FSalida = 0;
               #0#3 = #referen@#2;
          |SINO;
               aAlfa = #0#211 % 102;
               #referen@#1 = aAlfa;
               |LEE 000#referen@.=;
               |SI FSalida = 0;
                    #0#3 = #referen@#2;
               |SINO;
                    #referen@#1 = "";
                    |LEE 000#referen@.=;
                    |SI FSalida = 0;
                         #0#3 = #referen@#2;
                    |FINSI;
               |FINSI;
          |FINSI;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |SINO;
          |MENAV "0000Error al cargar 'pcegm007'";
     |FINSI;
|FPRC;

|PROCESO PCEG_Pais;
     |DDEF aAlfa;
     aAlfa = aAlfa + "pcegm001";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          #referen@#0 = #0#205;
          |LEE 000#referen@.=;
          |SI FSalida ! 0;
               |PUSHV 0501 2380;
               |PINPA #0#referen@;
               |PINDA #0#referen@;
               |CONFI "0000SConfirma alta (S/N):";
               |SI FSalida = 0;
                    aAlfa = FEntrada;
                    |ENDATOS #1#referen@;
                    |SI FSalida = 0;
                         |GRABA 020#referen@.n;
                    |SINO;
                         |ERROR;
                    |FINSI;
                    FEntrada = aAlfa;
               |SINO;
                    |ERROR;
               |FINSI;
               |POPV;
          |FINSI;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |SINO;
          |MENAV "0000Error al cargar 'pcegm001'";
     |FINSI;
|FPRC;

|PROCESO BotonVigor;
     |DDEF aAlfa;
     aAlfa = aAlfa + "vigm0041";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |PUSHV 0501 2380;
          |DDEFECTO #referen@;
          |ABRE #referen@;
          #referen@#0 = #0#0;
          |LEE 101#referen@.=;
          |SI FSalida ! 0; |GRABA 020#referen@.b; |FINSI;
          |PINPA #0#referen@;
          |PINDA #0#referen@;
          |ENDATOS #2#referen@;
          |SI FSalida = 0;
               |GRABA 020#referen@.a;
          |FINSI;
          |CIERRA #referen@;
          |POPV;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|PROCESO ProEnv; |TIPO 0;
     |SI #0Campo ! Contenido;
          |DDEF aAlfa;
          aAlfa = aAlfa + "agifa040";
          |CARGA_DEF aAlfa, referen@;
          |SI FSalida = 0;
               |ABRE #referen@;
               #referen@#0 = #0Campo;
               |LEE 000#referen@.=;
               |CIERRA #referen@;
               #0#7 = #referen@#1; |PINTA #0#7;
               |DESCARGA_DEF #referen@;
          |SINO;
               |MENAV "0000Error al cargar 'agifa040'";
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO BtnOpciones;
     |HAZ Tipo20;
|FPRC;

|PROCESO InfAlbModCli;
     |DDEF aPath;
     aAlfa = aPath + "ialbm004";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          #referen@#0 = #0#0;
          |LEE 101#referen@.];
          |PARA; |SI FSalida = 0; |Y #referen@#0 = #0#0;  |HACIENDO;
               #referen@#4 = #0#2;
               |GRABA 020#referen@.a;
               |LIBERA #referen@;
               |LEE 101#referen@.s;
          |SIGUE;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
     aAlfa = aPath + "ialbm009";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          #referen@#0 = #0#0;
          |LEE 101#referen@.=;
          |SI FSalida = 0;
               #referen@#1 = #0#1;
               #referen@#2 = #0#2;
               #referen@#3 = #0#5;
               #referen@#4 = #0#6;
               #referen@#5 = #0#7;
               #referen@#6 = #0#15;
               #referen@#7 = #0#17;
               #referen@#1 = #0#1;
               |GRABA 020#referen@.a;
          |FINSI;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
     aAlfa = aPath + "ialbm002";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          |SELECT #4#referen@;
          #referen@#6 = #0#0;
          |LEE 101#referen@.=;
          |PARA; |SI FSalida = 0; |Y #referen@#6= #0#0;  |HACIENDO;
               #referen@#7 = #0#1;
               #referen@#21 = #0#17;
               ||#referen@#10 = #0#25;
               ||#referen@#11 = #0#26;
               |GRABA 020#referen@.a;
               |LIBERA #referen@;
               |LEE 101#referen@.s;
          |SIGUE;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|PROCESO Cam37_24; |TIPO 14;
     |HAZ PinJava24;
     |HAZ EvaPinAviso;
     |HAZ EsInforAlba;
     |SI FSalida = 0;
          |ATRI 0;
          |PINTA 925, "%Dto Accesorio:";
          |ATRI I;
     |FINSI;
     |HAZ PinBotonTra1;

     |ATRI 0;
     |BLANCO 1869 1970; || para ocultar 2 campos que no se cuales son
     |ATRI I;
|FPRC;

|PROCESO PinJava24;
/*
     |ATRI R;
     |PINTA 0602," CODIGO:";
     |PINTA 0618, " Nombre Fiscal ..:";
     |ATRI I;
     |PINTA 0611, #0#0;
     |PINTA 0637, #0#1;
*/
|FPRC;

|PROCESO PinPa4; |TIPO 14;
     |HAZ EsInforpor;
     |SI FSalida = 0;
          nCam114 = #0#114;
          |HAZ RieTotales;
          |PINTA 2105, "Riesgo concedido..:";
          |PINTA 2205, "Riesgo utilizado..:";
          |PINTA 2305, "Riesgo disponible.:";
          #0#114 = enRieConce; |PINTA 2126, #0#114;
          #0#114 = enRieUtil; |PINTA 2226, #0#114;
          #0#114 = enRieDispo; |PINTA 2326, #0#114;
          #0#114 = nCam114;
     |FINSI;
|FPRC;

|PROCESO PCEG_Divisa;
     |DDEF aAlfa;
     aAlfa = aAlfa + "pcegm001";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          #referen@#0 = #0#205;
          |LEE 000#referen@.=;
          |SI FSalida = 0;
               #0#193 = #referen@#2;
               #0#192 = #referen@#3;
          |FINSI;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |SINO;
          |MENAV "0000Error al cargar 'pcegm001'...";
     |FINSI;
|FPRC;

|PROCESO EvaPinAviso; |TIPO 14;
     |HAZ EsEvaristo;
     |SI FSalida ! 0; |ACABA; |FINSI;
     |DDEF aAlfa;
     aAlfa = aAlfa + "evarm041";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          #referen@#0 = #0#0;
          |LEE 000#referen@.=;
          |ATRI N;
          |PINTA 2202, "³ Aviso:                                           ";
          |PINTA 2253,  "                  ³";
          |PINTA 2302, "ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ";
          |PINTA 2353, "ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ";
          |ATRI I;
          |PINTA 2210, #referen@#1;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|PROCESO BorraEvaAviso;
     |DDEF aAlfa;
     aAlfa = aAlfa + "evarm041";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          #referen@#0 = #0#0;
          |BORRA 000#referen@.c;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|PROCESO EdiEvaAviso; |TIPO 0;
     |SI FSalida ! 0; |Y FSalida ! 3; |ACABA; |FINSI;
     |HAZ EsEvaristo;
     |SI FSalida ! 0; |ACABA; |FINSI;

     eaCliente = #0#0;
     |SUB_EJECUTA_NP "evarm041";
     |HAZ EvaPinAviso;
|FPRC;

|PROCESO EvaF7;
     eaCliente = #0#0;
     |SUB_EJECUTA_NP "evarm045";
|FPRC;

|PROCESO EvaF6;
     eaCliente = #0#0;
     |SUB_EJECUTA_NP "evarm022";
|FPRC;

|PROCESO EvaF4;
     eaCliente = #0#0;
     |SUB_EJECUTA_NP "evarm021";
|FPRC;

|PROCESO EvaF3;
     eaCliente = #0#0;
     |SUB_EJECUTA_NP "evarz007";
|FPRC;

|PROCESO Tipo24_6; |TIPO 6;
     nTecla = FSalida;

     |HAZ EsEvaristo;
     |SI FSalida = 0;
          eaCliente = #0#0;
          |SI nTecla = 11;
               |SUB_EJECUTA_NP "evarz007";
               |ERROR;
          |FINSI;
          |SI nTecla = 12;
               |SUB_EJECUTA_NP "evarm021";
               |ERROR;
          |FINSI;
          |SI nTecla = 14;
               |SUB_EJECUTA_NP "evarm022";
               |ERROR;
          |FINSI;
          |SI nTecla = 15;
               |SUB_EJECUTA_NP "evarm045";
               |ERROR;
          |FINSI;
     |FINSI;
     FSalida = nTecla;
|FPRC;

|PROCESO AuxChampi;
     eaCliente = #7#0;
     enDirEnt = #7#1;
     |SUB_EJECUTA_NP "champ006";
|FPRC;

|PROCESO RutaPsioa;
     |DDEF aPath;
     aAlfa = aPath + "psioa032";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          #referen@#0 = #0#189;
          |LEE 000#referen@.=;
          aAlfa = FSalida;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;

          |SI aAlfa = 0;
               aAlfa = aPath + "psioa033";
               |CARGA_DEF aAlfa, referen@;
               |SI FSalida = 0;
                    |ABRE #referen@;
                    #referen@#0 = #0#189;
                    #referen@#1 = #0#0;
                    #referen@#2 = 1;
                    |SI nForma = 1; |Y nModo = 1;
                         |LEE 000#referen@.];
                         |SI FSalida ! 0; |O #referen@#0 ! #0#189; |O #referen@#1 ! #0#0;
                              |DDEFECTO #referen@;
                              #referen@#0 = #0#189;
                              #referen@#1 = #0#0;
                              #referen@#2 = 1;
                              #referen@#3 = 0;
                              |GRABA 020#referen@.n;
                         |FINSI;
                    |SINO;
                         |SI nModo = 3;
                              |SELECT #2#referen@;
                              #referen@#1 = #0#0;
                              #referen@#2 = 1;
                              #referen@#0 = "";
                              |LEE 101#referen@.];
                              |PARA; |SI FSalida = 0; |Y #referen@#1 = #0#0; |HACIENDO;
                                   |BORRA 020#referen@.a;
                                   |LIBERA #referen@;
                                   |LEE 101#referen@.s;
                              |SIGUE;
                         |FINSI;
                         |SI nModo = 2;
                              |SI nForma = 1;
                                   |SI aRutaAntes ! #0#189;
                                        #referen@#0 = aRutaAntes;
                                        |LEE 101#referen@.=;
                                        |SI FSalida = 0;
                                             |BORRA 020#referen@.a;
                                        |FINSI;
                                        |DDEFECTO #referen@;
                                        #referen@#0 = #0#189;
                                        #referen@#1 = #0#0;
                                        #referen@#2 = 1;
                                        #referen@#3 = 0;
                                        |GRABA 000#referen@.n;
                                   |FINSI;
                              |SINO;
                                   aRutaAntes = #0#189;
                              |FINSI;
                         |FINSI;
                    |FINSI;
                    |CIERRA #referen@;
                    |DESCARGA_DEF #referen@;
               |SINO;
                    |MENAV "0000Error al cargar 'psioa033'";
               |FINSI;
          |FINSI;
     |SINO;
          |MENAV "0000Error al cargar 'psioa032'";
     |FINSI;
|FPRC;

|PROCESO BtnExtintor;
     eaCliente = #7#0;
     enDirEnt = #7#1;
     |SUB_EJECUTA_NP "extm0002";
|FPRC;

|PROCESO BtnAux;
     |HAZ EsCamiCor;
     |SI FSalida = 0;
          eaCliente = #0#0;
          |SUB_EJECUTA_NP "camcor20";
     |FINSI;
|FPRC;

|PROCESO ActGesisat;
     |DDEF aPath;
     aAlfa = aPath + "gesim002";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          aAlfa = aPath + "gesim004";
          |CARGA_DEF aAlfa, auxilia@;
          |SI FSalida = 0;
               |ABRE #referen@;
               |ABRE #auxilia@;
               |SELECT #4#referen@;
               #referen@#6 = #0#0;
               |LEE 101#referen@.];
               |PARA; |SI FSalida = 0; |Y #referen@#6 = #0#0; |HACIENDO;
                    #referen@#7 = #0#1;
                    #referen@#21 = #0#17;
                    #referen@#26 = #0#196;
                    #referen@#27 = #0#197;
                    #referen@#10 = #0#25;
                    #referen@#11 = #0#26;
                    |GRABA 020#referen@.a;

                    #auxilia@#0 = #referen@#29;
                    |LEE 101#auxilia@.=;
                    |SI FSalida = 0;
                         #auxilia@#4 = #0#1;
                         #auxilia@#24 = #0#2;
                         #auxilia@#7 = #0#25;
                         #auxilia@#8 = #0#26;
                         #auxilia@#17 = #0#17;
                         #auxilia@#22 = #0#196;
                         #auxilia@#23 = #0#197;
                         |GRABA 020#auxilia@.a;
                         |LIBERA #auxilia@;
                    |FINSI;

                    |LIBERA #referen@;
                    |LEE 101#referen@.s;
               |SIGUE;
               |CIERRA #auxilia@;
               |CIERRA #referen@;
               |DESCARGA_DEF #auxilia@;
          |FINSI;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|PROCESO CalculaIBAN;
     eaCta = (#0#32 % 104) + (#0#33 % 104) + #0#31 + (#0#30 % 110);
     eaPais = #0#205
     |HAZ CalcuIBAN;
     |QBF eaIBAN;
     |SI eaIBAN ! "";
          #0#215 = eaIBAN; |PINTA #0#215;
     |FINSI;
|FPRC;

|PROCESO Iban7; |TIPO 7;
     aAlfa = #0#215; |QBF aAlfa;
     |SI aAlfa = "";
          eaIBANant = "";
          |HAZ CalculaIBAN;
     |FINSI;
|FPRC;

|PROCESO Iban0; |TIPO 0;

     |SI FSalida = 2; |ACABA; |FINSI;

     eaCta     = (#0#32 % 104) + (#0#33 % 104) + #0#31 + (#0#30 % 110);
     eaPais    = #0#205;
     eaIBANant = #0#215;
     |HAZ CalcuIBAN;
     aAlfa = eaIBANant; |QBF aAlfa;

     |SI aAlfa ! eaIBAN;
         |SI aAlfa = "";
             #0#215 = eaIBAN; |PINTA #0#215;
         |SINO;
             |CONFI "0000SError. Código IBAN incorrecto, quiere calcularlo.";
             |SI FSalida = 0;
                 #0#215 = eaIBAN; |PINTA #0#215;
                 |ERROR;
             |FINSI;
         |FINSI;
     |FINSI;
     eaIBANant = "";
|FPRC;


|PROCESO BtnItemDocCli;
     aAlfa = "tagz0025;CL" + #0#0;
     |SUB_EJECUTA_NP aAlfa;
|FPRC;

|PROCESO FirmaSepa; |TIPO 0;
     |SI FSalida = 0;
          eaCliente = #0#0; |SUB_EJECUTA_NP "dsm00289";
          |ATRI I;
          |HAZ PintaRefMandato;
          |ATRI 0;
     |FINSI;
|FPRC;

|PROCESO Zona7; |TIPO 7;
     || Para restaurar el campo que se queda de color intensivo
     || porque entra 2 veces en el TipoCli14 que tambien lo pinta
     |ATRI I; |HAZ PintaRefMandato; |ATRI 0;
|FPRC;

|PROCESO PintaRefMandato;
     |DDEF aAlfa;
     aAlfa = aAlfa + "dsm00289";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          #referen@#0 = #0#0;
          |LEE 000#referen@.=;
          |SI FSalida ! 0; |DDEFECTO #referen@; |FINSI;
          |CIERRA #referen@;
          |PINTA 1646, #referen@#1;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;
