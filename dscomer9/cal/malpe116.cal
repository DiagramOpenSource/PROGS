|FICHEROS;
     malpe116;
     malpe115;
     agifa716;
     agifa704;

     canempr@;
|FIN;

|VARIABLES;
   &enSwEnlSeries = 0;

   &eaContabilizados = "";
   &eaSerie116 = "";
   &enFactura116 = 0;
   &eaModo116  = "";
   &eaTipo116  = "";
   &eaNombre   = "";
   &eaCif      = "";
   &eaSinCompr = 0;
   &enSwMensa  = 0;

   nSwLin = 0;
   nContab = 0;
   nLibroOri   = 0;
   nEmpresaOri = 0;
   nPeriodoOri = 0;
   aPathCont   = "";
   nAnyo       = 0;

   aAlfa  = "";
   aAlfa1 = "";
   fFecha = @;
|FIN;

|PROCESO Series;
   |ABRE #agifa704;
   #agifa704#0 = #malpe115#1;
   |LEE 101#agifa704.=;
   |SI FSalida = 0;
      |SI #agifa704#8 = "S";
         nSwLin = 1;
      |SINO;
         nSwLin = 0;
      |FINSI;
      nEmpresaOri  = #agifa704#4;
      nPeriodoOri  = #agifa704#5;
      nLibroOri    = #agifa704#14;
      aPathCont    = #agifa704#6;
      #agifa704#4  = #malpe115#2;
      #agifa704#5  = #malpe115#3;
      #agifa704#14 = #malpe115#4;
      #agifa704#21 = #malpe115#11;
      |GRABA 020#agifa704.a; |LIBERA #agifa704;
   |FINSI;
   |CIERRA #agifa704;

   aAlfa = "ac" + Usuario; |NOME_DAT #agifa716#aAlfa#;
   |DELINDEX #agifa716; |ABRE #agifa716;
   |DDEFECTO #agifa716;
   #agifa716#15 = #malpe115#1; #agifa716#0 = 1;
   #agifa716#11 = "F";         #agifa716#12 = 10;
   |SI #agifa704#2 = "FV"; #agifa716#13 = "agifa134";  #agifa716#14 = 1;  nContab = 48; |FINSI;
   |SI #agifa704#2 = "FC"; #agifa716#13 = "agifa079";  #agifa716#14 = 1;  nContab = 48; |FINSI;
   |SI #agifa704#2 = "FD"; #agifa716#13 = "agifa084";  #agifa716#14 = 1;  nContab = 39; |FINSI;
   #agifa716#7 = #malpe116#0; #agifa716#8 = #malpe116#1;
   |GRABA 020#agifa716.n;

   |DDEFECTO #agifa716;
   #agifa716#15 = #malpe115#1; #agifa716#0 = 2;
   #agifa716#11 = "A";         #agifa716#12 = 1;
   |SI #agifa704#2 = "FV"; #agifa716#13 = "agifa134";  #agifa716#14 = 48; |FINSI;
   |SI #agifa704#2 = "FC"; #agifa716#13 = "agifa079";  #agifa716#14 = 48; |FINSI;
   |SI #agifa704#2 = "FD"; #agifa716#13 = "agifa084";  #agifa716#14 = 39; |FINSI;
   |SI eaModo116 ! "B";
      #agifa716#3 = "N"; #agifa716#4 = "N";
   |SINO;
      #agifa716#3 = "S"; #agifa716#4 = "S";
   |FINSI;
   |GRABA 020#agifa716.n;

   |DDEFECTO #agifa716;
   #agifa716#15 = #malpe115#1; #agifa716#0 = 3;
   #agifa716#11 = "N";         #agifa716#12 = 15;
   |SI #agifa704#2 = "FV"; #agifa716#13 = "agifa134"; #agifa716#14 = 101; |FINSI;
   |SI #agifa704#2 = "FD"; #agifa716#13 = "agifa084"; #agifa716#14 = 73;  |FINSI;
   |SI #agifa704#2 = "FC"; #agifa716#13 = "agifa079"; #agifa716#14 = 118; |FINSI;
   |SI #agifa704#2 = "TI"; #agifa716#13 = "agifa501"; #agifa716#14 = 9;   |FINSI;
   |SI #malpe115#9 = "-";
      #agifa716#5 = -99999999.99999; #agifa716#6 = -0.00001;
   |SINO;
      #agifa716#5 = 0;               #agifa716#6 = 999999999.99999;
   |FINSI;
   |GRABA 020#agifa716.n;

   |SI enFactura116 ! 0;
      |DDEFECTO #agifa716;
      #agifa716#15 = #malpe115#1; #agifa716#0 = 5;
      #agifa716#11 = "N";         #agifa716#12 = 6;
      |SI #agifa704#2 = "FV"; #agifa716#13 = "agifa134"; #agifa716#14 = 0; |FINSI;
      |SI #agifa704#2 = "FD"; #agifa716#13 = "agifa084"; #agifa716#14 = 0; |FINSI;
      |SI #agifa704#2 = "FC"; #agifa716#13 = "agifa079"; #agifa716#14 = 0; |FINSI;
      |SI #agifa704#2 = "TI"; #agifa716#13 = "agifa501"; #agifa716#14 = 0; |FINSI;
      #agifa716#5 = enFactura116; #agifa716#6 = enFactura116;
      |GRABA 020#agifa716.n;
   |FINSI;

   |SI #agifa704#2 ! "CC";
      |DDEFECTO #agifa716;
      #agifa716#15 = #malpe115#1; #agifa716#0 = 4;
      #agifa716#11 = "A";         #agifa716#12 = 5;
      |SI nSwLin = 0;
         |SI #agifa704#2 = "FV"; #agifa716#13 = "agifa134";  #agifa716#14 = 49; |FINSI;
         |SI #agifa704#2 = "FC"; #agifa716#13 = "agifa079";  #agifa716#14 = 66; |FINSI;
         |SI #agifa704#2 = "FD"; #agifa716#13 = "agifa084";  #agifa716#14 = 48; |FINSI; || PEPE
      |SINO;
         |SI #agifa704#2 = "FV";  #agifa716#13 = "agifa071";  #agifa716#14 = 30; |FINSI;
         |SI #agifa704#2 = "FC";  #agifa716#13 = "agifa080";  #agifa716#14 = 28; |FINSI;
         |SI #agifa704#2 = "FD";  #agifa716#13 = "agifa069";  #agifa716#14 = 20;  |FINSI; || PEPE
      |FINSI;
      |SI #agifa704#2 = "TI"; #agifa716#13 = "agifa501";  #agifa716#14 = 57;  |FINSI;
      #agifa716#3 = #malpe115#0; #agifa716#4 = #malpe115#0;
      |GRABA 020#agifa716.n;
   |FINSI;
   |LIBERA #agifa716; |CIERRA #agifa716;

   aAlfa = aPathCont; |QBF aAlfa; aAlfa = aAlfa + "def/canempre.mas";
   |CARGA_DEF aAlfa, canempr@;
   |SI FSalida = 0;
      aAlfa = aPathCont; |QBF aAlfa; aAlfa = aAlfa + "fich/";
      |PATH_DAT #canempr@#aAlfa#; |ABRE #canempr@;
      #canempr@#2 = #malpe115#2;
      #canempr@#3 = #malpe115#3;
      |LEE 000#canempr@.=;
      |SI FSalida = 0;
         nAnyo = #canempr@#26;
         |SI nAnyo > 80;
            nAnyo = nAnyo + 1900;
         |SINO;
            nAnyo = nAnyo + 2000;
         |FINSI;
      |SINO;
         fFecha = ~; aAlfa1 = fFecha % -104; nAnyo = aAlfa1;
      |FINSI;
   |SINO;
      fFecha = ~; aAlfa1 = fFecha % -104; nAnyo = aAlfa1;
   |FINSI;

   aAlfa = #malpe115#1; aAlfa1 = ",CAJA,*" + nAnyo;
   aAlfa = "agifa711.tab;" + aAlfa + aAlfa1;
   |SI eaModo116 = "B"; aAlfa = aAlfa + ",B"; |FINSI;
   |SUB_EJECUTA_NP aAlfa;

   |ABRE #agifa704;
   #agifa704#0 = #malpe115#1;
   |LEE 101#agifa704.=;
   |SI FSalida = 0;
      |SI #agifa704#8 = "S";
         nSwLin = 1;
      |SINO;
         nSwLin = 0;
      |FINSI;
      #agifa704#4  = nEmpresaOri;
      #agifa704#5  = nPeriodoOri;
      #agifa704#14 = nLibroOri;
      |GRABA 020#agifa704.a;
      |LIBERA #agifa704;
   |FINSI;
   |CIERRA #agifa704;
|FPRC;

|DEFBUCLE Series;
#malpe115#1;
;
INICIO;
FINAL;
;
NULL, Series;
|FIN;

|DEFBUCLE Series1;
#malpe115#1;
;
eaSerie116, "+", eaTipo116;
eaSerie116, "+", eaTipo116;
;
NULL, Series;
|FIN;

|PROGRAMA;
   eaContabilizados = "N";
   enSwEnlSeries = 1;
   eaSinCompr = 1;
   enSwMensa  = -1;
   |SI enFactura116 = 0;
      |CLS;
      |CABEZA " Enlace contable ";
      |PINPA #0#malpe116; |PINDA #0#malpe116;
      |ENDATOS #1#malpe116;
      |SI FSalida = 0; |BUCLE Series; |FINSI;
   |SINO;
      |BUCLE Series1;
   |FINSI;
   eaSinCompr = 0;
   enSwMensa  = 0;
   eaContabilizados = "";
   enSwEnlSeries = 0;
|FPRO;
