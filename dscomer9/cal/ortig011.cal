|FICHEROS;
 ortig011 #0;
 ortig010 #1;
 ortig001 #3;
 ortig002 #4;
 ortig005 #5;
 agifa019 #6;
 ortig015 #7;
 ortig016 #8;
 ortig018 #9;
|FIN;


|VARIABLES;
 aGraba = "";
 nModo = 0;
 auxmat = 0;
 auxmat1 = 0;
 mater1 = 0;
 mater = 0;
 impmater = 0;
 &largo = 0;
 &ancho = 0;
 &vengo_de = "";
 &importe2 = 0;
 &importe3 = 0;
 &modelo = "";
 &nDeci_Prebase = 0;
 &nDeci_Impbase = 0;
 &decim_base = 0;
 &precio_base = 0;
|FIN;

|CALCULO calprecio;
 largo = #ortig011#5;
 ancho = #ortig011#4;
 vengo_de = "ortig011";
 modelo = #ortig011#2;
 |SUB_EJECUTA "ortig008.tab"; ||calculo de importe escandallo
 #ortig011#7 = importe2;
 #ortig011#9 = importe3;
 |PINTA #ortig011#7;
|FCAL;

|CALCULO importelin;
 |SI #ortig011#10 = "S";
   |ABRE #3;
   #ortig001#0 = #ortig011#2;
   |LEE 010#3=;
   |SI FSalida ! 0;|DDEFECTO #3;|FINSI;
   |LIBERA #3;
   |CIERRA #3;
   impmater = impmater > #ortig001#7;
   #ortig011#7 =  (impmater / #ortig011#6)+#ortig001#9;
   |PINTA #ortig011#7;
 |SINO;
   impmater = 0;
 |FINSI;
 #ortig011#8 = #ortig011#6 * #ortig011#7;
 |PINTA #ortig011#8;
|FCAL;

|CALCULO totalli;|TIPO 2;
 #ortig010#8 = #ortig010#8 +. #ortig011#8;
 |PINTA #ortig010#8;
|FCAL;

|CALCULO mayus11;
#0Campo = #0Campo > " ";
|PINTA #0Campo;
|FCAL;



|CALCULO metros1;
 #ortig002#10 = 0;
 |SI #ortig002#9 = "2";
   #ortig002#10 = #ortig011#4 + #ortig011#5;
 |FINSI;
 |SI #ortig002#9 = "L";
   #ortig002#10 = #ortig011#5;
 |FINSI;
 |SI #ortig002#9 = "A";
   #ortig002#10 = #ortig011#4;
 |FINSI;
 |SI #ortig002#9 = "N";
   #ortig002#10 = 1;
   aGraba = "N";
 |FINSI;
 |SI #ortig002#9 = "F";
   #ortig002#10 = (#ortig011#5 * #ortig011#4)+(#ortig011#4*#ortig002#3);
 |FINSI;
 |SI #ortig002#9 ! "F"; ||NO ES FORMULA
   #ortig002#10 = #ortig002#10 * #ortig002#2 * #ortig002#3;
 |SINO;
   #ortig002#10 = #ortig002#10 * #ortig002#2;
 |FINSI;
|FCAL;

|PROCESO crea_aux1;
 #8#0 = #ortig011#0;  ||presupuesto
 #8#1 = #ortig002#11; ||material
 |LEE 010#8=;
 |SI FSalida ! 0;
   |CDEFECTO #8,1;
   |SI #ortig002#9 = "N";
     #ortig016#6 = "U";  ||por unidad
   |SINO;
     |SI #ortig016#6 = "F";
       #ortig016#6 = "F"; ||segun formula
     |SINO;
       #ortig016#6 = "L";  ||por metro
     |FINSI;
   |FINSI;
   |GRABA 010#8b;
   |LIBERA #8;
 |FINSI;
 aGraba = "S";
 |HAZ metros1;
 #8#2 = #8#2 +. (#ortig002#10*#ortig011#6);
|| |SI aGraba ! "N";
   #9#0 = #ortig011#0; ||presupuesto
   #9#1 = #ortig011#1; ||linea presupuesto
   #9#2 = #ortig002#11; ||material
   |LEE 010#9=;
   |SI FSalida ! 0;
     |CDEFECTO #9,1;
     |GRABA 010#9b;
     |LIBERA #9;
   |FINSI;
   #9#3 = #9#3 +. (#ortig002#10*#ortig011#6);
   |GRABA 010#9a;
   |LIBERA #9;
|| |FINSI;
 |ABRE #5;
 #5#0 = #ortig002#11;
 |LEE 010#5=;
 |SI FSalida ! 0;|DDEFECTO #5;|FINSI;
 |LIBERA #5;
 |CIERRA #5;
 |SI #5#3 = "S";
   auxmat = #8#2 / #5#1;
   auxmat1 = auxmat ! 0;
   |SI auxmat [ auxmat1;
     auxmat = auxmat1;
   |SINO;
     auxmat = auxmat1 + 1;
   |FINSI;
   #8#3 = auxmat;
 |FINSI;
 #8#7 = #ortig002#14*#ortig011#6;
 |GRABA 010#8a;
 |LIBERA #8;
|FPRC;

|PROCESO ortig018;
|BORRA 010#ortig018.a;
|LIBERA #ortig018;
|FPRC;

|DEFBUCLE ortig018;
#ortig018#1;
;
#ortig011#0,#ortig011#1,"                    ";
#ortig011#0,#ortig011#1,"zzzzzzzzzzzzzzzzzzzz";
;
NULL,ortig018;
|FIN;

|PROCESO borraortig016;
|BORRA 010#ortig016.a;
|LIBERA #ortig016;
|FPRC;

|DEFBUCLE borraortig016;
#ortig016#1;
;
#ortig011#0,"                    ";
#ortig011#0,"zzzzzzzzzzzzzzzzzzzz";
e;
NULL,borraortig016;
|FIN;

|PROCESO borra018;
|BUCLE ortig018;
|FPRC;

|PROCESO crea_aux;|TIPO 2;
  nModo = (FEntrada / 100)!0;
  |SI nModo = 3;|O nModo = 2;
    |HAZ borra018;
    |BUCLE borraortig016;
    |SI nModo = 3;|ACABA;|FINSI;
  |FINSI;
  |ABRE #8;
  |ABRE #3;
  |ABRE #9;
  #ortig001#0 = #ortig011#2;
  |LEE 010#3=;
  |SI FSalida = 0;
   |BUCLELIN 0crea_aux1#3;
  |FINSI;
  |CIERRA #3;
  |CIERRA #8;
  |CIERRA #9;
|FPRC;
