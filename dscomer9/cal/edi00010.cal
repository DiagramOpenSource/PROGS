     OJO Este calculo esta realizado para el modulo 001922
     ­­­ OJO !!!   para cualquier modificaci¢n

|FICHEROS;
     edi00010 #0;
     edi00002 #2;
     edi00003 #3;
     agifa010 #10;
     agifa019 #19;
     agifa024 #24;
     agifa071 #71;
     agifa059 #59;
     agifa104 #104;
     agifa133 #133;
     agifa134 #134;
|FIN;

|VARIABLES;
     aObs3 = "";
     aFecAlb = "";
     aIP = "";
     &nDeci_IVA = 0;
     &aMoneda = "";
     &aDivisa = "";
     aFic = "";
     aPath = "";
     aAlfa = "";
     nHandle = 0;
     nLin = 0;
     aSerAlb = "";
     nNumAlb = 0;
     aFec = "";
     aFac = "";
     aAlb = "";
     aPed = "";
     aNom = "";
     aDir = "";
     aPob = "";
     aNif = "";
     aPer = "";
     aTlf = "";
     aFax = "";
     nNum = 0;
     nAbo = 0;
     nNodo = 0;
     nBruto = 0;
     nNeto = 0;
     nDto = 0;
     nBase = 0;
     nImp = 0;
     nTota = 0;
     nVerde = 0;
     i = 0;
     nTasa = 0;
     nImpo = 0;
     aTipo = "";
     aRecargo = "";
     aArti = "";
     aArtiP = "";
     aDes = "";
     nUni = 0;
     nPreB = 0;
     nPreN = 0;
     aReg = "";
     aCp = "";
     aCod = "";
     aLon = "";
     aNume = "";
     nPos = 0;
     aCar = "";
     aObs2 = "";
     ii = 0;
|FIN;

|PROCESO Punto2Coma;
     aAlfa = "";
     aLon = aNume % A0;
     |PARA ii = 1; |SI ii [ aLon; |HACIENDO ii = ii + 1;
          nPos = ii * 100 + 1;
          aCar = aNume % nPos;
          |SI aCar = "."; aCar = ","; |FINSI;
          aAlfa = aAlfa + aCar;
     |SIGUE;
     aNume = aAlfa;
|FPRC;

|PROCESO CuentaPedi;
     |SI #71#12 ! 0;
          #104#25 = #71#31;
          #104#0 = #71#12;
          |LEE 000#104=;
          |SI FSalida = 0; |Y aPed = "";
               aPed = #104#3; |QBF aPed;
          |FINSI;
     |FINSI;
     nBruto = nBruto + #71#7;
|FPRC;

|PROCESO CuentaAlba;
     #10#52 = #59#15;
     #10#0 = #59#2;
     |LEE 000#10=;
     |SI FSalida = 0;
          aDivisa = #10#68;
          aMoneda = #10#70;
          |HAZ Divisas010;
          |BUCLELIN 2 CuentaPedi #10;

          |SI aObs2 = ""; aObs2 = #10#56; |FINSI;
          |SI aObs3 = ""; aObs3 = #10#57; |FINSI;
     |FINSI;
     aSerAlb = #10#52;
     nNumAlb = #10#0;
     aFecAlb = (#10#1 % 704) + (#10#1 % 402) + (#10#1 % 102);
|FPRC;

|PROCESO LinAlb;
     #19#0 = #71#2;
     |LEE 000#19=;
     |SI FSalida ! 0; |DDEFECTO #19; |FINSI;

     aPed = "";
     |SI #71#12 ! 0;
          #104#25 = #71#31;
          #104#0 = #71#12;
          |LEE 000#104=;
          |SI FSalida = 0;
               aPed = #104#3; |QBF aPed;
          |FINSI;
     |FINSI;

     aArti = #19#128; |QBF aArti;
     |SI aArti = ""; |ACABA; |FINSI;

     aArtiP = #19#134; |QBF aArtiP;
     aDes = #71#4; |QBF aDes;
     nUni = #71#5;
     nNeto = #71#9;
     nBruto = #71#7;
     nPreB = #71#6;
     nPreN = #71#6 < #71#8 < #71#33;

     |SI nAbo = -1; |Y nUni < 0;
          nUni = nUni * nAbo;
          nNeto = nNeto * nAbo;
          nBruto = nBruto * nAbo;
     |FINSI;


     nLin = nLin + 1;
     aAlfa = "<LINEA NUMLIN="+&34+nLin+&34+">";   |XGRABA nHandle, aAlfa;

     aAlfa = "<REFEAN>"   + aArti  + "</REFEAN>"; |XGRABA nHandle, aAlfa;
     aAlfa = "<REFPRO>"   + #71#2  + "</REFPRO>"; |XGRABA nHandle, aAlfa;
     aAlfa = "<DUN14>"             + "</DUN14>";  |XGRABA nHandle, aAlfa;
     aAlfa = "<DESC>"     + aDes   +"</DESC>";    |XGRABA nHandle, aAlfa;
     aAlfa = "<CFAC>"     + nUni   + "</CFAC>";   |XGRABA nHandle, aAlfa;
     aAlfa = "<NETO>"     + nNeto  + "</NETO>";   |XGRABA nHandle, aAlfa;
     aAlfa = "<BRUTO>"    + nBruto + "</BRUTO>";  |XGRABA nHandle, aAlfa;
     aAlfa = "<PRECIOB>"  + nPreB  + "</PRECIOB>";|XGRABA nHandle, aAlfa;
     aAlfa = "<PRECION>"  + nPreN  + "</PRECION>";|XGRABA nHandle, aAlfa;
     |SI aPed ! "";
          aAlfa = "<PEDIDO>"   + aPed  + "</PEDIDO>";|XGRABA nHandle, aAlfa;
     |FINSI;

     aAlfa = "<IMPLFAC>"; |XGRABA nHandle, aAlfa;

     |SI #71#11 = 0; nTasa = 0; |FINSI;
     |SI #71#11 = 1; nTasa = #134#39; |FINSI;
     |SI #71#11 = 2; nTasa = #134#41; |FINSI;
     |SI #71#11 = 3; nTasa = #134#43; |FINSI;
     |SI #71#11 = 4; nTasa = #134#50; |FINSI;
     |SI #71#11 = 5; nTasa = #134#52; |FINSI;
     nImp = (nNeto * nTasa / 100) ! nDeci_IVA;
     aNume = nImp; |HAZ Punto2Coma;

     aAlfa = "<BASE>"            + nNeto + "</BASE>";    |XGRABA nHandle, aAlfa;
     |SI #71#11 = 0;
          aAlfa = "<TIPO>EXT</TIPO>";                         |XGRABA nHandle, aAlfa;
     |SINO;
          aAlfa = "<TIPO>VAT</TIPO>";                         |XGRABA nHandle, aAlfa;
     |FINSI;
     aAlfa = "<TASA>"            + nTasa +  "</TASA>";   |XGRABA nHandle, aAlfa;
     aAlfa = "<IMPORTE>"         + aNume + "</IMPORTE>"; |XGRABA nHandle, aAlfa;

     |SI #71#11 ! 0; |Y aRecargo = "S";
          |SI #71#11 = 1; nTasa = #134#40; |FINSI;
          |SI #71#11 = 2; nTasa = #134#42; |FINSI;
          |SI #71#11 = 3; nTasa = #134#44; |FINSI;
          |SI #71#11 = 4; nTasa = #134#51; |FINSI;
          |SI #71#11 = 5; nTasa = #134#53; |FINSI;
          nImp = (nNeto * nTasa / 100) ! nDeci_IVA;
          aNume = nImp; |HAZ Punto2Coma;

          aAlfa = "<BASE>"            + nNeto + "</BASE>";    |XGRABA nHandle, aAlfa;
          aAlfa = "<TIPO>RE</TIPO>";                          |XGRABA nHandle, aAlfa;
          aAlfa = "<TASA>"            + nTasa +  "</TASA>";   |XGRABA nHandle, aAlfa;
          aAlfa = "<IMPORTE>"         + aNume  + "</IMPORTE>"; |XGRABA nHandle, aAlfa;
     |FINSI;

     aAlfa = "</IMPLFAC>"; |XGRABA nHandle, aAlfa;

     aAlfa = "</LINEA>"; |XGRABA nHandle, aAlfa;
|FPRC;

|PROCESO LinFac;
     #10#52 = #59#15;
     #10#0 = #59#2;
     |LEE 000#10=;
     |SI FSalida = 0;
          aDivisa = #10#68;
          aMoneda = #10#70;
          |HAZ Divisas010;
          |BUCLELIN 2 LinAlb #10;
     |FINSI;
|FPRC;

|PROCESO Origen;
     aNom = #2#1; |QBF aNom;
     aReg = #2#20; |QBF aReg;
     aDir = #2#3; |QBF aDir;
     aPob = #2#4; |QBF aPob;
     aCp = #2#5; |QBF aCp;
     aNif = #2#13; |QBF aNif;
     aPer = #2#14; |QBF aPer;
     aTlf = #2#15; |QBF aTlf;
     aFax = #2#16; |QBF aFax;
     aAlfa = "<ORIGEN>";                                           |XGRABA nHandle, aAlfa;
     aAlfa = "<COD_INTERLOCUTOR>"  + #2#0 + "</COD_INTERLOCUTOR>"; |XGRABA nHandle, aAlfa;
     aAlfa = "<NOMBRE>"            + aNom + "</NOMBRE>";           |XGRABA nHandle, aAlfa;
     aAlfa = "<REG_MERCANTIL>"     + aReg + "</REG_MERCANTIL>";    |XGRABA nHandle, aAlfa;
     aAlfa = "<DIRECCION>"         + aDir + "</DIRECCION>";        |XGRABA nHandle, aAlfa;
     aAlfa = "<POBLACION>"         + aPob + "</POBLACION>";        |XGRABA nHandle, aAlfa;
     aAlfa = "<CP>"                + aCp  + "</CP>";               |XGRABA nHandle, aAlfa;
     aAlfa = "<NIF>"               + aNif + "</NIF>";              |XGRABA nHandle, aAlfa;
     aAlfa = "<PERSONA_CONTACTO>"  + aPer + "</PERSONA_CONTACTO>"; |XGRABA nHandle, aAlfa;
     aAlfa = "<TELEFONO>"          + aTlf + "</TELEFONO>";         |XGRABA nHandle, aAlfa;
     aAlfa = "<FAX>"               + aFax + "</FAX>";              |XGRABA nHandle, aAlfa;
     aAlfa = "</ORIGEN>";                                          |XGRABA nHandle, aAlfa;
|FPRC;

|PROCESO VenDedor;
     aNom = #2#1; |QBF aNom;
     aReg = #2#20; |QBF aReg;
     aDir = #2#3; |QBF aDir;
     aPob = #2#4; |QBF aPob;
     aCp = #2#5; |QBF aCp;
     aNif = #2#13; |QBF aNif;
     aPer = #2#14; |QBF aPer;
     aTlf = #2#15; |QBF aTlf;
     aFax = #2#16; |QBF aFax;
     aAlfa = "<VENDEDOR>";                                         |XGRABA nHandle, aAlfa;
     aAlfa = "<COD_INTERLOCUTOR>"  + #2#0 + "</COD_INTERLOCUTOR>"; |XGRABA nHandle, aAlfa;
     aAlfa = "<NOMBRE>"            + aNom + "</NOMBRE>";           |XGRABA nHandle, aAlfa;
     aAlfa = "<REG_MERCANTIL>"     + aReg + "</REG_MERCANTIL>";    |XGRABA nHandle, aAlfa;
     aAlfa = "<DIRECCION>"         + aDir + "</DIRECCION>";        |XGRABA nHandle, aAlfa;
     aAlfa = "<POBLACION>"         + aPob + "</POBLACION>";        |XGRABA nHandle, aAlfa;
     aAlfa = "<CP>"                + aCp  + "</CP>";               |XGRABA nHandle, aAlfa;
     aAlfa = "<NIF>"               + aNif + "</NIF>";              |XGRABA nHandle, aAlfa;
     aAlfa = "<PERSONA_CONTACTO>"  + aPer + "</PERSONA_CONTACTO>"; |XGRABA nHandle, aAlfa;
     aAlfa = "<TELEFONO>"          + aTlf + "</TELEFONO>";         |XGRABA nHandle, aAlfa;
     aAlfa = "<FAX>"               + aFax + "</FAX>";              |XGRABA nHandle, aAlfa;
     aAlfa = "</VENDEDOR>";                                        |XGRABA nHandle, aAlfa;
|FPRC;

|PROCESO Emisor;
     aNom = #2#7; |QBF aNom;
     aReg = #2#20; |QBF aReg;
     aDir = #2#9; |QBF aDir;
     aPob = #2#10; |QBF aPob;
     aCp = #2#11; |QBF aCp;
     aNif = #2#12; |QBF aNif;
     aPer = #2#17; |QBF aPer;
     aTlf = #2#18; |QBF aTlf;
     aFax = #2#19; |QBF aFax;
     aAlfa = "<EMISOR>";                                           |XGRABA nHandle, aAlfa;
     aAlfa = "<COD_INTERLOCUTOR>"  + #2#6 + "</COD_INTERLOCUTOR>"; |XGRABA nHandle, aAlfa;
     aAlfa = "<NOMBRE>"            + aNom + "</NOMBRE>";           |XGRABA nHandle, aAlfa;
     aAlfa = "<REG_MERCANTIL>"     + aReg + "</REG_MERCANTIL>";    |XGRABA nHandle, aAlfa;
     aAlfa = "<DIRECCION>"         + aDir + "</DIRECCION>";        |XGRABA nHandle, aAlfa;
     aAlfa = "<POBLACION>"         + aPob + "</POBLACION>";        |XGRABA nHandle, aAlfa;
     aAlfa = "<CP>"                + aCp  + "</CP>";               |XGRABA nHandle, aAlfa;
     aAlfa = "<NIF>"               + aNif + "</NIF>";              |XGRABA nHandle, aAlfa;
     aAlfa = "<PERSONA_CONTACTO>"  + aPer + "</PERSONA_CONTACTO>"; |XGRABA nHandle, aAlfa;
     aAlfa = "<TELEFONO>"          + aTlf + "</TELEFONO>";         |XGRABA nHandle, aAlfa;
     aAlfa = "<FAX>"               + aFax + "</FAX>";              |XGRABA nHandle, aAlfa;
     aAlfa = "</EMISOR>";                                         |XGRABA nHandle, aAlfa;
|FPRC;

|PROCESO Pagador;
     aCod = #3#5;
     aNom = #3#6; |QBF aNom;
     aReg = ""; |QBF aReg;
     aDir = #24#11; |QBF aDir;
     aPob = #24#12; |QBF aPob;
     aCp = #24#186; |QBF aCp;
     aNif = #24#15; |QBF aNif;
     aPer = #24#36; |QBF aPer;
     aTlf = #24#17; |QBF aTlf;
     aFax = #24#18; |QBF aFax;
     aAlfa = "<PAGADOR>";                                          |XGRABA nHandle, aAlfa;
     aAlfa = "<COD_INTERLOCUTOR>"  + aCod + "</COD_INTERLOCUTOR>"; |XGRABA nHandle, aAlfa;
     aAlfa = "<NOMBRE>"            + aNom + "</NOMBRE>";           |XGRABA nHandle, aAlfa;
     aAlfa = "<REG_MERCANTIL>"     + "</REG_MERCANTIL>";           |XGRABA nHandle, aAlfa;
     aAlfa = "<DIRECCION>"         + aDir + "</DIRECCION>";        |XGRABA nHandle, aAlfa;
     aAlfa = "<POBLACION>"         + aPob + "</POBLACION>";        |XGRABA nHandle, aAlfa;
     aAlfa = "<CP>"                + aCp  + "</CP>";               |XGRABA nHandle, aAlfa;
     aAlfa = "<NIF>"               + aNif + "</NIF>";              |XGRABA nHandle, aAlfa;
     aAlfa = "<PERSONA_CONTACTO>"  + aPer + "</PERSONA_CONTACTO>"; |XGRABA nHandle, aAlfa;
     aAlfa = "<TELEFONO>"          + aTlf + "</TELEFONO>";         |XGRABA nHandle, aAlfa;
     aAlfa = "<FAX>"               + aFax + "</FAX>";              |XGRABA nHandle, aAlfa;
     aAlfa = "</PAGADOR>";                                         |XGRABA nHandle, aAlfa;
|FPRC;

|PROCESO Cobrador;
     aCod = #2#6;
     aNom = #2#7; |QBF aNom;
     aReg = #2#20; |QBF aReg;
     aDir = #2#9; |QBF aDir;
     aPob = #2#10; |QBF aPob;
     aCp = #2#11; |QBF aCp;
     aNif = #2#12; |QBF aNif;
     aPer = #2#17; |QBF aPer;
     aTlf = #2#18; |QBF aTlf;
     aFax = #2#19; |QBF aFax;
     aAlfa = "<COBRADOR>";                                         |XGRABA nHandle, aAlfa;
     aAlfa = "<COD_INTERLOCUTOR>"  + aCod + "</COD_INTERLOCUTOR>"; |XGRABA nHandle, aAlfa;
     aAlfa = "<NOMBRE>"            + aNom + "</NOMBRE>";           |XGRABA nHandle, aAlfa;
     aAlfa = "<REG_MERCANTIL>"     + "</REG_MERCANTIL>";           |XGRABA nHandle, aAlfa;
     aAlfa = "<DIRECCION>"         + aDir + "</DIRECCION>";        |XGRABA nHandle, aAlfa;
     aAlfa = "<POBLACION>"         + aPob + "</POBLACION>";        |XGRABA nHandle, aAlfa;
     aAlfa = "<CP>"                + aCp  + "</CP>";               |XGRABA nHandle, aAlfa;
     aAlfa = "<NIF>"               + aNif + "</NIF>";              |XGRABA nHandle, aAlfa;
     aAlfa = "<PERSONA_CONTACTO>"  + aPer + "</PERSONA_CONTACTO>"; |XGRABA nHandle, aAlfa;
     aAlfa = "<TELEFONO>"          + aTlf + "</TELEFONO>";         |XGRABA nHandle, aAlfa;
     aAlfa = "<FAX>"               + aFax + "</FAX>";              |XGRABA nHandle, aAlfa;
     aAlfa = "</COBRADOR>";                                        |XGRABA nHandle, aAlfa;
|FPRC;

|PROCESO Comprador;
     aCod = #3#7;
     aNom = #24#1; |QBF aNom;
     aDir = #24#8; |QBF aDir;
     aPob = #24#9; |QBF aPob;
     aCp = #24#183; |QBF aCp;
     aNif = #24#15; |QBF aNif;
     aPer = #24#36; |QBF aPer;
     aTlf = #24#17; |QBF aTlf;
     aFax = #24#18; |QBF aFax;
     aAlfa = "<COMPRADOR>";                                        |XGRABA nHandle, aAlfa;
     aAlfa = "<COD_INTERLOCUTOR>"  + aCod + "</COD_INTERLOCUTOR>"; |XGRABA nHandle, aAlfa;
     aAlfa = "<NOMBRE>"            + aNom + "</NOMBRE>";           |XGRABA nHandle, aAlfa;
     aAlfa = "<DIRECCION>"         + aDir + "</DIRECCION>";        |XGRABA nHandle, aAlfa;
     aAlfa = "<POBLACION>"         + aPob + "</POBLACION>";        |XGRABA nHandle, aAlfa;
     aAlfa = "<CP>"                + aCp  + "</CP>";               |XGRABA nHandle, aAlfa;
     aAlfa = "<NIF>"               + aNif + "</NIF>";              |XGRABA nHandle, aAlfa;
     aAlfa = "<PERSONA_CONTACTO>"  + aPer + "</PERSONA_CONTACTO>"; |XGRABA nHandle, aAlfa;
     aAlfa = "<TELEFONO>"          + aTlf + "</TELEFONO>";         |XGRABA nHandle, aAlfa;
     aAlfa = "<FAX>"               + aFax + "</FAX>";              |XGRABA nHandle, aAlfa;
     aAlfa = "</COMPRADOR>";                                       |XGRABA nHandle, aAlfa;
|FPRC;

|PROCESO Receptor;
     aCod = #3#3;
||     aNom = #134#3; |QBF aNom;
     aNom = #3#4; |QBF aNom;
     aDir = #24#5; |QBF aDir;
     aPob = #24#6; |QBF aPob;
     aCp = #24#182; |QBF aCp;
     aNif = #134#124; |QBF aNif;
     aPer = #24#36; |QBF aPer;
     aTlf = #24#17; |QBF aTlf;
     aFax = #24#18; |QBF aFax;
     aAlfa = "<RECEPTOR>";                                         |XGRABA nHandle, aAlfa;
     aAlfa = "<COD_INTERLOCUTOR>"  + aCod + "</COD_INTERLOCUTOR>"; |XGRABA nHandle, aAlfa;
     aAlfa = "<NOMBRE>"            + aNom + "</NOMBRE>";           |XGRABA nHandle, aAlfa;
     aAlfa = "<DIRECCION>"         + aDir + "</DIRECCION>";        |XGRABA nHandle, aAlfa;
     aAlfa = "<POBLACION>"         + aPob + "</POBLACION>";        |XGRABA nHandle, aAlfa;
     aAlfa = "<CP>"                + aCp  + "</CP>";               |XGRABA nHandle, aAlfa;
     aAlfa = "<PERSONA_CONTACTO>"  + aPer + "</PERSONA_CONTACTO>"; |XGRABA nHandle, aAlfa;
     aAlfa = "</RECEPTOR>";                                        |XGRABA nHandle, aAlfa;
|FPRC;

|PROCESO Cliente;
     ||aCod = #3#3;
     ||aNom = #3#4; |QBF aNom;
     aCod = #3#9;
     aNom = #3#10; |QBF aNom;
     aDir = #24#8; |QBF aDir;
     aPob = #24#9; |QBF aPob;
     aNif = #24#15; |QBF aNif;
     aPer = #24#36; |QBF aPer;
     aTlf = #24#17; |QBF aTlf;
     aFax = #24#18; |QBF aFac;

     aAlfa = "<CLIENTE>";                                           |XGRABA nHandle, aAlfa;
     aAlfa = "<COD_INTERLOCUTOR>"  + aCod  + "</COD_INTERLOCUTOR>"; |XGRABA nHandle, aAlfa;
     aAlfa = "<NOMBRE>"            + aNom  + "</NOMBRE>";           |XGRABA nHandle, aAlfa;
     aAlfa = "<DIRECCION>"         + aDir  + "</DIRECCION>";        |XGRABA nHandle, aAlfa;
     aAlfa = "<POBLACION>"         + aPob  + "</POBLACION>";        |XGRABA nHandle, aAlfa;
     aAlfa = "<CP>"                + #24#182 + "</CP>";             |XGRABA nHandle, aAlfa;
     aAlfa = "<NIF>"               + aNif + "</NIF>";               |XGRABA nHandle, aAlfa;
     aAlfa = "<PERSONA_CONTACTO>"  + aPer + "</PERSONA_CONTACTO>";  |XGRABA nHandle, aAlfa;
     aAlfa = "<TELEFONO>"          + aTlf + "</TELEFONO>";          |XGRABA nHandle, aAlfa;
     aAlfa = "<FAX>"               + aFax + "</FAX>";               |XGRABA nHandle, aAlfa;
     aAlfa = "</CLIENTE>";                                          |XGRABA nHandle, aAlfa;
|FPRC;

|PROCESO Destino;
     aCod = #3#1;
     aNom = #24#2; |QBF aNom;
     aDir = #24#5; |QBF aDir;
     aPob = #24#6; |QBF aPob;
     aNif = #24#15; |QBF aNif;
     aPer = #24#36; |QBF aPer;
     aTlf = #24#17; |QBF aTlf;
     aFax = #24#18; |QBF aFac;

     aAlfa = "<DESTINO>";                                          |XGRABA nHandle, aAlfa;
     aAlfa = "<COD_INTERLOCUTOR>"  + aCod + "</COD_INTERLOCUTOR>"; |XGRABA nHandle, aAlfa;
     aAlfa = "<NOMBRE>"            + aNom + "</NOMBRE>";           |XGRABA nHandle, aAlfa;
     aAlfa = "<DIRECCION>"         + aDir + "</DIRECCION>";        |XGRABA nHandle, aAlfa;
     aAlfa = "<POBLACION>"         + aPob + "</POBLACION>";        |XGRABA nHandle, aAlfa;
     aAlfa = "<CP>"                + aCp  + "</CP>";               |XGRABA nHandle, aAlfa;
     aAlfa = "<NIF>"               + aNif + "</NIF>";              |XGRABA nHandle, aAlfa;
     aAlfa = "<PERSONA_CONTACTO>"  + aPer + "</PERSONA_CONTACTO>"; |XGRABA nHandle, aAlfa;
     aAlfa = "<TELEFONO>"          + aTlf + "</TELEFONO>";         |XGRABA nHandle, aAlfa;
     aAlfa = "<FAX>"               + aFax + "</FAX>";              |XGRABA nHandle, aAlfa;
     aAlfa = "</DESTINO>";                                         |XGRABA nHandle, aAlfa;
|FPRC;

|PROCESO VencFac;
     aAlfa = "<DIVISA>EUR</DIVISA>";   |XGRABA nHandle, aAlfa;

     aAlfa = "<VENCFAC>";   |XGRABA nHandle, aAlfa;

     #133#4 = #134#49;
     #133#0 = #134#0;
     #133#1 = 1;
     |LEE 000#133];
     |PARA; |SI FSalida = 0; |Y #133#4 = #134#49; |Y #133#0 = #134#0; |HACIENDO;
          nNum = #133#2 * nAbo;
          aFec = (#133#3 % 704) + (#133#3 % 402) + (#133#3 % 102);
          aNume = nNum; |HAZ Punto2Coma;

          aAlfa = "<IMPORTE>"     + aNume +  "</IMPORTE>";      |XGRABA nHandle, aAlfa;
          aAlfa = "<VENCIMIENTO>" + aFec  +  "</VENCIMIENTO>"; |XGRABA nHandle, aAlfa;

          |LEE 000#133s;
     |SIGUE;

     aAlfa = "</VENCFAC>"; |XGRABA nHandle, aAlfa;
|FPRC;

|PROCESO ImpFac;
     aRecargo = "N";
     aAlfa = "<IMPFAC>"; |XGRABA nHandle, aAlfa;
     |PARA i = 0; |SI i [ 10; |HACIENDO i = i + 1;
          nBase = 0;
          |SI i = 0; aTipo = "EXT"; nBase = #134#47; nTasa = 0; nImpo = nBase; |FINSI;
          |SI i = 1; aTipo = "VAT"; nBase = #134#21; nTasa = #134#39; nImpo = #134#22; |FINSI;
          |SI i = 2; aTipo = "VAT"; nBase = #134#24; nTasa = #134#41; nImpo = #134#25; |FINSI;
          |SI i = 3; aTipo = "VAT"; nBase = #134#27; nTasa = #134#43; nImpo = #134#28; |FINSI;
          |SI i = 4; aTipo = "VAT"; nBase = #134#33; nTasa = #134#50; nImpo = #134#34; |FINSI;
          |SI i = 5; aTipo = "VAT"; nBase = #134#36; nTasa = #134#52; nImpo = #134#37; |FINSI;
          |SI i = 6; aTipo = "RE"; nBase = #134#21; nTasa = #134#40; nImpo = #134#23; |FINSI;
          |SI i = 7; aTipo = "RE"; nBase = #134#24; nTasa = #134#42; nImpo = #134#26; |FINSI;
          |SI i = 8; aTipo = "RE"; nBase = #134#27; nTasa = #134#44; nImpo = #134#54; |FINSI;
          |SI i = 9; aTipo = "RE"; nBase = #134#33; nTasa = #134#51; nImpo = #134#35; |FINSI;
          |SI i =10; aTipo = "RE"; nBase = #134#36; nTasa = #134#53; nImpo = #134#38; |FINSI;
          |SI nImpo ! 0;
               |SI aTipo = "EXT"; nImpo = 0; |FINSI;
               |SI i ] 6; aRecargo = "S"; |FINSI;
               nBase = nBase * nAbo;
               nImpo = nImpo * nAbo;
               aNume = nImpo; |HAZ Punto2Coma;
               aAlfa = "<BASE>"    + nBase + "</BASE>";    |XGRABA nHandle, aAlfa;
               aAlfa = "<TIPO>"    + aTipo + "</TIPO>";    |XGRABA nHandle, aAlfa;
               aAlfa = "<TASA>"    + nTasa + "</TASA>";    |XGRABA nHandle, aAlfa;
               aAlfa = "<IMPORTE>" + aNume + "</IMPORTE>"; |XGRABA nHandle, aAlfa;
          |FINSI;
     |SIGUE;
     aAlfa = "</IMPFAC>"; |XGRABA nHandle, aAlfa;
|FPRC;

|PROCESO CabFac;
     aAlfa = #134#49 + "/" + (("000000" + #134#0)%-106);
     |PINTA 2005, aAlfa;

     #3#0 = #134#2;
     |LEE 000#3=;
     |SI FSalida ! 0;
          aAlfa = "0000Cliente": + #134#2 + ", codigo EDI no definido...";
          |MENAV aAlfa;
          |ACABA;
     |FINSI;

     nBruto = 0;
     aPed = "";
     aSerAlb = ""; nNumAlb = 0; aObs2 = ""; aFecAlb = ""; aObs3 = "";
     |BUCLELIN 2 CuentaAlba #134;

     |DFICE aAlfa;
     aFic = aAlfa + Usuario;
     |XABRE "W", aFic, nHandle;
     |SI FSalida ! 0;
          |MENAV "0000Error al crear fichero..."; |ERROR10; |ACABA;
     |SINO;
          aAlfa= "<?xml version=" + &34 + "1.0" + &34 + " encoding=" + &34 + "iso-8859-1" + &34 + "?>";
          |XGRABA nHandle, aAlfa;
     |FINSI;

     aMoneda = #134#60;
     aDivisa = #134#58;
     |HAZ Divisas134;

     #24#0 = #134#2;
     |LEE 000#24=;
     |SI FSalida ! 0; |DDEFECTO #24; |FINSI;

     |SI #134#31 < 0;
          nAbo = -1;
          nNodo = 381;
     |SINO;
          nAbo = 1;
          nNodo = 380;
     |FINSI;
     |SI #134#57 = "S"; nNodo = 381; |FINSI;

     aFec = (#134#1 % 704) + (#134#1 % 402) + (#134#1 % 102);
     aAlb = ("00000000" + nNumAlb) % -108;
     aFac = ("00000000" + #134#0) % -108;

     aAlfa = "<CABECERA>";                             |XGRABA nHandle, aAlfa;
     aAlfa = "<NUMFAC>"       + aFac   + "</NUMFAC>";  |XGRABA nHandle, aAlfa;
     aAlfa = "<NODO>"         + nNodo  + "</NODO>";    |XGRABA nHandle, aAlfa;
     aAlfa = "<FECHA>"        + aFec   + "</FECHA>";   |XGRABA nHandle, aAlfa;
     aAlfa = "<FECHAEFE>"     +          "</FECHAEFE>";|XGRABA nHandle, aAlfa;
     aAlfa = "<FECHADOC>"     + aFec   + "</FECHADOC>";|XGRABA nHandle, aAlfa;
     aAlfa = "<FPAG>"         +          "</FPAG>";    |XGRABA nHandle, aAlfa;
     |SI nAbo = -1;
          aAlfa = "<RAZON>1A</RAZON>";                     |XGRABA nHandle, aAlfa;
          aAlfa = "<NFACSUS>" + aObs3 + "</NFACSUS>";    |XGRABA nHandle, aAlfa;
     |SINO;
          aAlfa = "<PEDIDO>"       + aObs2  + "</PEDIDO>";  |XGRABA nHandle, aAlfa;
          aAlfa = "<ALBARAN>"      + aAlb   + "</ALBARAN>"; |XGRABA nHandle, aAlfa;
          aAlfa = "<FECALB>"      + aFecAlb + "</FECALB>"; |XGRABA nHandle, aAlfa;
     |FINSI;

     |HAZ Origen;
     |HAZ VenDedor;
     |HAZ Emisor;
     |HAZ Pagador;
     |HAZ Cobrador;
     |HAZ Comprador;
     |HAZ Receptor;
     |HAZ Cliente;
     |HAZ Destino;
     |HAZ VencFac;

     nBruto = (nBruto * nAbo) ! 2;
     nNeto = (#134#18 * nAbo) ! 2;
     nDto = (#134#17 * nAbo) ! 2;
     nBase = ((#134#47 + #134#21 + #134#24 + #134#27 + #134#33 + #134#36) * nAbo) ! 2;
     nImp = ((#134#29 + #134#30) * nAbo) ! 2;
     nTota = (#134#31 * nAbo) ! 2;
     nVerde = (#134#123 * nAbo) ! 2;

     aAlfa = "<SUMBRUTO>"          + nBruto + "</SUMBRUTO>"; |XGRABA nHandle, aAlfa;
     aAlfa = "<SUMNETOS>"          + nNeto  + "</SUMNETOS>"; |XGRABA nHandle, aAlfa;
     aAlfa = "<CARGOS>"            + 0      + "</CARGOS>";   |XGRABA nHandle, aAlfa;
     aAlfa = "<DESCUEN>"           + nDto   + "</DESCUEN>";  |XGRABA nHandle, aAlfa;
     aAlfa = "<BASIMPFA>"          + nBase  + "</BASIMPFA>"; |XGRABA nHandle, aAlfa;
     aAlfa = "<TOTIMP>"            + nImp   + "</TOTIMP>";   |XGRABA nHandle, aAlfa;
     aAlfa = "<TOTAL>"             + nTota  + "</TOTAL>";    |XGRABA nHandle, aAlfa;

     |HAZ ImpFac;

     aAlfa = "<TPVERDE>"           + nVerde + "</TPVERDE>";  |XGRABA nHandle, aAlfa;

     |BUCLELIN 2 LinFac #134;

     aAlfa = "</CABECERA>";   |XGRABA nHandle, aAlfa;

     |XCIERRA nHandle;
     aAlfa = "Factura_" + #134#49 + (("000000" + #134#0) % -106) + ".xml";
     |QBT aAlfa;
     aAlfa = aPath + aAlfa;

     aIP = "";
     |IP_REMOTO aIP;

     |SI aIP = "";
          |COPIA_FICHERO aFic, aAlfa;
     |SINO;
          |ENVIA_FICHERO aFic, aAlfa;
     |FINSI;
|FPRC;

|DEFBUCLE Facturas;
     #134#1;
     1;
     #0#0, #0#2, #0#4;
     #0#1, #0#3, #0#5;
     ;
     NULL, CabFac;
|FIN;

|PROCESO T3; |TIPO 3;
     aPath = #0#6; |QBF aPath;
     aAlfa = aPath % -101;
     |SI aAlfa ! "/"; |Y aAlfa ! "\"; aPath = aPath + "/"; |FINSI;

     |ABRE #2; |LEE 000#2p; |CIERRA #2;

     |ABRE #3;
     |ABRE #10;
     |ABRE #19;
     |ABRE #24;
     |ABRE #133;
     |BUCLE Facturas;
     |CIERRA #133;
     |CIERRA #24;
     |CIERRA #19;
     |CIERRA #10;
     |CIERRA #3;
|FPRC;

|PROCESO Fichero; |TIPO 0;
     |SI FSalida = 10;
          aAlfa = "D*.*";
          |BROWSE aAlfa;

          aAlfa = aAlfa % 2; |QBF aAlfa;
          |SI aAlfa = "D"; aAlfa = ""; |FINSI;

          |QBF aAlfa;
          |SI aAlfa = "";
               |ERROR;
          |SINO;
               #0#6 = aAlfa; |PINTA #0#6;
               |ERROR;
          |FINSI;
     |FINSI;
|FPRC;

|PROGRAMA;
     |ABRE #0;
     |LEE 101#0p;
     |SI FSalida ! 0; |GRABA 020#0b; |FINSI;
     |PINPA #0#0;
     |PINDA #0#0;
     |ENDATOS #1#0;
     |SI FSalida = 0; |GRABA 020#0a; |FINSI;
     |CIERRA #0;
|FPRO;
