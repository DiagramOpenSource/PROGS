
 COMPROBAR QUE SOLO SE LLAMA desd aqui (agifa050)


                   Lineas de Ordenes de fabricacion

|FICHEROS;
      agifa090 #0;
      agifa074 #1;
      agifa019 #2;  || Fichero de Articulos
      agifa017 #3;
      agifa048 #4;
      agifa049 #5;
      dsm00052 #52;
|FIN;

|VARIABLES;
     &aModulo = "agifa090";

     &n_dec = 2;

     cantidad = 0;

     npiezest = 1;

     tmppiezs =""
     nn = 0;
     nSubLin = 0;
|FIN;

|CAMPOS;
     ||lineas orden fab
      #1#2   ordesca    ;      #1#7   ordalma2   ;
      #1#4   ordcanti   ;

     ||articulo
      #2#0   artcodig   ;      #2#13  artfabri   ;
      #2#15  artpeser   ;      #2#12  artreser   ;
      #2#17  artpeval   ;      #2#104 artdispo   ;
      #2#7   artminim   ;      #2#11  artneces   ;
      #2#6   artstock   ;

     ||Almacen
      #3#0   artilin    ;      #3#1   almalin    ;
      #3#8   reselin    ;      #3#9   sfablin    ;
      #3#39  displin    ;      #3#5   stl        ;

     ||Linea escandallo
      #4#0   escodigo   ;      #4#10  escalma    ;
      #4#12  npiezs    ;

     ||Escandallo
      #5#0   linesca    ;      #5#2   linartic   ;
      #5#4   lincanti   ;      #5#9   linalmac   ;
|FIN;


|CALCULO npiezs;|TIPO 7;
     |ABRE #4;
     escodigo = ordesca;
     |LEE 101#4=;
     |SI 0 = FSalida;
         |SI npiezs = 0;
             npiezs = 1;
         |FINSI;
         npiezest = npiezs * ordcanti;
         tmppiezs = "0000El número total de piezas estimado son: " + npiezest + " piezas.";
         |MENAV tmppiezs;
     |FINSI;
     |CIERRA #4;
|FCAL;

|PROCESO decim074;
     #1#4 = #1#4 ! n_dec;
     |PINTA #1#4;
|FPRC;



|CALCULO ordartic;|TIPO 2;
#agifa074#8 = #agifa090#2;
|ABRE #2;
|ABRE #3;
artcodig = ordesca  ;
|LEE 101#2=;
|SI 0 = FSalida;
     |SI aModulo = "agifa050";
          #agifa074#3 = #agifa019#1;
     |FINSI;
     artilin  =  ordesca  ;
     almalin  =  ordalma2 ;
     |LEE 101#3=;
     |SI 0 = FSalida;
               |ABRE #4;
               escodigo = ordesca;
               |LEE 101#4=;   ||Lee npiezs en baja.
               |CIERRA #4;
           artfabri = artfabri +.  (ordcanti * npiezs);
           artneces = artneces -.  (ordcanti * npiezs);
           sfablin  =  sfablin +.  (ordcanti * npiezs);
           |SI artneces < 0; artneces = 0; |FINSI;
        |GRABA 101#3a;
        |GRABA 101#2a;
     |FINSI;
     |LIBERA #3;
|FINSI;
|LIBERA #2;
nSubLin = 0;
|ABRE #4;
|ABRE #5;
escodigo = ordesca;
|LEE 101#4=;
|SI 0 = FSalida;
linesca = escodigo;
   |PARA #5#1 = 0 ;|SI 0 = FSalida;|Y linesca = escodigo; |HACIENDO ;
      |LEE 000#5>;
      |SI 0 = FSalida;|Y linesca = escodigo;
         artcodig = linartic;
         |LEE 101#2=;
         |SI 0 = FSalida;
          |DDEFECTO #3;
            artilin = linartic;
            almalin = linalmac
            |LEE 101#3=;
            |SI 0 = FSalida;
               cantidad = ordcanti * lincanti;
               artreser = artreser +. cantidad;
          ||     artpeser = artpeser +. cantidad;  ||Carlos
               artneces = artneces +. cantidad;
               displin  = displin  -. cantidad;
               reselin  = reselin  +. cantidad;
               artdispo = artdispo -. cantidad;
               |SI artneces < 0; artneces = 0; |FINSI;
               |GRABA 101#3a;
               |GRABA 101#2a;
            |SINO;
               cantidad = ordcanti * lincanti;
               artreser = artreser +. cantidad;
           ||    artpeser = artpeser +. cantidad;   ||Carlos
               artneces = artneces +. cantidad;
               displin  = displin  -. cantidad;
               reselin  = reselin  +. cantidad;
               artdispo = artdispo -. cantidad;
               |SI artneces < 0; artneces = 0; |FINSI;
               |GRABA 101#3n;
               |GRABA 101#2a;

            |FINSI;
            |LIBERA #3;
            nSubLin = nSubLin + 1;
            |ABRE #52;
            |DDEFECTO #52;
            #52#0 = #1#0;
            #52#1 = #1#1;
            #52#2 = nSubLin;
            #52#3 = #2#0;
            #52#4 = cantidad;
            #52#5 = #5#9;
            |GRABA 020#52n;
            |CIERRA #52;
         |FINSI;
         |LIBERA #2;
      |FINSI;
   |SIGUE;
|FINSI;
|LIBERA #4;
|CIERRA #5;
|CIERRA #4;
|CIERRA #3;
|CIERRA #2;
|FCAL;
