|FICHEROS;
     agifa146 #0;
     agifa024 #6;
     agifa147 #3;
     agifa019 #2;
     agifa025 #8;
     agifa038 #13;
     agifa048 #15;
     agifa049 #16;
     agifa007 #40;
     agifa142 #41;
     agifa321 #35;  || Parametros de Divisas
     agifa328 #36;  || Clientes/Divisas
     agifa329 #37;  || Lineas de Clientes/Divisas
     agifa324 #38;  || Divisas
     dsm00003 #49,MANTE;
     agifa104 #104;
     dsm00134 #134;
     dsm00247 #141;
     dsm00248 #143; ||Auditoria.
     dsm00279 #279;
     referen@;
     referen1@;
     referen2@;
     referen3@;
|FIN;

|INCLUYE i_varart;

|VARIABLES;
     &eaNonDni = "";
     &eaDomiDni = "";
     &eaCPDni = "";
     &eaPobDni = "";
     &eaPrvDni = "";
     &eaTlfDni = "";
     &eaFacDni = "";
     &eaPaisDni = "";

     &eaFP = "";
     &eaBloquea = "";
     nSwTagloma = 0;
     nBtnItemDocPed = -1;
     nBtnWorkFlow = -1;
     &Tempo = "";
     &eaTmpPR816 = "";
     nForma = 0;
     nBoton = 0;
     &enMod146 = 0;

     &nRieUtili = 0;
     &nRieTotal = 0;
     nConAu = 0;
     &nMasRies  = 0;
     &eaTag = "";
 {-1}aMenu = "";
     aMenu1 = "2400";
     aMenu2 = "1";
     aMenu3 = "Opciones: ";
     aMenu4 = "IH";
     aMenu5 = " Imprimir ";
     aMenu6 = " Historico ";
     aMenu7 = " Pasar a Pedido ";  || solo taglomas

     aTieneLin = "N";
     aSinError = "";
     nSal = 0;
     aDef = "";
     aSql = "";
     aUsu = "";
     nContaLog = 0;
     aSer = "";
     aNum = "";
     aTipo = "";
     nTipo = 0;
     nModo = 0;
     nLin = 0;
     nResto = 0;
     nUniPromo = 0;
     &uni_dt = 0;   || Unidades
     &uni_dt2 = 0;   || Unidades2
     &fed_dt = @;   || Fecha....
     &art_dt = "";  || Articulo.
     &cli_dt = "";  || Cliente..
     &fam_dt = "";  || Familia.
     &iva_dt = 0;   || Tipo Iva.
     &dtos_2 = 0;   || Descuento 2.
     &dto_pt = 0;   || Descuento Ptas.
     &dtos_1 = 0;   || Descuento 1.
     &pvp_ve = 0;   || Precio Venta.
     &tarifa = 0;   || Tarifa Cliente.
     &quedto = 0;   || 1=cli./art, 2=cli./familia, 3=cli./subfam.
     &gru_dt = "";  || Grupo Cliente.
     &nPromo = 0;
     &enMensaje = 0;
     &aParam    = "";
     &enModo146 = 0;
     &eaCodCliente = "";
     &eaNomCliente = "";
     aAlfa = "";
     nPos         = 0;
     &cli            = "";
     &ser            = "";
     nTecla          = 0;
     &eaCodigo       = "";
     &eaTipoCodigo   = "CL";

     &nDeci_Base     = 0;   || Decimales en Totales de la moneda base
     &nDeci_PreBase  = 0;   || Decimales en el Precio en moneda base
     &nDeci_BaseMx   = 0;   || Decimales en Totales de la moneda base (Maxima precision)
     &nDeci_PreBaseMx= 0;   || Decimales en el Precio en moneda base (Maxima precision)
     &nDeci_Div      = 0;   || Decimales en Totales de la divisa
     &nDeci_PreDiv   = 0;   || Decimales en el Precio en divisa
     &nDeci_TotVis   = 0;   || Decimales en Totales visibles (el de la moneda de trabajo)
     &nDeci_TotNoVis = 0;   || Decimales en Totales no visibles (el de la otra moneda)
     &nDeci_PreVis   = 0;   || Decimales en el Precio visual. (lineas)
     &nDeci_ImpVis   = 0;   || Decimales en el Importe visual. (lineas)
     nfecha    = 0;
     &ac_divisa = "N";   || Vale "S" cuando las divisas en ventas estan
                         || activadas y la serie es de divisas
     &pintado = 0;       || Sirve para controlar los pintados de las lineas
     &decim_divisa = 0;  || Decimales de la divisa
     &precio_divisa = 0; || Decimales del precio en divisa
     &decim_base = 0;    || Decimales de la moneda base
     &precio_base = 0;   || Decimales del precio en moneda base
     div_act = 0;        || Divisa actualizada. Me sirve en un PARA para que
                         || no salga hasta que este actualizada (div_act=1)
     &cli_divisa = "";   || Codigo de Cliente. Se pasa a CLIENTES/DIVISAS
     &divisa = "";       || Codigo de Divisa. Se pasa a ACTUAL. de DIVISAS
     &nModo146 = 0;
     &numero = 0;
     &serie  = "";
     &reimpr = "";
     importe = 0;

     imneto = 0;
     tf = 0;
     retencion = 0;
     con = 0;
     margen = 0;
     indtope = 0;
     ind = 0;
     control = 0;
     mensaje01 = "0423Actualizando linea:";
     fmes = "  ";
     mes = 0;
     mensajei  = "2400NDesea imprimir esta factura ?";
     informe = "";
     informe1 = "agifa146";
     &iva1 = 0;&iva2 = 0;&iva3 = 0;&re1 = 0;&re2 = 0;&re3 = 0;
     &iva4 = 0;&iva5 = 0;&re4 = 0;&re5 = 0;
     &codigo="";
     &descrip="";
     &precio=0;
     &dto=0;
     &dto1=0;
     &unid=0;
     &imptot=0;
     &tiva=0;
     &linea=0;
     vacio="";
     modo = 0;
     &n_dec = 0;
     &n_pre = 0;
     &bl  = "                              ";
     &def_alm = 0;
     &def_exp = "N";
     iva_ant   = 0;
     contenido = 0;
     &codiBarra = "";
     recalpre = 0;
     caltot = 0;
     nImpDiv = 0;

     aNifQbf1   = "";
     aNifQbf2   = "";

     &eaVarDni  = "";
     &enCalcCif = 0;
     nError = 0;
|FIN;

|CAMPOS;
  #0#41 totfa;
|FIN;

컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO CalculaNif;
     nSal = FSalida;

     |ABRE #6;
     #6#0 = #0#3;
     |LEE 000#6=;
     |CIERRA #6;
     eaPais = #6#205;

     |SI nSal = 9;
         eaVarDni   = #0Campo;
         enCalcCif  = 1;
         |HAZ CalculoNIFCIF;
         #0Campo = eaVarDni;
         |PINTA #0Campo;
         |ERROR;
         |ACABA;
     |FINSI;

     |HAZ EsTagloma;
     |SI FSalida = 0; |HAZ NifTaglo146; |ACABA; |FINSI;

     eaVarDni  = #0Campo;
     enCalcCif = 0;
     |HAZ CalculoNIFCIF;

     aNifQbf1 = #0Campo;   |QBF aNifQbf1;
     aNifQbf2 = eaVarDni;  |QBF aNifQbf2;

     |SI aNifQbf1 ! aNifQbf2; |Y aNifQbf1 ! "";
         |CONFI "0000SEl Nif puede ser Erroneo. Desea Calcularlo.";
         |SI FSalida = 0;
             #0Campo = eaVarDni;  |PINTA #0Campo;
             |ERROR;
         |FINSI;
     |FINSI;
|FPRC;

|CALCULO fcporte;|TIPO 0;
     imneto = #0#11 - Contenido;
     |SI #0#11 ! Contenido; control = 1; |FINSI;
|FCAL;

|CALCULO fcvario;|TIPO 0;
     imneto = #0#13 - Contenido
     |SI #0#13 ! Contenido; control = 1; |FINSI;
|FCAL;

|CALCULO cogecon0;|TIPO 0;
control = 0;
|FCAL;

|CALCULO pedcon0;|TIPO 6;
con = FEntrada / 100;
con = con ! 0;
|SI con = 2;|Y #0Campo ! Contenido;
  control = 1;
|FINSI;
|FCAL;

|CALCULO acttl;|TIPO 0;
     |SI caltot = 0;
          |PINTA 445,#3#1;
          #3#15 = #0#3;
          #3#16 = #0#34;
          #3#17 = #0#35;
          |GRABA 020#3a;
     |SINO;
          |SI recalpre = 1;
               |HAZ TotalLin147;
               |GRABA 001#3a;
          |FINSI;
     |FINSI;

     |HAZ CalCabAgifa146;
|FCAL;

|DEFBUCLE agifa147;
     #3#1;
     ;
     #0#48, #0#0, 001;
     #0#48, #0#0, 999;
     ;
     NULL, acttl;
|FIN;

|CALCULO actal;
     |HAZ LimCabAgifa146;
     |BUCLE agifa147;
|FCAL;

|PROCESO TieneLin146;
     aTieneLin = "S";
|FPRC;

|CALCULO siimpre;|TIPO 3;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 4; |ACABA; |FINSI;

     aTieneLin = "N";
     |BUCLELIN 2 TieneLin146 #0;
     |SI aTieneLin = "N";
          |BORRA 020#0c;
          |ERROR; |ACABA;
     |FINSI;

     |HAZ actal;

     ||컴컴컴컴컴컴컴컴컴컴Modulo 000323
     |HAZ EsTecatel;
     |SI FSalida = 0;
          eaSer = #0#48;
          enDocu = #0#0;
          eaCodigo = #0#3;
          eaTipo = "RE";
          |HAZ TecaTrans;
     |FINSI;
     ||컴컴컴컴컴컴컴컴컴컴컴
     |CONFI mensajei;
     |SI 0 = FSalida; |HAZ impreal; |FINSI;
|FCAL;

|CALCULO impreal;
     modo = (FEntrada / 100) ! 0;
     |SI modo = 1; |O modo = 2;
          |GRABA 000#0a;
          |SI FSalida ! 0; |ACABA; |FINSI;
          |LIBERA #0;
     |FINSI;
     |CIERRAT #0;

     serie = #0#48;
     numero = #0#0;
     reimpr = #0#10;
     |SUB_EJECUTA_NP "agifa150";
     #0#10 = "S";
     |PINTA #0#10;

     |ABRET #0;
     #0#48 = serie;
     #0#0 = numero;
     |SI modo = 4;
          |LEE 000#0=;
     |SINO;
          |LEE 101#0=;
     |FINSI;
|FCAL;

|PROCESO mira_d;
     |ABRE #41; |LEE 001#41p; |CIERRA #41;
     n_dec = #41#8;
     n_pre = #41#9;
     codiBarra = #41#56; || El mismo que la Factura
     |ABRE #agifa007;
     #agifa007#26 = #agifa146#48;
     |LEE 001#agifa007.=;
     |SI FSalida ! 0; |DDEFECTO #agifa007; |FINSI;
     |CIERRA #agifa007;
     def_alm = #agifa007#29;
     def_exp = #agifa007#30;
     |HAZ LeeMonBase;
     |HAZ LeeParamDiv;
     ||----------------Aplica S -> Tarifa normal N-> con dtos y promociones
     #0#79 = #41#171;
|FPRC;

|PROCESO LeeMonBase; ||Lee los parametros de la moneda base
     |ABRE #agifa321;
     |ABRE #agifa324;
     |LEE 010#agifa321.p;   ||Leo parametros de divisa
     #agifa146#68 = #agifa321#9;  ||Cojo la Moneda Base de parametros
     #agifa324#0 = #agifa321#9;
     |LEE 010#agifa324.=;         ||Leo la ficha de la moneda base en Divisas
     #agifa146#69 = #agifa324#2;  ||Asigno el cambio de la moneda base con el euro
     decim_base = #agifa324#7;    ||Asigno los decimales de la moneda base
     precio_base = #agifa324#9;   ||Asigno los decimales del precio en la mon. base
     |CIERRA #agifa324;
     |CIERRA #agifa321;
|FPRC;

|PROCESO Param_Divisas; |TIPO 0;
     |ABRE #agifa324;
     pintado = 0;  ||Controla pintados de las lineas
     #agifa324#0 = #agifa146#65;
     |LEE 001#agifa324.=;   || Leo la divisa
     |CIERRA #agifa324;

     decim_divisa = #agifa324#7;  || Decimales de la divisa
     precio_divisa = #agifa324#9;  || Decimales en el precio de la divisa
     nDeci_Div = decim_divisa;   || Decimales de la divisa
     nDeci_PreDiv = precio_divisa;  || Decimales en el precio de la divisa
     |SI #0#67 = "B";   || Si trabajo con la moneda base ...
          nDeci_PreVis   = precio_divisa;
          nDeci_ImpVis   = decim_divisa;
          nDeci_Base     = decim_base;
          nDeci_PreBase  = precio_base;
          nDeci_BaseMx  = decim_base;
          nDeci_PreBaseMx = precio_base;
          nDeci_TotVis   = decim_base;
          nDeci_TotNoVis = decim_divisa;
     |SINO;     || Si trabajo con la divisa ...
          nDeci_PreVis   = precio_base;
          nDeci_ImpVis   = decim_base;
          nDeci_Base     = decim_base;     || Max. precision en los decimales de la moneda base
          nDeci_PreBase  = precio_base;    || Max. precision en los dec. del precio de la moneda base
          nDeci_BaseMx    = #agifa321#10;  || Max. precision en los decimales de la moneda base
          nDeci_PreBaseMx = #agifa321#11;  || Max. precision en los dec. del precio de la moneda base
          nDeci_TotVis   = decim_divisa;
          nDeci_TotNoVis = decim_base;
     |FINSI;
     |HAZ Deci_IVA;
|FPRC;

|PROCESO LeeParamDiv; |TIPO 0;
     |ABRE #agifa321;
     |LEE 001#agifa321.p;    || Leo parametros de divisas
     |CIERRA #agifa321;

     |ABRE #agifa007;
     #agifa007#26 = #agifa146#48;
     |LEE 001#agifa007.=;        || Leo la serie
     |CIERRA #agifa007;

     |SI #agifa007#39 = "N"; |O #agifa321#1 = "N";
          #0#67 = "B";
     |FINSI;

     |SI #0#67 = "D";      || Si la mon. de trabajo es la divisa...
          || ...escondo los campos de la moneda base :
          |C_P #3#6 , 1 , 1011;
          |C_P #3#9 , 1 ,1026;
          |C_V #3#6 , 1 , "N";
          |C_V #3#9 , 1 , "N";
          |C_L #3#6 , 1 , "N";
          |C_L #3#9 , 1 , "N";
          |C_M #3#6 , 1 , "N";
          || ...y pongo en pantalla los de divisa
          |C_P #3#24 , 1 , 1544;
          |C_P #3#25 , 1 ,1568;
          |C_V #3#24 , 1 , "S";
          |C_V #3#25 , 1 , "S";
          |C_M #3#24 , 1 , "S";
          |C_L #3#24 , 1 , "S";
          |C_L #3#25 , 1 , "S";
          |SI #agifa007#39 = "S"; |Y #agifa321#1 = "S"; ||Si la serie es de ...
               ac_divisa = "S";  || ... divisas, y en parametros estan activadas ...
               || ... pongo como modificables los campos relacionados con divisas
               |C_M #0#65 , 1 , "S";
               |C_M #0#66 , 1 , "S";
               |C_M #0#67 , 1 , "S";
               |SI #agifa321#3 = "S";  || Si la visualizacion de parametros esta activada
                    || ... pongo los campos visual. de lineas como visualizables
                    |C_V #3#26, 1 , "S";
                    |C_V #3#27 , 1 , "S";
               |SINO;
                    || ... los pongo como no visualizables
                    |C_V #3#26 , 1 , "N";
                    |C_V #3#27 , 1 , "N";
               |FINSI;
          |SINO; || Si la serie no es de divisas, o no estan activados parametros
               ac_divisa = "N";
               #0#67 = "B";  || La moneda de trabajo es por fuerza la moneda base
               |PINTA #0#67;
               || Pongo como no modificables los campos relacionados con divisas
               |C_M #0#65 , 1 , "N";
               |C_M #0#66 , 1 , "N";
               |C_M #0#67 , 1 , "N";
               || Pongo como no visualizables los campos visual. de lineas
               |C_V #3#26, 1 , "N";
               |C_V #3#27, 1 , "N";
          |FINSI;
     |SINO;  || Si la moneda de trabajo es la moneda base
          || ...escondo los campos en divisa :
          |C_P #3#24 , 1 , 1011;
          |C_P #3#25 , 1 ,1026;
          |C_V #3#24 , 1 , "N";
          |C_V #3#25 , 1 , "N";
          |C_M #3#24 , 1 , "N";
          |C_L #3#24 , 1 , "N";
          |C_L #3#25 , 1 , "N";
          || ...coloco los campos en moneda base:
          |C_P #3#6 , 1 , 1544;
          |C_P #3#9 , 1 ,1568;
          |C_V #3#6 , 1 , "S";
          |C_V #3#9 , 1 , "S";
          |C_M #3#6 , 1 , "S";
          |C_L #3#6 , 1 , "S";
          |C_L #3#9 , 1 , "S";
          |SI #agifa007#39 = "S"; |Y #agifa321#1 = "S"; || Si la serie es de divisas...
               ac_divisa = "S"; || ... y divisas estan activadas en parametros
               || Pongo como modificables los campos relacionados con divisas
               |C_M #0#65 , 1 , "S";
               |C_M #0#66 , 1 , "S";
               |C_M #0#67 , 1 , "S";
               |SI #agifa321#3 = "S";  || Si la visualizacion esta activada en parametros ...
                    || Pongo como visualizables los campos visual. de las lineas
                    |C_V #3#26, 1 , "S";
                    |C_V #3#27 , 1 , "S";
               |SINO; || Los pongo como no visualizables
                    |C_V #3#26 , 1 , "N";
                    |C_V #3#27 , 1 , "N";
               |FINSI;
          |SINO;  || Si la serie no es de divisas o no estan activados los parametros
               ac_divisa = "N";
               #0#67 = "B";  || La moneda de trabajo es por fuerza la moneda base
               || Pongo como no modificables los campos relacionados con divisas
               |C_M #0#65 , 1 , "N";
               |C_M #0#66 , 1 , "N";
               |C_M #0#67 , 1 , "N";
               || Pongo como no visualizables los campos visual. de lineas
               |C_V #3#26, 1 , "N";
               |C_V #3#27, 1 , "N";
          |FINSI;
     |FINSI;
     ||컴컴컴컴Portes/Varios
     |C_P #0#76, 0, nPos; |C_P #0#11, 1, nPos;
     |C_P #0#77, 0, nPos; |C_P #0#13, 1, nPos;
     |C_V #0#11, 1, "N";
     |C_V #0#13, 1, "N";
     |C_V #0#76, 1, "N";
     |C_V #0#77, 1, "N";
     |SI #0#67 = "D";
          |C_V #0#76, 1, "S";
          |C_V #0#77, 1, "S";
     |SINO;
          |C_V #0#11, 1, "S";
          |C_V #0#13, 1, "S";
     |FINSI;
     |HAZ Param_Divisas;
|FPRC;

|PROCESO CambioDivisa; |TIPO 0;
nModo146 = (FEntrada / 100) ! 0;
|SI #0#3 = "      ";
 #0#3 = "";
 Contenido = "      ";
|FINSI;
|SI nModo146 = 1;  ||Si es alta
  |SI Campo = 3; || Si llamo al proceso desde el cod. de cliente ...
    |ABRE #agifa024;
    #agifa024#0 = #0#3;
    |LEE 001#agifa024.=;
    #0#65 = #agifa024#192;  || Asigno la divisa por defecto del cliente
    #0#67 = #agifa024#193;  || Asigno la moneda de trabajo del cliente
    |PINTA #0#67;
  |FINSI;
  #agifa007#26 = #agifa146#48;
  |LEE 001#agifa007.=;  || Leo la serie
   |SI #agifa007#39 = "S"; |Y #agifa321#1 = "S";
      |SI #agifa024#191 = "S"; || Si el cliente es de divisa pactada
         |ABRE #agifa328;
         |ABRE #agifa329;
         #agifa329#0 = #0#3;
         #agifa329#2 = #agifa146#65;
         #agifa329#7 = "N";
         |SELECT #2#agifa329;  || Con esta clave ...
         |LEE 011#agifa329.=;  || ... busco periodos no finalizados de esa divisa
         |SI FSalida = 0;  || Si existe un periodo no finalizado
           |PARA div_act = 0; |SI div_act = 0; |HACIENDO;
             #agifa146#65 = #agifa329#2;        || Cargo la divisa ...
             #agifa146#66 = #agifa329#3;        || ...y el cambio
             |LEE 001#agifa329.=;   || Leo las lineas de Clientes/Divisas
             nfecha = #0#1 - #agifa329#6;  || Resto la fecha de fin de periodo a la actual
             |SI nfecha > 0;  || Si la fecha actual supera a la del periodo asignado ...
                |MENAV "0000ATENCION deberia Actualizar primero la divisa en Clientes/Divisas";
                cli_divisa = #0#3;  || Le envio el cod. de cliente a "agifa328"
                |SUB_EJECUTA_NP "agifa328.tab";  || Ejecuto Clientess/Divisas
                |ERROR;
             |SINO;
                div_act = 1;  || Para salir del PARA
             |FINSI;
           |SIGUE;
         |SINO;  || Si no existe un periodo no finalizado para esa divisa
           |MENAV "0000No existe un periodo activo para la divisa en Clientes / Divisas";
           cli_divisa = #0#3;  || Le paso a "agifa328" el cliente
           |SUB_EJECUTA_NP "agifa328.tab";  || Ejecuto Clientes / Divisas
           |ERROR;
           ||#agifa146#65 = #agifa146#68;
           ||#agifa146#66 = #agifa146#69;
         |FINSI;
         |SELECT #1#agifa329;
         |CIERRA #agifa329;
         |CIERRA #agifa328;
      |SINO; || Si el Cliente no es de Divisa pactada ...
         |ABRE #agifa324; || ...miro directamente en divisas
         #agifa324#0 = #agifa146#65;
         |LEE 001#agifa324.=;
         |SI FSalida = 0; ||Si existe la divisa...
            #agifa146#66 = #agifa324#2; || la recojo
            |SI #agifa324#5 ! -1; || Si los dias de margen de actualizacion no
                                  || son = -1 (indefinidos)
              |PARA div_act = 0; |SI div_act = 0; |HACIENDO;
                 #agifa146#65 = #agifa324#0;        ||Cargo el valor de la divisa
                 #agifa146#66 = #agifa324#2;        ||Cargo el valor del cambio
                 |LEE 001#agifa324.=;  || Leo la divisa
                 nfecha = #0#1 - #agifa324#4;
                 |SI nfecha > #agifa324#5; |Y #agifa324#5 ! -1;  || Si la fecha actual
                    |MENAV "0000ATENCION deberia Actualizar primero la divisa";
                    divisa = #agifa146#65;
                    |SUB_EJECUTA_NP "agifa326.tab";
                    |ERROR;
                 |SINO;
                    div_act = 1;
                 |FINSI;
              |SIGUE;
            |FINSI;
         |FINSI;
         |CIERRA #agifa324;
       |FINSI;
     |CIERRA #agifa024;
     |SINO;
       #agifa146#65 = #agifa146#68;
       #agifa146#66 = #agifa146#69;
     |FINSI;
  |PINTA #agifa146#65;
  |PINTA #agifa146#66;
  |SI Campo = 3; || Si llamo al proceso desde el cod. de cliente ...
    |HAZ LeeParamDiv;
  |SINO;
    |HAZ Param_Divisas;
  |FINSI;
|FINSI;
|FPRC;

|PROCESO convportes; |TIPO 6;
     |SI #0#67 = "D";
          #0#11 = #0#76 / #0#66 * #0#69;
     |SINO;
          #0#76 = #0#11 * #0#66 / #0#69;
     |FINSI;
     |HAZ fcporte;
|FPRC;

|PROCESO convvarios; |TIPO 6;
     |SI #0#67 = "D";
          #0#13 = #0#77 / #0#66 * #0#69;
     |SINO;
          #0#77 = #0#13 * #0#66 / #0#69;
     |FINSI;
     |HAZ fcvario;
|FPRC;


|PROCESO LeeFac; |TIPO 13;  || Sirve para cargar los valores cada vez que
                            || cambio de ficha
     pintado = 0;   || controla pintado de las lineas
     |HAZ LeeMonBase;
     |HAZ LeeParamDiv;
     |HAZ PinTagloma146;
|FPRC;

|CALCULO modomod; |TIPO 6;
   |SI nModo146 = 2; |Y #0Campo ! Contenido;
       |MENAV "0000No se puede modificar el campo.";
       #0Campo = Contenido;
       |PINTA #0Campo;
       |ERROR;
   |FINSI;
   |SI #0Campo ! Contenido; |Y Campo = 67;
     |HAZ LeeParamDiv;
   |FINSI;
|FCAL;

|PROCESO caltotal; |TIPO 0; ||Proceso especial para casos determinados como
                            ||modificar los campos de cabecera en dtos, cambio divisas etc
                            ||Recalcula total factpro, descuentos y ivas de lineas
                            ||En el caso de cambiar el cambio de divisas recalcula tambien precio... de lineas
   |SI #0Campo ! Contenido;||Solo si cambia
          caltot = 1;
          |SI Campo = 66; ||Si viene del cambio divisa
              recalpre = 1; ||Recalcular tambien precios linea
          |FINSI;
          |HAZ convportes;
          |HAZ convvarios;
          |HAZ actal;

          |PINTA #0#73;
          caltot = 0;
          recalpre = 0;
   |FINSI;
|FPRC;


|PROCESO linf;
  #49#0 = #0#3;
  #49#1 = 1;
|FPRC;

|PROCESO lsup;
  #49#0 = #0#3;
  #49#1 = 9999;
|FPRC;

|PROCESO Dir146;  ||Direccion de entrega
     nTecla = FSalida;
     nModo146 = (FEntrada / 100) ! 0;
     |ABRE #6;
     #6#0 = #0#3;
     |LEE 000#6=;
     |CIERRA #6;

     |SI nTecla = 11; |O #41#102 = "S"; |O #41#102 = "X";
          eaCodigo = #0#3;
          eaFuerza = "N";
          |SI nTecla = 11; eaFuerza = "S"; |FINSI;
          |SUB_EJECUTA_NP "dsz99994";
          |SI #41#102 = "N"; |Y nModo146 ! 2; |ERROR;  |FINSI;
     |FINSI;
|FPRC;

|PROCESO ser66; |TIPO 0;              || VIC 20/07/98
     cli=#0#3;
     ser=#0#48;
     |SUB_EJECUTA_NP "agifv011.tab;por_ejemplo"
|FPRC;

|PROCESO Cli146_7; |TIPO 7;
     nModo = (FEntrada / 100) ! 0;
     |SI #279#24 = "S";
          |C_M #0#3, 1, "N";
          |SI nModo = 1;
               |SI eaSerCli ! ""; #0#3 = eaCliSer; |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Cli146_6; |TIPO 6;
     nModo = (FEntrada / 100) ! 0;
     |ABRE #6;
     #6#0 = #0#3;
     |LEE 000#6=;
     |CIERRA #6;
     |SI nModo = 1; |O #0Campo ! Contenido;
          #0#86 = #6#15; |PINTA #0#86;
          |ABRE #49;
          #49#0 = #0#3;
          #49#1 = #0#80;
          |LEE 000#49=;
          |CIERRA #49;
          |HAZ AsignaDir146;
     |FINSI;

     |HAZ CambioDivisa;

     |HAZ EsTagloma;
     |SI FSalida = 0;
          eaCliente = #0#3;
          |SUB_EJECUTA_NP "tagz0024";
     |FINSI;
|FPRC;

|PROCESO Cli146_0; |TIPO 0;
     nModo = (FEntrada / 100) ! 0;
     |SI #0Campo ! Contenido; |Y nModo = 2;
          |SI #41#250 = "S"; |HAZ ProModLin; |FINSI;
     |FINSI;
     |HAZ ObsCli146;
     |HAZ Dir146;
     |HAZ mira_d;
     |HAZ ser66;
     |HAZ Pago7_146;

|| RIESGO DE CLIENTE
     |HAZ EsInforAlba;
     |SI FSalida = 0;
        |HAZ Riesgo146;
     |SINO;
        |HAZ EsPrimicias;
        |SI FSalida = 0;
           |HAZ Riesgo146;
        |FINSI;
     |FINSI;

     |SI nModo = 1; |Y #6#28 = "S"; || Cliente Exporacion
          #0#12 = 0; |PINTA #0#12;
          #0#14 = 0; |PINTA #0#14;
     |FINSI;
|FPRC;

|PROCESO T146_2; |TIPO 2;
     enModo146 = (FEntrada / 100) ! 0;
     nForma = 0 +. 1;

     |SI #0#66 = 0; || chequea el cambio
          |ABRE #agifa324;
          #agifa324#0 = #0#65;
          |LEE 020#agifa324.=;
          |SI FSalida = 0;
               #0#66 = #agifa324#2;
          |FINSI;
          |CIERRA #agifa324;
     |FINSI;

     |SI enModo146 = 2; |O enModo146 = 3;
          |HAZ EsTagloma;
          |SI FSalida = 0;
               |SI #0#61 ! 0;
                    |SI nForma = -1;
                         |MENAV "0000Proforma pasada a pedido...";
                    |FINSI;
                    |ERROR; |ACABA;
               |FINSI;

               eaSerie = #0#48;
               enCodigo = #0#0;
               eaFP = #0#8;
               |SUB_EJECUTA_NP "tagz0030";
               |SI eaBloquea = "S";
                    |SI nForma = -1;
                         |MENAV "0000PROFORMA BLOQUEADA PAGO ANTICIPADO";
                    |FINSI;
                    |ERROR; |ACABA;
               |FINSI;
          |FINSI;
     |FINSI;


     |SI enModo146 = 2;
          |HAZ EsLegiplag;
          |SI FSalida = 0;
               nForma = 0 +. 1;
               |SI nForma = -1;
                    |ESTADO_CONTROL nBoton, "ENABLE";
               |SINO;
                    |ESTADO_CONTROL nBoton, "DISABLE";
               |FINSI;
          |FINSI;
     |FINSI;

     |SI enModo146 = 3;
          |HAZ EsFeldo;
          |SI FSalida = 0;
               |HAZ FeldoPortes
          |FINSI;
          |HAZ EsExtintor;
          |SI FSalida = 0;
               |HAZ BorExtintor;
               |SI nError = 1; |ERROR; |ACABA; |FINSI;
          |FINSI;
          |HAZ EsTagloma;
          |SI FSalida = 0;
               |HAZ BorTagloma;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO FeldoPortes;
     |DDEF aAlfa;
     aAlfa = aAlfa + "feldo001";
     |CARGA_DEF aAlfa, referen3@;
     |SI FSalida = 0;
          |ABRE #referen3@;
          #referen3@#0 = #0#48;
          #referen3@#1 = #0#0;
          |BORRA 000#referen3@.c;
          |CIERRA #referen3@;
          |DESCARGA_DEF #referen3@;
     |SINO;
          |MENAV "0000Error al cargar 'feldo001'";
     |FINSI;
|FPRC;

|PROCESO PrecioCab146;
     |ABRE #2;
     #2#0 = #3#2;
     |LEE 020#2=;
     |CIERRA #2;

     |ABRE #6;
     #6#0 = #0#3;
     |LEE 000#6=;
     |CIERRA #6;

     fed_dt = #0#1;   || Fecha....
     art_dt = #3#2;   || Articulo.
     cli_dt = #3#15;  || Cliente..
     fam_dt = #3#13;  || Familia.
     iva_dt = #2#30;  || Tipo Iva.
     dtos_2 = 0;      || Descuento 2.
     dto_pt = 0;      || Descuento Ptas.
     dtos_1 = 0;      || Descuento 1.
     pvp_ve = 0;      || Precio Venta.
     tarifa = #6#39;  || Tarifa Cliente....
     gru_dt = #6#158; || Grupo Cliente.
     uni_dt = #3#5;
     uni_dt2 = #3#28;
     enMensaje = 0;
     aParam = "";
     eaSerie = #3#20;
     enDirEnt = #0#80;
     |SI #2#176 = "S";  enMensaje = 1;  |FINSI;
     enAlmacen = #3#3;
     |HAZ calcdtos;    || Calculo Dtos.....
     #3#6   = pvp_ve;  || Precio Venta. sin iva.
     #3#8   = dtos_1;  || 1 Dto.
     #3#21  = dtos_2;  || 2 Dto.
|FPRC;

|PROCESO CreaLinProCab146;
     |ABRE #referen1@;
     #referen1@#20 = #3#20;
     #referen1@#0 = #3#0;
     #referen1@#1 = #3#36;
     |LEE 000#referen1@.=;
     |SI FSalida = 0; |O #3#36 = 0;
          #referen1@#1 = 999;
          |LEE 000#referen1@.];
          |SI FSalida = 0;
               |LEE 000#referen1@.a;
          |SINO;
               |LEE 000#referen1@.u;
          |FINSI;
          |SI FSalida = 0; |Y #referen1@#20 = #3#20;  |Y #referen1@#0 = #3#0;
               nLin = #referen1@#1 + 1;
          |SINO;
               nLin = 1;
          |FINSI;
          |SI nLin = #0#1; nLin = nLin + 1; |FINSI;
          #referen1@#20 = #3#20;
          #referen1@#0 = #3#0;
          #referen1@#1 = nLin;
          |GRABA 020#referen1@.b;
     |SINO;
          nLin = #3#36;
          |GRABA 020#referen1@.b;
     |FINSI;
     |SALVA_DATOS #3;
     |REPON_DATOS #referen1@;

     #referen1@#1 = nLin;
     #referen1@#5 = #3#39;
     #referen1@#6 = 0;
     #referen1@#7 = 0;
     #referen1@#8 = 0;
     #referen1@#9 = 0;
     #referen1@#24 = 0;
     #referen1@#25 = 0;
     #referen1@#26 = 0;
     #referen1@#27 = 0;
     #referen1@#36 = -1;

     |GRABA 020#referen1@.a;
     |LIBERA #referen1@;
|FPRC;

|PROCESO ProModLinea;
     #134#0 = #0#3;
     #134#1 = #3#2;
     |LEE 000#134=;
     |SI FSalida = 0; |Y #0#1 ] #134#6; |Y #0#1 [ #134#7;
          #3#15 = #0#3; || cliente
          |HAZ PrecioCab146;
          nUniPromo = #3#5 / #134#2;
          nResto = #3#5 $ #134#2;
          nResto = nResto / #134#2;
          nUniPromo = nUniPromo  - nResto;
          #3#6 = (#3#6 - #134#4) ! nDeci_Base;
          #3#37 = #134#4;
          #3#38 = #134#5;
          #3#39 = nUniPromo * #134#3;
          #3#8 = #134#5;
          |HAZ TotalLin147;
          |SI #3#39 = 0;
               #3#36 = 0;
          |SINO;
               |HAZ CreaLinProCab146;
               #3#36 = nLin;
          |FINSI;
          |GRABA 020#3a;
     |SINO;    || No tiene promocion
          #3#36 = 0;
          #3#37 = 0;
          #3#38 = 0;
          #3#39 = 0;
          |HAZ TotalLin147;
          |GRABA 020#3a;
     |FINSI;
     |LIBERA #3;
|FPRC;

|PROCESO BorraLinPromo146;
     |SI #3#36 = -1;
          |BORRA 020#3a;
     |FINSI;
|FPRC;

|PROCESO ProModLin;
     |CONFI "0000SActualizar promociones para el nuevo cliente?";
     |SI FSalida = 0;
          |DDEF aAlfa;
          aAlfa = aAlfa + "agifa147";
          |CARGA_DEF aAlfa, referen1@;
          |SI FSalida = 0;
               |ABRE #134;
               |ABRE #referen1@;
               |BUCLELIN 0 BorraLinPromo146 #0;
               |BUCLELIN 0 ProModLinea #0;
               |CIERRA #referen1@;
               |CIERRA #134;
               |DESCARGA_DEF #referen1@;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO T146_15; |TIPO 15;
     nTipo = 15; |HAZ Log146;
|FPRC;

|PROCESO T146_16; |TIPO 16;
     nTipo = 16; |HAZ Log146;
|FPRC;

|PROCESO T146_17; |TIPO 17;
     nTipo = 17; |HAZ Log146;
|FPRC;

|PROCESO Log146;
     |DDEF aAlfa;
     aAlfa = aAlfa + "dsm00087";
     |CARGA_DEF aAlfa, referen2@;
     |SI FSalida ! 0; |ACABA; |FINSI;

     aSer = #0#48;
     aNum = ("000000" + #0#0) % -106;
     aTipo = "PF";

     |ABRE #referen2@;
     |DDEFECTO #referen2@;
     |SELECT #2#referen2@;
     #referen2@#1 = aSer;
     #referen2@#2 = aNum;
     #referen2@#3 = aTipo;
     |LEE 101#referen2@.=;
     |SI FSalida ! 0;
          |SELECT #1#referen2@;
          |LEE 000#referen2@.u;
          |SI FSalida = 0;
               nContaLog = #referen2@#0 + 1;
          |SINO;
               nContaLog = 1;
          |FINSI;
          |DDEFECTO #referen2@;
          #referen2@#0 = nContaLog;
          #referen2@#1 = aSer;
          #referen2@#2 = aNum;
          #referen2@#3 = aTipo;
          |GRABA 020#referen2@.b;
     |FINSI;
     |SI FSalida = 0;
          |HORA aAlfa;
          aUsu = Usuario % 810;
          |SI nTipo = 15;
               #referen2@#4 = aUsu;
               #referen2@#5 = ~;
               #referen2@#6 = aAlfa;
               #referen2@#7 = "";
               #referen2@#8 = "01.01.0000";
               #referen2@#9 = ""
               #referen2@#10 = "";
               #referen2@#11 = "01.01.0000";
               #referen2@#12 = ""
          |FINSI;
          |SI nTipo = 16;
               #referen2@#7 = aUsu;
               #referen2@#8 = ~;
               #referen2@#9 = aAlfa;
          |FINSI;
          |SI nTipo = 17;
               #referen2@#10 = aUsu;
               #referen2@#11 = ~;
               #referen2@#12 = aAlfa;
          |FINSI;
          |GRABA 020#referen2@.a;
     |FINSI;
     |CIERRA #referen2@;
     |DESCARGA_DEF #referen2@;
|FPRC;

|PROCESO AsignaDir146;
     #0#4 = #49#10;   |PINTA #0#4;
     #0#29 = #49#10;  |PINTA #0#29;
     #0#30 = #49#2; |PINTA #0#30;
     #0#31 = #49#3; |PINTA #0#31;
     #0#33 = #49#7; |PINTA #0#33;
     #0#81 = #49#6; |PINTA #0#81;
     #0#80 = #49#1; |PINTA #0#80;
     |SI #49#14 = "  ";
         #0#6 = #6#25;
     |SINO;
         #0#6 = #49#14;
     |FINSI;
     |PINTA #0#6;
|FPRC;

|PROCESO MinDir146;
     #49#0 = #0#3;
     #49#1 = 1;
|FPRC;

|PROCESO MaxDir146;
     #49#0 = #0#3;
     #49#1 = 9999;
|FPRC;

|PROCESO Dir146_0; |TIPO 0;
     |SI FSalida = 2; |ACABA; |FINSI;
     nTecla = FSalida;
     |SI nTecla = 12;    || F4 Alta direccion
          |PUSHV 0501 2380;
          |ENTLINEAL #1#49, -2, 1, 22, 1, MinDir146, MaxDir146;
          |POPV;
          nTecla = 18;
     |FINSI;
     |ABRE #49;
     |SI nTecla = 18;   || F10  Todas las direcciones
          #49#0 = #0#3;
          #49#1 = #0#80;
          |LEE 000#49];
          |CONSULTA_F_CLAVE #1#49, MinDir146, MaxDir146;
          |SI FSalida = 0;
               |HAZ AsignaDir146;
          |SINO;
               |ERROR; |ACABA;
          |FINSI;
     |FINSI;
     #49#0 = #0#3;
     #49#1 = #0#80;
     |LEE 000#49=;
     |SI FSalida = 0;
          |SI #49#18 = "N";
               |CONFI "0000NDireccion de entrega desactiva. 풠ontinuar?";
               |SI FSalida ! 0; |ERROR; |ACABA; |FINSI;
          |FINSI;
     |SINO;
          |MENAV "0000No existe direccion de entrega...";
          |ERROR; |ACABA;
     |FINSI;
     |CIERRA #49;
     |SI #0Campo ! Contenido;
          |HAZ AsignaDir146;
     |FINSI;
|FPRC;

|PROCESO Dir146_7; |TIPO 7;
     |SI #41#71 = "S";
          |ABRE #49;
          #49#0 = #0#3;
          #49#1 = 1;
          |LEE 000#49];
          |SI FSalida = 0; |Y #49#0 = #0#3;
               |LEE 000#49s;
               |SI FSalida = 0; |Y #49#0 = #0#3;
                    aSinError = "S";
                    |HAZ Dir146_66;
                    aSinError = "N";
                    |SI nSal = 0; |ERROR; |FINSI;
               |FINSI;
          |FINSI;
          |CIERRA #49;
     |FINSI;
|FPRC;

|PROCESO Dir146_66; |TIPO 66;
     nModo = (FEntrada / 100) ! 0;
     |ABRE #49;
     aSql = "SELECT * FROM dsm00003 INTO sq" + Usuario + ".def WHERE ";
     aSql = aSql + "0 == " + #0#3 + " AND 18 == S";
     |SQL aSql;
     |SI FSalida = 0;
          |DDEF aDef; |QBF aDef;
          aDef = aDef + "sq" + Usuario + ".mas";
          |CARGA_DEF aDef, referen1@;
          |SI FSalida = 0;
               |ABRE #referen1@;
               #referen1@#0 = #0#3;
               #referen1@#1 = #0#80;
               |LEE 000#referen1@.]
               |CONSULTA_CLAVE #1#referen1@;
               nSal = FSalida;
               |SI FSalida = 0;
                    |SI nModo ! 2; |O #referen1@#0 ! #0#3; |O #referen1@#1 ! #0#80;
                         #49#0 = #referen1@#0;
                         #49#1 = #referen1@#1;
                         |LEE 020#49=;
                         |HAZ AsignaDir146;
                    |FINSI;
               |SINO;
                    |SI aSinError ! "S";
                         |ERROR;
                    |FINSI;
               |FINSI;
               |CIERRA #referen1@;
               |DELINDEX #referen1@;
               |DESCARGA_DEF #referen1@;
               |FBORRA aDef;
          |FINSI;
     |FINSI;
     |CIERRA #49;
|FPRC;

|PROCESO ContaPR; |TIPO 0;
     |HAZ ContaPR0;

     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 1;
          aAlfa = Usuario % 810;
          #0#92 = aAlfa; |PINTA #0#92;

          |HAZ EsTagloma;
          |SI FSalida = 0;
               eaSerie = #0#48;
               enCodigo = #0#0;
               |SUB_EJECUTA_NP "tagm0091;DEFECTO";
               |HAZ PinTagloma146;
          |FINSI;
/*
|| Quitado segun  Subtiquet nro. 00112.0013 Cliente: 003679
          |HAZ EsMecanogra;
          |SI FSalida = 0;
               |ABRE #104;
               #104#24 = #0#48;
               #104#0 = #0#0;
               |LEE 000#104=;
               |SI FSalida = 0;
                    |MENAV "0000Documento existente en pedidos.";
                    |ERROR;
               |FINSI;
               |CIERRA #104;
          |FINSI;
*/
     |FINSI;
|FPRC;

|PROCESO Pago7_146; |TIPO 7;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 1;
          |HAZ EsTagloma;
          |SI FSalida = 0;
               eaAlfa = #0#48;
               |HAZ TagloDefFP;
               |SI eaAlfa ! ""; #0#8 = eaAlfa; |PINTA #0#8; |FINSI;
               |SI eaQuitaDto = "S";
                    #0#5 = 0; |PINTA #0#5;
                    #0#32 = 0; |PINTA #0#32;
                    #0#7 = 0; |PINTA #0#7;
               |FINSI;
          |FINSI;
          |HAZ EsGestral;
          |SI FSalida = 0;
               eaAlfa = #0#48;
               |HAZ GestrDefFP;
               |SI eaAlfa ! ""; #0#8 = eaAlfa; |PINTA #0#8; |FINSI;
               |SI eaQuitaDto = "S";
                    #0#5 = 0; |PINTA #0#5;
                    #0#32 = 0; |PINTA #0#32;
                    #0#7 = 0; |PINTA #0#7;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Tipo146_20; |TIPO 20;
     |SI FSalida ! "OPCION";
          |SELECT #1#0;
          |LEE 000#0=;
          |SI FSalida ! 0;
               |MENAV "0000Por favor, consulte el registro correcto antes de imprimir.";
               |ACABA;
          |SINO;
               |PINDA #0#0;
          |FINSI;
     |FINSI;
     |HAZ T146_20;
|FPRC;

|PROCESO T146_20;
     |SI FSalida = "OPCION";
          FSalida = "Opciones";
     |SINO;
          |HAZ EsTagloma; nSwTagloma = FSalida;
          |SI nSwTagloma = 0; aMenu4 = "IHP"; |FINSI;

          |MENU aMenu;
          |SI FSalida = 1; |HAZ impreal; |FINSI;
          |SI FSalida = 2;
               |LIBERA #0;
               eaSerie = #0#48;
               enCodigo = #0#0;
               |SUB_EJECUTA_NP "diaw0025";
          |FINSI;
          |SI FSalida = 3; |Y nSwTagloma = 0;
               |SI #0#61 ! 0;
                    |MENAV "0000Documento ya asignado...";
               |SINO;
                    eaSerie = #0#48;
                    enCodigo = #0#0;
                    eaFP = #0#8;
                    |SUB_EJECUTA_NP "tagz0030;ADJ";
                    |SI eaBloquea = "S";
                         |MENAV "0000PROFORMA BLOQUEADA PAGO ANTICIPADO";
                    |SINO;
                         |CONFI "0000N풠onfirma el pase a pedido?";
                         |SI FSalida = 0;
                              |LIBERA #0;
                              eaSerie = #0#48;
                              enCodigo = #0#0;
                              |SUB_EJECUTA_NP "agifa166;TAGLOMA";
                              |LEE 000#0=;
                              |PINTA #0#83;
                              |PINTA #0#60;
                              |PINTA #0#61;
                              |PINTA #0#62;
                         |FINSI;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Riesgo146; |TIPO 0;
     nModo = (FEntrada / 100) ! 0;

     |SI nModo = 4; |ACABA; |FINSI;

     ||컴컴컴컴컴컴컴컴컴컴컴컴컴 Control Riesgo Cliente.
     nMasRies   = 0;
     eaCodCliente = #agifa146#3; eaNomCliente = #agifa146#4;
     eaSerie = #0#48; eaTag = "PROFO";  |HAZ SacaRiesgo;
     |SI #agifa142#166 = "S"; |Y eaExisteCliRie = "S";
          eaDocu = "C";
          eaTipo = "P";
          enImpoDoc = #0#41;
          eaMuestra = "S";
          |HAZ ControlRiesgo;
          |SI enErrRie ! 0;
               nError6 = 1;
               |SI nModo ! 4; |ERROR; |FINSI;
               |ACABA;
          |FINSI;
          |SI enAudito = 0;
               |ABRE #143;
               |LEE 000#143u;
               |SI FSalida = 0;
                    nConAu = #143#0 + 1;
               |SINO;
                    nConAu = 1;
               |FINSI;
               |DDEFECTO #143;
               #143#0 = nConAu;
               #143#12 = "PROFORMA";
               #143#1 = #0#48;
               #143#2 = #0#0;
               #143#3 = #0#1;
               #143#4 = #0#3;
               #143#5 = #0#4;
               #143#6 = Usuario % 810;
               #143#7 = #141#0;
               #143#8 = #141#1;
               #143#9 = #141#2;
               #143#10 = #141#3;
               #143#11 = #141#4;
               |GRABA 020#143n;
               |CIERRA #143;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO IVA146_0; |TIPO 0;
     enTiva = #0Campo;
     efFiva = #0#1;
     |HAZ SacaIVA;
     |SI eaDiva = "";
          |MENAV "0000No existe tipo iva para esta fecha...";
          |ERROR; |ACABA;
     |SINO;
          |HAZ caltotal;
     |FINSI;
|FPRC;

|PROCESO IVA146_66; |TIPO 66;
     enTiva = #0Campo;
     efFiva = #0#1;
     |HAZ ConsuIVA;
     |SI eaDiva = "";
          |ERROR;
     |SINO;
          #0Campo = enTiva; |PINTA #0Campo;
     |FINSI;
|FPRC;

|PROCESO Tipo80; |TIPO 80;
     |HAZ EsLegiplag;
     |SI FSalida = 0;
          |CONTROL_SIMPLE 0, "BOTON, Contrato", 0570, 0579, BotonContratoLegi;
          nBoton = FSalida;
          |ESTADO_CONTROL nBoton, "DISABLE";
     |FINSI;
     |HAZ EsChampiEmar;
     |SI FSalida = 0;
          |HAZ CreaTempo; eaTmpPR816 = Tempo;
     |FINSI;
     FSalida = "";
|FPRC;

|PROCESO Tipo90; |TIPO 90;
     |HAZ EsLegiplag;
     |SI FSalida = 0;
          |FIN_CONTROL_WINDOWS nBoton;
     |FINSI;
     |SI eaTmpPR816 ! ""; Tempo = eaTmpPR816; |HAZ BoraTempo; |FINSI;
|FPRC;

|PROCESO Ser146_7; |TIPO 7;
     nModo = (FEntrada / 100) ! 0;
     |C_P #0#3, 0, enPosCli;
     |HAZ DefSerVta;
     |SI nModo = 1; |Y #279#24 = "S";
          |SI eaSerCli ! "";
               #0#48 = eaSerCli; |PTEC 802;
          |SINO;
               |PTEC 807; |PTEC 807; |ERROR; |ACABA;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO BorExtintor;
     nError = 0;
     |DDEF aAlfa;
     aAlfa = aAlfa + "extm0013";
     |CARGA_DEF aAlfa, referen1@;
     |SI FSalida = 0;
          |ABRE #referen1@; |SELECT #5#referen1@;
          #referen1@#31 = #0#48;
          #referen1@#32 = #0#0;
          |LEE 000#referen1@.=;
          |SI FSalida = 0;
               aAlfa = #referen1@#0 + "/" + (("000000" + #referen1@#1)%-106);
               aAlfa = "0000NEl presupuesto pertenece al parte de revisi줻:" + aAlfa + ". 풠ontinuar la baja?";
               |CONFI aAlfa;
               |SI FSalida = 0;
                    #referen1@#31 = "";
                    #referen1@#32 = 0;
                    |GRABA 020#referen1@.a;
               |SINO;
                    nError = 1;
               |FINSI;
          |FINSI;
          |CIERRA #referen1@;
          |DESCARGA_DEF #referen1@;
     |SINO;
          |MENAV "0000Error al cargar 'extm0013'";
     |FINSI;
|FPRC;

|PROCESO T8_146; |TIPO 8;
     |HAZ EsTagloma;
     |SI FSalida = 0;
          |CONTROL_SIMPLE 0, "BOTON, ItemDoc", 0570, 0579, BtnItemDocPed;
          nBtnItemDocPed = FSalida;
          |CONTROL_SIMPLE 0, "BOTON, WorkFlow", 0470, 0479, BtnWorkFlow;
          nBtnWorkFlow = FSalida;
     |FINSI;
|FPRC;

|PROCESO T9_146; |TIPO 9;
     |SI nBtnItemDocPed ! -1; |FIN_CONTROL_WINDOWS nBtnItemDocPed; |FINSI;
     |SI nBtnWorkFlow ! -1; |FIN_CONTROL_WINDOWS nBtnWorkFlow; |FINSI;
|FPRC;

|PROCESO BtnItemDocPed;
     aAlfa = "tagz0025;PR" + #0#48 + #0#0;
     |SUB_EJECUTA_NP aAlfa;
|FPRC;

|PROCESO BtnWorkFlow;
     aAlfa = "tagz0025;WPR" + #0#48 + #0#0;
     |SUB_EJECUTA_NP aAlfa;
|FPRC;

|PROCESO PinTagloma146;
     |HAZ EsTagloma;
     |SI FSalida = 0;
          |C_V #0#65, 1, "N";
          |C_V #0#66, 1, "N";
          |C_V #0#67, 1, "N";
          |PINTA 1323, " Seccion:                                              ";
          |PINTA 1423, "좔컴컴컴컴컴컴컴컴컫컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴";
          |DDEF aAlfa;
          aAlfa = aAlfa + "tagm0091";
          |CARGA_DEF aAlfa, referen1@;
          |SI FSalida = 0;
               |ABRE #referen1@;
               #referen1@#0 = #0#48;
               #referen1@#1 = #0#0;
               |LEE 000#referen1@.=;
               |SI FSalida ! 0; |DDEFECTO #referen1@; |FINSI;
               |CIERRA #referen1@;
               |ATRI I;
               |PINTA 1334, #referen1@#2;
               |PINTA 1339, #referen1@#3;
               |ATRI 0;
               |DESCARGA_DEF #referen1@;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Departamento; |TIPO 0;
     |SI FSalida = 0;
          |HAZ EsTagloma;
          |SI FSalida = 0;
               eaSerie = #0#48;
               enCodigo = #0#0;
               |SUB_EJECUTA_NP "tagm0091";
               |HAZ PinTagloma146;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO BorTagloma;
     |DDEF aAlfa;
     aAlfa = aAlfa + "tagm0091";
     |CARGA_DEF aAlfa, referen1@;
     |SI FSalida = 0;
          |ABRE #referen1@;
          #referen1@#0 = #0#48;
          #referen1@#1 = #0#0;
          |LEE 000#referen1@.=;
          |SI FSalida = 0;
               |BORRA 020#referen1@.a;
          |FINSI;
          |CIERRA #referen1@;
          |DESCARGA_DEF #referen1@;
     |FINSI;

     |DDEF aAlfa;
     aAlfa = aAlfa + "tagm0092";
     |CARGA_DEF aAlfa, referen1@;
     |SI FSalida = 0;
          |ABRE #referen1@;
          |SELECT #2#referen1@;
          #referen1@#10 = "PR";
          #referen1@#11 = #0#48;
          #referen1@#12 = #0#0;
          |LEE 101#referen1@.=;
          |SI FSalida = 0;
               #referen1@#10 = "";
               #referen1@#11 = "";
               #referen1@#12 = "";
               |GRABA 020#referen1@.a;
          |FINSI;
          |CIERRA #referen1@;
          |DESCARGA_DEF #referen1@;
     |FINSI;
|FPRC;


|PROCESO NifTaglo146;
     aAlfa = #0#86; |QBF aAlfa;
     |SI aAlfa = "."; |ACABA; |FINSI;

     enError = 0;
     |DBASS aAlfa;
     aAlfa = aAlfa + "basica/def/agim0003";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          #referen@#0 = #0#86;
          |LEE 000#referen@.=;
          |SI FSalida ! 0;
               eaVarDni = #0#86;
               |ABRE #6;
               #6#0 = #0#3;
               |LEE 000#6=;
               |CIERRA #6;
               eaNonDni = #0#4;
               eaDomiDni = #0#30;
               eaCPDni = #0#81;
               eaPobDni = #0#31;
               eaPrvDni = #0#33;
               eaTlfDni = #6#17;
               eaFacDni = #6#18;
               eaPaisDni = #6#205;
               |SUB_EJECUTA_NP ":basica/tagm0001";
          |FINSI;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
     |SI enError ! 0; |ERROR; |FINSI;
|FPRC;

|PROCESO ObsCli146;
     |SI #agifa142#14 = "S";
          aAlfa = #agifa024#53;     |QBF aAlfa;
          |SI aAlfa ! "";
               |PUSHV 1008 1370;
               |SI #agifa142#20 = "S"; |AVISO; |FINSI;
               |BLANCO 1008 1370;
               |CUADRO 1008 1370;
               |ATRI R;
               |PINTA 1110 , #agifa024#53;
               |ATRI 0;
               |PAUSA;
               |POPV;
          |FINSI;
     |FINSI;
|FPRC;
