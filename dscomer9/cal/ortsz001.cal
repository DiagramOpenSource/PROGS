|FICHEROS;
     ortsz001 #0;        || este def
     agifa019 #1;        || articulos
     agifa090 #2;        || ord. fabricacion (C)
     agifa074 #3;        || ord. fabricacion (L)
     agifa048 #4;        || escandallos (C)
     agifa049 #5;        || escandallos (L)
     agifa017 #6;        || almacenes
|FIN;

|VARIABLES;
     pcm  = 0;
     nCon = 0;
|FIN;


|PROCESO RecalculaAlmacen;
     #6#3 = #1#10;
     |GRABA 020#6a;
|FPRC;


|DEFBUCLE Almacen;
     #6#1;
     ;
     #1#0,01;
     #1#0,99;
     be;
     NULL, RecalculaAlmacen;
|FIN;

|PROCESO Recalcula;
     |ABRE #1;                     || abre fichero articulos
     |DDEFECTO #1;
     #1#0 = #3#2;                  || cod. articulo = escandallo
     |LEE 110#1=;
     |SI FSalida = 0;
          |ABRE #4;                || abre escandallos (C)
          |DDEFECTO #4;
          #4#0 = #1#0;
          |LEE 000#4=;
          |SI FSalida = 0;
               #1#9  = #4#9;            || pcm = coste escandallo
               #1#10 = #1#9 * #1#6;     || v.stock = pcm * s. total
               |GRABA 020#1a;
               |BUCLE Almacen;
          |FINSI;
          |CIERRA #4;
     |FINSI;
     |LIBERA #1;
     |CIERRA #1;
|FPRC;


|PROCESO LeeOrden;
     |ABRE #2;
     |DDEFECTO #2;
     #2#0 = #0nCon;
     |BUCLELIN 0Recalcula#2;
     |LIBERA #2;
     |CIERRA #2;
|FPRC;

|PROCESO Inicio;    |TIPO 3;
     |PARA nCon = 0; |SI nCon < 10; |HACIENDO nCon = nCon + 1;
          |SI #0nCon > 0;
               |HAZ LeeOrden;
          |FINSI;
     |SIGUE;
|FPRC;
