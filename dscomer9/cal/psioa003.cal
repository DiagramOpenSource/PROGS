
     NOTA: SI SE A¥ADE/MODIFICA ALGUN CAMPO DE LOS .ASC
           MODIFICAR LA ESTRUCTURA DEFINIDA EN psioa103

|FICHEROS;
     psioa003 #0;
     psioa004 #1;   || Cabecera.
     psioa005 #2;   || Lineas.
     agifa024 #3;   || Clientes.
     agifa019 #4;   || Articulos.
     psioa013 #6;   || Cobros Facturas.
     psioa015 #7;   || Movimientos de Almacen.
     psioa019 #8;   || Cobros Albaranes.
     psioa001 #9;   || Mto. Pase Datos Psion.
     agifa010 #10;
     agifa321 #14;  || Divisas-Parametros.
     agifa324 #15;  || Divisas-Divisas.
     psioa021 #21;       || clientes nuevos
     psioa022 #22;       || direcciones entrega
     agifa025 #25;
     agifa112 #112;
     psioa074 #74;
     psioa075 #75;
     psioa076 #76;
     psioa080 #80;       || clientes modificados
     dscam045@;
     dscam003@;
     psioaz01 #100,MANTE;
     psioc001 #201;
     psioc002 #202;
|FIN;

|CAMPOS;
     #9#75 path;
|FIN;

|VARIABLES;
     &eaTmp2 = "";
     nSwCepsax = 0;
     {1}aBaseLocal = "";
     aHoraHis = "";
     nCobro = 0;
     nSwCoimasa = 0;
     aPath = "";
     nLinea = 0;
     aTmp = "";
     aTmpLin = "";
     aReturn = "";
     aEnter = "";
    {10}aNota = "";
    {100}Lin = "";
     nSwFichero = 0;
     fFec = @;
     aDes = "";
     aOrg = "";
     aNomFic = "";
     aParam = "";
     &enTiva = 0;
     &efFiva = @;
     &eaDiva = "";
     &enIva = 0;
     &enRec = 0;
     nSwJamaica = 0;
     aSwLinPromo = "";
     nTiva = 0;
     nImpDto1 = 0;
     nImpDto2 = 0;
     nImpDto3 = 0;
     &Tempo = "";
     nEsCarnicas = 0;
     aCar = "";
     aExe = "";
    || nPos = 0;
    || aLon = "";
     aFicDes = "";
     aFicOrg = "";
     aVer1 = "";
     aVer2 = "";
     aIP = "";
     aBase = "";
     {1}aLocal = "";
     {1}aConte = "";
     aOrigen = "";
     aDestino = "";

     nCampo = 0;
 {90}Valor = "";
     aReg = "";
     aLon = "";
     aDato = "";
     nPos = 0;
     aLetra = "";
     aTab = "";

     aAlfa = "";
     aEjecuta = "";
     nHandle = 0;
     nIva = 0;
     nRec = 0;
     nCamIva = 0;
     nCamBase = 0;
     nCamRec = 0;
     nBruto = 0;
     nPrim = 1;

     base     = 0;
     almacen  = "";
     represen = "";
     liquid   = 0;
     fra      = 0;
     aClase = "";
     aSer = "";
     conta    = 0;
     texto    = "PONGO EN EL CAMPO";
     texto1   = "EL DATO:"
     texto2   = "";
     empresa  = "";
     cadena   = "";
     fichero  = "";
     long     = "";
     caracter = "";
     campo    = "";
     i        = 0;
     ii       = 0;
     j        = 0;
     v        = 0;
     f        = 0;
     ind      = 0;
     valor    = 0;
     sw       = 0;
     pasa     = 0;
     jj       = 0;
     sal      = 0;
     guarda   = 0;
     bruto    = 0;
     impuesto = 0;
     total    = 0;
     linea    = 0;
     iva      = 0;
     nRepresen = 0;
     {-1}menu= "";
     menu1 = "2200";
     menu2 = "1";
     menu3 = "";
     menu4 = "12";
     menu5 = " Representante1 ";
     menu6 = " Representante2 ";
     nCar = 0;
|FIN;

|PROCESO Nombre1; |TIPO 0;
     |SI #0#5 = "N";
          |ABRE #9;
          #9#0 = #0Campo;
          |LEE 000#9=;
          |SI FSalida ! 0;
               |MENAV "0000No existe código...";
               |ERROR;
          |FINSI;
          |CIERRA #9;
     |FINSI;
|FPRC;

|PROCESO Nombre2; |TIPO 0;
     |SI #0#5 = "S";
          |ABRE #9;
          #9#0 = #0Campo;
          |LEE 000#9=;
          |SI FSalida ! 0; |Y #0Campo ! "          ";
               |MENAV "0000No existe código...";
               |ERROR;
          |FINSI;
          |CIERRA #9;
     |FINSI;
|FPRC;

|PROCESO GrabaCanonLin;
     |DDEFECTO #202;
     #202#0 = Valor1;
     #202#1 = Valor2;
     #202#2 = Valor3;
     #202#3 = Valor4;
     |LEE 101#202=;
     |SI FSalida ! 0; |GRABA 020#202b; |FINSI;
     #202#4 = Valor5;
     #202#5 = Valor6;
     |GRABA 020#202a;
     |LIBERA #202;
|FPRC;

|PROCESO CanonLin;
     empresa = path;
     |QBF empresa;
     aNomFic = "canonlin.asc";
     aFicOrg = empresa + "canonlin.asc";
     aFicDes = empresa + "canonlin.txt";
     |HAZ Utf82Ansi;
     empresa = aFicDes;
     |XABRE "", empresa, nHandle;
     |SI FSalida < 0;
          aAlfa = "0000Error al leer:" + aFicOrg;
          ||SI aParam = ""; |MENAV aAlfa; |FINSI;
     |SINO;
          |ABRE #202;
          |XLEE nHandle, 250, aDato;
          |PARA; |SI FSalida > 0; |HACIENDO;
               |HAZ Dato;
               |HAZ GrabaCanonLin;
               |XLEE nHandle, 250, aDato;
          |SIGUE;
          |XCIERRA nHandle;
          |CIERRA #202;
     |FINSI;
     |RFBORRA aFicDes;
     |HAZ MueveHisto;
|FPRC;

|PROCESO GrabaCanonCab;
     |DDEFECTO #201;
     #201#0 = Valor1;
     #201#1 = Valor2;
     #201#2 = Valor3;
     |LEE 101#201=;
     |SI FSalida ! 0; |GRABA 020#201b; |FINSI;
     IValor = Valor4<-;
     |PARA i = 3; |SI i [ 28; |HACIENDO i = i + 1;
          #201i = Valor;
          IValor = IValor + 1;
     |SIGUE;
     |GRABA 020#201a;
     |LIBERA #201;
|FPRC;

|PROCESO CanonCab;
     empresa = path;
     |QBF empresa;
     aNomFic = "canoncab.asc";
     aFicOrg = empresa + "canoncab.asc";
     aFicDes = empresa + "canoncab.txt";
     |HAZ Utf82Ansi;
     empresa = aFicDes;
     |XABRE "", empresa, nHandle;
     |SI FSalida < 0;
          aAlfa = "0000Error al leer:" + aFicOrg;
          ||SI aParam = ""; |MENAV aAlfa; |FINSI;
     |SINO;
          |ABRE #201;
          |XLEE nHandle, 250, aDato;
          |PARA; |SI FSalida > 0; |HACIENDO;
               |HAZ Dato;
               |HAZ GrabaCanonCab;
               |XLEE nHandle, 250, aDato;
          |SIGUE;
          |XCIERRA nHandle;
          |CIERRA #201;
     |FINSI;
     |RFBORRA aFicDes;
     |HAZ MueveHisto;
|FPRC;

|PROCESO CoimaExtra;
     empresa = path;
     |QBF empresa;
     aNomFic = "cabdocsextra.asc";
     aFicOrg = empresa + "cabdocsextra.asc";
     aFicDes = empresa + "cabdocsextra.txt";
     |HAZ Utf82Ansi;
     empresa = aFicDes;
     |XABRE "", empresa, nHandle;
     |SI FSalida < 0;
          aAlfa = "0000Error al leer:" + aFicOrg;
          ||SI aParam = ""; |MENAV aAlfa; |FINSI;
     |SINO;
          |ABRE #1;
          |XLEE nHandle, 250, aDato;
          |PARA; |SI FSalida > 0; |HACIENDO;
               |HAZ Dato;
               #1#0 = Valor1;
               #1#2 = Valor2;
               #1#1 = Valor3;
               |LEE 101#1=;
               |SI FSalida = 0;
                    #1#43 = Valor4;
                    #1#44 = Valor5;
                    #1#45 = Valor6;
                    |GRABA 020#1a;
                    |LIBERA #1;
               |FINSI;
               |XLEE nHandle, 250, aDato;
          |SIGUE;
          |XCIERRA nHandle;
          |CIERRA #1;
     |FINSI;
     |RFBORRA aFicDes;
     |HAZ MueveHisto;
|FPRC;

|PROCESO ArtCoimasa;     || Le quita los ultimos 8 caracteres
/*
     |SI nSwCoimasa = 0;
          |QBF aAlfa;
          aLon = aAlfa  % A0;
          nPos = aLon;
          nPos = nPos - 8;
          |SI nPos > 0;
               nPos = 100 + nPos;
               aAlfa = aAlfa % nPos;
          |FINSI;
     |FINSI;
*/
|FPRC;

|PROCESO T12; |TIPO 12;
|FPRC;

|PROCESO MueveHisto;
     |SI #9#76 = "C";
          |ESPECIFICA "RBASS", aBaseLocal;
          aAlfa = aBaseLocal1 + "historico/";
          |RMKDIR aAlfa;
     |SINO;
          |DBASE aAlfa;
          aAlfa = aAlfa + "historico/";
          |MKDIR aAlfa;
     |FINSI;
     fFec = ~;
     aDes = (fFec % 704) + (fFec % 402) + (fFec % 102);
     aDes = aAlfa + aDes + aHoraHis + aNomFic;
     aOrg = #9#75; |QBF aOrg;
     aOrg = aOrg + aNomFic;
     |SI #9#76 = "C";
          |RCOPIA_FICHERO aOrg, aDes;
          |RFBORRA aOrg;
     |SINO;
          |COPIA_FICHERO aOrg, aDes;
          |FBORRA aOrg;
     |FINSI;
|FPRC;

|CALCULO repres;|TIPO 0;
     |SI #0#5 = "N";|O #0#5 = "n";
          |CAMPO_MODIFICA #0#4 , 1 , "N";
          |SI #0#3 = "S";
              |CAMPO_MODIFICA #0#4 , 1 , "S";
              #0#4 = #0#0;
              |PINTA #0#4;
          |SINO;
              |MENU menu;
              nRepresen = FSalida;
          |FINSI;
     |FINSI;
|FCAL;

|PROCESO ModiLetra;
     |SI #9#76 = "S";
          nCar = &aLetra;
          |SI nCar = 241; aLetra = "¤"; |FINSI;
          |SI nCar = 209; aLetra = "¥"; |FINSI;
          |SI nCar = 208; aLetra = "¥"; |FINSI; ||no se porque
          |SI nCar = 225; aLetra = " "; |FINSI;
          |SI nCar = 233; aLetra = "‚"; |FINSI;
          |SI nCar = 237; aLetra = "¡"; |FINSI;
          |SI nCar = 243; aLetra = "¢"; |FINSI;
          |SI nCar = 250; aLetra = "£"; |FINSI;
          |SI nCar = 193; aLetra = "A"; |FINSI;
          |SI nCar = 201; aLetra = "E"; |FINSI;
          |SI nCar = 205; aLetra = "I"; |FINSI;
          |SI nCar = 211; aLetra = "O"; |FINSI;
          |SI nCar = 218; aLetra = "U"; |FINSI;
          |SI nCar = 186; aLetra = "§"; |FINSI;
          |SI nCar = 170; aLetra = "¦"; |FINSI;
     |FINSI;
|FPRC;

|PROCESO QuitaRarosImp;
     |SI #9#76 = "S";
          |QBF cadena;
          aAlfa = cadena;
          aLon = aAlfa % A0;
          aDato = "";
          |PARA ii = 0; |SI ii [ aLon; |HACIENDO ii = ii + 1;
               nPos = (ii + 1) * 100 + 1;
               aLetra = aAlfa % nPos;
               |HAZ ModiLetra;
               aDato = aDato + aLetra;
          |SIGUE;
          cadena = aDato;
     |FINSI;
|FPRC;

|PROCESO Dato;
     IValor = Valor1<-;
     |PARA i = 1; |SI i [ 90; |HACIENDO i = i + 1;
          Valor = "";
          IValor = IValor + 1;
     |SIGUE;
     nCampo = 1;
     IValor = Valor1<-;
     aLon = aDato % A0;
     aReg = "";
     |PARA i = 1; |SI i [ aLon; |HACIENDO i = i + 1;
          nPos = i * 100 + 1;
          aLetra = aDato % nPos;
          |SI aLetra = aTab;
               Valor = aReg;
               aReg = "";
               nCampo = nCampo + 1;
               IValor = IValor + 1;
          |SINO;
               |HAZ ModiLetra;
               aReg = aReg + aLetra;
          |FINSI;
          |SI nCampo > 90; |SAL; |FINSI;     || Por si.... :)
     |SIGUE;
     Valor = aReg;
|FPRC;

|PROCESO IniciaLineas;
     ILin = Lin1<-;
     |PARA i = 1; |SI i [ 100; |HACIENDO i = i + 1;
          Lin = "";
          ILin = ILin + 1;
     |SIGUE;
     ILin = Lin1<-;
|FPRC;

|PROCESO DatoLin;
     |SI aLetra = aTab;
          Valor = aReg;
          aReg = "";
          nCampo = nCampo + 1;
          IValor = IValor + 1;
     |SINO;
          |HAZ ModiLetra;
          |SI nSwFichero = 1; |O nSwFichero = 2;
               |SI nCampo = 2;
                    aAlfa = aNota % A0;
                    |SI aAlfa ] 50; IaNota = IaNota + 1; |FINSI;
                    aNota = aNota + aLetra;
               |SINO;
                    aReg = aReg + aLetra;
               |FINSI;
          |SINO;
               aReg = aReg + aLetra;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Linea;
     |SI aCar = aEnter; |ACABA; |FINSI;
     |SI aCar = aReturn;
          nLinea = nLinea + 1;
          ILin = Lin1<-;

          IValor = Valor1<-;
          |PARA i = 1; |SI i [ 90; |HACIENDO i = i + 1;
               Valor = "";
               IValor = IValor + 1;
          |SIGUE;
          nCampo = 1;
          IValor = Valor1<-;
          aReg = "";
          |PARA i = 1; |SI i [ 100; |HACIENDO i = i + 1;
               aTmpLin = Lin;
               |PARA; |SI aTmpLin ! ""; |HACIENDO;
                    aLetra = aTmpLin % 101;
                    |SI aTmpLin = aLetra;
                         aTmpLin = ""; ||con un caracter falla: "aTmpLin = aTmpLin % 2"
                    |SINO;
                         aTmpLin = aTmpLin % 2;
                    |FINSI;
                    |HAZ DatoLin;
               |SIGUE;
               ILin = ILin + 1;
          |SIGUE;
          Valor = aReg; aReg = "";
          |SI nSwFichero = 1; |O nSwFichero = 2;
               IaNota = aNota1<-;
               |PARA j = 1; |SI j [ 10; |HACIENDO j = j + 1;
                    cadena = aNota; |HAZ QuitaRarosImp; aNota = cadena;
                    IaNota = IaNota + 1;
               |SIGUE;
          |FINSI;
          |SI nSwFichero = 1; |HAZ GraAnotaGen; |FINSI;
          |SI nSwFichero = 2; |HAZ GraAnotaCli; |FINSI;
          |SI nSwFichero = 3; |HAZ GraContactos; |FINSI;
          |HAZ IniciaLineas;
     |SINO;
          aLon = Lin % A0;
          |SI aLon = 250; ILin = ILin + 1; |FINSI;
          Lin = Lin + aCar;
     |FINSI;
|FPRC;
----------------------------------------------------
|PROCESO GraAnotaCli;
     |DDEFECTO #75;
     #75#13 = Valor5;
     #75#14 = #9#77;
     |LEE 101#75=;
     |SI FSalida ! 0; |GRABA 020#75b; |FINSI;
     #75#0 = Valor1;
     #75#1 = aNota1;
     #75#2 = aNota2;
     #75#3 = aNota3;
     #75#4 = aNota4;
     #75#5 = aNota5;
     #75#6 = aNota6;
     #75#7 = aNota7;
     #75#8 = aNota8;
     #75#9 = aNota9;
     #75#10 = aNota10;
     #75#11 = Valor3;
     #75#12 = Valor4;
     #75#15 = Valor6;
     #75#16 = Valor4 % 1205;
     #75#17 = Valor7;
     |GRABA 020#75a;
     |LIBERA #75;
     aNota1 = ""; aNota2 = ""; aNota3 = ""; aNota4 = ""; aNota5 = "";
     aNota6 = ""; aNota7 = ""; aNota8 = ""; aNota9 = ""; aNota10 = "";
     IaNota = aNota1<-;
|FPRC;

|PROCESO AnotaCli;
     empresa = path;
     |QBF empresa;
     aNomFic = "anotaciones.asc";
     aFicOrg = empresa + "anotaciones.asc";
     aFicDes = empresa + "anotaciones.txt";
     |HAZ Utf82Ansi;
     empresa = aFicDes;
     |XABRE "B", empresa, nHandle;
     |SI FSalida < 0;
          aAlfa = "0000Error al leer:" + aFicOrg;
          ||SI aParam = ""; |MENAV aAlfa; |FINSI;
     |SINO;
          nSwFichero = 2;
          |HAZ IniciaLineas;
          IaNota = aNota1<-;
          |ABRE #75;
          |XLEE nHandle, 250, aTmp;
          |PARA; |SI FSalida > 0; |HACIENDO;
               |PARA; |SI aTmp ! ""; |HACIENDO;
                    aCar = aTmp % 101;
                    |SI aTmp = aCar;
                         aTmp = ""; ||con un caracter falla: "aTmp = aTmp % 2"
                    |SINO;
                         aTmp = aTmp % 2;
                    |FINSI;
                    |HAZ Linea;
               |SIGUE;
               |XLEE nHandle, 250, aTmp;
          |SIGUE;
          |XCIERRA nHandle;
          |CIERRA #75;
     |FINSI;
     |RFBORRA aFicDes;
     |HAZ MueveHisto;
|FPRC;

|PROCESO GraAnotaGen;
     |DDEFECTO #74;
     #74#13 = Valor5;
     #74#14 = #9#77;
     |LEE 101#74=;
     |SI FSalida ! 0; |GRABA 020#74b; |FINSI;
     #74#0 = Valor1;
     #74#1 = aNota1;
     #74#2 = aNota2;
     #74#3 = aNota3;
     #74#4 = aNota4;
     #74#5 = aNota5;
     #74#6 = aNota6;
     #74#7 = aNota7;
     #74#8 = aNota8;
     #74#9 = aNota9;
     #74#10 = aNota10;
     #74#11 = Valor3;
     #74#12 = Valor4;
     |GRABA 020#74a;
     |LIBERA #74;
     aNota1 = ""; aNota2 = ""; aNota3 = ""; aNota4 = ""; aNota5 = "";
     aNota6 = ""; aNota7 = ""; aNota8 = ""; aNota9 = ""; aNota10 = "";
     IaNota = aNota1<-;
|FPRC;

|PROCESO AnotaGen;
     empresa = path;
     |QBF empresa;
     aNomFic = "anotaciones_generales.asc";
     aFicOrg = empresa + "anotaciones_generales.asc";
     aFicDes = empresa + "anotaciones_generales.txt";
     |HAZ Utf82Ansi;
     empresa = aFicDes;
     |XABRE "B", empresa, nHandle;
     |SI FSalida < 0;
          aAlfa = "0000Error al leer:" + aFicOrg;
          ||SI aParam = ""; |MENAV aAlfa; |FINSI;
     |SINO;
          nSwFichero = 1;
          |HAZ IniciaLineas;
          IaNota = aNota1<-;
          |ABRE #74;
          |XLEE nHandle, 250, aTmp;
          |PARA; |SI FSalida > 0; |HACIENDO;
               |PARA; |SI aTmp ! ""; |HACIENDO;
                    aCar = aTmp % 101;
                    |SI aTmp = aCar;
                         aTmp = ""; ||con un caracter falla: "aTmp = aTmp % 2"
                    |SINO;
                         aTmp = aTmp % 2;
                    |FINSI;
                    |HAZ Linea;
               |SIGUE;
               |XLEE nHandle, 250, aTmp;
          |SIGUE;
          |XCIERRA nHandle;
          |CIERRA #74;
     |FINSI;
     |RFBORRA aFicDes;
     |HAZ MueveHisto;
|FPRC;

|PROCESO GraContactos;
     |DDEFECTO #76;
     #76#0 = Valor1;
     #76#13 = #9#77;
     |LEE 101#76=;
     |SI FSalida ! 0; |GRABA 020#76b; |FINSI;
     #76#1 = Valor2;
     #76#2 = Valor3;
     #76#3 = Valor4;
     #76#4 = Valor5;
     #76#5 = Valor6;
     #76#6 = Valor7;
     #76#7 = Valor8;
     #76#8 = Valor9;
     #76#9 = Valor10;
     #76#10 = Valor11;
     #76#11 = Valor12;
     #76#12 = Valor13;
     #76#17 = Valor14;
     #76#18 = Valor15;
     |GRABA 020#76a;
     |LIBERA #76;
|FPRC;

|PROCESO Contacto;
     empresa = path;
     |QBF empresa;
     aNomFic = "contactos.asc";
     aFicOrg = empresa + "contactos.asc";
     aFicDes = empresa + "contactos.txt";
     |HAZ Utf82Ansi;
     empresa = aFicDes;
     |XABRE "B", empresa, nHandle;
     |SI FSalida < 0;
          aAlfa = "0000Error al leer:" + aFicOrg;
          ||SI aParam = ""; |MENAV aAlfa; |FINSI;
     |SINO;
          nSwFichero = 3;
          |HAZ IniciaLineas;
          IaNota = aNota1<-;
          |ABRE #76;
          |XLEE nHandle, 250, aTmp;
          |PARA; |SI FSalida > 0; |HACIENDO;
               |PARA; |SI aTmp ! ""; |HACIENDO;
                    aCar = aTmp % 101;
                    |SI aTmp = aCar;
                         aTmp = ""; ||con un caracter falla: "aTmp = aTmp % 2"
                    |SINO;
                         aTmp = aTmp % 2;
                    |FINSI;
                    |HAZ Linea;
               |SIGUE;
               |XLEE nHandle, 250, aTmp;
          |SIGUE;
          |XCIERRA nHandle;
          |CIERRA #76;
     |FINSI;
     |RFBORRA aFicDes;
     |HAZ MueveHisto;
|FPRC;
-------------------------------------------------------
|PROCESO GrabaCliNue;         || clientes modificados
     |DDEFECTO #80;
||     #80#18 = Valor19;
||     #80#19 = Valor20;
     #80#0 = ("000000" + Valor1) % -106;
     |LEE 101#80=;
     |SI FSalida ! 0; |GRABA 020#80b; |FINSI;
     IValor = Valor2<-;
     |PARA i = 1; |SI i [ 19; |HACIENDO i = i + 1;
          #80i = Valor;
          IValor = IValor + 1;
     |SIGUE;
     #80#11 = Valor12;         ||Tarifa
     #80#21 = Valor21;
     #80#22 = Valor22;
     #80#23 = Valor23;
     #80#24 = Valor24;
     #80#25 = Valor25;
     #80#26 = Valor26;
     #80#27 = Valor27;
     |GRABA 020#80a;
     |LIBERA #80;
|FPRC;

|PROCESO CliMod;
     empresa = path;
     |QBF empresa;
     aNomFic = "climod.asc";
     aFicOrg = empresa + "climod.asc";
     aFicDes = empresa + "climod.txt";
     |HAZ Utf82Ansi;
     empresa = aFicDes;
     |XABRE "", empresa, nHandle;
     |SI FSalida < 0;
          aAlfa = "0000Error al leer:" + aFicOrg;
          ||SI aParam = ""; |MENAV aAlfa; |FINSI;
     |SINO;
          |ABRE #80;
          |XLEE nHandle, 250, aDato;
          |PARA; |SI FSalida > 0; |HACIENDO;
               |HAZ Dato;
               |HAZ GrabaCliNue;
               |XLEE nHandle, 250, aDato;
          |SIGUE;
          |XCIERRA nHandle;
          |CIERRA #80;
     |FINSI;
     |RFBORRA aFicDes;
     |HAZ MueveHisto;
|FPRC;

|PROCESO GrabaCli;                 || clientes nuevos
     |DDEFECTO #21;
     #21#18 = Valor19;
     #21#19 = Valor20;
     #21#0 = ("000000" + Valor1) % -106;
     |LEE 101#21=;
     |SI FSalida ! 0; |GRABA 020#21b; |FINSI;
     IValor = Valor2<-;
     |PARA i = 1; |SI i [ 19; |HACIENDO i = i + 1;
          #21i = Valor;
          IValor = IValor + 1;
     |SIGUE;
     #21#11 = Valor12;         || Tarifa
     #21#21 = Valor21;
     #21#22 = Valor22;
     #21#23 = Valor23;
     #21#24 = Valor24;
     #21#25 = Valor25;
     #21#26 = Valor26;
     #21#27 = Valor27;
     |GRABA 020#21a;
     |LIBERA #21;
|FPRC;

|PROCESO Clientes;
     empresa = path;
     |QBF empresa;
     aNomFic = "clinue.asc";
     aFicOrg = empresa + "clinue.asc";
     aFicDes = empresa + "clinue.txt";
     |HAZ Utf82Ansi;
     empresa = aFicDes;
     |XABRE "", empresa, nHandle;
     |SI FSalida < 0;
          aAlfa = "0000Error al leer:" + aFicOrg;
          ||SI aParam = ""; |MENAV aAlfa; |FINSI;
     |SINO;
          |ABRE #21;
          |XLEE nHandle, 250, aDato;
          |PARA; |SI FSalida > 0; |HACIENDO;
               |HAZ Dato;
               |HAZ GrabaCli;
               |XLEE nHandle, 250, aDato;
          |SIGUE;
          |XCIERRA nHandle;
          |CIERRA #21;
     |FINSI;
     |RFBORRA aFicDes;
     |HAZ MueveHisto;
|FPRC;

|PROCESO GrabaDir;
     |DDEFECTO #22;
     #22#9 = Valor10;
     #22#10 = Valor11;
     #22#0 = ("000000" + Valor1) % -106;
     #22#1 = Valor2;
     |LEE 101#22=;
     |SI FSalida ! 0; |GRABA 020#22b; |FINSI;
     IValor = Valor2<-;
     |PARA i = 1; |SI i [ 8; |HACIENDO i = i + 1;
          #22i = Valor;
          IValor = IValor + 1;
     |SIGUE;
     |GRABA 020#22a;
     |LIBERA #22;
|FPRC;

|PROCESO DirEnt;
     empresa = path;
     |QBF empresa;
     aNomFic = "dirnue.asc";
     aFicOrg = empresa + "dirnue.asc";
     aFicDes = empresa + "dirnue.txt";
     |HAZ Utf82Ansi;
     empresa = aFicDes;
     |XABRE "", empresa, nHandle;
     |SI FSalida < 0;
          aAlfa = "0000Error al leer:" + aFicOrg;
          ||SI aParam = ""; |MENAV aAlfa; |FINSI;
     |SINO;
          |ABRE #22;
          |XLEE nHandle, 250, aDato;
          |PARA; |SI FSalida > 0; |HACIENDO;
               |HAZ Dato;
               |HAZ GrabaDir;
               |XLEE nHandle, 250, aDato;
          |SIGUE;
          |XCIERRA nHandle;
          |CIERRA #22;
     |FINSI;
     |RFBORRA aFicDes;
     |HAZ MueveHisto;
|FPRC;

|PROCESO cabecera;
     empresa  = "";
     cadena   = "";
     fichero  = "";
     long     = "";
     caracter = "";
     campo    = "";
     i        = 0;
     f        = 0;
     ind      = 0;
     valor    = 0;
     sw       = 0;
     pasa     = 0;
     jj       = 0;
     sal      = 0;
     guarda   = 0;
     empresa = path;
     |QBF empresa;
     aNomFic = "cabalb.asc";
     aFicOrg = empresa + "cabalb.asc";
     aFicDes = empresa + "cabalb.txt";
     |HAZ Utf82Ansi;
     empresa = aFicDes;

     |XABRE "", empresa, nHandle;
     |SI FSalida < 0;
          aAlfa = "0000Error al leer:" + aFicOrg;
          ||SI aParam = ""; |MENAV aAlfa; |FINSI;
          |ACABA;
     |FINSI;
     |ABRE #1;

     sal = 0;
     |PARA jj = 1; |SI sal ] 0; |HACIENDO jj = jj + 1;
           |XLEE nHandle, 254, cadena;
           sal = FSalida;
           |SI FSalida > 1;
                |PINTA 2003,"                                                                       ";
                |PINTA 2003,cadena;
                aDato = cadena;
                |HAZ Dato;

                |DDEFECTO #1;
                #1#0 = Valor1;
                #1#1 = Valor2;
                #1#2 = Valor3;
                |LEE 101#1=;
                guarda = FSalida;
                #1#3 = Valor4;
                #1#4 = ("000000" + Valor5) % -106;
                ||#1#4 = Valor5;
                #1#6 = Valor6;
                #1#7 = Valor7;
                #1#39 = Valor8;|| Solo lo usa el modulo 002448
                #1#11 = Valor11;
                #1#12 = Valor12;
                #1#13 = Valor13;
                |SI #9#71 = "S";
                     #1#32 = Valor14;    || Dir. Entrega
                |SINO;
                     #1#32 = 1;
                |FINSI;
                |SI #1#32 = 0; #1#32 = 1; |FINSI;

                |SI Valor15 ! ""; #1#33 = Valor15; |FINSI;
                #1#34 = Valor16;
                #1#35 = Valor17;
                |SI #9#59 ] 2;
                     aAlfa = Valor10; |QBT aAlfa;
                     |SI aAlfa ! "0"; |Y aAlfa ! "00";
                          #1#37 = Valor10;
                     |FINSI;
                |FINSI;
                #1#10 = Valor19;
                #1#7 = #1#7 ! #15#7;
                #1#40 = #9#59;
                #1#41 = Valor20;
                #1#42 = Valor21;
                |HAZ grabacabeza;
           |FINSI;
     |SIGUE;
     |XCIERRA nHandle;
     |CIERRA #1;
     |RFBORRA aFicDes;
     |HAZ MueveHisto;
|FPRC;

|| ------------------------ GRABA FICHERO CABECERA --------------------------
|PROCESO Suma;
     enTiva = #2#9;
     efFiva = #1#3;
     |HAZ SacaIVA;

     ||ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
||T.Linea
    #2#10 = ((#2#6 * #2#7) < #2#8) ! #15#7;

||Bruto
     #1#8 = (#1#8 +. #2#10) ! #15#7;
     nBruto = #2#10;
     nImpDto1 = (nBruto % #1#11) ! #15#7;
     nBruto = nBruto - nImpDto1;

     nImpDto2 = (nBruto % #1#13) ! #15#7;
     nBruto = nBruto - nImpDto2;

     nImpDto3 = (nBruto % #1#12) ! #15#7;
     nBruto = nBruto - nImpDto3;

||Dto
     #1#30 = #1#30 + nImpDto1 + nImpDto2 + nImpDto3;

||Ivas
     |SI #2#9 = 0;
          #1#14 = (#1#14 +. nBruto) ! #15#7;
     |SINO;
          nCamBase = #2#9 - 1 + 15;
          nCamIva = #2#9 - 1 + 20;
          nCamRec = #2#9 - 1 + 25;
          #1nCamBase = (#1nCamBase +. nBruto) ! #15#7;
          #1nCamIva = (#1nCamBase %  enIva) ! #15#7;
          |SI #3#47 = "S"; |Y #1#0 ! "C";
               #1nCamRec = (#1nCamBase % enRec) ! #15#7;
          |FINSI;
     |FINSI;

||T.IVA
     #1#31 = #1#20+#1#21+#1#22+#1#23+#1#24+#1#25+#1#26+#1#27+#1#28+#1#29;
     #1#31 = #1#31 ! #15#7;

||Total
     #1#9 = (#1#8 - #1#30 + #1#31) ! #15#7;
|FPRC;

|DEFBUCLE totalalb;
     #2#1;
     ;
     #1#0,#1#2,#1#1,000;
     #1#0,#1#2,#1#1,999;
     be;
     NULL, Suma;
|FIN;

|PROCESO grabacabeza;
     |SI nEsCarnicas = 0;
          |HAZ AltaCarnicasPSa;
     |FINSI;

     #1#8 = 0;
     #1#9 = 0;
     |PARA i = 14; |SI i [ 31; |HACIENDO i = i + 1;
          #1i = 0;
     |SIGUE;

     |SI #1#0 = "C";
          |ABRE #112;
          #112#0 = #1#4;
          |LEE 000#112=;
          |CIERRA #112;
          #1#5 = #112#2;      || nombre comercial
     |SINO;
          |ABRE #3;
          #3#0 = #1#4;
          |LEE 000#3=;
          |CIERRA #3;
          #1#5 = #3#2;        || nombre comercial
          |SI #1#10 = "  "; |O #1#10 = "00";
               #1#10 = #3#25;
               |SI #0#3 = "S";
                   #1#10 = represen;
               |SINO;
                   |SI nRepresen = 1;
                       #1#10 = #3#25;      || representante 1 del cliente
                   |FINSI;
                   |SI nRepresen = 2;
                       #1#10 = #3#26;      || representante 2 del cliente
                   |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;

     |BUCLE totalalb;

/* Segun tiquet: 577/1587
     |SI nSwJamaica = 0
          || El txt trae el campo correcto y no se recalcula
     |SINO;
          ||.. la estandar
          |SI #1#7 [ 0;
              #1#6 = "N";
          |FINSI;
          |SI #1#7 ] #1#9;
              #1#6 = "S";
          |FINSI;
          |SI #1#7 < #1#9; |Y #1#7 > 0;
              #1#6 = "P";
          |FINSI;
          total = #1#9 - #1#7;
          total = total ! #15#7;
          |SI total < 0; total = -total;     |FINSI;   || valor absoluto
          |SI total [ 0.05;
              #1#6 = "S";
              #1#7 = #1#9;
          |FINSI;
     |FINSI;
*/
     |SI aSwLinPromo = "S";
          #1#38 = "S";
     |SINO;
          #1#38 = "N";
     |FINSI;

     |SI guarda ! 0;
         |GRABA 121#1n;
     |SINO;
         |GRABA 121#1a;
     |FINSI;
     |LIBERA #1;
     |DDEFECTO #1;
|FPRC;


|| ------------------------ GRABA FICHERO Movimi --------------------------

|| ------------- LEE LINEAS ---------------
|PROCESO lineas;
     empresa  = "";
     cadena   = "";
     fichero  = "";
     long     = "";
     caracter = "";
     campo    = "";
     i        = 0;
     f        = 0;
     ind      = 0;
     valor    = 0;
     sw       = 0;
     pasa     = 0;
     jj       = 0;
     sal      = 0;
     guarda   = 0;
     impuesto = 0;
     empresa = path;
     |QBF empresa;
     aNomFic = "linalb.asc";
     aFicOrg = empresa + "linalb.asc";
     aFicDes = empresa + "linalb.txt";
     |HAZ Utf82Ansi;
     empresa = aFicDes;
     |XABRE "", empresa, nHandle;
     |SI FSalida < 0;
          aAlfa = "0000Error al leer:" + aFicOrg;
          ||SI aParam = ""; |MENAV aAlfa; |FINSI;
          |ACABA;
     |FINSI;


     |SI #9#99 = "S";
          |HAZ CreaTempo; |NOME_DAT #2 Tempo; |DELINDEX #2; eaTmp2 = Tempo;
     |FINSI;

     |ABRE #2;
     sal = 0;
     linea = 1;
     |PARA jj = 1; |SI sal ] 0; |HACIENDO jj = jj + 1;
           |XLEE nHandle, 254, cadena;
           sal = FSalida;
           |SI FSalida > 1;
               |PINTA 2003,"                                                                       ";
               |PINTA 2003,cadena;
               ||linea = 1;
               |HAZ QuitaRarosImp;
               long = cadena % 0;
               sw = 0;
               |PARA ind = 1; |SI ind [ long; |HACIENDO ind = ind + 1;
                     i = (ind * 100) + 1;
                     caracter = cadena % i;
                     valor = &caracter;
                     |SI valor ! 9; |Y valor ! 13;|Y valor ! 10;
                         campo = campo + caracter;
                     |FINSI;
                     |SI valor = 9; |O long = ind;
                         pasa = sw;
                         |SI pasa = 10;
                             #2#5 = campo;
                         |FINSI;
                         |SI pasa ] 10;
                              |SI sw = 11; #2#12 = campo; |FINSI; ||partida
                              |SI #9#59 = 1; || PSION
                                    |SI sw = 12; #2#11 = campo; |FINSI; ||almacen
                                    |SI sw = 13; #2#13 = campo; |FINSI; ||dto2
                              |FINSI;
                              |SI #9#59 ] 2; || PDA
                                    |SI sw = 12; #2#15 = campo; |FINSI; ||envase
                                    |SI sw = 13; #2#16 = campo; |FINSI; ||unidades
                                    |SI sw = 14; #2#17 = campo; |FINSI; ||cascada
                                    |SI sw = 15; #2#18 = campo; |FINSI; ||Imp.Dto Promo
                                    |SI sw = 16; #2#13 = campo; |FINSI; ||dto2
                                    |SI sw = 17; #2#19 = campo; |FINSI; ||Promocion
                                    |SI sw = 18; #2#20 = campo; |FINSI; ||Unidad_2
                              |FINSI;
                              campo = "";
                              sw = sw + 1;
                         |SINO;
                             |SI pasa = 3;
                                 |SI fra ! #2#1; |O aClase ! #2#0; |O aSer ! #2#2;
                                     linea = 1
                                     fra = #2#1;
                                     aClase = #2#0;
                                     aSer = #2#2;
                                 |FINSI;
                               || #2pasa = linea;
                                 #2pasa = campo;
                                 campo = "";
                                 texto2 = texto + pasa + texto1 + linea;
                                 linea = linea + 1;
                                 sw = sw + 1;
                                 |LEE 141#2=;
                                 |LIBERA #2;
                                 guarda = FSalida;
                             |SINO;
                                 |SI pasa = 5; pasa = 6;sw = sw + 1;|FINSI;
                                 |SI pasa = 4; aAlfa = campo; |HAZ ArtCoimasa; campo = aAlfa; |FINSI;
                                 #2pasa = campo;
                                 texto2 = texto + pasa + texto1 + campo;
                                 campo = "";
                                 sw = sw + 1;
                             |FINSI;
                         |FINSI;
                     |FINSI;
               |SIGUE;
               |HAZ grabalineas;
               campo = "";
           |FINSI;
     |SIGUE;

     |XCIERRA nHandle;
     |CIERRA #2;

     |SI #9#99 = "S";
          |HAZ AsignaPartidas;
          Tempo = eaTmp2; |HAZ BoraTempo; |DELINDEX #2;
          |NOME_DAT #2Apsioa005
     |FINSI;

     |RFBORRA aFicDes;
     |HAZ MueveHisto;
|FPRC;

|| ------------------------ GRABA FICHERO LINEAS ----------------------------
|PROCESO grabalineas;
     bruto    = 0;
     impuesto = 0;
     |ABRE #4;           || Articulos
     #4#0 = #2#4;
     |LEE 000#4=;
     |SI #9#59 = 1; |Y #9#72 = "N";  || El Pda tra la descripcion en el asc
          #2#5 = #4#1;
     |FINSI;
     |CIERRA #4;

     enTiva = #2#9;
     efFiva = #1#3;
     |HAZ SacaIVA;
     impuesto = enIva;

     |SI #1#0 = "C";
          |ABRE #112;
          #112#0 = #1#4;
          |LEE 000#112=;
          |CIERRA #112;
     |SINO;
          |ABRE #3;
          #3#0 = #1#4;
          |LEE 000#3=;
          |CIERRA #3;
          |SI #3#47 = "S"; impuesto = enIva + enRec; |FINSI;
     |FINSI;

     bruto = #2#6 * #2#7;          || base.
     bruto = bruto < #2#8;         || dto.
     bruto = bruto ! #15#7;
     #2#10 = bruto;                || bruto.

     |SI #2#11 = 0; #2#11 = almacen; |FINSI;
     |SI #2#11 = 0; #2#11 = 1; |FINSI;

     #2#14 = #2#11;         || Almacen (no se usa para nada)

     |SI guarda ! 0;
         |GRABA 121#2n;
     |SINO;
         |GRABA 121#2a;
     |FINSI;
     |LIBERA #2;
     |DDEFECTO #2;
|FPRC;

|PROCESO movimi;
|| ----------------- LEE EL FICHERO SEQUENCIAL DEL PSION --------------------
     empresa  = "";
     cadena   = "";
     fichero  = "";
     long     = "";
     caracter = "";
     campo    = "";
     i        = 0;
     f        = 0;
     ind      = 0;
     valor    = 0;
     sw       = 0;
     pasa     = 0;
     jj       = 0;
     sal      = 0;
     guarda   = 0;
     empresa = path;
     |QBF empresa;
     aNomFic = "movimie.asc";
     aFicOrg = empresa + "movimie.asc";
     aFicDes = empresa + "movimie.txt";
     |HAZ Utf82Ansi;
     empresa = aFicDes;
     |XABRE "", empresa, nHandle;
     |SI FSalida < 0;
          aAlfa = "0000Error al leer:" + aFicOrg;
          ||SI aParam = ""; |MENAV aAlfa; |FINSI;
          |ACABA;
     |FINSI;
     |ABRE #7;

     sal = 0;
     |PARA jj = 1; |SI sal ] 0; |HACIENDO jj = jj + 1;
           |XLEE nHandle, 254, cadena;
           sal = FSalida;
           |SI FSalida > 1;
               |PINTA 2003,"                                                                       ";
               |PINTA 2003,cadena;
               |HAZ QuitaRarosImp;
               long = cadena % 0;
               sw = 0;
               |PARA ind = 1; |SI ind [ long; |HACIENDO ind = ind + 1;
                     i = (ind * 100) + 1;
                     caracter = cadena % i;
                     valor = &caracter;
                     |SI valor ! 9; |Y valor ! 13;|Y valor ! 10;
                         campo = campo + caracter;
                     |FINSI;
                     |SI valor = 9; |O long = ind;
                         pasa = sw;
                         |SI pasa = 0; aAlfa = campo; |HAZ ArtCoimasa; campo = aAlfa; |FINSI;
                         |SI pasa = 11;
                              aAlfa = (campo % 902) + "/" + (campo % 602) + "/" + (campo % 104);
                              #7#5 = aAlfa;
                         |SINO;
                              #7pasa = campo;
                         |FINSI;
                         campo = "";
                         sw = sw + 1;
                         |SI sw = 5;
                             sw = sw + 2;
                         |FINSI;
                         |SI pasa = 2;
                              |SALVA_DATOS #7;
                              |LEE 000#7u;
                              |SI FSalida = 0;
                                   conta = #7#6 + 1;
                              |SINO;
                                   conta = 1;
                              |FINSI;
                              |REPON_DATOS #7;
                              #7#5 = ~;
                              #7#6 = conta;
                              |GRABA 020#7b;
                         |FINSI;
                     |FINSI;
               |SIGUE;
               |GRABA 121#7a;
               |LIBERA #7;
               |DDEFECTO #7;
               campo = "";
           |FINSI;
     |SIGUE;

     |XCIERRA nHandle;
     |CIERRA #7;
     |RFBORRA aFicDes;
     |HAZ MueveHisto;
|FPRC;

|PROCESO GrabaCobroFac;
     #6#0 = Valor1; Valor1 = #6#0;
     #6#1 = Valor2;
     #6#2 = Valor3;
     #6#18 = 0;
     |LEE 101#6];
     |SI FSalida ! 0; |O #6#0 ! Valor1; |O #6#1 ! Valor2; |O #6#2 ! Valor3;
          |DDEFECTO #6;
          #6#0 = Valor1;
          #6#1 = Valor2;
          #6#2 = Valor3;
          #6#18 = 1;
          |GRABA 020#6b;
     |SINO;
          |LIBERA #6;
          #6#0 = Valor1;
          #6#1 = Valor2;
          #6#2 = Valor3;
          #6#18 = 999;
          |LEE 000#6];
          |SI FSalida = 0;
               |LEE 000#6a;
          |SINO;
               |LEE 000#6u;
          |FINSI;
          |SI FSalida ! 0; |O #6#0 ! Valor1; |O #6#1 ! Valor2; |O #6#2 ! Valor3;
               nCobro = 1;
          |SINO;
               nCobro = #6#18 + 1;
          |FINSI;
          |DDEFECTO #6;
          #6#0 = Valor1;
          #6#1 = Valor2;
          #6#2 = Valor3;
          #6#18 = nCobro;
          |GRABA 020#6b;
     |FINSI;
     #6#3 = Valor4;
     #6#4 = Valor5;
     #6#5 = Valor6;
     #6#6 = Valor7;
     #6#7 = Valor9;
     #6#8 = 0;     ||Valor10;
     #6#9 = Valor11;

     #6#4 = #6#4 ! #15#7;
     #6#5 = #6#5 ! #15#7;

     |SI nSwJamaica = 0;
          || El txt trae el campo correcto y no se recalcula
     |SINO;
          || la estandar
          |SI #9#59 = 2; #6#6 = "S"; |FINSI;
     |FINSI;

     |SI #9#59 = 3;
          #6#9 = Valor10;
          #6#11 = Valor11;
          #6#12 = Valor12;
          #6#13 = Valor13;
          #6#14 = Valor14;
          #6#15 = Valor15;
          #6#19 = Valor16;
     |FINSI;
     #6#16 = #9#59;

     |ABRE #3;
     #3#0 = #6#3;
     |LEE 000#3=;
     |SI FSalida ! 0; |DDEFECTO #3; |FINSI;
     |CIERRA #3;
     #6#17 = #3#2;

     |GRABA 020#6a;
     |LIBERA #6;
|FPRC;

|PROCESO cobros;
     empresa = path;
     |QBF empresa;
     aNomFic = "cobros.asc";
     aFicOrg = empresa + "cobros.asc";
     aFicDes = empresa + "cobros.txt";
     |HAZ Utf82Ansi;
     empresa = aFicDes;
     |XABRE "", empresa, nHandle;
     |SI FSalida < 0;
          aAlfa = "0000Error al leer:" + aFicOrg;
          ||SI aParam = ""; |MENAV aAlfa; |FINSI;
     |SINO;
          |ABRE #6;
          |XLEE nHandle, 250, aDato;
          |PARA; |SI FSalida > 0; |HACIENDO;
               |HAZ Dato;
               |HAZ GrabaCobroFac;
               |XLEE nHandle, 250, aDato;
          |SIGUE;
          |XCIERRA nHandle;
          |CIERRA #6;
     |FINSI;
     |RFBORRA aFicDes;
     |HAZ MueveHisto;
|FPRC;

|PROCESO GrabaCobroAlb;
     #8#0 = Valor1; Valor1 = #8#0;
     #8#1 = Valor2;
     #8#2 = Valor3;
     #8#17 = 0;
     |LEE 101#8];
     |SI FSalida ! 0; |O #8#0 ! Valor1; |O #8#1 ! Valor2; |O #8#2 ! Valor3;
          |DDEFECTO #8;
          #8#0 = Valor1;
          #8#1 = Valor2;
          #8#2 = Valor3;
          #8#17 = 1;
          |GRABA 020#8b;
     |SINO;
          |LIBERA #8;
          #8#17 = 99;
          |LEE 000#8];
          |SI FSalida = 0;
               |LEE 000#8u;
          |SINO;
               |LEE 000#8a;
          |FINSI;
          nCobro = #8#17 + 1;
          |DDEFECTO #8;
          #8#0 = Valor1;
          #8#1 = Valor2;
          #8#2 = Valor3;
          #8#17 = nCobro;
          |GRABA 020#8b;
     |FINSI;
     #8#3 = Valor4;
     #8#4 = Valor5;
     #8#5 = Valor6;
     #8#6 = Valor7;
     #8#7 = 0; || Valor8;
     #8#8 = Valor9;

     #8#4 = #8#4 ! #15#7;
     #8#5 = #8#5 ! #15#7;

     |SI nSwJamaica = 0;
          || El txt trae el campo correcto y no se recalcula
     |SINO;
          || la estandar
          |SI #9#59 = 2; #8#6 = "S";|FINSI;
     |FINSI;

     |SI #9#59 = 3;
          #8#8 = Valor9;
          #8#10 = Valor10;
          #8#11 = Valor11;
          #8#12 = Valor12;
          #8#13 = Valor13;
          |SI Valor14 = "//"; Valor14 = "01.01.0000"; |FINSI;
          #8#14 = Valor14;
          #8#18 = Valor15;
     |FINSI;
     #8#15 = #9#59;
     |ABRE #3;
     #3#0 = #8#3;
     |LEE 000#3=;
     |SI FSalida ! 0; |DDEFECTO #3; |FINSI;
     |CIERRA #3;
     #8#16 = #3#2;

     |GRABA 020#8a;
     |LIBERA #8;
|FPRC;

|PROCESO cobrosalb;
     empresa = path;
     |QBF empresa;
     aNomFic = "cobros1.asc";
     aFicOrg = empresa + "cobros1.asc";
     aFicDes = empresa + "cobros1.txt";
     |HAZ Utf82Ansi;
     empresa = aFicDes;
     |XABRE "", empresa, nHandle;
     |SI FSalida < 0;
          aAlfa = "0000Error al leer:" + aFicOrg;
          ||SI aParam = ""; |MENAV aAlfa; |FINSI;
     |SINO;
          |ABRE #8;
          |XLEE nHandle, 250, aDato;
          |PARA; |SI FSalida > 0; |HACIENDO;
               |HAZ Dato;
               |HAZ GrabaCobroAlb;
               |XLEE nHandle, 250, aDato;
          |SIGUE;
          |XCIERRA nHandle;
          |CIERRA #8;
     |FINSI;
     |RFBORRA aFicDes;
     |HAZ MueveHisto;
|FPRC;

|| ------------------------- RUTINA PRINCIPAL -------------------------------
|PROCESO captura; |TIPO 3;
     |SI #0#1 = "SI";
          |SI #0#5 = "S";
               |PARA v = 6;|SI v [ 15;|HACIENDO v = v + 1;
                    aAlfa = #0v; |QBF aAlfa;
                    |SI aAlfa = "";
                         |SI aParam = ""; |MENAV "0000FIN DE PROCESOS"; |FINSI;
                         |SAL;
                    |FINSI;
                    |ABRE #9;
                    #9#0 = #0v;
                    |LEE 000#9=;
                    |SI FSalida = 0;
                         empresa  = #9#75;
                         path     = #9#75;
                         almacen  = #9#27;
                         represen = "N";
                         |HAZ inicio;
                    |FINSI;
                    |CIERRA #9;
               |SIGUE;
          |SINO;
               |ABRE #9;
               #9#0 = #0#2;
               |LEE 000#9=;
               |SI FSalida = 0;
                    empresa  = #9#75;
                    path     = #9#75;
                    almacen  = #0#0;
                    represen = #0#4;
                    |HAZ inicio;
               |FINSI;
               |CIERRA #9;
          |FINSI;
          |SI aParam = ""; |MENAV "0000FIN DE PROCESOS"; |FINSI;
     |FINSI;
|FPRC;

|CALCULO varios;
     |SI #0#5 = "N";
         |PARA i = 6;|SI i [ 15;|HACIENDO i = i + 1;
               |C_M #0i , 1 , "N";
               |C_M #0#0 , 1 , "S";
               |C_M #0#2 , 1 , "S";
               |C_M #0#3 , 1 , "S";
               |C_M #0#4 , 1 , "S";
         |SIGUE;
         |C_M #0#16, 1, "S";
     |SINO;
         |PARA i = 6;|SI i [ 15;|HACIENDO i = i + 1;
               |C_M #0i , 1 , "S";
               |C_M #0#0 , 1 , "N";
               |C_M #0#2 , 1 , "N";
               |C_M #0#3 , 1 , "N";
               |C_M #0#4 , 1 , "N";
         |SIGUE;
         |C_M #0#16, 1, "N";
         #0#16 = ""; |PINTA #0#16;
     |FINSI;
|FCAL;

|PROCESO LeeDivisa;
     |ABRE #14;
     |ABRE #15;
     #14#0 = "A";
     |LEE 000#14=;
     |SI FSalida ! 0; |DDEFECTO #14; |FINSI;
     #15#0 = #14#9;
     |LEE 000#15=;
     |SI FSalida ! 0; |DDEFECTO #15; |FINSI;
     |CIERRA #14;
     |CIERRA #15;
|FPRC;

|CALCULO inicio;
     |HORA aHoraHis;
     aHoraHis = (aHoraHis % 102) + (aHoraHis % 402) + (aHoraHis % 702);

     |SI #9#83 = "S";
          |DELINDEX #1;
          |DELINDEX #2;
          |DELINDEX #6;
          |DELINDEX #7;
          |DELINDEX #8;
          |DELINDEX #201;
          |DELINDEX #202;
     |FINSI;

     aPath = #9#75; |QBF aPath;
     aLon = aPath % A0;
     nPos = 100 + (aLon - 1);
     aPath = aPath % nPos;
     |SI #0#5 = "S"; |O aParam ! "";
          aEjecuta = #9#80; |QBF aEjecuta;
     |SINO;
          aEjecuta = #0#16; |QBF aEjecuta;
     |FINSI;
     |SI aEjecuta ! "";
          |PUSHV 0501 2380;
          |PINPA #0#100;
          |PINDA #0#100;
          |PTEC 802;
          |ENDATOS #1#100;
          ||PINTA 1916 , "                           ";
          ||PINTA 1916 , "Sincronizando datos........";
          aEjecuta = aEjecuta + " " + #9#77; |QBF aEjecuta;
          aEjecuta = aEjecuta + " " + aPath;
          |SI #9#81 = "S";
               |SYSTEM aEjecuta;
          |SINO;
               |RSYSTEM aEjecuta;
          |FINSI;
          |POPV;
     |FINSI;

     aReturn = &10;
     aEnter = &13;
     aTab = &9;
     empresa = path;
     |QBF empresa;
     aNomFic = "param.asc";
     aFicOrg = empresa + "param.asc";
     |SI #9#76 = "C";
          |XABRE "C", aFicOrg, nHandle;
     |SINO;
          |XABRE "", aFicOrg, nHandle;
     |FINSI;
     |SI FSalida ] 0;
          |XLEE nHandle, 100, aSwLinPromo;
          |XCIERRA nHandle;
     |FINSI;
     |HAZ MueveHisto;

     |ABRE #2;
     |PINTA 1916 , "                           ";
     |PINTA 1916 , "Documentos Lineas .........";
     |HAZ lineas;
     |LIBERA #2;
     |CIERRA #2;

     |ABRE #1;
     |PINTA 1916 , "                           ";
     |PINTA 1916 , "Documentos Cabeceras ......";
     |HAZ cabecera;
     |LIBERA #1;
     |CIERRA #1;
     |ABRE #6;
     |PINTA 1916 , "                           ";
     |PINTA 1916 , "Cobros Facturas............";
     |HAZ cobros;
     |LIBERA #6;
     |CIERRA #6;
     |ABRE #8;
     |PINTA 1916 , "                           ";
     |PINTA 1916 , "Cobros Albaranes...........";
     |HAZ cobrosalb;
     |LIBERA #8;
     |CIERRA #8;
     |ABRE #7;
     |PINTA 1916 , "                           ";
     |PINTA 1916 , "Movimientos Almacen .......";
     |HAZ movimi;
     |LIBERA #7;
     |CIERRA #7;
     |SI #9#59 ] 2;
          |PINTA 1916 , "                           ";
          |PINTA 1916 , "Clientes Nuevos............";
          |HAZ Clientes;
          |PINTA 1916 , "                           ";
          |PINTA 1916 , "Direcciones Entrega........";
          |HAZ DirEnt;
          |PINTA 1916 , "                           ";
          |PINTA 1916 , "Clientes Modificados.......";
          |HAZ CliMod;
     |FINSI;
     |SI #9#59 = 3;
          |PINTA 1916 , "                           ";
          |PINTA 1916 , "Anotaciones generales......";
          |HAZ AnotaGen;
          |PINTA 1916 , "                           ";
          |PINTA 1916 , "Anotaciones cliente........";
          |HAZ AnotaCli;
          |PINTA 1916 , "                           ";
          |PINTA 1916 , "Contactos..................";
          |HAZ Contacto;
     |FINSI;
     |SI nSwCepsax = 0;
          |HAZ CanonCab;
          |HAZ CanonLin;
     |FINSI;
     |SI nSwCoimasa = 0;
          |HAZ CoimaExtra;
     |FINSI;

     |SI #9#83 = "S";
          |SUB_EJECUTA_NP "psioa006;psioa003"
     |FINSI;
|FCAL;

|PROCESO Utf82Ansi;
     |SI #9#59 = 1; |O #9#76 = "S";
          |DFICE aFicDes; aFicDes = aFicDes + Usuario;
          |FBORRA aFicDes;
          |SI #9#76 = "C";
               |RECIBE_FICHERO aFicOrg, aFicDes;
          |SINO;
               |COPIA_FICHERO aFicOrg, aFicDes;
          |FINSI;
     |SINO;
          aIP = "";
          |IP_REMOTO aIP;
          |DBASE aBase;
          |ESPECIFICA "RBASS", aLocal;

          aOrigen = aBase + "00psion/ansitoutf8.exe"
          aDestino = aLocal + "/bin/ansitoutf8.exe";
          aConte = aOrigen;
          |ESPECIFICA "MD5", aConte;
          aVer1 = FSalida;
          aConte = aDestino;
          |ESPECIFICA "REMOTOMD5", aConte;
          aVer2 = FSalida;
          |SI aVer1 ! aVer2;
               |SI aIP ! "";
                    |ENVIA_FICHERO aOrigen, aDestino;
               |SINO;
                    |COPIA_FICHERO aOrigen, aDestino;
               |FINSI;
          |FINSI;

          aAlfa = aDestino + " 5 " + aFicOrg + " " + aFicDes;
          aLon = aAlfa % A0;
          aExe = "";
          |PARA i = 1; |SI i [ aLon; |HACIENDO i = i + 1;
               nPos = i * 100 + 1;
               aCar = aAlfa % nPos;
               |SI aCar = "/"; aCar = "\"; |FINSI;
               aExe = aExe + aCar;
          |SIGUE;

          aExe = "cmd " + &34 + "/c START /MIN /WAIT " + aExe + &34;
          |RSYSTEM aExe;

          aOrigen = aFicDes;
          |DFICE aFicDes; aFicDes = aFicDes + Usuario;
          |FBORRA aFicDes;
          |RECIBE_FICHERO aOrigen, aFicDes;
          |RFBORRA aOrigen;
     |FINSI;
|FPRC;


|PROGRAMA;
     aParam = PARAMETRO;
     |HAZ EsCarnicas; nEsCarnicas = FSalida;
     |HAZ EsJamaica; nSwJamaica = FSalida;
     |HAZ EsCoimasa; nSwCoimasa = FSalida;
     |HAZ EsCepsax; nSwCepsax = FSalida;

     ||HAZ LeeDivisa;
     |HAZ DecimalesBase;

     |SI aParam = "";
          |PINPA #0#0;
          |PINDA #0#0;
          |ENDATOS #1#0;
     |SINO;
          #0#2 = aParam;
          #0#1 = "SI";
          |HAZ captura;
     |FINSI;
|FPRO;
