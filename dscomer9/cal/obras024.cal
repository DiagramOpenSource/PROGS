|FICHEROS;
    obras024  #0; || Seleccion.
    obras005  #1; || Cab.Presupuesto.
    obras006  #2; || Lineas Presupuesto.
    obras001  #3; || Obras.
    obras016  #4; || Desglose Presupuesto.
    agifa019  #5; || Articulos....
|FIN;

|VARIABLES;
     nObra = 0;
     aAlfa = "";
    impre=0;
    &ag  =0;
    &pa  =0;
    &des ="";
    sw   =0;
   &imp  =0;
   &toag =0;
   &toap =0;
   &toob =0;
   &tl   =0;
    tj   =0;
   swcomp=0;
    &tcp =0;
    &tcu =0;
    &tjk =0;
    &tju =0;
    art  ="";
    swart = 0;
|FIN;


|PROCESO  mayus;  |TIPO 0;
        #0#1 = #0#1 > " ";
        |PINTA #0#1;
|FPRC;

|PROCESO prolee_con;
     tcp = tcp + #4#8;
|FPRC;

|DEFBUCLE lee_con;
    #4#2;
    ;
    #2#0,#2#1,#2#2,#2#3;
    #2#0,#2#1,#2#2,#2#3;
    ;
    NULL,prolee_con;
|FIN;

|PROCESO cargai;
   tcp=0;
   |BUCLE lee_con;
|FPRC;

|PROCESO prolee_econ;
  |SI swart = 0;
      swart = 1;
      art = #4#9;
  |FINSI;
  |SI art ! #4#9;
    |ABRE #5;
    #5#0 = art;
    |LEE 101#5=;
    |LIBERA #5;
    |CIERRA #5;
    tl=33;
    |PRINT;
    impre=1;
    art = #4#9;
    tjk = 0;
    tju = 0;
  |FINSI;
    tjk = tjk + #4#8;
    tju = tju + #4#7;
|FPRC;

|DEFBUCLE lee_econ;
     #4#3;
     ;
     #2#0,#2#1,#2#2,#2#3,"                    ";
     #2#0,#2#1,#2#2,#2#3,"zzzzzzzzzzzzzzzzzzzz";
     ;
     NULL,prolee_econ;
|FIN;

|PROCESO leees;
   swart = 0;
    tjk = 0;
    tju = 0;
   |BUCLE lee_econ;
   |SI swart ! 0;
    |ABRE #5;
    #5#0 = art;
    |LEE 101#5=;
    |LIBERA #5;
    |CIERRA #5;
    tl=33;
    |PRINT;
    impre=1;
   |FINSI;
|FPRC;

|PROCESO prolin;
     |SALVA_FICHA #1;
     #1#0 = nObra;
     |LEE 000#1=;

     |HAZ cargai;
     |SI tcp ! 0;
          |SI #0#1 ! "A"; |Y #0#1 ! "P";

               |SALVA_FICHA #2;
               #2#0 = nObra;
               |LEE 000#2=;

               |PRINT;

               |REPON_FICHA #2;

               impre=1;
               |HAZ leees;
               tl=2;
          |FINSI;
          toag=toag+tcp;
          toap=toap+tcp;
          toob=toob+tcp;
     |FINSI;

     |REPON_FICHA #1;
|FPRC;

|PROCESO propre;
     nObra = #1#0;
     aAlfa = #1#5; |QBF aAlfa;
     |SI aAlfa ! "";             ||Es una copia
           aAlfa = aAlfa % 103;
           |SI #1#0 ! #0#0; |Y aAlfa ! #0#0; |ERROR; |ACABA; |FINSI;
           |SI #0#4 = "O";
               nObra = aAlfa;
           |FINSI;
     |SINO;
           |SI #1#0 ! #0#0; |ERROR; |ACABA; |FINSI;
           |SI #1#4 ! #0#4; |ERROR; |ACABA; |FINSI;
     |FINSI;

     |SALVA_FICHA #1;
     #1#0 = nObra;
     |LEE 000#1=;

     |SI sw = 0;
      ag = #1#1;
      pa = #1#2;
      des= #1#3;
      sw = 1;
      tl = 0;
     |FINSI;

   |SI ag ! #1#1;
    |SI #0#1= "P";
      |PRINT;
      impre=0;
    |FINSI;
      tl = 4;
      |PRINT;
      impre=1;
      pa=#1#2;
      des=#1#3;
      ag=#1#1;
      tl=0;
      toag=0;
      toap=0;
   |FINSI;
   |SI pa ! #1#2;
    |SI #0#1 ! "A";
    |SI #0#1 ! "P"; tl = 3;  |FINSI;
      |PRINT;
      impre=1;
    |FINSI;
      pa=#1#2;
      des=#1#3;
      tl = 1;
      toap=0;
   |FINSI;

     |REPON_FICHA #1;
|FPRC;

|DEFBUCLE leepre;
    #1#1;
    ;
    000,00,#0#2;
    999,99,#0#3;
    ;
    NULL,propre,prolin;
|FIN;

/*
|DEFBUCLE leepre;
    #1#1;
    4;
    #0#0,00,#0#2, #0#4;
    #0#0,99,#0#3, #0#4;
    ;
    NULL,propre,prolin;
|FIN;
*/

|PROCESO lista;  |TIPO 3;

             |IMPRE 0;
               |SI FSalida ! 0; |ACABA; |FINSI;
          |SI #0#1 ="O";
             |INFOR "obras024";
          |FINSI;
          |SI #0#1 ="A";
             |INFOR "obrasa24";
          |FINSI;
          |SI #0#1 ="P";
             |INFOR "obrasp24";
          |FINSI;
               |SI FSalida ! 0; |FINIMP; |ACABA; |FINSI;

             |BUCLE leepre;
               |SI impre = 1;
                |SI #0#1 = "P";
                  |PRINT;
                |FINSI;
                  tl = 4;
                  |PRINT;
                  |PIEINF;
               |FINSI;
             |FININF;
             |FINIMP;

|FPRC;
