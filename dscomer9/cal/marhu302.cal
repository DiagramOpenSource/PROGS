|FICHEROS;
     marhu302 #0 ;            || Este Fichero
     marhu301 #1 ;            || Tmp
     marhu209 #2 ;            || Tmp Riesgo
     marhu300 #300;           || Configuración pasarela
     agifa104 #104;           || Cabecera de pedidos
     agifa073 #73;            || Líneas de pedidos
     agifa024 #24;            || Clientes
     agifa019 #19;            || Artículos
     agifa017 #17;            || Artículo/almacén
     marhu303 #303;           || Correspondencia de representantes
     agifa025 #25;            || Representantes
     marhu304 #304;           || Fichero de Visitas
     marhu305 #305;           || Mensajes de Representantes (C)
     marhu306 #306;           || Mensajes de Representantes (L)
     agifa324 #324;           || Divisas
     agifa027 #27;            || Contadores
     agifa142 #142;           || Parametros generales
     marhu307 #307;           || Recogidas (C)
     marhu308 #308;           || Recogidas (L)

|FIN;

|INCLUYE i_varart;

|VARIABLES;
     &Tempo    = "";
     aTempo1   = "";
     aTempo2   = "";
     aFicRies  = "";
     fFechaSys = @;
     aMes = ""; aDia = ""; aAno = ""; i = 0; fHoy = @; aLon = ""; nLon = 0;
     aAlf1     = "";
     aAlf2     = "";
     nContaTmp = 0;
     aAlfa    = "";
     fmes     = "";
     mes      = 0;
     aCtaCont = "";
     aSerie   = "";
     aAlfa1   = "";
     aAlfa2   = "";
     aAlfa3   = "";
     aAlfa4   = "";
     aAlfa5   = "";
     aAlfa6   = "";
     aAlfa7   = "";
     aFich    = "repcen.dat";
     aFichero = "";
     aTabla   = "";
     aPos     = "";
     aCaracter= "";
     aFecha   = "";
     aHazHora = "N";
     aReferencia = "";
     aNumeroActCP = "";
     nDigitos = 0;
     nDifDigi = 0;
     nNume1   = 0;
     nNume2   = 0;
     nNume3   = 0;
     nNume4   = 0;
     nNume5   = 0;
     nNume6   = 0;
     nLinea   = 0;
     nSalida  = 0;
     nBarras  = 0;
     nConta   = 0;
     nAlmacen = 0;
     fFecha   = @;
     HayBarra = "N";
     HacerLineas="S";
     aCP1 = "";
     aCP2 = "";
     aPoblacion = "";
     aProvincia = "";
     rLong = "";
     nLong = 0;
     bEncuentroParentesis = 0;
     ||-------------ZCABPED
     nNumPedCP  = 0;
     aNumPedCP  = "";
     aCodRepCP  = "";
     aCodCliCP  = "";
     aForPagCP  = "";
     aFechaCP   = "";
     aObservaCP = "";
     aImporteCP = "";
     nImporteCP = 0;
     nIvaCP     = 0;
     nRecCP     = 0;
     ||-------------ZLINPED
     nNumPedLP  = 0;
     aNumPedLP  = "";
     aCodArtLP  = "";
     nUnidadLP  = 0;
     nPrecioLP  = 0;
     nPorDtoLP  = 0;
     aUnidadLP  = "";
     aPrecioLP  = "";
     aPorDtoLP  = "";
     aCodRepLP  = "";
     ||-------------VISITAS
     nNumOrdVI  = 0;
     aNumOrdVI  = "";
     aCodCliVI  = "";
     aFecIniVI  = "";
     aFecFinVI  = "";
     aResultVI  = "";
     aCodRepVI  = "";
     aCodTipVI  = "";
     aComentVI  = "";
     ||-------------MENSAJEENV
     nNumOrdME  = 0;
     aNumOrdME  = "";
     aMensajME  = "";
     aFecHorME  = "";
     aCodRepME  = "";
     ||-------------CLIENTES
     aCodCliCL  = "";
     aNCampoCL  = "";
     nCampo     = 0;
     aContenCL  = "";
     ||-------------ZNUECLI
     aCodCliNC  = "";
     aCodRepNC  = "";
     aNombreNC  = "";
     aDomiciNC  = "";
     aPoblacNC  = "";
     aForPagNC  = "";
     aDiaPa1NC  = "";
     aDiaPa2NC  = "";
     aDiaPa3NC  = "";
     nDiaPa1NC  = 0;
     nDiaPa2NC  = 0;
     nDiaPa3NC  = 0;
     aEntidaNC  = "";
     aOficinNC  = "";
     aDigConNC  = "";
     aCuentaNC  = "";
     aRecEquNC  = "N";
     aTelefoNC  = "";
     aContacNC  = "";
     aGraSupNC  = "";
     aFaxCliNC  = "";
     aEmailNC   = "";
     aPagWebNC  = "";
     aObservNC  = "";
     aNifNC     = "";
     aDtoFamNC  = "";
     aTipCliNC  = "";
     ||-------------RECOGIDACAB
     aNumeroRC  = "";
     aFechaRC   = "";
     aCodRepRC  = "";
     aCodCliRC  = "";
     aNomCliRC  = "";
     ||-------------RECOGIDALIN
     aNumeroRL  = "";
     aNumFacRL  = "";
     aFecFacRL  = "";
     aCodArtRL  = "";
     aUniArtRL  = "";
     aDescriRL  = "";
     aMotivoRL  = "";
     aCodRepRL  = "";
|FIN;

|PROCESO agifa024;
     aAlf1 = #24#164 % 103;
     aAlf2 = aCodCliCP % 103;
     |SI aAlf1 = aAlf2;
          aAlfa6 = #24#0;
          |ERROR10;
     |FINSI;
|FPRC;

|DEFBUCLE agifa024;
#24#1;
;
"100000";
"999999";
be;
NULL,agifa024;
|FIN;

|PROCESO ProcesaCabPed; ||-------------ZCABPED
     HayBarra = "N";
     nNumPedCP  = 0;
     aNumPedCP  = "";
     aCodRepCP  = "";
     aCodCliCP  = "";
     aForPagCP  = "";
     aFechaCP   = "";
     aObservaCP = "";
     nImporteCP = 0;
     aImporteCP = "";
     nBarras  = 0;
     |PARA nNume4=1;|SI nNume4 [ 250;|HACIENDO nNume4 = nNume4 + 1;
          nNume5    = (nNume4 * 100) + 1;
          aPos      = nNume5;
          aCaracter = aAlfa1 % aPos;
          |SI aCaracter = "|";
              nBarras = nBarras + 1;
              HayBarra = "S";
          |FINSI;
          |SI aCaracter = "";
              |SAL;
          |FINSI;
          |SI nBarras = 4;
               aNumPedCP = aNumPedCP + aCaracter;
          |FINSI;
          |SI nBarras = 5;
               aNumPedCP = aNumPedCP - "|";
               nNumPedCP = aNumPedCP;
               aCodRepCP = aCodRepCP + aCaracter;
          |FINSI;
          |SI nBarras = 6;
               aCodRepCP = aCodRepCP - "|";
               aCodCliCP = aCodCliCP + aCaracter;
          |FINSI;
          |SI nBarras = 7;
               aCodCliCP = aCodCliCP - "|";
               aForPagCP = aForPagCP + aCaracter;
          |FINSI;
          |SI nBarras = 8;
               aForPagCP = aForPagCP - "|";
               aFechaCP = aFechaCP + aCaracter;
          |FINSI;
          |SI nBarras = 9;
               aFechaCP = aFechaCP - "|";
               aObservaCP = aObservaCP + aCaracter;
          |FINSI;
          |SI nBarras = 10;
               aObservaCP = aObservaCP - "|";
               aImporteCP = aImporteCP + aCaracter;
          |FINSI;
     |SIGUE;

     nContaTmp = nContaTmp + 1;
     #1#0 = "ZCABPED";
     #1#1 = aNumPedCP;
     #1#2 = aAlfa1;
     #1#3 = nContaTmp;
     |GRABA 020#1n;
|FPRC;

|PROCESO ProcesaLinPed;
     HayBarra = "N";
     ||-------------ZLINPED
     nNumPedLP  = 0;
     aNumPedLP  = "";
     aCodArtLP  = "";
     nUnidadLP  = 0;
     nPrecioLP  = 0;
     nPorDtoLP  = 0;
     aUnidadLP  = "";
     aPrecioLP  = "";
     aPorDtoLP  = "";
     aCodRepLP  = "";
     nAlmacen   = 0;
     nBarras  = 0;
     |PARA nNume4=1;|SI nNume4 [ 250;|HACIENDO nNume4 = nNume4 + 1;
          nNume5    = (nNume4 * 100) + 1;
          aPos      = nNume5;
          aCaracter = aAlfa1 % aPos;
          |SI aCaracter = "|";
              nBarras = nBarras + 1;
              HayBarra = "S";
          |FINSI;
          |SI aCaracter = "";
              |SAL;
          |FINSI;
          |SI nBarras = 4;
               aNumPedLP = aNumPedLP + aCaracter;
          |FINSI;
          |SI nBarras = 5;
               aNumPedLP = aNumPedLP - "|";
               nNumPedLP = aNumPedLP;
               aCodArtLP = aCodArtLP + aCaracter;
          |FINSI;
          |SI nBarras = 6;
               aCodArtLP = aCodArtLP - "|";
               aUnidadLP = aUnidadLP + aCaracter;
          |FINSI;
          |SI nBarras = 7;
               aUnidadLP = aUnidadLP - "|";
               nUnidadLP = aUnidadLP;
               aPrecioLP = aPrecioLP + aCaracter;
          |FINSI;
          |SI nBarras = 8;
               aPrecioLP = aPrecioLP - "|";
               nPrecioLP = aPrecioLP;
               aPorDtoLP = aPorDtoLP + aCaracter;
          |FINSI;
          |SI nBarras = 9;
               aPorDtoLP = aPorDtoLP - "|";
               nPorDtoLP = aPorDtoLP;
               aCodRepLP = aCodRepLP + aCaracter;
          |FINSI;
     |SIGUE;
     nContaTmp = nContaTmp + 1;
     #1#0 = "ZLINPED";
     #1#1 = aNumPedLP;
     #1#2 = aAlfa1;
     #1#3 = nContaTmp;
     |GRABA 020#1n;
|FPRC;

|PROCESO XProcesaCabPed;
     HayBarra = "N";
     ||-------------ZCABPED
     nNumPedCP  = 0;
     aNumPedCP  = "";
     aCodRepCP  = "";
     aCodCliCP  = "";
     aForPagCP  = "";
     aFechaCP   = "";
     aObservaCP = "";
     nImporteCP = 0;
     aImporteCP = "";
     aAlfa2 = aAlfa2 + " / Cabecera de pedidos";
     |PINTA 1034,aAlfa2;
     |PINTA 1134,"                                            ";
     |PINTA 1234,"                                            ";
     |PINTA 1334,"                                            ";
     |PINTA 1434,"                                            ";
     |PINTA 1534,"                                            ";
     |PINTA 1634,"                                            ";
     |PINTA 1734,"                                            ";
     nBarras  = 0;
     |PARA nNume4=1;|SI nNume4 [ 250;|HACIENDO nNume4 = nNume4 + 1;
          nNume5    = (nNume4 * 100) + 1;
          aPos      = nNume5;
          aCaracter = aAlfa1 % aPos;
          |SI aCaracter = "|";
              nBarras = nBarras + 1;
              HayBarra = "S";
          |FINSI;
          |SI aCaracter = "";
              |SAL;
          |FINSI;
          |SI nBarras = 4;
               aNumPedCP = aNumPedCP + aCaracter;
          |FINSI;
          |SI nBarras = 5;
               aNumPedCP = aNumPedCP - "|";
               nNumPedCP = aNumPedCP;
               aCodRepCP = aCodRepCP + aCaracter;
          |FINSI;
          |SI nBarras = 6;
               aCodRepCP = aCodRepCP - "|";
               aCodCliCP = aCodCliCP + aCaracter;
          |FINSI;
          |SI nBarras = 7;
               aCodCliCP = aCodCliCP - "|";
               aForPagCP = aForPagCP + aCaracter;
          |FINSI;
          |SI nBarras = 8;
               aForPagCP = aForPagCP - "|";
               aFechaCP = aFechaCP + aCaracter;
          |FINSI;
          |SI nBarras = 9;
               aFechaCP = aFechaCP - "|";
               aObservaCP = aObservaCP + aCaracter;
          |FINSI;
          |SI nBarras = 10;
               aObservaCP = aObservaCP - "|";
               aImporteCP = aImporteCP + aCaracter;
          |FINSI;
     |SIGUE;
     ||ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ Corrige Fecha
     aFechaCP = "/" + aFechaCP;
     aLon = aFechaCP % A0;
     nLon = aLon;
     nLon = nLon * 100 + 1;
     nBarras = 0;
     aMes = ""; aDia = ""; aAno = "";
     |PARA i = 101; |SI i [ nLon; |Y nLon > 0; |HACIENDO i = i + 100;
          aCaracter = aFechaCP % i;
          |SI aCaracter = "/";
               nBarras = nBarras + 1;
          |SINO;
               |SI nBarras = 1;
                    aDia = aDia + aCaracter;
               |FINSI;
               |SI nBarras = 2;
                    aMes = aMes + aCaracter;
               |FINSI;
               |SI nBarras = 3;
                    aAno = aAno + aCaracter;
               |FINSI;
          |FINSI;
     |SIGUE;
     aDia = ("00" + aDia) % -102;
     aMes = ("00" + aMes) % -102;
     fHoy = ~;
     aAlfa = fHoy;
     aLon = aAno % A0;
     |SI aLon < 4;
          aAno = ("00" + aAno) % -102;
          aAno = (aAlfa % 702) + aAno;
     |FINSI;
     aFechaCP = aDia + "." + aMes + "." + aAno;
     ||ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
     aNumeroActCP = aNumPedCP;
     aImporteCP = aImporteCP - "|";
     nImporteCP = aImporteCP;

     |SELECT #2#303;
     #303#3 = aCodRepCP;
     |LEE 020#303=;
     |SI FSalida = 0;
         #27#0 = "vpedido";
         #27#2 = #303#3;
         |LEE 000#27=;
         |SI FSalida ! 0;
             #27#1 = 2;
             nNumPedCP = 1;
             |GRABA 020#27n;
         |SINO;
             nNumPedCP = #27#1;
             #27#1 = #27#1 + 1;
             |GRABA 020#27a;
         |FINSI;
         aSerie    = #303#3;
         aCodRepCP = #303#0;
         #104#0    = nNumPedCP;
         #104#25   = aSerie;
         |LEE 000#104=;
         |SI FSalida = 0;
              |MENSA "0000El pedido ya existe. No se actualiza.";
              |PAUSA;
              |ACABA;
         |FINSI;
         |DDEFECTO #104;
         #104#0    = nNumPedCP;
         #104#25   = aSerie;
         aAlfa4 = aCodCliCP;
         aAlfa4 = aAlfa4 % 103;
         |SI aAlfa4 ! "430";
             |BUCLE agifa024;
         |SINO;
             aAlfa6 = aCodCliCP % -106;
         |FINSI;
         |SI aNCampoCL = "1";
             nCampo = 1;
         |FINSI;
         |SI aNCampoCL = "2";
             nCampo = 5;
         |FINSI;
         |SI aNCampoCL = "3";
             nCampo = 999;
         |FINSI;
         |SI aNCampoCL = "4";
             nCampo = 17;
         |FINSI;
         |SI aNCampoCL = "5";
             nCampo = 998;
         |FINSI;
         |DDEFECTO #24;
         #24#0 = aAlfa6;
         |LEE 101#24=;
         |SI FSalida ! 0;
               #24#0 = "999999";
               #24#1 = "CLIENTE NO ENCONTRADO (portatil)";
               |LEE 101#24=;
               |SI FSalida ! 0;
                    |GRABA 020#24b;
               |FINSI;
          ||   aAlfa = "0000NO EXISTE Cliente ["+ #24#0 +"]." + &10 + "Se crea en blanco, reviselo!!!";
          ||   |MENAV aAlfa;
         |FINSI;
         HacerLineas="S";
         #104#4  = #24#0;
         #104#8  = #24#1;
         #104#14 = #24#5;
         #104#19 = #24#2;
         #104#20 = #24#6;
         #104#21 = #24#7;
         #104#7  = aCodRepCP;
         fFecha = aFechaCP;
         #104#1  = fFecha;
         #104#11 = nImporteCP;
         #104#12 = nImporteCP;
         #104#15 = aObservaCP % 135;
         #104#53 = aObservaCP % 3622;
         #104#54 = aObservaCP % 5922;
      ||   #104#55 = aObservaCP % 8222;
         #104#55 = fFechaSys;
         #104#22 = #24#47;
         #104#23 = #24#41;
         #104#35 = #24#192;
         #104#37 = #24#193;
         #104#40 = #24#192;
         #104#42 = nImporteCP;
         #104#43 = nImporteCP;
         #104#45 = nImporteCP;
         #104#46 = nImporteCP;
         #104#48 = nImporteCP;
         #104#49 = nImporteCP;
         #324#0  = #24#192;
         |LEE 000#324=;
         #104#36 = #324#2;
         #104#41 = #324#2;
         #104#51 = "PORTATIL";
         aReferencia = aAlfa6+aAlfa5+aAlfa4+aNumPedCP;
         #104#26 = aReferencia;
         aForPagCP = aForPagCP % 108;
         |SI aForPagCP = "11010000";
             #104#9="01";
         |FINSI;
         |SI aForPagCP = "00012000";
             #104#9="02";
         |FINSI;
         |SI aForPagCP = "00013000";
             #104#9="03";
         |FINSI;
         |SI aForPagCP = "00016000";
             #104#9="04";
         |FINSI;
         |SI aForPagCP = "00019000";
             #104#9="05";
         |FINSI;
         |SI aForPagCP = "00023030";
             #104#9="06";
         |FINSI;
         |SI aForPagCP = "00026030";
             #104#9="07";
         |FINSI;
         |SI aForPagCP = "00033030";
             #104#9="08";
         |FINSI;
         |SI aForPagCP = "05013000";
             #104#9="09";
         |FINSI;
         |SI aForPagCP = "05016000";
             #104#9="10";
         |FINSI;
         |SI aForPagCP = "05019000";
             #104#9="11";
         |FINSI;
         |SI aForPagCP = "03010000";
             #104#9="12";
         |FINSI;
         |GRABA 020#104n;
         fmes = #104#1 % A402;
         mes = fmes - 1;
         mes = mes * 3;
         mes = mes + 114;
         #24mes = #24mes   + #104#42;
         #24#150 = #24#150 + #104#42;
         |GRABA 020#24a;
         |LIBERA #24;

          eaCliente = #agifa104#4;
          efFecha = #agifa104#1;
          enImpCliPed = #104#42;
          |HAZ AcumulaCli;
         ||ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄPara el Riesgo
         #2#0 = #24#0;
         #2#1 = #24#1;
         #2#4 = #24#16;
         |GRABA 000#2n;
     |FINSI;
|FPRC;

|PROCESO XProcesaLinPed;
     HayBarra = "N";
     ||-------------ZLINPED
     nNumPedLP  = 0;
     aNumPedLP  = "";
     aCodArtLP  = "";
     nUnidadLP  = 0;
     nPrecioLP  = 0;
     nPorDtoLP  = 0;
     aUnidadLP  = "";
     aPrecioLP  = "";
     aPorDtoLP  = "";
     aCodRepLP  = "";
     nAlmacen   = 0;
     aAlfa2 = aAlfa2 + " / Lineas de pedidos  ";
     |PINTA 1134,aAlfa2;
     |PINTA 1034,"                                            ";
     |PINTA 1234,"                                            ";
     |PINTA 1334,"                                            ";
     |PINTA 1434,"                                            ";
     |PINTA 1534,"                                            ";
     |PINTA 1634,"                                            ";
     |PINTA 1734,"                                            ";
     nBarras  = 0;
     |PARA nNume4=1;|SI nNume4 [ 250;|HACIENDO nNume4 = nNume4 + 1;
          nNume5    = (nNume4 * 100) + 1;
          aPos      = nNume5;
          aCaracter = aAlfa1 % aPos;
          |SI aCaracter = "|";
              nBarras = nBarras + 1;
              HayBarra = "S";
          |FINSI;
          |SI aCaracter = "";
              |SAL;
          |FINSI;
          |SI nBarras = 4;
               aNumPedLP = aNumPedLP + aCaracter;
          |FINSI;
          |SI nBarras = 5;
               aNumPedLP = aNumPedLP - "|";
               nNumPedLP = aNumPedLP;
               aCodArtLP = aCodArtLP + aCaracter;
          |FINSI;
          |SI nBarras = 6;
               aCodArtLP = aCodArtLP - "|";
               aUnidadLP = aUnidadLP + aCaracter;
          |FINSI;
          |SI nBarras = 7;
               aUnidadLP = aUnidadLP - "|";
               nUnidadLP = aUnidadLP;
               aPrecioLP = aPrecioLP + aCaracter;
          |FINSI;
          |SI nBarras = 8;
               aPrecioLP = aPrecioLP - "|";
               nPrecioLP = aPrecioLP;
               aPorDtoLP = aPorDtoLP + aCaracter;
          |FINSI;
          |SI nBarras = 9;
               aPorDtoLP = aPorDtoLP - "|";
               nPorDtoLP = aPorDtoLP;
               aCodRepLP = aCodRepLP + aCaracter;
          |FINSI;
     |SIGUE;
/*
     |SI HacerLineas = "N";
         |SI aNumPedLP = aNumeroActCP;
             |ACABA;
         |SINO;
             HacerLineas = "S";
         |FINSI;
     |FINSI;
*/
     aCodRepLP = aCodRepLP - "|";
     |SELECT #2#303;
     #303#2 = aCodRepLP;
     |LEE 000#303=;
     |SI FSalida = 0;
         nAlmacen  = #303#5;
         aCodRepLP = #303#0;
         #73#0    = nNumPedCP;
         #73#28   = aSerie;
         #73#1    = 1;
         |LEE 000#73=;
         |PARA nNume4 = 1;|SI;|HACIENDO nNume4 = nNume4 + 1;
               #73#0    = nNumPedCP;
               #73#28   = aSerie;
               #73#1    = nNume4;
               |LEE 000#73=;
               |SI FSalida ! 0;
                   |SAL;
               |FINSI;
         |SIGUE;
         |DDEFECTO #73;
         #73#0    = nNumPedCP;
         #73#28   = aSerie;
         #73#1    = nNume4;
         #73#2    = aCodArtLP;
         #73#3    = nAlmacen;
         |DDEFECTO #19;
         #19#0    = aCodArtLP;
         |LEE 000#19=;
         |SI FSalida ! 0;
               aAlfa = "0000NO EXISTE Articulo [" + #19#0 + "]." + &10 + "Se crea en blanco, reviselo!!!.";
               |MENAV aAlfa;
               |GRABA 020#19b;
         |FINSI;
         #73#4  = #19#1;
         #73#5  = nUnidadLP;
         #73#6  = nPrecioLP;
         #73#8  = nPorDtoLP;
         #73#9  = nPrecioLP * nUnidadLP;
         #73#11 = #73#9;
         #73#14 = #19#30;
         #73#16 = aCodRepLP;
         #73#18 = #19#2;
         #104#0 = #73#0;
         #104#25 = #73#28;
         |LEE 020#104=;
         |SI FSalida = 0;
             #24#0 = #104#4;
             |LEE 020#24=;
             |SI FSalida = 0;
                 #73#19 = #24#4;
                 #73#20 = #24#1;
                 #73#26 = #24#20;
                 #73#38 = #73#6;
                 #73#39 = #73#9;
                 #73#40 = #73#6;
                 #73#41 = #73#9;
                 #73#42 = #73#5;
                 |GRABA 020#73n;
                 #19#15 = #19#15 + nUnidadLP;
                 |GRABA 020#19a;
                 |LIBERA #19;

                 #17#0 = #19#0;
                 #17#1 = nAlmacen;
                 |LEE 101#17=;
                 |SI FSalida ! 0;
                     |DDEFECTO #17;
                     #17#0 = #19#0;
                     #17#1 = nAlmacen;
                     #17#40= #19#1;
                     |GRABA 020#17b;
                 |FINSI;
                 #17#42= #17#42 + nUnidadLP;
                 #17#43= #17#42 + nUnidadLP;
                 |GRABA 020#17a;
                 |LIBERA #17;
             |FINSI;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO ProcesaVisitas;
     HayBarra = "N";
     ||-------------VISITAS
     nNumOrdVI  = 0;
     aNumOrdVI  = "";
     aCodCliVI  = "";
     aFecIniVI  = "";
     aFecFinVI  = "";
     aResultVI  = "";
     aCodRepVI  = "";
     aCodTipVI  = "";
     aComentVI  = "";
     aAlfa2 = aAlfa2 + " / Visitas";
     |PINTA 1234,aAlfa2;
     |PINTA 1134,"                                            ";
     |PINTA 1034,"                                            ";
     |PINTA 1334,"                                            ";
     |PINTA 1434,"                                            ";
     |PINTA 1534,"                                            ";
     |PINTA 1634,"                                            ";
     |PINTA 1734,"                                            ";
     nBarras = 0;
     |PARA nNume4=1;|SI nNume4 [ 250;|HACIENDO nNume4 = nNume4 + 1;
          nNume5    = (nNume4 * 100) + 1;
          aPos      = nNume5;
          aCaracter = aAlfa1 % aPos;
          |SI aCaracter = "|";
              nBarras = nBarras + 1;
              HayBarra = "S";
          |FINSI;
          |SI aCaracter = "";
              |SAL;
          |FINSI;
          |SI nBarras = 4;
               aNumOrdVI = aNumOrdVI + aCaracter;
          |FINSI;
          |SI nBarras = 5;
               aNumOrdVI = aNumOrdVI - "|";
               nNumOrdVI = aNumOrdVI;
               aCodCliVI = aCodCliVI + aCaracter;
          |FINSI;
          |SI nBarras = 6;
               aCodCliVI = aCodCliVI - "|";
               aFecIniVI = aFecIniVI + aCaracter;
          |FINSI;
          |SI nBarras = 7;
               aFecIniVI = aFecIniVI - "|";
               aFecFinVI = aFecFinVI + aCaracter;
          |FINSI;
          |SI nBarras = 8;
               aFecFinVI = aFecFinVI - "|";
               aResultVI = aResultVI + aCaracter;
          |FINSI;
          |SI nBarras = 9;
               aResultVI = aResultVI - "|";
               aCodRepVI = aCodRepVI + aCaracter;
          |FINSI;
          |SI nBarras = 10;
               aCodRepVI = aCodRepVI - "|";
               aCodTipVI = aCodTipVI + aCaracter;
          |FINSI;
          |SI nBarras = 12;
               aCodTipVI = aCodTipVI - "|";
               aComentVI = aComentVI + aCaracter;
          |FINSI;
     |SIGUE;
     aComentVI = aComentVI - "|";
     |SELECT #2#303;
     #303#2 = aCodRepVI;
     |LEE 000#303=;
     |SI FSalida = 0;
         #304#0 = #303#0;
         #304#2 = #303#1;
         #304#1 = nNumOrdVI;
         |LEE 000#304=;
         nSalida = FSalida;
         nBarras = 0;
         aAlfa4  = "";
         aAlfa5  = "";
         aAlfa6  = "";
         aAlfa7  = "";
         aHazHora = "N";
         nConta = 0;
         |PARA nNume4= 1;|SI nNume4 [ 19;|HACIENDO nNume4 = nNume4 + 1;
              nNume5    = (nNume4 * 100) + 1;
              aPos      = nNume5;
              aCaracter = aFecIniVI % aPos;
              |SI aCaracter = "/"; nBarras = nBarras + 1; |FINSI;
              |SI aCaracter = " "; aHazHora = "S"; |FINSI;
              |SI aHazHora = "S";
                    nConta = nConta + 1;
                    |SI nConta [ 6; aAlfa7 = aAlfa7 + aCaracter; |SINO; |SAL; |FINSI;
              |SINO;
                    |SI nBarras = 0; aAlfa4 = aAlfa4 + aCaracter; |FINSI;
                    |SI nBarras = 1; aAlfa5 = aAlfa5 + aCaracter; |FINSI;
                    |SI nBarras = 2; aAlfa6 = aAlfa6 + aCaracter; |FINSI;
              |FINSI;
         |SIGUE;
         aAlfa4 = aAlfa4 - "/";
         aAlfa5 = aAlfa5 - "/";
         aAlfa6 = aAlfa6 - "/";
         aAlfa7 = aAlfa7 - " ";
         aFecha = aAlfa4 + "." + aAlfa5 + "." + aAlfa6;
         fFecha = aFecha;
         #304#3 = fFecha;
         #304#4 = aAlfa7;
         nBarras = 0;
         aAlfa4  = "";
         aAlfa5  = "";
         aAlfa6  = "";
         aAlfa7  = "";
         aHazHora = "N";
         nConta = 0;
         |PARA nNume4= 1;|SI nNume4 [ 19;|HACIENDO nNume4 = nNume4 + 1;
              nNume5    = (nNume4 * 100) + 1;
              aPos      = nNume5;
              aCaracter = aFecFinVI % aPos;
              |SI aCaracter = "/"; nBarras = nBarras + 1; |FINSI;
              |SI aCaracter = " "; aHazHora = "S"; |FINSI;
              |SI aHazHora = "S";
                    nConta = nConta + 1;
                    |SI nConta [ 6; aAlfa7 = aAlfa7 + aCaracter; |SINO; |SAL; |FINSI;
              |SINO;
                    |SI nBarras = 0; aAlfa4 = aAlfa4 + aCaracter; |FINSI;
                    |SI nBarras = 1; aAlfa5 = aAlfa5 + aCaracter; |FINSI;
                    |SI nBarras = 2; aAlfa6 = aAlfa6 + aCaracter; |FINSI;
              |FINSI;
         |SIGUE;
         aAlfa4 = aAlfa4 - "/";
         aAlfa5 = aAlfa5 - "/";
         aAlfa6 = aAlfa6 - "/";
         aAlfa7 = aAlfa7 - " ";
         aFecha = aAlfa4 + "." + aAlfa5 + "." + aAlfa6;
         fFecha = aFecha;
         #304#5 = fFecha;
         #304#6 = aAlfa7;
         #304#7 = aResultVI;
         #304#8 = aCodTipVI;
         #304#9 = aComentVI;
         |SI nSalida = 0; |GRABA 020#304a; |SINO; |GRABA 020#304n; |FINSI;
     |FINSI;
|FPRC;

|PROCESO ProcesaMensajes;
     HayBarra = "N";
     nBarras  = 0;
     ||-------------MENSAJEENV
     nNumOrdME  = 0;
     aNumOrdME  = "";
     aMensajME  = "";
     aFecHorME  = "";
     aCodRepME  = "";
     aAlfa2 = aAlfa2 + " / Mensajes enviados  ";
     |PINTA 1334,aAlfa2;
     |PINTA 1134,"                                            ";
     |PINTA 1234,"                                            ";
     |PINTA 1034,"                                            ";
     |PINTA 1434,"                                            ";
     |PINTA 1534,"                                            ";
     |PINTA 1634,"                                            ";
     |PINTA 1734,"                                            ";
     |PARA nNume4=1;|SI nNume4 [ 250;|HACIENDO nNume4 = nNume4 + 1;
          nNume5    = (nNume4 * 100) + 1;
          aPos      = nNume5;
          aCaracter = aAlfa1 % aPos;
          |SI aCaracter = "|";
              nBarras = nBarras + 1;
              HayBarra = "S";
          |FINSI;
          |SI aCaracter = ""; |SAL; |FINSI;
          |SI nBarras = 4;
               aNumOrdME = aNumOrdME + aCaracter;
          |FINSI;
          |SI nBarras = 5;
               aNumOrdME = aNumOrdME - "|";
               nNumOrdME = aNumOrdME;
               aMensajME = aMensajME + aCaracter;
          |FINSI;
          |SI nBarras = 6;
               aMensajME = aMensajME - "|";
               aFecHorME = aFecHorME + aCaracter;
          |FINSI;
          |SI nBarras = 7;
               aFecHorME = aFecHorME - "|";
               aCodRepME = aCodRepME + aCaracter;
          |FINSI;
     |SIGUE;
     nBarras = 0;
     aCodRepME = aCodRepME - "|";
     |SELECT #2#303;
     #303#2 = aCodRepME;
     |LEE 000#303=;
     |SI FSalida = 0;
         #305#0 = #303#0;
         |LEE 000#305=;
         |SI FSalida ! 0; #305#1 = #303#1; |GRABA 020#305n; |FINSI;
         #306#0 = #305#0;
         #306#2 = nNumOrdME;
         #306#1 = 1;
         |LEE 000#306=;
         nSalida = FSalida;
         |SI nSalida ! 0;
             |PARA nLinea = 2;|SI;|HACIENDO nLinea = nLinea + 1;
                   #306#0 = #305#0;
                   #306#2 = nNumOrdME;
                   #306#1 = nLinea;
                   |LEE 000#306=;
                   |SI FSalida ! 0; |SAL; |FINSI;
             |SIGUE;
         |FINSI;
         #306#5 = aMensajME;
         aAlfa4  = "";
         aAlfa5  = "";
         aAlfa6  = "";
         aAlfa7  = "";
         aHazHora = "N";
         nConta = 0;
         |PARA nNume4= 1;|SI nNume4 [ 19;|HACIENDO nNume4 = nNume4 + 1;
              nNume5    = (nNume4 * 100) + 1;
              aPos      = nNume5;
              aCaracter = aFecFinVI % aPos;
              |SI aCaracter = "/"; nBarras = nBarras + 1; |FINSI;
              |SI aCaracter = " "; aHazHora = "S"; |FINSI;
              |SI aHazHora = "S";
                    nConta = nConta + 1;
                    |SI nConta [ 6; aAlfa7 = aAlfa7 + aCaracter; |SINO; |SAL; |FINSI;
              |SINO;
                    |SI nBarras = 0;  aAlfa4 = aAlfa4 + aCaracter; |FINSI;
                    |SI nBarras = 1;  aAlfa5 = aAlfa5 + aCaracter; |FINSI;
                    |SI nBarras = 2;  aAlfa6 = aAlfa6 + aCaracter; |FINSI;
              |FINSI;
         |SIGUE;
         aAlfa4 = aAlfa4 - "/";
         aAlfa5 = aAlfa5 - "/";
         aAlfa6 = aAlfa6 - "/";
         aAlfa7 = aAlfa7 - " ";
         aFecha = aAlfa4 + "." + aAlfa5 + "." + aAlfa6;
         fFecha = aFecha;
         #306#3 = fFecha;
         #306#4 = aAlfa7;
         |GRABA 020#306n;
     |FINSI;
|FPRC;

|PROCESO ProcesaClientes;
     HayBarra = "N";
     nBarras  = 0;
     ||-------------CLIENTES
     aCodCliCL  = "";
     aNCampoCL  = "";
     nCampo     = 0;
     aContenCL  = "";
     aAlfa2 = aAlfa2 + " / Clientes";
     |PINTA 1434,aAlfa2;
     |PINTA 1134,"                                            ";
     |PINTA 1234,"                                            ";
     |PINTA 1334,"                                            ";
     |PINTA 1034,"                                            ";
     |PINTA 1534,"                                            ";
     |PINTA 1634,"                                            ";
     |PINTA 1734,"                                            ";
     |PARA nNume4=1;|SI nNume4 [ 250;|HACIENDO nNume4 = nNume4 + 1;
          nNume5    = (nNume4 * 100) + 1;
          aPos      = nNume5;
          aCaracter = aAlfa1 % aPos;
          |SI aCaracter = "|";
              nBarras = nBarras + 1;
              HayBarra = "S";
          |FINSI;
          |SI aCaracter = "";
              |SAL;
          |FINSI;
          |SI nBarras = 1;
               aCodCliCL = aCodCliCL + aCaracter;
          |FINSI;
          |SI nBarras = 3;
               aCodCliCL = aCodCliCL - "|";
               aNCampoCL = aNCampoCL + aCaracter;
          |FINSI;
          |SI nBarras = 4;
               aNCampoCL = aNCampoCL - "|";
               aContenCL = aContenCL + aCaracter;
          |FINSI;
     |SIGUE;
     aContenCL = aContenCL - "|";
     aAlfa4 = aCodCliCL;
     aAlfa4 = aAlfa4 % 103;
     |SI aAlfa4 ! "430"; |BUCLE agifa024; |SINO; aAlfa6 = aCodCliCL % -106; |FINSI;
     |SI aNCampoCL = "1"; nCampo = 1;   |FINSI;
     |SI aNCampoCL = "2"; nCampo = 5;   |FINSI;
     |SI aNCampoCL = "3"; nCampo = 999; |FINSI;
     |SI aNCampoCL = "4"; nCampo = 17;  |FINSI;
     |SI aNCampoCL = "5"; nCampo = 998; |FINSI;
     #24#0 = aAlfa6;
     |LEE 000#24=;
     |SI FSalida = 0;
         |SI nCampo = 999;|O nCampo = 998;
             |SI nCampo = 998;
                 #24#29 = aContenCL % 104;
                 #24#33 = aContenCL % 504;
                 #24#31 = aContenCL % 702;
                 #24#30 = aContenCL % 908;
             |FINSI;
         |SINO;
             #24nCampo = aContenCL;
         |FINSI;
         |GRABA 000#24a;
     |FINSI;
|FPRC;

|PROCESO ProcesaNueClis;
     HayBarra = "N";
     nBarras  = 0;
     ||-------------ZNUECLI
     aCodCliNC  = "";
     aCodRepNC  = "";
     aNombreNC  = "";
     aDomiciNC  = "";
     aPoblacNC  = "";
     aForPagNC  = "";
     aDiaPa1NC  = "";
     aDiaPa2NC  = "";
     aDiaPa3NC  = "";
     nDiaPa1NC  = 0;
     nDiaPa2NC  = 0;
     nDiaPa3NC  = 0;
     aEntidaNC  = "";
     aOficinNC  = "";
     aDigConNC  = "";
     aCuentaNC  = "";
     aRecEquNC  = "";
     aTelefoNC  = "";
     aContacNC  = "";
     aGraSupNC  = "";
     aFaxCliNC  = "";
     aEmailNC   = "";
     aPagWebNC  = "";
     aObservNC  = "";
     aNifNC     = "";
     aDtoFamNC  = "";
     aTipCliNC  = "";
     aAlfa2 = aAlfa2 + " / Clientes Nuevos";
     |PINTA 1534,aAlfa2;
     |PINTA 1134,"                                            ";
     |PINTA 1234,"                                            ";
     |PINTA 1334,"                                            ";
     |PINTA 1434,"                                            ";
     |PINTA 1034,"                                            ";
     |PINTA 1634,"                                            ";
     |PINTA 1734,"                                            ";
     #27#0 = "clientes";
     #27#2 = "";
     |LEE 000#27=;
     |SI FSalida ! 0;
         #27#1 = 100001;
         aCodCliNC = 100000;
         |GRABA 020#27n;
     |SINO;
         aCodCliNC = #27#1;
         #27#1 = #27#1 + 1;
         |GRABA 020#27a;
     |FINSI;

     |PARA nNume4=1;|SI nNume4 [ 250;|HACIENDO nNume4 = nNume4 + 1;
          nNume5    = (nNume4 * 100) + 1;
          aPos      = nNume5;
          aCaracter = aAlfa1 % aPos;
          |SI aCaracter = "|";
              nBarras = nBarras + 1;
              HayBarra = "S";
          |FINSI;
          |SI aCaracter = ""; |SAL; |FINSI;
          |SI nBarras = 5; aCodRepNC = aCodRepNC + aCaracter; |FINSI;
          |SI nBarras = 6;
               aCodRepNC = aCodRepNC - "|";
               aNombreNC = aNombreNC + aCaracter;
          |FINSI;
          |SI nBarras = 7;
               aNombreNC = aNombreNC - "|";
               aDomiciNC = aDomiciNC + aCaracter;
          |FINSI;
          |SI nBarras = 8;
               aDomiciNC = aDomiciNC - "|";
               aPoblacNC = aPoblacNC + aCaracter;
          |FINSI;
          |SI nBarras = 9;
               aPoblacNC = aPoblacNC - "|";
               aForPagNC = aForPagNC + aCaracter;
          |FINSI;
          |SI nBarras = 10;
               aForPagNC = aForPagNC - "|";
               aDiaPa1NC = aDiaPa1NC + aCaracter;
          |FINSI;
          |SI nBarras = 11;
               aDiaPa1NC = aDiaPa1NC - "|"; nDiaPa1NC = aDiaPa1NC;
               aDiaPa2NC = aDiaPa2NC + aCaracter;
          |FINSI;
          |SI nBarras = 12;
               aDiaPa2NC = aDiaPa2NC - "|"; nDiaPa2NC = aDiaPa2NC;
               aDiaPa3NC = aDiaPa3NC + aCaracter;
          |FINSI;
          |SI nBarras = 13;
               aDiaPa3NC = aDiaPa3NC - "|"; nDiaPa3NC = aDiaPa3NC;
               aEntidaNC = aEntidaNC + aCaracter;
          |FINSI;
          |SI nBarras = 14;
               aEntidaNC = aEntidaNC - "|";
               aOficinNC = aOficinNC + aCaracter;
          |FINSI;
          |SI nBarras = 15;
               aOficinNC = aOficinNC - "|";
               aDigConNC = aDigConNC + aCaracter;
          |FINSI;
          |SI nBarras = 16;
               aDigConNC = aDigConNC - "|";
               aCuentaNC = aCuentaNC + aCaracter;
          |FINSI;
          |SI nBarras = 17;
               aCuentaNC = aCuentaNC - "|";
               aRecEquNC = aRecEquNC + aCaracter;
          |FINSI;
          |SI nBarras = 18;
               aRecEquNC = aRecEquNC - "|";
               aTelefoNC = aTelefoNC + aCaracter;
          |FINSI;
          |SI nBarras = 19;
               aTelefoNC = aTelefoNC - "|";
               aContacNC = aContacNC + aCaracter;
          |FINSI;
          |SI nBarras = 20;
               aContacNC = aContacNC - "|";
               aGraSupNC = aGraSupNC + aCaracter;
          |FINSI;
          |SI nBarras = 21;
               aGraSupNC = aGraSupNC - "|";
               aFaxCliNC = aFaxCliNC + aCaracter;
          |FINSI;

          |SI nBarras = 22;
               aFaxCliNC = aFaxCliNC - "|";
               aPagWebNC = aPagWebNC + aCaracter;
          |FINSI;
          |SI nBarras = 23;
               aPagWebNC = aPagWebNC - "|";
               aEmailNC = aEmailNC + aCaracter;
          |FINSI;
          |SI nBarras = 26;
               aEmailNC = aEmailNC - "|";
               aObservNC = aObservNC + aCaracter;
          |FINSI;
          |SI nBarras = 29;
               aObservNC = aObservNC - "|";
               aNifNC = aNifNC + aCaracter;
          |FINSI;
          |SI nBarras = 30;
               aNifNC = aNifNC - "|";
               aDtoFamNC = aDtoFamNC + aCaracter;
          |FINSI;
          |SI nBarras = 31;
               aDtoFamNC = aDtoFamNC - "|";
               aTipCliNC = aTipCliNC + aCaracter;
          |FINSI;
     |SIGUE;
     aTipCliNC = aTipCliNC - "|";
     #24#0 = aCodCliNC;
     |LEE 000#24=;
     |SI FSalida = 0;
         |SI FSalida = 0;
              |MENSA "0000El código de cliente ya existe. No se actualizará.";
              |PAUSA;
              |ACABA;
         |FINSI;
     |FINSI;
     |DDEFECTO #24;
     #24#0  = aCodCliNC;
     #24#1  = aNombreNC;
     #24#2  = aNombreNC;
     #24#5  = aDomiciNC;
     #24#8  = aDomiciNC;
     #24#11 = aDomiciNC;
     |HAZ AnalizaPoblacion;
     #24#178= aCP1;
     #24#179= aCP2;
     #24#180= aCP1+aCP2;
     #24#181= aCP1;
     #24#182= aCP2;
     #24#183= aCP1+aCP2;
     #24#184= aCP1;
     #24#185= aCP2;
     #24#186= aCP1+aCP2;
     #24#6  = aPoblacion;
     #24#7  = aProvincia;
     #24#9  = aPoblacion;
     #24#10 = aProvincia;
     #24#12 = aPoblacion;
     #24#13 = aProvincia;
     #24#22 = nDiaPa1NC;
     #24#23 = nDiaPa2NC;
     #24#24 = nDiaPa3NC;
     #24#32 = aEntidaNC;
     #24#30 = aCuentaNC;
     #24#31 = aDigConNC;
     #24#33 = aOficinNC;
     |SI aRecEquNC = "RE"; #24#47 = "S"; |SINO; #24#47 = "N"; |FINSI;
     #24#17 = aTelefoNC;
     #24#36 = aContacNC;
     #24#18 = aFaxCliNC;
     #24#197= aEmailNC;
     #24#163= aPagWebNC;
     #24#53 = aObservNC;
     #24#15 = aNifNC;
     #24#159= ~;
     |LEE 000#142p;
     |SI FSalida ! 0; |DDEFECTO #142; |GRABA 020#142n; |FINSI;
     nDigitos = #142#11;
     aCtaCont = "430";
     nDifDigi = 9 - nDigitos;
     |PARA nNume6 = 0;|SI nNume6 [ nDifDigi;|HACIENDO nNume6 = nNume6 + 1;
           aCtaCont = aCtaCont + "0";
     |SIGUE;
     aCtaCont = aCtaCont + #24#0;
     #24#16 = aCtaCont;
     |GRABA 020#24n;
|FPRC;

|RUTINA AnalizaPoblacion;
     aCP1 = aPoblacNC % A102;
     aCP2 = aPoblacNC % A303;
     aAlfa6 = aPoblacNC;
     |QBF aAlfa6;
     rLong = aAlfa6 % A0;
     nLong = rLong;
     nLong = rLong - 6;
     nLong = (100 + nLong) * -1;
     rLong = nLong;
     aAlfa6 = aAlfa6 % rLong;
     rLong = aAlfa6 % A0;
     nLong = rLong;
     aPoblacion = "";
     aProvincia = "";
     bEncuentroParentesis = 0;
     |PARA nNume6=1;|SI nNume6 [ nLong;|HACIENDO nNume6=nNume6+1;
          nNume2 = (nNume6 * 100) + 1;
          rLong = nNume2;
          aCaracter = aAlfa6 % rLong;
          |SI aCaracter ! "(";|Y aCaracter ! ")";
               |SI bEncuentroParentesis = 1;
                    aProvincia = aProvincia + aCaracter;
               |SINO;
                    aPoblacion = aPoblacion + aCaracter;
               |FINSI;
          |SINO;
               bEncuentroParentesis = 1;
          |FINSI;
     |SIGUE;
     |SI aProvincia = ""; aProvincia = aPoblacion; |FINSI;
|FRUT;

|PROCESO ProcesaRecCab;
     HayBarra = "N";
     nBarras  = 0;
     ||-------------RECOGIDACAB
     aNumeroRC  = "";
     aFechaRC   = "";
     aCodRepRC  = "";
     aCodCliRC  = "";
     aNomCliRC  = "";
     aAlfa2 = aAlfa2 + " / Cabecera Recogida";
     |PINTA 1634,aAlfa2;
     |PINTA 1134,"                                            ";
     |PINTA 1234,"                                            ";
     |PINTA 1334,"                                            ";
     |PINTA 1434,"                                            ";
     |PINTA 1534,"                                            ";
     |PINTA 1034,"                                            ";
     |PINTA 1734,"                                            ";
     |PARA nNume4=1;|SI nNume4 [ 250;|HACIENDO nNume4 = nNume4 + 1;
          nNume5    = (nNume4 * 100) + 1;
          aPos      = nNume5;
          aCaracter = aAlfa1 % aPos;
          |SI aCaracter = "|";
              nBarras = nBarras + 1;
              HayBarra = "S";
          |FINSI;
          |SI aCaracter = ""; |SAL; |FINSI;
          |SI nBarras = 5;
               aNumeroRC = aNumeroRC + aCaracter;
          |FINSI;
          |SI nBarras = 6;
               aNumeroRC = aNumeroRC - "|";
               aFechaRC = aFechaRC + aCaracter;
          |FINSI;
          |SI nBarras = 7;
               aFechaRC = aFechaRC - "|";
               aCodRepRC = aCodRepRC + aCaracter;
          |FINSI;
          |SI nBarras = 8;
               aCodRepRC = aCodRepRC - "|";
               aCodCliRC = aCodCliRC + aCaracter;
          |FINSI;
          |SI nBarras = 9;
               aCodCliRC = aCodCliRC - "|";
               aNomCliRC = aNomCliRC + aCaracter;
          |FINSI;
     |SIGUE;
     aNomCliRC = aNomCliRC - "|";
     |LEE 000#307u;
     nNume4 = #307#0 + 1;
     |DDEFECTO #307;
     #307#0 = nNume4;
     fFecha = aFechaRC;
     #307#1 = fFecha;
     aCodRepME = aCodRepME - "|";
     |SELECT #2#303;
     #303#2 = aCodRepME;
     |LEE 000#303=;
     |SI FSalida = 0;
         #307#2 = #303#0;
     |FINSI;
     aAlfa4 = aCodCliRC;
     aAlfa4 = aAlfa4 % 103;
     |SI aAlfa4 ! "430"; |BUCLE agifa024; |SINO; aAlfa6 = aCodCliCL % -106; |FINSI;
     #307#4 = aAlfa6;
     #307#5 = #24#1;
     |GRABA 020#307n;
|FPRC;

|PROCESO ProcesaRecLin;
     HayBarra = "N";
     nBarras  = 0;
     ||-------------RECOGIDALIN
     aNumeroRL  = "";
     aNumFacRL  = "";
     aFecFacRL  = "";
     aCodArtRL  = "";
     aUniArtRL  = "";
     aDescriRL  = "";
     aMotivoRL  = "";
     aCodRepRL  = "";
     aAlfa2 = aAlfa2 + " / Lineas Recogida";
     |PINTA 1734,aAlfa2;
     |PINTA 1134,"                                            ";
     |PINTA 1234,"                                            ";
     |PINTA 1334,"                                            ";
     |PINTA 1434,"                                            ";
     |PINTA 1534,"                                            ";
     |PINTA 1634,"                                            ";
     |PARA nNume4=1;|SI nNume4 [ 250;|HACIENDO nNume4 = nNume4 + 1;
          nNume5    = (nNume4 * 100) + 1;
          aPos      = nNume5;
          aCaracter = aAlfa1 % aPos;
          |SI aCaracter = "|";
              nBarras = nBarras + 1;
              HayBarra = "S";
          |FINSI;
          |SI aCaracter = ""; |SAL; |FINSI;
          |SI nBarras = 5;
               aNumeroRL = aNumeroRL + aCaracter;
          |FINSI;
          |SI nBarras = 6;
               aNumeroRL = aNumeroRL - "|";
               aNumFacRL = aNumFacRL + aCaracter;
          |FINSI;
          |SI nBarras = 7;
               aNumFacRL = aNumFacRL - "|";
               aFecFacRL = aFecFacRL + aCaracter;
          |FINSI;
          |SI nBarras = 8;
               aFecFacRL = aFecFacRL - "|";
               aCodArtRL = aCodArtRL + aCaracter;
          |FINSI;
          |SI nBarras = 9;
               aCodArtRL = aCodArtRL - "|";
               aUniArtRL = aUniArtRL + aCaracter;
          |FINSI;
          |SI nBarras = 10;
               aUniArtRL = aUniArtRL - "|";
               aDescriRL = aDescriRL + aCaracter;
          |FINSI;
          |SI nBarras = 11;
               aDescriRL = aDescriRL - "|";
               aMotivoRL = aMotivoRL + aCaracter;
          |FINSI;
     |SIGUE;
     aMotivoRL = aMotivoRL - "|";
     #308#0    = aNumeroRC;
     #308#1    = 1;
     |LEE 000#308=;
     |PARA nNume4 = 1;|SI;|HACIENDO nNume4 = nNume4 + 1;
           #308#0    = aNumeroRC;
           #308#1    = nNume4;
           |LEE 000#308=;
           |SI FSalida ! 0;
               |SAL;
           |FINSI;
     |SIGUE;
     |DDEFECTO #73;
     #308#0 = aNumeroRC;
     #308#1 = nNume4;
     #308#3 = aNumFacRL;
     fFecha = aFecFacRL;
     #308#4 = fFecha;
     #308#5 = aCodArtRL;
     #308#7 = aUniArtRL;
     #308#6 = aDescriRL;
     #308#8 = aMotivoRL;
     |GRABA 020#308n;
|FPRC;

|PROCESO NombreFichero;
     |SI aTabla = "ZCABPED";
             |HAZ ProcesaCabPed;
     |FINSI;
     |SI aTabla = "ZLINPED";
             |HAZ ProcesaLinPed;
     |FINSI;
     |SI aTabla = "VISITAS";
             |HAZ ProcesaVisitas;
     |FINSI;
     |SI aTabla = "MENSAJESENV";
             |HAZ ProcesaMensajes;
     |FINSI;
     |SI aTabla = "CLIENTES";
             |HAZ ProcesaClientes;
     |FINSI;
     |SI aTabla = "ZNUECLI";
             |HAZ ProcesaNueClis;
     |FINSI;
     |SI aTabla = "RECOGIDACAB";
             |HAZ ProcesaRecCab;
     |FINSI;
     |SI aTabla = "RECOGIDALIN";
             |HAZ ProcesaRecLin;
     |FINSI;
|FPRC;

|PROCESO ProcesaLinea;
     |SELECT #2#303;
     #303#2 = #300#0;
     |LEE 000#303=;
     #25#0 = #303#0;
     |LEE 000#25=;
     |SI FSalida = 0;
         aAlfa2 = #25#1;
     |FINSI;
     |QBF aAlfa2;
                                             ||Fichero a tratar
     aTabla = "";
     |PARA nNume2=1;|SI nNume2 [ 100;|HACIENDO nNume2 = nNume2 + 1;
          nNume3    = (nNume2 * 100) + 1;
          aPos      = nNume3;
          aCaracter = aAlfa1 % aPos;
          |SI aCaracter = "|";
              |HAZ NombreFichero;
              |SAL;
          |SINO;
              aTabla = aTabla + aCaracter;
          |FINSI;
     |SIGUE;
|FPRC;

|PROCESO ProcesaFichero;
     |XABRE "U",aFichero,nNume1;
     |SI FSalida ] 0;
          |PINTA 0834,aFichero;
          |XLEE nNume1,250,aAlfa1;
          |PARA; |SI aAlfa1>""; |HACIENDO;
               |HAZ ProcesaLinea;
               |XLEE nNume1,250,aAlfa1;
          |SIGUE;
     |SINO;
          |XCIERRA nNume1;
          |ACABA;
     |FINSI;
|FPRC;

|PROCESO Tmp;
     aAlfa1 = #1#2; |QBF  aAlfa1;
     |SI #1#0 = "ZCABPED";
          HacerLineas = "N";
          |HAZ XProcesaCabPed;
     |SINO;
          |SI HacerLineas = "S";
               |HAZ XProcesaLinPed;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE Tmp;
     #1#2;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Tmp;
|FIN;

|PROGRAMA;
     fFechaSys = ~;
     |HAZ CreaTempo; aTempo1 = Tempo;
     |NOME_DAT #1 aTempo1; |DELINDEX #1;

     |HAZ CreaTempo; aTempo2 = Tempo;
     |NOME_DAT #2 aTempo2; |DELINDEX #2;
     aFicRies = aTempo2;

     |CLS;
     |CABEZA "Rastreo de Ficheros";
     |ABRE #0;
     |PINPA #0#0;
     |ENCAMPO #0#0;
     |SI FSalida=0;
         |ABRE #2;
         |ABRE #104;
         |ABRE #73;
         |ABRE #24;
         |ABRE #19;
         |ABRE #17;
         |ABRE #300;
         |ABRE #303;
         |ABRE #25;
         |ABRE #304;
         |ABRE #305;
         |ABRE #306;
         |ABRE #324;
         |ABRE #27;
         |ABRE #142;
         |ABRE #307;
         |ABRE #308;
         |LEE 000#300p;
         |PARA; |SI FSalida = 0; |HACIENDO;
             aFichero = #300#2;
             |QBF aFichero;
             aFichero = aFichero + aFich;
             |DELINDEX #1;
             nContaTmp = 0;
             |ABRE #1;
             |HAZ ProcesaFichero;
             |CIERRA #1;
             |BUCLE Tmp;
             |DELINDEX #1;
             |LEE 000#300s;
         |SIGUE;
         |CIERRA #104;
         |CIERRA #73;
         |CIERRA #24;
         |CIERRA #19;
         |CIERRA #17;
         |CIERRA #300;
         |CIERRA #303;
         |CIERRA #25;
         |CIERRA #304;
         |CIERRA #305;
         |CIERRA #306;
         |CIERRA #324;
         |CIERRA #27;
         |CIERRA #142;
         |CIERRA #307;
         |CIERRA #308;
         |CIERRA #2;
     |FINSI;
     aAlfa = "marhu209;" + aFicRies;
     |SUB_EJECUTA_NP aAlfa;
     |DELINDEX #1;  Tempo = aTempo1; |HAZ BoraTempo;
     |DELINDEX #2;  Tempo = aTempo2; |HAZ BoraTempo;
|FPRO;
