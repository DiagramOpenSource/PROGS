/*   Calulo anterior a
     ABIERTO Subtiquet nro. 01712.0004 Cliente: 002534 VIGOR, S.L.
     Informe: vigz0049.inf.antes


alba0021

|FICHEROS;
vigz0049 #0;
agifa071 #1;
agifa010 #2;
agifa019 #3;
agifa025 #4;
vigw0026 #5;   ||Temporal.
agifa024 #6;
agifa134 #7;
vigw0025 #25;
vigm0043 #43;
agifa007;
|FIN;

|VARIABLES;
aTmp5 = "";
aTmp25 = "";
&Tempo = "";
nPta = 166.386;
&enMtKg = 0;
aCli = "";
nZona = 0;
nTota = 0;
nRep = 0;
nPorZona = 0;
nPorTota = 0;
nPorRep = 0;
aSerie = "";
informe   = "";
&zona     = "";
&repres   = "";
&cliente  = "";
i         = 0;
sw        = 0;
&swlin    = 0;
&t1       = 0;
&t2       = 0;
&t3       = 0;
&t4       = 0;
&t5       = 0;
&t6       = 0;
&t7       = 0;
&t8       = 0;
&t9       = 0;
&t10      = 0;
&tc1      = 0;
&tc2      = 0;
&tc3      = 0;
&tc4      = 0;
&tc5      = 0;
&tc6      = 0;
&tc7      = 0;
&tc8      = 0;
&tc9      = 0;
&tc10     = 0;
&tr1      = 0;
&tr2      = 0;
&tr3      = 0;
&tr4      = 0;
&tr5      = 0;
&tr6      = 0;
&tr7      = 0;
&tr8      = 0;
&tr9      = 0;
&tr10     = 0;
&tt1      = 0;
&tt2      = 0;
&tt3      = 0;
&tt4      = 0;
&tt5      = 0;
&tt6      = 0;
&tt7      = 0;
&tt8      = 0;
&tt9      = 0;
&tt10     = 0;
swpasa    = 0;
mtpkg = 0;
|FIN;

|PROCESO &Suma;
     |SI swlin = 6;
          mtpkg = tc10 * nPta;
          mtpkg = mtpkg / tc2;
          mtpkg = mtpkg - #6#170;

          nPorRep = nPorRep + (mtpkg * tc2);
          nPorZona = nPorZona + (mtpkg * tc2);
          nPorTota = nPorTota + (mtpkg * tc2);
     |FINSI;
|FPRC;

|PROCESO &BRep;
     nPorRep = 0;
|FPRC;

|PROCESO &BZona;
     nPorZona = 0;
|FPRC;

|PROCESO CambiaCli;
     |SI aCli ! #5#1;
          |DDEFECTO #6;
          #6#0 = #5#1;
          |LEE 000#6=;
          aCli = #5#1;
          nRep = nRep + 1;
          nZona = nZona + 1;
          nTota = nTota + 1;
     |FINSI;
|FPRC;

|CALCULO impresion;
     |SI sw = 0;
         sw = 1;
         repres  = #5#10;
         zona    = #5#0;
         cliente = #5#1;
         swlin = 3;  ||Datos Representante
         |PRINT;
         swlin = 0;
         swlin = 2;  ||Datos Zona
         |PRINT;
         swlin = 0;
         swlin = 5;  ||Datos Cliente
         |PRINT;
         swlin = 0;
     |FINSI;

     |SI sw = 1;
         |SI repres ! #5#10;
             swlin = 6;   ||Totales Cliente
             |PRINT;
             swlin = 0;
             enMtKg = nPorZona / t2;
             swlin = 1;   ||Totales Zona
             |PRINT;
             swlin = 0;
             enMtKg = nPorRep / tr2;
             swlin = 4;   ||Totales Representante
             |PRINT;
             swlin = 0;
             |SI #0#15 = "N"; |PIEINF; |FINSI;
             repres  = #5#10;
             zona    = #5#0;
             cliente = #5#1;
             swlin = 3;   ||Datos Representante
             |PRINT;
             swlin = 0;
             swlin = 2;   ||Datos Zona
             |PRINT;
             swlin = 0;
             swlin = 5;   ||Datos Cliente
             |PRINT;
             swlin = 0;
             t1  = 0;
             t2  = 0;
             t3  = 0;
             t4  = 0;
             t5  = 0;
             t6  = 0;
             t7  = 0;
             t8  = 0;
             t9  = 0;
             t10 = 0;

             tc1  = 0;
             tc2  = 0;
             tc3  = 0;
             tc4  = 0;
             tc5  = 0;
             tc6  = 0;
             tc7  = 0;
             tc8  = 0;
             tc9  = 0;
             tc10 = 0;

             tr1  = 0;
             tr2  = 0;
             tr3  = 0;
             tr4  = 0;
             tr5  = 0;
             tr6  = 0;
             tr7  = 0;
             tr8  = 0;
             tr9  = 0;
             tr10 = 0;
             nRep = 0;
             nZona = 0;
             nPorRep = 0;
             nPorZona = 0;
         |FINSI;

         |SI zona ! #5#0;
             swlin = 6;  ||Totales Cliente
             |PRINT;
             swlin = 0;
             enMtKg = nPorZona / t2;
             swlin = 1;  ||Totales Zona
             |PRINT;
             swlin = 0;
             zona = #5#0;
             cliente = #5#1;
             swlin = 2;  ||Datos Zona
             |PRINT;
             swlin = 0;
             swlin = 5;  ||Datos Cliente
             |PRINT;
             swlin = 0;
             t1  = 0;
             t2  = 0;
             t3  = 0;
             t4  = 0;
             t5  = 0;
             t6  = 0;
             t7  = 0;
             t8  = 0;
             t9  = 0;
             t10 = 0;

             tc1  = 0;
             tc2  = 0;
             tc3  = 0;
             tc4  = 0;
             tc5  = 0;
             tc6  = 0;
             tc7  = 0;
             tc8  = 0;
             tc9  = 0;
             tc10 = 0;
             nZona = 0;
             nPorZona = 0;
         |FINSI;

         |SI cliente ! #5#1;
               swlin = 6;  ||Totales Cliente
               |PRINT;
               swlin = 0;
               cliente = #5#1;
               swlin = 5;  ||Datos Cliente
               |PRINT;
               swlin = 0;

               tc1  = 0;
               tc2  = 0;
               tc3  = 0;
               tc4  = 0;
               tc5  = 0;
               tc6  = 0;
               tc7  = 0;
               tc8  = 0;
               tc9  = 0;
               tc10 = 0;
         |FINSI;
     |FINSI;

     t1  = t1 + #5#4;
     t2  = t2 + #5#5;
     t3  = t3 + #5#6;
     t4  = t4 + #5#7;
     t5  = (t4 / t1) * 100;
     t6  = t3 / t2;
     t7  = t1 / t2;
     t8  = t3 / t2;
     t9  = t7 - t8;
     t10 = t9 * t2;

     tc1  = tc1 + #5#4;
     tc2  = tc2 + #5#5;
     tc3  = tc3 + #5#6;
     tc4  = tc4 + #5#7;
     tc5  = (tc4 / tc1) * 100;
     tc6  = tc3 / tc2;
     tc7  = tc1 / tc2;
     tc8  = tc3 / tc2;
     tc9  = tc7 - tc8;
     tc10 = tc9 * tc2;

     tr1 = tr1 + #5#4;
     tr2 = tr2 + #5#5;
     tr3 = tr3 + #5#6;
     tr4 = tr4 + #5#7;
     tr5 = (tr4 / tr1) * 100;
     tr6 = tr3 / tr2;
     tr7 = tr1 / tr2;
     tr8 = tr3 / tr2;
     tr9 = tr7 - tr8;
     tr10 = tr9 * tr2;

     tt1  = tt1 + #5#4;
     tt2  = tt2 + #5#5;
     tt3  = tt3 + #5#6;
     tt4  = tt4 + #5#7;
     tt5  = (tt4 / tt1) * 100;
     tt6  = tt3 / tt2;
     tt7  = tt1 / tt2;
     tt8  = tt3 / tt2;
     tt9  = tt7 - tt8;
     tt10 = tt9 * tt2;

     |HAZ CambiaCli;
     |PRINT;
|FCAL;

|DEFBUCLE NueImpre3;
     #5#2;
     ;
     INICIO;
     FINAL;
     ;
     NULL, impresion;
|FIN;

|PROCESO NueImpre2;
     #25#1 = #5#1;
     |LEE 020#25=;

     #5#18 = #25#11;
     |GRABA 020#5a;
     |LIBERA #5;
|FPRC;

|DEFBUCLE NueImpre2;
     #5#1;
     ;
     INICIO;
     FINAL;
     be;
     NULL, NueImpre2;
|FIN;

|PROCESO Fin1;
     |DDEFECTO #6;
     #6#0 = aCli;
     |LEE 000#6=;
     enMtKg = tc10 * nPta;
     enMtKg = enMtKg / tc2;
     enMtKg = enMtKg - #6#170;

     #25#1 = aCli;
     #25#11 = enMtKg;
     |GRABA 020#25n;

     tc1 = 0; tc2 = 0; tc3 = 0; tc4 = 0; tc5 = 0;
     tc6 = 0; tc7 = 0; tc8 = 0; tc9 = 0; tc10 = 0;
|FPRC;

|PROCESO NueImpre1;
     |SI aCli = ""; aCli = #5#1; |FINSI;

     |SI aCli ! #5#1;
          |HAZ Fin1;
          aCli = #5#1;
     |FINSI;
     tc1  = tc1 + #5#4;
     tc2  = tc2 + #5#5;
     tc3  = tc3 + #5#6;
     tc4  = tc4 + #5#7;
     tc5  = (tc4 / tc1) * 100;
     tc6  = tc3 / tc2;
     tc7  = tc1 / tc2;
     tc8  = tc3 / tc2;
     tc9  = tc7 - tc8;
     tc10 = tc9 * tc2;
|FPRC;

|DEFBUCLE NueImpre1;
     #5#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, NueImpre1;
|FIN;

|DEFBUCLE impresion;
     #5#1;
     ;
     INICIO;
     FINAL;
     be;
     NULL,NULL,NULL,NULL,NULL,impresion;
     #5#10,#5#0,#5#3,#5#1,#5#11;
|FIN;

|PROCESO EsInterno;
     |DDEFECTO #agifa007;
     #agifa007#26 = aSerie;
     |LEE 000#agifa007.=;

     |SI #agifa007#37 = "S";
          FSalida = 0;
     |SINO;
          FSalida = 1;
     |FINSI;
|FPRC;

|CALCULO pasa_lin;
     |DDEFECTO #2;
     #2#52 = #1#29;
     #2#0 = #1#0;
     |LEE 000#2=;

     aSerie = #agifa010#52;
     |HAZ EsInterno;
     |SI FSalida = 0; |ACABA; |FINSI;

     |DDEFECTO #3;
     #3#0 = #1#2;
     |LEE 000#3=;

     |DDEFECTO #4;
     #4#0 = #2#6;
     |LEE 000#4=;

     |DDEFECTO #6;
     #6#0 = #2#3;
     |LEE 000#6=;

     |DDEFECTO #7;
     #7#0 = #2#39;
     #7#49 = #2#53;
     |LEE 000#7=;

     |SI #2#1 ] #0#3;|Y #2#1 [ #0#4;
        |SI #2#6 ] #0#7;|Y #2#6 [ #0#8;
            |SI #6#3 ] #0#9;|Y #6#3 [ #0#10;
                |SI #2#3 ] #0#11;|Y #2#3 [ #0#12;
                    |DDEFECTO #5;
                    #5#10 = #2#6;
                    #5#11 = #1#2;
                    #5#0  = #6#3;
                    #5#1  = #2#3;
                    |LEE 000#5=;
                    |SI FSalida ! 0; |GRABA 020#5b; |FINSI;
                    #5#2  = #6#1;
                    #5#3  = #6#6;
                    #5#4  = #5#4 + #1#9;
                    #5#5  = #5#5 + #1#5;
                    #5#6  = #5#6 + #1#14;
                    #5#7  = #5#4 - #5#6;
                    #5#8  = (#5#7 / #5#4) * 100;
                    #5#9  = #5#6 / #5#5;
                    #5#12 = #3#1;
                    #5#13 = #5#4 / #5#5;
                    #5#14 = #5#6 / #5#5;
                    #5#15 = #5#13 - #5#14;
                    #5#16 = #5#15 * #5#5;
                    #5#17 = (#5#15 * nPta) - #6#170;
                    |GRABA 020#5a;
                    |LIBERA #5;
                |FINSI;
            |FINSI;
        |FINSI;
    |FINSI;
|FCAL;

|DEFBUCLE lee_lin;
#1#1;
2;
#0#1 , 000001,  0 , #0#13;
#0#2 , 999999,999 , #0#14;
be;
NULL,pasa_lin;
|FIN;

|PROCESO HistoTras;
     aSerie = #43#0;
     |HAZ EsInterno;
     |SI FSalida = 0; |ACABA; |FINSI;

     |DDEFECTO #3;
     #3#0 = #43#12;
     |LEE 000#3=;

     |DDEFECTO #4;
     #4#0 = #43#10;
     |LEE 000#4=;

     |DDEFECTO #6;
     #6#0 = #43#8;
     |LEE 000#6=;

     |SI #43#6 ] #0#3;|Y #43#6 [ #0#4;                 || Fecha
         |SI #43#10 ] #0#7;|Y #43#10 [ #0#8;           || Repre
             |SI #43#9 ] #0#9;|Y #43#9 [ #0#10;        || Zona
                 |SI #43#8 ] #0#11;|Y #43#8 [ #0#12;   || Cliente
                 |SI #43#12 ] #0#13; |Y #43#12 [ #0#14;|| Articulo
                     |DDEFECTO #5;
                     #5#10 = #43#10;
                     #5#11 = #43#12;
                     #5#0  = #43#9;
                     #5#1  = #43#8;
                     |LEE 000#5=;
                     |SI FSalida ! 0; |GRABA 020#5b; |FINSI;
                     #5#2  = #6#1;
                     #5#3  = #6#6;
                     #5#4  = #5#4 + #43#15;
                     #5#5  = #5#5 + #43#13;
                     #5#6  = #5#6 + #43#16;
                     #5#7  = #5#4 - #5#6;
                     #5#8  = (#5#7 / #5#4) * 100;
                     #5#9  = #5#6 / #5#5;
                     #5#12 = #3#1;
                     #5#13 = #5#4 / #5#5;
                     #5#14 = #5#6 / #5#5;
                     #5#15 = #5#13 - #5#14;
                     #5#16 = #5#15 * #5#5;
                     #5#17 = (#5#15 * nPta) - #6#170;
                     |GRABA 020#5a;
                     |LIBERA #5;
                 |FINSI;
                 |FINSI;
             |FINSI;
         |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE HistoTras;
     #43#1;
     ;
     #0#1, 000001, 001;
     #0#2, 999999, 999;
     ;
     NULL, HistoTras;
|FIN;

|CALCULO alba0021;|TIPO 3;
     |SI #0#5 ! "SI"; |ACABA; |FINSI;

     |HAZ CreaTempo; |NOME_DAT #5 Tempo; |DELINDEX #5; aTmp5 = Tempo;
     |HAZ CreaTempo; |NOME_DAT #25 Tempo; |DELINDEX #25; aTmp25 = Tempo;

     |SI #0#15 = "S";
          Impresora = "Crystal Reports";
     |FINSI;

     |IMPRE 0;
     |SI FSalida = 0;
          |SI #0#16 = "S";
               informe = "vigza049";
          |SINO;
               |SI #0#15 = "S";
                    informe = "vigzc049";
                    |SI Impresora ! "CrystalReport";
                         |MENAV "0000La impresora seleccionada no es Crystal Reports";
                         ||||FINIMP; |ACABA;
                    |FINSI;
               |SINO;
                    informe = "vigz0049";
               |FINSI;
          |FINSI;
          |INFOR informe;
          |SI FSalida = 0;
               |ABRE #agifa007;
               |ABRE #2;
               |ABRE #3;
               |ABRE #4;
               |ABRE #5;
               |ABRE #6;
               |ABRE #7;
               |BUCLE lee_lin;
               |BUCLE HistoTras;
               |CIERRA #7;
               |CIERRA #6;
               |CIERRA #5;
               |CIERRA #4;
               |CIERRA #3;
               |CIERRA #2;
               |CIERRA #agifa007;

               |ABRE #6;
               |SI #0#16 = "S";
                    |ABRE #25;
                    |ABRE #6;
                    aCli = "";
                    |BUCLE NueImpre1; || Calcula
                    |HAZ Fin1;

                    |BUCLE NueImpre2; || Graba calculo
                    |CIERRA #6;
                    |CIERRA #25;

                    tc1 = 0; tc2 = 0; tc3 = 0; tc4 = 0; tc5 = 0;
                    tc6 = 0; tc7 = 0; tc8 = 0; tc9 = 0; tc10 = 0;
                    aCli = "";
                    |BUCLE NueImpre3; || Imprime
               |SINO;
                    |BUCLE impresion;
               |FINSI;
               |CIERRA #6;

               swlin = 6;  ||Totales Cliente
               |PRINT;
               swlin = 0;
               enMtKg = nPorZona / t2;
               swlin = 1;  ||Totales Zona
               |PRINT;
               swlin = 0;
               enMtKg = nPorRep / tr2;
               swlin = 4;  ||Totales Representante
               |PRINT;
               enMtKg = nPorTota / tt2;
               swlin = 0;
               |SI #0#15 = "N"; |PIEINF; |FINSI;
               swlin = 10;
               |PIEINF;
               swlin = 0;
               |FININF;
          |FINSI;
          |FINIMP;
     |FINSI;
     Tempo = aTmp5; |HAZ BoraTempo; |DELINDEX #5;
     Tempo = aTmp25; |HAZ BoraTempo; |DELINDEX #5;
|FCAL;
*/
