|FICHEROS;
     dsm00003 #3;
     coima049 #49;
     coima035 #35;
     agifa024 #24;
     agifa027 #27;
     agifa040 #40;
     agifa142 #142;

     dscam038@;
     dscam023@;
     dscam024@;
|FIN;

|VARIABLES;
     nConta = 0;
     aAlfa = "";
     nNume = 0;
     aCp1 = "";
     aCp2 = "";
     nEmp = 0;
     aDef = "";
     aPath = "";
|FIN;

|PROCESO CtrRecibo;
     |SI #35#10 ] #dscam038@#3; |Y #35#10 [ #dscam038@#4;
          |SI #dscam038@#2 = #35#20;
               aAlfa = ("00000" + #dscam038@#5) % -105;

               aAlfa = aPath + aAlfa + "/";
               |PATH_DAT #dscam023@#aAlfa#;
               |PATH_DAT #dscam024@#aAlfa#;

               |ABRE #dscam023@;
               |ABRE #dscam024@;
               |DDEFECTO #dscam023@;
               #dscam023@#0 = #24#0;
               #dscam023@#1 = #24#1;
               |GRABA 000#dscam023@.n;
               |SI FSalida = 0;
                    |DDEFECTO #dscam024@;
                    #dscam024@#0 = #dscam024@#0;
                    #dscam024@#1 = 1
                    |GRABA 000#dscam024@.n;
               |FINSI;
               |CIERRA #dscam024@;
               |CIERRA #dscam023@;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE CtrRecibo;
     #dscam038@#1002;
     ;
     nEmp, 001;
     nEmp, 999;
     ;
     NULL, CtrRecibo;
|FIN;

|PROCESO CreaCliente;
     |ABRE #142; |LEE 000#142p; |CIERRA #142;

     |ABRE #27;
     #27#0 = "clientes";
     |LEE 101#27=;
     |SI FSalida = 0;
          #27#1 = #27#1 + 1;
          nConta = #27#1;
          |GRABA 021#27a;
     |SINO;
          #27#1 = 1;
          nConta = 1;
          |GRABA 021#27n;
     |FINSI;
     |CIERRA #27;
     aAlfa = ("000000" + nConta) % -106;

     |ABRE #24;
     |DDEFECTO #24;
     #24#0 = aAlfa;
     #24#1 = #49#25;
     #24#2 = #49#25;

     aCp1 = #49#28 % 102;
     aCp2 = #49#28 % 303;
     |ABRE #40;
     #40#0 = aCp1;
     |LEE 000#40=;
     |SI FSalida ! 0; |DDEFECTO #40; |FINSI;
     |CIERRA #40;

     #24#5 = #49#26; || Dir
     #24#6 = #49#27; || Pob
     #24#7 = #40#1;  || Prv

     #24#8 = #24#5;
     #24#9 = #24#6;
     #24#10 = #24#7;

     #24#11 = #24#5;
     #24#12 = #24#6;
     #24#13 = #24#7;

     #24#14 = "ESPA¥A";
     #24#205 = "ES";

     #24#15 = #49#29;

     aAlfa = "000000000000" + #24#0;
     |QBT aAlfa;
     nNume = -(100 + (#142#11 - 2));
     aAlfa = aAlfa % nNume;
     aAlfa = "43" + aAlfa;
     #24#16 = aAlfa;

     #24#25 = #49#4;
     |SI #24#25 = "  ";
          #24#25 = "00";
     |FINSI;

     #24#178 = aCp1;
     #24#179 = aCp2;
     #24#180 = #49#28;

     #24#181 = aCp1;
     #24#182 = aCp2;
     #24#183 = #49#28;

     #24#184 = aCp1;
     #24#185 = aCp2;
     #24#186 = #49#28;
     |GRABA 020#24n;     || Si da error 100 revisar el contador "clientes"
     |CIERRA #24;

     |ABRE #3;
     |DDEFECTO #3;
     #3#0 = #24#0;
     #3#1 = 1;
     |LEE 101#3=;
     |SI FSalida ! 0; |GRABA 021#3b; |FINSI;
     #3#2 = #24#5;
     #3#3 = #24#6;
     #3#4 = #24#178;
     #3#5 = #24#179;
     #3#6 = #24#180;
     #3#7 = #24#7;
     #3#8 = #24#14;
     #3#10 = #24#2;
     #3#11 = #24#3;
   ||  #3#12 =
     #3#13 = #24#17;
     #3#14 = #24#25;
  ||   #3#15 =
     #3#16 = #24#189;
   ||  #3#17 =
     #3#19 = #24#205;
     #3#20 = #24#196;
     #3#21 = #24#18;
     #3#22 = #24#36;
     #3#23 = #24#211;
     #3#24 = #24#197;
     |GRABA 020#3a;

     |SI #49#3 ! 1;
          #3#2 = #49#3;
          |GRABA 000#3a;
     |FINSI;
     |CIERRA #3;

     |DBASS aAlfa;
     aDef = aAlfa + "dscarter/def/";
     aPath = aAlfa + "dscarter/fich/";

     aAlfa = aDef + "dscam038";
     |CARGA_DEF aAlfa, dscam038@;
     |SI FSalida = 0;
          aAlfa = aDef + "dscam023";
          |CARGA_DEF aAlfa, dscam023@;
          |SI FSalida = 0;
               aAlfa = aDef + "dscam024";
               |CARGA_DEF aAlfa, dscam024@;
               |SI FSalida = 0;
                    |DFICE aAlfa;
                    aAlfa = aAlfa % -205; nEmp = aAlfa;

                    |PATH_DAT #dscam038@#aPath#;
                    |BUCLE CtrRecibo;

                    |DESCARGA_DEF  #dscam024@;
               |FINSI;
               |DESCARGA_DEF  #dscam023@;
          |FINSI;
          |DESCARGA_DEF  #dscam038@;
     |FINSI;
|FPRC;
