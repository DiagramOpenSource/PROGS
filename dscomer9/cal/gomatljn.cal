|FICHEROS;
     gomatljn #0;
     gomatlin #1;
     gomantca #2;
     goalbpa1 #4;
     goalbpa4 #104;
     goalbpa3 #5;
     agifa324 #6;                                 ||Divisas.
     goparame #7;
     agifa027 #8;
     agifa321 #9;
     gomatcab #10;
     agifa019 #13;
     agifa024 #14;
     gopre004 #15;
     agifa077 #16; || ,MANTE;
     goalbpa2 #17;
     gosubaux #20;
     agifa080 #80;
     goalbpa5 #117;
     referen@;
     agifa029 #100;
     gomantho #101;
     goparam5 #105;
|FIN;
-----------------------------------------------------------------------------
|VARIABLES;
     &enError = 0;
     aEsCentral = "N";
     &enSubcon = 0;
     &eaReceAlmaObra = "";
     &eaFecAlmaObra = "";
     &Tempo = "";
     &enAlmaAdjCon = 0;
     &enAlmaAdjCon0 = 0;
     &enAlmaExpe = 0;
     &eaFecConstru  = "";
     &efFecha       = @;
     aAlfa          = "";
     &cCodMonBase   = "";
     &cCodMonTrab   = "";
     &cDesMonBase   = "";
     &cDesMonTrab   = "";
     &cSerieExpe    = "";
     &cSeriePres    = "";
     &cSerieAlba    = "";
     &cUsu          = "";
     &cPartida      = "";
     &eaSer         = "";
     &cModulo       = "";
     &cProveAlba    = "";
     &cNombrAlba    = "";
     &cSuAlbaran    = "";

     &fFechaAlba    = @;

     &xSerie        = "";
     &enDocu        = 0;
     &nNumerExpe    = 0;
     &nNumerPres    = 0;
     &nNumerAlba    = 0;
     &nTotComBas    = 0;
     &nTotComTra    = 0;
     &nTotVenBas    = 0;
     &nTotVenTra    = 0;

     &nCambio       = 0;
     &nErrorSal     = 0;
     &nDeci_IBase   = 0;
     &nDeci_TBase   = 0;
     &nDeci_ITrab   = 0;
     &nDeci_TTrab   = 0;
     &nDeci_TotVis  = 0;
     &nEurMonTrab   = 0;
     &nEurMonBase   = 0;

     &xDocTras      = 0;
     &xFecDocu      = @;
     &xLinDocu      = 0;
     &xCodArti      = "";
     &xDesArti      = "";
     &xCanArti      = 0;
     &xAlmEntr      = 0;
     &xAlmSali      = 0;
     &xModo         = 0;
     &xForma        = 0;

     nSumHor        = 0;
     nModo          = 0;
     nEuros         = 0;
     nPreBas        = 0;
     nHay           = 0;
     nForma         = 0;
     nExiste        = 0;

     cNumero        = "";
     cFichero       = "";
     cFich          = "";
     cMensaje       = "";
     &neSObras      = 0;
     {-1}menu       = "";
     menu1          = "2400";
     menu2          = "1";
     menu3          = "Accción: ";
     menu4          = "CAD";
     menu5          = " Crear   ";
     menu6          = " Asignar ";
     menu7          = " Adjudicar ";
|FIN;
-------------------------------------------------------------------------------
|PROCESO BorraParti;
/*
QUITADO SEGUN 3774/349

     |ABRE #17;
     #17#0 = #5#4;                                ||Serie Alba.
     #17#1 = #5#5;                                ||Nume. Alba.
     #17#2 = #5#6;                                ||Nume. Line.
     |LEE 101#17=;
     |SI FSalida = 0;
          |DDEFECTO #80;
          |ABRE #80;
          #80#27 = #17#0;
          #80#0 = #17#1;
          #80#1 = #17#2;
          |LEE 000#80=;
          |CIERRA #80;

          |SI #80#3 ! #5#17;
               xDocTras = #5#19;
               xSerie   = #5#32;
               xFecDocu = #0#3;
               xLinDocu = #5#7;
               xCodArti = #17#3;
               xDesArti = #17#4;
               xCanArti = #5#10;
               xAlmEntr = #5#17;
               xAlmSali = #17#8;
               xModo = 3;
               xForma = -1;
               |SUB_EJECUTA_NP "gomovalm";
          |FINSI;
     |FINSI;
     |CIERRA #17;

     |ABRE #117;
     #117#0 = #5#4;                                ||Serie Alba.
     #117#1 = #5#5;                                ||Nume. Alba.
     #117#2 = #5#6;                                ||Nume. Line.
     |LEE 101#117=;
     |SI FSalida = 0;
          |DDEFECTO #80;
          |ABRE #80;
          #80#27 = #17#0;
          #80#0 = #17#1;
          #80#1 = #17#2;
          |LEE 000#80=;
          |CIERRA #80;
          |SI #80#3 ! #117#8;
               xDocTras = #5#19;
               xSerie   = #5#32;
               xFecDocu = #0#3;
               xLinDocu = #5#7;
               xCodArti = #117#3;
               xDesArti = #117#4;
               xCanArti = #5#10;
               xAlmEntr = #5#17;
               xAlmSali = #117#8;
               xModo = 3;
               xForma = -1;
               |SUB_EJECUTA_NP "gomovalm";
          |FINSI;
     |FINSI;
     |CIERRA #117;
*/

     |BORRA 020#5a;

     #20#0 = #5#34;
     #20#1 = #5#4;
     #20#2 = #5#5;
     #20#3 = #5#6;
     #20#4 = #5#7;
     |BORRA 000#20c;
|FPRC;
-------------------------------------------------------------------------------
|DEFBUCLE BajaPartAlba;
     #5#1;
     ;                                          ||Campos Extras.
     "M", #0#5, #0#6, 001, 001;
     "M", #0#5, #0#6, 999, 999;
     ;                                          ||b/e Bolqueo-Ordenacion.
     NULL, BorraParti;
|FIN;
-------------------------------------------------------------------------------
|PROCESO ManMat; |TIPO 2;
     nModo = (FEntrada/100)!0;
     nForma =  0 +. 1;
     |SI #0#6 = 0; |Y nForma = 1;
          |ERROR;
          |ACABA;
     |FINSI;
     |SI nModo = 3;
          |CONFI "0000N¿Borrar albaran?";
          |SI FSalida = 0;
               aAlfa = "agifa015;" + #0#5 + #0#6;
               |SUB_EJECUTA_NP aAlfa;
               |SI enError ! 0; |ERROR; |ACABA; |FINSI;
          |FINSI;
          |ABRE #20;
          |BUCLE BajaPartAlba;
          |CIERRA #20;
          |ABRE #4;
          #4#0 = #0#5;
          #4#1 = #0#6;
          |LEE 000#4=;

          |SI FSalida = 0;
               |BUCLELIN 1 NULL #4;
               |BORRA 020#4a;
               |ABRE #16;
               #16#50 = #0#5;
               #16#0 = #0#6;
               |LEE 101#16=;
               |SI FSalida = 0;
                    #16#34 = "PE";
               |GRABA 020#16a;
               |FINSI;
               |LIBERA #16;
               |CIERRA #16;
          |FINSI;

          |CIERRA #4;
          ||------------------------------------------
          |ABRE #104;
          #104#0 = #0#5;
          #104#1 = #0#6;
          |LEE 000#104=;

          |SI FSalida = 0;
               |BUCLELIN 1 NULL #104;
               |BORRA 020#104a;
          |FINSI;
          |CIERRA #104;
     |FINSI;

     #1#5 = #1#5 +. #0#9;
     #1#6 = #1#6 +. #0#10;
     #1#7 = #1#7 +. #0#11;
     #1#8 = #1#8 +. #0#12;
     ||PINTA #1#5; |PINTA #1#7;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO MiraCerradoLin;
     nModo = (FEntrada/100)!0;
     |SI nModo ! 1;
          efFecha = #0#3;
          |HAZ EstaCerrado;
          |SI FSalida = 0;
               |ERROR; |ACABA;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO TotalGopartia;
     nTotComTra = nTotComTra + #5#14; ||Imp. Comp. Trabajo.
     nTotVenTra = nTotVenTra + #5#13; ||Imp. Vent. Trabajo.
     nTotComBas = nTotComBas + #5#25; ||Imp. Comp. Base.
     nTotVenBas = nTotVenBas + #5#24; ||Imp. Vent. Base.
|FPRC;

|DEFBUCLE TotalGopartia;
     #5#1;
     ;
     "M", cSerieAlba, nNumerAlba, 001, 001;
     "M", cSerieAlba, nNumerAlba, 999, 999;
     ;
     NULL, TotalGopartia;
|FIN;

|PROCESO AltMat; |TIPO 0;
     nModo = (FEntrada/100)!0;
     |MODULO cModulo;
     ||ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄControl Cierre
     efFecha = #0#3;
     |HAZ EstaCerrado;
     |SI FSalida = 0;
          |ERROR; |ACABA;
     |FINSI;
     ||ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ

     |SI nModo = 3;
          |ACABA;
     |FINSI;

     |SI nModo ! 1; |Y #0#6 = 0;
          |ERROR;
          |ACABA;
     |FINSI;

     |ABRE #7; |LEE 000#7p; |CIERRA #7;

     |SI nModo = 1;
          nNumerAlba = 0;

          cSerieExpe = #1#0;
          nNumerExpe = #1#1;
          cSeriePres = #1#3;
          nNumerPres = #1#4;
          nTotComTra = 0;
          nTotVenTra = 0;
          nTotComBas = 0;
          nTotVenBas = 0;
          nErrorSal  = 1;
          enAlmaExpe = 0;
          |SI #7#94 = "E"; enAlmaExpe = #1#0; |FINSI;

          eaFecAlmaObra = #0#3;
          |MENU menu;
          |SI FSalida [ 0;
               |ERROR;
               |ACABA;
          |FINSI;

          |SI FSalida = 1;
               neSObras = 1;
               |GRABA 020#1a;
               |GRABA 020#10a;
               |CIERRAT #1;
               |CIERRAT #10;

               |PTEC 802; |PTEC 802; |PTEC 810;

               eaFecConstru = #0#3;
               |SUB_EJECUTA_NP "goalbpa1;MATERIAL"
               eaFecConstru  = "";

               |ABRET #1;
               |ABRET #10;
               |LEE 121#10=;
               |LEE 121#1=;
          |FINSI;

          |SI FSalida = 2;
               neSObras = 2;
               |GRABA 020#1a;
               |GRABA 020#10a;
               |CIERRAT #1;
               |CIERRAT #10;

               |PTEC 802;|PTEC 810;
               |SUB_EJECUTA_NP "goalbpa1;MATERIAL"

               |ABRET #1;
               |ABRET #10;
               |LEE 121#1=;
               |LEE 121#10=;
          |FINSI;

          |SI FSalida = 3;
               aEsCentral = "N";
               |ABRE #101;
               #101#0 = #10#0;
               #101#1 = #10#1;
               |LEE 020#101=;
               |CIERRA #101;
               |ABRE #105;
               #105#0 = #101#11;
               |LEE 000#105=;
               |SI FSalida = 0;
                    aEsCentral = "S";   || Tiquet 3774/158
               |FINSI;
               |CIERRA #105;

               |SI #7#96 = "M"; |Y aEsCentral = "N";
                    |HAZ EligeAlmacen;

                    eaReceAlmaObra = "N";
                    |ABRE #101;
                    #101#0 = #10#0;
                    #101#1 = #10#1;
                    |LEE 020#101=;
                    |SI FSalida = 0; |Y enAlmaAdjCon = #101#11;
                         eaReceAlmaObra = "S";
                    |FINSI;
                    |CIERRA #101;
               |FINSI;

               neSObras = 3;
               |GRABA 020#1a;
               |GRABA 020#10a;
               |CIERRAT #1;
               |CIERRAT #10;

               |PTEC 802;|PTEC 810;
               |SUB_EJECUTA_NP "goalbpa1;MATERIAL"

               |ABRET #1;
               |ABRET #10;
               |LEE 121#1=;
               |LEE 121#10=;
          |FINSI;

          |SI nNumerAlba = 0;
               |ERROR; |ACABA;
          |FINSI;

     |FINSI;

     aAlfa = #0#7; |QBF aAlfa;
     |SI nModo = 2;
          |ABRE #104;
          #104#0 = #0#5;
          #104#1 = #0#6;
          |LEE 000#104=;
          |SI FSalida = 0; |Y aAlfa = "";
               |MENAV "0000Para Modificar Utilizar Mant.Adecuado";
               |CIERRA #104;
               |ERROR;
               |ACABA;
          |SINO;
               cSerieExpe = #1#0;                      ||Serie Expe.
               nNumerExpe = #1#1;                      ||Nume. Expe.
               cSeriePres = #1#3;                      ||Serie Pres.
               nNumerPres = #1#4;                      ||Nume. Pres.
               cSerieAlba = #0#5;                      ||Serie Alba.
               nNumerAlba = #0#6;                      ||Nume. Alba.

               nTotComTra = #0#9;                      ||I.Comp.Tra.
               nTotComBas = #0#10;                     ||I.Comp.Bas.
               nTotVenTra = #0#11;                     ||I.Vent.Tra.
               nTotVenBas = #0#12;                     ||I.Vent.Bas.
               fFechaAlba = #0#3;                      ||Fecha Alba.
               cSuAlbaran = #0#4;                      ||Su Albaran.
               cProveAlba = #0#7;                      ||Fecha Alba.
               cNombrAlba = #0#8;                      ||Nombre Pro.

               nErrorSal  = 1;
               |GRABA 020#1a;
               |GRABA 020#10a;
               |CIERRAT #1;
               |CIERRAT #10;
               |PTEC 802;|PTEC 802;|PTEC 811;
               |SUB_EJECUTA_NP "goalbpa1;MATERIAL"
               |ABRET #1;
               |ABRET #10;
               |LEE 121#10=;
               |LEE 121#1=;
               |SI nErrorSal = 1;
                    |ERROR;
                    |ACABA;
               |FINSI;
               nTotComTra = 0;
               nTotVenTra = 0;
               nTotComBas = 0;
               nTotVenBas = 0;
               |BUCLE TotalGopartia;
          |FINSI;
          |LIBERA #104;
          |CIERRA #104;
     |FINSI;

     #0#0  = #1#3;                                ||Serie Pres.
     #0#1  = #1#4;                                ||Nume. Pres.
     #0#3  = fFechaAlba;                          ||Fecha Alba.
     #0#4  = cSuAlbaran;                          ||Su Albaran.
     #0#5  = cSerieAlba;                          ||Serie Alba.
     #0#6  = nNumerAlba;                          ||Nume. Alba.
     #0#7  = cProveAlba;                          ||Proveedor .
     #0#8  = cNombrAlba;                          ||N. Provedo.
     #0#9  = nTotComTra;                          ||I.Comp.Tra.
     #0#10 = nTotComBas;                          ||I.Comp.Bas.
     #0#11 = nTotVenTra;                          ||I.Vent.Tra.
     #0#12 = nTotVenBas;                          ||I.Vent.Bas.
     #0#14 = #1#0;                                ||Serie Expe.
     #0#15 = #1#1;                                ||Nume. Expe.

|FPRC;
-----------------------------------------------------------------------------
|PROCESO MirSer; |TIPO 0;
     |ABRE #7;
     #7#0 = "A";
     |LEE 000#7=;

     |SI FSalida ! 0;
          |MENAV "0000NO HAY UNA SERIE DEFINIDA EN PARAMETROS";
          |PTEC 807;
     |SINO;
          |ABRE #8;
          #8#2 = #7#1;                            ||Serie.
          #8#0 = "valbaco";
          |LEE 000#8=;

          |SI FSalida = 0;
               #8#1 = #8#1 + 1;
               |GRABA 020#8a;
          |SINO;
               #8#1 = 1;
               |GRABA 020#8c;

          |FINSI;

     |FINSI;

|FPRC;
-----------------------------------------------------------------------------
|PROCESO Conformidad;
     |ABRE #7;
     #7#0 = "A";
     |LEE 000#7=;

     |SI FSalida = 0;
          |SI #7#19 = "N";
               |CIERRA #7;
               |ACABA;
          |FINSI;
     |FINSI;

     cUsu = Usuario % 810;
     FSalida = 1;

     |PARA; |SI FSalida ! 0; |HACIENDO;

          |SI #7#20 = "S"
               |CONFI "0000NDESEA IMPRIMIR EL VISADO DEL DOCUMENTO";

               |SI FSalida = -1;
                    |CIERRA #7;
                    |ACABA;
               |FINSI;

          |FINSI;

          |MENAV "0000INTRODUZCA EL DOCUMENTO EN LA IMPRESORA";
          |IMPRE 0;

     |SI FSalida ! 0;
          |SIGUE;
     |FINSI;

     |FINIMP;
     |CIERRA #7;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO MinRef;
     #referen@#0 = #0#0;
     #referen@#1 = #0#1;
     #referen@#2 = 1;
|FPRC;

|PROCESO MaxRef;
     #referen@#0 = #0#0;
     #referen@#1 = #0#1;
     #referen@#2 = 999;
|FPRC;

|PROCESO ConsultaAlb; |TIPO 11;
     |SI FSalida ! 13; |ACABA; |FINSI;
     |DDEF aAlfa;
     aAlfa = aAlfa + "gomatljn";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          #referen@#0 = #0#0;
          #referen@#1 = #0#1;
          #referen@#2 = #0#2;
          |LEE 000#referen@.];
          |CONSULTA_F_CLAVE #1#referen@, MinRef, MaxRef;
          |SI FSalida = 0;
               #0#2 = #referen@#2;
          |SINO;
               |ERROR;
          |FINSI;
          |CIERRA #referen@;
     |FINSI;
|FPRC;

|PROCESO goparam5;
     #100#0 = #105#0;
     |LEE 000#100=;
     |SI FSalida = 0;
          |SALVA_DATOS #100;
          |REPON_DATOS #referen@;
          |GRABA 020#referen@.n;
     |FINSI;
|FPRC;

|DEFBUCLE goparam5;
     #105#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, goparam5;
|FIN;

|PROCESO CargaAlmaCentral;
     |ABRE #100;
     |BUCLE goparam5; ||carga almacenes centrales
     |ABRE #101;
     #101#0 = #10#0;
     #101#1 = #10#1;
     |LEE 020#101=;
     |SI FSalida = 0;
          #100#0 = #101#11;
          |LEE 020#100=;  || y el almacen del expediente
          |SI FSalida = 0;
               |SALVA_DATOS #100;
               |REPON_DATOS #referen@;
               |GRABA 040#referen@.n;
          |FINSI;
     |FINSI;
     |CIERRA #101;
     |CIERRA #100;
|FPRC;

|PROCESO EligeAlmacen;
     |ABRE #101;
     #101#0 = #10#0;
     #101#1 = #10#1;
     |LEE 020#101=;
     |CIERRA #101;
     enAlmaAdjCon = #101#11;
     enAlmaAdjCon0 = 0;

     |CONFI "0000SSELECCIONAR ALMACEN CENTRAL DE RECEPCION";
     |SI FSalida ! 0;
          aAlfa = "0000LA RECEPCION SE REALIZARA EN EL ALMACEN DE LA OBRA:" + #101#11;
          |MENAV aAlfa;
     |SINO;
          |DDEF aAlfa;
          aAlfa = aAlfa + "agifa029";
          |CARGA_DEF aAlfa, referen@;
          |SI FSalida = 0;
               |HAZ CreaTempo;
               |NOME_DAT #referen@#Tempo#;
               |DELINDEX #referen@;
               |ABRE #referen@;
               |HAZ CargaAlmaCentral;
               |LEE 000#referen@.p;
               |CONSULTA_CLAVE #1#referen@;
               |SI FSalida = 0;
                    enAlmaAdjCon = #referen@#0;
                    |SI #7#105 = "S";
                         |ABRE #105;
                         #105#0 = enAlmaAdjCon;
                         |LEE 000#105=;
                         |SI FSalida = 0;
                              enAlmaAdjCon0 = #105#2;
                         |FINSI;
                         |CIERRA #105;
                    |FINSI;
               |SINO;
                    aAlfa = "0000LA RECEPCION SE REALIZARA EN EL ALMACEN DE LA OBRA:" + #101#11;
                    |MENAV aAlfa;
               |FINSI;
               |CIERRA #referen@;
               |DELINDEX #referen@;
               |HAZ BoraTempo;
               |DESCARGA_DEF #referen@;
          |SINO;
               |MENAV "0000Error al cargar 'agifa017'";
          |FINSI;
     |FINSI;
|FPRC;
