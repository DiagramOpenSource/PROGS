|FICHEROS;
     dsz00004 #0;
     agifa019 #19;
     dsm00004 #904;
     agifa321;
     agifa324;
     agifa142 #142;
|FIN;

|VARIABLES;
     aAlfa = "";
     &EURODB = 0;
     &eaArticulo = "";
     &enAlta = 0;
     &nDeci_PreDiv  = 0;
     &nDeci_Base    = 0;
     &nDeci_PreBase = 0;
     nNume = 0;
     nEntero   = 0;
     nCampo    = 0;
     nResto    = 0;
     nTarifa1  = 0;
     nTarifa2  = 0;
     nTarifa3  = 0;
     nTarifa4  = 0;
     nTarifa5  = 0;
     nTarifa6  = 0;
     nTarifaC1 = 0;
     nTarifaC2 = 0;
     nTarifaC3 = 0;
     nTarifaC4 = 0;
     nTarifaC5 = 0;
     nTarifaC6 = 0;
|FIN;

|PROCESO DefeRedon; |TIPO 7;
     aAlfa = "0" * EURODB;
     aAlfa = "1" + aAlfa;
     nNume = aAlfa;
     #0#11 = 1 / nNume;
     |PINTA #0#11;
|FPRC;

|PROCESO Calculo;
     nCampo = Campo - 15;
     |C_M #0nCampo, 1, "S";
     |SI #0Campo = "N";
         |C_M #0nCampo, 1, "N";
         #0nCampo = 0;  |PINTA #0nCampo;
     |FINSI;
|FPRC;

|PROCESO Tarifa;
     |SI #0#12 = 1;
         |PINTA 1809, "2";  |PINTA 1829, "3";
         |PINTA 1909, "4";  |PINTA 1929, "5";
         |PINTA 2009, "6";

         nTarifa1  = 18;   nTarifa2  = 19;   nTarifa3  = 20;
         nTarifa4  = 147;  nTarifa5  = 148;  nTarifa6  = 149;

         nTarifaC1 = 14;   nTarifaC2 = 15;   nTarifaC3 = 16;
         nTarifaC4 = 17;   nTarifaC5 = 18;   nTarifaC6 = 19;
     |FINSI;

     |SI #0#12 = 2;
         |PINTA 1809, "1";  |PINTA 1829, "3";
         |PINTA 1909, "4";  |PINTA 1929, "5";
         |PINTA 2009, "6";

         nTarifa1  = 19;   nTarifa2  = 18;   nTarifa3  = 20;
         nTarifa4  = 147;  nTarifa5  = 148;  nTarifa6  = 149;

         nTarifaC1 = 15;   nTarifaC2 = 14;   nTarifaC3 = 16;
         nTarifaC4 = 17;   nTarifaC5 = 18;   nTarifaC6 = 19;
     |FINSI;

     |SI #0#12 = 3;
         |PINTA 1809, "1";  |PINTA 1829, "2";
         |PINTA 1909, "4";  |PINTA 1929, "5";
         |PINTA 2009, "6";

         nTarifa1  = 20;   nTarifa2  = 18;   nTarifa3  = 19;
         nTarifa4  = 147;  nTarifa5  = 148;  nTarifa6  = 149;

         nTarifaC1 = 16;   nTarifaC2 = 14;   nTarifaC3 = 15;
         nTarifaC4 = 17;   nTarifaC5 = 18;   nTarifaC6 = 19;
     |FINSI;

     |SI #0#12 = 4;
         |PINTA 1809, "1";  |PINTA 1829, "2";
         |PINTA 1909, "3";  |PINTA 1929, "5";
         |PINTA 2009, "6";

         nTarifa1  = 147;  nTarifa2  = 18;   nTarifa3  = 19;
         nTarifa4  = 20;   nTarifa5  = 148;  nTarifa6  = 149;

         nTarifaC1 = 17;   nTarifaC2 = 14;   nTarifaC3 = 15;
         nTarifaC4 = 16;   nTarifaC5 = 18;   nTarifaC6 = 19;
     |FINSI;

     |SI #0#12 = 5;
         |PINTA 1809, "1";  |PINTA 1829, "2";
         |PINTA 1909, "3";  |PINTA 1929, "4";
         |PINTA 2009, "6";

         nTarifa1  = 148;  nTarifa2  = 18;   nTarifa3  = 19;
         nTarifa4  = 20;   nTarifa5  = 147;  nTarifa6  = 149;

         nTarifaC1 = 18;   nTarifaC2 = 14;   nTarifaC3 = 15;
         nTarifaC4 = 16;   nTarifaC5 = 17;   nTarifaC6 = 19;
     |FINSI;

     |SI #0#12 = 6;
         |PINTA 1809, "1";  |PINTA 1829, "2";
         |PINTA 1909, "3";  |PINTA 1929, "4";
         |PINTA 2009, "5";

         nTarifa1  = 149;  nTarifa2  = 18;   nTarifa3  = 19;
         nTarifa4  = 20;   nTarifa5  = 147;  nTarifa6  = 148;

         nTarifaC1 = 19;   nTarifaC2 = 14;   nTarifaC3 = 15;
         nTarifaC4 = 16;   nTarifaC5 = 17;   nTarifaC6 = 18;
     |FINSI;
     |SI #0#12 ! 1;
          |C_M #0#21, 1, "N";
          |C_M #0#22, 1, "N";
          |C_M #0#23, 1, "N";
          |C_M #0#24, 1, "N";
          |C_M #0#25, 1, "N";
          |C_M #0#6, 1, "N";
          |C_M #0#7, 1, "N";
          |C_M #0#8, 1, "N";
          |C_M #0#9, 1, "N";
          |C_M #0#10, 1, "N";
     |SINO;
          |C_M #0#21, 1, "S";
          |C_M #0#22, 1, "S";
          |C_M #0#23, 1, "S";
          |C_M #0#24, 1, "S";
          |C_M #0#25, 1, "S";
          |C_M #0#6, 1, "S";
          |C_M #0#7, 1, "S";
          |C_M #0#8, 1, "S";
          |C_M #0#9, 1, "S";
          |C_M #0#10, 1, "S";
     |FINSI;
|FPRC;

|PROCESO CalculoPVPC;
     |SI #0#2 = "B";
         #904nTarifaC1 = #904nTarifaC1 + ((#0#3 * #904nTarifaC1) / 100);
         nResto = (#0#4 + #0#5) / 100;
     |SINO;
         nResto = (#0#3 + #0#4 + #0#5) / 100;
     |FINSI;

     nResto = 1 - nResto;
     #904nTarifaC1 = #904nTarifaC1 / nResto;
     |SI #0#11 ! 0;
          #904nTarifaC1 = #904nTarifaC1 / #0#11;
          #0#26 = #904nTarifaC1;
          |SI #0#26 > #904nTarifaC1;
               #0#26 = #0#26 - 1;
          |FINSI;
          |SI #0#27 = 1;
               #0#26 = #0#26 + 1;
          |FINSI;
          #904nTarifaC1 = #0#26 * #0#11;
     |SINO;
          #904nTarifaC1 = #904nTarifaC1 ! 0;
     |FINSI;

     |SI #0#21 = "S"
          |SI #0#6 ! 0;
               #904nTarifaC2 = #904nTarifaC1 > #0#6;
               |SI #0#11 ! 0;
                    #0#26         = #904nTarifaC2 / #0#11;
                    nEntero       = #904nTarifaC2 / #0#11;
                    |SI #0#26 > nEntero;
                         #0#26 = #0#26 - 1;
                    |FINSI;
                    |SI #0#27 = 1;
                         #0#26 = #0#26 + 1 ;
                    |FINSI;
                    #904nTarifaC2 = #0#26 * #0#11;
               |SINO;
                    #904nTarifaC2 = #904nTarifaC2 ! 0;
               |FINSI;
          |SINO;
               #904nTarifaC2 = #904nTarifaC1;
          |FINSI;
     |FINSI;

     |SI #0#22 = "S"
          |SI #0#7 ! 0;
               #904nTarifaC3 = #904nTarifaC1 > #0#7;
               |SI #0#11 ! 0;
                    #0#26         = #904nTarifaC3 / #0#11;
                    nEntero       = #904nTarifaC3 / #0#11;
                    |SI #0#26 > nEntero;
                         #0#26 = #0#26 - 1;
                    |FINSI;
                    |SI #0#27 = 1;
                         #0#26 = #0#26 + 1 ;
                    |FINSI;
                    #904nTarifaC3 = #0#26 * #0#11;
               |SINO;
                    #904nTarifaC3 = #904nTarifaC3 ! 0;
               |FINSI;
          |SINO;
               #904nTarifaC3 = #904nTarifaC1;
          |FINSI;
     |FINSI;

     |SI #0#23 = "S"
          |SI #0#8 ! 0;
               #904nTarifaC4 = #904nTarifaC1 > #0#8;
               |SI #0#11 ! 0;
                    #0#26         = #904nTarifaC4 / #0#11;
                    nEntero       = #904nTarifaC4 / #0#11;
                    |SI #0#26 > nEntero;
                         #0#26 = #0#26 - 1;
                    |FINSI;
                    |SI #0#27 = 1;
                        #0#26 = #0#26 + 1 ;
                    |FINSI;
                    #904nTarifaC4 = #0#26 * #0#11;
               |SINO;
                    #904nTarifaC4 = #904nTarifaC4 ! 0;
               |FINSI;
          |SINO;
               #904nTarifaC4 = #904nTarifaC1;
          |FINSI;
     |FINSI;

     |SI #0#24 = "S"
          |SI #0#9 ! 0;
               #904nTarifaC5 = #904nTarifaC1 > #0#9;
               |SI #0#11 ! 0;
                    #0#26         = #904nTarifaC5 / #0#11;
                    nEntero       = #904nTarifaC5 / #0#11;
                    |SI #0#26 > nEntero;
                         #0#26 = #0#26 - 1;
                    |FINSI;
                    |SI #0#27 = 1;
                         #0#26 = #0#26 + 1 ;
                    |FINSI;
                    #904nTarifaC5 = #0#26 * #0#11;
               |SINO;
                    #904nTarifaC5 = #904nTarifaC5 ! 0;
               |FINSI;
          |SINO;
               #904nTarifaC5 = #904nTarifaC1;
          |FINSI;
     |FINSI;

     |SI #0#25 = "S"
          |SI #0#10 ! 0;
               #904nTarifaC6 = #904nTarifaC1 > #0#10;
               |SI #0#11 ! 0;
                    #0#26         = #904nTarifaC6 / #0#11;
                    nEntero       = #904nTarifaC6 / #0#11;
                    |SI #0#26 > nEntero;
                         #0#26 = #0#26 - 1;
                    |FINSI;
                    |SI #0#27 = 1;
                         #0#26 = #0#26 + 1 ;
                    |FINSI;
                    #904nTarifaC6 = #0#26 * #0#11;
               |SINO;
                    #904nTarifaC6 = #904nTarifaC6 ! 0;
               |FINSI;
          |SINO;
               #904nTarifaC6 = #904nTarifaC1;
          |FINSI;
     |FINSI;

     |GRABA 020#904a;
     |LIBERA #904;
|FPRC;

|DEFBUCLE dsm00004;
     #904#1;
     ;
     #19#0, 00001, "      ";
     #19#0, 99999, "zzzzzz";
     ;
     NULL, CalculoPVPC;
|FIN;

|PROCESO CalcuPVP;
     |SI #0#2 = "B";
         #19nTarifa1 = #19nTarifa1 + ((#0#3 * #19nTarifa1) / 100 );
         nResto = (#0#4 + #0#5) / 100;
     |SINO;
         nResto = (#0#3 + #0#4 + #0#5) / 100;
     |FINSI;

     nResto = 1 - nResto;
     #19nTarifa1 = #19nTarifa1 / nResto;
     |SI #0#11 ! 0;
          #19nTarifa1 = #19nTarifa1 / #0#11;
          #0#26 = #19nTarifa1;
          |SI #0#26 > #19nTarifa1;
               #0#26 = #0#26 - 1;
          |FINSI;
          |SI #0#27 = 1;
               #0#26 = #0#26 + 1 ;
          |FINSI;
          #19nTarifa1 = #0#26 * #0#11;
     |FINSI;

     |SI #0#21 = "S"
          |SI #0#6 ! 0;
               #19nTarifa2 = #19nTarifa1 > #0#6;
               |SI #0#11 ! 0;
                    #0#26       = #19nTarifa2 / #0#11;
                    nEntero     = #19nTarifa2 / #0#11;
                    |SI #0#26 > nEntero;
                         #0#26 = #0#26 - 1;
                    |FINSI;
                    |SI #0#27 = 1;
                         #0#26 = #0#26 + 1 ;
                    |FINSI;
                    #19nTarifa2 = #0#26 * #0#11;
               |FINSI;
          |SINO;
               #19nTarifa2 = #19nTarifa1;
          |FINSI;
     |FINSI;

     |SI #0#22 = "S"
          |SI #0#7 ! 0;
               #19nTarifa3 = #19nTarifa1 > #0#7;
               |SI #0#11 ! 0;
                    #0#26       = #19nTarifa3 / #0#11;
                    nEntero     = #19nTarifa3 / #0#11;
                    |SI #0#26 > nEntero;
                         #0#26 = #0#26 - 1;
                    |FINSI;
                    |SI #0#27 = 1;
                         #0#26 = #0#26 + 1 ;
                    |FINSI;
                    #19nTarifa3 = #0#26 * #0#11;
               |FINSI;
          |SINO;
               #19nTarifa3 = #19nTarifa1;
          |FINSI;
     |FINSI;

     |SI #0#23 = "S"
          |SI #0#8 ! 0;
               #19nTarifa4 = #19nTarifa1 > #0#8;
               |SI #0#11 ! 0;
                    #0#26       = #19nTarifa4 / #0#11;
                    nEntero     = #19nTarifa4 / #0#11;
                    |SI #0#26 > nEntero;
                         #0#26 = #0#26 - 1;
                    |FINSI;
                    |SI #0#27 = 1;
                         #0#26 = #0#26 + 1 ;
                    |FINSI;
                    #19nTarifa4 = #0#26 * #0#11;
               |FINSI;
          |SINO;
               #19nTarifa4 = #19nTarifa1;
          |FINSI;
     |FINSI;

     |SI #0#24 = "S"
          |SI #0#9 ! 0;
               #19nTarifa5 = #19nTarifa1 > #0#9;
               |SI #0#11 ! 0;
                    #0#26       = #19nTarifa5 / #0#11;
                    nEntero     = #19nTarifa5 / #0#11;
                    |SI #0#26 > nEntero;
                         #0#26 = #0#26 - 1;
                    |FINSI;
                    |SI #0#27 = 1;
                         #0#26 = #0#26 + 1 ;
                    |FINSI;
                    #19nTarifa5 = #0#26 * #0#11;
               |FINSI;
          |SINO;
               #19nTarifa5 = #19nTarifa1;
          |FINSI;
     |FINSI;

     |SI #0#25 = "S"
          |SI #0#10 ! 0;
               #19nTarifa6 = #19nTarifa1 > #0#10;
               |SI #0#11 ! 0;
                    #0#26       = #19nTarifa6 / #0#11;
                    nEntero     = #19nTarifa6 / #0#11;
                    |SI #0#26 > nEntero;
                         #0#26 = #0#26 - 1;
                    |FINSI;
                    |SI #0#27 = 1;
                         #0#26 = #0#26 + 1 ;
                    |FINSI;
                    #19nTarifa6 = #0#26 * #0#11;
               |FINSI;
          |SINO;
               #19nTarifa6 = #19nTarifa1;
          |FINSI;
     |FINSI;
     #19#123 = "S";
     |GRABA 020#19a;
     |LIBERA #19;

     |BUCLE dsm00004;
|FPRC;

|DEFBUCLE agifa019;
     #19#1;
     125, 2, 3, 27;
     #0#0, #0#17, #0#13, #0#15, #0#19;
     #0#1, #0#18, #0#14, #0#16, #0#20;
     be;
     NULL, CalcuPVP;
|FIN;

|PROCESO Divisa;
     |ABRE #agifa321;
     |ABRE #agifa324;
     #agifa324#0 = #agifa019#165;
     |LEE 001#agifa324.=;
     nDeci_PreDiv = #agifa324#9;
     |LEE 001#agifa321.p;
     #agifa324#0 = #agifa321#9; ||Igualo a moneda base
     |LEE 001#agifa324.=;
     nDeci_Base = #agifa324#7;  ||Decimales moneda base
     nDeci_PreBase = #agifa324#9;  ||Decimales precio de moneda base
     |CIERRA #agifa321;
     |CIERRA #agifa324;
|FPRC;

|PROCESO Tipo3;  |TIPO 3;
     |HAZ Divisa;
     |HAZ Tarifa;
     |BUCLE agifa019;
|FPRC;

|PROCESO Llena004; |TIPO 6;
     eaArticulo = #0Campo;
     |HAZ LlenaArticulo;
     |SI FSalida = 0;
          #0Campo = eaArticulo;
          |PINTA #0Campo;
     |SINO;
          |ERROR; |ACABA;
     |FINSI;
|FPRC;

|PROGRAMA;
     |ABRE #142; |LEE 000#142p; |CIERRA #142;
     |HAZ EsTecatel;
     |SI FSalida = 0; |Y #142#9 = "S";
          |CORRE "tecaz026";
     |FINSI;
     |HAZ EsAparecida;
     |SI FSalida = 0;
          |CORRE "aparm013";
     |FINSI;
     |MANTE #0;
|FPRO;
