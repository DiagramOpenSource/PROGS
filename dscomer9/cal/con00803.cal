|FICHEROS;
     con00803 #0;
     con00626 #626;
     con00650 #650;
     con00657 #657;
     con00659 #659;
     con00661 #661;
     con00670 #670;
     con00673 #673;
     con00674 #674;
     con00676 #676;
     refe676@ #76;
|FIN;

|VARIABLES;
     aSer = "";
     nOrd = "";
     nTotaCos = 0;
     nTotaVen = 0;
     aDef = "";
     aAlfa = "";
     aMatri = "";
     fFecha = @;
     aBastidor = "";
     {100}M = "";
     {100}F = @;
     {100}L = 0;
     nNivel = 0;
     nLin = 0;
|FIN;

|PROCESO Defecto; |TIPO 7;
     |SI #0#4 = " ";
          aAlfa = PARAMETRO;
          |SI aAlfa = "U"; |O aAlfa = "N";
               #0#4 = aAlfa;
          |SINO;
               #0#4 = "N";
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Modi; |TIPO 0;
     |C_M #0#0, 1, "S";
     |C_M #0#1, 1, "S";
     |SI #0#4 = "U";
          |C_M #0#0, 1, "N";
          |C_M #0#1, 1, "N";
     |FINSI;
|FPRC;
----------------------------------------------------------
|PROCESO TotaOrden;
     nTotaCos = nTotaCos + #626#8;
|FPRC;

|DEFBUCLE TotaOrden;
     #626#1;
     ;
     aSer, nOrd, 0001;
     aSer, nOrd, 9999;
     ;
     NULL, TotaOrden;
|FIN;
----------------------------------------------------------
|PROCESO con00676;
     nTotaCos = nTotaCos + #676#5;
|FPRC;

|DEFBUCLE con00676;
     #676#1;
     ;
     aMatri, fFecha, 001;
     aMatri, fFecha, 999;
     ;
     NULL, con00676;
|FIN;

|PROCESO con00674;
     |SI #674#4 = 0;
          aSer = #674#2;
          nOrd = #674#3;
          |BUCLE TotaOrden;
     |SINO;
          nTotaCos = nTotaCos + #674#4;
     |FINSI;
|FPRC;

|DEFBUCLE con00674;
     #674#1;
     ;
     aMatri, fFecha, 001;
     aMatri, fFecha, 999;
     ;
     NULL, con00674;
|FIN;

|PROCESO con00673;
     nTotaCos = nTotaCos + #673#5;
     nTotaVen = nTotaVen + #673#4;
|FPRC;

|DEFBUCLE con00673;
     #673#1;
     ;
     aMatri, fFecha, 001;
     aMatri, fFecha, 999;
     ;
     NULL, con00673;
|FIN;

|PROCESO con00659;
     |SI #659#4 = 0;       || Si es 0
          aSer = #659#2;
          nOrd = #659#3;
          |BUCLE TotaOrden; || recalcula
     |SINO;
          nTotaCos = nTotaCos + #659#4;
     |FINSI;
|FPRC;

|DEFBUCLE con00659;
     #659#1;
     ;
     aBastidor, 001;
     aBastidor, 999;
     ;
     NULL, con00659;
|FIN;

|PROCESO con00661;
     nTotaCos = nTotaCos + #661#5;
|FPRC;

|DEFBUCLE con00661;
     #661#1;
     ;
     aBastidor, 001;
     aBastidor, 999;
     ;
     NULL, con00661;
|FIN;

|PROCESO con00657;
     nTotaCos = nTotaCos + #657#5;
     nTotaVen = nTotaVen + #657#4;
|FPRC;

|DEFBUCLE con00657;
     #657#1;
     ;
     aBastidor, 001;
     aBastidor, 999;
     ;
     NULL, con00657;
|FIN;

||** Modificacion por el tiquet 002795-00194
||** lee con mayor/igual
     #670#22 = "01.01.000";
     |LEE 000#670];
     |SI FSalida = 0; |Y #670#0 = aMatri;
|PROCESO PrinLinNuevoUsa;
     #670#0 = aMatri;
     #670#22 = fFecha;
     |LEE 000#670=;
     |SI FSalida = 0;
          #0#6 = "U"; ||Tipo
          #0#7 = #670#0; ||Matri
          #0#8 = #670#2; ||||Modelo
          #0#9 = #670#11; ||Clie
          #0#10 = #670#39;  ||Fecha

          aMatri = #670#0;
          fFecha = #670#22;
          nTotaCos = 0;
          nTotaVen = 0;
          |BUCLE con00673; ||Economico
          |BUCLE con00676; ||VO Exceso
          #0#11 = nTotaCos;
          nTotaCos = 0;
          |BUCLE con00674; ||Ordenes
          #0#14 = nTotaCos;
          #0#12 = nTotaVen;
          #0#13 = #0#12 - #0#14 - #0#11;
          |PRINT;
     |FINSI;
|FPRC;

|PROCESO LinNuevoUsa;
     |ABRE #76;
     IM = M1<-;
     IF = F1<-;
     IL = L1<-;
     nLin = 1;
     nNivel = 0;
  |ET Otro;
     #76#0 = aMatri;
     #76#7 = fFecha;
     #76#1 = nLin;
     |LEE 000#76];
     |SI FSalida = 0; |Y #76#0 = aMatri; |Y #76#7 = fFecha;
          M = #76#0;
          F = #76#7;
          L = #76#1;
          IM = IM + 1;
          IF = IF + 1;
          IL = IL + 1;
          nNivel = nNivel + 1;
          nLin = 1;
          aMatri = #76#2;
          fFecha = #76#6;
          |HAZ PrinLinNuevoUsa;
          |VETE Otro;
     |SINO;
          |SI nNivel > 0;
               nNivel = nNivel - 1;
               IM = IM - 1;
               IF = IF - 1;
               IL = IL - 1;
               aMatri = M;
               fFecha = F;
               nLin = L + 1;
               |VETE Otro;
          |FINSI;
     |FINSI;
     |CIERRA #76;
|FPRC;

|PROCESO EntregaUsado;
     |ABRE #670;
     #670#0 = #661#2;
     #670#22 = #661#6;
     |LEE 000#670=;
     |SI FSalida = 0;
          #0#6 = "U"; ||Tipo
          #0#7 = #670#0; ||Matri
          #0#8 = #670#2; ||||Modelo
          #0#9 = #670#11; ||Clie
          #0#10 = #670#39;  ||Fecha
          aMatri = #670#0;
          fFecha = #670#22;
          nTotaCos = 0;
          nTotaVen = 0;
          |BUCLE con00673; ||Economico
          |BUCLE con00676; ||VO Exceso
          #0#11 = nTotaCos;
          nTotaCos = 0;
          |BUCLE con00674; ||Ordenes
          #0#14 = nTotaCos;
          #0#12 = nTotaVen;
          #0#13 = #0#12 - #0#14 - #0#11;
          |PRINT;

          |HAZ LinNuevoUsa;
     |FINSI;

     |CIERRA #670;
|FPRC;

|DEFBUCLE EntregaUsado;
     #661#1;
     ;
     #650#0, 001;
     #650#0, 999;
     ;
     NULL, EntregaUsado;
|FIN;

|PROCESO Nuevos;
     #0#6 = "N";     ||Tipo
     #0#7 = #650#29; ||Matri
     #0#8 = #650#2;  ||Modelo
     #0#9 = "";      ||Cliente
     #0#10 = "01.01.0000";  ||Fecha
     aBastidor = #650#0;
     nTotaCos = 0;
     nTotaVen = 0;
     |BUCLE con00657; ||Economico
     |BUCLE con00661; ||VO Exceso
     #0#11 = nTotaCos;   ||Total Coste Economico
     nTotaCos = 0;
     |BUCLE con00659; ||Ordenes
     #0#14 = nTotaCos; ||Total Coste Orden;
     #0#12 = nTotaVen;
     #0#13 = #0#12 - #0#14 - #0#11;
     |PRINT;
     |BUCLE EntregaUsado;
     |PIEINF;
|FPRC;

|DEFBUCLE Nuevos;
     #650#1;
     29;
     #0#0, #0#2;
     #0#1, #0#3;
     ;
     NULL, Nuevos;
|FIN;
----------------------------------------------------------
|PROCESO Usados;
     #0#6 = "U"; ||Tipo
     #0#7 = #670#0; ||Matri
     #0#8 = #670#2; ||||Modelo
     #0#9 = #670#011; ||Clie
     #0#10 = #670#39;  ||Fecha
     aMatri = #670#0;
     fFecha = #670#22;
     nTotaCos = 0;
     nTotaVen = 0;
     |BUCLE con00673;
     |BUCLE con00676;
     #0#11 = nTotaCos; ||Total Coste
     nTotaCos = 0;
     |BUCLE con00674;
     #0#14 = nTotaCos; ||Total Coste

     #0#12 = nTotaVen; ||Total Venta
     #0#13 = #0#12 - #0#14 - #0#11; ||Beneficio

     |PRINT;

     |SALVA_FICHA #670;

     |HAZ LinNuevoUsa;
     |PIEINF;

     |REPON_FICHA #670;
|FPRC;

|DEFBUCLE Usados;
     #670#1;
     ;
     #0#2, "01.01.0000";
     #0#3, "31.12.9999";
     ;
     NULL, Usados;
|FIN;
----------------------------------------------------------
|PROCESO Tipo3; |TIPO 3;
     |IMPRE 0;
     |SI FSalida = 0;
          |INFOR "con00803";
          |SI FSalida ! 0;
               |MENAV "0000No existe informe 'con00803'";
          |SINO;
               |DDEF aDef;
               aAlfa = aDef + "con00676"; |CARGA_DEF aAlfa, refe676@;
               |SI #0#4 = "N";
                    |BUCLE Nuevos;
               |SINO;
                    |BUCLE Usados;
               |FINSI;
               |DESCARGA_DEF #refe676@;
               |FININF;
          |FINSI;
          |FINIMP;
     |FINSI;
|FPRC;
