|FICHEROS;
     mecaz015 #0;
     agifa019 #2;
     agifa017 #8;
     mecam011 #11;
     mecam016 #16;
     mecam017 #17;
     agifa065 #65;
|FIN;

|VARIABLES;
     nError = 0;
|FIN;

|PROCESO Historico;
     |DDEFECTO #65;
     #65#0 = #2#0;
     #65#1 = ~;
     #65#2 = "FB";
     #65#3 = #0#1;
     #65#4 = 1;
     #65#11 = #0#0;
     #65#9 = #2#9;
     #65#14 = #2#9;
     |GRABA 000#65b;
     |PARA; |SI FSalida ! 0; |HACIENDO;
          #65#4 = #65#4 + 1;
          |GRABA 000#65b;
     |SIGUE;
     #65#5 = 1;               ||Almacen FIJO a 1
     #65#6 = #17#3;
     #65#7 = #8#5;
     #65#8 = #2#9;
     #65#10 = "000000";
     #65#17 = #17#3 * #17#4;
     |GRABA 020#65a;
     |LIBERA #65;
|FPRC;

|PROCESO mecam017;
     |SI #17#6 = "N"; |O #17#7 = "S";
          |ACABA;
     |FINSI;

     #2#0 = #16#2;
     |LEE 101#2=;
     |SI FSalida = 0;
          #2#13 = #2#13 - #17#3;

          #2#104 = #2#104 + #17#3;
          #2#193 = #2#193 + (#17#3 * #17#4);

          #2#6 = #2#6 + #17#3;
          #2#185 = #2#185 + (#17#3 * #17#4);

          #8#0 = #17#2;
          #8#1 = 1;          || Almacen
          |LEE 101#8=;
          |SI FSalida = 0;
               #8#9 = #8#9 - #17#3;

               #8#5 = #8#5 + #17#3;
               #8#47 = #8#47 + (#17#3 * #17#4);

               #8#39 = #8#39 + #17#3;
               #8#48 = #8#48 + (#17#3 * #17#4);
               |HAZ ValoraStock;
               |GRABA 020#8a;
               |LIBERA #8;
          |SINO;
               |HAZ ValoraStock;
          |FINSI;
          |GRABA 020#2a;
          |LIBERA #2;

          |HAZ Historico;
     |FINSI;

     #17#7 = "S";
     |GRABA 020#17a;
     |LIBERA #17;
|FPRC;

|DEFBUCLE mecam016;
     #16#1;
     ;
     #0#0, #0#1;
     #0#0, #0#1;
     be;
     NULL, NULL, mecam017;
|FIN;

|PROCESO CheckActNece;
     |SI #17#6 = "N";
          nError = 1;
          |ERROR10;
     |FINSI;
|FPRC;

|DEFBUCLE CheckActNece;
     #16#1;
     ;
     #0#0, #0#1;
     #0#0, #0#1;
     be;
     NULL, NULL, CheckActNece;
|FIN;

|PROCESO CheckEntraMate;
     |SI #11#9 = "N";
          nError = 1;
          |ERROR10;
     |FINSI;
|FPRC;

|DEFBUCLE CheckEntraMate;
     #11#1;
     ;
     #0#0, #0#1, "                    ", "                    ", " ";
     #0#0, #0#1, "zzzzzzzzzzzzzzzzzzzz", "zzzzzzzzzzzzzzzzzzzz", "z";
     ;
     NULL, CheckEntraMate;
|FIN;

|PROCESO Tipo3; |TIPO 3;
     |||BUCLE CheckEntraMate;
     nError = 0;
     |SI nError = 1;
          |MENAV "0000NO se han rebajado en el stock las materias primas...";
     |SINO;
          |BUCLE CheckActNece;
          |SI nError = 1;
               |MENAV "0000NO se han actualizado las necesidades del exceso...";
          |SINO;
               |ABRE #2;
               |ABRE #8;
               |ABRE #65;
               |BUCLE mecam016;
               |CIERRA #65;
               |CIERRA #8;
               |CIERRA #2;
          |FINSI;
     |FINSI;
|FPRC;
