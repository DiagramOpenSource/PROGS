|FICHEROS;
     agifa326 #0;        ||Este def
     agifa325 #1;        ||Historico divisa
     agifa324 #2;        ||Fichero de Divisas
|FIN;

|VARIABLES;
     &Tempo = "";
     nLinea         = 0;
     nFechaDias     = 0;
     fFecha         = @;
|FIN;

|PROCESO GrabaDivisa;
     #agifa324#0 = #agifa326#1;
     |LEE 101#agifa324.=;
     |SI FSalida = 0;
          #agifa324#2 = #agifa326#3;         ||Valor Venta
          #agifa324#3 = #agifa326#4;         ||Valor compra
          #agifa324#4 = #agifa326#5;         ||Fecha Actualizacion
          |GRABA 021#agifa324.a;

          |DDEFECTO #agifa325;
          #agifa325#0 = nLinea;
          #agifa325#1 = #agifa324#0;
          #agifa325#2 = #agifa324#2;
          #agifa325#3 = #agifa324#3;
          #agifa325#4 = #agifa324#4;
          |GRABA 021#agifa325.n;
          nLinea = nLinea + 1;
     |FINSI;
     |LIBERA #agifa324;
|FPRC;

|DEFBUCLE LeeTmp;
     #agifa326#1;
     6;
        1 , "S";
     9999 , "S";
     e;
     NULL , GrabaDivisa;
|FIN;

|PROCESO Actualizar;
     |ABRE #agifa324;
     |ABRE #agifa325;

     |DDEFECTO #agifa325;
     |LEE 001#agifa325.u;
     nLinea = #agifa325#0 + 1;

     |BUCLE LeeTmp;
     |CIERRA #agifa324;
     |CIERRA #agifa325;
|FPRC;

|PROCESO GrabaTmp;
     nLinea = nLinea + 1;
     #agifa326#0 = nLinea;
     #agifa326#1 = #agifa324#0;         ||Codigo
     #agifa326#2 = #agifa324#1;         ||Desc
     #agifa326#3 = #agifa324#2;         ||Venta
     #agifa326#4 = #agifa324#3;         ||Compra
     #agifa326#5 = #agifa324#4;         ||Fecha Ult. Actualiz
     #agifa326#6 = "N";                 ||Actualizar
     |GRABA 021#agifa326.n;
|FPRC;

|DEFBUCLE LeeDivisa;
     #agifa324#1;
     ;
     "   ";
     "zzz";
     e;
     NULL , GrabaTmp;
|FIN;

|PROCESO sino; |TIPO 0;
     #agifa326#6 = #agifa326#6 > #agifa326#6;
     |PINTA #agifa326#6;
|FPRC;


|PROCESO Final;
     |CONFI "2400NSon correctos los valores entrados : ";
     |SI FSalida = 0;
          |ATRI P;
          |MENSA "0000Actualizando en Fichero Divisas";
          |ATRI p;
          |HAZ Actualizar;
     |FINSI;
|FPRC;

|PROCESO CambiaFecha; |TIPO 0;
     |SI FSalida = 9;
          fFecha = ~;
          #agifa326#5 = fFecha;
          |PINTA #agifa326#5;
     |FINSI;
|FPRC;

|PROCESO pro1;
     #agifa326#0 = 1;
|FPRC;

|PROCESO pro2;
     #agifa326#0 = nLinea;
|FPRC;

|PROGRAMA;
     |CLS;
     |CABEZA "Act.Divisas";
     |PINPA #0#0;
     |ATRI P;
     |MENSA "0000Buscando en Fichero Divisas";
     |ATRI p;

     |HAZ CreaTempo;
     |NOME_DAT #agifa326#Tempo#; |DELINDEX #agifa326;

     |ABRE #agifa326;
     |BUCLE LeeDivisa;
     |CIERRA #agifa326;

     |BLIN 4;
     |ENTLINEAL #1#0 , 1 , 2 , 20 , 1 , pro1 , pro2;
     |HAZ Final;

     |HAZ BoraTempo;
     |DELINDEX #agifa326;          ||Borrado del fichero de actualizaciones
|FPRO;
