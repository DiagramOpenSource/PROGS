|FICHEROS;
     gopaexca #0;
     gopaexli #1,MANTE;

     gopartca #2;
     gopartll #3;
     gopartli #4;
     goptrbli #5;
     gopartia #6;
     goptrbca #7;
     gopre001 #8;
     gomantho #9;

     gopartid #12;
     gocatcon #13;
     gopre004 #15;
     gomantl1 #16;       ||antes gomantli
     gomantli #17;
     gomantca #18;
     gocatcot #19,MANTE;
     gotrabat #20,MANTE;
     agifa027 #27;
     goalbpa7 #14;
     gopre002 #26;
     gopre003 #30;
     guerm053 #53;

     goparame #100;
     gotipoho #101;
     agifa722 #102;
     caenlac@ #1000;
     caconas@ #1001;
     camasic@ #1002;
     canempr@ #1003;
     gopre001@;
|FIN;

|VARIABLES;
     nError = 0;
     nSal = 0;
     aAntes = "";
     nSwCerrado = 0;
     &eaSerie = "";
     &enNumero = 0;
||     &efFecha = @;
     &enLinea = 0;

     &PRMNT_enVer   = 0;
     aSerPre = "";
     nNumPre = 0;
     aEstado = "";
     nModo = 0;
     aFecha = "";
     aMes = "";
     nMes = 0;
     nBusca = 0;
     &eaSerExp = "";
     &enNumExp = 0;
     aAlfa          = "";
     aDef           = "";
     nCampos        = 0;
     &efFecha       = @;
     &Tempo         = "";
     aTempo14       = "";
     i              = 0;
     nLin           = 0;
     aTempo1        = "";
     &cCodMonTrab   = "";
     &cCodMonDe     = "";
     &cCodMonA      = "";
     &nPrecioVent   = 0;
     &nPrecioComp   = 0;
     nMoneCat       = "";
     nMoneExp       = "";
     nConta         = 0;
     nForma         = 0;
     nLinea         = 0;
     nHay           = 0;
     nSigno         = 0;
     nBotTipos      = 0;
     nSalida        = 0;

     cConta         = "";
     cTipo          = "";
     nHP = 0; nHA = 0; nHE = 0;
     nBotF20        = 0;
     nBotF21        = 0;
     nBotF30        = 0;

     &eaSerPre      = "";
     &enNumPre      = 0;
     &eaCapi        = "";
     &eaParti       = "";
     &eaDesPa       = "";


     nDiario = 0;
     fFecha  = @;
     nDocum  = 0;
     nCalc   = 0;
     nSwError = 0;
     &enNoModif = 0;
     &fich_alta = "";
     aAlfa1   = "":
|FIN;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO CtrlFec; |TIPO 0;
     nSwCerrado = 0;
     |ABRE #53;
     aAlfa = #0#2 % 704; #53#0 = aAlfa;
     aAlfa = #0#2 % 402; #53#1 = aAlfa;
     |LEE 000#53=;
     |SI FSalida = 0;
          |MENAV "0000Periodo cerrado...";
          nSwCerrado = 1;
          |ACABA;
     |FINSI;
     |CIERRA #53;
     ||컴컴컴컴컴컴컴횮ontrol Cierre
     efFecha = #0#2;
     |HAZ EstaCerrado;
     |SI FSalida = 0;
          nSwCerrado = 1;
          |ACABA;
     |FINSI;
     ||컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|FPRC;

|PROCESO NoHay;
     nHay = 0;
|FPRC;

|PROCESO SiHay;
     nHay = 1;
     |ERROR10;
|FPRC;

|DEFBUCLE Mira6;
     #6#1;
     ;
     "T", #7#15, #7#3, #5#3, 0001;
     "T", #7#15, #7#3, #5#3, 9999;
     ;
     NoHay, SiHay;
|FIN;

|DEFBUCLE Mira5;
     #5#1;
     ;
     #1#7, #1#8, #0#2, 0001;
     #1#7, #1#8, #0#2, 9999;
     ;
     NoHay, SiHay;
|FIN;

|PROCESO Ultimo4;
     |SELECT #1#4;
     #4#2 = 9999;
     |LEE 000#4];
     |SI FSalida = 0;
          |LEE 000#4a;
     |SINO;
          |LEE 000#4u;
     |FINSI;
     |SI FSalida = 0; |Y #4#0 = #1#7; |Y #4#1 = #1#8;
          nLin = #4#2 + 1;
     |SINO;
          nLin = 1;
     |FINSI;

     |DDEFECTO #4;
     #4#0 = #1#7;
     #4#1 = #1#8;
     #4#2 = nLin;
     |GRABA 020#4b;
|FPRC;

|PROCESO ContaParte;
     |ABRE #27;
     #27#0 = "partetrab";
     #27#2  = #1#5;
     |LEE 000#27=;
     |SI FSalida = 0;
          #27#1 = #27#1 + 1;
          |GRABA 020#27a;
     |SINO;
          #27#1 = 1;
          |GRABA 020#27n;
     |FINSI;
     |CIERRA #27;

     #7#15 = #1#5;
     #7#3 = #27#1;
|FPRC;

|PROCESO Ultimo5;
     |SELECT #1#5;
     #5#3 = 9999;
     |LEE 000#5];
     |SI FSalida = 0;
          |LEE 000#5a;
     |SINO;
          |LEE 000#5u;
     |FINSI;
     |SI FSalida = 0; |Y #5#20 = #1#7; |Y #5#21 = #1#8; |Y #5#2 = #0#2;
          nLin = #5#3 + 1;
     |SINO;
          nLin = 1;
     |FINSI;

     |DDEFECTO #5;
     #5#20 = #1#7;  ||Se
     #5#21 = #1#8;  ||Pre
     #5#2 = #0#2;   ||Fecha
     #5#3 = nLin;
     |GRABA 020#5b;
|FPRC;

|PROCESO Ultimo6;
     |SELECT #1#6;
     #6#7 = 999;
     |LEE 000#6];
     |SI FSalida = 0;
          |LEE 000#6a;
     |SINO;
          |LEE 000#6u;
     |FINSI;
     |SI FSalida = 0; |Y #6#4 = #7#15 ; |Y #6#5 = #7#3; |Y #6#6 = #5#3;
          nLin = #6#7 + 1;
     |SINO;
          nLin = 1;
     |FINSI;
     |DDEFECTO #6;
     #6#34 = "T";
     #6#4 = #7#15; ||Se
     #6#5 = #7#3;  ||Alba
     #6#6 = #5#3;  ||Lin
     #6#7 = nLin;
     |GRABA 020#6b;
|FPRC;

|PROCESO CargaEl3;
     |DDEFECTO #3;
     #3#0 = #2#0;                                 ||Serie Expe.
     #3#1 = #2#1;                                 ||Num. Exped.
     #3#2 = #17#2;                                ||Linea.
     |LEE 000#3=;
     |SI FSalida ! 0;
          #3#3 = #17#6;                            ||Fecha Pres.
          #3#4 = #17#3;                            ||Serie Pres.
          #3#5 = #17#4;                            ||Num. Presu.
          #3#14 = #17#5;                           ||Tipo Presu.
          |GRABA 020#3b;
     |FINSI;
|FPRC;

|PROCESO Tipo2; |TIPO 2;
     nForma = 0 +.1;

     |ABRE #9;
     #9#0 = #1#5;
     #9#1 = #1#6;
     |LEE 020#9=;
     |CIERRA #9;

     |ABRE #2;
     |ABRE #3;
     |ABRE #18;
     #18#0 = #1#5;
     #18#1 = #1#6;
     |LEE 020#18=;
     |SI FSalida = 0;
          |DDEFECTO #2;
          #2#0 = #1#5;
          #2#1 = #1#6;
          |LEE 101#2=;
          |SI FSalida ! 0;
               #2#10 = #18#2;
               #2#11 = #18#6;
               #2#12 = #18#8;
               #2#13 = #9#29;
               |GRABA 020#2b;
          |FINSI;
          |BUCLELIN 2 CargaEl3 #18;
     |FINSI;
     |CIERRA #18;

     #3#0 = #1#5; ||Se
     #3#1 = #1#6; ||Exp
     #3#4 = #1#7; ||Se
     #3#5 = #1#8; ||Pre
     |SELECT #2#3;
     |LEE 020#3=;

     |SELECT #1#3;
     |LEE 020#3=;

     |ABRE #4;  |SELECT #2#4;
     |ABRET #5; |SELECT #5#5;
     |ABRET #6; |SELECT #2#6;
     |ABRE #7;

     #4#0 = #1#7; ||Ser
     #4#1 = #1#8; ||Num Pre
     #4#3 = #0#2; ||F. Parte
     |LEE 101#4=;
     |SI FSalida ! 0; |HAZ Ultimo4; |FINSI;
     #4#0 = #1#7; ||Ser
     #4#1 = #1#8; ||Num Pre
     #4#3 = #0#2; ||F. Parte

     |DDEFECTO #7;
     #7#0 = #1#5;   ||Ser
     #7#1 = #1#6;   ||Exp.
     #7#2 = #0#2;   ||F.Parte
     #7#16 = #1#7;  ||Se
     #7#17 = #1#8;  ||Pres
     |LEE 101#7=;
     |SI FSalida ! 0; |HAZ ContaParte; |GRABA 020#7b; |FINSI;
     #7#0 = #1#5;   ||Ser
     #7#1 = #1#6;   ||Exp.
     #7#2 = #0#2;   ||F.Parte
     #7#7 = #1#11;
     #7#8 = #1#12;
     #7#14 = #1#19; ||Moneda
     #7#16 = #1#7;  ||Se
     #7#17 = #1#8;  ||Pres
     #7#20 = #1#18; ||Tipo Cargo

     #4#4 = #7#15;
     #4#5 = #7#3;
     #4#14 = #1#5;
     #4#15 = #1#6;
     #4#16 = #3#14;

     #5#20 = #1#7;  ||Se
     #5#21 = #1#8;  ||Pre
     #5#2 = #0#2;   ||Fecha
     #5#4 = #0#0;   ||Traba
     #5#26 = #1#20; ||Tipo Hora
     |SI #1#24 ! 0;
          #5#3 = #1#24;
          |SELECT #1#5;
     |FINSI;
     |LEE 101#5=;
     |SI FSalida ! 0; |O #1#24 = 0; |HAZ Ultimo5; |FINSI;
     #1#24 = #5#3;
     #5#0 = #1#5;   ||Se
     #5#1 = #1#6;   ||Exp
     #5#2 = #0#2;   ||Fecha
     #5#4 = #0#0;   ||Traba
     #5#5 = #0#1;
     #5#6 = #0#7;
     #5#7 = #0#9;
     #5#20 = #1#7;  ||Se
     #5#21 = #1#8;  ||Pre
     #5#22 = #0#13;
     #5#23 = #7#15; || Se
     #5#24 = #7#3;  || Parte
 ||  #5#25 = ANULADO
     #5#26 = #1#20; ||Tipo Hora
     #5#27 = #1#21;

     |DDEFECTO #6;
     #6#34 = "T";  ||TIPO
     #6#4 = #7#15; ||Se
     #6#5 = #7#3;  ||Alba
     #6#6 = #5#3;  ||Lin
     #6#33 = #1#22;||capi
     #6#8 = #1#9;  ||Parti

     |LEE 101#6=;
     |SI FSalida ! 0; |HAZ Ultimo6; |FINSI;
     #6#0 = #1#7;  ||Se
     #6#1 = #1#8;  ||Pres
     #6#2 = #1#5;  ||Se
     #6#3 = #1#6;  ||Exp
     #6#4 = #7#15; ||Se
     #6#5 = #7#3;  ||Alba
     #6#6 = #5#3;  ||Lin
     #6#8 = #1#9;  ||Parti
     #6#9 = #1#10;
     ||컴컴컴컴컴컴컴컴컴
     #6#15 = #1#11;
     #6#16 = #1#12;
||   #6#17 =        ||Alma
||   #6#18 =        ||Des. Alma
||   #6#19 =        ||Documento Traspaso
     #6#20 = #0#13;
     #6#21 = #1#19;
||   #6#26 =        ||Tipo Entra
||   #6#27 =
||   #6#28 =
     #6#29 = "T";
||   #6#30 =
||   #6#31 =
||   #6#32 =        ||Serie Traspaso
     #6#33 = #1#22;
     #6#34 = "T";
     #6#36 = #1#23;
     ||컴컴컴컴컴컴컴컴컴컴컴컴컴TOTALES
     #0#14 = #0#14 +. #1#16;
     #0#15 = #0#15 +. #1#17;
     |PINTA #0#14;
     |PINTA #0#15;
     ||
     #6#10 = #1#3;
     #6#28 = #0#2;
     #6#37 = #1#14;
     #6#38 = 0;
     #6#39 = 0;
     #6#40 = 0;
     #6#41 = #1#15;
     #6#42 = 0;
     #6#43 = 0;
     #6#44 = 0;
     |HAZ CalcuGopartia;

     nHP = 0; nHA = 0; nHE = 0;
     |SI #1#18 = "P"; nHP = #1#3; |FINSI;
     |SI #1#18 = "A"; nHA = #1#3; |FINSI;
     |SI #1#18 = "E"; nHE = #1#3; |FINSI;

     #5#8 = #5#8 +. nHP;
     #5#9 = #5#9 +. nHA;
     #5#10 = #5#10 +. nHE;
     #5#11 = #5#8 + #5#9 + #5#10;
     #5#12 = #1#14;
     #5#13 = #1#15;
  || #5#14 =
  || #5#15 =
     #5#16 = #5#11 * #5#12;
     #5#17 = #5#11 * #5#13;
  || #5#18 =
  || #5#19 =
     #5#28 = #1#25;

     #7#4 = #7#4 +. nHP;
     #7#5 = #7#5 +. nHA;
     #7#6 = #7#6 +. nHE;
     #7#9 = #7#4 + #7#5 + #7#6;
     #7#10 = #7#10 +. #1#17;
     #7#11 = #7#11 +. #1#14;
     #7#12 = #7#12 +. #1#17;
     #7#13 = #7#13 +. #1#14;
     #7#18 = #7#9; ||???
     #7#19 = 0;    ||???

     #4#6 = #4#6 +. nHP;
     #4#7 = #4#7 +. nHA;
     #4#8 = #4#8 +. nHE;
     #4#9 = #4#9 +. #1#17;
     #4#10 = #4#10 +. #1#16;
     #4#11 = #4#9;
     #4#12 = #4#10;
     #4#13 = #4#6 + #4#7 + #4#8;

     #3#6 = #3#6 +. nHP;
     #3#7 = #3#7 +. nHA;
     #3#8 = #3#8 +. nHE;
     #3#9 = #3#9 +. #1#17;
     #3#10 = #3#10 +. #1#16;
     #3#13 = #3#6 + #3#7 + #3#8;
     #3#11 = #3#9;
     #3#12 = #3#10;

     #2#2 = #2#2 +. nHP;
     #2#3 = #2#3 +. nHA;
     #2#4 = #2#4 +. nHE;
     #2#6 = #2#6 +. #1#17;
     #2#7 = #2#7 +. #1#16;
     #2#5 = #2#2 +. #2#3 + #2#4;
     #2#8 = #2#6;
     #2#9 = #2#7;

     |GRABA 020#2a;
     |GRABA 020#3a;
     |GRABA 020#4a;
     |GRABA 020#5a;
     |GRABA 020#6a;
     |GRABA 020#7a;

     |SI nForma = -1;
          |BORRA 020#6a;
          |BUCLE Mira6;
          |SI nHay = 0;
               |BORRA 020#5a;
               |BUCLE Mira5;
               |SI nHay = 0;
                    |BORRA 020#7a;
                    |BORRA 020#4a;
               |FINSI;
          |FINSI;
     |FINSI;
     |HAZ Asiento;

     |CIERRA #3;
     |CIERRA #2;
     |CIERRA #7;
     |CIERRAT #6;
     |CIERRAT #5;
     |CIERRA #4;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO CalImp;
     #1#16 = #1#14 * #1#3;
     #1#17 = #1#15 * #1#3;
     |PINTA #1#16;
|FPRC;

|PROCESO BuscaPresu;
     aSerPre = #16#3;
     nNumPre = #16#4;
     aEstado = #16#10;
     |SI #16#10 = "C"; nHay = nHay + 1; |FINSI;
|FPRC;

|DEFBUCLE BuscaPresu;
     #16#1;
     ;
     #1#5, #1#6, 001;
     #1#5, #1#6, 999;
     ;
     NULL, BuscaPresu;
|FIN;

|PROCESO sacamone;
     |SI FSalida = 2; |ACABA; |FINSI;
     nSal = FSalida;
     nModo = (FEntrada / 100) ! 0;

     |ABRE #18;
     |DDEFECTO #18;
     #18#0 = #1#5;
     #18#1 = #1#6;
     |LEE 000#18=;
     nMoneExp = #18#6;
     cCodMonTrab = nMoneExp;
     |HAZ MonBas;
     |CIERRA #18;

     |SI #100#124 = "A"; |Y Campo = 6;
          nHay = 0; aSerPre = ""; aEstado = "";
          |BUCLE BuscaPresu;
          |SI nHay = 0;
               |SI aEstado ! "";
                    eaSerPre = aSerPre;
                    enNumPre = nNumPre;
                    eaSerExp = #1#5;
                    enNumExp = #1#6;
                    |HAZ EstadoObra;
                    |SI FSalida ! 0; |ERROR; |ACABA; |FINSI;
                    nHay = 1;
               |SINO;
                    |MENAV "0000No hay presupuestos en el expediente...";
                    |ERROR; |ACABA;
               |FINSI;
          |FINSI;
          |SI nHay = 1;
               #1#7 = aSerPre;
               #1#8 = nNumPre;
               |HAZ Precio;
               |C_M #1#7, 1, "N";
               |C_M #1#8, 1, "N";
          |SINO;
               |SI nSal = 1; |O nSal = 5; |O nModo = 1; |O #1Campo ! Contenido;
                    FSalida = 10; |HAZ LisPres;
                    |SI nError = 1; #1Campo = ""; |FINSI;
               |FINSI;
               |C_M #1#7, 1, "S";
               |C_M #1#8, 1, "S";
          |FINSI;
          |C_M #1#9, 1, "N";
          |C_M #1#23, 1, "N";
          |C_M #1#15, 1, "N";
          |C_M #1#14, 1, "N";
          |C_M #1#25, 1, "N";
     |FINSI;
|FPRC;

|PROCESO MinPresu;
     #16#0 = #1#5;                                 ||Expediente.
     #16#1 = #1#6;                                 ||Numero Expediente.
     #16#2 = 1;                                    ||Linea.
|FPRC;

|PROCESO MaxPresu;
     #16#0 = #1#5;                                 ||Expediente.
     #16#1 = #1#6;                                 ||Numero Expediente.
     #16#2 = 999;                                  ||Linea.
|FPRC;

|PROCESO LinExpe;
     #8#0 = #16#3;
     #8#1 = #16#4;
     |LEE 000#8=;
     |SI FSalida = 0;
          |SALVA_DATOS #8;
          |REPON_DATOS #gopre001@;
          |GRABA 020#gopre001@.n;
     |FINSI;
|FPRC;

|DEFBUCLE LinExpe;
     #16#1;
     ;
     #1#5, #1#6, 001;
     #1#5, #1#6, 999;
     ;
     NULL, LinExpe;
|FIN;

|PROCESO LisPres; |TIPO 6;
     |SI FSalida = 10;
          |DDEF aAlfa;
          aAlfa = aAlfa + "gopre001";
          |CARGA_DEF aAlfa, gopre001@;
          |SI FSalida = 0;
               |HAZ CreaTempo; |NOME_DAT #gopre001@#Tempo#; |DELINDEX #gopre001@;
               |ABRE #gopre001@;
               |ABRE #8;
               |BUCLE LinExpe;
               |CIERRA #8;
               |LEE 000#gopre001@.p;
               |CONSULTA_CLAVE #1#gopre001@;
               |SI FSalida = 0;
                    #1#7 = #gopre001@#0; |PINTA #1#7;
                    #1#8 = #gopre001@#1; |PINTA #1#8;
                    nError = 0;
               |SINO;
                    nError = 1;
                    |ERROR;
               |FINSI;
               |CIERRA #gopre001@;
               |HAZ BoraTempo; |DELINDEX #gopre001@;
               |DESCARGA_DEF #gopre001@;
          |FINSI;
/*
          |ABRE #16;
          |LEE 000#16p;
          |CONSULTA_F_CLAVE #1#16, MinPresu, MaxPresu;
          |SI FSalida ! 0;
               |ERROR; |ACABA;
          |SINO;
               #1#7 = #16#3;                       ||Serie Pres.
               #1#8 = #16#4;                       ||N Pres.
               #1#5 = #16#0;                       ||Seire Expe.
               #1#6 = #16#1;                       ||N Expe.
               |PINTA #1#7;|PINTA #1#8;
          |FINSI;
          |CIERRA #16;
*/
     |FINSI;
|FPRC;

|PROCESO CheqPresu; |TIPO 0;
     |SI FSalida = 2; |ACABA; |FINSI;

     |C_M #1#8, 0, aAlfa;
     |SI aAlfa = "N"; |ACABA; |FINSI;

     eaSerPre = #1#7;
     enNumPre = #1#8;
     eaSerExp = #1#5;
     enNumExp = #1#6;
     |HAZ EstadoObra;
     |SI FSalida ! 0; |ERROR; |FINSI;

     |ABRE #16; |SELECT #2#16;
     #16#0 = #1#5;
     #16#1 = #1#6;
     #16#3 = #1#7;
     #16#4 = #1#8;
     |LEE 000#16=;
     |SI FSalida ! 0;
          |MENAV "0000No existe Presupuesto en el Expediente indicado";
          |ERROR;
     |FINSI;
     |CIERRA #16;
|FPRC;

|PROCESO cMin;
     #12#2 = #1#5;
     #12#3 = #1#6;
     #12#5 = "                    ";
|FPRC;

|PROCESO cMax;
     #12#2 = #1#5;
     #12#3 = #1#6;
     #12#5 = "zzzzzzzzzzzzzzzzzzzz";
|FPRC;

|PROCESO gopre004;
     |SI #1#3 = #15#5;
          nHay = 1;
          |ERROR10;
     |FINSI;
|FPRC;

|DEFBUCLE gopre004;
     #15#3;
     ;
     #1#7, #1#8, #30#4, "                    ";
     #1#7, #1#8, #30#4, "zzzzzzzzzzzzzzzzzzzz";
     be;
     NULL, gopre004;
|FIN;

|PROCESO CargaEl14;
     nHay = 0;
     |BUCLE gopre004;

     |SI nHay ! 0;
          |PARA i = 0; |SI i [ 24; |HACIENDO i = i + 1;
               #14i = #30i;
          |SIGUE;
          #26#0 = #30#0;
          #26#1 = #30#1;
          #26#12 = #30#2;
          |LEE 000#26=;
          #14#25 = #26#13;
          |GRABA 020#14b;
     |FINSI;
|FPRC;

|DEFBUCLE CargaEl14;
     #30#3;
     ;
     #1#7, #1#8, 001; || Serie/Presu
     #1#7, #1#8, 999;
     ;
     NULL, CargaEl14;
|FIN;

|PROCESO LisPart; |TIPO 0;
     nModo = (FEntrada % 100) ! 0;
     |C_M #1#9, 0, aAlfa;
     |SI aAlfa = "N";
          aAlfa = #1#20 + #1#5 + #1#6 + #1#7 + #1#8 + #1#9;
          |SI aAntes ! aAlfa;
               |HAZ Precio;
          |FINSI;
     |SINO;
          aAlfa = #1#9; |QBF aAlfa;
          |SI FSalida = 0; |Y #100#124 = "S"; |Y aAlfa = "";
               || partida+capitulo blanco
          |SINO;
               eaSerPre = #1#7;
               enNumPre = #1#8;
               eaCapi = #1#22;
               eaParti = #1#9;
               |HAZ GuerPartid;
               |SI eaParti ! "";
                    #1#22 = eaCapi;
                    #1#9 = eaParti;
                    #1#10 = eaDesPa;
                    |PINTA #1#9;
                    |PINTA #1#10;
               |FINSI;
          |FINSI;

          |SI FSalida = 11;
               |HAZ CreaTempo; aTempo14 = Tempo;
               |NOME_DAT #14 aTempo14; |DELINDEX #14;
               |ABRE #14;
               |ABRE #26; |SELECT #6#26;
               |BUCLE CargaEl14;
               |CIERRA #26;
               |LEE 000#14p;
               |CONSULTA_CLAVE #1#14;
               |SI FSalida ! 0;
                    |ERROR;
               |SINO;
                    #1#9 = #14#4;                        ||Partida.
                    #1#10 = #14#5;                        ||Descripcion Partida.
                    |PINTA #1#9;
                    |PINTA #1#10;
               |FINSI;
               |CIERRA #14;
               |DELINDEX #14; Tempo = aTempo14; |HAZ BoraTempo;
          |FINSI;
          |HAZ Precio;
 ||||    |HAZ BuscaPartidas;   NO HACE FALTA
     |FINSI;
|FPRC;

|PROCESO BuscaPartidas;
     |ABRE #12; |SELECT #2#12;
     #12#0 = #1#7;
     #12#1 = #1#8;
     #12#5 = #1#9;
     |LEE 000#12=;
     |SI FSalida ! 0;
          |MENAV "0000NO EXISTE LA PARTIDA EN EL PRESUPUESTO";
          |ERROR;
     |SINO;
          #1#7 = #12#0;                       ||Se. pres.
          #1#8 = #12#1;                       ||N. pres.
          #1#9 = #12#5;
          #1#10 = #12#6;                      ||Descripcion.
          |PINTA #1#9;
          |PINTA #1#10;
          |HAZ Precio;
     |FINSI;
     |CIERRA #12;
|FPRC;

|PROCESO ImpoHora;
     |ABRE #20;               || gotrabat
     #20#0 = #0#0;  ||trabajador
     #20#2 = #1#20; ||Tipo Horas.
     |LEE 000#20=;
     |SI FSalida = 0;
          |SI #8#18 = "P";
               #1#14 = #20#4;
               #1#15 = #20#5;                 ||PVP Pres.
          |FINSI;
          |SI #8#18 = "A";
               #1#14 = #20#6;
               #1#15 = #20#7;                 ||PVP Admi.
          |FINSI;
          |SI #8#18 = "E";
               #1#14 = #20#8;
               #1#15 = #20#9;                 ||PVP Extr.
          |FINSI;
     |SINO;
          |ABRE #19;
          #19#0 = #0#7;  ||Categoria.
          #19#1 = #0#6;  ||Convenio.
          #19#2 = #1#20; ||Tipo Horas.
          |LEE 000#19=;
          |SI FSalida ! 0;
               |SI #8#18 = "P";
                    #1#14 = #0#3;
                    #1#15 = #0#10;                 ||PVP Pres.
               |FINSI;
               |SI #8#18 = "A";
                    #1#14 = #0#4;
                    #1#15 = #0#11;                 ||PVP Admi.
               |FINSI;
               |SI #8#18 = "E";
                    #1#14 = #0#5;
                    #1#15 = #0#12;                 ||PVP Extr.
               |FINSI;
          |SINO;
               |SI #8#18 = "P";
                    #1#14 = #19#4;
                    #1#15 = #19#5;                 ||PVP Pres.
               |FINSI;
               |SI #8#18 = "A";
                    #1#14 = #19#6;
                    #1#15 = #19#7;                 ||PVP Admi.
               |FINSI;
               |SI #8#18 = "E";
                    #1#14 = #19#8;
                    #1#15 = #19#9;                 ||PVP Extr.
               |FINSI;
          |FINSI;
          |CIERRA #19;
     |FINSI;
     |CIERRA #20;
|FPRC;

|PROCESO Precio;
     aAlfa = #1#9; |QBF aAlfa;
     |SI Contenido ! #1#9; |O aAlfa = "";
          |ABRE #8;
          #8#0 = #1#7;                            ||Serie Pres.
          #8#1 = #1#8;                            ||Numero Pres.
          |LEE 000#8=;
          |SI FSalida = 0;
               #1#18 = #8#18;                     ||Tipo Presupuesto.
               #1#19 = #8#7;                      ||Moneda Trabajo.
               |HAZ ImpoHora;
               |SI nMoneCat ! nMoneExp;
                    cCodMonDe   = nMoneCat;
                    cCodMonA    = nMoneExp;
                    nPrecioComp = #1#15;
                    |HAZ DemonAmon;
                    #1#15 = nPrecioComp;
               |FINSI;
               |SI nMoneCat ! nMoneExp;
                    cCodMonDe   = nMoneCat;
                    cCodMonA    = nMoneExp;
                    nPrecioVent = #1#14;
                    |HAZ DemonAmon;
                    #1#14 = nPrecioVent;
               |FINSI;
          |FINSI;

          |ABRE #15; |SELECT #3#15;
          #15#0 = #1#7;                            ||Serie Pres.
          #15#1 = #1#8;                            ||Numero Pres.
          #15#3 = #1#9;                            ||Partida.
          #15#5 = #0#13;                           ||Codigo MO.
          |LEE 000#15=;
          |SI FSalida = 0;
               #1#14 = #15#9;
          |SINO;
               |SI #goparame#95 = "S";
                    |CONFI "0000NNO EXISTE ESTE TIPO DE MANO DE OBRA EN LA PARTIDA";
               |SINO;
                    FSalida = 0;
               |FINSI;
               |SI FSalida = -1;
                    |ERROR;
                    |ACABA;
               |SINO;
/*
                    |ABRE #19;
                    #19#0 = #0#7;  ||Categoria.
                    #19#1 = #0#6;  ||Convenio.
                    #19#2 = #1#20; ||Tipo Horas.
                    |LEE 000#19=;
                    |SI FSalida ! 0;
                         |SI #8#18 = "P";
                              #1#14 = #0#3;                 ||PVP.
                              #1#15 = #0#11;                ||PVC.
                         |FINSI;

                         |SI #8#18 = "A";
                              #1#14 = #0#4;                 ||PVP.
                              #1#15 = #0#12;                ||PVP.
                         |FINSI;

                         |SI #8#18 = "E";
                              #1#14 = #0#5;                 ||PVP.
                              #1#15 = #0#13;                ||PVP.
                         |FINSI;
                    |SINO;
                         |SI #8#18 = "P";
                              #1#14 = #19#4;                 ||PVP.
                              #1#15 = #19#5;                 ||PVC.
                         |FINSI;

                         |SI #8#18 = "A";
                              #1#14 = #19#6;                 ||PVP.
                              #1#15 = #19#7;                 ||PVC.
                         |FINSI;

                         |SI #8#18 = "E";
                              #1#14 = #19#8;                 ||PVP.
                              #1#15 = #19#9;                 ||PVC.
                         |FINSI;
                    |FINSI;
                    |CIERRA #19;

                    |SI nMoneCat ! nMoneExp;
                         cCodMonDe   = nMoneCat;
                         cCodMonA    = nMoneExp;
                         nPrecioComp = #1#15;
                         |HAZ DemonAmon;
                         #1#15 = nPrecioComp;
                    |FINSI;
                    |SI nMoneCat ! nMoneExp;
                         cCodMonDe   = nMoneCat;
                         cCodMonA    = nMoneExp;
                         nPrecioVent = #1#14;
                         |HAZ DemonAmon;
                         #1#14 = nPrecioVent;
                    |FINSI;
*/
               |FINSI;
          |FINSI;
          |CIERRA #15;
          |CIERRA #8;
     |FINSI;

     |HAZ CalImp;
     |PINTA #1#15;
|FPRC;

|PROCESO cMinHor;
     #19#0 = #0#7;
     #19#1 = #0#6;
     #19#2 = 0;
|FPRC;

|PROCESO cMaxHor;
     #19#0 = #0#7;
     #19#1 = #0#6;
     #19#2 = 99;
|FPRC;

|PROCESO THora;
     nModo = (FEntrada / 100) ! 0;
     nSalida = FSalida;
     |ABRE #19;
     |SI nSalida = 11;
          |CONSULTA_F_CLAVE #1#19, cMinHor, cMaxHor;
          |SI FSalida = 0;
               #1#20 = #19#2;
          |SINO;
               |ERROR;
          |FINSI;
     |FINSI;
     |SI Contenido ! #1#20; |O nModo = 1;
          #19#0 = #0#7;
          #19#1 = #0#6;
          #19#2 = #1#20;
          |LEE 000#19=;
          |SI FSalida = 0;
               #1#21 = #19#3;
               |HAZ MiraHora;
          |SINO;
               |MENAV "0000EL TIPO DE HORA INTRODUCIDO NO EXISTE EN LA CATEGORIA";
               |ERROR;
          |FINSI;
     |FINSI;
     |CIERRA #19;
|FPRC;

|PROCESO MiraHora;
     |SI cTipo = "P";
          #1#14 = #19#4;                 ||Importe Hora Venta Base.
          #1#15 = #19#5;                 ||Importe Hora Costo Base.
     |FINSI;

     |SI cTipo = "A";
          #1#14 = #19#6;                 ||Importe Hora Venta Base.
          #1#15 = #19#7;                 ||Importe Hora Costo Base.
     |FINSI;

     |SI cTipo = "E";
          #1#14 = #19#8;                 ||Importe Hora Venta Base.
          #1#15 = #19#9;                 ||Importe Hora Costo Base.
     |FINSI;

     |SI nMoneCat ! nMoneExp;
          cCodMonDe   = nMoneCat;
          cCodMonA    = nMoneExp;
          nPrecioComp = #1#15;
          |HAZ DemonAmon;
          #1#15 = nPrecioComp;
     |FINSI;
     |SI nMoneCat ! nMoneExp;
          cCodMonDe   = nMoneCat;
          cCodMonA    = nMoneExp;
          nPrecioVent = #1#14;
          |HAZ DemonAmon;
          #1#14 = nPrecioVent;
     |FINSI;
     |HAZ CalImp;
     |PINTA #1#14;|PINTA #1#15;|PINTA #1#20;|PINTA #1#21;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO gopartia;
     nLin = nLin + 1;
     #1#0 = #0#0;   ||Traba
     #1#1 = #0#2;   ||Fech
     #1#2 = nLin;
     #1#3 = #6#10;  ||Cant.Horas
 ||    #1#4 = #5#26;||Tipo Cargo    NO VALE
     #1#5 = #6#2;   ||Ser Exp
     #1#6 = #6#3;   ||Num Exp
     #1#7 = #6#0;   ||Ser Pre
     #1#8 = #6#1;   ||Num Pre
     #1#9 = #6#8;   ||Parti
     #1#10 = #6#9;  ||Des Parti
     #1#11 = #6#15; ||Cod Cli
     #1#12 = #6#16; ||Nom Cli
     #1#13 = #9#3;  ||Titulo Exp
     #1#14 = #5#12; ||Pre Vta Hora
     #1#15 = #5#13; ||Pre Coste Hora
     #1#16 = #5#12 * #6#10; ||Imp Venta
     #1#17 = #5#13 * #6#10; ||Imp coste
     #1#18 = #8#18; ||Tipo Presu
     #1#19 = #8#7;  ||Moneda
     #1#20 = #5#26; ||Tipo Hora
     #1#21 = #5#27; ||Desc Tipo Hora
     #1#22 = #6#33; ||Capitulo
     #1#23 = #6#36;
     #1#24 = #5#3;
     #1#25 = #5#28;
     |GRABA 020#1n;

     #0#14 = #0#14 + #1#16;
     #0#15 = #0#15 + #1#17;
     |PINTA #0#14;
     |PINTA #0#15;
|FPRC;

|DEFBUCLE gopartia;
     #6#1;
     ;||Ser/Num Alb  Lin   Lin
     "T", #7#15, #7#3, #5#3, 001;
     "T", #7#15, #7#3, #5#3, 999;
     ;
     NULL, gopartia;
|FIN;

|PROCESO goptrbli;
     #7#0 = #5#0;    ||Ser Exp
     #7#1 = #5#1;    ||Num Exp
     #7#2 = #5#2;    ||Fec Parte
     #7#16 = #5#20;  ||Ser Pre
     #7#17 = #5#21;  ||Num Pre
     |LEE 020#7=; ||goptrbca

     #4#0 = #5#20;   ||Ser
     #4#1 = #5#21;   ||Presu
     #4#3 = #5#2;    ||Fec Part
     |LEE 020#4=; ||gopartli

     #3#4 = #5#20;  ||Ser
     #3#5 = #5#21;  ||Presup
     |LEE 020#3=; ||gopartll

     #2#0 = #5#0;   ||Ser
     #2#1 = #5#1;   ||Exp
     |LEE 020#2=; ||gopartca

     #8#0 = #5#20;
     #8#1 = #5#21;
     |LEE 020#8=; ||gopre001

     #9#0 = #5#0;  ||Ser
     #9#1 = #5#1;  ||Exp
     |LEE 020#9=; ||gomantho

     |BUCLE gopartia;
|FPRC;

|DEFBUCLE goptrbli;
     #5#2;
     ;
     "     ", 000001, #0#2, 0001, #0#0;
     "zzzzz", 999999, #0#2, 9999, #0#0;
     ;
     NULL, goptrbli;
|FIN;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO Categoria; |TIPO 0;
     |DDEFECTO #13;
     |ABRE #13;
     #13#0 = #0#7;                                 ||Categoria.
     #13#1 = #0#6;                                 ||Convenio.
     |LEE 000#13=;
     |SI FSalida = 0;
          #0#3  = #13#3;                           ||PVP Pres.
          #0#4  = #13#7;                           ||PVP Admi.
          #0#5  = #13#8;                           ||PVP Extr.
          #0#10 = #13#4;                           ||PCT Pres.
          #0#11 = #13#9;                           ||PCT Admi.
          #0#12 = #13#10;                          ||PCT Extr.
          #0#13 = #13#13;                          ||Cod. MO.
          nMoneCat = #13#5;
          |PINTA #0#13;
     |FINSI;

     |CIERRA #3;
|FPRC;

|PROCESO Min;
     #1#0 = #0#0;
     #1#1 = #0#2;
     #1#2 = 001;
|FPRC;

|PROCESO Max;
     #1#0 = #0#0;
     #1#1 = #0#2;
     #1#2 = 999;
|FPRC;

|PROCESO Tipo12; |TIPO 12;
     || esto' pana'  ;-)
|FPRC;

|PROCESO BSal; |TIPO 7;
     |SI Campo = 7; |O Campo = 8;
          |ESTADO_CONTROL nBotF20, "SHOW"; ||"SHOW""HIDE""ENABLE""DISABLE".
          |ESTADO_CONTROL nBotF21, "HIDE"; ||"SHOW""HIDE""ENABLE""DISABLE".
          |ESTADO_CONTROL nBotF30, "HIDE"; ||"SHOW""HIDE""ENABLE""DISABLE".
     |FINSI;
     |SI Campo = 9;
          |ESTADO_CONTROL nBotF20, "HIDE"; ||"SHOW""HIDE""ENABLE""DISABLE".
          |ESTADO_CONTROL nBotF21, "SHOW"; ||"SHOW""HIDE""ENABLE""DISABLE".
          |ESTADO_CONTROL nBotF30, "SHOW"; ||"SHOW""HIDE""ENABLE""DISABLE".
     |FINSI;

|FPRC;

|PROCESO BHal; |TIPO 0;
     |ESTADO_CONTROL nBotF20, "HIDE"; ||"SHOW""HIDE""ENABLE""DISABLE".
     |ESTADO_CONTROL nBotF21, "HIDE"; ||"SHOW""HIDE""ENABLE""DISABLE".
     |ESTADO_CONTROL nBotF30, "HIDE"; ||"SHOW""HIDE""ENABLE""DISABLE".
|FPRC;

|PROCESO F2al3;
     |PTEC 824;
|FPRC;

|PROCESO F3al3;
     |PTEC 825;
|FPRC;

|PROGRAMA;
     |ABRE #100; |LEE 000#100p; |CIERRA #100;

     |HAZ CreaTempo; aTempo1 = Tempo;
     |NOME_DAT #1 aTempo1; |DELINDEX #1;

     cCodMonTrab = "EUR";
     |HAZ MonBas;

     |CONTROL_SIMPLE 0,"LBOTON, F2 - Presupuestos de Expediente", 2430, 2460, F2al3;
     nBotF20 = FSalida;
     |ESTADO_CONTROL nBotF20, "HIDE"; ||"SHOW""HIDE""ENABLE""DISABLE".

     |CONTROL_SIMPLE 0, "LBOTON,F2 - Partidas Presupuesto", 2415, 2435, F2al3;
     nBotF21 = FSalida;
     |ESTADO_CONTROL nBotF21, "HIDE"; ||"SHOW""HIDE""ENABLE""DISABLE".

     |CONTROL_SIMPLE 0, "LBOTON,F3 - Partidas Presupuesto/Articulo", 2445, 2465, F3al3;
     nBotF30 = FSalida;
     |ESTADO_CONTROL nBotF30, "HIDE"; ||"SHOW""HIDE""ENABLE""DISABLE".

     |PARA; |SI; |HACIENDO;
          |CLS;
          |PINPA #0#0;
          |PINDA #0#0;
          |ENTLINEAL #1#1, 2, 7, 19, 0, Min, Max;
          |ENDATOS #1#0;
          |SI FSalida = 0;
               |ABRE #1;
               |ABRE #2;
               |ABRE #3; |SELECT #3#3;
               |ABRE #4; |SELECT #2#4;
               |ABRE #7;
               |ABRE #8;
               |ABRE #9;
               |BUCLE goptrbli;
               |CIERRA #9;
               |CIERRA #8;
               |CIERRA #7;
               |CIERRA #4;
               |CIERRA #3;
               |CIERRA #2;
               |CIERRA #1;
               |SI nSwCerrado = 1;
                    |ENTLINEAL #1#1, 3, 4, 19, 0, Min, Max;
               |SINO;
                    |ENTLINEAL #1#1, 3, 1, 19, 0, Min, Max;
               |FINSI;
          |SINO;
               |SAL;
          |FINSI;
          |DELINDEX #1;
     |SIGUE;

     |DELINDEX #1; Tempo = aTempo1; |HAZ BoraTempo;

     |FIN_CONTROL_WINDOWS nBotF20;
     |FIN_CONTROL_WINDOWS nBotF21;
     |FIN_CONTROL_WINDOWS nBotF30;
     |PULSATECLA;
|FPRO;

|PROCESO Asiento;
     |ABRE #gotipoho;
     #gotipoho#0 = #gopaexli#20;
     |LEE 000#gotipoho.=;
     |SI FSalida = 0;
        |SI #gotipoho#2 = "N"; |CIERRA #gotipoho; |ACABA; |FINSI;
     |SINO;
        |MENAV "    No se encuentra el codigo de tipo de horas indicado";
        |CIERRA #gotipoho; |ACABA;
     |FINSI;

     |ABRE #goparame;
     |LEE 000#goparame.p;
     |SI FSalida ! 0;
        |MENAV "    Control de defectos inexistente.";
        |CIERRA #goparame; |CIERRA #gotipoho; |ACABA;
     |FINSI;

     aAlfa = #goparame#84; |QBF aAlfa;
     aAlfa = aAlfa + "def/canempre.mas";
     |CARGA_DEF aAlfa, canempr@;
     |SI FSalida = 0;
        aAlfa = #goparame#84; |QBF aAlfa; aAlfa = aAlfa + "fich/";
        |PATH_DAT #canempr@#aAlfa#;
        |ABRE #canempr@;
        #canempr@#2 = #goparame#85;
        #canempr@#3 = #goparame#86;
        |LEE 000#canempr@.=;
        |SI FSalida = 0;
           nBusca = 0;
           aAlfa = #goptrbli#2; |QBF aAlfa;
           aAlfa = aAlfa % -102; nCalc = aAlfa;
           |SI nCalc ! #canempr@#26;
              aAlfa = "    SLa fecha indicada no pertenece al periodo indicado. " + &191 + " Buscar el periodo automaticamente ? ";
              |CONFI aAlfa;
              |SI FSalida = 0;
                 |PARA; |SI FSalida = 0; |Y #canempr@#2 = #goparame#85; |HACIENDO;
                    |LEE 000#canempr@.s;
                    |SI nCalc = #canempr@#26; nBusca = 1; |SAL; |FINSI;
                 |SIGUE;
                 |SI nBusca = 1;
                   #goparame#85 = #canempr@#2;
                   #goparame#86 = #canempr@#3;
                 |SINO;
                    |MENAV "    No se ha podido encontrar el periodo correcto";
                 |FINSI;
              |FINSI;
           |FINSI;
        |FINSI;
        |CIERRA #canempr@; |DESCARGA_DEF #canempr@;
     |FINSI;

     aAlfa = #goparame#84; |QBF aAlfa;
     aAlfa = aAlfa + "def/caenlace.mas";
     |CARGA_DEF aAlfa, caenlac@;
     |SI FSalida = 0;
        aAlfa = #goparame#84; |QBF aAlfa;
        aAlfa = aAlfa + "def/caconasi.mas";
        |CARGA_DEF aAlfa, caconas@;
        |SI FSalida = 0;
           aAlfa = #goparame#84; |QBF aAlfa;
           aAlfa = aAlfa + "def/camaasic.mas";
           |CARGA_DEF aAlfa, camasic@;
           |SI FSalida = 0;
              aAlfa = #goparame#84; |QBF aAlfa;
              aAlfa = aAlfa + "fich/" + (("00000" + #goparame#85) % -105) + #goparame#86 + "/";
              |PATH_DAT #caenlac@#aAlfa#; |PATH_DAT #camasic@#aAlfa#;
              |PATH_DAT #caconas@#aAlfa#;
              aAlfa = "pu" + Usuario; |QBF aAlfa; |NOME_DAT #caenlac@#aAlfa#;
              |DELINDEX #caenlac@; |ABRE #caenlac@;
              |ABRE #caconas@; |ABRE #camasic@; |ABRE #agifa722;

              nSwError = 0;
              |SI nForma < 0;
                 #agifa722#0 = "TR";
                 #agifa722#1 = #gopaexli#7;
                 aAlfa = (("000000" + #gopaexli#8) % -106) + (("000" + #gopaexli#2) % -103);
                 #agifa722#2 = aAlfa;
                 #agifa722#3 = #gopaexli#1;
                 #agifa722#11 = 1;
                 #agifa722#8 = #goparame#85;
                 #agifa722#9 = #goparame#86;
                 |LEE 000#agifa722.=;
                 |SI FSalida = 0;
                    nDiario = #agifa722#4;
                    fFecha  = #agifa722#5;
                    nDocum  = #agifa722#6;
                    |BORRA 020#agifa722.a;

                    |DDEFECTO #caenlac@;
                    #caenlac@#37 = #agifa722#8;
                    #caenlac@#38 = #agifa722#9;
                    #caenlac@#0 = #agifa722#4;
                    #caenlac@#1 = #agifa722#5;
                    #caenlac@#2 = #agifa722#6;
                    #caenlac@#3 = 0;
                    #caenlac@#9 = 0;
                    #caenlac@#25 = "S";
                    |GRABA 020#caenlac@.n;
                 |SINO;
                    nSwError = 1;
                 |FINSI;
              |SINO;
                 nDiario = #gotipoho#7;
                 fFecha  = #goptrbli#2;

                 |LEE 101#caconas@.p;
                 |SI FSalida ! 0;
                    |DDEFECTO #caconas@;
                    |GRABA 020#caconas@.n;
                    |LEE 101#caconas@.p;
                 |FINSI;

                 #caconas@#1 = #caconas@#1 + 1;
                 aAlfa = "|NC"; nCalc = #caconas@#aAlfa#;
                 |SI nCalc > 2; #caconas@#2 = #caconas@#2 + 1; |FINSI;
                 nDocum = #caconas@#1;

                 |GRABA 020#caconas@.a;
                 |LIBERA #caconas@;

                 #camasic@#0 = nDiario;
                 #camasic@#1 = fFecha;
                 #camasic@#2 = nDocum;
                 |LEE 000#camasic@.=;
                 |SI FSalida = 0;
                    #camasic@#0 = nDiario;
                    #camasic@#1 = fFecha;
                    #camasic@#2 = 999999;
                    |LEE 000#camasic@.];
                    |SI FSalida = 0;
                       |SI #camasic@#0 = nDiario; |Y #camasic@#1 = fFecha;
                          nDocum = 1;
                       |SINO;
                          |LEE 000#camasic@.a;
                          |SI FSalida = 0;
                             |SI #camasic@#0 = nDiario; |Y #camasic@#1 = fFecha;
                                 nDocum = #camasic@#2 + 1;
                             |SINO;
                                nDocum = 1;
                             |FINSI;
                          |SINO;
                             nDocum = 1;
                          |FINSI;
                       |FINSI;
                    |SINO;
                       |LEE 000#camasic@.u;
                       |SI FSalida = 0;
                          |SI #camasic@#0 = nDiario; |Y #camasic@#1 = fFecha;
                             nDocum = #camasic@#2 + 1;
                          |SINO;
                             nDocum = 1;
                          |FINSI;
                       |SINO;
                          nDocum = 1;
                       |FINSI;
                    |FINSI;
                 |FINSI;

                 |DDEFECTO #agifa722;
                 #agifa722#0 = "TR";
                 #agifa722#1 = #gopaexli#7;
                 aAlfa = (("000000" + #gopaexli#8) % -106) + (("000" + #gopaexli#2) % -103);
                 #agifa722#2 = aAlfa;
                 #agifa722#3 = #gopaexli#1;
                 #agifa722#4 = nDiario;
                 #agifa722#5 = fFecha;
                 #agifa722#6 = nDocum;
                 #agifa722#7 = 10;
                 #agifa722#8 = #goparame#85;
                 #agifa722#9 = #goparame#86;
                 #agifa722#11 = 1;
                 |GRABA 020#agifa722.n;

                 |DDEFECTO #caenlac@;
                 #caenlac@#0 = nDiario;
                 #caenlac@#1 = fFecha;
                 #caenlac@#2 = nDocum;
                 #caenlac@#3 = 10;
                 #caenlac@#4 = #gotipoho#3;
                 #caenlac@#5 = 0;
                 #caenlac@#6 = #gotipoho#5;
                 aAlfa = #gotipoho#6; |QBF aAlfa;

                 aFecha = fFecha;
                 aMes = aFecha % 402;
                 nMes = aMes;
                 |SI nMes = 1;  aMes = "Enero";      |FINSI;
                 |SI nMes = 2;  aMes = "Febrero";    |FINSI;
                 |SI nMes = 3;  aMes = "Marzo";      |FINSI;
                 |SI nMes = 4;  aMes = "Abril";      |FINSI;
                 |SI nMes = 5;  aMes = "Mayo";       |FINSI;
                 |SI nMes = 6;  aMes = "Junio";      |FINSI;
                 |SI nMes = 7;  aMes = "Julio";      |FINSI;
                 |SI nMes = 8;  aMes = "Agosto";     |FINSI;
                 |SI nMes = 9;  aMes = "Septiembre"; |FINSI;
                 |SI nMes = 10;  aMes = "Octubre";    |FINSI;
                 |SI nMes = 11;  aMes = "Noviembre";  |FINSI;
                 |SI nMes = 12;  aMes = "Diciembre";  |FINSI;

                 |SI #gotipoho#11 = "S"; aAlfa = aAlfa + aMes; |FINSI;
                 |SI #gotipoho#9  = "S"; aAlfa = aAlfa + " " + #gopaexca#0; |QBF aAlfa; |FINSI;
                 |SI #gotipoho#10 = "S"; aAlfa = aAlfa + " " + #gopaexca#1; |QBF aAlfa; |FINSI;
                 #caenlac@#7 = aAlfa;
                 #caenlac@#8 = "D";
                 #caenlac@#9 = #gopaexli#17;
                 #caenlac@#37 = #goparame#85;
                 #caenlac@#38 = #goparame#86;
                 #caenlac@#39 = #gopaexli#5;
                 |GRABA 020#caenlac@.n;

                 |DDEFECTO #caenlac@;
                 #caenlac@#0 = nDiario;
                 #caenlac@#1 = fFecha;
                 #caenlac@#2 = nDocum;
                 #caenlac@#3 = 20;
                 #caenlac@#4 = #gotipoho#4;
                 #caenlac@#5 = 0;
                 #caenlac@#6 = #gotipoho#5;
                 aAlfa = #gotipoho#6; |QBF aAlfa;

                 aFecha = fFecha;
                 aMes = aFecha % 402;
                 nMes = aMes;
                 |SI nMes = 1;  aMes = "Enero";      |FINSI;
                 |SI nMes = 2;  aMes = "Febrero";    |FINSI;
                 |SI nMes = 3;  aMes = "Marzo";      |FINSI;
                 |SI nMes = 4;  aMes = "Abril";      |FINSI;
                 |SI nMes = 5;  aMes = "Mayo";       |FINSI;
                 |SI nMes = 6;  aMes = "Junio";      |FINSI;
                 |SI nMes = 7;  aMes = "Julio";      |FINSI;
                 |SI nMes = 8;  aMes = "Agosto";     |FINSI;
                 |SI nMes = 9;  aMes = "Septiembre"; |FINSI;
                 |SI nMes = 10;  aMes = "Octubre";    |FINSI;
                 |SI nMes = 11;  aMes = "Noviembre";  |FINSI;
                 |SI nMes = 12;  aMes = "Diciembre";  |FINSI;

                 |SI #gotipoho#11 = "S"; aAlfa = aAlfa + aMes; |FINSI;
                 |SI #gotipoho#9  = "S"; aAlfa = aAlfa + " " + #gopaexca#0; |QBF aAlfa; |FINSI;
                 |SI #gotipoho#10 = "S"; aAlfa = aAlfa + " " + #gopaexca#1; |QBF aAlfa; |FINSI;
                 #caenlac@#7 = aAlfa;
                 #caenlac@#8 = "H";
                 #caenlac@#9 = #gopaexli#17;
                 #caenlac@#37 = #goparame#85;
                 #caenlac@#38 = #goparame#86;
                 #caenlac@#39 = #gopaexli#5;
                 |GRABA 020#caenlac@.n;
              |FINSI;

              |SI nSwError = 0;
                 |HAZ CogeVersion;
                 aAlfa = #goparame#84; |QBF aAlfa;
                 aAlfa = aAlfa + "fich/" + (("00000" + #goparame#85) % -105) + #goparame#86 + "/";
                 fich_alta = aAlfa;
                 aAlfa1 = #goparame#84; |QBF aAlfa1;
                 aAlfa1 = aAlfa1 - "contagen";
                 |SI FSalida ! 0;
                    aAlfa1 = ":contagen/dsapunte.tab;";
                 |SINO;
                    aAlfa1 = ":agicont/dsapunte.tab;";
                 |FINSI;
                 enNoModif = 100;
                 aAlfa = aAlfa1 + aAlfa + ",pu" + Usuario;
                 |CIERRA #caenlac@;
                 |SUB_EJECUTA_NP aAlfa;
                 |ABRE #caenlac@; |LEE 000#caenlac@.c;
              |FINSI;
              |CIERRA #agifa722;
              |CIERRA #camasic@; |DESCARGA_DEF #camasic@;
              |CIERRA #caconas@; |DESCARGA_DEF #caconas@;
              |CIERRA #caenlac@; |DELINDEX #caenlac@; |DESCARGA_DEF #caenlac@;
           |FINSI;
        |FINSI;
     |SINO;
        |CIERRA #goparame; |CIERRA #gotipoho; |ACABA;
     |FINSI;

     |CIERRA #gotipoho; |CIERRA #goparame;
|FPRC;

|PROCESO Tipo13; |TIPO 13;
     |ABRE #100; |LEE 000#100p; |CIERRA #100;
     |SI #100#141 = "O";
          |ATRI R; |PINTA 1017, " O.T.      "; |ATRI 0;
          |ATRI R; |PINTA 1029, " O.E.       "; |ATRI 0;
     |FINSI;
|FPRC;

|PROCESO Linea; |TIPO 0;
     aAntes = #1#20 + #1#5 + #1#6 + #1#7 + #1#8 + #1#9;
|FPRC;

|PROCESO Observa; |TIPO 11;
     |SI FSalida = 11;
          |SI #1#24 = 0;
               |MENAV "0000Debe de introducir antes la linea...";
          |SINO;
               eaSerie = #1#7;  ||#goptrbli#20;
               enNumero = #1#8; ||#goptrbli#21;
               efFecha = #0#2;  ||#goptrbli#2;
               enLinea = #1#24; ||#goptrbli#3;
               |SUB_EJECUTA_NP "goptrcom";
          |FINSI;
          |ERROR;
     |FINSI;
|FPRC;
