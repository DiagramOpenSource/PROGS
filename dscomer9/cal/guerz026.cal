|FICHEROS;
     guerz026 #0;
     gopartia #1;
     gomantho #2;
     gomantl1 #3;
     gopre001 #4;
     gopre002 #5;
     gopre003 #6;
     agifa029 #29;
     agifa077 #77;
     agifa080 #80;
     gomatljn #90;
     goparame #100;
     gopartia@;
|FIN;

|VARIABLES;
     &Tempo = "";
     nExpe = 0;
     nPre = 0;
     aSerPre = "";
     aParti = "";
     aDesParti = "";
     aCapi = "";
     nConta = 0;
     aAlfa = "";
     nLin = 0;
     aSerAlba = "";
     nNumAlba = 0;
|FIN;

|PROCESO TotalGopartia;
     #90#9 = #90#9 + #1#14;
     #90#10 = #90#10 + #1#25;
     #90#11 = #90#11 + #1#13;
     #90#12 = #90#12 + #1#24;
|FPRC;

|DEFBUCLE TotalGopartia;
     #1#1;
     ;
     "M", aSerAlba, nNumAlba, 001, 001;
     "M", aSerAlba, nNumAlba, 999, 999;
     ;
     NULL, TotalGopartia;
|FIN;

|PROCESO Crea_gomatljn;
     |SELECT #4#90;
     #90#5 = #gopartia@#4;
     #90#6 = #gopartia@#5;
     |LEE 000#90=;
     |SI FSalida = 0; |ACABA; |FINSI;

     |SELECT #1#90;
     #90#0 = #gopartia@#0;
     #90#1 = #gopartia@#1;
     #90#2 = 9999;
     |LEE 000#90];
     |SI FSalida = 0;
          |LEE 000#90a;
     |SINO;
          |LEE 000#90u;
     |FINSI;
     |SI FSalida = 0; |Y #90#0 = #gopartia@#0; |Y #90#1 = #gopartia@#1;
          nLin = #90#2 + 1;
     |SINO;
          nLin = 1;
     |FINSI;

     #77#50 = #gopartia@#4;
     #77#0 = #gopartia@#5;
     |LEE 020#77=;

     |DDEFECTO #90;
     #90#0 = #gopartia@#0;
     #90#1 = #gopartia@#1;
     #90#2 = nLin;
     #90#3 = #77#1;
     #90#4 = #77#54;
     #90#5 = #77#50;
     #90#6 = #77#0;
     #90#7 = #77#3;
     #90#8 = #77#4;

     aSerAlba = #77#50;
     nNumAlba = #77#0;
     |BUCLE TotalGopartia;

     #90#14 = #gopartia@#2;
     #90#15 = #gopartia@#3;
     |GRABA 020#90n;
|FPRC;

|DEFBUCLE Crea_gomatljn;
     #gopartia@#1005;
     ;
     " ", "     ", 000000, 000, 000;
     "z", "zzzzz", 999999, 999, 999;
     ;
     NULL, Crea_gomatljn;;
|FIN;

|PROCESO Almacen;
     |DDEFECTO #29;
     #29#0 = #1#17;
     |LEE 000#29=;
|FPRC;

|PROCESO Presupuesto;
     #4#0 = aSerPre;
     #4#1 = nPre;
     |LEE 000#4=;
     |SI FSalida = 0;
          #5#0 = #4#0;
          #5#1 = #4#1;
          #5#2 = 0;
          |LEE 000#5];
          |SI FSalida = 0; |Y #5#0 = #4#0; |Y #5#1 = #4#1;
               aCapi = #5#12;

               #6#0 = #5#0;
               #6#1 = #5#1;
               #6#2 = #5#12;
               #6#3 = 0;
               |LEE 000#6];
               |SI FSalida = 0; |Y #6#0 = #5#0; |Y #6#1 = #5#1; |Y #6#2 = #5#12;
                    aParti = #6#4;
                    aDesParti = #6#5;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Expediente;
     #2#0 = #1#2;
     #2#1 = 0;
     |LEE 000#2];
     |SI #2#0 = #1#2;
          nExpe = #2#1;

          #3#0 = #2#0;
          #3#1 = #2#1;
          #3#2 = 0;
          |LEE 000#3];
          |SI FSalida = 0; |Y #3#0 = #2#0; |Y #3#1 = #2#1;
               aSerPre = #3#3;
               nPre = #3#4;
          |FINSI;
     |SINO;
          |DDEFECTO #2;
     |FINSI;
|FPRC;

|PROCESO agifa077;
     |SI #100#141 = "O";
          aAlfa = #77#34; |QBF aAlfa;
          |SI aAlfa = "PE"; |ERROR; |FINSI;
     |FINSI;
|FPRC;

|PROCESO agifa080;
     nExpe = 0;
     nPre = 0;
     aSerPre = "";
     aParti = "";
     aDesParti = "";
     aCapi = "";

     |DDEFECTO #1;
     #1#34 = "C";
     #1#4 = #80#27;
     #1#5 = #80#0;
     #1#6 = #80#1;
     #1#7 = 1;
     |LEE 000#1=;
     |SI FSalida = 0;  |ACABA;  |FINSI;

     |DDEFECTO #1;
     #1#34 = "M";
     #1#4 = #80#27;
     #1#5 = #80#0;
     #1#6 = #80#1;
     #1#7 = 1;
     |LEE 000#1=;
     |SI FSalida ! 0;
          #1#28 = #77#1;
          #1#21 = "EUR";
          #1#31 = "N";
          #1#2 = #80#27;
          |HAZ Expediente;
          |HAZ Presupuesto;
          #1#3 = nExpe;
          #1#0 = aSerPre;
          #1#1 = nPre;
          #1#15 = #2#2; ||Cli
          #1#16 = #2#8; ||Nom
          #1#33 = aCapi;
          #1#8 = aParti;
          #1#9 = aDesParti;
          #1#17 = #80#27; ||Almacen
          |HAZ Almacen;
          #1#18 = #29#1; ||Des Alm
          #1#20 = #80#2;
          #1#30 = #80#4;
          #1#26 = "AUT";
          #1#27 = "31.01.2003";
          #1#10 = #80#5; ||Canti
          #1#26 = #80#5; ||Canti2
          #1#41 = #80#6; ||Precio
          #1#49 = #80#6;
          #1#42 = #80#8; ||Dto
          #1#50 = #80#8;
          #1#43 = #80#26; ||Dto2
          #1#51 = #80#26;
          #1#44 = #77#5 + #77#32 + #77#7; ||DtoC
          #1#52 = #77#5 + #77#32 + #77#7;
          #1#12 = ((#1#41 < #1#42) < #1#43) < #1#44;
          #1#23 = ((#1#41 < #1#42) < #1#43) < #1#44;
          #1#14 = #80#9;
          #1#25 = #80#9;
          |GRABA 020#1n;

          nConta = nConta + 1;

          |SALVA_DATOS #1;
          |REPON_DATOS #gopartia@;
          |GRABA 020#gopartia@.n;
     |FINSI;
|FPRC;

|DEFBUCLE agifa077;
     #77#3;
     ;
     "!     ", #0#2, #0#0, 000001;
     "zzzzzz", #0#3, #0#1, 999999;
     ;
     NULL, agifa077, agifa080;
|FIN;

|PROCESO Tipo3; |TIPO 3;
     |ABRE #100; |LEE 000#100p; |CIERRA #100;

     |DDEF aAlfa;
     aAlfa = aAlfa + "gopartia";
     |CARGA_DEF aAlfa, gopartia@;

     |HAZ CreaTempo;
     |NOME_DAT #gopartia@#Tempo#; |DELINDEX #gopartia@;
     |ABRET #gopartia@;

     |ABRE #29;
     |ABRE #6;
     |ABRE #5;
     |ABRE #4;
     |ABRE #3;
     |ABRE #2;
     |ABRE #1;
     |BUCLE agifa077;
     |CIERRA #1;
     |CIERRA #2;
     |CIERRA #3;
     |CIERRA #4;
     |CIERRA #5;
     |CIERRA #6;
     |CIERRA #29;
     |SI nConta > 0;
          |ABRE #77;
          |ABRE #90;
          |BUCLE Crea_gomatljn;
          |CIERRA #90;
          |CIERRA #77;

          aAlfa = "0000Creados " + nConta + " registros...";
          |MENAV aAlfa;

          |LEE 000#gopartia@.p;
          |CONSULTA_CLAVE #1#gopartia@;
     |FINSI;

     |CIERRAT #gopartia@;
     |HAZ BoraTempo; |DELINDEX #gopartia@;
     |DESCARGA_DEF #gopartia@;
|FPRC;
