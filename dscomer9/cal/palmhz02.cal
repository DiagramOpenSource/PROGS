|FICHEROS;
     palmhz02 #0;
     palmhm02 #2;
     agifa019 #19;
     agifa029 #29;  || Alma
     dsm00055 #55;
     agifa077 #77;
     agifa080 #80;
     dsm00120 #120; || Histo Inv C
     dsm00121 #121; || Histo Inv L
     dsm00233 #233; || Tipo Alma
     agifa502 #502;
|FIN;

|VARIABLES;
     &enTipo = 0;
     fFecha = @;
     aDFecha = "";
     aHFecha = "";
     aFechaAnt = "";
     f = @;
     aMes = "";
     aAlfa = "";
     aUltMes = "";
     nMes = 0;
     nA¤o = 0;
|FIN;

|PROCESO palmhm02;
     |PRINT;
|FPRC;

|DEFBUCLE palmhm02;
     #2#1;
     ;
     #0#0, #0#1;
     #0#0, #0#1;
     ;
     NULL, palmhm02;
|FIN;

|PROCESO dsm00055;
     |DDEFECTO #19;
     #19#0 = #55#0;
     |LEE 000#19=;

     |DDEFECTO #29;
     #29#0 = #19#161;    || Alma compras
     |LEE 000#29=;
     |SI #29#6 = #0#2;   || Alma banquete
          |PRINT;
     |FINSI;
|FPRC;

|DEFBUCLE dsm00055;
     #55#1;
     ;
     "     ", 000001, 00001;
     "zzzzz", 999999, 99999;
     ;
     NULL, dsm00055;
|FIN;

|PROCESO agifa080;
     |DDEFECTO #29;
     #29#0 = #80#3;
     |LEE 000#29=;
     |SI #29#6 = #0#3; |O #29#6 = #0#2;
          |PRINT;
     |FINSI;
|FPRC;

|DEFBUCLE agifa077;
     #77#3;
     ;
     "      ", aDFecha, "     ", 000001;
     "zzzzzz", aHFecha, "zzzzz", 999999;
     ;
     NULL, NULL,  agifa080;
|FIN;

|PROCESO agifa502;
     |PRINT;
|FPRC;

|DEFBUCLE agifa502;
     #502#3;
     ;
     aDFecha, "   ", "                    ";
     aHFecha, "zzz", "zzzzzzzzzzzzzzzzzzzz";
     ;
     NULL, agifa502;
|FIN;

|PROCESO dsm00121;
     |DDEFECTO #29;
     #29#0 = #121#3;
     |LEE 000#29=;
     |SI #29#6 = #0#3;   || Alma economato
          |PRINT;
     |FINSI;
|FPRC;

|DEFBUCLE dsm00121;
     #121#1;
     ;
     fFecha, "                    ", 00001, "               ";
     fFecha, "zzzzzzzzzzzzzzzzzzzz", 99999, "zzzzzzzzzzzzzzz";
     ;
     NULL, dsm00121;
|FIN;

|PROCESO dsm00120;
     aMes = #120#0 % 402;
     |SI aUltMes ! ""; |Y aUltMes ! aMes;
          |BUCLE dsm00121;
     |FINSI;
     aUltMes = aMes;
     fFecha = #120#0;
|FPRC;

|DEFBUCLE dsm00120;
     #120#1;
     ;
     aDFecha;
     aHFecha;
     ;
     NULL, dsm00120;
|FIN;


|PROCESO UltDiaMes;
     aMes = aHFecha % 402;
     |PARA f = aHFecha; |SI; |HACIENDO f = f + 1;
          aAlfa = f % 402;
          |SI aAlfa ! aMes; |SAL; |FINSI;
          aHFecha = f;
     |SIGUE;
|FPRC;

|PROCESO FechaAnt;
     |SI #0#0 = 1;
          nMes = 12;
          nA¤o = #0#1 - 1;
     |SINO;
          nMes = #0#0 - 1;
          nA¤o = #0#1;
     |FINSI;
     aFechaAnt = "01." + (("00" + nMes) % -102) + "." + nA¤o;
|FPRC;

|PROCESO DefA¤o; |TIPO 7;
     |SI #0#1 = 0;
          fFecha = ~;
          #0#1 = (A\(fFecha % -104));
          #0#0 = (A\(fFecha % 402)); |PINTA #0#0;
     |FINSI;
|FPRC;

|PROCESO Tipo3; |TIPO 3;
     Impresora = "Crystal Reports";
     |IMPRE 0;
     |SI FSalida = 0;
          |INFOR "palmhz02";
          |SI FSalida = 0;
               aDFecha = (A\("01." + (("00" + #0#0) % -102) + "." + #0#1));
               aHFecha = (A\("01." + (("00" + #0#0) % -102) + "." + #0#1));
               |HAZ UltDiaMes;

               aUltMes = "";
               enTipo = 1;
               |ABRE #29;
               |BUCLE dsm00120;
               |SI aUltMes ! ""; |BUCLE dsm00121; |FINSI;
               |CIERRA #29;

               enTipo = 2;
               |BUCLE agifa502;

               |HAZ FechaAnt;
               aDFecha = aFechaAnt;
               aHFecha = aFechaAnt;
               |HAZ UltDiaMes;
               aUltMes = "";
               enTipo = 3;
               |ABRE #29;
               |BUCLE dsm00120;
               |SI aUltMes ! ""; |BUCLE dsm00121; |FINSI;

               aDFecha = "01." + (("00" + #0#0) % -102) + "." + #0#1;
               aHFecha = "01." + (("00" + #0#0) % -102) + "." + #0#1;
               |HAZ UltDiaMes;
               enTipo = 4;
               |BUCLE agifa077;

               enTipo = 5;
               |ABRE #19;
               |BUCLE dsm00055;
               |CIERRA #19;
               |CIERRA #29;

               |SI #0#4 = "S";
                    enTipo = 6;
                    |BUCLE palmhm02;
               |FINSI;

               |PIEINF;
               |FININF;
          |SINO;
               |MENAV "0000Error en informe 'palmhz02'";
          |FINSI;
          |FINIMP;
     |FINSI;
|FPRC;
