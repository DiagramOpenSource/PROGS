|FICHEROS;
     gatofe01 #0;
     gatofe02 #2;
     agifa501 #501;
     agifa502 #502;
|FIN;

|VARIABLES;
     &enSwVerifica = 0;
     i = 0;
     nEmp = 0;
     aEmp = "";
     aAlfa = "";
     aBase = "";
     fFecha = @;
     nConta = 0;
     aSer = "";
|FIN;

|PROCESO LinTiquet;
     |SI #502#7 ! 0;
          #2#4 = #2#4 + 1;
     |FINSI;
|FPRC;

|DEFBUCLE LinTiquet;
     #502#1;
     ;
     #501#36, #501#0, 001;
     #501#36, #501#0, 999;
     ;
     NULL, LinTiquet;
|FIN;

|PROCESO Tiquet;
     #2#0 = #501#14;
     |LEE 101#2=;
     |SI FSalida = 0;
          |SI enSwVerifica = 1;
               #2#5 = #2#5 + #501#40; ||Tarjeta
               #2#6 = #2#6 + #501#38; ||Efectivo
               #2#7 = #2#7 + #501#9;  ||Total;
               |BUCLE LinTiquet;
          |SINO;
               #2#8 = #2#8 + #501#40; ||Tarjeta
               #2#9 = #2#9 + #501#38; ||Efectivo
               #2#10 = #2#10 + #501#9;||Total;
          |FINSI;
          |GRABA 020#2a;
          |LIBERA #2;
     |FINSI;
|FPRC;

|DEFBUCLE Tiquet;
     #501#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Tiquet;
|FIN;

|PROCESO LeeTiquets;
     |DBASE aBase;
     |PARA i = 3; |SI i [ 12; |HACIENDO i = i + 1;
          nEmp = #0i;
          |SI nEmp > 0;
               aEmp = ("00000" + nEmp) % -105;
               aAlfa = aBase + "fich/" + aEmp + "/";
               |PATH_DAT #501#aAlfa#;
               |PATH_DAT #502#aAlfa#;
               |ABRE #501;
               |BUCLE Tiquet;
               |CIERRA #501;
          |FINSI;
     |SIGUE;
|FPRC;

|PROCESO FechaSin;
     nConta = 0;
     fFecha = "01.01.0000";
     |LEE 000#2p;
     |PARA; |SI FSalida = 0; |HACIENDO;
          |SI #2#4 = 0; |Y fFecha ! "01.01.0000";
               |DBASE aBase;
               |PARA i = 3; |SI i [ 12; |HACIENDO i = i + 1;
                    nEmp = #0i;
                    |SI nEmp > 0;
                         aEmp = ("00000" + nEmp) % -105;
                         aAlfa = aBase + "fich/" + aEmp + "/";
                         |PATH_DAT #501#aAlfa#;
                         |PATH_DAT #502#aAlfa#;
                         |ABRE #501; |SELECT #3#501;
                         |DDEFECTO #501;
                         #501#14 = #2#0; ||fFecha;
                         |LEE 000#501];
                         |SI FSalida = 0;
                              |LEE 000#501a;
                         |SINO;
                              |LEE 000#501u;
                         |FINSI;
                         |SI FSalida = 0; |Y #501#14 = fFecha;
                              |DDEFECTO #501;
                              #501#14 = fFecha;
                              |LEE 000#501];
                              |PARA; |SI FSalida = 0; |Y #501#14 = fFecha; |HACIENDO;
                                   |SI nConta < #501#0;
                                        nConta = #501#0;
                                        aSer = #501#36;
                                   |FINSI;
                                   |LEE 000#501s;
                              |SIGUE;

                              |SELECT #1#501;
                              #501#36 = aSer;
                              #501#0 = nConta;
                              |LEE 121#501=;
                              |SI FSalida = 0;
                                   #501#14 = #2#0;
                                   |GRABA 020#501a;
                                   |LIBERA #501;

                                   #2#4 = 1;
                                   |GRABA 020#2a;
                              |FINSI;

                         |FINSI;
                         |CIERRA #501;
                    |FINSI;
               |SIGUE;
          |FINSI;
          fFecha = #2#0;
          |LEE 000#2s;
     |SIGUE;
|FPRC;
