                     COMPRAS + ENTRADAS STOCK + FABRICA
|FICHEROS;
     agifa081 #81;
     agifa077 #77;
     agifa078 #78;
     agifa079 #79;
     agifa090 #90;
     dsm00138 #138;
     agifa027 #27;
     agifa142 #142;
     agifa212 #212;
     Referen@;
|FIN;

|VARIABLES;
     aModulo = "";
     &enMenuAuto = 0;
     &enSwMenu      = 0;
     &enCodigo      = 0;
     &enCodAlbNegro = 0;
     &eaSerie       = "";
     &enSwSimula    = 0;

 {-1}aMenu     = "";
     aMenu1    = "2400";
     aMenu2    = "1";
     aMenu3    = " Contador: ";
     aMenu4    = "AM";
     aMenu5    = " Automatico ";
     aMenu6    = " Manual ";
     aClave    = "";
     aSerie    = "";
     aAlfa     = "";
     nConta    = 0;
     nNume     = 0;
     nModo     = 0;
     nSalMenu  = 0;
     aDef = "";
     aDat = "";
     aEmp = "";
|FIN;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO CompruContaC;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo ! 1; |ACABA; |FINSI;

     |SI #142#137 = "F"; |ACABA; |FINSI;

     |SI #142#136 ! "S";
          aAlfa = ("000000" + nConta ) % -106;
          |SI #142#136 = "N";
               |SI nNume > nConta;
                    aAlfa = "0000Numero incorrecto. No puede ser mayor de " + aAlfa;
                    |MENAV aAlfa;
                    |ERROR;
               |FINSI;
          |SINO;
               |SI nNume > nConta;
                    aAlfa = "0000Numero superior a " + aAlfa;
                    |MENAV aAlfa;
                    |CONFI "0000N풢sta Seguro?";
                    |SI FSalida ! 0; |ERROR; |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO ContadorFicC;
     |ABRE #142; |LEE 000#142p; |CIERRA #142;

     |SI enSwMenu = 0;
          |MENU aMenu
          nSalMenu = FSalida;
          enMenuAuto = FSalida;
          |SI nSalMenu ! 1; |ACABA; |FINSI;
     |FINSI;

     |SI aClave = "vfacturo";
          |HAZ EsMalpesa;
          |SI FSalida = 0;
               |HAZ MalpeContaFC;
               |ACABA;
          |FINSI;
     |FINSI;

     |SI #142#137 = "F";
          |ABRE #27;
          #27#2 = aSerie;
          #27#0 = aClave;
          |LEE  101#27=;
          |SI FSalida ! 0;
               #27#1 = 1;
               |GRABA 020#27b;
          |FINSI;
          nConta = #27#1;
          |SI enSwSimula = 0;       ||Lo usa la adj. de facturas ventas
               #27#1 = #27#1 + 1;
               |GRABA 020#27a;
          |FINSI;
          |CIERRA #27;
     |FINSI;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO ContaPC7; |TIPO 7;
     |SI enSwMenu = 0;
          nModo = (FEntrada/100) !  0;
          |SI nModo ! 1; |ACABA; |FINSI;
     |FINSI;

     nConta = 1;
     aSerie = #81#25;
     #81#0 = 999999;
     |LEE 000#81];
     |SI FSalida = 0;
          |LEE 000#81a;
     |SINO;
          |LEE 000#81u;
     |FINSI;
     |SI FSalida  = 0; |Y #81#25 = aSerie;
          nConta = #81#0 + 1;
     |FINSI;

     aClave = "vpedcom";
     |HAZ ContadorFicC;

     |DDEFECTO #81;
     #81#25 = aSerie;
     |SI enSwMenu = 0;       ||llamado por agifa166
          |SI nSalMenu = 1;
               #81#0 = nConta;
               |PTEC 802;
          |SINO;
               #81#0 = 1;
          |FINSI;
     |SINO;
          #81#0 = nConta;
     |FINSI;
     enSwMenu = 0;
|FPRC;

|PROCESO ContaPC0; |TIPO 0;
     nNume = #81#0;
     |HAZ CompruContaC;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO ContaAC7; |TIPO 7;
     |SI enSwMenu = 0;
          nModo = (FEntrada/100) !  0;
          |SI nModo ! 1; |ACABA; |FINSI;
     |FINSI;
     nConta = 1;
     aSerie = #77#50;
     #77#0 = 999999;
     |LEE 000#77];
     |SI FSalida = 0;
          |LEE 000#77a;
     |SINO;
          |LEE 000#77u;
     |FINSI;
     |SI FSalida  = 0; |Y #77#50 = aSerie;
          nConta = #77#0 + 1;
     |FINSI;

     aClave = "valbaco";
     |HAZ ContadorFicC;

     |DDEFECTO #77;
     #77#50 = aSerie;
     |SI enSwMenu = 0;       ||
          |SI nSalMenu = 1;
               #77#0 = nConta;
               |PTEC 802;
          |SINO;
               #77#0 = 1;
          |FINSI;
     |SINO;
          #77#0 = nConta;
     |FINSI;
     enSwMenu = 0;
|FPRC;

|PROCESO ContaAC0; |TIPO 0;
     nNume = #77#0;
     |HAZ CompruContaC;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO ContaFC7; |TIPO 7;
     |SI enSwMenu = 0;
          nModo = (FEntrada/100) !  0;
          |SI nModo ! 1; |ACABA; |FINSI;
     |FINSI;
     nConta = 1;
     aSerie = #79#66;
     #79#0 = 999999;
     |LEE 000#79];
     |SI FSalida = 0;
          |LEE 000#79a;
     |SINO;
          |LEE 000#79u;
     |FINSI;
     |SI FSalida  = 0; |Y #79#66 = aSerie;
          nConta = #79#0 + 1;
     |FINSI;

     aClave = "vfacturo";
     |HAZ ContadorFicC;

     |DDEFECTO #79;
     #79#66 = aSerie;
     |SI enSwMenu = 0;       ||
          |SI nSalMenu = 1;
               #79#0 = nConta;
               |PTEC 802;
          |SINO;
               #79#0 = 1;
          |FINSI;
     |SINO;
          #79#0 = nConta;
     |FINSI;
     enSwMenu = 0;
|FPRC;

|PROCESO ContaFC0; |TIPO 0;
     nNume = #79#0;
     |HAZ CompruContaC;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO ContaOF7; |TIPO 7;
     |SI enSwMenu = 0;
          nModo = (FEntrada/100) !  0;
          |SI nModo ! 1; |ACABA; |FINSI;
     |FINSI;

     nConta = 1;
     aSerie = #90#20;
     #90#0 = 999999;
     |LEE 000#90];
     |SI FSalida = 0;
          |LEE 000#90a;
     |SINO;
          |LEE 000#90u;
     |FINSI;
     |SI FSalida  = 0; |Y aSerie = #90#20;
          nConta = #90#0 + 1;
     |FINSI;

     aClave = "ordenfab";
     |HAZ ContadorFicC;

     |DDEFECTO #90;
     #90#20 = aSerie;
     |SI enSwMenu = 0;       ||
          |SI nSalMenu = 1;
               #90#0 = nConta;
               |PTEC 802;
          |SINO;
               #90#0 = 1;
          |FINSI;
     |SINO;
          #90#0 = nConta;
     |FINSI;
     enSwMenu = 0;
|FPRC;

|PROCESO ContaOF0; |TIPO 0;
     nNume = #90#0;
     |HAZ CompruContaC;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO DefSerCom; |TIPO 7;
     |ABRE #142; |LEE 000#142p; |CIERRA #142;
     |SI #142#185 = "S";
          |MODULO aAlfa;
          |SI aAlfa = "agifa081"; #81#25 = #142#192; |FINSI;
          |SI aAlfa = "agifa077"; #77#50 = #142#193; |FINSI;
          |SI aAlfa = "agifa212"; #212#50 = #142#193; |FINSI;
          |SI aAlfa = "agifa079"; #79#66 = #142#194; |FINSI;
          |SI aAlfa = "agifa078"; #78#66 = #142#194; |FINSI;
          |SI aAlfa = "dsm00138"; #78#66 = #142#193; |FINSI; ||depo=alba

          |SI aAlfa = "ortom001"; #78#66 = #142#193; |FINSI; ||adj=depo
     |FINSI;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO ContaDC7; |TIPO 7;
     |SI enSwMenu = 0;
          nModo = (FEntrada/100) !  0;
          |SI nModo ! 1; |ACABA; |FINSI;
     |FINSI;

     nConta = 1;
     aSerie = #138#50;
     #138#0 = 999999;
     |LEE 000#138];
     |SI FSalida = 0;
          |LEE 000#138a;
     |SINO;
          |LEE 000#138u;
     |FINSI;
     |SI FSalida  = 0; |Y #138#50 = aSerie;
          nConta = #138#0 + 1;
     |FINSI;

     aClave = "vdepocom";
     |HAZ ContadorFicC;

     |DDEFECTO #138;
     #138#50 = aSerie;
     |SI enSwMenu = 0;       ||
          |SI nSalMenu = 1;
               #138#0 = nConta;
               |PTEC 802;
          |SINO;
               #138#0 = 1;
          |FINSI;
     |SINO;
          #138#0 = nConta;
     |FINSI;
     enSwMenu = 0;
|FPRC;

|PROCESO ContaDC0; |TIPO 0;
     nNume = #138#0;
     |HAZ CompruContaC;
|FPRC;

|PROCESO ModiDiviCom; |TIPO 7;
     |MODULO aModulo;
     |DDEF aAlfa; aAlfa = aAlfa + "dsm00279";
     |CARGA_DEF  aAlfa, Referen@;
     |SI FSalida = 0;
          |ABRE #Referen@; |LEE 000#Referen@.p; |CIERRA #Referen@;
          |SI #Referen@#14 = "N";
               |SI aModulo = "agifa081"; |C_M #81#27, 1, "N"; |C_M #81#28, 1, "N"; |C_M #81#29, 1, "N"; |FINSI;
               |SI aModulo = "dsm00138"; |C_M #138#56, 1, "N"; |C_M #138#57, 1, "N"; |C_M #138#58, 1, "N"; |C_M #138#59, 1, "N"; |FINSI;
               |SI aModulo = "dsm00142"; |C_M #138#56, 1, "N"; |C_M #138#57, 1, "N"; |C_M #138#58, 1, "N"; |C_M #138#59, 1, "N"; |FINSI;
               |SI aModulo = "agifa077"; |C_M #77#56, 1, "N"; |C_M #77#57, 1, "N"; |C_M #77#58, 1, "N"; |C_M #77#59, 1, "N"; |FINSI;
               |SI aModulo = "agifa212"; |C_M #77#56, 1, "N"; |C_M #77#57, 1, "N"; |C_M #77#58, 1, "N"; |C_M #77#59, 1, "N"; |FINSI;
               |SI aModulo = "dsm00140"; |C_M #77#56, 1, "N"; |C_M #77#57, 1, "N"; |C_M #77#58, 1, "N"; |C_M #77#59, 1, "N"; |FINSI;
          |FINSI;
          |DESCARGA_DEF #Referen@;
     |FINSI;
|FPRC;
----------------------------------
|PROCESO MalpeContaFC;
     |DDEF aAlfa;
     aAlfa = aAlfa + "malpe081";
     |CARGA_DEF aAlfa, Referen@;
     |SI FSalida = 0;
          |ABRE #Referen@; |LEE 000#Referen@.p; |CIERRA #Referen@;
          aEmp = (("00000" + #Referen@#23) % -105) + #Referen@#24;
          |DESCARGA_DEF #Referen@;
     |SINO;
          |MENAV "0000ERROR al cargar 'malpe081";
     |FINSI;
     |DBASS aAlfa;
     aDef = aAlfa + "contagen/def/caivases";
     aDat = aAlfa + "contagen/fich/" + aEmp + "/";
     |CARGA_DEF aDef, Referen@;
     |SI FSalida = 0;
          |PATH_DAT #Referen@#aDat#;
          |ABRE #Referen@;
          #Referen@#0 = aSerie;
          #Referen@#1 = "S";
          |LEE 101#Referen@.=;
          |SI FSalida = 0;
               nConta = #Referen@#3;
               |SI enSwSimula = 0;       ||Lo usa la adj. de facturas ventas
                    #Referen@#3 = #Referen@#3 + #Referen@#4;
               |FINSI;
               |GRABA 020#Referen@.a;
          |SINO;
               |MENAV "0000No existe serie en contabilidad...";
               |SI enSwMenu = 0; |Y nSalMenu = 1;
                    |PTEC 807;
               |FINSI;
          |FINSI;
          |CIERRA #Referen@;
          |DESCARGA_DEF #Referen@;
     |SINO;
          |MENAV "0000ERROR al cargar 'caivases'";
     |FINSI;
|FPRC;
