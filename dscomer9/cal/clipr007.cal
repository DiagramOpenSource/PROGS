 |FICHEROS;
     clipr007 #1; ||este def
     clipr079 #79;
     clipr006 #3;
     clipr001 #4;
     clipr059 #6; ||periodicidades
     clipr015 #7; ||centros de trabajo;
     clipr009 #27; ||contadores
     clipr074 #74;
     clipr077 #77;
     clipr054 #54;
     clipr080 #80;
     clipr081 #81;
     referen@;
|FIN;

|VARIABLES;
     &enTiva = 0;
     &efFiva = @;
     &eaDiva = "";
     &enIva = 0;
     &enRec = 0;
     nErr = 0;
     nForma = 0;
     nHay = 0
     aDef = "";
     aDoc = "";
     {1}aContiene = "";
     {-1}menu = "";
     menu1 = "2400";
     menu2 = "1";
     menu3 = "Opciones:  ";
     menu4 = "CIAF";
     menu5 = " Centros ";
     menu6 = " Imprimir ";
     menu7 = " Anexo ";
     menu8 = " Facturar Iniciales ";

     {-1}aMenuFac = "";
     aMenuFac1 = "2400";
     aMenuFac2 = "1";
     aMenuFac3 = "Facturar: ";
     aMenuFac4 = "SEHPl";
     aMenuFac5 = " Seguridad ";
     aMenuFac6 = " Ergonomia ";
     aMenuFac7 = " Higiene ";
     aMenuFac8 = " Psicologia ";
     aMenuFac9 = " Plan Prev.";

 clave1 = "";
 ii = 0;
 jj = 0;
 aSusti = "";
 nCentro = 0;
 aCentro = "";
 aActivi = "";
 aCnae = "";
 fecha = @;
 dias = 0;
 aPrograma = "";
 &aCon_Serie = "";
 &aCon_Clave = "";
 &nCon_Conta = 0;
 precio = 0;
 &nDeci_nDec_d = 0;
 aMoneda = "";
 nModo = 0;
 eaAlfa = "";
 nPosi = 0;
 aCadena = "";
 aLen = "";
 nLen = 0;
 nCampo = 0;
 aCaracter = "";
 aIPRemoto = "";
 aOrigen = "";
 aDestino = "";
 documento = "";
 aAlfa = "";
 nWord = 0;
 aAsigna = "";
 fFecha = @00.00.0000;
 aFecha = "";
 pp = "";
 fFech1 = @;
|FIN;

|PROCESO PonIVA; |TIPO 0;
     enTiva = #1#11;
     efFiva = #1#2;
     |HAZ SacaIVA;

     #1#20 = enIva; |PINTA #1#20;
     |HAZ totales;
|FPRC;

|CALCULO totales;
 #1#10 = #1#7 + #1#49 + #1#68 + #1#70 + #1#72 + #1#73 + #1#75 + #1#76+ #1#77 + #1#78;
 #1#10 = #1#10 + #1#85 + #1#86 + #1#87 + #1#88 + #1#89;
 #1#21 = #1#10 % #1#20;
 #1#23 = #1#10 + #1#21;
 #1#13 = #1#10 % #1#12;
 #1#24 = #1#23 - #1#13;
 |PINTA #1#10;
 |PINTA #1#21;
 |PINTA #1#13;
 |PINTA #1#23;
 |PINTA #1#24;
|FCAL;

|PROCESO HistoFac;
     nHay = 1;
     |ERROR10;
|FPRC;

|DEFBUCLE HistoFac;
     #81#1;
     ;
     #1#0, #1#1, 1, 001;
     #1#0, #1#1, 9, 999;
     ;
     NULL, HistoFac;
|FIN;

|CALCULO baja;|TIPO 2;
     nModo = (FEntrada/100)!0;
     nForma = 0 +. 1;

     |SI nModo = 3;
          nHay = 0;
          |BUCLE HistoFac;
          |SI nHay ! 0;
               |SI nForma = -1;
                    |MENAV "0000Hay facturas de evaluacion inicial realizadas...";
               |FINSI;
               |ERROR; |ACABA;
          |FINSI;
     |FINSI;

     |ABRE #4;
     #4#0 = #1#3;
     |LEE 101#4=;
     |SI FSalida = 0;
          #4#59 = #4#59 +. 1;
          |GRABA 020#4a;
     |FINSI;
     |CIERRA #4;


     |ABRE #3;
     #3#0 = #1#25;
     #3#1 = #1#26;
     |LEE 101#3=;
     |SI FSalida = 0;
          |SI nModo = 3;
               #3#5 = "01.01.0000";
          |SINO;
               #3#5 = #1#2;
          |FINSI;
          |GRABA 020#3a;
     |FINSI;
     |CIERRA #3;
|FCAL;

|PROCESO QuitaRaros1;
     |QBF eaAlfa;
     aCadena = "";
     aLen    = eaAlfa % 0;
     nLen    = aLen;
     |PARA nCampo = 1;  |SI nCampo [ nLen;  |HACIENDO nCampo = nCampo + 1;
           nPosi = (100 * nCampo) + 1;
           aCaracter = eaAlfa % nPosi;
           |SI aCaracter = "¥";  aCaracter = &209; |FINSI;
           |SI aCaracter = "¤";  aCaracter = &241; |FINSI;
           |SI aCaracter = " ";  aCaracter = &225; |FINSI;
           |SI aCaracter = "‚";  aCaracter = &233; |FINSI;
           |SI aCaracter = "¡";  aCaracter = &237; |FINSI;
           |SI aCaracter = "¢";  aCaracter = &243; |FINSI;
           |SI aCaracter = "£";  aCaracter = &250; |FINSI;
           |SI aCaracter = "§";  aCaracter = &176; |FINSI;
           |SI aCaracter = "¦";  aCaracter = &170; |FINSI;
           aCadena = aCadena + aCaracter;
     |SIGUE;
     eaAlfa = aCadena;
|FPRC;

|PROCESO PonComas1;  || Sustituye el punto del decimal por una coma.
     |QBF eaAlfa;
     aCadena = "";
     aLen    = eaAlfa % 0;
     nLen    = aLen;
     |PARA nCampo = 1;  |SI nCampo [ nLen;  |HACIENDO nCampo = nCampo + 1;
           nPosi = (100 * nCampo) + 1;
           aCaracter = eaAlfa % nPosi;
           |SI aCaracter = ".";  aCaracter = ","; |FINSI;
           aCadena = aCadena + aCaracter;
     |SIGUE;
     eaAlfa = aCadena;
|FPRC;

|PROCESO EnviaFichero1;
     aIPRemoto = "";
     |IP_REMOTO aIPRemoto;  |QBT aIPRemoto;

     aContiene1 = aOrigen;
     |ESPECIFICA "MD5", aContiene;
     aDoc = FSalida;

     |SI aIPRemoto ! "";
          aContiene1 = aDestino;
          |ESPECIFICA "REMOTOMD5", aContiene;
          |SI aDoc ! FSalida;
               |MENAV "0000Se ha modificado el formato base del documento a imprimir. Se actualizara desde el servidor";
               |ENVIA_FICHERO aOrigen, aDestino;
          |FINSI;
     |SINO;
          aContiene1 = aDestino;
          |ESPECIFICA "MD5", aContiene;
          |SI aDoc ! FSalida;
               |MENAV "0000Se ha modificado el formato base del documento a imprimir. Se actualizara desde el servidor";
               |COPIA_FICHERO aOrigen, aDestino;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO CentrosCto0;
     nHay = 1;
     |PRINT;
|FPRC;

|DEFBUCLE CentrosCto0;
     #79#1;
     ;
     #1#0, #1#1, 1;
     #1#0, #1#1, 99;
     ;
     NULL, CentrosCto0;
|FIN;

|CALCULO Imprime1;
     Impresora = "CrystalReports";
     |IMPRE -1;
     |SI FSalida = 0;
          |SI #1#47 = 1;
               |INFOR "clip1007";
          |SINO;
               |INFOR "clipr007";
          |FINSI;
          |SI FSalida = 0;
               nHay = 0;
               |BUCLE CentrosCto0;
               |SI nHay = 0; |PRINT; |FINSI;
               |PIEINF;
               |FININF;
          |SINO;
               |MENAV "0000Error en informe 'clipr007'";
          |FINSI;
          |FINIMP;
     |FINSI;


/****************************** ANULADO
     fFecha = #1#2;
     fFecha = fFecha % 2;
     aFecha = fFecha;
     aFecha = aFecha % 1130;
                 || documento = "contrato.doc";
     documento = #1#48;
     |QBF documento;
     documento = documento + ".doc";
     |ABRE #3;
     #3#0 = #1#25;
     #3#1 = #1#26;
     |LEE 010#3=;
     |SI FSalida ! 0;|DDEFECTO #3;|FINSI;

     aAlfa = "C:/clipresa";
     |RMKDIR aAlfa;

     |DBASE aOrigen;   |QBF aOrigen;
     aOrigen = aOrigen + "documentos/";
     |RMKDIR aOrigen;

     |QBF documento;
     aOrigen   = aOrigen + documento;
     aDestino  = "C:/clipresa/presup.doc";

     |HAZ EnviaFichero1;

     |PUSHV 0501 2380;

     |ATRI S;  |PINTA 2320, "ASIGNANDO CAMPOS AL DOCUMENTO "; |ATRI s;

     nWord = 1;
     |WORD_ABRE nWord, aDestino;
     |WORD_PROPIEDADES nWord, "Visible", "NO";

     |ABRE #4;
     #4#0 = #1#3;
     |LEE 010#4=;
     |SI FSalida ! 0;|DDEFECTO #4;|FINSI;
     |LIBERA #4;
     |CIERRA #4;

     eaAlfa = #1#1; ||numero
     |HAZ QuitaRaros1;
     |WORD_ASIGNA_TEXTO nWord, "!#NUMERO", eaAlfa;

     eaAlfa = #1#0; ||serie
     |HAZ QuitaRaros1;
     |SI eaAlfa = "";eaAlfa = "00";|FINSI;
     |WORD_ASIGNA_TEXTO nWord, "!#SERIE", eaAlfa;

     eaAlfa = aFecha; ||fecha
     |HAZ QuitaRaros1;
     |WORD_ASIGNA_TEXTO nWord, "!#FECHA", eaAlfa;

     eaAlfa = #4#24; ||gerente
     |HAZ QuitaRaros1;
     |WORD_ASIGNA_TEXTO nWord, "!#DON1", eaAlfa;
     |WORD_ASIGNA_TEXTO nWord, "!#DON2", eaAlfa;
     |WORD_ASIGNA_TEXTO nWord, "!#FIRMA", eaAlfa;

     eaAlfa = #4#30; ||nif gerente
     |HAZ QuitaRaros1;
     |WORD_ASIGNA_TEXTO nWord, "!#DNI", eaAlfa;

     eaAlfa = #4#1; ||empresa
     |HAZ QuitaRaros1;
     |WORD_ASIGNA_TEXTO nWord, "!#EMPRE", eaAlfa;

     eaAlfa = #4#9; ||nif empresa
     |HAZ QuitaRaros1;
     |WORD_ASIGNA_TEXTO nWord, "!#CIF", eaAlfa;

     eaAlfa = #4#14; ||direccion empresa
     |HAZ QuitaRaros1;
     |WORD_ASIGNA_TEXTO nWord, "!#DIRECCION",eaAlfa;

     eaAlfa = #4#15; ||POBLACION empresa
     |HAZ QuitaRaros1;
     |WORD_ASIGNA_TEXTO nWord, "!#POBLACION", eaAlfa;

     eaAlfa = #4#31; ||escritura empresa
     |HAZ QuitaRaros1;
     |WORD_ASIGNA_TEXTO nWord, "!#ESCRITURA", eaAlfa;

     eaAlfa = #4#32; ||fecha escritura empresa
     |HAZ QuitaRaros1;
     |QBF eaAlfa;
     |SI eaAlfa = "";
       eaAlfa = "___________";
     |FINSI;
     |WORD_ASIGNA_TEXTO nWord, "!#FECHES", eaAlfa;

     eaAlfa = #4#33; ||protocolo escritura empresa
     |HAZ QuitaRaros1;
     |WORD_ASIGNA_TEXTO nWord, "!#PROTOC", eaAlfa;

     precio = #1#5 + #1#6;
     eaAlfa = precio; ||precio
     |HAZ QuitaRaros1;
     |WORD_ASIGNA_TEXTO nWord, "!#IMPORTE", eaAlfa;

     eaAlfa = #1#7; ||VigiSalud 1
     |HAZ QuitaRaros1;
     |WORD_ASIGNA_TEXTO nWord, "!#VIGISA1" , eaAlfa;

     eaAlfa = #1#49; ||VigiSalud 2
     |HAZ QuitaRaros1;
     |WORD_ASIGNA_TEXTO nWord, "!#VIGISA2" , eaAlfa;

     eaAlfa = #1#31; ||precio prorroga
     |HAZ QuitaRaros1;
     |WORD_ASIGNA_TEXTO nWord, "!#PRORROGA", eaAlfa;

     jj = 0;
     |PARA ii = 42;|SI ii [ 46;|HACIENDO ii = ii + 1;
          nCentro = #1ii;
          jj = jj  + 1;
          |HAZ LeeCentro;

          eaAlfa = aCentro;
          |HAZ QuitaRaros1;
          aSusti = jj;
          aSusti = "!#DIRCENTRO"+aSusti; |QBT aSusti;
          |WORD_ASIGNA_TEXTO nWord, aSusti, eaAlfa;

          eaAlfa = aActivi;
          |HAZ QuitaRaros1;
          aSusti = jj;
          aSusti = "!#ACCENTRO"+aSusti;
          |QBT aSusti;
          |WORD_ASIGNA_TEXTO nWord, aSusti, eaAlfa;

          eaAlfa = aCnae;
          |HAZ QuitaRaros1;
          aSusti = jj;
          aSusti = "!#CNAE"+aSusti; |QBF aSusti;
          |WORD_ASIGNA_TEXTO nWord, aSusti, eaAlfa;
     |SIGUE;
     |PARA ii = 50;|SI ii [ 54;|HACIENDO ii = ii + 1;
          nCentro = #1ii;
          jj = jj  + 1;
          |HAZ LeeCentro;

          eaAlfa = aCentro;
          |HAZ QuitaRaros1;
          aSusti = jj;
          aSusti = "!#DIRCENTRO"+aSusti; |QBT aSusti;
          |WORD_ASIGNA_TEXTO nWord, aSusti, eaAlfa;

          eaAlfa = aActivi;
          |HAZ QuitaRaros1;
          aSusti = jj;
          aSusti = "!#ACCENTRO"+aSusti;
          |QBT aSusti;
          |WORD_ASIGNA_TEXTO nWord, aSusti, eaAlfa;

          eaAlfa = aCnae;
          |HAZ QuitaRaros1;
          aSusti = jj;
          aSusti = "!#CNAE"+aSusti; |QBF aSusti;
          |WORD_ASIGNA_TEXTO nWord, aSusti, eaAlfa;
     |SIGUE;

     |WORD_PROPIEDADES nWord, "Visible", "SI";

     |WORD_IMPRIME nWord, "Dialogo";  ||Pide Impresora

     |PAUSA;
||     |SLEEP 10;

     |WORD_SALVA nWord, "";
     ||RFBORRA aDestino;
     |BLIN 23;
*/
|FCAL;

|CALCULO contcont;
 aCon_Serie = #1#0;
 aCon_Clave = "contrato";
 nCon_Conta = 0;
 |HAZ ContadorFicClip;
 pp = "0000"+nCon_Conta;
 #1#1 = nCon_Conta;
 |PINTA #1#1;
|FCAL;

|PROCESO Min79;
     #79#0 = #1#0;
     #79#1 = #1#1;
     #79#2 = 1;
|FPRC;

|PROCESO Max79;
     #79#0 = #1#0;
     #79#1 = #1#1;
     #79#2 = 999;
|FPRC;

|CALCULO tipo3cli; |TIPO 3;
|HAZ Tipo5;
|PUSHV 0501 2380;
|ENTLINEAL #1#79, 3, nModo, 19, 1, Min79, Max79;
|POPV;


|CONFI "0000S¿Imprimir Contrato?";
|SI FSalida = 0;
  |HAZ Imprime1;
|FINSI;
|FCAL;


|CALCULO LeeCentro;
|ABRE #7;
#7#0 = #1#3;
#7#1 = nCentro;
|LEE 010#7=;
|SI FSalida = 0;
 aCentro = #7#2;
 aActivi = #7#37;
 aCnae = #7#36;
|SINO;
 aCentro = " ";
 aActivi = " ";
 aCnae = " ";
|FINSI;
|LIBERA #7;
|CIERRA #7;
|FCAL;

|CALCULO nombinf;
 |SI #1#47 = "0";
   #1#48 = "contrato";
 |SINO;
   #1#48 = "convigil";
 |FINSI;
 |PINTA #1#48;
|FCAL;

|PROCESO Min;
     #74#0 = #1#0;
     #74#1 = #1#1;
     #74#2 = 1;
|FPRC;

|PROCESO Max;
     #74#0 = #1#0;
     #74#1 = #1#1;
     #74#2 = 999;
|FPRC;

|PROCESO Tipo20; |TIPO 20;
     |SI FSalida = "OPCION";
          FSalida = "Opciones";
     |SINO;
          |SELECT #1#1;
          |LEE 101#1=;
          |SI FSalida = 0;
               |MENU menu;
               menu2 = FSalida;
               |SI menu2 = 1;
                    |PUSHV 0501 2380;
                    |ENTLINEAL #1#79, 3, 4, 19, 1, Min79, Max79;
                    |POPV;
               |FINSI;
               |SI menu2 = 2;
                    |HAZ Imprime1;
               |FINSI;
               |SI menu2 = 3;
                    |PUSHV 0501 2380;
                    |BLANCO 1431 2280;
                    |ENTLINEAL #1#74, 3, 2, 22, 1, Min, Max;
                    |POPV;
               |FINSI;
               |SI menu2 = 4;
                    |PARA aMenuFac2 = "1"; |SI aMenuFac2 > 0; |HACIENDO;
                         |MENU aMenuFac;
                         |SI FSalida [ 0; |SAL; |FINSI;
                         aMenuFac2 = FSalida;
                         |HAZ FactuInicial;
                    |SIGUE;
               |FINSI;
               |LIBERA #1;
          |FINSI;
     |FINSI;
|FPRC;
ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
Fri May  7 11:33:21 CEST 2004

|PROCESO Fecha7; |TIPO 7;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 1;
          |HAZ EspeDefecto;
          |C_M #1#2, 1, "S";
     |SINO;
          |C_M #1#2, 1, "N";
     |FINSI;
|FPRC;

|PROCESO Fecha0; |TIPO 0;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 1;
          |ABRE #6;
          #6#0 = #1#17;
          |LEE 000#6=;
          |CIERRA #6;
          fecha = #1#2;
          dias = #6#1 / 1000;
          fecha = fecha + dias;
          #1#37 = #1#2;
          #1#15 = fecha;
          |PINTA #1#15;
          |PINTA #1#37;
     |FINSI;

     |SI #1#100 = 0;
          aAlfa = #1#2 % 402;
          #1#100 = aAlfa; |PINTA #1#100;
     |FINSI;
|FPRC;

|PROCESO Periodo; |TIPO 0;
     |SI #1Campo ! Contenido;
          |HAZ FechaFin;
     |FINSI;
|FPRC;

|PROCESO FechaFin;
     |ABRE #6;
     #6#0 = #1#17;
     |LEE 000#6=;
     |CIERRA #6;

     fecha = #1#37;
     dias = #6#1 / 1000;
     fecha = fecha + dias;
     #1#15 = fecha;
     |PINTA #1#15;
|FPRC;

|PROCESO ModificaFechaPe; |TIPO 0;
     fFech1 = Contenido;
     |SI fFech1 ! #1#37;
          |AVISO;
          |CONFI "0000NVa a modificar la fecha de periodicidad. Esta seguro?";
          |SI FSalida = 0;
               |AVISO;
               |CONFI "0000NAfectara a la fecha de futuros contratos. Esta seguro de cambiar la fecha?";
               |SI FSalida ! 0;
                    #1#37 = fFech1;   |PINTA #1#37;
                    |ERROR;
               |SINO;
                    |HAZ FechaFin;
               |FINSI;
          |SINO;
               #1#37 = fFech1;   |PINTA #1#37;
               |ERROR;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO EspeDefecto;
     |DDEF aDef;
     aDef = aDef + "clipr007";
     |CARGA_DEF aDef, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          |LEE 000#referen@.p;
          |PARA; |SI FSalida = 0; |HACIENDO;
               |SI #referen@#63 ! 0; |O #referen@#64 ! 0; |O #referen@#65 ! 0;
                         |O #referen@#66 ! 0; |O #referen@#67 ! 0;
                    #1#63 = #referen@#63; |PINTA #1#63;
                    #1#64 = #referen@#64; |PINTA #1#64;
                    #1#65 = #referen@#65; |PINTA #1#65;
                    #1#66 = #referen@#66; |PINTA #1#66;
                    #1#67 = #referen@#67; |PINTA #1#67;
                    |SAL;
               |FINSI;
               |LEE 000#referen@.s;
          |SIGUE;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|PROCESO LinCentro; |TIPO 7;
     #79#5 = #1#3; ||Empresa;

     |DDEFECTO #7;
     |ABRE #7;
     #7#0 = #79#5;
     #7#1 = #79#3;
     |LEE 000#7=;
     |CIERRA #7;

     |PINTA 2113, #7#38;
     |PINTA 2128, #7#39;
     |PINTA 2161, #7#40;
     |PINTA 2216, #7#41;
|FPRC;

|PROCESO Min7;
     #7#0 = #79#5;
     #7#1 = 0;
|FPRC;

|PROCESO Max7;
     #7#0 = #79#5;
     #7#1 = 999;
|FPRC;

|PROCESO BuscaCentro; |TIPO 66;
     |ABRE #7;
     #7#0 = #79#5;
     #7#1 = #79#3;
     |LEE 000#7];
     |CONSULTA_F_CLAVE #1#7, Min7, Max7;
     |SI FSalida = 0;
          #79#3 = #7#1; |PINTA #7#1;
          |HAZ LinCentro;
     |SINO;
          |ERROR;
     |FINSI;
     |CIERRA #7;
|FPRC;




|PROCESO BorraAnexo;
     |BORRA 020#74a;
|FPRC;

|DEFBUCLE BorraAnexo;
     #74#1;
     ;
     #1#0, #1#1, 001;
     #1#0, #1#1, 999;
     be;
     NULL, BorraAnexo;
|FIN;

|PROCESO CentroTipo2; |TIPO 2;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 3;
          |BUCLE BorraAnexo;
          nCentro = 0;
     |SINO;
          nCentro = #79#3;
     |FINSI;
     |SI #79#2 = 1; #1#42 = nCentro; |FINSI;
     |SI #79#2 = 2; #1#43 = nCentro; |FINSI;
     |SI #79#2 = 3; #1#44 = nCentro; |FINSI;
     |SI #79#2 = 4; #1#45 = nCentro; |FINSI;
     |SI #79#2 = 5; #1#46 = nCentro; |FINSI;

     |SI #79#2 = 6; #1#50 = nCentro; |FINSI;
     |SI #79#2 = 7; #1#51 = nCentro; |FINSI;
     |SI #79#2 = 8; #1#52 = nCentro; |FINSI;
     |SI #79#2 = 9; #1#53 = nCentro; |FINSI;
     |SI #79#2 = 10; #1#54 = nCentro; |FINSI;
|FPRC;

|PROCESO Presupuesto7; |TIPO 7;
     nModo = (FEntrada / 100) ! 0;

     |SI nModo = 2;
          |C_M #1#25, 1, "N";
          |C_M #1#26, 1, "N";
     |SINO;
          |C_M #1#25, 1, "S";
          |C_M #1#26, 1, "S";
     |FINSI;
|FPRC;

|PROCESO MiraPre;
     |SI #referen@#0 ! #1#0; |O #referen@#1 ! #1#1;
          nHay = 1;
          aAlfa = #referen@#0+ "/" + (("000000" + #referen@#1) % -106);
          aAlfa = "0000Presupuesto asignado al contrato: " + aAlfa;
          |MENAV aAlfa;
     |FINSI;
|FPRC;

|DEFBUCLE MiraPre;
     #referen@#5002;
     ;
     #1#25, #1#26;
     #1#25, #1#26;
     ;
     NULL, MiraPre;
|FIN;

|PROCESO Presupuesto0; |TIPO 0;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 1; |Y FSalida ! 2; |Y #1#26 ! 0;
          nHay = 0;
          |DDEF aAlfa;
          aAlfa = aAlfa + "clipr007";
          |CARGA_DEF aAlfa, referen@;
          |SI FSalida = 0;
               |BUCLE MiraPre;
               |DESCARGA_DEF #referen@;
          |SINO;
               |MENAV "0000Error al cargar 'clipr007'";
          |FINSI;
          |SI nHay ! 0; |ERROR; |ACABA; |FINSI;

          |SI #1#25 ! "     "; |O #1#26 ! 0;
               |ABRE #3;
               #3#0 = #1#25;
               #3#1 = #1#26;
               |LEE 000#3=;
               |SI FSalida = 0;
                    #1#3 = #3#3;
                    #1#4 = #3#4;
                    #1#58 = #3#58;
                    #1#84 = #3#84;
                    #1#17 = #3#17;
                    #1#55 = #3#55;
                    #1#56 = #3#56;
                    #1#68 = #3#68;
                    #1#69 = #3#69;
                    #1#70 = #3#70;
                    #1#71 = #3#71;
                    #1#72 = #3#72;
                    #1#73 = #3#73;
                    #1#74 = #3#74;
                    #1#75 = #3#75;
                    #1#76 = #3#76;
                    #1#77 = #3#77;
                    #1#78 = #3#78;
                    #1#79 = #3#79;
                    #1#80 = #3#80;
                    #1#81 = #3#81;
                    #1#82 = #3#82;
                    #1#83 = #3#83;
                    #1#84 = #3#84;
                    #1#85 = #3#85;
                    #1#86 = #3#86;
                    #1#87 = #3#87;
                    #1#88 = #3#88;
                    #1#89 = #3#89;
                    #1#63 = #3#63;
                    #1#64 = #3#64;
                    #1#65 = #3#65;
                    #1#66 = #3#66;
                    #1#67 = #3#67;
                    #1#7 = #3#7;
                    #1#49 = #3#49;
                    #1#31 = #3#31;
                    #1#59 = #3#59;
                    #1#60 = #3#60;
                    #1#61 = #3#61;
                    #1#62 = #3#62;
                    #1#19 = #3#19;
                    #1#20 = #3#20;
                    #1#11 = #3#11;
                    #1#102 = #3#90;
                    #1#103 = #3#91;
                    #1#104 = #3#92;
                    #1#105 = #3#93;
                    #1#106 = #3#94;
                    #1#107 = #3#95;
                    #1#108 = #3#96;
                    #1#109 = #3#97;
                    #1#110 = #3#98;
                    #1#111 = #3#99;
                    #1#112 = #3#100;
                    #1#12 = #3#101;
                    #1#115 = #3#102;
                    #1#116 = #3#103;
                    #1#117 = #3#104;
                    #1#118 = #3#105;
                    #1#119 = #3#106;

                    |HAZ totales;
                    |PINDA #0#1;
               |SINO;
                    |MENAV "0000No existe presupuesto...";
                    |ERROR;
               |FINSI;
               |CIERRA #3;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO clipr079;
     #79#0 = #1#0;
     #79#1 = #1#1;
     #79#2 = #80#2;
     #79#3 = #80#3;
     #79#4 = #80#4;
     #79#5 = #1#3;
     |GRABA 020#79n;
     |HAZ CentroTipo2;
|FPRC;

|DEFBUCLE clipr079;
     #80#1;
     5;
     #1#25, #1#26, 01, #1#3;
     #1#25, #1#26, 99, #1#3;
     ;
     NULL, clipr079;
|FIN;

|PROCESO Tipo5;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 1;
          |ABRE #80;
          |ABRE #79;
          |BUCLE clipr079;
          |CIERRA #79;
          |CIERRA #80;
     |FINSI;
|FPRC;

|PROCESO ModiCentro;
     |SI FSalida ! 13; |ACABA; |FINSI;
     |PUSHV 0501 2380;
     #79#5 = #1#3;
     |ABRE #7;
     #7#0 = #79#5;
     #7#1 = #79#3;
     |LEE 101#7=;
     |SI FSalida = 0;
          |PINPA #0#7;
          |PINDA #0#7;
          |ENDATOS #2#7;
          |SI FSalida = 0;
               #79#4 = #7#2;
               |GRABA 020#7a;
          |FINSI;
     |FINSI;
     |CIERRA #7;
     |POPV;
     |PINTA #79#4;
     |ERROR;
|FPRC;

|PROCESO Espe0; |TIPO 0;
     |SI FSalida = 2; |ACABA; |FINSI;

     |SI #1Campo ! 0;
          |ABRE #77;
          #77#0 = #1Campo;
          |LEE 000#77=;
          |SI FSalida ! 0;
               |MENAV "0000No existe especialidad...";
               |ERROR;
          |FINSI;
          |CIERRA #77;
     |SINO;
          nErr = 0;
          |SI Campo = 63; |Y #1#31 ! 0; nErr = 1; |FINSI;
          |SI Campo = 64; |Y #1#59 ! 0; nErr = 1; |FINSI;
          |SI Campo = 65; |Y #1#60 ! 0; nErr = 1; |FINSI;
          |SI Campo = 66; |Y #1#61 ! 0; nErr = 1; |FINSI;
          |SI Campo = 67; |Y #1#62 ! 0; nErr = 1; |FINSI;
          |SI Campo = 102; |Y #1#68 ! 0; nErr = 1; |FINSI;
          |SI Campo = 103; |Y #1#70 ! 0; nErr = 1; |FINSI;
          |SI Campo = 104; |Y #1#72 ! 0; nErr = 1; |FINSI;
          |SI Campo = 105; |Y #1#73 ! 0; nErr = 1; |FINSI;
          |SI Campo = 106; |Y #1#75 ! 0; nErr = 1; |FINSI;
          |SI nErr ! 0;
               |MENAV "0000El codigo de especialidad no puede ser '0'";
               |ERROR;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO BorraCentro;
     |BORRA 020#79a;
     |LIBERA #79;
|FPRC

|DEFBUCLE BorraCentro;
     #79#1;
     ;
     #1#0, #1#1, 001;
     #1#0, #1#1, 999;
     be;
     NULL, BorraCentro;
|FIN;

|PROCESO Tipo2Cab; |TIPO 2;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 3;
          |BUCLE BorraCentro;
     |FINSI;
|FPRC;

|PROCESO ModiEmpresa; |TIPO 0;
     nModo = (FEntrada / 100) ! 0;
     |SI #1Campo ! Contenido; |Y nModo = 2;
          |CONFI "0000NSe borraran los centros. ¿Continuar?";
          |SI FSalida = 0;
               |BUCLE BorraCentro;
          |SINO;
               |ERROR;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Centro11; |TIPO 11;
     |SI FSalida ! 13; |ACABA; |FINSI;
     |PUSHV 0501 2380;
     #79#5 = #1#3;
     |ABRE #7;
     #7#0 = #79#5;
     #7#1 = #79#3;
     |LEE 000#7=;
     |SI FSalida = 0;
          |PINPA #0#7; |PINDA #0#7; |PAUSA;
          |PINPA #1#7; |PINDA #1#7; |PAUSA;
          |PINPA #2#7; |PINDA #2#7; |PAUSA;
     |SINO;
          |AVISO;
     |FINSI;
     |CIERRA #7;
     |POPV;
     |PINTA #79#4;
     |ERROR;
|FPRC;

|PROCESO IVA007_66; |TIPO 66;
     enTiva = #1Campo;
     efFiva = #1#2;
     |HAZ ConsuIVA;
     |SI eaDiva = "";
          |ERROR;
     |SINO;
          #1Campo = enTiva; |PINTA #1Campo;
     |FINSI;
|FPRC;

|PROCESO IVA007_0; |TIPO 0;
     enTiva = #1Campo;
     efFiva = #1#2;
     |HAZ SacaIVA;
     |SI eaDiva = "";
          |MENAV "0000No existe tipo iva para esta fecha...";
          |ERROR; |ACABA;
     |SINO;
          |HAZ PonIVA;
     |FINSI;
|FPRC;
