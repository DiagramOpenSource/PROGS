|FICHEROS;
   cafe0010 #0;

   agis0002 #10;

   agifa010 #50;
   agifa025 #51;
   agifa024 #52;
   agifa324 #53;
   dsm00289 #289;

   dscamrec@ #600;
   dscam003@ #601;
   Referen@  #602;
|FIN;

|VARIABLES;
   &Tempo     = "";
   &aCPath    = "";
   &aCNome    = "";
   &nDeci_Div = 0;

   aAlfa     = "";
   aSubProg  = ":dscarter/dsrecibo";
   aPath     = "";
   aDef00    = "";
   aTempo600 = "";
   Comodin   = "";
   Divisa    = "";
|FIN;

|PROCESO CreaRecibo;
     |DBASS aPath; aPath = aPath + "dscarter/";
     aDef00 = aPath + "def/dscamrec";

     |CARGA_DEF aDef00, dscamrec@;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |HAZ CreaTempo; aTempo600 = Tempo;
     |PATH_DAT #dscamrec@#aPath#; |NOME_DAT #dscamrec@#aTempo600#;
     |DELINDEX #dscamrec@;        |ABRE #dscamrec@;
     aCPath = aPath; aCNome = aTempo600;

     |DFICE Comodin;
     Comodin = Comodin % -106;
     Comodin = Comodin % 0105;

     |ABRE #agifa010; |ABRE #agifa025;
     #agifa010#52 = #agis0002#20;
     #agifa010#0  = #agis0002#17;
     |LEE 101#agifa010.=;
     |SI FSalida ! 0; |DDEFECTO #agifa010; |FINSI;
     #agifa025#0 = #agifa010#6;
     |LEE 000#agifa025.=;
     |SI FSalida ! 0; |DDEFECTO #agifa025; |FINSI;
     |CIERRA #agifa010; |CIERRA #agifa025;

     |ABRE #agifa324;
     |ABRE #agifa024;
     #agifa324#0 = #agifa010#68;
     #agifa024#0 = #agis0002#2;   ||cli
     |LEE 000#agifa324.=;
     |LEE 000#agifa024.=;
     |CIERRA #agifa324;
     |CIERRA #agifa024;
     nDeci_Div = #agifa324#7;

     |DDEFECTO #dscamrec@;
     ||#dscamrec@#0  =              ||Libro
     #dscamrec@#1  = #agifa010#52;||Serie
     #dscamrec@#2  = #agifa010#0; ||Fact
     #dscamrec@#3  = #agis0002#18;||N§ Rec
     #dscamrec@#4  = #agis0002#8; ||F.V
     #dscamrec@#5  = #agis0002#7; ||F.E
     #dscamrec@#6  = #agis0002#12;||Cuenta Cli
     #dscamrec@#7  = #agis0002#3; ||Nom Cli
     #dscamrec@#8  = #agis0002#4; ||Nom Banco
     #dscamrec@#9  = #agifa024#32;      ||Entidad
     #dscamrec@#10 = #agifa024#33;      ||Sucursal
     #dscamrec@#11 = #agifa024#31;      ||DC
     #dscamrec@#12 = #agifa024#30;      ||Cuenta
     #dscamrec@#13 = #agis0002#22;||Tipo Rec
     ||#dscamrec@#14 =      ||Departa
     #dscamrec@#15 = #agis0002#9; ||Importe
     #dscamrec@#16 = #agis0002#15;||A aceptar
     #dscamrec@#17 = #agis0002#6; ||Aceptado
     #dscamrec@#18 = #agis0002#2; ||Cliente
     |SI #agis0002#30 = "A";
          #dscamrec@#19 = #agifa010#6; ||Representante
          #dscamrec@#20 = #agifa025#1; || Nombre representante
     |FINSI;
     #dscamrec@#21 = #agifa024#3; ||Zona
     #dscamrec@#22 = 1;           ||Documento
     ||#dscamrec@#23 =      ||Empresa Contable
     ||#dscamrec@#24 =      ||Periodo
     #dscamrec@#25 = Comodin;       ||Empresa ges
     ||#dscamrec@#26 =      ||A cuenta
     #dscamrec@#27 = "V";         ||Tipo
     #dscamrec@#28 = "A";         ||Ope
     #dscamrec@#29 = #agifa324#0;      ||Divisa
     #dscamrec@#30 = #agifa324#1;      ||Nombre
     #dscamrec@#31 = #agifa010#69;
     #dscamrec@#32 = #agifa010#74;
     #dscamrec@#33 = #agifa024#203;
     #dscamrec@#34 = 0;
     #dscamrec@#35 = "A";
     #dscamrec@#36 = #agis0002#28;
     #dscamrec@#37 = #agis0002#31;
     #dscamrec@#38 = #agis0002#16;
     #dscamrec@#39 = #agis0002#10;

     aAlfa = "|NC"; aAlfa = #600#aAlfa#;
     |SI aAlfa > 48;
          #600#48 = #agifa024#215;
          #600#49 = #agifa024#216;
     |FINSI;
     |SI aAlfa > 50;
          #600#50 = #agifa024#217;
          |ABRE #289;
          #289#0 = #agifa024#0;
          |LEE 000#289=;
          |SI FSalida ! 0; |DDEFECTO #289; |FINSI;
          |CIERRA #289;
          #600#51 = #289#1;
     |FINSI;

     |GRABA 020#dscamrec@.n;
     |CIERRA #dscamrec@;

     |SUB_EJECUTA_NP aSubProg;

     |DELINDEX #dscamrec@;
     |DESCARGA_DEF #dscamrec@;
|FPRC;

|PROCESO agis0002;

   |SI #agis0002#22 = 1;
      aAlfa = "";
      |DDEFECTO #Referen@;
      #Referen@#0 = #48#0;
      |LEE 000#Referen@.];
      |PARA; |SI FSalida = 0; |Y #Referen@#0 = #48#0; |HACIENDO;
         |SI #Referen@#2 = "V"; |Y #Referen@#4 [ #agis0002#20; |Y #Referen@#5 ] #agis0002#20;
            |DBASS aAlfa; |QBF aAlfa; aAlfa = aAlfa + "dscarter/fich/" + (("00000" + #Referen@#6) % -105) + "/";
            |PATH_DAT #dscam003@#aAlfa#; |ABRE #dscam003@; |SAL;
         |FINSI;
         |LEE 000#Referen@.s;
      |SIGUE;
      |SI aAlfa ! "";
         |SELECT #12#dscam003@;
         |DDEFECTO #dscam003@;
         #dscam003@#0  = #agis0002#20;
         #dscam003@#1  = #agis0002#17;
         #dscam003@#2  = #agis0002#18;
         #dscam003@#69 = "A";
         |LEE 000#dscam003@.];
         |SI FSalida ! 0; |O #dscam003@#0 ! #agis0002#20; |O #dscam003@#1 ! #agis0002#17;
         |O #dscam003@#2 ! #agis0002#18; |O #dscam003@#69 ! "A";
            |HAZ CreaRecibo;
         |FINSI;
         |SELECT #1#dscam003@;
      |FINSI;

      |CIERRA #dscam003@;
   |FINSI;

   |SI #agis0002#22 = 2; |Y #agis0002#13 = "S"; |Y #agis0002#32 = "S";
      aAlfa = "";
      |DDEFECTO #Referen@;
      #Referen@#0 = #48#0;
      |LEE 000#Referen@.];
      |PARA; |SI FSalida = 0; |Y #Referen@#0 = #48#0; |HACIENDO;
         |SI #Referen@#2 = "V"; |Y #Referen@#4 [ #agis0002#20; |Y #Referen@#5 ] #agis0002#20;
            |DBASS aAlfa; |QBF aAlfa; aAlfa = aAlfa + "dscarter/fich/" + (("00000" + #Referen@#6) % -105) + "/";
            |PATH_DAT #dscam003@#aAlfa#; |ABRE #dscam003@; |SAL;
         |FINSI;
         |LEE 000#Referen@.s;
      |SIGUE;
      |SI aAlfa ! "";
         |SELECT #12#dscam003@;
         |DDEFECTO #dscam003@;
         #dscam003@#0  = #agis0002#20;
         #dscam003@#1  = #agis0002#17;
         #dscam003@#2  = #agis0002#18;
         #dscam003@#69 = "A";
         |LEE 000#dscam003@.];
         |SI FSalida ! 0; |O #dscam003@#0 ! #agis0002#20; |O #dscam003@#1 ! #agis0002#17;
         |O #dscam003@#2 ! #agis0002#18; |O #dscam003@#69 ! "A";
            |HAZ CreaRecibo;
         |FINSI;
         |SELECT #1#dscam003@;
      |FINSI;

      |CIERRA #dscam003@;
   |FINSI;
|FPRC;

|DEFBUCLE agis0002;
#agis0002#1;
22;
"A", "     ", 000000, 01, 1;
"A", "zzzzz", 999999, 99, 2;
;
NULL,agis0002;
|FIN;

|PROGRAMA;
   |CLS;
   |CABEZA "Recuperacion de entregas a cuenta";
   |PINPA #0#0; |PINDA #0#0;
   |ENDATOS #1#0;
   |SI FSalida = 0; |Y #0#0 = "S";
      |DBASS aAlfa; |QBF aAlfa; aAlfa = aAlfa + "dscarter/def/dscam045.mas";
      |CARGA_DEF aAlfa, Referen@;
      |SI FSalida = 0;
         |DBASS aAlfa; |QBF aAlfa; aAlfa = aAlfa + "dscarter/def/dscam003.mas";
         |CARGA_DEF aAlfa, dscam003@;
         |DBASS aAlfa; |QBF aAlfa; aAlfa = aAlfa + "dscarter/fich/";

         |PATH_DAT #Referen@#aAlfa#; |ABRE #Referen@;
         |BUCLE agis0002;

         |DESCARGA_DEF #dscam003@;
         |CIERRA #Referen@; |DESCARGA_DEF #Referen@;
      |FINSI;
   |FINSI;
|FPRO;
