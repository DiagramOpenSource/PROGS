|FICHEROS;
     pcegz060 #0;
     pcegm004 #4;
     pcegm005 #5;
     pcegw013 #13,MANTE;
     agifa019 #19;
     agifa024 #24;
     agifa142 #142;
|FIN;

|VARIABLES;
     &enRechaza = 0;
     &enImpCliPed = 0;
     &enForma = 0;
     &eaCliente = "";
     &eaTag = "";
     &efFecha = @;
     aAlfa = "";
     nMes = 0;
     nA¤o = 0;
     fFecha = "";
     nHay = 0;
     aMarca = "";
     nTecla = 0;
     nImpo = 0;
     fmes = "";
     mes = 0;
|FIN;

|PROCESO ActCli;
     #19#0 = #5#2;
     |LEE 020#19=;

     #24#0 = #4#4;
     |LEE 121#24=;
     |SI FSalida = 0;
          |SI #19#194 = 2;
               nImpo = ((((#5#44 * #5#6) < #5#8) < #5#29) < #4#5) < #4#17;
          |SINO;
               nImpo = ((((#5#5 * #5#6) < #5#8) < #5#29) < #4#5) < #4#17;
          |FINSI;
          |SI #142#115 = "S";
               nImpo = nImpo < #4#6;
          |FINSI;
          nImpo = nImpo * enForma;
          fmes = #4#1 % A402;
          mes = fmes - 1;
          mes = mes * 3;
          mes = mes + 114;
          #24mes = #24mes + nImpo;     || VENTA.
          #24#150 = #24#150 + nImpo;
          |GRABA 020#24a;

          eaCliente = #pcegm004#4;
          efFecha = #pcegm004#1;
          enImpCliPed = nImpo;
          |HAZ AcumulaCli;
     |FINSI;
|FPRC;

|PROCESO Actualiza;
     |ABRE #19;
     |ABRE #24;
     |HAZ ActCli;
     |CIERRA #24;
     |CIERRA #19;

     |HAZ AcumulaPV_PCEG;
     |BORRA 020#5a;
|FPRC;

|PROCESO Tmp;
     #4#25 = #13#0;
     #4#0 = #13#1;
     |LEE 121#4=;
     |SI FSalida = 0;
          |SI #0#0 = "E";
               enForma = -1;
               eaTag = "PE";  |HAZ RiesgosPCEG;

               |BUCLELIN 2 Actualiza #4;
               |BORRA 020#4a;
          |FINSI;
          |SI #0#0 = "R";
               enForma = -1;
               enRechaza = 1;
               |BUCLELIN 2 AcumulaPV_PCEG #4;
               enRechaza = 0;
               #4#70 = "R";
               #4#78 = Usuario % 810;
               #4#79 = #0#1;
               #4#80 = #0#2;
               #4#94 = #0#3;
               |GRABA 020#4a;
          |FINSI;
          |LIBERA #4;
     |FINSI;
|FPRC;

|DEFBUCLE Tmp;
     #13#1;
     5;
     "     ", 000001, "*";
     "zzzzz", 999999, "*";
     ;
     NULL, Tmp;
|FIN;

|PROCESO MarcaTodo;
     #13#5 = aMarca;
     |GRABA 020#13a;
     |LIBERA #13;
|FPRC;

|DEFBUCLE MarcaTodo;
     #13#1;
     ;
     INICIO;
     FINAL;
     be;
     NULL, MarcaTodo;
|FIN;

|PROCESO Tecla11; |TIPO 11;
     |SI FSalida = 13; |O FSalida = 14;
          nTecla = FSalida;
          |PTEC 807;
     |FINSI;
|FPRC;

|PROCESO Tecla0; |TIPO 0;
     |SI #13#5 = "*";
          #13#5 = "";
     |SINO;
          #13#5 = "*";
     |FINSI;
     |GRABA 020#13a;
|FPRC;

|PROCESO Pedidos;
     #13#0 = #4#25;
     #13#1 = #4#0;
     #13#2 = #4#1;
     #13#3 = #4#4;
     #13#4 = #4#8;
     |GRABA 020#13n;
     nHay = 1;
|FPRC;

|DEFBUCLE Pedidos;
     #4#1;
     1, 70;
     "     ", 000001, "01.01.0000", "P";
     "zzzzz", 999999, fFecha,       "P";
     ;
     NULL, Pedidos;
|FIN;

|PROCESO Rechaza; |TIPO 0;
     |SI #0#0 = "E";
          |C_M #0#2, 1, "N";
          |C_M #0#3, 1, "N";
     |SINO;
          |C_M #0#2, 1, "S";
          |C_M #0#3, 1, "S";
     |FINSI;
|FPRC;

|PROCESO Min;
     #13#0 = "     ";
     #13#1 = 1;
|FPRC;

|PROCESO Max;
     #13#0 = "zzzzz";
     #13#1 = 999999;
|FPRC;

|PROCESO Tipo3; |TIPO 3;
     |ABRE #142; |LEE 000#142p; |CIERRA #142;

     aAlfa = #0#1 % 402; nMes = aAlfa;
     aAlfa = #0#1 % 704; nA¤o = aAlfa;
     nMes = nMes - 6;
     |SI nMes < 1;
          nA¤o = nA¤o - 1;
          nMes = nMes + 12;
     |FINSI;
     aAlfa = (#0#1 % 103) + (("00" + nMes) % -102) + "." + (("0000" + nA¤o) % -104);
     fFecha = aAlfa;

     aAlfa = Usuario;
     |NOME_DAT #13 aAlfa; |DELINDEX #13;

     |ABRE #13;
     |BUCLE Pedidos;
     |CIERRA #13;
     |SI nHay = 0;
          |MENAV "0000No hay pedidos pendientes...";
     |SINO;
          |PINPA #0#13;
          |PARA nTecla = 1; |SI nTecla ! 0; |HACIENDO;
               nTecla = 0;
               |ENTLINEAL #1#13, 1, 4, 22, 0, Min, Max;
               |SI nTecla = 13; aMarca = "*"; |BUCLE MarcaTodo; |FINSI;
               |SI nTecla = 14; aMarca = " "; |BUCLE MarcaTodo; |FINSI;
          |SIGUE;
          |CONFI "0000N¿Conforme con lo seleccionado?";
          |SI FSalida = 0;
               |ABRE #4;
               |BUCLE Tmp;
               |CIERRA #4;
          |FINSI;
     |FINSI;

     |DELINDEX #13;
|FPRC;
