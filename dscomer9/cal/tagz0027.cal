|FICHEROS;
     agifa010 #10;
     dsm00020 #20;
     tagm0025 #25;
     agifa071 #71;
     tagm0087 #87;
     tagm0088 #88;
     agifa072 #72;
     agifa077 #77;
     agifa079 #79;
|FIN;

|VARIABLES;
     &efFecCta = @;
     &eaSerFac = "";
     &enNumFac = 0;
     &eaSerie = "";
     &enCodigo = 0;
     &eaSerAlb = "";
     &enNumAlb = 0;
     &eaSerBlc = "";
     &enNumBlc = 0;
     nSal25 = 0;
     aSer = "";
     aNum = "";
     aNom = "";
     aFic = "";
     nHandle = 0;
     aPath = "";
     aAlfa = "";
     aAno = "";
     aPrv = "";
     aSuF = "";
|FIN;

|PROCESO FacLin;
     #77#50 = #72#17;
     #77#0 = #72#2;
     |LEE 020#77=;

     aAno = #79#1 % 704;
     aPrv = ("000000" + #79#2) % -106;
     aSuF = #79#74; |QBF aSuF;
     aAlfa = "1642015|F/" + aAno + "/30" + aPrv + "/" + aSuF + "|A/";

     aAno = #77#1 % 704;
     aSuF = #77#54; |QBF aSuF;
     aAlfa = aAlfa + aAno + "/30" + aPrv + "/" + aSuF + "|";

     |XGRABA nHandle, aAlfa;
|FPRC;

|PROCESO Block;
     aSer = eaSerBlc % 102;
     aNum = ("000000" + enNumBlc) % -106;
     aNom = aSer + aNum + ".txt";
     aFic = aPath + aNom;
     |XABRE "CW", aFic, nHandle;
     |SI FSalida ] 0;
          |SI #20#10 = "N";
               aAlfa = "1642014|50/30" + aSer + aNum + "|";
          |SINO;
               aAlfa = "1642013|50/30" + aSer + aNum + "|";
          |FINSI;
          |XGRABA nHandle, aAlfa;
          |XCIERRA nHandle;
     |SINO;
          aAlfa = "0000Error al crear fichero '" + aNom + "'...";
          |MENAV aAlfa;
     |FINSI;
|FPRC;

|PROCESO AlbLin;
     aSer = #71#31 % 102;
     aNum = ("000000" + #71#12) % -106;
     aNom = aSer + aNum + ".txt";
     aFic = aPath + aNom;
     |XABRE "CW", aFic, nHandle;
     |SI FSalida ] 0;
          |SI #20#10 = "N";
               aAlfa = "1642014|50/30" + aSer + aNum + "|";
          |SINO;
               aAlfa = "1642013|50/30" + aSer + aNum + "|";
          |FINSI;
          |XGRABA nHandle, aAlfa;
          |XCIERRA nHandle;
     |SINO;
          aAlfa = "0000Error al crear fichero '" + aNom + "'...";
          |MENAV aAlfa;
     |FINSI;
|FPRC;

|PROCESO AlbLin2;
     aSer = #71#31 % 102;
     aNum = ("000000" + #71#12) % -106;
     aNom = "x" + aSer + aNum + ".txt";
     aFic = aPath + aNom;
     |XABRE "CW", aFic, nHandle;
     |SI FSalida ] 0;
          aAlfa = "1642019|50/30" + aSer + aNum + "|";
          |XGRABA nHandle, aAlfa;
          |XCIERRA nHandle;
     |SINO;
          aAlfa = "0000Error al crear fichero '" + aNom + "'...";
          |MENAV aAlfa;
     |FINSI;
|FPRC;

|PROGRAMA;
     |ABRE #87; |LEE 000#87p; |CIERRA #87;
     aPath = #87#6; |QBF aPath;

     |SI PARAMETRO = "ADJ"; |O PARAMETRO = "ADB";
          |ABRE #25;
          |ABRE #20;
          |ABRE #10;
          #10#52 = eaSerAlb;
          #10#0 = enNumAlb;
          |LEE 020#10=;
          |SI FSalida = 0;
               #20#0 = #10#88;
               |LEE 000#20=;
               |SI FSalida ! 0; |DDEFECTO #20; |FINSI;

               #25#0 = "AV";
               #25#1 = #10#8;
               |LEE 000#25=;
               nSal25 = FSalida;

               |SI #20#10 = "N"; |O nSal25 ! 0;
                    |SI PARAMETRO = "ADB";
                         |HAZ Block;
                    |SINO;
                         |BUCLELIN 0 AlbLin #10;
                    |FINSI;
               |SINO;
                    |SI #20#10 = "S";
                         |SI PARAMETRO = "ADB";
                              |HAZ Block;
                         |SINO;
                              |BUCLELIN 0 AlbLin #10;
                         |FINSI;
                    |FINSI;
               |FINSI;

               |SI PARAMETRO = "ADJ";
                    |ABRE #88;
                    #88#0 = #10#52;
                    |LEE 000#88=;
                    |SI FSalida ! 0;
                         |BUCLELIN 0 AlbLin2 #10;
                    |FINSI;
                    |CIERRA #88;
               |FINSI;
          |FINSI;
          |CIERRA #10;
          |CIERRA #20;
          |CIERRA #25;
     |FINSI;
     |SI PARAMETRO = "FAC";
          aNom = "a" + eaSerie + (("000000" + enCodigo) % -106) + ".txt"; |QBT aNom;
          aFic = aPath + aNom;
          |XABRE "CW", aFic, nHandle;
          |SI FSalida ] 0;
               |ABRE #79;
               |ABRE #77;
               #79#66 = eaSerie;
               #79#0 = enCodigo;
               |LEE 020#79=;
               |SI FSalida = 0;
                    |BUCLELIN 0 FacLin #79;
               |FINSI;
               |CIERRA #77;
               |CIERRA #79;
               |XCIERRA nHandle;
          |SINO;
               aAlfa = "0000Error al crear fichero '" + aNom + "'...";
               |MENAV aAlfa;
          |FINSI;
     |FINSI;
     |SI PARAMETRO = "EFC";
          |ABRE #79;
          #79#66 = eaSerFac;
          #79#0 = enNumFac;
          |LEE 020#79=;
          |SI FSalida = 0;
               aNom = "b" + eaSerFac + (("000000" + enNumFac) % -106) + ".txt"; |QBT aNom;
               aFic = aPath + aNom;
               |XABRE "CW", aFic, nHandle;
               |SI FSalida ] 0;
                    aAno = #79#1 % 704;
                    aSuF = #79#74; |QBF aSuF;
                    aPrv = ("000000" + #79#2) % -106;
                    aSer = #79#66 % 104;
                    aNum = ("000000" + #79#0) % -106;

                    aAlfa = "1642016|F/" + aAno + "/30" + aPrv + "/";
                    aAlfa = aAlfa + aSuF + "|IVA SOPORTADO|" + aSer + "|";
                    aAlfa = aAlfa + aNum + "|" + efFecCta + "|";
                    |XGRABA nHandle, aAlfa;
                    |XCIERRA nHandle;
               |SINO;
                    aAlfa = "0000Error al crear fichero '" + aNom + "'...";
                    |MENAV aAlfa;
               |FINSI;
          |FINSI;
          |CIERRA #79;
     |FINSI;
|FPRO;
