     || Este calculo es el plb piens100.cal
|FICHEROS;
   vigm0013 #1000; || piens101
   vigm0014 #1001; || piens102
   vigm0015 #1003; || piens104
|FIN;

|VARIABLES;
   &enPosic = 0;
   &enModo = 0;
   &enLinea = 0;
   &efFEnt = @;
   &efFFab = @;
   &efFCad = @;
   &enLote = 0;
   &enCant = 0;
   &enFabr = 0;
   &eaArti = "";
   &eaTMov = "";
   &eaCPie = "";
   &eaNPie = "";
   &eaDes1 = "";
   &eaDes2 = "";

   aAlfa  = "";

   nCalc1 = 0;
   nCalc2 = 0;
|FIN;

|PROCESO SumaLote;
   #vigm0013#0 = enLote;
   #vigm0013#1 = eaArti;
   |LEE 101#vigm0013.=;
   |SI FSalida ! 0;
      |DDEFECTO #vigm0013;
      #vigm0013#0 = enLote;
      #vigm0013#1 = eaArti;
      #vigm0013#3 = efFCad;
      |GRABA 020#vigm0013.b;
   |FINSI;
   #vigm0013#2 = #vigm0013#2 + enCant;
   |SI #vigm0013#2 = 0;
      |BORRA 020#vigm0013.a;
   |SINO;
      |GRABA 020#vigm0013.a;
   |FINSI;
   |LIBERA #vigm0013;
|FPRC;

|PROCESO RestaLote;
   #vigm0013#0 = enLote;
   #vigm0013#1 = eaArti;
   |LEE 101#vigm0013.=;
   |SI FSalida = 0;
      #vigm0013#2 = #vigm0013#2 - enCant;
      |SI #vigm0013#2 = 0;
         |BORRA 020#vigm0013.a;
      |SINO;
         |GRABA 020#vigm0013.a;
      |FINSI;
      |LIBERA #vigm0013;
   |FINSI;
|FPRC;

|PROCESO SumaFabr;
   #vigm0015#0 = enFabr;
   #vigm0015#1 = eaCPie;
   |LEE 101#vigm0015.=;
   |SI FSalida ! 0;
      |DDEFECTO #vigm0015;
      #vigm0015#0 = enFabr;
      #vigm0015#1 = eaCPie;
      #vigm0015#2 = eaNPie;
      #vigm0015#3 = efFFab;
      |GRABA 020#vigm0015.b;
   |FINSI;
   #vigm0015#4 = #vigm0015#4 + enCant;
   |SI #vigm0015#4 = 0;
      |BORRA 020#vigm0015.a;
   |SINO;
      |GRABA 020#vigm0015.a;
   |FINSI;
   |LIBERA #vigm0015;
|FPRC;

|PROCESO RestaFabr;
   #vigm0015#0 = enFabr;
   #vigm0015#1 = eaCPie;
   |LEE 101#vigm0015.=;
   |SI FSalida = 0;
      #vigm0015#4 = #vigm0015#4 - enCant;
      |SI #vigm0015#4 = 0;
         |BORRA 020#vigm0015.a;
      |SINO;
         |GRABA 020#vigm0015.a;
      |FINSI;
      |LIBERA #vigm0015;
   |FINSI;
|FPRC;


|PROCESO GrabaHist;

   |SI enModo ! 3;
      |SI enLote ! 0;
         |SI eaTMov ! "SF"; |Y eaTMov ! "SS";
            |HAZ SumaLote;
         |SINO;
            |HAZ RestaLote;
         |FINSI;
      |SINO;
         |SI eaTMov ! "SV"; |Y eaTMov ! "SS";
            |HAZ SumaFabr;
         |SINO;
            |HAZ RestaFabr;
         |FINSI;
      |FINSI;

      #vigm0014#0 = efFEnt;
      #vigm0014#1 = 99999;
      |LEE 000#vigm0014.];
      |SI FSalida = 0;
         |SI #vigm0014#0 ! efFEnt;
            |LEE 000#vigm0014.a;
            |SI FSalida = 0;
               |SI #vigm0014#0 ! efFEnt;
                  enLinea = 1;
               |SINO;
                  enLinea = #vigm0014#1 + 1;
               |FINSI;
            |SINO;
               enLinea = 1;
            |FINSI;
         |SINO;
            enLinea = #vigm0014#1 + 1;
         |FINSI;
      |SINO;
         |LEE 000#vigm0014.u;
         |SI FSalida = 0;
            |SI #vigm0014#0 ! efFEnt;
               enLinea = 1;
            |SINO;
               enLinea = #vigm0014#1 + 1;
            |FINSI;
         |SINO;
            enLinea = 1;
         |FINSI;
      |FINSI;

      |SI enLote ! 0;
         |DDEFECTO #vigm0014;
         #vigm0014#0  = efFEnt;
         #vigm0014#1  = enLinea;
         |GRABA 020#vigm0014.b;
         #vigm0014#2  = enLote;
         #vigm0014#3  = eaArti;
         #vigm0014#4  = enCant;
         #vigm0014#5  = eaTMov;
         |SI eaTMov ! "SF";
            #vigm0014#7  = "01.01.0000";
         |SINO;
            #vigm0014#6  = enFabr;
            #vigm0014#7  = efFFab;
         |FINSI;
         #vigm0014#10 = eaDes1;
         #vigm0014#11 = eaDes2;
         #vigm0014#12 = #vigm0013#2;
         |GRABA 020#vigm0014.a; |LIBERA #vigm0014;
      |SINO;
         |DDEFECTO #vigm0014;
         #vigm0014#0  = efFEnt;
         #vigm0014#1  = enLinea + 1;
         |GRABA 020#vigm0014.b;
         #vigm0014#4  = enCant;
         #vigm0014#5  = eaTMov;
         #vigm0014#6  = enFabr;
         #vigm0014#7  = efFFab;
         #vigm0014#8  = eaCPie;
         #vigm0014#9  = eaNPie;
         #vigm0014#10 = eaDes1;
         #vigm0014#11 = eaDes2;
         #vigm0014#12 = #vigm0015#4;
         |GRABA 020#vigm0014.a; |LIBERA #vigm0014;
      |FINSI;
   |SINO;
      |SI enLote ! 0;
         |SI eaTMov = "EF"; |O eaTMov = "SS";
            |HAZ SumaLote;
         |SINO;
            |HAZ RestaLote;
         |FINSI;
      |SINO;
         |SI eaTMov = "SV"; |O eaTMov = "SS";
            |HAZ SumaFabr;
         |SINO;
            |HAZ RestaFabr;
         |FINSI;
      |FINSI;

      #vigm0014#0 = efFEnt;
      #vigm0014#1 = enLinea;
      |LEE 101#vigm0014.=;
      |SI FSalida = 0;
         aAlfa = #vigm0014#5;
         |BORRA 020#vigm0014.a; |LIBERA #vigm0014;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO RegHLote;
   |ABRE #vigm0013;   |ABRE #vigm0014;
   |ABRE #vigm0015;
   |HAZ GrabaHist;
   |CIERRA #vigm0013; |CIERRA #vigm0014;
   |CIERRA #vigm0015;
|FPRC;
