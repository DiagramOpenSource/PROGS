|FICHEROS;
     albap004 #99;  || Cabecera de Revision
     agifa084 #0;   || Cabecera de Fact. Contado.
     agifa024 #6;   || Clientes.
     agifa069 #3;   || Lineas Fac. Contado.
     agifa019 #2;   || Articulos.
     agifa025 #8;
     agifa038 #13;
     agifa048 #15;
     agifa049 #16;
     agifa007 #40;
     agifa142 #41;
     agifa027 #43;
|FIN;

|VARIABLES;
     &enTiva = 0;
     &efFiva = @;
     &eaDiva = "";
     &enIva = 0;
     &enRec = 0;
     &EURODB = 0;
     resto = 0;
     neto = 0;
     diferencia = 0;
     numero = "";
     imneto = 0;
     tf = 0;
     retencion = 0;
     con = 0;
     margen = 0;
     indtope = 0;
     ind = 0;
     control = 0;
     mensaje01 = "0423Actualizando linea:";
     fmes = "  ";
     mes = 0;
     mensajei  = "2400NDesea imprimir esta factura ?";
     informe = "";
     informe1 = "agifa084";
     &iva1 = 0;&iva2 = 0;&iva3 = 0;&re1 = 0;&re2 = 0;&re3 = 0;
     &iva4 = 0;&iva5 = 0;&re4 = 0;&re5 = 0;
     &codigo="";
     &descrip="";
     &precio=0;
     &dto=0;
     &dto1=0;
     &unid=0;
     &imptot=0;
     &tiva=0;
     &linea=0;
     vacio="";
     modo = 0;
     &n_dec = 0;
     &n_pre = 0;
     totalb = 0;
     &bl  = "                              ";
     tipo = "vfactuco";
|FIN;



|CALCULO fcaccli;|TIPO 2;

|SI control = 1;
   |HAZ actal;
|FINSI;

|ABRE #6;
#6#0 = #0#3;
|LEE 121#6=;
|LIBERA #6;
|SI 0 = FSalida;
fmes = #0#1 % A402;
mes = fmes - 1;
mes = mes * 4;
mes = mes + 54;
imneto = #0#15 - #0#25;
#6mes = #6mes +. imneto;
mes = mes + 1;
#6mes = #6mes +. #0#25;
mes = mes + 1;
#6mes = #6mes +. #0#37;
#6#102 = #6#102 +. imneto;
#6#103 = #6#103 +. #0#25;
#6#104 = #6#104 +. #0#37;
mes = FEntrada / 100;
mes = mes ! 0;
|SI 1 = mes;
#6#45 = #0#1;
#6#46 = imneto;
|FINSI;
imneto = imneto + #0#24;
#6#110 = #6#110 +. imneto;
|GRABA 020#6a;
|LIBERA #6;
|FINSI;
|CIERRA #6;

|ABRE #8;
#8#0 = #0#6;
|LEE 121#8=;
|LIBERA #8;
|SI 0 = FSalida;
      imneto = #0#15 - #0#25;
      fmes = #0#1 % A402;
      mes = fmes - 1;
      mes = mes * 2;
      mes = mes + 11;
      #8mes = #8mes +. #0#26;
      retencion = #8mes % #8#39;
      mes = mes + 1;
      #8mes = #8mes +. imneto;
      #8#35 = #8#35 +. #0#26;
      #8#36 = #8#36 +. imneto;
      mes = fmes - 1;
      mes = mes + 40;
      #8mes = retencion;
      retencion = #8#35 % #8#39;
      #8#52 = retencion;
      |GRABA 020#8a;
      |LIBERA #8;
|FINSI;
|LIBERA #8;
|CIERRA #8;
|FCAL;

|CALCULO cogecon0;|TIPO 0;
   control = 0;
|FCAL;

|CALCULO pedcon0;|TIPO 6;
con = FEntrada / 100;
con = con ! 0;
|SI con = 2;|Y #0Campo ! Contenido;
  control = 1;
|FINSI;
|FCAL;

|CALCULO acttl;|TIPO 0;

#3#15 = #0#3;
#3#16 = #0#34;
#3#17 = #0#35;
|GRABA 020#3a;
|LIBERA #3;

imneto = #3#9 < #0#5;
imneto = imneto < #0#7;

|SI #3#2 ! #2#0;
  |ABRE #2;
  #2#0 = #3#2;
  |LEE 000#2=;
  |LIBERA #2;
  |CIERRA #2;
|FINSI;
margen = #3#5 * #2#9;
margen = imneto - margen;
#0#37 = #0#37 + margen;
     |SI #3#11 = 0; #0#28 = #0#28 + imneto; |FINSI;

     |SI #3#11 = 1;
          #0#16 = #0#16 + imneto; mes = #0#16; #0#17 = mes % #0#50;
          |SI #0#36 = "S";
               #0#18 = mes % #0#51;
          |FINSI;
     |FINSI;

     |SI #3#11 = 2;
          #0#19 = #0#19 + imneto; mes = #0#19; #0#20 = mes % #0#52;
          |SI #0#36 = "S";
               #0#21 = mes % #0#53;
          |FINSI;
     |FINSI;

     |SI #3#11 = 3;
          #0#22 = #0#22 + imneto; mes = #0#22; #0#23 = mes % #0#54;
          |SI #0#36 = "S";
               #0#49 = mes % #0#55;
          |FINSI;
     |FINSI;

     |SI #3#11 = 4;
          #0#42 = #0#42 + imneto; mes = #0#42; #0#43 = mes % #0#56;
          |SI #0#36 = "S";
               #0#44 = mes % #0#57;
          |FINSI;
     |FINSI;

     |SI #3#11 = 5;
          #0#45 = #0#45 + imneto; mes = #0#45; #0#46 = mes % #0#58;
          |SI #0#36 = "S";
               #0#47 = mes % #0#59;
          |FINSI;
     |FINSI;

mes = imneto % #3#10;
#0#26 = #0#26 + mes;
#0#25 = 0;
#0#25 = #0#15 < #0#5;
#0#25 = #0#25 ! EURODB;
#0#25 = #0#25 < #0#7;
#0#25 = #0#25 ! EURODB;
#0#25 = #0#15 - #0#25;
#0#25 = #0#25 ! EURODB;
#0#24=#0#17+#0#20+#0#23+#0#18+#0#21+#0#49+#0#43+#0#44+#0#46+#0#47;
|FCAL;

|CALCULO actal;|TIPO 0;
|MENSA mensaje01;
#0#15 = 0;#0#16 = 0;#0#17 = 0;#0#18 = 0;#0#19 = 0;#0#20 = 0;#0#21 = 0;
#0#22 = 0;#0#23 = 0;#0#24 = 0;#0#25 = 0;#0#26 = 0;#0#28 = 0;#0#37 = 0;
#0#41 = 0;#0#61 = 0;
|BUCLELIN 0acttl#0;
|BLIN 4;
|FCAL;

|CALCULO siimpre;|TIPO 3;
|CONFI mensajei;
|SI 0 = FSalida;
  |HAZ impreal;
|FINSI;
|FCAL;

|CALCULO imprelim;|TIPO 0;
codigo  = #3#2;
descrip = #3#4;
dto     = #3#8;
dto1    = #3#21;
precio  = #3#6;
unid    = #3#5;
imptot  = #3#9;
tiva    = #3#11;
linea   = 1;
|PRINT;
|HAZ impdesam;
   |ABRE #15;
      #15#0 = #3#2;
      |LEE 040#15=;
      |LIBERA #15;
           |SI FSalida = 0;
               |BUCLELIN 0escanlinea#15;
           |FINSI;
   |LIBERA #15;
   |CIERRA #15;
|FCAL;

|CALCULO impdesam; |TIPO 0;
#13#0 = #3#18;
  |ABRE #13;
  |LEE 101#13=;
  |LIBERA #13;
  |SI 0=FSalida;
  |HAZ descripc;
|FINSI;
|LIBERA #13;
|CIERRA #13;
|FCAL;

|CALCULO descripc;
indtope = 0;
|PARA ind = 6;|SI ind >0; |HACIENDO ind = ind-1;
      descrip = #13ind;
      |QBF descrip;
      |SI descrip ! vacio;
          indtope = ind + 1;
          ind = 0;
      |FINSI;
|SIGUE;

|PARA ind = 1; |SI ind < indtope; |HACIENDO ind = ind+1;
      descrip = #13ind;
      linea = 0;
      |PRINT;
|SIGUE;
|FCAL;



|CALCULO impreal;|TIPO 4;
|IMPRE 2;
|SI 0 = FSalida;
     |HAZ mirainf;
  |INFOR informe;
  |SI 0 = FSalida;
     |SI #0#3 ! #6#0;
       |ABRE #6;
       #6#0 = #0#3;
       |LEE 040#6=;
       |SI 0 ! FSalida ;|DDEFECTO #6;|FINSI;
       |LIBERA #6;
       |CIERRA #6;
     |FINSI;
     |BUCLELIN 2imprelim#0;
     |PIEINF;
     |FININF;
  |FINSI;
  |FINIMP;
  #0#10 = AS;
  |GRABA 121#0a;
  |LIBERA #0;
|FINSI;
|FCAL;

|CALCULO actutot;|TIPO 0;
   ||#0#41 = #0#15 - #0#25;
   ||#0#41 = #0#41 + #0#11;
   ||#0#41 = #0#41 + #0#13;
   ||#0#41 = #0#41 + #0#24;
|FCAL;

|CALCULO escanlinea;
    unid = #16#4 * #3#5;
    descrip = #16#3;
    codigo = "";
    dto = 0;
    precio = 0;
    imptot = 0;
    tiva = 0;
    linea = 1;
    |PRINT;
|FCAL;

|PROCESO mirainf;
     |ABRE #40;
     #40#26 = #0#48;
     |LEE 001#40=;
     |SI FSalida = 0;
          informe = #40#11; |QBF informe;
     |SINO;
          informe = informe1;
     |FINSI;
     |LIBERA #40;
     |CIERRA #40;
|FPRC;


|PROCESO cargaiva;|TIPO 0;
|SI totalb = 0;
     enTiva = 1; efFiva = #0#1; |HAZ SacaIVA;
     #0#50 = enIva;#0#51 = enRec;

     enTiva = 2; efFiva = #0#1; |HAZ SacaIVA;
     #0#52 = enIva;#0#53 = enRec;

     enTiva = 3; efFiva = #0#1; |HAZ SacaIVA;
     #0#54= enIva;#0#55 = enRec;

     enTiva = 4; efFiva = #0#1; |HAZ SacaIVA;
     #0#56 = enIva;#0#57 = enRec;

     enTiva = 5; efFiva = #0#1; |HAZ SacaIVA;
     #0#58= enIva;#0#59 = enRec;
|FINSI;
|FPRC;

|PROCESO recoge;
     modo = 1;
     |SI modo = 1; |HAZ cargaiva; |FINSI;
|FPRC;

|PROCESO mira_d;
     |ABRE #41;
     |DDEFECTO #41;
     #41#0 = "A";
     |LEE 001#41=;
     |LIBERA #41;
     |CIERRA #41;
     n_dec = #41#8;
     n_pre = #41#9;
|FPRC;

|PROCESO past1;
|FPRC;

|PROCESO pasa;
     |DDEFECTO #0;
     numero = "000000" + #99#1;
     numero = numero % -106;
     #0#0 = numero;                || Numero Factura.
     #0#48 = #99#2;                || Serie Factura.
     #0#1 = #99#3;                 || Fecha.
     #0#3 = #99#4;                 || Cod. Cliente.
     |ABRE #6;
          #6#0 = #99#4;
          |LEE 000#6=;
     |LIBERA #6;
     |CIERRA #6;
     #0#4 = #6#2;                  || Nombre Cliente.
     #0#5 = #6#37;                 || Dto.
     #0#6 = #6#25;                 || Representante.
     #0#7 = #6#38;                 || Dto. P.P.
     #0#8 = #6#20;                 || Forma de Pago.
     #0#9 = #6#35;                 || Agencia Transporte.
     #0#10 = "N";                  || Fact. Impresa.
     #0#25 = 0;                    || Total Descuento.
     #0#29 = #6#1;                 || Entregar a.
     #0#30 = #6#5;                 || Direccion entraga.
     #0#31 = #6#6;                 || Pob. entre.
     #0#33 = #6#7;                 || Prov. entre.
     #0#32  = 0;                   || Dto. acumulado.
     #0#35 = #6#4;                 || Tipo Cliente.
     #0#36 = #6#47;                || Regimen equiva.
     #0#38 = #99#7;                || Entrega a Cuenta.
     #0#39 = "N";                  || Contabilizada.
     #0#40 = #6#16;                || Numero de cta.
     #0#15 = #99#8;                || Bruto Fact.
     #0#60 = #6#15;                || Cif.
     #0#61 = #99#10;               || Importe Envase.
     |HAZ cogecon0;
     |HAZ fcaccli;
     |HAZ recoge;
     |HAZ mira_d;
     |HAZ pedcon0;
     |ABRE #43;
     #43#2 = #0#48;
     #43#0 = tipo;
     |LEE 010#43=;
     |SI FSalida ! 0;
       #43#1 = #0#0 + 1;
       |GRABA 010#43n;
     |SINO;
       #43#1 = #0#0 + 1;
       |GRABA 010#43a;
     |FINSI;
     |LIBERA #43;
     |CIERRA #43;
     #0#25 = #0#15 < #0#5;
     #0#25 = #0#25 < #0#7;
     #0#25 = #0#15 - #0#25;
     |GRABA 121#0n;
     |LIBERA #0;
|FPRC;

|DEFBUCLE lee;
     #99#1;
     ;
     "F","  ",000000;
     "F","zz",999999;
     be;
     NULL,pasa;
|FIN;

|PROGRAMA;
     modo = 1;
     |ABRE #0;
     |BUCLE lee;
     |LIBERA #0;
     |CIERRA #0;
|FPRO;
