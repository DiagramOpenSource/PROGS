|FICHEROS;
     gomantho #0;
     gomantl1 #1;
     agifa027 #2;                                 ||Contadores.
     gopre001 #3;                                 ||Presupuestos Cab.
     gopartca #4;                                 ||Partes de Trabajo.
     gopartid #5;                                 ||Partidas.
     gopre003 #6;                                 ||Partidas Presupuesto.
     gomatcab #7;                                 ||Partes de Materiales (CAB).
     gomatlin #8;                                 ||Partes de Materiales (LIN).
     gomatljn #9;                                 ||Partes Materiales (Presupuesto).
     gotmppr1 #10,MANTE;                          ||Temporal Presupuestos.
     gopartll #11;                                ||Partes Trabajo(lin).
     gopartli #12;                                ||Partes Trabajo(Dias).
     godeexpf #13,MANTE;                          ||Seguimientos
     godeexpe #14;                                ||Seguimientos L.
     gosubcoc #15;
     gosubpar #16;
     gocallac #17;                                ||Calendario Laboral (cab).
     gocallal #18;                                ||Calendario Laboral (lin).
     goptrbca #20;                                ||Partes trabajo Cab.
     goptrbli #21;                                ||Partes Trabajo Lin.
     gopartia #22;
     gotmpdia #23;
     agifa029 #24;                                ||Almacenes.
     gotmpalm #26;
     agifa007 #27;                                ||Series Gestion
     gomantca #100;                               ||Cabecera principal Mantenimiento.
     gomantli #101;
     goparame #102;
     goalbpa3 #103;
     gopre004 #104;
     gotiobra #105;
     goticlie #106;
     godeprel #202;
     agifa069 #203;
     gopre002 #107;
     agifa077 #204;
     agifa080 #205;
     agifa019;

     gotrabaj;
     gocercab;
     gopre001@ #500;
     gopre015 #80;
     referen@ #200;
     agifa142 #142;
|FIN;
-----------------------------------------------------------------------------
|VARIABLES;
     aEstado = "";
     nSwEstadoTodos = 0;
     aSer = "";
     nNume = 0;
     nHay = 0;
     &eaTitulo = "";
     &eaSerie = "";
     &enPresupu = 0;
     &eaCliente = "";
     &eaNomCli = "";
     &eaMoneda = "";
     nErrFest = 0;
     aHClien = "";
     aDClien = "";
     aSerAnt = "";
     nNumAnt = 0;
     nLinPres = 0;
     nNume1 = 0;
     aAlfa1 = "";
     &eaFicImpre = "";
     &eaPrograma = "";
     aDef       = "";
     nTecla     = 0;
     i          = 0;
     &aTempo10  = "";
     &Tempo     = "";
     nContax    = 0;
     &eaSer     = "";
     &enNum     = 0;
     &eaTipo    = "";
     &eaTipoD   = "";
     &enEvento  = 0;
     &enEnvio   = 0;
     &eaOrigen  = "";
     &eaDestino = "";
     &eaAsunto  = "";

     &enModo        = 0;
     dVacio         = "                    ";
     hVacio         = "zzzzzzzzzzzzzzzzzzzz";
     aAlf1          = "";
     aAlf2          = "";
     nMiError       = 0;
     nSal           = 0;
     nJOAnt         = 0;
     aClave         = "";
     bClave         = "";
     cClave         = "";
     dClave         = "";
     nClave         = 0;
     nMod           = 0;
     nCuan          = 0;
     swSi           = 0;
     aSerPre        = "";
     aNumPre        = 0;
     nLin           = 0;
     &xQuien        = 0;
     &xQtip         = 0;
     &xDocTras      = 0;
     &xSerie        = "";
     &xFecDocu      = @;
     &xLinDocu      = 0;
     &xCodArti      = "";
     &xDesArti      = "";
     &xCanArti      = 0;
     &xAlmEntr      = 0;
     &xAlmSali      = 0;
     &xModo         = 0;
     &xForma        = 0;

     aModo24 = "";
     aModo25 = "";
     aModo26 = "";

     nAntNum        = 0;

     aFich          = "";
     swSihay        = 0;
     qEstado        = "";
     swHayPre       = 0;
     &cCodMonBase   = "";
     &cDesMonBase   = "";
     &cCodMonTrab   = "";
     &cDesMonTrab   = "";

     &nDeci_Medi    = 0;
     &nDeci_Meda    = 0;
     &nDeci_Incr    = 0;
     &nDeci_PBase   = 0;
     &nDeci_TBase   = 0;
     &nDeci_PTrab   = 0;
     &nDeci_TTrab   = 0;
     &nDeci_TotVis  = 0;
     &nEurComTrab   = 0;
     &nEurComBase   = 0;
     &nEurVenTrab   = 0;
     &nEurVenBase   = 0;

 {-1}menu           = "";
     menu1          = "2400";
     menu2          = "1";
     menu3          = "Contador:  ";
     menu4          = "AM";
     menu5          = " Automatico ";
     menu6          = " Manual ";

     &cPresuN       = "";
     &cPresuS       = "";
     &cExped        = "";
      nMov          = 0;
     &cNuExp          = 0;
     &cNuPre          = 0;

     nConta         = 0;
     nModo          = 0;
     nLinea         = 0;
     nBorrado       = 0;
     nFecAct        = 0;
     nError         = 0;
     nBotPresu      = 0;
     nBotCerti      = 0;
     nBotParti      = 0;
     nBotPreCli     = 0;
     nBotSegui      = 0;
     nAnoIni        = 0;
     nAnoFin        = 0;
     nAnos          = 0;
     cAnos          = "";
     nCua           = 0;
     nDias          = 0;
     nSuma          = 0;
     nTotDias       = 0;
     nFecIni        = 0;
     nFecFin        = 0;
     nCampo         = 0;

     cAno           = "";
     cMonPre        = "";
     cConta         = "";
     cFecIni        = "";
     cFecFin        = "";
     cFecha         = "";
     cDia           = "";
     cFich          = "";

     fFecha         = @;
     fDia           = @;
     fFecFin        = @;
     fFecIni        = @;

     &aCodigo       = "";
     &jLinea        = 0;
     &aSerie        = "";
     &jFecha        = @;
     &nErrorInf     = 0;
     cAnoFin        = "";
     cAnoIni        = "";
     codPro         = "";
     aAlfa          = "";
     aAlfa2         = "";
     bAlfa          = "";
     nAmp2          = 0;
     &aDivisa       = "";
     &aMoneda       = "";

     &enLinea = 0;
     aAntCod = "";
     aAntDes = "";
     nAntPre = 0;
     aUltCap = "";
     aUltPart = "";
     nume = 0;
     aCP = "";
     nCP = 0;
     aMensaje = "";
|FIN;
-----------------------------------------------------------------------------
|PROCESO ModiFec; |TIPO 11;
     |SI FSalida = 13;
          |LEE 101#1=;
          |SI FSalida = 0;
               |C_M #1#7, 0, aAlf1;
               |C_M #1#8, 0, aAlf2;
               |C_M #1#7, 1, "S";
               |C_M #1#8, 1, "S";
             |ET E1;
               |ENCAMPO #7#1;
               |SI FSalida = 2; |VETE E2; |FINSI;
               |SI FSalida = 7; |VETE E3; |FINSI;
               |ENCAMPO #8#1;
               |SI FSalida = 2; |VETE E1; |FINSI;
               |SI FSalida = 7; |VETE E3; |FINSI;
             |ET E2;
               |C_M #1#7, 1, aAlf1;
               |C_M #1#8, 1, aAlf2;
               |GRABA 020#1a;
               |ERROR; |ACABA;
             |ET E3;
               |LEE 000#1=;
               |PINTA #1#7;
               |PINTA #1#8;
          |FINSI;
          |ERROR;
     |FINSI;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO DiasFest; |TIPO 0;
     nErrFest = 0;

     nSuma = 0;
     nTotDias = 0;
     cFecIni = #1#7;                              ||Fecha de Inicio.
     cFecFin = #1#8;                              ||Fecha de Fin.
     cFecIni = cFecIni % 704;                     ||Año de Inicio.
     cFecFin = cFecFin % 704;                     ||Año de Fin.
     nAnoIni = cFecIni;                           ||Año de Inicio.
     nAnoFin = cFecFin;                           ||Año de Fin.
     cAnoIni = cFecIni;
     cAnoFin = cFecFin;
     cFecIni = #1#7;                              ||Fecha de Inicio.
     cFecFin = #1#8;                              ||Fecha de Fin.

     |ABRE #17;
     |ABRE #18;

     /*MIRAMOS SI EXISTE EL AÑO LABORAL DE LA FECHA FINAL.*/

     codPro = #0#4 % 102;

     aAlfa = codPro + cAnoFin;

     #17#0 = aAlfa;
     |LEE 000#17=;

     nErrFest = FSalida;
     |SI FSalida ! 0;
          |MENAV "0000NO EXISTE A¥O LABORAL DE LA FECHA FINAL";
          |ERROR;
          |ACABA;
     |FINSI;

     /*MIRAMOS SI EXISTE EL AÑO LABORAL DE LA FECHA INICIAÑ.*/

     aAlfa = codPro + cAnoIni;

     #17#0 = aAlfa;
     |LEE 000#17=;
     nErrFest = FSalida;

     |SI FSalida ! 0;
          |MENAV "0000NO EXISTE A¥O LABORAL DE LA FECHA DE INICIO";
          |ERROR;
          |ACABA;
     |FINSI;

     |PARA nAnos = nAnoIni; |SI nAnos [ nAnoFin; |HACIENDO nAnos = nAnos + 1;

          aAlfa = nAnos;
          |QBF aAlfa;
          cAnos = ("0000" + aAlfa) % -104;
          cAnos = codPro + cAnos;

          |SI nAnoIni! nAnoFin;

               |SI nAnos = nAnoIni;
                    fFecIni = cFecIni;
                    bAlfa   = "31.12." + nAnoIni;
                    fFecFin = bAlfa;
               |FINSI;

               |SI nAnos = nAnoFin;
                    bAlfa   = "01.01." + nAnoFin;
                    fFecIni = bAlfa;
                    fFecFin = cFecFin;
               |FINSI;

          |SINO;
               fFecIni = cFecIni;
               fFecFin = cFecFin;
          |FINSI;

          #17#0 = cAnos;
          |LEE 000#17=;

          |PARA fFecha = fFecIni; |SI fFecha [ fFecFin; |HACIENDO fFecha = fFecha + 1;
               cFecha = fFecha;
               fDia = fFecha % 1;
               cDia = fDia % 1115;
               |QBF cDia;
               |HAZ MiraFech;

               |SI nSuma = 0;

                    |SI cDia = "Lunes";
                          |SI #17#1 = "N";nSuma = nSuma + 1;|FINSI;
                    |FINSI;

                    |SI cDia = "Martes";
                          |SI #17#2 = "N";nSuma = nSuma + 1;|FINSI;
                    |FINSI;

                    |SI cDia = "Miercoles";
                          |SI #17#3 = "N";nSuma = nSuma + 1;|FINSI;
                    |FINSI;

                    |SI cDia = "Jueves";
                         |SI #17#4 = "N";nSuma = nSuma + 1;|FINSI;
                    |FINSI;

                    |SI cDia = "Viernes";
                         |SI #17#5 = "N";nSuma = nSuma + 1;|FINSI;
                    |FINSI;

                    |SI cDia = "Sabado";
                         |SI #17#6 = "N";nSuma = nSuma + 1;|FINSI;
                    |FINSI;

                    |SI cDia = "Domingo";
                         |SI #17#7 = "N";nSuma = nSuma + 1;|FINSI;
                    |FINSI;

               |FINSI;

               nTotDias = nTotDias + nSuma;

               |SI Campo ! 8;
                    fFecFin = fFecFin + nSuma;
               |SINO;
                    |SI fFecha = fFecFin; |Y nSuma = 1;
                         |MENAV "0000LA FECHA FIN ES UN DIA FESTIVO";
                         |ERROR;
                         nErrFest = 1;
                    |FINSI;
               |FINSI;

               nSuma = 0;
          |SIGUE;

     |SIGUE;

     |CIERRA #17;
     |CIERRA #18;

|FPRC;
-----------------------------------------------------------------------------
|PROCESO MiraFech;
     |SELECT #2#18;
     #18#0 = cAnos;
     #18#2 = fFecha;
     |LEE 000#18=;

     |SI FSalida = 0;
          nSuma = 1;                              ||Es un día festivo.
     |SINO;
          nSuma = 0;                              ||No es festivo.
     |FINSI;

|FPRC;
-----------------------------------------------------------------------------
|PROCESO Fechas; |TIPO 0;
     |SI Campo = 7; |Y Contenido ! #1#7;          ||Fecha de Inicio.
          #1#8 = #1#7 + #1#15;                    ||Fecha fin sin festivos.
          nFecFin = #1#8;
          nFecFin = nFecFin - 1;
          #1#8 = nFecFin;
          |HAZ DiasFest;
          |SI nErrFest ! 0; |ERROR ;|ACABA; |FINSI;
          #1#8 = fFecFin;                         ||Fecha fin con festivos.
     |FINSI;

     |SI Campo = 8; |Y Contenido ! #1#8;          ||Fecha Fin.
          |HAZ DiasFest;
          |SI nErrFest ! 0; |ERROR ;|ACABA; |FINSI;
          nFecIni = #1#7;
          nFecFin = fFecFin;
          #1#15 = (nFecFin - nFecIni)             ||Dias estimados sin festivos.
          #1#15 = #1#15 - nTotDias;               ||Dias estimados con festivos.
          #1#15 = #1#15 + 1;
     |FINSI;

     |SI Campo = 15; |Y Contenido ! #1#15;        ||Dias Estimados.
          #1#8 = #1#7 + #1#15;                    ||Fecha fin sin festivos.
          nFecFin = #1#8;
          nFecFin = nFecFin - 1;
          #1#8 = nFecFin;
          |HAZ DiasFest;
          |SI nErrFest ! 0; |ERROR ;|ACABA; |FINSI;
          #1#8 = fFecFin;                         ||Fecha fin con festivos.
     |FINSI;

     |SI #1#15 < 1;
          |MENAV "0000NO PUEDE ACABAR EL PRESUPUESTO EL MISMO DIA QUE EMPIEZA";
          |ERROR;
          |ACABA;
     |FINSI;

     |PINTA #1#7; |PINTA #1#8; |PINTA #1#15;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO ConExp; |TIPO 0;
     nModo = (FEntrada/100)!0;

     |C_M #0#1, 0, aAlfa;

     |SI nModo ! 1; |O aAlfa = "N";
          |ACABA;
     |FINSI;


     |MENU menu;

     |SI FSalida = 1;    ||Automatico
          |ABRE #2;
          #2#0 = "expobras";
          #2#2 = #0#0;
          |LEE 101#2=;

          |SI FSalida = 0;
               #2#1 = #2#1 + 1;
               nConta = #2#1;
               |GRABA 021#2a;
               |PTEC 802;
          |SINO;
               nConta = 1;
               #2#1 = 1;
               |GRABA 021#2n;
          |FINSI;

          cConta = nConta;
          cConta = ("000000" + cConta) % -106;
          #0#1 = cConta;
          |PINTA #0#1;
          |LIBERA #2;
          |CIERRA #2;
     |FINSI;

|FPRC;
-----------------------------------------------------------------------------
|DEFBUCLE BorraPartida;
     #5#1;
     ;
     #1#3, #1#4, 1;
     #1#3, #1#4, 999;
     ;
     NULL, BorraPartida;
|FIN;
-----------------------------------------------------------------------------
|PROCESO Llena10;
     |SI #102#52 = "S";
          |SI #3#1 < #102#58; |O #3#1 > #102#59;
               |ACABA;
          |FINSI;
          #500#0 = #3#0;
          #500#1 = #3#1 + #102#54;
          |LEE 000#500=;
          |SI FSalida = 0; |Y #500#16 > 0;
               |ACABA;
          |FINSI;
     |FINSI;

     |PARA i = 0; |SI i [ 46; |HACIENDO i = i + 1;
          #10i = #3i;
     |SIGUE;
     |GRABA 020#10n;
|FPRC;

|DEFBUCLE Llena10;
     #3#2;
     ;
     " ", " ", aDClien, " ", "     ",      1, #0#6;
     "z", " ", aHClien, "z", "zzzzz", 999999, #0#6;
     ;
     NULL, Llena10;
|FIN;

|PROCESO AltaPresupu;
     |SI #1#4 = 0;
          |ABRE #2;
          #2#0 = "vfacprof";
          #2#2 = #1#3;
          |LEE 101#2=;
          |SI FSalida = 0;
               #2#1 = #2#1 + 1;
               nConta = #2#1;
               |GRABA 021#2a;
          |SINO;
               nConta = 1;
               #2#1 = 1;
               |GRABA 021#2n;
          |FINSI;
          #1#4 = nConta;
          |PINTA #1#4;
          |CIERRA #2;
     |FINSI;

     eaSerie = #1#3;
     enPresupu = #1#4;
     eaCliente = #0#2;
     eaNomCli = #0#8;
     eaMoneda = #0#6;
     eaTitulo = #0#29;
     |SUB_EJECUTA_NP "gomaz002";
     |SI enPresupu ! 0;
          |PTEC 802;
     |FINSI;
|FPRC;

|PROCESO PresClie; |TIPO 0;
     nTecla = FSalida;
     nModo = (FEntrada/100) ! 0;
     |ABRE #102; |LEE 000#102p; |CIERRA #102;
     |HAZ BHmnt;
     |SI nModo = 1; |O nModo = 0;
          |SI nTecla = 10; |O nTecla = 11;
               |DDEF aDef;
               aDef = aDef + "gopre001";
               |CARGA_DEF aDef, gopre001@;
               |SI FSalida ! 0;
                    aDef = "0000Error al cargar: " + aDef;
                    |MENAV aDef;
                    |ERROR; |ACABA;
               |FINSI;
               |SI nTecla = 10;
                    aDClien = #0#2;
                    aHClien = #0#2;
               |SINO;
                    aDClien = "      ";
                    aHClien = "zzzzzz";
               |FINSI;
               |ABRE #500;
               |HAZ CreaTempo; aTempo10 = Tempo;
               |NOME_DAT #10 aTempo10; |DELINDEX #10;
               |ABRE #10;
               |BUCLE Llena10;
               |CIERRA #10;
               |CIERRA #500;
               |DESCARGA_DEF #gopre001@;

               cPresuN = "";
               cPresuS = "";
               |PUSHV 01012380;
               |CLS;
               |SI nTecla = 10;
                   |ENTLINEAL #2#10, -5, 4, 22, 1, PreMin, PreMax;
               |SINO;
                   |ENTLINEAL #1#10, -1, 4, 22, 1, PreMin, PreMax;
               |FINSI;
               |POPV;
               |DELINDEX #10; Tempo = aTempo10; |HAZ BoraTempo;
               #1#3 = cPresuS; |PINTA #1#3;
               #1#4 = cPresuN; |PINTA #1#4;
          |FINSI;

          |ABRE #3;
          #3#0 = #1#3;
          #3#1 = #1#4;
          |LEE 000#3=;
          |SI FSalida ! 0;
               |SI #102#32 = "H";
                    |AVISO;
                    |CONFI "00000EL PRESUPUESTO NO EXISTE, ¿DESEA DARLO DE ALTA?";
                    |SI FSalida = 0;
                         |HAZ AltaPresupu;
                    |FINSI;
               |SINO;
                    |MENAV "0000EL PRESUPUESTO INTRODUCIDO NO EXISTE";
               |FINSI;
               |HAZ BHmnt;
               |CIERRA #3;
               |ERROR; |ACABA;
          |SINO;
               #1#3 = #3#0;        ||Serie.
               #1#4 = #3#1;        ||N§ Presu.
               #1#5 = #3#18;       ||Tipo presupuesto.
               #1#6 = #3#4;        ||Fecha Presu.
               #1#7 = #3#11;       ||Fecha inicio
               #1#8 = #3#12;       ||Fecha terminacion
               #1#9 = #3#5;        ||Total Presu. sin IVA. Venta
               #1#13 = #3#6;       ||Total Presu. sin IVA. Coste
               #1#15 = #3#13;      ||Dias Estimados.
               cMonPre = #3#7;     ||Divisa.
               |QBF cMonPre;
               |HAZ PasaPart;
               |PINTA #1#3;|PINTA #1#4;|PINTA #1#6;|PINTA #1#5;
               |PINTA #1#7;|PINTA #1#8;|PINTA #1#9;|PINTA #1#13;
               |PINTA #1#15;
               cMonPre = #3#7;    ||Divisa.
               |QBF cMonPre;
          |FINSI;
          |CIERRA #3;

          |SI cMonPre ! #0#6;
               |MENAV "0000LA MONEDA EMPLEADA EN EL PRESUPUESTO ES DISTINTA";
               |HAZ BHmnt;
               |ERROR; |ACABA;
          |FINSI;
          |SI #3#2 ! #0#2;
               |AVISO;
               aAlfa = "0000NEl Cliente '"+#3#2+"' no corresponde con el del expediente. CONTINUAR:";
               |CONFI aAlfa;
               |SI FSalida ! 0;
                    |HAZ BHmnt;
                    |ERROR; |ACABA;
               |FINSI;
          |FINSI;
     |FINSI;

     |SI nModo = 2;
          |HAZ PasaPart;
     |FINSI;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO PreMin;
     #10#0  = "     ";
     #10#1  = 1;
     #10#2  = aDClien;
     #10#7  = #0#6;
     #10#17 = " ";
     #10#19 = " ";
     #10#20 = " "; ||Edificacion Horizontal
     #5#0  = #1#3;
     #5#1  = #1#4;
     #5#4  = 1;
|FPRC;

|PROCESO PreMax;
     #10#0  = "zzzzz";
     #10#1  = 999999;
     #10#2  = aHClien;
     #10#7  = #0#6;
     #10#17 = " ";
     #10#19 = "z";
     #10#20 = "z"; ||Edificacion Horizontal
     #5#0  = #1#3;
     #5#1  = #1#4;
     #5#4  = 999;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO MonTra; |TIPO 14;
     nModo = (FEntrada/100)!0;

     |SI cCodMonTrab ! #0#6;
          cCodMonTrab = #0#6;
          |HAZ MonBas;
     |FINSI;

     |HAZ LinPar;
     |HAZ Parciales;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO CalTotExp; |TIPO 2;  || gomantl1
     |ABRE #102; |LEE 000#102p; |CIERRA #102;

     nModo = (FEntrada/100)!0;
     nCuan = 0 +. 1;
     nMiError = 0;

     aAlfa = #1#27; |QBF aAlfa;    || Asigna el usuario;
     |SI aAlfa = "";
          aAlfa = Usuario % 810;
          #1#27 = aAlfa;
     |FINSI;

     |SI #1#4 [ 0; || POR ERRORES DE INTRODUCCION ???
          |ACABA;
     |FINSI;

     |SI nModo = 3;
          |HAZ CompruebaStan;
          |SI nMiError = 0;
               |HAZ BajaStan;
          |SINO;
               |ERROR;
               |ACABA;
          |FINSI;

          nLinPres = #1#2;
          #0#25 = "01.01.0000";
          |HAZ UltFecPresu;
          |PINTA #0#25;
     |FINSI;

     |SI nCuan > 0;
          |SI #1#10 = "C"; |Y #1#26 = "01.01.1000";
               fFecha = ~;
               #1#7 =  fFecha;
               #1#26 = fFecha;
               #1#8 = #1#7 + #1#15;                    ||Fecha fin sin festivos.
               nFecFin = #1#8;
               nFecFin = nFecFin - 1;
               #1#8 = nFecFin;
               |HAZ DiasFest;
               #1#8 = fFecFin;                         ||Fecha fin con festivos.
               #1#25 = 0;
          |FINSI;
     |FINSI;

     |ABRE #3;
     #3#0 = #1#3;
     #3#1 = #1#4;
     |LEE 120#3=;
     |SI FSalida = 0;
          #1#29 = #3#8;       ||Titulo presupuestos
          |SI nModo = 2;
               #1#9 = #3#5;        ||Total Presu. sin IVA. Venta
               #1#13 = #3#6;       ||Total Presu. sin IVA. Coste
          |FINSI;
          |SI nCuan = 1;
               #3#40 = "S";
               #3#15 = #0#0;
               #3#16 = #0#1;
               #3#17 = #1#10;
          |SINO;
               #3#40 = "N";
          |FINSI;
          |SI nModo = 3;
               #3#15 = "     ";
               #3#16 = 0;
               #3#17 = " ";
          |FINSI;
          |GRABA 020#3a;
          |LIBERA #3;

          |SI nModo = 3; ||| Y el original por si hay copia
               #3#1 = #1#28;
               |LEE 101#3=;
               |SI FSalida = 0;
                    #3#15 = "     ";
                    #3#16 = 0;
                    #3#17 = " ";
                    #3#40 = "N";
                    |GRABA 020#3a;
               |FINSI;
          |FINSI;
     |FINSI;
     |CIERRA #3;

     #1#12 = #1#9 / nEurComTrab * nEurComBase;
     #0#5  = #0#5  +. #1#9;
     #0#7  = #0#7  +. #1#12;
     #0#10 = #0#10 +. #1#13;
     |PINTA #0#5;
     |PINTA #0#10;

     |SI nModo = 1;
        enEvento = 1; eaTipo = "01";
        eaAsunto = "Asignacion Pres. '" + #1#3 + "/" + (("000000" + #1#4) % -106);
        eaAsunto = eaAsunto + "' a Expte. '" + #1#0 + "/" + (("000000" + #1#1) % -106) + "'";
        eaOrigen = Usuario % 0810;
        eaPrograma = "gomantho" + #0#0 + #0#1;
        |HAZ FicEnvio;
        |HAZ EnviaEvento;
        |SI #gomantho#30 ! 0;
           |ABRE #gotrabaj;
           #gotrabaj#0 = #gomantho#30;
           |LEE 000#gotrabaj.=;
           |SI FSalida ! 0; |DDEFECTO #gotrabaj; |FINSI;
           |CIERRA #gotrabaj;

           enEnvio  = 0;
           eaOrigen = Usuario % 0810;
           eaDestino = #gotrabaj#27;
           eaPrograma = "gomantho" + #0#0 + #0#1;
           |HAZ FicEnvio;
           |HAZ EnviaDSCorreo;
        |FINSI;
     |FINSI;

     |SI nCuan > 0; |Y nModo = 1;
        #1#28 = #1#4;;
        eaTipo = "E";eaSer = #1#3; enNum = #1#4; |HAZ ModifPres;
        #1#4 = enNum; |PINTA #1#4;
     |FINSI;

     |SI #102#52 = "S";
          |SI nModo = 1; |O nModo = 3;
               enModo = nModo; eaTipoD = "E";
               |MENSA "2400DUPLICANDO PRESUPUESTO...";
               aAlfa = "gopredup" + &59 + #1#3 + (("000000" + #1#28) % -106);
               |SUB_EJECUTA_NP aAlfa;
               |BLIN 24;
               |SI nModo ! 3;
                    ||ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄEl error de la copia
                    |ABRE #3;
                    #3#0 = #1#3;
                    #3#1 = #1#4;
                    |LEE 120#3=;
                    |SI FSalida = 0;
                         #3#40 = "S";
                         #3#15 = #0#0;
                         #3#16 = #0#1;
                         #3#17 = #1#10;
                         |GRABA 020#3a;
                    |FINSI;
                    |CIERRA #3;
               ||ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
               |FINSI;
          |FINSI;
          |SI #102#55 = "S";
/*  Subtiquet nro. 00861.0002 Cliente: 002743
   Mon Sep 26 12:42:00 CEST 2005
               |ABRE #gopre001;
               #gopre001#0 = eaSer;
               #gopre001#1 = nAntNum;
               |LEE 101#gopre001.=;
               |SI FSalida = 0;
                  #gopre001#15 = "";
                  #gopre001#16 = 0;
                  #gopre001#17 = "";
                  |GRABA 020#gopre001.a; |LIBERA #gopre001;
               |FINSI;
               |CIERRA #gopre001;
*/
          |FINSI;
     |FINSI;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO TipAcc; |TIPO 11;
     |HAZ BHmnt;
     nModo = (FEntrada/100)!0;

     |SI FSalida = 10;                  ||Ver Presupuesto.
          |PTEC 802;
          |PTEC 811
          |SI nModo ! 4; |GRABA 020#0a; |FINSI;
          |LIBERA #0;
          |LIBERA #1;
          |CIERRAT #0;
          |CIERRAT #1;
          aAlfa = "gopre001" + &59 + #1#3 + (("000000" + #1#4) % -106) ;
          |SUB_EJECUTA aAlfa;
          |ABRET #0;
          |ABRET #1;
          |SI nModo = 4;
               |LEE 000#0=;
               |LEE 000#1=;
          |SINO;
               |LEE 121#0=;
               |LEE 121#1=;
          |FINSI;
          |ERROR;

          |HAZ BSmnt;
          |ACABA;
     |FINSI;
     |SI FSalida = 11;        ||Certificaciones
          |ABRE #gocercab;
          #gocercab#0 = #1#3;
          #gocercab#1 = #1#4;
          |LEE 000#gocercab.=;
          |SI FSalida ! 0; |Y #goparame#52 = "S";
               #gocercab#1 = #gocercab#1 + #goparame#54;
               |LEE 000#gocercab.=;
               |SI FSalida ! 0;
                    #gocercab#1 = #gocercab#1 - #goparame#54 - #goparame#54;
                    |LEE 000#gocercab.=;
                    |SI FSalida ! 0;
                         #gocercab#1 = #gocercab#1 + #goparame#56;
                         |LEE 000#gocercab.=;
                         |SI FSalida ! 0;
                              #gocercab#1 = #gocercab#1 - #goparame#56 - #goparame#56;
                              |LEE 000#gocercab.=;
                         |FINSI;
                    |FINSI;
               |FINSI;
          |FINSI;
          |SI FSalida = 0;
               aAlfa = "dsz99952;" + #gocercab#0 + #gocercab#1;
               |SUB_EJECUTA aAlfa;
          |SINO;
               |MENAV "0000No existe certificacion...";
          |FINSI;
          |CIERRA #gocercab;
          |ERROR;
          Campo = 2;
          |HAZ BSmnt;
          |ACABA;
     |FINSI;
     |SI FSalida = 12;                  ||Ver Seguimientos.
          |PUSHV 0101 2380;
          |COLOR 0, 3; |ATRI 0;
          |BLANCO 0615 1865;
          ||COLOR 0, 3; |ATRI 0;
          ||CUADRO 06151965;
          |PINTA 0717, "SEGUIMIENTOS:";
          |ENTLINEAL #1#13 , -5 , 2 , 15 , 1 , inf , sup;
          |POPV;
          |ERROR;
          Campo = 2;
          |HAZ BSmnt;
          |ACABA;
     |FINSI;

|FPRC;
-----------------------------------------------------------------------------
|RUTINA inf;
     #13#0 = #1#0;
     #13#1 = #1#1;
     #13#2 = #1#3;
     #13#3 = #1#4;
     #13#4 = 1;
|FRUT;
-----------------------------------------------------------------------------
|RUTINA sup;
     #13#0 = #1#0;
     #13#1 = #1#1;
     #13#2 = #1#3;
     #13#3 = #1#4;
     #13#4 = 999;
|FRUT;
-----------------------------------------------------------------------------
|PROCESO ActCam; |TIPO 0;
     nModo = (FEntrada/100)!0;

     |SI nModo = 1;
          |C_M #0#2, 1, "S";
          |C_M #0#9, 1, "N";
     |SINO;
          |C_M #0#2, 1, "N";
          |C_M #0#9, 1, "S";
     |FINSI;

|FPRC;
-----------------------------------------------------------------------------
|PROCESO BorraPartida;
     |BORRA 020#5a;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO AlbPres;
     nMiError = 1;
     |ERROR10;
|FPRC;
-----------------------------------------------------------------------------
|DEFBUCLE AlbPres;
     #9#1;
     ;
     #8#3, #8#4,    1;
     #8#3, #8#4, 9999;
     ;
     NULL, AlbPres;
|FIN;
-----------------------------------------------------------------------------
|PROCESO BorraAlbAdj;
     |SI #8#3 = #1#3; |Y #8#4 = #1#4;
          |BORRA 020#8a;
     |FINSI;
|FPRC;

|PROCESO CompruAlbAdj;
     |SI #8#3 = #1#3; |Y #8#4 = #1#4;
          |BUCLE AlbPres;
          |SI nMiError ! 0;
               |MENAV "0000HAY ALBARANES ASOCIADOS QUE TIENE QUE DAR DE BAJA";
          |FINSI;
     |FINSI;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO Certif1;
     |ABRE #gocercab;
     #gocercab#0 = #1#3;
     #gocercab#1 = #1#4;
     |LEE 000#gocercab.=;
     |SI FSalida = 0;
          nMiError = 1;
          |ERROR10;
     |FINSI;

     |SI #102#52 = "S";
          nContax = #1#4 - #102#54;
          #gocercab#1 = nContax;
          |LEE 000#gocercab.=;
          |SI FSalida = 0;
               nMiError = 1;
               |ERROR10;
          |FINSI;

          nContax = #1#4 - #102#54 + #102#56;
          #gocercab#1 = nContax;
          |LEE 000#gocercab.=;
          |SI FSalida = 0;
               nMiError = 1;
               |ERROR10;
          |FINSI;
     |FINSI;

     |CIERRA #gocercab;
|FPRC;

-------------------------------------------------------------------------------
|PROCESO BajaStan;
     ||BORRA LOS ALBARANES ASOCIADOS;
     |ABRE #7;
     #7#0 = #0#0;        ||Serie Expe.
     #7#1 = #0#1;        ||N§ Expediente.

     |LEE 000#7=;
     |SI FSalida = 0;
          |BUCLELIN 0 BorraAlbAdj #7;
          |BORRA 020#7a;
     |FINSI;
     |CIERRA #7;

     ||BORRA LOS PARTES DE TRABAJO ASOCIADOS;

     |BUCLE BorraPartida;

     |ABRE #101;
     #101#0 = #1#0;
     #101#1 = #1#1;
     #101#2 = #1#2;
     |BORRA 101#101c;
     |CIERRA #101;
|FPRC;
ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
|PROCESO CopruParteAdj;
     |SI #11#4 = #1#3; |Y #11#5 = #1#4;
          nMiError = 1;
     |FINSI;
|FPRC;

|PROCESO CompruebaStan;
     ||PRIMERO COMPRUEBA QUE NO TENGA CERTIFICACIONES
     |BUCLELIN 2 Certif1 #0;
     |SI nMiError = 1;
          |MENAV "    Este expediente tiene certificaciones. No se dara de baja";
          |ACABA;
     |FINSI;

     || LOS ALBARANES ASOCIADOS;
     |ABRE #7;
     #7#0 = #0#0;        ||Serie Expe.
     #7#1 = #0#1;        ||N§ Expediente.
     |LEE 000#7=;
     |SI FSalida = 0;
          |BUCLELIN 0 CompruAlbAdj #7;
          |SI nMiError ! 0;
               |CIERRA #7;
               |ACABA;
          |FINSI;
     |FINSI;
     |CIERRA #7;

    ||LOS PARTES DE TRABAJO ASOCIADOS;
     |ABRE #4;
     #4#0 = #0#0;
     #4#1 = #0#1;
     |LEE 000#4=;
     |SI FSalida = 0;
          |BUCLELIN 2 CopruParteAdj #4;
          |SI nMiError ! 0;
                |MENAV "0000HAY PARTES ASOCIADOS QUE TIENE QUE DAR DE BAJA";
                |CIERRA #4;
                |ACABA;
          |FINSI;
     |FINSI;
     |CIERRA #4;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO Final;

     |SI #0#9 = "S";
          |C_M #1#4,  1, "N";
          |C_M #1#5,  1, "N";
          |C_M #1#7,  1, "N";
          |C_M #1#8,  1, "N";
          |C_M #1#10, 1, "N";
          |C_M #1#11, 1, "N";
     |SINO;
          |C_M #1#4,  1, "S";
          |C_M #1#5,  1, "S";
          |C_M #1#7,  1, "S";
          |C_M #1#8,  1, "S";
          |C_M #1#10, 1, "S";
          |C_M #1#11, 1, "S";
     |FINSI;

|FPRC;
-----------------------------------------------------------------------------
|PROCESO AccTip;

     |SI FSalida ] 11; |Y FSalida [ 14;
          |HAZ TipAcc;
          |ERROR;
     |FINSI;

|FPRC;
-----------------------------------------------------------------------------
|PROCESO LinPar; |TIPO 7;
     nModo = (FEntrada/100)!0;

     |SI #102#32 = "H"; |C_M #1#3, 1, "S"; |FINSI;

     |SI nModo ! 1;
          |C_M #1#7, 1, "N";
          |C_M #1#8, 1, "N";
     |SINO;
          |C_M #1#7, 1, "S";
          |C_M #1#8, 1, "S";
     |FINSI;

     #1#20 = #1#9 - #1#16;                        ||Desv. Parcial Venta Tra.
     #1#22 = #1#13 - #1#18;                       ||Desv. Parcial Coste Tra.
     #0#18 = #0#5 - #0#16;                        ||Desv. Global Venta Trab.
     #0#20 = #0#10 - #0#14;                       ||Desv. Global Coste Trab.

     |SI #102#80 = "N"
          |PINTA 1953, #0#5;
     |FINSI;
     |PINTA 1967, #0#10;
     |PINTA 1902, #1#9;
     |PINTA 1916, #1#13;
     |PINTA #1#20; |PINTA #1#22; |PINTA #0#18; |PINTA #0#20;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO MirMod; |TIPO 7;
     nModo = (FEntrada/100)!0;

     |SI nModo = 2;
          |C_M #1#4, 1, "N";
     |SINO;
          |C_M #1#4, 1, "S";
     |FINSI;

|FPRC;
-----------------------------------------------------------------------------
|PROCESO TomaPartida;
     nLinea = nLinea + 1;
     #5#0 = #1#3;        ||Serie Pres.
     #5#1 = #1#4;        ||N§. Pres.
     #5#2 = #0#0;        ||Serie Expe.
     #5#3 = #0#1;        ||N§. Expe.
     #5#4 = nLinea;      ||N§. Linea
     #5#5 = #6#4;        ||Partida
     #5#6 = #6#5;        ||Desc. Partida.
     #5#7 = #6#10;       ||Importe Venta.
     #5#8 = #6#11;       ||Importe Coste.
     #5#9 = #6#16*#6#7;  ||Cantidad MO.
     #5#14 = #6#7;       ||Cantidad Partida.
     |GRABA 020#5c;
|FPRC;
-----------------------------------------------------------------------------
|DEFBUCLE TomaPartida;
     #6#1;
     ;
     #1#3, #1#4, "                   ",   1;
     #1#3, #1#4, "zzzzzzzzzzzzzzzzzzz", 999;
     ;
     NULL, TomaPartida;
|FIN;
-----------------------------------------------------------------------------
|PROCESO PasaPart;
     nLinea = 0;
     |ABRE #3;
     #3#0 = #1#3;
     #3#4 = #1#4;
     |LEE 000#3=;
     |SI FSalida = 0;
          nDeci_Medi    = #3#24;
          nDeci_Incr    = 5;
     |FINSI;
     |CIERRA #3;
     |ABRE #5;
     |BUCLE BorraPartida;
     |BUCLE TomaPartida;
     |CIERRA #5;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO BajaCab; |TIPO 2;
     nModo = (FEntrada/100)!0;
     nCua  = 0 +. 1;

     |SI nModo = 3;
          |HAZ CompruebaStan;
          |SI nMiError ! 0;
               |ERROR;
               |ACABA;
          |SINO;
               |ABRE #100;
               #100#0 = #0#0;
               #100#1 = #0#1;
               |LEE 101#100=;

               |SI FSalida = 0;
                    |BORRA 020#100a;
               |FINSI;

               |CIERRA #100;
          |FINSI;
     |FINSI;

     |SI nModo = 1;
          aAlfa = Usuario;
          aAlfa = aAlfa % 0810;
          #0#27 = aAlfa;
     |FINSI;

     |SI nCua < 0; nJOAnt = #gomantho#30; |FINSI;
     |SI nModo = 2;
        |SI #gomantho#30 ! nJOAnt;
           |SI nJOAnt = 0;
              eaAsunto = "Asignacion Expte. '" + #1#0 + "/" + (("000000" + #1#1) % -106) + "'";
              eaAsunto = eaAsunto + " a Jefe Obra nro. " + (("00000" + #gomantho#30) % -105);
           |SINO;
              eaAsunto = "Cambio Expte. '" + #1#0 + "/" + (("000000" + #1#1) % -106) + "'";
              eaAsunto = eaAsunto + " de Jefe Obra nro. " + (("00000" + nJOAnt) % -105);
              eaAsunto = eaAsunto + " a Jefe Obra nro. " + (("00000" + #gomantho#30) % -105);
           |FINSI;
           |ABRE #gotrabaj;
           #gotrabaj#0 = #gomantho#30;
           |LEE 000#gotrabaj.=;
           |SI FSalida ! 0; |DDEFECTO #gotrabaj; |FINSI;
           |CIERRA #gotrabaj;

           enEnvio  = 0;
           eaOrigen = Usuario % 0810;
           eaDestino = #gotrabaj#27;
           eaPrograma = "gomantho" + #0#0 + #0#1;
           |HAZ EnviaDSCorreo;
        |FINSI;
     |FINSI;

     |SI nMod ! 3; |Y nCua > 0;
          |ABRE #27;
          #27#26 = #0#0;
          |LEE 101#27=;
          nSal = FSalida;
          #27#27 = #0#29;
          #27#1  = #102#46;
          |SI nSal = 0; |GRABA 020#27a; |FINSI;
          |SI nSal ! 0; |GRABA 020#27n; |FINSI;
          |LIBERA #27;
          |CIERRA #27;
     |FINSI;
     #0#28 = #0#0;
     |SI nModo = 3;
          |HAZ HistoBaja;
          |HAZ BajaAuxExp;
     |FINSI;
|FPRC;

|PROCESO HistoBaja;
     |ABRE #80;
     |LEE 000#80u;
     |SI FSalida = 0;
          #80#0 = #80#0 + 1;
     |SINO;
          #80#0 = 1;
     |FINSI;
     #80#1 = #0#0;
     #80#2 = #0#1;
     #80#3 = ~;
     |HORA aAlfa;
     #80#4 = aAlfa;
     aAlfa = Usuario % 810;
     #80#5 = aAlfa;
     #80#6 = "E";
     |GRABA 020#80n;
     |CIERRA #80;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO ImpExped2;
     |DDEFECTO #agifa019;
     #agifa019#0 = #gopartia#20;
     |LEE 000#agifa019.=;
     #gopartia#30 = #agifa019#1;   || ajusta la descripcion

     #3#0 = #101#3;
     #3#1 = #101#4;
     |LEE 000#3=;
     |SI FSalida = 0;
          nDeci_Medi    = #3#24;
          nDeci_Incr    = 5;
     |FINSI;

     #204#50 = #22#4;
     #204#0 = #22#5;
     |LEE 000#204=;
     aDivisa = #204#56;
     aMoneda = #204#58;
     |HAZ Divisas010;

     #205#27 = #22#4;
     #205#0 = #22#5;
     #205#2 = #22#20;

     |LEE 000#205=;

     |SI #agifa080#6 = 0; |O FSalida ! 0;  || esto es por si las partidas ejecutadas
          #agifa080#6 = #22#11;    || no se hacen por adjudicacion de albaranes
     |FINSI;                       || sino por partes de trabajo

     |SI enLinea = -1;
          aAntCod = #gopartia#20;
          aAntDes = #gopartia#30;
          nAntPre = #gopartia#23;
          enLinea = 0;
     |FINSI;
     |SI aAntCod ! #gopartia#20;|O aAntDes ! #gopartia#30;
          aAntCod = #gopartia#20;
          aAntDes = #gopartia#30;
          nAntPre = #gopartia#23;
          enLinea = 0;
     |SINO;
          |SI nAntPre ! #gopartia#23;
               nAntPre = #gopartia#23;
               enLinea = enLinea + 1;
          |FINSI;
     |FINSI;

     aAlfa = #gopartia#33;         || el capitulo
     |QBF aAlfa;
     |ABRE #gopre002;          || compruebo que existe el capitulo en el presu-
     #gopre002#0 = #gopartia#0; || puesto, si no lo dejo en blanco para que lo
     #gopre002#1 = #gopartia#1;
     #gopre002#12 = aAlfa;     || trate como a una subcontrata
     |SELECT #6#gopre002;
     |LEE 000#gopre002.=;
     |SI FSalida ! 0;
          aAlfa = "";
     |FINSI;

     |SELECT #1#gopre002;
     |SI aAlfa ! "";     || si no me viene el capitulo cojo el
          aUltCap = #gopartia#33;  || ultimo que si me haya venido
     |SINO;
          || entiendo que si el capitulo me viene en blanco busco el primero
          || que tenga importe para meterselo, esto lo cambio porque ahora
          || para jose en Visever se da el caso de que hay expediente
          || asignados a presupuestos sin  ningun importe
          || cojo el primero que encuentre 27.04.2006

          |PARA nume = 1; |SI; |HACIENDO nume = nume + 1;
               #gopre002#0 = #gopartia#0;
               #gopre002#1 = #gopartia#1;
               #gopre002#2 = nume;
               |LEE 000#gopre002.=;
               ||SI #gopre002#8 ! 0; ||migue
               |SI FSalida = 0;
                    |SAL;
               |FINSI;
          |SIGUE;
          |CIERRA #gopre002;
          #gopartia#33 = #gopre002#12;
     |FINSI;

     aAlfa = #gopartia#8;      || la partida
     |QBF aAlfa;
     |ABRE #gopre003;           || compruebo que la partida en el capitulo en
     #gopre003#0 = #gopartia#0; || el presupuesto, si no lo dejo en blanco
     #gopre003#1 = #gopartia#1; || para que lo trate como a una subcontrata
     #gopre003#2 = #gopartia#33; || real, que es lo que es
     #gopre003#4 = aAlfa;
     |SELECT #2#gopre003;
     |LEE 000#gopre003.=;
     |SI FSalida ! 0;
          aAlfa = "";
     |FINSI;

     |SELECT #1#gopre003;
     |SI aAlfa ! "";     || si no me viene el capitulo cojo el
          aUltPart = #gopartia#8;  || ultimo que si me haya venido
     |SINO;
          || entiendo que si el capitulo/partida me viene en blanco busco la
          || primera que tenga precio coste importe para metersela,
          || esto lo cambio porque ahora para jose en Visever se da el caso
          || de que hay expediente asignados a presupuestos sin
          || ningun importe, cojo el primero que encuentre 27.04.2006

          |PARA nume = 1; |SI; |HACIENDO nume = nume + 1;
               #gopre003#0 = #gopartia#0;
               #gopre003#1 = #gopartia#1;
               #gopre003#2 = #gopartia#33;
               #gopre003#3 = nume;
               |LEE 000#gopre003.=;
               ||SI #gopre003#9 ! 0;
               |SI FSalida = 0;
                    |SAL;
               |FINSI;
          |SIGUE;
          |CIERRA #gopre003;
          #gopartia#8 = #gopre003#4;
     |FINSI;

     aAlfa = #gopartia#20;
     |QBF aAlfa;
     |SI aAlfa = "";       || si no me viene el articulo cojo el
          #gopartia#20 = "CERT";  || codigo "CERT" y descripcion "SUBCONTRATA"
          #gopartia#30 = "SUBCONTRATA";
     |FINSI;

     |PRINT;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO ImpExped;
     #3#0 = #101#3;
     #3#1 = #101#4;
     |LEE 000#3=;
     |SI FSalida = 0;
          nDeci_Medi    = #3#24;
          nDeci_Incr    = 5;
     |FINSI;
     |PRINT;
|FPRC;
-----------------------------------------------------------------------------
|DEFBUCLE ImpPartid;
     #5#1;
     2,3;
     "     ",      1,   1, #0#0, #0#1;
     "zzzzz", 999999, 999, #0#0, #0#1;
     ;
     NULL, ImpExped;
|FIN;
-----------------------------------------------------------------------------
|DEFBUCLE gopartra;
     #21#2;
     ;
     #0#0, #0#1, "01.01.0000",   1,    1;
     #0#0, #0#1, "31.12.9999",9999, 9999;
     ;
     NULL, ImpExped;
|FIN;
-----------------------------------------------------------------------------
|DEFBUCLE gopartia;
     #22#3;
     ;
     #0#0,#0#1 ,"     ",      1, "                    ", "                    ";
     #0#0,#0#1 ,"zzzzz", 999999, "zzzzzzzzzzzzzzzzzzzz", "zzzzzzzzzzzzzzzzzzzz";
     ;
     NULL, NULL, NULL, NULL, NULL, ImpExped2;
     #22#20, #22#30, #22#23;
|FIN;
-----------------------------------------------------------------------------
|DEFBUCLE ImpDesPar;
     #104#1;
     ;
     #101#3, #101#4, "                    ", "                   ",   1;
     #101#3, #101#4, "zzzzzzzzzzzzzzzzzzzz", "zzzzzzzzzzzzzzzzzzz", 999;
     ;
     NULL, ImpExped;
|FIN;
-----------------------------------------------------------------------------
|PROCESO ImpDesPar;
     #3#0 = #101#3;
     #3#1 = #101#4;
     |LEE 000#3=;
     |SI FSalida = 0;
          nDeci_Medi    = #3#24;
          nDeci_Incr    = 5;
     |FINSI;
     |BUCLE ImpDesPar;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO Part_DesAmp;
     |PRINT;
     nAmp2 = 1;
|FPRC;
-----------------------------------------------------------------------------
|DEFBUCLE Part_DesAmp;
     #202#1;
     ;
     #6#4, #1#3, #1#4, #6#2,  1;
     #6#4, #1#3, #1#4, #6#2, 999;
     ;
     NULL, Part_DesAmp;
|FIN;
----------------------------------------------------------------------------
|PROCESO Cap_Part;
     |BUCLE Part_DesAmp;
     |SI nAmp2 ! 1;
          #202#4 = "Sin descripcion"
          |PRINT;
     |FINSI;
     nAmp2 = 0;
|FPRC;
-----------------------------------------------------------------------------
|DEFBUCLE Cap_Part;
     #6#1;
     ;
     #1#3, #1#4, #107#12,   1;
     #1#3, #1#4, #107#12, 999;
     ;
     NULL,Cap_Part;
|FIN;
-----------------------------------------------------------------------------
|PROCESO Pres_Cap;
     |BUCLE Cap_Part;
|FPRC;
-----------------------------------------------------------------------------
|DEFBUCLE Pres_Cap;
     #107#1;
     ;
     #1#3, #1#4, 001;
     #1#3, #1#4, 999;
     ;
     NULL, Pres_Cap;
|FIN;
-----------------------------------------------------------------------------
|PROCESO Exp_Pres;
     |BUCLE Pres_Cap;
|FPRC;
-----------------------------------------------------------------------------
|DEFBUCLE Exp_Pres;
     #1#1;
     ;
     #0#0, #0#1, 001;
     #0#0, #0#1, 999;
     ;
     NULL, Exp_Pres;
|FIN;
-----------------------------------------------------------------------------
|PROCESO goparcab
||     |ABRE #203;
||     #203#0 = #1#3;
||     #203#1 = #1#4;
||     |LEE 000#203=;
||     |SI FSalida = 0;
          #3#0 = #1#3;
          #3#1 = #1#4;
          |LEE 000#3=;
          |SI FSalida = 0;
               |PRINT;
               |PIEINF;
          |FINSI;
||     |FINSI;
|FPRC;
-----------------------------------------------------------------------------
|DEFBUCLE goparcab;
     #1#1;
     ;
     #0#0, #0#1, 001;
     #0#0, #0#1, 999;
     ;
     NULL, goparcab;
|FIN;
-----------------------------------------------------------------------------
|PROCESO ImpExp; |TIPO 4;
     cCodMonTrab = #0#6;
     |HAZ MonBas;
     |ABRE #3;
     |ABRE #100;
     #100#0 = #0#0;
     #100#1 = #0#1;
     |LEE 000#100=;

     |SI FSalida ! 0;
          |MENAV "0000DEBE SELECIONAR UN EXPEDIENTE";
          |ACABA;
     |FINSI;

     |SUB_EJECUTA_NP "goinform;IMPgoparcab";
     |SI nErrorInf = 1;
          |ACABA;
     |FINSI;
     |INFOR "goparcab";             ||AQUI
     |BUCLE goparcab;
     |FININF;
     |SUB_EJECUTA_NP "goinform;ENVgoparcab";

     |HAZ LeeEmpresa;
     |SUB_EJECUTA_NP "goinform;IMPgoempres";
     |INFOR "goempres";
     |PRINT;
     |PIEINF;
     |FININF;
     |SUB_EJECUTA_NP "goinform;ENVgoempres";

     |SUB_EJECUTA_NP "goinform;IMPgomantca";
     |SI nErrorInf = 1; |ACABA; |FINSI;
     |INFOR "gomantca";
     |PRINT;
     |PIEINF;
     |FININF;
     |SUB_EJECUTA_NP "goinform;ENVgomantca";

     |SUB_EJECUTA_NP "goinform;IMPgomantli";
     |INFOR "gomantli";
     |BUCLELIN 2ImpExped#100;
     |PIEINF;
     |FININF;
     |SUB_EJECUTA_NP "goinform;ENVgomantli";

     |SUB_EJECUTA_NP "goinform;IMPgopartid";
     |INFOR "gopartid";
     |BUCLE ImpPartid;
     |PIEINF;
     |FININF;
     |SUB_EJECUTA_NP "goinform;ENVgopartid";

     |SUB_EJECUTA_NP "goinform;IMPgoparlin";
     |INFOR "goparlin";
     |BUCLE Exp_Pres;
     |PIEINF;
     |FININF;
     |SUB_EJECUTA_NP "goinform;ENVgoparlin";

     |SUB_EJECUTA_NP "goinform;IMPgopartra";
     |INFOR "goexppar";
     |BUCLE gopartra;
     |PIEINF;
     |FININF;
     |SUB_EJECUTA_NP "goinform;ENVgopartra";

     |SUB_EJECUTA_NP "goinform;IMPgopartia";
     |ABRE #204;
     |ABRE #205;
     |ABRE #agifa019;
     |SELECT #4#205;
     |INFOR "gopartia";
     enLinea = -1;

     |BUCLE gopartia;
     |PIEINF;
     |FININF;
     |CIERRA #204;
     |CIERRA #205;
     |CIERRA #agifa019;
     |SUB_EJECUTA_NP "goinform;ENVgopartia";

     |SUB_EJECUTA_NP "goinform;IMPgoexpdes";
     |INFOR "goexpdes";
     |BUCLELIN 2ImpDesPar#100;
     |PIEINF;
     |FININF;
     |SUB_EJECUTA_NP "goinform;ENVgoexpdes";

     |SUB_EJECUTA_NP "goinform;RUNEXPEDIENTES";
     |CIERRA #100;
     |CIERRA #3;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO SacaMate;
     #1#16 = #1#16 + #22#13;                      ||Imp. Venta Trabajo.
     #1#18 = #1#18 + #22#14;                      ||Imp. Coste Trabajo.
|FPRC;
-----------------------------------------------------------------------------
|PROCESO SacaDias;
     #23#0 = #12#3;
     |LEE 000#23=;

     |SI FSalida ! 0;
          |GRABA 020#23c;
     |FINSI;

     #1#24 = #1#24 + 1;                           ||Dias Trabajados.
|FPRC;
-----------------------------------------------------------------------------
|DEFBUCLE TomaMate;
     #22#3;
     ;
     #0#0, #0#1, #1#3, #1#4, "                    ", "                    ";
     #0#0, #0#1, #1#3, #1#4, "zzzzzzzzzzzzzzzzzzzz", "zzzzzzzzzzzzzzzzzzzz";
     ;
     NULL, SacaMate;
|FIN;
-----------------------------------------------------------------------------
|DEFBUCLE TomaDias;
     #12#1;
     ;
     #1#3, #1#4,   1;
     #1#3, #1#4, 999;
     ;
     NULL, SacaDias;
|FIN;
-------------------------------------------------------------------------------
|PROCESO MiraValor; |TIPO 14;
     nModo = (FEntrada/100)!0;


     |SI nModo = 1; |O nModo = 3; |O nModo = 0; |O #0#1 = 0; |ACABA; |FINSI;

     |SI Campo = 1; |Y #goparame#78 = "S";
          |SI aSerAnt ! #0#0; |O nNumAnt ! #0#1;
               aSerAnt = #0#0; nNumAnt = #0#1;

               eaSer = #0#0;
               enNum = #0#1;
               |HAZ RecalExpe; || llama al guerz015
          |FINSI;
     |FINSI;

     FSalida = "";
|FPRC;
-----------------------------------------------------------------------------
|PROCESO EstadoTodos;
     |SI nLin ! #1#2;
          |SI #1#10 ! aEstado;
               nSwEstadoTodos = 1;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE EstadoTodos;
     #1#1;
     ;
     #0#0, #0#1, 001;
     #0#0, #0#1, 999;
     ;
     NULL, EstadoTodos;
|FIN;

|PROCESO EstadoLin; |TIPO 0;
   |SI FSalida ! 0; |ERROR; |FINSI;

     |SI Contenido ! #1#10;

          /* SE HA INTRODUCIDO EN ESTADO PARALIZADA O TERMINADA.*/

          |SI #1#10 = "P"; |O #1#10 = "T";

               |SI Contenido ! "C";
                    |MENAV "0000EL PRESUPUESTO NO ESTA EN CURSO";
                    #1#10 = Contenido;
                    |ERROR10;
                    |ACABA;
               |SINO;
                    aEstado = #1#10;
                    nLin = #1#2;
                    nSwEstadoTodos = 0;
                    |SALVA_FICHA #1;
                    |BUCLE EstadoTodos;
                    |REPON_FICHA #1;
                    |SI nSwEstadoTodos = 0;
                         |SI #1#10 = "P";
                              #0#9 = "P";
                              #0#26 = ~;
                              |PINTA #0#9;
                              |PINTA #0#26;
                              |PUSHV 0101 2380;    ||VER SEGUIMIENTOS
                              |COLOR 0, 3; |ATRI 0;
                              |BLANCO 0615 1865;
                              |PINTA 0717, "SEGUIMIENTOS:";
                              |ENTLINEAL #1#13 , -5 , 2 , 15 , 1 , inf , sup;
                              |POPV;
                         |SINO;
                              #0#25 = ~;
                              fFecFin = #0#25;
                              #0#9 = "T";
                              |PINTA #0#9;
                              |PINTA #0#25;
                         |FINSI;
/****************************************************
                    ||COMPROBAMOS SI HAY MAS DE UNA LINEA DE PRESUPUESTOS.

                    |SI #1#2 = 1;
                         |SALVA_FICHA #1;
                         #1#2 = 2;
                         |LEE 000#1=;

                         |SI FSalida ! 0;

                              ||HEMOS PARALIZADO LA OBRE O DE LO CONTRARIO LA HEMOS TERMINADO.

                              |SI #1#10 = "P";
                                   #0#9 = "P";
                                   #0#26 = ~;
                                   |PINTA #0#9;
                                   |PINTA #0#26;
                                   |PUSHV 0101 2380;    ||VER SEGUIMIENTOS
                                   |COLOR 0, 3; |ATRI 0;
                                   |BLANCO 0615 1865;
                                   |PINTA 0717, "SEGUIMIENTOS:";
                                   |ENTLINEAL #1#13 , -5 , 2 , 15 , 1 , inf , sup;
                                   |POPV;
                              |SINO;
                                   #0#25 = ~;
                                   fFecFin = #0#25;
                                   #0#9 = "T";
                                   |PINTA #0#9;
                                   |PINTA #0#25;
                              |FINSI;

                         |FINSI;

                         |REPON_FICHA #1;
*******************************************************/

                         /*CALCULAMOS EL NUEVO NUMERO DE DIAS TRANSCURRIDOS.*/
/*
                         #1#8 = #0#25;
                         #1#15 = #1#8 - #1#7;
                         |HAZ DiasFest;
                         #1#15 = #1#15 - nTotDias;
                         #1#15 = #1#15 + 1;
                         |PINTA #1#8; |PINTA #1#15;
*/
                    |FINSI;

               |FINSI;

          |FINSI;

          /*HEMOS VARIADO EL ESTADO A ESPERA.*/

          |SI #1#10 = "E"; |Y Contenido ! "E";
               |MENAV "0000ESTE PRESUPUESTO YA HA ESTADO EN CURSO Y NO PUEDE PASAR A ESPERA.";
               #1#10 = Contenido;
               |ERROR;
               |ACABA;
          |FINSI;

          /*HEMOS VARIADO EL ESTADO A CURSO.*/

          |SI #1#10 = "C";
               #0#9 = "C";

               /*ACTUALIZAMOS LA CABECERA A CURSO.*/
/*
               |SI #0#24 = "01.01.0000";
                    #0#24 = ~;
                    #1#7 = #0#24;
                    #1#8 = #1#7 + #1#15;                    ||Fecha fin sin festivos.
                    nFecFin = #1#8;
                    nFecFin = nFecFin - 1;
                    #1#8 = nFecFin;
                    |HAZ DiasFest;
                    #1#8 = fFecFin;                         ||Fecha fin con festivos.
                    |PINTA #1#8; |PINTA #1#15;
               |FINSI;
*/
               |SI #0#24 = "01.01.0000";
                    #0#24 = ~;
               |FINSI;
               #0#25 = "01.01.0000";
               #0#26 = "01.01.0000";
               |PINTA #0#9;
               |PINTA #0#24;
               |PINTA #0#25;
               |PINTA #0#26;
               |PINTA #1#7;
               |PINTA #1#8;

               |PUSHV 0501 2380;
               |C_P #0#25, 0, nNume1;
               |C_M #0#25, 0, aAlfa1;
               |C_P #0#25, 1, 1537;
               |C_M #0#25, 1, "S";
               |BLANCO 1229 1756;
               |CUADRO 1229 1756;
               |CUADRO 1330 1655;
               |ATRI I; |PINTA 1331, "  Fecha Fin Expediente "; |ATRI 0;
               #0#25 = #1#8;
               nLinPres = 0;
               |HAZ UltFecPresu;
               |ENCAMPO #25#0;
               |C_P #0#25, 1, nNume1;
               |C_M #0#25, 1, aAlfa1;
               |POPV;
               |PINTA #0#25;
          |FINSI;

     |FINSI;

     |PINTA #0#24;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO EstadoCab; |TIPO 0;

     |SI Contenido ! #0#9;

          |SI #0#9 = "E";
               |BUCLELIN 2 MiraEstado2 #0;

               |SI nError = 1;
                    |MENAV "0000TIPO DE ESTADO INCOMPATIBLE CON SUS PRESUPUESTOS";
                    #0#9 = Contenido;
                    |ERROR;
                    |ACABA;
               |FINSI;

          |FINSI;

          |SI #0#9 = "C";
               |MENAV "0000DEBE CURSAR DESDE EL PRESUPUESTO";
               #0#9 = Contenido;
               |ERROR;
               |PINTA #0#9;
               |ACABA;
          |FINSI;

          |SI #0#9 = "P"; |Y Contenido ! "C";
               |MENAV "0000NO HAY NINGUN PRESUPUESTO EN CURSO";
               #0#9 = Contenido;
               |ERROR;
          |FINSI;

          |SI #0#9 = "P"; |Y Contenido = "C";
               |BUCLELIN 2 ParaPres #0;
               #0#26 = ~;
               |PINTA #0#26;
          |FINSI;

          |SI #0#9 = "T"; |Y Contenido = "E";
               |MENAV "0000EL EXPEDIENTE NO SE ENCUENTRA EN CURSO";
               #0#9 = Contenido;
               |ERROR;
          |FINSI;

          |SI #0#9 = "T"; |Y Contenido ! "E";
               |BUCLELIN 2 MiraEstado #0;

               |SI nError = 1;
                    |MENAV "0000HAY PRESUPUESTOS NO TERMINADOS";
                    #0#9 = Contenido;
                    |ERROR;
               |FINSI;

          |FINSI;

          |SI #0#9 = "T";
               #0#25 = ~;
               |PINTA #0#25;
          |FINSI;

          |SI #0#9 = "P"; |Y #0#26 = "01.01.0000";
               #0#26 = ~;
               |PINTA #0#26;
          |FINSI;

    |FINSI;

    |PINTA #0#9;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO ParaPres;

     |SI #1#10 = "C";
          #1#10 = "P";
          |GRABA 020#1a;
     |FINSI;

|FPRC;
-----------------------------------------------------------------------------
|PROCESO MiraEstado;

     |SI #1#10 ! "T";
          nError = 1;
     |FINSI;

|FPRC;
-----------------------------------------------------------------------------
|PROCESO MiraEstado2;

     |SI #1#10 ! "E";
          nError = 1;
     |FINSI;

|FPRC;
-----------------------------------------------------------------------------
|PROCESO BImnt; |TIPO 80;
     |CLS;
     |CONTROL_SIMPLE 0, "BOTON,F2 - Ver Presupuesto", 2415, 2430, F2mnt;
     nBotPresu = FSalida;
     |ESTADO_CONTROL nBotPresu, "HIDE"; ||"SHOW""HIDE""ENABLE""DISABLE".

     |CONTROL_SIMPLE 0, "BOTON,F3 - Certificaciones", 2435, 2450, F3mnt;
     nBotCerti = FSalida;
     |ESTADO_CONTROL nBotCerti, "HIDE"; ||"SHOW""HIDE""ENABLE""DISABLE".

     |CONTROL_SIMPLE 0, "BOTON,F4 - Seguimientos", 2455, 2470, F4mnt;
     nBotSegui = FSalida;
     |ESTADO_CONTROL nBotSegui, "HIDE"; ||"SHOW""HIDE""ENABLE""DISABLE".

     |||CONTROL_SIMPLE 0, "BOTON,F2 - Presupuestos del cliente sin asignar ", 2435, 2455, F2mnt;
     |CONTROL_SIMPLE 0, "BOTON,F2 - Presupuestos del cliente sin asignar ", 2410, 2435, F2mnt;
     nBotParti = FSalida;
     |ESTADO_CONTROL nBotParti, "HIDE"; ||"SHOW""HIDE""ENABLE""DISABLE".

     |CONTROL_SIMPLE 0, "BOTON,F3 - Todos los Presupuestos sin asignar", 2445, 2470, F3mnt;
     nBotPreCli = FSalida;
     |ESTADO_CONTROL nBotPreCli, "HIDE"; ||"SHOW""HIDE""ENABLE""DISABLE".

     |ABRE #142; |LEE 000#142p; |CIERRA #142;
|FPRC;
------------------------------------------------------------------------------
|PROCESO BFmnt; |TIPO 90;
     ||PULSATECLA;
     |FIN_CONTROL_WINDOWS nBotPresu;
     ||PULSATECLA;
     |FIN_CONTROL_WINDOWS nBotSegui;
     |FIN_CONTROL_WINDOWS nBotCerti;
     ||PULSATECLA;
     |FIN_CONTROL_WINDOWS nBotParti;
     |FIN_CONTROL_WINDOWS nBotPreCli;
     |PULSATECLA;
|FPRC;
------------------------------------------------------------------------------
|PROCESO BSmnt; |TIPO 7;
     |HAZ PinDesPres;
     |SI Campo = 2; |O Campo = 3;

          |SI #1#4 ! 0;
               |ESTADO_CONTROL nBotPresu, "SHOW"; ||"SHOW""HIDE""ENABLE""DISABLE".
               |ESTADO_CONTROL nBotCerti, "SHOW"; ||"SHOW""HIDE""ENABLE""DISABLE".
               |ESTADO_CONTROL nBotSegui, "SHOW"; ||"SHOW""HIDE""ENABLE""DISABLE".
          |FINSI;

          |ESTADO_CONTROL nBotParti, "HIDE"; ||"SHOW""HIDE""ENABLE""DISABLE".
          |ESTADO_CONTROL nBotPreCli, "HIDE"; ||"SHOW""HIDE""ENABLE""DISABLE".

     |FINSI;

     |SI Campo = 4;
          |ESTADO_CONTROL nBotPresu, "HIDE"; ||"SHOW""HIDE""ENABLE""DISABLE".
          |ESTADO_CONTROL nBotCerti, "HIDE"; ||"SHOW""HIDE""ENABLE""DISABLE".
          |ESTADO_CONTROL nBotSegui, "HIDE"; ||"SHOW""HIDE""ENABLE""DISABLE".
          |ESTADO_CONTROL nBotParti, "SHOW"; ||"SHOW""HIDE""ENABLE""DISABLE".
          |ESTADO_CONTROL nBotPreCli, "SHOW"; ||"SHOW""HIDE""ENABLE""DISABLE".
     |FINSI;

|FPRC;
-------------------------------------------------------------------------------
|PROCESO BHmnt;
     |ESTADO_CONTROL nBotPresu, "HIDE"; ||"SHOW""HIDE""ENABLE""DISABLE".
     |ESTADO_CONTROL nBotCerti, "HIDE"; ||"SHOW""HIDE""ENABLE""DISABLE".
     |ESTADO_CONTROL nBotSegui, "HIDE"; ||"SHOW""HIDE""ENABLE""DISABLE".
     |ESTADO_CONTROL nBotParti, "HIDE"; ||"SHOW""HIDE""ENABLE""DISABLE".
     |ESTADO_CONTROL nBotPreCli, "HIDE"; ||"SHOW""HIDE""ENABLE""DISABLE".
|FPRC;
-------------------------------------------------------------------------------
|PROCESO F2mnt;
     |PTEC 824;
|FPRC;

|PROCESO F3mnt;
     |PTEC 825;
|FPRC;
-------------------------------------------------------------------------------
|PROCESO F4mnt;
     |SI nModo = 1;
          FEntrada = 101;
     |FINSI;
     |SI nModo = 2;
          FEntrada = 201;
     |FINSI;
     |SI nModo = 4;
          FEntrada = 401;
     |FINSI;
     |PTEC 826;
|FPRC;
-------------------------------------------------------------------------------
|PROCESO Bmnt; |TIPO 0;
     |HAZ BHmnt;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO CompEst; |TIPO 7;
     |SI #1#10 = "C"; |O #1#10 = "P"; |O #1#10 = "T";
          |C_M #1#7,  1, "N";
          |C_M #1#8,  1, "N";
          |C_M #1#15, 1, "N";
     |SINO;
          |C_M #1#7,  1, "S";
          |C_M #1#8,  1, "S";
          |C_M #1#15, 1, "S";
     |FINSI;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO Parciales;
     |ABRE #1;
     #1#0 = #0#0;
     #1#1 = #0#1;
     #1#2 = 1;
     |LEE 010#1=;
     |SI FSalida = 0;
          |HAZ PParciales;
     |FINSI;
     |CIERRA #1;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO PParciales;
     |PINTA #1#16;
     |PINTA #1#18;
     |PINTA #1#20;
     |PINTA #1#22;
     |PINTA 1902, #1#9;
     |PINTA 1916, #1#13;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO Cabecera; |TIPO 30;
     |ABRE #100;
     |DDEFECTO #100;
     #100#0 = #0#0;
     #100#1 = #0#1;
     |LEE 101#100=;

     |SI FSalida ! 0;
          |GRABA 020#100c;
     |FINSI;

     |PARA nCampo = 0; |SI nCampo [ 29; |HACIENDO nCampo = nCampo + 1;
          #100nCampo = #0nCampo;
     |SIGUE;

     |GRABA 020#100a;
     |CIERRA #100;

     |SI #goparame#78 = "S";
          FSalida = 0;
     |SINO;
          |CONFI "0000SRecalcular Expediente";
     |FINSI;
     |SI FSalida = 0;
          eaSer = #0#0;
          enNum = #0#1;
          |HAZ RecalExpe; || llama al guerz015
     |FINSI;
|FPRC;
-------------------------------------------------------------------------------
|PROCESO ActuPres; |TIPO 3;
     |ABRE #101;
     |DDEFECTO #101;
     #101#0 = #1#0;
     #101#1 = #1#1;
     #101#2 = #1#2;
     |LEE 000#101=;

     |SI FSalida ! 0;
          |GRABA 020#101c;
     |FINSI;

     |PARA nCampo = 0; |SI nCampo [ 25; |HACIENDO nCampo = nCampo + 1;
          #101nCampo = #1nCampo; || PEPE
     |SIGUE;

     |GRABA 020#101a;

     |CIERRA #1;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO ContaAlma;
     |ABRE #24;
     |LEE 000#24u;
     |SI FSalida = 0;
          nMov = #24#0;
     |SINO;
          nMov = 0;
     |FINSI;
     nMov = nMov + 1;
     |DDEFECTO #24;
     #24#0 = nMov;
     aAlfa = #0#1;
     aAlfa = ("000000"+ aAlfa) % -106;
     #24#1 = #0#0 + "/" + aAlfa + " " + #0#8;
     |GRABA 020#24n;
     |CIERRA #24;
     #0#11 = #24#0;
     #0#12 = #24#1;
     |PINTA #0#11;
     |PINTA #0#12;
     |C_M #0#11 , 1 , "N";
|FPRC;

|PROCESO AltaAl; |TIPO 7;
     |C_M #0#11 , 1 , "S";
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 1;
          |ABRE #102;
          #102#0 = "A";
          |LEE 000#102=;
          |CIERRA #102;

          |SI #102#94 = "E";
               #0#11 = #0#0; |PINTA #0#11;
               |C_M #0#11, 1, "N";
               |SI #0#11 = 0; || Si la serie es alfa
                    |ABRE #27;
                    #27#26 = #0#0;
                    |LEE 000#27=;
                    |CIERRA #27;
                    #0#11 = #27#29; |PINTA #0#11;
               |FINSI;
               |ACABA;
          |FINSI;
          |SI #102#44 = "A";
               |SI #102#50 = "S";
                    #0#11 = #0#0;
                    |PINTA #0#11;
                    |C_M #0#11 , 1 , "N";
               |SINO;
                    |SI #0#11 ! 1;
                         |C_M #0#11 , 1 , "N";
                    |SINO;
                         |HAZ ContaAlma;
                    |FINSI;
               |FINSI;
          |FINSI;
     |SINO;
          |C_M #0#11 , 1 , "N";
     |FINSI;
|FPRC;

|PROCESO MiAlHo; |TIPO 0;
     |ABRE #102;
     #102#0 = "A";
     |LEE 000#102=;

     |SI FSalida = 0;

          |SI #102#22 = #0#11; |Y #102#94 ! "E";
               |MENAV "0000EL ALMACEN DEL EXPEDIENTE DEBE SER DISTINTO AL CENTRAL";
               |ERROR;
          |FINSI;

     |FINSI;
     |CIERRA #102;
|FPRC;
-------------------------------------------------------------------------------
|PROCESO mirapresu;
    swHayPre = 1;
    |ERROR10;
|FPRC;

|DEFBUCLE mirapresu;
     #3#2;
     16;
     " "," ",#0#2," ","     ",000001,"   ",000000;
     "z","z",#0#2,"z","zzzzz",999999,"zzz",000000;
     ;
     NULL, mirapresu;
|FIN;

|PROCESO comprobo; |TIPO 0;
    nModo = (FEntrada / 100) ! 0;

     |SI #102#32 = "H"; |ACABA; |FINSI;

    |SI nModo = 1;
         swHayPre = 0;
         |BUCLE mirapresu;
         |SI swHayPre = 0;
               |MENAV "0000EL CLIENTE NO TIENE PRESUPUESTOS PDTES.";
               |ERROR;
         |FINSI;
    |FINSI;
|FPRC;

|RUTINA infmat;
     #26#0 = "                    ";
|FRUT;

|RUTINA supmat;
     #26#0 = "zzzzzzzzzzzzzzzzzzzz";
|FRUT;

|PROCESO gotmpalm;
     |SI #26#6 = "S";
          nLin = nLin + 1;
          #9#0 = aSerPre;
          #9#1 = aNumPre;
          #9#2 = nLin;
          #9#3 = ~;
          |GRABA 020#9n;
     |FINSI;
     xQuien = 1;
     xQtip  = 0;
     xModo  = 1;
     xForma = 1;
     xDocTras = #0#1;
     xSerie   = #0#0;
     xFecDocu = ~;
     xLinDocu = nLin;
     xCodArti = #26#0;
     xDesArti = #26#1;
     xCanArti = #26#3;
     xAlmEntr = #102#22;
     xAlmSali = #26#4;
     |SUB_EJECUTA_NP "gomovalm";
|FPRC;

|DEFBUCLE gotmpalm;
     #26#1;
     3;
     "                    ",           1;
     "zzzzzzzzzzzzzzzzzzzz",999999999999;
     ;
     NULL,gotmpalm;
|FIN;

|PROCESO leelineas;
     aSerPre = #1#3;
     aNumPre = #1#4;
     |ERROR10;
|FPRC;

|DEFBUCLE leelineas;
     #1#1;
     ;
     #0#0,#0#1,001;
     #0#0,#0#1,999;
     ;
     NULL,leelineas;
|FIN;

|PROCESO buspresup;
     nLin = #8#2;
     |SI aSerPre = #8#3; |Y aNumPre = #8#4;
          nLin = #8#5;
          swSi = 1;
          |ERROR10;
     |FINSI;
|FPRC;

|DEFBUCLE buspresup;
     #8#1;
     ;
     #0#0,#0#1,001;
     #0#0,#0#1,999;
     ;
     NULL,buspresup;
|FIN;

|PROCESO actualma;
     |ABRE #102;
     #102#0 = "A";
     |LEE 101#102=;
     |CIERRA #102;
     |ABRE #26;
     |ABRE #7;
     |ABRE #8;
     #7#0 = #0#0;
     #7#1 = #0#1;
     |LEE 101#7=;
     |SI FSalida ! 0;
          #7#18 = #0#2;
          #7#19 = #0#8;
          #7#20 = #0#6;
          |GRABA 020#7n;
     |FINSI;
     |LIBERA #7;

     |BUCLE leelineas;
     nLin = 0;
     swSi = 0;
     |BUCLE buspresup;
     |SI swSi = 0;
          |ABRE #8;
          #8#0 = #0#0;
          #8#1 = #0#1;
          #8#2 = nLin + 1;
          |LEE 101#8=;
          |SI FSalida ! 0;
               #8#3 = aSerPre;
               #8#4 = aNumPre;
               |GRABA 020#8n;
          |FINSI;
          |LIBERA #8;
          |CIERRA #8;
     |FINSI;
     nLin = 0;
     |ABRE #9;
     #9#0 = aSerPre;
     #9#1 = aNumPre;
     #9#2 = 9999;
     |LEE 000#9];
     |SI FSalida = 0;
          |LEE 000#9a;
     |SINO;
          |LEE 000#9u;
     |FINSI;
     |SI FSalida = 0; |Y #9#0 = aSerPre; |Y #9#1 = aNumPre;
          nLin = #9#2;
     |SINO;
          nLin = 0;
     |FINSI;

     |BUCLE gotmpalm;

     |CIERRA #7;
     |CIERRA #9;
|FPRC;

|PROCESO VerAlta; |TIPO 7;
     |ABRE #102;
     #102#0 = "A";
     |LEE 000#102=;
     |SI FSalida ! 0; |O #102#42 = "N"; |ACABA; |FINSI;
     nMod = (FEntrada / 100) ! 0;
     |SI nMod = 1;
          |C_M #0#32 , 1 , "S"; |C_V #0#32 , 1 , "S";
          |SI #102#42 = "S";
               |C_M #0#33 , 1 , "S"; |C_V #0#33 , 1 , "S";
               |C_M #0#34 , 1 , "S"; |C_V #0#34 , 1 , "S";
          |FINSI;
          |ENCAMPO #32#0;
          |SI FSalida = 0;
               |PINTA #0#32;
               |SI #102#42 = "I";
                    aSer = #0#32;
                    aAlfa = aSer + "9999";
                    #0#0 = aAlfa;
                    #0#1 = 1;
                    |LEE 000#0];
                    |SI FSalida = 0;
                         |LEE 000#0a;
                    |SINO;
                         |LEE 000#0u;
                    |FINSI;
                    aAlfa = #0#0 % 101;
                    |SI FSalida = 0; |Y aAlfa = aSer;
                         aAlfa = #0#0 % 204;
                         nNume = aAlfa + 1;
                         aAlfa = aSer + (("0000" + nNume) % -104);
                    |SINO;
                         aAlfa = aSer + "0001";
                    |FINSI;
                    |DDEFECTO #0;
                    #0#0 = aAlfa; |PINTA #0#0;
                    #0#1 = 1; |PINTA #0#1;
                    |PTEC 802;
                    |C_M #0#1, 1, "N";
               |SINO;
                    |ENCAMPO #33#0;
                    |SI FSalida = 0;
                         |PINTA #0#33;
                         |SI #102#43 = "M";
                              |HAZ entraManu;
                         |SINO;
                              |HAZ entraAuto;
                         |FINSI;
                    |SINO;
                         |PTEC 807;
                    |FINSI;
               |FINSI;
          |SINO;
               |PTEC 807;
          |FINSI;
     |FINSI;
     |C_M #0#32 , 1 , "N";
     |C_M #0#33 , 1 , "N";
     |C_M #0#34 , 1 , "N";
     |C_V #0#32 , 1 , "N";
     |C_V #0#33 , 1 , "N";
     |C_V #0#34 , 1 , "N";
|FPRC;

|PROCESO vertio0; |TIPO 0;
     |SI #102#42 = "I";
          |SI #0#32 = " ";
               |AVISO; |ERROR;
          |SINO;
               |DDEFECTO #105;
               |ABRE #105;
               #105#0 = #0#32;
               |LEE 000#105=;
               |SI FSalida ! 0;
                    |GRABA 020#105b;
                    |PUSHV 0501 2380;
                    |PINPA #0#105;
                    |PINDA #0#105;
                    |CONFI "00000Confirma alta (S/N):";
                    |SI FSalida = 0;
                         |ENDATOS #1#105;
                         |SI FSalida = 0;
                              |GRABA 020#105a;
                         |SINO;
                              |BORRA 020#105c;
                              |ERROR;
                         |FINSI;
                    |SINO;
                         |BORRA 020#105c;
                         |ERROR;
                    |FINSI;
                    |POPV;
               |FINSI;
               |CIERRA #105;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO vertio66; |TIPO 66;
     |ABRE #105;
     |LEE 000#105p;
     |CONSULTA_CLAVE #1#105;
     |SI FSalida = 0;
          #0#32 = #105#0;
     |SINO;
          #0#32 = "";
     |FINSI;
     |PINTA #0#32;
     |ERROR;
     |CIERRA #105;
|FPRC;

|PROCESO vertic; |TIPO 66;
     |ABRE #106;
     |LEE 000#106p;
     |CONSULTA_CLAVE #1#106;
     |SI FSalida = 0;
          #0#33 = #106#0;
     |SINO;
          #0#33 = "";
     |FINSI;
     |PINTA #0#33;
     |ERROR;
     |CIERRA #106;
|FPRC;

|PROCESO entraManu;
     |ENCAMPO #34#0;
     |SI FSalida = 0;
          |PINTA #0#34;
          aClave = #0#32 + #0#33;
          nClave = #0#34;
          |SI nClave = 0;
               aClave = aClave + "499";
          |SINO;
               aClave = aClave + "999";
          |FINSI;
          |ABRE #27;
          #27#26 = aClave;
          |LEE 000#27];
          |SI FSalida = 0;
               |LEE 000#27a;
          |SINO;
               |LEE 000#27u;
          |FINSI;
          aClave = #0#32 + #0#33;
          bClave = #27#26 % 102;
          cClave = #27#26 % -103;
          dClave = #27#26 % 301;
          nClave = cClave;
          |SI aClave = bClave; |Y dClave = #0#34;
               nClave = nClave + 1;
          |SINO;
               |SI #0#34 = "0";
                    nClave = 1;
               |SINO;
                    nClave = 501;
               |FINSI;
          |FINSI;
          bClave = nClave; |QBF bClave;
          bClave = ("000" + bClave) % -103;
          aClave = aClave + bClave;

          |SI #goparame#42 = "S";    ||  (*) Fri May 28 13:29:32 CEST 2004
               #27#26 = aClave;
               |LEE 000#27=;
               |SI FSalida = 0;
                    aClave = (#27#26 % 102);
                    bClave = aClave + "999";
                    #27#26 = bClave;
                    |LEE 000#27];
                    |SI FSalida = 0;
                         |LEE 000#27a;
                    |SINO;
                         |LEE 000#27u;
                    |FINSI;
                    bClave = #27#26 % 102;
                    cClave = #27#26 % -103;
                    |SI FSalida = 0; |Y aClave = bClave;
                         nClave = cClave; nClave = nClave + 1;
                         |SI nClave > 999;
                              |MENAV "000Superado contador, mayor de 999";
                              |ERROR; |ACABA;
                         |FINSI;
                         aClave = aClave + (("000" + nClave) % -103);
                    |SINO;
                         aClave = aClave + "001"; || Esto nunca pasara!!!
                    |FINSI;
               |FINSI;
          |FINSI;        || (*)

          #0#0 = aClave;
          |PINTA #0#0;
          |PTEC 802;
          |CIERRA #27;
     |SINO;
          |PTEC 807;
     |FINSI;
|FPRC;

|PROCESO entraAuto;
     aClave = #0#32 + #0#33;
     aClave = aClave + "999";
     |ABRE #27;
     #27#26 = aClave;
     |LEE 000#27];
     |SI FSalida = 0;
          |LEE 000#27a;
     |SINO;
          |LEE 000#27u;
     |FINSI;
     aClave = #0#32 + #0#33;
     bClave = #27#26 % 102;
     cClave = #27#26 % -103;
     dClave = #27#26 % 301;
     nClave = cClave;
     |SI aClave = bClave;
          nClave = nClave + 1;
     |SINO;
          nClave = 1;
     |FINSI;
     bClave = nClave; |QBF bClave;
     bClave = ("000" + bClave) % -103;
     aClave = aClave + bClave;
     #0#0 = aClave;
     |PINTA #0#0;
     |PTEC 802;
     |CIERRA #27;
|FPRC;

|PROCESO Tipo30; |TIPO 30;
     |SI #0#9 = "C";
          |SUB_EJECUTA "guerz011";
          |SUB_EJECUTA "guerz012";
     |FINSI;
|FPRC;

|PROCESO Mensaje; |TIPO 7;
   nModo = (FEntrada / 100) ! 0;
   |SI nModo = 2;
      |MENSA "    <F2> Cambia fechas ";
   |SINO;
      |MENSA "";
   |FINSI;
|FPRC;

|PROCESO NoCero; |TIPO 0;
   aCP = #gomantho#4;
   |QBF aCP;
   |SI aCP = "";
        aMensaje = "0000El Codigo Postal no puede estar vacio.";
        |MENAV aMensaje;
        |ERROR;
   |SINO;
        nCP = aCP;
        |SI nCP = 0;
             aMensaje = "0000El Codigo Postal incorrecto.";
             |MENAV aMensaje;
             |ERROR;
        |FINSI;
   |FINSI;
|FPRC;
|PROCESO CambiaFec;
   nTecla = FSalida;



   nModo = (FEntrada / 100) ! 0;
   |SI nModo ! 2; FSalida = nTecla; |ACABA; |FINSI;

   |SI nTecla = 10;
      |C_M #gomantho#24,0,aModo24; |C_M #gomantho#24,1,"S";
      |C_M #gomantho#25,0,aModo25; |C_M #gomantho#25,1,"S";
      |C_M #gomantho#26,0,aModo26; |C_M #gomantho#26,1,"S";
|ET Pide1;
      |ENCAMPO #24#gomantho;
      |SI FSalida = 0; |O FSalida = 3;
|ET Pide2;
         |ENCAMPO #25#gomantho;
         |SI FSalida = 2; |VETE Pide1; |FINSI;
         |SI FSalida = 0; |O FSalida = 3;
            |ENCAMPO #26#gomantho;
            |SI FSalida = 2; |VETE Pide2; |FINSI;
            |SI FSalida = 0; |O FSalida = 3; |GRABA 020#gomantho.a; |FINSI;
         |FINSI;
      |FINSI;
      |C_M #gomantho#24,1,aModo24;
      |C_M #gomantho#25,1,aModo25;
      |C_M #gomantho#26,1,aModo26;
   |FINSI;

   FSalida = nTecla;
|FPRC;

|PROCESO gomanthoImp;
     |PRINT;
|FPRC;

|PROCESO FicEnvio;
     |DBASS aAlfa;
     eaFicImpre= aAlfa + "spool/";
     aAlfa = Usuario;
     eaFicImpre = eaFicImpre + aAlfa;
     Impresora = eaFicImpre;
     |IMPRE -77;
     |SI FSalida = 0;
          |INFOR "gomantho";   ||*Correo
          |SI FSalida = 0;
               |BUCLELIN 2 gomantho #0;
               |PIEINF;
               |FININF;
          |FINSI;
          |FINIMP;
     |FINSI;
|FPRC;

|PROCESO gomtantl1Ref;
     |SI #0#25 < #200#8;
          |SI nLinPres = 0;
               #0#25 = #200#8;
          |SINO;
               |SI nLinPres ! #200#2;
                    #0#25 = #200#8;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE gomtantl1Ref;
     #200#1003;
     10;
     #0#0, #0#1, 001, "C";
     #0#0, #0#1, 999, "C";
     ;
     NULL, gomtantl1Ref;
|FIN;

|PROCESO UltFecPresu;
     |DDEF aDef;
     aDef = aDef + "gomantl1";
     |CARGA_DEF aDef , referen@;
     |SI FSalida = 0;
          |BUCLE gomtantl1Ref;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|PROCESO OcultaGlobal;
     |SI #102#80 = "S";
          |C_V #0#5, 1, "N";
          |C_V #0#16, 1, "N";
          |C_V #0#18, 1, "N";
          |BLANCO 18522165;
          |ATRI R; |PINTA 1852, "               "; |ATRI 0;
     |FINSI;
|FPRC;

|PROCESO Expe8; |TIPO 8;
     |ABRE #102; |LEE 000#102p; |CIERRA #102;
     nDeci_Meda = #102#115;

     |HAZ OcultaGlobal;
|FPRC;

|PROCESO Expe13; |TIPO 13;
     |HAZ OcultaGlobal;

     |ABRE #102; |LEE 000#102p; |CIERRA #102;
     |SI #102#141 = "O";
          |ATRI I; |PINTA 503, "O.T.........: "; |ATRI 0;
          |ATRI R; |PINTA 1106, " O.E.       "; |ATRI 0;
     |FINSI;
|FPRC;

|PROCESO PinDesPres; |TIPO 13;
     |ABRE #3;
     #3#0 = #1#3;
     #3#1 = #1#4;
     |LEE 000#3=;
     |CIERRA #3;
     |PINTA 1715, #3#8;
|FPRC;

|PROCESO BajaAuxExp;
     |DDEF aDef;
     aDef = aDef + "gomantho";
     |CARGA_DEF aDef , referen@;
     |SI FSalida = 0;
          nHay = 0;
          |ABRE #referen@;
          #referen@#0 = #0#0;
          #referen@#1 = 0;
          |LEE 000#referen@.];
          |PARA; |SI FSalida = 0; |Y #referen@#0 = #0#0; |HACIENDO;
               |SI #referen@#1 ! #1#1;
                    nHay = 1;
               |FINSI;
               |LEE 000#referen@.s;
          |SIGUE;
          |DESCARGA_DEF #referen@;
          |SI nHay = 0;            ||Borra serie si no hay exp. de esta
               |ABRE #27;
               #27#26 = #0#0;
               |BORRA 000#27c;
               |CIERRA #27;
          |FINSI;
          |ABRE #24;               ||Borra Almacen
          #24#0 = #0#11;
          |BORRA 000#24c;
          |CIERRA #24;
     |FINSI;
|FPRC;
