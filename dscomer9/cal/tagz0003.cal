|FICHEROS;
     tagz0003 #0; || Este def

     agifa104 #1; || Pedido Venta (C)
     agifa073 #2; || Pedido Venta (L)
     agifa010 #3; || Albaran Venta (C)
     agifa071 #4; || Albaran Venta (L)
     agifa134 #5; || Factura Venta (C)
     agifa059 #6; || Factura Venta (L)
     agifa065 #9; || Historico Movimientos
     agifa036 #10;|| Depositos (C)
     agifa070 #11;|| Depositos (L)
     agifa084 #12;|| Facturas Directas (C)
     agifa069 #13;|| Facturas Directas (L)
     agifa146 #14;|| Proforma (C)
     agifa147 #15;|| Proforma (L)
     agifa081 #16;|| Pedidos Compras (C)
     agifa067 #17;|| Pedidos Compras (L)
     agifa077 #18;|| Albaran Compras (C)
     agifa080 #19;|| Albaran Compras (L)
     agifa079 #20;|| Facturas Compras (C)
     agifa072 #21;|| Facturas Compras (L)
     agifa501 #24;|| Tickets (C)
     agifa502 #25;|| Tickets (L)

     agifa007 #26;|| Series.
     agifa722 #30;|| Historico enlaces

     dscam003@ #1000;
     dscam004@ #1001;
     dscam008@ #1002;
     dscam009@ #1003;
     dscam067@ #1004;
     dscamrec@ #1005;
     dscam045@ #1006;
     dscam000@ #1007;
     caenlace@ #1008;
|FIN;

|VARIABLES;
     &PRMNT_enVer   = 0;
     swSi      = 0;
     aParam    = "";
     nNume1    = 0;
     nNume2    = 0;

     nCont     = 0;
     aSerie    = "";
     aAlfa     = "";
     aAlfa1    = "";
     &aCPath    = "";
     &aCNome    = "";
     aConta     = "agicont";

     nEmpresa = 0;
     nPeriodo = 0;
     &fich_alta = "";
|FIN;


|| Borra todos los documentos: Pedidos, Albaran, factura, recibos, cobros,
|| Historico movimientos etc... de las serie introducidas

|PROCESO BorraLineaPed;
  |BORRA 020#2a;
|FPRC;

|PROCESO BorraCabPed;
  |BORRA 020#1a;
|FPRC;

|PROCESO BorraPedido;

     |SI #1#25 ! #0#0; |Y #1#25 ! #0#1; |Y #1#25 ! #0#2; |Y #1#25 ! #0#3;
      |Y #1#25 ! #0#4; |Y #1#25 ! #0#5; |Y #1#25 ! #0#6; |Y #1#25 ! #0#7;

          |ERROR;

     |FINSI;

|FPRC;

|DEFBUCLE BorraPedido;
#1#1;
;
INICIO;
FINAL;
be;
NULL, BorraPedido, BorraLineaPed, BorraCabPed;
|FIN;

|PROCESO BorraLineaAlb;
  |BORRA 020#4a;
|FPRC;

|PROCESO BorraCabAlb;
  |BORRA 020#3a;
|FPRC;

|PROCESO BorraAlbaran;

     |SI #3#52 ! #0#0; |Y #3#52 ! #0#1; |Y #3#52 ! #0#2; |Y #3#52 ! #0#3;
      |Y #3#52 ! #0#4; |Y #3#52 ! #0#5; |Y #3#52 ! #0#6; |Y #3#52 ! #0#7;

          |ERROR;

     |FINSI;

|FPRC;

|DEFBUCLE BorraAlbaran;
#3#1;
;
INICIO;
FINAL;
be;
NULL, BorraAlbaran, BorraLineaAlb, BorraCabAlb;
|FIN;

|PROCESO BorraLineaFac;
  |BORRA 020#6a;
|FPRC;

|PROCESO BorraCabFac;
  #agifa722#0 = "FV";
  #agifa722#1 = #agifa134#49;
  #agifa722#2 = #agifa134#0;
  |LEE 101#agifa722.];
  aAlfa1 = #agifa722#1; |QBF aAlfa1; aAlfa1 = (aAlfa1 + "     ") % 0105;
  nNume1 = #agifa722#2;
  |SI FSalida = 0; |Y #agifa722#0 = "FV"; |Y aAlfa1 = #agifa134#49; |Y nNume1 = #agifa134#0;
     nEmpresa = #agifa722#8; nPeriodo = #agifa722#9;
     |DBASS aAlfa; |QBF aAlfa; aAlfa = aAlfa + aConta + "/def/caenlace.mas";
     |CARGA_DEF aAlfa, caenlace@;
     |SI FSalida = 0;
        |DBASS aAlfa; |QBF aAlfa; aAlfa = aAlfa + aConta + "/fich/" + (("00000" + nEmpresa) %-105) + nPeriodo + "/";
        |PATH_DAT #caenlace@#aAlfa#;
        aAlfa = "pu" + Usuario; |NOME_DAT #caenlace@#aAlfa#;
        |DELINDEX #caenlace@; |ABRE #caenlace@; FSalida = 0;
        |PARA; |SI FSalida = 0; |Y #agifa722#0 = "FV"; |Y aAlfa1 = #agifa134#49; |Y nNume1 = #agifa134#0; |HACIENDO;
           |HAZ CogeVersion;

           |DDEFECTO #caenlace@;
           #caenlace@#0 = #agifa722#4;
           #caenlace@#1 = #agifa722#5;
           #caenlace@#2 = #agifa722#6;
           #caenlace@#3 = #agifa722#7;
           #caenlace@#25 = "S";
           #caenlace@#37 = #agifa722#8;
           #caenlace@#38 = #agifa722#9;
           |GRABA 020#caenlace@.n;

           |BORRA 020#agifa722.a; |LIBERA #agifa722;
           |LEE 101#agifa722.s;
           aAlfa1 = #agifa722#1; |QBF aAlfa1; aAlfa1 = (aAlfa1 + "     ") % 0105;
           nNume1 = #agifa722#2;
        |SIGUE;
        |CIERRA #caenlace@; |DESCARGA_DEF #caenlace@;

        |DBASS aAlfa; |QBF aAlfa; aAlfa = aAlfa + aConta + "/fich/" + (("00000" + nEmpresa) %-105) + nPeriodo + "/";
        fich_alta = aAlfa;

        |DBASS aAlfa; |QBF aAlfa; aAlfa = aAlfa + aConta + "/fich/" + (("00000" + nEmpresa) %-105) + nPeriodo + "/";
        aAlfa = ":" + aConta + "/dsapunte.tab;" + aAlfa + ",pu" + Usuario;
        ||SUB_EJECUTA aAlfa;

     |FINSI;
  |FINSI;
  |LIBERA #agifa722;
  |BORRA 020#5a;
|FPRC;

|PROCESO BorraFactura;

     |SI #5#49 ! #0#0; |Y #5#49 ! #0#1; |Y #5#49 ! #0#2; |Y #5#49 ! #0#3;
      |Y #5#49 ! #0#4; |Y #5#49 ! #0#5; |Y #5#49 ! #0#6; |Y #5#49 ! #0#7;

          |ERROR;

     |FINSI;

|FPRC;

|DEFBUCLE BorraFactura;
#5#1;
;
INICIO;
FINAL;
be;
NULL, BorraFactura, BorraLineaFac, BorraCabFac;
|FIN;


|PROCESO BorraHisto;

     |SI #9#11 = #0#0; |O #9#11 = #0#1; |O #9#11 = #0#2; |O #9#11 = #0#3;
      |Y #9#11 = #0#4; |O #9#11 = #0#5; |O #9#11 = #0#6; |O #9#11 = #0#7;

          |BORRA 020#9a;

     |FINSI;

|FPRC;

|DEFBUCLE BorraHisto;
#9#1;
;
INICIO;
FINAL;
be;
NULL, BorraHisto;
|FIN;

|PROCESO BorraLineaDep;
  |BORRA 020#11a;
|FPRC;

|PROCESO BorraCabDep;
  |BORRA 020#10a;
|FPRC;

|PROCESO BorraDeposito;

     |SI #10#46 ! #0#0; |Y #10#46 ! #0#1; |Y #10#46 ! #0#2; |Y #10#46 ! #0#3;
      |Y #10#46 ! #0#4; |Y #10#46 ! #0#5; |Y #10#46 ! #0#6; |Y #10#46 ! #0#7;

          |ERROR;

     |FINSI;

|FPRC;

|DEFBUCLE BorraDeposito;
#10#1;
;
INICIO;
FINAL;
be;
NULL, BorraDeposito, BorraLineaDep, BorraCabDep;
|FIN;

|PROCESO BorraLineaFad;
  |BORRA 020#13a;
|FPRC;

|PROCESO BorraCabFad;
  #agifa722#0 = "FD";
  #agifa722#1 = #agifa084#48;
  #agifa722#2 = #agifa084#0;
  |LEE 000#agifa722.];
  aAlfa1 = #agifa722#1; |QBF aAlfa1; aAlfa1 = (aAlfa1 + "     ") % 0105;
  nNume1 = #agifa722#2;
  |SI FSalida = 0; |Y #agifa722#0 = "FD"; |Y aAlfa1 = #agifa084#48; |Y nNume1 = #agifa084#0;
     nEmpresa = #agifa722#8; nPeriodo = #agifa722#9;
     |DBASS aAlfa; |QBF aAlfa; aAlfa = aAlfa + aConta + "/def/caenlace.mas";
     |CARGA_DEF aAlfa, caenlace@;
     |SI FSalida = 0;
        |DBASS aAlfa; |QBF aAlfa; aAlfa = aAlfa + aConta + "/fich/" + (("00000" + nEmpresa) %-105) + nPeriodo + "/";
        |PATH_DAT #caenlace@#aAlfa#;
        aAlfa = "pu" + Usuario; |NOME_DAT #caenlace@#aAlfa#;
        |DELINDEX #caenlace@; |ABRE #caenlace@; FSalida = 0;
        |PARA; |SI FSalida = 0; |Y #agifa722#0 = "FD"; |Y aAlfa1 = #agifa084#48; |Y nNume1 = #agifa084#0; |HACIENDO;
           |HAZ CogeVersion;

           |DDEFECTO #caenlace@;
           #caenlace@#0 = #agifa722#4;
           #caenlace@#1 = #agifa722#5;
           #caenlace@#2 = #agifa722#6;
           #caenlace@#3 = #agifa722#7;
           #caenlace@#25 = "S";
           #caenlace@#37 = #agifa722#8;
           #caenlace@#38 = #agifa722#9;
           |GRABA 020#caenlace@.n;

           |LEE 000#agifa722.s;
           aAlfa1 = #agifa722#1; |QBF aAlfa1; aAlfa1 = (aAlfa1 + "     ") % 0105;
           nNume1 = #agifa722#2;
        |SIGUE;

        |DBASS aAlfa; |QBF aAlfa; aAlfa = aAlfa + aConta + "/fich/" + (("00000" + nEmpresa) %-105) + nPeriodo + "/";
        fich_alta = aAlfa;

        |DBASS aAlfa; |QBF aAlfa; aAlfa = aAlfa + aConta + "/fich/" + (("00000" + nEmpresa) %-105) + nPeriodo + "/";
        aAlfa = ":" + aConta + "/dsapunte.tab;" + aAlfa + ",pu" + Usuario;
        ||SUB_EJECUTA aAlfa;

        |CIERRA #caenlace@; |DESCARGA_DEF #caenlace@;
     |FINSI;
  |FINSI;
  |BORRA 020#12a;
|FPRC;

|PROCESO BorraFacdir;

     |SI #12#48 ! #0#0; |Y #12#48 ! #0#1; |Y #12#48 ! #0#2; |Y #12#48 ! #0#3;
      |Y #12#48 ! #0#4; |Y #12#48 ! #0#5; |Y #12#48 ! #0#6; |Y #12#48 ! #0#7;

          |ERROR;

     |FINSI;

|FPRC;

|DEFBUCLE BorraFacdir;
#12#1;
;
INICIO;
FINAL;
be;
NULL, BorraFacdir, BorraLineaFad, BorraCabFad;
|FIN;

|PROCESO BorraLineaPro;
  |BORRA 020#15a;
|FPRC;

|PROCESO BorraCabPro;
  |BORRA 020#14a;
|FPRC;

|PROCESO BorraProfor;

     |SI #14#48 ! #0#0; |Y #14#48 ! #0#1; |Y #14#48 ! #0#2; |Y #14#48 ! #0#3;
      |Y #14#48 ! #0#4; |Y #14#48 ! #0#5; |Y #14#48 ! #0#6; |Y #14#48 ! #0#7;

          |ERROR;

     |FINSI;

|FPRC;

|DEFBUCLE BorraProfor;
#14#1;
;
INICIO;
FINAL;
be;
NULL, BorraProfor, BorraLineaPro, BorraCabPro;
|FIN;

|PROCESO BorraLineaPec;
  |BORRA 020#17a;
|FPRC;

|PROCESO BorraCabPec;
  |BORRA 020#16a;
|FPRC;

|PROCESO BorraPedcom;

     |SI #16#25 ! #0#0; |Y #16#25 ! #0#1; |Y #16#25 ! #0#2; |Y #16#25 ! #0#3;
      |Y #16#25 ! #0#4; |Y #16#25 ! #0#5; |Y #16#25 ! #0#6; |Y #16#25 ! #0#7;

          |ERROR;

     |FINSI;

|FPRC;

|DEFBUCLE BorraPedcom;
#16#1;
;
INICIO;
FINAL;
be;
NULL, BorraPedcom, BorraLineaPec, BorraCabPec;
|FIN;

|PROCESO BorraLineaAlc;
  |BORRA 020#19a;
|FPRC;

|PROCESO BorraCabAlc;
  |BORRA 020#18a;
|FPRC;

|PROCESO BorraAlbacom;

     |SI #18#50 ! #0#0; |Y #18#50 ! #0#1; |Y #18#50 ! #0#2; |Y #18#50 ! #0#3;
      |Y #18#50 ! #0#4; |Y #18#50 ! #0#5; |Y #18#50 ! #0#6; |Y #18#50 ! #0#7;

          |ERROR;

     |FINSI;

|FPRC;

|DEFBUCLE BorraAlbacom;
#18#1;
;
INICIO;
FINAL;
be;
NULL, BorraAlbacom, BorraLineaAlc, BorraCabAlc;
|FIN;

|PROCESO BorraLineaFam;
  |BORRA 020#21a;
|FPRC;

|PROCESO BorraCabFam;
  #agifa722#0 = "FC";
  #agifa722#1 = #agifa079#66;
  #agifa722#2 = #agifa079#0;
  |LEE 000#agifa722.];
  aAlfa1 = #agifa722#1; |QBF aAlfa1; aAlfa1 = (aAlfa1 + "     ") % 0105;
  nNume1 = #agifa722#2;
  |SI FSalida = 0; |Y #agifa722#0 = "FC"; |Y aAlfa1 = #agifa079#66; |Y nNume1 = #agifa079#0;
     nEmpresa = #agifa722#8; nPeriodo = #agifa722#9;
     |DBASS aAlfa; |QBF aAlfa; aAlfa = aAlfa + aConta + "/def/caenlace.mas";
     |CARGA_DEF aAlfa, caenlace@;
     |SI FSalida = 0;
        |DBASS aAlfa; |QBF aAlfa; aAlfa = aAlfa + aConta + "/fich/" + (("00000" + nEmpresa) %-105) + nPeriodo + "/";
        |PATH_DAT #caenlace@#aAlfa#;
        aAlfa = "pu" + Usuario; |NOME_DAT #caenlace@#aAlfa#;
        |DELINDEX #caenlace@; |ABRE #caenlace@; FSalida = 0;
        |PARA; |SI FSalida = 0; |Y #agifa722#0 = "FC"; |Y aAlfa1 = #agifa079#66; |Y nNume1 = #agifa079#0; |HACIENDO;
           |HAZ CogeVersion;

           |DDEFECTO #caenlace@;
           #caenlace@#0 = #agifa722#4;
           #caenlace@#1 = #agifa722#5;
           #caenlace@#2 = #agifa722#6;
           #caenlace@#3 = #agifa722#7;
           #caenlace@#25 = "S";
           #caenlace@#37 = #agifa722#8;
           #caenlace@#38 = #agifa722#9;
           |GRABA 020#caenlace@.n;

           |LEE 000#agifa722.s;
           aAlfa1 = #agifa722#1; |QBF aAlfa1; aAlfa1 = (aAlfa1 + "     ") % 0105;
           nNume1 = #agifa722#2;
        |SIGUE;

        |DBASS aAlfa; |QBF aAlfa; aAlfa = aAlfa + aConta + "/fich/" + (("00000" + nEmpresa) %-105) + nPeriodo + "/";
        fich_alta = aAlfa;

        |DBASS aAlfa; |QBF aAlfa; aAlfa = aAlfa + aConta + "/fich/" + (("00000" + nEmpresa) %-105) + nPeriodo + "/";
        aAlfa = ":" + aConta + "/dsapunte.tab;" + aAlfa + ",pu" + Usuario;
        ||SUB_EJECUTA aAlfa;

        |CIERRA #caenlace@; |DESCARGA_DEF #caenlace@;
     |FINSI;
  |FINSI;
  |BORRA 020#20a;
|FPRC;

|PROCESO BorraFactucom;

     |SI #20#66 ! #0#0; |Y #20#66 ! #0#1; |Y #20#66 ! #0#2; |Y #20#66 ! #0#3;
      |Y #20#66 ! #0#4; |Y #20#66 ! #0#5; |Y #20#66 ! #0#6; |Y #20#66 ! #0#7;

          |ERROR;

     |FINSI;

|FPRC;

|DEFBUCLE BorraFactucom;
#20#1;
;
INICIO;
FINAL;
be;
NULL, BorraFactucom, BorraLineaFam, BorraCabFam;
|FIN;

|PROCESO BorraLineaTik;
  |BORRA 020#25a;
|FPRC;

|PROCESO BorraCabTik;
  #agifa722#0 = "TI";
  #agifa722#1 = #agifa501#36;
  #agifa722#2 = #agifa501#0;
  |LEE 000#agifa722.];
  aAlfa1 = #agifa722#1; |QBF aAlfa1; aAlfa1 = (aAlfa1 + "     ") % 0105;
  nNume1 = #agifa722#2;
  |SI FSalida = 0; |Y #agifa722#0 = "TI"; |Y aAlfa1 = #agifa501#36; |Y nNume1 = #agifa501#0;
     nEmpresa = #agifa722#8; nPeriodo = #agifa722#9;
     |DBASS aAlfa; |QBF aAlfa; aAlfa = aAlfa + aConta + "/def/caenlace.mas";
     |CARGA_DEF aAlfa, caenlace@;
     |SI FSalida = 0;
        |DBASS aAlfa; |QBF aAlfa; aAlfa = aAlfa + aConta + "/fich/" + (("00000" + nEmpresa) %-105) + nPeriodo + "/";
        |PATH_DAT #caenlace@#aAlfa#;
        aAlfa = "pu" + Usuario; |NOME_DAT #caenlace@#aAlfa#;
        |DELINDEX #caenlace@; |ABRE #caenlace@; FSalida = 0;
        |PARA; |SI FSalida = 0; |Y #agifa722#0 = "TI"; |Y aAlfa1 = #agifa501#36; |Y nNume1 = #agifa501#0; |HACIENDO;
           |HAZ CogeVersion;

           |DDEFECTO #caenlace@;
           #caenlace@#0 = #agifa722#4;
           #caenlace@#1 = #agifa722#5;
           #caenlace@#2 = #agifa722#6;
           #caenlace@#3 = #agifa722#7;
           #caenlace@#25 = "S";
           #caenlace@#37 = #agifa722#8;
           #caenlace@#38 = #agifa722#9;
           |GRABA 020#caenlace@.n;

           |LEE 000#agifa722.s;
           aAlfa1 = #agifa722#1; |QBF aAlfa1; aAlfa1 = (aAlfa1 + "     ") % 0105;
           nNume1 = #agifa722#2;
        |SIGUE;

        |DBASS aAlfa; |QBF aAlfa; aAlfa = aAlfa + aConta + "/fich/" + (("00000" + nEmpresa) %-105) + nPeriodo + "/";
        fich_alta = aAlfa;

        |DBASS aAlfa; |QBF aAlfa; aAlfa = aAlfa + aConta + "/fich/" + (("00000" + nEmpresa) %-105) + nPeriodo + "/";
        aAlfa = ":" + aConta + "/dsapunte.tab;" + aAlfa + ",pu" + Usuario;
        ||SUB_EJECUTA aAlfa;

        |CIERRA #caenlace@; |DESCARGA_DEF #caenlace@;
     |FINSI;
  |FINSI;
  |BORRA 020#24a;
|FPRC;

|DEFBUCLE BorraLineaTik;
     #agifa502#1;
     ;
     #agifa501#36, #agifa501#0, 001;
     #agifa501#36, #agifa501#0, 999;
     ;
     NULL, BorraLineaTik;
|FIN;

|PROCESO BorraTick;

     |SI #24#36 ! #0#0; |Y #24#36 ! #0#1; |Y #24#36 ! #0#2; |Y #24#36 ! #0#3;
      |Y #24#36 ! #0#4; |Y #24#36 ! #0#5; |Y #24#36 ! #0#6; |Y #24#36 ! #0#7;

          |ERROR;
     |SINO;
          |BUCLE BorraLineaTik;
          |HAZ BorraCabTik;
     |FINSI;

|FPRC;

|DEFBUCLE BorraTick;
#24#1;
;
INICIO;
FINAL;
be;
NULL, BorraTick;
|FIN;

|PROCESO BorraSerie;

     |SI #26#26 = #0#0; |O #26#26 = #0#1; |O #26#26 = #0#2; |O #26#26 = #0#3;
      |Y #26#26 = #0#4; |O #26#26 = #0#5; |O #26#26 = #0#6; |O #26#26 = #0#7;

          |BORRA 020#26a;

     |FINSI;

|FPRC;

|DEFBUCLE BorraSerie;
#26#1;
;
INICIO;
FINAL;
be;
NULL, BorraSerie;
|FIN;

|PROCESO HistorPagos;
   |DDEFECTO #dscam067@;
   #dscam067@#0 = "PG";
   #dscam067@#1 = #dscam009@#14;
   #dscam067@#2 = #dscam009@#3;
   |LEE 101#dscam067@.];
   nNume1 = #dscam067@#1;
   nNume2 = #dscam067@#2;
   |SI FSalida = 0; |Y #dscam067@#0 = "PG"; |Y nNume1 = #dscam009@#14; |Y nNume2 = #dscam009@#3;
||      |DBASS aAlfa; |QBF aAlfa; aAlfa = aAlfa + aConta + "/fich/" + (("00000" + #dscam067@#8) %-105) + #dscam067@#9 + "/";
||      |PATH_DAT #caenlace@#aAlfa#;
||      aAlfa = "pu" + Usuario; |NOME_DAT #caenlace@#aAlfa#;
||      |DELINDEX #caenlace@; |ABRE #caenlace@;
||      FSalida = 0;
      |PARA; |SI FSalida = 0; |Y #dscam067@#0 = "PG"; |Y nNume1 = #dscam009@#14; |Y nNume2 = #dscam009@#3; |HACIENDO;
||         |DDEFECTO #caenlace@;
||         #caenlace@#0 = #dscam067@#4;
||         #caenlace@#1 = #dscam067@#5;
||         #caenlace@#2 = #dscam067@#6;
||         #caenlace@#3 = #dscam067@#7;
||         #caenlace@#25 = "S";
||         #caenlace@#37 = #dscam067@#8;
||         #caenlace@#38 = #dscam067@#9;
||         |GRABA 020#caenlace@.n;

         |BORRA 020#dscam067@.a; |LIBERA #dscam067@;
         |LEE 101#dscam067@.s;
         nNume1 = #dscam067@#1;
         nNume2 = #dscam067@#2;
      |SIGUE;
||      |CIERRA #caenlace@;

||      |DBASS aAlfa; |QBF aAlfa; aAlfa = aAlfa + aConta + "/fich/" + (("00000" + nEmpresa) %-105) + nPeriodo + "/";
||      fich_alta = aAlfa;

||      |DBASS aAlfa; |QBF aAlfa; aAlfa = aAlfa + aConta + "/fich/" + (("00000" + #dscam067@#8) %-105) + #dscam067@#9 + "/";
||      aAlfa = ":" + aConta + "/dsapunte.tab;" + aAlfa + ",pu" + Usuario;
||      |SUB_EJECUTA aAlfa;

   |FINSI;
   |LIBERA #dscam067@;
   |BORRA 020#dscam009@.a;
|FPRC;

|DEFBUCLE HistorPagos;
#dscam009@#1002;
;
#dscam008@#40, 001;
#dscam008@#40, 999;
be;
NULL,HistorPagos;
|FIN;

|PROCESO RecibosCompra;
   |BUCLE HistorPagos;
   |BORRA 020#dscam008@.a;
|FPRC;

|DEFBUCLE RecibosCompra;
#dscam008@#2004;
;
00, aSerie, 000000, 000;
99, aSerie, 999999, 999;
;
NULL,RecibosCompra;
|FIN;

|PROCESO HistorCobros;
/*
   |DDEFECTO #dscam067@;
   #dscam067@#0 = "CB";
   #dscam067@#1 = #dscam004@#17;
   #dscam067@#2 = #dscam004@#3;
   |LEE 000#dscam067@.];
   nNume1 = #dscam067@#1;
   nNume2 = #dscam067@#2;
   |SI FSalida = 0; |Y #dscam067@#0 = "CB"; |Y nNume1 = #dscam004@#17; |Y nNume2 = #dscam004@#3;
      |DBASS aAlfa; |QBF aAlfa; aAlfa = aAlfa + aConta + "/fich/" + (("00000" + #dscam067@#8) %-105) + #dscam067@#9 + "/";
      |PATH_DAT #caenlace@#aAlfa#;
      aAlfa = "pu" + Usuario; |NOME_DAT #caenlace@#aAlfa#;
      |DELINDEX #caenlace@; |ABRE #caenlace@;
      FSalida = 0;
      |PARA; |SI FSalida = 0; |Y #dscam067@#0 = "CB"; |Y nNume1 = #dscam009@#14; |Y nNume2 = #dscam009@#3; |HACIENDO;
         |HAZ CogeVersion;

         |DDEFECTO #caenlace@;
         #caenlace@#0 = #dscam067@#4;
         #caenlace@#1 = #dscam067@#5;
         #caenlace@#2 = #dscam067@#6;
         #caenlace@#3 = #dscam067@#7;
         #caenlace@#25 = "S";
         #caenlace@#37 = #dscam067@#8;
         #caenlace@#38 = #dscam067@#9;
         |GRABA 020#caenlace@.n;

         |LEE 000#dscam067@.s;
         nNume1 = #dscam067@#1;
         nNume2 = #dscam067@#2;
      |SIGUE;
      |CIERRA #caenlace@;

      |DBASS aAlfa; |QBF aAlfa; aAlfa = aAlfa + aConta + "/fich/" + (("00000" + nEmpresa) %-105) + nPeriodo + "/";
      fich_alta = aAlfa;

      |DBASS aAlfa; |QBF aAlfa; aAlfa = aAlfa + aConta + "/fich/" + (("00000" + #dscam067@#8) %-105) + #dscam067@#9 + "/";
      aAlfa = ":" + aConta + "/dsapunte.tab;" + aAlfa + ",pu" + Usuario;
      |SUB_EJECUTA aAlfa;

   |FINSI;
*/
   |BORRA 020#dscam004@.a;
|FPRC;

|DEFBUCLE HistorCobros;
#dscam004@#1002;
;
#dscam003@#40, 001;
#dscam003@#40, 999;
be;
NULL,HistorCobros;
|FIN;

|PROCESO RecibosVenta;
   |BUCLE HistorCobros;
   |BORRA 020#dscam003@.a;
|FPRC;

|DEFBUCLE RecibosVenta;
#dscam003@#9005;
;
00, aSerie, 000000, 000, 000000001;
99, aSerie, 999999, 999, 999999999;
be;
NULL, RecibosVenta;
|FIN;

|PROCESO BorraCartera;
   #dscam000@#0 = #dscam045@#6;
   |LEE 000#dscam000@.=;
   |SI FSalida ! 0; |DDEFECTO #dscam000@; |FINSI;

   |PARA nCont = 0; |SI nCont [ 7; |HACIENDO nCont = nCont + 1;
      |SI #dscam045@#4 [ #tagz0003#nCont#; |Y #tagz0003#nCont# [ #dscam045@#5;
         |DBASS aAlfa; |QBF aAlfa; aAlfa = aAlfa + "dscarter/fich/";
         aAlfa1 = aAlfa + (("00000" + #dscam045@#6) % -105) + "/";
         |PATH_DAT #dscam003@#aAlfa1#; |PATH_DAT #dscam004@#aAlfa1#;
         |PATH_DAT #dscam008@#aAlfa1#; |PATH_DAT #dscam009@#aAlfa1#;
         |PATH_DAT #dscam067@#aAlfa1#;
         aCPath = aAlfa1;         |PATH_DAT #1005 aCPath;
         aCNome = "pb" + Usuario; |NOME_DAT #1005 aCNome;

         |ABRE #dscam067@;
         aSerie = #tagz0003#nCont#;
         |SI #dscam045@#2 = "V";
              |MENSA "0000Cartera (venta)...";
              |BUCLE RecibosVenta;
         |FINSI;
         |SI #dscam045@#2 = "C";
              |MENSA "0000Cartera (compra)...";
              |BUCLE RecibosCompra;
         |FINSI;
         |CIERRA #dscam067@;
      |FINSI;
   |SIGUE;
|FPRC;

|DEFBUCLE BorraCartera;
#dscam045@#1002;
;
nEmpresa, 001;
nEmpresa, 999;
;
NULL,BorraCartera;
|FIN;

|PROGRAMA;
     aParam = PARAMETRO; |QBF aParam;
     |ABRE #0;
     |LEE 101#0p;
     |SI FSalida ! 0; |GRABA 020#0b; |FINSI;

     |SI aParam = "";  || desde un programa externo
          #0#8 = "S";
          FSalida = 0;
     |SINO;            || desde el menu (SE LLAMA CON CUALQUIER PARAMETRO)
          |CLS;
          |CABEZA "Recalculo Series";
          #0#9 = "";
          |ENCAMPO #9#0;
          |SI #0#9 ! "BORRATODO"; |ACABA; |FINSI; ||LA CLAVE

          |C_V #0#9, 1, "N";
          #0#8 = "N";
          |PINTA #0#8;
          |PINPA #0#0;
          |PINDA #0#0;
          |ENDATOS #1#0;
     |FINSI;

||     |SI FSalida = 0;
          |GRABA 020#0a;
||     |FINSI;

     |SI #0#8 = "S";
          |MENSA "0000Gestion...";
          |ABRE #agifa722;
          ||BUCLE BorraPedido;
          ||BUCLE BorraAlbaran;
          ||BUCLE BorraFactura;
          |MENSA "0000Gestion (historico) ...";
          |BUCLE BorraHisto;
          ||BUCLE BorraDeposito;
          |MENSA "0000Gestion (directas) ...";
          |BUCLE BorraFacdir;
          ||BUCLE BorraProfor;
          ||BUCLE BorraPedcom;
          ||BUCLE BorraAlbacom;
          ||BUCLE BorraFactucom;
          ||BUCLE BorraTick;
          |CIERRA #agifa722;

          |MENSA "0000Cartera...";
          |DBASS aAlfa; |QBF aAlfa; aAlfa = aAlfa + "dscarter/def/";
          aAlfa1 = aAlfa + "dscam045.mas";
          |CARGA_DEF aAlfa1, dscam045@;
          |SI FSalida ! 0; |VETE Final; |FINSI;

          aAlfa1 = aAlfa + "dscam003.mas";
          |CARGA_DEF aAlfa1, dscam003@;
          |SI FSalida ! 0;
             |DESCARGA_DEF #dscam045@; |VETE Final;
          |FINSI;

          aAlfa1 = aAlfa + "dscam004.mas";
          |CARGA_DEF aAlfa1, dscam004@;
          |SI FSalida ! 0;
             |DESCARGA_DEF #dscam003@; |DESCARGA_DEF #dscam045@; |VETE Final;
          |FINSI;

          aAlfa1 = aAlfa + "dscam008.mas";
          |CARGA_DEF aAlfa1, dscam008@;
          |SI FSalida ! 0;
             |DESCARGA_DEF #dscam004@; |DESCARGA_DEF #dscam003@;
             |DESCARGA_DEF #dscam045@; |VETE Final;
          |FINSI;

          aAlfa1 = aAlfa + "dscam009.mas";
          |CARGA_DEF aAlfa1, dscam009@;
          |SI FSalida ! 0;
             |DESCARGA_DEF #dscam008@; |DESCARGA_DEF #dscam004@;
             |DESCARGA_DEF #dscam003@; |DESCARGA_DEF #dscam045@; |VETE Final;
          |FINSI;

          aAlfa1 = aAlfa + "dscam067.mas";
          |CARGA_DEF aAlfa1, dscam067@;
          |SI FSalida ! 0;
             |DESCARGA_DEF #dscam009@; |DESCARGA_DEF #dscam008@;
             |DESCARGA_DEF #dscam004@; |DESCARGA_DEF #dscam003@;
             |DESCARGA_DEF #dscam045@; |VETE Final;
          |FINSI;

          aAlfa1 = aAlfa + "dscamrec.mas";
          |CARGA_DEF aAlfa1, dscamrec@;
          |SI FSalida ! 0;
             |DESCARGA_DEF #dscam067@; |DESCARGA_DEF #dscam009@;
             |DESCARGA_DEF #dscam008@; |DESCARGA_DEF #dscam004@;
             |DESCARGA_DEF #dscam003@; |DESCARGA_DEF #dscam045@; |VETE Final;
          |FINSI;

          aAlfa1 = aAlfa + "dscam000.mas";
          |CARGA_DEF aAlfa1, dscam000@;
          |SI FSalida ! 0;
             |DESCARGA_DEF #dscamrec@; |DESCARGA_DEF #dscam067@;
             |DESCARGA_DEF #dscam009@; |DESCARGA_DEF #dscam008@;
             |DESCARGA_DEF #dscam004@; |DESCARGA_DEF #dscam003@;
             |DESCARGA_DEF #dscam045@; |VETE Final;
          |FINSI;

          |DBASS aAlfa; |QBF aAlfa; aAlfa = aAlfa + aConta + "/def/caenlace.mas";
          |CARGA_DEF aAlfa, caenlace@;
          |SI FSalida ! 0;
             |DESCARGA_DEF #dscam000@;
             |DESCARGA_DEF #dscamrec@; |DESCARGA_DEF #dscam067@;
             |DESCARGA_DEF #dscam009@; |DESCARGA_DEF #dscam008@;
             |DESCARGA_DEF #dscam004@; |DESCARGA_DEF #dscam003@;
             |DESCARGA_DEF #dscam045@; |VETE Final;
          |FINSI;

          |DBASS aAlfa; |QBF aAlfa; aAlfa = aAlfa + "dscarter/fich/";
          |PATH_DAT #dscam045@#aAlfa#; |PATH_DAT #dscam000@#aAlfa#;
          |ABRE #dscam000@;
          nEmpresa = #48#0;

          |BUCLE BorraCartera;

          |CIERRA #dscam000@;

          |DESCARGA_DEF #caenlace@;
          |DESCARGA_DEF #dscam000@; |DESCARGA_DEF #dscamrec@;
          |DESCARGA_DEF #dscam067@; |DESCARGA_DEF #dscam009@;
          |DESCARGA_DEF #dscam008@; |DESCARGA_DEF #dscam004@;
          |DESCARGA_DEF #dscam003@; |DESCARGA_DEF #dscam045@;

|ET Final;
          |BUCLE BorraSerie;

          |MENSA "0000Recalculos...";
          |SUB_EJECUTA "agifa026.tab;agifa655"; || Ejecutar Recalculo acumulados maestros
          |SUB_EJECUTA "agifa068.tab;agifa655"; || Ejecutar Recalculo stocks
     |FINSI;

     |LIBERA #0;
     |CIERRA #0;
|FPRO;
