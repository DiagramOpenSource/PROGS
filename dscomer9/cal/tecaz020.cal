|FICHEROS;
   tecaz020 #0;
   agifa025 #10;
   tecam021 #11;
   tecaw022;  || Clientes con NIF
   tecaw030;  || Clientes sin NIF
   tecam020 #13;
   tecam022 #14;
   agifa017 #17;
   agifa019 #19;
   agifa091 #91;
   dsm00211 #211;
   dsm00212 #212;

   web10005 #20;

   Clientes@ #1000;
   Cliente1@ #1001;
   Referen@  #2000;
|FIN;

|VARIABLES;
   &eaDRepre = "  ";
   &eaHRepre = "zz";
   &eaNomeDat = "";
   &nRieTotal = 0;
   &nRieUtili = 0;
   &eaCodCliente = "";
   &eaNomCliente = "";
   &enHayAgencia = 0;
   &enHayTablaResu = 0;
   &enHayLibreta = 0;
   &enHayGruCliPrv = 0;
   &enHayComiCli = 0;
   &enHayPais = 0;
   &enHayFPago = 0;
   nHayCtrl = 0;
   fFecha    = @;
   aDSCorreo = "";
   aProxy    = "";
   aDirDes   = "";
   aDirOri   = "";
   aTitulo   = "";
   aPar      = "";
   aTexto    = "";
   aFic      = "";
   aAlfa     = "";
   aAlfa1    = "";
   aOrigen   = "";
   aDestino  = "";

   nSw        = 0;
   nPVP1      = 0;
   nPVP2      = 0;
   nHayCli    = 0;
   nHayArtC   = 0;
   nHayArtG   = 0;

   nTermina   = 0;
   nCalc      = 0;
   nCont      = 0;
   nCont1     = 0;
{2}&aPuntero  = "";
{-1}nMPausa   = 0;
   &aPath = "";
|FIN;

|PROCESO Clientes;
   |SI #tecam020#9 = "M";
      #tecaw022#0 = #Clientes@#2;
      #tecaw022#1 = #Clientes@#0;
      |LEE 000#tecaw022.=;
      |SI FSalida = 0;
         |DDEFECTO #Cliente1@;
         aAlfa = "|NC"; aAlfa = #tecaw022#aAlfa#;
         nCalc = aAlfa; nCalc = nCalc - 1;
         |PARA nCont = 0; |SI nCont [ nCalc; |HACIENDO nCont = nCont + 1;
            #Cliente1@#nCont# = #tecaw022#nCont#;
         |SIGUE;

         |LEE 000#agifa091.p;
         #agifa091#0 = #Clientes@#20;
         |LEE 000#agifa091.=;
         |SI FSalida ! 0; |DDEFECTO #agifa091; |FINSI;
         #Cliente1@#8  = #agifa091#1;

         eaCodCliente = #Clientes@#0;
         eaNomCliente = #Clientes@#2;
         |HAZ SacaRiesgo;
         nCalc = nRieTotal - nRieUtili;
         #Cliente1@#10 = nCalc;
         #Cliente1@#11 = #Clientes@#39;
         |SI #tecam020#9 = "M";
             #Cliente1@#12 = #Clientes@#15;
         |FINSI;
         |GRABA 020#Cliente1@.n;
      |FINSI;
   |SINO;
      #tecaw030#0 = #Clientes@#2;
      #tecaw030#1 = #Clientes@#0;
      |LEE 000#tecaw030.=;
      |SI FSalida = 0;
         |DDEFECTO #Cliente1@;
         aAlfa = "|NC"; aAlfa = #tecaw030#aAlfa#;
         nCalc = aAlfa; nCalc = nCalc - 1;
         |PARA nCont = 0; |SI nCont [ nCalc; |HACIENDO nCont = nCont + 1;
            #Cliente1@#nCont# = #tecaw030#nCont#;
         |SIGUE;

         |LEE 000#agifa091.p;
         #agifa091#0 = #Clientes@#20;
         |LEE 000#agifa091.=;
         |SI FSalida ! 0; |DDEFECTO #agifa091; |FINSI;
         #Cliente1@#8  = #agifa091#1;

         eaCodCliente = #Clientes@#0;
         eaNomCliente = #Clientes@#2;
         |HAZ SacaRiesgo;
         nCalc = nRieTotal - nRieUtili;
         #Cliente1@#10 = nCalc;
         #Cliente1@#11 = #Clientes@#39;
         |SI #tecam020#9 = "M";
             #Cliente1@#12 = #Clientes@#15;
         |FINSI;
         |GRABA 020#Cliente1@.n;
      |FINSI;
   |FINSI;
|FPRC;

|DEFBUCLE Clientes;
#Clientes@#1001;
;
"      ";
"zzzzzz";
;
NULL,Clientes;
|FIN;

|PROCESO EnviaCli;
   #agifa025#0 = #tecam021#0;
   |LEE 000#agifa025.=;
   |SI FSalida ! 0; |ACABA; |FINSI;

   aAlfa = "SELECT * FROM agifa024 INTO sq" + Usuario + ".def WHERE 25 BETWEEN ";

   |SI #tecam021#1 = "N";
      aAlfa = aAlfa + "'"  + (("00" + #agifa025#0) % -102) + "'";
      aAlfa = aAlfa + ",'" + (("00" + #agifa025#0) % -102) + "'";
   |SINO;
      aAlfa = aAlfa + "'  ','zz'";
   |FINSI;

   |SQL aAlfa;
   |SI FSalida = 0;
      aAlfa = FSalida; |QBF aAlfa;
      aAlfa = aAlfa - "Seleccionados:";
      |SI FSalida ! 0;
         nCalc = FSalida + 85; aAlfa = aAlfa % nCalc;
         nCalc = aAlfa;
         |SI nCalc = 0; |ACABA; |FINSI;
      |FINSI;

      |DBASE aAlfa; |QBF aAlfa;
      aAlfa = aAlfa + "def/sq" + Usuario + ".mas";
      |CARGA_DEF aAlfa, Clientes@;
      |SI FSalida = 0;
         |DBASE aAlfa; |QBF aAlfa;
         |SI #tecam020#9 = "M";
            aAlfa = aAlfa + "def/tecaw022.mas";
         |SINO;
            aAlfa = aAlfa + "def/tecaw030.mas";
         |FINSI;
         |CARGA_DEF aAlfa, Cliente1@;
         |SI FSalida ! 0; |DESCARGA_DEF #Clientes@; |ACABA; |FINSI;

         aAlfa = #tecam020#0; |QBF aAlfa;
         aAlfa = aAlfa + (("00000" + #48#0) % -105) + "/";
         |SI #tecam020#9 = "M";
             |PATH_DAT #tecaw022#aAlfa#;
             |ABRE #tecaw022;
         |SINO;
             |PATH_DAT #tecaw030#aAlfa#;
             |ABRE #tecaw030;
         |FINSI;
         |DFICE aAlfa;        |QBF aAlfa; |PATH_DAT #1000 aAlfa;
         aAlfa = #tecam020#1; |QBF aAlfa; |PATH_DAT #1001 aAlfa;
         aAlfa = "tecw22" + #agifa025#0;  |NOME_DAT #1001 aAlfa;

         |ABRE #agifa091;
         |DELINDEX #Cliente1@;
         |ABRE #Cliente1@; |BUCLE Clientes; |CIERRA #Cliente1@;
         |CIERRA #agifa091;
         |SI #tecam020#9 = "M";
            |CIERRA #tecaw022;
         |SINO;
            |CIERRA #tecaw030;
         |FINSI;

         |DESCARGA_DEF #Cliente1@;
         |DELINDEX #Clientes@; |DESCARGA_DEF #Clientes@;
      |FINSI;
      |DBASE aAlfa; |QBF aAlfa; aAlfa = aAlfa + "def/sq" + Usuario + ".mas";
      |FBORRA aAlfa;
   |FINSI;
|FPRC;

|DEFBUCLE EnviaCli;
#tecam021#1;
;
#tecaz020#0;
#tecaz020#1;
;
NULL,EnviaCli;
|FIN;

|PROCESO EnvioCorreo;
   aDirOri = #web10005#22; |QBF aDirOri;
   aDirDes = #tecam022#1;  |QBF aDirDes;
   |SI aDSCorreo = ""; |O aDirOri = "";
/*
      |SI PARAMETRO = "";
         |MENAV "    Faltan parametros para el envio. Revise los parametros de correo.";
      |SINO;
         |AVISO; |AVISO; |AVISO;
         |ATRI I; |PINTA 2301, "    Faltan parametros para el envio. Revise los parametros de correo."; |ATRI N;
         |PARA nCont = 1; |SI nCont [ 50; |HACIENDO nCont = nCont + 1;
            InMPausa = 100; |ESPECIFICA "MSLEEP",nMPausa;
         |SIGUE;
         |BLIN 23;
      |FINSI;
*/
      |ACABA;
   |FINSI;
   |SI aDirDes = "";
/*
      aAlfa =  "    Representante [" + #agifa025#0 + "] sin direccion de correo";
      |SI PARAMETRO = "";
         |MENAV aAlfa;
      |SINO;
         |AVISO; |AVISO; |AVISO;
         |ATRI I; |PINTA 2301, aAlfa; |ATRI N;
         |PARA nCont = 1; |SI nCont [ 50; |HACIENDO nCont = nCont + 1;
            InMPausa = 100; |ESPECIFICA "MSLEEP",nMPausa;
         |SIGUE;
         |BLIN 23;
      |FINSI;
*/
      |ACABA;
   |FINSI;

   aAlfa = "2405Enviando [" + aDSCorreo + "] ..."; |MENSA aAlfa;
   |DSCORREO_ENVIA aDSCorreo, aProxy, aDirOri, aDirDes, aTitulo, aTexto, aFic;
   aAlfa = "2405                                    "; |MENSA aAlfa;
   |SI FSalida < 0;
      |SI PARAMETRO = "";
         |MENAV "    Problemas al enviar correo. Revisar conexion.";
      |SINO;
         |AVISO; |AVISO; |AVISO;
         |ATRI I; |PINTA 2301, "    Problemas al enviar correo. Revisar conexion."; |ATRI N;
         |PARA nCont = 1; |SI nCont [ 50; |HACIENDO nCont = nCont + 1;
            InMPausa = 100; |ESPECIFICA "MSLEEP",nMPausa;
         |SIGUE;
         |BLIN 23;
      |FINSI;
   |SINO;
      aAlfa = "    Envio correo representante [" + #agifa025#0 + "] completado.";
      |SI PARAMETRO = "";
||         |MENAV aAlfa;
      |SINO;
         |AVISO; |AVISO; |AVISO;
         |ATRI I; |PINTA 2301, aAlfa; |ATRI N;
         |PARA nCont = 1; |SI nCont [ 50; |HACIENDO nCont = nCont + 1;
            InMPausa = 100; |ESPECIFICA "MSLEEP",nMPausa;
         |SIGUE;
         |BLIN 23;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO Envia;
   #agifa025#0 = #tecam021#0;
   |LEE 000#agifa025.=;
   |SI FSalida ! 0; |ACABA; |FINSI;

   #tecam022#0 = #agifa025#0;
   |LEE 000#tecam022.=;
   |SI FSalida ! 0; |DDEFECTO #tecam022; |FINSI;

   |DBASE aAlfa; |QBF aAlfa;
   |SI #tecam020#9 = "M";
      aAlfa = aAlfa + "def/tecaw022.mas";
   |SINO;
      aAlfa = aAlfa + "def/tecaw030.mas";
   |FINSI;
   |CARGA_DEF aAlfa, Referen@;
   |SI FSalida = 0;
      aAlfa = #tecam020#1; |QBF aAlfa; |PATH_DAT #2000 aAlfa;
      aPath = aAlfa;
      aAlfa = "tecw22" + #agifa025#0;  |QBF aAlfa; |NOME_DAT #2000 aAlfa;
      aAlfa = #tecam020#1; |QBF aAlfa;
      |ABRE #Referen@;
      |LEE 000#Referen@.p;
      |SI FSalida ! 0; nHayCli = 0; |SINO; nHayCli = 1; |FINSI;
      aPuntero1 = "tecw22" + #agifa025#0; |QBF aPuntero1;
      aPuntero2 = aAlfa + "actclientes";
      IaPuntero = aPuntero1<-;
      |ESPECIFICA "EXPORTAPLB", aPuntero;
      eaNomeDat = aPuntero1;
      |SI #tecam020#9 = "M";
         aPuntero1 = "tecaw022";
      |SINO;
         aPuntero1 = "tecaw030";
      |FINSI;
      |HAZ ExportaTxt;
      |CIERRA #Referen@;
      |DESCARGA_DEF #Referen@;
   |FINSI;

   |DBASE aAlfa; |QBF aAlfa; aAlfa = aAlfa + "def/tecaw028.mas";
   |CARGA_DEF aAlfa, Referen@;
   |SI FSalida = 0;
      aAlfa = #tecam020#1; |QBF aAlfa; |PATH_DAT #2000 aAlfa;
      aPath = aAlfa;
      aAlfa = "tecw28" + #agifa025#0;  |QBF aAlfa; |NOME_DAT #2000 aAlfa;
      aAlfa = #tecam020#1; |QBF aAlfa;
      |ABRE #Referen@;
      |LEE 000#Referen@.p;
      |SI FSalida ! 0; nHayCtrl = 0; |SINO; nHayCtrl = 1; |FINSI;
      aPuntero1 = "tecw28" + #agifa025#0; |QBF aPuntero1;
      aPuntero2 = aAlfa + "ctrlenvios";
      IaPuntero = aPuntero1<-;
      |ESPECIFICA "EXPORTAPLB", aPuntero;
      eaNomeDat = aPuntero1;
      aPuntero1 = "tecaw028";
      |HAZ ExportaTxt;
      |CIERRA #Referen@;
      |DELINDEX #Referen@;
      |DESCARGA_DEF #Referen@;
   |FINSI;

   |SI #web10005#20 = "F"; aDSCorreo = #web10005#19;             |FINSI;
   |SI #web10005#20 = "L"; aDSCorreo = ""; |IP_REMOTO aDSCorreo; |FINSI;
   |SI #web10005#20 = "S"; aDSCorreo = ""; |IP_LOCAL  aDSCorreo; |FINSI;
   |QBF aDSCorreo;

   aProxy    = #web10005#21; |QBF aProxy;
   |SI nHayArtC ! 0; |Y #tecam021#2 = "C";
      aTitulo = "Actualizacion PDB's articulos comercial";
      aTexto = &13 + &10 + aTitulo;
      |SI #tecam020#9 = "P";
          aAlfa = #tecam020#1; |QBF aAlfa;
          aFic = aAlfa + "actarticulos.pdb"; |HAZ EnvioCorreo;
      |SINO;
          aAlfa = #tecam020#1; |QBF aAlfa;
          aFic = aAlfa + "actarticulos.txt"; |HAZ EnvioCorreo;
      |FINSI;
   |FINSI;
   |SI nHayArtG ! 0; |Y #tecam021#2 = "G";
      aTitulo = "Actualizacion PDB's articulos gerencia";
      aTexto = &13 + &10 + aTitulo;
      |SI #tecam020#9 = "P";
          aAlfa = #tecam020#1; |QBF aAlfa;
          aFic = aAlfa + "actarticulos_gerencia.pdb"; |HAZ EnvioCorreo;
      |SINO;
          aAlfa = #tecam020#1; |QBF aAlfa;
          aFic = aAlfa + "actarticulos_gerencia.txt"; |HAZ EnvioCorreo;
     |FINSI;
   |FINSI;
   |SI nHayCli  ! 0;
      aTitulo = "Actualizacion PDB's Clientes";
      aTexto = &13 + &10 + aTitulo;
      |SI #tecam020#9 = "P";
          aAlfa = #tecam020#1; |QBF aAlfa;
          aFic = aAlfa + "actclientes.pdb"; |HAZ EnvioCorreo;
      |SINO;
          aAlfa = #tecam020#1; |QBF aAlfa;
          aFic = aAlfa + "actclientes.txt"; |HAZ EnvioCorreo;
      |FINSI;
   |FINSI;
   |SI nHayCtrl ! 0;
      aTitulo = "Actualizacion PDB's Control envio pedidos";
      aTexto = &13 + &10 + aTitulo;
      |SI #tecam020#9 = "P";
          aAlfa = #tecam020#1; |QBF aAlfa;
          aFic = aAlfa + "ctrlenvios.pdb"; |HAZ EnvioCorreo;
      |SINO;
          aAlfa = #tecam020#1; |QBF aAlfa;
          aFic = aAlfa + "ctrlenvios.txt"; |HAZ EnvioCorreo;
     |FINSI;
   |FINSI;
   |SI enHayTablaResu ! 0;
      aTitulo = "Actualizacion PDB's Tabla resultados";
      aTexto = &13 + &10 + aTitulo;
      |SI #tecam020#9 = "P";
          aAlfa = #tecam020#1; |QBF aAlfa;
          aFic = aAlfa + "tabla_resultados.pdb"; |HAZ EnvioCorreo;
      |SINO;
          aAlfa = #tecam020#1; |QBF aAlfa;
          aFic = aAlfa + "tabla_resultados.txt"; |HAZ EnvioCorreo;
      |FINSI;
   |FINSI;

   |SI #0#5 = "S"; |HAZ LibretaDir; |FINSI;
   |SI enHayLibreta ! 0;
      aTitulo = "Actualizacion PDB's comercial";
      aTexto = &13 + &10 + aTitulo;
      |SI #tecam020#9 = "P";
           aAlfa = #tecam020#1; |QBF aAlfa;
           aFic = aAlfa + "comercial.pdb"; |HAZ EnvioCorreo;
      |SINO;
          aAlfa = #tecam020#1; |QBF aAlfa;
          aFic = aAlfa + "comercial.txt"; |HAZ EnvioCorreo;
     |FINSI;
   |FINSI;
   |SI enHayGruCliPrv ! 0;
      aTitulo = "Actualizacion PDB's Grupos Clientes y Proveedores";
      aTexto = &13 + &10 + aTitulo;
      |SI #tecam020#9 = "P";
          aAlfa = #tecam020#1; |QBF aAlfa;
          aFic = aAlfa + "grupo_cli_prv.pdb"; |HAZ EnvioCorreo;
      |SINO;
          aAlfa = #tecam020#1; |QBF aAlfa;
          aFic = aAlfa + "grupo_cli_prv.txt"; |HAZ EnvioCorreo;
      |FINSI;
   |FINSI;
   |SI enHayComiCli ! 0;
      aTitulo = "Actualizacion PDB's Comision Tipo Cliente";
      aTexto = &13 + &10 + aTitulo;
      |SI #tecam020#9 = "P";
          aAlfa = #tecam020#1; |QBF aAlfa;
          aFic = aAlfa + "comi_tipo_cli.pdb"; |HAZ EnvioCorreo;
      |SINO;
          aAlfa = #tecam020#1; |QBF aAlfa;
          aFic = aAlfa + "comi_tipo_cli.txt"; |HAZ EnvioCorreo;
      |FINSI;
   |FINSI;
   |SI enHayPais ! 0;
      aTitulo = "Actualizacion PDB's Paises";
      aTexto = &13 + &10 + aTitulo;
      |SI #tecam020#9 = "P";
           aAlfa = #tecam020#1; |QBF aAlfa;
           aFic = aAlfa + "paises.pdb"; |HAZ EnvioCorreo;
      |SINO;
           aAlfa = #tecam020#1; |QBF aAlfa;
           aFic = aAlfa + "paises.txt"; |HAZ EnvioCorreo;
      |FINSI;
   |FINSI;
   |SI enHayFPago ! 0;
      aTitulo = "Actualizacion PDB's Forma Pago";
      aTexto = &13 + &10 + aTitulo;
      |SI #tecam020#9 = "P";
          aAlfa = #tecam020#1; |QBF aAlfa;
          aFic = aAlfa + "forma_pago.pdb"; |HAZ EnvioCorreo;
      |SINO;
          aAlfa = #tecam020#1; |QBF aAlfa;
          aFic = aAlfa + "forma_pago.txt"; |HAZ EnvioCorreo;
      |FINSI;
   |FINSI;
   |SI enHayAgencia ! 0;
      aTitulo = "Actualizacion PDB's Agencias";
      aTexto = &13 + &10 + aTitulo;
      |SI #tecam020#9 = "P";
          aAlfa = #tecam020#1; |QBF aAlfa;
          aFic = aAlfa + "agencias.pdb"; |HAZ EnvioCorreo;
      |SINO;
          aAlfa = #tecam020#1; |QBF aAlfa;
          aFic = aAlfa + "agencias.txt"; |HAZ EnvioCorreo;
      |FINSI;
   |FINSI;

|FPRC;

|DEFBUCLE Envia;
#tecam021#1;
;
#tecaz020#0;
#tecaz020#1;
;
NULL,Envia;
|FIN;

|PROCESO Promoc;
   |PARA nCont = 1; |SI nCont [ 24; |HACIENDO nCont = nCont + 1;
      |SI #dsm00211#nCont# = #tecam020#6; |SAL; |FINSI;
   |SIGUE;
   |SI #dsm00211#nCont# = #tecam020#6;
      #dsm00212#0 = #dsm00211#0;
      #dsm00212#1 = #agifa019#0;
      |LEE 000#dsm00212.=;
      |SI FSalida = 0;
         |SI #dsm00212#5 [ fFecha; |Y fFecha [ #dsm00212#6;
             nPVP1 = #dsm00212#3;
         |FINSI;
      |FINSI;
   |FINSI;
|FPRC;

|DEFBUCLE Promoc;
#dsm00211#1;
;
INICIO;
FINAL;
;
NULL,Promoc;
|FIN;

|PROCESO ActArticulos;
   #agifa019#0 = #Referen@#0;
   |LEE 000#agifa019.=;
   |SI FSalida ! 0; |DDEFECTO #agifa019; |FINSI;

   nPVP1 = #agifa019#18; fFecha = ~; |BUCLE Promoc;

   #agifa017#0 = #Referen@#0;
   #agifa017#1 = 1;
   |LEE 000#agifa017.=;
   |SI FSalida ! 0; |DDEFECTO #agifa017; |FINSI;

   |SI nSw = 1;
      #Referen@#2 = nPVP1;
      #Referen@#3 = #agifa017#39;
      |SI nPVP1 ! #agifa019#18;
         #Referen@#4 = "S";
      |SINO;
         #Referen@#4 = "N";
      |FINSI;
      #Referen@#5 = #agifa019#19;
   |FINSI;
   |SI nSw = 2;
      #Referen@#2 = nPVP1;
      #Referen@#6 = #agifa017#39;
      |SI nPVP1 ! #agifa019#18;
         #Referen@#7 = "S";
      |SINO;
         #Referen@#7 = "N";
      |FINSI;
   |FINSI;
   |GRABA 020#Referen@.a; |LIBERA #Referen@;
|FPRC;

|DEFBUCLE ActArticulos;
#Referen@#1001;
;
"                    ";
"zzzzzzzzzzzzzzzzzzzz";
be;
NULL, ActArticulos;
|FIN;

|PROCESO GestionaEnvio;
   |ABRE #agifa025;

   |BUCLE EnviaCli;

   |ABRE #agifa017; |ABRE #dsm00211; |ABRE #dsm00212;
   |ABRE #agifa019;

   |ABRE #web10005;
   |LEE 000#web10005.p;
   |SI FSalida ! 0; |DDEFECTO #web10005; |FINSI;
   |CIERRA #web10005;

   aAlfa = #tecam020#0; |QBF aAlfa;
   aAlfa = aAlfa + (("00000" + #48#0) % -105) + "/";

   aAlfa1 = #tecam020#1; |QBF aAlfa1; |MKDIR aAlfa1;
   |SI #tecam020#9 = "M";
      aOrigen = aAlfa + "tecaw022.dat"; |FBORRA aOrigen;
      aOrigen = aAlfa + "tecaw022.ddx"; |FBORRA aOrigen;
      aOrigen = aAlfa + "tecaw022.ixx"; |FBORRA aOrigen;
   |SINO;
      aOrigen = aAlfa + "tecaw030.dat"; |FBORRA aOrigen;
      aOrigen = aAlfa + "tecaw030.ddx"; |FBORRA aOrigen;
      aOrigen = aAlfa + "tecaw030.ixx"; |FBORRA aOrigen;
   |FINSI;

   aOrigen = aAlfa + "tecaw020.dat"; aDestino = aAlfa1 + "tecaw020.dat";
   |COPIA_FICHERO aOrigen, aDestino; |FBORRA aOrigen;
   aOrigen = aAlfa + "tecaw020.ddx"; aDestino = aAlfa1 + "tecaw020.ddx";
   |COPIA_FICHERO aOrigen, aDestino; |FBORRA aOrigen;
   aOrigen = aAlfa + "tecaw020.ixx"; aDestino = aAlfa1 + "tecaw020.ixx";
   |COPIA_FICHERO aOrigen, aDestino; |FBORRA aOrigen;
   aOrigen = aAlfa + "tecaw021.dat"; aDestino = aAlfa1 + "tecaw021.dat";
   |COPIA_FICHERO aOrigen, aDestino; |FBORRA aOrigen;
   aOrigen = aAlfa + "tecaw021.ddx"; aDestino = aAlfa1 + "tecaw021.ddx";
   |COPIA_FICHERO aOrigen, aDestino; |FBORRA aOrigen;
   aOrigen = aAlfa + "tecaw021.ixx"; aDestino = aAlfa1 + "tecaw021.ixx";
   |COPIA_FICHERO aOrigen, aDestino; |FBORRA aOrigen;

   |DBASE aAlfa; |QBF aAlfa; aAlfa = aAlfa + "def/tecaw020.mas";
   |CARGA_DEF aAlfa, Referen@;
   |SI FSalida = 0;
      aAlfa = #tecam020#1; |QBF aAlfa; |PATH_DAT #2000 aAlfa;
      aPath = aAlfa;
      |ABRE #Referen@;
      nSw = 1; |BUCLE ActArticulos;

      |LEE 000#Referen@.p;
      |SI FSalida ! 0; nHayArtC = 0; |SINO; nHayArtC = 1; |FINSI;
      aPuntero1 = "tecaw020"; aPuntero2 = aAlfa + "actarticulos";
      IaPuntero = aPuntero1<-;
      |ESPECIFICA "EXPORTAPLB", aPuntero;
      |HAZ ExportaTxt;
      |CIERRA #Referen@;
      |DESCARGA_DEF #Referen@;
   |SINO;
       nHayArtC = 0;
   |FINSI;

   |DBASE aAlfa; |QBF aAlfa; aAlfa = aAlfa + "def/tecaw021.mas";
   |CARGA_DEF aAlfa, Referen@;
   |SI FSalida = 0;
      aAlfa = #tecam020#1; |QBF aAlfa; |PATH_DAT #2000 aAlfa;
      aPath = aAlfa;
      |ABRE #Referen@;

      nSw = 2; |BUCLE ActArticulos;

      |LEE 000#Referen@.p;
      |SI FSalida ! 0; nHayArtG = 0; |SINO; nHayArtG = 1; |FINSI;
      aPuntero1 = "tecaw021"; aPuntero2 = aAlfa + "actarticulos_gerencia";
      IaPuntero = aPuntero1<-;
      |ESPECIFICA "EXPORTAPLB", aPuntero;
      |HAZ ExportaTxt;
      |CIERRA #Referen@;
      |DESCARGA_DEF #Referen@;
   |SINO;
       nHayArtG = 0;
   |FINSI;

   eaDRepre = #0#0;
   eaHRepre = #0#1;
   |SI #0#2 = "S"; |HAZ CtrlPedido; |FINSI;
   |SI #0#3 = "S"; |HAZ TablaResu; |FINSI;
   |SI #0#4 = "S"; |HAZ GrupoCliPrv; |FINSI;
   |||SI #0#5 = "S"; |HAZ LibretaDir; |FINSI; -> se hace en el bucle envia
   |SI #0#6 = "S"; |HAZ ComiCli; |FINSI;
   |SI #0#7 = "S"; |HAZ Paises; |FINSI;
   |SI #0#8 = "S"; |HAZ FPago; |FINSI;
   |SI #0#9 = "S"; |HAZ Agencias; |FINSI;

   |BUCLE Envia;

   aDestino = aAlfa1 + "tecaw020.dat"; |FBORRA aDestino;
   aDestino = aAlfa1 + "tecaw020.ddx"; |FBORRA aDestino;
   aDestino = aAlfa1 + "tecaw020.ixx"; |FBORRA aDestino;
   aDestino = aAlfa1 + "tecaw021.dat"; |FBORRA aDestino;
   aDestino = aAlfa1 + "tecaw021.ddx"; |FBORRA aDestino;
   aDestino = aAlfa1 + "tecaw021.ixx"; |FBORRA aDestino;

   aDestino = aAlfa1;
   |_PDIR aDestino;
   |PARA; |SI FSalida = 0; |HACIENDO;
      |FBORRA aDestino; |_SDIR aDestino;
   |SIGUE;

   |CIERRA #agifa017; |CIERRA #dsm00211; |CIERRA #dsm00212;
   |CIERRA #agifa019;

   |CIERRA #agifa025;
|FPRC;

|PROGRAMA;
   |HAZ DecimalesBase;
   |ABRE #tecam020; |LEE 000#tecam020.p; |CIERRA #tecam020;

   |SI PARAMETRO = "";
      aAlfa = #tecam020#0; |QBF aAlfa;
      |SI aAlfa = "";|MENAV "0000Path no definido en 'Control general'"; |ACABA; |FINSI;
      |CLS;
      |CABEZA " Control preparacion envio manual ";
      |PINPA #0#0; |PINDA #0#0;
      |ENDATOS #1#0;
      |SI FSalida = 0;
         |ABRE #tecam020; |ABRE #tecam021; |ABRET #tecam022;
         |LEE 101#tecam020.p;
         |SI FSalida ! 0; |DDEFECTO #tecam020; |GRABA 020#tecam020.a; |FINSI;
         |PARA; |SI #tecam020#7 ! 0; |HACIENDO;
            |LIBERA #tecam020; |SLEEP 10;
            |LEE 101#tecam020.p;
         |SIGUE;
         |HAZ GestionaEnvio;
         |LIBERA #tecam020;
         |CIERRA #tecam020; |CIERRA #tecam021; |CIERRAT #tecam022;
      |FINSI;
   |SINO;
      aPar = PARAMETRO;
      |CLS;
      |ATRI R; |PINTA 0705, " DEMONIO DE ENVIO A REPRESENTANTES "; |ATRI N;
      |CUADRO 0910 1570;
      |PINTA 1012, "Este proceso  ejecutara el  proceso de  envio a TODOS los";
      |PINTA 1112, "representantes que tengamos dados de alta de los archivos";
      |PINTA 1212, "que haya en ese momento replicados.El proceso se repetira";
      |PINTA 1312, "cada intervalo  que se  haya  indicado en  la pantalla de";
      |PINTA 1412, "control general.";
      |ABRE #tecam020; |ABRE #tecam021; |ABRET #tecam022;
      |PARA; |SI; |HACIENDO;
         #tecaz020#0 = "  "; #tecaz020#1 = "zz";
         |LEE 101#tecam020.p;
         |SI FSalida ! 0; |DDEFECTO #tecam020; |GRABA 020#tecam020.a; |FINSI;
         |PARA; |SI #tecam020#7 ! 0; |HACIENDO;
            |LIBERA #tecam020; |SLEEP 5;
            |LEE 101#tecam020.p;
            |MENSA "    Tarea con el proceso bloqueado. Esperando a su liberado";
         |SIGUE;
         |SI FSalida ! 0; |DDEFECTO #tecam020; |FINSI;
         |LIBERA #tecam020;

         |SI aPar = "ENVIA";
            |HAZ GestionaEnvio;
         |FINSI;
         |LIBERA #tecam020;

         nTermina = 0;
         |PARA nCont = #tecam020#2 - 1; |SI nCont ] 0; |HACIENDO nCont = nCont - 1;
            |PARA nCont1 = 599; |SI nCont1 ] 0; |HACIENDO nCont1 = nCont1 - 1;
               nCalc = ((nCont1 / 10) - 0.49) ! 0;
               |MENSA "    Pulse espacio para salir";
               aAlfa = "    Tiempo hasta proximo envio : " + (("0000" + nCont) % -104);
               aAlfa = aAlfa + " minutos " + (("00" + nCalc) % -102) + " segundos";
               |ATRI I; |PINTA 2310, aAlfa; |ATRI N;
               |PULSATECLA;
               |SI FSalida = 32; nTermina = 1; |SAL; |FINSI;
               InMPausa = 100; |ESPECIFICA "MSLEEP",nMPausa;
            |SIGUE;
            |SI nTermina = 1; |SAL; |FINSI;
         |SIGUE;
         |SI nTermina = 1; |SAL; |FINSI;
         |BLIN 4;
         aPar = "ENVIA";
      |SIGUE;
      |CIERRA #tecam020; |CIERRA #tecam021; |CIERRAT #tecam022;
   |FINSI;
|FPRO;
