|FICHEROS;
     vigz0106 #0;
     vigw0019 #1; ||Tmp
     vigm0029 #29;
     vigm0030 #30;
     vigm0031 #31;
     vigm0050 #50;
     agifa010 #10;
     agifa071 #71;
     agifa084 #84;
     agifa069 #69;
     agifa019 #19;
     agifa024 #24;
     agifa060 #60;
     vigm0043 #43;
|FIN;

|VARIABLES;
     nTipo = 0;
     nHay = 0;
     aDTart = "";
     aHTart = "";
     aDTcli = "";
     aHTcli = "";
     aAno = "";
     aMes = "";
     aAlfa = "";
     f = @;
     fDFec = @;
     fHFec = @;
     fHoy = @;
     nSwCtrlComi = 0;
     nPreUltimo = 0;
     nEscala = 0;
     nDife = 0;
     nPreResul = 0;
     nPreEncontrado = 0;
     nPreDesde = 0;
     nPreHasta = 0;
     aDes = "";
     aClave = "";
     nUni = 0;
     &Tempo = "";
     nImpo = 0;
     nComi = 0;
     &aDivisa = "";
     &aMoneda = "";
     nAbo = 0;
     aRepre = "";
|FIN;

|PROCESO Tmp;
     |PRINT;
|FPRC;

|DEFBUCLE Tmp;
     #1#2;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Tmp;
|FIN;

|PROCESO EscaladoComi;
     nHay = 1;
     |ERROR10;
|FPRC;

|DEFBUCLE EscaladoComi;
     #31#2;
     ;
     aRepre, aDTart, aDTcli;
     aRepre, aHTart, aHTcli;
     ;
     NULL, EscaladoComi;
|FIN;

|PROCESO Escalado;
     aDTart = #19#0; aHTart = #19#0;
     aDTcli = #24#0; aHTcli = #24#0;
     nHay = -1;
     nTipo = 1;
     |BUCLE EscaladoComi;         ||art + cli
     |SI nHay = -1;
           aDTart = #19#2; aHTart = #19#2;
           aDTcli = #24#0; aHTcli = #24#0;
           nTipo = 2;
           |BUCLE EscaladoComi;   ||fam + cli
     |FINSI;
     |SI nHay = -1;
           aDTart = #19#0; aHTart = #19#0;
           aDTcli = ""; aHTcli = "";
           nTipo = 3;
           |BUCLE EscaladoComi;   || art + todos
     |FINSI;
     |SI nHay = -1;
           aDTart = #19#2; aHTart = #19#2;
           aDTcli = ""; aHTcli = "";
           nTipo = 4;
           |BUCLE EscaladoComi;   || fam + todos
     |FINSI;
     |SI nHay = -1;
           aDTart = ""; aHTart = "";
           aDTcli = #24#0; aHTcli = #24#0;
           nTipo = 5;
           |BUCLE EscaladoComi;   || todos + cli
     |FINSI;
     |SI nHay = -1;
           aDTart = ""; aHTart = "";
           aDTcli = ""; aHTcli = "";
           nTipo = 6;
           |BUCLE EscaladoComi;   || todos
     |FINSI;

     nComi = -1;
     |SI nHay ! -1;
          |SI #31#4 = 0; |Y #31#5 = 0;
               nComi = #31#6;
          |SINO;
               |SI nUni ] #31#4; |Y nUni [ #31#5; nComi = #31#6; |FINSI;
               |SI nUni ] #31#7; |Y nUni [ #31#8; nComi = #31#9; |FINSI;
               |SI nUni ] #31#10; |Y nUni [ #31#11; nComi = #31#12; |FINSI;
               |SI nUni ] #31#13; |Y nUni [ #31#14; nComi = #31#15; |FINSI;
               |SI nUni ] #31#16; |Y nUni [ #31#17; nComi = #31#18; |FINSI;
               |SI nUni ] #31#19; |Y nUni [ #31#20; nComi = #31#21; |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO GrabaComi;
     |DDEFECTO #1;
     #1#0 = #10#6;
     |SI nTipo = 1;
          #1#1 = #19#0;
          #1#5 = #19#1;
          #1#6 = #24#0;
          #1#7 = #24#1;
     |FINSI;
     |SI nTipo = 2;
          #1#1 = #60#0;
          #1#5 = #60#1;
          #1#6 = #24#0;
          #1#7 = #24#1;
     |FINSI;
     |SI nTipo = 3;
          #1#1 = #19#0;
          #1#5 = #19#1;
          #1#6 = "";
          #1#7 = "TODOS";
     |FINSI;
     |SI nTipo = 4;
          #1#1 = #60#0;
          #1#5 = #60#1;
          #1#6 = "";
          #1#7 = "TODOS";
     |FINSI;
     |SI nTipo = 5;
          #1#1 = "";
          #1#5 = "TODOS";
          #1#6 = #24#0;
          #1#7 = #24#1;
     |FINSI;
     |SI nTipo = 6;
          #1#1 = "";
          #1#5 = "TODOS";
          #1#6 = "";
          #1#7 = "TODOS";
     |FINSI;
     #1#2 = nComi;
     |LEE 101#1=;
     |SI FSalida ! 0; |GRABA 020#1b; |FINSI;
|FPRC;

|PROCESO Facturas;
     nSwCtrlComi = 0;

     |DDEFECTO #19;
     #19#0 = #69#2;
     |LEE 000#19=;

     |DDEFECTO #60;
     #60#0 = #19#2;
     |LEE 000#60=;

     |DDEFECTO #24;
     #24#0 = #84#3;
     |LEE 000#24=;

     nUni = #69#5 / 1000;
     |SI nUni < 0;
          nUni = -nUni;
     |FINSI;
     |SI nUni = 0; |ACABA; |FINSI;

     aRepre = #84#6;
     |HAZ Escalado;

     |SI nComi ! -1;
          nImpo = #69#5 / 1000 * nComi;
          |HAZ GrabaComi;
          #1#3 = #1#3 + #69#5;
          #1#4 = #1#4 + nImpo;
          |GRABA 020#1a;
          |LIBERA #1;
     |FINSI;
|FPRC;

|PROCESO FacCab;
     aDivisa = #84#65;
     aMoneda = #84#67;
     |HAZ Divisas084;
|FPRC;

|DEFBUCLE Facturas;
     #84#4;
     6;
     "     ", fDFec, 000001, #0#0;
     "zzzzz", fHFec, 999999, #0#0;
     ;
     NULL, FacCab, Facturas;
|FIN;

|PROCESO Albaranes;
     nSwCtrlComi = 0;

     |DDEFECTO #19;
     #19#0 = #71#2;
     |LEE 000#19=;

     |DDEFECTO #60;
     #60#0 = #19#2;
     |LEE 000#60=;

     |DDEFECTO #24;
     #24#0 = #10#3;
     |LEE 000#24=;

     nUni = #71#5 / 1000;
     |SI nUni < 0;
          nUni = -nUni;
     |FINSI;
     |SI nUni = 0; |ACABA; |FINSI;

     aRepre = #10#6;
     |HAZ Escalado;

     |SI nComi ! -1;
          nImpo = #71#5 / 1000 * nComi;
          |HAZ GrabaComi;
          |SI #50#5 = "+";
               |SI #10#43 = "S";
                    #1#3 = #1#3 + #71#5;
                    #1#4 = #1#4 + nImpo;
               |SINO;
                    #1#3 = #1#3 + #71#5;
                    #1#4 = #1#4 + nImpo;
               |FINSI;
          |SINO;
               |SI #10#43 = "S";
                    #1#3 = #1#3 - #71#5;
                    #1#4 = #1#4 - nImpo;
               |SINO;
                    #1#3 = #1#3 - #71#5;
                    #1#4 = #1#4 - nImpo;
               |FINSI;
          |FINSI;
          |GRABA 020#1a;
          |LIBERA #1;
     |FINSI;
|FPRC;

|PROCESO AlbCab;
     #50#3 = #10#53;
     #50#4 = #10#39;
     |LEE 000#50=;
     |SI FSalida = 0; |Y #50#1 = #0#4; |Y #50#0 ] #0#2; |Y #50#0 [ #0#3;
          aDivisa = #10#68;
          aMoneda = #10#70;
          |HAZ Divisas010;
     |SINO;
          |ERROR;
     |FINSI;
|FPRC;

|DEFBUCLE Albaranes;
     #10#1;
     6,43, 38;
     "     ", 000001, #0#0, "N", "S";
     "zzzzz", 999999, #0#0, "N", "S";
     ;
     NULL, AlbCab, Albaranes;
|FIN;

|PROCESO HistoTras;
     nSwCtrlComi = 0;

     |DDEFECTO #10;
     #10#52 = #43#0;
     #10#0 = #43#1;
     |LEE 000#10=;

     |DDEFECTO #19;
     #19#0 = #43#12;
     |LEE 000#19=;

     |DDEFECTO #60;
     #60#0 = #19#3;
     |LEE 000#60=;

     |DDEFECTO #24;
     #24#0 = #43#8;
     |LEE 000#24=;

     nUni = #43#13 / 1000;
     |SI nUni < 0;
          nUni = -nUni;
     |FINSI;
     |SI nUni = 0; |ACABA; |FINSI;

     aRepre = #43#10;
     |HAZ Escalado;

     |SI nComi ! -1;
          nImpo = #43#13 / 1000 * nComi;
          |HAZ GrabaComi;
          |SI #10#43 = "S";
               #1#3 = #1#3 + #43#13;
               #1#4 = #1#4 + nImpo;
          |SINO;
               #1#3 = #1#3 + #43#13;
               #1#4 = #1#4 + nImpo;
          |FINSI;
          |GRABA 020#1a;
          |LIBERA #1;
     |FINSI;
|FPRC;

|DEFBUCLE HistoTras;
     #43#3;
     10;
     fDFec, #0#0;
     fHFec, #0#0;
     ;
     NULL, HistoTras;
|FIN;

|PROCESO Defecto; |TIPO 7;
     fHoy = ~;
     aAlfa = fHoy % 402; #0#2 = aAlfa; |PINTA #0#2;
     aAlfa = fHoy % 402; #0#3 = aAlfa; |PINTA #0#3;
     aAlfa = fHoy % 704; #0#4 = aAlfa; |PINTA #0#4;
|FPRC;

|PROCESO Tipo3; |TIPO 3;
     |HAZ DecimalesBase;

     Impresora = "Crystal Reports";
     |IMPRE 0;
     |SI FSalida = 0;
          |INFOR "vigz0106";
          |SI FSalida = 0;
               |HAZ CreaTempo; |NOME_DAT #1#Tempo#; |DELINDEX #1;

               aAno = ("0000" + #0#4) % -104;
               aAlfa = "01." + (("00" + #0#2) % -102) + "." + aAno;
               fDFec = aAlfa;
               aAlfa = "28." + (("00" + #0#3) % -102) + "." + aAno;
               fHFec = aAlfa;
               aMes = fHFec % 402;
               |PARA; |SI; |HACIENDO;
                    f = fHFec + 1;
                    aAlfa = f % 402;
                    |SI aAlfa ! aMes; |SAL; |FINSI;
                    fHFec = fHFec + 1;
               |SIGUE;

               |ABRE #29;
               #29#0 = #0#0;
               |LEE 000#29=;
               |CIERRA #29;

               |ABRE #1;
               |ABRE #30;
               |ABRE #31;
               |ABRE #19;
               |ABRE #24;
               |ABRE #60;
               |ABRE #50;
               |BUCLE Albaranes;
               |CIERRA #50;
               |ABRE #10;
               |BUCLE HistoTras;
               |CIERRA #10;
               |BUCLE Facturas;
               |CIERRA #60;
               |CIERRA #24;
               |CIERRA #19;
               |CIERRA #31;
               |CIERRA #1;
               |BUCLE Tmp;
               |CIERRA #30;
               |PIEINF;
               |FININF;
               |HAZ BoraTempo; |DELINDEX #1;
          |SINO;
               |MENAV "0000Error en informe 'vigz0106'";
          |FINSI;
          |FINIMP;
     |FINSI;
|FPRC;
