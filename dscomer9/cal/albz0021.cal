|FICHEROS;
     albz0021 #0;

     albw0034 #34;       ||Registro Part.Duplic

     agifa065 #65;       ||Historico
     albw0033 #133,MANTE;      ||Aux. Partidas Duplic
     agifa019 #19;       ||Articulos

     dsm00057 #57;       ||Entrada Valorada (L)
     dsm00044 #44;       ||Reg. Existencias (L)
     agist002 #102;      ||In.Stock Inicial (L)
     agifa080 #80;       ||Albaranes Com. Lins.
     albm0003 #3;        ||Pdtes.de Recibir ALBERO
     albm0056 #56;       ||Orden de Tintado
     albm0046 #46;       ||Art./Alm./PartidaCAB

     albm0032 #32;       ||Introd.Mezcladas LIN
     albm0043 #43;       ||Partidas.Introd.Mezc

     albm0035 #35;       ||Incidencias
|FIN;

|VARIABLES;
     &enAlberoDentro = 0; || sirve para evitar reentradas

     aAux = "";
     nExiste = 0;
     aMensaje = "";
     aRespuesta = "";
     aTempo133 = "";
     &Tempo = "";

     nAlmacen = 0;
     aPartida = "";
     aArticulo = "";
     nAlmAnt = "";
     aParAnt = "";
     aArtAnt = "";
|FIN;

|PROGRAMA;
     |CLS;
     |ABRE #0;
     |DDEFECTO #0;
     |LEE 101#0p;
     nExiste = FSalida;
     |PINPA #0#0;
     |PINDA #0#0;
     |ENDATOS #1#0;
     |SI FSalida = 0;
          aRespuesta = #albz0021#1;
          ||#albz0021#1 = "NO";
          |SI nExiste = 0;
               |GRABA 020#0a;
          |SINO;
               |GRABA 020#0n;
          |FINSI;
          |SI aRespuesta = "SI";
               |HAZ Principal;
          |FINSI;
     |FINSI;
     |LIBERA #0;
     |CIERRA #0;
|FPRO;

|PROCESO agifa065;
     aAux = #agifa065#18;
     |QBF aAux;
     |SI aAux ! "";
          nAlmacen = #agifa065#5;
          aPartida = #agifa065#18;
          aArticulo = #agifa065#0;

          |SI nAlmAnt ! -1;
               |SI nAlmAnt = nAlmacen; |Y aParAnt = aPartida; |Y aArtAnt ! aArticulo;

                    |DDEFECTO #agifa019;
                    #agifa019#0 = aArtAnt;
                    |LEE 000#agifa019.=;

                    |DDEFECTO #albw0033;
                    #albw0033#0 = nAlmAnt;
                    #albw0033#1 = aParAnt;
                    #albw0033#2 = aArtAnt;
                    |LEE 101#albw0033.=;
                    |SI FSalida ! 0;
                         #albw0033#3 = #agifa019#1;
                         |GRABA 020#albw0033.n;
                         |LIBERA #albw0033;
                    |FINSI;

                    |DDEFECTO #agifa019;
                    #agifa019#0 = aArticulo;
                    |LEE 000#agifa019.=;

                    |DDEFECTO #albw0033;
                    #albw0033#0 = nAlmacen;
                    #albw0033#1 = aPartida;
                    #albw0033#2 = aArticulo;
                    |LEE 101#albw0033.=;
                    |SI FSalida ! 0;
                         #albw0033#3 = #agifa019#1;
                         |GRABA 020#albw0033.n;
                         |LIBERA #albw0033;
                    |FINSI;

               |FINSI;
               nAlmAnt = nAlmacen;
               aParAnt = aPartida;
               aArtAnt = aArticulo;
          |SINO;
               nAlmAnt = nAlmacen;
               aParAnt = aPartida;
               aArtAnt = aArticulo;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE agifa065;
 #agifa065#4;
 18;
 "01.01.0000", #albz0021#2, "                    ", #albz0021#4;
 "31.12.9999", #albz0021#3, "zzzzzzzzzzzzzzzzzzzz", #albz0021#5;
 ;
 NULL, NULL, NULL, NULL, NULL, agifa065;
 #agifa065#5, #agifa065#18, #agifa065#0;
|FIN;

|PROCESO inf;
     #133#0 = 00001;
     #133#1 = "               ";
     #133#2 = "                    ";
|FPRC;

|PROCESO sup;
     #133#0 = 99999;
     #133#1 = "zzzzzzzzzzzzzzz";
     #133#2 = "zzzzzzzzzzzzzzzzzzzz";
|FPRC;

|PROCESO Principal;
     |HAZ CreaTempo; aTempo133 = Tempo;
     |NOME_DAT #133 aTempo133;
     |DELINDEX #133;

     |ABRE #agifa019;
     |ABRE #133;
     nAlmAnt = -1;
     |BUCLE agifa065;
     |CIERRA #133;
     |CIERRA #agifa019;

     |CLS;

     |ENTLINEAL #1#133, -1, 4, 22, 0, inf, sup;

     aMensaje = "0000NEjecutar proceso de Correcion?";
     |CONFI aMensaje;
     |SI FSalida = 0;
          |HAZ Soluciona;
     |FINSI;

     |DELINDEX #133; Tempo = aTempo133; |HAZ BoraTempo;
|FPRC;

|PROCESO Marca; |TIPO 11;
     |SI FSalida = 13;
          |SI #albw0033#4 = "*";
               #albw0033#4 = "";
          |SINO;
               #albw0033#4 = "*";
          |FINSI;
          |GRABA 020#albw0033.a;
          |PINTA #albw0033#4;
     |FINSI;
|FPRC;

|PROCESO agifa065_sol;
     |SI #agifa065#0 ! #albw0033#2;
          |BORRA 020#agifa065.a;
          #agifa065#0 = #albw0033#2;
          |GRABA 020#agifa065.n;
          |LIBERA #agifa065;
     |FINSI;
|FPRC;

|DEFBUCLE agifa065_sol;
 #agifa065#4;
 18;
 "01.01.0000", #albw0033#0, "                    ", #albw0033#1;
 "31.12.9999", #albw0033#0, "zzzzzzzzzzzzzzzzzzzz", #albw0033#1;
 be;
 NULL, agifa065_sol;
|FIN;

|PROCESO dsm00057;
     |SI #dsm00057#0 ! #albw0033#2;
          #dsm00057#0 = #albw0033#2;
          #dsm00057#2 = #albw0033#3;
          |GRABA 020#dsm00057.a;
          |LIBERA #dsm00057;
     |FINSI;
|FPRC;

|DEFBUCLE dsm00057;
 #dsm00057#1;
 1, 22;   ||Almacen + Partida
 "     ", 000000, 00001, #albw0033#0, #albw0033#1;
 "zzzzz", 999999, 99999, #albw0033#0, #albw0033#1;
 be;
 NULL, dsm00057;
|FIN;


|PROCESO dsm00044;
     |SI #dsm00044#0 ! #albw0033#2;
          #dsm00044#0 = #albw0033#2;
          #dsm00044#2 = #albw0033#3;
          |GRABA 020#dsm00044.a;
          |LIBERA #dsm00044;
     |FINSI;
|FPRC;

|DEFBUCLE dsm00044;
 #dsm00044#1;
 1, 13;   ||Almacen + Partida
 "     ", 000000, 00001, #albw0033#0, #albw0033#1;
 "zzzzz", 999999, 99999, #albw0033#0, #albw0033#1;
 be;
 NULL, dsm00044;
|FIN;

|PROCESO agist002;
     |SI #agist002#2 ! #albw0033#2;
          #agist002#2 = #albw0033#2;
          #agist002#6 = #albw0033#3;
          |GRABA 020#agist002.a;
          |LIBERA #agist002;
     |FINSI;
|FPRC;

|DEFBUCLE agist002;
 #agist002#1;
 3, 8;   ||Almacen + Partida
 "     ", 000001, 00001, #albw0033#0, #albw0033#1;
 "zzzzz", 999999, 99999, #albw0033#0, #albw0033#1;
 be;
 NULL, agist002;
|FIN;

|PROCESO agifa080;
     |SI #agifa080#2 ! #albw0033#2;
          #agifa080#2 = #albw0033#2;
          #agifa080#4 = #albw0033#3;
          |GRABA 020#agifa080.a;
          |LIBERA #agifa080;
     |FINSI;
|FPRC;

|DEFBUCLE agifa080;
 #agifa080#1;
 3, 37;   ||Almacen + Partida
 "     ", 000000, 001, #albw0033#0, #albw0033#1;
 "zzzzz", 999999, 999, #albw0033#0, #albw0033#1;
 be;
 NULL, agifa080;
|FIN;

|PROCESO albm0003;
     |SI #albm0003#4 ! #albw0033#2;
          #albm0003#4 = #albw0033#2;
          #albm0003#5 = #albw0033#3;
          |GRABA 020#albm0003.a;
          |LIBERA #albm0003;
     |FINSI;
|FPRC;

|DEFBUCLE albm0003;
 #albm0003#1;
 3, 10;   ||Almacen + Partida
 "     ", 000001, #albw0033#0, #albw0033#1;
 "zzzzz", 999999, #albw0033#0, #albw0033#1;
 be;
 NULL, albm0003;
|FIN;

|PROCESO albm0056;
     |SI #albm0056#28 ! #albw0033#2;
          #albm0056#28 = #albw0033#2;
          #albm0056#29 = #albw0033#3;
          |GRABA 020#albm0056.a;
          |LIBERA #albm0056;
     |FINSI;
|FPRC;

|DEFBUCLE albm0056;
 #albm0056#1;
 12, 52;   ||Almacen + Partida
 000001, #albw0033#0, #albw0033#1;
 999999, #albw0033#0, #albw0033#1;
 be;
 NULL, albm0056;
|FIN;

|PROCESO albm0046;
     |SI #albm0046#0 ! #albw0033#2;
          #albm0046#0 = #albw0033#2;
          |GRABA 020#albm0046.a;
          |LIBERA #albm0046;
     |FINSI;
|FPRC;

|DEFBUCLE albm0046;
 #albm0046#1;
 ;
 #albw0033#0, #albw0033#1;
 #albw0033#0, #albw0033#1;
 be;
 NULL, albm0046;
|FIN;

|PROCESO albm0043;
     |DDEFECTO #albm0032;
     #albm0032#0 = #albm0043#0;
     #albm0032#1 = #albm0043#1;
     |LEE 101#albm0032.=;
     |SI FSalida = 0;
          |SI #albm0032#4 = #albw0033#0;     ||Mismo Almacen
               |SI #albm0032#2 ! #albw0033#2;     ||No es este articulo
                    #albm0032#2 = #albw0033#2;
                    #albm0032#3 = #albw0033#3;
                    |GRABA 020#albm0032.a;
               |FINSI;
          |FINSI;
          |LIBERA #albm0032;
     |FINSI;
|FPRC;

|DEFBUCLE albm0043;
 #albm0043#1;
 ;
 000001, 01, #albw0033#1;
 999999, 99, #albw0033#1;
 ;
 NULL, albm0043;
|FIN;

|PROCESO albm0035;
     |SI #albm0035#0 ! #albw0033#2;
          |BORRA 020#albm0035.a;
          #albm0035#0 = #albw0033#2;
          #albm0035#1 = #albw0033#3;
          |GRABA 020#albm0035.n;
          |LIBERA #albm0035;
     |FINSI;
|FPRC;

|DEFBUCLE albm0035;
 #albm0035#1;
 ;
 "                    ", #albw0033#0, #albw0033#1;
 "zzzzzzzzzzzzzzzzzzzz", #albw0033#0, #albw0033#1;
 be;
 NULL, albm0035;
|FIN;

|PROCESO albw0033;
     |DDEFECTO #albw0034;
     #albw0034#0 = #albw0033#0;
     #albw0034#1 = #albw0033#1;
     #albw0034#2 = #albw0033#2;
     |LEE 101#albw0034.=;
     |SI FSalida ! 0; |GRABA 020#albw0034.b; |FINSI;
     #albw0034#3 = #albw0033#3;
     |GRABA 020#albw0034.a;
     |LIBERA #albw0034;

     |BUCLE agifa065_sol;

     |BUCLE dsm00057;    ||Entrada Valorada
     |BUCLE dsm00044;    ||Reg. Existencias
     |BUCLE agist002;    ||Stock Inicial

     |BUCLE agifa080;    ||Albaranes Com. Lins.

     |BUCLE albm0003;    ||Ped. Pend. Recibir
     |BUCLE albm0056;    ||Orden de Tintado

     |BUCLE albm0046;    ||Art./Alm./PartidaCAB

     |ABRE #albm0032;
     |BUCLE albm0043;    ||Mezcladas
     |CIERRA #albm0032;

     |BUCLE albm0035;    ||Incidencias
|FPRC;

|DEFBUCLE albw0033;
 #albw0033#2;
 ;
 00001, "               ", "*";
 99999, "zzzzzzzzzzzzzzz", "*";
 ;
 NULL, albw0033;
|FIN;

|PROCESO Soluciona;
     |ABRE #albw0034;
     |BUCLE albw0033;
     |CIERRA #albw0034;
|FPRC;
