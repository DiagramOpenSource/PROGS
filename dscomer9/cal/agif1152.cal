     CambiaAlbero

|FICHEROS;
     referen@ #1;
     agifa154 #20;
|FIN;

|VARIABLES;
     &eaFic = "";
     &eaOrg = "";
     &eaDes = "";
     &enErr = 0;
     aDef = "";
     aAlfa = "";
     &CambDesc = "";
     &enAlberoDentro = 0;
|FIN;

|PROCESO CliObra;
     |BORRA 020#1a;
     #1#2 = #20#3;
     |SI CambDesc = "S"; #1#3 = #20#5; |FINSI;
     |GRABA 000#1n;
     |SI FSalida ! 0;
          enErr = FSalida;
          eaFic = "guerm011";
          eaOrg = #20#2;
          eaDes = #20#3;
          |HAZ Print;
     |FINSI;
|FPRC;

|DEFBUCLE CliObraNume;
     #1#1003;
     ;
     "      ", 00001, #20#2;
     "zzzzzz", 99999, #20#2;
     be;
     NULL, CliObra;
|FIN;

|DEFBUCLE CliObraAlfa;
     #1#1003;
     ;
     "      ", "     ", #20#2;
     "zzzzzz", "zzzzz", #20#2;
     be;
     NULL, CliObra;
|FIN;

|PROCESO LinSalida;
     |SI #1#2 = #20#2;
          #1#2 = #20#3;
          |SI CambDesc = "S"; #1#3 = #20#5; |FINSI;
          |GRABA 020#1a;
     |FINSI;
     |LIBERA #1;
|FPRC;

|DEFBUCLE LinSalida;
     #1#1002;
     ;
     000000, 001;
     999999, 999;
     be;
     NULL, LinSalida;
|FIN;

|PROCESO CambiaOtros;
     |DDEF aDef;

     aAlfa = aDef + "guerm002";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |BUCLE LinSalida;
          |DESCARGA_DEF #referen@;
     |FINSI;

     aAlfa = aDef + "guerm011";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |BUCLE CliObraNume;
          |DESCARGA_DEF #referen@;
     |FINSI;

     aAlfa = aDef + "guerm015";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |BUCLE LinSalida;
          |DESCARGA_DEF #referen@;
     |FINSI;

     aAlfa = aDef + "guerm204";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |BUCLE CliObraAlfa;
          |DESCARGA_DEF #referen@;
     |FINSI;

     aAlfa = aDef + "guerm206";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |BUCLE LinSalida
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|PROCESO albm0001;
     |BORRA 020#1a;
     #1#1 = #20#3;
     |SI CambDesc = "S"; #1#3 = #20#5; |FINSI;
     |GRABA 000#1n;
     |SI FSalida ! 0;
          enErr = FSalida;
          eaFic = "albm0001";
          eaOrg = #20#2;
          eaDes = #20#3;
          |HAZ Print;
     |FINSI;
|FPRC;

|DEFBUCLE albm0001;
     #1#1003;
     ;
     "01.01.0001", #20#2, 00001;
     "31.12.9999", #20#2, 99999;
     be;
     NULL, albm0001;
|FIN;


|PROCESO albm0002;
     #1#4 = #20#3;
     |SI CambDesc = "S"; #1#5 = #20#5; |FINSI;
     |GRABA 020#1a;
|FPRC;

|DEFBUCLE albm0002;
     #1#1002;
     4;
     "     ", 000001, #20#2;
     "zzzzz", 999999, #20#2;
     be;
     NULL, albm0002;
|FIN;


|PROCESO albm0004;
     #1#3 = #20#3;
     |SI CambDesc = "S"; #1#5 = #20#5; |FINSI;
     |GRABA 020#1a;
|FPRC;

|DEFBUCLE albm0004;
     #1#1002;
     3;
     "01.01.0000", "        ", #20#2;
     "31.12.9999", "zzzzzzzz", #20#2;
     be;
     NULL, albm0004;
|FIN;

|PROCESO albm0026;
     |BORRA 020#1a;
     #1#0 = #20#3;
     |SI CambDesc = "S"; #1#1 = #20#5; |FINSI;
     |GRABA 000#1n;
     |SI FSalida ! 0;
          enErr = FSalida;
          eaFic = "albm0026";
          eaOrg = #20#2;
          eaDes = #20#3;
          |HAZ Print;
     |FINSI;
|FPRC;

|DEFBUCLE albm0026;
     #1#1001;
     ;
     #20#2;
     #20#2;
     be;
     NULL, albm0026;
|FIN;

|PROCESO albm0027;
     |BORRA 020#1a;
     #1#0 = #20#3;
     |GRABA 000#1n;
     |SI FSalida ! 0;
          enErr = FSalida;
          eaFic = "albm0027";
          eaOrg = #20#2;
          eaDes = #20#3;
          |HAZ Print;
     |FINSI;
|FPRC;

|DEFBUCLE albm0027;
     #1#1002;
     ;
     #20#2, 01;
     #20#2, 99;
     be;
     NULL, albm0027;
|FIN;

|PROCESO albm0029;
     |BORRA 020#1a;
     #1#0 = #20#3;
     |SI CambDesc = "S"; #1#1 = #20#5; |FINSI;
     |GRABA 000#1n;
     |SI FSalida ! 0;
          enErr = FSalida;
          eaFic = "albm0029";
          eaOrg = #20#2;
          eaDes = #20#3;
          |HAZ Print;
     |FINSI;
|FPRC;

|DEFBUCLE albm0029;
     #1#1001;
     ;
     #20#2;
     #20#2;
     be;
     NULL, albm0029;
|FIN;

|PROCESO albm0030;
     |BORRA 020#1a;
     #1#0 = #20#3;
     |GRABA 000#1n;
     |SI FSalida ! 0;
          enErr = FSalida;
          eaFic = "albm0030";
          eaOrg = #20#2;
          eaDes = #20#3;
          |HAZ Print;
     |FINSI;
|FPRC;

|DEFBUCLE albm0030;
     #1#1002;
     ;
     #20#2, 01;
     #20#2, 99;
     be;
     NULL, albm0030;
|FIN;

|PROCESO albm0030_dos;
     |SI #1#2 = #20#2;
          #1#2 = #20#3;
          |SI CambDesc = "S"; #1#3 = #20#5; |FINSI;
          |GRABA 020#1a;
     |FINSI;
     |LIBERA #1;
|FPRC;

|DEFBUCLE albm0030_dos;
     #1#1002;
     ;
     "                    ", 01;
     "zzzzzzzzzzzzzzzzzzzz", 99;
     be;
     NULL, albm0030_dos;
|FIN;

|PROCESO albm0031;
     |SI #1#3 = #20#2;
          #1#3 = #20#3;
          |SI CambDesc = "S"; #1#4 = #20#5; |FINSI;
          |GRABA 020#1a;
     |FINSI;
     |LIBERA #1;
|FPRC;

|DEFBUCLE albm0031;
     #1#1001;
     ;
     000000;
     999999;
     be;
     NULL, albm0031;
|FIN;

|PROCESO albm0032;
     |SI #1#2 = #20#2;
          #1#2 = #20#3;
          |SI CambDesc = "S"; #1#3 = #20#5; |FINSI;
          |GRABA 020#1a;
     |FINSI;
     |LIBERA #1;
|FPRC;

|DEFBUCLE albm0032;
     #1#1002;
     ;
     000000, 01;
     999999, 99;
     be;
     NULL, albm0032;
|FIN;

|PROCESO albm0035;
     |BORRA 020#1a;
     #1#0 = #20#3;
     |SI CambDesc = "S"; #1#1 = #20#5; |FINSI;
     |GRABA 000#1n;
     |SI FSalida ! 0;
          enErr = FSalida;
          eaFic = "albm0035";
          eaOrg = #20#2;
          eaDes = #20#3;
          |HAZ Print;
     |FINSI;
|FPRC;

|DEFBUCLE albm0035;
     #1#1003;
     ;
     #20#2, 00001, "               ";
     #20#2, 99999, "zzzzzzzzzzzzzzz";
     be;
     NULL, albm0035;
|FIN;

|PROCESO albm0037;
     |SI #1#2 = #20#2;
          #1#2 = #20#3;
          |SI CambDesc = "S"; #1#3 = #20#5; |FINSI;
          |GRABA 020#1a;
     |FINSI;
     |LIBERA #1;
|FPRC;

|DEFBUCLE albm0037;
     #1#1002;
     ;
     "     ", 000000;
     "zzzzz", 999999;
     be;
     NULL, albm0037;
|FIN;

|PROCESO albm0038;
     |SI #1#2 = #20#2;
          #1#2 = #20#3;
          |SI CambDesc = "S"; #1#3 = #20#5; |FINSI;
          |GRABA 020#1a;
     |FINSI;
     |LIBERA #1;
|FPRC;

|DEFBUCLE albm0038;
     #1#1003;
     ;
     "     ", 000000, 01;
     "zzzzz", 999999, 99;
     be;
     NULL, albm0038;
|FIN;

|PROCESO albm0041;
     |BORRA 020#1a;
     #1#1 = #20#3;
     |SI CambDesc = "S"; #1#3 = #20#5; |FINSI;
     |GRABA 000#1n;
     |SI FSalida ! 0;
          enErr = FSalida;
          eaFic = "albm0041";
          eaOrg = #20#2;
          eaDes = #20#3;
          |HAZ Print;
     |FINSI;
|FPRC;

|DEFBUCLE albm0041;
     #1#1002;
     ;
     "      ", #20#2;
     "zzzzzz", #20#2;
     be;
     NULL, albm0041;
|FIN;


|PROCESO albm0042;
     |BORRA 020#1a;
     #1#1 = #20#3;
     |GRABA 000#1n;
     |SI FSalida ! 0;
          enErr = FSalida;
          eaFic = "albm0042";
          eaOrg = #20#2;
          eaDes = #20#3;
          |HAZ Print;
     |FINSI;
|FPRC;

|DEFBUCLE albm0042;
     #1#1003;
     ;
     "      ", #20#2,  1;
     "zzzzzz", #20#2, 99;
     be;
     NULL, albm0042;
|FIN;

|PROCESO albm0044;
     |BORRA 020#1a;
     #1#1 = #20#3;
     |GRABA 000#1n;
     |SI FSalida ! 0;
          enErr = FSalida;
          eaFic = "albm0044";
          eaOrg = #20#2;
          eaDes = #20#3;
          |HAZ Print;
     |FINSI;
|FPRC;

|DEFBUCLE albm0044;
     #1#1002;
     ;
     "      ", #20#2;
     "zzzzzz", #20#2;
     be;
     NULL, albm0044;
|FIN;

|PROCESO albm0054;
     |BORRA 020#1a;
     #1#1 = #20#3;
     |SI CambDesc = "S"; #1#3 = #20#5; |FINSI;
     |GRABA 000#1n;
     |SI FSalida ! 0;
          enErr = FSalida;
          eaFic = "albm0054";
          eaOrg = #20#2;
          eaDes = #20#3;
          |HAZ Print;
     |FINSI;
|FPRC;

|DEFBUCLE albm0054;
     #1#1002;
     ;
     "      ", #20#2;
     "zzzzzz", #20#2;
     be;
     NULL, albm0054;
|FIN;

|PROCESO albm0056;
     |SI #1#22 = #20#2;
          #1#22 = #20#3;
          |SI CambDesc = "S"; #1#23 = #20#5; |FINSI;
          |GRABA 020#1a;
     |FINSI;
     |SI #1#28 = #20#2;
          #1#28 = #20#3;
          |SI CambDesc = "S"; #1#29 = #20#5; |FINSI;
          |GRABA 020#1a;
     |FINSI;
     |LIBERA #1;
|FPRC;

|DEFBUCLE albm0056;
     #1#1001;
     ;
     000001;
     999999;
     be;
     NULL, albm0056;
|FIN;

|PROCESO albm0046;
     |SI #1#0 = #20#2;
          #1#0 = #20#3;
          |GRABA 020#1a;
     |FINSI;
     |SI #1#45 = #20#2;
          #1#45 = #20#3;
          |GRABA 020#1a;
     |FINSI;
     |LIBERA #1;
|FPRC;

|DEFBUCLE albm0046;
     #1#1002;
     ;
     00001, "               ";
     99999, "zzzzzzzzzzzzzzz";
     be;
     NULL, albm0046;
|FIN;

|PROCESO dsm00024_dos;
     |SI #1#45 = #20#2;
          #1#45 = #20#3;
          |GRABA 020#1a;
     |FINSI;
     |LIBERA #1;
|FPRC;

|DEFBUCLE dsm00024_dos;
     #1#1003;
     ;
     "                    ", 00001, "                              ";
     "zzzzzzzzzzzzzzzzzzzz", 99999, "zzzzzzzzzzzzzzzzzzzzzzzzzzzzzz";
     be;
     NULL, dsm00024_dos;
|FIN;

|PROCESO dsm00024;
     |BORRA 020#1a;
     #1#0 = #20#3;
     |GRABA 000#1n;
     |SI FSalida ! 0;
          enErr = FSalida;
          eaFic = "dsm00024";
          eaOrg = #20#2;
          eaDes = #20#3;
          |HAZ Print;
     |FINSI;
|FPRC;

|DEFBUCLE dsm00024;
     #1#1003;
     ;
     #20#2, 00001, "                              ";
     #20#2, 99999, "zzzzzzzzzzzzzzzzzzzzzzzzzzzzzz";
     be;
     NULL, dsm00024;
|FIN;

|PROCESO albm0047;
     |SI #1#10 = #20#2;
          #1#10 = #20#3;
          |SI CambDesc = "S"; #1#11 = #20#5; |FINSI;
          |GRABA 020#1a;
     |FINSI;
     |LIBERA #1;
|FPRC;

|DEFBUCLE albm0047;
     #1#1003;
     ;
     00001, "               ", 001;
     99999, "zzzzzzzzzzzzzzz", 999;
     be;
     NULL, albm0047;
|FIN;

|PROCESO CambiaAlbero;
     |DDEF aDef;

     aAlfa = aDef + "albm0001";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |BUCLE albm0001;
          |DESCARGA_DEF #referen@;
     |FINSI;

     aAlfa = aDef + "albm0002";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |BUCLE albm0002;
          |DESCARGA_DEF #referen@;
     |FINSI;

     aAlfa = aDef + "albm0003";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |BUCLE albm0002;              ||Tienes la misma clave y los campos articulo en la misma posicion
          |DESCARGA_DEF #referen@;
     |FINSI;

     aAlfa = aDef + "albm0004";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |BUCLE albm0004;
          |DESCARGA_DEF #referen@;
     |FINSI;

     aAlfa = aDef + "albm0026";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |BUCLE albm0026;
          |DESCARGA_DEF #referen@;
     |FINSI;

     aAlfa = aDef + "albm0027";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |BUCLE albm0027;
          |DESCARGA_DEF #referen@;
     |FINSI;

     aAlfa = aDef + "albm0029";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |BUCLE albm0029;
          |DESCARGA_DEF #referen@;
     |FINSI;

     aAlfa = aDef + "albm0030";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |BUCLE albm0030;
          |BUCLE albm0030_dos;
          |DESCARGA_DEF #referen@;
     |FINSI;

     aAlfa = aDef + "albm0031";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |BUCLE albm0031;
          |DESCARGA_DEF #referen@;
     |FINSI;

     aAlfa = aDef + "albm0032";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |BUCLE albm0032;
          |DESCARGA_DEF #referen@;
     |FINSI;

     aAlfa = aDef + "albm0035";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |BUCLE albm0035;
          |DESCARGA_DEF #referen@;
     |FINSI;

     aAlfa = aDef + "albm0037";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |BUCLE albm0037;
          |DESCARGA_DEF #referen@;
     |FINSI;

     aAlfa = aDef + "albm0038";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |BUCLE albm0038;
          |DESCARGA_DEF #referen@;
     |FINSI;

     aAlfa = aDef + "albm0041";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |BUCLE albm0041;
          |DESCARGA_DEF #referen@;
     |FINSI;

     aAlfa = aDef + "albm0042";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |BUCLE albm0042;
          |DESCARGA_DEF #referen@;
     |FINSI;

     aAlfa = aDef + "albm0044";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |BUCLE albm0044;
          |DESCARGA_DEF #referen@;
     |FINSI;

     aAlfa = aDef + "albm0054";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |BUCLE albm0054;
          |DESCARGA_DEF #referen@;
     |FINSI;

     aAlfa = aDef + "albm0056";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |BUCLE albm0056;
          |DESCARGA_DEF #referen@;
     |FINSI;

     ||De esta forma no actualiza bien el dsm00024
     ||Tengo que recalcularlo a parte
     aAlfa = aDef + "albm0046";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          enAlberoDentro = 1;
          |BUCLE albm0046;
          enAlberoDentro = 0;
          |DESCARGA_DEF #referen@;
     |FINSI;

     aAlfa = aDef + "dsm00024";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          enAlberoDentro = 1;
          |BUCLE dsm00024;
          |BUCLE dsm00024_dos;
          enAlberoDentro = 0;
          |DESCARGA_DEF #referen@;
     |FINSI;


     aAlfa = aDef + "albm0047";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |BUCLE albm0047;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;
