|FICHEROS;
     guerz075 #0;
     gopartia #1;
     gomatljn #2;
     agifa065 #65;
     agifa077 #77;
     agifa080 #80;
|FIN;

|VARIABLES;
     aEmp = "";
     aIP = "";
     aServidor = "";
     aFrom = "";
     aDirDestino = "";
     aTo = "";
     aSubject = "";
     aMensaje = "";
     aDjunto = "";
     aFicMail = "";
     aAlfa = "";
     nHay = 0;
     nHandle = 0;

     &enHisto = 0;
     &enAlba = 0;
     &enParti = 0;
     &enGoma = 0;
|FIN;

|PROCESO EnviaMail;
     |DFICE aEmp;
     aEmp = aEmp %- 205;
     aIP = "xdscorreo.dv.diagram.net";
     aServidor = "asmtp.diagram.es";
     aFrom = #0#1; |QBF aFrom;
     aTo = aFrom;
     |SI nHay = 0;
          aSubject = "Rastreo cabeceras albaranes compras: " + aEmp + " (correcto)";
          aMensaje = "Sin diferencias.";
          |XABRE "W", aFicMail, nHandle;
          |XGRABA nHandle, aMensaje;
          |XCIERRA nHandle;
     |SINO;
          aSubject = "Rastreo cabeceras albaranes compras: " + aEmp + " (con diferencias)";
          aMensaje = "Adjunta diferencias encontradas.";
     |FINSI;
     aDjunto = aFicMail;
     |DSCORREO_ENVIA aIP, aServidor, aFrom, aTo, aSubject, aMensaje, aDjunto;
     |SI PARAMETRO = "menu"; |Y FSalida ! 0;
          aAlfa = "0000ERROR al enviar correo" +&10+  aIP + "," + aServidor;
          |MENAV aAlfa;
     |FINSI;
|FPRC;

|PROCESO Historico;
     enHisto = 0;
|FPRC;

|DEFBUCLE Historico;
     #65#1;
     ;
     #80#2, #77#1, "AC", #80#0, #80#1, #80#27;
     #80#2, #77#1, "AC", #80#0, #80#1, #80#27;
     ;
     NULL, Historico;
|FIN;

|PROCESO AlbaComLin;
     #77#50 = #80#27;
     #77#0 = #80#0;
     |LEE 000#77=;
     enAlba = FSalida;
/*
     |SI enAlba = 0;
          #65#0 = #80#2;
          #65#1 = #77#1;
          #65#2 = "AC";
          #65#3 = #80#0;
          #65#4 = #80#1;
          #65#11 = #80#27;
          |LEE 000#65=;
          enHisto = FSalida;
     |SINO;
          enHisto = -1;
          |BUCLE Historico;
     |FINSI;

     #1#53 = #80#27;
     #1#54 = #80#0;
     #1#55 = #80#1;
     |LEE 000#1=;
     enParti = FSalida;

     #2#5 = #80#27;
     #2#6 = #80#0;
     |LEE 000#2=;
     enGoma = FSalida;
*/
||     |SI enHisto ! 0; |O enAlba ! 0; |O enParti ! 0; |O enGoma ! 0;

     |SI enAlba ! 0;
          |PRINT;
          nHay = 1;
     |FINSI;
|FPRC;

|DEFBUCLE AlbaComLin;
     #80#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, AlbaComLin;
|FIN;

|PROCESO Tipo3; |TIPO 3;
     aAlfa = #0#1; |QBF aAlfa;
     |SI aAlfa = "";
          |IMPRE 0;
     |SINO;
          |DFICE aFicMail;
          aFicMail = aFicMail + Usuario; |QBF aFicMail;
          aFicMail = aFicMail + ".txt";
          Impresora = aFicMail;
          |IMPRE -77;
     |FINSI;
     |SI FSalida = 0;
          |INFOR "guerz075";
          |SI FSalida = 0;
               |ABRE #77;
               |ABRE #65;
               |ABRE #1; |SELECT #5#1;
               |ABRE #2; |SELECT #4#2;
               |BUCLE AlbaComLin;
               |CIERRA #2;
               |CIERRA #1;
               |CIERRA #65;
               |CIERRA #77;
               |PIEINF;
               |FININF;
          |SINO;
               |SI PARAMETRO = "menu";
                    |MENAV "0000Error en informe 'guerz075'";
               |FINSI;
          |FINSI;
          |FINIMP;
     |FINSI;

     |SI aFicMail ! "";
          |HAZ EnviaMail;
     |FINSI;
|FPRC;

|PROGRAMA;
     |ABRE #0;
     |LEE 101#0p;
     |SI PARAMETRO = "menu";
           |SI FSalida ! 0; |GRABA 020#0b; |FINSI;
           |CLS;
           |PINPA #0#0;
           |PINDA #0#0;
           |ENDATOS #1#0;
           |SI FSalida = 0; |GRABA 020#0a; |FINSI;
     |SINO;
          aAlfa = #0#1; |QBF aAlfa;
          |SI aAlfa ! "";
               |HAZ Tipo3;
          |FINSI;
     |FINSI;
     |CIERRA #0;
|FPRO;
