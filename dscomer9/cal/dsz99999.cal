         Llamadas desde calculos: (definidos en el .plb)

     *** Ojo con 'aProg' hay que poner el def que llama en los calculos
         CompruParam, DobleUni, DobleArti, LinEscan ***

     DobleArti = Saca del articulo (c.barra) las unidades y/o la partida
     DobleUni  = Introduccion de unidades
     VerDobleUni = Consulta
     DobleParti = Introduccion de partida

     DobleUniME_MS  = Introduccion de unidades (dsm00054)
     VerDobleUniME_MS = Consulta

     AcumulaSA = Historico
     AcumulaEV = Stock + Pcm + Historico
     AcumulaES_SS = Stock + Historico
     AcumulaME_MS = Stock + Historico
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴

|FICHEROS;
     dsz99999 #0,MANTE;

     agifa077 #3;   ||Alba Compra
     agifa080 #4;   ||Alba Compra Lin
     agifa081 #5;   ||Ped Compras
     agifa067 #6;   ||Ped Compras Lin

     agist002 #7;   ||Stock Ini
     dsm00057 #8;   ||Entrada Valorada
     dsm00044 #9;   ||Regularizacion
     dsm00055 #10;  ||Movimiento Alma
     agist007 #11;  ||Stock Ini (el Tmp)
     agi00028 #16;  ||Prepedidos Compra

     referen@ #100;
     dsl00001 #101;
     dsm00241 #241; || Conversion
     dsm00239 #239; || Des. Unidades
     dsm00138 #138;
     dsm00139 #139;
     dsm00024 #24;

     gestrz05@; ||   Pantalla para reg. exi. Modulo Gestral
|FIN;

|VARIABLES;
     &enSwGesAltaPar = 0;
     nSwPanGestral = 0;
     nSwGestral = 0;
     aRaya = "";
     aArtiSA = "";
     nAlmaSA = 0;
     aPartiSA = "";
     nCamp0 = 0;

     nSwAuto = 0;
     nTecla = 0;
     &enNoModCab = 0;

     nAlbMenuParti = 0;
 {-1}aMenuParti = "";
     aMenuParti1 = "2422";
     aMenuParti2 = "1";
     aMenuParti3 = "Contador Partida:";
     aMenuParti4 = "AM";
     aMenuParti5 = " Automatico ";
     aMenuParti6 = " Manual ";

     nSwAlbero = 0;
     nError = 0;

     &enUni1 = 0;
     &enUni2 = 0;
     &enAlbForma = 0;

     aSwMeMs = "";
     nSwPcm = 0;
     xUni1 = 0;
     xUni2 = 0;
     &eaCompVent = "C";

     &enSinPanta = 0;
     aEsSalida = "N";
     fUltFecha = @;
     nSwModi   = 0;
     nPosi     = 0;
     nUnidades = 0;
     nUnidades2= 0;
     nMerma    = 0;
     nMargen   = 0;
     nSwVer    = 0;
     nSalida   = 0;
     aProg     = "";
     aOpera    = "";
     aAlfa     = "";
     aArti     = "";
     aParti    = "";
     nAlma     = 0;
     nPos      = 0;
     nUni2     = 0;
     nUni      = 0;
     nNume     = 0;
     nPm       = 0;
     nPcm      = 0;
     nPvp1     = 0; nPvp2 = 0; nPvp3 = 0; nPvp4 = 0; nPvp5 = 0; nPvp6 = 0;
     nNume1    = 0; nNume2 = 0; nNume3 = 0; nNume4 = 0; nNume5 = 0; nNume6 = 0;
     nCampo    = 0;
     nPrecio   = 0;
     nNeto     = 0;
     nForma    = 0;
     nSto      = 0;
     nImpo     = 0;
     aSer      = "";
     aEsInte   = "";
     nAlmaInte = 0;
     nUni0     = 0;
     nNum      = 0;
     nLin      = 0;
     aDef      = "";
     aBase     = "";
     aPath     = "";
     nUnidPend  = 0;
     nUnidPend2 = 0;
     nUnidadesPend = 0;
     &nDeci_Base = 0;
     &nDeci_PreBase = 0;
     aLaPartida = "";
     aMensaje = "";

     &enAlmPar = 0;
     &eaNumPar = "";
     &eaProducido = "";
     &eaDesPro = "";
     &eaDocExt = "";
     &eaSerExt = "";
     &enNumExt = 0;
     &eaIncPar = "";
     &eaCerrarPar = "";
     nPreTon = 0;
|FIN;

|INCLUYE i_varart;
|INCLUYE i_dobsto;

컴컴컴컴컴 PARCHE QUE RELLENA LA DESCRIPCION DE COMPRAS컴컴컴
컴컴컴컴컴 DEL FICHERO DE ARTICULOS  13/6/2000 컴컴컴컴컴컴컴
|PROCESO DesCompra;
     |SI aProg = "agifa077"; aArti = #4#2; |FINSI;
     |SI aProg = "agifa081"; aArti = #6#2; |FINSI;
     |SI aProg = "agi00027"; aArti = #16#2; |FINSI;
     |ABRE #19;
     #19#0 = aArti;
     |LEE 101#19=;
     |SI FSalida = 0;
          aAlfa = #19#195; |QBF aAlfa;
          |SI aAlfa = ""; #19#195 = #19#1; |FINSI;
          |GRABA 020#19a;
     |FINSI;
     |CIERRA #19;
|FPRC;

컴컴컴컴컴컴컴컴컴컴컴컴컴횵NTRODUCCION DE UNIDADES컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO DobleUniME_MS;    || 'dsm00054'
     |HAZ CompruParam;
     |SI eaSw2Stock = "N"; |ACABA; |FINSI;

     |ABRE #19;
     #19#0 = #10#0;  || Articulo
     |LEE 101#19=;
     |HAZ CargaUniArt;
     |CIERRA #19;

     eaSw2Stock = "N";
     |SI #19#179 = "N"; |Y #19#180 = "N"; |ACABA; |FINSI;
     eaSw2Stock = "S";

     ||SI #19#180 = "N";
          |MODO_RELACION #0, 1, "dsm00024", "N", "N";
     ||SINO;
     ||     |MODO_RELACION #0, 1, "dsm00024", "S", "S";
     ||FINSI;
     |PUSHV 0501 2380;
     |C_V #0#6, 1, "N"; |C_V #0#7, 1, "N";
     #0#0 = #10#15;
     #0#1 = #10#4;
     #0#12 = #10#24;
     #0#13 = #10#25;
     #0#14 = #10#26;
     #0#2 = #10#17;
     #0#18 = #10#16;
     #0#19 = #10#5;

     #0#9 = #10#0;  || No quitarlo
     #0#10 = #10#1; || esta debido a la relacion

     |BLANCO 1323 2159;
     |PINPA #0#0;
     |HAZ VisualCampos;
     |PINDA #0#0;
     |SI  #19#179 = "N";             || No Doble Stock (solo partidas)
          |PINTA 1726, "Unidades..:";
     |SINO;
          |PINTA 1626, #238#2;
          |PINTA 1726, #238#3;
     |FINSI;
     |PINTA 1826, "                           ";

     ||컴컴 Unidades1;
     |SI #0#4 = "SE";|O #0#4 = "AN"; |O #0#4 = "MT";
          |C_M #0#0, 1, "N";
     |SINO;
          |C_M #0#0, 1, "S";
     |FINSI;
     ||컴컴 Unidades2;
     |SI #0#5 ! "PR";
          |C_M #0#1, 1, "N";
     |SINO;
          |C_M #0#1, 1, "S";
     |FINSI;

     |SI nSwVer = 1;
          |PINDA #0#0;
          |PAUSA;
     |SINO;
          |HAZ EntraDatos;
     |FINSI;

     |C_V #0#6, 1, "S"; |C_V #0#7, 1, "S";
     |POPV;
     |SI nSalida = 0;
          #10#15 = #0#0;
          #10#4 = #0#1;
          #10#18 = #0#3;
          #10#24 = #0#12;
          #10#25 = #0#13;
          #10#26 = #0#14;
          #10#16 = #0#18;
          #10#17 = #0#2;
     |FINSI;
|FPRC;

|PROCESO DobleUni; |TIPO 7;
     nSwAuto = 0;
     nModo = (FEntrada / 100) ! 0;
     |HAZ CompruParam;
     |SI eaSw2Stock = "N"; |ACABA; |FINSI;
     |SI enSinPanta = 1;   |ACABA; |FINSI;  ||-> Adj. Ped. Compras

     |SI aProg = "dsm00138";
          #0#1 = #139#5;
          #0#0 = #139#36;
          |SI #142#118 = "S";
               #0#2 = #139#37;
          |FINSI;
          #0#3 = #139#38;
          #0#9 = #139#2;  || Arti
          #0#10 = #139#3; || Alma
          #0#12 = #139#39;
          #0#13 = #139#40;
          #0#14 = #139#41;
          #0#17 = #138#1;
     |FINSI;
     |SI aProg = "agifa077"; |O aProg = "agifa212"; |O aProg = "dsm00140";
          #0#1 = #4#5;
          #0#0 = #4#36;
          |SI #142#118 = "S";
               #0#2 = #4#37;
          |FINSI;
          #0#3 = #4#38;
          #0#9 = #4#2;  || Arti
          #0#10 = #4#3; || Alma
          #0#12 = #4#39;
          #0#13 = #4#40;
          #0#14 = #4#41;
          #0#17 = #3#1;
     |FINSI;
     |SI aProg = "agifa081";
          #0#1 = #6#5;
          #0#0 = #6#41;
          |SI #142#118 = "S";
               #0#2 = #6#42;
          |FINSI;
          #0#3 = #6#43;
          #0#9 = #6#2;  || Arti
          #0#10 = #6#3; || Alma
          #0#12 = #6#47;
          #0#13 = #6#48;
          #0#14 = #6#49;
          #0#17 = #5#1;
     |FINSI;
     |SI aProg = "agi00027";
          #0#1 = #16#5; || Uni1
          #0#0 = #16#14;|| Uni2
          |SI #142#118 = "S";
               #0#2 = #16#15;
          |FINSI;
          #0#3 = #16#16;
          #0#9 = #16#2; || Arti
          #0#10 = 1;    || Alma
          #0#12 = #16#17;
          #0#13 = #16#18;
          #0#14 = #16#19;
          #0#17 = #16#9;
     |FINSI;
     |SI aProg = "agist001";
          #0#1 = #7#4;
          #0#0 = #7#7;
          |SI #142#118 = "S";
               #0#2 = #7#8;
          |FINSI;
          #0#3 = #7#9;
          #0#9 = #7#2;  || Arti
          #0#10 = #7#3; || Alma
          #0#12 = #7#10;
          #0#13 = #7#11;
          #0#14 = #7#12;
          ||#0#17 = #7#?
     |FINSI;
     |SI aProg = "dsm00056";
          #0#1 = #8#4;
          #0#0 = #8#21;
          |SI #142#118 = "S";
                #0#2 = #8#22;
          |FINSI;
          #0#3 = #8#23;
          #0#9 = #8#0;  || Arti
          #0#10 = #8#1; || Alma
          #0#12 = #8#24;
          #0#13 = #8#25;
          #0#14 = #8#26;
          #0#17 = #8#12;
     |FINSI;
     |SI aProg = "dsm00043";
          #0#1 = #9#4;
          #0#0 = #9#12;
          |SI #142#118 = "S";
               #0#2 = #9#13;
          |FINSI;
          #0#3 = #9#14;
          #0#9 = #9#0;
          #0#10 = #9#1;
          #0#12 = #9#15;
          #0#13 = #9#16;
          #0#14 = #9#17;
          #0#17 = #9#5;
     |FINSI;

     |ABRE #19;
     #19#0 = #0#9;  || Articulo
     |LEE 101#19=;
     |HAZ CargaUniArt;
     |CIERRA #19;


     eaSw2Stock = "N";
     |SI #19#179 = "N"; |Y #19#180 = "N"; |ACABA; |FINSI;
     eaSw2Stock = "S";

     |SI #19#180 = "S"; ||Control Partidas
          |HAZ EsAlbero;
          |SI FSalida ! 0;
               |MODO_RELACION #0, 1, "dsm00024", "S", "S";
          |SINO;
               |MODO_RELACION #0, 1, "dsm00024", "N", "N";
          |FINSI;
     |SINO;
          |MODO_RELACION #0, 1, "dsm00024", "N", "N";
     |FINSI;

     |SI nSwPanGestral = 1;
          |HAZ GestralPanRegu;
     |SINO;
          |SI nSwVer = 1;
               |PUSHV 0501 2380;
               |BLANCO 1323 2159;
               |PINPA #0#0;
               |HAZ VisualCampos;
               |PINDA #0#0;
               |SI #19#179 = "N";
                    |PINTA 1726, "Unidades..:";
               |SINO;
                    |PINTA 1626, #238#2;
                    |PINTA 1726, #238#3;
               |FINSI;

               |PAUSA;        || Modificado martes, 29 de noviembre de 2011
     /*
               |C_V #0#2, 0, aAlfa;
               |SI aAlfa = "S";
                    |HAZ EsAlbero;
                    |SI FSalida = 0;
                         |C_M #0#2, 1, "N";
                         |PAUSA;
                    |SINO;
                         |C_M #0#2, 1, "S";
                         |ENCAMPO #2#0;
                    |FINSI;
               |SINO;
                    |PAUSA;
               |FINSI;
     */
               |POPV;
               |ACABA;
          |SINO;
               |HAZ Entrada;
          |FINSI;
     |FINSI;

     |SI nSwAuto = 1;
          nSwAuto = 0;
          |SI nSalida ! 0;
               |HAZ EsAlbero;
               |SI FSalida = 0;
                    |HAZ AnulaPartida;
               |FINSI;
          |FINSI;
     |FINSI;

     |SI nSalida ! 0; |ACABA; |FINSI;

     |SI aProg = "dsm00138";
          #139#5 = #0#1;
          #139#36 = #0#0;
          #139#37 = #0#2;
          #139#38 = #0#3;
          #139#39 = #0#12;
          #139#40 = #0#13;
          #139#41 = #0#14;
     |FINSI;
     |SI aProg = "agifa077"; |O aProg = "agifa212"; |O aProg = "dsm00140";
          #4#5 = #0#1;
          #4#36 = #0#0;
          #4#37 = #0#2;
          #4#38 = #0#3;
          #4#39 = #0#12;
          #4#40 = #0#13;
          #4#41 = #0#14;
     |FINSI;
     |SI aProg = "agifa081";
          #6#5 = #0#1;
          #6#41 = #0#0;
          #6#42 = #0#2;
          #6#43 = #0#3;
          #6#47 = #0#12;
          #6#48 = #0#13;
          #6#49 = #0#14;
     |FINSI;
     |SI aProg = "agist001";
          #7#4 = #0#1;
          #7#7 = #0#0;
          #7#8 = #0#2;
          #7#9 = #0#3;
          #7#10 = #0#12;
          #7#11 = #0#13;
          #7#12 = #0#14;
     |FINSI;
     |SI aProg = "dsm00056";
          #8#4 = #0#1;
          #8#21 = #0#0;
          #8#22 = #0#2;
          #8#23 = #0#3;
          #8#24 = #0#12;
          #8#25 = #0#13;
          #8#26 = #0#14;
     |FINSI;
     |SI aProg = "dsm00043";
          #9#4 = #0#1;
          #9#12 = #0#0;
          #9#13 = #0#2;
          #9#14 = #0#3;
          #9#15 = #0#12;
          #9#16 = #0#13;
          #9#17 = #0#14;
     |FINSI;
     |SI aProg = "agi00027";
          #16#5 = #0#1;
          #16#14 = #0#0;
          #16#15 = #0#2
          #16#16 = #0#3;
          #16#17 = #0#12;;
          #16#18 = #0#13;
          #16#19 = #0#14;
     |FINSI;
|FPRC;

|PROCESO VerDobleUni;
     nSwVer = 1;
     |HAZ DobleUni;
     nSwVer = 0;
|FPRC;

|PROCESO VerDobleUniME_MS;
     nSwVer = 1;
     |HAZ DobleUniME_MS;
     nSwVer = 0;
|FPRC;

|PROCESO DobleParti;
     nSwParti = 1;
     |HAZ DobleUni;
     nSwParti = 0;
|FPRC;

|PROCESO AnulaPartida;
     |ABRE #24;
     |DDEFECTO #24;
     #24#0 = #0#9;
     #24#1 = #0#10;
     #24#2 = #0#2;
     |LEE 101#24=;
     |SI FSalida = 0;
          |BORRA 020#24a;
          |LIBERA #24;

          |DBASE aAlfa; |QBF aAlfa;
          aAlfa = aAlfa + "def/albm0045.mas";
          |CARGA_DEF aAlfa, referen@;
          |SI FSalida = 0;
               |ABRE #referen@;
               #referen@#0 = #0#10;
               #referen@#1 = "entrada";
               |LEE 101#referen@.=;
               |SI FSalida = 0; |Y #referen@#2 = #0#2;
                    #referen@#2 = #referen@#2 - 1;
                    |GRABA 020#referen@.a;
                    |LIBERA #referen@;
               |FINSI;
               |CIERRA #referen@;
               |DESCARGA_DEF #referen@;
          |FINSI;
     |FINSI;
     |CIERRA #24;
|FPRC;


컴컴컴컴컴컴컴컴컴컴컴컴VALORES DENTRO DEL CODIGO BARRAS컴컴컴컴컴컴컴컴컴컴컴
|PROCESO DobleArti;

     |DDEFECTO #0;
     |HAZ CompruParam;

     |HAZ DesCompra; || PARCHE PARA GRABAR LA DESCRIPCION DE COMPRAS

     |SI eaSw2Stock = "N"; |ACABA; |FINSI;
     eaSw2Stock = "N";
     |SI #0#5 ! "CB"; |Y #0#6 ! "CB"; |ACABA; |FINSI;
     eaSw2Stock = "S";

     |SI aProg = "agifa077"; aArti = #4#2; |FINSI;
     |SI aProg = "agifa081"; aArti = #6#2; |FINSI;
     ||컴컴컴컴컴

     |SI #0#5 = "CB";         ||Uni2
          aAlfa = ("0000" + #2#6) % -104;
          nPos = (A\((aAlfa % 102) + (aAlfa % -102)));
          aAlfa = aArti % nPos;
          #0#11 = aAlfa;           || Peso de Compra
     |FINSI;
     |SI #0#6 = "CB";         ||Partida
          aAlfa = ("0000" + #2#7) % -104;
          nPos = (A\((aAlfa % 102) + (aAlfa % -102)));
          aParti = aArti % nPos; |QBF aParti;
     |FINSI;
     nPos = #142#62 + 100;
     aArti = aArti % nPos;     ||Articulo

     |SI aProg = "agifa077";
          #4#2 = aArti;
          |SI aParti ! ""; #4#37 = aParti; |FINSI;
     |FINSI;
     |SI aProg = "agifa081";
          #6#2 = aArti;
          |SI aParti ! ""; #6#42 = aParti; |FINSI;
     |FINSI;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
/*
|PROCESO PVP;
     |SI #4#5 [ 0; |ACABA; |FINSI;
     |SI #19#108 =  "N"; |ACABA;  |FINSI;

     |HAZ CalPre077;
|FPRC;
*/
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO BorraVertical;
     |PDEFECTO #904, 4, 14;
     #904#24 = 0;
     |GRABA 020#904a;
     |LIBERA #904;
|FPRC;

|DEFBUCLE BorraVertical;
     #904#1;
     ;
     aArti, 00000, "      ";
     aArti, 99999, "zzzzzz";
     be;
     NULL, BorraVertical;
|FIN;

|PROCESO VerticalSA;
     |DDEFECTO #904;
     #904#0 = #906#0;
     #904#1 = #906#1;
     #904#2 = #906#7;
     |LEE 101#904=;
     |SI FSalida ! 0; |GRABA 020#904b; |FINSI;

     #904#13 = #904#13 + #906#9;
     #904#12 = #904#12 + #906#9;

     nNume = #904#12 - #904#6;
     |SI nNume > 0;
         #904#24 = nNume * art_pcm;
     |SINO;
         #904#24 = 0;
     |FINSI;

     |GRABA 020#904a;
     |LIBERA #904;
|FPRC;

|DEFBUCLE VerticalSA;
     #906#1;
     ;
     #65#0, #65#5, #65#1, #65#2, #65#11, #65#3, #65#4, "      ";
     #65#0, #65#5, #65#1, #65#2, #65#11, #65#3, #65#4, "zzzzzz";
     ;
     NULL, VerticalSA;
|FIN;

|PROCESO StockSA;
     |SI aArtiSA ! aArti;
          |PARA nCampo = 32; |SI nCampo [ 96; |HACIENDO nCampo = nCampo + 5;
               #19nCampo = 0;
               nCamp0 = nCampo + 2;
               #19nCamp0 = 0;
          |SIGUE;
          art_pser = 0;
          art_pser2= 0;
          art_prec = 0;
          art_prec2= 0;
          art_nece = 0;
          art_rese = 0;
          art_depo = 0;
          art_depo2= 0;
          art_fabr = 0;
          art_vsto = 0;
          art_tota = 0;
          art_tota2= 0;
          art_disp = 0;
          art_disp2 = 0;
          art_mini = 0;
          art_maxi = 0;
          || Componentes Vertical
          |BUCLE BorraVertical;
     |FINSI;
     |SI nAlmaSA ! nAlma; |O aArtiSA ! aArti;
          |PDEFECTO #17, 11, 39;
          alm_nece = 0;
          alm_pser = 0;
          alm_pser2= 0;
          alm_prec = 0;
          alm_prec2= 0;
          alm_rese = 0;
          alm_depo = 0;
          alm_depo2= 0;
          alm_fabr = 0;
          alm_vsto = 0;
          alm_tota = 0;
          alm_tota2= 0;
          alm_disp = 0;
          alm_disp2 = 0;
     |FINSI;
     |SI aPartiSA ! aParti; |O nAlmaSA ! nAlma; |O aArtiSA ! aArti; || Partida
          par_ereal = 0;
          par_ereal2= 0;
          par_sreal = 0;
          par_sreal2= 0;
          par_pser  = 0;
          par_pser2 = 0;
          par_depo  = 0;
          par_depo2 = 0;
          par_prec = 0;
          par_prec2 = 0;
          par_tota = 0;
          par_tota2 = 0;
          par_disp = 0;
          par_disp2 = 0;
          #24#33 = 0;
     |FINSI;
     aArtiSA = aArti;
     nAlmaSA = nAlma;
     aPartiSA =  aParti;

     || Actualizacion
     art_disp = art_disp + nUnidades;
     art_disp2 = art_disp2 + nUnidades2;

     art_tota = art_tota + nUnidades;
     art_tota2 = art_tota2 + nUnidades2;

     alm_disp = alm_disp + nUnidades;
     alm_disp2 = alm_disp2 + nUnidades2;

     alm_tota = alm_tota + nUnidades;
     alm_tota2 = alm_tota2 + nUnidades2;

     par_disp = par_disp + nUnidades;
     par_disp2 = par_disp2 + nUnidades2;
     par_tota = par_tota + nUnidades;
     par_tota2 = par_tota2 + nUnidades2;

     par_ereal = par_ereal + nUnidades;
     par_ereal2 = par_ereal2 + nUnidades2;

     ||Maximo y Minimo
     |GRABA 020#17a;
     |SALVA_FICHA #17;
     #17#1 = 1;
     |LEE 000#17];
     |PARA; |SI FSalida = 0; |Y #17#0 = aArti; |HACIENDO;
          art_mini = art_mini + alm_mini;
          art_maxi = art_maxi + alm_maxi;
          |LEE 000#17s;
     |SIGUE;
     |REPON_FICHA #17;

     |HAZ ValoraStock;
     |ABRE #904;
     |BUCLE VerticalSA;
     |CIERRA #904;
|FPRC;

|PROCESO AcumulaSA;
     |ABRE #65;
     |DDEFECTO #65;
     #65#0  = eaArticulo;
     #65#1  = efFecha;
     #65#2  = "SA";
     #65#3  = enCodigo;
     #65#4  = enLinea;
     #65#11 = eaSerie;
     |LEE 101#65=;
     |SI FSalida = 0;
          |BORRA 020#65a;     || modificado para inforpor
     |FINSI;

     #65#5  = #11#3;  || Almacen
     #65#6  = #11#4;  || Stock
     #65#7  = #11#4;  || Stock Resultante
     #65#8  = #11#5;  || Precio Medio Coste
     #65#9 = #65#8;
     #65#17 = #11#7;  || Uni2
     #65#18 = #11#8;  || Partida
     #65#19 = #11#9;  || Merma
     |GRABA 020#65n;   ||  modificado para inforpor
     |CIERRA #65;
     aArti = #65#0;
     nAlma = #65#5;
     aParti = #65#18;
     |HAZ LeArticulo;
     nUnidades = #65#6;
     nUnidades2 = #65#17;
     |HAZ StockSA;
     |HAZ GrabaArti;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO StockEV;
     |SI #8#4 = 0;
         nImpo = #8#11;
     |SINO;
          |SI #19#196 = 1;
               nImpo = #8#4 * #8#11;
          |SINO;
               nImpo = #8#21 * #8#11;
          |FINSI;
     |FINSI;

     nPreTon = 1;
     |HAZ EsVigor;
     |SI FSalida = 0;
          aAlfa = #agifa019#110; |QBF aAlfa;   || Alfanumerico1
          aAlfa = aAlfa > "";
          |SI aAlfa = "S"; nPreTon = 1000; |FINSI;
     |FINSI;

     |HAZ ValorStock;

     |SI #19#196 = 1;
           nUni0 = #8#4;
           nSto = art_tota - art_pval;
     |SINO;
           nSto = art_tota2;
           nUni0 = #8#21;
     |FINSI;
     nUni0 = nUni0 * enForma;

     nSwPcm = 0;
     |SI nSto > 0; |Y nImpo > 0;
          nSwPcm = 1;
     |SINO;
          |SI #142#175 = "S"; nSwPcm = 1;|FINSI;
     |FINSI;

     |SI nSwPcm = 1;
          |SI nUni0 = 0;
               nPcm = #8#11 / nPreTon;
          |SINO;
               nPcm = nUni0 * #8#11 / nPreTon;
          |FINSI;
          nPcm = nPcm + art_vsto;
          nPcm = nPcm / (nSto + nUni0);
     |SINO;
         nPcm = #8#11 / nPreTon;
     |FINSI;

     |SI nPcm ! 0;  |Y #142#30 ! "X";
         art_pcm = nPcm;
     |FINSI;

     aAlfa = #8#12; aAlfa = aAlfa % A402;
     nNume = aAlfa;
     nNume = (nNume - 1) * 5 + 32;

     #19nNume = #19nNume + nUni0;
     nNume = nNume + 1;
     #19nNume = #19nNume + (nImpo * enForma);
     #19#92 = #19#92 + nUni0;
     #19#93 = #19#93 + (nImpo * enForma);
     nNume = aAlfa;
     nNume = (nNume - 1) * 2 + 12;
     #17nNume = #17nNume + nUni0;
     #17#36 = #17#36 + nUni0;
||
     art_disp = art_disp + (#8#4 * enForma);
     art_disp2 = art_disp2 + (#8#21 * enForma);
     art_tota = art_tota + (#8#4 * enForma);
     art_tota2 = art_tota2 + (#8#21 * enForma);

     alm_tota = alm_tota + (#8#4 * enForma);
     alm_tota2 = alm_tota2 + (#8#21 * enForma);
     alm_disp = alm_disp + (#8#4 * enForma);
     alm_disp2 = alm_disp2 + (#8#21 * enForma);

     par_tota = par_tota + (#8#4 * enForma);
     par_tota2 = par_tota2 + (#8#21 * enForma);
     par_disp = par_disp + (#8#4 * enForma);
     par_disp2 = par_disp2 + (#8#21 * enForma);

     par_merma = par_merma + (#8#23 * enForma);
     |SI #24#4 = "01.01.0000";
          #24#3 = #8#5;
          #24#4 = #8#12;
     |FINSI;


     |HAZ EsAlbero;
     |SI FSalida ! 0;
          par_ereal = par_ereal + (#8#4 * enForma);
          par_ereal2 = par_ereal2 + (#8#21 * enForma);

     |SINO; || Calculo especial para Albero

          |SI #8#4 < 0; |O #8#21 < 0;
               par_sreal = par_sreal + ((#8#4 * enForma) * -1);
               par_sreal2 = par_sreal2 + ((#8#21 * enForma) * -1);
          |SINO;
               par_ereal = par_ereal + (#8#4 * enForma);
               par_ereal2 = par_ereal2 + (#8#21 * enForma);
          |FINSI;

          |SI #19#180 = "S";
               |SI enNoModCab = 0;
                    |GRABA 020#24a;
               |FINSI;
               |LIBERA #24;
               enUni1 = #8#4;
               enUni2 = #8#21;
               enAlbForma = enForma;
               |HAZ AlberoActPartidasEV;
          |FINSI;
     |FINSI;

     |HAZ ValorStock;
|FPRC;

|PROCESO HistoricoEV;
     |ABRE #65;
     |DDEFECTO #65;
     #65#0 = #8#0;
     #65#1 = #8#12;
     #65#2 = "EV";
     #65#3 = #8#27;
     #65#4 = #8#14;
     #65#5 = #8#1;
     #65#6 = #8#4;
     #65#7 = #19#6;
     #65#8 = #19#9;
     #65#9 = #8#6;
     #65#10 = #8#5;
     #65#11 = #8#28;
     #65#12 = #8#7;
     #65#13 = #8#20;
     #65#14 = (((#65#9 < #65#12) < #65#13) < #8#8) < #8#9;
     |SI #142#115 = "S";
          #65#14 = #65#14 < #8#10;
     |FINSI;
     #65#17 = #8#21;
     #65#18 = #8#22;
     #65#19 = #8#23;
     #65#20 = #8#29;
     |SI enForma = 1;
          |GRABA 020#65n;
     |SINO;
          |BORRA 020#65c;
     |FINSI;
     |CIERRA #65;
|FPRC;

|PROCESO AcumulaEV;
     aArti = #8#0;
     nAlma = #8#1;
     aParti = #8#22;
     |HAZ LeArticulo;
     |HAZ StockEV;
     |HAZ GrabaArti;
     |HAZ HistoricoEV;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO StockES_SS;
     nUni = nUni * enForma;
     nUni2 = nUni2 * enForma;
     |SI #19#196 = 1; nUni0 = nUni; |SINO; nUni0 = nUni2; |FINSI;

     art_tota = art_tota + nUni;
     art_tota2 = art_tota2 + nUni2;
     art_disp = art_disp + nUni;
     art_disp2 = art_disp2 + nUni2;

     alm_tota = alm_tota + nUni;
     alm_tota2 = alm_tota2 + nUni2;
     alm_disp = alm_disp + nUni;
     alm_disp2 = alm_disp2 + nUni2;

     par_tota = par_tota + nUni;
     par_tota2 = par_tota2 + nUni2;
     par_disp = par_disp + nUni;
     par_disp2 = par_disp2 + nUni2;

     |SI #9#7 = "E";
          par_ereal = par_ereal + nUni;
          par_ereal2 = par_ereal2 + nUni2;
          par_merma = par_merma + (#9#14 * enForma);
          |SI #24#4 = "01.01.0000";
               #24#3 = #19#27;
               #24#4 = #9#5;
          |FINSI;
     |SINO;
          par_sreal = par_sreal - nUni;
          par_sreal2 = par_sreal2 - nUni2;
          par_merma = par_merma - (#9#14 * enForma);
     |FINSI;
     aAlfa = #9#5 % 402;
     nNume = aAlfa;
     nNume = (nNume - 1) * 2;
     |SI #9#7 = "E";
          |SI #19#196 = 1; nUni0 = nUni; |SINO; nUni0 = nUni2; |FINSI;
          nNume = nNume + 12;
          #17#36 = #17#36 + nUni0;
     |SINO;
          |SI #19#194 = 1; nUni0 = -nUni; |SINO; nUni0 = -nUni2; |FINSI;
          nNume = nNume + 11;
          #17#35 = #17#35 + nUni0;
     |FINSI;
     #17nNume = #17nNume + nUni0;

     |HAZ EsAlbero;
     |SI FSalida = 0;
          |SI #19#180 = "S";
               |LIBERA #24;
               |GRABA 020#24a;
          |FINSI;
          |SI #9#7 = "S";
          |FINSI;
          enUni1 = nUni;
          enUni2 = nUni2;
/*
          |SI #9#7 = "S";
               enUni1 = enUni1 * -1;
               enUni2 = enUni2 * -1;
          |FINSI;
*/
          enAlbForma = enForma;
          |HAZ AlberoActPartidasES;
     |FINSI;

     |HAZ ValorStock;
|FPRC;

|PROCESO HistoricoES_SS;
     |ABRE #65;
     |DDEFECTO #65;
     #65#0 = aArti;
     #65#1 = #9#5;
     |SI #9#7 = "E";
          #65#2 = "ES";
     |SINO;
          #65#2 = "SS";
     |FINSI;
     #65#3 = #9#18;
     #65#4 = #9#8;
     #65#11 = #9#21;
     |SI enForma = 1;
          |LEE 101#65=;
          |SI FSalida ! 0; |GRABA 020#65b; |FINSI;
          #65#5 = nAlma;
          #65#6 = nUni;
          #65#7 = #19#6;
          #65#8 = #19#9;
          #65#9 = #9#26;
          #65#12 = 0;
          #65#13 = 0;
          #65#14 = #9#26;
          #65#17 = nUni2;
          #65#18 = aParti;
          #65#19 = #9#14;
          |GRABA 020#65a;
     |SINO;
          |BORRA 020#65c;
     |FINSI;
     |CIERRA #65;
|FPRC;

|PROCESO AcumulaES_SS;
     |SI #9#7 = "E"; nUni = #9#4;   |SINO; nUni  = -#9#4;  |FINSI;
     |SI #9#7 = "E"; nUni2 = #9#12; |SINO; nUni2 = -#9#12; |FINSI;
     aArti = #9#0;
     nAlma = #9#1;
     aParti = #9#13;
     |HAZ LeArticulo;
     |HAZ StockES_SS;
     |HAZ GrabaArti;
     |HAZ HistoricoES_SS;
     nUnidades = #9#4;
     |SI aTipoEsca = "K"; |HAZ DesLinKit; |FINSI;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO HistoricoMS;
     |ABRE #65;
     |DDEFECTO #65;
     #65#0 = aArti;
     #65#1 = #10#8;
     #65#2 = "MS";
     #65#3 = #10#27;
     #65#4 = #10#11;
     #65#5 = #10#1;
     #65#6 = -nUni;
     #65#7 = #19#6;
     #65#8 = #19#9;
     #65#9 = #10#29;
     #65#11 = #10#28;
     #65#12 = 0;
     #65#13 = 0;
     #65#14 = #10#29;
     #65#17 = -nUni2;
     #65#18 = #10#16;
     #65#19 = #10#18;
     |SI enForma = 1;
          |GRABA 020#65n;
     |SINO;
          |BORRA 020#65c;
     |FINSI;
     |CIERRA #65;
|FPRC;

|PROCESO HistoricoME;
     |ABRE #65;
     |DDEFECTO #65;
     #65#0  = aArti;
     #65#1  = #10#8;
     #65#2  = "ME";
     #65#3  = #10#27;
     #65#4  = #10#11;
     #65#5  = #10#5;
     #65#6  = nUni;
     #65#7  = #19#6;
     #65#8  = #19#9;
     #65#9 = #10#29;
     #65#11 = #10#28;
     #65#12 = 0;
     #65#13 = 0;
     #65#14 = #10#29;
     #65#17 = nUni2;
     #65#18 = #10#17;
     #65#19 = #10#18;
     |SI enForma = 1;
          |GRABA 020#65n;
     |SINO;
          |BORRA 020#65c;
     |FINSI;
     |CIERRA #65;
|FPRC;

|PROCESO StockMS;
     alm_disp = alm_disp - (nUni * enForma);
     alm_tota = alm_tota - (nUni * enForma);
     alm_disp2 = alm_disp2 - (nUni2 * enForma);
     alm_tota2 = alm_tota2 - (nUni2 * enForma);

     par_disp = par_disp - (nUni * enForma);
     par_tota = par_tota - (nUni * enForma);
     par_disp2 = par_disp2 - (nUni2 * enForma);
     par_tota2 = par_tota2 - (nUni2 * enForma);
     par_sreal = par_sreal + (nUni * enForma);
     par_sreal2 = par_sreal2 + (nUni2 * enForma);

     par_merma = par_merma - (#10#18 * enForma);

     |SI enForma = 1; #24#5 = #10#8; |FINSI; || F.Salida

     aAlfa = #10#8 % 402; nNume = aAlfa;
     nNume = ((nNume - 1) * 2) + 11;

     |SI #19#194 = 1; nUni0 = nUni; |SINO; nUni0 = nUni2; |FINSI;

     #17nNume = #17nNume + (nUni0 * enForma);
     #17#35 = #17#35 + (nUni0 * enForma);

     |HAZ EsAlbero;
     |SI FSalida = 0;
          enUni1 = nUni;
          enUni2 = nUni2;
          enAlbForma = enForma;
          |HAZ AlberoActPartidasMS61;
     |FINSI;

     |HAZ ValorStock;
|FPRC;

|PROCESO StockME;
     alm_disp = alm_disp + (nUni * enForma);
     alm_tota = alm_tota + (nUni * enForma);
     alm_disp2 = alm_disp2 + (nUni2 * enForma);
     alm_tota2 = alm_tota2 + (nUni2 * enForma);

     par_disp = par_disp + (nUni * enForma);
     par_tota = par_tota + (nUni * enForma);
     par_disp2 = par_disp2 + (nUni2 * enForma);
     par_tota2 = par_tota2 + (nUni2 * enForma);

     par_ereal = par_ereal + (nUni * enForma);
     par_ereal2 = par_ereal2 + (nUni2 * enForma);

     par_merma = par_merma + (#10#18 * enForma);

     |SI #19#196 = 1; nUni0 = nUni; |SINO; nUni0 = nUni2; |FINSI;

     aAlfa = #10#8 % 402; nNume = aAlfa;
     nNume = ((nNume - 1) * 2) + 12;
     #17nNume = #17nNume + (nUni0 * enForma);
     #17#36 = #17#36 + (nUni0 * enForma);

     |HAZ EsAlbero;
     |SI FSalida = 0;
          enUni1 = nUni;
          enUni2 = nUni2;
          enAlbForma = enForma;
          |HAZ AlberoActPartidasME61;
     |FINSI;
     |HAZ ValorStock;
|FPRC;

|PROCESO AcumulaME_MS;
     aArti = #10#0;
     nAlma = #10#1;
     aParti = #10#16;
     nUni = #10#4;
     nUni2 = #10#15;
     nUnidades = #10#4;
     |HAZ LeArticulo;
     |HAZ StockMS;
     |HAZ GrabaArti;
     |HAZ HistoricoMS;
     aSwMeMs = "MS";
     |SI aTipoEsca = "K"; |HAZ DesLinKit; |FINSI;

     aArti = #10#0;
     nAlma = #10#5;
     aParti = #10#17;
     nUni = #10#4;
     nUni2 = #10#15;
     nUnidades = #10#4;
     |HAZ LeArticulo;
     |HAZ StockME;
     |HAZ GrabaArti;
     |HAZ HistoricoME;
     aSwMeMs = "ME";
     |SI aTipoEsca = "K"; |HAZ DesLinKit; |FINSI;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO MiraMedidaC;
     |ABRE #19;
     #19#0 = aArti;
     |LEE 000#19=;
     |CIERRA #19;

     |SI #19#179 = "S"; |Y #19#188 > 0;
          aArti = "";
     |FINSI;
|FPRC;

|PROCESO PintaMedidaC;
     |HAZ CompruParam;
     |SI aProg = "agifa077";
          |HAZ PintaUnidad;
     |FINSI;

     |SI eaSw2Stock = "N"; |ACABA; |FINSI;
     |SI #agifa142#117 = "N"; |ACABA; |FINSI;
     aRaya = "컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴";
     |SI aProg = "agifa077"; |O aProg = "agifa212";
          aArti = #4#2;
          |HAZ MiraMedidaC;
          |SI aArti ! "";
               |C_V #4#39, 1, "N";
               |C_V #4#40, 1, "N";
               |C_V #4#41, 1, "N";
               |PINTA 2303, aRaya;
          |SINO;
               |SI #19#188 = 1; #0#0 = #4#39; |FINSI;
               |SI #19#188 = 2; #0#0 = #4#39 * #4#40; |FINSI;
               |SI #19#188 = 3; #0#0 = #4#39 * #4#40 * #4#41; |FINSI;
               |ATRI I;
               |PINTA 2307, "Md:       x       x       =          ";
               |PINTA 2334, #0#0;
               |ATRI 0;
               |C_V #4#39, 1, "S"; |PINTA #4#39;
               |C_V #4#40, 1, "S"; |PINTA #4#40;
               |C_V #4#41, 1, "S"; |PINTA #4#41;
          |FINSI;
     |FINSI;
     |SI aProg = "agifa081";
          aArti = #6#2;
          |HAZ MiraMedidaC;
          |SI aArti ! "";
               |C_V #6#47, 1, "N";
               |C_V #6#48, 1, "N";
               |C_V #6#49, 1, "N";
               |PINTA 2303, aRaya;
          |SINO;
               |SI #19#188 = 1; #0#0 = #6#47; |FINSI;
               |SI #19#188 = 2; #0#0 = #6#47  * #6#48; |FINSI;
               |SI #19#188 = 3; #0#0 = #6#47  * #6#48 * #6#49; |FINSI;
               |ATRI I;
               |PINTA 2307, "Md:       x       x       =          ";
               |PINTA 2334, #0#0;
               |ATRI 0;
               |C_V #6#47, 1, "S"; |PINTA #6#47;
               |C_V #6#48, 1, "S"; |PINTA #6#48;
               |C_V #6#49, 1, "S"; |PINTA #6#49;
          |FINSI;
     |FINSI;
     |SI aProg = "agi00027";
          aArti = #16#2;
          |HAZ MiraMedidaC;
          |SI aArti ! "";
               |C_V #16#17, 1, "N";
               |C_V #16#18, 1, "N";
               |C_V #16#19, 1, "N";
               |PINTA 2310, "                                       ";
          |SINO;
               |SI #19#188 = 1; #0#0 = #16#17; |FINSI;
               |SI #19#188 = 2; #0#0 = #16#17 * #16#18; |FINSI;
               |SI #19#188 = 3; #0#0 = #16#17 * #16#18 * #16#19; |FINSI;
               |ATRI I;
               |PINTA 2310, "Md:       x       x       =          ";
               |PINTA 2337, #0#0;
               |ATRI 0;
               |C_V #16#17, 1, "S"; |PINTA #16#17;
               |C_V #16#18, 1, "S"; |PINTA #16#18;
               |C_V #16#19, 1, "S"; |PINTA #16#19;
          |FINSI;
     |FINSI;
     |SI aProg = "agist001";
     |FINSI;
     |SI aProg = "dsm00056";
     |FINSI;
     |SI aProg = "dsm00043";
          aArti = #9#0;
          |HAZ MiraMedidaC;
          |SI aArti ! "";
               |C_V #9#15, 1, "N";
               |C_V #9#16, 1, "N";
               |C_V #9#17, 1, "N";
               |PINTA 2337, "컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴";
          |SINO;
               |SI #19#188 = 1; #0#0 = #9#15; |FINSI;
               |SI #19#188 = 2; #0#0 = #9#15 * #9#16; |FINSI;
               |SI #19#188 = 3; #0#0 = #9#15 * #9#16 * #9#17; |FINSI;
               |ATRI I;
               |PINTA 2337, "Md:       x       x       =          ";
               |PINTA 2365, #0#0;
               |ATRI 0;
               |C_V #9#15, 1, "S"; |PINTA #9#15;
               |C_V #9#16, 1, "S"; |PINTA #9#16;
               |C_V #9#17, 1, "S"; |PINTA #9#17;
          |FINSI;
     |FINSI;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO DesLinKit0;
     nUni = #100#5 * nUnidades;
     nUni2 = 0;
     nUnidPend = #100#5 * nUnidadesPend;
     nUnidPend2 = 0;

     aArti = #100#3;
     |SI aProg = "dsm00054";
          |SI aSwMeMs = "ME";
               nAlma = #100#9;
               |HAZ LeArticulo;
               |HAZ StockME;
               |HAZ GrabaArti;
               |HAZ HistoricoME;
          |SINO;
               nAlma = #100#4;
               |HAZ LeArticulo;
               |HAZ StockMS;
               |HAZ GrabaArti;
               |HAZ HistoricoMS;
          |FINSI;
     |SINO;
          |SI aProg = "dsm00043";
               aArti = #100#3;
               nAlma = #100#4;
               aParti = "";
               |HAZ LeArticulo;
               |SI #9#7 = "E"; nUni = nUni; |SINO; nUni = -nUni;  |FINSI;
               |HAZ StockES_SS;
               |HAZ GrabaArti;
               |HAZ HistoricoES_SS;
          |SINO;
               nAlma = #100#4;
               |HAZ LeArticulo;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE DesLinKit0;
     #100#1004;
     ;
     aSer, nNum, nLin, 001;
     aSer, nNum, nLin, 999;
     ;
     NULL, DesLinKit0;
|FIN;

|PROCESO DesLinKit;
     |HAZ HallaProg;
     |SI aProg = "agifa081"; |O aProg = "agi00027";
          aDef = "dsm00065";
          aSer = #6#28;
          nNum = #6#0;
          nLin = #6#1;
     |FINSI;
     |SI aProg = "agifa077"; |O aProg = "agifa212";
          aDef = "dsm00066";
          aSer = #4#27;
          nNum = #4#0;
          nLin = #4#1;
     |FINSI;
     |SI aProg = "dsm00054";
          aDef = "dsm00068";
          aSer = #10#28;
          nNum = #10#27;
          nLin = #10#11;
     |FINSI;
     |SI aProg = "dsm00043";
          aDef = "dsm00070";
          aSer = #9#21;
          nNum = #9#18;
          nLin = #9#8;
     |FINSI;

     |SI aDef = ""; |ACABA; |FINSI;

     |DBASE aBase;
     aPath = aBase + "def/" + aDef;
     |CARGA_DEF aPath, referen@;
     |SI FSalida = 0;
          |BUCLE DesLinKit0;
          |DESCARGA_DEF #referen@;
     |SINO;
          aAlfa = "0000Error al cargar " + aPath;
          |MENAV aAlfa;
     |FINSI;
|FPRC;

|PROCESO LeeUnidades;
     |ABRE #241; |SELECT #2#241;
     #241#0 = #19#5;
     #241#2 = #19#205; || Compras
     |LEE 000#241=;
     |CIERRA #241;
|FPRC;

|PROCESO PintaUnidad;
     |ABRE #19;
     #19#0 = #4#2;
     |LEE 000#19=;
     |CIERRA #19;
     |SI #19#204 = "S";
          eaSw2Stock = "N";
          |HAZ LeeUnidades;
          |PINTA 2308, #241#0;
          |PINTA 2314, #241#4;
     |SINO;
          |SI #142#163 = "S";
               aAlfa = " " * 25;
               |PINTA 2308, aAlfa;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO ModiHistoAC;
     |ABRE #65;
     |DDEFECTO #65;
     #65#0 = #19#0;       ||#4#2;
     #65#1 = #3#1;
     #65#3 = #4#0;
     #65#4 = #4#1;
     |SI #3#42 = "S";
          #65#2 = "BC";
     |SINO;
          #65#2 = "AC";
     |FINSI;
     #65#11 = #4#27;
     |LEE 101#65=;
     |SI FSalida = 0;
          |HAZ EsSanchez;
          |SI FSalida = 0;
              eaArti = #65#0;
              enPrecio = #65#9;
              |HAZ SanchezPreCom;
              #65#9 = enPrecio;
          |FINSI;

          #65#5 = #4#3;
          #65#10 = #3#3;
          #65#12 = #4#8;
          #65#13 = #4#26;
          #65#21 = #4#45;
          #65#14 = (((((#4#6 < #4#8) < #4#26) < #4#45) < #3#5) < #3#32);
          |SI #142#114 = "S";
               #65#14 = #65#14 < #3#7;
          |FINSI;
          |BORRA 020#65a;
          |GRABA 020#65n;
     |FINSI;
     |CIERRA #65;
|FPRC;

|PROCESO MinParC1;
     #24#0 = #0#9;
     #24#1 = 1;
     #24#2 = " " * 15;
|FPRC;

|PROCESO MaxParC1;
     #24#0 = #0#9;
     #24#1 = 99999;
     #24#2 = "z" * 15;
|FPRC;

|PROCESO MinParC;
     #24#0 = #0#9;
     #24#1 = nAlma;
     #24#2 = " " * 15;
|FPRC;

|PROCESO MaxParC;
     #24#0 = #0#9;
     #24#1 = nAlma;
     #24#2 = "z" * 15;
|FPRC;

|PROCESO PartiC66; |TIPO 66;
     |SI aProg = "dsm00054";
          nAlma = #0#19;
     |SINO;
          nAlma = #0#10;
     |FINSI;
     |ABRE #24;
     #24#0 = #0#9;
     #24#2 = #0#2;
     #24#1 = nAlma;
     |LEE 000#24];
     |CONSULTA_F_CLAVE #1#24, MinParC, MaxParC;
     |SI FSalida = 0;
          #0#2 = #24#2; |PINTA #0#2;
     |SINO;
          |ERROR;
     |FINSI;
     |CIERRA #24;
|FPRC;

|PROCESO PartiC66_2; |TIPO 66;
     nAlma = #0#10;
     |ABRE #24;
     #24#0 = #0#9;
     #24#1 = #0#10;
     #24#2 = #0#18;
     |LEE 000#24];
     |CONSULTA_F_CLAVE #1#24, MinParC, MaxParC;
     |SI FSalida = 0;
          #0#18 = #24#2; |PINTA #0#18;
     |SINO;
          |ERROR;
     |FINSI;
     |CIERRA #24;
|FPRC;

|PROCESO PartiCtrlC; |TIPO 11;
     |SI FSalida ! 7; |ACABA; |FINSI;   || Solo si pulsa Ctrl-C
     aAlfa = #0#2; |QBF aAlfa;
     |SI aAlfa = "";
          |SI #agifa142#241 = "N";
               |SI aProg = "agifa212";
                    |MENAV "0000Partida en Blanco no permitida";
                    |ERROR; |ACABA;
               |FINSI;
          |FINSI;
          |SI #dsm00279#29 = "N";
               |SI aProg = "dsm00054";
                    |MENAV "0000Partida en Blanco no permitida";
                    |ERROR; |ACABA;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO PartiC06; |TIPO 6;         || Entrada para el dsm00054
     |C_V #0#2, 0, aAlfa;
     |SI aAlfa = "N"; |ACABA; |FINSI;
     nModo = (FEntrada / 100) ! 0;
     nTecla = FSalida;
     |SI aProg = "dsm00054";
          nAlma = #0#19;
     |SINO;
          nAlma = #0#10;
     |FINSI;
     |SI nTecla = 18; ||F10
          |ABRE #24;
          #24#0 = #0#9;
          #24#1 = nAlma;
          #24#2 = #0#2;
          |LEE 000#24];
          |CONSULTA_F_CLAVE #1#24, MinParC1, MaxParC1;
          |SI FSalida = 0;
               #0#2 = #24#2; |PINTA #0#2;
          |SINO;
               |ERROR; |ACABA;
          |FINSI;
          |CIERRA #24;
     |FINSI;
     |SI nTecla = 9; ||F2;
          eaArticulo = #0#9;
          enAlmacen = nAlma;
          efFecha = #0#17;
          |HAZ ConsultaPartida;
          |SI eaPartida = "";
               |ERROR; |ACABA;
          |SINO;
               #0#2 = eaPartida;
               |PINTA #0#2;
          |FINSI;
     |FINSI;

     |SI nSwGestral = 0;
          aAlfa = #0#2; |QBF aAlfa;
          |SI nModo = 1; |Y aAlfa = "";
               |SI aProg = "dsm00043"; |O aProg = "dsm00056";
                         |O aProg = "agifa077"; |O aProg = "agifa212";
                    |HAZ GesContaPar;
               |FINSI;
          |FINSI;
     |FINSI;

     |SI #142#122 = "S";      || A쨅dido tiquet 003042/00600
          aAlfa = #0#2; |QBF aAlfa;
          aAlfa = (#142#121 * #142#120) + aAlfa;
          nNume = -(#142#120 + 100);
          #0#2 = aAlfa % nNume;

          |C_V #0#2, 0, aAlfa;
          |SI aAlfa = "S"; |PINTA #0#2; |FINSI;
     |FINSI;

     |SI nSwGestral = 0;
          aAlfa = #0#2; |QBF aAlfa;
          |SI nModo = 1; |Y aAlfa ! "";
               |SI aProg = "dsm00043"; |O aProg = "dsm00056";
                         |O aProg = "agifa077"; |O aProg = "agifa212";
                    |SI aProg = "dsm00043";
                         |SI #9#7 = "E"; |HAZ GesCheqPar; |FINSI;
                    |SINO;
                         |HAZ GesCheqPar;
                    |FINSI;
                    |SI FSalida ! 0; |ERROR; |ACABA; |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;

     aAlfa = #0#2; |QBF aAlfa;
     |SI nModo ! 4; |Y aAlfa = "";
          |SI #agifa142#241 = "N";
               |SI aProg = "agifa077"; |O aProg = "agifa212";
                    |MENAV "0000Partida en blanco no permitida";
                    |ERROR; |ACABA;
               |FINSI;
          |FINSI;
          |SI #dsm00279#29 = "N";
               |SI aProg = "dsm00054";
                    |MENAV "0000Partida en Blanco no permitida";
                    |ERROR; |ACABA;
               |FINSI;
          |FINSI;
     |FINSI;

     |SI aProg = "dsm00054"; || la relacion esta quitada para el dsm00054
          |ABRE #24;
          #24#0 = #0#9;
          #24#1 = nAlma;
          #24#2 = #0#2;
          |LEE 000#24=;
          |SI FSalida ! 0;
               |MENAV "0000No existe Partida...";
               |CONFI "0000NContinuar creando la partida?";
               |SI FSalida ! 0; |ERROR; |ACABA; |FINSI;
          |FINSI;
          |CIERRA #24;
     |FINSI;

     |HAZ EsAlbero;
     nSwAlbero = FSalida;
     |SI nSwAlbero = 0; |Y nAlbMenuParti = 2; |Y #0#8 = "EV";
          |ABRE #24;
          #24#0 = #0#9;
          #24#1 = #0#10;
          #24#2 = #0#2;
          |LEE 000#24=;
          |SI FSalida ! 0;
              ||MENAV "0000No existe partida";
              ||ERROR; |ACABA;
          |SINO;
               |SI #dsm00057#5 ! #24#3;
                    aAlfa = "0000ERROR, Proveedor de la partida: " + #24#3;
                    |MENAV aAlfa;
                    |ERROR; |ACABA;
               |FINSI;
          |FINSI;
          |CIERRA #24;
     |FINSI;

     |SI #0#8 = "EV"; |O #0#8 = "SA"; |O #0#8 = "ES";
          |SI nSwAlbero = 0;
               eaAlbePar = #0#2;
               |SI #0#8 = "EV";
                    enAlbeAlm = #8#1;
                    eaAlbeArt = #8#0;
               |FINSI;
               |SI #0#8 = "SA";
                    enAlbeAlm = #7#3;
                    eaAlbeArt = #7#2;
               |FINSI;
               |SI #0#8 = "ES";
                    enAlbeAlm = #9#1;
                    eaAlbeArt = #9#0;
               |FINSI;
               |HAZ EsArticuloPartida;
               |SI FSalida ! 0;
                    |QBF eaAlbeArtEs;
                    |SI eaAlbeArtEs ! "";
                         aMensaje = "0000Esta partida es del Articulo " + eaAlbeArtEs;
                         |MENAV aMensaje;
                         |ERROR;
                         |ACABA;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;

     |HAZ RellenaPartida;

     |SI nSwGestral = 0; |Y aProg = "dsm00043";
          enSwGesAltaPar = 0;
          |HAZ GesExistePar;
     |FINSI;
|FPRC;

|PROCESO PartiC06_2; |TIPO 6;
     |C_V #0#18, 0, aAlfa;
     |SI aAlfa = "N"; |ACABA; |FINSI;

     nModo = (FEntrada / 100) ! 0;
     nTecla = FSalida;
     |SI nTecla = 18; ||F10
          |ABRE #24;
          #24#0 = #0#9;
          #24#1 = #0#10;
          #24#2 = #0#18;
          |LEE 000#24];
          |CONSULTA_F_CLAVE #1#24, MinParC1, MaxParC1;
          |SI FSalida = 0;
               #0#18 = #24#2; |PINTA #0#18;
          |SINO;
               |ERROR; |ACABA;
          |FINSI;
          |CIERRA #24;
     |FINSI;
     |SI nTecla = 9; ||F2;
          eaArticulo = #0#9;
          enAlmacen = #0#10;
          efFecha = #0#17;
          |HAZ ConsultaPartida;
          |SI eaPartida = "";
               |ERROR; |ACABA;
          |SINO;
               #0#18 = eaPartida;
               |PINTA #0#18;
          |FINSI;
     |FINSI;
     |SI #142#122 = "S";
          aAlfa = #0#18; |QBF aAlfa;
          aAlfa = (#142#121 * #142#120) + aAlfa;
          nNume = -(#142#120 + 100);
          #0#18 = aAlfa % nNume;

          |C_V #0#18, 0, aAlfa;
          |SI aAlfa = "S"; |PINTA #0#18; |FINSI;
     |FINSI;

     aAlfa = #0#18; |QBF aAlfa;
     |SI #dsm00279#29 = "N"; |Y aAlfa = "";
          |SI aProg = "dsm00054";
               |MENAV "0000Partida en Blanco no permitida";
               |ERROR; |ACABA;
          |FINSI;
     |FINSI;

     |ABRE #24;
     #24#0 = #0#9;
     #24#1 = #0#10;
     #24#2 = #0#18;
     |LEE 000#24=;
     |SI FSalida ! 0;
          |MENAV "0000No existe Partida...";
          |ERROR;
     |FINSI;
     |CIERRA #24;
|FPRC;

|PROCESO GrabaParti;
     |ABRE #24;
     |DDEFECTO #24;
     #24#0 = #0#9;
     #24#1 = #0#10;
     #24#2 = #0#2;
     |LEE 101#24=;
     |SI FSalida ! 0; |GRABA 020#24b; |FINSI;
     |CIERRA #24;
|FPRC;

|PROCESO PartiC07; |TIPO 7;
     |SI nSwVer = 1; |ACABA; |FINSI;
     |HAZ EsAlbero;
     |SI FSalida ! 0; |ACABA; |FINSI;

     nSwAuto = 0;

     |SI #0#8 = "EV"; |O #0#8 = "ES"; |O #0#8 = "SA";
          |SI nModo = 1;
               aAux = #0#2;
               |QBF aAux;
               |SI aAux = "";
                    |PARA FSalida = 0; |SI FSalida = 0; |HACIENDO;
                         |MENU aMenuParti;
                    |SIGUE;
                    nAlbMenuParti = FSalida;
                    |SI FSalida = 1;
                         enAlbeAlm = #0#10;
                         eaTipoMov = "entrada";
                         |HAZ AlbeDamePartida;
                         #0#2 = eaAlbePar;
                         |PINTA #0#2;
                         |HAZ GrabaParti;
                         |C_M #0#2, 1, "N";
                         nSwAuto = 1;
                    |FINSI;
               |SINO;
                    |C_M #0#2, 1, "N";
               |FINSI;
          |SINO;
               |C_M #0#2, 1, "N";
          |FINSI;
     |FINSI;
     |SI #0#8 = "AC";
          |SI nModo =  1;;
               enAlbeAlm = #0#10;
               eaTipoMov = "entrada";
               |HAZ AlbeDamePartida;
               #0#2 = eaAlbePar;
               |HAZ GrabaParti;
          |FINSI;
          |C_M #0#2, 1, "N";
          |PINTA #0#2;
     |FINSI;
|FPRC;

|PROCESO DefectoMediC;
     enMedida1 = 0;
     enMedida2 = 0;
     enMedida3 = 0;

     |ABRE #19;
     #19#0 = eaArticulo;
     |LEE 000#19=;
     |CIERRA #19;

     |SI #19#179 = "N"; |ACABA; |FINSI;

     |ABRE #238;
     #238#0 = #19#201;
     |LEE 000#238=;
     |CIERRA #238;

     enMedida1 = #238#9; ||Med1
     enMedida2 = #238#10;||Med2
     enMedida3 = #238#11;||Med3
|FPRC;

|PROCESO GesContaPar;
     |ABRE #24; |SELECT #4#24;
     aAlfa = "9" * #142#120;
     #24#0 = #0#9;
     #24#2 = aAlfa;
     |LEE 000#24];
     |SI FSalida = 0;
          nNume = #24#2;
          |SI nNume < aAlfa;
               |LEE 000#24a;
          |FINSI;
     |SINO;
          |LEE 000#24u;
     |FINSI;
     |SI FSalida = 0; |Y #24#0 = #0#9;
          nNume = #24#2;
          |SI nNume ] aAlfa;
               nNume = 0;
          |SINO;
               nNume = nNume + 1;
          |FINSI;
     |SINO;
          nNume = 1;
     |FINSI;
     |CIERRA #24;
     |SI nNume ! 0;
          aAlfa = ("0" * #142#120) + nNume;
          nNume = -1 * (#142#120 + 100);
          aAlfa = aAlfa % nNume;
          #0#2 = aAlfa; |PINTA #0#2;
          nNume = #0#2;
     |SINO;
          |MENAV "0000Superado contador partidas...";
          |ERROR;
     |FINSI;
|FPRC;

|PROCESO GesCheqPar;
     aAlfa = "0";
     |ABRE #24; |SELECT #4#24;
     #24#0 = #0#9;
     #24#2 = #0#2;
     |LEE 000#24=;
     |SI FSalida = 0;
          |MENAV "0000Partida existente...";
          |CONFI "0000N Continuar ?";
          aAlfa = FSalida;
     |FINSI;
     |CIERRA #24;
     FSalida = aAlfa;
|FPRC;

|PROCESO DefUni; |TIPO 7;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 1;
          |SI aProg = "dsm00043"; |O aProg = "dsm00056";
                              |O aProg = "agifa077"; |O aProg = "agifa212";
               |SI nSwGestral = 0; |Y nModo = 1;
                    #0#0 = 1; |PINTA #0#1;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO GesExistePar;   || alta por narices
     |DDEFECTO #24;
     |ABRE #24;
     #24#0 = #0#9;
     #24#1 = #0#10;
     #24#2 = #0#2;
     |LEE 000#24=;
     |SI FSalida ! 0;
          |GRABA 020#24b;
          |PUSHV 0501 2380;
          |PINPA #0#24;
          |PINDA #0#24;
          |CONFI "0000SConfirma alta (S/N).:";
          |SI FSalida = 0;
               |PARA; |SI; |HACIENDO;
                    |ENDATOS #1#24;
                    |SI FSalida = 0;
                         enSwGesAltaPar = 1;
                         |GRABA 020#24a;
                         |SAL;
                    |FINSI;
               |SIGUE;
          |SINO;
               |BORRA 020#24c;
               |ERROR;
          |FINSI;
          |POPV;
     |FINSI;
     |CIERRA #24;
|FPRC;

|PROCESO GestralPanRegu;
     |DDEF aAlfa;
     aAlfa = aAlfa + "gestrz05";
     |CARGA_DEF aAlfa, gestrz05@;
     |SI FSalida = 0;
          |PARA i = 0; |SI i [ 19; |HACIENDO i = i + 1;
               |C_P #gestrz05@#i#, 0, nPos;
               |C_P #0i, 1, nPos;
          |SIGUE;
          |SI nSwVer = 1;
               |PUSHV 0501 2380;
               |BLANCO 801 1437;
               |PINPA #0#gestrz05@;
               |HAZ VisualCampos;
               |PINDA #0#0;
               |SI #19#179 = "N";
                    |PINTA 1204, "Unidades..:";
               |SINO;
                    |PINTA 1104, #238#2;
                    |PINTA 1204, #238#3;
               |FINSI;
               |PAUSA;
               |POPV;
               |ACABA;
          |SINO;
               |HAZ Entrada;
          |FINSI;
          |DESCARGA_DEF #gestrz05@;
     |FINSI;
|FPRC;

|PROCESO CBVta;
     |ABRE #101;
     |SELECT #2#101;
     #101#3 = aAlfa;
     |LEE 000#101=;
     |SI FSalida = 0; |Y aAlfa ! #101#1;
          aAlfa = #101#1;
          |ABRE #19;
          #19#0 = aAlfa;
          |LEE 000#19=;
          |CIERRA #19;
     |FINSI;
     |CIERRA #101;
|FPRC;
