     PedCompra

|FICHEROS;
     dsm00003 #3;
     okm00009 #9;
     okm00010 #10,MANTE;
     agifa019 #19;
     agifa041 #41;
     agifa067 #67;
     agifa081 #81;
     okm00001 #100;
     agifa112 #112;
     agifa142 #142;
|FIN;

|VARIABLES;
     &aDivisa = "";
     &aMoneda = "";
     &enSwMenu = 0;
     &enForma = 0;
     &eaDocu = "";
     &enImpPrvPed = 0;
     &efFecha = @;
     &eaProve = "";
     &eaSerie = "";
     &enDocu = 0;
     aAlfa = "";
     nLin = 0;
     aEmp = "";
     fmes = "";
     mes = 0;
     nImpo = 0;
     nSwEnviaPed = 0;
     aObs = "";
|FIN;

|PROCESO ActProv;
     #19#0 = #67#2;
     |LEE 000#19=;
     |SI FSalida ! 0; |DDEFECTO #19; |FINSI;

     fmes = #81#1 % A402;
     mes = fmes + 42;
     |SI #19#196 = 2;
          nImpo = (((((#67#41 * #67#6) < #67#8) < #67#27) < #67#57) < #81#5) < #81#17;
     |SINO;
          nImpo = (((((#67#5 * #67#6) < #67#8) < #67#27) < #67#57) < #81#5) < #81#17;
     |FINSI;
     |SI #142#114 = "S";
          nImpo = nImpo < #81#6;
     |FINSI;
     #112mes = #112mes + nImpo;
     #112#55 = #112#55 + nImpo;

     enImpPrvPed = nImpo;
     efFecha = #81#1;
     eaProve = #81#4;
     |HAZ AcumulaPrv;
|FPRC;

|PROCESO LinPedCom;
     |ABRE #19;
     #19#0 = #10#4;
     |LEE 000#19=;
     |SI FSalida ! 0; |DDEFECTO #19; |FINSI;
     |CIERRA #19;

     nLin = nLin + 1;
     |DDEFECTO #67;
     #67#28 = #81#25;
     #67#0 = #81#0;
     #67#1 = nLin;
     #67#2 = #10#4;
     #67#3 = 1; || #100#10;
     #67#4 = #10#5;
     #67#5 = #10#6;
     #67#6 = #19#133;
     #67#14 = #19#30;
     #67#18 = #19#2;
     #67#20 = #81#4;
     #67#23 = #81#5;
     #67#24 = #81#6;
     #67#25 = #81#17;
     #67#26 = #81#9;
     #67#33 = #67#6;
     #67#35 = #67#6;
     #67#35 = #67#5;
     |GRABA 020#67n;
     enForma = 1;
     eaDocu = "agifa067";
     |HAZ StockEntra;
|FPRC;

|DEFBUCLE LinPedCom;
     #10#1;
     10;
     #9#2, 001, "C";
     #9#2, 999, "C";
     ;
     NULL, LinPedCom;
|FIN;

|PROCESO PedCompra;
     |CONFI "0000N¨Enviar pedido a Gorfactory?";
     nSwEnviaPed = FSalida;
     |CONFI "0000N¨Enviar pedido al cliente?";
     |SI FSalida = 0;
          |ABRE #3;
          #3#0 = #9#4;
          #3#1 = #9#6;
          |LEE 000#3=;
          |SI FSalida ! 0; |DDEFECTO #3; |FINSI;
          |CIERRA #3;
          aObs = "Entregar en:" + #3#10; |QBF aObs;
          aObs = aObs + " " + #3#2; |QBF aObs;
          aObs = aObs + " " + #3#3; |QBF aObs;
          aObs = aObs + " " + #3#6; |QBF aObs;
          aObs = aObs + #3#7;
     |SINO;
          aObs = "";
     |FINSI;

     |ABRE #81;
     |ABRE #67;
     nLin = 0;
     |ABRE #112;
     #112#0 = #100#12;
     |LEE 000#112=;
     |SI FSalida ! 0; |DDEFECTO #112; |FINSI;
     |CIERRA #112;
     |DFICE aEmp; aEmp = aEmp % -205;
     |DFICB aAlfa;
     |PATH_DAT #41 aAlfa;
     |ABRE #41;
     #41#0 = aEmp;
     |LEE 020#41=;
     |CIERRA #41;

     nLin = 0;
     #81#25 = #100#11;
     enSwMenu = 1;
     |HAZ ContaPC7;
     |GRABA 020#81b;

     #81#1 = ~;
     #81#2 = ~;
     #81#4 = #100#12;
     #81#5 = #9#8;
     #81#6 = #9#9;
     #81#8 = #112#2;
     #81#9 = #112#17;
     #81#15 = aObs;
     #81#17 = #9#10;
     #81#18 = #41#2;
     #81#19 = #41#1;
     #81#20 = #41#3;
     #81#21 = #41#4;
     #81#27 = "EUR";
     #81#28 = 1;
     #81#29 = "B";
     #81#32 = "EUR";
     #81#33 = 1;
     #81#45 = #112#87;

     aDivisa = #81#27;
     aMoneda = #81#29;
     |HAZ Divisas081;

     |BUCLE LinPedCom;
     |HAZ CalCabAgifa081;

     |DDEFECTO #112;
     |ABRE #112;
     |ABRE #19;
     #112#0 = #81#4;
     |LEE 101#112=;
     |SI FSalida ! 0; |GRABA 020#112b; |FINSI;
     |BUCLELIN 2 ActProv #81;
     |GRABA 020#112a;
     |CIERRA #19;
     |CIERRA #112;

     |CIERRA #67;
     |CIERRA #81;

     #9#13 = "S";
     #9#14 = #81#25;
     #9#15 = #81#0;
     |GRABA 020#9a;
     |LIBERA #9;

     |SI nSwEnviaPed = 0;
          eaSerie = #81#25;
          enDocu = #81#0;
          |SUB_EJECUTA_NP "okm00002";
     |FINSI;
|FPRC;
