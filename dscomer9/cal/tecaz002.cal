|FICHEROS;
     tecaz002 #0;
     tecaw002 #1; ||Tmp
     tecam003 #3;
     tecam004 #4;
     tecam005 #5;
     tecam006 #6; || Tmp
     tecam007 #7; || Tmp
     agifa073 #73;
     agifa104 #104;
     agifa024 #24;
     agifa017 #17;
     dsm00020 #20;
|FIN;

|VARIABLES;
     nPrimeLin = 0;
     nLoteAnt = 0;
 {-1}aMenu = "";
     aMenu1 = "2400";
     aMenu2 = "1";
     aMenu3 = " ";
     aMenu4 = "RAC";
     aMenu5 = " Repasar ";
     aMenu6 = " Aceptar ";
     aMenu7 = " Cancelar ";
     nHay = 0;
     nLote = 0;
     nDetalle = 0;
     nUni = 0;
     nLon = 0;
     aLF = "";
     aAlfa = "";
     aLon = "";
     aValor = "";
     aBlanco = "";
     nHandle = 0;
     nCampos = 0;
     i = 0;
     aDes = "";
     aPath = "";
     aFic = "";
     nAntes = 0;
     nLin = 0;
|FIN;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO Graba;
     nLon = aLon;
     aBlanco = " " * nLon;
     nLon = -1 * (nLon + 100)
     aAlfa = (aBlanco + aValor) % nLon;
     |XGRABA nHandle, aAlfa;
|FPRC;

|PROCESO FicheroFinal;
     |SI nHandle ] 0; |Y nLoteAnt ! 0;
          |XCIERRA nHandle;
     |FINSI;
|FPRC;

|PROCESO FicheroF;
     |SI nHandle ] 0;
          #0#0 = #6#0;
          |LEE 020#0=;

          #4#0 = #6#0;
          |LEE 121#4=;

          #5#2 = #6#1;
          #5#3 = #6#2;
          #5#0 = #6#0;
          |LEE 121#5=;

          #4#4 = #0#1;        ||codigo Palm
          |GRABA 020#4a;
          #5#6 = "P";
          |GRABA 020#5a;
          |LIBERA #4;
          |LIBERA #5;
     |FINSI;
|FPRC;

|PROCESO FicheroL;
     aAlfa = "|NC";
     aAlfa = #7aAlfa;
     nCampos = aAlfa;
     nCampos = nCampos - 1;
     ||********************PA DEPURAR
/*
     |SI nPrimeLin = 0;
          nPrimeLin = 1;
          |XGRABA nHandle, "L";
          |PARA i = 0; |SI i [ nCampos; |HACIENDO i = i + 1;
               aAlfa = ("000" + i) % -103;
               aAlfa = "|C" + aAlfa + "LONGITUD";
               aLon = #7aAlfa;
               aAlfa = ("000" + i) % -103;
               aAlfa = "|C" + aAlfa + "NOMBRE";
               aValor = #7aAlfa;
               aValor = aValor + aLon;
               |HAZ Graba;
          |SIGUE;
          |XGRABA nHandle, aLF;
     |FINSI;
     ||*********************************
*/
     |XGRABA nHandle, "L";
     |PARA i = 0; |SI i [ nCampos; |HACIENDO i = i + 1;
          aAlfa = ("000" + i) % -103;
          aAlfa = "|C" + aAlfa + "LONGITUD";
          aLon = #7aAlfa;
          aValor = #7i;
          |HAZ Graba;
     |SIGUE;
     |XGRABA nHandle, aLF;
|FPRC;

|PROCESO FicheroC;
     |SI nLoteAnt = #6#0;
          |ACABA;
     |FINSI;
     |HAZ FicheroFinal;
     nLoteAnt = #6#0;

     aAlfa = ("00000" + #6#0) % -106;
     aFic = "lot" + aAlfa + ".txt";

     #3#0 = #6#0;
     |LEE 020#3=;

     aPath = #3#2; |QBF aPath;
     aDes = aPath  + aFic;

     |XABRE "WBC", aDes, nHandle;
     |SI FSalida < 0
          |ERROR; |ACABA;
     |FINSI;

     aAlfa = "|NC";
     aAlfa = #6aAlfa;
     nCampos = aAlfa;
     nCampos = nCampos - 1;

     ||********************PA DEPURAR
/*
     nPrimeLin = 0;
     |XGRABA nHandle, "C";
     |PARA i = 0; |SI i [ nCampos; |HACIENDO i = i + 1;
          aAlfa = ("000" + i) % -103;
          aAlfa = "|C" + aAlfa + "LONGITUD";
          aLon = #6aAlfa;
          aAlfa = ("000" + i) % -103;
          aAlfa = "|C" + aAlfa + "NOMBRE";
          aValor = #6aAlfa;
          aValor = aValor + aLon;
          |HAZ Graba;
     |SIGUE;
     |XGRABA nHandle, aLF;
     ||******************************
*/
     |XGRABA nHandle, "C";
     |PARA i = 0; |SI i [ nCampos; |HACIENDO i = i + 1;
          aAlfa = ("000" + i) % -103;
          aAlfa = "|C" + aAlfa + "LONGITUD";
          aLon = #6aAlfa;
          aValor = #6i;
          |HAZ Graba;
     |SIGUE;
     |XGRABA nHandle, aLF;
|FPRC;

|DEFBUCLE Fichero;
     #6#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, FicheroC, FicheroL, FicheroF;
|FIN;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO Impre;
     |SI nLote ! #1#0; |Y nLote ! 0;
          |PIEINF;
     |FINSI;
     nLote = #1#0;
     |PRINT;
|FPRC;

|DEFBUCLE Impre;
     #1#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Impre;
|FIN;

|PROCESO agifa073;
     nUni = #73#5 - #73#43;
     |SI nUni [ 0; |ACABA; |FINSI;

     |DDEFECTO #104;
     #104#25 = #73#28;
     #104#0 = #73#0;
     |LEE 020#104=;

     |DDEFECTO #17;
     #17#0 = #73#2;
     #17#1 = #73#3;
     |LEE 020#17=;

     |DDEFECTO #24;
     #24#0 = #104#4;
     |LEE 020#24=;

     |DDEFECTO #20;
     #20#0 = #104#60;
     |LEE 020#20=;

     |DDEFECTO #1;
     #1#0 = #0#0;
     |SI nDetalle = 0;
          #1#5 = #73#28;
          #1#6 = #73#0;
     |FINSI;
     #1#1 = #17#2;
     #1#2 = #73#2;
     |LEE 101#1=;
     |SI FSalida ! 0; |GRABA 020#1b; |FINSI;
     #1#3 = #73#4;
     #1#4 = #1#4 + nUni;
     #1#7 = #104#4;
     #1#8 = #104#8;
     #1#9 = #24#17;
     #1#10 = #104#1;
     |GRABA 020#1a;
     |LIBERA #1;
     ||컴컴컴컴컴컴컴컴컴컴
     |DDEFECTO #6;
     #6#0 = #0#0;
     #6#1 = #104#25;
     #6#2 = #104#0;
     |LEE 101#6=;
     |SI FSalida ! 0; nLin = 0; |GRABA 020#6b; |FINSI;
     #6#3 = #104#1;
     #6#4 = #104#60;
     #6#5 = #104#4;
     #6#6 = #104#8;
     #6#7 = #104#14;
     #6#8 = #104#20;
     #6#9 = #104#59;
     #6#10 = #104#21;
     #6#11 = #104#26;
     #6#12 = #104#51;
     #6#13 = #104#53;
     #6#14 = #104#54;
     #6#15 = #104#55;
     #6#16 = 0;          ||Bultos
     #6#17 = #20#1;
     |GRABA 020#6a;
     |LIBERA #6;
     ||컴컴컴컴컴컴컴컴컴컴
     nLin = nLin + 1;
     |DDEFECTO #7;
     #7#0 = #6#0;
     #7#1 = #6#1;
     #7#2 = #6#2;
     #7#3 = nLin;
     #7#4 = #73#2;
     #7#5 = #73#4;
     #7#6 = #73#42;
     #7#7 = nUni;
     #7#8 = #73#43;
     #7#9 = #17#2;
     #7#10 = 0;          ||Peso
     |GRABA 020#7n;

     nHay = 1;
|FPRC;

|DEFBUCLE agifa073;
     #73#1;
     ;
     #5#2, #5#3, 001;
     #5#2, #5#3, 999;
     ;
     NULL, agifa073;
|FIN;

|PROCESO tecam005;
     |BUCLE agifa073;
|FPRC;

|DEFBUCLE tecam005;
     #5#1;
     ;
     #0#0, 001;
     #0#0, 999;
     ;
     NULL, tecam005;
|FIN;

|PROCESO Agrupa;
     |BUCLE tecam005;
|FPRC;

|DEFBUCLE Agrupa;
     #0#1;
     1;
     00000,  1;
     99999, 99;
     ;
     NULL, Agrupa;
|FIN;

|PROCESO Imprime;
     |IMPRE 0;
     |SI FSalida = 0;
          |SI nDetalle = 0;
               |INFOR "tecad002";
          |SINO;
               |INFOR "tecaz002";
          |FINSI;
          |SI FSalida = 0;
               |BUCLE Impre;
               |PIEINF;
               |FININF;
          |FINSI;
          |FINIMP;
     |FINSI;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO Tecla7; |TIPO 7;
     nAntes = #0Campo;
|FPRC;

|PROCESO Tecla0; |TIPO 0;
     ||||SI #0Campo = Contenido; |Y FSalida = 0;  *** FALLA :( ***
     |SI #0Campo = nAntes; |Y FSalida = 0;
          |ENCAMPO #1#0;
          |SI FSalida = 0;
               |GRABA 020#0a;
          |SINO;
               |LEE 000#0=;
               |PINTA #0#1;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO tecam004;
     #0#0 = #4#0;
     |GRABA 020#0n;
     nHay = 1;
|FPRC;

|DEFBUCLE tecam004;
     #4#1;
     4;
     00000, 00;
     99999, 00;
     ;
     NULL, tecam004;
|FIN;

|PROCESO Min;
     #0#0 = 1;
|FPRC;

|PROCESO Max;
     #0#0 = 99999;
|FPRC;

|PROGRAMA;
     |CLS;

     aLF = &13 + &10;
     aAlfa = Usuario;
     |NOME_DAT #0 aAlfa;
     |DELINDEX #0;
     |ABRE #0;
     |BUCLE tecam004;
     |CIERRA #0;
     |SI nHay = 0;
          |MENAV "0000No hay registros...";
          |ACABA;
     |FINSI;
     |PINPA #0#0;
     |PARA; |SI aMenu2 = 1; |HACIENDO;
          |ENTLINEAL #1#0, 1, 4, 22, 0, Min, Max;
          |MENU aMenu;
          aMenu2 = FSalida;
     |SIGUE;
     |SI aMenu2 = 2;
          |CONFI "0000NDetalle de pedidos";
          nDetalle = FSalida;

          nHay = 0;
          aAlfa = Usuario; aAlfa = "1" + aAlfa;
          |NOME_DAT #1 aAlfa; |DELINDEX #1;
          aAlfa = Usuario; aAlfa = "6" + aAlfa;
          |NOME_DAT #6 aAlfa; |DELINDEX #6;
          aAlfa = Usuario; aAlfa = "7" + aAlfa;
          |NOME_DAT #7 aAlfa; |DELINDEX #7;

          |ABRE #1;
          |ABRE #104;
          |ABRE #24;
          |ABRE #17;
          |ABRE #6;
          |ABRE #7;
          |ABRE #20;
          nHay = 0;
          |BUCLE Agrupa;
          |CIERRA #20;
          |CIERRA #7;
          |CIERRA #6;
          |CIERRA #17;
          |CIERRA #24;
          |CIERRA #104;
          |CIERRA #1;
          |SI nHay ! 0;
               |HAZ Imprime;
               |CONFI "0000NContinuar con el envio del lotes a los Palm";
               |SI FSalida = 0;
                    nLote = 0;
                    |ABRE #5; |SELECT #2#5;
                    |ABRE #4;
                    |ABRE #3;
                    |ABRE #0;
                    |BUCLE Fichero;
                    |HAZ FicheroFinal;
                    |CIERRA #0;
                    |CIERRA #3;
                    |CIERRA #4;
                    |CIERRA #5;
               |FINSI;
          |FINSI;

          |DELINDEX #1;
          |DELINDEX #6;
          |DELINDEX #7;
     |FINSI;
|FPRO;
