|FICHEROS;
   guerz207 #0;

   gopartia #10;
   agifa080 #11;
   agifa077 #12;
   godiacaj #13;
   guerw051 #14;
   agifa029 #15;
   gomantl1 #16;
|FIN;

|VARIABLES;
   nSw       = 0;
   nSwCambia = 0;

   aAlfa     = "";
   aTipo     = "";
|FIN;

|PROCESO CompruebaDatos;
   nSwCambia = 0;
   |SI #gopartia#20 ! #agifa080#2;
      #gopartia#20 = #agifa080#2;
      #gopartia#30 = #agifa080#4;
      nSwCambia = 1;
   |FINSI;

   |SI #gopartia#10 ! #agifa080#5; #gopartia#10 = #agifa080#5; nSwCambia = 1; |FINSI;

   |SI #gopartia#41 ! #agifa080#6; #gopartia#41 = #agifa080#6; nSwCambia = 1; |FINSI;
   |SI #gopartia#49 ! #agifa080#6; #gopartia#49 = #agifa080#6; nSwCambia = 1; |FINSI;

   |SI #gopartia#42 ! #agifa080#8;  #gopartia#42 = #agifa080#8; nSwCambia = 1; |FINSI;
   |SI #gopartia#50 ! #agifa080#8;  #gopartia#50 = #agifa080#8; nSwCambia = 1; |FINSI;

   |SI #gopartia#43 ! #agifa080#26; #gopartia#43 = #agifa080#26; nSwCambia = 1; |FINSI;
   |SI #gopartia#51 ! #agifa080#26; #gopartia#51 = #agifa080#26; nSwCambia = 1; |FINSI;

   |SI nSwCambia = 1;
      #gopartia#14 = #gopartia#10 * #gopartia#41;
      #gopartia#14 = #gopartia#14 < #gopartia#42;
      #gopartia#14 = #gopartia#14 < #gopartia#43;
      #gopartia#14 = #gopartia#14 < #gopartia#44;
      #gopartia#12 = #gopartia#14 / #gopartia#10;

      #gopartia#25 = #gopartia#10 * #gopartia#49;
      #gopartia#25 = #gopartia#25 < #gopartia#50;
      #gopartia#25 = #gopartia#25 < #gopartia#51;
      #gopartia#25 = #gopartia#25 < #gopartia#52;
      #gopartia#23 = #gopartia#25 / #gopartia#10;
   |FINSI;
|FPRC;

|PROCESO gopartia;
   |SI #gopartia#34 ! "M"; |Y #gopartia#34 ! "C"; |ACABA; |FINSI;

   #agifa080#27 = #gopartia#4;
   #agifa080#0  = #gopartia#5;
   #agifa080#1  = #gopartia#6;
   |LEE 000#agifa080.=;
   |SI FSalida = 0;
      |HAZ CompruebaDatos;
      |SI nSwCambia = 1; |GRABA 020#gopartia.a; |FINSI;
      |LIBERA #gopartia;
   |SINO;
      |BORRA 020#gopartia.a;
   |FINSI;
|FPRC;

|DEFBUCLE gopartia;
#gopartia#1;
;
" ", "     ", 000001, 001, 001;
"z", "zzzzz", 999999, 999, 999;
be;
NULL, gopartia;
|FIN;

|PROCESO LinAlbar;

   #agifa077#50 = #agifa080#27;
   #agifa077#0  = #agifa080#0;
   |LEE 000#agifa077.=;
   |SI FSalida ! 0; |ACABA; |FINSI;

   #gopartia#34 = "M";
   #gopartia#4 = #agifa080#27;
   #gopartia#5 = #agifa080#0;
   #gopartia#6 = #agifa080#1;
   |LEE 101#gopartia.=;
   |SI FSalida = 0;
      |HAZ CompruebaDatos;
      |SI nSwCambia = 1; |GRABA 020#gopartia.a; |FINSI;
      |LIBERA #gopartia;
   |SINO;
      #gopartia#34 = "C";
      #gopartia#4 = #agifa080#27;
      #gopartia#5 = #agifa080#0;
      #gopartia#6 = #agifa080#1;
      |LEE 101#gopartia.=;
      |SI FSalida = 0;
         |HAZ CompruebaDatos;
         |SI nSwCambia = 1; |GRABA 020#gopartia.a; |FINSI;
         |LIBERA #gopartia;
      |SINO;
         #godiacaj#32 = #agifa077#51;
         #godiacaj#33 = #agifa077#39;
         |LEE 000#godiacaj.=;
         |SI FSalida = 0;
            aTipo = "C";
         |SINO;
            aTipo = "M";
         |FINSI;

         |DDEFECTO #gopartia;
         #gopartia#34 = aTipo;
         #gopartia#4 = #agifa080#27;
         #gopartia#5 = #agifa080#0;
         #gopartia#6 = #agifa080#1;
         #gopartia#7 = 1;
         |GRABA 020#gopartia.b;

         #gopartia#20 = #agifa080#2;
         #gopartia#30 = #agifa080#4;
         #gopartia#17 = #agifa080#3;
         #guerw051#0 = #agifa080#3;
         |LEE 000#guerw051.=;
         |SI FSalida ! 0; |DDEFECTO #guerw051; |FINSI;
         #gopartia#18 = #guerw051#3;
         #gopartia#2  = #guerw051#1;
         #gopartia#3  = #guerw051#2;

         #gomantl1#0 = #gopartia#2;
         #gomantl1#1 = #gopartia#3;
         #gomantl1#2 = 1;
         |LEE 000#gomantl1.];
         |SI FSalida = 0; |Y #gomantl1#0 = #gopartia#2; |Y #gomantl1#1 = #gopartia#3;
            #gopartia#0  = #gomantl1#3;
            #gopartia#1  = #gomantl1#4;
         |FINSI;

         #gopartia#21 = #agifa077#56;
         #gopartia#28 = #agifa077#1;
         #gopartia#29 = "M";

         |HAZ CompruebaDatos;
         |GRABA 020#gopartia.a; |LIBERA #gopartia;
      |FINSI;
   |FINSI;
|FPRC;

|DEFBUCLE LinAlbar;
#agifa080#1;
;
INICIO;
FINAL;
;
NULL, LinAlbar;
|FIN;

|PROCESO Recalculo;
   |ABRE #agifa077; |ABRE #godiacaj;
   |ABRE #agifa080; |BUCLE gopartia; |CIERRA #agifa080;
   |ABRE #gopartia; |BUCLE LinAlbar; |CIERRA #gopartia;
   |CIERRA #agifa077; |CIERRA #godiacaj;
|FPRC;

|PROCESO VuelcaAlm;
   |DDEFECTO #guerw051;
   #guerw051#0 = #agifa029#0;
   #guerw051#3 = #agifa029#1;
   |GRABA 020#guerw051.n;
|FPRC;

|DEFBUCLE VuelcaAlm;
#agifa029#1;
;
INICIO;
FINAL;
be;
NULL,VuelcaAlm;
|FIN;

|RUTINA inf;
   #guerw051#0 = 1;
|FRUT;

|RUTINA sup;
   #guerw051#0 = 999999
|FRUT;

|PROGRAMA;
   |CLS;
   |CABEZA " Recalculo lineas albaran/gopartia";
   |PINPA #0#0;

   |DELINDEX #guerw051;
   aAlfa = "00" + Usuario; |NOME_DAT #guerw051#aAlfa#; |DELINDEX #guerw051;
   |ABRE #guerw051; |ABRE #gomantl1;
   |BUCLE VuelcaAlm;
   |ENTLINEAL #1#guerw051, 1, 1, 21, 1, inf, sup;

   aAlfa = "    N" + &191 + " Es correcto ? ";
   |CONFI aAlfa;
   |SI FSalida = 0;
      |HAZ Recalculo;
   |FINSI;
   |CIERRA #guerw051; |CIERRA #gomantl1;
|FPRO;
