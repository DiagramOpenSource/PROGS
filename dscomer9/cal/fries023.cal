|FICHEROS;
     fries023 #0;        || Lineas Adjudicacion
     fries022 #1;        || Cabecera Adjudicacion
     fries024 #124,MANTE;      || Aux
     fries018 #18;
     fries019 #19;
     agifa019 #4;        || Articulos
     agifa017 #5;        || Almacen
     agifa024 #6;        || Clientes
     agifa112 #9;        || Proveedores
     agifa215 #20;       || Temporal seleccion Articulos
     agifa007 #21;       || Series.
     dsm00024 #24;
     tempo081 #81;
     agifa321 #15;       || DIV - Parametros
     agifa324 #15;       || DIVISAS
     agifa142 #42;
     dsm00005 #905;
     dsm00010 #910;
     dsw00022 #922;      || Tmp Adj por Articulos Elemento
     dsm00046 #946;
     dsm00047 #947;
     dsm00234 #234;
     dsm00235 #235;
     dsm00246 #40;       ||Control Riesgo Por Usuarios.
     dsm00247 #41;       ||Pantalla Informe Riesgo.
     dsm00248 #43;
     dsm00020 #200;
     agifa553 #553;
     agis0002 #1000;
     referen@;
     agifa029 #29;
     dsm00238 #238;
     tagm0056@;
     dsw00083 #83; || Ordenacion Art/Alma/Part
     mecano@;
     dsm00279 #279;
|FIN;

|VARIABLES;
     aPend = "";
     nHay = 0;
     nPropuesta = 0;
     nSwPen = 0;
     aConte = "";
     nPreDtoAnt = 0;
     nUni = 0;
     &enMecaDeOrden = 0;
     &enModoCab210 = 0;
     nTagLinPedPos = 0;
     nTagDocPos = 0;
     nTagLinPos = 0;
     nTagIncPos = 0;
     aTagDesPos = "";
     nTagLinOrgPos = 0;
     nSali = 0;
     aPath = "";
     aTmp83 = "";
     aPartida = "";
     nUniAsig = 0;
     nUnidades = 0;
     c13 = 0;
     c44 = 0;
     aArti = "";
     nUni1 = 0;
     nUni2 = 0;
     nFactor = 0;
     nSal = 0;
     aModi = "";
     &c_clien       = "";
     &c_artic       = "";
     &c_serie       = "";
     &entrada       = 0;
     &enLinAuto = 0;
     &uni_dt = 0;   || Unidades
     &fed_dt = @;   || Fecha....
     &art_dt = "";  || Articulo.
     &cli_dt = "";  || Cliente..
     &fam_dt = "";  || Familia.
     &iva_dt = 0;   || Tipo Iva.
     &dtos_2 = 0;   || Descuento 2.
     &dto_pt = 0;   || Descuento Ptas.
     &dtos_1 = 0;   || Descuento 1.
     &pvp_ve = 0;   || Precio Venta.
     &tarifa = 0;   || Tarifa Cliente.
     &quedto = 0;   || 1=cli./art, 2=cli./familia, 3=cli./subfam.
     &gru_dt = "";  || Grupo Cliente.
     &nPromo = 0;
      verpre = "";
     &enMensaje = 0;
     &aParam    = "";

     &enDto = 0;
     &enNumero = 0;
     &enEsCto = 0;
     nImporDescue1 = 0;
     nImporDescue2 = 0;
     nImporDescue3 = 0;
     nImporMoneda1 = 0;
     nImporMoneda2 = 0;
     nBrutoMoneda1 = 0;
     nBrutoMoneda2 = 0;
     &enUniTagRes = 0;
     &enCliAdj = "";
     &enSwMenu = 0;
     nSwSirveArt = 0;
     nLinV          = 0;
     &enUniKit      = 0;
     nSwServida     = 0;
     nModo          = 0;
     &nDispoKit     = 0;
     &Nopregunta    = 0;
     &nPed_baja     = 0;
     &aSer_baja     = "";
     &nLin_baja     = 0;
     articulo = "";
     &enDescuento1 = 0;
     &enDescuento2 = 0;
     &eaTComision = "";
     &enComision = 0;
     &eaCliPlb = "";
     &enObraPlb = 0;
     &eaTipoPlb = "";
     &eaArticuloHor = "";
     nGuardaPrecio = 0;
     nObra = 0;
     aTipoEmp = "";
     aSerie = "";
     aLetra = "";

     nRiePed = 0; DLinea = 0; HLinea = 0;

     nCalc = 0;
     nImpAd = 0;

     nEsKit         = 0;
     nConAu         = 0;
     &nMasRies      = 0;
     nTries         = 0;
     nAudito        = 0;
     aUs            = "";
     &Tempo         = "";
     aTempo81       = "";
     &eaTempo020    = "";
     &eaTempo922    = "";
     nDesprecia     = 0;
     aMensa         = "";
     aObs           = "";
     &eaTag         = "";
     nMult          = 0;
     &nImpo         = 0;
     mes            = 0;
     &enTipo        = 0;
     &aSerAntes     = "";
     &nNumAntes     = 0;
     aPtec          = "";
     nPtec          = 0;
     nPrecio        = 0;
     nLin           = 0;
     nNume          = 0;
     nForma         = 0;
     nCampo         = 0;
     aAlfa          = "";
     nTecla         = 0;

     &ser_alb        = "";
     &num_alb        = 0;
     &enLineaAlb     = 0;
     &enSwPanta      = 1;
     &enPedCab       = 0;
     &ser_ped        = "";
     &num_ped        = 0;
     &lin_ped        = 0;

     &nDeci_Base     = 0;   || Decimales en Totales de la moneda base
     &nDeci_PreBase  = 0;   || Decimales en el Precio en moneda base
     &nDeci_BaseMx   = 0;   || Decimales en Totales de la moneda base (Maxima precision)
     &nDeci_PreBaseMx= 0;   || Decimales en el Precio en moneda base (Maxima precision)
     &nDeci_Div      = 0;   || Decimales en Totales de la divisa
     &nDeci_PreDiv   = 0;   || Decimales en el Precio en divisa
     &nDeci_TotVis   = 0;   || Decimales en Totales visibles (el de la moneda de trabajo)
     &nDeci_TotNoVis = 0;   || Decimales en Totales no visibles (el de la otra moneda)
     &nDeci_PreVis   = 0;   || Decimales en el Precio visual. (lineas)
     &nDeci_ImpVis   = 0;   || Decimales en el Importe visual. (lineas)
     &nDeci_BaseMxP  = 0;   || Decimales en Totales de la moneda base (Maxima precision)
     &nDeci_PreBasMxP= 0;   || Decimales en el Precio en moneda base (Maxima precision)
     &nDeci_DivP     = 0;   || Decimales en Totales de la divisa
     &nDeci_PreDivP  = 0;   || Decimales en el Precio en divisa
     &nDeci_TotVisP  = 0;   || Decimales en Totales visibles (el de la moneda de trabajo)
     &nDeci_TotNoVisP= 0;   || Decimales en Totales no visibles (el de la otra moneda)
     &nDeci_PreVisP  = 0;   || Decimales en el Precio visual. (lineas)
     &nDeci_ImpVisP  = 0;   || Decimales en el Importe visual. (lineas)
     tecla      = "";
     &ac_divisa = ""; ||
     mensa      = ""; || Linea de visualizacion
     &pintado   = 0;|| Controla el pintado de mensa para que solo lo haga 1 vez
     titdiv = "";   || Encabezado de precio e imp. con la divisa "Imp.Tot(USD)"
     aprograma = "";
     vcontrol       = "";
     &Envase    = "";
     &Unidades1 = 0;
     &Unidades2 = 0;
     &VArticulo = "";
     &qAbono    = "";

     sw_adjf1       = 0;
     asto           = 0;
     tuni           = 0;
     a              = 0;
     b              = 0;
     operacion      = "";
     operainte      = "";
     inkey          = 0;
     &act_ent       = "N";
     &correcto      = "N";
     &fichero       = "";
     &cliente       = "";
     &serv_art      = "N";
     &programa      = "agifa210";
     servir         = "N";
     fmes           = "";
     fiac           = "  ";
     guarda         = "  ";
     relleno        = "                                       ";
     aponer         = "  ";
     mensaje        = "";
     &n_dec         = 0;
     &n_pre         = 0;
     &sw_modo       = 0;
     modo           = 0;
     i              = 0;
     linea          = 0;
     cantidad       = 0;
     importe        = 0;
     &serie         = "";
     &pedido        = 0;
     &lineap        = 0;
     &codigo        = "";
     &descrip       = "";
     &unid          = 0;
     &Cliente = "";
     &SPedido = "";
     &NPedido = 0;
     &PPedido = "";
     &FPedido = @;
     &TPedido = 0;
     &BAdela  = 0;
     &TipoCta = "A";
     &ser           = "";
     &doc           = 0;
     abono          = 1;

     l1_inf         = "";
     l1_sup         = "";
     &ser_ped_inf   = ""; ||Serie (inf. y sup.) del pedido que pasaremos
     &ser_ped_sup   = ""; ||al defbucle de agit0001
     fich           = "";

     aDespreciar    = "";
     aPedCompleto   = "N";
     nPendiente     = 0;
     nPendiente2    = 0;
     nPorArticulo   = 0;
     nSoloEstas1    = 0;
     nSoloEstas2    = 0;
     &nRieUtili     = 0;
     &nRieTotal     = 0;

     &qArti         = "";
     &qUnid         = 0;

     importeD      = 0;
     nImpDiv        = 0;
     nSw = 0;
|FIN;

|INCLUYE i_varart;

|PROCESO DefSer211; |TIPO 7;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 1;
          #0#31 = #0#29;
          |SI #agifa142#185 = "S"; #0#31 = #agifa142#186; |FINSI;
     |FINSI;
|FPRC;

|PROCESO licogea; |TIPO 0;
     sw_adjf1 = 0;
     aPedCompleto = "N";
     modo = (FEntrada / 100) ! 0;
     articulo = #0#2;

     |ABRE #124;
     #124#0 = #0#29;
     #124#1 = #0#0;
     #124#2 = #0#1;
     |LEE 101#124=;
     |SI modo = 1;
          #124#3 = 0;
          |SI FSalida ! 0; |GRABA 020#124b; |FINSI;
        |ET Otra;
          |ENCAMPO #3#124;
          |SI FSalida = 10;   ||F2
               |HAZ PropuPend;
               |SI nPropuesta = 0; |VETE Otra; |FINSI;
               #124#3 = nPropuesta;
          |FINSI;
          |SI FSalida ! 0; |ERROR; |ACABA; |FINSI;
          |GRABA 020#124a;

          |SI #124#3 ! 0;|HAZ Liadju; |FINSI;

          |SI nNumAntes ! 0;
               #0#31 = aSerAntes; |PINTA #0#31;
               #0#12 = nNumAntes; |PINTA #0#12;
          |FINSI;

          |SI #124#3 = 0;
               |C_M #0#2  , 1 , "S";
               |C_M #0#3  , 1 , "S";
               |C_M #0#4  , 1 , "S";
               |C_M #0#10 , 1 , "S";
               |C_M #0#27 , 1 , "S";
               |C_M #0#11 , 1 , "S";
               |C_M #0#5  , 1 , "S";
               |SI #1#70 = "B";
                    |C_M #0#6  , 1 , "S";
               |SINO;
                    |C_M #0#36 , 1 , "S";
               |FINSI;
               |C_M #0#8  , 1 , "S";
               |C_M #0#33 , 1 , "S";
          |SINO;
               |C_M #0#2  , 1 , "N";
               |C_M #0#3  , 1 , "N";
               |C_M #0#4  , 1 , "N";
               |C_M #0#10 , 1 , "N";
               |C_M #0#27 , 1 , "N";
               |C_M #0#11 , 1 , "N";
               |C_M #0#5  , 1 , "N";
               |SI #1#70 = "B";
                    |C_M #0#6  , 1 , "N";
               |SINO;
                    |C_M #0#36 , 1 , "N";
               |FINSI;
               |C_M #0#8  , 1 , "N";
               |C_M #0#33 , 1 , "N";
          |FINSI;
          |C_M #0#28 , 1 , "N";
     |SINO;
          |C_M #0#12 , 1 , "N";
          |C_M #0#21 , 1 , "N";
          |C_M #0#31 , 1 , "N";
          |SI #124#3 = 0;
               |C_M #0#2  , 1 , "S";
               |C_M #0#3  , 1 , "S";
          |SINO;
               |C_M #0#2  , 1 , "N";
               |C_M #0#3  , 1 , "N";
          |FINSI;
          |C_M #0#4  , 1 , "S";
          |SI #0#2 = "                    ";
               |C_M #0#5  , 1 , "N";
               |SI #1#70 = "B";
                 |C_M #0#6  , 1 , "N";
               |SINO;
                 |C_M #0#36 , 1 , "N";
               |FINSI;
               |C_M #0#8  , 1 , "N";
               |C_M #0#10 , 1 , "N";
               |C_M #0#11 , 1 , "N";
               |C_M #0#27 , 1 , "N";
               |C_M #0#28 , 1 , "N";
               |C_M #0#33 , 1 , "N";
          |SINO;
               |C_M #0#5  , 1 , "S";
               |SI #1#70 = "B";
                 |C_M #0#6  , 1 , "S";
               |SINO;
                 |C_M #0#36 , 1 , "S";
               |FINSI;
               |C_M #0#8  , 1 , "S";
               |C_M #0#10 , 1 , "S";
               |C_M #0#11 , 1 , "S";
               |C_M #0#27 , 1 , "S";
               |C_M #0#28 , 1 , "S";
               |C_M #0#33 , 1 , "S";
          |FINSI;
     |FINSI;
     |CIERRA #124;
|FPRC;

|PROCESO liadju; |TIPO 0;
|FPRC;

|PROCESO CtrlStock;
|FPRC;

|PROCESO ActuaResto;
     #1#41 = #1#41 +. 1;
     nForma = 0 +. 1;

     |ABRE #4;
     |ABRE #6;
     |ABRE #9;

     |HAZ lee_arti;
     |HAZ lee_clien;

     importe = ((((#0#9 < #1#5) < #1#32) < #1#7));

     #6#50 = #6#50 +. importe;
     |GRABA 021#6a;
     |CIERRA #6;
     |CIERRA #4;
     |CIERRA #9;

     |HAZ actua_cabe;

     enImpCliPen = importe * nForma;
     eaCliente = #1#3;
     efFecha = #1#1;
     |HAZ AcumulaCli;
|FPRC;

|PROCESO poncontr211;
         fiac = Control % A109;
         fiac = fiac + relleno;
         guarda = fiac % A109;
         fiac = Control % A1001;
         Control = Control + fiac;
         Control = Control + relleno;
         Control = Control % A120;
         Control = Control + aponer;
|FPRC;

|PROCESO MiraSerie; |TIPO 0;
     |SI #42#127 = "S"; |Y #1#52 ! #0#31;
          |MENAV "0000Las series Albaran/Pedido no se Corresponden";
          |ERROR;
          |ACABA;
     |FINSI;
|FPRC;

|PROCESO que_art; |TIPO 6;
|FPRC;

|PROCESO Envase211;
     qAbono    = "N";
     Envase    = #0#34;
     Unidades1 = #0#35;
     Unidades2 = #0#5;
     VArticulo = #0#2;
     enAlmacen = #0#3;
     eaTipo = "V";
     eaProgEnv = "albaran";
     |HAZ EntraEnvase;
     #0#34 = Envase;
     #0#35 = Unidades1;
     #0#5  = Unidades2;  |PINTA #0#5;
|FPRC;

|PROCESO Conver211;  |TIPO 7;
/*
     |HAZ DobleUniV;
     |SI eaSw2Stock = "S";
          |C_M #0#5, 1, "N";
     |FINSI;
     |SI #agifa142#72 = "S";
          |HAZ Envase211;
          |C_M #0#5, 1, "S";
          |SI enEntraEnvase ! 0;  |C_M #0#5, 1, "N";  |FINSI;
     |FINSI;
*/
|FPRC;

|PROCESO ControlDispo;
|FPRC;

|PROCESO mas_o_menos; |TIPO 0;          ||Verifico si estoy sirviendo mas o
                                        ||menos de lo pedido

     |HAZ TotalLin71;
|FPRC;

|PROCESO BorraHistoDespreciar;
     |DFICE aAlfa; aAlfa = aAlfa % -205;

     |ABRE #235;
     #235#0 = aAlfa;
     #235#1 = #0#29;
     #235#2 = #0#0;
     #235#3 = #0#1;
     |BORRA 101#235c;
     |CIERRA #235;
|FPRC;

|PROCESO liacarti; |TIPO 2;
     |ABRE #42; |LEE 000#42p; |CIERRA #42;
     modo   = (FEntrada / 100) ! 0;
     nForma = 0 +. 1;

     || Si es en modo de baja a todos los efectos es como si no fuera
     || completo
     |SI modo = 2;|O modo = 3;
          efFec = #1#1;
          enAlma = #0#3;
          |HAZ MiraHisL;
          |SI enErrHis ! 0;
               |ERROR;
               |ACABA;
          |FINSI;
     |FINSI;

     enForma = 0 +. 1;
     eaProgVta = "agifa010";
     |HAZ AcumulaAV;
     ||컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
     enTipEnvase = 2;
     |HAZ Envase211;

     |ABRE #6;
     |ABRE #4;
     |HAZ ActualizaCliente;
     |CIERRA #4;
     |CIERRA #6;

     |SI modo = 3;
          ||컴컴컴컴컴컴컴컴컴컴
          aTipoDA = "A"; |HAZ BajaDA;
          ||컴컴컴컴컴컴컴컴컴컴

          ||컴컴컴컴컴컴컴컴컴컴컴
          |HAZ BorraKit;
          ||컴컴컴컴컴컴컴컴컴컴컴
          |ABRE #124;
          #124#0 = #0#29;
          #124#1 = #0#0;
          #124#2 = #0#1;
          |LEE 101#124 =;
          |SI FSalida = 0;
               |ABRE #19;
               #19#0 = #124#3;
               #19#1 = #124#4;
               |LEE 101#19=;
               |SI FSalida = 0;
                    #19#12 = "N";
                    |GRABA 020#19a;
               |FINSI;
               |CIERRA #19;
               |BORRA 020#124a;
          |FINSI;
          |CIERRA #124;
     |FINSI;
|FPRC;

|PROCESO ActualizaCliente;
     #4#0 = #0#2;
     |LEE 020#4=;

     #6#0 = #0#15;
     |LEE 121#6=;
     |SI 0 = FSalida;
          importe = ((((#0#9 < #1#5) < #1#32) < #1#7));
          #6#50 = #6#50 + (importe * nForma);
          |GRABA 020#6a;
          |LIBERA #6;
     |FINSI;
|FPRC;

|PROCESO actua_cabe;
     |HAZ CalCabAgifa010;

     |HAZ pantcomp2;
|FPRC;

||__________________________________________/ ACTUALIZACIONES

|RUTINA lee_arti;
     #4#0 = #0#2;
     |LEE 101#4=;
     |SI FSalida ! 0;
          |DDEFECTO #4;
          #4#0 = #0#2;
          #4#1 = #0#4;
          |GRABA 021#4b;
     |FINSI;
     |LIBERA #4;
|FRUT;

|RUTINA lee_clien;
     #6#0 = #0#15;
     |LEE 101#6=;
     |SI FSalida ! 0;
          |DDEFECTO #6;
          #6#0 = #0#15;
          |GRABA 021#6b;
     |FINSI;
|FRUT;

_____________________________________/ ACTUALIZA EL HISTORICO DE MOVIMIENTOS.
|CALCULO miraques;|TIPO 0;
     |SI #1#43 = AN;
          a = -1; b = 1;
          operacion = "AV";
          operainte = "AC"; || Si es una Serie Interna
     |SINO;
          a = 1;  b = -1;
          operacion = "BV";
          operainte = "BC"; || Si es una Serie Interna
     |FINSI;
|FCAL;

|PROCESO decimal; |TIPO 0;
     #0#5 = #0#5 ! n_dec;
     |PINTA #0#5;
|FPRC;

|PROCESO Mini; |TIPO 0;
     |SI FSalida = 5;
          enTipEnvase = 1;
          |HAZ Envase211;
     |FINSI;

     |SI #0#5 [ 0; |ACABA; |FINSI;
     qArti = #0#2;
     qUnid = #0#5;
     |HAZ ComproMin;
     |SI enErr ! 0;
          |ERROR;
     |FINSI;
|FPRC;

|PROCESO a_cta;|TIPO 11;
     nModo = (FEntrada / 100) ! 0;
     nTecla = FSalida;

     |SI nTecla = 13;         || F5
          |HAZ VerKit;
          |HAZ VerDobleUniV;
          |ERROR; |ACABA;
     |FINSI;

     |SI nTecla = 10;
         ser_ped = #0#31;
         num_ped = #0#12;
         lin_ped = #0#21;

         |SUB_EJECUTA_NP "dsy00002";
         |ERROR;
         |ACABA;
     |FINSI;

     aAlfa = #0#2; |QBF aAlfa;
     |SI nTecla = 16; |Y aAlfa ! "";
          |SI #42#202 = "S"; |O #42#40 = "S";
               aTipoDA = "A"; |HAZ VerDA;
          |FINSI;
          |ERROR;
     |FINSI;

     |SI nTecla =  9;
       |SI #42#86 = "S";
          TipoCta = "P";
          Cliente = #0#15;
          SPedido = #0#31;
          NPedido = #0#12;
          FPedido = #1#1;
          PPedido = #1#8;
          TPedido = 0;
          BAdela  = 0;
          |SUB_EJECUTA_NP "agis0002";
          |BLIN 24;
          |CONFI "2400NDesea imprimir el recibo? ";
          |SI FSalida = 0;
               ser = SPedido;
               doc = NPedido;
               eaDivisa = #1#68;
               |HAZ ImpreACta;
           |FINSI;
           |ERROR;
        |SINO;
           |MENAV "    Entregas a cuenta desactivadas";
           |ERROR;
        |FINSI;
     |FINSI;
|FPRC;

|CALCULO pantcomp2;|TIPO 13;
     |HAZ visual_totales2; || Visualiza los totales

     |ATRI I;
     |HAZ LeePropuesta;
     |PINTA 1304, #124#3;
|FCAL;

|PROCESO decim2;
     |SI Campo = 6; |O Campo = 36;
          |SI FSalida = 14;             || F6
               c_clien = #1#3;
               c_artic = #0#2;
               c_serie = #1#52;
               entrada = 1;
               |SUB_EJECUTA_NP "agifa283.run";
               |ERROR;
          |FINSI;
     |FINSI;
     |SI #1#70 = "D";  || Si la moneda de trabajo es la divisa ...
         #0#6 = #0#36 / #1#69 * #1#74;  || ... recalculo en funcion de la divisa
     |SINO;
         #0#36 = #0#6 / #1#74 * #1#69; || .. recalculo en funcion de la moneda base
     |FINSI;
|FPRC;

|PROCESO Alma7_211; |TIPO 7;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 1;
          |ABRE #21;
          #21#26 = #0#29;
          |LEE 000#21=;
          |CIERRA #21;
          #0#3 = #21#29;
     |FINSI;
|FPRC;

|PROCESO LinDiv7;  |TIPO 7;
     |ABRE #42; |LEE 000#43p; |CIERRA #42;

     |ABRE #279; |LEE 000#279p; |CIERRA #279;
     nPreDtoAnt = 0;

     nModo = (FEntrada / 100) ! 0;
     |MENSA "0000<F8>DA.";
     |HAZ PintaMedidaV;
     ||컴컴컴컴컴컴컴컴컴
     |ABRE #agifa321;
     |LEE 001#agifa321.p;  || Leo parametros de divisa
     |SI ac_divisa = "S"; |Y pintado = 0; || Si divisas estan activadas y no he pintado ...
       |SI #1#70 = "D";   || Si la moneda de trabajo es la divisa la pinto en
         |ATRI R;         || el encabezado del precio y el importe
         titdiv = "Precio" + "(" + #1#68 + ")";
         |PINTA 1444,titdiv;
         titdiv = "I.Tot." + "(" + #1#68 + ")";
         |PINTA 1468,titdiv;
         |ATRI r;
       |FINSI;
       |SI #agifa321#3 = "S";  || Si la visualizacion esta activada ...
         mensa = "Precio:            Imp.:              T.Bruto:             T.ALB:             ";
         |PINTA 1102,mensa;  || ... pinto la linea de visualizacion
         |PINTA #0#38; || Pinto precio visual
         |PINTA #0#39; || Pinto importe visual
         |SI #1#70 = "D"; || Si la moneda de trabajo es la divisa
           |PINTA 1149,#1#79;
           |PINTA 1168,#1#80;
         |SINO;
           |PINTA 1149,#1#75;
           |PINTA 1168,#1#76;
         |FINSI;
         pintado = 1;  || Ya hemos pintado
       |FINSI;
     |FINSI;
     |CIERRA #agifa321;

     |SI nModo = 1;
          #0#1 = #0#1 + #agifa142#236 - 1;
     |FINSI;

     |HAZ pantcomp2;
|FPRC;

|PROCESO visual_precio2; || Pinta el precio visual.
|SI #1#70 = "D";  || Si la moneda de trabajo es la divisa ...
  #0#38 = #0#6;   || ... el campo visualiz. es el precio en moneda base
  |PINTA #0#36;
|SINO;            || Si la moneda de trabajo es la moneda base ...
  #0#38 = #0#36;  || ... el campo visual. es el precio en divisa
  |PINTA #0#6;
|FINSI;
|SI ac_divisa = "S"; |Y #agifa321#3= "S";
  |PINTA #0#38; || Si las divisas y la visualizacion estan activadas, pinto
|FINSI;
|FPRC;


|PROCESO visual_importe2;  || Pinta el importe visual
|SI #1#70 = "D";  || Si la moneda de trabajo es la divisa ...
  #0#39 = #0#9;   || el campo visualiz. es el importe en moneda base
  |PINTA #0#37;
|SINO;            || Si la moneda de trabajo es la moneda base ...
  #0#39 = #0#37;  || el campo visualiz. es el importe en divisa
  |PINTA #0#9;
|FINSI;
|SI ac_divisa = "S"; |Y #agifa321#3= "S";
  |PINTA #0#39;   || Si las divisas y la visualizacion estan activadas, pinto
|FINSI;
|FPRC;

|PROCESO visual_totales2;
     |ABRE #agifa321;
     |LEE 001#agifa321.p;
     |SI #1#70 = "D";
          |SI ac_divisa = "S"; |Y #agifa321#3= "S";
               |PINTA 1149,#1#79;
               |PINTA 1168,"        ";
               |PINTA 1168,#1#80;
          |FINSI;
          |CIERRA #agifa321;
          |PINTA 1355,#1#75;
          |PINTA 1368,#1#76;
     |SINO;
          |SI ac_divisa = "S"; |Y #agifa321#3= "S";
               |PINTA 1149,#1#75;
               |PINTA 1168,"        ";
               |PINTA 1168,#1#76;
          |FINSI;
          |CIERRA #agifa321;
          |PINTA 1355,#1#15;
          |PINTA 1368,#1#67;
     |FINSI;
|FPRC;

|PROCESO AgeTrans;
     |ABRE #200;
     #200#0 = #1#88;
     |LEE 000#200=;
     |CIERRA #200;

     #1#9 = #200#1;
|FPRC;

|PROCESO comp_div; |TIPO 0;
     nModo = (FEntrada / 100) ! 0;
|FPRC;

|PROCESO Llena211; |TIPO 6;
     nTecla = FSalida;
     aConte = Contenido;

     |ABRE #4;
     #4#0 = #0#2;
     |LEE 000#4=;
     |SI FSalida ! 0;
          eaArticulo = #0#2;
          |SUB_EJECUTA_NP "dsz99912;ARTI";
          |SI enSalida ! 0; |ERROR; |ACABA; |FINSI;
     |FINSI;
     |CIERRA #4;

     |SI #124#3= 0; || Sin Pedido
          |C_M #0#3, 1, "S";
          |SI #0Campo ! aConte;
               eaArticulo = #0#2;
               eaCliente = #1#3;
               |HAZ DefectoMediV;
               #0#51 = enMedida1;
               #0#52 = enMedida2;
               #0#53 = enMedida3;
               |HAZ PintaMedidaV;
          |FINSI;
          |HAZ DobleArtiV;
          |SI eaSw2Stock = "S"; |ACABA; |FINSI;
     |SINO;
          |C_M #0#3, 1, "N";
     |FINSI;
     eaArticulo = #0Campo;
     |HAZ LlenaArticulo;
     |SI FSalida = 0;
          #0Campo = eaArticulo;
          |PINTA #0Campo;
     |SINO;
          |ERROR; |ACABA;
     |FINSI;
     FSalida = nTecla;
|FPRC;

|PROCESO PideArt211;  |TIPO 7;
     |SI #124#3 ! 0; |ACABA; |FINSI;

     |C_M #0#2, 1, "S";
     |C_M #0#3, 1, "N";

     |SI #0#2 ! "                    ";
         |ABRE #4;
         #4#0 = #0#4;
         |LEE 000#4=;
         |SI FSalida ! 0;  |DDEFECTO #4;  |FINSI;
         |CIERRA #4;
         |SI #4#176 = "S";
             |C_M #0#2, 1, "N";
             |C_M #0#3, 1, "N";
             |ACABA;
         |FINSI;
     |FINSI;

     |ABRE #910;
     |LEE 040#910p;
     |SI FSalida ! 0;  |DDEFECTO #910;  |FINSI;
     |CIERRA #910;

     |SI #910#2 [ 2;    |ACABA;  |FINSI;

     eAlfa = #0Campo;
     |SUB_EJECUTA_NP "dsz99990";                 || Por Pantalla

     |SI eAlfa = "-1";  |PTEC 807;  |ACABA;  |FINSI;
     |SI eAlfa = "-2";              |ACABA;  |FINSI;

     eaArticulo = eAlfa;      ||  700000-4215

     #0Campo = eAlfa;
     |PINTA #0Campo;
     |PTEC 802;
|FPRC;

|PROCESO Tipo7Uni;  |TIPO 7;
|FPRC;

|PROCESO Tipo11211;  |TIPO 11;
|FPRC;

|PROCESO VerAumento;
     |SI #agifa142#22 ! "P";
          |ACABA;
     |FINSI;

     |ABRE #40;
     aUs = Usuario % 0810;
     #40#0 = "A";
     #40#1 = aUs;
     |LEE 000#40=;
     |SI FSalida ! 0;
          |CIERRA #40;
          |ACABA;
     |FINSI;
     |CIERRA #40;

     |DDEFECTO #41;
     #41#0 = nRieTotal;
     #41#1 = nRieUtili;
     #41#2 = #40#2;
     #41#5 = nRieUtili;
     #41#3 = (nRieTotal % #40#2);
     #41#4 = #40#3;
     |SI #41#3 < #41#4;|Y #41#3 ! 0;
          #41#6 = nRieTotal + #41#3;
          nMasRies  = #41#3;
     |SINO;
          #41#6 = nRieTotal + #41#4;
          nMasRies  = #41#4;
     |FINSI;

     |SI #41#6 [ #41#5;
          #41#7 = "DENEGADA ";
          nMasRies = 0;
     |SINO;
          #41#7 = "PERMITIDA";
          |ABRE #43;
          |LEE 000#43u;
          |SI FSalida = 0;
               nConAu = #43#0 + 1;
          |SINO;
               nConAu = 1;
          |FINSI;
          |DDEFECTO #43;
          #43#0 = nConAu;
          #43#12 = "ALBARAN";
          #43#1 = #1#52;
          #43#2 = #1#0;
          #43#3 = #1#1;
          #43#4 = #1#3;
          #43#5 = #1#4;
          #43#6 = aUs;
          #43#7 = nRieTotal;
          #43#8 = nRieUtili;
          #43#9 = #41#2;
          #43#10= #41#3;
          #43#11= #41#4;
          |GRABA 020#43n;
          |CIERRA #43;
     |FINSI;

     nRieTotal = #41#6;
|FPRC;

|PROCESO Tipo5_211;  |TIPO 5;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo ! 4;
          |HAZ actal;
     |FINSI;
|FPRC;

|PROCESO Dto211; |TIPO 0;
     |HAZ TotalLin71;
     ||컴컴컴컴컴컴컴컴컴
     eaArticulo = #0#2;
     enPrecio = #0#6;
     enDto1 = #0#8;
     enDto2 = #0#33;
     |HAZ CheqPCM_PVP;

     |SI #279#3 = "S";
          eaArticulo = #0#2;
          enPrecio = #0#6;
          enDto1 = #0#8;
          enDto2 = #0#33;
          nNume =  (enPrecio < enDto1) < enDto2;
          |SI nNume ! nPreDtoAnt;
               |SUB_EJECUTA_NP "dsz00100";
               |SI enError ! 0; |ERROR; |ACABA; |FINSI;
               nPreDtoAnt = nNume;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO BseguiAdj;
|FPRC;

|PROCESO MinC211;
     #referen@#29 = #1#52;
     #referen@#0 = #1#0;
     #referen@#1 = 001;
|FPRC;

|PROCESO MaxC211;
     #referen@#29 = #1#52;
     #referen@#0 = #1#0;
     #referen@#1 = 999;
|FPRC;

|PROCESO Consulta071; |TIPO 66;
     nLin = 0;
     |DDEF aAlfa;
     aAlfa = aAlfa + "fries023";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          |CONSULTA_F_CLAVE #1#referen@, MinC211, MaxC211;
          |SI FSalida = 0; nLin = #referen@#1; |FINSI;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
     |SI nLin ! 0;
          |PTEC 802;
          aAlfa = ("000" + nLin) % -103;
          aPtec = aAlfa % 301; nPtec = &aPtec;
          |PTEC nPtec;
          aPtec = aAlfa % 201; nPtec = &aPtec;
          |PTEC nPtec;
          aPtec = aAlfa % 101; nPtec = &aPtec;
          |PTEC nPtec;
     |FINSI;
|FPRC;

|PROCESO PintaLinArt;
     |ABRE #4;
     #4#0 = #0#2;
     |LEE 000#4=;
     |CIERRA #4;
     |DDEFECTO #553;
     |ABRE #553;
     #553#0 = #4#125;
     |LEE 000#553=;
     |CIERRA #553;
     |PINTA 2302, #553#1;
|FPRC;

|PROCESO Arti0_211; |TIPO 0;
|FPRC;

|PROCESO MinAlma211;
     #5#0 = #0#2;
     #5#1 = 1;
|FPRC;

|PROCESO MaxAlma211;
     #5#0 = #0#2;
     #5#1 = 99999;
|FPRC;

|PROCESO Alma6_211; |TIPO 6;
     |ABRE #5;
     #5#0 = #0#2;
     #5#1 = #0#3;
     |LEE 000#5=;
     |SI FSalida ! 0;
          eaArticulo = #0#2;
          enAlmacen = #0#3;
          |SUB_EJECUTA_NP "dsz99912;ALMA";
          |SI enSalida ! 0; |ERROR; |ACABA; |FINSI;
     |FINSI;
     |CIERRA #5;
|FPRC;

|PROCESO Alma0_211; |TIPO 0;
     |SI FSalida = 13; || F5;
          |ABRE #5;
          #5#0 = #0#2;
          #5#1 = #0#3;
          |LEE 000#5];
          |CONSULTA_F_CLAVE #1#5, MinAlma211, MaxAlma211;
          |SI FSalida = 0;
               #0#3 = #5#1; |PINTA #0#3;
          |SINO;
               |ERROR; |ACABA;
          |FINSI;
          |CIERRA #5;
     |FINSI;

     |SI #0#12 = 0; |Y #0#21 = 0; || Sin pedido
          |HAZ PrecioArti;
     |FINSI;
|FPRC;

|PROCESO PrecioArti;
     |ABRE #6;
     #6#0 = #1#3;
     |LEE 020#6=;
     |CIERRA #6;
     |ABRE #4;
     #4#0 = #0#2;
     |LEE 000#4=;
     |CIERRA #4;

     #0#15 = #1#3;
     #0#13 = #4#2;

     modo = (FEntrada / 100) ! 0;
     fed_dt = #1#1;   || Fecha....
     art_dt = #0#2;   || Articulo.
     cli_dt = #0#15;  || Cliente..
     fam_dt = #0#13;  || Familia.
     iva_dt = #4#30;  || Tipo Iva.
     dtos_2 = 0;      || Descuento 2.
     dto_pt = 0;      || Descuento Ptas.
     dtos_1 = 0;      || Descuento 1.
     pvp_ve = 0;      || Precio Venta.
     tarifa = #6#39;  || Tarifa Cliente....
     gru_dt = #6#158; || Grupo Cliente.
     nPromo = #1#89;
     |SI #0#35 ! 0;
          uni_dt = #0#35;
     |SINO;
          uni_dt = #0#5;
     |FINSI;
     enMensaje = 0;
     aParam = "";
     eaSerie = #0#29;
     enDirEnt = #1#84;
     enAlmacen = #0#3;
     |SI modo = 1; |O articulo ! #0#2;
          |SI #4#176 = "S";  enMensaje = 1;  |FINSI;
          |HAZ calcdtos;              || Calculo Dtos.....
          #0#6   = pvp_ve - dto_pt;   || Precio Venta. sin iva.
          #0#8   = dtos_1;            || 1 Dto.
          #0#33  = dtos_2;            || 2 Dto.
          |HAZ decim2;
          |PINTA #0#6;
          |PINTA #0#33;
          |PINTA #0#8;

          enDescuento1 = #0#8;
          enDescuento2 = #0#33;
          eaTComision  = #0#16;
          eaCliente    = #1#3;
          eaArticulo   = #0#2;
          eaRepre      = #1#6;
          efFecha      = #1#1;
          enDirEnt = #1#84;
          enAlmacen = #0#3;
          |HAZ Comisiones;

          ||컴컴컴컴컴컴컴횺arhuenda
          |HAZ ComiMarhu;
          #0#8 = enDescuento1;
          #0#10 = enComision;
          #0#6 = pvp_ve - dto_pt;   || Precio Venta. sin iva.
          ||컴컴컴컴컴컴컴컴컴컴컴컴
          |PINTA #0#10;
          |PINTA #0#8;

     |FINSI;
|FPRC;

|PROCESO Alma211_66; |TIPO 66;
     |ABRE #29;
     #29#0 = #0#3;
     |LEE 000#29];
     |CONSULTA_CLAVE #1#29;
     |SI FSalida = 0;
          #0#3 = #29#0;
          |PINTA #0#3;
     |SINO;
          |ERROR;
     |FINSI;
     |CIERRA #29;
|FPRC;

|PROCESO EntraDes211; |TIPO 7;
|FPRC;

|PROCESO SalDes211; |TIPO 0;
     nSal = FSalida;
|FPRC;



|PROCESO T211_6_0; |TIPO 0;
     |SI #279#3 = "S";
          eaArticulo = #0#2;
          enPrecio = #0#6;
          enDto1 = #0#8;
          enDto2 = #0#33;
          nNume =  (enPrecio < enDto1) < enDto2;
          |SI nNume ! nPreDtoAnt;
               |SUB_EJECUTA_NP "dsz00100";
               |SI enError ! 0; |ERROR; |ACABA; |FINSI;
               nPreDtoAnt = nNume;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO SirvePro;
     |SI #19#12 = "S";
          |ACABA;
     |FINSI;
     linea = #0#1;
     |PARA FSalida = 0;  |SI FSalida = 0;  |HACIENDO ;
          |DDEFECTO #0;
          #0#29 = #1#52;       ||Serie
          #0#0 = #1#0;         ||Albaran
          #0#1 = linea;
          |LEE 000#0=;
          linea = linea + #42#236;
     |SIGUE;
     |DDEFECTO #4;
     #4#0 = #19#7;
     |LEE 000#4=;

     #0#2 = #19#7;
     #0#3 = 1;
     #0#4 = #19#8;
     #0#5 = #19#10;
     #0#6 = #19#9;
     #0#38 = #19#9;
     #0#11 = #4#30;
     #0#13 = #4#2;
     #0#15 = #1#3;
     #0#17 = #6#4;
     #0#49 = #19#6;

     |HAZ TotalLin71;

     eaProgVta = "agifa010";
     enForma = 1;
     nForma = 1;
     |HAZ AcumulaAV;
     #0#14 = enCoste;
     |GRABA 020#0n;

     |HAZ actua_cabe;

     |ABRE #6;
     |HAZ ActualizaCliente;
     |CIERRA #6;

     importe = ((((#0#9 < #1#5) < #1#32) < #1#7));
     enImpCliPen = importe * nForma;
     eaCliente = #1#3;
     efFecha = #1#1;
     |HAZ AcumulaCli;

     #19#12 = "S";
     |GRABA 020#19a;
     |LIBERA #19;

     #124#0 = #0#29;
     #124#1 = #0#0;
     #124#2 = #0#1;
     |LEE 101#124=;
     |SI FSalida ! 0; |GRABA 020#124b; |FINSI;
     #124#3 = nPropuesta;
     #124#4 = #19#1;
     |GRABA 020#124a;
     |LIBERA #124;
|FPRC;

|PROCESO MiraSirvePro;
     |SI #19#12 = "N";
          nSwPen = nSwPen + 1;
     |FINSI;
|FPRC;

|PROCESO Liadju; |TIPO 0;
     |SI FSalida = 2; |ACABA; |FINSI;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo ! 1; |ACABA; |FINSI;

     nPropuesta = #124#3;
     |ABRE #18;
     #18#0 = nPropuesta;
     |LEE 101#18=;
     |SI FSalida ! 0;
          |MENAV "0000No existe propuesta...";
          |ERROR;
     |SINO;
          nSwPen = 0;
          |BUCLELIN 2 MiraSirvePro #18;
          |SI nSwPen = 0;
               |MENAV "0000Propuesta ya servida...";
               |ERROR;
          |SINO;
               |ABRE #6;
               #6#0 = #1#3;
               |LEE 020#6=;
               |CIERRA #6;

               aponer = Asino;
               |HAZ poncontr211;
               |ABRE #4;
               |BUCLELIN 0 SirvePro #18;
               |CIERRA #4;

               aponer = Anosi;
               |HAZ poncontr211;
               |PTEC 816;
               |PTEC 812;
          |FINSI;
     |FINSI;
     |CIERRA #18;
|FPRC;

|PROCESO PropuPendiente;
     |SI aPend = "S";
          |SALVA_DATOS #18;
          |REPON_DATOS #referen@;
          |GRABA 020#referen@.n;
          nHay = 1;
     |FINSI;
|FPRC;

|PROCESO PropuLin;
     |SI #19#12 = "N";
          aPend = "S";
     |FINSI;
|FPRC;

|PROCESO PropuCab;
     aPend = "N";
|FPRC;

|DEFBUCLE PropuPendiente;
     #18#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, PropuCab, PropuLin, PropuPendiente;
|FIN;

|PROCESO PropuPend;
     nHay = 0;
     nPropuesta = 0;
     |DDEF aAlfa;
     aAlfa = aAlfa + "fries018";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          aAlfa = Usuario;
          |NOME_DAT #referen@#aAlfa#;
          |DELINDEX #referen@;
          |ABRE #referen@;
          |BUCLE PropuPendiente;
          |SI nHay ! 0;
               |LEE 000#referen@.p;
               |CONSULTA_CLAVE #1#referen@;
               |SI FSalida = 0;
                    nPropuesta = #referen@#0;
               |SINO;
                    nPropuesta = 0;
               |FINSI;
          |SINO;
               |MENAV "0000No hay propuestas pendientes...";
          |FINSI;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|PROCESO IVA023_66; |TIPO 66;
     enTiva = #0Campo;
     efFiva = #1#1;
     |HAZ ConsuIVA;
     |SI eaDiva = "";
          |ERROR;
     |SINO;
          #0Campo = enTiva; |PINTA #0Campo;
     |FINSI;
|FPRC;

|PROCESO IVA023_0; |TIPO 0;
     enTiva = #0Campo;
     efFiva = #1#1;
     |HAZ SacaIVA;
     |SI eaDiva = "";
          |MENAV "0000No existe tipo iva para esta fecha...";
          |ERROR; |ACABA;
     |FINSI;
|FPRC;
