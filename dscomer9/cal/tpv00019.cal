|FICHEROS;
     tpv00019 #0;  ||Este Def
     temp0019 #2;  ||Temporal Estadisticas.
     agifa501 #3;  ||Cabecera Tic.
     agifa502 #4;  ||Lineas T.
     agifa019 #5;  ||Articulos.
     agifa060 #6;  ||Familias.
     agifa007 #7;  ||Series.
     agifa505 #8;  ||Cajas.
     agifa514 #9;  ||Cajeros.
     agifa029 #29;
|FIN;


|VARIABLES;
     &enSwTotal = 0;
     &Tempo    = "";
     aSerAnt   = "";
     aTempo2   = "";
     total     = 0;
     i         = 0;
     j         = 0;
     diaSema   = "";
     f         = @;
     f_ini     = @;
     fichero   = "";
     informe   = "estaven";
     campo     = 0;
     dia       = @;
     mes       = @;
     ano       = @;
     diaAnt    = @;
     mesAnt    = @;
     anoAnt    = @;
     dfecha    = @;
     hfecha    = @;
     alfa      = "";
     alfa1     = "";
     beta      = 0;
     &impDia    = 0;
     &impSem    = 0;
     &impMes    = 0;
     &impAno    = 0;
     impDiaAnt = 0;
     impDiaSem = 0;
     impSemAnt = 0;
     impMesAnt = 0;
     impAnoAnt = 0;
     reg       = 0;
|FIN;

|PROCESO Impre;
     #29#0 = #2#15;
     |LEE 000#29=;
     |SI FSalida ! 0; |DDEFECTO #29; |FINSI;

     #5#0 = #2#1;    || Articulo.
     |LEE 000#5=;
     |SI FSalida ! 0; |DDEFECTO #5; |FINSI;
     #6#0 = #2#2;    || Familia.
     |LEE 000#6=;
     |SI FSalida ! 0; |DDEFECTO #6; |FINSI;

     #7#26 = #2#4;    || Serie.
     |LEE 000#7=;
     |SI FSalida ! 0; |DDEFECTO #7; |FINSI;
     #8#0 = #2#5;    || Caja.
     |LEE 000#8=;
     |SI FSalida ! 0; |DDEFECTO #8; |FINSI;
     #9#0 = #2#6;    || Cajero.
     |LEE 000#9=;
     |SI FSalida ! 0; |DDEFECTO #9; |FINSI;

     |SI aSerAnt ! #2#4; |Y aSerAnt ! "";
          |PIEINF;
     |FINSI;
     aSerAnt = #2#4;
     |PRINT;
|FPRC;

|DEFBUCLE articul;              || Lectura por Articulo.
     #2#2;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Impre;
|FIN;

|DEFBUCLE famil;
     #2#3;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Impre;
|FIN;

|DEFBUCLE linea;
     #2#4;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Impre;
|FIN;

|DEFBUCLE serie;
     #2#5;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Impre;
|FIN;

|DEFBUCLE caja;
     #2#6;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Impre;
|FIN;

|DEFBUCLE cajero;
     #2#7;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Impre;
|FIN;

|DEFBUCLE SerieAlma;
     #2#8;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Impre;
|FIN;

|PROCESO Impresion;
     |SI #0#1 = 1; |BUCLE articul;   |FINSI;
     |SI #0#1 = 2; |BUCLE famil;     |FINSI;
     |SI #0#1 = 3; |BUCLE linea;     |FINSI;
     |SI #0#1 = 4; |BUCLE serie;     |FINSI;
     |SI #0#1 = 5; |BUCLE caja;      |FINSI;
     |SI #0#1 = 6; |BUCLE cajero;    |FINSI;
     |SI #0#1 = 7; |BUCLE SerieAlma;  |FINSI;
|FPRC;
--------------------------------------------------
|PROCESO Porcentaje;
     #2#11 = #2#7  * 100 / impDia;
     #2#12 = #2#8  * 100 / impSem;
     #2#13 = #2#9  * 100 / impMes;
     #2#14 = #2#10 * 100 / impAno;
     |GRABA 021#2a;
|FPRC;

|DEFBUCLE Porcentaje;
     #2#1;
     ;
     0;
     999999999;
     ;
     NULL, Porcentaje;
|FIN;
--------------------------------------------------
|PROCESO leelin;
     |SI #3#31 = "R"; |O #3#31 = "A"; |O #3#31 = "L"; |ACABA; |FINSI;

     ||---------------------------------------Halla Articulo
     #5#0 = #4#2; || Articulo...
     |LEE 000#5=;
     |SI FSalida ! 0; |DDEFECTO #5; |FINSI;

     |DDEFECTO #2;
     reg = reg + 1;
     #2#0 = reg;
     #2#1 = #4#2;   || Articulo
     #2#2 = #5#2;   || Familia
     #2#3 = #5#125; || Linea
     #2#4 = #3#57;  || Serie
     #2#5 = #3#12;  || Caja
     #2#6 = #3#33;  || Camarero.
     #2#15 = #4#3;  || Almacen
     |LEE 000#2=;
     |SI FSalida ! 0;
          |GRABA 021#2b;
     |SINO;
          reg = reg - 1;
     |FINSI;

     total = #4#7;

     |SI dfecha = #0#4;          ||-------A¤o Actual
          |SI #3#14 = #0#0;
               #2#7 = #2#7 + total;   || Dia
               impDia = impDia + total;
          |FINSI;
          |SI #3#14 ] #0#2;
               #2#8 = #2#8 + total;   || Semana
               impSem = impSem + total;
          |FINSI;
          |SI #3#14 ] #0#3;
               #2#9 = #2#9 + total;   || Mes
               impMes = impMes + total;
          |FINSI;
          #2#10 = #2#10 + total; ||  A¤o
          impAno = impAno + total;
     |FINSI;
     |GRABA 021#2a;
     |LIBERA #2;
|FPRC;

|DEFBUCLE leelin;
     #agifa502#1;
     ;
     #agifa501#36, #agifa501#0, 001;
     #agifa501#36, #agifa501#0, 999;
     ;
     NULL, leelin;
|FIN;

|PROCESO agifa501;
     |BUCLE leelin;
|FPRC;

|DEFBUCLE agifa501;
     #3#3;
     ;
     dfecha, "      ", " ", #0#5,       0;
     hfecha, "zzzzzz", "z", #0#6,  999999;
     ;
     NULL, agifa501;
|FIN;

--------------------------------------------------
|PROCESO Fechas; |TIPO 0;
     ||----------------- Actual
     dia = #0#0;
     alfa = "01" + (#0#0 % 308);     mes = alfa;
     alfa = "01.01." + (#0#0 % 704); ano = alfa;
     beta = #0#0;
     beta = beta - 6;
     #0#2 = beta;
     #0#3 = mes;
     #0#4 = ano;
     |PARA i=0; |SI i [ 4; |HACIENDO i = i + 1;
||          |PINTA #0i;
     |SIGUE;
|FPRC;

|PROCESO inicio; |TIPO 3;
     |HAZ Fechas;
     |HAZ CreaTempo; aTempo2 = Tempo;
     |NOME_DAT #2 aTempo2; |DELINDEX #2;

     |ABRE #2;
     |SI #0#1 = 1; |SELECT #2#2; |FINSI;
     |SI #0#1 = 2; |SELECT #3#2; |FINSI;
     |SI #0#1 = 3; |SELECT #4#2; |FINSI;
     |SI #0#1 = 4; |SELECT #5#2; |FINSI;
     |SI #0#1 = 5; |SELECT #6#2; |FINSI;
     |SI #0#1 = 6; |SELECT #7#2; |FINSI;
     |SI #0#1 = 7; |SELECT #8#2; |FINSI;

     |IMPRE 0;
     |SI FSalida = 0;
          |INFOR informe;
          |SI FSalida = 0;
               |ABRE #3; |ABRE #4; |ABRE #5;
               |ABRE #6; |ABRE #7; |ABRE #8; |ABRE #9; |ABRE #29;
               |SELECT #2#3;
               dfecha = #0#4; hfecha = #0#0;
               |BUCLE agifa501;
               |BUCLE Porcentaje;
               |HAZ Impresion;
               enSwTotal = 1;
               |PIEINF;
               |FININF;
               |CIERRA #3; |CIERRA #4; |CIERRA #5;
               |CIERRA #6; |CIERRA #7; |CIERRA #8; |CIERRA #9; |CIERRA #29;
          |FINSI;
          |FINIMP;
     |FINSI;
     |CIERRA #2;
     |DELINDEX #2; Tempo = aTempo2; |HAZ BoraTempo;
|FPRC;
