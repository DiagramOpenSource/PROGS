|FICHEROS;
     goprepel #0;        || Este def.
     goprepec #6;        ||
     agi00029 #1,MANTE;        || Temporal de consulta de compras.
     agifa067 #2;        || Pedidos de compras(L).
     agifa112 #3;        || Proveedores.
     agifa081 #4;        || Pedidos de compras(C).
     agifa019 #5;        || Articulos;
     agifa080 #13;       || Alba Compras (L)
     agifa077 #14;       || Alba Compras (C)
     agifa142 #142;
     agifa324 #15;
     agifa321 #16;
     dsm00010 #910;
     agifa029 #29;
     agitp001 #12;
     agifa561 #561;
     agifa321 #321;
     goparame #100;
     agifa017 #17;
     guerm025 #25;  || Reservas Almacen
     guerm026 #26;
     dsm00054 #54;
     dsm00055 #55;
     guerw019 #19;
     guerw073 #73,MANTE;
     guerw074 #74,MANTE;
     dsm00082 #82;
     gopreped #90;
     gomantl1 #101;
     gopre003 #102;
     gopre004 #103;
     agitp001 #104;
     guerm123 #123; || Rese Pdt Recibir
     gomantho #105;
     agifa048 #480;
     referen@;
|FIN;

|VARIABLES;
     aConte = "";
     nReseAlma = 0;
     nUni = 0;
     nUniRes = 0;
     nAlma = 0;
     nPdteRecRes = 0;
     nPdteRecResObra = 0;
     nPdteRec = 0;
     nPdteRecObra = 0;
 {20}aPopup = "";
     aModulo = "";
     nSal = 0;
     nError = 0;
     nServida = 0;
     nUniAlma = 0;
     &eaArtiAnt = "";
     &aDivisa = "";
     &aMoneda = "";
     aArtiAnt = "";
     nAlmacen = 0;
     nNume = 0;
     aPro = "";
     nPre = 0;
     nDto = 0;
     &enAlmaCompras  = 0;
     nSwCtrlc        = 0;
     aArtActual      = "";
     &enPrepe        = 0;
     &enPreli        = 0;
     nLin            = 0;
     nHay            = 0;
     nTecla          = 0;
     i               = 0;
     &aTempo         = "";
     nBaja           = 0;
     nAlm1           = 0;
     nAlm2           = 0;
     nConta          = 0;
     aAlfa           = "";
     aMen1           = "";
     aMen2           = "";
     aMen3           = "";
     aMen4           = "";
     aMen5           = "";
     aMen6           = "";
     &eFecgopre      = @;
     &nDeci_Base     = 0;   || Decimales en Totales de la moneda base
     &nDeci_PreBase  = 0;   || Decimales en el Precio en moneda base
     &nDeci_BaseMxP  = 0;   || Decimales en Totales de la moneda base (Maxima precision)
     &nDeci_PreBasMxP = 0;   || Decimales en el Precio en moneda base (Maxima precision)
     &nDeci_DivP      = 0;   || Decimales en Totales de la divisa
     &nDeci_PreDivP   = 0;  || Decimales en el Precio en divisa
     &nDeci_TotVisP   = 0;  || Decimales en Totales visibles (el de la moneda de trabajo)
     &nDeci_TotNoVisP = 0;  || Decimales en Totales no visibles (el de la otra moneda)
     &nDeci_PreVisP   = 0;  || Decimales en el Precio visual. (lineas)
     &nDeci_ImpVisP   = 0;  || Decimales en el Importe visual. (lineas)
     nfecha    = 0;
     &ac_divisa = "N";   || Vale "S" cuando las divisas en compras estan
                         || activadas y la serie es de divisas
     &decim_divisa = 0;  || Decimales de la divisa
     &precio_divisa = 0; || Decimales del precio en divisa
     &decim_base = 0;    || Decimales de la moneda base
     &precio_base = 0;   || Decimales del precio en moneda base
     div_act = 0;        || Divisa actualizada. Me sirve en un PARA para que
                         || no salga hasta que este actualizada (div_act=1)
     &prov_divisa = "";  || Codigo de Proveedor. Se pasa a PROVEED/DIVISAS

     &Tempo     = "";
     aTempo1    = "";
     nResto     = 0;
     nModo      = 0;
     &Envase    = "";
     &Unidades1 = 0;
     &Unidades2 = 0;
     &VArticulo = "";
     nPrecio   = 0;
     modo      = 0;
     forma     = 0;
     fichero   = "";
     linea     = 0;
     descu     = 0;
     precio    = 0;
     dto1      = 0;
     dto2      = 0;
     alfa      = "";
     divisa    = "";
     cambio_base = 0;
     cambio_div = 0;
     &nDeci_Div = 0;
     &nDeci_PreDiv = 0;
     dant      = "";

     &eaCodigo      = "";
     &eaTipoCodigo  = "PR";
|FIN;

|INCLUYE i_varart;

|PROCESO ReseAlma;
     nReseAlma = nReseAlma + #25#16;
|FPRC;

|DEFBUCLE ReseAlma;
     #25#2;
     ;
     #0#0, #0#1;
     #0#0, #0#1;
     ;
     NULL, ReseAlma;
|FIN;

|PROCESO PdteRecRes;
     nPdteRecRes = nPdteRecRes + (#123#5 - #123#6);
     #referen@#0 = #123#8;
     |LEE 000#referen@.=;
     |SI FSalida = 0; |Y #referen@#3 = #6#3; || Serie Expediente=Obra
          nPdteRecResObra = nPdteRecResObra + (#123#5 - #123#6);
     |FINSI;
|FPRC;

|DEFBUCLE PdteRecRes;
     #123#2;
     ;
     #0#2, nAlma;
     #0#2, nAlma;
     ;
     NULL, PdteRecRes;
|FIN;

|PROCESO PdteRec;
     nPdteRec = nPdteRec + (#2#5 - #2#38);
     |SI #2#28 = #6#3;
          nPdteRecObra = nPdteRecObra + (#2#5 - #2#38);
     |FINSI;
|FPRC;

|DEFBUCLE PdteRec;
     #2#3;
     3;
     #0#2, "      ", 000001, "      ", nAlma;
     #0#2, "zzzzzz", 999999, "zzzzzz", nAlma;
     ;
     NULL, PdteRec;
|FIN;

|PROCESO Tipo3Lin; |TIPO 3;
|FPRC;

|PROCESO PintaAlm; |TIPO 13;
     |ABRE #100; |LEE 000#100p; |CIERRA #100;

     |ABRE #17;
     |DDEFECTO #17;
     #17#0 = #0#2;
     |SI #0#33 = 0;
          #17#1 = enAlmaCompras; || #100#22;
     |SINO;
          #17#1 = #0#33;
     |FINSI;
     |LEE 000#17=;
     aMen1 = "Total Compras ["+(("00000"+#17#1)%-105)+"]: " + #17#5;

     nAlma = #17#1; nPdteRec = 0; nPdteRecObra = 0; |BUCLE PdteRec;
     aMen2 = "P.Rec.Compras ["+(("00000"+#17#1)%-105)+"]: " + nPdteRec;

     |ABRE #105;
     #105#0 = #6#3;
     #105#1 = #6#7;
     |LEE 020#105=;
     |CIERRA #105;

     |DDEFECTO #17;
     #17#0 = #0#2;
     #17#1 = #105#11;    || Almacen Expediente
     |LEE 000#17=;
     aMen3 = "P.Rec.Obras   ["+(("00000"+#105#11)%-105)+"]: " + #17#43;

     |DDEFECTO #17;
     #17#0 = #0#2;
     #17#1 = #100#51;    || Almacen Deposito
     |LEE 000#17=;
     aMen4 = "Total Depósito["+(("00000"+#17#1)%-105)+"]: " + #17#5;

     |DDEF aAlfa;
     aAlfa = aAlfa + "goprepec";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          nAlma = #100#51;
          nPdteRecRes = 0; nPdteRecResObra = 0;
          |ABRE #referen@;
          |BUCLE PdteRecRes;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
     nAlma = #100#51; nPdteRec = 0; nPdteRecObra = 0; |BUCLE PdteRec;
     nUni = nPdteRec + nPdteRecRes;
     aMen5 = "P.Rec.Depósito["+(("00000"+#100#51)%-105)+"]: " + nUni;

     nUni = nPdteRecResObra + nPdteRecObra;
     aMen6 = "P.Rec.Obra Dep["+(("00000"+#100#51)%-105)+"]: " + nUni;
     |CIERRA #17;

     |MODULO aModulo;

     |BLIN 24;
     |SI aModulo = "goprep2c"; |BLIN 23; |BLIN 22; |FINSI;
     |ATRI S;
     |PINTA 2203, aMen1; |PINTA 2244, aMen4;
     |SI aModulo = "goprep2c";
          |PINTA 2303, aMen2; |PINTA 2344, aMen5;
          |PINTA 2403, aMen3; |PINTA 2444, aMen6;
          nReseAlma = 0; |BUCLE ReseAlma;
          nNume = #0#23; |C_V #0#23, 1, "S";
          #0#23 = #0#23 - nReseAlma; |PINTA #0#23; || Pinta las pdte.
          #0#23 = nNume; |C_V #0#23, 1, "N";
     |FINSI;
     |ATRI 0;
|FPRC;

|PROCESO LeePrecio;
     |SI #142#74 = "T";
          |ABRE #561;
          #561#0 = #0#2;
          #561#1 = #0#4;
          |LEE 000#561=;
          |SI FSalida = 0;
               eaDivisa = #321#9;
               |HAZ CargaDivisa;   || cargas nDeci
               enPrecio = #561#26;
               enDto1 = #561#3;
               enDto2 = #561#4;
               enDto3 = #561#37;
          |SINO;
               eaDivisa = #5#165;
               |HAZ CargaDivisa;   || cargas nDeci
               enPrecio = #5#28;
               enPreDiv = #5#163;
               enDto1 = #5#29;
               enDto2 = #5#129;
               enDto3 = #5#209;
          |FINSI;
          |CIERRA #561;
     |SINO;
          |DDEFECTO #12;
          |ABRE #12;
          #12#0 = #0#4;
          #12#1 = #0#2;
          |LEE 000#12=;
||ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ PARCHE PARA PROVEEDOR BLANCO
          |SI FSalida ! 0; |O #12#9 = 0;
               |SI #0#4 = "000000";
                    #12#0 = "";
                    |LEE 000#12=;
               |SINO;
                    |SI #0#4 = "      ";
                         #12#0 = "000000";
                         |LEE 000#12=;
                    |FINSI;
               |FINSI;
          |FINSI;
||ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
          |CIERRA #12;

          eaDivisa = #12#8;
          |HAZ CargaDivisa;   || cargas nDeci
          enPrecio = #12#9;
          enPreDiv = #12#3;
          enDto1 = #12#4;
          enDto2 = #12#5;
          enDto3 = #12#10;
     |FINSI;
|FPRC;

|PROCESO Tipo_7; |TIPO 7;
     nSwCtrlc = 0;
     |ABRE #142; |LEE 000#142p; |CIERRA #142;
     |SI #0#33 = 0;
          #0#33 = enAlmaCompras;
          |PINTA #0#33;
     |FINSI;
|FPRC;

|PROCESO cuentas; |TIPO 0;
     |ABRE #5;
     #5#0 = #0#2;
     |LEE 020#5=;
     |CIERRA #2;

     |SI #6#15 = "N";
          |SI #5#196 = 2;
               #0#8 = (#0#14 * #0#6) < #0#7;  || UND * P.COMPRA - DTO.
          |SINO;
               #0#8 = (#0#5 * #0#6) < #0#7;  || UND * P.COMPRA - DTO.
          |FINSI;
     |SINO;
          |SI #5#196 = 2;
               #0#8 = (#0#35 * #0#6) < #0#7;
          |SINO;
               #0#8 = (#0#31 * #0#6) < #0#7;
          |FINSI;
     |FINSI;
     |PINTA #0#8;
|FPRC;
____________________________/ CONSULTA LAS COMPRAS ANTERIORES DE UN ARTICULO.
|PROCESO GrabaAlba;
     linea = linea + 1;
     #1#0 = #3#0;                  || PROVEEDOR.
     |LEE 101#1=;
     |SI FSalida ! 0;
          #1#1 = #3#1;              || NOMBRE.
          #1#2 = #13#6;             || PRECIO.
          #1#3 = #13#5;             || CANTIDAD.
          #1#4 = #14#1;             || FECHA
          #1#5 = #13#8;             || % DTO.
          #1#6 = #1#2 < #1#5;       || PRECIO NETO.
          |GRABA 020#1n;
     |SINO;
          |SI #13#8 > #1#5;
               #1#1 = #3#1;              || NOMBRE.
               #1#2 = #13#6;             || PRECIO.
               #1#3 = #13#5;             || CANTIDAD.
               #1#4 = #14#1;             || FECHA
               #1#5 = #13#8;             || % DTO.
               #1#6 = #1#2 < #1#5;       || PRECIO NETO.
               |GRABA 020#1a;
          |FINSI;
     |FINSI;
     |LIBERA #1;
|FPRC;

|PROCESO GrabaAlbaFec;
     linea = linea + 1;
     #1#0 = #3#0;                  || PROVEEDOR.
     |LEE 101#1=;
     |SI FSalida ! 0;
          #1#1 = #3#1;              || NOMBRE.
          #1#2 = #13#6;             || PRECIO.
          #1#3 = #13#5;             || CANTIDAD.
          #1#4 = #14#1;             || FECHA
          #1#5 = #13#8;             || % DTO.
          #1#6 = #1#2 < #1#5;       || PRECIO NETO.
          |GRABA 020#1n;
     |SINO;
          |SI #14#1 ] #1#4;
               #1#1 = #3#1;              || NOMBRE.
               #1#2 = #13#6;             || PRECIO.
               #1#3 = #13#5;             || CANTIDAD.
               #1#4 = #14#1;             || FECHA
               #1#5 = #13#8;             || % DTO.
               #1#6 = #1#2 < #1#5;       || PRECIO NETO.
               |GRABA 020#1a;
          |FINSI;
     |FINSI;
     |LIBERA #1;
|FPRC;

|PROCESO BuscaAlba;
     |MENSA "2403Buscando....";
     |LEE 000#13p;
     |PARA; |SI FSalida = 0; |HACIENDO;
          |SI #0#2 = #13#2;
               #14#50 = #13#27;
               #14#0 = #13#0;
               |LEE 000#14=;
               |SI FSalida = 0;
                    #3#0 = #14#3;
                    |LEE 000#3=;
                    |SI FSalida ! 0; |DDEFECTO #3; |FINSI;
                    aDivisa = #agifa077#56;
                    aMoneda = #agifa077#58;
                    |HAZ Divisas077;
                    |SI nTecla = 18;
                         |HAZ GrabaAlbaFec;
                    |SINO;
                         |HAZ GrabaAlba;
                    |FINSI;
               |FINSI;
          |FINSI;
          |LEE 000#13s;
     |SIGUE;
     |BLIN 24;
|FPRC;

|PROCESO mini;
     #1#0 = "      ";
     #1#6 = 0;
|FPRC;

|PROCESO maxi;
     #1#0 = "zzzzzz";
     #1#6 = 99999999;
|FPRC;

|PROCESO TeclaEnter; |TIPO 0;
     |SI #1Campo = Contenido; |Y FSalida = 0;
          aPro = #1#0;
          nPre = #1#2;
          nDto = #1#5;
          |ERROR;
          |PTEC 806;
     |FINSI;
|FPRC;

|PROCESO Articu7; |TIPO 7;
     aArtiAnt = #0#2;
|FPRC;

|PROCESO DeciPrv;
     |ABRE #agifa324;
     #agifa324#0 = #0#11;
     |LEE 001#agifa324.=;
     |CIERRA #agifa324;
     nDeci_PreDiv = #agifa324#9;

     |ABRE #agifa321;
     |LEE 001#agifa321.p;
     #agifa324#0 = #agifa321#9; ||Igualo a moneda base
     |LEE 001#agifa324.=;
     |CIERRA #agifa321;
     nDeci_Base = #agifa324#7;  ||Decimales moneda base
     nDeci_PreBase = #agifa324#9;  ||Decimales precio de moneda base
|FPRC;

|PROCESO Prove7; |TIPO 7;
     aConte = #0Campo;
|FPRC;

|PROCESO consulta; |TIPO 0;
     nTecla = FSalida;
     |SI #0Campo ! aConte; |O aArtiAnt ! #0#2;
          aArtiAnt = #0#2;
          |HAZ DeciPrv;
          |ABRE #104;
          #104#0 = #0#4;
          #104#1 = #0#2;
          |LEE 000#104=;
          |SI FSalida = 0;
               #0#6 = #104#3; |PINTA #0#6;
               #0#7 = #104#4; |PINTA #0#7;
          |FINSI;
          |CIERRA #104;
     |FINSI;
     |SI nTecla = 9; |O nTecla = 18;
          |HAZ CreaTempo; aTempo1 = Tempo;
          |NOME_DAT #1 aTempo1; |DELINDEX #1;
          |ABRE #1; |ABRE #3; |ABRE #13; |ABRE #14;
          linea = 1;
          |HAZ BuscaAlba;
          |SI linea ! 1;
               aPro = "";
               |PUSHV 0501 2380;
               ||ENTLINEAL #1#1,1,4,22,1,mini,maxi;     || por proveedor
               |ENTLINEAL #2#1,1,4,22,1,mini,maxi;     || por precio neto
               |POPV;
               |SI aPro ! "";
                    #0#4 = aPro;
                    #0#6 = nPre;             || PRECIO.
                    #0#7 = nDto;             || % DTO.
               |PINTA #0#4;
               |PINTA #0#6;
               |PINTA #0#7;
               |FINSI;
          |SINO;
               |MENAV "0000No se encontraron compras anteriores.";
          |FINSI;
          |CIERRA #1; |CIERRA #3; |CIERRA #13; |CIERRA #14;
          |DELINDEX #1;
          Tempo = aTempo1; |HAZ BoraTempo;
          |ERROR;
          |ACABA;
     |FINSI;

     |SI nTecla = 11; |O #142#102 = "S"; |O #142#102 = "X";
          enPrepe = #0#0;
          enPreli = #0#1;
          eaCodigo = #0#4;
          eaFuerza = "N";
          |SI FSalida = 11; eaFuerza = "S"; |FINSI;
          |SUB_EJECUTA_NP "go000001";
          |SI #142#102 = "N";  |ERROR;  |FINSI;
     |FINSI;
|FPRC;

|PROCESO mirapre; |TIPO 0;
     nModo = (FEntrada / 100) ! 0;
     |SI nTecla = 10;
          |HAZ Consulta;
          nTecla = 0;
          |ERROR; |ACABA;
     |FINSI;
     |SI nModo = 1; |O #0#2 ! aArtActual;
          |ABRE #5;
          #5#0 = #0#2;
          |LEE 000#5=;
          |CIERRA #5;
          |SI nModo = 1;
               #0#4 = #5#27;  |PINTA #0#4;   ||Prov
          |FINSI;
          #0#3 = #5#195;
          aAlfa = #0#3; |QBF aAlfa;
          |SI aAlfa = ""; #0#3 = #5#1; |FINSI;
          |PINTA #0#3;

          |HAZ LeePrecio;
          ||SI enPreDiv ! 0;
               #0#7  = enDto1;
               #0#6  = enPreDiv;
               #0#11 = eaDivisa;
          ||FINSI;
          |PINTA #0#6;
          |PINTA #0#7;
          |PINTA #0#11;
          |HAZ cuentas;
     |FINSI;
     |HAZ PintaAlm;
|FPRC;

|PROCESO Mensaje;
     |PUSHV 0501 2380;
     |AVISO;
     |COLOR 0, 0; |ATRI 0;
     |BLANCO 0815 1265;
     |COLOR 14, 0; |ATRI 0;
     |D_CUADRO 0815,1265;
     |PINTA 1017, alfa;
     |ATRI 0;
     |PAUSA;
     |POPV;
|FPRC;

|PROCESO cambipre; |TIPO 0;
     |SI #142#75 ! "S"; |ACABA; |FINSI;
     |HAZ LeePrecio;
     |SI enPreDiv ! #0#6;
          alfa = "­ ATENCION ! POSIBLE CAMBIO DE PRECIO COSTE...";
          |HAZ Mensaje;
     |FINSI;
|FPRC;

|PROCESO cambidto;
     |SI #142#75 ! "S"; |ACABA; |FINSI;
     |HAZ LeePrecio;
     |SI enDto1 ! #0#7;
          alfa = "­ ATENCION ! POSIBLE CAMBIO DE DESCUENTO  ...";
          |HAZ Mensaje;
     |FINSI;
|FPRC;

|PROCESO ModPrecio; |TIPO 6;
     |SI #0Campo ! Contenido;
          #0#27 = Contenido;
     |FINSI;
|FPRC;

|PROCESO ModFecha; |TIPO 6;
     |SI #0Campo ! Contenido;
          #0#26 = Contenido;
     |FINSI;
|FPRC;

|PROCESO goprepllBor;
     |BORRA 020#90a;
|FPRC;

|DEFBUCLE goprepllBor;
     #90#1;
     ;
     #0#0, #0#1, 001;
     #0#0, #0#1, 999;
     be;
     NULL, goprepllBor;
|FIN;

|PROCESO tipo2; |TIPO 2;
     modo  = (FEntrada / 100) ! 0;
     enModo = modo;
     forma = 0 +.1;

     |SI modo = 1;
          #0#37 = "S"; |PINTA #0#37;
          |HAZ DesAmpliada;
     |FINSI;
     |SI forma = 1;
          |HAZ decdivpp; ||Recoge variables de divisa de nuevo por si se sale con control c
     |FINSI;
     |SI #6#15 = "S"; |Y modo ! 3;
          |HAZ UniParcial;
     |FINSI;
     |SI modo = 3;
          enError = 0;
          |HAZ CheqBorLin
          |SI enError ! 0; |ERROR; |ACABA; |FINSI;
          |SI #0#10 = "S";
               |MENAV "0000Linea Actualizada...";
               |ERROR; |ACABA;
          |SINO;
               |SI #0#23 ! 0;
                    |HAZ ReservaBaja;
               |FINSI;
          |FINSI;
          |BUCLE goprepllBor;
     |SINO;
          |SI #100#141 = "O";
               |ABRE #29;
               #29#0 = #0#33;
               |LEE 000#29=;
               |SI FSalida ! 0; |DDEFECTO #29; |FINSI;
               |CIERRA #29;
               |ABRE #5;
               #5#0 = #0#2;
               |LEE 000#5=;
               |SI FSalida ! 0; |DDEFECTO #5; |FINSI;
               |CIERRA #5;
               |DDEFECTO #17;
               |ABRE #17;
               #17#0 = #0#2;
               #17#1 = #0#33;
               #17#40 = #5#1;
               #17#41 = #29#1;
               |LEE 000#17=;
               |SI FSalida ! 0; |GRABA 020#17n; |FINSI;
               |CIERRA #17;
          |FINSI;
     |FINSI;
|FPRC;

|CALCULO divant;|TIPO 7;
   dant = #0#11;
|FCAL;

|CALCULO decdivpp; |TIPO 0;
     |HAZ DeciPrv;
     |ABRE #agifa324;
     #agifa324#0 = #0#11;
     |LEE 001#agifa324.=;
     nDeci_PreDiv = #agifa324#9;
     cambio_div   = #agifa324#3;
     nDeci_Div    = #agifa324#7;

     |ABRE #agifa321;
     |LEE 001#agifa321.p;
     #agifa324#0 = #agifa321#9; ||Igualo a moneda base
     |LEE 001#agifa324.=;
     cambio_base = #agifa324#3;

     |SI #0Campo ! dant;
         |SI Campo = 11;  ||Estoy en campo divisa
             #agifa324#0 = dant;
             |LEE 001#agifa324.=; ||Leo valores de la divisa que habia antes de cambiarla
             #0#6 = #0#6 / #agifa324#3 * cambio_div; ||Precio en nueva divisa
             #0#6 = #0#6 ! nDeci_PreDiv;
             |HAZ cuentas;
             #0#8 = #0#8 ! nDeci_Div;
          |FINSI;
          |PINTA #0#6;
          |PINTA #0#8;
      |FINSI;
      |CIERRA #agifa321;
      |CIERRA #agifa324;
|FCAL;

|CALCULO redondiv;|TIPO 0;
    |HAZ ModPrecio;
    #0#6 = #0#6 ! nDeci_PreDiv;
    #0#8 = #0#8 ! nDeci_Div;
    |PINTA #0#6;
    |PINTA #0#8;
|FCAL;

|CALCULO redonuni;|TIPO 6;
     |SI FSalida = 13;
          |HAZ Envase28;
     |FINSI;

     #0Campo = #0Campo ! #142#8;

     |SI #0#5 > 0;
          nResto = #0#5 $ #5#202;
          |SI nResto ! 0;
               #0#5 = #0#5 - nResto + #5#202;
          |FINSI;
     |SINO;
          nResto = -#0#5 $ #5#202;
          |SI nResto ! 0;
               #0#5 = #0#5 + nResto - #5#202;
          |FINSI;
     |FINSI;

     |PINTA #0Campo;
|FCAL;

|CALCULO divisasno; |TIPO 7; ||Mira si divisas esta activado en compras
  |ABRE #agifa321;
  |LEE 001#agifa321.p;
  |SI #agifa321#2 = "N";
    |CAMPO_MODIFICA #0#11,1,"N";
  |FINSI;
  |CIERRA #agifa321;
|FCAL;

|PROCESO CogeValores28;  |TIPO 7;
     |SI #100#76 = "S";
          |MENSA "0000<F5> Cambio Almacen Compras <F8> DA";
     |SINO;
          |MENSA "0000<F8> DA";
     |FINSI;
|FPRC;

|PROCESO PideArt28;  |TIPO 7;
     nModo = (FEntrada / 100) ! 0;
     |SI #142#140 = "S"; |Y nModo = 1; #0#2 = eaArtAnt; |FINSI;
     aArtActual = #0#2;

     |C_M #0#2, 1, "S";

     |SI #0#2 ! "                    ";
         |ABRE #5;
         #5#0 = #0#2;
         |LEE 000#5=;
         |SI FSalida ! 0;  |DDEFECTO #5;  |FINSI;
         |CIERRA #5;
         |SI #5#176 = "S";
             |C_M #0#2, 1, "N";
             |ACABA;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO MiraStock; |TIPO 0;
     |C_M #0#23, 0, aAlfa;
     |SI #0#10 > #17#5; |Y aAlfa = "S";
          aAlfa = "0000Superado el stock. Total: " + #17#5;
          |MENAV aAlfa;
          |ERROR;
     |FINSI;
|FPRC;

|PROCESO Tipo66Lin; |TIPO 66;
     |MODULO aModulo;
     |SI aModulo = "goprep2c";   ||F11
          |HAZ VerResPdtRecibir;
     |FINSI;
|FPRC;

|PROCESO ConsultaLin;
     nTecla = FSalida;
     |MODULO aModulo;
     |SI nTecla = 10; |Y aModulo = "goprep2c";   ||F2;
          aPopup1 = "-1";
          aPopup2 = 8;
          aPopup3 = "<F3> Unidades Expediente";
          aPopup4 = "<F5> Reservar Unidades";
          aPopup5 = "<F6> Anular Reservas";
          aPopup6 = "<F7> Ver Reservas";
          aPopup7 = "<F8> Descripción Ampliada";
          aPopup8 = "<F9> Reservar Pdte Recibir";
          aPopup9 = "<F10> Anular Reservas Pdte Recibir";
          aPopup10 = "<F11> Ver Reservas Pdte Recibir";
          IaPopup = aPopup1  <-;
          |ESPECIFICA "TRACKPOPUP", aPopup;
          |SI FSalida [ 0; |ERROR; |ACABA; |FINSI;
          |SI FSalida = 1; nTecla = 11; |FINSI;
          |SI FSalida = 2; nTecla = 13; |FINSI;
          |SI FSalida = 3; nTecla = 14; |FINSI;
          |SI FSalida = 4; nTecla = 15; |FINSI;
          |SI FSalida = 5; nTecla = 16; |FINSI;
          |SI FSalida = 6; nTecla = 17; |FINSI;
          |SI FSalida = 7; nTecla = 18; |FINSI;
          |SI FSalida = 8; nTecla = 19; |FINSI;
     |FINSI;

     |ABRE #17;
     #17#0 = #0#2;
     #17#1 = enAlmaCompras; || #100#22;
     |LEE 000#17=;
     |CIERRA #17;

     |SI nTecla = 11;
          |C_M #0#30, 1, "S";
          |ENCAMPO #30#0;
          |SI FSalida = 0;
               |CONFI "0000SActualizar unidades pendientes?";
               |SI FSalida = 0;
                    #0#32 = #0#30; |PINTA #0#32;
               |FINSI;
               #0#37 = "S"; |PINTA #0#37;
               |GRABA 020#0a;
          |FINSI;
          |C_M #0#30, 1, "N";
     |FINSI;

     |SI nTecla  = 13;        ||F5 Reservar Unid
          |SI #17#5 > 0;
               nReseAlma = 0; |BUCLE ReseAlma;
               nUni = #0#23 - nReseAlma;
               |SI nUni > 0;
                    aAlfa = "0000Hay unidades reservadas:" + nUni;
                    |MENAV aAlfa;
               |SINO;
                    #0#23 = #0#23 - nReseAlma;
                    |PUSHV 0501 2380;
                    |C_V #0#23, 1, "S";
                    |C_M #0#23, 1, "S";
                    |ENCAMPO #23#0;
                    |SI FSalida = 0;
                         |HAZ ReservaAlta;
                         |SI nError = 0;
                              |HAZ EventoResAlta;
                              #0#23 = #0#23 + nReseAlma;
                              |GRABA 020#0a;
                              #0#10 = "N";
                         |FINSI;
                    |FINSI;
                    |C_V #0#23, 1, "N";
                    |C_M #0#23, 1, "N";
                    |POPV;
                    |PINTA #0#23;
                    |PINTA #0#32;
                    |PINTA #0#10;
                    |HAZ PintaAlm;
               |FINSI;
          |SINO;
               |MENAV "0000No hay stock...";
          |FINSI;
          |ERROR;
     |FINSI;
     |SI nTecla = 14;         || F6 Anular Reservas
          |SI #0#10 = "S";
               |MENAV "0000Linea actualizada...";
               |ERROR; |ACABA;
          |FINSI;
          |SI #0#23 ! 0;
               |PUSHV 0501 2380;
               nReseAlma = 0; |BUCLE ReseAlma;
               #0#23 = #0#23 - nReseAlma;
               |HAZ ReservaBaja;
               #0#23 = #0#23 + nReseAlma;
               |GRABA 020#0a;
               |HAZ EventoResBaja;
               |POPV;
               |PINTA #0#23;
               |PINTA #0#32;
               |HAZ PintaAlm;
          |SINO;
               |MENAV "0000No hay unidades reservadas...";
          |FINSI;
          |ERROR;
     |FINSI;
     |SI nTecla = 15;
          |HAZ VerReserva;
          |ERROR;
     |FINSI;
     |SI nTecla = 16;
          |HAZ DesAmpliada;
          |PUSHV 0501 2380;
          |ENTLINEAL #1#90, 3, 2, 22, 1, Min90, Max90;
          |POPV;
          nSwCtrlc = 1;
          |ERROR;
     |FINSI;
     |SI nTecla = 17; |Y aModulo = "goprep2c";   ||F9
          |HAZ ResPdtRecibir;
     |FINSI;
     |SI nTecla = 18; |Y aModulo = "goprep2c";   ||F10
          |HAZ AnulaResPdtRecibir;
     |FINSI;
     |SI nTecla = 19; |Y aModulo = "goprep2c";   ||F11
          |HAZ VerResPdtRecibir;
     |FINSI;
     |SI nTecla = 7; |Y nSwCtrlc ! 0;
          |ERROR; |ACABA;
     |FINSI;
|FPRC;

|PROCESO Calc628;  |TIPO 6;
     nTecla = FSalida;

     |C_M #0#5, 1, "S";
     |C_M #0#6, 1, "S";

     enAlta = 1;
     eaArticulo = #0Campo;
     |HAZ LlenaArticulo;
     |SI FSalida = 0;
          #0Campo = eaArticulo;
          |PINTA #0Campo;
     |SINO;
          |ERROR; |ACABA;
     |FINSI;

     |HAZ SacaKit;
|FPRC;

|PROCESO ElElemento; |TIPO 0;
     |ABRE #5;
     #5#0 = #0#2;
     |LEE 000#5=;
     |SI FSalida ! 0;  |DDEFECTO #5;  |FINSI;
     |CIERRA #5;
     |SI #5#176 = "S";
          eaTipo      = "W2";
          eaSerie     = "";
          enCodigo    = #0#0;
          enLinea     = #0#1;
          eaArticulo  = #0#2;
          enAlmacen   = enAlmaCompras;
          enUnidades  = #0#5;
          enTBruto    = #0#5 * #0#6;
          eaAbono     = "N";
          eaReservado = "N";
          enTarifa    = 0;
          eaProve     = #0#4;
          |SI #0#11 = #16#9;
               eaMoneda = "B";
          |SINO;
               eaMoneda = "D";
          |FINSI;
          enCamBas = cambio_div;
          enCamDiv = cambio_base;

         |SUB_EJECUTA_NP "dsz00002";

         nPrecio = enTBruto / enUnidades;

         |PTEC 802;
         |C_M #0#5, 1, "N";
         |C_M #0#6, 1, "N";
     |FINSI;
|FPRC;

|PROCESO Envase28;
     Envase    = #0#12;
     Unidades1 = #0#13;
     Unidades2 = #0#5;
     VArticulo = #0#2;
     enAlmacen = enAlmaCompras;
     eaTipo = "C";
     eaProgEnv = "prepedido";
     |HAZ EntraEnvase;
     #0#12 = Envase;
     #0#13 = Unidades1;
     #0#5  = Unidades2;  |PINTA #0#5;
|FPRC;

|PROCESO Conversion;  |TIPO 7;
     |SI #agifa142#72 = "S"; |Y #agifa142#179 = "S";
          |HAZ Envase28;
          |C_M #0#5, 1, "S";
          |SI Unidades1 ! 0;  |C_M #0#5, 1, "N";  |FINSI;
     |FINSI;
|FPRC;

|PROCESO Multi28; |TIPO 66;
|FPRC;
ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
|PROCESO ReservaAlta;
     nError = 0;

     |DDEFECTO #17;
     |ABRE #17;
     #17#0 = #0#2;
     |SI #0#33 = 0;
          #17#1 = enAlmaCompras;
     |SINO;
          #17#1 = #0#33;
     |FINSI;
     |LEE 020#17=;
     |SI #0#23 > #17#39;
          #0#23 = 0;
          |MENAV "0000Se superan las unidades disponibles...";
          nError = 1; |ACABA;
     |FINSI;
     |CIERRA #17;

     #0#5 = #0#22 - #0#23;
     |C_V #0#5, 0, aAlfa;
     |SI aAlfa = "S"; |PINTA #0#5; |FINSI;

     nBaja = 1;
     |HAZ ReservaAlma;
     |HAZ HistoRece;

     |CONFI "0000S¿Imprimir reserva?";
     |SI FSalida = 0;
          |HAZ ImprimeRese;
     |FINSI;

     |CONFI "0000S¿Actualizar unidades pendientes?";
     |SI FSalida = 0;
          nUniAlma = #0#23;
          |HAZ MoviAlma;
          #0#32 = #0#32 - #0#23;
          |SI #0#32 < 0; #0#32 = 0; |FINSI;
          |SI #0#32 > 0;
               |CONFI "0000S¿Despreciar unidades pendientes?";
               |SI FSalida = 0;
                    #0#32 = 0;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO ReservaBaja;
     nBaja = -1;
     |HAZ ReservaAlma;
     |SI nError ! 0; |ACABA; |FINSI;

     |HAZ HistoRece;
     |CONFI "0000S¿Actualizar unidades pendientes?";
     |SI FSalida = 0;
          |SI nServida ! 0;
               nUniAlma = nServida;
          |SINO;
               nUniAlma = #0#23;
          |FINSI;
          |HAZ MoviAlma;
          #0#32 = #0#32 + nUniAlma;
     |FINSI;
     #0#23 = 0;
     #0#5 = #0#22;

     |C_V #0#5, 0, aAlfa;
     |SI aAlfa = "S"; |PINTA #0#5; |FINSI;
     |PINTA #0#5;
|FPRC;

|PROCESO Ultima25;
     #25#0 = #6#3;
     #25#1 = 99999;
     |LEE 000#25];
     |SI FSalida = 0;
          |LEE 000#25a;
     |SINO;
          |LEE 000#25u;
     |FINSI;
     |SI FSalida = 0; |Y #25#0 = #6#3;
          nConta = #25#1 + 1;
     |SINO;
          nConta = 1;
     |FINSI;
|FPRC;

|PROCESO ReservaAlma;
     nServida = 0;
     nError = 0;
     |ABRE #25;
     |SELECT #2#25;
     #25#10 = #0#0;
     #25#11 = #0#1;
     |LEE 101#25=;

     nSal = FSalida;
     |SELECT #1#25;
     FSalida = nSal;

     |SI nBaja = 1;      || Alta;
          |SI FSalida = 0;
               |LEE 121#25=;
               nConta = #25#1;
          |SINO;
               |HAZ Ultima25;
               |DDEFECTO #25;
               #25#0 = #6#3;
               #25#1 = nConta;
               |GRABA 020#25b;
          |FINSI;
          #25#11 = #0#1;
          #25#2 = #6#1;
          #25#3 = #6#3;
          #25#4 = #6#7;
          #25#5 = #6#8;
          #25#6 = #6#9;
          #25#7 = #0#2;
          #25#8 = #0#3;
          #25#9 = #25#9 + #0#23;
          #25#17 = #25#9 - #25#16;
          #25#10 = #0#0;
          #25#11 = #0#1;
          #25#12 = "N";
          #25#13 = Usuario % 810;
          #25#14 = enAlmaCompras;
          #25#15 = #100#51;
          |GRABA 020#25a;
     |SINO;
          |SI FSalida = 0;
               |LEE 121#25=
               |SI #25#16 = 0;     || no hay servidas
                    #25#9 = 0;
                    #25#17 = 0;
                    #25#13 = Usuario % 810;
                    |GRABA 020#25a;
               |SINO;
                    |SI #25#17 = 0; || no hay pendientes
                         nError = 1;
                         |MENAV "0000La reserva ya esta servida...";
                    |SINO;
                         |CONFI "0000NLa reserva esta parcialmente servida. ¿Continuar?";
                         |SI FSalida = 0;
                              #25#9 = #25#16; || original=servidas
                              #25#17 = 0;     || pdte
                              #25#13 = Usuario % 810;
                              |GRABA 020#25a;
                              nServida = #25#16;
                         |SINO;
                              nError = 1;
                         |FINSI;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
     |CIERRA #25;
|FPRC;

|PROCESO HistoRece;
     |ABRE #26;
     |LEE 000#26u;
     |SI FSalida = 0;
          nConta = #26#0 + 1;
     |SINO;
          nConta = 1;
     |FINSI;
     |DDEFECTO #26;

     #26#0 = nConta;
     #26#1 = ~;
     #26#2 = #6#10;
     |SI nBaja = 1;
          #26#3 = "A";
     |SINO;
          #26#3 = "B";
     |FINSI;
     #26#4 = #6#3;
     #26#5 = #0#0;
     #26#6 = #6#1;
     #26#7 = #6#3;
     #26#8 = #6#7;
     #26#9 = #6#8;
     #26#10 = #6#9;
     #26#11 = #0#2;
     #26#12 = #0#3;
     #26#13 = #0#23;
     #26#14 = #0#0;
     #26#15 = #0#1;
     #26#16 = "N";
     #26#17 = Usuario % 810;
     |GRABA 020#26n;
     |CIERRA #26;
|FPRC;

|PROCESO MoviAlma;
     |SI nBaja = 1;
          nAlm1 = enAlmaCompras;  || #100#22;
          nAlm2 = #100#51;
     |SINO;
          nAlm2 = enAlmaCompras;  || #100#22;
          nAlm1 = #100#51;
     |FINSI;
     |ABRE #54;
/*
     #54#2 = #6#3;
     #54#0 = 999999;
     |LEE 000#54];
     |SI FSalida = 0;
          |LEE 000#54a;
     |SINO;
          |LEE 000#54u;
     |FINSI;
     |SI FSalida = 0; |Y #54#2 = #6#3;
          nConta = #54#0 + 1;
     |SINO;
          nConta = 1;
     |FINSI;
     |DDEFECTO #54;
     #54#0 = nConta;
     #54#1 = ~;
     #54#2 = #6#3
     |GRABA 020#54n;
*/
     |DDEFECTO #54;
     #54#2 = #25#0;
     #54#0 = #25#1;
     |LEE 101#54=;
     |SI FSalida ! 0; |GRABA 020#54n; |FINSI;
     |CIERRA #54;

     |ABRE #55;
     #55#28 = #54#2;
     #55#27 = #54#0;
     #55#11 = 99999;
     |LEE 000#55];
     |SI FSalida = 0;
          |LEE 000#55a;
     |SINO;
          |LEE 000#55u;
     |FINSI;
     |SI FSalida = 0; |Y #55#28 = #54#2;  |Y #55#27 = #54#0;
          nConta = #55#11 + 1;
     |SINO;
          nConta = 1;
     |FINSI;

     |DDEFECTO #55;
     #55#28 = #54#2;
     #55#27 = #54#0;
     #55#11 = nConta;
     #55#0 = #0#2;
     #55#1 = nAlm1;    ||Alm Sal = Comp
     #55#2 = #0#3;

     |ABRE #5;
     #5#0 = #0#2;
     |LEE 000#5=;
     |CIERRA #5;
     |ABRE #17;
     #17#0 = #0#2;
     #17#1 = nAlm2;
     |LEE 000#17=;

     #55#7 = #5#6;
     #55#3 = #17#5;
     #55#4 = nUniAlma;
     #55#5 = nAlm2;    ||Alm Ent = Depo
     #55#9 = #17#41;

     #17#1 = nAlm2;
     |LEE 000#17=;
     |CIERRA #17;

     #55#6 = #17#5;
     #55#8 = #54#1;
     #55#10 = #17#41;
     |GRABA 020#55n;
     |CIERRA #55;
     enForma = 1;
     |HAZ AcumulaME_MS;
|FPRC;

|PROCESO guerm025;
     |SI #25#17 ! 0;
          nHay = 1;
          |PARA i = 0; |SI i [ 12; |HACIENDO i = i + 1;
               #19i = #25i;
          |SIGUE;
          #19#9 = #25#17;
          |GRABA 020#19n;
     |FINSI;
|FPRC;

|DEFBUCLE guerm025;
     #25#3;
     ;
     #0#2, "     ", 000001;
     #0#2, "zzzzz", 999999;
     ;
     NULL, guerm025;
|FIN;

|PROCESO guerw019;
     #25#0 = #19#0;
     #25#1 = #19#1;
     |LEE 020#25=;
     |PRINT;
|FPRC;

|DEFBUCLE guerw019;
     #19#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, guerw019;
|FIN;

|PROCESO VerReserva;
     |HAZ CreaTempo; |NOME_DAT #19 Tempo; |DELINDEX #19;
     nHay = 0;
     |ABRE #19;
     |BUCLE guerm025;
     |ABRE #19;
     |CONSULTA_CLAVE #1#19;
     |CIERRA #19;

     |SI nHay ! 0;
          |CONFI "0000NImprimir";
          |SI FSalida = 0;
               |IMPRE 0;
               |SI FSalida = 0;
                    |INFOR "guerm025";
                    |SI FSalida = 0;
                         |ABRE #25;
                         |BUCLE guerw019;
                         |CIERRA #25;
                         |PIEINF;
                         |FININF;
                    |SINO;
                         |MENAV "0000No existe informe 'guerm025'...";
                    |FINSI;
                    |FINIMP;
               |FINSI;
          |FINSI;
     |FINSI;
     |DELINDEX #19; |HAZ BoraTempo;
|FPRC;
ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
|PROCESO dsm00082;
     nLin = nLin + 1;
     #90#0 = #0#0;
     #90#1 = #0#2;
     #90#2 = nLin;
     #90#3 = #82#2;
     #90#4 = #0#1;
     |GRABA 020#90n;
|FPRC;

|DEFBUCLE dsm00082;
     #82#1;
     ;
     #0#2, 001;
     #0#2, 999;
     ;
     NULL, dsm00082;
|FIN;

|PROCESO DesAmpliada;
     |ABRE #90;
     #90#0 = #0#0;
     #90#1 = #0#1;
     #90#2 = 0;
     |LEE 000#90];
     |SI FSalida = 0; |Y #90#0 = #0#0; |Y #90#1 = #0#1;
     |SINO;
          nLin = 0;
          |BUCLE dsm00082;
     |FINSI;
     |CIERRA #90;
|FPRC;

|PROCESO Min90;
     #90#0 = #0#0;
     #90#4 = #0#1;
     #90#2 = 1;
|FPRC;

|PROCESO Max90;
     #90#0 = #0#0;
     #90#4 = #0#1;
     #90#2 = 999;
|FPRC;

|PROCESO TeclaDA; |TIPO 6;
     nTecla = FSalida;
     |SI nTecla = 16;  ||F8
          |HAZ DesAmpliada;
          |PUSHV 0501 2380;
          |ENTLINEAL #1#90, 3, 2, 22, 1, Min90, Max90;
          |POPV;
          nSwCtrlc = 1;
          |ERROR;
     |FINSI;
     |SI nTecla = 13; |Y #goparame#76 = "S"; ||F5
          nAlmacen = enAlmaCompras;
          eaArticulo = #0#2;
          |HAZ PideAlmaCompra2;
          #0#33 = enAlmaCompras;
          |PINTA #0#33;
          |HAZ PintaAlm;
          enAlmaCompras = nAlmacen;
          |ERROR;
     |FINSI;
     FSalida = nTecla;
|FPRC;

|PROCESO Ctrlc; |TIPO 11;
     |SI nSwCtrlc ! 0; |Y FSalida = 7;
          |MENAV "0000Imposible Cancelar, complete la linea...";
          |ERROR; |ACABA;
     |SINO;
          |SI FSalida = 1; |O FSalida = 7;
               |BLIN 24;
               |MODULO aAlfa;
               |SI aAlfa = "goprep2c"; |BLIN 23; |BLIN 22; |FINSI;
          |FINSI;
          |SI Campo = 1; |HAZ ConsultaLin; |FINSI;
     |FINSI;
|FPRC;

|| FUNCIONES ESPECIALES DE goprep2l (campo 31)
|PROCESO UniaPedir; |TIPO 0;
     nNume = #0#32 - #0#31; || Pend - Pedida
     |SI nNume < 0;
          |AVISO;
          |CONFI "0000NSe superan las pendientes, continuar";
          |SI FSalida ! 0; |ERROR; |ACABA; |FINSI;
     |FINSI;
     |SI #100#108 = "S"; |Y #0#31 > 0;
          |ABRE #480;
          #480#0 = #0#2;
          |LEE 000#480=;
          |SI FSalida = 0;
               |MENAV "0000Artículo con fabricación.";
               |CONFI "0000N¿Crear orden de fabricación?";
               |SI FSalida = 0;
                    || ser_exp + num + lin + arti + uni + num_exp
                    aAlfa = #6#3 + (("00000" + #0#0) % -105) + (("000" + #0#1) % -103) + #0#2 + (("            " + #0#31) % -112);
                    aAlfa = aAlfa + (("000000" + #6#7) % -106);
                    aAlfa = "guerz080;" + aAlfa;
                    |SUB_EJECUTA aAlfa;
                    |SI enError = 0;
                         #0#32 = #0#32 - #0#31;
                         |SI #0#32 < 0; #0#32 = 0; |FINSI;
                         |CONFI "0000S¿Despreciar unidades pendientes?";
                         |SI FSalida = 0; #0#32 = 0; |FINSI;
                         #0#31 = 0;
                         |PINTA #0#32;
                         |PINTA #0#31;
                         |PTEC 806;
                    |SINO;
                         |ERROR;
                    |FINSI;
               |FINSI;
          |FINSI;
          |CIERRA #480;
     |FINSI;
|FPRC;

|PROCESO UniParcial;
     |SI forma < 1;
          #0#32 = #0#32 + #0#31 + #0#34;
          #0#34 = 0;
     |SINO;
          nNume = #0#32 - #0#31; || Pend - Pedida
          |SI nNume > 0;
               |AVISO;
               |CONFI "0000S¿Despreciar unidades pendientes?";
               |SI FSalida = 0; #0#34 = nNume; nNume = 0; |FINSI;
          |FINSI;
          |SI nNume < 0;
               #0#34 = nNume;
               nNume = 0;
          |FINSI;
          #0#32 = nNume;
          #0#10 = "N";
     |FINSI;
     |PINTA #0#32;
     |PINTA #0#10;
|FPRC;

|PROCESO DetalleParPresu;
     #0#30 = #0#30 + (#102#7 * #103#8);
|FPRC;

|DEFBUCLE DetalleParPresu;
     #103#1;
     5;
     #102#0, #102#1, #102#2, #102#4, 001, #0#2;
     #102#0, #102#1, #102#2, #102#4, 999, #0#2;
     ;
     NULL, DetalleParPresu;
|FIN;

|PROCESO PartidasPresu;
     |BUCLE DetalleParPresu;
|FPRC;

|DEFBUCLE PartidasPresu;
     #102#1;
     ;
     #101#3, #101#4, "                    ", 001;
     #101#3, #101#4, "zzzzzzzzzzzzzzzzzzzz", 999;
     ;
     NULL, PartidasPresu;
|FIN;

|PROCESO LineaExpe;
     |BUCLE PartidasPresu;
|FPRC;

|DEFBUCLE LineaExpe;
     #101#1;
     ;
     #6#3, #6#7, 001;
     #6#3, #6#7, 999;
     ;
     NULL, LineaExpe;
|FIN;

|PROCESO Articulo0; |TIPO 0;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 1; |O aArtActual ! #0#2; |Y #6#15 = "S";
          #0#5 = 0;
          #0#30 = 0;
          #0#31 = 0;
          #0#32 = 0;
          #0#34 = 0;
          |BUCLE LineaExpe;
          #0#32 = #0#30;
          |PINTA #0#30;
          |PINTA #0#31;
          |PINTA #0#32;
          aArtiAnt = #0#2;
     |FINSI;
|FPRC;

|PROCESO Linea0; |TIPO 0,
     |C_M #0#23, 1, "N";
     eaArtiAnt = #0#2;
|FPRC;

|PROCESO Cantidad7; |TIPO 7; || goprepel
     |HAZ CogeValores28;
     |HAZ Conversion;
     |SI #6#15 = "N";
          |HAZ DobleUniPrePe1;
     |FINSI;
|FPRC;

|PROCESO Unidad7; |TIPO 7; || goprep2l
     |HAZ CogeValores28;
     |SI #6#15 = "S";
          |HAZ DobleUniPrePe2;
     |FINSI;
|FPRC;

|PROCESO DobleUniPrePe1;
     |C_M #0#5, 1, "S";

     |ABRE #5;
     #5#0 = #0#2;
     |LEE 000#5=;
     |SI FSalida = 0; |Y #5#179 = "S";
          ||eaArtiAnt  (se cargar en el tipo 0 de la linea)
          eaArticulo = #0#2;
          enUnidad1 = #0#5;
          enUnidad2 = #0#14;
          enMedida1 = #0#17;
          enMedida2 = #0#18;
          enMedida3 = #0#19;
          eaPartida = #0#15;
          enModoVta = (FEntrada / 100) ! 0;
          |SUB_EJECUTA_NP "dsz99907";
          |SI eaSw2Stock = "S";
               |C_M #0#5, 1, "N";
               #0#5 = enUnidad1; |PINTA #0#5;
               #0#14 = enUnidad2;
               #0#17 = enMedida1;
               #0#18 = enMedida2;
               #0#19 = enMedida3;
               #0#16 = eaPartida;
          |SINO;
               #0#14 = 0;
               #0#17 = 0;
               #0#18 = 0;
               #0#19 = 0;
          |FINSI;
     |FINSI;
     |CIERRA #5;
|FPRC

|PROCESO DobleUniPrePe2;
     |C_M #0#31, 1, "S";

     |ABRE #5;
     #5#0 = #0#2;
     |LEE 000#5=;
     |SI FSalida = 0; |Y #5#179 = "S";
          ||eaArtiAnt  (se cargar en el tipo 0 de la linea)
          eaArticulo = #0#2;
          enUnidad1 = #0#31;
          enUnidad2 = #0#35;
          enMedida1 = #0#17;
          enMedida2 = #0#18;
          enMedida3 = #0#19;
          eaPartida = #0#15;
          enModoVta = (FEntrada / 100) ! 0;
          |SUB_EJECUTA_NP "dsz99907";
          |SI eaSw2Stock = "S";
               |C_M #0#31, 1, "N";
               #0#31 = enUnidad1; |PINTA #0#31;
               #0#35 = enUnidad2;
               #0#17 = enMedida1;
               #0#18 = enMedida2;
               #0#19 = enMedida3;
               #0#16 = eaPartida;
          |SINO;
               #0#35 = 0;
               #0#17 = 0;
               #0#18 = 0;
               #0#19 = 0;
          |FINSI;
     |FINSI;
     |CIERRA #5;
|FPRC

|PROCESO ImprimeRese;
     |IMPRE 0;
     |SI FSalida = 0;
          |INFOR "guerm025";
          |SI FSalida = 0;
               |PRINT;
               |PIEINF;
               |FININF;
          |SINO;
               |MENAV "0000No existe informe 'guerm025'...";
          |FINSI;
          |FINIMP;
     |FINSI;
|FPRC;
-------------------------------------------------------------------------
|PROCESO SelecPdte;
     |SI #73#6 = 0;
          |ACABA;
     |FINSI;

     #123#0 = #73#0;
     #123#1 = #73#1;
     #123#2 = #73#2;
     #123#3 = 999;
     |LEE 000#123];
     |SI FSalida = 0;
          |LEE 000#123a;
     |SINO;
          |LEE 000#123u;
     |FINSI;
     |SI FSalida = 0; |Y #123#0 = #73#0; |Y #123#1 = #73#1; |Y #123#2 = #73#2;
          nLin = #123#4 + 1;
     |SINO;
          nLin = 1;
     |FINSI;
     |DDEFECTO #123;
     #123#0 = #73#0;
     #123#1 = #73#1;
     #123#2 = #73#2;
     #123#3 = nLin;
     #123#4 = #73#7;
     #123#5 = #73#6;
     #123#7 = #100#51;  || Almacen Deposito
     #123#8 = #0#0;
     #123#9 = #0#1;
     |GRABA 020#123n;
|FPRC;

|DEFBUCLE SelecPdte;
     #73#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, SelecPdte;
|FIN;

|PROCESO Tecla79; |TIPO 0;
     |SI FSalida = 0; |Y #73Campo = Contenido;
          nPdteRec = nPdteRec - #73#6;
          |SI #73#6 = 0;
               #73#6 = #73#5;
          |FINSI;
       |ET Otra673;
          |ENCAMPO #6#73;
          |SI FSalida = 0;
               nUni = nPdteRec + #73#6;
               |SI nUni > #0#32;
                    nUni = nUni - #0#32;
                    aAlfa = "0000Se superan las unidades pendientes " + #0#32 + " en " + nUni + " unidades.";
                    |MENAV aAlfa;
                    |VETE Otra673;
               |FINSI;
               |GRABA 020#73a;
               nPdteRec = nPdteRec + #73#6;
          |FINSI;
          |LEE 000#73=;
          |PINTA #73#6;
     |FINSI;
|FPRC;

|PROCESO Min73;
     #73#0 = "     ";
     #73#1 = 1;
     #73#2 = 1;
|FPRC;

|PROCESO Max73;
     #73#0 = "zzzzz";
     #73#1 = 999999;
     #73#2 = 999;
|FPRC;

|PROCESO PdteRec1;
     nUniRes = 0;
     |DDEFECTO #123;
     #123#0 = #2#28;
     #123#1 = #2#0;
     #123#2 = #2#1;
     #123#1 = 1;
     |LEE 000#123];
     |PARA; |SI FSalida = 0; |Y #123#0 = #2#28; |Y #123#1 = #2#0;
               |Y #123#2 = #2#1; |HACIENDO;
          nUniRes = nUniRes + #123#5;
          |LEE 000#123s;
     |SIGUE;

     nPdteRec = #2#5 - #2#38 - nUniRes;
     |SI nPdteRec > 0;
          nHay = nHay + 1;
          #73#0 = #2#28;
          #73#1 = #2#0;
          #73#2 = #2#1;
          #73#3 = #2#5;
          #73#4 = #2#38;
          #73#5 = nPdteRec;
          #73#6 = 0;
          #73#7 = #0#2;
          #73#8 = #0#3;
          #73#9 = nAlma;
          |GRABA 020#73n;
     |FINSI;
|FPRC;

|DEFBUCLE PdteRec1;
     #2#3;
     3;
     #0#2, "     ", 000001, "      ", nAlma;
     #0#2, "zzzzz", 999999, "zzzzzz", nAlma;
     ;
     NULL, PdteRec1;
|FIN;

|PROCESO ResPdtRecibir;
     |SI #0#33 = 0;
          nAlma = enAlmaCompras;
     |SINO;
          nAlma = #0#33;
     |FINSI;

     |HAZ CreaTempo; |NOME_DAT #73 Tempo; |DELINDEX #73;

     nHay = 0;
     |ABRE #73;
     |ABRE #123;
     |BUCLE PdteRec1;
     |CIERRA #123;
     |CIERRA #73;

     |SI nHay ! 0;
          nPdteRec = 0;
          |PUSHV 0501 2480;
          |BLIN 24;
          |ENTLINEAL #1#73, 3, 4, 19, 1, Min73, Max73;
          |POPV;
          |SI nPdteRec ! 0;
               |CONFI "0000S¿Es correcta la seleeción?";
               |SI FSalida = 0;
                    |ABRE #123;
                    |BUCLE SelecPdte;
                    |CIERRA #123;
                    |CONFI "0000S¿Actualizar unidades pendientes?";
                    |SI FSalida = 0;
                         #0#32 = #0#32 - nPdteRec;
                         |GRABA 020#0a;
                         |PINTA #0#32;
                    |FINSI;
               |FINSI;
          |FINSI;
     |SINO;
          |MENAV "0000No hay unidades pendientes...";
     |FINSI;

     |HAZ BoraTempo; |DELINDEX #73;
|FPRC;
--------------------------------------------------------------------
|PROCESO AnulaSelecPdte;
     |SI #74#10 = "*";
          #123#0 = #74#0;
          #123#1 = #74#1;
          #123#2 = #74#2;
          #123#3 = #74#3;
          |LEE 121#123=;
          |SI FSalida = 0;
               |SI #123#6 = 0;
                    |BORRA 020#123a;
               |SINO;
                    #123#5 = #123#6;
                    #123#6 = 0;
                    |GRABA 020#123a;
               |FINSI;
               |LIBERA #123;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE AnulaSelecPdte;
     #74#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, AnulaSelecPdte;
|FIN;

|PROCESO ReservaRec;
     nUni = #123#5 - #123#6;
     |SI nUni > 0;
          |DDEFECTO #74;
          #74#0 = #123#0;
          #74#1 = #123#1;
          #74#2 = #123#2;
          #74#3 = #123#3;
          #74#4 = #123#4;
          #74#5 = #123#5;
          #74#6 = #123#6;
          #74#7 = #123#7;
          #74#8 = #123#8;
          #74#9 = #123#9;
          #74#11 = #0#3;
          |GRABA 020#74n;
          nHay = 1;
     |FINSI;
|FPRC;

|DEFBUCLE ReservaRec;
     #123#3;
     ;
     #0#0, #0#1;
     #0#0, #0#1;
     ;
     NULL, ReservaRec;
|FIN;

|PROCESO Tecla74; |TIPO 0;
     |SI #74Campo = Contenido; |Y FSalida = 0;
          |SI #74#10 = "*";
               #74#10 = "";
               nPdteRec = nPdteRec - (#74#5 - #74#6);
          |SINO;
               #74#10 = "*";
               nPdteRec = nPdteRec + (#74#5 - #74#6);
          |FINSI;
          |GRABA 020#74a;
     |FINSI;
|FPRC;

|PROCESO Min74;
     #74#0 = "     ";
     #74#1 = 000001;
     #74#2 = 001;
|FPRC;

|PROCESO Max74;
     #74#0 = "zzzzz";
     #74#1 = 999999;
     #74#2 = 999;
|FPRC;

|PROCESO AnulaResPdtRecibir;
     |HAZ CreaTempo; |NOME_DAT #74 Tempo; |DELINDEX #74;

     nHay = 0;
     |ABRE #74;
     |BUCLE ReservaRec;
     |CIERRA #74;
     |SI nHay ! 0;
          nPdteRec = 0;
          |PUSHV 0501 2480;
          |BLIN 24;
          |ENTLINEAL #2#74, 1, 4, 19, 1, Min74, Max74;
          |POPV;
          |SI nPdteRec ! 0;
               |CONFI "0000S¿Es correcta la seleeción?";
               |SI FSalida = 0;
                    |ABRE #123;
                    |BUCLE AnulaSelecPdte;
                    |CIERRA #123;
                    |CONFI "0000S¿Actualizar unidades pendientes?";
                    |SI FSalida = 0;
                         #0#32 = #0#32 + nPdteRec;
                         |GRABA 020#0a;
                         |PINTA #0#32;
                    |FINSI;
               |FINSI;
          |FINSI;
     |SINO;
          |MENAV "0000No hay unidades reservadas pendientes de recibir...";
     |FINSI;


     |HAZ BoraTempo; |DELINDEX #74;
|FPRC;

|PROCESO VerReservaRec;
     nUni = #123#5 - #123#6;
     |SI nUni > 0;
          |SALVA_DATOS #123;
          |REPON_DATOS #referen@;
          |GRABA 020#referen@.n;
          nHay = 1;
     |FINSI;
|FPRC;

|DEFBUCLE VerReservaRec;
     #123#3;
     ;
     #0#0, #0#1;
     #0#0, #0#1;
     ;
     NULL, VerReservaRec;
|FIN;

|PROCESO VerResPdtRecibir;
     |DDEF aAlfa;
     aAlfa = aAlfa + "guerm123";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |HAZ CreaTempo; |NOME_DAT #referen@#Tempo#; |DELINDEX #referen@;

     nHay = 0;
     |ABRE #referen@;
     |BUCLE VerReservaRec;
     |SI nHay ! 0;
          |LEE 000#referen@.p;
          |CONSULTA_CLAVE #1#referen@;
     |SINO;
          |MENAV "0000No hay unidades reservadas pendientes de recibir...";
     |FINSI;
     |CIERRA #referen@;
     |HAZ BoraTempo; |DELINDEX #referen@;
|FPRC;
