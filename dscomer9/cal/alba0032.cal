|FICHEROS;
     alba0032 #99;  || Este def.
     alba0031 #0;   || Fichero de control de parametros para el pase.
     agifa091 #1;   || Formas de Pago.
     agifa024 #2;   || Clientes.
     agifa019 #3;   || Articulos.
     agifa027 #5;   || Contadores.
     ||agifa114 #6;   || Recibos de cobros.
     agifa017 #7;   || Datos Articulo Almacen.
     agifa023 #8;   || Precios Cliente/Articulo.
     agifa039 #9;   || Descuento Cliente/Familia.
     alba0037 #10;  || Visitas.
     psion018 #11;  || Datos Empresa Por Serie.
     dsm00134 #12;  || Promociones Ventas
     agifa007 #13;  || Series
     dsm00024 #24;
     dscam045@ #200;
     dscam003@ #201;
|FIN;

|VARIABLES;
     &enTiva = 0;
     &efFiva = @;
     &eaDiva = "";
     &enIva = 0;
     &enRec = 0;
     nAlma = 0;
     aFinReg = "";
     path = "";
     empresa  = "";
     cadena   = "";
     fichero  = "";
     long     = "";
     caracter = "";
     campo    = "";
     variable = "";
     alfa     = "";
     tab1     = 0;
     final1   = 0;
     final2   = 0;
     tab      = "";
     final    = "";
     i        = 0;
     f        = 0;
     ind      = 0;
     valor    = 0;
     sw       = 0;
     pasa     = 0;
     jj       = 0;
     sal      = 0;
     guarda   = 0;
     se1      = "";
     se2      = "";
     se3      = "";
     se4      = "";
     se5      = "";
     se6      = "";
     se7      = "";
     se8      = "";
     se9      = "";
     se10     = "";
     se11     = "";
     se12     = "";
     con1     = 0;
     con2     = 0;
     con3     = 0;
     con4     = 0;
     con5     = 0;
     con6     = 0;
     con7     = 0;
     con8     = 0;
     con9     = 0;
     con10    = 0;
     con11    = 0;
     con12    = 0;
     pp = 0;
     fecha = @;

     aAlfa = "";
     nEmpresa = 0;
|FIN;

|PROCESO dsm00024;
     #3#0 = #24#0;
     |LEE 000#3=;
     |SI FSalida ! 0; |O #3#180 = "N"; |ACABA; |FINSI;

     |SI #3#125 < #0#36; |O #3#125 > #0#37; |ACABA; |FINSI; ||Linea
     |SI #3#2 < #0#9; |O #3#2 > #0#10; |ACABA; |FINSI;      ||Familia

     |SI #24#22 [ 0; || Sin Stock
          |ACABA;
     |FINSI;

     campo = #24#0; |QBF campo;
     variable = campo + tab;
     campo = #24#2; |QBF campo;
     variable = variable + campo + tab;
     |PINTA 1922,"                                                         ";
     |PINTA 1922, "PARTIDA   :";
     |PINTA 1935,variable;
     campo = #24#22; |QBF campo;
     variable = variable + campo;

     cadena = f + " " + variable + aFinReg;
     |FGRABA cadena;

     variable = "";
|FPRC;

|DEFBUCLE dsm00024;
     #24#1;
     ;
     #0#7, nAlma, "                              ";
     #0#8, nAlma, "zzzzzzzzzzzzzzzzzzzzzzzzzzzzzz";
     ;
     NULL, dsm00024;
|FIN;

|PROCESO Partidas;
     empresa = #0#29;
     |QBF empresa;
     empresa = empresa + "partidas.asc";
     |QBF empresa;
     fichero = "wb  " + empresa;
     |QBF fichero;
     |FABRE fichero;
     f = FSalida;

     nAlma = #0#27;
     |ABRE #3;
     |BUCLE dsm00024;
     |CIERRA #3;

     f = 0;
     FSalida = f;
     |FCIERRA FSalida;
     Pos = -1;
|FPRC;

||------------------------------  CLIENTES ----------------------------------

|PROCESO pasa_cli;
     |SI f ] 0;
          campo = #2#0;  |QBF campo;
          variable = campo + tab;
          campo = #2#1;  |QBF campo;
          variable = variable + campo + tab;
               |PINTA 1922,"                                                         ";
               |PINTA 1922,"CLIENTES:";
               |PINTA 1935,variable;
          campo = #2#2;  |QBF campo;
          variable = variable + campo + tab;
          campo = #2#5;  |QBF campo;
          variable = variable + campo + tab;
          campo = #2#6;  |QBF campo;
          variable = variable + campo + tab;
          campo = #2#180;|QBF campo;
          variable = variable + campo + tab;
          campo = #2#7;  |QBF campo;
          variable = variable + campo + tab;
          campo = #2#15; |QBF campo;
          variable = variable + campo + tab;
          campo = #2#17; |QBF campo;
          variable = variable + campo + tab;

          cadena = f + " " + variable;
          |FGRABA cadena;
          variable = "";

          campo = #2#47; |QBF campo;
          variable = variable + campo + tab;
          campo = #2#20; |QBF campo;
          variable = variable + campo + tab;
          campo = #2#39; |QBF campo;
          variable = variable + campo + tab;
          campo = #2#3;  |QBF campo;
          variable = variable + campo + tab;
          campo = #2#158; |QBF campo;
          variable = variable + campo + tab;
          campo = #2#37; |QBF campo;
          variable = variable + campo + tab;
          campo = #2#38; |QBF campo;
          variable = variable + campo + tab;
          campo = #2#156; |QBF campo;
          variable = variable + campo + final;
          cadena = f + " " + variable + aFinReg;
          |FGRABA cadena;
          campo = "";
          variable = "";
          cadena = "";
     |FINSI;
|FPRC;

|DEFBUCLE lee_cli;
     #2#1;
     3,158,4,25,39;
     #0#2,#0#4,#0#31,#0#33,#0#39,#0#51;
     #0#3,#0#5,#0#32,#0#34,#0#40,#0#52;
     be;
     NULL,pasa_cli;
|FIN;

|PROCESO clientes;
     empresa = #0#29;
     |QBF empresa;
     empresa = empresa + "clientes.asc";
     |QBF empresa;
     fichero = "wb  " + empresa;
     |QBF fichero;
     |FABRE fichero;
     f = FSalida;
     |BUCLE lee_cli;
     f = 0;
     FSalida = f;
     |FCIERRA FSalida;
     Pos = -1;
|FPRC;

||--------------------------  ARTICULOS  ------------------------------------

|PROCESO pasa_art;
     |SI f ] 0;
          campo = #3#0; |QBF campo;
          variable = campo + tab;
          campo = #3#1; |QBF campo;
          variable = variable + campo + tab;
               |PINTA 1922,"                                                         ";
               |PINTA 1922,"ARTICULOS:";
               |PINTA 1935,variable;
          campo = #3#2; |QBF campo;
          variable = variable + campo + tab;
          campo = #3#128; |QBF campo;
          variable = variable + campo + tab;
          campo = #3#30; |QBF campo;
          variable = variable + campo + tab;
          campo = #3#18; |QBF campo;
          variable = variable + campo + tab;
          campo = #3#19; |QBF campo;
          variable = variable + campo + tab;
          campo = #3#20; |QBF campo;
          variable = variable + campo + tab;
          campo = #3#147; |QBF campo;
          variable = variable + campo + tab;
          campo = #3#148; |QBF campo;
          variable = variable + campo + tab;
          campo = #3#149; |QBF campo;
          variable = variable + campo + tab;
          campo = #3#21; |QBF campo;
          variable = variable + campo + tab;
          campo = #3#22; |QBF campo;
          variable = variable + campo + tab;
          campo = #3#23; |QBF campo;
          variable = variable + campo + tab;
          campo = #3#150; |QBF campo;
          variable = variable + campo + tab;
          campo = #3#151; |QBF campo;
          variable = variable + campo + tab;
          campo = #3#152; |QBF campo;
          variable = variable + campo + tab;
          |ABRE #7;
          #7#0 = #3#0;
          #7#1 = #0#27;
          |LEE 000#7=;
          |SI FSalida ! 0;
            |DDEFECTO #7;
            #7#0 = #3#0;
            #7#1 = #0#27;
            |GRABA 000#7c;
            |LIBERA #7;
          |FINSI;
          |LIBERA #7;
          |CIERRA #7;
          campo = #7#5; |QBF campo;
          variable = variable + campo + tab;
          campo = #3#179; |QBF campo;

          variable = variable + campo + tab;
          campo = #3#180;

          variable = variable + campo + final;
          cadena = f + " " + variable;
          |FGRABA cadena;
          campo = "";
          variable = "";
          cadena = "";
     |FINSI;
|FPRC;

|DEFBUCLE lee_art;
     #3#1;
     2,125;
     #0#7,#0#9,#0#36;
     #0#8,#0#10,#0#37;
     be;
     NULL,pasa_art;
|FIN;

|PROCESO articulos;
     empresa = #0#29;
     |QBF empresa;
     empresa = empresa + "articulo.asc";
     |QBF empresa;
     fichero = "wt  " + empresa;
     |QBF fichero;
     |FABRE fichero;
     f = FSalida;
     |BUCLE lee_art;
     f = 0;
     FSalida = f;
     |FCIERRA FSalida;
     Pos = -1;
|FPRC;

||---------------------------- FORMAS DE PAGO -------------------------------

|PROCESO pasa_pago;
     |SI f ] 0;
          campo = #1#0; |QBF campo;
          variable = campo + tab;
          campo = #1#1; |QBF campo;
          variable = variable + campo + tab;
               |PINTA 1922,"                                                         ";
               |PINTA 1922,"F.PAGO:";
               |PINTA 1935,variable;
          campo = #1#3; |QBF campo;
          variable = variable + campo + tab;
          campo = #1#2; |QBF campo;
          variable = variable + campo + tab;
          campo = #1#4; |QBF campo;
          variable = variable + campo + final;
          cadena = f + " " + variable;
          |FGRABA cadena;
          campo = "";
          variable = "";
          cadena = "";
     |FINSI;
|FPRC;

|DEFBUCLE lee_pago;
     #1#1;
     ;
     "  ";
     "zz";
     be;
     NULL,pasa_pago;
|FIN;

|PROCESO f_pago;
     empresa = #0#29;
     |QBF empresa;
     empresa = empresa + "fpago.asc";
     |QBF empresa;
     fichero = "wt  " + empresa;
     |QBF fichero;
     |FABRE fichero;
     f = FSalida;
     |BUCLE lee_pago;
     f = 0;
     FSalida = f;
     |FCIERRA FSalida;
     Pos = -1;
|FPRC;

||------------------------- FICHERO DE I.V.A. ------------------------------

|PROCESO lee_iva;
     |PARA enTiva = 0; |SI enTiva [ 5; |HACIENDO enTiva = enTiva + 1;
          efFiva = ~;
          |HAZ SacaIVA;
          |SI f ] 0; |Y eaDiva ! "";
               campo = enTiva; |QBF campo;
               variable = campo + tab;
               campo = enIva; |QBF campo;
               variable = variable + campo + tab;
               campo = enRec; |QBF campo;
               variable = variable + campo + final;
                    |PINTA 1922,"                                                         ";
                    |PINTA 1922,"TIPOS IVA:";
                    |PINTA 1935,variable;
               cadena = f + " " + variable;
               |FGRABA cadena;
               campo = "";
               variable = "";
               cadena = "";
          |FINSI;
     |SIGUE;
|FPRC;

|PROCESO f_iva;
     empresa = #0#29;
     |QBF empresa;
     empresa = empresa + "iva.asc";
     |QBF empresa;
     fichero = "wt  " + empresa;
     |QBF fichero;
     |FABRE fichero;
     f = FSalida;
     |HAZ lee_iva;
     f = 0;
     FSalida = f;
     |FCIERRA FSalida;
     Pos = -1;
|FPRC;

||----------------------- FICHERO DE CONTADOR ----------------------------

|PROCESO pasa_contador;
     |SI f ] 0;
          alfa = #5#0;
          |QBF alfa;
          |SI alfa = "valbaran";
               |SI #5#2=#0#12; |O #5#2=#0#13; |O #5#2=#0#14; |O #5#2=#0#15;
                    |SI se1 = ""; se1 = #5#2; con1 = #5#1 - 1; |ACABA; |FINSI;
                    |SI se2 = ""; se2 = #5#2; con2 = #5#1 - 1; |ACABA; |FINSI;
                    |SI se3 = ""; se3 = #5#2; con3 = #5#1 - 1; |ACABA; |FINSI;
                    |SI se4 = ""; se4 = #5#2; con4 = #5#1 - 1; |ACABA; |FINSI;
               |FINSI;
          |FINSI;
          |SI alfa = "vfactuco";
               |SI #5#2=#0#16; |O #5#2=#0#17; |O #5#2=#0#18; |O #5#2=#0#19;
                    |SI se5 = ""; se5 = #5#2; con5 = #5#1 - 1; |ACABA; |FINSI;
                    |SI se6 = ""; se6 = #5#2; con6 = #5#1 - 1; |ACABA; |FINSI;
                    |SI se7 = ""; se7 = #5#2; con7 = #5#1 - 1; |ACABA; |FINSI;
                    |SI se8 = ""; se8 = #5#2; con8 = #5#1 - 1; |ACABA; |FINSI;
               |FINSI;
          |FINSI;
          |SI alfa = "vpedido";
               |SI #5#2=#0#23; |O #5#2=#0#24; |O #5#2=#0#25; |O #5#2=#0#26;
                    |SI se9  = ""; se9  = #5#2; con9  = #5#1 - 1; |ACABA; |FINSI;
                    |SI se10 = ""; se10 = #5#2; con10 = #5#1 - 1; |ACABA; |FINSI;
                    |SI se11 = ""; se11 = #5#2; con11 = #5#1 - 1; |ACABA; |FINSI;
                    |SI se12 = ""; se12 = #5#2; con12 = #5#1 - 1; |ACABA; |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE lee_contador;
     #5#1;
     ;
     "  ","                               ";
     "zz","zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz";
     be;
     NULL,pasa_contador;
|FIN;

|PROCESO f_contador;
     empresa = #0#29;
     |QBF empresa;
     empresa = empresa + "contador.asc";
     |QBF empresa;
     fichero = "wt  " + empresa;
     |QBF fichero;
     |FABRE fichero;
     f = FSalida;
     |BUCLE lee_contador;
     FSalida = f;
     campo = se1; |QBF campo;
     variable = campo + tab;
     campo = se2; |QBF campo;
     variable = variable + campo + tab;
     campo = se3; |QBF campo;
     variable = variable + campo + tab;
     campo = se4; |QBF campo;
     variable = variable + campo + tab;
     |PINTA 1922,"                                                         ";
     |PINTA 1922,"CONTADORES:";
     |PINTA 1935,variable;
     campo = se5; |QBF campo;
     variable = variable + campo + tab;
     campo = se6; |QBF campo;
     variable = variable + campo + tab;
     campo = se7; |QBF campo;
     variable = variable + campo + tab;
     campo = se8; |QBF campo;
     variable = variable + campo + tab;
     campo = se9; |QBF campo;
     variable = variable + campo + tab;
     campo = se10; |QBF campo;
     variable = variable + campo + tab;
     campo = se11; |QBF campo;
     variable = variable + campo + tab;
     campo = se12; |QBF campo;
     variable = variable + campo + tab;
     campo = con1; |QBF campo;
     variable = variable + campo + tab;
     campo = con2; |QBF campo;
     variable = variable + campo + tab;
     campo = con3; |QBF campo;
     variable = variable + campo + tab;
     campo = con4; |QBF campo;
     variable = variable + campo + tab;
     campo = con5; |QBF campo;
     variable = variable + campo + tab;
     campo = con6; |QBF campo;
     variable = variable + campo + tab;
     campo = con7; |QBF campo;
     variable = variable + campo + tab;
     campo = con8; |QBF campo;
     variable = variable + campo + tab;
     campo = con9; |QBF campo;
     variable = variable + campo + tab;
     campo = con10; |QBF campo;
     variable = variable + campo + tab;
     campo = con11; |QBF campo;
     variable = variable + campo + tab;
     campo = con12; |QBF campo;
     variable = variable + campo + final;
     cadena = f + " " + variable;
     |FGRABA cadena;
     f = 0;
     FSalida = f;
     |FCIERRA FSalida;
     Pos = -1;
     cadena = "";
     campo = "";
     variable = "";
|FPRC;

||------------------------- FICHERO DE COBROS -------------------------------
/*
|PROCESO pasa_recibos;
 |ABRE #2;
 #2#0 = #6#2;
 |LEE 000#2=;
 |LIBERA #2;
 |SI #2#0 ] #0#2;|Y #2#0 [ #0#3;
   |SI #2#3 ] #0#4;|Y #2#3 [ #0#5;
     |SI #2#25 ] #0#39;|Y #2#25 [ #0#40;
       |SI #2#158 ] #0#31;|Y #2#158 [ #0#32;
         |SI #2#4 ] #0#33;|Y #2#4 [ #0#34;
          |SI #2#39 ] #0#51;|Y #2#39 [ #0#52;
           |SI f ] 0;
              campo = #6#17; |QBF campo;
              variable = campo + tab;
              campo = #6#0; |QBF campo;
              variable = variable + campo + tab;
                   |PINTA 1922,"                                                         ";
                   |PINTA 1922,"REC.COBROS:";
                   |PINTA 1935,variable;
              pp = #6#1;
              campo = #6#1;  |QBF campo;
              variable = variable + campo + tab;
              campo = #6#3;  |QBF campo;
              variable = variable + campo + tab;
              campo = #6#9;  |QBF campo;
              variable = variable + campo + tab;
              campo = #6#19; |QBF campo;
              variable = variable + campo + tab;
              campo = "N";   |QBF campo;
              variable = variable + campo + tab;
              campo = #2#2;  |QBF campo;
              |SI campo = "";
                campo = #2#1;  |QBF campo;
              |FINSI;
              variable = variable + campo + final;
              cadena = f + " " + variable;
              |FGRABA cadena;
              campo = "";
              variable = "";
              cadena = "";
            |FINSI;
           |FINSI;
         |FINSI;
       |FINSI;
     |FINSI;
   |FINSI;
 |FINSI;
 |CIERRA #2;
|FPRC;

|DEFBUCLE lee_recibos;
     #6#1;
     2,13;
     "  ",000000,  0,#0#2,"N";
     "zz",999999,999,#0#3,"N";
     be;
     NULL,NULL,NULL,NULL,NULL,pasa_recibos;
     #6#2;
|FIN;
*/

|PROCESO pasa_recibos;
 |SI #dscam003@#14 ! "P"; |O #dscam003@#14 ! "C"; |O #dscam003@#14 ! "I"; |ACABA; |FINSI;
 aAlfa = "|C090TIPO"; aAlfa = #dscam003@#aAlfa#;
 |SI aAlfa ! "F";
    |SI #dscam003@#90 = "S"; |ACABA; |FINSI;
 |FINSI;
 |SI #dscam003@#46 ! #48#0;  |ACABA; |FINSI;

 |ABRE #2;
 #2#0 = #dscam003@#32;
 |LEE 000#2=;
 |LIBERA #2;
 |SI #2#0 ] #0#2;|Y #2#0 [ #0#3;
   |SI #2#3 ] #0#4;|Y #2#3 [ #0#5;
     |SI #2#25 ] #0#39;|Y #2#25 [ #0#40;
       |SI #2#158 ] #0#31;|Y #2#158 [ #0#32;
         |SI #2#4 ] #0#33;|Y #2#4 [ #0#34;
          |SI #2#39 ] #0#51;|Y #2#39 [ #0#52;
           |SI f ] 0;
              campo = #dscam003@#0; |QBF campo;
              variable = campo + tab;
              campo = #dscam003@#1; |QBF campo;
              variable = variable + campo + tab;
                   |PINTA 1922,"                                                         ";
                   |PINTA 1922,"REC.COBROS:";
                   |PINTA 1935,variable;
              pp = #dscam003@#2;
              campo = #dscam003@#2;  |QBF campo;
              variable = variable + campo + tab;
              campo = #dscam003@#6;  |QBF campo;
              variable = variable + campo + tab;
              campo = #dscam003@#30;  |QBF campo;
              variable = variable + campo + tab;
              campo = #dscam003@#23; |QBF campo;
              variable = variable + campo + tab;
              campo = "N";   |QBF campo;
              variable = variable + campo + tab;
              campo = #2#2;  |QBF campo;
              |SI campo = "";
                campo = #2#1;  |QBF campo;
              |FINSI;
              campo = campo + (("000000000" + #dscam003@#40) % -109);
              variable = variable + campo + final;
              cadena = f + " " + variable;
              |FGRABA cadena;
              campo = "";
              variable = "";
              cadena = "";
            |FINSI;
           |FINSI;
         |FINSI;
       |FINSI;
     |FINSI;
   |FINSI;
 |FINSI;
 |LIBERA #2;
 |CIERRA #2;
|FPRC;

|DEFBUCLE lee_recibos;
/*
   #dscam003@#9005;
   32, 31;
   00, #dscam045@#4, 000000, 000, 000000001, #0#2, 0000000001;
   99, #dscam045@#5, 999999, 999, 999999999, #0#3, 9999999999;
   be;
   NULL,pasa_recibos;
*/
   #dscam003@#12006;
   31;
   #dscam045@#4, 000000, 000, "00.00.0000", "            ", #0#2, 0.0001;
   #dscam045@#5, 999999, 999, "31.12.9999", "zzzzzzzzzzzz", #0#3, 9999999999.9999;
   be;
   NULL,pasa_recibos;
|FIN;

|PROCESO LineasCtrl;
   |DBASS aAlfa; |QBF aAlfa;
   aAlfa = aAlfa + "dscarter/fich/" + (("00000" + #dscam045@#6) % -105) + "/"; |PATH_DAT #201 aAlfa;
   |ABRE #dscam003@;
   |BUCLE lee_recibos;
   |CIERRA #dscam003@;
|FPRC;

|DEFBUCLE LineasCtrl;
#dscam045@#1002;
2;
nEmpresa, 001, "V";
nEmpresa, 999, "V";
;
NULL,LineasCtrl;
|FIN;

|PROCESO f_cobros;
     empresa = #0#29;
     |QBF empresa;
     empresa = empresa + "cobros.asc";
      |QBF empresa;
     fichero = "wt  " + empresa;
     |QBF fichero;
     |FABRE fichero;
     f = FSalida;

     |DBASS aAlfa; |QBF aAlfa; aAlfa = aAlfa + "dscarter/def/dscam045.mas";
     |CARGA_DEF aAlfa, dscam045@;
     |SI FSalida = 0;
        |DBASS aAlfa; |QBF aAlfa;
        aAlfa = aAlfa + "dscarter/fich/"; |PATH_DAT #200 aAlfa;
        |DBASS aAlfa; |QBF aAlfa;
        aAlfa = aAlfa + "dscarter/def/dscam003.mas";
        |CARGA_DEF aAlfa, dscam003@;
        |SI FSalida = 0;
           nEmpresa = #48#0; |BUCLE LineasCtrl;
           |DESCARGA_DEF #dscam003@;
        |FINSI;
        |DESCARGA_DEF #dscam045@;
     |FINSI;

     f = 0;
     FSalida = f;
     |FCIERRA FSalida;
     Pos = -1;
|FPRC;
||------------------------- FICHERO DE PRECIOS -----------------------------

|PROCESO pasa_precios;
     |ABRE #2;
     #2#0 = #8#0;
     |LEE 000#2=;
     |LIBERA #2;
     |ABRE #3;
     #3#0 = #8#1;
     |LEE 000#3=;
     |LIBERA #3;
     |SI #3#3 ] #0#9;|Y #3#3 [ #0#10;
       |SI #3#125 ] #0#36;|Y #3#125 [ #0#37;
         |SI #2#3 ] #0#4;|Y #2#3 [ #0#5;
           |SI #2#25 ] #0#39;|Y #2#25 [ #0#40;
             |SI #2#158 ] #0#31;|Y #2#158 [ #0#32;
               |SI #2#4 ] #0#33;|Y #2#4 [ #0#34;
                 |SI #2#39 ] #0#51;|Y #2#39 [ #0#52;
                   |SI f ] 0;
                     campo = #8#0; |QBF campo;
                     variable = campo + tab;
                     campo = #8#1; |QBF campo;
                     variable = variable + campo + tab;
                     campo = #8#2;  |QBF campo;
                     variable = variable + campo + tab;
                     |PINTA 1922,"                                                         ";
                     |PINTA 1922,"PRE.CLI/ART:";
                     |PINTA 1935,variable;
                     campo = #8#32;  |QBF campo;
                     variable = variable + campo + final;
                     cadena = f + " " + variable;
                     |FGRABA cadena;
                     campo = "";
                     variable = "";
                     cadena = "";
                   |FINSI;
                 |FINSI;
               |FINSI;
             |FINSI;
           |FINSI;
         |FINSI;
       |FINSI;
     |FINSI;
     |LIBERA #3;
     |CIERRA #3;
     |LIBERA #2;
     |CIERRA #2;
|FPRC;

|DEFBUCLE lee_precios;
     #8#1;
     ;
     #0#2 , #0#7;
     #0#3 , #0#8;
     be;
     NULL,pasa_precios;
|FIN;

|PROCESO f_precios;
     empresa = #0#29;
     |QBF empresa;
     empresa = empresa + "precios.asc";
     |QBF empresa;
     fichero = "wt  " + empresa;
     |QBF fichero;
     |FABRE fichero;
     f = FSalida;
     |BUCLE lee_precios;
     f = 0;
     FSalida = f;
     |FCIERRA FSalida;
     Pos = -1;
|FPRC;

||------------------------- FICHERO DE DTOS.FAMILIA -------------------------

|PROCESO pasa_dtofam;
     |ABRE #2;
     #2#0 = #9#0;
     |LEE 000#2=;
     |LIBERA #2;
     |SI #2#3 ] #0#4;|Y #2#3 [ #0#5;
       |SI #2#25 ] #0#39;|Y #2#25 [ #0#40;
         |SI #2#158 ] #0#31;|Y #2#158 [ #0#32;
           |SI #2#4 ] #0#33;|Y #2#4 [ #0#34;
             |SI #2#39 ] #0#51;|Y #2#39 [ #0#52;
               |SI f ] 0;
                 campo = #9#0; |QBF campo;
                 variable = campo + tab;
                 campo = #9#1; |QBF campo;
                 variable = variable + campo + tab;
                 campo = #9#2; |QBF campo;
                 |PINTA 1922,"                                                         ";
                 |PINTA 1922,"DTO.FAMILIA:";
                 |PINTA 1935,variable;
                 variable = variable + campo + final;
                 cadena = f + " " + variable;
                 |FGRABA cadena;
                 campo = "";
                 variable = "";
                 cadena = "";
               |FINSI;
             |FINSI;
           |FINSI;
         |FINSI;
       |FINSI;
     |FINSI;
     |LIBERA #2;
     |CIERRA #2;
|FPRC;

|DEFBUCLE lee_dtofam;
     #9#1;
     ;
     #0#2 , #0#9;
     #0#3 , #0#10;
     be;
     NULL,pasa_dtofam;
|FIN;

|PROCESO f_dtofam;
     empresa = #0#29;
     |QBF empresa;
     empresa = empresa + "dtofam.asc";
     |QBF empresa;
     fichero = "wt  " + empresa;
     |QBF fichero;
     |FABRE fichero;
     f = FSalida;
     |BUCLE lee_dtofam;
     f = 0;
     FSalida = f;
     |FCIERRA FSalida;
     Pos = -1;
|FPRC;

||------------------------- FICHERO DE VISITAS ----------------------------
|PROCESO pasa_visitas;
   |ABRE #2;
   #2#0 = #10#0;
   |LEE 000#2=;
   |LIBERA #2;
   |SI #2#25 ] #0#39;|Y #2#25 [ #0#40;
     |SI #2#158 ] #0#31;|Y #2#158 [ #0#32;
       |SI #2#4 ] #0#33;|Y #2#4 [ #0#34;
         |SI #2#39 ] #0#51;|Y #2#39 [ #0#52;
           |SI f ] 0;
             campo = #10#2; |QBF campo;
             variable = campo + tab;
             campo = #10#0; |QBF campo;
             variable = variable + campo + tab;
             campo = #2#1;  |QBF campo;
             variable = variable + campo + tab;
             |PINTA 1922,"                                                         ";
             |PINTA 1922,"VISITAS : ";
             |PINTA 1933,variable;
             campo = #10#1;  |QBF campo;
             variable = variable + campo + tab;
             campo = #2#2;  |QBF campo;
             |SI campo = "";
               campo = #2#1;  |QBF campo;
             |FINSI;
             variable = variable + campo + final;
             cadena = f + " " + variable;
             |FGRABA cadena;
             campo = "";
             variable = "";
             cadena = "";
          |FINSI;
         |FINSI;
       |FINSI;
     |FINSI;
   |FINSI;
   |LIBERA #2;
   |CIERRA #2;
|FPRC;

|DEFBUCLE lee_visitas;
     #10#1;
     ;
     #0#2,#0#54;
     #0#3,#0#55;
     be;
     NULL,NULL,NULL,NULL,NULL,pasa_visitas;
     #10#2;
|FIN;

|PROCESO f_visitas;
     empresa = #0#29;
     |QBF empresa;
     empresa = empresa + "visitas.asc";
     |QBF empresa;
     |QBF empresa;
     fichero = "wt  " + empresa;
     |QBF fichero;
     |FABRE fichero;
     f = FSalida;
     |BUCLE lee_visitas;
     f = 0;
     FSalida = f;
     |FCIERRA FSalida;
     Pos = -1;
|FPRC;

||----------------------- FICHERO DE PROMOCIONES POR CLIENTES -------------
|PROCESO pasa_promoc;
     |ABRE #2;
     #2#0 = #12#0;
     |LEE 000#2=;
     |LIBERA #2;
     |ABRE #3;
     #3#0 = #12#1;
     |LEE 000#3=;
     |LIBERA #3;
     |SI #3#3 ] #0#9;|Y #3#3 [ #0#10;
       |SI #3#125 ] #0#36;|Y #3#125 [ #0#37;
         |SI #2#3 ] #0#4;|Y #2#3 [ #0#5;
           |SI #2#25 ] #0#39;|Y #2#25 [ #0#40;
             |SI #2#158 ] #0#31;|Y #2#158 [ #0#32;
               |SI #2#4 ] #0#33;|Y #2#4 [ #0#34;
                 |SI #2#39 ] #0#51;|Y #2#39 [ #0#52;
                   |SI fecha ] #12#6;|Y fecha [ #12#7;
                     |SI f ] 0;
                       campo = #12#0; |QBF campo;
                       variable = campo + tab;
                       campo = #12#1; |QBF campo;
                       variable = variable + campo + tab;
                       |PINTA 1922,"                                                         ";
                       |PINTA 1922,"PROMOCION : ";
                       |PINTA 1933,variable;
                       campo = #12#2;  |QBF campo;
                       variable = variable + campo + tab;
                       campo = #12#3;  |QBF campo;
                       variable = variable + campo + tab;
                       campo = #12#4;  |QBF campo;
                       variable = variable + campo + tab;
                       campo = #12#5;  |QBF campo;
                       variable = variable + campo + final;
                       cadena = f + " " + variable;
                       |FGRABA cadena;
                       campo = "";
                       variable = "";
                       cadena = "";
                     |FINSI;
                   |FINSI;
                 |FINSI;
               |FINSI;
             |FINSI;
           |FINSI;
         |FINSI;
       |FINSI;
     |FINSI;
     |LIBERA #3;
     |CIERRA #3;
     |LIBERA #2;
     |CIERRA #2;
|FPRC;

|DEFBUCLE lee_promoc;
     #12#1;
     ;
     #0#2 , #0#7;
     #0#3 , #0#8;
     be;
     NULL,pasa_promoc;
|FIN;

||----------------------- FICHERO DE PROMOCIONES FIJAS -------------------
|PROCESO pasa_promocfijas;
     |ABRE #2;
     #2#0 = #12#0;
     |LEE 000#2=;
     |LIBERA #2;
     |ABRE #3;
     #3#0 = #12#1;
     |LEE 000#3=;
     |LIBERA #3;
     |SI #3#3 ] #0#9;|Y #3#3 [ #0#10;
       |SI #3#125 ] #0#36;|Y #3#125 [ #0#37;
         |SI fecha ] #12#6;|Y fecha [ #12#7;
           |SI f ] 0;
               campo = #12#0; |QBF campo;
               variable = campo + tab;
               campo = #12#1; |QBF campo;
               variable = variable + campo + tab;
               |PINTA 1922,"                                                         ";
               |PINTA 1922,"PROMOCION : ";
               |PINTA 1933,variable;
               campo = #12#2;  |QBF campo;
               variable = variable + campo + tab;
               campo = #12#3;  |QBF campo;
               variable = variable + campo + tab;
               campo = #12#4;  |QBF campo;
               variable = variable + campo + tab;
               campo = #12#5;  |QBF campo;
               variable = variable + campo + final;
               cadena = f + " " + variable;
               |FGRABA cadena;
               campo = "";
               variable = "";
               cadena = "";
           |FINSI;
         |FINSI;
       |FINSI;
     |FINSI;
     |LIBERA #3;
     |CIERRA #3;
     |LIBERA #2;
     |CIERRA #2;
|FPRC;

|DEFBUCLE lee_promocfijas;
     #12#1;
     ;
     "999999" , #0#7;
     "999999" , #0#8;
     be;
     NULL,pasa_promocfijas;
|FIN;

|PROCESO f_promoc;
     empresa = #0#29;
     |QBF empresa;
     empresa = empresa + "promoc.asc";
     |QBF empresa;
     fichero = "wt  " + empresa;
     |QBF fichero;
     |FABRE fichero;
     f = FSalida;
     |SI #0#43 = "S";|O #0#43 = "N";
       |BUCLE lee_promoc;
     |FINSI;
     |SI #0#43 = "s";|O #0#43 = "n";
       |BUCLE lee_promocfijas;
     |FINSI;
     f = 0;
     FSalida = f;
     |FCIERRA FSalida;
     Pos = -1;
|FPRC;

||------------------------- FICHERO DE IMPRESION ----------------------------
|PROCESO pasa_impresion;
   |ABRE #13;
   #13#26 = #11#0;
   |LEE 000#13=;
   |LIBERA #13;
   |CIERRA #13;

   |SI #0#47 = #11#0;|O #0#48 = #11#0;|O #0#49 = #11#0;|O #0#50 = #11#0;
         |SI f ] 0;
           campo = #11#0; |QBF campo;
           variable = campo + tab;
           campo = #11#1; |QBF campo;
           variable = variable + campo + tab;
                |PINTA 1922,"                                                         ";
                |PINTA 1922,"IMPRESION : ";
                |PINTA 1933,variable;
           campo = #11#2;  |QBF campo;
           variable = variable + campo + tab;
           campo = #11#3;  |QBF campo;
           variable = variable + campo + tab;
           campo = #11#4;  |QBF campo;
           variable = variable + campo + tab;
           campo = #11#5;  |QBF campo;
           variable = variable + campo + tab;

           campo = #0#20;  |QBF campo;
           variable = variable + campo + tab;

           campo = #0#41;  |QBF campo;
           variable = variable + campo + tab;
           campo = #0#42;  |QBF campo;
           variable = variable + campo + tab;
           campo = #0#43;  |QBF campo;
           variable = variable + campo + tab;
           campo = #0#44;  |QBF campo;
           variable = variable + campo + tab;
           campo = #0#45;  |QBF campo;
           variable = variable + campo + tab;
           campo = #0#46;  |QBF campo;
           variable = variable + campo + tab;
           campo = #0#56;  |QBF campo;
           variable = variable + campo + tab;

           campo = #13#31;  |QBF campo;
           variable = variable + campo + tab;
           campo = #13#29;  |QBF campo;
           variable = variable + campo + final;
           cadena = f + " " + variable;
           |FGRABA cadena;
           campo = "";
           variable = "";
           cadena = "";
         |FINSI;
   |FINSI;
|FPRC;

|DEFBUCLE lee_impresion;
     #11#1;
     ;
     "  ";
     "zz";
     be;
     NULL,NULL,NULL,NULL,NULL,pasa_impresion;
     #10#2;
|FIN;

|PROCESO f_impresion;
     empresa = #0#29;
     |QBF empresa;
     empresa = empresa + "impre.asc";
     |QBF empresa;
     fichero = "wt  " + empresa;
     |QBF fichero;
     |FABRE fichero;
     f = FSalida;
     |BUCLE lee_impresion;
     f = 0;
     FSalida = f;
     |FCIERRA FSalida;
     Pos = -1;
|FPRC;

||------------------------- RUTINA PRINCIPAL --------------------------------
|PROCESO pasa_psion; |TIPO 3;
     aFinReg = &13;
     aFinReg = aFinReg + & 10;

     empresa = #0#29;
     |SI #99#1 = "SI";|O #99#1 = "si";
          fecha = ~;
          tab1 = 9;
          final1 = 10;
          final2 = 13;
          tab = &tab1;
          final = "";
          |SI #0#1  = "S"; |HAZ clientes;   |FINSI;
          |SI #0#6  = "S"; |HAZ articulos;  |FINSI;
          |SI #0#11 = "S"; |HAZ f_contador; |FINSI;
          |SI #0#20 = "S"; |HAZ f_iva;      |FINSI;
          |SI #0#21 = "S"; |HAZ f_pago;     |FINSI;
          |SI #0#22 = "S"; |HAZ f_cobros;   |FINSI;
          |SI #0#28 = "S"; |HAZ f_precios;  |FINSI;
          |SI #0#35 = "S"; |HAZ f_dtofam;   |FINSI;
          |SI #0#38 = "S"; |HAZ f_visitas;  |FINSI;
          |HAZ f_promoc;
          |HAZ f_impresion;
          |HAZ Partidas;
          |ATRI P;
          |MENAV "0000FIN DE PROCESOS";
          |ATRI p;
          path = #0#53;
          |QBT path;
          |RSYSTEM path;
     |FINSI;
|FPRC;
