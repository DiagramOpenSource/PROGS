|FICHEROS;
     gopartca;
     gopartll;
     goptrbca #0;
     goptrbli #1;
     agifa027 #2;
     gopartli #3;
     gotrabaj #4;
     gocatcon #5;
     goparame #6;
     gopartia #7,MANTE;
     gopartid #8;
     goconhor #9,MANTE;
     gocatcot #19,MANTE;
     gotrabat #20,MANTE;

     goparame #100;
     gotipoho #101;
     agifa722 #102;
     caenlac@ #1000;
     caconas@ #1001;
     camasic@ #1002;
     canempr@ #1003;
     guerm053 #53;
     guerm054 #54;
|FIN;
------------------------------------------------------------------------------
|VARIABLES;
     &PRMNT_enVer   = 0;
     &enTraba = 0;
     &enHorasAnt = 0;
     aA¤o = "";
     aFecha = "";
     aMes = "";
     nMes = 0;

     &eaSerExpe = "";
     &enNumExpe = 0;
     &efFecha = @;
     &eaSerPre = "";
     &eaNumPre = 0;

     &cCodMonBase   = "";
     &cDesMonBase   = "";
     &cCodMonTrab   = "";
     &cDesMonTrab   = "";

     &nDeci_PBase   = 0;
     &nDeci_TBase   = 0;
     &nDeci_PTrab   = 0;
     &nDeci_TTrab   = 0;
     &nDeci_TotVis  = 0;
     &nEurComTrab   = 0;
     &nEurComBase   = 0;
     &nEurVenTrab   = 0;
     &nEurVenBase   = 0;

     &cTipo         = "";
     &cParam        = "";

     cOperario      = 0;
     cTipoHora      = 0;

     nModo          = 0;
     nNumero        = 0;
     nEuros         = 0;
     nLinea         = 0;
     nTraMinVen     = 0;
     nTraMinCos     = 0;
     nBasMinVen     = 0;
     nBasMinCos     = 0;
     nTotMin        = 0;
     nHay           = 0;
     nBotHoras      = 0;
     nBotTipos      = 0;
     nSalida        = 0;

     cUsu           = "";

     nBusca   = 0;
     nDiario  = 0;
     fFecha   = @;
     nDocum   = 0;
     nCalc    = 0;
     nSwError = 0;
     nForma   = 1;
     &enNoModif = 0;
     &fich_alta = "";
     aAlfa    = "";
     aAlfa1   = "";
     aAlfa2   = "";

     nModoEntrada = 0;
|FIN;
------------------------------------------------------------------------------
|PROCESO NumPar; |TIPO 7;
     nModo = (FEntrada/100)!0;

     |SI nModo = 1;
          |ABRE #6;
          #6#0 = "A";
          |LEE 000#6=;

          |SI FSalida ! 0;
               |MENAV "0000NO ESTAN DEFINIDOS LOS PARAMETROS DE OBRAS";
               |ERROR;
               |CIERRA #6;
               |ACABA;
          |FINSI;

          |ABRE #2;
          #2#0 = "partetrab";      ||Serie.
          #2#2  = #0#0;            ||Tipo documento.
          |LEE 000#2=;

          |SI FSalida = 0;
               #2#1 = #2#1 + 1;
               |GRABA 020#2a;
          |SINO;
               #2#1 = 1;
               |GRABA 020#2c;
          |FINSI;

          #0#15 = #0#0;
          #0#3  = #2#1;
          |PINTA #0#3;
          |PINTA #0#15;
          |CIERRA #2;
          |CIERRA #6;
     |FINSI;

     |PTEC 802;
|FPRC;
------------------------------------------------------------------------------
|PROCESO cMinHor;
     #19#0 = #4#3;
     #19#1 = #4#2;
     #19#2 = 0;
|FPRC;

|PROCESO cMaxHor;
     #19#0 = #4#3;
     #19#1 = #4#2;
     #19#2 = 99;
|FPRC;

|PROCESO ImpoHora;
     |ABRE #20;
     #20#0 = #4#0;  ||Trabajador.
     #20#2 = #1#26; ||Tipo Horas.
     |LEE 000#20=;
     |SI FSalida = 0;
          || importe hora venta/costo de tipos hora trabajador
          |SI cTipo = "P";    #1#14 = #20#4; #1#15 = #20#5; |FINSI;
          |SI cTipo = "A";    #1#14 = #20#6; #1#15 = #20#7; |FINSI;
          |SI cTipo = "E";    #1#14 = #20#8; #1#15 = #20#9; |FINSI;

          || descrip. tipo hora trabajador
          aAlfa1 = #20#3;     |QBF aAlfa1;   aAlfa1 = aAlfa1 + " (T)";
          #1#27 = aAlfa1;
     |SINO;
          |ABRE #19;
          #19#0 = #4#3;  ||Categoria.
          #19#1 = #4#2;  ||Convenio.
          #19#2 = #1#26; ||Tipo Horas.
          |LEE 000#19=;
          |SI FSalida = 0;
               || importe hora venta/costo de tipos hora conv-categ
               |SI cTipo = "P";    #1#14 = #19#4; #1#15 = #19#5; |FINSI;
               |SI cTipo = "A";    #1#14 = #19#6; #1#15 = #19#7; |FINSI;
               |SI cTipo = "E";    #1#14 = #19#8; #1#15 = #19#9; |FINSI;

               || descrip. tipo hora conv-categ
               aAlfa1 = #19#3;     |QBF aAlfa1;   aAlfa1 = aAlfa1 + " (C)";
               #1#27 = aAlfa1;
          |SINO;
               || importe hora venta/costo de conv-categ
               |SI cTipo = "P";    #1#14 = #5#3;  #1#15 = #5#4;  |FINSI;
               |SI cTipo = "A";    #1#14 = #5#7;  #1#15 = #5#9;  |FINSI;
               |SI cTipo = "E";    #1#14 = #5#8;  #1#15 = #5#10; |FINSI;

               || descrip. conv-categ
               aAlfa1 = #5#11;     |QBF aAlfa1;
               aAlfa2 = #5#2;      |QBF aAlfa2;
               #1#27 = aAlfa1 + ": " + aAlfa2;
          |FINSI;
          |CIERRA #19;
     |FINSI;
     |CIERRA #20;
|FPRC;

|PROCESO MirCat; |TIPO 0;
     nSalida = FSalida;

     |SI nSalida = 11;
          |ABRE #19;
          |CONSULTA_F_CLAVE #1#19, cMinHor, cMaxHor;
          |CIERRA #19;
          |SI FSalida = 0;
               #1#26 = #19#2; |PINTA #1#26;
               #1#27 = #19#3; |PINTA #1#27;
          |FINSI;
          |ERROR;
     |SINO;
          |SI cOperario = #1#4; |Y cTipoHora = #1#26;
               |ACABA;
          |FINSI;

          |ABRE #4;
          #4#0 = #1#4;
          |LEE 000#4=;                                 || leyendo trabajador
          |SI FSalida = 0;
               |ABRE #5;
               #5#0 = #4#3;
               #5#1 = #4#2;
               |LEE 000#5=;                            || leyendo categ./convenio
               |SI FSalida = 0;
                    #1#6  = #5#0;                      || cod.categoria
                    #1#7  = #5#2;                      || des.categoria
                    #1#22 = #5#13;                     || cod.mano de obra
                    |HAZ ImpoHora;
                    |HAZ ConvPart;
                    |HAZ TotalLin;
               |SINO;
                    aAlfa1 = "0000Categoria [" + #5#0 + "] con convenio [" + #5#1 + "] no definida.";
                    |MENAV aAlfa1;

                    |ERROR;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO ConvPart;
     nEuros = #1#14 / nEurComBase;      ||Cant. Euros Venta Base Hora.
     #1#12 = nEuros * nEurComTrab;      ||Importe Venta Trabajo Hora.
     nEuros = #1#15 / nEurComBase;      ||Cant. Euros Costo Base Hora.
     #1#13 = nEuros * nEurComTrab;      ||Importe Costo Trabajo Hora.
|FPRC;
-----------------------------------------------------------------------------
|PROCESO TotalLin; |TIPO 0;
     |SI FSalida = 10;
          |PUSHV 01012380;
          #9#0 = "A";
          |LEE 000#9=;
          |DDEFECTO #9;
          |PINPA #0#9;
          |PINDA #0#9;
          |ENDATOS #1#9;
          |SI FSalida = 0;
               #1#11 = #9#3;
          |FINSI;
          |POPV;
     |FINSI;

     |SI #0#20 = "P";    #1#8 = #1#11;  |FINSI;
     |SI #0#20 = "A";    #1#9 = #1#11;  |FINSI;
     |SI #0#20 = "E";    #1#10 = #1#11; |FINSI;

     #1#16 = #1#11 * #1#12;   || total trabajador Venta Mon Trab.
     #1#17 = #1#11 * #1#13;   || total trabajador Costo Mon Trab.
     #1#18 = #1#11 * #1#14;   || total trabajador Venta Mon Base.
     #1#19 = #1#11 * #1#15;   || total trabajador Costo Mon Base.

     |PINTA #1#6;
     |PINTA #1#7;
     |PINTA #1#11;
     |PINTA #1#12;
     |PINTA #1#13;
     |PINTA #1#14;
     |PINTA #1#15;
     |PINTA #1#16;
     |PINTA #1#17;
     |PINTA #1#18;
     |PINTA #1#19;
     |PINTA #1#22;
     |PINTA #1#26;
     |PINTA #1#27;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO BajaPartidas;
     |BORRA 020#7a;
|FPRC;
-----------------------------------------------------------------------------
|DEFBUCLE BajaPartidas;
     #7#2;
     ;
     "T", #3#4, #3#5, #1#3, "                    ","                    ";
     "T", #3#4, #3#5, #1#3, "zzzzzzzzzzzzzzzzzzzz","zzzzzzzzzzzzzzzzzzzz";
     be;
     NULL, BajaPartidas;
|FIN;
-----------------------------------------------------------------------------
|PROCESO CalTotPtr; |TIPO 2;
     nModo = (FEntrada/100)!0;
     nForma = 0 +. 1;

     |SI nModo = 3;
          |BUCLE BajaPartidas;
     |FINSI;

     |SI #100#124 = "A";
          #0#19 = #0#19 -. #1#11;
          |SI nModo ! 3;
               |ABRE #7;
               #7#34 = "T";
               #7#4 = #0#15;                                ||Serie Part.
               #7#5 = #0#3;                                 ||No.  Parte.
               #7#6 = #1#3;                                 ||Linea Docu.
               #7#7 = 1;
               |LEE 101#7=;
               |SI FSalida ! 0; |GRABA 020#7b; |FINSI;
               #7#0 = #0#16;
               #7#1 = #0#17;
               #7#10 = #1#11;

               #7#15 = #0#7;                                ||Codigo de Cliente.
               #7#16 = #0#8;                                ||Nombre del Cliente.
               #7#2  = #0#0;                                ||Serie Expediente.
               #7#3  = #0#1;                                ||No. Expediente.
               #7#20 = #1#22;                               ||Codigo M.O.
               #7#21 = #0#14;                               ||Moneda de Trabajo.
               #7#28 = #1#2;                                ||Fecha Documento.
               #7#29 = "T";                                 ||Tipo Documeto(Trabajos).
               ||Ä
               #7#37 = #1#12;
               #7#38 = 0;
               #7#39 = 0;
               #7#40 = 0;
               #7#41 = #1#13;
               #7#42 = 0;
               #7#43 = 0;
               #7#44 = 0;
               |HAZ CalcuGopartia;
               |GRABA 020#7a;
               |CIERRA #7;
          |FINSI;
     |FINSI;

     #0#4  = #0#4  +. #1#8;
     #0#5  = #0#5  +. #1#9;
     #0#6  = #0#6  +. #1#10;
     #0#9  = #0#9  +. #1#11; |PINTA #0#9;
     #0#10 = #0#10 +. #1#17; |PINTA #0#10;
     #0#11 = #0#11 +. #1#16; |PINTA #0#11;
     #0#12 = #0#12 +. #1#19;
     #0#13 = #0#13 +. #1#18;
     |HAZ ActuaParte;
|FPRC;

|PROCESO ActuaParte;
     |HAZ EsGuerola;
     |SI FSalida = 0;
          |HAZ CosteTraba;
     |FINSI;
     |HAZ Asiento;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO MonTraPar; |TIPO 14;
     nModo = (FEntrada/100)!0;
     |SI nModo = 4;
          |LEE 000#0=;
     |FINSI;
     |SI cCodMonTrab ! #0#14;
          cCodMonTrab = #0#14;
          ||SUB_EJECUTA_NP "gomoneda";
          |HAZ MonBas;
     |FINSI;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO SumPen;
     #0#19 = #0#19 - #7#10;
|FPRC;
-----------------------------------------------------------------------------
|DEFBUCLE MirPen;
     #7#1;
     ;
    "T", #0#15, #0#3, #1#3, 001;
    "T", #0#15, #0#3, #1#3, 999;
     ;
     NULL, SumPen;
|FIN;

-----------------------------------------------------------------------------
|PROCESO ConsultaDetalle;
     |PUSHV 05012380;
     |PINPA #0#7;
     |PINTA 2212, "P.Vta:                   P.Com:";
     |C_V #7#37, 1, "S"; |C_V #7#41, 1, "S";
     |ENTLINEAL #1#7, 5, 4, 21, 0, MinParti, MaxParti;
     |C_V #7#37, 1, "N"; |C_V #7#41, 1, "N";
     |POPV;
|FPRC;

|PROCESO AdjParti; |TIPO 0;
     |SI #100#124 = "A";
          || Se actu. en el tipo2
     |SINO;
          nLinea = 0;
          |PUSHV 01012380;
          #0#18 = #1#11;
          #0#19 = #0#18;
          |BUCLE MirPen;
          |ENTLINEAL #1#7, 5, 1, 21, 1, MinParti, MaxParti;
          |POPV;
          |SI #0#6 ! #0#5;
              |LINEAS_BI_ATRI #0#6, P, I, 0;
          |SINO;
              |LINEAS_BI_ATRI #0#6, I, I, 0;
          |FINSI;
     |FINSI;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO MinParti;
     #7#34 = "T";
     #7#4 = #0#15;                                ||Serie Part.
     #7#5 = #0#3;                                 ||No.  Parte.
     #7#6 = #1#3;                                 ||Linea Docu.
     #7#7 = 1;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO MaxParti;
     #7#34 = "T";
     #7#4 = #0#15;                                ||Serie Part.
     #7#5 = #0#3;                                 ||No.  Parte.
     #7#6 = #1#3;                                 ||Linea Docu.
     #7#7 = 999;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO MirOpe; |TIPO 7;
     cOperario = #1#4;
     cTipoHora = #1#26;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO ImpParPar;
     |PRINT;
|FPRC;
-----------------------------------------------------------------------------
|DEFBUCLE ImpParPar;
     #7#1;
     ;
     "T", #0#15, #0#3, #1#3,   1;
     "T", #0#15, #0#3, #1#3, 999;
     ;
     NULL, ImpParPar;
|FIN;
-----------------------------------------------------------------------------
|PROCESO ImpConfi;
     |BUCLE ImpParPar;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO LlenaBlanco;
     |GRABA 000#0b; || necesario para que el sub_ejecuta funcione la 1§ vez
     |LIBERA #0;
     eaSerExpe = #0#0;
     enNumExpe = #0#1;
     efFecha = #0#2;
     eaSerPre = #0#16;
     eaNumPre = #0#17;
     |SUB_EJECUTA_NP "guerz034";||Asigna partida en blanco si no tiene ninguna
|FPRC;

|PROCESO ConfiPtr; |TIPO 3;
     |HAZ LlenaBlanco;
     |ABRE #6;
     #6#0 = "A";
     |LEE 000#6=;
     |SI FSalida = 0;
          |SI #6#19 = "N";
               |CIERRA #6;
               |ACABA;
          |FINSI;
     |FINSI;
     cUsu = Usuario % 810;
     FSalida = 1;
     |PARA; |SI FSalida ! 0; |HACIENDO;
          |SI #6#20 = "S"
               |CONFI "0000NDESEA IMPRIMIR EL VISADO DEL DOCUMENTO";
               |SI FSalida = -1;
                    |CIERRA #6;
                    |ACABA;
               |FINSI;
          |FINSI;
          |MENAV "0000INTRODUZCA EL DOCUMENTO EN LA IMPRESORA";
          |IMPRE 0;
          |SI FSalida ! 0;
               |SIGUE;
          |FINSI;
          |INFOR "goptrcon"
          |SI FSalida = 0;
               |BUCLELIN 2 ImpConfi #0;
               |PIEINF;
               |FININF;
          |FINSI;
          |FINIMP;
     |CIERRA #6;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO BIptr; |TIPO 80;
     |CLS;
     |CONTROL_SIMPLE 0, "BOTON,F2 - Conversión Horas", 2435, 2455, F2ptr;
     nBotHoras = FSalida;
     |ESTADO_CONTROL nBotHoras, "HIDE"; ||"SHOW""HIDE""ENABLE""DISABLE".
     |CONTROL_SIMPLE 0, "BOTON,F3 - Tipos Horas", 2435, 2455, F3ptr;
     nBotTipos = FSalida;
     |ESTADO_CONTROL nBotTipos, "HIDE"; ||"SHOW""HIDE""ENABLE""DISABLE".
|FPRC;
------------------------------------------------------------------------------
|PROCESO BFptr; |TIPO 90;
     |PULSATECLA;
     |FIN_CONTROL_WINDOWS nBotHoras;
     |PULSATECLA;
     |FIN_CONTROL_WINDOWS nBotTipos;
     |PULSATECLA;
|FPRC;
------------------------------------------------------------------------------
|PROCESO BSptr; |TIPO 7;
     |SI Campo = 11;
          nModoEntrada = (FEntrada / 100) ! 0;
          |SI nModoEntrada = 2;
             enHorasAnt = #1#11;
          |SINO;
             enHorasAnt = 0;
          |FINSI;
          |ESTADO_CONTROL nBotHoras, "SHOW"; ||"SHOW""HIDE""ENABLE""DISABLE".
     |SINO;
          |ESTADO_CONTROL nBotHoras, "HIDE"; ||"SHOW""HIDE""ENABLE""DISABLE".
     |FINSI;

     |SI Campo = 26;
          |ESTADO_CONTROL nBotTipos, "SHOW"; ||"SHOW""HIDE""ENABLE""DISABLE".
     |FINSI;

|FPRC;
-------------------------------------------------------------------------------
|PROCESO BHptr; |TIPO 0;
     |SI Campo = 11;
        nModoEntrada = (FEntrada / 100) ! 0;
        |SI nModoEntrada = 2;
           enHorasAnt = enHorasAnt - #1#11;
        |FINSI;
     |FINSI;
     |ESTADO_CONTROL nBotHoras, "HIDE"; ||"SHOW""HIDE""ENABLE""DISABLE".
     |ESTADO_CONTROL nBotTipos, "HIDE"; ||"SHOW""HIDE""ENABLE""DISABLE".
|FPRC;
-------------------------------------------------------------------------------
|PROCESO F2ptr;
     |PTEC 824;
|FPRC;
-------------------------------------------------------------------------------
|PROCESO F3ptr;
     |PTEC 825;
|FPRC;
-------------------------------------------------------------------------------
|PROCESO MiraH; |TIPO 0;
     |SI #1#11 [ 0;
          |MENAV "0000EL TOTAL HORAS DEBE SER SUPERIOR A 0";
          |ERROR10;
     |FINSI;
|FPRC;
-------------------------------------------------------------------------------
|PROCESO aBortar; |TIPO 11;
     |SI FSalida = 7;
          |HAZ BHptr;
     |FINSI;
|FPRC;
-------------------------------------------------------------------------------
|PROCESO Asiento;
     nForma = 0 +. 1;
     |ABRE #gotipoho;
     #gotipoho#0 = #goptrbli#26;
     |LEE 000#gotipoho.=;
     |SI FSalida = 0;
        |SI #gotipoho#2 = "N"; |CIERRA #gotipoho; |ACABA; |FINSI;
     |SINO;
        |SI #gotipoho#0 ! 0;
           |MENAV "    No se encuentra el codigo de tipo de horas indicado";
           |CIERRA #gotipoho; |ACABA;
        |FINSI;
     |FINSI;
     |ABRE #goparame;
     |LEE 000#goparame.p;
     |SI FSalida ! 0;
        |MENAV "    Control de defectos inexistente.";
        |CIERRA #goparame; |CIERRA #gotipoho; |ACABA;
     |FINSI;

     aAlfa = #goparame#84; |QBF aAlfa;
     aAlfa = aAlfa + "def/canempre.mas";
     |CARGA_DEF aAlfa, canempr@;
     |SI FSalida = 0;
        aAlfa = #goparame#84; |QBF aAlfa; aAlfa = aAlfa + "fich/";
        |PATH_DAT #canempr@#aAlfa#;
        |ABRE #canempr@;
        #canempr@#2 = #goparame#85;
        #canempr@#3 = #goparame#86;
        |LEE 000#canempr@.=;
        |SI FSalida = 0;
           nBusca = 0;
           aAlfa = #goptrbli#2; |QBF aAlfa;
           aAlfa = aAlfa % -102; nCalc = aAlfa;
           |SI nCalc ! #canempr@#26;
              |SI nForma = 1;
                    aAlfa = "    SLa fecha indicada no pertenece al periodo indicado. " + &191 + " Buscar el periodo automaticamente ? ";
                    |CONFI aAlfa;
              |SINO;
                    FSalida = 1;
              |FINSI;
              |SI FSalida = 0;
                 |PARA; |SI FSalida = 0; |Y #canempr@#2 = #goparame#85; |HACIENDO;
                    |LEE 000#canempr@.s;
                    |SI nCalc = #canempr@#26; nBusca = 1; |SAL; |FINSI;
                 |SIGUE;
                 |SI nBusca = 1;
                   #goparame#85 = #canempr@#2;
                   #goparame#86 = #canempr@#3;
                 |SINO;
                    |MENAV "    No se ha podido encontrar el periodo correcto";
                 |FINSI;
              |FINSI;
           |FINSI;
        |FINSI;
        |CIERRA #canempr@; |DESCARGA_DEF #canempr@;
     |FINSI;

     aAlfa = #goparame#84; |QBF aAlfa;
     aAlfa = aAlfa + "def/caenlace.mas";
     |CARGA_DEF aAlfa, caenlac@;
     |SI FSalida = 0;
        aAlfa = #goparame#84; |QBF aAlfa;
        aAlfa = aAlfa + "def/caconasi.mas";
        |CARGA_DEF aAlfa, caconas@;
        |SI FSalida = 0;
           aAlfa = #goparame#84; |QBF aAlfa;
           aAlfa = aAlfa + "def/camaasic.mas";
           |CARGA_DEF aAlfa, camasic@;
           |SI FSalida = 0;
              aAlfa = #goparame#84; |QBF aAlfa;
              aAlfa = aAlfa + "fich/" + (("00000" + #goparame#85) % -105) + #goparame#86 + "/";
              |PATH_DAT #caenlac@#aAlfa#; |PATH_DAT #camasic@#aAlfa#;
              |PATH_DAT #caconas@#aAlfa#;
              aAlfa = "pu" + Usuario; |QBF aAlfa; |NOME_DAT #caenlac@#aAlfa#;
              |DELINDEX #caenlac@; |ABRE #caenlac@;
              |ABRE #caconas@; |ABRE #camasic@; |ABRE #agifa722;
              nSwError = 0;
              |SI nForma < 0;
                 #agifa722#0 = "TR";
                 #agifa722#1 = #goptrbli#20;
                 aAlfa = (("000000" + #goptrbli#21) % -106) + (("000" + #goptrbli#3) % -103);
                 #agifa722#2 = aAlfa;
                 #agifa722#3 = #goptrbli#2;
                 #agifa722#11 = 1;
                 #agifa722#8 = #goparame#85;
                 #agifa722#9 = #goparame#86;
                 |LEE 000#agifa722.=;
                 |SI FSalida = 0;
                    nDiario = #agifa722#4;
                    fFecha  = #agifa722#5;
                    nDocum  = #agifa722#6;
                    |BORRA 020#agifa722.a;
                    |DDEFECTO #caenlac@;
                    #caenlac@#37 = #agifa722#8;
                    #caenlac@#38 = #agifa722#9;
                    #caenlac@#0 = #agifa722#4;
                    #caenlac@#1 = #agifa722#5;
                    #caenlac@#2 = #agifa722#6;
                    #caenlac@#3 = 0;
                    #caenlac@#9 = 0;
                    #caenlac@#25 = "S";
                    |GRABA 020#caenlac@.n;
                 |SINO;
                    nSwError = 1;
                 |FINSI;
              |SINO;
                 nDiario = #gotipoho#7;
                 fFecha  = #goptrbli#2;
                 |LEE 101#caconas@.p;
                 |SI FSalida ! 0;
                    |DDEFECTO #caconas@;
                    |GRABA 020#caconas@.n;
                    |LEE 101#caconas@.p;
                 |FINSI;
                 #caconas@#1 = #caconas@#1 + 1;
                 aAlfa = "|NC"; nCalc = #caconas@#aAlfa#;
                 |SI nCalc > 2; #caconas@#2 = #caconas@#2 + 1; |FINSI;
                 nDocum = #caconas@#1;
                 |GRABA 020#caconas@.a;
                 |LIBERA #caconas@;
                 #camasic@#0 = nDiario;
                 #camasic@#1 = fFecha;
                 #camasic@#2 = nDocum;
                 |LEE 000#camasic@.=;
                 |SI FSalida = 0;
                    #camasic@#0 = nDiario;
                    #camasic@#1 = fFecha;
                    #camasic@#2 = 999999;
                    |LEE 000#camasic@.];
                    |SI FSalida = 0;
                       |SI #camasic@#0 = nDiario; |Y #camasic@#1 = fFecha;
                          nDocum = 1;
                       |SINO;
                          |LEE 000#camasic@.a;
                          |SI FSalida = 0;
                             |SI #camasic@#0 = nDiario; |Y #camasic@#1 = fFecha;
                                 nDocum = #camasic@#2 + 1;
                             |SINO;
                                nDocum = 1;
                             |FINSI;
                          |SINO;
                             nDocum = 1;
                          |FINSI;
                       |FINSI;
                    |SINO;
                       |LEE 000#camasic@.u;
                       |SI FSalida = 0;
                          |SI #camasic@#0 = nDiario; |Y #camasic@#1 = fFecha;
                             nDocum = #camasic@#2 + 1;
                          |SINO;
                             nDocum = 1;
                          |FINSI;
                       |SINO;
                          nDocum = 1;
                       |FINSI;
                    |FINSI;
                 |FINSI;
                 |DDEFECTO #agifa722;
                 #agifa722#0 = "TR";
                 #agifa722#1 = #goptrbli#20;
                 aAlfa = (("000000" + #goptrbli#21) % -106) + (("000" + #goptrbli#3) % -103);
                 #agifa722#2 = aAlfa;
                 #agifa722#3 = #goptrbli#2;
                 #agifa722#4 = nDiario;
                 #agifa722#5 = fFecha;
                 #agifa722#6 = nDocum;
                 #agifa722#7 = 10;
                 #agifa722#8 = #goparame#85;
                 #agifa722#9 = #goparame#86;
                 #agifa722#11 = 1;
                 |GRABA 020#agifa722.n;

                 |DDEFECTO #caenlac@;
                 #caenlac@#0 = nDiario;
                 #caenlac@#1 = fFecha;
                 #caenlac@#2 = nDocum;
                 #caenlac@#3 = 10;
                 #caenlac@#4 = #gotipoho#3;
                 #caenlac@#5 = 0;
                 #caenlac@#6 = #gotipoho#5;
                 aAlfa = #gotipoho#6; |QBF aAlfa;

                 aFecha = fFecha;
                 aMes = aFecha % 402;
                 nMes = aMes;
                 |SI nMes = 1;  aMes = "Enero";      |FINSI;
                 |SI nMes = 2;  aMes = "Febrero";    |FINSI;
                 |SI nMes = 3;  aMes = "Marzo";      |FINSI;
                 |SI nMes = 4;  aMes = "Abril";      |FINSI;
                 |SI nMes = 5;  aMes = "Mayo";       |FINSI;
                 |SI nMes = 6;  aMes = "Junio";      |FINSI;
                 |SI nMes = 7;  aMes = "Julio";      |FINSI;
                 |SI nMes = 8;  aMes = "Agosto";     |FINSI;
                 |SI nMes = 9;  aMes = "Septiembre"; |FINSI;
                 |SI nMes = 10;  aMes = "Octubre";    |FINSI;
                 |SI nMes = 11;  aMes = "Noviembre";  |FINSI;
                 |SI nMes = 12;  aMes = "Diciembre";  |FINSI;

                 |SI #gotipoho#11  = "S"; aAlfa = aAlfa + aMes + " "; |FINSI;
                 |SI #gotipoho#9  = "S"; aAlfa = aAlfa + #goptrbli#4; |FINSI;
                 |SI #gotipoho#10 = "S"; aAlfa = aAlfa + #goptrbli#5; |FINSI;
                 #caenlac@#7 = aAlfa;
                 #caenlac@#8 = "D";
                 #caenlac@#9 = #goptrbli#17;
                 #caenlac@#39 = #goptrbli#0;
                 |GRABA 020#caenlac@.n;

                 |DDEFECTO #caenlac@;
                 #caenlac@#0 = nDiario;
                 #caenlac@#1 = fFecha;
                 #caenlac@#2 = nDocum;
                 #caenlac@#3 = 20;
                 #caenlac@#4 = #gotipoho#4;
                 #caenlac@#5 = 0;
                 #caenlac@#6 = #gotipoho#5;
                 aAlfa = #gotipoho#6; |QBF aAlfa;

                 aFecha = fFecha;
                 aMes = aFecha % 402;
                 nMes = aMes;
                 |SI nMes = 1;  aMes = "Enero";      |FINSI;
                 |SI nMes = 2;  aMes = "Febrero";    |FINSI;
                 |SI nMes = 3;  aMes = "Marzo";      |FINSI;
                 |SI nMes = 4;  aMes = "Abril";      |FINSI;
                 |SI nMes = 5;  aMes = "Mayo";       |FINSI;
                 |SI nMes = 6;  aMes = "Junio";      |FINSI;
                 |SI nMes = 7;  aMes = "Julio";      |FINSI;
                 |SI nMes = 8;  aMes = "Agosto";     |FINSI;
                 |SI nMes = 9;  aMes = "Septiembre"; |FINSI;
                 |SI nMes = 10;  aMes = "Octubre";    |FINSI;
                 |SI nMes = 11;  aMes = "Noviembre";  |FINSI;
                 |SI nMes = 12;  aMes = "Diciembre";  |FINSI;

                 |SI #gotipoho#11  = "S"; aAlfa = aAlfa + aMes + " "; |FINSI;
                 |SI #gotipoho#9  = "S"; aAlfa = aAlfa + #goptrbli#4; |FINSI;
                 |SI #gotipoho#10 = "S"; aAlfa = aAlfa + #goptrbli#5; |FINSI;
                 #caenlac@#7 = aAlfa;
                 #caenlac@#8 = "H";
                 #caenlac@#9 = #goptrbli#17;
                 #caenlac@#39 = #goptrbli#0;
                 |GRABA 020#caenlac@.n;
              |FINSI;
              |SI nSwError = 0;
                 |HAZ CogeVersion;
                 aAlfa = #goparame#84; |QBF aAlfa;
                 aAlfa = aAlfa + "fich/" + (("00000" + #goparame#85) % -105) + #goparame#86 + "/";
                 fich_alta = aAlfa;
                 aAlfa1 = #goparame#84; |QBF aAlfa1;
                 aAlfa1 = aAlfa1 - "contagen";
                 |SI FSalida ! 0;
                    aAlfa1 = ":contagen/dsapunte.tab;";
                 |SINO;
                    aAlfa1 = ":agicont/dsapunte.tab;";
                 |FINSI;
                 enNoModif = 100;
                 aAlfa = aAlfa1 + aAlfa + ",pu" + Usuario;
                 |CIERRA #caenlac@;
                 |SUB_EJECUTA_NP aAlfa;
                 |ABRE #caenlac@; |LEE 000#caenlac@.c;
              |FINSI;
              |CIERRA #agifa722;
              |CIERRA #camasic@; |DESCARGA_DEF #camasic@;
              |CIERRA #caconas@; |DESCARGA_DEF #caconas@;
              |CIERRA #caenlac@; |DELINDEX #caenlac@; |DESCARGA_DEF #caenlac@;
           |FINSI;
        |FINSI;
     |SINO;
        |CIERRA #goparame; |CIERRA #gotipoho; |ACABA;
     |FINSI;
     |CIERRA #gotipoho; |CIERRA #goparame;
|FPRC;

|PROCESO CosteTraba; || para Guerola
     |ABRE #101;
     #101#0 = #1#26;
     |LEE 000#101=;
     |CIERRA #101;

     aA¤o = #1#2 % 704;
     aMes = #1#2 % 402;
     |ABRE #53;
     |ABRE #54;
     #54#0 = aA¤o;
     #54#1 = aMes;
     #54#2 = #1#4;
     |LEE 000#54=;
     |SI FSalida = 0;
          #53#0 = #54#0;
          #53#1 = #54#1;
          |LEE 000#53=;
          |SI FSalida = 0; |Y #53#5 = "S";
               |CONFI "0000NRecalcular costes trabajador?";
               |SI FSalida = 0;
                    |SI #101#12 = "S";
                         #54#7 = #54#7 + (#1#11 * nForma);
                    |SINO;
                         #54#12 = #54#12 + (#1#11 * nForma);
                    |FINSI;
                    #54#8 = #54#6 / #54#7;
                    #54#10 = #54#9 / #54#7;
                    #54#11 = #54#8 + #54#10;
                    |GRABA 020#54a;
                    #53#7 = #53#7 + (#1#11 * nForma);
                    #53#8 = #53#6 / #53#7;
                    |GRABA 020#53a;


                    |GRABA 040#1b;
                    |SI FSalida ! 0;
                         |GRABA 020#1a;
                    |FINSI;

                    |SI #54#11 ! #1#13;
                         |MENAV "0000Se modificaran los costes de este trabajador";
                    |FINSI;

                    |SALVA_DATOS #gopartca;
                    |SALVA_DATOS #gopartll;
                    |SALVA_DATOS #gopartli;
                    |SALVA_DATOS #goptrbca;
                    |SALVA_DATOS #goptrbli;
                    |CIERRAT #gopartca;
                    |CIERRAT #gopartll;
                    |CIERRA #gopartli;
                    |CIERRA #goptrbca;
                    |CIERRA #goptrbli;
                    efFecha = #1#2;
                    enTraba = #1#4;
                    |SUB_EJECUTA_NP "guerm055";
                    |ABRE #goptrbli;
                    |ABRE #goptrbca;
                    |ABRE #gopartli;
                    |ABRET #gopartll;
                    |ABRET #gopartca;
                    |REPON_DATOS #goptrbli;
                    |REPON_DATOS #goptrbca;
                    |REPON_DATOS #gopartli;
                    |REPON_DATOS #gopartll;
                    |REPON_DATOS #gopartca;
                    |LEE 121#goptrbli.=;
                    |LEE 121#goptrbca.=;
                    |LEE 121#gopartli.=;
                    |LEE 121#gopartll.=;
                    |LEE 121#gopartca.=;
                    |||PONCONTROL 23, "SI";
               |FINSI;
          |FINSI;
     |FINSI;
     |CIERRA #53;
     |CIERRA #54;
|FPRC;
