|FICHEROS;
     tagm0090 #90;
     tagm0087 #87;
|FIN;

|VARIABLES;
     &eaFP = "";
     &eaSerie = "";
     &enCodigo = 0;
     &eaBloquea = "";
     c = "";
     aPath = "";
     aFic = "";
     nHandle = 0;
     aProg = "";
     aAlfa = "";
     aExe = "";
|FIN;

|PROGRAMA;
     |SI PARAMETRO = "ADJ";
          aExe = "comprueba2.exe ";
     |SINO;
          aExe = "comprueba.exe ";
     |FINSI;
     eaBloquea = "N";
     |ABRE #90;
     #90#0 = eaFP;
     |LEE 000#90=;
     |SI FSalida = 0;
          aPath = "c:\ds\item\";
          aFic = aPath + "comprueba.txt";
          |XABRE "CW", aFic, nHandle;
          |SI FSalida ] 0;
               aAlfa = "51/30" + (eaSerie%102) + (("000000" + enCodigo)%-106);
               |XGRABA nHandle, aAlfa;
               |XCIERRA nHandle;
          |FINSI;

          |ABRE #87; |LEE 000#87p; |CIERRA #87;
          aPath = #87#4; |QBF aPath;
          aProg = aPath + aExe + aFic;
          aAlfa =  "cmd " + &34 + " /c START /MIN /WAIT " + aProg + &34;
          |RSYSTEM aAlfa;

          aPath = "c:\ds\item\";
          aFic = aPath + "comprueba.out";
          |XABRE "C", aFic, nHandle;
          |SI FSalida ] 0;
               |XLEE nHandle, 250, aAlfa;
               |XCIERRA nHandle;

               eaBloquea = aAlfa % 1501;
          |FINSI;
     |FINSI;
     |CIERRA #90;
|FPRO;
