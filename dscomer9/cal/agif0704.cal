|FICHEROS;
   agif0704 #0;
   agif0705 #1;
   agif0706 #2;
   agif0707 #3;
   agif0702 #4;
   agif0717 #5;
   agif0718 #6;
   agifa714 #7;

   agif704a #10,MANTE;
   agif704b #11,MANTE;
   agifw704 #30,MANTE;
   agifw705 #31,MANTE;
   agifw706 #32,MANTE;
   agifw701 #33;
   agifw707 #34,MANTE;
   agifw702 #35;
   agifw703 #36;
   agifw700 #37;
   agifw797 #38,MANTE;
   agifw798 #39,MANTE;
   agifw796 #40;
   agifw714 #41;
   agifw795 #42;
   agifw794 #43,MANTE;

   Referen@ #1000;
   Concept@ #1001;
   Refere1@ #1002;
   Refere2@ #1003;
   RefOrig@ #1004;
   RefDest@ #1005;
|FIN;

|VARIABLES;
   &eaResultado = "";

   nSwEncontrado = 0;

   nRango  = 0;
   nPos1   = 0;
   nPos2   = 0;
   nHandle = 0;
   nCalc   = 0;
   nCalc1  = 0;
   nCont   = 0;
   nCont1  = 0;
   nLong   = 0;
   nCampoSel  = 0;
   nNumPant   = 0;
   nNumCmps   = 0;
   nSwCmpMem  = 0;
   nSwEntPant = 0;
   nSwModo    = 0;
   nSwSinLin  = 0;
   nSwSinLinP2a = 0;
   nSwCampos  = 0;
   nTecla     = 0;
   nCptoAnt   = 0;
   nSwErr     = 0;
   nSwError   = 0;
   nNume1     = 0;
   nNume2     = 0;
   nSwOk      = 0;
   nSwRepite  = 0;
   nSwSel     = 0;
   nSwCarga   = 0;
   nNumRels   = 0;
   nContRel   = 0;
   nCmpDestino = 0;
   nSwCapitulo = 0;
   nSwCampo    = 0;
   nCampoAct   = 0;
   nBotonCmpClvP3a = -1;
   nLabelCmpClvP3a = -1;
   aSwMemoria  = "";
   aSwComent   = "";

   nCmpClv     = 0;
   aCodEnlace  = "";
   aEnlaceOrg  = "";
   aEnlaceDst  = "";

   aBaseRemoto = "";
   aUnidad     = "";
   aIP         = "";
   aAlfaG      = "";
   aAlfa       = "";
   aAlfa1      = "";
   aAlfa2      = "";
   aAlfa3      = "";
   aAlfa4      = "";
   aAlfa5      = "";
   aAlfa6      = "";
   aAntCont    = "";
   aLong       = "";
   aTitulo     = "";
   aDirFich    = "";
   aFichero    = "";
   aFichOrigen = "";
   aFichDestino = "";
   aCmpOrigen  = "";
   aCaminoRel  = "";
   aAviso      = "";

   aEsc1  = "";
   aEsc2  = "";
   aRetu  = "";
   aTecla = "";

   fFecha1 = @;
   fFecha2 = @;

   nPant0    = 0;
   nPant1    = 0;
   nPantFlt  = 0;
   nPantFlt1 = 0;
   nPantEsp  = 0;
   nSubPant0 = 0;
   nGridSel  = 0;
   nGrid1    = 0;
   nVent1    = 0;
   nVentFlt  = 0;
   nVentFlt1 = 0;
   nVentEsp  = 0;
   nTree1    = 0;
   nSw       = 0;

   nBotonNue = 0;
   nBotonMod = 0;
   nBotonBor = 0;
   nBotonComprueba = 0;
   nBotonCopia     = 0;
   nBotonAyuda     = -1;

   nBotonOk      = 0;
   nBotonValida  = 0;
   nBotonCancela = 0;
   nBotonIncCmp  = 0;

   nIdSalir = 0;
   nBotonSalir = 0;
   nLabel1   = 0;
   nLabel2   = 0;
   nLabel3   = 0;
   nLabelEsp = 0;

   nGridP2a  = 0;
   nGridP2b  = 0;
   nGridP3a  = 0;
   nGridP4a  = 0;
   nGridP5a  = 0;
   nGridP5b  = 0;
   nGridA    = 0;
   nGridB    = 0;
   nBotonNueP2a = 0;
   nBotonModP2a = 0;
   nBotonBorP2a = 0;
   nBotonNueP2b = 0;
   nBotonModP2b = 0;
   nBotonBorP2b = 0;
   nBotonNueP3a = 0;
   nBotonModP3a = 0;
   nBotonBorP3a = 0;
   nBotonNueP4a = 0;
   nBotonModP4a = 0;
   nBotonBorP4a = 0;
   nBotonNueP5a = 0;
   nBotonModP5a = 0;
   nBotonBorP5a = 0;
   nBotonSelCmp = 0;
   nLabelDblClk = 0;

   || NO METER VARIABLES ENTRE ESTE BLOQUE
{1}aContiene = "";
{-1}sTree      = 0;
   sT_nID      = 0;
   sT_nOper    = 0;
   sT_aData    = "";
{-1}aVent      = "";
    aVent1     = 0;
    aVent2     = 0;
    aVent3     = 0;
    aVent4     = 0;
    aVent5     = "";
{2}nNivel        = 0;
{-1}get  = 0;
    get1 = 0;
    get2 = 0;
   || NO METER VARIABLES ENTRE ESTE BLOQUE
|FIN;

|PROCESO Tipo12; |TIPO 12;
|FPRC;

|PROCESO Final;
   |PTEC 801;
|FPRC;

|PROCESO AyudaFormatoFecha;
   |VENTANA 1017, 1983, -1, 17, "Ayuda campo Formato fechas"; nVentFlt = FSalida;
   aVent1 = -1;
   aVent2 = -1;
   aVent3 = 0;
   aVent4 = nVentFlt;
   aVent5 = "MODAL";
   |ESPECIFICA "ESTADO_VENTANA", aVent;

   |PINPA #0#agifw795;
   |PAUSA;

   aVent4 = nVentFlt;
   aVent5 = "MODELESS";
   |ESPECIFICA "ESTADO_VENTANA", aVent;
   |FINVENTANA nVentFlt;
|FPRC;

|PROCESO MiraMemoria;
   |SI nSwModo = 1;
      aAlfa = #agif0717#0;
      #agif0717#0 = #agif0704#0;
      #agif0717#1 = #agifw797#0;
      |LEE 000#agif0717.=;
      |SI FSalida = 0;
         |MENAV "    La memoria indicada ya existe"; |ERROR;
      |FINSI;

      #agif0717#0 = aAlfa;
      |LEE 000#agif0717.=;
   |FINSI;
   |ESTADO_CONTROL nBotonIncCmp, "ENABLE";
|FPRC;

|PROCESO QuitaBotonSalir;
   nIdSalir = 0;
   InNivel   = nNivel1<-;
   nNivel1   = 0;
   |ESPECIFICA "IDBOTONTECLA", nNivel;

   nIdSalir = nNivel2;
   |ESTADO_CONTROL nIdSalir, "HIDE";
|FPRC;

|PROCESO CargaConceptos;
   aAlfa = #agif0704#6; |QBF aAlfa;
   aAlfa = aAlfa - "contagen";
   |SI FSalida ! 0;
      |DBASS aAlfa; |QBF aAlfa;
      aDirFich = aAlfa + "modelos/fich/";
      aAlfa = aAlfa + "modelos/def/dsmom030.mas";
      |CARGA_DEF aAlfa, Concept@;
   |SINO;
      aAlfa = #agif0704#6; |QBF aAlfa;
      aDirFich = aAlfa + "fich/" + (("00000" + #agif0704#4) % -105) + #agif0704#5 + "/";
      aAlfa = aAlfa + "def/caconcep.mas";
      |CARGA_DEF aAlfa, Concept@;
   |FINSI;
|FPRC;

|PROCESO T07Concepto; |TIPO 7;
   nCptoAnt = #agifw706#3;
|FPRC;

|PROCESO T66Concepto; |TIPO 66;
   |HAZ CargaConceptos;
   |SI FSalida = 0;
      |ABRE #Concept@;
      #Concept@#0 = #agifw706#3;
      |LEE 000#Concept@.];
      |CONSULTA_CLAVE #1#Concept@;
      |SI FSalida = 0;
         #agifw706#3 = #Concept@#0; |PINTA #agifw706#3;
         #agifw706#4 = #Concept@#1; |PINTA #agifw706#4;
      |FINSI;
      |CIERRA #Concept@; |DESCARGA_DEF #Concept@;
   |FINSI;
|FPRC;

|PROCESO T00Concepto;
   |HAZ CargaConceptos;
   |SI FSalida = 0;
      |ABRE #Concept@;
      #Concept@#0 = #agifw706#3;
      |LEE 000#Concept@.=;
      |SI FSalida = 0;
         aAlfa = #agifw706#4; |QBF aAlfa;
         |SI nCptoAnt ! #agifw706#3; |O aAlfa = "";
            #agifw706#4 = #Concept@#1; |PINTA #agifw706#4;
         |FINSI;
      |SINO;
         |MENAV "    El concepto no existe"; |ERROR;
      |FINSI;
      |CIERRA #Concept@; |DESCARGA_DEF #Concept@;
   |FINSI;
|FPRC;

|PROCESO Campo7; |TIPO 7;
   nCampoSel = Campo;
   |ESTADO_CONTROL nBotonSelCmp, "ENABLE";
|FPRC;

|PROCESO Campo0; |TIPO 0;
   nCampoSel = -1;
   |ESTADO_CONTROL nBotonSelCmp, "DISABLE";
|FPRC;

|PROCESO PonBotonAyuda; |TIPO 7;
   |SI nBotonAyuda < 0;
      nPos1 = 2002; nPos2 = 2017;
      |CONTROL_SIMPLE nPantFlt, "BOTON,{{197}}Ayuda", nPos1, nPos2, BotonAyuda;
      nBotonAyuda = FSalida;
   |FINSI;
|FPRC;

|PROCESO FinBotonAyuda;
   |SI nBotonAyuda ] 0;
      |FIN_CONTROL_WINDOWS nBotonAyuda;   nBotonAyuda = -1;
   |FINSI;
|FPRC;

|PROCESO BotonAyuda;
    || Lo pongo as¡ previendo que el boton ayuda haya que ponerlo en algun
    ||   otro campo. As¡ en este proceso podria condicionar la ayuda
    ||   dependiendo del campo en el que est‚

    |HAZ AyudaFormatoFecha;
|FPRC;

|PROCESO FormatoFecha;
   |SI #agif0704#14 = "A"; #agifw704#15 = "Formato automatico"; |FINSI;
   |SI #agif0704#14 = "B"; #agifw704#15 = "Formato manual "; |FINSI;
   |SI #agif0704#14 = "C"; #agifw704#15 = "Formato manual contable"; |FINSI;
   |PINTA #agifw704#15;
|FPRC;

|PROCESO CompruebaCodigo;
   #agif0704#0 = #agifw704#0;
   |LEE 000#agif0704.=;
   |SI FSalida = 0;
      |MENAV "    Enlace ya existente"; |ERROR;
   |FINSI;
|FPRC;

|PROCESO EditaEnlace;
   |VENTANA 0815, 2285, nPant0, 17, aTitulo; nVentFlt = FSalida;
   aVent1 = -1;
   aVent2 = -1;
   aVent3 = 0;
   aVent4 = nVentFlt;
   aVent5 = "MODAL";
   |ESPECIFICA "ESTADO_VENTANA", aVent;

   |SI nSwModo = 1;
      |C_M #agifw704#0, 1, "S";
   |SINO;
      |C_M #agifw704#0, 1, "N";
   |FINSI;

   |PINPA #0#agifw704; nPantFlt = FSalida;
   |PINDA #0#agifw704;

   nPos1 = 2044; nPos2 = 2054;
   |CONTROL_SIMPLE nPantFlt, "BOTON,{{206}}Validar", nPos1, nPos2, BotonValida;
   nBotonValida = FSalida;

   nPos1 = 2056; nPos2 = 2066;
   |CONTROL_SIMPLE nPantFlt, "BOTON,{{207}}Cancelar", nPos1, nPos2, BotonCancela;
   nBotonCancela = FSalida;

   |ENDATOS #1#agifw704;
   |SI FSalida = 0;
      |SI nSwModo = 1;
         |DDEFECTO #agif0704;
         #agif0704#0 = #agifw704#0;
         |GRABA 020#agif0704.b;
      |FINSI;
      #agif0704#1 = #agifw704#1;
      |SI  #agifw704#2 = "V"; aAlfa = "FV"; aAlfa1 = "Facturas venta";    |FINSI;
      |SI  #agifw704#2 = "C"; aAlfa = "FC"; aAlfa1 = "Facturas compra";   |FINSI;
      |SI  #agifw704#2 = "D"; aAlfa = "FD"; aAlfa1 = "Facturas directas"; |FINSI;
      |SI  #agifw704#2 = "T"; aAlfa = "TI"; aAlfa1 = "Tiquets";           |FINSI;
      |SI  #agifw704#2 = "E"; aAlfa = "CC"; aAlfa1 = "Cierre de caja";    |FINSI;
      |SI  #agifw704#2 = "R"; aAlfa = "CR"; aAlfa1 = "Creditos";          |FINSI;
      #agif0704#2  = aAlfa;
      #agif0704#3  = aAlfa1;
      #agif0704#6  = #agifw704#4;
      #agif0704#4  = #agifw704#5;
      #agif0704#5  = #agifw704#6;
      #agif0704#7  = #agifw704#8;
      #agif0704#8  = #agifw704#9;
      #agif0704#14 = #agifw704#10;
      #agif0704#15 = #agifw704#11;
      #agif0704#19 = #agifw704#12;
      #agif0704#20 = #agifw704#13;
      #agif0704#18 = #agifw704#14;
      |GRABA 020#agif0704.a;
   |FINSI;

   |FIN_CONTROL_WINDOWS nBotonValida;
   |FIN_CONTROL_WINDOWS nBotonCancela;

   aVent4 = nVentFlt;
   aVent5 = "MODELESS";
   |ESPECIFICA "ESTADO_VENTANA", aVent;
   |FINVENTANA nVentFlt;
|FPRC;

|PROCESO NuevoEnlace;
   aTitulo = "Nuevo enlace contable";
   |DDEFECTO #agifw704; nSwModo = 1; |HAZ EditaEnlace;
   |LIBERA #agif0704;

   |REFRESCACONTROL nGrid1;
|FPRC;

|PROCESO ModifEnlace;
   aTitulo = "Modificar enlace contable";

   |DDEFECTO #agifw704;
   #agifw704#0  = #agif0704#0;
   #agifw704#1  = #agif0704#1;
   aAlfa = #agif0704#2; |QBF aAlfa;
   aAlfa = aAlfa % 0201; #agifw704#2 = aAlfa;
   #agifw704#3  = #agif0704#3;
   #agifw704#4  = #agif0704#6;
   #agifw704#5  = #agif0704#4;
   #agifw704#6  = #agif0704#5;
   #agifw704#8  = #agif0704#7;
   #agifw704#9  = #agif0704#8;
   #agifw704#10 = #agif0704#14;
   #agifw704#11 = #agif0704#15;
   #agifw704#12 = #agif0704#19;
   #agifw704#13 = #agif0704#20;
   #agifw704#14 = #agif0704#18;
   |SI #agif0704#14 = "A"; #agifw704#15 = "Formato automatico"; |FINSI;
   |SI #agif0704#14 = "B"; #agifw704#15 = "Formato manual "; |FINSI;
   |SI #agif0704#14 = "C"; #agifw704#15 = "Formato manual contable"; |FINSI;
   |LEE 101#agif0704.=;

   nSwModo = 2; |HAZ EditaEnlace;
   |LIBERA #agif0704;

   |REFRESCACONTROL nGrid1;
|FPRC;

|PROCESO BorraFichero;
   nCmpClv = 0;
   |SI aFichero = "agif0707"; nCmpClv = 15; |FINSI;

   |DDEF aAlfa; |QBF aAlfa;
   aAlfa = aAlfa + aFichero + ".mas";
   |CARGA_DEF aAlfa, Referen@;
   |SI FSalida = 0;
      |ABRE #Referen@;
      |DDEFECTO #Referen@;
      #Referen@#nCmpClv# = aCodEnlace;
      |LEE 000#Referen@.];
      |PARA; |SI FSalida = 0; |Y #Referen@#nCmpClv# = aCodEnlace; |HACIENDO;
         |BORRA 020#Referen@.a;
         |LEE 000#Referen@.s;
      |SIGUE;
      |DESCARGA_DEF #Referen@;
   |FINSI;
|FPRC;

|PROCESO BorraEnlace;
   aAlfa = "    N" + &191 + " Esta seguro de eliminar este enlace ?";
   |CONFI aAlfa;
   |SI FSalida = 0;
      aCodEnlace = #agif0704#0;
      aFichero = "agif0705"; |HAZ BorraFichero;
      aFichero = "agif0706"; |HAZ BorraFichero;
      aFichero = "agif0707"; |HAZ BorraFichero;
      aFichero = "agif0717"; |HAZ BorraFichero;
      aFichero = "agif0718"; |HAZ BorraFichero;
      |BORRA 020#agif0704.a;

      |LEE 000#agif0704.c;
      |SI FSalida ! 0;
         |ESTADO_CONTROL nBotonMod, "DISABLE";
         |ESTADO_CONTROL nBotonBor, "DISABLE";
         |ESTADO_CONTROL nBotonComprueba, "DISABLE";
         |ESTADO_CONTROL nBotonCopia, "DISABLE";
      |FINSI;
      |REFRESCACONTROL nGrid1;
   |FINSI;
|FPRC;

|PROCESO MiraDiario;
   nTecla = FSalida;

   aAlfa = #agif0704#6; |QBF aAlfa;
   aAlfa1 = aAlfa % -101;
   |SI aAlfa1 ! "/"; |Y aAlfa1 ! "\";
      aAlfa = aAlfa + "/";
   |FINSI;
   aAlfa1 = aAlfa + "def/camandia.mas";
   |CARGA_DEF aAlfa1, Referen@;
   |SI FSalida = 0;
      aAlfa1 = aAlfa + "fich/" + (("00000" + #agif0704#4) % -105) + #agif0704#5 + "/"; |PATH_DAT #Referen@#aAlfa1#;
      |ABRE #Referen@;
      #Referen@#0 = #agifw704#10;
      |SI nTecla = 10;
         |LEE 000#Referen@.];
         |CONSULTA_CLAVE #1#Referen@;
         |SI FSalida = 0;
            #agifw705#1 = #Referen@#0; |PINTA #agifw705#1;
            #agifw705#4 = #Referen@#1; |PINTA #agifw705#4;
         |FINSI;
         |ERROR;
      |SINO;
         |LEE 000#Referen@.=;
         |SI FSalida = 0;
            #agifw705#4 = #Referen@#1; |PINTA #agifw705#4;
         |SINO;
            |MENAV "    Diario inexistente";
            |ERROR;
         |FINSI;
      |FINSI;
      |CIERRA #Referen@; |DESCARGA_DEF #Referen@;
   |FINSI;
|FPRC;

|PROCESO MiraLibroIVA;
   nTecla = FSalida;

   aAlfa = #agifw704#4; |QBF aAlfa;
   aAlfa1 = aAlfa % -101;
   |SI aAlfa1 ! "/"; |Y aAlfa1 ! "\";
      aAlfa = aAlfa + "/";
   |FINSI;
   aAlfa1 = aAlfa + "def/calibros.mas";
   |CARGA_DEF aAlfa1, Referen@;
   |SI FSalida = 0;
      aAlfa1 = aAlfa + "fich/" + (("00000" + #agifw704#5) % -105) + #agifw704#6 + "/"; |PATH_DAT #Referen@#aAlfa1#;
      |ABRE #Referen@;
      #Referen@#0 = #agifw704#10;
      |SI nTecla = 10;
         |LEE 000#Referen@.];
         |CONSULTA_CLAVE #1#Referen@;
         |SI FSalida = 0;
            #agifw704#10 = #Referen@#0; |PINTA #agifw704#10;
            #agifw704#11 = #Referen@#1; |PINTA #agifw704#11;
         |FINSI;
         |ERROR;
      |SINO;
         |LEE 000#Referen@.=;
         |SI FSalida = 0;
            #agifw704#11 = #Referen@#1; |PINTA #agifw704#11;
            |SI #agifw704#2 = "V"; |Y #Referen@#2 = "S";
               |MENAV "    Libro de IVA incorrecto (iva soportado)";
               |ERROR;
            |FINSI;
            |SI #agifw704#2 = "C"; |Y #Referen@#2 = "R";
               |MENAV "    Libro de IVA incorrecto (iva repercutido)";
               |ERROR;
            |FINSI;
         |SINO;
            |MENAV "    Libro de IVA inexistente";
            |ERROR;
         |FINSI;
      |FINSI;
      |CIERRA #Referen@; |DESCARGA_DEF #Referen@;
   |FINSI;
|FPRC;

|PROCESO CargaCanempre;
   nSwCarga = -1;
   aAlfa = #agifw704#4; |QBF aAlfa;
   aAlfa1 = aAlfa % -101;
   |SI aAlfa1 ! "/"; |Y aAlfa1 ! "\";
      aAlfa = aAlfa + "/";
   |FINSI;
   aAlfa1 = aAlfa + "def/canempre.mas";
   |CARGA_DEF aAlfa1, Referen@;
   |SI FSalida ! 0; nSwError = 1; |ACABA; |FINSI;

   aAlfa1 = aAlfa + "fich/"; |PATH_DAT #Referen@#aAlfa1#;
   |ABRE #Referen@;
   nSwCarga = 0; nSwError = 0;
|FPRC;

|PROCESO DescargaCanempre;
   |SI nSwCarga = 0;
      |CIERRA #Referen@; |DESCARGA_DEF #Referen@;
   |FINSI;
|FPRC;

|PROCESO T66EmpCont; |TIPO 66;
   |HAZ CargaCanempre;
   |SI nSwCarga = 0;
      #Referen@#2 = #agifw704#5;
      #Referen@#3 = #agifw704#6;
      |LEE 000#Referen@.];
      |CONSULTA_CLAVE #1#Referen@;
      |SI FSalida = 0;
         #agifw704#5  = #Referen@#2; |PINTA #agifw704#5;
         #agifw704#6  = #Referen@#3; |PINTA #agifw704#6;
         #agifw704#16 = #Referen@#1; |PINTA #agifw704#16;
      |FINSI;
      |HAZ DescargaCanempre;
   |FINSI;
   |ERROR;
|FPRC;

|PROCESO T00EmpCont;
   |SI FSalida = 2; |ACABA; |FINSI;

   |HAZ CargaCanempre;

   |SI nSwCarga = 0;
      #Referen@#2 = #agifw704#5;
      #Referen@#3 = #agifw704#6;
      |LEE 000#Referen@.=;
      |SI FSalida = 0;
         #agifw704#16 = #Referen@#1; |PINTA #agifw704#16;
      |SINO;
         |MENAV "    Empresa contable inexistente"; |ERROR;
      |FINSI;

      |HAZ DescargaCanempre;
   |SINO;
      |MENAV "    Problemas al cargar el def de empresas de contabilidad"; |ERROR;
   |FINSI;
|FPRC;

|PROCESO T66PerCont; |TIPO 66;
   |HAZ CargaCanempre;
   #Referen@#2 = #agifw704#5;
   #Referen@#3 = #agifw704#6;
   |LEE 000#Referen@.];
   |CONSULTA_CLAVE #1#Referen@;
   |SI FSalida = 0;
      #agifw704#5  = #Referen@#2; |PINTA #agifw704#5;
      #agifw704#6  = #Referen@#3; |PINTA #agifw704#6;
      #agifw704#16 = #Referen@#1; |PINTA #agifw704#16;
   |FINSI;
   |HAZ DescargaCanempre;

   |ERROR;
|FPRC;

|PROCESO T00PerCont;
   |HAZ CargaCanempre;

   #Referen@#2 = #agifw704#5;
   #Referen@#3 = #agifw704#6;
   |LEE 000#Referen@.=;
   |SI FSalida = 0;
      #agifw704#16 = #Referen@#1; |PINTA #agifw704#16;
   |SINO;
      |MENAV "    Empresa contable inexistente";
      |ERROR;
   |FINSI;

   |HAZ DescargaCanempre;
|FPRC;

|PROCESO MiraPath;
   |SI FSalida = 10;
      |DBASS aAlfa; |QBF aAlfa;
      aAlfa = aAlfa + "contagen/";
      #agifw704#4 = aAlfa;
   |FINSI;

   aAlfa = #agifw704#4; |QBF aAlfa;
   aLong = aAlfa % 0; nLong = aLong;
   nCalc = (nLong * 100) + 1;
   aAlfa1 = aAlfa % nCalc;
   |SI aAlfa1 ! "/"; |Y aAlfa1 ! "\";
      aAlfa = aAlfa + "/";
      #agifw704#4 = aAlfa;
   |FINSI;
   |PINTA #agifw704#4;
|FPRC;

|PROCESO BotonSalir;
   |PTEC 807;
|FPRC;

|PROCESO PantallaBase;
   |SI nVent1 ! 0; |FINVENTANA nVent1; nVent1 = 0; |FINSI;

   |SI nNumPant ! 2;
      |SI nBotonNueP2a ] 0; |FIN_CONTROL_WINDOWS nBotonNueP2a; nBotonNueP2a = -1; |FINSI;
      |SI nBotonModP2a ] 0; |FIN_CONTROL_WINDOWS nBotonModP2a; nBotonModP2a = -1; |FINSI;
      |SI nBotonBorP2a ] 0; |FIN_CONTROL_WINDOWS nBotonBorP2a; nBotonBorP2a = -1; |FINSI;
      |SI nBotonNueP2b ] 0; |FIN_CONTROL_WINDOWS nBotonNueP2b; nBotonNueP2b = -1; |FINSI;
      |SI nBotonModP2b ] 0; |FIN_CONTROL_WINDOWS nBotonModP2b; nBotonModP2b = -1; |FINSI;
      |SI nBotonBorP2b ] 0; |FIN_CONTROL_WINDOWS nBotonBorP2b; nBotonBorP2b = -1; |FINSI;
      |SI nGridP2a ] 0; |DESTRUYECONTROL nGridP2a; nGridP2a = -1; |FINSI;
      |SI nGridP2b ] 0; |DESTRUYECONTROL nGridP2b; nGridP2b = -1; |FINSI;
   |FINSI;
   |SI nNumPant ! 3;
      |SI nBotonNueP3a ] 0; |FIN_CONTROL_WINDOWS nBotonNueP3a; nBotonNueP3a = -1; |FINSI;
      |SI nBotonModP3a ] 0; |FIN_CONTROL_WINDOWS nBotonModP3a; nBotonModP3a = -1; |FINSI;
      |SI nBotonBorP3a ] 0; |FIN_CONTROL_WINDOWS nBotonBorP3a; nBotonBorP3a = -1; |FINSI;
      |SI nGridP3a ] 0; |DESTRUYECONTROL nGridP3a; nGridP3a = -1; |FINSI;
   |FINSI;
   |SI nNumPant ! 4;
      |SI nBotonNueP4a ] 0; |FIN_CONTROL_WINDOWS nBotonNueP4a; nBotonNueP4a = -1; |FINSI;
      |SI nBotonModP4a ] 0; |FIN_CONTROL_WINDOWS nBotonModP4a; nBotonModP4a = -1; |FINSI;
      |SI nBotonBorP4a ] 0; |FIN_CONTROL_WINDOWS nBotonBorP4a; nBotonBorP4a = -1; |FINSI;
      |SI nGridP4a ] 0; |DESTRUYECONTROL nGridP4a; nGridP4a = -1; |FINSI;
   |FINSI;
   |SI nNumPant ! 5;
      |SI nBotonNueP5a ] 0; |FIN_CONTROL_WINDOWS nBotonNueP5a; nBotonNueP5a = -1; |FINSI;
      |SI nBotonModP5a ] 0; |FIN_CONTROL_WINDOWS nBotonModP5a; nBotonModP5a = -1; |FINSI;
      |SI nBotonBorP5a ] 0; |FIN_CONTROL_WINDOWS nBotonBorP5a; nBotonBorP5a = -1; |FINSI;
      |SI nGridP5a ] 0; |DESTRUYECONTROL nGridP5a; nGridP5a = -1; |FINSI;
      |SI nGridP5b ] 0; |DESTRUYECONTROL nGridP5b; nGridP5b = -1; |FINSI;
   |FINSI;

   nPos1 = 1626; nPos2 = 2897;
   |VENTANA nPos1, nPos2, -1, 1, ""; nVent1 = FSalida;
|FPRC;

|PROCESO EvtoGrid718;
   |SI FSalida = 1; |O FSalida = 2;
      |LEE 000#agif0718.c;

      |ESTADO_CONTROL nBotonBorP5a, "ENABLE";
      |ESTADO_CONTROL nBotonModP5a, "ENABLE";
   |FINSI;
|FPRC;

|PROCESO Inf718;
   #agif0718#0 = #agif0704#0;
   #agif0718#1 = #agif0717#1;
   #agif0718#2 = 1;
|FPRC;

|PROCESO Sup718;
   #agif0718#0 = #agif0704#0;
   #agif0718#1 = #agif0717#1;
   #agif0718#2 = 999;
|FPRC;

|PROCESO EvtoGrid717;
   |SI FSalida = 1; |O FSalida = 2;
      |LEE 000#agif0717.c;

      |REFRESCACONTROL nGridP5b;
   |FINSI;
|FPRC;

|PROCESO Inf717;
   #agif0717#0 = #agif0704#0;
   #agif0717#1 = " " * 15;
|FPRC;

|PROCESO Sup717;
   #agif0717#0 = #agif0704#0;
   #agif0717#1 = "z" * 15;
|FPRC;

|PROCESO IncluyeCmps;
   |REFERENCIA_DEF get1, #agifw797;
   get2 = 1;
   Iget = get1<-;
   |ESPECIFICA "GETDATACONTROL",get;
   #agifw797#1 = FSalida;

   |PARA nCont = 1; |SI nCont [ 15; |HACIENDO nCont = nCont + 1;
      aAlfa = #agifw797#nCont#; |QBF aAlfa;
      |SI aAlfa ! "";
         eaResultado = eaResultado + aAlfa;
      |FINSI;
   |SIGUE;

   aAlfa = "agif0708.tab;" + #agif0704#0;
   |SUB_EJECUTA aAlfa;

   || Ahora separo la variable eaResultado para que entre en todo el def de
   ||   edicion de memorias.
   nCont = 1; aAlfaG = "";
   aAlfa = eaResultado; |QBF aAlfa;
   |PARA; |SI aAlfa ! ""; |HACIENDO;
      aAlfa1 = aAlfa % 0153; aAlfa = (aAlfa % 5499) + (aAlfa % 15399) + (aAlfa % 25203);
      |PARA; |SI aAlfa1 ! ""; |HACIENDO;
         aAlfa2 = aAlfa1 % 0101; aAlfa1 = aAlfa1 % 0299;
         |SI nSwCmpMem = 0;
            |SI aAlfa2 = "[";
               aAlfa3 = aAlfa2;
               nSwCmpMem = 1;
            |SINO;
               aAlfaG = aAlfaG + aAlfa2;
               aAlfa3 = "";
            |FINSI;
         |SINO;
            |SI aAlfa2 = "]";
               aAlfa2 = aAlfa1 % 0101;
               |SI aAlfa2 ! "[";
                  aAlfaG = aAlfaG + aAlfa3 + "]";
                  nSwCmpMem = 0;
               |SINO;
                  aAlfa3 = aAlfa3 + "][";
                  aAlfa1 = aAlfa1 % 0299;
               |FINSI;
            |SINO;
               aAlfa3 = aAlfa3 + aAlfa2;
            |FINSI;
         |FINSI;
      |SIGUE;
      |SI nCont [ 15; |Y aAlfaG ! "";
         #agifw797#nCont# = aAlfaG;
         nCont = nCont + 1;
         aAlfaG = ""; aAlfa3 = "";
      |FINSI;
   |SIGUE;

   |SI nCont [ 15; |Y aAlfa3 ! "";
      #agifw797#nCont# = aAlfa3;
      nCont = nCont + 1;
      aAlfa3 = "";
   |FINSI;

   |PINTA #agifw797#1;
   eaResultado = "";
|FPRC;

|PROCESO EditaMemorias;
   aAlfa = "Edicion memoria " + aTitulo;
   |VENTANA 1021, 2479, nPant0, 17, aAlfa; nVentFlt = FSalida;
   aVent1 = -1;
   aVent2 = -1;
   aVent3 = 0;
   aVent4 = nVentFlt;
   aVent5 = "MODAL";
   |ESPECIFICA "ESTADO_VENTANA", aVent;

   |SI nSwModo = 2;
      |C_M #agifw797#0, 1, "N";
   |SINO;
      |C_M #agifw797#0, 1, "S";
   |FINSI;

   |PINPA #0#agifw797; nPantFlt = FSalida;
   |PINDA #0#agifw797;

   nPos1 = 1840; nPos2 = 1858;
   |CONTROL_SIMPLE nPantFlt, "BOTON,{{197}}Incluir campos", nPos1, nPos2, IncluyeCmps;
   nBotonIncCmp = FSalida; |ESTADO_CONTROL nBotonIncCmp, "DISABLE";

   |ENDATOS #1#agifw797;
   |SI FSalida = 0;
      |SI nSwModo = 1;
         |DDEFECTO #agif0717;
         #agif0717#0 = #agif0704#0;
         #agif0717#1 = #agifw797#0;
         |GRABA 020#agif0717.c;
      |FINSI;

      || Eliminamos lo que habia hasta ahora ....
      #agif0718#0 = #agif0717#0;
      #agif0718#1 = #agif0717#1;
      #agif0718#2 = 1;
      |LEE 000#agif0718.];
      |PARA; |SI FSalida = 0; |Y #agif0718#0 = #agif0717#0; |Y #agif0718#1 = #agif0717#1; |HACIENDO;
         |BORRA 020#agif0718.a;
         |LEE 000#agif0718.s;
      |SIGUE;

      nCont1 = 1;
      |PARA nCont = 1; |SI nCont [ 15; |HACIENDO nCont = nCont + 1;
         aAlfa = #agifw797#nCont#; |QBF aAlfa;
         |SI aAlfa ! "";
            |DDEFECTO #agif0718;
            #agif0718#0 = #agif0717#0;
            #agif0718#1 = #agif0717#1;
            #agif0718#2 = nCont1; nCont1 = nCont1 + 1;
            #agif0718#3 = #agifw797#nCont#;
            |GRABA 020#agif0718.n;
         |FINSI;
      |SIGUE;
      nSwErr = 0;
   |SINO;
      nSwErr = -1;
   |FINSI;

   |FIN_CONTROL_WINDOWS nBotonIncCmp;

   aVent4 = nVentFlt;
   aVent5 = "MODELESS";
   |ESPECIFICA "ESTADO_VENTANA", aVent;
   |FINVENTANA nVentFlt;
|FPRC;

|PROCESO BotonNuevoP5a;
   |DDEFECTO #agifw797;
   nSwModo = 1; |HAZ EditaMemorias;
   |SI nSwErr = 0; |REFRESCACONTROL nGridP5a; |FINSI;
|FPRC;

|PROCESO BotonModifP5a;
   |DDEFECTO #agifw797;
   #agifw797#0 = #agif0717#1;

   #agif0718#0 = #agif0717#0;
   #agif0718#1 = #agif0717#1;
   #agif0718#2 = 1;
   |LEE 000#agif0718.];
   |PARA; |SI FSalida = 0; |Y #agif0718#0 = #agif0717#0; |Y #agif0718#1 = #agif0717#1; |HACIENDO;
      aAlfa = #agif0718#3; |QBF aAlfa;
      |SI aAlfa ! "";
         |PARA nCont = 1; |SI nCont [ 15; |HACIENDO nCont = nCont + 1;
            aAlfa1 = #agifw797#nCont#; |QBF aAlfa1;
            |SI aAlfa1 = ""; |SAL; |FINSI;
         |SIGUE;
         |SI nCont [ 15;
            #agifw797#nCont# = #agif0718#3;
         |FINSI;
      |FINSI;

      |LEE 000#agif0718.s;
   |SIGUE;

   nSwModo = 2; |HAZ EditaMemorias;
   |SI nSwErr = 0; |REFRESCACONTROL nGridP5b; |FINSI;
|FPRC;

|PROCESO BorraLinMemo;
   |BORRA 020#agif0718.a;
|FPRC;

|DEFBUCLE BorraLinMemo;
#agif0718#1;
;
#agif0717#0, #agif0717#1, 001;
#agif0717#0, #agif0717#1, 999;
be;
NULL,BorraLinMemo;
|FIN;

|PROCESO BotonBorraP5a;
   aAlfa = "    N" + &191 + " Esta seguro de eliminar esta memoria ?";
   |CONFI aAlfa;
   |SI FSalida = 0;
      |BUCLE BorraLinMemo;

      |BORRA 020#agif0717.a;

      |LEE 000#agif0717.c;
      |SI FSalida ! 0;
         |ESTADO_CONTROL nBotonBorP5a, "DISABLE";
         |ESTADO_CONTROL nBotonModP5a, "DISABLE";
      |FINSI;
      |REFRESCACONTROL nGridP5a; |REFRESCACONTROL nGridP5b;
   |FINSI;
|FPRC;

|PROCESO PintaDatos5;
   |SI nBotonBorP5a < 0;
      nPos1 = 1849; nPos2 = 1859;
      |CONTROL_SIMPLE nPant1, "BOTON,{{199}}Borrar", nPos1, nPos2, BotonBorraP5a;
      nBotonBorP5a = FSalida;
   |FINSI;
   |ESTADO_CONTROL nBotonBorP5a, "DISABLE";

   |SI nBotonModP5a < 0;
      nPos1 = 1837; nPos2 = 1847;
      |CONTROL_SIMPLE nPant1, "BOTON,{{135}}Modificar", nPos1, nPos2, BotonModifP5a;
      nBotonModP5a = FSalida;
   |FINSI;
   |ESTADO_CONTROL nBotonModP5a, "DISABLE";

   |SI nBotonNueP5a < 0;
      nPos1 = 1825; nPos2 = 1835;
      |CONTROL_SIMPLE nPant1, "BOTON,{{137}}Nuevo", nPos1, nPos2, BotonNuevoP5a;
      nBotonNueP5a = FSalida;
   |FINSI;

   |SI nGridP5a < 0;
      nPos1 = 0502; nPos2 = 1720;
      |LINEAL_SIMPLE #1#agif0717, nRango, nPos1, nPos2, Inf717, Sup717, EvtoGrid717;
      nGridP5a = FSalida;
      |PULSATECLA;
   |SINO;
      |REFRESCACONTROL nGridP5a;
   |FINSI;

   |SI nGridP5b < 0;
      nPos1 = 0522; nPos2 = 1771;
      |LINEAL_SIMPLE #1#agif0718, nRango, nPos1, nPos2, Inf718, Sup718, EvtoGrid718;
      nGridP5b = FSalida;
      |PULSATECLA;
   |SINO;
      |REFRESCACONTROL nGridP5b;
   |FINSI;
|FPRC;

|PROCESO Pantalla5;
   nNumPant = 5;

   |HAZ PantallaBase;
   |PINPA #0#agif704b; nPant1 = FSalida;
   |HAZ PintaDatos5; |PINDA #0#agif704b;

   nPos1 = 1861; nPos2 = 1871;
   |CONTROL_SIMPLE nPant1, "BOTON,{{001}}Salir", nPos1, nPos2, BotonSalir;
   nBotonSalir = FSalida;
   |PULSATECLA;
   |PTEC 802; |PAUSA;

   |SI nSwEntPant = 8; |ACABA; |FINSI;
|FPRC;

|PROCESO EvtoGrid702;
   |SI FSalida = 1; |O FSalida = 2;
      |LEE 000#agif0702.c;

      |ESTADO_CONTROL nBotonBorP4a, "ENABLE";
      |ESTADO_CONTROL nBotonModP4a, "ENABLE";
   |FINSI;
|FPRC;

|PROCESO Inf702;
   #agif0702#1 = "        ";
   #agif0702#2 = 000;
   #agif0702#4 = #agif0704#2;
|FPRC;

|PROCESO Sup702;
   #agif0702#1 = "zzzzzzzz";
   #agif0702#2 = 999;
   #agif0702#4 = #agif0704#2;
|FPRC;

|PROCESO EvtoGridA;
   |SI FSalida = 1; |O FSalida = 2;
      |LEE 000#agifw702.c;

      |REFRESCACONTROL nGridB;
   |FINSI;
|FPRC;

|PROCESO EvtoGridB;
   |SI FSalida = 1; |O FSalida = 2;
      |LEE 000#agifw703.c;
   |FINSI;

   |SI FSalida = 4;
      |HAZ SelecCampo;
   |FINSI;
|FPRC;

|PROCESO Infw703;
   #agifw703#0 = #agifw702#0;
   #agifw703#1 = 1;
|FPRC;

|PROCESO Supw703;
   #agifw703#0 = #agifw702#0;
   #agifw703#1 = 999;
|FPRC;

|PROCESO PonVentEspera;
   |VENTANA 1509, 1691, nPant0, 17, ""; nVentEsp = FSalida;
   aVent1 = -1;
   aVent2 = -1;
   aVent3 = 0;
   aVent4 = nVentEsp;
   aVent5 = "MODAL";
   |ESPECIFICA "ESTADO_VENTANA", aVent;

   |PINPA #0#agifw700; nPantEsp = FSalida;

   nPos1 = 0502; nPos2 = 0780;
   |CONTROL_SIMPLE nPantEsp, "LABEL,{{5}}Espere un momento, por favor ...", nPos1, nPos2,  NULL;
   nLabelEsp = FSalida;

   |PINPA #0#agifw700;
   |PTEC 802; |PAUSA;
|FPRC;

|PROCESO QuitaVentEspera;
   |FIN_CONTROL_WINDOWS nLabelEsp;

   aVent4 = nVentEsp;
   aVent5 = "MODELESS";
   |ESPECIFICA "ESTADO_VENTANA", aVent;

   |FINVENTANA nVentEsp;
|FPRC;

|PROCESO SelecCampo;
   |VENTANA 0911, 1349, nPantFlt, 17, "Indique el tipo de campo"; nVentFlt1 = FSalida;
   aVent1 = -1;
   aVent2 = -1;
   aVent3 = 0;
   aVent4 = nVentFlt1;
   aVent5 = "MODAL";
   |ESPECIFICA "ESTADO_VENTANA", aVent;
   |PINPA #0#agifw798; nPantFlt1 = FSalida;
   |PINDA #0#agifw798;
   |ENDATOS #1#agifw798;
   |SI FSalida = 0;
      |SI nSwModo = 1;
         |SELECT #1#agif0702;
         |LEE 000#agif0702.u;
         |SI FSalida ! 0; #agif0702#0 = 0; |FINSI;
         nCalc = #agif0702#0 + 1;
         |SELECT #3#agif0702;

         |DDEFECTO #agif0702;
         #agif0702#0 = nCalc;
         |GRABA 020#agif0702.b;
      |FINSI;
      #agif0702#1 = #agifw702#0;
      #agif0702#2 = #agifw703#1;
      #agif0702#3 = #agifw703#2;
      #agif0702#4 = #agif0704#2;
      |SI #agifw798#0 = "S"; #agif0702#5 = "C"; |FINSI;
      |SI #agifw798#1 = "S"; #agif0702#5 = "A"; |FINSI;
      |SI #agifw798#2 = "S"; #agif0702#5 = "D"; |FINSI;
      |SI #agifw798#3 = "S"; #agif0702#5 = "I"; |FINSI;
      |GRABA 020#agif0702.a; |LIBERA #agif0702;
      nSwSel = 0;
      |SI nSwModo = 1; |PTEC 807; |FINSI;
   |SINO;
      nSwSel = -1;
   |FINSI;
   aVent4 = nVentFlt1;
   aVent5 = "MODELESS";
   |ESPECIFICA "ESTADO_VENTANA", aVent;
   |FINVENTANA nVentFlt1;
|FPRC;

|PROCESO RecogeCampos;
   |HAZ PonVentEspera;
   |DDEF aAlfa; |QBF aAlfa;
   aAlfa = aAlfa + "*.mas";
   |_PDIR aAlfa;
   |PARA; |SI FSalida = 0; |HACIENDO;
      |CARGA_DEF aAlfa, Referen@;
      |SI FSalida = 0;
         |DDEF aAlfa1; |QBF aAlfa1;
         aAlfa1 = aAlfa - aAlfa1; aAlfa1 = aAlfa1 - ".mas";
         |DDEF aAlfa2;   |QBF aAlfa2; aAlfa1 = aAlfa2 + aAlfa1 + ".mas";
         |DFICE aAlfa2; |QBF aAlfa2;
         |LEEDEDEF aAlfa1, aAlfa2; aAlfa1 = FSalida % 1815; |QBT aAlfa1;
         nCalc = aAlfa1;
         |SI nCalc > 0;
            |DDEF aAlfa1; |QBF aAlfa1;
            aAlfa1 = aAlfa - aAlfa1; aAlfa1 = aAlfa1 - ".mas";
            aAlfa2 = "|TITULO"; aAlfa2 = #Referen@#aAlfa2#;
            |DDEFECTO #agifw702;
            #agifw702#0 = aAlfa1;
            #agifw702#1 = aAlfa2;
            |GRABA 020#agifw702.c;
            aAlfa2 = "|NC"; aAlfa2 = #Referen@#aAlfa2#;
            nCalc = aAlfa2;
            |PARA nCont = 0; |SI nCont < nCalc; |HACIENDO nCont = nCont + 1;
               aAlfa2 = "|C" + (("000" + nCont) % -103) + "NOMBRE"; aAlfa2 = #Referen@#aAlfa2#;
               |DDEFECTO #agifw703;
               #agifw703#0 = #agifw702#0;
               #agifw703#1 = nCont;
               #agifw703#2 = aAlfa2;
               |GRABA 020#agifw703.n;
            |SIGUE;
         |FINSI;
         |DESCARGA_DEF #Referen@;
      |FINSI;
      |_SDIR aAlfa;
   |SIGUE;
   |HAZ QuitaVentEspera;
|FPRC;

|PROCESO EditaCampoSel;
   |LEE 000#agifw702.p;
   |SI FSalida ! 0; |HAZ RecogeCampos; |FINSI;

   #agifw702#0 = #agif0702#1;
   |LEE 000#agifw702.];

   #agifw703#0 = #agif0702#1;
   #agifw703#1 = #agif0702#2;
   |LEE 000#agifw703.];

   |VENTANA 1015, 2385, nPant0, 17, "Asignar un campo a un tipo de enlace"; nVentFlt = FSalida;
   aVent1 = -1;
   aVent2 = -1;
   aVent3 = 0;
   aVent4 = nVentFlt;
   aVent5 = "MODAL";
   |ESPECIFICA "ESTADO_VENTANA", aVent;

   |PINPA #0#agifw700; nPantFlt = FSalida;
   |PINDA #0#agifw700;
   |PTEC 802; |PAUSA;

   nPos1 = 1950; nPos2 = 1960;
   |CONTROL_SIMPLE nPantFlt, "BOTON,{{1}}Salir", nPos1, nPos2, BotonSalir;
   nBotonSalir = FSalida;

   nPos1 = 0502; nPos2 = 0561;
   |CONTROL_SIMPLE nPantFlt, "LABEL,{{6}}Doble click en el lineal de la derecha para seleccionar", nPos1, nPos2, NULL;
   nLabelDblClk = FSalida;

   nRango = 4 + 8 + 16 + 32;
   nPos1 = 0602; nPos2 = 1735;
   |LINEAL_SIMPLE #1#agifw702, nRango, nPos1, nPos2, NULL, NULL, EvtoGridA;
   nGridA = FSalida;

   nPos1 = 0637; nPos2 = 1770;
   |LINEAL_SIMPLE #1#agifw703, nRango, nPos1, nPos2, Infw703, Supw703, EvtoGridB;
   nGridB = FSalida;
   |PULSATECLA;

   |SI nSwModo = 1;
      aEsc1  = &255 + "806";
      aEsc2  = &255 + "807";
      aRetu  = &255 + "802";
      |PARA; |SI;  |HACIENDO;
         FSalida = "::{{001}}Salir";
         |LEETECLA aTecla;
         |SI aTecla = aEsc1; |SAL; |FINSI;
         |SI aTecla = aEsc2; |SAL; |FINSI;
         |SI aTecla = aRetu; |SAL; |FINSI;
      |SIGUE;
   |FINSI;

   |SI nSwModo = 2;
      #agifw798#0 = "N"; #agifw798#1 = "N";
      #agifw798#2 = "N"; #agifw798#3 = "N";
      |SI #agif0702#5 = "C"; #agifw798#0 = "S"; |FINSI;
      |SI #agif0702#5 = "A"; #agifw798#1 = "S"; |FINSI;
      |SI #agif0702#5 = "D"; #agifw798#2 = "S"; |FINSI;
      |SI #agif0702#5 = "I"; #agifw798#3 = "S"; |FINSI;
      |HAZ SelecCampo;
   |FINSI;

   |FIN_CONTROL_WINDOWS nLabelDblClk;
   |FIN_CONTROL_WINDOWS nBotonSalir;

   aVent4 = nVentFlt;
   aVent5 = "MODELESS";
   |ESPECIFICA "ESTADO_VENTANA", aVent;
   |FINVENTANA nVentFlt;
|FPRC;

|PROCESO BotonNuevoP4a;
   nSwModo = 1; |HAZ EditaCampoSel;
   |SI nSwSel = 0; |REFRESCACONTROL nGridP4a; |FINSI;
|FPRC;

|PROCESO BotonModifP4a;
   nSwModo = 2; |HAZ EditaCampoSel;
   |SI nSwSel = 0; |REFRESCACONTROL nGridP4a; |FINSI;
|FPRC;

|PROCESO BotonBorraP4a;
   aAlfa = "    N" + &191 + " Esta seguro de eliminar este campo ?";
   |CONFI aAlfa;
   |SI FSalida = 0;
      |BORRA 020#agif0702.a;

      |LEE 000#agif0702.c;
      |SI FSalida ! 0;
         |ESTADO_CONTROL nBotonBorP4a, "DISABLE";
         |ESTADO_CONTROL nBotonModP4a, "DISABLE";
      |FINSI;
      |REFRESCACONTROL nGridP4a;
   |FINSI;
|FPRC;

|PROCESO PintaDatos4;
   |SI nBotonBorP4a < 0;
      nPos1 = 1849; nPos2 = 1859;
      |CONTROL_SIMPLE nPant1, "BOTON,{{199}}Borrar", nPos1, nPos2, BotonBorraP4a;
      nBotonBorP4a = FSalida;
   |FINSI;
   |ESTADO_CONTROL nBotonBorP4a, "DISABLE";

   |SI nBotonModP4a < 0;
      nPos1 = 1837; nPos2 = 1847;
      |CONTROL_SIMPLE nPant1, "BOTON,{{135}}Modificar", nPos1, nPos2, BotonModifP4a;
      nBotonModP4a = FSalida;
   |FINSI;
   |ESTADO_CONTROL nBotonModP4a, "DISABLE";

   |SI nBotonNueP4a < 0;
      nPos1 = 1825; nPos2 = 1835;
      |CONTROL_SIMPLE nPant1, "BOTON,{{137}}Nuevo", nPos1, nPos2, BotonNuevoP4a;
      nBotonNueP4a = FSalida;
   |FINSI;
   |SI nSwSinLin = 1; |ESTADO_CONTROL nBotonNueP4a, "DISABLE"; |FINSI;

   |SI nGridP4a < 0;
      nRango = 4 + 8 + 16 + 32 + 128;
      nPos1 = 0502; nPos2 = 1771;
      |LINEAL_SIMPLE #3#agif0702, nRango, nPos1, nPos2, Inf702, Sup702, EvtoGrid702;
      nGridP4a = FSalida;
      |PULSATECLA;
      nRango = 4 + 8 + 16 + 32;
   |SINO;
      |REFRESCACONTROL nGridP4a;
   |FINSI;
|FPRC;

|PROCESO Pantalla4;
   nNumPant = 4;

   |HAZ PantallaBase;
   |PINPA #0#agif704b; nPant1 = FSalida;
   |HAZ PintaDatos4; |PINDA #0#agif704b;

   nPos1 = 1861; nPos2 = 1871;
   |CONTROL_SIMPLE nPant1, "BOTON,{{001}}Salir", nPos1, nPos2, BotonSalir;
   nBotonSalir = FSalida;
   |PTEC 802; |PAUSA;

   |SI nSwEntPant = 7; |ACABA; |FINSI;
|FPRC;

|PROCESO EvtoGrid707;
   |SI FSalida = 1; |O FSalida = 2;
      |LEE 000#agif0707.c;

      |ESTADO_CONTROL nBotonBorP3a, "ENABLE";
      |ESTADO_CONTROL nBotonModP3a, "ENABLE";
      |ESTADO_CONTROL nBotonCmpClvP3a, "ENABLE";

      |SI nLabelCmpClvP3a ] 0;
         |FIN_CONTROL_WINDOWS nLabelCmpClvP3a; nLabelCmpClvP3a = -1;
      |FINSI;
      |SI #agif0704#16 ! "        "; |O #agif0704#17 ! 999;
         |DDEF aAlfa; |QBF aAlfa;
         aAlfa = aAlfa + #agif0704#16; |QBF aAlfa;
         aAlfa = aAlfa + ".mas";
         |CARGA_DEF aAlfa, Referen@;
         |SI FSalida = 0;
            aAlfa = "|TITULO"; aAlfa = #Referen@#aAlfa#;
            aAlfa1 = "|C" + (("000" + #agif0704#17) % -103) + "NOMBRE";
            aAlfa1 = #Referen@#aAlfa1#; |QBF aAlfa1;
            |DESCARGA_DEF #Referen@;
         |FINSI;
         nPos1 = 1702; nPos2 = 1762;
         aAlfa = "LABEL,{{7}}Campo clave enlace : [" + aAlfa + "][" + aAlfa1 + "]";
         |CONTROL_SIMPLE nPant1, aAlfa, nPos1, nPos2, NULL;
         nLabelCmpClvP3a = FSalida;
      |FINSI;
   |FINSI;
   |SI FSalida = 4;
      |HAZ BotonMarcaP3a;
   |FINSI;
|FPRC;

|PROCESO MiraSiYaEsta;
   nSwErr = 0;
   |SELECT #3#agif0707;
   #agif0707#13 = #agifw701#0;
   #agif0707#14 = #agifw701#2;
   |LEE 000#agif0707.=;
   |PARA; |SI FSalida = 0; |Y #agif0707#13 = #agifw701#0; |Y #agif0707#14 = #agifw701#2; |HACIENDO;
      |SI #agif0704#0 = #agif0707#15; nSwErr = 1; |SAL; |FINSI;
      |LEE 000#agif0707.s;
   |SIGUE;
   |SELECT #1#agif0707;
|FPRC;

|PROCESO EvtoGridSel;
   |SI FSalida = 1; |O FSalida = 2;
      |LEE 000#agifw701.c;
   |FINSI;

   |SI FSalida = 4;
      || Compruebo si por ese campo ya se esta acotando
      |HAZ MiraSiYaEsta;
      |SI nSwErr = 1;
         aAlfa = "    N Ya se esta acotando por este campo. " + &191 + " Continuar ?";
         |CONFI aAlfa;
         |SI FSalida = 0;
            nSwRepite  = 1;
         |SINO;
            nSwRepite  = 0;
         |FINSI;
      |FINSI;
      |PTEC 802;
   |FINSI;
|FPRC;

|PROCESO RecogeAcotaciones;
   |DDEF aAlfa; |QBF aAlfa;
   aAlfa = aAlfa + #agif0702#1; |QBF aAlfa;
   aAlfa = aAlfa + ".mas";
   |CARGA_DEF aAlfa, Referen@;
   |SI FSalida = 0;
      aAlfa = "|TITULO"; aAlfa = #Referen@#aAlfa#;
      aAlfa1 = "|C" + (("000" + #agif0702#2) % -103) + "TIPO"; aAlfa1 = #Referen@#aAlfa1#;
      |DESCARGA_DEF #Referen@;
   |FINSI;

   |DDEFECTO #agifw701;
   #agifw701#0 = #agif0702#1;
   #agifw701#1 = aAlfa;
   #agifw701#2 = #agif0702#2;
   #agifw701#3 = #agif0702#3;
   #agifw701#4 = aAlfa1;
   |GRABA 020#agifw701.n;
|FPRC;

|DEFBUCLE RecogeAcotaciones;
#agif0702#1;
5, 4;
001, "A", #agif0704#2;
999, "A", #agif0704#2;
;
NULL, RecogeAcotaciones;
|FIN;

|PROCESO BotonOk;
   nSwOk = 1; |PTEC 802;
|FPRC;

|PROCESO BotonValida;
   |PTEC 801;
|FPRC;

|PROCESO BotonCancela;
   |PTEC 807;
|FPRC;

|PROCESO EditaAcotaciones;
   |VENTANA 1217, 2584, nPant0, 17, aTitulo; nVentFlt = FSalida;
   aVent1 = -1;
   aVent2 = -1;
   aVent3 = 0;
   aVent4 = nVentFlt;
   aVent5 = "MODAL";
   |ESPECIFICA "ESTADO_VENTANA", aVent;

   aAlfa = "tma" + Usuario; |NOME_DAT #agifw701#aAlfa#;
   |DELINDEX #agifw701; |ABRE #agifw701;

   |PINPA #0#agifw707; nPantFlt = FSalida;
   |PINDA #0#agifw707;

   |BUCLE RecogeAcotaciones;

   nPos1 = 1856; nPos2 = 1866;
   |CONTROL_SIMPLE nPantFlt, "BOTON,{{1}}Salir", nPos1, nPos2, BotonSalir;
   nBotonSalir = FSalida;

   nRango = 4 + 8 + 16 + 32;
   nPos1 = 0602; nPos2 = 1466;
   |LINEAL_SIMPLE #1#agifw701, nRango, nPos1, nPos2, NULL, NULL, EvtoGridSel;
   nGridSel = FSalida;
   |PULSATECLA;

   |SI nSw = 1;
|ET OtraVez;
      aEsc1  = &255 + "806";
      aEsc2  = &255 + "807";
      aRetu  = &255 + "802";
      |PARA; |SI;  |HACIENDO;
         FSalida = "::{{001}}Salir," + nGridSel;
         |LEETECLA aTecla;
         |SI aTecla = aEsc1; |SAL; |FINSI;
         |SI aTecla = aEsc2; |SAL; |FINSI;
         |SI aTecla = aRetu; |SAL; |FINSI;
      |SIGUE;

      |SI nSwErr = 1;
         |SI nSwRepite = 0; |VETE OtraVez; |FINSI;
      |FINSI;
   |SINO;
      #agifw701#0 = #agif0707#13;
      #agifw701#2 = #agif0707#14;
      |LEE 000#agifw701.=;
      |SI FSalida ! 0;
         aTecla = aEsc2;
      |SINO;
         aTecla = aRetu;
      |FINSI;
      |REFRESCACONTROL nGridSel;
   |FINSI;

   |FIN_CONTROL_WINDOWS nBotonSalir;

   |SI aTecla = aRetu; |O aTecla = aEsc1;
/*
      nPos1 = 1844; nPos2 = 1854;
      |CONTROL_SIMPLE nPantFlt, "BOTON,{{206}}Validar", nPos1, nPos2, BotonOk;
      nBotonOk = FSalida;

      nPos1 = 1856; nPos2 = 1866;
      |CONTROL_SIMPLE nPantFlt, "BOTON,{{207}}Cancelar", nPos1, nPos2, BotonCancela;
      nBotonCancela = FSalida;

      |ESTADO_CONTROL nGridSel, "DISABLE";

|ET EditaOtro;

      |SI #agifw701#4 = "A";
|ET Alfa1;
         |C_V #agifw707#6, 1, "N"; nSwErr = 0; nSwOk = 0;
         aAlfa1 = #agifw707#0; aAlfa2 = #agifw707#1;
         E_sup = 15; E_inf = "";
         aAlfa1 = 1612 ? 1;
         |SI FSalida = 0; |O FSalida = 3;
            |SI nSwOk = 0;
               #agifw707#0 = aAlfa1; #agifw707#6 = aAlfa1;
               |C_V #agifw707#6, 1, "S"; |PINTA #agifw707#6;
               |C_V #agifw707#7, 1, "N";
               aAlfa2 = 1638 ? 1;
            |SINO;
               |C_V #agifw707#6, 1, "S"; |PINTA #agifw707#6;
               FSalida = 0;
            |FINSI;
            |SI FSalida = 0; |O FSalida = 3;
               #agifw707#1 = aAlfa2; #agifw707#7 = aAlfa2;
            |SINO;
               |SI FSalida = 2;
                  #agifw707#1 = aAlfa2; #agifw707#7 = aAlfa2;
                  |C_V #agifw707#7, 1, "S"; |PINTA #agifw707#7;
                  |VETE Alfa1;
               |SINO;
                  nSwErr = -1;
               |FINSI;
            |FINSI;
            |C_V #agifw707#7, 1, "S"; |PINTA #agifw707#7;
         |SINO;
            nSwErr = -1;
            |C_V #agifw707#6, 1, "S"; |PINTA #agifw707#6;
         |FINSI;
      |FINSI;
      |SI #agifw701#4 = "N";
|ET Nume1;
         |C_V #agifw707#6, 1, "N"; nSwErr = 0; nSwOk = 0;
         aAlfa1 = #agifw707#2; aAlfa2 = #agifw707#3;
         E_sup = 999999999999999; E_inf = 0;
         nNume1 = 1612 ? 1;
         |SI FSalida = 0; |O FSalida = 3;
            |SI nSwOk = 0;
               #agifw707#2 = nNume1; #agifw707#6 = nNume1;
               |C_V #agifw707#6, 1, "S"; |PINTA #agifw707#6;
               |C_V #agifw707#7, 1, "N";
               nNume2 = 1638 ? 1;
            |SINO;
               |C_V #agifw707#6, 1, "S"; |PINTA #agifw707#6;
               FSalida = 0;
            |FINSI;
            |SI FSalida = 0; |O FSalida = 3;
               #agifw707#3 = nNume2;
               #agifw707#7 = nNume2;
            |SINO;
               |SI FSalida = 2;
                  #agifw707#3 = nNume2; #agifw707#7 = nNume2;
                  |C_V #agifw707#7, 1, "S"; |PINTA #agifw707#7;
                  |VETE Nume1;
               |SINO;
                  nSwErr = -1;
               |FINSI;
            |FINSI;
            |C_V #agifw707#7, 1, "S"; |PINTA #agifw707#7;
         |SINO;
            |C_V #agifw707#6, 1, "S"; |PINTA #agifw707#6;
            nSwErr = -1;
         |FINSI;
      |FINSI;
      |SI #agifw701#4 = "F";
|ET Fecha1;
         |C_V #agifw707#6, 1, "N"; nSwErr = 0; nSwOk = 0;
         aAlfa1 = #agifw707#4; aAlfa2 = #agifw707#5;
         E_sup = 10; E_inf = ~;
         fFecha1 = 1612 ? 1;
         |SI FSalida = 0; |O FSalida = 3;
            |SI nSwOk = 0;
               #agifw707#4 = fFecha1; #agifw707#6 = fFecha1;
               |C_V #agifw707#6, 1, "S"; |PINTA #agifw707#6;
               |C_V #agifw707#7, 1, "N";
               fFecha2 = 1638 ? 1;
            |SINO;
               |C_V #agifw707#6, 1, "S"; |PINTA #agifw707#6;
               FSalida = 0;
            |FINSI;
            |SI FSalida = 0; |O FSalida = 3;
               #agifw707#5 = fFecha2; #agifw707#7 = fFecha2;
            |SINO;
               |SI FSalida = 2;
                  #agifw707#5 = fFecha2; #agifw707#7 = fFecha2;
                  |C_V #agifw707#7, 1, "S"; |PINTA #agifw707#7;
                  |VETE Fecha1;
               |SINO;
                  nSwErr = -1;
               |FINSI;
            |FINSI;
            |C_V #agifw707#7, 1, "S"; |PINTA #agifw707#7;
         |SINO;
            nSwErr = -1;
            |C_V #agifw707#6, 1, "S"; |PINTA #agifw707#6;
         |FINSI;
      |FINSI;
*/
       |C_M #agifw707#6, 1, "N"; |C_V #agifw707#6, 1, "N";
       |C_M #agifw707#7, 1, "N"; |C_V #agifw707#7, 1, "N";
       |SI #agifw701#4 = "A";
          |C_M #agifw707#2, 1, "N"; |C_V #agifw707#2, 1, "N";
          |C_M #agifw707#3, 1, "N"; |C_V #agifw707#3, 1, "N";
          |C_M #agifw707#4, 1, "N"; |C_V #agifw707#4, 1, "N";
          |C_M #agifw707#5, 1, "N"; |C_V #agifw707#5, 1, "N";
          |C_M #agifw707#1, 1, "S"; |C_V #agifw707#1, 1, "S"; |PINTA #agifw707#1;
          |C_M #agifw707#0, 1, "S"; |C_V #agifw707#0, 1, "S"; |PINTA #agifw707#0;
       |FINSI;
       |SI #agifw701#4 = "N";
          |C_M #agifw707#0, 1, "N"; |C_V #agifw707#0, 1, "N";
          |C_M #agifw707#1, 1, "N"; |C_V #agifw707#1, 1, "N";
          |C_M #agifw707#4, 1, "N"; |C_V #agifw707#4, 1, "N";
          |C_M #agifw707#5, 1, "N"; |C_V #agifw707#5, 1, "N";
          |C_M #agifw707#2, 1, "S"; |C_V #agifw707#2, 1, "S"; |PINTA #agifw707#2;
          |C_M #agifw707#3, 1, "S"; |C_V #agifw707#3, 1, "S"; |PINTA #agifw707#3;
       |FINSI;
       |SI #agifw701#4 = "F";
          |C_M #agifw707#0, 1, "N"; |C_V #agifw707#0, 1, "N";
          |C_M #agifw707#1, 1, "N"; |C_V #agifw707#1, 1, "N";
          |C_M #agifw707#2, 1, "N"; |C_V #agifw707#2, 1, "N";
          |C_M #agifw707#3, 1, "N"; |C_V #agifw707#3, 1, "N";
          |C_M #agifw707#4, 1, "S"; |C_V #agifw707#4, 1, "S"; |PINTA #agifw707#4;
          |C_M #agifw707#5, 1, "S"; |C_V #agifw707#5, 1, "S"; |PINTA #agifw707#5;
       |FINSI;

       |ENDATOS #1#agifw707;
       |SI FSalida = 0;
          aAlfa = "    S" + &191 + " Es correcto ?";
          |CONFI aAlfa;
          |SI FSalida = 0;
             |SI #agifw701#4 = "A";
                #agifw707#6 = #agifw707#0;
                #agifw707#7 = #agifw707#1;
             |FINSI;
             |SI #agifw701#4 = "N";
                #agifw707#6 = #agifw707#2;
                #agifw707#7 = #agifw707#3;
             |FINSI;
             |SI #agifw701#4 = "F";
                #agifw707#6 = #agifw707#4;
                #agifw707#7 = #agifw707#5;
             |FINSI;
             |SI nSw = 1;
                nCalc = 1;
                #agif0707#15 = #agif0704#0;
                #agif0707#0  = 999;
                |LEE 000#agif0707.];
                |SI FSalida = 0;
                   |LEE 000#agif0707.a;
                |SINO;
                   |LEE 000#agif0707.u;
                |FINSI;

                |SI FSalida = 0; |Y #agif0707#15 = #agif0704#0;
                   nCalc = #agif0707#0 + 1;
                |FINSI;

                  |DDEFECTO #agif0707;
                  #agif0707#0 = nCalc;
                  #agif0707#15 = #agif0704#0;
                  |GRABA 020#agif0707.b;
               |FINSI;

               #agif0707#1 = #agifw701#1;
               #agif0707#2 = #agifw701#3;
               |SI #agifw701#4 = "A";
                  #agif0707#3 = #agifw707#0;
                  #agif0707#4 = #agifw707#1;
               |FINSI;
               |SI #agifw701#4 = "N";
                  #agif0707#5 = #agifw707#2;
                  #agif0707#6 = #agifw707#3;
               |FINSI;
               |SI #agifw701#4 = "F";
                  #agif0707#7 = #agifw707#4;
                  #agif0707#8 = #agifw707#5;
               |FINSI;
               #agif0707#9  = #agifw707#6;
               #agif0707#10 = #agifw707#7;
               #agif0707#11 = #agifw701#4;
               #agif0707#12 = 0;

               |DDEF aAlfa; |QBF aAlfa; aAlfa = aAlfa + #agifw701#0; |QBF aAlfa;
               aAlfa = aAlfa + ".mas";
               |CARGA_DEF aAlfa, Refere1@;
               |SI FSalida = 0;
                  aAlfa = "|C" + (("000" + #agifw701#2) % -103) + "LONGITUD";
                  aAlfa = #Refere1@#aAlfa#;
                  #agif0707#12 = aAlfa;
                  |DESCARGA_DEF #Refere1@;
               |FINSI;

               #agif0707#13 = #agifw701#0;
               #agif0707#14 = #agifw701#2;
               #agif0707#17 = #agifw707#8;
               |GRABA 020#agif0707.a; |LIBERA #agif0707;
            |FINSI;
         |SINO;
         |MENAV "    Proceso cancelado";
      |FINSI;
      |C_M #agifw707#0, 1, "N"; |C_V #agifw707#0, 1, "N";
      |C_M #agifw707#1, 1, "N"; |C_V #agifw707#1, 1, "N";
      |C_M #agifw707#2, 1, "N"; |C_V #agifw707#2, 1, "N";
      |C_M #agifw707#3, 1, "N"; |C_V #agifw707#3, 1, "N";
      |C_M #agifw707#4, 1, "N"; |C_V #agifw707#4, 1, "N";
      |C_M #agifw707#5, 1, "N"; |C_V #agifw707#5, 1, "N";
      |C_M #agifw707#6, 1, "S"; |C_V #agifw707#6, 1, "S"; |PINTA #agifw707#6;
      |C_M #agifw707#7, 1, "S"; |C_V #agifw707#7, 1, "S"; |PINTA #agifw707#7;
   |SINO;
      |MENAV "    Proceso cancelado";
   |FINSI;

   |ESTADO_CONTROL nGridSel, "ENABLE";
   |DESTRUYECONTROL nGridSel;

   |CIERRA #agifw701; |DELINDEX #agifw701;

   aVent4 = nVentFlt;
   aVent5 = "MODELESS";
   |ESPECIFICA "ESTADO_VENTANA", aVent;
   |FINVENTANA nVentFlt;
|FPRC;

|PROCESO BotonNuevoP3a;
   aTitulo = "Doble click para seleccionar la nueva acotacion";
   |DDEFECTO #agifw707;
   nSw = 1; |HAZ EditaAcotaciones;

   |REFRESCACONTROL nGridP3a;
|FPRC;

|PROCESO BotonModifP3a;
   #agifw707#0 = #agif0707#3;
   #agifw707#1 = #agif0707#4;
   #agifw707#2 = #agif0707#5;
   #agifw707#3 = #agif0707#6;
   #agifw707#4 = #agif0707#7;
   #agifw707#5 = #agif0707#8;
   #agifw707#6 = #agif0707#9;
   #agifw707#7 = #agif0707#10;
   #agifw707#8 = #agif0707#17;

   nSw = 2; |HAZ EditaAcotaciones;
   |REFRESCACONTROL nGridP3a;
|FPRC;

|PROCESO BotonBorraP3a;
   aAlfa = "    N" + &191 + " Esta seguro de eliminar esta linea de acotacion ?";
   |CONFI aAlfa;
   |SI FSalida = 0;
      |BORRA 020#agif0707.a;

      |LEE 000#agif0707.c;
      |SI FSalida ! 0;
         |ESTADO_CONTROL nBotonModP3a, "DISABLE";
         |ESTADO_CONTROL nBotonBorP3a, "DISABLE";
      |FINSI;
      |REFRESCACONTROL nGridP3a;
   |FINSI;
|FPRC;

|PROCESO Inf707;
   #agif0707#15 = #agif0704#0;
   #agif0707#0 = 1;
|FPRC;

|PROCESO Sup707;
   #agif0707#15 = #agif0704#0;
   #agif0707#0 = 999;
|FPRC;

|PROCESO BotonMarcaP3a;
   |SI #agif0704#16 ! #agif0707#13; |O #agif0704#17 ! #agif0707#14;
      #agif0704#16 = #agif0707#13;
      #agif0704#17 = #agif0707#14;
   |SINO;
      #agif0704#16 = "";
      #agif0704#17 = 999;
   |FINSI;
   |GRABA 020#agif0704.a;

   |REFRESCACONTROL nGridP3a;
|FPRC;

|PROCESO PintaDatos3;
   |SI nBotonCmpClvP3a < 0;
      nPos1 = 1802; nPos2 = 1822;
      |CONTROL_SIMPLE nPant1, "BOTON,{{197}}Marcar campo clave", nPos1, nPos2, BotonMarcaP3a;
      nBotonCmpClvP3a = FSalida;
   |FINSI;
   |ESTADO_CONTROL nBotonBorP3a, "DISABLE";

   |SI nBotonBorP3a < 0;
      nPos1 = 1849; nPos2 = 1859;
      |CONTROL_SIMPLE nPant1, "BOTON,{{199}}Borrar", nPos1, nPos2, BotonBorraP3a;
      nBotonBorP3a = FSalida;
   |FINSI;
   |ESTADO_CONTROL nBotonBorP3a, "DISABLE";

   |SI nBotonModP3a < 0;
      nPos1 = 1837; nPos2 = 1847;
      |CONTROL_SIMPLE nPant1, "BOTON,{{135}}Modificar", nPos1, nPos2, BotonModifP3a;
      nBotonModP3a = FSalida;
   |FINSI;
   |ESTADO_CONTROL nBotonModP3a, "DISABLE";

   |SI nBotonNueP3a < 0;
      nPos1 = 1825; nPos2 = 1835;
      |CONTROL_SIMPLE nPant1, "BOTON,{{137}}Nuevo", nPos1, nPos2, BotonNuevoP3a;
      nBotonNueP3a = FSalida;
   |FINSI;
   |SI nSwSinLin = 1; |ESTADO_CONTROL nBotonNueP3a, "DISABLE"; |FINSI;

   |SI nGridP3a < 0;
      nPos1 = 0502; nPos2 = 1671;
      |LINEAL_SIMPLE #1#agif0707, nRango, nPos1, nPos2, Inf707, Sup707, EvtoGrid707;
      nGridP3a = FSalida;
      |PULSATECLA;
   |SINO;
      |REFRESCACONTROL nGridP3a;
   |FINSI;
|FPRC;

|PROCESO Pantalla3;
   nNumPant = 3;

   |HAZ PantallaBase;
   |PINPA #0#agif704b; nPant1 = FSalida;
   |HAZ PintaDatos3; |PINDA #0#agif704b;

   nPos1 = 1861; nPos2 = 1871;
   |CONTROL_SIMPLE nPant1, "BOTON,{{001}}Salir", nPos1, nPos2, BotonSalir;
   nBotonSalir = FSalida;
   |PTEC 802; |PAUSA;

   |SI nSwEntPant = 6; |ACABA; |FINSI;
|FPRC;

|PROCESO EvtoGrid705;
   || aAlfa = "    Evento 705 [" + FSalida + "]"; |MENAV aAlfa;
   |SI FSalida = 1; |O FSalida = 2;
      |LEE 000#agif0705.c;
      ||MENAV "     Eventuando 705";
      |ESTADO_CONTROL nBotonModP2a, "ENABLE";
      |ESTADO_CONTROL nBotonBorP2a, "ENABLE";

      |ESTADO_CONTROL nBotonModP2b, "DISABLE";
      |ESTADO_CONTROL nBotonBorP2b, "DISABLE";
      |REFRESCACONTROL nGridP2b;
   |FINSI;
|FPRC;

|PROCESO Inf705;
   #agif0705#0 = #agif0704#0;
   #agif0705#2 = 1;
|FPRC;

|PROCESO Sup705;
   #agif0705#0 = #agif0704#0;
   #agif0705#2 = 999999;
|FPRC;

|PROCESO EvtoGrid706;
   || aAlfa = "    Evento 706 [" + FSalida + "]"; |MENAV aAlfa;
   |SI FSalida = 1;  |O FSalida = 2;
      |LEE 000#agif0706.c;
      ||MENAV "     Eventuando 706";

      ||ESTADO_CONTROL nBotonBorP2a, "ENABLE";
      ||ESTADO_CONTROL nBotonModP2a, "ENABLE";
      |ESTADO_CONTROL nBotonBorP2b, "ENABLE";
      |ESTADO_CONTROL nBotonModP2b, "ENABLE";
   |FINSI;
|FPRC;

|PROCESO Inf706;
   #agif0706#0 = #agif0704#0;
   #agif0706#1 = #agif0705#2;
   #agif0706#2 = 0001;
|FPRC;

|PROCESO Sup706;
   #agif0706#0 = #agif0704#0;
   #agif0706#1 = #agif0705#2;
   #agif0706#2 = 9999;
|FPRC;

|PROCESO NuevoAsiento;
   #agif0705#0 = #agif0704#0;
   #agif0705#2 = 999999;
   |LEE 000#agif0705.];
   |SI FSalida = 0;
      |LEE 000#agif0705.a;
   |SINO;
      |LEE 000#agif0705.u;
   |FINSI;

   |SI FSalida = 0; |Y #agif0705#0 = #agif0704#0;
      nCalc = #agif0705#2 + 1;
   |SINO;
      nCalc = 1;
   |FINSI;

   |DDEFECTO #agifw705;
   #agifw705#0 = nCalc; |PINTA #agifw705#0;
|FPRC;

|PROCESO NuevaLinAsiento;
   #agif0706#0 = #agif0705#0;
   #agif0706#1 = #agif0705#2;
   #agif0706#2 = 9999;
   |LEE 000#agif0706.];
   |SI FSalida = 0;
      |LEE 000#agif0706.a;
   |SINO;
      |LEE 000#agif0706.u;
   |FINSI;

   |SI FSalida = 0; |Y #agif0706#0 = #agif0705#0; |Y #agif0706#1 = #agif0705#2;
      nCalc = #agif0706#2 + 1;
   |SINO;
      nCalc = 1;
   |FINSI;

   |DDEFECTO #agifw706;
   #agifw706#0 = nCalc; |PINTA #agifw706#0;
|FPRC;

|PROCESO EditaAsiento;
   |VENTANA 1227, 1774, nPant0, 17, aTitulo; nVentFlt = FSalida;
   aVent1 = -1;
   aVent2 = -1;
   aVent3 = 0;
   aVent4 = nVentFlt;
   aVent5 = "MODAL";
   |ESPECIFICA "ESTADO_VENTANA", aVent;

   |PINPA #0#agifw705; nPantFlt = FSalida;
   |PINDA #0#agifw705;

   |ENDATOS #1#agifw705;
   |SI FSalida = 0;
      |SI nSwModo = 1;
         |DDEFECTO #agif0705;
         #agif0705#0 = #agif0704#0;
         #agif0705#2 = #agifw705#0;
         |GRABA 020#agif0705.b;
      |FINSI;
      #agif0705#3 = #agifw705#1;
      #agif0705#4 = #agifw705#2;
      #agif0705#5 = #agifw705#3;
      |GRABA 020#agif0705.a;
   |FINSI;

   aVent4 = nVentFlt;
   aVent5 = "MODELESS";
   |ESPECIFICA "ESTADO_VENTANA", aVent;
   |FINVENTANA nVentFlt;
|FPRC;

|PROCESO BotonNuevoP2a;
   aTitulo = "Nuevo asiento enlace [" + #agif0704#0 + "] " + #agif0704#1; |QBF aTitulo;
   |HAZ NuevoAsiento;
   nSwModo = 1; |HAZ EditaAsiento;
   |LIBERA #agif0705;

   |REFRESCACONTROL nGridP2a;
|FPRC;

|PROCESO BotonModifP2a;
   aTitulo = "Modificar asiento enlace [" + #agif0704#0 + "] " + #agif0704#1; |QBF aTitulo;

   #agifw705#0 = #agif0705#2;
   #agifw705#1 = #agif0705#3;
   #agifw705#2 = #agif0705#4;
   #agifw705#3 = #agif0705#5;
   |HAZ MiraDiario;

   |LEE 101#agif0705.=;
   nSwModo = 2; |HAZ EditaAsiento;
   |LIBERA #agif0705;

   |REFRESCACONTROL nGridP2a;
|FPRC;

|PROCESO Borra706;
   |BORRA 020#agif0706.a;
|FPRC;

|DEFBUCLE Borra706;
#agif0706#1;
;
#agif0705#0, #agif0705#2, 0001;
#agif0705#0, #agif0705#2, 9999;
be;
NULL, Borra706;
|FIN;

|PROCESO BotonBorraP2a;
   aAlfa = "    N" + &191 + " Esta seguro de eliminar este asiento ?";
   |CONFI aAlfa;
   |SI FSalida = 0;
      |BUCLE Borra706;
      |ESTADO_CONTROL nBotonModP2b, "DISABLE";
      |ESTADO_CONTROL nBotonBorP2b, "DISABLE";

      |BORRA 020#agif0705.a;

      |LEE 000#agif0705.c;
      |SI FSalida ! 0;
         |ESTADO_CONTROL nBotonModP2a, "DISABLE";
         |ESTADO_CONTROL nBotonBorP2a, "DISABLE";
      |FINSI;
      |REFRESCACONTROL nGrid1;
   |FINSI;
|FPRC;

|PROCESO SelecCampos;
/*
   |REFERENCIA_DEF get1, #agifw706;
   get2 = 0;
   Iget = get1<-;
   |ESPECIFICA "GETDATACONTROL",get;
   #agifw706#nCampoSel# = FSalida;
*/
   eaResultado = #agifw706#nCampoSel#;

   aAlfa = "agif0708.tab;" + #agif0706#0 + (("000000" + #agif0706#1) % -106) + (("0000" + #agif0706#2) % -104);
   |SI nCampoSel = 1; aAlfa = aAlfa + "C"; |FINSI;
   |SI nCampoSel = 4; aAlfa = aAlfa + "D"; |FINSI;
   |SI nCampoSel = 6; aAlfa = aAlfa + "I"; |FINSI;

   |SI nCampoSel = 1; |O nCampoSel = 4; |O nCampoSel = 6;
      |SUB_EJECUTA aAlfa;
      #agifw706#nCampoSel# = eaResultado; |PINTA #agifw706#nCampoSel#;
   |FINSI;
|FPRC;

|PROCESO EditaLinAsiento;
   |VENTANA 0812, 2388, nPant0, 17, aTitulo; nVentFlt = FSalida;
   aVent1 = -1;
   aVent2 = -1;
   aVent3 = 0;
   aVent4 = nVentFlt;
   aVent5 = "MODAL";
   |ESPECIFICA "ESTADO_VENTANA", aVent;

   |PINPA #0#agifw706; nPantFlt = FSalida;
   |PINDA #0#agifw706;

   |CONTROL_SIMPLE nPantFlt, "BOTON,{{197}}Seleccion campos", 1060, 1075, SelecCampos;
   nBotonSelCmp = FSalida;

   |ENDATOS #1#agifw706;
   |SI FSalida = 0;
      |SI nSwModo = 1;
         |DDEFECTO #agif0706;
         #agif0706#0 = #agif0704#0;
         #agif0706#1 = #agifw705#0;
         #agif0706#2 = #agifw706#0;
         |GRABA 020#agif0706.b;
      |FINSI;
      #agif0706#3  = #agifw706#1;
      #agif0706#4  = #agifw706#2;
      #agif0706#5  = #agifw706#3;
      #agif0706#6  = #agifw706#4;
      #agif0706#7  = #agifw706#5;
      #agif0706#8  = #agifw706#6;
      #agif0706#9  = #agifw706#7;
      #agif0706#10 = #agifw706#8;
      #agif0706#11 = #agifw706#9;
      #agif0706#12 = #agifw706#10;
      #agif0706#13 = #agifw706#11;
      #agif0706#14 = #agifw706#12;
      |GRABA 020#agif0706.a;
   |FINSI;

   |FIN_CONTROL_WINDOWS nBotonSelCmp;

   aVent4 = nVentFlt;
   aVent5 = "MODELESS";
   |ESPECIFICA "ESTADO_VENTANA", aVent;
   |FINVENTANA nVentFlt;
|FPRC;

|PROCESO BotonNuevoP2b;
   aTitulo = "Nueva linea del asiento [" + #agif0705#2 + "] del enlace [" + #agif0704#0 + "] " + #agif0704#1; |QBF aTitulo;
   |HAZ NuevaLinAsiento;
   nSwModo = 1; |HAZ EditaLinAsiento;
   |LIBERA #agif0706;

   |REFRESCACONTROL nGridP2b;
|FPRC;

|PROCESO BotonModifP2b;
   aTitulo = "Modificar linea del asiento [" + #agif0705#2 + "] del enlace [" + #agif0704#0 + "] " + #agif0704#1; |QBF aTitulo;

   #agifw706#0  =  #agif0706#2;
   #agifw706#1  =  #agif0706#3;
   #agifw706#2  =  #agif0706#4;
   #agifw706#3  =  #agif0706#5;
   #agifw706#4  =  #agif0706#6;
   #agifw706#5  =  #agif0706#7;
   #agifw706#6  =  #agif0706#8;
   #agifw706#7  =  #agif0706#9;
   #agifw706#8  =  #agif0706#10;
   #agifw706#9  =  #agif0706#11;
   #agifw706#10 =  #agif0706#12;
   #agifw706#11 =  #agif0706#13;
   #agifw706#12 =  #agif0706#14;

   |LEE 101#agif0706.=;
   nSwModo = 2; |HAZ EditaLinAsiento;
   |LIBERA #agif0706;

   |REFRESCACONTROL nGridP2b;
|FPRC;

|PROCESO BotonBorraP2b;
   aAlfa = "    N" + &191 + " Esta seguro de eliminar esta linea del asiento ?";
   |CONFI aAlfa;
   |SI FSalida = 0;
      |BORRA 020#agif0706.a;

      |LEE 000#agif0706.c;
      |SI FSalida ! 0;
         |ESTADO_CONTROL nBotonModP2b, "DISABLE";
         |ESTADO_CONTROL nBotonBorP2b, "DISABLE";
      |FINSI;
      |REFRESCACONTROL nGridP2b;
   |FINSI;
|FPRC;

|PROCESO PintaDatos2;
   |SI nBotonBorP2a < 0;
      nPos1 = 1149; nPos2 = 1159;
      |CONTROL_SIMPLE nPant1, "BOTON,{{199}}Borrar", nPos1, nPos2, BotonBorraP2a;
      nBotonBorP2a = FSalida;
   |FINSI;
   |ESTADO_CONTROL nBotonBorP2a, "DISABLE";

   |SI nBotonModP2a < 0;
      nPos1 = 1137; nPos2 = 1147;
      |CONTROL_SIMPLE nPant1, "BOTON,{{135}}Modificar", nPos1, nPos2, BotonModifP2a;
      nBotonModP2a = FSalida;
   |FINSI;
   |ESTADO_CONTROL nBotonModP2a, "DISABLE";

   |SI nBotonNueP2a < 0;
      nPos1 = 1125; nPos2 = 1135;
      |CONTROL_SIMPLE nPant1, "BOTON,{{137}}Nuevo", nPos1, nPos2, BotonNuevoP2a;
      nBotonNueP2a = FSalida;
   |FINSI;
   |SI nSwSinLin = 1; |ESTADO_CONTROL nBotonNueP2a, "DISABLE"; |FINSI;

   |SI nGridP2a < 0;
      nRango = 4 + 8 + 16 + 32;
      nPos1 = 0502; nPos2 = 1071;
      |LINEAL_SIMPLE #1#agif0705, nRango, nPos1, nPos2, Inf705, Sup705, EvtoGrid705;
      nGridP2a = FSalida;
   |SINO;
      ||MENAV "    Aqui deberia saltar el evento del 705";
      |REFRESCACONTROL nGridP2a;
   |FINSI;

   |SI nBotonBorP2b < 0;
      nPos1 = 1849; nPos2 = 1859;
      |CONTROL_SIMPLE nPant1, "BOTON,{{199}}Borrar", nPos1, nPos2, BotonBorraP2b;
      nBotonBorP2b = FSalida;
   |FINSI;
   |ESTADO_CONTROL nBotonBorP2b, "DISABLE";

   |SI nBotonModP2b < 0;
      nPos1 = 1837; nPos2 = 1847;
      |CONTROL_SIMPLE nPant1, "BOTON,{{135}}Modificar", nPos1, nPos2, BotonModifP2b;
      nBotonModP2b = FSalida;
   |FINSI;
   |ESTADO_CONTROL nBotonModP2b, "DISABLE";

   |SI nBotonNueP2b < 0;
      nPos1 = 1825; nPos2 = 1835;
      |CONTROL_SIMPLE nPant1, "BOTON,{{137}}Nuevo", nPos1, nPos2, BotonNuevoP2b;
      nBotonNueP2b = FSalida;
   |FINSI;
   |SI nSwSinLin = 1; |ESTADO_CONTROL nBotonNueP2b, "DISABLE"; |FINSI;

   |SI nGridP2b < 0;
      nPos1 = 1302; nPos2 = 1771;
      |LINEAL_SIMPLE #1#agif0706, nRango, nPos1, nPos2, Inf706, Sup706, EvtoGrid706;
      nGridP2b = FSalida;
      |PULSATECLA;
   |SINO;
      ||MENAV "    Aqui deberia saltar el evento del 706";
      |REFRESCACONTROL nGridP2b;
   |FINSI;
|FPRC;

|PROCESO Pantalla2;
   nNumPant = 2;

   |HAZ PantallaBase;
   |PINPA #0#agif704b; nPant1 = FSalida;
   |HAZ PintaDatos2; |PINDA #0#agif704b;

   nPos1 = 1861; nPos2 = 1871;
   |CONTROL_SIMPLE nPant1, "BOTON,{{001}}Salir", nPos1, nPos2, BotonSalir;
   nBotonSalir = FSalida;
   |PTEC 802; |PAUSA;

   |SI nSwEntPant = 5; |ACABA; |FINSI;
|FPRC;

|PROCESO PintaDatos1;
   #agif704a#15 = "";
   aAlfa = #agif0704#6; |QBF aAlfa;
   aAlfa1 = aAlfa % -101;
   |SI aAlfa1 ! "/"; |Y aAlfa1 ! "\";
      aAlfa = aAlfa + "/";
   |FINSI;
   aAlfa1 = aAlfa + "def/canempre.mas";
   |CARGA_DEF aAlfa1, Referen@;
   |SI FSalida = 0;
      aAlfa1 = aAlfa + "fich/"; |PATH_DAT #Referen@#aAlfa1#;
      |ABRE #Referen@;
      #Referen@#2 = #agif0704#4;
      #Referen@#3 = #agif0704#5;
      |LEE 000#Referen@.=;
      |SI FSalida = 0;
         #agif704a#15 = #Referen@#1;
      |FINSI;
      |CIERRA #Referen@; |DESCARGA_DEF #Referen@;
   |FINSI;

   #agif704a#0 = #agif0704#1; |PINTA #agif704a#0;
   #agif704a#1 = #agif0704#2; |PINTA #agif704a#1;
   #agif704a#2 = #agif0704#3; |PINTA #agif704a#2;
   #agif704a#3 = #agif0704#6; |PINTA #agif704a#3;
   #agif704a#4 = #agif0704#4; |PINTA #agif704a#4;
   #agif704a#5 = #agif0704#5; |PINTA #agif704a#5;
   #agif704a#7 = #agif0704#7; |PINTA #agif704a#7;
   #agif704a#8 = #agif0704#8; |PINTA #agif704a#8;
   #agif704a#9 = #agif0704#14; |PINTA #agif704a#9;
   #agif704a#10 = #agif0704#15; |PINTA #agif704a#10;
   #agif704a#11 = #agif0704#19; |PINTA #agif704a#11;
   #agif704a#12 = #agif0704#20; |PINTA #agif704a#12;
   #agif704a#13 = #agif0704#18; |PINTA #agif704a#13;
   |SI #agif704a#13 = "A"; #agif704a#14 = "Formato automatico";      |FINSI;
   |SI #agif704a#13 = "B"; #agif704a#14 = "Formato manual ";         |FINSI;
   |SI #agif704a#13 = "C"; #agif704a#14 = "Formato manual contable"; |FINSI;
   |PINTA #agif704a#14;
   |PINTA #agif704a#15;
|FPRC;

|PROCESO Pantalla1;
   nNumPant = 1;

   |HAZ PantallaBase;
   |PINPA #0#agif704a; nPant1 = FSalida;
   |HAZ PintaDatos1; |PINDA #0#agif704a;

   nPos1 = 1861; nPos2 = 1871;
   |CONTROL_SIMPLE nPant1, "BOTON,{{001}}Salir", nPos1, nPos2, BotonSalir;
   nBotonSalir = FSalida;
   |PTEC 802; |PAUSA;

   |SI nSwEntPant = 4; |ACABA; |FINSI;
|FPRC;

|PROCESO EvtoTree1;
   aAlfa = Contenido; |QBF aAlfa; aAlfa1 = aAlfa;
   aAlfa1 = aAlfa1 - ":";
   nCalc = FSalida; nCalc = FSalida + 98; aAlfa = aAlfa1 % nCalc;

   |SI aAlfa ! aAntCont;
      aAntCont = aAlfa;
      |SI aAlfa = "DATOS_GENERALES";   nSwEntPant = 4; |HAZ Pantalla1; |FINSI;
      |SI aAlfa = "ASIENTOS";          nSwEntPant = 5; |HAZ Pantalla2; |FINSI;
      |SI aAlfa = "ACOTACIONES";       nSwEntPant = 6; |HAZ Pantalla3; |FINSI;
      |SI aAlfa = "CAMPOS_ENLAZABLES"; nSwEntPant = 7; |HAZ Pantalla4; |FINSI;
      |SI aAlfa = "MEMORIAS";          nSwEntPant = 8; |HAZ Pantalla5; |FINSI;
   |FINSI;
|FPRC;

|PROCESO EvtoGrid1;
   |SI FSalida = 1; |O FSalida = 2;
      |HAZ QuitaBotonSalir;

      |LEE 000#agif0704.c;
      nSwSinLin  = 0;
      |ESTADO_CONTROL nBotonMod, "ENABLE";
      |ESTADO_CONTROL nBotonBor, "ENABLE";
      |ESTADO_CONTROL nBotonComprueba, "ENABLE";
      |ESTADO_CONTROL nBotonCopia, "ENABLE";

      |SI nNumPant = 1; |HAZ PintaDatos1; |FINSI;
      |SI nNumPant = 2; |HAZ PintaDatos2; |FINSI;
      |SI nNumPant = 3; |HAZ PintaDatos3; |FINSI;
      |SI nNumPant = 4; |HAZ PintaDatos4; |FINSI;
      |SI nNumPant = 5; |HAZ PintaDatos5; |FINSI;
   |FINSI;
|FPRC;

|PROCESO TamanyoPantalla; |TIPO 80;
   FSalida = 3199;
|FPRC;

|PROCESO MontaArbol;
   aAlfa = aUnidad + "documentos/tmp/";
   |SI aIP ! "";
      |RMKDIR aAlfa;
   |SINO;
      |MKDIR aAlfa;
   |FINSI;

   aAlfa = aAlfa + "tree" + Usuario + ".txt";
   |XABRE "CW", aAlfa, nHandle;
   |SI FSalida ] 0;
      |XGRABA nHandle, "1:Datos generales {{DATOS_GENERALES}}";
      |XGRABA nHandle, "2:Asientos {{ASIENTOS}}";
      |XGRABA nHandle, "3:Acotaciones {{ACOTACIONES}}";
      |XGRABA nHandle, "4:Campos enlazables {{CAMPOS_ENLAZABLES}}";
      |XGRABA nHandle, "5:Memorias {{MEMORIAS}}";
      |XCIERRA nHandle;
   |FINSI;
|FPRC;

|PROCESO GrabaArbolRel;

   |DDEFECTO #agifw714;
   #agifw714#0 = 1;
   #agifw714#1 = aFichero;
   |GRABA 020#agifw714.n;

   aFichOrigen = ""; aCmpOrigen = "";
   |LEE 000#agifw714.p;
   |PARA; |SI FSalida = 0; |HACIENDO;
      |DDEF aAlfa3; |QBF aAlfa3;
      aAlfa3 = aAlfa3 + #agifw714#1 + ".mas";
      |CARGA_DEF aAlfa3, Refere1@;
      |SI FSalida = 0;
         aAlfa3 = "|NR"; aAlfa3 = #Refere1@#aAlfa3#; nNumRels = aAlfa3;
         |SI nNumRels > 0;
            aFichOrigen = #agifw714#1; aCmpOrigen  = aAlfa3;
         |FINSI;

         |PARA nContRel = 0; |SI nContRel < nNumRels; |HACIENDO nContRel = nContRel + 1;
            aAlfa3 = "|R" + (("000" + nContRel) % -103); aAlfa3 = #Refere1@#aAlfa3#;
            aAlfa5 = aAlfa3 - "|"; nCalc = ((FSalida / 100) ! 0) + 99;
            aAlfa5 = aAlfa3 % nCalc;

            |SALVA_FICHA #agifw714;
            |SELECT #2#agifw714;
            #agifw714#1 = aAlfa5;
            |LEE 000#agifw714.=;
            |SI FSalida ! 0;
               |SELECT #1#agifw714;
               |LEE 000#agifw714.u; nCalc = #agifw714#0 + 1;
               |DDEFECTO #agifw714;
               #agifw714#0 = nCalc;
               #agifw714#1 = aAlfa5;
               |GRABA 020#agifw714.n;
            |SINO;
               |SELECT #1#agifw714;
            |FINSI;
            |REPON_FICHA #agifw714;

            |DDEF aAlfa6; |QBF aAlfa6;
            aAlfa6 = aAlfa6 + aAlfa5 + ".mas";
            |CARGA_DEF aAlfa6, Refere2@;
            |SI FSalida = 0;
               aAlfa6 = "|K000"; aAlfa6 = #Refere2@#aAlfa6#;
               |DESCARGA_DEF #Refere2@;
            |SINO;
               aAlfa6 = "";
            |FINSI;

            #agifw796#0 = aFichOrigen;
            #agifw796#1 = aAlfa5;
            |LEE 000#agifw796.=;
            |SI FSalida ! 0;
               |DDEFECTO #agifw796;
               #agifw796#0 = aFichOrigen;
               #agifw796#1 = aAlfa5;
               aAlfa5 = aAlfa3 - "|";   nCalc = FSalida + 98;
               aAlfa5 = aAlfa5 % nCalc;
               #agifw796#2 = aAlfa5;
               #agifw796#3 = aAlfa6;
               |GRABA 020#agifw796.n;
            |FINSI;
         |SIGUE;

         |DESCARGA_DEF #Refere1@;
      |FINSI;
      |LEE 000#agifw714.s;
   |SIGUE;
|FPRC;

|PROCESO BuscaArbolRel;
   |DDEFECTO #agifw796;
   #agifw796#0 = aFichOrigen;
   |LEE 000#agifw796.];
   |PARA; |SI FSalida = 0; |Y #agifw796#0 = aFichOrigen; |HACIENDO;
      aAlfa5 = #agifw796#1; |QBF aAlfa5;
      |SI aAlfa5 = aFichDestino;
         || He encontrado el camino de la relacion, pero debo comprobar que
         ||   los campos existen. si no existiera alguno, en este caso si que
         ||   puedo dar un aviso certero de que es lo que falta.

         nSwCampos = 1;
         aAlfa4 = #agifw796#2; |QBF aAlfa4; aAlfa4 = aAlfa4 % 0499;
         |PARA; |SI aAlfa4 ! ""; |HACIENDO;
            aAlfa5 = aAlfa4 % 0103; aAlfa4 = aAlfa4 % 0499;
            nCalc1 = aAlfa5; nCalc1 = nCalc1 - 1;
            #agif0702#1 = #agifw796#0;
            #agif0702#2 = nCalc1;
            #agif0702#4 = #agif0704#2;
            |LEE 000#agif0702.=;
            |SI FSalida ! 0;
               aAviso = "    Falta el campo [" + #agifw796#0 + "][" + (("000" + nCalc1) % -103) + "] para completar la relacion";
               nSwCampos = -1; |SAL;
            |FINSI;
         |SIGUE;
         |SI nSwCampos = 1;
            aAlfa4 = #agifw796#3; |QBF aAlfa4; aAlfa4 = aAlfa4 % 0499;
            |SI #agifw796#1 ! aFichero;
               |PARA; |SI aAlfa4 ! ""; |HACIENDO;
                  aAlfa5 = aAlfa4 % 0103; aAlfa4 = aAlfa4 % 0499;
                  #agif0702#1 = #agifw796#1;
                  #agif0702#2 = aAlfa5;
                  #agif0702#4 = #agif0704#2;
                  |LEE 000#agif0702.=;
                  |SI FSalida ! 0;
                     aAviso = "    Falta el campo [" + #agifw796#1 + "][" + (("000" + aAlfa5) % -103) + "] para completar la relacion";
                     nSwCampos = -1; |SAL;
                  |FINSI;
               |SIGUE;
            |FINSI;
         |FINSI;
         nSwEncontrado = 1; |SAL;
      |SINO;
         || Miro si estan los campos. Si estan puedo seguir mirando. Si no, no
         || Miro los campos del fichero origen ...

         nSwCampos = 1;
         aAlfa4 = #agifw796#2; |QBF aAlfa4; aAlfa4 = aAlfa4 % 0499;
         |SI aFichOrigen ! aFichero;
            |PARA; |SI aAlfa4 ! ""; |HACIENDO;
               aAlfa5 = aAlfa4 % 0103; aAlfa4 = aAlfa4 % 0499;
               nCalc1 = aAlfa5; nCalc1 = nCalc1 - 1;
               #agif0702#1 = aFichOrigen;
               #agif0702#2 = nCalc1;
               #agif0702#4 = #agif0704#2;
               |LEE 000#agif0702.=;
               |SI FSalida ! 0;
                  nSwCampos = -1; |SAL;
               |FINSI;
            |SIGUE;
         |FINSI;

         || .... y luego los del fichero destino ....
         |SI nSwCampos = 1;
            aAlfa4 = #agifw796#3; |QBF aAlfa4; aAlfa4 = aAlfa4 % 0499;
            |SI #agifw796#1 ! aFichero;
               |PARA; |SI aAlfa4 ! ""; |HACIENDO;
                  aAlfa5 = aAlfa4 % 0103; aAlfa4 = aAlfa4 % 0499;
                  #agif0702#1 = #agifw796#1;
                  #agif0702#2 = aAlfa5;
                  #agif0702#4 = #agif0704#2;
                  |LEE 000#agif0702.=;
                  |SI FSalida ! 0;
                     nSwCampos = -1; |SAL;
                  |FINSI;
               |SIGUE;
            |FINSI;
         |FINSI;
         || Si est n todos, puedo revisarlo ...
         |SI nSwCampos = 1;
            |SELECT #2#agifw714;
            #agifw714#1 = #agifw796#1;
            |LEE 000#agifw714.=;
            |SI FSalida ! 0;
               |SELECT #1#agifw714;
               nCalc = 1;
               |LEE 000#agifw714.u;
               |SI FSalida = 0;
                  nCalc = #agifw714#0 + 1;
               |FINSI;

               |DDEFECTO #agifw714;
               #agifw714#0 = nCalc;
               #agifw714#1 = #agifw796#1;
               |GRABA 020#agifw714.n;
               |SALVA_FICHA #agifw796;
               aCaminoRel  = aCaminoRel + "-" + #agifw796#1; |QBF aCaminoRel;
               aFichOrigen = #agifw796#1; |HAZ BuscaArbolRel; aAlfa6 = #agifw796#1;
               |REPON_FICHA #agifw796;
               aFichOrigen = #agifw796#0;
               |SI nSwEncontrado = 0;
                  aAlfa6 = "-" + #agifw796#1; aCaminoRel = aCaminoRel - aAlfa6;
               |SINO;
                  aAlfa6 = "-" + aAlfa6; aCaminoRel = aCaminoRel + aAlfa6;
               |FINSI;
            |SINO;
               |SELECT #1#agifw714;
            |FINSI;
            |SI nSwEncontrado = 1; |SAL; |FINSI;
         |FINSI;
      |FINSI;
      |LEE 000#agifw796.s;
   |SIGUE;
|FPRC;

|PROCESO CompruebaCampo;
   |CIERRA #agifw714; |DELINDEX #agifw714; |ABRE #agifw714;

   aAlfa1 = aAlfa - "][";
   |PARA; |SI FSalida ! 0; |HACIENDO;
      nCalc = FSalida - 887;
      aAlfa1 = aAlfa % nCalc; aAlfa = aAlfa - aAlfa1;
      aFichDestino = aAlfa1 % 0208; aAlfa2 = aAlfa1 % 1203;
      |SI aFichDestino ! aFichero;
         aCaminoRel  = aFichero; aAviso = "";
         aFichOrigen = aFichero; nSwEncontrado = 0;
         nCmpDestino = aAlfa2; |HAZ BuscaArbolRel;
         |SI nSwEncontrado = 0;
            aAlfa5 = "    Imposible encontrar registro correspondiente al fichero [" + aFichDestino + "]";
            |SI nSwCapitulo = 1;
               aAlfa5 = aAlfa5 + " (Apartado asientos";
               |SI nSwCampo = 1; aAlfa5 = aAlfa5 + ", campo cuenta";      |FINSI;
               |SI nSwCampo = 2; aAlfa5 = aAlfa5 + ", campo descripcion"; |FINSI;
               |SI nSwCampo = 3; aAlfa5 = aAlfa5 + ", campo importe";     |FINSI;
               aAlfa5 = aAlfa5 + aSwComent + ")";
            |FINSI;
            |SI nSwCapitulo = 2; aAlfa5 = aAlfa5 + " (Apartado memorias, memoria " + aSwMemoria; |FINSI;
            |MENAV aAlfa5;
            nSwErr = nSwErr + 1;
         |SINO;
            |SI aAviso ! "";
               |SI nSwCapitulo = 1;
                  aAviso = aAviso + " (Apartado asientos";
                  |SI nSwCampo = 1; aAviso = aAviso + ", campo cuenta";      |FINSI;
                  |SI nSwCampo = 2; aAviso = aAviso + ", campo descripcion"; |FINSI;
                  |SI nSwCampo = 3; aAviso = aAviso + ", campo importe";     |FINSI;
                  aAviso = aAviso + aSwComent + ")";
               |FINSI;
               |SI nSwCapitulo = 2;
                  aAviso = aAviso + " (Apartado memorias, memoria " + aSwMemoria + ")";
               |FINSI;
               aAviso = "    " + aAviso; |MENAV aAviso;
               nSwErr = nSwErr + 1;
            |FINSI;
         |FINSI;
      |FINSI;
      aAlfa1 = aAlfa - "][";
   |SIGUE;
|FPRC;

|PROCESO CopiaFichero;
   nCmpClv = 0;
   |SI aFichero = "agif0707"; nCmpClv = 15; |FINSI;

   |DDEF aAlfa; |QBF aAlfa;
   aAlfa = aAlfa + aFichero + ".mas";
   |CARGA_DEF aAlfa, Referen@;
   |SI FSalida = 0;
      |ABRE #Referen@;
      |DDEFECTO #Referen@;
      |SI aFichero = "agif0706"; #Referen@#2 = 1; |FINSI;
      #Referen@#nCmpClv# = aEnlaceOrg;
      |LEE 000#Referen@.];
      |PARA; |SI FSalida = 0; |Y #Referen@#nCmpClv# = aEnlaceOrg; |HACIENDO;
         |SALVA_FICHA #Referen@;
         #Referen@#nCmpClv# = aEnlaceDst;
         |GRABA 020#Referen@.n;
         |REPON_FICHA #Referen@;

         |LEE 000#Referen@.s;
      |SIGUE;
      |DESCARGA_DEF #Referen@;
   |FINSI;
|FPRC;

|PROCESO CopiaEnlace;
   aAlfa = "Copiar enlace [" + #agif0704#0 + "] " + #agif0704#1; |QBF aAlfa;
   aEnlaceOrg = #agif0704#0; aEnlaceDst = "";

   |VENTANA 1416, 1783, nPant0, 17, aAlfa; nVentFlt = FSalida;
   aVent1 = -1;
   aVent2 = -1;
   aVent3 = 0;
   aVent4 = nVentFlt;
   aVent5 = "MODAL";
   |ESPECIFICA "ESTADO_VENTANA", aVent;

   |PINPA #0#agifw794; nPantFlt = FSalida;
   |PINDA #0#agifw794;

   |ENDATOS #1#agifw794;
   |SI FSalida = 0;
      aEnlaceDst = #agifw794#0;

      #agif0704#0 = #agifw794#0;
      #agif0704#1 = #agifw794#1;
      |GRABA 020#agif0704.b;

      aFichero = "agif0705"; |HAZ CopiaFichero;
      aFichero = "agif0706"; |HAZ CopiaFichero;
      aFichero = "agif0707"; |HAZ CopiaFichero;
      aFichero = "agif0717"; |HAZ CopiaFichero;
      aFichero = "agif0718"; |HAZ CopiaFichero;
      |LIBERA #agif0704;

      |REFRESCACONTROL nGrid1;
   |FINSI;

   aVent4 = nVentFlt;
   aVent5 = "MODELESS";
   |ESPECIFICA "ESTADO_VENTANA", aVent;
   |FINVENTANA nVentFlt;
|FPRC;

|PROCESO CompruebaEnlace;
   || Primero hay que determinar cual es el fichero del que se har  la
   ||    consulta y posteriormente el bucle
   aFichero = "";
   |SI #agif0704#2 = "FV";
      |SI #agif0704#8 = "S";
         aFichero = "agifa071";
      |SINO;
         aFichero = "agifa134";
      |FINSI;
   |FINSI;
   |SI #agif0704#2 = "FC";
      |SI #agif0704#8 = "S";
         aFichero = "agifa080";
      |SINO;
         aFichero = "agifa079";
      |FINSI;
   |FINSI;
   |SI #agif0704#2 = "FD";
      |SI #agif0704#8 = "S";
         aFichero = "agifa069";
      |SINO;
         aFichero = "agifa084";
      |FINSI;
   |FINSI;
   |SI #agif0704#2 = "TI";
      |SI #agif0704#8 = "S";
         aFichero = "agifa502";
      |SINO;
         aFichero = "agifa501";
      |FINSI;
   |FINSI;
   |SI #agif0704#2 = "CC"; aFichero = "agifa509"; |FINSI;
   |SI #agif0704#2 = "CR";
      |SI #agif0704#8 = "S";
         aFichero = "agifa572";
      |SINO;
         aFichero = "agifa571";
      |FINSI;
   |FINSI;

   aAlfa3 = "796" + Usuario; |NOME_DAT #agifw796#aAlfa3#;
   aAlfa3 = "714" + Usuario; |NOME_DAT #agifw714#aAlfa3#;
   |DELINDEX #agifw796; |ABRE #agifw796;
   |DELINDEX #agifw714; |ABRE #agifw714;
   || Me creo un fichero de apoyo con el arbol de relaciones del fichero
   ||    principal
   |HAZ GrabaArbolRel;

   nSwErr = 0;
   || Voy comprobando campos indicados en los ficheros de configuracion del
   ||    enlace.

   nSwCapitulo = 1;
   || Comenzamos por los campos de las lineas de los asientos ...
   #agif0706#0 = #agif0704#0;
   #agif0706#1 = 1;
   #agif0706#2 = 1;
   |LEE 000#agif0706.];
   |PARA; |SI FSalida = 0; |Y #agif0706#0 = #agif0704#0; |HACIENDO;
      aSwComent = ", asiento n§ " + #agif0706#1 + ", apunte n§ " + #agif0706#2;
      || Compruebo la cuenta ...
      nSwCampo = 1;
      aAlfa = #agif0706#3; |QBF aAlfa; |HAZ CompruebaCampo;
      |SI nSwErr ! 0; |SAL; |FINSI;

      || Compruebo la descripcion ...
      nSwCampo = 2;
      aAlfa = #agif0706#6; |QBF aAlfa; |HAZ CompruebaCampo;
      |SI nSwErr ! 0; |SAL; |FINSI;

      || Compruebo el campo importe ...
      nSwCampo = 3;
      aAlfa = #agif0706#8; |QBF aAlfa; |HAZ CompruebaCampo;
      |SI nSwErr ! 0; |SAL; |FINSI;

      |LEE 000#agif0706.s;
   |SIGUE;

   nSwCapitulo = 2;
   || Seguimos por los campos de las memorias ...
   #agif0718#0 = #agif0704#0;
   #agif0718#1 = "               ";
   #agif0718#2 = 1;
   |LEE 000#agif0718.];
   |PARA; |SI FSalida = 0; |Y #agif0718#0 = #agif0704#0; |HACIENDO;
      aSwMemoria = #agif0718#1; |QBF aSwMemoria;
      aAlfa = #agif0718#3; |QBF aAlfa; |HAZ CompruebaCampo;

      |LEE 000#agif0718.s;
   |SIGUE;

   |SI nSwErr = 0;
      |MENAV "    Enlace comprobado satisfactoriamente";
   |FINSI;

   |CIERRA #agifw714; |DELINDEX #agifw714;
   |CIERRA #agifw796; |DELINDEX #agifw796;
|FPRC;

|PROGRAMA;
   |CLS;
   |CABEZA "Definicion de enlaces contables";
   |PINPA #0#0; nPant0 = FSalida;

   aContiene = "";
   |ESPECIFICA "RBASS", aContiene;
   aBaseRemoto = aContiene1;

   aIP = ""; |IP_REMOTO aIP; |QBF aIP;

   aAlfa = aBaseRemoto; |QBF aAlfa; aUnidad = ""; aAlfa1 = "";
   |PARA; |SI aAlfa ! ""; |Y aAlfa1 ! "/"; |Y aAlfa1 ! "\"; |HACIENDO;
      aAlfa1 = aAlfa % 0101; aAlfa = aAlfa % 0299;
      aUnidad = aUnidad + aAlfa1;
   |SIGUE;

   |ABRE #agif0702; |SELECT #3#agif0702;
   |ABRE #agif0704; |ABRE #agif0705; |ABRE #agif0706;
   |ABRE #agif0707; |ABRE #agif0717; |ABRE #agif0718;

   aAlfa = "tc1" + Usuario; |NOME_DAT #agifw702#aAlfa#;
   aAlfa = "tc2" + Usuario; |NOME_DAT #agifw703#aAlfa#;
   |DELINDEX #agifw702; |DELINDEX #agifw703;
   |ABRE #agifw702; |ABRE #agifw703;

   nPos1 = 1463; nPos2 = 1473;
   |CONTROL_SIMPLE nPant0, "BOTON,{{137}}Nuevo", nPos1, nPos2, NuevoEnlace;
   nBotonNue = FSalida;

   nPos1 = 1475; nPos2 = 1485;
   |CONTROL_SIMPLE nPant0, "BOTON,{{135}}Modificar", nPos1, nPos2, ModifEnlace;
   nBotonMod = FSalida; |ESTADO_CONTROL nBotonMod, "DISABLE";

   nPos1 = 1487; nPos2 = 1497;
   |CONTROL_SIMPLE nPant0, "BOTON,{{199}}Borrar", nPos1, nPos2, BorraEnlace;
   nBotonBor = FSalida; |ESTADO_CONTROL nBotonBor, "DISABLE";

   nPos1 = 1403; nPos2 = 1423;
   |CONTROL_SIMPLE nPant0, "BOTON,{{197}}Comprueba enlace", nPos1, nPos2, CompruebaEnlace;
   nBotonComprueba = FSalida; |ESTADO_CONTROL nBotonComprueba, "DISABLE";

   nPos1 = 1425; nPos2 = 1445;
   |CONTROL_SIMPLE nPant0, "BOTON,{{156}}Copia enlace", nPos1, nPos2, CopiaEnlace;
   nBotonCopia = FSalida; |ESTADO_CONTROL nBotonCopia, "DISABLE";
   nSwSinLin  = 1;

   nRango = 4 + 8 + 16 + 32;
   nPos1 = 0803; nPos2 = 1397;
   |LINEAL_SIMPLE #1#agif0704, nRango, nPos1, nPos2, NULL, NULL, EvtoGrid1;
   nGrid1 = FSalida; |PULSATECLA;

   |HAZ MontaArbol;

   aAlfa = aUnidad + "documentos/tmp/";
   aAlfa = aAlfa + "tree" + Usuario + ".txt";
   aAlfa = "TREECTRL, Detalle enlace {{" + aAlfa + "}}";
   nPos1 = 1703; nPos2 = 3024;
   |CONTROL_SIMPLE nPant0, aAlfa, nPos1, nPos2, EvtoTree1;
   nTree1 = FSalida;

   sT_nID   = nTree1; || Selecciono la primera rama
   sT_nOper = 2;
   sT_aData = "1:";
   |ESPECIFICA "COMMANDCONTROL", sTree;

   nNumPant = 1;

   aEsc1  = &255 + "806";
   aEsc2  = &255 + "807";
   aRetu  = &255 + "802";
   |PARA; |SI;  |HACIENDO;
      FSalida = "::{{001}}Salir,"+nGrid1;
      |LEETECLA aTecla;
      |SI aTecla = aEsc1; |SAL; |FINSI;
      |SI aTecla = aEsc2; |SAL; |FINSI;
      |SI aTecla = aRetu; |SAL; |FINSI;
   |SIGUE;

   |SI nVent1 ! 0; |FINVENTANA nVent1; nVent1 = 0; |FINSI;

   |SI nBotonNue ! 0; |FIN_CONTROL_WINDOWS nBotonNue; |FINSI;
   |SI nBotonMod ! 0; |FIN_CONTROL_WINDOWS nBotonMod; |FINSI;
   |SI nBotonBor ! 0; |FIN_CONTROL_WINDOWS nBotonBor; |FINSI;
   |FIN_CONTROL_WINDOWS nBotonSalir;
   |FIN_CONTROL_WINDOWS nLabel1;
   |DESTRUYECONTROL nGrid1;
   |FIN_CONTROL_WINDOWS nTree1;
   |SI nVent1 ! 0; |FINVENTANA nVent1; nVent1 = 0; |FINSI;

   |CIERRA #agifw702; |CIERRA #agifw703;
   |DELINDEX #agifw702; |DELINDEX #agifw703;

   |CIERRA #agif0707; |CIERRA #agif0717; |CIERRA #agif0718;
   |CIERRA #agif0704; |CIERRA #agif0705; |CIERRA #agif0706;
   |CIERRA #agif0702;
|FPRO;
