|FICHEROS;
     champ001 #0;
     agifm001 #1;
     agifm002 #2;
     dsm00003 #3;
     champ006 #6;
     agifa134 #134;
     agifa059 #59;
     agifa010 #10;
     agifa071 #71;
     champ002 #19,MANTE;
     agifa024 #24;
     agifa071 #71;
     agif0041 #41;
     agifa133 #133;
     agifa019 #119;
|FIN;

|VARIABLES;
     aIP = "";
     nError = 0;
     aDes = "";
     aOrg = "";
     &enTiva = 0;
     &efFiva = @;
     &eaDiva = "";
     &enIva = 0;
     &enRec = 0;
     nAbo = 0;
     nDto = 0;
     nLinDto = 0;
     nLinFac = 0;
     nTotVerde = 0;
     nPrecio = 0;
     &EURODB = 0;
     EURODB2 = 0;
     nBaseDto = 0;
  {10}calif = "";
  {10}secue = 0;
  {10}tipo = "";
  {10}porce = 0;
  {10}impo = 0;
     nTotalReg = 0;
     aFinReg = "";
     nSumBruto = 0;
     nSumNeto = 0;
     nVto = 0;
     aRuta = "";
     nBoton1 = 0;
     nHandle = 0;
     nHandle1 = 0;
     nHandle2 = 0;
     nHandle3 = 0;
     aFic = "";
     aAlfa = "";
     nFacturas = 0;
     nUna = 0;
     aDexp = "";
     aHexp = "";

 {10}a         = 0;
 {10}b         = 0;
 {10}c         = 0;
 {10}d         = "";
     aVto      = "";

     aTipo     = "";
     nPos      = 0;
     nLon      = 0;
     nNume     = 0;
     nAbono    = 0;
     nNu1      = 0;
     nNu2      = 0;
     nDec      = 0;
     aAlf1     = "";

     aCadena = "";
     aLen = "";
     nLen = 0;
     nPosi = 0;
     aCaracter = "";
     nCampo = 0;
|FIN;

|PROCESO QuitaRaros;
     |QBF aAlfa;
     aCadena = "";
     aLen    = aAlfa % 0;
     nLen    = aLen;
     |PARA nCampo = 1;  |SI nCampo [ nLen;  |HACIENDO nCampo = nCampo + 1;
           nPosi = (100 * nCampo) + 1;
           aCaracter = aAlfa % nPosi;
           |SI aCaracter = "¥";  aCaracter = &209; |FINSI;
           |SI aCaracter = "¤";  aCaracter = &241; |FINSI;
           |SI aCaracter = " ";  aCaracter = &225; |FINSI;
           |SI aCaracter = "‚";  aCaracter = &233; |FINSI;
           |SI aCaracter = "¡";  aCaracter = &237; |FINSI;
           |SI aCaracter = "¢";  aCaracter = &243; |FINSI;
           |SI aCaracter = "£";  aCaracter = &250; |FINSI;
           |SI aCaracter = "§";  aCaracter = &176; |FINSI;
           |SI aCaracter = "¦";  aCaracter = &170; |FINSI;
           aCadena = aCadena + aCaracter;
     |SIGUE;
     aAlfa = aCadena;
|FPRC;

|PROCESO Relleno;
     |SI aTipo = "F";
          |SI aAlfa ! "";
               aAlfa = (aAlfa % -104) + (aAlfa % 402) + (aAlfa % 102);
          |FINSI;
          aAlf1 = " " * nLon;
          aAlfa = aAlfa + aAlf1;
          nPos = nLon + 100;
          aAlfa = aAlfa % nPos;
     |FINSI;

     |SI aTipo = "A";
          |HAZ QuitaRaros;
          aAlf1 = " " * nLon;
          aAlfa = aAlfa + aAlf1;
          nPos = nLon + 100;
          aAlfa = aAlfa % nPos;
     |FINSI;

     |SI aTipo = "N";
          nNume = aAlfa;
          |SI nNume < 0; nAbono = -1; |SINO; nAbono = 1; |FINSI;
          |SI nNume < 0; nNume = nNume * - 1; |FINSI;
          nNu1 = nNume ! 0;
          |SI nNu1 > nNume; nNu1 = nNu1 - 1; |FINSI;
          nNu2 = nNume - nNu1;
          |SI nDec < 0;
               aAlfa = nNume;
          |SINO;
               |SI nDec = 0;
                    aAlfa = nNu1;
               |SINO;
                    aAlfa = nNu2;
                    aAlfa = aAlfa + "00000000000000000000000000";
                    nPos = nDec + 300;
                    aAlfa = aAlfa % nPos;
                    aAlfa = nNu1 + "." + aAlfa;
               |FINSI;
          |FINSI;
          aAlfa = "000000000000000000000000000000000000000000000" + aAlfa;
          |SI nAbono = 1;
               nPos = -1 * (nLon + 100);
               aAlfa = aAlfa % nPos;
          |SINO;
               nPos = -1 * (nLon + 99);
               aAlfa = "-" + aAlfa % nPos;
          |FINSI;
          nDec = 0;
     |FINSI;
     |XGRABA nHandle, aAlfa;

     nTotalReg = nTotalReg + nLon;
     aAlfa = aAlfa % A0;
     |SI aAlfa ! nLon;
          |MENAV "0000ERROR. Longitud formateo";
     |FINSI;
|FPRC;


|PROCESO DtoFac;
     |SI #134#31 < 0; nAbo = -1; |SINO; nAbo = 1; |FINSI;

     nLinDto = nLinDto + 1;
||1
     aAlfa = #134#49; |QBF aAlfa;
     aAlfa = aAlfa + "/" + (("000000" + #134#0) % -106);
     aTipo = "A"; nLon = 15; |HAZ Relleno;
||2
     aAlfa = "A  ";
     aTipo = "A"; nLon = 3; |HAZ Relleno;
||3
     aAlfa = nLinDto;
     aTipo = "N"; nLon = 2; |HAZ Relleno;
||4
     aAlfa = "TD ";
     aTipo = "A"; nLon = 3; |HAZ Relleno;
||5
     aAlfa = nDto;
     aTipo = "N"; nDec = 3; nLon = 8; |HAZ Relleno;
||6
||     nNume = ((nPrecio % nDto) * nAbo) ! 2;
||     aAlfa = nNume;
     aAlfa = #134#17;
     aTipo = "N"; nDec = 3; nLon = 15; |HAZ Relleno;

     |XGRABA nHandle, aFinReg;

     nPrecio = nPrecio - nNume;

     |SI nTotalReg ! 46;
          aAlfa = "0000ERROR. Longitud Registro dtofac: " + nTotalReg;
          |MENAV aAlfa;
     |FINSI;
     nTotalReg = 0;
|FPRC;

|PROCESO LinFac;
     |SI #71#9 < 0; nAbo = -1; |SINO; nAbo = 1; |FINSI;

     #119#0 = #71#2;
     |LEE 020#119=;

     enTiva = #71#11;
     efFiva = #10#1;
     |HAZ SacaIVA;

||1NUMFAC    X    15
     aAlfa = #134#49; |QBF aAlfa;
     aAlfa = aAlfa + "/" + (("000000" + #134#0) % -106);
     aTipo = "A"; nLon = 15; |HAZ Relleno;

||2NUMLIN    N    3
     aAlfa = #71#1;
     aTipo = "N"; nLon = 3; |HAZ Relleno;

||3REFEAN    X    13
     aAlfa = #119#110;
     aTipo = "A"; nLon = 13; |HAZ Relleno;

||4REFCLI    X    35
     aAlfa = "";
     aTipo = "A"; nLon = 35; |HAZ Relleno;

||5REFPRO    X    35
     aAlfa = #71#2;
     aTipo = "A"; nLon = 35; |HAZ Relleno;

||6VP   X    2
     aAlfa = "";
     aTipo = "A"; nLon = 2; |HAZ Relleno;

||7DUN14     X    14
     aAlfa = "";
     aTipo = "A"; nLon = 14; |HAZ Relleno;

||8DESC X    35
     aAlfa = #71#4;
     aTipo = "A"; nLon = 35; |HAZ Relleno;

||9CFAC N    15,3
     aAlfa = #71#5;
     aTipo = "N"; nLon = 15; nDec = 3; |HAZ Relleno;

||10MEDIDA    N    10
     aAlfa = "";
     aTipo = "N"; nLon = 10; |HAZ Relleno;

||11UMEDIDA   X    3
     aAlfa = "";
     aTipo = "A"; nLon = 3; |HAZ Relleno;

||12PRECIOB   N    15,3
     nNume = #71#6 * nAbo;
     aAlfa = nNume;
     aTipo = "N"; nLon = 15; nDec = 3; |HAZ Relleno;

||13PRECION   N    15,3
     nNume = ((#71#6 < #71#8) < #71#33) * nAbo;
     aAlfa = nNume;
     aTipo = "N"; nLon = 15; nDec = 3; |HAZ Relleno;

||14TIPOIMP1  X    3
     aAlfa = "VAT";
     aTipo = "A"; nLon = 3;  |HAZ Relleno;
||15TASA1     N    8,3
     aAlfa = enIva;
     aTipo = "N"; nLon = 8; nDec = 3; |HAZ Relleno;
||16IMPTASA1  N    15,3
     nNume = ((#71#9 % enIva) ! EURODB) * nAbo;
     aAlfa = nNume;
     aTipo = "N"; nLon = 15; nDec = 3; |HAZ Relleno;

     |SI #71#8 ! 0;
||17CECUEN1  N    1
          aAlfa = "1";
          aTipo = "N"; nLon = 1; |HAZ Relleno;
||18PORCES1   N    8,3
          aAlfa = #71#8;
          aTipo = "N"; nLon = 8; nDec = 3; |HAZ Relleno;
||19IMPDTO  N    15,3
          nNume = ((#71#6 % #71#8) ! EURODB) * nAbo;
          aAlfa = nNume;
          aTipo = "N"; nLon = 15; nDec = 3; |HAZ Relleno;
     |SINO;
          aAlfa = ""; aTipo = "A"; nLon = 1; |HAZ Relleno;
          aAlfa = ""; aTipo = "N"; nLon = 8; nDec = 3; |HAZ Relleno;
          aAlfa = ""; aTipo = "N"; nLon = 15; nDec = 3; |HAZ Relleno;
     |FINSI;
     |SI #71#33 ! 0;
||20CECUEN1  N    1
          aAlfa = "2";
          aTipo = "N"; nLon = 1; |HAZ Relleno;
||21PORCES1   N    8,3
          aAlfa = #71#33;
          aTipo = "N"; nLon = 8; nDec = 3; |HAZ Relleno;
||22IMPDTO  N    15,3
          nNume = (#71#6 % #71#8) ! EURODB;
          nNume = ((nNume % #71#33) ! EURODB) * nAbo;
          aAlfa = nNume;
          aTipo = "N"; nLon = 15; nDec = 3; |HAZ Relleno;
     |SINO;
          aAlfa = ""; aTipo = "A"; nLon = 1; |HAZ Relleno;
          aAlfa = ""; aTipo = "N"; nLon = 8; nDec = 3; |HAZ Relleno;
          aAlfa = ""; aTipo = "N"; nLon = 15; nDec = 3; |HAZ Relleno;
     |FINSI;
||23,24,25
     aAlfa = ""; aTipo = "A"; nLon = 1; |HAZ Relleno;
     aAlfa = ""; aTipo = "N"; nLon = 8; nDec = 3; |HAZ Relleno;
     aAlfa = ""; aTipo = "N"; nLon = 15; nDec = 3; |HAZ Relleno;
||26,27,28
     aAlfa = ""; aTipo = "A"; nLon = 1; |HAZ Relleno;
     aAlfa = ""; aTipo = "N"; nLon = 8; nDec = 3; |HAZ Relleno;
     aAlfa = ""; aTipo = "N"; nLon = 15; nDec = 3; |HAZ Relleno;
||29
     aAlfa = ""; aTipo = "N"; nLon = 15; nDec = 3; |HAZ Relleno;
||30
     aAlfa = ""; aTipo = "N"; nLon = 15; nDec = 3; |HAZ Relleno;


||31TIPOESP  X    3
     aAlfa = ""; aTipo = "A"; nLon = 3; |HAZ Relleno;
||32IMPESP     N    15,3
     aAlfa = ""; aTipo = "N"; nLon = 15; nDec = 3; |HAZ Relleno;
||33
     aAlfa = ""; aTipo = "N"; nLon = 15; nDec = 3; |HAZ Relleno;

||34NETO N    15,3
     nNume = (#71#9 * nAbo);
     aAlfa = nNume;
     aTipo = "N"; nLon = 15; nDec = 3; |HAZ Relleno;

||35PVERDE    N    15,3
     nNume = (#119#119 * #71#5) * nAbo;
     aAlfa = ""; ||nNume;
     aTipo = "N"; nLon = 15; nDec = 3; |HAZ Relleno;
||36
     aAlfa = "";
     aTipo = "N"; nLon = 15; nDec = 3; |HAZ Relleno;
||37
     aAlfa = "";
     aTipo = "N"; nLon = 15; nDec = 3; |HAZ Relleno;

     |XGRABA nHandle, aFinReg;

     |SI nTotalReg ! 455;
          aAlfa = "0000ERROR. Longitud Registro linfac: " + nTotalReg;
          |MENAV aAlfa;
     |FINSI;
     nTotalReg = 0;
|FPRC;

|PROCESO CabFac;
     |SI #134#31 < 0; nAbo = -1; |SINO; nAbo = 1; |FINSI;

     |DDEFECTO #3;
     #3#0 = #10#3;
     #3#1 = #10#84;
     |LEE 000#3=;

     |DDEFECTO #6;
     #6#0 = #3#0;
     #6#1 = #3#1;
     |LEE 000#6=;

     |DDEFECTO #1;
     #1#0 = #3#11;
     |LEE 000#1=;

     |DDEFECTO #2;
     #2#0 = #3#16;
     |LEE 000#2=;

||1NUMFAC    X    15
     aAlfa = #134#49; |QBF aAlfa;
     aAlfa = aAlfa + "/" + (("000000" + #134#0) % -106);
     aTipo = "A"; nLon = 15; |HAZ Relleno;

||2VENDEDOR  X    13
     aAlfa = #41#12;
     aTipo = "A"; nLon = 13; |HAZ Relleno;

||3EMISOR    X    13
     aAlfa = #41#12;
     aTipo = "A"; nLon = 13; |HAZ Relleno;

||4COMPRADOR X    17
     aAlfa = #6#2; || #3#8; || #24#163;
     aTipo = "A"; nLon = 17; |HAZ Relleno;

||5DEPTO     X    17
     aAlfa = #24#164;
     aTipo = "A"; nLon = 17; |HAZ Relleno;

||6RECEPTOR  X    17
     aAlfa = #6#3; ||#3#9;
     aTipo = "A"; nLon = 17; |HAZ Relleno;

||7CLIENTE   X    17
     aAlfa = #6#4; ||#2#1; ||#1#1; || #24#165;
     aTipo = "A"; nLon = 17; |HAZ Relleno;

||8PAGADOR   X    17
     aAlfa = #6#5; ||#24#166;
     aTipo = "A"; nLon = 17; |HAZ Relleno;

||9PEDIDO    X    15
     aAlfa = #10#55; |QBF aAlfa;
     |SI aAlfa = ""; aAlfa = "S/P"; |FINSI;
     aTipo = "A"; nLon = 15; |HAZ Relleno;

||10FECHA     X    12
     aAlfa = #134#1;
     aTipo = "F"; nLon = 12; |HAZ Relleno;

||11NODO X    3
     |SI #10#43 = "S"; aAlfa = "381"; |SINO; aAlfa = "380"; |FINSI;
     aTipo = "A"; nLon = 3; |HAZ Relleno;

||12FUNCION   X    3
     aAlfa = "";
     aTipo = "A"; nLon = 3; |HAZ Relleno;

||13RSOCIAL   X    70
     aAlfa = #24#1;
     aTipo = "A"; nLon = 70; |HAZ Relleno;

||14CALLE     X    35
     aAlfa = #24#8;
     aTipo = "A"; nLon = 35; |HAZ Relleno;

||15CIUDAD    X    35
     aAlfa = #24#9;
     aTipo = "A"; nLon = 35; |HAZ Relleno;

||16CP   N    5
     aAlfa = #24#183;
     aTipo = "N"; nLon = 5; |HAZ Relleno;

||17NIF  X    9
     aAlfa = #24#15;
     aTipo = "A"; nLon = 9; |HAZ Relleno;

||18RAZON     X    3
     aAlfa = "";
     aTipo = "A"; nLon = 3; |HAZ Relleno;

||19No usado  15
     aAlfa = "";
     aTipo = "A"; nLon = 15; |HAZ Relleno;

||20ALBARAN   X    15
     aAlfa = #10#52; |QBF aAlfa;
     aAlfa = aAlfa + "/" + (("000000" + #10#0) % -106);
     aTipo = "A"; nLon = 15; |HAZ Relleno;

||21CONTRATO  X    15
     aAlfa = "";
     aTipo = "A"; nLon = 15; |HAZ Relleno;

||22NFACSUS   X    15
     aAlfa = "";
     aTipo = "A"; nLon = 15; |HAZ Relleno;

||23FPAGO     X    3
     aAlfa = #134#11;
     aTipo = "A"; nLon = 3; |HAZ Relleno;

||24DIVISA    X    3
     aAlfa = "EUR";
     aTipo = "A"; nLon = 3; |HAZ Relleno;

||25SUMBRUTO  N    15,3
     nNume = nSumBruto * nAbo;
     aAlfa = nNume;
     aTipo = "N"; nDec = 3; nLon = 15; |HAZ Relleno;

||26SUMNETOS  N    15,3
     nNume = nSumNeto * nAbo;
     aAlfa = nNume;
     aTipo = "N"; nDec = 3; nLon = 15; |HAZ Relleno;

||27CARGOS    N    15,3
     nNume = (#134#19 + #134#20) * nAbo;
     aAlfa = nNume;
     aTipo = "N"; nDec = 3; nLon = 15; |HAZ Relleno;

||28DESCUEN   N    15,3
     nNume = #134#17 * nAbo;
     aAlfa = nNume;
     aTipo = "N"; nDec = 3; nLon = 15; |HAZ Relleno;

     a1 = 0; a2 = 0; a3 = 0; a4 = 0; a5 = 0; a6 = 0;
     b1 = 0; b2 = 0; b3 = 0; b4 = 0; b5 = 0; b6 = 0;
     c1 = 0; c2 = 0; c3 = 0; c4 = 0; c5 = 0; c6 = 0;
     d1 = "";d2 = "";d3 = "";d4 = "";d5 = "";d6 = "";
     Ia = a1<-; Ib = b1<-; Ic = c1<-; Id = d1<-;
     |SI #134#91 ! 0;
          a = #134#91; b = #134#92; c = #134#39; d = "VAT";
          Ia = Ia + 1; Ib = Ib + 1; Ic = Ic + 1; Id = Id + 1;
     |FINSI;
     |SI #134#94 ! 0;
          a = #134#94; b = #134#95; c = #134#41; d = "VAT";
          Ia = Ia + 1; Ib = Ib + 1; Ic = Ic + 1; Id = Id + 1;
     |FINSI;
     |SI #134#97 ! 0;
          a = #134#97; b = #134#98; c = #134#43; d = "VAT";
          Ia = Ia + 1; Ib = Ib + 1; Ic = Ic + 1; Id = Id + 1;
     |FINSI;
     |SI #134#102 ! 0;
          a = #134#102; b = #134#103; c = #134#50; d = "VAT";
          Ia = Ia + 1; Ib = Ib + 1; Ic = Ic + 1; Id = Id + 1;
     |FINSI;
     |SI #134#105 ! 0;
          a = #134#105; b = #134#106; c = #134#52; d = "VAT";
          Ia = Ia + 1; Ib = Ib + 1; Ic = Ic + 1; Id = Id + 1;
     |FINSI;
     |SI #134#47 ! 0;
          a = #134#47; b = 0; c = 0; d = "EXT";
          Ia = Ia + 1; Ib = Ib + 1; Ic = Ic + 1; Id = Id + 1;
     |FINSI;

||29BASEIMP1:N15,3
     nNume = a1 * nAbo;
     aAlfa = nNume;
     aTipo = "N"; nLon = 15; nDec = 3; |HAZ Relleno;
||30TASAIMP1:N8,3
     aAlfa = c1;
     aTipo = "N"; nLon = 8; nDec = 3; |HAZ Relleno;
||31IMPIMI1:N15,3
     nNume = b1 * nAbo;
     aAlfa = nNume;
     aTipo = "N"; nLon = 15; nDec = 3; |HAZ Relleno;

||32BASEIMP2:N15,3
     nNume = a2 * nAbo;
     aAlfa = nNume;
     aTipo = "N"; nLon = 15; nDec = 3; |HAZ Relleno;
||33TASAIMP2:N8,3
     aAlfa = c2;
     aTipo = "N"; nLon = 8; nDec = 3; |HAZ Relleno;
||34IMPIMI2:N15,3
     nNume = b2 * nAbo;
     aAlfa = nNume;
     aTipo = "N"; nLon = 15; nDec = 3; |HAZ Relleno;
||35BASEIMP3:N15,3
     nNume = a2 * nAbo;
     aAlfa = nNume;
     aTipo = "N"; nLon = 15; nDec = 3; |HAZ Relleno;
||36TASAIMP3:N8,3
     aAlfa = c3;
     aTipo = "N"; nLon = 8; nDec = 3; |HAZ Relleno;
||37IMPIMI3:N15,3
     nNume = b3 * nAbo;
     aAlfa = nNume;
     aTipo = "N"; nLon = 15; nDec = 3; |HAZ Relleno;

||38BASEIMP REC1:N15,3
     aAlfa = "";
     aTipo = "N"; nLon = 15; nDec = 3; |HAZ Relleno;
||39TASA REC1:N8,3
     aAlfa = "";
     aTipo = "N"; nLon = 8; nDec = 3; |HAZ Relleno;
||40IMP REC1:N15,3
     aAlfa = "";
     aTipo = "N"; nLon = 15; nDec = 3; |HAZ Relleno;
||41BASEIMP REC2:N15,3
     aAlfa = "";
     aTipo = "N"; nLon = 15; nDec = 3; |HAZ Relleno;
||42TASA REC2:N8,3
     aAlfa = "";
     aTipo = "N"; nLon = 8; nDec = 3; |HAZ Relleno;
||43IMP REC2:N15,3
     aAlfa = "";
     aTipo = "N"; nLon = 15; nDec = 3; |HAZ Relleno;
||44BASEIMP REC3:N15,3
     aAlfa = "";
     aTipo = "N"; nLon = 15; nDec = 3; |HAZ Relleno;
||45TASA REC3:N8,3
     aAlfa = "";
     aTipo = "N"; nLon = 8; nDec = 3; |HAZ Relleno;
||46IMP REC3:N15,3
     aAlfa = "";
     aTipo = "N"; nLon = 15; nDec = 3; |HAZ Relleno;

||47BASE IGIC 15,3
     aAlfa = "";
     aTipo = "N"; nLon = 15; nDec = 3; |HAZ Relleno;
||48%IMP IGIC 8,3
     aAlfa = "";
     aTipo = "N"; nLon = 8; nDec = 3; |HAZ Relleno;
||49IMP IGIC 15,3
     aAlfa = "";
     aTipo = "N"; nLon = 15; nDec = 3; |HAZ Relleno;

||50BASEIMP:N15,3
     nNume = #134#21 + #134#24 + #134#27 + #134#33 + #134#36 + #134#47;
     nNume = nNume * nAbo;
     aAlfa = nNume;
     aTipo = "N"; nLon = 15; nDec = 3; |HAZ Relleno;
||51TOTIMP:N15,3
     nNume = #134#29 * nAbo;
     aAlfa = nNume;
     aTipo = "N"; nLon = 15; nDec = 3; |HAZ Relleno;
||52TOTAL:N15,3
     nNume = #134#31 * nAbo;
     aAlfa = nNume;
     aTipo = "N"; nLon = 15; nDec = 3; |HAZ Relleno;

||53VTO1:X8 'YYYYMMDD'
     nVto = 1; |HAZ Vto;
     aAlfa = aVto;
     aTipo = "F"; nLon = 12; |HAZ Relleno;
||54IMPVTO1:N15,3
     nNume = #133#2 * nAbo;
     aAlfa = nNume;
     aTipo = "N"; nLon = 15; nDec = 3; |HAZ Relleno;

||55VTO2:X8 'YYYYMMDD'
     nVto = 2; |HAZ Vto;
     aAlfa = aVto;
     aTipo = "F"; nLon = 12; |HAZ Relleno;
||56IMPVTO2:N15,3
     nNume = #133#2 * nAbo;
     aAlfa = nNume;
     aTipo = "N"; nLon = 15; nDec = 3; |HAZ Relleno;

||57VTO3:X8 'YYYYMMDD'
     nVto = 3; |HAZ Vto;
     aAlfa = aVto;
     aTipo = "A"; nLon = 12; |HAZ Relleno;
||58IMPVTO3:N15,3
     nNume = #133#2 * nAbo;
     aAlfa = nNume;
     aTipo = "N"; nLon = 15; nDec = 3; |HAZ Relleno;

||59TPVERDE   N    15,3
     aAlfa = ""; ||nTotVerde;
     aTipo = "N"; nLon = 15; nDec = 3; |HAZ Relleno;
||60IMP ALCOHOLES N 15,3
     aAlfa = "";
     aTipo = "N"; nLon = 15; nDec = 3; |HAZ Relleno;
||61No usado N 15,3
     aAlfa = "";
     aTipo = "N"; nLon = 15; nDec = 3; |HAZ Relleno;

||???
     aAlfa = "";
     aTipo = "A"; nLon = 85; |HAZ Relleno;

||62Fecha Entrega albaran
     aAlfa = #10#1;
     aTipo = "F"; nLon = 12; |HAZ Relleno;
     |XGRABA nHandle, aFinReg;

     |SI nTotalReg ! 976;
          aAlfa = "0000ERROR. Longitud Registro cabfac: " + nTotalReg;
          |MENAV aAlfa;
     |FINSI;
     nTotalReg = 0;
|FPRC;

|PROCESO Vto;
     |DDEFECTO #133;
     #133#4 = #134#49;
     #133#0 = #134#0;
     #133#1 = nVto;
     |LEE 000#133=;
     |SI FSalida = 0; |Y #133#2 ! 0;
          aVto = #133#3;
     |SINO;
          aVto = "                           ";
     |FINSI;
|FPRC;

|PROCESO SumLinAlb;
     |DDEFECTO #119;
     #119#0 = #71#2;
     |LEE 000#119=;

     nSumBruto = nSumBruto + #71#7;
     nSumNeto = nSumNeto + #71#9;
     nTotVerde = nTotVerde + (#119#119 * #71#5);
|FPRC;

|PROCESO LineasFac;
     nLinFac = nLinFac + 1;
     |SI nLinFac > 1;
          aAlfa = "0000ERROR, Factura:" + #134#49 +"/"+#134#0+ " con mas de una linea...";
          |MENAV aAlfa; |ACABA;
     |FINSI;

     #10#52 = #59#15;
     #10#0 = #59#2;
     |LEE 020#10=;
     |SI FSalida = 0;
          nSumNeto = 0;
          nSumBruto = 0;
          nTotVerde = 0;
          |BUCLELIN 2SumLinAlb#10;

          nHandle = nHandle1;
          |HAZ CabFac;

          nHandle = nHandle2;
          |BUCLELIN 2LinFac#10;

          nLinDto = 0;
          nHandle = nHandle3;
          nPrecio = #134#18 ! 2;
          |SI #134#4 ! 0; nDto = #134#4; |HAZ DtoFac; |FINSI;
          |SI #134#5 ! 0; nDto = #134#5; |HAZ DtoFac; |FINSI;
          |SI #134#6 ! 0; nDto = #134#6; |HAZ DtoFac; |FINSI;
     |FINSI;
|FPRC;

|PROCESO Exporta;
     #134#49 = #19#0;
     #134#0 = #19#1;
     |LEE 121#134=;
     |SI FSalida = 0;
          #24#0 = #134#2;
          |LEE 020#24=;
          nLinFac = 0;
          |BUCLELIN 2LineasFac#134;
          nFacturas = nFacturas + 1;
          #134#56 = "S";
          |GRABA 020#134a;
          |LIBERA #134;
     |FINSI;
|FPRC;

|DEFBUCLE Exporta;
     #19#1;
     6;
     "  ", 000001, "*";
     "zz", 999999, "*";
     ;
     NULL, Exporta;
|FIN;

|PROCESO agifa059;
     nUna = nUna + 1;
|FPRC;

|PROCESO agifa134;
     nUna = 0;
|FPRC;

|PROCESO GraTmp;
     aAlfa = #134#49; |QBF aAlfa;
     aAlfa = aAlfa + "/" + (("000000" + #134#0) % -106);
     |SI nUna = 0;
          || aAlfa = "0000Factura:[" + aAlfa + "] sin lineas...";
          || |MENAV aAlfa;
          |ACABA;
     |FINSI;
     |SI nUna ! 1;
          || aAlfa = "S0000Factura:[" + aAlfa + "]"+&13+"con mas de 1 albaran"+&13+"Continuar:";
          || |CONFI aAlfa;
          || |SI FSalida ! 0;
          ||      |ERROR10;
          || |FINSI;
          |ACABA;
     |FINSI;
     #19#0 = #134#49;
     #19#1 = #134#0;
     #19#2 = #134#1;
     #19#3 = #134#2;
     #19#4 = #134#3;
     #19#5 = #134#101;
     #19#6 = "*";
     |GRABA 020#19n;
|FPRC;

|DEFBUCLE agifa134;
     #134#3;
     56;
     #0#2, #0#8, #0#4, #0#6, aDexp;
     #0#3, #0#9, #0#5, #0#7, aHexp;
     be;
     NULL, agifa134, agifa059, GraTmp;
|FIN;

|PROCESO Min;
     #19#0 = "  ";
     #19#1 = 1;
|FPRC;

|PROCESO Max;
     #19#0 = "zz";
     #19#1 = 999999;
|FPRC;

|PROCESO Tecla; |TIPO 0;
     |SI FSalida = 0; |Y #19Campo = Contenido;
          |SI #19#6 = "*";
               #19#6 = "";
          |SINO;
               #19#6 = "*";
          |FINSI;
          |GRABA 020#19a;
          |LIBERA #19;
     |FINSI;
|FPRC;

|PROCESO FicVacios;
     |SI aIP = "";
          aTipo = "WB";
     |SINO;
          aTipo = "CWB";
     |FINSI;

     aAlfa = aDes + "obsfac.txt";
     |XABRE aTipo, aAlfa, nHandle;
     |SI FSalida ] 0;
          |XCIERRA nHandle;
     |SINO;
          |MENAV "0000No puedo crear el fichero obsfac.txt";
     |FINSI;
     aAlfa = aDes + "obslfac.txt";
     |XABRE aTipo, aAlfa, nHandle;
     |SI FSalida ] 0;
          |XCIERRA nHandle;
     |SINO;
          |MENAV "0000No puedo crear el fichero obslfac.txt";
     |FINSI;
|FPRC;

|PROCESO Tipo3; |TIPO 3;
     aFinReg = &13;
     aFinReg = aFinReg + & 10;

     |ESTADO_CONTROL nBoton1, "HIDE";
     |SI #0#10 = "T";
          aDexp = " ";
          aHexp = "z";
     |SINO;
          aDexp = #0#10;
          aHexp = #0#10;
     |FINSI;

     |DBASE aAlfa; aAlfa = aAlfa + "fich/";
     |PATH_DAT #41 aAlfa;
     |ABRE #41;
     |DFICE aAlfa; aAlfa = aAlfa % -205;
     #41#0 = aAlfa;
     |LEE 000#41=;
     |CIERRA #41;

     aAlfa = Usuario;
     |NOME_DAT #19 aAlfa; |DELINDEX #19;

     |ABRE #19;
     |BUCLE agifa134;
     |CIERRA #19;

     |PINPA #0#19;
     |ENTLINEAL #1#19, 1, 4, 22, 0, Min, Max;
     |CONFI "0000SConforme con lo seleccionado:";
     |SI FSalida = 0;
          |DFICE aFic;
          aFic = aFic + Usuario;

          aAlfa = aFic + "cabfac.txt";
          |XABRE "WB", aAlfa, nHandle1;
          |SI FSalida ] 0;
               aAlfa = aFic + "linfac.txt";
               |XABRE "WB", aAlfa, nHandle2;
               |SI FSalida ] 0;
                    aAlfa = aFic + "dtofac.txt";
                    |XABRE "WB", aAlfa, nHandle3;
                    |SI FSalida ] 0;
                         |ABRE #133;
                         |ABRE #134;
                         |ABRE #24;
                         |ABRE #10;
                         |ABRE #119;
                         |ABRE #6;
                         |ABRE #3;
                         |ABRE #1;
                         |ABRE #2;
                         |BUCLE Exporta;
                         |CIERRA #2;
                         |CIERRA #1;
                         |CIERRA #3;
                         |CIERRA #6;
                         |CIERRA #119;
                         |CIERRA #10;
                         |CIERRA #24;
                         |CIERRA #134;
                         |CIERRA #133;
                         |XCIERRA nHandle3;
                    |SINO;
                         nError = 1;
                         |MENAV "0000No puedo crear el fichero dtofac.txt";
                    |FINSI;
                    |XCIERRA nHandle2;
               |SINO;
                    nError = 1;
                    |MENAV "0000No puedo crear el fichero linfac.txt";
               |FINSI;
               |XCIERRA nHandle1;
               |SI nError = 0;
                    aDes = #0#1; |QBF aDes;
                    aAlfa = aDes % -101;
                    |SI aAlfa ! "/"; |Y aAlfa ! "\"; aDes = aDes + "/"; |FINSI;
                    |RMKDIR aDes;

                    aIP = ""; |IP_REMOTO aIP;

                    aAlfa = aDes + "cabfac.txt";
                    aOrg = aFic + "cabfac.txt";
                    |SI aIP = "";
                         |COPIA_FICHERO aOrg, aAlfa;
                    |SINO;
                         |ENVIA_FICHERO aOrg, aAlfa;
                    |FINSI;
                    |FBORRA aOrg;

                    aAlfa = aDes + "linfac.txt";
                    aOrg = aFic + "linfac.txt";
                    |SI aIP = "";
                         |COPIA_FICHERO aOrg, aAlfa;
                    |SINO;
                         |ENVIA_FICHERO aOrg, aAlfa;
                    |FINSI;
                    |FBORRA aOrg;

                    aAlfa = aDes + "dtofac.txt";
                    aOrg = aFic + "dtofac.txt";
                    |SI aIP = "";
                         |COPIA_FICHERO aOrg, aAlfa;
                    |SINO;
                         |ENVIA_FICHERO aOrg, aAlfa;
                    |FINSI;
                    |FBORRA aOrg;

                    |HAZ FicVacios;

                    aAlfa = "0000Exportadas: " + nFacturas + " facturas...";
                    |MENAV aAlfa;
               |FINSI;
          |SINO;
               |MENAV "0000No puedo crear el fichero cabfac.txt";
          |FINSI;
     |FINSI;
     |DELINDEX #19;
|FPRC;
ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
|PROCESO Boton1;
     |PTEC 824;
|FPRC;

|PROCESO Browser;
     |SI FSalida ! 10; |ACABA; |FINSI;

     aRuta = #0#1;  |QBF aRuta;
     |SI aRuta = "";
         aRuta = "\*.*";
     |FINSI;
     aRuta = "D" + aRuta;

     |BROWSE aRuta;

     aRuta = aRuta % 299;
     #0#1 = aRuta;
     |PINTA #0#1;
     |QBF aRuta;
     |SI aRuta = ""; |ERROR; |FINSI;
|FPRC;

|PROCESO Quita; |TIPO 0;
     |ESTADO_CONTROL nBoton1, "DISABLE";
|FPRC;

|PROCESO Pone; |TIPO 7;
     |ESTADO_CONTROL nBoton1, "ENABLE";
|FPRC;

|PROGRAMA;
     EURODB2 = EURODB + 2;
     |CONTROL_SIMPLE 0, "BOTON, Directorio", 919, 926, Boton1;
     nBoton1 = FSalida;
     |HAZ Quita;

     |ABRE #0;
     |LEE 101#0=;
     |SI FSalida ! 0; |GRABA 020#0b; |FINSI;

     |CLS;
     |PINPA #0#0;
     |PINDA #0#0;
     |ENDATOS #1#0;
     |SI FSalida = 0;
          |GRABA 020#0a;
     |FINSI;
     |CIERRA #0;

     |FIN_CONTROL_WINDOWS nBoton1;
     |PULSATECLA;
|FPRO;
