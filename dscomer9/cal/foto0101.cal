|FICHEROS;
foto0101 #0;
agift560 #1;
foto0075 #2;
||agifa314 #3;
|FIN;

|VARIABLES;
  ip_serv = "";
  serv_correo = "";
  us = "";
  pass = "";
  path = "";
  ficheros = "";
  asystem = "";
  from = "";
  to = "";
  subject = "";
  mensaje = "";
  ficheros2 = "";
  mensa = "0000­Atencion! Ha habido un error en la recepcion.";
  mensaj = "";
  sal = 0;
  pos = 0;
  car = "";
  dele = "";
  del = 0;
  num = 0;
  reg = 0;
  param = "";
|FIN;


|PROCESO copia;
|PARA reg = reg; |SI reg > 0; |HACIENDO reg = reg - 1;
    |DSCORREO_RECIBE ip_serv,serv_correo,us,pass,path,ficheros;
    |SI FSalida ! 0;
       |MENAV mensa;
    |SINO;
      |QUE_SISTEMA asystem;
      |SI asystem = "ESBSD";
         asystem = "chmod 777 " + ficheros;
         |SYSTEM asystem;
      |FINSI;
      car = ficheros % -601;
      |SI car = "r";
        dele = ficheros % -501;
      |SINO;
        dele = ficheros % -502;
      |FINSI;
      del = dele;
      mensaj = "0000El fichero de la delegacion " + del;
      mensaj = mensaj + " ha llegado correctamente.";
      |MENSA mensaj;
/*
      param = PARAMETRO;
      |SI param = "moddel";
        |ABRE #3;
        #3#0 = del;
        |LEE 010#3=;
        ficheros2 = #3#1;
        |CIERRA #3;
      |SINO;
*/
        |ABRE #2;
        #2#0 = del;
        |LEE 010#2=;
        ficheros2 = #2#1;
        |CIERRA #2;
||      |FINSI;
      |QBF ficheros2;
      ficheros2 = ficheros2 + "expor" + del + ".tgz";
      |COPIA_FICHERO ficheros,ficheros2;
      |FBORRA ficheros;
      |QUE_SISTEMA asystem;
      |SI asystem = "ESBSD";
         asystem = "chmod 777 " + ficheros2;
         |SYSTEM asystem;
      |FINSI;
    ||ficheros2 = "";
    ||DSCORREO_ENVIA ip_serv,serv_correo,from,to,subject,mensaje,ficheros2;
    |FINSI;
|SIGUE;
|FPRC;

|PROCESO para_lin;
reg = reg + 1;
|FPRC;

|DEFBUCLE para;
#2#1;
;
INICIO;
FINAL;
be;
NULL,para_lin;
|FIN;

|PROCESO para_lin2;
reg = reg + 1;
|FPRC;
/*
|DEFBUCLE para2;
#3#1;
;
INICIO;
FINAL;
be;
NULL,para_lin2;
|FIN;
*/

|PROGRAMA;
|CONFI "0000SEsta seguro de que recibir los datos ";
|SI FSalida = 0;
  |ABRE #0;
  |ABRE #1;
  |LEE 010#1p;
  |SI FSalida ! 0;
    |MENAV "0000No se han establecido los parametros de envio";
  |SINO;
    ip_serv = #1#1+"."+#1#2+"."+#1#3+"."+#1#4;
    serv_correo = #1#11;
    us = #1#12;
    pass = #1#13;
    path = #1#14;
    ficheros = #1#15;
    |QBT ip_serv;
    |QBF serv_correo;
    |QBF us;
    |QBF pass;
    |QBF path;
    |QBF ficheros;
    |MENSA "0000Recibiendo mensajes ..."
    reg = 0;
/*
    param = PARAMETRO;
    |SI param = "moddel";
      |BUCLE para2;
    |SINO;
*/
      |BUCLE para;
||    |FINSI;
    |HAZ copia;
  |FINSI;
  |CIERRA #1;
  |CIERRA #0;
|FINSI;
|FPRO;
