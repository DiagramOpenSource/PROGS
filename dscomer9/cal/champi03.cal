|FICHEROS;
     champi03 #0;
     champi06 #6;
     referen@ #1;   || champi04, champi05
     agifa019 #19;
     agifa142 #142;
|FIN;

|VARIABLES;
     &eaTipo = "";
     &eaSerie = "";
     &enCodigo = 0;
     &enLinea = 0;
     &enUnidades = 0;

     n_dec = 0;

     aParam = "";
     nPeso = "";
     aAlfa = "";
     nHandle = 0;
     aDef = "";
|FIN;

|PROCESO Na; |TIPO 12;
|FPRC;

|PROCESO Mensa; |TIPO 7;
     |SI aParam = "COMPRAS";
          |MENSA "0000<F2> Recoger datos bascula";
     |FINSI;
|FPRC;

|PROCESO Tecla; |TIPO 0;
     #0Campo = #0Campo ! n_dec;
     |SI FSalida = 10; |Y aParam = "COMPRAS";
          |HAZ LeePeso;
          #0Campo = nPeso;
          |ERROR;
     |FINSI;
|FPRC;

|PROCESO LeePeso;
     |RSYSTEM "/ds/bin/leepeso";
     |SLEEP 1;
     |XABRE "CU", "/ds/peso.txt", nHandle;
     |SI FSalida ! 0 ;
          |MENAV "0000No puedo abrir: /ds/peso.txt";
     |SINO;
          |XLEE nHandle ,250 , aAlfa;
          nPeso = aAlfa;
          |XCIERRA nHandle;
     |FINSI;
|FPRC;

|PROCESO Tara; |TIPO 0;
     |SI #0Campo ! Contenido;
          |ABRE #6;
          #6#0 = #0#3;
          |LEE 020#6=;
          |CIERRA #6;
          #0#2 = #0#0 * #6#2;
          |PINTA #0#2;
     |FINSI;
|FPRC;

|PROGRAMA;
     |ABRE #142; |LEE 000#142p; |CIERRA #142;
     n_dec = #142#8;

     |DDEF aDef;
     |SI eaTipo = "AV"; aDef = aDef + "champi04"; |FINSI;
     |SI eaTipo = "AC"; aDef = aDef + "champi05"; |FINSI;
     |SI eaTipo = "PV"; aDef = aDef + "champi10"; |FINSI;
     |SI eaTipo = "PR"; aDef = aDef + "champi11"; |FINSI;

     |CARGA_DEF aDef, referen@;
     |SI FSalida = 0;
          |DDEFECTO #0;
          |DDEFECTO #1;
          |ABRE #1;
          #1#0 = eaSerie;
          #1#1 = enCodigo;
          #1#2 = enLinea;
          |LEE 101#1=;
          |SI FSalida ! 0;
               |GRABA 020#1b;
          |FINSI;
          #0#0 = #1#3;
          #0#1 = #1#4;
          #0#2 = #1#5;
          #0#3 = #1#6;
          |BLANCO 1313 2155;
          |PINPA #0#0;
          |PINDA #0#0;
          |ENDATOS #1#0;
          |SI FSalida = 0;
               #1#3 = #0#0;
               #1#4 = #0#1;
               #1#5 = #0#2;
               #1#6 = #0#3;
          |FINSI;
          |GRABA 020#1a;
          |CIERRA #1;
          |DESCARGA_DEF #referen@;

          enUnidades = #0#1 - #0#2;
     |SINO;
          |MENAV "0000ERROR al cargar champi0?";
     |FINSI;
|FPRO;
