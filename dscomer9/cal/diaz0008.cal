|FICHEROS;
     diaz0008 #0;
     agifa007 #7;
     agifa025 #25;
     agifa104 #104;
     agifa134 #134;
     agifa010 #10;
     agifa059 #59;
     agifa071 #71;
     agifa073 #73;

     diam0001 #101;
     diam0009 #109;
     diam0010 #110;
     diam0011 #111;
     diam0012 #112;
     diam0013 #113;
     diam0014 #114;
     diam0016 #116;
     diam0022 #122;

     :/dscarter/def/dscam003 #203;
     :/dscarter/def/dscam004 #204;
     :/dscarter/def/dscam045 #245;

     :/dspartes/def/dsasis04 #300;

     refere01@ #999;  || Def diam0009 para acumular es un truco para no crear
                      || un def nuevo.
|FIN;

|VARIABLES;
     aBase        = "";
     aPathFich    = "";
     aFichero     = "";
     aAlfa        = "";
     aRepre       = "!!";
     aHFecha      = "";
     aDef         = "";
     aMas         = "";
     aHora        = "";

     fFecha       = @;

     nEmpresaFact = 0;
     nEmpresaCart = 0;
     nSalir       = 0;
     nCampo       = 0;
     nAnyo        = 0;
     nMes         = 0;
     nMesBue      = 0;
     nLinea       = 0;
     nComis       = 0;
     nBase        = 0;
     nBaseS       = 0;
     nCoste       = 0;
     nCoste1      = 0;
     nCoste2      = 0;

     &Tempo       = "";
|FIN;

|| __________________________ Calculos de las Pantallas _____________________

|PROCESO Serie;
     |C_M #0#01, 1, "S";
     |C_M #0#02, 1, "S";
     |C_M #0#03, 1, "S";
     |C_M #0#04, 1, "S";
     |C_M #0#05, 1, "S";
     |C_M #0#06, 1, "S";

     |SI #0#0  = "T";
         #0#01 = "!!!!!";  |PINTA #0#01;  |C_M #0#01, 1, "N";
         #0#02 = "!!!!!";  |PINTA #0#02;  |C_M #0#02, 1, "N";
         #0#03 = "!!!!!";  |PINTA #0#03;  |C_M #0#03, 1, "N";
         #0#04 = "!!!!!";  |PINTA #0#04;  |C_M #0#04, 1, "N";
         #0#05 = "!!!!!";  |PINTA #0#05;  |C_M #0#05, 1, "N";
         #0#06 = "!!!!!";  |PINTA #0#06;  |C_M #0#06, 1, "N";
     |FINSI;
|FPRC;

|PROCESO ConsuSerie;  |TIPO 66;
     |ABRE #7;

     #7#26 = #0Campo;
     |LEE 040#7=;
     |SI FSalida ! 0;  |LEE 040#7p; |FINSI;

     |CONSULTA_CLAVE #1#7;
     |SI FSalida = 0;
         #0Campo = #7#26;  |PINTA #0Campo;
     |FINSI;
     |CIERRA #7;
|FPRC;

|PROCESO Representante;
     |C_M #0#08, 1, "S";
     |C_M #0#09, 1, "S";
     |C_M #0#10, 1, "S";
     |C_M #0#11, 1, "S";
     |C_M #0#12, 1, "S";
     |C_M #0#13, 1, "S";
     |C_M #0#14, 1, "S";
     |C_M #0#15, 1, "S";
     |C_M #0#16, 1, "S";
     |C_M #0#17, 1, "S";
     |C_M #0#18, 1, "S";
     |C_M #0#19, 1, "S";

     |SI #0#7  = "T";
         #0#08 = "!!";  |PINTA #0#08;  |C_M #0#08, 1, "N";
         #0#09 = "!!";  |PINTA #0#09;  |C_M #0#09, 1, "N";
         #0#10 = "!!";  |PINTA #0#10;  |C_M #0#10, 1, "N";
         #0#11 = "!!";  |PINTA #0#11;  |C_M #0#11, 1, "N";
         #0#12 = "!!";  |PINTA #0#12;  |C_M #0#12, 1, "N";
         #0#13 = "!!";  |PINTA #0#13;  |C_M #0#13, 1, "N";
         #0#14 = "!!";  |PINTA #0#14;  |C_M #0#14, 1, "N";
         #0#15 = "!!";  |PINTA #0#15;  |C_M #0#15, 1, "N";
         #0#16 = "!!";  |PINTA #0#16;  |C_M #0#16, 1, "N";
         #0#17 = "!!";  |PINTA #0#17;  |C_M #0#17, 1, "N";
         #0#18 = "!!";  |PINTA #0#18;  |C_M #0#18, 1, "N";
         #0#19 = "!!";  |PINTA #0#19;  |C_M #0#19, 1, "N";
     |FINSI;

     |SI #0#7  = "A";
         #0#18 = "  ";  |PINTA #0#18;  |C_M #0#18, 1, "N";
         #0#19 = "zz";  |PINTA #0#19;  |C_M #0#19, 1, "N";
     |FINSI;

     |SI #0#7  = "D";
         #0#08 = "!!";  |PINTA #0#08;  |C_M #0#08, 1, "N";
         #0#09 = "!!";  |PINTA #0#09;  |C_M #0#09, 1, "N";
         #0#10 = "!!";  |PINTA #0#10;  |C_M #0#10, 1, "N";
         #0#11 = "!!";  |PINTA #0#11;  |C_M #0#11, 1, "N";
         #0#12 = "!!";  |PINTA #0#12;  |C_M #0#12, 1, "N";
         #0#13 = "!!";  |PINTA #0#13;  |C_M #0#13, 1, "N";
         #0#14 = "!!";  |PINTA #0#14;  |C_M #0#14, 1, "N";
         #0#15 = "!!";  |PINTA #0#15;  |C_M #0#15, 1, "N";
         #0#16 = "!!";  |PINTA #0#16;  |C_M #0#16, 1, "N";
         #0#17 = "!!";  |PINTA #0#17;  |C_M #0#17, 1, "N";
     |FINSI;
|FPRC;

|PROCESO ConsuRepresentante;  |TIPO 66;
     |ABRE #25;

     #25#0 = #0Campo;
     |LEE 040#25=;
     |SI FSalida ! 0;  |LEE 040#25p; |FINSI;

     |CONSULTA_CLAVE #1#25;
     |SI FSalida = 0;
         #0Campo = #25#0;  |PINTA #0Campo;
     |FINSI;
     |CIERRA #25;
|FPRC;

|PROCESO Mes;
     |SI #0#21 = 1;   #0#22 = "ENERO     ";  |FINSI;
     |SI #0#21 = 2;   #0#22 = "FEBRERO   ";  |FINSI;
     |SI #0#21 = 3;   #0#22 = "MARZO     ";  |FINSI;
     |SI #0#21 = 4;   #0#22 = "ABRIL     ";  |FINSI;
     |SI #0#21 = 5;   #0#22 = "MAYO      ";  |FINSI;
     |SI #0#21 = 6;   #0#22 = "JUNIO     ";  |FINSI;
     |SI #0#21 = 7;   #0#22 = "JULIO     ";  |FINSI;
     |SI #0#21 = 8;   #0#22 = "AGOSTO    ";  |FINSI;
     |SI #0#21 = 9;   #0#22 = "SEPTIEMBRE";  |FINSI;
     |SI #0#21 = 10;  #0#22 = "OCTUBRE   ";  |FINSI;
     |SI #0#21 = 11;  #0#22 = "NOVIEMBRE ";  |FINSI;
     |SI #0#21 = 12;  #0#22 = "DICIEMBRE ";  |FINSI;

     |PINTA #0#22;
|FPRC;

|| __________________________ Calculos del Calculo  _________________________

|PROCESO GrabaTecnico1;
     |SI #0#7 = "A";
         nSalir = 0;
         |PARA nCampo = 8;  |SI nCampo [ 17;  |HACIENDO nCampo = nCampo + 1;
               |SI #101#18 = #0nCampo;  nSalir = 1;  |SAL;  |FINSI;
         |SIGUE;
         |SI nSalir = 0;  |ACABA;  |FINSI;
     |FINSI;

     |SI #0#7 = "D";
         |SI #101#18 < #0#18;  |O #101#18 > #0#19;  |ACABA;  |FINSI;
     |FINSI;

     #25#0 = #101#18;
     |LEE 040#25=;
     |SI FSalida ! 0;  |DDEFECTO #25;  |FINSI;

     #109#0 = #25#0;
     #109#5 = nAnyo;
     |LEE 040#109=;
     |SI FSalida ! 0;  |DDEFECTO #109;  |FINSI;

     |SI #109#9 = "P";  nMes = 99;  |FINSI;

     #110#0  = nAnyo;
     #110#1  = nMes;
     #110#2  = #101#18;
     |LEE 101#110=;
     |SI FSalida ! 0;
         |DDEFECTO #110;
         #110#0  = nAnyo;
         #110#1  = nMes;
         #110#2  = #101#18;
         #110#3  = #25#1;
         |GRABA 020#110n;
         |LIBERA #110;
     |FINSI;

     #111#0  = #110#0;
     #111#1  = #110#1;
     #111#2  = #110#2;
     #111#3  = "P";
     #111#4  = #134#49;
     #111#5  = #134#0;
     |LEE 101#111=;
     |SI FSalida ! 0;
         |DDEFECTO #111;
         #111#0  = #110#0;
         #111#1  = #110#1;
         #111#2  = #110#2;
         #111#3  = "P";
         #111#4  = #134#49;
         #111#5  = #134#0;
         |GRABA 020#111b;
     |FINSI;

     #111#6  = #104#1;
     #111#7  = #101#30;
     #111#8  = #101#0;
     #111#9  = #101#3;
     #111#10 = #101#1;
     #111#11 = #101#13;
     #111#12 = #101#14;
     #111#13 = #101#15;
     #111#14 = #10#52;
     #111#15 = #10#0;
     #111#16 = #134#49;
     #111#17 = #134#0;
     #111#18 = #134#101;
     #111#19 = #134#91 + #134#94 + #134#97 + #134#102 + #134#105 + #134#47;
     #111#20 = nCoste1;
     #111#21 = #111#19 - #111#20;

     |GRABA 020#111a;
     |LIBERA #111;
|FPRC;

|PROCESO GrabaTecnico2;
     |SI #0#7 = "A";
         nSalir = 0;
         |PARA nCampo = 8;  |SI nCampo [ 17;  |HACIENDO nCampo = nCampo + 1;
               |SI #101#29 = #0nCampo;  nSalir = 1;  |SAL;  |FINSI;
         |SIGUE;
         |SI nSalir = 0;  |ACABA;  |FINSI;
     |FINSI;

     |SI #0#7 = "D";
         |SI #101#29 < #0#18;  |O #101#29 > #0#19;  |ACABA;  |FINSI;
     |FINSI;

     #25#0 = #101#29;
     |LEE 040#25=;
     |SI FSalida ! 0;  |DDEFECTO #25;  |FINSI;

     #109#0 = #25#0;
     #109#5 = nAnyo;
     |LEE 040#109=;
     |SI FSalida ! 0;  |DDEFECTO #109;  |FINSI;

     |SI #109#9 = "P";  nMes = 99;  |FINSI;

     #110#0  = nAnyo;
     #110#1  = nMes;
     #110#2  = #101#29;
     |LEE 101#110=;
     |SI FSalida ! 0;
         |DDEFECTO #110;
         #110#0  = nAnyo;
         #110#1  = nMes;
         #110#2  = #101#29;
         #110#3  = #25#1;
         |GRABA 020#110b;
     |FINSI;

     |GRABA 020#110a;
     |LIBERA #110;

     #111#0  = #110#0;
     #111#1  = #110#1;
     #111#2  = #110#2;
     #111#3  = "P";
     #111#4  = #134#49;
     #111#5  = #134#0;
     |LEE 101#111=;
     |SI FSalida ! 0;
         |DDEFECTO #111;
         #111#0  = #110#0;
         #111#1  = #110#1;
         #111#2  = #110#2;
         #111#3  = "P";
         #111#4  = #134#49;
         #111#5  = #134#0;
         |GRABA 020#111b;
     |FINSI;

     #111#6  = #104#1;
     #111#7  = #101#31;
     #111#8  = #101#0;
     #111#9  = #101#3;
     #111#10 = #101#1;
     #111#11 = #101#13;
     #111#12 = #101#14;
     #111#13 = #101#15;
     #111#14 = #10#52;
     #111#15 = #10#0;
     #111#16 = #134#49;
     #111#17 = #134#0;
     #111#18 = #134#101;

     #111#19 = #134#91 + #134#94 + #134#97 + #134#102 + #134#105 + #134#47;
     #111#21 = nCoste2;                      || La Base Comision del tecnico
     #111#20 = #111#19 - #111#21;            || 2 no entra el Hard ni los
                                             || Mantenimientos.
     |GRABA 020#111a;
     |LIBERA #111;
|FPRC;

|PROCESO diam0001;
     |SI #101#14 = "     ";  |Y #101#15 = 0;
         |ACABA;
     |FINSI;

     #73#28 = #101#14;
     #73#0  = #101#15;
     #73#1  = 1;
     |LEE 040#73];
     |SI FSalida ! 0;  |O  #73#28 ! #101#14;  |O  #73#0  ! #101#15;
         |DDEFECTO #73;
         #73#0 = 0;
     |FINSI;

     #71#31 = #73#28;
     #71#12 = #73#0;
     #71#21 = #73#1;
     |LEE 040#71=;
     |SI FSalida ! 0;
         |DDEFECTO #71;
         #71#0 = 0;
     |FINSI;

     #10#52 = #71#29;
     #10#0  = #71#0;
     |LEE 040#10=;
     |SI FSalida ! 0;
         |DDEFECTO #10;
         #10#0 = 0;
     |FINSI;

     #134#49 = #10#53;
     #134#0  = #10#39;
     |LEE 040#134=;
     |SI FSalida ! 0;  |ACABA;   |FINSI;

     #104#25 = #101#14;
     #104#0  = #101#15;
     |LEE 040#104=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |SI #104#1 < "01.01.2003";  |ACABA;  |FINSI;

     aAlfa = #104#1 % -104;
     nAnyo = aAlfa;

     aAlfa = #104#1 % 402;
     nMes  = aAlfa;

     |SI #0#0 = "A";
         nSalir = 0;
         |PARA nCampo = 1;  |SI nCampo [ 6;  |HACIENDO nCampo = nCampo + 1;
               |SI #134#49 = #0nCampo;  nSalir = 1;  |SAL;  |FINSI;
         |SIGUE;
         |SI nSalir = 0;  |ACABA;  |FINSI;
     |FINSI;

     #116#0  = #101#0;
     #116#1  = #101#1;
     #116#13 = #101#13;
     |LEE 040#116=;
     |SI FSalida ! 0;
         |DDEFECTO #116;
         nCoste1 = #101#16;
         nCoste2 = (#134#91 + #134#94 + #134#97 + #134#102 + #134#105 + #134#47) - #101#16;
     |SINO;
         nCoste1 = #116#16;                      || La Base Comision del tecnico
         nCoste2 = #116#80 + #116#85 - #116#81;  || La Base Comision del tecnico
     |FINSI;

     |SI #101#18 ! "  ";  |Y #101#18 ! "00";
         |HAZ GrabaTecnico1;
     |FINSI;

     |SI #101#29 ! "  ";  |Y #101#29 ! "00";  |Y #101#18 ! #101#29;
         |HAZ GrabaTecnico2;
     |FINSI;
|FPRC;

|DEFBUCLE diam0001;
     #101#1;
     ;
     "      ", "01.01.0000", "        ";
     "zzzzzz",      aHFecha, "zzzzzzzz";
     ;
     NULL, diam0001;
|FIN;

|PROCESO GrabaPdteTecnico;
     |SI nBase = 0;  |Y nCoste = 0;
         |ACABA;
     |FINSI;

     |SI #0#7 = "A";
         nSalir = 0;
         |PARA nCampo = 8;  |SI nCampo [ 17;  |HACIENDO nCampo = nCampo + 1;
               |SI aRepre = #0nCampo;  nSalir = 1;  |SAL;  |FINSI;
         |SIGUE;
         |SI nSalir = 0;  |ACABA;  |FINSI;
     |FINSI;

     |SI #0#7 = "D";
         |SI aRepre < #0#18;  |O aRepre > #0#19;  |ACABA;  |FINSI;
     |FINSI;

     #25#0 = aRepre;
     |LEE 040#25=;
     |SI FSalida ! 0;  |DDEFECTO #25;  |FINSI;

     #109#0 = #25#0;
     #109#5 = nAnyo;
     |LEE 040#109=;
     |SI FSalida ! 0;  |DDEFECTO #109;  |FINSI;

     nMesBue = nMes;
     |SI #109#9 = "P";  nMes = 99;  |FINSI;

     #110#0  = nAnyo;
     #110#1  = nMes;
     #110#2  = aRepre;
     |LEE 101#110=;
     |SI FSalida ! 0;
         |DDEFECTO #110;
         #110#0  = nAnyo;
         #110#1  = nMes;
         #110#2  = aRepre;
         #110#3  = #25#1;
         |GRABA 020#110n;
         |LIBERA #110;
     |FINSI;

     #111#0  = #110#0;
     #111#1  = #110#1;
     #111#2  = #110#2;
     #111#3  = nComis;
     #111#4  = #104#25;
     #111#5  = #104#0;
     |LEE 101#111=;
     |SI FSalida ! 0;
         |DDEFECTO #111;
         #111#0  = #110#0;
         #111#1  = #110#1;
         #111#2  = #110#2;
         #111#3  = nComis;
         #111#4  = #104#25;
         #111#5  = #104#0;
         |GRABA 020#111b;
     |FINSI;

     aAlfa   = "01." + (("00" + nMesBue) % -102) + "." + #110#0;
     #111#6  = aAlfa;
     #111#7  = nComis;
     #111#8  = #104#4;
     #111#9  = #104#8;
     #111#10 = fFecha;
     #111#11 = aHora;
     #111#12 = #104#25;
     #111#13 = #104#0;
     #111#14 = "";
     #111#15 = "";
     #111#16 = "";
     #111#17 = "";
     #111#18 = #111#18 + nBase;
     #111#19 = #111#18;
     #111#20 = #111#20 + nCoste;
     #111#21 = #111#19 - #111#20;

     |GRABA 020#111a;
     |LIBERA #111;
|FPRC;

|PROCESO agifa104;
     |SI #0#0 = "A";
         nSalir = 0;
         |PARA nCampo = 1;  |SI nCampo [ 6;  |HACIENDO nCampo = nCampo + 1;
               |SI #104#25 = #0nCampo;  nSalir = 1;  |SAL;  |FINSI;
         |SIGUE;
         |SI nSalir = 0;  |ACABA;  |FINSI;
     |FINSI;

     #71#31 = #104#25;
     #71#12 = #104#0;
     #71#21 = 1;
     |LEE 040#71];
     |SI FSalida ! 0;  |O  #71#31 ! #104#25;  |O #71#12 ! #104#0;
         |DDEFECTO #71;
         #71#0 = 0;
     |FINSI;

     #10#52 = #71#29;
     #10#0  = #71#0;
     |LEE 040#10=;
     |SI FSalida ! 0;
         |DDEFECTO #10;
         #10#0 = 0;
     |FINSI;

     #134#49 = #10#53;
     #134#0  = #10#39;
     |LEE 040#134=;
     |SI FSalida = 0;  |ACABA;   |FINSI;

     aAlfa = #104#1 % -104;
     nAnyo = aAlfa;

     aAlfa = #104#1 % 402;
     nMes  = aAlfa;

     #101#14 = #104#25;
     #101#15 = #104#0;
     |LEE 040#101=;
     |SI FSalida = 0;
         #116#0  = #101#0;
         #116#1  = #101#1;
         #116#13 = #101#13;
         |LEE 040#116=;
         |SI FSalida ! 0;  |DDEFECTO #116;  |FINSI;

         fFecha = #101#1;
         aHora  = #101#13;

         |SI #101#18 ! "  ";  |Y #101#18 ! "00";
             aRepre = #101#18;
             nComis = #101#30;
             nBase  = #101#17;
             nCoste = #101#16;
             |HAZ GrabaPdteTecnico;
         |FINSI;

         |SI #101#29 ! "  ";  |Y #101#29 ! "00";
             aRepre = #101#29;
             nComis = #101#31;
             |SI #116#0 ! "      ";
                 nBase  = #116#80 + #116#85;
                 nCoste = #116#81;
             |SINO;
                 nBase  = #101#17;
                 nCoste = #101#16;
             |FINSI;
             |HAZ GrabaPdteTecnico;
         |FINSI;
     |SINO;
         |DDEFECTO #101;

         fFecha = "01.01.0000";
         aHora  = "";

         |SI #104#7  ! "  ";  |Y #104#7 ! "00";
             aRepre = #104#7;
             nComis = 1;
             |SI #104#25 ! "S1   ";  |Y #104#25 ! "H1   ";  |Y #104#25 ! "P1   ";
                 nComis = 3;
             |FINSI;
             nBase  = #104#45;
             nCoste = 0;
             |HAZ GrabaPdteTecnico;
         |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE agifa104;
     #104#1;
     1;
     "      ", 000001, "01.01.2003";
     "zzzzzz", 999999,      aHFecha;
     ;
     NULL, agifa104;
|FIN;

|PROCESO agifa134;
     |SI #0#7 = "A";
         nSalir = 0;
         |PARA nCampo = 8;  |SI nCampo [ 17;  |HACIENDO nCampo = nCampo + 1;
               |SI #134#7 = #0nCampo;  nSalir = 1;  |SAL;  |FINSI;
         |SIGUE;
         |SI nSalir = 0;  |ACABA;  |FINSI;
     |FINSI;

     |SI #0#7 = "D";
         |SI #134#7 < #0#18;  |O #134#7 > #0#19;  |ACABA;  |FINSI;
     |FINSI;

     |SI #0#0 = "A";
         nSalir = 0;
         |PARA nCampo = 1;  |SI nCampo [ 6;  |HACIENDO nCampo = nCampo + 1;
               |SI #134#49 = #0nCampo;  nSalir = 1;  |SAL;  |FINSI;
         |SIGUE;
         |SI nSalir = 0;  |ACABA;  |FINSI;
     |FINSI;

     |SI #134#7 = "  ";  |O #134#7 = "00";
         |ACABA;
     |FINSI;

     #59#14 = #134#49;
     #59#0  = #134#0;
     #59#1  = 1;
     |LEE 040#59];
     |SI FSalida ! 0;  |O  #59#14 ! #134#49;  |O  #59#0  ! #134#0;
         |DDEFECTO #59;
         #59#0 = 0;
     |FINSI;

     #10#52 = #59#15;
     #10#0  = #59#2;
     |LEE 040#10=;
     |SI FSalida ! 0;
         |DDEFECTO #10;
         #10#0 = 0;
     |FINSI;

     #71#29 = #10#52;
     #71#0  = #10#0;
     #71#1  = 1;
     |LEE 040#71];
     |SI FSalida ! 0;  |O  #71#29 ! #10#52;  |O  #71#0  ! #10#0;
         |DDEFECTO #71;
         #71#0 = 0;
     |FINSI;

     #73#28 = #71#31;
     #73#0  = #71#12;
     #73#1  = 1;
     |LEE 040#73];
     |SI FSalida ! 0;  |O  #73#28 ! #71#31;  |O  #73#0  ! #71#12;
         |DDEFECTO #73;
     |FINSI;

     #101#14 = #73#28;
     #101#15 = #73#0;
     |LEE 040#101=;
     |SI FSalida = 0;  |ACABA;  |FINSI;

     |SI #73#28 = "     ";  |Y #73#0 = 1;
         #73#0 = 0;
     |FINSI;

     #104#25 = #73#28;
     #104#0  = #73#0;
     |LEE 040#104=;
     |SI FSalida = 0;  |Y #73#0 ! 0;
         |SI #104#1 < "01.01.2003";  |ACABA;  |FINSI;

         aAlfa = #104#1 % -104;
         nAnyo = aAlfa;

         aAlfa = #104#1 % 402;
         nMes  = aAlfa;
     |SINO;
         |SI #134#1 < "01.01.2003";  |ACABA;  |FINSI;

         aAlfa = #134#1 % -104;
         nAnyo = aAlfa;

         aAlfa = #134#1 % 402;
         nMes  = aAlfa;
     |FINSI;

     #25#0 = #134#7;
     |LEE 040#25=;
     |SI FSalida ! 0;  |DDEFECTO #25;  |FINSI;

     #109#0 = #25#0;
     #109#5 = nAnyo;
     |LEE 040#109=;
     |SI FSalida ! 0;  |DDEFECTO #109;  |FINSI;

     |SI #109#9 = "P";  nMes = 99;  |FINSI;

     #110#0  = nAnyo;
     #110#1  = nMes;
     #110#2  = #134#7;
     |LEE 101#110=;
     |SI FSalida ! 0;
         |DDEFECTO #110;
         #110#0  = nAnyo;
         #110#1  = nMes;
         #110#2  = #134#7;
         #110#3  = #25#1;
         |GRABA 020#110n;
         |LIBERA #110;
     |FINSI;

     #111#0  = #110#0;
     #111#1  = #110#1;
     #111#2  = #110#2;
     #111#3  = "F";
     #111#4  = #134#49;
     #111#5  = #134#0;
     |LEE 101#111=;
     |SI FSalida ! 0;
         |DDEFECTO #111;
         #111#0  = #110#0;
         #111#1  = #110#1;
         #111#2  = #110#2;
         #111#3  = "F";
         #111#4  = #134#49;
         #111#5  = #134#0;
         |GRABA 020#111b;
     |FINSI;

     #300#105 = #10#52;
     #300#106 = #10#0;
     |LEE 040#300=;
     |SI FSalida ! 0;  |DDEFECTO #300;  |FINSI;

     nCoste = #300#123;

     |SI #300#123 = 0;
         #122#0 = #134#49;
         #122#1 = #134#0;
         |LEE 040#122=;
         |SI FSalida ! 0;  |DDEFECTO #122;  |FINSI;

         nCoste = #122#7;
     |FINSI;

     #111#6  = #134#1;
     #111#7  = 1;
     |SI #134#49 ! "S1   ";  |Y #134#49 ! "H1   "; |Y #134#49 ! "P1   ";
         #111#7  = 3;
     |FINSI;
     #111#8  = #134#2;
     #111#9  = #134#3;
     #111#10 = "00.00.0000";
     #111#11 = "";
     #111#12 = #73#28;
     #111#13 = #73#0;
     #111#14 = #10#52;
     #111#15 = #10#0;
     #111#16 = #134#49;
     #111#17 = #134#0;
     #111#18 = #134#101;
     #111#19 = #134#91 + #134#94 + #134#97 + #134#102 + #134#105 + #134#47;
     #111#20 = nCoste;
     #111#21 = #111#19 - #111#20;

     |GRABA 020#111a;
     |LIBERA #111;
|FPRC;

|DEFBUCLE agifa134;
     #134#4;
     ;
          aHFecha, "zzzzz", 999999, "      ";
     "01.01.0000", "     ", 000000, "zzzzzz";
     ;
     NULL, agifa134;
|FIN;

|PROCESO dscam004;
     |SI #204#5 ! "IMP";
         #111#22 = #111#22 + #204#26;
     |SINO;
         #111#23 = #111#23 + #204#27;
     |FINSI;
|FPRC;

|DEFBUCLE dscam004;
     #204#2;
     ;
     #203#27, #203#0, #203#1, #203#2, 01;
     #203#27, #203#0, #203#1, #203#2, 99;
     ;
     NULL, dscam004;
|FIN;

|PROCESO dscam003;
     |SI #203#14 ! "P";  |Y #203#14 ! "C";
         #110#21 = #110#21 + #203#30;
         #111#24 = #111#24 + #203#30;
     |SINO;
         #110#21 = #110#21 + #203#23;
         #111#24 = #111#24 + #203#23;
     |FINSI;

     |BUCLE dscam004;

     |SI #111#22 = 0;  |Y #111#23 = 0;
         |SI #203#14 ! "P";  |Y #203#14 ! "C";
             #111#22 = #111#22 + #203#30;
         |SINO;
             #111#22 = #111#22 + #203#23;
         |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE dscam003;
     #203#6;
     ;
     00, #111#16, #111#17, 001, " ", 1;
     99, #111#16, #111#17, 999, "z", 999999999;
     ;
     NULL, dscam003;
|FIN;

|PROCESO diam0011;
     |SI #111#3 = "0";  |O #111#3 = "1";  |O #111#3 = "2";
      |O #111#3 = "3";  |O #111#3 = "4";  |O #111#3 = "5";
      |O #111#3 = "6";  |O #111#3 = "7";  |O #111#3 = "8";
      |O #111#3 = "9";
         |SI #111#4 = "zz   ";
             |SI #111#3 = "1";  #110#31 = #110#31 + #111#21;  |FINSI;
             |SI #111#3 = "2";  #110#32 = #110#32 + #111#21;  |FINSI;
             |SI #111#3 = "3";  #110#33 = #110#33 + #111#21;  |FINSI;

             #110#20 = #110#20 + #111#21;
             #110#21 = #110#21 + #111#21;
             #111#22 = #111#21;
             #111#24 = #111#21;
         |SINO;
             |SI #111#3 = "1";  #110#23 = #110#23 + #111#21;  |FINSI;
             |SI #111#3 = "2";  #110#25 = #110#25 + #111#21;  |FINSI;
             |SI #111#3 = "3";  #110#27 = #110#27 + #111#21;  |FINSI;
         |FINSI;
     |SINO;
         |SI #111#7 = 1;  #110#5  = #110#5  + #111#21;  |FINSI;
         |SI #111#7 = 2;  #110#9  = #110#9  + #111#21;  |FINSI;
         |SI #111#7 = 3;  #110#13 = #110#13 + #111#21;  |FINSI;

         #110#20 = #110#20 + #111#18;

         #111#22 = 0;
         #111#23 = 0;
         #111#24 = 0;

         |BUCLE dscam003;
     |FINSI;

     |SI #111#18 < 0;  |Y #111#24 = 0;
         #110#20 = #110#20 + #111#18;
         #110#21 = #110#21 + #111#18;
         #111#22 = #111#18;
         #111#24 = #111#18;
     |FINSI;

     |GRABA 020#111a;
     |LIBERA #111;
|FPRC;

|DEFBUCLE diam0011;
     #111#1;
     ;
     #110#0, #110#1, #110#2, " ", "     ", 000000;
     #110#0, #110#1, #110#2, "z", "zzzzz", 999999;
     be;
     NULL, diam0011;
|FIN;

|PROCESO diam0010;
     #110#23 = 0;  #110#5  = 0;  #110#6  = 0;  #110#31 = 0;
     #110#25 = 0;  #110#9  = 0;  #110#10 = 0;  #110#32 = 0;
     #110#27 = 0;  #110#13 = 0;  #110#14 = 0;  #110#33 = 0;
     #110#20 = 0;  #110#21 = 0;

     #109#0 = #110#2;
     #109#5 = #110#0;
     |LEE 040#109=;
     |SI FSalida ! 0;  |DDEFECTO #109;  |FINSI;

     #114#0 = #110#0;
     #114#1 = #110#1;
     #114#2 = #110#2;
     |LEE 101#114=;
     |SI FSalida ! 0;
         #114#0 = #110#0;
         #114#1 = #110#1;
         #114#2 = #110#2;
         #114#3 = #109#1;
         #114#4 = #109#2;
         #114#5 = #109#3;
         #114#6 = #109#4;
         |GRABA 020#114b;
     |FINSI;

     |SI #109#9 = "P";
         #114#3 = #109#1;
         #114#4 = #109#2;
         #114#5 = #109#3;
         #114#6 = #109#4;
     |FINSI;
     |GRABA 020#114a;
     |LIBERA #114;

     #110#4  = #114#6;
     #110#7  = #114#3;
     #110#11 = #114#4;
     #110#15 = #114#5;

     |BUCLE diam0011;

     #110#35 = #110#23 + #110#31 + #110#5;
     #110#36 = #110#25 + #110#32 + #110#9;
     #110#37 = #110#27 + #110#33 + #110#13;

     #110#24 = #110#31 + #110#5;
     #110#26 = #110#32 + #110#9;
     #110#28 = #110#33 + #110#13;

     #110#17 = #110#5  + #110#9  + #110#13;
     #110#29 = #110#23 + #110#25 + #110#27;
     #110#34 = #110#31 + #110#32 + #110#33;
     #110#30 = #110#24 + #110#26 + #110#28;
     #110#38 = #110#35 + #110#36 + #110#37;

     nBaseS = 0;
     |SI #109#6 = "S";  nBaseS = nBaseS + #110#24;  |FINSI;
     |SI #109#7 = "S";  nBaseS = nBaseS + #110#26;  |FINSI;
     |SI #109#8 = "S";  nBaseS = nBaseS + #110#28;  |FINSI;

     #110#18 = nBaseS - #110#4;
     |SI #110#18 < 0;  #110#18 = 0;  |FINSI;

     |SI #110#24 ! 0;
         |SI #109#6 = "S";
             #110#6  = (#110#18 * #110#24) / nBaseS;
         |FINSI;
     |FINSI;

     |SI #110#26 ! 0;
         |SI #109#7 = "S";
             |SI #110#28 = 0;  |O #109#8 = "N";
                  #110#10 = #110#18 - #110#6;
             |SINO;
                  #110#10 = (#110#18 * #110#26) / nBaseS;
             |FINSI;
         |FINSI;
     |FINSI;

     |SI #110#28 ! 0;
         |SI #109#8 = "S";
             #110#14 = #110#18 - #110#6 - #110#10;
         |FINSI;
     |FINSI;

     |SI #110#24 ! 0;
         |SI #109#6 = "N";  #110#6  = #110#24;  |FINSI;
     |FINSI;

     |SI #110#26 ! 0;
         |SI #109#7 = "N";  #110#10 = #110#26;  |FINSI;
     |FINSI;

     |SI #110#28 ! 0;
         |SI #109#8 = "N";  #110#14 = #110#28;  |FINSI;
     |FINSI;

     #110#18 = #110#6 + #110#10 + #110#14;

     #110#8  = #110#6  % #110#7;
     #110#12 = #110#10 % #110#11;
     #110#16 = #110#14 % #110#15;

     #110#19 = #110#8 + #110#12 + #110#16;

     |SI #110#19 < 0;  #110#19 = 0;  |FINSI;

     #110#22 = (#110#21 / #110#20) * #110#19;

     |SI #110#22 > #110#19;  #110#22 = #110#19;  |FINSI;

     |SI #110#1 = "99";
         |SI #110#0 < #0#20;
             #110#39 = "HASTA EL MES DE DICIEMBRE";
         |SINO;
             #110#39 = "HASTA EL MES " + #0#22;
         |FINSI;
     |SINO;
         |SI #110#1 = 1;   #110#39 = "MES DE ENERO     ";  |FINSI;
         |SI #110#1 = 2;   #110#39 = "MES DE FEBRERO   ";  |FINSI;
         |SI #110#1 = 3;   #110#39 = "MES DE MARZO     ";  |FINSI;
         |SI #110#1 = 4;   #110#39 = "MES DE ABRIL     ";  |FINSI;
         |SI #110#1 = 5;   #110#39 = "MES DE MAYO      ";  |FINSI;
         |SI #110#1 = 6;   #110#39 = "MES DE JUNIO     ";  |FINSI;
         |SI #110#1 = 7;   #110#39 = "MES DE JULIO     ";  |FINSI;
         |SI #110#1 = 8;   #110#39 = "MES DE AGOSTO    ";  |FINSI;
         |SI #110#1 = 9;   #110#39 = "MES DE SEPTIEMBRE";  |FINSI;
         |SI #110#1 = 10;  #110#39 = "MES DE OCTUBRE   ";  |FINSI;
         |SI #110#1 = 11;  #110#39 = "MES DE NOVIEMBRE ";  |FINSI;
         |SI #110#1 = 12;  #110#39 = "MES DE DICIEMBRE ";  |FINSI;
     |FINSI;

     |GRABA 020#110a;
     |LIBERA #110;

     |SI #110#22 > 0;
         #999#0 = #110#2;
         |LEE 101#999=;
         |SI FSalida ! 0;
             |DDEFECTO #999;
             #999#0 = #110#2;
             #999#4 = 0;
             |GRABA 020#999b;
         |FINSI;

         #999#4 = #999#4 + #110#22;
         |GRABA 020#999a;
         |LIBERA #999;
     |FINSI;
|FPRC;

|DEFBUCLE diam0010;
     #110#1;
     ;
     0000, 01, "  ";
     9999, 99, "zz";
     be;
     NULL, diam0010;
|FIN;

|PROCESO CreaLiquida;
     #112#0 = #999#0;
     |LEE 101#112=;
     |SI FSalida ! 0;
         |DDEFECTO #112;
         #112#0 = #999#0;
         |GRABA 020#112b;
     |FINSI;

     #113#0 = #112#0;
     #113#1 = 99999;
     |LEE 040#113];
     |SI FSalida = 0;
         |LEE 040#113a;
     |SINO;
         |LEE 040#113u;
     |FINSI;

     nLinea = 0;
     |SI FSalida = 0;  |Y #113#0 = #112#0;
         nLinea = #113#1;
     |FINSI;

     |SI #112#4 ! 0;
         #113#0 = #112#0;
         #113#1 = #112#4;
         |LEE 040#113=;
         |SI FSalida = 0;
             nLinea = nLinea + 1;
             #113#1 = nLinea;
             #113#2 = ~;
             #113#4 = -#113#4;
             #113#5 = "CALCULO";
             #113#6 = "";
             |GRABA 020#113n;
             |LIBERA #113;

             #112#1 = #112#1 + #113#4;
         |FINSI;
     |FINSI;

     nLinea = nLinea + 1;
     |DDEFECTO #113;
     #113#0 = #112#0;
     #113#1 = nLinea;
     #113#2 = ~;
     #113#3 = "D";
     #113#4 = #999#4;
     #113#5 = "CALCULO";
     #113#6 = "";
     |GRABA 020#113n;
     |LIBERA #113;

     #112#1 = #112#1 + #113#4;
     #112#3 = #112#1 - #112#2;
     #112#4 = nLinea;
     #112#5 = ~;
     |GRABA 020#112a;
     |LIBERA #112;
|FPRC;

|DEFBUCLE refere01;
     #999#1002;
     ;
     2003, "  ";
     2999, "zz";
     ;
     NULL, CreaLiquida;
|FIN;

|PROCESO dscam045;
     nEmpresaCart = #245#6;
     |ERROR10;
|FPRC;

|DEFBUCLE dscam045;
     #245#1;
     2;
     nEmpresaFact, 001, "V";
     nEmpresaFact, 999, "V";
     ;
     NULL, dscam045;
|FIN;

|PROCESO agifa025;
     #109#0 = #25#0;
     #109#5 = #0#20;
     |LEE 101#109=;
     |SI FSalida ! 0;
         |DDEFECTO #109;
         #109#0 = #25#0;
         #109#5 = #0#20;
         #109#1 = 3;
         #109#2 = 0;
         #109#3 = 0;
         #109#4 = 3000;
         |GRABA 020#109n;
     |FINSI;
     |LIBERA #109;
|FPRC;

|DEFBUCLE agifa025;
     #25#1;
     ;
     "  ";
     "zz";
     ;
     NULL, agifa025;
|FIN;

|PROCESO diam0011B;
     |SI #0#0 = "A";
         nSalir = 0;
         |PARA nCampo = 1;  |SI nCampo [ 6;  |HACIENDO nCampo = nCampo + 1;
               |SI #111#4 = #0nCampo;  nSalir = 1;  |SAL;  |FINSI;
         |SIGUE;
         |SI nSalir = 0;  |ACABA;  |FINSI;
     |FINSI;

     |SI #0#7 = "A";
         nSalir = 0;
         |PARA nCampo = 8;  |SI nCampo [ 17;  |HACIENDO nCampo = nCampo + 1;
               |SI #111#2 = #0nCampo;  nSalir = 1;  |SAL;  |FINSI;
         |SIGUE;
         |SI nSalir = 0;  |ACABA;  |FINSI;
     |FINSI;

     |SI #0#7 = "D";
         |SI #111#2 < #0#18;  |O #111#2 > #0#19;  |ACABA;  |FINSI;
     |FINSI;

     |BORRA 020#111a;
     |LIBERA #111;

     #110#0 = #111#0;
     #110#1 = #111#1;
     #110#2 = #111#2;
     |LEE 101#110=;
     |SI FSalida  = 0;
         |BORRA 020#110a;
         |LIBERA #110;
     |FINSI;
|FPRC;

|DEFBUCLE diam0011B;
     #111#1;
     6;
     0000, 00, "  ", " ", "     ", 000000, "01.01.2003";
     9999, 99, "zz", "z", "zzzzz", 999999,      aHFecha;
     be;
     NULL, diam0011B;
|FINSI;

|PROCESO diam0010B;
     #111#0 = #110#0;
     #111#1 = #110#1;
     #111#2 = #110#2;
     #111#3 = " ";
     #111#4 = "     ";
     #111#5 = 0;
     |LEE 040#111];
     |SI FSalida = 0; |Y #111#0 = #110#0; |Y #111#1 = #110#1; |Y #111#2 = #110#2;
         |ACABA;
     |FINSI;

     |BORRA 020#110a;
     |LIBERA #110;
|FPRC;

|DEFBUCLE diam0010B;
     #110#1;
     ;
     0000, 00, "  ";
     9999, 99, "zz";
     be;
     NULL, diam0010B;
|FINSI;

|PROCESO Tipo3;  |TIPO 3;
     |ABRE #109;
     |BUCLE agifa025;
     |CIERRA #109;

     aHFecha = "31." + (("00" + #0#21) % -102) + "." + #0#20;

     |ABRE #110;
     |BUCLE diam0011B;
     |CIERRA #110;

     |ABRE #111;
     |BUCLE diam0010B;
     |CIERRA #111;

     |ABRE #109;
     |ABRE #110;
     |ABRE #111;
     |ABRE #116;
     |ABRE #73;
     |ABRE #71;
     |ABRE #10;
     |ABRE #25;
     |ABRE #134;
     |ABRE #104;
     |SELECT #4#71;

     |BUCLE diam0001;              || Lectura de Prepedidos
     |CIERRA #104;

     |ABRE #101;
     |SELECT #2#101;

     |BUCLE agifa104;              || Lectura de los Pedidos

     |CIERRA #116;
     |CIERRA #134;

     |ABRE #59;
     |ABRE #104;
     |ABRE #300;
     |ABRE #122;

     |SELECT #2#300;
     |SELECT #1#71;

     |BUCLE agifa134;              || Lectura de Facturas

     |CIERRA #104;
     |CIERRA #73;
     |CIERRA #71;
     |CIERRA #10;
     |CIERRA #25;
     |CIERRA #59;
     |CIERRA #101;
     |CIERRA #111;
     |CIERRA #300;
     |CIERRA #122;

     |DBASS aBase;  |QBF aBase;
     aPathFich = aBase + "dscarter/fich/";
     |PATH_DAT #245 aPathFich;

     nEmpresaFact = #48#0;
     nEmpresaCart = 0;
     |BUCLE dscam045;

     aPathFich = aBase + "dscarter/fich/" + (("00000" + nEmpresaCart) % -105) + "/";
     |PATH_DAT #203 aPathFich;
     |PATH_DAT #204 aPathFich;

     |DBASE aBase;   |QBF aBase;
     aMas = aBase + "def/diam0009.mas";
     |CARGA_DEF aMas, refere01@;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |HAZ CreaTempo;
     |NOME_DAT #999 Tempo;  |DELINDEX #999;

     |ABRE #114;
     |ABRE #999;
     |BUCLE diam0010;
     |CIERRA #114;
     |CIERRA #999;

     |ABRE #112;
     |ABRE #113;
     |BUCLE refere01;
     |CIERRA #112;
     |CIERRA #113;
     |CIERRA #109;

     |DELINDEX #999;
     |HAZ BoraTempo;
|FPRC;
