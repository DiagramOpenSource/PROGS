|FICHEROS;
     marhu358 #0; ||Este Def.
     marhu359 #1; ||Temporal.
     agifa010 #2; ||Albaranes.
     agifa025 #3; ||Representantes
     marhu371 #371;      ||Grupos Series (CAB)
     marhu372 #372;      ||Grupos Series (LIN)
     agifa134;      || facturas ventas cabs.
|FIN;

|VARIABLES;
     &Tempo = "";
     aTempo1 = "";
     nSal  = 0;
     aFich = "";
     nAno  = 0;
     nMes  = 0;
     aMes  = "";
     tMes  = 0;
     aEmp  = "";
     swAno = 0;
     swImp = 0;
     i = 0;
     aDesdeSer = "";
     aHastaSer = "";
     nSwRup = 0;
     &enBlanco = 0;
     aAntRep = "";
|FIN;

|PROCESO Defecto; |TIPO 7;    || calcula el a¤o por defecto segun sistema
     |VARIABLES;
          fFech1 = @;
          aAlfa1 = "";
     |FIN;
     fFech1 = ~;
     aAlfa1 = fFech1;
     aAlfa1 = aAlfa1 % -104;
     #0Campo = aAlfa1;
     |PINTA #0Campo;
|FPRC;

|PROCESO regulariza;
     |DDEFECTO #1;
     #1#0 = #3#0;
     #1#1 = #0#2;
     |LEE 000#1=;
     |SI FSalida ! 0;
          |GRABA 020#1n;
     |FINSI;
|FPRC;

|DEFBUCLE regulariza;
     #3#1;
     ;
     #0#0;
     #0#1;
     ;
     NULL,regulariza;
|FIN;

|PROCESO marhu359;
     |SI nSwRup = 0;
          aAntRep = #1#0;
          nSwRup = 1;
     |FINSI;
     |SI aAntRep ! #1#0;
          aAntRep = #1#0;

          enBlanco = 1;
          |PRINT;
          enBlanco = 0;
     |FINSI;

     |PRINT;
     swImp = 1;
|FPRC;

|DEFBUCLE marhu359;
     #1#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL,marhu359;
|FIN;

|PROCESO marhu372;
     |SI #marhu372#2 = #agifa010#52;
          |HAZ Principal;
          |ERROR10;
     |FINSI;
|FPRC;

|DEFBUCLE marhu372;
 #marhu372#1;
 ;
 #marhu358#45, 001;
 #marhu358#45, 999;
 ;
 NULL, marhu372;
|FIN;

|PROCESO agifa010;
     ||TODO CCC
     |SI #0#46 = "P";
          ||Comprobar uno a uno todas las series
          |PARA i = 49; |SI i [ 58; |HACIENDO i = i + 1;
               |SI #marhu358#i# = #agifa010#52; |Y #marhu358#i# ! ".    ";
                    |HAZ Principal;
                    |SAL;
               |FINSI;
          |SIGUE;
     |SINO;
          |SI #0#46 = "G";
               ||Ver si la serie pertenece al grupo
               |BUCLE marhu372;
          |SINO;         ||(L)imites
               |HAZ Principal;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Fecha;
     #agifa134#49 = #agifa010#53;
     #agifa134#0 = #agifa010#39;
     |LEE 000#agifa134.=;
     |SI FSalida = 0;
          aMes = #agifa134#1 % 402;     || fecha factura
     |SINO;
          aMes = #agifa010#1 % 402;     || fecha albaran
     |FINSI;

     nMes = aMes;
     tMes = aMes;
     nMes = aMes + 1;
|FPRC;

|PROCESO Principal;
     |DDEFECTO #1;
     #1#0 = #2#6;
     #1#1 = #0#2;
     |LEE 000#1=;
     nSal = FSalida;
     |HAZ Fecha;
     #1nMes = #1nMes + #2#15;
     #1#14  = #1#14  + #2#15;
     |SI nSal = 0; |GRABA 020#1a; |FINSI;
     |SI nSal ! 0; |GRABA 020#1n; |FINSI;
     tMes = tMes + swAno;
     #0tMes = #0tMes + #2#15;
     tMes = swAno + 13;
     #0tMes = #0tMes + #2#15;
|FPRC;

|DEFBUCLE agifa010;
     #2#1;
     6, 38;
     aDesdeSer, 000001, #0#0, "S";
     aHastaSer, 999999, #0#1, "S";
     ;
     NULL,agifa010;
|FIN;

|PROCESO ejec; |TIPO 3;
     |IMPRE 0;
     |SI FSalida ! 0; |ACABA; |FINSI;
     |INFOR "marhu358";
     |SI FSalida ! 0; |FINIMP; |ACABA; |FINSI;
     |HAZ CreaTempo; aTempo1 = Tempo;
     |NOME_DAT #1 aTempo1; |DELINDEX #1;
     |ABRE #1;
     |ABRE #agifa134;
     swAno = 10;
     #0#24 = #0#2;
     |SI #0#46 = "L";
          aDesdeSer = #0#47;
          aHastaSer = #0#48;
     |SINO;
          aDesdeSer = "     ";
          aHastaSer = "zzzzz";
     |FINSI;
     |BUCLE agifa010;
     |BUCLE regulariza;
     |DBASE aFich;
     #0#2 = #0#2 - 1;
     #0#44 = #0#2;
     aEmp = #0#3;
     |QBF aEmp;
     aEmp = ("00000" + aEmp) % -105;
     aFich = aFich + "fich/" + aEmp + "/";
     |PATH_DAT #2 aFich;
     swAno = 30;
     ||TODO CCC
     |SI #0#46 = "L";
          aDesdeSer = #0#47;
          aHastaSer = #0#48;
     |SINO;
          aDesdeSer = "     ";
          aHastaSer = "zzzzz";
     |FINSI;
     |BUCLE agifa010;
     |BUCLE regulariza;
     |CIERRA #1;
     |CIERRA #agifa134;
     |BUCLE marhu359;
     |SI swImp = 1;
          |PIEINF;
     |FINSI;
     |FININF;
     |FINIMP;
     |DELINDEX #1;  Tempo = aTempo1; |HAZ BoraTempo;
|FPRC;

|PROCESO Serie; |TIPO 0;
     |SI #0#46 = "L";
          |C_M #0#47, 1, "S";
          |C_M #0#48, 2, "S";
          |PARA i = 49; |SI i [ 58; |HACIENDO i = i + 1;
               |C_M #0i, 1, "N";
          |SIGUE;
          |C_M #0#45, 1, "N";
     |SINO;
          |SI #0#46 = "P";
               |C_M #0#47, 1, "N";
               |C_M #0#48, 2, "N";
               |PARA i = 49; |SI i [ 58; |HACIENDO i = i + 1;
                    |C_M #0i, 1, "S";
               |SIGUE;
               |C_M #0#45, 1, "N";
          |SINO;              ||(G)rupo
               |C_M #0#47, 1, "N";
               |C_M #0#48, 2, "N";
               |PARA i = 49; |SI i [ 58; |HACIENDO i = i + 1;
                    |C_M #0i, 1, "N";
               |SIGUE;
               |C_M #0#45, 1, "S";
          |FINSI;
     |FINSI;
|FPRC;
