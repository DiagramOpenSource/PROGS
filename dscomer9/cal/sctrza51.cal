     CreaReciCartera, CreaReci, BorraReci, ChequeaReci

|FICHEROS;
     sctrm035 #35;
     sctrm036 #36;
     sctrm054 #54;
     sctrm056 #56;
     dscam001@;
     dscam003@;
     dscam044@;
     dscam045@;
|FIN;

|VARIABLES;
     &eaConMensa = "S";
     &enError = 0;
     aBase = "";
     aAlfa = "";
     aEmp = "";
     nEmpresa = 0;
     nNum = 0;
     nSwBorraRec = 0;
|FIN;

|PROCESO CreaRecibos;
     #36#1 = #54#3;
     |LEE 000#36=;
     |SI FSalida ! 0; |DDEFECTO #36; |FINSI;

     aAlfa = ("0000" + #36#62) % -104;
     |DDEFECTO #dscam001@;
     #dscam001@#0 = aAlfa;
     |LEE 000#dscam001@.=;

     |SI #56#7 ! 0;
          #dscam003@#40 = #56#7;
          |LEE 101#dscam003@.=;
     |SINO;
          FSalida = "1";
     |FINSI;
     |SI FSalida ! 0;
          |LEE 000#dscam003@.u;
          |SI FSalida = 0;
               nNum = #dscam003@#40 + 1;
          |SINO;
               nNum = 1;
          |FINSI;
          |DDEFECTO #dscam003@;
          #dscam003@#40 = nNum;
          |GRABA 020#dscam003@.b;
     |FINSI;
     #dscam003@#0 = #56#0;
     #dscam003@#1 = #56#1;
     #dscam003@#2 = #56#2;
     #dscam003@#3 = #56#3;
     #dscam003@#4 = #54#2;
     #dscam003@#5 = #36#13;
     #dscam003@#6 = #54#4;
     #dscam003@#7 = #dscam001@#1;
     #dscam003@#8 = #36#53;
     #dscam003@#9 = #36#54;
     #dscam003@#10 = #36#56;
     #dscam003@#11 = #36#55;
     #dscam003@#12 = #35#69;
     #dscam003@#14 = "P";
     #dscam003@#15 = "Pendiente de Cobro";

     #dscam003@#22 = #54#9;
     #dscam003@#30 = #54#8;
     #dscam003@#31 = #54#8;
     #dscam003@#32 = #36#1;
     ||#dscam003@#33 =        ||repre
     ||#dscam003@#34 =
     #dscam003@#46 = nEmpresa;
     #dscam003@#57 = "EUR";
     #dscam003@#58 = "EURO";
     #dscam003@#59 = 1;
     #dscam003@#60 = #54#9;
     #dscam003@#64 = #54#9;
     #dscam003@#65 = #54#9;
     #dscam003@#80 = #35#0;
     #dscam003@#81 = #35#1;
     #dscam003@#91 = 1;
     #dscam003@#92 = "";
     |GRABA 020#dscam003@.a;

     #56#6 = aEmp;
     #56#7 = #dscam003@#40;
     |GRABA 020#56a;
|FPRC;

|DEFBUCLE CreaRecibos;
     #56#1;
     ;
     #54#0, #54#1, 001;
     #54#0, #54#1, 999;
     be;
     NULL, CreaRecibos;
|FIN;

|PROCESO dscam045;
     |SI #54#0 ] #dscam045@#4; |Y #54#0 [ #dscam045@#5;
          aEmp = ("00000" + #dscam045@#6) % -105;
          aAlfa = aBase + "dscarter/fich/" + aEmp + "/";
          |PATH_DAT #dscam001@#aAlfa#;
          |PATH_DAT #dscam003@#aAlfa#;
          #dscam044@#0 = #dscam045@#0;
          |LEE 020#dscam044@.=;
          |SI FSalida = 0;
               |ABRE #dscam003@;
               |ABRE #dscam001@;
               |ABRE #36;
               |BUCLE CreaRecibos;
               |CIERRA #36;
               |CIERRA #dscam001@;
               |CIERRA #dscam003@;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE dscam045;
     #dscam045@#1002;
     2;
     nEmpresa, 001, "V";
     nEmpresa, 999, "V";
     ;
     NULL, dscam045;
|FIN;

|PROCESO CreaReciCartera;
     |DBASS aBase;
     aAlfa = aBase + "dscarter/def/dscam045";
     |CARGA_DEF aAlfa, dscam045@;
     |SI FSalida = 0;
          aAlfa = aBase + "dscarter/def/dscam044";
          |CARGA_DEF aAlfa, dscam044@;
          |SI FSalida = 0;
               aAlfa = aBase + "dscarter/def/dscam003";
               |CARGA_DEF aAlfa, dscam003@;
               |SI FSalida = 0;
                    aAlfa = aBase + "dscarter/def/dscam001";
                    |CARGA_DEF aAlfa, dscam001@;
                    |SI FSalida = 0;
                         |DFICE aAlfa;
                         aAlfa = aAlfa % -205;
                         nEmpresa = aAlfa;
                         aAlfa = aBase + "dscarter/fich/";
                         |PATH_DAT #dscam044@#aAlfa#;
                         |PATH_DAT #dscam045@#aAlfa#;
                         |ABRE #dscam044@;
                         |BUCLE dscam045;
                         |CIERRA #dscam044@;
                         |DESCARGA_DEF #dscam001@;
                    |FINSI;
                    |DESCARGA_DEF #dscam003@;
               |FINSI;
               |DESCARGA_DEF #dscam044@;
          |FINSI;
          |DESCARGA_DEF #dscam045@;
     |FINSI;
|FPRC;
=============================================
|VARIABLES;
     i = 0;
     fFechaFac = @;
     fFecha = @;
     fFecha1 = @;
     fAntes = @;
     fFecVto = @;
     nVtos = 0;
     nImpo = 0;
     nImpVto = 0;
     aDia = "";
     aMes = "";
     nMesNoPago = 0;
     nDiaPago = 0;
     nMesPago = 0;
     nMesAnt = 0;
     nNume = 0;
     nDia1 = 0;
     nDia2 = 0;
     nDia3 = 0;
     nCamFPago = 0;
     nEntero = 0;
     nResto = 0;
     nAbono = 0;
     nDias = 0;
     nMult = 0;
|FIN;

|PROCESO Cambios;
     fFecha1 = fFecha;
     aDia = fFecha1 % 102;
     aMes = fFecha1 % 402;
     nDiaPago = aDia;
     nMesPago = aMes;
|FPRC;

|PROCESO DiasFijos;
     |SI nDia1 = 0;
          |VETE FinFijos;
     |FINSI;
     |HAZ Cambios;
     |SI nDiaPago > nDia1;
          |VETE  Fijos2;
     |FINSI;

  |ET Fijos1;
     |SI nDiaPago = nDia1;
          |VETE FinFijos;
     |FINSI;

     |HAZ Cambios;
     fAntes = fFecha;
     nMesAnt = nMesPago;

     fFecha = fFecha + 1;
     |HAZ Cambios;

     || SI el dia fijo=30 y el vto es en Febrero y la fp a 30 dias
     nNume = nDias $ 30;
     |SI nDia1 = 30; |Y nMesAnt = 2; |Y nMesPago = 3; |Y nNume = 0;
          fFecha = fAntes;
          |VETE FinFijos;
     |FINSI;

     |VETE Fijos1;

  |ET Fijos2;
     |SI nDia2 = 0; |O nDiaPago [ nDia1;
          |VETE Fijos1;
     |FINSI;
     |SI nDiaPago > nDia2;
          |VETE Fijos3;
     |FINSI;
     |SI nDiaPago = nDia2;
          |VETE FinFijos;
     |FINSI;

     |HAZ Cambios;
     fAntes = fFecha;
     nMesAnt = nMesPago;

     fFecha = fFecha + 1;
     |HAZ Cambios;

     || SI el dia fijo=30 y el vto es en Febrero y la fp a 30 dias
     nNume = nDias $ 30;
     |SI nDia2 = 30; |Y nMesAnt = 2; |Y nMesPago = 3; |Y nNume = 0;
          fFecha = fAntes;
          |VETE FinFijos;
     |FINSI;

     |VETE Fijos2;

  |ET Fijos3;
     |SI nDia3 = 0;|O nDiaPago > nDia3; |O nDiaPago [ nDia1; |O nDiaPago [ nDia2;
          |VETE Fijos1;
     |FINSI;
     |SI nDiaPago = nDia3;
         |VETE FinFijos;
     |FINSI;

     |HAZ Cambios;
     fAntes = fFecha;
     nMesAnt = nMesPago;

     fFecha = fFecha + 1;
     |HAZ Cambios;

     || SI el dia fijo=30 y el vto es en Febrero y la fp a 30 dias
     nNume = nDias $ 30;
     |SI nDia3 = 30; |Y nMesAnt = 2; |Y nMesPago = 3; |Y nNume = 0;
          fFecha = fAntes;
          |VETE FinFijos;
     |FINSI;

     |VETE Fijos3;

  |ET FinFijos;
     fFecha1 = fFecha;
|FPRC;

|PROCESO Vencimientos;
     nDias = #35nCamFPago / nMult;
     |SI nDias ! 0; |O nDia1 ! 0; |O nDia2 ! 0; |O nDia3 ! 0;
          fFecha = fFechaFac + nDias;
          |HAZ DiasFijos;
          aMes = fFecha % 402;
          |SI aMes = nMesNoPago;          ||Si es mes de no pago...
               fFecha = fFecha + .001;
               fFechaFac = fFechaFac + .001;
               fFecha1 = fFecha;
          |FINSI;
          fFecVto = fFecha1;
          nImpVto = nImpo * nAbono;
          |SI i = nVtos;
               nImpVto = nImpVto + (nResto * nAbono);
          |FINSI;
     |SINO;
          aMes = fFechaFac % 402;
          |SI aMes = nMesNoPago;          ||Si es mes de no pago...
               fFechaFac = fFechaFac + .001;
          |FINSI;
          fFecVto = fFechaFac;
          nImpVto = nImpo * nAbono;
     |FINSI;
     nImpVto = nImpVto / 100;
|FPRC;

|PROCESO CreaReci;
     |ABRE #35;
     #35#0 = #54#5;
     |LEE 000#35=;
     |SI FSalida ! 0; |DDEFECTO #35; |FINSI;
     |CIERRA #35;

     nDia1 = 0; nDia2 = 0; nDia3 = 0; nMesNoPago = 0;
     nVtos = #35#3;
     fFechaFac = #54#2;
     nImpo = #54#9;
     |SI #35#5 = "N"; nMult = 1; |SINO; nMult = 1000; |FINSI;
     |SI nImpo < 0; nAbono = -1; |SINO; nAbono = 1; |FINSI;

     nImpo = (nImpo * nAbono * 100) ! 0;
     nResto = nImpo $ nVtos;
     nImpo = nImpo / nVtos;
     nEntero = nImpo ! 0;
     |SI nEntero ! nImpo;
          |SI nEntero > nImpo;
               nImpo = nEntero - 1;
          |SINO;
               nImpo = nEntero;
          |FINSI;
     |FINSI;
     |ABRE #56;
     |PARA i = 1; |SI i [ nVtos; |HACIENDO i = i + 1;
          |DDEFECTO #56;
          #56#0 = #54#0;
          #56#1 = #54#1;
          #56#2 = i;
          |LEE 101#56=;
          |SI FSalida ! 0; |GRABA 020#56b; |FINSI;
          nCamFPago = i + 5;
          |HAZ Vencimientos;
          #56#3 = fFecVto;
          #56#4 = nImpVto;
          |GRABA 020#56a;
          |LIBERA #56;
     |SIGUE;
     |LEE 101#56s;
     |PARA; |SI FSalida = 0; |Y #56#0 = #54#0; |Y #56#1 = #54#1; |HACIENDO;
          |BORRA 020#56a;
          |LIBERA #56;
          |LEE 101#56s;
     |SIGUE;
     |CIERRA #56;
|FPRC;

|PROCESO BMiraReci;
     aAlfa = aBase + "dscarter/fich/" + (("00000" + #56#6) % -105) + "/";
     |PATH_DAT #dscam003@#aAlfa#;

     |ABRE #dscam003@;
     #dscam003@#40 = #56#7;
     |SI nSwBorraRec = 1;
          |LEE 101#dscam003@.=;
          |SI FSalida = 0;
               |BORRA 020#dscam003@.a;
          |FINSI;
     |SINO;
          |LEE 000#dscam003@.=;
          |SI FSalida = 0;
               |SI #dscam003@#14 ! "P";
                    |SI eaConMensa = "S";
                         |MENAV "0000Recibo/s con movimiento/s...";
                    |FINSI;
                    enError = 1;
               |FINSI;
          |FINSI;
     |FINSI;
     |CIERRA #dscam003@;
|FPRC;

|DEFBUCLE BMiraReci;
     #56#1;
     ;
     #54#0, #54#1, 000;
     #54#0, #54#1, 999;
     ;
     NULL, BMiraReci;
|FIN;

|PROCESO MiraReci;
     enError = 0;
     |DBASS aBase;
     aAlfa = aBase + "dscarter/def/dscam003";
     |CARGA_DEF aAlfa, dscam003@;
     |SI FSalida = 0;
          |BUCLE BMiraReci;
          |DESCARGA_DEF #dscam003@;
     |FINSI;
|FPRC;

|PROCESO BorraReci;
     nSwBorraRec = 1;
     |HAZ MiraReci;
|FPRC;

|PROCESO ChequeaReci;
     nSwBorraRec = 0;
     |HAZ MiraReci;
|FPRC;
