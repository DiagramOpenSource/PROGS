|FICHEROS;
     gomaw002 #0;
     gomaw003 #1,MANTE;
     goenvm02 #2;
     goalbpa4 #4;
     goalbpa5 #5;
     goalbpa6 #6; || = gopartia
     gomantho #7;
     godiacaj #8;
     goparame #10;
     agifa017 #17;
     agifa019 #19;
     agifa024 #24;
     guerm025 #25;
     agifa027 #27;
     agifa029 #29;
     gopre004 #40;
     gomantl1 #41;
     guerw042 #42; || Tmp Salidas Auto
     guerm045 #45;
     guerm046 #46;  || Histo Sal Auto
     guerm047 #47;  || Adj Unidades
     guerz051 #51,MANTE;  || Tmp
     agifa077 #77;
     agifa080 #80;
     gotrabaj;
     guerm047@ #99; || Temporal
     agifa077@;     || Temporal
     guerw055 #55;  || Tmp Descripcion Ampliada
     dsm00082 #82;
     gopre003 #30;
     gopre001 #100;
     goma0001 #101;
     goma0002 #102;
     goma0003 #103;
     guerw019 #109;
     goparam5 #105;
     goartmer #9000;
     goprepec #9001;
     goprepel #9002;
     referen@;
     dserpm10@;
|FIN;

|INCLUYE i_varart;

|VARIABLES;
     aEmp = "";
     &eaErOb1 = ""; &eaErOb2 = ""; &eaErOb3 = ""; &eaErOb4 = "";
     &eaErOb5 = ""; &eaErOb6 = ""; &eaErOb7 = ""; &eaErOb8 = "";
     &eaErOb9 = ""; &eaErOb10 = ""; &eaErOb11 = ""; &eaErOb12 = "";
     &eaErOb13 = ""; &eaErOb14 = ""; &eaErOb15 = "";
     &enPreCosteF = 0;
     nSwForestales = 0;
     aEsOrden = "N";
     nSalMenu = 0;
     &eaAlmDepoPar = "";
     nPdte = 0;
     &eaFicMas = "";
     nBoton = 0;
     nSal = 0;
     &cCodMonTrab = "";
     aTempo55 = "";
     nLinDa = 0;
     nTecla = 0;
     i = 0;
     nHayPen = 0;
     nHay = 0;
     &Tempo = "";
     aTempo470 = "";
     aDef = "";
     ||----------------------
     &eaFicSalAuto = "";
     aParam = "";
     &eaSerExpSal = "";
     &enNumExpSal = 0;
     &eaSerPreSal = "";
     &enNumPreSal = 0;
     aSerAnt = "";
     nLinAuto = 0;
     ||--------------------------
     aSerPre = "";
     nNumPre = 0;
     nPreVta = 0;
     nPreCom = 0;
     nSwSale = 0;
     &enPrepe = 0;
     &enAlmaCompras = 0;
     &enAlmaDepo = 0;
     nGraba    = 0;
     nSwSal    = 0;
     &enEvento = 1;
     &eaAsunto = "";
     &eaOrigen = "";
     &eaTipoD  = "";
     aInforme = "gomaw002";
     aInforOr = "goma0001";
 {-1}Menua  = "";
     Menua1 = "2400";
     Menua2 = "1";
     Menua3 = " ";
     Menua4 = "RIOAC";
     Menua5 = " Repasar ";
     Menua6 = " Imprimir ";
     Menua7 = " Orden Carga ";
     Menua8 = " Aceptar ";
     Menua9 = " Cancelar ";
 {-1}Menub  = "";
     Menub1 = "2400";
     Menub2 = "1";
     Menub3 = " ";
     Menub4 = "RIAC";
     Menub5 = " Repasar ";
     Menub6 = " Imprimir ";
     Menub7 = " Aceptar ";
     Menub8 = " Cancelar ";
     nSwi  = 0;
     aAlfa = "";
     nConta = 0;
     nSwAct = 0;
     nLin = 0;
     &xDocTras      = 0;
     &xFecDocu      = @;
     &xLinDocu      = 0;
     &xCodArti      = "";
     &xDesArti      = "";
     &xSerie        = "";
     &xCanArti      = 0;
     &xAlmEntr      = 0;
     &xAlmSali      = 0;
     &xModo         = 0;
     &xForma        = 0;
     &enEnvio       = 0;
     &eaDestino     = "";
     &xCanArti2 = 0;
     &xMedida1 = 0;
     &xMedida2 = 0;
     &xMedida3 = 0;
     &eaArtiAnt = "";
     &xPartida = "";

     nPrecio        = 0;
     aArtic         = "";
     nAlmCen = 0;
     nAlmDep = 0;
|FIN;

|PROCESO PonPre;
     #0#7 = #41#3; |PINTA #0#7;
     #0#8 = #41#4; |PINTA #0#8;
     |ERROR10;
|FPRC;

|DEFBUCLE PonPre;
     #41#1;
     ;
     #0#1, #0#2, 001;
     #0#1, #0#2, 999;
     ;
     NULL, PonPre;
|FIN;

|PROCESO PonPre0; |TIPO 0;
     |BUCLE PonPre;

     |HAZ EsForestales;
     |SI FSalida = 0;
          |C_M #0#7, 1, "S";
          |C_M #0#8, 1, "S";
     |SINO;
          |C_M #0#7, 1, "N";
          |C_M #0#8, 1, "N";
     |FINSI;
|FPRC;

|PROCESO ExpLin;
     #100#0 = #41#3;
     #100#1 = #41#4;
     |LEE 000#100=;
     |SI FSalida = 0;
          |SALVA_DATOS #100;
          |REPON_DATOS #referen@;
          |GRABA 020#referen@.n;
     |FINSI;
|FPRC;

|DEFBUCLE ExpLin;
     #41#1;
     ;
     #0#1, #0#2, 001;
     #0#1, #0#2, 999;
     ;
     NULL, ExpLin;
|FIN;

|PROCESO Presu66; |TIPO 66;
     |DDEF aAlfa;
     aAlfa = aAlfa + "gopre001";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          aAlfa = Usuario;
          |NOME_DAT #referen@#aAlfa#; |DELINDEX #referen@;
          |ABRE #referen@;
          |ABRE #100;
          |BUCLE ExpLin;
          |CIERRA #100;
          #referen@#0 = #0#7;
          #referen@#1 = #0#8;
          |LEE 000#referen@.];
          |CONSULTA_CLAVE #1#referen@;
          |SI FSalida = 0;
               #0#7 = #referen@#0; |PINTA #0#7;
               #0#8 = #referen@#1; |PINTA #0#8;
          |SINO;
               |ERROR;
          |FINSI;
          |CIERRA #referen@;
          |DELINDEX #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|PROCESO ObsDerp;
     |DFICE aEmp;
     aEmp = aEmp % -205;
     |DBASS aAlfa;
     aAlfa = aAlfa + "dserp/def/dserpm10";
     |CARGA_DEF aAlfa, dserpm10@;
     |SI FSalida = 0;
          |DBASS aAlfa;
          aAlfa = aAlfa + "dserp/fich/";
          |PATH_DAT #dserpm10@#aAlfa#;

          aAlfa = #1#0;
          |DDEFECTO #dserpm10@;
          |ABRE #dserpm10@;
          #dserpm10@#19 = "dscomer9";
          #dserpm10@#18 = aEmp;
          #dserpm10@#0 = "gomaw003";
          #dserpm10@#1 = aAlfa;
          |LEE 000#dserpm10@.=;
          || #dserpm10@#2 esta vacio
          eaErOb1 = #dserpm10@#3;
          eaErOb2 = #dserpm10@#4;
          eaErOb3 = #dserpm10@#5;
          eaErOb4 = #dserpm10@#6;
          eaErOb5 = #dserpm10@#7;
          eaErOb6 = #dserpm10@#8;
          eaErOb7 = #dserpm10@#9;
          eaErOb8 = #dserpm10@#10;
          eaErOb9 = #dserpm10@#11;
          eaErOb10 = #dserpm10@#12;
          eaErOb11 = #dserpm10@#13;
          eaErOb12 = #dserpm10@#14;
          eaErOb13 = #dserpm10@#15;
          eaErOb14 = #dserpm10@#16;
          eaErOb15 = #dserpm10@#17;
          |CIERRA #dserpm10@;
          |DESCARGA_DEF #dserpm10@;
     |FINSI;
|FPRC;

|PROCESO Reservas;
     nHay = 1;
     |SALVA_DATOS #25;
     |REPON_DATOS #referen@;
     |GRABA 020#referen@.n;
|FPRC;

|DEFBUCLE Reservas;
     #25#3;
     ;
     #1#1, "     ", 000001;
     #1#1, "zzzzz", 999999;
     ;
     NULL, Reservas;
|FIN;

|PROCESO MuestraRese;
     |DDEF aAlfa;
     aAlfa = aAlfa + "guerm025";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |HAZ CreaTempo;
          |NOME_DAT #referen@#Tempo#;
          |DELINDEX #referen@;
          |ABRE #referen@;
          nHay = 0;
          |BUCLE Reservas;
          |SI nHay = 0;
               |MENAV "0000No hay unidadaes reservadas...";
          |SINO;
               |LEE 000#referen@.p;
               |CONSULTA_CLAVE #1#referen@;
          |FINSI;
          |CIERRA #referen@;
          |DELINDEX #referen@;
          |HAZ BoraTempo;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|PROCESO Uni7; |TIPO 7;
     aAlfa = "0000<F5> Descripcion Ampliada";
     |SI nSwForestales = 0;
          aAlfa = "0000<F5> Descripcion Ampliada  <F6> Consulta Reservado";
     |FINSI;
     |MENSA aAlfa;
|FPRC;

|PROCESO PinDato; |TIPO 0;
     |SI nSwForestales ! 0; |ACABA; |FINSI;

     |PINTA 2301, "³Disponible Central      :                     ";
     |PINTA 2348, "Total Deposito      :          ³";
     |SI #10#16 = "N";
          nAlmCen = #10#22; nAlmDep = #10#51;
     |SINO;
          nAlmDep = enAlmaDepo;
          nAlmCen = enAlmaCompras;
     |FINSI;
     |ABRE #17;
     |DDEFECTO #17;
     #17#0 = #1#1;
     #17#1 = nAlmCen;
     |LEE 000#17=;
     |PINTA 2321, #17#1; |PINTA 2327, #17#48;
     |DDEFECTO #17;
     #17#0 = #1#1;
     #17#1 = nAlmDep;
     |LEE 000#17=;
     |PINTA 2363, #17#1; |PINTA 2369, #17#5;
     |CIERRA #17;
|FPRC;

|PROCESO DAmpliOrd;
     enSwDA = 1;
     |PRINT;
     enSwDA = 0;
|FPRC;

|DEFBUCLE DAmpliOrd;
     #103#1;
     ;
     #102#18, #102#19, #102#0, 001;
     #102#18, #102#19, #102#0, 999;
     ;
     NULL, DAmpliOrd;
|FIN;

|PROCESO ImpOrd;
     |PRINT;
     |BUCLE DAmpliOrd;
|FPRC;

|PROCESO ImprimeOrd;
     |HAZ ObsDerp;
     |IMPRE 0;
     |SI FSalida = 0;
          |INFOR aInforOr;
          |SI FSalida = 0;
               |BUCLELIN 2 ImpOrd #101;
               |PIEINF;
               |FININF;
          |FINSI;
          |FINIMP;
     |FINSI;
|FPRC;

|PROCESO RecogeDaOrd;
     #55#0 = #103#0;
     #55#1 = #103#1;
     #55#2 = #103#2;
     |GRABA 020#55n;
     |BORRA 020#103a;
|FPRC;

|DEFBUCLE RecogeDaOrd;
     #103#1;
     ;
     #102#18, #102#19, #102#0, 001;
     #102#18, #102#19, #102#0, 999;
     be;
     NULL, RecogeDaOrd;
|FIN;

|PROCESO RecogeLinOrd;
     |PARA i = 0; |SI i [ 17; |HACIENDO i = i + 1;
          #1i = #102i;
     |SIGUE;
     |GRABA 020#1n;
     |BUCLE RecogeDaOrd
     |BORRA 020#102a;
|FPRC;

|PROCESO RecogerOrd;
     |LEE 020#101=;
     |SI FSalida = 0;
          |PARA i = 0; |SI i [ 6; |HACIENDO i = i + 1;
               #0i = #101i;
          |SIGUE;
          |ABRE #1;
          |ABRE #55;
          |BUCLELIN 0 RecogeLinOrd #101;
          |CIERRA #55;
          |CIERRA #1;
          |BORRA 020#101a;
          aEsOrden = "S";
          |PTEC 815;
          |PTEC 802;
          |PTEC 802;
          |PTEC 802;
     |FINSI;
|FPRC;

|PROCESO CopiaLinDaOrd;
     #103#3 = #102#18;
     #103#4 = #102#19;
     #103#0 = #55#0;
     #103#1 = #55#1;
     #103#2 = #55#2;
     |GRABA 020#103n;
|FPRC;

|DEFBUCLE CopiaLinDaOrd;
     #55#1;
     ;
     #1#0, 001;
     #1#0, 999;
     ;
     NULL, CopiaLinDaOrd;
|FIN;

|PROCESO CopiaLinOrd;
     |PARA i = 0; |SI i [ 17; |HACIENDO i = i + 1;
          #102i = #1i;
     |SIGUE;
     #102#18 = #101#3;
     #102#19 = #101#4;
     |GRABA 020#102n;
     |BUCLE CopiaLinDaOrd;
|FPRC;

|DEFBUCLE CopiaLinOrd;
     #1#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, CopiaLinOrd;
|FIN;

|PROCESO BorLinOrdDa;
     |BORRA 020#103a;
|FPRC;

|DEFBUCLE BorLinOrdDa;
     #103#1;
     ;
     #101#3, #101#4, 001, 001;
     #101#3, #101#4, 999, 999;
     be;
     NULL, BorLinOrdDa;
|FINSI;

|PROCESO CopiaOrden;
     |ABRE #101;
     |ABRE #102;
     #101#3 = #0#3;
     #101#4 = #0#4;
     |LEE 101#101=;
     |SI FSalida = 0;
          |BUCLELIN 1 NULL #101;
          |BUCLE BorLinOrdDa;
          |BORRA 020#101a;
     |FINSI;
     |ABRE #103;
     |PARA i = 0; |SI i [ 6; |HACIENDO i = i + 1;
          #101i = #0i;
     |SIGUE;
     |GRABA 020#101n;
     |BUCLE CopiaLinOrd;
     |CIERRA #101;
     |CIERRA #102;
     |CIERRA #103;
|FPRC;

|PROCESO MinDa;
     #55#0 = #1#0;
     #55#1 = 1;
|FPRC;

|PROCESO MaxDa;
     #55#0 = #1#0;
     #55#1 = 999;
|FPRC;

|PROCESO DAmpliada;
     nLinDa = 0;
     |ABRE #55
     #55#0 = #1#0;
     #55#1 = 1;
     |LEE 000#55];
     |SI FSalida ! 0; |O #55#0 ! #1#0;
          |ABRE #82;
          #82#0 = #1#1;
          #82#1 = 1;
          |LEE 000#82];
          |PARA; |SI FSalida = 0; |Y #82#0 = #1#1; |HACIENDO;
               nLinDa = nLinDa + 1;
               |DDEFECTO #55;
               #55#0 = #1#0;
               #55#1 = nLinDa;
               #55#2 = #82#2;
               |GRABA 020#55n;
               |LEE 000#82s;
          |SIGUE;
          |CIERRA #82;
     |FINSI;
     |CIERRA #55;
     |PUSHV 0501 2380;
     |ENTLINEAL #1#55, 2, 2, 22, 1, MinDa, MaxDa;
     |POPV;
|FPRC;

|PROCESO Min77;
     #77#3 = #51#0;
     #77#54 = " " * 13;
|FPRC;

|PROCESO Max77;
     #77#3 = #51#0;
     #77#54 = "z" * 13;
|FPRC;

|PROCESO Tipo66; |TIPO 66;
     |ABRE #77;
     |SELECT #4#77;
     #77#3 = #51#0;
     #77#54 = "";
     |LEE 000#77];
     |CONSULTA_F_CLAVE #4#77, Min77, Max77;
     |SI FSalida = 0;
          #51#1 = #77#54;
          |PINTA #51#1;
     |SINO;
          |ERROR;
     |FINSI;
     |CIERRA #77;
|FPRC;

|PROCESO CargaLin;
     |LEE 000#1u;
     |SI FSalida = 0;
          nLin = #1#0 + 1;
     |SINO;
          nLin = 1;
     |FINSI;
     |DDEFECTO #1;
     #1#0 = nLin;
     #1#1 = #80#2;
     #1#2 = #80#4;
     ||#1#3 = #80#5;
     #1#4 = #80#6;
     #1#5 = #80#8;
     #1#6 = #80#26;
     #1#7 = #80#27;
     #1#8 = #80#0;
     #1#9 = #80#1;
     #1#15 = "S";
     ||---------------Carga solo las pendientes
     #guerm047@#0 = #80#27;
     #guerm047@#1 = #80#0;
     #guerm047@#2 = #80#1;
     |LEE 000#guerm047@.=;
     |SI FSalida ! 0;
          |DDEFECTO #47;
          |ABRE #47;
          #47#0 = #80#27;
          #47#1 = #80#0;
          #47#2 = #80#1;
          |LEE 000#47=;
          |SI FSalida ! 0;
               #47#3 = #77#54;
               #47#4 = #80#2;
               #47#5 = #80#5;
               #47#6 = 0;
               #47#7 = #80#5;
               |||GRABA 020#47n;
          |FINSI;
          |CIERRA #47;
          #guerm047@#3 = #47#3;
          #guerm047@#4 = #47#4;
          #guerm047@#5 = #47#5;
          #guerm047@#6 = #47#6;
          #guerm047@#7 = #47#7;
          |GRABA 020#guerm047@.n;
     |FINSI;

     #1#3 =  #guerm047@#7;

     |SI #1#3 > 0;
          |GRABA 020#1n;
          |HAZ Tipo2Lin;
          |HAZ CheqArti2;
          nHay = 1;
     |FINSI;
|FPRC;

|PROCESO RecogeSuAlb;
     |ABRE #1;
     |PUSHV 0501 2380;
     |BLANCO 12241957;
     |PINPA #0#51;
     |PINDA #0#51;
     |ENDATOS #1#51;
     |SI FSalida = 0;
          |ABRE #77;
          |SELECT #4#77;
          #77#3 = #51#0;
          #77#54 = #51#1;
          |LEE 000#77=;
          |SI FSalida ! 0;
               |MENAV "0000No existe Albaran...";
               |ERROR;
          |SINO;
               |SI #77#6 = "XX";
                    |MENAV "0000Albaran perteneciente a una certificación";
                    |ERROR;
               |SINO;
                    nHay = 0;
                    |BUCLELIN 2 CargaLin #77;
                    |SI nHay = 0;
                         |MENAV "0000No hay unidades pendientes...";
                    |FINSI;
               |FINSI;
          |FINSI;
          |CIERRA #77;
     |FINSI;
     |POPV;
     |CIERRA #1;
|FPRC;

|PROCESO PenLin;
/*   Comentado segun Carlos, Tiquet: 004823/00123


     |SI #80#3 = #7#11;  || Alm de Adj.= Alma. Expe
          |SELECT #3#9002;
          #9002#28 = #80#29;
          #9002#29 = #80#12;
          |LEE 000#9002=;
          |SI FSalida = 0;    || Pedido de Prepedido
               |ACABA;
          |FINSI;
     |FINSI;
*/
|| Y a¤adido esta linea, Tiquet: 004823/00123
     |SI #80#3 ! enAlmaCompras; |ACABA; |FINSI;

     #guerm047@#0 = #80#27;
     #guerm047@#1 = #80#0;
     #guerm047@#2 = #80#1;
     |LEE 000#guerm047@.=;
     |SI FSalida ! 0;
          |DDEFECTO #47;
          #47#0 = #80#27;
          #47#1 = #80#0;
          #47#2 = #80#1;
          |LEE 000#47=;
          |SI FSalida ! 0;
               #47#3 = #77#54;
               #47#4 = #80#2;
               #47#5 = #80#5;
               #47#6 = 0;
               #47#7 = #80#5;
               |||GRABA 020#47n;
          |FINSI;
          #guerm047@#3 = #47#3;
          #guerm047@#4 = #47#4;
          #guerm047@#5 = #47#5;
          #guerm047@#6 = #47#6;
          #guerm047@#7 = #47#7;
          |GRABA 020#guerm047@.n;
     |FINSI;
     |SI #guerm047@#7 > 0;
          nHayPen = 1;
     |FINSI;
|FPRC;

|PROCESO PenCab;
     |SELECT #3#8;
     #8#32 = #77#51;
     #8#33 = #77#39;
     |LEE 000#8=;
     |SI FSalida = 0; |Y #77#39 ! 0;
          |ERROR;
     |SINO;
          |SI #77#6 = "XX";   || la marca la pone el guerm030
               |ERROR;
          |SINO;
               nHayPen = 0;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO PenFin;
     |SI nHayPen = 0; |ACABA; |FINSI;
     nHay = 1;
     |PARA i = 0; |SI i [ 78; |HACIENDO i = i + 1;
          #agifa077@#i# = #77i;
     |SIGUE;
     |GRABA 020#agifa077@.n;
|FPRC;

|DEFBUCLE Pendientes;
     #77#1;
     ;
     #0#1, 000001;
     #0#1, 999999;
     ;
     NULL, PenCab, PenLin, PenFin;
|FIN;

|PROCESO AlbaPen;
     |DDEF aDef;
     aAlfa = aDef + "agifa077";
     |CARGA_DEF aAlfa, agifa077@;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |ABRE #7;
     #7#0 = #0#1;
     #7#1 = #0#2;
     |LEE 020#7=;
     |CIERRA #7;

     |ABRE #1;
     |HAZ CreaTempo;
     |NOME_DAT #agifa077@#Tempo#;
     |DELINDEX #agifa077@;
     |ABRE #agifa077@;
     |ABRE #47;
     nHay = 0;
     |ABRE #8;
     |ABRE #9002;
     |BUCLE Pendientes;
     |CIERRA #9002;
     |CIERRA #8;
     |CIERRA #47;
     |SI nHay = 0;
          |MENAV "0000No hay unidades pendientes...";
     |SINO;
          |LEE 020#agifa077@.p;
          |CONSULTA_CLAVE #1#agifa077@;
          |SI FSalida = 0;
               |ABRE #77;
               #77#50 = #agifa077@#50;
               #77#0 = #agifa077@#0;
               |LEE 020#77=;
               |SI FSalida = 0;
                    |BUCLELIN 2 CargaLin #77;
               |FINSI;
               |CIERRA #77;
          |FINSI;
     |FINSI;
     |CIERRA #agifa077@;
     |DELINDEX #agifa077@;
     |HAZ BoraTempo;
     |DESCARGA_DEF #agifa077@;
     |CIERRA #1;
|FPRC;

|PROCESO MenuTrack;
     |VARIABLES; {20} aPopup = ""; |FINSI;
     aPopup1 = "-1";  || Si fuera -1 en la posicion
     aPopup2 = 5;
     aPopup3 = "<F3> Recoge por su Albaran Nº";
     aPopup4 = "<F4> Albaranes Pendientes";
     aPopup5 = "<F5> Descripcion Ampliada";
     aPopup6 = "<F6> Reservas Stock Pdtes";
     aPopup7 = "<Ctrl+F7> Captura PDA";
     IaPopup = aPopup1  <-;
     |ESPECIFICA "TRACKPOPUP", aPopup;
     nSal = FSalida;
     |SI FSalida = 1; nSal = 11; |FINSI;
     |SI FSalida = 2; nSal = 12; |FINSI;
     |SI FSalida = 3; nSal = 13; |FINSI;
     |SI FSalida = 4; nSal = 14; |FINSI;
     |SI FSalida = 5; nSal = 65; |FINSI;
     FSalida = nSal;
|FPRC;

|PROCESO Tecla; |TIPO 11;
     |SI FSalida = 10;     ||F2
          |HAZ MenuTrack;
          |SI FSalida = 0; |ERROR; |ACABA; |FINSI;
     |FINSI;

     |SI FSalida = 11; |O FSalida = 12; |O FSalida = 25;|| F2, F4, Ctrl-F7
               |O FSalida = 14;                         || F6
          nTecla = FSalida;
          |PTEC 807;
     |FINSI;
     |SI FSalida = 13; ||F5;
          |HAZ DAmpliada;
     |FINSI;
|FPRC;

|PROCESO SumPdte;
     |SI #referen@#0 ! nLin;
          nPdte = nPdte + #referen@#3;
     |FINSI;
|FPRC;

|DEFBUCLE SumPdte;
     #referen@#2001;
     ;
     #1#14;
     #1#14;
     ;
     NULL, SumPdte;
|FIN;

|PROCESO CheqUni; |TIPO 0;
     |SI FSalida = 13; ||F5;
          |HAZ DAmpliada;
          |ERROR; |ACABA;
     |FINSI;
     |SI FSalida = 14; |Y nSwForestales = 0; || F6
          |HAZ MuestraRese;
          |ERROR; |ACABA;
     |FINSI;

     |SI #1#14 ! 0; || Una Reserva (F6)
          nLin = #1#0;
          nPdte = #1#3;
          |DDEF aAlfa;
          aAlfa = aAlfa + "gomaw003";
          |CARGA_DEF aAlfa, referen@;
          |SI FSalida = 0;
               |NOME_DAT #referen@#eaFichero#;
               |BUCLE SumPdte;
               |DESCARGA_DEF #referen@;
          |FINSI;
          |ABRE #25;
          #25#0 = #0#1;
          #25#1 = #1#14;
          |LEE 020#25=;
          |SI FSalida = 0; |Y nPdte > #25#17;
               aAlfa = "0000Se superan las unidades pendientes:" + #25#17;
               |MENAV aAlfa;
               |ERROR;
          |FINSI;
          |CIERRA #25;
          |ACABA;
     |FINSI;

     |ABRE #17;
     #17#0 = #1#1;
     #17#1 = enAlmaCompras;
     |LEE 000#17=;
     |CIERRA #17;
     nStock = #17#5 - #1#3;
     |SI nStock < 0;
          aAlfa = "0000No hay stock disponible."+&13+"Disponible: " + #17#5; || nStock;
          |MENAV aAlfa;
     |FINSI;

     |SI nStock <  #17#6; |Y #17#6 ! 0;
          aAlfa = "0000Supera el Stock minimo."+&13+"Minimo: " +  #17#6;
          |MENAV aAlfa;
     |FINSI;

     |SI #10#81 = "N"; |ACABA; |FINSI;
     |SI enPrepe ! 0; |ACABA; |FINSI;

     |DDEFECTO #77;
     |ABRE #77;
     #77#50 = #1#7;
     #77#0 = #1#0;
     |LEE 000#77=;
     |CIERRA #77;

     #guerm047@#0 = #1#7;
     #guerm047@#1 = #1#8;
     #guerm047@#2 = #1#9;
     |LEE 000#guerm047@.=;
     |SI FSalida ! 0;
          |DDEFECTO #47;
          |ABRE #47;
          #47#0 = #1#7;
          #47#1 = #1#8;
          #47#2 = #1#9;
          |LEE 000#47=;
          |SI FSalida ! 0;
               |DDEFECTO #77;
               |ABRE #77;
               #77#50 = #1#7;
               #77#0 = #1#0;
               |LEE 000#77=;
               |CIERRA #77;

               |DDEFECTO #80;
               |ABRE #80;
               #80#27 = #1#7;
               #80#0 = #1#8;
               #80#1 = #1#9;
               |LEE 000#80=;
               |CIERRA #80;

               #47#3 = #77#54;
               #47#4 = #80#2;
               #47#5 = #80#5;
               #47#6 = 0;
               #47#7 = #80#5;
               |||GRABA 020#47n;
          |FINSI;
          |CIERRA #47;
          #guerm047@#3 = #47#3;
          #guerm047@#4 = #47#4;
          #guerm047@#5 = #47#5;
          #guerm047@#6 = #47#6;
          #guerm047@#7 = #47#7;
          |GRABA 020#guerm047@.n;
     |FINSI;
     #guerm047@#6 = #guerm047@#6 + #1#3;
     |SI #guerm047@#6 > #guerm047@#5;
          aAlfa = "0000Se superan las unidades Pendientes: " + #guerm047@#7;
          |MENAV aAlfa;
     ||     |ERROR;      quitado segun tiquet:00225.0002 Cliente: 003774
     |FINSI;
|FPRC;

|PROCESO Tipo2Lin; |TIPO 2;
     #guerm047@#0 = #1#7;
     #guerm047@#1 = #1#8;
     #guerm047@#2 = #1#9;
     |LEE 101#guerm047@.=;
     |SI FSalida = 0;
          #guerm047@#6 = #guerm047@#6 +. #1#3;
          #guerm047@#7 = #guerm047@#5 - #guerm047@#6;
          |GRABA 020#guerm047@.a;
     |FINSI;
     |LIBERA #guerm047@;
|FPRC;

|PROCESO Correo;
     enEvento = 14; eaTipo = "14";
     eaAsunto = "Movimiento Material Almacen Central. " +  #2#3 + "/"+(("000000"+#0#4)%-106);
     eaAsunto = eaAsunto + " Obra Expediente: " + #0#1 + "/"+(("000000"+#0#2)%-106);
     eaOrigen = Usuario % 0810;
     eaPrograma = "gomaw002" + #0#0 + #0#1;

     |DBASS aAlfa;
     eaFicImpre= aAlfa + "spool/";
     aAlfa = Usuario;
     eaFicImpre = eaFicImpre + aAlfa;
     |HAZ Imprime;
     |HAZ EnviaEvento;
     eaFicImpre = "";

     |ABRE #gotrabaj;
     #gotrabaj#0 = #gomantho#30;
     |LEE 000#gotrabaj.=;
     |SI FSalida ! 0; |DDEFECTO #gotrabaj; |FINSI;
     |CIERRA #gotrabaj;
     enEnvio  = 0;
     eaOrigen = Usuario % 0810;
     eaDestino = #gotrabaj#27;
     eaPrograma = "gomaw002" + #0#0 + #0#1;
     |HAZ EnviaDSCorreo;
     |CIERRA #gotrabaj;
|FPRC;

|PROCESO MoviAlma;
     xForma =  1;
     xSerie   = #4#0;
     xDocTras = #4#1;
     xFecDocu = #4#2;
     xLinDocu = 0;       || #6#35;  si es 0 hace ultima linea+1
     xCodArti = #5#3;
     xDesArti = #5#4;
     xCanArti = #6#10;
     xCanArti2 = #1#10;
     xMedida1 = #1#11;
     xMedida2 = #1#12;
     xMedida3 = #1#13;
     xPartida = #1#18;

     xAlmEntr = #6#17;
     xAlmSali = enAlmaCompras; || #5#8;

     ||----------------ver el guerm045 que tambien cambia igual el almacen
     |SI #1#14 ! 0; || Reserva
          xAlmSali = #10#51;
          xAlmEntr = #7#11; || Almacen de la obra
     |FINSI;
     |SI eaAlmDepoPar = "S";
          |SI #1#15 = "S";
               |SALVA_DATOS #7;
               #7#0 = #45#10;
               #7#1 = #45#11;
               |LEE 000#7=;
               |ABRE #105;
               #105#0 = #7#11;
               |LEE 000#105=;
               |SI FSalida = 0;
                    xAlmSali = #105#2;     ||Alm
               |FINSI;
               |CIERRA #105;
               |REPON_DATOS #7;
          |FINSI;
     |FINSI;

     |SUB_EJECUTA_NP "gomoval1";
|FPRC;

|PROCESO PrecioPreVta;
     nPreVta = #40#11 / #40#8;
|FPRC;

|DEFBUCLE PrecioPreVta;
     #40#3;
     ;
     aSerPre, nNumPre, "                    ", #6#20;
     aSerPre, nNumPre, "zzzzzzzzzzzzzzzzzzzz", #6#20;
     ;
     NULL, PrecioPreVta;
|FIN;


|PROCESO BusPartiPre;
     #6#33 = #30#2;  ||capi
     #6#8 =  #30#4;  ||parti
     #6#9 = #30#5;   ||des parti
     |ERROR10;
|FPRC;

|DEFBUCLE BusPartiPre;
     #30#2;
     ;
     #6#0, #6#1, "                    ", #5#3;
     #6#0, #6#1, "zzzzzzzzzzzzzzzzzzzz", #5#3;
     ;
     NULL, BusPartiPre;
|FIN;

|PROCESO gomaw003;
     nSwAct = 1;

     #19#0 = #1#1;
     |LEE 020#19=;

     #45#0 = #0#3;
     #45#1 = #0#4
     #45#2 = #1#0;
     |LEE 000#45=;

     ||--------------Reserva
     |SI #1#14 ! 0;
          |DDEFECTO #9001;
          #25#0 = #1#16;
          #25#1 = #1#14;
          |LEE 121#25=;
          |SI FSalida = 0;
               #25#16 = #25#16 + #1#3;
               #25#17 = #25#9 - #25#16;
               |GRABA 020#25a;
               |LIBERA #25;

               #9001#0 = #25#10;
               |LEE 020#9001=;
          |FINSI;
     |FINSI;

     cCodMonTrab = #7#6;
     |HAZ MonBas;

     nLin = nLin + 1;
     #5#0 = #4#0;
     #5#1 = #4#1;
     #5#2 = nLin;
     #5#3 = #1#1;
     #5#4 = #1#2;
     #5#5 = #1#3;
     #5#6 = #1#3;
     #5#7 = 0;
     #5#8 = #7#11; |||enAlmaCompras;

     nPrecio = 0; aArtic =#1#1; |HAZ BuscaPrecio;
     #5#9 = nPrecio;        ||P.comp
     ||#5#9 = #19#28;       ||P.comp
     #5#10 = #5#5 * #5#9; ||Imp

     #6#34 = "A";
     #6#4 = #5#0;
     #6#5 = #5#1;
     #6#6 = nLin;
     #6#7 = 1;

     #6#2 = #0#1;
     #6#3 = #0#2;
     #6#10 = #5#5;
     #6#15 = #7#2;
     #6#16 = #7#8;
     #6#17 = #7#11;

     #29#0 = #6#17;
     |LEE 020#29=;

     #6#18 = #29#1;
     #6#20 = #5#3;
     #6#21 = #7#6;
     #6#26 = #19#200;
     #6#28 = #0#0;
     #6#29 = "M";
     |HAZ MoviAlma;
     #6#19 = xDocTras;
     #6#30 = #19#1;
     #6#32 = xSerie;
     #6#35 = xLinDocu;

     #5#11 = xDocTras;
     |GRABA 020#5n;

     aSerPre = #0#7;
     nNumPre = #0#8;

     nPreVta = #19#18;   || Precio Venta defecto
     |SI #24#39 = 1; nPreVta = #19#18 < #19#21; |FINSI;
     |SI #24#39 = 2; nPreVta = #19#19 < #19#22; |FINSI;
     |SI #24#39 = 3; nPreVta = #19#20 < #19#23; |FINSI;
     |SI #24#39 = 4; nPreVta = #19#147 < #19#150; |FINSI;
     |SI #24#39 = 5; nPreVta = #19#148 < #19#151; |FINSI;
     |SI #24#39 = 6; nPreVta = #19#149 < #19#152; |FINSI;
     |BUCLE PrecioPreVta;

     #6#0 = aSerPre;
     #6#1 = nNumPre;
     #6#41 = #1#4;      || nPreCom;
     #6#42 = #1#5;
     #6#43 = #1#6;
     #6#53 = #1#7;
     #6#54 = #1#8;
     #6#55 = #1#9;
     |SI #1#14 ! 0;      || Reserva
          #6#53 = #1#16;
          #6#54 = #1#14;
          #6#55 = 999;
     |FINSI;

     |SI #6#41 = 0;      || A¤adido para el 4823/89
          #6#41 = #19#133;
          |SI #6#41 = 0; #6#41 = #19#9; |FINSI;
     |FINSI;

     #6#37 = nPreVta;
     |SI #6#37 = 0; #6#37 = #6#41; |FINSI;
     |SI #10#32 = "H";
          |BUCLE BusPartiPre;
     |FINSI;

     |SI #10#76 = "N"; |Y #10#81 = "N";
          #6#41 = #19#133;
          |SI #6#41 = 0; #6#41 = #19#9; |FINSI;
          #6#37 = #19#18;
     |FINSI;

     |HAZ CalcuGopartia;

     |SI #1#14 ! 0;
          #6#8 = #9001#20;
          #6#33 = #9001#19;

          |SELECT #2#30;
          #30#0 = #9001#17;
          #30#1 = #9001#18;
          #30#2 = #9001#19;
          #30#4 = #9001#20;
          |LEE 000#30=;
          |SI FSalida = 0;
               #6#9 = #30#5;
          |FINSI;
     |FINSI;
     |SI #10#70 = "F"; |HAZ PreForestales; |FINSI;

     |SI nSwForestales = 0;
          |HAZ ForesPreCoste;
          #6#41 = enPreCosteF;
     |FINSI;

     |GRABA 020#6n;

     ||--------------Adj unidades
     #47#0 = #1#7;
     #47#1 = #1#8;
     #47#2 = #1#9;
     |LEE 101#47=;
     |SI FSalida = 0;
          #47#6 = #47#6 + #1#3;
          #47#7 = #47#5 - #47#6;
          |GRABA 020#47a;
          |LIBERA #47;
     |FINSI;
|FPRC;

|DEFBUCLE gomaw003;
     #1#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, gomaw003;
|FIN;

|PROCESO Actualiza;
     |ABRE #7;
     #7#0 = #0#1;
     #7#1 = #0#2;
     |LEE 020#7=;
     |SI FSalida = 0;

          #4#2 = #0#0;
          #4#8 = #0#6;
          #4#9 = #0#5;
          |GRABA 020#4a;
          |LIBERA #4;

          |ABRE #24;
          #24#0 = #7#2;
          |LEE 000#24=;
          |CIERRA #24;

          |ABRE #29;
          |ABRE #6;
          |ABRE #5;
          |ABRE #19;
          |ABRE #47;
          |ABRE #25;
          |ABRE #30;
          |ABRE #9001;
          |ABRE #45;
          |BUCLE gomaw003;
          |CIERRA #45;
          |CIERRA #9001;
          |CIERRA #30;
          |CIERRA #25;
          |CIERRA #47;
          |CIERRA #6;
          |CIERRA #5;
          |CIERRA #19;
          |CIERRA #29;
          |SI aParam ! "SALAUTO";
               |HAZ Correo;
          |FINSI;
     |FINSI;
     |CIERRA #7;
|FPRC;
ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
|PROCESO DAmpli;
     enSwDA = 1;
     |PRINT;
     enSwDA = 0;
|FPRC;

|DEFBUCLE DAmpli;
     #55#1;
     ;
     #1#0, 001;
     #1#0, 999;
     ;
     NULL, DAmpli;
|FIN;

|PROCESO Tmp;
     |DDEFECTO #77;
     #77#50 = #1#7;
     #77#0 = #1#8;
     |LEE 000#77=;

     |PRINT;
     |BUCLE DAmpli;
|FPRC;

|DEFBUCLE Tmp;
     #1#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Tmp;
|FIN;

|PROCESO Imprime;
     |HAZ ObsDerp;
     |SI eaFicImpre = "";
          nSwi = 1;
          |IMPRE 0;
     |SINO;
          Impresora = eaFicImpre;
          |IMPRE -77;
     |FINSI;
     |SI FSalida = 0;
          |INFOR aInforme;
          |SI FSalida = 0;
               |ABRE #77;
               |BUCLE Tmp;
               |CIERRA #77;
               |PIEINF;
               |FININF;
          |FINSI;
          |FINIMP;
     |FINSI;
|FPRC;

|PROCESO Min;
     #1#0 = 1;
|FPRC;

|PROCESO Max;
     #1#0 = 999;
|FPRC;

|PROCESO Tipo12; |TIPO 12;
     |SI FSalida ! 0; |Y FSalida ! 5;
          |ACABA;
     |FINSI;

     |PARA; |SI nSalMenu ! 4; |HACIENDO;
          |PARA; |SI; |HACIENDO;
               nTecla = 0;
               |ENTLINEAL #1#1, 1, 1, 22, 0, Min, Max;
               |SI nTecla = 11; |HAZ RecogeSuAlb; |FINSI;  || F3
               |SI nTecla = 12; |HAZ AlbaPen; |FINSI;      || F4
               |SI nTecla = 14; |HAZ ResePdte; |FINSI;     || F6
               |SI nTecla = 25; || Ctrl-F7
                    |HAZ CreaTempo;
                    eaFichero = Tempo;
                    |SUB_EJECUTA_NP "psion066";
                    |HAZ BoraTempo;
                    |SI enError = 0; |HAZ ImportaPDA; |FINSI;
               |FINSI;
               |SI nTecla = 0; |SAL; |FINSI;
          |SIGUE;
          |SI aEsOrden = "N";
               |MENU Menua;
               nSalMenu = FSalida;
               |SI FSalida = 3; nSalMenu = 5; |FINSI;
               |SI FSalida = 4; nSalMenu = 3; |FINSI;
               |SI FSalida = 5; nSalMenu = 4; |FINSI;
          |SINO;
               |MENU Menub;
               nSalMenu = FSalida;
          |FINSI;
          |SI nSalMenu = 2;
               |HAZ Imprime;
          |FINSI;
          |SI nSalMenu = 3;
               |ABRE #1;
               |LEE 000#1p;
               |SI FSalida = 0;
                    |SI nSwi = 0;
                         |CONFI "0000NImprimir Documento?";
                         |SI FSalida = 0;
                              |HAZ Imprime;
                         |FINSI;
                    |FINSI;
                    |HAZ Actualiza;
                    |LIBERA #4;
                    eaSer = #0#3;
                    enNum = #0#4;
                    efFecha = #0#0;
                    eaFicMas = "gomaw003"; |SUB_EJECUTA_NP "guerm045;TMP";
               |FINSI;
               |CIERRA #1;
               nSalMenu = 4;
          |FINSI;
          |SI nSalMenu = 5;
               |HAZ CopiaOrden;
               |CONFI "0000NImprimir Orden de Carga?";
               |SI FSalida = 0;
                    |HAZ ImprimeOrd;
               |FINSI;
               |CONFI "0000NConfirmar Orden de Carga?";
               |SI FSalida ! 0;
                    |ABRE #101;
                    #101#3 = #0#3;
                    #101#4 = #0#4;
                    |LEE 101#101=;
                    |SI FSalida = 0;
                         |BUCLELIN 1 NULL #101;
                         |BUCLE BorLinOrdDa;
                         |BORRA 020#101a;
                    |FINSI;
                    |CIERRA #101;
               |FINSI;
               nSalMenu = 4;
          |FINSI;
     |SIGUE;
|FPRC;

|PROCESO Conta7; |TIPO 7;
     |SI #0#4 ! 0; |ACABA; |FINSI;

     |ABRE #27;
     #27#2 = #0#3;
     #27#0 = "movcenal";
     |LEE 101#27=;
     |SI FSalida = 0;
          nConta = #27#1;
          |SI nConta < 500000;
               nConta = nConta
          |FINSI;
          #27#1 = nConta + 1;
          |GRABA 020#27a;
     |SINO;
          #27#1 = 500002;
          nConta = 500001;
          |GRABA 020#27n;
     |FINSI;
     |CIERRA #27;
     #0#4 = nConta; |PINTA #0#4;
|FPRC;

|PROCESO ContaAuto;
     nConta = #0#4;
     |PARA FSalida = 0; |SI FSalida = 0; |HACIENDO;
          nConta = nConta + 1;
          #4#0 = #0#3;
          #4#1 = nConta;
          |LEE 000#4=;
     |SIGUE;
     |SI nConta > 999999;
          nConta = 500000;
          |PARA FSalida = 0; |SI FSalida = 0; |HACIENDO;
               nConta = nConta + 1;
               #4#0 = #0#3;
               #4#1 = nConta;
               |LEE 000#4=;
          |SIGUE;
     |FINSI;
     |SI nConta > 999999;
          |MENAV "0000No hay numero libre [500000-999999]";
          FSalida = 1;
     |SINO;
          |ABRE #27;
          #27#2 = #0#3;
          #27#0 = "movcenal";
          |LEE 101#27=;
          |SI FSalida = 0;
               #27#1 = nConta + 1;
               |GRABA 020#27a;
          |FINSI;
          |CIERRA #27;
     |FINSI;
|FPRC;

|PROCESO Conta0; |TIPO 0;
     |C_M #0#3, 0, aAlfa;
     |SI aAlfa = "N"; |ACABA; |FINSI;

     #4#0 = #0#3;
     #4#1 = #0#4;
     |LEE 000#4=;
     |SI FSalida = 0;
          |CONFI "0000SDocumento existente. Cambiar numero automatico...";
          |SI FSalida = 0;
               |HAZ ContaAuto;
               |SI FSalida = 0;
                    #0#4 = nConta;
                    |PINTA #0#4;
                    |GRABA 020#4b;
               |FINSI;
               |SI FSalida = 0;
                    nGraba = 1;
                    |C_M #0#3, 1, "N";
                    |C_M #0#4, 1, "N";
               |SINO;
                    |ERROR;
               |FINSI;
          |SINO;
               |ERROR;
          |FINSI;
     |SINO;
          |GRABA 020#4b;
          |SI FSalida = 0;
               nGraba = 1;
               |C_M #0#3, 1, "N";
               |C_M #0#4, 1, "N";
          |SINO;
               |ERROR;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Esc; |TIPO 6;
     |SI FSalida = 1;
          |SI nSwSale = 0;
               nSwSale = 1;
               |ERROR; |PTEC 807;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO CtrlFec; |TIPO 0;
     ||ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄControl Cierre
     efFecha = #0#0;
     |HAZ EstaCerrado;
     |SI FSalida = 0;
          |ERROR; |ACABA;
     |SINO;
          |C_M #0#3, 1, "N";
          |C_M #0#4, 1, "N";
     |FINSI;
     ||ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
|FPRC;

-------------------------------------------------------------------
|PROCESO ContaSalAuto;
     |ABRE #27;
     #27#2 = #0#3;
     #27#0 = "movcenal";
     |LEE 101#27=;
     |SI FSalida = 0;
          nConta = #27#1;
          |SI nConta < 500000;
               nConta = nConta
          |FINSI;
          #27#1 = nConta + 1;
          |GRABA 020#27a;
     |SINO;
          #27#1 = 500002;
          nConta = 500001;
          |GRABA 020#27b;
     |FINSI;
     #4#0 = #0#3;
     #4#1 = nConta;
     |GRABA 000#4b;
     |SI FSalida ! 0;
          |PARA; |SI FSalida ! 0; |HACIENDO;
               nConta = nConta + 1;
               #4#0 = #0#3;
               #4#1 = nConta;
               |GRABA 000#4b;
          |SIGUE;
          #27#1 = nConta + 1;
          |GRABA 020#27a;
     |FINSI;
     |CIERRA #27;
|FPRC;

|PROCESO ActSalAuto;
     |HAZ Actualiza;
     eaSer = #0#3;
     enNum = #0#4;
     efFecha = #0#0;

     |CIERRA #4;
     eaFicMas = "gomaw003"; |SUB_EJECUTA_NP "guerm045;TMP1";
     |ABRE #4;

     |CIERRA #1;
     |DELINDEX #1;
     |ABRE #1;
|FPRC;

|PROCESO TmpSalAuto;
     |SI #42#13 ! "*";
          |ACABA;
     |FINSI;

     |SI aSerAnt ! #42#0;
          |SI aSerAnt ! "";
               |HAZ ActSalAuto;
          |FINSI;
          aSerAnt = #42#0;
          nLinAuto = 0;

          #0#0 = #42#3;
          #0#1 = #42#0;
          #0#2 = #42#14;
          #0#3 = #42#0;
          #0#6 = "Proceso Generado Automaticamente";
          |HAZ ContaSalAuto;
          #0#4 = nConta;
     |FINSI;
     nLinAuto = nLinAuto + 1;
     #1#0 = nLinAuto;
     #1#1 = #42#7;
     #1#2 = #42#8;
     #1#3 = #42#9;
     #1#4 = #42#10;
     #1#5 = #42#11;
     #1#6 = #42#16;
     #1#7 = #42#0;
     #1#8 = #42#1;
     #1#9 = #42#2;
     |GRABA 020#1n;

     #46#0 = #42#0;
     #46#1 = #42#1;
     #46#2 = #42#2;
     #46#3 = ~ ;
     #46#4 = Usuario % 810;
     |GRABA 020#46n;


     |ABRE #45;
     #45#0 = #0#3;
     #45#1 = #0#4
     #45#2 = #1#0;
     |LEE 101#45=;
     |SI FSalida ! 0; |GRABA 020#45b; |FINSI;

     #45#3 = #42#10;
     #45#16 = #42#11;
     #45#17 = #42#16;
     #45#18 = #42#0;
     #45#19 = #42#1;
     #45#20 = #42#2;
     #45#4 = "";
     #45#5 = 0
     ||---------------Salida
     #45#6 = #42#0;
     #45#7 = #41#14;
     #45#8 = #42#17;
     #45#9 = #42#18;
     ||--------------Entrada
     #45#10 = eaSerExpSal;
     #45#11 = enNumExpSal;
     #45#12 = eaSerPreSal;
     #45#13 = enNumPreSal;
     #45#14 = enAlmaCompras;
     #45#15 = #42#19;
     |GRABA 020#45a;
     |CIERRA #45;
|FPRC;

|DEFBUCLE TmpSalAuto;
     #42#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, TmpSalAuto;
|FIN;

|PROCESO SalidaAuto;
     enAlmaCompras = 1;
     eaSerExpSal = "48001";
     enNumExpSal = 00023;

     |ABRE #41;
     #41#0 = eaSerExpSal;
     #41#1 = enNumExpSal;
     #41#2 = 1;
     |LEE 000#41];
     eaSerPreSal = #41#3;
     enNumPreSal = #41#4;
     |CIERRA #41;

     |NOME_DAT #42 eaFicSalAuto;

     |ABRE #1;
     |ABRE #46;
     |ABRE #4;
     |BUCLE TmpSalAuto;
     |SI aSerAnt ! "";
          |HAZ ActSalAuto;
     |FINSI;
     |CIERRA #4;
     |CIERRA #46;
     |CIERRA #1;
|FPRC;

|PROCESO PrecioPrep;
   |SI #goprepel#2 = aArtic; |Y #goprepel#10 = "S";
      nPrecio = #goprepel#6; |ERROR10;
   |FINSI;
|FPRC;

|DEFBUCLE PrecioPrep;
#goprepel#1;
;
#goprepec#0,001;
#goprepec#0,999;
;
NULL,PrecioPrep;
|FIN;

|PROCESO BuscaPrecio;
     |ABRE #45;
     #45#0 = #0#3;
     #45#1 = #0#4
     #45#2 = #1#0;
     |LEE 000#45=;
     |SI FSalida = 0;
          nPrecio = #45#3;
          |CIERRA #45;
          |ACABA;
     |FINSI;
     |CIERRA #45;

   || Primero busco en la ficha del articulo el precio de mercado. Si este es
   ||   cero, busco si viene de pre-pedido (goprepec) y si no es asi, cojo el
   ||   ultimo precio de compra

   |ABRE #goartmer;
   #goartmer#0 = aArtic;
   |LEE 000#goartmer.=;
   |SI FSalida ! 0; |DDEFECTO #goartmer; |FINSI;
   nPrecio = #goartmer#1;
   |CIERRA #goartmer;

   |SI nPrecio = 0;
      |ABRE #goprepec;
      |SELECT #2#goprepec;
      #goprepec#3 = #gomaw002#1;
      #goprepec#7 = #gomaw002#2;
      |LEE 000#goprepec.=;
      |SI FSalida = 0;
         |BUCLE PrecioPrep;
      |FINSI;
      |SELECT #1#goprepec;
      |CIERRA #goprepec;
   |FINSI;

   |SI nPrecio = 0;
      #19#0 = aArtic;
      |LEE 000#19=;
      |||SI FSalida = 0; nPrecio = #19#28; |FINSI;
      |SI FSalida = 0; nPrecio = #19#133; |FINSI;
   |FINSI;
|FPRC;
---------------------------------------------------------------------
|PROCESO Final;
     |CIERRA #guerm047@;
     |DELINDEX #guerm047@;
     Tempo = aTempo470; |HAZ BoraTempo;
     |DESCARGA_DEF #guerm047@;

     |DELINDEX #1;
     Tempo = eaFichero; |HAZ BoraTempo;
|FPRC;

|PROGRAMA;
     |HAZ EsForestales;
     nSwForestales = FSalida;

     |ABRE #10; |LEE 000#10p; |CIERRA #10;
     eaAlmDepoPar = #10#105;

     aParam = PARAMETRO;

     |DDEF aDef;
     aAlfa = aDef + "guerm047";
     |CARGA_DEF aAlfa, guerm047@;
     |SI FSalida ! 0;
          |ERROR;
          |ACABA;
     |FINSI;

     |HAZ CreaTempo; aTempo470 = Tempo;
     |NOME_DAT #guerm047@#Tempo#;
     |DELINDEX #guerm047@;
     |ABRE #guerm047@;

     |HAZ CreaTempo; eaFichero = Tempo;
     |NOME_DAT #1 eaFichero;
     |DELINDEX #1;

     |HAZ CreaTempo; aTempo55 = Tempo;
     |NOME_DAT #55 aTempo55;
     |DELINDEX #55;

     aInforme = #10#82; |QBF aInforme;
     aInforOr = #10#122; |QBF aInforOr;

     |SI aParam = "SALAUTO";  || Exclusivo para el
          |HAZ SalidaAuto;    || el modulo de Acisa
          |HAZ Final;
          |ACABA;
     |FINSI;

     |HAZ PideAlmaCompra;

     |SI #10#81 = "S";
          |HAZ BuscaExSal;
          |SI enError ! 0; |HAZ Final; |ACABA; |FINSI;
          |SI nSwForestales = 0;
               enPrepe = -1;
          |SINO;
               |CONFI "2400SPROVIENE DE PREPEDIDO DE OBRA:";
               enPrepe = FSalida;
          |FINSI;
     |FINSI;

     aAlfa = Usuario % 0810;
     |ABRE #2;
     #2#0 = aAlfa;
     |LEE 000#2=;
     |SI FSalida ! 0;
          aAlfa = "0000No existe Usuario: [" + aAlfa + "] en la libreta de direcciones";
          |MENAV aAlfa;
     |FINSI;
     |CIERRA #2;

     |CLS;
     aAlfa = #10#68; |QBF aAlfa;
     |SI aAlfa ! "";
          |C_V #0#5, 1, "S";
          |PINPA #0#0;
          |PINTA 1103, #10#68;
     |SINO;
          |PINPA #0#0;
     |FINSI;
     |SI #10#141 = "O";
          |PINTA 803, "O.T........:";
     |FINSI;

     |CONTROL_SIMPLE 0, "BOTON,Recargar Unidades Adjudicadas.", 0560, 0675, Recarga;
     nBoton = FSalida;

     |ABRE #101;
     |LEE 000#101p;
     |SI FSalida = 0;
          |CONFI "0000NExisten ordenes de carga pendietes de salida. ¿Recoger?";
          |SI FSalida = 0;
               |CONSULTA_CLAVE #1#101;
               |SI FSalida = 0; |HAZ RecogerOrd; |FINSI;
          |FINSI;
     |FINSI;
     |CIERRA #101;

     |ENTLINEAL #1#1, 1, 7, 22, 0, Min, Max;
     |PINDA #0#0;
     |ABRE #4;
     |ENDATOS #1#0;
     |SI nSwAct = 0; |Y nGraba = 1;
          #4#0 = #0#3;
          #4#1 = #0#4;
          |LEE 101#4=;
          |SI FSalida = 0;
               |BORRA 000#4c;
          |FINSI;
     |FINSI;
     |CIERRA #4;

     |HAZ Final;

     |FIN_CONTROL_WINDOWS nBoton;
     |PULSATECLA;
|FPRO;

|PROCESO ImportaPDA;
     |ABRE #1;
     |LEE 000#1u;
     |SI FSalida = 0;
          nLin = #1#0 + 1;
     |SINO;
          nLin = 1;
     |FINSI;

     |DDEF aAlfa; aAlfa = aAlfa + "psion067";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida ! 0; |ACABA; |FINSI;
     |NOME_DAT #referen@#eaFichero#;
     |ABRE #referen@;
     |LEE 000#referen@.p;
     |PARA; |SI FSalida = 0; |HACIENDO;
          #1#0 = nLin;
          #1#1 = #referen@#0; ||Arti
          #1#2 = #referen@#1; ||Des
          #1#3 = #referen@#3; ||Uni
          |GRABA 020#1b;
          FEntrada = 100;     ||simula alta
          |HAZ CheqArti;
          |HAZ Tipo2Lin;
          |GRABA 020#1a;
          |LIBERA #1;
          nLin = nLin + 1;
          |LEE 000#referen@.s;
     |SIGUE;
     |CIERRA #referen@;
     |DELINDEX #referen@;
     |DESCARGA_DEF #referen@;

     |CIERRA #1;
|FPRC;

|PROCESO Albalin;
     |SI #77#39 > 0;
          |SELECT #3#8;
          #8#32 = #77#51;
          #8#33 = #77#39;
          |LEE 000#8=;
          |SI FSalida = 0; |ACABA; |FINSI;
     |FINSI;

     |DDEFECTO #47;
     #47#0 = #80#27;
     #47#1 = #80#0;
     #47#2 = #80#1;
     |LEE 101#47=;
     |SI FSalida ! 0;
          #47#3 = #77#54;
          #47#4 = #80#2;
          #47#5 = #80#5;
          #47#6 = 0;
          #47#7 = #80#5;
          |GRABA 020#47n;
     |SINO;
          |SI #47#8 = "S";
               #47#6 = 0;
               |GRABA 020#47a;
          |FINSI;
     |FINSI;
     |LIBERA #47;
|FPRC;

|PROCESO Albacom;
     |SI #77#6 = "XX";
          |ERROR;
     |FINSI;
|FPRC;

|DEFBUCLE Albacom;
     #77#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Albacom, Albalin;
|FIN;

|PROCESO Asignada;
     |SI #6#2 ! #6#53;
          |ACABA;
     |FINSI;
     #47#0 = #6#53;
     #47#1 = #6#54;
     #47#2 = #6#55;
     |LEE 101#47=;
     |SI FSalida = 0;
          |SI #47#8 = "S";
               #47#6 = #47#6 + #6#10;
               #47#7 = #47#5 - #47#6;
               |GRABA 020#47a;
               |LIBERA #47;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE Asignada;
     #6#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Asignada;
|FIN;

|PROCESO Borra47;
     |SI #47#8 = "S";
          |BORRA 020#47a;
     |FINSI;
     |LIBERA #47;
|FPRC;

|DEFBUCLE Borra47;
     #47#1;
     ;
     INICIO;
     FINAL;
     be;
     NULL, Borra47;
|FIN;

|PROCESO Recarga;
     |MENSA "0000Actualizando unidades adjudicadas...";
     |BUCLE Borra47;
     |ABRE #47;
     |ABRE #8;
     |BUCLE Albacom;
     |BUCLE Asignada;
     |CIERRA #8;
     |CIERRA #47;
     |MENAV "0000Proceso Finalizado...";
|FPRC;

|PROCESO DocTipo66; |TIPO 66;
     |ABRE #7;
     #7#0 = #0#3;
     #7#1 = 0;
     |LEE 000#7];
     |CONSULTA_CLAVE #1#7;
     |SI FSalida = 0;
          #0#3 = #7#0; |PINTA #0#3;
     |SINO;
          |ERROR;
     |FINSI;
     |CIERRA #7;
|FPRC;

|PROCESO Linea7; |TIPO 7;
     |HAZ PinDato;
|FPRC;

|PROCESO Linea0; |TIPO 0;
     eaArtiAnt = #1#1;
|FPRC;

|PROCESO DobleUniSali; |TIPO 7;
     |C_M #1#3, 1, "S";

     |ABRE #19;
     #19#0 = #1#1;
     |LEE 000#19=;
     |SI FSalida = 0;
          |SI #19#179 = "S"; |O #19#180 = "S";
               ||eaArtiAnt  (se cargar en el tipo 0 de la linea)
               enAlmacen  = enAlmaCompras;
               eaArticulo = #1#1;
               enUnidad1 = #1#3;
               enUnidad2 = #1#10;
               enMedida1 = #1#11;
               enMedida2 = #1#12;
               enMedida3 = #1#13;
               eaPartida = #1#18;
               enModoVta = (FEntrada / 100) ! 0;
               |SUB_EJECUTA_NP "dsz99907";
               |SI eaSw2Stock = "S";
                    |C_M #1#3, 1, "N";
                    #1#3 = enUnidad1; |PINTA #1#3;
                    #1#10 = enUnidad2;
                    #1#11 = enMedida1;
                    #1#12 = enMedida2;
                    #1#13 = enMedida3;
                    #1#18 = eaPartida;
               |SINO;
                    #1#10 = 0;
                    #1#11 = 0;
                    #1#12 = 0;
                    #1#13 = 0;
                    #1#18 = "";
               |FINSI;
          |SINO;
               #1#10 = 0;
               #1#11 = 0;
               #1#12 = 0;
               #1#13 = 0;
               #1#18 = "";
          |FINSI;
     |FINSI;
     |CIERRA #19;
|FPRC
--------------------------------
|PROCESO ResePdtes;
     nPdte = #25#17;

     #1#14 = #25#1;
     |LEE 000#1];        || Resta las que ya estan introducidas
     |PARA; |SI FSalida = 0; |Y #1#14 = #25#1; |HACIENDO;
          nPdte = nPdte - #1#3;
          |LEE 000#1s;
     |SIGUE;

     |SI nPdte ! 0;
          |PARA i = 0; |SI i [ 12; |HACIENDO i = i + 1;
               #109i = #25i;
          |SIGUE;
          #109#9 = nPdte;
          |GRABA 020#109n;
          nHay = 1;
     |FINSI;
|FPRC;

|DEFBUCLE ResePdtes;
     #25#1;
     ;
     #0#1, 000001;
     #0#1, 999999;
     ;
     NULL, ResePdtes;
|FIN;

|PROCESO ResePdte;
     |ABRE #1;
     |HAZ CreaTempo;
     |NOME_DAT #109 Tempo; |DELINDEX #109;
     |ABRE #109;
     nHay = 0;
     |SELECT #2#1;
     |BUCLE ResePdtes;
     |SELECT #1#1;
     |SI nHay = 0;
          |MENAV "0000No hay unidades pendientes...";
     |SINO;
          |LEE 000#109p;
          |CONSULTA_CLAVE #1#109;
          |SI FSalida = 0;
               |ABRE #19;
               #19#0 = #109#7;
               |LEE 020#19=;
               |CIERRA #19;

               |LEE 000#1u;
               |SI FSalida = 0;
                    nLin = #1#0 + 1;
               |SINO;
                    nLin = 1;
               |FINSI;
               |DDEFECTO #1;
               #1#0 = nLin;
               #1#1 = #109#7;
               #1#2 = #109#8;
               #1#3 = #109#9;
               #1#4 = #19#133;
               |SI #1#4 = 0; #1#4 = #19#9; |FINSI;
               #1#14 = #109#1;
               #1#16 = #0#1;

               |ABRE #25;
               #25#0 = #109#0;
               #25#1 = #109#1;
               |LEE 020#25=;
               |CIERRA #25;

               #1#17 = #25#18;
               |GRABA 020#1n;
               |HAZ Tipo2Lin;
               |HAZ CheqArti2;
          |FINSI;
     |FINSI;
     |CIERRA #109;
     |CIERRA #1;
     |HAZ BoraTempo; |DELINDEX #109;
|FPRC;

|PROCESO EntraArt; |TIPO 7;
     |SI #1#14 = 0; |Y #1#15 = "N";
          |C_M #1#1, 1, "S";
     |SINO;
          |C_M #1#1, 1, "N";
     |FINSI;
|FPRC;
