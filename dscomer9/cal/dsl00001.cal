|FICHEROS;
     dsl00001 #0;
     agifa019 #1;
|FIN;

|VARIABLES;
     aMensa    = "";
     nLinea    = 0;
     aCodBarra = "";
     nBoton = 0;
     nSwReconstruir = 0;
     aAlfa = "";
|FIN;

|PROCESO NoRepe; |TIPO 0;
     aMensa = "";
     nLinea = #0#0;
     aCodBarra = #0#3;
     |SALVA_FICHA #0;
     |SELECT #2#0;
     |LEE 000#0];
     |PARA; |SI FSalida = 0; |Y #0#3 = aCodBarra; |HACIENDO;
          |SI #0#0 ! nLinea;
               aMensa = "0000Codigo Existente." + &13 + " Articulo: [" + #0#1 + "]";
          |FINSI;
          |LEE 000#0s;
     |SIGUE;
     |SELECT #1#0;
     |REPON_FICHA #0;

     |SI aMensa ! "";
          |MENAV aMensa;
          |ERROR;
     |FINSI;
|FPRC;


|PROCESO ActCodBarras; |TIPO 0;
     |SI #dsl00001#6 = 0; |O #dsl00001#6 = 1;
          |ABRE #agifa019;
          #agifa019#0 = #dsl00001#1;
          |LEE 101#agifa019.=;
          |SI FSalida = 0;
               #agifa019#128 = #dsl00001#3;
               |GRABA 020#agifa019.a;
          |FINSI;
          |LIBERA #agifa019;
          |CIERRA #agifa019;
     |FINSI;
|FPRC;

|PROCESO tipo2; |TIPO 2;
     #0#4 = "N";
     #0#5 = "01.01.0000";
|FPRC;

|RUTINA inferior;
     #0#0=1;
|FRUT;

|RUTINA superior;
     #0#0=9999999;
|FRUT;

|PROCESO GrabaFiche;
     |DDEFECTO #0;
     #0#3 = #1#128;
     |LEE 000#0=;
     |SI FSalida ! 0;
          nLinea = nLinea + 1;
          #0#0  = nLinea;
          #0#1  = #1#0;
          #0#2  = #1#1;
          #0#3  = #1#128;
          |GRABA 020#0n;
     |FINSI;
|FPRC;

|DEFBUCLE agifa019;
     #1#1;
     128;
     "                    ", "!                   ";
     "zzzzzzzzzzzzzzzzzzzz", "zzzzzzzzzzzzzzzzzzzz";
     ;
     NULL, GrabaFiche;
|FIN;

|PROCESO TeclaF211; |TIPO 11;
     |HAZ TeclaF2;
|FPRC;

|PROCESO TeclaF2; |TIPO 0;
     |SI FSalida = 10;
          aAlfa = "2400NDesea reconstruir el fichero a partir del Articulo:"+&13+"(Los datos actuales se borran)";
          |CONFI aAlfa;
          |SI FSalida = 0;
               nSwReconstruir = 1;
               |PTEC 807;
          |SINO;
               |ERROR;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO F2;
     |PTEC 824;
|FPRC;

|PROGRAMA;
     |CLS;
     |CABEZA "0000Codigos de barras";
     |PINPA #0#0;

     |CONTROL_SIMPLE 0, "BOTON,F2 -Reconstruir a partir de artículos", 0540, 0570, F2;
     nBoton = FSalida;

     |ABRE #0;
     |LEE 000#0p;
     |SI FSalida ! 0;
          |CONFI "2400NDesea crear el fichero a partir del Articulo : ";
          |SI FSalida = 0;
               nLinea = 0;
               |SELECT #2#0;
               |BUCLE agifa019;
          |FINSI;
     |FINSI;
     |CIERRA #0;

     |PARA; |SI; |HACIENDO;
          nSwReconstruir = 0;
          |ENTLINEAL #1#0,1,1,22,0,inferior,superior;
          |SI nSwReconstruir = 1;
               |DELINDEX #0;
               nLinea = 0;
               |ABRE #0;
               |SELECT #2#0;
               |BUCLE agifa019;
               |CIERRA #0;
               |MENAV "0000Proceso finalizado...";
          |SINO;
               |SAL;
          |FINSI;
     |SIGUE;

     |FIN_CONTROL_WINDOWS nBoton;
     |PULSATECLA;
|FPRO;
