|FICHEROS;
     dsy00001 #0;
     dsw00011 #1;
     agifa010 #2;
     agifa071 #3;
     agis0002 #4;
     agifa104 #5;
     agifa073 #6;
     agifa024 #24;
     agifa321 #35;       || Parametros de Divisas
     agifa324 #38;       || Divisas
     agifa069 #69;
     agifa084 #84;
     dscam045@;
     dscam003@;
|FIN;

|VARIABLES;
     &EURODB = 0;
     aEmp = "";
     aAlfa = "";
     aBase = "";
     nEmpresa = 0;
     nSwJamaica = 0;
     &eaArticulo = "";
     &Tempo       = "";
     aTempo1      = "";
     &eaCli       = "";
     &enTiva      = 0;
     &enIva       = 0;
     &enRec       = 0;
     &efFiva = @;

     informe   = "dsy00001";
     fichero   = "";
     hay       = 0;
     total     = 0;
     tped      = 0;
     &nDeci_Base     = 0;   || Decimales en Totales de la moneda base
     &nDeci_PreBase  = 0;   || Decimales en el Precio en moneda base
     &decim_divisa = 0;     || Decimales de la divisa
     &precio_divisa = 0;    || Decimales del precio en divisa
     &nDeci_Div      = 0;   || Decimales en Totales de la divisa
     &nDeci_PreDiv   = 0;   || Decimales en el Precio en divisa
|FIN;

|PROCESO LeeDecimBase; |TIPO 8;
     |ABRE #agifa321;
     |ABRE #agifa324;
     |LEE 001#agifa321.p;
     #agifa324#0 = #agifa321#9; ||Igualo a moneda base
     |LEE 001#agifa324.=;
     nDeci_Base = #agifa324#7;     ||Decimales moneda base
     nDeci_PreBase = #agifa324#9;  ||Decimales precio de moneda base
     decim_divisa = #agifa324#7;  || Decimales de la divisa
     precio_divisa = #agifa324#9;  || Decimales en el precio de la divisa
     nDeci_Div = decim_divisa;   || Decimales de la divisa
     nDeci_PreDiv = precio_divisa;  || Decimales en el precio de la divisa
     |CIERRA #agifa321;
     |CIERRA #agifa324;
|FPRC;

|PROCESO Llena001; |TIPO 6;
     eaArticulo = #0Campo;
     |HAZ LlenaArticulo;
     |SI FSalida = 0;
          #0Campo = eaArticulo;
          |PINTA #0Campo;
     |SINO;
          |ERROR; |ACABA;
     |FINSI;
|FPRC;

|PROCESO dsw00011;
     hay = 1;
     |PRINT;
|FPRC;

|DEFBUCLE dsw00011;
     #1#1;
     ;
     #0#10, #0#8;
     #0#11, #0#9;
     ;
     NULL, dsw00011;
|FIN;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO agifa071;
     |SI nSwJamaica = 0;
          |SI #3#5 ! 0; |Y #3#6 = 0;
               |ACABA;
          |FINSI;
     |FINSI;

     |DDEFECTO #1;
     #1#0 = #3#13;
     #1#1 = #3#2;
     |LEE 101#1=;
     |SI FSalida ! 0; |GRABA 021#1b; |FINSI;
     #1#2 = #1#2 + #3#5;
     #1#3 = #1#3 + #3#37;
     |GRABA 021#1a;
     |LIBERA #1;
|FPRC;

|PROCESO agifa010;
     |DDEFECTO #24;
     #24#0 = #2#3;
     |LEE 000#24=;
     |SI #24#39 < #0#13; |O #24#39 > #0#14; |ERROR; |ACABA; |FINSI;

     #4#30 = "A";
     #4#20 = #2#52
     #4#17 = #2#0;
     #4#18 = 0;
     |LEE 000#4];
     total = 0;
     hay = 0;
     |PARA; |SI FSalida = 0; |Y #4#30 = "A"; |Y #4#20 = #2#52;
               |Y #4#17 = #2#0; |HACIENDO;

          |SI #4#16 ] #0#6; |Y #4#16 [ #0#7;
               hay = 1;
          |FINSI;
          |SI #4#16 [ #0#7;
               total = total + (#4#9 ! EURODB);
          |FINSI;
          |LEE 000#4s;
     |SIGUE;
     |SI total < #2#78; |O hay = 0;
          |ERROR;
     |FINSI;
|FPRC;

|DEFBUCLE agifa010;
     #2#1;
     6;
     #0#2, #0#4, #0#0;
     #0#3, #0#5, #0#1;
     ;
     NULL, agifa010, agifa071;
|FIN;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO TotalPedi;
     |SI nSwJamaica = 0;
          |SI #6#5 ! 0; |Y #6#6 = 0;
               |ACABA;
          |FINSI;
     |FINSI;

     eaCli = #6#20;
     enTiva = #6#14;
     efFiva = #4#1;
     |HAZ IVACli;
     |SI #24#47 = "S";
          tped = tped + #6#9 + (#6#9 * (enRec + enIva) / 100);
     |SINO;
          tped = tped + #6#9 + (#6#9 * enRec / 100);
     |FINSI;
|FPRC;

|PROCESO agifa073;
     |SI nSwJamaica = 0;
          |SI #6#5 ! 0; |Y #6#6 = 0;
               |ACABA;
          |FINSI;
     |FINSI;

     |DDEFECTO #1;
     #1#0 = #6#18;
     #1#1 = #6#2;
     |LEE 101#1=;
     |SI FSalida ! 0; |GRABA 021#1b; |FINSI;
     #1#2 = #1#2 + #6#5;
     tped = 0;
     |HAZ TotalPedi;
     #1#3 = #1#3 + tped;
     |GRABA 021#1a;
     |LIBERA #1;
|FPRC;

|PROCESO agifa104;
     #24#0 = #5#4;
     |LEE 000#24=;
     |SI FSalida ! 0; |DDEFECTO #24; |FINSI;

     |SI #24#39 < #0#13; |O #24#39 > #0#14; |ERROR; |ACABA; |FINSI;

     tped = 0;
     |BUCLELIN 2 TotalPedi #5;

     #4#30 = "P";
     #4#20 = #5#25;
     #4#17 = #5#0;
     #4#18 = 0;
     |LEE 000#4];
     total = 0;
     hay = 0;
     |PARA; |SI FSalida = 0; |Y #4#30 = "P"; |Y #4#20 = #5#25;
               |Y #4#17 = #5#0; |HACIENDO;

          |SI #4#16 ] #0#6; |Y #4#16 [ #0#7;
               hay = 1;
          |FINSI;
          |SI #4#16 [ #0#7;
               total = total + (#4#9 ! EURODB);
          |FINSI;
          |LEE 000#4s;
     |SIGUE;
     |SI total < tped; |O hay = 0;
          |ERROR;
     |FINSI;
|FPRC;

|DEFBUCLE agifa104;
     #5#1;
     7;
     #0#2, #0#4, #0#0;
     #0#3, #0#5, #0#1;
     ;
     NULL, agifa104, agifa073;
|FIN;

|PROCESO agifa069;
     |SI nSwJamaica = 0;
          |SI #69#5 ! 0; |Y #69#6 = 0;
               |ACABA;
          |FINSI;
     |FINSI;

     |DDEFECTO #1;
     #1#0 = #69#13;
     #1#1 = #69#2;
     |LEE 101#1=;
     |SI FSalida ! 0; |GRABA 021#1b; |FINSI;
     #1#2 = #1#2 + #69#5;
     #1#3 = #1#3 + #69#27;
     |GRABA 021#1a;
     |LIBERA #1;
|FPRC;

|PROCESO Recibo;
     |SI #dscam003@#26 ] #0#6; |Y #dscam003@#26 [ #0#7;
          hay = 1;
     |FINSI;
     total = total + #dscam003@#23;
|FPRC;

|DEFBUCLE Recibo;
     #dscam003@#12006;
     69, 26;
     #84#48, #84#0, 001, "01.01.0000", "            ", #84#3, " ", "01.01.0000";
     #84#48, #84#0, 999, "31.12.9999", "zzzzzzzzzzzz", #84#3, " ", #0#7;
     ;
     NULL, Recibo;
|FIN;

|PROCESO dscam045;
     |SI #84#48 ] #dscam045@#4; |Y #84#48 [ #dscam045@#5;
          aEmp = ("00000" + #dscam045@#6) % -105;
          aAlfa = aBase + "dscarter/fich/" + aEmp + "/";
          |PATH_DAT #dscam003@#aAlfa#;
          |BUCLE Recibo;
     |FINSI;
|FPRC;

|DEFBUCLE dscam045;
     #dscam045@#1002;
     2;
     nEmpresa, 001, "V";
     nEmpresa, 999, "V";
     ;
     NULL, dscam045;
|FIN;

|PROCESO agifa084;
     |DDEFECTO #24;
     #24#0 = #84#3;
     |LEE 000#24=;
     |SI #24#39 < #0#13; |O #24#39 > #0#14; |ERROR; |ACABA; |FINSI;
     hay = 0;
     |BUCLE dscam045;
     |SI total < #84#73; |O hay = 0;
          |ERROR;
     |FINSI;
|FPRC;

|DEFBUCLE agifa084;
     #84#1;
     6;
     #0#2, #0#4, #0#0;
     #0#3, #0#5, #0#1;
     ;
     NULL, agifa084, agifa069;
|FIN;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO Tipo3; |TIPO 3;
     |HAZ EsJamaica;
     nSwJamaica = FSalida;

     |HAZ CreaTempo; aTempo1 = Tempo;
     |NOME_DAT #1 Tempo; |DELINDEX #1;

     |IMPRE 0;
     |SI FSalida = 0;
          |INFOR informe;
          |SI FSalida = 0;

               |ABRE #1; |ABRE #4;
               |ABRE #24;
               |SI #0#12 = "A"; |O #0#12 = "T";
                    |BUCLE agifa010;
               |FINSI;
               |SI #0#12 = "P"; |O #0#12 = "T";
                    |BUCLE agifa104;
               |FINSI;
               |SI #0#12 = "F"; |O #0#12 = "T";
                    |DBASS aBase;
                    aAlfa = aBase + "dscarter/def/dscam045";
                    |CARGA_DEF aAlfa, dscam045@;
                    |SI FSalida = 0;
                         aAlfa = aBase + "dscarter/def/dscam003";
                         |CARGA_DEF aAlfa, dscam003@;
                         |SI FSalida = 0;
                              |DFICE aAlfa;
                              aAlfa = aAlfa % -205;
                              nEmpresa = aAlfa;
                              aAlfa = aBase + "dscarter/fich/";
                              |PATH_DAT #dscam045@#aAlfa#;
                              |BUCLE agifa084;
                              |DESCARGA_DEF #dscam003@;
                         |FINSI;
                         |DESCARGA_DEF #dscam045@;
                    |FINSI;
               |FINSI;
               |CIERRA #24;
               |CIERRA #1; |CIERRA #4;

               hay = 0;
               |BUCLE dsw00011;

               |SI hay ! 0; |PIEINF; |FINSI;
               |FININF;
          |FINSI;
          |FINIMP;
     |FINSI;

     |DELINDEX #1; Tempo = aTempo1; |HAZ BoraTempo;
|FPRC;
