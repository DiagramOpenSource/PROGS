  Pedido

|FICHEROS;
     tagm0092 #0;
     tagm0093 #1,MANTE;
     dsm00003 #3;
     tagz0032 #32,MANTE;
     agifa019 #19;
     dsm00020 #20;
     agifa024 #24;
     agifa025 #25;
     agifa073 #73;
     tagm0079 #79;
     tagm0081 #81;
     tagm0084 #84;
     agifa104 #104;
     agifa142 #142;
     agifa321 #321;
     agifa324 #324;
|FIN;

|INCLUYE i_varart;

|VARIABLES;
     &enSwMenu = 0;
     &aDivisa = "";
     &aMoneda = "";
     &enDescuento1 = 0;
     &enDescuento2 = 0;
     &eaTComision = "";
     &enComision = 0;
     &eaTag = "";

     &num_alb = 0;
     &fec_alb = @;
     &eaSerPedido = "";
     &enNumPedido = 0;
     &ser_ped = "";
     &num_ped = 0;

     nCalc = 0;
     nImpo = 0;
     nForma = 1;
     mes = 0;
     fmes = "";
     nImpoIva = 0;
     aAlfa = "";
|FIN;

|PROCESO ActCli;
     #19#0 = #73#2;
     |LEE 020#19=;

     #24#0 = #104#4;
     |LEE 101#1=;
     |SI FSalida = 0;
          |SI #19#194 = 2;
               nImpo = ((((#73#44 * #73#6) < #73#8) < #73#29) < #104#5) < #104#17;
          |SINO;
               nImpo = ((((#73#5 * #73#6) < #73#8) < #73#29) < #104#5) < #104#17;
          |FINSI;
          |SI #142#115 = "S";
               nImpo = nImpo < #104#6;
          |FINSI;
          nImpo = nImpo * nForma;
          fmes = #104#1 % A402;
          mes = fmes - 1;
          mes = mes * 3;
          mes = mes + 114;
          #24mes = #24mes   + nImpo;     || VENTA.
          #24#150 = #24#150 + nImpo;
          |GRABA 020#24a;
          |LIBERA #24;

          eaCliente = #104#4;
          efFecha = #104#1;
          enImpCliPed = nImpo;
          |HAZ AcumulaCli;
     |FINSI;

     eaCli = #104#4;
     enTiva = #73#14;
     efFiva = #104#1;
     |HAZ IVACli;
     nCalc = #73#11 % enIva;
     |SI #24#47 = "S";
          nCalc = nCalc + (#73#11 % enRec);
     |FINSI;
     nImpoIva = nImpoIva + (#73#11 + nCalc);
|FPRC;

|PROCESO LinPed;
     |ABRE #19;
     #19#0 = #1#2;
     |LEE 000#19=;
     |SI FSalida ! 0; |DDEFECTO #19; |FINSI;
     |CIERRA #19;

     |DDEFECTO #73;
     #73#28 = #104#25;
     #73#0 = #104#0;
     #73#1 = #1#1;
     #73#2 = #1#2;
     #73#3 = #1#7;
     #73#4 = #1#3;
     #73#5 = #1#4;
     #73#6 = #1#5;
     #73#8 = #1#8;
     #73#13 = #104#2;
     #73#14 = #19#30;
     #73#16 = #104#7;
     #73#17 = #104#16;
     #73#18 = #19#2;
     #73#19 = #104#18;
     #73#20 = #104#4;
     #73#22 = #142#227;
     #73#23 = #104#5;
     #73#24 = #104#6;
     #73#25 = #104#17;
     #73#26 = #104#9;
     #73#29 = #1#9;
     #73#42 = #1#4;
     #73#44 = #1#13;
     #73#48 = #1#13;

     #73#50 = #1#10;
     #73#51 = #1#11;
     #73#52 = #1#12;

     enDescuento1 = #73#8;
     enDescuento2 = #73#29;
     eaTComision  = #73#17;
     eaCliente    = #104#4;
     eaRepre      = #104#7;
     eaArticulo   = #73#2;
     efFecha      = #104#1;
     eaSerie      = #73#28;
     enDirEnt = #104#57;
     enAlmacen = #73#3;
     |HAZ Comisiones;
     #73#10 = enComision;

     |GRABA 020#73n;
     enForma = 1;
     |HAZ AcumulaPV;
|FPRC;

|PROCESO CabPed;
     |ABRE #24;
     #24#0 = #0#2;
     |LEE 000#24=;
     |SI FSalida ! 0; |DDEFECTO #24; |FINSI;
     |CIERRA #24;

     |ABRE #25;
     #25#0 = #32#4;
     |LEE 000#25=;
     |SI FSalida ! 0; |DDEFECTO #25; |FINSI;
     |CIERRA #25;

     |ABRE #3;
     #3#0 = #0#2;
     #3#1 = 1;
     |LEE 000#3=;
     |SI FSalida ! 0; |DDEFECTO #3; |FINSI;
     |CIERRA #3;

     #104#25 = #32#0;
     enSwMenu = 1;
     |HAZ ContaPV7;
     |GRABA 020#104b;
     #104#1 = #32#1;
     #104#2 = #104#1;
     #104#3 = #0#0;
     #104#4 = #0#2;
     #104#5 = #0#5;
     #104#6 = #0#6;
     #104#7 = #32#4;
     #104#8 = #24#2;
     #104#9 = #0#4;
     #104#14 = #3#2;
     #104#15 = #0#9;
     #104#16 = #25#7;
     #104#17 = #0#7;
     #104#18 = #24#4;
     #104#19 = #3#10;
     #104#20 = #3#3;
     #104#21 = #3#7;
     #104#22 = #24#47;
     #104#23 = #24#41;
     #104#35 = #24#192;

     #324#0 = #104#35;
     |LEE 000#324=;
     #104#36 = #324#2;

     #104#37 = #24#193;
     #104#40 = #321#9;

     #324#0 = #104#40;
     |LEE 000#324=;
     #104#41 = #324#2;

     #104#57 = 1;
     #104#59 = #3#6;
     #104#60 = #32#2;
     #104#64 = #24#15;
     |GRABA 020#104a;

     #79#0 = #104#25;
     #79#1 = #104##0;
     |LEE 101#79=;
     |SI FSalida = 0; |BORRA 020#79a; |FINSI;
     |DDEFECTO #79;
     #79#0 = #104#25;
     #79#1 = #104#0;
     #79#3 = #0#15;
     |GRABA 020#79n;

     aDivisa = #104#35;
     aMoneda = #104#37;
     |HAZ Divisas104;
|FPRC;

|DEFBUCLE LinPed;
     #1#1;
     ;
     #0#0, 001;
     #0#0, 999;
     ;
     NULL, LinPed;
|FIN;

|PROCESO FinalPed;
     num_alb = 0;
     fec_alb = #104#1;
     eaSerPedido = #104#25;
     enNumPedido = #104#0;
||     |HAZ TagloFacPed;
     |CONFI "0000N¿Asignar procesos al pedido?";
     |SI FSalida = 0;
          ser_ped = #104#25;
          num_ped = #104#0;
          |SUB_EJECUTA_NP "tagz0018;N";
     |FINSI;

     |CONFI "2400N¨Desea imprimir el pedido? ";
     |SI FSalida = 0;
          ser_ped = #104#25;
          num_ped = #104#0;
          |SUB_EJECUTA_NP "agifa105.run";
     |FINSI;
|FPRC;

|PROCESO Pedido;
     |LEE 101#0=;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |ABRE #142; |LEE 000#142p; |CIERRA #142;
     |ABRE #321; |LEE 000#321p; |CIERRA #321;

     aAlfa = Usuario % 810;
     |ABRE #84;
     #84#0 = aAlfa;
     |LEE 000#84=;
     |SI FSalida ! 0; |DDEFECTO #84; |FINSI;
     |CIERRA #84;
     |ABRE #81;
     #81#0 = #84#7;
     |LEE 000#81=;
     |SI FSalida ! 0; |DDEFECTO #81; |FINSI;
     |CIERRA #81;

     |DDEFECTO #32;
     #32#0 = #142#186;
     #32#1 = ~;
     #32#2 = #0#8;
     #32#4 = #0#3;

     |ABRE #20;
     #20#0 = #32#2;
     |LEE 000#20=;
     |CIERRA #20;

     |ABRE #25;
     #25#0 = #32#4;
     |LEE 000#25=;
     |CIERRA #25;

     #32#3 = #20#1;
     #32#5 = #25#1;

     |VENTANA 1008, 1690, -1, 17, "Pase a pedido";
     |HAZ PushVenModal;
     |PINPA #0#32;
     |PINDA #0#32;
     |ENDATOS #1#32;
     |SI FSalida = 0;
          |ABRE #324;
          |ABRE #104;
          |ABRE #79;
          |ABRE #73;
          |HAZ CabPed;
          |BUCLE LinPed;
          |HAZ CalCabAgifa104;
          |GRABA 020#104a;

          nImpoIva = 0;
          |ABRE #24;
          |ABRE #19;
          |BUCLELIN 2 ActCli #0;
          |CIERRA #24;
          |CIERRA #19;
          nImpo = nImpoIva; eaTag = "PE";  |HAZ Riesgos;

          #0#10 = "PE";       |PINTA #0#10;
          #0#11 = #104#25;    |PINTA #0#11;
          #0#12 = #104#0;     |PINTA #0#12;
          |GRABA 020#0a;

          |CIERRA #73;
          |CIERRA #79;
          |CIERRA #104;
          |CIERRA #324;

          |HAZ FinalPed;
     |FINSI;
     |HAZ PopVenModal;

     |LIBERA #0;
|FPRC;
