|FICHEROS;
     gosubest #0;
     gosubcoc #1;             ||Subcontratas/Certificaciones
     gosubpar #2;
     gosubes2 #3,MANTE;
     agifa112 #4;             ||Proveedores
     gopre001 #5;             ||Presupuestos

     guerm030 #30;
     guerm031 #31;
     goparame #100;
|FIN;
----------------------------------------------------------------------
|VARIABLES;
     &eaCer = "";
     aDFin = "";
     aHFin = "";
     &cCodMonDe     = "";
     &cCodMonA      = "";
     &nPrecioComp   = 0;
     &nPrecioVent   = 0;
     &cCodMonBase   = "";
     &cDesMonBase   = "";
     &cCodMonTrab   = "";
     &cDesMonTrab   = "";
     &nDeci_PBase   = 0;
     &nDeci_TBase   = 0;
     &nDeci_PTrab   = 0;
     &nDeci_TTrab   = 0;
     &nDeci_TotVis  = 0;
     &nEurComTrab   = 0;
     &nEurComBase   = 0;
     &nEurVenTrab   = 0;
     &nEurVenBase   = 0;
     cFich     = "";
     nLinea    = 0;
     nToma     = 0;
     nHay      = 0;
|FIN;
----------------------------------------------------------------------
|PROCESO TomaPart;
     cCodMonTrab = #1#8;
     |HAZ MonBas;
     |SI #0#4 = "P"; |Y #2#12 ! #2#9;
          nToma = 1;
     |FINSI;
     |SI #0#4 = "C"; |Y #2#9 ! 0;
          nToma = 1;
     |FINSI;
     |SI nToma = 1;
          nHay = 1;
          nLinea = nLinea + 1;
          #3#0 = #1#0;                            ||Numero Contrata.
          #3#1 = #1#4;                            ||Serie Pres.
          #3#2 = #1#5;                            ||Numero Pres.
          #3#3 = #1#6;                            ||Cliente.
          #3#4 = #1#7;                            ||Nombre.
          #3#5 = #1#2;                            ||Contratista.
          #3#6 = #1#3;                            ||Nombre.
          #3#7 = #1#8;                            ||Moneda.
          #3#8 = #1#1;                            ||Fecha.
          #3#9 = nLinea;
          #3#10 = #2#3;                           ||Partida.
          #3#11 = #2#4;                           ||Descripcion.
          #3#12 = #2#6;                           ||U.M.
          #3#13 = #2#9;                           ||Importe Certificado.
          #3#14 = #2#12;                          ||Importe Contratado.
          #3#15 = #3#14-#3#13;                    ||Pendiente.
          #3#16 = #2#14;
          #3#17 = #2#16;
          #3#18 = #3#16 - #3#17;
          #3#19 = #2#13;
          #3#20 = #2#2; ||Lin
          #3#21 = #2#1; ||Capi
          |GRABA 020#3n;
          cCodMonTrab = cCodMonBase;
          |HAZ MonBas;
          cCodMonDe = #3#7;               ||Moneda Presupuesto
          cCodMonA  = cCodMonBase;        ||Moneda Base
          nPrecioComp = #3#14;            ||Precio
          |HAZ DemonAmon;
          #0#6  = #0#6  + nPrecioComp;    ||Total Contratado.
          nPrecioComp = #3#13;            ||Precio
          |HAZ DemonAmon;
          #0#7  = #0#7  + nPrecioComp;    ||Total Certificado.
          nPrecioComp = #3#15;            ||Precio
          |HAZ DemonAmon;
          #0#8  = #0#8  + nPrecioComp;    ||Total Pendiente.
          #0#13 = #0#13 + #3#16;
          #0#14 = #0#14 + #3#17;
          #0#15 = #0#15 + #3#18;
          nToma = 0;
     |FINSI;
|FPRC;
-------------------------------------------------------------------------------
|DEFBUCLE TomaPart;
     #2#1;
     ;
     #1#0,"                  ",  1;
     #1#0,"zzzzzzzzzzzzzzzzzz",999;
     ;
     NULL, TomaPart;
|FIN;
-------------------------------------------------------------------------------
|PROCESO SacaPart;
     |BUCLE TomaPart
|FPRC;
-------------------------------------------------------------------------------
|DEFBUCLE TomaDatos;
     #1#1;
     2,4,5, 20;
     #0#0,#0#2,#0#9,#0#11, aDFin;
     #0#1,#0#3,#0#10,#0#12, aHFin;
     ;
     NULL, SacaPart;
|FIN;
-------------------------------------------------------------------------------
|PROCESO Salida; |TIPO 3;
     |SI #0#16 = "T";
          aDFin = " ";
          aHFin = "z";
     |SINO;
          aDFin = #0#16;
          aHFin = #0#16;
     |FINSI;

     cFich = Usuario;
     |NOME_DAT #3 cFich;
     |DELINDEX #3;

     |ABRE #3;
     nLinea = 0;
     nHay = 0;
     |BUCLE TomaDatos;
     |SI nHay = 1;
          |SI #0#5 = "P";
               || |PUSHV 05012380;
               |PINPA #0#3;
               |PINTA 2114, #0#13;
               |PINTA 2123, #0#14;
               |PINTA 2132, #0#15;
               cCodMonTrab = cCodMonBase;
               |HAZ MonBas;
               |COLOR 12, 0;|ATRI 0;
               |PINTA 2110, cCodMonBase;
               |ATRI 0;
               |PINTA 2142, #0#6;
               |PINTA 2155, #0#7;
               |PINTA 2168, #0#8;
               |ENTLINEAL #1#3,-1,4,20,0,cMin,cMax;
               || |POPV;
          |SINO;
               |HAZ ImpSubCer;
          |FINSI;
     |FINSI;
     |CIERRA #3;

     |DELINDEX #3;
|FPRC;
-------------------------------------------------------------------------------
|PROCESO cMin;
     #3#9 = 1;
|FPRC;
-------------------------------------------------------------------------------
|PROCESO cMax;
     #3#9 = 999;
|FPRC;
-------------------------------------------------------------------------------
|PROCESO Entrada; |TIPO 7;
     |ABRE #4;
     |LEE 000#4p;
     |SI FSalida = 0;
          #0#2 = #4#0;        ||Codigo Proveedor
     |FINSI;
     |LEE 000#4u;
     |SI FSalida = 0;
          #0#3 = #4#0;        ||Codigo Proveedor
     |FINSI;
     |CIERRA #4;
     |ABRE #1;
     |LEE 000#1p;
     |SI FSalida = 0;
          #0#0 = #1#0;        ||Subcontrata
     |FINSI;
     |LEE 000#1u;
     |SI FSalida = 0;
          #0#1 = #1#0;        ||Subcontratas
     |FINSI;
     |CIERRA #1;
     |ABRE #5;
     |LEE 000#5p;
     |SI FSalida = 0;
          #0#9 = #5#0;        ||Serie presupuesto
          #0#11 = #5#1;       ||Numero presupuesto
     |FINSI;
     |LEE 000#5u;
     |SI FSalida = 0;
          #0#10 = #5#0;       ||Serie presupuesto
          #0#12 = #5#1;       ||Numero presupuesto
     |FINSI;
     |CIERRA #5;
     |PINDA #0#0;
|FPRC;
-------------------------------------------------------------------------------
|PROCESO guerm031;
     |SI #31#13 = #3#20; |Y #31#3 = #3#21;
          eaCer = "S";
          |PRINT;
     |FINSI;
|FPRC;

|DEFBUCLE guerm030;
     #30#2;
     ;
     #3#0;
     #3#0;
     ;
     NULL,  NULL, guerm031;
|FIN;

|PROCESO Imp;
     |BUCLE guerm030;
     |DDEFECTO #30;
     |DDEFECTO #31;
     eaCer = "N";
     |PRINT;
|FPRC;
-------------------------------------------------------------------------------
|DEFBUCLE ImpCerSub;
     #3#1;
     ;
     1;
     999;
     ;
     NULL, Imp;
|FIN;
-------------------------------------------------------------------------------
|PROCESO ImpSubCer;
     ||SUB_EJECUTA_NP "goinform;IMPgosubcer";
     Impresora = "CrystalReport"; |IMPRE -1;
     |INFOR "gosubcer";
     |BUCLE ImpCerSub;
     |PIEINF;
     |FININF;
     |FINIMP;
     ||SUB_EJECUTA_NP "goinform;ENVgosubcer";
     ||SUB_EJECUTA_NP "goinform;RUNgosubcer";
|FPRC;
-------------------------------------------------------------------------------
|PROCESO Tipo13; |TIPO 13;
     |ABRE #100; |LEE 000#100p; |CIERRA #100;
     |SI #100#141 = "O";
          |ATRI R; |PINTA 1204, "   O.T.    "; |ATRI 0;
     |FINSI;
|FPRC;
