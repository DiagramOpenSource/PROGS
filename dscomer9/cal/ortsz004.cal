|FICHEROS;
     ortsz004 #0;
     ortsz005 #1,MANTE;
     agifm002 #2;
     agifa024 #24;
     referen@;
|FIN;

|VARIABLES;
     aOrg = "";
     aDes = "";
     aAlfa = "";
     aClave = "";
     nTecla = 0;
     nPrime = 0;
     nInc = 0;
     nRuta = 0;
     aTmp0 = "";
     aTmp1 = "";
     aFic = "";
|FIN;

|PROCESO Temporal;
     aAlfa = ("000000" + #1#5) % -106;
     #24#0 = #1#1;
     |LEE 101#24=;
     |SI FSalida = 0;
          #24#189 = aAlfa;
          |GRABA 020#24a;

          |DDEFECTO #2;
          #2#0 = aAlfa;
          |LEE 101#2=;
          |SI FSalida ! 0; |GRABA 020#2b; |FINSI;
          #2#1 = #1#2;
          |GRABA 020#2a;
          |LIBERA #2;
     |FINSI;
     |LIBERA #24;
|FPRC;

|DEFBUCLE Temporal;
     #1#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Temporal;
|FIN;

|PROCESO CopiaFichero;
     |DELINDEX #1;
     |DFICE aFic;
     aOrg = aFic + aTmp1 + ".dat";
     aDes = aFic + aTmp0 + ".dat";
     |COPIA_FICHERO aOrg, aDes;
     aOrg = aFic + aTmp1 + ".ixx";
     aDes = aFic + aTmp0 + ".ixx";
     |COPIA_FICHERO aOrg, aDes;
|FPRC;

|PROCESO Ordena;
     aAlfa = (("000" + #1#5) % -103) + (("000" + #1#6) % -103) + #1#1;
     #referen@#0 = aAlfa;
     #referen@#1 = #1#1;
     #referen@#2 = #1#2;
     #referen@#3 = #1#3;
     #referen@#4 = #1#4;
     #referen@#5 = #1#5;
     #referen@#6 = #1#6;
     |GRABA 020#referen@.n;
|FPRC;

|DEFBUCLE Ordena;
     #1#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Ordena;
|FIN;

|PROCESO BRenumera;
     |SI nPrime = 0;
          nPrime = 1;
          nRuta = #1#5;
     |SINO;
          nRuta = nRuta + nInc;
     |FINSI;
     aAlfa = (("000" + nRuta) % -103) + (("000" + #1#6) % -103) + #1#1;
     #referen@#0 = aAlfa;
     #referen@#1 = #1#1;
     #referen@#2 = #1#2;
     #referen@#3 = #1#3;
     #referen@#4 = #1#4;
     #referen@#5 = nRuta;
     #referen@#6 = #1#6;
     |GRABA 020#referen@.n;
|FPRC;

|DEFBUCLE BRenumera;
     #1#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, BRenumera;
|FIN;

|PROCESO Renumera;
     |PUSHV 0501 2380;
     |PINTA 2316, "Incremento para numeracion de Rutas:";
     |C_V #0#2, 1, "S";
     |ENCAMPO #2#0;
     |SI FSalida = 0;
          nPrime = 0;
          nInc = #0#2;
          |BUCLE BRenumera;
          |HAZ CopiaFichero;
     |SINO;
          |MENAV "0000Cancelado por el usuario";
     |FINSI;
     |C_V #0#2, 1, "N";
     |POPV;
|FPRC;

|PROCESO Tecla; |TIPO 11;
     |SI FSalida = 10; |O FSalida = 11;
          |SI nTecla = 0;
               nTecla = FSalida;
          |FINSI;
          |ERROR; |PTEC 807;
     |FINSI;
|FPRC;

|PROCESO agifa024;
     #1#1 = #24#0;
     #1#2 = #24#1;
     #1#3 = #24#5;
     #1#4 = #24#6;
     #1#5 = #24#189;
     #1#6 = 9;
     aAlfa = (("000" + #1#5) % -103) + (("000" + #1#6) % -103) + #1#1;
     #1#0 = aAlfa;
     |GRABA 020#1n;
|FPRC;

|DEFBUCLE agifa024;
     #24#1;
     3;
     "      ", #0#0;
     "zzzzzz", #0#0;
     ;
     NULL, agifa024;
|FIN;

|PROCESO Min;
     #1#0 = " " * 10;
     #1#1 = " " * 6;
|FPRC;

|PROCESO Max;
     #1#0 = "z" * 10;
     #1#1 = "z" * 6;
|FPRC;

|PROGRAMA;
     aTmp0 = Usuario; |NOME_DAT #1 aTmp0; |DELINDEX #1;

     |CLS;
     |PINPA #0#0;
     |PINDA #0#0;
     |ENTLINEAL #1#1, 2, 7, 22, 0, Min, Max;
     |ENDATOS #1#0;
     |SI FSalida = 0;
          aClave = "";
          |ABRE #1;
          |BUCLE agifa024;
          |CIERRA #24;

          |PARA nTecla = 1; |SI nTecla ! 0; |HACIENDO;
               nTecla = 0;
               |ENTLINEAL #1#1, 2, 2, 22, 0, Min, Max;
               |SI nTecla ! 0;
                    |DDEF aAlfa;
                    aAlfa = aAlfa + "ortsz005";
                    |CARGA_DEF aAlfa, referen@;
                    |SI FSalida = 0;
                         aTmp1 = Usuario; aTmp1 = aTmp1 + 1;
                         |NOME_DAT #referen@#aTmp1#;
                         |DELINDEX #referen@;
                         |ABRE #referen@;
                         |SI nTecla = 10;
                              |BUCLE Ordena;
                              |HAZ CopiaFichero;
                         |FINSI;
                         |SI nTecla = 11;
                              |HAZ Renumera;
                         |FINSI;
                         |CIERRA #referen@;
                         |DELINDEX #referen@;
                         |DESCARGA_DEF #referen@;
                    |FINSI;
               |FINSI;
          |SIGUE;
          |CONFI "0000SActualizar datos";
          |SI FSalida = 0;
               |ABRE #24;
               |ABRE #2;
               |BUCLE Temporal;
               |CIERRA #2;
               |CIERRA #24;
          |FINSI;
     |FINSI;

     |DELINDEX #1;
|FPRO;
