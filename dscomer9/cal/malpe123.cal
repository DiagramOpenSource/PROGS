|FICHEROS;
     malpe123 #0;
     malpe124 #1,MANTE;
     agifa017 #17,MANTE;
     agifa019 #19,MANTE;
     dsm00024 #24,MANTE;
     dsm00056 #56;
     dsm00057 #57;
     malpe085 #85;
     malpe122 #122;
|FIN;

|VARIABLES;
     nSwAlta = 0;
     &enForma = 0;
     aMarca = "";
     nSal = 0;
     nError = 0;
     &Tempo = "";
     aTempo1 = "";
     aAlfa = "";
     aAlf1 = "";
     nPrime = 0;
     nLin = 0;
     nConta = 0;
     aSerie = "";
     aAlf2 = "";
     nNume1 = 0;
     nNume2 = 0;
     aDHora = "";
     aHHora = "";
     nHay = 0;
 {-1}aMenu  = "";
     aMenu1 = "2400";
     aMenu2 = "1";
     aMenu3 = "Opciones : ";
     aMenu4 = "RAC";
     aMenu5 = " Repasar ";
     aMenu6 = " Aceptar ";
     aMenu7 = " Cancelar ";
|FIN;

|PROCESO CabEntra;
     |DDEFECTO #56;
     #56#2 = aSerie;
     aSerie = #56#2;
     #56#0 = 999999;
     |LEE 000#56];
     |SI FSalida = 0;
          |LEE 000#56a;
     |SINO;
          |LEE 000#56u;
     |FINSI;
     |SI FSalida = 0; |Y #56#2 = aSerie;
          nConta = #56#0 + 1;
     |SINO;
          nConta = 1;
     |FINSI;
     |DDEFECTO #56;
     #56#0 = nConta;
     #56#1 = ~;
     #56#2 = aSerie;
     |GRABA 020#56n;
|FPRC;

|PROCESO EntradaStock;
     |SI nPrime = 0; |O nLin > 99999;
          nPrime = 1;
          nLin = 0;
          |HAZ CabEntra;
     |FINSI;
     nLin = nLin + 1;
     |DDEFECTO #57;
     #57#28 = #56#2;
     #57#27 = #56#0;
     #57#14 = nLin;

     #57#0 = #1#1;
     #57#1 = #0#0;
     #57#2 = #19#1;
     #57#3 = #19#104;
     #57#4 = #1#3 * #1#4;
     #57#5 = #19#27;
     #57#6 = #19#9;
     #57#11 = #19#9;
     #57#12 = #56#1;
     #57#13 = #19#6;
     #57#18 = #19#165;
     #57#19 = #19#9;
     #57#22 = #1#0;
     |GRABA 020#57n;

     enForma = 1;
     |HAZ AcumulaEV;
|FPRC;

|PROCESO Act122;
     #122#7 = "S";
     |GRABA 020#122a;
     |LIBERA #122;
|FPRC;

|DEFBUCLE Act122;
     #122#1;
     6, 7;
     #0#0, 0000, #0#1, aDHora, #1#1, #0#4, #1#0, "N";
     #0#0, 9999, #0#1, aHHora, #1#1, #0#4, #1#0, "N";
     be;
     NULL, Act122;
|FIN;

|PROCESO Tmp;
     |SI #1#6 ! "*";
          |ACABA;
     |FINSI;

     |ABRE #19;
     #19#0 = #1#1;
     |LEE 020#19=;
     |CIERRA #19;

     |DDEFECTO #17;
     |ABRE #17;
     #17#0 = #1#1;
     #17#1 = #0#0;
     |LEE 020#17=;
     |CIERRA #17;

     |DDEFECTO #24;
     |ABRE #24;
     #24#0 = #1#1;
     #24#1 = #0#0;
     #24#2 = #1#0;
     |LEE 121#24=;
     |SI FSalida = 0;
          aAlfa = #1#9; |QBF aAlfa;
          |SI aAlfa ! "";
               #24#28 = #1#9;
               |GRABA 020#24a;
          |FINSI;
     |FINSI;
     |CIERRA #24;

     |SI #0#4 = 2 ;
          |BUCLE Act122;
          |ACABA;
     |FINSI;

     |DDEFECTO #85;
     |ABRE #85;
     #85#0 = #1#1;
     #85#1 = #0#0;
     #85#2 = #1#0;
     |LEE 1010#85=;
     |SI FSalida ! 0; |GRABA 020#85b; |FINSI;
     #85#4 = #1#4;
     #85#5 = #1#8;
     #85#6 = #1#11;
     #85#7 = #1#7;
     #85#8 = #1#10;
     |GRABA 020#85a;
     |CIERRA #85;

     |BUCLE Act122;
     |HAZ EntradaStock;
|FPRC;

|DEFBUCLE Tmp;
     #1#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Tmp;
|FIN;

|PROCESO Actualiza;
     |ABRE #122;
     |ABRE #56;
     |ABRE #57;
     |BUCLE Tmp;
     |CIERRA #57;
     |CIERRA #56;
     |CIERRA #122;
|FPRC;

|PROCESO AltaPartida;
     nSwAlta = 1;
     nError = 0;
     |PUSHV 01012380;
     |CLS;
     |GRABA 020#24b;
     |PINPA #0#24;
     |PINDA #0#24;
     |AVISO;
     |CONFI "0000SConfirmar Alta (S/N)";
     |SI FSalida ! 0;
          |BORRA 020#24c;
          nError = 1;
     |SINO;
          |ENDATOS #1#24;
          |SI FSalida ! 0;
               |BORRA 020#24c;
               nError = 1;
          |FINSI;
     |FINSI;
     |POPV;
     FSalida = nError;
|FPRC;

|PROCESO AltaAlmacen;
     nSwAlta = 1;
     nError = 0;
     |PUSHV 01012380;
     |CLS;
     |GRABA 020#17b;
     |PINPA #0#17;
     |PINDA #0#17;
     |AVISO;
     |CONFI "0000SConfirmar Alta (S/N)";
     |SI FSalida ! 0;
          |BORRA 020#17c;
          nError = 1;
     |SINO;
          |ENDATOS #1#17;
          |SI FSalida ! 0;
               |BORRA 020#17c;
               nError = 1;
          |FINSI;
     |FINSI;
     |POPV;
     FSalida = nError;
|FPRC;

|PROCESO AltaArticulo;
     nSwAlta = 1;
     nError = 0;
     |PUSHV 01012380;
     |CLS;
     |GRABA 020#19b;
     |PINPA #0#19;
     |PINDA #0#19;
     |AVISO;
     |CONFI "0000SConfirmar Alta (S/N)";
     |SI FSalida ! 0;
          |BORRA 020#19c;
          nError = 1;
     |SINO;
          |ENDATOS #1#19;
          |SI FSalida ! 0;
               |BORRA 020#19c;
               nError = 1;
          |FINSI;
     |FINSI;
     |POPV;
     FSalida = nError;
|FPRC;

|PROCESO malpe122;
     |DDEFECTO #19;
     #19#0 = #122#4;
     |LEE 000#19=;
     |SI FSalida ! 0;
          aAlfa = "0000Articulo inexistente:" + &13+ "[" + #19#0+ "]";
          |MENAV aAlfa;
     |FINSI;

     |DDEFECTO #85;
     #85#0 = #122#4;
     #85#1 = #0#0;
     #85#2 = #122#6;
     |LEE 000#85=;

     |DDEFECTO #24;
     #24#0 = #85#0;
     #24#1 = #85#1;
     #24#2 = #85#2;
     |LEE 000#24=;

     |DDEFECTO #1;
     #1#0 = #122#6; ||Parti
     #1#1 = #122#4; ||Arti
     |LEE 101#1=;
     |SI FSalida ! 0; |GRABA 020#1b; |FINSI;
     #1#2 = #19#1;
     #1#3 = #1#3 + 1;
     #1#4 = #85#4;
     #1#5 = #85#3;
     #1#6 = "";
     #1#7 = #85#7;
     #1#8 = #85#5;
     |SI #0#4 = 2;  ||Carretila
          aAlfa = #122#8; |QBF aAlfa;
          |SI aAlfa ! "";
               #1#9 = #122#8;
          |FINSI;
     |SINO;
          #1#9 = #24#28;
     |FINSI;
     #1#10 = #85#8;
     #1#11 = #85#6;
     |GRABA 020#1a;
     |LIBERA #1;
     nHay = 1;
|FPRC;

|DEFBUCLE malpe122;
     #122#1;
     7;||Alma, Lector, Fecha, Hora, Arti, Tipo
     #0#0, 0000, #0#1, aDHora, "                    ", #0#4, "N";
     #0#0, 9999, #0#1, aHHora, "zzzzzzzzzzzzzzzzzzzz", #0#4, "N";
     ;
     NULL, malpe122;
|FIN;

|PROCESO CheqHora; |TIPO 0;
     aAlf1 = #0Campo % 102;
     aAlf2 = #0Campo % 402;
     nNume1 = aAlf1 $ 24;
     nNume2 = aAlf2 $ 60;
     aAlf1 = ("00" + nNume1) % -102;
     aAlf2 = ("00" + nNume2) % -102;
     aAlfa = aAlf1 + ":" + aAlf2;
     #0Campo = aAlfa;
     |PINTA #0Campo;
|FPRC;

|PROCESO MiraExiste;
     nSwAlta = 0;
     nSal = 0;
     |ABRE #19;
     #19#0 = #1#1;
     |LEE 000#19=;
     |SI FSalida ! 0; |HAZ AltaArticulo; |FINSI;
     nSal = FSalida;
     |CIERRA #19;
     |SI nSal ! 0; FSalida = nSal; |ACABA; |FINSI;

     |ABRE #17;
     |DDEFECTO #17;
     #17#0 = #1#1;
     #17#1 = #0#0;
     |LEE 101#17=;
     |SI FSalida ! 0; |HAZ AltaAlmacen; |FINSI;
     |SI FSalida = 0;
          |ABRE #24;
          |DDEFECTO #24;
          #24#0 = #1#1;
          #24#1 = #0#0;
          #24#2 = #1#0;
          |LEE 101#24=;
          |SI FSalida ! 0; |HAZ AltaPartida; |FINSI;
          |SI FSalida ! 0;
               nSal = 1;
          |SINO;
               |ABRE #85;
               #85#0 = #24#0;
               #85#1 = #24#1;
               #85#2 = #24#2;
               |LEE 000#85=;
               |SI FSalida ! 0;
                    |MENAV "0000ERROR. no existe registro en auxiliar partidas";
               |FINSI;
               |CIERRA #85;
               |SI nSwAlta = 1; |Y #0#4 = 1; || Si se dio de alta y tipo=1
                    #1#2 = #19#1; |PINTA #1#2;
                    #1#4 = #85#4; |PINTA #1#4;
                    #1#5 = #85#3; |PINTA #1#5;
                    #1#7 = #85#7; |PINTA #1#7;
                    #1#10 = #85#8; |PINTA #1#10;
                    #1#8 = #85#5; |PINTA #1#8;
                    #1#9 = #24#28; |PINTA #1#9;
                    #1#11 = #85#6; |PINTA #1#11;
               |FINSI;
          |FINSI;
          |CIERRA #24;
     |SINO;
          nSal = 1;
     |FINSI;
     |CIERRA #17;
     FSalida = nSal;
|FPRC;

|PROCESO Marca0; |TIPO 0;
     nSal = FSalida;
     |SI FSalida = 0; |Y #1Campo = Contenido;
          |SI #1#6 = "*";
               #1#6 = "";
          |SINO;
               |HAZ MiraExiste;
               |SI FSalida = 0;
                    #1#6 = "*";
               |SINO;
                    |ERROR; |ACABA;
               |FINSI;
          |FINSI;
          |GRABA 020#1a;
          |PINTA #1#6;
     |FINSI;
|FPRC;

|PROCESO Marca11; |TIPO 11;
     nSal = FSalida;
     |SI nSal = 10; ||F2
          |HAZ MiraExiste;
          |SI FSalida ! 0; |ERROR; |ACABA; |FINSI;
          |SI #0#4 = 2;
               |ENCAMPO #9#1;
          |SINO;
             |ET E0;
               |ENCAMPO #3#1;
               |SI FSalida ! 0; |VETE Fin; |FINSI;

             |ET E1;
               |ENCAMPO #4#1;
               |SI FSalida = 2; |VETE E0; |FINSI;
               |SI FSalida ! 0; |VETE Fin; |FINSI;

             |ET E2;
               |ENCAMPO #7#1;
               |SI FSalida = 2; |VETE E1; |FINSI;
               |SI FSalida ! 0; |VETE Fin; |FINSI;

             |ET E3;
               |ENCAMPO #10#1;
               |SI FSalida = 2; |VETE E2; |FINSI;
               |SI FSalida ! 0; |VETE Fin; |FINSI;

             |ET E4;
               |ENCAMPO #8#1;
               |SI FSalida = 2; |VETE E3; |FINSI;
               |SI FSalida ! 0; |VETE Fin; |FINSI;

             |ET E5;
               |ENCAMPO #11#1;
               |SI FSalida = 2; |VETE E4; |FINSI;
               |SI FSalida ! 0; |VETE Fin; |FINSI;

             |ET E6;
               |ENCAMPO #9#1;
               |SI FSalida = 2; |VETE E5; |FINSI;
               |SI FSalida ! 0; |VETE Fin; |FINSI;
          |FINSI;
        |ET Fin;
          |SI FSalida = 0;
               #1#6 = "*";
               |GRABA 020#1a;
          |FINSI;
     |FINSI;

     |SI nSal = 11;||F3 marca todos
          |SI #1#6 = "*";
               aMarca = " ";
          |SINO;
               aMarca =  "*";
          |FINSI;
          |PTEC 807;
          |ERROR;
     |FINSI;
|FPRC;

|PROCESO Nada; |TIPO 12;
|FPRC;

|PROCESO Min;
     #1#0 = " " * 15;
     #1#1 = " " * 20;
|FPRC;

|PROCESO Max;
     #1#0 = "z" * 15;
     #1#1 = "z" * 20;
|FPRC;

|PROCESO MarcaTodos;
     |SI aMarca = "*";
          |HAZ MiraExiste;
     |SINO;
          FSalida = 0;
     |FINSI;
     |SI FSalida = 0;
          #1#6 = aMarca;
          |GRABA 020#1a;
     |FINSI;
     |LIBERA #1;
|FPRC;

|DEFBUCLE MarcaTodos;
     #1#1;
     ;
     INICIO;
     FINAL;
     be;
     NULL, MarcaTodos;
|FIN;

|PROGRAMA;
     |HAZ CreaTempo; aTempo1 = Tempo;
     |NOME_DAT #1 aTempo1;
     |DELINDEX #1;

     |CLS;
     |PINPA #0#0;
     |PINDA #0#0;
     |ENTLINEAL #1#1, 1, 7, 17, 0, Min, Max;
     |ENDATOS #1#0;
     |SI FSalida = 0;
          aDHora = #0#2 + ":00";
          aHHora = #0#3 + ":59";
          |ABRE #1;
          |ABRE #85;
          |ABRE #24;
          |ABRE #19;
          |BUCLE malpe122;
          |CIERRA #19;
          |CIERRA #24;
          |CIERRA #85;
          |CIERRA #1;
          |SI nHay = 0;
               |MENAV "0000Seleccion Vacia...";
          |SINO;
               |PARA; |SI aMenu2 = 1; |HACIENDO;
                    |PARA; aMarca = " "; |SI aMarca! ""; |HACIENDO;
                         aMarca = "";
                         |ENTLINEAL #1#1, 1, 4, 17, 0, Min, Max;
                         |SI aMarca ! "";
                              |BUCLE MarcaTodos;
                         |FINSI;
                    |SIGUE;
                    |MENU aMenu;
                    aMenu2 = FSalida;
               |SIGUE;
               |SI aMenu2 = 2; |HAZ Actualiza; |FINSI;
          |FINSI;
     |FINSI;

     |DELINDEX #1; Tempo = aTempo1; |HAZ BoraTempo;
|FPRO;
