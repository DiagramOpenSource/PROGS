|FICHEROS;
     con00663 #0;
     con00655 #2; || CLientes
     con00660 #3; || Totales
     con00657 #4; || Datos Economicos
     con00650 #10;
     agifa134 #20;
     agifa059 #21;
     con00690 #90; ||formatos facturas
     contmp01 #50;

     agifa133 #530;
     agifa091 #531;
     agifa177 #532;
     agis0002 #533;
     agifa142 #534;
     dsz99984 #535;
     agifa024 #536;
     con00657 #657;

     Refere1@ #1000;
|FIN;

|VARIABLES;
     &Tempo = "";
     &aDivisa     = "";
     &aMoneda     = "";
     hay_nuevos = "N";
     modo = 0;
     nFlag = 0;
     informe = "";

     aAlfaX  = "";
|FIN;


|PROCESO graba_tmp;
#50#0 = #10#0;
#50#1 = #10#28;
#50#2 = #10#1;
#50#3 = #10#2;
#50#4 = #10#3;
#50#5 = #10#4;
#50#6 = #10#22;
|GRABA 000#50n;
|LIBERA #50;
hay_nuevos = "S";
|FPRC;

|DEFBUCLE crea_tmp;
#10#3;
;
"  " , 000000 , "                         ";
"  " , 000000 , "zzzzzzzzzzzzzzzzzzzzzzzzz";
;
NULL , graba_tmp;
|FIN;

|PROCESO ef11; |TIPO 66;
       |HAZ CreaTempo;
       |NOME_DAT #50 Tempo; |DELINDEX #50;
       |ABRE #50;hay_nuevos = "N";
       |BUCLE crea_tmp;
       |SI hay_nuevos = "S";
            |CONSULTA_CLAVE #1#50;
            |SI FSalida = 0;
               #0#4 = #50#0;
               |PINTA #0#4;
            |SINO;
               |ERROR;
            |FINSI;
       |SINO;
          |MENAV "0000No existen vehiculos pendientes de facturar";
       |FINSI;
       |CIERRA #50;
       |HAZ BoraTempo; |DELINDEX #50;
|FPRC;

|PROCESO trae_datos;
|SI #0Campo = Contenido;
     |ACABA;
|FINSI;
|ABRE #10;
#10#0 = #0#4;
|LEE 001#10=;
|SI #10#24 ! 0;
     |MENAV "0000Este vehiculo ya esta facturado";
     |ERROR;
     |ACABA;
|FINSI;
|LIBERA #10;
|CIERRA #10;

|ABRE #2;
|ABRE #3;
#2#0 = #0#4;
|LEE 000#2=;
|SI FSalida ! 0 ; |DDEFECTO #2; |FINSI;
#3#0 = #0#4;
|LEE 000#3=;
|SI FSalida ! 0 ; |DDEFECTO #3; |FINSI;
#0#3 = #2#2;
#0#6 = #3#4;
#0#7 = #3#5;
#0#8 = #3#6;
#0#9 = #3#7;
#0#10 = #3#8;
#0#11 = #3#9;
#0#12 = #3#10;
#0#13 = #3#11;
#0#14 = #3#12;
#0#15 = #3#13;
#0#16 = #3#14;
#0#20 = #3#15;
|PINTA #0#3;
|PINTA #0#6;
|PINTA #0#7;
|PINTA #0#8;
|PINTA #0#9;
|PINTA #0#10;
|PINTA #0#11;
|PINTA #0#12;
|PINTA #0#13;
|PINTA #0#14;
|PINTA #0#15;
|PINTA #0#16;
|PINTA #0#20;
|LIBERA #2;
|LIBERA #3;
|CIERRA #2;
|CIERRA #3;
|FPRC;

|PROCESO im_linea;
|PRINT;
|FPRC;

|DEFBUCLE lee_lineas;
#4#1;
10;
#0#4 , 001 , "S";
#0#4 , 999 , "S";
;
NULL,im_linea;
|FIN;

|PROCESO BorraVinculoEntrega;
   |ABRE #agis0002; |SELECT #4#agis0002;
   #agis0002#34 = #agifa134#49;
   #agis0002#35 = #agifa134#0;
   |LEE 101#agis0002.=;
   |SI FSalida = 0;
      #agis0002#34 = "";
      #agis0002#35 = 0;
      |GRABA 020#agis0002.a; |LIBERA #agis0002;
   |FINSI;
   |LIBERA #agis0002;
   |SELECT #1#agis0002; |CIERRA #agis0002;
|FPRC;

|PROCESO borra_factura;
|ABRE #20;
|ABRE #21;
#20#0 = #0#1;
#20#49 = #0#0;
|HAZ BorraRecVenta;

#20#49 = #0#0;
#20#0 = #0#1;
|HAZ BorraVinculoEntrega;

#20#0 = #0#1;
#20#49 = #0#0;
|BORRA 001#20c;
#21#0 = #0#1;
#21#1 = 1;
#21#14 = #0#0;
|BORRA 001#21c;
|LIBERA #20;
|LIBERA #21;
|CIERRA #20;
|CIERRA #21;
|FPRC;

|PROCESO crea_factura;
     aMoneda = "B"
     aDivisa = "EUR";
     |HAZ Divisas134;
     |ABRE #20;
     |ABRE #21;
     |ABRE #agifa024;

     #agifa024#0 = #0#3;
     |LEE 000#agifa024.=;
     |SI FSalida ! 0; |DDEFECTO #agifa024; |FINSI;

     |DDEFECTO #20;
     #20#0 = #0#1;
     #20#1 = #0#2;
     #20#2 = #0#3;
     #20#3 = #0#5;
     #20#11 = #0#24;
     #20#12 = #agifa024#16;
     #20#49 = #0#0;

     #20#18 = #0#6 + #0#7 + #0#8 + #0#15; ||Bruto
     #20#65 = #20#18;
     #20#88 = #20#18;

     #20#21 = #0#6; ||Base1
     #20#68 = #20#21;
     #20#91 = #20#21;

     #20#22 = #0#12;||Cuota1
     #20#69 = #20#22;
     #20#92 = #20#22;

     #20#24 = #0#7; ||Base2
     #20#71 = #20#24;
     #20#94 = #20#24;

     #20#25 = #0#13; ||Cuota2
     #20#72 = #20#25;
     #20#95 = #20#25;

     #20#27 = #0#8; ||Base3
     #20#74 = #20#27;
     #20#97 = #20#27;

     #20#28 = #0#14;||Cuota3
     #20#75 = #20#28;
     #20#98 = #20#28;

     #20#29 = #0#12 + #0#13 + #0#14; ||T.IVA
     #20#76 = #20#29;
     #20#99 = #20#29;

     #20#47 = #0#15; ||Exenta

     #20#31 = #0#16; ||T.Fac
     |SI #0#19 = "S";
          #20#31 = #20#31 + #0#20; || Total + Impuesto
     |FINSI;
     #20#78 = #20#31;
     #20#101 = #20#31;

     #20#39 = #0#9;  ||%iva1
     #20#41 = #0#10; ||%iva2
     #20#43 = #0#11; ||%iva3

     #20#20 = #0#20;     || Varios = Impuesto Fra
     #20#67 = #20#20;
     #20#90 = #20#20;

     #20#58 = "EUR";
     #20#59 = 1;
     #20#60 = "B";
     #20#61 = "EUR";
     #20#62 = 1;

     |GRABA 001#20c;
     |LIBERA #20;
     |HAZ VenciVta; |HAZ CreaRecibos;
     |CIERRA #20;
     #21#0 = #0#1;
     #21#1 = 1;
     #21#14 = #0#0;
     |GRABA 001#21n;
     |LIBERA #21;
     |CIERRA #21;
     |CIERRA #agifa024;
|FPRC;

|PROCESO actualiza;
|ABRE #10;
#10#0 = #0#4;
|LEE 021#10=;
|SI FSalida = 0;
     |SI modo ! 3;
          #10#23 = #0#0;
          #10#24 = #0#1;
          #10#29 = #0#21;
          |HAZ crea_factura;
     |SINO;
          #10#23 = "  ";
          #10#24 = 0;
          |HAZ borra_factura;
     |FINSI;
     |GRABA 021#10a;
|FINSI;
|LIBERA #10;
|CIERRA #10;
|FPRC;

|PROCESO tipo33; |TIPO 3;
|SI FSalida = 0;
     |HAZ actualiza;
     |SI #0#22 = "N";
          |CONFI "0000SDesea Emitir la Factura S/N : ";
          |SI FSalida = 0;
               |HAZ imprime;
          |FINSI;
     |FINSI;
|FINSI;
|FPRC;

|PROCESO tipo22; |TIPO 2;
     modo = (FEntrada/100)!0;
     nFlag = 0 +. 1;

     |SI modo ! 1;
          |ABRE #20;
          #20#49 = #0#0;
          #20#0 = #0#1;
          |LEE 000#20=;
          |SI FSalida = 0; |Y #20#48 = "S";
               |SI nFlag = -1;
                    |MENAV "0000Factura contabilizada...";
               |FINSI;
               |ERROR; |ACABA;
          |FINSI;
          |CIERRA #20;
     |FINSI;


     |SI nFlag < 0;
          modo = 3;
     |SINO;
          modo = 1;
     |FINSI;
     |HAZ actualiza;
|FPRC;

|PROCESO imprime; |TIPO 4;
|IMPRE 0;
|SI FSalida = 0;
     |ABRE #90;
     #90#0 = #0#0;
     |LEE 010#90=;
     |SI FSalida = 0;
       informe = #90#4;
     |SINO;
       informe = "con00663";
     |FINSI;
     |LIBERA #90;
     |CIERRA #90;
     |INFOR informe;
     |SI FSalida = 0;
          |BUCLE lee_lineas;
          |PIEINF;
          #0#22 = "S"; |PINTA #0#22;
          |GRABA 020#0a;
     |FINSI;
     |FININF;
|FINSI;
|FINIMP;

|FPRC;

|VARIABLES;
   &eaProg = "";
   &enAcuenta = 0;

   nVto = 0;
|FIN;

|PROCESO CreaRecibos;
     |ABRE #agifa133;
     |ABRE #agis0002;
     |ABRE #agifa177;
     |ABRE #agifa091;
     |ABRE #agifa142;

     |LEE 000#agifa142.p;
     |SI FSalida ! 0; |DDEFECTO #agifa142; |FINSI;

     #agifa024#0 = #agifa134#2;
     |LEE 000#agifa024.=;
     |SI FSalida ! 0; |DDEFECTO #agifa024; |FINSI;

     #agifa091#0 = #agifa134#11;
     |LEE 000#agifa091.=;
     |SI FSalida ! 0; |DDEFECTO #agifa091; |FINSI;

     nVto = 0;
     #agifa133#0 = #agifa134#0;
     #agifa133#4 = #agifa134#49;
     #agifa133#1 = 0;
     |LEE 000#agifa133.];
     |PARA ; |SI FSalida = 0; |Y #agifa133#0 = #agifa134#0;|Y #agifa133#4 = #agifa134#49; |HACIENDO;
          nVto = nVto + 1;
          |LEE 000#agifa133.s;
     |SIGUE;

     |HAZ AbreRecVenta;

     #agifa133#0 = #agifa134#0;
     #agifa133#4 = #agifa134#49;
     #agifa133#1 = 0;
     |LEE 000#agifa133.];
     |PARA ; |SI FSalida = 0; |Y #agifa133#0 = #agifa134#0;|Y #agifa133#4 = #agifa134#49; |HACIENDO;
          |SI #agifa133#5 = "S";
               |DDEFECTO #agis0002;
               #agis0002#30 = "A";       || busca como albaran
               #agis0002#20 = #agifa133#6;     || Serie pedido.
               #agis0002#17 = #agifa133#7;     || Numero pedido.
               #agis0002#18 = #agifa133#8;     || Numero recibo.
               |LEE 000#agis0002.=;
               |SI FSalida ! 0;
                    #agis0002#30 = "P";       || busca como pedido
                    |LEE 000#agis0002.=;
               |FINSI;
          |FINSI;
          |DDEFECTO #dsz99984;
          #dsz99984#17 = #agifa134#49;
          #dsz99984#0 = #agifa134#0;
          #dsz99984#1 = #agifa133#1;           || Linea;
          #dsz99984#2 = #agifa134#2;           || cliente
          #dsz99984#3 = #agifa134#3;           || nombre del cliente
          #dsz99984#4 = #agifa134#9;           || Banco
          #dsz99984#5 = "S";                   || domiciliado
          #dsz99984#6 = "N";                   || aceptado
          #dsz99984#7 = #agifa134#1;           || fecha de emision
          #dsz99984#8 = #agifa133#3;           || Fecha de vencimiento
          #dsz99984#9 = #agifa133#2;           || Importe
          |SI #agifa133#5 = "S";
               #dsz99984#10 = #agis0002#10;
               #dsz99984#11 = #agis0002#11;
          |SINO;
               #dsz99984#10 = "N";            || Impreso
               #dsz99984#11 = "N";            || Contabilizado
          |FINSI;
          |SI #agifa142#63 = "S";     ||  COGE LA CTA.CONTABLE DEL TIPO DE RECIBO.
               #agifa177#0 = #agifa091#69;
               |LEE 000#agifa177.=;
               |SI FSalida = 0;
                    #dsz99984#12 = #agifa177#3;     || NUMERO CTA.CONTABLE.
               |SINO;
                    #dsz99984#12 = #agifa134#12;     || NUMERO CTA.CONTABLE.
               |FINSI;
          |SINO;
               #dsz99984#12 = #agifa134#12;     || NUMERO CTA.CONTABLE.
          |FINSI;
          #dsz99984#13 = #agis0002#13;
          #dsz99984#16 = #agis0002#16;
          #dsz99984#22 = "Cobrado";
          #dsz99984#24 = #agifa134#11;          || Forma de Pago
          #dsz99984#25 = #agifa091#1;           || Descripcion de la forma de Pago
          #dsz99984#14 = "N";            || Impagado
          #dsz99984#15 = #agifa024#161;         || A aceptar
          |SI #agifa133#5 = "S";
               #dsz99984#21 = #agis0002#22;         || Tipo de Recibo (entr.a cta.)
          |SINO;
               #dsz99984#21 = #agifa091#69;          || Tipo de Recibo (forma de pago)
          |FINSI;
          #dsz99984#23 = nVto;
          #dsz99984#24 = #agifa091#0;
          #dsz99984#25 = #agifa091#1;
          eaProg = "agifa134";
          |HAZ RecVenta;
          |LEE 000#agifa133.s;
     |SIGUE;
     |HAZ CierraRecVenta;

     #agifa133#0 = #agifa134#0;
     #agifa133#4 = #agifa134#49;
     #agifa133#1 = 0;
     |LEE 101#agifa133.];
     |PARA ; |SI FSalida = 0; |Y #agifa133#0 = #agifa134#0;|Y #agifa133#4 = #agifa134#49; |HACIENDO;
          #dsz99984#17 = #agifa133#4;
          #dsz99984#0 = #agifa133#0;
          #dsz99984#1 = #agifa133#1;
          eaProg = "agifa134";
          |HAZ LeeRecVenta;
          #agifa134#32 = #agifa134#32 + enAcuenta;
          #agifa133#2 = #agifa133#2 - enAcuenta;
          |GRABA 020#agifa133.a;
          |LIBERA #agifa133;
          |LEE 101#agifa133.s;
     |SIGUE;
     |LIBERA #agifa133;

     |CIERRA #agifa091;
     |CIERRA #dsz99984;
     |CIERRA #agifa133;
     |CIERRA #agis0002;
     |CIERRA #agifa177;
|FPRC;

|PROCESO Tipo13_663; |TIPO 13;
     |HAZ TallerDeci;
|FPRC;
