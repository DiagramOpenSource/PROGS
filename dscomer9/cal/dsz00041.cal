|FICHEROS;
     dsz00041 #0;
     dsm00120 #120;
     dsm00121 #121;
     agifa065 #65;
     agifa019 #19;
     agifa017 #17;
     dsm00041 #41;
     dsm00024 #24;
     dsm00238 #238;
     agifa083 #83;
     dsm00154 #154;
     dsm00004 #904;
     dsm00006 #906;
     dsm00014 #914;
|FIN;

|CAMPOS;
     #83#21 Entero;
|FIN;

|VARIABLES;
     nOk = 0;
     &enErrHis = 0;
     &efFec = @;
     &enAlma = 0;
     aAlfa= "";
     dArt = "";
     hArt = "";
     nDAlma = 0;
     nHAlma = 0;
     nUni1 = 0;
     nUni2 = 0;
     nMts = 0;
     nMulti = 0;
|FIN;

|PROCESO Tipo0; |TIPO 0;
     |SI #0#3 = "S"; |O #0#3 = "N";
          |C_M #0#4, 1, "S";
     |SINO;
          |C_M #0#4, 1, "N";
     |FINSI;
     |SI #0#3 = "S";
          |C_M #0#9, 1, "N";
          |C_M #0#10, 1, "N";
     |SINO;
          |C_M #0#9, 1, "S";
          |C_M #0#10, 1, "S";
     |FINSI;
|FPRC;

|PROCESO dsm00004;
     #19#0 = #904#0;
     |LEE 000#19=;
     |SI FSalida ! 0; |ACABA; |FINSI;
     |SI #19#137 = "S";
          |SI #19#2 < #0#5; |O #19#2 > #0#6; |ACABA; |FINSI;
          |SI #19#3 < #0#7; |O #19#3 > #0#8; |ACABA; |FINSI;

          #914#0 = #904#2;
          |LEE 000#914=;
          |SI FSalida ! 0; |DDEFECTO #914; |FINSI;

          |DDEFECTO #154;
          #154#0 = #0#0;
          #154#1 = #904#0;
          #154#2 = #904#1;
          #154#3 = #904#2;
          |LEE 000#154=;
          #154#7 = #914#1;
          |SI FSalida ! 0; |GRABA 020#154n; |FINSI;
    |FINSI;
|FPRC;

|DEFBUCLE dsm00004;
     #904#1;
     ;
     "                    ", nDAlma, "      ";
     "zzzzzzzzzzzzzzzzzzzz", nHAlma, "zzzzzz";
     ;
     NULL, dsm00004;
|FIN;

|PROCESO agifa019;
     |SI #19#137 = "S";
          |SI #19#2 < #0#5; |O #19#2 > #0#6; |ACABA; |FINSI;
          |SI #19#3 < #0#7; |O #19#3 > #0#8; |ACABA; |FINSI;

          |DDEFECTO #238;
          #238#0 = #19#201;
          |LEE 000#238=;

          |DDEFECTO #121;
          #121#0 = #120#0;
          #121#1 = #19#0;
          #121#3 = #0#4;
          |LEE 000#121=;
          #121#2 = #19#1;
          #121#15 = #19#28;
          #121#16 = #19#9;
          #121#17 = #19#133;
          |SI #19#179 = "S";
               #121#18 = #238#9;
               #121#19 = #238#10;
               #121#20 = #238#11;
          |FINSI;
          |SI FSalida ! 0; |GRABA 020#121n; |FINSI;
     |FINSI;
|FPRC;

|PROCESO agifa017;
     #19#0 = #17#0;
     |LEE 000#19=;
     |SI #19#137 ! "S"; |O FSalida ! 0; |ACABA; |FINSI;
     |SI #19#2 < #0#5; |O #19#2 > #0#6; |ACABA; |FINSI;
     |SI #19#3 < #0#7; |O #19#3 > #0#8; |ACABA; |FINSI;

     |SI #17#2 < #0#9; |O #17#2 > #0#10; |ACABA; |FINSI;

     |DDEFECTO #238;
     #238#0 = #19#201;
     |LEE 000#238=;

     |DDEFECTO #121;
     #121#0 = #120#0;
     #121#1 = #17#0;
     #121#3 = #17#1;
     |LEE 000#121=;
     #121#2 = #19#1;
     #121#15 = #19#28;
     #121#16 = #19#9;
     #121#17 = #19#133;
     |SI #19#179 = "S";
          #121#18 = #238#9;
          #121#19 = #238#10;
          #121#20 = #238#11;
     |FINSI;
     |SI FSalida ! 0; |GRABA 020#121n; |FINSI;
|FPRC;

|PROCESO dsm00024;
     #19#0 = #24#0;
     |LEE 000#19=;
     |SI #19#137 ! "S"; |O FSalida ! 0; |ACABA; |FINSI;
     |SI #19#2 < #0#5; |O #19#2 > #0#6; |ACABA; |FINSI;
     |SI #19#3 < #0#7; |O #19#3 > #0#8; |ACABA; |FINSI;

     |DDEFECTO #17;
     #17#0 = #24#0;
     #17#1 = #24#1;
     |LEE 000#17=;
     |SI #17#2 < #0#9; |O #17#2 > #0#10; |ACABA; |FINSI;

     |DDEFECTO #238;
     #238#0 = #19#201;
     |LEE 000#238=;

     |DDEFECTO #121;
     #121#0 = #120#0;
     #121#1 = #24#0;
     #121#3 = #24#1;
     #121#11 = #24#2;
     |LEE 000#121=;
     #121#2 = #19#1;
     #121#15 = #19#28;
     #121#16 = #19#9;
     #121#17 = #19#133;
     |SI #19#179 = "S";
          #121#18 = #238#9;
          #121#19 = #238#10;
          #121#20 = #238#11;
     |FINSI;
     |SI FSalida ! 0; |GRABA 020#121n; |FINSI;
|FPRC;

|DEFBUCLE agifa019;
     #19#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, agifa019;
|FIN;

|DEFBUCLE agifa017;
     #17#1;
     ;
     "                    ", nDAlma;
     "zzzzzzzzzzzzzzzzzzzz", nHAlma;
     ;
     NULL, agifa017;
|FIN;

|DEFBUCLE dsm00024;
     #24#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, dsm00024;
|FIN;

|PROCESO Trunca; || Quita la parte decimal de un numero
     |SI nMts < 0; nMulti = -1; |SINO nMulti = 1; |FINSI;
     nMts = nMts * nMulti;
     nMts = nMts / #19#192;
     Entero = nMts;
     |SI nMulti = 1;
          nMts = Entero;
     |SINO;
          |SI Entero > nMts;
               nMts = Entero - 1;
         |SINO;
               nMts = Entero;
         |FINSI;
     |FINSI;
     nMts = nMts * nMulti;
|FPRC;

|PROCESO ConDivisor;
     |SI #19#179 = "S"; |Y #19#192 ! 1;
          nMts = #121#12;
          |HAZ Trunca;
          #121#4 = nMts;
          #121#5 = #121#4;
     |FINSI;
|FPRC;

|PROCESO HistoVertical;
     #914#0 = #906#7;
     |LEE 000#914=;
     |SI FSalida ! 0; |DDEFECTO #914; |FINSI;

     |DDEFECTO #154;
     #154#0 = #120#0;
     #154#1 = #906#0;
     #154#2 = #121#3;
     #154#3 = #906#7;
     |LEE 101#154=;
     |SI FSalida ! 0; |GRABA 020#154b; |FINSI;

     #154#4 = #154#4 + #906#9;
     #154#5 = #154#4;
     #154#6 = 0;
     #154#7 = #914#1;
     |GRABA 020#154a;
     |LIBERA #154;
|FPRC;

|DEFBUCLE HistoVertical;
     #906#1;
     ;
     #65#0, #65#5, #65#1, #65#2, #65#11, #65#3, #65#4, "      ";
     #65#0, #65#5, #65#1, #65#2, #65#11, #65#3, #65#4, "zzzzzz";
     ;
     NULL, HistoVertical;
|FIN;

|PROCESO Historico;
     #19#0 = #65#0;
     |LEE 000#19=;
     |SI FSalida ! 0; |ACABA; |FINSI;
     |SI #19#137 = "N"; |ACABA; |FINSI;

     |SI #19#2 < #0#5; |O #19#2 > #0#6; |ACABA; |FINSI;
     |SI #19#3 < #0#7; |O #19#3 > #0#8; |ACABA; |FINSI;

     |DDEFECTO #17;
     #17#0 = #65#0;
     #17#1 = #65#5;
     |LEE 000#17=;
     |SI #17#2 < #0#9; |O #17#2 > #0#10; |ACABA; |FINSI;

     |DDEFECTO #238;
     #238#0 = #19#201;
     |LEE 000#238=;

     |DDEFECTO #121;
     #121#0 = #120#0;
     #121#1 = #65#0;
     |SI #0#3 = "S";
          #121#3 = #0#4;
     |SINO;
          #121#3 = #65#5;
     |FINSI;
     |SI #0#3 = "P";
          #121#11 = #65#18;
     |FINSI;

     nUni1 = #65#6;
     nUni2 = #65#17;
     |LEE 101#121=;
     |SI FSalida = 0;
          #121#4 = #121#4 + nUni1;
          #121#5 = #121#4;
          #121#6 = 0;

          #121#12 = #121#12 + nUni2;
          #121#13 = #121#12;
          #121#14 = 0;
          |HAZ ConDivisor;
          |GRABA 020#121a;
     |SINO;
          #121#2 = #19#1;
          #121#4 = nUni1;
          #121#5 = #121#4;
          #121#6 = 0;
          #121#7 = #19#5;

          #121#12 = nUni2;
          #121#13 = #121#12;
          #121#14 = 0;

          #121#15 = #19#28;
          #121#16 = #19#9;
          #121#17 = #19#133;
          |SI #19#179 = "S";
               #121#18 = #238#9;
               #121#19 = #238#10;
               #121#20 = #238#11;
          |FINSI;
          |HAZ ConDivisor;
          |GRABA 020#121n;
     |FINSI;
     |LIBERA #121;

     |SI #19#176 = "S";
          |BUCLE HistoVertical;
     |FINSI;
|FPRC;

|DEFBUCLE Historico;
     #65#1;
     5;
     dArt, "01.01.1900","  ", 000000, 00000,"     ", nDAlma;
     hArt, #0#0,        "zz", 999999, 99999,"zzzzz", nHAlma;
     ;
     NULL, Historico;
|FIN;

|PROCESO ControlCierre; |TIPO 0;
     |SI FSalida ! 2;
          efFec = #0#0;
          |SI #0#3 = "S"; |O #0#3 = "N";
               enAlma = #0#4;
               |HAZ MiraHisL;
          |FINSI;
          |SI #0#3 = "T";
               |HAZ MiraHisT;
          |FINSI;
          |SI enErrHis ! 0;
               |ERROR;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO dsm00121;
     |SI #121#9 = "S";
          nOk = 1;
          |ERROR10;
     |FINSI;
|FPRC;

|DEFBUCLE dsm00121;
     #121#1;
     ;
     #0#0, "                    ", #0#4, "               ";
     #0#0, "zzzzzzzzzzzzzzzzzzzz", #0#4, "zzzzzzzzzzzzzzz";
     ;
     NULL, dsm00121;
|FIN;

|PROCESO MiraInventario;
     nOk = 0;
     |DDEFECTO #120;
     |ABRE #120;
     #120#0 = #0#0;
     |LEE 000#120=;
     |SI #0#3 = "N";
          |SI FSalida ! 0;
               #120#1 = "N";
               #120#2 = #0#2
               #120#3 = #0#3
               #120#4 = #0#4
               |GRABA 020#0120n;
          |FINSI;
          |BUCLE dsm00121;
     |SINO;
          |SI FSalida ! 0;
               #120#1 = "N";
               #120#2 = #0#2
               #120#3 = #0#3
               #120#4 = #0#4
               |GRABA 020#0120n;
          |SINO;
               nOk = 1;
          |FINSI;
     |FINSI;
     |CIERRA #120;
     FSalida = nOk;
|FPRC;

|PROCESO Tipo3; |TIPO 3;
     dArt = " " * 20;
     hArt = "z" * 20;

     |SI #0#1 = "SI";
          |HAZ MiraInventario;
          |SI FSalida ! 0;
               |MENAV "0000Inventario existente...";
          |SINO;
               |SI #0#3 = "N";
                    nDAlma = #0#4;
                    nHAlma = #0#4;
               |SINO;
                    nDAlma = 1;
                    nHAlma = 99999;
               |FINSI;
               |ABRE #914;
               |ABRE #154;
               |ABRE #121;
               |ABRE #19;
               |ABRE #17;
               |ABRE #238;
               |BUCLE Historico;
               |SI #0#2 = "S";
                    |SI #0#3 = "S";
                         |BUCLE agifa019;
                    |FINSI;
                    |SI #0#3 = "T";
                         |BUCLE agifa017;
                    |FINSI;
                    |SI #0#3 = "N";
                         |BUCLE agifa017;
                    |FINSI;
                    |SI #0#3 = "P";
                         |BUCLE dsm00024;
                    |FINSI;
                    |ABRE #19;
                    |BUCLE dsm00004;
                    |CIERRA #19;
               |FINSI;
               |CIERRA #238;
               |CIERRA #17;
               |CIERRA #19;
               |CIERRA #121;
               |CIERRA #154;
               |CIERRA #914;
          |FINSI;
          |CIERRA #120;
     |FINSI;
|FPRC;
