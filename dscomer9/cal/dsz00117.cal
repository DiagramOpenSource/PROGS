|FICHEROS;
     agifa065 #0;
     agifa071 #71;
     infom000@;
|FIN;

|VARIABLES;
     &enForma = 0;
     nUni = 0;
     aAlfa = "";
     aPath = "";
     aWget = "";
     aUrl = "";
     nOk = 0;
     aArt = "";
     aMov = "";
|FIN;

|PROCESO Esa_Iber21;
     |DBASE aPath;
     aPath = aPath + "bin/iber0001.tab";
     |XABRE "E", aPath, 0;
|FPRC;

|PROCESO Es_Inforpor; || 001980
     |DDEF aPath;
     aPath = aPath + "infom000.mas";
     |XABRE "E", aPath, 0;
     |SI FSalida ] 0;
          |HAZ Esa_Iber21;
          |SI FSalida ] 0;
               FSalida = 1;
          |SINO;
               FSalida = 0;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO &T65_15; |TIPO 15;
     |HAZ Es_Inforpor;
     |SI FSalida = 0;
          nUni = #0#6;
          |HAZ EnviaWeb;
     |FINSI;
|FPRC;

|PROCESO &T65_16; |TIPO 16;
     |HAZ Es_Inforpor;
     |SI FSalida = 0;
          nUni = #0#6;
          |HAZ EnviaWeb;
     |FINSI;
|FPRC;

|PROCESO &T65_17; |TIPO 17;
     |HAZ Es_Inforpor;
     |SI FSalida = 0;
          nUni = -#0#6;
          |HAZ EnviaWeb;
     |FINSI;
|FPRC;

|PROCESO EnviaWeb;
     || los AV solo se pasan los que son SIN pedido
     || estos se hacen en al agifa071, agifa211
     |SI #0#2 ! "AV"; |Y #0#2 ! "BV";
          aArt = #0#0;
          aMov = #0#2;
          |HAZ EnviaWeb0;
     |FINSI;
|FPRC;

|PROCESO EnviaWeb0;
     |DDEF aAlfa;
     aAlfa = aAlfa + "infom000";
     |CARGA_DEF aAlfa, infom000@;
     |SI FSalida = 0;
          |ABRE #infom000@;
          |LEE 000#infom000@.p;
          |SI FSalida = 0;
               aWget = #infom000@#17; |QBF aWget;
               aUrl = #infom000@#18; |QBF aUrl;
               |SI aUrl ! "";
                    aAlfa = aWget + "wget -o /tmp/001980.out " + &34 + aUrl + "?cod=" + aArt;
                    |QBF aAlfa;
                    aAlfa = aAlfa + "&stock=" + nUni + "&tipo=" + aMov + &34;
                    aAlfa = aAlfa + " >> /tmp/001980.log 2>> /tmp/001980.err";
                    |SYSTEM aAlfa;
               |FINSI;
          |FINSI;
          |CIERRA #infom000@;
          |DESCARGA_DEF #infom000@;
     |SINO;
          |MENAV "0000Error al cargar 'infom000'";
     |FINSI;
|FPRC;

|PROCESO InfoEnviaWeb;
     nUni = -1 * (#71#5 * enForma);
     aArt = #71#2;
     aMov = "AV";
     |HAZ EnviaWeb0;
|FPRC;
