|FICHEROS;
     gopue001 #0;
     gopre001 #1;
     gopre002 #2;
     gopre003 #3;
     gopre004 #4;
     goparame #10;
     agifa091 #91;
|FIN;
-----------------------------------------------------------------------------
|VARIABLES;
     aAlfa = "";
     &enTiva = 0;
     &efFiva = @;
     &eaDiva = "";
     &enIva = 0;
     &enRec = 0;

     aArti = "";
     nLinea = 0;
     nNume     = 0;
     nTotal    = 0;
     nFecIni   = 0;
     nFecFin   = 0;
     nDiaObr   = 0;

     &eaSerie  = "";
     &eaCodigo = "";
     &cDesc    = "";
     nPorPEM = 0;
     nTotalPEM = 0;
     nTotalTrasDto = 0;
     nTotalTrasBaja = 0;
     nIMPGG = 0;
     nIMPBI = 0;
     nTotalAntesBaja = 0;
     nIMPBaja = 0;
     nTotalAntesIVA = 0;
     nIMPIVA = 0;
     nPorBajaApli = 0;
     nPEMAntesInt = 0;
     nPEM = 0;
|FIN;
-----------------------------------------------------------------------------
|PROCESO ImpLici; |TIPO 0;
     #0#48 = 1 - (#0#5 / #0#47);
     |PINTA #0#48;
|FPRC;

|PROCESO CalIni; |TIPO 0;
     |SI #0#11 = "01.01.0000";
          #0#12 = "01.01.0000";
          #0#13 = 0;
          |PINTA #0#12;
          |PINTA #0#13;
     |FINSI;
|FPRC;

|PROCESO CalDia; |TIPO 0;
     |SI #0#11 = "01.01.0000"; |O #0#12 = "01.01.0000"; |ACABA; |FINSI;
     nFecIni = #0#11;
     nFecFin = #0#12;
     nDiaObr = nFecFin-nFecIni + 1;
     #0#13 = nDiaObr;
     |PINTA #0#13;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO CalFec; |TIPO 0;
     |SI #0#11 = "01.01.0000"; |O #0#13 = 0;
          #0#12 = "01.01.0000";
          |ACABA;
     |FINSI;
     nNume = #0#13 - 1;
     #0#12 = #0#11 + nNume;
     |PINTA #0#12;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO Entrada7; |TIPO 7;
     eaSerie = #0#0;
     eaCodigo = #0#1;
     cDesc = #0#3;
     |SUB_EJECUTA_NP "gopue002";
     |ABRE #91;
     #91#0 = #0#9;
     |LEE 000#91=;
     |SI FSalida = 0;
          #0#14 = #91#1;
          |PINTA #0#14;
     |FINSI;
     |CIERRA #91;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO CalculTot;
     #0#44 = (#0#5 % #0#43);
     nTotal = #0#5 - #0#44;
     #0#31 = (nTotal % #0#26);
     #0#32 = (nTotal % #0#27);
     nTotal = nTotal + #0#31 + #0#32;
     #0#33 = (nTotal % #0#28);
     nTotal = nTotal - #0#33;
     #0#34 = (nTotal % #0#29);
     #0#35 = nTotal + #0#34;
|FPRC;

|PROCESO pintacal; |TIPO 0;
     |PINTA #0#44;
     |PINTA #0#31;
     |PINTA #0#32;
     |PINTA #0#33;
     |PINTA #0#34;
     |PINTA #0#35;
|FPRC;

|PROCESO CalculaPEM; |TIPO 7;
/*     nTotalTrasDto = #0#5 -(((#0#5 * #0#43)/100) ! 2);
     nIMPGG = (((nTotalTrasDto * #0#26)/100) ! 2);
     nIMPBI = (((nTotalTrasDto * #0#27)/100) ! 2);
     nTotalAntesBaja = nTotalTrasDto + nIMPGG + nIMPBI;
     nIMPBaja = (((nTotalAntesBaja * #0#28)/100) ! 2);
     nTotalAntesIVA = nTotalAntesBaja - nIMPBaja;
     nIMPIVA = (((nTotalAntesIVA * #0#29) / 100) ! 2);
     nPorBajaApli = (nIMPBaja * 100) / nTotalTrasDto;
     nPEMAntesInt = (nTotalTrasDto - ((nTotalTrasDto*nPorBajaApli)/100)) ! 2;
     nPEM = (nPEMAntesInt - ((nPEMAntesInt * #0#45)/100)) ! 2;
     nTotalPEM = nPEM;
*/
     nTotalTrasBaja = #0#5 -(((#0#5 * #0#28)/100) ! 2);
     nTotalTrasDto = nTotalTrasBaja - (((nTotalTrasBaja * #0#43)/100) ! 2);
     nPEM = (nTotalTrasDto / (1 + (#0#45/100))) ! 2;
     nTotalPEM = nPEM;

     |ATRI R;
     |PINTA 1233, "Total PEM..:";
     |ATRI r;
     |PINTA 1246, "            ";
     |PINTA 1246, nTotalPEM;
|FPRC;

|PROCESO CalPEM;
/*     nTotalPEM = 0;
     nTotalTrasDto = #0#5 -(((#0#5 * #0#43)/100) ! 2);
     nIMPGG = (((nTotalTrasDto * #0#26)/100) ! 2);
     nIMPBI = (((nTotalTrasDto * #0#27)/100) ! 2);
     nTotalAntesBaja = nTotalTrasDto + nIMPGG + nIMPBI;
     nIMPBaja = (((nTotalAntesBaja * #0#28)/100) ! 2);
     nTotalAntesIVA = nTotalAntesBaja - nIMPBaja;
     nIMPIVA = (((nTotalAntesIVA * #0#29) / 100) ! 2);
     nPorBajaApli = (nIMPBaja * 100) / nTotalTrasDto;
     nPEMAntesInt = (nTotalTrasDto - ((nTotalTrasDto*nPorBajaApli)/100)) ! 2;
     nPEM = (nPEMAntesInt - ((nPEMAntesInt * #0#45)/100)) ! 2;
     nTotalPEM = nPEM;
*/
     nTotalPEM = 0;
     nTotalTrasBaja = #0#5 -(((#0#5 * #0#28)/100) ! 2);
     nTotalTrasDto = nTotalTrasBaja - (((nTotalTrasBaja * #0#43)/100) ! 2);
     nPEM = (nTotalTrasDto / (1 + (#0#45/100))) ! 2;
     nTotalPEM = nPEM;

     |ATRI R;
     |PINTA 1233, "Total PEM..:";
     |ATRI r;
     |PINTA 1246, "            ";
     |PINTA 1246, nTotalPEM;
|FPRC;

|PROCESO CosteIndi; |TIPO 0;
     |SI #0Campo ! Contenido;
          aArti = #10#91; |QBF aArti;
          |SI aArti = "";
               |MENAV "0000Articulo 'Costes Indirectos' no informado en parametros.";
               |ERROR;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO IVA001_66; |TIPO 66;
     enTiva = #0Campo;
     efFiva = #0#4;
     |HAZ ConsuIVA;
     |SI eaDiva = "";
          |ERROR;
     |SINO;
          #0#57 = enTiva; |PINTA #0Campo;
          #0#29 = enIva; |PINTA #0#29;
     |FINSI;
|FPRC;

|PROCESO PonIvaCapi;
     #2#17 = #0#57;
     |SI #2#15 = "S"; #2#17 = 0; |FINSI;
     |GRABA 020#2a;
     |LIBERA #2;
|FPRC;

|DEFBUCLE PonIvaCapi;
     #2#1;
     ;
     #0#0, #0#1, 001;
     #0#0, #0#1, 999;
     be;
     NULL, PonIvaCapi;
|FIN;

|PROCESO IVA001_0; |TIPO 0;
     |C_V #0Campo, 0, aAlfa;
     |SI aAlfa = "N"; |ACABA; |FINSI;

     enTiva = #0Campo;
     efFiva = #0#4;
     |HAZ SacaIVA;
     |SI eaDiva = "";
          |MENAV "0000No existe tipo iva para esta fecha...";
          |ERROR; |ACABA;
     |SINO;
          #0#29 = enIva; |PINTA #0#29;
          |HAZ CalculTot;
          |HAZ pintacal
          |BUCLE PonIvaCapi;
     |FINSI;
|FPRC;
