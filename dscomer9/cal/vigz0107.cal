|FICHEROS;
vigz0107 #0;
agifa071 #1;
agifa010 #2;
agifa019 #3;
agifa025 #4;
vigw0014 #5;   ||Temporal.
agifa007;
vigm0043 #43;
vigm0050 #50;
|FIN;

|VARIABLES;
     &a1 = 0;
     &a2 = 0;
     &a3 = 0;
     &a4 = 0;
     &a5 = 0;
     &a6 = 0;
     &a7 = 0;
     &a8 = 0;
     &a9 = 0;
     &a10 = 0;
     &a11 = 0;
     &a12 = 0;
     &a13 = 0;
     &b1 = 0;
     &b2 = 0;
     &b3 = 0;
     &b4 = 0;
     &b5 = 0;
     &b6 = 0;
     &b7 = 0;
     &b8 = 0;
     &b9 = 0;
     &b10 = 0;
     &b11 = 0;
     &b12 = 0;
     &b13 = 0;
     &c1 = 0;
     &c2 = 0;
     &c3 = 0;
     &c4 = 0;
     &c5 = 0;
     &c6 = 0;
     &c7 = 0;
     &c8 = 0;
     &c9 = 0;
     &c10 = 0;
     &c11 = 0;
     &c12 = 0;
     &c13 = 0;
     nSwPie = 0;
     aSerie = "";
     &Tempo = "";
informe   = "";
fecha     = @;
fecha_inf = "";
fecha_sup = "";
&familia  = "";
&repres   = "";
mes       = "";
mes1      = 0;
i         = 0;
sw        = 0;
&swlin    = 0;
&t1       = 0;
&t2       = 0;
&t3       = 0;
&t4       = 0;
&t5       = 0;
&t6       = 0;
&t7       = 0;
&t8       = 0;
&t9       = 0;
&t10      = 0;
&t11      = 0;
&t12      = 0;
&t13      = 0;
&tr1      = 0;
&tr2      = 0;
&tr3      = 0;
&tr4      = 0;
&tr5      = 0;
&tr6      = 0;
&tr7      = 0;
&tr8      = 0;
&tr9      = 0;
&tr10     = 0;
&tr11     = 0;
&tr12     = 0;
&tr13     = 0;
&tt1      = 0;
&tt2      = 0;
&tt3      = 0;
&tt4      = 0;
&tt5      = 0;
&tt6      = 0;
&tt7      = 0;
&tt8      = 0;
&tt9      = 0;
&tt10     = 0;
&tt11     = 0;
&tt12     = 0;
&tt13     = 0;
|FIN;

|PROCESO &Suma;
     a1 = a1 + #5#3;
     a2 = a2 + #5#4;
     a3 = a3 + #5#5;
     a4 = a4 + #5#6;
     a5 = a5 + #5#7;
     a6 = a6 + #5#8;
     a7 = a7 + #5#9;
     a8 = a8 + #5#10;
     a9 = a9 + #5#11;
     a10 = a10 + #5#12;
     a11 = a11 + #5#13;
     a12 = a12 + #5#14;
     a13 = a13 + #5#15;

     b1 = b1 + #5#3;
     b2 = b2 + #5#4;
     b3 = b3 + #5#5;
     b4 = b4 + #5#6;
     b5 = b5 + #5#7;
     b6 = b6 + #5#8;
     b7 = b7 + #5#9;
     b8 = b8 + #5#10;
     b9 = b9 + #5#11;
     b10 = b10 + #5#12;
     b11 = b11 + #5#13;
     b12 = b12 + #5#14;
     b13 = b13 + #5#15;

     c1 = c1 + #5#3;
     c2 = c2 + #5#4;
     c3 = c3 + #5#5;
     c4 = c4 + #5#6;
     c5 = c5 + #5#7;
     c6 = c6 + #5#8;
     c7 = c7 + #5#9;
     c8 = c8 + #5#10;
     c9 = c9 + #5#11;
     c10 = c10 + #5#12;
     c11 = c11 + #5#13;
     c12 = c12 + #5#14;
     c13 = c13 + #5#15;
|FPRC;

|PROCESO &Familia;
     a1 = 0;
     a2 = 0;
     a3 = 0;
     a4 = 0;
     a5 = 0;
     a6 = 0;
     a7 = 0;
     a8 = 0;
     a9 = 0;
     a10 = 0;
     a11 = 0;
     a12 = 0;
     a13 = 0;
|FPRC;

|PROCESO &Repre;
     b1 = 0;
     b2 = 0;
     b3 = 0;
     b4 = 0;
     b5 = 0;
     b6 = 0;
     b7 = 0;
     b8 = 0;
     b9 = 0;
     b10 = 0;
     b11 = 0;
     b12 = 0;
     b13 = 0;
|FPRC;

|PROCESO EsInterno;
     |ABRE #agifa007;
     #agifa007#26 = aSerie;
     |LEE 000#agifa007.=;
     |CIERRA #agifa007;

     |SI #agifa007#37 = "S";
          FSalida = 0;
     |SINO;
          FSalida = 1;
     |FINSI;
|FPRC;

|CALCULO ao;|TIPO 7;
fecha = ~;
#0#0 = fecha % 0704;
|PINTA #0#0;
|FCAL;

|CALCULO pasa_lin;

|ABRE #2;
#2#52 = #1#29;
#2#0 = #1#0;
|LEE 000#2=;
|CIERRA #2;

#50#3 = #2#53;
#50#4 = #2#39;
|LEE 000#50=;
|SI FSalida ! 0; |ACABA; |FINSI;
|SI #0#0 ! #50#1; |ACABA; |FINSI;

aSerie = #agifa010#52;
|HAZ EsInterno;
|SI FSalida = 0; |ACABA; |FINSI;

|ABRE #3;
#3#0 = #1#2;
|LEE 000#3=;
|LIBERA #3;
|CIERRA #3;
|ABRE #4;
#4#0 = #2#6;
|LEE 000#4=;
|LIBERA #4;
|CIERRA #4;
/*
fecha_inf = "01.01." + #0#0;
fecha_sup = "31.12." + #0#0;
|SI #2#1 ] fecha_inf;|Y #2#1 [ fecha_sup;
*/
    |SI #2#6 ] #0#7;|Y #2#6 [ #0#8;
        |SI #3#2 ] #0#3;|Y #3#2 [ #0#4;
            |DDEFECTO #5;
            #5#16 = #2#6;
            #5#0  = #3#2;
            #5#1  = #1#2;
            |LEE 000#5=;
            |SI FSalida ! 0; |GRABA 020#5b; |FINSI;
            mes  = #2#1 % 402;
            mes1 = mes + 2;
            #5#16 = #2#6;
            #5#0  = #3#2;
            #5#1  = #1#2;
            #5#2  = #3#1;
            |SI #50#5 = "+";
               #5mes1 = #5mes1 + #1#5;
               #5#15  = #5#15 + #1#5;
            |SINO;
               #5mes1 = #5mes1 - #1#5;
               #5#15  = #5#15 - #1#5;
            |FINSI;
            |GRABA 020#5a;
            |LIBERA #5;
        |FINSI;
    |FINSI;
/*
|FINSI;
*/
|FCAL;

|DEFBUCLE lee_lin;
#1#1;
2;
#0#1 , 000001,  0, #0#10;
#0#2 , 999999,999, #0#11;
be;
NULL,pasa_lin;
|FIN;

|CALCULO imprime;
|SI sw = 0;
    sw = 1;
    repres  = #5#16;
    familia = #5#0;
    swlin = 3;  ||Datos Representante
    |PRINT;
    swlin = 0;
    swlin = 2;  ||Datos Familia
    |PRINT;
    swlin = 0;
|FINSI;

|SI familia ! #5#0;|Y sw = 1;|Y repres = #5#16;
    swlin = 1;  ||Totales Familia
    |PRINT;
    swlin = 0;
    familia = #5#0;
    swlin = 2;  ||Datos Familia
    |PRINT;
    swlin = 0;
    t1 = 0;
    t2 = 0;
    t3 = 0;
    t4 = 0;
    t5 = 0;
    t6 = 0;
    t7 = 0;
    t8 = 0;
    t9 = 0;
    t10 = 0;
    t11 = 0;
    t12 = 0;
    t13 = 0;
|FINSI;

|SI repres ! #5#16;|Y sw = 1;
    swlin = 1;   ||Totales Familia
    |PRINT;
    swlin = 0;
    swlin = 4;   ||Totales Representante
    |PRINT;
    swlin = 0;
    |PIEINF;
    repres = #5#16;
    familia = #5#0;
    swlin = 3;   ||Datos Representante
    |PRINT;
    swlin = 0;
    swlin = 2;   ||Datos Familia
    |PRINT;
    swlin = 0;
    t1 = 0;
    t2 = 0;
    t3 = 0;
    t4 = 0;
    t5 = 0;
    t6 = 0;
    t7 = 0;
    t8 = 0;
    t9 = 0;
    t10 = 0;
    t11 = 0;
    t12 = 0;
    t13 = 0;

    tr1 = 0;
    tr2 = 0;
    tr3 = 0;
    tr4 = 0;
    tr5 = 0;
    tr6 = 0;
    tr7 = 0;
    tr8 = 0;
    tr9 = 0;
    tr10 = 0;
    tr11 = 0;
    tr12 = 0;
    tr13 = 0;
|FINSI;

t1 = t1 + #5#3;
t2 = t2 + #5#4;
t3 = t3 + #5#5;
t4 = t4 + #5#6;
t5 = t5 + #5#7;
t6 = t6 + #5#8;
t7 = t7 + #5#9;
t8 = t8 + #5#10;
t9 = t9 + #5#11;
t10 = t10 + #5#12;
t11 = t11 + #5#13;
t12 = t12 + #5#14;
t13 = t13 + #5#15;

tr1 = tr1 + #5#3;
tr2 = tr2 + #5#4;
tr3 = tr3 + #5#5;
tr4 = tr4 + #5#6;
tr5 = tr5 + #5#7;
tr6 = tr6 + #5#8;
tr7 = tr7 + #5#9;
tr8 = tr8 + #5#10;
tr9 = tr9 + #5#11;
tr10 = tr10 + #5#12;
tr11 = tr11 + #5#13;
tr12 = tr12 + #5#14;
tr13 = tr13 + #5#15;

tt1 = tt1 + #5#3;
tt2 = tt2 + #5#4;
tt3 = tt3 + #5#5;
tt4 = tt4 + #5#6;
tt5 = tt5 + #5#7;
tt6 = tt6 + #5#8;
tt7 = tt7 + #5#9;
tt8 = tt8 + #5#10;
tt9 = tt9 + #5#11;
tt10 = tt10 + #5#12;
tt11 = tt11 + #5#13;
tt12 = tt12 + #5#14;
tt13 = tt13 + #5#15;
|PRINT;
|FCAL;

|DEFBUCLE impresion;
#5#1;
;
INICIO;
FINAL;
be;
NULL,imprime;
|FIN;

|PROCESO HistoTras;
     aSerie = #43#0;
     |HAZ EsInterno;
     |SI FSalida = 0; |ACABA; |FINSI;

     |ABRE #3;
     #3#0 = #43#12;
     |LEE 000#3=;
     |CIERRA #3;

     fecha_inf = "01.01." + #0#0;
     fecha_sup = "31.12." + #0#0;
     |SI #43#6 ] fecha_inf;|Y #43#6 [ fecha_sup;
         |SI #43#11 ] #0#3;|Y #43#11 [ #0#4;
             |SI #43#10 ] #0#7; |Y #43#10 [ #0#8;
                  |DDEFECTO #5;
                  #5#16 = #43#10;
                  #5#0 = #43#11;
                  #5#1 = #43#12;
                  |LEE 000#5=;
                  |SI FSalida ! 0; |GRABA 020#5b; |FINSI;
                  mes  = #43#6 % 402;
                  mes1 = mes + 2;
                  #5#2 = #3#1;
                  #5mes1 = #5mes1 + #43#13;
                  #5#15  = #5#15 + #43#13;
                  |GRABA 020#5a;
                  |LIBERA #5;
             |FINSI;
         |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE HistoTras;
     #43#1;
     12;
     #0#1, 000000, 001, #0#10;
     #0#2, 999999, 999, #0#11;
     ;
     NULL, HistoTras;
|FIN;

|CALCULO imprimeCR;
     nSwPie = 1;
     |PRINT;
|FCAL;

|DEFBUCLE ImpreNueva;
#5#1;
;
INICIO;
FINAL;
;
NULL,imprimeCR;
|FIN;


|CALCULO alba0013;|TIPO 3;
|SI #0#5 = "SI";|O #0#5 = "si";
    |HAZ CreaTempo; |NOME_DAT #5 Tempo;
    |DELINDEX #5;

    |SI #vigz0107#9 = "N";
         |IMPRE 0;
         |SI FSalida = 0;
             informe   = "vigz0107";
             |INFOR informe;
             |SI FSalida = 0;
                 |ABRE #5;
                 |ABRE #50;
                 |BUCLE lee_lin;
                 |CIERRA #50;
                 |BUCLE HistoTras;
                 |CIERRA #5;
                 |BUCLE ImpreNueva;
/*
Modiciado el 03/04/2013, el informe anterior se llama vigz0107.ant

                 |BUCLE impresion;
                 swlin = 1;  ||Totales Familia
                 |PRINT;
                 swlin = 0;
                 swlin = 4;  ||Totales Representante
                 |PRINT;
                 swlin = 0;
                 |PIEINF;
                 swlin = 10;
*/
                 |PIEINF;
                 swlin = 0;
             |FINSI;
             |FININF;
             |FINIMP;
         |FINSI;
    |SINO;
         nSwPie = 1;
         Impresora = "CrystalReport";
         |IMPRE -1;
         |SI FSalida = 0;
             informe   = "vigcr107";
             |INFOR informe;
             |SI FSalida = 0;
                 |ABRE #50;
                 |BUCLE lee_lin;
                 |CIERRA #50;
                 |BUCLE HistoTras;
                 |BUCLE ImpreNueva;
                 |SI nSwPie = 1;
                      |PIEINF;
                 |FINSI;
             |FINSI;
             |FININF;
             |FINIMP;
         |FINSI;
    |FINSI;
    |HAZ BoraTempo;
    |DELINDEX #5;
|FINSI;
|FCAL;
