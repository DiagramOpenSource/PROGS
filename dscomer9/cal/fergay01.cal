     || Orden 86101 cli:3654

|FICHEROS;
     fergay01 #0;
     fergam01 #1;
     fergam02 #2;
     fergaw04 #4; ||Tmp
     fergaw09 #9; ||Tmp
     fergam08 #8;
     fergam10 #10;
|FIN;

|VARIABLES;
     nNume = 0;
     nTiempo = 0;
     nHora = 0;
     nMinu = 0;
     nHora1 = 0;
     nHora2 = 0;
     nMaqui = 0;
     aFecha = "";
     aHoraIni = "";
     aHoraFin = "";
     &enLin = 0;
     aTmp4 = "";
     aTmp9 = "";
     &Tempo = "";
     &enKg1 = 0;    || Elabo
     &enKg2 = 0;    || Arma Kg
     &enKg3 = 0;    || Arma Punt
     &enKg4 = 0;    || Pilo
     &enPorce1 = 0;
     &enPorce2 = 0;
     &enPorce3 = 0;
     &enPorce4 = 0;
     nTipo = 0;
     nUni = 0;
     &enTKg1 = 0;
     &enTKg2 = 0;
     &enTKg3 = 0;
     &enTKg4 = 0;
     nKgs = 0;
     nCam3 = 0;
     nCam4 = 0;
     fDFecha = @;
|FIN;


|PROCESO Traba;
     nKgs = #9#3 + #9#4 + #9#7 + #9#5;
     enPorce1 = 100 * #9#3 / nKgs;
     enPorce2 = 100 * #9#4 / nKgs;
     enPorce3 = 100 * #9#7 / nKgs;
     enPorce4 = 100 * #9#5 / nKgs;
     |DDEFECTO #1;
     #1#0 = #9#0;        ||personal
     |LEE 000#1=;
     enLin = 1; |PRINT;
|FPRC;

|DEFBUCLE Traba;
     #9#1;
     ;
     #4#1, 0000;
     #4#1, 9999;
     ;
     NULL, Traba;
|FIN;

|PROCESO Tmp;
     |DDEFECTO #2;
     #2#0 = #4#1;        ||maquina
     |LEE 000#2=;

     enPorce1 = 100 * #4#3 / enKg1;
     enPorce2 = 100 * #4#4 / enKg2;
     enPorce3 = 100 * #4#7 / enKg3;
     enPorce4 = 100 * #4#5 / enKg4;

     enLin = 0; |PRINT;
     |SI #0#9 = "S";
          |BUCLE Traba;
          |SI enLin = 1; enLin = 2; |PRINT; |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE Tmp;
     #4#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Tmp;
|FIN;

|PROCESO Tiempo;
     nHora = (A\(aHoraIni % 102));
     nMinu = (A\(aHoraIni % 402));
     nHora1 = nHora * 60 + nMinu;

     nHora = (A\(aHoraFin % 102));
     nMinu = (A\(aHoraFin % 402));
     nHora2 = nHora * 60 + nMinu;

     |SI nHora2 < nHora1;
          nNume = ((24*60 - nHora1) + nHora2) / 60;
     |SINO;
          nNume = (nHora2 - nHora1) / 60;
     |FINSI;
     nTiempo = nTiempo + nNume;
|FPRC;

|PROCESO TiempoMaqui;
     |SI aFecha ! "";
          |HAZ Tiempo;
          |DDEFECTO #4;
          #4#1 = nMaqui;
          #4#0 = 0;
          |LEE 101#4=;
          |SI FSalida ! 0; |GRABA 020#4b; |FINSI;
          #4#2 = #4#2 + nTiempo;
          |GRABA 020#4a;
          |LIBERA #4;
     |FINSI;
|FPRC;

|PROCESO fergam10;
     nCam3 = #10#3;
     nCam4 = #10#4;
     |SI #10#0 < #0#0;
          |SI #10#3 ] #10#4;
               nCam3 = "00.00.00";
          |SINO;
               |ACABA;
          |FINSI;
     |FINSI;
     |SI #10#0 = #0#1;
          |SI #10#3 ] #10#4;
               nCam4 = "23.59.59";
          |FINSI;
     |FINSI;

     |SI #10#0 ! aFecha; |O #10#1 ! nMaqui;
          |HAZ TiempoMaqui;
          nTiempo = 0;
          aHoraIni = nCam3;
          aHoraFin = nCam4;
     |SINO;
          |SI #10#3 > aHoraFin;
               |HAZ Tiempo;
               aHoraIni = nCam3;
               aHoraFin = nCam4;
          |SINO;
               aHoraFin = nCam4;
          |FINSI;
     |FINSI;

     || --------------- el detalle
     #2#0 = #10#1;
     |LEE 000#2=;
     |SI FSalida ! 0; |DDEFECTO #2; |FINSI;

     |SI #2#2 = "S"; nTipo = 1; |FINSI;  ||Elaboracion
     |SI #2#3 = "S"; nTipo = 2; |FINSI;  ||Armado Kg
     |SI #2#4 = "S"; nTipo = 3; |FINSI;  ||Armado Puntos
     |SI #2#5 = "S"; nTipo = 4; |FINSI;  ||Pilotera

     |DDEFECTO #9;
     #9#1 = #10#1;
     #9#0 = #10#2;
     |LEE 101#9=;
     |SI FSalida ! 0; |GRABA 020#9b; |FINSI;
     #9#2 = #9#2 + #10#5;
     |SI nTipo = 1; #9#3 = #9#3 + #10#6; |FINSI;
     |SI nTipo = 2; #9#4 = #9#4 + #10#6; |FINSI;
     |SI nTipo = 3; #9#7 = #9#7 + #10#6; |FINSI;
     |SI nTipo = 4; #9#5 = #9#5 + #10#6; |FINSI;
     #9#6 = #9#3 + #9#4 + #9#5 + #9#7;
     |GRABA 020#9a;
     |LIBERA #9;

     aFecha = #10#0;
     nMaqui = #10#1;
|FPRC;

|DEFBUCLE fergam10;
     #10#1;
     ;
     fDFecha, #0#4, #0#2, "        ";
     #0#1, #0#5, #0#3, "zzzzzzzz";
     ;
     NULL, NULL, NULL, NULL, NULL, fergam10;
     #10#0, #10#1, #10#3, #10#4;
|FIN;

|PROCESO fergam08;
     || Si no tiene horas trabajadas no sale esa maquina
     #4#1 = #8#4;
     #4#0 = 0;
     |LEE 000#4];
     |SI FSalida ! 0; |O #4#1 ! #8#4; |ACABA; |FINSI;

     #2#0 = #8#4;
     |LEE 000#2=;
     |SI FSalida ! 0; |DDEFECTO #2; |FINSI;

     nTipo = 5;     || Sin
     |SI #2#2 = "S"; nTipo = 1; |FINSI;  ||Elaboracion
     |SI #2#3 = "S"; nTipo = 2; |FINSI;  ||Armado Kg
     |SI #2#4 = "S"; nTipo = 3; |FINSI;  ||Armado Puntos
     |SI #2#5 = "S"; nTipo = 4; |FINSI;  ||Pilotera

     |SI nTipo = 1; |Y #0#6 = "N"; |ACABA; |FINSI;  ||Elaboracion
     |SI nTipo = 2; |Y #0#7 = "N"; |ACABA; |FINSI;  ||Armado Kg
     |SI nTipo = 3; |Y #0#11 = "N"; |ACABA; |FINSI; ||Armado Puntos
     |SI nTipo = 4; |Y #0#10 = "N"; |ACABA; |FINSI; ||Pilotes
     |SI nTipo = 5; |Y #0#9  = "N"; |ACABA; |FINSI; ||Otras

     |DDEFECTO #4;
     #4#1 = #8#4;
     #4#0 = 0;
     |LEE 101#4=;
     |SI FSalida ! 0; |GRABA 020#4b; |FINSI;

     |SI nTipo = 1; #4#3 = #4#3 + #8#9; |FINSI;
     |SI nTipo = 2; #4#4 = #4#4 + #8#9; |FINSI;
     |SI nTipo = 3; #4#7 = #4#7 + #8#9; |FINSI;
     |SI nTipo = 4; #4#5 = #4#5 + #8#9; |FINSI;
     #4#6 = #4#3 + #4#4 + #4#5 + #4#7;
     |GRABA 020#4a;
     |LIBERA #4;

     |SI nTipo = 1; enKg1 = enKg1 + #8#9; |FINSI;
     |SI nTipo = 2; enKg2 = enKg2 + #8#9; |FINSI;
     |SI nTipo = 3; enKg3 = enKg3 + #8#9; |FINSI;
     |SI nTipo = 4; enKg4 = enKg4 + #8#9; |FINSI;
|FPRC;

|DEFBUCLE fergam08;
     #8#3;
     ;
     #0#0, #0#4;
     #0#1, #0#5;
     ;
     NULL, fergam08;
|FIN;

|PROCESO T3; |TIPO 3;
     |IMPRE 0;
     |SI FSalida = 0;
          |INFOR "fergay01";
          |SI FSalida = 0;
               |HAZ CreaTempo; |NOME_DAT #4 Tempo; |DELINDEX #4; |ABRE #4; aTmp4 = Tempo;
               |HAZ CreaTempo; |NOME_DAT #9 Tempo; |DELINDEX #9; |ABRE #9; aTmp4 = Tempo;

               nNume = #0#0; nNume = nNume - 1; fDFecha = nNume;
               |ABRE #2;
               |BUCLE fergam10;
               |HAZ TiempoMaqui;
               |BUCLE fergam08;
               |CIERRA #2;

               |LEE 000#4p;
               |SI FSalida = 0;
                    |ABRE #1;
                    |ABRE #2;
                    |BUCLE Tmp;
                    |CIERRA #2;
                    |CIERRA #1;
               |SINO;
                    |MENAV "0000Selecci¢n vacia...";
               |FINSI;

               Tempo = aTmp4; |CIERRA #4; |HAZ BoraTempo; |DELINDEX #4;
               Tempo = aTmp9; |CIERRA #9; |HAZ BoraTempo; |DELINDEX #9;

               |PIEINF;
               |FININF;
          |SINO;
               |SI #0#9 = "N";
                    |MENAV "0000Error en informe 'fergay01'...";
               |SINO;
                    |MENAV "0000Error en informe 'fergat01'...";
               |FINSI;
          |FINSI;
          |FINIMP;
     |FINSI;
|FPRC;
