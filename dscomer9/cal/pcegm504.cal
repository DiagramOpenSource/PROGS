          AcumulaPV_PCEG

|FICHEROS;
     dsz99998 #0,MANTE;

     pcegm012 #12;  || Aux. Articulo
     pcegm004 #14;  ||Ped Ventas
     pcegm005 #15;

     agifa019 #19;
     agifa017 #17;
     dsm00024 #24;

     agifa142 #142;
|FIN;

|CAMPOS;
     #19#15  art_pser;  #17#42  alm_pser;
     #19#182 art_pser2; #17#44  alm_pser2;
     #19#16  art_prec;  #17#43  alm_prec;
     #19#183 art_prec2; #17#45  alm_prec2;
     #19#17  art_pval;  #17#4   alm_pval;
     #19#11  art_nece;  #17#50  alm_nece;
     #19#12  art_rese;  #17#8   alm_rese;
     #19#14  art_depo;  #17#10  alm_depo;
     #19#184 art_depo2; #17#46  alm_depo2;
     #19#13  art_fabr;  #17#9   alm_fabr;
     #19#10  art_vsto;  #17#3   alm_vsto;
     #19#7   art_mini;  #17#6   alm_mini;
     #19#8   art_maxi;  #17#7   alm_maxi;
     #19#6   art_tota;  #17#5   alm_tota;
     #19#185 art_tota2; #17#47  alm_tota2;
     #19#104 art_disp;  #17#39  alm_disp;
     #19#193 art_disp2; #17#48 alm_disp2;
     #19#9   art_pcm;   #17#69 alm_pcm;
     #24#9   par_ereal; #24#10  par_ereal2;
     #24#11  par_sreal; #24#12  par_sreal2;
     #24#18  par_prec2;  #24#19  par_prec;
     #24#16  par_pser;  #24#17  par_pser2;
     #24#20  par_depo;  #24#21  par_depo2;
     #24#22  par_tota;  #24#23  par_tota2;
     #24#31  par_disp;  #24#32  par_disp2;
     #24#14  par_merma;
|FIN;

|VARIABLES;
     &enRechaza = 0;
     &enAnula = 0
     nPreTon = 0;
     aRaya = "";
     aArtiDoc = "";
     aMensaje = "";
     &enUdPedUno = 0;
     &enUdPedDos = 0;

     &enUni1 = 0;
     &enUni2 = 0;
     &enAlbForma = 0;

     &efFAlba = @;
     &enMed1 = 0;
     &enMed2 = 0;
     &enMed3 = 0;
     nUni0 = 0;
     &nDeci_Base = 0;
     &nDeci_PreBase = 0;
     &precio_base = 0;
     &eaImporIber= "N";
     &Tempo      = "";
     &eaCompVent = "V";
     nEsEscan    = 0;
     aCli        = "";
     nGuardaAlma = 0;
     aIPRemoto = "";
     nSwAdjPed = 0;
     aDef      = "";
     aPath     = "";
     aBase     = "";
     xCoste   = 0;
     aParamCBOK= "";
     aNume     = "";
     nHandle   = 0;
     aMensaPesa= "";
     nSwParam  = 0;
     aEsSalida = "S";
     aOperaInte= "";
     aOperacion= "";
     fUltFecha = @;
     nSwModi   = 0;
     nPosi     = 0;
     nCoste    = 0;
     nUnidades = 0;
     nUnidades2= 0;
     nUniPen   = 0;
     nUniPen2  = 0;
     nUniPend   = 0;
     nUniPend2 = 0;
     nMerma    = 0;
     xnCoste   = 0;
     nSwVer    = 0;
     nSalida   = 0;
     aProg     = "";
     aOpera    = "";
     aAlfa     = "";
     aAlf1     = "";
     aArti     = "";
     aParti    = "";
     nAlma     = 0;
     nPos      = 0;
     nUni2     = 0;
     nUni      = 0;
     nNume     = 0;
     nPm       = 0;
     nPcm      = 0;
     nPvp1     = 0; nPvp2 = 0; nPvp3 = 0; nPvp4 = 0; nPvp5 = 0; nPvp6 = 0;
     nNume1    = 0; nNume2 = 0; nNume3 = 0; nNume4 = 0; nNume5 = 0; nNume6 = 0;
     nCampo    = 0;
     nPrecio   = 0;
     nNeto     = 0;
     nForma    = 0;
     nSto      = 0;
     nSto1     = 0;
     nImpo     = 0;
     nMargen   = 0;
     aSer      = "";
     aEsInte   = "";
     nAlmaInte = 0;
     aCbUni    = "";
     nCbUni    = 0;
     aCbParti  = "";
     aCbArti   = "";
     nNum      = 0;
     nLin      = 0;
     nPreKit   = 0;
     nTotaKit  = 0;
     nPorce    = 0;
     nUniRes = 0;
     nUniSer = 0;
     nUniSer2 = 0;
|FIN;

|INCLUYE i_varart;

|PROCESO LeArticuloPCEG;
     |ABRE #142; |LEE 000#142p; |CIERRA #142;

     |ABRE #19;
     |ABRE #17;
     |DDEFECTO #19;
     |DDEFECTO #17;

     #19#0 = aArti;
     |LEE 101#19=;
     |SI FSalida ! 0; |GRABA 020#19b; |FINSI;

     #17#0 = aArti;
     #17#1 = nAlma;
     |LEE 101#17=;
     |SI FSalida ! 0; |GRABA 020#17b; |FINSI;

     |SI #19#180 = "S";       || Si hay partidas
          |ABRE #24;
          |DDEFECTO #24;
          #24#0 = aArti;
          #24#1 = nAlma;
          #24#2 = aParti;
          |LEE 101#24=;
          |SI FSalida ! 0; |GRABA 020#24b; |FINSI;
     |FINSI;
|FPRC;

|PROCESO GrabaArti_PCEG;
     |GRABA 020#17a;
     |GRABA 020#19a;
     |CIERRA #19;
     |CIERRA #17;
     |SI #19#180 = "S";
          |GRABA 020#24a;     || Si hay partidas
          |CIERRA #24;
     |FINSI;
|FPRC;

|PROCESO StockPV_PCEG;
     |SI #14#70 = "C"; |Y enRechaza = 0;
          |SI #15#5 > 0;
               art_pser = art_pser + nUnidades - nUniSer;
               art_pser2 = art_pser2 + nUnidades2 - nUniSer2;
               alm_pser = alm_pser + nUnidades - nUniSer;
               alm_pser2 = alm_pser2 + nUnidades2 - nUniSer2;
               par_pser = par_pser + nUnidades - nUniSer;
               par_pser2 = par_pser2 + nUnidades2 - nUniSer2;
          |FINSI;

          art_rese = art_rese + nUniRes;
          art_disp = art_disp - nUniRes;
          ||art_disp2 = art_disp2 - nUniRes2;
          alm_rese = alm_rese + nUniRes;
          alm_disp = alm_disp - nUniRes;
          ||alm_disp2 = alm_disp2 - nUniRes2;
          par_disp = par_disp - nUniRes;
          ||par_disp2 = par_disp2 - nUniRes2;
     |FINSI;

     |SI enAnula = 0; |Y #15#5 > 0;
          |DDEFECTO #12;
          |ABRE #12;
          #12#0 = #19#0;
          |LEE 101#12=;
          |SI FSalida ! 0; |GRABA 020#12b; |FINSI;
          #12#1 = #12#1 + nUnidades - nUniSer;
          |GRABA 020#12a;
          |CIERRA #12;
     |FINSI;

     |HAZ ValoraStock;
|FPRC;

|PROCESO AcumulaPV_PCEG;
     aArti = #15#2;
     nAlma = #15#3;
     aParti = #15#45;
     nMerma = #15#46;
     nPrecio = #15#6;
     |SI enForma = 1;
          nUniRes = #15#60;
          nUni = #15#5;
          nUni2 = #15#44;
          nUniSer = #15#43;
          nUniSer2 = #15#49;
     |SINO;
          nUniRes = -#15#60;
          nUni = -#15#5;
          nUni2 = -#15#44;
          nUniSer = -#15#43;
          nUniSer2 = -#15#49;
     |FINSI;
     nUnidades = nUni;
     nUnidades2 = nUni2;

     |HAZ LeArticuloPCEG;
     |HAZ StockPV_PCEG;
     |HAZ GrabaArti_PCEG;
|FPRC;
