|FICHEROS;
     malpe001 #0;
     web20002 #2;
     malpe003 #3;
     web20004 #4;
     agifa024 #24;
     agifa025 #25;
     malpe081 #81;
     malpe185 #185;
     malpe210 #210;
|FIN;

|VARIABLES;
     aDes = "";
     nForma = 0;
     nModo = 0;
     aAlfa = "";
     aAlf1 = "";
     aAlf2 = "";
     aAlf3 = "";
     nNume = 0;
     nNum1 = 0;
     nNum2 = 0;
     nNum3 = 0;
     aCPF = "";
     aCPO = "";
     aCP = "";
     aRepre = "";
 {-1}aMenu           = "";
     aMenu1          = "2400";
     aMenu2          = "1";
     aMenu3          = "Opciones:  ";
     aMenu4          = "OI";
     aMenu5          = " Obs. Administrativa ";
     aMenu6          = " Incidencias ";
     &eaCliente = "";
     &enObra = 0;
     &enModo = 0;
|FIN;

|PROCESO post_obra;
     #0#25 =(("00" + #0#8) % -102)+ (("000" + #0#9) % -103)
     #0#26 =(("00" + #0#20) % -102)+ (("000" + #0#21) % -103)
|FPRC;

|PROCESO Defecto; |TIPO 0;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 1;
          |ABRE #81;|LEE 000#81p;|CIERRA #81;
          #0#29 = #81#4;
          #0#30 = #81#5;
     |FINSI;
|FPRC;

|PROCESO TipoTrans; |TIPO 0;
     |ABRE #3;
     #3#0 = #0#22;
     #3#3 = "01.01.0000";
     |LEE 000#3];
     |SI FSalida ! 0; |O #0#22 ! #3#0;
          |MENAV "0000Tarifa de precios inexistente...";
          |ERROR;
     |FINSI;
     |CIERRA #3;
|FPRC;

|PROCESO TipoTrans66; |TIPO 66;
     |ABRE #3;
     #3#0 = #0#22;
     #3#3 = "01.01.0000";
     |LEE 000#3];
     |CONSULTA_CLAVE #1#3;
     |SI FSalida = 0;
          #0#22 = #3#0; |PINTA #0#22;
     |FINSI;
     |CIERRA #3;
|FPRC;

|PROCESO Cli6; |TIPO 6; || POR PROBLEMAS CON RELACIONES
     |ABRE #24;
     #24#0 = #0#0;
     |LEE 000#24=;
     |SI FSalida ! 0;
          aAlfa = "dsz99955;" + #0#0;
          |SUB_EJECUTA_NP aAlfa;
     |FINSI;
     |CIERRA #24;
|FPRC;

|PROCESO GrabaEl4;
     |DDEFECTO #4;
     #4#0 = #2#0;
     #4#1 = #0#1;
     #4#2 = #0#2;
     #4#3 = #0#6;
     #4#4 = #0#0;
     |LEE 000#4=;
     |SI FSalida ! 0; |GRABA 020#4n; |FINSI;
|FPRC;

|PROCESO GrabaObra4;
     aAlfa = #0#2; |QBF aAlfa;
     aAlfa = aAlfa + "-" + #0#15;
     |DDEFECTO #4;
     #4#0 = #2#0;
     #4#1 = #0#1;
     #4#2 = aAlfa;
     #4#3 = #0#6;
     #4#4 = #0#0;
     |LEE 000#4=;
     |SI FSalida ! 0; |GRABA 020#4n; |FINSI;
|FPRC;

|PROCESO GrabaJefe4;
     aAlfa = #0#31; |QBF aAlfa;
     |DDEFECTO #4;
     #4#0 = #2#0;
     #4#1 = #0#1;
     #4#2 = "Jefe Grupo " + aAlfa + "-" + #0#15;
     #4#3 = #0#6;
     #4#4 = #0#0;
     |LEE 000#4=;
     |SI FSalida ! 0; |GRABA 020#4n; |FINSI;
|FPRC;

|PROCESO GrabaRepre4;
     |DDEFECTO #4;
     #4#0 = #2#0;
     #4#1 = #0#1;
     #4#2 = #25#1;
     #4#3 = #0#6;
     #4#4 = #0#0;
     |LEE 000#4=;
     |SI FSalida ! 0; |GRABA 020#4n; |FINSI;
|FPRC;

|PROCESO GrabaOro;
     #2#1 = aDes;
     #2#2 = nNume;
     #2#3 = #0#0;
     #2#5 = "C";
     #2#6 = "S";
     |GRABA 020#2n;
|FPRC;

|PROCESO GrabaBasico;
     #2#1 = aDes;
     #2#2 = nNume;
     #2#3 = #0#0;
     #2#5 = "C";
     #2#6 = "N";
     |GRABA 020#2n;
|FPRC;

|PROCESO GrabaOroR;
     #2#1 = #25#1;
     #2#2 = nNume;
     #2#3 = ""
     #2#4 = #25#0;
     #2#5 = "R";
     #2#6 = "S";
     |GRABA 020#2n;
|FPRC;

|PROCESO GrabaBasicoR;
     #2#1 = #25#1;
     #2#2 = nNume;
     #2#3 = "";
     #2#4 = #25#0;
     #2#5 = "R";
     #2#6 = "N";
     |GRABA 020#2n;
|FPRC;

|PROCESO BorraInci;
     |BORRA 020#185a;
|FPRC;

|DEFBUCLE BorraInci;
     #185#1;
     ;
     #0#0, #0#1, 001;
     #0#0, #0#1, 999;
     be;
     NULL, BorraInci;
|FIN;

|PROCESO TipoMal2; |TIPO 2;
     nModo = (FEntrada / 100) ! 0;
     nForma = 0 +. 1;
     |SI nForma = 1;
          |ABRE #24;
          #24#0 = #0#0;
          |LEE 020#24=;
          |CIERRA #24;

          |ABRE #2;
          |ABRE #4;
||Cliente
          aDes = #0#15;
          aCPF = (("00" + #0#20) % -102) + (("000" + #0#21) % -103);
          aAlf1 = #0#15; |QBT aAlf1;
          aAlf1 = aAlf1 % 101;
          aAlf2 = #0#0;
          aAlf2 = aAlf2 % -104;
          aAlfa = "S" + aAlf1 + aAlf2;
          #2#0 = aAlfa;
          |LEE 000#2=;
          nNum1 = #0#0;
          nNum2 = aCPF;
          nNume = ((nNum1 + nNum2) * 11 / 7) ! 0;
          |SI FSalida ! 0;
               |HAZ GrabaOro;
          |FINSI;
          |HAZ GrabaEl4;

          aAlfa = "N" + aAlf1 + aAlf2;
          #2#0 = aAlfa;
          |LEE 000#2=;
          nNum1 = #0#0;
          nNum2 = aCPF;
          nNume = ((nNum1 + nNum2) * 13 / 7) ! 0;
          |SI FSalida ! 0;
               |HAZ GrabaBasico;
          |FINSI;
          |HAZ GrabaEl4;
||Obra
         aDes = #0#2; |QBF aDes;
         aDes = aDes + "-" + #0#15;
          aCPO = (("00" + #0#8) % -102) + (("000" + #0#9) % -103);
          aAlf3 = aAlf2 + (("0000" + #0#1) % -103);

          aAlfa = "S" + aAlf1 + aAlf3;
          #2#0 = aAlfa;
          |LEE 000#2=;
          nNum1 = #0#0;
          nNum2 = aCPF;
          nNum3 = aCPO;
          nNume = ((nNum1 + nNum2 + nNum3 + #0#1) * 11 / 7) ! 0;
          |SI FSalida ! 0;
               |HAZ GrabaOro;
          |FINSI;
          |HAZ GrabaObra4;

          aAlfa = "N" + aAlf1 + aAlf3;
          #2#0 = aAlfa;
          |LEE 000#2=;
          nNum1 = #0#0;
          nNum2 = aCPF;
          nNum3 = aCPO;
          nNume = ((nNum1 + nNum2 + nNum3 + #0#1) * 13 / 7) ! 0;
          |SI FSalida ! 0;
               |HAZ GrabaBasico;
          |FINSI;
          |HAZ GrabaObra4;
||Jefe
          aDes = #0#31; |QBF aDes;
          aDes = "Jefe Grupo " + aDes + "-" + #0#15;

          aAlf3 = aAlf2 + #0#31;

          aAlfa = "S" + aAlf1 + aAlf3;
          #2#0 = aAlfa;
          |LEE 000#2=;
          aAlfa = #0#31 % 101;
          nNum1 = &aAlfa;
          aAlfa = #0#31 % 201;
          nNum2 = &aAlfa;
          nNum3 = #0#0;
          nNume = ((nNum1 + nNum2 + nNum3) * 11 / 7) ! 0;
          |SI FSalida ! 0;
               |HAZ GrabaOro;
          |FINSI;
          |HAZ GrabaJefe4;

          aAlfa = "N" + aAlf1 + aAlf3;
          #2#0 = aAlfa;
          |LEE 000#2=;
          aAlfa = #0#31 % 101;
          nNum1 = &aAlfa;
          aAlfa = #0#31 % 201;
          nNum2 = &aAlfa;
          nNum3 = #0#0;
          nNume = ((nNum1 + nNum2 + nNum3) * 13 / 7) ! 0;
          |SI FSalida ! 0;
               |HAZ GrabaBasico;
          |FINSI;
          |HAZ GrabaJefe4;
||Repre
          aRepre = #24#25;
          |ABRE #25;
          |ATRI I; |PINTA 2408, " Representante para Identificacion: "; |ATRI 0;
          |PARA FSalida = 1; |SI FSalida ! 0;  |HACIENDO;
               E_sup = 2;
               E_inf = "";
               aRepre = 2445 ? 1;
               |SI FSalida = 6;         ||F11
                    |CONSULTA_CLAVE #1#25;
                    aRepre = #25#0;
               |SINO;
                    #25#0 = aRepre;
                    |LEE 000#25=;
                    |SI FSalida ! 0;
                         |MENAV "0000No existe Representante...";
                    |FINSI;
               |FINSI;
          |SIGUE;
          |BLIN 24;
          |CIERRA #25;

          aAlf1 = #25#1 % 102;
          aAlfa = "R" + aAlf1 + "0" + #25#0;
          #2#0 = aAlfa;
          |LEE 000#2=;
          aAlfa = #0#31 % 101;
          nNum1 = &aAlfa;
          aAlfa = #0#31 % 201;
          nNum2 = &aAlfa;
          nNum3 = #24#0;
          nNume = ((nNum1 + nNum2 + nNum3) * 11 / 7) ! 0;
          |SI FSalida ! 0;
               |HAZ GrabaOroR;
          |FINSI;
          |HAZ GrabaRepre4;

          aRepre = #25#9; |QBF aRepre;
          |SI aRepre ! "";
               |ABRE #25;
               #25#0 = aRepre;
               |LEE 000#25=;
               |CIERRA #25;

               aAlf1 = #25#1 % 102;
               aAlfa = "R" + aAlf1 + "0" + #25#0;
               #2#0 = aAlfa;
               |LEE 000#2=;
               aAlfa = #0#31 % 101;
               nNum1 = &aAlfa;
               aAlfa = #0#31 % 201;
               nNum2 = &aAlfa;
               nNum3 = #24#0;
               nNume = ((nNum1 + nNum2 + nNum3) * 11 / 7) ! 0;
               |SI FSalida ! 0;
                    |HAZ GrabaOroR;
               |FINSI;
               |HAZ GrabaRepre4;
          |FINSI;

          #2#0 = "ECF01"; ||Gerente
          |HAZ GrabaEl4;

          #2#0 = "LJL02"; ||Jefe Ventas
          |HAZ GrabaEl4;

          |CIERRA #4;
          |CIERRA #2;
     |FINSI;
     |SI nModo = 3;
          eaCliente = #0#0;
          enObra = #0#1;
          |SUB_EJECUTA_NP "malpe020;BORRA";
          |BUCLE BorraInci;
     |SINO;
          |SI nForma = 1;
               eaCliente = #0#0;
               enObra = #0#1;
               |SUB_EJECUTA_NP "malpe020";
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Observa; |TIPO 20;
     |SI FSalida = "OPCION";
          FSalida = "Opciones";
     |SINO;
          |MENU aMenu;
          |SI FSalida = 1;
               |SI nModo = 1; |O nModo = 2;
                    |GRABA 020#0a;
               |FINSI;
               |LIBERA #0; |CIERRAT #0;
               eaCliente = #0#0;
               enObra = #0#1;
               |SUB_EJECUTA_NP "malpe020";
               |ABRET #0;
               |SI nModo = 4;
                    |LEE 000#0=;
               |SINO;
                    |LEE 101#0=;
               |FINSI;
          |FINSI;
          |SI FSalida = 2;
               eaCliente = #0#0;
               enObra = #0#1;
               enModo = 4;
               |SUB_EJECUTA_NP "malpe185";
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO PintaBotonInci; |TIPO 13;
     |PINTA 516, "컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴";
     |ABRE #185;
     #185#0 = #0#0;
     #185#1 = #0#1;
     #185#2 = 1;
     |LEE 000#185];
     |SI FSalida = 0; |Y #185#0 = #0#0; |Y #185#1 = #0#1;
          |ATRI S; |PINTA 516, " OBRA CON INCIDENCIAS "; |ATRI 0;
          |PARA; |SI FSalida = 0; |Y #185#0 = #0#0; |Y #185#1 = #0#1; |HACIENDO;
               |SI #185#7 = "A";
                    |ATRI S; |PINTA 516, " OBRA CON INCIDENCIAS ABIERTAS "; |ATRI 0;
               |FINSI;
               |LEE 000#185s;
          |SIGUE;
     |FINSI;
     |CIERRA #185;
|FPRC;

|PROCESO TariPor66; |TIPO 66;
     |ABRE #210;
     #210#0 = #0#44;
     #210#1 = "01.01.0000";
     |LEE 000#210];
     |CONSULTA_CLAVE #1#210;
     |SI FSalida = 0;
          #0#44 = #210#0; |PINTA #210#0;
     |SINO;
          |ERROR;
     |FINSI;
     |CIERRA #210;
|FPRC;

|PROCESO TariPor0; |TIPO 0;
     |ABRE #210;
     #210#0 = #0#44;
     #210#1 = "01.01.0000";
     |LEE 000#210];
     |SI FSalida ! 0; |O #210#0 ! #0#44;
          |MENAV "0000No existe tarifa...";
          |ERROR;
     |FINSI;
     |CIERRA #210;
|FPRC;
