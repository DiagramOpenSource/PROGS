||belm0021 ... es una apadtacion del coiplm01, Packing List.

||Listados:
||Packing List
||Etiquetas.

|FICHEROS;
     belm0021 #0;        ||Packing List (Cab.)
     belm0022 #2,MANTE;        ||Packing List (Lin.)
     belm0023 #3,MANTE;        ||Packing List (Paquetes)
     belm0024 #4,MANTE;        ||Packing List (5 Elemento)
     belw0001 #90;             ||Packing List (Tmp. para control Unidades)
     belw0002 #91,MANTE;
     belm0022@;
     referen@;

     belm0005 #44;       ||Tipos de Caja

     agifa104 #104;      ||Pedidos (CAB)
     agifa073 #73;       ||Pedidos (LIN)
     agifa010 #10;       ||Albaranes (CAB)
     agifa071 #71;       ||Albaranes (LIN)
     agifa024 #24;       ||Clientes
     agifa019 #19;       ||Articulos
     dsm00020 #20;       ||Agencia Transportes
     dsm00005 #5;        ||Quinto Elemento.

     belz0003 #30;
|FIN;

|VARIABLES;
     nPesoCaja = 0;
     nPesoArt = 0;
     nSwPonAgencia = 0;
     nLinV = 0;
     nConta = 0;
     nPaq = 0;
     nUni = 0;
     aPar = "";
     aArt = "";
     nAlm = 0;
     aDef = "";
     i = 0;
     j = 0;
     nHayEleme = "";
     aAlfa    = "";
     &Tempo   = "";
     aTempo90 = "";
     aMensaje = "";
     nCampo   = 0;
     CantMax  = 0;
     Comodin  = "";
     HayDatos = 0;
     ModoElem = "";
     aSerie   = "";
     nNumero  = 0;
     aNumero  = "";
     aCliente = "";
     nPList   = 0;
     nPaquete = 0;
     nModo    = 0;
     nForma   = 0;
     nTipoLineal = 0;         ||Alta/Modificacion
     aNomArt = "";
     nCodAge = 0;
     aAgencia = "";
     aAlfa1 = "";
     aArt5Ele = "";
     nSwArt5Ele = 0;
     aTipoDoc = "";
     nLinea = 0;
     nLin = 0;
     aArticulo = "";
     nModoLin = 0;
     nFormaLin = 0;
     nCantidad = 0;
     nTipoQuinto = 0;
     aCompletado = "";
|FIN;

|PROCESO Tipo0C2; |TIPO 0;
     |SI #belm0021#2 = "M";
          |C_M #belm0021#3, 1, "N";
          |C_M #belm0021#4, 1, "N";
          |C_M #belm0021#27, 1, "S";
          |PINTA #belm0021#3;
          |PINTA #belm0021#4;
          |PINTA #belm0021#27;
     |SINO;
          |C_M #belm0021#3, 1, "S";
          |C_M #belm0021#4, 1, "S";
          |C_M #belm0021#27, 1, "N";
          |PINTA #belm0021#3;
          |PINTA #belm0021#4;
          |PINTA #belm0021#27;
     |FINSI;
|FPRC;

|PROCESO AutoManual; |TIPO 0;
     nCampo = Campo - 8;
     |SI #belm0021#Campo# = "A";
          |C_M #belm0021#nCampo#, 1, "N";
     |SINO;
          |C_M #belm0021#nCampo#, 1, "S";
     |FINSI;
|FPRC;

|PROCESO belw0001;
     |SI #belw0001#3 > 0;
          aCompletado = "N";
          |ERROR10;
     |SINO;
          aCompletado = "S";
     |FINSI;
|FPRC;

|DEFBUCLE belw0001;
 #belw0001#1;
 ;
 INICIO;
 FINAL;
 ;
 NULL, belw0001;
|FIN;

|PROCESO Final; |TIPO 3;
     aCompletado = "N";
     |BUCLE belw0001;
     #belm0021#26 = aCompletado;
     |PINTA #belm0021#26;

     aTempo90 = Tempo; |DELINDEX #90; |HAZ BoraTempo;
|FPRC;

|PROCESO tipo66;|TIPO 66;   || al pulsar F11
     |SI #belm0021#2 = "P";   ||Pedido
          |ABRE #agifa104;
          |CONSULTA_CLAVE #1#agifa104;
          |CIERRA #agifa104;
          #belm0021#3 = #agifa104#0;      ||Numero Pedido
          #belm0021#4 = #agifa104#25;     ||Serie
          |PINTA #belm0021#3;
          |PINTA #belm0021#4;
     |SINO;                   ||Albaran
          |ABRE #agifa010;
          |CONSULTA_CLAVE #1#agifa010;
          |CIERRA #agifa010;
          #belm0021#3 = #agifa010#0;      ||Numero Albaran
          #belm0021#4 = #agifa010#52;     ||Serie
          |PINTA #belm0021#3;
          |PINTA #belm0021#4;
          #belm0021#18 = #agifa010#88;    ||Cod. Agencia
          #belm0021#21 = #agifa010#9;     ||Agencia
          |PINTA #belm0021#18;
          |PINTA #belm0021#21;
     |FINSI;
|FPRC;

|PROCESO Cliente; |TIPO 0;
     ||Primero comprobar que realmente existe el Pedido/Albaran
     ||Si existe -> Averiguar Cliente
       ||Poner Datos Cliente
     ||Sino No dejar avanzar.

     |SI FSalida ! 2;              ||No vamos para atras
          aSerie = #belm0021#4;
          nNumero = #belm0021#3;
          aNumero = ("000000" + nNumero) % -106;
          |SI #belm0021#2 = "P";   ||Pedido
               |ABRE #agifa104;
               #agifa104#0 = #belm0021#3;      ||Numero Pedido
               #agifa104#25 = #belm0021#4;     ||Serie
               |LEE 000#agifa104.=;
               |SI FSalida = 0;
                    aCliente = #agifa104#4;
                    |HAZ DatosCliente;
               |SINO;
                    aMensaje = "0000Error: No existe el Pedido [" + aSerie + "/" + aNumero + "]";
                    |MENAV aMensaje;
                    |ERROR;
               |FINSI;
               |CIERRA #agifa104;
          |SINO;                   ||Albaran
               |SI #belm0021#2 = "A";   ||Albaran
                    |ABRE #agifa010;
                    #agifa010#0 = #belm0021#3;      ||Numero Albaran
                    #agifa010#52 = #belm0021#4;     ||Serie
                    |LEE 000#agifa010.=;
                    |SI FSalida = 0;
                         aCliente = #agifa010#3;
                         |HAZ DatosCliente;
                    |SINO;
                         aMensaje = "0000Error: No existe el Albaran [" + aSerie + "/" + aNumero + "]";
                         |MENAV aMensaje;
                         |ERROR;
                    |FINSI;
                    |CIERRA #agifa010;
               |SINO;
                    ||MANUAL.  Falta el control
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Tipo0C27; |TIPO 0;
     |SI #belm0021#2 = "M";
          nSwPonAgencia = 1;
          aCliente = #belm0021#27;
          |HAZ DatosCliente;
          nSwPonAgencia = 0;
     |FINSI;
|FPRC;

|PROCESO DatosCliente;
     |ABRE #agifa024;
     #agifa024#0 = aCliente;
     |LEE 000#agifa024.=;
     |SI FSalida = 0;
          #belm0021#27 = #agifa024#0;
          #belm0021#28 = #agifa024#1;
          #belm0021#5 = #agifa024#5;
          #belm0021#6 = #agifa024#6;
          #belm0021#7 = #agifa024#7;
          #belm0021#8 = #agifa024#178;
          #belm0021#9 = #agifa024#179;
          #belm0021#10 = #agifa024#8;
          #belm0021#11 = #agifa024#9;
          #belm0021#12 = #agifa024#10;
          #belm0021#13 = #agifa024#181;
          #belm0021#14 = #agifa024#182;
          |SI nSwPonAgencia = 1;
               #belm0021#18 = #agifa024#202;    ||Cod. Agencia
               #belm0021#21 = #agifa024#35;
               |PINTA #belm0021#18;
               |PINTA #belm0021#21;
          |FINSI;
     |SINO;
          #belm0021#27 = aCliente;
          #belm0021#28 = "";
          #belm0021#5 = "";
          #belm0021#6 = "";
          #belm0021#7 = "";
          #belm0021#8 = 0;
          #belm0021#9 = 0;
          #belm0021#10 = "";
          #belm0021#11 = "";
          #belm0021#12 = "";
          #belm0021#13 = 0;
          #belm0021#14 = 0;
          |SI nSwPonAgencia = 1;
               #belm0021#18 = 1;
               #belm0021#21 = "";
               |PINTA #belm0021#18;
               |PINTA #belm0021#21;
          |FINSI;
     |FINSI;
     |PINTA #belm0021#27;
     |PINTA #belm0021#28;
     |PINTA #belm0021#5;
     |PINTA #belm0021#6;
     |PINTA #belm0021#7;
     |PINTA #belm0021#8;
     |PINTA #belm0021#9;
     |PINTA #belm0021#10;
     |PINTA #belm0021#11;
     |PINTA #belm0021#12;
     |PINTA #belm0021#13;
     |PINTA #belm0021#14;
     |CIERRA #agifa024;
|FPRC;

|PROCESO LinAlbPed;
     nModo = ((FEntrada / 100) ! 0);
     nPList = #belm0021#0;
     nPaquete = #belm0022#1;
     |SI nModo = 1;
          nTipoLineal = 2;         ||Alta/Modificacion
          |HAZ MuestraLineas;
     |SINO;
          |SI nModo = 2;
               nTipoLineal = 2;         ||Alta/Modificacion
               |HAZ MuestraLineas;
          |FINSI;
    |FINSI;
|FPRC;

|PROCESO ActualizaCol; |TIPO 2;
     #belm0023#6 = #belm0023#6 +. #belm0024#4;

     |ABRE #belw0001;
     #belw0001#0 = #belm0023#3;
     #belw0001#1 = #belm0023#4;
     #belw0001#2 = #belm0024#3;
     |LEE 101#belw0001.=;
     |SI FSalida = 0;
        #belw0001#3 = #belw0001#3 -. #belm0024#4;
        |GRABA 020#belw0001.a; |LIBERA #belw0001;
     |FINSI;
     |CIERRA #belw0001;

     |HAZ RecogeNombre;
     |GRABA 020#belm0024.a;

|FPRC;

|PROCESO Tipo2; |TIPO 2;
     nModo = ((FEntrada / 100) ! 0);
     nForma = 0 +. 1;

     #belm0021#20 = #belm0021#20 +. 1;       ||Unidades
     |PINTA #belm0021#20;

     ||Poner los volumenes y pesos si esta en Automatico cada uno de los 3
     |SI #belm0021#23 = "A";
          #belm0021#15 = #belm0021#15 +. #belm0022#4;
          |PINTA #belm0021#15;
     |FINSI;
     |SI #belm0021#24 = "A";
          #belm0021#16 = #belm0021#16 +. #belm0022#5;
          |PINTA #belm0021#16;
     |FINSI;
     |SI #belm0021#25 = "A";
          #belm0021#17 = #belm0021#17 +. #belm0022#6;
          |PINTA #belm0021#17;
     |FINSI;

     |SI nModo = 3;
          nPList = #belm0021#0;
          nPaquete = #belm0022#1;
          |HAZ BorraLineas;
     |FINSI;
|FPRC;

|PROCESO min;
     #belm0023#0 = nPList;
     #belm0023#1 = nPaquete;
     #belm0023#2 = 001;
|FPRC;

|PROCESO max;
     #belm0023#0 = nPList;
     #belm0023#1 = nPaquete;
     #belm0023#2 = 999;
|FPRC;

|PROCESO RestaLin5Elem;
     #belw0001#0 = #belm0023#3;
     #belw0001#1 = #belm0023#4;
     #belw0001#2 = #belm0024#3;
     |LEE 101#belw0001.=;
     |SI FSalida = 0;
          #belw0001#3 = #belw0001#3 - #belm0024#4;
          |GRABA 020#belw0001.a; |LIBERA #belw0001;
     |FINSI;
|FPRC;

|DEFBUCLE RestaLin5Elem;
#belm0024#1;
;
#belm0023#0,#belm0023#1,#belm0023#2,"      ";
#belm0023#0,#belm0023#1,#belm0023#2,"zzzzzz";
;
NULL,RestaLin5Elem;
|FIN;

|PROCESO RestaLineas;
   |SI #belm0023#5 = "S";
     |BUCLE RestaLin5Elem;
   |SINO;
      #belw0001#0 = #belm0023#3;
      #belw0001#1 = #belm0023#4;
      #belw0001#2 = "      ";
      |LEE 101#belw0001.=;
      |SI FSalida = 0;
           #belw0001#3 = #belw0001#3 - #belm0023#6;
           |GRABA 020#belw0001.a; |LIBERA #belw0001;
      |FINSI;
   |FINSI;
|FPRC;

|DEFBUCLE RestaLineas;
#belm0023#1;
;
#belm0021#0,000001,001;
#belm0021#0,000001,999;
;
NULL,RestaLineas;
|FIN;

|PROCESO RecuentaPaq;
     #belm0022#7 = #belm0022#7 + #belm0023#6;

     nPesoArt = 0;
     |DDEFECTO #agifa019;
     #agifa019#0 = #belm0023#4;
     |LEE 000#agifa019.=;
     |SI FSalida = 0;
          nPesoArt = #belm0023#6 * #agifa019#102;
     |FINSI;
     #belm0022#6 = #belm0022#6 + nPesoArt;
|FPRC;

|DEFBUCLE RecuentaPaq;
#belm0023#1;
;
#belm0022#0,#belm0022#1,001;
#belm0022#0,#belm0022#1,999;
;
NULL,RecuentaPaq;
|FIN;

|PROCESO MuestraLineas;
     |PUSHV 0501 2380;
     |ENTLINEAL #1#belm0023, -3, nTipoLineal, 22, 1, min, max;
     #belm0022#7 = 0;

     nPesoCaja = 0;
     |ABRE #belm0005;
     |DDEFECTO #belm0005;
     #belm0005#0 = #belm0022#8;
     |LEE 000#belm0005.=;
     |SI FSalida = 0;
          nPesoCaja = #belm0005#2;
     |FINSI;
     |CIERRA #belm0005;


     #belm0022#6 = 0;
     |ABRE #agifa019;
     |BUCLE RecuentaPaq;
     |CIERRA #agifa019;
     #belm0022#5 = #belm0022#6 + nPesoCaja;
     |POPV;
|FPRC;

|PROCESO Tipo5; |TIPO 5;
     FSalida = "SINBARRA";
|FPRC;

|PROCESO Tipo11; |TIPO 11;
     nModo = ((FEntrada / 100) ! 0);
/*
     ||ESTO NO LO VAN A UTILIZAR EN COIMASA
     |SI FSalida = 10;
          |SI nModo = 4;
               |MENAV "0000Opcion no disponible en consulta...";
          |SINO;
               |SI nHayEleme = 0;
                    |HAZ Desglose;
               |SINO;
                    |MENAV "0000Opcion no disponible para el 5 Elemento...";
               |FINSI;
          |FINSI;
          |ERROR;
     |FINSI;
*/
     |SI FSalida = 13;
          |SI nModo = 4;
               nPList = #belm0021#0;
               nPaquete = #belm0022#1;
               nTipoLineal = 4;         ||Consultas
               |HAZ MuestraLineas;
          |SINO;
               |MENAV "0000Opcion solo en consulta...";
          |FINSI;
          |ERROR;
     |FINSI;
|FPRC;

|PROCESO belm0024_b;
     #belw0001#0 = #belm0023#3;
     #belw0001#1 = #belm0023#4;
     #belw0001#2 = #belm0024#3;
     |LEE 101#belw0001.=;
     |SI FSalida = 0;
        #belw0001#3 = #belw0001#3 + #belm0024#4;
        |GRABA 020#belw0001.a; |LIBERA #belw0001;
     |FINSI;
     |BORRA 020#belm0024.a;
|FPRC;

|DEFBUCLE belm0024_b;
 #belm0024#1;
 ;
 nPList, nPaquete, #belm0023#2, "      ";
 nPList, nPaquete, #belm0023#2, "zzzzzz";
 be;
 NULL, belm0024_b;
|FIN;

|PROCESO belm0023_b;
     |BUCLE belm0024_b;
     |BORRA 020#belm0023.a;
|FPRC;

|DEFBUCLE belm0023_b;
 #belm0023#1;
 ;
 nPList, nPaquete, 001;
 nPList, nPaquete, 999;
 be;
 NULL, belm0023_b;
|FIN;

|PROCESO BorraLineas;
     ||Si borramos un paquete, hemo de borrar sus lineas y lineas del 5 elemento.
     |BUCLE belm0023_b;
|FPRC;

|PROCESO Baja0004; |TIPO 1;
   #belw0001#0 = #belm0023#3;
   #belw0001#1 = #belm0023#4;
   #belw0001#2 = #belm0024#3;
   |LEE 101#belw0001.=;
   |SI FSalida = 0;
      #belw0001#3 = #belw0001#3 - #belm0024#4;
      |GRABA 020#belw0001.a; |LIBERA #belw0001;
   |FINSI;
|FPRC;

|PROCESO Baja0003; |TIPO 1;
   nModo = (FEntrada / 100) ! 0;
   |SI nModo = 3;
      |BUCLE belm0024_b;
   |FINSI;
|FPRC;

|PROCESO RellenaElem;
   |ABRE #belw0001;
   #belw0001#0 = #belm0023#3;
   #belw0001#1 = #belm0023#4;
   #belw0001#2 = #dsm00005#4;
   |LEE 101#belw0001.=;
   |SI FSalida = 0; |Y #belw0001#3 > 0;
      |DDEFECTO #belm0024;
      #belm0024#0 = #belm0023#0;
      #belm0024#1 = #belm0023#1;
      #belm0024#2 = #belm0023#2;
      #belm0024#3 = #dsm00005#4;
      #belm0024#4 = #belw0001#3;
      #belm0024#5 = #dsm00005#5;
      |GRABA 020#belm0024.n;
      #belm0023#6 = #belm0023#6 + #belm0024#4;

      #belw0001#3 = #belw0001#3 - #belm0024#4;
      |GRABA 020#belw0001.a; |LIBERA #belw0001;
      HayDatos = 1;
   |FINSI;
   |CIERRA #belw0001;
|FPRC;

|DEFBUCLE RellenaElem;
#dsm00005#1;
;
ModoElem,#belm0021#4,#belm0021#3,nLinV,"      ";
ModoElem,#belm0021#4,#belm0021#3,nLinV,"zzzzzz";
;
NULL,RellenaElem;
|FIN;

|PROCESO RecogeNombre;
   |ABRE #dsm00005;
   #dsm00005#0 = ModoElem;
   #dsm00005#1 = #belm0021#4;
   #dsm00005#2 = #belm0021#3;
   #dsm00005#3 = #belm0023#3;
   #dsm00005#4 = #belm0024#3;
   |LEE 000#dsm00005.=
   |SI FSalida = 0;
      #belm0024#5 = #dsm00005#5; |PINTA #belm0024#5;
   |FINSI;
   |CIERRA #dsm00005;
|FPRC;

|PROCESO MiraArt;|TIPO 0;
     nModo = ((FEntrada / 100) ! 0);

     Comodin = Comodin + "                ";
     |SI #belm0021#2 ! "M";
          |ABRE #agifa019;
          #agifa019#0 = #belm0023#4;
          |LEE 000#agifa019.=;
          |SI FSalida = 0;
               |PINTA #belm0023#4;
               aNomArt = " " + #agifa019#1;
               |PINTA 0650, aNomArt;
               |PINTA 0760, Comodin;
               |SI #agifa019#176 = "S";      ||Articulo tiene 5 Elemento
                    #belm0023#5 = "S";
                    |C_M #belm0023#6,1,"N";
               |SINO;
                    #belm0023#5 = "N";
                    |C_M #belm0023#6,1,"S";
               |FINSI;
          |SINO;
               aNomArt = "                                                  ";
               |PINTA 0510, aNomArt;
               aMensaje = "0000Error: Articulo Inexistente";
               |MENAV aMensaje;
               |ERROR;
          |FINSI;
          |CIERRA #agifa019;
          ModoElem = #belm0021#2 + "V";
          |SI nModo = 1;
             |ABRE #belm0024;
             HayDatos = 0;
             nLinV = #belm0023#3;
             |BUCLE RellenaElem;
             |CIERRA #belm0024;
             |SI HayDatos = 0; |ERROR; |FINSI;
          |FINSI;
     |SINO;
          |ABRE #agifa019;
          #agifa019#0 = #belm0023#4;
          |LEE 000#agifa019.=;
          |SI FSalida = 0;
               aNomArt = " " + #agifa019#1;
               |PINTA 0650, aNomArt;
               Comodin = "--";
               |PINTA 0760, Comodin;
          |SINO;
               aNomArt = "                                                  ";
               |PINTA 0510, aNomArt;
               Comodin = "--";
               |PINTA 0760, Comodin;
               aMensaje = "0000Error: Articulo Inexistente";
               |MENAV aMensaje;
               |ERROR;
          |FINSI;
          |CIERRA #agifa019;
     |FINSI;
|FPRC;

|PROCESO LlenarTmp; |TIPO 7;
     |SI FSalida = 0; |O FSalida = 5;        ||El 5 es para el Av. Pagina
          || Lo pongo en el T5
     |FINSI;
|FPRC;

|PROCESO CreaTmp;
     |HAZ CreaTempo; aTempo90 = Tempo;
     |NOME_DAT #90 aTempo90; |DELINDEX #90;
|FPRC;

|PROCESO agifa073;
     nLinea = #agifa073#1;
     aArticulo = #agifa073#2
     aArt5Ele = aArticulo;
     |HAZ Es5Elemento;
     |SI nSwArt5Ele = 0;                 ||No tiene Quinto Elemento
          |DDEFECTO #belw0001;
          #belw0001#0 = nLinea;
          #belw0001#1 = aArticulo;
          #belw0001#2 = "";
          |LEE 101#belw0001.=;
          |SI FSalida ! 0; |GRABA 020#belw0001.b; |FINSI;
          #belw0001#3 = #agifa073#5;         ||Unidades
          |GRABA 020#belw0001.a; |LIBERA #belw0001;
     |SINO;                               ||Es quinto Elemento.
          nHayEleme = 1;
          |SI nSwArt5Ele = 1;
               aTipoDoc = "PV";         ||Pedido Ventas
               |HAZ Recorre5Ele;
               ||Recorro y relleno por cada 5 Elemento. (dsm00005)
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO dsm00005;
     |DDEFECTO #belw0001;
     #belw0001#0 = nLinea;
     #belw0001#1 = aArticulo;
     #belw0001#2 = #dsm00005#4;
     |LEE 101#belw0001.=;
     |SI FSalida ! 0; |GRABA 020#belw0001.b; |FINSI;
     #belw0001#3 = #dsm00005#6;         ||Unidades
     |GRABA 020#belw0001.a; |LIBERA #belw0001;
|FPRC;

|DEFBUCLE dsm00005;
 #dsm00005#1;
 ;
 aTipoDoc, #belm0021#4, #belm0021#3, nLinea, "      ";
 aTipoDoc, #belm0021#4, #belm0021#3, nLinea, "zzzzzz";
 ;
 NULL, dsm00005;
|FIN;

|PROCESO Recorre5Ele;
     |BUCLE dsm00005;
|FPRC;

|DEFBUCLE agifa073;
 #agifa073#1;
 ;
 #belm0021#4, #belm0021#3, 001;
 #belm0021#4, #belm0021#3, 999;
 ;
 NULL, agifa073;
|FIN;

|PROCESO TmpPed;
     ||Lleno el temporal desde Pedido
     |BUCLE agifa073;
     ||Primero recorro Ped/Alb introduciendo valores en Temporal.
|FPRC;

|PROCESO agifa071;
     nLinea = #agifa071#1;
     aArticulo = #agifa071#2
     aArt5Ele = aArticulo;
     |HAZ Es5Elemento;
     |SI nSwArt5Ele = 0;                 ||No tiene Quinto Elemento
          |DDEFECTO #belw0001;
          #belw0001#0 = nLinea;
          #belw0001#1 = aArticulo;
          #belw0001#2 = "";
          |LEE 101#belw0001.=;
          |SI FSalida ! 0; |GRABA 020#belw0001.b; |FINSI;
          #belw0001#3 = #agifa071#5;         ||Unidades
          |GRABA 020#belw0001.a; |LIBERA #belw0001;
     |SINO;                               ||Es quinto Elemento.
          nHayEleme = 1;
          |SI nSwArt5Ele = 1;
               aTipoDoc = "AV";         ||Pedido Ventas
               |HAZ Recorre5Ele;
               ||Recorro y relleno por cada 5 Elemento. (dsm00005)
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE agifa071;
 #agifa071#1;
 ;
 #belm0021#4, #belm0021#3, 001;
 #belm0021#4, #belm0021#3, 999;
 ;
 NULL, agifa071;
|FIN;

|PROCESO TmpAlb;
     ||Lleno el temporal desde Albaran
     |BUCLE agifa071;
|FPRC;

|PROCESO Es5Elemento;
     ||Ver si el Articulo tiene o no Quinto Elemento.   aArt5Ele
     ||Devolvera nSwArt5Ele = 1 o 0
     |QBF aArt5Ele;
     |ABRE #agifa019;
     #agifa019#0 = aArt5Ele;
     |LEE 000#agifa019.=;
     |SI FSalida = 0;
          |SI #agifa019#176 = "S";      ||Articulo tiene 5 Elemento
               nSwArt5Ele = 1;
          |SINO;
               nSwArt5Ele = 0;
          |FINSI;
     |SINO;
          nSwArt5Ele = -1;              ||No existe este articulo
     |FINSI;
     |CIERRA #agifa019;
|FPRC;

|PROCESO belm0024;
     |ABRE #belw0001;
     #belw0001#0 = #belm0023#3;
     #belw0001#1 = #belm0023#4;
     #belw0001#2 = #belm0024#3;
     |LEE 101#belw0001.=;
     |SI FSalida = 0;
          #belw0001#3 = #belw0001#3 - #belm0024#4;
          |GRABA 020#belw0001.a; |LIBERA #belw0001;
     |SINO;
          aMensaje = "0000Existe un problema con el Paquete [" + #belm0023#1 + "] , Linea [" + #belm0023#2 + "] ,Quinto Elemento [" +  #belm0024#3 + "]";
          |MENAV aMensaje;
     |FINSI;
     |CIERRA #belw0001;
|FPRC;

|DEFBUCLE belm0024;
 #belm0024#1;
 ;
 #belm0021#0, #belm0023#1, #belm0023#2, "      ";
 #belm0021#0, #belm0023#1, #belm0023#2, "zzzzzz";
 ;
 NULL, belm0024;
|FIN;

|PROCESO belm0023;
     |SI #belm0023#5 = "N";
          |ABRE #belw0001;
          #belw0001#0 = #belm0023#3;
          #belw0001#1 = #belm0023#4;
          #belw0001#2 = "";
          |LEE 101#belw0001.=;
          |SI FSalida = 0;
               #belw0001#3 = #belw0001#3 - #belm0023#6;
               |GRABA 020#belw0001.a; |LIBERA #belw0001;
               ||aMensaje = "0000 Ahora tengo : " + #belw0001#3;
               ||MENAV aMensaje;
          |SINO;
               aMensaje = "0000Existe un problema con el Paquete [" + #belm0023#1 + "] , Linea [" + #belm0023#2 + "]";
               |MENAV aMensaje;
          |FINSI;
          |CIERRA #belw0001;
     |SINO;
          |BUCLE belm0024;
     |FINSI;
|FPRC;

|DEFBUCLE belm0023;
 #belm0023#1;
 ;
 #belm0021#0, 000001, 001;
 #belm0021#0, 999999, 999;
 ;
 NULL, belm0023;
|FIN;

|PROCESO ActTemporal;
     |BUCLE belm0023;
|FPRC;

|PROCESO Tipo0C2m03; |TIPO 0;
     |SI #belm0021#2 = "M";
          |C_M #belm0023#3, 1, "N";
          |C_M #belm0023#4, 1, "S";
     |SINO;
          |C_M #belm0023#3, 1, "S";
          |C_M #belm0023#4, 1, "N";
     |FINSI;
     |PINTA #belm0023#3;
     |PINTA #belm0023#4;
|FPRC;

|PROCESO Control; |TIPO 2;
     ||Controlar el numero de unidades y que el articulo
     ||pertenezca al pedido/albaran.
     nModoLin = ((FEntrada / 100) ! 0);
     nFormaLin = 0 +. 1;

     |SI #belm0021#2 ! "M";
          |SI #belm0023#5 = "N";        ||No es Quinto elemento.
               |ABRE #belw0001;
               #belw0001#0 = #belm0023#3;
               #belw0001#1 = #belm0023#4;
               #belw0001#2 = "";
               |LEE 101#belw0001.=;
               |SI FSalida = 0;
                    nCantidad = #belw0001#3 -. #belm0023#6;
                    |SI nCantidad < 0; |Y nFormaLin = 1;
                         aMensaje = "0000Error: Solo quedan por asignar [" + #belw0001#3 + "] unidades";
                         |MENAV aMensaje;
                         |ERROR;
                    |SINO;
                         #belw0001#3 = nCantidad;
                    |FINSI;
                    |GRABA 020#belw0001.a; |LIBERA #belw0001;
               |SINO;
                    |SI #belm0021#2 = "P";
                         aMensaje = "0000Error: Este articulo no pertenece a la linea [" + #belm0023#3 + "] del Pedido";
                    |SINO;
                         aMensaje = "0000Error: Este articulo no pertenece a la linea [" + #belm0023#3 + "] del Albaran";
                    |FINSI;
                    |MENAV aMensaje;
                    |ERROR;
               |FINSI;
               |CIERRA #belw0001;
          |SINO;
               |SI nModoLin = 1;
                    nTipoQuinto = 2;         ||Alta/Modificacion
                    |HAZ MuestraQuinto;
               |SINO;
                    |SI nModoLin = 2; |Y nFormaLin = 1;
                         nTipoQuinto = 2;         ||Alta/Modificacion
                         |HAZ MuestraQuinto;
                    |FINSI;
                    |SI nModoLin = 3;
                       |ABRE #belm0024; |ABRE #belw0001;
                       |BUCLE belm0024_b;
                       |CIERRA #belw0001; |CIERRA #belm0024;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO minQuinto;
     #belm0024#0 = nPList;
     #belm0024#1 = nPaquete;
     #belm0024#2 = #belm0023#2;
     #belm0024#3 = "      ";
|FPRC;

|PROCESO maxQuinto;
     #belm0024#0 = nPList;
     #belm0024#1 = nPaquete;
     #belm0024#2 = #belm0023#2;
     #belm0024#3 = "zzzzzz";
|FPRC;

|PROCESO MuestraQuinto;
     |ENTCOLUMNA #1#belm0024, -4, nTipoQuinto, 6, 2, minQuinto, maxQuinto;
|FPRC;

|PROCESO RecuentaArt;
   CantMax = CantMax + #belw0001#3;
|FPRC;

|DEFBUCLE RecuentaArt;
#belw0001#1;
;
#belm0023#3,#belm0023#4,"      ";
#belm0023#3,#belm0023#4,"zzzzzz";
;
NULL,RecuentaArt;
|FIN;

|PROCESO LinPedAlb; |TIPO 0;
     nModo = (FEntrada / 100) ! 0;

     |SI #belm0021#2 ! "M";
          aSerie = #belm0021#4;
          nNumero = #belm0021#3;
          aNumero = ("000000" + nNumero) % -106;
          |SI #belm0021#2 = "P";   ||Pedido
               |ABRE #agifa073;
               #agifa073#28 = aSerie;
               #agifa073#0 = nNumero;
               #agifa073#1 = #belm0023#3;
               |LEE 000#agifa073.=;
               |SI FSalida ! 0;
                    aMensaje = "0000Error: Esta linea no existe en el Pedido [" + aSerie + "/" + aNumero + "]";
                    |MENAV aMensaje;
                    |ERROR;
               |SINO;
                    #belm0023#4 = #agifa073#2;
/*
                    |SI #belm0023#5 = "S";
                       CantMax = 0; |BUCLE RecuentaArt;
                       Comodin = CantMax;
                    |SINO;
                       Comodin = #agifa073#5
                    |FINSI;
*/
                   |ABRE #belw0001;
                   #belw0001#0 = #belm0023#3;
                   #belw0001#1 = #belm0023#4;
                   #belw0001#2 = "      ";
                   |LEE 000#belw0001.=;
                   |SI FSalida ! 0; |DDEFECTO #belw0001; |FINSI;
                   |CIERRA #belw0001;
                   Comodin = #belw0001#3;

               |FINSI;
               |CIERRA #agifa073;
          |SINO;
               |ABRE #agifa071;
               #agifa071#29 = aSerie;
               #agifa071#0  = nNumero;
               #agifa071#1  = #belm0023#3;
               |LEE 000#agifa071.=;
               |SI FSalida ! 0;
                    aMensaje = "0000Error: Esta linea no existe en el Albaran [" + aSerie + "/" + aNumero + "]";
                    |MENAV aMensaje;
                    |ERROR;
               |SINO;
                    #belm0023#4 = #agifa071#2;
/*
                    |SI #belm0023#5 = "S";
                       CantMax = 0; |BUCLE RecuentaArt;
                       Comodin = CantMax;
                    |SINO;
                       Comodin = #agifa071#5
                    |FINSI;
*/
                   |ABRE #belw0001;
                   #belw0001#0 = #belm0023#3;
                   #belw0001#1 = #belm0023#4;
                   #belw0001#2 = "      ";
                   |LEE 000#belw0001.=;
                   |SI FSalida ! 0; |DDEFECTO #belw0001; |FINSI;
                   |CIERRA #belw0001;
                   Comodin = #belw0001#3;

               |FINSI;
               |CIERRA #agifa071;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO NumUnits;
   |SI #belm0023#5 = "S";
      CantMax = 0;
      |BUCLE RecuentaArt;
   |SINO;
      |SI #belm0021#2 = "A";
         CantMax = #agifa071#5;
      |SINO;
         CantMax = #agifa073#5;
      |FINSI;
   |FINSI;

   |SI #belm0023#6 > CantMax;
      Comodin = "    Dispone de un maximo de " + CantMax + " unidades";
   |FINSI;
|FPRC;

|PROCESO Tipo13; |TIPO 13;
   |SI #belm0021#2 ! "M";
      |SI #belm0023#5 = "S";
         CantMax = 0;
         |BUCLE RecuentaArt;
         |ENTCOLUMNA #1#belm0024, -4, 7, 6, 2, minQuinto, maxQuinto;
      |SINO;
         |PINPA #0#belm0024;
         |ABRE #belw0001;
         #belw0001#0 = #belm0023#3;
         #belw0001#1 = #belm0023#4;
         #belw0001#2 = "      ";
         |LEE 000#belw0001.=;
         |SI FSalida = 0;
            CantMax = #belw0001#3;
         |FINSI;
         |CIERRA #belw0001;
      |FINSI;
   |FINSI;

   |ABRE #agifa019;
   #agifa019#0 = #belm0023#4;
   |LEE 000#agifa019.=;
   |SI FSalida = 0;
        aNomArt = " " + #agifa019#1;
        Comodin = CantMax + "       ";
   |SINO;
        aNomArt = ""; Comodin = "";
   |FINSI;
   |PINTA 0650, aNomArt;
   |SI #belm0021#2 ! "M";
        |PINTA 0760, Comodin;
   |FINSI;
   |CIERRA #agifa019;
|FPRC;

|PROCESO CreaLineas0;
     #belm0022@#0 = #0#0;
     #belm0022@#1 = 999999;
     |LEE 000#belm0022@.];
     |SI FSalida = 0;
          |LEE 000#belm0022@.a;
     |SINO;
          |LEE 000#belm0022@.u;
     |FINSI;
     |SI FSalida = 0; |Y #belm0022@#0 = #0#0;
          nLin = #belm0022@#1 + 1;
     |SINO;
          nLin = 1;
     |FINSI;

     |DDEFECTO #2;
     #2#0 = #0#0;
     #2#1 = nLin;
     |PARA i = 2; |SI i [ 6; |HACIENDO i = i + 1;
          #2i = #91i;
     |SIGUE;
     #2#7 = #91#13;  ||Unidades
     |GRABA 020#2n;

     |DDEFECTO #3;
     #3#0 = #2#0;
     #3#1 = #2#1;
     #3#2 = 1;
     #3#3 = #91#9;
     #3#4 = #91#10;
     #3#5 = "";
     #3#6 = #91#13;
     |GRABA 020#3n;
|FPRC;

|PROCESO CreaLineas;
     |PARA j = 1; |SI j [ #91#12; |HACIENDO j = j + 1;
          |HAZ CreaLineas0;
          |SI #0#23 = "A"; ||Volumen
               #0#15 = #0#15 + #91#4;
          |FINSI;
          |SI #0#24 = "A"; ||Bruto
               #0#16 = #0#16 + #91#5;
          |FINSI;
          |SI #0#25 = "A"; ||Neto
               #0#17 = #0#17 + #91#6;
          |FINSI;
     |SIGUE;
|FPRC;

|DEFBUCLE CreaLineas;
     #91#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, CreaLineas;
|FIN;

|PROCESO Min91;
     #91#8 = 1;
|FPRC;

|PROCESO Max91;
     #91#8 = 999;
|FPRC;

|PROCESO Desglose;
     aAlfa = Usuario;
     |QBF aAlfa;
     |NOME_DAT #91 aAlfa;
     |DELINDEX #91;
     |PUSHV 0501 2380;
     |ENTLINEAL #1#91, 1, 1, 22, 1, Min91, Max91;
     |POPV;
     nLin = 0;
     |DDEF aDef;
     aDef = aDef + "belm0022";
     |CARGA_DEF aDef, belm0022@;
     |SI FSalida = 0;
          |ABRE #belm0022@;
          |ABRE #3;
          |BUCLE CreaLineas;
          |CIERRA #3;
          |CIERRA #belm0022@;
          |DESCARGA_DEF #belm0022@;
          |PINTA #0#15;
          |PINTA #0#16;
          |PINTA #0#17;
     |FINSI;
     |DELINDEX #91;
     |SI nLin =  0;
          |ERROR;
     |SINO;
          |PONCONTROL 23, "SI";
          |PTEC 802;
     |FINSI;
|FPRC;

|PROCESO TotalUni; |TIPO 0;
     #91#7 = #91#12 * #91#13;
     |PINTA #91#7;
|FPRC;

|PROCESO LinPedAlb2; |TIPO 0;
     nModo = (FEntrada / 100) ! 0;

     aSerie = #belm0021#4;
     nNumero = #belm0021#3;
     aNumero = ("000000" + nNumero) % -106;
     |SI #belm0021#2 = "P";   ||Pedido
          |ABRE #agifa073;
          #agifa073#28 = aSerie;
          #agifa073#0 = nNumero;
          #agifa073#1 = #91#9;
          |LEE 000#agifa073.=;
          |SI FSalida ! 0;
               aMensaje = "0000Error: Esta linea no existe en el Pedido [" + aSerie + "/" + aNumero + "]";
               |MENAV aMensaje;
               |ERROR; |ACABA;
          |SINO;
               #91#10 = #agifa073#2;
               #91#11 = #agifa073#3;
          |FINSI;
          |CIERRA #agifa073;
     |SINO;
          |ABRE #agifa071;
          #agifa071#29 = aSerie;
          #agifa071#0  = nNumero;
          #agifa071#1  = #91#9;
          |LEE 000#agifa071.=;
          |SI FSalida ! 0;
               aMensaje = "0000Error: Esta linea no existe en el Albaran [" + aSerie + "/" + aNumero + "]";
               |MENAV aMensaje;
               |ERROR; |ACABA;
          |SINO;
               #91#10 = #agifa071#2;
               #91#11 = #agifa071#4;
          |FINSI;
          |CIERRA #agifa071;
     |FINSI;
     |SI #91Campo ! Contenido; |O nModo = 1;
          |ABRE #19;
          #19#0 = #91#10;
          |LEE 000#19=;
          |CIERRA #19;
          #91#13 = #19#4;
     |FINSI;
     |PINTA #91#11;
     |PINTA #91#10;
     |PINTA #91#13;

     |HAZ EsMalpesa;
     |SI FSalida = 0;
          |HAZ MalpeDefecto;
     |FINSI;
|FPRC;

|PROCESO MalpeDefecto;
     |DDEF aDef;
     |SI #0#2 = "A";
          aAlfa = aDef + "malpe091";
     |SINO;
          aAlfa = aDef + "malpe088";
     |FINSI;
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          |DDEFECTO #referen@;
          |SI #0#2 = "A";
               #referen@#29 = aSerie;
               #referen@#0 = nNumero;
               #referen@#1 = #91#9;
               |LEE 000#referen@.=;
               nPaq = #referen@#62;
               nUni = #referen@#5;
               aPar = #referen@#49;
               aArt = #referen@#2;
               nAlm = #referen@#3;
          |SINO;
               #referen@#28 = aSerie;
               #referen@#0 = nNumero;
               #referen@#1 = #91#9;
               |LEE 000#referen@.=;
               nPaq = #referen@#57;
               nUni = #referen@#5;
               aPar = #referen@#45;
               aArt = #referen@#2;
               nAlm = #referen@#3;
          |FINSI;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;

          aAlfa = aDef + "malpe085";
          |CARGA_DEF aAlfa, referen@;
          |SI FSalida = 0;
               |ABRE #referen@;
               #referen@#0 = aArt;
               #referen@#1 = nAlm;
               #referen@#2 = aPar;
               |LEE 000#referen@.=;
               |SI FSalida = 0;
                    #91#12 = nPaq;
                    #91#13 = #referen@#4;
                    #91#5 = #referen@#3 * nUni;
                    #91#6 = #91#5;
                    |PINTA #91#12;
                    |PINTA #91#13;
                    |PINTA #91#5;
                    |PINTA #91#6;
               |FINSI;
               |CIERRA #referen@;
               |DESCARGA_DEF #referen@;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Control2; |TIPO 2;
     nForma = 0 +. 1;
     |SI #91#7 = 0;
          |MENAV "0000Las unidades no pueden ser 0";
          |ERROR; |ACABA;
     |FINSI;
     |ABRE #belw0001;
     #belw0001#0 = #91#9;
     #belw0001#1 = #91#10
     #belw0001#2 = "";
     |LEE 101#belw0001.=;
     |SI FSalida = 0;
          nCantidad = #belw0001#3 -. #91#7;
          |SI nCantidad < 0; |Y nForma = 1;
               aMensaje = "0000Error: Solo quedan por asignar [" + #belw0001#3 + "] unidades";
               |MENAV aMensaje;
               |ERROR;
          |SINO;
               #belw0001#3 = nCantidad;
          |FINSI;
          |GRABA 020#belw0001.a; |LIBERA #belw0001;
     |SINO;
          |SI #belm0021#2 = "P";
               aMensaje = "0000Error: Este articulo no pertenece a la linea [" + #belm0023#3 + "] del Pedido";
          |SINO;
               aMensaje = "0000Error: Este articulo no pertenece a la linea [" + #belm0023#3 + "] del Albaran";
          |FINSI;
          |MENAV aMensaje;
          |ERROR;
     |FINSI;
     |CIERRA #belw0001;
|FPRC;

|PROCESO Contador; |TIPO 7;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 1;
          |LEE 000#0u;
          |SI FSalida = 0;
               nConta = #0#0 + 1;
          |SINO;
               nConta = 1;
          |FINSI;
          |DDEFECTO #0;
          #0#0 = nConta;
     |FINSI;
|FPRC;

|PROCESO Carga;
     |ABRE #belm0023;
     |ABRE #90;
     nHayEleme = 0;
     |SI #belm0021#2 = "P";
          |HAZ TmpPed;
          |BUCLE RestaLineas;
     |SINO;
          |HAZ TmpAlb;
          |BUCLE RestaLineas;
     |FINSI;
     |CIERRA #90;
     |CIERRA #belm0023;
|FPRC;

|PROCESO T5; |TIPO 5;
     nModo = ((FEntrada / 100) ! 0);
     |SI nModo = 1; |O nModo = 2;
          |HAZ CreaTmp;
          |HAZ Carga;
     |FINSI;
|FPRC;

|PROCESO LlenaPdte;
     |SI #90#3 > 0;
          #3#0 = #2#0;
          #3#1 = #2#1;
          #3#2 = 999;
          |LEE 000#3];
          |SI FSalida = 0;
               |LEE 000#3a;
          |SINO;
               |LEE 000#3u;
          |FINSI;
          |SI FSalida = 0; |Y #3#0 = #2#0; |Y #3#1 = #2#1;
               nLin = #3#2 + 1;
          |SINO;
               nLin = 1;
          |FINSI;
          |DDEFECTO #3;
          #3#0 = #2#0;
          #3#1 = #2#1;
          #3#2 = nLin;
          #3#3 = #90#0;
          #3#4 = #90#1;
          #3#5 = "N";
          #3#6 = #90#3;
          |GRABA 020#3n;

          #90#3 = 0;
          |GRABA 020#90a;
     |FINSI;
|FPRC;

|DEFBUCLE LlenaPdte;
     #90#1;
     ;
     #30#0, "                    ", "      ";
     #30#1, "zzzzzzzzzzzzzzzzzzzz", "zzzzzz";
     be;
     NULL, LlenaPdte;
|FIN;

|PROCESO T11; |TIPO 11;
     |SI FSalida = 13;
          |PUSHV 0501 2380;
          |PINPA #0#30;
          |PINDA #0#30;
          |ENDATOS #1#30;
          |SI FSalida = 0;
               |BUCLE LlenaPdte;
          |FINSI;
          |POPV;
          |ERROR;
          |PONCONTROL 23, "SI";
          |PTEC 815;
          |PTEC 814;
     |FINSI;
|FPRC;
