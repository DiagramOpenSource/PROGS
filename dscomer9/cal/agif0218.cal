     || RECALCULO IMPORTES PEDIDO VENTAS

     || USADO POR: agifa218, oca00001, dsz00006

|FICHEROS;
     agifa104 #104;
     agifa073 #73;
     agifa019 #19;
|FIN;

|VARIABLES;
     nImpDiv = 0;
     nPend   = 0;
|FIN;

|PROCESO RecalPedVenta;
     |ABRE #19;
     #19#0 = #73#2;
     |LEE 020#19=;
     |CIERRA #19;

     #73#54 = #73#5 * #19#208;

     |SI #104#37 = "D";                    || Si la moneda de trabajo es la divisa ...
          #73#6 = #73#38 / #104#36 * #104#41;  || ... recalculo precio en funcion de la divisa
          #73#40 = #73#6;                  || ... el campo visualiz. es el precio en moneda base
     |SINO;
          #73#38 = #73#6 / #104#41 * #104#36;  || .. recalculo precio en funcion de la moneda base
          #73#40 = #73#38;                     || ... el campo visual. es el precio en divisa
     |FINSI;

     |SI #19#194 = 2;                     || Unidades de facturacion
          #73#7   = #73#44 * #73#6;
          nImpDiv = #73#44 * #73#38;
          #73#11  = (#73#44 - #73#49) * #73#6;
     |SINO;
          #73#7   = #73#5  * #73#6;
          nImpDiv = #73#5  * #73#38;
          #73#11  = (#73#5 - #73#43) * #73#6;
     |FINSI;

     #73#9  = ((((#73#7 < #73#8) < #73#29) < #104#5) < #104#17) < #104#6;
     #73#39 = ((((nImpDiv < #73#8) < #73#29) < #104#5) < #104#17) < #104#6;
     #73#11 = ((((#73#11 < #73#8) < #73#29) < #104#5) < #104#17) < #104#6;

     |SI #104#37 = "D";     || Si la moneda de trabajo es la divisa ...
          #73#41 = #73#9;   || el campo visualiz. es el importe en moneda base
          #73#40 = #73#6;   || ... el campo visualiz. es el precio en moneda base
     |SINO;                 || Si la moneda de trabajo es la moneda base ...
          #73#41 = #73#39;  || el campo visualiz. es el importe en divisa
          #73#40 = #73#38;  || ... el campo visual. es el precio en divisa
     |FINSI;

||컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
     #104#11 = #104#11 + #73#9;      || Total
     #104#12 = #104#12 + #73#11;     || por ser
     #104#13 = #104#11 - #104#12;    || servido

     |SI #19#194 = 2;
         nPend = (#73#44 - #73#43) * #73#38;
     |SINO;
         nPend = (#73#5 - #73#43)  * #73#38;
     |FINSI;
     nPend = ((((nPend < #73#8) < #73#29) < #104#5) < #104#17) < #104#6;

     #104#42 = #104#42 + #73#39;     ||Div importe total
     #104#43 = #104#43 + nPend;      ||Div imp por servir
     #104#44 = #104#42 - #104#43;    ||Div imp servido
     #104#63 = #104#63 + #73#54;

     |SI #104#37 = "D";
          #104#45 = #104#42;
          #104#46 = #104#43;
          #104#47 = #104#44;
          #104#48 = #104#11;
          #104#49 = #104#12;
          #104#50 = #104#13;
     |SINO;
          #104#45 = #104#11;
          #104#46 = #104#12;
          #104#47 = #104#13;
          #104#48 = #104#42;
          #104#49 = #104#43;
          #104#50 = #104#44;
     |FINSI;
     |GRABA 020#73a;
     |GRABA 020#104a;
|FPRC;

|PROCESO AceraPedVenta;
     #104#11 = 0;
     #104#12 = 0;
     #104#13 = 0;
     #104#42 = 0;
     #104#43 = 0;
     #104#44 = 0;
     #104#63 = 0;
|FPRC;
