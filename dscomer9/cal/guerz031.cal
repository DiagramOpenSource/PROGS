|FICHEROS;
     guerz031 #0;
     gopartca #4;
     gopartll #1;
     gopartli #2;
     goptrbca #5;
     goptrbli #3;
     gocatcon #6;
     gotrabaj #7;
     gocatcot #8;
     gopartia #10;
     agifa019 #19;
     goparame #100;
|FIN;

|VARIABLES;
     nArti = 0;
     nExpe = 0;
     &cCodMonTrab = "";
     &nEurComBase = 0;
     &nEurComTrab = 0;
     nEuros = 0;
     nModi = 0;
     nRecal = 0;
     cTipo = "";
     aAlfa = "";
|FIN;

|PROCESO gocatcon;
     #19#0 = #6#13;
     |LEE 101#19=;
     |SI FSalida = 0;
          nArti = nArti + 1;
          #19#28 = #6#4;
          #19#133 = #6#4;
          |GRABA 020#19a;
          |LIBERA #19;
     |FINSI;
|FPRC;

|DEFBUCLE gocatcon;
     #6#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, gocatcon;
|FIN;

|PROCESO gopartia;
     #10#37 = #3#12;
     #10#38 = 0;
     #10#39 = 0;
     #10#40 = 0;
     #10#41 = #3#13;
     #10#42 = 0;
     #10#43 = 0;
     #10#44 = 0;
     |HAZ CalcuGopartia;
     |GRABA 020#10a;
     |LIBERA #10;
|FPRC;

|DEFBUCLE gopartia;
     #10#1;
     ;
     "T", #5#15, #5#3, #3#3, 1;
     "T", #5#15, #5#3, #3#3, 999;
     be;
     NULL, gopartia;
|FIN;

|PROCESO ConvPart;
     nEuros = #3#14 / nEurComBase;                ||Cant. Euros Venta Base Hora.
     #1#12 = nEuros * nEurComTrab;                ||Importe Venta Trabajo Hora.
     nEuros = #3#15 / nEurComBase;                ||Cant. Euros Costo Base Hora.
     #3#13 = nEuros * nEurComTrab;                ||Importe Costo Trabajo Hora.
|FPRC;

|PROCESO TotalLin;
     |SI #5#20 = "P";#3#8  = #3#11;|FINSI;
     |SI #5#20 = "A";#3#9  = #3#11;|FINSI;
     |SI #5#20 = "E";#3#10 = #3#11;|FINSI;

     #3#16 = #3#11*#3#12;                         ||Total Trabajador Venta Mon Trab.
     #3#17 = #3#11*#3#13;                         ||Total Trabajador Costo Mon Trab.
     #3#18 = #3#11*#3#14;                         ||Total Trabajador Venta Mon Base.
     #3#19 = #3#11*#3#15;                         ||Total Trabajador Venta Mon Base.
|FPRC;

|PROCESO goptrbli;
     |DDEFECTO #7;
     #7#0 = #3#4;
     |LEE 000#7=;


     |DDEFECTO #6;
     #6#0 = #7#3;
     #6#1 = #7#2;
     |LEE 000#6=;

     #3#6 = #7#3;  ||Categoria
     #3#7 = #7#25; ||Descripcion
     #3#22 = #6#13;||Articulo

     cTipo = #1#14;
     #5#20 = cTipo;

     |DDEFECTO #8;
     #8#0 = #7#3;
     #8#1 = #7#2;
     #8#2 = #3#26;
     |LEE 000#8=;
     |SI FSalida = 0;
          |SI cTipo = "P";
               #3#14 = #8#4;                 ||Importe Hora Venta Base.
               #3#15 = #8#5;                 ||Importe Hora Costo Base.
          |FINSI;
          |SI cTipo = "A";
               #3#14 = #8#6;                 ||Importe Hora Venta Base.
               #3#15 = #8#7;                 ||Importe Hora Costo Base.
          |FINSI;
          |SI cTipo = "E";
               #3#14 = #8#8;                 ||Importe Hora Venta Base.
               #3#15 = #8#9;                 ||Importe Hora Costo Base.
          |FINSI;
     |SINO;
          |SI cTipo = "P";
               #3#14 = #6#3;                 ||Importe Hora Venta Base.
               #3#15 = #6#4;                 ||Importe Hora Costo Base.
          |FINSI;
          |SI cTipo = "A";
               #3#14 = #6#7;                 ||Importe Hora Venta Base.
               #3#15 = #6#9;                 ||Importe Hora Costo Base.
          |FINSI;
          |SI cTipo = "E";
               #3#14 = #6#8;                 ||Importe Hora Venta Base.
               #3#15 = #6#10;                ||Importe Hora Costo Base.
          |FINSI;
     |FINSI;
     |HAZ ConvPart;
     |HAZ TotalLin;

     |GRABA 020#3a;
     |LIBERA #3;


     nModi = 1;
     |SI nRecal = 1;
          |BUCLE gopartia;

          #5#10 = #5#10 + #3#17;
          #5#11 = #5#11 + #3#16;
          #5#12 = #5#12 + #3#19;
          #5#13 = #5#13 + #3#18;

          #2#9 = #5#10;
          #2#10 = #5#11;
          #2#11 = #5#12;
          #2#12 = #5#13;
     |FINSI;
|FPRC;

|DEFBUCLE goptrbli;
     #3#1;
     ;
     #2#0, #2#1, #2#3, 0001;
     #2#0, #2#1, #2#3, 9999;
     be;
     NULL, goptrbli;
|FIN;

|PROCESO gopartli;

     #5#0 = #2#14; ||Serie
     #5#1 = #2#15; ||Expe
     #5#2 = #2#3; ||F.Parte
     #5#16 = #2#0; ||Serie
     #5#17 = #2#1; ||Pres
     |LEE 101#5=;
     |SI FSalida = 0;
          |SI nRecal = 1;
               #2#9 = 0;
               #2#10 = 0;
               #2#11 = 0;
               #2#12 = 0;
               #5#10 = 0;
               #5#11 = 0;
               #5#12 = 0;
               #5#13 = 0;
          |FINSI;
          |BUCLE goptrbli;
          |SI nRecal = 1;
               #1#9 = #1#9 + #5#10;
               #1#10 = #1#10 + #5#11;
               #1#11 = #1#11 + #5#12;
               #1#12 = #1#12 + #5#13;
               |GRABA 020#2a;
               |GRABA 020#5a;
          |FINSI;
          |LIBERA #5;
     |FINSI;
     |LIBERA #2;
|FPRC;

|DEFBUCLE gopartli;
     #2#1;
     3;
     #1#4, #1#5, 0001, #0#4;
     #1#4, #1#5, 9999, #0#5;
     be;
     NULL, gopartli;
|FIN;

|PROCESO gopartll;
     |SI nRecal = 1;
          #1#9 = 0;
          #1#10 = 0;
          #1#11 = 0;
          #1#12 = 0;
     |FINSI;
     |BUCLE gopartli;
     |SI nRecal = 1;
          #4#6 = #4#6 + #1#9;
          #4#7 = #4#7 + #1#10;
          #4#8 = #4#8 + #1#11;
          #4#9 = #4#9 + #1#12;
          |GRABA 020#1a;
     |FINSI;
     |LIBERA #1;
|FPRC;

|PROCESO gopartca;
     |SI nModi ! 0;
          nRecal = 1;
          #4#6 = 0;
          #4#7 = 0;
          #4#8 = 0;
          #4#9 = 0;
          |BUCLELIN 0 gopartll #4;
          |GRABA 020#4a;
          nExpe = nExpe + 1;
     |FINSI;
     nModi = 0; nRecal = 0;
     |LIBERA #4;
|FPRC;

|PROCESO gopartca0;
     cCodMonTrab = #4#11;
     |HAZ MonBas
|FPRC;

|DEFBUCLE gopartca;
     #4#1;
     ;
     #0#0, #0#2;
     #0#1, #0#3;
     be;
     NULL, gopartca0, gopartll, gopartca;
|FIN;

|PROCESO Tipo3; |TIPO 3;
     |ABRE #6;
     |ABRE #7;
     |ABRE #8;
     |ABRE #5;
     |BUCLE gopartca;
     |CIERRA #5;
     |CIERRA #8;
     |CIERRA #7;
     |CIERRA #6;

     |ABRE #19;
     |BUCLE gocatcon;
     |CIERRA #19;
     aAlfa = "0000Modificados: " + nExpe + " Expedientes y " + nArti + " articulos";
     |MENAV aAlfa;
|FPRC;

|PROCESO Tipo13; |TIPO 13;
     |ABRE #100; |LEE 000#100p; |CIERRA #100;
     |SI #100#141 = "O";
          |ATRI R; |PINTA 1221, " O.T.        "; |ATRI 0;
     |FINSI;
|FPRC;
