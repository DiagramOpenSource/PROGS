|FICHEROS;
     malpe105 #0;
     malpe087 #1;
     malpe088 #2;
     agifa024 #3;
     agifa038 #13;
     agifa048 #15;
     agifa049 #16;
     agifa007 #40;
     agifa142 #41;
     dsm00010 #910;
     dsm00053 #53;
     dsm00046 #46;
|FIN;

|VARIABLES;
     aDRei        = "";
     aHRei        = "";
     &eaCli       = "";
     &enTiva      = 0;
     &enIva       = 0;
     &enRec       = 0;
     &efFiva = @;

     &aMoneda     = "";
     &aDivisa     = "";
     &enEscan     = 0;
     &enImpo      = 0;
     &enSwImpre   = 0;
     &aParam      = "";
     &eaTipo      = "";
     &eaSerie     = "";
     &enCodig     = 0;
     &enLinea     = 0;
     &eaArticulo  = "";
     &eaNArticulo = "";
     &enUnidades  = 0;
     &enPrecio    = 0;
     &enDto1      = 0;
     &enDto2      = 0;
     &enPantalla  = 0;
     &efFEntrega  = @;

     indtope = 0;
     ind = 0;
     n_copia  = 0;
     informe   = "";
     &informe1 = "";
     &cant = 0;
     &tolin = 0;
     &iva1 = 0;
     &iva2 = 0;
     &iva3 = 0;
     &iva4 = 0;
     &iva5 = 0;
     &re1 = 0;
     &re2 = 0;
     &re3 = 0;
     &re4 = 0;
     &re5 = 0;
     &descrip="";
     &linea=0;
     vacio="";
     &bl  = "                              ";
     &ser_ped  = "";
     &num_ped  = 0;
     &unid     = 0;
     &codigo   = "";
     &descri   = "";
     &dto      = 0;
     &precio   = 0;
     &imptot   = 0;
     &tiva     = 0;

     &enSwLin  = 0;
|FIN;

||INC-LUYE llena_c1;

|PROCESO escanlinea;
     unid    = #16#4 * #2#5;
     descrip = #16#3;
     linea   = 1;
     |PRINT;
|FPRC;

|PROCESO xx;
     indtope=0
     |PARA ind=6;|SI ind>0;|HACIENDO ind=ind-1;
           descrip = #13ind;  |QBF descrip;
           |SI descrip ! vacio;
               indtope = ind + 1;
               ind     = 0;
           |FINSI;
     |SIGUE;

     |PARA ind = 1; |SI ind <i ndtope; |HACIENDO ind = ind + 1;
           descrip = #13ind;
           linea   = 0;
           |PRINT;
     |SIGUE;
|FPRC;

|PROCESO impdesam;|TIPO 0;
     |ABRE #13;
     #13#0=#2#27;
     |LEE 121#13=;
     |SI FSalida = 0;  |HAZ xx;  |FINSI;
     |LIBERA #13;
     |CIERRA #13;
|FPRC;

|PROCESO DesAmpli;
     |DDEFECTO #2;
     #2#3 = 0;      || Almacen
     #2#4 = #53#5;
     descrip = #2#4;
     |PRINT;
|FPRC;

|DEFBUCLE DesAmpli;
     #53#1;
     ;
     "P", #2#28, #2#0, #2#1, 0001;
     "P", #2#28, #2#0, #2#1, 9999;
     ;
     NULL, DesAmpli;
|FIN;

|PROCESO dsm00046;
     unid = #2#5 * #46#5;
     |PRINT;
|FPRC;

|DEFBUCLE dsm00046;
     #46#1;
     ;
     #2#28, #2#0, #2#1, 001;
     #2#28, #2#0, #2#1, 999;
     ;
     NULL, dsm00046;
|FIN;

|PROCESO ImpreNormal;
     tolin   = #2#5 * #2#6;
     tolin   = tolin < #2#8;
     cant    = cant + tolin;
     descrip = #2#4;
     linea   = 1;
     unid    = #2#5;
     codigo  = #2#2;

     |PRINT;

     |SALVA_DATOS #2;
     |BUCLE DesAmpli;
     |REPON_DATOS #2;

     |HAZ impdesam;
     |SI #41#16 = "S";
          |ABRE #15;
          #15#0 = #2#2;
          |LEE 040#15=;
          |SI FSalida = 0;
               |SI #41#12 = "K";
                    enEscan = 2;
                    |BUCLE dsm00046;
               |SINO;
                    enEscan = 1;
                    |BUCLELIN 0escanlinea#15;
               |FINSI;
               enEscan = 0;
          |FINSI;
          |CIERRA #15;
     |FINSI;
|FPRC;

|PROCESO pedimprl;|TIPO 0;
     |SI #2#13 < #0#9;  |O #2#13 > #0#10;  |ACABA;  |FINSI;

     |HAZ ImpreNormal;
|FPRC;

|PROCESO IVAS;
     eaCli = #1#4;
     efFiva = #1#1;
     enTiva = 1; |HAZ IVACli; iva1 = enIva; re1 = enRec;
     enTiva = 2; |HAZ IVACli; iva1 = enIva; re1 = enRec;
     enTiva = 3; |HAZ IVACli; iva1 = enIva; re1 = enRec;
     enTiva = 4; |HAZ IVACli; iva1 = enIva; re1 = enRec;
     enTiva = 5; |HAZ IVACli; iva1 = enIva; re1 = enRec;
|FPRC;

|PROCESO pedimpr1;
     |HAZ IVAS;

     aMoneda = #malpe087#37;
     aDivisa = #malpe087#35;
     |HAZ Divisas104;

     |SI #3#0 ! #1#4;
         #3#0 = #1#4;
         |LEE 040#3=;
         |SI FSalida ! 0;  |DDEFECTO #3;  |FINSI;
     |FINSI;

     |ABRE #40;
     #40#26 = #1#25;
     |LEE 001#40=;
     |SI FSalida ! 0;  |DDEFECTO #40;  |FINSI;
     |CIERRA #40;

     informe = #40#0; |QBF informe;
     informe1 = (informe % 0104) + "5" + (informe % 0603); |QBF informe1;

     |SI aParam ! "";
          |INFOR aParam;
     |SINO;
          |INFOR informe;
     |FINSI;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |PARA n_copia = 0; |SI n_copia [ #3#188; |HACIENDO n_copia = n_copia + 1;
          |BUCLELIN 2pedimprl#1;
          |PIEINF;
          enSwImpre = 0;
          cant = 0;
          tolin = 0;
     |SIGUE;
     |FININF;
     #1#58 = "S";
     |GRABA 020#1a;
|FPRC;

|DEFBUCLE malpe087e1;
     #1#1;
     58;
     #0#6 , #0#2,aDRei;
     #0#7 , #0#3,aHRei;
     e;
     NULL, pedimpr1;
|FIN;

|DEFBUCLE malpe087e2;
     #1#1;
     4, 1,58;
     #0#6 , #0#2 , #0#0 , #0#4,aDRei;
     #0#7 , #0#3 , #0#1 , #0#5,aHRei;
     e;
     NULL, pedimpr1;
|FIN;

|DEFBUCLE malpe087e3;
     #1#2;
     25, 0, 1,58;
     #0#0 , "     ",      0, #0#6 , #0#2 , #0#4,aDRei;
     #0#1 , "zzzzz", 999999, #0#7 , #0#3 , #0#5,aHRei;
     be;
     NULL, pedimpr1;
|FIN;

|PROCESO Tipo3;
     |SI #0#11 = "S";
          aDRei = " ";
          aHRei = "z";
     |SINO;
          aDRei = "N";
          aHRei = "N";
     |FINSI;
     |IMPRE 1;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |ABRE #3;
     |SI ser_ped = ""; |Y num_ped = 0;
         |SI #0#8 = "C";
             |BUCLE malpe087e3;
         |SINO;
             |BUCLE malpe087e1;
         |FINSI;
     |SINO;
         |BUCLE malpe087e2;
     |FINSI;
     |CIERRA #3;

     |FINIMP;
|FPRC;

|PROGRAMA;
     aParam = PARAMETRO; |QBF aParam;
     enPantalla  = 0;

     |ABRE #41; |LEE 000#41p; |CIERRA #41;
     |ABRE #910; |LEE 000#910p; |CIERRA #910;

     |SI ser_ped = ""; |Y num_ped = 0;
         |CLS;
         |CABEZA "Imp.Pedidos";
         |DDEFECTO #0;
         |PINPA #0#0;
         |PINDA #0#0;
         |ENDATOS #1#0;
         |SI FSalida = 0;  |HAZ Tipo3;  |FINSI;
     |SINO;
         #0#6 = ser_ped;
         #0#7 = ser_ped;
         #0#2 = num_ped;
         #0#3 = num_ped;
         #0#4 = "01.01.0000";
         #0#5 = "31.12.9999";
         #0#9 = "01.01.0000";
         #0#10 = "31.12.9999";
         #0#11 = "S";
         |HAZ Tipo3;
     |FINSI;
|FPRO;
