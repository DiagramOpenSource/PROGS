|FICHEROS;
     dszrec06;
     agifa079;
     agifa072;
     agifa077;
     agifa080;
     agifa007;
     agifa142;
     agifa112;
     agifa019;
     dsm00279;
     referen@;
|FIN;

|VARIABLES;
     aSiNi = "";
     nSwBolilla = 0;
     nImpoDto = 0;
     nImpoDtoD = 0;
     &nDeci_IVAC = 0;
     &nDeci_IVACDiv = 0;
     nBrutoMoneda1 = 0;
     nBrutoMoneda2 = 0;
     nImporDescue1 = 0;
     nImporDescue2 = 0;
     nImporDescue3 = 0;
     nImporMoneda1 = 0;
     nImporMoneda2 = 0;
     nDescuMoneda1 = 0;
     nDescuMoneda2 = 0;

     aDef = "";
     nPVerde = 0;
     nTotPVerde = 0;
     nDtoDiv     = 0;
     nError      = 0;
     nTotaRete   = 0;
     nTotaReteD  = 0;
     nIva1       = 0;
     nIva2       = 0;
     nIva3       = 0;
     nIva4       = 0;
     nIva5       = 0;
     nRe1        = 0;
     nRe2        = 0;
     nRe3        = 0;
     nRe4        = 0;
     nRe5        = 0;
     nBruto      = 0;
     nBase0      = 0;
     nBase1      = 0;
     nBase2      = 0;
     nBase3      = 0;
     nBase4      = 0;
     nBase5      = 0;
     nBrutoD     = 0;
     nBase1D     = 0;
     nBase0D     = 0;
     nBase2D     = 0;
     nBase3D     = 0;
     nBase4D     = 0;
     nBase5D     = 0;
     nP0         = 0;
     nP1         = 0;
     nP2         = 0;
     nP3         = 0;
     nP4         = 0;
     nP5         = 0;
     nP0D        = 0;
     nP1D        = 0;
     nP2D        = 0;
     nP3D        = 0;
     nP4D        = 0;
     nP5D        = 0;
     nTP         = 0;
     nTPD        = 0;
     nTV         = 0;
     nTVD        = 0;
     nBr         = 0;
     nB1         = 0;
     nB2         = 0;
     nB3         = 0;
     nB4         = 0;
     nB5         = 0;
     nB0         = 0;
     nBrD        = 0;
     nB1D        = 0;
     nB2D        = 0;
     nB3D        = 0;
     nB4D        = 0;
     nB5D        = 0;
     nB0D        = 0;
     nAbono      = 0;
     nCampo      = 0;
     nBaseRetenci = 0;

     aAlfa1      = "";

     &nDeci_DivF = 0;
     &nDeci_Div  = 0;
     &nDeci_TotNoVis = 0;

     &eaPrv        = "";
     &enTiva       = 0;
     &enIva        = 0;
     &enRec        = 0;
     &efFiva = @;

     nPPort1 = 0;
     nPPort2 = 0;
     nSwAlba = 0;
     nSwBsegui = 0;
|FIN;

|PROCESO SumVerdeBase7; ||Modulo Bsegui
     |HAZ EsAlbadis; nSwAlba = FSalida;
     |HAZ EsBsegui; nSwBsegui = FSalida;
     |HAZ EsBolillas; nSwBolilla = FSalida;

     |SI nSwAlba ! 0; |Y nSwBsegui ! 0; |Y nSwBolilla ! 0;
               |Y #agifa142#177 ! "S";
          |ACABA;
     |FINSI;

     nPVerde = #agifa080#44;
     nTotPVerde = nTotPVerde + nPVerde;
     |SI #agifa080#11 = 0;
         nBase0  = nBase0  + nPVerde;
         nBase0D = nBase0D + nPVerde;
     |FINSI;

     |SI #agifa080#11 = 1;
         nBase1  = nBase1  + nPVerde;
         nBase1D = nBase1D + nPVerde;
     |FINSI;

     |SI #agifa080#11 = 2;
         nBase2  = nBase2  + nPVerde;
         nBase2D = nBase2D + nPVerde;
     |FINSI;

     |SI #agifa080#11 = 3;
         nBase3  = nBase3  + nPVerde;
         nBase3D = nBase3D + nPVerde;
     |FINSI;

     |SI #agifa080#11 = 4;
         nBase4  = nBase4  + nPVerde;
         nBase4D = nBase4D + nPVerde;
     |FINSI;

     |SI #agifa080#11 = 5;
         nBase5  = nBase5  + nPVerde;
         nBase5D = nBase5D + nPVerde;
     |FINSI;
|FPRC;

|PROCESO CargaLineasFac07;
     #agifa072#3  = #agifa077#15 * nAbono;         ||bruto linea
     #agifa072#4  = #agifa077#25 * nAbono;         ||Total dtos linea
     #agifa072#5  = #agifa077#11 * nAbono;         ||total portes linea
     #agifa072#6  = #agifa077#13 * nAbono;         ||total varios linea
     #agifa072#7  = #agifa077#16 * nAbono;         ||Base 1 linea
     #agifa072#8  = #agifa077#19 * nAbono;         ||Base 2 linea
     #agifa072#9  = #agifa077#22 * nAbono;         ||Base 3 linea
     #agifa072#10 = #agifa077#24 * nAbono;         ||Total linea iva
     #agifa072#14 = #agifa077#44 * nAbono;         ||Base 4 linea
     #agifa072#15 = #agifa077#47 * nAbono;         ||Base 5 linea

     #agifa072#13 = #agifa072#7  + #agifa072#8 + #agifa072#9 + #agifa072#14 + #agifa072#15;
/*
     #agifa072#11 = #agifa072#3  + #agifa072#10;
     #agifa072#11 = #agifa072#11 - #agifa072#4;
     #agifa072#11 = #agifa072#11 + #agifa072#5;
     #agifa072#11 = #agifa072#11 + #agifa072#6;
     #agifa072#11 = #agifa072#11 - (#agifa077#53 * nAbono);
*/
     #agifa072#11 =  #agifa077#68  * nAbono;

    ||Calculo los campos en divisa

     #agifa072#21 = #agifa077#63 * nAbono;         || Bruto linea
     #agifa072#22 = #dszrec06#17 * nAbono;         || Total dtos linea
     #agifa072#23 = #agifa077#69 * nAbono;         || Total portes linea
     #agifa072#24 = #agifa077#70 * nAbono;         || Total varios linea
     #agifa072#25 = #dszrec06#16 * nAbono;         || Total IVA
     #agifa072#26 = #agifa077#64 * nAbono;         || Total Albaran

     |SI #agifa072#20 = "B"; ||Si la moneda de trabajo es la moneda base ...
                      || Asigno los campos en mon. base a los campos visual.
         #agifa072#27 = #agifa072#3;
         #agifa072#28 = #agifa072#4;
         #agifa072#29 = #agifa072#5;
         #agifa072#30 = #agifa072#13;
         #agifa072#31 = #agifa072#10;
         #agifa072#32 = #agifa072#11;
         #agifa072#33 = #agifa072#21;
         #agifa072#34 = #agifa072#22;
         #agifa072#35 = #agifa072#23;
         #agifa072#36 = #agifa072#24;
         #agifa072#37 = #agifa072#25;
         #agifa072#38 = #agifa072#26;
     |SINO;  || Si la moneda de trabajo es la divisa ...
             || Asigno los campos de divisa a los campos visual.
         #agifa072#27 = #agifa072#21;
         #agifa072#28 = #agifa072#22;
         #agifa072#29 = #agifa072#23;
         #agifa072#30 = #agifa072#24;
         #agifa072#31 = #agifa072#25;
         #agifa072#32 = #agifa072#26;
         #agifa072#33 = #agifa072#3;
         #agifa072#34 = #agifa072#4;
         #agifa072#35 = #agifa072#5;
         #agifa072#36 = #agifa072#13;
         #agifa072#37 = #agifa072#10;
         #agifa072#38 = #agifa072#11;
     |FINSI;
|FPRC;

|PROCESO CalLinAgifa079;
     nTotPVerde = 0;
     nDeci_Div  = nDeci_DivF;
     nDeci_TotNoVis = nDeci_Div;
     |HAZ LimCabAgifa077;
     |BUCLELIN 2 CalCabAgifa077 #agifa077;

     |SI #agifa077#42 = "S";
         nAbono = -1;
     |SINO;
         nAbono = 1;
     |FINSI;

     |HAZ CargaLineasFac07;
|FPRC;

|PROCESO SacaIvaAgifa079;
     eaPrv  = #agifa079#2;

     |ABRE #agifa007;
     #agifa007#26 = #agifa079#66;  ||SERIE.
     |LEE 020#agifa007.=;
     |CIERRA #agifa007;
     aSiNi = #agifa007#30;
     |SI #agifa007#30 ! "S";
          efFiva = #agifa079#1;
          enTiva = 1; |HAZ IVAPrv; #agifa079#56 = enIva; #agifa079#57 = enRec;
          enTiva = 2; |HAZ IVAPrv; #agifa079#58 = enIva; #agifa079#59 = enRec;
          enTiva = 3; |HAZ IVAPrv; #agifa079#60 = enIva; #agifa079#61 = enRec;
          enTiva = 4; |HAZ IVAPrv; #agifa079#62 = enIva; #agifa079#63 = enRec;
          enTiva = 5; |HAZ IVAPrv; #agifa079#64 = enIva; #agifa079#65 = enRec;
     |SINO;
          #agifa079#56 = 0;
          #agifa079#58 = 0;
          #agifa079#60 = 0;
          #agifa079#62 = 0;
          #agifa079#64 = 0;

          #agifa079#57 = 0;
          #agifa079#59 = 0;
          #agifa079#61 = 0;
          #agifa079#63 = 0;
          #agifa079#65 = 0;
     |FINSI;

     |SI #agifa112#58 = "N";
          #agifa079#57 = 0;
          #agifa079#59 = 0;
          #agifa079#61 = 0;
          #agifa079#63 = 0;
          #agifa079#65 = 0;
     |FINSI;
|FPRC;

|PROCESO LineasAlbaran07; |TIPO 0;
     |HAZ EsAlbadis; ||Para este modulo se factura con las unidades 2
     |SI FSalida = 0; #agifa019#196 = 2; |FINSI;

     || PORTES NO FACTURABLES: SI EN ALBARAN, NO EN FACTURA -> CIAGAN
     |SI #agifa077#73 = "N";|Y #agifa080#42 ! 0;
          |SI #agifa077#58 = "D";
               nPPort1 = #agifa080#42 / #agifa077#57 * #agifa077#62;
               nPPort2 = #agifa080#42;
          |SINO;
               nPPort1 = #agifa080#42;
               nPPort2 = #agifa080#42 / #agifa077#62 * #agifa077#57;
          |FINSI;
          |SI #agifa019#196 = 2;   || doble stock
               #agifa080#9 = #agifa080#9 - (nPPort1 * #agifa080#36);
               #agifa080#31 = #agifa080#31 - (nPPort2 * #agifa080#36);
          |SINO;
               #agifa080#9 = #agifa080#9 - (nPPort1 * #agifa080#5);
               #agifa080#31 = #agifa080#31 - (nPPort2 * #agifa080#5);
          |FINSI;
     |FINSI;

     |HAZ CalCabAgifa077;

     nBruto  = nBruto  + #agifa080#9;
     nBrutoD = nBrutoD + #agifa080#31;
     nBrutoMoneda1 = #agifa080#9;

     nImporDescue1 = (nBrutoMoneda1 % #agifa079#4) ! nDeci_IVAC;
     nBrutoMoneda1 = nBrutoMoneda1 - nImporDescue1;
     nImporDescue2 = (nBrutoMoneda1 % #agifa079#5) ! nDeci_IVAC;
     nBrutoMoneda1 = nBrutoMoneda1 - nImporDescue2;
     nImporDescue3 = (nBrutoMoneda1 % #agifa079#6) ! nDeci_IVAC;
     nBrutoMoneda1 = nBrutoMoneda1 - nImporDescue3;
     nDescuMoneda1 = nImporDescue1 + nImporDescue2 + nImporDescue3;
     nImpoDto = nImpoDto + nDescuMoneda1;

     nBrutoMoneda2 = #agifa080#31;
     nImporDescue1 = (nBrutoMoneda2 % #agifa079#4) ! nDeci_IVAC;
     nBrutoMoneda2 = nBrutoMoneda2 - nImporDescue1;
     nImporDescue2 = (nBrutoMoneda2 % #agifa079#5) ! nDeci_IVAC;
     nBrutoMoneda2 = nBrutoMoneda2 - nImporDescue2;
     nImporDescue3 = (nBrutoMoneda2 % #agifa079#6) ! nDeci_IVAC;
     nBrutoMoneda2 = nBrutoMoneda2 - nImporDescue3;
     nDescuMoneda2 = nImporDescue1 + nImporDescue2 + nImporDescue3;
     nImpoDtoD = nImpoDtoD + nDescuMoneda2;

     |SI aSiNi = "S"; #agifa080#11 = 0; |FINSI; ||Exportacion

     |SI #agifa080#11 = 0;
         ||nBase0  = nBase0  + #agifa080#9;
         ||nBase0D = nBase0D + #agifa080#31;
         nBase0  = nBase0 + nBrutoMoneda1;
         nBase0D  = nBase0D + nBrutoMoneda2;
     |FINSI;

     |SI #agifa080#11 = 1;
         ||nBase1  = nBase1  + #agifa080#9;
         ||nBase1D = nBase1D + #agifa080#31;
         nBase1  = nBase1 + nBrutoMoneda1;
         nBase1D  = nBase1D + nBrutoMoneda2;
     |FINSI;

     |SI #agifa080#11 = 2;
         ||nBase2  = nBase2  + #agifa080#9;
         ||nBase2D = nBase2D + #agifa080#31;
         nBase2  = nBase2 + nBrutoMoneda1;
         nBase2D  = nBase2D + nBrutoMoneda2;
     |FINSI;

     |SI #agifa080#11 = 3;
         ||nBase3  = nBase3  + #agifa080#9;
         ||nBase3D = nBase3D + #agifa080#31;
         nBase3  = nBase3 + nBrutoMoneda1;
         nBase3D  = nBase3D + nBrutoMoneda2;
     |FINSI;

     |SI #agifa080#11 = 4;
         ||nBase4  = nBase4  + #agifa080#9;
         ||nBase4D = nBase4D + #agifa080#31;
         nBase4  = nBase4 + nBrutoMoneda1;
         nBase4D  = nBase4D + nBrutoMoneda2;
     |FINSI;

     |SI #agifa080#11 = 5;
         ||nBase5  = nBase5  + #agifa080#9;
         ||nBase5D = nBase5D + #agifa080#31;
         nBase5  = nBase5 + nBrutoMoneda1;
         nBase5D  = nBase5D + nBrutoMoneda2;
     |FINSI;

     |HAZ SumVerdeBase7;
|FPRC;

|DEFBUCLE agifa080;
     #agifa080#1;
     ;
     #agifa077#50, #agifa077#0, 001;
     #agifa077#50, #agifa077#0, 999;
     ;
     NULL, LineasAlbaran07;
|FIN;

|PROCESO LineasFacturas07;
     #agifa077#50 = #agifa072#17; ||serie albaran
     #agifa077#0  = #agifa072#2;
     |LEE 000#agifa077.=;
     |SI FSalida ! 0;
          aAlfa1 = "    En Fac: [" + #agifa072#16 +"/"+#agifa072#0 + "]  Alb: [" + #agifa077#50 + "/" + #agifa077#0 + "] inaccesible o inexistente ...";
          |MENAV aAlfa1;
          |ACABA;
     |FINSI;

     |SI #agifa077#42 = "S";
         nAbono = -1;
     |SINO;
         nAbono = 1;
     |FINSI;

     nBruto  = 0;
     nBase0  = 0;
     nBase1  = 0;
     nBase2  = 0;
     nBase3  = 0;
     nBase4  = 0;
     nBase5  = 0;
     nBrutoD = 0;
     nBase1D = 0;
     nBase0D = 0;
     nBase2D = 0;
     nBase3D = 0;
     nBase4D = 0;
     nBase5D = 0;

     |HAZ LimCabAgifa077;
     |BUCLE agifa080;
||Lo mio
     nTotaRete = nTotaRete +. (#dszrec06#19 * nAbono);
     nTotaReteD = nTotaReteD +. (#dszrec06#20 * nAbono);
/*
|| lo de antes
     |SI #agifa077#24 ! 0; |O #agifa112#93 = "S";
         |SI #agifa112#86 = "B";
               |SI #agifa077#63 > 0; nError = 1; |SINO; nError = -1; |FINSI;
               nDtoDiv = ((#agifa077#63 < #agifa077#5) < #agifa077#32) < #agifa077#7;
               nDtoDiv = nDtoDiv * nError;
               nDtoDiv = (#agifa077#63 * nError) - nDtoDiv;

               nTotaRete = nTotaRete + #agifa077#15 - #agifa077#25;
               nTotaReteD = nTotaReteD + #agifa077#63 - nDtoDiv;
         |SINO;
               nTotaRete = nTotaRete + #agifa077#55;
               nTotaReteD = nTotaReteD +  #agifa077#64;
         |FINSI;
     |FINSI;
*/
||hasta aqui
     |SI #dsm00279#20 = "S";
          |SI #agifa077#12 = 0;
              nP0  = nP0  + (#agifa077#11 * nAbono);
              nP0D = nP0D + (#agifa077#69 * nAbono);
          |FINSI;

          |SI #agifa077#12 = 1;
              nP1  = nP1  + (#agifa077#11 * nAbono);
              nP1D = nP1D + (#agifa077#69 * nAbono);
          |FINSI;

          |SI #agifa077#12 = 2;
              nP2  = nP2  + (#agifa077#11 * nAbono);
              nP2D = nP2D + (#agifa077#69 * nAbono);
          |FINSI;

          |SI #agifa077#12 = 3;
              nP3  = nP3  + (#agifa077#11 * nAbono);
              nP3D = nP3D + (#agifa077#69 * nAbono);
          |FINSI;

          |SI #agifa077#12 = 4;
              nP4  = nP4  + (#agifa077#11 * nAbono);
              nP4D = nP4D + (#agifa077#69 * nAbono);
          |FINSI;

          |SI #agifa077#12 = 5;
              nP5  = nP5  + (#agifa077#11 * nAbono);
              nP5D = nP5D + (#agifa077#69 * nAbono);
          |FINSI;

          nTP  = nTP  + (#agifa077#11 * nAbono);
          nTPD = nTPD + (#agifa077#69 * nAbono);
     |FINSI;

     |SI #agifa077#14 = 0;
         nP0  = nP0  + (#agifa077#13 * nAbono);
         nP0D = nP0D + (#agifa077#70 * nAbono);
     |FINSI;

     |SI #agifa077#14 = 1;
         nP1  = nP1  + (#agifa077#13 * nAbono);
         nP1D = nP1D + (#agifa077#70 * nAbono);
     |FINSI;

     |SI #agifa077#14 = 2;
         nP2  = nP2  + (#agifa077#13 * nAbono);
         nP2D = nP2D + (#agifa077#70 * nAbono);
     |FINSI;

     |SI #agifa077#14 = 3;
         nP3  = nP3  + (#agifa077#13 * nAbono);
         nP3D = nP3D + (#agifa077#70 * nAbono);
     |FINSI;

     |SI #agifa077#14 = 4;
         nP4  = nP4  + (#agifa077#13 * nAbono);
         nP4D = nP4D + (#agifa077#70 * nAbono);
     |FINSI;

     |SI #agifa077#14 = 5;
         nP5  = nP5  + (#agifa077#13 * nAbono);
         nP5D = nP5D + (#agifa077#70 * nAbono);
     |FINSI;

     nTV  = nTV  + (#agifa077#13 * nAbono);
     nTVD = nTVD + (#agifa077#70 * nAbono);

     |HAZ CargaLineasFac07;

     |GRABA 020#agifa072.a;

     nBruto = nBruto * nAbono;
     nBase1 = nBase1 * nAbono;
     nBase2 = nBase2 * nAbono;
     nBase3 = nBase3 * nAbono;
     nBase4 = nBase4 * nAbono;
     nBase5 = nBase5 * nAbono;
     nBase0 = nBase0 * nAbono;

     nBrutoD = nBrutoD * nAbono;
     nBase1D = nBase1D * nAbono;
     nBase2D = nBase2D * nAbono;
     nBase3D = nBase3D * nAbono;
     nBase4D = nBase4D * nAbono;
     nBase5D = nBase5D * nAbono;
     nBase0D = nBase0D * nAbono;

     nBr = nBr + nBruto;
     nB1 = nB1 + nBase1;
     nB2 = nB2 + nBase2;
     nB3 = nB3 + nBase3;
     nB4 = nB4 + nBase4;
     nB5 = nB5 + nBase5;
     nB0 = nB0 + nBase0;

     nBrD = nBrD + nBrutoD;
     nB1D = nB1D + nBase1D;
     nB2D = nB2D + nBase2D;
     nB3D = nB3D + nBase3D;
     nB4D = nB4D + nBase4D;
     nB5D = nB5D + nBase5D;
     nB0D = nB0D + nBase0D;

     #agifa079#18 = nBr;
/*
     #agifa079#17 = #agifa079#18 < #agifa079#4;
     #agifa079#17 = #agifa079#17 < #agifa079#5;
     #agifa079#17 = #agifa079#17 < #agifa079#6;
     #agifa079#17 = #agifa079#18 - #agifa079#17;

     #agifa079#47 = nB0 < #agifa079#4;
     #agifa079#47 = #agifa079#47 < #agifa079#5;
     #agifa079#47 = #agifa079#47 < #agifa079#6;

     #agifa079#21 = nB1 < #agifa079#4;
     #agifa079#21 = #agifa079#21 < #agifa079#5;
     #agifa079#21 = #agifa079#21 < #agifa079#6;

     #agifa079#24 = nB2 < #agifa079#4;
     #agifa079#24 = #agifa079#24 < #agifa079#5;
     #agifa079#24 = #agifa079#24 < #agifa079#6;

     #agifa079#27 = nB3 < #agifa079#4;
     #agifa079#27 = #agifa079#27 < #agifa079#5;
     #agifa079#27 = #agifa079#27 < #agifa079#6;

     #agifa079#49 = nB4 < #agifa079#4;
     #agifa079#49 = #agifa079#49 < #agifa079#5;
     #agifa079#49 = #agifa079#49 < #agifa079#6;

     #agifa079#52 = nB5 < #agifa079#4;
     #agifa079#52 = #agifa079#52 < #agifa079#5;
     #agifa079#52 = #agifa079#52 < #agifa079#6;
*/
     #agifa079#17 = nImpoDto;
     #agifa079#47 = nB0;
     #agifa079#21 = nB1;
     #agifa079#24 = nB2;
     #agifa079#27 = nB3;
     #agifa079#49 = nB4;
     #agifa079#52 = nB5;

     #agifa079#19 = nTP;
     #agifa079#20 = nTV;
     #agifa079#21 = #agifa079#21 + nP1;
     #agifa079#24 = #agifa079#24 + nP2;
     #agifa079#27 = #agifa079#27 + nP3;
     #agifa079#49 = #agifa079#49 + nP4;
     #agifa079#52 = #agifa079#52 + nP5;

     #agifa079#22 = #agifa079#21 % #agifa079#56;
     #agifa079#25 = #agifa079#24 % #agifa079#58;
     #agifa079#28 = #agifa079#27 % #agifa079#60;
     #agifa079#50 = #agifa079#49 % #agifa079#62;
     #agifa079#53 = #agifa079#52 % #agifa079#64;

     #agifa079#23 = #agifa079#21 % #agifa079#57;
     #agifa079#26 = #agifa079#24 % #agifa079#59;
     #agifa079#55 = #agifa079#27 % #agifa079#61;
     #agifa079#51 = #agifa079#49 % #agifa079#63;
     #agifa079#54 = #agifa079#52 % #agifa079#65;

||calculo nuevo retencion  Tiquet:7302/204  04/10/2012
     nTotaRete = 0;
     |SI #agifa112#93 = "S";
          nTotaRete = #agifa079#47; ||Exenta
     |FINSI;
                         || + Base ivas
     nTotaRete=nTotaRete+#agifa079#21+#agifa079#24+#agifa079#27+#agifa079#49+#agifa079#52;

     |SI #agifa112#86 = "N"
                         || + Cuota ivas
          nTotaRete=nTotaRete+#agifa079#22+#agifa079#25+#agifa079#28+#agifa079#50+#agifa079#53;
                         || + Cuota Recargos
          nTotaRete=nTotaRete+#agifa079#23+#agifa079#26+#agifa079#55+#agifa079#51+#agifa079#54;
     |FINSI;
     nTotaReteD = nTotaRete / #agifa079#76 * #agifa079#79;
||fin nuevo

     #agifa079#67 = nTotaRete % #agifa079#144;

     #agifa079#29 = #agifa079#22 + #agifa079#25 + #agifa079#28 + #agifa079#50 + #agifa079#53;
     #agifa079#30 = #agifa079#23 + #agifa079#26 + #agifa079#51 + #agifa079#54 + #agifa079#55;
     #agifa079#31 = #agifa079#18 - #agifa079#17;
     #agifa079#31 = #agifa079#31 + #agifa079#29;
     #agifa079#31 = #agifa079#31 + #agifa079#30;
     #agifa079#31 = #agifa079#31 + #agifa079#19;
     #agifa079#31 = #agifa079#31 + #agifa079#20;
     #agifa079#31 = #agifa079#31 - #agifa079#67;
     #agifa079#31 = #agifa079#31 + nTotPVerde; ||modulo Bsegui

     || Acumulo los valores en divisa

     #agifa079#82 = nBrD;
     #agifa079#83 = nTPD;
     #agifa079#84 = nTVD;
/*
     #agifa079#81 = #agifa079#82 < #agifa079#4;
     #agifa079#81 = #agifa079#81 < #agifa079#5;
     #agifa079#81 = #agifa079#81 < #agifa079#6;
     #agifa079#81 = #agifa079#82 - #agifa079#81;

     #agifa079#85 = nB1D < #agifa079#4;
     #agifa079#85 = #agifa079#85 < #agifa079#5;
     #agifa079#85 = #agifa079#85 < #agifa079#6;

     #agifa079#88 = nB2D < #agifa079#4;
     #agifa079#88 = #agifa079#88 < #agifa079#5;
     #agifa079#88 = #agifa079#88 < #agifa079#6;

     #agifa079#91 = nB3D < #agifa079#4;
     #agifa079#91 = #agifa079#91 < #agifa079#5;
     #agifa079#91 = #agifa079#91 < #agifa079#6;

     #agifa079#96 = nB4D < #agifa079#4;
     #agifa079#96 = #agifa079#96 < #agifa079#5;
     #agifa079#96 = #agifa079#96 < #agifa079#6;

     #agifa079#99 = nB5D < #agifa079#4;
     #agifa079#99 = #agifa079#99 < #agifa079#5;
     #agifa079#99 = #agifa079#99 < #agifa079#6;
*/
     #agifa079#81 = nImpoDtoD;
     #agifa079#85 = nB1D;
     #agifa079#88 = nB2D;
     #agifa079#91 = nB3D;
     #agifa079#96 = nB4D;
     #agifa079#99 = nB5D;

     #agifa079#85 = #agifa079#85 + nP1D;
     #agifa079#88 = #agifa079#88 + nP2D;
     #agifa079#91 = #agifa079#91 + nP3D;
     #agifa079#96 = #agifa079#96 + nP4D;
     #agifa079#99 = #agifa079#99 + nP5D;

     #agifa079#86  = #agifa079#85 % #agifa079#56;
     #agifa079#89  = #agifa079#88 % #agifa079#58;
     #agifa079#92  = #agifa079#91 % #agifa079#60;
     #agifa079#97  = #agifa079#96 % #agifa079#62;
     #agifa079#100 = #agifa079#99 % #agifa079#64;

     #agifa079#87  = #agifa079#85 % #agifa079#57;
     #agifa079#90  = #agifa079#88 % #agifa079#59;
     #agifa079#102 = #agifa079#91 % #agifa079#61;
     #agifa079#98  = #agifa079#96 % #agifa079#63;
     #agifa079#101 = #agifa079#99 % #agifa079#65;

     #agifa079#103 = nTotaReteD % #agifa079#144;

     #agifa079#93 = #agifa079#86 + #agifa079#89 + #agifa079#92  + #agifa079#97 + #agifa079#100;
     #agifa079#94 = #agifa079#87 + #agifa079#90 + #agifa079#102 + #agifa079#98 + #agifa079#101;

     #agifa079#95 = #agifa079#82 - #agifa079#81;
     #agifa079#95 = #agifa079#95 + #agifa079#93;
     #agifa079#95 = #agifa079#95 + #agifa079#94;
     #agifa079#95 = #agifa079#95 + #agifa079#83;
     #agifa079#95 = #agifa079#95 + #agifa079#84;
     #agifa079#95 = #agifa079#95 - #agifa079#103;

     #agifa079#95 = #agifa079#95 + nTotPVerde; ||modulo Bsegui

     #agifa079#145 = #agifa079#145 + #agifa077#78; ||P.Verde
     #agifa079#148 = #agifa079#148 + #agifa077#80; ||Canon

     |SI #agifa079#77 = "B"; || Si la moneda de trabajo es la moneda base ...
          #agifa079#104 = #agifa079#17;
          #agifa079#105 = #agifa079#18;
          #agifa079#106 = #agifa079#19;
          #agifa079#107 = #agifa079#20;
          #agifa079#108 = #agifa079#21;
          #agifa079#109 = #agifa079#22;
          #agifa079#110 = #agifa079#23;
          #agifa079#111 = #agifa079#24;
          #agifa079#112 = #agifa079#25;
          #agifa079#113 = #agifa079#26;
          #agifa079#114 = #agifa079#27;
          #agifa079#115 = #agifa079#28;
          #agifa079#116 = #agifa079#29;
          #agifa079#117 = #agifa079#30;
          #agifa079#118 = #agifa079#31;
          #agifa079#119 = #agifa079#49;
          #agifa079#120 = #agifa079#50;
          #agifa079#121 = #agifa079#51;
          #agifa079#122 = #agifa079#52;
          #agifa079#123 = #agifa079#53;
          #agifa079#124 = #agifa079#54;
          #agifa079#125 = #agifa079#55;
          #agifa079#126 = #agifa079#67;
     |SINO; || Si la moneda de trabajo es la divisa ...
          #agifa079#104 = #agifa079#81;
          #agifa079#105 = #agifa079#82;
          #agifa079#106 = #agifa079#83;
          #agifa079#107 = #agifa079#84;
          #agifa079#108 = #agifa079#85;
          #agifa079#109 = #agifa079#86;
          #agifa079#110 = #agifa079#87;
          #agifa079#111 = #agifa079#88;
          #agifa079#112 = #agifa079#89;
          #agifa079#113 = #agifa079#90;
          #agifa079#114 = #agifa079#91;
          #agifa079#115 = #agifa079#92;
          #agifa079#116 = #agifa079#93;
          #agifa079#117 = #agifa079#94;
          #agifa079#118 = #agifa079#95;
          #agifa079#119 = #agifa079#96;
          #agifa079#120 = #agifa079#97;
          #agifa079#121 = #agifa079#98;
          #agifa079#122 = #agifa079#99;
          #agifa079#123 = #agifa079#100;
          #agifa079#124 = #agifa079#101;
          #agifa079#125 = #agifa079#102;
          #agifa079#126 = #agifa079#103;
     |FINSI;
|FPRC;

|DEFBUCLE agifa072;
     #agifa072#1;
     ;
     #agifa079#66, #agifa079#0, 001;
     #agifa079#66, #agifa079#0, 999;
     be;
     NULL, LineasFacturas07;
|FIN;

|PROCESO CalCabAgifa079;
     |ABRE #agifa142; |LEE 000#agifa142.p; |CIERRA #agifa142;
     |ABRE #dsm00279; |LEE 000#dsm00279.p; |CIERRA #dsm00279;
     nImpoDto = 0;
     nImpoDtoD = 0;
     nBruto  = 0;
     nBase0  = 0;
     nBase1  = 0;
     nBase2  = 0;
     nBase3  = 0;
     nBase4  = 0;
     nBase5  = 0;
     nBrutoD = 0;
     nBase1D = 0;
     nBase0D = 0;
     nBase2D = 0;
     nBase3D = 0;
     nBase4D = 0;
     nBase5D = 0;
     nP0     = 0;
     nP1     = 0;
     nP2     = 0;
     nP3     = 0;
     nP4     = 0;
     nP5     = 0;
     nP0D    = 0;
     nP1D    = 0;
     nP2D    = 0;
     nP3D    = 0;
     nP4D    = 0;
     nP5D    = 0;
     nTP     = 0;
     nTPD    = 0;
     nTV     = 0;
     nTVD    = 0;
     nBr     = 0;
     nB1     = 0;
     nB2     = 0;
     nB3     = 0;
     nB4     = 0;
     nB5     = 0;
     nB0     = 0;
     nBrD    = 0;
     nB1D    = 0;
     nB2D    = 0;

     nB3D    = 0;
     nB4D    = 0;
     nB5D    = 0;
     nB0D    = 0;
     nTotaRete = 0;
     nTotaReteD = 0;

     nDeci_Div  = nDeci_DivF;

     |PARA nCampo = 17; |SI nCampo [ 31; |HACIENDO nCampo = nCampo + 1;
           #agifa079#nCampo# = 0;
     |SIGUE;

     |PARA nCampo = 33; |SI nCampo [ 44; |HACIENDO nCampo = nCampo + 1;
          #agifa079#nCampo# = 0;
     |SIGUE;

     #agifa079#46 = 0;
     #agifa079#47 = 0;
     |PARA nCampo = 49; |SI nCampo [ 65; |HACIENDO nCampo = nCampo + 1;
           #agifa079#nCampo# = 0;
     |SIGUE;

     #agifa079#67 = 0;
     #agifa079#145 = 0;
     #agifa079#148 = 0;
     |PARA nCampo = 80; |SI nCampo [ 127; |HACIENDO nCampo = nCampo + 1;
           #agifa079#nCampo# = 0;
     |SIGUE;

     |ABRE #agifa112;
     #agifa112#0 = #agifa079#2;
     |LEE 020#agifa112.=;
     |CIERRA #agifa112;

     |HAZ SacaIvaAgifa079;

     |ABRE #agifa077;
     |BUCLE agifa072;
     |CIERRA #agifa077;
|FPRC;
