          Si se cambia ActCliente/ActCliSat/ActCliGesi
          modificar condz008 de aplicacion condepo

|FICHEROS;
     cafe0026 #0;
     agifa010 #10;
     cafe0027 #27;
     agifa019 #19;
     agifa060 #60;
     agi00063 #63;
     agifa071 #71;

     agifa066 #66;
     dsm00112 #112;
     dsm00113 #113;
     agifa324 #324;
     agifa321 #321;

     condm000@;
     condm001@ #1;
     condm002@ #2;
     condm003@ #3;
     condm004@ #4;
     condm005@ #5;
     condm006@ #6;
     condm007@ #7;
     condm008@ #8;
     condm009@ #9;
     dscam003@;
     gesim002@;
     gesim013@;
     gesim024@;
|FIN;

|VARIABLES;
     aSwEsAlbAviso = "";
     aDepo = "";
     nSwGesisat = 0;
     nSwJamaica = 0;
     &eaMaquina = "";
     aEmp = "";
     aEsGesisat = "N";
     nBruto = 0;
     nDescue1 = 0;
     nDescue2 = 0;
     nDescue3 = 0;
     nIva =0;
     &eaCli = "";
     &aDivisa = "";
     &aMoneda = "";
     &nDeci_IVA = 0;
     &eaMarca = "";
     &eaFamilia = "";
     &enTiva = 0;
     &efFiva = @;
     &enIva = 0;
     &enRec = 0;
     nPvp = 0;
     nSwRecalculo = 0;
     aCliente = "";
     aEjecuta = "";
     aTipo = "";
     aNombreTipo = "";
     &enModo = 0;
     &enPrecio = 0;
     &enForma = 0;
     &enCobro = 0;
     &enRecibo = 0;
     &enError = 0;
     &eaAlfa = "";
     &eaCliente = "";
     &eaArticulo = "";
     aAlfa = "";
     aBase = "";
     aEsEmpBase = "";
     aEsEmpMaq = "";
     aEsEmpSat = "";
     aEmpBase = "";
     aEmpMaq = "";
     aEmpSat = "";
     aEmpCarte = "";
     aEmpGes = "";
     aParam = "";
     aArt = "";
     aSer = "";
     aNum = "";
     aPre = "";
     nForma = 0;
     nNum = 0;
     nCampo = 0;
     nPdte = 0;
     nDepo = 0;
     i = 0;
     nImpAmortiza = 0;
     nTipo = 0;
     nImp = 0;
     nTotaDepo = 0;
     aImp = "";
     aCli = "";
     aFec = "";
     nSwSat = 0;
     fFec = @;
     nReg = 0;
     aTipoHis = "";
     nDocCarte = 0;
     nError = 0;
     nNume = 0;
     nLin = 0;
     nLinDepo = 0;
     aMaqui = "";
|FIN;

========================Gesisat======================================
|PROCESO GesiLeeMaqui;
     |DDEF aAlfa;
     aAlfa = aAlfa + "gesim024";
     |CARGA_DEF aAlfa, gesim024@;
     |SI FSalida = 0;
          |ABRE #gesim024@;
          #gesim024@#0 = "AV";
          #gesim024@#1 = #71#29;
          #gesim024@#2 = #71#0;
          #gesim024@#3 = #71#1;
          |LEE 000#gesim024@.=;
          |SI FSalida = 0;
               aMaqui = #gesim024@#4;
          |SINO;
               aMaqui = "";
          |FINSI;
          |CIERRA #gesim024@;
          |DESCARGA_DEF #gesim024@;
     |SINO;
          |MENAV "0000Error al cargar 'gesim024'";
     |FINSI;
|FPRC;

|PROCESO EsAlbAviso
     |DDEF aAlfa;
     aAlfa = aAlfa + "gesim013";
     |CARGA_DEF aAlfa, gesim013@;
     |SI FSalida = 0;
          |ABRE #gesim013@;
          |SELECT #2#gesim013@;
          #gesim013@#2 = aSer;
          #gesim013@#3 = aNum;
          |LEE 000#gesim013@.=;
          |SI FSalida = 0;
               aSwEsAlbAviso = "S";
          |SINO;
               aSwEsAlbAviso = "N";
          |FINSI;
          |CIERRA #gesim013@;
          |DESCARGA_DEF #gesim013@;
     |FINSI;
|FPRC;

|PROCESO Act_condm006;
     #condm006@#5 = enPrecio;
     #condm006@#11 = #condm006@#5 - #condm006@#6;
     |GRABA 020#condm006@.a;
|FPRC;

|DEFBUCLE Act_condm006;
     #condm006@#1002;
     3;
     0, eaArticulo, "      ";
     9, eaArticulo, "      ";
     be;
     NULL, Act_condm006;
|FIN;

|PROCESO AltaCtrDepoGesi;
     aAlfa = aBase + "condepo/def/condm006";
     |CARGA_DEF aAlfa, condm006@;
     |SI FSalida = 0;
          aAlfa = aBase + "condepo/fich/" + aEmpMaq + "/";
          |PATH_DAT #condm006@#aAlfa#;

          |ABRE #19;
          #19#0 = eaArticulo;
          |LEE 020#19=;
          |CIERRA #19;
          enPrecio = #19#18;
          |SI enModo = 1;
               |ABRE #60
               #60#0 = #19#2;
               |LEE 000#60=;
               |SI FSalida ! 0; |DDEFECTO #60; |FINSI;
               |CIERRA #60;
               |ABRE #63;
               #63#0 = #19#126;
               |LEE 000#63=;
               |SI FSalida ! 0; |DDEFECTO #63; |FINSI;
               |CIERRA #63;
               |DDEFECTO #condm006@;
               |ABRE #condm006@;
               #condm006@#0 = #0#0;
               #condm006@#1 = eaMaquina;
               |LEE 000#condm006@.=;
               |SI FSalida = 0;
                    |MENAV "0000Maquina existente en control de depositos....";
               |SINO;
                    #condm006@#2 = eaAlfa;
                    #condm006@#4 = ~;
                    #condm006@#5 = enPrecio;
                    #condm006@#8 = #60#1;
                    #condm006@#9 = #63#1;
                    |SI #19#130 = "N";
                         enTiva = #19#30;
                         efFiva = ~;
                         |HAZ SacaIVA;
                         nPvp = enPrecio > enIva;
                         #condm006@#10 = nPvp;
                    |SINO;
                         #condm006@#10 = enPrecio;
                    |FINSI;
                    #condm006@#11 = #condm006@#5 - #condm006@#6;
                    |GRABA 020#condm006@.n;
               |FINSI;
               |CIERRA #condm006@;
          |SINO;
               |BUCLE Act_condm006;
          |FINSI;
          |DESCARGA_DEF #condm006@;
     |SINO;
          |MENAV "0000Error al cargar 'condm006'...";
     |FINSI;
|FPRC;

|PROCESO ActCliGesi;
     aAlfa = aBase + "dscomer9/def/gesim002";
     |CARGA_DEF aAlfa, gesim002@;
     |SI FSalida = 0;
          |ABRE #gesim002@;

          aEsGesisat = "S";
          |HAZ ActCliente;

          |CIERRA #gesim002@;
          |DESCARGA_DEF #gesim002@;
     |FINSI;
|FPRC;

|PROCESO LinAlbGesi;
     nImp = nImp + #71#9;

|ACABA;
     |HAZ GesiLeeMaqui;
     aAlfa = aMaqui; |QBF aAlfa;
     |SI aAlfa ! "";
          #gesim002@#0 = aMaqui;
          |LEE 000#gesim002@.=;
          |SI FSalida = 0;
               eaCli = #10#3;
               enTiva = #71#11;
               efFiva = #10#1;
               |HAZ IVACli;

               nImp = nImp + #71#9;
   /*
               nBruto = #71#9;
               nDescue1 = (nBruto % #10#5) ! nDeci_IVA;
               nBruto = nBruto - nDescue1;
               nDescue2 = (nBruto % #10#32) ! nDeci_IVA;
               nBruto = nBruto - nDescue2;
               nDescue3 = (nBruto % #10#7) ! nDeci_IVA;
               nBruto = nBruto - nDescue3;
               nDescue1 = nDescue1 + nDescue2 + nDescue3;
               nIva = (nBruto % enIva) ! nDeci_IVA;
               |SI #10#36 = "S";
                    nIva = nIva + ((nBruto % enRec) ! nDeci_IVA);
               |FINSI;
               ||nImp = nImp + (#71#9 - nDescue1 + nIva);
               nImp = nImp + (#71#9 - nDescue1);
   */
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO AlbaranGesi;
     aDivisa = #10#68;
     aMoneda = #10#70;
     |HAZ Divisas010;
|FPRC;

|DEFBUCLE AlbaranGesi;
     #10#1;
     ;
     aSer, nNum;
     aSer, nNum;
     ;
     NULL, AlbaranGesi, LinAlbGesi;
|FIN;

|PROCESO ActGesiSat;
     |HAZ EsAlbAviso;
     |SI aSwEsAlbAviso = "N"; |ACABA; |FINSI;

     aAlfa = aBase + "dscomer9/def/gesim002";
     |CARGA_DEF aAlfa, gesim002@;
     |SI FSalida = 0;
          aAlfa = aBase + "condepo/def/condm003";
          |CARGA_DEF aAlfa, condm003@;
          |SI FSalida = 0;
               aAlfa = aBase + "condepo/fich/" + aEmpSat + "/";
               |PATH_DAT #condm003@#aAlfa#;
               |ABRE #condm003@;
               #condm003@#0 = aCli;
               |LEE 101#condm003@.=;
               |SI FSalida = 0; |Y fFec ] #condm003@#38;
                    nImp = 0;
                    nNum = aNum;
                    |ABRE #gesim002@;
                    |BUCLE AlbaranGesi;
                    |CIERRA #gesim002@;
                    #condm003@#39 = #condm003@#39 + (nImp * nForma);
                    #condm003@#41 = #condm003@#39 - #condm003@#40;
                    |GRABA 020#condm003@.a;
               |FINSI;
               |CIERRA #condm003@;
               |DESCARGA_DEF #condm003@;
          |SINO;
               |MENAV "0000Error al cargar 'condm003'...";
          |FINSI;
          |DESCARGA_DEF #gesim002@;
     |SINO;
          |MENAV "0000Error al cargar 'gesim002'...";
     |FINSI;
|FPRC;
========================Jamaica======================================
|PROCESO T12; |TIPO 12;
|FPRC;

|PROCESO AltaDepo;
     |SI nSwGesisat = 0;
          |HAZ GesiLeeMaqui;
          aDepo = aMaqui;
     |SINO;
          aDepo = #71#2;
     |FINSI;
     #condm006@#0 = 1;
     #condm006@#1 = aDepo
     |LEE 101#condm006@.=;
     |SI FSalida ! 0;
          #condm006@#0 = 2;
          |LEE 101#condm006@.=;
     |FINSI;
     |SI FSalida = 0;
          #condm006@#3 = #condm003@#0;
          #condm006@#7 = 0;
          |GRABA 020#condm006@.a;
     |FINSI;
     |LIBERA #condm006@;

     #condm007@#0 = #condm006@#0;
     #condm007@#1 = #condm006@#1;
     #condm007@#2 = 999;
     |LEE 000#condm007@.];
     |SI FSalida = 0;
          |LEE 000#condm007@.a;
     |SINO;
          |LEE 000#condm007@.u;
     |FINSI;
     |SI FSalida = 0; |Y #condm007@#0 = #condm006@#0;
               |Y #condm007@#1 = #condm006@#1;
          nLinDepo = #condm007@#2 + 1;
     |SINO;
          nLinDepo = 1;
     |FINSI;
     |DDEFECTO #condm007@;
     #condm007@#0 = #condm006@#0;
     #condm007@#1 = #condm006@#1;
     #condm007@#2 = nLinDepo;
     #condm007@#3 = #condm003@#0;
     #condm007@#4 = "S";
     #condm007@#5 = #condm006@#11;
     |GRABA 020#condm007@.n;

     #condm005@#0 = #condm003@#0;
     #condm005@#1 = 999;
     |LEE 000#condm005@.];
     |SI FSalida = 0;
          |LEE 000#condm005@.a;
     |SINO;
          |LEE 000#condm005@.u;
     |FINSI;
     |SI FSalida = 0; |Y #condm005@#0 = #condm003@#0;
          nLin = #condm005@#1 + 1;
     |SINO;
          nLin = 1;
     |FINSI;
     |DDEFECTO #condm005@;
     #condm005@#0 = #condm003@#0;
     #condm005@#1 = nLin;
     #condm005@#2 = #condm006@#0;
     #condm005@#3 = aDepo;

     |LEE 000#condm009@.p;
     |SI FSalida ! 0; |DDEFECTO #condm009@; |FINSI;

     aNombreTipo = "";
     aTipo = #condm005@#2;
     |SI aTipo = 1; aNombreTipo = #condm009@#1; |FINSI;
     |SI aTipo = 2; aNombreTipo = #condm009@#2; |FINSI;
     |SI aTipo = 3; aNombreTipo = #condm009@#3; |FINSI;
     |SI aTipo = 4; aNombreTipo = #condm009@#4; |FINSI;
     |SI aTipo = 5; aNombreTipo = #condm009@#5; |FINSI;
     |SI aTipo = 6; aNombreTipo = #condm009@#6; |FINSI;
     |SI aTipo = 7; aNombreTipo = #condm009@#7; |FINSI;

     #condm005@#4 = aNombreTipo;
     #condm005@#5 = #condm006@#11;
     #condm005@#7 = #condm006@#5;
     #condm005@#8 = #10#1;
     nNume = 5 / 1000000;
     fFec = #10#1 + nNume;
     #condm005@#9 = fFec;
     #condm005@#11 = #condm006@#2;
     #condm005@#12 = nLinDepo;
     |GRABA 020#condm005@.n;
|FPRC;

|PROCESO CheqDepo;
     |SI nSwGesisat = 0;
          |HAZ GesiLeeMaqui;
          aDepo = aMaqui;
     |SINO;
          aDepo = #71#2;
     |FINSI;
     #condm006@#0 = 1;
     #condm006@#1 = aDepo;
     |LEE 000#condm006@.=;
     |SI FSalida ! 0;
          #condm006@#0 = 2;
          |LEE 000#condm006@.=;
     |FINSI;
     |SI FSalida ! 0;
          |MENAV "0000No es posible realizar el alta. Faltan depósitos...";
          nError = 1; |ERROR10;
     |SINO;
          |SI #condm006@#3 ! "      ";
               |MENAV "0000No es posible realizar el Alta. Depósitos instalados en otro cliente...";
               nError = 1; |ERROR10;
          |SINO;
               |SI #condm006@#0 = 1;
                    #condm006@#0 = 2;
                    |LEE 000#condm006@.=;
                    |SI FSalida = 0; |Y #condm006@#3 ! "      ";
                         |MENAV "0000No es posible realizar el Alta. Depósitos instalados en otro cliente...";
                         nError = 1; |ERROR10;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO AltaCtrCli;
     aCliente = "";
     nSwRecalculo = 0;

     aAlfa = aBase + "condepo/def/condm001";
     |CARGA_DEF aAlfa, condm001@;
     |SI FSalida = 0;
          aAlfa = aBase + "condepo/def/condm003";
          |CARGA_DEF aAlfa, condm003@;
          |SI FSalida = 0;
               aAlfa = aBase + "condepo/def/condm004";
               |CARGA_DEF aAlfa, condm004@;
               |SI FSalida = 0;
                    aAlfa = aBase + "condepo/def/condm005";
                    |CARGA_DEF aAlfa, condm005@;
                    |SI FSalida = 0;
                         aAlfa = aBase + "condepo/def/condm006";
                         |CARGA_DEF aAlfa, condm006@;
                         |SI FSalida = 0;
                              aAlfa = aBase + "condepo/def/condm007";
                              |CARGA_DEF aAlfa, condm007@;
                              |SI FSalida = 0;
                                   aAlfa = aBase + "condepo/def/condm009";
                                   |CARGA_DEF aAlfa, condm009@;
                                   |SI FSalida = 0;
                                        aAlfa = aBase + "condepo/fich/" + aEmpMaq + "/";
                                        |PATH_DAT #condm001@#aAlfa#;
                                        |PATH_DAT #condm003@#aAlfa#;
                                        |PATH_DAT #condm004@#aAlfa#;
                                        |PATH_DAT #condm005@#aAlfa#;
                                        |PATH_DAT #condm006@#aAlfa#;
                                        |PATH_DAT #condm007@#aAlfa#;
                                        |PATH_DAT #condm009@#aAlfa#;
                                        |ABRE #condm001@; |LEE 000#condm001@.=; |CIERRA #condm001@;
                                        |SI aSer = #condm001@#5; |O aSer = #condm001@#6;
                                                  |O aSer = #condm001@#7;
                                             |ABRE #10;
                                             #10#52 = aSer;
                                             #10#0 = aNum;
                                             |LEE 020#10=;
                                             |SI FSalida = 0;
                                                  |ABRE #condm003@;
                                                  |ABRE #condm005@;
                                                  |ABRE #condm006@;
                                                  |ABRE #condm007@;
                                                  |ABRE #condm009@;
                                                  #condm003@#0 = #10#3;
                                                  |LEE 000#condm003@.=;
                                                  |SI FSalida ! 0;
                                                       |CONFI "0000N¿Desea dar de alta el Cliente en la aplicación Control Depósitos?";
                                                       |SI FSalida = 0;
                                                            nError = 0;
                                                            |BUCLELIN 2 CheqDepo #10;
                                                            |SI nError = 0;
                                                                 |DDEFECTO #condm003@;
                                                                 #condm003@#0 = #10#3;
                                                                 #condm003@#1 = #10#4;
                                                                 #condm003@#2 = #10#1;
                                                                 #condm003@#38 = #10#1;
                                                                 |GRABA 020#condm003@.n;
                                                                 |BUCLELIN 2 AltaDepo #10;
                                                                 |MENAV "0000Alta realizada. Revíselo en Control Clientes...";
                                                                 nSwRecalculo = 1;
                                                                 aCliente = #10#3;
                                                            |FINSI;
                                                       |FINSI;
                                                  |FINSI;
                                                  |CIERRA #condm009@;
                                                  |CIERRA #condm007@;
                                                  |CIERRA #condm006@;
                                                  |CIERRA #condm005@;
                                                  |CIERRA #condm003@;
                                             |FINSI;
                                             |CIERRA #10;
                                        |FINSI;
                                        |DESCARGA_DEF #condm009@;
                                   |FINSI;
                                   |DESCARGA_DEF #condm007@;
                              |FINSI;
                              |DESCARGA_DEF #condm006@;
                         |FINSI;
                         |DESCARGA_DEF #condm005@;
                    |FINSI;
                    |DESCARGA_DEF #condm004@;
               |FINSI;
               |DESCARGA_DEF #condm003@;
          |FINSI;
          |DESCARGA_DEF #condm001@;
     |FINSI;

     |SI nSwRecalculo = 1;
          aEjecuta = "|:condepo/condz008 cond0000 " + aEmpMaq + ";" + aCliente;
          |SUB_EJECUTA_NP aEjecuta;
     |FINSI;
|FPRC;

|PROCESO BorraAlbCob;
     |ABRE #27;
     #27#0 = aSer;
     #27#1 = nNum;
     |LEE 101#27=;
     |SI FSalida = 0;
          |BORRA 020#27a;
     |FINSI;
     |CIERRA #27;
|FPRC;

|PROCESO DocCarte;
     aAlfa = aBase + "dscarter/def/dscam003";
     |CARGA_DEF aAlfa, dscam003@;
     |SI FSalida = 0;
          aAlfa = aBase + "dscarter/fich/" + aEmpCarte + "/";
          |PATH_DAT #dscam003@#aAlfa#;
          |ABRE #dscam003@;
          |SELECT #12#dscam003@;
          #dscam003@#0 = #10#52;
          #dscam003@#1 = #10#0;
          #dscam003@#2 = enRecibo;
          #dscam003@#4 = "";
          #dscam003@#5 = "";
          #dscam003@#32 = "";
          |LEE 000#dscam003@.];
          |PARA; |SI FSalida = 0; |Y #dscam003@#0 = #10#52;
                    |Y #dscam003@#1 = #10#0;
                    |Y #dscam003@#2 = enRecibo; |HACIENDO;
               |SI #dscam003@#69 = "A";
                    nDocCarte = #dscam003@#40;
                    |SAL;
               |FINSI;
               |LEE 000#dscam003@.s;
          |SIGUE;
          |CIERRA #dscam003@;
          |DESCARGA_DEF #dscam003@;
     |SINO;
          |MENAV "0000Error al cargar dscam003...";
     |FINSI;
|FPRC;

|PROCESO GraHisto;
     |HAZ DocCarte;
     |LEE 000#condm008@.u;
     |SI FSalida = 0;
          nReg = #condm008@#0 + 1;
     |SINO;
          nReg = 1;
     |FINSI;
     #condm008@#0 = nReg;
     #condm008@#1 = #condm003@#0;
     |SI aTipoHis = "S";
          #condm008@#2 = "SAT";
     |SINO;
          #condm008@#2 = #condm005@#3;
     |FINSI;
     #condm008@#3 = aTipoHis;
     #condm008@#4 = nImp;
     #condm008@#5 = #10#52;
     #condm008@#6 = #10#0;
     #condm008@#7 = enRecibo;
     #condm008@#8 = ~;
     |HORA aAlfa;
     #condm008@#9 = aAlfa;
     #condm008@#10 = enCobro;
     #condm008@#11 = #71#2;
     #condm008@#12 = #71#6;
     #condm008@#13 = #19#133;
     #condm008@#14 = nDocCarte;
     #condm008@#15 = #condm003@#3;
     #condm008@#16 = #condm003@#5;
     #condm008@#17 = #condm003@#6;
     #condm008@#18 = #condm003@#7;
     #condm008@#19 = #condm003@#8;
     #condm008@#20 = #condm003@#9;
     #condm008@#21 = #condm003@#10;
     #condm008@#22 = #condm003@#11;
     #condm008@#23 = #condm003@#12;
     |GRABA 020#condm008@.n;
|FPRC;


|PROCESO AltaCtrDepo;
     aAlfa = aBase + "condepo/def/condm006";
     |CARGA_DEF aAlfa, condm006@;
     |SI FSalida = 0;
          aAlfa = aBase + "condepo/fich/" + aEmpMaq + "/";
          |PATH_DAT #condm006@#aAlfa#;

          |SI enModo = 1;
               |BLANCO 1025 1553;
               |PINPA #0#0;
               |PINDA #0#0;
               |ENDATOS #1#0;

               |ABRE #60
               #60#0 = eaFamilia;
               |LEE 000#60=;
               |SI FSalida ! 0; |DDEFECTO #60; |FINSI;
               |CIERRA #60;
               |ABRE #63;
               #63#0 = eaMarca;
               |LEE 000#63=;
               |SI FSalida ! 0; |DDEFECTO #63; |FINSI;
               |CIERRA #63;

               |ABRE #condm006@;
               #condm006@#0 = #0#0;
               #condm006@#1 = eaArticulo;
               #condm006@#2 = eaAlfa;
               #condm006@#4 = ~;
               #condm006@#5 = enPrecio;
               #condm006@#8 = #60#1;
               #condm006@#9 = #63#1;
               |SI #19#130 = "N";
                    ||enTiva = #19#30;
                    efFiva = ~;
                    |HAZ SacaIVA;
                    nPvp = enPrecio > enIva;
                    #condm006@#10 = nPvp;
               |SINO;
                    #condm006@#10 = enPrecio;
               |FINSI;
               #condm006@#11 = #condm006@#5 - #condm006@#6;
               |GRABA 020#condm006@.n;
               |CIERRA #condm006@;
          |SINO;
               |BUCLE Act_condm006;
          |FINSI;
          |DESCARGA_DEF #condm006@;
     |SINO;
          |MENAV "0000Error al cargar 'condm006'...";
     |FINSI;
|FPRC;

|PROCESO Min6;
     #condm006@#3 = eaCliente;
     #condm006@#1 = "                    ";
|FPRC;

|PROCESO Max6;
     #condm006@#3 = eaCliente;
     #condm006@#1 = "zzzzzzzzzzzzzzzzzzzz";
|FPRC;

|PROCESO EligeMaquina;
     aAlfa = aBase + "condepo/def/condm006";
     |CARGA_DEF aAlfa, condm006@;
     |SI FSalida = 0;
          aAlfa = aBase + "condepo/fich/" + aEmpSat + "/";
          |PATH_DAT #condm006@#aAlfa#;
          |ABRE #condm006@;
          |SELECT #2#condm006@;
          #condm006@#3 = eaCliente;
          #condm006@#1 = eaAlfa;
          |LEE 000#condm006@.];
          |CONSULTA_F_CLAVE #2#condm006@, Min6, Max6;
          enError = FSalida;
          eaAlfa = #condm006@#1;
          |CIERRA #condm006@;
          |DESCARGA_DEF #condm006@;
     |SINO;
          |MENAV "0000Error al cargar 'condm006'...";
     |FINSI;
|FPRC;

|PROCESO CheqMaquina;
     aAlfa = aBase + "condepo/def/condm006";
     |CARGA_DEF aAlfa, condm006@;
     |SI FSalida = 0;
          aAlfa = aBase + "condepo/def/condm003";
          |CARGA_DEF aAlfa, condm003@;
          |SI FSalida = 0;
               aAlfa = aBase + "condepo/fich/" + aEmpSat + "/";
               |PATH_DAT #condm006@#aAlfa#;
               |PATH_DAT #condm003@#aAlfa#;
               |ABRE #condm006@;
               |SELECT #2#condm006@;
               #condm006@#3 = eaCliente;
               #condm006@#1 = eaAlfa;        ||Maquina=Deposito
               |LEE 000#condm006@.=;
               enError = FSalida;
               |CIERRA #condm006@;
               |SI enError ! 0;
                    |ABRE #condm003@;
                    #condm003@#0 = eaCliente;
                    |LEE 000#condm003@.=;
                    |SI FSalida = 0;
                         enError = 1;
                    |SINO;
                         enError = 2;
                    |FINSI;
                    |CIERRA #condm003@;
               |FINSI;
               |DESCARGA_DEF #condm003@;
          |SINO;
               |MENAV "0000Error al cargar 'condm003'...";
          |FINSI;
          |DESCARGA_DEF #condm006@;
     |SINO;
          |MENAV "0000Error al cargar 'condm006'...";
     |FINSI;
|FPRC;

|PROCESO ActCliSat;
     aAlfa = aBase + "condepo/def/condm003";
     |CARGA_DEF aAlfa, condm003@;
     |SI FSalida = 0;
          aAlfa = aBase + "condepo/fich/" + aEmpSat + "/";
          |PATH_DAT #condm003@#aAlfa#;
          |ABRE #condm003@;
          #condm003@#0 = aCli;
          |LEE 101#condm003@.=;
          |SI FSalida = 0; |Y fFec ] #condm003@#38;
               #condm003@#39 = #condm003@#39 + (aImp * nForma);
               #condm003@#41 = #condm003@#39 - #condm003@#40;
               |GRABA 020#condm003@.a;
          |FINSI;
          |CIERRA #condm003@;
          |DESCARGA_DEF #condm003@;
     |SINO;
          |MENAV "0000Error al cargar 'condm003'...";
     |FINSI;
|FPRC;

|PROCESO CheExisteCli;
     aAlfa = aBase + "condepo/def/condm003";
     |CARGA_DEF aAlfa, condm003@;
     |SI FSalida = 0;
          aAlfa = aBase + "condepo/fich/" + aEmpSat + "/";
          |PATH_DAT #condm003@#aAlfa#;
          |ABRE #condm003@;
          #condm003@#0 = eaCliente;
          |LEE 000#condm003@.=;
          |SI FSalida = 0;
               enError = 2;
          |FINSI;
          |CIERRA #condm003@;
          |DESCARGA_DEF #condm003@;
     |SINO;
          |MENAV "0000Error al cargar 'condm003'...";
     |FINSI;
|FPRC;

|PROCESO DepoLin;
     aTipoHis = nTipo;
     |HAZ GraHisto;

     #condm007@#6 = #condm007@#6 + nImp;
     |GRABA 020#condm007@.a;

     #condm006@#0 = nTipo;
     #condm006@#1 = #condm005@#3;
     |LEE 101#condm006@.=;
     |SI FSalida = 0;
          #condm006@#6 = #condm006@#6 + nImp;
          #condm006@#7 = #condm006@#7 + nImp;
          #condm006@#11 = #condm006@#5 - #condm006@#6;
          |GRABA 020#condm006@.a;
          |LIBERA #condm006@;
     |FINSI;
     |ERROR10;
|FPRC;

|DEFBUCLE DepoLin;
     #condm007@#1003;
     4;
     nTipo, #condm005@#3, 001, "S";
     nTipo, #condm005@#3, 999, "S";
     be;
     NULL, DepoLin;
|FIN;

|PROCESO ActuDepo;
     nImp = (#condm005@#5 * 100 / nTotaDepo) * nImpAmortiza / 100;
     #condm005@#6 = #condm005@#6 + nImp;
     #condm005@#7 = #condm005@#5 - #condm005@#6;
     |GRABA 020#condm005@.a;

     |BUCLE DepoLin;
|FPRC;

|DEFBUCLE ActuDepo;
     #condm005@#1002;
     2;
     #10#3, 001, nTipo;
     #10#3, 999, nTipo;
     be;
     NULL, ActuDepo;
|FIN;

|PROCESO TotaDepo;
     nTotaDepo = nTotaDepo + #condm005@#5;
|FPRC;

|DEFBUCLE TotaDepo;
     #condm005@#1002;
     2;
     #10#3, 001, nTipo;
     #10#3, 999, nTipo;
     ;
     NULL, TotaDepo;
|FIN;

|PROCESO LinAlbaran;
     |SI aEsGesisat = "S";
          |HAZ GesiLeeMaqui;
          #gesim002@#0 = aMaqui;
          |LEE 000#gesim002@.=;
          |SI FSalida = 0; |ACABA; |FINSI;
     |FINSI;

     |SI #71#6 ! 0;
          #19#0 = #71#2;
          |LEE 000#19=;
          |SI FSalida ! 0; |DDEFECTO #19; |FINSI;

          #condm003@#0 = #10#3;
          |LEE 101#condm003@.=;
          |SI FSalida = 0;
               #condm004@#0 = #10#3;
               #condm004@#1 = #71#2;
               |LEE 101#condm004@.=;
               |SI FSalida = 0;
                    #condm003@#5 = 0;
                    |PARA i = 5; |SI i [ 11; |HACIENDO i = i + 1;
                         nImpAmortiza = (#71#5 * #condm004@#i# * nForma);
                         #condm003@#4 = #condm003@#4 + nImpAmortiza;

                         nCampo = (i - 5) * 4 + 11;
                         nPdte = nCampo + 1;
                         nDepo = nCampo - 1;
                         #condm003@#nCampo# = #condm003@#nCampo# + nImpAmortiza;
                         #condm003@#nPdte# = #condm003@#nDepo# - #condm003@#nCampo#;
                         #condm003@#5 = #condm003@#5 + #condm003@#nPdte#

                         #condm004@#16 = #condm004@#16 + nImpAmortiza;

                         |SI nImpAmortiza ! 0;
                              nTipo = i - 4;
                              nTotaDepo = 0;
                              |BUCLE TotaDepo;
                              |BUCLE ActuDepo;
                         |FINSI;
                    |SIGUE;

                    nImpAmortiza = (#71#5 * #condm004@#12 * nForma);
                    #condm003@#40 = #condm003@#40 + nImpAmortiza;
                    #condm003@#41 = #condm003@#39 - #condm003@#40;

                    |SI nSwSat = 1;
                         nImpAmortiza = (#71#5 * #condm004@#12 * nForma);
                         |SI nImpAmortiza ! 0;
                              aTipoHis = "S";
                              nImp = nImpAmortiza;
                              |HAZ GraHisto;
                         |FINSI;
                    |FINSI;

                    #condm004@#4 = #19#133;
                    #condm004@#13 = #71#5;
                    #condm004@#14 = #condm004@#14 + (#71#5 * nForma);
                    #condm004@#15 = #condm004@#15 + (#condm004@#4 * #condm004@#13 * nForma);
                    #condm004@#17 = (#condm004@#14 * #condm004@#3) - #condm004@#15 - #condm004@#16;
                    |GRABA 020#condm004@.a;
                    |LIBERA #condm004@;

                    #condm003@#7 = #condm003@#7 + (#71#5 * nForma);
               |FINSI;
               |GRABA 020#condm003@.a;
               |LIBERA #condm003@;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE Albaran;
     #10#1;
     ;
     aSer, nNum;
     aSer, nNum;
     ;
     NULL, NULL, LinAlbaran;
|FIN;

|PROCESO ActCliente;
     aAlfa = aBase + "condepo/def/condm003";
     |CARGA_DEF aAlfa, condm003@;
     |SI FSalida = 0;
          aAlfa = aBase + "condepo/def/condm004";
          |CARGA_DEF aAlfa, condm004@;
          |SI FSalida = 0;
               aAlfa = aBase + "condepo/def/condm005";
               |CARGA_DEF aAlfa, condm005@;
               |SI FSalida = 0;
                    aAlfa = aBase + "condepo/def/condm006";
                    |CARGA_DEF aAlfa, condm006@;
                    |SI FSalida = 0;
                         aAlfa = aBase + "condepo/def/condm007";
                         |CARGA_DEF aAlfa, condm007@;
                         |SI FSalida = 0;
                              aAlfa = aBase + "condepo/def/condm008";
                              |CARGA_DEF aAlfa, condm008@;
                              |SI FSalida = 0;
                                   |SI nSwSat = 1;
                                        aAlfa = aBase + "condepo/fich/" + aEmpSat + "/";
                                   |SINO;
                                        aAlfa = aBase + "condepo/fich/" + aEmpBase + "/";
                                   |FINSI;
                                   |PATH_DAT #condm003@#aAlfa#;
                                   |PATH_DAT #condm004@#aAlfa#;
                                   |PATH_DAT #condm005@#aAlfa#;
                                   |PATH_DAT #condm006@#aAlfa#;
                                   |PATH_DAT #condm007@#aAlfa#;
                                   |PATH_DAT #condm008@#aAlfa#;
                                   |ABRE #condm003@;
                                   |ABRE #condm004@;
                                   |ABRE #condm005@;
                                   |ABRE #condm006@;
                                   |ABRE #condm007@;
                                   |ABRE #condm008@;
                                   nNum = aNum;
                                   |ABRE #19;
                                   |BUCLE Albaran;
                                   |CIERRA #19;
                                   |CIERRA #condm008@;
                                   |CIERRA #condm007@;
                                   |CIERRA #condm006@;
                                   |CIERRA #condm005@;
                                   |CIERRA #condm004@;
                                   |CIERRA #condm003@;
                                   |DESCARGA_DEF #condm008@;
                              |SINO;
                                   |MENAV "0000Error al cargar 'condm008'...";
                              |FINSI;
                              |DESCARGA_DEF #condm007@;
                         |SINO;
                              |MENAV "0000Error al cargar 'condm007'...";
                         |FINSI;
                         |DESCARGA_DEF #condm006@;
                    |SINO;
                         |MENAV "0000Error al cargar 'condm006'...";
                    |FINSI;
                    |DESCARGA_DEF #condm005@;
               |SINO;
                    |MENAV "0000Error al cargar 'condm005'...";
               |FINSI;
               |DESCARGA_DEF #condm004@;
          |SINO;
               |MENAV "0000Error al cargar 'condm004'...";
          |FINSI;
          |DESCARGA_DEF #condm003@;
     |SINO;
          |MENAV "0000Error al cargar 'condm003'...";
     |FINSI;
|FPRC;

|PROCESO ActPreCoste;
     #condm004@#4 = aPre;
     |GRABA 020#condm004@.a;
|FPRC;

|DEFBUCLE ActPreCoste;
     #condm004@#2002;
     ;
     aArt, "      ";
     aArt, "zzzzzz";
     ;
     NULL, ActPreCoste;
|FIN;

|PROCESO ActUltPre;
     aAlfa = aBase + "condepo/def/condm004";
     |CARGA_DEF aAlfa, condm004@;
     |SI FSalida = 0;
          aAlfa = aBase + "condepo/fich/" + aEmpBase + "/";
          |PATH_DAT #condm004@#aAlfa#;
          |BUCLE ActPreCoste;
          |DESCARGA_DEF #condm004@;
     |SINO;
          |MENAV "0000Error al cargar 'condm004'";
     |FINSI;
|FPRC;

|PROCESO CheqFam;
     enError = 0;
     |ABRE #19;
     #19#0 = aArt;
     |LEE 020#19=;
     |CIERRA #19;

     aAlfa = aBase + "condepo/def/condm002";
     |CARGA_DEF aAlfa, condm002@;
     |SI FSalida = 0;
          aAlfa = aBase + "condepo/def/condm004";
          |CARGA_DEF aAlfa, condm004@;
          |SI FSalida = 0;
               aAlfa = aBase + "condepo/fich/" + aEmpBase + "/";
               |PATH_DAT #condm002@#aAlfa#;
               |PATH_DAT #condm004@#aAlfa#;
               |ABRE #condm002@;
               #condm002@#0 = #19#2;
               |LEE 000#condm002@.=;
               |SI FSalida = 0;
                    |ABRE #condm004@;
                    #condm004@#0 = aCli;
                    #condm004@#1 = aArt;
                    |LEE 000#condm004@.=;
                    |SI FSalida ! 0;
                         |SI #condm002@#2 = "N";
                         |FINSI;
                         |SI #condm002@#2 = "A";
                              |MENAV "0000Este producto no se puede vender a este cliente...";
                         |FINSI;
                         |SI #condm002@#2 = "X";
                              |MENAV "0000Este producto no se puede vender a este cliente...";
                              enError = 1;
                         |FINSI;
                    |FINSI;
                    |CIERRA #condm004@;
               |FINSI;
               |CIERRA #condm002@;
               |DESCARGA_DEF #condm004@;
          |FINSI;
          |DESCARGA_DEF #condm002@;
     |SINO;
          |MENAV "0000Error al cargar 'condm002'";
     |FINSI;
|FPRC;

|PROCESO EsEmpresa;
     aEsEmpBase = "N";
     aEsEmpMaq = "N";
     aEsEmpSat = "N";
     aAlfa = aBase + "condepo/def/condm000";
     |CARGA_DEF aAlfa, condm000@;
     |SI FSalida = 0;
          aAlfa = aBase + "condepo/def/condm001";
          |CARGA_DEF aAlfa, condm001@;
          |SI FSalida = 0;
               aAlfa = aBase + "condepo/fich/";
               |PATH_DAT #condm000@#aAlfa#;
               |ABRE #condm000@;
               |LEE 000#condm000@.p;
               |PARA; |SI FSalida = 0; |HACIENDO;
                    aAlfa = aBase + "condepo/fich/" + (("00000" + #condm000@#0) % -105) + "/";
                    |PATH_DAT #condm001@#aAlfa#;
                    |ABRE #condm001@;
                    |LEE 0000#condm001@.p;
                    |SI FSalida = 0;
                         |SI #condm001@#1 = aEmpGes;
                                   |O #condm001@#8 = aEmpGes;
                                   |O #condm001@#9 = aEmpGes;
                                   |O #condm001@#10 = aEmpGes;
                              aEsEmpBase = "S";
                              aEmpBase = ("00000" + #condm000@#0) % -105;
                              aEmpCarte = ("00000" + #condm001@#4) % -105;
                         |FINSI;
                         |SI #condm001@#2 = aEmpGes;
                              aEsEmpMaq = "S";
                              aEmpMaq = ("00000" + #condm000@#0) % -105;
                              aEmpCarte = ("00000" + #condm001@#4) % -105;
                         |FINSI;
                         |SI #condm001@#3 = aEmpGes;
                              aEsEmpSat = "S";
                              aEmpSat = ("00000" + #condm000@#0) % -105;
                              aEmpCarte = ("00000" + #condm001@#4) % -105;
                         |FINSI;
                    |FINSI;
                    |CIERRA #condm001@;
                    |LEE 000#condm000@.s;
               |SIGUE;
               |CIERRA #condm000@;
               |DESCARGA_DEF #condm001@;
          |SINO;
               |MENAV "0000Error al cargar 'condm001'";
          |FINSI;
          |DESCARGA_DEF #condm000@;
     |SINO;
          |MENAV "0000Error al cargar 'condm000'";
     |FINSI;
|FPRC;

|PROCESO Es_Gesisat;
     |DDEF aAlfa;
     aAlfa = aAlfa + "gesim001.mas";
     |XABRE "E", aAlfa, 0;
|FPRC;

|PROCESO EsCondepo;
     aAlfa = aBase + "condepo/def/condm000.mas";
     |XABRE "E", aAlfa, 0;
|FPRC;

|PROGRAMA;
     |DBASS aBase;
     |HAZ EsCondepo;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |HAZ Es_Gesisat;    || Este incluye a los 2 modulos
     |SI FSalida = 0;
          nSwGesisat = 0;
          nSwJamaica = 1;
     |SINO;
          nSwGesisat = 1;
          nSwJamaica = 0;
     |FINSI;

     enError = 0;
     aParam = PARAMETRO;
     |DFICE aEmpGes; aEmpGes = aEmpGes % -205;

     aAlfa = aParam % 107;
     ||--------------------------Jamaica 001901
     |SI nSwJamaica = 0;
          |SI aAlfa = "CHEQFAM";
               aArt = aParam % 820;
               aCli = aParam % 2806;
               |HAZ EsEmpresa;
               |SI aEsEmpBase = "S";
                    |HAZ CheqFam;
               |FINSI;
          |FINSI;
          |SI aAlfa = "COBRASI";
               aSer = aParam % 805;
               aNum = aParam % 13;
               nForma = 1;
               |HAZ EsEmpresa;
               |SI aEsEmpBase = "S"; |Y aEmpBase ! aEmpSat;
                    |HAZ ActCliente;
               |FINSI;
               |SI aEsEmpSat = "S";
                    nSwSat = 1;
                    |HAZ ActCliente;
               |FINSI;
          |FINSI;
          |SI aAlfa = "COBRANO";
               aSer = aParam % 805;
               aNum = aParam % 13;
               nForma = -1;
               |HAZ EsEmpresa;
               |SI aEsEmpBase = "S"; |Y aEmpBase ! aEmpSat;
                    |HAZ ActCliente;
               |FINSI;
               |SI aEsEmpSat = "S";
                    nSwSat = 1;
                    |HAZ ActCliente;
               |FINSI;
          |FINSI;
          |SI aAlfa = "ULTIPRE";|| !!! No entra nunca esta comentado en el dsz99948
               aArt = aParam % 820;
               aPre = aParam % 28;
               |HAZ EsEmpresa;
               |SI aEsEmpBase = "S";
                    |HAZ ActUltPre;
               |FINSI;
          |FINSI;
          |SI aAlfa = "ALBABOR";
               aSer = aParam % 805;
               aNum = aParam % 1306;
               |HAZ BorraAlbCob;
          |FINSI;
          |SI aAlfa = "ALBASAT";
               aSer = aParam % 805;
               aNum = aParam % 1306;
               aCli = aParam % 1906;
               aFec = aParam % 2510; fFec = aFec;
               aImp = aParam % 35;
               nForma = enForma;
               |HAZ EsEmpresa;
               |SI aEsEmpSat = "S";
                    |HAZ ActCliSat;
               |FINSI;
          |FINSI;
          |SI aAlfa = "EMPRSAT";
               |HAZ EsEmpresa;
               |SI aEsEmpSat = "S";
                    enError = 1;
                    |HAZ CheExisteCli;
               |SINO;
                    enError = 0;
               |FINSI;
          |FINSI;
          |SI aAlfa = "CHEQMAQ";
               |HAZ EsEmpresa;
               |SI aEsEmpSat = "S";
                    |HAZ CheqMaquina;
               |FINSI;
          |FINSI;
          |SI aAlfa = "GRIDMAQ";
               |HAZ EsEmpresa;
               |SI aEsEmpSat = "S";
                    |HAZ EligeMaquina;
               |FINSI;
          |FINSI;
          |SI aAlfa = "ALTAART";
               |HAZ EsEmpresa;
               |SI aEsEmpMaq = "S";
                    |HAZ AltaCtrDepo;
               |FINSI;
          |FINSI;
          |SI aAlfa = "ALBAUTO";
               aSer = aParam % 805;
               aNum = aParam % 1306;
               |HAZ EsEmpresa;
               |SI aEsEmpMaq = "S";
                    |HAZ AltaCtrCli;
               |FINSI;
          |FINSI;
     |FINSI;
     ||--------------------------Gesisat 004760
     |SI nSwGesisat = 0;
          |SI aAlfa = "CGESISI";
               aSer = aParam % 805;
               aNum = aParam % 13;
               nForma = 1;
               |HAZ EsEmpresa;
               |SI aEsEmpBase = "S"; |Y aEmpBase ! aEmpSat;
                    |HAZ ActCliGesi;
               |FINSI;
               |SI aEsEmpSat = "S";
                    nSwSat = 1;
                    |HAZ ActCliGesi;
               |FINSI;
          |FINSI;
          |SI aAlfa = "CGESINO";
               aSer = aParam % 805;
               aNum = aParam % 13;
               nForma = -1;
               |HAZ EsEmpresa;
               |SI aEsEmpBase = "S"; |Y aEmpBase ! aEmpSat;
                    |HAZ ActCliGesi;
               |FINSI;
               |SI aEsEmpSat = "S";
                    nSwSat = 1;
                    |HAZ ActCliGesi;
               |FINSI;
          |FINSI;
          |SI aAlfa = "GESISAT";
               aSer = aParam % 805;
               aNum = aParam % 1306;
               aCli = aParam % 1906;
               aFec = aParam % 2510; fFec = aFec;
               nForma = enForma;
               |HAZ EsEmpresa;
               |SI aEsEmpSat = "S"; |O aEsEmpBase = "S";
                    |HAZ ActGesiSat;
               |FINSI;
          |FINSI;
          |SI aAlfa = "GESIBOR";
               aSer = aParam % 805;
               aNum = aParam % 1306;
               |HAZ BorraAlbCob;
          |FINSI;
          |SI aAlfa = "GESAUTO";
               aSer = aParam % 805;
               aNum = aParam % 1306;
               |HAZ EsEmpresa;
               |SI aEsEmpMaq = "S";
                    |HAZ AltaCtrCli;
               |FINSI;
          |FINSI;
          |SI aAlfa = "GESIART";
               |HAZ EsEmpresa;
               |SI aEsEmpMaq = "S";
                    |HAZ AltaCtrDepoGesi;
               |FINSI;
          |FINSI;
     |FINSI;
     ||-------------------------- Llamadas desde "condepo"
     |SI aAlfa = "DIVISAS";
          aAlfa = aParam % 803; aDivisa = aAlfa;
          aAlfa = aParam % 1101; aMoneda = aAlfa;;
          aEmp = aParam % 1205;
          |DFICE aAlfa;
          aAlfa = aAlfa + aEmp + "/";
          |PATH_DAT #10 aAlfa;
          |PATH_DAT #321 aAlfa;
          |PATH_DAT #324 aAlfa;
          |HAZ Divisas010;
     |FINSI;
     |SI aAlfa = "IVACLIE";
          aAlfa = aParam % 806; eaCli = aAlfa;
          aAlfa = aParam % 1410; efFiva = aAlfa;
          aAlfa = aParam % 2401; enTiva = aAlfa;
          aEmp = aParam % 2505;
          |DFICE aAlfa;
          aAlfa = aAlfa + aEmp + "/";
          |PATH_DAT #66 aAlfa;
          |PATH_DAT #112 aAlfa;
          |PATH_DAT #113 aAlfa;
          |HAZ IVACli;
     |FINSI;
|FPRO;
