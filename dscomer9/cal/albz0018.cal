|FICHEROS;
     albz0018 #0;
     albw0030 #30;
     dsm00024 #24;
|FIN;

|VARIABLES;
     &Tempo = "";
     nExiste = 0;
     aMensaje = "";
     aRespuesta = "";
     aInforme = "";
     nSwPie = 0;
     aAux = "";
     &enAlberoDentro = 0; || sirve para evitar reentradas
|FIN;

|PROGRAMA;
     |CLS;
     |ABRE #0;
     |DDEFECTO #0;
     |LEE 101#0p;
     nExiste = FSalida;
     |PINPA #0#0;
     |PINDA #0#0;
     |ENDATOS #1#0;
     |SI FSalida = 0;
          aRespuesta = #albz0018#1;
          #albz0018#1 = "NO";
          |SI nExiste = 0;
               |GRABA 020#0a;
          |SINO;
               |GRABA 020#0n;
          |FINSI;
          |SI aRespuesta = "SI";
               |HAZ Principal;
          |FINSI;
     |FINSI;
     |LIBERA #0;
     |CIERRA #0;
|FPRO;

|PROCESO dsm00024;
     |DDEFECTO #albw0030;
     #albw0030#0 = #dsm00024#1;
     #albw0030#1 = #dsm00024#2;
     |LEE 101#albw0030.=;
     |SI FSalida ! 0; |GRABA 020#albw0030.b; |FINSI;
     #albw0030#2 = #albw0030#2 + 1;

     aAux = #dsm00024#0;
     |QBF aAux;
     |SI aAux = "";
          #albw0030#3 = #albw0030#3 + 1;
     |SINO;
          |SI #dsm00024#9 = 0; |Y #dsm00024#10 = 0; |Y #dsm00024#11 = 0; |Y #dsm00024#12 = 0;
               #albw0030#3 = #albw0030#3 + 1;
          |FINSI;
     |FINSI;
     #albw0030#4 = #albw0030#2 - #albw0030#3;
     |GRABA 020#albw0030.a;
     |LIBERA #albw0030;
|FPRC;

|DEFBUCLE dsm00024;
 #dsm00024#1;
 ;
 INICIO;
 FINAL;
 ;
 NULL, dsm00024;
|FIN;

|PROCESO dsm00024_borra;
     aAux = #dsm00024#0;
     |QBF aAux;
     |SI aAux = "";
          enAlberoDentro = 1;
          |BORRA 020#dsm00024.a;
          enAlberoDentro = 0;
     |SINO;
          |SI #dsm00024#9 = 0; |Y #dsm00024#10 = 0; |Y #dsm00024#11 = 0; |Y #dsm00024#12 = 0;
               enAlberoDentro = 1;
               |BORRA 020#dsm00024.a;
               enAlberoDentro = 0;
          |FINSI;
     |FINSI;
     |LIBERA #dsm00024;
|FPRC;

|DEFBUCLE dsm00024_borra;
 #dsm00024#1;
 ;
 "                    ", #albw0030#0, #albw0030#1;
 "zzzzzzzzzzzzzzzzzzzz", #albw0030#0, #albw0030#1;
 be;
 NULL, dsm00024_borra;
|FIN;

|PROCESO albw0030;
     |PRINT;
     nSwPie = 1;
     |SI #albw0030#4 = 1; |Y #albw0030#3 > 0;
          |BUCLE dsm00024_borra;
     |FINSI;
|FPRC;

|DEFBUCLE albw0030;
 #albw0030#1;
 ;
 INICIO;
 FINAL;
 ;
 NULL, albw0030;
|FIN;

|PROCESO Principal;
     |IMPRE 0;
     |SI FSalida = 0;
          aInforme = "albz0018";
          |INFOR aInforme;
          |SI FSalida = 0;
               |HAZ CreaTempo;
               |NOME_DAT #albw0030#Tempo#; |DELINDEX #albw0030;
               |ABRE #albw0030;
               |BUCLE dsm00024;
               |CIERRA #albw0030;
               |BUCLE albw0030;
               |SI nSwPie = 1;
                    |PIEINF;
               |FINSI;
               |FININF;
               |HAZ BoraTempo; |DELINDEX #albw0030;
          |SINO;
               aMensaje = "0000Informe " + aInforme + " inaccesible.";
               |MENAV aMensaje;
          |FINSI;
          |FINIMP;
     |SINO;
          |MENAV "0000Proceso cancelado.";
     |FINSI;
|FPRC;
