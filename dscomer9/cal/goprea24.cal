  RecalEscan


|FICHEROS;
     gopre024 #0;   || escandallo cabs.
     gopre025 #1;   || escandallo lins.
     agifa019 #2;   || articulos
     agifa017 #3;   || almacenes
     agifa142 #142;
     dsm00241 #241;
     dsm00238 #238;
     gopre024@ #480;
     referen@;
|FIN;

|VARIABLES;
     nCampo = 0;
     nImpo = 0;
     nUni = 0;
     nAlma = 0;
     nModo = 0;
     nUnidad = 0;
     nNume1        = 0;
     nNume2        = 0;
     nNume         = 0;
     impcompone = 0;
|FIN;

|PROCESO xLeeConverUni;
     |ABRE #2;
     #2#0 = #1#2;
     |LEE 000#2=;
     |CIERRA #2;

     |ABRE #3;
     #3#0 = #1#2;
     #3#1 = #1#9;
     |LEE 000#3=;
     |CIERRA #3;

     |DDEFECTO #241;
     |SI #2#204 = "S";
          |ABRE #241; |SELECT #2#241;
          #241#0 = #2#5;
          #241#2 = #1#14;
          |LEE 000#241=;
          |CIERRA #241;
     |FINSI;
|FPRC;

|PROCESO xConverUni;
     |HAZ xLeeConverUni;

     |SI #241#6 = "D";
          nNume1 = #1#12 * #241#5;
          nNume2 = #1#15 / #241#5;
          #1#4 = nNume1;
          #1#5 = nNume2;
     |SINO;
          nNume1 = #1#12 / #241#5;
          nNume2 = #1#15 * #241#5;
          #1#4 = nNume1;
          #1#5 = nNume2;
     |FINSI;
|FPRC;

|PROCESO xtotliesc;
     |HAZ xConverUni;

     nUni = #1#4;
     |ABRE #2;
     #2#0 = #1#2;
     |LEE 000#2=;
     |SI #2#179 = "S"; |Y FSalida = 0;  ||Doble stock
          |ABRE #238;
          #238#0 = #2#201;
          |LEE 000#238=;
          |SI FSalida = 0; |Y #238#6 = 2;    || Factura uni2
               nUni = #1#17;
          |FINSI;
          |CIERRA #238;
     |FINSI;
     |CIERRA #2;
     |SI #0#33 ! "K"; nUni = #1#4; |FINSI;

     |SI #1#16 = "D";
          nImpo = (nUni * #1#5) > #1#13;
     |SINO;
          nImpo = (nUni * #1#5) / ((100 - #1#13) / 100);
     |FINSI;
     #1#6 = nImpo;
|FPRC;

|PROCESO RecalEscan;
     |HAZ xtotliesc;

     |HAZ xConverUni;

     impcompone = #1#6 / #0#6;
     |SI #1#10 = 1; #0#8 = #0#8 + impcompone;    |FINSI;   ||Componentes
     |SI #1#10 = 2; #0#2 = #0#2 + impcompone;    |FINSI;   ||Mano Obra
     |SI #1#10 = 3; #0#3 = #0#3 + impcompone;    |FINSI;   ||Maquinaria
     |SI #1#10 = 4; #0#4 = #0#4 + impcompone;    |FINSI;   ||Otros

     |SI #1#10 = 1;
         |SI #0#17 = "S";
             |SI #0#26 = "D";
                 #0#21 = #0#21 + (#1#6 > #0#16);
             |SINO;
                 #0#21 = #0#21 + (#1#6 / ((100 - #0#16) / 100));
             |FINSI;
         |SINO;
             #0#21 = #0#21 + #1#6;
         |FINSI;
     |FINSI;

     |SI #1#10 = 2;
         |SI #0#19 = "S";
             |SI #0#28 = "D";
                 #0#21 = #0#21 + (#1#6 > #0#24);
             |SINO;
                 #0#21 = #0#21 + (#1#6 / ((100 - #0#24) / 100));
             |FINSI;
         |SINO;
             #0#21 = #0#21 + #1#6;
         |FINSI;
     |FINSI;

     |SI #1#10 = 3;
         |SI #0#18 = "S";
             |SI #0#27 = "D";
                 #0#21 = #0#21 + (#1#6 > #0#23);
             |SINO;
                 #0#21 = #0#21 + (#1#6 / ((100 - #0#23) / 100));
             |FINSI;
         |SINO;
             #0#21 = #0#21 + #1#6;
         |FINSI;
     |FINSI;

     |SI #1#10 = 4;
         |SI #0#20 = "S";
             |SI #0#29 = "D";
                 #0#21 = #0#21 + (#1#6 > #0#25);
             |SINO;
                 #0#21 = #0#21 + (#1#6 / ((100 - #0#25) / 100));
             |FINSI;
         |SINO;
             #0#21 = #0#21 + #1#6;
         |FINSI;
     |FINSI;

     #0#5 = #0#2 + #0#3 + #0#4;         || total otros costes
     #0#11 = (#0#5 + #0#8) > #0#7;      || total serie
     #0#11 = #0#11 > #0#34;
     #0#9 = #0#11 / #0#12;              || total unitario
     |PINDA #0#0;
|FPRC;
