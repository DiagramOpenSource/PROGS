|FICHEROS;
     dsm00231 #0
     dsm00214 #1
|FIN;

|VARIABLES;
     ip_serv = "";
     serv_correo = "";
     us = "";
     pass = "";
     &path = "";
     ficheros = "";
     asystem = "";
     from = "";
     to = "";
     subject = "";
     mensaje = "";
     ficheros2 = "";
     mensaj = "";
     sal = 0;
     pos = 0;
     car = "";
     dele = "";
     del = 0;
     num = 0;
     reg = 0;
     almenosuno = 0;
     master = "";
     fich = "";
     nDSCorreoSal = 0;
     aAlfa1 = "";
|FIN;

|PROGRAMA;
     |ABRE #1;
     |LEE 000#1p;
     |SI FSalida ! 0;
          |MENAV "0000No se han establecido los parametros de recepcion";
     |SINO;
          |SI #1#19 = "F";
               ip_serv = #1#18;  |QBF ip_serv;
          |SINO;
               |SI #1#19 = "L";   |IP_REMOTO ip_serv;    |FINSI;
               |SI #1#19 = "S";   |IP_LOCAL ip_serv;     |FINSI;
          |FINSI;

          serv_correo = #1#11;
          us          = #1#12;
          pass        = #1#13;
          ficheros    = "";
          |QBT ip_serv;
          |QBF serv_correo;
          |QBF us;
          |QBF pass;
          |QBF path;
          |QBF ficheros;
          |MENSA "0000Recibiendo mensajes ..."
          almenosuno = 0;
          nDSCorreoSal = 0;
          |PARA; |SI nDSCorreoSal = 0; |HACIENDO;
               |DSCORREO_RECIBE ip_serv,serv_correo,us,pass,path,ficheros;
               nDSCorreoSal = FSalida;
               |SI nDSCorreoSal = 0;|Y ficheros = "";
                    nDSCorreoSal = -1;       || no hay correo
               |FINSI;
               |SI nDSCorreoSal = 0;
                    |QUE_SISTEMA asystem;
                    |SI asystem = "ESBSD";
                         asystem = "chmod 777 " + ficheros;
                         |SYSTEM asystem;
                    |FINSI;
                    almenosuno = almenosuno + 1;
               |FINSI;
          |SIGUE;
          |SI almenosuno = 0;
               |MENAV "0000No hay correo.";
          |SINO;
               aAlfa1 = "0000Recibidos [" + almenosuno + "] correos.";
               |MENAV aAlfa1;
          |FINSI;
     |FINSI;
     |CIERRA #1;
|FPRO;
