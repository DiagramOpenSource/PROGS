     TotalLin49

|FICHEROS;
     agifa048 #0;
     agifa049 #1;
     agifa019 #2
     agifa017 #3;
     dsm00241 #241;
     dsm00238 #238;
|FIN;

|VARIABLES;
     nUni = 0;
     nImpo = 0;
     nImpo2 = 0;
     nNume1 = 0;
     nNume2 = 0;
|FIN;

|PROCESO ConverUniOrts;
     |HAZ LeeConverUniOrts;

     |SI #241#6 = "D";
          nNume1 = #1#12 * #241#5;
          nNume2 = #1#15 / #241#5;
          #1#4 = nNume1;
          #1#5 = nNume2;
     |SINO;
          nNume1 = #1#12 / #241#5;
          #1#4 = nNume1;
          #1#5 = nNume2;
     |FINSI;
|FPRC;

|PROCESO LeeConverUniOrts;
     |ABRE #2;
     #2#0 = #1#2;
     |LEE 000#2=;
     |CIERRA #2;

     |ABRE #3;
     #3#0 = #1#2;
     #3#1 = #1#9;
     |LEE 000#3=;
     |CIERRA #3;

     |DDEFECTO #241;
     |SI #2#204 = "S";
          |ABRE #241; |SELECT #2#241;
          #241#0 = #2#5;
          #241#2 = #1#14;
          |LEE 000#241=;
          |CIERRA #241;
     |FINSI;
|FPRC;

|PROCESO TotalLin49;
     |HAZ ConverUniOrts;

     nUni = #1#4;
     |ABRE #2;
     #2#0 = #1#2;
     |LEE 000#2=;
     |SI #2#179 = "S"; |Y FSalida = 0;  ||Doble stock
          |ABRE #238;
          #238#0 = #2#201;
          |LEE 000#238=;
          |SI FSalida = 0; |Y #238#6 = 2;    || Factura uni2
               nUni = #1#17;
          |FINSI;
          |CIERRA #238;
     |FINSI;
     |CIERRA #2;
     |SI #0#33 ! "K"; nUni = #1#4; |FINSI;

     |SI #0#36 = "S";
          |SI #1#16 = "D";
               nImpo = (nUni * #1#5) > #1#13;
          |SINO;
               nImpo = (nUni * #1#5) / ((100 - #1#13) / 100);
          |FINSI;
          nImpo = nImpo > #1#21;
     |SINO;
          |SI #1#16 = "D";
               nImpo = (nUni * #1#5) > #1#13;
          |SINO;
               nImpo = (nUni * #1#5) / ((100 - #1#13) / 100);
          |FINSI;
          nImpo = nImpo - (nUni * #1#5);
          nImpo2 = (nUni * #1#5) % #1#21;
          nImpo = (nUni * #1#5) + nImpo + nImpo2;
     |FINSI;
     #1#6 = nImpo;
|FPRC;
