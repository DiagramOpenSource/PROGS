|FICHEROS;
     guerm045 #0;
     goparame #1;
     gomaw004 #2;
     gomaw005 #3,MANTE;
     gomantho #10;
     gomantl1 #11;
     agifa019 #19;
     guerw039 #39; ||Tmp Expe
     goprepec #60;
     goprepel #61;
     agifa067 #67;
     agifa077 #77;
     agifa080 #80;
|FIN;

|VARIABLES;
     &aDivisa = "";
     &aMoneda = "";

     &enPrepe = 0;
     &enAlmaObra = 0;
     &eaSerPreSal = "";
     &enNumPreSal = 0;
     &eaSerExpSal = "";
     &enNumExpSal = 0;
     &enError = 0;

     nHayPre = 0;
     nNumPre = 0;
     nNumExp = 0;
     aSerPre = "";
     aSerExp = "";
     nConta = 0;
     nAlma = 0;
     aAlfa = "";
     aArticulo = "";
     nPrecio = 0;
     nDto1 = 0;
     nDto2 = 0;
     aSerAlbPre = "";
     nNumAlbPre = 0;
     nLinAlbPre = 0;
     aSerPed = "";
     nNumPed = 0;
     aSerAlb = "";
     nNumAlb = 0;
|FIN;

|PROCESO Borra0;
     |BORRA 020#0a;
|FPRC;

|DEFBUCLE Borra0;
     #0#1;
     ;
     #2#3, #2#4, 000;
     #2#3, #2#4, 999;
     ;
     NULL, Borra0;
|FIN;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO BuscaPresu;
     |SI nNumPre = 0; |Y #11#10 = "C";
          aSerPre = #11#3;
          nNumPre = #11#4;
     |FINSI;
|FPRC;

|PROCESO BuscaExped;
     |SI #10#0 = #1#109; |Y #10#1 = #1#114;
          || No es expediente fabricacion
     |SINO;
          nNumPre = 0;
          aSerExp = #10#0;
          nNumExp = #10#1;

          nConta = nConta + 1;
          #39#0 = #10#0;
          #39#1 = #10#1;
          #39#2 = #10#29;
          |GRABA 020#39n;
     |FINSI;
|FPRC

|DEFBUCLE BuscaExped;
     #10#1;
     9, 11;
     "     ", 000001, "C", nAlma;
     "zzzzz", 999999, "C", nAlma;
     ;
     NULL, BuscaExped, BuscaPresu;
|FIN;

|DEFBUCLE BuscaPresu;
     #11#1;
     ;
     aSerExp, nNumExp, 001;
     aSerExp, nNumExp, 999;
     ;
     NULL, BuscaPresu;
|FIN;

|PROCESO BuscaExSal;
     |ABRE #1; |LEE 000#1p; |CIERRA #1;

     aAlfa = Usuario;
     |NOME_DAT #39 aAlfa;
     |DELINDEX #39; |ABRE #39;

     nConta = 0;
     nNumExp = 0;
     nNumPre = 0;
     nAlma = enAlmaObra;
     |BUCLE BuscaExped;
     |SI nNumPre = 0; |O nNumExp = 0;
          aAlfa = "0000No existe expediente en curso del almacen:" + nAlma;
          |MENAV aAlfa;
          enError = 1;
     |FINSI;
     |SI nConta > 1;
          nNumExp = 0;
          |LEE 000#39p;
          |CONSULTA_CLAVE #1#39;
          |SI FSalida = 0;
               aSerExp = #39#0;
               nNumExp = #39#1;
          |FINSI;
     |FINSI;
     |SI nNumExp = 0;
          enError = 1;
     |SINO;
          |SI nConta > 1; nNumPre = 0; |BUCLE BuscaPresu; |FINSI;
     |FINSI;
     |CIERRA #39;
     |DELINDEX #39;
     eaSerPreSal = aSerPre;
     enNumPreSal = nNumPre;
     eaSerExpSal = aSerExp;
     enNumExpSal = nNumExp;
     |BUCLE Borra0;
|FPRC;

|PROCESO BuscaExSal2;
     nAlma = enAlmaObra;
     aSerExp = "";
     nNumExp = 0;
     aSerPre = "";
     nNumPre = 0;
     || Busca almacen central (=compras) en expedientes
     |ABRE #10;
     |ABRE #11;
     |LEE 000#10p;
     |PARA; |SI FSalida = 0; |HACIENDO;
          |SI #10#11 = nAlma;
               aSerExp = #10#0;
               nNumExp = #10#1;
               #11#0 = #10#0;
               #11#1 = #10#1;
               #11#2 = 0;
               |LEE 000#11];
               |SI FSalida = 0; |Y #11#0 = #10#0; |Y #11#1 = #10#1;
                    aSerPre = #11#3;
                    nNumPre = #11#4;
               |FINSI;
               |SAL;
          |FINSI;
          |LEE 000#10s;
     |SIGUE;
     |CIERRA #11;
     |CIERRA #10;

     |SI nNumPre = 0; |O nNumExp = 0;
          aAlfa = "0000No existe expediente en curso del almacen:" + nAlma;
          |MENAV aAlfa;
          enError = 1;
     |FINSI;
     eaSerPreSal = aSerPre;
     enNumPreSal = nNumPre;
     eaSerExpSal = aSerExp;
     enNumExpSal = nNumExp;
     |BUCLE Borra0;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO agifa080;
     nConta = nConta + 1;
     |SI aArticulo = #80#2;
          #77#50 = #80#27;
          #77#0 = #80#0;
          |LEE 020#77=;
          aDivisa = #agifa077#56;
          aMoneda = #agifa077#58;
          |HAZ Divisas077;

          nPrecio = #80#30;
          nDto1 = #80#8;
          nDto1 = #80#26;
          aSerAlbPre = #80#27;
          nNumAlbPre = #80#0;
          nLinAlbPre = #80#1;
          enError = 0;
          |ERROR10;
     |FINSI;
|FPRC;

|DEFBUCLE agifa080;
     #80#3;
     ;
     aSerPed, nNumPed, 001;
     aSerPed, nNumPed, 999;
     ;
     NULL, agifa080;
|FIN;


|PROCESO goprepel;
     |SI aArticulo = #61#2; |Y #61#10 = "S";
          aAlfa = "";
          aSerPed = #61#28;
          nNumPed = #61#29;
     |FINSI;
     nHayPre = 1;
|FPRC;

|DEFBUCLE goprepec;
     #60#2;
     ;
     aSerExp, nNumExp;
     aSerExp, nNumExp;
     ;
     NULL, NULL, NULL, NULL, NULL, NULL, goprepel;
     #60#1;
|FIN;
