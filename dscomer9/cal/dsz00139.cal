|FICHEROS;
     dsz00139 #0;
     agifa007 #7;
     agifa010 #10;
     agifa019 #19;
     dsm00044 #44;
     dsm00055 #55;
     dsm00057 #57;
     agifa065 #65;
     agifa069 #69;
     agifa071 #71;
     agifa080 #80;
     dsm00006 #906;
|FIN;

|VARIABLES;
     &enTalla = 0;
     &enDoc = 0;
     &esinterno = "N";

     nHay = 0;
     nCan = 0;
     nError = 0;
     aAlfa = "";
     nUniDesglose = 0;
|FIN;

|PROCESO dsm00006;
     nCan = nCan + #906#9;
     nHay = 1;
|FPRC;

|DEFBUCLE dsm00006;
     #906#1;
     ;
     #65#0, #65#5, #65#1, #65#2, #65#11, #65#3, #65#4, "      ";
     #65#0, #65#5, #65#1, #65#2, #65#11, #65#3, #65#4, "zzzzzz";
     ;
     NULL, dsm00006;
|FIN;

|PROCESO Historico;
     #19#0 = #65#0;
     |LEE 000#19=;
     |SI FSalida ! 0; |DDEFECTO #19; |FINSI;

     esinterno = "N";
     nHay = 0;
     nCan = 0;
     enDoc = 0;
     |SI #65#2 = "ES";|O #65#2 = "SS";
          |BUCLE dsm00006;
          |SI nHay = 1;
               #44#21 = #65#11;
               #44#18 = #65#3;
               #44#8 = #65#4;
               |LEE 000#44=;
               |SI FSalida ! 0; |DDEFECTO #44; |FINSI;
               |SI #65#2 = "SS";
                    enDoc = -#44#4;
               |SINO;
                    enDoc = #44#4;
               |FINSI;
          |FINSI;
     |FINSI;
     |SI #65#2 = "ME"; |O #65#2 = "MS";
          |BUCLE dsm00006;
          |SI nHay = 1;
               #55#28 = #65#11;
               #55#27 = #65#3;
               #55#11 = #65#4;
               |LEE 000#55=;
               |SI FSalida ! 0; |DDEFECTO #55; |FINSI;
               |SI #65#2 = "MS";
                    enDoc = -#55#4;
               |SINO;
                    enDoc = #55#4;
               |FINSI;
          |FINSI;
     |FINSI;
     |SI #65#2 = "AC";|O #65#2 = "BC";|O #65#2 = "EV";
          |BUCLE dsm00006;
          |SI nHay = 1;
               |SI #65#2 = "EV";
                    #57#28 = #65#11;
                    #57#27 = #65#3;
                    #57#14 = #65#4;
                    |LEE 000#57=;
                    |SI FSalida ! 0; |DDEFECTO #57; |FINSI;
                    enDoc = #57#4;
               |SINO;
                    #7#26 = #65#11;
                    |LEE 000#7=;
                    |SI FSalida ! 0; |DDEFECTO #7; |FINSI;
                    |SI #7#37 = "S";
                         esinterno = "S";
                    |FINSI;

                    #80#27 = #65#11;
                    #80#0 = #65#3;
                    #80#1 = #65#4;
                    |LEE 000#80=;
                    |SI FSalida ! 0; |DDEFECTO #80; |FINSI;
                    |SI #65#2 = "BC";
                         enDoc = -#80#5;
                    |SINO;
                         enDoc = #80#5;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
     |SI #65#2 = "AV";|O #65#2 = "BV";|O #65#2 = "FC";
          |BUCLE dsm00006;
          |SI nHay = 1;
               |SI #65#2 = "FC";
                    #69#20 = #65#11;
                    #69#0 = #65#3;
                    #69#1 = #65#4;
                    |LEE 000#69=;
                    |SI FSalida ! 0; |DDEFECTO #69; |FINSI;
                    enDoc = #69#5;
               |SINO;
                    #10#52 = #65#11;
                    #10#0 = #65#3;
                    |LEE 000#10=;
                    |SI FSalida ! 0; |DDEFECTO #10; |FINSI;

                    #71#29 = #65#11;
                    #71#0 = #65#3;
                    #71#1 = #65#4;
                    |LEE 000#71=;
                    |SI FSalida ! 0; |DDEFECTO #71; |FINSI;

                    nUniDesglose = 0;
                    |SI #10#85 = "E";  || Es el principal de desglose
                         aAlfa = #71#47;
                         aAlfa = aAlfa % 101;
                         |SI aAlfa = "U";    || Si el desglose es por unidades leeo el hermando
                              |SALVA_FICHA #71;
                              #71#29 = #10#86;
                              #71#0 = #10#87;
                              |LEE 000#71=;
                              |SI FSalida = 0;
                                   nUniDesglose = #71#5;
                              |FINSI;
                              |REPON_FICHA #71;
                         |FINSI;
                    |FINSI;

                    |SI #10#85 = "X";
                         |ACABA;   ||el albaran hermano
                    |FINSI;

                    |SI #65#2 = "BV";
                         enDoc = #71#5 + nUniDesglose;
                    |SINO;
                         enDoc = -(#71#5 + nUniDesglose);
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;

     |SI nHay = 1;
          |SI #19#176 = "S";
               enTalla = nCan;
               |SI esinterno = "S";
                    |SI nCan ! #65#6;
                         nError = 1;
                         |PRINT;
                    |FINSI;
               |SINO;
                    |SI nCan ! #65#6; |O nCan ! enDoc; |O enDoc ! #65#6;
                         nError = 1;
                         |PRINT;
                    |FINSI;
               |FINSI;
          |SINO;
               |SI esinterno = "N";
                    enTalla = 0;
                    |SI enDoc ! #65#6;
                         nError = 1;
                         |PRINT;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE Historico;
     #65#1;
     ;
     #0#2, #0#0, "  ", 000000, 00000, "     ";
     #0#3, #0#1, "zz", 999999, 99999, "zzzzz";
     ;
     NULL, Historico;
|FIN;

|PROCESO T3; |TIPO 3;
     |IMPRE 0;
     |SI FSalida = 0;
          |INFOR "dsz00139";
          |SI FSalida = 0;
               |ABRE #7;
               |ABRE #19;
               |ABRE #10;
               |ABRE #69;
               |ABRE #71;
               |ABRE #80;
               |ABRE #55;
               |ABRE #44;
               |ABRE #57;
               |BUCLE Historico;
               |CIERRA #57;
               |CIERRA #44;
               |CIERRA #55;
               |CIERRA #80;
               |CIERRA #71;
               |CIERRA #69;
               |CIERRA #10;
               |CIERRA #19;
               |CIERRA #7;
               |SI nError ! 0; |PIEINF; |FINSI;
               |FININF;
          |FINSI;
          |FINIMP;
     |FINSI;
|FPRC;
