|FICHEROS;
     malpe154 #154;
     malpe157 #157;
     malpe159 #159;
     malpe180 #180;
     malpe181 #181;
|FIN;

|VARIABLES;
     nCto1 = 0;
     nCto2 = 0;
     nCto3 = 0;
     nCto4 = 0;
     aAlfa         = "";
     aFichero      = "";
     aPath         = "";

     nAnyo         = 0;
     nMes          = 0;
     nHandle       = 0;
     nReg          = 0;

     fFecha        = @;
|FIN;

|PROCESO malpe159;
     #154#0 = #159#0;
     |LEE 000#154=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     #157#0 = #154#5;
     |LEE 000#157=;
     |SI FSalida ! 0;  |DDEFECTO #157;  |FINSI;

     nCto1 = #180#1;
     nCto2 = #180#2;
     nCto3 = #180#3;
     nCto4 = #180#4;

     |SI #159#7 ! 0;  |Y #154#8 ! 0;
         aAlfa = (("00000" + #154#8) % -105);
         aAlfa = aAlfa + (("00000" + #154#9) % -105);
         aAlfa = aAlfa + (("00" + #181#1) % -102);
         aAlfa = aAlfa + ((nCto1 + "   ") % 103);
         aAlfa = aAlfa + ((#159#7 + "        ") % 108);
         aAlfa = aAlfa + ((#157#1 + "        ") % 108);
         aAlfa = aAlfa + &13 + &10;
         |XGRABA nHandle, aAlfa;

         nReg = nReg + 1;
     |FINSI;

     |SI #159#8 ! 0;  |Y #154#10 ! 0;
         aAlfa = (("00000" + #154#10) % -105);
         aAlfa = aAlfa + (("00000" + #154#11) % -105);
         aAlfa = aAlfa + (("00" + #181#1) % -102);
         aAlfa = aAlfa + ((nCto1 + "   ") % 103);
         aAlfa = aAlfa + ((#159#8 + "        ") % 108);
         aAlfa = aAlfa + ((#157#1 + "        ") % 108);
         aAlfa = aAlfa + &13 + &10;
         |XGRABA nHandle, aAlfa;

         nReg = nReg + 1;
     |FINSI;

     |SI #159#9 ! 0;  |Y #154#8 ! 0;
         aAlfa = (("00000" + #154#8) % -105);
         aAlfa = aAlfa + (("00000" + #154#9) % -105);
         aAlfa = aAlfa + (("00" + #181#1) % -102);
         aAlfa = aAlfa + ((nCto2 + "   ") % 103);
         aAlfa = aAlfa + ((#159#9 + "        ") % 108);
         aAlfa = aAlfa + ((#157#2 + "        ") % 108);
         aAlfa = aAlfa + &13 + &10;
         |XGRABA nHandle, aAlfa;

         nReg = nReg + 1;
     |FINSI;

     |SI #159#10 ! 0;  |Y #154#10 ! 0;
         aAlfa = (("00000" + #154#10) % -105);
         aAlfa = aAlfa + (("00000" + #154#11) % -105);
         aAlfa = aAlfa + (("00" + #181#1) % -102);
         aAlfa = aAlfa + ((nCto2 + "   ") % 103);
         aAlfa = aAlfa + ((#159#10 + "        ") % 108);
         aAlfa = aAlfa + ((#157#2 + "        ") % 108);
         aAlfa = aAlfa + &13 + &10;
         |XGRABA nHandle, aAlfa;

         nReg = nReg + 1;
     |FINSI;

     |SI #159#11 ! 0;  |Y #154#8 ! 0;
         aAlfa = (("00000" + #154#8) % -105);
         aAlfa = aAlfa + (("00000" + #154#9) % -105);
         aAlfa = aAlfa + (("00" + #181#1) % -102);
         aAlfa = aAlfa + ((nCto3 + "   ") % 103);
         aAlfa = aAlfa + ((#159#11 + "        ") % 108);
         aAlfa = aAlfa + "0       ";
         aAlfa = aAlfa + &13 + &10;
         |XGRABA nHandle, aAlfa;

         nReg = nReg + 1;
     |FINSI;

     |SI #154#7 = 1;  |ACABA;  |FINSI;

     |SI #159#14 ! 0;  |Y #154#8 ! 0;
         aAlfa = (("00000" + #154#8) % -105);
         aAlfa = aAlfa + (("00000" + #154#9) % -105);
         aAlfa = aAlfa + (("00" + #181#1) % -102);
         aAlfa = aAlfa + ((nCto4 + "   ") % 103);
         aAlfa = aAlfa + ((#159#14 + "        ") % 108);
         aAlfa = aAlfa + "0       ";
         aAlfa = aAlfa + &13 + &10;
         |XGRABA nHandle, aAlfa;

         nReg = nReg + 1;
     |FINSI;
|FPRC;

|DEFBUCLE malpe159;
     #159#1;
     ;
     00000, #181#0, #181#1;
     99999, #181#0, #181#1;
     ;
     NULL, malpe159;
|FIN;

|PROCESO Tipo3;  |TIPO 3;
     |ABRE #180;
     |LEE 000#180p;
     |SI FSalida ! 0;
         |CIERRA #180;
         |MENAV "0000 No esta definido la parametrizacion del enlace.";
         |ACABA;
     |FINSI;
     |CIERRA #180;

     |DFICE aPath;   |QBF aPath;

     aFichero = aPath + #181#2;  |QBF aFichero;
     |XABRE "W", aFichero, nHandle;

     nReg = 0;
     |ABRE #154;
     |ABRE #157;
     |BUCLE malpe159;
     |CIERRA #154;
     |CIERRA #157;

     aAlfa = "0000 Grabados: " + nReg + " registros";
     |MENAV aAlfa;

     |XCIERRA nHandle;
|FPRC;

|PROCESO PonAnyo;  |TIPO 7;
     fFecha = ~;
     aAlfa  = fFecha % 402;   nMes   = aAlfa;
     aAlfa  = fFecha % -104;  nAnyo  = aAlfa;
     nMes   = nMes - 1;
     |SI nMes = 0;
         nMes  = 12;
         nAnyo = nAnyo - 1;
     |FINSI;

     #181#0 = nAnyo;   |PINTA #181#0;
     #181#1 = nMes;    |PINTA #181#1;
|FPRC;

|PROCESO PonFichero;  |TIPO 0;
     #181#2 = "VM" + #181#0 + (("00" + #181#1) % -102);
     |PINTA #181#2;
|FPRC;
