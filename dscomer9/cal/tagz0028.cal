|FICHEROS;
     tagm0030 #30;
     agifa024 #24;
     agifa146 #146;
     tagm0081 #81;
     tagm0087 #87;
     tagm0084 #84;
     tagm0090 #90;
     tagm0091 #91;
     tmp00000 #300;
|FIN;

|VARIABLES;
     &enTipo = 0;
     &enSwImp = 0;
     &eaSerBlc = "";
     &enNumBlc = 0;
     &aDivisa = "";
     &aMoneda = "";
     &enGraba300 = 0;
     &serie = "";
     &numero = 0;
     &reimpr = "";
     &eaImpresora = "";
     aAno = "";
     aPath = "";
     aAlfa = "";
     aTmp = "";
     aEmp = "";
     aNom = "";
     aLon = "";
     aCar = "";
     i = 0;
     nPos = 0;
     aExe = "";
     f = "";
     c = "";
     aFic = "";
     nHandle = 0;
     aNum4 = "";
     aNum6 = "";
     aNum7 = "";
     aNum8 = "";
     aNum9 = "";
     aNum10 = "";
     aNum11 = "";
     aNum12 = "";
     aNum13 = "";
     aNum14 = "";
     aNum15 = "";
     aNum16 = "";
     aNum17 = "";
     aNum18 = "";
     nNum4 = "";
     nNum6 = "";
     nNum7 = "";
     nNum8 = "";
     nNum9 = "";
     nNum10 = "";
     nNum11 = "";
     nNum12 = "";
     nNum13 = "";
     nNum14 = "";
     nNum15 = "";
     nNum16 = "";
     nNum17 = "";
     nNum18 = "";
     aFecha = "";
     aKey = "";
     fHoy = @;
     aDato = "";
     aSeccion = "";
|FIN;

|PROCESO Punto2Coma;
     aDato = "";
     aLon = aAlfa % A0;
     |PARA i = 1; |SI i [ aLon; |HACIENDO i = i + 1;
          nPos = i * 100 + 1;
          aCar = aAlfa % nPos;
          |SI aCar = ".";
               aCar = ",";
          |FINSI;
          aDato = aDato + aCar;
     |SIGUE;
     aAlfa = aDato;
|FPRC;

|PROCESO Graba;
     aAlfa = aAlfa + f;
     |XGRABA nHandle, aAlfa;
|FPRC;

|PROCESO Apo;
     fHoy = ~;
     aFecha = (fHoy % 102) + "/" + (fHoy % 402) + "/" + (fHoy % 704);
     |HORA aAlfa;
     aFecha = aFecha + " " + aAlfa;
     aKey = "51/" + aEmp + (#146#48 % 102) + (("000000" + #146#0) % -106);
     aNum4 = #146#4; |QBF aNum4; nNum4 = aNum4 % A0;
     aNum6 = #146#3; nNum6 = 6;
     aNum7 = "30." + (#146#48 % 102) + "." + (("000000" + #146#0) % -106); nNum7 = 12;
     aNum8 = (#146#1 % 102) + "/" + (#146#1 % 402) + "/" + (#146#1 % 704); nNum8 = 10;
     aNum9 = aEmp; nNum9 = 2;
     aNum11 = #24#18; |QBF aNum11; nNum11 = aNum11 % A0;
     aNum12 = #24#197; |QBF aNum12; nNum12 = aNum12 % A0;
     aNum13 = #81#1; |QBF aNum13; nNum13 = aNum13 % A0;
     aNum14 = ("0000"+ #146#78) % -102; nNum14 = 2;

     aAlfa = #146#73; |HAZ Punto2Coma;
     aNum15 = aAlfa; nNum15 = aNum15 % A0;

     #90#0 = #146#8;
     |LEE 000#90=;
     |SI FSalida = 0;
          aNum16 = "SI"; nNum16 = 2;
     |SINO;
          aNum16 = "NO"; nNum16 = 2;
     |FINSI;
     aNum17 = Usuario % 810; |QBF aNum15; nNum17 = aNum15 % A0;
     aNum18 = #146#31; |QBF aNum18; nNum18 = aNum18 % A0;

     aFic = aPath + aNom + ".apo";
     |XABRE "WBC", aFic, nHandle;
     |SI FSalida ] 0;
          aAlfa = "list";
          |HAZ Graba;

          aAlfa = "{";
          |HAZ Graba;

          aAlfa = "template(" + c + c + ");";
          |HAZ Graba;

          aAlfa = "doc_type(" + c + "PDF" + c + ");";
          |HAZ Graba;

          aAlfa = "type(" + c + "51" + c + ");"
          |HAZ Graba;

          aAlfa = "date(" + c + aFecha + c + ");";
          |HAZ Graba;

          aAlfa = " doc";
          |HAZ Graba;

          aAlfa = " {";
          |HAZ Graba;

          aAlfa = "      key(" + c + aKey + c + ");";
          |HAZ Graba;

          aAlfa = "      data";
          |HAZ Graba;

          aAlfa = "      {";
          |HAZ Graba;

          aAlfa = "           (1)(" + c + "30" + c + "," + c + "A" + c + "," + c + "2" + c + ");";
          |HAZ Graba;

          aAlfa = "           (2)(" + c + c + "," + c + "A" + c + "," + c + "0" + c + ");"
          |HAZ Graba;

          aAlfa = "           (3)(" + c + c + "," + c + "A" + c + "," + c + "0" + c + ");"
          |HAZ Graba;

          aAlfa = "           (4)(" + c + aNum4 + c + "," + c + "A" + c + "," + c + nNum4 + c +");";
          |HAZ Graba;

          aAlfa = "           (5)(" + c + c + "," + c + "A" + c + "," + c + "0" + c + ");"
          |HAZ Graba;

          aAlfa = "           (6)(" + c + aNum6 + c + "," + c + "A" + c + "," + c + nNum6 + c +");";
          |HAZ Graba;

          aAlfa = "           (7)(" + c + aNum7 + c + "," + c + "A" + c + "," + c + nNum7 + c +");";
          |HAZ Graba;

          aAlfa = "           (8)(" + c + aNum8 + c + "," + c + "A" + c + "," + c + nNum8 + c +");";
          |HAZ Graba;

          aAlfa = "           (9)(" + c + aNum9 + c + "," + c + "A" + c + "," + c + nNum9 + c +");";
          |HAZ Graba;

          aAlfa = "           (10)(" + c + aNum10 + c + "," + c + "A" + c + "," + c + nNum10 + c +");";
          |HAZ Graba;

          aAlfa = "           (11)(" + c + aNum11 + c + "," + c + "A" + c + "," + c + nNum11 + c +");";
          |HAZ Graba;

          aAlfa = "           (12)(" + c + aNum12 + c + "," + c + "A" + c + "," + c + nNum12 + c +");";
          |HAZ Graba;

          aAlfa = "           (13)(" + c + aNum13 + c + "," + c + "A" + c + "," + c + nNum13 + c +");";
          |HAZ Graba;

          aAlfa = "           (14)(" + c + aNum14 + c + "," + c + "A" + c + "," + c + nNum14 + c +");";
          |HAZ Graba;

          aAlfa = "           (15)(" + c + aNum15 + c + "," + c + "A" + c + "," + c + nNum15 + c +");";
          |HAZ Graba;

          aAlfa = "           (16)(" + c + aNum16 + c + "," + c + "A" + c + "," + c + nNum16 + c +");";
          |HAZ Graba;

          aAlfa = "           (17)(" + c + aNum17 + c + "," + c + "A" + c + "," + c + nNum17 + c +");";
          |HAZ Graba;

          aAlfa = "           (18)(" + c + aNum18 + c + "," + c + "A" + c + "," + c + nNum18 + c +");";
          |HAZ Graba;

          aAlfa = "      }";
          |HAZ Graba;

          aAlfa = " contents";
          |HAZ Graba;

          aAlfa = "      {";
          |HAZ Graba;

          aAlfa = "           1;";
          |HAZ Graba;

          aAlfa = "";
          |HAZ Graba;

          aAlfa = "      }";
          |HAZ Graba;

          aAlfa = " }";
          |HAZ Graba;

          aAlfa = "}";
          |HAZ Graba;

          |XCIERRA nHandle;
     |SINO;
          aAlfa = "0000Error al crear fichero:" + aFic;
          |MENAV aAlfa;
     |FINSI;
|FPRC;

|PROCESO Sal;
     aFic = aPath + aNom + ".sal";
     |XABRE "WBC", aFic, nHandle;
     |SI FSalida ] 0;
          ||aAlfa = "USER=" + Usuario % 810;
          aAlfa = "USER=" + #146#92; |QBF aAlfa;
          |HAZ Graba;

          aAlfa = "CONTENIDO=" + aPath + aNom + ".pdf";
          |HAZ Graba;

          aAlfa = "PORTADA=" + aPath + aNom + ".apo";
          |HAZ Graba;

          aAlfa = "NOTRANSFORM=1" + f;
          aAlfa = aAlfa + "WHATTODO=2" + f;
          aAlfa = aAlfa + "TIFF=0" + f;
          aAlfa = aAlfa + "TIF=0" + f;
          aAlfa = aAlfa + "FAX=" + f;
          aAlfa = aAlfa + "PDF=1" + f;
          |HAZ Graba;
          |XCIERRA nHandle;
     |SINO;
          aAlfa = "0000Error al crear fichero:" + aFic;
          |MENAV aAlfa;
     |FINSI;
|FPRC;

|PROCESO Tmp;
     #146#48 = #300#0;
     #146#0 = #300#1;
     |LEE 020#146=;

     aAno = #146#1 % 902;

     aNom = "R" + aEmp + (#300#0 % 102) + aAno + (("000000"+#300#1)%-106);
     serie = #300#0;
     numero = #300#1;
     reimpr = #146#10;
     eaImpresora = "CrystalReport;" + aPath + aNom + ".pdf";
     |SUB_EJECUTA_NP "agifa150";


     aDivisa = #146#65;
     aMoneda = #146#67;
     |HAZ Divisas146;

     #24#0 = #146#3;
     |LEE 000#24=;
     |SI FSalida ! 0; |DDEFECTO #24; |FINSI;

     #84#0 = #146#92;
     |LEE 000#84=;
     |SI FSalida ! 0; |DDEFECTO #84; |FINSI;
     aSeccion = #84#7;

     #91#0 = #146#48;
     #91#1 = #146#0;
     |LEE 000#91=;
     |SI FSalida = 0;
          aSeccion = #91#2;
     |FINSI;

     #81#0 = aSeccion;
     |LEE 000#81=;
     |SI FSalida ! 0; |DDEFECTO #81; |FINSI;

     |HAZ Apo;
     |HAZ Sal;

     aExe = #87#5; |QBF aExe;
     aExe = aExe + "jafsmb.exe " + aPath + aNom + ".sal";
     |RSYSTEM aExe;
|FPRC;

|DEFBUCLE Tmp;
     #300#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Tmp;
|FIN;

|PROGRAMA;
     f = &13; f = f + &10;
     c = &34;
     enGraba300 = 1;
     aEmp = "30";

     |ABRE #87; |LEE 000#87p; |CIERRA #87;


     aPath = "c:\ds\item\";
     |RMKDIR aPath;

     |ABRE #91;
     |ABRE #90;
     |ABRE #84;
     |ABRE #81;
     |ABRE #146;
     |ABRE #24;
     aTmp = PARAMETRO; |NOME_DAT #300 aTmp;
     |BUCLE Tmp;
     |CIERRA #24;
     |CIERRA #146;
     |CIERRA #81;
     |CIERRA #84;
     |CIERRA #90;
     |CIERRA #91;

     eaImpresora = "";
     enGraba300 = 0;
|FPRO;
