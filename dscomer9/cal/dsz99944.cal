          ||  000845 Albadistribucion

|FICHEROS;
     alba0007 #0,MANTE;
     referen1@ #1;
     referen2@ #2;
     referen@;
|FIN;

|VARIABLES;
     &eaTipo = "";
     &enDto = 0;    || Solo para Albadist
     &enModo = 0;
     &eaArtiAntes = "";
     &eaCliente = "";
     &efFecha = @;
     i = 0;
     nPrecio = 0;
     nDto = 0;

     &enPVerde = 0;
     &enTipEnvase = 0;
     &eaDesprecia = "";
     &enForma = 0;
     aGuarda1 = "";
     aGuarda2 = "";
     aGuarda3 = "";
     aAlfa = "";
     nUni1 = 0;
     nUni2 = 0;
     nUni3 = 0;
     nDeci = 0;
     nUniPromo = 0;
     nPrePromo = 0;
     nResto = 0;
     &eaEnvase = "";
     &eaDivisa = "";
     &eaDocu = "";
     &eaSerie = "";
     &enCodigo = 0;
     &enLinea = 0;
     &enUnid1 = 0;
     &enUnid2 = 0;
     &enUnid3 = 0;
     &Envase = "";
     &Unidades1 = 0;
     &Unidades2 = 0;
     &VArticulo = "";
     &enEntraEnvase = 0;
     &eaArticulo = ""
     &eaCli = "";
     &eaProve = "";
     &enPrecio = 0;
     &eaSeriePedido = "";
     &enCodigPedido = 0;
     &enLineaPedido = 0;
     aDef = "";
     aFic = "";
|FIN;

|PROCESO CargaLinea;
     |DDEFECTO #0;
     #0#0 = eaDocu;
     #0#1 = eaSerie;
     #0#2 = enCodigo;
     #0#3 = #1#1;
     |LEE 000#0=;

     #2#0 = #1#1;
     #2#1 = #1#2;
     #2#2 = #1#4;
     #2#3 = #1#3;

     #2#4 = #0#4;
     #2#5 = #0#5;
     #2#6 = #0#6;
     #2#7 = #0#14;

     #2#7 = #1#6;  ||Precio
     #2#8 = #1#8;  ||Dto1
     |SI #0#0 = "PV"; #2#9 = #1#29; |FINSI;
     |SI #0#0 = "DE"; #2#9 = #1#23; |FINSI;
     |SI #0#0 = "AV"; #2#9 = #1#33; |FINSI;
     |SI #0#0 = "FD"; #2#9 = #1#21; |FINSI;
     |SI #0#0 = "PR"; #2#9 = #1#21; |FINSI;
     |SI #0#0 = "PC"; #2#9 = #1#27; |FINSI;
     |SI #0#0 = "AC"; #2#9 = #1#26; |FINSI;
     #2#10 = #1#9;  ||Importe

     |SI #0#0 = "PC"; |O #0#0 = "PV";
          #2#11 = #0#15;
          #2#12 = #0#16;
          #2#13 = #0#8;
          #2#14 = #0#9;
          #2#15 = #0#10;
          #2#16 = #0#11;
          #2#17 = #0#12;
          #2#18 = #0#13;
     |FINSI;
     |GRABA 020#2n;
|FPRC;

|DEFBUCLE CargaLinea;
     #1#1003;
     ;
     eaSerie, enCodigo, 001;
     eaSerie, enCodigo, 999;
     ;
     NULL, CargaLinea;
|FIN;

|PROCESO Consulta0;
     aFic = "";
     |SI #0#0 = "PV"; aFic = "agifa073"; |FINSI;
     |SI #0#0 = "DE"; aFic = "agifa070"; |FINSI;
     |SI #0#0 = "AV"; aFic = "agifa071"; |FINSI;
     |SI #0#0 = "FD"; aFic = "agifa069"; |FINSI;
     |SI #0#0 = "PR"; aFic = "agifa147"; |FINSI;
     |SI #0#0 = "PC"; aFic = "agifa067"; |FINSI;
     |SI #0#0 = "AC"; aFic = "agifa080"; |FINSI;
     |SI aFic ! "";
          |HAZ AbreFic1;
          |SI #0#0 = "PC"; |O #0#0 = "PV";
               aFic = "albaw002";
          |SINO;
               aFic = "albaw001";
          |FINSI;
          |HAZ AbreFic2;
          aAlfa = Usuario; |NOME_DAT #2 aAlfa; |DELINDEX #2;
          |ABRE #2;
          |BUCLE CargaLinea;
          |LEE 000#2p;
          |CONSULTA_CLAVE #1#2;
          |CIERRA #2;
          |DELINDEX #2;
          |HAZ CierraFic2
          |HAZ CierraFic1;
     |FINSI;
|FPRC;

|PROCESO Consulta6; |TIPO 6;
     |SI FSalida ! 13; |ACABA; |FINSI;
     aGuarda1 = #1#0;
     aGuarda2 = #1#1;
     aGuarda3 = aFic; |HAZ CierraFic1;
     |SALVA_FICHA #0;
     |HAZ Consulta0;
     |REPON_FICHA #0;
     aFic = aGuarda3; |HAZ AbreFic1;
     #1#0 = aGuarda1;
     #1#1 = aGuarda2;
     |ERROR;
|FPRC;

|PROCESO Uni_Promo; |TIPO 0;
     |SI #0Campo = Contenido; |ACABA; |FINSI;
     #0#6 = #0#4 + #0#5;
     |PINTA #0#6;
|FPRC;

|PROCESO Uni_Base; |TIPO 0;
     |SI FSalida = 14; ||F6;
          enTipEnvase = 1;
          |HAZ Entra_Base;
          |ACABA;
     |FINSI;

     |SI #0Campo = Contenido; |ACABA; |FINSI;

     |LEE 000#1=;
     |SI FSalida = 0;
          nUniPromo = #0#4 / #1#2;
          nResto = #0#4 $ #1#2;
          nResto = nResto / #1#2;
          nUniPromo = nUniPromo  - nResto;
          #0#5 = nUniPromo * #1#3;
          nPrePromo = #1#4;
          #0#7 = (enPrecio + #0#20 - nPrePromo) ! nDeci;
          #0#20 = nPrePromo;
     |FINSI;

     #0#6 = #0#4 + #0#5;
     |PINTA #0#6;
     |PINTA #0#7;
|FPRC;

|PROCESO alba0007_12; |TIPO 12;
     || No hace nada
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO AbreFic1;
     |DDEF aDef;
     aDef = aDef + aFic;
     |CARGA_DEF aDef, referen1@;
     |SI FSalida = 0;
          |ABRE #1;
     |SINO;
          aFic = "0000ERROR (" + FSalida + ") al cargar:'" + aFic + "'";
          |MENAV aFic;
     |FINSI;
|FPRC;

|PROCESO CierraFic1;
     |CIERRA #1;
     |DESCARGA_DEF #referen1@;
|FPRC;

|PROCESO AbreFic2;
     |DDEF aDef;
     aDef = aDef + aFic;
     |CARGA_DEF aDef, referen2@;
     |SI FSalida = 0;
          |ABRE #2;
     |SINO;
          aFic = "0000ERROR (" + FSalida + ") al cargar:'" + aFic + "'";
          |MENAV aFic;
     |FINSI;
|FPRC;

|PROCESO CierraFic2;
     |CIERRA #2;
     |DESCARGA_DEF #referen2@;
|FPRC;

컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴Llamadas externas컴컴컴컴컴컴컴컴컴컴
|PROCESO BseFactu2;
     aFic = "agifa019"; |HAZ AbreFic1;
     |SI FSalida = 0;
          |DDEFECTO #1;
          #1#0 = eaArticulo;
          |LEE 101#1=;
          |SI FSalida ! 0; |GRABA 020#1b; |FINSI;
          #1#194 = 2;
          #1#196 = 2;
          |GRABA 020#1a;
          |HAZ CierraFic1;
     |FINSI;
|FPRC;

|PROCESO BseVerUni;
     |ABRE #0;
     |DDEFECTO #0;
     #0#0 = eaDocu;
     #0#1 = eaSerie;
     #0#2 = enCodigo;
     #0#3 = enLinea;
     |LEE 101#0=;
     |SI FSalida ! 0; |GRABA 020#0b; |FINSI;
     #0#7 = enPrecio;
     |GRABA 020#0a;
     |CIERRA #0;
     |PUSHV 0501 2380;
     |BLANCO 1222 2155;
     |PINPA #0#0;
     |PINDA #0#0;


          #0#7 = enPVerde;
          |ATRI I; |PINTA 1823, " Punto Verde.......:          "; |ATRI 0;
          |PINTA 1845, #0#7;
          |C_V #0#19, 1, "S";
          |PINTA 1723, " Importe Dto Promo:           ";
          |PINTA #0#19;


     |MENSA "2325Pulse una tecla para continuar, (F5) Detalle de lineas";
     |LEETECLA aAlfa;
     aAlfa = aAlfa % -103;
     |SI aAlfa = 827;
          |ABRE #0;
          |HAZ Consulta0;
          |CIERRA #0;
     |FINSI;
     |POPV;
|FPRC;

|PROCESO BseBorraUni;
     |ABRE #0;
     |DDEFECTO #0;
     #0#0 = eaDocu;
     #0#1 = eaSerie;
     #0#2 = enCodigo;
     #0#3 = enLinea;
     |BORRA 000#0c;
     |CIERRA #0;
|FPRC;

|PROCESO Imp_DtoPro;
     |SI #0Campo ! Contenido; |Y Campo = 19;
          #0#7 = #0#7 + Contenido;
          #0#7 = #0#7 - #0Campo;
          |PINTA #0#7;
     |FINSI;
|FPRC;

|PROCESO BseEntraUniV;
     |HAZ BseFactu2;
     aFic = "agifa324"; |HAZ AbreFic1;
     |SI FSalida ! 0; |ACABA; |FINSI;
     #1#0 = eaDivisa;
     |LEE 000#1p;
     nDeci = #1#9;
     |HAZ CierraFic1;

     aFic = "dsm00134"; |HAZ AbreFic1;
     |SI FSalida ! 0; |ACABA; |FINSI;

     #1#0 = eaCli;
     #1#1 = eaArticulo;

     |ABRE #0;
     |DDEFECTO #0;
     #0#0 = eaDocu;
     #0#1 = eaSerie;
     #0#2 = enCodigo;
     #0#3 = enLinea;
     |LEE 101#0=;
     |SI FSalida ! 0; |GRABA 020#0b; |FINSI;
     |SI enModo = 1;
          |PARA i = 4; |SI i [ 19; |HACIENDO i = i + 1;
               #0i = "";
          |SIGUE;
     |FINSI;
     #0#7 = enPrecio ! nDeci;
     |PUSHV 0501 2380;
     |BLANCO 1222 2155;
     |PINPA #0#0;
     |PINDA #0#0;


          |SI enModo = 1; |O eaArtiAntes ! eaArticulo;
               |HAZ DefImpDtoPromo;
               #0#19 = nPrecio;
          |FINSI;
          |C_V #0#19, 1, "S";
          |PINTA 1723, " Importe Dto Promo:           ";
          |PINTA #0#19;

     |ENDATOS #1#0;
     |POPV;

     #0#14 = #0#4;
     #0#15 = #0#5;
     #0#16 = #0#6;

     |GRABA 020#0a;
     |CIERRA #0;
     |HAZ CierraFic1;
     enUnid1 = #0#6; || Unidades Facturacion
     enUnid2 = #0#4; || Unidades Stock
     enPrecio = #0#7;
     enUnid3 = #0#17;
     Envase = #0#18;
|FPRC;

|PROCESO BseEntraUniC;
     |HAZ BseFactu2;
     aFic = "agifa324"; |HAZ AbreFic1;
     |SI FSalida ! 0; |ACABA; |FINSI;
     #1#0 = eaDivisa;
     |LEE 000#1p;
     nDeci = #1#9;
     |HAZ CierraFic1;

     aFic = "alba0002"; |HAZ AbreFic1;
     |SI FSalida ! 0; |ACABA; |FINSI;

     #1#0 = eaProve;
     #1#1 = eaArticulo;

     |ABRE #0;
     |DDEFECTO #0;
     #0#0 = eaDocu;
     #0#1 = eaSerie;
     #0#2 = enCodigo;
     #0#3 = enLinea;
     |LEE 101#0=;
     |SI FSalida ! 0; |GRABA 020#0b; |FINSI;
     #0#7 = enPrecio ! nDeci;
     |PUSHV 0501 2380;
     |BLANCO 1222 2154;
     |PINPA #0#0;
     |PINDA #0#0;
     |ENDATOS #1#0;
     |POPV;

     #0#14 = #0#4;
     #0#15 = #0#5;
     #0#16 = #0#6;

     |GRABA 020#0a;
     |CIERRA #0;

     |HAZ CierraFic1;
     enUnid1 = #0#6; || Unidades Stock
     enUnid2 = #0#4; || Unidades Facturacion
     enPrecio = #0#7;
     enUnid3 = #0#17;
     Envase = #0#18;
|FPRC;

|PROCESO BseAdjUniV1;
     |ABRE #0;
     #0#0 = "PV";
     #0#1 = eaSeriePedido;
     #0#2 = enCodigPedido;
     #0#3 = enLineaPedido;
     |LEE 000#0=;
     |SI FSalida = 0;
          nUni1 = #0#4 - #0#8;
          nUni2 = #0#5 - #0#9;
          nUni3 = #0#6 - #0#10;
          #0#0 = "AV";
          #0#1 = eaSerie;
          #0#2 = enCodigo;
          #0#3 = enLinea;
          |LEE 101#0=;
          |SI FSalida ! 0; |GRABA 020#0b; |FINSI;
          #0#4 = nUni1;
          #0#5 = nUni2;
          #0#6 = nUni3;
          #0#8 = 0; #0#9 = 0; #0#10 = 0;
          #0#11 = 0; #0#12 = 0; #0#13 = 0;
          #0#14 = 0; #0#15 = 0; #0#16 = 0;
          |GRABA 020#0a;
     |FINSI;
     |CIERRA #0;
|FPRC;

|PROCESO BseAdjUniV2;
     |ABRE #0;
     #0#0 = "AV";
     #0#1 = eaSerie;
     #0#2 = enCodigo;
     #0#3 = enLinea;
     |LEE 000#0=;
     |SI FSalida = 0;
          nUni1 = #0#4 * enForma;
          nUni2 = #0#5 * enForma;
          nUni3 = #0#6 * enForma;
          #0#0 = "PV";
          #0#1 = eaSeriePedido;
          #0#2 = enCodigPedido;
          #0#3 = enLineaPedido;
          |LEE 101#0=;
          |SI FSalida ! 0; |GRABA 020#0b; |FINSI;
          #0#8 = #0#8 + nUni1;
          #0#9 = #0#9 + nUni2;
          #0#10 = #0#10 + nUni3;
          |SI eaDesprecia = "S";
               #0#11 = #0#8 - #0#14;
               #0#12 = #0#9 - #0#15;
               #0#13 = #0#10 - #0#16;
          |FINSI;
          |GRABA 020#0a;
     |FINSI;
     |CIERRA #0;
|FPRC;

|PROCESO BseAdjUniV3;
     |ABRE #0;
     #0#0 = "PV";
     #0#1 = eaSeriePedido;
     #0#2 = enCodigPedido;
     #0#3 = enLineaPedido;
     |LEE 101#0=;
     |SI FSalida ! 0; |GRABA 020#0b; |FINSI;
     #0#11 = #0#11 - (#0#14 - #0#8);
     #0#12 = #0#12 - (#0#15 - #0#9);
     #0#13 = #0#13 - (#0#16 - #0#10);
     |GRABA 020#0a;
     |CIERRA #0;
|FPRC;

|PROCESO BseAdjUniC1;
     |ABRE #0;
     #0#0 = "PC";
     #0#1 = eaSeriePedido;
     #0#2 = enCodigPedido;
     #0#3 = enLineaPedido;
     |LEE 000#0=;
     |SI FSalida = 0;
          nUni1 = #0#4 - #0#8;
          nUni2 = #0#5 - #0#9;
          nUni3 = #0#6 - #0#10;
          #0#0 = "AC";
          #0#1 = eaSerie;
          #0#2 = enCodigo;
          #0#3 = enLinea;
          |LEE 101#0=;
          |SI FSalida ! 0; |GRABA 020#0b; |FINSI;
          #0#4 = nUni1;
          #0#5 = nUni2;
          #0#6 = nUni3;
          #0#8 = 0; #0#9 = 0; #0#10 = 0;
          #0#11 = 0; #0#12 = 0; #0#13 = 0;
          #0#14 = 0; #0#15 = 0; #0#16 = 0;
          |GRABA 020#0a;
     |FINSI;
     |CIERRA #0;
|FPRC;

|PROCESO BseAdjUniC2;
     |ABRE #0;
     #0#0 = "AC";
     #0#1 = eaSerie;
     #0#2 = enCodigo;
     #0#3 = enLinea;
     |LEE 000#0=;
     |SI FSalida = 0;
          nUni1 = #0#4 * enForma;
          nUni2 = #0#5 * enForma;
          nUni3 = #0#6 * enForma;
          #0#0 = "PC";
          #0#1 = eaSeriePedido;
          #0#2 = enCodigPedido;
          #0#3 = enLineaPedido;
          |LEE 101#0=;
          |SI FSalida ! 0; |GRABA 020#0b; |FINSI;
          #0#8 = #0#8 + nUni1;
          #0#9 = #0#9 + nUni2;
          #0#10 = #0#10 + nUni3;
          |SI eaDesprecia = "S";
               #0#11 = #0#8 - #0#14;
               #0#12 = #0#9 - #0#15;
               #0#13 = #0#10 - #0#16;
          |FINSI;
          |GRABA 020#0a;
     |FINSI;
     |CIERRA #0;
|FPRC;

|PROCESO BseAdjUniC3;
     |ABRE #0;
     #0#0 = "PC";
     #0#1 = eaSeriePedido;
     #0#2 = enCodigPedido;
     #0#3 = enLineaPedido;
     |LEE 101#0=;
     |SI FSalida ! 0; |GRABA 020#0b; |FINSI;
     #0#11 = #0#11 - (#0#14 - #0#8);
     #0#12 = #0#12 - (#0#15 - #0#9);
     #0#13 = #0#13 - (#0#16 - #0#10);
     |GRABA 020#0a;
     |CIERRA #0;
|FPRC;

|PROCESO BseProFac;
     |DDEFECTO #0;
     |ABRE #0;
     #0#0 = "PR";
     #0#1 = eaSerie;
     #0#2 = enCodigo;
     #0#3 = enLinea;
     |LEE 101#0=;
     #0#0 = "FD";
     #0#1 = eaSeriePedido;
     #0#2 = enCodigPedido;
     #0#3 = enLineaPedido;
     |GRABA 020#0n;
     |CIERRA #0;
|FPRC;

|PROCESO BseProPed;
     |DDEFECTO #0;
     |ABRE #0;
     #0#0 = "PR";
     #0#1 = eaSerie;
     #0#2 = enCodigo;
     #0#3 = enLinea;
     |LEE 101#0=;
     #0#0 = "PV";
     #0#1 = eaSeriePedido;
     #0#2 = enCodigPedido;
     #0#3 = enLineaPedido;
     |GRABA 020#0n;
     |CIERRA #0;
|FPRC;

|PROCESO BseBorraPro;
     |ABRE #0;
     #0#0 = "PR";
     #0#1 = eaSerie;
     #0#2 = enCodigo;
     #0#3 = enLinea;
     |BORRA 000#0c;
     |CIERRA #0;
|FPRC;

||컴컴컴컴컴컴컴컴컴컴컴컴컴Conversor Bultos

|PROCESO Entra_Base; |TIPO 7;
     |C_M #0#4, 1, "S";
     |SI FSalida = 2; |ACABA; |FINSI;
     Envase = #0#18;
     Unidades1 = #0#17;
     Unidades2 = #0#4;
     VArticulo = eaArticulo;
     |SI eaEnvase = "S";
          |HAZ EntraEnvase;
          |C_M #0#4, 1, "S";
          |SI enEntraEnvase ! 0; |C_M #0#4, 1, "N";  |FINSI;
     |FINSI;
     #0#18 = Envase;
     #0#17 = Unidades1;
     #0#4 = Unidades2;
     |PINTA #0#4;
|FPRC;
--------------------------Albadist-------------------------------
|PROCESO DefImpDtoPromo;
     nPrecio = 0;
     nDto = 0;
     |DDEF aDef;
     aDef = aDef + "dsm00134";
     |CARGA_DEF aDef, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          #referen@#0 = eaCliente;
          #referen@#1 = eaArticulo;
          |LEE 000#referen@.=;
          |SI FSalida = 0;
               |SI efFecha ] #referen@#6; |Y efFecha [ #referen@#7;
                    nPrecio = #referen@#4;
                    nDto = #referen@#5;
               |FINSI;
          |FINSI;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
     enDto = nDto;
|FPRC;

|PROCESO AlbaModPromo;
     aFic = "agifa324"; |HAZ AbreFic1;
     |SI FSalida ! 0; |ACABA; |FINSI;
     #1#0 = eaDivisa;
     |LEE 000#1p;
     nDeci = #1#9;
     |HAZ CierraFic1;

     aFic = "dsm00134"; |HAZ AbreFic1;
     |SI FSalida ! 0; |ACABA; |FINSI;

     #1#0 = eaCli;
     #1#1 = eaArticulo;

     |ABRE #0;
     |DDEFECTO #0;
     #0#0 = eaDocu;
     #0#1 = eaSerie;
     #0#2 = enCodigo;
     #0#3 = enLinea;
     |LEE 101#0=;
     |SI FSalida ! 0; |GRABA 020#0b; |FINSI;

     |LEE 000#1=;
     |SI FSalida = 0;
          nUniPromo = #0#4 / #1#2;
          nResto = #0#4 $ #1#2;
          nResto = nResto / #1#2;
          nUniPromo = nUniPromo  - nResto;
          #0#5 = nUniPromo * #1#3;
          nPrePromo = #1#4;
          |SI eaTipo = "L"; || llama desde las lineas
               #0#20 = 0;
          |FINSI;
          #0#7 = (enPrecio + #0#20 - nPrePromo) ! nDeci;
          #0#19 = #1#4;
          #0#20 = nPrePromo;
          enDto = #1#5;
     |SINO;
          #0#5 = 0;
          #0#7 = enPrecio + #0#20;
          #0#19 = 0;
          #0#20 = 0;
          enDto = 0;
     |FINSI;
     #0#6 = #0#4 + #0#5;
     enUnid1 = #0#6; || Unidades Facturacion
     enUnid2 = #0#4; || Unidades Stock
     enPrecio = #0#7;

     #0#14 = #0#4;
     #0#15 = #0#5;
     #0#16 = #0#6;

     |GRABA 020#0a;
     |CIERRA #0;
     |HAZ CierraFic1;
|FPRC;
