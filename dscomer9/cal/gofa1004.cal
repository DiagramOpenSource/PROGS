|FICHEROS;
     gofase01 #0;
     gofase02 #1;
     gofase03 #2;
     gopre002 #4;
     gofase10 #20;
     gofase04;
     gofase05;
     gofase08;
     gomantl1;
     gopre001;
     gomantho;
|FIN;

|VARIABLES;
     cAno           = "";
     cAnoIni        = "";
     cAnoFin        = "";
     cMonPre        = "";
     cConta         = "";
     cFecIni        = "";
     cFecFin        = "";
     cFecha         = "";
     cDia           = "";

     fFecha         = @;
     fDia           = @;
     fFecFin        = @;
     fFecIni        = @;
     fFecIniPar     = @;
     fFecFinPar     = @;
     fFecIniCap     = @;
     fFecFinCap     = @;
     fFecha5        = @;

     nDias = 0;
     fFechaIni = @;
     fFechaFin = @;
     nImporte = 0;
     aAviso = "";
     aFechaIni = "";
     aFechaFin = "";
     aFecha = "";
     aMesIni = "";
     aAnyoIni = "";
     aMesFin = "";
     aAnyoFin = "";
     aMes = "";
     aAnyo = "";
     aClave = "";
     nClave = 0;
     num = 0;
     fFechaHoy = @;
     nNume1 = 0;

     &efFechaIniRPT = @;
     &efFechaFinRPT = @;
     &eaRealPrev = "";
     &enInfo = 0;
     &aTeclaF = "";
|FIN;

|PROCESO calcula;
     num = num + 1;

     fFechaIni = #1#8;
     fFechaFin = #1#9;
     nDias = fFechaFin - fFechaIni + 1;
     |SELECT #6#4;
     #4#0 = #1#0;
     #4#1 = #1#1;
     #4#12 = #1#3;
     |LEE 000#4=;
     |SI FSalida = 0;
          nImporte = #4#7 / nDias;
     |SINO;
          aAviso = "    Error en lectura de presupuesto.";
          |MENAV aAviso;
     |FINSI;
     |SELECT #1#4;

|PARA fFecha = fFechaIni; |SI fFecha [ fFechaFin; |HACIENDO fFecha = fFecha + 1;

     aFechaIni = fFechaIni;
     aFechaFin = fFechaFin;
     aFecha = fFecha;
     aMesIni = aFechaIni % 402;
     aAnyoIni = aFechaIni % -104;
     aMesFin = aFechaFin % 402;
     aAnyoFin = aFechaFin % -104;
     aMes = aFecha % 402;
     aAnyo = aFecha % -104;
     aClave = aAnyo + aMes;
     nClave = aClave;

     #gofase10#0 = nClave;
     |LEE 000#gofase10.=:
     |SI FSalida = 0;
          #gofase10#1 = #gofase10#1 + nImporte;
          |GRABA 020#gofase10.a;
     |SINO;
          #gofase10#0 = nClave;
          #gofase10#1 = nImporte;
          #gofase10#2 = #0#0;
          #gofase10#3 = #0#1;
          #gofase10#4 = num;
          |GRABA 020#gofase10.n;
     |FINSI;
|SIGUE;
|FPRC;

|DEFBUCLE gofase02_meses;
     #1#1;
     ;                                          ||Campos Extras.
     #0#0, #0#1,   1;
     #0#0, #0#1, 999;
     ;                                          ||b/e Bloqueo-Ordenacion.
     NULL, calcula;
|FIN;


|PROCESO TotalMeses;
     |DELINDEX #20;
     |ABRE #gofase10;
     |ABRE #4;           || gopre002
     |BUCLE gofase02_meses;
     |CIERRA #4;         || gopre002
     |CIERRA #gofase10;
|FPRC;



|PROCESO Imprimir;
     |PRINT;
|FPRC;

|PROCESO Imprimir05;
     |SI #gofase05#11 = "01.01.0000";
          #gofase05#11 = fFechaHoy;
     |FINSI;
     |SI #gofase05#12 = "01.01.0000";
          nNume1 = #gofase05#11;
          nNume1 = nNume1 + 1;
          #gofase05#12 = nNume1;
     |FINSI;
     |PRINT;
|FPRC;
-------------------------------------------------------------------------------
|DEFBUCLE ImpFasPar;
     #2#1;
     ;                                          ||Campos Extras.
     #0#0, #0#1, "                   ",   1;
     #0#0, #0#1, "zzzzzzzzzzzzzzzzzzz", 999;
     ;                                          ||b/e Bolqueo-Ordenacion.
     NULL, Imprimir;
|FIN;
-------------------------------------------------------------------------------
|DEFBUCLE gopre002;
     #4#1;
     ;                                          ||Campos Extras.
     #0#0, #0#1,   1;
     #0#0, #0#1, 999;
     ;                                          ||b/e Bolqueo-Ordenacion.
     NULL, Imprimir;
|FIN;
-------------------------------------------------------------------------------
|DEFBUCLE gofase10;
     #20#1;
     ;                                          ||Campos Extras.
     1;
     999999;
     ;                                          ||b/e Bolqueo-Ordenacion.
     NULL, Imprimir;
|FIN;
-------------------------------------------------------------------------------
|PROCESO gofase10_PRINT;
     enInfo = 3;
     |PRINT;
|FPRC;

|DEFBUCLE gofase10_RPT;
     #20#1;
     ;                                          ||Campos Extras.
     1;
     999999;
     ;                                          ||b/e Bolqueo-Ordenacion.
     NULL, gofase10_PRINT;
|FIN;
-------------------------------------------------------------------------------
|DEFBUCLE gofase05;
     #gofase05#1;
     ;
     #0#0, #0#1, 001;
     #0#0, #0#1, 999;
     ;
     NULL, Imprimir05;
|FIN;
------------------------------------------------------------------------------
|PROCESO BuscaExp;
     |ABRE #gopre001;
     |ABRE #gomantho;
     #gopre001#0 = #0#0;
     #gopre001#1 = #0#1;
     |LEE 000#gopre001.=;
     #gomantho#0 = #gomantl1#0;
     #gomantho#1 = #gomantl1#1;
     |LEE 000#gomantho.=;
     |CIERRA #gomantho;
     |CIERRA #gopre001;

|FPRC;
------------------------------------------------------------------------------
|DEFBUCLE BuscaExp;
     #gomantl1#2;
     ;
     "     ", 000000, #0#0, #0#1;
     "zzzzz", 999999, #0#0, #0#1;
     ;
     NULL, BuscaExp;
|FIN;
------------------------------------------------------------------------------
|DEFBUCLE Lineas;
     #1#1;
     ;
     #0#0, #0#1, 001;
     #0#0, #0#1, 999;
     ;
     NULL, Imprimir;
|FIN;

|PROCESO Gantt;
     |LEE 020#0=;

     |SUB_EJECUTA_NP "goinform;IMPgofase01";
     |BUCLE BuscaExp;
     |INFOR "gofase01";
     |PRINT;
     |PIEINF;
     |FININF;
     |SUB_EJECUTA_NP "goinform;ENVgofase01";

     |SUB_EJECUTA_NP "goinform;IMPgofase02";
     |INFOR "gofase02";
     |BUCLE Lineas;
     |PIEINF;
     |FININF;
     |SUB_EJECUTA_NP "goinform;ENVgofase02";

     |SUB_EJECUTA_NP "goinform;IMPgofase03";
     |INFOR "gofase03";
     |BUCLE ImpFasPar;
     |PIEINF;
     |FININF;
     |SUB_EJECUTA_NP "goinform;ENVgofase03";

     |SUB_EJECUTA_NP "goinform;IMPgofase04";
     |INFOR "gofase04";
     |PRINT;
     |PIEINF;
     |FININF;
     |SUB_EJECUTA_NP "goinform;ENVgofase04";

     |SUB_EJECUTA_NP "goinform;IMPgofase05";
     |INFOR "gofase05";
     fFechaHoy = ~;
     |BUCLE gofase05;
     |CIERRA #0;
     |PIEINF;
     |FININF;
     |SUB_EJECUTA_NP "goinform;ENVgofase05";

     |SUB_EJECUTA_NP "goinform;IMPgopre002";
     |INFOR "gopre002";
     |BUCLE gopre002;
     |PIEINF;
     |FININF;
     |SUB_EJECUTA_NP "goinform;ENVgopre002";

     |SUB_EJECUTA_NP "goinform;IMPgofase10";

     |INFOR "gofase10";
     |HAZ TotalMeses;
     |BUCLE gofase10;
     |PIEINF;
     |FININF;
     |SUB_EJECUTA_NP "goinform;ENVgofase10";

     |SUB_EJECUTA_NP "goinform;RUNFASES";
|FPRC;

-------------------------------------------------------------------------------

|PROCESO PrintRPT;
     enInfo = 1;
     efFechaIniRPT = #1#8;
     efFechaFinRPT = #1#9;
     eaRealPrev = "P";
     |PRINT;

     |SI aTeclaF = "5";
          enInfo = 1;
          efFechaIniRPT = #1#11;
          efFechaFinRPT = #1#12;
          eaRealPrev = "R";
          |PRINT;
     |FINSI;
|FPRC;

|DEFBUCLE LinRPT;
     #1#1;
     ;
     #0#0, #0#1, 001;
     #0#0, #0#1, 999;
     ;
     NULL, PrintRPT;
|FIN;

|PROCESO ImprePrecios;
     enInfo = 2;
     |PRINT;
|FPRC;

|DEFBUCLE Precios;
     #4#1;
     ;                                          ||Campos Extras.
     #0#0, #0#1,   1;
     #0#0, #0#1, 999;
     ;                                          ||b/e Bolqueo-Ordenacion.
     NULL, ImprePrecios;
|FIN;

|PROCESO ImpreRPT;
     |LEE 020#0=;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |BUCLE BuscaExp;

     Impresora = "CrystalReport";
     |IMPRE -1;
     |SI FSalida = 0;
          |INFOR "gofgantt";
          |SI FSalida = 0;
               |BUCLE LinRPT;
               |BUCLE Precios;
               |HAZ TotalMeses;
               |BUCLE gofase10_RPT;
               |PIEINF;
               |FININF;
          |FINSI;
          |FINIMP;
     |FINSI;
|FPRC;
