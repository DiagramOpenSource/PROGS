|FICHEROS;
     champ003 #0;
     referen@ #1;   || champ004, champ005
     agifa019 #19;
|FIN;

|VARIABLES;
     &enBultos = 0;
     &eaTipo = "";
     &eArtChampi = "";
     &eaArticulo = "";
     &eaSerie = "";
     &enCodigo = 0;
     &enLinea = 0;
     &enUnidades = 0;

     &n_dec = 0;

     nPeso = "";
     aAlfa = "";
     nHandle = 0;
     aDef = "";
|FIN;

|PROCESO Na; |TIPO 12;
|FPRC;

|PROCESO Mensa; |TIPO 7;
     |SI eaTipo = "COMPRAS";
          |MENSA "0000<F2> Recoger datos bascula";
     |FINSI;
|FPRC;

|PROCESO Tecla; |TIPO 0;
     #0Campo = #0Campo ! n_dec;
     |SI FSalida = 10; |Y eaTipo = "COMPRAS";
          |HAZ LeePeso;
          #0Campo = nPeso;
          |ERROR;
     |FINSI;
|FPRC;

|PROCESO LeePeso;
     |RSYSTEM "/ds/bin/leepeso";
     |SLEEP 1;
     |XABRE "CU", "/ds/peso.txt", nHandle;
     |SI FSalida ! 0 ;
          |MENAV "0000No puedo abrir: /ds/peso.txt";
     |SINO;
          |XLEE nHandle ,250 , aAlfa;
          nPeso = aAlfa;
          |XCIERRA nHandle;
     |FINSI;
|FPRC;

|PROCESO Tara; |TIPO 0;
     |SI #0Campo ! Contenido; |O eArtChampi ! eaArticulo;
          eArtChampi = eaArticulo;
          |ABRE #19;
          #19#0 = eaArticulo;
          |LEE 020#19=;
          |CIERRA #19;
          #0#2 = #0#0 * #19#102;
          |PINTA #0#2;
     |FINSI;
|FPRC;

|PROGRAMA;
     |DDEF aDef;
     |SI eaTipo = "AV"; aDef =  aDef + "champ004"; |FINSI;
     |SI eaTipo = "AC"; aDef =  aDef + "champ005"; |FINSI;

     |CARGA_DEF aDef, referen@;
     |SI FSalida = 0;
          |DDEFECTO #0;
          |ABRE #1;
          #1#0 = eaSerie;
          #1#1 = enCodigo;
          #1#2 = enLinea;
          |LEE 101#1=;
          |SI FSalida ! 0;
               |GRABA 020#1b;
          |FINSI;
          #0#0 = #1#3;
          #0#1 = #1#4;
          #0#2 = #1#5;
          |BLANCO 14202155;
          |PINPA #0#0;
          |PINDA #0#0;
          |ENDATOS #1#0;
          |SI FSalida = 0;
               #1#3 = #0#0;
               #1#4 = #0#1;
               #1#5 = #0#2;
               |SI eaTipo = "AC";
                    |ABRE #19;
                    #19#0 = eaArticulo;
                    |LEE 020#19=;
                    |CIERRA #19;
                    aAlfa = #19#127; |QBF aAlfa;
                    |SI aAlfa = "";
                         #1#6 = "";
                         #1#7 = 0;
                    |SINO;
                         #1#6 = #19#127;
                         #1#7 = #1#3 * #19#114;
                    |FINSI;
               |FINSI;
          |FINSI;
          |GRABA 020#1a;
          |CIERRA #1;
          |DESCARGA_DEF #referen@;

          enUnidades = #0#1 - #0#2;
          enBultos = #0#1;
     |SINO;
          |MENAV "0000ERROR al cargar champ00?";
     |FINSI;
|FPRO;
