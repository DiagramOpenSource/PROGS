|FICHEROS;
     diaz0022 #0;
     agifa024 #3;
     agifa091 #6;
     agifa010 #10;
     dsz99984 #11;
     agifa133 #17;
     agifa059 #59;
     agifa071 #71;
     agis0002 #98;
     agifa177 #99;
     tmp00000 #100;
     agifa134 #134;
     agifa142 #142;
     refe010@;
     refe059@;
     refe071@;
     refe134@;
|FIN;

|VARIABLES;
     &eaProg = "";
     &aDivisa = "";
     &aMoneda = "";
     &Tempo = "";
     &enB1 = 0;
     &enB2 = 0;
     &enB3 = 0;
     &enB4 = 0;
     &enB5 = 0;
     aPath = "";
     aAlfa = "";
     aTmp010 = "";
     aTmp059 = "";
     aTmp071 = "";
     aTmp134 = "";
     aTmp100 = "";
     nPrime = 0;
     nImpre = -1;
     nInfor = -1;
     aSerAlb = "";
     nNumAlb = 0;
     aSerFac = "";
     nNumFac = 0;
     nVto = 0;
     nRecibo = 0;
|FIN;

|PROCESO hazreci;
     |ABRE #3;
     #3#0 = #134#2;
     |LEE 000#3=;
     |CIERRA #3;

     |ABRE #6;
     #6#0 = #134#11;
     |LEE 000#6=;
     |CIERRA #6;

     |ABRE #17;
     |ABRE #98;
     |ABRE #99;

     nVto = 0;
     #17#0 = #134#0;
     #17#4 = #134#49;
     #17#1 = 0;
     |LEE 000#17];
     |PARA ; |SI FSalida = 0; |Y #17#0 = #134#0;|Y #17#4 = #134#49; |HACIENDO;
          nVto = nVto + 1;
          |LEE 000#17s;
     |SIGUE;

     |HAZ AbreRecVenta;
     nRecibo = 0;
     #17#0 = #134#0;
     #17#4 = #134#49;
     #17#1 = 0;
     |LEE 000#17];
     |PARA ; |SI FSalida = 0; |Y #17#0 = #134#0;|Y #17#4 = #134#49; |HACIENDO;
          nRecibo = nRecibo + 1;
          |SI #17#5 = "S";
               |DDEFECTO #98;
               #98#30 = "A";       || busca como albaran
               #98#20 = #17#6;     || Serie pedido.
               #98#17 = #17#7;     || Numero pedido.
               #98#18 = #17#8;     || Numero recibo.
               |LEE 000#98=;
               |SI FSalida ! 0;
                    #98#30 = "P";       || busca como pedido
                    |LEE 000#98=;
               |FINSI;
          |FINSI;
          |DDEFECTO #11;
          #11#17 = #134#49;
          #11#0 = #134#0;
          #11#1 = #17#1;           || Linea;
          #11#2 = #134#2;            || cliente
          #11#3 = #134#3;            || nombre del cliente
          #11#4 = #134#9;            || Banco
          #11#5 = "S";             || domiciliado
          #11#6 = "N";             || aceptado
          #11#7 = #134#1;            || fecha de emision
          #11#8 = #17#3;           || Fecha de vencimiento
          #11#23 = nVto;
          #11#9 = #17#2;             || Importe
          |SI #17#5 = "S";
              #11#10 = #98#10;
              #11#11 = #98#11;
          |SINO;
              #11#10 = "N";            || Impreso
              #11#11 = "N";            || Contabilizado
          |FINSI;
          |SI #142#63 = "S";     ||  COGE LA CTA.CONTABLE DEL TIPO DE RECIBO.
              #99#0 = #6#69;
              |LEE 000#99=;
              |SI FSalida = 0;
                   #11#12 = #99#3;     || NUMERO CTA.CONTABLE.
              |SINO;
                   #11#12 = #134#12;     || NUMERO CTA.CONTABLE.
              |FINSI;
          |SINO;
              #11#12 = #134#12;     || NUMERO CTA.CONTABLE.
          |FINSI;
          #11#13 = #98#13;
          #11#16 = #98#16;
          #11#22 = "Cobrado";
          #11#24 = #134#11;          || Forma de Pago
          #11#25 = #6#1;           || Descripcion de la forma de Pago
          #11#14 = "N";            || Impagado
          #11#15 = #3#161;         || A aceptar
          |SI #17#5 = "S";
              #11#21 = #98#22;         || Tipo de Recibo (entr.a cta.)
          |SINO;
              #11#21 = #6#69;          || Tipo de Recibo (forma de pago)
          |FINSI;
          |SI nRecibo = nVto; |Y #6#70 ! 0;
              #11#21 = #6#73;          || Tipo de Recibo (Fianza Retenida)
          |FINSI;
          #11#24 = #6#0;
          #11#25 = #6#1;
          eaProg = "agifa134";
          ||HAZ CreaRecVenta;
          |HAZ RecVenta;
          |LEE 000#17s;
     |SIGUE;
     |HAZ CierraRecVenta;

     |CIERRA #11;
     |CIERRA #17;
     |CIERRA #98;
     |CIERRA #99;
|FPRC;

|PROCESO Tmp;
     #134#49 = #100#0;
     #134#0 = #100#1;
     |LEE 121#134=;
     |SI FSalida = 0;
          aDivisa = #134#58;
          aMoneda = #134#60;
          |HAZ Divisas134;

          |HAZ CalCabAgifa134;

          |GRABA 020#134a;
          |LIBERA #134;

          |HAZ VenciVta;
          |SI #134#45 = "S";
               |SI #142#146 ! "N"; |O #134#101 ! 0;
                    |HAZ hazreci;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE Tmp;
     #100#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Tmp;
|FIN;

|PROCESO Imprime;
     |SI nPrime = 0;
          nPrime = 1;
          |IMPRE 0;
          nImpre = FSalida;
          |SI FSalida = 0;
               |INFOR "diaz0022";
               nInfor = FSalida;
          |FINSI;
     |FINSI;
     |SI nInfor = 0; |PRINT; |FINSI;
|FPRC;

|PROCESO agifa071;
     |SALVA_DATOS #refe071@;
     |REPON_DATOS #71;
     |GRABA 000#71n;
|FPRC;

|DEFBUCLE agifa071;
     #refe071@#1003;
     ;
     aSerAlb, nNumAlb, 001;
     aSerAlb, nNumAlb, 999;
     ;
     NULL, agifa071;
|FIN;

|PROCESO agifa010;
     |BUCLE agifa071;
     |SALVA_DATOS #refe010@;
     |REPON_DATOS #10;
     |GRABA 000#10n;
     |SI FSalida ! 0;
          aAlfa = "0000Albaran incluido en mas de una factura:" + #10#52 + "/" + (("000000" + #10#0)% -106);
          |MENAV aAlfa;
     |FINSI;
|FPRC;

|DEFBUCLE agifa010;
     #refe010@#1002;
     ;
     aSerAlb, nNumAlb;
     aSerAlb, nNumAlb;
     ;
     NULL, agifa010;
|FIN;

|PROCESO agifa059;
     aSerAlb = #refe059@#14;
     nNumAlb = #refe059@#2;
     |BUCLE agifa010;
     |SALVA_DATOS #refe059@;
     |REPON_DATOS #59;
     |GRABA 020#59n;
|FPRC;

|DEFBUCLE agifa059;
     #refe059@#1003;
     ;
     aSerFac, nNumFac, 001;
     aSerFac, nNumFac, 999;
     ;
     NULL, agifa059;
|FIN;

|PROCESO agifa134;
     aSerFac = #refe134@#49;
     nNumFac = #refe134@#0;
     |BUCLE agifa059;
     |SALVA_DATOS #refe134@;
     |REPON_DATOS #134;
     |GRABA 020#134b;

     aDivisa = #134#58;
     aMoneda = #134#60;
     |HAZ Divisas134;

     |HAZ CalCabAgifa134;
     |GRABA 020#134a;
     |LIBERA #134;

     |SI #refe134@#92 ! #134#92;
               |O #refe134@#95 ! #134#95;
               |O #refe134@#98 ! #134#98;
               |O #refe134@#103 ! #134#103;
               |O #refe134@#106 ! #134#106;
          enB1 = #refe134@#92;
          enB2 = #refe134@#95;
          enB3 = #refe134@#98;
          enB4 = #refe134@#103;
          enB5 = #refe134@#106;
          |HAZ Imprime;

          #100#0 = #134#49;
          #100#1 = #134#0;
          |GRABA 020#100n;
     |FINSI;
|FPRC;

|DEFBUCLE agifa134;
     #refe134@#3004;
     ;
     #0#6, #0#4, #0#0, #0#2;
     #0#7, #0#5, #0#1, #0#3;
     ;
     NULL, agifa134;
|FIN;

|PROCESO Tipo3; |TIPO 3;
     |ABRE #142; |LEE 000#142p; |CIERRA #142;

     |HAZ CreaTempo; aTmp100 = Tempo; |NOME_DAT #100Tempo; |DELINDEX #100;

     |DDEF aPath;
     aAlfa = aPath + "agifa010"; |CARGA_DEF aAlfa, refe010@;
     aAlfa = aPath + "agifa059"; |CARGA_DEF aAlfa, refe059@;
     aAlfa = aPath + "agifa071"; |CARGA_DEF aAlfa, refe071@;
     aAlfa = aPath + "agifa134"; |CARGA_DEF aAlfa, refe134@;

     |HAZ CreaTempo; aTmp010 = Tempo; |NOME_DAT #10Tempo; |DELINDEX #10;
     |HAZ CreaTempo; aTmp059 = Tempo; |NOME_DAT #59Tempo; |DELINDEX #59;
     |HAZ CreaTempo; aTmp071 = Tempo; |NOME_DAT #71Tempo; |DELINDEX #71;
     |HAZ CreaTempo; aTmp134 = Tempo; |NOME_DAT #134Tempo; |DELINDEX #134;

     |ABRET #10;
     |ABRET #59;
     |ABRET #71;
     |ABRET #134;
     |ABRE #100;
     |BUCLE agifa134;
     |CIERRA #100;
     |CIERRAT #134;
     |CIERRAT #71;
     |CIERRAT #59;
     |CIERRAT #10;

     Tempo = aTmp010; |HAZ BoraTempo; |DELINDEX #10;
     Tempo = aTmp059; |HAZ BoraTempo; |DELINDEX #59;
     Tempo = aTmp071; |HAZ BoraTempo; |DELINDEX #71;
     Tempo = aTmp134; |HAZ BoraTempo; |DELINDEX #134;
     |DESCARGA_DEF #refe134@;
     |DESCARGA_DEF #refe071@;
     |DESCARGA_DEF #refe059@;
     |DESCARGA_DEF #refe010@;

     |SI nPrime = 0;
          |MENAV "0000No se ha encontrado errores...";
     |SINO;
          |SI nInfor = 0; |PIEINF; |FININF; |FINSI;
          |SI nImpre = 0; |FINIMP; |FINSI;

          |SI #0#8 = "S";
               |MENSA "0000Recalculando...";
               aAlfa = "agifa010"; |NOME_DAT #10aAlfa;
               aAlfa = "agifa059"; |NOME_DAT #59aAlfa;
               aAlfa = "agifa071"; |NOME_DAT #71aAlfa;
               aAlfa = "agifa134"; |NOME_DAT #134aAlfa;
               |ABRE #134;
               |BUCLE Tmp;
               |CIERRA #134;
          |FINSI;
     |FINSI;
     Tempo = aTmp100; |HAZ BoraTempo; |DELINDEX #100;
|FPRC;
