|FICHEROS;
 platm002 #0;
|FIN;


|VARIABLES;
     &aSalida = 0;
     &aElDni = "";
     &aCod1 = "";
     &aCod2 = "";
     &aCodigo = "";
     &CmpDivisa = 0;  &MaxDigit = 0;    &UltNivel = 0;
     &Divisa = "";    &CambioDivVn = 0; &CambioDivCm = 0;
     &CambioBaseVn = 0; &CambioBaseCm = 0; &NombreDiv = "";
     &nDeci_Base = 0; &nDeci_Div = 0;   &nDeci_males = 0;
     &HayGestion = 0; &HayConta = 0;    &enDocum = 0;

     &DCampoG = 0;  &HCampoG = 0;  &DCampoC = 0;  &HCampoC = 0;
     &PosLibro = 0; &PosSerie = 0; &PosFactu = 0; &PosRecib = 0;

     &enEmpCartera = 0; &enEmpGestion = 0; &enRiesgoUsado = 0; &enRiesgoConced = 0;
     &eaSerie = ""; &eaCliGest = ""; &nImporte = 0; &eaTipoOper = ""; &eaNomCli = "";
     &enBanco = 0;  &eaSinAlta = "N";
     &TipoCliente = ""; &CodCliente  = ""; &NumDigito = 0;
     &Nombre    = ""; &Direccion = "";
     &CP1       = ""; &CP2       = "";
     &Poblacion = ""; &Provincia = "";
     &DNI       = ""; &Telefono  = "";
     &Fax       = "";

     &Fichero   = "";  &Cmp = "";   &Tipo = ""; &CmpNum = 0;
     &aInforme  = "";

     &eaEntidad = ""; &eaSucursal = ""; &eaCuenta = ""; &eaDC = "";
     Comodin1 = ""; Comodin 2 = ""; Comod = ""; Comod1 = "";
     Cont = 0; Digito1 = 0; Digito2 = 0; Calc = 0; Calc1 = 0; Calc2 = 0;

     aLetra1 = ""; aLetra2 = ""; aLetra3 = ""; aLetra4 = ""; aLetra5 = "";
     aLetra6 = ""; aLetra7 = ""; aLetra8 = "";
     aCadena   = "";
     aCaracter = "";
     aCarac1 = 0; aCarac2 = 0; aCarac3 = 0; aCarac4 = 0; aCarac5 = 0;
     nCaracter   = 0;
     nPosi       = 0;
     Tecla       = 0;

     Comodin = ""; aLong = ""; nLong = 0; ComodNum = 0;
     SwHay = 0; RiesgoUtil = 0; nCont = 0;
     aNifQbf1   = "";
     aNifQbf2   = "";
     aAlfa      = "";

     &eaVarDni  = "";
     &enCalcCif = 0;
|FIN;

|CALCULO DigitoControl;|TIPO 7;
|SI #0#15 = "  ";
  eaSucursal = #0#13;
  eaEntidad = #0#12;
  eaCuenta = #0#14;
  |QBF eaEntidad; eaEntidad = eaEntidad % 104;
  |QBF eaSucursal; eaSucursal = eaSucursal % 104;
  |QBF eaCuenta; eaCuenta = eaCuenta % 110;
  eaDC = "";
  |HAZ CalculoDC;
  #0#15 = eaDC;
  |PINTA #0#15;
|FINSI;
|FCAL;

|PROCESO Digito2;
||     eaEntidad = #0#32; |QBF eaEntidad; eaEntidad = eaEntidad % 104;
||     eaSucursal = #0#33; |QBF eaSucursal; eaSucursal = eaSucursal % 104;
||     eaCuenta = #0#30; |QBF eaCuenta; eaCuenta = eaCuenta % 110;
||     eaDC = "";
||     |HAZ CalculoDC;
||     #0#31 = eaDC;
||     |PINTA #0#31;
|FPRC;

|PROCESO CalculoDC;
   Digito1 = 0; Digito2 = 0;
   Comodin1 = ""; Comodin2 = "";

   |PARA Cont = 1; |SI Cont [ 4; |HACIENDO Cont = Cont + 1;
      Calc = 0 - ((100 * Cont) + 1);
      aCaracter = eaSucursal % Calc;
      |SI aCaracter = ""; aCaracter = "0"; |FINSI;
      Comodin1 = Comodin1 + aCaracter;
   |SIGUE;
   |PARA Cont = 1; |SI Cont [ 4; |HACIENDO Cont = Cont + 1;
      Calc = 0 - ((100 * Cont) + 1);
      aCaracter = eaEntidad % Calc;
      |SI aCaracter = ""; aCaracter = "0"; |FINSI;
      Comodin1 = Comodin1 + aCaracter;
   |SIGUE;

   |PARA Cont = 1; |SI Cont [ 8; |HACIENDO Cont = Cont + 1;
      Calc = (100 * Cont) + 1;
      aCaracter = Comodin1 % Calc; Calc = aCaracter;
      |SI Cont = 1; Digito1 = Digito1 + (Calc * 6);  |FINSI;
      |SI Cont = 2; Digito1 = Digito1 + (Calc * 3);  |FINSI;
      |SI Cont = 3; Digito1 = Digito1 + (Calc * 7);  |FINSI;
      |SI Cont = 4; Digito1 = Digito1 + (Calc * 9);  |FINSI;
      |SI Cont = 5; Digito1 = Digito1 + (Calc * 10); |FINSI;
      |SI Cont = 6; Digito1 = Digito1 + (Calc * 5);  |FINSI;
      |SI Cont = 7; Digito1 = Digito1 + (Calc * 8);  |FINSI;
      |SI Cont = 8; Digito1 = Digito1 + (Calc * 4);  |FINSI;
   |SIGUE;

   Digito1 = 11 - (Digito1 $ 11);
   |SI Digito1 = 10; Digito1 = 1; |FINSI;
   |SI Digito1 = 11; Digito1 = 0; |FINSI;

   |PARA Cont = 1; |SI Cont [ 10; |HACIENDO Cont = Cont + 1;
      Calc = 0 - ((100 * Cont) + 1);
      aCaracter = eaCuenta % Calc;
      |SI aCaracter = ""; aCaracter = "0"; |FINSI;
      Comodin2 = Comodin2 + aCaracter;
   |SIGUE;

   |PARA Cont = 1; |SI Cont [ 10; |HACIENDO Cont = Cont + 1;
      Calc = (100 * Cont) + 1;
      aCaracter = Comodin2 % Calc; Calc = aCaracter;
      |SI Cont = 1;  Digito2 = Digito2 + (Calc * 6);  |FINSI;
      |SI Cont = 2;  Digito2 = Digito2 + (Calc * 3);  |FINSI;
      |SI Cont = 3;  Digito2 = Digito2 + (Calc * 7);  |FINSI;
      |SI Cont = 4;  Digito2 = Digito2 + (Calc * 9);  |FINSI;
      |SI Cont = 5;  Digito2 = Digito2 + (Calc * 10); |FINSI;
      |SI Cont = 6;  Digito2 = Digito2 + (Calc * 5);  |FINSI;
      |SI Cont = 7;  Digito2 = Digito2 + (Calc * 8);  |FINSI;
      |SI Cont = 8;  Digito2 = Digito2 + (Calc * 4);  |FINSI;
      |SI Cont = 9;  Digito2 = Digito2 + (Calc * 2);  |FINSI;
      |SI Cont = 10; Digito2 = Digito2 + (Calc * 1);  |FINSI;
   |SIGUE;

   Digito2 = 11 - (Digito2 $ 11);
   |SI Digito2 = 10; Digito2 = 1; |FINSI;
   |SI Digito2 = 11; Digito2 = 0; |FINSI;

   eaDC = Digito1 + Digito2;
|FPRC;


|CALCULO CodPost;
 aCod1 = #0#6;
 aCod2 = #0#7;
 |HAZ cp1;
 #0#8 = aCodigo;
|FCAL;

|PROCESO LetraDni002;
     |SI FSalida = 9;
          eaVarDni  = #0Campo;
          |HAZ CalculoNIFCIF;
          #0Campo = eaVarDni;
          |PINTA #0Campo;
          |ERROR; |ACABA;
     |FINSI;

     eaVarDni  = #0Campo;
     |HAZ CalculoNIFCIF;
     |SI FSalida = 9;
          eaVarDni  = #0Campo;
          |HAZ CalculoNIFCIF;
          #0Campo = eaVarDni;
          |PINTA #0Campo;
          |ERROR; |ACABA;
     |FINSI;

     eaVarDni  = #0Campo;
     |HAZ CalculoNIFCIF;

     aNifQbf1 = #0Campo;   |QBF aNifQbf1;
     aNifQbf2 = eaVarDni;  |QBF aNifQbf2;

     |SI aNifQbf1 ! aNifQbf2; |Y aNifQbf1 ! "";
          aAlfa = "0000NEl NIF puede ser erróneo."+&13+"¿Desea calcularlo?";
          |CONFI aAlfa;
          |SI FSalida = 0;
               #0Campo = eaVarDni; |PINTA #0Campo;
          |FINSI;
     |FINSI;
|FPRC;
