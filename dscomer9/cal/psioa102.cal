          NO SE USA

|FICHEROS;
     psioa002 #0;
     psioa001 #1;
     referen@ #2;
|FIN;

|VARIABLES;
     &aFicDes = "";
     &variable = "";
     &enPrime = 0;
     {10}&eaDife = "";
     {10}&eaVariable = "";

     {100}aCampo = "";
     {100}Valor = "";
     CRLF = "";
     TAB = "";
     aNomDef = "";
     aNomAsc = "";
     nCampo = 0;
     nSal = 0;
     aAlfa = "";
     aDef = "";
     aAlf1 = "";
     aLon = "";
     aDato = "";
     aReg = "";
     aTab = "";
     i = 0;
     nPos = 0;
     aLetra = "";
     nMaxCampo = 0;
     nHandle = 0;
     nCampos = 0;
     aLon1 = "";
     aLon2 = "";
     nLon1 = 0;
     nLon2 = 0;
     nNume = 0;
     nExiste = 0;
|FIN;

|PROCESO Compara4;
     aAlfa = aDef + aNomDef;
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |DDEFECTO #referen@;
          |ABRE #referen@;
          #referen@#1 = #0#0;
          #referen@#2 = aCampo1;
          #referen@#3 = aCampo2;
          #referen@#4 = aCampo3;
          |LEE 000#referen@.=;
          nExiste = FSalida;
          |SI FSalida ! 0; |GRABA 020#referen@.b; |FINSI;
          |SI FSalida = 0;
               #referen@#0 = "S";
               |HAZ CmpCampo;
               |SI nSal ! 0;  |O nExiste ! 0;   || No son iguales
                    |HAZ CpCampo;
               |FINSI;
               |GRABA 020#referen@.a;
          |FINSI;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
     FSalida = nSal;
|FPRC;

|PROCESO Compara3;
     aAlfa = aDef + aNomDef;
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |DDEFECTO #referen@;
          |ABRE #referen@;
          #referen@#1 = #0#0;
          #referen@#2 = aCampo1;
          #referen@#3 = aCampo2;
          |LEE 000#referen@.=;
          nExiste = FSalida;
          |SI FSalida ! 0; |GRABA 020#referen@.b; |FINSI;
          |SI FSalida = 0;
               #referen@#0 = "S";
               |HAZ CmpCampo;
               |SI nSal ! 0; |O nExiste ! 0;     || No son iguales
                    |HAZ CpCampo;
               |FINSI;
               |GRABA 020#referen@.a;
          |FINSI;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
     FSalida = nSal;
|FPRC;

|PROCESO Compara2;
     aAlfa = aDef + aNomDef;
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |DDEFECTO #referen@;
          |ABRE #referen@;
          #referen@#1 = #0#0;
          #referen@#2 = aCampo1;
          |LEE 000#referen@.=;
          nExiste = FSalida;
          |SI FSalida ! 0; |GRABA 020#referen@.b; |FINSI;
          |SI FSalida = 0;
               #referen@#0 = "S";
               |HAZ CmpCampo;
               |SI nSal ! 0; |O nExiste ! 0;    || No son iguales
                    |HAZ CpCampo;
               |FINSI;
               |GRABA 020#referen@.a;
          |FINSI;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
     FSalida = nSal;
|FPRC;

|PROCESO Compara1;
     aAlfa = aDef + aNomDef;
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |DDEFECTO #referen@;
          |ABRE #referen@;
          #referen@#1 = #0#0;
          |LEE 000#referen@.=;
          nExiste = FSalida;
          |SI FSalida ! 0; |GRABA 020#referen@.b; |FINSI;
          |SI FSalida = 0;
               #referen@#0 = "S";
               |HAZ CmpCampo;
               |SI nSal ! 0; |O nExiste ! 0;     || No son iguales
                    |HAZ CpCampo;
               |FINSI;
               |GRABA 020#referen@.a;
          |FINSI;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
     FSalida = nSal;
|FPRC;

|PROCESO ComVisitas;
     aAlfa = aDef + aNomDef;
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |DDEFECTO #referen@;
          |ABRE #referen@;
          #referen@#1 = #0#0;
          #referen@#3 = aCampo2;
          #referen@#5 = aCampo4;
          |LEE 000#referen@.=;
          nExiste = FSalida;
          |SI FSalida ! 0; |GRABA 020#referen@.b; |FINSI;
          |SI FSalida = 0;
               #referen@#0 = "S";
               |HAZ CmpCampo;
               |SI nSal ! 0; |O nExiste ! 0;    || No son iguales
                    |HAZ CpCampo;
               |FINSI;
               |GRABA 020#referen@.a;
          |FINSI;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
     FSalida = nSal;
|FPRC;

|PROCESO ComArti2;
     aAlfa = aDef + aNomDef;
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |DDEFECTO #referen@;
          |ABRE #referen@;
          #referen@#1 = #0#0;
          #referen@#4 = aCampo3;
          |LEE 000#referen@.=;
          nExiste = FSalida;
          |SI FSalida ! 0; |GRABA 020#referen@.b; |FINSI;
          |SI FSalida = 0;
               #referen@#0 = "S";
               |HAZ CmpCampo;
               |SI nSal ! 0; |O nExiste ! 0;   || No son iguales
                    |HAZ CpCampo;
               |FINSI;
               |GRABA 020#referen@.a;
          |FINSI;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
     FSalida = nSal;
|FPRC;

|PROCESO CpCampo;
     IaCampo = aCampo1<-;
     nCampo = 2;
     |PARA i = 1; |SI i [ nMaxCampo; |HACIENDO i = i + 1;
          #referen@#nCampo# = aCampo;
          nCampo = nCampo + 1;
          IaCampo = IaCampo + 1;
     |SIGUE;
     |SI nExiste ! 0; nSal = 1; |FINSI;
|FPRC;

|PROCESO CmpCampo;
     nSal = 0;     || Iguales
     IaCampo = aCampo1<-;
     nCampo = 2;
     |PARA i = 1; |SI i [ nMaxCampo; |HACIENDO i = i + 1;
          aAlfa = #referen@#nCampo#;
          aAlf1 = aCampo;
          |QBF aAlfa;
          |QBF aAlf1;
          |SI aAlf1 ! aAlfa;
               nSal = 1;|SAL;      || Distintos
          |FINSI;
          nCampo = nCampo + 1;
          IaCampo = IaCampo + 1;
     |SIGUE;
     FSalida = nSal;
|FPRC;

|PROCESO CargaCampo;
     IValor = Valor1<-;
     |PARA i = 1; |SI i [ nMaxCampo; |HACIENDO i = i + 1;
          aCampo = Valor;
          IaCampo = IaCampo + 1;
          IValor = IValor + 1;
     |SIGUE;
|FPRC;

|PROCESO Dato;
     nCampo = 1;
     IValor = Valor1<-;
     aLon = aDato % A0;
     aReg = "";
     aTab = &9;
     |PARA i = 1; |SI i [ aLon; |HACIENDO i = i + 1;
          nPos = i * 100 + 1;
          aLetra = aDato % nPos;
          |SI aLetra = aTab;
               Valor = aReg;
               aReg = "";
               nCampo = nCampo + 1;
               IValor = IValor + 1;
               nMaxCampo = nMaxCampo + 1;
          |SINO;
               aReg = aReg + aLetra;
          |FINSI;
          |SI nCampo > 99; |SAL; |FINSI;     || Por si.... :)
     |SIGUE;
     Valor = aReg - CRLF;
|FPRC;

|PROCESO Diferencia;
     |SI enPrime = 0;              || La primera vez
          IeaDife = eaDife1<-;
          enPrime = 1;
     |FINSI;

     nSal = 1;          || Por defecto distinto

     eaDife = variable;
     IeaDife = IeaDife + 1;
     eaDife = "";

     CRLF = &13; CRLF = CRLF + &10;
     aAlfa = variable % -102;
     |SI aAlfa ! CRLF; |ACABA; |FINSI;  || No es el final

     nMaxCampo = 0;
     IaCampo = aCampo1<-;
     IeaDife = eaDife1<-;
     |PARA; |SI eaDife ! ""; |HACIENDO;
          aDato = eaDife;
          IeaDife = IeaDife + 1;
          |HAZ Dato;
          |SI eaDife = ""; nMaxCampo = nMaxCampo + 1; |FINSI;
          |HAZ CargaCampo;
     |SIGUE;

     |DDEF aDef;
     aNomAsc = #1#29; |QBF aNomAsc;
     aNomAsc = aFicDes - aNomAsc;
     aNomDef = "";
     |SI aNomAsc = "proveedo.asc"; aNomDef = "psion038"; |HAZ Compara2; |FINSI;
     |SI aNomAsc = "codbar.asc";   aNomDef = "psion039"; |HAZ Compara3; |FINSI;
     |SI aNomAsc = "represen.asc"; aNomDef = "psion040"; |HAZ Compara2; |FINSI;
     |SI aNomAsc = "partidas.asc"; aNomDef = "psion041"; |HAZ Compara3; |FINSI;
     |SI aNomAsc = "partidas1.asc";aNomDef = "psion069"; |HAZ Compara3; |FINSI;
     |SI aNomAsc = "ayudaven.asc"; aNomDef = "psion042"; |HAZ Compara4; |FINSI;
     |SI aNomAsc = "rutas.asc";    aNomDef = "psion043"; |HAZ Compara2; |FINSI;
     |SI aNomAsc = "situacio.asc"; aNomDef = "psion044"; |HAZ Compara2; |FINSI;
     |SI aNomAsc = "rutascli.asc"; aNomDef = "psion045"; |HAZ Compara4; |FINSI;
     |SI aNomAsc = "clientes.asc"; aNomDef = "psion046"; |HAZ Compara2; |FINSI;
     |SI aNomAsc = "direccion.asc";aNomDef = "psion047"; |HAZ Compara3; |FINSI;
     |SI aNomAsc = "articulo.asc"; aNomDef = "psion048"; |HAZ Compara2; |FINSI;
     |SI aNomAsc = "fpago.asc";    aNomDef = "psion049"; |HAZ Compara2; |FINSI;
     |SI aNomAsc = "iva.asc";      aNomDef = "psion050"; |HAZ Compara2; |FINSI;
     |SI aNomAsc = "contador.asc"; aNomDef = "psion051"; |HAZ Compara1; |FINSI;
     |SI aNomAsc = "cobros.asc";   aNomDef = "psion052"; |HAZ Compara4; |FINSI;
     |SI aNomAsc = "icobros.asc";  aNomDef = "psion052"; |HAZ Compara4; |FINSI;
     |SI aNomAsc = "cobros1.asc";  aNomDef = "psion053"; |HAZ Compara3; |FINSI;
     |SI aNomAsc = "icobros1.asc"; aNomDef = "psion053"; |HAZ Compara3; |FINSI;
     |SI aNomAsc = "precios.asc";  aNomDef = "psion054"; |HAZ Compara3; |FINSI;
     |SI aNomAsc = "dtofam.asc";   aNomDef = "psion055"; |HAZ Compara3; |FINSI;
     |SI aNomAsc = "visitas.asc";  aNomDef = "psion056"; |HAZ ComVisitas; |FINSI;
     |SI aNomAsc = "impre.asc";    aNomDef = "psion057"; |HAZ Compara2; |FINSI;
     |SI aNomAsc = "articul1.asc"; aNomDef = "psion058"; |HAZ Compara2; |FINSI;
     |SI aNomAsc = "articul2.asc"; aNomDef = "psion059"; |HAZ ComArti2; |FINSI;
     |SI aNomAsc = "envase.asc"; aNomDef = "psion068"; |HAZ Compara2; |FINSI;
     |SI aNomAsc = "prcliart.asc"; aNomDef = "psion070"; |HAZ Compara3; |FINSI;
     |SI aNomAsc = "familias.asc"; aNomDef = "psion072"; |HAZ Compara2; |FINSI;
     |SI aNomAsc = "subfamilias.asc"; aNomDef = "psion073"; |HAZ Compara2; |FINSI;
     |SI aNomAsc = "almacenes.asc"; aNomDef = "psion074"; |HAZ Compara2; |FINSI;

     |SI aNomAsc = "impuesto.asc";   aNomDef = "carm0003"; |HAZ Compara3; |FINSI;

     |SI aNomDef = "";
          aAlfa = "0000(2)Error, no encuentra def de diferencias ("+aNomAsc+")...";
          |MENAV aAlfa;
     |FINSI;

     IeaDife = eaDife1<-;
     IeaVariable = eaVariable1<-;
     |PARA; |SI eaDife ! ""; |HACIENDO;
          eaVariable = eaDife;
          eaDife = "";
          IeaDife = IeaDife + 1;
          IeaVariable = IeaVariable + 1;
     |SIGUE;
     IeaDife = eaDife1<-;

     FSalida = nSal;
|FPRC;
===================================================================
|PROCESO HallaDef;
     aNomAsc = #1#29; |QBF aNomAsc;
     aNomAsc = aFicDes - aNomAsc;
     aNomDef = "";
     |SI aNomAsc = "proveedo.asc"; aNomDef = "psion038"; |FINSI;
     |SI aNomAsc = "codbar.asc";   aNomDef = "psion039"; |FINSI;
     |SI aNomAsc = "represen.asc"; aNomDef = "psion040"; |FINSI;
     |SI aNomAsc = "partidas.asc"; aNomDef = "psion041"; |FINSI;
     |SI aNomAsc = "partidas1.asc";aNomDef = "psion069"; |FINSI;
     |SI aNomAsc = "ayudaven.asc"; aNomDef = "psion042"; |FINSI;
     |SI aNomAsc = "rutas.asc";    aNomDef = "psion043"; |FINSI;
     |SI aNomAsc = "situacio.asc"; aNomDef = "psion044"; |FINSI;
     |SI aNomAsc = "rutascli.asc"; aNomDef = "psion045"; |FINSI;
     |SI aNomAsc = "clientes.asc"; aNomDef = "psion046"; |FINSI;
     |SI aNomAsc = "direccion.asc";aNomDef = "psion047"; |FINSI;
     |SI aNomAsc = "articulo.asc"; aNomDef = "psion048"; |FINSI;
     |SI aNomAsc = "fpago.asc";    aNomDef = "psion049"; |FINSI;
     |SI aNomAsc = "iva.asc";      aNomDef = "psion050"; |FINSI;
     |SI aNomAsc = "contador.asc"; aNomDef = "psion051"; |FINSI;
     |SI aNomAsc = "cobros.asc";   aNomDef = "psion052"; |FINSI;
     |SI aNomAsc = "icobros.asc";  aNomDef = "psion052"; |FINSI;
     |SI aNomAsc = "cobros1.asc";  aNomDef = "psion053"; |FINSI;
     |SI aNomAsc = "icobros1.asc"; aNomDef = "psion053"; |FINSI;
     |SI aNomAsc = "precios.asc";  aNomDef = "psion054"; |FINSI;
     |SI aNomAsc = "dtofam.asc";   aNomDef = "psion055"; |FINSI;
     |SI aNomAsc = "visitas.asc";  aNomDef = "psion056"; |FINSI;
     |SI aNomAsc = "impre.asc";    aNomDef = "psion057"; |FINSI;
     |SI aNomAsc = "articul1.asc"; aNomDef = "psion058"; |FINSI;
     |SI aNomAsc = "articul2.asc"; aNomDef = "psion059"; |FINSI;
     |SI aNomAsc = "envase.asc";   aNomDef = "psion068"; |FINSI;
     |SI aNomAsc = "prcliart.asc"; aNomDef = "psion070"; |FINSI;
     |SI aNomAsc = "familias.asc"; aNomDef = "psion072"; |FINSI;
     |SI aNomAsc = "subfamilias.asc"; aNomDef = "psion073"; |FINSI;
     |SI aNomAsc = "almacenes.asc"; aNomDef = "psion074"; |FINSI;

     |SI aNomAsc = "impuesto.asc";   aNomDef = "carm0003"; |FINSI;

     |SI aNomDef = "";
          aAlfa = "0000(1)Error, no encuentra def de diferencias ("+aNomAsc+")...";
          |MENAV aAlfa;
     |FINSI;
|FPRC;
===================================================================
|PROCESO IniDiferencia;
     |SI #1#67 = "C"; |ACABA; |FINSI;

     |HAZ HallaDef;
     aAlfa = aDef + aNomDef;
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          #referen@#1 = #0#0;
          #referen@#2 = "";
          |LEE 101#referen@.];
          |PARA; |SI FSalida = 0; |Y #referen@#1 = #0#0; |HACIENDO;
               #referen@#0 = "N";
               |GRABA 020#referen@.a:
               |LIBERA #referen@;
               |LEE 101#referen@.s;
          |SIGUE;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;
===================================================================
|PROCESO FicBor;
     CRLF = &13; CRLF = CRLF + &10;
     TAB = &9;
     |SI nHandle ] 0;
          aAlfa = "|NC";
          aAlfa = #referen@#aAlfa#;
          nCampos = aAlfa;
          aReg = "";
          |PARA i = 2; |SI i < nCampos; |HACIENDO i = i + 1;
               aDato = #referen@#i#; |QBF aDato;
               aLon1 = aDato % A0; nLon1 = aLon1;
               aLon2 = aReg % A0; nLon2 = aLon2;
               nNume = nLon1 + nLon2;
               |SI nNume ] 250;
                    |XGRABA nHandle, aReg
                    aReg = "";
               |FINSI;
               aReg = aReg + aDato + TAB;
          |SIGUE;
          aReg = aReg + CRLF;
          |XGRABA nHandle, aReg
     |FINSI;
|FPRC;

|PROCESO FinDiferencia;
     |SI #1#67 = "C"; |ACABA; |FINSI;

     |HAZ HallaDef;
     aAlfa = aDef + aNomDef;
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          aAlfa = aFicDes - ".asc";
          aAlfa = aAlfa + ".bor";
          |XABRE "CWB", aAlfa, nHandle;
          |SI FSalida < 0;
               aAlfa = "0000Error al crear:" + aAlfa;
               |MENAV aAlfa;
          |SINO;
               |ABRE #referen@;
               #referen@#1 = #0#0;
               #referen@#2 = "";
               |LEE 101#referen@.];
               |PARA; |SI FSalida = 0; |Y #referen@#1 = #0#0; |HACIENDO;
                    |SI #referen@#0 = "N";
                         |HAZ FicBor;
                         |BORRA 020#referen@.a;
                    |FINSI;
                    |LIBERA #referen@;
                    |LEE 101#referen@.s;
               |SIGUE;
               |CIERRA #referen@;
               |XCIERRA nHandle;
          |FINSI;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;
