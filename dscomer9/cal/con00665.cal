|FICHEROS;
     con00665 #0;

     canempr@ #1;
     caconce@ #2;
     calibro@ #3;
     con00649 #10;
     conw0003 #50,MANTE;

     con00637@ #100;
|FIN;

|VARIABLES;
     aAlfa  = "";
     aAlfa1 = "";

     aCodAnt = "";
     aCodEnlSim = "";

     nModo  = 0;

     aDef1  = "";
     aDef2  = "";
     aDef3  = "";
     aMensa = "";
     aPath  = "";

     nada   = " ";
     campo1 = 0;
     campo2 = 0;
     campo3 = 0;
     campo4 = 0;
     campo5 = 0;
     campo6 = 0;
     campo7 = 0;
     campo8 = 0;
     campo9 = 0;
     swnomo = 0;
     camtipo = 0;
     contador = 0;
     conta = 0;
     x = 0;
     campito = 0;
     digito = 0;
     sw = 0;
     camsigno = 0;
     camcon = 0;
     camfec = 0;
     xxxxfiac = "  ";
     xxaponer = "  ";
     xrelleno = "                              ";
     dir_fich = "";
     path = "";
     path1 = "";
     pant = "";
     cuenta = "";
     empresa = "";
     anyo = "";
     arte = "";
     long = "  ";
     dig1 = 0;
     dig3 = 0;
     dig4 = 0;
     dig5 = 0;
     dig6 = 0;
     dig7 = 0;
     dig8 = 0;
     dig9 = 0;
     i = 0;
     cuentaiva = "";
     numero = 0;
     numeros = "";
     malo = 0;
     acuenta="";
     aprimero="";
     mensaje="";

     nCont = 0;
     nSwNuevo = 0;
|FIN;

|CALCULO acceder; |TIPO 0;
     empresa = #0#0;
     empresa = "00000" + empresa;
     empresa = empresa % -105;
     anyo = #0#1;
     anyo = "0" + anyo;
     anyo = anyo % -101;
     empresa = empresa + anyo;
     path = path1;
     dir_fich = path + "fich/";               || Lo verdadero
     |PATH_DAT #1 dir_fich;
     |ABRE #1;
     #1#2 = #0#0;
     #1#3 = #0#1;
     |LEE 040#1=;
     |SI FSalida ! 0;
          |MENAV "      No existe Empresa Contable";
          |ERROR;
     |SINO;
               pant = path + "pan/";                    || Lo verdadero
               path = path + "fich/" + empresa +  "/";  || Lo verdadero
               aAlfa = path1; |QBF aAlfa;
               aAlfa = aAlfa - "contagen/";
               |SI FSalida ! 0;
                  aAlfa1 = aAlfa + "modelos/fich/";
                  |PATH_DAT #2aAlfa1;   || conceptos
                  aAlfa1 = aAlfa + "modelos/pan/";
                  |PATH_PAN #2aAlfa1;
               |SINO;
                  |PATH_DAT #2path;   || conceptos
                  |PATH_PAN #2pant;
               |FINSI;
               |PATH_DAT #3path;   || Libros
               dig1 = #1#11;
               dig3 = #1#13;
               dig4 = #1#14;
               dig5 = #1#15;
               dig6 = #1#16;
               dig7 = #1#17;
               dig8 = #1#18;
               dig9 = #1#19;
     |FINSI;
     |CIERRA #1;
|FCAL;

|CALCULO ayuda1; |TIPO 6;
|SI FSalida = 9;
     |PUSHV 05462377;
     |ATRI I;
     |CUADRO 05 46 22 77;
     |ATRI R;
     ||            123456789012345678901234567890;
     |PINTA 0647, " ---- POSIBLES APUNTES -Pag.1 ";
     |PINTA 0747, " (01) Total Familia Sin Dto.  ";
     |PINTA 0847, " (02) Total Familia Con Dto.  ";
     |PINTA 0947, " (03) Total Descuento         ";
     |PINTA 1047, " (04) Bruto Factura           ";
     |PINTA 1147, " (05) Base Imponible          ";
     |PINTA 1247, " (06) Total Recargo           ";
     |PINTA 1347, " (07) Total Ivas              ";
     |PINTA 1447, " (08) Portes                  ";
     |PINTA 1547, " (09) Varios                  ";
     |PINTA 1647, " (10) Total Factura           ";
     |PINTA 1747, " (11) Total Comision          ";
     |PINTA 1847, " (12) Iva Portes              ";
     |PINTA 1947, " (13) Iva Varios              ";
     |PINTA 2047, " (14) Iva - 1                 ";
     |PINTA 2147, " (15) Iva Recargo - 1         ";
     |PAUSA;
     |PINTA 0647, " ---- POSIBLES APUNTES -Pag.2 ";
     |PINTA 0747, " (16) Iva - 2                 ";
     |PINTA 0847, " (17) Iva Recargo - 2         ";
     |PINTA 0947, " (18) Iva - 3                 ";
     |PINTA 1047, " (19) Iva + Recargo           ";
     |PINTA 1147, " (20) Base Exenta             ";
     |PINTA 1247, " (21) Iva Recargo - 3         ";
     |PINTA 1347, " (22) Iva - 4                 ";
     |PINTA 1447, " (23) Iva Recargo - 4         ";
     |PINTA 1547, " (24) Iva - 5                 ";
     |PINTA 1647, " (25) Iva Recargo -5          ";
     |PINTA 1747, " (26) Importe Retencion       ";
     |PINTA 1847, " (27) Base Imp. sin Portes    ";
     |PINTA 1947, " (28) Base Imp. sin Varios    ";
     |PINTA 2047, " (29) Iva sin Portes          ";
     |PINTA 2147, " (30) Iva sin Varios          ";
     |PAUSA;
     |PINTA 0647, " ---- POSIBLES APUNTES -Pag.3 ";
     |PINTA 0747, " (31) Base Portes             ";
     |PINTA 0847, " (32) Base Varios             ";
     |PINTA 0947, " (33) Iva Portes              ";
     |PINTA 1047, " (34) Iva Varios              ";
     |PINTA 1147, " (35) Base sin Portes / Varios";
     |PINTA 1247, " (36) Iva sin Portes / Varios ";
     |PINTA 1347, " (37) Base Iva 1              ";
     |PINTA 1447, " (38) Base Iva 2              ";
     |PINTA 1547, " (39) Base Iva 3              ";
     |PINTA 1647, " (40) Base Iva 4              ";
     |PINTA 1747, " (41) Base Iva 5              ";
     |PINTA 1847, " (42) Iva por Diferencias     ";
     |PINTA 1947, " (43) A cuenta Facturas Dir.  ";
     |PINTA 2047, " (67) Importe piezas (TALLER) ";
     |PINTA 2147, " (68) Importe Lubric.(TALLER) ";
     |PAUSA;
     |PINTA 0647, " ---- POSIBLES APUNTES -Pag.4 ";
     |PINTA 0747, " (69) Importe S.Ext. (TALLER) ";
     |PINTA 0847, " (70) Importe M.Obra (TALLER) ";
     |PINTA 0947, " (71) Total IVA calculado     ";
     |PINTA 1047, " (72) Importe Canon           ";
     |PINTA 1147, " (73) Bruto albaran           ";
     |PINTA 1247, " (77) Imp.GA. piezas (TALLER) ";
     |PINTA 1347, " (78) Imp.GA. Lubric.(TALLER) ";
     |PINTA 1447, " (79) Imp.GA. S.Ext. (TALLER) ";
     |PINTA 1547, " (80) Imp.GA. M.Obra (TALLER) ";
     |PINTA 1647, " (81) Costo Almacen OR        ";
     |PINTA 1747, " (82) Costo Taller  OR        ";
     |PINTA 1847, " (83) Imp.C.A.piezas (TALLER) ";
     |PINTA 1947, " (84) Imp.C.A.lubric.(TALLER) ";
     |PINTA 2047, " (85) Imp.C.A.S.Ext. (TALLER) ";
     |PINTA 2147, " (86) Imp.C.A.M.Obra (TALLER) ";
     |ATRI 0;
     |PAUSA;
     |PINTA 0647, " (87) Imp.C.T.piezas (TALLER) ";
     |PINTA 0747, " (88) Imp.C.T.lubric.(TALLER) ";
     |PINTA 0847, " (89) Imp.C.T.S.Ext. (TALLER) ";
     |PINTA 0947, " (90) Imp.C.T.M.Obra (TALLER) ";
     |PINTA 1047, " ============================ ";
     |PINTA 1147, "                              ";
     |PINTA 1247, "                              ";
     |PINTA 1347, "                              ";
     |PINTA 1447, "                              ";
     |PINTA 1547, "                              ";
     |PINTA 1647, "                              ";
     |PINTA 1747, "                              ";
     |PINTA 1847, "                              ";
     |PINTA 1947, "                              ";
     |PINTA 2047, "                              ";
     |PINTA 2147, "                              ";
     |ATRI 0;
     |PAUSA;
     |POPV;
|FINSI;

   |PARA nCont = 5; |SI nCont [ 12; |HACIENDO nCont = nCont + 1;
      |CAMPO_MAXIMO #con00665#nCont#, 1, "90";
   |SIGUE;
|FCAL;

|CALCULO ayuda3; |TIPO 7;
|SI #0#4 ! 1; |Y FSalida = 9;
   |PUSHV 05052236;
   |ATRI I;
   |CUADRO 05 05 22 36;
   |ATRI R;
   ||            123456789012345678901234567890
   |PINTA 0606, " ---- POSIBLES APUNTES -Pag.1 ";
   |PINTA 0706, " (01) Total Familia Sin Dto.  ";
   |PINTA 0806, " (02) Total Familia Con Dto.  ";
   |PINTA 0906, " (03) Total Descuento         ";
   |PINTA 1006, " (04) Bruto Factura           ";
   |PINTA 1106, " (05) Base Imponible          ";
   |PINTA 1206, " (06) Total Recargo           ";
   |PINTA 1306, " (07) Total Ivas              ";
   |PINTA 1406, " (08) Portes                  ";
   |PINTA 1506, " (09) Varios                  ";
   |PINTA 1606, " (10) Total Factura           ";
   |PINTA 1706, " (11) Total Comision          ";
   |PINTA 1806, " (12) Iva Portes              ";
   |PINTA 1906, " (13) Iva Varios              ";
   |PINTA 2006, " (14) Iva - 1                 ";
   |PINTA 2106, " (15) Iva Recargo - 1         ";
   |PAUSA;
   |PINTA 0606, " ---- POSIBLES APUNTES -Pag.2 ";
   |PINTA 0706, " (16) Iva - 2                 ";
   |PINTA 0806, " (17) Iva Recargo - 2         ";
   |PINTA 0906, " (18) Iva - 3                 ";
   |PINTA 1006, " (19) Iva + Recargo           ";
   |PINTA 1106, " (20) Base Exenta             ";
   |PINTA 1206, " (21) Iva Recargo - 3         ";
   |PINTA 1306, " (22) Iva - 4                 ";
   |PINTA 1406, " (23) Iva Recargo - 4         ";
   |PINTA 1506, " (24) Iva - 5                 ";
   |PINTA 1606, " (25) Iva Recargo - 5         ";
   |PINTA 1706, " (26) Importe Retencion       ";
   |PINTA 1806, " (27) Base Imp. sin Portes    ";
   |PINTA 1906, " (28) Base Imp. sin Varios    ";
   |PINTA 2006, " (29) Iva sin Portes          ";
   |PINTA 2106, " (30) Iva sin Varios          ";
   |PAUSA;
   |PINTA 0606, " ---- POSIBLES APUNTES -Pag.3 ";
   |PINTA 0706, " (31) Base Portes             ";
   |PINTA 0806, " (32) Base Varios             ";
   |PINTA 0906, " (33) Iva Portes              ";
   |PINTA 1006, " (34) Iva Varios              ";
   |PINTA 1106, " (35) Base sin Portes / Varios";
   |PINTA 1206, " (36) Iva sin Portes / Varios ";
   |PINTA 1306, " (37) Base Iva 1              ";
   |PINTA 1406, " (38) Base Iva 2              ";
   |PINTA 1506, " (39) Base Iva 3              ";
   |PINTA 1606, " (40) Base Iva 4              ";
   |PINTA 1706, " (41) Base Iva 5              ";
   |PINTA 1806, " (42) Iva por Diferencias     ";

   |PINTA 1947, " (43) A cuenta Facturas Dir.  ";
   |PINTA 2006, " (67) Importe piezas (TALLER) ";
   |PINTA 2106, " (68) Importe Lubric.(TALLER) ";
   |PAUSA;
   |PINTA 0606, " ---- POSIBLES APUNTES -Pag.4 ";
   |PINTA 0706, " (69) Importe S.Ext. (TALLER) ";
   |PINTA 0806, " (70) Importe M.Obra (TALLER) ";
   |PINTA 0906, " (71) Total IVA calculado     ";
   |PINTA 1006, " (72) Importe Canon           ";
   |PINTA 1106, " (73) Bruto albaran           ";
   |PINTA 1206, " (77) Imp.GA. piezas (TALLER) ";
   |PINTA 1306, " (78) Imp.GA. Lubric.(TALLER) ";
   |PINTA 1406, " (79) Imp.GA. S.Ext. (TALLER) ";
   |PINTA 1506, " (80) Imp.GA. M.Obra (TALLER) ";
   |PINTA 1606, " (81) Costo Almacen  OR       ";
   |PINTA 1706, " (82) Costo Taller   OR       ";
   |PINTA 1806, "==============================";
   |PINTA 1906, "                              ";
   |PINTA 2006, "                              ";

   |ATRI 0;
   |PAUSA;
   |POPV;
|FINSI;

   |PARA nCont = 61; |SI nCont [ 68; |HACIENDO nCont = nCont + 1;
      |CAMPO_MAXIMO #con00665#nCont#, 1, "90";
   |SIGUE;
|FCAL;

|CALCULO ayuda2; |TIPO 0;
|SI #0Campo > 43; |Y #0Campo < 67; |ERROR; |ACABA; |FINSI;
|SI #0Campo = 0;
    campo1 = Campo + 8;
    campo2 = Campo + 16;
    campo3 = Campo + 24;
    campo4 = Campo + 32;
    campo5 = Campo + 40;
    campo6 = Campo + 48;
    campo7 = Campo + 119;
    campo8 = Campo + 127;
    campo9 = Campo + 153;
    #0campo1 = "            "; |PINTA #0campo1;
    #0campo2 = 0;              |PINTA #0campo2;
    #0campo3 = " ";            |PINTA #0campo3;
    #0campo4 = 0;              |PINTA #0campo4;
    #0campo5 = "N";            |PINTA #0campo5;
    #0campo6 = "N";            |PINTA #0campo6;
    #0campo7 = " ";            |PINTA #0campo7;
    #0campo8 = 0;              |PINTA #0campo8;
    #0campo9 = "N";            |PINTA #0campo9;
|FINSI;
|FCAL;

|CALCULO ayuda4; |TIPO 0;
|SI #0Campo = 0;
    campo1 = Campo + 8;
    campo2 = Campo + 16;
    campo3 = Campo + 24;
    campo4 = Campo + 32;
    campo5 = Campo + 40;
    campo6 = Campo + 48;
    campo7 = Campo + 79;
    campo8 = Campo + 87;
    campo9 = Campo + 105;
    #0campo1 = "            "; |PINTA #0campo1;
    #0campo2 = 0;              |PINTA #0campo2;
    #0campo3 = " ";            |PINTA #0campo3;
    #0campo4 = 0;              |PINTA #0campo4;
    #0campo5 = "N";            |PINTA #0campo5;
    #0campo6 = "N";            |PINTA #0campo6;
    #0campo7 = " ";            |PINTA #0campo7;
    #0campo8 = 0;              |PINTA #0campo8;
    #0campo9 = "N";            |PINTA #0campo9;
|FINSI;
|FCAL;

|CALCULO contador; |TIPO 0;
swnomo = 0;
camtipo = Campo - 8;
|SI #0Campo ! "            ";
   contador = 0;
   conta = 0;
   cuenta = #0Campo;
   |PARA x = 1; |SI x [ 12; |HACIENDO x = x + 1;
      conta = (x * 100) + 1;
      arte = cuenta % conta;
      |SI arte = "*"; contador = x; |FINSI;
   |SIGUE;
   |SI contador = 0;
      swnomo = 0;
      |HAZ pintaniv;
   |SINO;
      swnomo = 1;
      conta = 100 + (contador - 1);
      cuenta = cuenta % conta;
      long = cuenta % 0;
   |FINSI;
|SINO;
  |SI #0camtipo ! 0;
      |MENAV "      Introduzca cuenta por favor, o ponga tipo <00>";
      |ERROR;
  |FINSI;
  swnomo = 0;
|FINSI;
|FCAL;

|CALCULO contado2; |TIPO 0;
swnomo = 0;
|SI #0Campo ! "            ";
   contador = 0;
   conta = 0;
   cuenta = #0Campo;
   |PARA x = 1; |SI x [ 12; |HACIENDO x = x + 1;
      conta = (x * 100) + 1;
      arte = cuenta % conta;
      |SI arte = "*"; contador = x; |FINSI;
   |SIGUE;
   |SI contador = 0;
      swnomo = 0;
      |HAZ pintaniv;
   |SINO;
      swnomo = 1;
      conta = 100 + (contador - 1);
      cuenta = cuenta % conta;
      long = cuenta % 0;
   |FINSI;
|SINO;
  |MENAV "      Introduzca cuenta por favor";
  |ERROR;
  swnomo = 0;
|FINSI;
|FCAL;

|CALCULO contado1; |TIPO 0;
campito = Campo - 8;
camtipo = Campo - 16;
|SI #0campito ! "            ";
   contador = 0;
   conta = 0;
   cuenta = #0campito;
   |PARA x = 1; |SI x [ 12; |HACIENDO x = x + 1;
      conta = (x * 100) + 1;
      arte = cuenta % conta;
      |SI arte = "*"; contador = x; |FINSI;
   |SIGUE;
   |SI contador ! 0;
      swnomo = 1;
      conta = 100 + (contador - 1);
      cuenta = cuenta % conta;
      long = cuenta % 0;
   |SINO;
      swnomo = 0;
   |FINSI;
|SINO;
   |SI #0camtipo ! 0;
      |MENAV "      Introduzca cuenta por favor, o ponga tipo <00>";
      |ERROR;
   |FINSI;
   swnomo = 0;
|FINSI;
malo = 0;
cuentaiva = #0#117;
|QBF cuentaiva;
|SI cuentaiva = "CLI"; |ACABA; |FINSI;
     |SI cuentaiva = "cli";
          #0#117 = "CLI";
          |PINTA #0#117;
          |ACABA;
     |FINSI;
|PARA i = 1; |SI i [ 12; |HACIENDO i = i + 1;
     numeros = i + "01";
     numeros = #0#117 % numeros;
     |SI numeros ! " ";  |Y numeros ! "*"; |Y numeros ! "0";
                         |Y numeros ! "1"; |Y numeros ! "2";
                         |Y numeros ! "3"; |Y numeros ! "4";
                         |Y numeros ! "5"; |Y numeros ! "6";
                         |Y numeros ! "7"; |Y numeros ! "8";
                         |Y numeros ! "9";
          malo = 1;
     |FINSI;
|SIGUE;
|SI malo = 1;
     |ERROR;
|FINSI;

|FCAL;

|CALCULO contado3; |TIPO 0;
campito = Campo - 1;
|SI #0campito ! "            ";
   contador = 0;
   conta = 0;
   cuenta = #0campito;
   |PARA x = 1; |SI x [ 12; |HACIENDO x = x + 1;
      conta = (x * 100) + 1;
      arte = cuenta % conta;
      |SI arte = "*"; contador = x; |FINSI;
   |SIGUE;
   |SI contador ! 0;
      swnomo = 1;
      conta = 100 + (contador - 1);
      cuenta = cuenta % conta;
      long = cuenta % 0;
   |SINO;
      swnomo = 0;
   |FINSI;
|SINO;
   |MENAV "      Introduzca cuenta por favor";
   swnomo = 0;
|FINSI;
|FCAL;

|CALCULO nivelcli;|TIPO 0;
|SI swnomo = 1;
   |SI #0Campo [ dig3;
      digito = 0;
      |SI #0Campo = 1; digito = dig4; |FINSI;
      |SI #0Campo = 2; digito = dig5; |FINSI;
      |SI #0Campo = 3; digito = dig6; |FINSI;
      |SI #0Campo = 4; digito = dig7; |FINSI;
      |SI #0Campo = 5; digito = dig8; |FINSI;
      |SI #0Campo = 6; digito = dig9; |FINSI;

      |SI long ] digito;
         |MENAV "       Longitud de cuenta fuera de Nivel";
         |ERROR;
      |FINSI;
   |SINO;
      |MENAV "     No existe Nivel";
      |ERROR;
   |FINSI;
|FINSI;
|FCAL;

|CALCULO pintaniv; |TIPO 0;
campito = Campo + 1;
cuenta = #0Campo;
|QBF cuenta;
long = cuenta % 0;
|SI long ! 0;
   sw = 0;
   |SI long = dig4; sw = 1; |FINSI;
   |SI long = dig5; sw = 1; |FINSI;
   |SI long = dig6; sw = 1; |FINSI;
   |SI long = dig7; sw = 1; |FINSI;
   |SI long = dig8; sw = 1; |FINSI;
   |SI long = dig9; sw = 1; |FINSI;
   |SI sw = 0;
      |MENAV "       Longitud de cuenta fuera de Nivel";
      |ERROR;
   |FINSI;
|FINSI;
|FCAL;

|CALCULO signo; |TIPO 0;
camsigno = Campo - 24;
|SI #0camsigno ! 0;
   |SI #0Campo ! "D"; |Y #0Campo ! "H";
        |MENAV "      Introduzca <D> para el Debe o <H> para Haber";
        |ERROR;
   |FINSI;
|FINSI;
|FCAL;

|CALCULO pintacon; |TIPO 0;
camcon = Campo - 32;
|SI #0camcon ! 0;
   |ABRE #2;
    #2#0 = #0Campo;
    |LEE 040#2=;
    |SI FSalida ! 0;
       |MENAV "     No existe Concepto";
       |ERROR;
    |FINSI;
    |CIERRA #2;
|FINSI;
|FCAL;

|CALCULO pintaco1; |TIPO 0;
|ABRE #2;
#2#0 = #0Campo;
|LEE 040#2=;
|SI FSalida ! 0;
   |MENAV "     No existe Concepto";
   |ERROR;
|FINSI;
|CIERRA #2;
|FCAL;

|CALCULO nomo; |TIPO 7;
|SI Campo = 118;
    |HAZ contado3;
|SINO;
    |HAZ contado1;
|FINSI;
|SI swnomo = 0;
   #0Campo = 0;
   |PINTA #0Campo;
   |HAZ nomodifi;
|FINSI;
|FCAL;

|CALCULO asie2; |TIPO 7;
|SI #0#4 = 1;
    |HAZ nomodifi;
|SINO;
   |SI Campo = 69; |O Campo = 77; |O Campo = 85; |O Campo = 93;
    |O Campo = 101; |O Campo = 109; |O Campo = 166; |O Campo = 140;
    |O Campo = 148;
       |SI #0#61 = 0; |HAZ nomodifi; |FINSI;
   |FINSI;
   |SI Campo = 70; |O Campo = 78; |O Campo = 86; |O Campo = 94;
    |O Campo = 102; |O Campo = 110; |O Campo = 167; |O Campo = 141;
    |O Campo = 149;
       |SI #0#62 = 0; |HAZ nomodifi; |FINSI;
   |FINSI;
   |SI Campo = 71; |O Campo = 79; |O Campo = 87; |O Campo = 95;
    |O Campo = 103; |O Campo = 111; |O Campo = 168; |O Campo = 142;
    |O Campo = 150;
       |SI #0#63 = 0; |HAZ nomodifi; |FINSI;
   |FINSI;
   |SI Campo = 72; |O Campo = 80; |O Campo = 88; |O Campo = 96;
    |O Campo = 104; |O Campo = 112; |O Campo = 169; |O Campo = 143;
    |O Campo = 151;
       |SI #0#64 = 0; |HAZ nomodifi; |FINSI;
   |FINSI;
   |SI Campo = 73; |O Campo = 81; |O Campo = 89; |O Campo = 97;
    |O Campo = 105; |O Campo = 113; |O Campo = 170; |O Campo = 144;
    |O Campo = 152;
       |SI #0#65 = 0; |HAZ nomodifi; |FINSI;
   |FINSI;
   |SI Campo = 74; |O Campo = 82; |O Campo = 90; |O Campo = 98;
    |O Campo = 106; |O Campo = 114; |O Campo = 171; |O Campo = 145;
    |O Campo = 153;
       |SI #0#66 = 0; |HAZ nomodifi; |FINSI;
   |FINSI;
   |SI Campo = 75; |O Campo = 83; |O Campo = 91; |O Campo = 99;
    |O Campo = 107; |O Campo = 115; |O Campo = 172; |O Campo = 146;
    |O Campo = 154;
       |SI #0#67 = 0; |HAZ nomodifi; |FINSI;
   |FINSI;
   |SI Campo = 76; |O Campo = 84; |O Campo = 92; |O Campo = 100;
    |O Campo = 108; |O Campo = 116; |O Campo = 173; |O Campo = 147;
    |O Campo = 155;
       |SI #0#68 = 0; |HAZ nomodifi; |FINSI;
   |FINSI;
|FINSI;
|FCAL;

|CALCULO tipono; |TIPO 7;
|SI Campo = 13; |O Campo = 21; |O Campo = 29; |O Campo = 37;
 |O Campo = 45; |O Campo = 53; |O Campo = 124; |O Campo = 132; |O Campo = 158;
    |SI #0#5 = 0; |HAZ nomodifi; |FINSI;
|FINSI;
|SI Campo = 14; |O Campo = 22; |O Campo = 30; |O Campo = 38;
 |O Campo = 46; |O Campo = 54; |O Campo = 125; |O Campo =133; |O Campo = 159;
    |SI #0#6 = 0; |HAZ nomodifi; |FINSI;
|FINSI;
|SI Campo = 15; |O Campo = 23; |O Campo = 31; |O Campo = 39; |O Campo = 160;
 |O Campo = 47; |O Campo = 55; |O Campo = 126; |O Campo = 134;
    |SI #0#7 = 0; |HAZ nomodifi; |FINSI;
|FINSI;
|SI Campo = 16; |O Campo = 24; |O Campo = 32; |O Campo = 40;
 |O Campo = 48; |O Campo = 56; |O Campo = 127; |O Campo = 135; |O Campo = 161;
    |SI #0#8 = 0; |HAZ nomodifi; |FINSI;
|FINSI;
|SI Campo = 17; |O Campo = 25; |O Campo = 33; |O Campo = 41;
 |O Campo = 49; |O Campo = 57; |O Campo = 128; |O Campo = 136; |O Campo = 162;
    |SI #0#9 = 0; |HAZ nomodifi; |FINSI;
|FINSI;
|SI Campo = 18; |O Campo = 26; |O Campo = 34; |O Campo = 42;
 |O Campo = 50; |O Campo = 58; |O Campo = 129; |O Campo = 137; |O Campo = 163;
    |SI #0#10 = 0; |HAZ nomodifi; |FINSI;
|FINSI;
|SI Campo = 19; |O Campo = 27; |O Campo = 35; |O Campo = 43;
 |O Campo = 51; |O Campo = 59; |O Campo = 130; |O Campo = 138; |O Campo = 164;
    |SI #0#11 = 0; |HAZ nomodifi; |FINSI;
|FINSI;
|SI Campo = 20; |O Campo = 28; |O Campo = 36; |O Campo = 44;
 |O Campo = 52; |O Campo = 60; |O Campo = 131; |O Campo = 139; |O Campo = 165;
    |SI #0#12 = 0; |HAZ nomodifi; |FINSI;
|FINSI;

|FCAL;

|CALCULO fechno; |TIPO 7;
camfec = Campo - 8;
|SI #0camfec = "S"; |O #0camfec = "C";
    #0Campo = "N";
    |PINTA #0Campo;
    |HAZ nomodifi;
|FINSI;
|FCAL;

|CALCULO nomodifi;             || RUTINA DE CONVERSION A NO MODIFICABLES
                               || VARIABLES: A_
    xxaponer = Anono;
    xxxxfiac = Control % A1001;
    Control = Control + xxxxfiac;
    Control = Control + xrelleno;
    Control = Control % A120;
    Control = Control + xxaponer;
|FCAL;

|PROCESO leelibro;
     |ABRE #3;
     #3#0 = #0#2;
     |LEE 000#3=;
     |SI FSalida ! 0;
          |MENAV "0000Libro inexistente...";
          |ERROR;
     |SINO;
          #0#3=#3#1;
          |PINTA #0#3;
     |FINSI;
     |CIERRA #3;
|FPRC;

|| Controlo que no me ponga CLI o REP en minusculas porque luego da unos
|| errores alucionantes en el enlace
|| Miro si el primer digito es un numero ya que si no se puede poner lo
|| que quieras

|PROCESO cli;
 camtipo = Campo - 8;
 #0Campo = #0Campo > " "; |PINTA #0Campo;
 acuenta = #0Campo;
 aprimero = acuenta % "101";
 |SI aprimero < "0";|O aprimero > "9";
     |QBT acuenta;
     |SI #0camtipo ! 67; |Y #0camtipo ! 68; |Y #0camtipo ! 69; |Y #0camtipo ! 70;
       |Y #0camtipo ! 77; |Y #0camtipo ! 78; |Y #0camtipo ! 79; |Y #0camtipo ! 80;
       |Y #0camtipo ! 72; |Y #0camtipo ! 73; |Y #0camtipo ! 81; |Y #0camtipo ! 82;
       |Y #0camtipo < 83;
        |SI acuenta ! "CLI";|Y acuenta ! "REP"; |Y acuenta ! "SER"; |Y #0camtipo ! 0;
            mensaje="0000Debe introducir una cuenta o CLI o REP";
            |MENAV mensaje;
            |ERROR;
        |FINSI;
     |SINO;
        |SI acuenta ! "CLI";|Y acuenta ! "REP"; |Y acuenta ! "SER"; |Y acuenta ! "SEC"; |Y #0camtipo ! 0;
            mensaje="0000Debe introducir una cuenta CLI, REP o SEC";
            |MENAV mensaje;
            |ERROR;
        |FINSI;
     |FINSI;
 |FINSI;
|FPRC;

|PROCESO DesCargaDef; |TIPO 3;
     |SI aDef1 ! ""; |DESCARGA_DEF #canempr@; |FINSI;
     |SI aDef2 ! ""; |DESCARGA_DEF #caconce@; |FINSI;
     |SI aDef3 ! ""; |DESCARGA_DEF #calibro@; |FINSI;
|FPRC;

|PROCESO CargaDef;
     path = #0#175; |QBF path;
     aPath = path;
     path1 = path;

     aDef1 = aPath + "def/canempre";
     |CARGA_DEF aDef1, canempr@;
     |SI FSalida ! 0;
          aMensa = "0000Error al cargar:" + aDef1;
          |MENAV aMensa;
          aDef1 = "";
     |FINSI;

     aAlfa = aPath; |QBF aAlfa;
     aAlfa = aAlfa - "contagen/";
     |SI FSalida ! 0;
        aDef2 = aAlfa + "modelos/def/dsmom030.mas";
     |SINO;
        aDef2 = aPath + "def/caconcep";
     |FINSI;
     |CARGA_DEF aDef2, caconce@;
     |SI FSalida ! 0;
          aMensa = "0000Error al cargar:" + aDef2;
          |MENAV aMensa;
          aDef2 = "";
     |FINSI;

     aDef3 = aPath + "def/calibros";
     |CARGA_DEF aDef3, calibro@;
     |SI FSalida ! 0;
          aMensa = "0000Error al cargar:" + aDef3;
          |MENAV aMensa;
          aDef3 = "";
     |FINSI;
|FPRC;

|PROCESO Defecto; |TIPO 7;
   aAlfa = #con00665#175; |QBF aAlfa;
   |SI aAlfa = "";
      |DBASE aAlfa; |QBF aAlfa; aAlfa = aAlfa + "agicont/";
      #con00665#175 = aAlfa;
   |FINSI;
|FPRC;

|PROCESO MiraTipoEnlace;
   |ABRE #con00649;
   |SI #con00665#157 = 4;
      aAlfa = "    " + &191 + " Enlace simultaneo ? ";
      |CONFI aAlfa;
      |SI FSalida = 0;
         #con00649#0 = #con00665#120;
         |LEE 000#con00649.=;
         |SI FSalida = 0;
            #conw0003#0 = #con00649#1; aCodAnt = #con00649#1;
            #conw0003#1 = #con00649#2;
            nSwNuevo = 0;
         |SINO;
            |DDEFECTO #con00649;
            #con00649#0 = #con00665#120; aCodAnt = ""; nSwNuevo = 1;
            |GRABA 020#con00649.b;
         |FINSI;
         |PUSHV 05012380;
         |PINPA #0#conw0003; |PINDA #0#conw0003;
         |ENDATOS #1#conw0003;
         |SI FSalida = 0;
            #con00649#1 = #conw0003#0;
            #con00649#2 = #conw0003#1;
            |GRABA 020#con00649.a;
         |SINO;
            |SI nSwNuevo = 1; |BORRA 020#con00649.a; |FINSI;
            |ERROR;
         |FINSI;
         |LIBERA #con00649;
         |POPV;
      |SINO;
         #con00649#0 = #con00665#120;
         |LEE 101#con00649.=;
         |SI FSalida = 0; |BORRA 020#con00649.a; |LIBERA #con00649; |FINSI;
      |FINSI;
   |SINO;
      #con00649#0 = #con00665#120;
      |LEE 101#con00649.=;
      |SI FSalida = 0; |BORRA 020#con00649.a; |LIBERA #con00649; |FINSI;
   |FINSI;
   |CIERRA #con00649;
|FPRC;

|PROCESO EliminaSimult;
   |BORRA 020#con00649.a;
|FPRC;

|DEFBUCLE EliminaSimult;
#con00649#1;
;
#con00665#120;
#con00665#120;
be;
NULL, EliminaSimult;
|FIN;

|PROCESO BajaEnlace; |TIPO 1;
   nModo = (FEntrada / 100) ! 0;
   |SI nModo = 3;
      |BUCLE EliminaSimult;
   |FINSI;
|FPRC;
