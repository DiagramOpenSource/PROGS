|FICHEROS;
     legiz002 #0;

     legim001 #1;
     legim002 #2;

     legiw001 #100,MANTE;      ||Aux. Contratos a renovar

     agifa024 #24;
|FIN;

|VARIABLES;
     &enPartes = 0;
     &eaSerieContrato = "";
     &enNumeroContrato = 0;
     aPeriodo = "";

     nUltimo = 0;
     nSalida = 0;
     nLinea = 0;

     &enEscape = 0;
     aAlfa = "";
     nExiste = 0;
     aMensaje = "";

      {-1}menu      = "";
          menu1     = "2400";
          menu2     = "1";
          menu3     = "";
          menu4     = "RRC";
          menu5     = "Revisar";
          menu6     = "Renovar";
          menu7     = "Cancelar";

     nSalir = 0;

     nSwHay = 0;

     fFechaIni = @;
     nFechaIni = 0;
     fFechaFin = @;
     nFechaFin = 0;
     nDifDias = 0;
|FIN;

|PROCESO Minw001;
     #legiw001#0 = "     ";
     #legiw001#1 = 000000;
|FPRC;

|PROCESO Maxw001;
     #legiw001#0 = "zzzzz";
     #legiw001#1 = 999999;
|FPRC;

|PROCESO legim001;
     |SI #legim001#5 < #legiz002#1; |O #legim001#5 > #legiz002#2;
          |ACABA;
     |FINSI;

     |DDEFECTO #agifa024;
     #agifa024#0 = #legim001#2;
     |LEE 000#agifa024.=;
     |SI FSalida ! 0;
          |ACABA;
     |SINO;
          |SI #agifa024#158 = 99;
               |ACABA;
          |FINSI;
     |FINSI;

     nSwHay = 1;

     |DDEFECTO #legiw001;
     #legiw001#0 = #legim001#0;
     #legiw001#1 = #legim001#1;
     |LEE 101#legiw001.=;
     |SI FSalida ! 0; |GRABA 020#legiw001.b; |FINSI;

     #legiw001#2 = #legim001#2;
     #legiw001#3 = #legim001#3;
     #legiw001#4 = #legim001#4;
     #legiw001#5 = #legim001#5;
     #legiw001#6 = #legim001#6;
     #legiw001#7 = #legim001#7;
     #legiw001#8 = #legim001#8;
     #legiw001#9 = #legim001#9;
     #legiw001#10 = #legim001#10;
     #legiw001#11 = #legim001#11;
     #legiw001#12 = #legim001#12;

     |GRABA 020#legiw001.a;
     |LIBERA #legiw001;
|FPRC;

|DEFBUCLE legim001;
 #legim001#1;
 2;
 #legiz002#5, #legiz002#7, #legiz002#3;
 #legiz002#6, #legiz002#8, #legiz002#4;
 ;
 NULL, legim001;
|FIN;

|PROCESO legiw001;
     |SI #legiw001#13 = "*";
          ||Creo el nuevo contrato (Calculando la nueva fecha de finalizacion)

          fFechaIni = #legiw001#4;
          nFechaIni = fFechaIni;

          fFechaFin = #legiw001#5;
          nFechaFin = fFechaFin;

          nDifDias = nFechaFin - nFechaIni;
          |SI nDifDias < 0;
               aMensaje = "0000Atencion: El contrato " + #legiw001#0 + "/" + #legiw001#1 + " tiene mal indicadas las fechas";
               |MENAV aMensaje;
               |ACABA;
          |FINSI;

          nFechaIni = nFechaFin + 1;
          fFechaIni = nFechaIni;

          nFechaFin = nFechaIni + nDifDias;
          fFechaFin = nFechaFin;

          |DDEFECTO #legim001;
          #legim001#0 = #legiw001#0;
          #legim001#1 = 999999;
          |LEE 000#legim001.];
          |SI FSalida = 0;
               |LEE 000#legim001.a;
          |SINO;
               |LEE 000#legim001.u;
          |FINSI;
          |SI FSalida = 0; |Y #legim001#0 = #legiw001#0;
               nUltimo = #legim001#1 + 1;
          |SINO;
               nUltimo = 1;
          |FINSI;
          |DDEFECTO #legim001;
          #legim001#0 = #legiw001#0;
          #legim001#1 = nUltimo;
          |LEE 000#legim001.=;
          |SI FSalida ! 0; |GRABA 020#legim001.b; |FINSI;

          #legim001#2 = #legiw001#2;
          #legim001#3 = #legiw001#3;
          #legim001#4 = fFechaIni;
          #legim001#5 = fFechaFin;
          #legim001#6 = #legiw001#6;
          #legim001#7 = "N";
          #legim001#8 = "N";
          #legim001#9 = #legiw001#9;
          #legim001#10 = #legiw001#10;
          #legim001#11 = #legiw001#11;
          #legim001#12 = #legiw001#12;

          |GRABA 020#legim001.a;
          |LIBERA #legim001;

          ||Ahora creo las lineas.
          |DDEFECTO #legim002;
          #legim002#0 = #legiw001#0;
          #legim002#1 = #legiw001#1;
          #legim002#2 = 1;
          |LEE 000#legim002.];
          nSalida = FSalida;
          |PARA; |SI; |HACIENDO;
               |SI nSalida ! 0;
                    |SAL;
               |FINSI;
               |SI #legim002#0 ! #legiw001#0; |O #legim002#1 ! #legiw001#1;
                    |SAL;
               |FINSI;
               nLinea = #legim002#2;
               #legim002#1 = nUltimo;
               |GRABA 020#legim002.n;
               |LIBERA #legim002;

               |DDEFECTO #legim002;
               #legim002#0 = #legiw001#0;
               #legim002#1 = #legiw001#1;
               #legim002#2 = nLinea;
               |LEE 000#legim002.=;
               |LEE 000#legim002.s;
               nSalida = FSalida;
          |SIGUE;

          ||Genero los partes del contrato.
          aPeriodo = #legim001#6;
          |QBF aPeriodo;
          |SI aPeriodo = ""; |O aPeriodo = "N";
               |ACABA;
          |FINSI;

          ||Proceso que genera los partes
          eaSerieContrato = #legim001#0;
          enNumeroContrato = #legim001#1;
          |SUB_EJECUTA_NP "legiz001";

          |SI enPartes > 0;
               |LEE 101#legim001.=;
               |SI FSalida = 0;
                    #legim001#7 = "S";
                    |GRABA 020#legim001.a;
                    |LIBERA #legim001;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE legiw001;
 #legiw001#1;
 ;
 INICIO;
 FINAL;
 ;
 NULL, legiw001;
|FIN;

|PROCESO Principal;
     |ABRE #agifa024;

     nSwHay = 0;
     |DELINDEX #legiw001;

     |ABRE #legiw001;

     ||RELLENO EL TEMPORAL DE CONTRATOS
     |BUCLE legim001;


     ||ENLINEAL, CON PROCESAR, REVISAR Y CANCELAR
     ||BOTONES MARCAR TODOS, DESMARCA TODOS ..   F5 .. o similar

     |SI nSwHay = 0;
          aMensaje = "0000Seleccion vacia";
          |MENAV aMensaje;
          |ACABA;
     |FINSI;

     |PARA nSalir = 1; |SI nSalir [ 1; |HACIENDO;
          enEscape = 0;
          |ENTLINEAL #1#legiw001, 1, 4, 22, 1, Minw001, Maxw001;
          |SI enEscape = 1;
               nSalir = 1;
          |SINO;
               |MENU menu;
               nSalir = FSalida;
          |FINSI;
     |SIGUE;

     |SI nSalir = 2;
          ||aMensaje = "0000Renovar contratos";
          |||MENAV aMensaje;
          |ABRE #legim001;
          |ABRE #legim002;
          |BUCLE legiw001;
          |CIERRA #legim001;
          |CIERRA #legim002;
     |FINSI;
     |CIERRA #legiw001;
     |CIERRA #agifa024;
|FPRC;

|PROCESO Marcar;
     #100#13 = aAlfa;
     |GRABA 020#100a;
|FPRC;

|DEFBUCLE Marcar;
 #100#1;
 ;
 INICIO;
 FINAL;
 be;
 NULL,Marcar;
|FIN;

|PROCESO Funciones; |TIPO 11;
     || <F9> Marcar/Desmarcar linea
     |SI FSalida = 17;
          |SI #100#13 = "*";
               #100#13 = " ";
          |SINO;
               #100#13 = "*":
          |FINSI;
          |PINTA #100#13;
          |GRABA 020#100a;
          |ERROR;
     |FINSI;

     || <F5> Marcar/desmarcar todos
     |SI FSalida = 13;
          |SI #100#13 = "*";
               aAlfa = " ";
          |SINO;
               aAlfa = "*";
          |FINSI;
          |BUCLE Marcar;
          enEscape = 1;
          |PTEC 806;
     |FINSI;
|FPRC;

|PROGRAMA;
     |CLS;
     |ABRE #0;
     |DDEFECTO #0;
     |LEE 101#0p;
     nExiste = FSalida;
     |PINPA #0#0;
     |PINDA #0#0;
     |ENDATOS #1#0;
     |SI FSalida = 0;
          |SI nExiste = 0;
               |GRABA 020#0a;
          |SINO;
               |GRABA 020#0n;
          |FINSI;
          |HAZ Principal;
     |FINSI;
     |LIBERA #0;
     |CIERRA #0;
|FPRO;
