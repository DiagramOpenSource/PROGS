|FICHEROS;
     evarz030 #0;
     evarm021 #21; || Pdte Servir
     evarm022 #22; || Servidas
     referen@;
|FIN;

|VARIABLES;
     &Tempo = "";
     &eaTmpEvaSer = "";

     &eaSerie = "";
     &enPedido = 0;
     &enLinea = 0;
     &eaSerAlb = "";
     &enNumAlb = 0;
     &enLinAlb = 0;
     &enUnidades = 0;
     &efFecha = @;

     aAlfa = "";
     aBulto = "";
     nHay = 0;
     nUni = 0;
|FIN;

|PROCESO Tmp;
     |SI #0#4 = "*";
          |SELECT #5#21;
          #21#0 = #0#0;
          |LEE 000#21=;

          #referen@#0 = eaSerAlb;
          #referen@#1 = enNumAlb;
          #referen@#2 = enLinAlb;
          #referen@#13 = #0#0;
          #referen@#3 = #21#1;
          #referen@#4 = #21#3;
          #referen@#5 = #21#4;
          #referen@#6 = #21#5;
          #referen@#7 = #21#6;
          #referen@#8 = #21#7;
          #referen@#9 = efFecha;
          #referen@#10 = #21#10;
          #referen@#11 = 1;
          #referen@#12 = #21#2;
          |GRABA 020#referen@.n;
     |FINSI;

/*
     |SELECT #4#22;
     #22#13 = #0#0;
     |LEE 101#22=;
     |SI #0#4 = "*";
          |SELECT #1#22;
          |DDEFECTO #22;
          #22#0 = eaSerAlb;
          #22#1 = enNumAlb;
          #22#2 = enLinAlb;
          #22#13 = #0#0;
          |LEE 101#22=;
          |SI FSalida ! 0; |GRABA 020#22b; |FINSI;
          #22#3 = #21#1;
          #22#4 = #21#3;
          #22#5 = #21#4;
          #22#6 = #21#5;
          #22#7 = #21#6;
          #22#8 = #21#7;
          #22#9 = efFecha;
          #22#10 = #21#10;
          #22#11 = 1;
          #22#12 = #21#2;
          |GRABA 020#22a;
          |LIBERA #22;
     |SINO;
          |SI FSalida = 0; |BORRA 020#22a; |FINSI;
     |FINSI;
     |LIBERA #22;
*/
|FPRC;

|DEFBUCLE Tmp;
     #0#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Tmp;
|FIN;

|PROCESO Tecla; |TIPO 0;
     |SI #0Campo = Contenido; |Y FSalida = 0;
          |SI #0#4 = "*";
               #0#4 = "";
               nUni = nUni - 1;
          |SINO;
               #0#4 = "*";
               nUni = nUni + 1;
          |FINSI;
          |GRABA 020#0a;
          |PINTA #0#4;
     |FINSI;
|FPRC;

|PROCESO Llena;
     aAlfa = #21#0; |QBF aAlfa;
     |SI aAlfa = ""; |ACABA; |FINSI;

     |SI nHay = 0;
          nHay = 1;
     |FINSI;

     aBulto = aAlfa % -102;
     |DDEFECTO #0;
     #0#0 = #21#0; ||CB
     #0#1 = #21#8; ||Situ
     #0#2 = #21#2; ||Talla
     #0#3 = aBulto;

     |SELECT #4#22;
     #22#13 = #21#0;
     |LEE 000#22=;
     |SI FSalida = 0;
          #0#4 = "*";
          nUni = nUni + 1;
     |FINSI;

     |GRABA 020#0n;
|FPRC;

|DEFBUCLE Llena;
     #21#3;
     11;
     eaSerie, enPedido, enLinea, "N";
     eaSerie, enPedido, enLinea, "N";
     ;
     NULL, Llena;
|FIN;

|PROCESO Min;
     #0#0 = " " * 12;
|FPRC;

|PROCESO Max;
     #0#0 = "z" * 12;
|FPRC;

|PROGRAMA;
     aAlfa = Usuario;
     |NOME_DAT #0 aAlfa;
     |DELINDEX #0;

     |ABRE #0;
     |ABRE #22;
     |BUCLE Llena;
     |CIERRA #22;
     |CIERRA #0;
     |SI nHay = 0;
          |MENAV "0000Articulo sin tallas...";
     |SINO;
          |PINPA #0#0;
          |ENTLINEAL #1#0, 1, 4, 22, 0, Min, Max;
          |CONFI "0000NEs correcta la seleccion?";
          |SI FSalida = 0;
               |DDEF aAlfa; aAlfa = aAlfa + "evarm022";
               |CARGA_DEF aAlfa, referen@;
               |SI FSalida = 0;
                    |SI eaTmpEvaSer = "";
                         |HAZ CreaTempo; eaTmpEvaSer = Tempo;
                    |FINSI;
                    |NOME_DAT #referen@#eaTmpEvaSer#;
                    |DELINDEX #referen@;
                    |ABRE #referen@;

                    enUnidades = nUni;
                    |ABRE #21;
                    |ABRE #22;
                    |BUCLE Tmp;
                    |CIERRA #21;
                    |CIERRA #22;

                    |CIERRA #referen@;
                    |DESCARGA_DEF #referen@;
               |FINSI;
          |FINSI;
     |FINSI;

     |DELINDEX #0;
|FPRO;
