|FICHEROS;
     agifa077 #0;
     agifa080 #3;
     agifa019 #2;
     agifa017 #8;
     agifa112 #4;
     agif0041 #11;  || datos empresa
     agifa007 #40;
     agifa142 #41;
     agifa010 #50;
     agifa321 #45;  || Parametros de Divisas
     agifa322 #46;  || Lineas de Proveedores/Divisas
     agifa323 #47;  || Proveedores/Divisas
     agifa324 #42;  || Divisas
     agifa072 #72;
     agifa079 #79;
     dsm00279 #279;
     dsm00115;
     agifa704;
     agifa716;
     agifa722;
     agifa091;


     goparame@;
     dsm00087@;
     dsm00020@;
     referen@;
     refere1@;
|FIN;

|VARIABLES;
     &enSwAlta99957 = 0;
     aAlbTMaquina = "";
     aFacTMaquina = "";
     nAlbReparto = 0;
     nFacReparto = 0;
     nBtnItemDocAlc = -1;
     Comodin = "";
     Comodin1 = "";
     nSw = 0;
     nCalc = 0;
     FEstado = 0;
     aAlfa1 = "";
     aFichAnt = "";
     nCmpAnt = 0;
     nContador = 0;

     aSalida = "";
     nSwPCEGroup = 0;
     aUsu = "";
     nContaLog = 0;
     aSer = "";
     aNum = "";
     aTipo = "";
     nTipo = 0;
     nSal = 0;

     aSwModiCon = "";
     nSwConstru     = 0;
     nSwFlag        = 0;

     quetipo        = "";
     nModo          = 0;
     nSwPorVar      = 0;
     aSerie         = "";
     nNume          = 0;
     aAlfa          = "";
     aDatos         = "";
     aDirEmp        = "";
     nCodEmp        = 0;
     aProv          = "";
     nForma    = 0;
     nImpo     = 0;
     nMes      = 0;
     aMes      = "";
     nNetoDto  = 0;
     nfecha    = 0;
     div_act = 0;        || Divisa actualizada. Me sirve en un PARA para que
                         || no salga hasta que este actualizada (div_act=1)
     nModo077 = 0;
     t_totalb = 0;
     param     = "";
     mensa     = "";
     base      = "";
     alfa      = "";
     alfa1     = "";
     direc     = "";
     asto      = 0;

     mensaje01 = "0423Actualizando linea:";
     mensaje10 = "0000Este albaran contiene lineas provenientes de Pedidos";
     mensaje12 = "0000Este albaran esta FACTURADO";
     mensajei  = "2400NDesea imprimir este albaran? ";
     mensaje   = "0000No puede cambiar este campo !";
     informe1  = "agifa077";
     informe2  = "agif1077";
     informe   = "";
     puente    = "";
     imneto    = 0;
     tf        = 0;
     xmes      = 0;
     con       = 0;
     margen    = 0;
     control   = 0;
     pm        = 0;
     de        = 0;
     pe        = 0;
     m1        = 0;
     m2        = 0;
     m3        = 0;
     m4        = 0;
     m5        = 0;
     m6        = 0;
     pcm       = 0;
     tipalb    = 1;
     contenido = 0;
     modo = 0;
     impret = 0;
     precio = 0;
     pvp1   = 0;
     pvp2   = 0;
     pvp3   = 0;
     pvp4   = 0;
     pvp5   = 0;
     pvp6   = 0;
     aConfir = "";
     varios = 0;
     portes = 0;
     mens = 0;
     caltot = 0;
     recalpre = 0;
     factordec = 0;
     i = 0;
     nTecla        = 0;
     nImpDiv = 0;
     nPPort1 = 0;
     nPPort2 = 0;
     aA쨚 = "";

 {-1}aMenuPCEG = "";
     aMenuPCEG1 = "2400";
     aMenuPCEG2 = "1";
     aMenuPCEG3 = "Imprimir:";
     aMenuPCEG4 = "AE";
     aMenuPCEG5 = " Albaran ";
     aMenuPCEG6 = " Etiqueta ";
     aPath = "";
     nOk = 0;
     nPos = 0;
     aCar = "";
     nError = 0;

     &PRMNT_enError = 0;
     &enContaFac = 0;
     &PRMNT_aHisto = "";
     &enModoCab77 = 0;
     &eaSerAlb = "";
     &enNumAlb = 0;
     &eaImpreAlb = "";
     &eaFecConstru = "";
     &enSwAct   = 0;

     &eaSerJefe = "";
     &enEvento  = 0;
     &enEnvio   = 0;
     &eaOrigen  = "";
     &eaDestino = "";
     &eaAsunto  = "";
     &qTprov        = 0;
     &qImpoa        = 0;
     &qSerieF       = "";
     &qSerie        = "";
     &qAlbar        = 0;
     &qFecha        = @;
     &qAbono        = "";
     &qFactu        = 0;
     &qSufac        = "";

     &ser_ped       = "";
     &num_ped       = 0;

     &nDeci_Base     = 0;   || Decimales en Totales de la moneda base
     &nDeci_PreBase  = 0;   || Decimales en el Precio en moneda base
     &nDeci_BaseMx   = 0;   || Decimales en Totales de la moneda base (Maxima precision)
     &nDeci_PreBaseMx= 0;   || Decimales en el Precio en moneda base (Maxima precision)
     &nDeci_Div      = 0;   || Decimales en Totales de la divisa
     &nDeci_PreDiv   = 0;   || Decimales en el Precio en divisa
     &nDeci_TotVis   = 0;   || Decimales en Totales visibles (el de la moneda de trabajo)
     &nDeci_TotNoVis = 0;   || Decimales en Totales no visibles (el de la otra moneda)
     &nDeci_PreVis   = 0;   || Decimales en el Precio visual. (lineas)
     &nDeci_ImpVis   = 0;   || Decimales en el Importe visual. (lineas)
     &ac_divisa = "N";   || Vale "S" cuando las divisas en compras estan
                         || activadas y la serie es de divisas
     &pintado = 0;       || Sirve para controlar los pintados de las lineas
     &decim_divisa = 0;  || Decimales de la divisa
     &precio_divisa = 0; || Decimales del precio en divisa
     &decim_base = 0;    || Decimales de la moneda base
     &precio_base = 0;   || Decimales del precio en moneda base
     &prov_divisa = "";  || Codigo de Proveedor. Se pasa a PROVEED/DIVISAS
     &divisa = "";       || Codigo de Divisa. Se pasa a ACTUAL. de DIVISAS
     &ser_alb = "";
     &num_alb = 0;
     &bl       = "                              ";
     &iva1     = 0;
     &iva2     = 0;
     &iva3     = 0;
     &iva4     = 0;
     &iva5     = 0;
     &re1      = 0;
     &re2      = 0;
     &re3      = 0;
     &re4      = 0;
     &re5      = 0;
     &def_alm  = 0;
     &recoge   = ""; || Lo utilizo en agifa080
     &n_dec    = 0;
     &codiBarra = "";
     &eaCodigo     = "";
     &eaTipoCodigo = "PR";
     &factur = 0;
     &prov   = "";
     &fpago  = "";
     &dto    = 0;
     &dtoa   = 0;
     &dtop   = 0;
     &enOk   = 0;
|FIN;

|INCLUYE i_varart;

|CALCULO prov;|TIPO 0;
     |SI factur = 1;|O factur = 2;
       |SI factur = 2;
         #0#42 = "S";
         |PINTA #0#42;
       |FINSI;
       #0#3 = prov;
       #0#8 = fpago;
       #0#5 = dto;
       #0#32 = dtoa;
       #0#7 = dtop;
       |PINTA #0#3;
       |PINTA #0#8;
       |PINTA #0#5;
       |PINTA #0#32;
       |PINTA #0#7;
     |FINSI;

|FCAL;

|PROCESO con0; |TIPO 6;
     nTecla = FSalida;
     modo = (FEntrada / 100) ! 0;
     |SI FSalida = 9;
          |SI modo ! 1;
               |CONSULTA #3#0;
               |PTEC 802;
               |PTEC 802;
          |SINO;
               |ERROR;
          |FINSI;
     |FINSI;
     |SI Campo = 3;
          nSal = FSalida;
          enError = 0;
          |ABRE #4;
          #4#0 = #0#3;
          |LEE 000#4=;
          |SI FSalida ! 0;
               eaProve = #0#3;
               |SUB_EJECUTA_NP "dsz99921";   || Por exceso de ficheros
               |SI enError ! 0; |ERROR; |ACABA; |FINSI;
          |FINSI;
          |CIERRA #4;
          FSalida = nSal;
     |FINSI;
|FPRC;


|PROCESO serie7; |TIPO 7;

     modo = (FEntrada / 100) ! 0;

     |HAZ ControlUsuAC;
     |SI enErr ! 0; |PTEC 807; |ACABA; |FINSI;

     |HAZ DefSerCom;

     |SI PRMNT_aHisto ! "";
          ser_alb = PRMNT_aHisto % 105;
          num_alb = (A\(PRMNT_aHisto % 6));

          #0#50 = ser_alb;
          #0#0 = num_alb;
          |PTEC 802;
          |PTEC 802;
          |PINTA #0#50;
          |PINTA #0#0;
     |FINSI;

     param = PARAMETRO; |QBF param;     || LLamado por agivf015
     |SI quetipo = "direc";
          param = "";
     |FINSI;
     |SI param ! "";
          #0#50 = param % 102;
          alfa  = param % 306;  #0#0 = alfa;
     |FINSI;
/*                            ACTIVAR CUANDO JOSE LO DIGA
     |SI modo = 1;
          |HAZ EsIber21;
          |SI FSalida = 0;
               |HAZ SerPrvAlba;
               |SI qSerie ! "";
                    #0#50 = qSerie;
               |FINSI;
          |FINSI;
     |FINSI;
*/
|FPRC;

|PROCESO Prv7; |TIPO 7;
     |HAZ prov;
     ||컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
     |HAZ EsIber21;
     |SI FSalida = 0; |Y qSerie ! "";
          #0#3 = eaProve;
          |PTEC 802;
          qSerie = "";
     |FINSI;
     ||컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴 Modulo 000577
     |HAZ EsDiagram;
     |SI FSalida = 0;
          |HAZ DiagEntAlb;
     |FINSI;
     ||컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|FPRC;

|PROCESO serie30; |TIPO 30;
     ||컴컴컴컴컴컴Automatizacion Empresas
     |ABRE #dsm00115; |LEE 000#dsm00115.p; nSal = FSalida; |CIERRA #dsm00115;
     |SI nSal = 0;
          eaProve = #0#3;
          aAlfa = "dsz99982;ALBALTA" + #0#50 + (("000000" + #0#0) % -106);
          |SUB_EJECUTA aAlfa;
     |FINSI;

     |HAZ EsConstru;
     |SI FSalida = 0;
          |GRABA 020#0a;
          |CIERRAT #0;
          eaSerAlb = #0#50;
          enNumAlb = #0#0;
          |HAZ AdjAutoExpe;
          |ABRET #0;
          |LEE 101#0=;
     |FINSI;
     |SI param ! "";                    || LLamado por agivf015
          |PTEC 807;
          |PTEC 807;
     |FINSI;
|FPRC;

|CALCULO fecalbc; |TIPO 7;
     modo = (FEntrada / 100) ! 0;
     |SI modo = 2;
          |CAMPO_MODIFICA #0#1 , 1 , "N";
     |SINO;
          |CAMPO_MODIFICA #0#1 , 1 , "S";
     |FINSI;
     |SI modo = 1; |Y eaFecConstru ! "";
          #0#1 = eaFecConstru;  || cuando lo llama  dsz99957 (modulo 00con)
     |FINSI;
     |SI modo = 1; |Y enSwAlta99957 = 0;
          |HAZ RavenidaDefecto77;
     |FINSI;
|FCAL;

|CALCULO cogeconc;|TIPO 0;
|FCAL;

|CALCULO pedconc;|TIPO 6;
     con = FEntrada / 100;
     con = con ! 0;
     |SI con = 2;|Y #0Campo ! Contenido;
         |SI #0#41 > 0;|O #0#38 = AS;
            #0Campo = Contenido;
            |PINTA #0Campo;
            |SI #0#41 > 0;
              |MENAV mensaje10;
            |FINSI;
            |SI #0#38 = AS;
               |MENAV mensaje12;
            |FINSI;
            |ERROR;
         |SINO;
            control = 1;
         |FINSI;
     |FINSI;
|FCAL;

|CALCULO dcon;|TIPO 6;
con = (FEntrada / 100) ! 0;
|SI Contenido ! #0Campo;
    |SI #0#38 = AS;
       |MENAV mensaje12;
       |ERROR;
    |SINO;
       nSwPorVar = 1;
       control = 1;
    |FINSI;
|FINSI;
|FCAL;

|PROCESO Tipo1_77; |TIPO 1;
     nSwFlag = 0;
|FPRC;

|CALCULO acacpc;|TIPO 2;
     nForma = 0 +. 1;
     con = (FEntrada / 100) ! 0;
     enModoCab77 = con;
     |SI con = 1; nSwFlag = 0; |FINSI;
     |SI nSwFlag = 1; |ERROR; |ACABA; |FINSI;

     |HAZ ControlUsuAC;
     |SI enErr ! 0;
          nSwFlag = 1;
          |ERROR; |ACABA;
     |FINSI;

     |SI #0#57 = 0; || chequea el cambio
          |ABRE #agifa324;
          #agifa324#0 = #0#56;
          |LEE 020#agifa324.=;
          |SI FSalida = 0;
               #0#57 = #agifa324#3;
          |FINSI;
          |CIERRA #agifa324;
     |FINSI;

     ||컴컴컴컴컴컴컴횺odulo 00con
     |HAZ EsConstru;
     nSwConstru = FSalida;
     |MODULO aAlfa;
     |SI con ! 1; |Y nSwConstru = 0; |Y #0#34 ! "PE"; |Y aAlfa = "agifa077";
          |SI aSwModiCon = "S";
               |MENAV "0000Albaran Asignado a Expediente. No se perimite Modificacion...";
               nSwFlag = 1;
               |ERROR; |ACABA;
          |SINO;
               |MENAV "0000Albaran Asignado a Expediente."
               |MENAV "0000Si modifica el albaran debera posteriormente modificar la asignacion al expediente";
          |FINSI;
     |FINSI;
     |SI nSwConstru = 0; |Y con ! 1;
          |HAZ CheqCertifica;
          |SI nSwFlag = 1; |ERROR; |ACABA; |FINSI;
     |FINSI;
     ||컴컴컴컴컴컴컴컴컴컴컴컴컴

     |C_M #0#54, 1, "S";
     |SI con = 2;
          mensa = "";
          |HAZ MiraPasadoVenta;
          |SI mensa ! "";
               nSwFlag = 1;
               |ERROR; |ACABA;
          |FINSI;
     |FINSI;
     |SI con = 3;
          eaSer = #0#50;
          enDocu = #0#0;
          efFec = #0#1;
          |HAZ MiraHisC;
          |SI enErrHis ! 0;
               nSwFlag = 1;
               |ERROR; |ACABA;
          |FINSI;
     |FINSI;
     |SI con = 3;|O con = 2;
          |SI #0#79 > 0;
               |MENAV "0000Este albaran contiene lineas provenientes de Depositos.";
               nSwFlag = 1;
               |ERROR; |ACABA;
          |FINSI;
          |SI #0#41 > 0;
               |MENAV mensaje10;
               nSwFlag = 1;
               |ERROR; |ACABA;
          |FINSI;
          |SI #0#38 = AS;
               |MENAV mensaje12;
               nSwFlag = 1;
               |ERROR;|ACABA;
          |FINSI;
     |FINSI;

     |SI nForma = -1;
          |HAZ EsPalmHotel;
          |SI FSalida = 0;
               |HAZ PalmHotelCtrl;
               |SI nSwFlag = 1; |ERROR; |ACABA; |FINSI;
          |FINSI;
     |FINSI;

     |SI #0#75 = "S"; |Y nForma = -1;
          |HAZ EsIber21;
          |SI FSalida = 0; |Y #41#164 = "D";
               |MENAV "0000Albaran Exportado...";
               |HAZ ClaveAlbIber;
               |SI FSalida ! 0;
                    nSwFlag = 1;
                    |ERROR; |ACABA;
               |FINSI;
          |SINO;
               |HAZ EsVigor;
               |SI FSalida = 0;
                  |MENAV "0000Albaran Exportado...";
               |SINO;
                  |MENAV "0000Albaran Exportado, no se puede Modificar...";
                  nSwFlag = 1;
                  |ERROR; |ACABA;
               |FINSI;
          |FINSI;
     |FINSI;
     |SI con = 1;
          |HAZ EsBerria;
          |SI FSalida = 0;
               eaSer = #0#50;
               enDocu = #0#0;
               |SUB_EJECUTA_NP "berz0014";
          |FINSI;
     |FINSI;

     #0#75 = "N";   ||EXPORTADO

     |HAZ actalc;

     pcm    = 0;
     pe     = 0;
     de     = 0;
     pm     = 0;
     enSwAct = -2;
     |BUCLELIN 0pcmlinea#0;
     enSwAct = 0;
     ||컴컴컴컴컴컴컴컴컴컴컴 Modulo 00con
     |SI nSwConstru = 0; |Y con = 1;
          aAlfa = #0#34; |QBF aAlfa;
          |SI aAlfa = ""; #0#34 = "PE"; |FINSI;
     |FINSI;
     |SI con = 3;
          |HAZ EsAlbero;
          |SI FSalida = 0;
               |HAZ AlbeAlbBorra;
          |FINSI;
          |HAZ EsAlbadis;
          |SI FSalida = 0;
               |HAZ AlbaBorAlbC;
          |FINSI;
          |HAZ EsDesanch;
          |SI FSalida = 0;
               aAlfa = "desan016;AB" + #0#50 + (("000000" + #0#0) % -106);
               |SUB_EJECUTA aAlfa;
          |FINSI;
          |HAZ EsRavenida;
          |SI FSalida = 0;
               eaSer = #0#50;
               enDocu = #0#0;
               |SUB_EJECUTA_NP "ravem004;BORRA";
          |FINSI;
     |FINSI;

     |HAZ EsGesenvia;
     |SI FSalida = 0;
          eaSerie = #0#50;
          enCodigo = #0#0;
          enForma = nForma;
          |SI con = 1; |GRABA 020#0a; |FINSI;
          |SUB_EJECUTA_NP "gesez001;ALB";
     |FINSI;
     ||컴컴컴컴컴컴Automatizacion Empresas
     |ABRE #dsm00115; |LEE 000#dsm00115.p; nSal = FSalida; |CIERRA #dsm00115;
     |SI nSal = 0;
          eaProve = #0#3;
          |SI nForma = 1;
               /*        pasado al tipo 30
               aAlfa = "dsz99982;ALBALTA" + #0#50 + (("000000" + #0#0) % -106);
               |SUB_EJECUTA aAlfa;
               */
          |SINO;
               aAlfa = "dsz99982;ALBBAJA" + #0#50 + (("000000" + #0#0) % -106);
               |SUB_EJECUTA aAlfa;
          |FINSI;
     |FINSI;
     ||컴컴컴컴컴
|FCAL;

|CALCULO RecalLin80;|TIPO 0;
     |SI caltot = 0; ||Si no viene del proceso caltotal
          |PINTA 445,#3#1;
          #3#15 = #0#3;
          |GRABA 020#3a;
     |SINO;
         |SI recalpre = 1;
               |HAZ TotalLin80;
               |GRABA 001#3a;   ||Grabo lineas
         |FINSI;
     |FINSI;

     ||------------Actualiza Cabecera
     |HAZ CalCabAgifa077;
     |HAZ ModiHistoAC;
|FCAL;

|DEFBUCLE RecalLin80;
     #3#1;
     ;
     #0#50, #0#0, 001;
     #0#50, #0#0, 999;
     ;
     NULL, RecalLin80;
|FIN;

|CALCULO actalc;|TIPO 0;
     |HAZ LimCabAgifa077;
     |BUCLE RecalLin80;
|FCAL;

|CALCULO siimprec;|TIPO 3;
     |HAZ PonDivisa;
     ||컴컴컴컴컴컴컴컴컴컴Modulo 000323
     |HAZ EsTecatel;
     |SI FSalida = 0;
          eaSer = #0#50;
          enDocu = #0#0;
          eaCodigo = #0#3;
          eaTipo = "AI";
          |HAZ TecaTrans;
     |FINSI;
     |SI quetipo = "";
          |SI eaImpreAlb ! "N";
               |CONFI mensajei;
               |SI 0 = FSalida; |HAZ imprealc; |FINSI;
          |FINSI;
          |HAZ EsPCEGroup;
          |SI FSalida = 0;
               |HAZ EtiqPCEG;
          |FINSI;
     |SINO;
          || FACTURACION DIRECTA
          qSufac = #0#54;
          #0#54 = "";
          |GRABA 021#0a;
          |LIBERA #0;
          |CIERRAT #0;
          qSerie = #0#50;
          qSerieF = #0#50;
          |SI #agifa142#128 = "N";
               |SI #agifa142#185 = "S"; qSerieF = #agifa142#194; |FINSI;
          |FINSI;
          |SI #279#12 = "S"; qSerieF = #0#50; |FINSI;
          qAlbar = #0#0;
          qFecha = #0#1;
          qAbono = #0#42;
          |PUSHV 0101 2480;
          |SUB_EJECUTA_NP "agifa229";       ||Facturar Albaranes
          |POPV;
          |ABRET #0;
          |LEE 121#0=;
     |FINSI;

     ||컴컴컴컴컴컴컴컴컴컴컴
     |HAZ EsConstru;
     |SI FSalida = 0;
          nModo = (FEntrada / 100) ! 0;
          |SI nModo = 1; |O nModo = 2;
               |GRABA 020#0a;
          |FINSI;
          |DBASS aAlfa;
          eaFicImpre= aAlfa + "spool/";
          aAlfa = Usuario;
          eaFicImpre = eaFicImpre + aAlfa;
          ser_ped = #0#50;
          num_ped = #0#0;
          |CIERRAT #0;
          |SUB_EJECUTA_NP "agifa016";
          |ABRET #0;
          #0#50 = ser_ped;
          #0#0  = num_ped;
          |LEE 101#0=;

          eaSerJefe = #0#50;
          eaPrograma = "agifa077" + #0#50 + #0#0;
          |SI nModo = 1;
               enEvento = 3; eaTipo = "03";
               eaAsunto = "Alta albaran nro. '" + #agifa077#50 + "/" + (("000000" + #agifa077#0) % -106) + "'";
               eaOrigen = Usuario % 0810;
               |HAZ EnviaEvento;
          |FINSI;
          |SI nModo = 2;
               enEvento = 6; eaTipo = "06";
               eaAsunto = "Modificacion albaran nro. '" + #agifa077#50 + "/" + (("000000" + #agifa077#0) % -106) + "'";
               eaOrigen = Usuario % 0810;
               |HAZ EnviaEvento;
          |FINSI;
     |FINSI;

     |HAZ EsPalmHotel;
     |SI FSalida = 0;
          |GRABA 021#0a;
          |LIBERA #0;
          |CIERRAT #0;
          qSerie = #0#50;
          qSerieF = "Z" + (#0#50 % 104);
          qAlbar = #0#0;
          qFecha = #0#1;
          qAbono = #0#42;
          enContaFac = #0#0;
          |SUB_EJECUTA_NP "agifa229";       ||Facturar Albaranes
          |ABRET #0;
          |LEE 121#0=;
          #0#38 = "N";        || SE DEJA COMO NO FACTURADO !!!
          #0#51 = "";
          #0#39 = 0;
          |GRABA 020#0a;
     |FINSI;
|FCAL;

|CALCULO imprealc;
     modo = (FEntrada / 100) ! 0;
     |SI modo = 1; |O modo = 2;
          |GRABA 000#0a;
          |SI FSalida = 112;  ||cuando viene de otro programa por ENDATOS
               |GRABA 020#0n; ||por ejemplo del dsz99957
          |FINSI;
          |LIBERA #0;
     |FINSI;
     ser_ped = #0#50;
     num_ped = #0#0;
     |CIERRAT #0;

     |SUB_EJECUTA_NP "agifa016";

     |ABRET #0;
     #0#50 = ser_ped;
     #0#0  = num_ped;
     |SI modo = 4;
          |LEE 001#0=;
     |SINO;
          |LEE 101#0=;
     |FINSI;
|FCAL;

|CALCULO abo;|TIPO 0;
     ||컴컴컴컴컴컴컴횮ontrol Cierre
     |HAZ EsConstru;
     |SI FSalida = 0;
          efFecha = #0#1;
          |HAZ EstaCerrado;
          |SI FSalida = 0;
               |ERROR; |ACABA;
          |FINSI;
     |FINSI;
     ||컴컴컴컴컴컴컴컴컴컴컴컴컴컴
     con = FEntrada / 100;
     con = con ! 0;
     |SI con = 2;|Y #0#42 ! Contenido;
        |MENAV mensaje;
        |ERROR;
     |FINSI;
|FCAL;

|CALCULO totcomp;|TIPO 14;
     |SI #0#41 = 0; |Y #0#79 = 0;
          |PINTA 0577,"AC";
     |SINO;
          |SI #0#79 ! 0;
               |PINTA 0577,"DC";
          |SINO;
               |PINTA 0577,"PC";
          |FINSI;
     |FINSI;
|FCAL;

|PROCESO pcmlinea;
     ||컴컴컴컴컴컴 Doble/Multi
     enPrecioB  = precio_base;
     enDeciB    = nDeci_PreBase;
     enForma = nForma;
     eaDocu = "agifa077";
     |HAZ StockEntra;
     ||컴컴컴컴컴컴컴컴컴컴컴컴

     ||------------------------------------Prov
     |ABRE #4;
     nImpo = (#3#9 < #0#5) < #0#32;
     |SI #41#114 = "S";
          nImpo = nImpo < #0#7;
     |FINSI;
     #4#0 = #0#3;
     |LEE 101#4=;
     |SI FSalida = 0;
         aMes = #0#1 % A402;
         nMes = aMes + 26;
         |SI #0#42 = "N";
             #4nMes = #4nMes + (nImpo * nForma);
             #4#39 = #4#39 + (nImpo * nForma);
         |SINO;
             #4nMes = #4nMes - (nImpo * nForma);
             #4#39 = #4#39 - (nImpo * nForma);
         |FINSI;
         |GRABA 020#4a;
         |LIBERA #4;
     |FINSI;
     |CIERRA #4;

     |SI #0#42 = "N";
          enImpPrvCom = nImpo * nForma;
     |SINO;
          enImpPrvCom = -nImpo * nForma;
     |FINSI;
     efFecha = #0#1;
     eaProve = #0#3;
     |HAZ AcumulaPrv;
|FPRC;

|PROCESO Defectos77;
     |ABRE #41; |LEE 001#41p; |CIERRA #41;
     n_dec     = #41#8;
     codiBarra = #41#58;
     aConfir = #41#76;
     |ABRE #agifa007;
     #agifa007#26 = #agifa077#50;
     |LEE 001#agifa007.=;
     |SI FSalida ! 0; |DDEFECTO #agifa007; |FINSI;
     |CIERRA #agifa007;
     def_alm = #agifa007#31;
|FPRC;

|PROCESO mira_deci;
     control = 0;
     |HAZ Defectos77;

     |SI #agifa007#30 = "S";
          #0#12 = 0;
          #0#14 = 0;
          |PINTA #0#12;
          |PINTA #0#14;
     |FINSI;
     |HAZ LeeMonBase;
     |HAZ LeeParamDiv;
     || Me llevo a agifa088 si puedo o no recoger un albaran de compra con F4
     recoge = #agifa142#36;
|FPRC;

|PROCESO prov_ob; |TIPO 0;
     eaProve = #0#3;
     qTprov = 0;
     qImpoa = 0;

     |HAZ EsIber21;
     |SI FSalida = 0;
          |HAZ ProvIber21;
          |SI eaProve = ""; |ERROR; |ACABA; |FINSI;
     |FINSI;

     nModo077 = (FEntrada / 100) ! 0;
     |SI nTecla = 11; |O #41#102 = "S"; |O #41#102 = "X";
          eaCodigo = #0#3;
          eaFuerza = "N";
          |SI nTecla = 11; eaFuerza = "S"; |FINSI;
          |SUB_EJECUTA_NP "dsz99994";
          |SI #41#102 = "N"; |Y nModo077 ! 2; |ERROR;  |FINSI;
     |FINSI;

     |SI #agifa142#15 = "S";
          puente = #agifa112#26;     |QBF puente;
          |SI puente ! "";
               |PUSHV 1008 1370;
               |SI #agifa142#21 = "S"; |AVISO; |FINSI;
               |BLANCO 1008 1370;
               |CUADRO 1008 1370;
               |ATRI R;
               |PINTA 1110 , #agifa112#26;
               |ATRI 0;
               |PAUSA;
               |POPV;
          |FINSI;
     |FINSI;

     |SI nModo077 = 1;
          |HAZ EsRavenida;
          |SI FSalida = 0;
               eaSer = #0#50;
               enDocu = #0#0;
               eaProve = #0#3
               |SUB_EJECUTA_NP "ravem004;PROV";
               |HAZ PinRavenida77;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO SuAlbOk;   || chequea #0#54 con 5 caractes numericos
     nOk = 1;
     aAlfa = #0#54; |QBF aAlfa;
     aAlfa = aAlfa % A0;
     |SI aAlfa = 5;
          aAlfa = #0#54;
          |PARA i = 1; |SI i [ 5; |HACIENDO i = i + 1;
               nPos = i * 100 + 1;
               aCar = aAlfa % nPos;
               aCar = aCar - "0123456789";
               |SI FSalida < 0; |SAL; |FINSI;
          |SIGUE;
          |SI i = 6; nOk = 0; |FINSI;
     |FINSI;
     FSalida = nOk;
|FPRC;

|PROCESO MiraPasadoVenta;
     xmes = 0 +. 1;
     |HAZ SuAlbOk;
     |SI FSalida = 0;
          |DBASE base; |QBF base;
          alfa = base + "fich/" + ((#0#54) % 105);
          |MKDIR alfa;
          alfa  = alfa + "/";
          |PATH_DAT #50 alfa;
          |ABRE #50;
          |LEE 040#50p;
          |SI FSalida ! 0;
              |CIERRA #50;
              |PATH_DAT #41 alfa;
              |ABRE #41;
              |LEE 040#41p;
              |SI FSalida ! 0;
                  |CIERRA #41;

                  |DELINDEX #41; |DELINDEX #50; |RMDIR alfa;

                  |DFICE alfa; |QBF alfa;
                  |PATH_DAT #50 alfa;
                  |PATH_DAT #41 alfa;

                  |ACABA;
              |FINSI;
              |CIERRA #41;
          |FINSI;

          |C_M #0#54, 1, "S";
          #50#52 = #0#54 % 602;
          #50#0 = #0#54 % 806;
          |LEE 040#50=;
          |SI FSalida = 0;
               |SI xmes = -1;
                    |AVISO;
                    mensa = "2400NAlbaran pasado de Ventas. Continuar (S/N).: ";
                    |CONFI mensa;
                    |SI FSalida = 0;
                         mensa = "";
                    |FINSI;
               |FINSI;
               |C_M #0#54, 1, "N";
          |FINSI;
          |CIERRA #50;

          |DFICE alfa; |QBF alfa;
          |PATH_DAT #50 alfa;
          |PATH_DAT #41 alfa;
     |FINSI;
|FPRC;

|PROCESO LeeMonBase; ||Lee los parametros de la moneda base
     |ABRE #agifa321;
     |ABRE #agifa324;
     |LEE 010#agifa321.p;   ||Leo parametros de divisa
     #agifa077#61 = #agifa321#9;  ||Cojo la Moneda Base de parametros
     #agifa324#0 = #agifa321#9;
     |LEE 010#agifa324.=;         ||Leo la ficha de la moneda base en Divisas
     #agifa077#62 = #agifa324#3;  ||Asigno el cambio de la moneda base con el euro
     decim_base = #agifa324#7;    ||Asigno los decimales de la moneda base
     precio_base = #agifa324#9;   ||Asigno los decimales del precio en la mon. base
     |CIERRA #agifa324;
     |CIERRA #agifa321;
|FPRC;

|PROCESO Param_Divisas; |TIPO 0;
     pintado = 0;  ||Controla pintados de las lineas

     |ABRE #agifa324;
     #agifa324#0 = #agifa077#56;
     |LEE 001#agifa324.=;   || Leo la divisa
     |CIERRA #agifa324;

     decim_divisa = #agifa324#7;  || Decimales de la divisa
     precio_divisa = #agifa324#9;  || Decimales en el precio de la divisa
     nDeci_Div = decim_divisa;   || Decimales de la divisa
     nDeci_PreDiv = precio_divisa;  || Decimales en el precio de la divisa
     |SI #0#58 = "B";   ||Si trabajo con la moneda base ...
          nDeci_PreVis   = precio_divisa;
          nDeci_ImpVis   = decim_divisa;
          nDeci_Base     = decim_base;
          nDeci_PreBase  = precio_base;
          nDeci_BaseMx  = decim_base;
          nDeci_PreBaseMx = precio_base;
          nDeci_TotVis   = decim_base;
          nDeci_TotNoVis = decim_divisa;
     |SINO;     ||Si trabajo con la divisa ...
          nDeci_PreVis   = precio_base;
          nDeci_ImpVis   = decim_base;
          nDeci_Base     = decim_base;
          nDeci_PreBase  = precio_base;
         |SI #0#57 = 1;
              nDeci_BaseMx    = decim_base;    || sin triangulacion
              nDeci_PreBaseMx = precio_base;
         |SINO;
              nDeci_BaseMx    = #agifa321#10;  || con triangulacion
              nDeci_PreBaseMx = #agifa321#11;
         |FINSI;
          nDeci_TotVis     = decim_divisa;
          nDeci_TotNoVis   = decim_base;
     |FINSI;
     |HAZ Deci_IVAC;
|FPRC;

|PROCESO LeeParamDiv; |TIPO 0;
     |ABRE #agifa321;
     |LEE 001#agifa321.p;    || Leo parametros de divisas
     |ABRE #agifa007;
     #agifa007#26 = #agifa077#50;
     |LEE 001#agifa007.=;        || Leo la serie
     |SI #0#58 = "D";      || Si la mon. de trabajo es la divisa...
       || ...escondo los campos de la moneda base :
       |CAMPO_POSICION #3#6 , 1 , 1009;
       |CAMPO_POSICION #3#9 , 1 ,1026;
       |CAMPO_VISUAL #3#6 , 1 , "N";
       |CAMPO_VISUAL #3#9 , 1 , "N";
       |CAMPO_LINEAL #3#6 , 1 , "N";
       |CAMPO_LINEAL #3#9 , 1 , "N";
       |CAMPO_MODIFICA #3#6 , 1 , "N";
       || ...y pongo en pantalla los de divisa
       |CAMPO_POSICION #3#30 , 1 , 1544;
       |CAMPO_POSICION #3#31 , 1 ,1562;
       |CAMPO_VISUAL #3#30 , 1 , "S";
       |CAMPO_VISUAL #3#31 , 1 , "S";
       |CAMPO_MODIFICA #3#30 , 1 , "S";
       |CAMPO_LINEAL #3#30 , 1 , "S";
       |CAMPO_LINEAL #3#31 , 1 , "S";
       |SI #agifa007#39 = "S"; |Y #agifa321#2 = "S"; ||Si la serie es de ...
          ac_divisa = "S";  || ... divisas, y en parametros estan activadas ...
          || ... pongo como modificables los campos relacionados con divisas
          |CAMPO_MODIFICA #0#56 , 1 , "S";
          |CAMPO_MODIFICA #0#57 , 1 , "S";
          |CAMPO_MODIFICA #0#58 , 1 , "S";
          |CAMPO_MODIFICA #0#59 , 1 , "S";
          |CAMPO_MODIFICA #0#60 , 1 , "S";
          |SI #agifa321#4 = "S";  || Si la visualizacion de parametros esta activada
            || ... pongo los campos visual. de lineas como visualizables
            |CAMPO_VISUAL #3#32, 1 , "S";
            |CAMPO_VISUAL #3#33 , 1 , "S";
          |SINO;
            || ... los pongo como no visualizables
            |CAMPO_VISUAL #3#32 , 1 , "N";
            |CAMPO_VISUAL #3#33 , 1 , "N";
          |FINSI;
       |SINO; || Si la serie no es de divisas, o no estan activados parametros
          ac_divisa = "N";
          #0#58 = "B";  || La moneda de trabajo es por fuerza la moneda base
          |PINTA #0#58;
          || Pongo como no modificables los campos relacionados con divisas
          |CAMPO_MODIFICA #0#58 , 1 , "N";
          |CAMPO_MODIFICA #0#59 , 1 , "N";
          |CAMPO_MODIFICA #0#60 , 1 , "N";
          |CAMPO_MODIFICA #0#56 , 1 , "N";
          |CAMPO_MODIFICA #0#57 , 1 , "N";
          || Pongo como no visualizables los campos visual. de lineas
          |CAMPO_VISUAL #3#32, 1 , "N";
          |CAMPO_VISUAL #3#33, 1 , "N";
       |FINSI;
     |SINO;  || Si la moneda de trabajo es la moneda base
       || ...escondo los campos en divisa :
       |CAMPO_POSICION #3#30 , 1 , 1009;
       |CAMPO_POSICION #3#31 , 1 ,1026;
       |CAMPO_VISUAL #3#30 , 1 , "N";
       |CAMPO_VISUAL #3#31 , 1 , "N";
       |CAMPO_MODIFICA #3#30 , 1 , "N";
       |CAMPO_LINEAL #3#30 , 1 , "N";
       |CAMPO_LINEAL #3#31 , 1 , "N";
       || ...coloco los campos en moneda base:
       |CAMPO_POSICION #3#6 , 1 , 1544;
       |CAMPO_POSICION #3#9 , 1 ,1562;
       |CAMPO_VISUAL #3#6 , 1 , "S";
       |CAMPO_VISUAL #3#9 , 1 , "S";
       |CAMPO_MODIFICA #3#6 , 1 , "S";
       |CAMPO_LINEAL #3#6 , 1 , "S";
       |CAMPO_LINEAL #3#9 , 1 , "S";
       |SI #agifa007#39 = "S"; |Y #agifa321#2 = "S"; || Si la serie es de divisas...
          ac_divisa = "S"; || ... y divisas estan activadas en parametros
          || Pongo como modificables los campos relacionados con divisas
          |CAMPO_MODIFICA #0#56 , 1 , "S";
          |CAMPO_MODIFICA #0#57 , 1 , "S";
          |CAMPO_MODIFICA #0#58 , 1 , "S";
          |CAMPO_MODIFICA #0#59 , 1 , "S";
          |CAMPO_MODIFICA #0#60 , 1 , "S";
          |SI #agifa321#4 = "S";  || Si la visualizacion esta activada en parametros ...
            || Pongo como visualizables los campos visual. de las lineas
            |CAMPO_VISUAL #3#32, 1 , "S";
            |CAMPO_VISUAL #3#33 , 1 , "S";
          |SINO; || Los pongo como no visualizables
            |CAMPO_VISUAL #3#32 , 1 , "N";
            |CAMPO_VISUAL #3#33 , 1 , "N";
          |FINSI;
       |SINO;  || Si la serie no es de divisas o no estan activados los parametros
          ac_divisa = "N";
          #0#58 = "B";  || La moneda de trabajo es por fuerza la moneda base
          || Pongo como no modificables los campos relacionados con divisas
          |CAMPO_MODIFICA #0#58 , 1 , "N";
          |CAMPO_MODIFICA #0#59 , 1 , "N";
          |CAMPO_MODIFICA #0#60 , 1 , "N";
          |CAMPO_MODIFICA #0#56 , 1 , "N";
          |CAMPO_MODIFICA #0#57 , 1 , "N";
          || Pongo como no visualizables los campos visual. de lineas
          |CAMPO_VISUAL #3#32, 1 , "N";
          |CAMPO_VISUAL #3#33, 1 , "N";
       |FINSI;
     |FINSI;
     |CIERRA #agifa007;
|CIERRA #agifa321;
|HAZ Param_Divisas;
|FPRC;

|PROCESO PonDivisa;
     |ABRE #agifa112;
     #agifa112#0 = #0#3;
     |LEE 001#agifa112.=;
     |SI FSalida = 0;
          #0#56 = #agifa112#81;  || Asigno la divisa por defecto del proveedor
          #0#58 = #agifa112#82; || Asigno la moneda de trabajo del proveedor
     |FINSI;
     |CIERRA #agifa112;

     aAlfa = #0#56; |QBF aAlfa;
     |SI aAlfa = ""; #0#56 = #agifa321#9; |FINSI;
     |SI #0#58 = " ";  #0#58 = "B"; |FINSI;
|FPRC;

|PROCESO CambioDivisa; |TIPO 0;
nModo077 = (FEntrada / 100) ! 0;
|SI #0Campo ! Contenido; |Y nModo077 = 1;   ||Si cambia el valor o es alta
  |SI Campo = 3; || Si llamo al proceso desde el cod. de proveedor ...
    |HAZ PonDivisa;
    |PINTA #0#58;
  |FINSI;
  #agifa007#26 = #agifa077#50;
  |LEE 001#agifa007.=;  || Leo la serie
   |SI #agifa007#39 = "S"; |Y #agifa321#2 = "S";
      |SI #agifa112#80 = "S"; || Si el proveedor es de divisa pactada
         |ABRE #agifa323;
         |ABRE #agifa322;
         #agifa322#0 = #agifa077#3;
         #agifa322#2 = #agifa077#56;
         #agifa322#7 = "N";
         |SELECT #2#agifa322;  || Con esta clave ...
         |LEE 011#agifa322.=;  || ... busco periodos no finalizados de esa divisa
         |SI FSalida = 0;  || Si existe un periodo no finalizado
           |PARA div_act = 0; |SI div_act = 0; |HACIENDO;
             #agifa077#56 = #agifa322#2;        || Cargo la divisa ...
             #agifa077#57 = #agifa322#3;        || ...y el cambio
             |LEE 001#agifa322.=;   || Leo las lineas de Proveed/Divisas
             nfecha = #agifa077#1 - #agifa322#6;  || Resto la fecha de fin de periodo a la actual
             |SI nfecha > 0;  || Si la fecha actual supera a la del periodo asignado ...
                |MENAV "0000ATENCION deberia Actualizar primero la divisa en Proveedores/Divisas";
                prov_divisa = #agifa077#3;  || Le envio el cod. de proveedor a "agifa323"
                |SUB_EJECUTA_NP "agifa323.tab";  || Ejecuto Proveedores/Divisas
                |ERROR;
             |SINO;
                div_act = 1;  || Para salir del PARA
             |FINSI;
           |SIGUE;
         |SINO;  || Si no existe un periodo no finalizado para esa divisa
           |MENAV "0000No existe un periodo activo para la divisa en Proveedores / Divisas";
           prov_divisa = #agifa077#3;  || Le paso a "agifa323" el proveedor
           |SUB_EJECUTA_NP "agifa323.tab";  || Ejecuto Proveedores / Divisas
           |ERROR;
           ||#agifa077#56 = #agifa077#61;
           ||#agifa077#57 = #agifa077#62;
         |FINSI;
         |SELECT #1#agifa322;
         |CIERRA #agifa322;
         |CIERRA #agifa323;
      |SINO; || Si el Proveedor no es de Divisa pactada ...
         |ABRE #agifa324; || ...miro directamente en divisas
         #agifa324#0 = #agifa077#56;
         |LEE 001#agifa324.=;
         |SI FSalida = 0; ||Si existe la divisa...
            #agifa077#57 = #agifa324#3; || la recojo
            |SI #agifa324#6 ! -1; || Si los dias de margen de actualizacion no
                                  || son = -1 (indefinidos)
              |PARA div_act = 0; |SI div_act = 0; |HACIENDO;
                 #agifa077#56 = #agifa324#0;        ||Cargo el valor de la divisa
                 #agifa077#57 = #agifa324#3;        ||Cargo el valor del cambio
                 |LEE 001#agifa324.=;  || Leo la divisa
                 nfecha = #agifa077#1 - #agifa324#4;
                 |SI nfecha > #agifa324#6; |Y #agifa324#6 ! -1;  || Si la fecha actual
                    |MENAV "0000ATENCION deberia Actualizar primero la divisa";
                    divisa = #agifa077#56;
                    |SUB_EJECUTA_NP "agifa326.tab";
                    |ERROR;
                 |SINO;
                    div_act = 1;
                 |FINSI;
              |SIGUE;
            |FINSI;
         |FINSI;
         |CIERRA #agifa324;
      |FINSI;
   |SINO;
     #agifa077#56 = #agifa077#61;
     #agifa077#57 = #agifa077#62;
   |FINSI;
   |PINTA #agifa077#56;
   |PINTA #agifa077#57;
 |SI Campo = 3; || Si llamo al proceso desde el cod. de proveedor ...
  |HAZ LeeParamDiv;
 |SINO;
  |HAZ Param_Divisas;
 |FINSI;
|FINSI;
|FPRC;

|PROCESO convportes; |TIPO 6;  || Convierte los portes a la mon. base
|SI #0#58 = "B";  || Si la moneda de trabajo es la moneda base ...
  #0#11 = #0#69;  || ... basta con asignarlo
|SINO;    || Si la moneda de trabajo es la divisa
  #0#11 = #0#69 / #0#57 * #0#62;   || ... lo convierto
|FINSI;
|HAZ dcon;
|FPRC;

|PROCESO convvarios; |TIPO 6;  || Convierte los varios a la mon. base
|SI #0#58 = "B";  || Si la moneda de trabajo es la moneda base ...
  #0#13 = #0#70;  || ... basta con asignarlo
|SINO;    || Si la moneda de trabajo es la divisa ...
  #0#13 = #0#70 / #0#57 * #0#62;  || ... lo convierto
|FINSI;
|HAZ dcon;
|FPRC;


|PROCESO LeeAlb; |TIPO 13;  || Sirve para cargar los valores cada vez que
                            || cambio de ficha
     ||컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴 Modulo 000577
     |HAZ EsDiagram;
     |SI FSalida = 0;
          |ATRI R;|PINTA 0561, " Visado:";|ATRI 0;
          |PINTA 0570, #0#6;
     |FINSI;
     ||컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
     |SI quetipo ! "";
          |ATRI R;
          |PINTA 0612 , " ALBARAN FACTURA DIRECTA ";
          |PINTA 1032 , " Su Factura n:"
          |ATRI r;
     |FINSI;
     |HAZ Defectos77;

     pintado = 0;   || controla pintado de las lineas
     |HAZ LeeMonBase;
     |HAZ LeeParamDiv;
     |ABRE #41; |LEE 000#41p; |CIERRA #41;
     |SI #41#148 = "N";
          |C_V #0#73, 1, "N";
          |C_V #3#42, 1, "N";
     |SINO;
          |C_V #0#73, 1, "S";
          |C_V #3#42, 1, "S";
          |PINTA 1403, "Portes Linea Facturables:";
     |FINSI;

     |SI nSwConstru = 0;
          |ATRI I;
          |PINTA 2171, "Asig:";
          |ATRI 0;
          |C_V #0#34, 1, "S";
          |PINTA 2177, #0#34;
     |FINSI;

     |HAZ EsAlbero;
     |SI FSalida = 0;
          |HAZ AlbeAlbPinta;
     |FINSI;

     |HAZ EsAlbadis;
     |SI FSalida = 0;
          |HAZ AlbaPinAlbC;
     |FINSI;

     |HAZ EsChampiEmar;
     |SI FSalida = 0;
          |HAZ EmarPinAlb;
     |FINSI;

     |HAZ EsInmMarro;
     |SI FSalida = 0;
          |PINTA 1062, "Matri:";
          |PINTA 1162, "컴컴컴";
     |FINSI;
     |HAZ EsDesanch;
     |SI FSalida = 0;
          |HAZ PinDesanch77;
     |FINSI;
     |HAZ EsRavenida;
     |SI FSalida = 0;
          |HAZ PinRavenida77;
     |FINSI;
|FPRC;

|CALCULO cambfecha;
     |SI FSalida = 0;
          |HAZ EsDesanch;
          |SI FSalida = 0;
               aAlfa = "desan016;AA" + #0#50 + (("000000" + #0#0) % -106);
               |SUB_EJECUTA aAlfa;
               |HAZ PinDesanch77;
          |FINSI;
          |HAZ EsRavenida;
          |SI FSalida = 0;
               eaSer = #0#50;
               enDocu = #0#0;
               |SUB_EJECUTA_NP "ravem004";
               |HAZ PinRavenida77;
          |FINSI;
     |FINSI;
     |SI #0#59 ! "O";
         #0#60 = "        ";
         |PINTA #0#60;
         |C_M #0#60,1,"N";
         |C_V #0#60,1,"N";
     |SINO;
         |C_M #0#60,1,"S";
         |C_V #0#60,1,"S";
     |FINSI;
     |HAZ EsAlbero;
     |SI FSalida = 0;
          |HAZ AlbeAlbEntra;
     |FINSI;
|FCAL;

|CALCULO modomod; |TIPO 6;
  |SI nModo077 = 2; |Y #0Campo ! Contenido;
    |MENAV "0000No se puede modificar el campo.";
    #0Campo = Contenido;
    |PINTA #0Campo;
    |ERROR;
  |FINSI;
  |SI #0Campo ! Contenido; |Y Campo = 58;
    |HAZ LeeParamDiv;
  |FINSI;
|FCAL;

|PROCESO caltotal; |TIPO 0; ||Proceso especial para casos determinados como
                            ||modificar los campos de cabecera en dtos, cambio divisas etc
                            ||Recalcula total albaran, descuentos y ivas de lineas
                            ||En el caso de cambiar el cambio de divisas recalcula tambien precio... de lineas

   |SI #0Campo ! Contenido; |O nSwPorVar ! 0;||Solo si cambia
          nSwPorVar = 0;
          caltot = 1;
          |SI Campo = 57; ||Si viene del cambio divisa
              recalpre = 1; ||Recalcular tambien precios linea
          |FINSI;
          |HAZ convportes;
          |HAZ convvarios;
          |HAZ actalc;

          |PINTA #0#66;
          caltot = 0;
          recalpre = 0;
   |FINSI;
|FPRC;

|PROCESO DatosEmpresa;   |TIPO 7;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo ! 1; |ACABA; |FINSI;
     |DFICE aDirEmp;            || tomo el directorio de la empresa
     |DFICB aDatos;             || tomo el directorio de los datos
     aDirEmp = aDirEmp % -205;  || me quedo con los 5 digitos de la empresa
     nCodEmp = aDirEmp;         || y los paso a una variable numerica
     |PATH_DAT #11 aDatos;      || pongo el path al fichero agifa041
     |ABRE #11;                 || abre el fichero agifa041
     #11#0 = nCodEmp;
     |LEE 020#11=;              || y busco la empresa en la que estoy
     |SI FSalida = 0;
          #0#29 = #11#1;        || nombre de la empresa
          #0#30 = #11#2;        || direccion de la empresa
          #0#31 = #11#3;        || poblacion de la empresa
          #0#33 = #11#4;        || provincia de la empresa
          |PINTA #0#29;
          |PINTA #0#30;
          |PINTA #0#31;
          |PINTA #0#33;
     |FINSI;
     |CIERRA #11;               || cierro el fichero agifa041
     ||컴컴컴컴MODULO 컴
     |HAZ EsConstru;
     |SI FSalida = 0;
          |HAZ DirEnvObra;
          |PINTA #0#18;
          |PINTA #0#19;
          |PINTA #0#20;
          |PINTA #0#21;
     |FINSI;
|FPRC;

|PROCESO SuAlbaran; |TIPO 0;
     aAlfa = #0#54; |QBF aAlfa;
     |SI aAlfa = ""; |ACABA; |FINSI;
     |SI #agifa142#173 = "S"; |ACABA; |FINSI;

     aAlfa = #0#54;
     aSerie = #0#50;
     aProv = #0#3;
     nNume = #0#0;
     aA쨚 = #0#1 % -104;
     mensa = "";
     |SALVA_FICHA #0;
     |SELECT #4#0;
     |LEE 000#0];
     |PARA; |SI FSalida = 0; |Y #0#3 = aProv; |Y #0#54 = aAlfa; |HACIENDO;
          |SI #0#50 ! aSerie; |O nNume ! #0#0;
               aAlfa = #0#1 % -104;
               |SI aA쨚 = aAlfa;
                    aAlfa = ("000000" + #0#0) % -106;
                    mensa = "0000Codigo existente en Albaran:" + #0#50 + "/" + aAlfa;
               |FINSI;
               |SAL;
          |FINSI;
          |LEE 000#0s;
     |SIGUE;
     |SELECT #1#0;
     |REPON_FICHA #0;
     |SI mensa ! "";
          |MENAV mensa;
          |ERROR;
     |FINSI;
|FPRC;

|PROCESO t8; |TIPO 8;
     quetipo = PARAMETRO;
     ||컴컴컴컴컴컴컴컴컴컴컴컴컴컴
     |HAZ EsConstru;
     nSwConstru = FSalida;
     |SI nSwConstru = 0;
          |DDEF aAlfa; aAlfa = aAlfa + "goparame";
          |CARGA_DEF aAlfa, goparame@;
          |SI FSalida = 0;
               |ABRE #goparame@;
               |LEE 000#goparame@.p;
               |CIERRA #goparame@;
               aSwModiCon = #goparame@#69;
               |DESCARGA_DEF #goparame@;
          |FINSI;
     |FINSI;
     ||컴컴컴컴컴컴컴컴횺odulo 003026
     |HAZ EsAlbero;
     |SI FSalida = 0;
          |HAZ AlbeAlbCom8;
     |FINSI;

     |HAZ EsTagloma;
     |SI FSalida = 0;
          |CONTROL_SIMPLE 0, "BOTON, ItemDoc", 0570, 0579, BtnItemDocAlc;
          nBtnItemDocAlc = FSalida;
     |FINSI;
     ||컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
     |ABRE #279; |LEE 000#279p; |CIERRA #279;
|FPRC;

|PROCESO Tipo077_9; |TIPO 9;
     |HAZ EsAlbero;
     |SI FSalida = 0;
          |HAZ AlbeAlbCom9;
     |FINSI;
     |SI nBtnItemDocAlc ! -1; |FIN_CONTROL_WINDOWS nBtnItemDocAlc; |FINSI;
|FPRC;

|PROCESO Pago77_7; |TIPO 7;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo ! 1;  |ACABA;  |FINSI;

/*
     |SI Campo = 8;
         |HAZ CargaContagen;
         |SI enOk = 1;
             |ABRE #agifa091;
             #agifa091#0 = #agifa077#8;
             |LEE 000#agifa091.=;
             |CONSULTA_CLAVE #1#agifa091;
             |SI FSalida = 0;
                 #agifa077#8 = #agifa091#0;
             |FINSI;
             |CIERRA #agifa091;
         |FINSI;
     |FINSI;
*/
|FPRC;

|PROCESO Pago77_0; |TIPO 0;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo ! 1;  |ACABA;  |FINSI;

     |HAZ EsAlbero;
     |SI FSalida = 0;
          |HAZ AlbeAlbFec;
          |HAZ AlbeAlbPinta;
     |FINSI;
|FPRC;

|PROCESO Curso77_7; |TIPO 7;
     aAlfa = "0000Campo informativo";

     |HAZ EsInmMarro;
     |SI FSalida = 0;
          aAlfa = "0000Matricula           <F11> Consulta";
     |FINSI;

     |MENSA aAlfa;
|FPRC;

|PROCESO Curso77_0; |TIPO 0;
     |SI FSalida = 0;
          |HAZ EsAlbadis;
          |SI FSalida = 0;
               |HAZ AlbaPideAlbC;
          |FINSI;
          |HAZ EsChampiEmar;
          |SI FSalida = 0;
               eaSerAlb = #0#50;
               enNumAlb = #0#0;
               |SUB_EJECUTA_NP "champi07";
               |HAZ EmarPinAlb;
          |FINSI;
     |FINSI;

     |HAZ EsInmMarro;
     |SI FSalida = 0;
          |DDEF aAlfa;
          aAlfa = aAlfa + "inmu0001";
          |CARGA_DEF aAlfa, referen@;
          |SI FSalida = 0;
               |ABRE #referen@;
               #referen@#0 = #0#71;
               |LEE 000#referen@.=;
               |SI FSalida ! 0;
                    eaAlfa = #0#71;
                    |SUB_EJECUTA_NP "inmu0001;alta";
                    |SI enError ! 0; |ERROR; |FINSI;
               |FINSI;
               |CIERRA #referen@;
               |DESCARGA_DEF #referen@;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Curso77_66; |TIPO 66;
     |HAZ EsInmMarro;
     |SI FSalida = 0;
          |DDEF aAlfa;
          aAlfa = aAlfa + "inmu0001";
          |CARGA_DEF aAlfa, referen@;
          |SI FSalida = 0;
               |ABRE #referen@;
               #referen@#0 = #0#71;
               |LEE 000#referen@.];
               |CONSULTA_CLAVE #1#referen@;
               |SI FSalida = 0;
                    #0#71 = #referen@#0; |PINTA #0#71;
               |SINO;
                    |ERROR;
               |FINSI;
               |CIERRA #referen@;
               |DESCARGA_DEF #referen@;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO T077_15; |TIPO 15;
     nTipo = 15; |HAZ Log077;
|FPRC;

|PROCESO T077_16; |TIPO 16;
     nTipo = 16; |HAZ Log077;
|FPRC;

|PROCESO T077_17; |TIPO 17;
     nTipo = 17; |HAZ Log077;
|FPRC;

|PROCESO Log077;
     |DDEF aAlfa;
     aAlfa = aAlfa + "dsm00087";
     |CARGA_DEF aAlfa, dsm00087@;
     |SI FSalida ! 0; |ACABA; |FINSI;

     aSer = #0#50;
     aNum = ("000000" + #0#0) % -106;
     aTipo = "AC";

     |ABRE #dsm00087@;
     |DDEFECTO #dsm00087@;
     |SELECT #2#dsm00087@;
     #dsm00087@#1 = aSer;
     #dsm00087@#2 = aNum;
     #dsm00087@#3 = aTipo;
     |LEE 101#dsm00087@.=;
     |SI FSalida ! 0;
          |SELECT #1#dsm00087@;
          |LEE 000#dsm00087@.u;
          |SI FSalida = 0;
               nContaLog = #dsm00087@#0 + 1;
          |SINO;
               nContaLog = 1;
          |FINSI;
          |DDEFECTO #dsm00087@;
          #dsm00087@#0 = nContaLog;
          #dsm00087@#1 = aSer;
          #dsm00087@#2 = aNum;
          #dsm00087@#3 = aTipo;
          |GRABA 020#dsm00087@.b;
     |FINSI;
     |SI FSalida = 0;
          |HORA aAlfa;
          aUsu = Usuario % 810;
          |SI nTipo = 15;
               #dsm00087@#4 = aUsu;
               #dsm00087@#5 = ~;
               #dsm00087@#6 = aAlfa;
               #dsm00087@#7 = "";
               #dsm00087@#8 = "01.01.0000";
               #dsm00087@#9 = ""
               #dsm00087@#10 = "";
               #dsm00087@#11 = "01.01.0000";
               #dsm00087@#12 = ""
          |FINSI;
          |SI nTipo = 16;
               #dsm00087@#7 = aUsu;
               #dsm00087@#8 = ~;
               #dsm00087@#9 = aAlfa;
          |FINSI;
          |SI nTipo = 17;
               #dsm00087@#10 = aUsu;
               #dsm00087@#11 = ~;
               #dsm00087@#12 = aAlfa;
          |FINSI;
          |GRABA 020#dsm00087@.a;
     |FINSI;
     |CIERRA #dsm00087@;
     |DESCARGA_DEF #dsm00087@;
|FPRC;

|PROCESO BusGopartia;
     |SI #referen@#31 = "S";
          |SI nForma = -1; |Y aAlfa = "";
               aAlfa = ("00000" + #referen@#1) % -105;
               aAlfa = "0000NEste albaran esta certificado. Pres.:" + #referen@#0 + "/" + aAlfa + ". Continuar?";
               |CONFI aAlfa;
               |SI FSalida ! 0; nSwFlag = 1; |ERROR10; |ACABA; |FINSI;
          |FINSI;
     |FINSI;
     #refere1@#0 = #referen@#34;
     #refere1@#1 = #referen@#4;
     #refere1@#2 = #referen@#5;
     #refere1@#3 = #referen@#6;
     #refere1@#4 = #referen@#7;
     |LEE 000#refere1@.=;
     |SI FSalida = 0; |Y #refere1@#6 = "S";
          |SI nForma = -1; |MENAV "0000Albaran certificado a destajista..."; |FINSI;
          nSwFlag = 1;
          |ERROR10;
     |FINSI;
|FPRC;

|DEFBUCLE BusGopartia;
     #referen@#1005;
     ;
     "M", #3#27, #3#0, #3#1, 001;
     "M", #3#27, #3#0, #3#1, 999;
     ;
     NULL, BusGopartia;
|FIN;

|PROCESO CertiGopartia;
     |BUCLE BusGopartia;
     |SI nSwFlag = 1; |ERROR10; |FINSI;
|FPRC;

|PROCESO CheqCertifica;
     |DDEF aPath;
     aAlfa = aPath + "gopartia";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          aAlfa = aPath + "gosubaux";
          |CARGA_DEF aAlfa, refere1@;
          |SI FSalida = 0;
               aAlfa = "";
               |ABRE #refere1@;
               |BUCLELIN 2 CertiGopartia #0;
               |CIERRA #refere1@;
               |DESCARGA_DEF #refere1@;
          |SINO;
               |MENAV "0000Error al cargar 'gosubaux'";
          |FINSI;
          |DESCARGA_DEF #referen@;
     |SINO;
          |MENAV "0000Error al cargar 'gopartia'";
     |FINSI;
|FPRC;

|PROCESO EtiqPCEG;
     modo = (FEntrada / 100) ! 0;
     |SI modo = 1; |O modo = 2;
          |GRABA 000#0a;
          |SI FSalida = 112;  ||cuando viene de otro programa por ENDATOS
               |GRABA 020#0n; ||por ejemplo del dsz99957
          |FINSI;
          |LIBERA #0;
     |FINSI;
     eaSerie = #0#50;
     enDocu = #0#0;
     eaTipo = "AC";
     eaPregunta = "S";
     |CIERRAT #0;

     |SUB_EJECUTA_NP "pcegz019";

     |ABRET #0;
     #0#50 = eaSerie;
     #0#0  = enDocu;
     |SI modo = 4;
          |LEE 001#0=;
     |SINO;
          |LEE 101#0=;
     |FINSI;
|FPRC;

|PROCESO Tipo77_20; |TIPO 20;
     |SI FSalida ! "OPCION";
          |SELECT #1#0;
          |LEE 000#0=;
          |SI FSalida ! 0;
               |MENAV "0000Por favor, consulte el registro correcto antes de imprimir.";
               |ACABA;
          |SINO;
               |PINDA #0#0;
          |FINSI;
     |FINSI;
     |HAZ T77_20;
|FPRC;

|PROCESO T77_20;
     aSalida = FSalida;
     |HAZ EsPCEGroup;
     nSwPCEGroup = FSalida;

     |SI aSalida = "OPCION";
          FSalida = "Imprimir";
          |SI nSwPCEGroup = 0; FSalida = "Opciones"; |FINSI;
          |ACABA;
     |FINSI;
     |SELECT #1#0;
     |LEE 000#0=;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |SI nSwPCEGroup = 0;
          |HAZ OpcionesPCEG;
          |ACABA;
     |FINSI;

     ||------------El proceso estandar

     |HAZ imprealc;
|FPRC;

|PROCESO OpcionesPCEG;
     |MENU aMenuPCEG;
     |SI FSalida [ 0; |ACABA; |FINSI;
     |SI FSalida = 1;
          |HAZ imprealc;
     |FINSI;
     |SI FSalida = 2;
          |HAZ EtiqPCEG;
     |FINSI;
|FPRC;

|PROCESO PalmHotelCtrl;
     |ABRE #79;
     #79#66 = "Z" + #0#50;
     #79#0 = #0#0;
     |LEE 101#79=;
     |SI FSalida = 0;
          |SI #79#48 = "S";
               |CONFI "0000N풞lbaran enlazado a contabilidad, desea continuar?";
               |SI FSalida ! 0; nSwFlag = 1; |FINSI;
          |FINSI;
          |SI nSwFlag = 0;
               |HAZ BorraAsiento;
               |SI nSw < 0;
                    nSwFlag = 1;
               |SINO;
                    |HAZ BorraFactura;
                    #0#38 = "N"; |PINTA #0#38;
               |FINSI;
          |FINSI;
     |FINSI;
     |CIERRA #79;
|FPRC;

|PROCESO BorraLinFac;
     |BORRA 020#72a;
|FPRC;

|PROCESO BorraFactura;
     |BUCLELIN 0BorraLinFac#79;
     |BORRA 020#79a;
|FPRC;

|PROCESO BorraAsiento;
   aAlfa1 = #agifa079#1; |QBF aAlfa1; aAlfa1 = aAlfa1 % -104; nSw = 0;
   |ABRE #agifa722;
   #agifa722#0  = "FC";
   #agifa722#1  = #agifa079#66;
   #agifa722#2  = #agifa079#0;
   #agifa722#3  = "";
   #agifa722#11 = 1;
   |LEE 000#agifa722.];

   FEstado = FSalida; aAlfa  = #agifa722#1; aAlfa = aAlfa % 0105;
   nCalc = #agifa722#2; FSalida = FEstado;

   |PARA; |SI FSalida = 0; |Y #agifa722#0 = "FC"; |Y aAlfa = #agifa079#66;
    |Y nCalc = #agifa079#0; |HACIENDO;
      aAlfa = #agifa722#3; |QBF aAlfa;
      |SI aAlfa = aAlfa1; nSw = 1; |SAL; |FINSI;
      |LEE 000#agifa722.s;
      FEstado = FSalida; aAlfa  = #agifa722#1; aAlfa = aAlfa % 0105; nCalc = #agifa722#2; FSalida = FEstado;
   |SIGUE;

   |SI nSw = 1;
      aAlfa = "ac" + Usuario; |NOME_DAT #agifa716#aAlfa#;
      |DELINDEX #agifa716; |ABRE #agifa716;

      |ABRE #agifa704;
      #agifa704#0 = #agifa722#10;
      |LEE 101#agifa704.=;
      |SI FSalida = 0;

         aFichAnt = #agifa704#16; nCmpAnt = #agifa704#17;
         |SI #agifa704#8 = "S";
            |DDEFECTO #agifa716;
            #agifa716#15 = #agifa722#10;  #agifa716#0  = 1;
            #agifa716#13 = "agifa080";    #agifa716#14 = 27;
            #agifa716#11 = "A";           #agifa716#12 = 5;
            #agifa716#3  = #agifa077#50;  #agifa716#4  = #agifa077#50;
            |GRABA 020#agifa716.n;

            |DDEFECTO #agifa716;
            #agifa716#15 = #agifa722#10;  #agifa716#0  = 2;
            #agifa716#13 = "agifa080";    #agifa716#14 = 0;
            #agifa716#11 = "N";           #agifa716#12 = 6;
            #agifa716#5  = #agifa077#0;   #agifa716#6  = #agifa077#0;
            |GRABA 020#agifa716.n;
            |LIBERA #agifa716; |CIERRA #agifa716;

            #agifa704#16 = "agifa080";    #agifa704#17 = 0;
            |GRABA 020#agifa704.a;
         |SINO;
            |DDEFECTO #agifa716;
            #agifa716#15 = #agifa722#10;  #agifa716#0  = 1;
            #agifa716#13 = "agifa079";    #agifa716#14 = 66;
            #agifa716#11 = "A";           #agifa716#12 = 5;
            #agifa716#3  = #agifa079#66;  #agifa716#4  = #agifa079#66;
            |GRABA 020#agifa716.n;

            |DDEFECTO #agifa716;
            #agifa716#15 = #agifa722#10;  #agifa716#0  = 2;
            #agifa716#13 = "agifa079";    #agifa716#14 = 0;
            #agifa716#11 = "N";           #agifa716#12 = 6;
            #agifa716#5  = #agifa079#0;   #agifa716#6  = #agifa079#0;
            |GRABA 020#agifa716.n;
            |LIBERA #agifa716; |CIERRA #agifa716;

            #agifa704#16 = "agifa079";    #agifa704#17 = 0;
            |GRABA 020#agifa704.a;
         |FINSI;
      |FINSI;
      |LIBERA #agifa704; |CIERRA #agifa704;

      aSerie = #agifa079#66; nContador = #agifa079#0;
      |LIBERA #agifa079; |CIERRAT #agifa079;

      Comodin1 = #agifa079#1; |QBF Comodin1; Comodin1 = Comodin1 % -104;
      Comodin = #agifa722#10; |QBF Comodin;
      Comodin = "agifa711.tab;" + Comodin + ",B*" + Comodin1 + ":PALM";
      |SUB_EJECUTA_NP Comodin;
      |DELINDEX #agifa716;

      |ABRE #agifa704;
      #agifa704#0 = #agifa722#10;
      |LEE 101#agifa704.=;
      |SI FSalida = 0;
         #agifa704#16 = aFichAnt; #agifa704#17 = nCmpAnt;
         |GRABA 020#agifa704.a;
      |FINSI;
      |LIBERA #agifa704; |CIERRA #agifa704;

      |ABRET #agifa079;
      #agifa079#66 = aSerie; #agifa079#0 = nContador;
      |LEE 121#agifa079.=;

      |SI PRMNT_enError = 0;
          ||  #agifa079#48 = "N";   |PINTA #0#48;
          ||  |GRABA 020#agifa079.a;
          |BORRA 020#agifa722.a;
      |FINSI;
   |FINSI;

   nSw = PRMNT_enError;
   |CIERRA #agifa722;

|FPRC;

|PROCESO LeeSerie77; |TIPO 0;
     |ABRE #40;
     #40#26 = #0#50;
     |LEE 000#40=;
     |SI FSalida = 0; |Y #40#37 = "S";
          |MENAV "0000La serie es interna, no esta permitido...";
          |ERROR;
     |FINSI;
     |CIERRA #40;
|FPRC;

|PROCESO IVA077_66; |TIPO 66;
     enTiva = #0Campo;
     efFiva = #0#1;
     |HAZ ConsuIVA;
     |SI eaDiva = "";
          |ERROR;
     |SINO;
          #0Campo = enTiva; |PINTA #0Campo;
     |FINSI;
|FPRC;

|PROCESO IVA077_0; |TIPO 0;
     enTiva = #0Campo;
     efFiva = #0#1;
     |HAZ SacaIVA;
     |SI eaDiva = "";
          |MENAV "0000No existe tipo iva para esta fecha...";
          |ERROR; |ACABA;
     |SINO;
          |HAZ caltotal;
     |FINSI;
|FPRC;

|PROCESO PinDesanch77;
     |DDEF aAlfa;
     aAlfa = aAlfa + "desan016";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |DDEFECTO #referen@;
          |ABRE #referen@;
          #referen@#0 = "A";
          #referen@#1 = #0#50;
          #referen@#2 = #0#0;
          |LEE 000#referen@.=;
          |CIERRA #referen@;
          |PINTA 1403, "%Dto2:   %Dto3:  ";
          |ATRI I;
          |PINTA 1410, #referen@#3;
          |PINTA 1419, #referen@#4;
          |ATRI 0;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|PROCESO Agen77; |TIPO 6;
     |DDEF aAlfa;
     aAlfa = aAlfa + "dsm00020";
     |CARGA_DEF aAlfa, dsm00020@;
     |SI FSalida = 0;
          |ABRE #dsm00020@;
          #dsm00020@#0 = #0#72;
          |LEE 000#dsm00020@.=;
          |SI FSalida = 0;
               #0#9 = #dsm00020@#1; |PINTA #0#9;
          |SINO;
               nError = 1;
               |PUSHV 0501 2380;
               |CLS;
               |PINPA #0#dsm00020@;
               |PINDA #0#dsm00020@;
               |CONFI "0000SConfirma alta (S/N)...:";
               |SI FSalida = 0;
                    |ENDATOS #1#dsm00020@;
                    |SI FSalida = 0;
                         #0#72 = #dsm00020@#0;
                         #0#9 = #dsm00020@#1;
                         |GRABA 020#dsm00020@.n;
                         nError = 0;
                    |FINSI;
               |FINSI;
               |POPV;
               |SI nError = 0;
                    |PINTA #0#9;
                    |PINTA #0#72;
               |SINO;
                    |ERROR;
               |FINSI;
          |FINSI;
          |CIERRA #dsm00020@;
          |DESCARGA_DEF #dsm00020@;
     |SINO;
          |MENAV "0000Error al cargar 'dsm00020'";
     |FINSI;
|FPRC;

|PROCESO BtnItemDocAlc;
     aAlfa = "tagz0025;AC" + #0#50 + #0#0;
     |SUB_EJECUTA_NP aAlfa;
|FPRC;

|PROCESO PinRavenida77;
     |DDEF aAlfa;
     aAlfa = aAlfa + "ravem004";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |DDEFECTO #referen@;
          |ABRE #referen@;
          #referen@#0 = #0#50;
          #referen@#1 = #0#0;
          |LEE 000#referen@.=;
          |CIERRA #referen@;
          |PINTA 1403, "TM:   %Rep:          Diferen:";
          |ATRI I;
          |PINTA 1407, #referen@#4;
          |PINTA 1415, #referen@#2;
          |PINTA 1433, #referen@#3;
          |ATRI 0;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|PROCESO RavenidaDefecto77;
     |HAZ EsRavenida;
     |SI FSalida ! 0; |ACABA; |FINSI;

     aTipo = "";
     |DDEF aAlfa;
     aAlfa = aAlfa + "ravem003";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |DDEFECTO #referen@;
          |ABRE #referen@;
          #referen@#0 = #0#50;
          |LEE 000#referen@.=;
          aTipo = #referen@#3;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;

     |DDEF aAlfa;
     aAlfa = aAlfa + "ravem004";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |DDEFECTO #referen@;
          |ABRE #referen@;
          #referen@#0 = #0#50;
          #referen@#1 = #0#0;
          |LEE 000#referen@.=;
          |SI FSalida ! 0; |GRABA 020#referen@.b; |FINSI;
          #referen@#4 = aTipo;
          |GRABA 020#referen@.a;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
     |HAZ PinRavenida77;
|FPRC;
