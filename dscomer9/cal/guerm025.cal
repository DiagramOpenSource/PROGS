|FICHEROS;
     guerm025 #0;
     goparame #10;
     agifa017 #17;
     agifa019 #19;
     dsm00054 #54;
     dsm00055 #55;
|FIN;

|VARIABLES;
     &eaPrograma = "";
     &eaFicImpre = "";
     &enAlmaCompras = 0;
     &enAlmaDepo = 0;
     &enForma  = 0;
     &enEvento = 1;
     &eaTipo   = "";
     &eaAsunto = "";
     &eaOrigen = "";
     nForma    = 0;
     nModo     = 0;
     nAlm1     = 0;
     nAlm2     = 0;
     nConta    = 0;
     aAlfa     = "";
     aSer      = "";
|FIN;

|PROCESO Conta; |TIPO 7;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 1;
          #0#14 = enAlmaCompras;
          #0#15 = enAlmaDepo;
          |PINTA #0#14;
          |PINTA #0#15;

          aSer = #0#0;
          #0#1 = 99999;
          |LEE 000#0];
          |SI FSalida = 0;
               |LEE 000#0a;
          |SINO;
               |LEE 000#0u;
          |FINSI;
          |SI FSalida = 0; |Y #0#0 = aSer;
               nConta = #0#1 + 1;
          |SINO;
               nConta = 1;
          |FINSI;
          |DDEFECTO #0;
          #0#0 = aSer;
          #0#1 = nConta;
          #0#13 = Usuario % 810;
          |PINTA #0#13;
     |FINSI;
|FPRC;

|PROCESO Movimi;
     |SI nForma = 1;
          nAlm1 = #0#14;
          nAlm2 = #0#15;
     |SINO;
          nAlm2 = #0#14;
          nAlm1 = #0#15;
     |FINSI;

     |ABRE #54;
/*
     #54#2 = #0#3;
     #54#0 = 999999;
     |LEE 000#54];
     |SI FSalida = 0;
          |LEE 000#54a;
     |SINO;
          |LEE 000#54u;
     |FINSI;
     |SI FSalida = 0; |Y #54#2 = #0#3;
          nConta = #54#0 + 1;
     |SINO;
          nConta = 1;
     |FINSI;
     |DDEFECTO #54;
     #54#0 = nConta;
     #54#1 = ~;
     #54#2 = #0#3
     |GRABA 020#54n;
*/
     |DDEFECTO #54;
     #54#2 = #0#0;
     #54#0 = #0#1;
     |LEE 101#54=;
     |SI FSalida ! 0; |GRABA 020#54n; |FINSI;
     |CIERRA #54;

     |ABRE #55;
     #55#28 = #54#2;
     #55#27 = #54#0;
     #55#11 = 99999;
     |LEE 000#55];
     |SI FSalida = 0;
          |LEE 000#55a;
     |SINO;
          |LEE 000#55u;
     |FINSI;
     |SI FSalida = 0; |Y #55#28 = #54#2;  |Y #55#27 = #54#0;
          nConta = #55#11 + 1;
     |SINO;
          nConta = 1;
     |FINSI;

     |DDEFECTO #55;
     #55#28 = #54#2;
     #55#27 = #54#0;
     #55#11 = nConta;

     #55#0 = #0#7;
     #55#1 = nAlm1;    ||Alm Sal = Comp
     #55#2 = #0#8;

     |ABRE #19;
     #19#0 = #0#7;
     |LEE 000#19=;
     |CIERRA #19;
     |ABRE #17;
     #17#0 = #0#7;
     #17#1 = nAlm2;
     |LEE 000#17=;

     #55#7 = #19#6;
     #55#3 = #17#5;
     #55#4 = #0#9;
     #55#5 = nAlm2;    ||Alm Ent = Depo
     #55#9 = #17#41;

     #17#1 = nAlm2;
     |LEE 000#17=;
     |CIERRA #17;

     #55#6 = #17#5;
     #55#8 = ~;
     #55#10 = #17#41;
     |GRABA 020#55n;
     |CIERRA #55;
     enForma = 1;
     |HAZ AcumulaME_MS;
|FPRC;

|PROCESO Canti; |TIPO 0;
     |ABRE #10; |LEE 000#10p; |CIERRA #10;

     nModo = (FEntrada / 100) ! 0;
     nForma = 0 +. 1;

     |SI #0Campo ! Contenido;
          |ABRE #17;
          #17#0 = #0#7;
          #17#1 = #10#22;
          |LEE 000#17=;
          |CIERRA #17;

          |SI #17#5 < #0Campo;
               aAlfa = "0000No hay suficientes. Stock = " + #17#5;
               |MENAV aAlfa;
               |ERROR; |ACABA;
          |FINSI;

          |SI #0Campo < 1;
               #0Campo = 1;
               |PINTA #0Campo;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Tipo2; |TIPO 2;
     nForma = 0 +. 1;
     |SI nForma = 1;
          |C_M #0#2, 1, "S";
          |C_M #0#3, 1, "S";
          |C_M #0#4, 1, "S";
          |C_M #0#5, 1, "S";
          |C_M #0#6, 1, "S";
          |C_M #0#7, 1, "S";
          |C_M #0#8, 1, "S";
     |SINO;
          |C_M #0#2, 1, "N";
          |C_M #0#3, 1, "N";
          |C_M #0#4, 1, "N";
          |C_M #0#5, 1, "N";
          |C_M #0#6, 1, "N";
          |C_M #0#7, 1, "N";
          |C_M #0#8, 1, "N";
     |FINSI;
     |HAZ Movimi;
|FPRC;

|PROCESO Final; |TIPO 3;
     aAlfa = Usuario % 810;
     |SI aAlfa = #0#13; |ACABA; |FINSI;

     enEvento = 7; eaTipo = "07";
     eaAsunto = "Modificacion Reserva Almacen. '" + #0#0 + "/" + (("000000" + #0#1) % -106);
     eaAsunto = eaAsunto + "' por Usuario: '" + aAlfa;
     eaOrigen = #0#13;
     eaPrograma = "guerm025" + #0#0 + #0#1;
     |HAZ FicEnvio;
     |HAZ EnviaEvento;
|FPRC;

|PROCESO Tipo 8; |TIPO 8;
     |MODULO aAlfa;
     |SI aAlfa = "guerm025";
          |HAZ PideAlmaCompra;
     |FINSI;
|FPRC;


|PROCESO gocercabImp;
     |PRINT;
|FPRC;

|PROCESO FicEnvio;
     |DBASS aAlfa;
     eaFicImpre= aAlfa + "spool/";
     aAlfa = Usuario;
     eaFicImpre = eaFicImpre + aAlfa;
     Impresora = eaFicImpre;
     |IMPRE -77;
     |SI FSalida = 0;
          |INFOR "guerm025";   ||*Correo
          |SI FSalida = 0;
               |PRINT;
               |PIEINF;
               |FININF;
          |FINSI;
          |FINIMP;
     |FINSI;
|FPRC;

|PROCESO Pdte; |TIPO 0;
     #0#17 = #0#9 - #0#16;
     |PINTA #0#17;
|FPRC;
