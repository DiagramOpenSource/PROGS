|FICHEROS;
     gomaw004 #0;
     gomaw005 #1,MANTE;
     goenvm02 #2;
     agifa027 #27;
     agifa029 #29;
     goalbpa4 #4;
     goalbpa5 #5;
     goalbpa6 #6;
     gomantho #7;
     goparame #10;
     agifa019 #19;
     gopre004 #40;
     gomantl1 #41;
     gotrabaj;
     goparam5 #100;
     guerm045 #45;
     referen@;
     gopre001 #101;
|FIN;

|INCLUYE i_varart;

|VARIABLES;
     &eaFicMas = "";
     &Tempo = "";
     nTecla = 0;
     &enAlmaObra = 0;
     ||----------------------
     &eaFicSalAuto = "";
     &eaSerExpSal = "";
     &enNumExpSal = 0;
     &eaSerPreSal = "";
     &enNumPreSal = 0;
     aSerAnt = "";
     nLinAuto = 0;
     ||--------------------------
     aSerPre = "";
     nNumPre = 0;
     nPreVta = 0;
     nPreCom = 0;
     nSwSale = 0;
     &enPrepe = 0;
     nGraba    = 0;
     nSwSal    = 0;
     &enEvento = 1;
     &eaAsunto = "";
     &eaOrigen = "";
     &eaTipoD  = "";
     aInforme = "gomaw004";
 {-1}Menu  = "";
     Menu1 = "2400";
     Menu2 = "1";
     Menu3 = " ";
     Menu4 = "RIAC";
     Menu5 = " Repasar ";
     Menu6 = " Imprimir ";
     Menu7 = " Aceptar ";
     Menu8 = " Cancelar ";
     nSwi  = 0;
     aAlfa = "";
     nConta = 0;
     nSwAct = 0;
     nLin = 0;
     &xDocTras      = 0;
     &xFecDocu      = @;
     &xLinDocu      = 0;
     &xCodArti      = "";
     &xDesArti      = "";
     &xSerie        = "";
     &xCanArti      = 0;
     &xAlmEntr      = 0;
     &xAlmSali      = 0;
     &xModo         = 0;
     &xForma        = 0;
     &enEnvio       = 0;
     &eaDestino     = "";
     &xCanArti2 = 0;
     &xMedida1 = 0;
     &xMedida2 = 0;
     &xMedida3 = 0;
     &eaArtiAnt = "";
     &xPartida = "";
|FIN;

|PROCESO DobleUniSali; |TIPO 7;
     |C_M #1#3, 1, "S";

     |ABRE #19;
     #19#0 = #1#1;
     |LEE 000#19=;
     |SI FSalida = 0;
          |SI #19#179 = "S"; |O #19#180 = "S";
               ||eaArtiAnt  (se cargar en el tipo 0 de la linea)
               enAlmacen  = enAlmaObra;
               eaArticulo = #1#1;
               enUnidad1 = #1#3;
               enUnidad2 = #1#10;
               enMedida1 = #1#11;
               enMedida2 = #1#12;
               enMedida3 = #1#13;
               eaPartida = #1#18;
               enModoVta = (FEntrada / 100) ! 0;
               |SUB_EJECUTA_NP "dsz99907";
               |SI eaSw2Stock = "S";
                    |C_M #1#3, 1, "N";
                    #1#3 = enUnidad1; |PINTA #1#3;
                    #1#10 = enUnidad2;
                    #1#11 = enMedida1;
                    #1#12 = enMedida2;
                    #1#13 = enMedida3;
                    #1#18 = eaPartida;
               |SINO;
                    #1#10 = 0;
                    #1#11 = 0;
                    #1#12 = 0;
                    #1#13 = 0;
                    #1#18 = "";
               |FINSI;
          |SINO;
               #1#10 = 0;
               #1#11 = 0;
               #1#12 = 0;
               #1#13 = 0;
               #1#18 = "";
          |FINSI;
     |FINSI;
     |CIERRA #19;
|FPRC

|PROCESO ExpLin;
     #101#0 = #41#3;
     #101#1 = #41#4;
     |LEE 000#101=;
     |SI FSalida = 0;
          |SALVA_DATOS #101;
          |REPON_DATOS #referen@;
          |GRABA 020#referen@.n;
     |FINSI;
|FPRC;

|DEFBUCLE ExpLin;
     #41#1;
     ;
     eaSerExpSal, enNumExpSal, 001;
     eaSerExpSal, enNumExpSal, 999;
     ;
     NULL, ExpLin;
|FIN;

|PROCESO Presu66; |TIPO 66;
     |DDEF aAlfa;
     aAlfa = aAlfa + "gopre001";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          aAlfa = Usuario;
          |NOME_DAT #referen@#aAlfa#; |DELINDEX #referen@;
          |ABRE #referen@;
          |ABRE #101;
          |BUCLE ExpLin;
          |CIERRA #101;
          #referen@#0 = #0#7;
          #referen@#1 = #0#8;
          |LEE 000#referen@.];
          |CONSULTA_CLAVE #1#referen@;
          |SI FSalida = 0;
               #0#7 = #referen@#0; |PINTA #0#7;
               #0#8 = #referen@#1; |PINTA #0#8;
          |SINO;
               |ERROR;
          |FINSI;
          |CIERRA #referen@;
          |DELINDEX #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|PROCESO Tipo2Lin; |TIPO 2;
|FPRC;

|PROCESO Correo;
     enEvento = 14; eaTipo = "14";
     eaAsunto = "Movimiento Material Almacen Central. " +  #2#3 + "/"+(("000000"+#0#4)%-106);
     eaAsunto = eaAsunto + " Obra Expediente: " + #0#1 + "/"+(("000000"+#0#2)%-106);
     eaOrigen = Usuario % 0810;
     eaPrograma = "gomaw002" + #0#0 + #0#1;

     |DBASS aAlfa;
     eaFicImpre= aAlfa + "spool/";
     aAlfa = Usuario;
     eaFicImpre = eaFicImpre + aAlfa;
     |HAZ Imprime;
     |HAZ EnviaEvento;
     eaFicImpre = "";

     |ABRE #gotrabaj;
     #gotrabaj#0 = #gomantho#30;
     |LEE 000#gotrabaj.=;
     |SI FSalida ! 0; |DDEFECTO #gotrabaj; |FINSI;
     |CIERRA #gotrabaj;
     enEnvio  = 0;
     eaOrigen = Usuario % 0810;
     eaDestino = #gotrabaj#27;
     eaPrograma = "gomaw002" + #0#0 + #0#1;
     |HAZ EnviaDSCorreo;
     |CIERRA #gotrabaj;
|FPRC;

|PROCESO MoviAlma;
     xForma =  1;
     xSerie   = #4#0;
     xDocTras = #4#1;
     xFecDocu = #4#2;
     xLinDocu = 0; || #6#35;  si es 0 hace ultima linea+1
     xCodArti = #5#3;
     xDesArti = #5#4;
     xCanArti = #6#10;
     xCanArti2 = #1#10;
     xMedida1 = #1#11;
     xMedida2 = #1#12;
     xMedida3 = #1#13;
     xPartida = #1#18;
     xAlmEntr = #6#17;
     xAlmSali = enAlmaObra; ||#5#8;

     |SUB_EJECUTA_NP "gomoval1";
|FPRC;

|PROCESO PrecioPreVta;
     nPreVta = #40#11;
|FPRC;

|DEFBUCLE PrecioPreVta;
     #40#3;
     ;
     aSerPre, nNumPre, "                    ", #6#20;
     aSerPre, nNumPre, "zzzzzzzzzzzzzzzzzzzz", #6#20;
     ;
     NULL, PrecioPreVta;
|FIN;

|PROCESO BusPresu;
     aSerPre = #41#3;
     nNumPre = #41#4;
     |ERROR10;
|FPRC;

|DEFBUCLE BusPresu;
     #41#1;
     ;
     #0#1, #0#2, 001;
     #0#1, #0#2, 999;
     ;
     NULL, BusPresu;
|FIN;

|PROCESO gomaw003;
     nSwAct = 1;

     #19#0 = #1#1;
     |LEE 020#19=;

     nLin = nLin + 1;
     #5#0 = #4#0;
     #5#1 = #4#1;
     #5#2 = nLin;
     #5#3 = #1#1;
     #5#4 = #1#2;
     #5#5 = #1#3;
     #5#6 = #1#3;
     #5#7 = 0;
     #5#8 = #7#11;
     #5#9 = #19#28;       ||P.comp
     #5#10 = #5#5 * #5#9; ||Imp

     #6#34 = "A";
     #6#4 = #5#0;
     #6#5 = #5#1;
     #6#6 = nLin;
     #6#7 = 1;

     #6#2 = #0#1;
     #6#3 = #0#2;
     #6#10 = #5#5;
     ||#6#11 = #19#18;
     ||#6#12 = 0;
     ||#6#13 = #6#10 * #6#11;
     ||#6#14 = #6#10 * #6#12;
     #6#15 = #7#2;
     #6#16 = #7#8;
     #6#17 = #7#11;
     #6#18 = #29#1;
     #6#20 = #5#3;
     #6#21 = #7#6;
     ||#6#22 = #6#11;
     ||#6#23 = #6#12;
     ||#6#24 = #6#13;
     ||#6#25 = #6#14;
     #6#26 = #19#200;
     #6#28 = #0#0;
     #6#29 = "M";
     |HAZ MoviAlma;
     #6#19 = xDocTras;
     #6#30 = #19#1;
     #6#32 = xSerie;
     #6#35 = xLinDocu;
     #5#11 = xDocTras;
     |GRABA 020#5n;

     aSerPre = ""; nNumPre = 0;
     |BUCLE BusPresu;
     |BUCLE PrecioPreVta;
     #6#0 = aSerPre;
     #6#1 = nNumPre;
     #6#41 = #1#4;      || nPreCom;
     #6#37 = nPreVta;
     |HAZ CalcuGopartia;
     |GRABA 020#6n;

     |DDEFECTO #45;
     #45#0 = #0#3;
     #45#1 = #0#4;
     #45#2 = #1#0;
     |LEE 101#45=;
     |SI FSalida ! 0;
          |GRABA 020#45b;
     |FINSI;
     #45#3 = #1#4;
     #45#8 = aSerPre;
     #45#9 = nNumPre;
     #45#10 = eaSerExpSal;
     #45#11 = enNumExpSal;
     #45#12 = eaSerPreSal;
     #45#13 = enNumPreSal;
     #45#14 = enAlmaObra;
     #45#15 = #7#11;
     |GRABA 020#45a;
     |LIBERA #45;
|FPRC;

|DEFBUCLE gomaw003;
     #1#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, gomaw003;
|FIN;

|PROCESO Actualiza;
     |ABRE #10; |LEE 000#10p; |CIERRA #10;

     |ABRE #7;
     #7#0 = #0#1;
     #7#1 = #0#2;
     |LEE 020#7=;
     |SI FSalida = 0;
          |ABRE #29;
          #29#0 = #7#11;
          |LEE 020#29=;
          |CIERRA #29;

          #4#2 = #0#0;
          #4#8 = #0#6;
          #4#9 = #0#5;
          |GRABA 020#4a;
          |LIBERA #4;
          |ABRE #6;
          |ABRE #5;
          |ABRE #19;
          |ABRE #45;
          |BUCLE gomaw003;
          |CIERRA #45;
          |CIERRA #6;
          |CIERRA #5;
          |CIERRA #19;
          ||||||HAZ Correo;
     |FINSI;
     |CIERRA #7;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO Tmp;
     |PRINT;
|FPRC;

|DEFBUCLE Tmp;
     #1#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Tmp;
|FIN;

|PROCESO Imprime;
     |SI eaFicImpre = "";
          nSwi = 1;
          |IMPRE 0;
     |SINO;
          Impresora = eaFicImpre;
          |IMPRE -77;
     |FINSI;
     |SI FSalida = 0;
          |INFOR aInforme;
          |SI FSalida = 0;
               |BUCLE Tmp;
               |PIEINF;
               |FININF;
          |FINSI;
          |FINIMP;
     |FINSI;
|FPRC;

|PROCESO Min;
     #1#0 = 1;
|FPRC;

|PROCESO Max;
     #1#0 = 999;
|FPRC;

|PROCESO Tipo12; |TIPO 12;
     |SI FSalida ! 0; |Y FSalida ! 5;
          |ACABA;
     |FINSI;

     |PARA; |SI Menu2 ! 4; |HACIENDO;
          nTecla = 0;
          |ENTLINEAL #1#1, 1, 1, 22, 0, Min, Max;
          |SI nTecla = 25; ||Ctrl-F7
               |HAZ CreaTempo;
               eaFichero = Tempo;
               |SUB_EJECUTA_NP "psion066";
               |HAZ BoraTempo;
               |SI enError = 0; |HAZ ImportaPDA; |FINSI;
               |ENTLINEAL #1#1, 1, 7, 22, 0, Min, Max;
          |FINSI;

          eaSerPreSal = #0#7;
          enNumPreSal = #0#8;

          |MENU Menu;
          Menu2 = FSalida;

          |SI Menu2 = 2;
               |HAZ Imprime;
          |FINSI;
          |SI Menu2 = 3;
               |SI nSwi = 0;
                    |CONFI "0000NImprimir Documento";
                    |SI FSalida = 0;
                         |HAZ Imprime;
                    |FINSI;
               |FINSI;
               |HAZ Actualiza;
               |LIBERA #4;
               eaSer = #0#3;
               enNum = #0#4;
               efFecha = #0#0;
               eaFicMas = "gomaw005"; |SUB_EJECUTA_NP "guerm045;TMP";

               Menu2 = 4;
          |FINSI;
     |SIGUE;
|FPRC;

|PROCESO Conta7; |TIPO 7;
     |SI #0#4 ! 0; |ACABA; |FINSI;

     |ABRE #27;
     #27#2 = #0#3;
     #27#0 = "movcenal";
     |LEE 101#27=;
     |SI FSalida = 0;
          nConta = #27#1;
          |SI nConta < 500000;
               nConta = nConta
          |FINSI;
          #27#1 = nConta + 1;
          |GRABA 020#27a;
     |SINO;
          #27#1 = 500002;
          nConta = 500001;
          |GRABA 020#27n;
     |FINSI;
     |CIERRA #27;
     #0#4 = nConta; |PINTA #0#4;
|FPRC;

|PROCESO ContaAuto;
     nConta = #0#4;
     |PARA FSalida = 0; |SI FSalida = 0; |HACIENDO;
          nConta = nConta + 1;
          #4#0 = #0#3;
          #4#1 = nConta;
          |LEE 000#4=;
     |SIGUE;
     |SI nConta > 999999;
          nConta = 500000;
          |PARA FSalida = 0; |SI FSalida = 0; |HACIENDO;
               nConta = nConta + 1;
               #4#0 = #0#3;
               #4#1 = nConta;
               |LEE 000#4=;
          |SIGUE;
     |FINSI;
     |SI nConta > 999999;
          |MENAV "0000No hay numero libre [500000-999999]";
          FSalida = 1;
     |SINO;
          |ABRE #27;
          #27#2 = #0#3;
          #27#0 = "movcenal";
          |LEE 101#27=;
          |SI FSalida = 0;
               #27#1 = nConta + 1;
               |GRABA 020#27a;
          |FINSI;
          |CIERRA #27;
     |FINSI;
|FPRC;

|PROCESO Conta0; |TIPO 0;
     |C_M #0#3, 0, aAlfa;
     |SI aAlfa = "N"; |ACABA; |FINSI;

     #4#0 = #0#3;
     #4#1 = #0#4;
     |LEE 000#4=;
     |SI FSalida = 0;
          |CONFI "0000SDocumento existente. Cambiar numero automatico...";
          |SI FSalida = 0;
               |HAZ ContaAuto;
               |SI FSalida = 0;
                    #0#4 = nConta;
                    |PINTA #0#4;
                    |GRABA 020#4b;
               |FINSI;
               |SI FSalida = 0;
                    nGraba = 1;
                    |C_M #0#3, 1, "N";
                    |C_M #0#4, 1, "N";
               |SINO;
                    |ERROR;
               |FINSI;
          |SINO;
               |ERROR;
          |FINSI;
     |SINO;
          |GRABA 020#4b;
          |SI FSalida = 0;
               nGraba = 1;
               |C_M #0#3, 1, "N";
               |C_M #0#4, 1, "N";
          |SINO;
               |ERROR;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Esc; |TIPO 6;
     |SI FSalida = 1;
          |SI nSwSale = 0;
               nSwSale = 1;
               |ERROR; |PTEC 807;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO CtrlFec; |TIPO 0;
     ||컴컴컴컴컴컴컴횮ontrol Cierre
     efFecha = #0#0;
     |HAZ EstaCerrado;
     |SI FSalida = 0;
          |ERROR; |ACABA;
     |SINO;
          |C_M #0#3, 1, "N";
          |C_M #0#4, 1, "N";
     |FINSI;
     ||컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|FPRC;

|PROCESO CheExpe; |TIPO 0;
     |ABRE #7;
     #7#0 = #0#1;
     #7#1 = #0#2;
     |LEE 020#7=;
     |CIERRA #7;

     |SI #10#76 = "N";
          |SI #10#22 ! #7#11;
               aAlfa = "0000Almacen:" + #7#11 + " , no es Almacen Central...";
               |MENAV aAlfa;
          |FINSI;
     |SINO;
          |ABRE #100;
          #100#0 = #7#11;
          |LEE 000#100=;
          |SI FSalida ! 0;
               aAlfa = "0000Almacen:" + #7#11 + " , no es Almacen Central...";
               |MENAV aAlfa;
               |ERROR; |ACABA;
          |FINSI;
          |CIERRA #100;
     |FINSI;

     |HAZ EsForestales;
     |SI FSalida = 0;
          |C_M #0#7, 1, "S";
          |C_M #0#8, 1, "S";
     |SINO;
          |C_M #0#7, 1, "N";
          |C_M #0#8, 1, "N";
     |FINSI;
|FPRC;

|PROCESO Tecla; |TIPO 11;
     |SI FSalida = 25; ||Ctrl-F7
          nTecla = FSalida;
          |PTEC 807;
     |FINSI;
|FPRC;

|PROGRAMA;
     |ABRE #10; |LEE 000#10p; |CIERRA #10;
     |HAZ PideAlmaObra;

     |SI #10#16 = "S"; |Y #10#81 = "N";
          |HAZ BuscaExSal2;
          |SI enError ! 0; |ACABA; |FINSI;
     |FINSI;

     |SI #10#81 = "S";
          |HAZ BuscaExSal;
          |SI enError ! 0; |ACABA; |FINSI;
     |FINSI;

     aAlfa = Usuario % 0810;
     |ABRE #2;
     #2#0 = aAlfa;
     |LEE 000#2=;
     |SI FSalida ! 0;
          aAlfa = "0000No existe Usuario: [" + aAlfa + "] en la libreta de direcciones";
          |MENAV aAlfa;
     |FINSI;
     |CIERRA #2;

     eaFichero = Usuario; |QBF eaFichero;
     |NOME_DAT #1 eaFichero;
     |DELINDEX #1;

     |CLS;

     aAlfa = #10#68; |QBF aAlfa;
     |SI aAlfa ! "";
          |C_V #0#5, 1, "S";
          |PINPA #0#0;
          |PINTA 1103, #10#68;
     |SINO;
          |PINPA #0#0;
     |FINSI;
     |SI #10#141 = "O";
          |PINTA 802, " O.T........:";
          |PINTA 855, "O.E.Dev.:";
     |FINSI;

     #0#7 = eaSerPreSal; |PINTA #0#7;
     #0#8 = enNumPreSal; |PINTA #0#8;

     |ENTLINEAL #1#1, 1, 7, 22, 0, Min, Max;
     |PINDA #0#0;

     |ABRE #4;
     |ENDATOS #1#0;
     |SI nSwAct = 0; |Y nGraba = 1;
          #4#0 = #0#3;
          #4#1 = #0#4;
          |LEE 101#4=;
          |SI FSalida = 0;
               |BORRA 000#4c;
          |FINSI;
     |FINSI;
     |CIERRA #4;

     |DELINDEX #1;
|FPRO;

|PROCESO ImportaPDA;
     |ABRE #19;
     |ABRE #1;
     |LEE 000#0u;
     |SI FSalida = 0;
          nLin = #1#0 + 1;
     |SINO;
          nLin = 1;
     |FINSI;

     |DDEF aAlfa; aAlfa = aAlfa + "psion067";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida ! 0; |ACABA; |FINSI;
     |NOME_DAT #referen@#eaFichero#;
     |ABRE #referen@;
     |LEE 000#referen@.p;
     |PARA; |SI FSalida = 0; |HACIENDO;
          #1#0 = nLin;
          #1#1 = #referen@#0; ||Arti

          |DDEFECTO #19;
          #19#0 = #1#1;
          |LEE 000#19=;

          #1#2 = #referen@#1; ||Des
          #1#3 = #referen@#3; ||Uni
          #1#4 = #19#133;

          |GRABA 020#1n;
          nLin = nLin + 1;
          |LEE 000#referen@.s;
     |SIGUE;
     |CIERRA #referen@;
     |DELINDEX #referen@;
     |DESCARGA_DEF #referen@;

     |CIERRA #1;
     |CIERRA #19;
|FPRC;

|PROCESO DocTipo66; |TIPO 66;
     |ABRE #7;
     #7#0 = #0#3;
     #7#1 = 0;
     |LEE 000#7];
     |CONSULTA_CLAVE #1#7;
     |SI FSalida = 0;
          #0#3 = #7#0; |PINTA #0#3;
     |SINO;
          |ERROR;
     |FINSI;
     |CIERRA #7;
|FPRC;
