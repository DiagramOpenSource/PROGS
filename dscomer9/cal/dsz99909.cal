|FICHEROS;
     dsm00225;
     agifa065;
     agifa024;
     agifa112;
     agifa142;

     Ref0001@;
     Ref0002@;
|FIN;

|VARIABLES;
     nDigito1    = 0;
     nDigito2    = 0;
     nDigito3    = 0;
     nDigito4    = 0;
     nDigito5    = 0;
     nDigito6    = 0;
     nDigito7    = 0;
     nDigito8    = 0;
     nDigito9    = 0;
     nValor      = 0;
     nValor1     = 0;
     nValor2     = 0;
     nValor3     = 0;
     nValor4     = 0;
     nValor5     = 0;
     nValor6     = 0;
     nValor7     = 0;
     nValor8     = 0;
     nCaracter   = 0;
     nPosi       = 0;
     nCont       = 0;
     nCalc       = 0;
     nLib        = 0;

     nOk                 = 0;
     nAnyo               = 0;
     nEmpr               = 0;
     nPer                = 0;

     aBase               = "";
     aAlfa               = "";
     aError              = "";
     aPathConta          = "";
     aConta              = "";
     aEmpr               = "";
     aPer                = "";
     aMas                = "";
     aFic                = "";
     a191                = "";
     a152                = "";

     aLetrasNif  = "TRWAGMYFPDXBNJZSQVHLCKE";
     aLetrasCif  = "ABCDEFGHNPQSKLMJUVWR";
     aLetrasExt  = "XYZ";
     aLetraGuiri = "";
     aLetra1     = "";
     aLetra2     = "";
     aLetra3     = "";
     aLetra4     = "";
     aLetra5     = "";
     aLetra6     = "";
     aLetra7     = "";
     aLetra8     = "";
     aCadena     = "";
     aCaracter   = "";
     aCarac1     = 0;
     aCarac2     = 0;
     aCarac3     = 0;
     aCarac4     = 0;
     aCarac5     = 0;

     aDigito     = "";
     aDigito1    = "";
     aDigito2    = "";
     aDigito3    = "";
     aDigito4    = "";
     aDigito5    = "";
     aDigito6    = "";
     aDigito7    = "";
     aDigito8    = "";
     aDigito9    = "";
     aComodin1   = "";
     aComodin2   = "";
     aNombre     = "";

     fFechaSys           = @;

     &eaPais             = "";
     &eaVarDni           = "";
     &enCalcCif          = 0;
     &eaTipo             = "";
     &eaCtaCble          = "";
     &eaCod              = "";
     &enOk               = 0;
     &enError            = 0;
     &enLiq              = 0;
     &enCer              = 0;
     &enFac              = 0;
     &eaSer              = "";
     &eaAny              = "";
     &eaTip              = "";
     &eaModo             = "";
     &eaPathConta        = "";
     &eaFichConta        = "";
|FIN;

|PROCESO CompruebaCif;
     nValor1   = nDigito3 + nDigito5 + nDigito7;

     nValor3   = ((nDigito2 * 2) $ 10) + ((((nDigito2 * 2) / 10) - .49) ! 0);
     nValor4   = ((nDigito4 * 2) $ 10) + ((((nDigito4 * 2) / 10) - .49) ! 0);
     nValor5   = ((nDigito6 * 2) $ 10) + ((((nDigito6 * 2) / 10) - .49) ! 0);
     nValor6   = ((nDigito8 * 2) $ 10) + ((((nDigito8 * 2) / 10) - .49) ! 0);

     nValor2   = nValor3 + nValor4 + nValor5 + nValor6;
     nValor    = 10 - ((nValor1 + nValor2) $ 10);

     |SI aDigito1 = "P";  |O aDigito1 = "S";  |O aDigito1 = "Q";
      |O aDigito1 = "N";  |O aDigito1 = "R";  |O aDigito1 = "W";
         nValor  = 64 + nValor;
         aDigito = &nValor;

         |SI enCalcCif = 1;
             |SI aDigito9 ! aDigito;
                 aAlfa = "0000 Puede estar mal introducido el CIF, el Digito de Control me da un resultado de " + aDigito;
                 |MENAV aAlfa;
             |SINO;
                 |MENAV "0000 El CIF es correcto.";
             |FINSI;
          |FINSI;

         |SI enCalcCif = 2;
             |SI aDigito9 ! aDigito;
                 eaVarDni = (eaVarDni % 108) + aDigito;
             |FINSI;
         |FINSI;

         |SI enCalcCif = 0;
             |SI aDigito9 ! aDigito;
                 aAlfa = "0000 Puede estar mal introducido el CIF, el Digito de Control me da un resultado de " + aDigito;
                 |MENAV aAlfa;
                 |CONFI "0000NContinuamos";
                 |SI FSalida ! 0;  |ERROR;  |FINSI;
             |FINSI;
         |FINSI;
     |SINO;
         |SI nValor ] 10;  nValor = 0;  |FINSI;

         |SI enCalcCif = 1;
             |SI nValor ! nDigito9;
                 aAlfa = "0000 Puede estar mal introducido el CIF, el Digito de Control me da un resultado de " + nValor;
                 |MENAV aAlfa;
             |SINO;
                 |MENAV "0000 El CIF es correcto.";
             |FINSI;
         |FINSI;

         |SI enCalcCif = 2;
             |SI nValor ! nDigito9;
                 eaVarDni = (eaVarDni % 108) + nValor;
             |FINSI;
         |FINSI;

         |SI enCalcCif = 0;
             |SI nValor ! nDigito9;
                 aAlfa = "0000 Puede estar mal introducido el CIF, el Digito de Control me da un resultado de " + nValor;
                 |MENAV aAlfa;
                 |CONFI "0000NContinuamos";
                 |SI FSalida ! 0;  |ERROR;  |FINSI;
             |FINSI;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO CalculoNIFCIF;
     |ABRE #dsm00225;
     #dsm00225#0 = eaPais;
     |LEE 000#dsm00225.=;
     |CIERRA #dsm00225;
     |SI #dsm00225#6 = "S"; |ACABA; |FINSI;


     aLetraGuiri = "";
     aCaracter   = eaVarDni % 101;
     aAlfa       = aLetrasExt - aCaracter;
     |SI FSalida ! 0;
         aLetraGuiri  = aCaracter;
     |FINSI;

     |QBF eaVarDni;
     aLetra2 = eaVarDni;
     |QBT aLetra2;

     aCaracter  = aLetra2 % 101;
     aAlfa      = aLetrasCif - aCaracter;

     |SI aAlfa = aLetrasCif;
         aLetra4 = "";
         aLetra3 = aLetra2 % 0;
         aCarac2 = aLetra3;

         |PARA aCarac5 = 1;  |SI aCarac5 [ aCarac2;  |HACIENDO aCarac5 = aCarac5 + 1;
               aCarac3 = (aCarac5 * 100) + 1;
               aLetra3 = aLetra2 % aCarac3;
               |SI aLetra3 ] "0"; |Y aLetra3 [ "9";
                   aLetra4 = aLetra4 + aLetra3;
              |FINSI;
         |SIGUE;

         |SI aLetraGuiri ! "";
             aLetra4 = ("0000000" + aLetra4) % -107;
             |SI aLetraGuiri = "X"; aLetra4 = "0" + aLetra4;  |FINSI;
             |SI aLetraGuiri = "Y"; aLetra4 = "1" + aLetra4;  |FINSI;
             |SI aLetraGuiri = "Z"; aLetra4 = "2" + aLetra4;  |FINSI;
         |FINSI;

         aCarac4 = aLetra4;
         |SI aCarac4 ! 0; |Y aLetra4 ! "";
             aCarac1 = aCarac4 $ 23;
             aCarac1 = aCarac1 + 1;
             aCarac3 = (aCarac1 * 100) + 1;
             aLetra1 = aLetrasNif % aCarac3;
             aLetra4 = "000000000000" + aLetra4;
             aLetra7 = aLetra4 % -103;
             aLetra6 = aLetra4 % -403;
             aLetra5 = aLetra4 % -703;

             aLetra8 = aLetra5  % 101;
             |SI aLetra8 = "0"; aLetra5 = aLetra5 % 202; |FINSI;

             aLetra8 = aLetra5  % 101;
             |SI aLetra8 = "0"; aLetra5 = aLetra5 % 201; |FINSI;

             aLetra8 = aLetra5  % 101;
             |SI aLetra8 = "0"; aLetra5 = ""; |FINSI;

             aLetra4 = aLetra6 + aLetra7 + aLetra1;
             |SI aLetra5 ! "";
                 aLetra4 = aLetra5 + aLetra6 + aLetra7 + aLetra1;
             |FINSI;

             eaVarDni = aLetra4;
             eaVarDni = ("000000000" + eaVarDni) % -109;
         |FINSI;
     |SINO;
         aCaracter = "";
         aCadena   = "";
         |PARA nCaracter = 1; |SI nCaracter [ 12; |HACIENDO nCaracter = nCaracter + 1;
               nPosi = (100 * nCaracter) + 1;
               aCaracter = eaVarDni % nPosi;
               |SI aCaracter ! "."; |Y aCaracter ! "-"; |Y aCaracter ! " ";
                   aCadena = aCadena + aCaracter;
               |FINSI;
         |SIGUE;
         eaVarDni = aCadena;

         aDigito1  = eaVarDni % 101;
         aDigito2  = eaVarDni % 201;   nDigito2  = aDigito2;
         aDigito3  = eaVarDni % 301;   nDigito3  = aDigito3;
         aDigito4  = eaVarDni % 401;   nDigito4  = aDigito4;
         aDigito5  = eaVarDni % 501;   nDigito5  = aDigito5;
         aDigito6  = eaVarDni % 601;   nDigito6  = aDigito6;
         aDigito7  = eaVarDni % 701;   nDigito7  = aDigito7;
         aDigito8  = eaVarDni % 801;   nDigito8  = aDigito8;
         aDigito9  = eaVarDni % 901;   nDigito9  = aDigito9;

         |SI enCalcCif ! 3;  |HAZ CompruebaCif;  |FINSI;
     |FINSI;

     |SI aLetraGuiri ! "";
         eaVarDni = aLetraGuiri + (eaVarDni % 211);
     |FINSI;

     eaVarDni = (eaVarDni + "            ") % 112;
     |QBF eaVarDni;
|FPRC;

|PROCESO MensaNIF;
     enOk = 0;

     |DBASS aBase;
     aAlfa = aBase + "integral/def/dsam0103.mas";
     |XABRE "E", aAlfa, 0;
     |SI FSalida ] 0;
         enOk = 1;
     |SINO;
         aAlfa = aBase + "basica/def/agim0003.mas";
         |XABRE "E", aAlfa, 0;
         |SI FSalida ] 0;
             enOk = 2;
         |FINSI;
     |FINSI;

     |SI enOk = 0;
         |MENSA "0000< F12 > Calcula N.I.F.";
     |SINO;
         |MENSA "0000<F12> Calcula N.I.F. <F2> Consulta registros de NIFS/CIFS";
     |FINSI;
|FPRC;

|PROCESO ConsultaNIFS;
     nOk = 0;

     |DBASS aBase;
     aAlfa = aBase + "integral/def/dsam0103.mas";
     |XABRE "E", aAlfa, 0;
     |SI FSalida ] 0;
         nOk = 1;
     |SINO;
         aAlfa = aBase + "basica/def/agim0003.mas";
         |XABRE "E", aAlfa, 0;
         |SI FSalida ] 0;
             nOk = 2;
         |FINSI;
     |FINSI;

     |SI nOk = 0;
         |ACABA;
     |FINSI;

     |CARGA_DEF aAlfa, Ref0001@;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |ABRE #Ref0001@;
     #Ref0001@#0 = eaVarDni;
     |LEE 000#Ref0001@.=;

     |CONSULTA_CLAVE #1#Ref0001@;
     |SI FSalida = 0;
         eaVarDni = #Ref0001@#0;
     |FINSI;

     |CIERRA #Ref0001@;
     |DESCARGA_DEF #Ref0001@;
|FPRC;

|| Retorna 1 si en contagen, caivaasi (ctrl entrada fras)
|| en el campo vincular dscomer9 = S
|PROCESO CargaContagen;
     enOk = 0;

     |ABRE #agifa142;
     |LEE 000#agifa142.p;
     |SI FSalida ! 0;  |DDEFECTO #agifa142;  |FINSI;
     |CIERRA #agifa142;

     aPathConta = #agifa142#151;  |QBF aPathConta;
     |SI aPathConta = "";
         |ACABA;
     |FINSI;

     fFechaSys = ~;
     aAlfa     = fFechaSys % -102;
     nAnyo     = aAlfa;
     nEmpr     = -1;
     nPer      = -1;

     aConta = "C";
     aAlfa = #agifa142#151 < "";
     aAlfa = aAlfa - "agicont";
     |SI FSalida ! 0;
         aConta = "A";
     |FINSI;

     |SI aConta = "A";
         |ACABA;
     |FINSI;

     nEmpr = #48#0;

     aMas = aPathConta + "def/canempre.mas";
     |CARGA_DEF aMas, Ref0001@;

     |SI FSalida ! 0;
         |ACABA;
     |FINSI;

     aFic = aPathConta + "fich/";
     |PATH_DAT #Ref0001@#aFic#;

     |ABRE #Ref0001@;
     |SELECT #4#Ref0001@;
     #Ref0001@#2  = nEmpr;
     #Ref0001@#26 = nAnyo;
     |LEE 000#Ref0001@.=;
     |SI FSalida = 0;
         nPer = #Ref0001@#3;
     |FINSI;
     |CIERRA #Ref0001@;

     |DESCARGA_DEF #Ref0001@;

     |SI nPer = -1;
         |ACABA;
     |FINSI;

     aFic = aPathConta + "fich/" + (("00000" + nEmpr) % -105) + nPer + "/";

     aMas = aPathConta + "def/caivaasi.mas";
     |CARGA_DEF aMas, Ref0001@;

     |PATH_DAT #Ref0001@#aFic#;

     |ABRE #Ref0001@;
     |LEE 000#Ref0001@.p;
     |SI FSalida ! 0;  |DDEFECTO #Ref0001@;  |FINSI;
     |CIERRA #Ref0001@;

     a191 = #Ref0001@#191;
     a152 = #Ref0001@#152;
     a152 = #Ref0001@#152;

     |DESCARGA_DEF #Ref0001@;

     |SI a191 = "N";  |ACABA;  |FINSI;

     enOk        = 1;
     eaFichConta = aFic;
     eaPathConta = aPathConta;
|FPRC;

|PROCESO MensaCTA;
     |HAZ CargaContagen;

     |SI enOk = 0;
         |ACABA;
     |FINSI;

     |MENSA "0000< F11 > Consulta Clientes - Proveedores contagen";
|FPRC;

|PROCESO BuscaCliProv;
     |HAZ CargaContagen;

     |SI enOk = 0;
         |ACABA;
     |FINSI;

     aMas = aPathConta + "def/caclipro.mas";
     |CARGA_DEF aMas, Ref0001@;

     |PATH_DAT #Ref0001@#aFic#;

     |ABRE #Ref0001@;  |SELECT #1#Ref0001@;

     #Ref0001@#23 = eaTipo;
     #Ref0001@#10 = eaCtaCble;
     |LEE 000#Ref0001@.=;
     |SI FSalida = 0;
         |SI #Ref0001@#9 ! eaVarDni;
             |MENAV "0000La cuenta contable ya existe con un NIF distinto";
             |ERROR;
         |SINO;
             |SI a152 ! "X";
                 |MENAV "0000La cuenta contable ya existe con este NIF";
                 |SI a152 = "N";
                     |ERROR;
                 |FINSI;
             |SINO;
                 |CONFI "0000NLa cuenta contable ya existe con este NIF. Continuar.";
                 |SI FSalida ! 0;
                     |ERROR;
                 |FINSI;
             |FINSI;
         |FINSI;
     |FINSI;

     |DESCARGA_DEF #Ref0001@;
|FPRC;

|PROCESO SacaCliProv;
     |HAZ CargaContagen;

     |SI enOk = 0;
         |ACABA;
     |FINSI;

     aMas = aPathConta + "def/caclipro.mas";
     |CARGA_DEF aMas, Ref0001@;

     |PATH_DAT #Ref0001@#aFic#;
     |ABRE #Ref0001@;  |SELECT #1#Ref0001@;
     #Ref0001@#23 = eaTipo;
     #Ref0001@#10 = eaCtaCble;
     |LEE 000#Ref0001@.=;

     |CONSULTA_CLAVE #1#Ref0001@;
     |SI FSalida = 0;
         eaCtaCble = #Ref0001@#10;
     |FINSI;
     |DESCARGA_DEF #Ref0001@;
|FPRC;

|PROCESO cacliproBusca;
     |SI #Ref0001@#23 ! eaTipo;
         |ACABA;
     |FINSI;

     enOk = 0;

     |SI eaTipo = "C";
         #agifa024#1   = #Ref0001@#1;
         #agifa024#2   = #Ref0001@#1;

         #agifa024#17  = #Ref0001@#7;
         #agifa024#18  = #Ref0001@#8;
         #agifa024#15  = #Ref0001@#9;
         || #agifa024#16  = #Ref0001@#10;
         #agifa024#29  = #Ref0001@#13;
         #agifa024#34  = #Ref0001@#14;
         #agifa024#30  = #Ref0001@#17;
         #agifa024#162 = #Ref0001@#19;
         #agifa024#20  = #Ref0001@#20;
         #agifa024#183 = #Ref0001@#25;
         #agifa024#205 = #Ref0001@#24;
         #agifa024#203 = #Ref0001@#28;
         #agifa024#32  = #Ref0001@#29;
         #agifa024#33  = #Ref0001@#30;
         #agifa024#31  = #Ref0001@#31;
         #agifa024#30  = #Ref0001@#32;
         #agifa024#3   = #Ref0001@#33;
         #agifa024#22  = #Ref0001@#34;
         #agifa024#23  = #Ref0001@#35;
         #agifa024#24  = #Ref0001@#36;
         #agifa024#215 = #Ref0001@#40;
         #agifa024#216 = #Ref0001@#41;
         #agifa024#11  = #Ref0001@#44;
         #agifa024#184 = #Ref0001@#45;
         #agifa024#185 = #Ref0001@#46;
         #agifa024#13  = #Ref0001@#47;
         #agifa024#12  = #Ref0001@#48;
         #agifa024#27  = #Ref0001@#49;
         #agifa024#186 = #Ref0001@#50;
         #agifa024#197 = #Ref0001@#51;

         #agifa024#8   = #Ref0001@#2;
         #agifa024#181 = #Ref0001@#3;
         #agifa024#182 = #Ref0001@#4;
         #agifa024#10  = #Ref0001@#5;
         #agifa024#9   = #Ref0001@#6;

         aAlfa = #agifa024#5;  |QBF aAlfa;
         |SI aAlfa = "";
             #agifa024#5   = #agifa024#8;
             #agifa024#178 = #agifa024#181;
             #agifa024#179 = #agifa024#182;
             #agifa024#7   = #agifa024#10;
             #agifa024#6   = #agifa024#9;
         |FINSI;

         aAlfa = #agifa024#11;  |QBF aAlfa;
         |SI aAlfa = "";
             #agifa024#11  = #agifa024#8;
             #agifa024#184 = #agifa024#181;
             #agifa024#185 = #agifa024#182;
             #agifa024#13  = #agifa024#10;
             #agifa024#12  = #agifa024#9;
         |FINSI;

         #agifa024#180 = (("00" + #agifa024#178) % -102) + (("000" + #agifa024#179) % -103);
         #agifa024#183 = (("00" + #agifa024#181) % -102) + (("000" + #agifa024#182) % -103);
         #agifa024#186 = (("00" + #agifa024#184) % -102) + (("000" + #agifa024#185) % -103);

         |PINDA #0#agifa024;
     |FINSI;

     |SI eaTipo = "P";
         || #agifa112#10  = #Ref0001@#10;
         #agifa112#1   = #Ref0001@#1;
         #agifa112#2   = #Ref0001@#1;
         #agifa112#3   = #Ref0001@#2;
         #agifa112#74  = #Ref0001@#3;
         #agifa112#75  = #Ref0001@#4;
         #agifa112#76  = #Ref0001@#25;
         #agifa112#89  = #Ref0001@#24;
         #agifa112#5   = #Ref0001@#5;
         #agifa112#4   = #Ref0001@#6;
         #agifa112#6   = #Ref0001@#7;
         #agifa112#7   = #Ref0001@#8;
         #agifa112#9   = #Ref0001@#9;
         #agifa112#11  = #Ref0001@#13;
         #agifa112#16  = #Ref0001@#14;
         #agifa112#12  = #Ref0001@#17;
         #agifa112#57  = #Ref0001@#19;
         #agifa112#17  = #Ref0001@#20;
         #agifa112#98  = #Ref0001@#28;
         #agifa112#14  = #Ref0001@#29;
         #agifa112#15  = #Ref0001@#30;
         #agifa112#13  = #Ref0001@#31;
         #agifa112#12  = #Ref0001@#32;
         #agifa112#92  = #Ref0001@#33;
         #agifa112#19  = #Ref0001@#34;
         #agifa112#20  = #Ref0001@#35;
         #agifa112#21  = #Ref0001@#36;
         #agifa112#99  = #Ref0001@#37;
         #agifa112#94  = #Ref0001@#38;
         #agifa112#95  = #Ref0001@#39;
         #agifa112#96  = #Ref0001@#40;
         #agifa112#97  = #Ref0001@#41;
         #agifa112#101 = #Ref0001@#44;
         #agifa112#102 = #Ref0001@#45;
         #agifa112#103 = #Ref0001@#46;
         #agifa112#104 = #Ref0001@#47;
         #agifa112#105 = #Ref0001@#48;
         #agifa112#106 = #Ref0001@#49;
         #agifa112#107 = #Ref0001@#50;

         |PINDA #0#agifa112;
     |FINSI;

     |SI enOk = 1;
         |ERROR10;
     |FINSI;
|FPRC;

|DEFBUCLE cacliproBusca;
     #Ref0001@#4001;
     ;
     eaVarDni;
     eaVarDni;
     ;
     NULL, cacliproBusca;
|FIN;

|PROCESO PonDatosNIFS;
     aAlfa = #Ref0001@#9;  |QBF aAlfa;
     |SI aAlfa ! "";
         aAlfa = aAlfa + " ";
     |FINSI;

     aAlfa = aAlfa + #Ref0001@#2;  |QBF aAlfa;
     |SI #Ref0001@#3 ! "    ";
         aAlfa = aAlfa + ", " + #Ref0001@#3;  |QBF aAlfa;
     |FINSI;

     |SI #Ref0001@#10 ! "   ";
         aAlfa = aAlfa + " " + #Ref0001@#10;  |QBF aAlfa;
     |FINSI;

     |SI #Ref0001@#11 ! "  ";
         aAlfa = aAlfa + " " + #Ref0001@#11;
     |FINSI;

     |SI eaTipo = "C";
         |SI eaModo = "2";
             #agifa024#1   = #Ref0001@#1;
             |PINTA #agifa024#1;

             aAlfa = #agifa024#2;  |QBF aAlfa;
             |SI aAlfa = "";
                 #agifa024#2   = #Ref0001@#1;
                 |PINTA #agifa024#2;
             |FINSI;

             |ACABA;
         |FINSI;

         #agifa024#1   = #Ref0001@#1;
         #agifa024#2   = #Ref0001@#1;

         #agifa024#17  = #Ref0001@#8;
         #agifa024#18  = #Ref0001@#17;
         #agifa024#205 = #Ref0001@#12;
         #agifa024#14  = #Ref0001@#13;

         #agifa024#8   = aAlfa;
         #agifa024#181 = #Ref0001@#4;
         #agifa024#182 = #Ref0001@#5;
         #agifa024#10  = #Ref0001@#7;
         #agifa024#9   = #Ref0001@#6;

         #agifa024#5   = #agifa024#8;
         #agifa024#178 = #agifa024#181;
         #agifa024#179 = #agifa024#182;
         #agifa024#7   = #agifa024#10;
         #agifa024#6   = #agifa024#9;

         #agifa024#11  = #agifa024#8;
         #agifa024#184 = #agifa024#181;
         #agifa024#185 = #agifa024#182;
         #agifa024#13  = #agifa024#10;
         #agifa024#12  = #agifa024#9;

         #agifa024#180 = (("00" + #agifa024#178) % -102) + (("000" + #agifa024#179) % -103);
         #agifa024#183 = (("00" + #agifa024#181) % -102) + (("000" + #agifa024#182) % -103);
         #agifa024#186 = (("00" + #agifa024#184) % -102) + (("000" + #agifa024#185) % -103);

         |PINDA #0#agifa024;
     |FINSI;

     |SI eaTipo = "P";
         |SI eaModo = "2";
             #agifa112#1   = #Ref0001@#1;
             |PINTA #agifa112#1;

             aAlfa = #agifa112#2;  |QBF aAlfa;
             |SI aAlfa = "";
                 #agifa112#2   = #Ref0001@#1;
                 |PINTA #agifa112#2;
             |FINSI;

             |ACABA;
         |FINSI;

         #agifa112#1   = #Ref0001@#1;
         #agifa112#2   = #Ref0001@#1;
         #agifa112#3   = aAlfa;
         #agifa112#74  = #Ref0001@#4;
         #agifa112#75  = #Ref0001@#5;
         #agifa112#89  = #Ref0001@#12;
         #agifa112#5   = #Ref0001@#7;
         #agifa112#4   = #Ref0001@#6;
         #agifa112#6   = #Ref0001@#8;
         #agifa112#7   = #Ref0001@#17;
         #agifa112#101 = #agifa112#3;
         #agifa112#105 = #agifa112#4;
         #agifa112#102 = #agifa112#74;
         #agifa112#103 = #agifa112#75;
         #agifa112#104 = #agifa112#5;

         |PINDA #0#agifa112;
     |FINSI;
|FPRC;

|PROCESO RecogeNIFS;
     nOk = 0;

     |DBASS aBase;
     aAlfa = aBase + "integral/def/dsam0103.mas";
     |XABRE "E", aAlfa, 0;
     |SI FSalida ] 0;
         nOk = 1;
     |SINO;
         aAlfa = aBase + "basica/def/agim0003.mas";
         |XABRE "E", aAlfa, 0;
         |SI FSalida ] 0;
             nOk = 2;
         |FINSI;
     |FINSI;

     |SI nOk = 0;
         |ACABA;
     |FINSI;

     |CARGA_DEF aAlfa, Ref0001@;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |ABRE #Ref0001@;
     #Ref0001@#0 = eaVarDni;
     |LEE 000#Ref0001@.=;
     |SI FSalida ! 0;
         |CIERRA #Ref0001@;
         |SI nOk = 1;
             |SUB_EJECUTA ":integral/dsaz0027";
         |FINSI;

         |SI nOk = 2;
             |SUB_EJECUTA ":basica/agiz0027";
         |FINSI;
     |FINSI;
     |CIERRA #Ref0001@;

     enOk = 0;

     |ABRE #Ref0001@;
     #Ref0001@#0 = eaVarDni;
     |LEE 000#Ref0001@.=;
     |SI FSalida ! 0;
         enOk = 1;
     |SINO;
         |HAZ PonDatosNIFS;
     |FINSI;
     |CIERRA #Ref0001@;

     |DESCARGA_DEF #Ref0001@;
|FPRC;

|PROCESO RecogeCliProvNIF;
     |HAZ CargaContagen;

     |SI enOk = 0;
         |ACABA;
     |FINSI;

     enOk = 1;

     |SI eaModo = "1";
         aMas = aPathConta + "def/caclipro.mas";
         |CARGA_DEF aMas, Ref0001@;

         |PATH_DAT #Ref0001@#aFic#;
         |BUCLE cacliproBusca;
         |DESCARGA_DEF #Ref0001@;

         |SI enOk = 0;
             |ACABA;
         |FINSI;
     |FINSI;

     |HAZ RecogeNIFS;
|FPRC;

|PROCESO RecogeCliProvCOD;
     |HAZ CargaContagen;

     |SI enOk = 0;
         |ACABA;
     |FINSI;

     enOk = 0;

     aMas = aPathConta + "def/caclipro.mas";
     |CARGA_DEF aMas, Ref0001@;

     |PATH_DAT #Ref0001@#aFic#;
     |ABRE #Ref0001@;
     #Ref0001@#23 = eaTipo;
     #Ref0001@#10 = eaCtaCble;
     |LEE 000#Ref0001@.=;
     |SI FSalida = 0;
         |HAZ cacliproBusca;
         enOk = 1;
     |FINSI;
     |CIERRA #Ref0001@;
     |DESCARGA_DEF #Ref0001@;
|FPRC;

|PROCESO RecogeDatosCli;
     #Ref0001@#1  = #agifa024#1;
     #Ref0001@#2  = #agifa024#8;
     #Ref0001@#3  = #agifa024#181;
     #Ref0001@#4  = #agifa024#182;
     #Ref0001@#5  = #agifa024#10;
     #Ref0001@#6  = #agifa024#9;
     #Ref0001@#7  = #agifa024#17;
     #Ref0001@#8  = #agifa024#18;
     #Ref0001@#9  = #agifa024#15;
     #Ref0001@#10 = #agifa024#16;
     #Ref0001@#13 = #agifa024#29;
     #Ref0001@#14 = #agifa024#34;
     #Ref0001@#17 = #agifa024#30;
     #Ref0001@#19 = #agifa024#162;
     #Ref0001@#20 = #agifa024#20;
     #Ref0001@#25 = #agifa024#183;
     #Ref0001@#24 = #agifa024#205;
     #Ref0001@#28 = #agifa024#203;
     #Ref0001@#29 = #agifa024#32;
     #Ref0001@#30 = #agifa024#33;
     #Ref0001@#31 = #agifa024#31;
     #Ref0001@#32 = #agifa024#30;
     #Ref0001@#33 = #agifa024#3;
     #Ref0001@#34 = #agifa024#22;
     #Ref0001@#35 = #agifa024#23;
     #Ref0001@#36 = #agifa024#24;
     #Ref0001@#40 = #agifa024#215;
     #Ref0001@#41 = #agifa024#216;
     #Ref0001@#44 = #agifa024#11;
     #Ref0001@#45 = #agifa024#184;
     #Ref0001@#46 = #agifa024#185;
     #Ref0001@#47 = #agifa024#13;
     #Ref0001@#48 = #agifa024#12;
     #Ref0001@#49 = #agifa024#27;
     #Ref0001@#50 = #agifa024#186;
     #Ref0001@#51 = #agifa024#197;
|FPRC;

|PROCESO RecogeDatosPro;
     #Ref0001@#10 = #agifa112#10;
     #Ref0001@#1  = #agifa112#1;
     #Ref0001@#2  = #agifa112#3;
     #Ref0001@#3  = #agifa112#74;
     #Ref0001@#4  = #agifa112#75;
     #Ref0001@#5  = #agifa112#5;
     #Ref0001@#6  = #agifa112#4;
     #Ref0001@#7  = #agifa112#6;
     #Ref0001@#8  = #agifa112#7;
     #Ref0001@#9  = #agifa112#9;
     #Ref0001@#13 = #agifa112#11;
     #Ref0001@#14 = #agifa112#16;
     #Ref0001@#17 = #agifa112#12;
     #Ref0001@#19 = #agifa112#57;
     #Ref0001@#20 = #agifa112#17;
     #Ref0001@#24 = #agifa112#89;
     #Ref0001@#25 = #agifa112#76;
     #Ref0001@#28 = #agifa112#98;
     #Ref0001@#29 = #agifa112#14;
     #Ref0001@#30 = #agifa112#15;
     #Ref0001@#31 = #agifa112#13;
     #Ref0001@#32 = #agifa112#12;
     #Ref0001@#33 = #agifa112#92;
     #Ref0001@#34 = #agifa112#19;
     #Ref0001@#35 = #agifa112#20;
     #Ref0001@#36 = #agifa112#21;
     #Ref0001@#37 = #agifa112#99;
     #Ref0001@#38 = #agifa112#94;
     #Ref0001@#39 = #agifa112#95;
     #Ref0001@#40 = #agifa112#96;
     #Ref0001@#41 = #agifa112#97;
     #Ref0001@#44 = #agifa112#101;
     #Ref0001@#45 = #agifa112#102;
     #Ref0001@#46 = #agifa112#103;
     #Ref0001@#47 = #agifa112#104;
     #Ref0001@#48 = #agifa112#105;
     #Ref0001@#49 = #agifa112#106;
     #Ref0001@#50 = #agifa112#107;
|FPRC;

|PROCESO canempre;
     aFic = aPathConta + "fich/" + (("00000" + nEmpr) % -105) + #Ref0002@#3 + "/";

     aMas = aPathConta + "def/camandia.mas";
     |CARGA_DEF aMas, Ref0001@;

     nOk = 1;

     |PATH_DAT #Ref0001@#aFic#;
     |ABRE #Ref0001@;
     #Ref0001@#0 = 99;
     |LEE 000#Ref0001@.=;
     |SI FSalida = 0;  |Y #Ref0001@#2 ! 0;  |Y #Ref0001@#3 ! 0;
         nOk = 0;
     |FINSI;
     |CIERRA #Ref0001@;
     |DESCARGA_DEF #Ref0001@;

     |SI nOk = 0;
         |ACABA;
     |FINSI;

     aMas = aPathConta + "def/caclipro.mas";
     |CARGA_DEF aMas, Ref0001@;

     |PATH_DAT #Ref0001@#aFic#;
     |ABRE #Ref0001@;
     #Ref0001@#23 = eaTipo;
     #Ref0001@#10 = eaCtaCble;
     |LEE 000#Ref0001@.=;
     |SI FSalida ! 0;
         |DDEFECTO #Ref0001@;
         #Ref0001@#23 = eaTipo;
         #Ref0001@#10 = eaCtaCble;

         |GRABA 020#Ref0001@.b;
     |FINSI;

     |SI eaTipo = "C";  |HAZ RecogeDatosCli;  |FINSI;
     |SI eaTipo = "P";  |HAZ RecogeDatosPro;  |FINSI;

     |GRABA 020#Ref0001@.a;
     |LIBERA #Ref0001@;

     aNombre = #Ref0001@#1;

     |CIERRA #Ref0001@;
     |DESCARGA_DEF #Ref0001@;

     aMas = aPathConta + "def/cacuenta.mas";
     |CARGA_DEF aMas, Ref0001@;

     |PATH_DAT #Ref0001@#aFic#;
     |ABRE #Ref0001@;
     #Ref0001@#0  = eaCtaCble;
     |LEE 000#Ref0001@.=;
     |SI FSalida ! 0;
         |DDEFECTO #Ref0001@;
         #Ref0001@#0  = eaCtaCble;
         #Ref0001@#3  = "S";
         #Ref0001@#4  = 0;
         #Ref0001@#7  = 0;
         #Ref0001@#8  = 0;

         |SI eaTipo = "C";
             #Ref0001@#5 = "A";
             #Ref0001@#6 = 2;
         |FINSI;

         |SI eaTipo = "P";
             #Ref0001@#5 = "P";
             #Ref0001@#6 = 3;
         |FINSI;

         |GRABA 020#Ref0001@.b;
     |FINSI;

     #Ref0001@#2  = aNombre;
     |GRABA 020#Ref0001@.a;
     |LIBERA #Ref0001@;

     |CIERRA #Ref0001@;
     |DESCARGA_DEF #Ref0001@;
|FPRC;

|DEFBUCLE canempre;
     #Ref0002@#1002;
     ;
     nEmpr, 0;
     nEmpr, 9;
     ;
     NULL, canempre;
|FIN;

|PROCESO CreaCliProv;
     |HAZ CargaContagen;

     |SI enOk = 0;
         |ACABA;
     |FINSI;

     aMas = aPathConta + "def/canempre.mas";
     |CARGA_DEF aMas, Ref0002@;
     aFic = aPathConta + "fich/";
     |PATH_DAT #Ref0002@#aFic#;

     |BUCLE canempre;

     |DESCARGA_DEF #Ref0002@;
|FPRC;

|PROCESO BorraCliProv;
     enError = 0;

     |ABRE #agifa065;
     |SELECT #3#agifa065;
     #agifa065#10 = eaCod;
     #agifa065#1 = "01.01.0000";
     |LEE 000#agifa065.];
     |SI FSalida = 0; |Y #agifa065#10 = eaCod;
         enError = 1;
     |FINSI;
     |CIERRA #agifa065;

     |SI enError = 1;  |ACABA;  |FINSI;

     |HAZ CargaContagen;

     |SI enOk = 0;
         |ACABA;
     |FINSI;

     enOk = 1;

     aMas = aPathConta + "def/camaasil.mas";
     |CARGA_DEF aMas, Ref0001@;

     |PATH_DAT #Ref0001@#aFic#;

     |ABRE #Ref0001@;
     |SELECT #3#Ref0001@;
     #Ref0001@#4 = eaCtaCble;
     #Ref0001@#5 = 0;
     #Ref0001@#0 = 0;
     #Ref0001@#1 = "01.01.0000";
     #Ref0001@#2 = 0;
     |LEE 000#Ref0001@.];
     |SI FSalida = 0;  |Y #Ref0001@#4 = eaCtaCble;
         enError = 1;
     |FINSI;
     |CIERRA #Ref0001@;
     |DESCARGA_DEF #Ref0001@;

     |SI enError = 1;  |ACABA;  |FINSI;

     aMas = aPathConta + "def/caclipro.mas";
     |CARGA_DEF aMas, Ref0001@;

     |PATH_DAT #Ref0001@#aFic#;
     |ABRE #Ref0001@;
     #Ref0001@#23 = eaTipo;
     #Ref0001@#10 = eaCtaCble;
     |LEE 000#Ref0001@.=;
     |SI FSalida = 0;
         |BORRA 020#Ref0001@.a;
         |LIBERA #Ref0001@;
     |FINSI;

     |CIERRA #Ref0001@;
     |DESCARGA_DEF #Ref0001@;

     aMas = aPathConta + "def/cacuenta.mas";
     |CARGA_DEF aMas, Ref0001@;

     |PATH_DAT #Ref0001@#aFic#;
     |ABRE #Ref0001@;
     #Ref0001@#0  = eaCtaCble;
     |LEE 000#Ref0001@.=;
     |SI FSalida = 0;
         |BORRA 020#Ref0001@.a;
         |LIBERA #Ref0001@;
     |FINSI;

     |CIERRA #Ref0001@;
     |DESCARGA_DEF #Ref0001@;
|FPRC;

|PROCESO MiraLiquidada;
     |HAZ CargaContagen;

     |SI enOk = 0;
         |ACABA;
     |FINSI;

     aMas = aPathConta + "def/canempre.mas";
     |CARGA_DEF aMas, Ref0001@;
     |SI FSalida ! 0;
         |ACABA;
     |FINSI;

     aFic = aPathConta + "fich/";
     |PATH_DAT #Ref0001@#aFic#;

     |ABRE #Ref0001@;
     |SELECT #4#Ref0001@;
     #Ref0001@#2  = nEmpr;
     #Ref0001@#26 = eaAny;
     |LEE 000#Ref0001@.=;
     |SI FSalida = 0;
         nPer = #Ref0001@#3;
     |FINSI;
     |CIERRA #Ref0001@;
     |DESCARGA_DEF #Ref0001@;

     aFic = aPathConta + "fich/" + (("00000" + nEmpr) % -105) + nPer + "/";

     aMas = aPathConta + "def/camaniva.mas";
     |CARGA_DEF aMas, Ref0001@;
     |SI FSalida ! 0;
         |ACABA;
     |FINSI;

     |PATH_DAT #Ref0001@#aFic#;
     |ABRE #Ref0001@;  |SELECT #3#Ref0001@;
     |PARA nLib = 0;  |SI nLib [ 99;  |HACIENDO nLib = nLib + 1;
           #Ref0001@#0 = nLib;
           #Ref0001@#2 = eaSer;
           #Ref0001@#3 = enFac;
           |LEE 000#Ref0001@.=;
           |SI FSalida = 0;  |Y #Ref0001@#36 = eaTip;
               |SI #Ref0001@#40 ! 0;
                   enLiq = 1;
               |FINSI;

               |SAL;
           |FINSI;
     |SIGUE;
     |CIERRA #Ref0001@;
     |DESCARGA_DEF #Ref0001@;

     aMas = aPathConta + "def/camaasic.mas";
     |CARGA_DEF aMas, Ref0001@;
     |SI FSalida ! 0;
         |ACABA;
     |FINSI;

     |PATH_DAT #Ref0001@#aFic#;
     |ABRE #Ref0001@;
     #Ref0001@#0 = 99;
     #Ref0001@#1 = "01.01.0000";
     #Ref0001@#2 = 0;
     |LEE 000#Ref0001@.];
     |SI FSalida = 0; |Y #Ref0001@#0 = 99;
         enCer = 1;
     |FINSI;
     |CIERRA #Ref0001@;
     |DESCARGA_DEF #Ref0001@;
|FPRC;
