|FICHEROS;
     tagm0052 #0;
     tagm0053 #1;
     tagm0054 #2,MANTE;
     tagmpara #3;
     agifa007 #7;
     agifa017 #17;
     agifa019 #19;
     tagm0021 #21;  || Art. Varios
     tagm0023 #23;  || Configuracion
     agifa024 #24;
     tagw0026 #26;
     tagw0027 #27;  || Tmp usuarios
     tagw0028 #28;  || Tmp Precio
     tagm0030 #30;  || Pedido
     tagm0031 #31;
     tagm0032 #32;
     tagm0037 #37;  || Subfamilia Puerta
     tagm0038 #38;  || Subfamilia Galce
     tagm0039 #39;
     tagm0040 #40;
     tagm0041 #41;
     tagm0042 #42;
     tagm0043 #43;
     tagm0044 #44;
     tagm0045 #45;
     tagm0046 #46;
     tagm0047 #47;       || Tipo Galce
     tagm0050 #50,MANTE; || Aux Pernio
     tagm0080 #80;
     agifa142 #142;
     dsm00238 #238;
     referen@;
     agifa104 #104;
|FIN;

|VARIABLES;
     &eaNonDni = "";
     &eaDomiDni = "";
     &eaCPDni = "";
     &eaPobDni = "";
     &eaPrvDni = "";
     &eaTlfDni = "";
     &eaFacDni = "";
     &eaPaisDni = "";
     &eaVarDni  = "";
     &enCalcCif = 0;
     aNifQbf1 = "";
     aNifQbf2 = "";

     &eaTag = "";
     &nImpo = 0;
     &eaFP = "";
     &eaBloquea = "";
     nBtnItemDoc = -1;
     nBtnWorkFlow = -1;
     &ser_ped = "";
     &num_ped = 0;
     &eaSerBlc = "";
     &enNumBlc = 0;
     aFicSql = "";
     aAcesorioAnt = "";
     nTipoPuerta = 0;
     nTipo = 0;
     aTipoGalce = "";
     aGalce = "";
     aHerraje = "";
     aMBlock = "";
     aMCris = "";
     aPuerta = "";
     aDoble = "";
     &enTipo = 0;
     aSerie = "";
     nError = 0;
     nUni2 = 0;
     nSwPuerta = 0;
     aGuarda = "";
     &eaTipoSub = "";
     &enSwPendiente = 0;
     nLin = 0;
     aPtec = "";
     nPtec = 0;
     nPrecio = 0;
     nUni = 0;
     nForma = 0;
     aArt = "";
     &eaApertura = "";
     &eaCodigo = "";
     nHandle = 0;
     nSwAccesorio = 0;
     aNumCam = "";
     nGrueso = 0;
     nModoLin = 0;
     nConsulta = 0;
     &enSwImp = 0;
     &enUniTagRes = 0;
     nSal = 0;
     aSql = "";
     aSql1 = "";
     aBlock = "";
     nCampo = 0;
     nTecla = 0;
     i = 0;
     aAlfa = "";
     aDef = "";
     aDArt = "";
     aHArt = "";
     aSer = "";
     nModoCab = 0;
     nModo = 0;
     nConta = 0;
     aDSub = "";
     aHSub = "";
     {-1}aMenu = "";
     aMenu1 = "2400";
     aMenu2 = "1";
     aMenu3 = " ";
     aMenu4 = "AIC";
     aMenu5 = " Accesorios ";
     aMenu6 = " Imprimir Documento ";
     aMenu7 = " Crear Pedido ";
|FIN;

|INCLUYE i_varart;

|PROCESO Tipo8; |TIPO 8;
     |ABRE #23; |LEE 000#23p; |CIERRA #23;
     |ABRE #142; |LEE 000#142p; |CIERRA #142;
     |ABRE #3; |LEE 000#3p; |CIERRA #3;
     |CONTROL_SIMPLE 0, "BOTON, ItemDoc", 0570, 0579, BtnItemDoc;
     nBtnItemDoc = FSalida;
     |CONTROL_SIMPLE 0, "BOTON, WorkFlow", 0470, 0479, BtnWorkFlow;
     nBtnWorkFlow = FSalida;
|FPRC;

|PROCESO Tipo9; |TIPO 9;
     |SI nBtnItemDoc ! -1; |FIN_CONTROL_WINDOWS nBtnItemDoc; |FINSI;
     |SI nBtnItemDoc ! -1; |FIN_CONTROL_WINDOWS nBtnWorkFlow; |FINSI;
|FPRC;

|PROCESO BtnItemDoc;
     aAlfa = "tagz0025;PR" + #0#0 + #0#1;
     |SUB_EJECUTA_NP aAlfa;
|FPRC;

|PROCESO BtnWorkFlow;
     aAlfa = "tagz0025;WPR" + #0#0 + #0#1;
     |SUB_EJECUTA_NP aAlfa;
|FPRC;

|PROCESO Conta; |TIPO 7;
     nModoCab = (FEntrada / 100) ! 0;
     |SI nModoCab = 1;
          aSer = #0#0;
          #0#1 = 999999;
          |LEE 000#0];
          |SI FSalida = 0;
               |LEE 000#0a;
          |SINO;
               |LEE 000#0u;
          |FINSI;
          |SI FSalida = 0; |Y #0#0 = aSer;
               nConta = #0#1 + 1;
          |SINO;
               nConta = 1;
          |FINSI;
          |DDEFECTO #0;
          #0#0 = aSer;
          #0#1 = nConta;
     |FINSI;
|FPRC;

|PROCESO Mini;
     #2#0 = #0#0;
     #2#1 = #0#1;
     #2#2 = 1;
|FPRC;

|PROCESO Maxi;
     #2#0 = #0#0;
     #2#1 = #0#1;
     #2#2 = 999;
|FPRC;

|PROCESO Imposible;
     nTipo = 0;
     aTipoGalce = #1#6; |QBF aTipoGalce;
     aGalce = #1#7; |QBF aGalce;
     aHerraje = #1#24 + #1#27 + #1#30 + #1#33 + #1#36; |QBF aHerraje;
     aMBlock = #1#43; |QBF aMBlock;
     aMCris = #1#52; |QBF aMCris;
     aPuerta = #1#17; |QBF aPuerta;
     |SI #1#5 = "S";
          |SI aTipoGalce = ""; |Y #1#41 = 0; |Y aGalce = ""; |Y aHerraje = "";
                    |Y aMBlock ! ""; |Y aPuerta ! ""; |Y aMCris ! "";
               nTipo = 1;
          |FINSI;
          aAlfa = aGalce + aHerraje; |QBF aAlfa;
          |SI aTipoGalce ! ""; |Y #1#41 ! 0; |Y aAlfa ! ""; |Y aPuerta ! "";
                    |Y aMCris ! ""; |Y aMBlock = "";
               nTipo = 1;
          |FINSI;
     |SINO;
          |SI aMCris ! ""; |Y aMBlock = "";
               nTipo = 1;
          |FINSI;
          |SI aTipoGalce = ""; |Y #1#41 = 0; |Y aGalce = ""; |Y aHerraje = "";
                    |Y aMBlock = ""; |Y aPuerta ! ""; |Y aMCris ! "";
               nTipo = 1;
          |FINSI;
          |SI aTipoGalce = ""; |Y #1#41 = 0; |Y aGalce = ""; |Y aHerraje = "";
                    |Y aMBlock = ""; |Y aMCris = ""; |Y aPuerta ! "";
               nTipo = 1;
          |FINSI;
     |FINSI;

     |SI nTipo ! 0;
          |MENAV "0000Revisar la configuración del block";
     |FINSI;
|FPRC;

|PROCESO FinBlock; |TIPO 3;
     |HAZ Imposible;
     |SI nModoLin = 1;
          |ABRE #23;
          |LEE 101#23=;
          |SI FSalida ! 0; |GRABA 020#23b; |FINSI;
          aBlock = "BK" + ("00000000000000000000" + #23#6) % -118;
          #23#6 = #23#6 + 1;
          |GRABA 020#23a;
          |CIERRA #23;
          #1#38 = aBlock;
     |FINSI;
     aAlfa = #1#14 + "x" + #1#13 + " ";
     |SI #1#5 = "D";
          aAlfa =  #1#16 + "x" + #1#79 + "x" + #1#80 + " ";
     |FINSI;
     aAlfa = aAlfa + #1#9 + "x" + #1#10;
     |SI #1#22 = "D";
          aAlfa = aAlfa + " Derecha";
     |SINO;
          aAlfa = aAlfa + " Izquierda";
     |FINSI;
     |SI #1#22 = " "; aAlfa = ""; |FINSI;
     #1#39 = aAlfa;
|FPRC;

|PROCESO MiraPuerta;
     |SI #1#5 = "D";
          aDoble = "S";
     |FINSI;
     |SI #1#4 = 2;
          nTipoPuerta = 2;
     |FINSI;
|FPRC;

|PROCESO Termina3; |TIPO 3;
     |SI #0#25 ! 0; |ACABA; |FINSI;
     |SI eaBloquea = "S"; eaBloquea = "N"; |ACABA; |FINSI;

     aDoble = "N";
     nTipoPuerta = 0;
     |BUCLELIN 2MiraPuerta#0;
     |SI aDoble = "S";
          |MENAV "0000INTRODUCIR PILASTRA";
     |FINSI;
     |SI nTipoPuerta = 2;
          |MENAV "0000INTRODUCIR MIRILLA";
     |FINSI;

     |PINPA #0#0;
     |PINDA #0#0;

     |PUSHV 05012380;
     |ENTLINEAL #1#2, 3, 2, 22, 1, Mini, Maxi;
     |POPV;

     |HAZ CalTotal;
     #0#26 = enBruto;
     |PINTA #0#26;

     |CONFI "0000NImprimir Documento";
     |SI FSalida = 0;
          |GRABA 020#0a;
          |LIBERA #0;
          |HAZ Impresion;
     |FINSI;
|FPRC;

|PROCESO Accesorio; |TIPO 20;
     |SI FSalida = "OPCION";
          FSalida = " Opciones";
          |ACABA;
     |FINSI;
     |SELECT #1#0;
     |LEE 000#0=;
     |SI FSalida ! 0; |MENAV "0000No existe Registro"; |ACABA; |FINSI;
     |MENU aMenu;
     aMenu2 = FSalida;
     |SI FSalida = 1;
          |SI #0#25 ! 0;
               |MENAV "0000Block pasado a pedido...";
               |PUSHV 05012380;
               |ENTLINEAL #1#2, 3, 4, 22, 1, Mini, Maxi;
               |POPV;
          |SINO;
               |PUSHV 05012380;
               |ENTLINEAL #1#2, 3, 2, 22, 1, Mini, Maxi;
               |POPV;
               |HAZ CalTotal;
               #0#26 = enBruto;
               |PINTA #0#26;
          |FINSI;
     |FINSI;
     |SI FSalida = 2;
          |HAZ Impresion;
     |FINSI;
     |SI FSalida = 3;
          |SI #0#25 ! 0;
               |MENAV  "0000Block pasado a pedido..";
          |SINO;
               eaSerie = #0#0;
               enCodigo = #0#1;
               eaFP = #0#5;
               |SUB_EJECUTA_NP "tagz0030;ADJ";
               |SI eaBloquea = "S";
                    |MENAV "0000PROFORMA BLOQUEADA PAGO ANTICIPADO";
               |SINO;
                    |HAZ CreaPediBlock;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO CheqVario; |TIPO 7;
     |C_M #1Campo, 0, aAlfa;
     |SI aAlfa = "N"; |ACABA; |FINSI;   || Si no es modificable

     |SI Campo = 7;
          eaTipoSub = "G";
     |SINO;
          eaTipoSub = "P";
     |FINSI;
     eaCliente = #0#3;
     enSwPendiente = 1;
     |HAZ TagCheqPend;
     enSwPendiente = 0;
     eaTipoSub = "";
|FPRC;

|PROCESO LeeCli; |TIPO 0;
     |ABRE #24;
     #24#0 = #0#3;
     |LEE 000#24=;
     |SI FSalida = 0;
          #0#28 = #24#15; |PINTA #0#28;
     |FINSI;
     |CIERRA #24;
|FPRC;

|PROCESO CheqArtVario; |TIPO 0;
     |C_M #1Campo, 0, aAlfa;
     |SI aAlfa = "N"; |ACABA; |FINSI;   || Si no es modificable

     eaCliente = #0#3;
     |HAZ TagCheqPend;
     eaCodigo = #0#3;
     |SUB_EJECUTA_NP "dsz99994";
|FPRC;

|PROCESO Borrtagm0054;
     |BORRA 020#2a;
|FPRC;

|DEFBUCLE Borrtagm0054;
     #2#1;
     ;
     #0#0, #0#1, 001;
     #0#0, #0#1, 999;
     be;
     NULL, Borrtagm0054;
|FIN;

|PROCESO Tipo2Cab; |TIPO 2;
     nModo = (FEntrada / 100) ! 0;
     nForma = 0 +. 1;
     aAlfa = (("00" + #0#21) % -102) + (("000" + #0#22) % -103);
     #0#23 = aAlfa;
     |SI nModo ! 1; |Y #0#25 ! 0 ;
          |SI nForma = -1;
               |MENAV "0000Block pasado a pedido...";
          |FINSI;
          |ERROR; |ACABA;
     |FINSI;
     |SI nModo = 2; |O nModo = 3;
          eaSerie = #0#0;
          enCodigo = #0#1;
          eaFP = #0#5;
          |SUB_EJECUTA_NP "tagz0030";
          |SI eaBloquea = "S";
               |SI nForma = -1;
                    |MENAV "0000PROFORMA BLOQUEADA PAGO ANTICIPADO";
               |FINSI;
               |ERROR; |ACABA;
          |FINSI;
     |FINSI;
     |SI nModo = 3;
          |BUCLE Borrtagm0054;
     |FINSI;
|FPRC;

|PROCESO Tipo2Lin; |TIPO 2;
     nForma = 0 +. 1;
     |HAZ ChequeaVario;
|FPRC;

|PROCESO Imprime;
     |PRINT;
|FPRC;

|PROCESO Accesorios;
     |SI enSwImp = 1;
          enSwImp = 2; |PRINT;
          enSwImp = 3;
     |FINSI;
     |PRINT;
|FPRC;

|DEFBUCLE Accesorios;
     #32#1;
     ;
     #0#0, #0#1, 001;
     #0#0, #0#1, 999;
     ;
     NULL, Accesorios;
|FIN;

|PROCESO ConvLins;
   |DDEFECTO #tagm0031;
   |PARA i = 0; |SI i [ 94; |HACIENDO i = i + 1;
      #tagm0031#i# = #tagm0053#i#;
   |SIGUE;
   |GRABA 020#tagm0031.n;
|FPRC;

|DEFBUCLE ConvLins;
#tagm0053#1;
;
#tagm0052#0, #tagm0052#1, 001;
#tagm0052#0, #tagm0052#1, 999;
;
NULL,ConvLins;
|FIN;

|PROCESO ConvAcces;
   |DDEFECTO #tagm0032;
   |PARA i = 0; |SI i [ 12; |HACIENDO i = i + 1;
      #tagm0032#i# = #tagm0054#i#;
   |SIGUE;
   |GRABA 020#tagm0032.n;
|FPRC;

|DEFBUCLE ConvAcces;
#tagm0054#1;
;
#tagm0052#0, #tagm0052#1, 001;
#tagm0052#0, #tagm0052#1, 999;
;
NULL,ConvAcces;
|FIN;

|PROCESO Impresion;
     enSwImp = 0;
     enTipo = 2;  || Presupuesto
     |IMPRE 0;
     |SI FSalida = 0;
          aAlfa = "T1" + Usuario; |NOME_DAT #tagm0030#aAlfa#;
          aAlfa = "T2" + Usuario; |NOME_DAT #tagm0031#aAlfa#;
          aAlfa = "T3" + Usuario; |NOME_DAT #tagm0032#aAlfa#;
          |DELINDEX #tagm0030; |ABRE #tagm0030;
          |DELINDEX #tagm0031; |ABRE #tagm0031;
          |DELINDEX #tagm0032; |ABRE #tagm0032;

          |DDEFECTO #tagm0030;
          |PARA i = 0; |SI i [ 23; |HACIENDO i = i + 1;
             #tagm0030#i# = #tagm0052#i#;
          |SIGUE;
          #tagm0030#29# = #tagm0052#26#; ||total
          |GRABA 020#tagm0030.n;
          |BUCLE ConvLins;
          |BUCLE ConvAcces;

          |INFOR "tagm0030";
          |SI FSalida = 0;
               enSwImp = 1;
               |BUCLELIN 0 Imprime #30;
               |BUCLE Accesorios;
               |PIEINF;
               |FININF;
          |SINO;
               |MENAV "0000No existe informe 'tagm0030'";
          |FINSI;
          |FINIMP;

          |CIERRA #tagm0030;  |DELINDEX #tagm0030;
          |CIERRA #tagm0031;  |DELINDEX #tagm0031;
          |CIERRA #tagm0032;  |DELINDEX #tagm0032;

          aAlfa = "tagm0030"; |NOME_DAT #tagm0030#aAlfa#;
          aAlfa = "tagm0031"; |NOME_DAT #tagm0031#aAlfa#;
          aAlfa = "tagm0032"; |NOME_DAT #tagm0032#aAlfa#;
     |FINSI;
     |SI enSwImp ! 0;    || Integracion Item doc, realiza tambien impresion
          eaSerBlc = #0#0;
          enNumBlc = #0#1;
          |SUB_EJECUTA_NP "tagz0029";
     |FINSI;
|FPRC;
----------------------------------------------------------------------------
|PROCESO EntraAccesorio; |TIPO 7;
     aAcesorioAnt = #2#3;
|FPRC;

|PROCESO CheqAccesorio6; |TIPO 6;
     nTecla = FSalida;
     nModo = (FEntrada / 100) ! 0;
     |SI nTecla = 13; |Y Campo = 7;          || F5
          nConsulta = 0;
          aNumCam = "A";
          |HAZ ConsultaArtVario;
          nTecla = 0;
          |SI FSalida ! 0; |ERROR; |ACABA; |FINSI;
     |FINSI;
|FPRC;

|PROCESO CheqAccesorio0; |TIPO 0;
     nModo = (FEntrada / 100) ! 0;

     nSwAccesorio = 1;
     aDef = "tagm0039"; ||Accesorio;
     FSalida = nTecla;
     |HAZ CheqArti;
     nSwAccesorio = 0;

     |SI #2#3 ! aAcesorioAnt;
          eaArticulo = #2#3;
          eaCliente = #0#3;
          |HAZ DefectoMediV;
          #2#7 = enMedida1;
          #2#8 = enMedida2;
          #2#9 = enMedida3;
     |FINSI;
|FPRC;

|PROCESO ConsuAccesorio; |TIPO 66;
/*   se cambia por un consulta para acelerar
     nSwAccesorio = 1;
     aDef = "tagm0039"; ||Accesorio
     |HAZ Consulta;
     nSwAccesorio = 0;
*/
     |ABRE #19;
     #19#0 = #2Campo;
     |LEE 000#19];
     |CONSULTA_CLAVE #1#19;
     |SI FSalida = 0;
          nCampo = Campo + 1;
          #2Campo = #19#0;
          #2nCampo = #19#1;
          |PINTA #2Campo;
          |PINTA #2nCampo;
     |SINO;
          |ERROR;
     |FINSI;
     |CIERRA #19;
|FPRC;

|PROCESO ConsuArti; |TIPO 66;
     aDef = "";
     |SI Campo = 7; aDef = "tagm0038"; |FINSI; ||Galce
     |SI Campo = 17; aDef = "tagm0037"; |FINSI; ||Puerta
     |SI Campo = 81; aDef = "tagm0037"; |FINSI; ||Puerta
     |SI Campo = 24; aDef = "tagm0041"; |FINSI; ||Pica
     |SI Campo = 27; aDef = "tagm0040"; |FINSI; ||Pernio
     |SI Campo = 90; aDef = "tagm0040"; |FINSI; ||Pernio
     |SI Campo = 30; aDef = "tagm0042"; |FINSI; ||Cerradura
     |SI Campo = 33; aDef = "tagm0043"; |FINSI; ||Bisagra
     |SI Campo = 36; aDef = "tagm0046"; |FINSI; ||Psasador
     |SI Campo = 43; aDef = "tagm0044"; |FINSI; ||Montaje
     |SI Campo = 52; aDef = "tagm0044"; |FINSI; ||Montaje

     |SI Campo = 1; aDef = "tagm0040"; |FINSI; ||Pernio
     |SI Campo = 4; aDef = "tagm0040"; |FINSI; ||Pernio

     |SI aDef ! ""; |HAZ Consulta; |FINSI;
|FPRC;

|PROCESO Consulta;
     |DFICE aAlfa;
     aFicSql = aAlfa + Usuario;
     |XABRE "WB", aFicSql, nHandle;
     |SI FSalida < 0;
          |MENAV "0000Error al crear el fichero sql";
          |ACABA;
     |FINSI;

     aAlfa = "* FROM agifa019 INTO sq" + Usuario + ".def WHERE ";
     |XGRABA nHandle, aAlfa;

     aSql1 = "";
     |DDEF aAlfa;
     aAlfa = aAlfa + aDef;
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          |LEE 000#referen@.p;
          |PARA; |SI FSalida = 0; |HACIENDO;
               |SI aSql1 = "";
                    aSql1 = "3 == " + #referen@#0;
                    |XGRABA nHandle, aSql1;
               |SINO;
                    aSql1 = " OR 3 == " + #referen@#0;
                    |XGRABA nHandle, aSql1;
               |FINSI;
               |LEE 000#referen@.s;
          |SIGUE;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;

     aSql = "SELECT * FROM agifa019 INTO sq" + Usuario + ".def WHERE ";
     |SI aSql1 = "";
          aSql = "SELECT * FROM agifa019 INTO sq" + Usuario + ".def";
     |SINO;
          aSql = "SELECT @" + aFicSql;
     |FINSI;

     |XCIERRA nHandle;

     |SQL aSql;
     |SI FSalida = 0;
          |DDEF aDef; |QBF aDef;
          aDef = aDef + "sq" + Usuario + ".mas";
          |CARGA_DEF aDef, referen@;
          |SI FSalida = 0;
               |ABRE #referen@;
               |CONSULTA_CLAVE #1#referen@;
               |SI FSalida = 0;
                    nCampo = Campo + 1;
                    |SI nSwAccesorio = 1;
                         #2Campo = #referen@#0;
                         #2nCampo = #referen@#1;
                         |PINTA #2Campo;
                         |PINTA #2nCampo;
                    |SINO;
                         |SI Campo = 1; |O Campo = 4;
                              #50Campo = #referen@#0;
                              #50nCampo = #referen@#1;
                              |PINTA #50Campo;
                              |PINTA #50nCampo;
                         |SINO;
                              #1Campo = #referen@#0;
                              #1nCampo = #referen@#1;
                              |PINTA #1Campo;
                              |PINTA #1nCampo;
                              |SI Campo = 7; || Galce
                                   #1#9 = #referen@#114;
                                   #1#10 = #referen@#115;
                                   #1#11 = #referen@#116;
                              |FINSI;
                              |SI Campo = 17; || Puerta
                                   #1#19 = #referen@#190;
                                   #1#20 = #referen@#189;
                                   #1#21 = #referen@#191;
                              |FINSI;
                         |FINSI;
                    |FINSI;
               |SINO;
                    |ERROR;
               |FINSI;
               |CIERRA #referen@;
               |DELINDEX #referen@;
               |DESCARGA_DEF #referen@;
               |FBORRA aDef;
          |FINSI;
     |FINSI;
     |FBORRA aFicSql;
|FPRC;

|PROCESO tagm0021;
          |SI #21#12 > 0; |O nConsulta = 0;
               #19#0 = #21#2;
               |LEE 000#19=;
               |SI FSalida = 0;
                    |SI aNumCam = "P"; |O aNumCam = 81;
                         #37#0 = #19#3;
                         |LEE 000#37=;  || Sub. Puerta
                    |FINSI;
                    |SI aNumCam = "G"
                         #38#0 = #19#3; || Sub. Galce
                         |LEE 000#38=;
                    |FINSI;
                    |SI aNumCam = "A"
                       ||  #39#0 = #19#3; || Accesorios
                       ||  |LEE 000#39=;
                       FSalida = 0; || No se chequea
                    |FINSI;
                    |SI aNumCam = 27; |O aNumCam = 1; |O aNumCam = 4;
                         #40#0 = #19#3; || Sub. Pernio
                         |LEE 000#40=;
                    |FINSI;
                    |SI aNumCam = 24;
                         #41#0 = #19#3; || Sub. Picaporte
                         |LEE 000#41=;
                    |FINSI;
                    |SI aNumCam = 30;
                         #42#0 = #19#3; || Sub. Cerradura
                         |LEE 000#42=;
                    |FINSI;
                    |SI aNumCam = 33;
                         #43#0 = #19#3; || Sub. Bisagra
                         |LEE 000#43=;
                    |FINSI;
                    |SI aNumCam = 43;
                         #44#0 = #19#3; || Sub. Montaje
                         |LEE 000#44=;
                    |FINSI;
                    |SI aNumCam = 36;
                         #46#0 = #19#3; || Sub. Pasador
                         |LEE 000#46=;
                    |FINSI;
                    |SI aNumCam = 52;
                         #44#0 = #19#3; || Sub. MOntaje Cristal
                         |LEE 000#44=;
                    |FINSI;
                    |SI FSalida = 0;
                         |SALVA_DATOS #21;
                         |REPON_DATOS #referen@;
                         |GRABA 020#referen@.n;
                    |FINSI;
               |FINSI;
          |FINSI;
|FPRC;

|DEFBUCLE tagm0021;
     #21#1;
     ;
     #0#3, 00001;
     #0#3, 99999;
     ;
     NULL, tagm0021;
|FIN;

|PROCESO ConsultaArtVario;
     nSal = 1;
     |DDEF aDef;
     aDef = aDef + "tagm0021";
     |CARGA_DEF aDef, referen@;
     |SI FSalida = 0;
          aAlfa = Usuario;
          |NOME_DAT #referen@#aAlfa#;
          |DELINDEX #referen@;
          |ABRE #referen@;
          |ABRE #37;
          |ABRE #38;
          |ABRE #39;
          |ABRE #40;
          |ABRE #41;
          |ABRE #42;
          |ABRE #43;
          |ABRE #44;
          |ABRE #45;
          |ABRE #46;
          |ABRE #19;
          |BUCLE tagm0021;
          |CIERRA #19;
          |CIERRA #46;
          |CIERRA #45;
          |CIERRA #44;
          |CIERRA #43;
          |CIERRA #42;
          |CIERRA #41;
          |CIERRA #40;
          |CIERRA #39;
          |CIERRA #38;
          |CIERRA #37;
          |LEE 000#referen@.p;
          |SI nConsulta = 1;
               nSal = FSalida;
          |SINO;
               |CONSULTA_CLAVE #1#referen@;
               |SI FSalida = 0;
                    nSal = 0;
                    |SI aNumCam = "P";
                         #1#17 = #referen@#2; |PINTA #1#17;
                         #1#18 = #referen@#3; |PINTA #1#18;
                         #1#50 = #referen@#7;
                         #1#51 = #referen@#8;

                         #1#19 = #referen@#5;
                         #1#20 = #referen@#4;
                         #1#21 = #referen@#6;
                    |FINSI;
                    |SI aNumCam = "G";
                         #1#7 = #referen@#2; |PINTA #1#7;
                         #1#8 = #referen@#3; |PINTA #1#8;
                         #1#48 = #referen@#7;
                         #1#49 = #referen@#8;
                         |ABRE #19;
                         #19#0 = #1#7;
                         |LEE 000#19=;
                         #1#9 = #19#114;
                         #1#10 = #19#115;
                         #1#11 = #19#116;
                         |CIERRA #19;
                    |FINSI;
                    |SI aNumCam = "A";
                         #2#3 = #referen@#2; |PINTA #2#3;
                         #2#4 = #referen@#3; |PINTA #2#4;
                         #2#10 = #referen@#7;
                         #2#11 = #referen@#8;
                    |FINSI;
                    nCampo = aNumCam;
                    |SI nCampo > 0;
                         |SI nCampo = 24; #1#65 = #referen@#7; #1#66 = #referen@#8; |FINSI;
                         |SI nCampo = 27; #1#67 = #referen@#7; #1#68 = #referen@#8; |FINSI;
                         |SI nCampo = 90; #1#93 = #referen@#7; #1#94 = #referen@#8; |FINSI;
                         |SI nCampo = 30; #1#69 = #referen@#7; #1#70 = #referen@#8; |FINSI;
                         |SI nCampo = 33; #1#71 = #referen@#7; #1#72 = #referen@#8; |FINSI;
                         |SI nCampo = 36; #1#73 = #referen@#7; #1#74 = #referen@#8; |FINSI;
                         |SI nCampo = 43; #1#75 = #referen@#7; #1#76 = #referen@#8; |FINSI;
                         |SI nCampo = 52; #1#77 = #referen@#7; #1#78 = #referen@#8; |FINSI;
                         |SI nCampo = 81;
                              #1#83 = #referen@#7; #1#84 = #referen@#8;
                              #1#85 = #referen@#5;
                              #1#86 = #referen@#4;
                              #1#87 = #referen@#6;
                         |FINSI;
                         |SI Campo = 1; |O Campo = 4;
                              |SI nCampo = 1; #1#67 = #referen@#7; #1#68 = #referen@#8; |FINSI;
                              |SI nCampo = 4; #1#93 = #referen@#7; #1#94 = #referen@#8; |FINSI;
                              #50nCampo = #referen@#2; |PINTA #50nCampo;
                              nCampo = nCampo + 1;
                              #50nCampo = #referen@#3; |PINTA #50nCampo;
                         |SINO;
                              #1nCampo = #referen@#2; |PINTA #1nCampo;
                              nCampo = nCampo + 1;
                              #1nCampo = #referen@#3; |PINTA #1nCampo;
                         |FINSI;
                         |SI nCampo = 7;
                         |FINSI;
                    |FINSI;
               |FINSI;
          |FINSI;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
     FSalida = nSal;
|FPRC;

|PROCESO EntraPuerta; |TIPO 7;
     |C_M #1Campo, 0, aAlfa;
     |SI aAlfa = "N"; |ACABA; |FINSI;   || Si no es modificable

     nConsulta = 1;
     aNumCam = "P";
     |HAZ ConsultaArtVario;
     |SI FSalida = 0;
          |MENAV "0000Cliente con articulos puertas";
     |FINSI;
     |HAZ PintaMedi;
|FPRC;

|PROCESO CheqArti; |TIPO 0;
     nModo = (FEntrada / 100) ! 0;
     nTecla = FSalida;

     |SI Campo = 7; |O Campo = 17; |O Campo = 81;
          |BLIN 24; || ...de PintaMedi
     |FINSI;

     |C_M #1Campo, 0, aAlfa;
     |SI aAlfa = "N"; |ACABA; |FINSI;   || Si no es modificable

     |SI nSwAccesorio = 0;
          |SI nTecla = 13; |Y Campo = 17;         || F5
               nConsulta = 0;
               aNumCam = "P";
               |HAZ ConsultaArtVario;
               |SI FSalida ! 0;
                    |ERROR; |ACABA;
               |FINSI;
          |FINSI;
          |SI nTecla = 13; |Y Campo = 7;          || F5
               nConsulta = 0;
               aNumCam = "G";
               |HAZ ConsultaArtVario;
               |SI FSalida ! 0; |ERROR; |ACABA; |FINSI;
          |FINSI;
          |SI nTecla = 13;                        || F5
               |SI Campo = 24; |O Campo = 27; |O Campo = 30;
                         |O Campo = 33; |O Campo = 36; |O Campo = 43;
                         |O Campo = 52; |O Campo = 81; |O Campo = 90;
                    nConsulta = 0;
                    aNumCam = Campo;
                    |HAZ ConsultaArtVario;
                    |SI FSalida ! 0; |ERROR; |ACABA; |FINSI;
               |FINSI;
          |FINSI;

          ||SI #1Campo ! Contenido; |O nModo = 1;
          |SI #1Campo ! Contenido;
               |DDEFECTO #19;
               |ABRE #19;
               #19#0 = #1Campo;
               |LEE 000#19=;
               |CIERRA #19;
               nCampo = Campo + 1;
               #1nCampo = #19#1; |PINTA #1nCampo;
               |SI Campo = 81; || Como no es posible mas relaciones..
                    |SI #1#5 = "D";
                         #1#85 = #19#190;
                         #1#86 = #19#189;
                         #1#87 = #19#191;
                    |SINO;
                         #1#81 = ""; #1#82 = "";
                         |PINTA #1#81; |PINTA #1#82;
                    |FINSI;
               |FINSI;

               |HAZ PintaMedi;
               |HAZ PrecioCli;
          |FINSI;
          |SI nTecla = 15;         || F7
               |SI Campo = 17; |O Campo = 81;
                    |HAZ MedidaPuerta;
               |FINSI;
               |SI Campo = 7;
                    |HAZ MedidaGalce;
               |FINSI;
          |FINSI;
     |SINO;              ||Los Varios
          |SI nTecla = 13;
               nConsulta = 0;
               aNumCam = "A";
               |HAZ ConsultaArtVario;
               |SI FSalida ! 0; |ERROR; |ACABA; |FINSI;
               |HAZ PrecioCli;
          |SINO;
               |SI #2Campo ! aAcesorioAnt;
                    |HAZ PrecioCli;
               |FINSI;
          |FINSI;
     |FINSI;

     |SI nTecla = 14;                        || F6
          |SI Campo ! 43; |Y Campo ! 52;
               |HAZ MuestraPrecio;
               |ERROR;
               |ACABA;
          |FINSI;
     |FINSI;
     ||--------------Chequeo
     aAlfa = #1Campo; |QBF aAlfa;
     |SI aAlfa ! ""; |O nSwAccesorio = 1;
          |ABRE #19;
          |SI nSwAccesorio = 1;
               #19#0 = #2Campo;
          |SINO;
               #19#0 = #1Campo;
          |FINSI;
          |LEE 000#19=;
          |CIERRA #19;
          |SI Campo = 7;  aDef = "tagm0038"; |FINSI; ||Galce
          |SI Campo = 17; aDef = "tagm0037"; |FINSI; ||Puerta
          |SI Campo = 81; aDef = "tagm0037"; |FINSI; ||Puerta
          |SI Campo = 24; aDef = "tagm0041"; |FINSI; ||Pica
          |SI Campo = 27; aDef = "tagm0040"; |FINSI; ||Pernio
          |SI Campo = 90; aDef = "tagm0040"; |FINSI; ||Pernio
          |SI Campo = 30; aDef = "tagm0042"; |FINSI; ||Cerradura
          |SI Campo = 33; aDef = "tagm0043"; |FINSI; ||Bisagra
          |SI Campo = 36; aDef = "tagm0046"; |FINSI; ||Psasador
          |SI Campo = 43; aDef = "tagm0044"; |FINSI; ||Montaje
          |SI Campo = 52; aDef = "tagm0044"; |FINSI; ||Montaje
          |DDEF aAlfa;
          aAlfa = aAlfa + aDef;
          |CARGA_DEF aAlfa, referen@;
          |SI FSalida = 0;
               |ABRE #referen@;
               |LEE 000#referen@.p;
               |SI FSalida ! 0;         || Si no hay ninguno
                    nSal = 0;
               |SINO;
                    #referen@#0 = #19#3;
                    |LEE 000#referen@.=;
                    nSal = FSalida;
               |FINSI;
               |CIERRA #referen@;
               |DESCARGA_DEF #referen@;
          |FINSI;
          |SI nSal ! 0;
               |SI nSwAccesorio ! 0; || Los accesorios cuando es un
                    |ABRE #21;       || articulo de varios no chequea
                    |SELECT #2#21;   || la subfamilia
                    #21#0 = #0#3;
                    #21#2 = #2Campo;
                    |LEE 000#21=;
                    |SI FSalida = 0;
                         |ACABA;
                    |FINSI;
                    |CIERRA #21;
               |FINSI;
               |MENAV "0000Articulo incorrecto...";
               |ERROR; |ACABA;
          |FINSI;
     |FINSI;
     |SI Campo = 7; |Y nSwAccesorio = 0; || Galce
          |ABRE #19;
          #19#0 = #1#7;
          |LEE 121#19=;
          |SI FSalida = 0;
               |SI #19#114 = 0; |O #19#115 = 0; |O #19#116 = 0;
                    |MENAV "0000Alto/Ancho/Rebaje no informado";
                    |PUSHV 05012380;
                    #26#0 = #19#114;
                    #26#1 = #19#115;
                    #26#2 = #19#116;
                    |BLANCO 13152050;
                    |PINPA #0#26;
                    |PINDA #0#26;
                    |ENDATOS #1#26;
                    |SI FSalida = 0;
                         #19#114 = #26#0;
                         #19#115 = #26#1;
                         #19#116 = #26#2;
                         |GRABA 020#19a;
                         #1#9 = #19#114;
                         #1#10 = #19#115;
                         #1#11 = #19#116;
                    |FINSI;
                    |POPV;
               |FINSI;
          |FINSI;
          |CIERRA #19;
          |HAZ CalTiras;
     |FINSI;
     |SI #142#35 ! "N";
          |ABRE #19;
          |SI nSwAccesorio = 1;
               #19#0 = #2Campo;
          |SINO;
               #19#0 = #1Campo;
          |FINSI;
          |LEE 000#19=;
          |CIERRA #19;
          |SI Campo = 7; |O Campo = 17; |O Campo = 81; |O Campo = 24;
                    |O Campo = 27; |O Campo = 30; |O Campo = 33;
                    |O Campo = 36; |O Campo = 3; |O Campo = 90;
               |SI nSwAccesorio = 0;
                    |SI Campo = 7; nUni = #1#3 * #1#40; |FINSI;
                    |SI Campo = 17; nUni = #1#3; |FINSI;
                    |SI Campo = 81; nUni = #1#3; |FINSI;

                    |SI Campo = 24; nUni = #1#3 * #1#23; |FINSI;
                    |SI Campo = 27; nUni = #1#3 * #1#26; ; |FINSI;
                    |SI Campo = 90; nUni = #1#3 * #1#26; ; |FINSI;
                    |SI Campo = 30; nUni = #1#3 * #1#29; |FINSI;
                    |SI Campo = 33; nUni = #1#3 * #1#32; |FINSI;
                    |SI Campo = 36; nUni = #1#3 * #1#35; |FINSI;
               |SINO;
                    nUni = #2#5;
               |FINSI;
               |SI #19#104 < nUni;
                    |SI #19#179 = "S"; |Y nSwAccesorio = 1;
                         || si es doble stock y es accesorio
                         || el chequeo se hace en la ventana de las unidades
                    |SINO;
                         aAlfa = "0000" + #19#0 + ". Se supera el Stock Disponible: " + #19#104;
                         |MENAV aAlfa;
                         |SI #142#35 = "X"; |ERROR; |ACABA; |FINSI;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;

     |SI nSwAccesorio = 0; |Y Campo ! 43; |Y Campo ! 52;
          |HAZ MuestraPrecio;
     |FINSI;
     |SI nSwAccesorio = 1;
          |HAZ MuestraPrecio;
     |FINSI;
|FPRC;

|PROCESO CalPuerta; |TIPO 0;
     |HAZ MediCli;
|FPRC;

|PROCESO MediCli; |TIPO 0;
     |SI #1Campo = Contenido;
          |ACABA;
     |FINSI;

     |ABRE #47;
     #47#0 = #1#6;
     |LEE 000#47=;
     |CIERRA #47;
     |SI #1#12 = "L";
          #1#16 = #1#14 - (#47#2 + (#23#1 + #23#2 + #23#3));
          #1#15 = #1#13 - (2 * #47#2 + (#23#1 + #23#2));
     |FINSI;
     |SI #1#12 = "B";
          #1#16 = #1#14 - (#47#2 + (#23#2 + #23#3));
          #1#15 = #1#13 - (2 * #47#2 + (#23#4));
     |FINSI;
     |SI #1#12 = "P";
          #1#16 = #1#14;
          #1#15 = #1#13;
     |FINSI;
     |SI #1#5 = "D";
          #1#79 = #1#15 / 2;
          #1#80 = #1#15 / 2 ;
     |SINO;
          #1#79 = 0;
          #1#80 = 0;
     |FINSI;
     |PINTA #1#16;
     |PINTA #1#15;
     |PINTA #1#79;
     |PINTA #1#80;
|FPRC;

|PROCESO MedPuerta2; |TIPO 0;
     |SI #1Campo ! Contenido;
          |SI #1#5 = "D";
               #1#79 = #1#15 / 2;
               #1#80 = #1#15 / 2 ;
          |SINO;
               #1#79 = 0;
               #1#80 = 0;
          |FINSI;
          |PINTA #1#79;
          |PINTA #1#80;
     |FINSI;
|FPRC;

|PROCESO TipoPuerta; |TIPO 0;
     nModo = (FEntrada / 100) ! 0;
     |PARA i = 23; |SI i [ 34; |HACIENDO i = i + 1;
          |C_M #1i, 1, "N";
     |SIGUE;
     |C_M #1#90, 1, "N";
     |SI #1#4 = 1;
          |C_M #1#23, 1, "S";
          |C_M #1#24, 1, "S";
          |C_M #1#26, 1, "S";
          |C_M #1#27, 1, "S";
          |C_M #1#90, 1, "S";
          ||SI Campo ! Contenido; |O nModo = 1;
          |SI Campo ! Contenido;
               #1#23 = 1; |PINTA #1#23;
               #1#32 = 0; |PINTA #1#32;
               #1#29 = ""; |PINTA #1#29;
               #1#30 = ""; |PINTA #1#30;
               #1#31 = ""; |PINTA #1#31;
               #1#32 = ""; |PINTA #1#32;
               #1#33 = ""; |PINTA #1#33;
               #1#34 = ""; |PINTA #1#34;
          |FINSI;
     |SINO;
          |C_M #1#29, 1, "S";
          |C_M #1#30, 1, "S";
          |C_M #1#32, 1, "S";
          |C_M #1#33, 1, "S";
          ||SI Campo ! Contenido; |O nModo = 1;
          |SI Campo ! Contenido;
               #1#29 = 1; |PINTA #1#29;
               #1#32 = 4; |PINTA #1#32;
               #1#23 = ""; |PINTA #1#23;
               #1#24 = ""; |PINTA #1#24;
               #1#25 = ""; |PINTA #1#25;
               #1#26 = ""; |PINTA #1#26;
               #1#27 = ""; |PINTA #1#27;
               #1#90 = ""; |PINTA #1#90;
               #1#28 = ""; |PINTA #1#28;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO MaxPernio; |TIPO 0;
     |SI #1#4 = 1; |Y #1#26 > 4;
          |MENAV "0000Supera el Maximo de 4 unidades";
          |ERROR;
     |FINSI;
|FPRC;

|PROCESO TipoGalce; |TIPO 7;
     |SI FSalida ! 0; |ACABA; |FINSI;
     |ABRE #47;
     #47#0 = #1#6;
     |LEE 000#47];
     |CONSULTA_CLAVE #1#47;
     |SI FSalida = 0;
          #1#6 = #47#0;
          |PINTA #1#6;
     |SINO;
          |ERROR;
     |FINSI;
     |CIERRA #47;
|FPRC;

|PROCESO PintaMedi; |TIPO 7;
     |SI Campo = 7;
          aAlfa = "0000<F5> Pendientes. <F6> Precio. <F7> Medidas.";
          |MENSA aAlfa;
          aAlfa = "GALCE  Alto:" + #1#9 + " Ancho:" + #1#10 + " Rebaje:" + #1#11;
     |FINSI;
     |SI Campo = 17;
          aAlfa = "0000<F5>Pendientes. <F6>Precio. <F7>Medidas."
          |MENSA aAlfa;
          aAlfa = "PUERTA  Alto:" + #1#20 + " Ancho:" + #1#19 + " Grueso:" + #1#21;
     |FINSI;
     |SI Campo = 81;
          aAlfa = "0000<F5>Pendientes. <F6>Precio. <F7>Medidas."
          |MENSA aAlfa;
          aAlfa = "PUERTA2  Alto:" + #1#86 + " Ancho:" + #1#85 + " Grueso:" + #1#87;
     |FINSI;
     |ATRI I; |PINTA 2406, aAlfa; |ATRI 0;
|FPRC;

|PROCESO Min31;
     #referen@#0 = #0#0;
     #referen@#1 = #0#1;
     #referen@#2 = 1;
|FPRC;

|PROCESO Max31;
     #referen@#0 = #0#0;
     #referen@#1 = #0#1;
     #referen@#2 = 999;
|FPRC;

|PROCESO Linea66; |TIPO 66;
     nLin = 0;
     |DDEF aAlfa;
     aAlfa = aAlfa + "tagm0031";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          |CONSULTA_F_CLAVE #1#referen@, Min31, Max31;
          |SI FSalida = 0; nLin = #referen@#2; |FINSI;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
     |SI nLin ! 0;
          |PTEC 802;
          aAlfa = ("000" + nLin) % -103;
          aPtec = aAlfa % 301; nPtec = &aPtec;
          |PTEC nPtec;
          aPtec = aAlfa % 201; nPtec = &aPtec;
          |PTEC nPtec;
          aPtec = aAlfa % 101; nPtec = &aPtec;
          |PTEC nPtec;
     |FINSI;
|FPRC;

|PROCESO Linea11; |TIPO 11;
     |SI FSalida = 9;
          |PUSHV 0501 2380;
          |PINPA #0#0;
          |PINDA #0#0;
          |PAUSA;
          |POPV;
          |ERROR;
     |FINSI;
|FPRC;

|PROCESO Linea0; |TIPO 0;
     nModoLin = (FEntrada / 100) ! 0;
|FPRC;

|PROCESO Unidades0; |TIPO 0;
     |SI #1Campo ! Contenido;
          #1#41 = #1#3 * #1#40; |PINTA #1#41;
     |FINSI;
|FPRC;

|PROCESO CalTiras; |TIPO 0;
     |DDEFECTO #19;
     |ABRE #19;
     #19#0 = #1#7;
     |LEE 000#19=;
     |CIERRA #19;

     #1#42 = #1#3 * #1#40 * #19#189;
     |PINTA #1#42;

     |HAZ Unidades0;
|FPRC;

|PROCESO UsuarioDefecto; |TIPO 7;
     #0#9 = Usuario % 810;
|FPRC;

|PROCESO CalAccesorio; |TIPO 0;
     |SI #2Campo = Contenido; |ACABA; |FINSI;
     |DDEFECTO #19;
     |ABRE #19;
     #19#0 = #2#3;
     |LEE 000#19=;
     |CIERRA #19;

     |SI #142#35 = "S"; |O #142#35 = "X";
          |SI #19#104 < #2#5;
               |AVISO;
               aAlfa = "0000Se supera el Stock Disponible: " + #19#104;
               |MENAV aAlfa;
               |SI #142#35 = "X"; |ERROR; |ACABA; |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO CodMoBlock; |TIPO 6;
     |SI #1Campo = Contenido; |ACABA; |FINSI;
     |ABRE #24;
     #24#0 = #0#3;
     |LEE 000#24=;
     |CIERRA #24;
     |ABRE #19;
     #19#0 = #1#43;
     |LEE 000#19=;
     |CIERRA #19;
     #1#44 = #19#1;
     |PINTA #1#44;
     |SI #24#39 = 1; #1#45 = #19#18; #1#46 = #19#21;|FINSI;
     |SI #24#39 = 2; #1#45 = #19#19; #1#46 = #19#22;|FINSI;
     |SI #24#39 = 3; #1#45 = #19#20; #1#46 = #19#23; |FINSI;
     |SI #24#39 = 4; #1#45 = #19#147; #1#46 = #19#150; |FINSI;
     |SI #24#39 = 5; #1#45 = #19#148; #1#46 = #19#151; |FINSI;
     |SI #24#39 = 6; #1#45 = #19#149; #1#46 = #19#152; |FINSI;
     |PINTA #1#45;
     |PINTA #1#46;
|FPRC;

|PROCESO CodMoCris; |TIPO 6;
     |SI #1Campo = Contenido; |ACABA; |FINSI;
     |ABRE #24;
     #24#0 = #0#3;
     |LEE 000#24=;
     |CIERRA #24;
     |ABRE #19;
     #19#0 = #1#52;
     |LEE 000#19=;
     |CIERRA #19;
     #1#53 = #19#1;
     |PINTA #1#53;
     |SI #24#39 = 1; #1#54 = #19#18; #1#55 = #19#21;|FINSI;
     |SI #24#39 = 2; #1#54 = #19#19; #1#55 = #19#22;|FINSI;
     |SI #24#39 = 3; #1#54 = #19#20; #1#55 = #19#23; |FINSI;
     |SI #24#39 = 4; #1#54 = #19#147; #1#55 = #19#150; |FINSI;
     |SI #24#39 = 5; #1#54 = #19#148; #1#55 = #19#151; |FINSI;
     |SI #24#39 = 6; #1#54 = #19#149; #1#55 = #19#152; |FINSI;
     |PINTA #1#54;
     |PINTA #1#55;
|FPRC;

|PROCESO ConsuUsu; |TIPO 66;
     aAlfa = Usuario; |NOME_DAT #27 aAlfa; |DELINDEX #27;
     |HAZ CargaUsu;
     |SI FSalida ! 0; |ACABA; |FINSI; || No encuentra el fichero de usuarios
     |ABRE #27;
     #27#0 = #0#9;
     |LEE 000#27];
     |CONSULTA_CLAVE #1#27;
     |SI FSalida = 0;
          #0#9 = #27#0;
          |PINTA #0#9;
     |SINO;
          |ERROR;
     |FINSI;
     |CIERRA #27;
     |DELINDEX #27;
|FPRC;

|PROCESO CheqUsu; |TIPO 0;
     aAlfa = Usuario; |NOME_DAT #27 aAlfa; |DELINDEX #27;
     |HAZ CargaUsu;
     |SI FSalida ! 0; |ACABA; |FINSI; || No encuentra el fichero de usuarios
     |ABRE #27;
     #27#0 = #0#9;
     |LEE 000#27=;
     |SI FSalida ! 0;
          |MENAV "0000No existe el usuario...";
          |ERROR;
     |FINSI;
     |CIERRA #27;
     |DELINDEX #27;
|FPRC;

|PROCESO CargaUsu;
     nSal = 1;
     |DBASS aAlfa;
     aAlfa = aAlfa + "dev/usr/ds_sys.psw";
     |XABRE "", aAlfa, nHandle;
     |SI FSalida = 0;
          |ABRE #27;
          |XLEE nHandle, 200, aAlfa;
          |PARA; |SI FSalida ] 0; |HACIENDO;
               nSal = 0;
               #27#0 = aAlfa % 410;
               |GRABA 000#27n;
               |XLEE nHandle, 200, aAlfa;
          |SIGUE;
          |CIERRA #27;
          |XCIERRA nHandle;
     |FINSI;
     FSalida = nSal;
|FPRC;

|PROCESO SumaStockBlock;
     |QBF aArt;
     |SI aArt = ""; |ACABA; |FINSI;

     |SELECT #2#21;
     #21#0 = #0#3;
     #21#2 = aArt;
     |LEE 000#21=;
     |SI FSalida = 0; |ACABA; |FINSI;

     |DDEFECTO #19;
     #19#0 = aArt;
     |LEE 000#19=;
     |SI #19#126 = "VAR"; |ACABA; |FINSI;

     #19#0 = aArt;
     |LEE 101#19=;
     |SI FSalida ! 0; |GRABA 020#19b; |FINSI;
     |DDEFECTO #17;
     #17#0 = aArt;
     #17#1 = 1;     || Almacen
     |LEE 101#17=;
     |SI FSalida ! 0; |GRABA 020#17b; |FINSI;

     nUni = nUni * #1#3;
     #19#12 = #19#12 + (nUni * nForma);
     #19#104 = #19#104 - (nUni * nForma);
||     #19#6 = #19#6 - (nUni * nForma);
     #19#15 = #19#15 + (nUni * nForma);

     #17#8 = #17#8 + (nUni * nForma);
     #17#39 = #17#39 - (nUni * nForma);
||     #17#5 = #17#5 - (nUni * nForma);
     #17#42 = #17#42 - (nUni * nForma);

     nUni2 = 0;
     |SI #19#179 = "S";
          |DDEFECTO #238;
          #238#0 = #19#201;
          |LEE 000#238=;
          |SI nSwPuerta = 0; |Y #238#8 > 0;
               |SI #238#8 = 1; nUni2 = nUni * #19#189; |FINSI;
               |SI #238#8 = 2; nUni2 = nUni * #19#189 * #19#190; |FINSI;
               |SI #238#8 = 3; nUni2 = nUni * #19#189 * #19#190 * #19#191; |FINSI;
          |FINSI;
          |SI nSwPuerta = 1; |Y #238#8 > 0;
               |SI #238#8 = 1; nUni2 = nUni * #1#20; |FINSI;
               |SI #238#8 = 2; nUni2 = nUni * #1#20 * #1#19; |FINSI;
               |SI #238#8 = 3; nUni2 = nUni * #1#20 * #1#19 * #1#21; |FINSI;
          |FINSI;
          |SI nSwPuerta = 2; |Y #238#8 > 0;
               |SI #238#8 = 1; nUni2 = nUni * #1#86; |FINSI;
               |SI #238#8 = 2; nUni2 = nUni * #1#86 * #1#85; |FINSI;
               |SI #238#8 = 3; nUni2 = nUni * #1#86 * #1#85 * #1#87; |FINSI;
          |FINSI;
     |FINSI;
     #19#193 = #19#193 - (nUni2 * nForma);
     #19#182 = #19#182 + (nUni2 * nForma);
||     #19#185 = #19#185 - (nUni2 * nForma);
     #17#48 = #17#48 - (nUni2 * nForma);
     #17#44 = #17#44 + (nUni2 * nForma);
     #17#44 = #17#44 + (nUni2 * nForma);
||     #17#47 = #17#47 - (nUni2 * nForma);

     |HAZ ValoraStock;

     |GRABA 020#19a;
     |LIBERA #19;
     |GRABA 020#17a;
     |LIBERA #17;
|FPRC;

|PROCESO StockBlock;
     |ABRE #17;
     |ABRE #19;
     |ABRE #21;
     |ABRE #238;
     nSwPuerta = 0;
     aArt = #1#7; nUni = #1#40; |HAZ SumaStockBlock;
     nSwPuerta = 1;
     aArt = #1#17; nUni = 1; |HAZ SumaStockBlock;
     |SI #1#5 = "D";
          nSwPuerta = 2;
          aArt = #1#81; nUni = 1; |HAZ SumaStockBlock;
     |FINSI;
     nSwPuerta = 0;
     aArt = #1#24; nUni = #1#23; |HAZ SumaStockBlock;
     aArt = #1#27; nUni = #1#26;|HAZ SumaStockBlock;
     aArt = #1#90; nUni = #1#89;|HAZ SumaStockBlock;
     aArt = #1#30; nUni = #1#29; |HAZ SumaStockBlock;
     aArt = #1#33; nUni = #1#32; |HAZ SumaStockBlock;
     aArt = #1#36; nUni = #1#35; |HAZ SumaStockBlock;
     |CIERRA #238;
     |CIERRA #21;
     |CIERRA #19;
     |CIERRA #17;
|FPRC;

|PROCESO ExisteVario;
     |SELECT #2#21;
     #21#0 = #0#3;
     #21#2 = aArt;
     |LEE 000#21=;
|FPRC;

|PROCESO ChequeaVario;
     |ABRE #21;

     aArt = #1#7; |HAZ ExisteVario; || Galce
     |SI FSalida ! 0; #1#48 = ""; #1#49 = ""; |SINO; #1#48 = #21#7; #1#49 = #21#8;|FINSI;

     aArt = #1#17; |HAZ ExisteVario; || Puerta
     |SI FSalida ! 0; #1#50 = ""; #1#51 = ""; |SINO; #1#50 = #21#7; #1#51 = #21#8; |FINSI;

     aArt = #1#81; |HAZ ExisteVario; || Puerta2
     |SI FSalida ! 0; #1#83 = ""; #1#84 = ""; |SINO; #1#83 = #21#7; #1#84 = #21#8; |FINSI;

     aArt = #1#24; |HAZ ExisteVario; || Picaporte
     |SI FSalida ! 0; #1#65 = ""; #1#66 = ""; |SINO; #1#65 = #21#7; #1#66 = #21#8; |FINSI;

     aArt = #1#27; |HAZ ExisteVario; || Pernio
     |SI FSalida ! 0; #1#67 = ""; #1#68 = ""; |SINO; #1#67 = #21#7; #1#68 = #21#8; |FINSI;

     aArt = #1#90; |HAZ ExisteVario; || Pernio
     |SI FSalida ! 0; #1#93 = ""; #1#94 = ""; |SINO; #1#93 = #21#7; #1#94 = #21#8; |FINSI;

     aArt = #1#30; |HAZ ExisteVario; || Cerradura
     |SI FSalida ! 0; #1#69 = ""; #1#70 = ""; |SINO; #1#69 = #21#7; #1#70 = #21#8; |FINSI;

     aArt = #1#33; |HAZ ExisteVario; || Bisagra
     |SI FSalida ! 0; #1#71 = ""; #1#72 = ""; |SINO; #1#71 = #21#7; #1#72 = #21#8; |FINSI;

     aArt = #1#36; |HAZ ExisteVario; || Pasador
     |SI FSalida ! 0; #1#73 = ""; #1#74 = ""; |SINO; #1#73 = #21#7; #1#74 = #21#8; |FINSI;

     aArt = #1#43; |HAZ ExisteVario; || M.Block
     |SI FSalida ! 0; #1#75 = ""; #1#76 = ""; |SINO; #1#75 = #21#7; #1#76 = #21#8; |FINSI;

     aArt = #1#52; |HAZ ExisteVario; || M.Cris
     |SI FSalida ! 0; #1#77 = ""; #1#78 = ""; |SINO; #1#77 = #21#7; #1#78 = #21#8; |FINSI;

     |CIERRA #21;
|FPRC;

|PROCESO PrecioCli;
     nPrecio = 0;
     |ABRE #24;
     #24#0 = #0#3;
     |LEE 000#24=;
     |SI FSalida = 0;
          |ABRE #19;
          |SI Campo = 1; |O Campo = 4;
               #19#0 = #50Campo;
          |SINO;
               |SI nSwAccesorio = 0;
                    #19#0 = #1Campo;
               |SINO;
                    #19#0 = #2Campo;
               |FINSI;
          |FINSI;
          |LEE 000#19=;
          |SI FSalida = 0;
               |SI #24#39 = 1; nPrecio = #19#18; |FINSI;
               |SI #24#39 = 2; nPrecio = #19#19; |FINSI;
               |SI #24#39 = 3; nPrecio = #19#20; |FINSI;
               |SI #24#39 = 4; nPrecio = #19#147; |FINSI;
               |SI #24#39 = 5; nPrecio = #19#148; |FINSI;
               |SI #24#39 = 6; nPrecio = #19#149; |FINSI;
          |FINSI;
          |CIERRA #19;
     |FINSI;
     |CIERRA #24;
     |SI nSwAccesorio = 0;
          |SI Campo = 7; #1#58 = nPrecio; |FINSI;
          |SI Campo = 17; #1#59 = nPrecio; |FINSI;
          |SI Campo = 81; #1#88 = nPrecio; |FINSI;
          |SI Campo = 24; #1#60 = nPrecio; |FINSI;
          |SI Campo = 27; #1#61 = nPrecio; |FINSI;
          |SI Campo = 90; #1#92 = nPrecio; |FINSI;
          |SI Campo = 30; #1#62 = nPrecio; |FINSI;
          |SI Campo = 33; #1#63 = nPrecio; |FINSI;
          |SI Campo = 36; #1#64 = nPrecio; |FINSI;
          |SI Campo = 43; #1#45 = nPrecio; |PINTA #1#45; |FINSI;
          |SI Campo = 52; #1#54 = nPrecio; |PINTA #1#54; |FINSI;

          |SI Campo = 1; #1#61 = nPrecio; |FINSI;
          |SI Campo = 4; #1#92 = nPrecio; |FINSI;
     |SINO;
          #2#12 = nPrecio;
     |FINSI;
|FPRC;

|PROCESO MuestraPrecio;
     nCampo = Campo;
     |SI nCampo = 7; nPrecio = #1#58; |FINSI;
     |SI nCampo = 17; nPrecio = #1#59; |FINSI;
     |SI nCampo = 81; nPrecio = #1#88; |FINSI;
     |SI nCampo = 24; nPrecio = #1#60; |FINSI;
     |SI nCampo = 27; nPrecio = #1#61; |FINSI;
     |SI nCampo = 90; nPrecio = #1#92; |FINSI;
     |SI nCampo = 30; nPrecio = #1#62; |FINSI;
     |SI nCampo = 33; nPrecio = #1#63; |FINSI;
     |SI nCampo = 36; nPrecio = #1#64; |FINSI;
     |SI nCampo = 43; nPrecio = #1#45; |FINSI;
     |SI nCampo = 52; nPrecio = #1#54; |FINSI;

     |SI nCampo = 1; nPrecio = #1#61; |FINSI;
     |SI nCampo = 4; nPrecio = #1#92; |FINSI;
     |SI nSwAccesorio = 1; nPrecio = #2#12; |FINSI;
     #28#0 = nPrecio;
     |PUSHV 0501 2380;
     |BLANCO 1027 1649;
     |PINPA #0#28;
     |PINDA #0#28;
     |ENCAMPO #0#28;
     |SI FSalida = 0;
          nPrecio = #28#0;
          |SI nSwAccesorio = 0;
               |SI nCampo = 7; #1#58 = nPrecio; |FINSI;
               |SI nCampo = 17; #1#59 = nPrecio; |FINSI;
               |SI nCampo = 81; #1#88 = nPrecio; |FINSI;
               |SI nCampo = 24; #1#60 = nPrecio; |FINSI;
               |SI nCampo = 27; #1#61 = nPrecio; |FINSI;
               |SI nCampo = 90; #1#92 = nPrecio; |FINSI;
               |SI nCampo = 30; #1#62 = nPrecio; |FINSI;
               |SI nCampo = 33; #1#63 = nPrecio; |FINSI;
               |SI nCampo = 36; #1#64 = nPrecio; |FINSI;
               |SI nCampo = 43; #1#45 = nPrecio; |FINSI;
               |SI nCampo = 52; #1#54 = nPrecio; |FINSI;

               |SI nCampo = 1; #1#61 = nPrecio; |FINSI;
               |SI nCampo = 4; #1#92 = nPrecio; |FINSI;
          |SINO;
               #2#12 = nPrecio;
          |FINSI;
     |FINSI;
     |POPV;
|FPRC;

|PROCESO EntraUni; |TIPO 7;
     eaArticulo = #2#3;
     enAlmacen = 1;
     eaCliente = #0#3;
     efFecha = #0#2;
     enUnidad1 = #2#5;
     enUnidad2 = #2#6;
     enMedida1 = #2#7;
     enMedida2 = #2#8;
     enMedida3 = #2#9;
     |HAZ DobleUniV;
     |C_M #2#5, 1, "S";
     |SI eaSw2Stock = "S";
          |C_M #2#5, 1, "N";
          #2#5 = enUnidad1; |PINTA #2#5;
          #2#6 = enUnidad2; |PINTA #2#6;
          #2#7 = enMedida1;
          #2#8 = enMedida2;
          #2#9 = enMedida3;
     |FINSI;
|FPRC;

|PROCESO MedidaPuerta;
     |PUSHV 05012380;
     |SI Campo = 17;
          #26#0 = #1#20;
          #26#1 = #1#19;
          #26#2 = #1#21;
     |SINO;
          #26#0 = #1#86;
          #26#1 = #1#85;
          #26#2 = #1#87;
     |FINSI;
     |BLANCO 13152050;
     |PINPA #0#26;
     |ATRI R;
     |PINTA 1426, "Medidas Puerta  ";
     |PINTA 1621, " Alto ³    Ancho ³   Grueso";
     |PINDA #0#26;
     |ENDATOS #1#26;
     |SI FSalida = 0;
          |SI Campo = 17;
               #1#20 = #26#0;
               #1#19 = #26#1;
               #1#21 = #26#2;
          |SINO;
               #1#86 = #26#0;
               #1#85 = #26#1;
               #1#87 = #26#2;
          |FINSI;
     |FINSI;
     |POPV;
     |HAZ PintaMedi;
|FPRC;

|PROCESO MedidaGalce;
     |PUSHV 05012380;
     #26#0 = #1#9;
     #26#1 = #1#10;
     #26#2 = #1#11;
     |BLANCO 13152050;
     |PINPA #0#26;
     |ATRI R;
     |PINTA 1426, "Medidas Galce   ";
     |PINTA 1621, "  Alto³     Ancho³   Rebaje";
     |PINDA #0#26;
     |ENDATOS #1#26;
     |SI FSalida = 0;
           #1#9 = #26#0;
           #1#10 = #26#1;
           #1#11 = #26#2;
     |FINSI;
     |POPV;
     |HAZ PintaMedi;
|FPRC;

|PROCESO Tipo2Accesorio; |TIPO 2;
     nForma = 0 +. 1;

     |ABRE #21;
     aArt = #2#3;
     |HAZ ExisteVario;
     |SI FSalida ! 0; #2#10 = ""; #2#11 = ""; |SINO; #2#10 = #21#7; #2#11 = #21#8; |FINSI;
     |CIERRA #21;
|FPRC;

|PROCESO StockAccesorio;
     |ABRE #19;
     |ABRE #17;
     #19#0 = #2#3;
     |LEE 101#19=;
     |SI FSalida = 0;
          |DDEFECTO #17;
          #17#0 = #2#3;
          #17#1 = 1;
          |LEE 101#17=;
          |SI FSalida ! 0; |GRABA 020#17b; |FINSI;

          #19#15 = #19#15 + (#2#5 * nForma);
          #19#182 = #19#182 + (#2#6 * nForma);
          #19#12 = #19#12 + (#2#5 * nForma);

||          #19#6 = #19#6 - (#2#5 * nForma);
||          #19#185 = #19#185 - (#2#6 * nForma);
          #19#104 = #19#104 - (#2#5 * nForma);
          #19#193 = #19#193 - (#2#6 * nForma);

          #17#42 = #17#42 + (#2#5 * nForma);
          #17#44 = #17#44 + (#2#6 * nForma);
          #17#8 = #17#8 + (#2#5 * nForma);

||          #17#5 = #17#5 - (#2#5 * nForma);
||          #17#47 = #17#47 - (#2#5 * nForma);
          #17#39 = #17#39 - (#2#5 * nForma);
          #17#48 = #17#48 - (#2#5 * nForma);
          |HAZ ValoraStock;
          |GRABA 020#17a;
          |GRABA 020#19a;
     |FINSI;
     |CIERRA #19;
     |CIERRA #17;
|FPRC;

|PROCESO DobleSimple; |TIPO 0;
     |SI #1#5 = "D";
          |C_M #1#79, 1, "S";
          |C_M #1#80, 1, "S";
          |C_M #1#81, 1, "S";
          |C_M #1#82, 1, "S";
          |C_M #1#89, 1, "S";
          |C_M #1#90, 1, "S";
          |C_M #1#91, 1, "S";
          |C_M #1#35, 1, "S";
          |C_M #1#36, 1, "S";
     |SINO;
          |C_M #1#79, 1, "N";
          |C_M #1#80, 1, "N";
          |C_M #1#81, 1, "N";
          |C_M #1#82, 1, "N";
          |C_M #1#89, 1, "S";
          |C_M #1#90, 1, "S";
          |C_M #1#91, 1, "S";
          |C_M #1#35, 1, "N";
          |C_M #1#36, 1, "N";
          #1#81 = ""; |PINTA #1#81;
          #1#82 = ""; |PINTA #1#82;
          #1#89 = ""; |PINTA #1#89;
          #1#90 = ""; |PINTA #1#90;
          #1#91 = ""; |PINTA #1#91;
     |FINSI;
     |SI #1Campo ! Contenido;
          |HAZ MediCli;
     |FINSI;
|FPRC;

|PROCESO EntraPernio; |TIPO 7;
     nModo = (FEntrada / 100) ! 0;
     |SI #1#4 = 1; |Y #1#5 = "D"; |Y FSalida = 0;
          |C_M #1#26, 1, "N";
          |C_M #1#27, 1, "N";
          |C_M #1#28, 1, "N";
          #50#0 = #1#26;
          #50#1 = #1#27;
          #50#2 = #1#28;
          #50#3 = #1#89;
          #50#4 = #1#90;
          #50#5 = #1#91;
          |PUSHV 0501 2380;
          |BLANCO 1415 1880;
          |PINPA #0#50;
          |PINDA #0#50;
          aGuarda = FEntrada;
          |ENDATOS #2#50;
          FEntrada = aGuarda;
          |SI FSalida = 0;
               #1#26 = #50#0;
               #1#27 = #50#1;
               #1#28 = #50#2;
               #1#89 = #50#3;
               #1#90 = #50#4;
               #1#91 = #50#5;
          |FINSI;
          |POPV;
          |PINTA #1#26;
          |PINTA #1#27;
          |PINTA #1#28;
     |FINSI;
|FPRC;

|PROCESO CheqArtiPer; |TIPO 0;
     nTecla = FSalida;

     |SI nTecla = 13;                        || F5
          nConsulta = 0;
          aNumCam = Campo;
          |HAZ ConsultaArtVario;
          |SI FSalida ! 0; |ERROR; |ACABA; |FINSI;
     |FINSI;

     ||SI #50Campo ! Contenido; |O nModo = 1;
     |SI #50Campo ! Contenido;
          |DDEFECTO #19;
          |ABRE #19;
          #19#0 = #50Campo;
          |LEE 000#19=;
          |CIERRA #19;
          nCampo = Campo + 1;
          #50nCampo = #19#1; |PINTA #50nCampo;

          |HAZ PrecioCli;
     |FINSI;

     |SI nTecla = 14;                        || F6
          |HAZ MuestraPrecio;
     |FINSI;
     ||--------------Chequeo
     aAlfa = #50Campo; |QBF aAlfa;
     |SI aAlfa ! ""; |O nSwAccesorio = 1;
          |ABRE #19;
          #19#0 = #50Campo;
          |LEE 000#19=;
          |CIERRA #19;
          aDef = "tagm0040";
          |DDEF aAlfa;
          aAlfa = aAlfa + aDef;
          |CARGA_DEF aAlfa, referen@;
          |SI FSalida = 0;
               |ABRE #referen@;
               |LEE 000#referen@.p;
               |SI FSalida ! 0;         || Si no hay ninguno
                    nSal = 0;
               |SINO;
                    #referen@#0 = #19#3;
                    |LEE 000#referen@.=;
                    nSal = FSalida;
               |FINSI;
               |CIERRA #referen@;
               |DESCARGA_DEF #referen@;
          |FINSI;
          |SI nSal ! 0;
               |MENAV "0000Articulo incorrecto...";
               |ERROR; |ACABA;
          |FINSI;
          |SI #142#35 ! "N";
               |SI Campo = 1; nUni = #1#3 * #50#0; |FINSI;
               |SI Campo = 4; nUni = #1#3 * #50#3; |FINSI;
               |SI #19#104 < nUni;
                    aAlfa = "0000" + #19#0 + ". Se supera el Stock Disponible: " + #19#104;
                    |MENAV aAlfa;
                    |SI #142#35 = "X"; |ERROR; |ACABA; |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
     |HAZ MuestraPrecio;
|FPRC;

|PROCESO MaxPernioPer; |TIPO 0;
     |SI #1#4 = 1; |Y #50#0 > 4;
          |MENAV "0000Supera el Maximo de 4 unidades";
          |ERROR;
     |FINSI;
|FPRC;

|PROCESO ImpoMonta; |TIPO 0;
     #1#47 = #1#45 < #1#46;
     |PINTA #1#47;
|FPRC;

|PROCESO Pide_Serie;
     |ABRE #7;
     |PINTA 2420 , aAlfa;
   |ET OtraSerie;
     E_sup = 5;
     E_inf = "";
     aSerie = 2435 ? 1;
     #7#26 = aSerie;
     |SI FSalida = 6;
          |LEE 000#7=;
          |CONSULTA_CLAVE #1#7;
          |SI FSalida = 0; aSerie = #7#26; |FINSI;
          |VETE OtraSerie;
     |FINSI;
     |SI FSalida = 1; |O FSalida = 7;
          nError = 1;
     |SINO;
          |LEE 000#7=;
          |SI FSalida ! 0;
               |MENAV "0000No existe serie...";
               |VETE OtraSerie;
          |FINSI;
     |FINSI;
     |CIERRA #7;
|FPRC;

|PROCESO CreaLinPed;
     |DDEFECTO #31;
     #31#0 = #30#0;
     #31#1 = #30#1;
     |PARA i = 2; |SI i [ 94; |HACIENDO i = i + 1;
          #31i = #1i;
     |SIGUE;
     |GRABA 020#31n;
     nForma = 1;
     |HAZ StockBlock;
|FPRC;

|PROCESO CreaAccesorio;
     |DDEFECTO #31;
     #32#0 = #30#0;
     #32#1 = #30#1;
     |PARA i = 2; |SI i [ 12; |HACIENDO i = i + 1;
          #32i = #2i;
     |SIGUE;
     |GRABA 020#32n;
     nForma = 1;
     |HAZ StockAccesorio;
|FPRC;

|DEFBUCLE CreaAccesorio;
     #2#1;
     ;
     #0#0, #0#1, 001;
     #0#0, #0#1, 999;
     ;
     NULL, CreaAccesorio;
|FIN;

|PROCESO CreaPediBlock;
     aAlfa = "Serie Pedido.:       ";
     aSerie = "";
     |HAZ Pide_Serie;
     |SI nError ! 0; |ACABA; |FINSI;
     |ABRE #30;
     |ABRE #31;
     |ABRE #32;
     #30#0 = aSerie; aSerie = #30#0;
     #30#1 = 999999;
     |LEE 000#30];
     |SI FSalida = 0;
          |LEE 000#30a;
     |SINO;
          |LEE 000#30u;
     |FINSI;
     |SI FSalida = 0; |Y #30#0 = aSerie;
          nConta = #30#1 + 1;
     |SINO;
          nConta = 1;
     |FINSI;
     |DDEFECTO #30;
     #30#0 = aSerie;
     #30#1 = nConta;
     |PARA i = 2; |SI i [ 23; |HACIENDO i = i + 1;
          #30i = #0i;
     |SIGUE;
     #30#27 = #0#0;
     #30#28 = #0#1;
     #30#29 = #0#26;
     #30#30 = #0#27;
     #30#34 = #0#28;
     |GRABA 020#30n;
     |SI FSalida = 0;
          |BUCLELIN 2 CreaLinPed #0;
          |BUCLE CreaAccesorio;
          #0#24 = #30#0; |PINTA #0#24;
          #0#25 = #30#1; |PINTA #0#25;
          |GRABA 020#0a;

          eaSerie = #30#0;
          enCodigo = #30#1;
          |SUB_EJECUTA_NP "tagz0031";

          #104#25 = #30#0; #104#4 = #30#3; nImpo = #30#33;
          eaTag = "PE"; |HAZ Riesgos;

          |DDEFECTO #80;
          |ABRE #80;
          #80#0 = #30#0;
          #80#1 = #30#1;
          |LEE 101#80=;
          |SI FSalida ! 0; |GRABA 020#80b; |FINSI;
          #80#3 = "PU";
          |GRABA 020#80a;
          |CIERRA #80;

          aAlfa = "0000Creado pedido: " + #0#24 + "/" + (("000000" + #0#25)%-106);
          |MENAV aAlfa;

          |CONFI "0000N¿Asignar procesos al pedido?";
          |SI FSalida = 0;
               ser_ped = #30#0;
               num_ped = #30#1;
               |SUB_EJECUTA_NP "tagz0018;S";
          |FINSI;
          |CONFI "0000N¿Imprimir Pedido blcok?";
          |SI FSalida = 0;
               |HAZ ImpresionPed;
          |FINSI;
     |FINSI;
     |CIERRA #32;
     |CIERRA #31;
     |CIERRA #30;
|FPRC;

|PROCESO ImprimePed;
     |PRINT;
|FPRC;

|PROCESO AccesoriosPed;
     |SI enSwImp = 1;
          enSwImp = 2; |PRINT;
          enSwImp = 3;
     |FINSI;
     |PRINT;
|FPRC;

|DEFBUCLE AccesoriosPed;
     #32#1;
     ;
     #30#0, #30#1, 001;
     #30#0, #30#1, 999;
     ;
     NULL, AccesoriosPed;
|FIN;

|PROCESO ImpresionPed;
     enSwImp = 0;
     enTipo = 1;
     |IMPRE 0;
     |SI FSalida = 0;
          |INFOR "tagm0030";
          |SI FSalida = 0;
               enSwImp = 1;
               |BUCLELIN 0 ImprimePed #30;
               |BUCLE AccesoriosPed;
               |PIEINF;
               |FININF;
          |SINO;
               |MENAV "0000No existe informe 'tagm0030'";
          |FINSI;
          |FINIMP;
     |FINSI;
     |SI enSwImp ! 0;    || Integracion Item doc, realiza tambien impresion
          eaSerBlc = #30#0;
          enNumBlc = #30#1;
          |SUB_EJECUTA_NP "tagz0026";
     |FINSI;
|FPRC;


|PROCESO CalculaNif;
     nSal = FSalida;

     |ABRE #24;
     #24#0 = #0#3;
     |LEE 000#24=;
     |CIERRA #24;
     eaPais = #24#205;

     |SI nSal = 9;
         eaVarDni   = #0Campo;
         enCalcCif  = 1;
         |HAZ CalculoNIFCIF;
         #0Campo = eaVarDni;
         |PINTA #0Campo;
         |ERROR;
         |ACABA;
     |FINSI;

     |HAZ NifTaglo104;

     eaVarDni  = #0Campo;
     enCalcCif = 0;
     |HAZ CalculoNIFCIF;

     aNifQbf1 = #0Campo;   |QBF aNifQbf1;
     aNifQbf2 = eaVarDni;  |QBF aNifQbf2;

     |SI aNifQbf1 ! aNifQbf2; |Y aNifQbf1 ! "";
         |CONFI "0000SEl Nif puede ser Erroneo. Desea Calcularlo.";
         |SI FSalida = 0;
             #0Campo = eaVarDni;  |PINTA #0Campo;
             |ERROR;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO NifTaglo104;
     aAlfa = #0#28; |QBF aAlfa;
     |SI aAlfa = "."; |ACABA; |FINSI;

     enError = 0;
     |DBASS aAlfa;
     aAlfa = aAlfa + "basica/def/agim0003";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          #referen@#0 = #0#28;
          |LEE 000#referen@.=;
          |SI FSalida ! 0;
               eaVarDni = #0#28;
               |ABRE #24;
               #24#0 = #0#3;
               |LEE 000#24=;
               |CIERRA #24;
               eaNonDni = #0#6;
               eaDomiDni = #0#18;
               eaCPDni = #0#23;
               eaPobDni = #0#19;
               eaPrvDni = #0#20;
               eaTlfDni = #24#17;
               eaFacDni = #24#18;
               eaPaisDni = #24#205;
               |SUB_EJECUTA_NP ":basica/tagm0001";
          |FINSI;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
     |SI enError ! 0; |ERROR; |FINSI;
|FPRC;
