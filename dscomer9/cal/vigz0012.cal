 piens065

|FICHEROS;
     vigz0012 #0;
     vigw0010 #1;
     agifa065 #2;
     agifa019 #3;
     agifa017 #4;
     agifa007;
|FIN;

|VARIABLES;
     &Tempo = "";
     vez=0;
     almacen = 0;
|FIN;

|PROCESO EsInternoHis;
     |ABRE #agifa007;
     #agifa007#26 = #agifa065#11;
     |LEE 000#agifa007.=;
     |CIERRA #agifa007;

     |SI #agifa007#37 = "S";
          FSalida = 0;
     |SINO;
          FSalida = 1;
     |FINSI;
|FPRC;

|PROCESO imprime;
     #1#5 = #1#4 * #1#3;
     |SI almacen!#1#0;
          |SI vez=0;
               vez = 1;
               |PRINT;
               almacen = #1#0;
          |SINO;
               |PIEINF;
               |PRINT;
               almacen = #1#0;
          |FINSI;
     |SINO;
          |PRINT;
     |FINSI;
|FPRC;

|DEFBUCLE imprime;
     #1#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL,imprime;
|FIN;

|DEFBUCLE imprime2;
     #1#2;
     ;
     INICIO;
     FINAL;
     ;
     NULL,imprime;
|FIN;

|PROCESO preciomed1;
     |SI #2#8 ! 0;
          #1#4 = #2#8;
     |FINSI;
     |GRABA 020#1a;
     |LIBERA #1;
|FPRC;

|DEFBUCLE preciomed;
     #2#1;
     5;
     #1#1,"00.00.0000","  ", 000001, 00001, "     ", #0#0;
     #1#1,       #0#5, "zz", 999999, 99999, "zzzzz", #0#1;
     ;
     NULL,preciomed1;
|FIN;

|PROCESO ppmed;
     |BUCLE preciomed;
|FPRC;

|DEFBUCLE ppmed;
     #1#1;
     ;
     INICIO;
     FINAL;
     be;
     NULL, ppmed;
|FIN;

|PROCESO acumula;
/*
     |HAZ EsInternoHis;
     |SI FSalida = 0; |ACABA; |FINSI;
*/
     |DDEFECTO #1;
     #1#0 = #2#5;
     #1#1 = #2#0;
     |LEE 101#1=;
     |SI FSalida ! 0; |GRABA 020#1b;   |FINSI;

     #3#0 = #1#1;
     |LEE 000#3=;
     |SI FSalida ! 0;|DDEFECTO #3;|FINSI;

     #1#2 = #3#1;
     #1#3 = #1#3 + #2#6;
     |SI #2#2 = "EV"; |O #2#2 = "AC";|O #2#2 = "SF";|O #2#2 = "FB";
          #1#6 = #1#6 + #2#6;
          #1#7 = #1#7 + (#2#6 * #2#9);
     |FINSI;
     |GRABA 020#1a;
     |LIBERA #1;
|FPRC;

/*
|DEFBUCLE acumula;
     #2#1;
     5;
     #0#2,"00.00.0000","  ", 000001, 00001,"     ",#0#0;
     #0#3,       #0#5 ,"zz", 999999, 99999,"zzzzz",#0#1;
     ;
     NULL,acumula;
|FIN;
     ||TODO CCC.
     ||No estaba realizando correctamente el bucle.
*/

|DEFBUCLE acumula;
 #2#4;
 ;
 "00.00.0000", #0#0, #0#2;
        #0#5 , #0#1, #0#3;
 ;
 NULL,acumula;
|FIN;



|PROCESO crear;
     #1#0 = #4#1;
     #1#1 = #4#0;
     |GRABA 020#1n;
|FPRC;

|DEFBUCLE crear;
     #4#1;
     ;
     #0#2, #0#0;
     #0#3, #0#1;
     be;
     NULL, crear;
|FIN;

|PROGRAMA;
     |CLS;
     |PINPA #0#0;
     |DDEFECTO #0;
     |PINDA #0#0;
     |CABEZA "Listado de stock a fecha";
     |ENDATOS #1#0;
     |SI FSalida = 0;
          |HAZ CreaTempo; |NOME_DAT #1 Tempo;
          |DELINDEX #1;
          |ABRE #1;
          |SI #0#7 = "S";
               |BUCLE crear;
          |FINSI;
          |ABRE #3;
          |BUCLE acumula;
          |CIERRA #3;
          |CIERRA #1;

          |BUCLE ppmed;

          |IMPRE 0;
          |SI FSalida = 0;
               |INFOR "vigz0012";
               |SI FSalida = 0;
                    |SI #0#8 = 2;
                         |BUCLE imprime2;
                    |SINO;
                         |BUCLE imprime;
                    |FINSI;
                    |PIEINF;
                    |FININF;
               |SINO;
                    |MENAV "0000Error en informe 'vigz0012'";
               |FINSI;
               |FINIMP;
          |FINSI;
          |HAZ BoraTempo; |DELINDEX #1;
     |FINSI;
|FPRO;
