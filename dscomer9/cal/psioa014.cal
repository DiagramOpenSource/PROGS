|FICHEROS;
  psioa013 #0;
  agifa321 #14;  || Divisas-Parametros.
  agifa324 #15;  || Divisas-Divisas.
  agifa025 #25;
  psioa083 #83;
  psioa084 #184;
  agifa084 #84;

  dscam045@ #200;
  dscam003@ #201;
  dscam004@ #202;
  dscamrie@ #100;
  dscam038@ #101;
  dscam023@ #102;
|FIN;

|VARIABLES;
     aSerie = "";
     &nDeci_Base = 0;
     nDespre = 0;
     nReci = 0;
     &eaCtaDesprecio = "";
     &eaCuenta = "";
     &efFecha = @;
     &eaTag    = "";
     &aSer     = "";
     &aCli     = "";
     &aNomCli  = "";
     &nImpo    = 0;

     nSwJamaica = -1;
     nCob = 0;
     nEl19 = 0;
     nEl09 = 0;

     aAlfa = "";
     nLinea = 0;
     nNume = 0;
|FIN;

|PROCESO LeeRepre;
     #84#48 = #0#0;
     #84#0 = #0#1;
     |LEE 000#84=;
     |SI FSalida = 0;
          #25#0 = #84#6;
          |LEE 000#25=;
          |SI FSalida = 0;
               #dscam003@#33 = #25#0;
               #dscam003@#34 = #25#1;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO BuscaReci;
     |SI #0#16 = 3; ||Tablet
          nReci = 0;
          |SI #0#0 = "AGR  "; || Es un recibo agrupado
               #83#0 = #0#1;
               |LEE 000#83=;
               |SI FSalida = 0;
                    nReci = #83#1;
                    #0#0 = #83#2;
                    #0#1 = 0;
                    #0#2 = 0;
               |FINSI;
          |SINO;
               |SI #0#0 = "DIV  ";
                    #184#0 = #0#1;
                    |LEE 000#184=;
                    |SI FSalida = 0;
                         nReci = #184#1;
                         #0#0 = #184#2;
                         #0#1 = 0;
                         #0#2 = 0;
                    |FINSI;
               |SINO;
                    |SELECT #12#dscam003@;
                    #dscam003@#0 = #0#0;
                    #dscam003@#1 = #0#1;
                    #dscam003@#2 = #0#2;
                    #dscam003@#4 = #0#9;
                    #dscam003@#5 = "";
                    #dscam003@#32 = "";
                    |LEE 000#dscam003@.];
                    |PARA; |SI FSalida = 0; |Y #dscam003@#0 = #0#0;
                              |Y #dscam003@#1 = #0#1;
                              |Y #dscam003@#2 = #0#2;
                              |Y #dscam003@#4 = #0#9; |HACIENDO;
                         |SI #dscam003@#69 = " ";
                              nReci = #dscam003@#40;
                         |FINSI;
                         |LEE 000#dscam003@.s;
                    |SIGUE;
                    |SELECT #1#dscam003@;
               |FINSI;
          |FINSI;
     |SINO;
          nReci = #0#7;
     |FINSI;
|FPRC;

|PROCESO JamaEntregaPen;
     |HAZ BuscaReci;
     #dscam003@#40 = nReci;
     |LEE 101#dscam003@.=;
     |SI FSalida = 0;
        nLinea = 1;
        #dscam004@#17 = nReci;
        #dscam004@#3  = 1;
        |LEE 000#dscam004@.];
        |PARA; |SI FSalida = 0; |Y #dscam004@#17 = nReci; |HACIENDO;
           nLinea = #dscam004@#3 + 1;
           |LEE 000#dscam004@.s;
        |SIGUE;
        |DDEFECTO #dscam004@;
        #dscam004@#17 = nReci;
        #dscam004@#3  = nLinea;
        |GRABA 020#dscam004@.b;
        #dscam004@#0 = #0#0;
        #dscam004@#1 = #0#1;
        #dscam004@#2 = #0#2;
        #dscam004@#4 = eaCtaDesprecio;
        #dscam004@#5 = "COB";
        #dscam004@#6 = efFecha;
        #dscam004@#7 = #dscam003@#23;
        #dscam004@#8 = nNume;
        #dscam004@#25 = #dscam003@#61;
        #dscam004@#26 = nNume * #dscam003@#59;
        #dscam004@#33 = 1;
        |GRABA 020#dscam004@.a; |LIBERA #dscam004@;

        #dscam003@#23 = #dscam003@#23 + nNume;
        #dscam003@#61 = #dscam003@#61 + (nNume * #dscam003@#59);
        #dscam003@#31 = #dscam003@#31 - nNume;
        #dscam003@#65 = #dscam003@#65 - (nNume * #dscam003@#59);
        #dscam003@#26 = ~;
        |SI #dscam003@#31 = 0;
           #dscam003@#14 = "L";
           #dscam003@#15 = "Recibo Liquidado";
        |SINO;
           |SI #dscam003@#23 ! 0;
              #dscam003@#14 = "C";
              #dscam003@#15 = "Cobrado parcialmente";
           |FINSI;
        |FINSI;
        |SI #0#8 ! 0;
             #dscam003@#12 = 3; || Tipo Recibo
             #dscam003@#99 = #0#9; || F.Emision
        |FINSI;
        |HAZ LeeRepre;
        |GRABA 020#dscam003@.a; |LIBERA #dscam003@;
     |FINSI;

     aSer = #dscam003@#0;
     aCli = #dscam003@#32;
     aNomCli = #dscam003@#6;
     nImpo = -nNume;
     eaTag   = "CB"; |HAZ Riesgos;
|FPRC;

|CALCULO pasecob;
     |HAZ LeeDivisa;

     aSerie = #0#0;
     |SI #0#16 = 3; ||Tablet
          |SI #0#0 = "DIV  ";      || Es un recibo dividido
               #184#0 = #0#1;
               |LEE 000#184=;
               |SI FSalida = 0
                    aSerie = #184#2;
               |FINSI;
          |SINO;
               |SI #0#0 = "AGR  "; || Es un recibo agrupado
                    #83#0 = #0#1;
                    |LEE 000#83=;
                    |SI FSalida = 0;
                         aSerie = #83#2;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;

     |DBASS aAlfa; aAlfa = aAlfa + "dscarter/def/dscam045.mas";
     |CARGA_DEF aAlfa, dscam045@;
     |SI FSalida = 0;
        |SALVA_DATOS #0;
        |DBASS aAlfa; aAlfa = aAlfa + "dscarter/fich/"; |PATH_DAT #200 aAlfa;
        |ABRE #dscam045@;
        |DBASS aAlfa; aAlfa = aAlfa + "dscarter/def/dscam003.mas";
        |CARGA_DEF aAlfa, dscam003@;
        |SI FSalida = 0;
           |DBASS aAlfa; aAlfa = aAlfa + "dscarter/def/dscam004.mas";
           |CARGA_DEF aAlfa, dscam004@;
           |SI FSalida = 0;
              aAlfa = "";
              #dscam045@#0 = #48#0;
              #dscam045@#1 = 1;
              |LEE 000#dscam045@.];
              |PARA; |SI FSalida = 0; |Y #dscam045@#0 = #48#0; |HACIENDO;
                 |SI #dscam045@#4 [ aSerie; |Y #dscam045@#5 ] aSerie;
                    |DBASS aAlfa; aAlfa = aAlfa + "dscarter/fich/" + (("00000" + #dscam045@#6) % -105) + "/";
                    |SAL;
                 |FINSI;
                 |LEE 000#dscam045@.s;
              |SIGUE;
              |SI aAlfa ! "";
                 |PATH_DAT #201 aAlfa; |PATH_DAT #202 aAlfa;
                 |ABRE #dscam003@;   |ABRE #dscam004@;
                 |HAZ BuscaReci;
                 #dscam003@#40 = nReci;
                 |LEE 101#dscam003@.=;
                 |SI FSalida = 0;
                    nLinea = 1;
                    #dscam004@#17 = nReci;
                    #dscam004@#3  = 1;
                    |LEE 000#dscam004@.];
                    |PARA; |SI FSalida = 0; |Y #dscam004@#17 = nReci; |HACIENDO;
                       nLinea = #dscam004@#3 + 1;
                       |LEE 000#dscam004@.s;
                    |SIGUE;
                    |DDEFECTO #dscam004@;
                    #dscam004@#17 = nReci;
                    #dscam004@#3  = nLinea;
                    |GRABA 020#dscam004@.b;
                    #dscam004@#0 = #0#0;
                    #dscam004@#1 = #0#1;
                    #dscam004@#2 = #0#2;
                    #dscam004@#4 = eaCuenta;
                    #dscam004@#5 = "COB";
                    #dscam004@#6 = efFecha;
                    #dscam004@#7 = #dscam003@#23;
                    #dscam004@#8 = #0#5;
                    #dscam004@#25 = #dscam003@#61;
                    #dscam004@#26 = #0#5 * #dscam003@#59;
                    #dscam004@#33 = 1;
                    |SI #0#6 = "S";
                         nDespre = (#dscam003@#31 - #0#5) ! nDeci_Base;
                         #dscam004@#23 = nDespre;
                         #dscam004@#32 = nDespre * #dscam003@#59;
                    |SINO;
                         nDespre = 0;
                    |FINSI;
                    |SI #0#16 = 3; |Y #0#13 = "T ";
                         #dscam004@#5 = "RPT";
                         #dscam004@#51 = #0#19;
                         #dscam004@#52 = #0#14;
                         #dscam004@#53 = #0#11;
                         #dscam004@#33 = 1;
                    |FINSI;
                    |GRABA 020#dscam004@.a; |LIBERA #dscam004@;

                    #dscam003@#55 = #dscam003@#55 + nDespre;
                    #dscam003@#68 = #dscam003@#68 + (nDespre * #dscam003@#59);

                    |SI #0#16 = 3; |Y #0#13 = "T ";
                         #dscam003@#14 = "T";
                         #dscam003@#15 = "Pagare/talon de cliente";
                         #dscam003@#72 = #0#19;
                         #dscam003@#70 = #0#14;
                         #dscam003@#90 = "S";
                         #dscam003@#26 = #0#12;
                         #dscam003@#78 = #dscam003@#78 +  (#0#5 + nDespre);
                         #dscam003@#79 = #dscam003@#79 +  (#0#5 + nDespre);
                    |SINO;
                         #dscam003@#26 = ~;
                         #dscam003@#23 = #dscam003@#23 + #0#5 + nDespre;
                         #dscam003@#61 = #dscam003@#61 + ((#0#5 + nDespre)* #dscam003@#59);
                         #dscam003@#31 = (#dscam003@#31 - #0#5 - nDespre) ! nDeci_Base;
                         #dscam003@#65 = #dscam003@#65 - ((#0#5 + nDespre) * #dscam003@#59);
                         |SI #dscam003@#31 = 0;
                            #dscam003@#14 = "L";
                            #dscam003@#15 = "Recibo Liquidado";
                         |SINO;
                            |SI #dscam003@#23 ! 0;
                               #dscam003@#14 = "C";
                               #dscam003@#15 = "Cobrado parcialmente";
                            |FINSI;
                         |FINSI;
                    |FINSI;
                    |SI #0#8 ! 0;
                         #dscam003@#12 = #0#8; || Tipo Recibo
                         #dscam003@#99 = #0#9; || F.Emision
                    |FINSI;
                    |HAZ LeeRepre;
                    |GRABA 020#dscam003@.a; |LIBERA #dscam003@;
                 |FINSI;

                 aSer = #dscam003@#0;
                 aCli = #dscam003@#32;
                 aNomCli = #dscam003@#6;
                 nImpo = -#0#5 - nDespre;
                 eaTag   = "CB"; |HAZ Riesgos;

                 |SI nSwJamaica = 0;
                      nNume = #0#4 - #0#5;
                      |SI #0#6 = "S"; |Y nNume ! 0;
                         |HAZ JamaEntregaPen;
                      |FINSI;
                 |FINSI;
                 |CIERRA #dscam003@; |CIERRA #dscam004@;

                 #84#48 = #0#0;
                 #84#0 = #0#1;
                 |LEE 101#84=;
                 |SI FSalida = 0;
                    #84#63 = #84#63 + #0#5;
                    |GRABA 020#84a;
                    |LIBERA #84;
                 |FINSI;

              |FINSI;
              |DESCARGA_DEF #dscam004@;
           |FINSI;
           |DESCARGA_DEF #dscam003@;
        |FINSI;
        |CIERRA #dscam045@; |DESCARGA_DEF #dscam045@;

        |REPON_DATOS #0;

        #0#7 = nReci;
        #0#10 = "S";
        |GRABA 020#0a;
     |FINSI;
     |LIBERA #0;
|FCAL;

|DEFBUCLE pasecobros;
     #0#1;
     10;
     "     " ,       0 , 000 , 00, "N";
     "zzzzz" ,  999999 , 999 , 99, "N";
     be;
     NULL,pasecob;
|FIN;

|DEFBUCLE CobrosJamaica;
     #0#1;
     10;
     "     " ,       0 , 000 , 00, "N";
     "zzzzz" ,  999999 , 999 , 99, "N";
     be;
     NULL,pasecob;
|FIN;

|PROGRAMA;
/*
 Para que no este modulado, Tiquet: 4760/266

     |HAZ EsJamaica; nSwJamaica = FSalida;
*/
     |ABRE #184;
     |ABRE #83;
     |ABRE #84;
     |ABRE #25;
     |SI nSwJamaica = 0;
          |BUCLE CobrosJamaica;
     |SINO;
          |BUCLE pasecobros;
     |FINSI;
     |CIERRA #25;
     |CIERRA #84;
     |CIERRA #83;
     |CIERRA #184;
|FPRO;

|PROCESO LeeDivisa;
     |ABRE #14;
     |ABRE #15;
     #14#0 = "A";
     |LEE 001#14=;
     |SI FSalida ! 0; |DDEFECTO #14; |FINSI;
     #15#0 = #14#9;
     |LEE 001#15=;
     |SI FSalida ! 0; |DDEFECTO #15; |FINSI;
     |LIBERA #14;
     |LIBERA #15;
     |CIERRA #14;
     |CIERRA #15;
|FPRC;
