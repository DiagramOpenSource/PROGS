|FICHEROS;
     agist001 #0;   || Cabeceras Stock Inicial.
     agist002 #1;   || Lineas Stock Inicial.
     agifa142 #142;

     agifa321 #321; || Parametros divisas
     agifa324 #322; || Divisas
     dsm00087@;
|FIN;

|VARIABLES;
     aUsu = "";
     nContaLog = 0;
     aSer = "";
     aNum = "";
     aTipo = "";
     nTipo = 0;
     aSerie    = "";
     nConta    = 0;
     nModo     = 0;
     aAlfa     = "";
     nMod      = 0;
     &nDeci_Base = 0;
     &nDeci_PreBase = 0;
     &precio_base = 0;
|FIN;

|PROCESO Fecha; |TIO 7;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 1;
          |C_M #0#1, 1, "S";
     |SINO;
          |C_M #0#1, 1, "N";
     |FINSI;
|FPRC;

|PROCESO Contador; |TIPO 7;
     |ABRE #142; |LEE 000#142p; |CIERRA #142;

     nModo = (FEntrada / 100) ! 0;

     |SI nModo ! 1; |ACABA; |FINSI;
     aAlfa = Usuario % 810;
     #0#3 = aAlfa; |PINTA #0#3;

     aSerie = #0#2;
     #0#0 = 999999;
     |LEE 000#0];
     |SI FSalida = 0;
          |LEE 000#0a;
     |SINO;
          |LEE 000#0u;
     |FINSI;
     |SI FSalida = 0; |Y #0#2 = aSerie;
          nConta = #0#0 + 1;
     |SINO;
          nConta = 1;
     |FINSI;
     |DDEFECTO #0;
     #0#0 = nConta;
     #0#2 = aSerie;
|FPRC;

|PROCESO Tipo2Cab; |TIPO 2;
     |SI #0#4 = "S";
          |MENAV "0000Registro Actualizado...";
          |ERROR;
     |FINSI;
|FPRC;

|PROCESO Decimales; |TIPO 13;
     |ABRE #agifa324;
     |ABRE #agifa321;
     |LEE 001#agifa321.p;
     #agifa324#0 = #agifa321#9; ||Igualo a moneda base
     |LEE 001#agifa324.=;
     nDeci_Base = #agifa324#7;  ||Decimales moneda base
     nDeci_PreBase = #agifa324#9;  ||Decimales precio de moneda base
     |CIERRA #agifa321;
     |CIERRA #agifa324;
|FPRC;


|PROCESO T001_15; |TIPO 15;
     nTipo = 15; |HAZ Log001;
|FPRC;

|PROCESO T001_16; |TIPO 16;
     nTipo = 16; |HAZ Log001;
|FPRC;

|PROCESO T001_17; |TIPO 17;
     nTipo = 17; |HAZ Log001;
|FPRC;

|PROCESO Log001;
     |DDEF aAlfa;
     aAlfa = aAlfa + "dsm00087";
     |CARGA_DEF aAlfa, dsm00087@;
     |SI FSalida ! 0; |ACABA; |FINSI;

     aSer = #0#2;
     aNum = ("000000" + #0#0) % -106;
     aTipo = "SI";

     |ABRE #dsm00087@;
     |DDEFECTO #dsm00087@;
     |SELECT #2#dsm00087@;
     #dsm00087@#1 = aSer;
     #dsm00087@#2 = aNum;
     #dsm00087@#3 = aTipo;
     |LEE 101#dsm00087@.=;
     |SI FSalida ! 0;
          |SELECT #1#dsm00087@;
          |LEE 000#dsm00087@.u;
          |SI FSalida = 0;
               nContaLog = #dsm00087@#0 + 1;
          |SINO;
               nContaLog = 1;
          |FINSI;
          |DDEFECTO #dsm00087@;
          #dsm00087@#0 = nContaLog;
          #dsm00087@#1 = aSer;
          #dsm00087@#2 = aNum;
          #dsm00087@#3 = aTipo;
          |GRABA 020#dsm00087@.b;
     |FINSI;
     |SI FSalida = 0;
          |HORA aAlfa;
          aUsu = Usuario % 810;
          |SI nTipo = 15;
               #dsm00087@#4 = aUsu;
               #dsm00087@#5 = ~;
               #dsm00087@#6 = aAlfa;
               #dsm00087@#7 = "";
               #dsm00087@#8 = "01.01.0000";
               #dsm00087@#9 = ""
               #dsm00087@#10 = "";
               #dsm00087@#11 = "01.01.0000";
               #dsm00087@#12 = ""
          |FINSI;
          |SI nTipo = 16;
               #dsm00087@#7 = aUsu;
               #dsm00087@#8 = ~;
               #dsm00087@#9 = aAlfa;
          |FINSI;
          |SI nTipo = 17;
               #dsm00087@#10 = aUsu;
               #dsm00087@#11 = ~;
               #dsm00087@#12 = aAlfa;
          |FINSI;
          |GRABA 020#dsm00087@.a;
     |FINSI;
     |CIERRA #dsm00087@;
     |DESCARGA_DEF #dsm00087@;
|FPRC;
