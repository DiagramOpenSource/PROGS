|FICHEROS;
   iberz023 #0;

   iberw018 #1;
   iberw020 #2;

   iber0137 #10;
   agifa509 #11;
|FIN;

|VARIABLES;
   Handle  = 0;
   nCalc   = 0;
   nCalc1  = 0;
   nCalc2  = 0;
   nCentro = 0;
   nTotal  = 0;
   nDCaja  = 0;
   nHCaja  = 0;

   aAlfa  = "";
   aAlfa1 = "";
|FIN;

/*
|PROCESO Asientos1;
   |SI nCentro ! #iber0137#39;
      nCentro = #iber0137#39;
      FSalida = Handle; |FCIERRA FSalida;
      #iberw018#0 = #iber0137#39;
      |LEE 000#iberw018.=;
      |SI FSalida = 0;
         aAlfa = #iberw018#7; |QBF aAlfa; aAlfa = aAlfa + "c" + (("000" + nCentro) % -103) + "vtas.txt";
         aAlfa = "wb  " + aAlfa;
         |FABRE aAlfa;
         |SI FSalida ] 0;
            Handle = FSalida;
         |SINO;
            |MENAV "    No puedo generar el fichero ASCII";
            |ACABA;
         |FINSI;
      |FINSI;
   |FINSI;

   || Linea Cliente
   aAlfa = #iber0137#39; |QBF aAlfa; aAlfa = ("000" + aAlfa) % -103;
   aAlfa = Handle + " " + aAlfa + &9; |FGRABA aAlfa;
   aAlfa = #iber0137#1; aAlfa = Handle + " " + aAlfa + &9; |FGRABA aAlfa;
   aAlfa = #iberw018#2;  aAlfa = Handle + " " + aAlfa + &9; |FGRABA aAlfa;
   aAlfa = "D";         aAlfa = Handle + " " + aAlfa + &9; |FGRABA aAlfa;
   aAlfa = #iberw018#8; |QBF aAlfa; aAlfa = ("000" + aAlfa) % -103;
   aAlfa = Handle + " " + aAlfa + &9; |FGRABA aAlfa;
   aAlfa = #iberw018#9; aAlfa = Handle + " " + aAlfa + &9; |FGRABA aAlfa;
   nCalc = #iber0137#6; aAlfa = nCalc; |QBF aAlfa; |HAZ Formato;
   aAlfa = ("0000000000" + aAlfa) % -110;
   aAlfa = Handle + " " + aAlfa + &13 + &10; |FGRABA aAlfa;

   || Linea Iva
   aAlfa = #iber0137#39; |QBF aAlfa; aAlfa = ("000" + aAlfa) % -103;
   aAlfa = Handle + " " + aAlfa + &9; |FGRABA aAlfa;
   aAlfa = #iber0137#1;  aAlfa = Handle + " " + aAlfa + &9; |FGRABA aAlfa;
   aAlfa = #iberw018#5;  aAlfa = Handle + " " + aAlfa + &9; |FGRABA aAlfa;
   aAlfa = "H";          aAlfa = Handle + " " + aAlfa + &9; |FGRABA aAlfa;
   aAlfa = #iberw018#10; |QBF aAlfa; aAlfa = ("000" + aAlfa) % -103;
   aAlfa = Handle + " " + aAlfa + &9; |FGRABA aAlfa;
   aAlfa = #iberw018#11; aAlfa = Handle + " " + aAlfa + &9; |FGRABA aAlfa;
   nCalc = #iber0137#12 + #iber0137#18 + #iber0137#24 + #iber0137#30 + #iber0137#36;
   aAlfa = nCalc; |QBF aAlfa; |HAZ Formato;
   aAlfa = ("0000000000" + aAlfa) % -110;
   aAlfa = Handle + " " + aAlfa + &13 + &10; |FGRABA aAlfa;

   || Linea Recargo
   aAlfa = #iber0137#39; |QBF aAlfa; aAlfa = ("000" + aAlfa) % -103;
   aAlfa = Handle + " " + aAlfa + &9; |FGRABA aAlfa;
   aAlfa = #iber0137#1;  aAlfa = Handle + " " + aAlfa + &9; |FGRABA aAlfa;
   aAlfa = #iberw018#6;  aAlfa = Handle + " " + aAlfa + &9; |FGRABA aAlfa;
   aAlfa = "H";          aAlfa = Handle + " " + aAlfa + &9; |FGRABA aAlfa;
   aAlfa = #iberw018#12; |QBF aAlfa; aAlfa = ("000" + aAlfa) % -103;
   aAlfa = Handle + " " + aAlfa + &9; |FGRABA aAlfa;
   aAlfa = #iberw018#13; aAlfa = Handle + " " + aAlfa + &9; |FGRABA aAlfa;
   nCalc = #iber0137#13 + #iber0137#19 + #iber0137#25 + #iber0137#31 + #iber0137#37;
   aAlfa = nCalc; |QBF aAlfa; |HAZ Formato;
   aAlfa = ("0000000000" + aAlfa) % -110;
   aAlfa = Handle + " " + aAlfa + &13 + &10; |FGRABA aAlfa;

   || Linea Ventas
   aAlfa = #iber0137#39; |QBF aAlfa; aAlfa = ("000" + aAlfa) % -103;
   aAlfa = Handle + " " + aAlfa + &9; |FGRABA aAlfa;
   aAlfa = #iber0137#1;  aAlfa = Handle + " " + aAlfa + &9; |FGRABA aAlfa;
   aAlfa = #iberw018#4;  aAlfa = Handle + " " + aAlfa + &9; |FGRABA aAlfa;
   aAlfa = "H";          aAlfa = Handle + " " + aAlfa + &9; |FGRABA aAlfa;
   aAlfa = #iberw018#14; |QBF aAlfa; aAlfa = ("000" + aAlfa) % -103;
   aAlfa = Handle + " " + aAlfa + &9; |FGRABA aAlfa;
   aAlfa = #iberw018#15; aAlfa = Handle + " " + aAlfa + &9; |FGRABA aAlfa;
   nCalc = #iber0137#11 + #iber0137#17 + #iber0137#23 + #iber0137#29 + #iber0137#35;
   aAlfa = nCalc; |QBF aAlfa; |HAZ Formato;
   aAlfa = ("0000000000" + aAlfa) % -110;
   aAlfa = Handle + " " + aAlfa + &13 + &10; |FGRABA aAlfa;
|FPRC;
*/

|PROCESO Asientos1;
   |SI nCentro ! #iber0137#39;
      nCentro = #iber0137#39;
      FSalida = Handle; |FCIERRA FSalida;
      #iberw018#0 = #iber0137#39;
      |LEE 000#iberw018.=;
      |SI FSalida = 0;
         aAlfa = #iberw018#7; |QBF aAlfa; aAlfa = aAlfa + "c" + (("000" + nCentro) % -103) + "vtas.txt";
         aAlfa = "wb  " + aAlfa;
         |FABRE aAlfa;
         |SI FSalida ] 0;
            Handle = FSalida;
         |SINO;
            |MENAV "    No puedo generar el fichero ASCII";
            |ACABA;
         |FINSI;
      |FINSI;
   |FINSI;

   aAlfa = #iber0137#0 + #iber0137#2;
   aAlfa = Handle + " " + aAlfa; |FGRABA aAlfa;
   aAlfa = #iber0137#41; |QBF aAlfa; aAlfa = ("000000" + aAlfa) % -106;
   aAlfa = Handle + " " + aAlfa; |FGRABA aAlfa;
   aAlfa = #iber0137#1;  aAlfa = Handle + " " + aAlfa; |FGRABA aAlfa;
   aAlfa = "Desde " + #iber0137#4 + " hasta " + #iber0137#5;
   aAlfa = aAlfa + (" " * 30); aAlfa = aAlfa % 0130
   aAlfa = Handle + " " + aAlfa; |FGRABA aAlfa;
   aAlfa = #iber0137#2;  aAlfa = Handle + " " + aAlfa; |FGRABA aAlfa;
   aAlfa = #iber0137#40; aAlfa = Handle + " " + aAlfa; |FGRABA aAlfa;
   aAlfa = #iber0137#11; |QBF aAlfa; |HAZ Formato;
   aAlfa = ("000000000000000" + aAlfa) % -115;
   aAlfa = Handle + " " + aAlfa; |FGRABA aAlfa;
   aAlfa = #iber0137#17; |QBF aAlfa; |HAZ Formato;
   aAlfa = ("000000000000000" + aAlfa) % -115;
   aAlfa = Handle + " " + aAlfa; |FGRABA aAlfa;
   aAlfa = #iber0137#23; |QBF aAlfa; |HAZ Formato;
   aAlfa = ("000000000000000" + aAlfa) % -115;
   aAlfa = Handle + " " + aAlfa; |FGRABA aAlfa;
   aAlfa = #iber0137#8;  |QBF aAlfa; |HAZ Formato;
   aAlfa = ("00000" + aAlfa) % -105;
   aAlfa = Handle + " " + aAlfa; |FGRABA aAlfa;
   aAlfa = #iber0137#14; |QBF aAlfa; |HAZ Formato;
   aAlfa = ("00000" + aAlfa) % -105;
   aAlfa = Handle + " " + aAlfa; |FGRABA aAlfa;
   aAlfa = #iber0137#20; |QBF aAlfa; |HAZ Formato;
   aAlfa = ("00000" + aAlfa) % -105;
   aAlfa = Handle + " " + aAlfa; |FGRABA aAlfa;
   aAlfa = #iber0137#9;  |QBF aAlfa; |HAZ Formato;
   aAlfa = ("00000" + aAlfa) % -105;
   aAlfa = Handle + " " + aAlfa; |FGRABA aAlfa;
   aAlfa = #iber0137#15; |QBF aAlfa; |HAZ Formato;
   aAlfa = ("00000" + aAlfa) % -105;
   aAlfa = Handle + " " + aAlfa; |FGRABA aAlfa;
   aAlfa = #iber0137#21; |QBF aAlfa; |HAZ Formato;
   aAlfa = ("00000" + aAlfa) % -105;
   aAlfa = Handle + " " + aAlfa; |FGRABA aAlfa;
   aAlfa = #iber0137#12; |QBF aAlfa; |HAZ Formato;
   aAlfa = ("000000000000000" + aAlfa) % -115;
   aAlfa = Handle + " " + aAlfa; |FGRABA aAlfa;
   aAlfa = #iber0137#18; |QBF aAlfa; |HAZ Formato;
   aAlfa = ("000000000000000" + aAlfa) % -115;
   aAlfa = Handle + " " + aAlfa; |FGRABA aAlfa;
   aAlfa = #iber0137#24; |QBF aAlfa; |HAZ Formato;
   aAlfa = ("000000000000000" + aAlfa) % -115;
   aAlfa = Handle + " " + aAlfa; |FGRABA aAlfa;
   aAlfa = #iber0137#13; |QBF aAlfa; |HAZ Formato;
   aAlfa = ("000000000000000" + aAlfa) % -115;
   aAlfa = Handle + " " + aAlfa; |FGRABA aAlfa;
   aAlfa = #iber0137#19; |QBF aAlfa; |HAZ Formato;
   aAlfa = ("000000000000000" + aAlfa) % -115;
   aAlfa = Handle + " " + aAlfa; |FGRABA aAlfa;
   aAlfa = #iber0137#25; |QBF aAlfa; |HAZ Formato;
   aAlfa = ("000000000000000" + aAlfa) % -115;
   aAlfa = Handle + " " + aAlfa; |FGRABA aAlfa;
   aAlfa = #iber0137#6;  |QBF aAlfa; |HAZ Formato;
   aAlfa = ("000000000000000" + aAlfa) % -115;
   aAlfa = Handle + " " + aAlfa + &13 + &10; |FGRABA aAlfa;
|FPRC;

|DEFBUCLE Asientos1;
#iber0137#1;
39;
"     ",#iberz023#0," ",000,#iberz023#2;
"zzzzz",#iberz023#1,"z",999,#iberz023#3;
;
NULL,NULL,NULL,NULL,NULL,Asientos1;
#iber0137#39,#iber0137#1;
|FIN;

|PROCESO Asientos2;
   nCalc = (#agifa509#0 / 100) ! 0;
   |SI nCentro ! nCalc;
      nCentro = nCalc;
      FSalida = Handle; |FCIERRA FSalida;
      #iberw018#0 = nCentro;
      |LEE 000#iberw018.=;
      |SI FSalida = 0;
         aAlfa = #iberw018#7; |QBF aAlfa; aAlfa = aAlfa + "c" + (("000" + nCentro) % -103) + "res.txt";
         aAlfa = "wb  " + aAlfa;
         |FABRE aAlfa;
         |SI FSalida ] 0;
            Handle = FSalida;
         |SINO;
            |MENAV "    No puedo generar el fichero ASCII";
            |ACABA;
         |FINSI;
      |FINSI;
   |FINSI;

   #iberw020#0 = nCentro;
   #iberw020#1 = #agifa509#0;
   |LEE 000#iberw020.=;

   nTotal = 0;

   || Linea Tarjeta
   aAlfa = nCentro;      |QBF aAlfa; aAlfa = ("000" + aAlfa) % -103;
   aAlfa = Handle + " " + aAlfa + &9; |FGRABA aAlfa;
   aAlfa = #agifa509#1;  aAlfa = Handle + " " + aAlfa + &9; |FGRABA aAlfa;
   aAlfa = #iberw020#3;  aAlfa = Handle + " " + aAlfa + &9; |FGRABA aAlfa;
   aAlfa = "D";          aAlfa = Handle + " " + aAlfa + &9; |FGRABA aAlfa;
   aAlfa = #iberw018#16; |QBF aAlfa; aAlfa = ("000" + aAlfa) % -103;
   aAlfa = Handle + " " + aAlfa + &9; |FGRABA aAlfa;
   aAlfa = #iberw018#17; aAlfa = Handle + " " + aAlfa + &9; |FGRABA aAlfa;
   nCalc = #agifa509#53; aAlfa = nCalc; |QBF aAlfa; |HAZ Formato;
   aAlfa = ("0000000000" + aAlfa) % -110; nTotal = nTotal + nCalc;
   aAlfa = Handle + " " + aAlfa + &13 + &10; |FGRABA aAlfa;

   || Linea Cheques
   aAlfa = nCentro;      |QBF aAlfa; aAlfa = ("000" + aAlfa) % -103;
   aAlfa = Handle + " " + aAlfa + &9; |FGRABA aAlfa;
   aAlfa = #agifa509#1;  aAlfa = Handle + " " + aAlfa + &9; |FGRABA aAlfa;
   aAlfa = #iberw020#4;  aAlfa = Handle + " " + aAlfa + &9; |FGRABA aAlfa;
   aAlfa = "D";          aAlfa = Handle + " " + aAlfa + &9; |FGRABA aAlfa;
   aAlfa = #iberw018#18; |QBF aAlfa; aAlfa = ("000" + aAlfa) % -103;
   aAlfa = Handle + " " + aAlfa + &9; |FGRABA aAlfa;
   aAlfa = #iberw018#19; aAlfa = Handle + " " + aAlfa + &9; |FGRABA aAlfa;
   nCalc = #agifa509#54; aAlfa = nCalc; |QBF aAlfa; |HAZ Formato;
   aAlfa = ("0000000000" + aAlfa) % -110;
   nTotal = nTotal + nCalc;
   aAlfa = Handle + " " + aAlfa + &13 + &10; |FGRABA aAlfa;

   || Linea Cobros
   aAlfa = nCentro;      |QBF aAlfa; aAlfa = ("000" + aAlfa) % -103;
   aAlfa = Handle + " " + aAlfa + &9; |FGRABA aAlfa;
   aAlfa = #agifa509#1;  aAlfa = Handle + " " + aAlfa + &9; |FGRABA aAlfa;
   aAlfa = #iberw020#5;  aAlfa = Handle + " " + aAlfa + &9; |FGRABA aAlfa;
   aAlfa = "D";          aAlfa = Handle + " " + aAlfa + &9; |FGRABA aAlfa;
   aAlfa = #iberw018#20; |QBF aAlfa; aAlfa = ("000" + aAlfa) % -103;
   aAlfa = Handle + " " + aAlfa + &9; |FGRABA aAlfa;
   aAlfa = #iberw018#21; aAlfa = Handle + " " + aAlfa + &9; |FGRABA aAlfa;
   nCalc = #agifa509#4;  aAlfa = nCalc; |QBF aAlfa; |HAZ Formato;
   aAlfa = ("0000000000" + aAlfa) % -110; nTotal = nTotal + nCalc;
   aAlfa = Handle + " " + aAlfa + &13 + &10; |FGRABA aAlfa;

   || Linea efectivo
   aAlfa = nCentro;      |QBF aAlfa; aAlfa = ("000" + aAlfa) % -103;
   aAlfa = Handle + " " + aAlfa + &9; |FGRABA aAlfa;
   aAlfa = #agifa509#1;  aAlfa = Handle + " " + aAlfa + &9; |FGRABA aAlfa;
   aAlfa = #iberw020#6;  aAlfa = Handle + " " + aAlfa + &9; |FGRABA aAlfa;
   aAlfa = "D";          aAlfa = Handle + " " + aAlfa + &9; |FGRABA aAlfa;
   aAlfa = #iberw018#22; |QBF aAlfa; aAlfa = ("000" + aAlfa) % -103;
   aAlfa = Handle + " " + aAlfa + &9; |FGRABA aAlfa;
   aAlfa = #iberw018#23; aAlfa = Handle + " " + aAlfa + &9; |FGRABA aAlfa;
   nCalc = #agifa509#52 + #agifa509#5 - #agifa509#4; nTotal = nTotal + nCalc;
   aAlfa = nCalc; |QBF aAlfa; |HAZ Formato;
   aAlfa = ("0000000000" + aAlfa) % -110;
   aAlfa = Handle + " " + aAlfa + &13 + &10; |FGRABA aAlfa;

   || Linea Cliente
   aAlfa = nCentro;      |QBF aAlfa; aAlfa = ("000" + aAlfa) % -103;
   aAlfa = Handle + " " + aAlfa + &9; |FGRABA aAlfa;
   aAlfa = #agifa509#1;  aAlfa = Handle + " " + aAlfa + &9; |FGRABA aAlfa;
   aAlfa = #iberw018#2;  aAlfa = Handle + " " + aAlfa + &9; |FGRABA aAlfa;
   aAlfa = "H";          aAlfa = Handle + " " + aAlfa + &9; |FGRABA aAlfa;
   aAlfa = #iberw018#24; |QBF aAlfa; aAlfa = ("000" + aAlfa) % -103;
   aAlfa = Handle + " " + aAlfa + &9; |FGRABA aAlfa;
   aAlfa = #iberw018#25; aAlfa = Handle + " " + aAlfa + &9; |FGRABA aAlfa;
   nCalc = nTotal; aAlfa = nCalc; |QBF aAlfa; |HAZ Formato;
   aAlfa = ("0000000000" + aAlfa) % -110;
   aAlfa = Handle + " " + aAlfa + &13 + &10; |FGRABA aAlfa;

   || Linea Proveedores
   aAlfa = nCentro;      |QBF aAlfa; aAlfa = ("000" + aAlfa) % -103;
   aAlfa = Handle + " " + aAlfa + &9; |FGRABA aAlfa;
   aAlfa = #agifa509#1;  aAlfa = Handle + " " + aAlfa + &9; |FGRABA aAlfa;
   aAlfa = #iberw018#3;  aAlfa = Handle + " " + aAlfa + &9; |FGRABA aAlfa;
   aAlfa = "D";          aAlfa = Handle + " " + aAlfa + &9; |FGRABA aAlfa;
   aAlfa = #iberw018#26; |QBF aAlfa; aAlfa = ("000" + aAlfa) % -103;
   aAlfa = Handle + " " + aAlfa + &9; |FGRABA aAlfa;
   aAlfa = #iberw018#27; aAlfa = Handle + " " + aAlfa + &9; |FGRABA aAlfa;
   nCalc = #agifa509#5;  aAlfa = nCalc; |QBF aAlfa; |HAZ Formato;
   aAlfa = ("0000000000" + aAlfa) % -110;
   aAlfa = Handle + " " + aAlfa + &13 + &10; |FGRABA aAlfa;

   || Linea Caja
   aAlfa = nCentro;      |QBF aAlfa; aAlfa = ("000" + aAlfa) % -103;
   aAlfa = Handle + " " + aAlfa + &9; |FGRABA aAlfa;
   aAlfa = #agifa509#1;  aAlfa = Handle + " " + aAlfa + &9; |FGRABA aAlfa;
   aAlfa = #iberw020#2;  aAlfa = Handle + " " + aAlfa + &9; |FGRABA aAlfa;
   aAlfa = "H";          aAlfa = Handle + " " + aAlfa + &9; |FGRABA aAlfa;
   aAlfa = #iberw018#28; |QBF aAlfa; aAlfa = ("000" + aAlfa) % -103;
   aAlfa = Handle + " " + aAlfa + &9; |FGRABA aAlfa;
   aAlfa = #iberw018#29; aAlfa = Handle + " " + aAlfa + &9; |FGRABA aAlfa;
   nCalc = #agifa509#5;  aAlfa = nCalc; |QBF aAlfa; |HAZ Formato;
   aAlfa = ("0000000000" + aAlfa) % -110;
   aAlfa = Handle + " " + aAlfa + &13 + &10; |FGRABA aAlfa;

|FPRC;

|DEFBUCLE Asientos2;
#agifa509#1;
;
00000,nDCaja,#iberz023#0;
99999,nHCaja,#iberz023#1;
;
NULL,NULL,NULL,NULL,NULL,Asientos2;
#agifa509#0,#agifa509#1;
|FIN;

|PROGRAMA;
   |CLS;
   |CABEZA "Enlace contable a ficheros ASCII";
   |PINPA #0#0;
   |PINDA #0#0;
   |ENDATOS #1#0;
   |SI FSalida = 0;
      |ABRE #iberw018;   |ABRE #iberw020;
      nCentro = 0;
      |BUCLE Asientos1; FSalida = Handle; |FCIERRA FSalida;
      nDCaja = #iberz023#2 * 100;
      nHCaja = (#iberz023#3 * 100) + 99;
      nCentro = 0;
      |SI #iberz023#4 = "S";
         |BUCLE Asientos2;
      |FINSI;
      FSalida = Handle; |FCIERRA FSalida;
      |CIERRA #iberw018; |CIERRA #iberw020;
   |FINSI;
|FPRO;

|PROCESO Formato;
   nCalc1 = aAlfa;  nCalc2 = aAlfa;
   nCalc1 = nCalc1 ! 0;
   |SI nCalc1 = nCalc2; aAlfa = aAlfa + ".00"; |FINSI;

   aAlfa1 = aAlfa % -201;
   |SI aAlfa1 = ".";  aAlfa = aAlfa + "0"; |FINSI;
|FPRC;
