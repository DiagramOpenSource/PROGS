          ModiCliente

|FICHEROS;
     agifa134 #0;
     agifa059 #1;
     agis0002 #2;
     dsm00003 #3,MANTE;
     agifa010 #10;
     dsm00020 #20;
     agifa024 #24;
     agifa065 #65;
     agifa071 #71;
     agifa104 #104;
     dsm00153 #153;
     agifa324 #324;
     dscam003@;
     dscam044@;
     dscam045@;
|FIN;

|VARIABLES;
     nEmpresa = 0;
     aBase = "" ;
     aEmp = "";
     nHayCartera = 0;
     &enErr = 0;
     &enForma = 0;
     &enImpCliPen = 0;
     &eaCliente = "";
     &efFecha = @;
     &eaTag = "";
     &enSigno = 0;
     importe = 0;
     cant = 0;
     imneto = 0;
     aAlfa = "";
|FIN;

|PROCESO ReciEntra;
     #dscam003@#32 = #24#0;
     #dscam003@#5 = #24#16;
     #dscam003@#6 = #24#1;
     #dscam003@#8 = #24#32;
     #dscam003@#9 = #24#33;
     #dscam003@#10 = #24#31;
     #dscam003@#11 = #24#10;
     |GRABA 020#dscam003@.a;
|FPRC;

|DEFBUCLE ReciEntra;
     #dscam003@#12006;
     69;
     #10#52, #10#0, 01, "01.01.0000", "            ", "      ", "A";
     #10#52, #10#0, 99, "31.12.9999", "zzzzzzzzzzzz", "zzzzzz", "A";
     be;
     NULL, ReciEntra;
|FIN;

|PROCESO Dscam045;
     |SI #10#52 ] #dscam045@#4; |Y #10#52 [ #dscam045@#5;
          aEmp = ("00000" + #dscam045@#6) % -105;
          aAlfa = aBase + "dscarter/fich/" + aEmp + "/";
          |PATH_DAT #dscam003@#aAlfa#;
          #dscam044@#0 = #dscam045@#0;
          |LEE 020#dscam044@.=;
          |SI FSalida = 0;
               |BUCLE ReciEntra;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE Dscam045;
     #dscam045@#1002;
     2;
     nEmpresa, 001, "V";
     nEmpresa, 999, "V";
     ;
     NULL, Dscam045;
|FIN;

|PROCESO EntregasA;
     #2#2 = #24#0;
     #2#3 = #24#1;
     #2#4 = #24#29;
     #2#12 = #24#16;
     |GRABA 020#2a;
     |SI nHayCartera = 1;
          |DFICE aAlfa;
          aAlfa = aAlfa % -205; nEmpresa = aAlfa;
          |ABRE #dscam044@;
          |BUCLE Dscam045;
          |CIERRA #dscam044@;
     |FINSI;
|FPRC;

|DEFBUCLE EntregasA;
     #2#1;
     ;
     "A", #10#52, #10#0, 01;
     "A", #10#52, #10#0, 99;
     be;
     NULL, EntregasA;
|FIN;

|PROCESO DatosCli;
     |DDEFECTO #24;
     #24#0 = #10#3;
     |LEE 000#24=;

     |DDEFECTO #3;
     #3#0 = #10#3;
     #3#1 = #10#84;
     |LEE 0000#3=;

     |DDEFECTO #20;
     #20#0 = #24#202;
     |LEE 000#20=;

     #10#4 = #24#2;
     #10#5 = #24#37;
     #10#7 = #24#38;
     #10#8 = #24#20;
     #10#9 = #20#1;
     #10#32 = #24#156;
     #10#35 = #24#4;
     #10#36 = #24#47;
     #10#40 = #24#41;
     #10#50 = #24#40;
     #10#64 = #24#208;
     #10#68 = #24#192;
     #10#70 = #24#193;
     #10#88 = #20#0;
     #10#91 = #24#206;

     |DDEFECTO #324;
     #324#0 = #10#68;
     |LEE 000#324=;

     #10#69 = #324#2;
     #10#70 = #24#193;

     #10#29 = #3#10;
     #10#30 = #3#2;
     #10#31 = #3#3;
     #10#33 = #3#7;
     #10#62 = #3#6;
     |SI #3#14 = "  ";
          #10#6 = #24#25;
     |SINO;
          #10#6 = #3#14;
     |FINSI;
     #10#63 = #24#15;


     #0#7 = #24#25;
     #0#11 = #24#20;
|FPRC;

|PROCESO ActuaCli;
     |SI #10#15 ] 0;
          importe = 1;
     |SINO;
          importe = -1;
          #10#15 = -#10#15;
     |FINSI;
     cant = #10#15 < #10#5;
     cant = cant < #10#32;
     cant = cant < #10#7;
     cant = cant * importe;
     #10#15 = #10#15 * importe;

     #24#0 = #10#3;
     |LEE 121#24=;
     |SI FSalida = 0;
          imneto = (#0#18 - #0#17);
          #24#46 = imneto;
          #24#45 = #0#1;
          |SI #10#43 = AN;
               #24#50 = #24#50 + (cant * enForma);
          |SINO;
               #24#50 = #24#50 - (cant * enForma);
          |FINSI;
          |GRABA 020#24a;
          |LIBERA #24;
     |FINSI;

     |SI #10#43 = "N";
          enImpCliPen = cant * enForma;
     |SINO;
          enImpCliPen =  -cant * enForma;
     |FINSI;
     eaCliente = #10#3;
     efFecha = #10#1;
     |HAZ AcumulaCli;

     enSigno = enForma;

     eaTag = "AV";  |HAZ Riesgos;
|FPRC;

|PROCESO Lineas010;
     #71#15 = #10#3;
     |GRABA 020#71a;
     |LIBERA #71;

     #65#0 = #71#2;
     #65#1 = #10#1;
     |SI #10#43 = "N";
          #65#2 = "AV";
     |SINO;
          #65#2 = "BV";
     |FINSI;
     #65#3 = #71#0;
     #65#4 = #71#1;
     #65#11 = #71#29;
     |LEE 121#65=;
     |SI FSalida = 0;
          #65#10 = #10#3;

          ||GRABA 020#65a;    modificado para inforpor
          |BORRA 020#65a;
          |GRABA 020#65n;
          |LIBERA #65;
     |FINSI;

     #104#25 = #71#31;
     #104#0 = #71#12;
     |LEE 101#104=;
     |SI FSalida = 0;
          #104#7 = #10#6; || Repre
          #104#9 = #10#8; || FP
          |GRABA 020#104a;
          |LIBERA #104;
     |FINSI;
|FPRC;

|PROCESO Lineas134;
     #10#52 = #1#15;
     #10#0 = #1#2;
     |LEE 121#10=;
     |SI FSalida = 0;
          enForma = -1; |HAZ ActuaCli;

          #10#3 = #0#2;
          |HAZ DatosCli;
          |GRABA 020#10a;

          |BUCLELIN 0 Lineas010 #10;

          enForma = 1; |HAZ ActuaCli;

          |HAZ LimCabAgifa010;
          |BUCLELIN 0 CalCabAgifa010_2 #10;
          |GRABA 020#10a;
          |LIBERA #10;

          |BUCLE EntregasA;
     |FINSI;
|FPRC;

|PROCESO ModiCliente;
     nHayCartera = 0;
     |DBASS aBase;
     aAlfa = aBase + "dscarter/def/dscam045";
     |CARGA_DEF aAlfa, dscam045@;
     |SI FSalida = 0;
          aAlfa = aBase + "dscarter/def/dscam044";
          |CARGA_DEF aAlfa, dscam044@;
          |SI FSalida = 0;
               aAlfa = aBase + "dscarter/def/dscam003";
               |CARGA_DEF aAlfa, dscam003@;
               |SI FSalida = 0;
                    nHayCartera = 1;
                    aAlfa = aBase + "dscarter/fich/";
                    |PATH_DAT #dscam044@#aAlfa#;
                    |PATH_DAT #dscam045@#aAlfa#;
               |FINSI;
          |FINSI;
     |FINSI;
     |ABRE #3;
     |ABRE #10;
     |ABRE #20;
     |ABRE #24;
     |ABRE #65;
     |ABRE #71;
     |ABRE #324;
     |BUCLELIN 0 Lineas134 #0;
     |HAZ CalCabAgifa134;
     |PINDA #0#0;
     |CIERRA #324;
     |CIERRA #71;
     |CIERRA #65;
     |CIERRA #24;
     |CIERRA #20;
     |CIERRA #10;
     |CIERRA #3;
     |SI nHayCartera = 1;
          |DESCARGA_DEF #dscam003@;
          |DESCARGA_DEF #dscam044@;
          |DESCARGA_DEF #dscam045@;
     |FINSI;
|FPRC;

|PROCESO CheqRecticativa;
     enErr = 0;
     |ABRE #153;
     #153#0 = "V";
     #153#1 = #0#49;
     #153#2 = #0#0;
     |LEE 000#153=;
     |SI FSalida = 0;
          aAlfa = "0000Factura con factura rectificativa:" +&13+ #153#6 + "/" + (("000000" + #153#0)%-106) + "...";
          |MENAV aAlfa;
          enErr = 1;
     |FINSI;
     |CIERRA #153;
|FPRC;

|PROCESO BorraRecticativa;
     |ABRE #153;
     |SELECT #2#153;
     #153#0 = "V";
     #153#6 = #0#49;
     #153#7 = #0#0;
     |LEE 101#153=;
     |SI FSalida = 0;
          |BORRA 020#153a;
     |FINSI;
     |CIERRA #153;
|FPRC;
