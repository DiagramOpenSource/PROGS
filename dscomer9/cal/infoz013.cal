|FICHEROS;
     infoz013 #0;
     agifa067 #4
     dsm00024 #24;
     agifa019 #53;  ||Articulos
     agifa017 #54;  ||Almacenes
     agifa081 #81;
     dsm00065 #965;
|FIN;

|VARIABLES;
     articul = "";
     almacen = 0;
     canti = 0;
     nCanti2 = 0;
     aParti = "";
     nHayArti = 0;
     nHayAlma = 0;
     nHayParti = 0;
|FIN;

|CAMPOS;
     #53#180 PARTI;
     #53#16  art_prec;  #54#43  alm_prec;
     #53#183 art_prec2; #54#45  alm_prec2;
     #24#18  par_prec2; #24#19  par_prec;
|FIN;

|PROCESO dsm00065;
     articul = #965#3;
     almacen = #965#4;
     canti   = #4#5 - #4#38;
     canti = canti * #965#5;

     |HAZ LeeArti;
     |HAZ LeeAlma;

     art_prec = art_prec + canti;

     alm_prec = alm_prec + canti;

     |HAZ ValoraStock;

     |SI nHayArti = 0; |GRABA 020#53a; |FINSI;
     |SI nHayAlma = 0; |GRABA 020#54a; |FINSI;
     |LIBERA #53;
     |LIBERA #54;
|FPRC;

|DEFBUCLE dsm00065;
     #965#1;
     3;
     #4#28, #4#0, #4#1, 001, #0#2;
     #4#28, #4#0, #4#1, 999, #0#3;
     ;
     NULL, dsm00065;
|FIN;

|PROCESO pedicom;
     |SI #4#2 ] #0#2; |Y #4#2 [ #0#3;
          articul = #4#2;
          almacen = #4#3;
          aParti = #4#42;
          canti   = #4#5 - #4#38;
          nCanti2 = #4#41 - #4#46;

          |HAZ LeeArti;
          |HAZ LeeAlma;
          |HAZ LeeParti;

          art_prec = art_prec + canti;
          art_prec2 = art_prec2 + nCanti2;

          alm_prec = alm_prec + canti;
          alm_prec2 = alm_prec2 + nCanti2;

          par_prec = par_prec + canti;
          par_prec2 = par_prec2 + nCanti2;

          |HAZ ValoraStock;

          |SI nHayArti = 0; |GRABA 020#53a; |FINSI;
          |SI nHayAlma = 0; |GRABA 020#54a; |FINSI;
          |SI nHayParti = 0; |Y PARTI = "S"; |GRABA 020#24a; |FINSI;
          |LIBERA #24;
          |LIBERA #53;
          |LIBERA #54;

          |BUCLE dsm00065;
     |FINSI;
|FPRC;

|DEFBUCLE pedicom;
     #81#1;
     1;
     "     ", 000001, #0#0;
     "zzzzz", 999999, #0#1;
     ;
     NULL, NULL, pedicom;
|FIN;

--------------------------------------------------
|PROCESO LeeParti;
     |SI PARTI = "N"; |ACABA; |FINSI;

     #24#0 = articul;
     #24#1 = almacen;
     #24#2 = aParti;
     |LEE 101#24=;
     nHayParti = FSalida;
|FPRC;

|PROCESO LeeAlma;
     #54#0 = articul;
     #54#1 = almacen;
     |LEE 101#54=;
     nHayAlma = FSalida;
|FPRC;

|PROCESO LeeArti;
     #53#0 = articul;
     |LEE 101#53=;
     nHayArti = FSalida;
|FPRC;
--------------------------------------------------
|PROCESO AceraArti;
     art_prec = 0;
     art_prec2 = 0;
     |GRABA 020#53a;
|FPRC;

|DEFBUCLE AceraArti;
     #53#1;
     ;
     #0#2;
     #0#3;
     be;
     NULL, AceraArti;
|FIN;

|PROCESO AceraAlma;
     alm_prec = 0;
     alm_prec2 = 0;
     |GRABA 020#54a;
|FPRC;

|DEFBUCLE AceraAlma;
     #54#1;
     ;
     #0#2, 00001;
     #0#3, 9999;
     be;
     NULL, AceraAlma;
|FIN;

|PROCESO AceraParti;
     par_prec = 0;
     par_prec2 = 0;
     |GRABA 020#24a;
|FPRC;

|DEFBUCLE AceraParti;
     #24#1;
     ;
     #0#2, 00001, "                              ";
     #0#3, 99999, "zzzzzzzzzzzzzzzzzzzzzzzzzzzzzz";
     be;
     NULL, AceraParti;
|FIN;

|PROCESO T3; |TIPO 3;
     |BUCLE AceraArti;
     |BUCLE AceraAlma;
     |BUCLE AceraParti;

     |ABRE #53;
     |ABRE #54;
     |ABRE #24;
     |BUCLE pedicom;
     |CIERRA #24;
     |CIERRA #54;
     |CIERRA #53;
|FPRC;
