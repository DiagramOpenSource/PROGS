|FICHEROS;
     agifa071 #0;   || Lineas de albaran/abono
     agifa010 #1;   || Albaranes
     agifa019 #2;   || Articulos
     diefaw16 #3;   || Pantalla de adjudicacion
     agifa027 #4;
     agifa024 #6;   || Clientes
     agifa017 #8;   || Stocks almacenes
     agifa104 #9;   || Pedidos
     agifa073 #10;  || Lineas de Pedidos
     agifa007 #21;  || Series.
     agifa142 #97;  || Parametros generales.
     tmp00010 #100; || Temporal albaranes(C).
     tmp00071 #101; || Temporal albaranes(L).
     agifa321 #35;  || Parametros de Divisas
     agifa328 #36;  || Clientes/Divisas
     agifa329 #37;  || Lineas de Clientes/Divisas
     agifa324 #38;  || Divisas
     dsm00005 #905;
     dsm00046 #946;
     dsm00047 #947;
     dsm00114 #114;

     dsm00020 #20;
     diefa007 #7;
|FIN;

|VARIABLES;
      nFactor = 0;
      nNum1 = 0;
      nNum2 = 0;
      &nPed_baja  = 0;
      &aSer_baja  = "";
      &nLin_baja  = 0;
     nUniOrg = 0;
     nLinV           = 0;
     &eaSer1         = "";
     &enDocu1        = 0;
     nLinea          = 0;
     &Tempo          = "";
     &aTempo300      = "";
     nSal            = 0;
     canmar          = 0;
     swparrilla      = 0;
     nCalc           = 0;
     nVic            = 0;
     nVic2           = 0;
     aFich           = "";
     aParam          = "";
     &nRieTotal      = 0;
     &nRieUtili      = 0;
     &aRieBloqu      = "";
     &aBloquead      = "";
     &eaTag          = "";
     &nImpo          = 0;
     nMult           = 0;
     &enSwMenu       = 0;
     &enConta        = 0;
     aExporNegro     = 0;
     nNume           = 0;
     imneto          = 0;
     margen          = 0;

     &enCodAlbNegro  = 0;

     aSerAlbBlanco   = "";
     nCodAlbBlanco   = 0;
     nCodAlb         = 0;
     nPorce          = 0;
     nPorceT         = 0;
     nCanti          = 0;
     nCanti2         = 0;
     nAcumula        = 0;
     nReparto        = 0;
     nEntero         = 0;
     nTotalBlanco    = 0;
     nTotalNegro     = 0;
     nTCantiBlanco   = 0;
     nCantiBlanco    = 0;
     nCantiBlanco2   = 0;
     nMasMenos       = 0;
     aAlfa           = "";
     aAlfa1          = "";
     aAlfa2          = "";

     &nDeci_Base     = 0;   || Decimales en Totales de la moneda base
     &nDeci_PreBase  = 0;   || Decimales en el Precio en moneda base
     &nDeci_BaseMx   = 0;   || Decimales en Totales de la moneda base (Maxima precision)
     &nDeci_PreBaseMx= 0;   || Decimales en el Precio en moneda base (Maxima precision)
     &nDeci_Div      = 0;   || Decimales en Totales de la divisa
     &nDeci_PreDiv   = 0;   || Decimales en el Precio en divisa
     &nDeci_TotVis   = 0;   || Decimales en Totales visibles (el de la moneda de trabajo)
     &nDeci_TotNoVis = 0;   || Decimales en Totales no visibles (el de la otra moneda)
     &nDeci_PreVis   = 0;   || Decimales en el Precio visual. (lineas)
     &nDeci_ImpVis   = 0;   || Decimales en el Importe visual. (lineas)
     &nDeci_BaseMxP  = 0;   || Decimales en Totales de la moneda base (Maxima precision)
     &nDeci_PreBasMxP= 0;   || Decimales en el Precio en moneda base (Maxima precision)
     &nDeci_DivP     = 0;   || Decimales en Totales de la divisa
     &nDeci_PreDivP  = 0;   || Decimales en el Precio en divisa
     &nDeci_TotVisP  = 0;   || Decimales en Totales visibles (el de la moneda de trabajo)
     &nDeci_TotNoVisP= 0;   || Decimales en Totales no visibles (el de la otra moneda)
     &nDeci_PreVisP  = 0;   || Decimales en el Precio visual. (lineas)
     &nDeci_ImpVisP  = 0;   || Decimales en el Importe visual. (lineas)
     nfecha    = 0;
     &ac_divisa = "N";   || Vale "S" cuando las divisas en ventas estan
                         || activadas y la serie es de divisas
     &pintado = 0;       || Sirve para controlar los pintados de las lineas
     &decim_divisa = 0;  || Decimales de la divisa
     &precio_divisa = 0; || Decimales del precio en divisa
     &decim_base = 0;    || Decimales de la moneda base
     &precio_base = 0;   || Decimales del precio en moneda base
     div_act = 0;        || Divisa actualizada. Me sirve en un PARA para que
                         || no salga hasta que este actualizada (div_act=1)
     &cli_divisa = "";   || Codigo de Cliente. Se pasa a CLIENTES/DIVISAS
     &divisa = "";       || Codigo de Divisa. Se pasa a ACTUAL. de DIVISAS
     nModo210 = 0;
     seriei_a       = "";
     seriei_b       = "";
     seriet         = "";
     asto           = 0;
     totalba        = 0;
     cantidad       = 0;
     minimo         = 0;
     almacen        = 0;
     mensajeri = "0000Se supera el Riesgo Limite del cliente";
     modo           = 0;
     tf             = 0;
     fmes           = "  ";
     mes            = 0;
     hacer          = 0;
     fiac           = "  ";
     linea          = 1;
     i              = 0;
     entro          = 0;
     clave          = "valbaran";
     ncontador      = 0;
     entrar         = 0;
     mascara        = "0000000";
     tempo          = " ";
     filtro         = "-106";
     codigo         = "  ";
     r1             = "  ";
     f1             = "  ";
     totbu          = 0;
     cant           = 0;
     sw             = 0;
     fecent         = @;
     fecped         = @;
     a              = 0;
     b              = 0;
     operainte      = "";
     origen         = "";
     destino        = "";
     conta_a        = "";
     conta_b        = "";
     empresa        = "";
     ind            = 0;
     alfa           = "";
     precio         = 0;
     neto           = 0;
     iva            = 0;
     fp             = "";
     sblanco        = "";
     swd            = 0;
     ser_ant        = "";
     num_ant        = "";
     serie          = "";
     numero         = "";
     importe        = 0;
     importeD       = 0;
     fFecha = @;
     aFecha = "";
     aAny = "";
     nImpDiv        = 0;
|FIN;

|INCLUYE i_varart;

|PROCESO Desprecia;
     |GRABA 020#9a;
     |GRABA 020#10a;
     |LIBERA #9;
     |LIBERA #10;
     aSer_baja = #10#28;
     nPed_baja = #10#0;
     nLin_baja = #10#1;
     |SUB_EJECUTA_NP "dsz00006";
|FPRC;

|PROCESO Faltas;
     |ABRE #7;
     #7#0 = #10#28;
     #7#1 = #10#0;
     #7#2 = #10#1;
     #7#3 = #3#54;
     #7#4 = #10#2;
     #7#5 = #10#20;
     #7#6 = nUniOrg;
     #7#7 = #0#5;
     #7#8 = #7#6 - #7#7;
     #7#9 = #10#6;
     #7#10 = #10#8;
     #7#11 = #10#29;
     #7#12 = #10#53; ||Tarifa = Interno
     #7#13 = "N";
     #7#14 = #9#7;
     #7#15 = "P";
     #7#16 = #3#53;
     |GRABA 020#7n;
     |CIERRA #7;
|FPRC;

|PROCESO Cero;
     entro = 0;
|FPRC;

|PROCESO clicon;
     |SI #10#43 = #10#5;  |ACABA;  |FINSI;

     #9#25 = #10#28;
     #9#0 = #10#0;
     |LEE 000#9=;

     swparrilla = 0;
     |HAZ parrilla;
     |SI swparrilla = 0; |ERROR; |ACABA; |FINSI;

     |SI #6#0 ! #10#20;     || #clientes#codigo ! #lineas de pedido#cliente
         |ABRE #6;          || Fichero clientes
         #6#0 = #10#20;     || cargo clave
         |LEE 021#6=;
         |CIERRA #6;
     |FINSI;

     ||---Comprobacion Zona.
     |SI #6#3 < #3#47; |O #6#3 > #3#48; |ERROR; |ACABA; |FINSI;
     ||컴횯ir Entrega
     |SI #9#57 < #3#49; |O #9#57 > #3#50; |ERROR; |ACABA; |FINSI;
     ||컴횫gencia
     |SI #9#60 < #3#51; |O #9#60 > #3#52; |ERROR; |ACABA; |FINSI;

     ||컴컴컴컴컴컴컴컴컴컴컴컴컴 Control Riesgo Cliente.
     eaTag = "PE"; |HAZ SacaRiesgo;

     |SI #agifa142#6 = "S";
          |SI nRieUtili ] nRieTotal;  |Y nRieTotal ! 0;
               mensajeri = "0000Riesgo Limite superado del cliente [" + #6#0 + "] ...";
               |MENSA mensajeri;
               |SI #agifa142#22 = "S";|O #agifa142#22 = "P";
                    |AVISO;
                    |BLIN 4;
                    |SI #agifa142#22 = "P";   || Avisa y para
                         |ERROR;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
     |SI aRieBloqu = "S";
          aAlfa = "    Riesgo Bloqueado. Referencia : " + aBloquead;
          |MENAV aAlfa;
          |ERROR;
     |FINSI;
|FPRC;

|PROCESO actpf;|TIPO 0;
     cant = #1#15 < #1#5;
     cant = cant < #1#32;
     cant = cant < #1#7;
     |ABRE #6;
     #6#0 = #1#3;
     |LEE 121#6=;
     |SI FSalida = 0;
         #6#50 = #6#50 + cant;
         |GRABA 020#6a;
         |LIBERA #6;
     |FINSI;
     |CIERRA #6;

     enImpCliPen = cant;
     eaCliente = #1#3;
     efFecha = #1#1;
     |HAZ AcumulaCli;
|FPRC;

|PROCESO finadju;|TIPO 0;
     |SI entro ! 0;
         |HAZ actpf;
         |HAZ grabaalba;
         |LIBERA #9;
     |FINSI;
|FPRC;

|PROCESO tot_ped_div;
     |SI #9#37 = "B";  || Asigna campos visual. y no visual. en el pedido segun la moneda de trabajo
         #9#45 = #9#11;
         #9#46 = #9#12;
         #9#47 = #9#13;
         #9#48 = #9#42;
         #9#50 = #9#43;
         #9#49 = #9#44;
     |SINO;
         #9#45 = #9#42;
         #9#46 = #9#43;
         #9#47 = #9#44;
         #9#48 = #9#11;
         #9#50 = #9#12;
         #9#49 = #9#13;
     |FINSI;
|FPRC;

|PROCESO grabaalba;|TIPO 0;
     |PATH_DAT #1 origen;
     |HAZ tot_ped_div;
     #1#83 = #3#53; ||Curso
     #1#57 = #3#54; || Obs3 = F.Reparto
     |GRABA 020#1a;
     |LIBERA #1;

     ||컴컴컴컴컴컴Automatizacion Empresas
     |ABRE #dsm00114; |LEE 000#dsm00114.p; nSal = FSalida; |CIERRA #dsm00114;
     |SI nSal = 0;
          eaCli = #1#3;
          aAlfa = "dsz99983;ALBALTA" + #1#52 + (("000000" + #1#0) % -106);
          |SUB_EJECUTA aAlfa;
     |FINSI;
     ||컴컴컴컴컴컴컴컴컴컴횺odulo 001172
     |HAZ EsDiexpa;
     |SI FSalida = 0;
          |HAZ AcuPromoDiexpa;
     |FINSI;
     ||컴컴컴컴컴컴컴컴컴컴
     |SI #1#85 = "E";
         |HAZ DesgloNegro;
     |FINSI;
|FPRC;

|PROCESO LeeMonBase4; ||Lee los parametros de la moneda base
     |ABRE #agifa321;
     |ABRE #agifa324;
     |LEE 010#agifa321.p;   ||Leo parametros de divisa
     #agifa010#73 = #agifa321#9;  ||Cojo la Moneda Base de parametros
     #agifa324#0 = #agifa321#9;
     |LEE 010#agifa324.=;         ||Leo la ficha de la moneda base en Divisas
     #agifa010#74 = #agifa324#2;  ||Asigno el cambio de la moneda base con el euro
     decim_base = #agifa324#7;    ||Asigno los decimales de la moneda base
     precio_base = #agifa324#9;   ||Asigno los decimales del precio en la mon. base
     |CIERRA #agifa324;
     |CIERRA #agifa321;
|FPRC;

|PROCESO Param_Divisas4; |TIPO 0;
     |ABRE #agifa324;
     #agifa324#0 = #agifa010#68;
     |LEE 001#agifa324.=;   || Leo la divisa
     |CIERRA #agifa324;

     decim_divisa = #agifa324#7;  || Decimales de la divisa
     precio_divisa = #agifa324#9;  || Decimales en el precio de la divisa
     nDeci_Div = decim_divisa;   || Decimales de la divisa
     nDeci_PreDiv = precio_divisa;  || Decimales en el precio de la divisa
     nDeci_DivP = decim_divisa;   || Decimales de la divisa
     nDeci_PreDivP = precio_divisa;  || Decimales en el precio de la divisa
     |SI #1#70 = "B";   || Si trabajo con la moneda base ...
         nDeci_Base     = decim_base;
         nDeci_PreBase  = precio_base;
         nDeci_PreVis   = precio_divisa;
         nDeci_ImpVis   = decim_divisa;
         nDeci_BaseMx   = decim_base;
         nDeci_PreBaseMx= precio_base;
         nDeci_TotVis   = decim_base;
         nDeci_TotNoVis = decim_divisa;
         nDeci_PreVisP  = precio_divisa;
         nDeci_ImpVisP  = decim_divisa;
         nDeci_BaseMxP  = decim_base;
         nDeci_PreBasMxP= precio_base;
         nDeci_TotVisP  = decim_base;
         nDeci_TotNoVisP= decim_divisa;
     |SINO;     || Si trabajo con la divisa ...
         nDeci_Base     = decim_base; || Max. precision en los decimales de la moneda base
         nDeci_PreBase  = precio_base;  || Max. precision en los dec. del precio de la moneda base
         nDeci_PreVis   = precio_base;
         nDeci_ImpVis   = decim_base;
         |SI #1#69 = 1;
              nDeci_BaseMx    = decim_base;    || sin triangulacion
              nDeci_PreBaseMx = precio_base;
         |SINO;
              nDeci_BaseMx    = #agifa321#10;  || con triangulacion
              nDeci_PreBaseMx = #agifa321#11;
         |FINSI;
         nDeci_TotVis   = decim_divisa;
         nDeci_TotNoVis = decim_base;
         nDeci_PreVisP  = precio_base;
         nDeci_ImpVisP  = decim_base;
         |SI #1#69 = 1;
              nDeci_BaseMxP   = decim_base;    || sin triangulacion
              nDeci_PreBasMxP = precio_base;
         |SINO;
              nDeci_BaseMxP   = #agifa321#10;  || con triangulacion
              nDeci_PreBasMxP = #agifa321#11;
         |FINSI;
         nDeci_TotVisP  = decim_divisa;
         nDeci_TotNoVisP= decim_base;
     |FINSI;
     |HAZ Deci_IVA;
|FPRC;

|PROCESO CambioDivisa4; |TIPO 0;
     |SI #agifa024#191 = "S"; || Si el cliente es de divisa pactada
         |ABRE #agifa328;
         |ABRE #agifa329;
         #agifa329#0 = #agifa010#3;
         #agifa329#2 = #agifa010#68;
         #agifa329#7 = "N";
         |SELECT #2#agifa329;  || Con esta clave ...
         |LEE 011#agifa329.=;  || ... busco periodos no finalizados de esa divisa
         |SI FSalida = 0;  || Si existe un periodo no finalizado
            |PARA div_act = 0; |SI div_act = 0; |HACIENDO;
                  #agifa010#69 = #agifa329#3;        || ...y el cambio
                  |LEE 001#agifa329.=;   || Leo las lineas de Clientes/Divisas
                  nfecha = #agifa010#1 - #agifa329#6;  || Resto la fecha de fin de periodo a la actual
                  |SI nfecha > 0;  || Si la fecha actual supera a la del periodo asignado ...
                      |MENAV "0000ATENCION deberia Actualizar primero la divisa en Clientes/Divisas";
                      cli_divisa = #agifa010#3;  || Le envio el cod. de cliente a "agifa328"
                      |SUB_EJECUTA_NP "agifa328.tab";  || Ejecuto Clientess/Divisas
                      |ERROR;
                  |SINO;
                      div_act = 1;  || Para salir del PARA
                  |FINSI;
            |SIGUE;
        |SINO;  || Si no existe un periodo no finalizado para esa divisa
           |MENAV "0000No existe un periodo activo para la divisa en Clientes / Divisas";
           cli_divisa = #agifa010#3;  || Le paso a "agifa328" el cliente
           |SUB_EJECUTA_NP "agifa328.tab";  || Ejecuto Clientes / Divisas
           |ERROR;
        |FINSI;
        |SELECT #1#agifa329;
        |CIERRA #agifa329;
        |CIERRA #agifa328;
     |SINO; || Si el Cliente no es de Divisa pactada ...
        |ABRE #agifa324; || ...miro directamente en divisas
        #agifa324#0 = #agifa010#68;
        |LEE 001#agifa324.=;
        |SI FSalida = 0; ||Si existe la divisa...
            #agifa010#69 = #agifa324#2; || la recojo
            |SI #agifa324#5 ! -1; || Si los dias de margen de actualizacion no
                               || son = -1 (indefinidos)
               |PARA div_act = 0; |SI div_act = 0; |HACIENDO;
                     #agifa010#69 = #agifa324#2;        ||Cargo el valor del cambio
                     |LEE 001#agifa324.=;  || Leo la divisa
                     nfecha = #agifa010#1 - #agifa324#4;
                     |SI nfecha > #agifa324#5; |Y #agifa324#5 ! -1;  || Si la fecha actual
                         |MENAV "0000ATENCION deberia Actualizar primero la divisa";
                         divisa = #agifa010#68;
                         |SUB_EJECUTA_NP "agifa326.tab";
                         |ERROR;
                     |SINO;
                         div_act = 1;
                     |FINSI;
               |SIGUE;
            |FINSI;
        |FINSI;
        |CIERRA #agifa324;
     |FINSI;
     |HAZ Param_Divisas4;
|FPRC;

|PROCESO contador;|TIPO 0;
     |DFICE origen;                || ME ASEGURO QUE TIENE EL PATH CORRECTO.
     |PATH_DAT #4 origen;          || CAMINO DE LA EMPRESA DE TRABAJO.

     |SI #3#9 = "*****";
         eaSerie = #10#28;
     |SINO;
         eaSerie = #3#9;
     |FINSI;
     enSwMenu = 1;
     |HAZ ContaADJ;
     codigo = enCodigo;
|FPRC;

|PROCESO creacabe;|TIPO 0;
     alfa = #1#0;
     |QBF alfa;
     |DDEFECTO #1;
     #1#4  = #9#8;
     #1#3  = #9#4;
     #1#5  = #9#5;
     #1#7  = #9#6;
     #1#32 = #9#17;
     #1#6  = #9#7;
     #1#8  = #9#9;
     #1#35 = #9#18;
     #1#31 = #9#20;
     #1#33 = #9#21;
     #1#36 = #9#22;
     #1#40 = #9#23;
     #1#34 = #9#16;
     #1#29 = #9#19;
     #1#30 = #9#14;
     #1#55 = #9#53;
     #1#56 = #9#54;
     #1#57 = #9#55;
     #1#64 = #9#61;
     #1#68 = #9#35; ||DIVISA
     #1#69 = #9#36; ||CAMBIO
     #1#70 = #9#37; ||MONEDA DE TRABAJO
     #1#73 = #9#40; ||MONEDA BASE
     #1#74 = #9#41; ||CAMBIO MON. BASE
     #1#84 = #9#57; || Dir Ent.
     #1#91 = #6#206;

     |ABRE #20;
     #20#0 = #9#60;
     |LEE 000#20=;
     |CIERRA #20;
     #1#88 = #20#0; ||Agencia
     #1#9 = #20#1;

     |HAZ LeeMonBase4;
     |HAZ CambioDivisa4;

     |SI #3#12 = "E";
          #1#1 = fecent;
     |SINO;
          |SI #3#12 = "P";
               #1#1 = fecped;
          |SINO;
               #1#1 = #3#13;
          |FINSI;
     |FINSI;
     |PARA FSalida = 1;|SI 0 ! FSalida;|HACIENDO FSalida = FSalida;
           |HAZ contador;
           #1#0 = codigo;
           |SI #3#9 = "*****";
               #1#52 = #10#28;
           |SINO;
               #1#52 = #3#9;
          |FINSI;
          #1#50 = #6#40;
          |GRABA 020#1b;
     |SIGUE;
     linea = 1;
     |HAZ EsTecatel;
     |SI FSalida = 0;
          eaSer1 = #1#52;
          enDocu1 = #1#0;
          eaTipo = "PE";
          eaSer = #9#25;
          enDocu = #9#0;
          |HAZ TecaTransPeAb;
     |FINSI;

|FPRC;

|PROCESO riesgo_cli;
     eaTag = "AV"; |HAZ Riesgos;
|FPRC;

|PROCESO LineasKit;
     |DDEFECTO #947;
     #947#0 = #0#29;
     #947#1 = #0#0;
     #947#2 = #0#1;
     #947#3 = #946#3;
     #947#4 = #946#4;
     #947#5 = #946#5;
     #947#6 = #946#6;
     #947#7 = #946#7;
     #947#8 = #946#8;
     |GRABA 020#947n;
|FPRC;

|DEFBUCLE LineasKit;
     #946#1;
     ;
     #10#28, #10#0, #10#1, 001;
     #10#28, #10#0, #10#1, 999;
     ;
     NULL, LineasKit;
|FIN;

|PROCESO actulp;|TIPO 0;
     |ABRE #2;
     #2#0 = #10#2;
     |LEE 000#2=;
     |CIERRA #2;

     || nMult corrige redondeo importe negativo
     |SI #2#194 = 2;
          nImpo = #10#44  * #10#6;
     |SINO;
          nImpo = #10#5  * #10#6;
     |FINSI;

     importe  = #9#13;
     importeD = #9#44;
     |SI #2#194 = 2;
          #9#13 = (#10#49 * #10#6)  * nMult;
          #9#44 = (#10#49 * #10#38) * nMult;
     |SINO;
          #9#13 = (#10#43 * #10#6)  * nMult;
          #9#44 = (#10#43 * #10#38) * nMult;
     |FINSI;
     #9#13 = ((((#9#13 < #10#8) < #10#29) < #9#5) < #9#17) < #9#6;
     #9#13 = importe - (#9#13 * nMult);        || Imp Servido (C)

     #9#44 = ((((#9#44 < #10#8) < #10#29) < #9#5) < #9#17) < #9#6;
     #9#44 = importeD - (#9#44 * nMult);        || Imp Servido (C)

     #10#43 = #10#43 + #0#5;
     #10#49 = #10#49 + #0#48;

     #9#11 = #9#11  - #10#9;
     #9#42 = #9#42  - #10#39;

     |SI nImpo < 0; nMult = -1; |SINO; nMult = 1; |FINSI;
     |SI #2#194 = 2;
          #10#7   = (#10#44  * #10#6)  * nMult;
          nImpDiv = (#10#44  * #10#38) * nMult;
     |SINO;
          #10#7   = (#10#5  * #10#6)  * nMult;
          nImpDiv = (#10#5  * #10#38) * nMult;
     |FINSI;
     #10#9  = ((((#10#7   < #10#8) < #10#29) < #9#5) < #9#17) < #9#6;
     #10#39 = ((((nImpDiv < #10#8) < #10#29) < #9#5) < #9#17) < #9#6;

     #10#7  = #10#7 * nMult;
     #10#9  = #10#9 * nMult;
     #10#39 = #10#39 * nMult;

     #9#11 = #9#11 + #10#9;
     #9#42 = #9#42 + #10#39;

     |SI #9#37 = "D";
         #10#41 = #10#9;
     |SINO;
         #10#41 = #10#39;
     |FINSI;

     |SI #2#194 = 2;
          importe  = (#10#49 * #10#6)  * nMult;
          importeD = (#10#49 * #10#38) * nMult;
     |SINO;
          importe  = (#10#43 * #10#6)  * nMult;
          importeD = (#10#43 * #10#38) * nMult;
     |FINSI;
     importe  = ((((importe  < #10#8) < #10#29) < #9#5) < #9#17) < #9#6;
     importeD = ((((importeD < #10#8) < #10#29) < #9#5) < #9#17) < #9#6;

     enTiva = #10#14;
     efFiva = #9#1;
     |HAZ SacaIVA;

     nCalc = (#10#11 % enIva);
     |SI #6#47 = "S";
          nCalc = nCalc + (#10#11 % enRec);
     |FINSI;

     nImpo = #10#11 + nCalc;

     eaTag = "PAU";  |HAZ Riesgos;

     #10#11 = #10#9  - (importe * nMult);|| Imp. Pdte (L)
     #10#37 = #10#37 + #0#35;

     nImpo = #9#13;
     #9#13 = importe;                   || Imp Servido (C)
     #9#13 = (#9#13 * nMult) + nImpo;   || Imp Servido (C)
     #9#12 = #9#11 - #9#13;             || Imp Pdte serv (C)

     nImpo = #9#44;
     #9#44 = importeD;                  || Imp Servido (C)
     #9#44 = (#9#44 * nMult) + nImpo;   || Imp Servido (C)
     #9#43 = #9#42 - #9#44;             || Imp Pdte serv (C)

     #9#24 = #9#24 + #0#5;              || Ctrl Servido (C)

     ||컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
     eaArticulo = #10#2;
     |HAZ EsKit;
     |SI FSalida = 0;
          |ABRE #947;
          |BUCLE LineasKit;
          |CIERRA #947;
     |FINSI;
     ||-------------------Actualiza Historico, Articulo y Almacen
     enForma =  1;
     enUnidPend = #0#5;
     enUnidPend2 = #0#48;
     |HAZ AcumulaAV;

     |HAZ AcumulaPV;
     ||-------------------------------------

     nNume  = ((((#0#9 < #1#5) < #1#32) < #1#7));
     #0#14  = enCoste;

     |SI #9#37 = "B";  || Asigna campos visual. y no visual. en el pedido segun la moneda de trabajo
       #9#45 = #9#11;
       #9#46 = #9#12;
       #9#47 = #9#13;
       #9#48 = #9#42;
       #9#50 = #9#43;
       #9#49 = #9#44;
     |SINO;
       #9#45 = #9#42;
       #9#46 = #9#43;
       #9#47 = #9#44;
       #9#48 = #9#11;
       #9#50 = #9#12;
       #9#49 = #9#13;
     |FINSI;

     |PINTA 1064,#9#0;
     |PINTA 1264,#1#3;
     |PINTA 1464,#1#0;
     |PINTA 1664,#0#1;
     |PINTA 1864,#0#2;
     |PINTA 2064,#0#3;

     #9#51 = #3#53; || Curso
     |GRABA 020#9a;  |LIBERA #9;
     |GRABA 020#10a; |LIBERA #10;
|FPRC;


|PROCESO liacartia;|TIPO 0;
     #0#5  = #10#5  - #10#43;  ||Unidades.
     #0#48 = #10#48 - #10#49;

     #0#49 = #10#45;
     #0#50 = #10#46;

     #1#41 = #1#41 + 1;

     nUniOrg = #0#5;
     |HAZ mirarvic; || Adj. las unidades que hay en el almacen

     |HAZ TotalLin71;

     #0#24 = #10#5 - #10#43;
     #0#23 = #10#5;

     |HAZ actulp;

     |HAZ CalCabAgifa010;

     |HAZ riesgo_cli;

     |SI #9#52 ! 0;
         aAlfa = #6#198 + "P" + (("000" + #9#52) % -103);
         #0#47 = aAlfa;
         #1#85 = "E";
     |FINSI;

     |SI nUniOrg ! #0#5;
          |HAZ Desprecia;
          |HAZ Faltas;
     |FINSI;
|FPRC;

|PROCESO GrabaCompoN;
     |SALVA_DATOS #905;

     #905#0  = "AV";
     #905#1  = #0#29;
     #905#2  = #0#0;
     #905#3  = #0#1;
     #905#6  = #905#6 - #905#12;
     #905#8  = #905#6 * #905#7;
     #905#9  = 0;
     #905#11 = 0;
     #905#12 = 0;
     |GRABA 020#905n;
     |LIBERA #905;

     |REPON_DATOS #905;
     |LEE 040#905=;

     eaTipo        = "AV";
     eaSerie       = #0#29;
     enCodigo      = #0#0;
     enLinea       = #0#1;
     efFecha       = #1#1;
     eaArticulo    = #0#2;
     enAlmacen     = #0#3;
     eaComponente  = #905#4;
     enUnidades    = #0#5;
     enTBruto      = #0#7;
     eaAbono       = #1#43;
     enTarifa      = #6#39;
     eaSeriePedido = #0#31;
     enCodigPedido = #0#12;
     enLineaPedido = #0#21;
     enCamBas      = #1#69;
     eaMoneda      = #1#70;
     enCamDiv      = #1#74;

     |SUB_EJECUTA_NP "dsz00002;AVC";
|FPRC;

|DEFBUCLE dsm00005N;
     #905#1;
     ;
     "PV", #0#31, #0#12, nLinV, "      ";
     "PV", #0#31, #0#12, nLinV, "zzzzzz";
     ;
     NULL, GrabaCompoN;
|FIN;

|PROCESO CreaLinea;
     #0#29 = #1#52;
     #0#0 = #1#0;
     #0#1 = 999;
     |LEE 000#0];
     |SI FSalida = 0;
          |LEE 000#0a;
     |SINO;
          |LEE 000#0u;
     |FINSI;
     |SI FSalida = 0; |Y #0#29 = #1#52; |Y #0#0 = #1#0;
          nLinea = #0#1 + 1;
     |SINO;
          nLinea = 1;
     |FINSI;

     |DDEFECTO #0;
     #0#29 = #1#52;
     #0#0 = #1#0;
     #0#1 = nLinea;
     |PARA i = 2;|SI i < 11;|HACIENDO i = i + 1;
          #0i = #10i;
     |SIGUE;
     #0#3 = almacen;
     #0#27 = #10#27;
     #0#33 = #10#29;
     #0#12 = #9#0;
     #0#21 = #10#1;
     #0#19 = "S";
     #0#11 = #10#14;
     #0#31 = #9#25;
     #0#16 = #10#17;
     #0#17 = #10#19;
     #0#15 = #10#20;
     #0#13 = #10#18;
     #0#34 = #10#35;
     #0#35 = #10#36 - #10#37;
     #0#36 = #10#38;                     ||Precio en divisa

     aAlfa = #0#2; |QBF aAlfa;
     |SI aAlfa ! "";
          |SI #97#202 = "S"; |O #97#40 = "S";
               aTipoDA = "AP"; |HAZ AltaDA;
          |FINSI;
     |FINSI;

     |HAZ liacartia;
     |GRABA 020#0n;
     nLinV = #0#21;
     |BUCLE dsm00005N;
|FPRC;

|PROCESO HayStock;
     #8#0 = #0#2;
     #8#1 = almacen;
     |LEE 020#8=;
     |SI FSalida ! 0; |DDEFECTO #8; |FINSI;

     cantidad = #8#39;
     minimo = #8#6;
     canmar = #8#39;
     cantidad = cantidad - minimo - (#10#42-#10#43+#10#12);

     |SI #10#22 = "S"; |O cantidad ] 0;
          hacer = 1;
     |SINO;
          |SI canmar > 0;
               hacer = 1;
          |FINSI;
    |FINSI;
|FPRC;

|PROCESO mirarser;
     #2#0 = #0#2;
     |LEE 020#2=;
     |SI FSalida ! 0; |DDEFECTO #2; |FINSI;

     almacen = #0#3;
     |HAZ HayStock;

     |SI hacer = 0; |Y #3#7 = "S";    ||Cualquier Almacen
          #8#0 = #0#2;
          #8#1 = 0;
          |LEE 000#8];
          |PARA; |SI FSalida = 0; |Y hacer = 0; |Y #8#0 = #0#2; |HACIENDO;
               almacen = #8#1;
               |HAZ HayStock;
               |LEE 000#8s;
          |SIGUE;

          |SI hacer = 0;
               cantidad = #2#104; minimo = #2#7;
               canmar = #2#104;
               cantidad = cantidad - minimo - (#10#42-#10#43+#10#12);
               |SI cantidad ] 0;
                    hacer = 1;
               |FINSI;
               almacen = #0#3;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO sirve;
     |SI #10#15 = "S"; |ACABA; |FINSI;

     |ABRE #2; #2#0 = #10#2; |LEE 000#2=; |CIERRA #2;

     |SI #97#224 = "B";
          |SI #2#179 = "S";
               |SI #10#43 = #10#5; |Y #10#49 = #10#44; |ACABA; |FINSI;
          |SINO;
               |SI #10#43 = #10#5;  |ACABA; |FINSI;
          |FINSI;
     |SINO;
          |SI #10#43 = #10#5;  |ACABA; |FINSI;
          |SI #2#179 = "S";
               |SI #10#49 = #10#44; |ACABA; |FINSI;
          |FINSI;
     |FINSI;

     |SI #10#0 ! #9#0; |O #10#28 ! #9#25;
         |SI #3#6 = "N";  entrar = 1;  |FINSI;
     |FINSI;

     |SI #10#0 ! #9#0; |O #10#28 ! #9#25;
         |LIBERA #9;
         #9#0 = #10#0;
         #9#25 = #10#28;        ||Serie
         |LEE 121#9=;
         |SI sw = 0; |O #3#6 = "N";
             fecent = #9#2;
             fecped = #9#1;
             sw = 1;
         |FINSI;

         |SI #6#0 ! #9#4;
             |ABRE #6;
             #6#0 = #9#4;
             |LEE 021#6=;
             |CIERRA #6;
         |FINSI;
     |FINSI;

     hacer = 0;
     #0#2 = #10#2;
     #0#3 = #10#3;
     almacen = #0#3;
     |SI #9#10 = "N"; |Y #6#157 = "N";
          hacer = 1;
     |FINSI;

     |SI hacer = 1;
          #0#5 = #10#5  - #10#43;
          nUniOrg = #0#5;
          |HAZ mirarvic;
          |SI #0#5 > 0;
               |SI entrar = 1; |O entro = 0; |O #9#4 ! #1#3; |O #9#5 ! #1#5;
                         |O #9#17 ! #1#32; |O #9#6 ! #1#7; |O #9#7 ! #1#6;
                         |O #9#9 ! #1#8; |O #9#57 ! #1#84;
                    |HAZ finadju;
                    |HAZ creacabe;
                    entro = 1;
                    entrar = 0;
               |FINSI;
               |HAZ CreaLinea;
          |SINO;
               |HAZ Desprecia;
               |HAZ Faltas;
          |FINSI;
     |FINSI;
     fecent = #9#2;
     fecped = #9#1;
|FPRC;

|| Lineas de pedido, segunda clave
|| Cliente, Fecha de entrega, Dto. , Dto. acumulado, Dto. pp, representante
|| forma de pago, numero de pedido
|| Ademas
|| Serie, Pendiente, Bloqueado
|| + Almacen

|DEFBUCLE agifa073p;
     #10#2;
     28, 15, 3;
     #3#2, #3#4,    0,     0,     0, r1,  f1,  #3#0, #3#8,  "N", #3#45;
     #3#3, #3#5,99.99, 99.99, 99.99,"zz","zz", #3#1, #3#10, "N", #3#46;
     be;
     Cero, clicon, NULL, NULL, finadju, sirve;
     #10#13 , #10#28 , #10#0 , #10#20 , #10#1;
|FIN;

|DEFBUCLE agifa073s;
     #10#2;
     28, 15, 3;
     #3#2, #3#4,     0,     0,     0,  r1,  f1,  #3#0, #3#8,  "N", #3#45;
     #3#3, #3#5, 99.99, 99.99, 99.99, "zz","zz", #3#1, #3#10, "N", #3#46;
     be;
     Cero, clicon, NULL, NULL, finadju, sirve;
     #10#20, #9#57, #10#1;
|FIN;

|PROCESO adjuped; |TIPO 3;
     |ABRET #0;                || Lineas Albaranes
     |DDEFECTO #0;

     |ABRET #1;                || Albaranes
     |DDEFECTO #1;

     |ABRE #2;                || Articulos
     |ABRE #8;                || Stocks almacenes
     |ABRE #9;                || Pedidos
     #9#0 = "zzz";            || ??
     |SI #3#11 = "S";
         |BUCLE agifa073p;
     |SINO;
         |BUCLE agifa073s;
     |FINSI;
     |CIERRAT #1;
     |CIERRA #2;
     |CIERRA #8;
     |CIERRAT #0;
     |CIERRA #9;
|FPRC;

|| PROCESO DE SEPARACION DEL ABARAN CREADO AHORA EN SU HONONIMO EN NEGRO


|PROCESO acttl;
     |HAZ TotalLin71;
     |GRABA 001#0a; ||Grabo lineas

     |HAZ CalCabAgifa010;
|FPRC;

|PROCESO ActualizaFicha;
     |HAZ LimCabAgifa010;

     |BUCLELIN 0acttl#1;
|FPRC;

|PROCESO Reparto;
     nAcumula = nAcumula + nCanti;
     nReparto = nCanti * nPorce;
     nEntero  = (nReparto - .50) ! 0;
     |SI nReparto = nEntero;
         nCantiBlanco = nReparto;
         nTCantiBlanco = nTCantiBlanco + nCantiBlanco;
     |SINO;
         nReparto = ((nCanti * nPorce) - nMasMenos);
         |SI nReparto < 0;
             nCantiBlanco = 0;
         |SINO;
             nEntero = (nReparto - .50) ! 0;
             |SI nReparto = nEntero;
                 nCantiBlanco  = nReparto;
                 nTCantiBlanco = nTCantiBlanco + nCantiBlanco;
             |SINO;
                 nCantiBlanco = nEntero + 1;
                 nTCantiBlanco = nTCantiBlanco + nCantiBlanco;
             |FINSI;
         |FINSI;
     |FINSI;

     nReparto  = nAcumula * nPorce;
     nMasMenos = nTCantiBlanco - nReparto;
|FPRC;

|PROCESO PorUnidadC;
     nCanti = #905#6;
     |HAZ Reparto;

     |SALVA_FICHA #905;

     #905#1  = #6#199;
     #905#2  = enCodAlbNegro;
     #905#6  = nCanti - nCantiBlanco;
     #905#8  = #905#6 * #905#7;
     #905#9  = 0;
     #905#11 = 0;
     #905#12 = 0;
     |GRABA 020#905n;

     |REPON_FICHA #905;
     #905#10 = #905#6;
     #905#6  = nCantiBlanco;
     #905#8  = #905#6 * #905#7;
     |GRABA 020#905a;
     |LIBERA #905;
|FPRC;

|PROCESO PorPrecioC;
     nCanti = #905#7;
     |HAZ Reparto;

     |SALVA_FICHA #905;

     #905#1 = #6#199;
     #905#2 = enCodAlbNegro;
     #905#7 = #905#7 - nCantiBlanco;
     #905#8 = #905#6 * #905#7;
     #905#9  = 0;
     #905#11 = 0;
     #905#12 = 0;
     |GRABA 020#905n;
     nTotalNegro = nTotalNegro + #905#8;

     |REPON_FICHA #905;
     #905#10 = #905#7;
     #905#7  = nCantiBlanco;
     #905#8  = #905#6 * #905#7;
     |GRABA 020#905a;
     |LIBERA #905;
     nTotalBlanco = nTotalBlanco + #905#8;
|FPRC;

|PROCESO LineasBlancasC;
     |SI #6#198 = "U";   |HAZ PorUnidadC;  |FINSI;
     |SI #6#198 = "P";   |HAZ PorPrecioC;  |FINSI;
     |SI #6#198 = "A";
         |SI #2#178 = " ";  #2#178 = "U";     |FINSI;
         |SI #2#178 = "U";  |HAZ PorUnidadC;  |FINSI;
         |SI #2#178 = "P";  |HAZ PorPrecioC;  |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE dsm00005;
     #905#1;
     ;
     "AV", #0#29, #0#0, nLinV, "      ";
     "AV", #0#29, #0#0, nLinV, "zzzzzz";
     be;
     NULL, LineasBlancasC;
|FIN;

|PROCESO PorUnidad;
     |SI #2#176 = "S";
         nLinV = #0#1;
         |BUCLE dsm00005;

         |SALVA_FICHA #0;

         #0#29 = #6#199;
         #0#0  = enCodAlbNegro;
         #0#5  = #0#5 - nTCantiBlanco;
         aAlfa = "U" + "N" + (("000" + nPorceT) % -103);
         #0#47 = aAlfa;
         |SI aExporNegro = "S"; #0#11 = 0; |FINSI;  ||Exporta
         |GRABA 020#0n;

         |REPON_FICHA #0;

         aAlfa = "U" + "P" + (("000" + nPorceT) % -103) + (("               " + #0#5) % -115);
         #0#47 = aAlfa;
         #0#5  = nTCantiBlanco;
         |GRABA 020#0a;
     |SINO;
         |SI #2#179 = "S";         || Doble Stock
              |SI #0#48 = 1;
                  nPorce = 1;  || Si uni2 = 1 no hay desglose
                  nPorceT = 0;
              |FINSI;
              nCanti = #0#5;
              nReparto = nCanti * nPorce;
              nCantiBlanco = nReparto ! #2#187;
              nCanti2 = #0#48;
              nReparto = nCanti2 * nPorce;
              nCantiBlanco2 = nReparto ! 0;
              #0#50 = #0#50 * nPorce;
         |SINO;
               nCanti = #0#5;
               nReparto = nCanti * nPorce;
               nCantiBlanco = nReparto ! #2#187;
               nCanti2 = 0;
               nCantiBlanco2 = 0;
         |FINSI;

         |SALVA_FICHA #0;

         #0#29 = #6#199;
         #0#0  = enCodAlbNegro;
         #0#5  = nCanti - nCantiBlanco;
         #0#48  = nCanti2 - nCantiBlanco2;
         aAlfa = "U" + "N" + (("000" + nPorceT) % -103);
         #0#47 = aAlfa;
         |SI aExporNegro = "S"; #0#11 = 0; |FINSI;  ||Exporta
         |GRABA 020#0n;

         |REPON_FICHA #0;

         aAlfa = "U" + "P" + (("000" + nPorceT) % -103) + (("               " + #0#5) % -115);
         aAlfa = aAlfa + (("               " + #0#48) % -115);
         #0#47 = aAlfa;
         #0#5  = nCantiBlanco;
         #0#48  = nCantiBlanco2;
         |GRABA 020#0a;
         |LIBERA #0;
     |FINSI;
|FPRC;

|PROCESO PorPrecio;
     |SI #2#176 = "S";
         nTotalNegro  = 0;
         nTotalBlanco = 0;
         nLinV = #0#1;
         |BUCLE dsm00005;

         |SALVA_FICHA #0;

         #0#29 = #6#199;
         #0#0  = enCodAlbNegro;
         |SI #1#70 = "D";
             #0#36 = nTotalNegro / #0#5;
         |SINO;
             #0#6  = nTotalNegro / #0#5;
         |FINSI;

         aAlfa = "P" + "N" + (("000" + nPorceT) % -103);
         #0#47 = aAlfa;
         |SI aExporNegro = "S"; #0#11 = 0; |FINSI;  ||Exporta
         |GRABA 020#0n;

         |REPON_FICHA #0;

         |SI #1#70 = "D";
             aAlfa = "P" + "P" + (("000" + nPorceT) % -103) + (("               " + #0#36) % -115);
             #0#47 = aAlfa;
             #0#36 = nTotalBlanco / #0#5;
         |SINO;
             aAlfa = "P" + "P" + (("000" + nPorceT) % -103) + (("               " + #0#6) % -115);
             #0#47 = aAlfa;
             #0#6  = nTotalBlanco / #0#5;
         |FINSI;
         |GRABA 020#0a;
         |LIBERA #0;
     |SINO;
         |SI #1#70 = "D";
             nCanti = #0#36;
         |SINO;
             nCanti = #0#6;
         |FINSI;
         |HAZ Reparto;

         |SALVA_FICHA #0;

         #0#29 = #6#199;
         #0#0  = enCodAlbNegro;
         |SI #1#70 = "D";
             #0#36 = nCanti - nCantiBlanco;
         |SINO;
             #0#6 = nCanti - nCantiBlanco;
         |FINSI;
         aAlfa = "P" + "N" + (("000" + nPorceT) % -103);
         #0#47 = aAlfa;
         |SI aExporNegro = "S"; #0#11 = 0; |FINSI;  ||Exporta
         |GRABA 020#0n;

         |REPON_FICHA #0;

         |SI #1#70 = "D";
             aAlfa = "P" + "P" + (("000" + nPorceT) % -103) + (("               " + #0#36) % -115);
             #0#47 = aAlfa;
             #0#36 = nCantiBlanco;
         |SINO;
             aAlfa = "P" + "P" + (("000" + nPorceT) % -103) + (("               " + #0#6) % -115);
             #0#47 = aAlfa;
             #0#6  = nCantiBlanco;
         |FINSI;
         |GRABA 020#0a;
         |LIBERA #0;
     |FINSI;
|FPRC;

|PROCESO KitNegro;
     #947#0 = #6#199;
     #947#1 = enCodAlbNegro;
     |GRABA 020#946n;
|FPRC;

|DEFBUCLE KitNegro;
     #947#1;
     ;
     #0#29, #0#0, #0#1, 001;
     #0#29, #0#0, #0#1, 001;
     ;
     NULL, KitNegro;
|FIN;

|PROCESO LineasBlancas;
     |LEE 101#0=;

     aAlfa         = #0#47 % 303;
     nPorceT       = aAlfa;
     nPorce        =  ((100 - nPorceT) / 100);
     nMasMenos     = 0;
     nAcumula      = 0;
     nTCantiBlanco = 0;
     nMasMenos     = 0;

     |ABRE #2;
     #2#0 = #0#2;
     |LEE 000#2=;
     |SI FSalida ! 0;  |DDEFECTO #2;  |FINSI;
     |CIERRA #2;

     |SI #6#198 = "U";   |HAZ PorUnidad;  |FINSI;
     |SI #6#198 = "P";   |HAZ PorPrecio;  |FINSI;
     |SI #6#198 = "A";
         |SI #2#178 = " ";  #2#178 = "U";     |FINSI;
         |SI #2#178 = "U";  |HAZ PorUnidad;  |FINSI;
         |SI #2#178 = "P";  |HAZ PorPrecio;  |FINSI;
     |FINSI;

     eaArticulo = #0#2;
     |HAZ EsKit;
     |SI FSalida = 0;
          |BUCLE KitNegro;
     |FINSI;
|FPRC;

|PROCESO DesgloseAlb;
     |ABRE #6;
     #6#0 = #1#3;
     |LEE 040#6=;
     |SI FSalida ! 0;  |DDEFECTO #6;  |FINSI;
     |CIERRA #6;

     |ABRE #21;
     #21#26 = #6#199;
     |LEE 000#21=;
     |CIERRA #21;
     aExporNegro = #21#30;

     aSerAlbBlanco = #1#52;
     nCodAlbBlanco = #1#0;
     nCodAlb       = #1#0;

     FSalida = 0;
     |PARA; |SI FSalida = 0;  |HACIENDO;
            |SI #97#103 = "N";
                enSwMenu = 1;
                |HAZ ContadorNegro;
            |SINO;
                enCodAlbNegro = nCodAlb;
            |FINSI;

            #1#52 = #6#199;
            #1#0  = enCodAlbNegro;
            |LEE 040#1=;

            nCodAlb = nCodAlb + 1;
     |SIGUE;

     #1#52 = #6#199;
     #1#0  = enCodAlbNegro;
     #1#8  = #6#200;
     #1#85 = "X";
     #1#86 = aSerAlbBlanco;
     #1#87 = nCodAlbBlanco;
     #1#64 = #9#61;
     #1#2  = 0;
     #1#5  = #6#201;
     |GRABA 020#1n;

     #1#52 = aSerAlbBlanco;
     #1#0  = nCodAlbBlanco;
     |LEE 101#1=;
     |SI FSalida = 0;
         #1#86 = #6#199;
         #1#87 = enCodAlbNegro;

        |BUCLELIN 0LineasBlancas#1;
     |FINSI;
|FPRC;

|PROCESO DesgloNegro;
     |HAZ DesgloseAlb;
     |HAZ ActualizaFicha;
     |GRABA 020#1a;
     |LIBERA #1;

     #1#52 = #6#199;
     #1#0  = enCodAlbNegro;
     |LEE 101#1=;
     |SI FSalida = 0;
         |HAZ ActualizaFicha;
         |GRABA 020#1a;
         |LIBERA #1;
     |FINSI;
|FPRC;

|PROCESO cierre; |TIPO 0;
     efFec = #3#13;
     enAlma = 0;
     |HAZ MiraHisT;
     |SI enErrHis ! 0;
          |ERROR;
          |ACABA;
     |FINSI;
|FPRC;

||---------------------------------------------------------------------------
|| Este proceso mira en PG si en la adj. las series de alb. y ped. tienen que
|| ser iguales (parametro 127). Si es asi el campo serie albaran no puede ser
|| "*****", tiene que tener valor. Los campos desde y hasta serie son iguales al
|| serie albaran y no modificables. Alejandro 27/03/2000
||----------------------------------------------------------------------------
|PROCESO MiraParam; |TIPO 0;
     |ABRE #97;
     |LEE 000#97p;
     |CIERRA #97;
     |SI #97#127 = "S";
          |SI #3#9 = "*****";
               |MENSA "0000Es necesario especificar la serie del albaran";
               |PAUSA;
               |ERROR;
               |ACABA;
          |SINO;
               #3#8  = #3#9;
               #3#10 = #3#9;
               |C_M #3#8, 1, "N";
               |C_M #3#10, 1, "N";
               |PINTA #3#8;
               |PINTA #3#10;
          |FINSI;
     |SINO;
          |C_M #3#8, 1, "S";
          |C_M #3#10, 1, "S";
     |FINSI;
|FPRC;

|PROGRAMA;
     aParam = PARAMETRO;
     |ABRE #97; |LEE 000#97p; |CIERRA #97;
     |MANTE #3;
|FPRO;

|PROCESO parrilla;
     |SI #3#15 = 0; swparrilla = 1; |ACABA; |FINSI;
     |PARA nVic = 14; |SI nVic [ 42; |HACIENDO nVic = nVic + 2;
          nVic2 = nVic + 1;
          |SI #3nVic = #10#28; |Y #3nVic2 = #10#0;
               swparrilla = 1;
               |SAL;
          |FINSI;
     |SIGUE;
|FPRC;

|PROCESO mirarvic;
     #2#0 = #0#2;
     |LEE 000#2=;
     |SI FSalida = 0;
         #8#0 = #0#2;
         #8#1 = #0#3;
         |LEE 000#8=;
         |SI FSalida = 0;
             |SI #3#7 = "S";
                 cantidad = #2#104; minimo = #2#7;
             |SINO;
                 cantidad = #8#39;  minimo = #8#6;
             |FINSI;

             || NO SE PARA QUE ES EL MINIMO!!!
             ||cantidad = cantidad - minimo - (#10#42-#10#43+#10#12);

             cantidad = cantidad - (#10#42-#10#43+#10#12);

             |SI #10#22 = "S"; |O cantidad ] 0;

             |SINO;
                  |SI #3#7 = "S";
                      #0#5 = #2#104;
                  |SINO;
                      #0#5 = #8#39;
                  |FINSI;
             |FINSI;
         |FINSI;
         |SI #0#5 < 0; #0#5 = 0; |FINSI;
     |FINSI;

     |SI #0#5 = nUniOrg; |ACABA; |FINSI;     || No cambia
     aAlfa = #10#35; |QBF aAlfa;
     |SI aAlfa = ""; |O #10#36 = 0; |ACABA; |FINSI; || No hay envases

     nFactor = 1;
     |SI aAlfa = #2#139; nFactor = #2#140; |FINSI;
     |SI aAlfa = #2#141; nFactor = #2#142; |FINSI;
     |SI aAlfa = #2#143; nFactor = #2#144; |FINSI;
     |SI aAlfa = #2#145; nFactor = #2#146; |FINSI;
     nNum1 = #0#5 / nFactor;
     nNum2 = nNum1 ! 0;
     |SI nNum1 ! nNum2;
          #0#35 = 0;
          #0#34 = "";
     |SINO;
          #0#35 = #0#5 / nFactor;
     |FINSI;
|FPRC;

|PROCESO NormalizaFecha; |TIPO 7;
     |SI #3#4 = "01.01.0001";
          fFecha = ~;
          aFecha = fFecha;
          aAny = aFecha % -104;
          |QBF aAny;
          aFecha = "01.01." + aAny;
          #3#4 = aFecha;
          |PINTA #3#4;
     |FINSI;
     |SI #agifa142#185 = "S"; #3#9 = #agifa142#188; |FINSI;
|FPRC;
