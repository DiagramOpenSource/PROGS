|FICHEROS;
     refere0@ #0;
     refere1@ #1;
     agifa041@ #41;
     agifa142@ #142;
     agifa200@ #200;
     agifa208@ #208;

     dsm00209;
     dsm00210;
     dsm00211;
     dsm00212;
     rodm0005@;
|FIN;

|VARIABLES;
     &enSwNoCopia = 0; || Para desactivar la actualizacion
     &eaRodExporta = "";
     nTipo = 0;
     aClave = "";
     nReg = 0;
     aPath = "";
     aCopia = "";
     nModoCam = 0;
     nCampo = 0;
     aDef = "";
     aAlfa = "";
     aFic0 = "";
     aFic1 = "";
     aDef0 = "";
     aDef1 = "";
     nModo = 0;
     nCamBaja = 0;
     nCamAlta = 0;
     nCamModi = 0;
     nPasa = 0;
|FIN;

|PROCESO LeeRegX;
     |SI aFic1 = "dsm00209";
          #1#0 = #dsm00209#0;
     |FINSI;
     |SI aFic1 = "dsm00210";
          #1#0 = #dsm00210#0;
          #1#1 = #dsm00210#1;
     |FINSI;
     |SI aFic1 = "dsm00211";
          #1#0 = #dsm00211#0;
     |FINSI;
     |SI aFic1 = "dsm00212";
          #1#0 = #dsm00212#0;
          #1#1 = #dsm00212#1;
     |FINSI;
     |LEE 101#1=;
|FPRC;

|PROCESO CamCopiaX;
     nPasa = 0;
     |SI nModoCam = 1; |Y #208#3 = "S"; nPasa = 1; |FINSI;
     |SI nModoCam = 2; |Y #208#4 = "S"; nPasa = 1; |FINSI;
     |SI nPasa = 0; |ACABA; |FINSI;
     nCampo = #208#1;
     |SI aFic1 = "dsm00209";
          #1#nCampo# = #dsm00209#nCampo#;
     |FINSI;
     |SI aFic1 = "dsm00210";
          #1#nCampo# = #dsm00210#nCampo#;
     |FINSI;
     |SI aFic1 = "dsm00211";
          #1#nCampo# = #dsm00211#nCampo#;
     |FINSI;
     |SI aFic1 = "dsm00212";
          #1#nCampo# = #dsm00212#nCampo#;
     |FINSI;
|FPRC;

|DEFBUCLE CamCopiaModiX;
     #208#3003;
     ;
     aFic1, 001, "S";
     aFic1, 999, "S";
     ;
     NULL, CamCopiaX;
|FIN;

|DEFBUCLE CamCopiaAltaX;
     #208#2003;
     ;
     aFic1, 001, "S";
     aFic1, 999, "S";
     ;
     NULL, CamCopiaX;
|FIN;

|PROCESO EmCopiaX;
     |DFICB aAlfa; |QBF aAlfa;
     |PATH_DAT #41 aAlfa;
     |ABRE #41;
     |SALVA_FICHA #41;
     #41#0 = #200#0;
     |LEE 000#41=;
     |SI FSalida = 0;
          |DFICB aAlfa; |QBF aAlfa;
          aPath = aAlfa + (("00000" + #200#0) % -105) + "/";
          |PATH_DAT #1 aPath;
          |ABRE #1;
          |DDEFECTO #1;
          |HAZ LeeRegX;
          |SI FSalida = 0;
               |SI nModo = 3; |Y #200nCamBaja = "S";
                    |BORRA 000#1a;
               |FINSI;
               |SI nModo ! 3; |Y #200nCamModi = "S";
                    nModoCam = 2;
                    |BUCLE CamCopiaModiX;
                    |GRABA 020#1a;
                    ||HAZ GrabaFic0;
               |FINSI;
          |SINO;
               |SI #200nCamAlta = "S";
                    nModoCam = 1;
                    |BUCLE CamCopiaAltaX;
                    ||HAZ GrabaFic0;
                    |GRABA 020#1n;
               |FINSI;
          |FINSI;
          |CIERRA #1;
     |FINSI;
     |REPON_FICHA #41;
|FPRC;

|DEFBUCLE EmCopiaX;
     #200#1001;
     ;
     00001;
     99999;
     ;
     NULL, EmCopiaX;
|FIN;

|PROCESO CargadefX;
     |DDEF aDef;

     aAlfa = aDef + "agifa041"; |CARGA_DEF aAlfa, agifa041@;
     aAlfa = aDef + "agifa200"; |CARGA_DEF aAlfa, agifa200@;
     aAlfa = aDef + "agifa208"; |CARGA_DEF aAlfa, agifa208@;

     |SI aFic0 ! "";
          aDef0 = aDef + aFic0;
          |CARGA_DEF aDef0, refere0@;
          |SI FSalida ! 0;
               aAlfa = "0000ERROR al cargar + " aFic0;
               aDef0 = ""; |ACABA;
          |FINSI;
     |FINSI;
     |SI aFic1 ! "";
          aDef1 = aDef + aFic1;
          |CARGA_DEF aDef1, refere1@;
          |SI FSalida ! 0;
               aAlfa = "0000ERROR al cargar + " aFic1;
               aDef1 = "";
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO DescargadefX;
     |SI aDef1 ! ""; |DESCARGA_DEF #refere1@; |FINSI;
     |SI aDef0 ! ""; |DESCARGA_DEF #refere0@; |FINSI;
     |DESCARGA_DEF #agifa208@;
     |DESCARGA_DEF #agifa200@;
     |DESCARGA_DEF #agifa041@;
|FPRC;

|PROCESO LeeParameX;
     |DDEF aAlfa; aAlfa = aAlfa + "agifa142";
     |CARGA_DEF aAlfa, agifa142@;
     |SI FSalida = 0;
          |ABRE #142; |LEE 000#142p; |CIERRA #142;
          aCopia = #142#28;
          |DESCARGA_DEF #agifa142@;
     |FINSI;
|FPRC;

|PROCESO Tipo15X;
     |SI enSwNoCopia ! 0; |ACABA; |FINSI;

     |HAZ LeeParameX;
     |SI aCopia ! "S"; |ACABA; |FINSI;

     nTipo = 15; |HAZ RodacalCopia1;
     |SI FSalida = 0; |ACABA; |FINSI;

     nModo = 1;
     |HAZ CargadefX;
     |SI FSalida = 0;
          |BUCLE EmCopiaX;
          |HAZ DescargadefX;
     |FINSI;
|FPRC;

|PROCESO Tipo16X;
     |SI enSwNoCopia ! 0; |ACABA; |FINSI;

     |HAZ LeeParameX;
     |SI aCopia ! "S"; |ACABA; |FINSI;

     nTipo = 16; |HAZ RodacalCopia1;
     |SI FSalida = 0; |ACABA; |FINSI;

     nModo = 2;
     |HAZ CargadefX;
     |SI FSalida = 0;
          |BUCLE EmCopiaX;
          |HAZ DescargadefX;
     |FINSI;
|FPRC;

|PROCESO Tipo17X;
     |SI enSwNoCopia ! 0; |ACABA; |FINSI;

     |HAZ LeeParameX;
     |SI aCopia ! "S"; |ACABA; |FINSI;

     nTipo = 17; |HAZ RodacalCopia1;
     |SI FSalida = 0; |ACABA; |FINSI;

     nModo = 3;
     |HAZ CargadefX;
     |SI FSalida = 0;
          |BUCLE EmCopiaX;
          |HAZ DescargadefX;
     |FINSI;
|FPRC;
|PROCESO &Copia209_15; |TIPO 15;
     nCamAlta = 40; nCamModi = 41; nCamBaja = 42;
     aFic0 = "";
     aFic1 = "dsm00209"; |HAZ Tipo15X;
|FPRC;
|PROCESO &Copia209_16; |TIPO 16;
     nCamAlta = 40; nCamModi = 41; nCamBaja = 42;
     aFic0 = "";
     aFic1 = "dsm00209"; |HAZ Tipo16X;
|FPRC;
|PROCESO &Copia209_17; |TIPO 17;
     nCamAlta = 40; nCamModi = 41; nCamBaja = 42;
     aFic0 = "";
     aFic1 = "dsm00209"; |HAZ Tipo17X;
|FPRC;

|PROCESO &Copia210_15; |TIPO 15;
     nCamAlta = 22; nCamModi = 23; nCamBaja = 24;
     aFic0 = "";
     aFic1 = "dsm00210"; |HAZ Tipo15X;
|FPRC;
|PROCESO &Copia210_16; |TIPO 16;
     nCamAlta = 22; nCamModi = 23; nCamBaja = 24;
     aFic0 = "";
     aFic1 = "dsm00210"; |HAZ Tipo16X;
|FPRC;
|PROCESO &Copia210_17; |TIPO 17;
     nCamAlta = 22; nCamModi = 23; nCamBaja = 24;
     aFic0 = "";
     aFic1 = "dsm00210"; |HAZ Tipo17X;
|FPRC;

|PROCESO &Copia211_15; |TIPO 15;
     nCamAlta = 43; nCamModi = 44; nCamBaja = 45;
     aFic0 = "";
     aFic1 = "dsm00211"; |HAZ Tipo15X;
|FPRC;
|PROCESO &Copia211_16; |TIPO 16;
     nCamAlta = 43; nCamModi = 44; nCamBaja = 45;
     aFic0 = "";
     aFic1 = "dsm00211"; |HAZ Tipo16X;
|FPRC;
|PROCESO &Copia211_17; |TIPO 17;
     nCamAlta = 43; nCamModi = 44; nCamBaja = 45;
     aFic0 = "";
     aFic1 = "dsm00211"; |HAZ Tipo17X;
|FPRC;

|PROCESO &Copia212_15; |TIPO 15;
     nCamAlta = 25; nCamModi = 26; nCamBaja = 27;
     aFic0 = "";
     aFic1 = "dsm00212"; |HAZ Tipo15X;
|FPRC;
|PROCESO &Copia212_16; |TIPO 16;
     nCamAlta = 25; nCamModi = 26; nCamBaja = 27;
     aFic0 = "";
     aFic1 = "dsm00212"; |HAZ Tipo16X;
|FPRC;

|PROCESO &Copia212_17; |TIPO 17;
     nCamAlta = 25; nCamModi = 26; nCamBaja = 27;
     aFic0 = "";
     aFic1 = "dsm00212"; |HAZ Tipo17X;
|FPRC;

|PROCESO RodacalCopia1;
     |SI eaRodExporta = "S"; |ACABA; |FINSI; || lo activa rodw0004

     |DBASE aPath;
     aPath = aPath + "/def/rodm0001.mas";
     |XABRE "E", aPath, 0;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |DDEF aDef;
     aDef = aDef + "rodm0005";
     |CARGA_DEF aDef, rodm0005@;
     |SI FSalida ! 0;
          |MENAV "0000ERROR al cargar 'rodm0005'";
     |SINO;
          |ABRE #rodm0005@;
          |LEE 000#rodm0005@.u;
          |SI FSalida = 0; nReg = #rodm0005@#0 + 1; |SINO; nReg = 1; |FINSI;
          |DDEFECTO #rodm0005@;
          #rodm0005@#0 = nReg;
          |SI aFic1 = "dsm00209"; aClave = #dsm00209#0; |FINSI;
          |SI aFic1 = "dsm00210"; aClave = #dsm00210#0 + "|" + #dsm00210#1; |FINSI;
          |SI aFic1 = "dsm00211"; aClave = #dsm00211#0; |FINSI;
          |SI aFic1 = "dsm00212"; aClave = #dsm00212#0 + "|" + #dsm00212#1; |FINSI;
          #rodm0005@#1 = aClave;
          #rodm0005@#2 = aFic1;
          |SI nTipo = 15; #rodm0005@#3 = "A"; |FINSI;
          |SI nTipo = 16; #rodm0005@#3 = "M"; |FINSI;
          |SI nTipo = 17; #rodm0005@#3 = "B"; |FINSI;
          |SELECT #3#rodm0005@;
          |LEE 101#rodm0005@.=;
          |SI FSalida ! 0; |GRABA 020#rodm0005@.b; |FINSI;
          aAlfa = Usuario % 810;
          #rodm0005@#4 = aAlfa;
          #rodm0005@#5 = ~;
          |HORA aAlfa;
          #rodm0005@#6 = aAlfa;
          |GRABA 020#rodm0005@.a;
          |CIERRA #rodm0005@;
          |DESCARGA_DEF #rodm0005@;
     |FINSI;
     FSalida = 0;
|FPRC;
