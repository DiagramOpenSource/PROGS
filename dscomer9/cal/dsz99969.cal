/*
    NO A쩇DIR (exceso de ficheros).... HACERLO EN EL dsz99960
*/

|FICHEROS;
     agifa010 #10;
     agifa017 #17;
     agifa019 #19;
     agifa067 #67;
     agifa071 #71;
     agifa077 #77;
     agifa080 #80;
     agifa142 #142;
     referen@ #20;
     refere1@ #21;
|FIN;

|VARIABLES;
     &eaDarti = "";
     &eaHarti = "";
     nPed = 0;
     nRec = 0;
     nSer = 0;
     nNume = 0;
     &eaCliente = "";
     &enMaxImpo = 0;
     nSw       = 0;
     &eaArticulo = "";
     &enAlmacen = 0;
     &eaArtiTeca = "";
     &eaCodigo = "";
     &eaTipo   = "";
     &eaSer    = "";
     &enDocu   = 0;
     &eaSer1   = "";
     &enDocu1  = 0;
     aDir      = "";
     aPais     = "";
     i         = 0;
     aAlfa     = "";
     aDoc      = "";
     &enPrecio = 0;
     &enPreDiv = 0;
     aDef = "";
     aDef1 = "";
     nSalida = 0;
|FIN;

|PROCESO Carga99969_1;
     |DDEF aAlfa;
     aAlfa = aAlfa + aDef1;
     |CARGA_DEF  aAlfa, refere1@;
     |SI FSalida  ! 0;
          aAlfa = "0000Error al cargar:" + aDef;
          |MENAV aAlfa;
          aDef = "";
     |FINSI;
|FPRC;

|PROCESO Descarga99969_1;
     |SI aDef1 ! ""; |DESCARGA_DEF #refere1@; |FINSI;
|FPRC;

|PROCESO Carga99969;
     |DDEF aAlfa;
     aAlfa = aAlfa + aDef;
     |CARGA_DEF  aAlfa, referen@;
     |SI FSalida  ! 0;
          aAlfa = "0000Error al cargar:" + aDef;
          |MENAV aAlfa;
          aDef = "";
     |FINSI;
|FPRC;

|PROCESO Descarga99969;
     |SI aDef ! ""; |DESCARGA_DEF #referen@; |FINSI;
|FPRC;

|PROCESO TecaPinFec;
     |PINTA 1629, "F.Entrega...:";
     |PINTA 1642, #19#120;
|FPRC;

|PROCESO TecaFecPed;
     |ABRE #19;
     #19#0 = #67#2;
     |LEE 121#19=;
     |SI FSalida = 0;
          #19#120 = #67#13;
          |GRABA 020#19a;
     |FINSI;
     |CIERRA #19;
|FPRC;

|PROCESO TecaTransPrPe; ||Proforma a Pedido
     aDef = "dsint002";
     |HAZ Carga99969;
     |SI FSalida ! 0; |ACABA; |FINSI;
     |ABRE #20;
     #20#0 = "E";
     #20#8 = "R";
     #20#6 = eaSer;
     #20#7 = enDocu;
     |LEE 000#20=;
     |SI FSalida = 0;
          #20#8 = "P";
          #20#6 = eaSer1;
          #20#7 = enDocu1;
          |GRABA 000#20n;
          |SI FSalida ! 0;
               |BORRA 020#20c;
               |GRABA 020#20n;
          |FINSI;
     |FINSI;
     |CIERRA #20;
     |HAZ Descarga99969;
|FPRC;

|PROCESO  TecaTransPeAb; ||Pedido a Albaran
     aDef = "dsint002";
     |HAZ Carga99969;
     |SI FSalida ! 0; |ACABA; |FINSI;
     |ABRE #20;
     #20#0 = "E";
     #20#8 = "P";
     #20#6 = eaSer;
     #20#7 = enDocu;
     |LEE 000#20=;
     |SI FSalida = 0;
          #20#8 = "A";
          #20#6 = eaSer1;
          #20#7 = enDocu1;
          |GRABA 000#20n;
          |SI FSalida ! 0;
               |BORRA 020#20c;
               |GRABA 020#20n;
          |FINSI;
     |FINSI;
     |CIERRA #20;
     |HAZ Descarga99969;
|FPRC;

|PROCESO Adj;
     eaSer1 = #71#31;
     enDocu1 = #71#12;
     |ERROR10;
|FPRC;

|PROCESO TecaTransAdj;
     |BUCLELIN 2 Adj #10;

     aDef = "dsint002";
     |HAZ Carga99969;
     |SI FSalida ! 0; |ACABA; |FINSI;
     |ABRE #20;
     #20#0 = "E";
     #20#8 = "A";
     #20#6 = eaSer;
     #20#7 = enDocu;
     |LEE 000#20=;
     |SI FSalida ! 0;
          #20#8 = "P";
          #20#6 = eaSer1;
          #20#7 = enDocu1;
          |LEE 000#20=;
          |SI FSalida = 0;
               #20#8 = "A";
               #20#6 = eaSer;
               #20#7 = enDocu;
               |GRABA 020#20n;
          |FINSI;
     |FINSI;
     |CIERRA #20;
     |HAZ Descarga99969;

     |HAZ TecaTrans;
|FPRC;

|PROCESO AdjC;
     eaSer1 = #80#29;
     enDocu1 = #80#12;
     |ERROR10;
|FPRC;

|PROCESO TecaTransAdjC;
     |BUCLELIN 2 AdjC #77;

     aDef = "dsint002";
     |HAZ Carga99969;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |ABRE #20;
     #20#0 = "I";
     #20#8 = "A";
     #20#6 = eaSer;
     #20#7 = enDocu;
     |LEE 000#20=;
     |SI FSalida ! 0;
          #20#8 = "P";
          #20#6 = eaSer1;
          #20#7 = enDocu1;
          |LEE 000#20=;
          |SI FSalida = 0;
               #20#8 = "A";
               #20#6 = eaSer;
               #20#7 = enDocu;
               |GRABA 020#20n;
          |FINSI;
     |FINSI;
     |CIERRA #20;
     |HAZ Descarga99969;

     |HAZ TecaTrans;
|FPRC;

|PROCESO TecaTrans;
     |SUB_EJECUTA_NP "dsinw001";
|FPRC;

|PROCESO TecaPreCom;
     aDef = "tecam002";
     |HAZ Carga99969;
     |SI FSalida = 0;
          |ABRE #20;
          #20#0 = #80#2;
          |LEE 101#20=;
          |SI FSalida ! 0; |GRABA 020#20b; |FINSI;
          #20#1 = #80#6;
          #20#2 = ((#80#6 < #80#8) < #80#26) < #80#45;
          #20#3 = #80#30;
          #20#4 = ((#80#30 < #80#8)< #80#26) < #80#45;
          |GRABA 020#20a;
          |CIERRA #20;
          |SI #142#9 = "S";
               #17#89 = #80#6;
               #17#90 = ((#80#6 < #80#8) < #80#26) < #80#45;
               #17#91 = #80#30;
               #17#92 = ((#80#30 < #80#8)< #80#26) < #80#45;
          |FINSI;
          |HAZ Descarga99969;
     |FINSI;
|FPRC;

|PROCESO TecaPinPre;
     |PINTA 1547, "Ultimo Precio sin Portes";
     aDef = "tecam002";
     |HAZ Carga99969;
     |SI FSalida = 0;
          |DDEFECTO #20;
          |ABRE #20;
          #20#0 = #19#0;
          |LEE 000#20=;
          |CIERRA #20;
          |PINTA 1647, #20#1;
          |PINTA 1657, #20#2;
          |PINTA 1747, #20#3;
          |PINTA 1757, #20#4;
          |HAZ Descarga99969;
     |FINSI;
|FPRC;

|PROCESO TecaCogePreCom;
     |SI #142#9 = "N";
          aDef = "tecam002";
          |HAZ Carga99969;
          |SI FSalida = 0;
               |ABRE #20;
               #20#0 = eaArtiTeca;
               |LEE 000#20=;
               |SI FSalida = 0;
                    enPrecio = #20#1;
                    enPreDiv = #20#3;
               |FINSI;
               |CIERRA #20;
               |HAZ Descarga99969;
          |FINSI;
     |SINO;
          |ABRE #17;
          #17#0 = eaArtiTeca;
          #17#1 = enAlmacen;
          |LEE 000#17=;
          |SI FSalida = 0;
               enPrecio = #17#89;
               enPreDiv = #17#90;
          |FINSI;
          |CIERRA #17;
     |FINSI;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO TecaUsuPre;
     aDef = "tecam028";
     |HAZ Carga99969;
     |SI FSalida = 0;
          |ABRE #20;
          aAlfa = Usuario % 810;
          #20#0 = aAlfa;
          |LEE 000#20=;
          nSalida = FSalida;
          |CIERRA #20;
          |HAZ Descarga99969;
     |FINSI;
     FSalida = nSalida;
|FPRC;

|PROCESO TecaMaxImpo;
     enMaxImpo = -1;
     aDef = "tecam030";
     |HAZ Carga99969;
     |SI FSalida = 0;
          nNume = 0;
          |ABRE #20;
          |SELECT #2#20;
          #20#2 = eaCliente;
          |LEE 000#20=;
          |SI FSalida = 0;
               nNume = #20#0;
          |FINSI;
          |CIERRA #20;
          |HAZ Descarga99969;

          |SI nNume ! 0;
               aDef = "tecam029";
               |HAZ Carga99969;
               |SI FSalida = 0;
                    |ABRE #20;
                    #20#0 = nNume;
                    |LEE 000#20=
                    |SI FSalida = 0;
                         enMaxImpo = #20#1;
                    |FINSI;
                    |CIERRA #20;
                    |HAZ Descarga99969;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO TecaPinTienda;
     aDef = "tecam034";
     |HAZ Carga99969;
     |SI FSalida = 0;
          |ABRE #20;
          #20#0 = eaArticulo;
          #20#1 = enAlmacen
          |SI enAlmacen = 0;       || Desde el agifa019
               nPed = 0; nSer = 0; nRec = 0;
               |LEE 000#20];
               |PARA; |SI FSalida = 0; |Y #20#0 = eaArticulo; |HACIENDO;
                    nPed = nPed + #20#2;
                    nSer = nSer + #20#3;
                    nRec = nRec + #20#4;
                    |LEE 000#20s;
               |SIGUE;
               #20#2 = nPed;
               #20#3 = nSer;
               #20#4 = nRec;
               |C_P #20#2,1,1817;
               |C_P #20#3,1,1842;
               |C_P #20#4,1,1864;
               |PINTA #20#2;
               |PINTA #20#3;
               |PINTA #20#4;
               |ATRI S;
               |PINTA 1803,"Tienda Pedida:";
               |PINTA 1829,"Tienda Ser..:";
               |PINTA 1854,"Tienda Pt:";
               |ATRI I;
          |SINO;                   ||Desde el agifa017
               |LEE 000#20=;
               |C_P #20#2,1,2118;
               |C_P #20#3,1,2142;
               |C_P #20#4,1,2164;
               |PINTA #20#2;
               |PINTA #20#3;
               |PINTA #20#4;
               |ATRI S;
               |PINTA 2104,"Tienda Pedida:";
               |PINTA 2130,"Tienda Ser:";
               |PINTA 2153,"Tienda Pt:";
               |ATRI I;
          |FINSI;
          |CIERRA #20;
          |HAZ Descarga99969;
     |FINSI;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO AceroTienda;
     #21#2 = 0;
     #21#3 = 0;
     #21#4 = 0;
     |GRABA 020#21a;
     |LIBERA #21;
|FPRC;

|DEFBUCLE AceroTienda;
     #21#1002;
     ;
     eaDarti, 00001;
     eaHarti, 99999;
     be;
     NULL, AceroTienda;
|FIN;

|PROCESO TraspasoTienda;
     |DDEFECTO #21;
     #21#0 = #20#3;
     #21#1 = #20#5;
     |LEE 000#21=;
     |SI FSalida ! 0; |GRABA 020#21b; |FINSI;
     #21#2 =  #21#2 + #20#6; || Ped
     #21#3 =  #21#3 + #20#7; || Ser
     #21#4 =  #21#4 + #20#8; || Pte Rec
     |GRABA 020#21a;
     |LIBERA #21;
|FPRC;

|DEFBUCLE TraspasoTienda;
     #20#1003;
     3;
     "     ", 000001, 001, eaDarti;
     "zzzzz", 999999, 999, eaHarti;
     ;
     NULL, TraspasoTienda;
|FIN;

|PROCESO TecaRecalStock;
     aDef = "tecam033";
     |HAZ Carga99969;
     |SI FSalida = 0;
          aDef1 = "tecam034";
          |HAZ Carga99969_1;
          |SI FSalida = 0;
               |BUCLE AceroTienda;
               |ABRE #21;
               |BUCLE TraspasoTienda;
               |CIERRA #21;
               |HAZ Descarga99969_1;
          |FINSI;
          |HAZ Descarga99969;
     |FINSI;
|FPRC;
