  MALPESA

  GrabaLogPrecio:
     Graba el precio antes y despu‚s de recalcular

  CorrigeMalpesa:
      Regraba las lineas albaranes con el precio correcto
      No se sabe porque los precios se redondean 07/02/2019

|FICHEROS;
     malpe091@;
     agifa010;
     agifa071;

     dsw00111 #111;
     agifa071 #71;
     agifa010 #10;

     tmp00000 #300; || Tmp facturas procesadas
     agifa134 #0;
|FIN;

|VARIABLES;
     &enSwMalpesa = 0;
     aTmp300 = "";
     &Tempo = "";

     aAlfa = "";
     aPath = "";
     &enEstaDentro = 0;
     &aDivisa = "";
     &aMoneda = "";

     aHora = "";
     aModulo = "";
     nSw = 0;
|FIN;

|PROCESO GrabaLogPrecio;
     |DDEFECTO #111;
     #111#0 = #71#29;
     #111#1 = #71#0;
     #111#2 = #71#1;
     |LEE 101#111=;
     |SI FSalida ! 0; |GRABA 020#111b; |FINSI;

     #111#3 = aModulo;
     #111#4 = aHora;
     #111#5 = ~;
     #111#6 = aHora;
     |SI nSw = 1;
          #111#7 = #71#6;
     |SINO;
          #111#8 = #71#6;
     |FINSI;
     |GRABA 020#111a;
     |LIBERA #111;
|FPRC;

|DEFBUCLE GrabaLogPrecio;
     #71#1;
     ;
     #10#52, #10#0, 001;
     #10#52, #10#0, 999;
     ;
     NULL, GrabaLogPrecio;
|FIN;

|PROCESO GrabaLogPrecio1;
     |MODULO aModulo;
     |HORA aHora;
     nSw = 1;
     |ABRE #111;
     |BUCLE GrabaLogPrecio;
     |CIERRA #111;
|FPRC;

|PROCESO GrabaLogPrecio2;
     |MODULO aModulo;
     |HORA aHora;
     nSw = 2;
     |ABRE #111;
     |BUCLE GrabaLogPrecio;
     |CIERRA #111;
|FPRC;

|PROCESO Malpe091;
     enEstaDentro = 1;
     #agifa071#29 = #malpe091@#29;
     #agifa071#0 = #malpe091@#0;
     #agifa071#1 = #malpe091@#1;
     |LEE 121#agifa071.=;
     |SI FSalida = 0;
          aDivisa = #agifa010#68;
          aMoneda = #agifa010#70;
          |HAZ Divisas010;

          #agifa071#6 = #malpe091@#6;
          #agifa071#36 = #malpe091@#36;
          #agifa071#38 = #malpe091@#38;
          |GRABA 020#agifa071.a;
          |LIBERA #agifa071;
     |FINSI;
     enEstaDentro = 0;
|FPRC;

|DEFBUCLE Malpe091;
     #malpe091@#1003;
     ;
     #agifa010#52, #agifa010#0, 001;
     #agifa010#52, #agifa010#0, 999;
     ;
     NULL, Malpe091;
|FIN;

|PROCESO CorrigeMalpesa;
     |DDEF aPath;
     aAlfa = aPath + "malpe091";
     |CARGA_DEF aAlfa, malpe091@;
     |SI FSalida = 0;
          |ABRE #agifa071;
          |BUCLE Malpe091;
          |CIERRA #agifa071;
          |DESCARGA_DEF #malpe091@;
     |FINSI;
|FPRC;
=======================================================================
|PROCESO TmpFactuIni;
     |HAZ CreaTempo; aTmp300 = Tempo;
     |NOME_DAT #300aTmp300; |DELINDEX #300; |ABRE #300;
|FPRC;

|PROCESO TmpFactuFin;
     |CIERRA #300;

     |SI enSwMalpesa = 0;
          aAlfa = "malpe214"; ||Chequeo de precios
          aAlfa = aAlfa + ";" + aTmp300;
          |SUB_EJECUTA_NP aAlfa;
     |FINSI;

     Tempo = aTmp300; |DELINDEX #300;
|FPRC;

|PROCESO TmpFactuGra;
     #300#0 = #0#49;
     #300#1 = #0#0;
     |GRABA 020#300n;
|FPRC;
