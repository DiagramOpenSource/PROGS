|FICHEROS;
     por00005 #0;
     por00003 #3;

     marhup07 #7;
     marhup08 #8;
     agifa129 #129;
|FIN;

|VARIABLES;
     &nSwOfer  = 0;
     &nBotonx1 = 0;
     &nBotonx2 = 0;
     &nBotonx3 = 0;
     &nBotonx4 = 0;
/*
     &nCampoActual5=0;
*/
     nNume1=0;
     nNume2=0;
     nAux=0;
     &nRedondeoPu=0;
     &aAutonomo="";
     &aArticulo="";
     nError=0;
     nTecla=0;
     &aLetras1="";
     &aLetras2="";

     &nLineaMaxDto=0;
     &nMaxDto=0;
     &nLugar=0;
     &nDescuento=0;
|FIN;
/*
|PROCESO CompruebaRed; || si no es multiplo decremento el dto
     nNume1=#0#0;
     nNume2=#3#20;
     nAux=nNume1 $ nNume2;
     |SI nAux!0;  || no es multiplo, decrementar descuento
          |MENAV "0000Se va a penalizar el descuento!";
          |PTEC 809;
     |FINSI;
|FPRC;
*/

|PROCESO Tipo12i; |TIPO 12;
|| tipo 12, para que al terminar con una ficha, no pregunte SI o NO
|FPRC;

|PROCESO Entra1;|TIPO 7;
/*
     nCampoActual5=0;
*/
|FPRC;

|PROCESO Entra2;|TIPO 7;
/*
     nCampoActual5=1;
*/
     |SI nRedondeoPu=0;

          nNume1=#0#0;
          nNume2=#3#20;

          nAux=nNume1/nNume2;
          nAux=nAux!0;
          #0#0=nAux*nNume2;
          |SI #0#0=0;
               #0#0=#3#20;
          |FINSI;

          |PINTA #0#0;
/*
     |SINO;
          |HAZ CompruebaRed;
*/
     |FINSI;

|FPRC;

/*
|PROCESO Entra1;|TIPO 7;
     nCampoActual5=0;
|FPRC;

|PROCESO Entra2;|TIPO 7;
     nCampoActual5=1;
     |SI nRedondeoPulsado=1;
          nRedondeoPulsado=0;

          nNume1=#0#0;
          nNume2=#3#20;

          nAux=nNume1/nNume2;
          nAux=nAux!0;
          #0#0=nAux*nNume2;

          |PINTA #0#0;
     |FINSI;
|FPRC;
*/
|PROCESO ConsultaDtoComis; |TIPO 0;
     nTecla = FSalida;

     |SI nTecla=2;  |Y nSwOfer = 0;  || flecha arriba
          |SI nSwOfer = 0;
               |SI nMaxDto=0;
                    #0#1=nDescuento;
               |SINO;
                    |HAZ BuscaPosicionTabla;
                    |SI nLugar=-1;
                         #0#1=nMaxDto;
                    |SINO;
                         |SI nLugar<nLineaMaxDto;
                              nLugar=nLugar+1;
                         |FINSI;

                         |HAZ CalculaDescuento;
                         #0#1=nDescuento;
                    |FINSI;

                    |HAZ Genera2Letras;
                    #0#2=aLetras1;
                    #0#3=aLetras2;
                    |PINTA #0#2;
                    |PINTA #0#3;
               |FINSI;
               |PINTA #0#1;
          |FINSI;
          |ERROR;
     |FINSI;

     |SI nTecla = 3;   || flecha abajo
          |SI nSwOfer = 0;
               |SI nMaxDto=0;
                    #0#1 = nDescuento;
               |SINO;
                    |HAZ BuscaPosicionTabla;
                    |SI nLugar=-1;
                         #0#1=nMaxDto;
                    |SINO;
                         |SI nLugar>1;
                              nLugar=nLugar-1;
                         |FINSI;

                         |HAZ CalculaDescuento;
                         #0#1=nDescuento;
                    |FINSI;

                    |HAZ Genera2Letras;
                    #0#2=aLetras1;
                    #0#3=aLetras2;
                    |PINTA #0#2;
                    |PINTA #0#3;
               |FINSI;
               |PINTA #0#1;
          |FINSI;
          |ERROR;
     |FINSI;

     |SI nTecla = 13;  || F5
          |ESTADO_CONTROL nBotonx1, "HIDE";
          |ESTADO_CONTROL nBotonx2, "HIDE";
          |ESTADO_CONTROL nBotonx3, "HIDE";

          nError=0;

          |ABRE #8;      || buscar el grupo de descuento del articulo
          #8#0=aArticulo;
          |LEE 000#8=;
          |SI FSalida!0;
               nError=1;
          |SINO;
               |ABRE #7;  || abrir el grupo de descuento para ver la tabla
               #7#0=#8#1;

               |LEE 000#7=;
               |SI FSalida!0;
                    nError=1;
               |SINO;
                    |ABRE #129;   || abrir la tabla descuento-comision
                    |SI aAutonomo="S";
                         #129#0=#7#3;
                    |SINO;
                         #129#0=#7#2;
                    |FINSI;

                    |LEE 000#129=;
                    |SI FSalida!0;
                         nError=1;
                    |SINO;     || si hemos llegado aqui, todo esta bien
                         |PUSHV 0501 2380;
                         |CLS;
                         |PINPA #0#129;
                         |PINDA #0#129;
                         |PAUSA;
                         |POPV;
                    |FINSI;
                    |CIERRA #129;
               |FINSI;
               |CIERRA #7;
          |FINSI;
          |CIERRA #8;

          |SI nError=1;
               |MENAV "0000Este Articulo no Tiene Descuento-Comision!";
          |FINSI;

          |ERROR;

          |ESTADO_CONTROL nBotonx1, "SHOW";
          |ESTADO_CONTROL nBotonx2, "SHOW";
          |ESTADO_CONTROL nBotonx3, "SHOW";

     |FINSI;
|FPRC;
