|FICHEROS;
     agifa084 #0,MANTE;
     agifa069 #69;
     agifa142 #142;
|FINSI;

|VARIABLES;
     &enSalida = 0;
     &eaProg = "";
     &aPrograma = "";
     &ser_fac = "";
     &num_fac = 0;
     &serie = "";
     &numero = 0;
     &reimpr = "";
     nExiste = 0;
     aAlfa = "";
     aSer = "";
     aNum = "";
|FINS;

|CALCULO ActualizaLin;
     |HAZ TotalLin69;
     |GRABA 020#69a;

     ||-----------------------------Calcula la Cabecera
     |HAZ CalCabAgifa084;

     ||-----------------------------Modifi His
     |HAZ ModiHistoFC;
|FCAL;

|DEFBUCLE ActualizaLin;
     #69#1;
     ;
     #0#48, #0#0, 001;
     #0#48, #0#0, 999;
     be;
     NULL, ActualizaLin;
|FIN;

|PROGRAMA;
     aAlfa = PARAMETRO;
     aSer = aAlfa % 105;
     aNum = aAlfa % 606;

     |ABRE #142; |LEE 000#142p; |CIERRA #142;

     |PUSHV 0101 2380;
     |CLS;

     |ABRE #0;
     #0#48 = aSer;
     #0#0 = aNum;
     |LEE 101#0=;
     nExiste = FSalida;
     |PINPA #0#0;
     |PINDA #0#0;
     |SI nExiste ! 0;
          |GRABA 020#0b;
          |CONFI "0000SConfirma el alta (S/N)";
     |SINO;
          FSalida = 0;
     |FINSI;
     enSalida = FSalida;
     |SI FSalida ! 0;
          |SI nExiste ! 0; |BORRA 020#0c; |FINSI;
     |SINO;
          |SI nExiste = 0;
               |ENDATOS #2#0;
          |SINO;
               |ENDATOS #1#0;
          |FINSI;
          enSalida = FSalida;
          |SI FSalida ! 0;
               |SI nExiste ! 0; |BORRA 020#0c; |FINSI;
          |SINO;
               |HAZ LimCabAgifa084;
               |BUCLE ActualizaLin;
               |GRABA 020#0a;
               |SI #142#47 = "S";
                    eaProg = "agifa084";
                    |HAZ VenciDir;
                    |SI #142#2 = "S";
                          |GRABA 021#0a;
                          |LIBERA #0;
                          ser_fac = #0#48;
                          num_fac = #0#0;
                          aPrograma = "agifa084";
                          |SUB_EJECUTA_NP "agifa133";
                          #0#48 = ser_fac;
                          #0#0 = num_fac;
                          |LEE 020#0=;
                    |FINSI;
               |FINSI;
               |CONFI "0000NImprimir Factura S/N:";
               |SI FSalida = 0;
                    |LIBERA #0;
                    serie = #0#48;
                    numero = #0#0;
                    reimpr = #0#10;

                    |CIERRA #0;
                    |SUB_EJECUTA_NP "agifa086";
               |FINSI;
          |FINSI;
     |FINSI;
     |CIERRA #0;
     |POPV;
|FPRO;
