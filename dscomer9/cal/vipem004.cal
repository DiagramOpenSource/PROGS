||ModiAltaIP
||nCampos911  ... vipem011
||nCampos912  ... vipem012
||nCampos913  ... vipem013

|FICHEROS;
     vipem004  #0;       ||este def

     vipew004  #804,MANTE;     ||Auxiliar Contratos

     vipem005  #905;     ||Conceptos
     vipem006  #906;     ||Edificios
     vipem007  #907;     ||Contratos
     vipem014  #914;     ||Apoderados
     vipem022  #922;     ||Avisos

     vipem010  #910;     ||Conceptos Edificios
     vipem011  #911;     ||Inmuebles
     vipem012  #912;     ||Importes Edif/Concep
     vipem013  #913;     ||Importes Inmuebles
     vipem016  #916;     ||Plantillas
     vipem017  #917;     ||Control FactuVipei
     vipem019  #919;     ||Conceptos Inmuebles
     vipem020  #920;     ||Reservas
     vipem021  #921,MANTE;     ||Prorrogas

     vipew002  #802,MANTE;     ||AuxiliarConceptos
     vipew003  #803,MANTE;     ||Auxiliar Edificios
     vipew005  #805;           ||Pant.AsignarConcepto
     vipew006  #806,MANTE;     ||Aux. Inmuebles
     vipew007  #807,MANTE;     ||Aux. Imp. Edificios
     vipew008  #808,MANTE;     ||Aux. Imp. Inmuebles
     vipew009  #809,MANTE;     ||Aux. Apoderados
     vipew010  #810,MANTE;     ||Aux. Facturar
     vipew011  #811,MANTE;     ||Pedir Fecha Emision
     vipew013  #813,MANTE;     ||Aux. Reservas
     vipew014  #814,MANTE;     ||Aux. Avisos

     referen@  #2000;

     agifa024  #24;            ||Clientes
     agifa019  #19;            ||Articulos == Conceptos
     agifa060  #60;            ||Familias

     vipem008  #100;           ||Para. VIPEI Alquiler

     agifa142  #142;           ||Parametros Generales

     otrodef@  #2001;          ||Carga_DEF

     vipew015  #915;
     dsm00003  #7;             ||Direcc.Entreg.Clien.

     agifa007  #507;           ||Series
|FIN;

|VARIABLES;
     &enTiva = 0;
     &efFiva = @;
     &eaDiva = "";
     &enIva = 0;
     &enRec = 0;
     nSw5Anyos = 0;

     fHasta = @;
     aHasta = "";
     aAnyHasta = "";
     nAnyHasta = 0;
     fDesde = @;
     aDesde = "";
     aAnyDesde = "";
     nAnyDesde = 0;
     nDif = 0;

     nSwHayMas = 0;
     aListaMas = "";
     &eaImpViFac = "";         ||Imprimir facturas
     &eaImpResumFac = "";      ||Imprimir Resumen Facturacion

     aDefecto = "";
     aSistema = "";
     nPanta = 0;
     aSerie = "";
     nTotalMesFijo = 0;
     aAlqSPA = "";
     nSwHayFac = 0;
     nPosicion = 0;
     nSaca  = 0;

     &enSwAlbaPen = 0;

     &eaCta = "";
     &eswCta = 0;
     aCtaVta = "";
     aCtaCpa = "";

     nAnyos = 0;
     fTope = @;
     aFecHasta = "";
     fFecHasta = @;

     cuen      = "";
     cod      = 0;
     quitar    = 0;

     aCta = "";
     nConta2 = 0;;
     nAux = 0;
     aCaracter = "";

     aTipoAntes = "";
     aValorAntes = "";
     aTipoAhora = "";
     aValorAhora = "";

     nCampo = 0;
     aValor = "";
     nValor = 0;

     nSwMayor100 = 0;

     &eaHuecosVipei = "";
     &eaHayHuecos = "";
     &eaSerHuecos = "";

     aUsuario = "";
     aHora = "";
     &enNumEdificio = 0;
     &eaTipoContador = "";

     nEmpConta = 0;
     aEmpConta = "";
     aPathConta = "";
     aPathDatos = "";

     nDesdeIn = 0;
     nHastaIn = 0;
     enPantaInmuebles = 0;

     nNivelPan = 0;           ||Sirve para controlar el numero de Escapes
                              ||al pulsar "Volver a Inicio".
     nSwCtrlQ = 0;            ||Si estamos dentro de alguna
                              ||Alta/Modi primero ejecutamos Ctrl+Q.

     &eaMes = "";
     aAnyo = "";
     nAnyo = 0;

     &enDesdeCon = 0;
     &enHastaCon = 0;
     &enAnyFac = 0;
     &enMesFac = 0;
     &eaSerFac = "";
     &efFecFac = @;
     &enSwIncIPC = 0;
     &eaAnyoMes = "";

     aNomOri = "";
     aNomDes = "";
     aOrigen = "";
     aDestino = "";
     aVacio = "";
     aBeta = "";
     aCP = "";

     nSwError = 0;
     nSwIBI = 0;
     aNumContrato = "";
     aTipoMesAny = "";
     fSistema = @;
     aFechaSys = "";
     nTotal = 0;

     aBusco = "";

     nAlquiler = 0;
     nIbi = 0;
     aBase = "";
     &enModoExterno = 0;
     &eaDirPlantilla = "";
     &eaDirTrabajo   = "";
     &eaDirSerPlan   = "";
     &eaDirTrabServi = "";
     &eaRaiz         = "";
     &eaFicheroTra   = "";
     &eaFicheroTxt   = "";
     &eaFicheroPlaMl = "";
     &eaOrigen       = "";
     &eaDestino      = "";
     &eaDestinoTra   = "";
     &enHandleTxt    = 0;
     aAbre = "";
     nHandle = 0;
     aIPRemoto = "";
     &eaAlfa = "";
     &eaAsigna = "";
     &efFecha = @;

     nApoderado = "";
     aCodIbi = "";
     aCodAlq = "";
     aCodAlqLocal = "";
     aCodIbiLocal = "";

     nCampos911 = 21;          ||No funciona bien el |NC
     nCampos912 = 4;
     nCampos913 = 5;

     aEdifi = "";
     nVeces = 0;
     aVeces = "";
     aPiso2 = "";
     aCliente = "";

     aLong = "";
     nLong = 0;
     nConta = 0;
     aCont = "";
     aSaca = "";
     aLetra = "";
     nNumero = 0;
     nEdificio = 0;                ||Situacion Edificio Conceptos.
     aConcepto = "";
     aSitu = "";
     aSituAra = "";
     nHayPiso = 0;
     nHayEdif = 0;

     aCodPinta = "";
     aPinta = "";
     nLectura = 0;
     nWid     = 0;
     nId      = 0;
     nSid     = 0;
     nWidGuarda = 0;
     nIdGuarda  = 0;
     nSidGuarda = 0;

     nUltimo = 0;

     nCodEdi = 0;
     aCodCon = "";

     fFecha  = @;
     fDFecha = @;
     fHFecha = @;

     nPiso = 0;

     &enPantaMAIP = 0;
     &enPantaMAIE = 0;
     &enPantaMAP = 0;
     &enPantaFac = 0;

     nModoIE = 0;
     nModoIP = 0;
     nModoP = 0;

     &enBotonIE1 = 0;         ||Botones Importes Edificio
     &enBotonIE2 = 0;
     &enBotonIE3 = 0;

     &enBotonIP1 = 0;         ||Botones Importes Edificio
     &enBotonIP2 = 0;
     &enBotonIP3 = 0;

     &enBotonP1 = 0;         ||Botones Pisos
     &enBotonP2 = 0;
     &enBotonP3 = 0;
     &enBotonP4 = 0;
     &enBotonP5 = 0;

     nBotonSalir = 0;
     nConcepto = 0;
     fUltRev = @;
     nUltImp = 0;
     aTempo910 = "";
     aTempo919 = "";
     &Tempo = "";

     aFecha = "";
     aMes = "";
     nMes = 0;

     eaEntidad = "";
     eaSucursal = "";
     eaCuenta = "";
     eaDC = "";
     Digito1 = 0;
     Digito2 = 0;
     Cont = 0;
     Calc = 0;
     Comodin1 = "";
     Comodin2 = "";

     aAux = "";
     aMensaje = "";
     aCadena ="";
     nCampoHasta = 0;
     nCampoD = 0;
     nCampoH = 0;

     nPestana = -1;
     nPestanya = -1;
     aAlfa = "";
     nPantaPes = 0;
     nError    = 0;

     &enPanta1_ma = 0;
     &enPanta2_ma = 0;
     &enPanta3_ma = 0;
     &enPanta4_ma = 0;
     &enPanta5_ma = 0;
     &enPanta6_ma = 0;
     &enPanta2_aux = 0;
     &enPantaIE = 0;
     &enPantaPisos = 0;
     &enPantaIP = 0;

     &enModo = 0;
     nVentana = 0;
     nVentana2 = 0;
     nVentana3 = 0;
     nVentana4 = 0;
     nVentana5 = 0;
     nVentana6 = 0;
     nVentana7 = 0;
     nVentana8 = 0;
     {2}nNivel = 0;
     nIdSalir = 0;

     &enPanta0 = 0;
     &enPanta1 = 0;
     &enPanta2 = 0;
     &enPanta3 = 0;
     &enPanta4 = 0;
     &enPanta5 = 0;
     &enPanta6 = 0;

     &enBoton0_1  = 0;
     &enBoton0_2  = 0;
     &enBoton0_3  = 0;
     &enBoton0_4  = 0;
     &enBoton0_5  = 0;
     &enBoton0_6  = 0;
     &enBoton0_7  = 0;
     &enBoton0_8  = 0;
     &enBoton0_9  = 0;
     &enBoton0_10 = 0;
     &enBoton0_11 = 0;
     &enBoton0_12 = 0;

     &enBoton1_1 = 0;
     &enBoton1_2 = 0;
     &enBoton1_3 = 0;
     &enBoton2_1 = 0;
     &enBoton2_2 = 0;
     &enBoton2_3 = 0;
     &enBoton2_4 = 0;
     &enBoton2_5 = 0;
     &enBoton3_1 = 0;
     &enBoton3_2 = 0;
     &enBoton3_3 = 0;
     &enBoton3_4 = 0;
     &enBoton3_5 = 0;
     &enBoton4_1 = 0;
     &enBoton4_2 = 0;
     &enBoton4_3 = 0;
     &enBoton5_1 = 0;
     &enBoton5_2 = 0;
     &enBoton5_3 = 0;
     &enBoton6_1 = 0;
     &enBoton6_2 = 0;
     &enBoton6_3 = 0;

     &enBoton2_a1 = 0;
     &enBoton2_a2 = 0;

     &enGrid1 = 0;
     &enGrid2 = 0;
     &enGrid3 = 0;
     &enGrid4 = 0;
     &enGrid5 = 0;
     &enGrid6 = 0;
     &enGrid2_aux = -1;
     &enGridIE = 0;
     &enGridPisos = 0;
     &enGridIP = 0;
     &enGrid921 = 0;

     nBoton921 = 0;
     nBoton925 = 0;

     nRango = 0;
     nPos1 = 0;
     nPos2 = 0;

     aEsc1 = "";
     aEsc2 = "";
     aRetu = "";
     a804  = "";
     aTecla = "";

     aEjecuta = "";

     nFoco1 = 0;
     nFoco2 = 0;
     nFoco3 = 0;
     nFoco4 = 0;
     nFoco5 = 0;
     nFoco6 = 0;

     aNifQbf1   = "";
     aNifQbf2   = "";

     &eaVarDni  = "";
     &enCalcCif = 0;
|FIN;

|PROCESO Tipo12_w002; |TIPO 12;
|FPRC;

|PROCESO Tipo12_w003; |TIPO 12;
|FPRC;

|PROCESO Tipo12_w006; |TIPO 12;
|FPRC;

|PROCESO Tipo12_w007; |TIPO 12;
|FPRC;

|PROCESO Tipo12_w008; |TIPO 12;
|FPRC;

|PROCESO Tipo12_w009; |TIPO 12;
|FPRC;

|PROCESO Tipo12_w010; |TIPO 12;
|FPRC;

|PROCESO Tipo12_w011; |TIPO 12;
|FPRC;

|PROCESO Tipo12_w013; |TIPO 12;
|FPRC;

|PROCESO Tipo12_w014; |TIPO 12;
|FPRC;

|PROCESO Tipo66C54; |TIPO 66;
     |SI #vipew004#53 = "S";
          |ABRE #vipem005;
          |CONSULTA_CLAVE #1#vipem005;
          |SI FSalida = 0;
               #vipew004#54 = #vipem005#0;
               |PINTA #vipew004#54;
          |FINSI;
          |CIERRA #vipem005;
     |FINSI;
|FPRC;

|PROCESO Tipo80_m004; |TIPO 80;
     FSalida = 3299;
|FPRC;

|PROCESO Tipo7C0_w010; |TIPO 7;
     aFechaSys = fSistema;
     aAnyo = aFechaSys % -104;
     nAnyo = aAnyo;
     aMes = aFechaSys % 402;
     nMes = aMes;
     nMes = nMes + 1;
     |SI nMes = 13;
          nMes = 1;
          nAnyo = nAnyo + 1;
     |FINSI;

     #810#0 = nAnyo;
     #810#1 = nMes;
     |PINTA #810#0;
     |PINTA #810#1;

     |HAZ Tipo0C1_w010;
|FPRC;

|PROCESO Tipo7C1_w002; |TIPO 7;
     |HAZ Tipo0C9_w002;
|FPRC;

|PROCESO Tipo0C16_w002; |TIPO 0;
     |SI #vipew002#16 = "N"; |Y #vipew002#9 = "A"; |Y #vipew002#14 = 0;
          aMensaje = "0000No modificable, si Mes facturacion es cero";
          |MENAV aMensaje;
          #vipew002#16 = "S";
          |PINTA #vipew002#16;
          |ERROR;
     |FINSI;
|FPRC;

|PROCESO Tipo0C14_w002; |TIPO 0;
     |SI #vipew002#9 = "A"; |O #vipew002#9 = "U";
          |SI #vipew002#14 = 0;
               |SI #vipew002#9 = "A"; |Y #vipew002#16 = "S";
                    ||Mes Cero Permitido. --> Prorrateado.
               |SINO;
                    aMensaje = "0000Por favor introduzca el Mes facturacion";
                    |MENAV aMensaje;
                    #vipew002#18 = "";
                    |ERROR;
               |FINSI;
          |FINSI;
          |SI #vipew002#14 = 1;
               #vipew002#18 = "Enero";
          |FINSI;
          |SI #vipew002#14 = 2;
               #vipew002#18 = "Febrero";
          |FINSI;
          |SI #vipew002#14 = 3;
               #vipew002#18 = "Marzo";
          |FINSI;
          |SI #vipew002#14 = 4;
               #vipew002#18 = "Abril";
          |FINSI;
          |SI #vipew002#14 = 5;
               #vipew002#18 = "Mayo";
          |FINSI;
          |SI #vipew002#14 = 6;
               #vipew002#18 = "Junio";
          |FINSI;
          |SI #vipew002#14 = 7;
               #vipew002#18 = "Julio";
          |FINSI;
          |SI #vipew002#14 = 8;
               #vipew002#18 = "Agosto";
          |FINSI;
          |SI #vipew002#14 = 9;
               #vipew002#18 = "Septiembre";
          |FINSI;
          |SI #vipew002#14 = 10;
               #vipew002#18 = "Octubre";
          |FINSI;
          |SI #vipew002#14 = 11;
               #vipew002#18 = "Noviembre";
          |FINSI;
          |SI #vipew002#14 = 12;
               #vipew002#18 = "Diciembre";
          |FINSI;
          |SI #vipew002#14 = 0; |Y #vipew002#9 = "A"; |Y #vipew002#16 = "S";
               #vipew002#18 = "Prorrateo";
          |FINSI;
          |PINTA #vipew002#18;
     |FINSI;
|FPRC;

|PROCESO Tipo0C9_w002; |TIPO 0;
     |SI #vipew002#9 = "M";
          |C_M #vipew002#14, 1, "N";
          |C_M #vipew002#15, 1, "N";
     |SINO;
          |SI #vipew002#9 = "A";
               |C_M #vipew002#14, 1, "S";
               |C_M #vipew002#15, 1, "N";
          |SINO;
               |C_M #vipew002#14, 1, "S";
               |C_M #vipew002#15, 1, "S";
          |FINSI;
     |FINSI;
     |PINTA #vipew002#14;
     |PINTA #vipew002#15;
|FPRC;

|PROCESO IVA002_66; |TIPO 66;
     enTiva = #vipew002#Campo#;
     efFiva = ~;
     |HAZ ConsuIVA;
     |SI eaDiva = "";
          |ERROR;
     |SINO;
          #vipew002#Campo# = enTiva; |PINTA #vipew002#Campo#;
          #vipew002#8 = eaDiva; |PINTA #vipew002#8;
     |FINSI;
|FPRC;

|PROCESO IVA002_0; |TIPO 0;
     enTiva = #vipew002#Campo#;
     efFiva = ~;
     |HAZ SacaIVA;
     |SI eaDiva = "";
          |MENAV "0000No existe tipo iva para esta fecha...";
          |ERROR; |ACABA;
     |SINO;
          #vipew002#8 = eaDiva; |PINTA #vipew002#8;
     |FINSI;
|FPRC;


|PROCESO Tipo0C1_w010; |TIPO 0;
     nMes = #810#1;
     |HAZ DameMes;
     #810#4 = eaMes;
     |PINTA #810#4;
|FPRC;

|PROCESO DameMes;
     |SI nMes = 1;  eaMes = "Enero";      |FINSI;
     |SI nMes = 2;  eaMes = "Febrero";    |FINSI;
     |SI nMes = 3;  eaMes = "Marzo";      |FINSI;
     |SI nMes = 4;  eaMes = "Abril";      |FINSI;
     |SI nMes = 5;  eaMes = "Mayo";       |FINSI;
     |SI nMes = 6;  eaMes = "Junio";      |FINSI;
     |SI nMes = 7;  eaMes = "Julio";      |FINSI;
     |SI nMes = 8;  eaMes = "Agosto";     |FINSI;
     |SI nMes = 9;  eaMes = "Septiembre"; |FINSI;
     |SI nMes = 10;  eaMes = "Octubre";    |FINSI;
     |SI nMes = 11;  eaMes = "Noviembre";  |FINSI;
     |SI nMes = 12;  eaMes = "Diciembre";  |FINSI;
|FPRC;

|PROCESO vipem011_100;
     |SI #vipem011#1 > 99;
          nSwMayor100 = 1;
          |ERROR10;
     |FINSI;
|FPRC;

|DEFBUCLE vipem011_100;
 #vipem011#1;
 ;
 #803#0,   0;
 #803#0, 999;
 ;
 NULL, vipem011_100;
|FIN;

|PROCESO Tipo0C10w003; |TIPO 0;
     |SI #vipew003#10 = "A";
          nSwMayor100 = 0;
          |BUCLE vipem011_100;
          |SI nSwMayor100 = 1;
               aMensaje = "0000Existen inmuebles con Codigo superior a 100, lo que impide modificar este valor";
               |MENAV aMensaje;
               #vipew003#10 = "B";
               |PINTA #vipew003#10;
               |ERROR;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Tipo0C11w009; TIPO 0;
     |SI FSalida = 10;
         eaVarDni   = #809#7;
         enCalcCif  = 1;
         |HAZ CalculoNIFCIF;
         #809#7 = eaVarDni;
         |PINTA #809#7;
         |ERROR;
         |ACABA;
     |FINSI;

     eaVarDni  = #809#7;
     enCalcCif = 0;
     |HAZ CalculoNIFCIF;
     aNifQbf1 = #809#7;    |QBF aNifQbf1;
     aNifQbf2 = eaVarDni;  |QBF aNifQbf2;

     |SI aNifQbf1 ! aNifQbf2; |Y aNifQbf1 ! "";
         |CONFI "0000SEl Nif puede ser Erroneo. Desea Calcularlo.";
         |SI FSalida = 0;
             #809#7 = eaVarDni;  |PINTA #809#7;
             |ERROR;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO Boton0_1;
     |HAZ QuitaBotones;
     aEjecuta = "vipem008;NOMEQUITESQUETECORTOLOSHUEVOS";
     |SUB_EJECUTA_NP aEjecuta;
     |HAZ PonBotones;

     |PULSATECLA;
     |PULSATECLA;
     |PULSATECLA;
|FPRC;

|PROCESO QuitaBotones;
     |ESTADO_CONTROL enBoton0_1, "HIDE";
     |ESTADO_CONTROL enBoton0_2, "HIDE";
     |ESTADO_CONTROL enBoton0_3, "HIDE";
     |ESTADO_CONTROL enBoton0_9, "HIDE";
     |ESTADO_CONTROL enBoton0_10, "HIDE";
     |ESTADO_CONTROL enBoton0_12, "HIDE";

     |ESTADO_CONTROL enBoton1_1, "HIDE";
     |ESTADO_CONTROL enBoton1_2, "HIDE";
     |ESTADO_CONTROL enBoton1_3, "HIDE";

     |ESTADO_CONTROL enBoton2_1, "HIDE";
     |ESTADO_CONTROL enBoton2_2, "HIDE";
     |ESTADO_CONTROL enBoton2_3, "HIDE";
     |ESTADO_CONTROL enBoton2_4, "HIDE";
     |ESTADO_CONTROL enBoton2_5, "HIDE";

     |ESTADO_CONTROL enBoton3_1, "HIDE";
     |ESTADO_CONTROL enBoton3_2, "HIDE";
     |ESTADO_CONTROL enBoton3_3, "HIDE";
     |ESTADO_CONTROL enBoton3_4, "HIDE";
     |ESTADO_CONTROL enBoton3_5, "HIDE";

     |ESTADO_CONTROL enBoton4_1, "HIDE";
     |ESTADO_CONTROL enBoton4_2, "HIDE";
     |ESTADO_CONTROL enBoton4_3, "HIDE";

     nIdSalir = 0;
     |HAZ ObtenIdSalir;
     |ESTADO_CONTROL nIdSalir, "HIDE";
|FPRC;

|PROCESO ObtenIdSalir;
     InNivel = nNivel1<-;
     nNivel1 = 0;
     |ESPECIFICA "IDBOTONTECLA", nNivel;
     nIdSalir = nNivel2;
|FPRC;

|PROCESO PonBotones;
     |ESTADO_CONTROL enBoton0_1, "SHOW";
     |ESTADO_CONTROL enBoton0_2, "SHOW";
     |ESTADO_CONTROL enBoton0_3, "SHOW";
     |ESTADO_CONTROL enBoton0_9, "SHOW";
     |ESTADO_CONTROL enBoton0_10, "SHOW";
     |ESTADO_CONTROL enBoton0_12, "SHOW";

     |ESTADO_CONTROL enBoton1_1, "SHOW";
     |ESTADO_CONTROL enBoton1_2, "SHOW";
     |ESTADO_CONTROL enBoton1_3, "SHOW";

     |ESTADO_CONTROL enBoton2_1, "SHOW";
     |ESTADO_CONTROL enBoton2_2, "SHOW";
     |ESTADO_CONTROL enBoton2_3, "SHOW";
     |ESTADO_CONTROL enBoton2_4, "SHOW";
     |ESTADO_CONTROL enBoton2_5, "SHOW";

     |ESTADO_CONTROL enBoton3_1, "SHOW";
     |ESTADO_CONTROL enBoton3_2, "SHOW";
     |ESTADO_CONTROL enBoton3_3, "SHOW";
     |ESTADO_CONTROL enBoton3_4, "SHOW";
     |ESTADO_CONTROL enBoton3_5, "SHOW";

     |ESTADO_CONTROL enBoton4_1, "SHOW";
     |ESTADO_CONTROL enBoton4_2, "SHOW";
     |ESTADO_CONTROL enBoton4_3, "SHOW";

     |ESTADO_CONTROL nIdSalir, "SHOW";
|FPRC;

|PROCESO Boton0_2;
     |ESTADO_CONTROL enBoton0_1, "HIDE";
     |ESTADO_CONTROL enBoton0_2, "HIDE";
     |ESTADO_CONTROL enBoton0_3, "HIDE";
     |ESTADO_CONTROL enBoton0_9, "HIDE";
     |ESTADO_CONTROL enBoton0_10, "HIDE";
     |ESTADO_CONTROL enBoton0_12, "HIDE";

     |VENTANA 0501, 3299, -1, 1, ""; nVentana = FSalida;
     |SUB_EJECUTA "vipez005";
     |FINVENTANA nVentana;

     |ESTADO_CONTROL enBoton0_1, "SHOW";
     |ESTADO_CONTROL enBoton0_2, "SHOW";
     |ESTADO_CONTROL enBoton0_3, "SHOW";
     |ESTADO_CONTROL enBoton0_9, "SHOW";
     |ESTADO_CONTROL enBoton0_10, "SHOW";
     |ESTADO_CONTROL enBoton0_12, "SHOW";
|FPRC;

|PROCESO Boton0_3;
     |ESTADO_CONTROL enBoton0_1, "HIDE";
     |ESTADO_CONTROL enBoton0_2, "HIDE";
     |ESTADO_CONTROL enBoton0_3, "HIDE";
     |ESTADO_CONTROL enBoton0_9, "HIDE";
     |ESTADO_CONTROL enBoton0_10, "HIDE";
     |ESTADO_CONTROL enBoton0_12, "HIDE";

     |VENTANA 0501, 3299, -1, 1, ""; nVentana = FSalida;

     |SI eaHuecosVipei = "";
          eaHuecosVipei = "N";
     |FINSI;

     |SUB_EJECUTA "vipez003";
     |FINVENTANA nVentana;

     |ESTADO_CONTROL enBoton0_1, "SHOW";
     |ESTADO_CONTROL enBoton0_2, "SHOW";
     |ESTADO_CONTROL enBoton0_3, "SHOW";
     |ESTADO_CONTROL enBoton0_9, "SHOW";
     |ESTADO_CONTROL enBoton0_10, "SHOW";
     |ESTADO_CONTROL enBoton0_12, "SHOW";
|FPRC;

|PROCESO Boton0_9;
     |ESTADO_CONTROL enBoton0_1, "HIDE";
     |ESTADO_CONTROL enBoton0_2, "HIDE";
     |ESTADO_CONTROL enBoton0_3, "HIDE";
     |ESTADO_CONTROL enBoton0_9, "HIDE";
     |ESTADO_CONTROL enBoton0_10, "HIDE";
     |ESTADO_CONTROL enBoton0_12, "HIDE";

     |VENTANA 0501, 3299, -1, 1, ""; nVentana = FSalida;
     |SUB_EJECUTA "vipez004";
     |FINVENTANA nVentana;

     |ESTADO_CONTROL enBoton0_1, "SHOW";
     |ESTADO_CONTROL enBoton0_2, "SHOW";
     |ESTADO_CONTROL enBoton0_3, "SHOW";
     |ESTADO_CONTROL enBoton0_9, "SHOW";
     |ESTADO_CONTROL enBoton0_10, "SHOW";
     |ESTADO_CONTROL enBoton0_12, "SHOW";
|FPRC;

|PROCESO Boton0_10;
     |ESTADO_CONTROL enBoton0_1, "HIDE";
     |ESTADO_CONTROL enBoton0_2, "HIDE";
     |ESTADO_CONTROL enBoton0_3, "HIDE";
     |ESTADO_CONTROL enBoton0_9, "HIDE";
     |ESTADO_CONTROL enBoton0_10, "HIDE";
     |ESTADO_CONTROL enBoton0_12, "HIDE";

     |VENTANA 0501, 3299, -1, 1, ""; nVentana = FSalida;
     |SUB_EJECUTA "vipey001";
     |FINVENTANA nVentana;

     |ESTADO_CONTROL enBoton0_1, "SHOW";
     |ESTADO_CONTROL enBoton0_2, "SHOW";
     |ESTADO_CONTROL enBoton0_3, "SHOW";
     |ESTADO_CONTROL enBoton0_9, "SHOW";
     |ESTADO_CONTROL enBoton0_10, "SHOW";
     |ESTADO_CONTROL enBoton0_12, "SHOW";
|FPRC;

|PROCESO Boton0_12;
     |ESTADO_CONTROL enBoton0_1, "HIDE";
     |ESTADO_CONTROL enBoton0_2, "HIDE";
     |ESTADO_CONTROL enBoton0_3, "HIDE";
     |ESTADO_CONTROL enBoton0_9, "HIDE";
     |ESTADO_CONTROL enBoton0_10, "HIDE";
     |ESTADO_CONTROL enBoton0_12, "HIDE";

     |VENTANA 0501, 3299, -1, 1, ""; nVentana = FSalida;
     ||ARA. ||Informe Facturacion
     |SUB_EJECUTA "vipez012";
     |FINVENTANA nVentana;

     |ESTADO_CONTROL enBoton0_1, "SHOW";
     |ESTADO_CONTROL enBoton0_2, "SHOW";
     |ESTADO_CONTROL enBoton0_3, "SHOW";
     |ESTADO_CONTROL enBoton0_9, "SHOW";
     |ESTADO_CONTROL enBoton0_10, "SHOW";
     |ESTADO_CONTROL enBoton0_12, "SHOW";
|FPRC;


|PROCESO SalConPtecs;
     |SI nNivelPan = 4;
          |PTEC 806;
          |PTEC 806;
          |PTEC 806;
          |SI nSwCtrlQ = 1;
               |PTEC 807;
               nSwCtrlQ = 0;
          |SINO;
               |PTEC 806;
          |FINSI;
     |SINO;
          |SI nNivelPan = 3;
               |PTEC 806;
               |PTEC 806;
               |SI nSwCtrlQ = 1;
                    |PTEC 807;
                    nSwCtrlQ = 0;
               |SINO;
                    |PTEC 806;
               |FINSI;
          |SINO;
               |SI nNivelPan = 2;
                    |PTEC 806;
                    |SI nSwCtrlQ = 1;
                         |PTEC 807;
                         nSwCtrlQ = 0;
                    |SINO;
                         |PTEC 806;
                    |FINSI;
               |SINO;
                    |SI nSwCtrlQ = 1;
                         |PTEC 807;
                         nSwCtrlQ = 0;
                    |SINO;
                         |PTEC 806;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Pestanya1;
     nPestanya = 1;
     |PTEC 804;

     |HAZ SalConPtecs;
|FPRC;

|PROCESO Pestanya2;
     nPestanya = 2;
     |PTEC 804;

     |HAZ SalConPtecs;
|FPRC;

|PROCESO Pestanya3;
     nPestanya = 3;
     |PTEC 804;

     |HAZ SalConPtecs;
|FPRC;

|PROCESO Pestanya4;
     nPestanya = 4;
     |PTEC 804;

     |HAZ SalConPtecs;
|FPRC;

|PROCESO Pestanya5;
     nPestanya = 5;
     |PTEC 804;

     |HAZ SalConPtecs;
|FPRC;

|PROCESO Pestanya6;
     nPestanya = 6;
     |PTEC 804;

     |HAZ SalConPtecs;
|FPRC;

|PROCESO BotonesPanta0;
     nPos1 = 0554;   nPos2 = 0574;
     |CONTROL_SIMPLE enPanta0, "BOTON,{{197}}Par metros", nPos1, nPos2, Boton0_1;
     enBoton0_1    = FSalida;

     nPos1 = 0654;   nPos2 = 0674;
     |CONTROL_SIMPLE enPanta0, "BOTON,{{205}}Emitir Avisos", nPos1, nPos2, Boton0_2;
     enBoton0_2    = FSalida;

     nPos1 = 0754;   nPos2 = 0774;
     |CONTROL_SIMPLE enPanta0, "BOTON,{{205}}Informe situaci¢n", nPos1, nPos2, Boton0_10;
     enBoton0_10   = FSalida;

     nPos1 = 0577;   nPos2 = 0597;
     |CONTROL_SIMPLE enPanta0, "BOTON,{{205}}Facturaci¢n masiva", nPos1, nPos2, Boton0_3;
     enBoton0_3    = FSalida;

     nPos1 = 0677;   nPos2 = 0697;
     |CONTROL_SIMPLE enPanta0, "BOTON,{{207}}Borrado facturas", nPos1, nPos2, Boton0_9;
     enBoton0_9    = FSalida;

     nPos1 = 0777;   nPos2 = 0797;
     |CONTROL_SIMPLE enPanta0, "BOTON,{{205}}Informe facturacion", nPos1, nPos2, Boton0_12;
     enBoton0_12   = FSalida;

     nPos1 = 0903;   nPos2 = 0906;
     |CONTROL_SIMPLE enPanta0, "BOTON,{{197}}", nPos1, nPos2, Pestanya1;
     enBoton0_4    = FSalida;

     nPos1 = 0911;   nPos2 = 0914;
     |CONTROL_SIMPLE enPanta0, "BOTON,{{197}}", nPos1, nPos2, Pestanya2;
     enBoton0_5    = FSalida;

     nPos1 = 0918;   nPos2 = 0921;
     |CONTROL_SIMPLE enPanta0, "BOTON,{{197}}", nPos1, nPos2, Pestanya3;
     enBoton0_6    = FSalida;

     nPos1 = 0926;   nPos2 = 0929;
     |CONTROL_SIMPLE enPanta0, "BOTON,{{197}}", nPos1, nPos2, Pestanya4;
     enBoton0_7    = FSalida;

     nPos1 = 0934;   nPos2 = 0937;
     |CONTROL_SIMPLE enPanta0, "BOTON,{{197}}", nPos1, nPos2, Pestanya5;
     enBoton0_8    = FSalida;

     nPos1 = 0941;   nPos2 = 0944;
     |CONTROL_SIMPLE enPanta0, "BOTON,{{197}}", nPos1, nPos2, Pestanya6;
     enBoton0_11    = FSalida;

     |HAZ BotonInicio;
|FPRC;

|PROCESO DisablaPestanyas;
     aAlfa = nPantaPes;
     |MAINCOMMAND 32913, "-1", "-1", aAlfa, "-1", "-1";
     |SI FSalida > 0;
          nPestana = FSalida;
          |ESTADO_CONTROL nPestana, "DISABLE";
     |FINSI;
|FPRC;

|PROCESO EnablaPestanyas;
     |SI nPestana > 0;
          |ESTADO_CONTROL nPestana, "ENABLE";
          nPestana = -1;
     |FINSI;
|FPRC;

||************* PESTA¥A 1. CONCEPTOS ***************************************
|PROCESO EventoPanta1;
     |SI FSalida = 1;  |O FSalida = 2;
         |LEE 000#905=;
         |SI FSalida = 0;
             |ESTADO_CONTROL enBoton1_2, "ENABLE";
             |ESTADO_CONTROL enBoton1_3, "ENABLE";
         |SINO;
             |ESTADO_CONTROL enBoton1_2, "DISABLE";
             |ESTADO_CONTROL enBoton1_3, "DISABLE";
         |FINSI;
     |FINSI;

     |SI FSalida = 4;
          |HAZ Boton1_2;
     |FINSI;
|FPRC;

|PROCESO Boton1_1;
     enModo = 1;
     |HAZ ModiAlta1;
     |REFRESCACONTROL enGrid1; |FOCOTECLADO enGrid1;
|FPRC;

|PROCESO Boton1_2;
     |LEE 000#905.=;
     |SI FSalida ! 0;
          |ESTADO_CONTROL enBoton1_2, "DISABLE";
          |ESTADO_CONTROL enBoton1_3, "DISABLE";
          |ACABA;
     |SINO;
          enModo = 2;
          |HAZ ModiAlta1;
          |REFRESCACONTROL enGrid1; |FOCOTECLADO enGrid1;
     |FINSI;
|FPRC;

|PROCESO Boton1_3;
     |LEE 000#905.=;
     |SI FSalida ! 0;
          |ESTADO_CONTROL enBoton1_2, "DISABLE";
          |ESTADO_CONTROL enBoton1_3, "DISABLE";
          |ACABA;
     |SINO;
          aMensaje = "0000NSeguro de dar de baja: " + #905#1;
          |QBF aMensaje;
          aMensaje = aMensaje + " ?";
          |CONFI aMensaje;
          |SI FSalida ! 0; |ACABA; |FINSI;

          |LEE 101#905.=;
          |SI FSalida = 0;
               |BORRA 020#905a;
               |LIBERA #905;
               FSalida = 1;
               |HAZ EventoPanta1;
          |FINSI;
     |FINSI;

     |REFRESCACONTROL enGrid1; |FOCOTECLADO enGrid1;
|FPRC;

|PROCESO ModiAlta1;
     |ESTADO_CONTROL enBoton0_1, "HIDE";
     |ESTADO_CONTROL enBoton0_2, "HIDE";
     |ESTADO_CONTROL enBoton0_3, "HIDE";
     |ESTADO_CONTROL enBoton0_9, "HIDE";
     |ESTADO_CONTROL enBoton0_10, "HIDE";
     |ESTADO_CONTROL enBoton0_12, "HIDE";

     nPantaPes = enPanta1;
     |HAZ DisablaPestanyas;

     ||Sin referenciar a ninguna pantalla en concreto. FALLA.
     ||VENTANA 1101, 3299, -1, 1, ""; nVentana = FSalida;

     ||Referenciandolo a la pantalla inferior. YA NO FALLA.
     |VENTANA 0501, 2799, enPanta1, 1, ""; nVentana = FSalida;

     ||Referenciandolo a la pantalla inferior. CENTRADO AUTOMATICO. OK.
     ||Pero no me sirve, pq. pinta la pantalla donde el quiere.
     ||VENTANA 0501, 2799, enPanta1, -1, ""; nVentana = FSalida;

     ||Referenciandola a la pantalla principal. FALLA
     ||VENTANA 1101, 3399, enPanta0, 1, ""; nVentana = FSalida;

     |PINPA #0#802;
     enPanta1_ma = FSalida;
     |PINDA #0#802;

     |LEE 101#905=;

     aCadena ="|NC";
     aAlfa = #905#aCadena#;
     nCampoHasta = aAlfa;
     nCampoHasta = nCampoHasta - 1;

     |SI enModo ! 1;
          |PARA nCampoD = 0;  |SI nCampoD [ nCampoHasta;   |HACIENDO nCampoD = nCampoD + 1;
                nCampoH = nCampoD;
                #802nCampoH = #905nCampoD;
          |SIGUE;

          |C_M #802#0, 1, "N";
     |SINO;
          |C_M #802#0, 1, "S";
          |DDEFECTO #802;
     |FINSI;

     |PINPA #0#802;
     |PINDA #0#802;

     |SI enModo = 1;  |ENDATOS #1#802;  |FINSI;
     |SI enModo = 2;  |ENDATOS #2#802;  |FINSI;

     |LIBERA #905;

     |SI FSalida = 0;
          |HAZ GrabaDatos1;
     |FINSI;

     |FINVENTANA nVentana;

     |HAZ EnablaPestanyas;

     |ESTADO_CONTROL enBoton0_1, "SHOW";
     |ESTADO_CONTROL enBoton0_2, "SHOW";
     |ESTADO_CONTROL enBoton0_3, "SHOW";
     |ESTADO_CONTROL enBoton0_9, "SHOW";
     |ESTADO_CONTROL enBoton0_10, "SHOW";
     |ESTADO_CONTROL enBoton0_12, "SHOW";
|FPRC;

|PROCESO DameCtas;
     aCtaVta = #802#11;
     |QBF aCtaVta;
     eaCta = aCtaVta + ".";
     |HAZ MFiltraPtos;
     aCtaVta = eaCta;

     aCtaCpa = #802#12;
     |QBF aCtaCpa;
     eaCta = aCtaCpa + ".";
     |HAZ MFiltraPtos;
     aCtaCpa = eaCta;
|FPRC;

|PROCESO GrabaDatos1;
     #905#0 = #802#0;
     |LEE 101#905=;
     |SI FSalida ! 0;
         |DDEFECTO #905;
         #905#0 = #802#0;
         |GRABA 020#905b;
     |FINSI;

     |ABRE #agifa019;
     |DDEFECTO #agifa019;
     #agifa019#0 = #802#0;
     |LEE 101#agifa019.=;
     |SI FSalida ! 0; |GRABA 020#agifa019.b; |FINSI;

     #agifa019#1 = #802#1;
     #agifa019#30 = #802#7;
     #agifa019#130 = #802#13;

     ||Grabar tb. FAMILIAS
     |ABRE #agifa060;
     aAux = #agifa019#0;
     aAux = aAux % 103;
     #agifa060#0 = aAux;
     |LEE 101#agifa060.=;
     |SI FSalida ! 0; |GRABA 020#agifa060.b; |FINSI;

     #agifa060#1 = #agifa019#1;

     |HAZ DameCtas;

     #agifa060#3 = aCtaVta;
     #agifa060#2 = aCtaCpa;
     |GRABA 020#agifa060.a;
     |LIBERA #agifa060;
     |CIERRA #agifa060;

     #agifa019#2 = aAux;

     |GRABA 020#agifa019.a;
     |LIBERA #agifa019;
     |CIERRA #agifa019;

     |PARA nCampoD = 1;  |SI nCampoD [ nCampoHasta;  |HACIENDO nCampoD = nCampoD + 1;
          nCampoH   = nCampoD;
          |SI nCampoD ! 10;
               #905nCampoD = #802nCampoH;
          |SINO;
               |SI #905#9 = "M";
                    #905#10 = "Mensual";
               |SINO;
                    |SI #905#9 = "U";
                         #905#10 = "Unico";
                    |SINO;
                         #905#10 = "Anual";
                    |FINSI;
               |FINSI;
          |FINSI;
     |SIGUE;

     |GRABA 020#905a;
     |LIBERA #905;
|FPRC;

|PROCESO NoRepetido1; |TIPO 0;
     |SI enModo ! 1;  |ACABA;  |FINSI;

     #905#0 = #802#0;
     |LEE 000#905=;
     |SI FSalida = 0;
         |MENAV "0000 El Codigo de Concepto ya Existe.";
         |ERROR;
     |SINO;
          |ABRE #agifa019;
          |DDEFECTO #agifa019;
          #agifa019#0 = #802#0;
          |LEE 000#agifa019.=;
          |SI FSalida = 0;
               |MENAV "0000 Codigo de Concepto ya existente en la Gestion.";
               |ERROR;
          |FINSI;
          |CIERRA #agifa019;
     |FINSI;
|FPRC;

|PROCESO EventoFocoGrid1;
     FSalida = 1;
     |HAZ EventoPanta1;

     |REFRESCACONTROL enGrid1;
     |FOCOTECLADO enGrid1;
|FPRC;

|PROCESO Grid1;
     nRango = 4 + 8 + 16 + 32;
     nPos1  = 0602;
     nPos2  = 2598;

     |LINEAL_SIMPLE #1#905, nRango, nPos1, nPos2, NULL, NULL, EventoPanta1;
     enGrid1  = FSalida;

     |CONTROL_SIMPLE enPanta1, "EVENTOPAN", 0000, 0000, EventoFocoGrid1;
     nFoco1 = FSalida;
|FPRC;

|PROCESO BotonesPanta1;
     nPos1 = 2764;  nPos2 = 2774;
     |CONTROL_SIMPLE enPanta1, "BOTON,{{193}}Nuevo", nPos1, nPos2, Boton1_1;
     enBoton1_1 = FSalida;

     nPos1 = 2776;  nPos2 = 2786;
     |CONTROL_SIMPLE enPanta1, "BOTON,{{197}}Modificar", nPos1, nPos2, Boton1_2;
     enBoton1_2 = FSalida;

     nPos1 = 2788;  nPos2 = 2798;
     |CONTROL_SIMPLE enPanta1, "BOTON,{{199}}Borrar", nPos1, nPos2, Boton1_3;
     enBoton1_3 = FSalida;
|FPRC;

||************* FINAL PESTA¥A 1. CONCEPTOS ***************************************


||************* PESTA¥A 2. EDIFICIOS ***************************************
|PROCESO EventoPanta2;
     |SI FSalida = 1;  |O FSalida = 2;
         |LEE 000#906=;
         |SI FSalida = 0;
             |ESTADO_CONTROL enBoton2_2, "ENABLE";
             |ESTADO_CONTROL enBoton2_3, "ENABLE";
             |ESTADO_CONTROL enBoton2_4, "ENABLE";
             |ESTADO_CONTROL enBoton2_5, "ENABLE";
         |SINO;
             |ESTADO_CONTROL enBoton2_2, "DISABLE";
             |ESTADO_CONTROL enBoton2_3, "DISABLE";
             |ESTADO_CONTROL enBoton2_4, "DISABLE";
             |ESTADO_CONTROL enBoton2_5, "DISABLE";
         |FINSI;
     |FINSI;

     |SI FSalida = 4;
          |HAZ Boton2_2;
     |FINSI;
|FPRC;

|PROCESO Boton2_1;
     enModo = 1;
     |HAZ ModiAlta2;
     |REFRESCACONTROL enGrid2; |FOCOTECLADO enGrid2;
|FPRC;

|PROCESO Boton2_2;
     |LEE 000#906.=;
     |SI FSalida ! 0;
          |ESTADO_CONTROL enBoton2_2, "DISABLE";
          |ESTADO_CONTROL enBoton2_3, "DISABLE";
          |ESTADO_CONTROL enBoton2_4, "DISABLE";
          |ESTADO_CONTROL enBoton2_5, "DISABLE";
          |ACABA;
     |SINO;
          enModo = 2;
          |HAZ ModiAlta2;
          |REFRESCACONTROL enGrid2; |FOCOTECLADO enGrid2;
     |FINSI;
|FPRC;

|PROCESO Boton2_3;
     |LEE 000#906.=;
     |SI FSalida ! 0;
          |ESTADO_CONTROL enBoton2_2, "DISABLE";
          |ESTADO_CONTROL enBoton2_3, "DISABLE";
          |ESTADO_CONTROL enBoton2_4, "DISABLE";
          |ESTADO_CONTROL enBoton2_5, "DISABLE";
          |ACABA;
     |SINO;
          aMensaje = "0000NSeguro de dar de baja: " + #906#1;
          |QBF aMensaje;
          aMensaje = aMensaje + " ?";
          |CONFI aMensaje;
          |SI FSalida ! 0; |ACABA; |FINSI;

          |LEE 101#906.=;
          |SI FSalida = 0;
               |BORRA 020#906a;
               |LIBERA #906;
               FSalida = 1;
               |HAZ EventoPanta2;
          |FINSI;
     |FINSI;

     |REFRESCACONTROL enGrid2; |FOCOTECLADO enGrid2;
|FPRC;

|PROCESO ModiAlta2;
     |ESTADO_CONTROL enBoton0_1, "HIDE";
     |ESTADO_CONTROL enBoton0_2, "HIDE";
     |ESTADO_CONTROL enBoton0_3, "HIDE";
     |ESTADO_CONTROL enBoton0_9, "HIDE";
     |ESTADO_CONTROL enBoton0_10, "HIDE";
     |ESTADO_CONTROL enBoton0_12, "HIDE";

     nPantaPes = enPanta2;
     |HAZ DisablaPestanyas;

     |VENTANA 1101, 3299, -1, 1, ""; nVentana = FSalida;

     |PINPA #0#803;
     enPanta2_ma = FSalida;
     |PINDA #0#803;

     |LEE 101#906=;

     aCadena ="|NC";
     aAlfa = #906#aCadena#;
     nCampoHasta = aAlfa;
     nCampoHasta = nCampoHasta - 1;

     |SI enModo ! 1;
          |PARA nCampoD = 0;  |SI nCampoD [ nCampoHasta;   |HACIENDO nCampoD = nCampoD + 1;
                nCampoH = nCampoD;
                #803nCampoH = #906nCampoD;
          |SIGUE;

          |C_M #803#0, 1, "N";
          aTipoAntes = #803#11 + #803#12 + #803#13 + #803#14 + #803#15 + #803#16 + #803#17;
          aValorAntes = #803#18 + #803#19 + #803#20 + #803#21 + #803#22 + #803#23 + #803#24;
     |SINO;
          |C_M #803#0, 1, "S";
          |DDEFECTO #803;
     |FINSI;

     |PINPA #0#803;
     |PINDA #0#803;

     |SI enModo = 1;  |ENDATOS #1#803;  |FINSI;
     |SI enModo = 2;  |ENDATOS #2#803;  |FINSI;

     |LIBERA #906;

     |SI FSalida = 0;
          aTipoAhora= #803#11 + #803#12 + #803#13 + #803#14 + #803#15 + #803#16 + #803#17;
          aValorAhora = #803#18 + #803#19 + #803#20 + #803#21 + #803#22 + #803#23 + #803#24;
          |HAZ GrabaDatos2;
          |SI aTipoAntes ! aTipoAhora; |O aValorAntes ! aValorAhora;
               |HAZ RecalculoCtaAna;
          |FINSI;
     |FINSI;

     |FINVENTANA nVentana;

     |HAZ EnablaPestanyas;

     |ESTADO_CONTROL enBoton0_1, "SHOW";
     |ESTADO_CONTROL enBoton0_2, "SHOW";
     |ESTADO_CONTROL enBoton0_3, "SHOW";
     |ESTADO_CONTROL enBoton0_9, "SHOW";
     |ESTADO_CONTROL enBoton0_10, "SHOW";
     |ESTADO_CONTROL enBoton0_12, "SHOW";
|FPRC;

|PROCESO vipem007_cta;
     aCta = "";
     |PARA nConta = 11; |SI nConta [ 17; |HACIENDO nConta = nConta + 1;
          nConta2 = nConta + 7;
          |SI #803#nConta# = "F";
               aCta = aCta + #803#nConta2#;
          |SINO;
               aAux = #803#nConta2#;
               nAux = aAux;
               |SI nAux = 1;
                    aCaracter = #vipem007#3 % 101;
               |SINO;
                    |SI nAux = 2;
                         aCaracter = #vipem007#3 % 201;
                    |SINO;
                         |SI nAux = 3;
                              aCaracter = #vipem007#3 % 301;
                         |SINO;
                              |SI nAux = 4;
                                   aCaracter = #vipem007#3 % 401;
                              |SINO;
                                   |SI nAux = 5;
                                        aCaracter = #vipem007#3 % 501;
                                   |SINO;    ||6
                                        aCaracter = #vipem007#3 % 601;
                                   |FINSI;
                              |FINSI;
                         |FINSI;
                    |FINSI;
               |FINSI;
               aCta = aCta + aCaracter;
          |FINSI;
     |SIGUE;
     #vipem007#35 = aCta;
     |GRABA 020#vipem007.a;
|FPRC;

|DEFBUCLE vipem007_cta;
 #vipem007#2;
 ;
 #803#0,   0,        1;
 #803#0, 999, 99999999;
 be;
 NULL, vipem007_cta;
|FIN;

|PROCESO RecalculoCtaAna;
     ||Recalculando, actualizando Ctas.Analiticas.
     |BUCLE vipem007_cta;
|FPRC;

|PROCESO GrabaDatos2;
     #906#0 = #803#0;
     |LEE 101#906=;
     |SI FSalida ! 0;
         |DDEFECTO #906;
         #906#0 = #803#0;
         |GRABA 020#906b;
     |FINSI;

     |PARA nCampoD = 1;  |SI nCampoD [ nCampoHasta;  |HACIENDO nCampoD = nCampoD + 1;
          nCampoH   = nCampoD;
          #906nCampoD = #803nCampoH;
     |SIGUE;

     |GRABA 020#906a;
     |LIBERA #906;
|FPRC;

|PROCESO ctos_piso;
     nHayPiso = 1;
     nUltImp = #vipem013#4;
     fUltRev = #vipem013#3;
|FPRC;

|DEFBUCLE ctos_piso;
 #vipem013#1;
 ;
 nEdificio, nDesdeIn, aConcepto, "01.01.0000";
 nEdificio, nHastaIn, aConcepto, "31.12.2999";
 ;
 NULL, ctos_piso;
|FIN;

|PROCESO ctos_edif;
     nHayEdif = 1;
     nUltImp = #vipem012#3;
     fUltRev = #vipem012#2;
|FPRC;

|DEFBUCLE ctos_edif;
 #vipem012#1;
 ;
 nEdificio, aConcepto, "01.01.0000";
 nEdificio, aConcepto, "31.12.2999";
 ;
 NULL, ctos_edif;
|FIN;

|PROCESO DameSituacion;
     ||MANOLO

     ||IN: nEdificio, aConcepto, nDesdeIn, nHastaIn
     ||OUT: aSitu

     nHayPiso = 0;
     nHayEdif = 0;
     |BUCLE ctos_edif;
     |BUCLE ctos_piso;

     |SI nHayPiso = 0; |Y nHayEdif = 0;
          aSitu = "S";
     |SINO;
          |SI nHayPiso = 1; |Y nHayEdif = 1;
               aSitu = "A";
          |SINO;
               |SI nHayPiso = 1;
                    aSitu = "V";
               |SINO;
                    aSitu = "F";
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO vipem005;
     |DDEFECTO #910;
     #910#0 = #906#0;
     #910#1 = #905#0;
     |LEE 101#910=;
     |SI FSalida ! 0; |GRABA 020#910b; |FINSI;
     #910#2 = #905#1;
     #910#3 = #905#9;
     #910#4 = #905#10;

     aSitu = "S";
     nEdificio = #910#0;
     aConcepto = #910#1;
     nDesdeIn = 0;
     nHastaIn = 999;
     fUltRev = "01.01.0000";
     nUltImp = 0;
     |HAZ DameSituacion;
     #910#5 = aSitu;
     |SI aSitu = "F";
          #910#6 = "fijo";
     |SINO;
          |SI aSitu = "V";
               #910#6 = "variable";
          |SINO;
               |SI aSitu = "A";
                    #910#6 = "ambos";
               |SINO;
                    #910#6 = "sin asignar";
               |FINSI;
          |FINSI;
     |FINSI;
     #910#7 = fUltRev;
     #910#8 = nUltImp;
     |GRABA 020#910a;
     |LIBERA #910;

     |DDEFECTO #910;
     #910#0 = #906#0;
     #910#1 = "ZZTOT";
     |LEE 101#910=;
     |SI FSalida ! 0; |GRABA 020#910b; |FINSI;
     #910#5 = "";
     #910#6 = "";
     |GRABA 020#910a;
     |LIBERA #910;

     |DDEFECTO #910;
     #910#0 = #906#0;
     #910#1 = "ZZTOTU";
     |LEE 101#910=;
     |SI FSalida ! 0; |GRABA 020#910b; |FINSI;
     #910#5 = "";
     #910#6 = "";
     #910#2 = "TOTAL UNICOS FIJOS";

     |SI aSitu = "F";  |Y #905#9 = "U";
         #910#8 = #910#8 + nUltImp;
     |FINSI;

     |GRABA 020#910a;
     |LIBERA #910;

     |DDEFECTO #910;
     #910#0 = #906#0;
     #910#1 = "ZZTOTM";
     |LEE 101#910=;
     |SI FSalida ! 0; |GRABA 020#910b; |FINSI;
     #910#5 = "";
     #910#6 = "";
     #910#2 = "TOTAL MENSUALES FIJOS";

     |SI aSitu = "F";  |Y #905#9 = "M";
         #910#8 = #910#8 + nUltImp;
     |FINSI;

     |GRABA 020#910a;
     |LIBERA #910;
|FPRC;

|DEFBUCLE vipem005;
 #vipem005#1;
 ;
 INICIO;
 FINAL;
 ;
 NULL, vipem005;
|FIN;

|PROCESO RellenaConceptos;
     nConcepto = #905#0;

     |BUCLE vipem005;
     #905#0 = nConcepto;
     |LEE 000#905=;
|FPRC;

|PROCESO vipem005_19;
     |DDEFECTO #919;
     #919#0 = #911#0;
     #919#1 = #911#1;
     #919#2 = #905#0;
     |LEE 101#919=;
     |SI FSalida ! 0; |GRABA 020#919b; |FINSI;
     #919#3 = #905#1;
     #919#4 = #905#9;
     #919#5 = #905#10;

     aSitu = "S";
     nEdificio = #919#0;
     nDesdeIn = #919#1;
     nHastaIn = #919#1;
     aConcepto = #919#2;
     fUltRev = "01.01.0000";
     nUltImp = 0;
     |HAZ DameSituacion;
     #919#6 = aSitu;
     |SI aSitu = "F";
          #919#7 = "fijo";
     |SINO;
          |SI aSitu = "V";
               #919#7 = "variable";
          |SINO;
               |SI aSitu = "A";
                    #919#7 = "ambos";
               |SINO;
                    #919#7 = "sin asignar";
               |FINSI;
          |FINSI;
     |FINSI;
     #919#8 = fUltRev;
     #919#9 = nUltImp;
     |GRABA 020#919a;
     |LIBERA #919;

     |DDEFECTO #919;
     #919#0 = #911#0;
     #919#1 = #911#1;
     #919#2 = "ZZTOT";
     |LEE 101#919=;
     |SI FSalida ! 0; |GRABA 020#919b; |FINSI;
     #919#6 = "";
     #919#7 = "";
     |GRABA 020#919a;
     |LIBERA #919;

     |DDEFECTO #919;
     #919#0 = #911#0;
     #919#1 = #911#1;
     #919#2 = "ZZTOTU";
     |LEE 101#919=;
     |SI FSalida ! 0; |GRABA 020#919b; |FINSI;
     #919#6 = "";
     #919#7 = "";
     #919#3 = "TOTAL UNICOS";

     |SI #905#9 = "U";
         #919#9 = #919#9 + nUltImp;
     |FINSI;

     |GRABA 020#919a;
     |LIBERA #919;

     |DDEFECTO #919;
     #919#0 = #911#0;
     #919#1 = #911#1;
     #919#2 = "ZZTOTM";
     |LEE 101#919=;
     |SI FSalida ! 0; |GRABA 020#919b; |FINSI;
     #919#6 = "";
     #919#7 = "";
     #919#3 = "TOTAL MENSUALES FIJOS";

     |SI #905#9 = "M";
         #919#9 = #919#9 + nUltImp;
     |FINSI;

     |GRABA 020#919a;
     |LIBERA #919;
|FPRC;

|DEFBUCLE vipem005_19;
 #vipem005#1;
 ;
 INICIO;
 FINAL;
 ;
 NULL, vipem005_19;
|FIN;

|PROCESO RellenaConceptos19;
     |BUCLE vipem005_19;
|FPRC;

|PROCESO Evento910;
     |SI FSalida = 1;  |O FSalida = 2;
         |ESTADO_CONTROL enBoton2_a1, "ENABLE";

         |LEE 000#910=;
         |SI FSalida ! 0;
             |ESTADO_CONTROL enBoton2_a1, "DISABLE";
         |FINSI;

         aAlfa = #910#1 % 105;  |QBF aAlfa
         |SI aAlfa = "ZZTOT";
             |ESTADO_CONTROL enBoton2_a1, "DISABLE";
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO Evento919;
     |SI FSalida = 1;  |O FSalida = 2;
         |ESTADO_CONTROL enBotonP4, "ENABLE";

         |LEE 000#919=;
         |SI FSalida ! 0;
             |ESTADO_CONTROL enBotonP4, "DISABLE";
         |FINSI;

         aAlfa = #919#2 % 105;  |QBF aAlfa
         |SI aAlfa = "ZZTOT";
             |ESTADO_CONTROL enBotonP4, "DISABLE";
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO EventoIE;
     |SI FSalida = 1;  |O FSalida = 2;
         |LEE 000#912=;
         |SI FSalida = 0; |Y #912#0 = #910#0; |Y #912#1 = #910#1;
             |ESTADO_CONTROL enBotonIE2, "ENABLE";
             |ESTADO_CONTROL enBotonIE3, "ENABLE";
         |SINO;
             |ESTADO_CONTROL enBotonIE2, "DISABLE";
             |ESTADO_CONTROL enBotonIE3, "DISABLE";
         |FINSI;
     |FINSI;

     |SI FSalida = 4;
          |HAZ BotonIE2;
     |FINSI;
|FPRC;

|PROCESO Baja12;
     #912#0 = #910#0;
     #912#1 = #910#1;
     #912#2 = "01.01.0000";
|FPRC;

|PROCESO Alta12;
     #912#0 = #910#0;
     #912#1 = #910#1;
     #912#2 = "31.12.2999";
|FPRC;

|PROCESO BotonSalir;
     |PTEC 802;
|FPRC;

|PROCESO EventoPisos;
     |SI FSalida = 1;  |O FSalida = 2;
         |LEE 000#911=;
         |SI FSalida = 0; |Y #911#0 = #906#0;
             |ESTADO_CONTROL enBotonP2, "ENABLE";
             |ESTADO_CONTROL enBotonP3, "ENABLE";
             |ESTADO_CONTROL enBotonP5, "ENABLE";
         |SINO;
             |ESTADO_CONTROL enBotonP2, "DISABLE";
             |ESTADO_CONTROL enBotonP3, "DISABLE";
             |ESTADO_CONTROL enBotonP5, "DISABLE";
         |FINSI;
     |FINSI;

     |SI FSalida = 4;
          |HAZ BotonP2;
     |FINSI;
|FPRC;

|PROCESO BotonIE1;
     nNivelPan = nNivelPan + 1;
     |HAZ BotonInicio;
     nSwCtrlQ = 1;
     nModoIE = 1;
     nCodEdi = #910#0;
     aCodCon = #910#1;
     |HAZ ModiAltaIE;
     |REFRESCACONTROL enGridIE; |FOCOTECLADO enGridIE;
     nNivelPan = nNivelPan - 1;
     |HAZ BotonInicio;
     nSwCtrlQ = 0;
|FPRC;

|PROCESO BotonIE2;
     nNivelPan = nNivelPan + 1;
     |HAZ BotonInicio;
     nSwCtrlQ = 1;
     nModoIE = 2;
     |HAZ ModiAltaIE;
     |REFRESCACONTROL enGridIE; |FOCOTECLADO enGridIE;
     nNivelPan = nNivelPan - 1;
     |HAZ BotonInicio;
     nSwCtrlQ = 0;
|FPRC;

|PROCESO vipem013_mas;
     nSwHayMas = nSwHayMas + 1;
     |SI nSwHayMas = 1;
          aListaMas = aListaMas + #vipem013#2;
     |SINO;
          aListaMas = aListaMas + "," + #vipem013#2;
     |FINSI;
|FPRC;

|DEFBUCLE vipem013_mas;
 #vipem013#1;
 ;
 #807#0,   0, #807#1, "01.01.0000";
 #807#0, 999, #807#1, "31.12.2999";
 ;
 NULL, vipem013_mas;
|FIN;


|PROCESO ModiAltaIE;
     |VENTANA 1101, 3299, -1, 1, ""; nVentana4 = FSalida;

     |HAZ HideInicio;

     |PINPA #0#807;
     enPantaMAIE = FSalida;
     |PINDA #0#807;

     |LEE 101#912=;

     |SI nModoIE ! 1;
          |PARA nCampoD = 0;  |SI nCampoD [ nCampos912;   |HACIENDO nCampoD = nCampoD + 1;
                nCampoH = nCampoD;
                #807nCampoH = #912nCampoD;
          |SIGUE;

          |C_M #807#0, 1, "N";
          |C_M #807#1, 1, "N";
          |C_M #807#2, 1, "N";
     |SINO;
          |C_M #807#0, 1, "S";
          |C_M #807#1, 1, "S";
          |C_M #807#2, 1, "S";
          |DDEFECTO #807;
          #807#0 = nCodEdi;
          #807#1 = aCodCon;
     |FINSI;

     |PINPA #0#807;
     |PINDA #0#807;

     |SI nModoIE = 1;  |ENDATOS #1#807;  |FINSI;
     |SI nModoIE = 2;  |ENDATOS #2#807;  |FINSI;

     |LIBERA #912;

     |SI FSalida = 0;
          nSwHayMas = 0;
          aListaMas = "";
          |BUCLE vipem013_mas;
          |SI nSwHayMas = 1;
               aMensaje = "0000Existen inmueble " + aListaMas + " con importes para este concepto";
               |MENAV aMensaje;
          |SINO;
               |SI nSwHayMas > 1;
                    aMensaje = "0000Existen inmuebles " + aListaMas + " con importes para este concepto";
                    |MENAV aMensaje;
               |FINSI;
          |FINSI;

          |HAZ GrabaDatos912;
     |FINSI;

     |FINVENTANA nVentana4;

     |HAZ ShowInicio;
|FPRC;

|PROCESO GrabaDatos912;
     |SI #807#2 ! "01.01.0000";
          #912#0 = #807#0;
          #912#1 = #807#1;
          #912#2 = #807#2;
          |LEE 101#912=;
          |SI FSalida ! 0;
              |DDEFECTO #912;
              #912#0 = #807#0;
              #912#1 = #807#1;
              #912#2 = #807#2;
              |GRABA 020#912b;
          |FINSI;

          |PARA nCampoD = 3;  |SI nCampoD [ nCampos912;  |HACIENDO nCampoD = nCampoD + 1;
               nCampoH   = nCampoD;
               #912nCampoD = #807nCampoH;
          |SIGUE;

          |GRABA 020#912a;
          |LIBERA #912;
     |FINSI;
|FPRC;

|PROCESO NoRepetido912; |TIPO 0;
     aFecha = #807#2;
     |QBF aFecha;
     |SI aFecha = "01.01.0000";
          |MENAV "0000 Introduzca Fecha Desde";
          |ERROR;
     |FINSI;

     |SI nModoIE ! 1;  |ACABA;  |FINSI;

     #912#0 = #807#0;
     #912#1 = #807#1;
     #912#2 = #807#2;
     |LEE 000#912=;
     |SI FSalida = 0;
         |MENAV "0000 Registro ya Existe.";
         |ERROR;
     |FINSI;
|FPRC;

|PROCESO BotonIE3;
     |LEE 000#912.=;
     |SI FSalida ! 0;
          |ESTADO_CONTROL enBotonIE2, "DISABLE";
          |ESTADO_CONTROL enBotonIE3, "DISABLE";
          |ACABA;
     |SINO;
          aMensaje = "0000NSeguro de dar de baja: " + #912#2;
          |QBF aMensaje;
          aMensaje = aMensaje + " ?";
          |CONFI aMensaje;
          |SI FSalida ! 0; |ACABA; |FINSI;

          |LEE 101#912.=;
          |SI FSalida = 0;
               |BORRA 020#912a;
               |LIBERA #912;
               FSalida = 1;
               |HAZ EventoIE;
          |FINSI;
     |FINSI;

     |REFRESCACONTROL enGridIE; |FOCOTECLADO enGridIE;
|FPRC;


|PROCESO BotonesIE;
     nPos1 = 2664;  nPos2 = 2674;
     |CONTROL_SIMPLE enPantaIE, "BOTON,{{193}}Nuevo", nPos1, nPos2, BotonIE1;
     enBotonIE1 = FSalida;

     nPos1 = 2676;  nPos2 = 2686;
     |CONTROL_SIMPLE enPantaIE, "BOTON,{{197}}Modificar", nPos1, nPos2, BotonIE2;
     enBotonIE2 = FSalida;

     nPos1 = 2688;  nPos2 = 2698;
     |CONTROL_SIMPLE enPantaIE, "BOTON,{{199}}Borrar", nPos1, nPos2, BotonIE3;
     enBotonIE3 = FSalida;
|FPRC;

|PROCESO Boton2_a1;   ||Editar Importes Edificios
     nNivelPan = nNivelPan + 1;
     |HAZ BotonInicio;

     |VENTANA 1101, 3299, -1, 1, ""; nVentana2 = FSalida;

     |ABRE #912;

     |PINPA #0#912;
     enPantaIE = FSalida;

     nLectura = 0;
     nWidGuarda = enPantaIE;
     |PCONTEXTO nLectura, nWidGuarda, nIdGuarda, nSidGuarda;

     aCodPinta = #910#1 % 108;
     |QBF aCodPinta;
     aPinta   = #906#0 + ". " + #906#1 + " Concepto: " + aCodPinta + ". " + #910#2;
     |QBF aPinta;
     |HAZ PintaMsg;

     nRango = 4 + 8 + 16 + 32;
     nPos1  = 0702;
     nPos2  = 2498;

     |LINEAL_SIMPLE #1#912, nRango, nPos1, nPos2, Baja12, Alta12, EventoIE;
     enGridIE = FSalida;

     |HAZ BotonesIE;

     FSalida = 1;
     |HAZ EventoIE;

     aEsc1  = &255 + "806";
     aEsc2  = &255 + "807";
     aRetu  = &255 + "802";
     |PARA; |SI;  |HACIENDO;
         FSalida = "::{{001}}Salir," + enGridIE;
         |LEETECLA aTecla;
         |SI aTecla = aEsc1; |SAL;  |FINSI;
         |SI aTecla = aEsc2; |SAL;  |FINSI;
         |SI aTecla = aRetu; |SAL;  |FINSI;
     |SIGUE;

     |DESTRUYECONTROL enGridIE;

     |FIN_CONTROL_WINDOWS enBotonIE1;
     |FIN_CONTROL_WINDOWS enBotonIE2;
     |FIN_CONTROL_WINDOWS enBotonIE3;

     |CIERRA #912;
     |FINVENTANA nVentana2;

     |HAZ ActualizaSitu;
     |REFRESCACONTROL enGrid2_aux;

     nNivelPan = nNivelPan - 1;
     |HAZ BotonInicio;
|FPRC;

|PROCESO ActualizaSitu_19;
     aSituAra = #919#6;

     aSitu = "S";
     nEdificio = #919#0;
     nDesdeIn = #919#1;
     nHastaIn = #919#1;
     aConcepto = #919#2;
     fUltRev = "01.01.0000";
     nUltImp = 0;
     |HAZ DameSituacion;

     |SI aSituAra ! aSitu;
          #919#0 = nEdificio;
          #919#1 = nDesdeIn;
          #919#2 = aConcepto;
          |LEE 101#919=;
          |SI FSalida = 0;
               #919#6 = aSitu;
               |SI aSitu = "F";
                    #919#7 = "fijo";
               |SINO;
                    |SI aSitu = "V";
                         #919#7 = "variable";
                    |SINO;
                         |SI aSitu = "A";
                              #919#7 = "ambos";
                         |SINO;
                              #919#7 = "sin asignar";
                         |FINSI;
                    |FINSI;
               |FINSI;
               #919#8 = fUltRev;
               #919#9 = nUltImp;
               |GRABA 020#919a;
               |LIBERA #919;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO ActualizaSitu;
     aSituAra = #910#5;

     aSitu = "S";
     nEdificio = #910#0;
     aConcepto = #910#1;
     nDesdeIn = 0;
     nHastaIn = 999;
     fUltRev = "01.01.0000";
     nUltImp = 0;
     |HAZ DameSituacion;

     |SI aSituAra ! aSitu;
          #910#0 = nEdificio;
          #910#1 = aConcepto;
          |LEE 101#910=;
          |SI FSalida = 0;
               #910#5 = aSitu;
               |SI aSitu = "F";
                    #910#6 = "fijo";
               |SINO;
                    |SI aSitu = "V";
                         #910#6 = "variable";
                    |SINO;
                         |SI aSitu = "A";
                              #910#6 = "ambos";
                         |SINO;
                              #910#6 = "sin asignar";
                         |FINSI;
                    |FINSI;
               |FINSI;
               #910#7 = fUltRev;
               #910#8 = nUltImp;
               |GRABA 020#910a;
               |LIBERA #910;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO BotonP1;
     nNivelPan = nNivelPan + 1;
     |HAZ BotonInicio;
     nSwCtrlQ = 1;
     nModoP = 1;
     ||nCodEdi = #911#0;      || se llevaba mal el codigo de edificio
     nCodEdi = #906#0;        ||R.PRIEGO (21/8/2006)
     |HAZ ModiAltaP;
     |REFRESCACONTROL enGridPisos; |FOCOTECLADO enGridPisos;
     nNivelPan = nNivelPan - 1;
     |HAZ BotonInicio;
     nSwCtrlQ = 0;
|FPRC;

|PROCESO BotonP2;
     |LEE 000#911.=;
     |SI FSalida ! 0; |O #911#0 ! #906#0;
          |ESTADO_CONTROL enBotonP2, "DISABLE";
          |ESTADO_CONTROL enBotonP3, "DISABLE";
          |ESTADO_CONTROL enBotonP5, "DISABLE";
          |ACABA;
     |FINSI;

     nNivelPan = nNivelPan + 1;
     |HAZ BotonInicio;
     nSwCtrlQ = 1;
     nModoP = 2;
     nCodEdi = #910#0;
     |HAZ ModiAltaP;
     |REFRESCACONTROL enGridPisos; |FOCOTECLADO enGridPisos;
     nNivelPan = nNivelPan - 1;
     |HAZ BotonInicio;
     nSwCtrlQ = 0;
|FPRC;

|PROCESO ModiAltaP;
     |VENTANA 1101, 3299, -1, 1, ""; nVentana5 = FSalida;

     |HAZ HideInicio;

     |PINPA #0#806;
     enPantaMAP = FSalida;
     |PINDA #0#806;

     |LEE 101#911=;

     |SI nModoP ! 1;
          |PARA nCampoD = 0;  |SI nCampoD [ nCampos911;   |HACIENDO nCampoD = nCampoD + 1;
                nCampoH = nCampoD;
                #806nCampoH = #911nCampoD;
          |SIGUE;

          |C_M #806#0, 1, "N";
          |C_M #806#1, 1, "N";
     |SINO;
          |C_M #806#0, 1, "N";
          |C_M #806#1, 1, "S";
          |DDEFECTO #806;
          #806#0  = nCodEdi;
          #806#12 = #906#1;
          #806#13 = #906#2;
          #806#14 = #906#4;
          #806#15 = #906#5;
          #806#16 = #906#6;
          #806#17 = #906#7;
     |FINSI;

     |PINPA #0#806;
     |PINDA #0#806;

     |SI nModoP = 1;  |ENDATOS #1#806;  |FINSI;
     |SI nModoP = 2;  |ENDATOS #2#806;  |FINSI;

     |LIBERA #911;

     |SI FSalida = 0;
          |HAZ GrabaDatos911;
     |FINSI;

     |FINVENTANA nVentana5;

     |HAZ ShowInicio;
|FPRC;

|PROCESO GrabaDatos911;
     #911#0 = #806#0;
     #911#1 = #806#1;
     |LEE 101#911=;
     |SI FSalida ! 0;
         |DDEFECTO #911;
         #911#0 = #806#0;
         #911#1 = #806#1;
         |GRABA 020#911b;
     |FINSI;

     |PARA nCampoD = 2;  |SI nCampoD [ nCampos911;  |HACIENDO nCampoD = nCampoD + 1;
          nCampoH   = nCampoD;
          |SI nCampoH ! 8;
               #911nCampoD = #806nCampoH;
          |SINO;
               |SI #911#7 = "L";
                    #911#8 = "Libre";
               |SINO;
                    |SI #911#7 = "O";
                         #911#8 = "Ocupado";
                    |SINO;
                 ||        #911#8 = "Reservado";
                    |FINSI;
               |FINSI;
          |FINSI;
     |SIGUE;

     |GRABA 020#911a;
     |LIBERA #911;
|FPRC;

|PROCESO NoRepetido911; |TIPO 0;
     |SI nModoP ! 1;  |ACABA;  |FINSI;

     |SI #806#1 > 9;
          enNumEdificio = #806#0;
          |HAZ DameTipoContador;
          |SI eaTipoContador = "A";
               aMensaje = "0000Número máximo de inmuebles 10 (del 0 al 9)";
               |MENAV aMensaje;
               |ERROR;
          |FINSI;
     |FINSI;

     #911#0 = #806#0;
     #911#1 = #806#1;
     |LEE 000#911=;
     |SI FSalida = 0;
         |MENAV "0000 Registro ya Existe.";
         |ERROR;
     |FINSI;
|FPRC;

|PROCESO BotonP3;
     |LEE 000#911.=;
     |SI FSalida ! 0; |O #911#0 ! #906#0;
          |ESTADO_CONTROL enBotonP2, "DISABLE";
          |ESTADO_CONTROL enBotonP3, "DISABLE";
          |ESTADO_CONTROL enBotonP5, "DISABLE";
          |ACABA;
     |SINO;
          aAux = #911#0 + "/" + #911#1;
          |QBF aAux;
          aMensaje = "0000NSeguro de dar de baja: " + aAux;
          |QBF aMensaje;
          aMensaje = aMensaje + " ?";
          |CONFI aMensaje;
          |SI FSalida ! 0; |ACABA; |FINSI;

          |LEE 101#911.=;
          |SI FSalida = 0;
               |BORRA 020#911a;
               |LIBERA #911;
               FSalida = 1;
               |HAZ EventoPisos;
          |FINSI;
     |FINSI;

     |REFRESCACONTROL enGridPisos; |FOCOTECLADO enGridPisos;
|FPRC;

|PROCESO BotonIP1;
     nNivelPan = nNivelPan + 1;
     |HAZ BotonInicio;
     nSwCtrlQ = 1;
     nModoIP = 1;
     nCodEdi = #919#0;
     nPiso = #919#1;
     aCodCon = #919#2;
     |HAZ ModiAltaIP;
     |REFRESCACONTROL enGridIP; |FOCOTECLADO enGridIP;
     nNivelPan = nNivelPan - 1;
     |HAZ BotonInicio;
     nSwCtrlQ = 0;
|FPRC;

|PROCESO BotonIP2;
     nNivelPan = nNivelPan + 1;
     |HAZ BotonInicio;
     nSwCtrlQ = 1;
     nModoIP = 2;
     |HAZ ModiAltaIP;
     |REFRESCACONTROL enGridIP; |FOCOTECLADO enGridIP;
     nNivelPan = nNivelPan - 1;
     |HAZ BotonInicio;
     nSwCtrlQ = 0;
|FPRC;

|PROCESO vipem012_mas;
     nSwHayMas = nSwHayMas + 1;
|FPRC;

|DEFBUCLE vipem012_mas;
 #vipem012#1;
 ;
 #808#0, #808#1, "01.01.0000";
 #808#0, #808#1, "31.12.2999";
 ;
 NULL, vipem012_mas;
|FIN;

|PROCESO ModiAltaIP;
     |VENTANA 1101, 3299, -1, 1, ""; nVentana6 = FSalida;

     |PINPA #0#808;
     enPantaMAIP = FSalida;
     |PINDA #0#808;

     |LEE 101#913=;

     |SI nModoIP ! 1;
          |PARA nCampoD = 0;  |SI nCampoD [ nCampos913;   |HACIENDO nCampoD = nCampoD + 1;
                nCampoH = nCampoD;
                #808nCampoH = #913nCampoD;
          |SIGUE;

          |C_M #808#0, 1, "N";
          |C_M #808#1, 1, "N";
          |C_M #808#2, 1, "N";
          |C_M #808#3, 1, "N";
     |SINO;
          |C_M #808#0, 1, "S";
          |C_M #808#1, 1, "S";
          |C_M #808#2, 1, "S";
          |C_M #808#3, 1, "S";
          |DDEFECTO #808;
          #808#0 = nCodEdi;
          #808#1 = aCodCon;
          #808#2 = nPiso;
     |FINSI;

     |PINPA #0#808;
     |PINDA #0#808;

     |SI nModoIP = 1;  |ENDATOS #1#808;  |FINSI;
     |SI nModoIP = 2;  |ENDATOS #2#808;  |FINSI;

     |LIBERA #913;

     |SI FSalida = 0;
          nSwHayMas = 0;
          aListaMas = "";
          |BUCLE vipem012_mas;
          |SI nSwHayMas > 0;
               aMensaje = "0000Atencion, Edificio con importes para este concepto";
               |MENAV aMensaje;
          |FINSI;

          |HAZ GrabaDatos913;
     |FINSI;

     |FINVENTANA nVentana6;
|FPRC;

|PROCESO GrabaDatos913;
     |SI #808#3 ! "01.01.0000";
          #913#0 = #808#0;
          #913#1 = #808#1;
          #913#2 = #808#2;
          #913#3 = #808#3;
          |LEE 101#913=;
          |SI FSalida ! 0;
              |DDEFECTO #913;
              #913#0 = #808#0;
              #913#1 = #808#1;
              #913#2 = #808#2;
              #913#3 = #808#3;
              |GRABA 020#913b;
          |FINSI;

          |PARA nCampoD = 4;  |SI nCampoD [ nCampos913;  |HACIENDO nCampoD = nCampoD + 1;
               nCampoH   = nCampoD;
               #913nCampoD = #808nCampoH;
          |SIGUE;

          |GRABA 020#913a;
          |LIBERA #913;
     |FINSI;
|FPRC;

|PROCESO NoRepetido913; |TIPO 0;
     aFecha = #808#3;
     |QBF aFecha;
     |SI aFecha = "01.01.0000";
         |MENAV "0000 Introduzca Fecha Desde";
         |ERROR;
     |FINSI;

     |SI nModoIP ! 1;  |ACABA;  |FINSI;

     #913#0 = #808#0;
     #913#1 = #808#1;
     #913#2 = #808#2;
     #913#3 = #808#3;
     |LEE 000#913=;
     |SI FSalida = 0;
         |MENAV "0000 Registro ya Existe.";
         |ERROR;
     |FINSI;
|FPRC;

|PROCESO BotonIP3;
     |LEE 000#913.=;
     |SI FSalida ! 0;
          |ESTADO_CONTROL enBotonIP2, "DISABLE";
          |ESTADO_CONTROL enBotonIP3, "DISABLE";
          |ACABA;
     |SINO;
          aMensaje = "0000NSeguro de dar de baja: " + #913#3;
          |QBF aMensaje;
          aMensaje = aMensaje + " ?";
          |CONFI aMensaje;
          |SI FSalida ! 0; |ACABA; |FINSI;

          |LEE 101#913.=;
          |SI FSalida = 0;
               |BORRA 020#913a;
               |LIBERA #913;
               FSalida = 1;
               |HAZ EventoIP;
          |FINSI;
     |FINSI;

     |REFRESCACONTROL enGridIP; |FOCOTECLADO enGridIP;
|FPRC;

|PROCESO BotonesIP;
     nPos1 = 2664;  nPos2 = 2674;
     |CONTROL_SIMPLE enPantaIP, "BOTON,{{193}}Nuevo", nPos1, nPos2, BotonIP1;
     enBotonIP1 = FSalida;

     nPos1 = 2676;  nPos2 = 2686;
     |CONTROL_SIMPLE enPantaIP, "BOTON,{{197}}Modificar", nPos1, nPos2, BotonIP2;
     enBotonIP2 = FSalida;

     nPos1 = 2688;  nPos2 = 2698;
     |CONTROL_SIMPLE enPantaIP, "BOTON,{{199}}Borrar", nPos1, nPos2, BotonIP3;
     enBotonIP3 = FSalida;
|FPRC;

|PROCESO EventoIP;
     |SI FSalida = 1;  |O FSalida = 2;
         |LEE 000#913=;
         |SI FSalida = 0; |Y #913#0 = #919#0; |Y #913#1 = #919#2; |Y #913#2 = #919#1;
             |ESTADO_CONTROL enBotonIP2, "ENABLE";
             |ESTADO_CONTROL enBotonIP3, "ENABLE";
         |SINO;
             |ESTADO_CONTROL enBotonIP2, "DISABLE";
             |ESTADO_CONTROL enBotonIP3, "DISABLE";
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO Baja13;
     #913#0 = #919#0;
     #913#1 = #919#2;
     #913#2 = #919#1;
     #913#3 = "01.01.0000";
|FPRC;

|PROCESO Alta13;
     #913#0 = #919#0;
     #913#1 = #919#2;
     #913#2 = #919#1;
     #913#3 = "31.12.2999";
|FPRC;

|PROCESO BotonP5;       ||Asignar Conceptos Inmuebles
     |LEE 000#911.=;
     |SI FSalida ! 0; |O #911#0 ! #906#0;
          |ESTADO_CONTROL enBotonP2, "DISABLE";
          |ESTADO_CONTROL enBotonP3, "DISABLE";
          |ESTADO_CONTROL enBotonP5, "DISABLE";
          |ACABA;
     |FINSI;

     nNivelPan = nNivelPan + 1;
     |HAZ BotonInicio;

     |HAZ CreaTempo; aTempo919 = Tempo;
     |NOME_DAT #919 aTempo919; |DELINDEX #919;
     |ABRE #919;
     |HAZ RellenaConceptos19;

/*
     |ESTADO_CONTROL enBoton0_1, "HIDE";
     |ESTADO_CONTROL enBoton0_2, "HIDE";
     |ESTADO_CONTROL enBoton0_3, "HIDE";
     |ESTADO_CONTROL enBoton0_9, "HIDE";
     |ESTADO_CONTROL enBoton0_10, "HIDE";
     |ESTADO_CONTROL enBoton0_12, "HIDE";

     nPantaPes = enPantaPisos;
     |HAZ DisablaPestanyas;
*/

     |VENTANA 1101, 3299, -1, 1, ""; nVentana8 = FSalida;

     |PINPA #0#805;
     enPantaInmuebles = FSalida;

     nLectura = 0;
     nWidGuarda = enPanta2_aux;
     |PCONTEXTO nLectura, nWidGuarda, nIdGuarda, nSidGuarda;

     aCodPinta = #911#1;
     aPinta   = #906#0 + ". " + #906#1 + " Num. Inmueble: " + aCodPinta;
     |HAZ PintaMsg;

     nRango = 4 + 8 + 16 + 32;
     nPos1  = 0702;
     nPos2  = 2498;

     |LEE 000#919p;

     |LINEAL_SIMPLE #1#919, nRango, nPos1, nPos2, NULL, NULL, Evento919;
     enGrid2_aux  = FSalida;

     |HAZ BotonesInmuebles;

     FSalida = 1;
     |HAZ Evento919;
     |FOCOTECLADO enGrid2_aux;

     aEsc1  = &255 + "806";
     aEsc2  = &255 + "807";
     aRetu  = &255 + "802";
     |PARA; |SI;  |HACIENDO;
         FSalida = "::{{001}}Salir," + enGrid2_aux;
         |LEETECLA aTecla;
         |SI aTecla = aEsc1; |SAL;  |FINSI;
         |SI aTecla = aEsc2; |SAL;  |FINSI;
         |SI aTecla = aRetu; |SAL;  |FINSI;
     |SIGUE;

     |PULSATECLA;

     |DESTRUYECONTROL enGrid2_aux;
     |FIN_CONTROL_WINDOWS enBoton2_a1;
     |FIN_CONTROL_WINDOWS enBoton2_a2;

     |CIERRA #919;

     |FINVENTANA nVentana8;

/*
     |HAZ EnablaPestanyas;

     |ESTADO_CONTROL enBoton0_1, "SHOW";
     |ESTADO_CONTROL enBoton0_2, "SHOW";
     |ESTADO_CONTROL enBoton0_3, "SHOW";
     |ESTADO_CONTROL enBoton0_9, "SHOW";
     |ESTADO_CONTROL enBoton0_10, "SHOW";
     |ESTADO_CONTROL enBoton0_12, "SHOW";
*/

     |DELINDEX #919;
     Tempo = aTempo919;
     |HAZ BoraTempo;

     nNivelPan = nNivelPan - 1;
     |HAZ BotonInicio;
|FPRC;


|PROCESO BotonP4;     ||Importes Inmuebles
     nNivelPan = nNivelPan + 1;
     |HAZ BotonInicio;

     aAlfa = #919#2 % 105;  |QBF aAlfa
     |SI aAlfa = "ZZTOT";
          |ESTADO_CONTROL enBotonP4, "DISABLE";
          nNivelPan = nNivelPan - 1;
          |HAZ BotonInicio;
          |ACABA;
     |FINSI;

     |VENTANA 1101, 3299, -1, 1, ""; nVentana3 = FSalida;

     |ABRE #913;

     |PINPA #0#913;
     enPantaIP = FSalida;

     nLectura = 0;
     nWidGuarda = enPantaIE;
     |PCONTEXTO nLectura, nWidGuarda, nIdGuarda, nSidGuarda;

     aCodPinta = #911#1 % 102;
     aPinta   = #906#0 + ". " + #906#1 + " Num. Inmueble: " + aCodPinta + "   Concepto: " + #919#2;
     |QBF aPinta;
     |HAZ PintaMsg;

     nRango = 4 + 8 + 16 + 32;
     nPos1  = 0702;
     nPos2  = 2498;

     |LINEAL_SIMPLE #1#913, nRango, nPos1, nPos2, Baja13, Alta13, EventoIP;
     enGridIP = FSalida;

     |HAZ BotonesIP;

     FSalida = 1;
     |HAZ EventoIP;

     aEsc1  = &255 + "806";
     aEsc2  = &255 + "807";
     aRetu  = &255 + "802";
     |PARA; |SI;  |HACIENDO;
         FSalida = "::{{001}}Salir," + enGridIP;
         |LEETECLA aTecla;
         |SI aTecla = aEsc1; |SAL;  |FINSI;
         |SI aTecla = aEsc2; |SAL;  |FINSI;
         |SI aTecla = aRetu; |SAL;  |FINSI;
     |SIGUE;

     |DESTRUYECONTROL enGridIP;

     |FIN_CONTROL_WINDOWS enBotonIP1;
     |FIN_CONTROL_WINDOWS enBotonIP2;
     |FIN_CONTROL_WINDOWS enBotonIP3;

     |CIERRA #913;
     |FINVENTANA nVentana3;
     nNivelPan = nNivelPan - 1;
     |HAZ BotonInicio;

     |HAZ ActualizaSitu_19;
     |REFRESCACONTROL enGrid2_aux;
|FPRC;

|PROCESO BotonesPisos;
     nPos1 = 2664;  nPos2 = 2674;
     |CONTROL_SIMPLE enPantaPisos, "BOTON,{{193}}Nuevo", nPos1, nPos2, BotonP1;
     enBotonP1 = FSalida;

     nPos1 = 2676;  nPos2 = 2686;
     |CONTROL_SIMPLE enPantaPisos, "BOTON,{{197}}Modificar", nPos1, nPos2, BotonP2;
     enBotonP2 = FSalida;

     nPos1 = 2688;  nPos2 = 2698;
     |CONTROL_SIMPLE enPantaPisos, "BOTON,{{199}}Borrar", nPos1, nPos2, BotonP3;
     enBotonP3 = FSalida;

     nPos1 = 2602;  nPos2 = 2616;
     |CONTROL_SIMPLE enPantaPisos, "BOTON,Asignar Conceptos", nPos1, nPos2, BotonP5;
     enBotonP5 = FSalida;
|FPRC;

|PROCESO BotonesInmuebles;
     nPos1 = 2602;  nPos2 = 2618;
     |CONTROL_SIMPLE enPantaInmuebles, "BOTON,{{197}}Importes Inmuebles", nPos1, nPos2, BotonP4;
     enBotonP4 = FSalida;
|FPRC;

|PROCESO Baja11;
     #911#0 = #906#0;
     #911#1 = 0;
|FPRC;

|PROCESO Alta11;
     #911#0 = #906#0;
     #911#1 = 999;
|FPRC;

|PROCESO Botones2_aux;
     nPos1 = 2602;  nPos2 = 2616;
     |CONTROL_SIMPLE enPanta2_aux, "BOTON,{{197}}Importes Edificios", nPos1, nPos2, Boton2_a1;
     enBoton2_a1 = FSalida;
|FPRC;

|PROCESO PintaMsg;
     aPinta = aPinta % 198;
     nLectura = 1;

|| Pantalla 1

     nWid     = nWidGuarda;
     nId      = nIdGuarda;
     nSid     = nSidGuarda;
     |PCONTEXTO nLectura, nWid, nId, nSid;

     |ATRI N;
     |PINTA 0602, aPinta;
     |ATRI n;

     |PCONTEXTO nLectura, nWidGuarda, nIdGuarda, nSidGuarda;
|FPRC;

|PROCESO Boton2_4;       ||Asignar Conceptos Edificios
     nNivelPan = nNivelPan + 1;
     |HAZ BotonInicio;

     |HAZ CreaTempo; aTempo910 = Tempo;
     |NOME_DAT #910 aTempo910; |DELINDEX #910;
     |ABRE #910;
     |HAZ RellenaConceptos;

     |ESTADO_CONTROL enBoton0_1, "HIDE";
     |ESTADO_CONTROL enBoton0_2, "HIDE";
     |ESTADO_CONTROL enBoton0_3, "HIDE";
     |ESTADO_CONTROL enBoton0_9, "HIDE";
     |ESTADO_CONTROL enBoton0_10, "HIDE";
     |ESTADO_CONTROL enBoton0_12, "HIDE";

     nPantaPes = enPanta2;
     |HAZ DisablaPestanyas;

     |VENTANA 1101, 3299, -1, 1, ""; nVentana = FSalida;

     |PINPA #0#805;
     enPanta2_aux = FSalida;

     nLectura = 0;
     nWidGuarda = enPanta2_aux;
     |PCONTEXTO nLectura, nWidGuarda, nIdGuarda, nSidGuarda;

     aPinta   = #906##0 + ". " + #906#1;
     |HAZ PintaMsg;

     nRango = 4 + 8 + 16 + 32;
     nPos1  = 0702;
     nPos2  = 2498;

     |LEE 000#910p;

     |LINEAL_SIMPLE #1#910, nRango, nPos1, nPos2, NULL, NULL, Evento910;
     enGrid2_aux  = FSalida;

     |HAZ Botones2_aux;

     FSalida = 1;
     |HAZ Evento910;
     |FOCOTECLADO enGrid2_aux;

     aEsc1  = &255 + "806";
     aEsc2  = &255 + "807";
     aRetu  = &255 + "802";
     |PARA; |SI;  |HACIENDO;
         FSalida = "::{{001}}Salir," + enGrid2_aux;
         |LEETECLA aTecla;
         |SI aTecla = aEsc1; |SAL;  |FINSI;
         |SI aTecla = aEsc2; |SAL;  |FINSI;
         |SI aTecla = aRetu; |SAL;  |FINSI;
     |SIGUE;

     |PULSATECLA;

     |DESTRUYECONTROL enGrid2_aux;
     |FIN_CONTROL_WINDOWS enBoton2_a1;
     |FIN_CONTROL_WINDOWS enBoton2_a2;

     |CIERRA #910;

     |FINVENTANA nVentana;

     |HAZ EnablaPestanyas;

     |ESTADO_CONTROL enBoton0_1, "SHOW";
     |ESTADO_CONTROL enBoton0_2, "SHOW";
     |ESTADO_CONTROL enBoton0_3, "SHOW";
     |ESTADO_CONTROL enBoton0_9, "SHOW";
     |ESTADO_CONTROL enBoton0_10, "SHOW";
     |ESTADO_CONTROL enBoton0_12, "SHOW";

     |DELINDEX #910;
     Tempo = aTempo910;
     |HAZ BoraTempo;

     nNivelPan = nNivelPan - 1;
     |HAZ BotonInicio;
|FPRC;

|PROCESO vipem007;
     |SI fFecha ] #2000#16;  |Y fFecha [ #2000#17;
         #911#7 = "O";
         |ERROR10;
     |FINSI;
|FPRC;

|DEFBUCLE vipem007;
     #2000#2003;
     ;
     #911#0, #911#1, 00000001;
     #911#0, #911#1, 99999999;
     ;
     NULL, vipem007;
|FIN;

|PROCESO vipme011;
     #911#7 = "L";

     |BUCLE vipem007;

     |SI #911#7 = "L";   #911#8 = "Libre";    |FINSI;
     |SI #911#7 = "O";   #911#8 = "Ocupado";  |FINSI;

     |GRABA 020#911a;
     |LIBERA #911;
|FPRC;

|DEFBUCLE vipem011;
     #911#1;
     ;
     #906#0, 000;
     #906#0, 999;
     be;
     NULL, vipme011;
|FIN;

|PROCESO Boton2_5;   ||Edita Inmuebles;
     nNivelPan = nNivelPan + 1;
     |HAZ BotonInicio;

     |ESTADO_CONTROL enBoton0_1, "HIDE";
     |ESTADO_CONTROL enBoton0_2, "HIDE";
     |ESTADO_CONTROL enBoton0_3, "HIDE";
     |ESTADO_CONTROL enBoton0_9, "HIDE";
     |ESTADO_CONTROL enBoton0_10, "HIDE";
     |ESTADO_CONTROL enBoton0_12, "HIDE";

     nPantaPes = enPanta2;
     |HAZ DisablaPestanyas;

     |VENTANA 1101, 3299, -1, 1, ""; nVentana2 = FSalida;

     |DDEF aAlfa; |QBF aAlfa;
     aAlfa = aAlfa + "vipem007";
     |CARGA_DEF aAlfa, referen@;

     fFecha = ~;
     |BUCLE vipem011;

     |DESCARGA_DEF #referen@;

     |ABRE #911;

     |PINPA #0#911;
     enPantaPisos = FSalida;

     nLectura = 0;
     nWidGuarda = enPantaPisos;
     |PCONTEXTO nLectura, nWidGuarda, nIdGuarda, nSidGuarda;

     aPinta   = #906#0 + ". " + #906#1;
     |QBF aPinta;
     |HAZ PintaMsg;

     nRango = 4 + 8 + 16 + 32;
     nPos1  = 0702;
     nPos2  = 2498;

     |LINEAL_SIMPLE #1#911, nRango, nPos1, nPos2, Baja11, Alta11, EventoPisos;
     enGridPisos = FSalida;

     |HAZ BotonesPisos;

     FSalida = 1;
     |HAZ EventoPisos;

     aEsc1  = &255 + "806";
     aEsc2  = &255 + "807";
     aRetu  = &255 + "802";
     |PARA; |SI;  |HACIENDO;
         FSalida = "::{{001}}Salir," + enGridPisos;
         |LEETECLA aTecla;
         |SI aTecla = aEsc1; |SAL;  |FINSI;
         |SI aTecla = aEsc2; |SAL;  |FINSI;
         |SI aTecla = aRetu; |SAL;  |FINSI;
     |SIGUE;

     |DESTRUYECONTROL enGridPisos;
     |FIN_CONTROL_WINDOWS enBotonP1;
     |FIN_CONTROL_WINDOWS enBotonP2;
     |FIN_CONTROL_WINDOWS enBotonP3;
     |FIN_CONTROL_WINDOWS enBotonP5;

     |CIERRA #911;
     |FINVENTANA nVentana2;

     |HAZ EnablaPestanyas;

     |ESTADO_CONTROL enBoton0_1, "SHOW";
     |ESTADO_CONTROL enBoton0_2, "SHOW";
     |ESTADO_CONTROL enBoton0_3, "SHOW";
     |ESTADO_CONTROL enBoton0_9, "SHOW";
     |ESTADO_CONTROL enBoton0_10, "SHOW";
     |ESTADO_CONTROL enBoton0_12, "SHOW";

     nNivelPan = nNivelPan - 1;
     |HAZ BotonInicio;
|FPRC;

|PROCESO NoRepetido2; |TIPO 0;
     |SI enModo ! 1;  |ACABA;  |FINSI;

     #906#0 = #803#0;
     |LEE 000#906=;
     |SI FSalida = 0;
         |MENAV "0000 El Codigo de Edificio ya Existe.";
         |ERROR;
     |FINSI;
|FPRC;

|PROCESO EventoFocoGrid2;
     FSalida = 1;
     |HAZ EventoPanta2;

     |REFRESCACONTROL enGrid2;
     |FOCOTECLADO enGrid2;
|FPRC;

|PROCESO Grid2;
     nRango = 4 + 8 + 16 + 32;
     nPos1  = 0602;
     nPos2  = 2598;
     |LINEAL_SIMPLE #1#906, nRango, nPos1, nPos2, NULL, NULL, EventoPanta2;
     enGrid2  = FSalida;

     |CONTROL_SIMPLE enPanta2, "EVENTOPAN", 0000, 0000, EventoFocoGrid2;
     nFoco2 = FSalida;
|FPRC;


|PROCESO BotonesPanta2;
     nPos1 = 2764;  nPos2 = 2774;
     |CONTROL_SIMPLE enPanta2, "BOTON,{{193}}Nuevo", nPos1, nPos2, Boton2_1;
     enBoton2_1 = FSalida;

     nPos1 = 2776;  nPos2 = 2786;
     |CONTROL_SIMPLE enPanta2, "BOTON,{{197}}Modificar", nPos1, nPos2, Boton2_2;
     enBoton2_2 = FSalida;

     nPos1 = 2788;  nPos2 = 2798;
     |CONTROL_SIMPLE enPanta2, "BOTON,{{199}}Borrar", nPos1, nPos2, Boton2_3;
     enBoton2_3 = FSalida;

     nPos1 = 2702;  nPos2 = 2716;
     |CONTROL_SIMPLE enPanta2, "BOTON,Asignar Conceptos", nPos1, nPos2, Boton2_4;
     enBoton2_4 = FSalida;

     nPos1 = 2718;  nPos2 = 2732;
     |CONTROL_SIMPLE enPanta2, "BOTON,{{197}}Editar Inmuebles", nPos1, nPos2, Boton2_5;
     enBoton2_5 = FSalida;
|FPRC;

||************* FINAL PESTA¥A 2. EDIFICIOS ***************************************

||************* PESTA¥A 3. CONTRATOS ***************************************
|PROCESO EventoPanta3;
     |SI FSalida = 1;  |O FSalida = 2;
         |SELECT #1#907;
         |LEE 000#907=;
         |SI FSalida = 0;
             |ESTADO_CONTROL enBoton3_2, "ENABLE";
             |ESTADO_CONTROL enBoton3_3, "ENABLE";
             |ESTADO_CONTROL enBoton3_4, "ENABLE";
             |ESTADO_CONTROL enBoton3_5, "ENABLE";
         |SINO;
             |ESTADO_CONTROL enBoton3_2, "DISABLE";
             |ESTADO_CONTROL enBoton3_3, "DISABLE";
             |ESTADO_CONTROL enBoton3_4, "DISABLE";
             |ESTADO_CONTROL enBoton3_5, "DISABLE";
         |FINSI;
     |FINSI;

     |SI FSalida = 4;
          |HAZ Boton3_2;
     |FINSI;
|FPRC;

|PROCESO Boton3_1;
     enModo = 1;
     |HAZ ModiAlta3;
     |REFRESCACONTROL enGrid3; |FOCOTECLADO enGrid3;
|FPRC;

|PROCESO Boton3_2;
     |SELECT #1#907;
     |LEE 000#907.=;
     |SI FSalida ! 0;
          |ESTADO_CONTROL enBoton3_2, "DISABLE";
          |ESTADO_CONTROL enBoton3_3, "DISABLE";
          |ESTADO_CONTROL enBoton3_4, "DISABLE";
          |ESTADO_CONTROL enBoton3_5, "DISABLE";
          |ACABA;
     |SINO;
          enModo = 2;
          |HAZ ModiAlta3;
          |REFRESCACONTROL enGrid3; |FOCOTECLADO enGrid3;
     |FINSI;
|FPRC;

|PROCESO vipem021;
     |BORRA 020#921a;
     |LIBERA #921;
|FPRC;

|DEFBUCLE vipem021;
     #921#1;
     ;
     #907#0, 01;
     #907#0, 99;
     be;
     NULL, vipem021;
|FIN;

|PROCESO vipem017_fac;
     |SI #vipem017#3 = "S";
          nSwHayFac = 1;
          |ERROR10;
     |FINSI;
|FPRC;

|DEFBUCLE vipem017_fac;
 #vipem017#3;
 ;
 #907#0, 2000,  1;
 #907#0, 2999, 12;
 ;
 NULL, vipem017_fac;
|FIN;

|PROCESO Boton3_3;
     |SELECT #1#907;
     |LEE 000#907.=;
     |SI FSalida ! 0;
          |ESTADO_CONTROL enBoton3_2, "DISABLE";
          |ESTADO_CONTROL enBoton3_3, "DISABLE";
          |ESTADO_CONTROL enBoton3_4, "DISABLE";
          |ESTADO_CONTROL enBoton3_5, "DISABLE";
          |ACABA;
     |SINO;
          ||Control de Facturados.
          ||Si tiene facturas emitidas, NO permitir la baja.
          nSwHayFac = 0;
          |BUCLE vipem017_fac;
          |SI nSwHayFac = 1;
               aMensaje = "0000Contrato con Facturas emitidas. No se puede dar de baja";
               |MENAV aMensaje;
               |ACABA;
          |SINO;
               aMensaje = "0000NSeguro de dar de baja: " + #907#0
               |QBF aMensaje;
               aMensaje = aMensaje + " ?";
               |CONFI aMensaje;
               |SI FSalida ! 0; |ACABA; |FINSI;

               |LEE 101#907.=;
               |SI FSalida = 0;
                    |BUCLE vipem021;

                    |BORRA 020#907a;
                    |LIBERA #907;
                    FSalida = 1;
                    |HAZ EventoPanta3;
               |FINSI;
          |FINSI;
     |FINSI;

     |REFRESCACONTROL enGrid3; |FOCOTECLADO enGrid3;
|FPRC;

|PROCESO Evento921;
     |SI FSalida = 1;  |O FSalida = 2;
         |LEE 000#921=;
         |SI FSalida = 0;
             fHasta = #921#4;
             aHasta = fHasta;
             aAnyHasta = aHasta % -104;
             nAnyHasta = aAnyHasta;

             fDesde = #vipew004#16;
             aDesde = fDesde;
             aAnyDesde = aDesde % -104;
             nAnyDesde = aAnyDesde;

             nDif = nAnyHasta - nAnyDesde;
             |SI nDif [ 5;
                  |ESTADO_CONTROL nBoton921, "ENABLE";
                  |ESTADO_CONTROL nBoton925, "DISABLE";
             |SINO;
                  |ESTADO_CONTROL nBoton921, "DISABLE";
                  |ESTADO_CONTROL nBoton925, "ENABLE";
             |FINSI;
         |SINO;
             |ESTADO_CONTROL nBoton921, "DISABLE";
             |ESTADO_CONTROL nBoton925, "DISABLE";
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO EmitirProrroga5anyos;
     nSw5Anyos = 1;

     |HAZ EmitirProrroga;

     nSw5Anyos = 0;
|FPRC;

|PROCESO EmitirProrroga;
     |ABRE #100;
     |DDEFECTO #100;
     |LEE 000#100p;
     |CIERRA #100;
     nApoderado = #100#3;
     aAlqSPA = #100#16;
     aVacio = "";

     enModoExterno = 1;

     eaDirPlantilla = "C:\DOCUMENTOS\DSCOMER9\PLANTILLAS\";
     eaDirTrabajo   = "C:\DOCUMENTOS\DSCOMER9\DOCS\";
     eaDirSerPlan   = aBase  + "002805g/";
     eaDirTrabServi = aBase  + "002805g/tmp/";

     |SI nSw5Anyos = 1;
          eaRaiz         = "dsprorrog5";
     |SINO;
          eaRaiz         = "dsprorroga";
     |FINSI;
     eaFicheroTra   = eaRaiz + ".xml";
     eaFicheroTxt   = eaRaiz + ".txt";
     eaFicheroPlaMl = eaRaiz + ".xml";

     |MKDIR eaDirTrabServi;

     eaOrigen       = eaDirSerPlan   + eaFicheroTra;

     |VENTANA 1535, 2565, -1, 1, ""; nVentana = FSalida;

     |DDEFECTO #811;
     |PINPA #0#811;
     |PINDA #0#811;

     |ENDATOS #1#811;

     |SI FSalida ! 0;
          |FINVENTANA nVentana;
          |ACABA;
     |FINSI;

     eaDestino      = eaDirPlantilla + eaFicheroTra;
     eaDestinoTra   = eaDirTrabajo   + eaFicheroPlaMl;

     |HAZ MiraDirectorios;
     |HAZ EnviaFicheroConMD5;

     aAbre = eaDirTrabServi + eaFicheroTxt;
     |XABRE "WB", aAbre, enHandleTxt;

     aAlfa = "[FICHERO]#" + eaDirTrabajo + eaFicheroPlaMl + &13 + &10;
     |XGRABA enHandleTxt, aAlfa;

     |ABRE #914;
     |DDEFECTO #914;
     #914#0 = nApoderado;
     |LEE 000#914.=;

     efFecha = #811#0;            |HAZ SacaFecha;
     eaAsigna = "V#FECHAEMI#";    |HAZ AsignaWord;

     efFecha = #804#16;           |HAZ SacaFecha;
     eaAsigna = "V#FECHA#";       |HAZ AsignaWord;

     efFecha = #921#2;            |HAZ SacaFecha;
     eaAsigna = "V#FECHAPRO#";    |HAZ AsignaWord;

     efFecha = #921#4;            |HAZ SacaFecha;
     eaAsigna = "V#FECHAFIN#";    |HAZ AsignaWord;


     ||ARA55
     ||Falta Calcular importe
     #907#0 = #804#0;
     #907#1 = #804#1;
     #907#2 = #804#2;
     #907#16 = #921#4;

     nAlquiler = 0;
     |HAZ CalculaAlquiler;
/*
     |SI aAlqSPA = "N";
         |HAZ CalculaAlquiler;
     |SINO;
         |HAZ AlquilerSPA;
     |FINSI;
*/
     eaAlfa = nAlquiler;
     |SI nAlquiler = 0;
          aVacio = aVacio + " ALQUILER";
     |FINSI;
     eaAsigna = "V#ALQUILER#";   |HAZ AsignaWord;


                       eaAlfa   = #921#3 + " meses";
     |SI #921#3 = 1;   eaAlfa   = #921#3 + " mes";  |FINSI;
     eaAsigna = "V#DURACION#";    |HAZ AsignaWord;

     eaAlfa   = #914#11;          |HAZ QuitaRaros;
     eaAsigna = "V#T1#";          |HAZ AsignaWord;

     eaAlfa   = #914#12;          |HAZ QuitaRaros;
     eaAsigna = "V#T3#";          |HAZ AsignaWord;

     eaAlfa   = #914#1;           |HAZ QuitaRaros;
     aBeta = eaAlfa;
     |QBF aBeta;
     |SI aBeta = "";
          aVacio = aVacio + " NOMAPO";
     |FINSI;
     eaAsigna = "V#NOMAPO#";      |HAZ AsignaWord;

     eaAlfa   = #914#3;           |HAZ QuitaRaros;
     aBeta = eaAlfa;
     |QBF aBeta;
     |SI aBeta = "";
          aVacio = aVacio + " POBAPO";
     |FINSI;
     eaAsigna = "V#POBAPO#";      |HAZ AsignaWord;

     eaAlfa   = #914#4;           |HAZ QuitaRaros;
     aBeta = eaAlfa;
     |QBF aBeta;
     |SI aBeta = "";
          aVacio = aVacio + " PROAPO";
     |FINSI;
     eaAsigna = "V#PROAPO#";      |HAZ AsignaWord;

     eaAlfa   = #914#2;           |HAZ QuitaRaros;
     aBeta = eaAlfa;
     |QBF aBeta;
     |SI aBeta = "";
          aVacio = aVacio + " DIRAPO";
     |FINSI;
     eaAsigna = "V#DIRAPO#";      |HAZ AsignaWord;

     eaAlfa   = #914#7;           |HAZ QuitaRaros;
     aBeta = eaAlfa;
     |QBF aBeta;
     |SI aBeta = "";
          aVacio = aVacio + " NIFAPO";
     |FINSI;
     eaAsigna = "V#NIFAPO#";      |HAZ AsignaWord;

     eaAlfa   = #804#29;           |HAZ QuitaRaros;
     eaAsigna = "V#T2#";      |HAZ AsignaWord;

     eaAlfa   = #804#4;           |HAZ QuitaRaros;
     aBeta = eaAlfa;
     |QBF aBeta;
     |SI aBeta = "";
          aVacio = aVacio + " NOMCLI";
     |FINSI;
     eaAsigna = "V#NOMCLI#";      |HAZ AsignaWord;

     eaAlfa   = #804#6;           |HAZ QuitaRaros;
     aBeta = eaAlfa;
     |QBF aBeta;
     |SI aBeta = "";
          aVacio = aVacio + " DIRCLI";
     |FINSI;
     eaAsigna = "V#DIRCLI#";      |HAZ AsignaWord;

     eaAlfa   = #804#7;           |HAZ QuitaRaros;
     aBeta = eaAlfa;
     |QBF aBeta;
     |SI aBeta = "";
          aVacio = aVacio + " POBCLI";
     |FINSI;
     eaAsigna = "V#POBCLI#";      |HAZ AsignaWord;

     eaAlfa   = #804#8;           |HAZ QuitaRaros;
     aBeta = eaAlfa;
     |QBF aBeta;
     |SI aBeta = "";
          aVacio = aVacio + " PROCLI";
     |FINSI;
     eaAsigna = "V#PROCLI#";      |HAZ AsignaWord;

     eaAlfa   = #804#11;          |HAZ QuitaRaros;
     aBeta = eaAlfa;
     |QBF aBeta;
     |SI aBeta = "";
          aVacio = aVacio + " NIFCLI";
     |FINSI;
     eaAsigna = "V#NIFCLI#";      |HAZ AsignaWord;

     efFecha  = #914#8;           |HAZ FechaBarras;
     aBeta = eaAlfa;
     |QBF aBeta;
     |SI aBeta = "";
          aVacio = aVacio + " FECAPO";
     |FINSI;
     eaAsigna = "V#FECAPO#";      |HAZ AsignaWord;

     eaAlfa   = #914#10;          |HAZ QuitaRaros;
     aBeta = eaAlfa;
     |QBF aBeta;
     |SI aBeta = "";
          aVacio = aVacio + " POBNOTAPO";
     |FINSI;
     eaAsigna = "V#POBNOTAPO#";   |HAZ AsignaWord;

     eaAlfa   = #914#9;           |HAZ QuitaRaros;
     aBeta = eaAlfa;
     |QBF aBeta;
     |SI aBeta = "";
          aVacio = aVacio + " NOTARIA";
     |FINSI;
     eaAsigna = "V#NOTAPO#";      |HAZ AsignaWord;

     |DDEFECTO #906;
     #906#0 = #804#1;
     |LEE 000#906.=;

     eaAlfa = #911#13;
     |QBF eaAlfa;

     |ABRE #911;
     |DDEFECTO #911;
     #911#0 = #804#1;
     #911#1 = #804#2;
     |LEE 000#911.=;
     |CIERRA #911;

     aAlfa = #911#2;
     |QBF aAlfa;
     |SI aAlfa ! "";
          eaAlfa = eaAlfa + " ESC " + aAlfa;
     |FINSI;

     aAlfa = #911#3;
     |QBF aAlfa;
     |SI aAlfa ! "";
          eaAlfa = eaAlfa + " PLANTA " + aAlfa;
     |FINSI;

     aAlfa = #911#4;
     |QBF aAlfa;
     |SI aAlfa ! "";
          eaAlfa = eaAlfa + " PTA. " + aAlfa;
     |FINSI;

     aAlfa = #911#5;
     |QBF aAlfa;
     |SI aAlfa ! "";
          eaAlfa = eaAlfa + " TIPO " + aAlfa;
     |FINSI;

     |HAZ QuitaRaros;
     aBeta = eaAlfa;
     |QBF aBeta;
     |SI aBeta = "";
          aVacio = aVacio + " DIRECCION";
     |FINSI;
     eaAsigna = "V#DIRECCION#";      |HAZ AsignaWord;

     eaAlfa = ((("00" + #911#16) % -102) + (("000" + #911#17) % -103));
     eaAsigna = "V#CP#";      |HAZ AsignaWord;

     eaAlfa   = #911#14;           |HAZ QuitaRaros;
     aBeta = eaAlfa;
     |QBF aBeta;
     |SI aBeta = "";
          aVacio = aVacio + " CIUDAD";
     |FINSI;
     eaAsigna = "V#CIUDAD#";   |HAZ AsignaWord;

     eaAlfa = "-";
     eaAsigna = "R#LINEA#";   |HAZ AsignaWord;

     ||Impresion por pantalla.
     aAlfa = "[IMPRESORA]#P" + &13 + &10;
     |XGRABA enHandleTxt, aAlfa;

     aIPRemoto = "";
     |IP_REMOTO aIPRemoto;

     |SI aIPRemoto = "192.168.10.47";
         aAlfa = "[ERROR]" + &13 + &10;
         |XGRABA enHandleTxt, aAlfa;
     |FINSI;

     |XCIERRA enHandleTxt;

     |QBF aVacio;
     |SI aVacio ! "";
          aMensaje = "0000Aviso de Variables Vacias: " + aVacio;
          |MENAV aMensaje;
     |FINSI;

     eaOrigen  = eaDirTrabServi + eaFicheroTxt;
     eaDestino = eaDirTrabajo   + eaFicheroTxt;
     |HAZ EnviaFicheroSinMD5;

     |FBORRA eaOrigen;

     |HAZ AbreWordExterno;

     |FINVENTANA nVentana;
|FPRC;

|PROCESO Baja921;
     #921#0 = #907#0;
     #921#1 = 1;
|FPRC;

|PROCESO Alta921;
     #921#0 = #907#0;
     #921#1 = 99;
|FPRC;

|PROCESO ModiAlta3;
     |ESTADO_CONTROL enBoton0_1, "HIDE";
     |ESTADO_CONTROL enBoton0_2, "HIDE";
     |ESTADO_CONTROL enBoton0_3, "HIDE";
     |ESTADO_CONTROL enBoton0_9, "HIDE";
     |ESTADO_CONTROL enBoton0_10, "HIDE";
     |ESTADO_CONTROL enBoton0_12, "HIDE";

     nPantaPes = enPanta3;
     |HAZ DisablaPestanyas;

     |VENTANA 0501, 3399, -1, 1, ""; nVentana = FSalida;

     |LEE 101#907=;

     aCadena ="|NC";
     aAlfa = #907#aCadena#;
     nCampoHasta = aAlfa;
     nCampoHasta = nCampoHasta - 1;

     |SI enModo ! 1;
          |PARA nCampoD = 0;  |SI nCampoD [ nCampoHasta;   |HACIENDO nCampoD = nCampoD + 1;
                nCampoH = nCampoD;
                #804nCampoH = #907nCampoD;
          |SIGUE;

          |C_M #804#0, 1, "N";
          |C_M #804#1, 1, "N";
          |C_M #804#2, 1, "N";
     |SINO;
          |C_M #804#0, 1, "S";
          |C_M #804#1, 1, "S";
          |C_M #804#2, 1, "S";
          |DDEFECTO #804;
          |HAZ DameUltimo3;
          #804#0 = nUltimo;

          |ABRE #916;
          |DDEFECTO #916;
          #916#0 = #804#28;
          |LEE 000#916.=;
          #804#30 = #916#1;
          |CIERRA #916;
     |FINSI;

     |PINPA #0#804;
     enPanta3_ma = FSalida;

     |CONTROL_SIMPLE enPanta3_ma, "BOTON,{{205}}Emisi¢n", 1887, 1998, EmitirProrroga;
     nBoton921 = FSalida;

     |CONTROL_SIMPLE enPanta3_ma, "BOTON,{{205}}Emisi¢n   5 A¤os", 2087, 2198, EmitirProrroga5anyos;
     nBoton925 = FSalida;

     |ABRE #921;
     |SI enModo ! 1;     || en alta aun no sabemos el nro. de cto.
          nRango = 1 + 4 + 8 + 16 + 32;
          |LINEAL_SIMPLE #1#921, nRango, 1746, 2385, Baja921, Alta921,  Evento921;
          enGrid921 = FSalida;
     |FINSI;

     |PINDA #0#804;

     |SI enModo = 1;  |ENDATOS #1#804;  |FINSI;
     |SI enModo = 2;  |ENDATOS #2#804;  |FINSI;

     |SI FSalida = 0;
          |LIBERA #907;
          |HAZ GrabaDatos3;

          |DDEF aAlfa; |QBF aAlfa;
          aAlfa = aAlfa + "vipem007";
          |CARGA_DEF aAlfa, referen@;

          fFecha = ~;
          #906#0 = #804#1;
          |BUCLE vipem011;

          |DESCARGA_DEF #referen@;
     |SINO;
          |LIBERA #907;
     |FINSI;

     |CIERRA #921;

     |FIN_CONTROL_WINDOWS nBoton921;
     |FIN_CONTROL_WINDOWS nBoton925;
     |DESTRUYECONTROL enGrid921;

     |FINVENTANA nVentana;

     |HAZ EnablaPestanyas;

     |ESTADO_CONTROL enBoton0_1, "SHOW";
     |ESTADO_CONTROL enBoton0_2, "SHOW";
     |ESTADO_CONTROL enBoton0_3, "SHOW";
     |ESTADO_CONTROL enBoton0_9, "SHOW";
     |ESTADO_CONTROL enBoton0_10, "SHOW";
     |ESTADO_CONTROL enBoton0_12, "SHOW";
|FPRC;

|PROCESO DameUltimo3;
     |DDEF aAlfa; |QBF aAlfa;
     aAlfa = aAlfa + "vipem007";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |ABRE #referen@;
     |LEE 000#2000u;
     |SI FSalida = 0;
          nUltimo = #2000#0 + 1;
     |SINO;
          nUltimo = 1;
     |FINSI;

     |CIERRA #referen@;
     |DESCARGA_DEF #referen@;
|FPRC;

|PROCESO DirEntrega;
     |ABRE #7;
     |DDEFECTO #7;
     #7#0 = #agifa024#0;
     #7#1 = 1;
     |LEE 101#7=;
     |SI FSalida ! 0; |GRABA 021#7b; |FINSI;
     #7#2 = #804#6;
     #7#3 = #804#7;
     #7#4 = #804#9;
     #7#5 = #804#10;
     aCP = (("00" + #804#9) % -102) + (("000" + #804#10) % -103);
     #7#6 = aCP;
     #7#7 = #804#8;
     #7#8 = #804#62;          ||Des. PAIS
     #7#19 = #804#61;         ||Cod. PAIS
     #7#10 = #804#4;
     #7#11 = "";
     #7#12 = "";
     #7#13 = #804#8;
     #7#14 = "00";
     #7#15 = "";
     #7#16 = "";
     #7#17 = "";
     |GRABA 021#7a;
     |CIERRA #7;
|FPRC;

|PROCESO GrabaDatos3;
     |ABRE #agifa024;
     |DDEFECTO #agifa024;
     #agifa024#0 = #804#45;
     |LEE 101#agifa024.=;
     |SI FSalida ! 0;
          |HAZ DirEntrega;
          |GRABA 020#agifa024.b;
     |FINSI;

     |SI enModo = 1;     ||En Alta, Actualizo Numero Veces Arrendado en Inmuebles
          |ABRE #911;
          #911#0 = #804#1;
          #911#1 = #804#2;
          |LEE 101#911=;
          |SI FSalida = 0;
               #911#11 = #911#11 + 1;
               |GRABA 020#911a;
               |LIBERA #911;
          |FINSI;
          |CIERRA #911;

          |SI #vipem008#11 = "U"; |O #vipem008#11 = "M";
               aAux = ("00" + #804#1) % -102;
               #agifa024#4 = aAux;
               aAux = ("000000" + #804#3) % -106;
               #agifa024#27 = aAux;
          |FINSI;
     |FINSI;

     #agifa024#1 = #804#4;
     #agifa024#2 = #804#4;
     ||#agifa024#2 = #804#5;

     #agifa024#5 = #804#6;
     #agifa024#6 = #804#7;
     #agifa024#7 = #804#8;
     #agifa024#178 = #804#9;
     #agifa024#179 = #804#10;
     aCP = (("00" + #agifa024#178) % -102) + (("000" + #agifa024#179) % -103);
     #agifa024#180 = aCP;

     #agifa024#17 = #804#31;
     #agifa024#196 = #804#32;

     #agifa024#14 = #804#62;
     #agifa024#205 = #804#61;

     #agifa024#8 = #804#6;
     #agifa024#9 = #804#7;
     #agifa024#10 = #804#8;
     #agifa024#181 = #804#9;
     #agifa024#182 = #804#10;
     aCP = (("00" + #agifa024#181) % -102) + (("000" + #agifa024#182) % -103);
     #agifa024#183 = aCP;

     #agifa024#11 = #804#6;
     #agifa024#12 = #804#7;
     #agifa024#13 = #804#8;
     #agifa024#184 = #804#9;
     #agifa024#185 = #804#10;
     aCP = (("00" + #agifa024#184) % -102) + (("000" + #agifa024#185) % -103);
     #agifa024#186 = aCP;

     #agifa024#15 = #804#11;
     #agifa024#20 = #804#42;
     #agifa024#32 = #804#14;
     #agifa024#33 = #804#15;
     #agifa024#31 = #804#13;
     #agifa024#30 = #804#12;
     #agifa024#163 = #804#44;

     |ABRE #agifa142;
     |DDEFECTO #agifa142;
     |LEE 000#agifa142.p;
     |CIERRA #agifa142;

     cod = #agifa024#0;
     |SI cod ! 0;
          cuen = "000000000000" + cod;
          |QBT cuen;
          quitar = -(100 + (#agifa142#11 - 2));
          cuen = cuen % quitar;
          cuen = "43" + cuen;

          |ABRE #100;
          |DDEFECTO #100;
          |LEE 000#100p;
          |CIERRA #100;

          |SI #100#12 = "S";
               nPosicion = #100#14;

               aAux = "";
               aLong = cuen % A0;
               nLong = aLong;
               |SI nLong ] nPosicion;
                    |PARA nConta = 1; |SI nConta [ nLong; |HACIENDO nConta = nConta + 1;
                         nSaca = 100 * nConta;
                         nSaca = nSaca + 1;
                         aSaca = nSaca;
                         aLetra = cuen % aSaca;
                         |SI nConta = nPosicion;
                              aAux = aAux + #100#13;
                         |SINO;
                              aAux = aAux + aLetra;
                         |FINSI;
                    |SIGUE;
                    cuen = aAux;
               |SINO;
                    || Se pasaria de la longuitud.
                    ||cuen = cuen + #100#13;
               |FINSI;
          |FINSI;
          #agifa024#16 = cuen;
     |FINSI;

     |GRABA 020#agifa024.a;
     |LIBERA #agifa024;
     |CIERRA #agifa024;

     #907#0 = #804#0;
     |LEE 101#907=;
     |SI FSalida ! 0;
         |DDEFECTO #907;
         #907#0 = #804#0;
         |GRABA 020#907b;
     |FINSI;

     |PARA nCampoD = 1;  |SI nCampoD [ nCampoHasta;  |HACIENDO nCampoD = nCampoD + 1;
          nCampoH   = nCampoD;
          #907nCampoD = #804nCampoH;
     |SIGUE;

     |GRABA 020#907a;
     |LIBERA #907;


     |HAZ VerificaEstadoInmueble;
|FPRC;

|PROCESO VerificaEstadoInmueble;
/*
     fSys = ~;
     ||ARA66
     |ABRE #vipem011;
     #vipem011#0 = #907#1;
     #vipem011#1 = #907#2;
     |LEE 101#vipem011.=;
     |SI FSalida = 0;
          |SI fSys ] #907#16;  |Y fSys [ #907#17;

          |SINO;

          |FINSI;
          |GRABA 020#vipem011.a;
          |LIBERA #vipem011;
     |FINSI;
     |CIERRA #vipem011;
*/
|FPRC;

|PROCESO Boton3_4;       ||Emitir Contrato.
     |LEE 000#907.=;
     |SI FSalida ! 0;
          |ESTADO_CONTROL enBoton3_2, "DISABLE";
          |ESTADO_CONTROL enBoton3_3, "DISABLE";
          |ESTADO_CONTROL enBoton3_4, "DISABLE";
          |ESTADO_CONTROL enBoton3_5, "DISABLE";
          |ACABA;
     |SINO;
          |HAZ EmitirContrato;
     |FINSI;
|FPRC;

|PROCESO vipem005_spa;
     nEdificio = #907#1;
     aConcepto = #905#0;
     nDesdeIn = 0;
     nHastaIn = 999;
     fUltRev = "01.01.0000";
     nUltImp = 0;
     |HAZ DameSituacion;
     nAlquiler = nAlquiler + nUltImp;
|FPRC;

|DEFBUCLE vipem005_spa;
 #vipem005#1;
 ;
 INICIO;
 FINAL;
 ;
 NULL, vipem005_spa;
|FIN;

|PROCESO AlquilerSPA;
     |BUCLE vipem005_spa;
|FPRC;

|PROCESO vipem016_defecto;
     |SI #vipem016#2 = "S";
          aDefecto = #vipem016#0;
          |QBF aDefecto;
          |ERROR10;
     |FINSI;
|FPRC;

|DEFBUCLE vipem016_defecto;
 #vipem016#1;
 ;
 INICIO;
 FINAL;
 ;
 NULL, vipem016_defecto;
|FIN;

|PROCESO EmitirContrato;
     |ABRE #100;
     |DDEFECTO #100;
     |LEE 000#100p;
     |CIERRA #100;
     nApoderado = #100#3;
/*
     aCodIbi = #100#5;
     aCodIbiLocal = #100#9;
     aCodAlq = #100#1;
     aCodAlqLocal = #100#7;
*/
     aAlqSPA = #100#16;

     aVacio = "";
     aNumContrato = ("00000000" + #907#0) % -108;

     enModoExterno = 1;

     eaDirPlantilla = "C:\DOCUMENTOS\DSCOMER9\PLANTILLAS\";
     eaDirTrabajo   = "C:\DOCUMENTOS\DSCOMER9\DOCS\";
     eaDirSerPlan   = aBase  + "002805g/";
     eaDirTrabServi = aBase  + "002805g/tmp/";
     aAux = #907#28;
     |QBF aAux;
     |SI aAux = "";
          aDefecto = "";
          |BUCLE vipem016_defecto;
          |SI aDefecto = "";
               aAux = "contrato";
          |FINSI;
     |FINSI;
     eaRaiz         = aAux;
     eaFicheroTra   = eaRaiz + ".xml";
     eaFicheroTxt   = eaRaiz + aNumContrato + ".txt";
     eaFicheroPlaMl = eaRaiz + aNumContrato + ".xml";

     |MKDIR eaDirTrabServi;

     eaOrigen       = eaDirSerPlan   + eaFicheroTra;

     aAbre = eaOrigen;
     |XABRE "E", aAbre, nHandle;
     |SI FSalida < 0;
         |SI eaRaiz = "contrato";
              aOrigen = aBase + "002805g/dspatroncontrato.xml";
              aDestino = aBase + "002805g/contrato.xml";
              |COPIA_FICHERO aOrigen, aDestino;
         |SINO;
              aAlfa   = "0000 La Plantilla [" + eaRaiz + "] no esta instalada. Instalela.";
              |MENAV aAlfa;
              |ACABA;
         |FINSI;
     |FINSI;

     ||Pide Fecha Emision
     |ESTADO_CONTROL enBoton0_1, "HIDE";
     |ESTADO_CONTROL enBoton0_2, "HIDE";
     |ESTADO_CONTROL enBoton0_3, "HIDE";
     |ESTADO_CONTROL enBoton0_9, "HIDE";
     |ESTADO_CONTROL enBoton0_10, "HIDE";
     |ESTADO_CONTROL enBoton0_12, "HIDE";

     nPantaPes = enPanta3;
     |HAZ DisablaPestanyas;

     |ESTADO_CONTROL enBoton3_1, "HIDE";
     |ESTADO_CONTROL enBoton3_2, "HIDE";
     |ESTADO_CONTROL enBoton3_3, "HIDE";
     |ESTADO_CONTROL enBoton3_4, "HIDE";
     |ESTADO_CONTROL enBoton3_5, "HIDE";

     nIdSalir = 0;
     |HAZ ObtenIdSalir;
     |ESTADO_CONTROL nIdSalir, "HIDE";

     |VENTANA 1535, 2565, -1, 1, ""; nVentana = FSalida;

     |DDEFECTO #811;
     |PINPA #0#811;
     |PINDA #0#811;

     |ENDATOS #1#811;

     |SI FSalida ! 0;
          |FINVENTANA nVentana;
          |HAZ EnablaPestanyas;
          |ESTADO_CONTROL enBoton0_1, "SHOW";
          |ESTADO_CONTROL enBoton0_2, "SHOW";
          |ESTADO_CONTROL enBoton0_3, "SHOW";
          |ESTADO_CONTROL enBoton0_9, "SHOW";
          |ESTADO_CONTROL enBoton0_10, "SHOW";
          |ESTADO_CONTROL enBoton0_12, "SHOW";
          |ESTADO_CONTROL enBoton3_1, "SHOW";
          |ESTADO_CONTROL enBoton3_2, "SHOW";
          |ESTADO_CONTROL enBoton3_3, "SHOW";
          |ESTADO_CONTROL enBoton3_4, "SHOW";
          |ESTADO_CONTROL enBoton3_5, "SHOW";
          |ESTADO_CONTROL nIdSalir, "SHOW";
          |ACABA;
     |FINSI;

     ||ACI VA DECINE

     eaDestino      = eaDirPlantilla + eaFicheroTra;
     eaDestinoTra   = eaDirTrabajo   + eaFicheroPlaMl;

     |HAZ MiraDirectorios;
     |HAZ EnviaFicheroConMD5;

     aAbre = eaDirTrabajo + eaFicheroPlaMl;
     |XABRE "EC", aAbre, nHandle;
     |SI FSalida < 0;
         aAlfa   = "0000 El Documento " + aAbre + " no esta instalado. Instalelo.";
         |MENAV aAlfa;
         |ACABA;
     |FINSI;

     aAbre = eaDirTrabServi + eaFicheroTxt;
     |XABRE "WB", aAbre, enHandleTxt;

     aAlfa = "[FICHERO]#" + eaDirTrabajo + eaFicheroPlaMl + &13 + &10;
     |XGRABA enHandleTxt, aAlfa;

/*
     aAlfa = "[GRABA ORIGEN]" + &13 + &10;
     |XGRABA enHandleTxt, aAlfa;
*/


     |DDEFECTO #914;
     #914#0 = nApoderado;
     |LEE 000#914.=;

     efFecha = #811#0;            |HAZ SacaFecha;
     eaAsigna = "V#FECHAEMI#";    |HAZ AsignaWord;

     efFecha = #907#16;           |HAZ SacaFecha;
     eaAsigna = "V#FECHA#";       |HAZ AsignaWord;

                       eaAlfa   = #907#33 + " meses";
     |SI #907#33 = 1;  eaAlfa   = #907#33 + " mes";  |FINSI;
     eaAsigna = "V#DURACION#";    |HAZ AsignaWord;

     eaAlfa   = #914#11;          |HAZ QuitaRaros;
     eaAsigna = "V#T1#";          |HAZ AsignaWord;

     eaAlfa   = #914#12;          |HAZ QuitaRaros;
     eaAsigna = "V#T3#";          |HAZ AsignaWord;

     eaAlfa   = #914#1;           |HAZ QuitaRaros;
     aBeta = eaAlfa;
     |QBF aBeta;
     |SI aBeta = "";
          aVacio = aVacio + " NOMAPO";
     |FINSI;
     eaAsigna = "V#NOMAPO#";      |HAZ AsignaWord;

     eaAlfa   = #914#3;           |HAZ QuitaRaros;
     aBeta = eaAlfa;
     |QBF aBeta;
     |SI aBeta = "";
          aVacio = aVacio + " POBAPO";
     |FINSI;
     eaAsigna = "V#POBAPO#";      |HAZ AsignaWord;

     eaAlfa   = #914#4;           |HAZ QuitaRaros;
     aBeta = eaAlfa;
     |QBF aBeta;
     |SI aBeta = "";
          aVacio = aVacio + " PROAPO";
     |FINSI;
     eaAsigna = "V#PROAPO#";      |HAZ AsignaWord;

     eaAlfa   = #914#2;           |HAZ QuitaRaros;
     aBeta = eaAlfa;
     |QBF aBeta;
     |SI aBeta = "";
          aVacio = aVacio + " DIRAPO";
     |FINSI;
     eaAsigna = "V#DIRAPO#";      |HAZ AsignaWord;

     eaAlfa   = #914#7;           |HAZ QuitaRaros;
     aBeta = eaAlfa;
     |QBF aBeta;
     |SI aBeta = "";
          aVacio = aVacio + " NIFAPO";
     |FINSI;
     eaAsigna = "V#NIFAPO#";      |HAZ AsignaWord;

     eaAlfa   = #907#29;           |HAZ QuitaRaros;
     eaAsigna = "V#T2#";      |HAZ AsignaWord;

     eaAlfa   = #907#4;           |HAZ QuitaRaros;
     aBeta = eaAlfa;
     |QBF aBeta;
     |SI aBeta = "";
          aVacio = aVacio + " NOMCLI";
     |FINSI;
     eaAsigna = "V#NOMCLI#";      |HAZ AsignaWord;

     eaAlfa   = #907#6;           |HAZ QuitaRaros;
     aBeta = eaAlfa;
     |QBF aBeta;
     |SI aBeta = "";
          aVacio = aVacio + " DIRCLI";
     |FINSI;
     eaAsigna = "V#DIRCLI#";      |HAZ AsignaWord;

     eaAlfa   = #907#7;           |HAZ QuitaRaros;
     aBeta = eaAlfa;
     |QBF aBeta;
     |SI aBeta = "";
          aVacio = aVacio + " POBCLI";
     |FINSI;
     eaAsigna = "V#POBCLI#";      |HAZ AsignaWord;

     eaAlfa   = #907#8;           |HAZ QuitaRaros;
     aBeta = eaAlfa;
     |QBF aBeta;
     |SI aBeta = "";
          aVacio = aVacio + " PROCLI";
     |FINSI;
     eaAsigna = "V#PROCLI#";      |HAZ AsignaWord;

     eaAlfa   = #907#11;          |HAZ QuitaRaros;
     aBeta = eaAlfa;
     |QBF aBeta;
     |SI aBeta = "";
          aVacio = aVacio + " NIFCLI";
     |FINSI;
     eaAsigna = "V#NIFCLI#";      |HAZ AsignaWord;

     efFecha  = #914#8;           |HAZ FechaBarras;
     aBeta = eaAlfa;
     |QBF aBeta;
     |SI aBeta = "";
          aVacio = aVacio + " FECAPO";
     |FINSI;
     eaAsigna = "V#FECAPO#";      |HAZ AsignaWord;

     eaAlfa   = #914#10;          |HAZ QuitaRaros;
     aBeta = eaAlfa;
     |QBF aBeta;
     |SI aBeta = "";
          aVacio = aVacio + " POBNOTAPO";
     |FINSI;
     eaAsigna = "V#POBNOTAPO#";   |HAZ AsignaWord;

     eaAlfa   = #914#9;           |HAZ QuitaRaros;
     aBeta = eaAlfa;
     |QBF aBeta;
     |SI aBeta = "";
          aVacio = aVacio + " NOTARIA";
     |FINSI;
     eaAsigna = "V#NOTAPO#";      |HAZ AsignaWord;

     |DDEFECTO #906;
     #906#0 = #907#1;
     |LEE 000#906.=;

     eaAlfa = #911#13;
     |QBF eaAlfa;

     |ABRE #911;
     |DDEFECTO #911;
     #911#0 = #907#1;
     #911#1 = #907#2;
     |LEE 000#911.=;
     |CIERRA #911;

     aAlfa = #911#2;
     |QBF aAlfa;
     |SI aAlfa ! "";
          eaAlfa = eaAlfa + " ESC " + aAlfa;
     |FINSI;

     aAlfa = #911#3;
     |QBF aAlfa;
     |SI aAlfa ! "";
          eaAlfa = eaAlfa + " PLANTA " + aAlfa;
     |FINSI;

     aAlfa = #911#4;
     |QBF aAlfa;
     |SI aAlfa ! "";
          eaAlfa = eaAlfa + " PTA. " + aAlfa;
     |FINSI;

     aAlfa = #911#5;
     |QBF aAlfa;
     |SI aAlfa ! "";
          eaAlfa = eaAlfa + " TIPO " + aAlfa;
     |FINSI;

     |HAZ QuitaRaros;
     aBeta = eaAlfa;
     |QBF aBeta;
     |SI aBeta = "";
          aVacio = aVacio + " DIRECCION";
     |FINSI;
     eaAsigna = "V#DIRECCION#";      |HAZ AsignaWord;

     eaAlfa = ((("00" + #911#16) % -102) + (("000" + #911#17) % -103));
     eaAsigna = "V#CP#";      |HAZ AsignaWord;

     eaAlfa   = #911#14;           |HAZ QuitaRaros;
     aBeta = eaAlfa;
     |QBF aBeta;
     |SI aBeta = "";
          aVacio = aVacio + " CIUDAD";
     |FINSI;
     eaAsigna = "V#CIUDAD#";   |HAZ AsignaWord;

     ||ARA55
     ||Falta Calcular importe
     nAlquiler = 0;
     nTotalMesFijo = 0;
     |SI aAlqSPA = "N";
         |HAZ CalculaAlquiler;
         ||HAZ CalculaAlquilerLocal;    ||Ahora YA no necesitamos esta distincion
         |HAZ CalculaTotalMesFijo;
     |SINO;
         |HAZ AlquilerSPA;
     |FINSI;
     eaAlfa = nAlquiler;
     |SI nAlquiler = 0;
          aVacio = aVacio + " ALQUILER";
     |FINSI;
     eaAsigna = "V#ALQUILER#";   |HAZ AsignaWord;

     aMensaje = "0000Total Mes Fijo: " + nTotalMesFijo;
     ||MENAV aMensaje;

     eaAlfa = nTotalMesFijo;
     |SI nTotalMesFijo = 0;
          ||aVacio = aVacio + " TOTALMESFIJO";
     |FINSI;
     eaAsigna = "V#TOTALMESFIJO#";   |HAZ AsignaWord;


     ||ARA55
     nIbi = 0;
     |HAZ CalculaIbi;
     eaAlfa = nIbi;
     |SI nIbi = 0;
          aVacio = aVacio + " IBI";
     |FINSI;
     eaAsigna = "V#IBI#";   |HAZ AsignaWord;

     eaAlfa   = #907#19;       |HAZ QuitaRaros;
     nAux = eaAlfa;
     |SI nAux = 0;
          aVacio = aVacio + " FIANZA";
     |FINSI;
     eaAsigna = "V#FIANZA#";   |HAZ AsignaWord;

     eaAlfa   = #907#27;       |HAZ QuitaRaros;
     aBeta = eaAlfa;
     |QBF aBeta;
     |SI aBeta = "";
          aVacio = aVacio + " AVAL";
     |FINSI;
     eaAsigna = "V#AVAL#";   |HAZ AsignaWord;

     eaAlfa = #907#0;         |HAZ QuitaRaros;
     eaAsigna = "V#NUMCONTRATO#";   |HAZ AsignaWord;

     eaAlfa = #907#24;         |HAZ QuitaRaros;
     eaAsigna = "V#TCUOTA#";   |HAZ AsignaWord;

     eaAlfa = #907#43;         |HAZ QuitaRaros;
     eaAsigna = "V#FP#";       |HAZ AsignaWord;

     eaAlfa = #907#14;         |HAZ QuitaRaros;
     eaAsigna = "V#ENTIDAD#";  |HAZ AsignaWord;

     eaAlfa = #907#15;         |HAZ QuitaRaros;
     eaAsigna = "V#OFICINA#";  |HAZ AsignaWord;

     eaAlfa = #907#13;         |HAZ QuitaRaros;
     eaAsigna = "V#DC#";       |HAZ AsignaWord;

     eaAlfa = #907#12;         |HAZ QuitaRaros;
     eaAsigna = "V#NUMCTA#";   |HAZ AsignaWord;

     eaAlfa = "-";
     eaAsigna = "R#LINEA#";   |HAZ AsignaWord;

/*
     ||Esto no lo necesito.
     aAlfa = "[LIMPIA FINAL]" + &13 + &10;
     |XGRABA enHandleTxt, aAlfa;
*/

     ||Impresion por pantalla.
     aAlfa = "[IMPRESORA]#P" + &13 + &10;
     |XGRABA enHandleTxt, aAlfa;

/*
     ||Lo manda a imprimir.
     aAlfa = "[IMPRESORA]#I#0" + &13 + &10;
     |XGRABA enHandleTxt, aAlfa;
*/

     aIPRemoto = "";
     |IP_REMOTO aIPRemoto;

     |SI aIPRemoto = "192.168.10.47";
         aAlfa = "[ERROR]" + &13 + &10;
         |XGRABA enHandleTxt, aAlfa;
     |FINSI;

     |XCIERRA enHandleTxt;


     |QBF aVacio;
     |SI aVacio ! "";
          aMensaje = "0000Aviso de Variables Vacias: " + aVacio;
          |MENAV aMensaje;
     |FINSI;

     eaOrigen  = eaDirTrabServi + eaFicheroTxt;
     eaDestino = eaDirTrabajo   + eaFicheroTxt;
     |HAZ EnviaFicheroSinMD5;

     |FBORRA eaOrigen;

     |PULSATECLA;
     |PULSATECLA;
     |PULSATECLA;

     |HAZ AbreWordExterno;

     |FINVENTANA nVentana;
     |HAZ EnablaPestanyas;
     |ESTADO_CONTROL enBoton0_1, "SHOW";
     |ESTADO_CONTROL enBoton0_2, "SHOW";
     |ESTADO_CONTROL enBoton0_3, "SHOW";
     |ESTADO_CONTROL enBoton0_9, "SHOW";
     |ESTADO_CONTROL enBoton0_10, "SHOW";
     |ESTADO_CONTROL enBoton0_12, "SHOW";
     |ESTADO_CONTROL enBoton3_1, "SHOW";
     |ESTADO_CONTROL enBoton3_2, "SHOW";
     |ESTADO_CONTROL enBoton3_3, "SHOW";
     |ESTADO_CONTROL enBoton3_4, "SHOW";
     |ESTADO_CONTROL enBoton3_5, "SHOW";
     |ESTADO_CONTROL nIdSalir, "SHOW";
|FPRC;

|PROCESO ImporteEdif;
     |SI #912#2 [ #907#16;
          |SI nSwIBI = 1;
               |SI #905#9 = "M";
                    |SI #905#16 = "N";
                         nTotal = #912#3;
                    |SINO;
                         nTotal = (#912#3 * 12) ! 2;
                    |FINSI;
               |SINO;
                    |SI #905#16 = "N";
                         nTotal = #912#3;
                    |SINO;
                         nTotal = (#912#3 * 12) ! 2;
                    |FINSI;
               |FINSI;
          |SINO;
               |SI aTipoMesAny = "A";
                    |SI #905#9 = "U";
                         nTotal = #912#3;
                    |SINO;
                         nTotal = (#912#3 * 12) ! 2;
                    |FINSI;
               |SINO;
                    |SI #905#9 = "U";
                         nTotal = (#912#3 * 12) ! 2;
                    |SINO;
                         nTotal = #912#3;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE ImporteEdif;
 #vipem012#1;
 ;
 #907#1, aBusco, "01.01.0000";
 #907#1, aBusco, "31.12.2999";
 ;
 NULL, ImporteEdif;
|FIN;

|PROCESO ImportePisos;
     |SI #913#3 [ #907#16;
          |SI nSwIBI = 1;
               |SI #905#9 = "M";
                    |SI #905#16 = "N";
                         nTotal = #913#4;
                    |SINO;
                         nTotal = (#913#4 * 12) ! 2;
                    |FINSI;
               |SINO;
                    |SI #905#16 = "N";
                         nTotal = #913#4;
                    |SINO;
                         nTotal = (#913#4 * 12) ! 2;
                    |FINSI;
               |FINSI;
          |SINO;
               |SI aTipoMesAny = "A";
                    |SI #905#9 = "U";
                         nTotal = #913#4;
                    |SINO;
                         nTotal = (#913#4 * 12) ! 2;
                    |FINSI;
               |SINO;
                    |SI #905#9 = "U";
                         nTotal = (#913#4 * 12) ! 2;
                    |SINO;
                         nTotal = #913#4;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE ImportePisos;
 #vipem013#1;
 ;
 #907#1, #907#2, aBusco, "01.01.0000";
 #907#1, #907#2, aBusco, "31.12.2999";
 ;
 NULL, ImportePisos;
|FIN;

|PROCESO vipem005_ibi;
     |SI #vipem005#20 = "S";
          aBusco = #vipem005#0;
          |HAZ DameImpIbi;
     |FINSI;
|FPRC;

|DEFBUCLE vipem005_ibi;
 #vipem005#1;
 ;
 INICIO;
 FINAL;
 ;
 NULL, vipem005_ibi;
|FIN;

|PROCESO CalculaIbi;
     nIbi = 0;
     nSwIBI = 1;
     |BUCLE vipem005_ibi;
     nSwIBI = 0;
|FPRC;

|PROCESO DameImpIbi;
     nTotal = 0;
     aTipoMesAny = "A";
     |BUCLE ImporteEdif;

     nIbi = nIbi + nTotal;

     nTotal = 0 ;
     aTipoMesAny = "A";
     |BUCLE ImportePisos;

     nIbi = nIbi + nTotal;
|FPRC;

|PROCESO vipem005_alqlocal;
     |SI #vipem005#19 = "S";
          aBusco = #vipem005#0;
          |HAZ DameImportes;
     |FINSI;
|FPRC;

|DEFBUCLE vipem005_alqlocal;
 #vipem005#1;
 ;
 INICIO;
 FINAL;
 ;
 NULL, vipem005_alqlocal;
|FIN;

|PROCESO CalculaAlquilerLocal;
     nAlquiler = 0;

     |BUCLE vipem005_alqlocal;
|FPRC;

|PROCESO vipem005_alquiler;
     |SI #vipem005#19 = "S";
          aBusco = #vipem005#0;
          |HAZ DameImportes;
     |FINSI;
|FPRC;

|DEFBUCLE vipem005_alquiler;
 #vipem005#1;
 ;
 INICIO;
 FINAL;
 ;
 NULL, vipem005_alquiler;
|FIN;

|PROCESO CalculaAlquiler;
     nAlquiler = 0;

     |BUCLE vipem005_alquiler;
|FPRC;

|PROCESO DameImportes;
     nTotal = 0;
     aTipoMesAny = "M";
     |BUCLE ImporteEdif;

     nAlquiler = nAlquiler + nTotal;

     nTotal = 0 ;
     aTipoMesAny = "M";
     |BUCLE ImportePisos;

     nAlquiler = nAlquiler + nTotal;
|FPRC;

|PROCESO vipem005_MesFijo;
     |SI #905#9 = "M";
          aSitu = "S";
          nEdificio = #907#1;
          nDesdeIn = #907#2;
          nHastaIn = #907#2;
          aConcepto = #905#0;
          fUltRev = "01.01.0000";
          nUltImp = 0;
          |HAZ DameSituacion;
          nTotalMesFijo = nTotalMesFijo + nUltImp;
     |FINSI;
|FPRC;

|DEFBUCLE vipem005_MesFijo;
 #vipem005#1;
 ;
 INICIO;
 FINAL;
 ;
 NULL, vipem005_MesFijo;
|FIN;

|PROCESO CalculaTotalMesFijo;
     nTotalMesFijo = 0;
     |BUCLE vipem005_MesFijo;
     ||ARA
|FPRC;

|PROCESO Boton3_5;       ||Facturar
     |LEE 000#907.=;
     |SI FSalida ! 0;
          |ESTADO_CONTROL enBoton3_2, "DISABLE";
          |ESTADO_CONTROL enBoton3_3, "DISABLE";
          |ESTADO_CONTROL enBoton3_4, "DISABLE";
          |ESTADO_CONTROL enBoton3_5, "DISABLE";
          |ACABA;
     |SINO;
          |HAZ Facturar;
          |REFRESCACONTROL enGrid3; |FOCOTECLADO enGrid3;
     |FINSI;
|FPRC;

|PROCESO Facturar;
     |ESTADO_CONTROL enBoton0_1, "HIDE";
     |ESTADO_CONTROL enBoton0_2, "HIDE";
     |ESTADO_CONTROL enBoton0_3, "HIDE";
     |ESTADO_CONTROL enBoton0_9, "HIDE";
     |ESTADO_CONTROL enBoton0_10, "HIDE";
     |ESTADO_CONTROL enBoton0_12, "HIDE";

     nPantaPes = enPanta3;
     |HAZ DisablaPestanyas;

     |VENTANA 1101, 3299, -1, 1, ""; nVentana = FSalida;

     |DDEFECTO #810;

     |SI #100#16 = "S";
          |C_M #810#9, 1, "N";
     |SINO;
          |C_M #810#9, 1, "S";
     |FINSI;
     |PINTA #810#9;

     |PINPA #0#810;
     enPantaFac = FSalida;
     |PINDA #0#810;

     |DDEFECTO #810;

     |ABRE #vipew015;
     |DDEFECTO #vipew015;
     |LEE 000#vipew015.p;
     |CIERRA #vipew015;
     #810#2 = #vipew015#0;
     |PINTA #810#2;

     |ENDATOS #1#810;
     |SI FSalida = 0;
          |ABRE #vipew015;
          #vipew015#1 = "1";
          |LEE 101#vipew015.=;
          |SI FSalida ! 0; |GRABA 020#vipew015.b; |FINSI;
          #vipew015#0 = #810#2;
          |GRABA 020#vipew015.a;
          |LIBERA #vipew015;
          |CIERRA #vipew015;

          eaImpResumFac = #810#7;
          eaImpViFac = #810#8;

          enDesdeCon = #907#0;
          enHastaCon = #907#0;
          enAnyFac = #810#0;
          enMesFac = #810#1;
          eaSerFac = #810#2;
          efFecFac = #810#3;
          |SI #810#5 = "S";
               enSwAlbaPen = 1;
          |SINO;
               enSwAlbaPen = 0;
          |FINSI;

          eaHuecosVipei = #810#9;
          |SI #907#36 > 0;
               nAnyos = #907#36 / 1000000;
               fTope = #907#16 + nAnyos;

               aFecHasta = "01." + (("00" + #810#1) % -102) + "." + #810#0;
               fFecHasta = aFecHasta;
               |SI fTope > fFecHasta;
                    aEjecuta = "vipez003;AUTO";
                    |SUB_EJECUTA aEjecuta;
               |SINO;
                    |HAZ RestoFac;
               |FINSI;
          |SINO;
               |HAZ RestoFac;
          |FINSI;

     |FINSI;
     |FINVENTANA nVentana;
     |HAZ EnablaPestanyas;

     |ESTADO_CONTROL enBoton0_1, "SHOW";
     |ESTADO_CONTROL enBoton0_2, "SHOW";
     |ESTADO_CONTROL enBoton0_3, "SHOW";
     |ESTADO_CONTROL enBoton0_9, "SHOW";
     |ESTADO_CONTROL enBoton0_10, "SHOW";
     |ESTADO_CONTROL enBoton0_12, "SHOW";
|FPRC;

|PROCESO RestoFac;
     enSwIncIPC = 0;
     eaAnyoMes = "";
     |HAZ CtrlPorIncIPC;
     |SI enSwIncIPC = 0;
          aMensaje = "0000Imposible Facturar, falta % IPC anual. " + eaAnyoMes;
          |MENAV aMensaje;
     |SINO;
          aEjecuta = "vipez003;AUTO";
          |SUB_EJECUTA aEjecuta;
     |FINSI;
|FPRC;

|PROCESO EventoFocoGrid3;
     FSalida = 1;
     |HAZ EventoPanta3;

     |REFRESCACONTROL enGrid3;
     |FOCOTECLADO enGrid3;
     |HAZ EnablaPestanyas;

     |ESTADO_CONTROL enBoton0_1, "SHOW";
     |ESTADO_CONTROL enBoton0_2, "SHOW";
     |ESTADO_CONTROL enBoton0_3, "SHOW";
     |ESTADO_CONTROL enBoton0_9, "SHOW";
     |ESTADO_CONTROL enBoton0_10, "SHOW";
     |ESTADO_CONTROL enBoton0_12, "SHOW";
|FPRC;

|PROCESO Grid3;
     nRango = 4 + 8 + 16 + 32;
     nPos1  = 0602;
     nPos2  = 2598;
     |LINEAL_SIMPLE #1#907, nRango, nPos1, nPos2, NULL, NULL, EventoPanta3;
     enGrid3  = FSalida;

     |CONTROL_SIMPLE enPanta3, "EVENTOPAN", 0000, 0000, EventoFocoGrid3;
     nFoco3 = FSalida;
|FPRC;

|PROCESO BotonesPanta3;
     nPos1 = 2764;  nPos2 = 2774;
     |CONTROL_SIMPLE enPanta3, "BOTON,{{193}}Nuevo", nPos1, nPos2, Boton3_1;
     enBoton3_1 = FSalida;

     nPos1 = 2776;  nPos2 = 2786;
     |CONTROL_SIMPLE enPanta3, "BOTON,{{197}}Modificar", nPos1, nPos2, Boton3_2;
     enBoton3_2 = FSalida;

     nPos1 = 2788;  nPos2 = 2798;
     |CONTROL_SIMPLE enPanta3, "BOTON,{{199}}Borrar", nPos1, nPos2, Boton3_3;
     enBoton3_3 = FSalida;

     nPos1 = 2702;  nPos2 = 2714;
     |CONTROL_SIMPLE enPanta3, "BOTON,{{205}}Emitir", nPos1, nPos2, Boton3_4;
     enBoton3_4 = FSalida;

     nPos1 = 2716;  nPos2 = 2728;
     |CONTROL_SIMPLE enPanta3, "BOTON,Facturar", nPos1, nPos2, Boton3_5;
     enBoton3_5 = FSalida;
|FPRC;

||************* FINAL PESTA¥A 3. CONTRATOS ***************************************


||************* PESTA¥A 4. APODERADOS ***************************************
|PROCESO EventoPanta4;
     |SI FSalida = 1;  |O FSalida = 2;
         |LEE 000#914=;
         |SI FSalida = 0;
             |ESTADO_CONTROL enBoton4_2, "ENABLE";
             |ESTADO_CONTROL enBoton4_3, "ENABLE";
         |SINO;
             |ESTADO_CONTROL enBoton4_2, "DISABLE";
             |ESTADO_CONTROL enBoton4_3, "DISABLE";
         |FINSI;
     |FINSI;

     |SI FSalida = 4;
          |HAZ Boton4_2;
     |FINSI;
|FPRC;



|PROCESO Boton4_1;
     enModo = 1;
     |HAZ ModiAlta4;
     |REFRESCACONTROL enGrid4; |FOCOTECLADO enGrid4;
|FPRC;

|PROCESO Boton4_2;
     |LEE 000#914.=;
     |SI FSalida ! 0;
          |ESTADO_CONTROL enBoton4_2, "DISABLE";
          |ESTADO_CONTROL enBoton4_3, "DISABLE";
          |ACABA;
     |SINO;
          enModo = 2;
          |HAZ ModiAlta4;
          |REFRESCACONTROL enGrid4; |FOCOTECLADO enGrid4;
     |FINSI;
|FPRC;

|PROCESO Boton4_3;
     |LEE 000#914.=;
     |SI FSalida ! 0;
          |ESTADO_CONTROL enBoton4_2, "DISABLE";
          |ESTADO_CONTROL enBoton4_3, "DISABLE";
          |ACABA;
     |SINO;
          aMensaje = "0000NSeguro de dar de baja: " + #914#1;
          |QBF aMensaje;
          aMensaje = aMensaje + " ?";
          |CONFI aMensaje;
          |SI FSalida ! 0; |ACABA; |FINSI;

          |LEE 101#914.=;
          |SI FSalida = 0;
               |BORRA 020#914a;
               |LIBERA #914;
               FSalida = 1;
               |HAZ EventoPanta4;
          |FINSI;
     |FINSI;

     |REFRESCACONTROL enGrid4; |FOCOTECLADO enGrid4;
|FPRC;

|PROCESO ModiAlta4;
     |ESTADO_CONTROL enBoton0_1, "HIDE";
     |ESTADO_CONTROL enBoton0_2, "HIDE";
     |ESTADO_CONTROL enBoton0_3, "HIDE";
     |ESTADO_CONTROL enBoton0_9, "HIDE";
     |ESTADO_CONTROL enBoton0_10, "HIDE";
     |ESTADO_CONTROL enBoton0_12, "HIDE";

     nPantaPes = enPanta4;
     |HAZ DisablaPestanyas;

     |VENTANA 1101, 3299, -1, 1, ""; nVentana = FSalida;

     |PINPA #0#809;
     enPanta4_ma = FSalida;
     |PINDA #0#809;

     |ABRE #809;

     |LEE 101#914=;

     aCadena ="|NC";
     aAlfa = #914#aCadena#;
     nCampoHasta = aAlfa;
     nCampoHasta = nCampoHasta - 1;

     |SI enModo ! 1;
          |PARA nCampoD = 0;  |SI nCampoD [ nCampoHasta;   |HACIENDO nCampoD = nCampoD + 1;
                nCampoH = nCampoD;
                #809nCampoH = #914nCampoD;
          |SIGUE;

          |C_M #809#0, 1, "N";
     |SINO;
          |C_M #809#0, 1, "S";
          |DDEFECTO #809;
          |HAZ DameUltimo4;
          #809#0 = nUltimo;
     |FINSI;

     |PINPA #0#809;
     |PINDA #0#809;

     |SI enModo = 1;  |ENDATOS #1#809;  |FINSI;
     |SI enModo = 2;  |ENDATOS #2#809;  |FINSI;

     |LIBERA #914;

     |SI FSalida = 0;
          |HAZ GrabaDatos4;
     |FINSI;

     |FINVENTANA nVentana;

     |HAZ EnablaPestanyas;

     |ESTADO_CONTROL enBoton0_1, "SHOW";
     |ESTADO_CONTROL enBoton0_2, "SHOW";
     |ESTADO_CONTROL enBoton0_3, "SHOW";
     |ESTADO_CONTROL enBoton0_9, "SHOW";
     |ESTADO_CONTROL enBoton0_10, "SHOW";
     |ESTADO_CONTROL enBoton0_12, "SHOW";
|FPRC;

|PROCESO DameUltimo4;
     |DDEF aAlfa; |QBF aAlfa;
     aAlfa = aAlfa + "vipem014";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |ABRE #referen@;
     |LEE 000#2000u;
     |SI FSalida = 0;
          nUltimo = #2000#0 + 1;
     |SINO;
          nUltimo = 1;
     |FINSI;

     |CIERRA #referen@;
     |DESCARGA_DEF #referen@;
|FPRC;

|PROCESO GrabaDatos4;
     #914#0 = #809#0;
     |LEE 101#914=;
     |SI FSalida ! 0;
         |DDEFECTO #914;
         #914#0 = #809#0;
         |GRABA 020#914b;
     |FINSI;

     |PARA nCampoD = 1;  |SI nCampoD [ nCampoHasta;  |HACIENDO nCampoD = nCampoD + 1;
          nCampoH   = nCampoD;
          #914nCampoD = #809nCampoH;
     |SIGUE;

     |GRABA 020#914a;
     |LIBERA #914;
|FPRC;

|PROCESO NoRepetido4; |TIPO 0;
     |SI enModo ! 1;  |ACABA;  |FINSI;

     #914#0 = #809#0;
     |LEE 000#914=;
     |SI FSalida = 0;
         |MENAV "0000 El Codigo de Contrato ya Existe.";
         |POSICIONATE #809#0;
     |FINSI;
|FPRC;

|PROCESO EventoFocoGrid4;
     FSalida = 1;
     |HAZ EventoPanta4;

     |REFRESCACONTROL enGrid4;
     |FOCOTECLADO enGrid4;
|FPRC;

|PROCESO Grid4;
     nRango = 4 + 8 + 16 + 32;
     nPos1  = 0602;
     nPos2  = 2598;
     |LINEAL_SIMPLE #1#914, nRango, nPos1, nPos2, NULL, NULL, EventoPanta4;
     enGrid4  = FSalida;

     |CONTROL_SIMPLE enPanta4, "EVENTOPAN", 0000, 0000, EventoFocoGrid4;
     nFoco4 = FSalida;
|FPRC;

|PROCESO BotonesPanta4;
     nPos1 = 2764;  nPos2 = 2774;
     |CONTROL_SIMPLE enPanta4, "BOTON,{{193}}Nuevo", nPos1, nPos2, Boton4_1;
     enBoton4_1 = FSalida;

     nPos1 = 2776;  nPos2 = 2786;
     |CONTROL_SIMPLE enPanta4, "BOTON,{{197}}Modificar", nPos1, nPos2, Boton4_2;
     enBoton4_2 = FSalida;

     nPos1 = 2788;  nPos2 = 2798;
     |CONTROL_SIMPLE enPanta4, "BOTON,{{199}}Borrar", nPos1, nPos2, Boton4_3;
     enBoton4_3 = FSalida;
|FPRC;

||************* FINAL PESTA¥A 4. APODERADOS  ***************************************


||************* PESTA¥A 5. RESERVAS ***************************************

|PROCESO Tipo0C1w013; |TIPO 0;
     #906#0 = #813#1;
     |LEE 000#906=;
     |SI FSalida ! 0;
          aMensaje = "0000No existe Número de Edificio.";
          |MENAV aMensaje;
          |ERROR;
     |SINO;
          |PINTA 0935, #906#1;
          |PINTA 0935, #906#1;
     |FINSI;
|FPRC;

|PROCESO Tipo66C2w013; |TIPO 66;
     |ABRE #911;
     |CONSULTA_F_CLAVE #1#911, Baja911, Alta911;
     |SI FSalida = 0;
          #813#2 = #911#1;
          |PINTA #813#2;
     |FINSI;
     |CIERRA #911;
|FPRC;

|PROCESO Tipo0C2w013; |TIPO 0;
     |ABRE #911;
     #911#0 = #813#1;
     #911#1 = #813#2;
     |LEE 000#911=;
     |SI FSalida ! 0;
          aMensaje = "0000No existe Número de Inmueble para este Edificio";
          |MENAV aMensaje;
          |ERROR;
     |SINO;
          |PINTA 1035, #911#2;
          |PINTA 1039, #911#3;
          |PINTA 1042, #911#4;
     |FINSI;
     |CIERRA #911;
|FPRC;

|PROCESO NoRepetidow013; |TIPO 0;
     |SI enModo ! 1;  |ACABA;  |FINSI;

     #920#0 = #813#0;
     |LEE 000#920=;
     |SI FSalida = 0;
         |MENAV "0000 El Codigo de Reserva ya Existe.";
         |POSICIONATE #813#0;
     |FINSI;
|FPRC;

|PROCESO Tipo0C11w013;  |TIPO 0;
|FPRC;

|PROCESO BuscaFechaCtow13;
     |SI fDFecha ] #2000#16;  |Y fHFecha [ #2000#17;
         nSwError = 1;
         |ERROR10;
         |ACABA;
     |FINSI;

     |SI fDFecha < #2000#16;  |Y fHFecha > #2000#17;
         nSwError = 1;
         |ERROR10;
         |ACABA;
     |FINSI;

     |SI fDFecha ] #2000#16;  |Y fDFecha [ #2000#17;
         nSwError = 1;
         |ERROR10;
         |ACABA;
     |FINSI;

     |SI fHFecha ] #2000#16;  |Y fHFecha [ #2000#17;
         nSwError = 1;
         |ERROR10;
         |ACABA;
     |FINSI;
|FPRC;

|DEFBUCLE BuscaFechaCtow13;
     #2000#2003;
     ;
     #813#1, #813#2, 00000001;
     #813#1, #813#2, 99999999;
     ;
     NULL, BuscaFechaCtow13;
|FIN;

|PROCESO BuscaFechaResw13;
     |SI #2000#0 = #813#0;  |ACABA;  |FINSI;

     |SI fDFecha ] #2000#11;  |Y fHFecha [ #2000#12;
         nSwError = 1;
         |ERROR10;
         |ACABA;
     |FINSI;

     |SI fDFecha < #2000#11;  |Y fHFecha > #2000#12;
         nSwError = 1;
         |ERROR10;
         |ACABA;
     |FINSI;

     |SI fDFecha ] #2000#11;  |Y fDFecha [ #2000#12;
         nSwError = 1;
         |ERROR10;
         |ACABA;
     |FINSI;

     |SI fHFecha ] #2000#11;  |Y fHFecha [ #2000#12;
         nSwError = 1;
         |ERROR10;
         |ACABA;
     |FINSI;
|FPRC;

|DEFBUCLE BuscaFechaResw13;
     #2000#2003;
     ;
     #813#1, #813#2, 00000001;
     #813#1, #813#2, 99999999;
     ;
     NULL, BuscaFechaResw13;
|FIN;

|PROCESO Tipo0C12w013; TIPO 0;
     |SI #813#12 ! "01.01.0000";
          |SI #813#12 < #813#11;
               aMensaje = "0000Fecha Hasta Reserva inferior a Fecha Desde Reserva";
               |MENAV aMensaje;
               |POSICIONATE #813#11;
               nSwError = 1;
          |FINSI;
     |FINSI;

     |DDEF aAlfa; |QBF aAlfa;
     aAlfa = aAlfa + "vipem007";
     |CARGA_DEF aAlfa, referen@;

     nSwError = 0;
     fDFecha = #813#11;
     fHFecha = #813#12;
     |SI #813#12 = "01.01.0000";   fHFecha = "31.12.2999";  |FINSI;

     |BUCLE BuscaFechaCtow13;

     |DESCARGA_DEF #referen@;

     |SI nSwError = 1;
         |MENAV "0000 Ya hay un contrato entre estas fechas.";
         |POSICIONATE #813#11;
         |ACABA;
     |FINSI;

     |DDEF aAlfa; |QBF aAlfa;
     aAlfa = aAlfa + "vipem020";
     |CARGA_DEF aAlfa, referen@;

     nSwError = 0;
     |BUCLE BuscaFechaResw13;

     |DESCARGA_DEF #referen@;

     |SI nSwError = 1;
         |MENAV "0000 Hay una reserva entre estas fechas";
         |POSICIONATE #813#11;
         |ACABA;
     |FINSI;
|FPRC;

|PROCESO Tipo0C10w013; TIPO 0;
     |SI FSalida = 10;
         eaVarDni   = #813#10;
         enCalcCif  = 1;
         |HAZ CalculoNIFCIF;
         #813#10 = eaVarDni;
         |PINTA #813#10;
         |ERROR;
         |ACABA;
     |FINSI;

     eaVarDni  = #813#10;
     enCalcCif = 0;
     |HAZ CalculoNIFCIF;
     aNifQbf1 = #813#10;   |QBF aNifQbf1;
     aNifQbf2 = eaVarDni;  |QBF aNifQbf2;

     |SI aNifQbf1 ! aNifQbf2; |Y aNifQbf1 ! "";
         |CONFI "0000SEl Nif puede ser Erroneo. Desea Calcularlo.";
         |SI FSalida = 0;
             #813#10 = eaVarDni;  |PINTA #813#10;
             |ERROR;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO DameUltimo5;
     |DDEF aAlfa; |QBF aAlfa;
     aAlfa = aAlfa + "vipem020";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |ABRE #referen@;
     |LEE 000#2000u;
     |SI FSalida = 0;
          nUltimo = #2000#0 + 1;
     |SINO;
          nUltimo = 1;
     |FINSI;

     |CIERRA #referen@;
     |DESCARGA_DEF #referen@;
|FPRC;

|PROCESO GrabaDatos5;
     #920#0 = #813#0;
     |LEE 101#920=;
     |SI FSalida ! 0;
         |DDEFECTO #920;
         #920#0 = #813#0;
         |GRABA 020#920b;
     |FINSI;

     |PARA nCampoD = 1;  |SI nCampoD [ nCampoHasta;  |HACIENDO nCampoD = nCampoD + 1;
          nCampoH   = nCampoD;
          #920nCampoD = #813nCampoH;
     |SIGUE;

     |GRABA 020#920a;
     |LIBERA #920;
|FPRC;

|PROCESO ModiAlta5;
     |ESTADO_CONTROL enBoton0_1, "HIDE";
     |ESTADO_CONTROL enBoton0_2, "HIDE";
     |ESTADO_CONTROL enBoton0_3, "HIDE";
     |ESTADO_CONTROL enBoton0_9, "HIDE";
     |ESTADO_CONTROL enBoton0_10, "HIDE";
     |ESTADO_CONTROL enBoton0_12, "HIDE";

     nPantaPes = enPanta5;
     |HAZ DisablaPestanyas;

     |VENTANA 1101, 3299, -1, 1, ""; nVentana = FSalida;

     |PINPA #0#813;
     enPanta5_ma = FSalida;
     |PINDA #0#813;

     |LEE 101#920=;

     aCadena ="|NC";
     aAlfa = #920#aCadena#;
     nCampoHasta = aAlfa;
     nCampoHasta = nCampoHasta - 1;

     |SI enModo ! 1;
          |PARA nCampoD = 0;  |SI nCampoD [ nCampoHasta;   |HACIENDO nCampoD = nCampoD + 1;
                nCampoH = nCampoD;
                #813nCampoH = #920nCampoD;
          |SIGUE;

          |C_M #813#0, 1, "N";
          |C_M #813#1, 1, "N";
          |C_M #813#2, 1, "N";
     |SINO;
          |C_M #813#0, 1, "S";
          |C_M #813#1, 1, "S";
          |C_M #813#2, 1, "S";
          |DDEFECTO #813;
          |HAZ DameUltimo5;
          #813#0 = nUltimo;
     |FINSI;

     |PINPA #0#813;
     |PINDA #0#813;

     |SI enModo = 1;  |ENDATOS #1#813;  |FINSI;
     |SI enModo = 2;  |ENDATOS #2#813;  |FINSI;

     |SI FSalida = 0;
          |LIBERA #920;
          |HAZ GrabaDatos5;
     |SINO;
          |LIBERA #920;
     |FINSI;

     |FINVENTANA nVentana;

     |HAZ EnablaPestanyas;

     |ESTADO_CONTROL enBoton0_1, "SHOW";
     |ESTADO_CONTROL enBoton0_2, "SHOW";
     |ESTADO_CONTROL enBoton0_3, "SHOW";
     |ESTADO_CONTROL enBoton0_9, "SHOW";
     |ESTADO_CONTROL enBoton0_10, "SHOW";
     |ESTADO_CONTROL enBoton0_12, "SHOW";
|FPRC;

|PROCESO Boton5_1;
     enModo = 1;
     |HAZ ModiAlta5;
     |REFRESCACONTROL enGrid5; |FOCOTECLADO enGrid5;
|FPRC;

|PROCESO Boton5_2;
     |LEE 000#920.=;
     |SI FSalida ! 0;
          |ESTADO_CONTROL enBoton5_2, "DISABLE";
          |ESTADO_CONTROL enBoton5_3, "DISABLE";
          |ACABA;
     |SINO;
          enModo = 2;
          |HAZ ModiAlta5;
          |REFRESCACONTROL enGrid5; |FOCOTECLADO enGrid5;
     |FINSI;
|FPRC;

|PROCESO Boton5_3;
     |LEE 000#920.=;
     |SI FSalida ! 0;
          |ESTADO_CONTROL enBoton5_2, "DISABLE";
          |ESTADO_CONTROL enBoton5_3, "DISABLE";
          |ACABA;
     |SINO;
          aMensaje = "0000NSeguro de dar de baja: " + #920#0
          |QBF aMensaje;
          aMensaje = aMensaje + " ?";
          |CONFI aMensaje;
          |SI FSalida ! 0; |ACABA; |FINSI;

          |LEE 101#920.=;
          |SI FSalida = 0;
               |BORRA 020#920a;
               |LIBERA #920;
               FSalida = 1;
               |HAZ EventoPanta5;
          |FINSI;
     |FINSI;

     |REFRESCACONTROL enGrid5; |FOCOTECLADO enGrid5;
|FPRC;

|PROCESO EventoPanta5;
     |SI FSalida = 1;  |O FSalida = 2;
         |LEE 000#920=;
         |SI FSalida = 0;
             |ESTADO_CONTROL enBoton5_2, "ENABLE";
             |ESTADO_CONTROL enBoton5_3, "ENABLE";
         |SINO;
             |ESTADO_CONTROL enBoton5_2, "DISABLE";
             |ESTADO_CONTROL enBoton5_3, "DISABLE";
         |FINSI;
     |FINSI;

     |SI FSalida = 4;
          |HAZ Boton5_2;
     |FINSI;
|FPRC;

|PROCESO EventoFocoGrid5;
     FSalida = 1;
     |HAZ EventoPanta5;

     |REFRESCACONTROL enGrid5;
     |FOCOTECLADO enGrid5;
     |HAZ EnablaPestanyas;

     |ESTADO_CONTROL enBoton0_1, "SHOW";
     |ESTADO_CONTROL enBoton0_2, "SHOW";
     |ESTADO_CONTROL enBoton0_3, "SHOW";
     |ESTADO_CONTROL enBoton0_9, "SHOW";
     |ESTADO_CONTROL enBoton0_10, "SHOW";
     |ESTADO_CONTROL enBoton0_12, "SHOW";
|FPRC;

|PROCESO Grid5;
     nRango = 4 + 8 + 16 + 32;
     nPos1  = 0602;
     nPos2  = 2598;
     |LINEAL_SIMPLE #1#920, nRango, nPos1, nPos2, NULL, NULL, EventoPanta5;
     enGrid5  = FSalida;

     |CONTROL_SIMPLE enPanta5, "EVENTOPAN", 0000, 0000, EventoFocoGrid5;
     nFoco5 = FSalida;
|FPRC;

|PROCESO BotonesPanta5;
     nPos1 = 2764;  nPos2 = 2774;
     |CONTROL_SIMPLE enPanta5, "BOTON,{{193}}Nuevo", nPos1, nPos2, Boton5_1;
     enBoton5_1 = FSalida;

     nPos1 = 2776;  nPos2 = 2786;
     |CONTROL_SIMPLE enPanta5, "BOTON,{{197}}Modificar", nPos1, nPos2, Boton5_2;
     enBoton5_2 = FSalida;

     nPos1 = 2788;  nPos2 = 2798;
     |CONTROL_SIMPLE enPanta5, "BOTON,{{199}}Borrar", nPos1, nPos2, Boton5_3;
     enBoton5_3 = FSalida;
|FPRC;

||************* FINAL PESTA¥A 5. RESERVAS ***************************************


||************* PESTA¥A 6. AVISOS ***************************************

|PROCESO Tipo0C2w014; |TIPO 0;
     nMes = #814#2;
     |HAZ DameMes;
     #814#8 = eaMes;
     |PINTA #814#8;
|FPRC;

|PROCESO NoRepetidow014; |TIPO 0;
     |SI enModo ! 1;  |ACABA;  |FINSI;

     #922#0 = #814#0;
     |LEE 000#922=;
     |SI FSalida = 0;
         |MENAV "0000 El Codigo de Aviso ya Existe.";
         |POSICIONATE #814#0;
     |FINSI;
|FPRC;

|PROCESO DameUltimo6;
     |DDEF aAlfa; |QBF aAlfa;
     aAlfa = aAlfa + "vipem022";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |ABRE #referen@;
     |LEE 000#2000u;
     |SI FSalida = 0;
          nUltimo = #2000#0 + 1;
     |SINO;
          nUltimo = 1;
     |FINSI;

     |CIERRA #referen@;
     |DESCARGA_DEF #referen@;
|FPRC;

|PROCESO GrabaDatos6;
     #922#0 = #814#0;
     |LEE 101#922=;
     |SI FSalida ! 0;
         |DDEFECTO #922;
         #922#0 = #814#0;
         |GRABA 020#922b;
     |FINSI;

     |PARA nCampoD = 1;  |SI nCampoD [ nCampoHasta;  |HACIENDO nCampoD = nCampoD + 1;
          nCampoH   = nCampoD;
          #922nCampoD = #814nCampoH;
     |SIGUE;

     |GRABA 020#922a;
     |LIBERA #922;
|FPRC;

|PROCESO ModiAlta6;
     |ESTADO_CONTROL enBoton0_1, "HIDE";
     |ESTADO_CONTROL enBoton0_2, "HIDE";
     |ESTADO_CONTROL enBoton0_3, "HIDE";
     |ESTADO_CONTROL enBoton0_9, "HIDE";
     |ESTADO_CONTROL enBoton0_10, "HIDE";
     |ESTADO_CONTROL enBoton0_12, "HIDE";

     nPantaPes = enPanta6;
     |HAZ DisablaPestanyas;

     |VENTANA 1101, 3299, -1, 1, ""; nVentana = FSalida;

     |PINPA #0#814;
     enPanta6_ma = FSalida;
     |PINDA #0#814;

     |LEE 101#922=;

     aCadena ="|NC";
     aAlfa = #922#aCadena#;
     nCampoHasta = aAlfa;
     nCampoHasta = nCampoHasta - 1;

     |SI enModo ! 1;
          |PARA nCampoD = 0;  |SI nCampoD [ nCampoHasta;   |HACIENDO nCampoD = nCampoD + 1;
                nCampoH = nCampoD;
                #814nCampoH = #922nCampoD;
          |SIGUE;

          |C_M #814#0, 1, "N";
     |SINO;
          |C_M #814#0, 1, "S";
          |DDEFECTO #814;
          |HAZ DameUltimo6;
          #814#0 = nUltimo;
          aFechaSys = fSistema;
          aAnyo = aFechaSys % -104;
          nAnyo = aAnyo;
          #814#1 = nAnyo;
          |HORA aHora;
          |QBF aHora;
          aHora = aHora % 105;
          aUsuario = Usuario % 810;
          #814#3 = aUsuario;
          #814#4 = ~;
          #814#5 = aHora;
          #814#9 = ~;
          #814#10 = aHora;

          #814#8 = "Enero";
     |FINSI;

     |PINPA #0#814;
     |PINDA #0#814;

     |SI enModo = 1;  |ENDATOS #1#814;  |FINSI;
     |SI enModo = 2;  |ENDATOS #2#814;  |FINSI;

     |SI FSalida = 0;
          |LIBERA #922;
          |HAZ GrabaDatos6;
     |SINO;
          |LIBERA #922;
     |FINSI;

     |FINVENTANA nVentana;

     |HAZ EnablaPestanyas;

     |ESTADO_CONTROL enBoton0_1, "SHOW";
     |ESTADO_CONTROL enBoton0_2, "SHOW";
     |ESTADO_CONTROL enBoton0_3, "SHOW";
     |ESTADO_CONTROL enBoton0_9, "SHOW";
     |ESTADO_CONTROL enBoton0_10, "SHOW";
     |ESTADO_CONTROL enBoton0_12, "SHOW";
|FPRC;

|PROCESO Boton6_1;
     enModo = 1;
     |HAZ ModiAlta6;
     |REFRESCACONTROL enGrid6; |FOCOTECLADO enGrid6;
|FPRC;

|PROCESO Boton6_2;
     |LEE 000#922.=;
     |SI FSalida ! 0;
          |ESTADO_CONTROL enBoton6_2, "DISABLE";
          |ESTADO_CONTROL enBoton6_3, "DISABLE";
          |ACABA;
     |SINO;
          enModo = 2;
          |HAZ ModiAlta6;
          |REFRESCACONTROL enGrid6; |FOCOTECLADO enGrid6;
     |FINSI;
|FPRC;

|PROCESO Boton6_3;
     |LEE 000#922.=;
     |SI FSalida ! 0;
          |ESTADO_CONTROL enBoton6_2, "DISABLE";
          |ESTADO_CONTROL enBoton6_3, "DISABLE";
          |ACABA;
     |SINO;
          aMensaje = "0000NSeguro de dar de baja: " + #922#0
          |QBF aMensaje;
          aMensaje = aMensaje + " ?";
          |CONFI aMensaje;
          |SI FSalida ! 0; |ACABA; |FINSI;

          |LEE 101#922.=;
          |SI FSalida = 0;
               |BORRA 020#922a;
               |LIBERA #920;
               FSalida = 1;
               |HAZ EventoPanta6;
          |FINSI;
     |FINSI;

     |REFRESCACONTROL enGrid6; |FOCOTECLADO enGrid6;
|FPRC;

|PROCESO EventoPanta6;
     |SI FSalida = 1;  |O FSalida = 2;
         |LEE 000#922=;
         |SI FSalida = 0;
             |ESTADO_CONTROL enBoton6_2, "ENABLE";
             |ESTADO_CONTROL enBoton6_3, "ENABLE";
         |SINO;
             |ESTADO_CONTROL enBoton6_2, "DISABLE";
             |ESTADO_CONTROL enBoton6_3, "DISABLE";
         |FINSI;
     |FINSI;

     |SI FSalida = 4;
          |HAZ Boton6_2;
     |FINSI;
|FPRC;

|PROCESO EventoFocoGrid6;
     FSalida = 1;
     |HAZ EventoPanta6;

     |REFRESCACONTROL enGrid6;
     |FOCOTECLADO enGrid6;
     |HAZ EnablaPestanyas;

     |ESTADO_CONTROL enBoton0_1, "SHOW";
     |ESTADO_CONTROL enBoton0_2, "SHOW";
     |ESTADO_CONTROL enBoton0_3, "SHOW";
     |ESTADO_CONTROL enBoton0_9, "SHOW";
     |ESTADO_CONTROL enBoton0_10, "SHOW";
     |ESTADO_CONTROL enBoton0_12, "SHOW";
|FPRC;

|PROCESO Grid6;
     nRango = 4 + 8 + 16 + 32;
     nPos1  = 0602;
     nPos2  = 2598;
     |LINEAL_SIMPLE #1#922, nRango, nPos1, nPos2, NULL, NULL, EventoPanta6;
     enGrid6  = FSalida;

     |CONTROL_SIMPLE enPanta6, "EVENTOPAN", 0000, 0000, EventoFocoGrid6;
     nFoco6 = FSalida;
|FPRC;

|PROCESO BotonesPanta6;
     nPos1 = 2764;  nPos2 = 2774;
     |CONTROL_SIMPLE enPanta6, "BOTON,{{193}}Nuevo", nPos1, nPos2, Boton6_1;
     enBoton6_1 = FSalida;

     nPos1 = 2776;  nPos2 = 2786;
     |CONTROL_SIMPLE enPanta6, "BOTON,{{197}}Modificar", nPos1, nPos2, Boton6_2;
     enBoton6_2 = FSalida;

     nPos1 = 2788;  nPos2 = 2798;
     |CONTROL_SIMPLE enPanta6, "BOTON,{{199}}Borrar", nPos1, nPos2, Boton6_3;
     enBoton6_3 = FSalida;
|FPRC;

||************* FINAL PESTA¥A 6. AVISOS ***************************************



|PROCESO DestruyeControles;
     |DESTRUYECONTROL enGrid1;
     |DESTRUYECONTROL enGrid2;
     |DESTRUYECONTROL enGrid3;
     |DESTRUYECONTROL enGrid4;
     |DESTRUYECONTROL enGrid5;

     |FIN_CONTROL_WINDOWS enBoton0_1;
     |FIN_CONTROL_WINDOWS enBoton0_2;
     |FIN_CONTROL_WINDOWS enBoton0_3;
     |FIN_CONTROL_WINDOWS enBoton0_4;
     |FIN_CONTROL_WINDOWS enBoton0_5;
     |FIN_CONTROL_WINDOWS enBoton0_6;
     |FIN_CONTROL_WINDOWS enBoton0_7;
     |FIN_CONTROL_WINDOWS enBoton0_8;
     |FIN_CONTROL_WINDOWS enBoton0_9;
     |FIN_CONTROL_WINDOWS enBoton0_10;
     |FIN_CONTROL_WINDOWS enBoton0_11;
     |FIN_CONTROL_WINDOWS enBoton0_12;

     |FIN_CONTROL_WINDOWS enBoton1_1;
     |FIN_CONTROL_WINDOWS enBoton1_2;
     |FIN_CONTROL_WINDOWS enBoton1_3;

     |FIN_CONTROL_WINDOWS enBoton2_1;
     |FIN_CONTROL_WINDOWS enBoton2_2;
     |FIN_CONTROL_WINDOWS enBoton2_3;
     |FIN_CONTROL_WINDOWS enBoton2_4;
     |FIN_CONTROL_WINDOWS enBoton2_5;

     |FIN_CONTROL_WINDOWS enBoton3_1;
     |FIN_CONTROL_WINDOWS enBoton3_2;
     |FIN_CONTROL_WINDOWS enBoton3_3;
     |FIN_CONTROL_WINDOWS enBoton3_4;
     |FIN_CONTROL_WINDOWS enBoton3_5;

     |FIN_CONTROL_WINDOWS enBoton4_1;
     |FIN_CONTROL_WINDOWS enBoton4_2;
     |FIN_CONTROL_WINDOWS enBoton4_3;

     |FIN_CONTROL_WINDOWS enBoton5_1;
     |FIN_CONTROL_WINDOWS enBoton5_2;
     |FIN_CONTROL_WINDOWS enBoton5_3;

     |FIN_CONTROL_WINDOWS enBoton6_1;
     |FIN_CONTROL_WINDOWS enBoton6_2;
     |FIN_CONTROL_WINDOWS enBoton6_3;
|FPRC;

|PROCESO Baja911;
     #911#0 = #813#1;
     #911#1 =  0;
|FPRC;

|PROCESO Alta911;
     #911#0 = #813#1;
     #911#1 = 999;
|FPRC;

|PROCESO SoloNumero; |TIPO 0;
     aAlfa = #802#Campo#;
     eaCta = aAlfa;
     |HAZ MFiltraPtos;
     #802#Campo# = eaCta; |PINTA #802#Campo#;

     eswCta = 0;
     |HAZ MCtaContable;
     |SI eswCta = 1;
         |MENAV "    Error. Longitud de Cuenta fuera de Nivel";
         |ERROR;
     |FINSI;

/*
     |QBF aAlfa;
     |SI aAlfa ! "";
          aLong = aAlfa % A0;
          nLong = aLong;
          |PARA nConta = 1; |SI nConta [ nLong; |HACIENDO nConta = nConta + 1;
               aCont = ("00" + nConta) % -102;
               aSaca = aCont + "01";
               aLetra = aAlfa % aSaca;
               |SI aLetra < "0"; |O aLetra > "9";
                    aMensaje = "0000Por favor introduzca un Número como Agrupación Contable";
                    |MENAV aMensaje;
                    |ERROR;
                    |SAL;
               |FINSI;
          |SIGUE;
     |FINSI;
*/
|FPRC;

|PROCESO CopiaXML;
     aOrigen = aBase + "002805g/" + aNomOri + ".xml";
     aDestino = aBase + "002805g/" + aNomDes + ".xml";
     |COPIA_FICHERO aOrigen, aDestino;
|FPRC;

|PROCESO BotonInicio;
     |SI nNivelPan > 0;
          |ESTADO_CONTROL enBoton0_4, "SHOW";
          |ESTADO_CONTROL enBoton0_5, "SHOW";
          |ESTADO_CONTROL enBoton0_6, "SHOW";
          |ESTADO_CONTROL enBoton0_7, "SHOW";
          |ESTADO_CONTROL enBoton0_8, "SHOW";
          |ESTADO_CONTROL enBoton0_11, "SHOW";
     |SINO;
          |ESTADO_CONTROL enBoton0_4, "HIDE";
          |ESTADO_CONTROL enBoton0_5, "HIDE";
          |ESTADO_CONTROL enBoton0_6, "HIDE";
          |ESTADO_CONTROL enBoton0_7, "HIDE";
          |ESTADO_CONTROL enBoton0_8, "HIDE";
          |ESTADO_CONTROL enBoton0_11, "HIDE";
     |FINSI;
     ||ESTADO_CONTROL enBoton0_2, "DISABLE";
|FPRC;

|PROCESO ShowInicio;
     |ESTADO_CONTROL enBoton0_4, "SHOW";
     |ESTADO_CONTROL enBoton0_5, "SHOW";
     |ESTADO_CONTROL enBoton0_6, "SHOW";
     |ESTADO_CONTROL enBoton0_7, "SHOW";
     |ESTADO_CONTROL enBoton0_8, "SHOW";
     |ESTADO_CONTROL enBoton0_11, "SHOW";
|FPRC;

|PROCESO HideInicio;
     |ESTADO_CONTROL enBoton0_4, "HIDE";
     |ESTADO_CONTROL enBoton0_5, "HIDE";
     |ESTADO_CONTROL enBoton0_6, "HIDE";
     |ESTADO_CONTROL enBoton0_7, "HIDE";
     |ESTADO_CONTROL enBoton0_8, "HIDE";
     |ESTADO_CONTROL enBoton0_11, "HIDE";
|FPRC;

|PROCESO Tipo66C8w003; |TIPO 66;
     |ABRE #agifa142;
     |LEE 000#agifa142.p;
     |SI FSalida ! 0;
          aMensaje = "0000Empresa de Contabilidad NO definida en Parámetros Generales";
          |MENAV aMensaje;
          |ACABA;
     |SINO;
          aPathConta = #agifa142#151;
          |QBF aPathConta;
          |SI aPathConta = "";
               aMensaje = "0000Empresa de Contabilidad NO definida en Parámetros Generales";
               |MENAV aMensaje;
               |ACABA;
          |SINO;
               nEmpConta = #agifa142#152;
               aEmpConta = ("000000" + nEmpConta) % -106;
               aPathDatos = aPathConta + "fich/" + aEmpConta + "/";
               aAlfa = aPathConta + "def/anm00001";
               |CARGA_DEF aAlfa, otrodef@;
               |SI FSalida ! 0;
                    aMensaje = "0000Problemas con el carga_def " + aAlfa;
                    |MENAV aMensaje;
                    |ACABA;
               |FINSI;

               |PATH_DAT #2001 aPathDatos;

               |ABRE #2001;
               |CONSULTA_CLAVE #1#2001;
               |SI FSalida = 0;
                    #803#8 = #2001#0;
                    #803#9 = #2001#1;
                    |PINTA #803#8;
                    |PINTA #803#9;
               |FINSI;
               |CIERRA #2001;

               |DESCARGA_DEF #otrodef@;
               |ERROR;
          |FINSI;
     |FINSI;

     |CIERRA #agifa142;
|FPRC;

|PROCESO Tipo0C26w003; |TIPO 0;
     |SI #803#26 = 1;
          #803#27 = "Trimestral";
     |SINO;
          |SI #803#26 = 2;
               #803#27 = "Semestral";
          |SINO;
               |SI #803#26 = 3;
                    #803#27 = "Anual";
               |SINO;
                    #803#27 = "Mensual";
               |FINSI;
          |FINSI;
     |FINSI;
     |PINTA #803#27;
|FPRC;

|PROCESO Tipo0C8w003; |TIPO 0;
     |ABRE #agifa142;
     |LEE 000#agifa142.p;
     |SI FSalida ! 0;
          aMensaje = "0000Empresa de Contabilidad NO definida en Parámetros Generales";
          |MENAV aMensaje;
          |ACABA;
     |SINO;
          aPathConta = #agifa142#151;
          |QBF aPathConta;
          |SI aPathConta = "";
               aMensaje = "0000Empresa de Contabilidad NO definida en Parámetros Generales";
               |MENAV aMensaje;
               |ACABA;
          |SINO;
               nEmpConta = #agifa142#152;
               aEmpConta = ("000000" + nEmpConta) % -106;
               aPathDatos = aPathConta + "fich/" + aEmpConta + "/";
               aAlfa = aPathConta + "def/anm00001";
               |CARGA_DEF aAlfa, otrodef@;
               |SI FSalida ! 0;
                    aMensaje = "0000Problemas con el carga_def " + aAlfa;
                    |MENAV aMensaje;
                    |ACABA;
               |FINSI;

               |PATH_DAT #2001 aPathDatos;

               |ABRE #2001;
               #2001#0 = #803#8;
               |LEE 000#2001.=;
               |SI FSalida = 0;
                    #803#9 = #2001#1;
                    |PINTA #803#9;
               |SINO;
                    #803#9 = "";
                    |PINTA #803#9;
                    aMensaje = "0000La cuenta Analitica NO existe en Contabilidad";
                    |MENAV aMensaje;
                    |ERROR;
               |FINSI;
               |CIERRA #2001;

               |DESCARGA_DEF #otrodef@;
          |FINSI;
     |FINSI;

     |CIERRA #agifa142;
|FPRC;

|PROCESO ValorCtaAna; |TIPO 0;
     nCampo = Campo;
     nCampo = nCampo - 7;
     |SI #803#nCampo# = "V";
          aValor = #803#Campo#;
          nValor = aValor;
          |SI nValor < 1; |O nValor > 6;
               aMensaje = "0000Por favor, indique la posición respecto al código del cliente. De 1 al 6";
               |MENAV aMensaje;
               |ERROR;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Tipo0C2w010; |TIPO 0;
     eaHayHuecos = "N";
     eaSerHuecos = #vipew010#2;
     |HAZ MiraHuecosFV;
     |SI eaHayHuecos = "N";
          eaHuecosVipei = "N";
     |SINO;
          aMensaje = "0000SReutilizar huecos S/N?";
          |CONFI aMensaje;
          |SI FSalida = 0;
               eaHuecosVipei = "S";
          |SINO;
               eaHuecosVipei = "N";
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO AltaSerie;
     fSistema = ~;
     aSistema = fSistema;
     aAnyo = aSistema % -102;

     ||Tiquet 2805|2180
     ||SI aSerie ! "SP";
          aSerie = aSerie + aAnyo;
     ||FINSI;

     |ABRE #agifa007;
     #agifa007#26 = aSerie;
     |LEE 000#agifa007.=;
     |SI FSalida ! 0;
          aMensaje = "0000Por favor introduzca los datos de la nueva serie";
          |MENAV aMensaje;

          |VENTANA 0501, 3299, -1, 1, "";
          nVentana = FSalida;

          |PINPA #0#agifa007; nPanta = FSalida;
          |DDEFECTO #agifa007;
          #agifa007#26 = aSerie;
          |LEE 101#agifa007.=;
          |PINDA #0#agifa007;
          |ENDATOS #2#agifa007;
          |SI FSalida = 0;
               |GRABA 020#agifa007.n;
          |SINO;
               nError = 1;
          |FINSI;
          |LIBERA #agifa007;
          |FINVENTANA nVentana;
     |FINSI;
     |CIERRA #agifa007;
|FPRC;


|PROGRAMA;
     |ABRE #100;
     |DDEFECTO #100;
     |LEE 000#100p;
     |SI FSalida = 0;
          aSerie = #100#17;
          |QBT aSerie;
          |SI aSerie ! "";
               |HAZ AltaSerie;
          |FINSI;
          aSerie = #100#18;
          |QBT aSerie;
          |SI aSerie ! "";
               |HAZ AltaSerie;
          |FINSI;
     |FINSI;

     |CIERRA #100;

     fSistema = ~;
     |DBASE aBase;
     |QBF aBase;

     |ABRE  #916;
     |DDEFECTO #916;
     #916#0 = "contrato";
     |LEE 101#916.=;
     |SI FSalida ! 0;
          #916#0 = "contrato";
          #916#1 = "Contratos Arrendamiento Viviendas";
          aNomOri = "dspatroncontrato";
          aNomDes = #916#0;
          |QBF aNomDes;
          |HAZ CopiaXML;

          |GRABA 020#916n;
     |FINSI;
     |LIBERA #916;
     |CIERRA #916;

     |ABRET #905;
     |ABRET #906;
     |ABRET #907;
     |ABRET #914;
     |ABRET #920;
     |ABRET #922;

     |PINPA #0#0;  enPanta0 = FSalida;
     |HAZ BotonesPanta0;

     |PINPA #1#0;    enPanta1 = FSalida;

     |HAZ BotonesPanta1;
     |HAZ Grid1;

     |LEE 000#905p;
     FSalida = 1;
     |HAZ EventoPanta1;

     |PINPA #2#0;  enPanta2 = FSalida;
     |HAZ BotonesPanta2;
     |HAZ Grid2;

     |PINPA #3#0;  enPanta3 = FSalida;
     |HAZ BotonesPanta3;
     |HAZ Grid3;

     |PINPA #4#0;  enPanta4 = FSalida;
     |HAZ BotonesPanta4;
     |HAZ Grid4;

     |PINPA #5#0;  enPanta5 = FSalida;
     |HAZ BotonesPanta5;
     |HAZ Grid5;

     |PINPA #6#0;  enPanta6 = FSalida;
     |HAZ BotonesPanta6;
     |HAZ Grid6;

     aEsc1  = &255 + "806";
     aEsc2  = &255 + "807";
     aRetu  = &255 + "802";
     a804   = &255 + "804";
     |PARA; |SI;  |HACIENDO;
         |SI aTecla = a804;
             |SI nPestanya = 1;  FSalida = "::{{001}}Salir," + enGrid1;  |FINSI;
             |SI nPestanya = 2;  FSalida = "::{{001}}Salir," + enGrid2;  |FINSI;
             |SI nPestanya = 3;  FSalida = "::{{001}}Salir," + enGrid3;  |FINSI;
             |SI nPestanya = 4;  FSalida = "::{{001}}Salir," + enGrid4;  |FINSI;
             |SI nPestanya = 5;  FSalida = "::{{001}}Salir," + enGrid5;  |FINSI;
             |SI nPestanya = 6;  FSalida = "::{{001}}Salir," + enGrid6;  |FINSI;
         |SINO;
             FSalida = "::{{001}}Salir," + enGrid1;
         |FINSI;

         |LEETECLA aTecla;
         |SI aTecla = aEsc1; |SAL;  |FINSI;
         |SI aTecla = aEsc2; |SAL;  |FINSI;
         |SI aTecla = aRetu; |SAL;  |FINSI;
     |SIGUE;

     |PULSATECLA;

     |HAZ DestruyeControles;
     |CIERRAT #905;
     |CIERRAT #906;
     |CIERRAT #907;
     |CIERRAT #914;
     |CIERRAT #920;
     |CIERRAT #922;
|FPRO;
