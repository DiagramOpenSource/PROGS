|FICHEROS;
    obras028  #0;  || Seleccion.
    obras001  #3;  || Obras.
    agifa079  #4;  || Facturas.(C).
    obras016  #5;  || Albaranes Asignados a Obras.
    agifa072  #6;  || Facturas.(L).
    agifa080  #7;  || Albaranes (L).
    agifa007  #8;  || Series........
    obrasf27  #10; || Fantasma Facturas Serie..........
    obras005  #9;  || Presupuestos......................
|FIN;

|VARIABLES;
    aAlfa = "";
    ficher = "";
    nFact  = 0;
    aSeri  = "";
    nPart  = 0;
    &tl    = 0;
    &total = 0;
    nSal   = 0;
    fFech  = @;
|FIN;

|PROCESO obrasf27;
    nFact = #10#2;
    aSeri = #10#1;
    |QBF aSeri;
    tl = 3;
    |SI nFact = 0;
          tl = 2;
    |FINSI;
    |SI aSeri = "";
          tl = 1;
          total = total + #10#7;
    |FINSI;
    |PRINT;
|FPRC;

|DEFBUCLE obrasf27;
     #10#2;
     ;
     #0#1, "     ", "01.01.0000" , 000000;
     #0#2, "zzzzz", "31.12.9999" , 999999;
     ;
     NULL,obrasf27;
|FIN;

|PROCESO carga;
     #10#0 = nPart;
     #10#1 = aSeri;
     #10#2 = nFact;
     |LEE 041#10=;
     nSal = FSalida;
     |SI FSalida ! 0;
         |DDEFECTO #10;
         #10#7 = 0;
     |FINSI;
     #10#0 = nPart;
     #10#1 = aSeri;
     #10#2 = nFact;
     #10#3 = fFech;
     #10#4 = #4#2;  ||Prov
     #10#5 = #4#3;  ||Nombre
     #10#6 = #4#74; ||Su Factu
     #10#7 = #10#7 + #5#8; || Impo
     #10#8 = #9#3;  ||Des partida
     #10#9 = #8#27; ||Des Serie
     |SI nSal = 0; |GRABA 041#10a; |FINSI;
     |SI nSal ! 0; |GRABA 041#10n; |FINSI;
|FPRC;

|PROCESO agifa080;
     #5#0 = #7#27;
     #5#1 = #7#0;
     #5#2 = #7#1;
     |LEE 000#5=;
     |SI FSalida = 0;
         nPart = #5#5;   ||Partida;
         aSeri = #4#66;  ||Serie;
         nFact = #4#0;   ||N§ Factura.
         fFech = #4#1;   ||Fecha Factura.
         |DDEFECTO #8;
         #8#26 = #4#66;
         |LEE 000#8=;
         |DDEFECTO #9;
         #9#0 = #5#3;
         #9#1 = #5#4;
         #9#2 = #5#5;
         |LEE 000#9=;

         aAlfa = #9#5; |QBF aAlfa;
         |SI aAlfa ! "";             ||Es una copia
               |SI #0#5 = "O";
                    aAlfa = aAlfa % 103;
                    |DDEFECTO #9;
                    #9#0 = aAlfa;
                    #9#1 = #5#4;
                    #9#2 = #5#5;
                    |LEE 000#9=;
               |FINSI;
         |SINO;
               |SI #9#0 ! #0#0; |ACABA; |FINSI;
               |SI #9#4 ! #0#5; |ACABA; |FINSI;
         |FINSI;

         |HAZ carga;
         nFact = 0;
         fFech = "01.01.0000";
         |HAZ carga;
         aSeri = "";
         |HAZ carga;
     |FINSI;
|FPRC;

|DEFBUCLE agifa080;
     #7#1;
     ;
     #6#17,#6#2,0;
     #6#17,#6#2,999;
     ;
     NULL,agifa080;
|FIN;

|PROCESO agifa072;
     |BUCLE agifa080;
|FPRC;


|DEFBUCLE leefac;
     #4#1;
     1;
     "     ",000000,#0#3;
     "zzzzz",999999,#0#4;
     ;
     NULL,NULL,agifa072;
|FIN;

|PROCESO lista;  |TIPO 3;
     |IMPRE 0;
     |SI FSalida ! 0; |ACABA; |FINSI;
     |INFOR "obras028";
     |SI FSalida ! 0; |FINIMP; |ACABA; |FINSI;
          ficher = Usuario;
          |QBF ficher;
          |NOME_DAT #10 ficher;
          |DELINDEX #10;
          |ABRE #10;
          |ABRE #5;
          |ABRE #8;
          |ABRE #9;
          |BUCLE leefac;
          |BUCLE obrasf27;
          |CIERRA #10;
          |DELINDEX #10;
          |PIEINF;
          |CIERRA #5;
          |CIERRA #8;
          |CIERRA #9;
     |FININF;
     |FINIMP;
|FPRC;
