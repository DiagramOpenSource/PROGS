|FICHEROS;
     agifa022 #0;
     agifa010 #1;
     agifa071 #2;
     agifa134 #3;
     agifa059 #4;
     dsz99984 #8;
     agifa091 #10;
     agifa133 #17;
     agifa024 #6;
     agifa007 #9;  ||Serie....
     agifa019 #19;
     agis0002 #98;
     agifa177 #99;
     agifa142 #142;
     agifa324 #324;
|FIN;

|VARIABLES;
     nVto = 0;
     &enDirEnt = 0;
     &aDivisa  = "";
     &aMoneda  = "";
     &eaProg   = "";
     &eaCli    = "";
     &enTiva   = 0;
     &enIva    = 0;
     &enRec    = 0;
     &enErrCarte     = 0;
     &enErr          = 0;
     &nDeci_Base     = 0;   || Decimales en Totales de la moneda base
     &nDeci_PreBase  = 0;   || Decimales en el Precio en moneda base
     &nDeci_BaseMx   = 0;   || Decimales en Totales de la moneda base (Maxima precision)
     &nDeci_PreBaseMx= 0;   || Decimales en el Precio en moneda base (Maxima precision)
     &nDeci_Div      = 0;   || Decimales en Totales de la divisa
     &nDeci_PreDiv   = 0;   || Decimales en el Precio en divisa
     &nDeci_TotVis   = 0;   || Decimales en Totales visibles (el de la moneda de trabajo)
     &nDeci_TotNoVis = 0;   || Decimales en Totales no visibles (el de la otra moneda)
     &nDeci_PreVis   = 0;   || Decimales en el Precio visual. (lineas)
     &nDeci_ImpVis   = 0;   || Decimales en el Importe visual. (lineas)
     &nDeci_DivF     = 0;   || Decimales en Totales de la divisa
     &nDeci_TotVisF  = 0;   || Decimales en Totales visibles (el de la moneda de trabajo)
     &nDeci_TotNoVisF = 0;  || Decimales en Totales no visibles (el de la otra moneda)
     &nDeci_PreVisF  = 0;   || Decimales en el Precio visual. (lineas)
     &nDeci_ImpVisF  = 0;   || Decimales en el Importe visual. (lineas)
     nfecha    = 0;
     &ac_divisa = "N";   || Vale "S" cuando las divisas en ventas estan
                         || activadas y la serie es de divisas
     &pintado = 0;       || Sirve para controlar los pintados de las lineas
     &decim_divisa = 0;  || Decimales de la divisa
     &precio_divisa = 0; || Decimales del precio en divisa
     &decim_base = 0;    || Decimales de la moneda base
     &precio_base = 0;   || Decimales del precio en moneda base
     div_act = 0;        || Divisa actualizada. Me sirve en un PARA para que
                         || no salga hasta que este actualizada (div_act=1)
     &cli_divisa = "";   || Codigo de Cliente. Se pasa a CLIENTES/DIVISAS
     &divisa = "";       || Codigo de Divisa. Se pasa a ACTUAL. de DIVISAS

     CuentaFac = 0;

     iva1 = 0;
     iva2 = 0;
     iva3 = 0;
     iva4 = 0;
     iva5 = 0;
     re1 = 0;
     re2 = 0;
     re3 = 0;
     re4 = 0;
     re5 = 0;
     base0 = 0;
     base1 = 0;
     base2 = 0;
     base3 = 0;
     base4 = 0;
     base5 = 0;
     bruto = 0;
     b0=0;
     p0=0;
     b1=0;
     p1=0;
     b2=0;
     p2=0;
     b3=0;
     p3=0;
     b4 = 0;
     p4 = 0;
     b5 = 0;
     p5 = 0;
     br=0;
     tp = 0;
     tv = 0;
     i = 0;
     sini = "";
     importe = 0;
     tipo_imp;
     redondeo = 0;
     resto = 0;
     num = 0;
     a = 0;
     j = 0;
     abono = 0;
     fechas = "";
     pintar = "";
     totalb = 0;
     &SFactura = "";
     &NFactura = 0;
     &CFactura = "";
     &DesdeRec = 0;
     &TAcuenta = 0;
     &nEditar = 99;
     aAlfa1 = "";
     nMult  = 0;
     nEuro = 0;
     aEuro = 0;
     nImpDiv = 0;
|FIN;

|PROCESO Tipo8; |TIPO 8;
     |HAZ ControlUsuFV;
     |SI enErr ! 0; |PTEC 807; |ACABA; |FINSI;
|FPRC;

|PROCESO graba_reci;
     |DDEFECTO #8;
     #8#17 = #3#49; ||Serie
     #8#0 = #3#0;
     #8#1 = #17#1;
     #8#2 = #3#2;
     #8#3 = #3#3;
     #8#4 = #3#9;
     #8#5 = "S";
     #8#6 = "N";
     #8#7 = #3#1;
     #8#8 = #17#3;
     #8#23 = nVto;
     #8#9 = #17#2;
     |SI #17#5 = "S";
          #8#10 = #98#10;
          #8#11 = #98#11;
     |SINO;
          #8#10 = "N";
          #8#11 = "N";
     |FINSI;
     |SI #142#63 = "S";
          #99#0 = #10#69;
          |LEE 000#99=;
          |SI FSalida = 0;
               #8#12 = #99#3;     || NUMERO CTA.CONTABLE.
          |SINO;
               #8#12 = #3#12;     || NUMERO CTA.CONTABLE.
          |FINSI;
     |SINO;
          #8#12 = #3#12;
     |FINSI;
     #8#13 = #98#13;
     #8#16 = #98#16;
     #8#22 = "Cobrado";
     #8#24 = #3#11;
     #8#25 = #10#1;
     #8#14 = "N";
     #8#15 = #6#161;
     |SI #17#5 = "S";
          #8#11 = #98#22;
     |SINO;
          #8#11 = #10#69;
     |FINSI;
     #8#24 = #10#0;
     #8#25 = #10#1;
     eaProg = "agifa134";
     ||HAZ CreaRecVenta;
     |HAZ RecVenta;
|FPRC;

|PROCESO Vencimiento;
     |HAZ VenciVta;

     |ABRE #10;
     |DDEFECTO #10;
     #10#0 = #3#11;
     |LEE 000#10=;
     |CIERRA #10;

     |ABRE #99;
     |ABRE #98;
     |SI #3#45 = "S"; |Y enErrCarte = 0;
          nVto = 0;
          |HAZ AbreRecVenta;
          |ABRE #17;
          #17#4 = #3#49; ||serie
          #17#0 = #3#0;  ||numero factura;
          #17#1 = 1;     ||numero linea;
          |LEE 000#17];
          |PARA; |SI FSalida = 0; |Y #17#4 = #3#49; |Y #17#0 = #3#0; |HACIENDO;
               nVto = nVto + 1;
               |SI #17#5 = "S";
                    |DDEFECTO #98;
                    #98#30 = "A";       || busca como albaran
                    #98#20 = #17#6;     || Serie pedido.
                    #98#17 = #17#7;     || Numero pedido.
                    #98#18 = #17#8;     || Numero recibo.
                    |LEE 000#98=;
                    |SI FSalida ! 0;
                         #98#30 = "P";       || busca como pedido
                         |LEE 000#98=;
                    |FINSI;
               |FINSI;
               |HAZ graba_reci;
               |LEE 000#17s;
          |SIGUE;
          |CIERRA #17;
          |HAZ CierraRecVenta;
     |FINSI;
     |CIERRA #98;
     |CIERRA #99;
|FPRC;

|PROCESO LineasAlbaranes;
     |HAZ TotalLin71;
     #2#30 = #3#49;
     #2#26 = #3#0;
     |GRABA 021#2a;
     |LIBERA #2;

     |HAZ CalCabAgifa010;
|FPRC;

|PROCESO MiraAlbaran;
     #1#52 = #4#15;
     #1#0  = #4#2;
     |LEE 101#1=;
     |SI FSalida = 0;
          |SI enDirEnt = 0; enDirEnt = #agifa010#84; |FINSI;

          aDivisa = #1#68;
          aMoneda = #1#70;
          |HAZ Divisas010;
          |HAZ LimCabAgifa010;
          |BUCLELIN 2 LineasAlbaranes #1;
          |GRABA 020#1a;
          |LIBERA #1;
     |FINSI;

     |HAZ CalLinAgifa134;
     |GRABA 020#4a;
     |LIBERA #4;
|FPRC;

|DEFBUCLE agifa059;
     #4#1;
     ;
     #3#49, #3#0, 001;
     #3#49, #3#0, 999;
     be;
     NULL, MiraAlbaran;
|FIN;

|PROCESO LeeFacturas;
     enErrCarte = 0;
     |HAZ MiraRecVenta;
     |SI enErrCarte ! 0;
          |ACABA;
     |SINO;
          CuentaFac = CuentaFac + 1;
     |FINSI;

     pintar = "         ";
     |PINTA 1955,pintar;
     pintar = #3#49 + "/" + #3#0;
     |PINTA 1955,pintar;

     aDivisa = #3#58;
     aMoneda = #3#60;
     |HAZ Divisas134;

     |BUCLE agifa059;

     |HAZ CalCabAgifa134;

     |SI #0#3 = "S";
          |HAZ Vencimiento;
     |FINSI;

     |GRABA 020#3a;
     |LIBERA #3;
|FPRC;

|DEFBUCLE LeeFacturas;
     #3#1;
     ;
     #0#2, #0#0;
     #0#8, #0#1;
     be;
     NULL, LeeFacturas;
|FIN;

|PROCESO recalcul;|TIPO 3;
     |ABRE #142; |LEE 000#142p; |CIERRA #142;
     |ABRET #4;
     |ABRET #1;
     |ABRET #2;
     |ABRET #10;

     CuentaFac = 0;
     |BUCLE LeeFacturas;
     |SI CuentaFac = 0;
        |MENAV "    Seleccion vacia";
     |FINSI;

     |CIERRAT #4;
     |CIERRAT #1;
     |CIERRAT #2;
     |CIERRAT #10;
|FPRC;
