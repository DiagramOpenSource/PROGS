|FICHEROS;
     sctrz054 #0;
     sctrm003 #3;
     sctrm005 #5;
     sctrm012 #12;
     agifa019 #19;
     sctrm021 #21;
     sctrm022 #22;
     sctrm028 #28;
     sctrm035 #35;
     sctrm036 #36;
     sctrm043 #43;
     sctrm052 #52;
     sctrm053 #53;
     sctrm054 #54;            ||Cab Factu
     sctrm055 #55;            ||Lin Factu
     sctrm056 #56;            ||Vto
     sctrm058 #58;            ||Lin Factu Viajes
     sctrm066 #66;
     sctrm001 #100;
     sctrz055 #155,MANTE;     ||Pan Cab
     sctrz073 #173,MANTE;     ||Pan Lin
     sctrz074 #174,MANTE;     ||Pan Lin Viajes
     referen@;
|FIN;

|VARIABLES;
     &enError = 0;
     &eaNomLogo = "";
     &enPantaLogo = 0;
     &enCtrFin = 0;
     &eaSerie = "";
     &enNumero = 0;
     &eaProg = "";
     &enTiva = 0;
     &efFiva = @;
     &enIva = 0;
     &Tempo = "";
     aAlfa = "";
     nModoCab = 0;
     nModoLin = 0;
     nPanta = 0;
     nPantaCab = 0;
     nRango = 0;
     nGridCab = 0;
     nGridLin = 0;
     nBtnAlta = 0;
     nBtnModi = 0;
     nBtnBaja = 0;
     nBtnCons = 0;
     nBtnImpr = 0;
     nBtnRecibos = 0;
     nBtnAltaLin = 0;
     nBtnModiLin = 0;
     nBtnBajaLin = 0;
     nBtnConsLin = 0;
     i = 0;
     aReg0 = "";
     nReg1 = 0;
     nBloquea = 0;
     nId = 0;
     nLin = 0;
     aConte = "";
     nForma = 0;
     aNom = "";
     nBillete = 0;
     nTasa = 0;
     nTotal = 0;
     aBase = "";
     nSwBorraRec = 0;
     nError = 0;
     nTieneLineasLin = 0;
     nRegLin0 = 0;
     nRegLin1 = 0;
     nRegLin2 = 0;
     aTipo = "";
     nBase = 0;
     nCuota = 0;
     nExenta = 0;
     aPais = "";
     aApis = "";
|FIN;

|PROCESO Saca_IVA;
     aAlfa = aPais; |QBF aPais;
     |SI aAlfa = "";
          |HAZ SacaIVA;
     |SINO;
          enIva = 0;
          |ABRE #66;
          #66#5 = aPais; aPais = #66#5;
          #66#0 = enTiva
          #66#4 = "01.01.0000";
          |LEE 000#66];
          |PARA; |SI FSalida = 0; |Y #66#5 = aPais; |Y #66#0 = enTiva; |HACIENDO;
               |SI efFiva ] #66#4;
                    enIva = #66#2;
               |FINSI;
               |LEE 000#66s;
          |SIGUE;
          |CIERRA #66;
     |FINSI;
|FPRC;

|PROCESO ActLin;
     |ABRE #36;
     #36#1 = #155#14;
     |LEE 000#36=;
     |SI FSalida ! 0; |DDEFECTO #36; |FINSI;
     |CIERRA #36;

     |SI aTipo = "V";
          nExenta = #58#12 * #58#14;

          enTiva = #100#24;
          efFiva = #155#2;
          aPais = #155#25;
          |HAZ Saca_IVA;

          nBase = #58#11 * #58#14;
          nCuota = nBase * enIva / 100;

          #155#23 = #155#23 + (nExenta * nForma);
          |SI enTiva = 0;
               #155#23 = #155#23 + (nBase * nForma);
          |FINSI;
          |PINTA #155#23;
          |SI enTiva = 1;
               #155#7 = #155#7 + (nBase * nForma);
               #155#8 = #155#8 + (nCuota * nForma);
               #155#16 = enIva;
               |PINTA #155#7;
               |PINTA #155#8;
               |PINTA #155#16;
          |FINSI;
          |SI enTiva = 2;
               #155#17 = #155#17 + (nBase * nForma);
               #155#18 = #155#18 + (nCuota * nForma);
               #155#19 = enIva;
               |PINTA #155#17;
               |PINTA #155#18;
               |PINTA #155#19;
          |FINSI;
          |SI enTiva = 3;
               #155#20 = #155#20 + (nBase * nForma);
               #155#21 = #155#21 + (nCuota * nForma);
               #155#22 = enIva;
               |PINTA #155#20;
               |PINTA #155#21;
               |PINTA #155#22;
          |FINSI;
          #155#9 = #155#7+#155#8+#155#17+#155#18+#155#20+#155#21+#155#23;
          |PINTA #155#9;
     |SINO;
          |ABRE #52;
          |ABRE #53;
          #52#0 = #55#3;
          |LEE 121#52=;
          |SI FSalida = 0;
               #53#0 = #52#0;
               #53#1 = 0;
               |LEE 000#53];
               |SI FSalida ! 0; |O #53#0 ! #52#0; |DDEFECTO #53; |FINSI;

               #55#4 = #52#75;
               #55#6 = #52#45;
               #55#7 = #53#3;
               #55#8 = #52#20;
               #55#10 = #52#19;
               ||#55#11 =
               |SI #55#20 = 1;
                    #55#9 = #52#1;
                    #55#12 = #52#108;
                    #55#13 = #52#32 - #52#108;
               |SINO;
                    #55#9 = #52#64;
                    |SI #52#112 ! "C";
                         #55#12 = 0;
                    |SINO;
                         #55#12 = #52#108;
                    |FINSI;
                    #55#13 = -(#52#72 - #55#12);
                    #55#12 = -#55#12;
               |FINSI;
               #55#14 = #55#13 *  #52#55 / 100;
               |SI #52#38 = "R"; |Y #36#72 = "N";
                    #55#12 = 0;
                    #55#13 = 0;
               |FINSI;
               #55#17 = #52#8;
               #55#18 = #52#12;

               enTiva = #100#26;
               efFiva = #54#2;
               aPais = #54#25;
               |HAZ Saca_IVA;
               |SI #36#45 = "N";
                    enTiva = 0;
                    #55#19 = 0;
               |SINO;
                    #55#19 = enIva;
               |FINSI;

               #55#16 = #55#14 * #55#19 / 100;
               #55#15 = #55#13 - #55#14 - #55#16 + #55#12;

               #155#9 = #155#9 + (#55#15 * nForma);
               #155#10 = #155#10 + (#55#14 * nForma);
               #155#11 = #155#11 + (#55#13 * nForma);
               #155#12 = #155#12 + (#55#12 * nForma);
               #155#24 = #155#24 + (#55#16 * nForma);
               |PINTA #155#9;
               |PINTA #155#10;
               |PINTA #155#11;
               |PINTA #155#12;
               |PINTA #155#24;
               |SI nForma = 1;
                    |SI aApis = "S";   || Apis
                         |SI #55#20 = 1;     || Rese
                              #52#143 = "S";
                              #52#144 = #155#0;
                              #52#145 = #155#1;
                         |SINO;              || Anula
                              #52#146 = "S";
                              #52#147 = #155#0;
                              #52#148 = #155#1;
                         |FINSI;
                    |SINO;
                         |SI #55#20 = 1;
                              #52#83 = "S";
                              #52#84 = #155#0;
                              #52#85 = #155#1;
                         |SINO;
                              #52#89 = "S";
                              #52#90 = #155#0;
                              #52#91 = #155#1;
                         |FINSI;
                    |FINSI;
               |SINO;
                    |SI #55#21 = " ";        || Ida/Vuelta
                         |SI aApis = "S";   || Apis
                              |SI #55#20 = 1;|| Rese
                                   #52#143 = "N";
                                   #52#144 = "";
                                   #52#145 = 0;
                              |SINO;         || Anula
                                   #52#146 = "N";
                                   #52#147 = "";
                                   #52#148 = 0;
                              |FINSI;
                         |SINO;
                              |SI #55#20 = 1;
                                   #52#83 = "N";
                                   #52#84 = "";
                                   #52#85 = 0;
                              |SINO;
                                   #52#89 = "N";
                                   #52#90 = "";
                                   #52#91 = 0;
                              |FINSI;
                         |FINSI;
                    |SINO;
                         |SI #55#21 = "I";
                              |SI aApis = "S";   || Apis
                                   |SI #55#20 = 1;
                                        #52#143 = "N";
                                        #52#144 = "";
                                        #52#145 = 0;
                                   |SINO;
                                        #52#146 = "N";
                                        #52#147 = "";
                                        #52#148 = 0;
                                   |FINSI;
                              |SINO;
                                   |SI #55#20 = 1;
                                        #52#83 = "N";
                                        #52#84 = "";
                                        #52#85 = 0;
                                   |SINO;
                                        #52#89 = "N";
                                        #52#90 = "";
                                        #52#91 = 0;
                                   |FINSI;
                              |FINSI;
                         |SINO;
                              |SI #55#20 = 1;
                                   #52#154 = "N";
                                   #52#155 = "";
                                   #52#156 = 0;
                              |SINO;
                                   #52#157 = "N";
                                   #52#158 = "";
                                   #52#159 = 0;
                              |FINSI;
                         |FINSI;
                    |FINSI;
               |FINSI;
               |GRABA 020#52a;
          |FINSI;
          |CIERRA #53;
          |CIERRA #52;
     |FINSI;
|FPRC;

|PROCESO Conte174; |TIPO 7;
     aConte = #174Campo;
|FPRC;

|PROCESO PinArti;
     |ABRE #19;
     #19#0 = #174#13;
     |LEE 000#19=;
     |SI FSalida ! 0; |DDEFECTO #19; |FINSI;
     |CIERRA #19;
     |PINTA 1133, #19#1;
|FPRC;

|PROCESO Articulo; |TIPO 0;
     |SI aConte ! #174Campo;
          |ABRE #19;
          #19#0 = #174#13;
          |LEE 000#19=;
          |SI FSalida = 0;
               #174#14 = #19#18; |PINTA #174#14;
               |PINTA 1133, #19#1;
          |SINO;
               |MENAV "0000No existe c▃igo de art︷ulo...";
               |ERROR;
          |FINSI;
          |CIERRA #19;
     |FINSI;
|FPRC;

|PROCESO Matri0; |TIPO 0;
     |ABRE #28;
     |SELECT #2#28;
     #28#1 = #174#9;
     |LEE 000#28=;
     |SI FSalida = 0;
          #174#8 = #28#0; |PINTA #174#8;
     |SINO;
          aAlfa = #174#9; |QBF aAlfa;
          |SI #174Campo ! aConte; |O aAlfa = "";
               |CONFI "0000NNo existe matricula. 求esea continuar?";
               |SI FSalida ! 0; |ERROR; |FINSI;
          |FINSI;
     |FINSI;
     |CIERRA #28;
|FPRC;

|PROCESO Matri66; |TIPO 66;
     |ABRE #28;
     |SELECT #2#28;
     #28#1 = #174#9;
     |LEE 000#28];
     |CONSULTA_CLAVE #2#28;
     |SI FSalida = 0;
          #174#9 = #28#1; |PINTA #174#9;
     |SINO;
          |ERROR;
     |FINSI;
     |CIERRA #28;
|FPRC;

|PROCESO Vehiculo; |TIPO 0;
     |SI #174#8 = 0;
          |C_M #174#9, 1, "S"; |PINTA #174#9;
     |SINO;
          |C_M #174#9, 1, "N"; |PINTA #174#0;
          |ABRE #28;
          #28#0 = #174#8;
          |LEE 000#28=;
          |SI FSalida = 0;
               #174#9 = #28#1; |PINTA #174#9;
          |SINO;
               |MENAV "0000No existe c▃igo de veh︷ulo...";
               |ERROR;
          |FINSI;
          |CIERRA #28;
     |FINSI;
|FPRC;

|PROCESO KmsInter; |TIPO 0;
     #174#12 = #174#10 - #174#11; |PINTA #174#12;
|FPRC;

|PROCESO Kms;
     |ABRE #21;
     |SELECT #2#21;
     #21#2 = #174#4;
     #21#4 = #174#6;
     |LEE 000#21=;
     |SI FSalida ! 0;
          #21#2 = #174#6;
          #21#4 = #174#4;
          |LEE 000#21=;
     |FINSI;
     |SI FSalida ! 0; |DDEFECTO #21; |FINSI;
     |CIERRA #21;

     #174#10 = #21#6; |PINTA #174#10;

     |ABRE #22;
     |SELECT #3#22;
     #22#1 = #174#4;
     #22#2 = #174#6;
     #22#4 = #100#23;
     |LEE 000#22=;
     |SI FSalida ! 0;
          #22#1 = #174#6;
          #22#2 = #174#4;
          #22#4 = #100#23;
          |LEE 000#22=;
     |FINSI;
     |SI FSalida ! 0; |DDEFECTO #22; |FINSI;
     |CIERRA #22;

     #174#11 = #22#6; |PINTA #174#11;

     |HAZ KmsInter;
|FPRC;

|PROCESO PobDes; |TIPO 0;
     |ABRE #3;
     #3#0 = #174#6;
     |LEE 000#3=;
     |SI FSalida = 0;
          #174#7 = #3#1; |PINTA #174#7;
          |HAZ Kms;
     |SINO;
          |MENAV "0000No existe c▃igo de poblaci▋...";
          |ERROR;
     |FINSI;
     |CIERRA #3;
|FPRC;

|PROCESO PobOrg; |TIPO 0;
     |ABRE #3;
     #3#0 = #174#4;
     |LEE 000#3=;
     |SI FSalida = 0;
          #174#5 = #3#1; |PINTA #174#5;
          |HAZ Kms;
     |SINO;
          |MENAV "0000No existe c▃igo de poblaci▋...";
          |ERROR;
     |FINSI;
     |CIERRA #3;
|FPRC;

|PROCESO UltLin58;
     #58#0 = #155#0;
     #58#1 = #155#1;
     #58#2 = 9999;
     |LEE 000#58];
     |SI FSalida = 0;
          |LEE 000#58a;
     |SINO;
          |LEE 000#58u;
     |FINSI;
     |SI FSalida = 0; |Y #58#0 = #155#0; |Y #58#1 = #155#1;
          nLin = #58#2 + 1;
     |SINO;
          nLin = 1;
     |FINSI;
     |DDEFECTO #58;
     #58#0 = #155#0;
     #58#1 = #155#1;
     #58#2 = nLin;
     |GRABA 020#58b;
|FPRC;

|PROCESO EditaLin58;
     nRegLin0 = #58#0;
     nRegLin1 = #58#1;
     nRegLin2 = #58#2;

     |SI nModoLin = 1; |VENTANA 1901, 2898, -1, 17, "Nueva L》ea Factura"; |FINSI;
     |SI nModoLin = 2; |VENTANA 1901, 2898, -1, 17, "Modifica L》ea Factura"; |FINSI;
     |SI nModoLin = 4; |VENTANA 1901, 2898, -1, 17, "Consulta L》ea Factura"; |FINSI;
     |HAZ PushVenModal;

     |SI nModoLin = 1;
          |HAZ UltLin58;
     |FINSI;
     |SI nModoLin = 2;
          aApis = #155#26;
          aTipo = #155#13; nForma = -1; |HAZ ActLin;
     |FINSI;
     |PARA i = 0; |SI i [ 14; |HACIENDO i = i + 1;
          #174i = #58i;
     |SIGUE;
     |PINPA #0#174;
     |PINDA #0#174;
     |HAZ PinArti;
     |SI nModoLin = 1; |ENDATOS #1#174; |FINSI;
     |SI nModoLin = 2; |ENDATOS #2#174; |FINSI;
     |SI nModoLin = 4; |PAUSA; |FINSI;
     |SI FSalida = 0; |Y nModoLin ! 4;
          #58#0 = #174#0;
          #58#1 = #174#1;
          #58#2 = #174#2;
          |LEE 121#58=;
          |PARA i = 0; |SI i [ 14; |HACIENDO i = i + 1;
               #58i = #174i;
          |SIGUE;
          aApis = #155#26;
          aTipo = #155#13; nForma = 1; |HAZ ActLin;
          |GRABA 020#58a;

          nRegLin0 = #58#0;
          nRegLin1 = #58#1;
          nRegLin2 = #58#2;
     |SINO;
          |SI nModoLin = 1;
               #58#0 = #174#0;
               #58#1 = #174#1;
               #58#2 = #174#2;
               |BORRA 020#58c;
          |FINSI;
     |FINSI;
     |LIBERA #58;

     |HAZ PopVenModal;

     #58#0 = nRegLin0;
     #58#1 = nRegLin1;
     #58#1 = nRegLin2;
     |LEE 000#58=;
     |REFRESCACONTROL nGridLin;
|FPRC;

|PROCESO Reserva0; |TIPO 0;
     nError = 0;
     |ABRE #52;
     #52#0 = #173#3;
     |LEE 000#52=;
     |SI FSalida = 0;
          |SI #155#14 ! #52#43; |Y #155#26 = "N";
               aAlfa = "0000El cliente de la reserva es:" + #52#43;
               |MENAV aAlfa; nError = 1;
          |FINSI;
          |SI nError = 0; |Y #155#14 ! #52#151; |Y #155#26 = "S";
               aAlfa = "0000El Api de la reserva es:" + #52#151;
               |MENAV aAlfa; nError = 1;
          |FINSI;

          |SI nError = 0; |Y #52#75 ! #155#15;    || Linea servicio
               |SI #155#15 ! 0; |Y #155#15 ! 999;
                    aAlfa = "0000La l》ea de servicio de la reserva es:"  + #52#75 + " ...";
                    |MENAV aAlfa; nError = 1;
               |FINSI;
          |FINSI;

          |SI #173#20 = 1;    || Reserva
               |SI #155#26 = "S"; ||Apis;
                    |SI nError = 0; |Y #52#143 = "S";
                         aAlfa = "0000Reserva facturada en factura:" + #52#144 + "/" + #52#145;
                         |MENAV aAlfa;
                         |ERROR;
                    |FINSI;
               |SINO;
                    |SI nError = 0; |Y #52#83 = "S";
                         aAlfa = "0000Reserva facturada en factura:" + #52#84 + "/" + #52#85;
                         |MENAV aAlfa;
                         |ERROR;
                    |FINSI;
               |FINSI;
          |SINO;              || Anulacion
               |SI #155#26 = "S"; ||Apis;
                    |SI nError = 0; |Y #52#146 = "S";
                         aAlfa = "0000Reserva facturada en factura:" + #52#147 + "/" + #52#148;
                         |MENAV aAlfa;
                         |ERROR;
                    |FINSI;
               |SINO;
                    |SI nError = 0; |Y #52#89 = "S";
                         aAlfa = "0000Reserva facturada en factura:" + #52#90 + "/" + #52#91;
                         |MENAV aAlfa;
                         |ERROR;
                    |FINSI;
               |FINSI;
          |FINSI;
     |SINO;
          |MENAV "0000No existe c▃igo de reserva...";
          nError = 1;
     |FINSI;
     |CIERRA #52;
     |SI nError ! 0; |ERROR; |FINSI;
|FPRC;

|PROCESO Reservas;
     |SI #155#15 ! 0; |Y #155#15 ! 999;
          |SI #52#75 ! #155#15;    || Linea servicio
               |ACABA;
          |FINSI;
     |FINSI;
     |SI #155#26 = "S";  || Apis
          |SI #52#6 ! 4; |Y #52#6 ! 5;
               |ACABA;
          |FINSI;
     |SINO;
          |SI #52#6 ! 1; |Y #52#6 ! 2;
               |ACABA;
          |FINSI;
     |FINSI;

     |SI #173#20 = 1;    ||Rese
          |SI #155#26 = "S";  || Apis
               |SI #52#143 = "S"; |ACABA; |FINSI;
          |SINO;
               |SI #52#83 = "S"; |ACABA; |FINSI;
          |FINSI;
     |SINO;              ||Anula
          |SI #155#26 = "S";  || Apis
               |SI #52#146 = "S"; |ACABA; |FINSI;
          |SINO;
               |SI #52#89 = "S"; |ACABA; |FINSI;
          |FINSI;
     |FINSI;
     |SALVA_DATOS #52;
     |REPON_DATOS #referen@;
     |GRABA 020#referen@.n;
|FPRC;

|DEFBUCLE Reservas;
     #52#4;
     ;
     #155#14, " ", "01.01.0000", 0000000;
     #155#14, "z", "31.12.9999", 9999999;
     ;
     NULL, Reservas;
|FIN;

|PROCESO Reserva66; |TIPO 66;
     |DDEF aAlfa;
     aAlfa = aAlfa + "sctrm052";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |HAZ CreaTempo; |NOME_DAT #referen@#Tempo#; |DELINDEX #referen@;
          |ABRE #referen@;

          |BUCLE Reservas;
          |LEE 000#referen@.p;
          |SI FSalida = 0;
               |CONSULTA_CLAVE #1#referen@;
               |SI FSalida = 0;
                    #173#3 = #referen@#0; |PINTA #173#3;
               |SINO;
                    |ERROR;
               |FINSI;
          |SINO;
               |MENAV "0000No hay registros...";
               |ERROR;
          |FINSI;
          |CIERRA #referen@;
          |HAZ BoraTempo; |DELINDEX #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|PROCESO UltLin55;
     #55#0 = #155#0;
     #55#1 = #155#1;
     #55#2 = 9999;
     |LEE 000#55];
     |SI FSalida = 0;
          |LEE 000#55a;
     |SINO;
          |LEE 000#55u;
     |FINSI;
     |SI FSalida = 0; |Y #55#0 = #155#0; |Y #55#1 = #155#1;
          nLin = #55#2 + 1;
     |SINO;
          nLin = 1;
     |FINSI;
     |DDEFECTO #55;
     #55#0 = #155#0;
     #55#1 = #155#1;
     #55#2 = nLin;
     |GRABA 020#55b;
|FPRC;

|PROCESO EditaLin55;
     nRegLin0 = #55#0;
     nRegLin1 = #55#1;
     nRegLin2 = #55#2;

     |SI nModoLin = 1; |VENTANA 1901, 2898, -1, 17, "Nueva L》ea Factura"; |FINSI;
     |SI nModoLin = 2; |VENTANA 1901, 2898, -1, 17, "Modifica L》ea Factura"; |FINSI;
     |SI nModoLin = 4; |VENTANA 1901, 2898, -1, 17, "Consulta L》ea Factura"; |FINSI;
     |HAZ PushVenModal;

     |SI nModoLin = 1;
          |HAZ UltLin55;
     |FINSI;
     |SI nModoLin = 2;
          aApis = #155#26;
          aTipo = #155#13; nForma = -1; |HAZ ActLin;
     |FINSI;
     |PARA i = 0; |SI i [ 20; |HACIENDO i = i + 1;
          #173i = #55i;
     |SIGUE;
     |PINPA #0#173;
     |PINDA #0#173;
     |SI nModoLin = 1; |ENDATOS #1#173; |FINSI;
     |SI nModoLin = 2; |ENDATOS #2#173; |FINSI;
     |SI nModoLin = 4; |PAUSA; |FINSI;
     |SI FSalida = 0; |Y nModoLin ! 4;
          #55#0 = #173#0;
          #55#1 = #173#1;
          #55#2 = #173#2;
          |LEE 121#55=;
          |PARA i = 0; |SI i [ 20; |HACIENDO i = i + 1;
               #55i = #173i;
          |SIGUE;
          aApis = #155#26;
          aTipo = #155#13; nForma = 1; |HAZ ActLin;
          |GRABA 020#55a;

          nRegLin0 = #55#0;
          nRegLin1 = #55#1;
          nRegLin2 = #55#2;
     |SINO;
          |SI nModoLin = 1;
               #55#0 = #173#0;
               #55#1 = #173#1;
               #55#2 = #173#2;
               |BORRA 020#55c;
          |FINSI;
     |FINSI;
     |LIBERA #55;

     |HAZ PopVenModal;

     #55#0 = nRegLin0;
     #55#1 = nRegLin1;
     #55#1 = nRegLin2;
     |LEE 000#55=;
     |REFRESCACONTROL nGridLin;
|FPRC;

|PROCESO EditaLin;
     |SI #155#13 = "V";
          |HAZ EditaLin58;
     |SINO;
          |HAZ EditaLin55;
     |FINSI;
|FPRC;

|PROCESO BtnAltaLin;
     nModoLin = 1; |HAZ EditaLin;
     |HAZ TieneLineasLin;
|FPRC;

|PROCESO BtnModiLin;
     |SI #155#13 = "V";
          |LEE 100#58=;
     |SINO;
          |LEE 100#55=;
     |FINSI;
     |SI FSalida ! 0; |ACABA; |FINSI;
     nModoLin = 2; |HAZ EditaLin;
|FPRC;

|PROCESO BtnBajaLin;
     |SI #155#13 = "V";
          |LEE 100#58=;
          |SI FSalida ! 0; |ACABA; |FINSI;
          aAlfa = "0000N步orrar l》ea factura: " + #58#2 + "?";
          |CONFI aAlfa;
          |SI FSalida = 0;
               |BORRA 020#58a;
               aApis = #155#26;
               aTipo = #155#13; nForma = -1; |HAZ ActLin;
               |HAZ TieneLineasLin;
               |REFRESCACONTROL nGridLin;
          |FINSI;
          |LIBERA #58;
     |SINO;
          |LEE 100#55=;
          |SI FSalida ! 0; |ACABA; |FINSI;
          aAlfa = "0000N步orrar l》ea factura: " + #55#2 + "?";
          |CONFI aAlfa;
          |SI FSalida = 0;
               |BORRA 020#55a;
               aApis = #155#26;
               aTipo = #155#13; nForma = -1; |HAZ ActLin;
               |HAZ TieneLineasLin;
               |REFRESCACONTROL nGridLin;
          |FINSI;
          |LIBERA #55;
     |FINSI;
|FPRC;

|PROCESO BtnConsLin;
     |SI #155#13 = "V";
          |LEE 000#58=;
     |SINO;
          |LEE 000#55=;
     |FINSI;
     |SI FSalida ! 0; |ACABA; |FINSI;
     nModoLin = 4; |HAZ EditaLin;
|FPRC;

|PROCESO TieneLineasLin;
     |DDEF aAlfa;
     |SI #155#13 = "V";
          aAlfa = aAlfa + "sctrm058";
     |SINO;
          aAlfa = aAlfa + "sctrm055";
     |FINSI;
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          #referen@#0 = #155#0;
          #referen@#1 = #155#1;
          #referen@#2 = 0;
          |LEE 000#referen@.];
          |SI FSalida = 0; |Y #referen@#0 = #155#0; |Y #referen@#1 = #155#1;
               nTieneLineasLin = 0;
          |SINO;
               nTieneLineasLin = 1;
          |FINSI;
          |SI nTieneLineasLin = 0;
               |SI nModoCab = 4;
                    |ESTADO_CONTROL nBtnAltaLin, "DISABLE";
                    ||ESTADO_CONTROL nBtnModiLin, "DISABLE";
                    |ESTADO_CONTROL nBtnBajaLin, "DISABLE";
                    |ESTADO_CONTROL nBtnConsLin, "ENABLE";
               |SINO;
                    |ESTADO_CONTROL nBtnAltaLin, "ENABLE";
                    ||ESTADO_CONTROL nBtnModiLin, "ENABLE";
                    |ESTADO_CONTROL nBtnBajaLin, "ENABLE";
                    |ESTADO_CONTROL nBtnConsLin, "ENABLE";
               |FINSI;
          |SINO;
               |SI nModoCab = 4;
                    |ESTADO_CONTROL nBtnAltaLin, "DISABLE";
                    ||ESTADO_CONTROL nBtnModiLin, "DISABLE";
                    |ESTADO_CONTROL nBtnBajaLin, "DISABLE";
                    |ESTADO_CONTROL nBtnConsLin, "DISABLE";
               |SINO;
                    |ESTADO_CONTROL nBtnAltaLin, "ENABLE";
                    ||ESTADO_CONTROL nBtnModiLin, "DISABLE";
                    |ESTADO_CONTROL nBtnBajaLin, "DISABLE";
                    |ESTADO_CONTROL nBtnConsLin, "DISABLE";
               |FINSI;
          |FINSI;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|PROCESO Min56;
     #56#0 = #155#0;
     #56#1 = #155#1;
     #56#2 = 0000;
|FPRC;

|PROCESO Max56;
     #56#0 = #155#0;
     #56#1 = #155#1;
     #56#2 = 999;
|FPRC;

|PROCESO BtnRecibos;
     |VENTANA 1501, 2898, -1, 17, "Consulta Recibos";
     |HAZ PushVenModal;
     nRango = 4 + 8 + 16 + 32;
     |LINEAL_SIMPLE #1#56, nRango, 1602, 2698, Min56, Max56, NULL;
     |PAUSA;
     |HAZ PopVenModal;
|FPRC;

|PROCESO Evt55;
     |SI FSalida = 1; |O FSalida = 2;
          |SELECT #1#55;
          |LEE 000#55=;
          |HAZ TieneLineasLin;
     |FINSI;
     |SI FSalida = 4;
          |HAZ BtnConsLin;
     |FINSI;
|FPRC;

|PROCESO Evt58;
     |SI FSalida = 1; |O FSalida = 2;
          |SELECT #1#58;
          |LEE 000#58=;
          |HAZ TieneLineasLin;
     |FINSI;
     |SI FSalida = 4;
          |HAZ BtnConsLin;
     |FINSI;
|FPRC;

|PROCESO Min52;
     #52#43 = #155#14;
     #52#83 = "N";
     #52#1 = "01.01.0000";
     #52#0 = 0000000;
|FPRC;

|PROCESO Max52;
     #52#43 = #155#14;
     #52#83 = "N";
     #52#1 = "31.12.9999";
     #52#0 = 9999999;
|FPRC;

|PROCESO TipoFac;
     |SI nModoCab = 1; |Y #155Campo ! aConte;
          |PULSATECLA;
          |DESTRUYECONTROL nGridLin;
          |HAZ GridLin;
          |PULSATECLA;
     |FINSI;
|FPRC;

|PROCESO LinServi; |TIPO 0;
     |SI #155#15 ! 999; |Y #155#15 ! 0;
          |ABRE #12;
          #12#0 = #155#15;
          |LEE 000#12=;
          |SI FSalida ! 0;
               |MENAV "0000No existe l》ea de servicio...";
               |ERROR;
          |FINSI;
          |CIERRA #12;
     |FINSI;
|FPRC;

|PROCESO CliRese; |TIPO 0;
     |ABRE #36;
     #36#1 = #155#14;
     |LEE 000#36=;
     |SI FSalida = 0;
          |SI #36#12 = "N";
               |MENAV "0000El c▃igo no es un cliente...";
               |ERROR;
          |SINO;
               |HAZ PintaCampos;
               |SI aConte ! #155Campo
                    #155#3 = #36#32; |PINTA #155#3;
                    #36#1 = #155#3;
                    #155#4 = #36#33; |PINTA #155#4;
                    #155#5 = #36#51; |PINTA #155#5;
                    #155#13 = #36#48; |PINTA #155#13;
                    |SI #36#69 = "N";
                         #155#15 = 999; |PINTA #155#15;
                    |FINSI;
               |FINSI;
          |FINSI;
     |SINO;
          |MENAV "0000No existe c▃igo de cliente...";
          |ERROR;
     |FINSI;
     |CIERRA #36;
|FPRC;

|PROCESO FPago; |TIPO 0;
     |ABRE #35;
     #35#0 = #155#5;
     |LEE 000#35=;
     |SI FSalida = 0;
          |HAZ PintaCampos;
     |SINO;
          |MENAV "0000No existe c▃igo forma de pago...";
          |ERROR;
     |FINSI;
     |CIERRA #35;
|FPRC;

|PROCESO Cliente; |TIPO 0;
     |ABRE #36;
     #36#1 = #155#3;
     |LEE 000#36=;
     |SI FSalida = 0;
          #155#4 = #36#2; |PINTA #155#4;
          |SI #36#12 = "N";
               |MENAV "0000El c▃igo no es un cliente...";
               |ERROR;
          |SINO;
               |SI aConte ! #155#3;
                    #155#5 = #36#51; |PINTA #155#5;
                    |HAZ PintaCampos;
               |FINSI;
          |FINSI;
     |SINO;
          |MENAV "0000No existe c▃igo de cliente...";
          |ERROR;
     |FINSI;
     |CIERRA #36;
|FPRC;

|PROCESO Chequea; |TIPO 0;
     |SI nModoCab = 1; |Y nBloquea = 0;
          |DDEFECTO #54;
          #54#0 = #155#0;
          #54#1 = #155#1;
          |GRABA 000#54b;
          |SI FSalida ! 0;
               |MENAV "0000Registro existente...";
               |ERROR;
          |SINO;
               |C_M #155#0, 1, "N";
               |C_M #155#1, 1, "N";
               nBloquea = 1;

               aAlfa  = "|X000"; aAlfa = #155aAlfa; nId = aAlfa;
               |ESTADO_CONTROL nId, "ENABLE";
               |ESTADO_CONTROL nBtnAltaLin, "ENABLE";

               |REFRESCACONTROL nGridLin;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO DefNum; |TIPO 7;
     |SI nModoCab = 1; |Y nBloquea = 0;
          #54#0 = #155#0;
          #54#1 = 999999;
          |LEE 000#54];
          |SI FSalida = 0;
               |LEE 000#54a;
          |SINO;
               |LEE 000#54u;
          |FINSI;
          |SI FSalida = 0; |Y #54#0 = #155#0;
               nLin = #54#1 + 1;
          |SINO;
               nLin = 1;
          |FINSI;
          #155#1 = nLin; |PINTA #155#1;
     |FINSI;
|FPRC;

|PROCESO Serie; |TIPO 0;
     |ABRE #43;
     #43#26 = #155#0;
     |LEE 000#43=;
     |SI FSalida ! 0;
          |MENAV "0000No existe c▃igo de serie...";
          |ERROR;
     |FINSI;
     |CIERRA #43;
|FPRC;

|PROCESO Valida; |TIPO 7;
     |SI nModoCab = 1; |Y nBloquea = 0;
          aAlfa  = "|X000"; aAlfa = #155aAlfa; nId = aAlfa;
          |ESTADO_CONTROL nId, "DISABLE";
     |FINSI;
|FPRC;

|PROCESO Conte; |TIPO 7;
     aConte = #155Campo;
|FPRC;

|PROCESO PintaCampos;
     |ABRE #36;
     #36#1 = #155#14;
     |LEE 000#36=;
     |SI FSalida ! 0; |DDEFECTO #36; |FINSI;
     |CIERRA #36;

     |ABRE #35;
     #35#0 = #155#5;
     |LEE 000#35=;
     |SI FSalida ! 0; |DDEFECTO #35; |FINSI;
     |CIERRA #35;

     |ABRE #12;
     #12#0 = #155#15;
     |LEE 000#12=;
     |SI FSalida ! 0; |DDEFECTO #12; |FINSI;
     |CIERRA #12;

     |ABRE #5;
     #5#0 = #155#25;
     |LEE 000#5=;
     |SI FSalida ! 0; |DDEFECTO #5; |FINSI;
     |CIERRA #5;

     |PINTA 725, #36#2;
     |PINTA 925, #12#1;
     |PINTA 1025, #35#1;
     |PINTA 1125, #5#1;
|FPRC;

|PROCESO Borra56;
     |BORRA 020#56a;
|FPRC;

|DEFBUCLE Borra56;
     #56#1;
     ;
     #54#0, #54#1, 0000;
     #54#0, #54#1, 9999;
     be;
     NULL, Borra56;
|FIN;

|PROCESO Borra58;
     |BORRA 020#58a;
     aApis = #54#26;
     aTipo = #54#13; nForma = -1; |HAZ ActLin;
|FPRC;

|DEFBUCLE Borra58;
     #58#1;
     ;
     #54#0, #54#1, 0000;
     #54#0, #54#1, 9999;
     be;
     NULL, Borra58;
|FIN;

|PROCESO Borra55;
     |BORRA 020#55a;
     aApis = #54#26;
     aTipo = #54#13; nForma = -1; |HAZ ActLin;
|FPRC;

|DEFBUCLE Borra55;
     #55#1;
     ;
     #54#0, #54#1, 0000;
     #54#0, #54#1, 9999;
     be;
     NULL, Borra55;
|FIN;

|PROCESO Min55;
     #55#0 = #155#0;
     #55#1 = #155#1;
     #55#2 = 0000;
|FPRC;

|PROCESO Max55;
     #55#0 = #155#0;
     #55#1 = #155#1;
     #55#2 = 9999;
|FPRC;

|PROCESO Min58;
     #58#0 = #155#0;
     #58#1 = #155#1;
     #58#2 = 0000;
|FPRC;

|PROCESO Max58;
     #58#0 = #155#0;
     #58#1 = #155#1;
     #58#2 = 999;
|FPRC;

|PROCESO GridLin;
     nRango = 4 + 8 + 16 + 32;
     |SI #155#13 = "V";
          |LINEAL_SIMPLE #1#58, nRango, 1802, 2498, Min58, Max58, Evt58;
     |SINO;
          |LINEAL_SIMPLE #1#55, nRango, 1802, 2498, Min55, Max55, Evt55;
     |FINSI;
     nGridLin = FSalida;
|FPRC;

|PROCESO Edita;
     aReg0 = #54#0;
     nReg1 = #54#1;

     |SI nModoCab = 1; |VENTANA 0901, 2898, -1, 17, "Nueva Factura"; |FINSI;
     |SI nModoCab = 2; |VENTANA 0901, 2898, -1, 17, "Modifica Factura"; |FINSI;
     |SI nModoCab = 4; |VENTANA 0901, 2898, -1, 17, "Consulta Factura"; |FINSI;
     |HAZ PushVenModal;

     |SI nModoCab = 1;
          |DDEFECTO #155;
          |C_M #155#0, 1, "S";
          |C_M #155#1, 1, "S";
          |C_M #155#13, 1, "S";
          |C_M #155#14, 1, "S";
          |C_M #155#15, 1, "S";
          |C_M #155#26, 1, "S";
     |SINO;
          |PARA i = 0; |SI i [ 26; |HACIENDO i = i + 1;
               #155i = #54i;
          |SIGUE;
          |C_M #155#0, 1, "N";
          |C_M #155#1, 1, "N";
          |C_M #155#13, 1, "N";
          |C_M #155#14, 1, "N";
          |C_M #155#15, 1, "N";
          |C_M #155#26, 1, "N";
     |FINSI;

     |PINPA #0#155; nPantaCab = FSalida;
     |PINDA #0#155;
     |HAZ PintaCampos;

     |CONTROL_SIMPLE nPantaCab, "BOTON,{{137}}Recibos", 0688, 0698, BtnRecibos;
     nBtnRecibos = FSalida;
     |CONTROL_SIMPLE nPantaCab, "BOTON,{{193}}Alta", 1702, 1712, BtnAltaLin;
     nBtnAltaLin = FSalida;
||anulado
||     |CONTROL_SIMPLE nPantaCab, "BOTON,{{197}}Modificar", 1714, 1724, BtnModiLin;
||     nBtnModiLin = FSalida;
     |CONTROL_SIMPLE nPantaCab, "BOTON,{{199}}Baja", 1714, 1724, BtnBajaLin;
     nBtnBajaLin = FSalida;
     |CONTROL_SIMPLE nPantaCab, "BOTON,{{155}}Consulta", 1726, 1736, BtnConsLin;
     nBtnConsLin = FSalida;

     |HAZ TieneLineasLin;
     |SI nModoCab = 1;
          |ESTADO_CONTROL nBtnRecibos, "DISABLE";
          |ESTADO_CONTROL nBtnAltaLin, "DISABLE";
     |FINSI;
     |HAZ GridLin;
     nBloquea = 0;
 |ET Otra;
     |SI nModoCab = 1; |ENDATOS #1#155; |FINSI;
     |SI nModoCab = 2; |ENDATOS #2#155; |FINSI;
     |SI nModoCab = 4; |PAUSA; |FINSI;
     |SI FSalida = 0; |Y nModoCab ! 4;
          #54#0 = #155#0;
          #54#1 = #155#1;
          |LEE 121#54=;
          |PARA i = 0; |SI i [ 26; |HACIENDO i = i + 1;
               #54i = #155i;
          |SIGUE;
          |GRABA 020#54a;
          |LIBERA #54;
          aReg0 = #54#0;
          nReg1 = #54#1;

          |SI nModoCab = 1; |HAZ BorraReci; |FINSI;
          |HAZ CreaReci;
          |HAZ CreaReciCartera;

          |SI #54#13 = "V";
               |ABRE #52;
               |BUCLE Borra55;
               |CIERRA #52;
          |SINO;
               |BUCLE Borra58;
          |FINSI;
          |CONFI "0000S沉mprimir factura?";
          |SI FSalida = 0;
               eaSerie = #54#0;
               enNumero = #54#1;
               eaProg = "sctrz052";
               |HAZ EjecutaProg;
          |FINSI;
     |SINO;
          |SI nBloquea = 1;
               #54#0 = #155#0;
               #54#1 = #155#1;
               |BORRA 020#54c;
               |ABRE #52;
               |BUCLE Borra55;
               |CIERRA #52;
               |BUCLE Borra58;
               |BUCLE Borra56;
          |FINSI;
     |FINSI;
     |LIBERA #54;

     |HAZ PopVenModal;

     #54#0 = aReg0;
     #54#1 = nReg1;
     |LEE 000#54=;
     |REFRESCACONTROL nGridCab;
|FPRC;

|PROCESO BtnAlta;
     nModoCab = 1; |HAZ Edita;
     |HAZ TieneLineas;
|FPRC;

|PROCESO BtnModi;
     |LEE 100#54=;
     |SI FSalida ! 0; |ACABA; |FINSI;
     |HAZ ChequeaReci;
     |SI enError = 0;
          nModoCab = 2; |HAZ Edita;
     |SINO;
          nModoCab = 4; |HAZ Edita;
     |FINSI;
|FPRC;

|PROCESO BtnBaja;
     |LEE 100#54=;
     |SI FSalida ! 0; |ACABA; |FINSI;
     aAlfa = "0000N步orrar factura: " + #54#0 + "/" + #54#1 + "?";
     |CONFI aAlfa;
     |SI FSalida = 0;
          |HAZ ChequeaReci;
          |SI enError = 0;
               #155#14 = #54#14;   || Cliente

               |HAZ BorraReci;
               |BORRA 020#54a;
               |ABRE #52;
               |BUCLE Borra55;
               |CIERRA #52;
               |BUCLE Borra58;
               |BUCLE Borra56;

               |HAZ TieneLineas;
               |REFRESCACONTROL nGridCab;
          |FINSI;
     |FINSI;
     |LIBERA #54;
|FPRC;

|PROCESO BtnCons;
     |LEE 000#54=;
     |SI FSalida ! 0; |ACABA; |FINSI;
     nModoCab = 4; |HAZ Edita;
|FPRC;

|PROCESO BtnImpr;
     |LEE 000#54=;
     |SI FSalida ! 0; |ACABA; |FINSI;
     eaSerie = #54#0;
     enNumero = #54#1;
     eaProg = "sctrz052";
     |HAZ EjecutaProg;
|FPRC;

|PROCESO Evento54;
     |SI FSalida = 1; |O FSalida = 2;
          |SELECT #1#54;
          |LEE 000#54=;
          |HAZ TieneLineas;
     |FINSI;
     |SI FSalida = 4;
          |HAZ BtnCons;
     |FINSI;
|FPRC;

|PROCESO TieneLineas;
     |DDEF aAlfa;
     aAlfa = aAlfa + "sctrm054";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          |LEE 000#referen@.p;
          |SI FSalida = 0;
               |ESTADO_CONTROL nBtnModi, "ENABLE";
               |ESTADO_CONTROL nBtnBaja, "ENABLE";
               |ESTADO_CONTROL nBtnCons, "ENABLE";
               |ESTADO_CONTROL nBtnImpr, "ENABLE";
          |SINO;
               |ESTADO_CONTROL nBtnModi, "DISABLE";
               |ESTADO_CONTROL nBtnBaja, "DISABLE";
               |ESTADO_CONTROL nBtnCons, "DISABLE";
               |ESTADO_CONTROL nBtnImpr, "DISABLE";
          |FINSI;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|PROCESO LogoPanta;
     eaNomLogo = #100#1;
     |HAZ TraeLogoPan;
     enPantaLogo = nPanta;
     |HAZ PintaLogoPan;
|FPRC;

|PROCESO Min54;
     #54#0 = "     ";
     #54#1 = 000000;
|FPRC;

|PROCESO Max54;
     #54#0 = "zzzzz";
     #54#1 = 999999;
|FPRC;

|PROGRAMA;
     |ABRE #100; |LEE 000#100p; |CIERRA #100;

     |PINPA #0#0; nPanta = FSalida;
     |PINDA #0#0;
     |HAZ LogoPanta;

     |CONTROL_SIMPLE nPanta, "BOTON,{{193}}Alta", 1002, 1012, BtnAlta;
     nBtnAlta = FSalida;
     |CONTROL_SIMPLE nPanta, "BOTON,{{197}}Modificar", 1014, 1024, BtnModi;
     nBtnModi = FSalida;
     |CONTROL_SIMPLE nPanta, "BOTON,{{199}}Baja", 1026, 1036, BtnBaja;
     nBtnBaja = FSalida;
     |CONTROL_SIMPLE nPanta, "BOTON,{{155}}Consulta", 1038, 1048, BtnCons;
     nBtnCons = FSalida;
     |CONTROL_SIMPLE nPanta, "BOTON,{{205}}Impresi▋", 1050, 1060, BtnImpr;
     nBtnImpr = FSalida;

     |ABRET #54;
     |ABRET #55;
     |ABRET #56;
     |ABRET #58;
     |HAZ TieneLineas;
     nRango = 4 + 8 + 16 + 32;
     |LINEAL_SIMPLE #1#54, nRango, 1102, 2999, Min54, Max54, Evento54;
     nGridCab = FSalida;
     enCtrFin = nGridCab;
     |HAZ EsperaFin;
     |PULSATECLA;
     |DESTRUYECONTROL nGridCab;
     |CIERRAT #58;
     |CIERRAT #56;
     |CIERRAT #55;
     |CIERRAT #54;
|FPRO;
