|FICHEROS;
     grsol003 #0;
     grsol002 #2;
     agifa189 #189;
     referen@;
|FIN;

|VARIABLES;
     nModo = 0;
     aDef = "";
     aAlfa = "";
     nNume = 0;

     &eaSerie = "";
     &enNumero = 0;
     &enLinea = 0;
     &enUniSol = 0;
     &eaTmpSol = "";
     &nDeci_Uni = 0;

     i1        = "";
     i2        = "";
     i3        = "";
     i4        = "";
     i5        = "";
     i6        = "";
     p1        = "";
     p2        = "";
     p3        = "";
     p4        = "";
     p5        = "";
     p6        = "";
     calcodb   = "";
     sumai     = 0;
     sumap     = 0;
     base      = 0;
     resto     = 0;
     total     = 0;
     digito    = 0;
|FIN;

|PROCESO Min;
     #0#0 = eaSerie;
     #0#1 = enNumero;
     #0#2 = enLinea;
     #0#3 = 1;
|FPRC;

|PROCESO Max;
     #0#0 = eaSerie;
     #0#1 = enNumero;
     #0#2 = enLinea;
     #0#3 = 999;
|FPRC;

|PROCESO SumUni; |TIPO 2;
     enUniSol = enUniSol +. 1;

     ||-------------------pinta en pantalla
     #189#7 = enUniSol;
     |ATRI I;
     |PINTA 1160, #189#7
     |ATRI 0;
|FPRC;

|PROCESO EAN13; |TIPO 0;
/*
     i1 = #0#4 % 101;
     i2 = #0#4 % 301;
     i3 = #0#4 % 501;
     i4 = #0#4 % 701;
     i5 = #0#4 % 901;
     i6 = #0#4 % 1101;
     p1 = #0#4 % 201;
     p2 = #0#4 % 401;
     p3 = #0#4 % 601;
     p4 = #0#4 % 801;
     p5 = #0#4 % 1001;
     p6 = #0#4 % 1201;
     sumai = i1 + i2 + i3 + i4 + i5 + i6;
     sumap = p1 + p2 + p3 + p4 + p5 + p6;
     sumap = sumap * 3;
     total = sumai + sumap;
     base = total / 10;
     resto = total $ 10;
     |SI resto ! 0;
          resto = resto / 10;
          base = (base - resto) + 1;
          base = base * 10;
     |SINO;
          base = base * 10;
     |FINSI;
     digito = base - total;
     calcodb = #0#4;
     |QBF calcodb;
     calcodb = calcodb + "000000000000000";
     calcodb = calcodb % 0112;
     calcodb = calcodb + digito;
     |QBF calcodb;
     #0#4 = calcodb;
     |PINTA #0#4;
*/
|FPRC;

|PROCESO CheqSerie; |TIPO 0;
     |ABRE #2;
     #2#0 = #0#4;
     |LEE 000#2=;
     |SI FSalida = 0;
          |MENAV "0000Serie Fabricacion Existente...";
          |ERROR; |ACABA;
     |FINSI;
     |CIERRA #2;

     |DDEF aDef;
     aDef = aDef + "grsol003";
     |CARGA_DEF aDef, referen@;
     |SI FSalida = 0;
          |NOME_DAT #referen@#eaTmpSol#;
          |ABRE #referen@;
          |SELECT #2#referen@;
          #referen@#4 = #0#4;
          |LEE 000#referen@.=;
          |SI FSalida = 0;
               |SI #referen@#0 ! #0#0; |O #referen@#1 ! #0#1;
                         |O #referen@#2 ! #0#2; |O #referen@#3 ! #0#3;
                    |MENAV "0000Serie ya introducida";
                    |ERROR; |ACABA;
               |FINSI;
          |FINSI;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|PROCESO DefeLinea; |TIPO 0;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo ! 1; |ACABA; |FINSI;

     |DDEF aDef;
     aDef = aDef + "grsol003";
     |CARGA_DEF aDef, referen@;
     |SI FSalida = 0;
          |NOME_DAT #referen@#eaTmpSol#;
          |ABRE #referen@;
          |SELECT #2#referen@;
          |LEE 000#referen@.u;
          |SI FSalida = 0;
               aAlfa = #referen@#4 % 112;
               nNume = aAlfa + 1;
               #0#4 = nNume;
               |HAZ EAN13;
               #0#5 = #referen@#5;
               |PINTA #0#5;
          |SINO;

          |FINSI;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|PROGRAMA;
     |NOME_DAT #0 eaTmpSol;
     |ENTLINEAL #1#0, 4, 2, 22, 1, Min, Max;
|FPRO;
