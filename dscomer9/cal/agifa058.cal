|FICHEROS;
  agifa142 #142;
  agifa058 #0;
  agifa134 #1;
  agifa010 #2;
  tempo134 #134;
  agifa007 #30;
  agifa010@ #100;
  referen@;
|FIN;

|VARIABLES;
     nNoFactu = 0;
     aPtec = "";
     nPtec = 0;
     nLin = 0;
     nModo = 0;
     &enSwMenu = 0;
     &clien = "";
     &fpago = "";
     &repres = "";
     &dto = 0;
     &dtoa = 0;
     &dtop = 0;
     &factur = 2;

     aAlfa = "";
     nTecla = 0;
     aDef = "";
     &enSalida = 0;
     &Tempo           = "";
     aTempo134        = "";
     serie_fac = "";
     serie_alb = "";
     alfa = "";
     aDSerie = "";
     aHSerie = "";
     fichero = "";
|FIN;

|PROCESO nofac;
       #134#0 = #2#52;
       #134#1 = #2#0;
       #134#2 = #2#3;
       #134#3 = #2#4;
       #134#4 = #2#8;
       #134#5 = #2#78;
       |GRABA 001#134n;
|FPRC;
/*
|DEFBUCLE leealbs;
     #2#1;
     3;
     aDSerie ,      0 , #1#2, "N", "S" ;
     aHSerie , 999999 , #1#2, "N", "S" ;
     ;
     NULL,nofac;
|FIN;
*/
|DEFBUCLE leealbs;
     #2#5;
     3, 38, 43, 51;
     "     ", 000000, aDSerie, 000001, #1#2, "N", "S", "S";
     "     ", 000000, aHSerie, 999999, #1#2, "N", "S", "S";
     ;
     NULL, nofac;
|FIN;

|PROCESO apendv2; |TIPO 6;
     nTecla = FSalida;
     nModo = (FEntrada / 100) ! 0;

     clien = #1#2;
     fpago = #1#11;
     repres = #1#7;
     dto = #1#4;
     dtoa = #1#5;
     dtop = #1#6;

     |SI nTecla = 13;            || <F5> Alb Nuevo
          |SI nModo = 1;
               |ABRE #2;
               enSwMenu = 1;
               #2#52 = #0#15;          || serie alb.
               |HAZ ContaAV7;
               |CIERRA #2;
               #0#2 = #2#0;            || Conta
          |FINSI;
          aAlfa = "dsz99953;S" + #0#15 + #0#2;
          |SUB_EJECUTA aAlfa;
          |SI enSalida ! 0; |ERROR; |FINSI;
          |ACABA;
     |FINSI;

     |SI nTecla = 12;
          |HAZ CreaTempo; aTempo134 = Tempo;
          |NOME_DAT #134 aTempo134; |DELINDEX #134;
          |ABRE #134;
          |SI Campo = 15; ||Llamado desde campo serie
              aDSerie = "  ";
              aHSerie = "zz";
          |SINO;
              aDSerie = #0#15;
              aHSerie = #0#15;
          |FINSI;
          |BUCLE leealbs;
          |SI Campo = 15; ||Llamado desde campo serie
              |CONSULTA_CLAVE #1#134;
              |SI FSalida = 0; ||Intro
                 #0#15  = #134#0; ||Pongo Serie seleccionada
                 #0#2   = #134#1;
                 |PINTA #0#15;
                 |PINTA #0#2;
                 |PTEC 802;
              |SINO;
                 |ENCAMPO #15#0;
              |FINSI;
          |SINO;
              |CONSULTA_CLAVE #2#134;
              |SI FSalida = 0; ||Intro
                 #0#2  = #134#1;
                 |PINTA #0#2;
              |SINO;
                 |ENCAMPO #2#0;
              |FINSI;
          |FINSI;
          |CIERRA #134;

          |DELINDEX #134; Tempo = aTempo134; |HAZ BoraTempo;
          |ACABA;
     |FINSI;
     |SI Campo = 2;
          |ABRE #2;
          #2#52 = #0#15;
          #2#0 = #0#2;
          |LEE 000#2=;
          |SI FSalida ! 0;
               aAlfa = "dsz99953;N" + #0#15 + #0#2;
               |SUB_EJECUTA aAlfa;
               |SI enSalida ! 0; |ERROR; |FINSI;
          |FINSI;
          |CIERRA #2;
     |FINSI;
|FPRC;

|PROCESO CompDiv; |TIPO 0;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 1;
          |SI nTecla = 1; |O nTecla = 4; ||Anula ESC y Rev Pag
               |ERROR; |PTEC 807; |ACABA;
          |FINSI;
     |FINSI;

     |ABRE #agifa007;
     #agifa007#26 = #0#14;
     |LEE 010#agifa007.=;
     serie_fac = #agifa007#39;
     #agifa007#26 = #0#15;
     |LEE 010#agifa007.=;
     serie_alb = #agifa007#39;
     |CIERRA #agifa007;
     |SI serie_alb ! serie_fac;
       |SI serie_alb = "S";
         |MENAV "0000La serie de la factura no es de divisas";
       |SINO;
         |MENAV "0000La serie de la factura es de divisas";
       |FINSI;
       |ERROR;
     |FINSI;
|FPRC;

|PROCESO DefSerie058; |TIPO 7;
     nModo = (FEntrada / 100) ! 0;
     |ABRE #agifa142; |LEE 000#agifa142.p; |CIERRA #agifa142;
     |SI nModo = 1;
          #0#15 = #0#14;
          |SI #agifa142#185 = "S"; #0#15 = #agifa142#188; |FINSI;
     |FINSI;
     |HAZ MensaNoFactu;
|FPRC;

|PROCESO Minc058;
     #referen@#14 = #1#49;
     #referen@#0 = #1#0;
     #referen@#1 = 001;
|FPRC;

|PROCESO Maxc058;
     #referen@#14 = #1#49;
     #referen@#0 = #1#0;
     #referen@#1 = 999;
|FPRC;

|PROCESO Consulta058; |TIPO 66;
     nLin = 0;
     |DDEF aAlfa;
     aAlfa = aAlfa + "agifa059";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          |CONSULTA_F_CLAVE #1#referen@, Minc058, Maxc058;
          |SI FSalida = 0; nLin = #referen@#1; |FINSI;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
     |SI nLin ! 0;
          |PTEC 802;
          aAlfa = ("000" + nLin) % -103;
          aPtec = aAlfa % 301; nPtec = &aPtec;
          |PTEC nPtec;
          aPtec = aAlfa % 201; nPtec = &aPtec;
          |PTEC nPtec;
          aPtec = aAlfa % 101; nPtec = &aPtec;
          |PTEC nPtec;
     |FINSI;
|FPRC;


|PROCESO NoFactu;
     nNoFactu = nNoFactu + 1;
|FPRC;

|DEFBUCLE NoFactu;
     #2#5;
     3, 38, 43, 51;
     "     ", 000000, aDSerie, 000001, #1#2, "N", "S", "S";
     "     ", 000000, aHSerie, 999999, #1#2, "N", "S", "S";
     ;
     NULL, NoFactu;
|FIN;

|PROCESO MensaNoFactu; |TIPO 7;
     |SI Campo = 15;
          aDSerie = "     ";
          aHSerie = "zzzzz";
     |SINO;
          aDSerie = #0#15;
          aHSerie = #0#15;
     |FINSI;

     nNoFactu = 0;
     |BUCLE NoFactu;
     |SI Campo = 15;
          aAlfa = "0000<F4> Albaranes sin facturar: [" + nNoFactu + "]    <F5> Alta/Modificacion Albaran";
     |SINO;
          aAlfa = "0000<F4> Albaranes sin facturar: [" + nNoFactu + "]    <F5> Alta/Modificacion Albaran";
     |FINSI;
     |MENSA aAlfa;
|FPRC;
