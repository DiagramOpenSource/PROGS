|FICHEROS;
     mecaz014 #0;
     mecam001 #1;
     agifa019 #2;
     mecam004 #4;
     agifa017 #8;
     mecam011 #11;
     mecam012 #12;
     mecam016 #16;
     mecam017 #17;
     dsm00024 #24;
     agifa049 #49;
|FIN;

|VARIABLES;
     &eaSerie = "";
     &enOrden = 0;
     nFactor = 0;
     nUni = 0;
     aParti = "";
|FIN;

|PROCESO StockFab; ||---------------Actualiza Articulo/Almacen
     |ABRE #2;
     |ABRE #8;
     #2#0 = #16#2;
     |LEE 101#2=;
     |SI FSalida = 0;
          #2#13 = #2#13 + (#17#3 * #17#4);

          #8#0 = #17#2;
          #8#1 = 1;          || Almacen  FIJO A 1
          |LEE 101#8=;
          |SI FSalida = 0;
               #8#9 = #8#9 + (#17#3 * #17#4);

               |HAZ ValoraStock;
               |GRABA 020#8a;
               |LIBERA #8;
          |SINO;
               |HAZ ValoraStock;
          |FINSI;
          |GRABA 020#2a;
          |LIBERA #2;
     |FINSI;
     |CIERRA #2;
     |CIERRA #8;
|FPRC;

|PROCESO BusUltParti;
     aParti = #12#6;
|FPRC;

|DEFBUCLE BusUltParti;
     #12#1;
     ;
     #16#0, #16#1, #16#2, #49#2, "                    ", " ";
     #16#0, #16#1, #16#2, #49#2, "zzzzzzzzzzzzzzzzzzzz", "z";
     ;
     NULL, NULL, NULL, NULL, NULL, BusUltParti;
     #12#8;
|FIN;

|PROCESO ActNece;
     |DDEFECTO #2;
     #2#0 = #49#2;
     |LEE 000#2=;

     |DDEFECTO #11;
     #11#0 = #16#0;
     #11#1 = #16#1;
     #11#2 = #16#2;
     #11#3 = #49#2;
     #11#5 = #4#3;
     |LEE 101#11=;
     |SI FSalida ! 0; |GRABA 020#11b; |FINSI;
     #11#4 = #49#9;
     #11#6 = #2#180;
     #11#7 = #11#7 + nUni;
     |GRABA 020#11a;
     |LIBERA #11;

     |DDEFECTO #2;
     #2#0 = #49#2;
     |LEE 000#2=;

     |SI #2#180 = "N"; |ACABA; |FINSI;

     aParti = "";
     |BUCLE BusUltParti;

     |ABRE #12;
     |DDEFECTO #12;
     #12#0 = #16#0;
     #12#1 = #16#1;
     #12#2 = #16#2;
     #12#3 = #49#2;
     #12#4 = #49#9;
     #12#5 = #4#3;
     #12#6 = aParti;
     |LEE 101#12=;
     |SI FSalida ! 0; |GRABA 020#12b; |FINSI;
     #12#7 = #12#7 + nUni;
     |GRABA 020#12a;
     |LIBERA #12;
     |CIERRA #12;
|FPRC;

|PROCESO MecaEscanLin;
     |DDEFECTO #4;
     #4#0 = #49#0;
     #4#1 = #49#1;
     |LEE 000#4=;
     |SI #4#2 = "S"; || Film = S
          |SI #17#5 = "N"; |ACABA; |FINSI;
          nFactor = 1;
          |SI #17#5 = "A"; nFactor = 2; |FINSI;
     |SINO;
          nFactor = 1;
     |FINSI;

     nUni = #49#12 * nFactor * (#17#3 *#17#4);

     #2#0 = #49#2;
     |LEE 101#2=;
     |SI FSalida = 0;
          #2#12 = #2#12 + nUni;
          #2#104 = #2#104 - nUni;

          #8#0 = #49#2;
          #8#1 = #49#9;
          |LEE 101#8=;
          |SI FSalida = 0;
               #8#8 = #8#8 + nUni;
               #8#39 = #8#39 - nUni;
               |SI #2#180 = "S";
                    aParti = "";
                    |BUCLE BusUltParti;

                    |DDEFECTO #24;
                    #24#0 = #49#2;
                    #24#1 = #49#9;
                    #24#2 = aParti;
                    |LEE 101#24=;
                    |SI FSalida ! 0; |GRABA 020#24b; |FINSI;
                    #24#24 = #24#24 + nUni;
                    #24#22 = #24#22 - nUni;
                    |HAZ ValoraStock;
                    |GRABA 020#24a;
                    |LIBERA #24;
               |FINSI;
               |HAZ ValoraStock;
               |GRABA 020#8a;
               |LIBERA #8;
          |FINSI;
          |GRABA 020#2a;
          |LIBERA #2;

          |HAZ ActNece;
     |FINSI;
|FPRC;

|DEFBUCLE MecaEscanLin;
     #49#1;
     ;
     #16#2, 001;
     #16#2, 999;
     ;
     NULL, MecaEscanLin;
|FIN;

|PROCESO MecaReservaStock;
     |ABRE #11;
     |ABRE #4;
     |ABRE #2;
     |ABRE #8;
     |ABRE #24;
     |BUCLE MecaEscanLin;
     |CIERRA #24;
     |CIERRA #8;
     |CIERRA #2;
     |CIERRA #4;
     |CIERRA #11;
|FPRC;

|PROCESO mecam017;
     |SI #17#6 = "N";
          |HAZ MecaReservaStock;
          |HAZ StockFab;
          #17#6 = "S";
          |GRABA 020#17a;
     |FINSI;
|FPRC;

|DEFBUCLE mecam016;
     #16#1;
     ;
     #0#0, #0#1;
     #0#0, #0#1;
     be;
     NULL, NULL, mecam017;
|FIN;

|PROCESO Tipo3; |TIPO 3;
     |BUCLE  mecam016;
|FPRC;

|PROGRAMA;
     |SI enOrden ! 0;
          #0#0 = eaSerie;
          #0#1 = enOrden;
          |HAZ Tipo3;
     |SINO;
          |MANTE #0;
     |FINSI;
|FPRO;
