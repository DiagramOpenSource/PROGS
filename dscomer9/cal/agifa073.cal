|FICHEROS;
     agifa073 #0;   || Lineas de pedido
     agifa104 #1;   || Pedido
     agifa019 #2;   || Articulos
     agifa039 #5;   || Descuentos
     agifa024 #6;   || Clientes
     agifa017 #8;   || Stocks almacenes
     agifa065 #9;   || Historico.
     agifa010 #10;
     agifa142 #16;
     agifa007 #17;
     dsm00024 #24;
     agifa071 #71;
     agi00010 #80,MANTE; || Texto lineas de pedidos.
     agi00031 #90;       || Temporal para el calculo de adjudicacion por fechas de entrega.
     agi00033 #99;       || Auxiliar Pedidos.
     agifa067 #91;       || Pedidos de Compras(L).
     agifa321 #35;
     dsl00001 #36;       ||Codigos de barras multiples
     dsm00246 #40;       ||Control Riesgo Por Usuarios.
     dsm00247 #41;       ||Pantalla Informe Riesgo.
     dsm00248 #43;
     agifa049 #49;
     dsm00005 #905;
     dsm00010 #910;
     dsm00016 #916;
     dsm00046 #946;
     dsm00279 #279;
     agifa553 #553;
     agifa029 #29;
     dsm00238 #238;
     agifa048 #480;
     dsm00134 #134;

     referen1@ #100;
     referen2@;
     refvigor@;
     referen3@;
     tagm0056@;
     mecaw001@;
     mecam001@;
     mecam004@;
     mecam005@;
     mecam006@;
     mecam006a@;
     desan001@;
     coima002@;
     coima003@;
     sanch001@;
|FIN;

|VARIABLES;
     nSwFergalsan = 0;
     nComiRocai = 0;
     aArtiPromo = "";
     &eaTmpPV816 = "";
     nUni1Ant = 0;
     nUni2Ant = 0;
     &eaEvaInc = "";
     &enEvaPor = 0;
     &enEvaImp = 0;
     &eaEvaTalla = "";
     &enIncPreBerria = 0;
     aDCodF1 = "";
     aDCodF2 = "";
     aDCodF3 = "";
     aDCodF4 = "";
     &enCajas = 0;
     &enSurtido = 0;
     nPreDiv = 0;
     nBruDiv = 0;
     nBruto = 0;
     nError = 0;
     ||COIMASA
     nSwCoimasa = 0;
     &enModoCoimasa = 0;
     &enFormaCoimasa = 0;
     &enPrioridadBajaPed = 0;

     aConteArt = "";
     &eaHayIMEI = "";
     &eaNomCli = "";
     nEsta = 0;
     &enSwPrimiPDA = 0;
     nUniOrg = 0;
     nTotUni = 0;
     nFlag = 0;
     nSwAparecida = 0;
     &enLin004082 = 0;
     aRese = "";
     nTallerBorLin = 0;
     nSwTaller = 0;
     nPreDtoAnt = 0;
     aDesAnt = "";
     nHay = 0;
     nAlma = 0;
     nSwVigor = 0;
     nAbo = 0;
     aFaltaStock = "";
     aFilm = "N";
     nUni = 0;
     nFactor = 0;
     nSwMecanogra = 0;
     nMecaOrd = 0;
     nMecaMaestra = 0;
     &eaFicMeca = "";
     aPath = "";
     nTagBorLinPost = 0;
     nTagQuitaPost = 0;
     nTagPre = 0;
     aTagDes = "";
     aTagArt = "";
     nSwTagloma = 0;
     &enModo104 = 0;
     &enDto = 0;
     aPtec = "";
     nPtec = 0;
     nLin = 0;

     nEsKit = 0;
     &eaModulo = "";

     nCalc      = 0;
     nTecla     = 0;
     &eaIVAsn   = "";
     nCampo     = 0;
     nBene      = 0;
     &nDispoKit = 0;
     nConAu     = 0;
     &nMasRies  = 0;
     nTries     = 0;
     nAudito    = 0;
     aUs        = "";
     &nRieTotal = 0;
     &nRieUtili = 0;
     &aRieBloqu = "";
     &aBloquead = "";
     &eaTag     = "";
     &Tempo     = "";
     aTempo294  = "";
     aTempo90   = "";
     &enUniMarhu= 0;
     aDef       = "";
     nHayPen    = 0;
     fEntrega   = @;
     nModo      = 0;
     nTotRiesgo = 0;
     nSw_Dentro = 0;
     nCamp1    = 0;
     nCamp2    = 0;
     nCamp3    = 0;
     aAlfa     = "";
     aMod      = "";
     aVis      = "";
     nPos      = 0;
     &enDescuento1 = 0;
     &enDescuento2 = 0;
     &eaTComision  = "";
     &enComision   = 0;

     &nPromo    = 0;
     &ser_ped   = "";
     &num_ped   = 0;
     &lin_ped   = 0;
     &enSwPanta = 1;

     &TipoCta        = "";
     &nDeci_Base     = 0;   || Decimales en Totales de la moneda base
     &nDeci_PreBase  = 0;   || Decimales en el Precio en moneda base
     &nDeci_BaseMxP  = 0;   || Decimales en Totales de la moneda base (Maxima precision)
     &nDeci_PreBasMxP= 0;   || Decimales en el Precio en moneda base (Maxima precision)
     &nDeci_DivP     = 0;   || Decimales en Totales de la divisa
     &nDeci_PreDivP  = 0;   || Decimales en el Precio en divisa
     &nDeci_TotVisP  = 0;   || Decimales en Totales visibles (el de la moneda de trabajo)
     &nDeci_TotNoVisP = 0;  || Decimales en Totales no visibles (el de la otra moneda)
     &nDeci_PreVisP  = 0;   || Decimales en el Precio visual. (lineas)
     &nDeci_ImpVis   = 0;   || Decimales en el Importe visual. (lineas)

     &ac_divisa = ""; ||
     &pintado   = 0;|| Controla el pintado de mensa para que solo lo haga 1 vez

     &qAbono    = "";
     &Envase    = "";
     &Unidades1 = 0;
     &Unidades2 = 0;
     &VArticulo = "";

     &c_clien   = "";
     &c_artic   = "";
     &c_serie   = "";
     &entrada   = 0;

     &ext1          = "";

     &aSeriePedido  = "";
     &aNumeroPedido = 0;
     &Cliente = "";
     &SPedido = "";
      verpre  = "";
     &NPedido = 0;
     &PPedido = "";
     &FPedido = @;
     &BAdela  = 0;
     &ser = "";
     &doc = 0;
      prevul  = 0;
     &r_arti        = "";

     &aRecoge = "N";
     &aModalidad = "V";
     &aCliPro  = "";
     &aProceso = "agifa073";
     &fed_dt = @;   || Fecha....
     &art_dt = "";  || Articulo.
     &cli_dt = "";  || Cliente..
     &fam_dt = "";  || Familia.
     &iva_dt = 0;   || Tipo Iva.
     &dtos_2 = 0;   || Descuento 2.
     &dto_pt = 0;   || Descuento Ptas.
     &dtos_1 = 0;   || Descuento 1.
     &pvp_ve = 0;   || Precio Venta.
     &tarifa = 0;   || Tarifa Cliente.
     &quedto = 0;   || 1=cli./art, 2=cli./familia, 3=cli./subfam.
     &gru_dt = "";  || Grupo Cliente.
     &uni_dt = 0;
     &uni_dt2 = 0;
     &enMensaje = 0;
     &aParam    = "";

     nPrecio     = 0;

     tecla      = "";
     mensa      = ""; || Linea de visualizacion
     titdiv = "";   || Encabezado de precio e imp. con la divisa "Imp.Tot(USD)"

     aProg = "";

     TUnidad    = 0;
     TEnvase    = 0;

     i              = 0;
     asto           = 0;
     Unidades       = 0;
     alfa           = "";
     ind            = 0;
     salida         = "";
     prov2          = "";
     def_exp        = "N";
     avisa_st       = "N";
     vacio          = "                    ";
     mensaje        = "";
     mensa_exp      = "0000 Pedido para Exportacion.Tipo de IVA = 0  !!";
     articulo       = " ";
     desc_art       = "";
     fiac           = "  ";
     guarda         = "  ";
     relleno        = "                                       ";
     aponer         = "  ";
     serie          = "";
     pedido         = 0;
     pedido_o       = 0;
     serie_o        = "";
     alfa1          = "";
     alfa2          = 0;
     recoge         = "";  || Viene de agifa104
     DescAmpli      = "N";
     def_alm        = 0;
     n_dec          = 0;
     n_pre          = 0;
     descu          = 0;
     tf             = 0;
     comi1          = 0;
     comi2          = 0;
     comi3          = 0;
     menor          = 0;
     pc1            = 0;
     pa             = 0;
     pa1            = 0;
     pa2            = 0;
     primera        = 0;
     cantidad       = 0;
     pc             = 0;
     pcs            = 0;
     pcv            = 0;
     pcd            = 0;
     modo           = 0;
     campo          = 0;
     nLineaD        = 0;
     nerror         = 0;
     nlinea         = 0;
     inkey      = 0;
     codiBarra  = "";
     ccomi          = 0;
     repr           = "";
     clie           = "";
     fami           = "";
     linea          = 0;
     usu            = "";
     fichero        = "";
     arti           = "";
     n              = 0;
     sped           = "";
     nped           = 0;
     pendser        = 0;
     pendrec        = 0;
     fecha          = "";
     nForma         = 0;
     unid           = 0;           || CONTINE LAS UND.DE LA LINEA DEL PED.
     feasig = @;
     nSali  = 0;
     aPedi = "";
     aSeri = "";
     aLine = "";
     nCan = 0;
     fede = "01.01.1900";
     feha = "31.12.2300";
     nSal = 0;
     sw_ay_c = 0;
     sw_no_a = 0;
     sw_vic = 0;
     SwAun  = 0;
     &qArti = "";
     &qUnid = 0;
     &eaProg = "";
     nNume = 0;
     nBtnEva1 = -1;
     nBtnEva2 = -1;
     aDesde = "";
     aHasta = "";

     aSer                = "";
     nNum                = 0;
     nLinOrg             = 0;
     nSwSanchez          = 0;
     j                   = 0;
|FIN;

|INCLUYE i_varart;

컴컴컴컴컴컴컴컴컴컴컴컴Modulo 004159컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO UltLinPedVta;
     |SALVA_FICHA #agifa073;
     aSer = #agifa073#28;
     nNum = #agifa073#0;
     #agifa073#1 = 999;
     |LEE 000#agifa073.];
     |SI FSalida = 0;
          |LEE 000#agifa073.a;
     |SINO;
          |LEE 000#agifa073.u;
     |FINSI;
     |SI FSalida = 0; |Y #agifa073#28 = aSer; |Y #agifa073#0 = nNum;
          nLin = #agifa073#1 + 1;
     |SINO;
          nLin = 1;
     |FINSI;
     |REPON_FICHA #agifa073;
|FPRC;

|PROCESO Sanchez73; |TIPO 6;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo ! 1; |ACABA; |FINSI;

     |HAZ EsSanchez;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |DDEF aDef;
     aDef = aDef + "sanch001";
     |CARGA_DEF aDef, sanch001@;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |ABRE #sanch001@;
     #sanch001@#0 = #agifa073#2;
     |LEE 000#sanch001@.=;
     |SI FSalida = 0;
          nLinOrg = 0;
          |PARA i = 13; |SI i [ 18; |HACIENDO i = i + 1;
               j = i + 6;
               |SI #sanch001@#i# ! 0;
                    |SI nLinOrg = 0;
                         nLinOrg = #agifa073#1;
                         #agifa073#6 = #sanch001@#i#;
                         #agifa073#38 = #sanch001@#i#;
                         #agifa073#14 = #sanch001@#j#;
                         #agifa073#50 = nLinOrg;
                         |HAZ totallip;

                         |GRABA 020#agifa073.n;
                    |SINO;
                         |HAZ UltLinPedVta;
                         #agifa073#1 = nLin;
                         #agifa073#3 = 0;
                         #agifa073#6 = #sanch001@#i#;
                         #agifa073#38 = #sanch001@#i#;
                         #agifa073#14 = #sanch001@#j#;
                         #agifa073#50 = nLinOrg;
                         |HAZ totallip;
                         |HAZ lpacarti;
                         |GRABA 020#agifa073.n;
                    |FINSI;
               |FINSI;
          |SIGUE;
          |SI nLinOrg ! 0;
               #agifa073#1 = nLinOrg;
               |LEE 121#agifa073.=;
          |FINSI;
          |PTEC 809;
          |PTEC 816;
          |PTEC 814;
          |PTEC 815;
          |PONCONTROL 23, "SI";
     |FINSI;
     |CIERRA #sanch001@;
     |DESCARGA_DEF #sanch001@;
|FPRC;

|PROCESO BajaSanchez;
     |SI nSwSanchez ! 0; |ACABA; |FINSI;
     nSwSanchez = 1;

     |DDEF aDef;
     aDef = aDef + "sanch001";
     |CARGA_DEF aDef, sanch001@;
     |SI FSalida ! 0; |ACABA; |FINSI;
     |ABRE #sanch001@;
     #sanch001@#0 = #agifa073#2;
     |LEE 000#sanch001@.=;
     |SI FSalida = 0;
          aSer = #agifa073#28;
          nNum = #agifa073#0;
          |PARA; |SI FSalida = 0; |Y #agifa073#3 = 0; |Y aSer = #agifa073#28; |Y nNum = #agifa073#0; |HACIENDO;
               |LEE 000#agifa073.a;
          |SIGUE;
          nLinOrg = #agifa073#1;
          |LEE 000#agifa073.s;
          |PARA; |SI FSalida = 0; #agifa073#3 = 0; |Y #agifa073#2 = #sanch001@#0;
                      |Y aSer = #agifa073#28; |Y nNum = #agifa073#0; |HACIENDO;
               |HAZ lpacarti;
               |BORRA 020#agifa073.a;
               |LEE 000#agifa073.s;
          |SIGUE;
          #agifa073#1 = nLinOrg;
          |LEE 121#agifa073.=;
          |PONCONTROL 23, "SI";
          |PTEC 808;
     |FINSI;
     |CIERRA #sanch001@
     |DESCARGA_DEF #sanch001@;
     nSwSanchez = 0;
|FPRC;

|PROCESO MiraSanchez;
     |SI nSwSanchez ! 0; |ACABA; |FINSI;

     |DDEF aDef;
     aDef = aDef + "sanch001";
     |CARGA_DEF aDef, sanch001@;
     |SI FSalida ! 0; |ACABA; |FINSI;
     |ABRE #sanch001@;
     #sanch001@#0 = #agifa073#2;
     |LEE 000#sanch001@.=;
     |SI FSalida = 0;
          nSwSanchez = 1;
     |FINSI;
     |CIERRA #sanch001@
     |DESCARGA_DEF #sanch001@;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴

|PROCESO Pendientes;
     nHayPen = #referen1@#5 - #referen1@#43;
     |SI nHayPen ! 0;
          aAlfa = ("000000" + #referen1@#0) % -106;
          aAlfa = "0000Pendiente Pedido: " + #referen1@#28 + "/" + aAlfa + " Unidades:" + nHayPen;
          |MENAV aAlfa;
     |FINSI;
|FPRC;

|DEFBUCLE Pendientes;
     #referen1@#3004;
     ;
     #0#2, "  ", 000000, #1#4;
     #0#2, "zz", 999999, #1#4;
     ;
     NULL, Pendientes;
|FIN;

|PROCESO MiraPend; |TIPO 0;
     |SI DescAmpli = "S";
          aTipoDA = "P";|HAZ DescriDA;
     |FINSI;

     |SI #16#147 = "S";
          |DDEF aDef;
          aDef = aDef + "agifa073";
          |CARGA_DEF aDef, referen1@;
          |SI FSalida = 0;
               |BUCLE Pendientes;
               |DESCARGA_DEF #referen1@;
          |FINSI;
     |FINSI;

     |HAZ EsMecanogra;
     |SI FSalida = 0;
          |HAZ MecaCheqArti;
          |SI FSalida = 0; |ERROR; |ACABA; |FINSI;
     |FINSI;

     |HAZ EsOrts;
     |SI FSalida = 0;
          eaDocu = "agifa073";
          eaSerie = #0#28;
          enCodigo = #0#0;
          enLinea = #0#1;
          |SUB_EJECUTA_NP "dsz99905;ENTRA";
     |FINSI;
|FPRC;

|PROCESO mirespor;|TIPO 0;
     |SI #6#28 = "S";|Y #0#14 ! 0;
          |MENAV mensa_exp; #0#14 = 0;|PINTA #0#14;
     |SINO;
          |SI #0#14 ! 0; |Y def_exp = "S";
               |MENSA mensa_exp; #0#14 = 0;|PINTA #0#14;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO MiraKit;
     eaArticulo = #agifa073#2;
     |HAZ EsKit;
     nEsKit = FSalida;
|FPRC;

|PROCESO lpinfo;|TIPO 0;
     |SI Campo = 5;
          |SI avisa_st = "S"; |O avisa_st = "X";
               |HAZ MiraKit;
               |SI nEsKit = 0;
                     |HAZ DispoKit;
                     |SI nDispoKit ! 0;
                         |MENAV "0000Superado Stock para KIT.";
                         |SI avisa_st = "X"; |ERROR;   |FINSI;
                     |FINSI;
               |SINO;
                    |HAZ EsTagloma;
                    |SI FSalida = 0;
                         |HAZ TagloAvisaSto73;
                    |SINO;
                         || la estandar
                         |SI #8#39 < #0#5;
                              |AVISO;
                              aAlfa = "0000Se supera el Stock Disponible: " + #8#39;
                              |MENAV aAlfa;

                              |HAZ EsCoimasa;
                              |SI FSalida = 0;
                                   |HAZ CoimaLisHisto;
                              |FINSI;

                              |SI avisa_st = "X"; |ERROR; |FINSI;
                         |FINSI;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
     |SI verpre ! "S";
          mensaje = "0000<F6> Equivalentes. Dispo. Almacen: " + #8#39+"  Minimo: "+#8#6;
          |MENSA mensaje;
     |SINO;
          |HAZ verpre2;
          mensaje = "0401Disponible.: [" + #8#39 + "] Min.: [" + #8#6 + "] PC.: [" + #2#133 + "] PMC.: [" + #2#9 + "] PVU.: [" + prevul+"]";
          mensaje = mensaje % 180;
          |MENSA mensaje;
     |FINSI;
     |SI #8#39 < #0#5; |Y #agifa142#218 = "S"; |Y Campo = 5;
          eaAuto = "S";
          |HAZ Equivalentes;
     |FINSI;
|FPRC;

|PROCESO lpdefec;|TIPO 0;
     nModo = (FEntrada / 100) ! 0;

     #0#16 = #1#7;  || #lin.pedidos#representante=#pedido#representante
     #0#17 = #1#16; || #lin.pedidos#tipo de comision=#pedidos#tipo de comision
     #0#20 = #1#4;  || #lin.pedidos#cliente=#pedidos#cliente
     |SI nModo = 1;
          #0#22 = #agifa142#227; || Reservar stock
          |PINTA #0#22;

          |HAZ EsCoimasa;
          |SI FSalida = 0;
               |HAZ CoimaParam;
               #0#22 = aRese; |PINTA #0#22;
          |FINSI;
     |FINSI;

     |SI #0#2 ! #2#0;
         |ABRE #2;
         #2#0 = #0#2;
         |LEE 000#2=;
         |CIERRA #2;
     |FINSI;
     |SI #0#20 ! #6#0;
     |ABRE #6;
     #6#0 = #0#20;
     |LEE 000#6=;
     |CIERRA #6;
     |FINSI;
     #0#18 = #2#2;
     #0#19 = #6#4;

     |HAZ PrecArt;
|FPRC;

|PROCESO MinAlma73;
     #8#0 = #0#2;
     #8#1 = 1;
|FPRC;

|PROCESO MaxAlma73;
     #8#0 = #0#2;
     #8#1 = 99999;
|FPRC;

|PROCESO Alma73_0; |TIPO 0;
     nModo = (FEntrada / 100) ! 0;

     |SI FSalida = 13; || F5;
          |ABRE #8;
          #8#0 = #0#2;
          #8#1 = #0#3;
          |LEE 000#8];
          |CONSULTA_F_CLAVE #1#8, MinAlma73, MaxAlma73;
          |SI FSalida = 0;
               #0#3 = #8#1; |PINTA #0#3;
          |SINO;
               |ERROR; |ACABA;
          |FINSI;
          |CIERRA #8;
     |FINSI;
     |HAZ lpdefec;
     |HAZ lpinfo;
     |HAZ mirespor;
     |HAZ CamposModi;

     eaCliente = #1#4;
     efFecha = #1#1;
     Contenido = articulo;
     eaDes = #0#4;            || Para el modulo 004379 (Berria)
     |HAZ SacaKit;
     |SI eaModiKit = "S";     || Se ha mdoificado el kit
          |HAZ EsTagloma;     || Precio Kit (dsz99986)
          |SI FSalida = 0;
               #0#6 = enPreKitCal;
               |HAZ precio_divisa;
          |FINSI;
     |FINSI;

     |HAZ EsBerria;
     |SI FSalida = 0;
          eaArticulo = #0#2;
          |HAZ EsKit;
          |SI FSalida = 0;
               #0#4 = eaDes; |PINTA #0#4;
               #0#5 = 1; |PINTA #0#5;
               |SI nModo = 1; |HAZ PrecArt; |FINSI;
          |FINSI;
     |FINSI;

     |SI nModo = 1;
          |HAZ EsMecanogra;
          |SI FSalida = 0;
               eaArticulo = #0#2;
               eaFicMeca = "mc" + Usuario;
               |SUB_EJECUTA_NP "mecaw001";
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Tipo0_73;|TIPO 0; ||Aunque parezca mentira sirve... je je je
     nModo = (FEntrada / 100) ! 0;
     articulo = #0#2;
     eaArtiAntes = #0#2;
     enAlmaAntes = #0#3;
     |SI nModo = 1;
          #0#13 = #1#2; ||F.Entrega
          |PINTA #0#13;
     |FINSI;
     |HAZ EsSematel;
     |SI FSalida = 0; |Y #0#43 ! 0;
          |MENAV "0000La linea tiene unidades servidas...";
          |ERROR;
     |FINSI;
|FPRC;

|PROCESO CalcuComi;
     enDescuento1 = #0#8;
     enDescuento2 = #0#29;
     eaTComision  = #0#17;
     eaCliente    = #1#4;
     eaRepre      = #1#7;
     eaArticulo   = #0#2;
     efFecha      = #1#1;
     eaSerie      = #0#28;
     enDirEnt     = #1#57;
     enAlmacen    = #0#3;
     |SI #0#36 ! 0; uni_dt = #0#36; |SINO; uni_dt = #0#5; |FINSI;
     |HAZ Comisiones;
     ||컴컴컴컴컴컴컴횺arhuenda
     enUniMarhu = #0#5;
     |HAZ ComiMarhu;
     #0#8 = enDescuento1;
     #0#10 = enComision;
     |HAZ ComiOrts73;
|FPRC;

|PROCESO PrecArt;
     |SI pedido_o ! 0; |ACABA; |FINSI; || viene de la copia de pedido (F4)

     modo = (FEntrada / 100) ! 0;
     #0#20 = #1#4;
     fed_dt = #1#1;   || Fecha....
     art_dt = #0#2;   || Articulo.
     cli_dt = #0#20;  || Cliente..
     fam_dt = #0#18;  || Familia.
     iva_dt = #2#30;  || Tipo Iva.
     dtos_2 = 0;      || Descuento 2.
     dto_pt = 0;      || Descuento Ptas.
     dtos_1 = 0;      || Descuento 1.
     pvp_ve = 0;      || Precio Venta.
     tarifa = #6#39;  || Tarifa Cliente....
     gru_dt = #6#158; || Grupo Cliente.
     |SI #0#36 ! 0;
           uni_dt = #0#36;
     |SINO;
           uni_dt = #0#5;
     |FINSI;
     uni_dt2 = #0#44;
     nPromo = #1#56;
     enMensaje = 0;
     aParam = "";
     eaSerie = #0#28;
     enDirEnt = #1#57;
     |SI #2#176 = "S";  enMensaje = 1;  |FINSI;
     enAlmacen = #0#3;
     |SI modo = 1; |O articulo ! #0#2;
          enInterno = tarifa;
          |HAZ calcdtos;    || Calculo Dtos.....
          |SI eaCliArtDiviSN = "S";
               |SI eaCliArtDivi ! #1#35;
                    aAlfa = "0000La divisa del documento ("+ #1#35 + ") no se corresponde con la oferta (" + eaCliArtDivi + ").";
                    |MENAV aAlfa;
                    |PTEC 807;     || Ctrl+C
               |SINO;
                    pvp_ve = pvp_ve * #1#41 / #1#36; ||Cam.Base * Cambio
               |FINSI;
          |FINSI;
          eaCliArtDiviSN = "N";

          |SI #0#53 = 9;
               || El modulo Tagloma marca este campo con 9
          |SINO;
               #0#53 = enInterno;
          |FINSI;
          #0#6 = pvp_ve - dto_pt;  || Precio Venta. sin iva.
          #0#8 = dtos_1;  || 1 Dto.
          #0#29 = dtos_2;  || 2 Dto.
          |HAZ precio_divisa;
          |PINTA #0#29;
          |PINTA #0#8;

          |HAZ CalcuComi;

          #0#6 = pvp_ve - dto_pt;  || Precio Venta. sin iva.
          #0#6 = #0#6 + enIncPreBerria;
          |SI eaEvaInc = "S";
               #0#6 = #0#6 + enEvaImp;
               |SI enEvaPor ! 0;
                    #0#6 = #0#6 + (#0#6 * enEvaPor / 100);
               |FINSI;
          |FINSI;

          |HAZ EsTagloma;     || Precio Kit (dsz99986)
          |SI FSalida = 0;
               eaArticulo = #0#2;
               |HAZ EsKit;
               |SI FSalida = 0;
                    #0#6 = enPreKitCal;
               |FINSI;
          |FINSI;
          |HAZ precio_divisa;
          ||컴컴컴컴컴컴컴컴컴컴컴컴
          |PINTA #0#8;
          |PINTA #0#10;
     |FINSI;
|FPRC;

|PROCESO lpcomis;|TIPO 0;
     |SI #0Campo ! Contenido;
         enDescuento1 = #0#8;
         enDescuento2 = #0#29;
         eaTComision  = #0#17;
         eaCliente    = #1#4;
         eaRepre      = #1#7;
         eaArticulo   = #0#2;
         efFecha      = #1#1;
         eaSerie      = #0#28;
         enDirEnt = #1#57;
         enAlmacen = #0#3;
         |HAZ Comisiones;
         ||컴컴컴컴컴컴컴횺arhuenda
         enUniMarhu = #0#5;
         |HAZ ComiMarhu;
         ||컴컴컴컴컴컴컴컴컴컴컴컴
         #0#10 = enComision;
         |HAZ ComiOrts73;
         |PINTA #0#10;
     |FINSI;
|FPRC;

|PROCESO unidades; |TIPO 6;
     nTecla = FSalida;
     nModo = (FEntrada / 100) ! 0;
     |HAZ Promart;
     |SI nTecla = 13;
          enTipEnvase = 1;
          |HAZ Envase73;
     |FINSI;
     |SI nTecla = 14;             ||F6
          eaAuto = "N";
          |HAZ Equivalentes;
          |ERROR;
          |ACABA;
     |FINSI;

     |HAZ EsCongecar;
     |SI FSalida = 0; |Y nModo = 2;
          enInterno = #0#53;
          |HAZ ModiTariCongecar;
          |SI #0#53 ! enInterno;
               #0#53 = enInterno;
               #0#6 = pvp_ve;
               |HAZ precio_divisa;
          |FINSI;
     |FINSI;
     |HAZ EsFergalsan;
     |SI FSalida = 0;
          |HAZ FergaKgLee;
          |SI nError ! 0; |ERROR; |ACABA; |FINSI;
     |FINSI;

     |HAZ lpinfo;
     #0#5 = #0#5 ! n_dec;
     |PINTA #0#5;
     |SI #0#5 ] 0;
          qArti = #0#2;
          qUnid = #0#5;
          |HAZ ComproMin;
          |SI enErr ! 0;
               |ERROR;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO totallip;|TIPO 0;
     #0#42 = #0#5;
     #0#48 = #0#44;
     |HAZ TotalLin73;
|FPRC;

|PROCESO lpacarti; |TIPO 2;
     modo = (FEntrada / 100) ! 0;
     nForma = 0 +. 1;
     articulo = #0#2;
     |SI nFlag ! 0; nFlag = 0; |ERROR; |ACABA; |FINSI;

     |HAZ EsTagloma; nSwTagloma = FSalida;
     |HAZ EsMecanogra; nSwMecanogra = FSalida;
     |HAZ EsTaller; nSwTaller = FSalida;
     |HAZ EsAparecida; nSwAparecida = FSalida;
     |HAZ EsCoimasa; nSwCoimasa = FSalida;
     |HAZ EsFergalsan; nSwFergalsan = FSalida;

     |SI modo = 3; |Y #0#43 ! 0;
          |SI nForma = -1;
               |MENAV "0000Linea pedido con unidades servidas...";
          |FINSI;
          |ERROR; |ACABA;
     |FINSI;
     |SI nSwTaller = 0;
          |SI #0#55 = -1; |Y enModo104 ! 3;
               |SI nForma = -1;
                    |MENAV "0000Linea canon de articulo, no se puede modificar";
               |FINSI;
               |ERROR; |ACABA;
          |FINSI;
     |FINSI;
     |SI nSwAparecida = 0;
          |SI #0#55 = -1; |Y enModo104 ! 3;
               |SI nForma = -1;
                    |MENAV "0000Linea auto-descarga, no se puede modificar";
               |FINSI;
               |ERROR; |ACABA;
          |FINSI;
     |FINSI;

     |SI nSwTagloma = 0;
          |HAZ TagEsLinPost;
          |SI FSalida = 0; |Y enModo104 ! 3;
               |SI nForma = -1;
                    |MENAV "0000Linea de incremento de postformado, no se puede modificar...";
               |FINSI;
               |ERROR; |ACABA;
          |FINSI;
     |FINSI;

     |SI nSwFergalsan = 0;
          |SI enModo104 ! 3;
               |HAZ FergaKgLee;
               |SI nError ! 0; |ERROR; |ACABA; |FINSI;
          |FINSI;
          |HAZ FergaKgGraba;
     |FINSI;

     |SI nSwMecanogra = 0; |Y enModo104 ! 3;
          |HAZ MecaTipoLin;
          |SI nMecaOrd ! 0;
               |SI nForma = -1;
                    |MENAV "0000Linea Ordenada, no se puede modificar";
               |FINSI;
               |ERROR; |ACABA;
          |FINSI;
          |SI nMecaMaestra ! 0; |Y modo = 3;
               |SI nForma = -1;
                    |MENAV "0000Linea automatica, no se puede borrar";
               |FINSI;
               |ERROR; |ACABA;
          |FINSI;
     |FINSI;

     |SI #0#55 = -1; |Y enModo104 ! 3;
          |SI nForma = -1;
               |MENAV "0000Linea de Promocion, no se puede modificar...";
          |FINSI;
          |ERROR; |ACABA;
     |FINSI;

     |ABRE #2; #2#0 = #0#2; |LEE 000#2=; |CIERRA #2;

     |SI #0#12 ! 0;|O #0#43 ! 0;|O #0#47 ! 0;|O #0#49 ! 0;
          |SI #0#43 = 0; |Y #0#49 = 0;
               #0#12 = 0;
               #0#47 = 0;
          |SINO;
               |SI #2#180 = "S"; |O #2#179 = "S";
                 ||si tiene dobleuni o partida no dejo modificar
                 ||se tendria que cambiar el calculo de la entrada
                 ||del doble stock (mas abajo comparo lo mismo)
                    |MENAV "      No se permite modificar o dar de baja la Ficha.";
                    |ERROR;
                    |ACABA;
               |SINO;
                    ||no deja modificar si tiene variacion
                    |SI #0#12 ! 0; |O #0#47 ! 0;
                         |MENAV "      No se permite modificar o dar de baja la Ficha.";
                         |ERROR;
                         |ACABA;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;

     |SI modo = 2; |O modo = 3;
          |SI #0#30 ! ""; |Y #0#30 ! "      ";
               |ATRI P;
               |MENAV "0000LA LINEA TIENE RESERVA EN PEDIDO DE COMPRAS";
               |ATRI p;
               |ERROR; |ACABA;
          |FINSI;

          |HAZ EsDefelino;
          |SI FSalida = 0;
               |HAZ DefelinoFabLin;
               |SI nError ! 0; |ERROR; |ACABA; |FINSI;
               |SI modo = 3; |HAZ DefelinoBorra; |FINSI;
          |FINSI;
     |FINSI;

     desc_art = #0#2;
     |QBF desc_art;
     |SI #0#43 = #0#5; |Y #0#49 = #0#44;
               |Y desc_art ! ""; |Y modo = 2;  |Y #0#5 ! 0; |Y nForma = -1;
          ||si tiene dobleuni o partida no dejo modificar
          ||se tendria que cambiar el calculo de la entrada
          ||del doble stock
          |SI #2#180 = "S"; |O #2#179 = "S";
               |MENAV "0000Linea servida por completo";
               |ERROR;
               nFlag = 1;
               |ACABA;
          |FINSI;
     |FINSI;

     |SI campo < 3;
         |HAZ lpdefec;
     |FINSI;

     |SI nForma = 1;
          |HAZ Riesgos73;
          |SI enErrRie = 1; |ERROR; |ACABA; |FINSI;
     |FINSI;

     || Si es Reservado
     |SI #0#22 = "S";  ||(7)
         eaTipo      = "PV";
         eaSerie     = #0#28;
         enCodigo    = #0#0;
         enLinea     = #0#1;
         eaAbono     = #1#34;
         eaReservado = "S";
         enTarifa    = #6#39;
         enAlmacen    = #0#3;
         eaArticulo   = #0#2;
         enUnidades   = #0#5 * nForma;
         enCamBas     = #1#36;
         eaMoneda     = #1#37;
         enCamDiv     = #1#41;
         |SUB_EJECUTA_NP "dsz00002;RESE";
     |FINSI;

     |HAZ EsSanchez;
     |SI FSalida = 0;
          |SI modo = 3;
               |HAZ BajaSanchez;
          |FINSI;
          |SI modo = 2;
               |HAZ MiraSanchez;
               |SI nSwSanchez ! 0;
                    nSwSanchez = 0;
                    |SI nForma = - 1;
                         |MENAV "0000Modificacion no permitida, de debaja la linea...";
                    |FINSI;
                    |ERROR; |ACABA;
               |FINSI;
          |FINSI;
     |FINSI;

     |HAZ EsEvaristo;
     |SI FSalida = 0;
          |SI modo = 3; |O nForma = 1;
               enModo = modo;
               eaEvaTalla = "N";
               |HAZ EvaPideResto;
               #0#5 = enUnidades;
               |HAZ totallip;
          |FINSI;
     |FINSI;

     ||컴컴컴컴컴컴컴컴횫ctualiza  Articulo y Almacen
     enForma = 0 +. 1;
     |HAZ AcumulaPV;
     enTipEnvase = 2;
     |HAZ Envase73;

     #1#11 = #1#11 +. #0#9;
     #1#12 = #1#12 +. #0#9;
     #1#13 = #1#11 - #1#12;

     #1#42 = #1#42 +. #0#39;
     #1#43 = #1#43 +. #0#39;
     #1#44 = #1#42 - #1#43;
     #1#63 = #1#63 +. #0#54;

     |SI nForma = 1; |HAZ visual_totales; |FINSI;

     |SI modo = 1; |O modo = 2;
          |SI nForma  = 1;             || Act. Precio Cli. Art.
               #0#20 = #1#4;
               cli_dt = #0#20;
               art_dt = #0#2;
               pvp_ve = #0#6;
               dtos_1 = #0#8;
               aParam = "grapre";
               enDirEnt = #1#57;
               enAlmacen = #0#3;
               enInterno = #0#53;
               eaSerie = #0#28;
               enCodigo = #0#0;
               enLinea = #0#1;
               eaModuloPre = "agifa073";
               |HAZ calcdtos;
               #0#53 = enInterno;

               |SI nSwCoimasa = 0;
                    eaSerie = #0#28;
                    enDocu = #0#0;
                    enLinea = #0#1;
                    eaCliente = #1#4;
                    |SUB_EJECUTA_NP "coima007;ALTA";
               |FINSI;
          |FINSI;
     |FINSI;

     |HAZ EsQDClor;
     |SI FSalida = 0;
          eaSerie = #0#28;
          enCodigo = #0#0;
          enLinea = #0#1;
          eaArticulo = #0#2;
          |SUB_EJECUTA_NP "qdclor06;ACT";
     |FINSI;

     |SI modo = 3;
          |HAZ EsOrts;
          |SI FSalida = 0;
               eaDocu = "agifa073";
               eaSerie = #0#28;
               enCodigo = #0#0;
               enLinea = #0#1;
               |SUB_EJECUTA_NP "dsz99905;BORRA";
          |FINSI;
          |SI nSwTagloma = 0;
               eaProg = "agifa104";
               |HAZ BorUniFami;
               |HAZ BorTagloMerma73;
          |FINSI;
          |SI nSwMecanogra = 0;
               |SI enModo104 ! 3;
                    |HAZ MecaBorraLin;
               |SINO;
                    |HAZ MecaReservaStock;
               |FINSI;
               eaSerie = #0#28;
               enCodigo = #0#0;
               enLinea = #0#1;
               |SUB_EJECUTA_NP "mecam006;BAJA";
          |FINSI;
          |HAZ EsVigor;
          |SI FSalida = 0;
               eaSerie = #0#28;
               enCodigo = #0#0;
               enLinea = #0#1;
               |SUB_EJECUTA_NP "vigm0040;BAJA";
          |FINSI;
          |SI nSwCoimasa = 0;
               eaSerie = #0#28;
               enDocu = #0#0;
               enLinea = #0#1;
               |SUB_EJECUTA_NP "coima007;BAJA";
          |FINSI;
          |HAZ EsSematel;
          |SI FSalida = 0;
               enModo = 3;
               eaArticulo = #0#2;
               eaSerie = #0#28;
               enCodigo = #0#0;
               enLinea = #0#1;
               efFecha = #1#1;
               eaCliente = #1#4;
               eaRepre = #1#7;
               enAlmacen = #0#3;
               |SUB_EJECUTA_NP "tlfw0004";
          |FINSI;
          |HAZ EsQDClor;
          |SI FSalida = 0;
               eaSerie = #0#28;
               enCodigo = #0#0;
               enLinea = #0#1;
               |SUB_EJECUTA_NP "qdclor06;BAJA";
          |FINSI;
          |HAZ EsBerria;
          |SI FSalida = 0;
               aAlfa = "berm0008;B" + #0#28 + (("000000" + #0#0)%-106) + (("000" + #0#1) % -103);
               |SUB_EJECUTA_NP aAlfa;
          |FINSI;
          |HAZ EsOrts;
          |SI FSalida = 0;
               eaTipo = "P";
               eaSerie = #0#28;
               enCodigo = #0#0;
               enLinea = #0#1;
               |SUB_EJECUTA_NP "ortsm022;BAJA";
          |FINSI;
          ||컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
          aTipoDA = "P"; |HAZ BajaDA;

          |HAZ BorraKit;

          eaTipo      = "PV";
          eaSerie     = #0#28;
          enCodigo    = #0#0;
          enLinea     = #0#1;
          eaAbono     = #1#34;
          eaReservado = "N";
          enTarifa    = #6#39;
          enAlmacen   = #0#3;    || (7)
          eaArticulo  = #0#2;
          |SUB_EJECUTA_NP "dsz00002;BAJA";
     |FINSI;

     |SI #16#250 ! "N";
          |SI nForma = 1;
               ||SI #0#58 > 0;
               |SI #0#58 ! 0;
                    aponer = Asino; |HAZ poncontr;
                    |HAZ CreaLinPromo73;
                    #0#55 = nLin;
                    aponer = Anosi; |HAZ poncontr;
                    |PTEC 809; |PTEC 816; |PTEC 806;
               |SINO;
                    |HAZ BorraLinPromo73;
               |FINSI;
          |SINO;
               |SI modo = 3; |Y enModo104 ! 3;
                    |HAZ BorraLinPromo73;
                    |PTEC 809; |PTEC 808;
               |FINSI;
          |FINSI;
     |FINSI;

     |SI nSwCoimasa = 0;
          enModoCoimasa = nModo;
          enFormaCoimasa = nForma;
          |HAZ CtrlPrioridaReservarPed;
     |FINSI;

     |SI nSwTagloma = 0; |HAZ TagLinPost; |FINSI;

     |SI nSwMecanogra = 0;
          |SI modo = 1; |HAZ MecaCreaLin; |FINSI;
          |SI enModo104 ! 3; |HAZ MecaReservaStock; |FINSI;
          |SI modo ! 3; |HAZ MecaAceptaPro; |FINSI;
          |SI modo = 3;
               |HAZ MecaBajaPaquete;
          |FINSI;
     |FINSI;

     |HAZ EsVigor;
     |SI FSalida = 0;
          |HAZ VigorHisto;
          |HAZ VigorViajes;
          nTotUni = nTotUni +. #0#5;
          aAlfa = #0#5;
          #0#5 = nTotUni;
          |PINTA 902, "Tot. Uni: ";
          |PINTA 912, #0#5;
          #0#5 = aAlfa;
     |FINSI;
     |SI nSwTaller = 0; |HAZ TallerCanon73; |FINSI;
     |SI nSwAparecida = 0; |HAZ Aparecida73; |FINSI;
     |HAZ EsDesanch;
     |SI FSalida = 0; |HAZ ActDesanch73; |FINSI;
/* lo pongo mas arriba
     |HAZ EsEvaristo;
     |SI FSalida = 0;
          |SI modo = 3; |O nForma = 1;
               enModo = modo;
               eaEvaTalla = "N";
               |HAZ EvaPideResto;
               #0#5 = enUnidades;
               |HAZ totallip;
          |FINSI;
     |FINSI;
*/
     |HAZ EsChampiEmar;
     |SI FSalida = 0;
          |SI modo = 1; |HAZ ChampiEmarEnv; |FINSI;
          |SI modo = 3; |HAZ ChampiEmarBor; |FINSI;
     |FINSI;
|FPRC;

|PROCESO CreaLinPromo73;
     |DDEF aAlfa; aAlfa = aAlfa + "agifa073";
     |CARGA_DEF aAlfa, referen1@;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |ABRE #referen1@;
     #referen1@#28 = #0#28;
     #referen1@#0 = #0#0;
     #referen1@#1 = #0#55;
     |LEE 000#referen1@.=;
     |SI FSalida = 0;
          nLin = #0#55;
          |SALVA_DATOS #0;
          |SALVA_DATOS #referen1@;
          |REPON_DATOS #0;
          #0#1 = #referen1@#1;
          enForma = -1;
          |HAZ AcumulaPV;
          |REPON_DATOS #0;
     |SINO;
          #referen1@#1 = 999;
          |LEE 000#referen1@.];
          |SI FSalida = 0;
               |LEE 000#referen1@.a;
          |SINO;
               |LEE 000#referen1@.u;
          |FINSI;
          |SI FSalida = 0; |Y #referen1@#28 = #0#28;  |Y #referen1@#0 = #0#0;
               nLin = #referen1@#1 + 1;
          |SINO;
               nLin = 1;
          |FINSI;
          |SI nLin = #0#1; nLin = nLin + 1; |FINSI;
          #referen1@#28 = #0#28;
          #referen1@#0 = #0#0;
          #referen1@#1 = nLin;
          |GRABA 020#referen1@.b;
     |FINSI;
     ||SI #0#58 > 0;
     |SI #0#58 ! 0;
          |SALVA_DATOS #0;
          |REPON_DATOS #referen1@;

          #referen1@#1 = nLin;
          #referen1@#5 = #0#58;
          #referen1@#6 = 0;
          #referen1@#7 = 0;
          #referen1@#8 = 0;
          #referen1@#9 = 0;
          #referen1@#11 = 0;
          #referen1@#12 = 0;
          #referen1@#40 = 0;
          #referen1@#41 = 0;
          #referen1@#42 = #0#58;
          #referen1@#43 = 0;
          #referen1@#55 = -1;

          |SALVA_DATOS #0;
          |SALVA_DATOS #referen1@;
          |REPON_DATOS #0;
          #0#1 = #referen1@#1;
          enForma = 1;
          |HAZ AcumulaPV;
          |REPON_DATOS #0;

          |GRABA 020#referen1@.a;
     |SINO;
          |BORRA 020#referen1@.c;
     |FINSI;
     |CIERRA #referen1@;
     |DESCARGA_DEF #referen1@;
|FPRC;

|PROCESO BorraLinPromo73;
     |DDEF aAlfa; aAlfa = aAlfa + "agifa073";
     |CARGA_DEF aAlfa, referen1@;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |ABRE #referen1@;
     #referen1@#28 = #0#28;
     #referen1@#0 = #0#0;
     #referen1@#1 = #0#55;
     |LEE 101#referen1@.=;
     |SI FSalida = 0;
          |SALVA_DATOS #0;
          |SALVA_DATOS #referen1@;
          |REPON_DATOS #0;
          #0#1 = #referen1@#1;
          enForma = -1;
          |HAZ AcumulaPV;
          |REPON_DATOS #0;
          |BORRA 020#referen1@.a;
          |PONCONTROL 23, "SI";
     |FINSI;
     |CIERRA #referen1@;
     |DESCARGA_DEF #referen1@;
|FPRC;

|PROCESO cabeped;|TIPO 13;
     |HAZ visual_totales;
|FPRC;

|PROCESO TeclaPrecio; |TIPO 6;
     |SI nSw_Dentro = 1; |ACABA; |FINSI; || Para que no se cuelgue !!!
     nSw_Dentro = 1;
     campo = Campo;
     inkey = FSalida;
     |SI inkey = 12;          || F4
          |SI Campo = 6; |O Campo = 38;
               |C_V #0#9, 0, aAlfa;
               |SI aAlfa = "S";
                    nCamp1 = 9; nCamp2 = 6;
                    |C_M #0#9, 1, "S"; |ENCAMPO #9#0; |C_M #0#9, 1, "N";
               |FINSI;
               |C_V #0#39,0, aAlfa;
               |SI aAlfa = "S";
                    nCamp1 = 39; nCamp2 = 38;
                    |C_M #0#39, 1, "S"; |ENCAMPO #39#0; |C_M #0#39, 1, "N";
               |FINSI;
               |SI FSalida = 0;
                         || nCamp1 -> importe
                         || nCamp2 -> precio
                         || nCamp3 -> unidades
                    |SI eaIVAsn = "S";
                         #0nCamp1 = #0nCamp1 / (1+(enIva/100))
                    |FINSI;
                    |SI #2#194 = 2;
                         nCamp3 = 44;   || unidades doble stock S/N
                    |SINO;
                         nCamp3 = 5;
                    |FINSI;
                    |SI #0nCamp3 = 0;        || unidades cero
                         #0nCamp3 = #0nCamp1 / #0nCamp2;
                         |HAZ unidades;
                    |FINSI;
                    |SI #0nCamp2 = 0;        || precio cero
                         #0nCamp2 = #0nCamp1 / #0nCamp3;
                         |PINTA #0nCamp2;
                    |FINSI;
               |SINO;
                    |AVISO; |ERROR;
               |FINSI;
          |FINSI;
     |FINSI;
     |SI inkey = 13;   ||F5
          |HAZ EsAparecida;
          |SI FSalida = 0;
               enPrecio = #0Campo;
               eaArticulo = #0#2;
               eaCliente = #1#4;
               |SUB_EJECUTA_NP "aparm010";
               #0Campo = enPrecio; |PINTA #0Campo;
               nSw_Dentro = 0;
               |ERROR; |ACABA;
          |FINSI;

          modo = (FEntrada / 100) ! 0;
          |SI modo = 4;
               |ABRE #6;
               #6#0 = #1#4;
               |LEE 001#6=;
               |SI FSalida ! 0; |DDEFECTO #6; |FINSI;
               |CIERRA #6;
          |FINSI;
          |PUSHV 0501 2380;
          ext1 = #6#16;
          |SUB_EJECUTA_NP "caextrap.run";
          |POPV;
     |FINSI;
     |SI inkey = 14;
          c_clien = #1#4;
          c_artic = #0#2;
          c_serie = #0#28;
          entrada = 1;
          |SUB_EJECUTA_NP "agifa283.run";
          inkey = 0;
          |ERROR;
     |FINSI;
     |SI inkey = 15;
          eaCli = "";
          enTiva = #0#14;
          efFiva = #1#1;
          |HAZ IVACli;
          #0#6 = #0#6 / (1 + enIva/100);
          |HAZ visual_precio;
     |FINSI;

     |SI inkey = 17;     || F9
          |HAZ EsTagloma;
          |SI FSalida = 0;
               eaDocu = "PV";
               eaSerie = #0#28;
               enCodigo = #0#0;
               enLinea = #0#1;
               eaDes = #0#4;
               |SUB_EJECUTA_NP "tagm0058";
               #0#4 = eaDes; |PINTA #0#4;
          |FINSI;
     |FINSI;

     |SI inkey = 11; || F3
          |HAZ EsRocai;
          |SI FSalida = 0;
               enPrecio = #0#6;
               enComision = #0#10;
               eaCliente = #1#4;
               eaArticulo = #0#2;
               |SUB_EJECUTA_NP "rocaiz01";
               #0#10 = enComision; |PINTA #0#10;
               #0#6 = enPrecio; |PINTA #0#6;
          |FINSI;
     |FINSI;

     nSw_Dentro = 0;
|FPRC;

|PROCESO leeotro; |TIPO 11;
     modo = (FEntrada / 100) ! 0;
     inkey  = FSalida;
     salida = FSalida;
     |HAZ PintaMedidaV;
     |SI inkey = 10;     ||F2
          |HAZ MenuTrack73;
          |SI FSalida = 0; |ERROR; |ACABA; |FINSI;
          inkey = FSalida;
     |FINSI;
     |SI inkey = 9;          || A cuenta
          |SI #agifa142#86 ! "N";
             |SI #agifa142#86 = "S"; |HAZ a_cta1; |FINSI;
          |SINO;
             |MENAV "    Entregas a cuenta desactivadas"; |ERROR;
          |FINSI;
     |FINSI;
     |SI inkey = 11;          || Estado
          ser_ped = #0#28;
          num_ped = #0#0;
          lin_ped = #0#1;
          |SUB_EJECUTA_NP "dsy00002";
          |ERROR;
          |ACABA;
     |FINSI;
     |SI inkey = 12;
          |HAZ EsDefelino;
          |SI FSalida = 0
               |HAZ DefelinoSurti; |ERROR; |ACABA;
          |FINSI;

          || Copia (estandar)
          |HAZ Recoge;
     |FINSI;
     |SI inkey = 13; ||F5
          |HAZ EsOrts;
          |SI FSalida = 0;
               eaDocu = "agifa073";
               eaSerie = #0#28;
               enCodigo = #0#0;
               enLinea = #0#1;
               |SUB_EJECUTA_NP "dsz99905;VER";
          |FINSI;

          |HAZ VerKit;
          |HAZ VerDobleUniV;

          |HAZ EsSematel;
          |SI FSalida = 0;
               enModo = 4;
               eaArticulo = #0#2;
               eaSerie = #0#28;
               enCodigo = #0#0;
               enLinea = #0#1;
               efFecha = #1#1;
               eaCliente = #1#4;
               eaRepre = #1#7;
               enAlmacen = #0#3;
               |SUB_EJECUTA_NP "tlfw0004";
          |FINSI;
          |HAZ EsEvaristo;
          |SI FSalida = 0;
               |HAZ EvaTallas;
          |FINSI;
          |ERROR; |ACABA;
     |FINSI;
     |SI inkey = 15;          || Cabecera
          |PUSHV 501 2380;
              |PINPA #0#1;
              |PINDA #0#1;
              |PAUSA;
          |POPV;
          |ERROR;
     |FINSI;
     |SI inkey = 14; |Y modo ! 1;          || Precios
          c_clien = #1#4;
          c_artic = #0#2;
          c_serie = #0#28;
          entrada = 1;
          |SUB_EJECUTA_NP "agifa283.run";
          inkey = 0;
          |ERROR;
     |FINSI;
     aAlfa = #0#2; |QBF aAlfa;
     |SI inkey = 16; |Y aAlfa ! ""; |Y DescAmpli = "S";
          aTipoDA = "P"; |HAZ VerDA;
          |ERROR;
     |FINSI;
     |SI inkey = 17;          || Texto
          |HAZ tx;
     |FINSI;
     |SI inkey = 18;                  || Extrato
          alfa = "dsw00007;" + #1#4;
          |SUB_EJECUTA_NP alfa;
          |ERROR;
     |FINSI;
     |SI inkey = 25; || Ctrl-F7
          |HAZ CreaTempo;
          eaFichero = Tempo;
          |SUB_EJECUTA_NP "psion066";
          |HAZ BoraTempo;
          |SI enError = 0; |HAZ ImportaPDA73; |FINSI;
          |ERROR; |ACABA;
     |FINSI;
     |SI inkey = 27; || Ctrl-F9
          |HAZ EsVigor;
          |SI FSalida = 0;
               |HAZ CreaTempo;
               eaFichero = Tempo;
               eaCliente = #1#4;
               |SUB_EJECUTA_NP "vigz0031"
               |SI enError = 0; |HAZ VigoCreaLin; |FINSI;
               |HAZ BoraTempo;
          |FINSI;
          |HAZ EsMecanogra;
          |SI FSalida = 0;
               |HAZ MecaMarcaAcepta;
          |FINSI;
          |ERROR; |ACABA;
     |FINSI;
     |SI inkey = 20; |O inkey = 21;  |O inkey = 24;    || Mecanograficas
          |HAZ EsMecanogra;
          |SI FSalida = 0;
               |SI inkey = 20; |HAZ MecaMarcaAcepta; |FINSI;
               |SI inkey = 21; |HAZ MecaPaquetes; |FINSI;
               |SI inkey = 24; |HAZ MecaFinaliza; |FINSI;
               |ERROR; |ACABA;
          |FINSI;
     |FINSI;
     |SI inkey = 20;
          |HAZ EsVigor;
          |SI FSalida = 0;
               |SI modo = 4;
                    |MENAV "0000Opcion invalida en consulta";
               |SINO;
                    |HAZ VigorObserva;
               |FINSI;
               |ERROR; |ACABA;
          |FINSI;
          |HAZ EsEvaristo;
          |SI FSalida = 0;
               |HAZ EvaTallas;
               |ERROR; |ACABA;
          |FINSI;
          |HAZ ConsultaAlba;  ||La estandar
          |ERROR; |ACABA;
     |FINSI;
     |SI inkey = 21;
          |HAZ EsEvaristo;
          |SI FSalida = 0;
               |HAZ EvaSitua;
               |ERROR; |ACABA;
          |FINSI;
     |FINSI;
     |SI inkey = 33; || SHIFT + F5
          |ABRE #2; #2#0 = #0#2; |LEE 020#2=; |CIERRA #2;
          |SI #2#176 = "S";
               eaTipo      = "PV";
               eaSerie     = #0#28;
               enCodigo    = #0#0;
               enLinea     = #0#1;
               eaArticulo  = #0#2;
               enAlmacen   = #0#3;
               enUnidades  = #0#5;
               enTBruto    = #0#7;
               eaAbono     = #1#34;
               eaReservado = #0#22;
               enTarifa    = #6#39;
               efFecha     = #1#1;
               eaCliente   = #1#4;
               enCamBas     = #1#36;
               eaMoneda     = #1#37;
               enCamDiv     = #1#41;
               enComision = #0#10;
               |SUB_EJECUTA_NP "dsz00002;CONSU";
          |FINSI;
          |ERROR;
     |FINSI;

     |HAZ EvaFinBoton;
|FPRC;

|PROCESO Recoge;
     |SI inkey = 12; |Y recoge ="N"; ||F4
          |PUSHV 0400 0479;
          |MENAV "0000Opcion no activada en Parametros Generales";
          |POPV;
          |ERROR;
          |ACABA;
     |FINSI;
     || compruebo que este en la ultima linea y en modo alta
     nLineaD = #0#1;    || Guardo puntero
     nLineaD = nLineaD +1;     || Porque si estoy en alta la linea en la que
                               || estoy todavia no esta grabada
     |LEE 001#0];

     |SI FSalida ! 0;|O #0#0 ! #1#0;
                      |O #0#28 ! #1#25;|Y modo = 1;

          nLineaD = nLineaD -1;

          || Recupero el puntero
          #0#0  = #1#0;    || pedido
          #0#28 = #1#25;   || Serie
          #0#1  = nLineaD;        || Numero de linea
          |LEE 001#0=;

          nerror = 0;
          |SI inkey = 12;
               |HAZ entradatos;
          |FINSI;
          |SI nerror = 0 ;
               |SI inkey = 12; ||F4
                    |HAZ leelineas;
               |FINSI;
               |HAZ control2;
               |PTEC 816;
               |PTEC 812;
          |SINO;
               |ERROR;
          |FINSI;
     |SINO;
          || Recupero el puntero
          nLineaD = nLineaD -1;
          #0#0  = #1#0;     || pedido
          #0#28 = #1#25;    || Serie
          #0#1  = nLineaD;         || Numero de linea
          |LEE 001#0=;

          |MENAV "0000Debe estar en la ultima linea";
          |ERROR;
     |FINSI;    || Si #0#1 = 1 ...
|FPRC;

|PROCESO entradatos;
     |PINTA 2420 , " Recogida de datos del pedido  :   /    ";
     alfa1 = "";
     E_sup = 5;
     E_inf = "";
     alfa1 = 2453 ? 1;
     serie_o = alfa1;
     alfa2 = "";
     E_sup = 999999;
     E_inf = 000000;
     alfa2 = 2459 ? 1;
     pedido_o = alfa2;
     |BLIN 24;
     || No puedo leer en el que estoy sino se embuclaria
     |SI  serie_o = #1#25;|Y pedido_o = #1#0;
         |MENAV "0000ATENCION !!! Esta en este pedido";
         nerror = 1;
     |FINSI;
|FPRC;

|PROCESO control1;
   aponer= Asino;
   |HAZ poncontr;
|FPRC;

|PROCESO control2;
   aponer= Anosi;
   |HAZ poncontr;
|FPRC;

|PROCESO poncontr;
     fiac = Control % A109;
     fiac = fiac + relleno;
     guarda = fiac % A109;
     fiac = Control % A1001;
     Control = Control + fiac;
     Control = Control + relleno;
     Control = Control % A120;
     Control = Control + aponer;
|FPRC;

|PROCESO dsm00046Kit;
     #946#0 = #0#28;
     #946#1 = #0#0;
     #946#2 = #0#1;
     |GRABA 020#946n;
|FPRC;

|DEFBUCLE dsm00046Kit;
     #946#1;
     ;
     serie, pedido, nlinea, 001;
     serie, pedido, nlinea, 999;
     ;
     NULL, dsm00046Kit;
|FIN;

|PROCESO CreaComponente;
     #905#0 = "PV";
     #905#1 = #0#28;
     #905#2 = #0#0;
     #905#3 = #0#1;
     #905#7 = #0#6;
     #905#6 = #905#11;
     #905#8 = #905#6 * #905#7;
     #905#9 = 0;
     #905#12 = 0;
     |GRABA 020#905n;
     |LIBERA #905;

     enUnidades = #905#6;

     eaTipo       = "PV";
     eaArticulo   = #0#2;
     enAlmacen    = #0#3;
     eaComponente = #905#4;
     eaReservado  = "N";
     enCamBas     = #1#36;
     eaMoneda     = #1#37;
     enCamDiv     = #1#41;
     |SUB_EJECUTA_NP "dsz00002;PVC";
|FPRC;

|DEFBUCLE dsm00005;
     #905#1;
     ;
     "PV", serie, pedido, nlinea, "      ";
     "PV", serie, pedido, nlinea, "zzzzzz";
     be;
     NULL, CreaComponente;
|FIN;

|PROCESO crealineasV;
    || Clave primaria
    #0#28= #1#25;    || Serie
    #0#0 = #1#0;     || Numero de Pedido
    #0#1 = nLineaD;  || Numero de linea

    |BUCLE dsm00046Kit; || Kit

    |DEFECTO #0#1;   || Cargo los valores de defecto de cab.pedido

    || Procedo a cambiar lo que no es igual
    |HAZ lpdefec;                  || Este proceso carga los defectos, ya que
                                   || estos no estan puestos en D000.....
                                   || porque no iba bien.
    #0#15 = "N";            || Bloqueado = N
    #0#21 = "";             || Numero
    #0#22 = "N";            || Reservado
    #0#5 = #0#42;
    #0#12 = 0;
    #0#30 = "";
    #0#31 = "";
    #0#32 = 0;
    #0#37 = 0;
    #0#43 = 0;
    #0#44 = #0#48;
    #0#47 = 0;
    #0#49 = 0;
    nPrecio = #0#6;

    |HAZ totallip;     || Calculo total linea
    |HAZ lpacarti;     || Lo envio al t ipo 2 para que calcule lo mismo que si fuera
                       || una linea introducida por el operador
    #0#6 = nPrecio;
    |GRABA 021#0b;
    |LIBERA #0;

    |BUCLE dsm00005;

    nLineaD = nLineaD + 1;  || Aumento contador de lineas
|FPRC;


|PROCESO leelineas;
      #0#28= serie_o;
      #0#0 = pedido_o;
      #0#1 = 1;
      |LEE 001#0];
      |SI FSalida =0;
           |PARA;|SI FSalida =0;|Y #0#28=serie_o;|Y #0#0=pedido_o;
                                                     |HACIENDO;
                  || Me guardo el puntero
                  serie   = #0#28;   || Serie y pedido actual
                  pedido  = #0#0;
                  nlinea  = #0#1;

                  |HAZ crealineasV;

                  || Recupero puntero
                  #0#28 = serie;
                  #0#0  = pedido;
                  #0#1  = nlinea;
                  |LEE 001#0=;

                  |LEE 001#0s;
           |SIGUE;
      |SINO;
           |MENAV "0000Atencion !!! No se ha encontrado el pedido indicado";
           |ERROR;
      |FINSI;

      pedido_o = 0;

      || Devuelvo el puntero de la linea
      #0#28= #1#25;       || Serie
      #0#0 = #1#0;        || pedido
      #0#1 = nLineaD;     || Linea
      |LEE 001#0=;
|FPRC;

|PROCESO LeeParam073;
     |ABRE #16; |LEE 000#16p; |CIERRA #16;

     avisa_st  = #16#35;
     n_dec     = #16#8;
     n_pre     = #16#9;
     recoge    = #16#38;
     DescAmpli = #16#197;     || Descargar descripcion ampliada
     |SI DescAmpli = "N";
          DescAmpli = #16#40;
     |FINSI;
     codiBarra = #16#53;     || Codigo Barras
     verpre    = #16#101;       || Ver Precio

     |ABRE #17;
     #17#26 = #1#25;
     |LEE 001#17=;
     |SI FSalida ! 0; |DDEFECTO #17; |FINSI;
     |CIERRA #17;
     def_alm = #17#29;
     def_exp = #17#30;
|FPRC;

|| Se miran los parametros generales en la linea para evitar variables
|| externas que dan problemas

|PROCESO tipo773; |TIPO 7;
     |ABRE #279; |LEE 000#279p; |CIERRA #279;
     nPreDtoAnt = 0;

     nModo = (FEntrada / 100) ! 0;
     |HAZ PintaMedidaV;
     |HAZ LinDiv;
     |HAZ LeeParam073;
     |SI nModo = 1;
          #0#1 = #0#1 + #agifa142#236 - 1;
     |FINSI;
     |HAZ PintaDes73;

     |HAZ EsInforAlba;
     |SI FSalida = 0;
          |ATRI O; |PINTA 1002, "Matri.:"; |ATRI I;
          |C_V #0#45, 1, "S";
          |PINTA 1009, #0#45;
     |FINSI;
     |HAZ EsEvaristo;
     |SI FSalida = 0;
          |SI Campo = 1; |HAZ EvaIniBoton; |SINO; |HAZ EvaFinBoton; |FINSI;
     |FINSI;
     |HAZ EsQDClor;
     |SI FSalida = 0;
          |HAZ QDClorPin73;
     |FINSI;
     |HAZ EsAlbero;
     |SI FSalida = 0;
          |HAZ AlbePedPintaLV;
     |FINSI;
     |HAZ EsMecanogra;
     |SI FSalida = 0;
          |HAZ MecanoPin73;
     |FINSI;
     |HAZ EsVigor;
     |SI FSalida = 0;
          |HAZ VigorPin73;
     |FINSI;
     |HAZ EsCoimasa;
     |SI FSalida = 0;
          |HAZ CoimaPin73;
     |FINSI;
     |HAZ EsInforpor;
     |SI FSalida = 0;
          |ATRI R; |PINTA 943, "쿛romocion      "; |ATRI 0;
          |PINTA 1043, "               ";
          |C_V #0#45, 1, "S"; |PINTA #0#45;
     |FINSI;
     |HAZ EsChampiEmar;
     |SI FSalida = 0;
          eaTipo      = "PV";
          eaSerie     = #0#28;
          enCodigo    = #0#0;
          enLinea     = #0#1;
          |HAZ ChampiPinEmar;
          nNume = #0#41;
          #0#41 = #0#41 / ((100-(#1#5+#1#17+#1#6))/100); |PINTA #0#41;
          #0#41 = nNume;
     |FINSI;
     |HAZ EsOrts;
     |SI FSalida = 0;
          |HAZ OrtsPin073;
     |FINSI;
|FPRC;

|PROCESO tipo3073; |TIPO 3;
     aAlfa = #0#2; |QBF aAlfa;
     |SI aAlfa ! ""; |Y DescAmpli = "S";
          aTipoDA = "P"; |HAZ AltaDA;
     |FINSI;

     nModo = (FEntrada/ 100) ! 0;
     |SI nModo = 1;
          |HAZ EsDesanch;
          |SI FSalida = 0;
               |HAZ Desan073;
          |FINSI;
     |FINSI;

     |SI nModo = 2; |Y nUniOrg ! #0#5;
          enSwPrimiPDA = 1;
     |FINSI;

     |SI nModo = 1;
          |HAZ EsCoimasa;
          |SI FSalida = 0;    || F.Calculo Aprox. Servicio
               eaArticulo = #0#2;
               enAlmacen = #0#3;
               efFecha = #1#62;
               |SI #0#13 > efFecha; efFecha = #0#13; |FINSI;
               eaSerie = #0#28;
               enCodigo = #0#0;
               enLinea  = #0#1;
               enUnidades = #0#5;
               |SUB_EJECUTA_NP "coimz021";
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO a_cta1;
     |SI #agifa104#45 = 0; |ERROR; |ACABA; |FINSI;
     |GRABA 020#agifa104.a; |SALVA_FICHA #agifa104;
     TipoCta = "P";

     Cliente = #1#4;
     SPedido = #1#25;
     NPedido = #1#0;
     FPedido = #1#1;
     PPedido = #1#9;
     BAdela = 0;
     |SUB_EJECUTA_NP "agis0002";
     |BLIN 24;
     |CONFI "2400NDesea imprimir el recibo? ";
     |SI FSalida = 0;
          ser = SPedido;
          doc = NPedido;
          eaDivisa = #1#35;
          |HAZ ImpreACta;
     |FINSI;
     |REPON_FICHA #agifa104;
     |ERROR;
|FPRC;

________________________/ TEXTO LINEAS.......................................
|RUTINA min34;
     #80#0 = #0#28;
     #80#1 = #0#0;
     #80#2 = #0#1;
     #80#3 = 1;
|FRUT;

|RUTINA max34;
     #80#0 = #0#28;
     #80#1 = #0#0;
     #80#2 = #0#1;
     #80#3 = 200;
|FRUT;




____________/ MODIFICADO EL 07-07-99
____________/ CONTROL DE RESERVAS SEGUN LA FECHA DE ENTREGA DE LAS LINEAS DE
____________/ LOS PEDIDOS DE VENTAS, Y DE LAS FECHAS DE RECEPCION DE LOS
____________/ PEDIDOS DE COMPRAS.

|PROCESO asigna;
  |SI #90#13 ! 0;
      sw_no_a = 1;
      nCan = #90#13 - #0#5;
      |SI nCan ] 0;
          |SI #0#13 < #90#10; |O #0#13 = "31.12.9999";
               #0#13 = #90#10;
          |SINO;
              |ABRE #99;
              #99#0 = #0#28;
              #99#1 = #0#0;
              #99#2 = #0#1;
              #99#3 = #0#2;
              |LEE 101#99=;
              nSali = FSalida;
              #99#4 = #90#10;
              |SI nSali ! 0; |GRABA 020#99n; |FINSI;
              |SI nSali = 0; |GRABA 020#99a; |FINSI;
              |LIBERA #99;
              |CIERRA #99;
           |FINSI;
          |GRABA 000#0n;
          |ERROR10;
          SwAun = 0;
      |SINO;
          |SALVA_DATOS #0;
          TUnidad = #0#5;
          TEnvase = #0#36;
          n       = #0#5 - #90#13;   || UNIDADES RESTANTES.
          #0#5    = #90#13;          || UNIDADES DISPONIBLES EN FECHA.
          #0#42   = #90#13;          || UNIDADES PEDIDAS
          #0#36   = (#90#13 * TEnvase) / TUnidad;
          |SI #0#13 < #90#10; |O #0#13 = "31.12.9999";
              #0#13 = #90#10;
          |SINO;
              |ABRE #99;
              #99#0 = #0#28;
              #99#1 = #0#0;
              #99#2 = #0#1;
              #99#3 = #0#2;
              |LEE 101#99=;
              nSali = FSalida;
              #99#4 = #90#10;
              |SI nSali ! 0; |GRABA 020#99n; |FINSI;
              |SI nSali = 0; |GRABA 020#99a; |FINSI;
              |LIBERA #99;
              |CIERRA #99;
           |FINSI;
          |HAZ TotalLin73;
          |GRABA 000#0n;

          #90#13 = 0;
          |GRABA 021#90a;
          |LIBERA #90;

          sped = #0#28;
          nped = #0#0;
          |HAZ busca_ultima;
          |REPON_DATOS #0;

          #0#1  = linea;
          #0#5  = n;
          #0#42 = n;
          #0#36 = (n * TEnvase) / TUnidad;
          #0#13 = "31.12.9999";
          |HAZ TotalLin73;
          SwAun = 1;
      |FINSI;
  |FINSI;
|FPRC;

|DEFBUCLE lee_resto;
  #90#1;
  ;
  #0#2,fede;
  #0#2,feha;
  ;
  NULL,asigna;
|FIN;

|PROCESO imprime;
     #90#13 = #90#13 - #0#5;            || PTE.RECIB. - (PTE.SER - UND.LIN)
     |GRABA 021#90a;
     |LIBERA #90;
|FPRC;

|DEFBUCLE lee_temporal;
     #90#1;
     ;
     #0#2,feasig;
     #0#2,feasig;
     ;
     NULL,imprime;
|FIN;

|PROCESO graba_ventas;
  |SI  arti  ! #0#2; |O aPedi  ! #0#0; |O aSeri ! #0#28; |O aLine ! #0#1;
       |ABRE #99;
       #99#0 = #0#28;
       #99#1 = #0#0;
       #99#2 = #0#1;
       #99#3 = #0#2;
       |LEE 041#99=;
       |SI FSalida ! 0;
           feasig = #0#13;
       |SINO;
           feasig = #99#4;
       |FINSI;
       |CIERRA #99;
       |BUCLE lee_temporal;
  |FINSI;
|FPRC;

|DEFBUCLE lee_ventas;
     #0#1;
     2,13;
     "  ",000000,001,arti,fede;
     "zz",999999,999,arti,feha;
     ;
     NULL,graba_ventas;
|FIN;


_______________________/ LEE Y RELLENA EL TEMPORAL CON LOS PEDIDOS DE VENTAS.
|PROCESO graba_compras;
     #90#7   = #91#2;
     #90#10  = #91#13;
     |LEE 141#90=;
     nSal = FSalida;
     |SI FSalida ! 0;
          #90#13 = 0;    || UNIDADES PENDIENTES DE RECIBIR.
     |FINSI;
          #90#13 = #90#13 + (#91#5 - #91#38);     || UNIDADES PENDIENTES DE RECIBIR.
     |SI nSal = 0; |GRABA 021#90a; |FINSI;
     |SI nSal ! 0; |GRABA 021#90n; |FINSI;
     sw_ay_c = 1;
     |LIBERA #90;
|FPRC;

|DEFBUCLE lee_compras;
     #91#1;
     2;
     "  ",000000,001,arti;
     "zz",999999,999,arti;
     ;
     NULL,graba_compras;
|FIN;

|PROCESO reserva;
     |SI Campo ! 13; |ACABA; |FINSI;

     unid = #0#5;
     modo = (FEntrada / 100) ! 0;

      || LEE LOS PEDIDOS DE COMPRAS Y VENTAS, Y RELLENA EL TEMPORAL.
     |SI #16#69 = "S"; |Y #0#5 > 0;
          |HAZ CreaTempo; aTempo90 = Tempo;
          |NOME_DAT #90 aTempo90; |DELINDEX #90;
          |SELECT #1#90;
          |ABRET #90;
          arti  = #0#2;            || Articulo.
          fecha = #0#13;           || Fecha Entrega.
          aPedi = #0#0;            || Pedido.
          aSeri = #0#28;           || Serie.
          aLine = #0#1;            || Linea.
          sw_ay_c = 0;
          sw_no_a = 0;
          |SALVA_DATOS #0;
          |BUCLE lee_compras;
          |SI sw_ay_c = 0;
               |REPON_DATOS #0;
               #0#13 = "31.12.9999";
          |SINO;
               |BUCLE lee_ventas;
               |REPON_DATOS #0;
               SwAun = 0;
               |BUCLE lee_resto;
               |SI SwAun = 1;
                   |GRABA 000#0n;
                   sw_no_a = 1;
               |FINSI;
               |SI sw_no_a = 0;
                    #0#13 = "31.12.9999";
                    |GRABA 000#0a;
               |FINSI;
          |FINSI;
          |PINTA #0#13;
          |CIERRAT #90;
          |DELINDEX #90; Tempo = aTempo90; |HAZ BoraTempo;
          |SI sw_ay_c ! 0;
               aponer = "kksi";
               |HAZ poncontr;
               Pos = -1;
               |PTEC 809;
               |PTEC 809;
               |PTEC 808;
          |FINSI;
     |FINSI;
|FPRC;

||*****************************************************************
||*****************************************************************
||*****************************************************************
||*****************************************************************

|PROCESO busca_ultima;
     #0#28 = sped;
     #0#0  = nped;
     #0#1  = 999;
     |LEE 000#0];
     |SI FSalida = 0;
          |LEE 000#0a;
     |SINO;
          |LEE 000#0u;
     |FINSI;
     |SI FSalida = 0; |Y #0#28 = sped; |Y #0#0 = nped;
          linea = #0#1 + 1;
     |SINO;
          linea = 1;
     |FINSI;
|FPRC;

|PROCESO Envase73;
     qAbono    = "N";
     Envase    = #0#35;
     Unidades1 = #0#36;
     VArticulo = #0#2;
     Unidades2 = #0#5;
     enAlmacen = #0#3;
     eaTipo = "V";
     eaProgEnv = "pedido";
     |HAZ EntraEnvase;
     #0#35 = Envase;
     #0#36 = Unidades1;
     #0#5  = Unidades2;  |PINTA #0#5;
|FPRC;

|PROCESO Conversion; |TIPO 7;
     nModo = (FEntrada / 100) ! 0;
     |SI #16#250 = "S";
          |HAZ PrecArt;
          eaDocu = "PV";
          eaSerie = #0#28;
          enCodigo = #0#0;
          enLinea = #0#1;
          eaArticulo = #0#2;
          eaCli = #1#4;
          enModo = (FEntrada / 100) ! 0;
          enDto = #0#8;
          enPrecio = #0#6;
          enUnid1 = #0#5;
          enUnid2 = #0#58;
          enUnid3 = #0#36;
          Envase = #0#35;
          enImpDtoPromo = #0#56;
          enDtoPrePromo = #0#57;
          eaDivisa = #1#35;
          |SUB_EJECUTA_NP "dsz00080";
          |SI enError ! 0; |ERROR; |ACABA; |FINSI;
          #0#8 = enDto;
          #0#6 = enPrecio;
          #0#5 = enUnid1;
          #0#58 = enUnid2;
          #0#36 = enUnid3;
          #0#35 = Envase;
          #0#56 = enImpDtoPromo;
          #0#57 = enDtoPrePromo;
          |SI eaProCliArt = "S"; |C_M #0#5, 1, "N"; |FINSI;
     |FINSI;

     |HAZ EsMecanogra;
     |SI FSalida = 0;
          |SI nModo = 2; |C_M #0#5, 1, "N"; |ACABA; |FINSI;
     |FINSI;

     |HAZ EsSematel;
     |SI FSalida = 0;
          enModo = (FEntrada / 100) ! 0;
          eaArticulo = #0#2;
          eaSerie = #0#28;
          enCodigo = #0#0;
          enLinea = #0#1;
          efFecha = #1#1;
          eaCliente = #1#4;
          eaNomCli = #1#8;
          eaRepre = #1#7;
          enAlmacen = #0#3;
          |SUB_EJECUTA_NP "tlfw0004";
          |SI eaHayIMEI = "S";
               #0#5 = 1; |PINTA #0#5;
               |C_M #0#5, 1, "N";
               |ACABA;
          |FINSI;
     |FINSI;

     |HAZ EsChampiEmar;
     |SI FSalida = 0;
          eaTipo = "PV";
          eaSerie = #0#28;
          enCodigo = #0#0;
          enLinea = #0#1;
          eaArticulo = #0#2;
          |SI nModo = 1;
               aAlfa = "champi09;" + eaTmpPV816;
               |SUB_EJECUTA_NP aAlfa;
          |SINO;
               |SUB_EJECUTA_NP "champi03";
          |FINSI;
          |HAZ ChampiPinEmar;
          #0#5 = enUnidades;
          |C_M #0#5, 1, "N";
     |FINSI;

     nUni1Ant = #0#5; nUni2Ant = #0#44;

     |HAZ DobleUniV;
     |SI eaSw2Stock = "S";
          |C_M #0#5, 1, "N";
     |FINSI;

     |SI #16#250 = "X";
          |SI #16#68 = "S";
               |C_M #0#5, 1, "N";
          |SINO;
               |ABRE #134;
               #134#0 = #1#4;
               #134#1 = #0#2;
               |LEE 000#134=;
               |SI FSalida = 0; |C_M #0#5, 1, "N"; |FINSI;
               |CIERRA #134;
          |FINSI;
     |FINSI;

     |HAZ EsGestral;
     |SI FSalida = 0;
          |SI nUni1Ant ! #0#5; |O nUni2Ant ! #0#44;
               articulo = "";
               |HAZ PrecArt;
               articulo = #0#2;
          |FINSI;
     |FINSI;

     |SI #agifa142#72 = "S";
          |HAZ Envase73;
          |C_M #0#5, 1, "S";
          |SI enEntraEnvase ! 0;
               |C_M #0#5, 1, "N";
          |FINSI;
     |FINSI;

     |HAZ EsVigor;
     |SI FSalida = 0;
          eaSerie = #0#28;
          enCodigo = #0#0;
          enLinea = #0#1;
          |SUB_EJECUTA_NP "vigm0040";
          |HAZ VigorPin73;
     |FINSI;
|FPRC;

|PROCESO prec;
     |SI Campo = 6; |O Campo = 38;
          |C_M #0Campo, 0, aAlfa;
          |SI #16#250 = "X"; |Y aAlfa = "S";
               eaDocu = "PV";
               eaSerie = #0#28;
               enCodigo = #0#0;
               enLinea = #0#1;
               eaArticulo = #0#2;
               eaCli = #1#4;
               enModo = (FEntrada / 100) ! 0;
               enDto = #0#8;
               enPrecio = #0#6;
               enUnid1 = #0#5;
               enUnid2 = #0#58;
               enUnid3 = #0#36;
               Envase = #0#35;
               enImpDtoPromo = #0#56;
               enDtoPrePromo = #0#57;
               eaDivisa = #1#35;
               |SUB_EJECUTA_NP "dsz00080";
               |SI enError ! 0; |ERROR; |ACABA; |FINSI;
               #0#8 = enDto;
               #0#6 = enPrecio;
               #0#5 = enUnid1;
               #0#58 = enUnid2;
               #0#36 = enUnid3;
               #0#35 = Envase;
               #0#56 = enImpDtoPromo;
               #0#57 = enDtoPrePromo;
          |FINSI;
     |FINSI;

     |SI #2#176 = "S";
          |SI #1#37 = "D";  || Si la moneda de trabajo es la divisa ...
               #0#38 = nPrecio;
          |SINO;
               #0#6  = nPrecio;
          |FINSI;

          |HAZ EsRocai;
          |SI FSalida = 0; #0#10 = nComiRocai; |PINTA #0#10; |FINSI;
     |FINSI;


     |SI #1#37 = "D";  || Si la moneda de trabajo es la divisa ...
          #0#6 = #0#38 / #1#36 * #1#41;  || ... recalculo en funcion de la divisa
     |SINO;
          #0#38 = #0#6 / #1#41 * #1#36; || .. recalculo en funcion de la moneda base
     |FINSI;

     |HAZ visual_precio; || Visualiza el precio
|FPRC;

|PROCESO LinDiv;  |TIPO 7;
     nUniOrg = #0#5;

     |ABRE #agifa321;
     |LEE 001#agifa321.p;  || Leo parametros de divisa
     |CIERRA #agifa321;

     |SI ac_divisa ! "S";
          |ATRI R;
          |PINTA 1447, "Precio";
          |PINTA 1470, "I.Total";
          |ATRI r;
     |SINO;
          |SI pintado = 0; || Si divisas estan activadas y no he pintado ...
               |SI #1#37 = "D";   || Si la moneda de trabajo es la divisa la pinto en
                    |ATRI R;         || el encabezado del precio y el importe
                    titdiv = "Precio" + "(" + #1#35 + ")";
                    |PINTA 1444,titdiv;
                    titdiv = "I.Tot." + "(" + #1#35 + ")";
                    |PINTA 1468,titdiv;
                    |ATRI r;
               |SINO;
                    |ATRI R;
                    |PINTA 1447, "Precio";
                    |PINTA 1470, "I.Total";
                    |ATRI r;
               |FINSI;

               |HAZ EsChampiEmar
               |SI FSalida = 0;
                    |HAZ PinTotaChampiEmar
                    |ACABA;
               |FINSI;

               |SI #agifa321#3 = "S";  || Si la visualizacion esta activada ...
                    ||mensa = "Precio:            Imp.:                                                      ";
                    |||PINTA 1102,mensa;  || ... pinto la linea de visualizacion
                    |PINTA 1102, "Precio:";
                    |PINTA 1121, "Imp.:";
                    |PINTA #0#40; || Pinto precio visual
                    |PINTA #0#41; || Pinto importe visual
                    |SI #1#37 = "D"; || Si la moneda de trabajo es la divisa
                         #1#45 = #1#42;
                         #1#46 = #1#43;
                         #1#47 = #1#44;
                         #1#48 = #1#11;
                         #1#49 = #1#12;
                         #1#50 = #1#13;
                         |PINTA 1144,#1#49;
                         |PINTA 1156,#1#50;
                         |PINTA 1168,#1#48;
                    |SINO;
                         #1#45 = #1#11;
                         #1#46 = #1#12;
                         #1#47 = #1#13;
                         #1#48 = #1#42;
                         #1#49 = #1#43;
                         #1#50 = #1#44;
                         |PINTA 1144,#1#43;
                         |PINTA 1156,#1#44;
                         |PINTA 1168,#1#42;
                    |FINSI;
                    pintado = 1;  || Ya hemos pintado
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO upc_div;
 |SI #1#37 = "B"; || Si la moneda de trabajo es la moneda base ...
   #0#38 = #0#6 / #1#41 * #1#36;  || Calculo el precio en divisa
 |SINO;
   |SI #1#35 = #2#165; |O #2#165 = "   "; || Si la divisa del U.P.C. coincide con la actual o esta vacia
     #0#38 = #2#163;  || Asigno el U.P.C en divisa
     #0#6 = #0#38 / #1#36 *  #1#41; || Recalculo el precio en moneda base
   |SINO;
     |MENAV "0000La divisa de trabajo no coincide con la divisa del U.P.C";
     #0#38  = #2#28 / #1#41 * #1#36;  || recalculo el precio en divisa en funcion del U.P.C en moneda base
   |FINSI;
 |FINSI;
 |HAZ visual_precio;
|FPRC;


|PROCESO visual_precio; || Pinta el precio visual.
|SI #1#37 = "D";  || Si la moneda de trabajo es la divisa ...
  #0#40 = #0#6;   || ... el campo visualiz. es el precio en moneda base
  |PINTA #0#38;
|SINO;            || Si la moneda de trabajo es la moneda base ...
  #0#40 = #0#38;  || ... el campo visual. es el precio en divisa
  |PINTA #0#6;
|FINSI;
|SI ac_divisa = "S"; |Y #agifa321#3= "S";
  |PINTA #0#40; || Si las divisas y la visualizacion estan activadas, pinto
|FINSI;
|FPRC;

|PROCESO visual_totales;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 3; |ACABA; |FINSI;

     |ABRE #agifa321; |LEE 001#agifa321.p; |CIERRA #agifa321;

     |HAZ EsChampiEmar;
     |SI FSalida = 0;
          |HAZ PinTotaChampiEmar;
          |ACABA;
     |FINSI;

     |MODULO aProg;                             || enProg211 = 211 cuando viene
     |SI aProg = "agifa104"; |O enProg211 = 211;|| de Adj.Pedio (F10)
          |SI #1#37 = "D";
               #1#45 = #1#42;
               #1#46 = #1#43;
               #1#47 = #1#44;
               #1#48 = #1#11;
               #1#49 = #1#12;
               #1#50 = #1#13;
               |SI ac_divisa = "S"; |Y #agifa321#3= "S";
                    |PINTA 1144,#1#49;
                    |PINTA 1156,#1#50;
                    |PINTA 1168,#1#48;
               |FINSI;
               |CIERRA #agifa321;
               |PINTA 1344,#1#43;
               |PINTA 1356,#1#44;
               |PINTA 1368,#1#42;
          |SINO;
               #1#45 = #1#11;
               #1#46 = #1#12;
               #1#47 = #1#13;
               #1#48 = #1#42;
               #1#49 = #1#43;
               #1#50 = #1#44;
               |SI ac_divisa = "S"; |Y #agifa321#3= "S";
                    |PINTA 1144,#1#43;
                    |PINTA 1156,#1#44;
                    |PINTA 1168,#1#42;
               |FINSI;
               |PINTA 1344,#1#12;
               |PINTA 1356,#1#13;
               |PINTA 1368,#1#11;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO precio_divisa;
   #0#38 = #0#6 / #1#41 * #1#36;  || Calculo el precio en divisa
   |HAZ prec;
|FPRC;

|PROCESO Promart;
     |SI #16#250 ! "N"; |Y eaProCliArt = "S";
          articulo = #0#2;
          |ACABA;
     |FINSI;

     |SI nTecla = 16;
          eaArticulo = #0#2;
          eaGrupo = #6#158;
          enAlmacen = #0#3;
          eaCliente = #1#4;
          |HAZ PintaPromo;
          |ENCAMPO #5#0;
     |FINSI;
     enPromo = 1;
     |HAZ PrecArt;
     enPromo = 0;
     ||컴컴컴컴컴컴컴컴컴컴컴컴컴
     articulo = #0#2;
|FPRC;


|| LLAMADAS DESDE EL CAMPO DEL ARTICULO

|PROCESO CogeValores73;  |TIPO 7;
     nModo = (FEntrada / 100) ! 0;
     |SI Campo = 6;
          aAlfa = "0000<F4>Importe Total <F5>Ext.Contable <F6>Consulta Precios <F7>Cal.Prec. s/IVA";
          |HAZ EsTagloma;
          |SI FSalida = 0;
               aAlfa = "0000<F4>Imp.Total<F5>Ext.Cont.<F6>Cons.Prec.<F7>Cal.Prec.s/IVA<F9>Cal.Postform.";
          |FINSI;
          |HAZ EsAparecida;
          |SI FSalida = 0;
               aAlfa = "0000<F4>Importe Total <F5>Tarifas <F6>Consulta Precios <F7>Cal.Prec. s/IVA";
          |FINSI;
          |HAZ EsRocai;
          |SI FSalida = 0;
               aAlfa = "0000<F3>Tarifas <F4>Imp.Total <F5>Ext.Contable <F6>Con. Precios <F7>Cal.Prec. s/IVA";
          |FINSI;
          |MENSA aAlfa;
     |FINSI;

     |HAZ EsFergalsan;
     |SI FSalida = 0;
          aAlfa = #0#2; |QBF aAlfa;
          |ABRE #2;
          #2#0 = #0#2;
          |LEE 000#2=;
          |SI FSalida ! 0; |O aAlfa = "";
               |PTEC 807;
          |SINO;
               |SI Campo < 5;
                    enModo = nModo;
                    aAlfa = "fergaz07;" + #0#2;
                    |SUB_EJECUTA_NP aAlfa;
                    #0#4 = eaDes; |PINTA #0#4;
                    #0#5 = enUnidades; |PINTA #0#5;
                    #0#42 = #0#5;
                    |ABRE #480;
                    #480#0 = #0#2;
                    |LEE 000#480=;
                    |SI FSalida ! 0; |PTEC 807; |FINSI;
                    |CIERRA #480;
               |FINSI;
          |FINSI;
          |CIERRA #2;
     |FINSI;

     |ABRE #16;
     |LEE 001#16p;
     |SI FSalida ! 0; |DDEFECTO #16; |FINSI;
     |CIERRA #16;

     aAlfa = #0#2; |QBF aAlfa;
     |SI Campo = 3; |Y aAlfa ! ""; || Modi. Tiq:  00897.0002 Cliente: 003218
          |C_M #0#3, 0, aAlfa;     || solo si es modificable
          |SI aAlfa = "S";
              |SI #16#99 = "S";
                    |C_M #0#3, 1, "N";
                    #0#3 = 1;  |PINTA #0Campo;
              |FINSI;
          |FINSI;
     |FINSI;

     |SI #2#176 = "N";  |ACABA;  |FINSI;

     |SI Campo = 3;
         |SI enAlmacen ! 0;
             #0#3 = enAlmacen;  |PINTA #0#3;
         |FINSI;
     |FINSI;

     |SI Campo = 5;
         |SI #2#176 = "S";
             |SI #0#5 ! enUnidades;  Contenido = #0#5;  |FINSI;
             #0#5 = enUnidades;  |PINTA #0#5;
         |FINSI;
     |FINSI;

     |SI Campo = 6;
         |SI nPrecio ! 0;
             #0#6 = nPrecio;  |PINTA #0#6;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO art6pdv; |TIPO 6;         || Antes de la Relacion 4 Clave.
     r_arti = "";                  || LIMPIA LA VARIABLE DEL ARTICULO AUTOMATICO.
     |SI codiBarra = "N"; |ACABA; |FINSI;

     |ABRE #36;
     |SELECT #2#36;
     #36#3 = #0#2;
     |LEE 010#36=;
     |SI FSalida=0; |Y #0#2 ! #36#1;
         #0#2 = #36#1;
         |PINTA #0#2;
     |FINSI;
     |CIERRA #36;
|FPRC;

|PROCESO tx;
     |ABRET #80;
     |PUSHV 0501 2380;
     |PINPA #0#80;
     |PARA ind = 1; |SI ind [ 200; |HACIENDO ind = ind + 1;
           #80#0 = #0#28;
           #80#1 = #0#0;
           #80#2 = #0#1;
           #80#3 = ind;
           |LEE 141#80=;
           |SI FSalida ! 0;
                #80#4 = "";
                |GRABA 021#80n;
           |FINSI;
           |LIBERA #80;
      |SIGUE;
      |MENSA "0000< ESC > SALIR.";
      |ENTLINEAL #1#80,1,4,21,1,min34,max34;
      |PARA ind = 200; |SI ind ] 1; |HACIENDO ind = ind - 1;
           #80#0 = #0#28;
           #80#1 = #0#0;
           #80#2 = #0#1;
           #80#3 = ind;
           |LEE 141#80=;
           |SI FSalida = 0;
                alfa = #80#4;
                |QBF alfa;
                |SI alfa ! ""; |SAL; |FINSI;
                |BORRA 021#80a;
           |FINSI;
           |LIBERA #80;
      |SIGUE;
      |POPV;
      |CIERRAT #80;
      |ERROR;
|FPRC;

|PROCESO nomodif2; |TIPO 0;
     |QBF r_arti;
     |SI r_arti ! "";
          #0#2 = r_arti;
          |PINTA #0#2;
     |FINSI;
     modo = (FEntrada / 100) ! 0;
     |SI modo = 1; #0#3 = def_alm; |PINTA #0#3; |FINSI;
     |SI #0#2 = vacio;
          |C_M #0#3,  1, "N";
          |C_M #0#5,  1, "N";
          |SI #1#37 = "B";
            |C_M #0#6,  1, "N";
          |SINO;
            |C_M #0#38,  1, "N";
          |FINSI;
          |C_M #0#8,  1, "N";
          |C_M #0#29,  1, "N";
          |C_M #0#10, 1, "N";
          |C_M #0#11, 1, "N";
          |C_M #0#14, 1, "N";
          |C_M #0#15, 1, "N";
          |C_M #0#22, 1, "N";
          |C_M #0#27, 1, "N";
          |C_M #0#13, 1, "N";
     |SINO;
          |C_M #0#3,  1, "S";
          |C_M #0#5,  1, "S";
          |SI #1#37 = "B";
            |C_M #0#6,  1, "S";
          |SINO;
            |C_M #0#38,  1, "S";
          |FINSI;
          |C_M #0#8,  1, "S";
          |C_M #0#29,  1, "S";
          |C_M #0#10, 1, "S";
          |C_M #0#11, 1, "S";
          |C_M #0#14, 1, "S";
          |C_M #0#15, 1, "S";
          |C_M #0#22, 1, "S";
          |C_M #0#27, 1, "S";
          |C_M #0#13, 1, "S";
     |FINSI;
     |HAZ CamposModi;
|FPRC;

|PROCESO PideArt73;  |TIPO 7;
     aConteArt = #0#2;
     nModo = (FEntrada / 100) ! 0;

     |HAZ EsFergalsan;
     |SI FSalida = 0;
          #0#2 = #0#0; |PINTA #0#2;
          eaArticulo = #0#2;
          |SUB_EJECUTA_NP "fergaz07;ALTA_ARTI";
          #0#2 = eaArticulo;
          |C_M #0#2, 1, "N";
          |ACABA;
     |FINSI;

     |SI #16#140 = "S"; |Y nModo = 1; #0#2 = eaArtAnt; |FINSI;

     aAlfa = "0000<F2> Textos";
     |HAZ EsTagloma;
     |SI FSalida = 0;
          aAlfa = "0000<F2> Textos,  <F5> Consulta articulos pendientes";
     |FINSI;
     |HAZ EsForestales;
     |SI FSalida = 0;
          aAlfa = "0000<F2> Textos,   <F3> Buscar articulo";
     |FINSI;
     |MENSA aAlfa;

     |HAZ EsMecanogra;
     |SI FSalida = 0;
          |HAZ MecaTipoLin;
          |SI nMecaMaestra ! 0; |C_M #0#2, 1, "N"; |ACABA; |FINSI;
     |FINSI;

     |C_M #0#2, 1, "S";
     |C_M #0#3, 1, "N";

     |SI #0#2 ! "                    ";
         |ABRE #2;
         #2#0 = #0#2;
         |LEE 000#2=;
         |SI FSalida ! 0;  |DDEFECTO #2;  |FINSI;
         |CIERRA #2;
         |SI #2#176 = "S";
             |C_M #0#2, 1, "N";
             |C_M #0#3, 1, "N";
             |ACABA;
         |FINSI;
     |FINSI;

     |ABRE #910;
     |LEE 040#910p;
     |SI FSalida ! 0;  |DDEFECTO #910;  |FINSI;
     |CIERRA #910;

     |SI #910#2 [ 2;    |ACABA;  |FINSI;

     eAlfa  = #0Campo;
     |SUB_EJECUTA_NP "dsz99990";                 || Por Pantalla

     |SI eAlfa = "-1";  |PTEC 807;  |ACABA;  |FINSI;
     |SI eAlfa = "-2";              |ACABA;  |FINSI;

     eaArticulo = eAlfa;      ||  700000-4215

     #0Campo = eAlfa;
     |PINTA #0Campo;
     |PTEC 802;
|FPRC;

|PROCESO TagCogeArtVari;
     eaDocu = "PV"
     eaCliente = #1#4;
     eaArticulo = #0#2;
     |HAZ TagCogeArt;
     |SI FSalida = 0;
          #0#2 = eaArticulo; |PINTA #0#2;
          #0#5 = enUnidades; |PINTA #0#5;
          #0#53 = 9; |||Marco campo interno con 9 !!
          |ABRE #2;
          #2#0 = #0#2;
          |LEE 000#2=;
          |SI FSalida = 0; |Y #2#179 = "S";
               |ABRE #238;
               #238#0 = #2#201;
               |LEE 000#238=;
               |SI FSalida = 0;
                    eaArticulo = #0#2;
                    eaCliente = #1#4;
                    |HAZ DefectoMediV;
                    #0#50 = enMedida1;
                    #0#51 = enMedida2;
                    #0#52 = enMedida3;
                    |HAZ PintaMedidaV;
                    |SI #238#8 = 1; #0#44 = #0#5 * #0#50; |FINSI;
                    |SI #238#8 = 2; #0#44 = #0#5 * #0#50 * #0#51; |FINSI;
                    |SI #238#8 = 3; #0#44 = #0#5 * #0#50 * #0#51 * #0#52; |FINSI;
               |FINSI;
               |CIERRA #238;
          |FINSI;
          |CIERRA #2;
          FSalida = 0;
     |FINSI;
|FPRC;

|PROCESO Calc673;  |TIPO 6;
     nModo = (FEntrada / 100) ! 0;
     eaArtAnt = #0#2;
     nTecla = FSalida;

     |SI nTecla = 10;
          |HAZ tx; |ACABA;
     |FINSI;

     |SI FSalida = 11;   ||F3
          |HAZ EsForestales;
          |SI FSalida = 0;
               |SUB_EJECUTA_NP "goma0008";
               |SI eaArticulo ! "";
                    #0Campo = eaArticulo;
                    |PINTA #0Campo;
               |SINO;
                    |ERROR; |ACABA;
               |FINSI;
          |FINSI;
     |FINSI;

     |SI nTecla = 13; || F5
          |HAZ EsTagloma;
          |SI FSalida = 0;
               |HAZ TagCogeArtVari;
               |SI FSalida ! 0; |ERROR; |ACABA; |FINSI;
          |FINSI;
     |FINSI;

     |SI #0Campo ! Contenido; |Y Campo = 2;
          |HAZ EsTagloma;
          |SI FSalida = 0;    || Quita el F9 del postformado
               nTagQuitaPost = 1;
          |FINSI;
          eaArticulo = #0#2;
          eaCliente = #1#4;
          |HAZ DefectoMediV;
          #0#50 = enMedida1;
          #0#51 = enMedida2;
          #0#52 = enMedida3;
          |HAZ PintaMedidaV;
     |FINSI;
     |HAZ DobleArtiV;
     |SI eaSw2Stock = "S"; |ACABA; |FINSI;

     enAlta = 1;
     eaArticulo = #0Campo;
     |HAZ LlenaArticulo;
     |SI FSalida = 0;
          #0Campo = eaArticulo;
          |PINTA #0Campo;
     |SINO;
          |ERROR; |ACABA;
     |FINSI;

     |ABRE #2;
     #2#0 = #0#2;
     |LEE 000#2=;
     |SI FSalida ! 0;  |DDEFECTO #2;  |FINSI;
     |CIERRA #2;

     |SI #2#126 = "VAR"; || Articulos varios
          |HAZ EsTagloma;
          |SI FSalida = 0; |Y #0#53 ! 9; || Marca de articulos varios
               |HAZ TagloAvisaError;
          |FINSI;
     |FINSI;

     |HAZ EsEvaristo;
     |SI FSalida = 0;
          eaCliente = #1#4;
          eaArticulo = #0#2;
          |SUB_EJECUTA_NP "evarz029";

          enModo = nModo;
          eaEvaTalla = "S";
          |HAZ EvaPideResto;
          #0#5 = enUnidades; |PINTA #0#5;
     |FINSI;

     |SI #2#176 = "S";
          eaTipo      = "PV";
          eaSerie     = #0#28;
          enCodigo    = #0#0;
          enLinea     = #0#1;
          eaArticulo  = #0#2;
          enAlmacen   = #0#3;
          enUnidades  = #0#5;
          enTBruto    = #0#7;
          eaAbono     = #1#34;
          eaReservado = "N";
          enTarifa    = #6#39;
          efFecha     = #1#1;
          eaCliente   = #1#4;
          enCamBas     = #1#36;
          eaMoneda     = #1#37;
          enCamDiv     = #1#41;

          |HAZ EsRocai; |SI FSalida = 0; |HAZ CalcuComi; |FINSI;
          enComision = #0#10;

          |SUB_EJECUTA_NP "dsz00002";

          nComiRocai = enComision;

          #0#3    = enAlmacen;
          nPrecio = enTBruto / enUnidades;

          |PTEC 802;
          |PTEC 802;
          |PTEC 802;
          |PTEC 802;
     |FINSI;

     |HAZ art6pdv;
     |HAZ nomodif2;
|FPRC;

|PROCESO Tipo11073;  |TIPO 11;
     salida = FSalida;
     |SI FSalida = 7;  |Y #2#176 = "S";
         |MENAV "      Imposible abortar;  Termine de introducir la linea y efectue una Baja.";
         |ERROR;
     |FINSI;
     |HAZ EsSematel;
     |SI FSalida = 0;
           |MENAV "      Imposible abortar;  Termine de introducir la linea y efectue una Baja.";
           |ERROR;
     |FINSI;
|FPRC;

|PROCESO verpre2;
     |ABRE #9;
     |SELECT #3#9;
     #9#10 = #1#4;  || Cliente.
     #9#0  = #0#2;  || Articulo.
     #9#1  = "31.12.2300";  || Fecha.
     #9#2  = "AV";  || Operacion.
     prevul = 0;
     |LEE 000#9];
     |SI FSalida = 0;
          |LEE 000#9a;
     |SINO;
          |LEE 000#9u;
     |FINSI;
     |SI FSalida = 0; |Y #9#10 = #1#4; |Y #9#0 = #0#2; |Y #9#2 = "AV";
          prevul = #9#9 / #1#41 * #1#36;  || Calculo el importe en divisas
          |SI #1#37 = "D";                     || Si la moneda de trabajo es la divisa ...
               prevul = prevul ! nDeci_PreDivP;
          |SINO;                               || Si la moneda de trabajo es la moneda base ...
               prevul = prevul ! nDeci_PreBase;
          |FINSI;
     |FINSI;
     |CIERRA #9;
|FPRC;

|PROCESO PintaBene; |TIPO 7;
     |SI #16#176 = "S";
          |SI #16#177 = "B";
               |SI #16#178 = "P";
                    nCampo = 9;
                    aAlfa = "0000Beneficio Bruto sobre PCM: ";
               |FINSI;
               |SI #16#178 = "U";
                    nCampo = 28;
                    aAlfa = "0000Beneficio Bruto sobre Ultimo Precio: ";
               |FINSI;
               |SI #16#178 = "D";
                    nCampo = 133;
                    aAlfa = "0000Beneficio Bruto sobre Ult. Precio con Dto: ";
               |FINSI;
               nBene = ((#0#38 - #2nCampo) / #2nCampo) * 100;
          |SINO;
               |SI #16#178 = "P";
                    nCampo = 9;
                    aAlfa = "0000Beneficio Neto sobre PCM: ";
               |FINSI;
               |SI #16#178 = "U";
                    nCampo = 28;
                    aAlfa = "0000Beneficio Neto sobre Ultimo Precio: ";
               |FINSI;
               |SI #16#178 = "D";
                    nCampo = 133;
                    aAlfa = "0000Beneficio Neto sobre Ult. Precio con Dto: ";
               |FINSI;
               nBene = (1 -(#2nCampo / #0#38) ) * 100;
          |FINSI;
          aAlfa = aAlfa + nBene;
          |MENSA aAlfa;
     |FINSI;
|FPRC;

|PROCESO CtaArt1; |TIPO 0;
     nModo = (FEntrada / 100) ! 0;
     eaModulo = "agifa104"; |HAZ CtaArt;
     eaArtiAntes = #0#2;

     |ABRE #2;
     #2#0 = #0#2;
     |LEE 020#2=;
     |CIERRA #2;

     |SI nModo = 1; |O #0Campo ! aConteArt; || Contenido;
          #0#14 = #2#30; |PINTA #0#14;
     |FINSI;

     |HAZ EsDesanch;
     |SI FSalida = 0;
          |SI #2#136 = "N";
               |MENAV "0000El articulo no es de venta...";
               |ERROR; |ACABA;
          |FINSI;
     |FINSI;

     |HAZ EsJamaica;
     |SI FSalida = 0;
          aAlfa = "cafe0026;CHEQFAM" + #0#2 + #1#4;
          |SUB_EJECUTA_NP aAlfa;
          |SI enError ! 0; |ERROR; |ACABA; |FINSI;
     |FINSI;
|FPRC;


|PROCESO Tipo73_5; |TIPO 5;
     enSwPrimiPDA = 0;
     nModo = (FEntrada / 100) ! 0;
     |SI enLin004082 ! 0;
          aAlfa = ("000" + enLin004082) % -103;
          aPtec = aAlfa % 301; nPtec = &aPtec;
          |PTEC nPtec;
          aPtec = aAlfa % 201; nPtec = &aPtec;
          |PTEC nPtec;
          aPtec = aAlfa % 101; nPtec = &aPtec;
          |PTEC nPtec;
          enLin004082 = 0;
     |FINSI;
     |SI nModo = 1;
          |HAZ CheqDesglose;
          |SI enError = 1; |PTEC 807; |FINSI;
     |FINSI;
     |SI nModo = 1;
          |HAZ EsTagloma;
          |SI FSalida = 0;
               |HAZ TagloCheqSec;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Dto073; |TIPO 0;
     |HAZ totallip;
     |HAZ lpcomis;
     ||컴컴컴컴컴컴컴컴컴
     |HAZ EsTecatel;
     |SI FSalida = 0;
          art_dt = #0#2;
          dtos_1 = #0#8;
          dtos_2 = #0#29;
          |HAZ TecaCheqFijo;
          |SI FSalida ! 0; |ERROR; |ACABA; |FINSI;
     |FINSI;
     ||컴컴컴컴컴컴컴컴컴
     eaArticulo = #0#2;
     enPrecio = #0#6;
     enDto1 = #0#8;
     enDto2 = #0#29;
     |HAZ CheqPCM_PVP;

     |SI #279#3 = "S";
          eaArticulo = #0#2;
          enPrecio = #0#6;
          enDto1 = #0#8;
          enDto2 = #0#29;
          nNume =  (enPrecio < enDto1) < enDto2;
          |SI nNume ! nPreDtoAnt;
               |SUB_EJECUTA_NP "dsz00100";
               |SI enError ! 0; |ERROR; |ACABA; |FINSI;
               nPreDtoAnt = nNume;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Equivalentes;
     articulo = #0#2;
     eaArticulo = #0#2;
     enAlmacen = #0#3;
     |SUB_EJECUTA_NP "agifa294";
     #0#2 = eaArticulo; |PINTA #0#2;
     #0#3 = enAlmacen; |PINTA #0#3;
     |ABRE #2;
     #2#0 = #0#2;
     |LEE 000#2=;
     |CIERRA #2;
     #0#4 = #2#1;
     #0#18 = #2#2;
     |PINTA #0#4;
     |SI articulo ! #0#2; |HAZ PrecArt; |FINSI;
     |SI enSalida ! 0; |Y eaAuto = "N"; |ERROR; |FINSI;
|FPRC;

|PROCESO Descri7_73; |TIPO 7;
     aDesAnt = #0#4;
|FPRC;

|PROCESO Descri6_73; |TIPO 6;
     |SI FSalida = 14;             ||F6
          eaAuto = "N";
          |HAZ Equivalentes;
     |FINSI;

     |SI #0#4 ! aDesAnt;
          |HAZ TagModDesPost;
     |FINSI;
     |HAZ PintaDes73;
|FPRC;

|PROCESO MinC073;
     #referen1@#28 = #1#25;
     #referen1@#0 = #1#0;
     #referen1@#1 = 001;
|FPRC;

|PROCESO MaxC073;
     #referen1@#28 = #1#25;
     #referen1@#0 = #1#0;
     #referen1@#1 = 999;
|FPRC;

|PROCESO Consulta073; |TIPO 66;
     nLin = 0;
     |DDEF aAlfa;
     aAlfa = aAlfa + "agifa073";
     |CARGA_DEF aAlfa, referen1@;
     |SI FSalida = 0;
          |ABRE #referen1@;
          |CONSULTA_F_CLAVE #1#referen1@, MinC073, MaxC073;
          |SI FSalida = 0; nLin = #referen1@#1; |FINSI;
          |CIERRA #referen1@;
          |DESCARGA_DEF #referen1@;
     |FINSI;
     |SI nLin ! 0;
          |PTEC 802;
          aAlfa = ("000" + nLin) % -103;
          aPtec = aAlfa % 301; nPtec = &aPtec;
          |PTEC nPtec;
          aPtec = aAlfa % 201; nPtec = &aPtec;
          |PTEC nPtec;
          aPtec = aAlfa % 101; nPtec = &aPtec;
          |PTEC nPtec;
     |FINSI;
|FPRC;

|PROCESO PinLinArt;
     |ABRE #2;
     #2#0 = #0#2;
     |LEE 000#2=;
     |CIERRA #2;
     |DDEFECTO #553;
     |ABRE #553;
     #553#0 = #2#125;
     |LEE 000#553=;
     |CIERRA #553;
     |PINTA 2302, #553#1;
|FPRC;


|PROCESO Riesgos73;
     eaSerie = #agifa073#28; eaTag = "PE";  |HAZ SacaRiesgo;
     |SI eaRieSuma = "S"; nRieUtili = nRieUtili + #1#11 + #0#9; |FINSI;

     |HAZ EsMecanogra;
     |SI FSalida = 0;
          |SI nRieUtili ] nRieTotal;
               |HAZ MecaRiesgo;
          |FINSI;
     |FINSI;

     |SI #agifa142#166 = "S";
          eaDocu = "L";
          eaTipo = "P";
          enImpoDoc = #1#11 + #0#9;
          eaDesdeLinea = "S";
          |HAZ ControlRiesgo;
          eaDesdeLinea = "N";
          |SI enErrRie = 1; |ERROR; |ACABA; |FINSI;
          |SI enAudito = 0;
               |ABRE #43;
               |LEE 000#43u;
               |SI FSalida = 0;
                    nConAu = #43#0 + 1;
               |SINO;
                    nConAu = 1;
               |FINSI;
               |DDEFECTO #43;
               #43#0 = nConAu;
               #43#12 = "PEDIDO";
               #43#1 = #1#25;
               #43#2 = #1#0;
               #43#3 = #1#1;
               #43#4 = #1#4;
               #43#5 = #1#8;
               #43#6 = Usuario % 810;
               #43#7 = nRieTotal;
               #43#8 = nRieUtili;
               #43#9 = #41#2;
               #43#10= #41#3;
               #43#11= #41#4;
               |GRABA 020#43n;
               |CIERRA #43;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO ImportaPDA73;
     |DDEF aAlfa; aAlfa = aAlfa + "agifa073";
     |CARGA_DEF aAlfa, referen1@;
     |SI FSalida ! 0; |ACABA; |FINSI;
     |ABRE #referen1@;
     #referen1@#28 = #1#25;
     #referen1@#0 = #1#0;
     #referen1@#1 = 999;
     |LEE 000#referen1@.];
     |SI FSalida = 0;
          |LEE 000#referen1@.a;
     |SINO;
          |LEE 000#referen1@.u;
     |FINSI;
     |SI FSalida = 0; |Y #referen1@#28 = #1#25; |Y #referen1@#0 = #1#0;
          nLin = #referen1@#1 + 1;
     |SINO;
          nLin = 1;
     |FINSI;
     |CIERRA #referen1@;
     |DESCARGA_DEF #referen1@;

     |DDEF aAlfa; aAlfa = aAlfa + "psion067";
     |CARGA_DEF aAlfa, referen1@;
     |SI FSalida ! 0; |ACABA; |FINSI;
     |NOME_DAT #referen1@#eaFichero#;
     |ABRE #referen1@;
     |LEE 000#referen1@.p;
     |PARA; |SI FSalida = 0; |HACIENDO;
          #0#28 = #1#25;
          #0#0 = #1#0;
          #0#1 = nLin;
          |GRABA 020#0b;
          #0#2 = #referen1@#0; ||Arti
          #0#4 = #referen1@#1; ||Des
          #0#3 = #referen1@#2; ||Alma
          #0#5 = #referen1@#3; ||Uni
          #0#45 = #referen1@#9; ||Parti
          FEntrada = 100;     ||simula alta
          |HAZ PrecArt;
          |HAZ TotalLin73;
          |HAZ lpacarti;
          |GRABA 020#0a;
          |LIBERA #0;
          nLin = nLin + 1;
          |LEE 000#referen1@.s;
     |SIGUE;
     |CIERRA #referen1@;
     |DELINDEX #referen1@;
     |DESCARGA_DEF #referen1@;
     |PONCONTROL 23, "SI"
     |PTEC 809;
     |PTEC 808;
|FPRC;

|PROCESO MenuTrack73;
     |VARIABLES; {20} aPopup = ""; |FINSI;
     aPopup1 = "-1";  || Si fuera -1 en la posicion
     aPopup2 = 11;
     aPopup3 = "<F3> Estado Pedido";
     aPopup4 = "<F4> Copiar Pedido";
     aPopup5 = "<F5> Doble Stock/Kit";
     aPopup6 = "<F6> Precios Cliente";
     aPopup7 = "<F7> Consulta Cabecera";
     aPopup8 = "<F8> Descripcin Ampliada";
     aPopup9 = "<F9> Textos";
     aPopup10 = "<10> Extracto Contable";
     aPopup11 = "<F12> Entrega A cuenta";
     aPopup12 = "<Ctrl+F2> Albaranes";
     aPopup13 = "<Ctrl+F7> Captura PDA";
     |HAZ EsVigor;
     nSwVigor = FSalida;
     |SI FSalida = 0;
          aPopup2 = 12;
          aPopup13 = "<Ctrl+F2> Modificar Observaciones";
          aPopup14 = "<Ctrl+F9> Historico Pedidos";
     |FINSI;
     |HAZ EsMecanogra;
     nSwMecanogra = FSalida;
     |SI FSalida = 0;
          aPopup2 = 13;
          aPopup13 = "<Ctrl+F2> Aceptacion Producin";
          aPopup14 = "<Ctrl+F3> Consulta Paquetes";
          aPopup15 = "<Ctrl+F6> Finalizar Orden";
     |FINSI;
     |HAZ EsEvaristo;
     |SI FSalida = 0;
          aPopup13 = "<Ctrl+F2> Tallas";
     |FINSI;

     |HAZ EsDefelino;
     |SI FSalida = 0; aPopup4 = "<F4> Introduccin por Surtido"; |FINSI;

     IaPopup = aPopup1  <-;
     |ESPECIFICA "TRACKPOPUP", aPopup;
     nSal = FSalida;
     |SI FSalida = 1; nSal = 11; |FINSI;
     |SI FSalida = 2; nSal = 12; |FINSI;
     |SI FSalida = 3; nSal = 13; |FINSI;
     |SI FSalida = 4; nSal = 14; |FINSI;
     |SI FSalida = 5; nSal = 15; |FINSI;
     |SI FSalida = 6; nSal = 16; |FINSI;
     |SI FSalida = 7; nSal = 17; |FINSI;
     |SI FSalida = 8; nSal = 18; |FINSI;
     |SI FSalida = 9; nSal = 9; |FINSI;
     |SI FSalida = 10; nSal = 20; |FINSI;  ||Ctr+F2
     |SI FSalida = 11; nSal = 25; |FINSI;  ||Ctr+F7
     |SI nSwVigor = 0;
          |SI FSalida = 11; nSal = 20; |FINSI;
          |SI FSalida = 12; nSal = 27; |FINSI;
     |FINSI;
     |SI nSwMecanogra = 0;
          |SI FSalida = 11; nSal = 20; |FINSI;
          |SI FSalida = 12; nSal = 21; |FINSI;
          |SI FSalida = 13; nSal = 24; |FINSI;
     |FINSI;
     FSalida = nSal;
|FPRC;

|PROCESO VigorHisto;
     |DDEF aAlfa;
     aAlfa = aAlfa + "vigm0021";
     |CARGA_DEF aAlfa, referen2@;
     |SI FSalida = 0;
          |ABRE #referen2@;
          #referen2@#0 = #1#4;
          #referen2@#1 = #0#2;
          |SI nForma = -1;
               |BORRA 040#referen2@.c;
          |SINO;
               |LEE 101#referen2@.=;
               |SI FSalida ! 0; |GRABA 020#referen2@.b; |FINSI;
               #referen2@#2 = #1#1;
               #referen2@#3 = #0#5;
               #referen2@#4 = #0#6;
               |GRABA 020#referen2@.a;
          |FINSI;
          |CIERRA #referen2@;
          |DESCARGA_DEF #referen2@;
     |FINSI;
|FPRC;

|PROCESO VigorViajes;
     |DDEF aAlfa;
     aAlfa = aAlfa + "vigm0026";
     |CARGA_DEF aAlfa, referen1@;
     |SI FSalida = 0;
          |ABRE #referen1@;
          |SELECT #2#referen1@;
          #referen1@#2 = #0#28;
          #referen1@#3 = #0#0;
          |LEE 101#referen1@.=;
          |SI FSalida = 0;
               #referen1@#8 = #referen1@#8 + (#0#5 * nForma);
               |GRABA 020#referen1@.a;
          |FINSI;
          |DESCARGA_DEF #referen1@;
     |FINSI;
|FPRC;

|PROCESO VigoCreaLin;
     |DDEF aAlfa; aAlfa = aAlfa + "agifa073";
     |CARGA_DEF aAlfa, refvigor@;
     |SI FSalida ! 0; |ACABA; |FINSI;
     |ABRE #refvigor@;
     #refvigor@#28 = #1#25;
     #refvigor@#0 = #1#0;
     #refvigor@#1 = 999;
     |LEE 000#refvigor@.];
     |SI FSalida = 0;
          |LEE 000#refvigor@.a;
     |SINO;
          |LEE 000#refvigor@.u;
     |FINSI;
     |SI FSalida = 0; |Y #refvigor@#28 = #1#25; |Y #refvigor@#0 = #1#0;
          nLin = #refvigor@#1 + 1;
     |SINO;
          nLin = 1;
     |FINSI;
     |CIERRA #refvigor@;
     |DESCARGA_DEF #refvigor@;

     |DDEF aAlfa; aAlfa = aAlfa + "vigz0031";
     |CARGA_DEF aAlfa, refvigor@;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |NOME_DAT #refvigor@#eaFichero#;
     |ABRE #refvigor@;
     |LEE 000#refvigor@.p;
     |PARA; |SI FSalida = 0; |HACIENDO;
          |SI #refvigor@#5 = "*";
               #0#28 = #1#25;
               #0#0 = #1#0;
               #0#1 = nLin;
               |GRABA 020#0b;
               #0#2 = #refvigor@#1; ||Arti
               #0#4 = #refvigor@#6; ||Des
               #0#3 = 1;           ||Alma
               #0#5 = #refvigor@#3; ||Uni
               #0#6 = #refvigor@#4;
               |HAZ visual_precio;
               FEntrada = 100;     ||simula alta
               |HAZ TotalLin73;
               |HAZ lpacarti;
               |GRABA 020#0a;
               |LIBERA #0;
               nLin = nLin + 1;
          |FINSI;
          |LEE 000#refvigor@.s;
     |SIGUE;
     |CIERRA #refvigor@;
     |DELINDEX #refvigor@;
     |DESCARGA_DEF #refvigor@;
     |PONCONTROL 23, "SI"
     |PTEC 809;
     |PTEC 808;
|FPRC;

|PROCESO Alma73_66; |TIPO 66;
     |ABRE #29;
     #29#0 = #0#3;
     |LEE 000#29.];
     |CONSULTA_CLAVE #1#29;
     |SI FSalida = 0;
          #0#3 = #29#0;
          |PINTA #0#3;
     |SINO;
          |ERROR;
     |FINSI;
     |CIERRA #29;
|FPRC;

|PROCESO TagloAvisaError;
     |DDEF aAlfa;
     aAlfa = aAlfa + "tagm0021";
     |CARGA_DEF aAlfa, referen1@;
     |SI FSalida = 0;
          |ABRE #referen1@;
          |SELECT #3#referen1@;
          #referen1@#2 = #0#2;
          |SI FSalida = 0; |Y #referen1@#12 = 0;
               |MENAV "0000Si introduce este tipo de artculos manualmente provocar fallos en el stock";
          |FINSI;
          |DESCARGA_DEF #referen1@;
     |FINSI;
|FPRC;

|PROCESO TagloAvisaSto73;
     |ABRE #238;
     #238#0 = #2#201;
     |LEE 000#238=;
     |SI FSalida = 0; |Y #238#6 = 2;
          |SI #8#48 < #0#44;
               aAlfa = "0000Supera el Stock disponible: " + #8#48;
               |MENAV aAlfa;
               |SI avisa_st = "X"; |ERROR;   |FINSI;
          |FINSI;
     |SINO;
          |SI #8#39 < #0#5;
               aAlfa = "0000Supera el Stock disponible: " + #8#39;
               |MENAV aAlfa;
               |SI avisa_st = "X"; |ERROR;   |FINSI;
          |FINSI;
     |FINSI;
     |CIERRA #238;
|FPRC;
----------------------TAGLOMA POSTFORMADOS--------------------------------
|PROCESO TagModDesPost;
     |DDEF aAlfa;
     aAlfa = aAlfa + "tagm0056";
     |CARGA_DEF aAlfa, tagm0056@;
     |SI FSalida = 0;
          |ABRE #tagm0056@;
          #tagm0056@#0 = "PV";
          #tagm0056@#1 = #0#28;
          #tagm0056@#2 = #0#0;
          #tagm0056@#3 = #0#1;
          |LEE 000#tagm0056@.=;
          |SI FSalida = 0;
               #tagm0056@#6 = #0#4;
               |GRABA 020#tagm0056@.a;
          |FINSI;
          |CIERRA #tagm0056@;
          |DESCARGA_DEF #tagm0056@;
     |FINSI;
|FPRC;

|PROCESO TagEsLinPost;
     nSali = 1; || No es
     |DDEF aAlfa;
     aAlfa = aAlfa + "tagm0056";
     |CARGA_DEF aAlfa, tagm0056@;
     |SI FSalida = 0;
          |ABRE #tagm0056@;
          |SELECT #2#tagm0056@;
          #tagm0056@#0 = "PV";
          #tagm0056@#1 = #0#28;
          #tagm0056@#2 = #0#0;
          #tagm0056@#5 = #0#1;
          |LEE 000#tagm0056@.=;
          nSali = FSalida;
          |CIERRA #tagm0056@;
          |DESCARGA_DEF #tagm0056@;
     |FINSI;
     FSalida = nSali;
|FPRC;

|PROCESO TagLinPost;
     nSali = 1; || No es
     |DDEF aAlfa;
     aAlfa = aAlfa + "tagm0056";
     |CARGA_DEF aAlfa, tagm0056@;
     |SI FSalida = 0;
          |ABRE #tagm0056@;
          #tagm0056@#0 = "PV";
          #tagm0056@#1 = #0#28;
          #tagm0056@#2 = #0#0;
          #tagm0056@#3 = #0#1;
          |LEE 101#tagm0056@.=;
          nSali = FSalida;

          |SI nForma = 1;
               |SI nSali = 0;
                    aponer = Asino; |HAZ poncontr;
                    |SI nTagQuitaPost = 1;   || Cambia de articulo
                              |Y enTagEligePost = 0; ||y no elige otro incr.
                         |HAZ TagBorraLinPost;
                         |BORRA 040#tagm0056@.c;
                    |SINO;
                         |HAZ TagCreaLinPost;
                         #tagm0056@#5 = nLin;
                         |GRABA 020#tagm0056@.a;
                    |FINSI;
                    aponer = Anosi; |HAZ poncontr;
                    |PTEC 809; |PTEC 816; |PTEC 806;
               |SINO;
                    || enTagLinBorra la carga el tagm0058
                    ||
                    #tagm0056@#5 = enTagLinBorra;
                    |HAZ TagBorraLinPost;
                    |SI nTagBorLinPost = 0;
                         |PONCONTROL 23, "SI";
                    |FINSI;
               |FINSI;
          |SINO;
               |SI modo = 3; |Y enModo104 ! 3;
                    |HAZ TagBorraLinPost;
                    |BORRA 040#tagm0056@.c;
                    |PONCONTROL 23, "SI";
                    |PTEC 809; |PTEC 808;
               |FINSI;
               |SI modo = 3; |Y enModo104 = 3;
                    |BORRA 040#tagm0056@.c;
               |FINSI;
          |FINSI;

          |CIERRA #tagm0056@;
          |DESCARGA_DEF #tagm0056@;
     |FINSI;
     nTagQuitaPost = 0;
     enTagEligePost = 0;
|FPRC;

|PROCESO TagPreDesPost;
     nTagPre = 0;
     aTagDes = "";
     |DDEF aAlfa;
     aAlfa = aAlfa + "tagm0055";
     |CARGA_DEF aAlfa, referen3@;
     |SI FSalida = 0;
          |ABRE #referen3@;
          #referen3@#0 = #tagm0056@#4;
          |LEE 000#referen3@.=;
          |SI FSalida = 0;
               aTagDes = #referen3@#1;
               nTagPre = #referen3@#2;
               aTagArt = #referen3@#4;
          |FINSI;
          |CIERRA #referen3@;
          |DESCARGA_DEF #referen3@;
     |FINSI;
|FPRC;

|PROCESO AcuPedido;
     #1#11 = #1#11 + (#0#9 * enForma);
     #1#12 = #1#12 + (#0#9 * enForma);
     #1#13 = #1#11 - #1#12;

     #1#42 = #1#42 + (#0#39 * enForma);
     #1#43 = #1#43 + (#0#39 * enForma);
     #1#44 = #1#42 - #1#43;
     #1#63 = #1#63 + (#0#54 * enForma);

     |HAZ visual_totales;
|FPRC;

|PROCESO TagCreaLinPost;
     |DDEF aAlfa; aAlfa = aAlfa + "agifa073";
     |CARGA_DEF aAlfa, referen1@;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |ABRE #referen1@;
     #referen1@#28 = #0#28;
     #referen1@#0 = #0#0;
     #referen1@#1 = #tagm0056@#5;
     |LEE 000#referen1@.=;
     |SI FSalida = 0;
          nLin = #tagm0056@#5;
          |SALVA_DATOS #0;
          |SALVA_DATOS #referen1@;
          |REPON_DATOS #0;
          enForma = -1;
          |HAZ AcumulaPV;
          |HAZ AcuPedido;
          |REPON_DATOS #0;
     |SINO;
          #referen1@#1 = 999;
          |LEE 000#referen1@.];
          |SI FSalida = 0;
               |LEE 000#referen1@.a;
          |SINO;
               |LEE 000#referen1@.u;
          |FINSI;
          |SI FSalida = 0; |Y #referen1@#28 = #0#28;  |Y #referen1@#0 = #0#0;
               nLin = #referen1@#1 + 1;
          |SINO;
               nLin = 1;
          |FINSI;
          |SI nLin [ #0#1; nLin = #0#1 + 1; |FINSI;
          |DDEFECTO #referen1@;
          #referen1@#28 = #0#28;
          #referen1@#0 = #0#0;
          #referen1@#1 = nLin;
          |GRABA 020#referen1@.b;
     |FINSI;

     |HAZ TagPreDesPost;
     #referen1@#2 = aTagArt;
     #referen1@#3 = 1;
     #referen1@#4 = aTagDes;
     #referen1@#5 = #0#5;
     #referen1@#6 = nTagPre;
     #referen1@#8 = #0#8;
     #referen1@#10 = #0#10;
     #referen1@#13 = #0#13;
     #referen1@#14 = #0#14;
     #referen1@#15 = #0#15;
     #referen1@#16 = #0#16;
     #referen1@#17 = #0#17;

     |ABRE #2;
     #2#0 = #referen1@#2;
     |LEE 020#2=;
     |CIERRA #2;
     #referen1@#18 = #2#2;

     #referen1@#19 = #0#19;
     #referen1@#20 = #0#20;
     #referen1@#23 = #0#23;
     #referen1@#24 = #0#24;
     #referen1@#25 = #0#25;
     #referen1@#26 = #0#26;
     #referen1@#29 = #0#29;
     #referen1@#38 = nTagPre;
     #referen1@#42 = #0#5;
     |SALVA_DATOS #0;

     |SALVA_DATOS #referen1@;
     |REPON_DATOS #0;
     enForma = 1;
     |HAZ AcumulaPV;
     |HAZ TotalLin73;
     |HAZ AcuPedido;
     |SALVA_DATOS #0;
     |REPON_DATOS #referen1@;
     |GRABA 020#referen1@.a;

     |REPON_DATOS #0;

     |CIERRA #referen1@;
     |DESCARGA_DEF #referen1@;
|FPRC;

|PROCESO TagBorraLinPost;
     |DDEF aAlfa; aAlfa = aAlfa + "agifa073";
     |CARGA_DEF aAlfa, referen1@;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |ABRE #referen1@;
     #referen1@#28 = #0#28;
     #referen1@#0 = #0#0;
     #referen1@#1 = #tagm0056@#5;
     |LEE 101#referen1@.=;
     nTagBorLinPost = FSalida;
     |SI FSalida = 0;
          |SALVA_DATOS #0;
          |SALVA_DATOS #referen1@;
          |REPON_DATOS #0;
          #0#1 = #referen1@#1;
          enForma = -1;
          |HAZ AcumulaPV;
          |HAZ AcuPedido;
          |REPON_DATOS #0;
          |BORRA 020#referen1@.a;
     |FINSI;
     |CIERRA #referen1@;
     |DESCARGA_DEF #referen1@;
|FPRC;
--------------------------------------------------------------------------
|PROCESO MecanoPin73;
     |DDEF aAlfa;
     aAlfa = aAlfa + "mecam006";
     |CARGA_DEF aAlfa, referen1@;
     |SI FSalida = 0;
          |DDEFECTO #referen1@;
          |ABRE #referen1@;
          #referen1@#0 = #0#28;
          #referen1@#1 = #0#0;
          #referen1@#2 = #0#1;
          |LEE 000#referen1@.=;
          |CIERRA #referen1@;
          |PINTA 0901, "쿙 Orden      /      /     Finalizada         ";
          |PINTA 0943, "Lin. Maestra  ";
          |PINTA 1001, "쿑ilm   Solape Iz            Solape De        ";
          |PINTA 2345, " Pro              Fin             ";
          |ATRI I;
          |PINTA #referen1@#14;
          |PINTA #referen1@#8;
          |PINTA #referen1@#9;
          |PINTA #referen1@#10;
          |PINTA #referen1@#13;
          |PINTA #referen1@#3;
          |PINTA #referen1@#11;
          |PINTA #referen1@#12;
          |PINTA #referen1@#4;
          |PINTA #referen1@#5;
          |PINTA #referen1@#6;
          |PINTA #referen1@#7;
          |ATRI 0;
          |DESCARGA_DEF #referen1@;
     |FINSI;
|FPRC;

|PROCESO T073_6_0; |TIPO 0;
     |SI inkey = 0; |O inkey = 3;
          |HAZ EsMecanogra;
          |SI FSalida = 0;
               eaSerie = #0#28;
               enCodigo = #0#0;
               enLinea = #0#1;
               |SUB_EJECUTA_NP "mecam006";
               |HAZ MecanoPin73;
          |FINSI;
     |FINSI;
     |SI #279#3 = "S";
          eaArticulo = #0#2;
          enPrecio = #0#6;
          enDto1 = #0#8;
          enDto2 = #0#29;
          nNume =  (enPrecio < enDto1) < enDto2;
          |SI nNume ! nPreDtoAnt;
               |SUB_EJECUTA_NP "dsz00100";
               |SI enError ! 0; |ERROR; |ACABA; |FINSI;
               nPreDtoAnt = nNume;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO ActMecaAuxi
     aAlfa = aPath + "mecam005";
     |CARGA_DEF aAlfa, mecam005@;
     |SI FSalida = 0;
          aAlfa = aPath + "mecam006";
          |CARGA_DEF aAlfa, mecam006@;
          |SI FSalida = 0;
               |ABRE #mecam005@;
               |ABRE #mecam006@;
               |DDEFECTO #mecam005@;
               #mecam005@#0 = #0#28;
               #mecam005@#1 = #0#0;
               |LEE 000#mecam005@.=;
               |SI FSalida ! 0; |GRABA 020#mecam005@.b; |FINSI;
               |DDEFECTO #mecam006@;
               #mecam006@#0 = #0#28;
               #mecam006@#1 = #0#0;
               #mecam006@#2 = #0#1;
               |LEE 101#mecam006@.=;
               |SI FSalida ! 0; |GRABA 020#mecam006@.b; |FINSI;
               #mecam006@#6 = #mecam005@#2;
               #mecam006@#7 = #mecam005@#3;
               |GRABA 020#mecam006@.a;
               |CIERRA #mecam006@;
               |CIERRA #mecam005@;
               |DESCARGA_DEF #mecam006@;
          |FINSI;
          |DESCARGA_DEF #mecam005@;
     |FINSI;
|FPRC;

|PROCESO MecaGraAuxi;
     aAlfa = aPath + "mecam005";
     |CARGA_DEF aAlfa, mecam005@;
     |SI FSalida = 0;
          aAlfa = aPath + "mecam006";
          |CARGA_DEF aAlfa, mecam006@;
          |SI FSalida = 0;
               |ABRE #mecam005@;
               |ABRE #mecam006@;
               |DDEFECTO #mecam005@;
               #mecam005@#0 = #0#28;
               #mecam005@#1 = #0#0;
               |LEE 000#mecam005@.=;
               |SI FSalida ! 0; |GRABA 020#mecam005@.b; |FINSI;
               |DDEFECTO #mecam006@;
               #mecam006@#0 = #0#28;
               #mecam006@#1 = #0#0;
               #mecam006@#2 = #0#1;
               |LEE 101#mecam006@.=;
               |SI FSalida ! 0; |GRABA 020#mecam006@.b; |FINSI;
               #mecam006@#3 = aFilm;
               #mecam006@#6 = #mecam005@#2;
               #mecam006@#7 = #mecam005@#3;
               #mecam006@#13 = nMecaMaestra;
               |GRABA 020#mecam006@.a;
               |CIERRA #mecam006@;
               |CIERRA #mecam005@;
               |DESCARGA_DEF #mecam006@;
          |FINSI;
          |DESCARGA_DEF #mecam005@;
     |FINSI;
|FPRC;

|PROCESO MecaCreLin;
     #2#0 = #mecaw001@#2;
     |LEE 000#2=;

     #referen1@#28 = #0#28;
     #referen1@#0 = #0#0;
     #referen1@#1 = 999;
     |LEE 000#referen1@.];
     |SI FSalida = 0;
          |LEE 000#referen1@.a;
     |SINO;
          |LEE 000#referen1@.u;
     |FINSI;
     |SI FSalida = 0; |Y #referen1@#28 = #0#28;  |Y #referen1@#0 = #0#0;
          nLin = #referen1@#1 + 1;
     |SINO;
          nLin = 1;
     |FINSI;
     |SI nLin [ #0#1; nLin = #0#1 + 1; |FINSI;
     |DDEFECTO #referen1@;
     #referen1@#28 = #0#28;
     #referen1@#0 = #0#0;
     #referen1@#1 = nLin;
     |GRABA 020#referen1@.b;
     #referen1@#2 = #mecaw001@#2;
     #referen1@#3 = #0#3;
     #referen1@#4 = #mecaw001@#3;

     |SI #mecaw001@#5 = "U";
          #referen1@#5 = #0#5 * #mecaw001@#4;   || Uni1
          #referen1@#50 = #0#50;                || Medida1
     |SINO;
          #referen1@#5 = #0#44 * #mecaw001@#4;
          nAbo = 1;
          |SI #referen1@#5 < 0; nAbo = -1; |FINSI;
          #referen1@#5 = #referen1@#5 * nAbo;
          nNume = #referen1@#5 ! 0;
          |SI nNume ! #referen1@#5;
               |SI nNume > #referen1@#5; #referen1@#5 = nNume; |FINSI;
               |SI nNume < #referen1@#5; #referen1@#5 = nNume + 1; |FINSI;
          |FINSI;
          #referen1@#5 = #referen1@#5 * nAbo;
          #referen1@#50 = 0;
     |FINSI;
     #referen1@#44 = #referen1@#5 * #referen1@#50; || Uni2

     #referen1@#14 = #0#14;
     #referen1@#15 = #0#15;
     #referen1@#16 = #0#16;
     #referen1@#17 = #0#17;
     #referen1@#18 = #2#2;
     #referen1@#19 = #0#19;
     #referen1@#20 = #0#20;
     #referen1@#22 = #0#22;
     #referen1@#26 = #0#26;
     #referen1@#19 = #0#19;
     #referen1@#42 = #referen1@#5;
     #referen1@#48 = #referen1@#44;
||---
     |SALVA_DATOS #0;

     |SALVA_DATOS #referen1@;
     |REPON_DATOS #0;
     enForma = 1;
     |HAZ AcumulaPV;
     |HAZ TotalLin73;
     |HAZ MecaGraAuxi;
     nForma = 1;
     |HAZ MecaReservaStock;
     |HAZ MecaAceptaPro;
     |HAZ MecaAltaPaquete;
     |SALVA_DATOS #0;
     |REPON_DATOS #referen1@;
     |GRABA 020#referen1@.a;

     |REPON_DATOS #0;
|FPRC;

|DEFBUCLE MecaCreLin;
     #mecaw001@#1002;
     ;
     "                    ", 001;
     "zzzzzzzzzzzzzzzzzzzz", 999;
     ;
     NULL, MecaCreLin;
|FIN;

|PROCESO MecaCreaLin;
     |HAZ ActMecaAuxi;
     |HAZ MecaTipoLin;
     |DDEF aPath;
     aAlfa = aPath + "mecaw001";
     |CARGA_DEF aAlfa, mecaw001@;
     |SI FSalida = 0;
          aAlfa = aPath + "agifa073";
          |CARGA_DEF aAlfa, referen1@;
          |SI FSalida = 0;
               |HAZ MecaAltaPaquete;
               nMecaMaestra = #0#1;
               |NOME_DAT #mecaw001@#eaFicMeca#;
               |ABRE #referen1@;
               |ABRE #2;
               aponer = Asino; |HAZ poncontr;
               |BUCLE MecaCreLin;
               aponer = Anosi; |HAZ poncontr;
               |PTEC 809; |PTEC 816; |PTEC 806;
               |CIERRA #2;
               |CIERRA #referen1@;
               |DELINDEX #mecaw001@;
               |DESCARGA_DEF #referen1@;
          |FINSI;
          |DESCARGA_DEF #mecaw001@;
     |FINSI;
|FPRC;

|PROCESO MecaTipoLin;
     nMecaMaestra = 0;
     nMecaOrd = 0;
     |DDEF aPath;
     aAlfa = aPath + "mecam006";
     |CARGA_DEF aAlfa, mecam006@;
     |SI FSalida = 0;
          |ABRE #mecam006@;
          |DDEFECTO #mecam006@;
          #mecam006@#0 = #0#28;
          #mecam006@#1 = #0#0;
          #mecam006@#2 = #0#1;
          |LEE 000#mecam006@.=;
          |SI FSalida = 0;
               aFilm = #mecam006@#3;
               nMecaMaestra = #mecam006@#13;
               nMecaOrd = #mecam006@#9;
          |FINSI;
          |CIERRA #mecam006@;
          |DESCARGA_DEF #mecam006@;
     |FINSI;
|FPRC;

|PROCESO MecaBorraLin;
     nMecaMaestra = #0#1;
     aSeri = #0#28;
     aPedi = #0#0;
     |DDEF aPath; aAlfa = aPath + "agifa073";
     |CARGA_DEF aAlfa, referen1@;
     |SI FSalida ! 0; |ACABA; |FINSI;

     aAlfa = aPath + "mecam006";
     |CARGA_DEF aAlfa, mecam006@;
     |SI FSalida = 0;
          |ABRE #referen1@;
          |ABRE #mecam006@;
          #referen1@#28 = aSeri;
          #referen1@#0 = aPedi;
          #referen1@#1 = #0#1 + 1;|| porque la linea actual esta bloqueada (windows)
          |LEE 101#referen1@.];
          |PARA; |SI FSalida = 0; |Y #referen1@#28 = aSeri; |Y #referen1@#0 = aPedi;
                    |HACIENDO;
               |DDEFECTO #mecam006@;
               #mecam006@#0 = #referen1@#28;
               #mecam006@#1 = #referen1@#0;
               #mecam006@#2 = #referen1@#1;
               |LEE 000#mecam006@.=;
               |SI #mecam006@#13 = nMecaMaestra;
                    |SALVA_DATOS #0;
                    |SALVA_DATOS #referen1@;
                    |REPON_DATOS #0;
                    #0#1 = #referen1@#1;
                    enForma = -1;
                    |HAZ AcumulaPV;
                    |HAZ MecaReservaStock;
                    |HAZ MecaBajaPaquete;
                    |REPON_DATOS #0;
                    |BORRA 020#referen1@.a;
                    |LIBERA #referen1@;
                    |BORRA 040#mecam006@.a;
               |FINSI;
               |LEE 101#referen1@.s;
          |SIGUE;
          |CIERRA #mecam006@;
          |CIERRA #referen1@;
          |DESCARGA_DEF #mecam006@;
     |FINSI;

     |DESCARGA_DEF #referen1@;
|FPRC;

|PROCESO MecaEscanLin;
     |DDEFECTO #mecam004@;
     #mecam004@#0 = #49#0;
     #mecam004@#1 = #49#1;
     |LEE 000#mecam004@.=;
     |SI #mecam004@#2 = "S"; || Film = S
          |SI #mecam006a@#3 = "N"; |ACABA; |FINSI;
          nFactor = 1;
          |SI #mecam006a@#3 = "A"; nFactor = 2; |FINSI;
     |SINO;
          nFactor = 1;
     |FINSI;

     |SI #0#44 ! 0;
          nUni = #49#12 * nFactor * #0#44 * nForma;
     |SINO;
          nUni = #49#12 * nFactor * #0#5 * nForma;
     |FINSI;

     #2#0 = #49#2;
     |LEE 101#2=;
     |SI FSalida = 0;
          #2#12 = #2#12 + nUni;
          #2#104 = #2#104 - nUni;

          #8#0 = #49#2;
          #8#1 = #49#9;
          |LEE 101#8=;
          |SI FSalida = 0;
               #8#8 = #8#8 + nUni;
               #8#39 = #8#39 - nUni;
               |SI #2#180 = "S";
                    |DDEFECTO #24;
                    #24#0 = #49#2;
                    #24#1 = #49#9;
                    #24#2 = "";
                    |LEE 101#24=;
                    |SI FSalida ! 0; |GRABA 020#24b; |FINSI;
                    #24#24 = #24#24 + nUni;
                    #24#22 = #24#22 - nUni;
                    |HAZ ValoraStock;
                    |GRABA 020#24a;
                    |LIBERA #24;
               |FINSI;
               |HAZ ValoraStock;
               |GRABA 020#8a;
               |LIBERA #8;
          |FINSI;
          |GRABA 020#2a;
          |LIBERA #2;
     |FINSI;
|FPRC;

|DEFBUCLE MecaEscanLin;
     #49#1;
     ;
     #0#2, 001;
     #0#2, 999;
     ;
     NULL, MecaEscanLin;
|FIN;

|PROCESO MecaReservaStock;
     |DDEF aPath;
     aAlfa = aPath + "mecam001";
     |CARGA_DEF aAlfa, mecam001@;
     |SI FSalida = 0;
          |ABRE #mecam001@;
          #mecam001@#0 = #0#2;
          |LEE 000#mecam001@.=;
          |CIERRA #mecam001@;
          aAlfa = #mecam001@#3;    ||Articulo Fabricacion
          |DESCARGA_DEF #mecam001@;
     |FINSI;
     |SI aAlfa = "N"; |ACABA; |FINSI;

     aAlfa = aPath + "mecam004";
     |CARGA_DEF aAlfa, mecam004@;
     |SI FSalida = 0;
          aAlfa = aPath + "mecam006";
          |CARGA_DEF aAlfa, mecam006a@;
          |SI FSalida = 0;
               |ABRE #mecam004@;
               |ABRE #mecam006a@;
               |DDEFECTO #mecam006a@;
               #mecam006a@#0 = #0#28;
               #mecam006a@#1 = #0#0;
               #mecam006a@#2 = #0#1;
               |LEE 101#mecam006a@.=;
               |SI FSalida ! 0; |GRABA 020#mecam006a@.b; |FINSI;

               |ABRE #2;
               |ABRE #8;
               |ABRE #24;
               |BUCLE MecaEscanLin;
               |CIERRA #24;
               |CIERRA #8;
               |CIERRA #2;

               |CIERRA #mecam006a@;
               |CIERRA #mecam004@;
               |DESCARGA_DEF #mecam006a@;
          |FINSI;
          |DESCARGA_DEF #mecam004@;
     |FINSI;
|FPRC;

|PROCESO MecaMarcaAcepta;
     |DDEF aAlfa;
     aAlfa = aAlfa + "mecam006";
     |CARGA_DEF aAlfa, mecam006a@;
     |SI FSalida = 0;
          |DDEFECTO #mecam006a@;
          |ABRE #mecam006a@;
          #mecam006a@#0 = #0#28;
          #mecam006a@#1 = #0#0;
          #mecam006a@#2 = #0#1;
          |LEE 101#mecam006a@.=;
          |SI FSalida ! 0; |GRABA 020#mecam006a@.b; |FINSI;
          |SI #mecam006a@#4 = "N";
               #mecam006a@#4 = "S";
               #mecam006a@#5 = ~;
          |SINO;
               #mecam006a@#4 = "N";
               #mecam006a@#5 = "01.01.0000";
          |FINSI;
          |PINTA #mecam006a@#4;
          |PINTA #mecam006a@#5;
          |GRABA 020#mecam006a@.a;
          |CIERRA #mecam006a@;
          |DESCARGA_DEF #mecam006a@;
     |FINSI;
|FPRC;

|PROCESO MecaEscanLin2;
     |DDEFECTO #8;
     #8#0 = #49#2;
     #8#1 = #49#9;
     |LEE 000#8=;
     |SI #8#39 < 0;
          aFaltaStock = "S";
     |FINSI;
|FPRC;

|DEFBUCLE MecaEscanLin2;
     #49#1;
     ;
     #0#2, 001;
     #0#2, 999;
     ;
     NULL, MecaEscanLin2;
|FIN;

|PROCESO MecaAceptaPro;
     |DDEF aAlfa;
     aAlfa = aAlfa + "mecam006";
     |CARGA_DEF aAlfa, mecam006a@;
     |SI FSalida = 0;
          |DDEFECTO #mecam006a@;
          |ABRE #mecam006a@;
          #mecam006a@#0 = #0#28;
          #mecam006a@#1 = #0#0;
          #mecam006a@#2 = #0#1;
          |LEE 101#mecam006a@.=;
          |SI FSalida ! 0; |GRABA 020#mecam006a@.b; |FINSI;
          aFaltaStock = "N";
          |ABRE #8;
          |BUCLE MecaEscanLin2;
          |CIERRA #8;
          |SI #mecam006a@#5 = "01.01.0000"; |Y aFaltaStock = "S";
               #mecam006a@#4 = "N";
               |GRABA 020#mecam006a@.a;
               aAlfa =  "0000Pedido denegado en produccion por falta de stock de:" + #0#2;
               |MENAV aAlfa;
          |FINSI;
          |PINTA #mecam006a@#4;
          |PINTA #mecam006a@#5;
          |GRABA 020#mecam006a@.a;
          |CIERRA #mecam006a@;
          |DESCARGA_DEF #mecam006a@;
     |FINSI;
|FPRC;

|PROCESO MecaAltaPaquete;
     eaSerie = #0#28;
     enDocu = #0#0;
     enLinea = #0#1;
     eaArticulo = #0#2;
     enUnidades = #0#5;
     enMedida1 = #0#50;
     |SUB_EJECUTA_NP "mecam007;ALTA";
|FPRC;

|PROCESO MecaBajaPaquete;
     eaSerie = #0#28;
     enDocu = #0#0;
     enLinea = #0#1;
     |SUB_EJECUTA_NP "mecam007;BAJA";
|FPRC;

|PROCESO MecaPaquetes;
     eaSerie = #0#28;
     enDocu = #0#0;
     |SUB_EJECUTA_NP "mecaz004";
|FPRC;

|PROCESO MecaFinaliza;
     |SI #0#43 ! 0; |O #0#12 ! 0;
          |MENAV "0000ERROR. Tiene unidades adjudicadas...";
          |ACABA;
     |FINSI;

     |DDEF aPath;
     aAlfa = aPath + "mecam006";
     |CARGA_DEF aAlfa, mecam006@;
     |SI FSalida = 0;
          aAlfa = "";
          |ABRE #mecam006@;
          #mecam006@#0 = #0#28;
          #mecam006@#1 = #0#0;
          #mecam006@#2 = #0#1;
          |LEE 000#mecam006@.=;
          |SI FSalida = 0;
               |SI #mecam006@#4 = "N";
                    aAlfa = "0000Linea Pedido no aceptada en produccion";
               |FINSI;
               |SI #mecam006@#6 = "N";
                    aAlfa = "0000Pedido sin aceptacion financiera";
               |FINSI;
          |FINSI;
          |CIERRA #mecam006@;
          |DESCARGA_DEF #mecam006@;
          |SI aAlfa ! "";
               |MENAV aAlfa; |ACABA;
          |FINSI;
     |FINSI;
     eaSerie = #0#28;
     enDocu = #0#0;
     enLinea = #0#1;
     enUnidad1 = #0#5;
     enUnidad2 = #0#44;
     eaArticulo = #0#2;
     enAlmacen = #0#3;
     |SUB_EJECUTA_NP "mecaz010";
     |HAZ MecanoPin73;
|FPRC;
-----------------------------------------------
|PROCESO VigorObserva;
     |PUSHV 0501 2380;
     |PINPA #0#1;
     |PINDA #0#1;
     |ENCAMPO #15#1;
     |POPV;
|FPRC;

|PROCESO SumaUni73;
     nTotUni = nTotUni + #0#5;
|FPRC;

|DEFBUCLE SumaUni73;
     #0#1;
     ;
     #1#25, #1#0, 001;
     #1#25, #1#0, 999;
     ;
     NULL, SumaUni73;
|FIN;

|PROCESO VigorPin73;
     |DDEF aAlfa;
     aAlfa = aAlfa + "vigm0040";
     |CARGA_DEF aAlfa, referen1@;
     |SI FSalida = 0;
          |DDEFECTO #referen1@;
          |ABRE #referen1@;
          #referen1@#0 = #0#28;
          #referen1@#1 = #0#0;
          #referen1@#2 = #0#1;
          |LEE 000#referen1@.=;
          |CIERRA #referen1@;
          |PINTA 1002, "Tipo Granel/Sacos:";
          |ATRI I;
          |PINTA #referen1@#3;
          |ATRI 0;
          |DESCARGA_DEF #referen1@;
     |FINSI;

     |SALVA_FICHA #0;
     nTotUni = 0;
     |BUCLE SumaUni73;
     #0#5 = nTotUni;
     |PINTA 902, "Tot. Uni: ";
     |PINTA 912, #0#5;
     |REPON_FICHA #0;
|FPRC;
-----------------------------------------------
|PROCESO desan001_73;
     |SI #desan001@#3 ! "S"; |ACABA; |FINSI;
     nCan = nUni / #desan001@#4;
     nCan = ((nCan - 0.49) ! 0) * #desan001@#5;
     |SI nCan [ 0; |ACABA; |FINSI;

     |SI nHay = 0; aponer = Asino; |HAZ poncontr; |FINSI;

     nLin = nLin + 1;
     #0#1 = nLin;
     #0#2 = #desan001@#1;   || Codigo
     |HAZ lpdefec;

     #0#4 = #2#1;
     #0#3 = nAlma;
     #0#14 = #2#30;
     #0#5 = nCan;
     #0#42 = nCan;
     |HAZ totallip;
     |HAZ lpacarti;
     |GRABA 020#0n;
     nHay = 1;
|FPRC;

|DEFBUCLE desan001_73;
     #desan001@#1002;
     ;
     #0#2,"                    ";
     #0#2,"zzzzzzzzzzzzzzzzzzzz";
     ;
     NULL, desan001_73;
|FIN;

|PROCESO Desan073;
     |DDEF aAlfa;
     aAlfa = aAlfa + "desan001";
     |CARGA_DEF aAlfa, desan001@;
     |SI FSalida = 0;
          nLin = #0#1;
          nUni = #0#5;
          nAlma = #0#3;
          nHay = 0;
          |SALVA_DATOS #0;
          |BUCLE desan001_73;
          |REPON_DATOS #0;
          |DESCARGA_DEF #desan001@;
          |SI nHay ! 0;
               aponer = Anosi; |HAZ poncontr;
               |PTEC 809; |PTEC 816; |PTEC 806;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO MecaCheqArti;
     nSal = 1;
     |DDEF aPath;
     aAlfa = aPath + "mecam001";
     |CARGA_DEF aAlfa, mecam001@;
     |SI FSalida = 0;
          |ABRE #mecam001@;
          #mecam001@#0 = #0#2;
          |LEE 000#mecam001@.=;
          |CIERRA #mecam001@;
          aAlfa = #mecam001@#3;    ||Articulo Fabricacion
          nNume = #mecam001@#1;    ||Uni paquete
          |DESCARGA_DEF #mecam001@;
          |SI aAlfa = "S";
               |SI nNume = 0;
                    aAlfa = "0000Articulo de fabricacion sin unidades paquete " + #0#2;
                    |MENAV aAlfa;
                    nSal = 0;
               |FINSI;
               |ABRE #480;
               #480#0 = #0#2;
               |LEE 000#480=;
               |SI FSalida ! 0;
                    aAlfa = "0000Articulo de fabricacion sin escandallo " + #0#2;
                    |MENAV aAlfa;
                    nSal = 0;
               |FINSI;
               |CIERRA #480;
          |FINSI;
     |FINSI;

     FSalida = nSal;
|FPRC;
----------------------------------------------
|PROCESO TallerCreaLin73;
     |DDEF aAlfa; aAlfa = aAlfa + "agifa073";
     |CARGA_DEF aAlfa, referen1@;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |ABRE #referen1@;
     |SI #0#55 > 0;
          nLin = #0#55;
          #referen1@#28 = #0#28;
          #referen1@#0 = #0#0;
          #referen1@#1 = nLin;
          |LEE 121#referen1@.=;
     |SINO;
          #referen1@#28 = #0#28;
          #referen1@#0 = #0#0;
          #referen1@#1 = 999;
          |LEE 000#referen1@.];
          |SI FSalida = 0;
               |LEE 000#referen1@.a;
          |SINO;
               |LEE 000#referen1@.u;
          |FINSI;
          |SI FSalida = 0; |Y #referen1@#28 = #0#28;  |Y #referen1@#0 = #0#0;
               nLin = #referen1@#1 + 1;
          |SINO;
               nLin = 1;
          |FINSI;
          |SI nLin [ #0#1; nLin = #0#1 + 1; |FINSI;
          |DDEFECTO #referen1@;
          #referen1@#28 = #0#28;
          #referen1@#0 = #0#0;
          #referen1@#1 = nLin;
          |GRABA 020#referen1@.b;
     |FINSI;
     aAlfa = "CANON " + #0#4;
     #referen1@#2 = "xxxxx";
     #referen1@#3 = 1;
     #referen1@#4 = aAlfa;
     #referen1@#5 = #0#5;
     #referen1@#6 = enCanon;
     #referen1@#14 = #0#14;
     #referen1@#16 = #0#16;
     #referen1@#18 = #0#18;
     #referen1@#20 = #0#20;
     #referen1@#26 = #0#26;
     #referen1@#38 = enCanon;
     #referen1@#42 = #0#42;
     #referen1@#55 = -1;
     |SALVA_DATOS #0;

     |SALVA_DATOS #referen1@;
     |REPON_DATOS #0;

     enForma = 1;
     |HAZ AcumulaPV;
     |HAZ TotalLin73;
     |HAZ AcuPedido;

     |SALVA_DATOS #0;
     |REPON_DATOS #referen1@;
     |GRABA 020#referen1@.a;

     |REPON_DATOS #0;

     #0#55 = nLin;       || Linea Promocion

     |CIERRA #referen1@;
     |DESCARGA_DEF #referen1@;
|FPRC;

|PROCESO TallerAcuLin73;
     |DDEF aAlfa; aAlfa = aAlfa + "agifa073";
     |CARGA_DEF aAlfa, referen1@;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |ABRE #referen1@;
     #referen1@#28 = #0#28;
     #referen1@#0 = #0#0;
     #referen1@#1 = #0#55;     || Usa linea promocion
     |LEE 101#referen1@.=;
     |SI FSalida = 0;
          |SALVA_DATOS #0;
          |SALVA_DATOS #referen1@;
          |REPON_DATOS #0;
          #0#1 = #referen1@#1;
          enForma = -1;
          |HAZ AcumulaPV;
          |HAZ TotalLin73;
          |HAZ AcuPedido;
          |REPON_DATOS #0;
     |FINSI;
     |CIERRA #referen1@;

     |DESCARGA_DEF #referen1@;
|FPRC;

|PROCESO TallerBorLin73;
     |DDEF aAlfa; aAlfa = aAlfa + "agifa073";
     |CARGA_DEF aAlfa, referen1@;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |ABRE #referen1@;
     #referen1@#28 = #0#28;
     #referen1@#0 = #0#0;
     #referen1@#1 = #0#55;     || Usa linea promocion
     |LEE 101#referen1@.=;
     nTallerBorLin = FSalida;
     |SI FSalida = 0;
          |BORRA 020#referen1@.a;
     |FINSI;
     |CIERRA #referen1@;

     |DESCARGA_DEF #referen1@;
|FPRC;

|PROCESO TallerCanon73;
     eaArticulo = #0#2; |QBF eaArticulo;
     |HAZ TallerCanon;
     |SI nForma = 1;
          |SI enCanon ! 0;
               aponer = Asino; |HAZ poncontr;
               |HAZ TallerCreaLin73;
               aponer = Anosi; |HAZ poncontr;
               |PTEC 809; |PTEC 816; |PTEC 806;
          |SINO;
               |SI #0#55 > 0;      || ha cambiado a un articulo sin canon
                    |HAZ TallerBorLin73;
                    #0#55 = 0;
               |FINSI;
          |FINSI;
     |SINO;
          |SI modo = 3; |Y enModo104 ! 3;
               |HAZ TallerAcuLin73;
               |HAZ TallerBorLin73;
               |SI nTallerBorLin = 0;
                    |PONCONTROL 23, "SI";
                    |PTEC 809; |PTEC 808;
               |FINSI;
          |SINO;
               |SI modo = 2;
                    |HAZ TallerAcuLin73;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO BorTagloMerma73;
     |DDEF aAlfa;
     aAlfa = aAlfa + "tagm0078";
     |CARGA_DEF aAlfa, referen1@;
     |SI FSalida ! 0;
          |MENAV "0000Error al cargar 'tagm0078'";
     |SINO;
          |ABRE #referen1@;
          #referen1@#0 = "P";
          #referen1@#1 = #0#28;
          #referen1@#2 = #0#0;
          #referen1@#3 = #0#1;
          |BORRA 000#referen1@.c;
          |CIERRA #referen1@;
          |DESCARGA_DEF #referen1@;
     |FINSI;
|FPRC;

|PROCESO PintaDes73;
     |HAZ EsAparecida;
     |SI FSalida = 0;
          |C_A #0#4, 0, nNume;
          |C_A #0#4, 1, 50;
          |PINTA 2301, "쿏escripcion: ";
          |PINTA 2315, #0#4;
          |C_A #0#4, 1, nNume;
     |FINSI;
|FPRC;

|PROCESO AdjAlba;
     #10#52 = #71#29;
     #10#0 = #71#0;
     |LEE 000#10=;
     |SI FSalida = 0;
          |SALVA_DATOS #10;
          |REPON_DATOS #referen1@;
          |GRABA 000#referen1@.n;
          nHay = 1;
     |FINSI;
|FPRC;

|DEFBUCLE AdjAlba;
     #71#4;
     ;
     #0#28, #0#0, #0#1;
     #0#28, #0#0, #0#1;
     ;
     NULL, AdjAlba;
|FIN;

|PROCESO ConsultaAlba;
     |DDEF aAlfa;
     aAlfa = aAlfa + "agifa010";
     |CARGA_DEF aAlfa, referen1@;
     |SI FSalida ! 0; |ACABA; |FINSI;
     |HAZ CreaTempo; |NOME_DAT #referen1@#Tempo#; |DELINDEX #referen1@;
     |ABRE #referen1@;
     nHay = 0;
     |ABRE #10;
     |BUCLE AdjAlba;
     |CIERRA #10;
     |SI nHay = 0;
          |MENAV "0000No existen albaranes adjudicados a este pedido...";
     |SINO;
          |LEE 000#referen1@.p;
          |PARA; |SI; |HACIENDO;
               |CONSULTA_CLAVE #1#referen1@;
               |SI FSalida = 0;
                    eaSerie = #referen1@#52;
                    enCodigo = #referen1@#0;
                    |SUB_EJECUTA_NP "dsz99903";
               |SINO;
                    |SAL;
               |FINSI;
          |SIGUE;
     |FINSI;
     |CIERRA #referen1@;

     |HAZ BoraTempo; |DELINDEX #referen1@;
     |DESCARGA_DEF #referen1@;
|FPRC;

|PROCESO CoimaPin73;
     |DDEF aAlfa;
     aAlfa = aAlfa + "coima007";
     |CARGA_DEF aAlfa, referen1@;
     |SI FSalida = 0;
          |DDEFECTO #referen1@;
          |ABRE #referen1@;
          #referen1@#0 = #0#28;
          #referen1@#1 = #0#0;
          #referen1@#2 = #0#1;
          |LEE 000#referen1@.=;
          |SI FSalida ! 0; |DDEFECTO #referen1@; |FINSI;
          |PINTA 1031, "Coleccion:  ";
          |PINTA 0902, "F.Aprox.Servicio:";
          |PINTA 1002, "F.Anterior......:";
          |PINTA 0931, "F.Calculo Dispo.:";
          |ATRI I;
          |PINTA #referen1@#3;
          |PINTA #referen1@#4;
          |PINTA #referen1@#5;
          |PINTA #referen1@#6;
          |ATRI 0;
          |DESCARGA_DEF #referen1@;
     |FINSI;
|FPRC;

|PROCESO Reservado; |TIPO 0;
     |SI FSalida = 0; |O FSalida = 3;
          |HAZ EsCoimasa;
          |SI FSalida = 0;
               eaSerie = #0#28;
               enDocu = #0#0;
               enLinea = #0#1;
               eaCliente = #1#4;
               |SUB_EJECUTA_NP "coima007";
               |HAZ CoimaPin73;
          |FINSI;
          |HAZ EsInforAlba;
          |SI FSalida = 0;
               |ABRE #2;
               #2#0 = #0#2;
               |LEE 000#2=;
               |SI FSalida = 0; |Y #2#174 = "S ";
                    eaArticulo = #0#2;
                    eaMatri = #0#45;
                    |SUB_EJECUTA_NP "ialbz001;PC";
                    #0#45 = eaMatri;
               |SINO;
                    #0#45 = "";
               |FINSI;
               |CIERRA #2;
               |C_V #0#45, 1, "S";
               |PINTA 1009, #0#45;
          |FINSI;
          |HAZ EsQDClor;
          |SI FSalida = 0;
               eaSerie = #0#28;
               enCodigo = #0#0;
               enLinea = #0#1;
               eaArticulo = #0#2;
               |SUB_EJECUTA_NP "qdclor06";
               |HAZ QDClorPin73;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO CoimaHisto;
     nHay = nHay + 1;

     |DDEFECTO #coima002@;
     #coima002@#0 = #coima003@#0;
     #coima002@#1 = #coima003@#6;
     |LEE 000#coima002@.=;

     |DDEFECTO #referen1@;
     #referen1@#0 = #coima003@#11;
     #referen1@#1 = #coima003@#12;
     #referen1@#2 = #referen1@#2 + (#coima003@#7 - #coima003@#8);
     #referen1@#3 = #coima003@#10;
     #referen1@#4 = #coima003@#6;
     #referen1@#5 = #coima002@#2;
     #referen1@#6 = nHay;
     |GRABA 020#referen1@.n;
     |LIBERA #referen1@;
|FPRC;

|DEFBUCLE CoimaHisto;
     #coima003@#3003;
     ;
     #0#2, #0#3, "N";
     #0#2, #0#3, "N";
     ;
     NULL, CoimaHisto;
|FIN;

|PROCESO CoimaLisHisto;
     |DDEF aPath;
     aAlfa = aPath + "coima003";
     |CARGA_DEF aAlfa, coima003@;
     |SI FSalida = 0;
          aAlfa = aPath + "coima002";
          |CARGA_DEF aAlfa, coima002@;
          |SI FSalida = 0;
               aAlfa = aPath + "coimw002";
               |CARGA_DEF aAlfa, referen1@;
               |SI FSalida = 0;
                    aAlfa = Usuario;
                    |NOME_DAT #referen1@#aAlfa#; |DELINDEX #referen1@;
                    nHay = 0;
                    |ABRE #referen1@;
                    |ABRE #coima002@;
                    |BUCLE CoimaHisto;
                    |SI nHay = 0;
                         |MENAV "0000No hay registros en el historico de procesos sin finalizar...";
                    |SINO;
                         |LEE 000#referen1@.p;
                         |CONSULTA_CLAVE #1#referen1@;
                    |FINSI;
                    |CIERRA #referen1@;
                    |CIERRA #coima002@;
                    |DELINDEX #referen1@;
                    |DESCARGA_DEF #referen1@;
               |FINSI;
               |DESCARGA_DEF #coima002@;
          |FINSI;
          |DESCARGA_DEF #coima003@;
     |FINSI;
|FPRC;

|PROCESO CoimaParam;
     |DDEF aPath;
     aAlfa = aPath + "coima001";
     |CARGA_DEF aAlfa, referen1@;
     |SI FSalida = 0;
          |ABRE #referen1@;
          |LEE 000#referen1@.p;
          |CIERRA #referen1@;
          aRese = #referen1@#15;
          |DESCARGA_DEF #referen1@;
     |SINO;
          |MENAV "0000Error al cargar 'coima001'";
     |FINSI;
|FPRC;

|PROCESO ApareceCreaLin73;
     |DDEF aAlfa; aAlfa = aAlfa + "agifa073";
     |CARGA_DEF aAlfa, referen1@;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |ABRE #2;
     #2#0 = "9759999";
     |LEE 000#2=;
     |CIERRA #2;

     |ABRE #referen1@;
     |SI #0#55 > 0;
          nLin = #0#55;
          #referen1@#28 = #0#28;
          #referen1@#0 = #0#0;
          #referen1@#1 = nLin;
          |LEE 121#referen1@.=;
     |SINO;
          #referen1@#28 = #0#28;
          #referen1@#0 = #0#0;
          #referen1@#1 = 999;
          |LEE 000#referen1@.];
          |SI FSalida = 0;
               |LEE 000#referen1@.a;
          |SINO;
               |LEE 000#referen1@.u;
          |FINSI;
          |SI FSalida = 0; |Y #referen1@#28 = #0#28;  |Y #referen1@#0 = #0#0;
               nLin = #referen1@#1 + 1;
          |SINO;
               nLin = 1;
          |FINSI;
          |SI nLin [ #0#1; nLin = #0#1 + 1; |FINSI;
          |DDEFECTO #referen1@;
          #referen1@#28 = #0#28;
          #referen1@#0 = #0#0;
          #referen1@#1 = nLin;
          |GRABA 020#referen1@.b;
     |FINSI;
     #referen1@#2 = #2#0;
     #referen1@#3 = #0#3;
     #referen1@#4 = #2#1;
     #referen1@#5 = -#0#5;
     #referen1@#6 = #0#6;
     #referen1@#8 = #0#8;
     #referen1@#10 = #0#10;
     #referen1@#13 = #0#13;
     #referen1@#14 = #0#14;
     #referen1@#16 = #0#16;
     #referen1@#17 = #0#17;
     #referen1@#18 = #2#2;
     #referen1@#19 = #0#19;
     #referen1@#20 = #0#20;
     #referen1@#23 = #0#23;
     #referen1@#24 = #0#24;
     #referen1@#25 = #0#25;
     #referen1@#26 = #0#26;
     #referen1@#29 = #0#29;
     #referen1@#38 = #0#6
     #referen1@#42 = #0#42;
     #referen1@#55 = -1;
     |SALVA_DATOS #0;

     |SALVA_DATOS #referen1@;
     |REPON_DATOS #0;

     enForma = 1;
     |HAZ AcumulaPV;
     |HAZ TotalLin73;
     |HAZ AcuPedido;

     |SALVA_DATOS #0;
     |REPON_DATOS #referen1@;
     |GRABA 020#referen1@.a;

     |REPON_DATOS #0;

     #0#55 = nLin;       || Linea Promocion

     |CIERRA #referen1@;
     |DESCARGA_DEF #referen1@;
|FPRC;

|PROCESO Aparecida73;
     |ABRE #6;
     #6#0 = #1#4;
     |LEE 000#6=;
     |CIERRA #6;
     |SI #6#113 ! "N"; |ACABA; |FINSI;
     |ABRE #2;
     #2#0 = #0#2;
     |LEE 000#2=;
     |CIERRA #2;

     |SI nForma = 1;
          |SI #2#2 = "975";
               aponer = Asino; |HAZ poncontr;
               |HAZ ApareceCreaLin73;
               aponer = Anosi; |HAZ poncontr;
               |PTEC 809; |PTEC 816; |PTEC 806;
          |SINO;
               |SI #0#55 > 0;      || ha cambiado a un articulo sin
                    |HAZ TallerBorLin73;
                    #0#55 = 0;
               |FINSI;
          |FINSI;
     |SINO;
          |SI modo = 3; |Y enModo104 ! 3;
               |HAZ TallerAcuLin73;
               |HAZ TallerBorLin73;
               |SI nTallerBorLin = 0;
                    |PONCONTROL 23, "SI";
                    |PTEC 809; |PTEC 808;
               |FINSI;
          |SINO;
               |SI modo = 2;
                    |HAZ TallerAcuLin73;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO ModRie73; |TIPO 0;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 2; |Y #0Campo ! Contenido;
          |HAZ Riesgos73;
          |SI enErrRie = 1; |ERROR; |FINSI;
     |FINSI;
|FPRC;

|PROCESO ModUniSer; |TIPO 0;
     |SI #0#5 < 0;
          |SI #0#5 > #0#43;
               aAlfa = "0000las unidades no pueden ser inferior a las servidas: " + #0#43;
               |MENAV aAlfa;
               |ERROR; |ACABA;
          |FINSI;
     |SINO;
          |SI #0#5 < #0#43;
               aAlfa = "0000las unidades no pueden ser inferior a las servidas: " + #0#43;
               |MENAV aAlfa;
               |ERROR; |ACABA;
          |FINSI;
     |FINSI;

     |HAZ EsBerria;
     |SI FSalida = 0;
          eaArticulo = #0#2;
          |HAZ EsKit;
          |SI FSalida = 0; #0#5 = 1; |PINTA #0#5; |FINSI;
     |FINSI;
|FPRC;

|PROCESO IVA073_0; |TIPO 0;
     enTiva = #0Campo;
     efFiva = #1#1;
     |HAZ SacaIVA;
     |SI eaDiva = "";
          |MENAV "0000No existe tipo iva para esta fecha...";
          |ERROR; |ACABA;
     |SINO;
          |HAZ mirespor;
     |FINSI;
|FPRC;

|PROCESO IVA073_66; |TIPO 66;
     enTiva = #0Campo;
     efFiva = #1#1;
     |HAZ ConsuIVA;
     |SI eaDiva = "";
          |ERROR;
     |SINO;
          #0Campo = enTiva; |PINTA #0Campo;
     |FINSI;
|FPRC;

|PROCESO ActDesanch73;
/*
     nEsta = 0;
     |DDEF aPath;
     aAlfa = aPath + "desan001";
     |CARGA_DEF aAlfa, referen1@;
     |SI FSalida = 0;
          |ABRE #referen1@;
          |SELECT #2#referen1@;
          #referen1@#1 = #0#2;
          |LEE 000#referen1@.=;
          |SI FSalida = 0; |Y #referen1@#3 = "S";
               nEsta = 1;
          |FINSI;
          |DESCARGA_DEF #referen1@;
     |FINSI;

     |SI nEsta = 0; |ACABA; |FINSI;

     aAlfa = aPath + "desan026";
     |CARGA_DEF aAlfa, referen1@;
     |SI FSalida = 0;
          |ABRE #referen1@;
          #referen1@#0 = #0#2;
          #referen1@#1 = #1#1;
          #referen1@#2 = "PV";
          #referen1@#3 = #0#28;
          #referen1@#4 = #0#0;
          #referen1@#5 = #0#1;
          #referen1@#6 = -#0#5;
          #referen1@#7 = #1#4;
          |SI nForma = 1;
               |GRABA 020#referen1@.n;
          |SINO;
               |BORRA 000#referen1@.c;
          |FINSI;
          |CIERRA #referen1@;
          |DESCARGA_DEF #referen1@;
     |FINSI;
*/
|FPRC;

|PROCESO Reservado7; |TIPO 7;
     |HAZ EsCoimasa;
     |SI FSalida = 0;
          |C_M #0#22, 1, "N";
     |FINSI;
|FPRC;

|PROCESO NoModSer; |TIPO 6;
     |C_M #0Campo, 0, aAlfa;
     |SI #0Campo ! Contenido; |Y aAlfa = "S"; |Y Campo ! 5;
          |SI #0#43 ! 0;
               |MENAV "0000Linea pedido con unidades servidas...";
               |ERROR;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO QDClorPin73;
     |DDEF aPath;
     aAlfa = aPath + "qdclor06";
     |CARGA_DEF aAlfa, referen1@;
     |SI FSalida = 0;
          |DDEFECTO #referen1@;
          |ABRE #referen1@;
          #referen1@#0 = #0#28;
          #referen1@#1 = #0#0;
          #referen1@#2 = #0#1;
          |LEE 000#referen1@.=;
          |CIERRA #referen1@;
          |ATRI R;
          |PINTA 902, "Envases쿟ip쿎liente2쿛rovedor   Lote   ";
          |ATRI 0;
          |PINTA 942, "";
          |PINTA 1002, "                                    ";
          |ATRI I;
          |PINTA 1003, #referen1@#3;
          |PINTA 1011, #referen1@#4;
          |PINTA 1015, #referen1@#5;
          |PINTA 1024, #referen1@#7;
          |PINTA 1032, #referen1@#6;
          |ATRI 0;
          |DESCARGA_DEF #referen1@;
     |FINSI;
|FPRC;

|PROCESO DefelinoFabLin;
     |DDEF aAlfa;
     aAlfa = aAlfa + "defelm01";
     |CARGA_DEF aAlfa, referen1@;
     |SI FSalida = 0;
          |ABRE #referen1@;
          #referen1@#0 = #0#28;
          #referen1@#1 = #0#0;
          #referen1@#2 = #0#1;
          |LEE 000#referen1@.=;
          |SI FSalida = 0;
               nError = 1;
               |SI nForma = -1; |MENAV "0000Linea en fabricacin..."; |FINSI;
          |SINO;
               nError = 0;
          |FINSI;
          |CIERRA #referen1@;
          |DESCARGA_DEF #referen1@;
     |FINSI;
|FPRC;
----------------------------------------------------------
|PROCESO LeeDefeArt;
     eAlfa = #2#0;  |SUB_EJECUTA_NP "dsz99990;V";

     aDCodF1 = " " * 20;
     aDCodF2 = " " * 20;
     aDCodF3 = " " * 20;
     aDCodF4 = " " * 20;
     |SI #910#26 = 1;
         aDCodF1 = eAlfa1;
     |FINSI;
     |SI #910#26 = 2;
         aDCodF1 = eAlfa1;
         aDCodF2 = eAlfa2;
     |FINSI;
     |SI #910#26 = 3;
         aDCodF1 = eAlfa1;
         aDCodF2 = eAlfa2;
         aDCodF3 = eAlfa3;
     |FINSI;
     |SI #910#26 = 4;
         aDCodF1 = eAlfa1;
         aDCodF2 = eAlfa2;
         aDCodF3 = eAlfa3;
         aDCodF4 = eAlfa4;
     |FINSI;
     |SI #910#44 = "T";
         eAlfa1  = #2#177;  |QBF eAlfa1;
         eAlfa1  = eAlfa1 + ((" " * 20) % 120);

         aDCodF1 = eAlfa1;
         aDCodF2 = " " * 20;
         aDCodF3 = " " * 20;
         aDCodF4 = " " * 20;
     |FINSI;
     #916#0  = aDCodF1;
     #916#1  = aDCodF2;
     #916#2  = aDCodF3;
     #916#15 = aDCodF4;
     #916#3 = #905#4;
     |LEE 000#916=;
     |SI FSalida ! 0; |DDEFECTO #916; |FINSI;
|FPRC;

|PROCESO PreTalla;
     #6#0 = #1#4;
     |LEE 000#6=;
     |SI FSalida ! 0; |DDEFECTO #6; |FINSI;

     |SI #910#24 = "S";
          |HAZ LeeDefeArt;
          |SI #6#39 = 1;  #905#7 = #916#5;   |FINSI;
          |SI #6#39 = 2;  #905#7 = #916#6;   |FINSI;
          |SI #6#39 = 3;  #905#7 = #916#7;   |FINSI;
          |SI #6#39 = 4;  #905#7 = #916#8;   |FINSI;
          |SI #6#39 = 5;  #905#7 = #916#9;   |FINSI;
          |SI #6#39 = 6;  #905#7 = #916#10;  |FINSI;
          |SI #6#39 = 0;  #905#7 = #916#11;  |FINSI;
     |SINO;
          fed_dt    = #1#1;        || Fecha....
          art_dt    = #2#0;        || Articulo.
          cli_dt    = #6#0;        || Cliente..
          fam_dt    = #2#19;       || Familia.
          iva_dt    = #2#30;       || Tipo Iva.
          dtos_2    = 0;           || Descuento 2.
          dto_pt    = 0;           || Descuento Ptas.
          dtos_1    = 0;           || Descuento 1.
          pvp_ve    = 0;           || Precio Venta.
          tarifa    = #6#39;       || Tarifa Cliente....
          gru_dt    = #6#158;      || Grupo Cliente.
          uni_dt    = 0;
          aParam    = "";
          enMensaje = 1;
          eaSerie   = #referen1@#28;
          |HAZ calcdtos
          #905#7    = pvp_ve;  || Precio Venta. sin iva.
     |FINSI;
     #905#13 = #905#7 / enCamDiv * enCamBas;
|FPRC;

|PROCESO SurtidoTalla;
     #905#0 = "PV";
     #905#1 = #0#28;
     #905#2 = #0#0;
     #905#3 = #0#1;
     #905#4 = #referen2@#1;
     #905#5 = #referen2@#2;
     #905#6 = #referen2@#3 * enCajas;
     #905#11 = #905#6;
     enCamBas = #1#36;
     eaMoneda = #1#37;
     enCamDiv = #1#41;
     |HAZ PreTalla;
     |SI eaMoneda = "B";
          #905#8 = #905#6 * #905#7;
          #905#13 = #905#7 / enCamDiv * enCamBas;
          #905#14 = #905#8 / enCamDiv * enCamBas;
     |SINO;
          #905#14 = #905#6 * #905#13;
          #905#7 = #905#13 / enCamBas * enCamDiv;
          #905#8 = #905#14 / enCamBas * enCamDiv ;
     |FINSI;
     |GRABA 020#905n;
     #referen1@#5 = #referen1@#5 + #905#6;   || Uni
     |SI eaMoneda = "B";
          enTBruto = enTBruto + (#905#6 * #905#7);
     |SINO;
          enTBruto = enTBruto + (#905#6 * #905#13);
     |FINSI;
|FPRC;

|DEFBUCLE SurtidoTalla;
     #referen2@#1002;
     ;
     enSurtido, "      ";
     enSurtido, "zzzzzz";
     ;
     NULL, SurtidoTalla;
|FIN;

|PROCESO Surtido;
     #referen1@#28 = #0#28;
     #referen1@#0 = #0#0;
     #referen1@#1 = 999;
     |LEE 000#referen1@.];
     |SI FSalida = 0;
          |LEE 000#referen1@.a;
     |SINO;
          |LEE 000#referen1@.u;
     |FINSI;
     |SI FSalida = 0; |Y #referen1@#28 = #0#28; |Y #referen1@#0 = #0#0;
          nLin = #referen1@#1 + 1;
     |SINO;
          nLin = 1;
     |FINSI;
     |DDEFECTO #referen1@;
     #referen1@#28 = #0#28;
     #referen1@#0 = #0#0;
     #referen1@#1 = nLin;
     #referen1@#2 = eaArticulo;
     #referen1@#3 = 1;
     #referen1@#4 = eaAlfa;
     #referen1@#5 = 0;

     #2#0 = #referen1@#2;
     |LEE 000#2=;
     |SI FSalida ! 0; |DDEFECTO #2; |FINSI;

     enTBruto = 0;
     |BUCLE SurtidoTalla;
     nPrecio = enTBruto / #referen1@#5;

     |SI #1#37 = "D";
          #referen1@#38 = nPrecio;
     |SINO;
          #referen1@#6  = nPrecio;
     |FINSI;
     |SI #1#37 = "D";
          #referen1@#6 = #referen1@#38 / #1#36 * #1#41;
     |SINO;
          #referen1@#38 = #referen1@#6 / #1#41 * #1#36;
     |FINSI;
     |SI #1#37 = "D";
          #referen1@#40 = #referen1@#6;
     |SINO;
          #referen1@#40 = #referen1@#38;
     |FINSI;
     #referen1@#13 = #1#2;
     #referen1@#14 = #2#30;
     #referen1@#16 = #1#7;
     #referen1@#17 = #1#16;
     #referen1@#18 = #2#19;
     #referen1@#19 = #6#4;
     #referen1@#20 = #1#4;
     #referen1@#26 = #1#9;

     |SALVA_DATOS #0;

     |SALVA_DATOS #referen1@;
     |REPON_DATOS #0;

     enForma = 1;
     |HAZ AcumulaPV;
     |HAZ TotalLin73;
     |HAZ AcuPedido;

     enDescuento1 = #0#8;
     enDescuento2 = #0#29;
     eaTComision = #0#17;
     eaCliente = #1#4;
     eaRepre = #1#7;
     eaArticulo = #0#2;
     efFecha = #1#1;
     eaSerie = #0#28;
     enDirEnt = #1#57;
     enAlmacen = #0#3;
     |HAZ Comisiones;
     #0#10 = enComision;

     |SALVA_DATOS #0;
     |REPON_DATOS #referen1@;
     |GRABA 020#referen1@.n;

     |REPON_DATOS #0;
|FPRC;

|PROCESO DefelinoSurti;
     aAlfa = "defelz04";
     |SUB_EJECUTA_NP "defelz04";
     |SI enSurtido = 0; |ACABA; |FINSI;

     |DDEF aPath;
     aAlfa = aPath + "agifa073";
     |CARGA_DEF aAlfa, referen1@;
     |SI FSalida = 0;
          aAlfa = aPath + "defelm05"; |CARGA_DEF aAlfa, referen2@;
          aAlfa = aPath + "defelm06"; |CARGA_DEF aAlfa, referen3@;
          |SI FSalida = 0;
               |ABRE #910; |LEE 000#910p; |CIERRA #910;
               |ABRE #referen1@;
               |ABRE #2;
               |ABRE #6;
               |ABRE #916;
               |ABRE #905;
               |HAZ Surtido;
               |CIERRA #905;
               |CIERRA #916;
               |CIERRA #6;
               |CIERRA #2;
               |CIERRA #referen1@;

               |ABRE #referen3@;
               #referen3@#0 = "P";
               #referen3@#1 = #0#28;
               #referen3@#2 = #0#0;
               #referen3@#3 = #0#1;
               |LEE 101#referen3@.=;
               |SI FSalida ! 0; |GRABA 020#referen3@.b; |FINSI;
               #referen3@#4 = eaArticulo;
               #referen3@#5 = enSurtido;
               #referen3@#6 = enCajas;
               |GRABA 020#referen3@.a;
               |CIERRA #referen3@;
               |DESCARGA_DEF #referen3@;

               |DESCARGA_DEF #referen2@;
               |PTEC 809; |PTEC 816; |PTEC 812;
          |SINO;
               |MENAV "0000Error al cargar 'defelm05/6'";
          |FINSI;
          |DESCARGA_DEF #referen1@;
     |SINO;
          |MENAV "0000Error al cargar 'agifa073'";
     |FINSI;
|FPRC;

|PROCESO DefelinoBorra;
     |DDEF aPath;
     aAlfa = aPath + "defelm06";
     |CARGA_DEF aAlfa, referen1@;
     |SI FSalida = 0;
          |ABRE #referen1@;
          #referen1@#0 = #0#28;
          #referen1@#1 = #0#0;
          #referen1@#2 = #0#2;
          |BORRA 000#referen1@.c;
          |CIERRA #referen1@;
          |DESCARGA_DEF #referen1@;
     |SINO;
          |MENAV "0000Error al cargar 'defelm006'";
     |FINSI;
|FPRC;

|PROCESO PulsaCF2;
     |PTEC 834;
|FPRC;

|PROCESO PulsaCF3;
     |PTEC 835;
|FPRC;

|PROCESO EvaFinBoton;
     |SI nBtnEva1 ! -1;
          |FIN_CONTROL_WINDOWS nBtnEva1;
          |FIN_CONTROL_WINDOWS nBtnEva2;
          nBtnEva1 = -1;
     |FINSI;
|FPRC;

|PROCESO EvaIniBoton;
     |HAZ EvaFinBoton;
     |CONTROL_SIMPLE 0, "BOTON, Tallas   Ctrl-F2", 0802, 912, PulsaCF2;
     nBtnEva1 = FSalida;
     |CONTROL_SIMPLE 0, "BOTON,Situacion Ctrl-F3", 0814, 924, PulsaCF3;
     nBtnEva2 = FSalida;
|FPRC;

|PROCESO EvaTallas;
     |ESTADO_CONTROL nBtnEva1, "HIDE";
     |ESTADO_CONTROL nBtnEva2, "HIDE";
     |DDEF aAlfa;
     aAlfa = aAlfa + "evarm004";
     |CARGA_DEF aAlfa, referen1@;
     |SI FSalida = 0;
          |ABRE #referen1@;
          #referen1@#30 = #0#28;
          #referen1@#31 = #0#0;
          #referen1@#32 = #0#1;
          |LEE 000#referen1@.=;
          |SI FSalida = 0;
               |PUSHV 0501 2380;
               |PINPA #0#referen1@;
               |PINDA #0#referen1@;
               |PAUSA;
               |POPV;
          |SINO;
               |MENAV "0000No existe el registro...";
          |FINSI;
          |CIERRA #referen1@;
          |DESCARGA_DEF #referen1@;
     |FINSI;
     |ESTADO_CONTROL nBtnEva1, "SHOW";
     |ESTADO_CONTROL nBtnEva2, "SHOW";
|FPRC;

|PROCESO HistoEti;
     nHay = 1;
|FPRC;

|DEFBUCLE HistoEti;
     #referen1@#2004;
     ;
     #0#28, #0#0, #0#1, aDesde;
     #0#28, #0#0, #0#1, aHasta;
     ;
     NULL, HistoEti;
|FIN;

|PROCESO MinEti;
     #referen1@#1 = #0#28;
     #referen1@#6 = #0#0;
     #referen1@#7 = #0#1;
     #referen1@#0 = aDesde;
|FPRC;

|PROCESO MaxEti;
     #referen1@#1 = #0#28;
     #referen1@#6 = #0#0;
     #referen1@#7 = #0#1;
     #referen1@#0 = aHasta;
|FPRC;

|PROCESO EvaSitua;
     |ESTADO_CONTROL nBtnEva1, "HIDE";
     |ESTADO_CONTROL nBtnEva2, "HIDE";
     |DDEF aAlfa;
     aAlfa = aAlfa + "evarm005";
     |CARGA_DEF aAlfa, referen1@;
     |SI FSalida = 0;
          aAlfa = ("00" + #0#1) % -102;
          aDesde = #0#0; ||sin ceros
          aHasta = (aDesde + aAlfa + "zzzz" + "            ") % 112;
          aDesde = (aDesde + aAlfa + "    " + "            ") % 112;
          nHay = 0;
          |BUCLE HistoEti;
          |SI nHay = 0;
               aDesde = ("000000" + #0#0) % -106; ||con ceros
               aHasta = (aDesde + aAlfa + "zzzz" + "            ") % 112;
               aDesde = (aDesde + aAlfa + "    " + "            ") % 112;
               |BUCLE HistoEti;
          |FINSI;
          |SI nHay = 0;
               |MENAV "0000No se encuetran etiquetas de esta linea...";
          |SINO;
               |PUSHV 0501 2380;
               |BLANCO 0808 2373;
               |ENTLINEAL #2#referen1@, 4, 4, 22, 1, MinEti, MaxEti;
               |POPV;
          |FINSI;
          |DESCARGA_DEF #referen1@;
     |FINSI;
     |ESTADO_CONTROL nBtnEva1, "SHOW";
     |ESTADO_CONTROL nBtnEva2, "SHOW";
|FPRC;

|PROCESO ChampEnvase;
     nLin = nLin + 1;
     |SI nLin > 1;
          |SI nLin = 2;
               aponer = Asino; |HAZ poncontr;
          |FINSI;
          #referen1@#28 = #0#28;
          #referen1@#0 = #0#0;
          #referen1@#1 = 999;
          |LEE 000#referen1@.];
          |SI FSalida = 0;
               |LEE 000#referen1@.a;
          |SINO;
               |LEE 000#referen1@.u;
          |FINSI;
          |SI FSalida = 0; |Y #referen1@#28 = #0#28; |Y #referen1@#0 = #0#0;
               nLin = #referen1@#1 + #16#236;
          |SINO;
               nLin = #16#236;
          |FINSI;
          |SI nLin = #0#1; nLin = nLin + 1; |FINSI;

          |SALVA_DATOS #0;
          |REPON_DATOS #referen1@;
          #referen1@#1 = nLin;
          #referen1@#5 = #referen3@#3 - #referen3@#4;
          #referen1@#42 = #referen1@#5;
          |SALVA_DATOS #referen1@;
          |REPON_DATOS #0;
          enForma = 1;
          |HAZ AcumulaPV;
          |HAZ TotalLin73;
          |HAZ AcuPedido;
          |SALVA_DATOS #0;
          |REPON_DATOS #referen1@;
          |GRABA 020#referen1@.n;

          |DDEFECTO #referen2@;
          #referen2@#0 = #referen1@#28;
          #referen2@#1 = #referen1@#0;
          #referen2@#2 = #referen1@#1;
          |LEE 101#referen2@.=;
          |SI FSalida ! 0; |GRABA 020#referen2@.b; |FINSI;
          #referen2@#3 = #referen3@#2;
          #referen2@#4 = #referen3@#3;
          #referen2@#5 = #referen3@#4;
          #referen2@#6 = #referen3@#1;
          |GRABA 020#referen2@.a;
          |LIBERA #referen2@;
     |FINSI;
|FPRC;

|DEFBUCLE ChampEnvase;
     #referen3@#1001;
     ;
     001;
     999;
     ;
     NULL, ChampEnvase;
|FIN;

|PROCESO ChampiEmarEnv;
     |DDEF aPath;
     aAlfa = aPath + "agifa073";
     |CARGA_DEF aAlfa, referen1@;
     |SI FSalida = 0;
          aAlfa = aPath + "champi10";
          |CARGA_DEF aAlfa, referen2@;
          |SI FSalida = 0;
               aAlfa = aPath + "champi09";
               |CARGA_DEF aAlfa, referen3@;
               |SI FSalida = 0;
                    |NOME_DAT #referen3@#eaTmpPV816#;
                    nLin = 0;

                    |SALVA_DATOS #0;
                    |ABRE #referen1@;
                    |ABRE #referen2@;
                    |BUCLE ChampEnvase;
                    |CIERRA #referen2@;
                    |CIERRA #referen1@;
                    |REPON_DATOS #0;
                    |SI nLin > 1;
                         aponer = Anosi; |HAZ poncontr;
                         |PTEC 809; |PTEC 816; |PTEC 806;
                    |FINSI;

                    |DELINDEX #referen3@;
                    |DESCARGA_DEF #referen3@;
               |SINO;
                    |MENAV "0000Error al cargar 'champi09'";
               |FINSI;
               |DESCARGA_DEF #referen2@;
          |SINO;
               |MENAV "0000Error al cargar 'champi10'";
          |FINSI;
          |DESCARGA_DEF #referen1@;
     |SINO;
          |MENAV "0000Error al cargar 'agifa073'";
     |FINSI;
|FPRC;

|PROCESO ChampiEmarBor;
     |DDEF aPath;
     aAlfa = aPath + "champi10";
     |CARGA_DEF aAlfa, referen1@;
     |SI FSalida = 0;
          |ABRE #referen1@;
          #referen1@#0 = #0#28;
          #referen1@#1 = #0#0;
          #referen1@#2 = #0#1;
          |BORRA 000#referen1@.c;
          |CIERRA #referen1@;
     |SINO;
          |MENAV "0000Error al cargar 'champi10'";
     |FINSI;
|FPRC;

|PROCESO Comi073; |TIPO 0;
     |SI FSalida ! 2;
          |HAZ EsOrts;
          |SI FSalida = 0;
               enModo = (FEntrada / 100) ! 0;
               eaTipo = "P";
               eaSerie = #0#28;
               enCodigo = #0#0;
               enLinea = #0#1;
               |SUB_EJECUTA_NP "ortsm022";
               |HAZ OrtsPin073;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO OrtsPin073;
     |DDEF aAlfa;
     aAlfa = aAlfa + "ortsm022";
     |CARGA_DEF aAlfa, referen1@;
     |SI FSalida = 0;
          |ABRE #referen1@;
          #referen1@#0 = "P";
          #referen1@#1 = #0#28;
          #referen1@#2 = #0#0;
          #referen1@#3 = #0#1;
          |LEE 000#referen1@.=;
          |SI FSalida ! 0; |DDEFECTO #referen1@; |FINSI;
          |ATRI R;
          |PINTA 1111, "%Com.Rep2:";
          |ATRI I;
          |PINTA 1122, #referen1@#7;
          |ATRI 0;
          |DESCARGA_DEF #referen1@;
     |FINSI;
|FPRC;

|PROCESO ComiOrts73;
     |HAZ EsOrts;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |DDEF aAlfa;
     aAlfa = aAlfa + "ortsm021";
     |CARGA_DEF aAlfa, referen1@;
     |SI FSalida = 0;
          |ABRE #referen1@;
          #referen1@#0 = "P";
          #referen1@#1 = #0#28;
          #referen1@#2 = #0#0;
          |LEE 000#referen1@.=;
          |CIERRA #referen1@;
          eaRepre = #referen1@#4;
          eaTComision = #referen1@#5;
          |DESCARGA_DEF #referen1@;
          |HAZ Comisiones;
          eaTipo = "P";
          eaSerie = #0#28;
          enCodigo = #0#0;
          enLinea = #0#1;
          |SUB_EJECUTA_NP "ortsm022;DEFECTO";
          |HAZ OrtsPin073;
     |FINSI;
|FPRC;

|PROCESO Precio7; |TIPO 7;
     |C_M #0Campo, 0, aAlfa;
     |SI #16#250 = "X"; |Y aAlfa = "S";
          |SI aArtiPromo = #0#2;
               #0Campo = #0Campo + #0#56;
          |SINO;
               aArtiPromo = #0#2;
               #0#56 = 0;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO PinTotaChampiEmar;
     #1#45 = #1#11;
     #1#46 = #1#12;
     #1#47 = #1#13;
     #1#48 = #1#42;
     #1#49 = #1#43;
     #1#50 = #1#44;

     |PINTA 1102, "Precio:";
     |PINTA 1121, "Imp.:";
     |SALVA_DATOS #1;
     #1#43 = #1#43 / ((100-(#1#5+#1#17+#1#6))/100);
     #1#44 = #1#44 / ((100-(#1#5+#1#17+#1#6))/100);
     #1#42 = #1#42 / ((100-(#1#5+#1#17+#1#6))/100);
     #1#12 = #1#12 / ((100-(#1#5+#1#17+#1#6))/100);
     #1#13 = #1#13 / ((100-(#1#5+#1#17+#1#6))/100);
     #1#11 = #1#11 / ((100-(#1#5+#1#17+#1#6))/100);
     |PINTA 1144,#1#43;
     |PINTA 1156,#1#44;
     |PINTA 1168,#1#42;
     |PINTA 1344,#1#12;
     |PINTA 1356,#1#13;
     |PINTA 1368,#1#11;
     |REPON_DATOS #1;
|FPRC;

|PROCESO MensaFergam;
     nNume = #referen1@#4 + #0#5;
     |SI nNume > #referen1@#3;
         #referen1@#4 = nNume;

         |PUSHV 0501 2380;
         |BLANCO 1124 2176;
         |CUADRO 1124 2176;

         |ATRI R;
         |PINTA 1225, " Se superan los kilos de bloqueo                   ";
         |ATRI 0;

         |PINTA 1325, " Bloqueo:";    |PINTA 1338, #referen1@#3;
         |PINTA 1425, " Acumulado:";  |PINTA 1438, #referen1@#4;

         |PINTA 1625, #referen1@#8;
         |PINTA 1725, #referen1@#9;
         |PINTA 1825, #referen1@#10;

         |ATRI I;
         |PINTA 2025, "Pulse <Fin> para continuar";
         |ATRI 0;

         |PARA; |SI; |HACIENDO;
                |LEETECLA aAlfa;
                aAlfa = aAlfa % -103;
                |SI aAlfa = 816; |SAL; |FINSI;
         |SIGUE;
         |POPV;

         nError = 1;

         |ACABA;
     |FINSI;

     |SI nNume > #referen1@#2;
         #referen1@#4 = nNume;

         |PUSHV 0501 2380;
         |BLANCO 1124 2176;
         |CUADRO 1124 2176;

         |ATRI R;
         |PINTA 1225, " Se superan los kilos de Alerta                    ";
         |ATRI 0;

         |PINTA 1325, " Alerta:";    |PINTA 1338, #referen1@#2;
         |PINTA 1425, " Acumulado:"; |PINTA 1438, #referen1@#4;

         |PINTA 1625, #referen1@#5;
         |PINTA 1725, #referen1@#6;
         |PINTA 1825, #referen1@#7;

         |ATRI I;
         |PINTA 2025, "Pulse <Fin> para continuar";
         |ATRI 0;

         |PARA; |SI; |HACIENDO;
                |LEETECLA aAlfa;
                aAlfa = aAlfa % -103;
                |SI aAlfa = 816; |SAL; |FINSI;
         |SIGUE;
         |POPV;
     |FINSI;
|FPRC;

|PROCESO FergaKgLee;
     nError = 0;
     |DDEF aAlfa;
     aAlfa = aAlfa + "fergam18";
     |CARGA_DEF aAlfa, referen1@;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |ABRE #referen1@;
     #referen1@#0 = #1#4;
     #referen1@#1 = #1#57;
     |LEE 000#referen1@.=;
     |SI FSalida ! 0;
         |DDEFECTO #referen1@;

         #referen1@#0 = #1#4;
         #referen1@#1 = #1#57;
         |GRABA 020#referen1@.n;
         |LIBERA #referen1@;
     |FINSI;

     |HAZ MensaFergam;

     |DESCARGA_DEF #referen1@;
|FPRC;

|PROCESO FergaKgGraba;
     |DDEF aAlfa;
     aAlfa = aAlfa + "fergam18";
     |CARGA_DEF aAlfa, referen1@;
     |SI FSalida = 0;
          |ABRE #referen1@;
          #referen1@#0 = #1#4;
          #referen1@#1 = #1#57;
          |LEE 000#referen1@.=;
          |SI FSalida ! 0;
              |DDEFECTO #referen1@;

              #referen1@#0 = #1#4;
              #referen1@#1 = #1#57;

              |GRABA 020#referen1@.b;
          |FINSI;

          #referen1@#4 = #referen1@#4 + (#0#5 * nForma);
          |GRABA 020#referen1@.a;
          |LIBERA #referen1@;
          |CIERRA #referen1@;
          |DESCARGA_DEF #referen1@;
     |FINSI;
|FPRC;
