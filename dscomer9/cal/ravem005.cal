|FICHEROS;
     ravem005 #0;
     ravem004 #4;
|FIN;

|VARIABLES;
     &nDeci_TotVis = 0;
     &eaSerie = "";
     &enCodigo = 0;
     &enLinea = 0;
     &eaPrv = "";
     &enTiva = 0;
     &efFiva = @;
     &enIva = 0;
     &enRavePre = 0;
     nNume = 0;
     aParam = "";
|FIN;

|PROCESO Na; |TIPO 12;
|FPRC;

|PROCESO Calcula; |TIPO 0;
     |HAZ IVAPrv;
     nNume = (#0#4 % #0#3) ! nDeci_TotVis;
     nNume = nNume + ((nNume * enIva / 100) ! nDeci_TotVis);
     nNume = #0#4 - nNume;
     #0#5 = nNume; |PINTA #0#5;
|FPRC;

|PROGRAMA;
     aParam = PARAMETRO;
     |ABRE #4;
     |ABRE #0;
     #0#0 = eaSerie;
     #0#1 = enCodigo;
     #0#2 = enLinea;
     |LEE 101#0=;
     |SI aParam = "BORRA";
          |SI FSalida = 0; |BORRA 020#0a; |FINSI;
     |SINO;
          |SI FSalida ! 0; |GRABA 020#0b; |FINSI;
          |SI aParam = "LIN";
               #0#3 = 0;
               #0#4 = 0;
               #0#5 = 0;

               #4#0 = #0#0;
               #4#1 = #0#1;
               |LEE 020#4=;
               |SI FSalida = 0;
                    #0#3 = #4#2;
               |FINSI;
               |GRABA 020#0a;
          |SINO;
               |DDEFECTO #4;
               #4#0 = #0#0;
               #4#1 = #0#1;
               |LEE 121#4=;
               |SI FSalida ! 0; |GRABA 020#4b; |FINSI;
               #4#3 = #4#3 - #0#5;

               |PINDA #0#0;
               |ENDATOS #1#0;
               |SI FSalida = 0;
                    |GRABA 020#0a;
               |FINSI;

               #4#3 = #4#3 + #0#5;
               |GRABA 020#4a;

               enRavePre = (#0#4 % #0#3) ! nDeci_TotVis;
          |FINSI;
     |FINSI;
     |CIERRA #0;
     |CIERRA #4;
|FPRO;
