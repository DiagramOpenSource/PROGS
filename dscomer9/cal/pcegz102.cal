/*
|FICHEROS;
   pcegz102 #0;
   pcegm047 #1;
   pcegm048 #2;

   agifa133 #10;
   agifa134 #11;
   agifa079 #12;
   agifa024 #13;
   agifa112 #14;
|FIN;

|VARIABLES;
   aAlfa    = "";
   aAlfa1   = "";
   aAlfa2   = "";
   aIP      = "";
   aFichero = "";
   aOrigen  = "";
   aDestino = "";
   aPathBase = "";

   aDNomCli = "";
   aHNomCli = "";
   aNomFichero = "";
   aFichCliente = "";
   aFichProveed = "";
   aFichFrasVta = "";
   aFichFrasCmp = "";

   nHandle  = 0;
   nSwHay   = 0;
   nSwGrabo = 0;

   fFecha   = @;

   aFichCl = "";
   aFichPr = "";
   aFichFv = "";
   aFichFc = "";
|FIN;

|PROCESO ComienzoRegFV;
   #agifa133#4 = #agifa134#49;
   #agifa133#0 = #agifa134#0;
   #agifa133#1 = 1;
   |LEE 000#agifa133.];
   |SI FSalida ! 0; |O #agifa133#4 ! #agifa134#49; |O #agifa133#0 ! #agifa134#0;
      |DDEFECTO #agifa133;
      #agifa133#3 = #agifa134#1;
   |FINSI;

   aAlfa = &34 + #agifa134#49 + "/" + (("000000" + #agifa134#0) % -106) + &34 + aSepara; |XGRABA nHandle, aAlfa; || Invoice Number
   aAlfa = #agifa134#1; |QBF aAlfa;
   aAlfa = (aAlfa % 0102) + "/" + (aAlfa % 0402) + "/" + (aAlfa % 0902) + aSepara;       |XGRABA nHandle, aAlfa; || Invoice Date
   aAlfa = #agifa133#3; |QBF aAlfa;
   aAlfa = (aAlfa % 0102) + "/" + (aAlfa % 0402) + "/" + (aAlfa % 0902) + aSepara;       |XGRABA nHandle, aAlfa; || Due date
   aAlfa = &34 + #agifa134#3; |QBF aAlfa; aAlfa = aAlfa + &34 + aSepara;                 |XGRABA nHandle, aAlfa; || Customer name
   aAlfa = ""; |QBF aAlfa; aAlfa = aAlfa + aSepara;                                      |XGRABA nHandle, aAlfa; || Summary
   aAlfa = &34 + #agifa134#49 + "/" + (("000000" + #agifa134#0) % -106) + &34 + aSepara; |XGRABA nHandle, aAlfa; || Customer's reference
|FPRC;

|PROCESO FrasVta;
   #pcegm048#0 = "FV";
   #pcegm048#1 = #agifa134#49;
   #pcegm048#2 = #agifa134#0;
   |LEE 000#pcegm048.=;
   |SI FSalida = 0; |ACABA; |FINSI;

   nSwGrabo = 0;

   |SI #agifa134#91 ! 0;
      nSwHay = 1; nSwGrabo = 1;
      |HAZ ComienzoRegFV;
      aAlfa = &34 + #pcegm047#4; |QBF aAlfa; aAlfa = aAlfa + &34 + aSepara; |XGRABA nHandle, aAlfa; || Line Description
      aAlfa = #pcegm047#2; |QBF aAlfa;               |XGRABA nHandle, aAlfa; || Line Description
      aAlfa = aSepara + "1" + aSepara;               |XGRABA nHandle, aAlfa; || Line Quantity
      aAlfa = #agifa134#91 + aSepara;                |XGRABA nHandle, aAlfa; || Line Unit Price
      aAlfa = #agifa134#91 + aSepara;                |XGRABA nHandle, aAlfa; || Line Net Price
      || O una o la otra ....
      aAlfa = #agifa134#92 + aSepara;                |XGRABA nHandle, aAlfa; || Line VAT Amount
      ||aAlfa = #agifa134#39 + aSepara;              |XGRABA nHandle, aAlfa; || Line VAT Rate
      aAlfa = &13 + &10;                             |XGRABA nHandle, aAlfa; || Fin de linea
   |FINSI;
   |SI #agifa134#94 ! 0;
      nSwHay = 1; nSwGrabo = 1;
      |HAZ ComienzoRegFV;
      aAlfa = &34 + #pcegm047#5; |QBF aAlfa; aAlfa = aAlfa + &34 + aSepara; |XGRABA nHandle, aAlfa; || Line Description
      aAlfa = #pcegm047#2; |QBF aAlfa;               |XGRABA nHandle, aAlfa; || Line Description
      aAlfa = aSepara + "1" + aSepara;               |XGRABA nHandle, aAlfa; || Line Quantity
      aAlfa = #agifa134#94 + aSepara;                |XGRABA nHandle, aAlfa; || Line Unit Price
      aAlfa = #agifa134#94 + aSepara;                |XGRABA nHandle, aAlfa; || Line Net Price
      || O una o la otra ....
      aAlfa = #agifa134#95 + aSepara;                |XGRABA nHandle, aAlfa; || Line VAT Amount
      ||aAlfa = #agifa134#41 + aSepara;              |XGRABA nHandle, aAlfa; || Line VAT Rate
      aAlfa = &13 + &10;                             |XGRABA nHandle, aAlfa; || Fin de linea
   |FINSI;
   |SI #agifa134#97 ! 0;
      nSwHay = 1; nSwGrabo = 1;
      |HAZ ComienzoRegFV;
      aAlfa = &34 + #pcegm047#6; |QBF aAlfa; aAlfa = aAlfa + &34 + aSepara; |XGRABA nHandle, aAlfa; || Line Description
      aAlfa = #pcegm047#2; |QBF aAlfa;               |XGRABA nHandle, aAlfa; || Line Description
      aAlfa = aSepara + "1" + aSepara;               |XGRABA nHandle, aAlfa; || Line Quantity
      aAlfa = #agifa134#97 + aSepara;                |XGRABA nHandle, aAlfa; || Line Unit Price
      aAlfa = #agifa134#97 + aSepara;                |XGRABA nHandle, aAlfa; || Line Net Price
      || O una o la otra ....
      aAlfa = #agifa134#98 + aSepara;                |XGRABA nHandle, aAlfa; || Line VAT Amount
      ||aAlfa = #agifa134#43 + aSepara;              |XGRABA nHandle, aAlfa; || Line VAT Rate
      aAlfa = &13 + &10;                             |XGRABA nHandle, aAlfa; || Fin de linea
   |FINSI;
   |SI #agifa134#102 ! 0;
      nSwHay = 1; nSwGrabo = 1;
      |HAZ ComienzoRegFV;
      aAlfa = &34 + #pcegm047#7; |QBF aAlfa; aAlfa = aAlfa + &34 + aSepara; |XGRABA nHandle, aAlfa; || Line Description
      aAlfa = #pcegm047#2; |QBF aAlfa;               |XGRABA nHandle, aAlfa; || Line Description
      aAlfa = aSepara + "1" + aSepara;               |XGRABA nHandle, aAlfa; || Line Quantity
      aAlfa = #agifa134#102 + aSepara;               |XGRABA nHandle, aAlfa; || Line Unit Price
      aAlfa = #agifa134#102 + aSepara;               |XGRABA nHandle, aAlfa; || Line Net Price
      || O una o la otra ....
      aAlfa = #agifa134#103 + aSepara;               |XGRABA nHandle, aAlfa; || Line VAT Amount
      ||aAlfa = #agifa134#50 + aSepara;              |XGRABA nHandle, aAlfa; || Line VAT Rate
      aAlfa = &13 + &10;                             |XGRABA nHandle, aAlfa; || Fin de linea
   |FINSI;
   |SI #agifa134#105 ! 0;
      nSwHay = 1; nSwGrabo = 1;
      |HAZ ComienzoRegFV;
      aAlfa = &34 + #pcegm047#8; |QBF aAlfa; aAlfa = aAlfa + &34 + aSepara; |XGRABA nHandle, aAlfa; || Line Description
      aAlfa = #pcegm047#2; |QBF aAlfa;               |XGRABA nHandle, aAlfa; || Line Description
      aAlfa = aSepara + "1" + aSepara;               |XGRABA nHandle, aAlfa; || Line Quantity
      aAlfa = #agifa134#105 + aSepara;               |XGRABA nHandle, aAlfa; || Line Unit Price
      aAlfa = #agifa134#105 + aSepara;               |XGRABA nHandle, aAlfa; || Line Net Price
      || O una o la otra ....
      aAlfa = #agifa134#106 + aSepara;               |XGRABA nHandle, aAlfa; || Line VAT Amount
      ||aAlfa = #agifa134#52;                        |XGRABA nHandle, aAlfa; || Line VAT Rate
      aAlfa = &13 + &10;                             |XGRABA nHandle, aAlfa; || Fin de linea
   |FINSI;

   |SI nSwGrabo = 1;
      |DDEFECTO #pcegm048;
      #pcegm048#0 = "FV";
      #pcegm048#1 = #agifa134#49;
      #pcegm048#2 = #agifa134#0;
      #pcegm048#3 = ~;
      |GRABA 020#pcegm048.n;
   |FINSI;
|FPRC;

|DEFBUCLE FrasVta;
#agifa134#2;
;
aDNomCli, #pcegz102#2, #pcegz102#0, #pcegz102#1;
aHNomCli, #pcegz102#5, #pcegz102#3, #pcegz102#4;
;
NULL, FrasVta;
|FIN;

|PROCESO CabFrasVta;
   aAlfa = &34 + "Invoice Number"             + &34 + ",";
   aAlfa = aAlfa + &34 + "Invoice Date"       + &34 + ",";
   aAlfa = aAlfa + &34 + "Due Date"           + &34 + ",";
   ||aAlfa = aAlfa + &34 + "Credit Terms"       + &34 + ",";
   aAlfa = aAlfa + &34 + "Customer Name"      + &34 + ",";
   aAlfa = aAlfa + &34 + "Summary "           + &34 + ",";
   aAlfa = aAlfa + &34 + "Reference"          + &34 + ",";
   aAlfa = aAlfa + &34 + "Line Description "  + &34 + ",";
   aAlfa = aAlfa + &34 + "Line Account Code " + &34 + ",";
   aAlfa = aAlfa + &34 + "Line Quantity "     + &34 + ",";
   aAlfa = aAlfa + &34 + "Line Unit Price "   + &34 + ",";
   aAlfa = aAlfa + &34 + "Line Net Price"     + &34 + ",";
   aAlfa = aAlfa + &34 + "Line VAT Amount "   + &34 + ",";
   aAlfa = aAlfa + &34 + "Line VAT Rate "     + &34 + &13 + &10;
   |XGRABA nHandle, aAlfa;
|FPRC;

|PROCESO FacturasVenta;
   fFecha = ~; aAlfa1 = fFecha;
   |HORA aAlfa; |QBF aAlfa; aAlfa = (aAlfa % 0102) + (aAlfa % 0402) + (aAlfa % 0702);
   aAlfa1 = "fv" + (aAlfa1 % 0102) + (aAlfa1 % 0402) + (aAlfa1 % 0704) + aAlfa;

   |DFICE aAlfa; |QBF aAlfa; aAlfa = aAlfa + "tmp/"; |MKDIR aAlfa;
   aNomFichero = aAlfa + aAlfa1 + ".csv";
   aFichFrasVta = aNomFichero;
   |XABRE "WB", aNomFichero, nHandle;
   |SI FSalida ] 0;
      nSwHay = 0;
      |HAZ CabFrasVta;
      aDNomCli = " " * 60; aHNomCli = "z" * 60; |BUCLE FrasVta;
      |XCIERRA nHandle;
      |SI nSwHay = 0; |FBORRA aNomFichero; |FINSI;
   |FINSI;
|FPRC;

|PROCESO ComienzoRegFC;
   aAlfa = &34 + #agifa079#66 + "/" + (("000000" + #agifa079#0) % -106) + &34 + aSepara;     |XGRABA nHandle, aAlfa; || Invoice Number
   aAlfa = #agifa079#1; |QBF aAlfa;
   aAlfa = (aAlfa % 0102) + "/" + (aAlfa % 0402) + "/" + (aAlfa % 0902) + aSepara; |XGRABA nHandle, aAlfa; || Bill Date
   aAlfa = &34 + #agifa079#3; |QBF aAlfa; aAlfa = aAlfa + &34 + aSepara;           |XGRABA nHandle, aAlfa; || Supplier name
   aAlfa = &34 + #agifa079#74; |QBF aAlfa; aAlfa = aAlfa + &34 + aSepara;          |XGRABA nHandle, aAlfa; || Invoice number
|FPRC;

|PROCESO FrasCmp;
   #pcegm048#0 = "FC";
   #pcegm048#1 = #agifa079#66;
   #pcegm048#2 = #agifa079#0;
   |LEE 000#pcegm048.=;
   |SI FSalida = 0; |ACABA; |FINSI;

   nSwGrabo = 0;
   |SI #agifa079#108 ! 0;
      nSwHay = 1; nSwGrabo = 1;
      |HAZ ComienzoRegFC;
      aAlfa = &34 + #pcegm047#9; |QBF aAlfa; aAlfa = aAlfa + &34 + aSepara; |XGRABA nHandle, aAlfa; || Line Description
      aAlfa = #pcegm047#3;  |QBF aAlfa;              |XGRABA nHandle, aAlfa; || Line Account code
      aAlfa = aSepara + "1" + aSepara;               |XGRABA nHandle, aAlfa; || Line Quantity
      aAlfa = #agifa079#108 + aSepara;               |XGRABA nHandle, aAlfa; || Line Unit Price
      || O una o la otra ....
      aAlfa = #agifa079#109 + aSepara;               |XGRABA nHandle, aAlfa; || Line VAT Amount
      ||aAlfa = #agifa079#56 + aSepara;              |XGRABA nHandle, aAlfa; || Line VAT Rate
      aAlfa = &13 + &10;                             |XGRABA nHandle, aAlfa; || Fin de linea
   |FINSI;
   |SI #agifa079#111 ! 0;
      nSwHay = 1; nSwGrabo = 1;
      |HAZ ComienzoRegFC;
      aAlfa = &34 + #pcegm047#10; |QBF aAlfa; aAlfa = aAlfa + &34 + aSepara; |XGRABA nHandle, aAlfa; || Line Description
      aAlfa = #pcegm047#3; |QBF aAlfa;               |XGRABA nHandle, aAlfa; || Line Account code
      aAlfa = aSepara + "1" + aSepara;               |XGRABA nHandle, aAlfa; || Line Quantity
      aAlfa = #agifa079#111 + aSepara;               |XGRABA nHandle, aAlfa; || Line Unit Price
      || O una o la otra ....
      aAlfa = #agifa079#112 + aSepara;               |XGRABA nHandle, aAlfa; || Line VAT Amount
      ||aAlfa = #agifa079#58 + aSepara;              |XGRABA nHandle, aAlfa; || Line VAT Rate
      aAlfa = &13 + &10;                             |XGRABA nHandle, aAlfa; || Fin de linea
   |FINSI;
   |SI #agifa079#114 ! 0;
      nSwHay = 1; nSwGrabo = 1;
      |HAZ ComienzoRegFC;
      aAlfa = &34 + #pcegm047#11; |QBF aAlfa; aAlfa = aAlfa + &34 + aSepara; |XGRABA nHandle, aAlfa; || Line Description
      aAlfa = #pcegm047#3; |QBF aAlfa;               |XGRABA nHandle, aAlfa; || Line Account code
      aAlfa = aSepara + "1" + aSepara;               |XGRABA nHandle, aAlfa; || Line Quantity
      aAlfa = #agifa079#114 + aSepara;               |XGRABA nHandle, aAlfa; || Line Unit Price
      || O una o la otra ....
      aAlfa = #agifa079#115 + aSepara;               |XGRABA nHandle, aAlfa; || Line VAT Amount
      ||aAlfa = #agifa079#60 + aSepara;              |XGRABA nHandle, aAlfa; || Line VAT Rate
      aAlfa = &13 + &10;                             |XGRABA nHandle, aAlfa; || Fin de linea
   |FINSI;
   |SI #agifa079#119 ! 0;
      nSwHay = 1; nSwGrabo = 1;
      |HAZ ComienzoRegFC;
      aAlfa = &34 + #pcegm047#12; |QBF aAlfa; aAlfa = aAlfa + &34 + aSepara; |XGRABA nHandle, aAlfa; || Line Description
      aAlfa = #pcegm047#3; |QBF aAlfa;               |XGRABA nHandle, aAlfa; || Line Account code
      aAlfa = aSepara + "1" + aSepara;               |XGRABA nHandle, aAlfa; || Line Quantity
      aAlfa = #agifa079#119 + aSepara;               |XGRABA nHandle, aAlfa; || Line Unit Price
      || O una o la otra ....
      aAlfa = #agifa079#120 + aSepara;               |XGRABA nHandle, aAlfa; || Line VAT Amount
      ||aAlfa = #agifa079#62 + aSepara;              |XGRABA nHandle, aAlfa; || Line VAT Rate
      aAlfa = &13 + &10;                             |XGRABA nHandle, aAlfa; || Fin de linea
   |FINSI;
   |SI #agifa079#122 ! 0;
      nSwHay = 1; nSwGrabo = 1;
      |HAZ ComienzoRegFC;
      aAlfa = &34 + #pcegm047#13; |QBF aAlfa; aAlfa = aAlfa + &34 + aSepara; |XGRABA nHandle, aAlfa; || Line Description
      aAlfa = #pcegm047#3; |QBF aAlfa;               |XGRABA nHandle, aAlfa; || Line Account code
      aAlfa = aSepara + "1" + aSepara;               |XGRABA nHandle, aAlfa; || Line Quantity
      aAlfa = #agifa079#122 + aSepara;               |XGRABA nHandle, aAlfa; || Line Unit Price
      || O una o la otra ....
      aAlfa = #agifa079#123 + aSepara;               |XGRABA nHandle, aAlfa; || Line VAT Amount
      ||aAlfa = #agifa079#64 + aSepara;              |XGRABA nHandle, aAlfa; || Line VAT Rate
      aAlfa = &13 + &10;                             |XGRABA nHandle, aAlfa; || Fin de linea
   |FINSI;

   |DDEFECTO #pcegm048;
   #pcegm048#0 = "FC";
   #pcegm048#1 = #agifa079#66;
   #pcegm048#2 = #agifa079#0;
   #pcegm048#3 = ~;
   |GRABA 020#pcegm048.n;
|FPRC;

|DEFBUCLE FrasCmp;
#agifa079#3;
;
" ", "      ", #pcegz102#2, #pcegz102#0, #pcegz102#1;
"z", "zzzzzz", #pcegz102#5, #pcegz102#3, #pcegz102#4;
;
NULL, FrasCmp;
|FIN;

|PROCESO CabFrasCmp;
   aAlfa = &34 + "Bill ID"                    + &34 + aSepara;
   aAlfa = aAlfa + &34 + "Bill Date"          + &34 + aSepara;
   aAlfa = aAlfa + &34 + "Due Date"           + &34 + aSepara;
   ||aAlfa = aAlfa + &34 + "Credit Terms"       + &34 + aSepara;
   aAlfa = aAlfa + &34 + "Supplier Name"      + &34 + aSepara;
   aAlfa = aAlfa + &34 + "Invoice Number"     + &34 + aSepara;
   aAlfa = aAlfa + &34 + "Line Description "  + &34 + aSepara;
   aAlfa = aAlfa + &34 + "Line Account Code " + &34 + aSepara;
   aAlfa = aAlfa + &34 + "Line Quantity "     + &34 + aSepara;
   aAlfa = aAlfa + &34 + "Line Unit Price "   + &34 + aSepara;
   aAlfa = aAlfa + &34 + "Line VAT Amount "   + &34 + aSepara;
   aAlfa = aAlfa + &34 + "Line VAT Rate "     + &34 + &13 + &10;
   |XGRABA nHandle, aAlfa;
|FPRC;

|PROCESO FacturasCompra;
   fFecha = ~; aAlfa1 = fFecha;
   |HORA aAlfa; |QBF aAlfa; aAlfa = (aAlfa % 0102) + (aAlfa % 0402) + (aAlfa % 0702);
   aAlfa1 = "fc" + (aAlfa1 % 0102) + (aAlfa1 % 0402) + (aAlfa1 % 0704) + aAlfa;

   |DFICE aAlfa; |QBF aAlfa; aAlfa = aAlfa + "tmp/"; |MKDIR aAlfa;
   aNomFichero = aAlfa + aAlfa1 + ".csv";
   aFichFrasCmp = aNomFichero;
   |XABRE "WB", aNomFichero, nHandle;
   |SI FSalida ] 0;
      nSwHay = 0;
      |HAZ CabFrasVta; |BUCLE FrasCmp;
      |XCIERRA nHandle;
      |SI nSwHay = 0; |FBORRA aNomFichero; |FINSI;
   |FINSI;
|FPRC;

|PROCESO CabProveed;
   aAlfa =         &34 + "Supplier  "            + &34 + aSepara;
   aAlfa = aAlfa + &34 + "Contact name "         + &34 + aSepara;
   aAlfa = aAlfa + &34 + "Building"              + &34 + aSepara;
   aAlfa = aAlfa + &34 + "Address Line 1"        + &34 + aSepara;
   aAlfa = aAlfa + &34 + "Address Line 2"        + &34 + aSepara;
   aAlfa = aAlfa + &34 + "Town"                  + &34 + aSepara;
   aAlfa = aAlfa + &34 + "County"                + &34 + aSepara;
   aAlfa = aAlfa + &34 + "Country"               + &34 + aSepara;
   aAlfa = aAlfa + &34 + "Postcode "             + &34 + aSepara;
   aAlfa = aAlfa + &34 + "Email"                 + &34 + aSepara;
   aAlfa = aAlfa + &34 + "Phone 1"               + &34 + aSepara;
   aAlfa = aAlfa + &34 + "Phone 2"               + &34 + aSepara;
   aAlfa = aAlfa + &34 + "Fax"                   + &34 + aSepara;
   aAlfa = aAlfa + &34 + "Website "              + &34 + aSepara;
   aAlfa = aAlfa + &34 + "VAT Number"            + &34 + &13 + &10;
   |XGRABA nHandle, aAlfa;
|FPRC;

|PROCESO PasaProveed;
   #pcegm048#0 = "PR";
   #pcegm048#1 = #agifa112#0;
   #pcegm048#2 = "";
   |LEE 000#pcegm048.=;
   |SI FSalida = 0; |ACABA; |FINSI;

   nSwHay = 1;
   aAlfa = &34 + #agifa112#2;  |QBF aAlfa; aAlfa = aAlfa + &34 + aSepara;  |XGRABA nHandle, aAlfa;
   aAlfa = &34 + #agifa112#2;  |QBF aAlfa; aAlfa = aAlfa + &34 + aSepara + aSepara; |XGRABA nHandle, aAlfa;
   aAlfa = &34 + #agifa112#3;  |QBF aAlfa; aAlfa = aAlfa + &34 + aSepara + aSepara; |XGRABA nHandle, aAlfa;
   aAlfa = &34 + #agifa112#4;  |QBF aAlfa; aAlfa = aAlfa + &34 + aSepara;  |XGRABA nHandle, aAlfa;
   aAlfa = &34 + #agifa112#5;  |QBF aAlfa; aAlfa = aAlfa + &34 + aSepara;  |XGRABA nHandle, aAlfa;
   aAlfa = &34 + #agifa112#89; |QBF aAlfa; aAlfa = aAlfa + &34 + aSepara;  |XGRABA nHandle, aAlfa;
   aAlfa = (("00" + #agifa112#74) % -102) + (("000" + #agifa112#75)); |QBF aAlfa; aAlfa = aAlfa + aSepara;  |XGRABA nHandle, aAlfa;
   aAlfa = &34 + #agifa112#84; |QBF aAlfa; aAlfa = aAlfa + &34 + aSepara;  |XGRABA nHandle, aAlfa;
   aAlfa = &34 + #agifa112#6;  |QBF aAlfa; aAlfa = aAlfa + &34 + aSepara;  |XGRABA nHandle, aAlfa;
   aAlfa = &34 + #agifa112#83; |QBF aAlfa; aAlfa = aAlfa + &34 + aSepara;  |XGRABA nHandle, aAlfa;
   aAlfa = &34 + #agifa112#7;  |QBF aAlfa; aAlfa = aAlfa + &34 + aSepara;  |XGRABA nHandle, aAlfa;
   aAlfa = &34 + #agifa112#109; |QBF aAlfa; aAlfa = aAlfa + &34 + aSepara;
   aAlfa = aAlfa + &13 + &10;   |XGRABA nHandle, aAlfa;

   |DDEFECTO #pcegm048;
   #pcegm048#0 = "PR";
   #pcegm048#1 = #agifa112#0;
   #pcegm048#2 = "";
   #pcegm048#3 = ~;
   |GRABA 020#pcegm048.n;
|FPRC;

|DEFBUCLE PasaProveed;
#agifa112#1;
;
#pcegz102#14;
#pcegz102#15;
;
NULL, PasaProveed;
|FIN;

|PROCESO Proveedores;
   fFecha = ~; aAlfa1 = fFecha;
   |HORA aAlfa; |QBF aAlfa; aAlfa = (aAlfa % 0102) + (aAlfa % 0402) + (aAlfa % 0702);
   aAlfa1 = "pr" + (aAlfa1 % 0102) + (aAlfa1 % 0402) + (aAlfa1 % 0704) + aAlfa;

   |DFICE aAlfa; |QBF aAlfa; aAlfa = aAlfa + "tmp/"; |MKDIR aAlfa;
   aNomFichero = aAlfa + aAlfa1 + ".csv";
   aFichProveed = aNomFichero;
   |XABRE "WB", aNomFichero, nHandle;
   |SI FSalida ] 0;
      nSwHay = 0;
      |HAZ CabProveed; |BUCLE PasaProveed;
      |XCIERRA nHandle;
      |SI nSwHay = 0; |FBORRA aNomFichero; |FINSI;
   |FINSI;
|FPRC;

|PROCESO CabClientes;
   aAlfa =         &34 + "Customer  "            + &34 + aSepara;
   aAlfa = aAlfa + &34 + "Contact name "         + &34 + aSepara;
   aAlfa = aAlfa + &34 + "Building"              + &34 + aSepara;
   aAlfa = aAlfa + &34 + "Address Line 1"        + &34 + aSepara;
   aAlfa = aAlfa + &34 + "Address Line 2"        + &34 + aSepara;
   aAlfa = aAlfa + &34 + "Town"                  + &34 + aSepara;
   aAlfa = aAlfa + &34 + "County"                + &34 + aSepara;
   aAlfa = aAlfa + &34 + "Postcode "             + &34 + aSepara;
   aAlfa = aAlfa + &34 + "Email"                 + &34 + aSepara;
   aAlfa = aAlfa + &34 + "Phone 1"               + &34 + aSepara;
   aAlfa = aAlfa + &34 + "Phone 2"               + &34 + aSepara;
   aAlfa = aAlfa + &34 + "Fax"                   + &34 + aSepara;
   aAlfa = aAlfa + &34 + "Website "              + &34 + aSepara;
   aAlfa = aAlfa + &34 + "VAT Number"            + &34 + &13 + &10;
   |XGRABA nHandle, aAlfa;
|FPRC;

|PROCESO PasaClientes;
   #pcegm048#0 = "CL";
   #pcegm048#1 = #agifa024#0;
   #pcegm048#2 = "";
   |LEE 000#pcegm048.=;
   |SI FSalida = 0; |ACABA; |FINSI;

   nSwHay = 1;
   aAlfa = &34 + #agifa024#2; |QBF aAlfa; aAlfa = aAlfa + &34 + aSepara;  |XGRABA nHandle, aAlfa;
   aAlfa = &34 + #agifa024#2; |QBF aAlfa; aAlfa = aAlfa + &34 + aSepara + aSepara; |XGRABA nHandle, aAlfa;
   aAlfa = &34 + #agifa024#5; |QBF aAlfa; aAlfa = aAlfa + &34 + aSepara + aSepara; |XGRABA nHandle, aAlfa;
   aAlfa = &34 + #agifa024#6; |QBF aAlfa; aAlfa = aAlfa + &34 + aSepara;  |XGRABA nHandle, aAlfa;
   aAlfa = &34 + #agifa024#7; |QBF aAlfa; aAlfa = aAlfa + &34 + aSepara;  |XGRABA nHandle, aAlfa;
   aAlfa = (("00" + #agifa024#178) % -102) + (("000" + #agifa024#179)); |QBF aAlfa; aAlfa = aAlfa + ",";  |XGRABA nHandle, aAlfa;
   aAlfa = &34 + #agifa024#197; |QBF aAlfa; aAlfa = aAlfa + &34 + aSepara;  |XGRABA nHandle, aAlfa;
   aAlfa = &34 + #agifa024#17;  |QBF aAlfa; aAlfa = aAlfa + &34 + aSepara;  |XGRABA nHandle, aAlfa;
   aAlfa = &34 + #agifa024#196; |QBF aAlfa; aAlfa = aAlfa + &34 + aSepara;  |XGRABA nHandle, aAlfa;
   aAlfa = &34 + #agifa024#18;  |QBF aAlfa; aAlfa = aAlfa + &34 + aSepara;  |XGRABA nHandle, aAlfa;
   aAlfa = &34 + #agifa024#214; |QBF aAlfa; aAlfa = aAlfa + &34 + aSepara;
   aAlfa = aAlfa + &13 + &10;   |XGRABA nHandle, aAlfa;

   |DDEFECTO #pcegm048;
   #pcegm048#0 = "CL";
   #pcegm048#1 = #agifa024#0;
   #pcegm048#2 = "";
   #pcegm048#3 = ~;
   |GRABA 020#pcegm048.n;
|FPRC;

|DEFBUCLE PasaClientes;
#agifa024#1;
;
#pcegz102#12;
#pcegz102#13;
;
NULL, PasaClientes;
|FIN;

|PROCESO Clientes;
   fFecha = ~; aAlfa1 = fFecha;
   |HORA aAlfa; |QBF aAlfa; aAlfa = (aAlfa % 0102) + (aAlfa % 0402) + (aAlfa % 0702);
   aAlfa1 = "cl" + (aAlfa1 % 0102) + (aAlfa1 % 0402) + (aAlfa1 % 0704) + aAlfa;

   |DFICE aAlfa; |QBF aAlfa; aAlfa = aAlfa + "tmp/"; |MKDIR aAlfa;
   aNomFichero = aAlfa + aAlfa1 + ".csv";
   aFichCliente = aNomFichero;
   |XABRE "WB", aNomFichero, nHandle;
   |SI FSalida ] 0;
      nSwHay = 0;
      |HAZ CabClientes; |BUCLE PasaClientes;
      |XCIERRA nHandle;
      |SI nSwHay = 0; |FBORRA aNomFichero; |FINSI;
   |FINSI;
|FPRC;

|PROCESO CopiaFich;
   aAlfa = aFichero; aAlfa1 = "";
   aAlfa2 = aAlfa % -101;
   |PARA; |SI aAlfa ! ""; |Y aAlfa2 ! "/"; |Y aAlfa2 ! "\"; |HACIENDO;
      aAlfa1 = aAlfa2 + aAlfa1; aAlfa = aAlfa % -299;
      aAlfa2 = aAlfa % -101;
   |SIGUE;

   aOrigen = aFichero;
   aDestino = #pcegz102#16; |QBF aDestino;
   aAlfa2 = aDestino % -101;
   |SI aAlfa2 ! "/"; |Y aAlfa2 ! "\";
      aAlfa2 = aDestino - "/";
      |SI FSalida ! 0;
         aDestino = aDestino + "/";
      |SINO;
         aDestino = aDestino + "\";
      |FINSI;
   |FINSI;

   aDestino = aDestino + aAlfa1;
   |ENVIA_FICHERO aOrigen, aDestino;
|FPRC;

|PROGRAMA;
   |ABRE #pcegz102;
   |ABRE #pcegm047; |ABRE #pcegm048;
   aIP = ""; |IP_REMOTO aIP;
   #pcegz102#6 = aIP;
   |LEE 000#pcegz102.=;
   |SI FSalida ! 0;
      |DDEFECTO #pcegz102;
      #pcegz102#6 = aIP;
      |GRABA 020#pcegz102.c;
   |FINSI;

   |LEE 000#pcegm047.p;
   |SI FSalida ! 0; |DDEFECTO #pcegm047; |FINSI;

   aSepara = ",";

   |CLS;
   |CABEZA "Exportacion a Clearbooks";

   |PINPA #0#0; |PINDA #0#0;
   |ENDATOS #1#0;
   |SI FSalida = 0;
      |GRABA 020#pcegz102.a;

      |SI #pcegz102#7  = "S"; |HAZ Clientes;       |FINSI;
      |SI #pcegz102#8  = "S"; |HAZ Proveedores;    |FINSI;
      |SI #pcegz102#10 = "S"; |HAZ FacturasVenta;  |FINSI;
      |SI #pcegz102#11 = "S"; |HAZ FacturasCompra; |FINSI;

      aAlfa2 = #pcegz102#16; |QBF aAlfa2;
      |SI aAlfa2 ! "";
         aFichero = aFichCliente;  |HAZ CopiaFich;
         aFichero = aFichProveed;  |HAZ CopiaFich;
         aFichero = aFichFrasVta;  |HAZ CopiaFich;
         aFichero = aFichFrasCmp;  |HAZ CopiaFich;
      |FINSI;
   |FINSI;
   |CIERRA #pcegz102;
   |CIERRA #pcegm047; |CIERRA #pcegm048;
|FPRO;
*/












|FICHEROS;
   pcegz102 #0;
   pcegm046 #1;
   pcegm047 #2;

   agifa133 #10;
   agifa134 #11;
   agifa079 #12;
   agifa024 #13;
   agifa112 #14;
   agifa084 #15;

   pcegw018 #100;

   Referen@ #1000;
|FIN;

|VARIABLES;
   &eaPath   = "";
   &eaFich   = "";

   aAlfa     = "";
   aAlfa1    = "";
   aAlfa2    = "";

   aIP       = "";
   aPathBase = "";
   aPathEmp  = "";
   aPathBas  = "";
   aFichCl   = "";
   aFichPr   = "";
   aFichFv   = "";
   aFichFc   = "";
   aSepara   = "";

   nCalc     = 0;
   nSwCli    = 0;
   nSwPro    = 0;
   nSwFVt    = 0;
   nSwFCm    = 0;

   nHandle   = 0;
   nHandCl   = 0;
   nHandPr   = 0;
   nHandFv   = 0;
   nHandFc   = 0;

   fFecha    = @;
|FIN;

|PROCESO CabFrasVta;
   aAlfa = &34 + "Invoice Number"             + &34 + ",";
   aAlfa = aAlfa + &34 + "Invoice Date"       + &34 + ",";
   aAlfa = aAlfa + &34 + "Due Date"           + &34 + ",";
   ||aAlfa = aAlfa + &34 + "Credit Terms"       + &34 + ",";
   aAlfa = aAlfa + &34 + "Customer Name"      + &34 + ",";
   aAlfa = aAlfa + &34 + "Summary "           + &34 + ",";
   aAlfa = aAlfa + &34 + "Reference"          + &34 + ",";
   aAlfa = aAlfa + &34 + "Line Description "  + &34 + ",";
   aAlfa = aAlfa + &34 + "Line Account Code " + &34 + ",";
   aAlfa = aAlfa + &34 + "Line Quantity "     + &34 + ",";
   aAlfa = aAlfa + &34 + "Line Unit Price "   + &34 + ",";
   aAlfa = aAlfa + &34 + "Line Net Price"     + &34 + ",";
   aAlfa = aAlfa + &34 + "Line VAT Amount "   + &34 + ",";
   aAlfa = aAlfa + &34 + "Line VAT Rate "     + &34 + &13 + &10;
   |XGRABA nHandFv, aAlfa;
|FPRC;

|PROCESO ComienzoRegFV;
   #agifa133#4 = #agifa134#49;
   #agifa133#0 = #agifa134#0;
   #agifa133#1 = 1;
   |LEE 000#agifa133.];
   |SI FSalida ! 0; |O #agifa133#4 ! #agifa134#49; |O #agifa133#0 ! #agifa134#0;
      |DDEFECTO #agifa133;
      #agifa133#3 = #agifa134#1;
   |FINSI;

   aAlfa = &34 + #agifa134#49 + "/" + (("000000" + #agifa134#0) % -106) + &34 + aSepara; |XGRABA nHandFv, aAlfa; || Invoice Number
   aAlfa = #agifa134#1; |QBF aAlfa;
   aAlfa = (aAlfa % 0102) + "/" + (aAlfa % 0402) + "/" + (aAlfa % 0902) + aSepara;       |XGRABA nHandFv, aAlfa; || Invoice Date
   aAlfa = #agifa133#3; |QBF aAlfa;
   aAlfa = (aAlfa % 0102) + "/" + (aAlfa % 0402) + "/" + (aAlfa % 0902) + aSepara;       |XGRABA nHandFv, aAlfa; || Due date
   aAlfa = &34 + #agifa134#3; |QBF aAlfa; aAlfa = aAlfa + &34 + aSepara;                 |XGRABA nHandFv, aAlfa; || Customer name
   aAlfa = ""; |QBF aAlfa; aAlfa = aAlfa + aSepara;                                      |XGRABA nHandFv, aAlfa; || Summary
   aAlfa = &34 + #agifa134#49 + "/" + (("000000" + #agifa134#0) % -106) + &34 + aSepara; |XGRABA nHandFv, aAlfa; || Customer's reference
|FPRC;

|PROCESO FrasVta;
   |SI #agifa134#91 ! 0;
      |HAZ ComienzoRegFV;
      aAlfa = &34 + #pcegm047#4; |QBF aAlfa; aAlfa = aAlfa + &34 + aSepara; |XGRABA nHandFv, aAlfa; || Line Description
      aAlfa = #pcegm047#2; |QBF aAlfa;               |XGRABA nHandFv, aAlfa; || Line Description
      aAlfa = aSepara + "1" + aSepara;               |XGRABA nHandFv, aAlfa; || Line Quantity
      aAlfa = #agifa134#91 + aSepara;                |XGRABA nHandFv, aAlfa; || Line Unit Price
      aAlfa = #agifa134#91 + aSepara;                |XGRABA nHandFv, aAlfa; || Line Net Price
      || O una o la otra ....
      aAlfa = #agifa134#92 + aSepara;                |XGRABA nHandFv, aAlfa; || Line VAT Amount
      ||aAlfa = #agifa134#39 + aSepara;              |XGRABA nHandFv, aAlfa; || Line VAT Rate
      aAlfa = &13 + &10;                             |XGRABA nHandFv, aAlfa; || Fin de linea
   |FINSI;
   |SI #agifa134#94 ! 0;
      |HAZ ComienzoRegFV;
      aAlfa = &34 + #pcegm047#5; |QBF aAlfa; aAlfa = aAlfa + &34 + aSepara; |XGRABA nHandFv, aAlfa; || Line Description
      aAlfa = #pcegm047#2; |QBF aAlfa;               |XGRABA nHandFv, aAlfa; || Line Description
      aAlfa = aSepara + "1" + aSepara;               |XGRABA nHandFv, aAlfa; || Line Quantity
      aAlfa = #agifa134#94 + aSepara;                |XGRABA nHandFv, aAlfa; || Line Unit Price
      aAlfa = #agifa134#94 + aSepara;                |XGRABA nHandFv, aAlfa; || Line Net Price
      || O una o la otra ....
      aAlfa = #agifa134#95 + aSepara;                |XGRABA nHandFv, aAlfa; || Line VAT Amount
      ||aAlfa = #agifa134#41 + aSepara;              |XGRABA nHandFv, aAlfa; || Line VAT Rate
      aAlfa = &13 + &10;                             |XGRABA nHandFv, aAlfa; || Fin de linea
   |FINSI;
   |SI #agifa134#97 ! 0;
      |HAZ ComienzoRegFV;
      aAlfa = &34 + #pcegm047#6; |QBF aAlfa; aAlfa = aAlfa + &34 + aSepara; |XGRABA nHandFv, aAlfa; || Line Description
      aAlfa = #pcegm047#2; |QBF aAlfa;               |XGRABA nHandFv, aAlfa; || Line Description
      aAlfa = aSepara + "1" + aSepara;               |XGRABA nHandFv, aAlfa; || Line Quantity
      aAlfa = #agifa134#97 + aSepara;                |XGRABA nHandFv, aAlfa; || Line Unit Price
      aAlfa = #agifa134#97 + aSepara;                |XGRABA nHandFv, aAlfa; || Line Net Price
      || O una o la otra ....
      aAlfa = #agifa134#98 + aSepara;                |XGRABA nHandFv, aAlfa; || Line VAT Amount
      ||aAlfa = #agifa134#43 + aSepara;              |XGRABA nHandFv, aAlfa; || Line VAT Rate
      aAlfa = &13 + &10;                             |XGRABA nHandFv, aAlfa; || Fin de linea
   |FINSI;
   |SI #agifa134#102 ! 0;
      |HAZ ComienzoRegFV;
      aAlfa = &34 + #pcegm047#7; |QBF aAlfa; aAlfa = aAlfa + &34 + aSepara; |XGRABA nHandFv, aAlfa; || Line Description
      aAlfa = #pcegm047#2; |QBF aAlfa;               |XGRABA nHandFv, aAlfa; || Line Description
      aAlfa = aSepara + "1" + aSepara;               |XGRABA nHandFv, aAlfa; || Line Quantity
      aAlfa = #agifa134#102 + aSepara;               |XGRABA nHandFv, aAlfa; || Line Unit Price
      aAlfa = #agifa134#102 + aSepara;               |XGRABA nHandFv, aAlfa; || Line Net Price
      || O una o la otra ....
      aAlfa = #agifa134#103 + aSepara;               |XGRABA nHandFv, aAlfa; || Line VAT Amount
      ||aAlfa = #agifa134#50 + aSepara;              |XGRABA nHandFv, aAlfa; || Line VAT Rate
      aAlfa = &13 + &10;                             |XGRABA nHandFv, aAlfa; || Fin de linea
   |FINSI;
   |SI #agifa134#105 ! 0;
      |HAZ ComienzoRegFV;
      aAlfa = &34 + #pcegm047#8; |QBF aAlfa; aAlfa = aAlfa + &34 + aSepara; |XGRABA nHandFv, aAlfa; || Line Description
      aAlfa = #pcegm047#2; |QBF aAlfa;               |XGRABA nHandFv, aAlfa; || Line Description
      aAlfa = aSepara + "1" + aSepara;               |XGRABA nHandFv, aAlfa; || Line Quantity
      aAlfa = #agifa134#105 + aSepara;               |XGRABA nHandFv, aAlfa; || Line Unit Price
      aAlfa = #agifa134#105 + aSepara;               |XGRABA nHandFv, aAlfa; || Line Net Price
      || O una o la otra ....
      aAlfa = #agifa134#106 + aSepara;               |XGRABA nHandFv, aAlfa; || Line VAT Amount
      ||aAlfa = #agifa134#52;                        |XGRABA nHandFv, aAlfa; || Line VAT Rate
      aAlfa = &13 + &10;                             |XGRABA nHandFv, aAlfa; || Fin de linea
   |FINSI;
|FPRC;

|PROCESO CabFrasCmp;
   aAlfa = &34 + "Bill ID"                    + &34 + aSepara;
   aAlfa = aAlfa + &34 + "Bill Date"          + &34 + aSepara;
   aAlfa = aAlfa + &34 + "Due Date"           + &34 + aSepara;
   ||aAlfa = aAlfa + &34 + "Credit Terms"       + &34 + aSepara;
   aAlfa = aAlfa + &34 + "Supplier Name"      + &34 + aSepara;
   aAlfa = aAlfa + &34 + "Invoice Number"     + &34 + aSepara;
   aAlfa = aAlfa + &34 + "Line Description "  + &34 + aSepara;
   aAlfa = aAlfa + &34 + "Line Account Code " + &34 + aSepara;
   aAlfa = aAlfa + &34 + "Line Quantity "     + &34 + aSepara;
   aAlfa = aAlfa + &34 + "Line Unit Price "   + &34 + aSepara;
   aAlfa = aAlfa + &34 + "Line VAT Amount "   + &34 + aSepara;
   aAlfa = aAlfa + &34 + "Line VAT Rate "     + &34 + &13 + &10;
   |XGRABA nHandFc, aAlfa;
|FPRC;

|PROCESO ComienzoRegFC;
   aAlfa = &34 + #agifa079#66 + "/" + (("000000" + #agifa079#0) % -106) + &34 + aSepara;     |XGRABA nHandFc, aAlfa; || Invoice Number
   aAlfa = #agifa079#1; |QBF aAlfa;
   aAlfa = (aAlfa % 0102) + "/" + (aAlfa % 0402) + "/" + (aAlfa % 0902) + aSepara; |XGRABA nHandFc, aAlfa; || Bill Date
   aAlfa = &34 + #agifa079#3; |QBF aAlfa; aAlfa = aAlfa + &34 + aSepara;           |XGRABA nHandFc, aAlfa; || Supplier name
   aAlfa = &34 + #agifa079#74; |QBF aAlfa; aAlfa = aAlfa + &34 + aSepara;          |XGRABA nHandFc, aAlfa; || Invoice number
|FPRC;

|PROCESO FrasCmp;
   |SI #agifa079#108 ! 0;
      |HAZ ComienzoRegFC;
      aAlfa = &34 + #pcegm047#9; |QBF aAlfa; aAlfa = aAlfa + &34 + aSepara; |XGRABA nHandFc, aAlfa; || Line Description
      aAlfa = #pcegm047#3;  |QBF aAlfa;              |XGRABA nHandFc, aAlfa; || Line Account code
      aAlfa = aSepara + "1" + aSepara;               |XGRABA nHandFc, aAlfa; || Line Quantity
      aAlfa = #agifa079#108 + aSepara;               |XGRABA nHandFc, aAlfa; || Line Unit Price
      || O una o la otra ....
      aAlfa = #agifa079#109 + aSepara;               |XGRABA nHandFc, aAlfa; || Line VAT Amount
      ||aAlfa = #agifa079#56 + aSepara;              |XGRABA nHandFc, aAlfa; || Line VAT Rate
      aAlfa = &13 + &10;                             |XGRABA nHandFc, aAlfa; || Fin de linea
   |FINSI;
   |SI #agifa079#111 ! 0;
      |HAZ ComienzoRegFC;
      aAlfa = &34 + #pcegm047#10; |QBF aAlfa; aAlfa = aAlfa + &34 + aSepara; |XGRABA nHandFc, aAlfa; || Line Description
      aAlfa = #pcegm047#3; |QBF aAlfa;               |XGRABA nHandFc, aAlfa; || Line Account code
      aAlfa = aSepara + "1" + aSepara;               |XGRABA nHandFc, aAlfa; || Line Quantity
      aAlfa = #agifa079#111 + aSepara;               |XGRABA nHandFc, aAlfa; || Line Unit Price
      || O una o la otra ....
      aAlfa = #agifa079#112 + aSepara;               |XGRABA nHandFc, aAlfa; || Line VAT Amount
      ||aAlfa = #agifa079#58 + aSepara;              |XGRABA nHandFc, aAlfa; || Line VAT Rate
      aAlfa = &13 + &10;                             |XGRABA nHandFc, aAlfa; || Fin de linea
   |FINSI;
   |SI #agifa079#114 ! 0;
      |HAZ ComienzoRegFC;
      aAlfa = &34 + #pcegm047#11; |QBF aAlfa; aAlfa = aAlfa + &34 + aSepara; |XGRABA nHandFc, aAlfa; || Line Description
      aAlfa = #pcegm047#3; |QBF aAlfa;               |XGRABA nHandFc, aAlfa; || Line Account code
      aAlfa = aSepara + "1" + aSepara;               |XGRABA nHandFc, aAlfa; || Line Quantity
      aAlfa = #agifa079#114 + aSepara;               |XGRABA nHandFc, aAlfa; || Line Unit Price
      || O una o la otra ....
      aAlfa = #agifa079#115 + aSepara;               |XGRABA nHandFc, aAlfa; || Line VAT Amount
      ||aAlfa = #agifa079#60 + aSepara;              |XGRABA nHandFc, aAlfa; || Line VAT Rate
      aAlfa = &13 + &10;                             |XGRABA nHandFc, aAlfa; || Fin de linea
   |FINSI;
   |SI #agifa079#119 ! 0;
      |HAZ ComienzoRegFC;
      aAlfa = &34 + #pcegm047#12; |QBF aAlfa; aAlfa = aAlfa + &34 + aSepara; |XGRABA nHandFc, aAlfa; || Line Description
      aAlfa = #pcegm047#3; |QBF aAlfa;               |XGRABA nHandFc, aAlfa; || Line Account code
      aAlfa = aSepara + "1" + aSepara;               |XGRABA nHandFc, aAlfa; || Line Quantity
      aAlfa = #agifa079#119 + aSepara;               |XGRABA nHandFc, aAlfa; || Line Unit Price
      || O una o la otra ....
      aAlfa = #agifa079#120 + aSepara;               |XGRABA nHandFc, aAlfa; || Line VAT Amount
      ||aAlfa = #agifa079#62 + aSepara;              |XGRABA nHandFc, aAlfa; || Line VAT Rate
      aAlfa = &13 + &10;                             |XGRABA nHandFc, aAlfa; || Fin de linea
   |FINSI;
   |SI #agifa079#122 ! 0;
      |HAZ ComienzoRegFC;
      aAlfa = &34 + #pcegm047#13; |QBF aAlfa; aAlfa = aAlfa + &34 + aSepara; |XGRABA nHandFc, aAlfa; || Line Description
      aAlfa = #pcegm047#3; |QBF aAlfa;               |XGRABA nHandFc, aAlfa; || Line Account code
      aAlfa = aSepara + "1" + aSepara;               |XGRABA nHandFc, aAlfa; || Line Quantity
      aAlfa = #agifa079#122 + aSepara;               |XGRABA nHandFc, aAlfa; || Line Unit Price
      || O una o la otra ....
      aAlfa = #agifa079#123 + aSepara;               |XGRABA nHandFc, aAlfa; || Line VAT Amount
      ||aAlfa = #agifa079#64 + aSepara;              |XGRABA nHandFc, aAlfa; || Line VAT Rate
      aAlfa = &13 + &10;                             |XGRABA nHandFc, aAlfa; || Fin de linea
   |FINSI;
|FPRC;

|PROCESO CabProveedores;
   aAlfa =         &34 + "Supplier  "            + &34 + aSepara;
   aAlfa = aAlfa + &34 + "Contact name "         + &34 + aSepara;
   aAlfa = aAlfa + &34 + "Building"              + &34 + aSepara;
   aAlfa = aAlfa + &34 + "Address Line 1"        + &34 + aSepara;
   aAlfa = aAlfa + &34 + "Address Line 2"        + &34 + aSepara;
   aAlfa = aAlfa + &34 + "Town"                  + &34 + aSepara;
   aAlfa = aAlfa + &34 + "County"                + &34 + aSepara;
   aAlfa = aAlfa + &34 + "Country"               + &34 + aSepara;
   aAlfa = aAlfa + &34 + "Postcode "             + &34 + aSepara;
   aAlfa = aAlfa + &34 + "Email"                 + &34 + aSepara;
   aAlfa = aAlfa + &34 + "Phone 1"               + &34 + aSepara;
   aAlfa = aAlfa + &34 + "Phone 2"               + &34 + aSepara;
   aAlfa = aAlfa + &34 + "Fax"                   + &34 + aSepara;
   aAlfa = aAlfa + &34 + "Website "              + &34 + aSepara;
   aAlfa = aAlfa + &34 + "VAT Number"            + &34 + &13 + &10;
   |XGRABA nHandPr, aAlfa;
|FPRC;

|PROCESO Proveedores;
   aAlfa = &34 + #agifa112#2;  |QBF aAlfa; aAlfa = aAlfa + &34 + aSepara;  |XGRABA nHandPr, aAlfa;
   aAlfa = &34 + #agifa112#2;  |QBF aAlfa; aAlfa = aAlfa + &34 + aSepara + aSepara; |XGRABA nHandPr, aAlfa;
   aAlfa = &34 + #agifa112#3;  |QBF aAlfa; aAlfa = aAlfa + &34 + aSepara + aSepara; |XGRABA nHandPr, aAlfa;
   aAlfa = &34 + #agifa112#4;  |QBF aAlfa; aAlfa = aAlfa + &34 + aSepara;  |XGRABA nHandPr, aAlfa;
   aAlfa = &34 + #agifa112#5;  |QBF aAlfa; aAlfa = aAlfa + &34 + aSepara;  |XGRABA nHandPr, aAlfa;
   aAlfa = &34 + #agifa112#89; |QBF aAlfa; aAlfa = aAlfa + &34 + aSepara;  |XGRABA nHandPr, aAlfa;
   aAlfa = (("00" + #agifa112#74) % -102) + (("000" + #agifa112#75)); |QBF aAlfa; aAlfa = aAlfa + aSepara;  |XGRABA nHandPr, aAlfa;
   aAlfa = &34 + #agifa112#84; |QBF aAlfa; aAlfa = aAlfa + &34 + aSepara;  |XGRABA nHandPr, aAlfa;
   aAlfa = &34 + #agifa112#6;  |QBF aAlfa; aAlfa = aAlfa + &34 + aSepara;  |XGRABA nHandPr, aAlfa;
   aAlfa = &34 + #agifa112#83; |QBF aAlfa; aAlfa = aAlfa + &34 + aSepara;  |XGRABA nHandPr, aAlfa;
   aAlfa = &34 + #agifa112#7;  |QBF aAlfa; aAlfa = aAlfa + &34 + aSepara;  |XGRABA nHandPr, aAlfa;
   aAlfa = &34 + #agifa112#109; |QBF aAlfa; aAlfa = aAlfa + &34 + aSepara;
   aAlfa = aAlfa + &13 + &10;   |XGRABA nHandPr, aAlfa;
|FPRC;

|PROCESO CabClientes;
   aAlfa =         &34 + "Customer  "            + &34 + aSepara;
   aAlfa = aAlfa + &34 + "Contact name "         + &34 + aSepara;
   aAlfa = aAlfa + &34 + "Building"              + &34 + aSepara;
   aAlfa = aAlfa + &34 + "Address Line 1"        + &34 + aSepara;
   aAlfa = aAlfa + &34 + "Address Line 2"        + &34 + aSepara;
   aAlfa = aAlfa + &34 + "Town"                  + &34 + aSepara;
   aAlfa = aAlfa + &34 + "County"                + &34 + aSepara;
   aAlfa = aAlfa + &34 + "Postcode "             + &34 + aSepara;
   aAlfa = aAlfa + &34 + "Email"                 + &34 + aSepara;
   aAlfa = aAlfa + &34 + "Phone 1"               + &34 + aSepara;
   aAlfa = aAlfa + &34 + "Phone 2"               + &34 + aSepara;
   aAlfa = aAlfa + &34 + "Fax"                   + &34 + aSepara;
   aAlfa = aAlfa + &34 + "Website "              + &34 + aSepara;
   aAlfa = aAlfa + &34 + "VAT Number"            + &34 + &13 + &10;
   |XGRABA nHandCl, aAlfa;
|FPRC;

|PROCESO Clientes;
   aAlfa = &34 + #agifa024#2; |QBF aAlfa; aAlfa = aAlfa + &34 + aSepara;  |XGRABA nHandCl, aAlfa;
   aAlfa = &34 + #agifa024#2; |QBF aAlfa; aAlfa = aAlfa + &34 + aSepara + aSepara; |XGRABA nHandCl, aAlfa;
   aAlfa = &34 + #agifa024#5; |QBF aAlfa; aAlfa = aAlfa + &34 + aSepara + aSepara; |XGRABA nHandCl, aAlfa;
   aAlfa = &34 + #agifa024#6; |QBF aAlfa; aAlfa = aAlfa + &34 + aSepara;  |XGRABA nHandCl, aAlfa;
   aAlfa = &34 + #agifa024#7; |QBF aAlfa; aAlfa = aAlfa + &34 + aSepara;  |XGRABA nHandCl, aAlfa;
   aAlfa = (("00" + #agifa024#178) % -102) + (("000" + #agifa024#179)); |QBF aAlfa; aAlfa = aAlfa + ",";  |XGRABA nHandCl, aAlfa;
   aAlfa = &34 + #agifa024#197; |QBF aAlfa; aAlfa = aAlfa + &34 + aSepara;  |XGRABA nHandCl, aAlfa;
   aAlfa = &34 + #agifa024#17;  |QBF aAlfa; aAlfa = aAlfa + &34 + aSepara;  |XGRABA nHandCl, aAlfa;
   aAlfa = &34 + #agifa024#196; |QBF aAlfa; aAlfa = aAlfa + &34 + aSepara;  |XGRABA nHandCl, aAlfa;
   aAlfa = &34 + #agifa024#18;  |QBF aAlfa; aAlfa = aAlfa + &34 + aSepara;  |XGRABA nHandCl, aAlfa;
   aAlfa = &34 + #agifa024#214; |QBF aAlfa; aAlfa = aAlfa + &34 + aSepara;
   aAlfa = aAlfa + &13 + &10;   |XGRABA nHandCl, aAlfa;
|FPRC;

|PROCESO Secuencial;
   |SI #pcegw018#0 = "FV";
      #agifa134#49 = #pcegw018#1;
      #agifa134#0  = #pcegw018#2;
      |LEE 000#agifa134.=;
      |SI FSalida ! 0; |DDEFECTO #agifa134; |FINSI;

      |SI nSwFVt = 0; |HAZ CabFrasVta; nSwFVt = 1; |FINSI;
      |HAZ FrasVta;
   |FINSI;
/* PEPE
   |SI #pcegw018#0 = "FD";
      #agifa084#48 = #Referen@#12;
      #agifa084#0  = #Referen@#13;
      |LEE 000#agifa084.=;
      |SI FSalida ! 0; |DDEFECTO #agifa084; |FINSI;

      |SI nSwFVt = 0; |HAZ CabFrasVta; nSwFVt = 1; |FINSI;
   |FINSI;
*/
   |SI #pcegw018#0 = "FC";
      #agifa079#48 = #pcegw018#1;
      #agifa079#0  = #pcegw018#2;
      |LEE 000#agifa079.=;
      |SI FSalida ! 0; |DDEFECTO #agifa079; |FINSI;

      |SI nSwFCm = 0; |HAZ CabFrasCmp; nSwFCm = 1; |FINSI;
      |HAZ FrasCmp;
   |FINSI;

   |SI #pcegw018#0 = "CL";
      #agifa024#0 = #pcegw018#1;
      |LEE 000#agifa024.=;
      |SI FSalida ! 0; |DDEFECTO #agifa024; |FINSI;

      |SI nSwCli = 0; |HAZ CabClientes; nSwCli = 1; |FINSI;
      |HAZ Clientes;
   |FINSI;

   |SI #pcegw018#0 = "FC";
      #agifa112#0 = #pcegw018#1;
      |LEE 000#agifa112.=;
      |SI FSalida ! 0; |DDEFECTO #agifa112; |FINSI;

      |SI nSwPro = 0; |HAZ CabProveedores; nSwPro = 1; |FINSI;
      |HAZ Proveedores;
   |FINSI;
|FPRC;

|DEFBUCLE Secuencial;
#pcegw018#1;
;
INICIO;
FINAL;
;
NULL, Secuencial;
|FIN;

|PROCESO Temporal;
   |SI #Referen@#26 ! "F"; |ACABA; |FINSI;

   aAlfa = "FV";
   |SI #Referen@#10 = "R";
      #agifa134#49 = #Referen@#12;
      #agifa134#0  = #Referen@#13;
      |LEE 000#agifa134.=;
      |SI FSalida ! 0;
         #agifa084#48 = #Referen@#12;
         #agifa084#0  = #Referen@#13;
         |LEE 000#agifa084.=;
         |SI FSalida = 0;
            aAlfa = "FD";
         |FINSI;
      |FINSI;
      #pcegw018#0 = aAlfa;
      #pcegw018#1 = #Referen@#12;
      #pcegw018#2 = #Referen@#13;
      #pcegw018#3 = "";
      |LEE 000#pcegw018.=;
      |SI FSalida ! 0;
         |DDEFECTO #pcegw018;
         #pcegw018#0 = aAlfa;
         #pcegw018#1 = #Referen@#12;
         #pcegw018#2 = #Referen@#13;
         |GRABA 020#pcegw018.n;
      |FINSI;

      #pcegw018#0 = "CL";
      |SI aAlfa = "FV";
         aAlfa = #agifa134#2;
      |SINO;
         aAlfa = #agifa084#3;
      |FINSI;
      #pcegw018#1 = aAlfa;
      #pcegw018#2 = "";
      #pcegw018#3 = "";
      |LEE 000#pcegw018.=;
      |SI FSalida ! 0;
         |DDEFECTO #pcegw018;
         #pcegw018#0 = "CL";
         #pcegw018#1 = aAlfa;
         |GRABA 020#pcegw018.n;
      |FINSI;
   |FINSI;

   |SI #Referen@#10 = "S";
      #agifa079#66 = #Referen@#12;
      #agifa079#0  = #Referen@#13;
      |LEE 000#agifa079.=;
      |SI FSalida ! 0; |DDEFECTO #agifa079; |FINSI;

      #pcegw018#0 = "FC";
      #pcegw018#1 = #Referen@#12;
      #pcegw018#2 = #Referen@#13;
      #pcegw018#3 = "";
      |LEE 000#pcegw018.=;
      |SI FSalida ! 0;
         |DDEFECTO #pcegw018;
         #pcegw018#0 = "FC";
         #pcegw018#1 = #Referen@#12;
         #pcegw018#2 = #Referen@#13;
         |GRABA 020#pcegw018.n;
      |FINSI;

      #pcegw018#0 = "PR";
      #pcegw018#1 = #agifa079#2;
      #pcegw018#2 = "";
      #pcegw018#3 = "";
      |LEE 000#pcegw018.=;
      |SI FSalida ! 0;
         |DDEFECTO #pcegw018;
         #pcegw018#0 = "PR";
         #pcegw018#1 = #agifa079#2;
         |GRABA 020#pcegw018.n;
      |FINSI;
   |FINSI;
|FPRC;

|DEFBUCLE Temporal;
#Referen@#1006;
;
00, "01.01.0000", 000000, 0000, 00000, 0;
99, "31.12.9999", 999999, 9999, 99999, 9;
;
NULL, Temporal;
|FIN;

|PROCESO CopiaFicheros;
   aIP = ""; |IP_REMOTO aIP;

   aAlfa  = aPathBase + aFichCl; |QBF aAlfa;
   |XABRE "B", aAlfa, nHandle;
   |SI FSalida ] 0;
      |XLEE nHandle, 1, aAlfa2;
      |SI FSalida > 0;
         |XCIERRA nHandle;
         aAlfa1 = #pcegz102#16; |QBF aAlfa1;
         aAlfa1 = aAlfa1 + "/" + aFichCl; |QBF aAlfa1;
         |SI aIP ! "";
            |ENVIA_FICHERO aAlfa, aAlfa1;
         |SINO;
            |COPIA_FICHERO aAlfa, aAlfa1;
         |FINSI;
      |SINO;
         |XCIERRA nHandle;
      |FINSI;
   |FINSI;
   |FBORRA aAlfa;

   aAlfa  = aPathBase + aFichPr; |QBF aAlfa;
   |XABRE "B", aAlfa, nHandle;
   |SI FSalida ] 0;
      |XLEE nHandle, 1, aAlfa2;
      |SI FSalida > 0;
         |XCIERRA nHandle;
         aAlfa1 = #pcegz102#16; |QBF aAlfa1;
         aAlfa1 = aAlfa1 + "/" + aFichPr; |QBF aAlfa1;
         |SI aIP ! "";
            |ENVIA_FICHERO aAlfa, aAlfa1;
         |SINO;
            |COPIA_FICHERO aAlfa, aAlfa1;
         |FINSI;
      |SINO;
         |XCIERRA nHandle;
      |FINSI;
   |FINSI;
   |FBORRA aAlfa;

   aAlfa  = aPathBase + aFichFc; |QBF aAlfa;
   |XABRE "B", aAlfa, nHandle;
   |SI FSalida ] 0;
      |XLEE nHandle, 1, aAlfa2;
      |SI FSalida > 0;
         |XCIERRA nHandle;
         aAlfa1 = #pcegz102#16; |QBF aAlfa1;
         aAlfa1 = aAlfa1 + "/" + aFichFc; |QBF aAlfa1;
         |SI aIP ! "";
            |ENVIA_FICHERO aAlfa, aAlfa1;
         |SINO;
            |COPIA_FICHERO aAlfa, aAlfa1;
         |FINSI;
      |SINO;
         |XCIERRA nHandle;
      |FINSI;
   |FINSI;
   |FBORRA aAlfa;

   aAlfa  = aPathBase + aFichFv; |QBF aAlfa;
   |XABRE "B", aAlfa, nHandle;
   |SI FSalida ] 0;
      |XLEE nHandle, 1, aAlfa2;
      |SI FSalida > 0;
         |XCIERRA nHandle;
         aAlfa1 = #pcegz102#16; |QBF aAlfa1;
         aAlfa1 = aAlfa1 + "/" + aFichFv; |QBF aAlfa1;
         |SI aIP ! "";
            |ENVIA_FICHERO aAlfa, aAlfa1;
         |SINO;
            |COPIA_FICHERO aAlfa, aAlfa1;
         |FINSI;
      |SINO;
         |XCIERRA nHandle;
      |FINSI;
   |FINSI;
   |FBORRA aAlfa;
|FPRC;

|PROGRAMA;
   |ABRE #pcegm047;
   |LEE 000#pcegm047.p;
   |SI FSalida ! 0;
      |DDEFECTO #pcegm047;
      |GRABA 020#pcegm047.c;
   |FINSI;
   |CIERRA #pcegm047;

   |SI #pcegm047#1 = "N"; |ACABA; |FINSI;

   aSepara = ",";

   |ABRE #pcegm046;
   #pcegm046#0 = Usuario % 0810;
   |LEE 101#pcegm046.=;
   |SI FSalida ! 0;
      |DDEFECTO #pcegm046;
      #pcegm046#0 = Usuario % 0810;
      |GRABA 020#pcegm046.b;
   |FINSI;
   #pcegz102#16 = #pcegm046#1;

   |CLS;
   |CABEZA "Exportacion contable PCEGroup Inglaterra";
   |PINPA #0#0; |PINDA #0#0;
   |ENDATOS #1#0;
   |SI FSalida ! 0;
      |LIBERA #pcegm046; |CIERRA #pcegm046;
      |ACABA;
   |FINSI;

   #pcegm046#1 = #pcegz102#16;
   |GRABA 020#pcegm046.a;

   aAlfa = "tc" + Usuario; |NOME_DAT #pcegw018#aAlfa#;
   |DELINDEX #pcegw018; |ABRE #pcegw018;

   aAlfa = eaPath; |QBF aAlfa;
   aAlfa = aAlfa - "contagen";
   |SI FSalida ! 0;
      nCalc = FSalida + 91; aAlfa = aAlfa % nCalc;
      aPathBas = eaPath - aAlfa + "/";
      aPathEmp = eaPath;
   |SINO;
      aAlfa = aAlfa - "agicont";
      |SI FSalida ! 0;
         nCalc = FSalida + 92; aAlfa = aAlfa % nCalc;
         aPathBas = eaPath - aAlfa + "/";
         aPathEmp = eaPath;
      |FINSI;
   |FINSI;

   aAlfa = aPathBas + "def/caenlace.mas";
   |CARGA_DEF aAlfa, Referen@;
   |SI FSalida = 0;
      |PATH_DAT #Referen@#eaPath#; |NOME_DAT #Referen@#eaFich#;
      |ABRE #Referen@;
      |LEE 000#Referen@.p;
      |SI FSalida = 0;
         fFecha = ~; aAlfa1 = fFecha;
         |HORA aAlfa; |QBF aAlfa; aAlfa = (aAlfa % 0102) + (aAlfa % 0402) + (aAlfa % 0702);
         |DFICB aPathBase; |QBF aPathBase;
         aFichCl = "cl" + (aAlfa1 % 0102) + (aAlfa1 % 0402) + (aAlfa1 % 0704) + aAlfa + ".csv";
         aFichPr = "pr" + (aAlfa1 % 0102) + (aAlfa1 % 0402) + (aAlfa1 % 0704) + aAlfa + ".csv";
         aFichFv = "fv" + (aAlfa1 % 0102) + (aAlfa1 % 0402) + (aAlfa1 % 0704) + aAlfa + ".csv";
         aFichFc = "fc" + (aAlfa1 % 0102) + (aAlfa1 % 0402) + (aAlfa1 % 0704) + aAlfa + ".csv";
         aAlfa = aPathBase + aFichCl;
         |XABRE "WB", aAlfa, nHandCl;
         |SI FSalida ] 0;
            aAlfa = aPathBase + aFichPr;
            |XABRE "WB", aAlfa, nHandPr;
            |SI FSalida ] 0;
               aAlfa = aPathBase + aFichFv;
               |XABRE "WB", aAlfa, nHandFv;
               |SI FSalida ] 0;
                  aAlfa = aPathBase + aFichFc;
                  |XABRE "WB", aAlfa, nHandFc;
                  |SI FSalida ] 0;
                     |ABRE #agifa134; |ABRE #agifa084; |ABRE #agifa079;
                     |ABRE #agifa024; |ABRE #agifa112; |ABRE #agifa133;
                     |BUCLE Temporal; |BUCLE Secuencial;
                     |CIERRA #agifa024; |CIERRA #agifa112; |CIERRA #agifa133;
                     |CIERRA #agifa134; |CIERRA #agifa084; |CIERRA #agifa079;
                     |XCIERRA nHandFc;
                  |FINSI;
                  |XCIERRA nHandFv;
               |FINSI;
               |XCIERRA nHandPr;
            |FINSI;
            |XCIERRA nHandCl;
         |FINSI;
         |HAZ CopiaFicheros;
      |FINSI;
      |CIERRA #Referen@;
      |DESCARGA_DEF #Referen@;
   |FINSI;
   |LIBERA #pcegm046; |CIERRA #pcegm046;

   |CIERRA #pcegw018; |DELINDEX #pcegw018;
|FPRO;
