|FICHEROS;
con02682 #0;
con00682 #1;
con00625 #2;
|FIN;

|VARIABLES;
esta_abierto = "N";
horas = "";
linea_nueva = 0;
hora_ini = "";
hora_ini_num = 0;
hora_fin = "";
hora_fin_num = 0;
minut_ini = "";
minut_ini_num = 0;
minut_fin = "";
minut_fin_num = 0;
hora_totali = 0;
horatotalf = 0;
total_horas = 0;
linea_actual = 0;
    r_alfa = "";
    r_long = "";
    r_num = 0;

|FIN;

|PROGRAMA;
|CLS;
|PARA ; |SI #0#0 ! "9999"; |HACIENDO;
|CABEZA "Entrada Trabajos";
|PINPA #0#0;
|ENDATOS #1#0;
|SIGUE;
|FPRO;

|PROCESO proceso;
|SI #0#0 ! "9999";
|PINTA #0#1;
|HORA horas;
#0#2 = horas;
|PINTA #0#2;
|ABRE #1;
#1#0 = #0#0;
#1#1 = #0#1;
#1#2 = 99;
|LEE 001#1];
|SI FSalida = 0;
     |LEE 001#1a;
|SINO;
     |LEE 001#1u;
|FINSI;

|SI FSalida = 0;
     |SI #1#0 = #0#0;|Y #1#1 = #0#1; |Y #1#9 = "     ";
          esta_abierto = "S";
          linea_actual = #1#2;
          |PINTA 1712 , #2#3;
          |PINTA 1724 , #2#19;
     |SINO;
          |SI #1#0 = #0#0; |Y #1#1 = #0#1;
               linea_nueva = #1#2 + 1;
          |SINO;
               linea_nueva = 1;
          |FINSI;
          esta_abierto = "N";
     |FINSI;
|FINSI;
|LIBERA #1;
|CIERRA #1;
|SI esta_abierto = "S";
     |ABRE #1;
     #1#0 = #0#0;
     #1#1 = #0#1;
     #1#2 = linea_actual;
     |LEE 001#1=;
     |SI FSalida = 0;
     #0#3 = #1#4;
     #0#4 = #1#5;
     |PINTA #0#3;
     |PINTA #0#4;
     |CAMPO_MODIFICA #0#3 , 1 , "N";
     |CAMPO_MODIFICA #0#4 , 1 , "N";
     |PINTA 1337 , "Inicio:"
     |PINTA 1345 , #1#8;
     |PINTA 1913 ,  "SE VA A CERRAR EL TRABAJO DE LA ORDEN";
               #1#9 = #0#2;
               hora_ini = #1#8 % A102;
               hora_ini_num = hora_ini;
               minut_ini = #1#8 % -102;
               minut_ini_num = minut_ini;

               hora_fin = #1#9 % A102;
               hora_fin_num = hora_fin;
               minut_fin = #1#9 % -102;
               minut_fin_num = minut_fin;

               |SI hora_fin_num < hora_ini_num;
                     hora_fin_num = hora_fin_num + 24;
               |FINSI;

               hora_totali = hora_ini_num + (minut_ini_num / 60);
               horatotalf = hora_fin_num + (minut_fin_num / 60);
               total_horas = horatotalf - hora_totali;
               #0#6 = total_horas;
               #1#6 = #0#6;
               |CAMPO_MODIFICA #0#6 , 1 , "S";
               |CAMPO_MODIFICA #0#5 , 1 , "S";
               |ENCAMPO #6#0;
               |ENCAMPO #5#0;
               |CAMPO_MODIFICA #0#6 , 1 , "N";
               |CAMPO_MODIFICA #0#5 , 1 , "N";
               |SI FSalida = 0; |Y #0#5 = "S";
                    #1#10 = #0#6;
                    |GRABA 001#1a;
               |SINO;
                    |MENAV "0000NO SE HA ACTUALIZADO LA FICHA";
               |FINSI;
          |FINSI;
          |LIBERA #1;
          |CIERRA #1;
|SINO;
     |CAMPO_MODIFICA #0#3 , 1 , "S";
     |CAMPO_MODIFICA #0#4 , 1 , "S";
     |CAMPO_MODIFICA #0#5 , 1 , "S";

|FINSI;
|SINO;
     |PTEC 807;
|FINSI;
|FPRC;

|PROCESO nuevo;
|SI esta_abierto = "N";
     |SI  #0#5 = "S";
     |ABRE #1;
     |DDEFECTO #1;
     #1#0 = #0#0;
     #1#1 = #0#1;
     #1#2 = linea_nueva;
     #1#3 = 1;
     #1#4 = #0#3;
     #1#5 = #0#4;
     #1#6 = 0;
     #1#7 = #2#19;
     #1#8 = #0#2;
     #1#9 = "";
     #1#10 = 0;
     #1#11 = "N";
     #1#12 = #2#3;
     |GRABA 001#1n;
     |LIBERA #1;
     |CIERRA #1;
     |SINO;
          |MENAV "0000NO SE HA ACTUALIZADO LA FICHA";
     |FINSI;
|FINSI;
|PTEC 807;
|FPRC;


|PROCESO noentra;
|SI #2#16 ! 0;
     |MENAV "0000Orden de Reparacion Cerrada o facturada";
     |ERROR;
|FINSI;
|FPRC;

|PROCESO rellena1; |TIPO 6;
    r_alfa = #0#4;
    |QBF r_alfa;
    #0#4 = "000000";
    r_long = #0#4 % A0;
    r_alfa = "000000" + r_alfa;
    r_num = -(r_long + 100);
    #0#4 = r_alfa % r_num;
    |PINTA #0#4;
|FPRC;
