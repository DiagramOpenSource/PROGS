|FICHEROS;
     diaw0028;

     agifa024;
     dsm00003;

     agifa010;
     agifa071;

     agifa134;
     agifa059;

     agifa704;
     agifa716;
     agifa722;
     agifa743;
     diam0007;
     diam0008;

     albacab@;
     albalin@;
|FIN;

|VARIABLES;
     nError              = 0;
     nHandle             = 0;
     nLong               = 0;
     nCarac              = 0;
     nPos                = 0;
     nOk                 = 0;
     nConta              = 0;
     nCampo              = 0;
     nCaracter           = 0;
     nCmp                = 0;
     nSwHay              = 0;
     nCalc               = 0;
     nCmpAnt             = 0;
     nSw                 = 0;
     nDLin               = 0;
     FEstado             = 0;

     aDef                = "";
     aMas                = "";
     aBase               = "";
     aCadena             = "";
     aCarac1             = "";
     aFic                = "";
     aTab                = "";
     aBorra              = "";
     aTextoIni           = "";
     aAbre               = "";
     aPath               = "";
     aAlfa               = "";
     aAlfa1              = "";
     aAlfaX              = "";
     aFichero            = "";
     aFichAnt            = "";
     aRuta               = "";
     aAux                = "";
     aPrograma           = "";
     aPathDSSelect       = "";
     aParaIni            = "";
     aCarpetaCaptura     = "/";
     aEjecuta            = "";
     aLong               = "";
     aCarac              = "";
     aProg               = "";
     aPos                = "";
     aDirLocal           = "";
     aFicCSV             = "";
     aContab             = "";
     Comodin             = "";
     Comodin1            = "";
     aCampoA             = "";
     aCampoB             = "";
     aCampoC             = "";
     aCampoD             = "";
     aCampoE             = "";
     aCampoF             = "";
     aCampoG             = "";
     aCampoH             = "";
     aCampoI             = "";
     aCampoJ             = "";
     aCampoK             = "";
     aCampoL             = "";
     aCampoM             = "";
     aCampoN             = "";
     aCampoO             = "";
     aCampoP             = "";
     aCampoQ             = "";
     aCampoR             = "";
     aCampoS             = "";
     aCampoT             = "";
     aCampoU             = "";
     aCampoV             = "";
     aCampoW             = "";

     {1}aLocal;

     &eaUnidad           = "";
     &enError            = 0;
     &ser_fac            = "";
     &num_fac            = 0;
     &eaProg             = "";
     &enPres             = 0;
     &efFechaForm        = @;
     &PRMNT_enError      = 0;
     &enReContab         = 0;
     &enForma            = 0;
|FIN;

|PROCESO Asiento;
     efFechaForm = "01.01.0000";

     aAlfaX = #agifa134#1; |QBF aAlfaX;
     aAlfaX = aAlfaX % -104;

     #agifa743#0 = "FV";
     #agifa743#1 = #agifa134#49;
     #agifa743#2 = #agifa134#0;
     #agifa743#3 = aAlfaX;
     |LEE 000#agifa743.=;
     |SI FSalida = 0; efFechaForm = #agifa743#5; |FINSI;
     |CIERRA #agifa743;

     aAlfa1 = #agifa134#1; |QBF aAlfa1;
     aAlfa1 = aAlfa1 % -104;
     nSwHay = 0;

     |DDEFECTO #agifa722;
     #agifa722#0 = "FV";
     #agifa722#1 = #agifa134#49;
     #agifa722#2 = #agifa134#0;
     #agifa722#3 = aAlfa1;
     #agifa722#11 = 1;
     |LEE 000#agifa722.];
     FEstado = FSalida;
     aAlfa   = #agifa722#1;
     aAlfa   = aAlfa % 0105;
     nCalc   = #agifa722#2;
     FSalida = FEstado;

     |PARA; |SI FSalida = 0; |Y #agifa722#0 = "FV";
                             |Y aAlfa = #agifa134#49;
                             |Y nCalc = #agifa134#0; |HACIENDO;

         aAlfa = #agifa722#3; |QBF aAlfa;
         |SI aAlfa = aAlfa1;
             nSwHay = 1;
             |SAL;
         |FINSI;
         |LEE 000#agifa722.s;
         FEstado = FSalida;
         aAlfa   = #agifa722#1; aAlfa = aAlfa % 0105;
         nCalc   = #agifa722#2;
         FSalida = FEstado;
     |SIGUE;

     aAlfa1 = "N";
     |SI nSwHay = 1;
         aAlfa = "ac" + Usuario; |NOME_DAT #agifa716#aAlfa#;
         |DELINDEX #agifa716;
         |ABRE #agifa716;

         #agifa704#0 = #agifa722#10;
         |LEE 101#agifa704.=;
         |SI FSalida = 0;
             aFichAnt = #agifa704#16;
             nCmpAnt  = #agifa704#17;

             |SI #agifa704#7 = "S";
                 |DDEFECTO #agifa716;
                 #agifa716#15 = #agifa722#10;
                 #agifa716#0  = 1;
                 #agifa716#13 = "agifa134";
                 #agifa716#14 = 49;
                 #agifa716#11 = "A";
                 #agifa716#12 = 5;
                 #agifa716#3  = #agifa134#49;
                 #agifa716#4  = #agifa134#49;
                 |GRABA 020#agifa716.n;

                 |DDEFECTO #agifa716;
                 #agifa716#15 = #agifa722#10;
                 #agifa716#0  = 2;
                 #agifa716#13 = "agifa134";
                 #agifa716#14 = 0;
                 #agifa716#11 = "N";
                 #agifa716#12 = 6;
                 #agifa716#5  = #agifa134#0;
                 #agifa716#6  = #agifa134#0;
                 |GRABA 020#agifa716.n;
                 |LIBERA #agifa716;

                 #agifa704#16 = "agifa134";
                 #agifa704#17 = 0;
                 |GRABA 020#agifa704.a;
             |SINO;
                 |SI #agifa704#8 = "S";
                     |DDEFECTO #agifa716;
                     #agifa716#15 = #agifa722#10;
                     #agifa716#0  = 1;
                     #agifa716#13 = "agifa071";
                     #agifa716#14 = 30;
                     #agifa716#11 = "A";
                     #agifa716#12 = 5;
                     #agifa716#3  = #agifa134#49;
                     #agifa716#4  = #agifa134#49;
                     |GRABA 020#agifa716.n;

                     |DDEFECTO #agifa716;
                     #agifa716#15 = #agifa722#10;
                     #agifa716#0  = 2;
                     #agifa716#13 = "agifa071";
                     #agifa716#14 = 26;
                     #agifa716#11 = "N";
                     #agifa716#12 = 6;
                     #agifa716#5  = #agifa134#0;
                     #agifa716#6  = #agifa134#0;
                     |GRABA 020#agifa716.n;
                     |LIBERA #agifa716;

                     #agifa704#16 = "agifa071";
                     #agifa704#17 = 26;
                     |GRABA 020#agifa704.a;
                 |SINO;
                     |DDEFECTO #agifa716;
                     #agifa716#15 = #agifa722#10;
                     #agifa716#0  = 1;
                     #agifa716#13 = "agifa134";
                     #agifa716#14 = 49;
                     #agifa716#11 = "A";
                     #agifa716#12 = 5;
                     #agifa716#3  = #agifa134#49;
                     #agifa716#4  = #agifa134#49;
                     |GRABA 020#agifa716.n;

                     |DDEFECTO #agifa716;
                     #agifa716#15 = #agifa722#10;
                     #agifa716#0  = 2;
                     #agifa716#13 = "agifa134";
                     #agifa716#14 = 0;
                     #agifa716#11 = "N";
                     #agifa716#12 = 6;
                     #agifa716#5  = #agifa134#0;
                     #agifa716#6  = #agifa134#0;
                     |GRABA 020#agifa716.n;
                     |LIBERA #agifa716;

                     #agifa704#16 = "agifa134";
                     #agifa704#17 = 0;
                     |GRABA 020#agifa704.a;
                 |FINSI;
             |FINSI;
             |CIERRA #agifa716;
         |FINSI;
         |LIBERA #agifa704;

         |GRABA 020#agifa134.a;
         |LIBERA #agifa134;
         |CIERRAT #agifa134;



         Comodin1 = #agifa134#1; |QBF Comodin1; Comodin1 = Comodin1 % -104;
         Comodin = #agifa722#10; |QBF Comodin;

         |SI nSw = 1; || BORRA
            Comodin = "agifa711.tab;" + Comodin + ",B*" + Comodin1;
            aAlfa1 = "N";
         |FINSI;

         |SI nSw = 2; || ENLAZA
            Comodin = "agifa711.tab;" + Comodin + "*" + Comodin1;
            aAlfa1 = "S";
         |FINSI;

         |SUB_EJECUTA_NP Comodin;
         |DELINDEX #agifa716;

         #agifa704#0 = #agifa722#10;
         |LEE 101#agifa704.=;
         |SI FSalida = 0;
             #agifa704#16 = aFichAnt; #agifa704#17 = nCmpAnt;
             |GRABA 020#agifa704.a;
         |FINSI;
         |LIBERA #agifa704;

         |ABRET #agifa134;

         #agifa134#49 = #diaw0028#5;
         #agifa134#0  = #diaw0028#6;
         |LEE 000#agifa134.=;
     |FINSI;

    |SI PRMNT_enError = 0;
        #agifa134#48 = aAlfa1;
        |GRABA 020#agifa134.a;
        |LIBERA #agifa134;
    |FINSI;

    nSw = PRMNT_enError;
|FPRC;

|PROCESO CambiaCliente;
     aAlfa = ("000000" + aAlfa) % -106;

     #agifa024#0 = aAlfa;
     |LEE 000#agifa024.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     #dsm00003#0 = #agifa024#0;
     #dsm00003#1 = 1;
     |LEE 000#dsm00003.];
     |SI FSalida ! 0; |O  #dsm00003#0 ! #agifa024#0;
         |DDEFECTO #dsm00003;
     |FINSI;

     #agifa010#3   = #agifa024#0;
     #agifa010#4   = #agifa024#1;
     #agifa010#35  = #agifa024#4;
     #agifa010#84  = #dsm00003#1;
     #agifa010#29  = #dsm00003#10;
     #agifa010#30  = #dsm00003#2;
     #agifa010#31  = #dsm00003#3;
     #agifa010#33  = #dsm00003#7;
     #agifa010#62  = #dsm00003#6;

     |SI #dsm00003#14 = "  ";
         #agifa010#6 = #agifa024#25;
     |SINO;
         #agifa010#6 = #dsm00003#14;
     |FINSI;

     #agifa071#15  = #agifa024#0;

     #agifa134#2   = #agifa024#0;
     #agifa134#3   = #agifa024#1;
     #agifa134#9   = #agifa024#29;
     #agifa134#10  = #agifa024#30;
     #agifa134#12  = #agifa024#16;
     #agifa134#14  = #agifa024#22;
     #agifa134#15  = #agifa024#23;
     #agifa134#16  = #agifa024#24;
     #agifa134#124 = #agifa024#15;
|FPRC;

|PROCESO agifa071B;
     |BORRA 020#agifa071.a;
     |LIBERA #agifa071;
|FPRC;

|DEFBUCLE agifa071B;
     #agifa071#1;
     ;
     #agifa010#52, #agifa010#0, nDLin;
     #agifa010#52, #agifa010#0, 999;
     be;
     NULL, agifa071B;
|FIN;

|PROCESO agifa059B;
     |BORRA 020#agifa059.a;
     |LIBERA #agifa059;
|FPRC;

|DEFBUCLE agifa059B;
     #agifa059#1;
     ;
     #agifa134#49, #agifa134#0, nDLin;
     #agifa134#49, #agifa134#0, 999;
     be;
     NULL, agifa059B;
|FIN;

|PROCESO diam0008B;
     |BORRA 020#diam0008.a;
     |LIBERA #diam0008;
|FPRC;

|DEFBUCLE diam0008B;
     #diam0008#1;
     ;
     #agifa134#49, #agifa134#0, 001;
     #agifa134#49, #agifa134#0, 999;
     be;
     NULL, diam0008B;
|FIN;

|PROCESO diaw0028;
     #albacab@#52 = "PAT";
     #albacab@#0  = #diaw0028#21;
     |LEE 000#albacab@.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     #albalin@#29 = #albacab@#52;
     #albalin@#0  = #albacab@#0;
     #albalin@#1  = 1;
     |LEE 000#albalin@.];
     |SI FSalida      ! 0;             |ACABA;  |FINSI;
     |SI #albalin@#29 ! #albacab@#52;  |ACABA;  |FINSI;
     |SI #albalin@#0  ! #albacab@#0;   |ACABA;  |FINSI;

     #agifa134#49 = #diaw0028#5;
     #agifa134#0  = #diaw0028#6;
     |LEE 000#agifa134.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     aContab = #agifa134#48;
     |SI #agifa134#48 = "S";
         enReContab = 0;
         nSw        = 1;
         |HAZ Asiento;
     |FINSI;

     #agifa134#49 = #diaw0028#5;
     #agifa134#0  = #diaw0028#6;
     |LEE 000#agifa134.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     #agifa059#14 = #agifa134#49;
     #agifa059#0  = #agifa134#0;
     #agifa059#1  = 1;
     |LEE 000#agifa059.];
     |SI FSalida      ! 0;             |ACABA;  |FINSI;
     |SI #agifa059#14 ! #agifa134#49;  |ACABA;  |FINSI;
     |SI #agifa059#0  ! #agifa134#0;   |ACABA;  |FINSI;

     nDLin = #agifa059#1 + 1;
     |BUCLE agifa059B;

     #agifa059#14 = #agifa134#49;
     #agifa059#0  = #agifa134#0;
     #agifa059#1  = 1;
     |LEE 000#agifa059.];

     #agifa010#52 = #agifa059#15;
     #agifa010#0  = #agifa059#2;
     |LEE 000#agifa010.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     #agifa071#29 = #agifa010#52;
     #agifa071#0  = #agifa010#0;
     #agifa071#1  = 1;
     |LEE 000#agifa071.];
     |SI FSalida      ! 0;             |ACABA;  |FINSI;
     |SI #agifa071#29 ! #agifa010#52;  |ACABA;  |FINSI;
     |SI #agifa071#0  ! #agifa010#0;   |ACABA;  |FINSI;

     aAlfa = #diaw0028#23;  |QBT aAlfa;
     |SI aAlfa ! "";
         |HAZ CambiaCliente;
     |FINSI;

     #agifa010#5   = #albacab@#5;
     #agifa010#7   = #albacab@#7;
     #agifa010#32  = #albacab@#32;
     #agifa010#36  = #albacab@#36;
     #agifa010#37  = #albacab@#37;
     #agifa010#43  = #albacab@#43;
     #agifa010#54  = #albacab@#43;
     #agifa010#61  = #albacab@#61;
     #agifa010#67  = #albacab@#67;
     #agifa010#68  = #albacab@#68;
     #agifa010#69  = #albacab@#69;
     #agifa010#91  = #albacab@#91;
     #agifa010#92  = #albacab@#92;
     #agifa010#93  = #albacab@#93;
     #agifa010#96  = #albacab@#96;

     |PARA nCmp = 11;  |SI nCmp [ 28;  |HACIENDO nCmp = nCmp + 1;
           #agifa010#nCmp# = #albacab@#nCmp#;
     |SIGUE;

     |PARA nCmp = 44;  |SI nCmp [ 51;  |HACIENDO nCmp = nCmp + 1;
           #agifa010#nCmp# = #albacab@#nCmp#;
     |SIGUE;

     |PARA nCmp = 67;  |SI nCmp [ 82;  |HACIENDO nCmp = nCmp + 1;
           #agifa010#nCmp# = #albacab@#nCmp#;
     |SIGUE;

     |PARA nCmp = 2;  |SI nCmp [ 14;  |HACIENDO nCmp = nCmp + 1;
           #agifa071#nCmp# = #albalin@#nCmp#;
     |SIGUE;

     |PARA nCmp = 23;  |SI nCmp [ 25;  |HACIENDO nCmp = nCmp + 1;
           #agifa071#nCmp# = #albalin@#nCmp#;
     |SIGUE;

     |PARA nCmp = 33;  |SI nCmp [ 53;  |HACIENDO nCmp = nCmp + 1;
           #agifa071#nCmp# = #albalin@#nCmp#;
     |SIGUE;

     |PARA nCmp = 62;  |SI nCmp [ 66;  |HACIENDO nCmp = nCmp + 1;
           #agifa071#nCmp# = #albalin@#nCmp#;
     |SIGUE;

     #agifa071#5  = 1;
     #agifa071#6  = #diaw0028#14;
     #agifa071#7  = #diaw0028#14;
     |HAZ TotalLin71;

     enForma = 1;
     |HAZ AcumulaAV;

     |GRABA 000#agifa071.a;  |LIBERA #agifa071;

     nDLin = #agifa071#1 + 1;
     |BUCLE agifa071B;

     |PARA nCmp = 15;  |SI nCmp [ 26;  |HACIENDO nCmp = nCmp + 1;
           #agifa010#nCmp# = 0;
     |SIGUE;

     |PARA nCmp = 44;  |SI nCmp [ 49;  |HACIENDO nCmp = nCmp + 1;
           #agifa010#nCmp# = 0;
     |SIGUE;

     |PARA nCmp = 75;  |SI nCmp [ 82;  |HACIENDO nCmp = nCmp + 1;
           #agifa010#nCmp# = 0;
     |SIGUE;

     #agifa010#28 = 0;
     #agifa010#54 = 0;
     #agifa010#67 = 0;

     |BUCLELIN 0 CalCabAgifa010 #agifa010;
     |GRABA 000#agifa010.a;  |LIBERA #agifa010;

     #agifa134#58  = #agifa010#68; || Divisa (cabecera)
     #agifa134#59  = #agifa010#69; || Cambio Divisa (cabecera)
     #agifa134#60  = #agifa010#70; || Moneda de trabajo (cabecera)
     #agifa134#62  = #agifa010#74; || Cambio Moneda base en EUROS (cabecera)
     #agifa134#122 = #agifa010#91; || %Retencion
     #agifa134#13  = #agifa010#36;
     #agifa059#18  = #agifa010#68; || Divisa (lineas)
     #agifa059#19  = #agifa010#69; || Cambio (lineas;
     #agifa134#115 = #agifa010#84; ||Dir.Ent.

     |HAZ CalLinAgifa134;
     |GRABA 000#agifa059.a;  |LIBERA #agifa059;

     |HAZ CalCabAgifa134;
     |GRABA 000#agifa134.a;  |LIBERA #agifa134;

     |CIERRAT #agifa134;

     #diam0007#0 = #agifa134#49;
     #diam0007#1 = #agifa134#0;
     |LEE 101#diam0007.=;
     |SI FSalida = 0;
         |BUCLE diam0008B;

         |BORRA 020#diam0007.a;
         |LIBERA #diam0007;
     |FINSI;

     enPres  = 1;
     ser_fac = #agifa134#49;
     num_fac = #agifa134#0;
     |SUB_EJECUTA_NP "agifa133";

     |ABRET #agifa134;
     #agifa134#49 = #diaw0028#5;

     #agifa134#0  = #diaw0028#6;
     |LEE 000#agifa134.=;

     |SI aContab = "S";
         enReContab = 1;
         nSw        = 2;
         |HAZ Asiento;
     |FINSI;
|FPRC;

|DEFBUCLE diaw0028;
     #diaw0028#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, diaw0028;
|FIN;

|PROCESO GrabaReg;
     |QBF aCampoA;
     |QBF aCampoB;
     |QBF aCampoC;
     |QBF aCampoD;
     |QBF aCampoE;
     |QBF aCampoF;
     |QBF aCampoG;
     |QBF aCampoH;
     |QBF aCampoI;
     |QBF aCampoJ;
     |QBF aCampoK;
     |QBF aCampoL;
     |QBF aCampoM;
     |QBF aCampoN;
     |QBF aCampoO;
     |QBF aCampoP;
     |QBF aCampoQ;
     |QBF aCampoR;
     |QBF aCampoS;
     |QBF aCampoT;
     |QBF aCampoU;
     |QBF aCampoV;
     |QBF aCampoW;

     |SI aCampoA = "";  |ACABA;  |FINSI;

     nConta = nConta + 1;

     |DDEFECTO #diaw0028;
     #diaw0028#0  = nConta;
     #diaw0028#1  = aCampoA;
     #diaw0028#2  = aCampoB;
     #diaw0028#3  = aCampoC;
     #diaw0028#4  = aCampoD;
     #diaw0028#5  = aCampoE;
     #diaw0028#6  = aCampoF;
     #diaw0028#7  = aCampoG;
     #diaw0028#8  = aCampoH;
     #diaw0028#9  = aCampoI;
     #diaw0028#10 = aCampoJ;
     #diaw0028#11 = aCampoK;
     #diaw0028#12 = aCampoL;
     #diaw0028#13 = aCampoM;
     #diaw0028#14 = aCampoN;
     #diaw0028#15 = aCampoO;
     #diaw0028#16 = aCampoP;
     #diaw0028#17 = aCampoQ;
     #diaw0028#18 = aCampoR;
     #diaw0028#19 = aCampoS;
     #diaw0028#20 = aCampoT;
     #diaw0028#21 = aCampoU;
     #diaw0028#22 = aCampoV;
     #diaw0028#23 = aCampoW;

     |GRABA 020#diaw0028.n;
     |LIBERA #diaw0028;
|FPRC;

|PROCESO BorraCampos;
     aCampoA  = "";
     aCampoB  = "";
     aCampoC  = "";
     aCampoD  = "";
     aCampoE  = "";
     aCampoF  = "";
     aCampoG  = "";
     aCampoH  = "";
     aCampoI  = "";
     aCampoJ  = "";
     aCampoK  = "";
     aCampoL  = "";
     aCampoM  = "";
     aCampoN  = "";
     aCampoO  = "";
     aCampoP  = "";
     aCampoQ  = "";
     aCampoR  = "";
     aCampoS  = "";
     aCampoT  = "";
     aCampoU  = "";
     aCampoV  = "";
     aCampoW  = "";
|FPRC;

|PROCESO RecogeCSV;
     |DBASE aBase;

     aAbre = aFicCSV;
     |XABRE "C", aAbre, nHandle;
     |PARA;  |SI FSalida ] 0;  |HACIENDO;
          |XLEE nHandle, 250, aAlfa;
          |SI FSalida < 0;  |SAL;  |FINSI;

          |HAZ BorraCampos;

          aCadena = aAlfa;  |QBF aCadena;
          aLong   = aCadena % 0;
          nLong   = aLong;
          nCampo  = 1;
          aTab    = ";";

          |PARA nCaracter = 1;  |SI nCaracter [ nLong;  |HACIENDO nCaracter = nCaracter + 1;
                nPos    = (100 * nCaracter) + 1;
                aCarac1 = aCadena % nPos;
                |SI aCarac1 = aTab;
                    nCampo = nCampo + 1;
                |SINO;
                    |SI nCampo = 1;   aCampoA  = aCampoA  + aCarac1;  |FINSI;
                    |SI nCampo = 2;   aCampoB  = aCampoB  + aCarac1;  |FINSI;
                    |SI nCampo = 3;   aCampoC  = aCampoC  + aCarac1;  |FINSI;
                    |SI nCampo = 4;   aCampoD  = aCampoD  + aCarac1;  |FINSI;
                    |SI nCampo = 5;   aCampoE  = aCampoE  + aCarac1;  |FINSI;
                    |SI nCampo = 6;   aCampoF  = aCampoF  + aCarac1;  |FINSI;
                    |SI nCampo = 7;   aCampoG  = aCampoG  + aCarac1;  |FINSI;
                    |SI nCampo = 8;   aCampoH  = aCampoH  + aCarac1;  |FINSI;
                    |SI nCampo = 9;   aCampoI  = aCampoI  + aCarac1;  |FINSI;
                    |SI nCampo = 10;  aCampoJ  = aCampoJ  + aCarac1;  |FINSI;
                    |SI nCampo = 11;  aCampoK  = aCampoK  + aCarac1;  |FINSI;
                    |SI nCampo = 12;  aCampoL  = aCampoL  + aCarac1;  |FINSI;
                    |SI nCampo = 13;  aCampoM  = aCampoM  + aCarac1;  |FINSI;
                    |SI nCampo = 14;  aCampoN  = aCampoN  + aCarac1;  |FINSI;
                    |SI nCampo = 15;  aCampoO  = aCampoO  + aCarac1;  |FINSI;
                    |SI nCampo = 16;  aCampoP  = aCampoP  + aCarac1;  |FINSI;
                    |SI nCampo = 17;  aCampoQ  = aCampoQ  + aCarac1;  |FINSI;
                    |SI nCampo = 18;  aCampoR  = aCampoR  + aCarac1;  |FINSI;
                    |SI nCampo = 19;  aCampoS  = aCampoS  + aCarac1;  |FINSI;
                    |SI nCampo = 20;  aCampoT  = aCampoT  + aCarac1;  |FINSI;
                    |SI nCampo = 21;  aCampoU  = aCampoU  + aCarac1;  |FINSI;
                    |SI nCampo = 22;  aCampoV  = aCampoV  + aCarac1;  |FINSI;
                    |SI nCampo = 23;  aCampoW  = aCampoW  + aCarac1;  |FINSI;

                    |SI nCampo > 23;  |SAL;  |FINSI;
                |FINSI;
          |SIGUE;

          |HAZ GrabaReg;
     |SIGUE;
     |XCIERRA nHandle;
|FPRC;

|PROCESO CogeCSV;
     nOk   = 1;
     aRuta = "";
     |HAZ Traete_dsselect;
     |SI enError = 1;
         nOk = 1;
         |MENAV "0000No puedo instalar el dsselect.exe, consulte con su administrador";
     |FINSI;

     |ESPECIFICA "RBASS", aLocal;
     aDirLocal = aLocal;

     |HAZ DimeUnidad;
     aAux      = eaUnidad + ":\DOCUMENTOS";               |RMKDIR aAux;
     aAux      = eaUnidad + ":\DOCUMENTOS\DSCOMER9";      |RMKDIR aAux;
     aAux      = eaUnidad + ":\DOCUMENTOS\DSCOMER9\";
     aPrograma = aAux + "dsselect.exe";

     aPathDSSelect = aAux;
     aBorra = aPathDSSelect + "dsselect.txt";
     |RFBORRA aBorra;

     aParaIni = aAux + "dsselect.ini";
     |RFBORRA aParaIni;

     aCarpetaCaptura = "/";

     aTextoIni = &34 + aCarpetaCaptura + &34 + " " + &34 + aBorra + &34;
     |XABRE "CW", aParaIni, nHandle;
     |SI FSalida ] 0;
          |XGRABA nHandle, aTextoIni;
     |FINSI;
     |XCIERRA nHandle;

     aEjecuta = aPrograma;
     |RSYSTEM aEjecuta;

     aAbre = aPathDSSelect + "dsselect.txt";
     |XABRE "CU", aAbre, nHandle;
     |SI FSalida < 0;
        aPath = "";
        nOk   = 0;
        |ACABA;
     |FINSI;

     |XLEE nHandle, 250, aPath;
     |SI FSalida < 0
         aPath = "";
         nOk   = 0;
         |ACABA;
     |FINSI;

     |QBF aPath;
     |SI aPath ! "";
         aAlfa    = aPath;
         aFichero = "";
         aLong    = aAlfa % 0;
         nLong    = aLong;
         aRuta    = "";
         |PARA nCarac = 1;  |SI nCarac [ nLong;  |HACIENDO nCarac = nCarac + 1;
               nPos   = (nCarac * 100) + 1;
               aCarac =  aAlfa % nPos;
               |SI aCarac = "/";  |O aCarac = "\";
                   aProg = "";
               |SINO;
                   aProg = aProg + aCarac;
               |FINSI;

               aRuta = aRuta + aCarac;
         |SIGUE;
     |FINSI;
     |XCIERRA nHandle;

     aBorra = aPathDSSelect + "dsselect.txt";
     |RFBORRA aBorra;

     aFicCSV = aRuta < "";

     aAlfa = aFicCSV - ".csv";
     |SI FSalida = 0;
         aAlfa = "0000El fichero deber  tener extesi¢n CSV";
         |MENAV aAlfa;
         nOk = 0;

         |ACABA;
     |FINSI;
|FPRC;

|PROGRAMA;
     |HAZ CogeCSV;
     |SI nOk = 0;  |ACABA;  |FINSI;

     |HAZ RecogeCSV;

     |CONSULTA_CLAVE #1#diaw0028;

     |CONFI "0000SRealizamos el cambio";
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |BUCLE diaw0028;
|FPRO;

|PROCESO T80;  |TIPO 80;
     aFic = "diaw0028" + Usuario;
     |NOME_DAT #diaw0028#aFic#;
     |ABRE #diaw0028;  |CIERRA #diaw0028;  |DELINDEX #diaw0028;

     |DDEF aDef;
     aMas = aDef + "agifa010.mas";  |CARGA_DEF aMas, albacab@;
     aMas = aDef + "agifa071.mas";  |CARGA_DEF aMas, albalin@;

     |ABRET #diaw0028;
     |ABRET #agifa024;
     |ABRET #dsm00003;
     |ABRET #agifa134;
     |ABRET #agifa059;
     |ABRET #agifa010;
     |ABRET #agifa071;
     |ABRET #agifa704;
     |ABRET #agifa722;
     |ABRET #agifa743;
     |ABRET #diam0007;
     |ABRET #diam0008;

     |ABRET #albacab@;
     |ABRET #albalin@;
|FPRC;

|PROCESO T90;  |TIPO 90;
     |CIERRAT #agifa024;
     |CIERRAT #dsm00003;
     |CIERRAT #agifa134;
     |CIERRAT #agifa059;
     |CIERRAT #agifa010;
     |CIERRAT #agifa071;
     |CIERRAT #agifa704;
     |CIERRAT #agifa722;
     |CIERRAT #agifa743;
     |CIERRAT #diam0007;
     |CIERRAT #diam0008;

     |CIERRAT #albalin@;  |DESCARGA_DEF #albalin@;
     |CIERRAT #albacab@;  |DESCARGA_DEF #albacab@;

     |CIERRAT #diaw0028;
     |DELINDEX #diaw0028;
|FPRC;
