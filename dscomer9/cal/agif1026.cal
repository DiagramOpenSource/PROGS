          || RecalTaller, modulo taller9

|FICHEROS;
     agifa026 #0;
     agifa010 #10;
     agifa019 #19;
     agifa017 #17;
     agifa024 #24;
     agifa059 #59;
     agifa134 #134;
     con00612@;
     con00625@;
     con00626@;
     con00683@;
|FIN;

|VARIABLES;
     &eaTallerCli1 = "";
     &eaTallerCli2 = "";
     &eaTallerCli3 = "";
     aEmp = "";
     aEsta = "";
     nEstado19 = 0;
     nEstado17 = 0;
     aDef = "";
     aAlfa = "";
     fmes = "";
     mes = 0;
     nMargen = 0;
     nImpo = 0;
     nCampo = 0;
|FIN;

|PROCESO con00626;
     |DDEFECTO #con00625@;
     #con00625@#0 = #con00626@#0;
     #con00625@#1 = #con00626@#1;
     |LEE 000#con00625@.=;

     #con00612@#2 = #con00626@#0;
     #con00612@#3 = #con00626@#1;
     |LEE 000#con00612@.=;
     |SI FSalida ! 0;
          #24#0 = #con00625@#11;
          |LEE 101#24=;
          |SI FSalida = 0;
               |SI #con00626@#38 = "A";
                    #24#50 = #24#50 + #con00626@#8;
                    |GRABA 020#24a;
               |FINSI;
               |SI #con00626@#38 = "F";
                    #24#50 = #24#50 + #con00626@#8;
                    |GRABA 020#24a;
               |FINSI;
               |LIBERA #24;
          |FINSI;
     |FINSI;

     |SI #con00626@#9 = 2; |O #con00626@#9 = 4;
          |DDEFECTO #19;
          #19#0 = #con00626@#2;
          |LEE 101#19=;
          nEstado19 = FSalida;
          |SI nEstado19 ! 0; |Y #0#5 = "S";
               |GRABA 020#19b;
               nEstado19 = FSalida;
          |FINSI;
          |DDEFECTO #17;
          #17#0 = #con00626@#2;
          #17#1 = 1;
          |LEE 101#17=;
          nEstado17 = FSalida;
          |SI nEstado17 ! 0; |Y #0#5 = "S";
               |GRABA 020#17b;
               nEstado17 = FSalida;
          |FINSI;

          #10#52 = #con00626@#25;
          #10#0 = #con00626@#26;
          |LEE 000#10=;
          |SI FSalida = 0;
               fmes = #10#1 % A402;
          |SINO;
               fmes = #con00625@#2 % A402;
          |FINSI;

          mes = fmes - 1;
          mes = mes * 5;
          mes = mes + 34;
          #19mes = #19mes + #con00626@#4;
          #19#94 = #19#94 + #con00626@#4;

          |SI #con00626@#36 ! 0; || Facturada
               #19#24 = #con00626@#37;
               #19#25 = #con00626@#4;
               |SI #con00626@#9 = 2; |O #con00626@#9 = 4;
                    |SI #con00626@#14 = "G"; |O #con00626@#14 = "S";
                         nMargen = -#con00626@#17;
                         nImpo = 0;
                    |SINO;
                         nMargen = #con00626@#8 - #con00626@#17;
                         nImpo = #con00626@#8;
                    |FINSI;
               |FINSI;
               #19#95 = #19#95 + nImpo;
               #19#96 = #19#96 + nMargen;
               aAlfa = #con00626@#37 % 402;
               nCampo = ((N\aAlfa) - 1) * 5 + 35;
               #19nCampo = #19nCampo + nImpo;
               nCampo = nCampo + 1;
               #19nCampo = #19nCampo + nMargen;
          |FINSI;

          mes = fmes - 1;
          mes = mes * 2;
          mes = mes + 11;
          #17mes = #17mes + #con00626@#4; ||salida mensual
          #17#35 = #17#35 + #con00626@#4; ||salida anual

          |SI nEstado19 = 0; |GRABA 020#19a; |FINSI;
          |SI nEstado17 = 0; |GRABA 020#17a; |FINSI;
          |LIBERA #19;
          |LIBERA #17;
     |FINSI;
|FPRC;

|DEFBUCLE con00626;
     #con00626@#1003;
     ;
     "     ", "      ", 0001;
     "zzzzz", "zzzzzz", 9999;
     ;
     NULL, con00626;
|FIN;

|PROCESO RecalTaller;
     |DDEF aDef;
     aAlfa = aDef + "con00625";
     |CARGA_DEF aAlfa, con00625@;
     |SI FSalida = 0;
          aAlfa = aDef + "con00626";
          |CARGA_DEF aAlfa, con00626@;
          |SI FSalida = 0;
               aAlfa = aDef + "con00612";
               |CARGA_DEF aAlfa, con00612@;
               |SI FSalida = 0;
                    |ABRE #con00612@; |SELECT #2#con00612@;
                    |ABRE #con00625@;
                    |ABRE #19;
                    |ABRE #17;
                    |ABRE #10;
                    |ABRE #24;
                    |BUCLE con00626;
                    |CIERRA #24;
                    |CIERRA #10;
                    |CIERRA #17;
                    |CIERRA #19;
                    |CIERRA #con00625@;
                    |CIERRA #con00612@;
                    |DESCARGA_DEF #con00612@;
               |FINSI;
               |DESCARGA_DEF #con00626@;
          |FINSI;
          |DESCARGA_DEF #con00625@;
     |FINSI;
|FPRC;

|PROCESO ParamTaller;
     |DFICE aEmp;
     aEmp = aEmp % -205;
     |DDEF aDef;
     aAlfa = aDef + "con00683";
     |CARGA_DEF aAlfa, con00683@;
     |SI FSalida = 0;
          |ABRE #con00683@;
          |LEE 000#con00683@.p;
          |CIERRA #con00683@;

          |SI aEmp = #con00683@#2; eaTallerCli1 = #con00683@#3; |FINSI;
          |SI aEmp = #con00683@#7; eaTallerCli2 = #con00683@#4; |FINSI;
          |SI aEmp = #con00683@#8; eaTallerCli3 = #con00683@#5; |FINSI;

          |DESCARGA_DEF #con00683@;
     |FINSI;
|FPRC;

|PROCESO AvPasadoOR;
     aEsta = "1";
     |SI #10#3 = eaTallerCli1; |O #10#3 = eaTallerCli2; |O #10#3 = eaTallerCli3;
          aAlfa = aDef + "con00612";
          |CARGA_DEF aAlfa, con00612@;
          |SI FSalida = 0;
               |ABRE #con00612@;
               #con00612@#0 = #10#52;
               #con00612@#1 = #10#0;
               |LEE 000#con00612@.=;
               |SI FSalida = 0; |Y #con00612@#3 ! "      ";
                    aEsta = 0;
               |FINSI;
               |CIERRA #con00612@;
               |DESCARGA_DEF #con00612@;
          |FINSI;
     |FINSI;
     FSalida = aEsta;
|FPRC;

|PROCESO AvPasadoORFac;
     |ABRE #59;
     #59#14 = #134#49;
     #59#0 = #134#0;
     #59#1 = 1;
     |LEE 000#59];
     |SI FSalida ! 0; |O #59#14 ! #134#49; |O #59#0 ! #134#0;
          |DDEFECTO #59;
     |FINSI;
     |CIERRA #59;

     aEsta = "1";
     |SI #10#3 = eaTallerCli1; |O #10#3 = eaTallerCli2; |O #10#3 = eaTallerCli3;
          aAlfa = aDef + "con00612";
          |CARGA_DEF aAlfa, con00612@;
          |SI FSalida = 0;
               |ABRE #con00612@;
               #con00612@#0 = #59#15;
               #con00612@#1 = #59#2;
               |LEE 000#con00612@.=;
               |SI FSalida = 0; |Y #con00612@#3 ! "      ";
                    aEsta = 0;
               |FINSI;
               |CIERRA #con00612@;
               |DESCARGA_DEF #con00612@;
          |FINSI;
     |FINSI;
     FSalida = aEsta;
|FPRC;
