|| Comunes:    Na, BtnSalir
               ImpreAviso, EditaAviso, AsignaMatri, HistoMaquina
               RecalAviso, EditaParte, CierraParte, ImpreParte
               AsignaMatriPar, Refresca1 2 3 4
               CreaAlba, EnvioSMS,
               EditaEntrega, CierraEntrega

|FICHEROS;
     gesiz006 #0;
     gesim002 #2;
     dsm00003 #3;
     gesim001 #6;
     gesiz009 #9;        || Pantalla Espera
     gesim011 #11;
     gesim012 #12;
     gesiz010 #13,MANTE;  || Avisos
     gesiz011 #29,MANTE;  || Entregas
     gesiz012 #14,MANTE;  || Partes
     gesiz013 #15,MANTE;  || Asg Matri
     gesim005 #17;
     gesim006 #18;
     gesim007 #19;
     gesim010 #20;
     gesim021 #21;
     gesim003 #22;
     gesim013 #23;  || Relacion Avisos/Albaranes
     agifa024 #24;
     agifa025 #25;
     agifa071 #71;
     agifa010 #100;
     agifa104 #104;
     agifa019 #119;
     gesiz014 #117,MANTE; ||Histo Matri
     gesiz015 #118,MANTE; ||Cierra Parte
     gesiz016 #121,MANTE; ||Productos
     gesim018 #180;
     gesiz017 #219,MANTE; ||Cierra Aviso
     agifa321 #321;
     agifa324 #324;

     dscam023@;
     dscam038@;
     gesim007@;
     referen@;

     &refera1@;
     &refera2@;
     &refera3@;
     &referb1@;
     &referb2@;
     &referb3@;
     &referc1@;
     &referc2@;
     &referc3@;
     &referd1@;
     &referd2@;
     &referd3@;
|FIN;

|INCLUYE i_varart;

|VARIABLES;
     nGModo = 0;
     &eaSerFactu = "";
     aSwImpre = "";
     nCuenta = 0;
     aEsFactu = "";
     &eaHora = "";
     &eaProg = "";
     &enTecnico = 0;
     nPan = 0;
     nLineas = 0;
     aConte = "";
     &enLin19 = 0;
     &eaClienteAnt = "";
     &enDirEntAnt = 0;

     &abo_alb = "";
     &fec_alb = @;
     &ser_fac = "";
     &num_fac = 0;
     &reimp = "";
     &ser_alb = "";
     &num_alb = 0;
     &abono = "";
     &eaMenuImpre = "";
     &enSwMenu = 0;
     &enDescuento1  = 0;
     &enDescuento2  = 0;
     &enComision    = 0;
     &eaTComision   = "";
     &uni_dt        = 0;
     &eaTag = "";
     &aDivisa = "";
     &aMoneda = "";
     &enPosiciona = 0;
     &enGrida1 = 0;
     &enGrida2 = 0;
     &enGrida3 = 0;
     &enGridb1 = 0;
     &enGridb2 = 0;
     &enGridb3 = 0;
     &enGridc1 = 0;
     &enGridc2 = 0;
     &enGridc3 = 0;
     &enGridd1 = 0;
     &enGridd2 = 0;
     &enGridd3 = 0;
     &eaMatricula = "";
     &eaSerAviso = "";
     &enNumAviso = 0;
     &Tempo = "";
     &enTipo = 0;
     &eaTipCto = "";
     &eaCliCto = "";
     &eaMatCto = "";
     &eaArtCto = "";
     nSal = 0;
     aAlfa = "";
     nConta = 0;
     i = 0;
     aEmpre = "";
     aNumEmp = "";
     nNumEmp = 0;
     aPath = "";
     aPathDat = "";
     aPathDef = "";
     &enHayParte = 0;
     nRango = 0;
     nPos1 = 0;
     nPos2 = 0;
     nPrecio = 0;
     nDto = 0;
     nHay = 0;
     nCampo = 0;
     aTmp19 = "";
     aFacturable = "N";
     importe = 0;
     cant = 0;
     nLin = 0;
     nModoPro = 0;
     aSerAlbAnt = "";
     nNumAlbAnt = 0;
     nVentana1 = 0;
     nVentana2 = 0;
     nVentana3 = 0;
     nVenEspera = -1;
 {-1}aVent = "";
     aVent1 = 0;
     aVent2 = 0;
     aVent3 = 0;
     aVent4 = 0;
     aVent5 = "";
     nBtnVerAviso = 0;
     nBtnVerParte = 0;
     nBtnAcepta = 0;
     nBtnCancela = 0;
     nPantaVnt = 0;
     nGridPar = 0;
     nGrid = 0;
     nPantaEnt = 0;
     nPantaPar = 0;
     nBtnAlta = 0;
     nBtnModi = 0;
     nBtnBaja = 0;
     nBtnConsu = 0;
     nError = 0;
     nSwSalir = 0;
     nSw = 0;
     aArtAlb = "";
     nUniAlb = 0;
     nPreAlb = 0;
     nDtoAlb = 0;
     aDesAlb = "";
     aFacAlb = "";
     aGarAlb = "";
|FINS;

|PROCESO BtnSalir;
     |SI nSwSalir = 0;
          nSwSalir = 1;
          |PTEC 807;
     |FINSI;
|FPRC;

|PROCESO Na; |TIPO 12;
|FPRC;

|PROCESO Productos;
     enHayParte = 1;
     |PRINT;
|FPRC;

|DEFBUCLE Productos;
     #19#1;
     ;
     #18#0, #18#1, #18#2, 001;
     #18#0, #18#1, #18#2, 999;
     ;
     NULL, Productos;
|FIN;

|PROCESO Partes;
     |BUCLE Productos;
|FPRC;

|PROCESO ImpAviso;
     Impresora = "CrystalReport";
     |IMPRE -1;
     |SI FSalida = 0;
          |ABRE #180;
          #180#0 = #17#0;
          |LEE 000#180=;
          |SI FSalida ! 0; |DDEFECTO #180; |FINSI;
          |CIERRA #180;
          aAlfa = #180#1; |QBF aAlfa;
          |INFOR aAlfa;
          |SI FSalida = 0;
               enHayParte = 0;
               |BUCLELIN 2 Partes #17;
               |SI enHayParte = 0;
                    |PRINT;
               |FINSI;
               |PIEINF;
               |FININF;
          |SINO;
               aAlfa = "0000Error en informe:"+ aAlfa;
               |MENAV aAlfa;
          |FINSI;
          |FINIMP;
     |SINO;
          |MENAV "0000Error en impresora 'CrystalReports'...";
     |FINSI;
|FPRC;

|PROCESO NumPed; |TIPO 0;
     |SI #13#46 ! 0;
          |ABRE #104;
          #104#25 = #13#45;
          #104#0 = #13#46;
          |LEE 000#104=;
          |SI FSalida ! 0;
               |MENAV "0000No existe pedido...";
          |FINSI;
          |CIERRA #104;
     |SINO;
          #13#45 = ""; |PINTA #13#45;
     |FINSI;
|FPRC;

|PROCESO PonArt13;
     |ABRE #119;
     #119#0 = #13#21;
     |LEE 000#119=;
     |SI FSalida = 0;
          #13#64 = #119#1; |PINTA #13#64;
     |FINSI;
     |CIERRA #119;
|FPRC;

|PROCESO Articu0; |TIPO 0;
     |ABRE #119;
     #119#0 = #13#21;
     |LEE 000#119=;
     |SI FSalida = 0;
          #13#64 = #119#1; |PINTA #13#64;
     |SINO;
          |MENAV "0000No existe c¢digo art¡culo...";
          |ERROR;
     |FINSI;
     |CIERRA #119;
|FPRC;

|PROCESO Conte13; |TIPO 7;
     aConte = #13Campo;
|FPRC;

|PROCESO Tecnico; |TIPO 0;
     |ABRE #22;
     #22#0 = #13#19;
     |LEE 000#22=;
     |SI FSalida = 0;
          #13#51 = #22#1; |PINTA #13#51;
     |SINO;
          |MENAV "0000No existe t‚cnico...";
          |ERROR;
     |FINSI;
     |CIERRA #22;
|FPRC;

|PROCESO Departa; |TIPO 0;
     |ABRE #12;
     #12#0 = #13#18;
     |LEE 000#12=;
     |SI FSalida = 0;
          #13#50 = #12#1; |PINTA #13#50;
          |SI aConte ! #13#18;
               #13#19 = #12#2; |PINTA #13#19;
               |HAZ Tecnico;
          |FINSI;
     |SINO;
          |MENAV "0000No existe departamento...";
          |ERROR;
     |FINSI;
     |CIERRA #12;
|FPRC;

|PROCESO TipoAviso; |TIPO 0;
     |ABRE #20;
     #20#0 = #13#17;
     |LEE 000#20=;
     |SI FSalida = 0;
          #13#49 = #20#1; |PINTA #13#49;
          |SI aConte ! #13#17;
               #13#18 = #20#2; |PINTA #13#18;
               |HAZ Departa;
          |FINSI;
     |SINO;
          |MENAV "0000No existe tipo aviso...";
          |ERROR;
     |FINSI;
     |CIERRA #20;
|FPRC;

|PROCESO Min2;
     #2#6 = #13#5;
     #2#0 = "                              ";
|FPRC;

|PROCESO Max2;
     #2#6 = #13#5;
     #2#0 = "zzzzzzzzzzzzzzzzzzzzzzzzzzzzzz";
|FPRC;

|PROCESO Maqui66; |TIPO 66;
     |ABRE #2; |SELECT #4#2;
     #2#6 = #13#5;
     #2#0 = #13#22;
     |LEE 000#2];
     |CONSULTA_F_CLAVE #4#2, Min2, Max2;
     |SI FSalida = 0;
          #13#22 = #2#0; |PINTA #13#22;
     |SINO;
          |ERROR;
     |FINSI;
     |CIERRA #2;
|FPRC;

|PROCESO Maqui0; |TIPO 0;
     aAlfa = #13#22; |QBF aAlfa;
     |SI aAlfa = "";
          |SI nSw = 0;
               |ABRE #20;
               #20#0 = #13#17;
               |LEE 000#20=;
               |SI FSalida ! 0; |DDEFECTO #20; |FINSI;
               |CIERRA #20;

               |SI #20#14 = "N";
                    |MENAV "0000Aviso sin m quina asignada, recuerde asociar m quina m s adelante";
               |FINSI;
          |FINSI;
     |SINO;
          |ABRE #2;
          #2#0 = #13#22;
          |LEE 000#2=;
          |SI FSalida = 0;
               #13#65 = #2#1; |PINTA #13#65;
               |SI nSw = 0;
                    |SI #2#6 ! #13#5; |Y aConte ! #13#22;
                         |AVISO;
                         aAlfa = "0000NLa m quina pertenece al cliente:" + #2#6 + ". ¨Continuar?";
                         |CONFI aAlfa;
                         |SI FSalida ! 0; |ERROR; |ACABA; |FINSI;
                    |FINSI;
                    |SI aConte ! #13#22; |O enModo = 1;
                         #13#21 = #2#20; |PINTA #13#21;
                         |HAZ Articu0;
                    |FINSI;
               |FINSI;
          |SINO;
               |SI nSw = 0;
                    |MENAV "0000No existe c¢digo m quina...";
                    |ERROR;
               |FINSI;
          |FINSI;
          |CIERRA #2;
     |FINSI;
|FPRC;

|PROCESO DirEnt7; |TIPO 7;
     |SI enModo = 1;
          eaClienteAnt = "";
          enDirEntAnt = 0;
     |SINO;
          eaClienteAnt = #13#5;
          enDirEntAnt = #13#6;
     |FINSI;
|FPRC;

|PROCESO DirEnt0; |TIPO 0;
     |ABRE #3;
     #3#0 = #13#5;
     #3#1 = #13#6;
     |LEE 000#3=;
     |SI FSalida = 0;
          |SI #3#18 = "N";
               |MENAV "0000Direcci¢n no activa...";
          |SINO;
               |SI eaClienteAnt ! #13#5; |O enDirEntAnt ! #13#6;
                    #13#48 = #3#2;
                    #13#55 = #3#3;
                    #13#56 = #3#4;
                    #13#57 = #3#5;
                    #13#58 = #3#7;
                    #13#60 = #3#13;
                    #13#61 = #3#21;
                    #13#62 = #3#24;
                    #13#67 = #3#20;

                    |PINTA #13#48;
                    |PINTA #13#55;
                    |PINTA #13#56;
                    |PINTA #13#57;
                    |PINTA #13#58;
                    |PINTA #13#60;
                    |PINTA #13#61;
                    |PINTA #13#62;
                    |PINTA #13#67;

                    eaClienteAnt = #13#5;
                    enDirEntAnt = #13#6;
               |FINSI;
          |FINSI;
     |SINO;
          |CONFI "0000NNo existe direcci¢n para este cliente. ¿Continuar?";
          |SI FSalida ! 0; |ERROR; |FINSI;
     |FINSI;
     |CIERRA #3;
|FPRC;

|PROCESO Min3;
     #3#0 = #13#5;
     #3#1 = 0001;
|FPRC;

|PROCESO Max3;
     #3#0 = #13#5;
     #3#1 = 9999;
|FPRC;

|PROCESO DirEnt66; |TIPO 66;
     |ABRE #3;
     #3#0 = #13#5;
     #3#1 = #13#6;
     |LEE 000#3];
     |CONSULTA_F_CLAVE #1#3, Min3, Max3;
     |SI FSalida = 0;
          #13#6 = #3#1; |PINTA #13#6;
     |SINO;
          |ERROR;
     |FINSI;
     |CIERRA #3;
|FPRC;

|PROCESO dscam038;
     aEmpre = ("00000" + #dscam038@#5) % -105;
     aPathDat = aPath + aEmpre + "/";
     |ERROR10;
|FPRC;

|DEFBUCLE dscam038;
     #dscam038@#1002;
     ;
     nNumEmp, 001;
     nNumEmp, 999;
     ;
     NULL, dscam038;
|FIN;

|PROCESO Cliente7; |TIPO 7;
     |SI enModo = 1;
          eaClienteAnt = "";
     |SINO;
          eaClienteAnt = #13#5;
     |FINSI;
|FPRC;

|PROCESO Cliente0; |TIPO 0;
     nError = 0;
     |DBASS aPath;
     aPath = aPath + "dscarter/";
     aPathDef = aPath + "def/";
     aAlfa = aPathDef + "dscam038";
     |CARGA_DEF aAlfa, dscam038@;
     |SI FSalida = 0;
          |DFICE aAlfa;
          aNumEmp = aAlfa % -205;
          nNumEmp = aNumEmp;
          aPath = aPath + "fich/";
          |PATH_DAT #dscam038@#aPath#;
          |BUCLE dscam038;
          |DESCARGA_DEF #dscam038@;

          aAlfa = aPathDef + "dscam023";
          |CARGA_DEF aAlfa, dscam023@;
          |SI FSalida ! 0; |MENAV "0000Error al cargar 'dscam023'"; |FINSI;
          |SI aPathDat = "";
||               |MENAV "0000Error, no encuentro empresa cartera";
          |SINO;
               |PATH_DAT #dscam023@#aPathDat#;
               |ABRE #dscam023@;
               #dscam023@#0 = #13#5;
               |LEE 000#dscam023@.=;
               |SI FSalida = 0; |Y #dscam023@#9 = "S";
                    aAlfa = "0000Cliente con riesgo bloqueado [" + #dscam023@#10 + "]";
                    |MENAV aAlfa;
                    nError = 1;
               |FINSI;
               |CIERRA #dscam023@;
          |FINSI;
          |DESCARGA_DEF #dscam023@;
     |FINSI;
     |SI nError = 0;
          |ABRE #21;
          #21#0 = #13#5;
          |LEE 000#21=;
          |SI FSalida ! 0;
               |MENAV "0000El cliente no tiene configurado los kms y las horas de desplazamiento...";
               |HAZ CliKmsHora;
          |FINSI;
          |CIERRA #21;
     |FINSI;
     |SI nError = 0;
          |SI #13#5 ! eaClienteAnt;
               |ABRE #24;
               |DDEFECTO #24;
               #24#0 = #13#5;
               |LEE 000#24=;
               |CIERRA #24;

               #13#47 = #24#1;
               #13#59 = #24#15;

               |PINTA #13#47;
               |PINTA #13#59;

               eaClienteAnt = #13#5;
          |FINSI;
     |FINSI;
     |SI nError ! 0; |ERROR; |FINSI;
|FPRC;

|PROCESO HoraAviso; |TIPO 0;
     |SI #13#66 ! "01.01.0000";
          eaHora = #13#68;
          |HAZ FormaHora;
          #13#68 = eaHora;
          |SI #13#68 = "00:00"; #13#68 = #6#36; |FINSI;
          |PINTA #13#68;
          |SI #13#68 < #6#36; |O #13#68 > #6#37;
               aAlfa = "0000El horario laboral es desde " + #6#36 + " hasta " + #6#37;
               |MENAV aAlfa;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO GrabaDir;
     |ABRE #24;
     #24#0 = #13#5;
     |LEE 020#24=;
     |CIERRA #24;

     |DDEFECTO #3;
     |ABRE #3;
     #3#0 = #13#5;
     #3#1 = #13#6;
     |LEE 000#3=;
     |SI FSalida ! 0;
          #3#10 = #24#2;
          #3#2 = #13#48;
          #3#3 = #13#55;
          #3#4 = #13#56;
          #3#5 = #13#57;
          #3#7 = #13#58;
          #3#13 = #13#60;
          #3#21 = #13#61;
          #3#24 = #13#62;
          |GRABA 020#3n;
     |FINSI;
     |CIERRA #13;
|FPRC;

|PROCESO GraLineal19;
     |SALVA_DATOS #gesim007@;
     |REPON_DATOS #19;
     |GRABA 020#19n;
|FPRC;

|DEFBUCLE GraLineal19;
     #gesim007@#1004;
     ;
     #18#0, #18#1, #18#2, 001;
     #18#0, #18#1, #18#2, 999;
     ;
     NULL, GraLineal19;
|FIN;

|PROCESO Graba19;
     |SALVA_DATOS #19;
     |REPON_DATOS #gesim007@;
     |GRABA 020#gesim007@.n;
|FPRC;

|DEFBUCLE Graba19;
     #19#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Graba19;
|FIN;

|PROCESO Borra19;
     |BORRA 020#gesim007@.a;
|FPRC;

|DEFBUCLE Borra19;
     #gesim007@#1004;
     ;
     #18#0, #18#1, #18#2, 001;
     #18#0, #18#1, #18#2, 999;
     be;
     NULL, Borra19;
|FIN;

|PROCESO GraLineal19N;
     |SALVA_DATOS #19;
     |REPON_DATOS #gesim007@;
     |GRABA 020#gesim007@.n;
|FPRC;

|DEFBUCLE GraLineal19N;
     #19#1;
     ;
     #18#0, #18#1, #18#2, 001;
     #18#0, #18#1, #18#2, 999;
     ;
     NULL, GraLineal19N;
|FIN;

|PROCESO Graba19N;
     |SALVA_DATOS #gesim007@;
     |REPON_DATOS #19;
     |GRABA 020#19n;
|FPRC;

|DEFBUCLE Graba19N;
     #gesim007@#1004;
     ;
     "     ", 000000, 000, 000;
     "zzzzz", 999999, 999, 999;
     ;
     NULL, Graba19N;
|FIN;

|PROCESO Borra19N;
     |BORRA 020#19a;
|FPRC;

|DEFBUCLE Borra19N;
     #19#1;
     ;
     #18#0, #18#1, #18#2, 001;
     #18#0, #18#1, #18#2, 999;
     be;
     NULL, Borra19N;
|FIN;

|PROCESO BtnAgendaAviso;
     enTecnico = #13#19;
     eaProg = "gesiz023";
     |HAZ EjecutaProg;
|FPRC;

|PROCESO EditaAviso;
     enError = 1;
     |SI enModo = 1; |VENTANA 901, 3498, -1, 17, "Nuevo Aviso"; |FINSI;
     |SI enModo = 2; |VENTANA 901, 3498, -1, 17, "Modificar Aviso"; |FINSI;
     nVentana1 = FSalida;
     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentana1;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |ABRE #17;
     |SI enModo = 1;
          #17#0 = #6#6;
          #17#1 = 999999;
          |LEE 000#17];
          |SI FSalida = 0;
               |LEE 000#17a;
          |SINO;
               |LEE 000#17u;
          |FINSI;
          |SI FSalida = 0; |Y #17#0 = #6#6;
               nConta = #17#1 + 1;
          |SINO;
               nConta = 1;
          |FINSI;
          |DDEFECTO #17;
          #17#0 = #6#6;
          #17#1 = nConta;
          |GRABA 020#17b;
          |SI FSalida = 0;
               |HORA aAlfa;
               |DDEFECTO #13;
               #13#0 = #6#6;
               #13#1 = nConta;
               #13#2 = ~;
               #13#3 = aAlfa;
               #13#4 = Usuario % 810;
               #13#5 = #0#0;
               #13#22 = #0#1;
               |PINPA #0#13; nPan = FSalida;
               |PINDA #0#13;
               |CONTROL_SIMPLE nPan, "BOTON,{{135}}Agenda", 2468, 2478, BtnAgendaAviso;
               |ENDATOS #1#13;
               |SI FSalida = 0;
                    |CONFI "0000N Imprimir aviso S/N:";
                    aSwImpre = FSalida;

                    |PARA i = 0; |SI i [ 47; |HACIENDO i = i + 1;
                         #17i = #13i;
                    |SIGUE;
                    |HAZ GrabaDir;
                    |DDEFECTO #24;
                    |ABRE #24;
                    #24#0 = #17#5;
                    |LEE 000#24=;
                    |CIERRA #24;
                    #17#48 = #24#2;
                    #17#49 = #13#52;
                    #17#50 = #13#53;
                    #17#51 = #13#54;
                    #17#52 = #13#48;
                    #17#53 = #13#55;
                    #17#54 = #13#56;
                    #17#55 = #13#57;
                    #17#56 = #13#58;
                    #17#57 = #13#59;
                    #17#58 = #13#60;
                    #17#59 = #13#61;
                    #17#60 = #13#62;
                    #17#61 = #13#63;
                    #17#62 = #13#64;
                    #17#64 = #13#66;
                    #17#65 = #13#67;
                    #17#66 = #13#68;
                    #17#71 = #13#69;
                    |SI #17#64 ! "01.01.0000"; |HAZ PasaProseso; |FINSI;
                    |SI #17#71 = "N"; #17#72 = "3"; |FINSI;
                    |SI #17#71 = "U"; #17#72 = "2"; |FINSI;
                    |SI #17#71 = "E"; #17#72 = "1"; |FINSI;
                    |GRABA 020#17a;
                    enError = 0;
                    |SI aSwImpre = 0;
                         |HAZ ImpAviso;
                    |FINSI;
               |SINO;
                    |BORRA 020#17c;
               |FINSI;
          |FINSI;
     |FINSI;
     |SI enModo = 2;
          |LEE 121#17=;
          |PARA i = 0; |SI i [ 47; |HACIENDO i = i + 1;
               #13i = #17i;
          |SIGUE;
          #13#52 = #17#49;
          #13#53 = #17#50;
          #13#54 = #17#51;
          #13#64 = #17#62;
          #13#66 = #17#64;
          #13#67 = #17#65;
          #13#68 = #17#66;
          #13#69 = #17#71;
          |DDEFECTO #24;
          |ABRE #24;
          #24#0 = #13#5;
          |LEE 020#24=;
          |CIERRA #24;
          |DDEFECTO #3;
          |ABRE #3;
          #3#0 = #13#5;
          #3#1 = #13#6
          |LEE 020#3=
          |CIERRA #3;
          |DDEFECTO #20;
          |ABRE #20;
          #20#0 = #13#17;
          |LEE 020#20=;
          |CIERRA #20;
          |DDEFECTO #12;
          |ABRE #12;
          #12#0 = #13#18;
          |LEE 020#12=;
          |CIERRA #12;
          |DDEFECTO #22;
          |ABRE #22;
          #22#0 = #13#19;
          |LEE 020#22=;
          |CIERRA #22;

          #13#48 = #17#52;
          #13#49 = #20#1;
          #13#50 = #12#1;
          #13#51 = #22#1;
          #13#55 = #17#53;
          #13#56 = #17#54;
          #13#57 = #17#55;
          #13#58 = #17#56;
          #13#59 = #17#57;
          #13#60 = #17#58;
          #13#61 = #17#59;
          #13#62 = #17#60;
          #13#63 = #17#61;
          nSw = 1;
          |HAZ Maqui0;
          nSw = 0;
          |PINPA #0#13; nPan = FSalida;
          |PINDA #0#13;
          |CONTROL_SIMPLE nPan, "BOTON,{{135}}Agenda", 2468, 2478, BtnAgendaAviso;
          |ENDATOS #2#13;
          |SI FSalida = 0;
               |PARA i = 0; |SI i [ 47; |HACIENDO i = i + 1;
                    #17i = #13i;
               |SIGUE;
               |HAZ GrabaDir;
               |HAZ RecalAviso;
               |DDEFECTO #24;
               |ABRE #24;
               #24#0 = #17#5;
               |LEE 000#24=;
               |CIERRA #24;
               #17#48 = #24#2;
               #17#49 = #13#52;
               #17#50 = #13#53;
               #17#51 = #13#54;
               #17#52 = #13#48;
               #17#53 = #13#55;
               #17#54 = #13#56;
               #17#55 = #13#57;
               #17#56 = #13#58;
               #17#57 = #13#59;
               #17#58 = #13#60;
               #17#59 = #13#61;
               #17#60 = #13#62;
               #17#61 = #13#63;
               #17#62 =  #13#64;
               #17#64 = #13#66;
               #17#65 = #13#67;
               #17#66 = #13#68;
               #17#71 = #13#69;
               |SI #17#71 = "N"; #17#72 = "3"; |FINSI;
               |SI #17#71 = "U"; #17#72 = "2"; |FINSI;
               |SI #17#71 = "E"; #17#72 = "1"; |FINSI;
               |GRABA 020#17a;
               |SI #17#64 ! "01.01.0000"; |Y #17#24 = "P";
                    |HAZ PasaProseso;
               |FINSI;
               enError = 0;
               |CONFI "0000N¨Imprimir aviso?";
               |SI FSalida = 0; |HAZ ImpAviso; |FINSI;
          |FINSI;
     |FINSI;
     |CIERRA #17;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentana1;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;
     |FINVENTANA nVentana1;
     |PULSATECLA;

     |SI enError = 0; |Y enModo = 1;
          |HAZ EnvioSMS;
     |FINSI;
|FPRC;

|PROCESO Conte15; |TIPO 7;
     aConte = #15Campo;
|FPRC;

|PROCESO Articu15_0; |TIPO 0;
     |ABRE #119;
     #119#0 = #15#14;
     |LEE 000#119=;
     |SI FSalida = 0;
          #15#18 = #119#1; |PINTA #15#18;
     |SINO;
          |SI nSw = 0;
               |MENAV "0000No existre c¢digo art¡culo...";
               |ERROR;
          |FINSI;
     |FINSI;
     |CIERRA #119;
|FPRC;

|PROCESO Min15_2;
     #2#6 = #15#2;
     #2#0 = "                              ";
|FPRC;

|PROCESO Max15_2;
     #2#6 = #15#2;
     #2#0 = "zzzzzzzzzzzzzzzzzzzzzzzzzzzzzz";
|FPRC;

|PROCESO Maqui15_66; |TIPO 66;
     |ABRE #2; |SELECT #4#2;
     #2#6 = #15#2;
     #2#0 = #15#15;
     |LEE 000#2];
     |CONSULTA_F_CLAVE #4#2, Min15_2, Max15_2;
     |SI FSalida = 0;
          #15#15 = #2#0; |PINTA #15#15;
     |SINO;
          |ERROR;
     |FINSI;
     |CIERRA #2;
|FPRC;

|PROCESO Maqui15_0; |TIPO 0;
     |ABRE #2;
     #2#0 = #15#15;
     |LEE 000#2=;
     |SI FSalida = 0;
          #15#19 = #2#1; |PINTA #15#19;
          |SI #15#15 ! aConte;
               #15#14 = #2#20; |PINTA #15#14;
               nSw = 1;
               |HAZ Articu15_0;
               nSw = 0;
          |FINSI;
          |SI #2#6 ! #15#2; |Y aConte ! #15#15;
               |AVISO;
               aAlfa = "0000NLa m quina pertenece al cliente:" + #2#6 + ". ¨Continuar?";
               |CONFI aAlfa;
               |SI FSalida ! 0; |ERROR; |ACABA; |FINSI;
          |FINSI;
     |SINO;
          |SI nSw = 0;
               |MENAV "0000No existe c¢digo m quina...";
               |ERROR;
          |FINSI;
     |FINSI;
     |CIERRA #2;
|FPRC;

|PROCESO AsgMatPro;
     #19#14 = #18#40;
     #19#15 = #18#41;
     |GRABA 020#19a;
|FPRC;

|DEFBUCLE AsgMatPro;
     #19#1;
     ;
     #18#0, #18#1, #18#2, 001;
     #18#0, #18#1, #18#2, 999;
     be;
     NULL, AsgMatPro;
|FIN;

|PROCESO AsgMatPar;
     #18#40 = #17#21;
     #18#41 = #17#22;
     |GRABA 020#18a;
     |LIBERA #18;
     |BUCLE AsgMatPro;
     |HAZ ActProdu2;
|FPRC;

|DEFBUCLE AsgMatPar;
     #18#1;
     ;
     #17#0, #17#1, 001;
     #17#0, #17#1, 999;
     be;
     NULL, AsgMatPar;
|FIN;

|PROCESO AsignaMatri;
     enError = 1;
     |VENTANA 0901, 2598, -1, 17, "Asignar M quina";
     nVentana1 = FSalida;
     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentana1;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |ABRE #17;
     |LEE 121#17=;
     #15#0 = #17#0;
     #15#1 = #17#1;
     #15#2 = #17#5;
     #15#3 = #17#6;
     #15#4 = #17#7;
     #15#5 = #17#8;
     #15#6 = #17#9;
     #15#7 = #17#10;
     #15#8 = #17#11;
     #15#9 = #17#12;
     #15#10 = #17#13;
     #15#11 = #17#14;
     #15#12 = #17#15;
     #15#13 = #17#16;
     #15#14 = #17#21;
     #15#15 = #17#22;

     |DDEFECTO #24;
     |ABRE #24;
     #24#0 = #15#2;
     |LEE 020#24=;
     |CIERRA #24;
     |DDEFECTO #3;
     |ABRE #3;
     #3#0 = #15#2;
     #3#1 = #15#3;
     |LEE 020#3=
     |CIERRA #3;
     |DDEFECTO #119;
     |ABRE #119;
     #119#0 = #15#14;
     |LEE 000#119=;
     |CIERRA #119;

     #15#16 = #24#1;
     #15#17 = #3#2;
     #15#18 = #119#0;

     nSw = 1;
     |HAZ Maqui15_0;
     nSw = 2;
     |PINPA #0#15;
     |PINDA #0#15;
     |ENDATOS #2#15;
     |SI FSalida = 0;
          #17#21 = #15#14;
          #17#22 = #15#15;
          #17#62 = #15#18;
          |GRABA 020#17a;
          |ABRE #18;
          #18#0 = #17#0;
          #18#1 = #17#1;
          #18#2 = 1;
          |LEE 000#18];
          |SI FSalida = 0; |Y #18#0 = #17#0; |Y #18#1 = #17#1;
               |CONFI "0000S¨Asignar m quina a todos los partes?";
               |SI FSalida = 0;
                    |BUCLE AsgMatPar;
               |FINSI;
          |FINSI;
          |CIERRA #18;
          enError = 0;
     |FINSI;
     |CIERRA #17;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentana1;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;
     |FINVENTANA nVentana1;

     |PULSATECLA;
|FPRC;

|PROCESO ImpreAviso;
     |ABRE #17;
     |LEE 020#17=;
     |SI FSalida = 0;
          |HAZ ImpAviso;
     |FINSI;
     |CIERRA #17;
|FPRC;

|PROCESO BtnVerParte;
|FPRC;

|PROCESO BtnVerAviso;
|FPRC;

|PROCESO Max18;
     #18#41 = eaMatricula;
     #18#0 = eaSerAviso;
     #18#1 = enNumAviso;
|FPRC;

|PROCESO Min18;
     #18#41 = eaMatricula;
     #18#0 = "     ";
     #18#1 = 0;
|FPRC;

|PROCESO Evento18;
     |SI FSalida = 1; |O FSalida = 2;
          |LEE 000#18=;
     |FINSI;
|FPRC;

|PROCESO HistoMaquina;
     |VENTANA 0901, 3698, -1, 17, "Hist¢rico M quina";
     nVentana1 = FSalida;
     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentana1;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     #117#0 = eaMatricula;
     |PINPA #0#117; nPantaVnt = FSalida;
     |PINDA #0#117;
     |CONTROL_SIMPLE nPantaVnt, "BOTON,Ver aviso", 0672, 0684, BtnVerAviso;
     nBtnVerAviso = FSalida;
|ESTADO_CONTROL nBtnVerAviso, "HIDE";    ||NO ESTA HECHO
     |CONTROL_SIMPLE nPantaVnt, "BOTON,Ver parte", 0685, 0697, BtnVerParte;
     nBtnVerParte = FSalida;
|ESTADO_CONTROL nBtnVerParte, "HIDE";   ||NO ESTA HECHO
     nRango = 4 + 8 + 16 + 32;
     nPos1 = 0702;
     nPos2 = 3197;
     |ABRE #18;
     |LINEAL_SIMPLE #8#18, nRango, nPos1, nPos2, Min18, Max18, Evento18;
     nGridPar = FSalida;
     |PAUSA;
     |CIERRA #18;
     |DESTRUYECONTROL nGridPar;
     |FIN_CONTROL_WINDOWS nBtnVerAviso;
     |FIN_CONTROL_WINDOWS nBtnVerParte;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentana1;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;
     |FINVENTANA nVentana1;

     |PULSATECLA;
|FPRC;

|PROCESO RecalProdu;
     #19#9 = #19#6 * #19#7;
     #19#10 = (#19#6 * #19#7) < #19#8;
     |SI #19#12 = "M";   || Materiales
          #18#34 = #18#34 + (#19#6 * #19#16);     ||Coste Mate
          #18#37 = #18#37 + #19#10;               ||Venta Mate
          #17#40 = #17#40 + (#19#6 * #19#16);     ||Coste Mate
          #17#43 = #17#43 + #19#10;               ||Venta Mate
     |FINSI;
     |SI #19#12 = "X";   || Otros
          #18#35 = #18#35 + (#19#6 * #19#16);     ||Coste Otros
          #18#38 = #18#38 + #19#10;               ||Venta Otros
          #17#41 = #17#41 + (#19#6 * #19#16);     ||Coste Otros
          #17#44 = #17#44 + #19#10;               ||Venta Otros
     |FINSI;
     |GRABA 020#19a;
     |LIBERA #19;
|FPRC;

|DEFBUCLE RecalProdu;
     #19#1;
     ;
     #18#0, #18#1, #18#2, 001;
     #18#0, #18#1, #18#2, 999;
     be;
     NULL, RecalProdu;
|FIN;

|PROCESO RecalParte;
     |PDEFECTO #18, 32, 39;
     |BUCLE RecalProdu;
     #18#42 = #17#45;    ||Ser Pedido
     #18#43 = #17#46;    ||Num Pedido
     |GRABA 020#18a;
     |LIBERA #18;

     eaArti = #17#50; |HAZ LeeArti;
     #17#39 = #17#39 + (#119#9 * #18#51)      ||Coste Mano Obra
     #17#42 = #17#42 + #18#53;                ||Imp M.Obra

     eaArti = #17#56; |HAZ LeeArti;
     #17#67 = #17#67 + (#119#9 * #18#57);     ||Coste Kms
     #17#69 = #17#69 + #18#59;                ||Imp Kms

     eaArti = #17#44; |HAZ LeeArti;
     #17#68 = #17#68 + (#119#9 * #18#45);     ||Coste Despl
     #17#70 = #17#70 + #18#47;                ||Imp Despl
|FPRC;

|PROCESO RecalAviso;
     |SALVA_DATOS #19;
     |SALVA_DATOS #18;

     |PDEFECTO #17, 38, 45;
     |PDEFECTO #17, 67, 71;
     |BUCLELIN 0 RecalParte #17;
     |GRABA 020#17a;

     |REPON_DATOS #18; |LEE 000#18=;
     |REPON_DATOS #19; |LEE 000#19=;
|FPRC;

|PROCESO Min19;
     #19#0 = #18#0;
     #19#1 = #18#1;
     #19#2 = #18#2;
     #19#3 = 1;
|FPRC;

|PROCESO Max19;
     #19#0 = #18#0;
     #19#1 = #18#1;
     #19#2 = #18#2;
     #19#3 = 999;
|FPRC;

|PROCESO Evento19;
     |SI FSalida = 1; |O FSalida = 2;
          |LEE 000#19=;
     |FINSI;
|FPRC;

|PROCESO PonPrecio; |TIPO 0;
     |SI #121Campo ! Contenido;
          |DDEFECTO #24;
          |ABRE #24;
          #24#0 = #121#13;
          |LEE 020#24=;
          |CIERRA #24;
          |DDEFECTO #119;
          |ABRE #119;
          #119#0 = #121#4;
          |LEE 020#119=;
          |CIERRA #119;
          |SI #24#39 = 1; nPrecio = #119#18; nDto = #119#21; |FINSI;
          |SI #24#39 = 2; nPrecio = #119#19; nDto = #119#22; |FINSI;
          |SI #24#39 = 3; nPrecio = #119#20; nDto = #119#23; |FINSI;
          |SI #24#39 = 4; nPrecio = #119#147; nDto = #119#150; |FINSI;
          |SI #24#39 = 4; nPrecio = #119#148; nDto = #119#151; |FINSI;
          |SI #24#39 = 4; nPrecio = #119#149; nDto = #119#152; |FINSI;
          #121#7 = nPrecio; |PINTA #121#7;
          #121#8 = nDto; |PINTA #121#8;
          #121#16 = #119#9;
     |FINSI;
|FPRC;

|PROCESO Total; |TIPO 0;
     #121#9 = #121#6 * #121#7;
     #121#10 = (#121#6 * #121#7) < #121#8;
     |PINTA #121#9;
     |PINTA #121#10;
|FPRC;

|PROCESO UltLinParte;
     |DDEF aAlfa;
     aAlfa = aAlfa + "gesim007";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |NOME_DAT #referen@#aTmp19#;
          |ABRE #referen@;
          #referen@#0 = #18#0;
          #referen@#1 = #18#1;
          #referen@#2 = #18#2;
          #referen@#3 = 999;
          |LEE 000#referen@.];
          |SI FSalida = 0;
               |LEE 000#referen@.a;
          |SINO;
               |LEE 000#referen@.u;
          |FINSI;
          |SI FSalida = 0; |Y #referen@#0 = #18#0; |Y #referen@#1 = #18#1;  |Y #referen@#2 = #18#2;
               nLin = #referen@#3 + 1;
          |SINO;
               nLin = 1;
          |FINSI;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|PROCESO GaraFacPro; |TIPO 0;
     |SI Campo = 11; |SI #121#11 = "S"; #121#17 = "N"; |FINSI; |PINTA #121#17; |FINSI;
     |SI Campo = 17; |SI #121#17 = "S"; #121#11 = "N"; |FINSI; |PINTA #121#11; |FINSI;
     |SI Campo = 11; |Y #121Campo = "S"; |Y aConte = "N";
          |DDEFECTO #24;
          |ABRE #24;
          #24#0 = #18#39;
          |LEE 000#24=;
          |CIERRA #24;
          |HAZ MiraCliFactu;
          |SI aEsFactu = "N";
               |CONFI "0000NEl cliente no es facturable. ¨Continuar?";
               |SI FSalida ! 0;
                    #121Campo = "N"; |PINTA #121Campo;
                    |ERROR;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Conte121; |TIPO 7;
     aConte = #121Campo;
|FPRC;

|PROCESO EditaProdu;
     enError = 1;
     |SI nModoPro = 1; |VENTANA 1611, 2889, -1, 17, "Nuevo Producto"; |FINSI;
     |SI nModoPro = 2; |VENTANA 1611, 2889, -1, 17, "Modificar Producto"; |FINSI;
     |SI nModoPro = 4; |VENTANA 1611, 2889, -1, 17, "Consulta Producto"; |FINSI;
     nVentana3 = FSalida;
     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentana3;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;
     |SI nModoPro = 1;
          |DDEFECTO #121;
          |SI #17#63 = "S";        || Entrega
               #18#0 = #29#0;
               #18#1 = #29#1;
               #18#2 = 1;
               #18#3 = 0;
               #18#39 = #29#5;
               #18#40 = #29#21;
               #18#41 = #29#22;
          |FINSI;
          #121#0 = #18#0;
          #121#1 = #18#1;
          #121#2 = #18#2;
          #121#3 = 0;
          #121#13 = #18#39;
          #121#14 = #18#40;
          #121#15 = #18#41;
     |SINO;
          |PARA i = 0; |SI i [ 18; |HACIENDO i = i + 1;
               #121i = #19i;
          |SIGUE;
     |FINSI;
     |PINPA #0#121;
     |PINDA #0#121;
     |SI nModoPro = 1; |ENDATOS #1#121; |FINSI;
     |SI nModoPro = 2; |ENDATOS #2#121; |FINSI;
     |SI nModoPro = 4; |PAUSA; |FINSI;
     |SI FSalida = 0;
          |SI nModoPro = 1;
               |PARA i = 0; |SI i [ 18; |HACIENDO i = i + 1;
                    #19i = #121i;
               |SIGUE;
               |HAZ UltLinParte;
               #19#3 = nLin;
               |GRABA 020#19n;
          |FINSI;
          |SI nModoPro = 2;
               |PARA i = 0; |SI i [ 18; |HACIENDO i = i + 1;
                    #19i = #121i;
               |SIGUE;
               |GRABA 020#19a;
          |FINSI;
          enError = 0;
     |FINSI;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentana3;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;
     |FINVENTANA nVentana1;

     |PULSATECLA;
|FPRC;

|PROCESO BtnAlta;
     nModoPro = 1; |HAZ EditaProdu;
     |SI enError = 0;
          |REFRESCACONTROL nGridPar;
     |FINSI;
|FPRC;

|PROCESO BtnModi;
     |LEE 101#19=;
     |SI FSalida ! 0; |ACABA; |FINSI;

     nModoPro = 2; |HAZ EditaProdu;
     |LIBERA #19;
     |SI enError = 0;
          |REFRESCACONTROL nGridPar;
     |FINSI;
|FPRC;

|PROCESO BtnBaja;
     |LEE 101#19=;
     |SI FSalida ! 0; |ACABA; |FINSI;

     aAlfa = "0000NBorrar linea de parte:" + (("000" + #19#3) % -103);
     |CONFI aAlfa;
     |SI FSalida = 0;
          |BORRA 020#19a;
          |REFRESCACONTROL nGridPar;
     |FINSI;
     |LIBERA #19;
|FPRC;

|PROCESO BtnConsu;
     |LEE 000#19=;
     |SI FSalida ! 0; |ACABA; |FINSI;

     nModoPro = 4; |HAZ EditaProdu;
|FPRC;

|PROCESO PinPanParte;
     |PINPA #0#14; nPantaPar = FSalida;
     |PINDA #0#14;
     nRango = 4 + 8 + 16 + 32;
     nPos1 = 2402;
     nPos2 = 3199;
     |LINEAL_SIMPLE #1#19, nRango, nPos1, nPos2, Min19, Max19, Evento19;
     nGridPar = FSalida;
     |CONTROL_SIMPLE nPantaPar, "BOTON,{{193}}Alta", 2302, 2314, BtnAlta;
     nBtnAlta = FSalida;
     |CONTROL_SIMPLE nPantaPar, "BOTON,{{197}}Modificar", 2315, 2327, BtnModi;
     nBtnModi = FSalida;
     |CONTROL_SIMPLE nPantaPar, "BOTON,{{199}}Baja", 2328, 2340, BtnBaja;
     nBtnBaja = FSalida;
     |CONTROL_SIMPLE nPantaPar, "BOTON,{{204}}Consulta", 2341, 2353, BtnConsu;
     nBtnConsu = FSalida;
     |CONTROL_SIMPLE nPantaPar, "BOTON,{{135}}Agenda", 1869, 1879, BtnAgendaParte;
|FPRC;

|PROCESO BtnAgendaParte;
     enTecnico = #14#10;
     eaProg = "gesiz023";
     |HAZ EjecutaProg;
|FPRC;

|PROCESO BorPanParte;
     |DESTRUYECONTROL nGridPar;
     |FIN_CONTROL_WINDOWS nBtnAlta;
     |FIN_CONTROL_WINDOWS nBtnModi;
     |FIN_CONTROL_WINDOWS nBtnBaja;
     |FIN_CONTROL_WINDOWS nBtnConsu;
|FPRC;

|PROCESO Conte14; |TIPO 7;
     aConte = #14Campo;
|FPRC;

|PROCESO Tecnico14; |TIPO 0;
     |ABRE #22;
     #22#0 = #14#10;
     |LEE 000#22=;
     |SI FSalida = 0;
          #14#46 = #22#1; |PINTA #14#46;
     |SINO;
          |MENAV "0000No existe t‚cnico...";
          |ERROR;
     |FINSI;
     |CIERRA #22;
|FPRC;

|PROCESO Departa14; |TIPO 0;
     |ABRE #12;
     #12#0 = #14#11;
     |LEE 000#12=;
     |SI FSalida = 0;
          #14#45 = #12#1; |PINTA #14#45;
          |SI aConte ! #14#11;
               #14#10 = #12#2; |PINTA #14#10;
               |HAZ Tecnico14;
          |FINSI;
     |SINO;
          |MENAV "0000No existe departamento...";
          |ERROR;
     |FINSI;
     |CIERRA #12;
|FPRC;

|PROCESO Articu14_0; |TIPO 0;
     |ABRE #119;
     #119#0 = #14#40;
     |LEE 000#119=;
     |SI FSalida = 0;
          #14#47 = #119#1; |PINTA #14#47;
     |SINO;
          |SI nSw = 0;
               |MENAV "0000No existe c¢digo art¡culo...";
               |ERROR;
          |FINSI;
     |FINSI;
     |CIERRA #119;
|FPRC;

|PROCESO Min14_2;
     #2#6 = #14#39;
     #2#0 = "                              ";
|FPRC;

|PROCESO Max14_2;
     #2#6 = #14#39;
     #2#0 = "zzzzzzzzzzzzzzzzzzzzzzzzzzzzzz";
|FPRC;

|PROCESO Maqui14_66; |TIPO 66;
     |ABRE #2; |SELECT #4#2;
     #2#6 = #14#39;
     #2#0 = #14#41;
     |LEE 000#2];
     |CONSULTA_F_CLAVE #4#2, Min14_2, Max14_2;
     |SI FSalida = 0;
          #14#41 = #2#0; |PINTA #14#41;
     |SINO;
          |ERROR;
     |FINSI;
     |CIERRA #2;
|FPRC;

|PROCESO Maqui14_0; |TIPO 0;
     aAlfa = #14#41; |QBF aAlfa;
     |SI aAlfa = "";
          |SI #20#14 = "N";
               |MENAV "0000Aviso sin m quina asignada, recuerde asociar m quina m s adelante";
          |FINSI;
     |SINO;
          |ABRE #2;
          #2#0 = #14#41;
          |LEE 000#2=;
          |SI FSalida = 0;
               #14#48 = #2#1; |PINTA #14#48;
               |SI #14#41 ! aConte;
                    #14#40 = #2#20; |PINTA #14#40;
                    nSw = 1;
                    |HAZ Articu14_0;
                    nSw = 0;
               |FINSI;
               |SI #2#6 ! #14#39; |Y aConte ! #14#41;
                    |AVISO;
                    aAlfa = "0000NLa m quina pertenece al cliente:" + #2#6 + ". ¨Continuar?";
                    |CONFI aAlfa;
                    |SI FSalida ! 0; |ERROR; |ACABA; |FINSI;
               |FINSI;
          |SINO;
               |MENAV "0000No existe c¢digo m quina...";
               |ERROR;
          |FINSI;
          |CIERRA #2;
     |FINSI;
|FPRC;

|PROCESO Defecto19;
     enLin19 = enLin19 + 1;
     #19#0 = #18#0;
     #19#1 = #18#1;
     #19#2 = #18#2;
     #19#3 = enLin19;
     #19#4 = #11#2;
     #19#5 = #11#3;
     #19#6 = #11#4;
     #19#7 = #11#5;
     #19#8 = #11#6;
     #19#9 = #19#6 * #19#7;
     #19#10 = #19#9 < #19#8;
     #19#11 = #11#11;
     |SI aEsFactu = "N"; #19#11 = "N"; |FINSI;
     #19#12 = #11#8;
     #19#13 = #18#39;
     #19#14 = #18#40;
     #19#15 = #18#41;
     #19#16 = #11#9;
     #19#17 = #11#10;
     |GRABA 020#19n;
|FPRC;

|DEFBUCLE Defecto19;
     #11#1;
     ;
     #17#17, 001;
     #17#17, 999;
     ;
     NULL, Defecto19;
|FIN;

|PROCESO Defecto19_0;
     |HAZ MiraCliFactu;
     |BUCLE Defecto19;
|FPRC;

|PROCESO TotaDes; |TIPO 0;
     #14#52 = #14#50 * #14#51; |PINTA #14#52;
|FPRC;

|PROCESO TotaMano; |TIPO 0;
     #14#58 = #14#56 * #14#57; |PINTA #14#58;
|FPRC;

|PROCESO TotaKms; |TIPO 0;
     #14#64 = #14#62 * #14#63; |PINTA #14#64;
|FPRC;

|PROCESO HoraParte; |TIPO 0;
     |SI #14#7 ! "01.01.0000";
          eaHora = #14#67;
          |HAZ FormaHora;
          #14#67 = eaHora;
          |SI #14#67 = "00:00"; #14#67 = #6#36; |FINSI;
          |PINTA #14#67;
          |SI #14#67 < #6#36; |O #14#67 > #6#37;
               aAlfa = "0000El horario laboral es desde " + #6#36 + " hasta " + #6#37;
               |MENAV aAlfa;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO GaraFacPar; |TIPO 0;
     |SI Campo = 53; |SI #14#53 = "S"; #14#54 = "N"; |FINSI; |PINTA #14#54; |FINSI;
     |SI Campo = 54; |SI #14#54 = "S"; #14#53 = "N"; |FINSI; |PINTA #14#53; |FINSI;
     |SI Campo = 59; |SI #14#59 = "S"; #14#60 = "N"; |FINSI; |PINTA #14#60; |FINSI;
     |SI Campo = 60; |SI #14#60 = "S"; #14#59 = "N"; |FINSI; |PINTA #14#59; |FINSI;
     |SI Campo = 65; |SI #14#65 = "S"; #14#66 = "N"; |FINSI; |PINTA #14#66; |FINSI;
     |SI Campo = 66; |SI #14#66 = "S"; #14#65 = "N"; |FINSI; |PINTA #14#65; |FINSI;
     |SI Campo = 54; |O Campo = 60; |O Campo = 66;
          |SI #14Campo = "S"; |Y aConte = "N";
               |DDEFECTO #24;
               |ABRE #24;
               #24#0 = #14#39;
               |LEE 000#24=;
               |CIERRA #24;
               |HAZ MiraCliFactu;
               |SI aEsFactu = "N";
                    |CONFI "0000NEl cliente no es facturable. ¨Continuar?";
                    |SI FSalida ! 0;
                         #14Campo = "N"; |PINTA #14Campo;
                         |ERROR;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO EditaParte
     enError = 1;
     |SI enModo = 1; |VENTANA 0901, 3898, -1, 17, "Nuevo Parte"; |FINSI;
     |SI enModo = 2; |VENTANA 0901, 3898, -1, 17, "Modificar Parte"; |FINSI;
     nVentana1 = FSalida;
     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentana1;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |DDEF aAlfa;
     aAlfa = aAlfa + "gesim007";
     |CARGA_DEF aAlfa, gesim007@;

     |HAZ CreaTempo; |NOME_DAT #19 Tempo; |DELINDEX #19; aTmp19 = Tempo;

     |ABRET #gesim007@;
     |ABRET #17;
     |ABRET #18;
     |ABRET #19;
     |LEE 121#17=;
     |SI enModo = 1;
          #18#0 = #17#0;
          #18#1 = #17#1;
          #18#2 = 999;
          |LEE 000#18];
          |SI FSalida = 0;
               |LEE 000#18a;
          |SINO;
               |LEE 000#18u;
          |FINSI;
          |SI FSalida = 0; |Y #18#0 = #17#0; |Y #18#1 = #17#1;
               nConta = #18#2 + 1;
          |SINO;
               nConta = 1;
          |FINSI;
          |HORA aAlfa;
          |DDEFECTO #24;
          |ABRE #24;
          #24#0 = #17#5;
          |LEE 000#24=;
          |CIERRA #24;
          |DDEFECTO #18;
          #18#0 = #17#0;
          #18#1 = #17#1;
          #18#2 = nConta;
          #18#3 = "A";
          #18#4 = Usuario % 810;
          #18#5 = ~;
          #18#6 = aAlfa;
          #18#10 = #17#19;
          #18#11 = #17#18;
          #18#12 = #17#7;
          #18#13 = #17#8;
          #18#14 = #17#9;
          #18#15 = #17#10;
          #18#16 = #17#11;
          #18#17 = #17#12;
          #18#18 = #17#13;
          #18#19 = #17#14;
          #18#20 = #17#15;
          #18#21 = #17#16;
          #18#39 = #17#5;
          #18#40 = #17#21;
          #18#41 = #17#22;
          #18#42 = #17#45;
          #18#43 = #17#46;
          |HAZ MiraCliFactu;
          |GRABA 020#18b;
          |SI FSalida = 0;
               |HORA aAlfa;
               |DDEFECTO #14;
               #14#0 = #18#0;
               #14#1 = #18#1;
               #14#2 = nConta;
               #14#3 = "A";
               #14#4 = Usuario % 810;
               #14#5 = ~;
               #14#6 = aAlfa;
               #14#7 = "01.01.0000";
               #14#10 = #17#19;
               #14#11 = #17#18;
               #14#12 = #17#7;
               #14#13 = #17#8;
               #14#14 = #17#9;
               #14#15 = #17#10;
               #14#16 = #17#11;
               #14#17 = #17#12;
               #14#18 = #17#13;
               #14#19 = #17#14;
               #14#20 = #17#15;
               #14#21 = #17#16;
               #14#39 = #17#5;
               #14#40 = #17#21;
               #14#41 = #17#22;
               #14#42 = #17#45;
               #14#43 = #17#46;
               |DDEFECTO #24;
               |ABRE #24;
               #24#0 = #14#39;
               |LEE 020#24=;
               |CIERRA #24;
               |DDEFECTO #12;
               |ABRE #12;
               #12#0 = #14#11;
               |LEE 020#12=;
               |CIERRA #12;
               |DDEFECTO #22;
               |ABRE #22;
               #22#0 = #14#10;
               |LEE 020#22=;
               |CIERRA #22;
               |DDEFECTO #21;
               |ABRE #21;
               #21#0 = #14#39;
               |LEE 020#21=;
               |CIERRA #21;
               #14#44 = #24#1;
               #14#45 = #12#1;
               #14#46 = #22#1;
               #14#49 = #12#5;
               #14#50 = #21#3;
               eaArti = #14#49; |HAZ LeeArti;
               #14#51 = #119#18;
               #14#52 = #14#50 * #14#51;
               #14#55 = #12#3;
               #14#56 = #12#4;
               eaArti = #14#55; |HAZ LeeArti;
               #14#57 = #119#18;
               #14#58 = #14#56 * #14#57;
               #14#61 = #12#6;
               #14#62 = #21#2;
               eaArti = #14#61; |HAZ LeeArti;
               #14#63 = #119#18;
               #14#64 = #14#62 * #14#63;
               enLin19 = 0;
               |HAZ Defecto19_0;
               |SI aEsFactu = "N";
                    #14#54 = "N";
                    #14#60 = "N";
                    #14#66 = "N";
               |FINSI;
               #14#68 = #17#71;
               |HAZ PinPanParte;
               |ENDATOS #1#14;
               |SI FSalida = 0;
                    |PARA i = 0; |SI i [ 43; |HACIENDO i = i + 1;
                         #18i = #14i;
                    |SIGUE;
                    #18#44 = #14#49;
                    #18#45 = #14#50;
                    #18#46 = #14#51;
                    #18#47 = #14#52;
                    #18#48 = #14#53;
                    #18#49 = #14#54;
                    #18#50 = #14#55;
                    #18#51 = #14#56;
                    #18#52 = #14#57;
                    #18#53 = #14#58;
                    #18#54 = #14#59;
                    #18#55 = #14#60;
                    #18#56 = #14#61;
                    #18#57 = #14#62;
                    #18#58 = #14#63;
                    #18#59 = #14#64;
                    #18#60 = #14#65;
                    #18#61 = #14#66;
                    #18#62 = #14#67;
                    #18#63 = #14#68;
                    |SI #18#63 = "N"; #18#64 = "3"; |FINSI;
                    |SI #18#63 = "U"; #18#64 = "2"; |FINSI;
                    |SI #18#63 = "E"; #18#64 = "1"; |FINSI;
                    |GRABA 020#18a;
                    |HAZ ActProdu2;
                    |BUCLE Graba19;
                    enError = 0;
                    |CONFI "0000N¨Imprimir aviso?";
                    |SI FSalida = 0; |HAZ ImpAviso; |FINSI;
               |SINO;
                   |BORRA 020#18c;
                   |HAZ BorProdu2;
               |FINSI;
               |HAZ BorPanParte;
          |FINSI;
     |FINSI;
     |SI enModo = 2;
          |LEE 121#18=;
          |PARA i = 0; |SI i [ 43; |HACIENDO i = i + 1;
               #14i = #18i;
          |SIGUE;
          #14#49 = #18#44;
          #14#50 = #18#45;
          #14#51 = #18#46;
          #14#52 = #18#47;
          #14#53 = #18#48;
          #14#54 = #18#49;
          #14#55 = #18#50;
          #14#56 = #18#51;
          #14#57 = #18#52;
          #14#58 = #18#53;
          #14#59 = #18#54;
          #14#60 = #18#55;
          #14#61 = #18#56;
          #14#62 = #18#57;
          #14#63 = #18#58;
          #14#64 = #18#59;
          #14#65 = #18#60;
          #14#66 = #18#61;
          #14#67 = #18#62;
          #14#68 = #18#63;
          |DDEFECTO #24;
          |ABRE #24;
          #24#0 = #14#39;
          |LEE 020#24=;
          |CIERRA #24;
          |DDEFECTO #12;
          |ABRE #12;
          #12#0 = #14#11;
          |LEE 020#12=;
          |CIERRA #12;
          |DDEFECTO #22;
          |ABRE #22;
          #22#0 = #14#10;
          |LEE 020#22=;
          |CIERRA #22;
          |DDEFECTO #119;
          |ABRE #119;
          #119#0 = #14#40;
          |LEE 020#119=;
          |CIERRA #119;
          |DDEFECTO #2;
          |ABRE #2;
          #2#0 = #14#41;
          |LEE 000#2=;
          |SI FSalida ! 0; |DDEFECTO #2; |FINSI;
          |CIERRA #2;
          #14#44 = #24#1;
          #14#45 = #12#1;
          #14#46 = #22#1;
          #14#47 = #119#1;
          #14#48 = #2#1;
          |BUCLE GraLineal19;
          |HAZ PinPanParte;
          |ENDATOS #2#14;
          |SI FSalida = 0;
               |PARA i = 0; |SI i [ 43; |HACIENDO i = i + 1;
                    #18i = #14i;
               |SIGUE;
               #18#44 = #14#49;
               #18#45 = #14#50;
               #18#46 = #14#51;
               #18#47 = #14#52;
               #18#48 = #14#53;
               #18#49 = #14#54;
               #18#50 = #14#55;
               #18#51 = #14#56;
               #18#52 = #14#57;
               #18#53 = #14#58;
               #18#54 = #14#59;
               #18#55 = #14#60;
               #18#56 = #14#61;
               #18#57 = #14#62;
               #18#58 = #14#63;
               #18#59 = #14#64;
               #18#60 = #14#65;
               #18#61 = #14#66;
               #18#62 = #14#67;
               #18#63 = #14#68;
               |SI #18#63 = "N"; #18#64 = "3"; |FINSI;
               |SI #18#63 = "U"; #18#64 = "2"; |FINSI;
               |SI #18#63 = "E"; #18#64 = "1"; |FINSI;
               |GRABA 020#18a;
               |HAZ ActProdu2;
               |BUCLE Borra19;
               |BUCLE Graba19;
               enError = 0;
               |CONFI "0000N¨Imprimir aviso?";
               |SI FSalida = 0; |HAZ ImpAviso; |FINSI;
          |FINSI;
          |HAZ BorPanParte;
     |FINSI;
     |CIERRAT #19;

     Tempo = aTmp19; |HAZ BoraTempo; |DELINDEX #19;
     aAlfa = "gesim007"; |NOME_DAT #19aAlfa;
     |ABRET #19;
     |HAZ RecalAviso;
     |CIERRAT #19;
     |CIERRAT #18;
     |CIERRAT #17;
     |CIERRAT #gesim007@;

     |DESCARGA_DEF #gesim007@;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentana1;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;
     |FINVENTANA nVentana1;

     |PULSATECLA;
|FPRC;

|PROCESO MiraCerrados;
     nLineas = nLineas + 1;
     |SI #17#63 = "S";
          |SI #18#3 = "A";
               nHay = 1;
               |ERROR10;
          |FINSI;
     |SINO;
          |SI #18#3 = "A"; |Y #18#2 ! #118#2;
               nHay = 1;
               |ERROR10;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE MiraCerrados;
     #18#1;
     ;
     #17#0, #17#1, 001;
     #17#0, #17#1, 999;
     ;
     NULL, MiraCerrados;
|FIN;

|PROCESO CierraAviso;
     |VENTANA 2111, 3089, -1, 17, "Cerrar Aviso";
     nVentana2 = FSalida;
     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentana2;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;
     |DDEFECTO #219;
     |PARA i = 0; |SI i [ 9; |HACIENDO i = i + 1;
          nCampo = i + 22;
          #219i = #118nCampo;
/*
          nCampo = i + 26;
          #219i = #17nCampo;
*/
     |SIGUE;
     aAlfa = "";
     |PARA i = 0; |SI i [ 9; |HACIENDO i = i + 1;
          aAlfa = #219i; |QBF aAlfa;
          |SI aAlfa ! ""; |SAL; |FINSI;
     |SIGUE;
     |SI aAlfa = ""; |Y nLineas = 1;
          #219#0 = #20#3;
          #219#1 = #20#4;
          #219#2 = #20#5;
          #219#3 = #20#6;
          #219#4 = #20#7;
          #219#5 = #20#8;
          #219#6 = #20#9;
          #219#7 = #20#10;
          #219#8 = #20#11;
          #219#9 = #20#12;
     |FINSI;
     |PINPA #0#219;
     |PINDA #0#219;
     |ENDATOS #2#219;
     |SI FSalida = 0;
          |PARA i = 0; |SI i [ 9; |HACIENDO i = i + 1;
               aAlfa = #219i; |QBF aAlfa;
               |SI aAlfa ! ""; |SAL; |FINSI;
          |SIGUE;
          |SI i > 9;
               |MENAV "0000No se ha indicado el texto de soluci¢n, no se cierra el parte...";
          |SINO;
               |PARA i = 0; |SI i [ 9; |HACIENDO i = i + 1;
                    nCampo = i + 26;
                    #17nCampo = #219i;
               |SIGUE;
               #17#24 = "C";
               |GRABA 020#17a;
               enError = 0;
          |FINSI;
     |FINSI;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentana2;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;
     |FINVENTANA nVentana2;

     |PULSATECLA;
|FPRC;

|PROCESO CierraParte;
     enError = 1;
     |VENTANA 1101, 3598, -1, 17, "Cerrar Parte";
     nVentana1 = FSalida;
     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentana1;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |ABRE #17;
     |ABRET #18;
     |ABRET #19;
     |LEE 121#17=;
     |LEE 121#18=;
     |PARA i = 0; |SI i [ 43; |HACIENDO i = i + 1;
          #118i = #18i;
     |SIGUE;
     |DDEFECTO #24;
     |ABRE #24;
     #24#0 = #118#39;
     |LEE 020#24=;
     |CIERRA #24;
     |DDEFECTO #12;
     |ABRE #12;
     #12#0 = #118#11;
     |LEE 020#12=;
     |CIERRA #12;
     |DDEFECTO #22;
     |ABRE #22;
     #22#0 = #118#10;
     |LEE 020#22=;
     |CIERRA #22;
     |DDEFECTO #119;
     |ABRE #119;
     #119 = #118#40;
     |LEE 000#119=;
     |CIERRA #119;
     |ABRE #2;
     #2#0 = #118#41;
     |LEE 000#2=;
     |SI FSalida ! 0; |DDEFECTO #2; |FINSI;
     |CIERRA #2;
     |ABRE #20;
     #20#0 = #17#17;
     |LEE 000#20=;
     |SI FSalida ! 0; |DDEFECTO #20; |FINSI;
     |CIERRA #20;
     aAlfa = "";
     |PARA i = 22; |SI i [ 31; |HACIENDO i = i + 1;
          aAlfa = #118i; |QBF aAlfa;
          |SI aAlfa ! ""; |SAL; |FINSI;
     |SIGUE;
     |SI aAlfa = "";
          #118#22 = #20#3;
          #118#23 = #20#4;
          #118#24 = #20#5;
          #118#25 = #20#6;
          #118#26 = #20#7;
          #118#27 = #20#8;
          #118#28 = #20#9;
          #118#29 = #20#10;
          #118#30 = #20#11;
          #118#31 = #20#12;
     |FINSI;
     #118#44 = #24#1;
     #118#45 = #12#1;
     #118#46 = #22#1;
     #118#47 = #119#1;
     #118#48 = #2#1;
     |PINPA #0#118;
     |PINDA #0#118;
     |ENDATOS #2#118;
     |SI FSalida = 0;
          |PARA i = 22; |SI i [ 31; |HACIENDO i = i + 1;
               aAlfa = #118i; |QBF aAlfa;
               |SI aAlfa ! ""; |SAL; |FINSI;
          |SIGUE;
          |SI i > 31;
               |MENAV "0000No se ha indicado el texto de soluci¢n, no se cierra el parte...";
          |SINO;
               nHay = 0;
               nLineas = 0;
               |SALVA_FICHA #18;
               |BUCLE MiraCerrados;
               |REPON_FICHA #18;
               |SI nHay = 0;
                    |HAZ CierraAviso;
                    FSalida = enError;
               |SINO;
                    FSalida = 0;
               |FINSI;
               |SI FSalida = 0;
                    |PARA i = 0; |SI i [ 43; |HACIENDO i = i + 1;
                         #18i = #118i;
                    |SIGUE;
                    #18#3 = "C";
                    #18#8 = ~;
                    #18#9 = Usuario % 810;
                    |GRABA 020#18a;
                    enError = 0;
               |FINSI;
          |FINSI;
     |FINSI;
     |HAZ RecalAviso;
     |CIERRAT #19;
     |CIERRAT #18;
     |CIERRA #17;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentana1;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;
     |FINVENTANA nVentana1;

     |PULSATECLA;
|FPRC;

|PROCESO ImpParte;
     Impresora = "CrystalReport";
     |IMPRE -1;
     |SI FSalida = 0;
          |ABRE #180;
          #180#0 = #18#0;
          |LEE 000#180=;
          |SI FSalida ! 0; |DDEFECTO #180; |FINSI;
          |CIERRA #180;
          aAlfa = #180#2; |QBF aAlfa;
          |INFOR aAlfa;
          |SI FSalida = 0;
               enHayParte = 0;
               |BUCLE Productos;
               |SI enHayParte = 0;
                    |PRINT;
               |FINSI;
               |PIEINF;
               |FININF;
          |SINO;
               aAlfa = "0000Error en informe:" + aAlfa;
               |MENAV aAlfa;
          |FINSI;
          |FINIMP;
     |FINSI;
|FPRC;

|PROCESO ImpreParte
     |ABRE #17;
     |ABRE #18;
     |LEE 020#17=;
     |LEE 020#18=;
     |SI FSalida = 0;
          |HAZ ImpParte;
     |FINSI;
     |CIERRA #18;
     |CIERRA #17;
|FPRC;

|PROCESO CuentaLin18;
     nCuenta = 0;
     |SALVA_FICHA #18;
     #18#0 = #15#0;
     #18#1 = #15#1;
     #18#2 = 0;
     |LEE 000#18];
     |PARA; |SI FSalida = 0; |Y #18#0 = #15#0; |Y #18#1 = #15#1; |HACIENDO;
          nCuenta = nCuenta + 1;
          |LEE 000#18s;
     |SIGUE;
     |REPON_FICHA #18;
|FPRC;

|PROCESO AsignaMatriPar;
     enError = 1;
     |VENTANA 0901, 2598, -1, 17, "Asignar M quina";
     nVentana1 = FSalida;
     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentana1;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |ABRET #17;
     |ABRET #18;
     |LEE 121#17=;
     |LEE 121#18=;
     #15#0 = #18#0;
     #15#1 = #18#1;
     #15#2 = #18#39;
     #15#3 = #17#6;
     #15#4 = #18#12;
     #15#5 = #18#13;
     #15#6 = #18#14;
     #15#7 = #18#15;
     #15#8 = #18#16;
     #15#9 = #18#17;
     #15#10 = #18#18;
     #15#11 = #18#19;
     #15#12 = #18#20;
     #15#13 = #18#21;
     #15#14 = #18#40;
     #15#15 = #18#41;

     |DDEFECTO #24;
     |ABRE #24;
     #24#0 = #15#2;
     |LEE 020#24=;
     |CIERRA #24;
     |DDEFECTO #3;
     |ABRE #3;
     #3#0 = #15#2;
     #3#1 = #15#3;
     |LEE 020#3=
     |CIERRA #3;
     |DDEFECTO #119;
     |ABRE #119;
     #119#0 = #15#14;
     |LEE 000#119=;
     |CIERRA #119;

     #15#16 = #24#1;
     #15#17 = #3#2;
     #15#18 = #119#0;

     |PINPA #0#15;
     |PINDA #0#15;
     |ENDATOS #2#15;
     |SI FSalida = 0;
          enError = 0;
          #18#40 = #15#14;
          #18#41 = #15#15;
          |GRABA 020#18a;
          |BUCLE AsgMatPro;
          |HAZ ActProdu2;
          |HAZ CuentaLin18;
          |SI nCuenta > 1;
               |SALVA_FICHA #18;
               enError = 0;
               |CONFI "0000SAsignar m quina a todos los partes";
               |SI FSalida = 0;
                    #17#21 = #15#14;
                    #17#22 = #15#15;
                    #17#62 = #15#18;
                    |GRABA 020#17a;
                    |BUCLE AsgMatPar;
               |FINSI;
               |REPON_FICHA #18;
          |SINO;
               |SI nCuenta = 1;
                    #17#21 = #15#14;
                    #17#22 = #15#15;
                    #17#62 = #15#18;
                    |GRABA 020#17a;
                    |MENAV "0000Cambiada m quina en Parte y Aviso...";
               |FINSI;
          |FINSI;
     |FINSI;
     |CIERRAT #18;
     |CIERRAT #17;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentana1;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;
     |FINVENTANA nVentana1;

     |PULSATECLA;
|FPRC;

|PROCESO Refresca1;
     #refera2@#1 = 0; |REFRESCACONTROL enGrida3;
     #refera1@#1 = 0; |REFRESCACONTROL enGrida2;
     |SALVA_DATOS #17;
     |REPON_DATOS #refera1@;
     |LEE 000#refera1@.=;
     |REFRESCACONTROL enGrida1;
     |SI enPosiciona = 1; |FOCOTECLADO enGrida1; |FINSI;
|FPRC;

|PROCESO Refresca2;
     #referb2@#1 = 0; |REFRESCACONTROL enGridb3;
     #referb1@#1 = 0; |REFRESCACONTROL enGridb2;
     |SALVA_DATOS #17;
     |REPON_DATOS #referb1@;
     |LEE 000#referb1@.=;
     |REFRESCACONTROL enGridb1;
     |SI enPosiciona = 1; |FOCOTECLADO enGridb1; |FINSI;
|FPRC;

|PROCESO Refresca3;
     #referc2@#1 = 0; |REFRESCACONTROL enGridc3;
     #referc1@#1 = 0; |REFRESCACONTROL enGridc2;
     |SALVA_DATOS #17;
     |REPON_DATOS #referc1@;
     |LEE 000#referc1@.=;
     |REFRESCACONTROL enGridc1;
     |SI enPosiciona = 1; |FOCOTECLADO enGridc1; |FINSI;
|FPRC;

|PROCESO Refresca4;
     #referd2@#1 = 0; |REFRESCACONTROL enGridd3;
     #referd1@#1 = 0; |REFRESCACONTROL enGridd2;
     |SALVA_DATOS #17;
     |REPON_DATOS #referd1@;
     |LEE 000#referd1@.=;
     |REFRESCACONTROL enGridd1;
     |SI enPosiciona = 1; |FOCOTECLADO enGridd1; |FINSI;
|FPRC;

|PROCESO CreaLinAlb0
     |ABRE #119;
     #119#0 = aArtAlb;
     |LEE 000#119=;
     |CIERRA #119;
     |SI aDesAlb = ""; aDesAlb = #119#1; |FINSI;

     enForma = 1;
     nLin = nLin + 1;
     |DDEFECTO #71;
     #71#29 = #100#52;
     #71#0 = #100#0;
     #71#1 = nLin;
     #71#2 = aArtAlb;
     #71#3 = 1;
     #71#4 = aDesAlb;
     #71#5 = nUniAlb * enTipo;
     #71#6 = nPreAlb;
     #71#8 = nDtoAlb;
     |SI aFacAlb = "N";
          |SI aGarAlb = "S";
               #71#8 = 100;
          |SINO;
               #71#8 = 100;
          |FINSI;
     |FINSI;
     #71#11 = #119#30;
     #71#13 = #119#2;
     #71#15 = #100#3;
     #71#16 = #100#34;
     #71#17 = #100#35;
     #71#36 = #71#6;
     #71#38 = #71#6;

     |HAZ AcumulaAV;
     #71#14 = enCoste;

     uni_dt = #71#5;
     enDescuento1 = #71#8;
     enDescuento2 = #71#33;
     eaTComision  = #71#16;
     eaCliente    = #100#3;
     eaArticulo   = #71#2;
     efFecha      = #100#1;
     eaRepre      = #100#6;
     enDirEnt = #100#84;
     enAlmacen = #71#3;
     |HAZ Comisiones;
     #71#10 = enComision;

     |HAZ TotalLin71;
     |GRABA 020#71n;
|FPRC;

|PROCESO CreaLinAlbPro;
     aArtAlb = #19#4; nUniAlb = #19#6; nPreAlb = #19#7; nDtoAlb = #19#8;
     aDesAlb = #19#5; aFacAlb = #19#11; aGarAlb = #19#17;
     |HAZ CreaLinAlb0
|FPRC;

|DEFBUCLE CreaLinAlbPro;
     #19#1;
     ;
     #18#0, #18#1, #18#2, 001;
     #18#0, #18#1, #18#2, 999;
     ;
     NULL, CreaLinAlbPro;
|FIN;

|PROCESO CreaLinAlbPar;
     aArtAlb = #18#44; nUniAlb = #18#45; nPreAlb = #18#46;
     nDtoAlb = 0; aDesAlb = ""; aFacAlb = #18#49; aGarAlb = #18#48;
     |HAZ CreaLinAlb0
     aArtAlb = #18#50; nUniAlb = #18#51; nPreAlb = #18#52;
     nDtoAlb = 0; aDesAlb = ""; aFacAlb = #18#55; aGarAlb = #18#54;
     |HAZ CreaLinAlb0
     aArtAlb = #18#56; nUniAlb = #18#57; nPreAlb = #18#58;
     nDtoAlb = 0; aDesAlb = ""; aFacAlb = #18#61; aGarAlb = #18#60;
     |HAZ CreaLinAlb0

     |BUCLE CreaLinAlbPro;
|FPRC;

|DEFBUCLE CreaLinAlbPar;
     #18#1;
     ;
     #17#0, #17#1, 001;
     #17#0, #17#1, 999;
     ;
     NULL, CreaLinAlbPar;
|FIN;

|PROCESO CheqFactu;
     |SI #19#11 = "S";
          aFacturable = "S";
          |ERROR10;
     |FINSI;
|FPRC;

|DEFBUCLE CheqFactu;
     #19#1;
     ;
     #17#0, #17#1, 001, 001;
     #17#0, #17#1, 999, 999;
     ;
     NULL, CheqFactu;
|FIN;

|PROCESO CreaAlba;
     |SI #18#49 = "S"; |O #18#55 = "S"; |O #18#61 = "S";
          aFacturable = "S";
     |SINO;
          aFacturable = "N";
          |BUCLE CheqFactu;
     |FINSI;
     |SI aFacturable = "N";
          #100#52 = #6#14;
     |SINO;
          #100#52 = #6#13;
     |FINSI;

     |LEE 121#17=;
     #17#23 = aFacturable;
     |GRABA 020#17a;
     |LIBERA #17;

     aSerAlbAnt = "";
     |SI enTipo = -1;
          aFacturable = "N";
          |ABRE #23;
          #23#0 = #17#0;
          #23#1 = #17#1;
          #23#4 = 999;
          |LEE 000#23];
          |SI FSalida = 0;
               |LEE 000#23a;
          |SINO;
               |LEE 000#23u;
          |FINSI;
          |SI FSalida = 0; |Y #23#0 = #17#0; |Y #23#1 = #17#1;
               aSerAlbAnt = #23#2;
               nNumAlbAnt = #23#3;
          |FINSI;
          |CIERRA #23;
     |FINSI;

     |ABRE #321; |LEE 000#321p; |CIERRA #321;

     |DDEFECTO #24;
     |ABRE #24;
     #24#0 = #17#5;
     |LEE 020#24=;
     |CIERRA #24;
     |DDEFECTO #3;
     |ABRE #3;
     #3#0 = #17#5;
     #3#1 = #17#6;
     |LEE 020#3=;
     |CIERRA #3;

     |DDEFECTO #25;
     |ABRE #25;
     |SI #3#14 = "  ";
          #25#0 = #24#25;
     |SINO;
          #25#0 = #3#14;
     |FINSI;
     |LEE 020#25=;
     |CIERRA #25;

     |ABRE #100;
     |ABRE #71;
     enSwMenu = 1;
     |HAZ ContaAV7;
     |GRABA 020#100b;
     enError = FSalida;
     |SI FSalida = 0;
          #17#36 = #100#52;
          #17#37 = #100#0;

          #100#3 = #24#0;
          #100#4 = #24#2;
          #100#5 = #24#37;
          #100#6 = #25#0;
          #100#7 = #24#38;
          #100#8 = #24#20;
          #100#29 = #17#47; || #3#10;
          #100#30 = #17#52; || #3#2;
          #100#31 = #17#53; || #3#3;
          #100#32 = #24#146;
          #100#33 = #17#56; ||#3#7;
          #100#34 = #25#7;
          #100#35 = #24#4;
          #100#36 = #24#47;
          #100#40 = #24#41;
          #100#51 = aFacturable;

          #100#56 = #17#50;

          aAlfa = #17#0 + "/" + (("000000" + #17#1) % -106);
          #100#57 = aAlfa;

          aAlfa = (("00" + #17#54) % -102) + (("000" + #17#55) % -103);
          #100#62 = aAlfa; ||#3#6;

          #100#63 = #17#57; || #24#15;

          |ABRE #324
          #100#68 = #24#192;
          |DDEFECTO #324;
          #324#0 = #100#68;
          |LEE 000#324=;
          #100#69 = #324#2;
          #100#70 = #24#193;
          #100#73 = #321#9;
          |DDEFECTO #324;
          #324#0 = #100#73;
          |LEE 000#324=;
          #100#74 = #324#2;
          |CIERRA #324;
          aDivisa = #100#68;
          aMoneda = #100#70;
          |HAZ Divisas010;
          #100#84 = #3#1;
          nLin = 0;
          |BUCLE CreaLinAlbPar;
          |HAZ LimCabAgifa010;
          |BUCLELIN 0 CalCabAgifa010 #100;
          |HAZ actpf;
          |SI aSerAlbAnt ! "";
               aAlfa = aSerAlbAnt + "/" + (("000000" + nNumAlbAnt) % -106);
               #100#56 = aAlfa;
          |FINSI;
          |GRABA 020#100a;
          |LIBERA #100;

          nGModo = enModo;
          enModo = 1;
          eaSerie = #100#52;
          enCodigo = #100#0;
          |SUB_EJECUTA_NP "cafe0021";
          enModo = nGModo;

          |SI enTipo = 1;
               |CONFI "0000N¨Imprimir albar n?";
               |SI FSalida = 0;
                    ser_alb = #100#52;
                    num_alb = #100#0;
                    abono = #100#43;
                    eaMenuImpre = "N";
                    |SUB_EJECUTA_NP "agifa014";
               |FINSI;
               |CONFI "0000N¨Facturar albar n?";
               |SI FSalida = 0;
                    ser_alb = #100#52;
                    num_alb = #100#0;
                    fec_alb = #100#1;
                    abo_alb = #100#43;
                    eaSerFactu = ser_alb;
                    |SUB_EJECUTA_NP "agifa057";
               |FINSI;
          |FINSI;

          |ABRE #23;
          #23#0 = #17#0;
          #23#1 = #17#1;
          #23#4 = 999;
          |LEE 000#23];
          |SI FSalida = 0;
               |LEE 000#23a;
          |SINO;
               |LEE 000#23u;
          |FINSI;
          |SI FSalida = 0; |Y #23#0 = #17#0;  |Y #23#1 = #17#1;
               nConta = #23#4 + 1;
          |SINO;
               nConta = 1;
          |FINSI;
          |DDEFECTO #23;
          #23#0 = #17#0;
          #23#1 = #17#1;
          #23#2 = #100#52;
          #23#3 = #100#0;
          #23#4 = nConta;
          |GRABA 020#23n;
          |CIERRA #23;

          enForma = 1;
          aAlfa = "cafe0026;GESISAT" + #100#52 + (("000000" + #100#0) % -106) + #100#3 + #100#1;
          |SUB_EJECUTA_NP aAlfa;

          |SI aSerAlbAnt ! "";
               aAlfa = #100#52 + "/" + (("000000" + #100#0) % -106);
               #100#52 = aSerAlbAnt;
               #100#0 = nNumAlbAnt;
               |LEE 121#100=;
               |SI FSalida = 0;
                    #100#51 = "N";
                    #100#56 = aAlfa;
                    |GRABA 020#100a;
               |FINSI;
          |FINSI;
     |FINSI;
     |CIERRA #71;
     |CIERRA #100;
|FPRC;

---------------------------------------------------------
|PROCESO Articu29; |TIPO 0;
     |ABRE #119;
     #119#0 = #29#21;
     |LEE 000#119=;
     |SI FSalida = 0;
          #29#64 = #119#1; |PINTA #29#64;
     |SINO;
          |MENAV "0000No existe c¢digo art¡culo...";
          |ERROR;
     |FINSI;
     |CIERRA #119;
|FPRC;

|PROCESO Conte29; |TIPO 7;
     aConte = #29Campo;
|FPRC;

|PROCESO Tecnico29; |TIPO 0;
     |ABRE #22;
     #22#0 = #29#19;
     |LEE 000#22=;
     |SI FSalida = 0;
          #29#51 = #22#1; |PINTA #29#51;
     |SINO;
          |MENAV "0000No existe t‚cnico...";
          |ERROR;
     |FINSI;
     |CIERRA #22;
|FPRC;

|PROCESO TotaDes29; |TIPO 0;
     #29#72 = #29#70 * #29#71; |PINTA #29#72;
|FPRC;

|PROCESO TotaMano29; |TIPO 0;
     #29#78 = #29#76 * #29#77; |PINTA #29#78;
|FPRC;

|PROCESO TotaKms29; |TIPO 0;
     #29#84 = #29#82 * #29#83; |PINTA #29#84;
|FPRC;

|PROCESO Departa29; |TIPO 0;
     |ABRE #12;
     #12#0 = #29#18;
     |LEE 000#12=;
     |SI FSalida = 0;
          #29#50 = #12#1; |PINTA #29#50;
          |SI aConte ! #29#18;
               #29#19 = #12#2; |PINTA #29#19;
               |HAZ Tecnico29;
               |ABRE #21;
               #21#0 = #29#5;
               |LEE 020#21=;
               |SI FSalida ! 0; |DDEFECTO #21; |FINSI;
               |CIERRA #21;
               #29#69 = #12#5; |PINTA #29#69;
               #29#70 = #21#3; |PINTA #29#70;
               eaArti = #29#69; |HAZ LeeArti;
               #29#71 = #119#18; |PINTA #29#71;
               #29#72 = #29#70 * #29#71; |PINTA #29#72;
               #29#75 = #12#3; |PINTA #29#75;
               #29#76 = #12#4; |PINTA #29#76;
               eaArti = #29#75; |HAZ LeeArti;
               #29#77 = #119#18; |PINTA #29#77;
               #29#78 = #29#76 * #29#77; |PINTA #29#78;
               #29#81 = #12#6; |PINTA #29#81;
               #29#82 = #21#2; |PINTA #29#82;
               eaArti = #29#81; |HAZ LeeArti;
               #29#83 = #119#18; |PINTA #29#83;
               #29#84 = #29#82 * #29#83; |PINTA #29#84;
          |FINSI;
     |SINO;
          |MENAV "0000No existe departamento...";
          |ERROR;
     |FINSI;
     |CIERRA #12;
|FPRC;

|PROCESO Defecto29_19;
|FPRC;

|DEFBUCLE Defecto29_19;
     #11#1;
     ;
     #17#17, 001;
     #17#17, 999;
     ;
     NULL, Defecto29_19;
|FIN;

|PROCESO Borra29_19;
     |BORRA 020#19a;
|FPRC;

|DEFBUCLE Borra29_19;
     #19#1;
     ;
     #18#0, #18#1, #18#2, 1;
     #18#0, #18#1, #18#2, 999;
     ;
     NULL, Borra29_19;
|FIN;

|PROCESO TipoAviso29; |TIPO 0;
     |ABRE #20;
     #20#0 = #29#17;
     |LEE 000#20=;
     |SI FSalida = 0;
          #29#49 = #20#1; |PINTA #29#49;
          |SI aConte ! #29#17;
               #29#18 = #20#2; |PINTA #29#18;
               |HAZ Departa29;
               |SI enModo = 1;
                    #17#17 = #29#17;
                    |BUCLE Borra29_19;
                    #18#39 = #29#5;
                    #18#40 = #29#21;
                    #18#41 = #29#22;
                    |DDEFECTO #24;
                    |ABRE #24;
                    #24#0 = #18#39;
                    |LEE 000#24=;
                    |CIERRA #24;
                    |HAZ Defecto19_0;
                    |REFRESCACONTROL nGridPar;
                    |PULSATECLA;
               |FINSI;
          |FINSI;
     |SINO;
          |MENAV "0000No existe tipo aviso...";
          |ERROR;
     |FINSI;
     |CIERRA #20;
|FPRC;

|PROCESO Min29_2;
     #2#6 = #29#5;
     #2#0 = "                              ";
|FPRC;

|PROCESO Max29_2;
     #2#6 = #29#5;
     #2#0 = "zzzzzzzzzzzzzzzzzzzzzzzzzzzzzz";
|FPRC;

|PROCESO Maqui29_66; |TIPO 66;
     |ABRE #2; |SELECT #4#2;
     #2#6 = #29#5;
     #2#0 = #29#22;
     |LEE 000#2];
     |CONSULTA_F_CLAVE #4#2, Min29_2, Max29_2;
     |SI FSalida = 0;
          #29#22 = #2#0; |PINTA #29#22;
     |SINO;
          |ERROR;
     |FINSI;
     |CIERRA #2;
|FPRC;

|PROCESO Maqui29_0; |TIPO 0;
     |ABRE #20;
     #20#0 = #29#17;
     |LEE 000#20=;
     |SI FSalida ! 0; |DDEFECTO #20; |FINSI;
     |CIERRA #20;

     aAlfa = #29#22; |QBF aAlfa;
     |SI aAlfa = "";
          |SI nSw = 0;
               |SI #20#14 = "N";
                    |MENAV "0000Aviso sin m quina asignada, recuerde asociar m quina m s adelante";
               |FINSI;
          |FINSI;
     |SINO;
          |ABRE #2;
          #2#0 = #29#22;
          |LEE 000#2=;
          |SI FSalida = 0;
               #29#65 = #2#1; |PINTA #29#65;
               |SI nSw = 0;
                    |SI #2#6 ! #29#5; |Y aConte ! #29#22;
                         |AVISO;
                         aAlfa = "0000NLa m quina pertenece al cliente:" + #2#6 + ". ¨Continuar?";
                         |CONFI aAlfa;
                         |SI FSalida ! 0; |ERROR; |ACABA; |FINSI;
                    |FINSI;
                    |SI aConte ! #29#22; |O enModo = 1;
                         #29#21 = #2#20; |PINTA #29#21;
                         |HAZ PonArt29;
                    |FINSI;
               |FINSI;
          |SINO;
               |SI nSw = 0;
                    |MENAV "0000No existe c¢digo m quina...";
                    |ERROR;
               |FINSI;
          |FINSI;
          |CIERRA #2;
     |FINSI;
|FPRC;

|PROCESO NumPed29; |TIPO 0;
     |SI #29#46 ! 0;
          |ABRE #104;
          #104#25 = #29#45;
          #104#0 = #29#46;
          |LEE 000#104=;
          |SI FSalida ! 0;
               |MENAV "0000No existe pedido...";
          |FINSI;
          |CIERRA #104;
     |SINO;
          #29#45 = ""; |PINTA #29#45;
     |FINSI;
|FPRC;

|PROCESO PonArt29;
     |ABRE #119;
     #119#0 = #29#21;
     |LEE 000#119=;
     |SI FSalida = 0;
          #29#64 = #119#1; |PINTA #29#64;
     |FINSI;
     |CIERRA #119;
|FPRC;

|PROCESO Mini3;
     #3#0 = #29#5;
     #3#1 = 0001;
|FPRC;

|PROCESO Maxi3;
     #3#0 = #29#5;
     #3#1 = 9999;
|FPRC;

|PROCESO DirEnt2966; |TIPO 66;
     |ABRE #3;
     #3#0 = #29#5;
     #3#1 = #29#6;
     |LEE 000#3];
     |CONSULTA_F_CLAVE #1#3, Mini3, Maxi3;
     |SI FSalida = 0;
          #29#6 = #3#1; |PINTA #29#6;
     |SINO;
          |ERROR;
     |FINSI;
     |CIERRA #3;
|FPRC;

|PROCESO DirEnt297; |TIPO 7;
     |SI enModo = 1;
          eaClienteAnt = "";
          enDirEntAnt = 0;
     |SINO;
          eaClienteAnt = #29#5;
          enDirEntAnt = #29#6;
     |FINSI;
|FPRC;

|PROCESO DirEnt290; |TIPO 0;
     |ABRE #3;
     #3#0 = #29#5;
     #3#1 = #29#6;
     |LEE 000#3=;
     |SI FSalida = 0;
          |SI #3#18 = "N";
               |MENAV "0000Direcci¢n no activa...";
          |SINO;
               |SI eaClienteAnt ! #29#5; |O enDirEntAnt ! #29#6;
                    #29#48 = #3#2;
                    #29#55 = #3#3;
                    #29#56 = #3#4;
                    #29#57 = #3#5;
                    #29#58 = #3#7;
                    #29#60 = #3#13;
                    #29#61 = #3#21;
                    #29#62 = #3#24;
                    aAlfa = #3#20; |QBF aAlfa;
                    |SI aAlfa = "";
                         #29#67 = #24#196;
                    |SINO;
                         #29#67 = #3#20;
                    |FINSI;

                    |PINTA #29#48;
                    |PINTA #29#55;
                    |PINTA #29#56;
                    |PINTA #29#57;
                    |PINTA #29#58;
                    |PINTA #29#60;
                    |PINTA #29#61;
                    |PINTA #29#62;
                    |PINTA #29#67;

                    eaClienteAnt = #29#5;
                    enDirEntAnt = #29#6;
               |FINSI;
          |FINSI;
     |SINO;
          |CONFI "0000NNo existe direcci¢n para este cliente. ¿Continuar?";
          |SI FSalida ! 0; |ERROR; |FINSI;
     |FINSI;
     |CIERRA #3;
|FPRC;

|PROCESO Cliente297; |TIPO 7;
     |SI enModo = 1;
          eaClienteAnt = "";
     |SINO;
          eaClienteAnt = #29#5;
     |FINSI;
|FPRC;

|PROCESO Cliente290; |TIPO 0;
     nError = 0;
     |DBASS aPath;
     aPath = aPath + "dscarter/";
     aPathDef = aPath + "def/";
     aAlfa = aPathDef + "dscam038";
     |CARGA_DEF aAlfa, dscam038@;
     |SI FSalida = 0;
          |DFICE aAlfa;
          aNumEmp = aAlfa % -205;
          nNumEmp = aNumEmp;
          aPath = aPath + "fich/";
          |PATH_DAT #dscam038@#aPath#;
          |BUCLE dscam038;
          |DESCARGA_DEF #dscam038@;

          aAlfa = aPathDef + "dscam023";
          |CARGA_DEF aAlfa, dscam023@;
          |SI FSalida ! 0; |MENAV "0000Error al cargar 'dscam023'"; |FINSI;
          |SI aPathDat = "";
               ||MENAV "0000Error, no encuentro empresa cartera";
          |SINO;
               |PATH_DAT #dscam023@#aPathDat#;
               |ABRE #dscam023@;
               #dscam023@#0 = #29#5;
               |LEE 000#dscam023@.=;
               |SI FSalida = 0; |Y #dscam023@#9 = "S";
                    aAlfa = "0000Cliente con riesgo bloqueado [" + #dscam023@#10 + "]";
                    |MENAV aAlfa;
                    nError = 1;
               |FINSI;
               |CIERRA #dscam023@;
          |FINSI;
          |DESCARGA_DEF #dscam023@;
     |FINSI;

     |SI nError = 0;
          |ABRE #21;
          #21#0 = #29#5;
          |LEE 000#21=;
          |SI FSalida ! 0;
               |MENAV "0000El cliente no tiene configurado los kms y las horas de desplazamiento...";
               |HAZ CliKmsHora;
          |FINSI;
          |CIERRA #21;
     |FINSI;
     |SI nError = 0;
          |SI #29#5 ! eaClienteAnt;
               |ABRE #24;
               |DDEFECTO #24;
               #24#0 = #29#5;
               |LEE 000#24=;
               |CIERRA #24;

               #29#47 = #24#1;
               #29#59 = #24#15;

               |PINTA #29#47;
               |PINTA #29#59;

               |HAZ MiraCliFactu;
               |SI aEsFactu = "N";
                    #29#74 = "N"; |PINTA #29#74;
                    #29#80 = "N"; |PINTA #29#80;
                    #29#86 = "N"; |PINTA #29#86;
               |SINO;
                    #29#74 = "S"; |PINTA #29#74;
                    #29#80 = "S"; |PINTA #29#80;
                    #29#86 = "S"; |PINTA #29#86;
               |FINSI;

               eaClienteAnt = #29#5;
          |FINSI;
     |FINSI;
     |SI nError ! 0; |ERROR; |FINSI;
|FPRC;

|PROCESO HoraEntrega; |TIPO 0;
     |SI #29#66 ! "01.01.0000";
          eaHora = #29#68;
          |HAZ FormaHora;
          #29#68 = eaHora;
          |SI #29#68 = "00:00"; #29#68 = #6#36; |FINSI;
          |PINTA #29#68;
          |SI #29#68 < #6#36; |O #29#68 > #6#37;
               aAlfa = "0000El horario laboral es desde " + #6#36 + " hasta " + #6#37;
               |MENAV aAlfa;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO GrabaDir29;
     |ABRE #24;
     #24#0 = #29#5;
     |LEE 020#24=;
     |CIERRA #24;

     |DDEFECTO #3;
     |ABRE #3;
     #3#0 = #29#5;
     #3#1 = #29#6;
     |LEE 000#3=;
     |SI FSalida ! 0;
          #3#10 = #24#2;
          #3#2 = #29#48;
          #3#3 = #29#55;
          #3#4 = #29#56;
          #3#5 = #29#57;
          #3#7 = #29#58;
          #3#13 = #29#60;
          #3#21 = #29#61;
          #3#24 = #29#62;
          |GRABA 020#3n;
     |FINSI;
     |CIERRA #13;
|FPRC;

|PROCESO Graba18;
     |DDEFECTO #18;
     #18#0 = #17#0;
     #18#1 = #17#1;
     #18#2 = 1;
     #18#3 = "C";
     #18#4 = Usuario % 810;
     #18#5 = ~;
     |HORA aAlfa;
     #18#6 = aAlfa;
     #18#7 = ~;
     #18#8 = ~;
     #18#9 = Usuario % 810;
     #18#10 = #17#19;
     #18#11 = #17#18;
     #18#39 = #17#5;
     #18#40 = #17#21;
     #18#41 = #17#22;
     #18#42 = #17#45;
     #18#43 = #17#46;
     #18#44 = #29#69;
     #18#45 = #29#70;
     #18#46 = #29#71;
     #18#47 = #29#72;
     #18#48 = #29#73;
     #18#49 = #29#74;
     #18#50 = #29#75;
     #18#51 = #29#76;
     #18#52 = #29#77;
     #18#53 = #29#78;
     #18#54 = #29#79;
     #18#55 = #29#80;
     #18#56 = #29#81;
     #18#57 = #29#82;
     #18#58 = #29#83;
     #18#59 = #29#84;
     #18#60 = #29#85;
     #18#61 = #29#86;
     #18#62 = #17#66;
     |SI #18#63 = "N"; #18#64 = "3"; |FINSI;
     |SI #18#63 = "U"; #18#64 = "2"; |FINSI;
     |SI #18#63 = "E"; #18#64 = "1"; |FINSI;
     |GRABA 020#18n;
     |HAZ ActProdu2;
|FPRC;

|PROCESO PinPaEntre;
     |PINPA #0#29; nPantaEnt = FSalida;
     |PINDA #0#29;
     nRango = 4 + 8 + 16 + 32;
     nPos1 = 2602;
     nPos2 = 3199;
     |LINEAL_SIMPLE #1#19, nRango, nPos1, nPos2, Min19, Max19, Evento19;
     nGridPar = FSalida;
     |CONTROL_SIMPLE nPantaEnt, "BOTON,{{193}}Alta", 2502, 2514, BtnAlta;
     nBtnAlta = FSalida;
     |CONTROL_SIMPLE nPantaEnt, "BOTON,{{197}}Modificar", 2515, 2527, BtnModi;
     nBtnModi = FSalida;
     |CONTROL_SIMPLE nPantaEnt, "BOTON,{{199}}Baja", 2528, 2540, BtnBaja;
     nBtnBaja = FSalida;
     |CONTROL_SIMPLE nPantaEnt, "BOTON,{{204}}Consulta", 2541, 2553, BtnConsu;
     nBtnConsu = FSalida;
     |CONTROL_SIMPLE nPantaEnt, "BOTON,{{135}}Agenda", 2468, 2478, BtnAgendaEntre;
|FPRC;

|PROCESO BtnAgendaEntre;
     enTecnico = #29#19;
     eaProg = "gesiz023";
     |HAZ EjecutaProg;
|FPRC;

|PROCESO GaraFacEnt; |TIPO 0;
     |SI Campo = 73; |SI #29#73 = "S"; #29#74 = "N"; |FINSI; |PINTA #29#74; |FINSI;
     |SI Campo = 74; |SI #29#74 = "S"; #29#73 = "N"; |FINSI; |PINTA #29#73; |FINSI;
     |SI Campo = 79; |SI #29#79 = "S"; #29#80 = "N"; |FINSI; |PINTA #29#80; |FINSI;
     |SI Campo = 80; |SI #29#80 = "S"; #29#79 = "N"; |FINSI; |PINTA #29#79; |FINSI;
     |SI Campo = 85; |SI #29#85 = "S"; #29#86 = "N"; |FINSI; |PINTA #29#86; |FINSI;
     |SI Campo = 86; |SI #29#86 = "S"; #29#85 = "N"; |FINSI; |PINTA #29#85; |FINSI;
     |SI Campo = 74; |O Campo = 80; |O Campo = 86;
          |SI #29Campo = "S"; |Y aConte = "N";
               |DDEFECTO #24;
               |ABRE #24;
               #24#0 = #29#5;
               |LEE 000#24=;
               |CIERRA #24;
               |HAZ MiraCliFactu;
               |SI aEsFactu = "N";
                    |CONFI "0000NEl cliente no es facturable. ¨Continuar?";
                    |SI FSalida ! 0;
                         #29Campo = "N"; |PINTA #29Campo;
                         |ERROR;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO EditaEntrega;
     enError = 1;
     |SI enModo = 1; |VENTANA 0801, 3899, -1, 17, "Nueva Entrega"; |FINSI;
     |SI enModo = 2; |VENTANA 0801, 3899, -1, 17, "Modificar Entrega"; |FINSI;
     nVentana1 = FSalida;
     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentana1;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |DDEF aAlfa;
     aAlfa = aAlfa + "gesim007";
     |CARGA_DEF aAlfa, gesim007@;

     |HAZ CreaTempo; |NOME_DAT #19 Tempo; |DELINDEX #19; aTmp19 = Tempo;

     |ABRET #gesim007@;
     |ABRET #17;
     |ABRET #18;
     |ABRET #19;
     |SI enModo = 1;
          #17#0 = #6#6;
          #17#1 = 999999;
          |LEE 000#17];
          |SI FSalida = 0;
               |LEE 000#17a;
          |SINO;
               |LEE 000#17u;
          |FINSI;
          |SI FSalida = 0; |Y #17#0 = #6#6;
               nConta = #17#1 + 1;
          |SINO;
               nConta = 1;
          |FINSI;
          |DDEFECTO #17;
          #17#0 = #6#6;
          #17#1 = nConta;
          #17#63 = "S";       ||Es entrega
          |GRABA 020#17b;
          |SI FSalida = 0;
               |HORA aAlfa;
               |DDEFECTO #29;
               #29#0 = #6#6;
               #29#1 = nConta;
               #29#2 = ~;
               #29#3 = aAlfa;
               #29#4 = Usuario % 810;
               #29#5 = #0#0;
               #29#22 = #0#1;

               #18#0 = #17#0;
               #18#1 = #17#1;
               #18#2 = 1;

               |HAZ PinPaEntre;
               |ENDATOS #1#29;
               |SI FSalida = 0;
                    |PARA i = 0; |SI i [ 47; |HACIENDO i = i + 1;
                         #17i = #29i;
                    |SIGUE;
                    |HAZ GrabaDir29;
                    |DDEFECTO #24;
                    |ABRE #24;
                    #24#0 = #17#5;
                    |LEE 000#24=;
                    |CIERRA #24;
                    #17#48 = #24#2;
                    #17#49 = #29#52;
                    #17#50 = #29#53;
                    #17#51 = #29#54;
                    #17#52 = #29#48;
                    #17#53 = #29#55;
                    #17#54 = #29#56;
                    #17#55 = #29#57;
                    #17#56 = #29#58;
                    #17#57 = #29#59;
                    #17#58 = #29#60;
                    #17#59 = #29#61;
                    #17#60 = #29#62;
                    #17#61 = #29#63;
                    #17#62 =  #29#64;
                    #17#64 = ~;
                    #17#65 = #29#67;
                    |HORA aAlfa;
                    #17#66 = aAlfa;
                    #17#24 = "F";
                    #17#25 = Usuario % 810;
                    |SI #17#71 = "N"; #17#72 = "3"; |FINSI;
                    |SI #17#71 = "U"; #17#72 = "2"; |FINSI;
                    |SI #17#71 = "E"; #17#72 = "1"; |FINSI;
                    |GRABA 020#17a;
                    |HAZ Graba18;
                    |BUCLE Graba19;
                    |CONFI "0000N¨Imprimir entrega?";
                    |SI FSalida = 0; |HAZ ImpAviso; |FINSI;
                    enTipo = 1;
                    |HAZ CreaAlba;
               |SINO;
                    |BORRA 020#17c;
               |FINSI;
          |FINSI;
     |FINSI;
     |CIERRAT #19;
     |CIERRAT #18;
     |CIERRAT #17;

     |CIERRAT #gesim007@;
     Tempo = aTmp19; |HAZ BoraTempo; |DELINDEX #19;
     aAlfa = "gesim007"; |NOME_DAT #19aAlfa;
     |DESCARGA_DEF #gesim007@;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentana1;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;
     |FINVENTANA nVentana1;
     |PULSATECLA;

     |SI enModo = 1; |Y enError = 0;
          |HAZ EnvioSMS;
     |FINSI;
|FPRC;

|PROCESO CierraEntrega;
     aAlfa = "0000N¿Cerrar entrega:" + #18#0 + "/" + (("000000" + #18#1) % -106) + "/" + #18#2 + "?";
     |CONFI aAlfa;
     enError = FSalida;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |ABRE #17;
     |ABRE #18;
     |LEE 121#17=;
     |LEE 121#18=;

     |ABRE #20;
     #20#0 = #17#17;
     |LEE 000#20=;
     |SI FSalida ! 0; |DDEFECTO #20; |FINSI;
     |CIERRA #20;
     aAlfa = "";
     |PARA i = 22; |SI i [ 31; |HACIENDO i = i + 1;
          aAlfa = #18i; |QBF aAlfa;
          |SI aAlfa ! ""; |SAL; |FINSI;
     |SIGUE;
     |SI aAlfa = "";
          #18#22 = #20#3;
          #18#23 = #20#4;
          #18#24 = #20#5;
          #18#25 = #20#6;
          #18#26 = #20#7;
          #18#27 = #20#8;
          #18#28 = #20#9;
          #18#29 = #20#10;
          #18#30 = #20#11;
          #18#31 = #20#12;
     |FINSI;

     #18#3 = "C";
     #18#8 = ~;
     #18#9 = Usuario % 810;
     |GRABA 020#18a;
     nHay = 0;
     nLineas = 0;
     |BUCLE MiraCerrados;
     |SI nHay = 0;
          enTipo = 1;
          |HAZ CreaAlba;
          |SI enError = 0;
               #17#24 = "F";
               #17#25 = Usuario % 810;

               aAlfa = "";
               |PARA i = 26; |SI i [ 35; |HACIENDO i = i + 1;
                    aAlfa = #17i; |QBF aAlfa;
                    |SI aAlfa ! ""; |SAL; |FINSI;
               |SIGUE;
               |SI aAlfa = ""; |Y nLineas = 1;
                    #17#26 = #20#3;
                    #17#27 = #20#4;
                    #17#28 = #20#5;
                    #17#29 = #20#6;
                    #17#30 = #20#7;
                    #17#31 = #20#8;
                    #17#32 = #20#9;
                    #17#33 = #20#10;
                    #17#34 = #20#11;
                    #17#35 = #20#12;
               |FINSI;

               |GRABA 020#17a;
          |FINSI;
     |FINSI;
     |CIERRA #17;
     |CIERRA #18;
|FPRC;

|PROCESO PasaProseso;
     |HORA aAlfa;
     |ABRET #18;
     |ABRET #19;
     |DDEFECTO #18;
     #18#0 = #17#0;
     #18#1 = #17#1;
     #18#2 = 1;
     #18#3 = "A";
     #18#4 = Usuario % 810;
     #18#5 = ~;
     #18#6 = aAlfa;
     #18#7 = #17#64;
     #18#10 = #17#19;
     #18#11 = #17#18;
     #18#12 = #17#7;
     #18#13 = #17#8;
     #18#14 = #17#9;
     #18#15 = #17#10;
     #18#16 = #17#11;
     #18#17 = #17#12;
     #18#18 = #17#13;
     #18#19 = #17#14;
     #18#20 = #17#15;
     #18#21 = #17#16;
     #18#39 = #17#5;
     #18#40 = #17#21;
     #18#41 = #17#22;
     #18#42 = #17#45;
     #18#43 = #17#46;

     |DDEFECTO #12;
     |ABRE #12;
     #12#0 = #18#11;
     |LEE 020#12=;
     |CIERRA #12;
     |DDEFECTO #21;
     |ABRE #21;
     #21#0 = #18#39;
     |LEE 020#21=;
     |CIERRA #21;
     |DDEFECTO #24;
     |ABRE #24;
     #24#0 = #18#39;
     |LEE 020#24=;
     |CIERRA #24;

     #18#44 = #12#5;
     #18#45 = #21#3;
     eaArti = #18#44; |HAZ LeeArti;
     #18#46 = #119#18;
     #18#47 = #18#45 * #18#46;
     #18#50 = #12#3;
     #18#51 = #12#4;
     eaArti = #18#50; |HAZ LeeArti;
     #18#52 = #119#18;
     #18#53 = #18#51 * #18#52;
     #18#56 = #12#6;
     #18#57 = #21#2;
     eaArti = #18#56; |HAZ LeeArti;
     #18#58 = #119#18;
     #18#59 = #18#57 * #18#58;
     #18#62 = #17#66;
     #18#63 = #17#71;
     |SI #18#63 = "N"; #18#64 = "3"; |FINSI;
     |SI #18#63 = "U"; #18#64 = "2"; |FINSI;
     |SI #18#63 = "E"; #18#64 = "1"; |FINSI;
     |HAZ MiraCliFactu;
     |SI aEsFactu = "N";
          #18#49 = "N";
          #18#55 = "N";
          #18#61 = "N";
     |FINSI;
     |GRABA 020#18n;
     |HAZ ActProdu2;
     |DDEFECTO #12;
     |ABRE #12;
     #12#0 = #17#18;
     |LEE 020#12=;
     |CIERRA #12;
     |DDEFECTO #24;
     |ABRE #24;
     #24#0 = #17#5;
     |LEE 020#24=;
     |CIERRA #24;
     enLin19 = 0;
     |HAZ Defecto19_0;
     |CIERRAT #19;
     |CIERRAT #18;

     #17#24 = "T";
     |GRABA 020#17a;
     |HAZ RecalAviso;

     #refera2@#1 = 0; |REFRESCACONTROL enGrida3;
     #refera1@#1 = 0; |REFRESCACONTROL enGrida2;
     |REFRESCACONTROL enGrida1;
     |HAZ Refresca2;
     |HAZ Refresca4;
|FPRC;

|PROCESO CliKmsHora;
     |VENTANA 0501, 3498, -1, 17, "Cliente Kms/Horas";
     |HAZ PushVenModal;
     |ABRE #24;
     #24#0 = #29#0;
     |LEE 000#24=;
     |CIERRA #24;
     #21#1 = #24#1;
     #21#2 = 0;
     #21#3 = 0;
     |GRABA 020#21b;
     |PINPA #0#21;
     |PINDA #0#21;
     |ENDATOS #1#21;
     |SI FSalida = 0;
          |GRABA 020#21a;
     |SINO;
          |BORRA 020#21c;
          nError = 1;
     |FINSI;
     |HAZ PopVenModal;
|FPRC;

|PROCESO MiraCliFactu;
     aEsFactu = "";
     |PARA i = 38; |SI i [ 45; |HACIENDO i = i + 1;
          |SI #24#4 = #6i; aEsFactu = "N"; |FINSI;
     |SIGUE;
|FPRC;
