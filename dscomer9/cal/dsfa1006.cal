|FICHEROS;
     dsfa0006 #0;
     dsfa0007 #1,MANTE;
     dsfa0008 #2;  ||Historico Partir
     agifa010 #10;
     agifa019 #19;
     agifa069 #69;
     agifa071 #71;
     agifa084 #84;
     agifa142 #142;
     agifa517 #517;
|FIN;

|VARIABLES;
     &eaProgVta= "";
     &enSwMenu = 0;
     &enForma  = 1;
     i         = 0;
     nLin      = 0;
|FIN;

|PROCESO HistoParteAV;
     |ABRE #2;
     #2#0 = #0#4;
     #2#1 = #0#5;
     #2#2 = 99;
     |LEE 000#2];
     |SI FSalida = 0;
          |LEE 000#2a;
     |SINO;
          |LEE 000#2u;
     |FINSI;
     |SI FSalida = 0; |Y #2#0 = #0#4; |Y #2#1 = #0#5;
          nLin = #2#2 + 1;
     |SINO;
          nLin = 1;
     |FINSI;
     #2#0 = #0#4;
     #2#1 = #0#5;
     #2#2 = nLin;
     #2#3 = "A";
     #2#4 = #10#52;
     #2#5 = #10#0;
     |GRABA 020#2n;
     |CIERRA #2;
|FPRC;

|PROCESO CabAlb;
     |PARA i = 1; |SI i [ 14; |HACIENDO i = i + 1;
          #10i = #84i;
     |SIGUE;
     |PARA i = 30; |SI i [ 37; |HACIENDO i = i + 1;
          #10i = #84i;
     |SIGUE;
     #10#51 = "N";  || Facturable = NO
     #10#63 = #84#60;
     #10#68 = #84#65;
     #10#69 = #84#69;
     #10#70 = #84#67;
     #10#73 = #10#68;
     #10#74 = #84#66;
     #10#83 = #84#87;
|FPRC;

|PROCESO LinAlb;
     |DDEFECTO #71;
     #71#29 = #10#52;
     #71#0 = #10#0;
     |PARA i = 1; |SI i [ 17; |HACIENDO i = i + 1;
          #71i = #69i
     |SIGUE;
     #71#33 = #69#21;
     #71#34 = #69#22;
     #71#35 = #69#23;
     #71#36 = #69#26;
     #71#37 = #69#27;
     #71#38 = #69#28;
     #71#39 = #69#29;
     #71#48 = #69#30;
     #71#49 = #69#31;
     #71#50 = #69#32;
     #71#51 = #69#33;
     #71#52 = #69#34;
     #71#53 = #69#35;

     |HAZ CalCabAgifa010;

     enForma  = 1;
     eaProgVta = "agifa010";
     |HAZ AcumulaAV;

     |GRABA 020#71n;
|FPRC;

|DEFBUCLE agifa084;
     #84#1;
     ;
     #0#0, #0#1;
     #0#0, #0#1;
     ;
     NULL, CabAlb, LinAlb;
|FIN;

|PROCESO Albaran;
     |ABRE #10;
     |ABRE #71;

     #10#52 = #0#0;
     enSwMenu = 1; |HAZ ContaAV7;
     |GRABA 020#10b;

     |BUCLE agifa084;

     |GRABA 020#10a;

     |CIERRA #71;
     |CIERRA #10;

     |HAZ HistoParteAV;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO RestauCabFac;
     |DDEFECTO #84;
     #84#48 = #0#0;
     #84#0 = #0#1;

     |PARA i = 1; |SI i [ 14; |HACIENDO i = i + 1;
          #84i = #10i;
     |SIGUE;
     |PARA i = 30; |SI i [ 37; |HACIENDO i = i + 1;
          #84i = #10i;
     |SIGUE;
     #84#60 = #10#63;
     #84#65 = #10#68;
     #84#69 = #10#69;
     #84#67 = #10#70;
     #10#68 = #10#73;
     #84#66 = #10#74;
     #84#87 = #10#83;
     |GRABA 020#84b;
|FPRC;

|PROCESO RestauLinFac;
     |DDEFECTO #69;
     #69#20 = #84#48;
     #69#0 = #84#0;
     |PARA i = 1; |SI i [ 17; |HACIENDO i = i + 1;
          #69i = #71i
     |SIGUE;
     #69#21 = #71#33;
     #69#22 = #71#34;
     #69#23 = #71#35;
     #69#26 = #71#36;
     #69#27 = #71#37;
     #69#28 = #71#38;
     #69#29 = #71#39;
     #69#30 = #71#48;
     #69#31 = #71#49;
     #69#32 = #71#50;
     #69#33 = #71#51;
     #69#34 = #71#52;
     #69#35 = #71#53;
     |GRABA 020#69n;
     enForma  = 1;
     eaProgVta = "agifa084";
     |HAZ AcumulaFC;

     |HAZ CalCabAgifa084;
|FPRC;

|PROCESO BorraLinAlb;
     enForma = -1;
     eaProgVta = "agifa010";
     |HAZ AcumulaAV;
     |BORRA 020#71a;

     |HAZ RestauLinFac;
|FPRC;

|PROCESO BorraAlb0;
     |ABRE #84;
     |ABRE #69;

     |ABRE #10;
     #10#52 = #2#4;
     #10#0 = #2#5;
     |LEE 101#10=;
     |SI FSalida = 0;
          |HAZ RestauCabFac;

          |BUCLELIN 2 BorraLinAlb #10;
          |BORRA 020#10a;

          |GRABA 020#84a;
     |FINSI;
     |CIERRA #10;

     |CIERRA #69;
     |CIERRA #84;
|FPRC;

|DEFBUCLE BorraAlb0;
     #2#1;
     3;
     #0#4, #0#5, 01, "A";
     #0#4, #0#5, 99, "A";
     ;
     NULL, BorraAlb0;
|FIN;

|PROCESO BorraAlba;   ||Tambien Restaura la Factura
     |BUCLE BorraAlb0;
|FPRC;
