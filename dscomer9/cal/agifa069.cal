|FICHEROS;
     agifa069 #0;
     agifa084 #1;
     agifa019 #2;
     agifa039 #5;
     agifa024 #6;
     agifa017 #8;
     agifa065 #9;
     agifa048 #13;
     agifa049 #14;
     agifa142 #20;
     agi00100 #90;       || Lotes.
     agi00101 #91;       || Historico Lotes.
     agifa321 #30;       || DIV - Parametros
     dsl00001 #36;       ||Codigos de barras multiples
     dsm00247 #41;       ||Pantalla Informe Riesgo.
     dsm00248 #43;
     dsm00010 #910;
     agifa029 #29;
     dsm00238 #238;
     dsm00279 #279;
     dsm00134 #134;

     referen@;
     guerola@;
     sanch001@;
     tagm0055@;
     tagm0056@;
|FIN;

|VARIABLES;
     nComiRocai = 0;
     aArtiPromo = "";
     &eaClienteAparecida = "";
     &eaArticuloAparecida = "";
     &efFechaAparecida = @;

     &eaFecAnt = "";
     aGuardaFec = "";
     aPath = "";
     nSwPasa = 0;
     nTota = 0;
     nSwAparecida = 0;
     nTallerBorLin = 0;
     nSwTaller = 0;
     nNume = 0;
     nPreDtoAnt = 0;
     nTagBorLinPost = 0;
     nTagQuitaPost = 0;
     nSwTagloma = 0;
     nSali = 0;
     nTagPre = 0;
     aTagDes = "";
     aTagArt = "";
     nPresu = 0;
     &enModoCab84 = 0;
     nConAu = 0;
     aUs = "";
     &nRieTotal = 0;
     &nRieUtili = 0;
     &aRieBloqu = "";
     &aBloquead = "";
     &eaTag     = "";
     nSal = 0;
     &enDto = 0;
     nSwTecatel = 0;
     &nDispoKit     = 0;
     &enUniTagRes = 0;
     aPtec = "";
     nPtec = 0;
     nLin = 0;
     &eaProg       = "";
     &eaModulo     = "";

     nTecla        = 0;
     &eaIVAsn      = "";
     &eaUniMarhu   = 0;
     &Tempo        = "";
     aTempo294     = "";
     nModo         = 0;
     precom        = 0;
     prepcm        = 0;
     prevul        = 0;
     aMes          = "";
     aAnyo         = "";
     fFecha        = @;
     nPosicion     = 0;

     nCamp1        = 0;
     nCamp2        = 0;
     nCamp3        = 0;
     aAlfa         = "";
     &enDescuento1 = 0;
     &enDescuento2 = 0;
     &eaTComision  = "";
     &enComision   = 0;

     &nDeci_Base     = 0;   || Decimales en Totales de la moneda base
     &nDeci_PreBase  = 0;   || Decimales en el Precio en moneda base
     &nDeci_BaseMx   = 0;   || Decimales en Totales de la moneda base (Maxima precision)
     &nDeci_PreBaseMx= 0;   || Decimales en el Precio en moneda base (Maxima precision)
     &nDeci_Div      = 0;   || Decimales en Totales de la divisa
     &nDeci_PreDiv   = 0;   || Decimales en el Precio en divisa
     &nDeci_TotVis   = 0;   || Decimales en Totales visibles (el de la moneda de trabajo)
     &nDeci_TotNoVis = 0;   || Decimales en Totales no visibles (el de la otra moneda)
     &nDeci_PreVis   = 0;   || Decimales en el Precio visual. (lineas)
     &nDeci_ImpVis   = 0;   || Decimales en el Importe visual. (lineas)
     tecla      = "";
     &ac_divisa = ""; ||
     mensa      = ""; || Linea de visualizacion
     &pintado   = 0;|| Controla el pintado de mensa para que solo lo haga 1 vez
     &nPromo    = 0;
     nForma = 0;
     nPrecio = 0;

     titdiv = "";   || Encabezado de precio e imp. con la divisa "Imp.Tot(USD)"
     aprograma = "";
     pcs    = 0;
     pcv    = 0;
     pcd    = 0;
     &Envase = "";
     &Unidades1 = 0;
     &Unidades2 = 0;
     &VArticulo = "";
     &qAbono    = "";
     mod    = 0;
     nlote  = "";
     tu     = 0;
     ind    = 0;
     {100}M = "";
     {100}C = "";
     hn     = 0;
     hn1    = 0;
     nn     = 0;
     nn1    = 0;
     hi     = 0;
     j      = 0;
     longi  = 0;
     halfa  = "";
     letra  = "";
     pos    = 0;
     resto  = 0;
     inc    = 0;
     numero = 0;
     lotes     = "";
     lineaa    = 0;
     &programa = "";
     &sserie   = "";
     &nnumer   = 0;
     &ffecha   = @;
     &cclien   = "";
     &nnombr   = "";
     &consulta = "";
     &ccoste   = 0;
     &arti     = "";
     &unid     = 0;
     &desc     = "";
     &c_clien  = "";
     &c_artic  = "";
     &c_serie  = "";
     &entrada  = 0;
     &enMensaje = 0;

     valor = "";
     &def_exp            = "N";
     &dto_prom           = "N";
     &ext1               = "";
     vacio               = "                    ";
     operacion           = "FC";
     articulo            = " ";
     fmes                = "  ";
     mescli              = " ";
     mensaje3            = "";
     mensaje             = "0000 Factura para exportacion.Tipo IVA = 0  !!!";

     &n_dec              = 0;
     &n_pre              = 0;
     &def_alm            = 0;

     descu               = 0;
     tf                  = 0;
     pc                  = 0;
     comi1               = 0;
     comi2               = 0;
     comi3               = 0;
     menor               = 0;
     pc1                 = 0;
     pa                  = 0;
     pa1                 = 0;
     pa2                 = 0;
     imneto              = 0;
     imnetoD             = 0;
     margen              = 0;
     wimneto             = 0;
     cantidad            = 0;
     asto                = 0;
     a                   = 0;
     mes                 = 0;
     kl                  = 0;
     totbu               = 0;
     flag                = 1;
     modo                = 0;
     swescan             = 0;
     sw_promocio         = 0;
     campo               = 0;
     nErrorOTP           = 0;
     aBase               = "";
     aMas                = "";
     aFic                = "";

     DescAmpli = "";
     nlinea = 0;
     fiac = " ";
     guarda = " ";
     relleno = "                          ";
     aponer = " ";
     serie = " ";
     albaran = 0;
     albaran_o = 0;
     serie_o = " ";
     i = 0;
     LineaD = 0;
     recoge = "N";
     nerror = 1;
     repr = "";
     clie = "";
     fami = "";
     ccomi = 0;
     codiBarra = "";
     &aRecoge      = "N";
     &aModalidad    = "V";  || Ventas
     &aProceso = "agifa069";
     &aCliPro  = "";
     tmp_serie = "";
     &uni_dt = 0;
     &uni_dt2 = 0;
     &fed_dt = @;   || Fecha....
     &art_dt = "";  || Articulo.
     &cli_dt = "";  || Cliente..
     &fam_dt = "";  || Familia.
     &iva_dt = 0;   || Tipo Iva.
     &dtos_2 = 0;   || Descuento 2.
     &dto_pt = 0;   || Descuento Ptas.
     &dtos_1 = 0;   || Descuento 1.
     &pvp_ve = 0;   || Precio Venta.
     &gru_dt = "";  || Grupo Cliente.
     &tarifa = 0;   || Tarifa Cliente.
     &aParam = "";
     alfa = "";
     &qArti = "";
     &qUnid = 0;
     &nDeci_IVA = 0;
     &nDeci_IVAImp = 0;
     &nDeci_IVADiv = 0;

     aSer                = "";
     aDef                = "";
     nNum                = 0;
     nLinOrg             = 0;
     nSwSanchez          = 0;
|FIN;

|INCLUYE i_varart;

ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄModulo 004159ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
|PROCESO UltLinFacVta;
     |SALVA_FICHA #agifa069;
     aSer = #agifa069#20;
     nNum = #agifa069#0;
     #agifa069#1 = 999;
     |LEE 000#agifa069.];
     |SI FSalida = 0;
          |LEE 000#agifa069.a;
     |SINO;
          |LEE 000#agifa069.u;
     |FINSI;
     |SI FSalida = 0; |Y #agifa069#20 = aSer; |Y #agifa069#0 = nNum;
          nLin = #agifa069#1 + 1;
     |SINO;
          nLin = 1;
     |FINSI;
     |REPON_FICHA #agifa069;
|FPRC;

|PROCESO Sanchez69; |TIPO 6;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo ! 1; |ACABA; |FINSI;

     |HAZ EsSanchez;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |DDEF aDef;
     aDef = aDef + "sanch001";
     |CARGA_DEF aDef, sanch001@;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |ABRE #sanch001@;
     #sanch001@#0 = #agifa069#2;
     |LEE 000#sanch001@.=;
     |SI FSalida = 0;
          nLinOrg = 0;
          |PARA i = 13; |SI i [ 18; |HACIENDO i = i + 1;
               j = i + 6;
               |SI #sanch001@#i# ! 0;
                    |SI nLinOrg = 0;
                         nLinOrg = #agifa069#1;
                         #agifa069#6 = #sanch001@#i#;
                         #agifa069#26 = #sanch001@#i#;
                         #agifa069#11 = #sanch001@#j#;
                         #agifa069#33 = nLinOrg;
                         |HAZ TotalLin69;
                         |GRABA 020#agifa069.n;
                    |SINO;
                         |HAZ UltLinFacVta;
                         #agifa069#1 = nLin;
                         #agifa069#3 = 0;
                         #agifa069#6 = #sanch001@#i#;
                         #agifa069#26 = #sanch001@#i#;
                         #agifa069#11 = #sanch001@#j#;
                         #agifa069#33 = nLinOrg;
                         |HAZ TotalLin69;
                         |HAZ fcacarti;
                         |GRABA 020#agifa069.n;
                    |FINSI;
               |FINSI;
          |SIGUE;
          |SI nLinOrg ! 0;
               #agifa069#1 = nLinOrg;
               |LEE 121#agifa069.=;
          |FINSI;
          |PTEC 809;
          |PTEC 816;
          |PTEC 814;
          |PTEC 815;
          |PONCONTROL 23, "SI";
     |FINSI;
     |CIERRA #sanch001@;
     |DESCARGA_DEF #sanch001@;
|FPRC;

|PROCESO BajaSanchez;
     |SI nSwSanchez ! 0; |ACABA; |FINSI;
     nSwSanchez = 1;

     |DDEF aDef;
     aDef = aDef + "sanch001";
     |CARGA_DEF aDef, sanch001@;
     |SI FSalida ! 0; |ACABA; |FINSI;
     |ABRE #sanch001@;
     #sanch001@#0 = #agifa069#2;
     |LEE 000#sanch001@.=;
     |SI FSalida = 0;
          aSer = #agifa069#20;
          nNum = #agifa069#0;
          |PARA; |SI FSalida = 0; |Y #agifa069#3 = 0; |Y aSer = #agifa069#20; |Y nNum = #agifa069#0; |HACIENDO;
               |LEE 000#agifa069.a;
          |SIGUE;
          nLinOrg = #agifa069#1;
          |LEE 000#agifa069.s;
          |PARA; |SI FSalida = 0; #agifa069#3 = 0; |Y #agifa069#2 = #sanch001@#0;
                      |Y aSer = #agifa069#20; |Y nNum = #agifa069#0; |HACIENDO;
               |HAZ fcacarti;
               |BORRA 020#agifa069.a;
               |LEE 000#agifa069.s;
          |SIGUE;
          #agifa069#1 = nLinOrg;
          |LEE 121#agifa069.=;
          |PONCONTROL 23, "SI";
          |PTEC 808;
     |FINSI;
     |CIERRA #sanch001@
     |DESCARGA_DEF #sanch001@;
     nSwSanchez = 0;
|FPRC;

|PROCESO MiraSanchez;
     |SI nSwSanchez ! 0; |ACABA; |FINSI;

     |DDEF aDef;
     aDef = aDef + "sanch001";
     |CARGA_DEF aDef, sanch001@;
     |SI FSalida ! 0; |ACABA; |FINSI;
     |ABRE #sanch001@;
     #sanch001@#0 = #agifa069#2;
     |LEE 000#sanch001@.=;
     |SI FSalida = 0;
          nSwSanchez = 1;
     |FINSI;
     |CIERRA #sanch001@
     |DESCARGA_DEF #sanch001@;
|FPRC;
ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ

|PROCESO FiltraOTP;
    nErrorOTP = 0;

    #agifa019#0 = "TECNICAS";
    |LEE 000#agifa019.=;
    |SI FSalida ! 0;
        #agifa019#0 = #agifa069#2;
        |LEE 000#agifa019.=;
        |SI FSalida ! 0;  |DDEFECTO #agifa019;  |FINSI;

        |SI #agifa019#136 = "N";
            nErrorOTP = 1;
            |MENAV "0000El articulo no es de ventas...";
        |FINSI;

        |ACABA;
     |FINSI;

     #agifa019#0 = #agifa069#2;
     |LEE 000#agifa019.=;
     |SI FSalida ! 0;  |DDEFECTO #agifa019;  |FINSI;

     |DBASS aBase;
     aMas = aBase + "dspreven/def/maesm002.mas";
     aFic = aBase + "dspreven/fich/";
     |CARGA_DEF aMas, referen@;
     |SI FSalida ! 0;
         nErrorOTP = 1;
         |MENAV "0000Error t‚cnico, pongase en contacto con su distribuidor";
         |ACABA;
     |FINSI;

     |PATH_DAT #referen@#aFic#;

     |ABRE #referen@;
     #referen@#0 = #agifa019#0;
     |LEE 000#referen@.=;
     |SI FSalida ! 0;
         nErrorOTP = 1;
         |MENAV "0000No existe el articulo en DSPREVEN, articulo bloqueado.";
     |SINO;
         |SI #referen@#9 ! "S";
             nErrorOTP = 1;
             |MENAV "0000El articulo no esta activo en DSPREVEN, articulo bloqueado.";
         |FINSI;
     |FINSI;
     |CIERRA #referen@;
     |DESCARGA_DEF #referen@;

     |SI #agifa019#136 = "N";
         nErrorOTP = 1;
         |MENAV "0000El articulo no es de ventas ...";
     |FINSI;
|FPRC;

|PROCESO Calc069; |TIPO 0;
     nModo = (FEntrada / 100) ! 0;
     |SI #0Campo ! Contenido; |O nModo = 1;
          |ABRE #2;
          #2#0 = #0#2;
          |LEE 000#2=;
          |CIERRA #2;
          #0#11 = #2#30; |PINTA #0#11;
     |FINSI;

     |HAZ EsOTP;
     |SI FSalida = 0;
         |ABRE #2;
         |HAZ FiltraOTP;
         |CIERRA #2;
         |SI nErrorOTP = 1;
             |ERROR;
             |ACABA;
         |FINSI;
     |FINSI;

     |HAZ EsOrts;
     |SI FSalida = 0;
          eaDocu = "agifa069";
          eaSerie = #0#20;
          enCodigo = #0#0;
          enLinea = #0#1;
          |SUB_EJECUTA_NP "dsz99905;ENTRA";
     |FINSI;

     |HAZ EsJamaica;
     |SI FSalida = 0;
          aAlfa = "cafe0026;CHEQFAM" + #0#2 + #1#3;
          |SUB_EJECUTA_NP aAlfa;
          |SI enError ! 0; |ERROR; |ACABA; |FINSI;
     |FINSI;

     |SI DescAmpli = "S";
          aTipoDA = "F"; |HAZ DescriDA;
     |FINSI;
|FPRC;

|CALCULO pivafc;
     valor = FSalida;
     |SI valor = 12;  ||F4
          |ABRE #2;
          #2#0 = #0#2;
          |LEE 020#2=;
          |CIERRA #2;

          |SI Campo = 6; |O Campo = 26;
               |C_V #0#9, 0, aAlfa;
               |SI aAlfa = "S";
                    nCamp1 = 9; nCamp2 = 6;
                    |C_M #0#9, 1, "S"; |ENCAMPO #9#0; |C_M #0#9, 1, "N";
               |FINSI;
               |C_V #0#27,0, aAlfa;
               |SI aAlfa = "S";
                    nCamp1 = 27; nCamp2 = 26;
                    |C_M #0#27, 1, "S"; |ENCAMPO #27#0;|C_M #0#27, 1, "S";
               |FINSI;
               |SI FSalida = 0;
                         || nCamp1 -> importe
                         || nCamp2 -> precio
                         || nCamp3 -> unidades
                    |SI eaIVAsn = "S";
                         #0nCamp1 = #0nCamp1 / (1+(enIva/100))
                    |FINSI;
                    |SI #2#194 = 2;
                         nCamp3 = 30;   || unidades doble stock S/N
                    |SINO;
                         nCamp3 = 5;
                    |FINSI;
                    |SI #0nCamp3 = 0;        || unidades cero
                         #0nCamp3 = #0nCamp1 / #0nCamp2;
                         |HAZ decim;
                    |FINSI;
                    |SI #0nCamp2 = 0;        || precio cero
                         #0nCamp2 = #0nCamp1 / #0nCamp3;
                         |PINTA #0nCamp2;
                    |FINSI;
               |SINO;
                    |AVISO; |ERROR;
               |FINSI;
          |FINSI;
     |FINSI;
     |SI valor = 13;
          |HAZ EsAparecida;
          |SI FSalida = 0;
               enPrecio = #0Campo;
               eaArticulo = #0#2;
               eaCliente = #1#3;
               |SUB_EJECUTA_NP "aparm010";
               #0Campo = enPrecio; |PINTA #0Campo;
               |ERROR;
          |FINSI;
     |FINSI;
     |SI valor = 14; ||F6
          c_clien = #1#3;
          c_artic = #0#2;
          c_serie = #0#20;
          entrada = 1;
          |SUB_EJECUTA_NP "agifa283.run";
          valor = 0;
          |ERROR;
     |FINSI;
     |SI valor = 15;||F7
          eaCli  = "";
          enTiva = #0#11;
          efFiva = #1#1;
          |HAZ IVACli;
          |SI #1#67 = "D";
               #0#26 = #0#26 / (1 + enIva/100);
          |SINO;
               #0#6 = #0#6 / (1 + enIva/100);
          |FINSI;
          |HAZ visual_precio;
     |FINSI;
     |SI valor = 17;     || F9
          |HAZ EsTagloma;
          |SI FSalida = 0;
               eaDocu = "FD";
               eaSerie = #0#20;
               enCodigo = #0#0;
               enLinea = #0#1;
               eaDes = #0#4;
               |SUB_EJECUTA_NP "tagm0058";
               #0#4 = eaDes; |PINTA #0#4;
          |FINSI;
     |FINSI;
     |SI valor = 11; || F3
          |HAZ EsRocai;
          |SI FSalida = 0;
               enPrecio = #0#6;
               enComision = #0#10;
               eaCliente = #1#3;
               eaArticulo = #0#2;
               |SUB_EJECUTA_NP "rocaiz01";
               #0#10 = enComision; |PINTA #0#10;
               #0#6 = enPrecio; |PINTA #0#6;
          |FINSI;
     |FINSI;

     |C_M #0Campo, 0, aAlfa;
     |SI #20#250 = "X"; |Y aAlfa = "S";
          eaDocu = "FC";
          eaSerie = #0#20;
          enCodigo = #0#0;
          enLinea = #0#1;
          eaArticulo = #0#2;
          eaCli = #1#3;
          enModo = (FEntrada / 100) ! 0;
          enDto = #0#8;
          enPrecio = #0#6;
          enUnid1 = #0#5;
          enUnid2 = #0#48;
          enUnid3 = #0#23;
          Envase = #0#22;
          enImpDtoPromo = #0#46;
          enDtoPrePromo = #0#47;
          eaDivisa = #1#65;
          |SUB_EJECUTA_NP "dsz00080";
          |SI enError ! 0; |ERROR; |ACABA; |FINSI;
          #0#8 = enDto;
          #0#6 = enPrecio;
          #0#5 = enUnid1;
          #0#48 = enUnid2;
          #0#23 = enUnid3;
          #0#22 = Envase;
          #0#46 = enImpDtoPromo;
          #0#47 = enDtoPrePromo;
     |FINSI;
|FCAL;

|PROCESO verpre2;
     |ABRE #9;
     |SELECT #3#9;
     #9#10 = #1#3;  || Cliente.
     #9#0  = #0#2;  || Articulo.
     #9#1  = "31.12.2300";  || Fecha.
     #9#2  = "FC";  || Operacion.
     prevul = 0;
     |LEE 000#9];
     |SI FSalida = 0;
          |LEE 000#9a;
     |SINO;
          |LEE 000#9u;
     |FINSI;
     |SI FSalida = 0; |Y #9#10 = #1#3; |Y #9#0 = #0#2; |Y #9#2 = "FC";
          prevul = #9#9 / #1#69 * #1#66;  || Calculo el importe en divisas
          |SI #1#67 = "D";                     || Si la moneda de trabajo es la divisa ...
               prevul = prevul ! nDeci_PreDiv;
          |SINO;                               || Si la moneda de trabajo es la moneda base ...
               prevul = prevul ! nDeci_PreBase;
          |FINSI;
     |FINSI;
     |CIERRA #9;
|FPRC;

|PROCESO liinfo1;|TIPO 0;
     |HAZ EsTecatel;
     nSwTecatel = FSalida;

     |SI #agifa142#230 = "S"; |O #agifa142#230 = "X"
          eaArticulo = #0#2;
          |HAZ EsKit;
          |SI FSalida = 0;
               |HAZ DispoKit;
               |SI nDispoKit ! 0;
                    |SI nSwTecatel = 0; |AVISO; |AVISO; |FINSI;
                    |MENAV "0000Superado Stock para KIT.";
                    |SI #agifa142#230 = "X"; |ERROR;   |FINSI;
               |FINSI;
          |SINO;
               |ABRE #8;
               #8#0 = #0#2;
               #8#1 = #0#3;
               |LEE 000#8=;
               |CIERRA #8;
               |HAZ EsTagloma;
               |SI FSalida = 0;
                    |HAZ TagloAvisaSto69;
               |SINO;
                    |SI #8#39 < #0#5;
                         |SI nSwTecatel = 0; |AVISO; |AVISO; |FINSI;
                         aAlfa = "0000Supera el Stock disponible: " + #8#39;
                         |MENAV aAlfa;
                         |SI #agifa142#230 = "X"; |ERROR;   |FINSI;
                    |FINSI;
               |FINSI;
          |FINSI;
          nStock = #8#5 - #0#5;
          |SI #8#6 > nStock; |Y #agifa142#219 = "S";
               |MENAV "0000Supera el Stock minimo...";
          |FINSI;
     |FINSI;

     |SI #8#39 < #0#5; |Y #agifa142#218 = "S"; |Y Campo = 5;
          eaAuto = "S";
          |HAZ Equivalentes;
     |FINSI;
     mensaje3 = "0410<F6> Equivalentes. Stock Disponible Almacen : " + #8#39+"     Stock Minimo : "+#8#6;
     |MENSA mensaje3;
|FPRC;

|PROCESO liinfo;|TIPO 0;
     |SI #8#39 < 0; |Y #20#101 = "S";
          |AVISO;
     |FINSI;

     |SI #20#101 ! "S";
         mensaje3 = "0410<F6> Equivalentes. Stock Disponible Almacen : " + #8#39+"     Stock Minimo : "+#8#6;
         |MENSA mensaje3;
     |SINO;
        |HAZ verpre2;
        precom = #2#133 / #1#69 * #1#66;  || Calculo el importe en divisas
        prepcm = #2#9 / #1#69 * #1#66;    || Calculo el importe en divisas
        |SI #1#67 = "D";                     || Si la moneda de trabajo es la divisa ...
              precom = precom ! nDeci_PreDiv;
              prepcm = prepcm ! nDeci_PreDiv;
        |SINO;                               || Si la moneda de trabajo es la moneda base ...
              precom = precom ! nDeci_PreBase;
              prepcm = prepcm ! nDeci_PreBase;
        |FINSI;
        mensaje3 = "0401Disponible.: [" + #8#39 + "] Min.: [" + #8#6 + "] PC.: [" + precom + "] PMC.: [" +prepcm+"] PVU.: [" + prevul+"]";
        mensaje3 = mensaje3 % 180;
        |MENSA mensaje3;
     |FINSI;
|FPRC;

|CALCULO mirespor;|TIPO 0;
     |SI #6#28 = AS ;|Y #0#11 ! 0;
          |MENAV mensaje;#0#11 = 0;|PINTA #0#11;
     |SINO;
          |SI def_exp = "S"; |Y #0#11 ! 0;
               |MENSA mensaje;#0#11 = 0;|PINTA #0#11;
          |FINSI;
     |FINSI;

     eaCliente = #1#3;
     efFecha = #1#1;
     Contenido = articulo;
     |HAZ SacaKit;
     |SI eaModiKit = "S";     || Se ha mdoificado el kit
          |HAZ EsTagloma;     || Precio Kit (dsz99986)
          |SI FSalida = 0;
               #0#6 = enPreKitCal;
               |HAZ precio_divisa;
          |FINSI;
     |FINSI;
|FCAL;

|PROCESO CalcuComi;
     enDescuento1 = #0#8;
     enDescuento2 = #0#21;
     eaTComision  = #0#16;
     eaCliente    = #1#3;
     eaArticulo   = #0#2;
     eaRepre      = #1#6;
     efFecha      = #1#1;
     eaSerie      = #0#20;
     enDirEnt = #1#91;
     enAlmacen = #0#3;
     |HAZ Comisiones;
     ||ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄMarhuenda
     eaUniMarhu = #0#5;
     |HAZ ComiMarhu;
     #0#10 = enComision;
|FPRC;

|PROCESO PrecioArti;
     modo = (FEntrada / 100) ! 0;
     mescli = #1#1 % 402;
     mes = mescli;
     fed_dt = #1#1;   || Fecha....
     art_dt = #0#2;   || Articulo.
     cli_dt = #0#15;  || Cliente..
     fam_dt = #0#13;  || Familia.
     iva_dt = #2#30;  || Tipo Iva.
     dtos_2 = 0;      || Descuento 2.
     dto_pt = 0;      || Descuento Ptas.
     dtos_1 = 0;      || Descuento 1.
     pvp_ve = 0;      || Precio Venta.
     tarifa = #6#39;  || Tarifa Cliente....
     gru_dt = #6#158; || Grupo Cliente.
     uni_dt = #0#5;
     uni_dt2 = #0#30;
     nPromo = #1#79;
     enMensaje = 0;
     enDirEnt = #1#91;  ||Dir entrega
     aParam = "";
     eaSerie = #0#20;
     |SI #2#176 = "S";  enMensaje = 1;  |FINSI;
     enAlmacen = #0#3;
     |SI modo = 1; |O articulo ! #0#2;
          enInterno = tarifa;
          |HAZ calcdtos;    || Calculo Dtos.....
          |SI eaCliArtDiviSN = "S";
               |SI eaCliArtDivi ! #1#65;
                    aAlfa = "0000La divisa del documento ("+ #1#65 + ") no se corresponde con la oferta (" + eaCliArtDivi + ").";
                    |MENAV aAlfa;
                    |PTEC 807;     || Ctrl+C
               |SINO;
                    pvp_ve = pvp_ve * #1#69 / #1#66; ||Cam.Base * Cambio
               |FINSI;
          |FINSI;
          eaCliArtDiviSN = "N";

          #0#43 = enInterno;

          #0#6   = pvp_ve - dto_pt;  || Precio Venta. sin iva.
          #0#8   = dtos_1;  || 1¦ Dto.
          #0#21  = dtos_2;  || 2§ Dto.
          |HAZ precio_divisa;  ||Convierte el precio en divisa
          |PINTA #0#21;
          |PINTA #0#8;


          |HAZ CalcuComi;

          #0#8 = enDescuento1;
          #0#6 = pvp_ve - dto_pt;  || Precio Venta. sin iva.

          |HAZ EsTagloma;     || Precio Kit (dsz99986)
          |SI FSalida = 0;
               eaArticulo = #0#2;
               |HAZ EsKit;
               |SI FSalida = 0;
                    #0#6 = enPreKitCal;
               |FINSI;
          |FINSI;
          |HAZ precio_divisa;      ||Convierte el precio en divisa
          ||ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
          |PINTA #0#8;
          |PINTA #0#10;
     |FINSI;
|FPRC;

|CALCULO defecfc;|TIPO 0;
     #0#15 = #1#3;            ||cargo los 3 dtos
     #0#16 = #1#34;
     #0#17 = #1#35;
     |SI #0#2 ! #2#0;         ||Si el articulo entrado es ! al anterior
          |ABRE #2;
          #2#0 = #0#2;
          |LEE 000#2=;
          |CIERRA #2;
     |FINSI;
     #0#13 = #2#2;            ||Familia
     |SI #0#15 ! #6#0;        ||Si el Cliente es diferente
          |ABRE #6;
          #6#0 = #0#15;
          |LEE 000#6=;
          |CIERRA #6;
     |FINSI;
     |HAZ PrecioArti;
|FCAL;

|CALCULO fccomis;|TIPO 0;
     |SI #0Campo ! Contenido;
         enDescuento1 = #0#8;
         enDescuento2 = #0#21;
         eaTComision  = #0#16;
         eaCliente    = #1#3;
         eaArticulo   = #0#2;
         eaRepre      = #1#6;
         eaSerie      = #0#20;
         enDirEnt = #1#91;
         enAlmacen = #0#1;
         |HAZ Comisiones;
         ||ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄMarhuenda
         eaUniMarhu = #0#5;
         |HAZ ComiMarhu;
         ||ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
         #0#10 = enComision;
         |PINTA #0#10;
     |FINSI;
|FCAL;

|CALCULO totfc;|TIPO 0;
     |HAZ TotalLin69;
     |HAZ visual_importe;
|FCAL;

|CALCULO fcacarti;|TIPO 2;
     nForma = 0 +. 1;
     nn = 0 +. 1;
     modo = (FEntrada / 100) ! 0;

     |HAZ EsTagloma; nSwTagloma = FSalida;
     |HAZ EsTaller; nSwTaller = FSalida;
     |HAZ EsAparecida; nSwAparecida = FSalida;

     |SI nSwTaller = 0;
          |SI #0#45 = -1; |Y enModoCab84 ! 3;
               |SI nForma = -1;
                    |MENAV "0000Linea canon de articulo, no se puede modificar";
               |FINSI;
               |ERROR; |ACABA;
          |FINSI;
     |FINSI;
     |SI nSwAparecida = 0;
          |SI #0#45 = -1; |Y enModoCab84 ! 3;
               |SI nForma = -1;
                    |MENAV "0000Linea auto-descarga, no se puede modificar";
               |FINSI;
               |ERROR; |ACABA;
          |FINSI;
     |FINSI;

     |SI nSwTagloma = 0;
          |HAZ TagEsLinPost;
          |SI FSalida = 0; |Y enModoCab84 ! 3;
               |SI nForma = -1;
                    |MENAV "0000Linea de incremento de postformado, no se puede modificar...";
               |FINSI;
               |ERROR; |ACABA;
          |FINSI;
     |FINSI;

     |SI #0#45 = -1; |Y enModoCab84 ! 3;
          |SI nForma = -1;
               |MENAV "0000Linea de Promocion, no se puede modificar...";
          |FINSI;
          |ERROR; |ACABA;
     |FINSI;

     |SI modo = 1;
          |HAZ Riesgos69;
          |SI enErrRie = 1; |ERROR; |ACABA; |FINSI;
     |FINSI;

     |SI modo = 2;|O modo = 3;
          efFec = #1#1;
          enAlma = #0#3;
          |HAZ MiraHisL;
          |SI enErrHis ! 0;
               |ERROR;
               |ACABA;
          |FINSI;
     |FINSI;

     |HAZ EsSanchez;
     |SI FSalida = 0;
          |SI modo = 3;
               |HAZ BajaSanchez;
          |FINSI;

          |SI modo = 2;
               |HAZ MiraSanchez;
               |SI nSwSanchez ! 0;
                    nSwSanchez = 0;
                    |SI nForma = - 1;
                         |MENAV "0000Modificacion no permitida, de debaja la linea...";
                    |FINSI;
                    |ERROR; |ACABA;
               |FINSI;
          |FINSI;
     |FINSI;

     |SI nSwTagloma = 0; |Y #0#13 = "FMB";
          |SI enModoCab84 = 3;
               eaArticulo = #0#2;
               enAlmacen = #0#3;
               enUnidad1 = #0#5;
               enUnidad2 = #0#30;
               eaSerie = #0#20;
               enCodigo = #0#0;
               eaTipo = "F";
               |HAZ TagloModBlock;
          |SINO;
               |SI nForma = -1;
                    |MENAV "0000La linea pertenece a un block...";
               |FINSI;
               |ERROR; |ACABA;
          |FINSI;
     |FINSI;




     #0#15 = #1#3;
     #0#16 = #1#34;
     #0#17 = #1#35;

     imneto  = ((((#0#9  < #1#5) < #1#32) < #1#7));
     imnetoD = ((((#0#27 < #1#5) < #1#32) < #1#7));

     ||-------------------Actualiza Historico, Articulo y Almacen
     enForma = 0 +. 1;
     |HAZ AcumulaFC;
     ||---------------------
     |SI nSwTagloma = 0; |Y #0#43 = 9; || ­­­ Campo INTERNO marcado con 9
          eaCliente = #1#3;
          eaArticulo = #0#2;
          enUniTagRes = -(#0#5 * enForma);
          |HAZ TagVentaVario;
     |FINSI;
     ||---------------------
     enTipEnvase = 2;
     |HAZ Envase69;

     #0#14 = enCoste;
     #1#37 = #1#37 + (imneto - enCoste);

     |HAZ CalCabAgifa084;
     |HAZ cabecont;

     || ACTUALIZA FICHERO DE LOTES...........................................
     sserie = #0#20;
     nnumer = #0#0;
     ffecha = #1#1;
     arti   = #0#2;
     cclien = #1#3;
     unid   = #0#5;
     desc   = #0#4;
     lineaa = #0#1;
     |HAZ act_lotes;

     |SI modo = 1; |O modo = 2;
          |SI nn  = 1;             || Act. Precio Cli. Art.
               cli_dt = #0#15;
               art_dt = #0#2;
               pvp_ve = #0#6;
               dtos_1 = #0#8;
               aParam = "grapre";
               enDirEnt = #1#91;
               enAlmacen = #0#3;
               enInterno = #0#43;
               eaSerie = #0#20;
               enCodigo = #0#0;
               enLinea = #0#1;
               eaModuloPre = "agifa069";
               |HAZ calcdtos;
               #0#43 = enInterno;
          |FINSI;
     |FINSI;

     |SI modo = 3;
          |SI nSwTagloma = 0;
               |HAZ BorTagloMerma69;
          |FINSI;

          |HAZ EsOrts;
          |SI FSalida = 0;
               eaDocu = "agifa069";
               eaSerie = #0#20;
               enCodigo = #0#0;
               enLinea = #0#1;
               |SUB_EJECUTA_NP "dsz99905;BORRA";
          |FINSI;
          ||ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
          |HAZ EsAlbadis;
          |SI FSalida = 0;
               eaDocu = "FD";
               eaSerie = #0#20;
               enCodigo = #0#0;
               enLinea = #0#1;
               |HAZ BseBorraUni;
          |FINSI;
          ||ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
          aTipoDA = "F"; |HAZ BajaDA;
          ||ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
          |HAZ BorraKit;
          ||ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
          |HAZ EsViarsa;
          |SI FSalida = 0;
               |HAZ ViaBajaFac;
          |FINSI;
          |HAZ EsGesisat;
          |SI FSalida = 0;
               |HAZ GesiBorMaqui;
          |FINSI;
          ||ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
          eaTipo      = "FC";
          eaSerie     = #0#20;
          enCodigo    = #0#0;
          enLinea     = #0#1;
          efFecha     = #1#1;
          enTarifa    = #6#39;
          eaArticulo  = #0#2;
          enAlmacen   = #0#3;

          |SUB_EJECUTA_NP "dsz00002;BAJA";
     |FINSI;

     |SI #20#250 ! "N";
          |SI nForma = 1;
               ||SI #0#48 > 0;
               |SI #0#48 ! 0;
                    aponer = Asino; |HAZ poncontr;
                    |HAZ CreaLinPromo69;
                    aponer = Anosi; |HAZ poncontr;
                    #0#45 = nLin;
                    |PTEC 809; |PTEC 816; |PTEC 806;
               |SINO;
                    |HAZ BorraLinPromo69;
               |FINSI;
          |SINO;
               |SI modo = 3; |Y enModoCab84 ! 3;
                    |HAZ BorraLinPromo69;
                    |PTEC 809; |PTEC 808;
               |FINSI;
          |FINSI;
     |FINSI;

     |HAZ EsInforAlba;
     |SI FSalida = 0; |HAZ InforActMatri; |FINSI;

     |HAZ EsGesisat;
     |SI FSalida = 0; |HAZ GesiActMaqui; |FINSI;

     |SI nSwTagloma = 0; |HAZ TagLinPost; |FINSI;
     |SI nSwTaller = 0; |HAZ TallerCanon69; |FINSI;
     |SI nSwAparecida = 0; |HAZ Aparecida69; |FINSI;
|FCAL;

|PROCESO CreaLinPromo69;
     |DDEF aAlfa; aAlfa = aAlfa + "agifa069";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |ABRE #referen@;
     #referen@#20 = #0#20;
     #referen@#0 = #0#0;
     #referen@#1 = #0#45;
     |LEE 000#referen@.=;
     |SI FSalida = 0;
          nLin = #0#45;
          |SALVA_DATOS #0;
          |SALVA_DATOS #referen@;
          |REPON_DATOS #0;
          #0#1 = #referen@#1;
          enForma = -1;
          |HAZ AcumulaPV;
          |REPON_DATOS #0;
     |SINO;
          #referen@#1 = 999;
          |LEE 000#referen@.];
          |SI FSalida = 0;
               |LEE 000#referen@.a;
          |SINO;
               |LEE 000#referen@.u;
          |FINSI;
          |SI FSalida = 0; |Y #referen@#20 = #0#20;  |Y #referen@#0 = #0#0;
               nLin = #referen@#1 + 1;
          |SINO;
               nLin = 1;
          |FINSI;
          |SI nLin = #0#1; nLin = nLin + 1; |FINSI;
          #referen@#20 = #0#20;
          #referen@#0 = #0#0;
          #referen@#1 = nLin;
          |GRABA 020#referen@.b;
     |FINSI;
     ||SI #0#48 > 0;
     |SI #0#48 ! 0;
          |SALVA_DATOS #0;
          |REPON_DATOS #referen@;

          #referen@#1 = nLin;
          #referen@#5 = #0#48;
          #referen@#6 = 0;
          #referen@#7 = 0;
          #referen@#8 = 0;
          #referen@#9 = 0;
          #referen@#26 = 0;
          #referen@#27 = 0;
          #referen@#28 = 0;
          #referen@#29 = 0;
          #referen@#45 = -1;

          |SALVA_DATOS #0;
          |SALVA_DATOS #referen@;
          |REPON_DATOS #0;
          #0#1 = #referen@#1;
          enForma = 1;
          |HAZ AcumulaFC;
          |REPON_DATOS #0;

          |GRABA 020#referen@.a;
     |SINO;
          |BORRA 020#referen@.c;
     |FINSI;
     |CIERRA #referen@;
     |DESCARGA_DEF #referen@;
|FPRC;

|PROCESO BorraLinPromo69;
     |DDEF aAlfa; aAlfa = aAlfa + "agifa069";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |ABRE #referen@;
     #referen@#20 = #0#20;
     #referen@#0 = #0#0;
     #referen@#1 = #0#45;
     |LEE 101#referen@.=;
     |SI FSalida = 0;
          |SALVA_DATOS #0;
          |SALVA_DATOS #referen@;
          |REPON_DATOS #0;
          #0#1 = #referen@#1;
          enForma = -1;
          |HAZ AcumulaFC;
          |REPON_DATOS #0;
          |BORRA 020#referen@.a;
          |PONCONTROL 23, "SI";
     |FINSI;
     |CIERRA #referen@;
     |DESCARGA_DEF #referen@;
|FPRC;

|CALCULO cabecont;|TIPO 13;
     |HAZ visual_totales;

|FCAL;

|PROCESO IVA069_0; |TIPO 0;
     enTiva = #0Campo;
     efFiva = #1#1;
     |HAZ SacaIVA;
     |SI eaDiva = "";
          |MENAV "0000No existe tipo iva para esta fecha...";
          |ERROR; |ACABA;
     |FINSI;

     |HAZ EsInforAlba;
     |SI FSalida = 0;
          |ABRE #2;
          #2#0= #0#2;
          |LEE 000#2=;
          |SI FSalida = 0; |Y #2#174 = "S ";
               eaMatri = #0#31;
               eaArticulo = #0#2;
               |SUB_EJECUTA_NP "ialbz001;FD";
               #0#31 = eaMatri;
          |SINO;
               #0#31 = "";
          |FINSI;
          |ATRI I; |PINTA 1335, #0#31; |ATRI 0;
          |CIERRA #2;
     |FINSI;
     |HAZ EsGesisat;
     |SI FSalida = 0;
          |ABRE #2;
          #2#0= #0#2;
          |LEE 000#2=;
          |SI FSalida = 0; |Y #2#174 = "S ";
               eaArticulo = #0#2;
               eaCliente = #1#3;
               efFecha = #1#1;
               aAlfa = "gesiz019;FD" + #0#20 + (("000000"+#0#0)%-106) + #0#1;
               |SUB_EJECUTA_NP aAlfa;
               |SI eaMatri = ""; |ERROR; |FINSI;
          |SINO;
               |HAZ GesiBorMaqui;
          |FINSI;
          |CIERRA #2;
          aAlfa = #0#31; #0#31 = eaMatri;
          |ATRI I; |PINTA 1335, #0#31; |ATRI 0;
          #0#31 = aAlfa;
     |FINSI;
|FPRC;

|PROCESO art6fcv; |TIPO 6;          || Antes de la Relacion 4§ Clave.
     |SI codiBarra = "N"; |ACABA; |FINSI;

     |ABRE #36;
     |SELECT #2#36;
     #36#3 = #0#2;
     |LEE 010#36=;
     |SI FSalida=0; |Y #0#2 ! #36#1;
          #0#2 = #36#1;
          |PINTA #0#2;
          |ABRE #2;
          #2#0 = #0#2;
          |LEE 000#2=;
          |CIERRA #2;
     |FINSI;
     |CIERRA #36;
|FPRC;


|PROCESO nomodif1; |TIPO 0;
     modo = (FEntrada / 100) ! 0;
     |SI modo = 1; #0#3 = def_alm; |PINTA #0#3; |FINSI;
     |SI #0#2 = vacio;
           |C_M #0#3,  1, "N";
           |C_M #0#5,  1, "N";
           |SI #1#67 = "B";
             |C_M #0#6,  1, "N";
           |SINO;
             |C_M #0#26,  1, "N";
           |FINSI;
           |C_M #0#8,  1, "N";
         ||  |C_M #0#9,  1, "N";
           |C_M #0#21, 1, "N";
           |C_M #0#10, 1, "N";
           |C_M #0#11, 1, "N";
           |C_M #0#18, 1, "N";
     |SINO;
           |C_M #0#3,  1, "S";
           |C_M #0#5,  1, "S";
           |SI #1#67 = "B";
             |C_M #0#6,  1, "S";
           |SINO;
             |C_M #0#26,  1, "S";
           |FINSI;
           |C_M #0#8,  1, "S";
       ||    |C_M #0#9,  1, "S";
           |C_M #0#21, 1, "S";
           |C_M #0#10, 1, "S";
           |C_M #0#11, 1, "S";
           |C_M #0#18, 1, "S";
     |FINSI;
|FPRC;

|PROCESO decim; |TIPO 6;
     nTecla = FSalida;
     nModo = (FEntrada / 100) ! 0;
     |HAZ Promart;
     |SI nTecla = 12;
          |HAZ EsAparecida;
          |SI FSalida = 0;
               ||ARA38
               eaArticuloAparecida = #agifa069#2;
               eaClienteAparecida = #agifa084#3;
               efFechaAparecida = #agifa084#1;
               |HAZ CtrlStockDevolAparecida;
               |ERROR;
               |ACABA;
          |FINSI;
     |FINSI;
     |SI nTecla = 13;
          enTipEnvase = 1;
          |HAZ Envase69;
     |FINSI;
     |SI nTecla = 14;             ||F6
          eaAuto = "N";
          |HAZ Equivalentes;
          |ERROR;
          |ACABA;
     |FINSI;

     |HAZ EsCongecar;
     |SI FSalida = 0; |Y nModo = 2;
          enInterno = #0#43;
          |HAZ ModiTariCongecar;
          |SI #0#43 ! enInterno;
               #0#43 = enInterno;
               #0#6 = pvp_ve;
               |HAZ precio_divisa;
          |FINSI;
     |FINSI;

     #0#5 = #0#5 ! n_dec;
     |PINTA #0#5;
     |SI #20#5 ! "N";
          |HAZ DispoKit;
     |FINSI;
     |SI #0#5 [ 0; |ACABA; |FINSI;
     qArti = #0#2;
     qUnid = #0#5;
     |HAZ ComproMin;
     |SI enErr ! 0;
          |ERROR;
     |FINSI;
|FPRC;

|PROCESO LeeParam071;
     |ABRE #20; |LEE 000#20p; |CIERRA #20;
     |ABRE #279; |LEE 000#279p; |CIERRA #279;
     nPreDtoAnt = 0;

     lotes = #20#51;
     codiBarra = #20#56;
     DescAmpli = #20#200;     || Descargar descripcion ampliada
     |SI DescAmpli = "N";
          DescAmpli = #20#40;
     |FINSI;
|FPRC;

|PROCESO Tipo7_069;|TIPO 7;
     nModo = (FEntrada / 100) ! 0;
     articulo = #0#2;
     |HAZ PintaMedidaV;
     |HAZ LinDiv;
     modo = (FEntrada / 100) ! 0;
     |HAZ LeeParam071;
     |SI nModo = 1;
          #0#1 = #0#1 + #agifa142#236 - 1;
     |FINSI;
     |HAZ PintaDes69;
     |HAZ EsInforAlba;
     |SI FSalida = 0;
          |ATRI R; |PINTA 1235, "Matricula"; |ATRI I;
          |PINTA 1335, #0#31;
     |FINSI;
     |HAZ EsGesisat;
     |SI FSalida = 0;
          |ATRI R; |PINTA 1235, "Maquina  "; |ATRI I;
          |HAZ GesiLeeMaqui;
          aAlfa = #0#31; #0#31 = eaMatri;
          |PINTA 1335, #0#31;
          #0#31 = aAlfa;
     |FINSI;
|FPRC;

|PROCESO Tipo3_069;|TIPO 3;
     aAlfa = #0#2; |QBF aAlfa;
     |SI aAlfa ! ""; |Y DescAmpli = "S";
          aTipoDA = "F"; |HAZ AltaDA;
     |FINSI;
|FPRC;

|| *********************** *(1)
|PROCESO leeotro; |TIPO 11;
     valor = FSalida;
     modo  = (FEntrada/100) ! 0;
     |SI valor = 10;     ||F2
          |HAZ MenuTrack69;
          |SI FSalida = 0; |ERROR; |ACABA; |FINSI;
          valor = FSalida;
     |FINSI;
     |SI valor = 9;
         |PUSHV 501 2380;
         |PINPA #0#1;
         |PINDA #0#1;
         |PAUSA;
         |POPV;
          valor = 0;
         |ERROR;
     |FINSI;
     |SI valor = 13;          || F5
          |HAZ EsAlbadis;
          |SI FSalida = 0;
               eaDocu = "FD";
               eaSerie = #0#20;
               enCodigo = #0#0;
               enLinea = #0#1;
               enPrecio = #0#6;
               enPVerde = #0#44;
               |HAZ BseVerUni;
               |ERROR; |ACABA;
          |FINSI;

          |HAZ EsOrts;
          |SI FSalida = 0;
               eaDocu = "agifa069";
               eaSerie = #0#20;
               enCodigo = #0#0;
               enLinea = #0#1;
               |SUB_EJECUTA_NP "dsz99905;VER";
          |FINSI;

          |HAZ VerKit;
          |HAZ VerDobleUniV;
          |ERROR; |ACABA;
     |FINSI;

     |SI valor = 18;
         alfa = "dsw00007;" + #1#3;    || Extracto Articulo
         |SUB_EJECUTA_NP alfa;
         |ERROR;
     |FINSI;

     aAlfa = #0#2; |QBF aAlfa;
     |SI valor = 16; |Y aAlfa ! ""; |Y DescAmpli = "S";
          aTipoDA = "F"; |HAZ VerDA;
          |ERROR;
     |FINSI;

     |SI valor = 14; |Y modo ! 1;
         c_clien = #1#3;
         c_artic = #0#2;
         c_serie = #0#20;
         entrada = 1;
         |SUB_EJECUTA_NP "agifa283.run";
         valor = 0;
         |ERROR;
     |FINSI;

     |SI valor = 11;   ||F5
         |HAZ contab;
         valor = 0;
         |ERROR;
     |FINSI;

     |SI valor = 25; || Ctrl-F7
          |HAZ CreaTempo;
          eaFichero = Tempo;
          |SUB_EJECUTA_NP "psion066";
          |HAZ BoraTempo;
          |SI enError = 0; |HAZ ImportaPDA69; |FINSI;
          |ERROR; |ACABA;
     |FINSI;

     |SI valor = 99; || Modulo OTP
         |HAZ RecogeCSV;

         |PONCONTROL 23, "SI"
         |PTEC 809;
         |PTEC 808;
     |FINSI;
|FPRC;

|PROCESO contab;
          modo = (FEntrada / 100) ! 0;
          |SI modo = 4;
               |ABRE #6;
               #6#0 = #0#15;
               |LEE 001#6=;
               |SI FSalida ! 0; |DDEFECTO #6; |FINSI;
               |CIERRA #6;
          |FINSI;
          |PUSHV 0501 2380;
          ext1 = #6#16;
          |SUB_EJECUTA_NP "caextrap.run";
          |POPV;
|FPRC;


||---------------------------------------------------------------------------
|| LOTES. Alejandro 04/02/2000. Se ha a¤adido lotes por meses
||---------------------------------------------------------------------------

|PROCESO act_lotes; |TIPO 2;
  |ABRET #90;
  |ABRET #91;
  #90#0 = #0#2;
  |LEE 141#90=;
  |SI FSalida = 0;
     |SI lotes = "S"; |Y #90#9 = "U";
         nn = unid + #90#5;
         |SI nn = #90#4;
              |HAZ hist_lotes;
              |HAZ suma_lotes;
         |SINO;
              |SI nn > #90#4;
                   nn = nn / #90#4;         || NUMERO DE LOTES.
                   tu = unid;               || GUARDA TOTAL UNIDADES.
                   unid = #90#4 - #90#5;    || PRIMERAS UNIDADES.
                   nn1 = 0;
                   |PARA ind = 1; |SI ind < nn; |HACIENDO ind = ind + 1;
                         nn1 = nn1 + unid;
                         |HAZ hist_lotes;
                         |HAZ suma_lotes;
                         unid = #90#4;
                   |SIGUE;
                   |SI nn1 < tu;
                         unid = tu - nn1;
                         |HAZ hist_lotes;
                         |HAZ suma_lotes;
                   |FINSI;
                   |SI unid = #90#4; unid = 0; |FINSI;
              |SINO;
                   |HAZ hist_lotes;
              |FINSI;
         |FINSI;
         #90#2 = nlote;
         #90#5 = unid;
         |GRABA 021#90a;
     |FINSI;
     |SI lotes = "S"; |Y #1#43 = "N"; |Y #90#9 = "M";
       aMes = "";
       aAnyo = "";
       fFecha = ~;

       |SI #90#10 = "S";  || en el lote hay mes
         fFecha = #1#1 % 0;    || entrega el mes de la fecha del albaran
         aMes = fFecha % 11; || ahora tomo solo el nombre del mes
         nPosicion = 100 + #90#11;
         aMes = aMes % nPosicion;
       |FINSI;

       |SI #90#13 = "S";
         aAnyo = #1#1 % -104;  || tomo el a¤o de la fecha del albaran
         nPosicion = -(100 + #90#14);
         aAnyo = aAnyo % nPosicion;
       |FINSI;

       |SI #90#12 = 1; |Y #90#15 = 2;
          |SI #90#17 = "S";
               nlote = aMes + #90#16 + aAnyo;
          |SINO;
               nlote = aMes + aAnyo;
          |FINSI;
       |FINSI;

       |SI #90#12 = 2; |Y #90#15 = 1;
          |SI #90#17 = "S";
               nlote = aAnyo + #90#16 + aMes;
          |SINO;
               nlote = aAnyo + aMes;
          |FINSI;
       |FINSI;

       #90#2 = nlote;
       |GRABA 020#90a;
       |HAZ hist_lotes;
     |FINSI;

  |SINO;
     |SI lotes = "S";
          |ATRI P;
          |MENAV "0000EL ARTICULO INTRODUCIDO NO ESTA DADO DE ALTA EN EL FICHERO DE LOTES";
          |ATRI p;
     |FINSI;
  |FINSI;
  |CIERRAT #90;
  |CIERRAT #91;
|FPRC;

||---------------------------------------------------------------------------
|| ACTUALIZA EL HISTORICO DE LOTES.
||---------------------------------------------------------------------------
|PROCESO borraa;
     |BORRA 021#91a;
|FPRC;

|DEFBUCLE borra_lotes;
     #91#1;
     ;
     sserie, nnumer, lineaa, "        ";
     sserie, nnumer, lineaa, "zzzzzzzz";
     ;
     NULL,borraa;
|FIN;

|PROCESO hist_lotes; |TIPO 2;
     #91#0 = sserie;
     #91#1 = nnumer;
     #91#8 = lineaa;
     #91#5 = #90#2;      || NUMERO LOTE.
     |LEE 141#91=;
     #91#2 = ffecha;
     #91#3 = arti;
     #91#7 = cclien;
     mod = 0 +. 1;
     |SI FSalida ! 0; |Y mod = 1;
          #91#4 = desc;
          #91#6 = unid;
          |GRABA 021#91n;
     |SINO;
          |SI mod = 1;
               #91#4 = desc;
               #91#6 = unid;
               |GRABA 021#91a;
          |SINO;
               |BUCLE borra_lotes;
          |FINSI;
     |FINSI;
|FPRC;
||---------------------------------------------------------------------------
|| CALCULA EL NUMERO DE LOTE.
||---------------------------------------------------------------------------
|PROCESO Suma;
     IC = C1<-;
     inc = #90#3;                  || INCREMENTO.
     halfa = #90#2; |QBF halfa;    || NUMERO LOTE.
     halfa = halfa % A0;
     longi = halfa;
     halfa = #90#2; |QBF halfa;    || NUMERO LOTE.
     longi = (longi * 100) + 1;
     |PARA hi = longi; |SI hi ] 101; |HACIENDO hi = hi - 100;
          letra = halfa % hi;
          |HAZ HallaPos;
          numero = inc $ hn;
          pos = pos + numero + resto;
          inc = (inc - numero) / hn;
          |SI pos > hn;
               resto = 1;
               pos = pos - hn;
          |SINO;
               resto = 0;
          |FINSI;
          |HAZ Cadena;
          |SI inc = 0;|Y resto = 0;
               hi = hi - 100;
               |SAL;
          |FINSI;
     |SIGUE;
     |PARA; |SI hi ] 101; |HACIENDO hi = hi - 100;
          letra = halfa % hi;
          C = letra;
          IC = IC + 1;
          hn1 = hn1 + 1;
     |SIGUE;
     |SI resto = 1;
          C = M1;
          hn1 = hn1 + 1;
     |FINSI;
     IC = C1<-;
     halfa = "";
     |PARA hi = 1; |SI hi [ hn1; |HACIENDO hi = hi + 1;
          halfa = C + halfa;
          IC = IC + 1;
     |SIGUE;
     #90#2 = halfa;            || NUMERO LOTE.
     nlote = halfa;
|FPRC;

|PROCESO Cadena;
     IM = M1<-;
     IM = IM + pos - 1;
     C = M;
     IC = IC + 1;
     hn1 = hn1 + 1;
|FPRC;

|PROCESO HallaPos;
     IM = M1<-;
     |PARA pos = 1; |SI pos [ hn; |HACIENDO pos = pos + 1;
          |SI letra = M; |ACABA; |FINSI;
          IM = IM + 1;
     |SIGUE;
     |MENAV "0000­­­ La Cadena contiene caracteres extra¤os !!!";
|FPRC;

|PROCESO suma_lotes; |TIPO 0;
     |SI mod = 1;
          hn = 0;
          hn1 = 0;
          IM = M1<-;
          |SI #90#6 = "S"; |HAZ Numeros; |FINSI;
          |SI #90#7 = "S"; |HAZ Mayus;   |FINSI;
          |SI #90#8 = "S"; |HAZ Minus;   |FINSI;
          |HAZ Suma;
     |FINSI;
|FPRC;

|PROCESO Numeros;
     |PARA hi = 48; |SI hi [ 57; |HACIENDO hi = hi + 1;
          hn = hn + 1;
          M = &hi;
          IM = IM + 1;
     |SIGUE;
|FPRC;

|PROCESO Mayus;
     |PARA hi = 65; |SI hi [ 90; |HACIENDO hi = hi + 1;
          hn = hn + 1;
          M = &hi;
          IM = IM + 1;
     |SIGUE;
|FPRC;

|PROCESO Minus;
     |PARA hi = 97; |SI hi [ 122; |HACIENDO hi = hi + 1;
          hn = hn + 1;
          M = &hi;
          IM = IM + 1;
     |SIGUE;
|FPRC;

|PROCESO Envase69;
     qAbono    = "N";
     Envase    = #0#22;
     Unidades1 = #0#23;
     Unidades2 = #0#5;
     VArticulo = #0#2;
     enAlmacen = #0#3;
     eaTipo = "V";
     eaProgEnv = "factura";
     |HAZ EntraEnvase;
     #0#22 = Envase;
     #0#23 = Unidades1;
     #0#5  = Unidades2;  |PINTA #0#5;
|FPRC;

|PROCESO Conversion;  |TIPO 7;
     aAlfa = #0#2; |QBF aAlfa;
     |SI aAlfa = ""; |ACABA; |FINSI;

     |SI #20#250 = "S";
          |HAZ PrecioArti;
          eaDocu = "FC";
          eaSerie = #0#20;
          enCodigo = #0#0;
          enLinea = #0#1;
          eaArticulo = #0#2;
          eaCli = #1#3;
          enModo = (FEntrada / 100) ! 0;
          enDto = #0#8;
          enPrecio = #0#6;
          enUnid1 = #0#5;
          enUnid2 = #0#48;
          enUnid3 = #0#23;
          Envase = #0#22;
          enImpDtoPromo = #0#46;
          enDtoPrePromo = #0#47;
          eaDivisa = #1#65;
          |SUB_EJECUTA_NP "dsz00080";
          |SI enError ! 0; |ERROR; |ACABA; |FINSI;
          #0#8 = enDto;
          #0#6 = enPrecio;
          #0#5 = enUnid1;
          #0#48 = enUnid2;
          #0#23 = enUnid3;
          #0#22 = Envase;
          #0#46 = enImpDtoPromo;
          #0#47 = enDtoPrePromo;
          |SI eaProCliArt = "S"; |C_M #0#5, 1, "N"; |FINSI;
     |FINSI;

     |HAZ DobleUniV;
     |SI eaSw2Stock = "S";
          |C_M #0#5, 1, "N";
     |FINSI;

     |SI #20#250 = "X";
          |SI #20#68 = "S";
               |C_M #0#5, 1, "N";
          |SINO;
               |ABRE #134;
               #134#0 = #1#3;
               #134#1 = #0#2;
               |LEE 000#134=;
               |SI FSalida = 0; |C_M #0#5, 1, "N"; |FINSI;
               |CIERRA #134;
          |FINSI;
     |FINSI;

     |SI #20#72 = "S";
          |HAZ Envase69;
          |C_M #0#5, 1, "S";
          |SI enEntraEnvase ! 0;  |C_M #0#5, 1, "N";  |FINSI;
     |FINSI;
|FPRC;

|PROCESO decim1;
     |SI #1#67 = "D";  || Si la moneda de trabajo es la divisa ...
       #0#6 = #0#26 / #1#66 * #1#69;  || ... recalculo en funcion de la divisa
     |SINO;
       #0#26 = #0#6 / #1#69 * #1#66; || .. recalculo en funcion de la moneda base
     |FINSI;
     |HAZ visual_precio; || Visualiza el precio
|FPRC;


|PROCESO LinDiv;  |TIPO 7;
     |ABRE #agifa321;
     |LEE 001#agifa321.p;  || Leo parametros de divisa
     |CIERRA #agifa321;

     |SI ac_divisa ! "S";
          |ATRI R;
          |PINTA 1446, "Precio";
          |PINTA 1470, "I.Total";
          |ATRI r;
     |SINO;
          |SI pintado = 0; || Si divisas estan activadas y no he pintado ...
               |SI #1#67 = "D";   || Si la moneda de trabajo es la divisa la pinto en
                    |ATRI R;         || el encabezado del precio y el importe
                    titdiv = "Precio" + "(" + #1#65 + ")";
                    |PINTA 1444,titdiv;
                    titdiv = "I.Tot." + "(" + #1#65 + ")";
                    |PINTA 1468,titdiv;
                    |ATRI r;
               |SINO;
                    |ATRI R;
                    |PINTA 1446, "Precio";
                    |PINTA 1470, "I.Total";
                    |ATRI r;
               |FINSI;
               |SI #agifa321#3 = "S";  || Si la visualizacion esta activada ...
                    ||mensa = "Precio:            Imp.:              T.Bruto:             T.FAC:          ";
                    ||PINTA 1102,mensa;  || ... pinto la linea de visualizacion
                    |PINTA 1102, "Precio:";
                    |PINTA 1121, "Imp.:";
                    |PINTA 1140, "T.Bruto:";
                    |PINTA 1161, "T.FAC:";
                    |PINTA #0#28; || Pinto precio visual
                    |PINTA #0#29; || Pinto importe visual
                    |SI #1#67 = "D"; || Si la moneda de trabajo es la divisa
                         |PINTA 1149,#1#74;
                         |PINTA 1168,#1#75;
                    |SINO;
                         |PINTA 1149,#1#70;
                         |PINTA 1168,#1#71;
                    |FINSI;
                    pintado = 1;  || Ya hemos pintado
               |FINSI;
          |FINSI;
     |FINSI;

     |HAZ EsViarsa;
     |SI FSalida = 0;
          |HAZ ViaPinFac;
     |FINSI;
|FPRC;

|PROCESO precio_divisa;
   #0#26 = #0#6 / #1#69 * #1#66;  || Calculo el precio en divisa
   |HAZ decim1;
|FPRC;

|PROCESO visual_precio; || Pinta el precio visual.
|SI #1#67 = "D";  || Si la moneda de trabajo es la divisa ...
  #0#28 = #0#6;   || ... el campo visualiz. es el precio en moneda base
  |PINTA #0#26;
|SINO;            || Si la moneda de trabajo es la moneda base ...
  #0#28 = #0#26;  || ... el campo visual. es el precio en divisa
  |PINTA #0#6;
|FINSI;
|SI ac_divisa = "S"; |Y #agifa321#3= "S";
  |PINTA #0#28; || Si las divisas y la visualizacion estan activadas, pinto
|FINSI;
|FPRC;


|PROCESO visual_importe;  || Pinta el importe visual
|SI #1#67 = "D";  || Si la moneda de trabajo es la divisa ...
  #0#29 = #0#9;   || el campo visualiz. es el importe en moneda base
  |PINTA #0#27;
|SINO;            || Si la moneda de trabajo es la moneda base ...
  #0#29 = #0#27;  || el campo visualiz. es el importe en divisa
  |PINTA #0#9;
|FINSI;
|SI ac_divisa = "S"; |Y #agifa321#3= "S";
  |PINTA #0#29;   || Si las divisas y la visualizacion estan activadas, pinto
|FINSI;
|FPRC;

|PROCESO visual_totales;
   |ABRE #agifa321;
   |LEE 001#agifa321.p;
   |SI #1#67 = "D";
     |SI ac_divisa = "S"; |Y #agifa321#3= "S";
       |PINTA 1149,#1#74;
       |PINTA 1168,"        ";
       |PINTA 1168,#1#75;
     |FINSI;
     |CIERRA #agifa321;
     |PINTA 1353,#1#70;
     |PINTA 1367,#1#71;
   |SINO;
     |SI ac_divisa = "S"; |Y #agifa321#3= "S";
       |PINTA 1149,#1#70;
       |PINTA 1168,"        ";
       |PINTA 1168,#1#71;
     |FINSI;
     |CIERRA #agifa321;
     |PINTA 1353,#1#15;
     |PINTA 1367,#1#41;
   |FINSI;
|FPRC;

|CALCULO Promart;
     |SI #20#250 ! "N"; |Y eaProCliArt = "S";
          articulo = #0#2;
          |ACABA;
     |FINSI;

     |SI nTecla = 16;
          eaGrupo = #6#158;
          eaArticulo = #0#2;
          enAlmacen = #0#3;
          eaCliente = #1#3;
          |HAZ PintaPromo;
          |ENCAMPO #5#0;
     |FINSI;
     enPromo = 1;
     |HAZ PrecioArti;
     enPromo = 0;
     ||ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
     articulo = #0#2;
|FCAL;

|PROCESO CogeValores69;  |TIPO 7;
     |SI Campo = 5;
          |HAZ EsAparecida;
          |SI FSalida = 0;
               aAlfa = "0000<F4>Saldo Art./Cliente <F5>Envases <F6>Equivalentes <F8>Consulta Promociones";
               |MENSA aAlfa;
          |SINO;
               aAlfa = "0000<F5> Envases    <F6> Equivalentes   <F8> Consulta Promociones";
               |MENSA aAlfa;
          |FINSI;
     |FINSI;
     |SI Campo = 6;
          aAlfa = "0000<F4> Importe Total, <F6> Consulta Precios, <F7> Calculo Precio Sin Iva";
          |HAZ EsTagloma;
          |SI FSalida = 0;
               aAlfa = "0000<F4>Imp. Total <F6>Consu. Precios <F7>Cal. Pre.s/IVA <F9>Cal.Postform.";
          |FINSI;
          |HAZ EsAparecida;
          |SI FSalida = 0;
               aAlfa = "0000<F4> Importe Total <F5> Tarifas <F6> Consulta Pre. <F7> Calculo Pre. Sin Iva";
          |FINSI;
          |HAZ EsRocai;
          |SI FSalida = 0;
               aAlfa = "0000<F3>Tarifa <F4>Imp. Total <F6>Consulta Precios <F7>Calculo Precio Sin Iva";
          |FINSI;
          |MENSA aAlfa;
     |FINSI;
     |ABRE #20;
     |LEE 001#20p;
     |SI FSalida ! 0; |DDEFECTO #20; |FINSI;
     |CIERRA #20;

     aAlfa = #0#2; |QBF aAlfa;

     |SI Campo = 3; |Y aAlfa ! "";
         |C_M #0Campo, 1, "S";
         |SI #20#99 = "S";
             |C_M #0Campo, 1, "N";
             #0Campo = 1;  |PINTA #0Campo;
         |FINSI;
     |FINSI;

     |SI #2#176 = "N";  |ACABA;  |FINSI;

     |SI Campo = 3;
         |SI enAlmacen ! 0;
             #0#3 = enAlmacen;  |PINTA #0#3;
         |FINSI;
     |FINSI;

     |SI Campo = 5;
         |SI enUnidades ! 0;
             |SI #0#5 ! enUnidades;  Contenido = #0#5;  |FINSI;
             #0#5 = enUnidades;  |PINTA #0#5;
         |FINSI;
     |FINSI;

     |SI Campo = 6;
          |SI nPrecio ! 0;
               #0#6 = nPrecio;  |PINTA #0#6;

               |HAZ EsRocai;
               |SI FSalida = 0; #0#10 = nComiRocai; |PINTA #0#10; |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO PideArt69;  |TIPO 7;
     nModo = (FEntrada/100) ! 0;
     |SI #20#140 = "S"; |Y nModo = 1; #0#2 = eaArtAnt; |FINSI;

     |HAZ EsTagloma;
     |SI FSalida = 0;
          |MENSA "0000<F5> Consulta articulos pendientes   <F6> Modificacion unidades pendientes";
     |FINSI;
     |HAZ EsForestales;
     |SI FSalida = 0;
          |MENSA "0000<F3> Buscar articulo";
     |FINSI;

     |C_M #0#2, 1, "S";
     |C_M #0#3, 1, "N";

     |SI #0#2 ! "                    ";
         |ABRE #2;
         #2#0 = #0#2;
         |LEE 000#2=;
         |SI FSalida ! 0;  |DDEFECTO #2;  |FINSI;
         |CIERRA #2;
         |SI #2#176 = "S";
             |C_M #0#2, 1, "N";
             |C_M #0#3, 1, "N";
             |ACABA;
         |FINSI;
     |FINSI;

     |ABRE #910;
     |LEE 040#910p;
     |SI FSalida ! 0;  |DDEFECTO #910;  |FINSI;
     |CIERRA #910;

     |SI #910#2 [ 2;    |ACABA;  |FINSI;

     eAlfa = #0Campo;
     |SUB_EJECUTA_NP "dsz99990";                 || Por Pantalla

     |SI eAlfa = "-1";  |PTEC 807;  |ACABA;  |FINSI;
     |SI eAlfa = "-2";              |ACABA;  |FINSI;

     eaArticulo = eAlfa;      ||  700000-4215

     #0Campo = eAlfa;
     |PINTA #0Campo;
     |PTEC 802;
|FPRC;

|PROCESO Calc669;  |TIPO 6;
     nTecla = FSalida;
     eaArtAnt = #0#2;

     |HAZ EsTecatel;
     |SI FSalida = 0;
          aAlfa = #0#2; |QBF aAlfa;
          aAlfa = aAlfa > "";
          |SI aAlfa = "FIN"; |ERROR; |PTEC 807; |PTEC 807; |ACABA; |FINSI;
     |FINSI;

     |SI nTecla = 11;   ||F3
          |HAZ EsForestales;
          |SI FSalida = 0;
               |SUB_EJECUTA_NP "goma0008";
               |SI eaArticulo ! "";
                    #0Campo = eaArticulo;
                    |PINTA #0Campo;
               |SINO;
                    |ERROR; |ACABA;
               |FINSI;
          |FINSI;
     |FINSI;

     |SI nTecla = 13; || F5
          |HAZ EsTagloma;
          |SI FSalida = 0;
               eaCliente = #1#3;
               eaArticulo = #0#2;
               |HAZ TagCogeArt;
               |SI FSalida = 0;
                    #0#2 = eaArticulo; |PINTA #0#2;
                    #0#5 = enUnidades; |PINTA #0#5;
                    #0#43 = 9; ||| Marco campo INTERNO con 9 !!!
               |SINO;
                    |ERROR; |ACABA;
               |FINSI;
          |FINSI;
     |FINSI;
     |SI nTecla = 14; || F6
          |HAZ EsTagloma;
          |SI FSalida = 0;
               eaCliente = #1#3;
               eaArticulo = #0#2;
               |SUB_EJECUTA_NP "tagz0007";
               |ERROR; |ACABA;
          |FINSI;
     |FINSI;

     |SI #0Campo ! Contenido; |Y Campo = 2;
          |HAZ EsTagloma;
          |SI FSalida = 0;    || Quita el F9 del postformado
               nTagQuitaPost = 1;
          |FINSI;
          eaArticulo = #0#2;
          eaCliente = #1#3;
          |HAZ DefectoMediV;
          #0#33 = enMedida1;
          #0#34 = enMedida2;
          #0#35 = enMedida3;
          |HAZ PintaMedidaV;
     |FINSI;
     |HAZ DobleArtiV;
     |SI eaSw2Stock = "S"; |ACABA; |FINSI;

     enAlta = 1;
     eaArticulo = #0Campo;
     |HAZ LlenaArticulo;
     |SI FSalida = 0;
          #0Campo = eaArticulo;
          |PINTA #0Campo;
     |SINO;
          |ERROR; |ACABA;
     |FINSI;

     |ABRE #2;
     #2#0 = #0#2;
     |LEE 000#2=;
     |SI FSalida ! 0;  |DDEFECTO #2;  |FINSI;
     |CIERRA #2;

     |SI #2#176 = "S";
          eaTipo      = "FC";
          eaSerie     = #0#20;
          enCodigo    = #0#0;
          enLinea     = #0#1;
          efFecha     = #1#1;
          eaArticulo  = #0#2;
          enAlmacen   = #0#3;
          enUnidades  = #0#5;
          enTBruto    = #0#7;
          eaAbono     = "N";
          enTarifa    = #6#39;
          eaCliente   = #1#3;
          enCamBas    = #1#66;
          eaMoneda    = #1#67;
          enCamDiv    = #1#69;

          |HAZ EsRocai; |SI FSalida = 0; |HAZ CalcuComi; |FINSI;
          enComision = #0#10;

          |SUB_EJECUTA_NP "dsz00002";

          nComiRocai = enComision;

          #0#3    = enAlmacen;
          nPrecio = enTBruto / enUnidades;
          |PTEC 802;
          |PTEC 802;
          |PTEC 802;
          |PTEC 802;
     |FINSI;
     |HAZ art6fcv;
     |HAZ nomodif1;

     |HAZ EsTecatel;
     |SI FSalida = 0; |Y PARAMETRO = "agrupa";
          |ABRE #2;
          #2#0 = #0#2;
          |LEE 000#2=;
          |SI FSalida ! 0;
               |MENAV "0000Codigo Inexistente....";
               |ERROR; |ACABA;
          |FINSI;
          |CIERRA #2;
          nModo = (FEntrada/100) ! 0;
          |SI #2#125 ! "NS";
               |SI nModo = 1;
                    #0#5 = 1;
                    |PTEC 802;
                    |PTEC 815;
               |FINSI;
          |SINO;
               |SI nModo = 1;
                    eaSerie = #0#20;
                    enCodigo = #0#0;
                    enLinea = #0#1;
                    eaArticulo = #0#2;
                    aTipoDA = "F";
                    |SUB_EJECUTA_NP "dsw00054";
                    #0#5 = 1;
                    |PTEC 802;
                    |PTEC 815;
               |SINO;
                    enFuerzaDA = 1;
                    aTipoDA = "F"; |HAZ AltaDA;
                    enFuerzaDA = 0;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Tipo11069;  |TIPO 11;
     |SI FSalida = 7;  |Y #2#176 = "S";
         |MENAV "      Imposible abortar;  Termine de introducir la linea y efectue una Baja.";
         |ERROR;
     |FINSI;
|FPRC;

|PROCESO MinAlma69;
     #8#0 = #0#2;
     #8#1 = 1;
|FPRC;

|PROCESO MaxAlma69;
     #8#0 = #0#2;
     #8#1 = 99999;
|FPRC;


|PROCESO cierre; |TIPO 6;
     |SI FSalida = 13; || F5;
          |ABRE #8;
          #8#0 = #0#2;
          #8#1 = #0#3;
          |LEE 000#8];
          |CONSULTA_F_CLAVE #1#8, MinAlma69, MaxAlma69;
          |SI FSalida = 0;
               #0#3 = #8#1; |PINTA #0#3;
          |SINO;
               |ERROR; |ACABA;
          |FINSI;
          |CIERRA #8;
     |FINSI;

     efFec = #1#1;
     enAlma = #0#3;
     |HAZ MiraHisL;
     |SI enErrHis ! 0;
          |ERROR;
          |ACABA;
     |FINSI;
|FPRC;

|PROCESO ModiFec;
     aGuardaFec = #1#1;
     #1#1 = eaFecAnt;
     enForma = -1; |HAZ AcumulaFC;
     #1#1 = aGuardaFec;
     enForma = 1; |HAZ AcumulaFC;
|FPRC;

|DEFBUCLE ModiFec;
     #0#1;
     ;
     #1#48, #1#0, 001;
     #1#48, #1#0, 999;
     be;
     NULL, ModiFec;
|FIN;

|PROCESO Tipo5_069;  |TIPO 5;


     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 1;
          |HAZ EsGuerola;
          |SI FSalida = 0;
               |HAZ GuerCargaPres;
          |FINSI;
     |FINSI;

     |SI nModo = 2; |Y eaFecAnt ! "";
          |BUCLE ModiFec;
          eaFecAnt = "";
     |FINSI;

     |HAZ EsForestales;
     |SI FSalida = 0;
          |PARA; |SI; |HACIENDO;
               aAlfa = #1#87; |QBF aAlfa;
               |SI aAlfa = "";
                    |MENAV "0000Campo obligatorio...";
                    |ENCAMPO #87#1;
               |SINO;
                    |SAL;
               |FINSI;
          |SIGUE;
     |FINSI;

     |SI nModo = 2; |HAZ actal; |FINSI;
|FPRC;

|PROCESO CtaArt1;
     eaModulo = "agifa084"; |HAZ CtaArt;
     |HAZ EsDesanch;
     |SI FSalida = 0;
          |ABRE #2;
          #2#0 = #0#2;
          |LEE 020#2=;
          |CIERRA #2;
          |SI #2#136 = "N";
               |MENAV "0000El articulo no es de venta...";
               |ERROR; |ACABA;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Dto084; |TIPO 0;
     |HAZ totfc;
     |HAZ fccomis;

     ||ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
     |HAZ EsTecatel;
     |SI FSalida = 0;
          art_dt = #0#2;
          dtos_1 = #0#8;
          dtos_2 = #0#21;
          |HAZ TecaCheqFijo;
          |SI FSalida ! 0; |ERROR; |ACABA; |FINSI;
     |FINSI;
     ||ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
     eaArticulo = #0#2;
     enPrecio = #0#6;
     enDto1 = #0#8;
     enDto2 = #0#21;
     |HAZ CheqPCM_PVP;

     |SI #279#3 = "S";
          eaArticulo = #0#2;
          enPrecio = #0#6;
          enDto1 = #0#8;
          enDto2 = #0#21;
          nNume =  (enPrecio < enDto1) < enDto2;
          |SI nNume ! nPreDtoAnt;
               |SUB_EJECUTA_NP "dsz00100";
               |SI enError ! 0; |ERROR; |ACABA; |FINSI;
               nPreDtoAnt = nNume;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Equivalentes;
     articulo = #0#2;
     eaArticulo = #0#2;
     enAlmacen = #0#3;
     |SUB_EJECUTA_NP "agifa294";
     #0#2 = eaArticulo; |PINTA #0#2;
     #0#3 = enAlmacen; |PINTA #0#3;
     |ABRE #2;
     #2#0 = #0#2;
     |LEE 000#2=;
     |CIERRA #2;
     #0#4 = #2#1;
     #0#13 = #2#2;
     |PINTA #0#4;
     |SI articulo ! #0#2; |HAZ PrecioArti; |FINSI;
     |SI enSalida ! 0; |Y eaAuto = "N"; |ERROR; |FINSI;
|FPRC;

|PROCESO Descri069; |TIPO 6;
     |SI FSalida = 14;             ||F6
          eaAuto = "N";
          |HAZ Equivalentes;
     |FINSI;
     |HAZ PintaDes69;
|FPRC;

|PROCESO MinC069;
     #referen@#20 = #1#48;
     #referen@#0 = #1#0;
     #referen@#1 = 001;
|FPRC;

|PROCESO MaxC069;
     #referen@#20 = #1#48;
     #referen@#0 = #1#0;
     #referen@#1 = 999;
|FPRC;

|PROCESO Consulta069; |TIPO 66;
     nLin = 0;
     |DDEF aAlfa;
     aAlfa = aAlfa + "agifa069";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          |CONSULTA_F_CLAVE #1#referen@, MinC069, MaxC069;
          |SI FSalida = 0; nLin = #referen@#1; |FINSI;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;

     |SI nLin ! 0;
          |PTEC 802;
          aAlfa = ("000" + nLin) % -103;
          aPtec = aAlfa % 301; nPtec = &aPtec;
          |PTEC nPtec;
          aPtec = aAlfa % 201; nPtec = &aPtec;
          |PTEC nPtec;
          aPtec = aAlfa % 101; nPtec = &aPtec;
          |PTEC nPtec;
     |FINSI;
|FPRC;

|PROCESO TotalImp7_69; |TIPO 7;
     |HAZ EsViarsa;
     |SI FSalida = 0;
          |HAZ ViaModiFac;
     |FINSI;
|FPRC;

|PROCESO TipoLin0_69; |TIPO 0;
     eaArtiAntes = #0#2;
     enAlmaAntes = #0#3;
     aArtiPromo = #0#2;
|FPRC;

|PROCESO ImportaPDA69;
     |DDEF aAlfa; aAlfa = aAlfa + "agifa069";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |ABRE #referen@;
     #referen@#20 = #1#48;
     #referen@#0 = #1#0;
     #referen@#1 = 999;
     |LEE 000#referen@.];
     |SI FSalida = 0;
          |LEE 000#referen@.a;
     |SINO;
          |LEE 000#referen@.u;
     |FINSI;
     |SI FSalida = 0; |Y #referen@#20 = #1#48; |Y #referen@#0 = #1#0;
          nLin = #referen@#1 + 1;
     |SINO;
          nLin = 1;
     |FINSI;
     |CIERRA #referen@;
     |DESCARGA_DEF #referen@;

     |DDEF aAlfa; aAlfa = aAlfa + "psion067";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida ! 0; |ACABA; |FINSI;
     |NOME_DAT #referen@#eaFichero#;
     |ABRE #referen@;
     |LEE 000#referen@.p;
     |PARA; |SI FSalida = 0; |HACIENDO;
          #0#20 = #1#48;
          #0#0 = #1#0;
          #0#1 = nLin;
          |GRABA 020#0b;
          #0#2 = #referen@#0; ||Arti
          #0#4 = #referen@#1; ||Des
          #0#3 = #referen@#2; ||Alma
          #0#5 = #referen@#3; ||Uni
          #0#31 = #referen@#9; ||Parti
          FEntrada = 100;     ||simula alta
          |HAZ PrecioArti;
          |HAZ TotalLin69;
          |HAZ fcacarti;
          |GRABA 020#0a;
          |LIBERA #0;
          nLin = nLin + 1;
          |LEE 000#referen@.s;
     |SIGUE;
     |CIERRA #referen@;
     |DELINDEX #referen@;
     |DESCARGA_DEF #referen@;
     |PONCONTROL 23, "SI"
     |PTEC 809;
     |PTEC 808;
|FPRC;

|PROCESO MenuTrack69;
     |VARIABLES; {20} aPopup = ""; |FINSI;

     aPopup1 = "-1";  || Si fuera -1 en la posicion
     aPopup2 = 7;
     aPopup3 = "<F3> Extracto Contable";
     aPopup4 = "<F5> Doble Stock/Kit";
     aPopup5 = "<F6> Precios Cliente";
     aPopup6 = "<F8> Descripcion Ampliada";
     aPopup7 = "<F10> Extracto Articulo";
     aPopup8 = "<F12> Consulta Cabecera";
     aPopup9 = "<Ctrl+F7> Captura PDA";

     |HAZ EsOTP;
     |SI FSalida = 0;
         aPopup10 = "Importacion CSV";
         aPopup2  = 8;
     |FINSI;

     IaPopup = aPopup1  <-;
     |ESPECIFICA "TRACKPOPUP", aPopup;


     nSal = FSalida;
     |SI FSalida = 1; nSal = 11; |FINSI;
     |SI FSalida = 2; nSal = 13; |FINSI;
     |SI FSalida = 3; nSal = 14; |FINSI;
     |SI FSalida = 4; nSal = 16; |FINSI;
     |SI FSalida = 5; nSal = 18; |FINSI;
     |SI FSalida = 6; nSal = 9;  |FINSI;
     |SI FSalida = 7; nSal = 25; |FINSI;
     |SI FSalida = 8; nSal = 99; |FINSI;

     FSalida = nSal;
|FPRC;

|PROCESO Riesgos69;
     enErrRie = 0;
     eaSerie  = #agifa069#20; eaTag = "FD";  |HAZ SacaRiesgo;

     eaCli = #0#15; enTiva = #0#11; |HAZ IVACli;
     nTota = #0#9 + (#0#9 * enIva / 100);
     nTota = nTota < #0#8 < #0#21;

     |SI eaRieSuma = "S"; nRieUtili = nRieUtili + #1#41 + nTota; |FINSI;
     |SI #agifa142#6 = "S";
          eaDocu = "L";
          eaTipo = "A";
          enImpoDoc = #1#41 + #0#9;
          |HAZ ControlRiesgo;
          |SI enErrRie = 1; |ERROR; |ACABA; |FINSI;
          |SI enAudito = 0;
               |ABRE #43;
               |LEE 000#43u;
               |SI FSalida = 0;
                    nConAu = #43#0 + 1;
               |SINO;
                    nConAu = 1;
               |FINSI;
               |DDEFECTO #43;
               #43#0 = nConAu;          || contador
               #43#12 = "FDIRECTA";     || tipo documento
               #43#1 = #1#48;           || serie
               #43#2 = #1#0;            || documento
               #43#3 = #1#1;            || fecha
               #43#4 = #1#3;            || cliente
               #43#5 = #1#4;            || nombre
               #43#6 = Usuario % 810;   || usuario
               #43#7 = nRieTotal;       || riesto concedido
               #43#8 = nRieUtili;       || riesgo actual
               #43#9 = #41#2;           || % exceso
               #43#10= #41#3;           || importe % exceso
               #43#11= #41#4;           || limite exceso
               |GRABA 020#43n;
               |CIERRA #43;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Alma69_66; |TIPO 66;
     |ABRE #29;
     #29#0 = #0#3;
     |LEE 000#29];
     |CONSULTA_CLAVE #1#29;
     |SI FSalida = 0;
          #0#3 = #29#0;
          |PINTA #0#3;
     |SINO;
          |ERROR;
     |FINSI;
     |CIERRA #29;
|FPRC;

|PROCESO GuerLinPres;
     |ABRE #2;
     #2#0 = #guerola@#2;
     |LEE 000#2=;
     |CIERRA #2;

     |DDEFECTO #0;
     #0#20 = #1#48;
     #0#0 = #1#0;
     #0#1 = #guerola@#1;
     #0#2 = #guerola@#2;
     #0#3 = 1;
     #0#4 = #guerola@#3;
     #0#5 = 0;
     #0#6 = #guerola@#6;
     #0#26 = #0#6;
     #0#8 = #guerola@#8;
     #0#11 = #2#30;
     #0#13 = #2#2;
     #0#15 = #1#3;
     #0#16 = #0#34;
     #0#17 = #0#35;
     |HAZ fcacarti;
     |GRABA 020#0n;
|FPRC;

|DEFBUCLE GuerLinPres;
     #guerola@#1002;
     5;
     nPresu, 001, "C";
     nPresu, 999, "C";
     ;
     NULL, GuerLinPres;
|FIN;

|PROCESO GuerCargaPres;
     |DDEF aAlfa;
     aAlfa = aAlfa + "guerm059";
     |CARGA_DEF aAlfa, guerola@;
     |SI FSalida = 0;
          |ABRE #guerola@;
          #guerola@#0 = #1#48;
          #guerola@#1 = #1#0;
          |LEE 000#guerola@.=;
          |CIERRA #guerola@;
          nPresu = #guerola@#4;
          |DESCARGA_DEF #guerola@;
     |FINSI;

     |DDEF aAlfa;
     aAlfa = aAlfa + "guerm208";
     |CARGA_DEF aAlfa, guerola@;
     |SI FSalida = 0;
          |ABRE #0;
          |BUCLE GuerLinPres;
          |CIERRA #0;
          |DESCARGA_DEF #guerola@;
     |FINSI;
|FPRC;

|PROCESO TagloAvisaSto69;
     |ABRE #238;
     #238#0 = #2#201;
     |LEE 000#238=;
     |SI FSalida = 0; |Y #238#6 = 2;
          |SI #8#48 < #0#30;
               aAlfa = "0000Supera el Stock disponible: " + #8#48;
               |MENAV aAlfa;
               |SI #agifa142#230 = "X"; |ERROR;   |FINSI;
          |FINSI;
     |SINO;
          |SI #8#39 < #0#5;
               aAlfa = "0000Supera el Stock disponible: " + #8#39;
               |MENAV aAlfa;
               |SI #agifa142#230 = "X"; |ERROR;   |FINSI;
          |FINSI;
     |FINSI;
     |CIERRA #238;
|FPRC;

----------------------TAGLOMA POSTFORMADOS--------------------------------
|PROCESO TagEsLinPost;
     nSali = 1; || No es
     |DDEF aAlfa;
     aAlfa = aAlfa + "tagm0056";
     |CARGA_DEF aAlfa, tagm0056@;
     |SI FSalida = 0;
          |ABRE #tagm0056@;
          |SELECT #2#tagm0056@;
          #tagm0056@#0 = "FD";
          #tagm0056@#1 = #0#20;
          #tagm0056@#2 = #0#0;
          #tagm0056@#5 = #0#1;
          |LEE 000#tagm0056@.=;
          nSali = FSalida;
          |CIERRA #tagm0056@;
          |DESCARGA_DEF #tagm0056@;
     |FINSI;
     FSalida = nSali;
|FPRC;

|PROCESO TagLinPost;
     nSali = 1; || No es
     |DDEF aAlfa;
     aAlfa = aAlfa + "tagm0056";
     |CARGA_DEF aAlfa, tagm0056@;
     |SI FSalida = 0;
          |ABRE #tagm0056@;
          #tagm0056@#0 = "FD";
          #tagm0056@#1 = #0#20;
          #tagm0056@#2 = #0#0;
          #tagm0056@#3 = #0#1;
          |LEE 101#tagm0056@.=;
          nSali = FSalida;

          |SI nForma = 1;
               |SI nSali = 0;
                    aponer = Asino; |HAZ poncontr;
                    |SI nTagQuitaPost = 1;   || Cambia de articulo
                              |Y enTagEligePost = 0; ||y no elige otro incr.
                         |HAZ TagBorraLinPost;
                         |BORRA 040#tagm0056@.c;
                    |SINO;
                         |HAZ TagCreaLinPost;
                         #tagm0056@#5 = nLin;
                         |GRABA 020#tagm0056@.a;
                    |FINSI;
                    aponer = Anosi; |HAZ poncontr;
                    |PTEC 809; |PTEC 816; |PTEC 806;
               |SINO;
                    || enTagLinBorra la carga el tagm0058
                    ||
                    #tagm0056@#5 = enTagLinBorra;
                    |HAZ TagBorraLinPost;
                    |SI nTagBorLinPost = 0;
                         |PONCONTROL 23, "SI";
                    |FINSI;
               |FINSI;
          |SINO;
               |SI modo = 3; |Y enModoCab84 ! 3;
                    |HAZ TagBorraLinPost;
                    |BORRA 040#tagm0056@.c;
                    |PONCONTROL 23, "SI";
                    |PTEC 809; |PTEC 808;
               |FINSI;
               |SI modo = 3; |Y enModoCab84 = 3;
                    |BORRA 040#tagm0056@.c;
               |FINSI;
          |FINSI;

          |CIERRA #tagm0056@;
          |DESCARGA_DEF #tagm0056@;
     |FINSI;
     nTagQuitaPost = 0;
     enTagEligePost = 0;
|FPRC;

|PROCESO TagPreDesPost;
     nTagPre = 0;
     aTagDes = "";
     |DDEF aAlfa;
     aAlfa = aAlfa + "tagm0055";
     |CARGA_DEF aAlfa, tagm0055@;
     |SI FSalida = 0;
          |ABRE #tagm0055@;
          #tagm0055@#0 = #tagm0056@#4;
          |LEE 000#tagm0055@.=;
          |SI FSalida = 0;
               aTagDes = #tagm0055@#1;
               nTagPre = #tagm0055@#2;
               aTagArt = #tagm0055@#4;
          |FINSI;
          |CIERRA #tagm0055@;
          |DESCARGA_DEF #tagm0055@;
     |FINSI;
|FPRC;

|PROCESO AcuFactura;
     |HAZ CalCabAgifa084_2;
     |HAZ visual_totales;
|FPRC;

|PROCESO TagCreaLinPost;
     |DDEF aAlfa; aAlfa = aAlfa + "agifa069";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |ABRE #referen@;
     #referen@#20 = #0#20;
     #referen@#0 = #0#0;
     #referen@#1 = #tagm0056@#5;
     |LEE 000#referen@.=;
     |SI FSalida = 0;
          nLin = #tagm0056@#5;
          |SALVA_DATOS #0;
          |SALVA_DATOS #referen@;
          |REPON_DATOS #0;
          enForma = -1;
          |HAZ AcumulaFC;
          |HAZ AcuFactura;
          |REPON_DATOS #0;
     |SINO;
          #referen@#1 = 999;
          |LEE 000#referen@.];
          |SI FSalida = 0;
               |LEE 000#referen@.a;
          |SINO;
               |LEE 000#referen@.u;
          |FINSI;
          |SI FSalida = 0; |Y #referen@#20 = #0#20;  |Y #referen@#0 = #0#0;
               nLin = #referen@#1 + 1;
          |SINO;
               nLin = 1;
          |FINSI;
          |SI nLin [ #0#1; nLin = #0#1 + 1; |FINSI;
          |DDEFECTO #referen@;
          #referen@#20 = #0#20;
          #referen@#0 = #0#0;
          #referen@#1 = nLin;
          |GRABA 020#referen@.b;
     |FINSI;

     |HAZ TagPreDesPost;
     #referen@#2 = aTagArt;
     #referen@#3 = 1;
     #referen@#4 = aTagDes;
     #referen@#5 = #0#5;
     #referen@#6 = nTagPre;
     #referen@#8 = #0#8;
     #referen@#10 = #0#10;

     |ABRE #2;
     #2#0 = #referen@#2;
     |LEE 020#2=;
     |CIERRA #2;
     #referen@#13 = #2#2;

     #referen@#11 = #0#11;
     #referen@#15 = #0#15;
     #referen@#16 = #0#16;
     #referen@#17 = #0#17;
     #referen@#21 = #0#21;
     #referen@#36 = nTagPre;
     |SALVA_DATOS #0;

     |SALVA_DATOS #referen@;
     |REPON_DATOS #0;
     enForma = 1;
     |HAZ AcumulaFC;
     |HAZ TotalLin69;
     |HAZ AcuFactura;
     |SALVA_DATOS #0;
     |REPON_DATOS #referen@;
     |GRABA 020#referen@.a;

     |REPON_DATOS #0;

     |CIERRA #referen@;
     |DESCARGA_DEF #referen@;
|FPRC;

|PROCESO TagBorraLinPost;
     |DDEF aAlfa; aAlfa = aAlfa + "agifa069";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |ABRE #referen@;
     #referen@#20 = #0#20;
     #referen@#0 = #0#0;
     #referen@#1 = #tagm0056@#5;
     |LEE 101#referen@.=;
     nTagBorLinPost = FSalida;
     |SI FSalida = 0;
          |SALVA_DATOS #0;
          |SALVA_DATOS #referen@;
          |REPON_DATOS #0;

          enForma = -1;
          |HAZ AcumulaFC;
          |HAZ AcuFactura;
          |REPON_DATOS #0;
          |BORRA 020#referen@.a;
     |FINSI;
     |CIERRA #referen@;
     |DESCARGA_DEF #referen@;
|FPRC;
--------------------------------------------------------------------------
|PROCESO poncontr;
     fiac = Control % A109;
     fiac = fiac + relleno;
     guarda = fiac % A109;
     fiac = Control % A1001;
     Control = Control + fiac;
     Control = Control + relleno;
     Control = Control % A120;
     Control = Control + aponer;
|FPRC;

|PROCESO T069_6_0; |TIPO 0;
     |SI #279#3 = "S";
          eaArticulo = #0#2;
          enPrecio = #0#6;
          enDto1 = #0#8;
          enDto2 = #0#21;
          nNume =  (enPrecio < enDto1) < enDto2;
          |SI nNume ! nPreDtoAnt;
               |SUB_EJECUTA_NP "dsz00100";
               |SI enError ! 0; |ERROR; |ACABA; |FINSI;
               nPreDtoAnt = nNume;
          |FINSI;
     |FINSI;
|FPRC;
----------------------------------------------
|PROCESO TallerCreaLin69;
     |DDEF aAlfa; aAlfa = aAlfa + "agifa069";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |ABRE #referen@;
     |SI #0#45 > 0;
          nLin = #0#45;
          #referen@#20 = #0#20;
          #referen@#0 = #0#0;
          #referen@#1 = nLin;
          |LEE 121#referen@.=;
     |SINO;
          #referen@#20 = #0#20;
          #referen@#0 = #0#0;
          #referen@#1 = 999;
          |LEE 000#referen@.];
          |SI FSalida = 0;
               |LEE 000#referen@.a;
          |SINO;
               |LEE 000#referen@.u;
          |FINSI;
          |SI FSalida = 0; |Y #referen@#20 = #0#20;  |Y #referen@#0 = #0#0;
               nLin = #referen@#1 + 1;
          |SINO;
               nLin = 1;
          |FINSI;
          |SI nLin [ #0#1; nLin = #0#1 + 1; |FINSI;
          |DDEFECTO #referen@;
          #referen@#20 = #0#20;
          #referen@#0 = #0#0;
          #referen@#1 = nLin;
          |GRABA 020#referen@.b;
     |FINSI;
     aAlfa = "CANON " + #0#4;
     #referen@#2 = "xxxxx";
     #referen@#3 = 1;
     #referen@#4 = aAlfa;
     #referen@#5 = #0#5;
     #referen@#6 = enCanon;
     #referen@#11 = #0#11;
     #referen@#13 = #0#13;
     #referen@#15 = #0#15;
     #referen@#26 = enCanon;
     #referen@#45 = -1;
     |SALVA_DATOS #0;

     |SALVA_DATOS #referen@;
     |REPON_DATOS #0;

     enForma = 1;
     |HAZ AcumulaFC;
     |HAZ TotalLin69;
     |HAZ AcuFactura;

     |SALVA_DATOS #0;
     |REPON_DATOS #referen@;
     |GRABA 020#referen@.a;

     |REPON_DATOS #0;

     #0#45 = nLin;       || Linea Promocion

     |CIERRA #referen@;
     |DESCARGA_DEF #referen@;
|FPRC;

|PROCESO TallerAcuLin69;
     |DDEF aAlfa; aAlfa = aAlfa + "agifa069";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |ABRE #referen@;
     #referen@#20 = #0#20;
     #referen@#0 = #0#0;
     #referen@#1 = #0#45;     || Usa linea promocion
     |LEE 101#referen@.=;
     |SI FSalida = 0;
          |SALVA_DATOS #0;
          |SALVA_DATOS #referen@;
          |REPON_DATOS #0;
          #0#1 = #referen@#1;
          enForma = -1;
          |HAZ AcumulaFC;
          |HAZ TotalLin69;
          |HAZ AcuFactura;
          |REPON_DATOS #0;
     |FINSI;
     |CIERRA #referen@;

     |DESCARGA_DEF #referen@;
|FPRC;

|PROCESO TallerBorLin69;
     |DDEF aAlfa; aAlfa = aAlfa + "agifa069";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |ABRE #referen@;
     #referen@#20 = #0#20;
     #referen@#0 = #0#0;
     #referen@#1 = #0#45;     || Usa linea promocion
     |LEE 101#referen@.=;
     nTallerBorLin = FSalida;
     |SI FSalida = 0;
          |BORRA 020#referen@.a;
     |FINSI;
     |CIERRA #referen@;

     |DESCARGA_DEF #referen@;
|FPRC;

|PROCESO TallerCanon69;
     eaArticulo = #0#2; |QBF eaArticulo;
     |HAZ TallerCanon;
     |SI nForma = 1;
          |SI enCanon ! 0;
               aponer = Asino; |HAZ poncontr;
               |HAZ TallerCreaLin69;
               aponer = Anosi; |HAZ poncontr;
               |PTEC 809; |PTEC 816; |PTEC 806;
          |SINO;
               |SI #0#45 > 0;      || ha cambiado a un articulo sin canon
                    |HAZ TallerBorLin69;
                    #0#45 = 0;
               |FINSI;
          |FINSI;
     |SINO;
          |SI modo = 3; |Y enModoCab84 ! 3;
               |HAZ TallerAcuLin69;
               |HAZ TallerBorLin69;
               |SI nTallerBorLin = 0;
                    |PONCONTROL 23, "SI";
                    |PTEC 809; |PTEC 808;
               |FINSI;
          |SINO;
               |SI modo = 2;
                    |HAZ TallerAcuLin69;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO BorTagloMerma69;
     |DDEF aAlfa;
     aAlfa = aAlfa + "tagm0078";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida ! 0;
          |MENAV "0000Error al cargar 'tagm0078'";
     |SINO;
          |ABRE #referen@;
          #referen@#0 = "F";
          #referen@#1 = #0#20;
          #referen@#2 = #0#0;
          #referen@#3 = #0#1;
          |BORRA 000#referen@.c;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|PROCESO PintaDes69;
     |HAZ EsAparecida;
     |SI FSalida = 0;
          |C_A #0#4, 0, nNume;
          |C_A #0#4, 1, 50;
          |PINTA 2302, "³Descripcion: ";
          |PINTA 2316, #0#4;
          |C_A #0#4, 1, nNume;
     |FINSI;
|FPRC;

|PROCESO ApareceCreaLin69;
     |DDEF aAlfa; aAlfa = aAlfa + "agifa069";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |ABRE #2;
     #2#0 = "9759999";
     |LEE 000#2=;
     |CIERRA #2;

     |ABRE #referen@;
     |SI #0#45 > 0;
          nLin = #0#45;
          #referen@#20 = #0#20;
          #referen@#0 = #0#0;
          #referen@#1 = nLin;
          |LEE 121#referen@.=;
     |SINO;
          #referen@#20 = #0#20;
          #referen@#0 = #0#0;
          #referen@#1 = 999;
          |LEE 000#referen@.];
          |SI FSalida = 0;
               |LEE 000#referen@.a;
          |SINO;
               |LEE 000#referen@.u;
          |FINSI;
          |SI FSalida = 0; |Y #referen@#20 = #0#20;  |Y #referen@#0 = #0#0;
               nLin = #referen@#1 + 1;
          |SINO;
               nLin = 1;
          |FINSI;
          |SI nLin [ #0#1; nLin = #0#1 + 1; |FINSI;
          |DDEFECTO #referen@;
          #referen@#20 = #0#20;
          #referen@#0 = #0#0;
          #referen@#1 = nLin;
          |GRABA 020#referen@.b;
     |FINSI;
     #referen@#2 = #2#0;
     #referen@#3 = #0#3;
     #referen@#4 = #2#1;
     #referen@#5 = -#0#5;
     #referen@#6 = #0#6;
     #referen@#8 = #0#8;
     #referen@#10 = #0#10;
     #referen@#11 = #0#11;
     #referen@#13 = #0#13;
     #referen@#14 = -#0#14;
     #referen@#15 = #0#15;
     #referen@#16 = #0#16;
     #referen@#17 = #0#17;
     #referen@#21 = #0#21;
     #referen@#26 = #0#26;
     #referen@#28 = #0#28;
     #referen@#45 = -1;
     |SALVA_DATOS #0;

     |SALVA_DATOS #referen@;
     |REPON_DATOS #0;

     enForma = 1;
     |HAZ AcumulaFC;
     |HAZ TotalLin69;
     |HAZ AcuFactura;

     |SALVA_DATOS #0;
     |REPON_DATOS #referen@;
     |GRABA 020#referen@.a;

     |REPON_DATOS #0;

     #0#45 = nLin;       || Linea Promocion

     |CIERRA #referen@;
     |DESCARGA_DEF #referen@;
|FPRC;

|PROCESO Aparecida69;
     |ABRE #6;
     #6#0 = #1#4;
     |LEE 000#6=;
     |CIERRA #6;
     |SI #6#113 ! "N"; |ACABA; |FINSI;
     |ABRE #2;
     #2#0 = #0#2;
     |LEE 000#2=;
     |CIERRA #2;

     |SI nForma = 1;
          |SI #2#2 = "975";
               aponer = Asino; |HAZ poncontr;
               |HAZ ApareceCreaLin69;
               aponer = Anosi; |HAZ poncontr;
               |PTEC 809; |PTEC 816; |PTEC 806;
          |SINO;
               |SI #0#45 > 0;      || ha cambiado a un articulo sin canon
                    |HAZ TallerBorLin69;
                    #0#45 = 0;
               |FINSI;
          |FINSI;
     |SINO;
          |SI modo = 3; |Y enModoCab84 ! 3;
               |HAZ TallerAcuLin69;
               |HAZ TallerBorLin69;
               |SI nTallerBorLin = 0;
                    |PONCONTROL 23, "SI";
                    |PTEC 809; |PTEC 808;
               |FINSI;
          |SINO;
               |SI modo = 2;
                    |HAZ TallerAcuLin69;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO ModRie69; |TIPO 0;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 2; |Y #0Campo ! Contenido;
          |HAZ Riesgos69;
          |SI enErrRie = 1; |ERROR; |FINSI;
     |FINSI;
|FPRC;

|PROCESO InforActMatri;
     aAlfa = #0#31; |QBF aAlfa;
     |SI aAlfa = ""; |ACABA; |FINSI;
     nSwPasa = 0;
     |DDEF aPath;
     aAlfa = aPath + "ialbm006";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |SI #0#20 = #referen@#2; |O #0#20 = #referen@#3;
                    |O #0#20 = #referen@#4; |O #0#20 = #referen@#5;
               nSwPasa = 1;
          |FINSI;
          |DESCARGA_DEF #referen@;
     |FINSI;
     |SI nSwPasa = 1; |ACABA; |FINSI;

     aAlfa = aPath + "ialbm002";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          #referen@#0 = #0#31;
          |LEE 101#referen@.=;
          |SI FSalida = 0;
               |SI nForma = 1;
                    |ABRE #6;
                    #6#0 = #1#3;
                    |LEE 000#6=;
                    |CIERRA #6
                    #referen@#6 = #6#0;
                    #referen@#7 = #6#1;
                    #referen@#8 = #1#1;
                    #referen@#9 = #0#9;
                    #referen@#10 = #1#6;
                    #referen@#17 = #0#20;
                    #referen@#18 = #0#0;
                    #referen@#21 = #6#17;
               |SINO;
                    #referen@#6 = "";
                    #referen@#7 = "";
                    #referen@#8 = "01.01.0000";
                    #referen@#9 = "";
                    #referen@#10 = "";
                    #referen@#17 = "";
                    #referen@#18 = "";
                    #referen@#21 = "";
               |FINSI;
               |GRABA 020#referen@.a;
          |FINSI;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |SINO;
          |MENAV "0000Error al cargar 'ialbm002'";
     |FINSI;
|FPRC;

|PROCESO IVA069_66; |TIPO 66;
     enTiva = #0Campo;
     efFiva = #1#1;
     |HAZ ConsuIVA;
     |SI eaDiva = "";
          |ERROR;
     |SINO;
          #0Campo = enTiva; |PINTA #0Campo;
     |FINSI;
|FPRC;

|PROCESO GesiActMaqui;
     |HAZ GesiLeeMaqui;
     |SI eaMatri = ""; |ACABA; |FINSI;
     nSwPasa = 0;
     |DDEF aPath;
     aAlfa = aPath + "gesim001";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |SI #0#20 = #referen@#2; |O #0#20 = #referen@#3;
                    |O #0#20 = #referen@#4; |O #0#20 = #referen@#5;
               nSwPasa = 1;
          |FINSI;
          |DESCARGA_DEF #referen@;
     |FINSI;
     |SI nSwPasa = 1; |ACABA; |FINSI;

     aAlfa = aPath + "gesim002";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          #referen@#0 = eaMatri;
          |LEE 101#referen@.=;
          |SI FSalida = 0;
               |SI nForma = 1;
                    |ABRE #6;
                    #6#0 = #1#3;
                    |LEE 000#6=;
                    |CIERRA #6
                    #referen@#6 = #6#0;
                    #referen@#7 = #6#1;
                    #referen@#8 = #1#1;
                    #referen@#9 = #0#9;
                    #referen@#10 = #1#6;
                    #referen@#17 = #0#20;
                    #referen@#18 = #0#0;
                    #referen@#21 = #6#17;
               |SINO;
                    #referen@#6 = "";
                    #referen@#7 = "";
                    #referen@#8 = "01.01.0000";
                    #referen@#9 = "";
                    #referen@#10 = "";
                    #referen@#17 = "";
                    #referen@#18 = "";
                    #referen@#21 = "";
               |FINSI;
               |GRABA 020#referen@.a;
          |FINSI;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |SINO;
          |MENAV "0000Error al cargar 'gesim002'";
     |FINSI;
|FPRC;

|PROCESO GesiLeeMaqui;
     |DDEF aAlfa;
     aAlfa = aAlfa + "gesim024";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          #referen@#0 = "FD";
          #referen@#1 = #0#20;
          #referen@#2 = #0#0;
          #referen@#3 = #0#1;
          |LEE 000#referen@.=;
          |SI FSalida = 0;
               eaMatri = #referen@#4;
          |SINO;
               eaMatri = "";
          |FINSI;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |SINO;
          |MENAV "0000Error al cargar 'gesim024'";
     |FINSI;
|FPRC;

|PROCESO GesiBorMaqui;
     |DDEF aAlfa;
     aAlfa = aAlfa + "gesim024";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          #referen@#0 = "FD";
          #referen@#1 = #0#20;
          #referen@#2 = #0#0;
          #referen@#3 = #0#1;
          |LEE 101#referen@.=;
          |SI FSalida = 0;
               |BORRA 020#referen@.a;
          |FINSI;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|PROCESO Precio7; |TIPO 7;
     |C_M #0Campo, 0, aAlfa;
     |SI #20#250 = "X"; aAlfa = "S";
          |SI aArtiPromo = #0#2;
               #0Campo = #0Campo + #0#46;
          |SINO;
               aArtiPromo = #0#2;
               #0#46 = 0;
          |FINSI;
     |FINSI;
|FPRC;
