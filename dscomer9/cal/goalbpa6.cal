|FICHEROS;
     goalbpa4 #0;
     goalbpa5 #1;
     goalbpa6 #2;
     gopre003 #3;
     gomantli #4;
     gopre004 #5;
     agifa019 #6;
     agifa024 #7;
     gopre001 #8;
     agifa324 #9;
     gomantca #10;
     goaux005 #11;
     goparame #12;
     gotmpalq #13;
     guerm025 #25;
     guerm026 #26;
     gomantho #30;
     dsm00054 #54;
     dsm00055 #55;
     agifa017 #17;
|FIN;
--------------------------------------------------------------------------------
|VARIABLES;
     &eaFicImpre = "";
     &eaPrograma = "";
     &eaSerExp = "";
     &enNumExp = 0;
     &enForma       = 0;
     nConta         = 0;
     nAlm1          = 0;
     nAlm2          = 0;
     &enEvento      = 1;
     &eaTipo        = "";
     &eaAsunto      = "";
     &eaOrigen      = "";
     aOpe           = "";
     aAlfa          = "";
     &eaSerPre      = "";
     &enNumPre      = 0;
     &eaCapi        = "";
     &eaParti       = "";
     &eaDesPa       = "";

     &Flag          = 0;
     &cCodMonDe     = "";
     &cCodMonA      = "";

     &cCodMonBase   = "";
     &cDesMonBase   = "";
     &cCodMonTrab   = "";
     &cDesMonTrab   = "";
     &cCodMonConv   = "";
     &cCodMonActu   = "";
     &cParam        = "";
     &cSerieExpe    = "";
     &cSeriePres    = "";
     &cModulo       = "";

     &nNumerExpe    = 0;
     &nNumerPres    = 0;
     &nEurComTrab   = 0;
     &nEurComBase   = 0;
     &nEurVenTrab   = 0;
     &nEurVenBase   = 0;
     &nPreComTrab   = 0;
     &nPreVenTrab   = 0;
     &nPreComBase   = 0;
     &nPreVenBase   = 0;
     &nPrecioComp   = 0;
     &nPrecioVent   = 0;
     &nLinLin       = 0;
     &nAbono        = 0;

     &xDocTras      = 0;
     &xFecDocu      = @;
     &xLinDocu      = 0;
     &xCodArti      = "";
     &xDesArti      = "";
     &xSerie        = "";
     &xCanArti      = 0;
     &xAlmEntr      = 0;
     &xAlmSali      = 0;
     &xModo         = 0;
     &xForma        = 0;

     nEurMonPres    = 0;
     nModo          = 0;
     nPrecio        = 0;
     nSalida        = 0;
     nLin           = 0;
     nCantidad      = 0;
     nBotF20        = 0;
     nBotF21        = 0;

     cLin           = "";

     cAlfa          = "";
     nHay           = 0;
|FIN;
--------------------------------------------------------------------------------
|PROCESO EnviaCorreo;
     enEvento = 8; eaTipo = "08";
     eaAsunto = "Adj. Reserva Almacen. '" + #0#0 + "/" + (("000000" + #0#1) % -106);
     eaAsunto = eaAsunto + "' por Usuario: '" + (Usuario % 810);
     eaOrigen = #25#13;
     eaPrograma = "goalbpa4" + #0#0 + #0#1;

     |DBASS aAlfa;
     eaFicImpre= aAlfa + "spool/";
     aAlfa = Usuario;
     eaFicImpre = eaFicImpre + aAlfa;
     |HAZ Impresion;
     |HAZ EnviaEvento;
     eaFicImpre = "";
|FPRC;

|PROCESO HistoRese;
     |ABRE #30;
     #30#0 = #2#2;
     #30#1 = #2#3;
     |LEE 020#30=;
     |CIERRA #30;

     |ABRE #26;
     |LEE 000#26u;
     #26#0 = #26#0 + 1;
     #26#1 = ~;
     #26#2 = Usuario % 810;
     #26#3 = aOpe;
     #26#4 = #0#0;
     #26#5 = #0#1;
     #26#6 = #0#2;
     #26#7 = #2#2;
     #26#8 = #2#3;
     #26#9 = #30#30;
     #26#10 = #30#31;
     #26#11 = #1#3;
     #26#12 = #1#4;
     #26#13 = #2#10;
     #26#14 = 0;
     #26#15 = 0;
     #26#16 = "N";
     #26#17 = Usuario % 810;
     |GRABA 020#26n;
     |CIERRA #26;
|FPRC;

|PROCESO TipoEnt; |TIPO 2;
     nModo = (FEntrada/100)!0;
     |SI nModo = 1; |Y #1#8 = #12#51; || Al. Depo
          |ABRE #25;
          |SELECT #3#25;
          #25#7 = #1#3;
          #25#3 = #2#2;
          #25#4 = #2#3;
          |LEE 101#25=;
          |SI FSalida = 0;
               |SI #2#10 > #25#9;
                    aAlfa = "0000Se superan las unidades reservadas: " + #25#9;
                    |MENAV aAlfa;
                    |ERROR;
                    |ACABA;
               |FINSI;
               |SI #2#10 = #25#9;
                    aOpe = "B";
                    |BORRA 020#25a;
               |FINSI;
               |SI #2#10 < #25#9;
                    aOpe = "M";
                    #25#9 = #25#9 - #2#10;
                    |GRABA 020#25a;
               |FINSI;
               |HAZ HistoRese;
               |HAZ EnviaCorreo;
          |SINO;
               |MENAV "0000No hay unidades reservadas....";
               |ERROR; |ACABA;
          |FINSI;
          |CIERRA #25;
     |FINSI;

     #1#6 = #1#6 +. #2#10;
     #1#7 = #1#5 - #1#6;
     |GRABA 020#1a;

     |PINTA #2#11;|PINTA #2#12;|PINTA #2#13;
     |PINTA #2#14;|PINTA #2#22;|PINTA #2#23;
     |PINTA #2#24;|PINTA #2#25;
     Flag   = 0 +. 1;

     xForma = 0 +. 1;
     xSerie   = #0#0;
     xDocTras = #0#1;
     xFecDocu = #0#2;
     xLinDocu = #2#35;
     xCodArti = #1#3;
     xDesArti = #1#4;
     xCanArti = #2#10;
     xAlmEntr = #2#17;
     xAlmSali = #1#8;

     |SI nModo = 1;|O nModo = 2;
          |HAZ ModiMate2;
/*
          |SI #1#8 ! #2#17;
               |SUB_EJECUTA_NP "gomoval1";
          |FINSI;
          #2#19 = xDocTras;
          #2#32 = xSerie;
          #2#35 = xLinDocu;

          #1#11 = xDocTras;
          |GRABA 020#1a;
*/
          |ABRE #12;
          |DDEFECTO #12;
          #12#0 = "A";
          |LEE 000#12=;

          |SI FSalida ! 0;
               |MENAV "0000HAY QUE DAR DE ALTA LOS PARAMETROS";
               |PUSHV 01012380;
               |CLS;
               |PINPA #0#12;
               |PINDA #0#12;
               |ENDATOS #1#12;

               |SI FSalida = 0;
                    |GRABA 020#12c;
               |FINSI;

               |POPV;
          |FINSI;

          |SI #2#26 = #12#36;
               |HAZ ModiPalet;
          |FINSI;

          |SI #2#26 = #12#37;
               |HAZ ModiSacas;
          |FINSI;

          |SI #2#26 = #12#38;
               |HAZ ModiAlqu;
          |FINSI;

          |SI #2#26 = #12#39;
               |HAZ ModiCase;
          |FINSI;

     |FINSI;

     |SI nModo = 3;
          |HAZ BajaMate2;
          |SI #1#8 ! #2#17;
               |SUB_EJECUTA_NP "gomoval1";
          |FINSI;
          |SI #2#26 = #12#36;
               |HAZ BajaPalet2;
          |FINSI;

          |SI #2#26 = #12#37;
               |HAZ BajaSacas2;
          |FINSI;

          |SI #2#26 = #12#38;
               |HAZ BajaAlqu2;
          |FINSI;

          |SI #2#26 = #12#39;
               |HAZ BajaCase2;
          |FINSI;

     |FINSI;
     |CIERRA #12;

     |HAZ CalcuGopartia;
|FPRC;
--------------------------------------------------------------------------------
|PROCESO LisPart; |TIPO 0;
     eaSerPre = #2#0;
     enNumPre = #2#1;
     eaCapi = #2#33;
     eaParti = #2#8;

     |HAZ GuerPartid;
     |SI eaParti ! "";
          #2#33 = eaCapi;
          #2#8 = eaParti;
          #2#9 = eaDesPa;
          |PINTA #2#8;
          |PINTA #2#9;
     |FINSI;
     #2#29 = "M";                       ||Tipo Docume.(materiales).
|FPRC;
--------------------------------------------------------------------------------
|PROCESO LisPres; |TIPO 0;
     nSalida = FSalida;
     |ABRE #4;
     |SI nSalida = 10;
          |DDEFECTO #4;
          |CONSULTA_F_CLAVE #1#4, MinPresu, MaxPresu;
          |SI FSalida ! 0;
               |ERROR; |ACABA;
          |SINO;
               #2#0 = #4#3;                       ||Serie Pres.
               #2#1 = #4#4;                       ||Nº Pres.
               #2#2 = #4#0;                       ||Seire Expe.
               #2#3 = #4#1;                       ||Nº Expe.
               |PINTA #2#0;|PINTA #2#1;
          |FINSI;
     |FINSI;
     |CIERRA #4;

     |ABRE #4;
     |SELECT #2#4;
     #4#3 = #2#0;                            ||serie Pres.
     #4#4 = #2#1;                            ||Nº Pres.
     #4#0 = #2#2;                            ||Serie Exp.
     #4#1 = #2#3;                            ||Nº Exp.
     |LEE 000#4=;
     |SI FSalida ! 0;
          |MENAV "0000PRESUPUESTO INEXISTENTE EN EL EXPEDIENTE";
          |ERROR; |ACABA;
     |FINSI;
     |CIERRA #4;

     eaSerPre = #2#0;
     enNumPre = #2#1;
     eaSerExp = #2#2;
     enNumExp = #2#3;
     |HAZ EstadoObra;
     |SI FSalida ! 0; |ERROR; |FINSI;
|FPRC;
--------------------------------------------------------------------------------
|PROCESO DatAlb; |TIPO 0;

     #2#4 = #1#0;                       ||Serie Albaran.
     #2#5 = #1#1;                       ||Nº Albaran.
     #2#6 = #1#2;                       ||Linea Albaran.
     #2#20 = #1#3;                      ||Codigo Articulo.
     #2#28 = #0#2;                      ||Fecha Documento.
     #2#29 = "M";                       ||Tipo Docume.(materiales).
     #2#30 = #1#4;                      ||Descricpcion Articulo.

|FPRC;
-------------------------------------------------------------------------------
|PROCESO MinPartid;
     #3#0 = #2#0;                                 ||Serie Pres.
     #3#1 = #2#1;                                 ||Nº Pres.
     #3#3 = 1;                                    ||Linea.
|FPRC;
--------------------------------------------------------------------------------
|PROCESO MaxPartid;
     #3#0 = #2#0;                                 ||Serie Pres.
     #3#1 = #2#1;                                 ||Nº Pres.
     #3#3 = 999;                                  ||Linea.
|FPRC;
--------------------------------------------------------------------------------
|PROCESO MinPresu;
     #4#0 = #2#2;                                 ||Expediente.
     #4#1 = #2#3;                                 ||Numero Expediente.
     #4#2 = 1;                                    ||Linea.
|FPRC;
--------------------------------------------------------------------------------
|PROCESO MaxPresu;
     #4#0 = #2#2;                                 ||Expediente.
     #4#1 = #2#3;                                 ||Numero Expediente.
     #4#2 = 999;                                  ||Linea.
|FPRC;
--------------------------------------------------------------------------------
|PROCESO MiraParti; |TIPO 0;
     |ABRE #3;
     |SELECT #4#3;
          #3#0 = #2#0;                            ||Serie Pres.
          #3#1 = #2#1;                            ||Nº Pres.
          #3#4 = #2#8;                            ||Partida.
     |LEE 000#3=;

     |SI FSalida ! 0;
          |MENAV "0000NO EXISTE LA PARTIDA EN ESTE PRESUPUESTO";
          |ERROR10;
     |SINO;
          cCodMonTrab = #2#21;
          |HAZ MonBas;
          |ABRE #5;
          |SELECT #3#5;
          #5#0 = #3#0;                            ||Serie Pres.
          #5#1 = #3#1;                            ||Nº Pres.
          #5#3 = #3#4;                            ||Partida.
          #5#5 = #1#3;                            ||Cod. Articulo.
          |LEE 000#5=;

          |SI FSalida ! 0;
               |ABRE #12;
               #12#0 = "A";
               |LEE 000#12=;

               |SI #12#28 = "S";
                    |CONFI "0000NEL ARTICULO INTRODUCIDO NO SE ENCUENTRA EN LA PARTIDA. ¨CONTINUAR?";

                    |SI FSalida = -1;
                         |ERROR10;
                         |ACABA;
                    |FINSI;

               |FINSI;

               |CIERRA #12;
               nPrecio = 0;
               |ABRE #7;
               #7#0 = #2#15;                 ||Cliente.
               |LEE 000#7=;

               |SI FSalida = 0;
                    |ABRE #6;
                    #6#0 = #1#3;             ||Articulo.
                    |LEE 000#6=;

                    |SI FSalida = 0;
                         |SI #7#39 = 1; nPrecio = #6#18; |FINSI;
                         |SI #7#39 = 2; nPrecio = #6#19; |FINSI;
                         |SI #7#39 = 3; nPrecio = #6#20; |FINSI;
                         |SI #7#39 = 4; nPrecio = #6#147;|FINSI;
                         |SI #7#39 = 5; nPrecio = #6#148;|FINSI;
                         |SI #7#39 = 6; nPrecio = #6#149;|FINSI;
                    |FINSI;

                    |CIERRA #6;

               |FINSI;
               |CIERRA #7;
/*
               nPrecio = nPrecio * nAbono;
               cCodMonTrab = #2#21;
               |HAZ MonBas;
               cCodMonDe = cCodMonBase;             ||Moneda Base
               cCodMonA  = #2#21;                   ||Moneda Expediente
               nPrecioVent = nPrecio;               ||Ultimo Precio Compra
               |HAZ DemonAmon;
               #2#11 = nPrecioVent;                 ||P.Venta Trab.
               #2#22 = nPrecio;                     ||P.Venta Base.
          |SINO;
               ||nPrecioVent = (#5#9>#5#13)*nAbono;
               nPrecioVent = #5#11*nAbono;
               #2#11 = nPrecioVent;               ||P.Venta Trab. Pres.
               #2#22 = nPrecioVent;               ||P.Venta Base. Pres.
          |FINSI;
          |CIERRA #5;
          cCodMonDe = cCodMonBase;             ||Moneda Base
          cCodMonA  = #2#21;                   ||Moneda Expediente
          nPrecioComp = #1#9;                  ||Ultimo Precio Compra
          |HAZ DemonAmon;
          #2#12 = nPrecioComp;                 ||P.Compra Trab Pres.
          #2#23 = #1#9;                        ||P.Compra Base Pres.
*/
               cCodMonTrab = #2#21;
               #2#37 = nPrecio * nAbono;
          |SINO;
               nPrecioVent = #5#11*nAbono;
               #2#37 = #5#11*nAbono;
          |FINSI;
          #2#38 = 0;
          #2#39 = 0;
          #2#40 = 0;
          |CIERRA #5;

          #2#41 = #1#9;
          #2#42 = 0;
          #2#43 = 0;
          #2#44 = 0;
          |HAZ CalcuGopartia;

          |PINTA #2#11;
          |PINTA #2#12;
     |FINSI;

     |CIERRA #3;
|FPRC;
--------------------------------------------------------------------------------
|PROCESO Cantidades; |TIPO 0;
     |ABRE #12; |LEE 000#12p; |CIERRA #12;
     nCantidad = #2#10+#1#6;

     |SI nCantidad > #1#5;
          |MENAV "0000ESTA ASIGNANDO MAS CANTIDAD QUE LA RECIBIDA";
          |ERROR;
          |ACABA;
     |FINSI;
     |SI #1#8 = #12#51; || Al. Depo
          |DDEFECTO #25;
          |ABRE #25;
          |SELECT #3#25;
          #25#7 = #1#3;
          #25#3 = #2#2;
          #25#4 = #2#3;
          |LEE 000#25=;
          |CIERRA #25;
          |SI #2#10 > #25#9;
               aAlfa = "0000Se superan las unidades reservadas: " + #25#9;
               |MENAV aAlfa;
               |ERROR;
               |ACABA;
          |FINSI;
          |SI #2#10 < #25#9;
               |CONFI "2400NDespreciar unidades reservadas";
               |SI FSalida = 0;
                    |HAZ ReservaBaja;
                    |HAZ EventoResBaja;
               |FINSI;
          |FINSI;
     |FINSI;

     |ABRE #6;
     #3#0 = #2#20;
     |LEE 000#6=;
     |SI FSalida = 0;
          #2#26 = #6#200;                         ||Grupo de Articulo.
     |FINSI;
     |PINTA #2#26;
     |CIERRA #6;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO MiraPro; |TIPO 0;
     nModo = (FEntrada/100)!0;

     |SI xModo = 4;
          |ERROR10;
          |ACABA;
     |FINSI;

     |SI #1#7 = 0; |Y nModo = 1;
          |MENAV "0000EL ARTICULO ESTA TOTALMENTE ASIGNADO";
          |ERROR;
          |ACABA;
     |FINSI;

     |SI cSerieExpe ! "";

          |SI nModo = 2; |O nModo = 3;

               |SI cSerieExpe ! #2#2; |O nNumerExpe ! #2#3;
                   |MENAV "0000EL EXPEDIENTE NO CORRESPONDE";
                   |ERROR10;
                   |ACABA;
               |FINSI;

               |SI cSeriePres ! #2#0; |O nNumerPres ! #2#1;
                   |MENAV "0000EL PRESUPUESTO NO CORRESPONDE";
                   |ERROR10;
                   |ACABA;
               |FINSI;

          |FINSI;

          #2#0 = cSeriePres;
          #2#1 = nNumerPres;
          #2#2 = cSerieExpe;
          #2#3 = nNumerExpe;
          |C_M #2#0, 1, "N";|C_M #2#2, 1, "N";
          |C_M #2#1, 1, "N";|C_M #2#3, 1, "N";
     |FINSI;

|FPRC;
-------------------------------------------------------------------------------
|PROCESO DatExp; |TIPO 0;
     |ABRE #10;
     #10#0 = #2#2;
     #10#1 = #2#3;
     |LEE 000#10=;

     |SI FSalida = 0;
          #2#15 = #10#2;                ||Codigo Cliente.
          #2#16 = #10#8;                ||Nombre Cliente.
          #2#17 = #10#11;               ||Almacen Entrada.
          #2#18 = #10#12;               ||Nombre Almacen.
          #2#21 = #10#6;                ||Moneda de Trabajo.
     |FINSI;

     |CIERRA #10;
     |PINTA #2#0;|PINTA #2#1;|PINTA #2#2;|PINTA #2#3;
     |PINTA #2#17;|PINTA #2#18;|PINTA #2#21;
|FPRC;
-------------------------------------------------------------------------------
|PROCESO PreVen; |TIPO 0;
     |SI #goparame#77 = "N"; |ACABA; |FINSI;

     |SI #2#11 < 0;
          |ACABA;
     |FINSI;

     cCodMonTrab = #2#21;
     |HAZ MonBas;
     cCodMonDe = #2#21;                   ||Moneda Expediente
     cCodMonA  = cCodMonBase;             ||Moneda Base
     nPrecioVent = #2#11;                 ||Ultimo Precio Venta
     |HAZ DemonAmon;

     #2#22 = nPrecioVent;                 ||P.Venta Base. Pres.
     |ABRE #7;
     #7#0 = #2#15;                 ||Cliente.
     |LEE 000#7=;

     |SI FSalida = 0;
          |ABRE #6;
          #6#0 = #1#3;             ||Articulo.
          |LEE 101#6=;

          |SI FSalida = 0;
               |SI #7#39 = 1; #6#18  = #2#22;|FINSI;
               |SI #7#39 = 2; #6#19  = #2#22;|FINSI;
               |SI #7#39 = 3; #6#20  = #2#22;|FINSI;
               |SI #7#39 = 4; #6#147 = #2#22;|FINSI;
               |SI #7#39 = 5; #6#148 = #2#22;|FINSI;
               |SI #7#39 = 6; #6#149 = #2#22;|FINSI;
               |GRABA 020#6a;
          |FINSI;

          |LIBERA #6;
          |CIERRA #6;
          #2#22 = #2#22*nAbono;
          |PINTA #2#22;
     |FINSI;

     |CIERRA #7;
|FPRC;
-------------------------------------------------------------------------------
|PROCESO MonePres; |TIPO 7;
     cCodMonTrab = #2#21;
     |HAZ MonBas;
|FPRC;
-------------------------------------------------------------------------------
|PROCESO BIal3; |TIPO 80;
     |CLS;
     |CONTROL_SIMPLE 0, "BOTON,F2 - Presupuestos de Expediente", 2430, 2460, F2al3;
     nBotF20 = FSalida;
     |ESTADO_CONTROL nBotF20, "HIDE"; ||"SHOW""HIDE""ENABLE""DISABLE".

     |CONTROL_SIMPLE 0, "BOTON,F2 - Partidas Presupuesto", 2435, 2455, F2al3;
     nBotF21 = FSalida;
     |ESTADO_CONTROL nBotF21, "HIDE"; ||"SHOW""HIDE""ENABLE""DISABLE".
|FPRC;
------------------------------------------------------------------------------
|PROCESO BFal3; |TIPO 90;
     |PULSATECLA;
     |FIN_CONTROL_WINDOWS nBotF20;
     |PULSATECLA;
     |FIN_CONTROL_WINDOWS nBotF21
     |PULSATECLA;
|FPRC;
------------------------------------------------------------------------------
|PROCESO BSal3; |TIPO 7;
     |SI Campo = 1; |O Campo = 0;
          |ESTADO_CONTROL nBotF20, "SHOW"; ||"SHOW""HIDE""ENABLE""DISABLE".
          |ESTADO_CONTROL nBotF21, "HIDE"; ||"SHOW""HIDE""ENABLE""DISABLE".
     |FINSI;
     |SI Campo = 8;
          |ESTADO_CONTROL nBotF20, "HIDE"; ||"SHOW""HIDE""ENABLE""DISABLE".
          |ESTADO_CONTROL nBotF21, "SHOW"; ||"SHOW""HIDE""ENABLE""DISABLE".
     |FINSI;
|FPRC;
-------------------------------------------------------------------------------
|PROCESO BHal3; |TIPO 7;
     |ESTADO_CONTROL nBotF20, "HIDE"; ||"SHOW""HIDE""ENABLE""DISABLE".
     |ESTADO_CONTROL nBotF21, "HIDE"; ||"SHOW""HIDE""ENABLE""DISABLE".
|FPRC;
-------------------------------------------------------------------------------
|PROCESO F2al3;
     |PTEC 824;
|FPRC;
-------------------------------------------------------------------------------
|PROCESO sacamon; |TIPO 14;
     cCodMonTrab = #2#21;
     |HAZ MonBas;
|FPRC;
ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
|PROCESO ReservaAlma;
     |ABRE #25;
     |SELECT #3#25;
     #25#7 = #1#3;
     #25#3 = #2#2;
     #25#4 = #2#3;
     |BORRA 020#25c;
     |CIERRA #25;
|FPRC;

|PROCESO HistoRece;
     |ABRE #26;
     |LEE 000#26u;
     |SI FSalida = 0;
          nConta = #26#0 + 1;
     |SINO;
          nConta = 1;
     |FINSI;
     |DDEFECTO #26;

     #26#0 = nConta;
     #26#1 = ~;
     #26#2 = Usuario % 810;
     #26#3 = "B";
     #26#4 = #25#0;
     #26#5 = #25#10;
     #26#6 = #0#2;
     #26#7 = #2#2;
     #26#8 = #2#3;
     #26#9 = #30#30;
     #26#10 = #30#31;
     #26#11 = #1#3;
     #26#12 = #1#4;
     #26#13 = #25#9 - #2#10;
     #26#14 = #25#10;
     #26#15 = #25#11;
     #26#16 = #25#12;
     #26#17 = Usuario % 810;
     |GRABA 020#26n;
     |CIERRA #26;
|FPRC;

|PROCESO MoviAlma;
     nAlm2 = #12#22;
     nAlm1 = #12#51;

     |ABRE #54;
     #54#2 = #2#2;
     #54#0 = 999999;
     |LEE 000#54];
     |SI FSalida = 0;
          |LEE 000#54a;
     |SINO;
          |LEE 000#54u;
     |FINSI;
     |SI FSalida = 0; |Y #54#2 = #2#2;
          nConta = #54#0 + 1;
     |SINO;
          nConta = 1;
     |FINSI;
     |DDEFECTO #54;
     #54#0 = nConta;
     #54#1 = ~;
     #54#2 = #2#2;
     |GRABA 020#54n;
     |CIERRA #54;

     |ABRE #55;
     #55#0 = #1#3;
     #55#1 = nAlm1;    ||Alm Sal = Comp
     #55#2 = #1#4;

     |ABRE #6;
     #6#0 = #1#3;
     |LEE 000#6=;
     |CIERRA #6;

     |ABRE #17;
     #17#0 = #1#3;
     #17#1 = nAlm2;
     |LEE 000#17=;

     #55#7 = #6#6;
     #55#3 = #17#5;
     #55#4 = #25#9 - #2#10;
     #55#5 = nAlm2;    ||Alm Ent = Depo
     #55#9 = #17#41;

     #17#1 = nAlm2;
     |LEE 000#17=;
     |CIERRA #17;

     #55#6 = #17#5;
     #55#8 = ~;
     #55#10 = #17#41;
     #55#11 = 1;
     #55#27 = #54#0;
     #55#28 = #54#2;
     |GRABA 020#55n;
     |CIERRA #55;
     enForma = 1;
     |HAZ AcumulaME_MS;
|FPRC;

|PROCESO ReservaBaja;
     |ABRE #30;
     #30#0 = #2#2;
     #30#1 = #2#3;
     |LEE 020#30=;
     |CIERRA #30;

     |HAZ ReservaAlma;
     |HAZ HistoRece;
     |HAZ MoviAlma;
|FPRC;

|PROCESO EventoResBaja;
     enEvento = 13; eaTipo = "13";
     eaAsunto = "Baja Deposito Expediente: "+ #2#2 + "/"+ (("000000" + #2#3) % -106);
     eaAsunto = eaAsunto + " Articulo: " + #1#3 + " " + #1#4;
     eaAsunto = eaAsunto + " Cantidad: " + (#25#9 - #2#10);
     eaOrigen = Usuario % 0810;
     eaPrograma = "goalbpa6" + #0#0 + #0#1;

     |DBASS aAlfa;
     eaFicImpre= aAlfa + "spool/";
     aAlfa = Usuario;
     eaFicImpre = eaFicImpre + aAlfa;
     |HAZ Impresion;
     |HAZ EnviaEvento;
     eaFicImpre = "";
|FPRC;
