|FICHEROS;
     gopre001 #0;
     gopre002 #1;
     gopre003 #2;
     goartive #4;

     gopre004 #3,MANTE;  || el gopre026 es una copia de este
                         || para mostrar el total de unidades
     gopre026 #26,MANTE; || = al gopre004

     goartivc #44;
     goartdes #5,MANTE;

     &gopre004@;    || referencia que carga el gopre004 o el gopre026

     agifa019 #6;                                 ||Articulos.
     agifa553 #7;                                 ||Linea.(Seccion)
     agifa060 #8;                                 ||Familia.
     agifa120 #9;                                 ||SubFamilia.
     agi00063 #10;                                ||Marca.(Capitulo)
     agifa321 #11;                                ||Parametros Divisa.
     agifa324 #12;                                ||Divisas.
     goparame #13;                                ||Parametros de Obras.
     agifa048 #14;                                ||Escandallos Cab.
     agifa049 #15;                                ||Escandallos Lin.
     goapaive #16;                                ||Apartados IVE
     gopatmen #17;                                ||Path ficheros IVE.
     godeivec #18;                                ||Desc. Ampliada (CAB)
     godeivel #19;                                ||Desc. Ampliada (LIN)
     gotmpart #20,MANTE;                          ||TEM. Partidas.
     gopre024 #24;
     gopre025 #25;
     goparam1 #30,MANTE;                          ||Seleccion Parametrico (1)
     goparam2 #31,MANTE;                          ||Seleccion Parametrico (2)
     goparam3 #32,MANTE;                          ||Seleccion Parametrico (3)
     goparam4 #33,MANTE;                          ||Seleccion Parametrico (4)
     gomedive #40;                                ||Unidades de Medida.
     gomedici #41,MANTE;                          ||Mediciones;
     guerw057 #57;
     godeprec #60;
     godeprel #61;
     gomedici@ #100;
     godeivec #101;
     godeivel #102;
     refer003@ #300;
     guerm044 #440;
     agifa048 #480;
     agifa049 #490;
|FIN;
------------------------------------------------------------------------------
|VARIABLES;
     nError = 0;
     nSwForestales = 0;
     nSwPrecio = 0;
     nPrecioCheq = 0;
     &enPrePar = 0;
     &enPrePVP = 0;
     &enUniFac = 0;
     aConte = "";
     &eaMarca = "";
     nTotal = 0;
     nNume = 0;
     nModi = 0;
     nSw = 0;
     nActBase = 0;
     aTieneEscan = "";
     nImpManual = 0;
     nDife = 0;
     &eaSw2Stock = "";
     &enModoVta = 0;
     &eaPartida = "";
     &eaArticulo = "";
     &eaArtiAnt = "";
     &enUnidad1 = 0;
     &enUnidad2 = 0;
     &enMedida1 = 0;
     &enMedida2 = 0;
     &enMedida3 = 0;
     aDPart = "";
     aHPart = "";
     nExistePartBlanco = 0;
     &enBotonAmpli = 0;
     nLon = 0;
     aDes = "";
     aLon = "";
     &Tempo = "";
     aPartida = "";
     nExiste = 0;
     Camino = "";
     nConta = 0;
     aPartiAnt = "";
     aGuarda        = "";
     &enSwCopia     = 0;
     &eaSer         = "";
     &enNum         = 0;
     &eaCap         = "";
     &eaPar         = "";
     &eaRefe        = "";
     &enPresu       = 0;
     nLin           = 0;
     aDef           = "";
     nMod           = 0;
     aVic           = "";
     aAlta          = "";
     aAlfa          = "";
     bAlfa          = "";
     cAlfa          = "";
     swPreEsp       = 0;
     nImcremento    = 0;
     &cCodMonBase   = "";
     &cCodMonTrab   = "";
     &cCodMonDe     = "";
     &cCodMonA      = "";
     &cCodMonConv   = "";
     &cCodMonActu   = "";
     &cDesMonBase   = "";
     &cDesMonTrab   = "";

     &nDeci_Medi    = 0;
     &nDeci_Incr    = 0;
     &nDeci_PBase   = 0;
     &nDeci_TBase   = 0;
     &nDeci_PTrab   = 0;
     &nDeci_TTrab   = 0;
     &nDeci_TotVis  = 0;
     &nEurComTrab   = 0;
     &nEurComBase   = 0;
     &nEurVenTrab   = 0;
     &nEurVenBase   = 0;
     &nPreComTrab   = 0;
     &nPreComBase   = 0;
     &nPreVenTrab   = 0;
     &nPreVenBase   = 0;
     &nPrecioComp   = 0;
     &nPrecioVent   = 0;
     &nErrorPar     = 0;

     &cEstado       = "";
     &eaCodigo      = "";
     &eaSerie       = "";
     &cDesc         = "";
     &cNivel        = "";
     &cSerie        = "";
     &cPartida      = "";
     &cDesParti     = "";
     &cCapitulo     = "";
     &cTitulo1      = "";
     &cTitulo2      = "";
     &cTitulo3      = "";
     &cTitulo4      = "";
     &cCombina      = "";
     &cCodPart      = "";
     &cParti        = "";
     &cPart         = "";
     &cPartAct      = "";
     &cCapitu       = "";

     &nNumero       = 0;
     &nImporte      = 0;
     &nCantidad     = 0;
     &eaNumero      = 0;
     &eaCapi        = "";

     cParam         = "";
     cFich          = "";
     cFich1         = "";
     cFich2         = "";
     cFich3         = "";
     cFich4         = "";
     cMensaje       = "";
     cUnid          = "";
     {500}fiebdc    = "";
     cLong          = "";
     cCadena        = "";
     cInicio        = "";
     cArti          = "";
     cIve           = "";
     cDescr         = "";
     cRefCap        = "";
     cDesCap        = "";
     cCodAct        = "";
     cMedida        = "";
     cSinCla        = "";
     cUsuario       = "";

     nModo          = 0;
     nSalida        = 0;
     nLinea         = 0;
     nPreAct        = 0;
     nIncrem        = 0;
     nPrecio        = 0;
     nTotDes        = 0;
     nDeciActual    = 0;
     nEscandallo    = 0;
     nBorDes        = 0;
     nPreDes        = 0;
     nPreArt        = 0;
     h              = 0;
     i              = 0;
     j              = 0;
     k              = 0;
     r              = 0;
     nCarac         = 0;
     nCadena        = 0;
     nInicio        = 0;
     nHay           = 0;
     nBanco         = 0;
     nModoAc        = 0;
     nTipo          = 0;
     nDecPre        = 0;
     nDecTot        = 0;
     nIncr          = 0;
     nBotAmpli      = 0;
     nBotCoste      = 0;
     nBotPorci      = 0;
     nBotDup        = 0;
     nBotSel        = 0;
     nBotParti      = 0;
     nBotIndic      = 0;
     nBotMedic      = 0;
     nBotSelec      = 0;
     nBotRePar      = 0;
     nBotTodas      = 0;
     nParametrico   = 0;
     nPreContenido  = 0;
     nIncContenido  = 0;
     nNume1 = 0;
     nNume2 = 0;
     aAlfa1 = "";
     aAlfa2 = "";
|FIN;
------------------------------------------------------------------------------

|PROCESO ParCap; |TIPO 7;
     /*Comprobamos si los precios pedidos so a venta o compra */
     |SI cEstado = "Venta";
          |C_V #3#9, 1, "S";
          |C_V #3#11,1, "S";                      ||Importe Venta Des.
          |C_V #3#13,1, "S";
          |C_V #3#10,1, "N";
          |C_V #3#12,1, "N";                      ||Importe Coste Des.
          |C_V #26#9, 1, "S";
          |C_V #26#11,1, "S";                      ||Importe Venta Des.
          |C_V #26#13,1, "S";
          |C_V #26#10,1, "N";
          |C_V #26#12,1, "N";                      ||Importe Coste Des.
          |ATRI R;
          |PINTA 1161, "Venta";
          |PINTA 1175, "Venta";
          |ATRI 0;
     |SINO;
          |C_V #3#9, 1, "N";
          |C_V #3#11,1, "N";                      ||Importe Venta Des.
          |C_V #3#13,1, "N";
          |C_V #3#10,1, "S";
          |C_V #3#12,1, "S";                      ||Importe Coste Des.
          |C_V #26#9, 1, "N";
          |C_V #26#11,1, "N";                      ||Importe Venta Des.
          |C_V #26#13,1, "N";
          |C_V #26#10,1, "S";
          |C_V #26#12,1, "S";                      ||Importe Coste Des.
          |ATRI R;
          |PINTA 1161, "Coste";
          |PINTA 1175, "Coste";
          |ATRI 0;
     |FINSI;

     |ATRI I;
     |PINTA 1002, #1#2;                           ||Linea.
     |PINTA 1006, #1#3;                           ||Capitulo.

     |C_A #1#4, 0, nLon;
     |C_A #1#4, 1, 11;
     |PINTA 1016, #1#4;                           ||Descripcion.
     |C_A #1#4, 1, nLon;

     |PINTA 1028, #1#5;                           ||U. Medida.
     |PINTA 1032, #1#6;                           ||Cantidad.
     cRefCap = #1#12;
     cDesCap = #1#13;
     cRefCap = cRefCap % 109;
     cDesCap = cDesCap % 130;
     |PINTA 0912, cRefCap;
     |PINTA 0922, cDesCap;

     |SI cEstado = "Venta";
          |PINTA 1042, #1#11;                     ||Incremento.
          |PINTA 1054, #1#7;                      ||Precio Venta.
          |PINTA 1067, #1#9;                      ||Importe Venta.
     |SINO;
          |PINTA 1054, #1#8;                      ||Precio Coste.
          |PINTA 1067, #1#10;                     ||Importe Coste.
     |FINSI;

     |ATRI 0;
     cDescr = #2#25; |QBF cDescr;
     |SI cDescr ! "";
          cDescr = #2#25 + "-" + #2#5;
     |SINO;
          cDescr = #2#3 + "-" + #2#5;
     |FINSI;
     cCodAct = #2#4;
     |ATRI P;
     |PINTA 2202, cDescr;
     |ATRI 0;

     |PINTA 2267, #1#9;                            ||Total Venta Pres.
     |PINTA 2367, #1#10;                           ||Total Compra Pres.
|FPRC;
------------------------------------------------------------------------------
|PROCESO Min4;
     #4#0 = aDPart;
|FPRC;

|PROCESO Max4;
     #4#0 = aHPart;
|FPRC;

|PROCESO Componentes; |TIPO 6;
     cAlfa = Contenido;
     |HAZ BH003;
     nModo = (FEntrada/100)!0;
     nSalida = FSalida;
     nModoAc = nModo;
     nParametrico = 0;

     |ABRE #13; |LEE 000#13p; |CIERRA #13;
     cSinCla = #13#25;

     /* F4 Entramos en Busqueda por indice.*/

     |SI nSalida = 12;
          cUsuario = Usuario % 103;
          |SUB_EJECUTA_NP "goindice;PRES";
          ||cParti = cPart;
          #2#4 = cPart;
          |HAZ BS003; |ERROR; |ACABA;
     |FINSI;

     /*   F5 - MOSTRAMOS LAS PARTIDAS DEL CAPITULO ACTUAL                             */

     |SI nSalida = 13;
          |SI #13#32 = "H";
               aDPart = #1#12; |QBF aDPart;
               aHPart = #1#12; |QBF aHPart;
               aDPart = (aDPart + (" " * 20)) % 120;
               aHPart = (aHPart + ("z" * 20)) % 120;
               |ABRE #4;
               |CONSULTA_F_CLAVE #1#4, Min4, Max4;
               |SI FSalida = 0;
                    #2#4 = #4#0;
               |FINSI;
               |CIERRA #4;
          |SINO;
               cCodPart = "";
               cCodAct = Contenido;
               aVic = #1#12 % 103;
               |HAZ ParCapitulo;
          |FINSI;

          |HAZ BS003; |ERROR; |ACABA;
     |FINSI;

     /* F6 Duplica Partida         */

     |SI nSalida = 14;
          eaSer = #2#0;
          enNum = #2#1;
          eaCap = #2#2;
          eaPar = #2#4;
          |GRABA 020#0a;
          |GRABA 020#1a;
          |SUB_EJECUTA_NP "guerz022";
          #2#4 = eaPar;
          |HAZ BS003; |ERROR; |ACABA;
     |FINSI;

     /* F7 Busqueda Subfamilia     */
     |SI nSalida = 15;
          |SUB_EJECUTA_NP "guerw057";
          #2#4 = eaPar;
          |HAZ BS003; |ERROR; |ACABA;
     |FINSI;

     /*   F9 - MOSTRAMOS TODAS LAS PARTIDAS                                           */

     |SI nSalida = 17;
          |ABRE #4;
          |DDEFECTO #4;
          cCodPart = "";
          |PUSHV 01012380;
          |CONSULTA_F_CLAVE #6#4, MinParCa, MaxParCa;
          |SI FSalida = 0;
               #2#4 = #4#0;
          |FINSI;
          |POPV;
          |CIERRA #4;
          |HAZ BS003; |ERROR; |ACABA;
     |FINSI;

     |HAZ ExistePartida;
     |SI nExiste ! 0; |ERROR; |ACABA; |FINSI;

     /*comprobamos si es un parametrico*/

     cParam = #2#4;
     |QBF cParam;
     cParam = cParam % -101;

     |SI cParam = "$";                            ||Es parametrico.
          cPart = #2#4;
          |QBF cPart;
          |HAZ Parametrico;

          |SI nErrorPar = 1;
               |HAZ BS003; |ERROR; |ACABA;
          |FINSI;

          #2#4 = cPartAct;
          |HAZ BS003; |ERROR; |ACABA;
     |FINSI;
     |SI aPartiAnt ! #2#4;          ||Cambio de la Partida existente por otra.
          |ABRE #3;
          |ABRE #4;
          #4#0 = #2#4;
          |LEE 000#4=;

          /* Comprobamos si existe la partida.                                          */

          |SI FSalida ! 0;
               |HAZ CreaParti;
               |SI nErrorPar = 1;
                    |ERROR; |ACABA;
               |FINSI;
          |FINSI;

           /* comprobamos si se ha cambiado la partida actual por otra distinta*/
          |QBF aPartiAnt;
          |SI aPartiAnt ! "";
               |HAZ Cambio;           ||Aviso y borra descomposicion.
               |SI nErrorPar = 1;
                    |HAZ BS003; |ERROR; |ACABA;
               |FINSI;
          |FINSI;

          /* realizamos el descompuesto en caso de haberlo */
          Contenido = aPartiAnt;
          |HAZ MiraDesg;                          ||Comprobamos si la partida tiene descomposicion.
          |SI nErrorPar = 1;
               |HAZ BS003; |ERROR; |ACABA;
          |FINSI;

          /* actualizamos los datos de linea de partida*/

          #2#5 = #4#1;                            ||Descripcion de Partida.
          #2#6 = #4#2;                            ||U.M.

          cCodMonDe = #4#5;                       ||Moneda Gopre001
          cCodMonA  = #0#7;                       ||Moneda Goartive
          nPrecioComp = #4#15;                    ||Ultimo Precio Compra
          |HAZ DemonAmon;

          || #2#7  = 0;                              ||Cantidad.
          #2#8  = nPrecioComp;                    ||Precio Venta.
          #2#10 = nPrecioComp;                    ||Importe Venta.
          #2#9  = #2#8;                           ||Precio Coste.
          #2#11 = #2#10;                          ||Importe Coste.
          #2#12 = #13#21;                         ||Incremento de Partida.

          |ABRE #440;
          #440#0 = #0#2;
          |LEE 000#440=;
          |SI FSalida = 0; |Y #440#1 ! 0;
               #2#12 = #440#1;     ||Incremento de Partida.
          |FINSI;
          |CIERRA #440;

          /*se actualizan los precios de partida y descomposicion.*/

          |HAZ ActPrecios;                        ||Actualizamos los precios.

          |PINTA #2#4;|PINTA #2#5;|PINTA #2#6;
          |PINTA #2#7;|PINTA #2#8;|PINTA #2#10;
          |PINTA #2#12;
          |CIERRA #13;

          |SI nErrorPar = 1;
               |HAZ BS003; |ERROR; |ACABA;
          |FINSI;
          |CIERRA #3;
          |CIERRA #4;
          |PTEC 802;|PTEC 802;
     |FINSI;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO CreaParti;
     eaPartida = "";
     |CONFI "0000SDESEA CREAR LA PARTIDA INTRODUCIDA";
     |SI FSalida = 0;
          eaPartida = #2#4;
         |SUB_EJECUTA_NP "goartive;ALTA";
     |FINSI;
     |SI eaPartida = "";
          nErrorPar = 1;
     |SINO;
          |LEE 020#4=;
          #2#4 = eaPartida; |PINTA #2#4;
     |FINSI;
|FPRC;
-------------------------------------------------------------------------------
|PROCESO MinComPar;
     #3#0 = #0#0;                                 ||Serie Pres.
     #3#1 = #0#1;                                 ||Nº. Pres.
     #3#2 = #1#12;                                 ||Capitulo.
     #3#3 = #2#4;                                 ||Partida.
     #3#4 = 1;                                    ||Linea.

     #26#0 = #0#0;                                 ||Serie Pres.
     #26#1 = #0#1;                                 ||Nº. Pres.
     #26#2 = #1#12;                                 ||Capitulo.
     #26#3 = #2#4;                                 ||Partida.
     #26#4 = 1;                                    ||Linea.
|FPRC;
-----------------------------------------------------------------------------
|PROCESO MaxComPar;
     #3#0 = #0#0;                                 ||Serie Pres.
     #3#1 = #0#1;                                 ||Nº. Pres.
     #3#2 = #1#12;                                 ||Capitulo.
     #3#3 = #2#4;                                 ||Partida.
     #3#4 = 999;                                  ||Linea.

     #26#0 = #0#0;                                 ||Serie Pres.
     #26#1 = #0#1;                                 ||Nº. Pres.
     #26#2 = #1#12;                                 ||Capitulo.
     #26#3 = #2#4;                                 ||Partida.
     #26#4 = 999;                                  ||Linea.
|FPRC;
-----------------------------------------------------------------------------
|PROCESO MinParCa;
||     #20#11 = #1#12;
     #20#11 = aVic;
     #20#0 = "                    ";

     #4#6 = cSinCla;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO MaxParCa;
||     #20#11 = #1#12;
     #20#11 = aVic;
     #20#0 = "zzzzzzzzzzzzzzzzzzzz";

     #4#6 = cSinCla;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO MinParTod;
     #4#1 = " "*50;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO MaxParTod;
     #4#0 = "z"*50;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO ActuPrec2;
     |HAZ CogeUniFac;
     #3#13 = #2#12;
     #3#10 = #3#9;                                ||Precio Compra.
     |SI #0#42 = "+";
          #3#11 = (#3#9 * enUniFac) > #3#13;            ||Importe Venta.
     |SINO;
          #3#11 = (#3#9 * enUniFac) / (1 - (#3#13 / 100));
     |FINSI;
     #3#12 = #3#10 * enUniFac;                    ||Importe Coste.
     #2#8  = #2#8 + #3#11;                        ||Precio Venta Partida.
     #2#9  = #2#9 + #3#12;                        ||Precio Coste Partida.
     |GRABA 020#3a;
|FPRC;
-----------------------------------------------------------------------------
|DEFBUCLE ActuPrec2;
     #3#1;
     ;
     #2#0, #2#1, #2#2, #2#4, 1;
     #2#0, #2#1, #2#2, #2#4, 999;
     ;
     NULL, ActuPrec2;
|FIN;
-----------------------------------------------------------------------------
|PROCESO CalLinPor; |TIPO 0;
     |SI #2#4 ! Contenido;
          |ABRE #44;
          #44#17 = #0#2;
          #44#0  = #2#4;
          |LEE 000#44=;
          |SI FSalida = 0;
              |SI #0#42 = "+";
                   nIncrem = ((#44#19-#44#15)/#44#15)*100; ||Calcula el Incremento.
              |SINO;
                   nIncrem = (1 - (#44#15/#44#19))*100;
              |FINSI;
              #2#12 = nIncrem;
              #2#8 = 0;
              #2#9 = 0;
              |BUCLE ActuPrec2;                            ||Actualizamos Precios Descomposicion.
              #2#10 = #2#7 * #2#8;                         ||Importe Total.
              #2#11 = #2#7 * #2#9;                         ||Importe Coste
          |FINSI;
          |CIERRA #44;

          |PINTA #2#10;
          |PINTA #2#9;
          |PINTA #2#12;
     |FINSI;
|FPRC;

|PROCESO CalLinPar; |TIPO 0;
     #2#10 = #2#7 * #2#8;                         ||Importe Venta
     #2#11 = #2#7 * #2#9;                         ||Importe Coste

     |SI #0#42 = "+";
          #2#12 = ((#2#8-#2#9)/#2#9)*100; ||Calcula el Incremento.
     |SINO;
          #2#12 = (1 - (#2#9/#2#8))*100;
     |FINSI;
     #2#13 = 0;                                   ||Importe Certificado.
     #2#14 = 0;                                   ||Unidades Certificadas.
     #2#15 = #2#7;                                ||Pendiente Certificar.
     #2#17 = 100;                                 ||Porcentaje total a certificar
     #2#19 = 100;                                 ||Porcentaje pendiente de certificar
     #2#20 = #2#10;                               ||Importe pendiente a certificar
     #2#22 = 0;                                   ||Cantidad SubContratada.
|FPRC;
-----------------------------------------------------------------------------
|PROCESO BajaPartDes;
     |BORRA 020#3a;

     #24#35 = #3#0;
     #24#36 = #3#1;
     #24#37 = #3#2;
     #24#38 = #3#3;
     #24#39 = #3#4;
     #24#0 = #3#5;
     |LEE 101#24=;
     |SI FSalida = 0;
          |BUCLELIN 1 NULL #24;
          |BORRA 020#24a;
          |LIBERA #24;
     |FINSI;
|FPRC;
-----------------------------------------------------------------------------
|DEFBUCLE BajaPartDes;
     #3#1;
     ;
     #2#0, #2#1, #2#2, #2#4, 1;
     #2#0, #2#1, #2#2, #2#4, 999;
     ;
     NULL, BajaPartDes;
|FIN;
-----------------------------------------------------------------------------
|PROCESO BajaMediPart;
     |BORRA 020#41a;
     |SI aAlta = "S";
          #41#3 = #2#4;
          |GRABA 000#41n;
     |FINSI;
|FPRC;
-----------------------------------------------------------------------------
|DEFBUCLE BajaMediPar;
     #41#1;
     ;
     #2#0, #2#1, #2#2, cAlfa , 1;
     #2#0, #2#1, #2#2, cAlfa , 999;
     ;
     NULL, BajaMediPart;
|FIN;
-----------------------------------------------------------------------------
|PROCESO CTotCap; |TIPO 2;
     |SI nError = 1; nError = 0; |ERROR; |ACABA; |FINSI;

     nModo = (FEntrada/100)!0;
     nTipo = 0 +. 1;
     cCodAct = #2#4;

     nModo = (FEntrada / 100) ! 0;


     |SI nModo = 3;
          |SI #2#14 ! 0;
               |SI nTipo = -1;
                    |MENAV "0000Partida con unidades certificadas";
               |FINSI;
               |ERROR; |ACABA;
          |FINSI;
     |FINSI;
     |SI nModo = 2;
          |SI #2#14 ! 0;
               |MENAV "0000Partida con unidades certificadas";
               aAlfa = "0000NLa modificación descuadrara la certificación a origen."+&13+"¿Continuar?";
               |CONFI aAlfa;
               |SI FSalida ! 0; nError = 1; |ERROR; |ACABA; |FINSI;
          |FINSI;
     |FINSI;

     |SI nTipo = -1; |Y nModo = 3;
          |CONFI "2400NDesea dar de baja la linea";
          |SI FSalida ! 0;
               |ERROR; |ACABA;
          |FINSI;
     |FINSI;

     |SI nModo = 3;
          cAlfa = #2#4;
          |BUCLE BajaMediPar;
          |ABRE #24;
          |BUCLE BajaPartDes;
          |CIERRA #24;
     |FINSI;

     #1#7  = #1#7 +. #2#10;                       ||Precio Venta Cap.
     #1#8  = #1#8 +. #2#11;                       ||Precio Coste Cap.
     #1#9  = #1#6 * #1#7;                         ||Importe Venta Cap.
     #1#10 = #1#6 * #1#8;                         ||Importe Coste Cap.
     |SI #0#42 = "+";
          #1#11 = ((#1#7-#1#8)/#1#8)*100;         ||Incremento en Capitulo.
     |SINO;
          #1#11 = (1 - (#1#8/#1#7))*100;
     |FINSI;

     |PINTA 2267, #1#9;                           ||Total Venta Pres.
     |PINTA 2367, #1#10;                          ||Total Compra Pres.
|FPRC;
-----------------------------------------------------------------------------
|PROCESO ActuPrec;
     |HAZ CogeUniFac;
     #3#13 = nIncrem;
     #3#10 = #3#9;                                ||Precio Compra.
     |SI #0#42 = "+";
          #3#11 = (#3#9 * enUniFac) > #3#13;            ||Importe Venta.
     |SINO;
          #3#11 = (#3#9 * enUniFac) / (1 - (#3#13 / 100));
     |FINSI;
     #3#12 = #3#10 * enUniFac;                    ||Importe Coste.
     #2#8  = #2#8 + #3#11;                        ||Precio Venta Partida.
     #2#9  = #2#9 + #3#12;                        ||Precio Coste Partida.
     |GRABA 020#3a;

     /* actualizamos los precios de la descomposcion del banco de datos */

     |SI nBanco = 1;                              ||Hemos solicitado cambio en banco de datos.
          |ABRE #4;
          #4#0 = #2#4;
          |LEE 000#4=;

          |SI FSalida = 0;
               |ABRE #5;                          ||Actualizo los componentes de la partida seleccionada.
               |SELECT #3#5;
               #5#0 = #2#4;
               #5#2 = #3#5;
               |LEE 010#5=;

               |SI FSalida = 0;
                    nPreAct = #5#7;
                    cCodMonDe = #0#7;             ||Moneda Gopre001
                    cCodMonA  = #4#5;             ||Moneda Goartive
                    nPrecioComp = #3#10;          ||Ultimo Precio Compra
                    |HAZ DemonAmon;
                    #5#6 = nPrecioComp;           ||Precio Compra Articulo.
                    #5#7 = #5#5 * #5#6;           ||Importe compra Articulo.
                    |GRABA 020#5a;
                    #4#15 = #4#15+(#5#7-nPreAct);
                    |GRABA 020#4a;
               |FINSI;

               |CIERRA #5;
          |FINSI;

          |CIERRA #4;
     |FINSI;
|FPRC;
-----------------------------------------------------------------------------
|DEFBUCLE ActuPrec;
     #3#1;
     ;
     #2#0, #2#1, #2#2, #2#4, 1;
     #2#0, #2#1, #2#2, #2#4, 999;
     ;
     NULL, ActuPrec;
|FIN;
-----------------------------------------------------------------------------
|PROCESO ActPrecios;
     nModo = (FEntrada/100)!0;

     nTotDes = #2#9;                              ||Total del Descompuesto.
     nIncrem = #2#12;                             ||Incremento realizado en Partida.
     #2#8 = 0;
     #2#9 = 0;
     nPreArt = 0;
     nBanco = 0;

     |BUCLE ActuPrec;                             ||Actualizamos Precios Descomposicion.
     #2#12 = nIncrem;
     |HAZ CalLinPar;
|FPRC;
--------------------------------------------------------------------------------
|PROCESO Precio0; |TIPO 7;

     |SI #2#8 = 0;

          |CONFI "0000SLA DESCOMPOSICION ESTA SIN PRECIOS. DESEA INTRODUCIRLOS";

          |SI FSalida = 0;
               |PUSHV 01012380;
               |SI #13#120 = "S";
                    |REFERENCIA_DEF gopre004@, #26;
                    |ENTLINEAL #1#26, 5, nModo, 21, 1, MinComPar, MaxComPar;
               |SINO;
                    |REFERENCIA_DEF gopre004@, #3;
                    |ENTLINEAL #1#3, 5, nModo, 21, 1, MinComPar, MaxComPar;
               |FINSI;
               |POPV;
               |PINTA #2#6;
               |PINTA #2#7;
               |PINTA #2#8;
               |PINTA #2#10;
          |FINSI;

          |SI #2#9 = 0;
               |C_M #2#8,  1, "N";
               |C_M #2#10, 1, "N";
               |C_M #2#12, 1, "N";
          |SINO;
               |C_M #2#8,  1, "S";
               |C_M #2#10, 1, "S";
               |C_M #2#12, 1, "S";
          |FINSI;

          Contenido = #2#8;
     |FINSI;

|FPRC;
-------------------------------------------------------------------------------
|PROCESO CambPrec7; |TIPO 7;
     nPreContenido = #2#8;
|FPRC;

|PROCESO CambPrec; |TIPO 0;
     |SI #2#8 ! nPreContenido;
          nImpManual = #2#8;
          |SI #2#8 < #2#9;
               |MENAV "0000ESTA POR DEBAJO DEL COSTE";
          |FINSI;
          cMensaje = "0000SEL PRECIO HA VARIADO. ¨DESA AJUSTARLO? (S/N)";
          |CONFI cMensaje;
          |SI FSalida = 0;
               nTotDes = #2#9;
               |HAZ AjusPrec;               ||Calculamos el incremento.
               |SI nIncrem > 999.999;
                    |MENAV "0000INCREMENTO SUPERIOR A 999,999%. DEBE INCREMENTAR LA DESCOMPOSICION";
                    |ERROR10;
                    #2#8 = nPreContenido;
                    |PINTA #2#8;
                    |ACABA;
               |FINSI;
               #2#12 = nIncrem;
               |HAZ ActPrecios;
               |PINTA #2#12;

               |SI nImpManual ! #2#8;
                    |MENAV "0000Cuadre automatico sin ajuste posible...";
                    |CONFI "0000NAjustar diferencia al primer articulo";
                    |SI FSalida = 0;
                         |HAZ Ajuste1Arti;
                    |FINSI;
               |FINSI;
          |SINO;
               #2#8 = nPreContenido;
               |PINTA #2#8;
               |ERROR10;
          |FINSI;

     |FINSI;

|FPRC;
-----------------------------------------------------------------------------
|PROCESO CambIncr7; |TIPO 7;
     nIncContenido = #2#12;
|FPRC;

|PROCESO CambIncr; |TIPO 0;
     nModo = (FEntrada/100)!0;

     |SI nModo = 1; |Y #2#12 ! nIncContenido;     ||Alta y ha cambiado el incremento.
          |HAZ ActPrecios;                        ||Actualizamos los precios al nuevo incremento.
          |ACABA;
     |FINSI;

     |SI #2#12 ! nIncContenido;
          cMensaje = "0000SEL INCREMENTO HA VARIADO ¨DESEA AJUSTARLO? (S/N)";
          |CONFI cMensaje;

          |SI FSalida = 0;
               |HAZ ActPrecios;
          |SINO;
               #2#12 = nIncContenido;
               |PINTA #2#12;
               nErrorPar = 1;
          |FINSI;

     |FINSI;

|FPRC;
-----------------------------------------------------------------------------
|PROCESO MiraDesg;
     |HAZ EsForestales;
     nSwForestales = FSalida;
     nSwPrecio = 0;

     |ABRE #6;
     nModo = (FEntrada/100)!0
     aTieneEscan = "N";
     |SI #4#4 = "S"; |Y Contenido ! #2#4; ||La partida tiene desglose y se ha cambiado de partida.
          nLinea = 0;
          |ABRE #5;
          |SELECT #2#5;
          #5#0 = #2#4;                            ||Cod. Partida.
          |LEE 000#5=;

          |PARA; |SI FSalida = 0; |HACIENDO;
               nLinea = nLinea + 1;
               |DDEFECTO #3;
               #3#0 = #2#0;                       ||Serie Pres.
               #3#1 = #2#1;                       ||Nº Presupuesto.
               #3#2 = #2#2;                       ||Cod. Capitulo.
               #3#3 = #2#4;                       ||Cod. Partida.
               #3#4 = #5#1;                       ||Linea.
               #3#5 = #5#2;                       ||C. Articulo.
               #3#8 = #5#5;                       ||Cantidad.

               |DDEFECTO #6;
               #6#0 = #3#5;
               |LEE 000#6=;
               |SI #6#179 = "S";   || con doble stock
                    #3#17 = #5#10;
                    #3#18 = #5#11; #3#19 = #5#12; #3#20 = #5#13;
               |FINSI;

               swPreEsp = 0;

               |SI #5#6 = 0;
                    cCodMonDe = #4#5;             ||Moneda Goartive
                    cCodMonA  = #0#7;             ||Moneda Gopre001
                    nPrecioComp = 0;              ||Precio Compra
                                                  ||No Hay precio.Posiblemente es parametrico.
                    |HAZ ParamIve;                ||Comprobamos si es parametrico.
               |SINO;
                    cCodMonDe = #4#5;             ||Moneda Goartive
                    cCodMonA  = #0#7;             ||Moneda Gopre001
                    nPrecioComp = #5#6;           ||Precio Compra
               |FINSI;

               nPrecioCheq = #6#149 - (#6#149 / 100 * #6#152);

               |SI nPrecioCheq ! nPrecioComp;
                    nSwPrecio = 1;
               |FINSI;

               |HAZ DemonAmon;
               nPrecio = nPrecioComp;

               #3#9  = nPrecio;                    ||Precio Venta.
               #3#10 = nPrecio;                    ||Precio Coste.
               #3#6  = #5#3;                       ||Descripcion.
               #3#7  = #5#4;                       ||U.M.

               |HAZ CogeUniFac;

               #3#12 = enUniFac*#3#10;                 ||Importe Coste.
               #3#11 = enUniFac*#3#9;                  ||Importe Venta.
               #3#14 = #5#8;                       ||Tipo.
               #3#15 = #5#9;                       ||Descripcion Tipo.

               |SI #13#5 = #3#14;
                    #2#16 = #2#16 + #3#8;         ||Unidades de Mano Obra.
               |FINSI;

               #3#21 = #3#8 * #2#7;     ||Uni.Totales
               |GRABA 040#3n;
               |HAZ Escandallo;

               |LEE 000#5s;

               |SI #5#0 ! #2#4;                   ||Ultimo articulo de descomposicion Partida.
                    FSalida = 1;
               |FINSI;

          |SIGUE;
          |CIERRA #5;

          |SI nSwForestales = 0; |Y nSwPrecio = 1;
               |HAZ ImpCambioPrecio;
          |FINSI;
     |FINSI;

     |SI #4#4 = "N"; |Y Contenido ! #2#4;         ||La partida no tiene descomposicion.
          |ABRE #3;
          |DDEFECTO #3;
          #3#0  = #2#0;                           ||Serie Pres.
          #3#1  = #2#1;                           ||Nº Presupuesto.
          #3#2  = #2#2;                           ||Cod. Capitulo.
          #3#3  = #2#4;                           ||Cod. Partida.
          #3#4  = 1;                              ||Linea.
          #3#5  = #4#0;                           ||C. Articulo.
          #3#6  = #4#1;                           ||Descripcion.
          #3#7  = #4#2;                           ||U.M.
          #3#8  = 1;                              ||Cantidad.
          cCodMonDe = #4#5;                       ||Moneda Goartive
          cCodMonA  = #0#7;                       ||Moneda Gopre001
          ||----------------------------------------------------------
          nPrecioComp = #4#15;                    ||Precio Compra
          nPrecioCheq = #6#149 - (#6#149 / 100 * #6#152);

          |SI nPrecioCheq ! nPrecioComp; |Y nSwForestales = 0;
               aAlfa = "0000Precio [" + #3#5 + "] Partida:" + nPrecioComp + " PVP6:" + nPrecioCheq;
               |MENAV aAlfa;
          |FINSI;

          |HAZ DemonAmon;

          #3#9  = nPrecioComp;                    ||Precio Venta.
          #3#10 = nPrecioComp;                    ||Precio Coste.
          #3#11 = nPrecioComp;                    ||Importe Venta.
          #3#12 = nPrecioComp;                    ||Importe Coste.
          #3#14 = #4#6;                           ||Tipo.
          #3#15 = #4#16;                          ||Descripcion Tipo.

          |SI #13#5 = #3#14;
               #2#16 = #2#16 + #3#8;              ||Unidades de Mano Obra.
          |FINSI;

          #6#0 = #3#5;
          |LEE 000#6=;
          |SI #6#179 = "S";   || con doble stock
               #3#17 = 1;
               #3#18 = 1; #3#19 = 1; #3#20 = 1;
          |FINSI;
          #3#21 = #3#8 * #2#7;
          |GRABA 040#3n;
          |HAZ Escandallo;
     |FINSI;

     |SI aTieneEscan = "S"; |Y #13#107 = "S";
          |MENAV "0000Existen articulos con escandallos en esta partida.";
     |FINSI;
     |CIERRA #6;
|FPRC;
-----------------------------------------------------------------------------

|PROCESO AjusPrec;
     nPreAct = #2#8;
     |SI #0#42 = "+";
          nIncrem = ((nPreAct-nTotDes)/nTotDes)*100; ||Calcula el Incremento.
     |SINO;
          nIncrem = (1 - (nTotDes/nPreAct))*100;
     |FINSI;
|FPRC;

-----------------------------------------------------------------------------
|PROCESO DAmpPar; |TIPO 11;
     |HAZ BH003;

     |SI FSalida = 10;
          cNivel  = "PAR";
          cSerie  = #0#0;
          nNumero = #0#1;
          cCapitulo = #1#12;
          cPartida = #2#4;
          cDesParti = #2#5;
          nCantidad = #2#7;

          |SI cEstado = "Venta";
               nImporte = #2#10;
          |SINO;
               nImporte = #2#11;
          |FINSI;

          |SUB_EJECUTA "gopre005";
          |ERROR;
          nModoAc = nModo;
          |HAZ BS003;
          nModo = nModoAc;
     |FINSI;


     |SI FSalida = 15;
          |HAZ RenumPar;
          |HAZ BS003;
          |ERROR;
          |ACABA;
     |FINSI;

     |SI FSalida = 16;
          eaCodigo = #2#4;
          cDesc    = #2#5;
          eaSerie  = #1#0;
          eaNumero = #1#1;
          eaCapi = #2#2;
          |HAZ Ampliada;
          |ERROR;
          nModoAc = nModo;
          |HAZ BS003;
          nModo = nModoAc;
     |FINSI;
     |SI FSalida = 17;
          nNume = (FEntrada / 100) ! 0;
          |SI nNume = 4;
               |MENAV "0000Opción no activa en consulta...";
          |SINO;
               |HAZ ActCostesPar;
               |ERROR;
               nModoAc = nModo;
               |HAZ BS003;
               nModo = nModoAc;
          |FINSI;
     |FINSI;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO RenumPar;
     cSerie = #0#0;
     nNumero = #0#1;
     cCapitu = #1#12;
     |SUB_EJECUTA_NP "goprenun";
     |PTEC 806;
|FPRC;
-------------------------------------------------------------------------------
|PROCESO GrabaArt;
     #4#0 = cArti;                                ||Para Fam. Sub. Sec. Cap.
     |LEE 000#4=;
     |SI FSalida = 0;

          |DDEFECTO #6;
          #6#0 = cArti;                           ||Cod. Articulo.
          |LEE 000#6=;
          |SI FSalida ! 0;
               |GRABA 020#6c;
          |FINSI;

          |DDEFECTO #7;
          #7#0 = #4#7;                            ||Seccion.
          |LEE 000#7=;
          |SI FSalida ! 0;
               #7#1 = #4#8;                       ||Descripcion Sec.
               |GRABA 020#7c;
          |FINSI;

          |DDEFECTO #8;
          #8#0 = #4#9;                            ||Familia.
          |LEE 000#8=;
          |SI FSalida ! 0;
               #8#1 = #4#10;                      ||Descripcion Fam.
               |GRABA 020#8c;
          |FINSI;

          |DDEFECTO #9;
          #9#0 = #4#11;                           ||Subfamilia.
          |LEE 000#9=;
          |SI FSalida ! 0;
               #9#1 = #4#12;                      ||Descricpcion Sub.
               |GRABA 020#9c;
          |FINSI;

          |DDEFECTO #16;
          #16#0 = #4#13;                          ||Capitulo.
          |LEE 000#16=;
          |SI FSalida ! 0;
               #16#1 = #4#14;                     ||Descricpcion Cap.
               |GRABA 020#16c;
          |FINSI;

          #6#1   = cDesc;                         ||Descripcion.
          #6#2   = #8#0;                          ||Familia.
          #6#3   = #9#0;                          ||Subfamilia.
          #6#5   = cUnid;                         ||Unidad Medida.
          #6#125 = #7#0;                          ||Seccion.
          #6#127 = #16#0;                         ||Capitulos.
          #6#201 = #4#30;

          |ABRE #40;
          #40#0 = #4#2;
          |LEE 000#40=;
          |SI FSalida = 0; |Y #40#12 = "S";
               #6#179 = "S";
          |SINO;
               #6#179 = "N";
          |FINSI;
          |CIERRA #40;

          |GRABA 020#6a;

     |FINSI;

|FPRC;
-----------------------------------------------------------------------------
|PROCESO GrabaEsca;
     |SELECT #2#15;
     #15#0 = #2#4;                                ||Codigo Escandallo.
     #15#2 = cArti;                               ||Codigo Articulo.
     |LEE 000#15=;

     |SI FSalida ! 0;
          nLinea = nLinea + 1;
          #15#1 = nLinea;
          |GRABA 020#15c
     |FINSI;

     #15#3 = #3#6;                                ||Descripcion.
     #15#4 = #3#8;                                ||Unidades.
     #15#5 = #3#9;                                ||Precio de Coste.
     #15#6 = #3#9*#3#8;                           ||Importe.
     |GRABA 020#15a;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO MiraLinea;
     nLinea = #15#1;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO Com019;

     |SI nEscandallo = 0; |Y #4#4 = "S";
          |DDEFECTO #14;
          #14#0 = #2#4;
          |LEE 000#14=;
          |SI FSalida ! 0;
               |GRABA 020#14c;
               nLinea = 0;
          |SINO;
               |BUCLELIN 2 MiraLinea #14;
          |FINSI;
          #14#1 = #2#5;                           ||Descripcion Escandallo.
          |GRABA 020#14a;
          nEscandallo = 1;
          cArti = #2#4;
          cDesc = #2#5;
          cUnid = #2#6;
          |HAZ GrabaArt;
          cArti = #3#5;
          cDesc = #3#6;
          cUnid = #3#7;
          |HAZ GrabaEsca;
     |FINSI;

     |SI #4#4 = "N";
          cArti = #2#4;
          cDesc = #2#5;
          cUnid = #2#6;
          |HAZ GrabaArt;
     |FINSI;

|FPRC;
-----------------------------------------------------------------------------
|DEFBUCLE Com019;
     #3#1;
     ;
     #2#0, #2#1, #2#2, #2#4,   1;
     #2#0, #2#1, #2#2, #2#4, 999;
     ;
     NULL, Com019;
|FIN;
-----------------------------------------------------------------------------
|PROCESO GrabAmpPre;
     #61#0 = #60#0;
     #61#1 = #60#1;
     #61#2 = #60#2;
     #61#3 = #19#1;
     #61#4 = #19#2;
     #61#5 = #60#4;
     |GRABA 020#61c;
|FPRC;
-------------------------------------------------------------------------------
|PROCESO DesAmpPre;
     |ABRE #60;
     |ABRE #61;
     #60#0 = #2#4;
     #60#1 = #2#0;
     #60#2 = #2#1;
     #60#3 = #2#5;
     #60#4 = #2#2;
     |LEE 000#60=;

     |SI FSalida ! 0;
          |GRABA 020#60c;
          |ABRE #18;
          #18#0 = #2#4;
          |LEE 000#18=;

          |SI FSalida = 0;
               |BUCLELIN 2 GrabAmpPre #18;
          |FINSI;

          |CIERRA #18;
     |FINSI;

     |CIERRA #60;
     |CIERRA #61;
|FPRC;
-------------------------------------------------------------------------------
|PROCESO M019; |TIPO 3;
     |ABRE #4;
     |ABRE #6;
     |ABRE #7;
     |ABRE #8;
     |ABRE #9;
     |ABRE #10;
     |ABRE #14;
     |ABRE #15;
     |ABRE #16;
     nEscandallo = 0;
     |BUCLE Com019;
     |CIERRA #4;
     |CIERRA #6;
     |CIERRA #7;
     |CIERRA #8;
     |CIERRA #9;
     |CIERRA #10;
     |CIERRA #14;
     |CIERRA #15;
     |CIERRA #16;
     |HAZ DesAmpPre;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO CPar; |TIPO 0;
     eaArtiAnt = #2#4;

     |HAZ BH003;
     nModo = (FEntrada/100)!0;

     |SI nModo = 4;
          |PUSHV 01012380;
          |SI #13#120 = "S";
               |REFERENCIA_DEF gopre004@, #26;
               |ENTLINEAL #1#26, 5, nModo, 21, 1, MinComPar, MaxComPar;
          |SINO;
               |REFERENCIA_DEF gopre004@, #3;
               |ENTLINEAL #1#3, 5, nModo, 21, 1, MinComPar, MaxComPar;
          |FINSI;
          |ERROR10;
          |POPV;
          Campo = 3;
          |HAZ BS003;
     |FINSI;

|FPRC;
------------------------------------------------------------------------------
|PROCESO BorraDesc;
     |BORRA 020#3a;

     #24#35 = #3#0;
     #24#36 = #3#1;
     #24#37 = #3#2;
     #24#38 = #3#3;
     #24#39 = #3#4;
     #24#0 = #3#5;
     |LEE 101#24=;
     |SI FSalida = 0;
          |BUCLELIN 1 NULL #24;
          |BORRA 020#24a;
          |LIBERA #24;
     |FINSI;
|FPRC;
------------------------------------------------------------------------------
|DEFBUCLE BorraDesc;
     #3#1;
     ;
     #2#0, #2#1, #2#2, aPartiAnt, 1;
     #2#0, #2#1, #2#2, aPartiAnt, 999;
     ;
     NULL, BorraDesc;
|FIN;
------------------------------------------------------------------------------
|PROCESO Cambio;
     nErrorPar = 0;
     |CONFI "0000NSE ELIMINARAN TODOS LOS DESCOMPUESTOS DE LA PARTIDA AL VARIAR ESTA";
     |SI FSalida = 0;
          |ABRE #24;
          |BUCLE BorraDesc;                  ||Borra la descomposicion.gopre004
          |CIERRA #24;
          aAlfa = #2#6;
          bAlfa = #4#2;
          |QBF aAlfa;
          |QBF bAlfa;
          |SI aAlfa = bAlfa;
               cAlfa = aPartiAnt;
               |CONFI "0000NDesea borrar las mediciones actuales?";
               |SI FSalida =  0;
                    aAlta = "N";
                    |BUCLE BajaMediPar;                ||Borra las Medidas de Partida.
                    #2#7 = 0;
               |SINO;
                    aAlta = "S";
                    |BUCLE BajaMediPar;
                    aAlta = "N";
               |FINSI;
          |SINO;
               aAlfa = "N";
               |BUCLE BajaMediPar;
               #2#7 = 0;
          |FINSI;
     |SINO;
          nErrorPar = 1;
     |FINSI;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO ParamIve;
     i = 0;

     |PARA j = 101; |SI j < 601; |HACIENDO j = j + 100;
          k = -j
          i = i + 1;
          cParam = #5#2;
          |QBF cParam;
          cIve = #5#2;
          cIve = cIve - "$";
          |QBF cIve;
          cParam = cParam % k;

          |SI cParam = "$";
               |SAL;
          |FINSI;

          |SI cParam ] "0"; |Y cParam [ "9";
               cLong = #5#2;
               |QBF cLong;
               cLong = cLong % 0;
               k = cLong;
               k = (k - i) + 1;
               k = k + 100;
               cParam = #5#2 % k;
               cParam = cParam + "$";
               |SAL;
          |FINSI;

     |SIGUE;

     fiebdc1 = "PARAMETROS";
     fiebdc2 = 400;
     fiebdc3 = cParam;|QBF fiebdc3;
     |ESPECIFICA "FIEBDC",fiebdc;

     |SI FSalida < 0;
          ||MENAV "0000Error o no es parametrico!";
     |SINO;
          fiebdc1 = "PARAMETRICO";
          fiebdc2 = 400;
          fiebdc3 = #5#2;|QBF fiebdc3;
          fiebdc6 = "";
          fiebdc7 = "";
          |ESPECIFICA "FIEBDC",fiebdc;

          |SI FSalida < 0;
               aAlfa = "0000Error en parametrico! ("+ fiebdc4 +")"+fiebdc5;
               |MENAV aAlfa;
               nErrorPar = 1;
          |SINO;
               nErrorPar = 0;
               |SALVA_FICHA #4;
               #4#0 = cParam;
               |LEE 000#4=;

               |SI FSalida = 0;
                    #5#4 = #4#2;                  ||U.M.
                    #5#8 = #4#6;                  ||Tipo Componente.
                    #5#9 = #4#16;                 ||Descricpcion Tipo.
               |FINSI;

               |REPON_FICHA #4;
               #3#6 = fiebdc27;                   ||Descripcion.
               nPrecio = fiebdc28;                ||Precio.

               cCodMonDe = #4#5;                  ||Moneda Goartive
               cCodMonA  = #0#7;                  ||Moneda Gopre001
               nPrecioComp = nPrecio;             ||Precio Compra
               |HAZ DemonAmon;
               nPrecio = nPrecioComp;             ||Precio Compra en Mon.Trab.

               #5#3 = #3#6;                       ||Descripcion en Escandallo.
               |GRABA 020#5a;
               |HAZ CreaElArti;
          |FINSI;

     |FINSI;

|FPRC;
--------------------------------------------------------------------------------
/*
|PROCESO Medicion; |TIPO 7;
     |ABRE #40;
     |DDEFECTO #40;
     #40#0 = #2#6;                             ||Undidad de medida.
     |LEE 000#40=;
     |CIERRA #40;
     |SI #40#2 ! "S";
          |C_M #2#7 , 1 , "S";
          |ACABA;
     |SINO;
          |C_M #2#7 , 1 , "N";
          nModo = (FEntrada / 100) ! 0;
          |SI nModo = 1;
               |PUSHV 01012380;
               |BLANCO 1101 2380
               |ENTLINEAL #1#41, -5, 2, 21, 1, MinMedi, MaxMedi;
               |POPV;
          |FINSI;
     |FINSI;
|FPRC;
*/
-------------------------------------------------------------------------------
|PROCESO CopiaMedidas;
     #100#0 = #0#0;
     #100#1 = #0#1;
     #100#2 = #1#12;
     #100#3 = #2#4;
     #100#4 = 999;
     |LEE 000#100];
     |SI FSalida = 0;
          |LEE 000#100a;
     |SINO;
          |LEE 000#100u;
     |FINSI;
     |SI FSalida = 0; |Y #100#0 = #0#0; |Y #100#1 = #0#1;
                      |Y #100#2 = #1#12; |Y #100#3 = #2#4;
          nLin = #100#4 + 1;
     |SINO;
          nLin = 1;
     |FINSI;

     |DDEFECTO #100;
     |PARA i = 2; |SI i [ 10; |HACIENDO i = i + 1;
          #100i = #41i;
     |SIGUE;
     #100#0 = #0#0;
     #100#1 = #0#1;
     #100#2 = #1#12;
     #100#3 = #2#4;
     #100#4 = nLin;
     |GRABA 020#100n;
     #2#7 = #100#9;
|FPRC;

|DEFBUCLE CopiaMedidas;
     #41#1;
     ;
     eaSer, enNum, eaCapi, eaRefe, 001;
     eaSer, enNum, eaCapi, eaRefe, 999;
     ;
     NULL, CopiaMedidas;
|FIN;

|PROCESO RecalMedida;
     #2#7 = #2#7 + #41#9;
|FPRC;

|DEFBUCLE RecalMedida;
     #41#1;
     ;
     #0#0, #0#1, #1#12, #2#4, 001;
     #0#0, #0#1, #1#12, #2#4, 999;
     ;
     NULL, RecalMedida;
|FIN;

|PROCESO RecalTotUniDes;
     #3#21 = #3#8 * #2#7;
     |GRABA 020#3a;
     |LIBERA #3;
|FPRC;

|DEFBUCLE RecalTotUniDes;
     #3#1;
     ;
     #2#0, #2#1, #2#2, #2#4, 001;
     #2#0, #2#1, #2#2, #2#4, 999;
     be;
     NULL, RecalTotUniDes;
|FIN;

|PROCESO EntraMed; |TIPO 0;
     aConte = Contenido;
     |SI #40#2 = "S";
          |SI Contenido ! #2#7;
               |MENAV "0000PULSE F6 PARA ENTRAR LAS MEDICIONES";
               #2#7 = Contenido;
               |PINTA #2#7;
               |ERROR;
               |ACABA;
          |FINSI;
          |SI FSalida = 14;
               |ESTADO_CONTROL nBotMedic, "HIDE"; ||"SHOW""HIDE""ENABLE""DISABLE".
               |PUSHV 01012380;
               |BLANCO 1101 2380
               |PARA enSwCopia = 1; |SI enSwCopia ! 0; |HACIENDO;
                    enSwCopia = 0;
                    |ENTLINEAL #1#41, -5, 2, 21, 1, MinMedi, MaxMedi;
                    |SI enSwCopia = 1;
                         |DDEF aDef;
                         aDef = aDef + "gomedici";
                         |CARGA_DEF aDef, gomedici@;
                         |SI FSalida = 0;
                              |ABRE #100;
                              |BUCLE CopiaMedidas;
                              |CIERRA #100;
                              |DESCARGA_DEF #gomedici@;
                         |FINSI;
                    |FINSI;
               |SIGUE;
               |POPV;
               #2#7 = 0;
               |BUCLE RecalMedida;
               |PINTA #2#7;
          |FINSI;
     |FINSI;
     |ESTADO_CONTROL nBotMedic, "HIDE"; ||"SHOW""HIDE""ENABLE""DISABLE".

     |SI aConte ! #2#7;
          |BUCLE RecalTotUniDes;
     |FINSI;
|FPRC;
-------------------------------------------------------------------------------
|PROCESO MinMedi;
     #41#0 = #0#0;
     #41#1 = #0#1;
     #41#2 = #1#12;
     #41#3 = #2#4;
     #41#4 = 1;
|FPRC;
-------------------------------------------------------------------------------
|PROCESO MaxMedi;
     #41#0 = #0#0;
     #41#1 = #0#1;
     #41#2 = #1#12;
     #41#3 = #2#4;
     #41#4 = 999;
|FPRC;
-------------------------------------------------------------------------------
|PROCESO UniMed; |TIPO 0;
     nModo = (FEntrada/100)!0
     |QBF Contenido;
     cMedida = #2#6;
     |QBF cMedida;

     |SI nModo = 1; |Y Contenido = "";
          |ACABA;
     |FINSI;

     |SI Contenido ! cMedida;
          |CONFI "0000NLa Unidad de Medida ha cambiado. ¿Desea borrar las mediciones actuales?";
          |SI FSalida = 0;
               cAlfa = #2#4;
               |BUCLE BajaMediPar;
               #2#7 = 0;
               |PINTA #2#7;
          |FINSI;

     |FINSI;

|FPRC;
-------------------------------------------------------------------------------
|PROCESO B02; |TIPO 5;
     FSalida = "SINBARRA";
|FPRC;
-------------------------------------------------------------------------------
|PROCESO BI003; |TIPO 80;
     |CLS;
     |CONTROL_SIMPLE 0, "BOTON,F2 - Porcentajes por Tipo", 2405, 2420, F2003;
     nBotPorci = FSalida;
     |ESTADO_CONTROL nBotPorci, "HIDE";

     |CONTROL_SIMPLE 0, "BOTON,F7 - Renumera Partidas", 2423, 2438, F7003;
     nBotRePar = FSalida;
     |ESTADO_CONTROL nBotRePar, "HIDE";

     |CONTROL_SIMPLE 0, "BOTON,F8 - Descripción Ampliada", 2441, 2458, F8003;
     nBotAmpli = FSalida;
     |ESTADO_CONTROL nBotAmpli, "HIDE";

     |CONTROL_SIMPLE 0, "BOTON,F9 - Actualización Costes", 2461, 2476, F9003;
     nBotCoste = FSalida;
     |ESTADO_CONTROL nBotCoste, "HIDE";

     |CONTROL_SIMPLE 0, "BOTON,F6-Medicion", 2430, 2450, F6003;
     nBotMedic = FSalida;
     |ESTADO_CONTROL nBotMedic, "HIDE"; ||"SHOW""HIDE""ENABLE""DISABLE".


     |CONTROL_SIMPLE 0, "BOTON,F3-Descomposición", 2305, 2319, F3003;
     nBotParti = FSalida;
     |ESTADO_CONTROL nBotParti, "HIDE"; ||"SHOW""HIDE""ENABLE""DISABLE".

     |CONTROL_SIMPLE 0, "BOTON,F4-Indice Partidas", 2321, 2335, F4003;
     nBotIndic = FSalida;
     |ESTADO_CONTROL nBotIndic, "HIDE"; ||"SHOW""HIDE""ENABLE""DISABLE".

     |CONTROL_SIMPLE 0, "BOTON,F5-Partidas Capitulo", 2337, 2351, F5003;
     nBotSelec = FSalida;
     |ESTADO_CONTROL nBotSelec, "HIDE"; ||"SHOW""HIDE""ENABLE""DISABLE".

     |CONTROL_SIMPLE 0, "BOTON,F6-Duplicar Partida", 2405, 2419, F6003;
     nBotDup = FSalida;
     |ESTADO_CONTROL nBotDup, "HIDE";

     |CONTROL_SIMPLE 0, "BOTON,F7-Busqueda Subfam", 2421, 2435, F7003;
     nBotSel = FSalida;
     |ESTADO_CONTROL nBotSel, "HIDE";

     |CONTROL_SIMPLE 0, "BOTON,F9-Todas las Partidas", 2437, 2451, F9003;
     nBotTodas = FSalida;
     |ESTADO_CONTROL nBotTodas, "HIDE"; ||"SHOW""HIDE""ENABLE""DISABLE".

|FPRC;
------------------------------------------------------------------------------
|PROCESO BF003; |TIPO 90;
     |FIN_CONTROL_WINDOWS nBotPorci;
     |FIN_CONTROL_WINDOWS nBotDup;
     |FIN_CONTROL_WINDOWS nBotSel;
     |FIN_CONTROL_WINDOWS nBotAmpli;
     |FIN_CONTROL_WINDOWS nBotCoste;
     |FIN_CONTROL_WINDOWS nBotParti;
     |FIN_CONTROL_WINDOWS nBotIndic;
     |FIN_CONTROL_WINDOWS nBotSelec;
     |FIN_CONTROL_WINDOWS nBotRePar;
     |FIN_CONTROL_WINDOWS nBotMedic;
     |PULSATECLA;
|FPRC;
------------------------------------------------------------------------------
|PROCESO BS003; |TIPO 7;
     |SI Campo = 3;

          |SI #2#4 ! "                    ";
               |ESTADO_CONTROL nBotPorci, "SHOW"; ||"SHOW""HIDE""ENABLE""DISABLE".
               |ESTADO_CONTROL nBotAmpli, "SHOW"; ||"SHOW""HIDE""ENABLE""DISABLE".
               |ESTADO_CONTROL nBotCoste, "SHOW"; ||"SHOW""HIDE""ENABLE""DISABLE".
               |ESTADO_CONTROL nBotRePar, "SHOW"; ||"SHOW""HIDE""ENABLE""DISABLE".
          |FINSI;

          |ESTADO_CONTROL nBotParti, "HIDE"; ||"SHOW""HIDE""ENABLE""DISABLE".
          |ESTADO_CONTROL nBotIndic, "HIDE"; ||"SHOW""HIDE""ENABLE""DISABLE".
          |ESTADO_CONTROL nBotSelec, "HIDE"; ||"SHOW""HIDE""ENABLE""DISABLE".
          |ESTADO_CONTROL nBotDup, "HIDE"; ||"SHOW""HIDE""ENABLE""DISABLE".
          |ESTADO_CONTROL nBotSel, "HIDE"; ||"SHOW""HIDE""ENABLE""DISABLE".
          |ESTADO_CONTROL nBotTodas, "HIDE"; ||"SHOW""HIDE""ENABLE""DISABLE".
          |ESTADO_CONTROL nBotMedic, "HIDE"; ||"SHOW""HIDE""ENABLE""DISABLE".
     |FINSI;

     |SI Campo = 4;
          |ESTADO_CONTROL nBotPorci, "HIDE"; ||"SHOW""HIDE""ENABLE""DISABLE".
          |ESTADO_CONTROL nBotAmpli, "HIDE"; ||"SHOW""HIDE""ENABLE""DISABLE".
          |ESTADO_CONTROL nBotCoste, "HIDE"; ||"SHOW""HIDE""ENABLE""DISABLE".
          |ESTADO_CONTROL nBotRePar, "HIDE"; ||"SHOW""HIDE""ENABLE""DISABLE".

          |SI #2#4 ! "                    ";
               |ESTADO_CONTROL nBotParti, "SHOW"; ||"SHOW""HIDE""ENABLE""DISABLE".
          |FINSI;

          |ESTADO_CONTROL nBotIndic, "SHOW"; ||"SHOW""HIDE""ENABLE""DISABLE".
          |ESTADO_CONTROL nBotSelec, "SHOW"; ||"SHOW""HIDE""ENABLE""DISABLE".
          |ESTADO_CONTROL nBotDup, "SHOW"; ||"SHOW""HIDE""ENABLE""DISABLE".
          |ESTADO_CONTROL nBotSel, "SHOW"; ||"SHOW""HIDE""ENABLE""DISABLE".
          |ESTADO_CONTROL nBotTodas, "SHOW"; ||"SHOW""HIDE""ENABLE""DISABLE".
     |FINSI;

     |SI Campo = 7;
          |ABRE #40;
          #40#0 = #2#6;                             ||Undidad de medida.
          |LEE 000#40=;
          |CIERRA #40;
          |SI #40#2 = "S";
               |ESTADO_CONTROL nBotMedic, "SHOW"; ||"SHOW""HIDE""ENABLE""DISABLE".
          |FINSI;
          |CIERRA #40;
     |FINSI;
|FPRC;
-------------------------------------------------------------------------------
|PROCESO BH003;
     |ESTADO_CONTROL nBotPorci, "HIDE"; ||"SHOW""HIDE""ENABLE""DISABLE".
     |ESTADO_CONTROL nBotAmpli, "HIDE"; ||"SHOW""HIDE""ENABLE""DISABLE".
     |ESTADO_CONTROL nBotCoste, "HIDE"; ||"SHOW""HIDE""ENABLE""DISABLE".
     |ESTADO_CONTROL nBotParti, "HIDE"; ||"SHOW""HIDE""ENABLE""DISABLE".
     |ESTADO_CONTROL nBotIndic, "HIDE"; ||"SHOW""HIDE""ENABLE""DISABLE".
     |ESTADO_CONTROL nBotSelec, "HIDE"; ||"SHOW""HIDE""ENABLE""DISABLE".
     |ESTADO_CONTROL nBotRePar, "HIDE"; ||"SHOW""HIDE""ENABLE""DISABLE".
     |ESTADO_CONTROL nBotDup, "HIDE"; ||"SHOW""HIDE""ENABLE""DISABLE".
     |ESTADO_CONTROL nBotSel, "HIDE"; ||"SHOW""HIDE""ENABLE""DISABLE".
     |ESTADO_CONTROL nBotTodas, "HIDE"; ||"SHOW""HIDE""ENABLE""DISABLE".
|FPRC;
-------------------------------------------------------------------------------
|PROCESO F2003;
     |PTEC 824;
|FPRC;
-------------------------------------------------------------------------------
|PROCESO F3003;

     |SI nModo = 2;
          FEntrada = 202;
     |FINSI;

     |PTEC 825;
|FPRC;
-------------------------------------------------------------------------------
|PROCESO F4003;

     |SI nModo = 1;
          FEntrada = 101;
     |FINSI;

     |SI nModo = 2;
          FEntrada = 201;
     |FINSI;

     |SI nModo = 4;
          FEntrada = 401;
     |FINSI;

     |PTEC 826;
|FPRC;
-------------------------------------------------------------------------------
|PROCESO F5003;
     |PTEC 827;
|FPRC;
-------------------------------------------------------------------------------
|PROCESO F6003;
     |PTEC 828;
|FPRC;
-------------------------------------------------------------------------------
|PROCESO F7003;
     |PTEC 829;
|FPRC;
-------------------------------------------------------------------------------
|PROCESO F8003;
     |PTEC 830;
|FPRC;
-------------------------------------------------------------------------------
|PROCESO F9003;
     |PTEC 831;
|FPRC;
-------------------------------------------------------------------------------
|PROCESO P; |TIPO 0;
     nModo = (FEntrada / 100) ! 0;
     |SI FSalida = 1;
          |SI nModo = 1;
               Contenido = #2#4;
               cAlfa     = #2#4;
               |ABRE #24;
               |BUCLE BorraDesc;                  ||Borra la descomposicion.gopre004
               |CIERRA #24;
               |BUCLE BajaMediPar;                ||Borra las Medidas de Partida.
               |ACABA;
          |FINSI;
          |MENAV "0000DEBE COMPLETAR LOS DATOS DE LINEA";
          |ERROR;
     |FINSI;
|FPRC;

|PROCESO PartiAnt; |TIPO 7;
     |ABRE #goartive;            ||Se crea la partida blanco
     #goartive#0 = "";           ||por problema con relacion al dar
     |GRABA 040#goartive.n;      ||de alta una partida inexistente
     nExistePartBlanco = FSalida;||(pulsando intro dejando la partida '')
     |CIERRA #0;

     aPartiAnt = #2#4;
     |SI cParti ! "";
          #2#4 = cParti;
          cParti = "";
     |FINSI;
|FPRC;

|PROCESO ExistePartida;
     nExiste = 0;
     |DDEF aDef;
     aDef = aDef + "gopre003";
     |CARGA_DEF aDef, refer003@;
     |SI FSalida = 0;
          |ABRE #300; |SELECT #2#300;
          #300#0 = #2#0;
          #300#1 = #2#1;
          #300#2 = #2#2;
          #300#4 = #2#4;
          |LEE 000#300];
          |PARA; |SI FSalida = 0; |Y #300#0 = #2#0; |Y #300#1 = #2#1;
                   |Y #300#2 = #2#2; |Y #300#4 = #2#4; |HACIENDO;
               |SI #300#3 ! #2#3;
                    aPartiAnt = #2#4;
                    nExiste = 1;
                    |SAL;
               |FINSI;
               |LEE 000#300s;
          |SIGUE;
          |CIERRA #300;
          |DESCARGA_DEF #refer003@;
     |FINSI;
     |SI nExiste ! 0;
          |MENAV "0000Ya existe en este capitulo...";
    |FINSI;
|FPRC;

|PROCESO Partida3_0; |TIPO 0;
     nModo = (FEntrada / 100) ! 0;
     |SI nExistePartBlanco = 0;
          |ABRE #goartive;
          #goartive#0 = "";
          |BORRA 040#goartive.c;
          |CIERRA #0;
     |FINSI;

     |SI nModo = 1;
          aAlfa = #2#4; |QBF aAlfa;
          |SI aAlfa = "";
               |HAZ GeneraPartida;
               |SI aPartida ! "";
                    ||#2#4 = #90#0; |PINTA #2#4;
                    #2#4 = aPartida; |PINTA #2#4;
                    |ERROR; |PTEC 802;
               |SINO;
                    |AVISO; |ERROR; |ACABA;
               |FINSI;
          |FINSI;
     |FINSI;

     |HAZ ExistePartida;
     |SI nExiste ! 0; |ERROR; |ACABA; |FINSI;

     |HAZ CalLinPor;
     |HAZ CalLinPar;

     /* Entramos en la descomposicion de la partida */
     |SI nSalida = 11;
          |PUSHV 01012380;
          |SI #13#120 = "S";
               |REFERENCIA_DEF gopre004@, #26;
               |ENTLINEAL #1#26, -5, nModo, 21, 1, MinComPar, MaxComPar;
          |SINO;
               |REFERENCIA_DEF gopre004@, #3;
               |ENTLINEAL #1#3, -5, nModo, 21, 1, MinComPar, MaxComPar;
          |FINSI;
          |POPV;
          |PINTA #2#6;
          |PINTA #2#7;
          |PINTA #2#8;
          |PINTA #2#10;
     |FINSI;
|FPRC;

|PROCESO GeneraPartida;
     |SI #goparame#32 = "N"; |ACABA; |FINSI;
     aGuarda = FEntrada;

     eaPartida = #2#4; ||#2#4 es blanco
     |SUB_EJECUTA_NP "goartive;ALTA";
     |SI eaPartida = ""; |ACABA; |FINSI;
     #2#4 = eaPartida; |PINTA #2#4;

     FEntrada = aGuarda;
|FPRC;

|PROCESO DesAmpliada;
     aAlfa = #19#2; |QBF aAlfa;
     aLon = aDes % A0;
     |SI aAlfa ! ""; |Y aLon < 180;
          |SI aDes = "";
               aDes = aAlfa;
          |SINO;
               aDes = aDes + " " + aAlfa;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE DesAmpliada;
     #19#1;
     ;
     #20#0, 001;
     #20#0, 999;
     ;
     NULL, DesAmpliada;
|FIN;

|PROCESO gotmpart;
     aDes = "";
     |BUCLE DesAmpliada;
     #57#0 = #20#0;
     #57#1 = #20#1;
     #57#2 = aDes;
     |GRABA 020#57n;
|FPRC;

|DEFBUCLE gotmpart;
     #20#8;
     ;
     aVic, "                    ";
     aVic, "zzzzzzzzzzzzzzzzzzzz";
     ;
     NULL, gotmpart;
|FIN;

|PROCESO ParCapitulo;
     |HAZ CreaTempo; |NOME_DAT #57 Tempo; |DELINDEX #57;
     |ABRE #57;
     |BUCLE gotmpart;
     |LEE 000#57p;
     |CONSULTA_CLAVE #1#57;
     |SI FSalida =  0;
          #2#4 = #57#0;
     |FINSI;
     |CIERRA #57;
     |HAZ BoraTempo; |DELINDEX #57;
|FPRC;

|PROCESO DobleUnidad3; |TIPO 7;
     |C_M #2#7, 1, "S";

     |ABRE #4;
     #4#0 = #2#4;
     |LEE 000#4=;
     |SI FSalida = 0; |Y #4#4 = "N";
          |ABRE #40;
          #40#0 = #2#6;
          |LEE 000#40=;
          |SI FSalida = 0; |Y #40#12 = "S";
               ||eaArtiAnt  (se cargar en el tipo 0 de la linea)
               eaArticulo = #2#4;
               enUnidad1 = #2#7;
               enUnidad2 = #2#26;
               enMedida1 = #2#27;
               enMedida2 = #2#28;
               enMedida3 = #2#29;
               eaPartida = "";
               enModoVta = (FEntrada / 100) ! 0;
               |SUB_EJECUTA_NP "dsz99907";
               |SI eaSw2Stock = "S";
                    |C_M #2#7, 1, "N";
                    #2#7 = enUnidad1; |PINTA #2#7;
                    #2#26 = enUnidad2;
                    #2#27 = enMedida1;
                    #2#28 = enMedida2;
                    #2#29 = enMedida3;
               |SINO;
                    #2#26 = 0;
                    #2#27 = 0;
                    #2#28 = 0;
                    #2#29 = 0;
               |FINSI;
          |FINSI;
          |CIERRA #40;
     |FINSI;
     |CIERRA #4;
|FPRC;

|PROCESO Ajuste1Arti;
     nDife = nImpManual - #2#8;
     |ABRE #3;
     #3#0 = #2#0; ||se
     #3#1 = #2#1; ||pre
     #3#2 = #2#2; ||ca
     #3#3 = #2#4; ||par
     #3#4 = 1;
     |LEE 101#3];
     |SI FSalida = 0; |Y #3#0 = #2#0; |Y #3#1 = #2#1; |Y #3#2 = #2#2;
               |Y #3#3 = #2#4;

          #2#8 = #2#8 - #3#11;                        ||Precio Venta Partida.
          #2#9 = #2#9 - #3#12;                        ||Precio Coste Partida.

          #3#11 = #3#11 + nDife;

          |HAZ CogeUniFac;

          |SI #0#42 = "+";
               #3#13 = (#3#11 - (#3#9*enUniFac))*100/(#3#9*enUniFac);
          |SINO;
               #3#13 = -100*((#3#9*enUniFac/#3#11)-1);
          |FINSI;

          #3#12 = #3#10*enUniFac;                          ||Importe Coste.
          |GRABA 020#3a;

          #2#8 = #2#8 + #3#11;                        ||Precio Venta Partida.
          #2#9 = #2#9 + #3#12;                        ||Precio Coste Partida.
     |FINSI;
     |CIERRA #3;

     |HAZ CalLinPar;
|FPRC;

|PROCESO DesgloEscan;
     |DDEFECTO #25;
     #25#21 = #24#35;
     #25#22 = #24#36;
     #25#23 = #24#37;
     #25#24 = #24#38;
     #25#25 = #24#39;
     |PARA i = 0; |SI i [ 20; |HACIENDO i = i + 1;
          #25i = #490i;
     |SIGUE;
     |GRABA 020#25n;
|FPRC;

|DEFBUCLE DesgloEscan;
     #490#1;
     ;
     #3#5, 001;
     #3#5, 999;
     ;
     NULL, DesgloEscan;
|FIN;

|PROCESO Escandallo;
     |SI #13#106 = "S";
          |ABRE #24;
          |ABRE #480;
          #480#0 = #3#5;
          |LEE 000#480=;
          |SI FSalida = 0;
               aTieneEscan = "S";
               |DDEFECTO #24;
               #24#35 = #3#0;
               #24#36 = #3#1;
               #24#37 = #3#2;
               #24#38 = #3#3;
               #24#39 = #3#4;
               #24#0 = #3#5;
               |LEE 101#24=;
               |SI FSalida ! 0; |GRABA 020#24b; |FINSI;
               |PARA i = 1; |SI i [ 34; |HACIENDO i = i + 1;
                    #24i = #480i;
               |SIGUE;
               |GRABA 020#24a;
               |BUCLELIN 1 NULL #24;
               |ABRE #25;
               |BUCLE DesgloEscan;
               |CIERRA #25;
          |FINSI;
          |CIERRA #24;
     |FINSI;
|FPRC;
-------------------------------------------------
|PROCESO ActDesglose;
     #6#0 = #3#5;
     |LEE 020#6=;

     |SI #6#126 ! eaMarca; |ACABA; |FINSI;

     nModi = 0;
     #14#0 = #3#5;
     |LEE 000#14=;
     |SI FSalida = 0;
          nNume1 = #3#10 ! nDeci_PTrab;
          nNume2 = #6#9 ! nDeci_PTrab;
          |SI nNume1 ! nNume2;
               nPrecio = nNume2;
               nModi = 1;
          |FINSI;
     |SINO;
          nNume1 = #3#10 ! nDeci_PTrab;
          nNume2 = #6#133 ! nDeci_PTrab;

/* 004077/33 */
          |SI nSwForestales = 0;
               nNume2 = (#6#149 - (#6#149 / 100 * #6#152)) ! nDeci_PTrab;
               |SI #6#149 = 0; nNume2 = #6#133 ! nDeci_PTrab; |FINSI;
          |FINSI;
/* */
          |SI nNume1 ! nNume2;
               nPrecio = nNume2;
               nModi = 1;
          |FINSI;
     |FINSI;
     |SI nModi = 1;
          |SI nSw = 0;
               |ERROR10;
          |SINO;
               #3#9 = nPrecio;   || Venta
               #3#10 = nPrecio;
               |GRABA 020#3a;
               |SI nActBase = 1;
                    |SELECT #3#5;
                    #5#0 = #3#3;
                    #5#2 = #3#5;
                    |LEE 101#5=;
                    |SI FSalida = 0;
                         #5#5 = #5#5 ! #13#115;
                         #5#6 = nPrecio;
                         #5#7 = #5#5 * #5#6;
                         |GRABA 020#5a;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
     |LIBERA #3;
|FPRC;

|DEFBUCLE ActDesglose;
     #3#1;
     ;
     #2#0, #2#1, #2#2, #2#4, 001;
     #2#0, #2#1, #2#2, #2#4, 999;
     be;
     NULL, ActDesglose;
|FIN;

|PROCESO DesgloPar;
     nTotal = nTotal + #5#7;
|FPRC;

|DEFBUCLE DesgloPar;
     #5#1;
     ;
     #4#0, 001;
     #4#0, 999;
     ;
     NULL, DesgloPar;
|FIN;

|PROCESO ActCostesPar;
     eaMarca = "";
     |SUB_EJECUTA_NP "gotmp002";
     |SI eaMarca = ""; |ACABA; |FINSI;

     #1#8 = #1#8 - #2#11;

     |HAZ EsForestales;
     nSwForestales = FSalida;

     |ABRE #14;
     |ABRE #6;
     |ABRE #5;
     nModi = 0;
     nSw = 0;
     |BUCLE ActDesglose;
     |SI nModi = 1;
          nActBase = 0;
          |CONFI "0000N¿Actualizar base de datos?";
          |SI FSalida = 0;
               nActBase = 1;
          |FINSI;
          nSw = 1;
          |BUCLE ActDesglose;
          |PINTA #2#11; |PINTA #2#12;
          |SI nActBase = 1;
               |ABRE #4;
               #4#0 = #2#4;
               |LEE 121#4=;
               |SI FSalida = 0;
                    #4#15 = 0; nTotal = 0;
                    |BUCLE DesgloPar;
                    #4#15 = nTotal;
                    |GRABA 020#4a;
               |FINSI;
               |CIERRA #4;
          |FINSI;
          |SALVA_DATOS #1;
          |SALVA_DATOS #2;
          |HAZ TotalCapi;
          |GRABA 020#1a;
          |REPON_DATOS #2;
          |REPON_DATOS #1;
          |LEE 020#1=;
          |LEE 020#2=;
          |PINTA #2#8;
          |PINTA #2#9;
          |PINTA #2#10;
          |PINTA #2#11;
          |PINTA #2#12;
          |PTEC 809;
     |SINO;
          |MENAV "0000No hay artículos a actualizar...";
     |FINSI;
     |CIERRA #5;
     |CIERRA #6;
     |CIERRA #14;
|FPRC;

|PROCESO ImpCambioPrecio;
     |AVISO;
     |CONFI "0000SPrecios distintos en Partida y PVP6. ¿Imprimir?";
     |SI FSalida ! 0; |ACABA; |FINSI;

     |IMPRE 0;
     |SI FSalida = 0;
          |INFOR "goprecio";
          |SI FSalida = 0;

               |ABRE #5;
               |SELECT #2#5;
               #5#0 = #2#4;                            ||Cod. Partida.
               |LEE 000#5=;
               |PARA; |SI FSalida = 0; |HACIENDO;
                    |DDEFECTO #6;
                    #6#0 = #5#2;
                    |LEE 000#6=;
                    |SI #5#6 = 0;
                         cCodMonDe = #4#5;             ||Moneda Goartive
                         cCodMonA  = #0#7;             ||Moneda Gopre001
                         nPrecioComp = 0;              ||Precio Compra
                                                       ||No Hay precio.Posiblemente es parametrico.
                         |HAZ ParamIve;                ||Comprobamos si es parametrico.
                    |SINO;
                         cCodMonDe = #4#5;             ||Moneda Goartive
                         cCodMonA  = #0#7;             ||Moneda Gopre001
                         nPrecioComp = #5#6;           ||Precio Compra
                    |FINSI;

                    nPrecioCheq = #6#149 - (#6#149 / 100 * #6#152);

                    enPrePar = nPrecioComp;
                    enPrePVP = nPrecioCheq;
                    |SI enPrePar ! enPrePVP;
                         |PRINT;
                    |FINSI;

                    |LEE 000#5s;

                    |SI #5#0 ! #2#4;                   ||Ultimo articulo de descomposicion Partida.
                         FSalida = 1;
                    |FINSI;
               |SIGUE;
               |CIERRA #5;

               |PIEINF;
               |FININF;
          |FINSI;
          |FINIMP;
     |FINSI;
|FPRC;
