|FICHEROS;
     diam0015;
     diam0019;
     diam0020;
     diam0021;
     diam0050;
     diaz0010;

     diam0016;
     diam0017;
     diam0018;

     diaw0020,MANTE;
     diaw0021,MANTE;
     diaw0009,MANTE;

     agifa024;
     agifa025;
     agifa091;
     diam0032,MANTE;

     :/dspartes/def/dsparm05;
     :/dspartes/def/dsparm01;
|FIN;

|VARIABLES;
     aCliente = "";
     nSwImp = 0;
     nAlta = 0;
     nOferta = 0;
     nSubPanta = 0;
     nSubBoton1 = 0;

     nBtnDoc     = 0;
     nBoton1     = 0;
     nBoton2     = 0;
     nBoton3     = 0;
     nBoton4     = 0;
     nBoton5     = 0;
     nBoton6     = 0;
     nBoton7     = 0;
     nBoton8     = 0;
     nBoton9     = 0;
     nBoton10    = 0;
     nBoton11    = 0;
     nBoton12    = 0;
     nBoton921   = 0;
     nRango      = 0;
     nPosi1      = 0;
     nPosi2      = 0;
     nPanta      = 0;
     nPanta921   = 0;
     nVentana    = 0;
     nVentana32  = 0;
     nCampo      = 0;
     nGrid       = 0;
     nGrid32     = 0;
     nTecla      = 0;
     nLinea      = 0;
     nCampo6     = 0;
     nCampo8     = 0;
     nCampo9     = 0;
     nCampo10    = 0;
     nCampo11    = 0;
     nSwHay      = 0;
     nCoste      = 0;
     nModoDatos  = 0;
     nContaLin   = 0;
     nIncre      = 0;
     nModo       = 0;
     nVtn        = 0;

     aEsc        = "";
     aEsc1       = "";
     aEsc2       = "";
     aRetu       = "";
     aTecla      = "";
     aTecla1     = "";
     aAlfa       = "";
     aCampo4     = "";
     aCampo5     = "";
     aFam        = "";
     aIPServ     = "";
     aServCorreo = "";
     aFrom       = "";
     aTo         = "";
     aMensaje    = "";
     aAsunto     = "";
     aFic        = "";
     aTipo       = "";
     aUsuario    = "";
     aHora       = "";
     aBase       = "";
     aOrigen     = "";
     aDestino    = "";
     aDocu       = "";
     aDEstado    = "";
     aHEstado    = "";
     aDCliente   = "";
     aHCliente   = "";
     aPathSer    = "";
     aOri        = "";
     aDes        = "";

     fFecha      = @;
     fDFecha     = @;
     fHFecha     = @;

     &aTipoInf           = "";
     &aPeriodoCrys       = "";
     &eaCliente          = "";
     &eaFecha            = "";
     &eaSerie            = "";
     &eaFechaPedido      = "";
     &eaHora             = "";
     &eaCompras          = "";
     &eaDef              = "";
     &eaClv              = "";

     &enTipoIVA          = 0;
     &enPedido           = 0;
     &enDesdePed         = 0;
     &enSalida           = 0;
     &enPanta            = 0;
     &enExiste           = 0;
     &enForma            = 0;
     &enTotal            = 0;  || para impresion

     &fFechaCrys         = @;
     &fFechaDesdeCrys    = @;
|FIN;

|PROCESO CargaControl;
     nModo = (FEntrada / 100) ! 0;

     aAlfa = #diaz0010#1 % -104;
     |ABRE #diam0015;
     #diam0015#71 = aAlfa;
     |LEE 040#diam0015.=;
     |SI FSalida ! 0;
         |MENAV "     No existe Control del Asistente.";
         |ERROR;
         |CIERRA #diam0015;
         |ACABA;
     |FINSI;
     |CIERRA #diam0015;

     |SI nModo ! 1;  |ACABA;  |FINSI;

     #diaz0010#32  = #diam0015#1;   #diaz0010#33  = #diam0015#3;   ||#diaz0010#35  = #diam0015#46;
     #diaz0010#37  = #diam0015#5;   #diaz0010#38  = #diam0015#7;   ||#diaz0010#40  = #diam0015#46;
     #diaz0010#42  = #diam0015#9;   #diaz0010#43  = #diam0015#11;  ||#diaz0010#45  = #diam0015#46;
     #diaz0010#47  = #diam0015#13;  #diaz0010#48  = #diam0015#15;  ||#diaz0010#50  = #diam0015#46;
     #diaz0010#52  = #diam0015#17;  #diaz0010#53  = #diam0015#19;  ||#diaz0010#55  = #diam0015#46;
     #diaz0010#57  = #diam0015#21;  #diaz0010#58  = #diam0015#23;  ||#diaz0010#60  = #diam0015#46;
     #diaz0010#62  = #diam0015#25;  #diaz0010#63  = #diam0015#27;  ||#diaz0010#65  = #diam0015#50;
     #diaz0010#67  = #diam0015#28;  #diaz0010#68  = #diam0015#30;  ||#diaz0010#70  = #diam0015#47;  #diaz0010#72  = #diam0015#48;
     #diaz0010#74  = #diam0015#31;  #diaz0010#75  = #diam0015#33;  ||#diaz0010#76  = #diam0015#49;
     #diaz0010#82  = #diam0015#34;  #diaz0010#83  = #diam0015#36;
     #diaz0010#86  = #diam0015#37;  #diaz0010#87  = #diam0015#39;
     #diaz0010#94  = #diam0015#40;  #diaz0010#95  = #diam0015#42;
     #diaz0010#98  = #diam0015#43;  #diaz0010#99  = #diam0015#45;

     |PINDA #0#diaz0010;

     |ESTADO_CONTROL nSubBoton1, "ENABLE";
|FPRC;

|PROCESO  diam0020B;
     |DBASE aAlfa;  |QBF aAlfa;
     aAlfa = aAlfa + "000577/documentos";
     aAlfa = aAlfa + "/" + #diam0020#14;  |QBF aAlfa;
     |FBORRA aAlfa;

     |BORRA 020#diam0020.a;
     |LIBERA #diam0020;
|FPRC;

|DEFBUCLE diam0020B;
     #diam0020#1;
     ;
     #diam0019#0, #diam0019#1, #diam0019#13, 001;
     #diam0019#0, #diam0019#1, #diam0019#13, 999;
     be;
     NULL, diam0020B;
|FIN;

|PROCESO  diam0021B;
     |BORRA 020#diam0021.a;
     |LIBERA #diam0021;
|FPRC;

|DEFBUCLE diam0021B;
     #diam0021#1;
     ;
     #diam0019#0, #diam0019#1, #diam0019#13, 001;
     #diam0019#0, #diam0019#1, #diam0019#13, 999;
     be;
     NULL, diam0021B;
|FIN;

|PROCESO diam0050B;
     aFic  = #diam0050#0;
     aFic  = aFic + (("0000" + #diam0050#2) % -104);
     aFic  = aFic + #diam0050#1;                    |QBF aFic;
     aFic  = aFic + "." + #diam0050#10;             |QBF aFic;

     aAlfa = aPathSer + aFic;
     |FBORRA aAlfa;

     |BORRA 020#diam0050.a;
     |LIBERA #diam0050;
|FPRC;

|DEFBUCLE diam0050B;
     #diam0050#1;
     ;
     eaDef, eaClv, 0001;
     eaDef, eaClv, 9999;
     be;
     NULL, diam0050B;
|FIN;

|PROCESO ModoModifica;
     |LEE 101#diam0019.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |VENTANA 0501, 4099, -1, -1, "";
     nVentana = FSalida;

     |DDEFECTO #diaz0010;

     |PARA nCampo = 0;  |SI nCampo [ 121;  |HACIENDO nCampo = nCampo + 1;
           #diaz0010#nCampo# = #diam0019#nCampo#;
     |SIGUE;
     #diaz0010#122 = #diam0019#127;

     |PINPA #0#diaz0010;
     enPanta = FSalida;
     |PINDA #0#diaz0010;

     |SI #diam0019#119 = "EN PEDIDOS";
         |HAZ ModoConsulta;
     |SINO;
         |CONTROL_SIMPLE enPanta, "BOTON,{{137}}Productos", 1724, 1740, SubBoton10;
         nSubBoton1 = FSalida;
         |C_M #diaz0010#0,  1, "N";
         |C_M #diaz0010#1,  1, "N";
         |C_M #diaz0010#13, 1, "N";

         enSalida = 0;

         |ENDATOS #2#diaz0010;
         |SI enSalida = 0;
             |PARA nCampo = 0;  |SI nCampo [ 121;  |HACIENDO nCampo = nCampo + 1;
                   #diam0019#nCampo# = #diaz0010#nCampo#;
             |SIGUE;

             aAlfa   = Usuario % 810;
             #diam0019#125 = aAlfa;
             #diam0019#126 = ~;

             |GRABA 020#diam0019.a;
             FSalida = "SKIPDEFAULT";

             |PINTA #diam0019#17;
             |PINTA #diam0019#119;
             |PINTA #diam0019#120;
             |PINTA #diam0019#122;
             |PINTA #diam0019#123;
             |PINTA #diam0019#124;
             |PINTA #diam0019#125;
             |PINTA #diam0019#126;
        |FINSI;
        |FIN_CONTROL_WINDOWS nSubBoton1;
    |FINSI;

    |LIBERA #diam0019;
    |FINVENTANA nVentana;
    |PULSATECLA;
|FPRC;

|PROCESO Evento;
     nTecla = FSalida;

     |SI nTecla = 1;
         |LEE 040#diam0019.c;
         |SI FSalida = 0;
             |SI #diam0019#119 = "RECHAZADA ";
                 |ESTADO_CONTROL nBoton4, "DISABLE";
                 |ESTADO_CONTROL nBoton9, "DISABLE";
                 |ESTADO_CONTROL nBoton12, "DISABLE";
             |SINO;
                 |ESTADO_CONTROL nBoton4, "ENABLE";
                 |ESTADO_CONTROL nBoton9, "ENABLE";
                 |ESTADO_CONTROL nBoton12, "ENABLE";
             |FINSI;

             |ESTADO_CONTROL nBtnDoc, "ENABLE";
         |FINSI;
     |FINSI;

     |SI nTecla = 4;
         nModoDatos = 2;
         |HAZ ModoModifica;
     |FINSI;
|FPRC;

|PROCESO Bloquea; |TIPO 0;
     |SI nOferta = 0; |Y nAlta = 1;
          |SELECT #5#diam0019;
          |LEE 000#diam0019.u;
          |SI FSalida = 0;
               nOferta = #diam0019#127 + 1;
          |SINO;
               nOferta = 1;
          |FINSI;
          |SELECT #1#diam0019;

          #diaz0010#122 = nOferta; |PINTA #diaz0010#122;

          |DDEFECTO #diam0019;
          #diam0019#0   = #diaz0010#0;
          #diam0019#1   = #diaz0010#1;
          #diam0019#13  = #diaz0010#13;
          #diam0019#127 = #diaz0010#122;
          |GRABA 020#diam0019.b;

          |C_M #diaz0010#0,  1, "N";
          |C_M #diaz0010#1,  1, "N";
          |C_M #diaz0010#13, 1, "N";
     |FINSI;
|FPRC;


|PROCESO Boton1;
     |VENTANA 0501, 4099, -1, -1, "";
     nVentana = FSalida;

     |DDEFECTO #diaz0010;
     |PINPA #0#diaz0010;
     nSubPanta = FSalida;

     |CONTROL_SIMPLE nSubPanta, "BOTON,{{137}}Productos", 1724, 1740, SubBoton10;
     nSubBoton1 = FSalida;

     |ESTADO_CONTROL nSubBoton1, "DISABLE";

     |HORA aAlfa;
     #diaz0010#12 = ~;
     #diaz0010#13 = aAlfa;

     |C_M #diaz0010#0,  1, "S";
     |C_M #diaz0010#1,  1, "S";
     |C_M #diaz0010#13, 1, "S";

     nAlta = 1;
     nOferta = 0;
     enSalida = 0;
     |PINDA #0#diaz0010;
     |ENDATOS #1#diaz0010;
     |SI enSalida = 0;
         |PARA nCampo = 0;  |SI nCampo [ 121;  |HACIENDO nCampo = nCampo + 1;
               #diam0019#nCampo# = #diaz0010#nCampo#;
         |SIGUE;

         aAlfa   = Usuario % 810;
         #diam0019#124 = aAlfa;
         #diam0019#125 = aAlfa;
         #diam0019#126 = ~;
         #diam0019#127 = #diaz0010#122;

         |GRABA 020#diam0019.a;
         |LIBERA #diam0019;
     |SINO;
          |SI nOferta ! 0;
               |BORRA 020#diam0019.c;
          |FINSI;
     |FINSI;

     |FIN_CONTROL_WINDOWS nSubBoton1;

     |FINVENTANA nVentana;

     |REFRESCACONTROL nGrid;

     |PULSATECLA;
     nAlta = 0;
|FPRC;

|PROCESO Boton2;
     |SI #diam0019#119 = "EN PEDIDOS";
         |MENAV "      La oferta esta EN PEDIDOS";
         |ACABA;
     |FINSI;

     |CONFI "0000NSeguro de Borrar el Registro.";
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |LEE 101#diam0019.=;
     |SI FSalida = 0;
         eaDef = "diam0019";
         eaClv = #diam0019#0;
         eaClv = eaClv + (#diam0019#1  % -104);
         eaClv = eaClv + (#diam0019#1  % 402);
         eaClv = eaClv + (#diam0019#1  % 102);
         eaClv = eaClv + (#diam0019#13 % 102);
         eaClv = eaClv + (#diam0019#13 % 402);
         eaClv = eaClv + (#diam0019#13 % 702);
         eaClv = (eaClv + (" " * 25)) % 125;

         |DBASE aBase;  |QBF aBase;
         aPathSer = aBase + "000577/documentos/";

         |BUCLE diam0020B;
         |BUCLE diam0021B;
         |BUCLE diam0050B;

         |BORRA 020#diam0019.a;

         |REFRESCACONTROL nGrid;
         |LIBERA #diam0019;
     |FINSI;
|FPRC;

|PROCESO diam0021Imprime;
     |SI nLinea = 0;
         nContaLin = nContaLin + 1;
         |ACABA;
     |FINSI;

     nLinea = nLinea + nIncre;

     |SI nLinea > 28;  |ERROR10;  |ACABA;  |FINSI;

     |SI #diam0021#5 ! 0;
         aAlfa = "B" + nLinea + "," + #diam0021#5;
         |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
     |FINSI;

     aAlfa = "C" + nLinea + "," + #diam0021#8;
     |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

     aAlfa = "D" + nLinea + "," + #diam0021#4;
     |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

     aAlfa = "F" + nLinea + "," + #diam0021#6;
     |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

     aAlfa = "G" + nLinea + "," + #diam0021#7;
     |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;
|FPRC;

|DEFBUCLE diam0021Imprime;
     #diam0021#1;
     ;
     #diam0019#0, #diam0019#1, #diam0019#13, 001;
     #diam0019#0, #diam0019#1, #diam0019#13, 999;
     ;
     NULL, diam0021Imprime;
|FIN;

|PROCESO CargaHoja;
     |ABRE #agifa091;
     #agifa091#0 = #diam0019#115;
     |LEE 040#agifa091.=;
     |SI FSalida ! 0;  |DDEFECTO #agifa091; |FINSI;
     |CIERRA #agifa091;

     |ABRE #agifa024;
     #agifa024#0 = #diam0019#0;
     |LEE 040#agifa024.=;
     |SI FSalida ! 0;  |DDEFECTO #agifa024; |FINSI;
     |CIERRA #agifa024;

     |ABRE #agifa025;
     #agifa025#0 = #diam0019#18;
     |LEE 040#agifa025.=;
     |SI FSalida ! 0;  |DDEFECTO #agifa025; |FINSI;
     |CIERRA #agifa025;

     aAlfa = "D30," + #agifa091#1;
     |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

     aAlfa = "D7," + #diam0019#118 + "     " + #diam0019#1;
     |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

     aAlfa = "G7," + #diam0019#28;
     |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

     aAlfa = "D8," + #diam0019#3;
     |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

     aAlfa = "D9," + #diam0019#5;
     |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

     aAlfa = "D10," + #diam0019#8 + " " + #diam0019#6;
     |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

     aAlfa = "D11," + #agifa024#15;
     |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

     aAlfa = "D12," + #diam0019#10;
     |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

     aAlfa = "G12," + #diam0019#11;
     |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

     aAlfa = "D40," + #agifa025#1;
     |ALFACALLDLL "agixl97.dll","poke_dato", aAlfa;

     nLinea    = 0;
     nContaLin = 0;

     |BUCLE diam0021Imprime;

     |SI nContaLin > 13;
         |MENAV "0000 Hay mas de 13 Lineas de Presupuestos. Solo Imprimira hasta la 13";
     |FINSI;

     |SI nContaLin [ 6;
         nLinea = 15;
         nIncre = 2;
     |SINO;
         nLinea = 16;
         nIncre = 1;
         |SI nContaLin ] 13;
             nLinea = 15;
         |FINSI;
     |FINSI;

     |BUCLE diam0021Imprime;
|FPRC;

|PROCESO Boton3;
     |LEE 040#diam0019.=;
     |SI FSalida ! 0;  |DDEFECTO #diam0019;  |FINSI;

     |HAZ ImpCrystal;
     |ACABA;

     ||AHORA SE HACE EN CRYSTAL.............................


     |DBASE aBase;  |QBF aBase;
     aOrigen = aBase + "000577/PedidoOferta.xls";
     aDestino = "C:\DOCUMENTOS";         |RMKDIR aDestino;
     aDestino = aDestino + "\PedidoOferta.xls";
     aDocu    = aDestino;
     |ENVIA_FICHERO aOrigen, aDestino;

     |CARGADLL "agixl97.dll";
     |SI FSalida < 0;
         |MENAV "0000No se puede usar agixl97.dll";
         |ACABA;
     |FINSI;

     |ALFACALLDLL "agixl97.dll", "carga_book", aDocu;
     |ALFACALLDLL "agixl97.dll", "selecciona_hoja", "Hoja1";

     |HAZ CargaHoja;

     |ALFACALLDLL "agixl97.dll", "fin_book", "";
     |DESCARGADLL "agixl97.dll";

     |RFBORRA aDestino;
|FPRC;

|PROCESO EnviaCorreo;
     |ABRE #dsparm01;
     |LEE 040#dsparm01.p;
     |SI FSalida ! 0;  |CIERRA #dsparm01;  |ACABA;  |FINSI;
     |CIERRA #dsparm01;

     |ABRE #dsparm05;
     #dsparm05#0 = #dsparm01#12;
     |LEE 000#dsparm05.=;
     |SI FSalida ! 0;  |CIERRA #dsparm05;  |ACABA;  |FINSI;
     |CIERRA #dsparm05;

     aTo      = #dsparm05#3;               |QBF aTo;
     aAsunto  = "Alta Prepedido:" + #diam0019#0 + "/" + #diam0019#1 + "/" + #diam0019#13;
     aMensaje = aAsunto;
     aAlfa    = Usuario % 810;

     |SELECT #3#dsparm05;
     #dsparm05#2 = aAlfa;
     |LEE 000#dsparm05.=;

     aFic        = "vacio.txt";
     aFrom       = #dsparm05#3;       |QBF aFrom;
     aServCorreo = #dsparm01#7;       |QBF aServCorreo;
     aIPServ     = #dsparm01#8;       |QBF aIPServ;

||  aTo = "manolo@diagram.es";

     |DSCORREO_ENVIA aIPServ, aServCorreo, aFrom, aTo, aAsunto, aMensaje, aFic;
     |SI FSalida ! 0;
          |MENAV "0000Ha habido un error durante el envio.";
     |FINSI;
|FPRC;

|PROCESO  diam0020Pasa;
     |PARA nCampo = 0;  |SI nCampo [ 15;  |HACIENDO nCampo = nCampo + 1;
           #diam0017#nCampo# = #diam0020#nCampo#;
     |SIGUE;

     #diam0017#0 = #diaw0009#0;
     #diam0017#1 = #diam0016#1;
     #diam0017#2 = #diam0016#13;
     |GRABA 020#diam0017.n;
     |LIBERA #diam0017;

     |SI #diam0019#0 ! #diaw0009#0;
         |BORRA 020#diam0020.a;

         #diam0020#0 = #diaw0009#0;
         |GRABA 020#diam0020.n;
         |LIBERA #diam0020;
     |FINSI;
|FPRC;

|DEFBUCLE diam0020Pasa;
     #diam0020#1;
     ;
     #diam0019#0, #diam0019#1, #diam0019#13, 001;
     #diam0019#0, #diam0019#1, #diam0019#13, 999;
     be;
     NULL, diam0020Pasa;
|FIN;

|PROCESO  diam0021Pasa;
     |PARA nCampo = 0;  |SI nCampo [ 8;  |HACIENDO nCampo = nCampo + 1;
           #diam0018#nCampo# = #diam0021#nCampo#;
     |SIGUE;
     #diam0018#0 = #diaw0009#0;
     #diam0018#1 = #diam0016#1;
     #diam0018#2 = #diam0016#13;
     |GRABA 020#diam0018.n;
     |LIBERA #diam0018;

     |SI #diam0019#0 ! #diaw0009#0;
         |BORRA 020#diam0021.a;

         #diam0021#0 = #diaw0009#0;
         |GRABA 020#diam0021.n;
         |LIBERA #diam0021;
     |FINSI;
|FPRC;

|DEFBUCLE diam0021Pasa;
     #diam0021#1;
     ;
     #diam0019#0, #diam0019#1, #diam0019#13, 001;
     #diam0019#0, #diam0019#1, #diam0019#13, 999;
     be;
     NULL, diam0021Pasa;
|FIN;

|PROCESO diam0050Pasa;
     |SALVA_DATOS #diam0050;

     aFic  = #diam0050#0;
     aFic  = aFic + (("0000" + #diam0050#2) % -104);
     aFic  = aFic + #diam0050#1;                    |QBF aFic;
     aFic  = aFic + "." + #diam0050#10;             |QBF aFic;

     aOri = aPathSer + aFic;

     aAlfa = #diam0016#0;
     aAlfa = aAlfa + (#diam0016#1  % -104);
     aAlfa = aAlfa + (#diam0016#1  % 402);
     aAlfa = aAlfa + (#diam0016#1  % 102);
     aAlfa = aAlfa + (#diam0016#13 % 102);
     aAlfa = aAlfa + (#diam0016#13 % 402);
     aAlfa = aAlfa + (#diam0016#13 % 702);
     aAlfa = (aAlfa + (" " * 25)) % 125;

     #diam0050#0 = "diam0016";
     #diam0050#1 = aAlfa;
     |GRABA 000#diam0050.n;
     |LIBERA #diam0050;

     aFic  = #diam0050#0;
     aFic  = aFic + (("0000" + #diam0050#2) % -104);
     aFic  = aFic + #diam0050#1;                    |QBF aFic;
     aFic  = aFic + "." + #diam0050#10;             |QBF aFic;

     aDes  = aPathSer + aFic;

     |COPIA_FICHERO aOri, aDes;

     |REPON_DATOS #diam0050;
     |LEE 000#diam0050.=;
|FPRC;

|DEFBUCLE diam0050Pasa;
     #diam0050#1;
     ;
     eaDef, eaClv, 0001;
     eaDef, eaClv, 9999;
     ;
     NULL, diam0050Pasa;
|FIN;

|PROCESO Boton4;
     |LEE 101#diam0019.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |SI #diam0019#119 = "EN PEDIDOS";
         |MENAV "      La oferta esta EN PEDIDOS";
         |ACABA;
     |FINSI;

     |SI #diam0019#119 = "RECHAZADA ";
         |ACABA;
     |SINO;
         |CONFI "0000NSeguro de pasar la Oferta a Prepedidos";
     |FINSI;

     |SI FSalida ! 0;
         |LIBERA #diam0019;
         |ACABA;
     |FINSI;

     |VENTANA 0501, 2380, -1, -1, "";
     nVentana = FSalida;

     #diaw0009#0 = #diam0019#0;
     #diaw0009#1 = #diam0019#3;
     #diaw0009#2 = #diam0019#4;
     #diaw0009#3 = ~;

     |PINPA #0#diaw0009;
     |PINDA #0#diaw0009;
     |ENDATOS #1#diaw0009;
     aAlfa = "0000S" + &191 + " El Cliente es correcto ?";
     |CONFI aAlfa;
     |SI FSalida ! 0;
         |FINVENTANA nVentana;
         |PULSATECLA;
         |ACABA;
     |FINSI;

     |FINVENTANA nVentana;
     |PULSATECLA;

     |ABRE #diam0016;
     |PARA nCampo = 0;  |SI nCampo [ 116;  |HACIENDO nCampo = nCampo + 1;
           #diam0016#nCampo# = #diam0019#nCampo#;
     |SIGUE;


     |SI #diam0019#0 ! #diaw0009#0;
         #diam0016#0 = #diaw0009#0;
         #diam0016#3 = #diaw0009#1;
         #diam0016#4 = #diaw0009#2;

         |ABRE #agifa024;
         #agifa024#0 = #diam0016#0;
         |LEE 040#agifa024.=;
         |SI FSalida ! 0;  |DDEFECTO #agifa024; |FINSI;
         |CIERRA #agifa024;

         #diam0016#5  = #agifa024#8;
         #diam0016#6  = #agifa024#9;
         #diam0016#7  = #agifa024#10;
         #diam0016#8  = #agifa024#183;
         #diam0016#9  = #agifa024#197;
         #diam0016#10 = #agifa024#17;
        #diam0016#11 = #agifa024#18;
     |FINSI;

     |HORA aHora;

     #diam0016#1   = #diaw0009#3;
     #diam0016#13  = aHora;
     #diam0016#117 = #diam0019#127; || Oferta
     #diam0016#118 = #diam0019#118; || Para
     |GRABA 020#diam0016.n;
     |LIBERA #diam0016;
     |CIERRA #diam0016;

     eaDef = "diam0019";
     eaClv = #diam0019#0;
     eaClv = eaClv + (#diam0019#1  % -104);
     eaClv = eaClv + (#diam0019#1  % 402);
     eaClv = eaClv + (#diam0019#1  % 102);
     eaClv = eaClv + (#diam0019#13 % 102);
     eaClv = eaClv + (#diam0019#13 % 402);
     eaClv = eaClv + (#diam0019#13 % 702);
     eaClv = (eaClv + (" " * 25)) % 125;

     |DBASE aBase;  |QBF aBase;
     aPathSer = aBase + "000577/documentos/";

     |ABRE #diam0017;
     |BUCLE diam0020Pasa;
     |BUCLE diam0050Pasa;
     |CIERRA #diam0017;

     |ABRE #diam0018;
     |BUCLE diam0021Pasa;
     |CIERRA #diam0018;

     |SI #diam0019#0 ! #diaw0009#0;
         |BORRA 020#diam0019.a;

         #diam0019#0 = #diaw0009#0;
         |GRABA 020#diam0019.b;
     |FINSI;

     #diam0019#119 = "EN PEDIDOS";
     #diam0019#122 = #diam0016#1;
     #diam0019#123 = "01.01.0000";
     aAlfa   = Usuario % 810;
     #diam0019#125 = aAlfa;
     #diam0019#126 = ~;

     |GRABA 020#diam0019.a;
     |LIBERA #diam0019;

     |REFRESCACONTROL nGrid;

     |HAZ EnviaCorreo;
|FPRC;

|PROCESO Tipo80;  |TIPO 80;
     nPosi1  = 0803;
     nPosi2  = 2997;
     FSalida = 3299;
|FPRC;

|PROCESO ClaveBaja16;
     #diam0019#119 = aDEstado;
     #diam0019#0   = aDCliente;
     #diam0019#1   = fDFecha;
     #diam0019#13  = "        ";
|FPRC;

|PROCESO ClaveAlta16;
     #diam0019#119 = aHEstado;
     #diam0019#0   = aHCliente;
     #diam0019#1   = fHFecha;
     #diam0019#13  = "zzzzzzzz";
|FPRC;

|PROCESO Boton5;
     |FIN_CONTROL_WINDOWS nBoton10;
     |PULSATECLA;

     aAlfa   = "BOTON, {{206}} Todas las Fechas ";
     |CONTROL_SIMPLE nPanta, aAlfa, 3170, 3199, Boton10;
     nBoton10 = FSalida;

     aDEstado = "PENDIENTE ";
     aHEstado = "PENDIENTE ";
     fDFecha  = "01.01.0000";
     fHFecha  = "31.12.9999";

     |ESTADO_CONTROL nBoton5, "DISABLE";
     |ESTADO_CONTROL nBoton6, "ENABLE";
     |ESTADO_CONTROL nBoton7, "ENABLE";
     |ESTADO_CONTROL nBoton8, "ENABLE";
     |ESTADO_CONTROL nBoton10, "DISABLE";

     |DESTRUYECONTROL nGrid;

     |LEE 040#diam0019.p;
     nRango = 4 + 8 + 16 + 32 + 128;
     |LINEAL_SIMPLE #3#diam0019, nRango, nPosi1, nPosi2, ClaveBaja16, ClaveAlta16, Evento;
     nGrid = FSalida;
|FPRC;

|PROCESO Boton6;
     |FIN_CONTROL_WINDOWS nBoton10;
     |PULSATECLA;

     aAlfa    = "01.01." + (fFecha % -104);
     aDEstado = "RECHAZADA";
     aHEstado = "RECHAZADA";
     fDFecha  = aAlfa;
     fHFecha  = fFecha;

     aAlfa   = "BOTON, {{206}} De " + fDFecha + " a " + fHFecha;
     |CONTROL_SIMPLE nPanta, aAlfa, 3170, 3199, Boton10;
     nBoton10 = FSalida;

     |ESTADO_CONTROL nBoton6, "DISABLE";
     |ESTADO_CONTROL nBoton5, "ENABLE";
     |ESTADO_CONTROL nBoton7, "ENABLE";
     |ESTADO_CONTROL nBoton8, "ENABLE";
     |ESTADO_CONTROL nBoton10, "ENABLE";

     |DESTRUYECONTROL nGrid;

     |LEE 040#diam0019.p;
     nRango = 4 + 8 + 16 + 32 + 128;
     |LINEAL_SIMPLE #3#diam0019, nRango, nPosi1, nPosi2, ClaveBaja16, ClaveAlta16, Evento;
     nGrid = FSalida;
|FPRC;

|PROCESO Boton7;
     |FIN_CONTROL_WINDOWS nBoton10;
     |PULSATECLA;

     aAlfa    = "01.01." + (fFecha % -104);
     aDEstado = "EN PEDIDOS";
     aHEstado = "EN PEDIDOS";
     fDFecha  = aAlfa;
     fHFecha  = fFecha;

     aAlfa   = "BOTON, {{206}} De " + fDFecha + " a " + fHFecha;
     |CONTROL_SIMPLE nPanta, aAlfa, 3170, 3199, Boton10;
     nBoton10 = FSalida;

     |ESTADO_CONTROL nBoton7, "DISABLE";
     |ESTADO_CONTROL nBoton5, "ENABLE";
     |ESTADO_CONTROL nBoton6, "ENABLE";
     |ESTADO_CONTROL nBoton8, "ENABLE";
     |ESTADO_CONTROL nBoton10, "ENABLE";

     |DESTRUYECONTROL nGrid;

     |LEE 040#diam0019.p;
     nRango = 4 + 8 + 16 + 32 + 128;
     |LINEAL_SIMPLE #3#diam0019, nRango, nPosi1, nPosi2, ClaveBaja16, ClaveAlta16, Evento;
     nGrid = FSalida;
|FPRC;

|PROCESO Boton8;
     |FIN_CONTROL_WINDOWS nBoton10;
     |PULSATECLA;

     aDEstado = "          ";
     aHEstado = "zzzzzzzzzz";
     fDFecha  = "01.01.0000";
     fHFecha  = "31.12.9999";

     aAlfa   = "BOTON, {{206}} Todas las Fechas ";
     |CONTROL_SIMPLE nPanta, aAlfa, 3170, 3199, Boton10;
     nBoton10 = FSalida;

     |ESTADO_CONTROL nBoton8, "DISABLE";
     |ESTADO_CONTROL nBoton5, "ENABLE";
     |ESTADO_CONTROL nBoton6, "ENABLE";
     |ESTADO_CONTROL nBoton7, "ENABLE";
     |ESTADO_CONTROL nBoton10, "DISABLE";

     |DESTRUYECONTROL nGrid;

     |LEE 040#diam0019.p;
     nRango = 4 + 8 + 16 + 32 + 128;
     |LINEAL_SIMPLE #3#diam0019, nRango, nPosi1, nPosi2, ClaveBaja16, ClaveAlta16, Evento;
     nGrid = FSalida;
|FPRC;

|PROCESO Boton9;
     |LEE 101#diam0019.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |SI #diam0019#119 ! "PENDIENTE ";
         aAlfa = "      La oferta esta " + #diam0019#119;
         |MENAV aAlfa;
         |ACABA;
     |FINSI;

     |CONFI "0000NSeguro de Rechazar la Oferta";
     |SI FSalida ! 0;
         |LIBERA #diam0019;
         |ACABA;
     |FINSI;

     #diam0019#119 = "RECHAZADA";
     #diam0019#123 = ~;
     #diam0019#122 = "01.01.0000";

     aAlfa   = Usuario % 810;
     #diam0019#125 = aAlfa;
     #diam0019#126 = ~;

     |GRABA 020#diam0019.a;
     |LIBERA #diam0019;

     |REFRESCACONTROL nGrid;
|FPRC;

|PROCESO Boton10;
    |VENTANA 2068, 2698, -1, -1, "";
    nVentana = FSalida;

    |PINPA #0#diaw0020;
    |ENDATOS #1#diaw0020;
    |SI FSalida ! 0;
        |FINVENTANA nVentana;
        |PULSATECLA;
        |ACABA;
    |FINSI;

    |FINVENTANA nVentana;
    |PULSATECLA;

    fFecha = #diaw0020#0;

    |SI aDEstado = "RECHAZADA";  |HAZ Boton6;  |FINSI;
    |SI aDEstado = "EN PEDIDOS"; |HAZ Boton7;  |FINSI;
|FPRC;

|PROCESO MiraInforme; |TIPO 0;
     |SI #diaw0021#2 = "C";
          |C_M #diaw0021#3, 1, "N";
     |SINO;
          |C_M #diaw0021#3, 1, "S";
     |FINSI;
|FPRC;

|PROCESO Evento32;
|FPRC;

|PROCESO ClaveBaja32;
     #diam0032#0 = 0000;
     #diam0032#1 = "";
|FPRC;

|PROCESO ClaveAlta32;
     #diam0032#0 = 9999;
     #diam0032#1 = "zz";
|FPRC;

|PROCESO Boton921;
||SISCO
     |PINPA #0#diam0019;
     |ABRE #diam0032;

     |VENTANA 0725, 3099, -1, -1, "";
     nVentana32 = FSalida;
     ||SUB_PINPA #0#diam0032, nVentana;
     |PINPA #0#diam0032;

     nRango = 1 + 4 + 8 + 16 + 128;
     |LINEAL_SIMPLE #1#diam0032, nRango, 1026, 2996, ClaveBaja32, ClaveAlta32, Evento32;
     nGrid32 = FSalida;

     |FINVENTANA nVentana32;
     |CIERRA #diam0032;
|FPRC;

|PROCESO Boton11;
    |VENTANA 1162, 2896, -1, -1, "";
    nVentana = FSalida;
    |PINPA #0#diaw0021;
    nPanta921 = FSalida;

    fFechaCrys = ~;
    aAlfa = fFechaCrys;
    aAlfa = "01.01." + (aAlfa % -104);
    #diaw0021#3 = aAlfa;

    |PINDA #0#diaw0021;

    |CONTROL_SIMPLE nPanta921, "BOTON,{{137}} Tecnicos", 2669, 2689, Boton921;
    nBoton921 = FSalida;
    |ENDATOS #1#diaw0021;
    |SI FSalida ! 0;
        |FINVENTANA nVentana;
        |PULSATECLA;
        |ACABA;
    |FINSI;
    |FIN_CONTROL_WINDOWS nBoton921;
    |FINVENTANA nVentana;
    |PULSATECLA;


    fFechaCrys   = #diaw0021#0;
    aPeriodoCrys = #diaw0021#1;
    fFechaDesdeCrys = #diaw0021#3;
    aTipoInf = #diaw0021#2;   |QBF aTipoInf;
    |SI #diaw0021#2 = "C";
          |SUB_EJECUTA "diay0006";
    |SINO;
          |SUB_EJECUTA "diay0007";
    |FINSI;
|FPRC;

|PROCESO PonTecnicos;
     aAlfa = #diam0019#120;  |QBF aAlfa;
     |SI aAlfa ! "";  |ERROR10;  |ACABA;  |FINSI;

     #agifa025#0 = #diam0019#18;
     |LEE 040#agifa025.=;
     |SI FSalida = 0;
         #diam0019#120 = #agifa025#1;
     |FINSI;

     #agifa025#0 = #diam0019#29;
     |LEE 040#agifa025.=;
     |SI FSalida = 0;
         #diam0019#121 = #agifa025#1;
     |FINSI;

     |GRABA 020#diam0019.a;
     |LIBERA #diam0019;
|FPRC;

|DEFBUCLE diam0019;
     #diam0019#1;
     ;
     "      ", "01.01.0000", "        ";
     "zzzzzz", "31.12.2999", "zzzzzzzz";
     b;
     NULL, PonTecnicos;
|FIN;

|PROCESO CopiaFecha;
   #diam0019#12 = #diam0019#1;
|FPRC;

|PROCESO Docs;
     eaDef = "diam0019";
     eaClv = #diam0019#0;
     eaClv = eaClv + (#diam0019#1  % -104);
     eaClv = eaClv + (#diam0019#1  % 402);
     eaClv = eaClv + (#diam0019#1  % 102);
     eaClv = eaClv + (#diam0019#13 % 102);
     eaClv = eaClv + (#diam0019#13 % 402);
     eaClv = eaClv + (#diam0019#13 % 702);
     eaClv = (eaClv + (" " * 25)) % 125;

     |VENTANA 0501, 2999, -1, 1, "";
     nVtn = FSalida;

     |SUB_EJECUTA "diam0050";

     |FINVENTANA nVtn;
|FPRC;

|PROGRAMA;
     |ABRE #agifa025;
||     |BUCLE diam0019;
     |CIERRA #agifa025;

     |PINPA #0#diam0019;
     nPanta = FSalida;

     |SI PARAMETRO = "";
         |CONTROL_SIMPLE nPanta, "BOTON,{{193}} Nueva Oferta", 3203, 3220, Boton1;
         nBoton1 = FSalida;
         aAlfa = Usuario % 810; |QBF aAlfa;
         |SI aAlfa = "PACHISCO"; |O aAlfa = "JOSEABAD"; |O aAlfa = "JUANJO";
              |ESTADO_CONTROL nBoton1, "DISABLE";
         |FINSI;

         |CONTROL_SIMPLE nPanta, "BOTON,{{137}} Pasar a Prepedidos", 3303, 3320, Boton4;
         nBoton4 = FSalida;

         |CONTROL_SIMPLE nPanta, "BOTON,{{205}} Hoja de Oferta", 3223, 3240, Boton3;
         nBoton3 = FSalida;

         |CONTROL_SIMPLE nPanta, "BOTON,{{205}} Inf.Ventas/Margen", 3323, 3340, Boton11;
         nBoton11 = FSalida;

         |CONTROL_SIMPLE nPanta, "BOTON,{{207}} Rechazar", 3243, 3254, Boton9;
         nBoton9 = FSalida;

         |CONTROL_SIMPLE nPanta, "BOTON,{{156}} Copiar", 3256, 3267, Boton12;
         nBoton12 = FSalida;

         |CONTROL_SIMPLE nPanta, "BOTON,{{199}} Borrar Registro", 3343, 3360, Boton2;
         nBoton2 = FSalida;

         |CONTROL_SIMPLE nPanta, "BOTON,{{137}} Pendientes", 3270, 3285, Boton5;
         nBoton5 = FSalida;

         |CONTROL_SIMPLE nPanta, "BOTON,{{137}} Rechazadas", 3370, 3385, Boton6;
         nBoton6 = FSalida;

         |CONTROL_SIMPLE nPanta, "BOTON,{{137}} En Pedidos", 3287, 3299, Boton7;
         nBoton7 = FSalida;

         |CONTROL_SIMPLE nPanta, "BOTON,{{137}} Todos     ", 3387, 3399, Boton8;
         nBoton8 = FSalida;

         fFecha = ~;
         aAlfa   = "BOTON, {{206}} Todas las Fechas ";
         |CONTROL_SIMPLE nPanta, aAlfa, 3170, 3199, Boton10;
         nBoton10 = FSalida;

         |CONTROL_SIMPLE nPanta, "BOTON,{{197}}Documentos", 3003, 3016, Docs;
         nBtnDoc = FSalida;

         |ESTADO_CONTROL nBoton5,  "DISABLE";
         |ESTADO_CONTROL nBoton10, "DISABLE";
         |ESTADO_CONTROL nBtnDoc, "DISABLE";

         aDCliente = "";
         aHCliente = "zzzzzz";
     |SINO;
         aDCliente = PARAMETRO;
         aHCliente = PARAMETRO;
     |FINSI;

     aDEstado = "PENDIENTE ";
     aHEstado = "PENDIENTE ";

     fDFecha  = "01.01.0000";
     fHFecha  = "31.12.9999";

     |ABRET #diam0019;
     nRango = 4 + 8 + 16 + 32 + 128;
     |LINEAL_SIMPLE #3#diam0019, nRango, nPosi1, nPosi2, ClaveBaja16, ClaveAlta16, Evento;
     nGrid = FSalida;

     aEsc1  = &255 + "806";
     aEsc2  = &255 + "807";
     aRetu  = &255 + "802";
     |PARA; |SI;  |HACIENDO;
         FSalida = "::Salir";
         |LEETECLA aTecla;
         |SI aTecla = aEsc1; |SAL;  |FINSI;
         |SI aTecla = aEsc2; |SAL;  |FINSI;
         |SI aTecla = aRetu; |SAL;  |FINSI;
     |SIGUE;
     aTecla = "";

     |CIERRAT #diam0019;

     |SI PARAMETRO = "";
         |FIN_CONTROL_WINDOWS nBoton1;
         |FIN_CONTROL_WINDOWS nBoton2;
         |FIN_CONTROL_WINDOWS nBoton3;
         |FIN_CONTROL_WINDOWS nBoton4;
         |FIN_CONTROL_WINDOWS nBoton5;
         |FIN_CONTROL_WINDOWS nBoton6;
         |FIN_CONTROL_WINDOWS nBoton7;
         |FIN_CONTROL_WINDOWS nBoton8;
         |FIN_CONTROL_WINDOWS nBoton9;
         |FIN_CONTROL_WINDOWS nBoton10;
         |FIN_CONTROL_WINDOWS nBoton11;
         |FIN_CONTROL_WINDOWS nBoton12;
         |FIN_CONTROL_WINDOWS nBtnDoc;
     |FINSI;

     |DESTRUYECONTROL nGrid;

     |PULSATECLA;
|FPRO;

|PROCESO SubBoton10;
     |ESTADO_CONTROL nSubBoton1, "DISABLE";

     |HAZ SacaDetalles;

     |ESTADO_CONTROL nSubBoton1, "ENABLE";
|FPRC;

|PROCESO ImpLin;
     |SI nSwImp = 1;
          enTotal = enTotal + #diam0021#7;
     |SINO;
          |PRINT;
     |FINSI;
|FPRC;

|DEFBUCLE ImpLin;
     #diam0021#1;
     ;
     #diam0019#0, #diam0019#1, #diam0019#13, 001;
     #diam0019#0, #diam0019#1, #diam0019#13, 999;
     ;
     NULL, ImpLin;
|FIN;

|PROCESO ImpCrystal;
     Impresora = "CrystalReport";
     |IMPRE -1;
     |SI FSalida = 0;
          |INFOR "diam0019";
          |SI FSalida = 0;
               |ABRE #agifa091;
               #agifa091#0 = #diam0019#115;
               |LEE 040#agifa091.=;
               |SI FSalida ! 0;  |DDEFECTO #agifa091; |FINSI;
               |CIERRA #agifa091;

               |ABRE #agifa024;
               #agifa024#0 = #diam0019#0;
               |LEE 040#agifa024.=;
               |SI FSalida ! 0;  |DDEFECTO #agifa024; |FINSI;
               |CIERRA #agifa024;

               ||oculta cta bancaria
               aAlfa = #agifa024#32 % 104; aAlfa = "**" + (aAlfa % 302);
               #agifa024#32 = aAlfa;
               aAlfa = #agifa024#30 % 110; aAlfa =  (aAlfa % 106) + "****";
               #agifa024#30 = aAlfa;

               |ABRE #agifa025;
               #agifa025#0 = #diam0019#18;
               |LEE 040#agifa025.=;
               |SI FSalida ! 0;  |DDEFECTO #agifa025; |FINSI;
               |CIERRA #agifa025;
               enTotal = 0;
               nSwImp = 1; |BUCLE ImpLin;
               nSwImp = 0; |BUCLE ImpLin;
               |PIEINF;
               |FININF;
          |FINSI;
          |FINIMP;
     |SINO;
          |MENAV "0000Error en impresora 'CrystalReport'...";
     |FINSI;
|FPRC;

|PROCESO Copia18;
     #diam0021#0 = #diam0019#0;
     #diam0021#1 = #diam0019#1;
     #diam0021#2 = #diam0019#13;
     |GRABA 020#diam0021.n;
|FPRC;

|DEFBUCLE Copia18;
     #diam0021#1;
     ;
     aCliente, fFecha, aHora, 1;
     aCliente, fFecha, aHora, 999;
     ;
     NULL, Copia18;
|FIN;

|PROCESO Copia17;
     #diam0020#0 = #diam0019#0;
     #diam0020#1 = #diam0019#1;
     #diam0020#2 = #diam0019#13;
     |GRABA 020#diam0020.n;
|FPRC;

|DEFBUCLE Copia17;
     #diam0020#1;
     ;
     aCliente, fFecha, aHora, 1;
     aCliente, fFecha, aHora, 999;
     ;
     NULL, Copia17;
|FIN;

|PROCESO Boton12;
     aAlfa = "0000NSeguro de copiar oferta del cliente: " + #diam0019#0 + &13+&13;
     aAlfa = aAlfa + #diam0019#3;
     |CONFI aAlfa;
     |SI FSalida ! 0; |ACABA; |FINSI;
     |LEE 000#diam0019.=;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |SALVA_DATOS #diam0019;
     |SELECT #5#diam0019;
     |LEE 000#diam0019.u;
     |SI FSalida = 0;
          nOferta = #diam0019#127 + 1;
     |SINO;
          nOferta = 1;
     |FINSI;
     |REPON_DATOS #diam0019;

     aCliente = #diam0019#0;
     fFecha = #diam0019#1;
     aHora = #diam0019#13;

     |HORA aAlfa;
     #diam0019#1 = ~;
     #diam0019#13 = aAlfa;
     aAlfa = Usuario % 810;
     #diam0019#124 = aAlfa;
     #diam0019#125 = aAlfa;
     #diam0019#126 = ~;
     #diam0019#127 = nOferta;
     |GRABA 020#diam0019.n;
     |SI FSalida = 0;
          |BUCLE Copia17;
          |BUCLE Copia18;

          nModoDatos = 2;
          |HAZ ModoModifica;
          |REFRESCACONTROL nGrid;
     |FINSI;
|FPRC;
