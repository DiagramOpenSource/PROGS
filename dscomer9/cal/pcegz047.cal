|FICHEROS;
     pcegz047 #0,MANTE;
     pcegz048 #1,MANTE;
     pcegm029 #29;
     pcegm034 #34;
     agifa142 #142;
     pcegz047@;
     pcegz048@;

     pcegz055 #55;
|FIN;

|VARIABLES;
     &Tempo = "";
     i = 0;
     aTmp0 = "";
     aTmp1 = "";
     nHayPed = 0;
     nHayCob = 0;
     nCodPed = 0;
     nCodCob = 0;
     nSal = 0;
     aAlfa = "";
     nSwAsigna = 0;
|FIN;

|PROCESO AsignaPed;
     |ABRE #1;
     |ABRE #0;
     #0#0 = nCodPed;
     |BORRA 020#0c;
     #1#0 = nCodCob;
     |BORRA 020#1c;

     |ABRE #29;
     |ABRE #34;
     #29#0 = nCodPed;
     |LEE 121#29=;
     |SI FSalida = 0;
          #34#0 = nCodCob;
          |LEE 121#34=;
          |SI FSalida = 0;
               |SI #34#12 = 0; |Y #34#11 = " ";
                    |SI #29#27 = "T"; |Y #29#40 = 0;
                         |HAZ AsignaCobro;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
     |CIERRA #34;
     |CIERRA #29;

     |LEE 000#0p;
     |SI FSalida ! 0;
          nHayPed = 0;
     |FINSI;

     |LEE 000#1p;
     |SI FSalida ! 0;
          nHayCob = 0;
     |FINSI;

     |SI nHayPed = 0; |Y nHayCob = 0;
          |MENAV "0000No queda nada pendiente de asignar";
     |SINO;
          |SI nHayPed = 0; |MENAV "0000No quedan pedidos pendientes de asignar"; |FINSI;
          |SI nHayCob = 0; |MENAV "0000No quedan cobros pendientes de asignar"; |FINSI;
     |FINSI;
     |CIERRA #0;
     |CIERRA #1;
|FPRC;

|PROCESO QuitaMarca1;
     #pcegz048@#17 = "";
     |GRABA 020#pcegz048@.a;
|FPRC;

|DEFBUCLE QuitaMarca1;
     #pcegz048@#1001;
     ;
     000000000000;
     999999999999;
     ;
     NULL, QuitaMarca1;
|FIN;

|PROCESO Desmarca1;
     |DDEF aAlfa;
     aAlfa = aAlfa + "pcegz048";
     |CARGA_DEF aAlfa, pcegz048@;
     |SI FSalida = 0;
          |NOME_DAT #pcegz048@#aTmp1#;
          |BUCLE QuitaMarca1;
          |DESCARGA_DEF #pcegz048@;
     |FINSI;
|FPRC;

|PROCESO QuitaMarca0;
     #pcegz047@#43 = "";
     |GRABA 020#pcegz047@.a;
|FPRC;

|DEFBUCLE QuitaMarca0;
     #pcegz047@#1001;
     ;
     0000000;
     9999999;
     ;
     NULL, QuitaMarca0;
|FIN;

|PROCESO Desmarca0;
     |DDEF aAlfa;
     aAlfa = aAlfa + "pcegz047";
     |CARGA_DEF aAlfa, pcegz047@;
     |SI FSalida = 0;
          |NOME_DAT #pcegz047@#aTmp0#;
          |BUCLE QuitaMarca0;
          |DESCARGA_DEF #pcegz047@;
     |FINSI;
|FPRC;

|PROCESO Tecla1_11; |TIPO 11;
     |SI FSalida = 1;         || Esc
          nSal = 1;
          |ACABA;
     |FINSI;
     |SI FSalida = 10;        ||F2
          |ENTLINEAL #1#0, 1, 4, 20, 0, Min0, Max0;
     |FINSI;
     |SI FSalida = 11;        ||F3
          |SI nCodCob = 0; |O nCodPed = 0;
               |SI nCodCob = 0; |Y nCodPed = 0;
                    |MENAV "0000Debe de marcar el cobro y el pedido";
                    |ERROR; |ACABA;
               |SINO;
                    |SI nCodCob = 0;
                         |MENAV "0000Debe de marcar el cobro";
                         |ERROR; |ACABA;
                    |FINSI;
                    |SI nCodPed = 0;
                         |MENAV "0000Debe de marcar el pedido";
                         |ERROR; |ACABA;
                    |FINSI;
               |FINSI;
          |FINSI;
          |CONFI "0000N¿Asignar cobro al pedido?";
          |SI FSalida = 0;
               nSwAsigna = 1;
               |ERROR; |PTEC 807;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Tecla0_11; |TIPO 11;
     |SI FSalida = 1;         || Esc
          |PTEC 807;
          nSal = 1;
          |ACABA;
     |FINSI;
     |SI FSalida = 10;        ||F2
          |PTEC 807;
     |FINSI;
     |SI FSalida = 11;        ||F3
          |SI nCodCob = 0; |O nCodPed = 0;
               |SI nCodCob = 0; |Y nCodPed = 0;
                    |MENAV "0000Debe de marcar el cobro y el pedido";
                    |ERROR; |ACABA;
               |SINO;
                    |SI nCodCob = 0;
                         |MENAV "0000Debe de marcar el cobro";
                         |ERROR; |ACABA;
                    |FINSI;
                    |SI nCodPed = 0;
                         |MENAV "0000Debe de marcar el pedido";
                         |ERROR; |ACABA;
                    |FINSI;
               |FINSI;
          |FINSI;
          |CONFI "0000N¿Asignar cobro al pedido?";
          |SI FSalida = 0;
               nSwAsigna = 1;
               |ERROR; |PTEC 807; |PTEC 807;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Tecla1_0; |TIPO 0;
     |SI FSalida = 0; |Y #1Campo = Contenido;
          |SI #1#17 = "*";
               #1#17 = "";
               nCodCob = 0;
          |SINO;
               |SI nCodCob ! 0;
                    |HAZ Desmarca1;
                    |PONCONTROL 23, "SI";
               |FINSI;
               #1#17 = "*";
               nCodCob = #1#0;
          |FINSI;
          |PINTA #1#17;
          |GRABA 020#1a;
     |FINSI;
|FPRC;

|PROCESO Tecla0_0; |TIPO 0;
     |SI FSalida = 0; |Y #0Campo = Contenido;
          |SI #0#43 = "*";
               #0#43 = "";
               nCodPed = 0;
          |SINO;
               |SI nCodPed ! 0;
                    |HAZ Desmarca0;
                    |PONCONTROL 23, "SI";
               |FINSI;
               #0#43 = "*";
               nCodPed = #0#0;
          |FINSI;
          |PINTA #0#43;
          |GRABA 020#0a;
     |FINSI;
|FPRC;

|PROCESO Cobros;
     |PARA i = 0; |SI i [ 16; |HACIENDO i = i + 1;
          #1i = #34i;
     |SIGUE;
     |GRABA 020#1n;
     nHayCob = 1;
|FPRC;

|DEFBUCLE Cobros;
     #34#3;
     11;
     0, " ";
     0, " ";
     ;
     NULL, Cobros;
|FIN;

|PROCESO Pedidos;
     |PARA i = 0; |SI i [ 42; |HACIENDO i = i + 1;
          #0i = #29i;
     |SIGUE;
     |GRABA 020#0n;
     nHayPed = 1;
|FPRC;

|DEFBUCLE Pedidos;
     #29#3;
     ;
     "T", "worldpay", 0;
     "T", "worldpay", 0;
     ;
     NULL, Pedidos;
|FIN;

|PROCESO Min0;
     #0#0 = 0000000;
|FPRC;

|PROCESO Max0;
     #0#0 = 9999999;
|FPRC;

|PROCESO Min1;
     #1#0 = 000000000000;
|FPRC;

|PROCESO Max1;
     #1#0 = 999999999999;
|FPRC;

|PROGRAMA;
/*
     El pcegz055, no esta en el menu, solo faltaria adaptar este calculo
     al tmp que envia

     aAlfa = PARAMETRO;
     |NOME_DAT #55 aAlfa;
     |ABRE #55;
     |CONSULTA_CLAVE #1#55;
     |CIERRA #55;
*/

     |ABRE #142; |LEE 000#142p; |CIERRA #142;

     |HAZ CreaTempo; |NOME_DAT #0 Tempo; aTmp0 = Tempo; |DELINDEX #0;
     |HAZ CreaTempo; |NOME_DAT #1 Tempo; aTmp1 = Tempo; |DELINDEX #1;
     |ABRE #0
     |BUCLE Pedidos;
     |CIERRA #0;
     |ABRE #1;
     |BUCLE Cobros;
     |CIERRA #1;
     |SI nHayPed ! 0 ; |Y nHayCob ! 0;
          |PINPA #0#0;
          |PARA; |SI; |HACIENDO;
               |ENTLINEAL #1#0, 1, 7, 20, 0, Min0, Max0;
               |ENTLINEAL #1#1, 1, 4, 11, 0, Min1, Max1;
               |SI nSal = 1; |SAL; |FINSI;
               |SI nSwAsigna = 1;
                    |HAZ AsignaPed;
                    |SI nHayPed = 0; |O nHayCob = 0; |SAL; |FINSI;
                    nSwAsigna = 0;
               |FINSI;
          |SIGUE;
     |SINO;
          |SI nHayPed = 0; |MENAV "0000No hay pedidos pendientes"; |FINSI;
          |SI nHayCob = 0; |MENAV "0000No hay cobros pendientes"; |FINSI;
     |FINSI;
     Tempo = aTmp0; |HAZ BoraTempo; |DELINDEX #0;
     Tempo = aTmp1; |HAZ BoraTempo; |DELINDEX #1;
|FPRO;
