     ChequeaValor

|FICHEROS;
     extm0024 #24;
|FIN;

|VARIABLES;
     &eaPro = "";
     &enCod = 0;
     &eaVal = "";
     &enError = 0;
     aAlfa = "";
     nPos = 0;
     nNume = 0;
     aPosible = "";
     aDesde = "";
     aHasta = "";
     aLon = "";
     aCar = "";
     aLonNum = "";
     nDesde = 0;
     nHasta = 0;
     i = 0;
     k = 0;
     aMensa = "";
|FIN;

|PROCESO PaNa;
     || se le va la pelota al basico y entra en el 1§ proceso de
     || este calculo cuando le da la gana
|FPRC;

|PROCESO EsNumerico;
     |QBF aAlfa;
     aLonNum = aAlfa % A0;
     |PARA k = 1; |SI k [ aLonNum; |HACIENDO k = k + 1;
          nPos = k * 100 + 1;
          aCar = aAlfa % nPos;
          aCar = ".,0123456789" - aCar;
          |SI FSalida = 0; |SAL; |FINSI;
     |SIGUE;
     |SI k > aLonNum;
          FSalida = 0;
     |SINO;
          FSalida = 1;
     |FINSI;
|FPRC;

|PROCESO ChequeaValor;
     |QBF eaPro;
     |QBF eaVal;

     enError = 0;
     |ABRE #24;
     #24#0 = enCod;
     |LEE 020#24=;
     |SI FSalida = 0;
          aAlfa = #24#1; |QBF aAlfa;
          aMensa = "0000N§ Serie:" + eaPro + ", " + aAlfa + " con valor: [" + eaVal + "], ";
          |SI #24#4 = "N";
               aAlfa = eaVal;
               |HAZ EsNumerico;
               |SI FSalida ! 0;
                    aAlfa = aMensa + "el valor debe ser num‚rico...";
                    |MENAV aAlfa;
                    enError = 1;
                    |ACABA;
               |FINSI;
               nNume = eaVal; eaVal = nNume;
          |FINSI;
          aPosible = #24#6; |QBF aPosible;
          |SI aPosible ! "";
               aAlfa = aPosible - "/";
               |SI FSalida > 0;    || Desde - Hasta
                    aAlfa = FSalida % 101;
                    nPos = (aAlfa - 1) + 100;
                    aDesde = aPosible % nPos;
                    aAlfa = aDesde + "/";
                    aHasta = aPosible - aAlfa;
                    |SI #24#4 = "N";
                         nDesde = aDesde; nHasta = aHasta;
                         |SI eaVal < nDesde; |O eaVal > nHasta;
                              enError = 1;
                              aAlfa = aMensa + "el valor debe estar compendido entre:" + aDesde + " y " + aHasta;
                              |MENAV aAlfa;
                         |FINSI;
                    |SINO;
                         |SI eaVal < aDesde; |O eaVal > aHasta;
                              enError = 1;
                              aAlfa = aMensa + "el valor debe estar compendido entre:" + aDesde + " y " + aHasta;
                              |MENAV aAlfa;
                         |FINSI;
                    |FINSI;
               |SINO;              || Valores concretos
                    aLon = aPosible % A0;
                    aAlfa = "";
                    |PARA i = 1; |SI i [ aLon; |HACIENDO i = i + 1;
                         nPos = i * 100 + 1;
                         aCar = aPosible % nPos;
                         |SI aCar = ",";
                              |SI eaVal = aAlfa; |SAL; |FINSI;
                              aAlfa = "";
                         |SINO;
                              aAlfa = aAlfa + aCar;
                         |FINSI;
                    |SIGUE;
                    |SI i > aLon;
                         |SI aAlfa ! "";
                              |SI eaVal ! aAlfa;
                                   aAlfa = aMensa + "el valor debe ser:" + aPosible;
                                   |MENAV aAlfa;
                                   enError = 1;
                              |FINSI;
                         |SINO;
                              aAlfa = aMensa + "el valor debe ser:" + aPosible;
                              |MENAV aAlfa;
                              enError = 1;
                         |FINSI;
                    |FINSI;
               |FINSI;
          |FINSI;
          |SI enError = 0; |Y #24#5 ! 0;
               aLon = eaVal % A0;
               |SI aLon > #24#5;
                    aAlfa = aMensa + "la longitud de valor:" + aLon + " supera la longitud permitida:" + #24#5;
                    |MENAV aAlfa;
                    enError = 1;
               |FINSI;
          |FINSI;
     |SINO;
          aMensa = "0000N§ Serie:" + eaPro + ". ERROR no existe c¢digo caracteristica:" + #24#0;
          |MENAV aMensa;
          enError = 1;
     |FINSI;
     |CIERRA #24;
|FPRC;
