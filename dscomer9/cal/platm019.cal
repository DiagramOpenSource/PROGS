|FICHEROS;
 platm019 #0;
 platm007 #1;
 platm018 #2,MANTE;
 platw018 #3,MANTE;
 platm001 #4; ||lineas clientes
 platm026 #5; ||cabeceras clientes
 platm006 #6; ||comunidades
|FIN;

|VARIABLES;
     nHay = 0;
     aDPlata = "";
     aHPlata = "";
     aComu = "";
     aHDir = "";
     aHNum = "";;
     aHEsca = "";
     aHPiso = "";
     nHCod1 = 0;
     nHCod2 = 0;
     aDDir = "";
     aDNum = "";;
     aDEsca = "";
     aDPiso = "";
     nDCod1 = 0;
     nDCod2 = 0;
 aCli = "";
 nCli = 0;
 eaSucursal = "";
 eaEntidad = "";
 eaCuenta = "";
 eaDC = "";
 aNumer = "";
 aDirec = "";
 aPlata = "";
 aComuna = "";
 nUltima = 0;
 aCliente = "";
 Mensa = "";
 aNumero = "";
 aTiene = "";
 nModo = 0;
 nNumero = 0;
 aAlfa = "";
 aRuta = "";
 ii = 0;
 jj = 0;
 aDato = "";
 hh = 0;
 kk = 0;
 nTecla = 0;
 nTecla1 = 0;
 &nBoton2 = 0;
 Digito1 = 0;
 Digito2 = 0;
 Comodin1 = "";
 Comodin2 = "";
 Cont = 0;
 Calc = 0;
 aCaracter = "";
|FIN;

||INC-LUYE llena_c6;

|CALCULO Importe1;
#platm019#42 = 0;
|ABRE #platm007;
#platm007#0 = #platm019#9;
|LEE 010#platm007.=;
|SI FSalida ! 0;|DDEFECTO #platm007;|FINSI;
|PARA ii = 55; |SI ii [ 70;|HACIENDO ii = ii + 1;
 jj = ii - 29; ||campos s/n de este def
 |SI #0jj = "S";
  #platm019#42 = #platm019#42 + #0ii;
 |FINSI;
|SIGUE;
|PINTA #platm019#42;
|FCAL;

|CALCULO MiraQuePido1;
#platm019#42 = 0;
|ABRE #platm007;
#platm007#0 = #platm019#9;
|LEE 010#platm007.=;
|SI FSalida ! 0;|DDEFECTO #platm007;|FINSI;
|PARA ii = 2;|SI ii [ 17;|HACIENDO ii = ii + 1;
jj = ii + 24;
hh = jj - 16; ||campos descripcion
kk = ii + 53; ||campos importe
aDato = #1ii;
|QBT aDato;
|SI aDato = "OTRO";
  |CAMPO_MODIFICA #0hh, 1, "S";
  |CAMPO_MODIFICA #0kk, 1, "S";
|SINO;
  |CAMPO_MODIFICA #0hh, 1, "N";
  |CAMPO_MODIFICA #0kk, 1, "N";
|FINSI;
|SI aDato = "";
  |CAMPO_MODIFICA #0jj, 1, "N";
|SINO;
  |CAMPO_MODIFICA #0jj, 1, "S";
|FINSI;
|SIGUE;
|FCAL;

|CALCULO cont019;|TIPO 7;
nModo = (FEntrada/100)!0;
|SI nModo = 1;
  |ABRE #0;
  |LEE 010#0u;
  |SI FSalida ! 0;
    nNumero = 1;
  |SINO;
    nNumero = #0#0;
    nNumero = nNumero + 1;
  |FINSI;
  |LIBERA #0;
  |DDEFECTO #0;
  #0#0 = nNumero;
|FINSI;
|FCAL;

|PROCESO Desde1;
#platm001#0 = #platm026#0;
#platm001#18 = 001;
|FPRC;
|PROCESO Hasta1;
#platm001#0 = #platm026#0;
#platm001#18 = 999;
|FPRC;

|CALCULO Direc; |TIPO 7;
nModo = (FEntrada/100)!0;
|SI nModo ! 1;|ACABA;|FINSI;
|SI #platm019#72 > 0;|ACABA;|FINSI;
|ABRE #platm026;
#platm026#0 = #platm019#1;
|LEE 010#platm026.=;
|SI FSalida = 0;
  |ABRE #platm001;
  #platm001#0 = #platm026#0;
  #platm001#18 = 1;
  |LEE 000#platm001.];
  |PARA;|SI FSalida = 0;|Y #platm001#0=#platm026#0;|HACIENDO;
    |LEE 000#platm001.s;
    |SI #platm001#0 = #platm026#0;
      nUltima = #platm001#18;
    |FINSI;
  |SIGUE;
  #platm001#0 = #platm026#0;
  #platm001#18 = 1; ||linea
  |LEE 010#platm001.];
  |SI FSalida = 0;|Y #platm001#0 = #platm026#0;
    nNumero = #platm001#18;
    |LEE 001#platm001.s;
    |SI FSalida = 0;|Y #platm001#0 = #platm026#0; ||si tiene mas de una direc
      |CONSULTA_F_CLAVE #1#platm001,Desde1,Hasta1;
      |SI FSalida = 0;
        #0#72 = #platm001#18;
        |PTEC 802;
      |SINO;
        #0#72 = nUltima + 1;
      |FINSI;
    |SINO;
      #0#72 = nNumero;
      |PTEC 802;
    |FINSI;
  |FINSI;
|FINSI;
|LIBERA #platm026;
|CIERRA #platm026;
|FCAL;

|CALCULO GrabaPlat1;|TIPO 2;
nModo = (FEntrada/100) ! 0;
  |ABRE #platm001;
  #platm001#0 = #platm019#1;
  #platm001#18 = #platm019#72;
  |LEE 010#platm001.=;
  |SI FSalida = 0;
    |SI nModo = 1;|O nModo = 2;
      #platm001#19 = #platm019#9; ||plataforma
    |SINO;
      |SI nModo = 3;
        #platm001#19 = ""; ||en la baja, se borra
      |FINSI;
    |FINSI;
    |GRABA 010#platm001.a;
  |FINSI;
  |LIBERA #platm001;
  |CIERRA #platm001;

|FCAL;

|PROCESO BuscaMas;
aNumero = #platm019#0;
Mensa = Mensa + aNumero + " ";
aTiene = "S";
|FPRC;


|DEFBUCLE BuscaMas;
#platm019#2;
;
aCliente,000,"N";
aCliente,999,"N";
;
NULL,BuscaMas;
|FIN;

|CALCULO MiraMas;
nModo = (FEntrada/100)!0;
|SI nModo = 1;
 aCliente = #platm019#1;
 |SALVA_FICHA #platm019;
   Mensa = "0000 Este Cliente Tiene solicitudes en: ";
   aTiene = "N";
   |BUCLE BuscaMas;
   |SI aTiene = "S";
     |MENAV Mensa;
   |FINSI;
 |REPON_FICHA #platm019;
|FINSI;
|FCAL;

|PROCESO ExisteInsta;|TIPO 7;
aComuna = #0#75;
|QBT aComuna;
|SI aComuna !  "";
     |ABRE #platm006;
     #platm006#0 = #platm019#75;
     |LEE 010#platm006.=;
     |SI FSalida = 0;
          #platm019#76 = #platm006#11;
          |PINTA #platm019#76;
     |FINSI;
     |LIBERA #platm006;
     |CIERRA #platm006;
|SINO;
     #platm019#76 = "";
     |PINTA #platm019#76;
|FINSI;


|FPRC;

|CALCULO Insta;
aComuna = #0#75;
|QBT aComuna;
|SI aComuna ! "";
 |ABRE #platm006;
 #platm006#0 = #platm019#75;
 |LEE 010#platm006.=;
 |SI FSalida = 0;
   |SI #platm006#11 ! #platm019#76;
     |SI #platm019#76 ! "    ";
       |MENAV "0000 Este instalador no corresponde con el de la comunidad";
       |ERROR;
     |FINSI;
   |FINSI;
 |FINSI;
 |LIBERA #platm006;
 |CIERRA #platm006;
|FINSI;
|FCAL;

|CALCULO Comuna;
aComuna = #0#75;
|QBT aComuna;
|SI aComuna ! "";
 |ABRE #platm001;
 #platm001#0 = #platm019#1;
 #platm001#18 = #platm019#72;
 |LEE 010#platm001.=;
 |SI FSalida = 0;
   |SI #platm001#12 ! #platm019#75;
     |MENAV "0000 Esta Comunidad no es de esta direccion";
     |ERROR;
   |FINSI;
 |FINSI;
 |LIBERA #platm001;
 |CIERRA #platm001;
|FINSI;
|FCAL;

|CALCULO Dir;
|SI FSalida = 10;
  #0#72 = 0;
  |HAZ Direc;
|FINSI;
|FCAL;

|CALCULO xxxcomunidad19; ||ANULADO
aDirec = #0#50;
aNumer = #0#79;
aPlata = #0#9;
|QBT aDirec;
|QBT aNumer;
|QBT aPlata;
|SI aDirec = "";|O aNumer = "";|O aPlata = "";|ACABA;|FINSI;||NO TRAE HASTA QUE NO TENGA DATOS
|ABRE #6;
|SELECT #3#6;
#6#2 = #0#50;
#6#4 = #0#77;
#6#5 = #0#78;
#6#8 = #0#79;
#6#9 = #0#80;
#6#10 = #0#81;
#6#12 = #0#9;
|LEE 010#6=;
|SI FSalida = 0;
  #0#75 = #6#0;
  ||  #0#17 = #1#1; nombre comunidad
  |PINTA #0#75;
|FINSI;
|LIBERA #6;
|CIERRA #6;
|FCAL;

|PROCESO desde19;
#platm006#2 = #0#50;
#platm006#8 = #0#79;
#platm006#12 = "";
|FPRC;
|PROCESO hasta19;
#platm006#2 = #0#50;
#platm006#8 = #0#79;
#platm006#12 = "zzzz";
|FPRC;

|CALCULO xxnumcalle; ||ANULADO
|ABRE #platm006;
#platm006#2 = #0#50;
#platm006#8 = #0#79;
#platm006#12 = "";
|SELECT #3#platm006;
|LEE 010#platm006.];
|SI FSalida = 0;|Y #platm006#2 = #0#50;|Y #platm006#8 = #0#79;
  aDirec = #0#50;
  aNumer = #0#79;
  aPlata = #0#12;
  |LEE 010#platm006.s;
  |SI FSalida = 0;|Y #platm006#2 = #0#50;|Y #platm006#8 = #0#79;
    |CONSULTA_F_CLAVE #3#platm006,desde19,hasta19;
    |SI FSalida = 0;
      #0#9 = #platm006#12;
      #0#75 = #platm006#0;
      |PINTA #0#9;
      |PINTA #0#75;
    |FINSI;
  |FINSI;
|FINSI;
|FCAL;

|PROCESO CalculoDC19;
   Digito1 = 0; Digito2 = 0;
   Comodin1 = ""; Comodin2 = "";

   |PARA Cont = 1; |SI Cont [ 4; |HACIENDO Cont = Cont + 1;
      Calc = 0 - ((100 * Cont) + 1);
      aCaracter = eaSucursal % Calc;
      |SI aCaracter = ""; aCaracter = "0"; |FINSI;
      Comodin1 = Comodin1 + aCaracter;
   |SIGUE;
   |PARA Cont = 1; |SI Cont [ 4; |HACIENDO Cont = Cont + 1;
      Calc = 0 - ((100 * Cont) + 1);
      aCaracter = eaEntidad % Calc;
      |SI aCaracter = ""; aCaracter = "0"; |FINSI;
      Comodin1 = Comodin1 + aCaracter;
   |SIGUE;

   |PARA Cont = 1; |SI Cont [ 8; |HACIENDO Cont = Cont + 1;
      Calc = (100 * Cont) + 1;
      aCaracter = Comodin1 % Calc; Calc = aCaracter;
      |SI Cont = 1; Digito1 = Digito1 + (Calc * 6);  |FINSI;
      |SI Cont = 2; Digito1 = Digito1 + (Calc * 3);  |FINSI;
      |SI Cont = 3; Digito1 = Digito1 + (Calc * 7);  |FINSI;
      |SI Cont = 4; Digito1 = Digito1 + (Calc * 9);  |FINSI;
      |SI Cont = 5; Digito1 = Digito1 + (Calc * 10); |FINSI;
      |SI Cont = 6; Digito1 = Digito1 + (Calc * 5);  |FINSI;
      |SI Cont = 7; Digito1 = Digito1 + (Calc * 8);  |FINSI;
      |SI Cont = 8; Digito1 = Digito1 + (Calc * 4);  |FINSI;
   |SIGUE;

   Digito1 = 11 - (Digito1 $ 11);
   |SI Digito1 = 10; Digito1 = 1; |FINSI;
   |SI Digito1 = 11; Digito1 = 0; |FINSI;

   |PARA Cont = 1; |SI Cont [ 10; |HACIENDO Cont = Cont + 1;
      Calc = 0 - ((100 * Cont) + 1);
      aCaracter = eaCuenta % Calc;
      |SI aCaracter = ""; aCaracter = "0"; |FINSI;
      Comodin2 = Comodin2 + aCaracter;
   |SIGUE;

   |PARA Cont = 1; |SI Cont [ 10; |HACIENDO Cont = Cont + 1;
      Calc = (100 * Cont) + 1;
      aCaracter = Comodin2 % Calc; Calc = aCaracter;
      |SI Cont = 1;  Digito2 = Digito2 + (Calc * 6);  |FINSI;
      |SI Cont = 2;  Digito2 = Digito2 + (Calc * 3);  |FINSI;
      |SI Cont = 3;  Digito2 = Digito2 + (Calc * 7);  |FINSI;
      |SI Cont = 4;  Digito2 = Digito2 + (Calc * 9);  |FINSI;
      |SI Cont = 5;  Digito2 = Digito2 + (Calc * 10); |FINSI;
      |SI Cont = 6;  Digito2 = Digito2 + (Calc * 5);  |FINSI;
      |SI Cont = 7;  Digito2 = Digito2 + (Calc * 8);  |FINSI;
      |SI Cont = 8;  Digito2 = Digito2 + (Calc * 4);  |FINSI;
      |SI Cont = 9;  Digito2 = Digito2 + (Calc * 2);  |FINSI;
      |SI Cont = 10; Digito2 = Digito2 + (Calc * 1);  |FINSI;
   |SIGUE;

   Digito2 = 11 - (Digito2 $ 11);
   |SI Digito2 = 10; Digito2 = 1; |FINSI;
   |SI Digito2 = 11; Digito2 = 0; |FINSI;

   eaDC = Digito1 + Digito2;
|FPRC;

|CALCULO Digito19;|TIPO 7;
|SI #0#7 = "  ";
  eaEntidad = #0#4;
  eaSucursal = #0#5;
  eaCuenta = #0#6;
  |QBF eaEntidad; eaEntidad = eaEntidad % 104;
  |QBF eaSucursal; eaSucursal = eaSucursal % 104;
  |QBF eaCuenta; eaCuenta = eaCuenta % 110;
  eaDC = "";
  |HAZ CalculoDC19;
  #0#7 = eaDC;
  |PINTA #0#7;
|FINSI;
|FCAL;

|CALCULO UltimoCliente;|TIPO 6;
|SI FSalida = 10;
 |ABRE #platm001;
 |LEE 000#platm001.p;
 |LEE 000#platm001.u;
 aCli = #platm001#0;
 nCli = aCli;
 nCli = nCli + 1;
 aCli = nCli;
 aCli = ("000000"+aCli)%-106;
 #0#1 = aCli;
 |PINTA #0#1;
|FINSI;
|FCAL;

|PROCESO Comunidad19;
     |SI #0Campo ! Contenido;
          |ABRE #6;
          |SELECT #3#6;
          #6#2 = #0#50;
          #6#3 = #0#51;
          #6#8 = #0#79;
          |LEE 000#6=;
          |SI FSalida = 0;
               #0#75 = #6#0;
               |PINTA #0#75;
          |FINSI;
          |CIERRA #6;
     |FINSI;
|FPRC;
