|FICHEROS;
     mecam006 #6;
     mecam001 #1;
     mecam004 #4;
     agifa017 #17;
     agifa019 #19;
     dsm00024 #24;
     agifa049 #49;
|FIN;

|VARIABLES;
     &enUnidad1 = 0;
     &enUnidad2 = 0;
     &eaSerie = "";
     &enDocu = 0;
     &enLinea = 0;
     &eaArticulo = "";
     &enAlmacen = 0;
     enForma = 0;
     nFactor = 0;
     nUni = 0;
     nForma = 0;
|FIN;

|PROCESO EscanLin;
     |DDEFECTO #4;
     #4#0 = #49#0;
     #4#1 = #49#1;
     |LEE 000#4=;
     |SI #4#2 = "S"; || Film = S
          |SI #6#3 = "N"; |ACABA; |FINSI;
          nFactor = 1;
          |SI #6#3 = "A"; nFactor = 2; |FINSI;
     |SINO;
          nFactor = 1;
     |FINSI;

     |SI enUnidad2 ! 0;
          nUni = #49#12 * nFactor * enUnidad2 * nForma;
     |SINO;
          nUni = #49#12 * nFactor * enUnidad1 * nForma;
     |FINSI;

     #19#0 = #49#2;
     |LEE 101#19=;
     |SI FSalida = 0;
          #19#12 = #19#12 + nUni;
          #19#104 = #19#104 - nUni;

          #17#0 = #49#2;
          #17#1 = enAlmacen;
          |LEE 101#17=;
          |SI FSalida = 0;
               #17#8 = #17#8 + nUni;
               #17#39 = #17#39 - nUni;
               |SI #19#180 = "S";
                    |DDEFECTO #24;
                    #24#0 = #49#2;
                    #24#1 = enAlmacen;
                    #24#2 = "";
                    |LEE 101#24=;
                    |SI FSalida ! 0; |GRABA 020#24b; |FINSI;
                    #24#24 = #24#24 + nUni;
                    #24#22 = #24#22 - nUni;
                    |HAZ ValoraStock;
                    |GRABA 020#24a;
                    |LIBERA #24;
               |FINSI;
               |HAZ ValoraStock;
               |GRABA 020#17a;
               |LIBERA #17;
          |FINSI;
          |GRABA 020#19a;
          |LIBERA #19;
     |FINSI;
|FPRC;

|DEFBUCLE EscanLin;
     #49#1;
     ;
     eaArticulo, 001;
     eaArticulo, 999;
     ;
     NULL, EscanLin;
|FIN;

|PROGRAMA;
     |ABRE #6;
     #6#0 = eaSerie;
     #6#1 = enDocu;
     #6#2 = enLinea;
     |LEE 101#6=;
     |SI FSalida ! 0; |GRABA 020#6b; |FINSI;
     |SI #6#8 ! 0;
          |MENAV "0000Linea con Orden de Fabricacion...";
     |SINO;
          |ABRE #1;
          #1#0 = eaArticulo;
          |LEE 000#1=;
          |CIERRA #1;

          |SI #6#10 = "S";
               #6#10 = "N";
               nForma = 1;
          |SINO;
               #6#10 = "S";
               nForma = -1;
          |FINSI;

          |SI #1#3 = "S";
               |ABRE #4;
               |ABRE #17;
               |ABRE #19;
               |ABRE #24;
               |BUCLE EscanLin;
               |CIERRA #24;
               |CIERRA #19;
               |CIERRA #17;
               |CIERRA #4;
          |FINSI;

          |GRABA 020#6a;
     |FINSI;
     |CIERRA #6;
|FPRO;
