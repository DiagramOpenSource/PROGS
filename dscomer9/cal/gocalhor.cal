|FICHEROS;
     gocalhor #0; ||Este Def.
     aomcost@ #1; ||Costes de Nominas.
     gotrabaj #2; ||Trabajadores.
     gocatcon #3; ||Convenios/Categorias.
     gocaltmp #4; ||Auxiliar
     gocatcot #5; ||Tipos Horas
     agifa019 #19;
     gopartli #10;
     goptrbli #11;
     gopartia #12;
     aomobras@ #13;
     gopartca #14;
     agifa321;
|FIN;

|VARIABLES;
     &Tempo = "";
     aAlfa     = "";
     fDfecha   = @;
     fHfecha   = @;
     nNume     = 0;
     &cCodMonTrab = "";
     aPath  = "";
     aPatf  = "";
     aDef2  = "";
     aDef1  = "";
     swErr  = 0;
     nSal   = 0;
     nPrecio = 0;
     nTraba = 0;
|FIN;

|PROCESO CargaDef;
     |DBASS aPath;
     |QBF aPath;
     aPath = aPath + "aginom/";
     aPatf = aPath + "fich/";

     aDef1 = aPath + "def/" + "aomcoste";
     |CARGA_DEF aDef1, aomcost@;
     |SI FSalida ! 0;
          swErr = 1;
          aDef1 = "";
     |FINSI;

     aDef2 = aPath + "def/" + "aomobras";
     |CARGA_DEF aDef2, aomobras@;
     |SI FSalida ! 0;
          swErr = 1;
          aDef1 = "";
     |FINSI;
|FPRC;

|PROCESO DesCargaDef;
     |SI aDef1  ! ""; |DESCARGA_DEF #aomcost@; |FINSI;
     |SI aDef2  ! ""; |DESCARGA_DEF #aomobras@; |FINSI;
|FPRC;

|PROCESO gocatcot;
     #5#5 = #3#4;
     |SI #5#12 ! 0;
          #5#5 = #5#5 + #5#12;
     |FINSI;
     |SI #5#18 ! 0;
          #5#5 = #5#5 + (#5#5 * #5#12 / 100);
     |FINSI;

     #5#7 = #3#9;
     |SI #5#14 ! 0;
          #5#7 = #5#7 + #5#14;
     |FINSI;
     |SI #5#20 ! 0;
          #5#7 = #5#7 + (#5#7 * #5#20 / 100);
     |FINSI;

     #5#9 = #3#10;
     |SI #5#16 ! 0;
          #5#9 = #5#9 + #5#16;
     |FINSI;
     |SI #5#22 ! 0;
          #5#9 = #5#9 + (#5#9 * #5#22 / 100);
     |FINSI;
     |GRABA 020#5a;
     |LIBERA #5;
|FPRC;

|DEFBUCLE gocatcot;
     #5#1;
     ;
     #3#0, #3#1, 001;
     #3#0, #3#1, 999;
     be;
     NULL, gocatcot;
|FIN;

|PROCESO gocaltmp;
     |DDEFECTO #3;
     #3#0 = #4#2;
     #3#1 = #4#1;
     |LEE 101#3=;
     |SI FSalida ! 0; |GRABA 020#3b; |FINSI;
     ||Coste
     #3#4 =  #4#3 / #4#4;
     #3#9 = #3#4;
     #3#10 = #3#4;
     |BUCLE gocatcot;

     |GRABA 020#3a;
     |LIBERA #3;

     #19#0 = #3#13;
     |LEE 101#19=;
     |SI FSalida = 0;
          #19#9 = #3#4;
          #19#28 = #3#4;
          #19#163 = #3#4;
          #19#133 = #3#4;
          #19#164 = #3#4;
          #19#165 = #agifa321#9;
          |GRABA 020#19a;
          |LIBERA #19;
     |FINSI;
|FPRC;

|DEFBUCLE gocaltmp;
     #4#2;
     ;
     001,01;
     999,99;
     ;
     NULL,gocaltmp;
|FIN;

|PROCESO aomcoste;
     #2#0 = #1#4;
     |LEE 000#2=;
     |SI FSalida ! 0;
          |ACABA;
     |FINSI;

     |DDEFECTO #4;
     #4#0 = #1#4;
     |LEE 101#4=;
     nSal = FSalida;
     #4#1 = #2#2; ||Convenio.
     #4#2 = #2#3; ||Categoria.
     #4#3 = #4#3 + #1#5 + #1#8 + #1#9 + #1#11 + #1#17 + #1#18 + #1#12 + #1#13;
     #4#4 = #4#4 + #1#10;

     |SI nSal = 0; |GRABA 020#4a; |FINSI;
     |SI nSal ! 0; |GRABA 020#4n; |FINSI;
     |LIBERA #4;
|FPRC;

|DEFBUCLE aomcoste;
     #1#1006;
     ;
     #0#1,#0#0,00001,00,#0#2,00001;
     #0#1,#0#0,99999,99,#0#3,99999;
     ;
     NULL,aomcoste;
|FIN;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO gopartia_1;
     #12#12 =  nPrecio;
     #12#14 = #12#12 * #12#10; ||Imp. Coste
     |GRABA 020#12a;
     |LIBERA #12;
|FPRC;

|DEFBUCLE gopartia_1;
     #12#1;
     ;
     "T", #11#23, #11#24, #11#3, 001;
     "T", #11#23, #11#24, #11#3, 999;
     be;
     NULL, gopartia_1;
|FIN;

|PROCESO goptrbli_1;
     |BUCLE gopartia_1;
|FPRC;

|DEFBUCLE goptrbli_1;
     #11#2;
     ;
     #13#2, 000001, fDfecha, 0001, nTraba;
     #13#2, 999999, fHfecha, 9999, nTraba;
     ;
     NULL, goptrbli_1;
|FIN;

|PROCESO aomcoste_1;
     #13#0 = #1#2;
     |LEE 020#13=;
     |SI FSalida = 0;
          nPrecio = #1#5 + #1#8 + #1#9 + #1#11 + #1#17 + #1#18 + #1#12 + #1#13;
          nPrecio = nPrecio / #1#10;

          aAlfa = "01." + (("00" + #1#1) % -102) + ".20" + (("00" + #1#0) % -102);
          fDfecha = aAlfa;
          fHfecha = fDfecha + 0.001;
          nNume = fHfecha - 1;
          fHfecha = nNume;

          nTraba = #1#4;
          |BUCLE goptrbli_1;
     |FINSI;
|FPRC;

|DEFBUCLE aomcoste_1;
     #1#1006;
     ;
     #0#1,#0#0,00001,00,#0#2,00001;
     #0#1,#0#0,99999,99,#0#3,99999;
     ;
     NULL, aomcoste_1;
|FIN;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO gopartia;
     #11#13 = #11#13 + #12#14;
|FPRC;

|DEFBUCLE gopartia;
     #12#1;
     ;
     "T", #11#23, #11#24, #11#3, 001;
     "T", #11#23, #11#24, #11#3, 999;
     be;
     NULL, gopartia;
|FIN;

|PROCESO goptrbli;
     #11#13 = 0;
     |BUCLE gopartia;
     #11#15 = #11#13;
     #11#17 = #11#13 * #11##11;
     #11#19 = #11#15;
     |GRABA 020#11a;
     |LIBERA #11;

     #10#9 = #10#9 + #11#17;
|FPRC;

|DEFBUCLE goptrbli;
     #11#1;
     ;
     #10#0, #10#1, #10#3, 0001;
     #10#0, #10#1, #10#3, 9999;
     be;
     NULL, goptrbli;
|FIN;

|PROCESO gopartli;
     #14#0 = #10#14;
     #14#1 = #10#15;
     |LEE 121#14=;
     |SI FSalida = 0;
          #14#6 = #14#6  - #10#9;

          #10#9 = 0;
          |BUCLE goptrbli;
          #10#11 = #10#9;
          |GRABA 020#10a;
          |LIBERA #10;

          #14#6 = #14#6  + #10#9;
          |GRABA 020#14a;
          |LIBERA #14;
     |FINSI;
|FPRC;

|DEFBUCLE gopartli;
     #10#2;
     ;
     "     ", 000001, fDfecha;
     "zzzzz", 999999, fHfecha;
     be;
     NULL, gopartli;
|FIN;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO ejec; |TIPO 3;
     |HAZ DecimalesBase;
     cCodMonTrab = #agifa321#9;
     |HAZ MonBas;
     |HAZ CargaDef;

     |SI swErr = 1;
          |ACABA;
     |FINSI;

     |PATH_DAT #1 aPatf;
     |PATH_DAT #13 aPatf;

     |HAZ CreaTempo;
     |NOME_DAT #3 Tempo; |DELINDEX #4;

     |ABRE #4;
     |ABRE #2;
     |BUCLE aomcoste;
     |CIERRA #4;
     |CIERRA #2;

     |ABRE #3;
     |ABRE #19;
     |BUCLE gocaltmp;
     |CIERRA #19;
     |CIERRA #3;

     |ABRE #13;
     |BUCLE aomcoste_1;
     |CIERRA #13;

     aAlfa = "01." + (("00" + #0#0) % -102) + ".20" + (("00" + #0#1) % -102);
     fDfecha = aAlfa;
     fHfecha = fDfecha + 0.001;
     nNume = fHfecha - 1;
     fHfecha = nNume;

     |ABRE #14;
     |BUCLE gopartli;
     |CIERRA #14;

     |HAZ DesCargaDef;
     |HAZ BoraTempo; |DELINDEX #4;
|FPRC;
