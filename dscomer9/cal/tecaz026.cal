     ||Copia del dsz00004

|FICHEROS;
     tecaz026 #0;
     agifa017 #17;
     agifa019 #19;
     agifa321;
     agifa324;
|FIN;

|VARIABLES;
     &eaArticulo = "";
     &enAlta = 0;
     &nDeci_PreDiv  = 0;
     &nDeci_Base    = 0;
     &nDeci_PreBase = 0;
     nEntero   = 0;
     nCampo    = 0;
     nResto    = 0;
     nTarifa1  = 0;
     nTarifa2  = 0;
     nTarifa3  = 0;
     nTarifa4  = 0;
     nTarifa5  = 0;
     nTarifa6  = 0;
|FIN;

|PROCESO Calculo;
     nCampo = Campo - 15;
     |C_M #0nCampo, 1, "S";
     |SI #0Campo = "N";
         |C_M #0nCampo, 1, "N";
         #0nCampo = 0;  |PINTA #0nCampo;
     |FINSI;
|FPRC;

|PROCESO Tarifa;
     |SI #0#12 = 1;
         |PINTA 1820, "2";  |PINTA 1840, "3";
         |PINTA 1920, "4";  |PINTA 1940, "5";
         |PINTA 2020, "6";

         nTarifa1  = 51;   nTarifa2  = 52;   nTarifa3  = 53;
         nTarifa4  = 54;   nTarifa5  = 55;   nTarifa6  = 56;
     |FINSI;

     |SI #0#12 = 2;
         |PINTA 1820, "1";  |PINTA 1840, "3";
         |PINTA 1920, "4";  |PINTA 1940, "5";
         |PINTA 2020, "6";

         nTarifa1  = 52;   nTarifa2  = 51;   nTarifa3  = 53;
         nTarifa4  = 54;   nTarifa5  = 55;   nTarifa6  = 56;
     |FINSI;

     |SI #0#12 = 3;
         |PINTA 1820, "1";  |PINTA 1840, "2";
         |PINTA 1920, "4";  |PINTA 1940, "5";
         |PINTA 2020, "6";

         nTarifa1  = 53;   nTarifa2  = 51;   nTarifa3  = 52;
         nTarifa4  = 54;   nTarifa5  = 55;   nTarifa6  = 56;
     |FINSI;

     |SI #0#12 = 4;
         |PINTA 1820, "1";  |PINTA 1840, "2";
         |PINTA 1920, "3";  |PINTA 1940, "5";
         |PINTA 2020, "6";

         nTarifa1  = 54;   nTarifa2  = 51;   nTarifa3  = 52;
         nTarifa4  = 53;   nTarifa5  = 55;   nTarifa6  = 56;
     |FINSI;

     |SI #0#12 = 5;
         |PINTA 1820, "1";  |PINTA 1840, "2";
         |PINTA 1920, "3";  |PINTA 1940, "4";
         |PINTA 2020, "6";

         nTarifa1  = 55;  nTarifa2  = 51;   nTarifa3  = 52;
         nTarifa4  = 53;  nTarifa5  = 54;   nTarifa6  = 56;
     |FINSI;

     |SI #0#12 = 6;
         |PINTA 1820, "1";  |PINTA 1840, "2";
         |PINTA 1920, "3";  |PINTA 1940, "4";
         |PINTA 2020, "5";

         nTarifa1  = 56;   nTarifa2  = 51;   nTarifa3  = 52;
         nTarifa4  = 53;   nTarifa5  = 54;   nTarifa6  = 55;
     |FINSI;
|FPRC;

|PROCESO CalcuPVP;
     |DDEFECTO #19;
     #19#0 = #17#0;
     |LEE 000#19=;
     |SI #19#125 < #0#17; |O #19#125 > #0#18; |ACABA; |FINSI;
     |SI #19#2 < #0#13; |O #19#2 > #0#14; |ACABA; |FINSI;
     |SI #19#3 < #0#15; |O #19#3 > #0#16; |ACABA; |FINSI;
     |SI #19#27 < #0#19; |O #19#2 > #0#20; |ACABA; |FINSI;

     |SI #0#2 = "B";
         #17nTarifa1 = #17nTarifa1 + ((#0#3 * #17nTarifa1) / 100 );
         nResto = (#0#4 + #0#5) / 100;
     |SINO;
         nResto = (#0#3 + #0#4 + #0#5) / 100;
     |FINSI;

     nResto = 1 - nResto;
     #17nTarifa1 = #17nTarifa1 / nResto;
     |SI #0#11 ! 0;
          #17nTarifa1 = #17nTarifa1 / #0#11;
          #0#26 = #17nTarifa1;
          |SI #0#26 > #17nTarifa1;
               #0#26 = #0#26 - 1;
          |FINSI;
          |SI #0#27 = 1;
               #0#26 = #0#26 + 1 ;
          |FINSI;
          #17nTarifa1 = #0#26 * #0#11;
     |FINSI;

     |SI #0#21 = "S"
         |SI #0#6 ! 0; |Y #0#11 ! 0;
             #17nTarifa2 = #17nTarifa1 > #0#6;
             #0#26       = #17nTarifa2 / #0#11;
             nEntero     = #17nTarifa2 / #0#11;
             |SI #0#26 > nEntero;
                  #0#26 = #0#26 - 1;
             |FINSI;
             |SI #0#27 = 1;
                  #0#26 = #0#26 + 1 ;
             |FINSI;
             #17nTarifa2 = #0#26 * #0#11;
         |SINO;
             #17nTarifa2 = #17nTarifa1;
         |FINSI;
     |FINSI;

     |SI #0#22 = "S"
         |SI #0#7 ! 0;
             #17nTarifa3   = #17nTarifa1 > #0#7;
             nResto        = #17nTarifa3 $ #0#11;
             |SI nResto ! 1;
                 nResto      = #0#11  - nResto;
                 #17nTarifa3 = #17nTarifa3 + nResto;
             |FINSI;
         |SINO;
             #17nTarifa3 = #17nTarifa1;
         |FINSI;
     |FINSI;

     |SI #0#23 = "S"
         |SI #0#8 ! 0; |Y #0#11 ! 0;
             #17nTarifa4 = #17nTarifa1 > #0#8;
             #0#26       = #17nTarifa4 / #0#11;
             nEntero     = #17nTarifa4 / #0#11;
             |SI #0#26 > nEntero;
                  #0#26 = #0#26 - 1;
             |FINSI;
             |SI #0#27 = 1;
                  #0#26 = #0#26 + 1 ;
             |FINSI;
             #17nTarifa4 = #0#26 * #0#11;
         |SINO;
             #17nTarifa4 = #17nTarifa1;
         |FINSI;
     |FINSI;

     |SI #0#24 = "S"
         |SI #0#9 ! 0; |Y #0#11 ! 0;
             #17nTarifa5 = #17nTarifa1 > #0#9;
             #0#26       = #17nTarifa5 / #0#11;
             nEntero     = #17nTarifa5 / #0#11;
             |SI #0#26 > nEntero;
                  #0#26 = #0#26 - 1;
             |FINSI;
             |SI #0#27 = 1;
                  #0#26 = #0#26 + 1 ;
             |FINSI;
             #17nTarifa5 = #0#26 * #0#11;
         |SINO;
             #17nTarifa5 = #17nTarifa1;
         |FINSI;
     |FINSI;

     |SI #0#25 = "S"
         |SI #0#10 ! 0; |Y #0#11 ! 0;
             #17nTarifa6 = #17nTarifa1 > #0#10;
             #0#26       = #17nTarifa6 / #0#11;
             nEntero     = #17nTarifa6 / #0#11;
             |SI #0#26 > nEntero;
                  #0#26 = #0#26 - 1;
             |FINSI;
             |SI #0#27 = 1;
                  #0#26 = #0#26 + 1 ;
             |FINSI;
             #17nTarifa6 = #0#26 * #0#11;
         |SINO;
             #17nTarifa6 = #17nTarifa1;
         |FINSI;
     |FINSI;
     |GRABA 020#17a;
     |LIBERA #17;
|FPRC;

|DEFBUCLE agifa017;
     #17#1;
     ;
     #0#0, #0#28;
     #0#1, #0#29;
     be;
     NULL, CalcuPVP;
|FIN;

|PROCESO Divisa;
     |ABRE #agifa321;
     |ABRE #agifa324;
     #agifa324#0 = #agifa019#165;
     |LEE 001#agifa324.=;
     nDeci_PreDiv = #agifa324#9;
     |LEE 001#agifa321.p;
     #agifa324#0 = #agifa321#9; ||Igualo a moneda base
     |LEE 001#agifa324.=;
     nDeci_Base = #agifa324#7;  ||Decimales moneda base
     nDeci_PreBase = #agifa324#9;  ||Decimales precio de moneda base
     |CIERRA #agifa321;
     |CIERRA #agifa324;
|FPRC;

|PROCESO Tipo3;  |TIPO 3;
     |HAZ Divisa;
     |HAZ Tarifa;
     |ABRE #19;
     |BUCLE agifa017;
     |CIERRA #19;
|FPRC;

|PROCESO Llena004; |TIPO 6;
     eaArticulo = #0Campo;
     |HAZ LlenaArticulo;
     |SI FSalida = 0;
          #0Campo = eaArticulo;
          |PINTA #0Campo;
     |SINO;
          |ERROR; |ACABA;
     |FINSI;
|FPRC;
