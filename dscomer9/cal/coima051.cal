|FICHEROS;
     coima050 #0;   || escandallo cabs.
     coima051 #1;   || escandallo lins.
     agifa019 #2,MANTE;   || articulos
     agifa017 #3;   || almacenes
     agifa142 #142;
     dsm00241 #241;
     dsm00238 #238;
     agifa048@ #480;
     coima002 #20;
     coimz030 #30,MANTE;
     coima054 #54;
     coima059 #59;
     coima066 #66;
     referen@;
|FIN;

|VARIABLES;
     &eaFamilia = "";
     &eaLinea = "";
     aPath = "";
     i = 0;
     aAlfa1 = "";
     nLin = 0;
     aArtiAnt = "";
     nLinea = 0;
     nCampo = 0;
     nImpo = 0;
     nImpo2 = 0;
     nUni = 0;
     nAlma = 0;
     nModo = 0;
     nUnidad = 0;
     &eaMate = "";
     &eaEscan = "";
     &enTecla = 0;
     &enTipo = 0;
     nForma = 0;
     aTipo = "";
     nNume1        = 0;
     nNume2        = 0;
     nNume         = 0;

     &nDeci_EsCab = 0;
     &nDeci_EsLin = 0;

     nMerma         = 0;
     swdes          = 0;
     &nModcab       = 0;
     &nDec          = 0;
     vacio          = " " * 20;
     impcompone     = 0 ;
     fiac           = " ";
     paac           =  0 ;
     &aLargo        = "N";
     &nUniLargo     = 0;
     &nLargo        = 0;
     &nAncho        = 0;
     &nGrosor       = 0;
     &nResultado    = 0;
     &nTipoLargo    = 0;
     &nExitAlterna  = 0;
     unifab         = 0;
     modo           = 0;
     resp           = 0;
     aAlfa          = "";
|FIN;

|INCLUYE i_varart;

|PROCESO DefeUniPre;
     |HAZ LeeConverUni;
     |HAZ EsTecatel;
     |SI #142#9 = "S"; |Y FSalida = 0;
          |SI #241#6 = "D";
               nNume = #3#69 * #241#5;
               #1#15 = nNume;
          |SINO;
               nNume = #3#69 / #241#5;
               #1#15 = nNume;
          |FINSI;
     |SINO;
          |SI Campo = 9; |ACABA; |FINSI;
          |SI #241#6 = "D";
               nNume = #2#9 * #241#5;
               #1#15 = nNume;
          |SINO;
               nNume = #2#9 / #241#5;
               #1#15 = nNume;
          |FINSI;
     |FINSI;
     |PINTA #1#15;
|FPRC;


|PROCESO tipo_1; |TIPO 1;
     swdes = 0;
|FPRC;

|PROCESO Tipo2_049; |TIPO 2;
     modo = (FEntrada / 100) ! 0;
     nForma = 0 +. 1;

     |SI nForma = -1; aArtiAnt = #1#2; |FINSI;

     |HAZ totliesc;

     |HAZ ConverUni;

     impcompone = #1#6 / #0#6;
     |SI #1#10 = 1; #0#8 = #0#8 +. impcompone;    |FINSI;   ||Componentes
     |SI #1#10 = 2; #0#2 = #0#2 +. impcompone;    |FINSI;   ||Mano Obra
     |SI #1#10 = 3; #0#3 = #0#3 +. impcompone;    |FINSI;   ||Maquinaria
     |SI #1#10 = 4; #0#4 = #0#4 +. impcompone;    |FINSI;   ||Otros


     |SI #1#10 = 1;
         |SI #0#17 = "S";
             |SI #0#26 = "D";
                 #0#21 = #0#21 +. (#1#6 > #0#16);
             |SINO;
                 #0#21 = #0#21 +. (#1#6 / ((100 - #0#16) / 100));
             |FINSI;
         |SINO;
             #0#21 = #0#21 +. #1#6;
         |FINSI;
     |FINSI;

     |SI #1#10 = 2;
         |SI #0#19 = "S";
             |SI #0#28 = "D";
                 #0#21 = #0#21 +. (#1#6 > #0#24);
             |SINO;
                 #0#21 = #0#21 +. (#1#6 / ((100 - #0#24) / 100));
             |FINSI;
         |SINO;
             #0#21 = #0#21 +. #1#6;
         |FINSI;
     |FINSI;

     |SI #1#10 = 3;
         |SI #0#18 = "S";
             |SI #0#27 = "D";
                 #0#21 = #0#21 +. (#1#6 > #0#23);
             |SINO;
                 #0#21 = #0#21 +. (#1#6 / ((100 - #0#23) / 100));
             |FINSI;
         |SINO;
             #0#21 = #0#21 +. #1#6;
         |FINSI;
     |FINSI;

     |SI #1#10 = 4;
         |SI #0#20 = "S";
             |SI #0#29 = "D";
                 #0#21 = #0#21 +. (#1#6 > #0#25);
             |SINO;
                 #0#21 = #0#21 +. (#1#6 / ((100 - #0#25) / 100));
             |FINSI;
         |SINO;
             #0#21 = #0#21 +. #1#6;
         |FINSI;
     |FINSI;

     #0#5 = #0#2 + #0#3 + #0#4;         || total otros costes
     #0#11 = (#0#5 + #0#8) > #0#7;      || total serie
     #0#11 = #0#11 > #0#34;
     #0#9 = #0#11 / #0#12;              || total unitario

     |PINTA #0#2;
     |PINTA #0#3;
     |PINTA #0#4;
     |PINTA #0#5;
     |PINTA #0#8;
     |PINTA #0#9;
     |PINTA #0#11;
     |PINTA #0#22;
     |PINTA #0#21;

|FPRC;

|PROCESO escartic; |TIPO 0;
     nModo = (FEntrada / 100) ! 0;
     |SI #1#2 = #1#0;
          |MENAV "0000No se puede descomponer el Articulo en Escandallo ...";
          |ERROR; |ACABA;
     |FINSI;
     |SI #142#12 = "X";
          aTipo = "";
          |DDEF aAlfa;
          aAlfa = aAlfa + "agifa048";
          |CARGA_DEF aAlfa, agifa048@;
          |SI FSalida = 0;
               |ABRE #480;
               #480#0 = #1#2;
               |LEE 000#480=;
               |SI FSalida = 0;
                    aTipo = #480#33;
               |FINSI;
               |CIERRA #480;
               |DESCARGA_DEF #agifa048@;
          |FINSI;
          |SI aTipo = "K";
               |MENAV "0000Error, el componente es un KIT";
               |ERROR; |ACABA;
          |FINSI;
     |FINSI;

     |SI nModo = 1; |O #1Campo ! Contenido;
          |ABRE #2;
          #2#0 = #1#2;
          |LEE 020#2=;
          |CIERRA #2;

          |HAZ Es48X;
          |SI FSalida = 0;
               #1#3 = #2#1; |PINTA #1#3;
               #1#14 = #2#207;
          |FINSI;

          |HAZ DefeUniPre;
          eaArticulo = #1#2;
          eaCliente = "";
          |||HAZ DefectoMediV;
          |SUB_EJECUTA_NP "dsz99919;D";
          #1#18 = enMedida1;
          #1#19 = enMedida2;
          #1#20 = enMedida3;

          |ABRE #59; |SELECT #2#59;
          #59#1 = #1#2;
          |LEE 000#59=;
          |SI FSalida = 0;
               #1#30 = #59#3; |PINTA #1#30;
          |FINSI;
          |CIERRA #59;
     |FINSI;
     |HAZ PintaUni49;
     |HAZ EscanLin13;
|FPRC;

|PROCESO AlmaEsca7; |TIPO 7;
     nAlma = #1#9;
|FPRC;

|PROCESO AlmaEsca0; |TIPO 0;
     |SI #1#9 = 0;
          |AVISO; |ERROR; |ACABA;
     |FINSI;

     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 1; |O nAlma ! #1#9;
          |HAZ DefeUniPre;
     |FINSI;
|FPRC;

|PROCESO nomodif6; |TIPO 0;
|SI #0#2 = vacio;
      |CAMPO_MODIFICA #0#3,  1, "N";
      |CAMPO_MODIFICA #0#5,  1, "N";
      |CAMPO_MODIFICA #0#6,  1, "N";
      |CAMPO_MODIFICA #0#8,  1, "N";
      |CAMPO_MODIFICA #0#11,  1, "N";
      |CAMPO_MODIFICA #0#9,  1, "N";
|SINO;
      |CAMPO_MODIFICA #0#3,  1, "S";
      |CAMPO_MODIFICA #0#5,  1, "S";
      |CAMPO_MODIFICA #0#6,  1, "S";
      |CAMPO_MODIFICA #0#8,  1, "S";
      |CAMPO_MODIFICA #0#11,  1, "S";
      |CAMPO_MODIFICA #0#9,  1, "S";
|FINSI;
|FPRC;

|PROCESO MinUni;
     #241#0 = #2#5;
     #241#1 = 1;
|FPRC;

|PROCESO MaxUni;
     #241#0 = #2#5;
     #241#1 = 999;
|FPRC;

|PROCESO UniF11; |TIPO 66;
     |ABRE #2;
     #2#0 = #1#2;
     |LEE 000#2=;
     |CIERRA #2;

     |ABRE #241;
     |CONSULTA_F_CLAVE #1#241, MinUni, MaxUni;
     |SI FSalida = 0;
          #1#14 = #241#2;
          |HAZ PintaUni49;
          |HAZ LeeConverUni;
          |SI #241#6 = "D";
               nNume = #2#9 * #241#5;
               #1#15 = nNume;
          |SINO;
               nNume = #2#9 / #241#5;
               #1#15 = nNume;
          |FINSI;
          |PINTA #1#15;
     |FINSI;
     |CIERRA #241;
     |ERROR;
|FPRC;

|PROCESO PintaUni49; |TIPO 7;
     |SI #142#163 = "S";
          |HAZ LeeConverUni;
          |SI #2#204 = "S";
               |PINTA 2307, #1#14;
               |PINTA 2313, #241#4;
          |SINO;
               aAlfa = " " * 21;
               |PINTA 2307, aAlfa;
          |FINSI;
     |FINSI;
     |HAZ EsOrts;
     |SI FSalida = 0;
          |HAZ PinOrts;
     |FINSI;
|FPRC;

|PROCESO Llena049; |TIPO 6;
     enAlta = 1;
     eaArticulo = #1Campo;
     |HAZ LlenaArticulo;
     |SI FSalida = 0;
          #1Campo = eaArticulo;
          |PINTA #1Campo;

          |HAZ CreaArti;
     |SINO;
          |ERROR; |ACABA;
     |FINSI;
|FPRC;

|PROCESO EntraLin7; |TIPO 7;
     nModo = (FEntrada / 100) ! 0;

     |HAZ EsRodacal48;
     |SI FSalida = 0;
          ||MENSA "0000Unidades Componentes: <F5> Modificacion  <F6> Alta ";
          |MENSA "0000<F5> Modificacion Unidades Componentes";
     |FINSI;

     |HAZ Es48X;
     |SI FSalida = 0; |Y nModo = 1;
          #1#0 = #0#0;
          #1#1 = 999;
          |LEE 000#1];
          |SI FSalida = 0;
               |LEE 000#1a;
          |SINO;
               |LEE 000#1u;
          |FINSI;
          |SI FSalida = 0; |Y #1#0 = #0#0;
               nLinea = #1#1 + 1;
          |SINO;
               nLinea = 1;
          |FINSI;
          |DDEFECTO #1;
          #1#0 = #0#0;
          #1#1 = nLinea;
     |FINSI;
|FPRC;

|PROCESO SalLin; |TIPO 0;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 1;
          #1#13 = #0#7; |PINTA #1#13;
     |FINSI;
|FPRC;

|PROCESO Escan11; |TIPO 11;
     nModo = (FEntrada  / 100) ! 0;
     |SI FSalida = 12; |Y nModo ! 4;
          |PUSHV 0501 2380;
          |BLANCO 1022 1659;
          |DDEFECTO #30;
          |PINPA #0#30;
          |PINDA #0#30;
          |ENDATOS #1#30;
          |SI FSalida = 0;
               |SI #0#0 = #30#0;
                    |MENAV "0000No se puede selecciona el mismo escandallo...";
                    |ERROR;
               |SINO;
                    |HAZ CopiaLineas;
                    |SI nModo ! 1;
                         |PONCONTROL 23, "SI";
                         |ERROR;
                    |FINSI;
                    |PTEC 809;
                    |PTEC 808;
               |FINSI;
          |SINO;
               |ERROR;
          |FINSI;
          |POPV;
     |FINSI;

/*
     |SI FSalida = 13;
          ||SI #0#33 ! "K"; |ERROR; |ACABA; |FINSI;
          eaArticulo = #1#2;
          enUnidad1 = #1#12;
          enUnidad2 = #1#17;
          enMedida1 = #1#18;
          enMedida2 = #1#19;
          enMedida3 = #1#20;

          ||HAZ VerDobleUniV;
          eaProgVta = "agifa048";
          |SUB_EJECUTA_NP "dsz99919;V";
          |ERROR;
     |FINSI;
*/
     |SI FSalida = 13; |Y nModo ! 4;
          |PUSHV 0501 2380;
          |BLANCO 905 1676;
          |SUB_EJECUTA_NP "coimz042";
          |SI eaFamilia ! "";
               |HAZ CopiaDefecto;
               |SI nModo ! 1;
                    |PONCONTROL 23, "SI";
                    |ERROR;
               |FINSI;
               |PTEC 809;
               |PTEC 808;
          |SINO;
               |ERROR;
          |FINSI;
          |POPV;
     |FINSI;
|FPRC;

|PROCESO EntraUni49; |TIPO 7;
     ||SI #0#33 ! "K"; |ACABA; |FINSI;

     enAlmacen = #1#9;
     eaCliente = "";
     efFecha = "01.01.000";
 ||***
     eaArticulo = #1#2;
     enUnidad1 = #1#12;
     enUnidad2 = #1#17;
     enMedida1 = #1#18;
     enMedida2 = #1#19;
     enMedida3 = #1#20;

     ||HAZ DobleUniV;
     eaProgVta = "agifa048";
     enModoVta = (FEntrada / 100) ! 0;
     |SUB_EJECUTA_NP "dsz99919";

     |C_M #1#12, 1, "S";
     |SI eaSw2Stock = "S";
          |C_M #1#12, 1, "N";
          #1#12 = enUnidad1; |PINTA #1#12;
          #1#17 = enUnidad2;
          #1#18 = enMedida1;
          #1#19 = enMedida2;
          #1#20 = enMedida3;
     |FINSI;
|FPRC;

|PROCESO AlmaCom6; |TIPO 6;
     |SI #1#9 ! 0;
          eaArticulo = #1#2;
          enAlmacen = #1#9;
          |HAZ CreaArtiAlma;
     |FINSI;
|FPRC;

|PROCESO LargoAncho; |TIPO 0;
     |SI #1Campo ! Contenido;
          |ABRE #2;
          #2#0 = #1#2;
          |LEE 000#2=;
          |CIERRA #2;

          #1#12 = #1#25 * #1#26 * #1#27 / #2#4; |PINTA #1#12;
     |FINSI;
|FPRC;

|PROCESO Min20;
     #20#0 = #1#22;
     #20#1 = 00;
|FPRC;

|PROCESO Max20;
     #20#0 = #1#22;
     #20#1 = 99;
|FPRC;

|PROCESO Proceso; |TIPO 66;
     |ABRE #20;
     |SI Campo = 23;
          #20#0 = #1#22;
          #20#1 = #1#23;
          |LEE 000#20];
          |CONSULTA_F_CLAVE #1#20, Min20, Max20;
          |SI FSalida = 0;
               #1#23 = #20#1; |PINTA #1#23;
          |SINO;
               |ERROR;
          |FINSI;
     |SINO;
          #20#0 = #1#22;
          #20#1 = #1#24;
          |LEE 000#20];
          |CONSULTA_F_CLAVE #1#20, Min20, Max20;
          |SI FSalida = 0;
               #1#24 = #20#1; |PINTA #1#24;
          |SINO;
               |ERROR;
          |FINSI;
     |FINSI;
     |CIERRA #20;
|FPRC;

|PROCESO CopiaLineas;
     |DDEF aPath;
     aAlfa = aPath + "coima051";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          #referen@#0 = #30#0;
          #referen@#1 = 1;
          |LEE 000#referen@.];
          |PARA; |SI FSalida = 0; |Y #referen@#0 = #30#0; |HACIENDO;
               #1#0 = #0#0;
               #1#1 = 999;
               |LEE 000#1];
               |SI FSalida = 0;
                    |LEE 000#1a;
               |SINO;
                    |LEE 000#1u;
               |FINSI;
               |SI FSalida = 0; |Y #1#0 = #0#0;
                    nLin = #1#1 + 1;
               |SINO;
                    nLin = 1;
               |FINSI;

               |SALVA_DATOS #referen@;
               |REPON_DATOS #1;
               #1#0 = #0#0;
               #1#1 = nLin;
               |GRABA 020#1n;

               |LEE 000#referen@.s;
          |SIGUE;

          |CIERRA #referen@;

          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|PROCESO Min54;
     #54#2 = aAlfa;
     #54#0 = 0000;
|FPRC;

|PROCESO Max54;
     #54#2 = aAlfa;
     #54#0 = 9999;
|FPRC;

|PROCESO Pieza0; |TIPO 0;
     |SI #1#28 = 0; |ACABA; |FINSI;
     |ABRE #54;
     #54#0 = #1#28;
     |LEE 000#54=;
     |SI #54#2 = "S";
          |MENAV "0000El codigo es una subpieza...";
          |ERROR;
     |SINO;
          |SI #1Campo ! Contenido;
               aAlfa = #54#1; |QBF aAlfa;
               #54#0 = #1#29;
               |LEE 000#54=;
               |SI FSalida ! 0; |DDEFECTO #54; |FINSI;
               aAlfa = aAlfa + "#" + #54#1;
               #1#7 = aAlfa; |PINTA #1#7;
          |FINSI;
     |FINSI;
     |CIERRA #54;
|FPRC;

|PROCESO Pieza66; |TIPO 66;
     aAlfa = "N";
     |ABRE #54;
     #54#0 = #1#28;
     |LEE 000#54];
     |CONSULTA_F_CLAVE #2#54, Min54, Max54;
     |SI FSalida = 0;
          #1#28 = #54#0; |PINTA #1#28;
     |SINO;
          |ERROR;
     |FINSI;
     |CIERRA #54;
|FPRC;

|PROCESO Sub0; |TIPO 0;
     |SI #1#29 = 0; |ACABA; |FINSI;
     |ABRE #54;
     #54#0 = #1#29;
     |LEE 000#54=;
     |SI #54#2 = "N";
          |MENAV "0000El codigo es una pieza...";
          |ERROR;
     |SINO;
          |SI #1Campo ! Contenido;
               aAlfa1 = #54#1; |QBF aAlfa1;
               #54#0 = #1#28;
               |LEE 000#54=;
               |SI FSalida ! 0; |DDEFECTO #54; |FINSI;
               aAlfa = #54#1; |QBF aAlfa;
               aAlfa = aAlfa + "#" + aAlfa1;
               #1#7 = aAlfa; |PINTA #1#7;
          |FINSI;
     |FINSI;
     |CIERRA #54;
|FPRC;

|PROCESO Sub66; |TIPO 66;
     aAlfa = "S";
     |ABRE #54;
     #54#0 = #1#29;
     |LEE 000#54];
     |CONSULTA_F_CLAVE #2#54, Min54, Max54;
     |SI FSalida = 0;
          #1#29 = #54#0; |PINTA #1#29;
     |SINO;
          |ERROR;
     |FINSI;
     |CIERRA #54;
|FPRC;

|PROCESO CopiaDefecto;
     |ABRE #66;
     #66#0 = eaFamilia;
     #66#31 = eaLinea;
     #66#1 = 1;
     |LEE 000#66];
     |PARA; |SI FSalida = 0; |Y #66#0 = eaFamilia;
               |Y #66#31 = eaLinea; |HACIENDO;
          #1#0 = #0#0;
          #1#1 = 999;
          |LEE 000#1];
          |SI FSalida = 0;
               |LEE 000#1a;
          |SINO;
               |LEE 000#1u;
          |FINSI;
          |SI FSalida = 0; |Y #1#0 = #0#0;
               nLin = #1#1 + 1;
          |SINO;
               nLin = 1;
          |FINSI;
          |PARA i = 2; |SI i [ 30; |HACIENDO i = i + 1;
               #1i = #66i;
          |SIGUE;
          #1#0 = #0#0;
          #1#1 = nLin;
          |GRABA 020#1n;
          |HAZ Tipo2_049;
          |LEE 000#66s;
     |SIGUE;
     |CIERRA #66;
|FPRC;
