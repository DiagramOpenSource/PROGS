         Llamadas desde calculos: (definidos en el .plb)

 *** Ojo con 'aProg' hay que poner el def que llama en los calculos:    ***
 *** CompruParam (que esta en i_dobsto) DobleUniV,DobleArtiV y LinEscan ***

     DobleArtiV = Saca del articulo (c.barra) las unidades y/o la partida
     DobleUniV  = Introduccion de unidades
     VerDobleUniV = Consulta
     DoblePartiC = Introduccion partida

     DobleUniTPV = Introduccion unidades       (agifa503 = copia del 501)

     AcumulaTPVR = Stock + Historico
     AcumulaTPV = Stock + Historico
     ModiHistoTPV = Modi Historico
     AcumulaPV = Stock
     AcumulaAV
     ModiHistoAV
     AcumulaDE
     AcumulaFC
     ModiHistoFC
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|FICHEROS;
     dsz99998 #0,MANTE;

     agifa501 #11;  ||TPV
     agifa502 #12;
     tpv00001 #13;

     agifa104 #14;  ||Ped Ventas
     agifa073 #15;
     dsm00026 #26;
     agifa036 #70;  ||Depositos
     agifa070 #71;

     agifa010 #72;  ||Alba Ventas
     agifa071 #73;

     agifa084 #74;  ||Fac Cont
     agifa069 #75;

     agifa146 #76;  ||Proformas
     agifa147 #77;

     agifa048 #480;
     agifa049 #49;  ||Lineas Escandallo
     agifa007 #67;  ||Serie

     dsl00001 #101;
     dsm00109 #109;
     dsm00047 #47;

     albm0046 #46;
     referen@ #100;
     tagm0078@;
     gestrz05@; ||   Pantalla para reg. exi. Modulo Gestral
     con00009@;
     dsm00279 #279;
|FIN;

|VARIABLES;
     nSwOrts = 1;
     &eaAlbTaller = "";
     &enSwGesAltaPar = 0;
     nSwGestral = 0;
     nSwPanGestral = 0;
     nEsKit = 0;
     &enDepo = 0;
     &enSwDevo = 0;
     &eaArtiAnt = "";
     aTipDoc = "";
     aSerDoc = "";
     nNumDoc = 0;
     nLinDoc = 0;
     nMed1 = 0;
     nMed2 = 0;
     nMed3 = 0;
     nAbo = "";

     nPreTon = 0;
     aRaya = "";
     aArtiDoc = "";
     aMensaje = "";
     &enUdPedUno = 0;
     &enUdPedDos = 0;

     &enUni1 = 0;
     &enUni2 = 0;
     &enAlbForma = 0;

     &efFAlba = @;
     &enMed1 = 0;
     &enMed2 = 0;
     &enMed3 = 0;
     nUni0 = 0;
     &nDeci_Base = 0;
     &nDeci_PreBase = 0;
     &precio_base = 0;
     &eaImporIber= "N";
     &Tempo      = "";
     &eaCompVent = "V";
     nEsEscan    = 0;
     aCli        = "";
     nGuardaAlma = 0;
     aIPRemoto = "";
     nSwAdjPed = 0;
     aDef      = "";
     aPath     = "";
     aBase     = "";
     xCoste   = 0;
     aParamCBOK= "";
     aNume     = "";
     nHandle   = 0;
     aMensaPesa= "";
     nSwParam  = 0;
     aEsSalida = "S";
     aOperaInte= "";
     aOperacion= "";
     fUltFecha = @;
     nSwModi   = 0;
     nPosi     = 0;
     nCoste    = 0;
     nUnidades = 0;
     nUnidades2= 0;
     nUniPen   = 0;
     nUniPen2  = 0;
     nUniPend   = 0;
     nUniPend2 = 0;
     nMerma    = 0;
     xnCoste   = 0;
     nSwVer    = 0;
     nSalida   = 0;
     aProg     = "";
     aOpera    = "";
     aAlfa     = "";
     aAlf1     = "";
     aArti     = "";
     aParti    = "";
     nAlma     = 0;
     nPos      = 0;
     nUni2     = 0;
     nUni      = 0;
     nNume     = 0;
     nPm       = 0;
     nPcm      = 0;
     nPvp1     = 0; nPvp2 = 0; nPvp3 = 0; nPvp4 = 0; nPvp5 = 0; nPvp6 = 0;
     nNume1    = 0; nNume2 = 0; nNume3 = 0; nNume4 = 0; nNume5 = 0; nNume6 = 0;
     nCampo    = 0;
     nPrecio   = 0;
     nNeto     = 0;
     nForma    = 0;
     nSto      = 0;
     nSto1     = 0;
     nImpo     = 0;
     nMargen   = 0;
     aSer      = "";
     aEsInte   = "";
     nAlmaInte = 0;
     aCbUni    = "";
     nCbUni    = 0;
     aCbParti  = "";
     aCbArti   = "";
     nNum      = 0;
     nLin      = 0;
     nPreKit   = 0;
     nTotaKit  = 0;
     nPorce    = 0;
|FIN;

|INCLUYE i_varart;
|INCLUYE i_escand;
|INCLUYE i_dobsto;

|PROCESO PartidaDefecto;
     |SI #24#22 > 0;
          eaPartiDefe = #24#2;
     |FINSI;
|FPRC;

|DEFBUCLE PartidaDefecto;
     #24#2;
     ;
     "01.01.0000", #0#9, #0#10, "               ";
     "31.12.9999", #0#9, #0#10, "zzzzzzzzzzzzzzz";
     ;
     NULL, PartidaDefecto;
|FIN;

|PROCESO Valora_Stock;
     |HAZ ValoraStock;

     |HAZ EsAlbadis;
     |SI FSalida = 0;
          |SI aOpera = "AV"; |Y enForma = 1; |Y aProg = "albap008";
               |SI #24#5 < efFAlba;
                    #24#5 = efFAlba;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO LeeSerie;
     |ABRE #67;
     #67#26 = aSer;
     |LEE 000#67=;
     |CIERRA #67;

     aEsInte = #67#37;
     nAlmaInte = #67#31;
|FPRC;

|PROCESO MiraEscan;
     |ABRE #480;
     #480#0 = #19#0;
     |LEE 000#480=;
     nEsEscan = FSalida;
     |CIERRA #480;
|FPRC;

컴컴컴컴컴컴컴컴컴컴컴컴컴컴훃ni2 (kg) por Bascula컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO PesaServidor;
     aMensaPesa = "";
     aAlfa = eaPathBascula + eaPreBascula;
     |XABRE "W", aAlfa, nHandle;
     |SI FSalida ! 0;
          aMensaPesa = "0000No puedo crear [" + aAlfa + "]";
          |MENAV aMensaPesa;
     |SINO;
          aAlfa = ("0000000000" + #12#6) % -110;
          aAlfa = &34 + aAlfa + &34;
          |XGRABA nHandle, aAlfa;
          |XCIERRA nHandle;
          aAlfa = eaPathBascula + eaExeBascula;
          aAlfa  = "cmd " + &34 + "/c START /MIN /WAIT " + aAlfa + &34;
          |SYSTEM aAlfa;
          |SLEEP 1;
          aAlfa = eaPathBascula + eaPesBascula;
          |XABRE "U", aAlfa, nHandle;
          |SI FSalida ! 0;
               aMensaPesa = "0000No puedo leer [" + aAlfa + "]";
               ||MENAV aMensaPesa;
          |SINO;
               |XLEE nHandle, 250, aAlfa;
               aAlfa = aAlfa - &34 - &34;
               aNume = aAlfa % A0;
               |SI aNume > 6;
                    aMensaPesa = "0000" + aAlfa;
                    |MENAV aMensaPesa;
               |SINO;
                    #12#5 = aAlfa;
               |FINSI;
               |XCIERRA nHandle;
               aAlfa = eaPathBascula + eaPesBascula;
               |FBORRA aAlfa;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO PesaCliente;
     aMensaPesa = "";
     aAlfa = eaPathBascula + eaPreBascula;
     |XABRE "CW", aAlfa, nHandle;
     |SI FSalida ! 0;
          aMensaPesa = "0000No puedo crear [" + aAlfa + "]";
          |MENAV aMensaPesa;
     |SINO;
          aAlfa = ("0000000000" + #12#6) % -110;
          aAlfa = &34 + aAlfa + &34;
          |XGRABA nHandle, aAlfa;
          |XCIERRA nHandle;
          aAlfa = eaPathBascula + eaExeBascula;
          aAlfa  = "cmd " + &34 + "/c START /MIN /WAIT " + aAlfa + &34;
          |RSYSTEM aAlfa;
          |SLEEP 1;
          aAlfa = eaPathBascula + eaPesBascula;
          |XABRE "CU", aAlfa, nHandle;
          |SI FSalida ! 0;
               aMensaPesa = "0000No puedo leer [" + aAlfa + "]";
               ||MENAV aMensaPesa;
          |SINO;
               |XLEE nHandle, 250, aAlfa;
               aAlfa = aAlfa - &34 - &34;
               aNume = aAlfa % A0;
               |SI aNume > 6;
                    aMensaPesa = "0000" + aAlfa;
                    |MENAV aMensaPesa;
               |SINO;
                    #12#5 = aAlfa;
               |FINSI;
               |XCIERRA nHandle;
               aAlfa = eaPathBascula + eaPesBascula;
               |RFBORRA aAlfa;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Pesada;
     aIPRemoto = "";
     |IP_REMOTO aIPRemoto;  |QBT aIPRemoto;
     |SI aIPRemoto ! "";
         |HAZ PesaCliente;
     |SINO;
         |HAZ PesaServidor;
     |FINSI;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴횵NTRODUCCION DE UNIDADES컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO DobleUniTPV; |TIPO 7;  || 'agifa503'
     |HAZ CompruParam;
     |SI eaSw2Stock = "N"; |ACABA; |FINSI;

     |ABRE #19;
     #19#0 = #12#2;  || Articulo
     |LEE 000#19=;
     |CIERRA #19;
     eaSw2Stock = #19#179;

     |SI #19#179 = "N"; |Y #19#186 = "S";     || Sin Doble Stock
          |SI eaPesoBascula = "S"; |Y #0#5 ! "CB";
               |HAZ Pesada;
               |SI aMensaPesa ! ""; |C_M #12#5, 1, "S"; |FINSI;
          |FINSI;
          |SI eaPesoBascula = "S"; |Y enSwBarra = 1; || Introduce Cod. Arti
               |HAZ Pesada;
               |SI aMensaPesa ! ""; |C_M #12#5, 1, "S"; |FINSI;
          |FINSI;
          |ACABA;
     |FINSI;
                                              || Con Doble Stock
     |SI eaPesoBascula = "S"; |Y #19#186 = "S";
          |SI #0#5 = "PR";
               |HAZ Pesada;
               |SI aMensaPesa ! ""; #0#5 = "PR"; |FINSI;    || Entrada manual
          |FINSI;
          |SI #0#5 = "CB"; |O enSwBarra = 1; || CB o Introduce Cod. Arti
               aMensaPesa = "";
               |SI #2#8 = "N"; |O aParamCBOK = "N"; |O enSwBarra = 1;
                    |HAZ Pesada;
               |SINO;
                    |SI aParamCBOK = "S"; |Y aCbUni = "";
                         |HAZ Pesada;
                    |FINSI;
               |FINSI;
               |SI aMensaPesa ! ""; #0#5 = "PR"; |FINSI;    || Entrada manual
          |FINSI;
     |FINSI;

     |SI #0#6 = "CB"; |Y #2#8 = "S";
          |SI aCbParti = ""; #0#6 = "MA"; |FINSI;  || Entrada manual
          |SI aCbUni = ""; #0#5 = "PR"; |FINSI;    || Entrada manual
     |FINSI;
     |SI #0#6 = "CB"; |Y enSwBarra = 1;            || Introduce Cod. Arti
          #0#6 = "MA";                             || Entrada manual
     |FINSI;

     #0#2 = #12#30;
     |C_V #0#2, 1, "N"; |HAZ RellenaPartida; |C_V #0#2, 1, "S";

     #0#1 = #12#5;
     #0#0 = #12#29;
     |SI #142#118 = "S"; #0#2 = #12#30; |FINSI;
     #0#3 = #12#31;
     #0#9 = #12#2;
     #0#10 = #12#3;

     nSwParam = 1;
     |SI eaModiUni2 = "N"; #0#4 = "SE"; |FINSI;   || No modificable
     |HAZ DobleUniV;
     |SI eaModiUni2 = "N"; #12#29 = enDefeUni2; |FINSI; || Uni por defecto
     nSwParam = 0;

     |C_M #12#5, 1, "N";
|FPRC;

|PROCESO DobleUniV;
     |SI enModoVta = 0;
          nModo = (FEntrada / 100) ! 0;
     |SINO;
          nModo = enModoVta;
     |FINSI;
     |SI nSwParam = 0; || Lo manda DobleUniTPV
          |HAZ CompruParam;
          |SI eaSw2Stock = "N"; |ACABA; |FINSI;
     |FINSI;

     #0#17 = aProg;

     |SI aProg = "tagm0030"; |O aProg = "vigm0006"; |O aProg = "tagm0052";
               |O aProg = "agifa048"; |O aProg = "dsz99986";
               |O aProg = "dsz00042"; |O aProg = "dsz99907";
               |O aProg = "dsz00120"; |O aProg = "agifa090";
          #0#1 = enUnidad1;
          #0#0 = enUnidad2;
          #0#9 = eaArticulo;
          #0#10 = enAlmacen;
          #0#2 = eaPartida;
          #0#12 = enMedida1;||Med1
          #0#13 = enMedida2;||Med2
          #0#14 = enMedida3;||Med3
          aCli = eaCliente;
          #0#18 = efFecha;
     |FINSI;

     |SI aProg = "agifa503"; |O aProg = "agifa501";
          #0#1 = #12#5;
          #0#0 = #12#29;
          |SI #142#118 = "S"; #0#2 = #12#30; |FINSI;
          #0#3 = #12#31;
          #0#9 = #12#2;
          #0#10 = #12#3;
          #0#12 = #12#32;||Med1
          #0#13 = #12#33;||Med2
          #0#14 = #12#34;||Med3
          aCli = #agifa501#1;
          #0#18 = #agifa501#14;
     |FINSI;
     |SI aProg = "agifa104";
          #0#1 = #15#5;  ||Uni1
          #0#0 = #15#44; ||Uni2
          |SI #142#118 = "S"; #0#2 = #15#45; |FINSI; ||Partida
          #0#3 = #15#46; ||Merma
          #0#9 = #15#2;  ||Arti
          #0#10 = #15#3; ||Alma
          #0#12 = #15#50;||Med1
          #0#13 = #15#51;||Med2
          #0#14 = #15#52;||Med3
          aCli = #agifa104#4;
          #0#18 = #agifa104#1;
     |FINSI;
     |SI aProg = "agifa036";
          #0#1 = #71#5;  ||Uni1
          #0#0 = #71#28; ||Uni2
          |SI #142#118 = "S"; #0#2 = #71#29; |FINSI; ||Partida
          #0#3 = #71#30; ||Merma
          #0#9 = #71#2;  ||Arti
          #0#10 = #71#3; ||Alma
          #0#12 = #71#33;||Med1
          #0#13 = #71#34;||Med2
          #0#14 = #71#35;||Med3
          aCli = #agifa036#3;
          #0#18 = #agifa036#1;
     |FINSI;
     |SI aProg = "agifa010"; |O aProg = "agifa210";
               |O aProg = "agifa033";
          #0#1 = #73#5;  ||Uni1
          #0#0 = #73#48; ||Uni2
          |SI #142#118 = "S"; #0#2 = #73#49; |FINSI; ||Partida
          #0#3 = #73#50; ||Merma
          #0#9 = #73#2;  ||Arti
          #0#10 = #73#3; ||Alma
          #0#12 = #73#51;||Med1
          #0#13 = #73#52;||Med2
          #0#14 = #73#53;||Med3
          aCli = #agifa010#3;
          #0#18 = #agifa010#1;
     |FINSI;

     |SI aProg = "dsm01000";
          #0#1 = enUdPedUno;  ||Uni1
          #0#0 = enUdPedDos;  ||Uni2
          |SI #142#118 = "S"; #0#2 = #73#49; |FINSI; ||Partida
          #0#3 = #73#50; ||Merma
          #0#9 = #73#2;  ||Arti
          #0#10 = #73#3; ||Alma
          #0#12 = #73#51;||Med1
          #0#13 = #73#52;||Med2
          #0#14 = #73#53;||Med3
          aCli = #agifa010#3;
          #0#18 = #agifa010#1;
     |FINSI;

     |SI aProg = "agifa084";
          #0#1 = #75#5;  ||Uni1
          #0#0 = #75#30; ||Uni2
          |SI #142#118 = "S"; #0#2 = #75#31; |FINSI; ||Partida
          #0#3 = #75#32; ||Merma
          #0#9 = #75#2;  ||Arti
          #0#10 = #75#3; ||Alma
          #0#12 = #75#33;||Med1
          #0#13 = #75#34;||Med2
          #0#14 = #75#35;||Med3
          aCli = #agifa084#3;
          #0#18 = #agifa084#1;
     |FINSI;
     |SI aProg = "agifa146";
          #0#1 = #77#5;  ||Uni1
          #0#0 = #77#28; ||Uni2
          |SI #142#118 = "S"; #0#2 = #77#29; |FINSI; ||Partida
          #0#3 = #77#30; ||Merma
          #0#9 = #77#2;  ||Arti
          #0#10 = #77#3; ||Alma
          #0#12 = #77#31;||Med1
          #0#13 = #77#32;||Med2
          #0#14 = #77#33;||Med3
          aCli = #agifa146#3;
          #0#18 = #agifa146#1;
     |FINSI;

     |ABRE #19;
     #19#0 = #0#9;  || Articulo
     |LEE 101#19=;
     |SI FSalida = 0;
          |HAZ CargaUniArt;
     |FINSI;
     |CIERRA #19;

     eaSw2Stock = "N";
     |SI #19#179 = "N"; |Y #19#180 = "N"; |ACABA; |FINSI;
     eaSw2Stock = "S";

     |SI enSwDevo = 0;
          |SI #19#180 = "S"; ||Control Partidas
               |SI aProg = "dsm01000";            ||Albaranes Venta Albero
                    ||Desactivar
                    |MODO_RELACION #0, 1, "dsm00024", "N", "N";
                    |MODO_RELACION #0, 1, "dsm00024", "X", "X";
               |SINO;
                    |SI enAlmacen ! 0;
                         |MODO_RELACION #0, 1, "dsm00024", "S", "S";
                    |SINO;
                         |MODO_RELACION #0, 1, "dsm00024", "N", "N";
                         |MODO_RELACION #0, 1, "dsm00024", "X", "X";
                    |FINSI;
               |FINSI;
          |SINO;
               |MODO_RELACION #0, 1, "dsm00024", "N", "N";
          |FINSI;
     |SINO;
          |MODO_RELACION #0, 1, "dsm00024", "N", "N";
          |MODO_RELACION #0, 1, "dsm00024", "X", "X";
     |FINSI;
     ||컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
     |SI nSwVer = 1;
          |PUSHV 0501 2380;
          |BLANCO 1323 2159;
          |PINPA #0#0;
          |HAZ VisualCampos;
          |PINDA #0#0;
          |SI #19#179 = "N";
               |PINTA 1726, "Unidades..:";
          |SINO;
               |PINTA 1626, #238#2;
               |PINTA 1726, #238#3;
          |FINSI;

          |PAUSA;        || Modificado martes, 29 de noviembre de 2011
/*
          |C_V #0#2, 0, aAlfa;
          |SI aAlfa = "S";
               |C_M #0#2, 1, "S";
               |ENCAMPO #2#0;
          |SINO;
               |PAUSA;
          |FINSI;
*/
          |POPV;
          |ACABA;
     |SINO;
          |HAZ EsAlbadis;
          |SI FSalida = 0;
               |SI eaArtiAntes ! #0#9; |O enAlmaAntes ! #0#10;
                    |BUCLE PartidaDefecto;
               |FINSI;
          |FINSI;
          |HAZ Entrada;
     |FINSI;
     |SI nSalida ! 0; |ACABA; |FINSI;

     |SI aProg = "agifa503"; |O aProg = "agifa501";
          #12#5 = #0#1;
          #12#29 = #0#0;
          |SI #142#118 = "S"; #12#30 = #0#2; |FINSI;
          #12#31 = #0#3;
          #12#32 = #0#12;
          #12#33 = #0#13;
          #12#34 = #0#14;
     |FINSI;
     |SI aProg = "agifa104";
          #15#5 = #0#1;
          #15#44 = #0#0;
          |SI #142#118 = "S"; #15#45 = #0#2; |FINSI;
          #15#46 = #0#3;
          #15#50 = #0#12;
          #15#51 = #0#13;
          #15#52 = #0#14;
     |FINSI;
     |SI aProg = "agifa036";
          #71#5 = #0#1;
          #71#28 = #0#0;
          |SI #142#118 = "S"; #71#29 = #0#2; |FINSI;
          #71#30 = #0#3;
          #71#33 = #0#12;
          #71#34 = #0#13;
          #71#35 = #0#14;
     |FINSI;
     |SI aProg = "agifa010"; |O aProg = "agifa210";
      |O aProg = "agifa033"; |O aProg = "dsm01000";
          #73#5 = #0#1;
          #73#48 = #0#0;
          |SI #142#118 = "S"; #73#49 = #0#2; |FINSI;
          #73#50 = #0#3;
          #73#51 = #0#12;
          #73#52 = #0#13;
          #73#53 = #0#14;
     |FINSI;
     |SI aProg = "agifa084";
          #75#5 = #0#1;
          #75#30 = #0#0;
          |SI #142#118 = "S"; #75#31 = #0#2; |FINSI;
          #75#32 = #0#3;
          #75#33 = #0#12;
          #75#34 = #0#13;
          #75#35 = #0#14;
     |FINSI;
     |SI aProg = "agifa146";
          #77#5 = #0#1;
          #77#28 = #0#0;
          |SI #142#118 = "S"; #77#29 = #0#2; |FINSI;
          #77#30 = #0#3;
          #77#31 = #0#12;
          #77#32 = #0#13;
          #77#33 = #0#14;
     |FINSI;
     |SI aProg = "tagm0030"; |O aProg = "vigm0006"; |O aProg = "tagm0052";
               |O aProg = "agifa048"; |O aProg = "dsz99986";
               |O aProg = "dsz00042"; |O aProg = "dsz99907";
               |O aProg = "agifa090";
          enUnidad1 = #0#1;
          enUnidad2 = #0#0;
          eaArticulo = #0#9;
          enAlmacen = #0#10;
          eaPartida = #0#2;
          enMedida1 = #0#12;
          enMedida2 = #0#13;
          enMedida3 = #0#14;
          efFecha = #0#18;
     |FINSI;
|FPRC;

|PROCESO DoblePartiV;
     nSwParti = 1;
     |HAZ DobleUniV;
     nSwParti = 0;
|FPRC;

|PROCESO VerDobleUniV;
     nSwVer = 1;
     |HAZ DobleUniV;
     nSwVer = 0;
|FPRC;

컴컴컴컴컴컴컴컴컴컴컴컴VALORES DENTRO DEL CODIGO BARRAS컴컴컴컴컴컴컴컴컴컴컴
|PROCESO ParamCB_Ok;
     |C_M #12#29, 1, "S";
     aParamCBOK = "S";
     |SI #26#5 = "S";
          nPos = #26#7 + (#26#6 * 100);
          aCbArti = aArti % nPos; |QBF aCbArti;
     |FINSI;
     |SI #26#8 = "S";
          nPos = #26#10 + (#26#9 * 100);
          aCbUni = aArti % nPos; |QBF aCbUni;
          nCbUni = aCbUni;
          |SI #26#11 = "S";
               nPos = 100 + #26#12;
               aAlfa = aCbUni % nPos;
               nPos = -(100 + #26#13);
               aAlfa = aAlfa + "." + (aCbUni % nPos);
               nCbUni = aAlfa;
          |FINSI;
     |FINSI;
     |SI #26#14 = "S";
          nPos = #26#16 + (#26#15 * 100);
          aCbParti = aArti % nPos; |QBF aCbParti;
     |FINSI;
|FPRC;

|PROCESO ParamCB;
     |ABRE #26;
     |PARA i = 9; |SI i [ 19; |HACIENDO i = i + 1;
          aAlfa = #2i; |QBF aAlfa;
          |SI aAlfa ! "";
               #26#0 = aAlfa;
               |LEE 000#26=;
               |SI FSalida = 0;
                    |SI #26#2 = "N";
                         |HAZ ParamCB_Ok; |SAL;
                    |SINO;
                         nPos = #26#3 + 100;
                         aAlfa = aArti % nPos;
                         aAlf1 = #26#4; |QBF aAlf1;
                         |SI aAlfa = aAlf1;
                              |HAZ ParamCB_Ok; |SAL;
                         |FINSI;
                    |FINSI;
               |FINSI;
          |FINSI;
     |SIGUE;
     |CIERRA #26;
|FPRC;

|PROCESO CliArti;
     |MODULO aProg;
     |SI aProg = "dsz99953"; |O aProg = "dsz99914";
          aProg = "agifa010";
     |FINSI;

     |SI aProg = "agifa104"; aArti = #15#2; aCli = #14#4; |FINSI;
     |SI aProg = "agifa036"; aArti = #71#2; aCli = #70#3; |FINSI;
     |SI aProg = "agifa010"; |O aProg = "agifa210";
      |O aProg = "agifa033"; |O aProg = "dsm01000";
          aArti = #73#2; aCli = #72#3;
     |FINSI;
     |SI aProg = "agifa084"; aArti = #75#2; aCli = #74#3; |FINSI;
     |SI aProg = "agifa146"; aArti = #77#2; aCli = #76#3; |FINSI;
     |ABRE #109;
     |SELECT #3#109;
     #109#0 = aCli;
     #109#3 = aArti;
     |LEE 000#109=;
     |SI FSalida = 0;
          aArti = #109#2;
          |SI aProg = "agifa104"; #15#2 = aArti; |FINSI;
          |SI aProg = "agifa036"; #71#2 = aArti; |FINSI;
          |SI aProg = "agifa010"; |O aProg = "agifa210";
           |O aProg = "agifa033"; |O aProg = "dsm01000";
               #73#2 = aArti;
          |FINSI;
          |SI aProg = "agifa084"; #75#2 = aArti; |FINSI;
          |SI aProg = "agifa146"; #77#2 = aArti; |FINSI;
          eaArtAnt = aArti;
     |FINSI;
     |CIERRA #109;
|FPRC;

|PROCESO DobleArtiV;
     |HAZ CliArti;   || Conversion Cliente/Articulo

     |DDEFECTO #0;
     |HAZ CompruParam;
     |SI eaSw2Stock = "N"; |ACABA; |FINSI;
     eaSw2Stock = "N";
     aParamCBOK = "N";
     aCbArti = ""; aCbUni = ""; aCbParti = ""; nCbUni = 0;

     |SI #0#5 ! "CB"; |Y #0#6 ! "CB"; |ACABA; |FINSI;
     eaSw2Stock = "S";

     |SI aProg = "tpv00001"; |O aProg = "tpv00006"; aArti = #13#2; |FINSI;
     |SI aProg = "agifa503"; |O aProg = "agifa501"; aArti = #12#22; |FINSI;
     |SI aProg = "agifa104"; aArti = #15#2; |FINSI;
     |SI aProg = "agifa036"; aArti = #71#2; |FINSI;
     |SI aProg = "agifa010"; |O aProg = "agifa210";
      |O aProg = "agifa033"; |O aProg = "dsm01000";
          aArti = #73#2;
     |FINSI;
     |SI aProg = "agifa084"; aArti = #75#2; |FINSI;
     |SI aProg = "agifa146"; aArti = #77#2; |FINSI;
     ||컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
     |SI #2#8 = "N";
          |SI #0#5 = "CB";         ||Uni2
               aAlfa = ("0000" + #2#6) % -104;
               nPos = (A\((aAlfa % 102) + (aAlfa % -102)));
               aAlfa = aArti % nPos;
               #0#11 = aAlfa;           || Peso de Compra
          |FINSI;
          |SI #0#6 = "CB";         ||Partida
               aAlfa = ("0000" + #2#7) % -104;
               nPos = (A\((aAlfa % 102) + (aAlfa % -102)));
               aParti = aArti % nPos; |QBF aParti;
          |FINSI;
     |SINO;
          |HAZ ParamCB;   ||CB parametrizado
     |FINSI;
     nPos = #142#62 + 100;
     aArti = aArti % nPos;     ||Articulo

     |SI aProg = "tpv00001"; |O aProg = "tpv00006";
          |SI aParamCBOK = "N";
               #13#2 = aArti;
               |SI aParti ! ""; #13#13 = aParti; |FINSI;
          |SINO;
               |SI aCbArti  ! ""; #13#2 = aCbArti; |FINSI;
               |SI aCbUni   ! ""; #13#4 = nCbUni; |FINSI;
               |SI aCbParti ! ""; #13#13 = aCbParti; |FINSI;
          |FINSI;
          #0#3 = #13#14;
     |FINSI;
     |SI aProg = "agifa503"; |O aProg = "agifa501";
          |SI aParamCBOK = "N";
               #12#2 = aArti;
               |SI aParti ! ""; #12#30 = aParti; |FINSI;
          |SINO;
               |SI aCbArti  ! ""; #12#2 = aCbArti; |PTEC 802; |FINSI;
               |SI aCbUni   ! ""; #12#5 = nCbUni; |FINSI;
               |SI aCbParti ! ""; #12#30 = aCbParti; |FINSI;
          |FINSI;
          #0#3 = #12#31;
     |FINSI;
     |SI aProg = "agifa104";
          |SI aParamCBOK = "N";
               #15#2 = aArti;
               |SI aParti ! ""; #15#45 = aParti; |FINSI;
          |SINO;
               |SI aCbArti  ! ""; #15#2 = aCbArti; |FINSI;
               |SI aCbUni   ! ""; #15#5 = nCbUni; |FINSI;
               |SI aCbParti ! ""; #15#45 = aCbParti; |FINSI;
          |FINSI;
          |SI #142#52 = "S"; |Y #142#53 = "S";
               aAlfa = #15#2; |HAZ CBVta; #15#2 = aAlfa;
          |FINSI;
          #0#3 = #15#46;
     |FINSI;
     |SI aProg = "agifa036";
          |SI aParamCBOK = "N";
               #71#2 = aArti;
               |SI aParti ! ""; #71#29 = aParti; |FINSI;
          |SINO;
               |SI aCbArti  ! ""; #71#2 = aCbArti; |FINSI;
               |SI aCbUni   ! ""; #71#5 = nCbUni; |FINSI;
               |SI aCbParti ! ""; #71#29 = aCbParti; |FINSI;
          |FINSI;
          |SI #142#52 = "S"; |Y #142#54 = "S";
               aAlfa = #71#2; |HAZ CBVta; #71#2 = aAlfa;
          |FINSI;
          #0#3 = #71#30;
     |FINSI;
     |SI aProg = "agifa010"; |O aProg = "agifa210";
      |O aProg = "agifa033"; |O aProg = "dsm01000";
          |SI aParamCBOK = "N";
               #73#2 = aArti;
               |SI aParti ! ""; #73#49 = aParti; |FINSI;
          |SINO;
               |SI aCbArti  ! ""; #73#2 = aCbArti; |FINSI;
               |SI aCbUni   ! ""; #73#5 = nCbUni; |FINSI;
               |SI aCbParti ! ""; #73#49 = aCbParti; |FINSI;
          |FINSI;
          |SI #142#52 = "S"; |Y #142#55 = "S";
               aAlfa = #73#2; |HAZ CBVta; #73#2 = aAlfa;
          |FINSI;
          #0#3 = #73#50;
     |FINSI;
     |SI aProg = "agifa084";
          |SI aParamCBOK = "N";
               #75#2 = aArti;
               |SI aParti ! ""; #75#31 = aParti; |FINSI;
          |SINO;
               |SI aCbArti  ! ""; #75#2 = aCbArti; |FINSI;
               |SI aCbUni   ! ""; #75#5 = nCbUni; |FINSI;
               |SI aCbParti ! ""; #75#31 = aCbParti; |FINSI;
          |FINSI;
          |SI #142#52 = "S"; |Y #142#56 = "S";
               aAlfa = #73#2; |HAZ CBVta; #73#2 = aAlfa;
          |FINSI;
          #0#3 = #75#32;
     |FINSI;
     |SI aProg = "agifa146";
          |SI aParamCBOK = "N";
               #77#2 = aArti;
               |SI aParti ! ""; #77#29 = aParti; |FINSI;
          |SINO;
               |SI aCbArti  ! ""; #77#2 = aCbArti; |FINSI;
               |SI aCbUni   ! ""; #77#5 = nCbUni; |FINSI;
               |SI aCbParti ! ""; #77#29 = aCbParti; |FINSI;
          |FINSI;
          #0#3 = #77#30;
     |FINSI;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO DesLinKit1;
     nUnidades = #100#5 * nUni;
     nUnidades2 = #100#9 * nUni;
     nUniPend = #100#5 * nUniPen;
     nUniPend2 = #100#9 * nUniPen;
     nCoste = 0;

     aArti = #100#3;
     nAlma = #100#4;
     aParti = #100#13;        || 1922/182
     |SI nSwModi = 0;
          |HAZ LeArticulo;
     |FINSI;
     nPrecio = (nPreKit / nTotaKit) * #100#8;

     |SI aProg = "agifa550";
          |SI eaTipo550 = "TI";
               |HAZ StockTPV;
               |HAZ GrabaArti;
               |HAZ HistoricoTPVR;
          |FINSI;
          |SI eaTipo550 = "AV";
               |HAZ StockAV;
               |HAZ GrabaArti;
               |HAZ HistoricoAV;
          |FINSI;
          |SI eaTipo550 = "FC";
               |HAZ StockFC;
               |HAZ GrabaArti;
               |HAZ HistoricoFC;
          |FINSI;
     |FINSI;
     |SI aProg = "tpv00001"; |O aProg = "tpv00006"; |O aProg = "agifa593";
          |HAZ StockTPV;
          |HAZ GrabaArti;
          |HAZ HistoricoTPVR;
     |FINSI;
     |SI aProg = "agifa503"; |O aProg = "agifa501";
          |SI nSwModi = 0;
               |HAZ StockTPV;
               |HAZ GrabaArti;
               |HAZ HistoricoTPV;
          |SINO;
               |SI enForma = 1;
                    |HAZ ModiHistoTPVAlta;
               |SINO;
                    |HAZ ModiHistoTPVBaja;
               |FINSI;
          |FINSI;
     |FINSI;

     |SI aProg = "agifa104"; |O aProg = "agifa166"; |O nSwAdjPed = 1;
          |HAZ StockPV;
          |HAZ GrabaArti;
          |SI nSwAdjPed = 1; |ACABA; |FINSI;
     |FINSI;
     |SI aProg = "agifa036";
          |SI nSwModi = 0;
               |HAZ StockDE;
               |HAZ GrabaArti;
          |FINSI;
     |FINSI;
     |SI aProg = "agifa010"; |O aProg = "agifa210";
      |O aProg = "agifa033"; |O aProg = "dsm01000";
                |O aProg = "agifa098";
          |SI nSwModi = 0;
               |HAZ StockAV;
               |HAZ GrabaArti;
               |HAZ HistoricoAV;
          |SINO;
               |HAZ ModiHistoAV0;
          |FINSI;
     |FINSI;
     |SI aProg = "agifa084"; |O aProg = "agifa167";
          |SI nSwModi = 0;
               |HAZ StockFC;
               |HAZ GrabaArti;
               |HAZ HistoricoFC;
          |SINO;
               |HAZ ModiHistoFC0;
          |FINSI;
     |FINSI;
     |SI aProg = "agifa146";
     |FINSI;
     xCoste = xCoste + nCoste;
|FPRC;

|DEFBUCLE DesLinKit1;
     #100#1004;
     ;
     aSer, nNum, nLin, 001;
     aSer, nNum, nLin, 999;
     ;
     NULL, DesLinKit1;
|FIN;

|PROCESO DesLinKit0;
     nTotaKit = nTotaKit + (#100#5 * #100#8);
|FPRC;

|DEFBUCLE DesLinKit0;
     #100#1004;
     ;
     aSer, nNum, nLin, 001;
     aSer, nNum, nLin, 999;
      ;
     NULL, DesLinKit0;
|FIN;

|PROCESO DesLinKit;
     |HAZ HallaProg;
     |SI aProg = "agifa550";
          |SI eaTipo550 = "TI";
               aDef = "dsm00051";
               aSer = #12#20;
               nNum = #12#0;
               nLin = #12#1;
               nPreKit = #12#6;
          |FINSI;
          |SI eaTipo550 = "AV";
               aDef = "dsm00047";
               aSer = #73#29;
               nNum = #73#0;
               nLin = #73#1;
               nPreKit = #73#6;
          |FINSI;
          |SI eaTipo550 = "FC";
               aDef = "dsm00048";
               aSer = #75#20;
               nNum = #75#0;
               nLin = #75#1;
               nPreKit = #75#6;
          |FINSI;
     |FINSI;
     |SI aProg = "tpv00001"; |O aProg = "tpv00006"; |O aProg = "agifa593";
          aDef = "dsm00051";
          aSer = #12#20;
          nNum = #12#0;
          nLin = #12#1;
          nPreKit = #12#6;
     |FINSI;
     |SI aProg = "agifa503"; |O aProg = "agifa501";
          aDef = "dsm00051";
          aSer = #12#20;
          nNum = #12#0;
          nLin = #12#1;
          nPreKit = #12#6;
     |FINSI;
     |SI aProg = "agifa104"; |O aProg = "agifa166";
          aDef = "dsm00046";
          aSer = #15#28;
          nNum = #15#0;
          nLin = #15#1;
          nPreKit = #15#6;
     |FINSI;
     |SI aProg = "agifa036";
          aDef = "dsm00049";
          aSer = #71#22;
          nNum = #71#0;
          nLin = #71#1;
          nPreKit = #71#6;
     |FINSI;
     |SI aProg = "agifa010"; |O aProg = "agifa210"; |O aProg = "agifa033";
      |O aProg = "agifa098"; |O aProg = "dsm01000";
          aDef = "dsm00047";
          aSer = #73#29;
          nNum = #73#0;
          nLin = #73#1;
         nPreKit = #73#6;
     |FINSI;
     |SI aProg = "agifa084"; |O aProg = "agifa167";
          aDef = "dsm00048";
          aSer = #75#20;
          nNum = #75#0;
          nLin = #75#1;
          nPreKit = #75#6;
     |FINSI;
     |SI aProg = "agifa146";
     |FINSI;

     |SI aDef = ""; |ACABA; |FINSI;

     |DBASE aBase;
     aPath = aBase + "def/" + aDef;
     |CARGA_DEF aPath, referen@;
     |SI FSalida = 0;
          nTotaKit = 0;
          |BUCLE DesLinKit0;
          |BUCLE DesLinKit1;
          |DESCARGA_DEF #referen@;
     |SINO;
          aAlfa = "0000Error al cargar " + aPath;
          |MENAV aAlfa;
     |FINSI;
|FPRC;

|PROCESO LinEscan;
     |SI nSwOrts = 0;
          |SI #49#10 ! 1; |ACABA; |FINSI;
     |FINSI;

     nUnidades = nCantiEscan * nUni;
     nUnidades2 = nCantiEscan * nUni2;
     nUniPend = nCantiEscan * nUniPen;
     nUniPend2 = nCantiEscan * nUniPen2;
     nMerma = 0;

     aArti = aEscan;
     |SI aProg ! "agifa550";   || En Importacion a Gestion, el almacen
          nAlma = #49#9;       || es el que trae y no el del escandallo
     |FINSI;
     aParti = #49#11;
     |SI nSwModi = 0;
          |HAZ LeArticulo;
     |FINSI;
     nPrecio = #19#18;         || PVP1 del Articulo

     |SI aProg = "agifa550";
          |SI eaTipo550 = "TI";
               |HAZ StockTPV;
               |HAZ GrabaArti;
               |HAZ HistoricoTPVR;
          |FINSI;
          |SI eaTipo550 = "AV";
               |HAZ StockAV;
               |HAZ GrabaArti;
               |HAZ HistoricoAV;
          |FINSI;
          |SI eaTipo550 = "FC";
               |HAZ StockFC;
               |HAZ GrabaArti;
               |HAZ HistoricoFC;
          |FINSI;
     |FINSI;
     |SI aProg = "tpv00001"; |O aProg = "tpv00006"; |O aProg = "agifa593";
          |HAZ StockTPV;
          |HAZ GrabaArti;
          |HAZ HistoricoTPVR;
     |FINSI;
     |SI aProg = "agifa503"; |O aProg = "agifa501";
          |SI nSwModi = 0;
               |HAZ StockTPV;
               |HAZ GrabaArti;
               |HAZ HistoricoTPV;
          |SINO;
               |SI enForma = 1;
                    |HAZ ModiHistoTPVAlta;
               |SINO;
                    |HAZ ModiHistoTPVBaja;
               |FINSI;
          |FINSI;
     |FINSI;
     |SI aProg = "agifa104"; |O aProg = "agifa166"; |O nSwAdjPed = 1;
          |HAZ StockPV;
          |HAZ GrabaArti;
          |SI nSwAdjPed = 1; |ACABA; |FINSI;
     |FINSI;
     |SI aProg = "agifa036";
          |SI nSwModi = 0;
               |HAZ StockDE;
               |HAZ GrabaArti;
          |FINSI;
     |FINSI;
     |SI aProg = "agifa010"; |O aProg = "agifa210"; |O aProg = "agifa033";
      |O aProg = "agifa098"; |O aProg = "dsm01000";
          |SI nSwModi = 0;
               |HAZ StockAV;
               |HAZ GrabaArti;
               |HAZ HistoricoAV;
          |SINO;
               |HAZ ModiHistoAV0;
          |FINSI;
     |FINSI;
     |SI aProg = "agifa084"; |O aProg = "agifa167";
          |SI nSwModi = 0;
               |HAZ StockFC;
               |HAZ GrabaArti;
               |HAZ HistoricoFC;
          |SINO;
               |HAZ ModiHistoFC0;
          |FINSI;
     |FINSI;
     |SI aProg = "agifa146";
     |FINSI;
|FPRC;

|PROCESO StockTPV;
     art_disp = art_disp - nUnidades;
     art_disp2 = art_disp2 - nUnidades2;
     art_tota = art_tota - nUnidades;
     art_tota2 = art_tota2 - nUnidades2;

     alm_disp = alm_disp - nUnidades;
     alm_disp2 = alm_disp2 - nUnidades2;
     alm_tota = alm_tota - nUnidades;
     alm_tota2 = alm_tota2 - nUnidades2;

     par_disp = par_disp - nUnidades;
     par_disp2 = par_disp2 - nUnidades2;
     par_tota = par_tota - nUnidades;
     par_tota2 = par_tota2 - nUnidades2;

     par_sreal = par_sreal + nUnidades;
     par_sreal2 = par_sreal2 + nUnidades2;
     par_merma = par_merma + nMerma;

     |HAZ Valora_Stock;
     |SI #19#194 = 1; nUni0 = nUnidades; |SINO; nUni0 = nUnidades2; |FINSI;
     nCoste = nCoste + (nUni0 * art_pcm);

     aAlfa = #11#14 % 402;
     nNume = aAlfa;
     nNume = ((nNume - 1) * 5) + 34;
      #19nNume = #19nNume + nUni0;
      #19#94   = #19#94   + nUni0;
      nNume    = aAlfa;
      nNume    = ((nNume - 1) * 2) + 11;
      #17nNume = #17nNume + nUni0;
      #17#35   = #17#35   + nUni0;

      #19#24   = #11#14;
      #19#25   = #19#25 + nUni0;
|FPRC;

|PROCESO HistoricoTPVR;
                                 || Importacion
     |SI enSwHisto = "N"; |Y aProg = "agifa550"; |ACABA; |FINSI;

     nPreTon = 1;
     |HAZ EsVigor;
     |SI FSalida = 0;
          aAlfa = #agifa019#110; |QBF aAlfa;   || Alfanumerico1
          aAlfa = aAlfa > "";
          |SI aAlfa = "S"; nPreTon = 1000; |FINSI;
     |FINSI;

     |ABRE #65;
     |DDEFECTO #65;
     #65#0 = aArti;
     #65#1 = #11#14;
     #65#2 = "TI";
     #65#3 = #11#58;
     #65#4 = #12#1;
     #65#11 = #11#57;
     |LEE 101#65=;
     |SI FSalida = 0;
          |BORRA 020#65a;     || modificado para inforpor
     |FINSI;
     #65#5 = nAlma;
     #65#6 = #65#6 - nUnidades;
     #65#7 = #19#6;
     #65#8 = #19#9;
     #65#9 = nPrecio / nPreTon;
     #65#10 = #11#1;
     #65#12 = #12#14;
     #65#13 = 0;
     #65#14 = ((((#65#9 < #65#12) < #65#13) < #11#17) < #11#19);
     |SI #142#115 = "S";
          #65#14 = #65#14 < #11#18;
     |FINSI;
     #65#17 = #65#17 - nUnidades2;
     #65#18 = aParti;
     #65#19 = #65#19 + nMerma;
     |SI enForma = 1;
          |GRABA 020#65n;    || modificado para inforpor
     |FINSI;
     |CIERRA #65;
|FPRC;

|PROCESO AcumulaTPVR;

     nCoste = 0;
     fUltFecha = #11#14;
     aArti = #12#2;
     nAlma = #12#3;
     aParti = #12#30;
     nMerma = #12#31;
     nPrecio = #12#10;
     |SI enForma = 1;
          nUni = #12#5;
          nUni2 = #12#29;
     |SINO;
          nUni = -#12#5;
          nUni2 = -#12#29;
     |FINSI;
     nUnidades = nUni;
     nUnidades2 = nUni2;

     |HAZ LeArticulo;
     |HAZ StockTPV;
     |HAZ GrabaArti;
     |HAZ HistoricoTPVR;
     |SI aTipoEsca = "S";
          aEscan = aArti;
          nCantiEscan = 1;
          |HAZ DesglosaEscan;
     |FINSI;
     |SI aTipoEsca = "K"; |O eaImporIber = "S";
          |HAZ MiraEscan;
          |SI nEsEscan = 0; |O eaImporIber = "S";
               xCoste = 0;
               |HAZ DesLinKit;
               nCoste = xCoste;
          |FINSI;
     |FINSI;
     |SI aTipoEsca = "N"; |Y #142#126 > 0;
          xCoste = nCoste;
          nMaxNivel = #142#126;
          aEscan = aArti;
          nCantiEscan = 1;
          |HAZ DesglosaEscan;
          nCoste = xCoste;
     |FINSI;

     enCoste = nCoste;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO HistoricoTPV;
     nPreTon = 1;
     |HAZ EsVigor;
     |SI FSalida = 0;
          aAlfa = #agifa019#110; |QBF aAlfa;   || Alfanumerico1
          aAlfa = aAlfa > "";
          |SI aAlfa = "S"; nPreTon = 1000; |FINSI;
     |FINSI;
     |ABRE #65;
     |DDEFECTO #65;
     #65#0 = aArti;
     #65#1 = #11#14;
     #65#2 = "TI";
     #65#3 = #12#0;
     #65#4 = #12#1;
     #65#11 = #12#20;
     |LEE 101#65=;
     |SI FSalida = 0;
          |BORRA 020#65a;     || modificado para inforpor
     |FINSI;
     #65#5 = nAlma;
     #65#6 = #65#6 - nUnidades;
     #65#7 = #19#6;
     #65#8 = #19#9;
     #65#9 = nPrecio / nPreTon;
     #65#10 = #11#1;
     #65#12 = #12#14;
     #65#13 = 0;
     #65#14 = ((((#65#9 < #65#12) < #65#13) < #11#17) < #11#19);
     |SI #142#115 = "S";
          #65#14 = #65#14 < #11#18;
     |FINSI;
     #65#17 = #65#17 - nUnidades2;
     #65#18 = aParti;
     #65#19 = #65#19 + nMerma;
     |SI enForma = 1;
          |GRABA 020#65n;   ||  modificado para inforpor
     |FINSI;
     |CIERRA #65;
|FPRC;

|PROCESO AcumulaTPV;
     nCoste = 0;
     fUltFecha = #11#14;
     aArti = #12#2;
     nAlma = #12#3;
     aParti = #12#30;
     nMerma = #12#31;
     nPrecio = #12#10;
     |SI enForma = 1;
          nUni = #12#5;
          nUni2 = #12#29;
     |SINO;
          nUni = -#12#5;
          nUni2 = -#12#29;
     |FINSI;
     nUnidades = nUni;
     nUnidades2 = nUni2;

     |HAZ LeArticulo;
     |HAZ StockTPV;
     |HAZ GrabaArti;
     |HAZ HistoricoTPV;
     |SI aTipoEsca = "S";
          aEscan = aArti;
          nCantiEscan = 1;
          |HAZ DesglosaEscan;
     |FINSI;
     |SI aTipoEsca = "K";
          |HAZ MiraEscan;
          |SI nEsEscan = 0;
               xCoste = 0;
               |HAZ DesLinKit;
               nCoste = xCoste;
          |FINSI;
     |FINSI;
     |SI aTipoEsca = "N"; |Y #142#126 > 0;
          xCoste = nCoste;
          nMaxNivel = #142#126;
          aEscan = aArti;
          nCantiEscan = 1;
          |HAZ DesglosaEscan;
          nCoste = xCoste;
     |FINSI;

     enCoste = nCoste;
|FPRC;

|PROCESO ModiHistoTPVAlta;
     nPreTon = 1;
     |HAZ EsVigor;
     |SI FSalida = 0;
          aAlfa = #agifa019#110; |QBF aAlfa;   || Alfanumerico1
          aAlfa = aAlfa > "";
          |SI aAlfa = "S"; nPreTon = 1000; |FINSI;
     |FINSI;
     |ABRE #65;
     #65#0 = aArti;
     #65#1 = #11#14;
     #65#2 = "TI";
     #65#3 = #12#0;
     #65#4 = #12#1;
     #65#11 = #12#20;
     |LEE 101#65=;
     |SI FSalida = 0;
          |BORRA 040#65a;
          |LIBERA #65;
     |SINO;
          |CIERRA #65;
          |ACABA;
     |FINSI;

     #65#0 = aArti;
     #65#1 = #11#14;
     #65#2 = eaOpeTP;
     #65#3 = #11#58;
     #65#4 = #12#1;
     #65#11 = #11#57;

     #65#10 = #11#1;
     #65#12 = #12#14;
     #65#13 = 0;
     #65#14 = ((((#65#9 < #65#12) < #65#13) < #11#17) < #11#19);
     |SI #142#115 = "S";
          #65#14 = #65#14 < #11#18;
     |FINSI;
     |GRABA 020#65n;
     |CIERRA #65;
|FPRC;

|PROCESO ModiHistoTPVBaja;
     |ABRE #65;
     #65#0 = aArti;
     #65#1 = #11#14;
     #65#2 = eaOpeTP;
     #65#3 = #11#58;
     #65#4 = #12#1;
     #65#11 = #11#57;
     |LEE 101#65=;
     |SI FSalida = 0;
          |BORRA 040#65a;
          |LIBERA #65;

          #65#0 = #12#2;
          #65#1 = #11#14;
          #65#2 = "TI";
          #65#3 = #12#0;
          #65#4 = #12#1;
          #65#11 = #12#20;
          |GRABA 020#65n;
     |FINSI;
     |CIERRA #65;
|FPRC;

|PROCESO ModiHistoTPV;
     nSwModi = 1;
     aArti = #12#2;
     |SI enForma = 1;
          |HAZ ModiHistoTPVAlta;
     |SINO;
          |HAZ ModiHistoTPVBaja;
     |FINSI;
     |SI aTipoEsca = "S";
          aEscan = aArti;
          nCantiEscan = 1;
          |HAZ DesglosaEscan;
     |FINSI;
     |SI aTipoEsca = "K";
          |HAZ MiraEscan;
          |SI nEsEscan = 0;
               xCoste = 0;
               |HAZ DesLinKit;
               nCoste = xCoste;
          |FINSI;
     |FINSI;
     |SI aTipoEsca = "N"; |Y #142#126 > 0;
          xCoste = nCoste;
          nMaxNivel = #142#126;
          aEscan = aArti;
          nCantiEscan = 1;
          |HAZ DesglosaEscan;
          nCoste = xCoste;
      |FINSI;
     nSwModi = 0;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO StockPV;
     art_pser = art_pser + nUnidades;
     art_pser2 = art_pser2 + nUnidades2;
     alm_pser = alm_pser + nUnidades;
     alm_pser2 = alm_pser2 + nUnidades2;
     par_pser = par_pser + nUnidades;
     par_pser2 = par_pser2 + nUnidades2;
     |SI #15#22 = "S";
          art_rese = art_rese + nUnidades;
          art_disp = art_disp - nUnidades;
          art_disp2 = art_disp2 - nUnidades2;
          alm_rese = alm_rese + nUnidades;
          alm_disp = alm_disp - nUnidades;
          alm_disp2 = alm_disp2 - nUnidades2;
          par_disp = par_disp - nUnidades;
          par_disp2 = par_disp2 - nUnidades2;
     |FINSI;
     |HAZ Valora_Stock;
|FPRC;

|PROCESO AcumulaPV;
     aEsSalida = "N";
     nSwAdjPed = 0;
     |MODULO aProg;
     |SI eaProgVta ! ""; aProg = eaProgVta; |FINSI;

     |SI aProg = "agifa098";  || Adj. de Albaran
          aTipDoc = "X";
          aSerDoc = #73#29;
          nNumDoc = #73#0;
          nLinDoc = #73#1;
          nMed1 = #73#51;
          nMed2 = #73#52;
          nMed3 = #73#53;

          nSwAdjPed = 1;
          aArti = #73#2;
          nAlma = #73#3;
          aParti = #15#45; || #73#49;
          nMerma = #73#50;
          nPrecio = #73#6;
          nUnidades = -#73#5;
          nUnidades2 = -#73#48;
          nUni = -#73#5;
          nUni2 = -#73#48;
     |SINO;
          aTipDoc = "P";
          aSerDoc = #15#28;
          nNumDoc = #15#0;
          nLinDoc = #15#1;
          nMed1 = #15#50;
          nMed2 = #15#51;
          nMed3 = #15#52;

          aArti = #15#2;
          nAlma = #15#3;
          aParti = #15#45;
          nMerma = #15#46;
          nPrecio = #15#6;
          |SI enForma = 1;
               nUni = #15#5;
               nUni2 = #15#44;
          |SINO;
               nUni = -#15#5;
               nUni2 = -#15#44;
          |FINSI;
          nUnidades = nUni;
          nUnidades2 = nUni2;
     |FINSI;

     |HAZ LeArticulo;
     |HAZ StockPV;
     |HAZ GrabaArti;
     |SI aTipoEsca = "S";
          aEscan = aArti;
          nCantiEscan = 1;
          |HAZ DesglosaEscan;
     |FINSI;
     |SI aTipoEsca = "K";
          |HAZ MiraEscan;
          |SI nEsEscan = 0;
               xCoste = 0;
               |HAZ DesLinKit;
               nCoste = xCoste;
          |FINSI;
     |FINSI;
     |SI aTipoEsca = "N"; |Y #142#126 > 0;
          xCoste = nCoste;
          nMaxNivel = #142#126;
          aEscan = aArti;
          nCantiEscan = 1;
          |HAZ DesglosaEscan;
          nCoste = xCoste;
     |FINSI;
     aEsSalida = "S";
     nSwAdjPed = 0;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO ModiHistoAV0;
     #65#0 = aArti;
     #65#1 = #72#1;
     #65#2 = aOpera;
     #65#3 = #73#0;
     #65#4 = #73#1;
     #65#11 = #73#29;
     |LEE 101#65=;
     |SI FSalida = 0;
          #65#10 = #72#3; ||Cli
          #65#12 = #73#8; ||Dto1
          #65#13 = #73#33;||Dto2                ||Dto Espe ||Dto Ac
          #65#14 = ((((#65#9 < #65#12) < #65#13) < #72#5) < #72#32);
          |SI #142#115 = "S";   ||Dto Pp
               #65#14 = #65#14 < #72#7;
          |FINSI;
          ||GRABA 020#65a;     modificado para inforpor
          |BORRA 020#65a;
          |GRABA 020#65n;
          |LIBERA #65;
     |FINSI;
|FPRC;

|PROCESO HistoricoAV;
                                 || Importacion
     |SI enSwHisto = "N"; |Y aProg = "agifa550"; |ACABA; |FINSI;

     nPreTon = 1;
     |HAZ EsVigor;
     |SI FSalida = 0;
          aAlfa = #agifa019#110; |QBF aAlfa;   || Alfanumerico1
          aAlfa = aAlfa > "";
          |SI aAlfa = "S"; nPreTon = 1000; |FINSI;
     |FINSI;

     |DDEFECTO #65;
     #65#0 = aArti;
     #65#1 = #72#1;
     #65#2 = aOpera;
     #65#3 = #73#0;
     #65#4 = #73#1;
     #65#11 = #73#29;
     |LEE 101#65=;
     |SI FSalida = 0;
          |BORRA 020#65a;     || modificado para inforpor
     |FINSI;
     #65#5 = nAlma;
     |SI #72#43 = "S";
          #65#6 = #65#6 + nUnidades;
          #65#17 = #65#17 + nUnidades2;
     |SINO;
          #65#6 = #65#6 - nUnidades;
          #65#17 = #65#17 - nUnidades2;
     |FINSI;
     #65#7 = #19#6;
     #65#8 = #19#9;
     #65#9 = nPrecio / nPreTon;

     |HAZ EsSanchez;
     |SI FSalida = 0;
          eaArti = #65#0;
          enPrecio = #65#9;
          |HAZ SanchezPreVta;
          #65#9 = enPrecio;
     |FINSI;

     #65#10 = #72#3;
     #65#12 = #73#8;
     #65#13 = #73#33;                      || Dto Espe   ||Dto Ac
     #65#14 = ((((#65#9 < #65#12) < #65#13) < #72#5) < #72#32);
     |SI #142#115 = "S";   ||Dto Pp
          #65#14 = #65#14 < #72#7;
     |FINSI;
     #65#18 = aParti;
     #65#19 = nMerma;
     |SI enForma = 1;
          |GRABA 020#65n;   ||  modificado para inforpor
     |FINSI;

     |HAZ EsTaller;
     |SI FSalida = 0; |Y eaAlbTaller ! "S"; || Y no esta hecho por el modulo
          |HAZ TallerAuxHis;
     |FINSI;
|FPRC;

|PROCESO StockAV;
     |SI aProg = "agifa210";  |O aProg = "dsm01000";
          aParti = #15#45;  || La del pedido
          |HAZ LeArticulo;
          par_pser = par_pser - nUniPend;
          par_pser2 = par_pser2 - nUniPend2;
          |SI eaReservado = "S";
              par_disp = par_disp + nUniPend;
              par_disp2 = par_disp2 + nUniPend2;
          |FINSI;
          |HAZ GrabaArti;
          aParti = #73#49;
          |HAZ LeArticulo;

          |SI eaReservado = "S";
              art_disp = art_disp + nUniPend;
              art_disp2 = art_disp2 + nUniPend2;
              art_rese = art_rese - nUniPend;

              alm_disp = alm_disp + nUniPend;
              alm_disp2 = alm_disp2 + nUniPend2;
              alm_rese = alm_rese - nUniPend;
          |FINSI;
          art_pser = art_pser - nUniPend;
          art_pser2 = art_pser2 - nUniPend2;
          alm_pser = alm_pser - nUniPend;
          alm_pser2 = alm_pser2 - nUniPend2;
     |FINSI;
     |SI aProg = "agifa033";
         art_depo = art_depo - nUnidades;
         art_depo2 = art_depo2 - nUnidades2;
         alm_depo = alm_depo - nUnidades;
         alm_depo2 = alm_depo2 - nUnidades2;
         par_depo = par_depo - nUnidades;
         par_depo2 = par_depo2 - nUnidades2;
         |SI #72#43 ! "S";
              art_tota = art_tota - nUnidades;
              art_tota2 = art_tota2 - nUnidades2;
              alm_tota = alm_tota - nUnidades;
              alm_tota2 = alm_tota2 - nUnidades2;
              par_tota = par_tota - nUnidades;
              par_tota2 = par_tota - nUnidades2;
              par_sreal = par_sreal + nUnidades;
              par_sreal2 = par_sreal2 + nUnidades2;
              par_merma = par_merma + nMerma;
         |SINO;
              art_tota = art_tota + nUnidades;
              art_tota2 = art_tota2 + nUnidades2;
              alm_tota = alm_tota + nUnidades;
              alm_tota2 = alm_tota2 + nUnidades2;
              par_tota = par_tota + nUnidades;
              par_tota2 = par_tota2 + nUnidades2;
              par_sreal = par_sreal - nUnidades;
              par_sreal2 = par_sreal2 - nUnidades2;
              par_merma = par_merma - nMerma;
         |FINSI;
     |SINO;
          |SI #72#43 ! "S";
               art_disp = art_disp - nUnidades;
               art_disp2 = art_disp2 - nUnidades2;
               art_tota = art_tota - nUnidades;
               art_tota2 = art_tota2 - nUnidades2;
               alm_disp = alm_disp - nUnidades;
               alm_disp2 = alm_disp2 - nUnidades2;
               alm_tota = alm_tota - nUnidades;
               alm_tota2 = alm_tota2 - nUnidades2;
               par_merma = par_merma + nMerma;
               par_sreal = par_sreal + nUnidades;
               par_sreal2 = par_sreal2 + nUnidades2;
               par_disp = par_disp - nUnidades;
               par_disp2 = par_disp2 - nUnidades2;
               par_tota = par_tota - nUnidades;
               par_tota2 = par_tota2 - nUnidades2;
          |SINO;
               art_disp = art_disp + nUnidades;
               art_disp2 = art_disp2 + nUnidades2;
               art_tota = art_tota + nUnidades;
               art_tota2 = art_tota2 + nUnidades2;
               alm_disp = alm_disp + nUnidades;
               alm_disp2 = alm_disp2 + nUnidades2;
               alm_tota = alm_tota + nUnidades;
               alm_tota2 = alm_tota2 + nUnidades2;
               par_merma = par_merma - nMerma;
               par_sreal = par_sreal - nUnidades;
               par_sreal2 = par_sreal2 - nUnidades2;
               par_disp = par_disp + nUnidades;
               par_disp2 = par_disp2 + nUnidades2;
               par_tota = par_tota + nUnidades;
               par_tota2 = par_tota2 + nUnidades2;
          |FINSI;
     |FINSI;

     |SI enForma = 1; #24#5 = #72#1; |FINSI;

     |HAZ Valora_Stock;
     |SI #19#194 = 1; nUni0 = nUnidades; |SINO; nUni0 = nUnidades2; |FINSI;
     nCoste = nCoste + (nUni0 * art_pcm);

     aAlfa = #72#1 % 402;
     nNume = aAlfa;
     nNume = ((nNume - 1) * 5) + 34;

     |SI #72#43 ! "S";
          #19nNume = #19nNume + nUni0;
          #19#94   = #19#94   + nUni0;
          nNume    = aAlfa;
          nNume    = ((nNume - 1) * 2) + 11;
          #17nNume = #17nNume + nUni0;
          #17#35   = #17#35   + nUni0;

          |SI enForma = 1; |Y #279#30 = "A";
               #19#24 = #72#1;
               #19#25 = nUnidades;
          |FINSI;
     |SINO;
          #19nNume = #19nNume - nUni0;
          #19#94   = #19#94 - nUnidades;
          nNume    = aAlfa;
          nNume    = ((nNume  - 1) * 2) + 11;
          #17nNume = #17nNume - nUni0;
          #17#35   = #17#35   - nUni0;
     |FINSI;

     |HAZ EsAlbero;
     |SI FSalida = 0;
          enAlbForma = enForma;
          |SI enForma = 1;
               enUni1 = nUnidades;
               enUni2 = nUnidades2;
          |SINO;
               enUni1 = -nUnidades;
               enUni2 = -nUnidades2;
          |FINSI;
          |HAZ AlberoActPartidasAV;
     |FINSI;
|FPRC;

|PROCESO TipoOpera;
     |SI #72#43 = "N";
          aOperacion = "AV";
          aOperaInte = "AC";
     |SINO;
          aOperacion = "BV";
          aOperaInte = "BC";
     |FINSI;
|FPRC;

|PROCESO AcumulaAV;
     |ABRE #279; |LEE 000#279p; |CIERRA #279;

     |HAZ EsOrts;
     nSwOrts = FSalida;

     |HAZ TipoOpera;
     nCoste = 0;
     fUltFecha = #72#1;

     aSer = #72#52;
     |HAZ LeeSerie;

     aTipDoc = "A";
     aSerDoc = #73#29;
     nNumDoc = #73#0;
     nLinDoc = #73#1;
     nMed1 = #73#51;
     nMed2 = #73#52;
     nMed3 = #73#53;
     aArti = #73#2;
     nAlma = #73#3;
     aParti = #73#49;
     nMerma = #73#50;
     nPrecio = #73#6;
     |SI enForma = 1;
          nUni = #73#5;
          nUni2 = #73#48;
          nUniPen = enUnidPend;
          nUniPen2 = enUnidPend2;
     |SINO;
          nUni = -#73#5;
          nUni2 = -#73#48;
          nUniPen = -enUnidPend;
          nUniPen2 = -enUnidPend2;
     |FINSI;
     nUnidades = nUni;
     nUnidades2 = nUni2;
     nUniPend = nUniPen;
     nUniPend2 = nUniPen2;
     aOpera = aOperacion;

     |ABRE #65;
     |HAZ LeArticulo;
     |HAZ StockAV;
     |HAZ GrabaArti;
     |HAZ HistoricoAV;
     |SI aTipoEsca = "S";
          aEscan = aArti;
          nCantiEscan = 1;
          |HAZ DesglosaEscan;
     |FINSI;
     |SI aTipoEsca = "K"; |O eaImporIber = "S";
          |HAZ MiraEscan;
          |SI nEsEscan = 0; |O eaImporIber = "S";
               xCoste = 0;
               |HAZ DesLinKit;
               nCoste = xCoste;
          |FINSI;
     |FINSI;
     |SI aTipoEsca = "N"; |Y #142#126 > 0;
          xCoste = nCoste;
          nMaxNivel = #142#126;
          aEscan = aArti;
          nCantiEscan = 1;
          |HAZ DesglosaEscan;
          nCoste = xCoste;
     |FINSI;
     enCoste = nCoste;

     |SI aEsInte = "S";
          nUniPend = 0;
          nUniPend2 = 0;
          nGuardaAlma = #73#3;
          #73#3 = nAlmaInte;

          aArti = #73#2;
          nAlma = #73#3;
          aParti = #73#49;
          nMerma = #73#50;
          nPrecio = #73#6;
          |SI enForma = 1;
               nUni = -#73#5;
               nUni2 = -#73#48;
          |SINO;
               nUni = #73#5;
               nUni2 = #73#48;
          |FINSI;
          nUnidades = nUni;
          nUnidades2 = nUni2;

          aOpera = aOperaInte;
          |HAZ LeArticulo;
          |HAZ StockAV;
          |HAZ GrabaArti;
          |HAZ HistoricoAV;
          |SI aTipoEsca = "S";
               aEscan = aArti;
               nCantiEscan = 1;
               |HAZ DesglosaEscan;
          |FINSI;
          |SI aTipoEsca = "K";
               |HAZ MiraEscan;
               |SI nEsEscan = 0;
                    xCoste = 0;
                    |HAZ DesLinKit;
                    nCoste = xCoste;
               |FINSI;
          |FINSI;
          |SI aTipoEsca = "N"; |Y #142#126 > 0;
               xCoste = nCoste;
               nMaxNivel = #142#126;
               aEscan = aArti;
               nCantiEscan = 1;
               |HAZ DesglosaEscan;
               nCoste = xCoste;
          |FINSI;
          #73#3 = nGuardaAlma;
     |FINSI;
     |CIERRA #65;
     enProg211 = 0;
|FPRC;

|PROCESO ModiHistoAV;
     |ABRE #65;
     nSwModi = 1;
     aArti = #73#2;
     |HAZ TipoOpera;
     aOpera = aOperacion
     |HAZ ModiHistoAV0;
     |SI aTipoEsca = "S";
          aEscan = #73#2;
          nCantiEscan = 1;
          |HAZ DesglosaEscan;
     |FINSI;
     |SI aTipoEsca = "K";
          |HAZ MiraEscan;
          |SI nEsEscan = 0;
               xCoste = 0;
               |HAZ DesLinKit;
               nCoste = xCoste;
          |FINSI;
     |FINSI;
     |SI aTipoEsca = "N"; |Y #142#126 > 0;
          xCoste = nCoste;
          nMaxNivel = #142#126;
          aEscan = aArti;
          nCantiEscan = 1;
          |HAZ DesglosaEscan;
          nCoste = xCoste;
     |FINSI;
     |SI aEsInte = "S";
          nGuardaAlma = #73#3;
          #73#3 = nAlmaInte;

          aOpera = aOperaInte;
          |HAZ ModiHistoAV0;
          |SI aTipoEsca = "S";
               aEscan = #73#2;
               nCantiEscan = 1;
               |HAZ DesglosaEscan;
          |FINSI;
          |SI aTipoEsca = "K";
               |HAZ MiraEscan;
               |SI nEsEscan = 0;
                    xCoste = 0;
                    |HAZ DesLinKit;
                    nCoste = xCoste;
               |FINSI;
          |FINSI;
          |SI aTipoEsca = "N"; |Y #142#126 > 0;
               xCoste = nCoste;
               nMaxNivel = #142#126;
               aEscan = aArti;
               nCantiEscan = 1;
               |HAZ DesglosaEscan;
               nCoste = xCoste;
          |FINSI;
          #73#3 = nGuardaAlma;
     |FINSI;
     nSwModi = 0;
     |CIERRA #65;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO StockDE;
     art_disp = art_disp - nUnidades;
     art_disp2 = art_disp2 - nUnidades2;
     art_depo = art_depo + nUnidades;
     art_depo2 = art_depo2 + nUnidades2;

     alm_disp = alm_disp - nUnidades;
     alm_disp2 = alm_disp2 - nUnidades2;
     alm_depo = alm_depo + nUnidades;
     alm_depo2 = alm_depo2 + nUnidades2;

     par_disp = par_disp - nUnidades;
     par_disp2 = par_disp2 - nUnidades2;
     par_depo = par_depo + nUnidades;
     par_depo2 = par_depo2 + nUnidades2;

     |HAZ Valora_Stock;
     |SI #19#194 = 1;
          nCoste = nCoste + (nUnidades * art_pcm);
     |SINO;
          nCoste = nCoste + (nUnidades2 * art_pcm);
     |FINSI;
|FPRC;

|PROCESO AcumulaDE;
     nCoste = 0;
     fUltFecha = #70#1;

     aArti = #71#2;
     nAlma = #71#3;
     aParti = #71#29;
     nMerma = #71#30;
     nPrecio = #71#6;
     |SI enForma = 1;
          nUni = #71#5;
          nUni2 = #71#28;
     |SINO;
          nUni = -#71#5;
          nUni2 = -#71#28;
     |FINSI;
     nUnidades = nUni;
     nUnidades2 = nUni2;
     aOpera = "DP";

     |ABRE #65;
     |HAZ LeArticulo;
     |HAZ StockDE;
     |HAZ GrabaArti;
     |SI aTipoEsca = "S";
          aEscan = aArti;
          nCantiEscan = 1;
          |HAZ DesglosaEscan;
     |FINSI;
     |SI aTipoEsca = "K";
          |HAZ MiraEscan;
          |SI nEsEscan = 0;
               xCoste = 0;
               |HAZ DesLinKit;
               nCoste = xCoste;
          |FINSI;
     |FINSI;
     |SI aTipoEsca = "N";|Y #142#126 > 0;
          xCoste = nCoste;
          nMaxNivel = #142#126;
          aEscan = aArti;
          nCantiEscan = 1;
          |HAZ DesglosaEscan;
          nCoste = xCoste;
     |FINSI;
     enCoste = nCoste;

     |CIERRA #65;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO ModiHistoFC0;
     #65#0 = aArti;
     #65#1 = #74#1;
     #65#2 = "FC";
     #65#3 = #75#0;
     #65#4 = #75#1;
     #65#11 = #75#20;
     |LEE 101#65=;
     |SI FSalida = 0;
          #65#10 = #74#3; ||Cli
          #65#12 = #75#8; ||Dto1
          #65#13 = #75#21;||Dto2                ||Dto Espe ||Dto Ac
          #65#14 = ((((#65#9 < #65#12) < #65#13) < #74#5) < #74#32);
          |SI #142#115 = "S";   ||Dto Pp
               #65#14 = #65#14 < #74#7;
          |FINSI;
          ||GRABA 020#65a;     modificado para inforpor
          |BORRA 020#65a;
          |GRABA 020#65n;
          |LIBERA #65;
     |FINSI;
|FPRC;

|PROCESO HistoricoFC;
                                 || Importacion
     |SI enSwHisto = "N"; |Y aProg = "agifa550"; |ACABA; |FINSI;

     nPreTon = 1;
     |HAZ EsVigor;
     |SI FSalida = 0;
          aAlfa = #agifa019#110; |QBF aAlfa;   || Alfanumerico1
          aAlfa = aAlfa > "";
          |SI aAlfa = "S"; nPreTon = 1000; |FINSI;
     |FINSI;
     |DDEFECTO #65;
     #65#0 = aArti;
     #65#1 = #74#1;
     #65#2 = "FC";
     #65#3 = #75#0;
     #65#4 = #75#1;
     #65#11 = #75#20;
     |LEE 101#65=;
     |SI FSalida = 0;
          |BORRA 020#65a;
     |FINSI;
     #65#5 = nAlma;
     #65#6 = #65#6 - nUnidades;
     #65#7 = #19#6;
     #65#8 = #19#9;
     #65#9 = nPrecio / nPreTon;

     |HAZ EsSanchez;
     |SI FSalida = 0;
          eaArti = #65#0;
          enPrecio = #65#9;
          |HAZ SanchezPreVta;
          #65#9 = enPrecio;
     |FINSI;

     #65#10 = #74#3; ||Cli
     #65#12 = #75#8; ||Dto1
     #65#13 = #75#21;||Dto2                ||Dto Espe ||Dto Ac
     #65#14 = ((((#65#9 < #65#12) < #65#13) < #74#5) < #74#32);
     |SI #142#115 = "S";   ||Dto Pp
          #65#14 = #65#14 < #74#7;
     |FINSI;
     #65#17 = #65#17 - nUnidades2;
     #65#18 = aParti;
     #65#19 = nMerma;
     |SI enForma = 1;
          |GRABA 020#65n;    ||  modificado para inforpor
     |FINSI;
|FPRC;

|PROCESO StockFC;
     art_disp = art_disp - nUnidades;
     art_disp2 = art_disp2 - nUnidades2;
     art_tota = art_tota - nUnidades;
     art_tota2 = art_tota2 - nUnidades2;

     alm_disp = alm_disp - nUnidades;
     alm_disp2 = alm_disp2 - nUnidades2;
     alm_tota = alm_tota - nUnidades;
     alm_tota2 = alm_tota2 - nUnidades2;

     par_disp = par_disp - nUnidades;
     par_disp2 = par_disp2 - nUnidades2;
     par_tota = par_tota - nUnidades;
     par_tota2 = par_tota2 - nUnidades2;

     par_sreal = par_sreal + nUnidades;
     par_sreal2 = par_sreal2 + nUnidades2;
     par_merma = par_merma + nMerma;

     |SI enForma = 1; #24#5 = #74#1; |FINSI;

     |HAZ Valora_Stock;
     |SI #19#194 = 1; nUni0 = nUnidades; |SINO; nUni0 = nUnidades2; |FINSI;
     nCoste = nCoste + (nUni0 * art_pcm);

     aAlfa = #74#1 % 402;
     nNume = aAlfa;
     nNume = ((nNume - 1) * 5) + 34;

     #19nNume = #19nNume + nUni0;
     #19#94   = #19#94   + nUni0;
     nNume    = aAlfa;
     nNume    = ((nNume - 1) * 2) + 11;
     #17nNume = #17nNume + nUni0;
     #17#35   = #17#35   + nUni0;

     #19#24   = #74#1;
     #19#25   = #19#25 + nUni0;
|FPRC;

|PROCESO AcumulaFC;
     nCoste = 0;
     fUltFecha = #74#1;

     aSer = #74#48;
     |HAZ LeeSerie;

     aTipDoc = "F";
     aSerDoc = #75#20;
     nNumDoc = #75#0;
     nLinDoc = #75#1;
     nMed1 = #75#33;
     nMed2 = #75#34;
     nMed3 = #75#35;

     aArti = #75#2;
     nAlma = #75#3;
     aParti = #75#31;
     nMerma = #75#32;
     nPrecio = #75#6;
     |SI enForma = 1;
          nUni = #75#5;
          nUni2 = #75#30;
     |SINO;
          nUni = -#75#5;
          nUni2 = -#75#30;
     |FINSI;
     nUnidades = nUni;
     nUnidades2 = nUni2;

     |ABRE #65;
     |HAZ LeArticulo;
     |HAZ StockFC;
     |HAZ GrabaArti;
     |HAZ HistoricoFC;
     |SI aTipoEsca = "S";
          aEscan = aArti;
          nCantiEscan = 1;
          |HAZ DesglosaEscan;
     |FINSI;
     |SI aTipoEsca = "K";
          |HAZ MiraEscan;
          |SI nEsEscan = 0;
               xCoste = 0;
               |HAZ DesLinKit;
               nCoste = xCoste;
          |FINSI;
     |FINSI;
     |SI aTipoEsca = "N"; |Y #142#126 > 0;
          xCoste = nCoste;
          nMaxNivel = #142#126;
          aEscan = aArti;
          nCantiEscan = 1;
          |HAZ DesglosaEscan;
          nCoste = xCoste;
     |FINSI;
     enCoste = nCoste;

     |CIERRA #65;
|FPRC;

|PROCESO ModiHistoFC;
     |ABRE #65;
     nSwModi = 1;
     aArti = #75#2;
     |HAZ ModiHistoFC0;
     |SI aTipoEsca = "S";
          aEscan = #75#2;
          nCantiEscan = 1;
          |HAZ DesglosaEscan;
     |FINSI;
     |SI aTipoEsca = "K";
          |HAZ MiraEscan;
          |SI nEsEscan = 0;
               xCoste = 0;
               |HAZ DesLinKit;
               nCoste = xCoste;
          |FINSI;
     |FINSI;
     |SI aTipoEsca = "N"; |Y #142#126 > 0;
          xCoste = nCoste;
          nMaxNivel = #142#126;
          aEscan = aArti;
          nCantiEscan = 1;
          |HAZ DesglosaEscan;
          nCoste = xCoste;
     |FINSI;
     nSwModi = 0;
     |CIERRA #65;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO MiraMedida;
     |ABRE #19;
     #19#0 = aArti;
     |LEE 000#19=;
     |CIERRA #19;

     |SI #19#179 = "S"; |Y #19#188 > 0;
          FSalida = 1;
     |SINO;
          FSalida = 0;
     |FINSI;
|FPRC;

|PROCESO PintaMedidaV;
     |HAZ CompruParam;
     |SI eaSw2Stock = "N"; |ACABA; |FINSI;

     |SI #agifa142#117 = "N"; |ACABA; |FINSI;
     aRaya = "컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴";
     |SI aProg = "agifa503";
     |FINSI;
     |SI aProg = "agifa104";
          aArti = #15#2;
          |HAZ MiraMedida;
          |SI FSalida = 0;
               |C_V #15#50, 1, "N";
               |C_V #15#51, 1, "N";
               |C_V #15#52, 1, "N";
               |PINTA 2303, aRaya;
          |SINO;
               |SI #19#188 = 1; #0#0 = #15#50; |FINSI;
               |SI #19#188 = 2; #0#0 = #15#50 * #15#51; |FINSI;
               |SI #19#188 = 3; #0#0 = #15#50 * #15#51 * #15#52; |FINSI;
               |ATRI I;
               |PINTA 2307, "Md:       x       x       =          ";
               |PINTA 2334, #0#0;
               |ATRI 0;
               |C_V #15#50, 1, "S"; |PINTA #15#50;
               |C_V #15#51, 1, "S"; |PINTA #15#51;
               |C_V #15#52, 1, "S"; |PINTA #15#52;
               #0#0 = 0;
          |FINSI;
     |FINSI;
     |SI aProg = "agifa036";
          aArti = #71#2;
          |HAZ MiraMedida;
          |SI FSalida = 0;
               |C_V #71#33, 1, "N";
               |C_V #71#34, 1, "N";
               |C_V #71#35, 1, "N";
               |PINTA 2303, aRaya;
          |SINO;
               |SI #19#188 = 1; #0#0 = #71#33; |FINSI;
               |SI #19#188 = 2; #0#0 = #71#33 * #71#34; |FINSI;
               |SI #19#188 = 3; #0#0 = #71#33 * #71#34 * #71#35; |FINSI;
               |ATRI I;
               |PINTA 2307, "Md:       x       x       =          ";
               |PINTA 2334, #0#0;
               |ATRI 0;
               |C_V #71#33, 1, "S"; |PINTA #71#33;
               |C_V #71#34, 1, "S"; |PINTA #71#34;
               |C_V #71#35, 1, "S"; |PINTA #71#35;
          |FINSI;
     |FINSI;
     |SI aProg = "agifa010"; |O aProg = "agifa210";
      |O aProg = "agifa033"; |O aProg = "dsm01000";
          aArti = #73#2;
          |HAZ MiraMedida;
          |SI FSalida = 0;
               |C_V #73#51, 1, "N";
               |C_V #73#52, 1, "N";
               |C_V #73#53, 1, "N";
               |PINTA 2303, aRaya;
          |SINO;
               |SI #19#188 = 1; #0#0 = #73#51; |FINSI;
               |SI #19#188 = 2; #0#0 = #73#51 * #73#52; |FINSI;
               |SI #19#188 = 3; #0#0 = #73#51 * #73#52 * #73#53; |FINSI;
               |ATRI I;
               |PINTA 2307, "Md:       x       x       =          ";
               |PINTA 2334, #0#0;
               |ATRI 0;
               |C_V #73#51, 1, "S"; |PINTA #73#51;
               |C_V #73#52, 1, "S"; |PINTA #73#52;
               |C_V #73#53, 1, "S"; |PINTA #73#53;
          |FINSI;
     |FINSI;
     |SI aProg = "agifa084";
          aArti = #75#2;
          |HAZ MiraMedida;
          |SI FSalida = 0;
               |C_V #75#33, 1, "N";
               |C_V #75#34, 1, "N";
               |C_V #75#35, 1, "N";
               |PINTA 2303, aRaya;
          |SINO;
               |SI #19#188 = 1; #0#0 = #75#33; |FINSI;
               |SI #19#188 = 2; #0#0 = #75#33 * #75#34; |FINSI;
               |SI #19#188 = 3; #0#0 = #75#33 * #75#34 * #75#35; |FINSI;
               |ATRI I;
               |PINTA 2307, "Md:       x       x       =          ";
               |PINTA 2334, #0#0;
               |ATRI 0;
               |C_V #75#33, 1, "S"; |PINTA #75#33;
               |C_V #75#34, 1, "S"; |PINTA #75#34;
               |C_V #75#35, 1, "S"; |PINTA #75#35;
          |FINSI;
     |FINSI;
     |SI aProg = "agifa146";
          aArti = #77#2;
          |HAZ MiraMedida;
          |SI FSalida = 0;
               |C_V #77#31, 1, "N";
               |C_V #77#32, 1, "N";
               |C_V #77#33, 1, "N";
               |PINTA 2303, aRaya;
          |SINO;
               |SI #19#188 = 1; #0#0 = #77#31; |FINSI;
               |SI #19#188 = 2; #0#0 = #77#31 * #77#32; |FINSI;
               |SI #19#188 = 3; #0#0 = #77#31 * #77#32 * #77#33; |FINSI;
               |ATRI I;
               |PINTA 2307, "Md:       x       x       =          ";
               |PINTA 2334, #0#0;
               |ATRI 0;
               |C_V #77#31, 1, "S"; |PINTA #77#31;
               |C_V #77#32, 1, "S"; |PINTA #77#32;
               |C_V #77#33, 1, "S"; |PINTA #77#33;
          |FINSI;
     |FINSI;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO dsm00047B;
     |DDEFECTO #19;
     #19#0 = #47#3;
     |LEE 101#19=;
     |SI FSalida ! 0 ;|GRABA 020#19b; |FINSI;
     |SI enForma = 1;
          #19#24 = #72#1;
          #19#25 = #73#5 * #47#5;
     |FINSI;

     nImpo = enImpKit * (#47#5 * #47#8 / nTotaKit);
     nMargen = enMrgKit * (#47#5 * #47#8 / nTotaKit);

     aAlfa = #72#1 % A402;
     nNume = ((aAlfa - 1) * 5) + 35;
     #19nNume = #19nNume + (nImpo * enForma);
     nNume = nNume + 1;
     #19nNume = #19nNume + (nMargen * enForma);
     #19#95 = #19#95 + (nImpo * enForma);
     #19#96 = #19#96 + (nMargen * enForma);
     |GRABA 020#19a;
     |LIBERA #19;
|FPRC;

|PROCESO dsm00047A;
     nTotaKit = nTotaKit + (#47#5 * #47#8);
|FPRC;

|DEFBUCLE dsm00047B;
     #47#1;
     ;
     #73#29, #73#0, #73#1, 001;
     #73#29, #73#0, #73#1, 999;
     ;
     NULL, dsm00047B;
|FIN;

|DEFBUCLE dsm00047A;
     #47#1;
     ;
     #73#29, #73#0, #73#1, 001;
     #73#29, #73#0, #73#1, 999;
     ;
     NULL, dsm00047A;
|FIN;

|PROCESO ImpArtKit;
     nTotaKit = 0;
     |BUCLE dsm00047A;
     |BUCLE dsm00047B;
|FPRC;

|PROCESO MinParV;
     #24#0 = #0#9;
     #24#1 = #0#10;
     #24#2 = " " * 15;
|FPRC;

|PROCESO MaxParV;
     #24#0 = #0#9;
     #24#1 = #0#10;
     #24#2 = "z" * 15;
|FPRC;

|PROCESO MinParV1;
     #24#0 = #0#9;
     #24#1 = 1;
     #24#2 = " " * 15;
|FPRC;

|PROCESO MaxParV1;
     #24#0 = #0#9;
     #24#1 = 99999;
     #24#2 = "z" * 15;
|FPRC;

|PROCESO MinPar46;
     #46#0 = eaArticulo;
     #46#1 = enAlmacen;
|FPRC;

|PROCESO MaxPar46;
     #46#0 = eaArticulo;
     #46#1 = enAlmacen;
|FPRC;

|PROCESO Parti66; |TIPO 66;
     |SI enDepo = 0;
          |HAZ EsAlbero;
          |SI FSalida = 0; |Y aProg = "dsm01000";
               |ABRE #46;
               |CONSULTA_F_CLAVE #6#46, MinPar46, MaxPar46;
               |SI FSalida = 0;
                    #0#2 = #46#2;
                    |PINTA #0#2;
               |SINO;
                    |ERROR;
               |FINSI;
               |CIERRA #46;
          |SINO;
               |ABRE #24;
               #24#0 = #0#9;
               #24#1 = #0#10;
               #24#2 = #0#2;
               |LEE 000#24];
               |CONSULTA_F_CLAVE #1#24, MinParV, MaxParV;
               |SI FSalida = 0;
                    #0#2 = #24#2; |PINTA #0#2;
               |SINO;
                    |ERROR;
               |FINSI;
               |CIERRA #24;
          |FINSI;
     |SINO;
          |HAZ PartiDepo;
     |FINSI;
|FPRC;

|PROCESO PartCtrlC; |TIPO 11;
     |SI FSalida ! 7; |ACABA; |FINSI;   || Solo si pulsa Ctrl-C
     aAlfa = #0#2; |QBF aAlfa;
     |SI aAlfa = "";
          |SI #agifa142#242 = "N";
               |SI aProg = "agifa210";
                    |MENAV "0000Partida en Blanco no permitida";
                    |ERROR; |ACABA;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Parti06; |TIPO 6;
     ||ARA
     nModo = (FEntrada / 100) ! 0;
     |SI FSalida = 18; |O FSalida = 9;
          |SI enDepo ! 0; |ERROR; |ACABA; |FINSI;
     |FINSI;

     |SI FSalida = 18; ||F10
          |ABRE #24;
          #24#0 = #0#9;
          #24#1 = #0#10;
          #24#2 = #0#2;
          |LEE 000#24];
          |CONSULTA_F_CLAVE #1#24, MinParV1, MaxParV1;
          |SI FSalida = 0;
               #0#2 = #24#2; |PINTA #0#2;
          |SINO;
               |ERROR; |ACABA;
          |FINSI;
          |CIERRA #24;
     |FINSI;
     |SI FSalida = 9; ||F2;
          eaArticulo = #0#9;
          enAlmacen = #0#10;
          efFecha = #0#18;
          |HAZ ConsultaPartida;
          |SI eaPartida = "";
               |ERROR; |ACABA;
          |SINO;
               #0#2 = eaPartida;
               |PINTA #0#2;
          |FINSI;
     |FINSI;

     aAux = #0#2;
     |QBF aAux;
     |SI aAux ! "";
          |HAZ EsAlbero;
          |SI FSalida = 0;
               aArtiDoc = #0#9;
               |QBF aArtiDoc;
               eaAlbeArt = "";
               enAlbeAlm = #0#10;
               eaAlbePar = #0#2;
               |HAZ AlbeDimeArtAra;
               aAux = eaAlbeArt;
               |QBF aAux;
               |SI aAux ! "";
                    |SI aArtiDoc ! aAux;
                         aMensaje = "0000Esta partida es del Articulo " + aAux;
                         |QBF aMensaje;
                         |MENAV aMensaje;
                         |ERROR;
                         |ACABA;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;

     aAlfa = #0#2; |QBF aAlfa;
     |SI nModo ! 4; |Y aAlfa = "";
          |SI #agifa142#242 = "N";
               |SI aProg = "agifa010"; |O aProg = "agifa210";
                    |MENAV "0000Partida en Blanco no permitida";
                    |ERROR; |ACABA;
               |FINSI;
          |FINSI;
     |FINSI;

     |HAZ RellenaPartida;
|FPRC;

|PROCESO DefectoMediV;
     enMedida1 = 0;
     enMedida2 = 0;
     enMedida3 = 0;

     |ABRE #19;
     #19#0 = eaArticulo;
     |LEE 000#19=;
     |CIERRA #19;

     |SI #19#179 = "N"; |ACABA; |FINSI;

     |ABRE #238;
     #238#0 = #19#201;
     |LEE 000#238=;
     |CIERRA #238;

     enMedida1 = #238#9; ||Med1
     enMedida2 = #238#10;||Med2
     enMedida3 = #238#11;||Med3

     |HAZ EsTagloma;
     |SI FSalida = 0;
          nModo = (FEntrada / 100) ! 0;
          |SI nModo = 1;
               ||eaArticulo
               ||eaCliente
               |HAZ TagMedidaUni;
               |SI FSalida = 0;
                    enMedida1 = enMed1;
                    enMedida2 = enMed2;
                    enMedida3 = enMed3;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO TagloMerma;
/*
     |DDEF aAlfa;
     aAlfa = aAlfa + "tagm0078";
     |CARGA_DEF aAlfa, tagm0078@;
     |SI FSalida ! 0;
          |MENAV "0000Error al cargar 'tagm0078'";
     |SINO;
          |ABRE #tagm0078@;
          #tagm0078@#0 = aTipDoc;
          #tagm0078@#1 = aSerDoc;
          #tagm0078@#2 = nNumDoc;
          #tagm0078@#3 = nLinDoc;
          |SI aTipDoc ! "X"; |BORRA 000#tagm0078@.c; |FINSI;
          |ABRE #238;
          #238#0 = #19#201;
          |LEE 000#238=;
          |CIERRA #238;
          |SI #238#17 = "S";
               |SI nMed1 ! #238#9; |O nMed2 ! #238#10; |O nMed2 ! #238#11;
                    |SI nSumUni2 < 0;
                         nAbo = -1;
                    |SINO;
                         nAbo = 1;
                    |FINSI;
                    nSumUni2 = nSumUni2 * nAbo;
                    nSumUni2 = (nSumUni2 / #238#18) ! 0;
                    nSumUni2 = nSumUni2 * nAbo;
                    #tagm0078@#4 = nSumUni2;
                    |SI aTipDoc ! "X"; |GRABA 020#tagm0078@.n; |FINSI;
               |FINSI;
          |FINSI;
          |CIERRA #tagm0078@;
          |DESCARGA_DEF #tagm0078@;
     |FINSI;
*/
|FPRC;

|PROCESO Par7; |TIPO 7;
     |SI enDepo = 0;
          |MENSA "0000<F10> Part. articulo <F11> Part. art/almacen <F12> Part. Disponibles";
     |SINO;
          |MENSA "0000<F11> Partidas articulo deposito";
     |FINSI;
|FPRC;

|PROCESO Par0; |TIPO 0;
     |SI enDepo ! 0;
          |SI enModoVta = 1; |O eaArtiAnt ! eaArticulo; |O eaPartida ! #0#2;
               nLin = 0;
               |ABRE #71;
               #71#22 = eaSerie;
               #71#0 = enDepo;
               #71#1 = 1;
               |LEE 000#71];
               |PARA; |SI FSalida = 0; |Y #71#22 = eaSerie; |Y #71#0 = enDepo; |HACIENDO;
                    |SI #71#2 = eaArticulo; |Y #71#29 = #0#2;
                         #0#1 = #71#5;
                         nLin = #71#1;
                         |SAL;
                    |FINSI;
                    |LEE 000#71s;
               |SIGUE;
               |CIERRA #71;
               |SI nLin = 0;
                    |MENAV "0000No existe partida en el deposito...";
                    |ERROR;
               |SINO;
                    |SI #0#1 = 0;
                         |MENAV "0000Unidades partida a '0'";
                         |ERROR;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO PartiDepo;
     |DDEF aAlfa;
     aAlfa = aAlfa + "agifa070";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |HAZ CreaTempo; |NOME_DAT #referen@#Tempo#; |DELINDEX #referen@;
          |ABRE #referen@;
          |ABRE #71;
          #71#22 = eaSerie;
          #71#0 = enDepo;
          #71#1 = 1;
          |LEE 000#71];
          |PARA; |SI FSalida = 0; |Y #71#22 = eaSerie; |Y #71#0 = enDepo; |HACIENDO;
               |SI #71#2 = eaArticulo;
                    |SALVA_DATOS #71;
                    |REPON_DATOS #referen@;
                    |GRABA 020#referen@.n;
               |FINSI;
               |LEE 000#71s;
          |SIGUE;
          |CIERRA #71;
          |LEE 000#referen@.p;
          |SI FSalida = 0;
               |CONSULTA_CLAVE #1#referen@;
               |SI FSalida = 0;
                    #0#2 = #referen@#29; |PINTA #0#2;
               |SINO;
                    |ERROR;
               |FINSI;
          |SINO;
               |ERROR;
          |FINSI;
          |CIERRA #referen@;
          |HAZ BoraTempo; |DELINDEX #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|PROCESO CBVta;
     |ABRE #101;
     |SELECT #2#101;
     #101#3 = aAlfa;
     |LEE 000#101=;
     |SI FSalida = 0; |Y aAlfa ! #101#1;
          aAlfa = #101#1;
          |ABRE #19;
          #19#0 = aAlfa;
          |LEE 000#19=;
          |CIERRA #19;
     |FINSI;
     |CIERRA #101;
|FPRC;

|PROCESO TallerAuxHis;
     |DDEF aAlfa;
     aAlfa = aAlfa + "con00009";
     |CARGA_DEF aAlfa, con00009@;
     |SI FSalida = 0;
          |DDEFECTO  #con00009@;
          |ABRE #con00009@;
          #con00009@#0 = #65#0;
          #con00009@#1 = #65#1;
          #con00009@#2 = #65#2;
          #con00009@#3 = #65#3;
          #con00009@#4 = #65#4;
          #con00009@#5 = #65#11;
          |LEE 101#con00009@.=;
          |SI enForma = 1;
               |SI FSalida ! 0; |GRABA 020#con00009@.b; |FINSI;
               #con00009@#12 = "N";
               |GRABA 020#con00009@.a;
          |SINO;
               |SI FSalida = 0; |BORRA 020#con00009@.a; |FINSI;
          |FINSI;
          |CIERRA #con00009@;
          |DESCARGA_DEF #con00009@;
     |SINO;
          |MENAV "0000Error al cargar 'con00009'";
     |FINSI;
|FPRC;
