|FICHEROS;
     conz0004 #0;
     con00637 #637;
     con00642 #642;
     con00625 #625;
     con00626 #626;

     con00686 #2;  ||Temporal de aparcadas
     agifa019 #5;
     con00603 #8; ||Maestro M.Obra
     con00606 #9; ||Maestro Ser. Exteriores
     agifa024 #24;
|FIN;

|VARIABLES;
     &enTiva = 0;
     &efFiva = @;
     &eaDiva = "";
     &enIva = 0;
     &enRec = 0;
     tipo_iva =0;
     expor = "N";
|FIN;

|PROCESO con00626;       ||Linea Orden
     #625#0 = #626#0;
     #625#1 = #626#1;
     |LEE 000#625=;

     |SI #626#14 = "N";
          #2#5 = #2#5 + #626#8;      ||importe visual
          |SI #626#11]1;|Y #626#11[999; ||mano de obra
               #2#16 = #2#16 + #626#8;
               #8#0 = #626#2;
               |LEE 000#8=;
               |SI FSalida ! 0;|DDEFECTO #8;|FINSI;
               tipo_iva = #8#5;
          |FINSI;
          |SI #626#11]1000;|Y #626#11[1999; ||piezas
               #2#13 = #2#13 + #626#8;
               #5#0 = #626#2;
               |LEE 000#5=;
               |SI FSalida ! 0;|DDEFECTO #5;|FINSI;
               tipo_iva = #5#30;
          |FINSI;
          |SI #626#11]2000;|Y #626#11[2999; ||S.Exteriores
               #2#15 = #2#15 + #626#8;
               #9#0 = #626#2;
               |LEE 000#9=;
               |SI FSalida ! 0;|DDEFECTO #9;|FINSI;
               tipo_iva = #9#4;
          |FINSI;
          |SI #626#11]3000;|Y #626#11[3999; ||Lubricantes
               #2#14 = #2#14 + #626#8;
               #5#0 = #626#2;
               |LEE 000#5=;
               |SI FSalida ! 0;|DDEFECTO #5;|FINSI;
               tipo_iva = #5#30;
               |LIBERA #5;
          |FINSI;
          ||En funcion del tipo de iva acumular en base 1 o base 2
          enTiva = tipo_iva;
          efFiva = #626#22;
          |HAZ SacaIVA;
          |SI expor = "S";
               #2#7 = #2#7 + #626#8;
          |SINO;
               |SI tipo_iva = 1;
                    #2#8 = #2#8 + #626#8;
                    #2#9 = tipo_iva;
                    #2#10 = enIva;
               |FINSI;
               |SI tipo_iva = 2;
                    #2#17 = #2#17 + #626#8;
                    #2#18 = tipo_iva;
                    #2#19 = enIva;
               |FINSI;
               |SI tipo_iva = 0;
                    #2#7 = #2#7 + #626#8;
               |FINSI;
          |FINSI;
     |FINSI;
     |SI expor = "N";
          #2#11 = (#2#8 % #2#10);    ||Cuota IVA
          #2#20 = (#2#17 % #2#19);   ||Cuota IVA 2
     |FINSI;

     |SI #625#7 = "VN";|O #625#7 = "VO";
          #2#12 = #2#12 + #626#8;
     |SINO;
          #2#12 = #2#7 + #2#8 + #2#17 + #2#11 + #2#20;
     |FINSI;
|FPRC;

|DEFBUCLE con00626;
     #626#1;
     ;
     #642#3, #642#4, 0001;
     #642#3, #642#4, 9999;
     ;
     NULL, con00626;
|FIN;

|PROCESO con00642;
     |DDEFECTO #24;
     #24#0 = #637#3;
     |LEE 000#24=;
     |SI #24#28 = "S";
          expor = "S";
     |SINO;
          expor = "N";
     |FINSI;

     |DDEFECTO #2;
     |BUCLE con00626;

     #642#5 = #2#5;
     |SI expor = "N";
         #642#6 = #2#11 + #2#20;
     |FINSI;
     #642#7 = #642#5 + #642#6;
     |GRABA 020#642a;
     |LIBERA #642;
|FPRC;

|DEFBUCLE con00637;
     #637#1;
     2;
     #0#0, #0#2, #0#4;
     #0#1, #0#3, #0#5;
     be;
     NULL, NULL, con00642;
|FIN;

|PROCESO Tipo3; |TIPO 3;
     |ABRE #8;
     |ABRE #5;
     |ABRE #9;
     |ABRE #24;
     |ABRE #625;
     |BUCLE con00637;
     |CIERRA #625;
     |CIERRA #24;
     |CIERRA #8;
     |CIERRA #5;
     |CIERRA #9;
|FPRC;
