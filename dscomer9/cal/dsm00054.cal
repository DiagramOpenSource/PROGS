|FICHEROS;
     dsm00054 #0;
     dsm00055 #1;
     agifa142 #11;
     dsm00004 #904;
     dsm00005 #905;
     agifa007 #7;
     goalbpa4@;

     agifa722 #1000;
     agifa704 #1001;
     dsm00087@;
     caenlac@ #5000;
|FIN;

|VARIABLES;
     &enPrime = 0;
     &fich_alta = "";
     &PRMNT_enError = 0;
     &PRMNT_enVer   = 0;

     aUsu = "";
     nContaLog = 0;
     aSer = "";
     aNum = "";
     aTipo = "";
     nTipo = 0;
     nSal = 0;
     nModif = 0;
     nFlag  = 0;
     aDirConta = "";
     aAlfa  = "";
     aAlfa1 = "";
     aInforme  = "";
     nOrden    = 0;
     nConta    = 0;
     nModo     = 0;
     &enUniDes = 0;
     &enUniOrg = 0;
     &enSwEle  = 0;
 {-1}menu      = "";
     menu1     = "2400";
     menu2     = "1";
     menu3     = "Imprimir:  ";
     menu4     = "TU";
     menu5     = " Todo ";
     menu6     = " Unidades ";
 {-1}menur     = "";
     menur1    = "2400";
     menur2    = "1";
     menur3    = "Ordenado:  ";
     menur4    = "AE";
     menur5    = " Articulo ";
     menur6    = " Entrada ";
     aSerie    = "";

     aCmpClv1 = "";
     aCmpClv2 = "";
     aCmpClv3 = "";
|FIN;

|INCLUYE i_varart;

|PROCESO Conta54; |TIPO 7;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo ! 1; |ACABA; |FINSI;
     aSerie = #0#2
     #0#0 = 999999;
     |LEE 000#0];
     |SI FSalida = 0;
          |LEE 000#0a;
     |SINO;
          |LEE 000#0u;
     |FINSI;
     |SI FSalida = 0; |Y #0#2 = aSerie;
          nConta = #0#0 + 1;
     |SINO;
          nConta = 1;
     |FINSI;
     |DDEFECTO #0;
     #0#0 = nConta;
     #0#2 = aSerie;
|FPRC;

|PROCESO Tipo8; |TIPO 8;
     |ABRE #11; |LEE 000#11p; |CIERRA #11;

     |SI #11#99 = "S";
         |MENAV "     Solo tenemos activado un Almacen";
         |PTEC 807;
         |ACABA;
     |FINSI;
|FPRC;

|PROCESO Tipo30; |TIPO 30;
     |CONFI "2400NDesea Imprimir los movimientos Realizados : ";
     |SI FSalida = 0;
          |HAZ Tipo4;
     |FINSI;

|FPRC;

|PROCESO Elemento;
     |DDEFECTO #904;
     #904#0 = #1#0;
     #904#1 = #1#1;
     #904#2 = #905#4;
     |LEE 000#904=;
     enUniOrg = #904#12;

     |DDEFECTO #904;
     #904#0 = #1#0;
     #904#1 = #1#5;
     #904#2 = #905#4;
     |LEE 000#904=;
     enUniDes = #904#12;
     enSwEle = 1;
     |PRINT;
     enSwEle = 0;
|FPRC;

|DEFBUCLE Elemento;
     #905#1;
     ;
     "T4", #1#28, #1#27, #1#11, "      ";
     "T4", #1#28, #1#27, #1#11, "zzzzzz";
     be;
     NULL, Elemento;
|FIN;

|PROCESO dsm00054;
     |PRINT;
     |BUCLE Elemento;
|FPRC;

|DEFBUCLE dsm00054;
     #0#1;
     ;
     #0#2, #0#0;
     #0#2, #0#0;
     ;
     NULL , NULL, dsm00054;
|FIN;

|DEFBUCLE dsm00054Art;
     #1#1;
     ;
     #0#2, #0#0, 00001;
     #0#2, #0#0, 99999;
     ;
     NULL , NULL, NULL, NULL, NULL, dsm00054;
     #1#0;
|FIN;

|PROCESO Tipo4; |TIPO 4;
     eaSerLog = #0#2;
     eaNumLog = (A\("000000" + #0#0) % -106);
     eaTipLog = "MO";
     |HAZ ImprimeLog;

     |ABRE #7;
     #7#0 = #0#2;
     |LEE 020#7=;
     |CIERRA #7;

     |MENU menu;
     |SI FSalida [ 0; |ACABA; |FINSI;
     |SI FSalida = 1;
          aInforme = #7#41;
     |SINO;
          aInforme = #7#42;
     |FINSI;
     |QBF aInforme;
     |MENU menur;
     |SI FSalida [ 0; |ACABA; |FINSI;
     nOrden = FSalida;
     |IMPRE 0;
     |SI FSalida  = 0;
          |INFOR aInforme;
          |SI FSalida = 0;
               |ABRE #904;
               |SI nOrden = 1;
                    |BUCLE dsm00054Art;
               |SINO;
                    |BUCLE dsm00054;
               |FINSI;
               |CIERRA #904;
               |PIEINF;
               |FININF;
          |SINO;
               |MENAV "0000No existe informe...";
          |FINSI;
     |FINSI;
     |FINIMP;
|FPRC;

|PROCESO MiraCierre1;
     efFec = #1#8;
     enAlma = #1#1;
     |HAZ MiraHis0;
     |SI enErrHis ! 0; |ERROR10; |FINSI;
|FPRC;

|PROCESO MiraCierre2;
     efFec = #1#8;
     enAlma = #1#5;
     |HAZ MiraHis0;
     |SI enErrHis ! 0; |ERROR10; |FINSI;
|FPRC;

|PROCESO Tipo2_54; |TIPO 2;
     nModo = (FEntrada / 100) ! 0;
     nFlag = 0 +. 1;
     |HAZ EsTaller;
     |SI FSalida = 0; |HAZ Asientos; |FINSI;

     |HAZ EsConstru;
     |SI FSalida = 0;
          |HAZ EsAdjExp;
          |SI FSalida ! 0; |ERROR; |ACABA; |FINSI;
     |FINSI;
     |SI #0#3 = "S";
          |MENAV "0000Registro Exportado...";
          |ERROR; |ACABA;
     |FINSI;
     |SI nModo = 3;
          |BUCLELIN 2 MiraCierre1 #0;
          |SI enErrHis = 0;
               |BUCLELIN 2 MiraCierre2 #0;
          |FINSI;
          |SI enErrHis ! 0;
               |MENAV "0000Hay lineas con almacenes cerrados por inventario...";
               |ERROR; |ACABA;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Fec054; |TIPO 0;
     nModo = (FEntrada / 100) ! 0;
     enPrime = 0;
|FPRC;

|PROCESO Fecha54; |TIPO 7;
     nModo = (FEntrada / 100) ! 0;
     |C_M #0#1, 1, "S";
     |SI nModo = 2;
          |C_M #0#1, 1, "N";
     |FINSI;
|FPRC;

|PROCESO EsAdjExp;
     nSal = 0;
     |DDEF aAlfa;
     aAlfa = aAlfa + "goalbpa4";
     |CARGA_DEF aAlfa, goalbpa4@;
     |SI FSalida ! 0;
          |MENAV "0000Error al cargar 'goalbpa4'";
     |SINO;
          |ABRE #goalbpa4@;
          #goalbpa4@#0 = #0#2;
          #goalbpa4@#1 = #0#0;
          |LEE 000#goalbpa4@.=;
          |SI FSalida = 0;
               |MENAV "0000Movimiento de Adjudicacion Expediente...";
               nSal = 1;
          |FINSI;
          |CIERRA #goalbpa4@;
          |DESCARGA_DEF #goalbpa4@;
     |FINSI;
     FSalida = nSal;
|FPRC;

|PROCESO MiraCont; |TIPO 14;
     |HAZ EsTaller;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |ABRE #agifa722; |DDEFECTO #agifa722;
     #agifa722#0 = "MV";
     #agifa722#1 = #dsm00054#2; aCmpClv1 = #agifa722#1;
     #agifa722#2 = #dsm00054#0; aCmpClv2 = #agifa722#2;
     #agifa722#3 = "";          aCmpClv3 = #agifa722#3;
     |LEE 000#agifa722.];
     |SI FSalida = 0; |Y #agifa722#0 = "MV"; |Y #agifa722#1 = aCmpClv1;
      |Y #agifa722#2 = aCmpClv2; ||Y #agifa722#3 = aCmpClv3;
         |ATRI I; |PINTA 760, "Contabilizado"; |ATRI N;
     |SINO;
         |PINTA 760, "             ";
     |FINSI;
     |CIERRA #agifa722;
|FPRC;

|PROCESO T054_15; |TIPO 15;
     nTipo = 15; |HAZ Log054;
|FPRC;

|PROCESO T054_16; |TIPO 16;
     nTipo = 16; |HAZ Log054;
|FPRC;

|PROCESO T054_17; |TIPO 17;
     nTipo = 17; |HAZ Log054;
|FPRC;

|PROCESO Log054;
     |DDEF aAlfa;
     aAlfa = aAlfa + "dsm00087";
     |CARGA_DEF aAlfa, dsm00087@;
     |SI FSalida ! 0; |ACABA; |FINSI;

     aSer = #0#2;
     aNum = ("000000" + #0#0) % -106;
     aTipo = "MO";

     |ABRE #dsm00087@;
     |DDEFECTO #dsm00087@;
     |SELECT #2#dsm00087@;
     #dsm00087@#1 = aSer;
     #dsm00087@#2 = aNum;
     #dsm00087@#3 = aTipo;
     |LEE 101#dsm00087@.=;
     |SI FSalida ! 0;
          |SELECT #1#dsm00087@;
          |LEE 000#dsm00087@.u;
          |SI FSalida = 0;
               nContaLog = #dsm00087@#0 + 1;
          |SINO;
               nContaLog = 1;
          |FINSI;
          |DDEFECTO #dsm00087@;
          #dsm00087@#0 = nContaLog;
          #dsm00087@#1 = aSer;
          #dsm00087@#2 = aNum;
          #dsm00087@#3 = aTipo;
          |GRABA 020#dsm00087@.b;
     |FINSI;
     |SI FSalida = 0;
          |HORA aAlfa;
          aUsu = Usuario % 810;
          |SI nTipo = 15;
               #dsm00087@#4 = aUsu;
               #dsm00087@#5 = ~;
               #dsm00087@#6 = aAlfa;
               #dsm00087@#7 = "";
               #dsm00087@#8 = "01.01.0000";
               #dsm00087@#9 = ""
               #dsm00087@#10 = "";
               #dsm00087@#11 = "01.01.0000";
               #dsm00087@#12 = ""
          |FINSI;
          |SI nTipo = 16;
               #dsm00087@#7 = aUsu;
               #dsm00087@#8 = ~;
               #dsm00087@#9 = aAlfa;
          |FINSI;
          |SI nTipo = 17;
               #dsm00087@#10 = aUsu;
               #dsm00087@#11 = ~;
               #dsm00087@#12 = aAlfa;
          |FINSI;
          |GRABA 020#dsm00087@.a;
     |FINSI;
     |CIERRA #dsm00087@;
     |DESCARGA_DEF #dsm00087@;
|FPRC;

|PROCESO Asientos;
   nModif = 0;
   |ABRE #agifa722;
   |SI nModo = 3;
      #agifa722#0 = "MV";
      #agifa722#1 = #dsm00054#2; aCmpClv1 = #agifa722#1;
      #agifa722#2 = #dsm00054#0; aCmpClv2 = #agifa722#2;
      #agifa722#3 = "";          aCmpClv3 = #agifa722#3;
      |LEE 000#agifa722.];
      |SI FSalida = 0; |Y #agifa722#0 = "MV"; |Y #agifa722#1 = aCmpClv1;
       |Y #agifa722#2 = aCmpClv2;
         aAlfa = "    NEste documento esta contabilizado. " + &191 + " continuar eliminando el asiento contable ?";
         |CONFI aAlfa;
         |SI FSalida ! 0; |ERROR; |ACABA; |FINSI;
         nModif = 1;
      |SINO;
         |ACABA;
      |FINSI;
   |FINSI;

   |SI nModo = 2;
      |SI nFlag < 0;
         #agifa722#0 = "MV";
         #agifa722#1 = #dsm00054#2; aCmpClv1 = #agifa722#1;
         #agifa722#2 = #dsm00054#0; aCmpClv2 = #agifa722#2;
         #agifa722#3 = "";          aCmpClv3 = #agifa722#3;
         |LEE 000#agifa722.];
         |SI FSalida = 0; |Y #agifa722#0 = "MV"; |Y #agifa722#1 = aCmpClv1;
          |Y #agifa722#2 = aCmpClv2;
            aAlfa = "    NEste documento esta contabilizado. " + &191 + " continuar eliminando el asiento contable ?";
            |CONFI aAlfa;
            |SI FSalida ! 0; |ERROR; |ACABA; |FINSI;
            nModif = 1;
         |FINSI;
      |SINO;
         #agifa722#0 = "MV";
         #agifa722#1 = #dsm00054#2; aCmpClv1 = #agifa722#1;
         #agifa722#2 = #dsm00054#0; aCmpClv2 = #agifa722#2;
         #agifa722#3 = "";          aCmpClv3 = #agifa722#3;
         |LEE 000#agifa722.];
         |SI FSalida = 0; |Y #agifa722#0 = "MV"; |Y #agifa722#1 = aCmpClv1;
          |Y #agifa722#2 = aCmpClv2;
            |BORRA 020#agifa722.a;
            aAlfa = "    NEste documento estaba contabilizado. " + &191 + " Volver a contabilizar ?";
            |CONFI aAlfa;
            |SI FSalida ! 0; |ERROR; |ACABA; |FINSI;
            nModif = 2;
         |FINSI;
      |FINSI;
   |FINSI;

   |SI nModif = 1;
      |DDEFECTO #agifa722;
      #agifa722#0 = "MV";
      #agifa722#1 = #dsm00054#2; aCmpClv1 = #agifa722#1;
      #agifa722#2 = #dsm00054#0; aCmpClv2 = #agifa722#2;
      #agifa722#3 = "";          aCmpClv3 = #agifa722#3;
      |LEE 000#agifa722.];
      |SI FSalida = 0; |Y #agifa722#0 = "MV"; |Y #agifa722#1 = aCmpClv1;
       |Y #agifa722#2 = aCmpClv2;
          |HAZ CogeVersion;
          |ABRE #agifa142;
          |LEE 000#agifa142.p;
          |SI FSalida ! 0;
             |MENAV "    No existe el control de parametros";
             |DDEFECTO #agifa142;
          |FINSI;
          |CIERRA #agifa142;
          aDirConta = #agifa142#151; |QBF aDirConta;
          aAlfa = aDirConta + "def/caenlace.mas";
          |CARGA_DEF aAlfa, caenlac@;
          |SI FSalida = 0;
             aAlfa = "pu" + Usuario; |NOME_DAT #caenlac@#aAlfa#;
             aAlfa = aDirConta + "fich/" + (("00000" + #agifa722#8) % -105) + #agifa722#9 + "/";
             |PATH_DAT #caenlac@#aAlfa#;
             |ABRE #caenlac@;
             |DDEFECTO #caenlac@;
             #caenlac@#0  = #agifa722#4;
             #caenlac@#1  = #agifa722#5;
             #caenlac@#2  = #agifa722#6;
             #caenlac@#3  = 0;
             #caenlac@#37 = #agifa722#8;
             #caenlac@#38 = #agifa722#9;
             #caenlac@#25 = "S";
             |GRABA 020#caenlac@.n;

             fich_alta = aAlfa; PRMNT_enError = 0;
             aAlfa1 = aAlfa - "agicont";
             |SI FSalida = 0;
                aAlfa = ":contagen/dsapunte.tab;" + aAlfa + ",pu" + Usuario;
             |SINO;
                aAlfa = ":agicont/dsapunte.tab;" + aAlfa + ",pu" + Usuario;
             |FINSI;
             |CIERRA #caenlac@; |DESCARGA_DEF #caenlac@;
             |SUB_EJECUTA aAlfa;
          |FINSI;
          |CIERRA #agifa704;
      |FINSI;
   |FINSI;

   |SI nModif = 2;
      |GRABA 020#dsm00054.a;
      aAlfa = #dsm00054#2 + "," + #dsm00054#0; |QBF aAlfa;
      aAlfa = "con00692.tab;" + aAlfa;
      |SUB_EJECUTA aAlfa;
   |FINSI;
   |CIERRA #agifa722;
|FPRC;

|PROCESO Tipo54_13; |TIPO 13;
|FPRC;
