|FICHEROS;
     psioa015 #15;
     dsm00043 #43; ||Regularizacion
     dsm00044 #44;
     dsm00054 #54; ||Movimientos
     dsm00055 #55;
     dsm00056 #56; ||Valorada
     dsm00057 #57;
     agifa017 #17;
     agifa019 #19;
     dsm00024 #24;
     agifa029 #29;
|FIN;

|VARIABLES;
     &enForma = 0;
     &enCodigo = 0;
     &eaProve = "";
     nConta = 0;
     nPrime = 0;
     nLinea = 0;
     aSerie = "     ";
     fFecha = @;
     aOpe = "";
     nUni = 0;
     nUni2 = 0;
|FIN;

|PROCESO Recuento;
     |DDEFECTO #19;
     |ABRE #19;
     #19#0 = #15#0;
     |LEE 000#19=;
     |CIERRA #19;

     |DDEFECTO #17;
     |ABRE #17;
     #17#0 = #15#0;
     #17#1 = #15#2;
     |LEE 000#17=;
     |CIERRA #17;

     |SI nPrime = 0; |O nLinea > 99999; |O fFecha ! #15#5;
          nPrime = 1;
          nLinea = 0;
          fFecha = #15#5;

          #43#4 = aSerie;
          #43#0 = 999999;
          |LEE 000#43];
          |SI FSalida = 0;
               |LEE 000#43a;
          |SINO;
               |LEE 000#43u;
          |FINSI;
          |SI FSalida = 0; |Y #43#4 = aSerie;
               nConta = #43#0 + 1;
          |SINO;
               nConta = 1;
          |FINSI;
          |DDEFECTO #43;
          #43#4 = aSerie;
          #43#0 = nConta;
          #43#1 = #15#5;
          |GRABA 020#43n;
     |FINSI;
     |SI #15#3 ] #17#5;
          aOpe = "E";
          nUni = #15#3 - #17#5;
          nUni2 = #15#10 - #17#47;
     |SINO;
          aOpe = "S";
          nUni = #17#5 - #15#3;
          nUni2 = #17#47 - #15#10;
     |FINSI;

     nLinea = nLinea + 1;
     |DDEFECTO #44;
     #44#21 = #43#4;
     #44#18 = #43#0;
     #44#8 = nLinea;

     #44#0 = #15#0;
     #44#1 = #15#2;
     #44#2 = #19#1;
     #44#3 = #17#39;
     #44#4 = nUni;
     #44#5 = #43#1;
     #44#6 = #19#6;
     #44#7 = aOpe;
     #44#12 = nUni2;
     #44#13 = #15#9;
     #44#19 = #17#5;
     #44#20 = #19#104;
     enForma = 1;
     enCodigo = #44#18;
     |HAZ AcumulaES_SS;
     |GRABA 020#44n;
|FPRC;

|PROCESO Valorada;
     |DDEFECTO #19;
     |ABRE #19;
     #19#0 = #15#0;
     |LEE 000#19=;
     |CIERRA #19;

     |SI nPrime = 0; |O nLinea > 99999; |O fFecha ! #15#5;
          nPrime = 1;
          nLinea = 0;
          fFecha = #15#5;

          #56#2 = aSerie;
          #56#0 = 999999;
          |LEE 000#56];
          |SI FSalida = 0;
               |LEE 000#56a;
          |SINO;
               |LEE 000#56u;
          |FINSI;
          |SI FSalida = 0; |Y #56#2 = aSerie;
               nConta = #56#0 + 1;
          |SINO;
               nConta = 1;
          |FINSI;
          |DDEFECTO #56;
          #56#2 = aSerie;
          #56#0 = nConta;
          #56#1 = #15#5;
          |GRABA 020#56n;
     |FINSI;
     nLinea = nLinea + 1;
     |DDEFECTO #57;
     #57#28 = #56#2;
     #57#27 = #56#0;
     #57#14 = nLinea;

     #57#0 = #15#0;
     #57#1 = #15#2;
     #57#2 = #19#1;
     |DDEFECTO #17;
     |ABRE #17;
     #17#0 = #15#0;
     #17#1 = #15#7;
     |LEE 000#17=;
     |CIERRA #17;
     |DDEFECTO #24;
     |ABRE #24;
     #24#0 = #15#0;
     #24#1 = #15#7;
     #24#2 = #15#9;
     |LEE 000#24=;
     |CIERRA #24;
     #57#3 = #17#5;
     #57#4 = #15#3;  ||uni1
     #57#5 = #19#27; ||Prv
     #57#6 = #19#9;  ||Precio

     #57#11 = #57#6; ||Neto
     #57#12 = #56#1;
     #57#13 = #19#6;
     #57#18 = #19#165;
     #57#19 = #19#163;
     #57#21 = #15#10; ||uni2
     #57#22 = #15#9;
     #57#23 = #19#205;

     |GRABA 020#57n;
     enForma = 1;
     eaProve = #57#5;
     enCodigo = #57#27;
     |HAZ AcumulaEV;
|FPRC;

|PROCESO Traspaso;
     |DDEFECTO #19;
     |ABRE #19;
     #19#0 = #15#0;
     |LEE 000#19=;
     |CIERRA #19;

     |SI nPrime = 0; |O nLinea > 99999; |O fFecha ! #15#5;
          nPrime = 1;
          nLinea = 0;
          fFecha = #15#5;

          #54#2 = aSerie;
          #54#0 = 999999;
          |LEE 000#54];
          |SI FSalida = 0;
               |LEE 000#54a;
          |SINO;
               |LEE 000#54u;
          |FINSI;
          |SI FSalida = 0; |Y #54#2 = aSerie;
               nConta = #54#0 + 1;
          |SINO;
               nConta = 1;
          |FINSI;
          |DDEFECTO #54;
          #54#2 = aSerie;
          #54#0 = nConta;
          #54#1 = #15#5;
          |GRABA 020#54n;
     |FINSI;
     nLinea = nLinea + 1;
     |DDEFECTO #55;
     #55#28 = #54#2;
     #55#27 = #54#0;
     #55#11 = nLinea;
     #55#0 = #15#0;
     #55#1 = #15#7;
     #55#2 = #19#1;
     |DDEFECTO #17;
     |ABRE #17;
     #17#0 = #15#0;
     #17#1 = #15#7;
     |LEE 000#17=;
     |CIERRA #17;
     |DDEFECTO #24;
     |ABRE #24;
     #24#0 = #15#0;
     #24#1 = #15#7;
     #24#2 = #15#9;
     |LEE 000#24=;
     |CIERRA #24;
     |DDEFECTO #29;
     |ABRE #29;
     #29#0 = #15#7;
     |LEE 000#29=;
     |CIERRA #29;
     #55#3 = #17#5;
     #55#4 = #15#3; ||uni1
     #55#5 = #15#8;
     #55#9 = #29#1;
     #55#19 = #24#22;

     |DDEFECTO #17;
     |ABRE #17;
     #17#0 = #15#0;
     #17#1 = #15#8;
     |LEE 000#17=;
     |CIERRA #17;
     |DDEFECTO #24;
     |ABRE #24;
     #24#0 = #15#0;
     #24#1 = #15#8;
     #24#2 = #15#9;
     |LEE 000#24=;
     |CIERRA #24;
     |DDEFECTO #29;
     |ABRE #29;
     #29#0 = #15#8;
     |LEE 000#29=;
     |CIERRA #29;
     #55#6 = #17#5;
     #55#7 = #19#6;
     #55#8 = #54#1;
     #55#10 = #29#1;
     #55#15 = #15#10; ||uni2
     #55#16 = #15#9;
     #55#17 = #15#9;
     #55#21 = #24#22;
     |GRABA 020#55n;
     enForma = 1;
     |HAZ AcumulaME_MS;
|FPRC;

|PROCESO EntSal;
     |SI #15#4 ! "E"; |Y #15#4 ! "S";
          |ACABA;
     |FINSI;
     |DDEFECTO #19;
     |ABRE #19;
     #19#0 = #15#0;
     |LEE 000#19=;
     |CIERRA #19;

     |DDEFECTO #17;
     |ABRE #17;
     #17#0 = #15#0;
     #17#1 = #15#2;
     |LEE 000#17=;
     |CIERRA #17;

     |SI nPrime = 0; |O nLinea > 99999; |O fFecha ! #15#5;
          nPrime = 1;
          nLinea = 0;
          fFecha = #15#5;

          #43#4 = aSerie;
          #43#0 = 999999;
          |LEE 000#43];
          |SI FSalida = 0;
               |LEE 000#43a;
          |SINO;
               |LEE 000#43u;
          |FINSI;
          |SI FSalida = 0; |Y #43#4 = aSerie;
               nConta = #43#0 + 1;
          |SINO;
               nConta = 1;
          |FINSI;
          |DDEFECTO #43;
          #43#4 = aSerie;
          #43#0 = nConta;
          #43#1 = #15#5;
          |GRABA 020#43n;
     |FINSI;
     nLinea = nLinea + 1;
     |DDEFECTO #44;
     #44#21 = #43#4;
     #44#18 = #43#0;
     #44#8 = nLinea;

     #44#0 = #15#0;
     #44#1 = #15#2;
     #44#2 = #19#1;
     #44#3 = #17#39;
     #44#4 = #15#3; ||uni1
     #44#5 = #43#1;
     #44#6 = #19#6;
     #44#7 = #15#4;
     #44#12 = #15#10;||uni2
     #44#13 = #15#9;
     #44#19 = #17#5;
     #44#20 = #19#104;
     enForma = 1;
     enCodigo = #44#18;
     |HAZ AcumulaES_SS;
     |GRABA 020#44n;
|FPRC;

|DEFBUCLE EntSal;
     #15#1;
     ;
     0;
     99999;
     ;
     NULL, NULL, NULL, NULL, NULL, EntSal;
     #15#5;
|FIN;

|DEFBUCLE Traspaso;
     #15#1;
     4;
     0,     "T";
     99999, "T";
     ;
     NULL, NULL, NULL, NULL, NULL, Traspaso;
     #15#5;
|FIN;

|DEFBUCLE Valorada;
     #15#1;
     4;
     0,     "R";
     99999, "R";
     ;
     NULL, NULL, NULL, NULL, NULL, Valorada;
     #15#5;
|FIN;

|DEFBUCLE Recuento;
     #15#1;
     4;
     0,     "F";
     99999, "F";
     ;
     NULL, NULL, NULL, NULL, NULL, Recuento;
     #15#5;
|FIN;

|PROGRAMA;
     nPrime = 0;
     nLinea = 0;
     |ABRE #43;
     |ABRE #44;
     |BUCLE EntSal;
     |CIERRA #43;
     |CIERRA #44;

     nPrime = 0;
     nLinea = 0;
     |ABRE #54;
     |ABRE #55;
     |BUCLE Traspaso;
     |CIERRA #54;
     |CIERRA #55;

     nPrime = 0;
     nLinea = 0;
     |ABRE #56;
     |ABRE #57;
     |BUCLE Valorada;
     |CIERRA #56;
     |CIERRA #57;

     nPrime = 0;
     nLinea = 0;
     |ABRE #43;
     |ABRE #44;
     |BUCLE Recuento;
     |CIERRA #43;
     |CIERRA #44;
|FPRO;
