|FICHEROS;
   guerz206 #0;

   guerw051 #10,MANTE;
   gopartia #11;
   agifa065 #12;
   guerw052 #13;
   guerw053 #14;

   agifa029 #100;
|FIN;

|VARIABLES;
   nSwHay = 0;
   nSwErr = 0;
   nLinea = 0;
   nDocum = 0;
   nNumLins = 0;
   nCanti   = 0;

   nCalc  = 0;
   aAlfa  = "";
   aSerie = "";
   aArti  = "";

   nPre1 = 0; nDto11 = 0; nDto21 = 0; nDtoC1 = 0;
   nPre2 = 0; nDto12 = 0; nDto22 = 0; nDtoC2 = 0;
   nPre3 = 0; nDto13 = 0; nDto23 = 0; nDtoC3 = 0;
   nPre4 = 0; nDto14 = 0; nDto24 = 0; nDtoC4 = 0;
|FIN;

|PROCESO Gopartia;
   |MENSA "    Rellenando temporal ..... ";

   #guerw052#0 = #gopartia#4;
   #guerw052#1 = #gopartia#5;
   |LEE 101#guerw052.=;
   |SI FSalida ! 0;
      |DDEFECTO #guerw052;
      #guerw052#0 = #gopartia#4;
      #guerw052#1 = #gopartia#5;
      |GRABA 020#guerw052.b;
   |FINSI;
   #guerw052#2 = #guerw052#2 + #gopartia#10;
   #guerw052#3 = #guerw052#3 + #gopartia#14;
   |GRABA 020#guerw052.a; |LIBERA #guerw052;

   |DDEFECTO #guerw053;
   #guerw053#0 = #gopartia#4;
   #guerw053#1 = #gopartia#5;
   #guerw053#2 = #gopartia#6;
   #guerw053#3 = #gopartia#20;
   #guerw053#4 = #gopartia#10;
   #guerw053#5 = #gopartia#41;
   #guerw053#6 = #gopartia#14;
   |GRABA 020#guerw053.n;
|FPRC;

|DEFBUCLE Gopartia;
#gopartia#1;
;
"A", "     ", 000001, 001, 001;
"A", "zzzzz", 999999, 999, 999;
;
NULL, Gopartia;
|FIN;

|PROCESO Interpreta;
   |SI #guerw052#3 ! 0;
      #gopartia#34 = "A";
      #gopartia#4  = #guerw052#0;
      #gopartia#5  = #guerw052#1;
      #gopartia#6 = 1;
      #gopartia#7 = 1;
      |LEE 000#gopartia.];
      |SI FSalida = 0; |Y #gopartia#4  = #guerw052#0; |Y #gopartia#5  = #guerw052#1;
         |LEE 101#gopartia.=;
      |FINSI;
      |PARA; |SI FSalida = 0; |Y #gopartia#4  = #guerw052#0; |Y #gopartia#5  = #guerw052#1; |HACIENDO;
         aArti = #gopartia#20; nCanti = 0 - #gopartia#10;
         nPre1 = #gopartia#37; nDto11 = #gopartia#38; nDto21 = #gopartia#39; nDtoC1 = #gopartia#40;
         nPre2 = #gopartia#41; nDto12 = #gopartia#42; nDto22 = #gopartia#43; nDtoC2 = #gopartia#44;
         nPre3 = #gopartia#45; nDto13 = #gopartia#46; nDto23 = #gopartia#47; nDtoC3 = #gopartia#48;
         nPre4 = #gopartia#49; nDto14 = #gopartia#50; nDto24 = #gopartia#51; nDtoC4 = #gopartia#52;
         |SALVA_FICHA #gopartia;
         #gopartia#34 = "A";
         #gopartia#4  = #guerw052#0;
         #gopartia#5  = #guerw052#1;
         #gopartia#6 = 1;
         #gopartia#7 = 1;
         |LEE 000#gopartia.];
         |SI FSalida = 0; |Y #gopartia#4  = #guerw052#0; |Y #gopartia#5  = #guerw052#1;
            |LEE 101#gopartia.=;
         |FINSI;
         |PARA; |SI FSalida = 0; |Y #gopartia#4  = #guerw052#0; |Y #gopartia#5  = #guerw052#1; |HACIENDO;
            |SI #gopartia#20 = aArti; |Y #gopartia#10 = nCanti;
               #gopartia#37 = nPre1; #gopartia#38 = nDto11; #gopartia#39 = nDto21; #gopartia#40 = nDtoC1;
               #gopartia#41 = nPre2; #gopartia#42 = nDto12; #gopartia#43 = nDto22; #gopartia#44 = nDtoC2;
               #gopartia#45 = nPre3; #gopartia#46 = nDto13; #gopartia#47 = nDto23; #gopartia#48 = nDtoC3;
               #gopartia#49 = nPre4; #gopartia#50 = nDto14; #gopartia#51 = nDto24; #gopartia#52 = nDtoC4;

               #gopartia#13 = #gopartia#10 * #gopartia#37;
               #gopartia#13 = #gopartia#13 < #gopartia#38;
               #gopartia#13 = #gopartia#13 < #gopartia#39;
               #gopartia#13 = #gopartia#13 < #gopartia#40;
               #gopartia#11 = #gopartia#13 / #gopartia#10;

               #gopartia#14 = #gopartia#10 * #gopartia#41;
               #gopartia#14 = #gopartia#14 < #gopartia#42;
               #gopartia#14 = #gopartia#14 < #gopartia#43;
               #gopartia#14 = #gopartia#14 < #gopartia#44;
               #gopartia#12 = #gopartia#14 / #gopartia#10;

               #gopartia#24 = #gopartia#10 * #gopartia#45;
               #gopartia#24 = #gopartia#24 < #gopartia#46;
               #gopartia#24 = #gopartia#24 < #gopartia#47;
               #gopartia#24 = #gopartia#24 < #gopartia#48;
               #gopartia#22 = #gopartia#24 / #gopartia#10;

               #gopartia#25 = #gopartia#10 * #gopartia#49;
               #gopartia#25 = #gopartia#25 < #gopartia#50;
               #gopartia#25 = #gopartia#25 < #gopartia#51;
               #gopartia#25 = #gopartia#25 < #gopartia#52;
               #gopartia#23 = #gopartia#25 / #gopartia#10;
               |GRABA 020#gopartia.a; |SAL;
            |FINSI;
            |LEE 000#gopartia.s;
         |SIGUE;
         |REPON_FICHA #gopartia;
         |LEE 000#gopartia.s;
      |SIGUE;
   |FINSI;

   |SI #guerw052#2 ! 0;
      nNumLins = 0;
      #gopartia#34 = "A";
      #gopartia#4  = #guerw052#0;
      #gopartia#5  = #guerw052#1;
      #gopartia#6 = 1;
      #gopartia#7 = 1;
      |LEE 000#gopartia.];
      |SI FSalida = 0; |Y #gopartia#4  = #guerw052#0; |Y #gopartia#5  = #guerw052#1;
         |LEE 101#gopartia.=;
      |FINSI;
      |PARA; |SI FSalida = 0; |Y #gopartia#4  = #guerw052#0; |Y #gopartia#5  = #guerw052#1; |HACIENDO;
         nLinea = 0; nSwHay = 0;
         #guerw053#0 = #gopartia#4;
         #guerw053#1 = #gopartia#5;
         #guerw053#2 = #gopartia#6;
         |LEE 000#guerw053.];
         |PARA; |SI FSalida = 0; |Y #guerw053#0 = #gopartia#4; |Y #guerw053#1 = #gopartia#5; |Y #guerw053#2 = #gopartia#6; |HACIENDO;
            nCalc = #gopartia#10 * -1;
            |SI #guerw053#5 = #gopartia#41; |Y #guerw053#4 = nCalc; |Y #guerw053#3 = #gopartia#20;
               nSwHay = 1; |SAL;
            |FINSI;
            |LEE 000#guerw053.s;
         |SIGUE;
         |SI nSwHay = 0;
            nSwErr = 0;
            #agifa065#0  = #gopartia#20;
            #agifa065#1  = #gopartia#28;
            #agifa065#2  = "MS";
            #agifa065#3  = #gopartia#5;
            #agifa065#4  = 1;
            #agifa065#11 = #gopartia#4;
            |LEE 000#agifa065.];
            |SI FSalida = 0; |Y #agifa065#0  = #gopartia#20; |Y #agifa065#1  = #gopartia#28;
                             |Y #agifa065#2  = "MS";         |Y #agifa065#3  = #gopartia#5;
                             |Y #agifa065#11 = #gopartia#4;
               #guerw051#0 = #agifa065#5;
               |LEE 000#guerw051.=;
               |SI FSalida ! 0;
                  aAlfa = "    Problemas. No encuentro el expediente del almacen " + #agifa065#5; |MENAV aAlfa;
                  |DDEFECTO #guerw051;
                  nSwErr = 1;
               |FINSI;
            |SINO;
               aAlfa = "    Problemas. No encuentro el movimiento del registro " + #gopartia#34 + "." + #gopartia#4 + "." + #gopartia#5 + "." + #gopartia#6 + "." + #gopartia#7; |MENAV aAlfa;
               nSwErr = 1;
            |FINSI;

            |SI nSwErr = 0;
               |SALVA_FICHA #gopartia;
               nLinea = 1;
               aSerie = #gopartia#4;
               nDocum = #gopartia#5;
               |LEE 000#gopartia.];
               |PARA; |SI FSalida = 0; |Y aSerie = #gopartia#4; |Y nDocum = #gopartia#5; |HACIENDO;
                  nLinea = #gopartia#6 + 1;
                  |LEE 000#gopartia.s;
               |SIGUE;
               |SI nNumLins = 0; nNumLins = nLinea - 1; |FINSI;
               |REPON_FICHA #gopartia;

               |SALVA_FICHA #gopartia;
               #gopartia#6 = nLinea;
               #gopartia#10 = #gopartia#10 * -1;
               #gopartia#17 = #guerw051#0;
               #gopartia#18 = #guerw051#3;
               #gopartia#2 = #guerw051#1;
               #gopartia#3 = #guerw051#2;
               #gopartia#19 = 0;
               #gopartia#35 = 0;

               #gopartia#13 = #gopartia#10 * #gopartia#37;
               #gopartia#13 = #gopartia#13 < #gopartia#38;
               #gopartia#13 = #gopartia#13 < #gopartia#39;
               #gopartia#13 = #gopartia#13 < #gopartia#40;
               #gopartia#11 = #gopartia#13 / #gopartia#10;

               #gopartia#14 = #gopartia#10 * #gopartia#41;
               #gopartia#14 = #gopartia#14 < #gopartia#42;
               #gopartia#14 = #gopartia#14 < #gopartia#43;
               #gopartia#14 = #gopartia#14 < #gopartia#44;
               #gopartia#12 = #gopartia#14 / #gopartia#10;

               #gopartia#24 = #gopartia#10 * #gopartia#45;
               #gopartia#24 = #gopartia#24 < #gopartia#46;
               #gopartia#24 = #gopartia#24 < #gopartia#47;
               #gopartia#24 = #gopartia#24 < #gopartia#48;
               #gopartia#22 = #gopartia#24 / #gopartia#10;

               #gopartia#25 = #gopartia#10 * #gopartia#49;
               #gopartia#25 = #gopartia#25 < #gopartia#50;
               #gopartia#25 = #gopartia#25 < #gopartia#51;
               #gopartia#25 = #gopartia#25 < #gopartia#52;
               #gopartia#23 = #gopartia#25 / #gopartia#10;
               |GRABA 020#gopartia.n;
               |REPON_FICHA #gopartia;
            |FINSI;
         |FINSI;
         |LIBERA #gopartia; |LEE 101#gopartia.s;
         |SI #gopartia#6 > nNumLins; |SAL; |FINSI;
      |SIGUE;
   |FINSI;
|FPRC;

|DEFBUCLE Interpreta;
#guerw052#1;
;
INICIO;
FINAL;
;
NULL,Interpreta;
|FIN;

|RUTINA inf;
   #guerw051#0 = 1;
|FRUT;

|RUTINA sup;
   #guerw051#0 = 999999
|FRUT;

|PROCESO VuelcaAlm;
   |DDEFECTO #guerw051;
   #guerw051#0 = #agifa029#0;
   #guerw051#3 = #agifa029#1;
   |GRABA 020#guerw051.n;
|FPRC;

|DEFBUCLE VuelcaAlm;
#agifa029#1;
;
INICIO;
FINAL;
be;
NULL,VuelcaAlm;
|FIN;

|PROCESO Lineal;
   |DELINDEX #guerw051;
   aAlfa = "00" + Usuario; |NOME_DAT #guerw051#aAlfa#; |DELINDEX #guerw051;
   |ABRE #guerw051;
   |BUCLE VuelcaAlm;
   |CIERRA #guerw051;
   |ENTLINEAL #1#guerw051, 1, 1, 21, 1, inf, sup;
|FPRC;

|PROGRAMA;
   |CLS;
   |CABEZA " Recalculo movimientos de almacen ";
   |PINPA #0#0; |PINDA #0#0;
   |ENDATOS #1#0;
   |SI FSalida = 0;
      |DELINDEX #guerw052; |DELINDEX #guerw053;
      aAlfa = "01" + Usuario; |NOME_DAT #guerw052#aAlfa#; |DELINDEX #guerw052;
      aAlfa = "02" + Usuario; |NOME_DAT #guerw053#aAlfa#; |DELINDEX #guerw053;
      |ABRE #agifa065; |ABRE #guerw051; |ABRE #guerw052;  |ABRE #guerw053; |ABRE #gopartia;

      |BUCLE Gopartia;
      |BUCLE Interpreta;

      |CIERRA #agifa065; |CIERRA #guerw051; |CIERRA #guerw052; |CIERRA #guerw053; |CIERRA #gopartia;
   |FINSI;
|FPRO;
