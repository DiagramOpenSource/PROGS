     Actualiza, CtrlViajerosAct, Viajeros

|FICHEROS;
     sctrm026 #26;
     sctrm036 #36;
     sctrm040 #40;
     sctrm041 #41;
     sctrm042 #42;
     sctrm050 #50;
     sctrm052 #52;
     sctrm053 #53;
     sctrm069 #69;
     sctrm001 #100;
|FIN;

|VARIABLES;
     fFecha = @;
     &enForma = 0;
     &enPax = 0;
     &enLinea = 0;
     &eaSentido = "";
     &efFechaViaje = @;
     nSwActualiza = 0;
     nNume = 0;
     aTipoAct = "";
     nLin = 0;
     aAlfa = "";
|FIN;

|PROCESO BuscaBono;
     |SI #52#45 ] #40#3; |Y #52#45 [ #40#4;
          nLin = #40#1;
          |ERROR10;
     |FINSI;
|FPRC;

|DEFBUCLE BuscaBono;
     #40#1;
     ;
     #52#43, 000;
     #52#43, 999;
     ;
     NULL, BuscaBono;
|FIN;

|PROCESO Actualiza;
     |ABRE #100; |LEE 000#100p; |CIERRA #100;

     |SI #52#6 = 1; |O #52#6 = 2;
          #52#56 = #100#30;
          #52#57 = #100#31;
     |FINSI;

     |ABRE #50;
     |ABRE #26;
     |SI nSwActualiza = 0; |O aTipoAct = "I";
          #26#0 = #52#96;
          #26#2 = #52#75;
          #26#4 = #52#101;
          #26#5 = #52#22;
          nNume = #52#20 - #52#99 + 1;
          #26#7 = nNume;
          |LEE 101#26=;
          |SI FSalida = 0;
               |SI #52#52 = "L";
                    #26#38 = #26#38 + (#52#19 * enForma);
               |SINO;
                    #26#26 = #26#26 + (#52#19 * enForma);
               |FINSI;
               |SI #26#26 ] #26#20;
                    #26#24 = "C";
               |SINO;
                    #26#24 = "A";
               |FINSI;
               |GRABA 020#26a;
               |SI #26#27 ! 0; |Y #52#74 = 0; |Y #52#128 = "S";
                    #50#0 = #26#7;
                    #50#1 = #26#27;
                    |LEE 101#50=;
                    |SI FSalida = 0;
                         #50#20 = #50#20 + (#52#19 * enForma);
                         |GRABA 020#50a;
                         |LIBERA #50;

                         |SI enForma = -1; |Y #52#52 = "A";
                              #52#73 = "01.01.0000";
                              #52#74 = 0;
                              #52#77 = 0;
                              #52#103 = 0;
                              #52#122 = 0;
                         |SINO;
                              |SI #52#52 ! "L";
                                   #52#73 = #50#0;
                                   #52#74 = #50#1;
                                   #52#77 = #50#2;
                                   |SI #52#103 = 0; |Y enForma = 1;
                                        || eaAlfa = "Intercambiador ida";
                                        || |HAZ PideIntercambiador;
                                        || #52#103 = enIntercambiador;
                                   |FINSI;
                              |FINSI;
                         |FINSI;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
     |SI nSwActualiza = 0; |O aTipoAct = "V";
          |SI #52#17 > 1; |Y #52#26 ! "01.01.0000";
               #26#0 = #52#105;
               #26#2 = #52#75;
               #26#4 = #52#102;
               #26#5 = #52#28; || #52#22;
               nNume = #52#26 - #52#100 + 1;
               #26#7 = nNume;
               |LEE 101#26=;
               |SI FSalida = 0;
                    |SI #52#52 = "L";
                         #26#38 = #26#38 + (#52#19 * enForma);
                    |SINO;
                         #26#26 = #26#26 + (#52#19 * enForma);
                    |FINSI;
                    |SI #26#26 ] #26#20;
                         #26#24 = "C";
                    |SINO;
                         #26#24 = "A";
                    |FINSI;
                    |GRABA 020#26a;
                    |SI #26#27 ! 0; |Y #52#79 = 0; |Y #52#129 = "S";
                         #50#0 = #26#7;
                         #50#1 = #26#27;
                         |LEE 101#50=;
                         |SI FSalida = 0;
                              #50#20 = #50#20 + (#52#19 * enForma);
                              |GRABA 020#50a;
                              |LIBERA #50;

                              |SI enForma = -1; |Y #52#53 = "A";
                                   #52#78 = "01.01.0000";
                                   #52#79 = 0;
                                   #52#82 = 0;
                                   #52#104 = 0;
                                   #52#123 = 0;
                              |SINO;
                                   |SI #52#53 ! "L";
                                        #52#78 = #50#0;
                                        #52#79 = #50#1;
                                        #52#82 = #50#2;
                                        |SI #52#104 = 0; |Y enForma = 1;
                                             || eaAlfa = "Intercambiador vuelta";
                                             || |HAZ PideIntercambiador;
                                             || #52#104 = enIntercambiador;
                                        |FINSI;
                                   |FINSI;
                              |FINSI;
                         |FINSI;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
     |CIERRA #26;
     |CIERRA #50;

     |ABRE #36;
     #36#1 = #52#43;
     |LEE 000#36=;
     |SI FSalida ! 0; |DDEFECTO #36; |FINSI;
     |CIERRA #36;

     |SI #52#45 ! 0; |Y #36#50 = "S";
          |SI enForma = -1;
               |ABRE #41; |SELECT #2#41;
               #41#0 = #52#43;
               #41#2 = #52#45;
               |LEE 101#41=;
               |SI FSalida = 0;
                    |BORRA 020#41a;
               |FINSI;
               |CIERRA #41;
          |SINO;
               nLin = 0;
               |BUCLE BuscaBono;
               |SI nLin ! 0;
                    |ABRE #41;
                    #41#0 = #52#43;
                    #41#1 = nLin;
                    #41#2 = #52#45;
                    #41#3 = #52#0;
                    |GRABA 020#41n;
                    |CIERRA #41;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;


|PROCESO CtrlViajerosAct;
     fFecha = efFechaViaje;
     |DDEFECTO #69;
     |ABRE #69;
     #69#0 = enLinea;
     #69#1 = eaSentido;
     #69#2 = fFecha;
     |LEE 101#69=;
     |SI FSalida ! 0; |GRABA  020#69b; |FINSI;
     #69#4 = #69#4 + enPax;
     |GRABA 020#69a;
     |CIERRA #69;
|FPRC;

|PROCESO Viajeros;
     aAlfa = #53#2; |QBF aAlfa;
     |SI aAlfa ! "";
          |ABRE #42;
          |DDEFECTO #42;
          #42#5 = #53#17;
          #42#0 = #53#2;
          |LEE 101#42=;
          |SI FSalida ! 0; |GRABA 020#42b; |FINSI;
          #42#1 = #53#3;
          #42#2 = #53#4;
          #42#3 = #53#5;
          #42#4 = #53#18;
          |GRABA 020#42a;
          |LIBERA #42;
          |CIERRA #42;
     |FINSI;
|FPRC;
