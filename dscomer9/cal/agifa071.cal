|FICHEROS;
     agifa071 #0;  || Lineas de albaran
     agifa010 #1;
     agifa019 #2;  || Articulos
     agifa039 #5;
     agifa024 #6;
     agifa017 #8;
     agifa065 #9;
     agifa142 #20;       || Parametros Generales
     agifa007 #21;       || Series
     capsion  #22;
     dsm00024 #24;
     agifa321 #35;       || DIV - Parametros
     dsl00001 #36;       || Codigos de barras multiples
     dsm00246 #40;       ||Control Riesgo Por Usuarios.
     dsm00247 #41;       ||Pantalla Informe Riesgo.
     dsm00248 #43;
     agis0002 #60;
     agi00100 #90;       || Lotes.
     agi00101 #91;       || Historico Lotes.
     agifa048 #480;      || escandallos, para nEsKit
     agifa553 #553;
     dsm00005 #905;
     dsm00010 #910;
     dsm00016 #916;
     agifa029 #29;
     dsm00238 #238;
     dsm00279 #279;
     dsm00134 #134;

     referen@;
     referen1@ #101;
     referen2@ #102;
     referen3@ #103;
     tagm0056@;
     tlfm0001@;
     tlfm0019@;
     tlfm0023@;
     sanch001@;
|FIN;

|VARIABLES;
     &enSoloPositivo = 0;
     aNomEnvase = "";
     nConta = 0;
     nComiRocai = 0;
     nSwSebaLopez = 0;
     aArtiPromo = "";
     nRecoge = 0;
     &enBultos = 0;
     &eaTmpAV816 = "";
     aEntraPre = "";
     nUni2Ant = 0;
     &ser_alb  = "";
     &num_alb  = 0;
     aArtBol = "";
     aPartBol = "";
     &eaClienteAparecida = "";
     &eaArticuloAparecida = "";
     &efFechaAparecida = @;

     aDCodF1 = "";
     aDCodF2 = "";
     aDCodF3 = "";
     aDCodF4 = "";
     &enCajas = 0;
     &enSurtido = 0;
     &eaArtCoimasa = "";
     &eaCliCoimasa = "";
     &eaRepCoimasa = "";

     &eaFacturable = "";
     nEsta = 0;
     nTotUni = 0;
     aPath = "";
     nSwPasa = 0;
     nTota = 0;
     nSwAparecida = 0;
     nPos1 = 0;
     nPos2 = 0;
     nCamDes = 0;
     nCamLon = 0;
     nPosArt = 0;
     nPosDes = 0;
     nLon2 = 0;
     nLon1 = 0;
     nPos = 0;
     aDes = "";
     nTallerBorLin = 0;
     nSwTaller = 0;
     &eaHayIMEI = "";
     aDef = "";
     nSwModGui = 0;
     aDato = "";
     nSwPtec = 0;
     nMarca = 0;
     aArti = "";
     aArtEnv = "";
     aArtUni = "";
     nPreDtoAnt = 0;
     nHay = 0;
     nCan = 0;
     nUni = 0;
     nUniDesanch = 0;
     nAlma = 0;
     nTagBorLinPost = 0;
     nMul = 0;
     nMts = 0;
     nEntero = 0;
     nTagQuitaPost = 0;
     nSwTagloma = 0;
     nSali = 0;
     nTagPre = 0;
     aTagDes = "";
     aTagArt = "";
     &eaNomCli = "";
     &eaDescri = "";
     &enModoCab10 = 0;
     nSal = 0;
     nSwTecatel = 0;
     aTmp22 = "";
     &enUniTagRes = 0;
     &eArtChampi = "";
     &enMaxImpo = 0;
     nTotal = 0;
     nGuardaPrecio = 0;
     nObra = 0;
     aTipoEmp = "";
     aSerie = "";
     aLetra = "";
     &eaArticuloHor = "";
     &eaCliPlb = "";
     &enObraPlb = 0;
     &eaTipoPlb = "";
     &enDto = 0;
     aPtec = "";
     nPtec = 0;
     nLin = 0;
     &eaModulo  = "";

     nTecla     = 0;
     &eaIVAsn   = "";
     nConAu     = 0;
     &nMasRies  = 0;
     nTries     = 0;
     nAudito    = 0;
     aUs        = "";
     &nRieTotal = 0;
     &nRieUtili = 0;
     &aRieBloqu = "";
     &aBloquead = "";
     &eaTag     = "";
     &Tempo        = "";
     aTempo294     = "";
     &enUniMarhu   = 0;
     nModo         = 0;
     nTotRiesgo    = 0;
     aMes          = "";
     aAnyo         = "";
     fFecha        = @;
     nPosicion     = 0;

     nCamp1        = 0;
     nCamp2        = 0;
     nCamp3        = 0;
     &enDescuento1 = 0;
     &enDescuento2 = 0;
     &eaTComision  = "";
     &enComision   = 0;

     &nDeci_Base     = 0;   || Decimales en Totales de la moneda base
     &nDeci_PreBase  = 0;   || Decimales en el Precio en moneda base
     &nDeci_BaseMx   = 0;   || Decimales en Totales de la moneda base (Maxima precision)
     &nDeci_PreBaseMx= 0;   || Decimales en el Precio en moneda base (Maxima precision)
     &nDeci_Div      = 0;   || Decimales en Totales de la divisa
     &nDeci_PreDiv   = 0;   || Decimales en el Precio en divisa
     &nDeci_TotVis   = 0;   || Decimales en Totales visibles (el de la moneda de trabajo)
     &nDeci_TotNoVis = 0;   || Decimales en Totales no visibles (el de la otra moneda)
     &nDeci_PreVis   = 0;   || Decimales en el Precio visual. (lineas)
     &nDeci_ImpVis   = 0;   || Decimales en el Importe visual. (lineas)
     &ac_divisa = ""; ||
     &pintado   = 0;|| Controla el pintado de mensa para que solo lo haga 1 vez
     &Envase    = "";
     &Unidades1 = 0;
     &Unidades2 = 0;
     &VArticulo = "";
     prevul     = 0;
     precom     = 0;
     prepcm     = 0;
     &programa      = "";
     &sserie        = "";
     &nnumer        = 0;
     &ffecha        = @;
     &cclien        = "";
     &nnombr        = "";
     &consulta      = "";
     &ccoste        = 0;
     &arti          = "";
     &unid          = 0;
     &desc          = "";
     &ext1          = "";
     &c_clien       = "";
     &c_artic       = "";
     &c_serie       = "";
     &entrada       = 0;
     &serfot        = "";
     &numfot        = 0;
     &linfot        = 0;
     &clifot        = "";
     &artfot        = "";
     &aRecoge = "N";
     &aModalidad    = "V";  || Ventas
     &aCliPro  = "";
     &aProceso = "agifa071";
     &n_dec = 0;
     &uni_dt = 0;   || Unidades
     &uni_dt2 = 0;   || Unidades2
     &fed_dt = @;   || Fecha....
     &art_dt = "";  || Articulo.
     &cli_dt = "";  || Cliente..
     &fam_dt = "";  || Familia.
     &iva_dt = 0;   || Tipo Iva.
     &dtos_2 = 0;   || Descuento 2.
     &dto_pt = 0;   || Descuento Ptas.
     &dtos_1 = 0;   || Descuento 1.
     &pvp_ve = 0;   || Precio Venta.
     &tarifa = 0;   || Tarifa Cliente.
     &quedto = 0;   || 1=cli./art, 2=cli./familia, 3=cli./subfam.
     &gru_dt = "";  || Grupo Cliente.
     &nPromo = 0;
      verpre = "";
     &enMensaje = 0;
     &aParam    = "";

     aAlfa     = "";
     nPrecio    = 0;
     nForma     = 0;
     nNume      = 0;

     tecla      = "";
     mensa      = ""; || Linea de visualizacion

     titdiv = "";   || Encabezado de precio e imp. con la divisa "Imp.Tot(USD)"
     vcontrol = "";
     salidavic = 0;
     Unidades       = 0;
     sw_escan       = 0;
     mod            = 0;
     nlote          = "";
     tu             = 0;
     ind            = 0;
     {100}M         = "";
     {100}C         = "";
     hn             = 0;
     hn1            = 0;
     nn             = 0;
     nn1            = 0;
     hi             = 0;
     j              = 0;
     longi          = 0;
     halfa          = "";
     letra          = "";
     pos            = 0;
     resto          = 0;
     inc            = 0;
     numero         = 0;
     lotes          = "";
     lineaa         = 0;
     codiBarra      = "";
     i              = 0;
     ccomi          = 0;
     repr           = "";
     clie           = "";
     fami           = "";
     lin            = 0;
     path           = "";
     art            = "";
     varalfa        = "";
     fs             = 0;
     f1             = 0;
     jj             = 0;
     aux            = "";
     mensaje10      = "2400SPrepare el PSION !! Correcto (S/N): ";
     avisa_st       = "S";    || Avisa si hay stock
     recoge         = "N";    || Recoger Albaranes
     def_exp        = "N";    || Exportacion
     DescAmpli      = "N";    || Descarga descripcion ampliada de articulos          = 0;      || Decimales en unidades
     def_alm        = 0;      || Almacen Defecto
     aprograma      = "";
     fiac           = "  ";
     guarda         = "  ";
     relleno        = "                                       ";
     aponer         = "  ";
     vacio          = "                    ";
     operacion      = "  ";
     operainte      = "  ";
     articulo       = " ";
     mescli         = " ";
     mensaje3       = "";
     mensaje5       = "0000 Albaran para Exportacion. Tipo IVA = 0 !!!";
     serie          = "";
     albaran        = 0;
     albaran_o      = 0;
     serie_o        = "";
     alfa1          = "";
     alfa2          = "";
     descu          = 0;
     tf             = 0;
     pc             = 0;
     pcs            = 0;
     pcv            = 0;
     pcd            = 0;
     comi1          = 0;
     comi2          = 0;
     comi3          = 0;
     menor          = 0;
     pc1            = 0;
     pa             = 0;
     pa1            = 0;
     pa2            = 0;
     imneto         = 0;
     imnetoD        = 0;
     asto           = 0;
     margen         = 0;
     wimneto        = 0;
     wmargen        = 0;
     a              = 0;
     b              = 0;
     modo           = 0;  || La necesito en solis008
     cantidad       = 0;
     kl             = 0;
     totbu          = 0;
     flag           = 0;
     primera        = 0;
     swescan        = 0;
     sw_promocio    = 0;
     nlinea         = 0;
     linea_o        = 0;
     LineaD         = 0; || Linea destino
     campo          = 0;
     nerror         = 0;
     salida         = "";
     n_almacen      = 0;
     n_stock        = 0;
     n_operac       = "";
     &qArti         = "";
     &qUnid         = 0;
     &qAbono        = "";
     nGuarda        = 0;
     nEsKit         = 0;
     &nDispoKit     = 0;
     &enUniKit      = 0;
     &eaProg        = "";

     aBase          = "";
     aPathCorreo    = "";
     aFichero       = "";
     nHandleCorreo  = 0;
     nPrecio1       = 0;
     nPrecio2       = 0;
     aTo            = "";
     aIP            = "";
     aSalida        = "";
     aFrom          = "";
     aAsunto        = "";
     aMensaje       = "";
     &eaToIncidencia = "";

     aSer                = "";
     nNum                = 0;
     nLinOrg             = 0;
     nSwSanchez          = 0;
|FIN;

|INCLUYE i_varart;

컴컴컴컴컴컴컴컴컴컴컴컴Modulo 004159컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO UltLinAlbVta;
     |SALVA_FICHA #agifa071;
     aSer = #agifa071#29;
     nNum = #agifa071#0;
     #agifa071#1 = 999;
     |LEE 000#agifa071.];
     |SI FSalida = 0;
          |LEE 000#agifa071.a;
     |SINO;
          |LEE 000#agifa071.u;
     |FINSI;
     |SI FSalida = 0; |Y #agifa071#29 = aSer; |Y #agifa071#0 = nNum;
          nLin = #agifa071#1 + 1;
     |SINO;
          nLin = 1;
     |FINSI;
     |REPON_FICHA #agifa071;
|FPRC;

|PROCESO Sanchez71; |TIPO 6;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo ! 1; |ACABA; |FINSI;

     |HAZ EsSanchez;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |DDEF aDef;
     aDef = aDef + "sanch001";
     |CARGA_DEF aDef, sanch001@;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |ABRE #sanch001@;
     #sanch001@#0 = #agifa071#2;
     |LEE 000#sanch001@.=;
     |SI FSalida = 0;
          nLinOrg = 0;
          |PARA i = 13; |SI i [ 18; |HACIENDO i = i + 1;
               j = i + 6;
               |SI #sanch001@#i# ! 0;
                    |SI nLinOrg = 0;
                         nLinOrg = #agifa071#1;
                         #agifa071#6 = #sanch001@#i#;
                         #agifa071#36 = #sanch001@#i#;
                         #agifa071#11 = #sanch001@#j#;
                         #agifa071#51 = nLinOrg;
                         |HAZ TotalLin71;
                         |GRABA 020#agifa071.n;
                    |SINO;
                         |HAZ UltLinAlbVta;
                         #agifa071#1 = nLin;
                         #agifa071#3 = 0;
                         #agifa071#6 = #sanch001@#i#;
                         #agifa071#36 = #sanch001@#i#;
                         #agifa071#11 = #sanch001@#j#;
                         #agifa071#51 = nLinOrg;
                         |HAZ TotalLin71;
                         |HAZ liacarti;
                         |GRABA 020#agifa071.n;
                    |FINSI;
               |FINSI;
          |SIGUE;
          |SI nLinOrg ! 0;
               #agifa071#1 = nLinOrg;
               |LEE 121#agifa071.=;
          |FINSI;
          |PTEC 809;
          |PTEC 816;
          |PTEC 814;
          |PTEC 815;
          |PONCONTROL 23, "SI";
     |FINSI;
     |CIERRA #sanch001@;
     |DESCARGA_DEF #sanch001@;
|FPRC;

|PROCESO BajaSanchez;
     |SI nSwSanchez ! 0; |ACABA; |FINSI;
     nSwSanchez = 1;

     |DDEF aDef;
     aDef = aDef + "sanch001";
     |CARGA_DEF aDef, sanch001@;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |ABRE #sanch001@;
     #sanch001@#0 = #agifa071#2;
     |LEE 000#sanch001@.=;
     |SI FSalida = 0;
          aSer = #agifa071#29;
          nNum = #agifa071#0;
          |PARA; |SI FSalida = 0; |Y #agifa071#3 = 0;
                 |Y aSer = #agifa071#29; |Y nNum = #agifa071#0; |HACIENDO;
                 |LEE 000#agifa071.a;
          |SIGUE;

          nLinOrg = #agifa071#1;
          |LEE 000#agifa071.s;
          |PARA; |SI FSalida = 0; |Y #agifa071#3 = 0;
                 |Y #agifa071#2 = #sanch001@#0; |Y aSer = #agifa071#29;
                 |Y nNum = #agifa071#0; |HACIENDO;
               |HAZ liacarti;
               |BORRA 020#agifa071.a;
               |LEE 000#agifa071.s;
          |SIGUE;
          #agifa071#1 = nLinOrg;
          |LEE 121#agifa071.=;
          |PONCONTROL 23, "SI";
          |PTEC 808;
     |FINSI;

     |CIERRA #sanch001@
     |DESCARGA_DEF #sanch001@;
     nSwSanchez = 0;
|FPRC;

|PROCESO MiraSanchez;
     |SI nSwSanchez ! 0; |ACABA; |FINSI;

     |DDEF aDef;
     aDef = aDef + "sanch001";
     |CARGA_DEF aDef, sanch001@;
     |SI FSalida ! 0; |ACABA; |FINSI;
     |ABRE #sanch001@;
     #sanch001@#0 = #agifa071#2;
     |LEE 000#sanch001@.=;
     |SI FSalida = 0;
          nSwSanchez = 1;
     |FINSI;
     |CIERRA #sanch001@
     |DESCARGA_DEF #sanch001@;
|FPRC;

컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴

|PROCESO Calc071; |TIPO 0;
     nModo = (FEntrada / 100) ! 0;

     |ABRE #2;
     #2#0 = #0#2;
     |LEE 000#2=;
     |CIERRA #2;

     |SI #0Campo ! Contenido; |O nModo = 1;
          #0#11 = #2#30; |PINTA #0#11;
     |FINSI;

     |HAZ EsOrts;
     |SI FSalida = 0;
          eaDocu = "agifa071";
          eaSerie = #0#29;
          enCodigo = #0#0;
          enLinea = #0#1;
          |SUB_EJECUTA_NP "dsz99905;ENTRA";
     |FINSI;

     |HAZ nomodifi;
     |SI DescAmpli = "S";
          aTipoDA = "A"; |HAZ DescriDA;
     |FINSI;

     ||Modulo 003273
     |SI #0Campo ! Contenido; |Y Campo = 2; eArtChampi = ""; |FINSI;

     |HAZ EsCompaq;
     |SI FSalida = 0;
          |ABRE #2;
          #2#0 = #0#2;
          |LEE 000#2=;
          |CIERRA #2;
          aAlfa = #2#125; |QBF aAlfa;
          |SI aAlfa = "C"; |O aAlfa = "M"; |O aAlfa = "N";
               eaSerie = #0#29;
               enCodigo = #0#0;
               enLinea = #0#1;
               eaArti = #0#2;
               eaDescri = #0#4;
               enModo = nModo;
               eaCliente = #1#3;
               efFecha = #1#1;
               eaNomCli = #1#4;
               |SUB_EJECUTA_NP "mcomp009;alta";
               #0#5 = enUnidades; |PINTA #0#5;
               |C_M #0#5, 1, "N";
               |SI enError ! 0; |ERROR; |FINSI;
          |FINSI;
          |CIERRA #2;
     |FINSI;

     |HAZ EsAparecida;
     |SI FSalida = 0;
          |HAZ PintaAparecida71;
     |FINSI;

     |HAZ EsDesanch;
     |SI FSalida = 0;
          |ABRE #2;
          #2#0 = #0#2;
          |LEE 020#2=;
          |CIERRA #2;
          |SI #2#136 = "N";
               |MENAV "0000El articulo no es de venta...";
               |ERROR; |ACABA;
          |FINSI;
     |FINSI;

     |HAZ EsQDClor;
     |SI FSalida = 0; |Y nModo = 2;
          |HAZ Boletin;
     |FINSI;

     |HAZ EsCoimasa;
     |SI FSalida = 0;
          |HAZ CoimaCheqRep;
     |FINSI;

     |HAZ EsJamaica;
     |SI FSalida = 0;
          aAlfa = "cafe0026;CHEQFAM" + #0#2 + #1#3;
          |SUB_EJECUTA_NP aAlfa;
          |SI enError ! 0; |ERROR; |ACABA; |FINSI;
     |FINSI;
|FPRC;

|PROCESO CtaArt1; |TIPO 0;
     eaModulo = "agifa010"; |HAZ CtaArt;
|FPRC;

|PROCESO Precio7; |TIPO 7;
     |MENSA "0000<F4> Importe Total   <F6> Consulta Precios   <F7> Calculo Precio sin IVA";
     |HAZ EsAparecida;
     |SI FSalida = 0;
          |MENSA "0000<F4>Imp. Total <F5>Tarifas <F6>Consulta Pre. <F7>Calculo Pre. sin IVA";
     |FINSI;
     |HAZ EsRocai;
     |SI FSalida = 0;
          |MENSA "0000<F3>Tarifas <F4>Imp. Total <F6>Consulta Precios <F7>Calculo Precio sin IVA";
     |FINSI;

     |C_M #0Campo, 0, aAlfa;
     |SI #20#250 = "X"; |Y aAlfa = "S";
          |SI aArtiPromo = #0#2;
               #0Campo = #0Campo + #0#64;
          |SINO;
               aArtiPromo = #0#2;
               #0#64 = 0;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO TeclaPre;
     salida = FSalida;
     |SI salida = 12;
          |SI Campo = 6; |O Campo = 36;
               |C_V #0#9, 0, aAlfa;
               |SI aAlfa = "S";
                    nCamp1 = 9; nCamp2 = 6;
                    |C_M #0#9, 1,"S"; |ENCAMPO #9#0; |C_M #0#9, 1, "N";
               |FINSI;
               |C_V #0#37,0, aAlfa;
               |SI aAlfa = "S";
                    nCamp1 = 37; nCamp2 = 36;
                    |C_M #0#37, 1, "S"; |ENCAMPO #37#0; |C_M #0#37, 1, "N";
               |FINSI;
               |SI FSalida = 0;
                         || nCamp1 -> importe
                         || nCamp2 -> precio
                         || nCamp3 -> unidades
                    |SI eaIVAsn = "S";
                         #0nCamp1 = #0nCamp1 / (1+(enIva/100))
                    |FINSI;
                    |SI #2#194 = 2;
                         nCamp3 = 48;   || unidades doble stock S/N
                    |SINO;
                         nCamp3 = 5;
                    |FINSI;
                    |SI #0nCamp3 = 0;        || unidades cero
                         #0nCamp3 = #0nCamp1 / #0nCamp2;
                         |HAZ unidad;
                    |FINSI;
                    |SI #0nCamp2 = 0;        || precio cero
                         #0nCamp2 = #0nCamp1 / #0nCamp3;
                         |PINTA #0nCamp2;
                    |FINSI;
               |SINO;
                    |AVISO; |ERROR;
               |FINSI;
          |FINSI;
          salida = 0;
     |FINSI;
     |SI salida = 14;
          c_clien = #1#3;
          c_artic = #0#2;
          c_serie = #1#52;
          entrada = 1;
          |SUB_EJECUTA_NP "agifa283.run";
          |ERROR;
          salida = 0;
     |FINSI;

     |SI salida = 15;
          eaCli = "";
          enTiva = #0#11;
          efFiva = #1#1;
          |HAZ IVACli;
          |SI #1#70 = "D";
               #0#36 = #0#36 / (1 + enIva/100);
          |SINO;
               #0#6 = #0#6 / (1 + enIva/100);
          |FINSI;
          |HAZ visual_precio;
          salida = 0;
     |FINSI;

     |SI salida = 17;     || F9
          |HAZ EsTagloma;
          |SI FSalida = 0;
               eaDocu = "AV";
               eaSerie = #0#29;
               enCodigo = #0#0;
               enLinea = #0#1;
               eaDes = #0#4;
               |SUB_EJECUTA_NP "tagm0058";
               #0#4 = eaDes; |PINTA #0#4;
          |FINSI;
     |FINSI;
     |SI salida = 13;
          |HAZ EsAparecida;
          |SI FSalida = 0;
               enPrecio = #0Campo;
               eaArticulo = #0#2;
               eaCliente = #1#3;
               |SUB_EJECUTA_NP "aparm010";
               #0Campo = enPrecio; |PINTA #0Campo;
               |ERROR;
          |FINSI;
     |FINSI;

     |SI salida= 11; || F3
          |HAZ EsRocai;
          |SI FSalida = 0;
               enPrecio = #0#6;
               enComision = #0#10;
               eaCliente = #1#3;
               eaArticulo = #0#2;
               |SUB_EJECUTA_NP "rocaiz01";
               #0#10 = enComision; |PINTA #0#10;
               #0#6 = enPrecio; |PINTA #0#6;
          |FINSI;
     |FINSI;

     |C_M #0Campo, 0, aAlfa;
     |SI #20#250 = "X"; |Y aAlfa = "S";
          eaDocu = "AV";
          eaSerie = #0#29;
          enCodigo = #0#0;
          enLinea = #0#1;
          eaArticulo = #0#2;
          eaCli = #1#3;
          enModo = (FEntrada / 100) ! 0;
          enDto = #0#8;
          enPrecio = #0#6;
          enUnid1 = #0#5;
          enUnid2 = #0#66;
          enUnid3 = #0#35;
          Envase = #0#34;
          enImpDtoPromo = #0#64;
          enDtoPrePromo = #0#65;
          eaDivisa = #1#68;
          |SUB_EJECUTA_NP "dsz00080";
          |SI enError ! 0; |ERROR; |ACABA; |FINSI;
          #0#8 = enDto;
          #0#6 = enPrecio;
          #0#5 = enUnid1;
          #0#66 = enUnid2;
          #0#35 = enUnid3;
          #0#34 = Envase;
          #0#64 = enImpDtoPromo;
          #0#65 = enDtoPrePromo;
     |FINSI;
|FPRC;

|PROCESO LeeParam071;
     |ABRE #20; |LEE 000#20p; |CIERRA #20;

     lotes = #20#51;
     avisa_st = #20#5;
     recoge = #20#27;
     DescAmpli = #20#198;     || Descargar descripcion ampliada
     |SI DescAmpli = "N";
          DescAmpli = #20#40;
     |FINSI;
     codiBarra = #20#55;     || Lectura Cod. Barra
     verpre = #20#101;       || Para ver PC,PMC,PUV.
     |ABRE #21;
     #21#26 = #1#52;
     |LEE 001#21=;
     |SI FSalida ! 0; |DDEFECTO #21; |FINSI;
     |CIERRA #21;
     def_alm = #21#29;
     def_exp = #21#30;
|FPRC;

|PROCESO PintaLinArt;
     |ABRE #2;
     #2#0 = #0#2;
     |LEE 000#2=;
     |CIERRA #2;
     |DDEFECTO #553;
     |ABRE #553;
     #553#0 = #2#125;
     |LEE 000#553=;
     |CIERRA #553;
     |PINTA 2303, #553#1;
|FPRC;

|PROCESO Tipo7_071; |TIPO 7;
     |HAZ EsChampi;
     |SI FSalida = 0;
          eaTipo      = "V";
          eaSerie     = #0#29;
          enCodigo    = #0#0;
          enLinea     = #0#1;
          |HAZ ChampiPinAux;
     |FINSI;
     |HAZ EsChampiEmar;
     |SI FSalida = 0;
          eaTipo      = "AV";
          eaSerie     = #0#29;
          enCodigo    = #0#0;
          enLinea     = #0#1;
          |HAZ ChampiPinEmar;
     |FINSI;
     |HAZ EsViarsa;
     |SI FSalida = 0;
          |HAZ ViaPinAlbVta;
     |FINSI;
     |HAZ EsCampoJerez;
     |SI FSalida = 0;
          |HAZ CpjPinAlbVta;
     |FINSI;
     |HAZ EsVigor;
     |SI FSalida = 0;
          |HAZ VigorPin71;
     |FINSI;
     |HAZ EsDesanch;
     |SI FSalida = 0;
          |HAZ PinDesanch;
     |FINSI;
     |HAZ EsQDClor;
     |SI FSalida = 0;
          |HAZ PinQDClor71;
     |FINSI;
     |HAZ EsOrts;
     |SI FSalida = 0;
          |HAZ OrtsPin071;
     |FINSI;

     |ABRE #279; |LEE 000#279p; |CIERRA #279;
     nPreDtoAnt = 0;

     modo = (FEntrada / 100) ! 0;
     |HAZ LeeParam071;
     |HAZ PintaMedidaV;

     |MODO_RELACION #2, 1, "agifa019", "S", "S";
     |MODO_RELACION #8, 1, "agifa017", "S", "S";

     |ABRE #agifa321;
     |LEE 000#agifa321.p;  || Leo parametros de divisa
     |CIERRA #agifa321;

     |SI ac_divisa ! "S";
          |ATRI R;
          |PINTA 1446, "Precio";
          |PINTA 1470, "I.Total";
          |ATRI r;
     |SINO;
          |SI pintado = 0; || Si divisas estan activadas y no he pintado ...
               |SI #1#70 = "D";   || Si la moneda de trabajo es la divisa la pinto en
                    |ATRI R;         || el encabezado del precio y el importe
                    titdiv = "Precio" + "(" + #1#68 + ")";
                    |PINTA 1444,titdiv;
                    titdiv = "I.Tot." + "(" + #1#68 + ")";
                    |PINTA 1468,titdiv;
                    |ATRI r;
               |SINO;
                    |ATRI R;
                    |PINTA 1446, "Precio";
                    |PINTA 1470, "I.Total";
                    |ATRI r;
               |FINSI;
               |SI #agifa321#3 = "S";  || Si la visualizacion esta activada ...
                    |PINTA 1103, "Prec:"
                    |PINTA 1121, "Imp.:";
                    |PINTA 1141, "T.Bruto:";
                    |PINTA 1161, "T.ALB:";

                    |PINTA #0#38; || Pinto precio visual
                    |PINTA #0#39; || Pinto importe visual
                    |SI #1#70 = "D"; || Si la moneda de trabajo es la divisa
                         |PINTA 1149,#1#79;
                         |PINTA 1167,#1#80;
                    |SINO;
                         |PINTA 1149,#1#75;
                         |PINTA 1167,#1#76;
                    |FINSI;
                    pintado = 1;  || Ya hemos pintado
               |FINSI;
          |FINSI;
     |FINSI;

     |SI modo = 1;
          #0#1 = #0#1 + #agifa142#236 - 1;
     |FINSI;

     |HAZ EsAparecida;
     |SI FSalida = 0;
          |HAZ PintaDes71;
          |HAZ PintaAparecida71;
     |FINSI;

     |HAZ EsInforAlba;
     |SI FSalida = 0;
          |ATRI R; |PINTA 1236, "Matricula"; |ATRI I;
          ||C_V #0#49, 1, "S";
          |PINTA 1336, #0#49;
     |FINSI;
     |HAZ EsGesisat;
     |SI FSalida = 0;
          |ATRI R; |PINTA 1236, "Maquina  "; |ATRI I;
          |HAZ GesiLeeMaqui;
          aAlfa = #0#49; #0#49 = eaMatri;
          |PINTA 1336, #0#49;
          #0#49 = aAlfa;
     |FINSI;
     |HAZ EsInforpor;
     |SI FSalida = 0;
          |C_V #0#49, 1, "S"; |PINTA #0#49;
          |ATRI R; |PINTA 1236, "Promocion"; |ATRI 0;
     |FINSI;
|FPRC;

|PROCESO IVA071_0; |TIPO 0;
     |HAZ mirespor;

     enTiva = #0Campo;
     efFiva = #1#1;
     |HAZ SacaIVA;
     |SI eaDiva = "";
          |MENAV "0000No existe tipo iva para esta fecha...";
          |ERROR; |ACABA;
     |FINSI;
     |HAZ EsDesanch;
     |SI FSalida = 0;
          eaSerie = #0#29;
          enCodigo = #0#0;
          enLinea = #0#1;
          eaFacturable = #1#51;
          eaAbono = "";
                 || Cli + Nom  + Pobla + Arti + Des  + Fec
          eaAlfa = #1#3 + #1#4 + #1#31 + #0#2 + #0#4 + #1#1;
          |SUB_EJECUTA_NP "desan033";
          |SI eaFacturable ! ""; #1#51 = eaFacturable; |FINSI;
          |SI eaAbono = "S"; #0#5 = -#0#5; |FINSI;
          |HAZ PinDesanch;
     |FINSI;
     |HAZ EsQDClor;
     |SI FSalida = 0;
          eaArticulo = #0#2;
          eaSerie = #0#29;
          enCodigo = #0#0;
          enLinea = #0#1;
          |SUB_EJECUTA_NP "qdclor08";
          |HAZ PinQDClor71;

          eaTipo = "V";
          eaPartida = #0#49;
          |SUB_EJECUTA_NP "qdclor10;VER";
     |FINSI;
     |HAZ EsInforAlba;
     |SI FSalida = 0;
          |ABRE #2;
          #2#0 = #0#2;
          |LEE 000#2=;
          |SI FSalida = 0; |Y #2#174 = "S ";
               eaArticulo = #0#2;
               eaMatri = #0#49;
               |SUB_EJECUTA_NP "ialbz001;AV";
               #0#49 = eaMatri;
          |SINO;
               #0#49 = "";
          |FINSI;
          |PINTA 1336, #0#49;
          |CIERRA #2;
     |FINSI;
     |HAZ EsGesisat;
     |SI FSalida = 0;
          |ABRE #2;
          #2#0 = #0#2;
          |LEE 000#2=;
          |SI FSalida = 0; |Y #2#174 = "S ";
               eaArticulo = #0#2;
               eaCliente = #1#3;
               efFecha = #1#1;
               enUnidades = #0#5;
               aAlfa = "gesiz019;AV" + #0#29 + (("000000"+#0#0)%-106) + #0#1;
               |SUB_EJECUTA_NP aAlfa;
               |SI eaMatri = ""; |ERROR; |FINSI;
          |SINO;
               |HAZ GesiBorMaqui;
          |FINSI;
          |CIERRA #2;
          aAlfa = #0#49; #0#49 = eaMatri;
          |PINTA 1336, #0#49;
          #0#49 = aAlfa;
     |FINSI;
|FPRC;

|PROCESO mirespor;|TIPO 0;
     |SI #6#28 = "S"; |Y #0#11 ! 0;
          |MENAV mensaje5; #0#11 = 0; |PINTA #0#11;
     |SINO;
          |SI #0#11 ! 0; |Y def_exp = "S";
               |MENSA mensaje5; #0#11 = 0; |PINTA #0#11;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO liinfo;|TIPO 0;
     eaArticulo = #agifa071#2;
     |HAZ EsKit;
     nEsKit = FSalida;

     |SI verpre ! "S";
          mensaje3 = "0410Stock Disponible Almacen : " + #8#39+"     Stock Minimo : "+#8#6;
          |MENSA mensaje3;
     |SINO;
          |HAZ verpre2;
          precom = #2#133 / #1#74 * #1#69;  || Calculo el importe en divisas
          prepcm = #2#9 / #1#74 * #1#69;    || Calculo el importe en divisas
          |SI #1#70 = "D";                     || Si la moneda de trabajo es la divisa ...
               precom = precom ! nDeci_PreDiv;
               prepcm = prepcm ! nDeci_PreDiv;
         |SINO;                               || Si la moneda de trabajo es la moneda base ...
               precom = precom ! nDeci_PreBase;
               prepcm = prepcm ! nDeci_PreBase;
         |FINSI;
         mensaje3 = "0401Disponible.: [" + #8#39 + "] Min.: [" + #8#6 + "] PC.: [" + precom + "] PMC.: [" +prepcm+"] PVU.: [" + prevul+"]";
         mensaje3 = mensaje3 % 180;
         |MENSA mensaje3;
     |FINSI;

     eaCliente = #1#3;
     efFecha = #1#1;
     Contenido = articulo;
     |HAZ SacaKit;
     |SI eaModiKit = "S";     || Se ha mdoificado el kit
          |HAZ EsTagloma;     || Precio Kit (dsz99986)
          |SI FSalida = 0;
               #0#6 = enPreKitCal;
               |HAZ precio_divisa;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Uni71_0;|TIPO 0;
     nModo = (FEntrada / 100) ! 0;

     |HAZ EsTecatel; nSwTecatel = FSalida;

     |SI #1#43 = "N";
          |SI avisa_st = "S"; |O avisa_st = "X";
               eaArticulo = #agifa071#2;
               |HAZ EsKit;
               nEsKit = FSalida;
               |SI nEsKit = 0;
                    |HAZ DispoKit;
                    |SI nDispoKit ! 0;
                         |SI nSwTecatel = 0; |AVISO; |AVISO; |FINSI;
                         |MENAV "0000Superado Stock para KIT.";
                         |SI nSwTecatel = 0; |AVISO; |AVISO; |FINSI;

                         |SI enUniKit > 0;
                              aAlfa = "0000NDisponibles:" + enUniKit + &13 + "풞signar disponible?";
                              |CONFI aAlfa;
                              |SI FSalida = 0; #0#5 = enUniKit; |PINTA #0#5; |FINSI;
                         |SINO;
                              aAlfa = "0000NNo hay disponibles." + &13 + "풠ontinuar?";
                              |CONFI aAlfa;
                         |FINSI;
                         |SI FSalida ! 0; |ERROR; |ACABA; |FINSI;
                    |FINSI;
               |SINO;
                    |ABRE #8;
                    #8#0 = #0#2;
                    #8#1 = #0#3;
                    |LEE 000#8=;
                    |CIERRA #8;
                    |HAZ EsTagloma;
                    |SI FSalida = 0;
                         |HAZ TagloAvisaStock;
                    |SINO;
                         |SI #8#39 < #0#5;
                              |SI nSwTecatel = 0; |AVISO; |AVISO; |FINSI;
                              aAlfa = "0000Supera el Stock disponible: " + #8#39;
                              |MENAV aAlfa;
                              |SI avisa_st = "X"; |ERROR;   |FINSI;
                         |FINSI;
                    |FINSI;
               |FINSI;
               nStock = #8#5 - #0#5;
               |SI #8#6 > nStock; |Y #agifa142#219 = "S";
                    |MENAV "0000Supera el Stock minimo...";
               |FINSI;
          |FINSI;
     |FINSI;

     |HAZ EsDesanch;
     |SI FSalida = 0;
          |HAZ DesanchUni;
          |SI FSalida ! 0; |ERROR; |ACABA; |FINSI;
     |FINSI;

     |HAZ EsExtintor;
     |SI FSalida = 0;
          |HAZ ExtinCheqUni;
          |SI FSalida ! 0; |ERROR; |ACABA; |FINSI;
     |FINSI;

     |HAZ ModRie71;
|FPRC;

|PROCESO ModRie71; |TIPO 0;
     |SI nModo = 2; |Y #0Campo ! Contenido;
          |HAZ Riesgos71;
          |SI enErrRie = 1; |ERROR; |ACABA; |FINSI;
     |FINSI;

     nNume = #0#5 * #0#6;
     |SI enSoloPositivo = 1; |Y nNume > 0;
          |MENAV "0000IMPORTES POSITIVOS NO PERMITIDOS PARA CLIENTES BLOQUEADOS";
          |ERROR;
     |FINSI;
|FPRC;

|PROCESO licogea;|TIPO 0;
     articulo = #0#2;
     eaArtiAntes = #0#2;
     enAlmaAntes = #0#3;
     aArtBol = #0#2;
     aPartBol = #0#49;
     aArtiPromo = #0#2;

     |SI #1#43 = "S";
          |HAZ EsSematel;
          |SI FSalida = 0;
               |MENAV "0000Informar de la factura de cargo de la cual se realiza el abono";
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Incidencia;
     |SI #6#39 = 1; pcs = 130; pcv = 18;  pcd = 21;  |FINSI;
     |SI #6#39 = 2; pcs = 131; pcv = 19;  pcd = 22;  |FINSI;
     |SI #6#39 = 3; pcs = 132; pcv = 20;  pcd = 23;  |FINSI;
     |SI #6#39 = 4; pcs = 153; pcv = 147; pcd = 150; |FINSI;
     |SI #6#39 = 5; pcs = 154; pcv = 148; pcd = 151; |FINSI;
     |SI #6#39 = 6; pcs = 155; pcv = 149; pcd = 152; |FINSI;

     nPrecio1 = #2pcv ! 2;
     nPrecio2 = #0#6  ! 2;

     |SI nPrecio1 = nPrecio2;  |ACABA;  |FINSI;

     |MENSA "0000 Enviando incidencia.";

     |DBASE aBase;
     aPathCorreo = aBase + "/correo";  |MKDIR aPathCorreo;
     aFichero    = aPathCorreo + "/incidencia.txt";
     |XABRE "W", aFichero, nHandleCorreo;
     |SI FSalida ] 0;
         aAlfa = "Incidencia en el Precio en Albaranes Ventas" + &13 + &10;
         |XGRABA nHandleCorreo, aAlfa;

         aAlfa = "" + &13 + &10;                   |XGRABA nHandleCorreo, aAlfa;

         aAlfa = "SERIE: " + #0#29 + &13 + &10;    |XGRABA nHandleCorreo, aAlfa;
         aAlfa = "ALBARAN: " + #0#0 + &13 + &10;   |XGRABA nHandleCorreo, aAlfa;
         aAlfa = "LINEA: "   + #0#1 + &13 + &10;   |XGRABA nHandleCorreo, aAlfa;
         aAlfa = "CLIENTE: " + #1#3 + &13 + &10;   |XGRABA nHandleCorreo, aAlfa;
         aAlfa = "NOMBRE CLIENTE: " + #1#4 + &13 + &10;   |XGRABA nHandleCorreo, aAlfa;

         aAlfa = "" + &13 + &10;                   |XGRABA nHandleCorreo, aAlfa;

         aAlfa = "CODIGO ARTICULO: " + #0#2 + &13 + &10;       |XGRABA nHandleCorreo, aAlfa;
         aAlfa = "NOMBRE ARTICULO: " + #0#4 + &13 + &10;       |XGRABA nHandleCorreo, aAlfa;
         aAlfa = "PRECIO EN ARTICULO: " + nPrecio1 + &13 + &10;   |XGRABA nHandleCorreo, aAlfa;
         aAlfa = "PRECIO EN ALBARAN: " + nPrecio2 + &13 + &10;     |XGRABA nHandleCorreo, aAlfa;

         aAlfa = "" + &13 + &10;                   |XGRABA nHandleCorreo, aAlfa;

         |SI #2pcs = "S";
             aAlfa = "LA POSIBLE INCIDENCIA ES QUE EL PRECIO VIENE CON EL IVA INCLUIDO DESDE LA FICHA DEL ARTICULO" + &13 + &10;
             |XGRABA nHandleCorreo, aAlfa;
         |FINSI;
     |FINSI;
     |XCIERRA nHandleCorreo;

     aIP      = "xdscorreo.dv.diagram.net";
     aSalida  = "asmtp.diagram.es";  |QBF aSalida;
     aFrom    = "soporte@diagram.es";
     aTo      = eaToIncidencia;
     aAsunto  = "Incidencia en precio albaranes ventas (diagram014 /v/ase0823)";
     aMensaje = &13 + &10 + "Leer fichero adjunto.";

     |DSCORREO_ENVIA aIP, aSalida, aFrom, aTo, aAsunto, aMensaje, aFichero;

     |MENSA "       ";
|FPRC;

|PROCESO CalComision;
     enDescuento1 = #0#8;
     enDescuento2 = #0#33;
     eaTComision  = #0#16;
     eaCliente    = #1#3;
     eaArticulo   = #0#2;
     eaRepre      = #1#6;
     efFecha      = #1#1;
     enDirEnt = #1#84;
     enAlmacen = #0#3;
     |SI #0#35 ! 0;
          uni_dt = #0#35;
     |SINO;
          uni_dt = #0#5;
     |FINSI;
     uni_dt2 = #0#48;
     |HAZ Comisiones;

     ||컴컴컴컴컴컴컴횺arhuenda
     |HAZ ComiMarhu;
     #0#8 = enDescuento1;
     #0#10 = enComision;
     |HAZ ComiOrts71;
|FPRC;

|PROCESO PrecioArti;
     aEntraPre = "N";
     |HAZ EsGestral;
     |SI FSalida = 0;
          |SI nUni2Ant ! #0#48; aEntraPre = "S"; |FINSI;
     |FINSI;

     modo = (FEntrada / 100) ! 0;
     fed_dt = #1#1;   || Fecha....
     art_dt = #0#2;   || Articulo.
     cli_dt = #0#15;  || Cliente..
     fam_dt = #0#13;  || Familia.
     iva_dt = #2#30;  || Tipo Iva.
     dtos_2 = 0;      || Descuento 2.
     dto_pt = 0;      || Descuento Ptas.
     dtos_1 = 0;      || Descuento 1.
     pvp_ve = 0;      || Precio Venta.
     tarifa = #6#39;  || Tarifa Cliente....
     gru_dt = #6#158; || Grupo Cliente.
     nPromo = #1#89;
     |SI #0#35 ! 0;
          uni_dt = #0#35;
     |SINO;
          uni_dt = #0#5;
     |FINSI;
     uni_dt2 = #0#48;
     enMensaje = 0;
     aParam = "";
     eaSerie = #0#29;
     enDirEnt = #1#84;
     enAlmacen = #0#3;
     |SI modo = 1; |O articulo ! #0#2; |O aEntraPre = "S";
          |SI #2#176 = "S";  enMensaje = 1;  |FINSI;
          enInterno = tarifa;
          |HAZ calcdtos;              || Calculo Dtos.....
          |SI eaCliArtDiviSN = "S";
               |SI eaCliArtDivi ! #1#68;
                    aAlfa = "0000La divisa del documento ("+ #1#68 + ") no se corresponde con la oferta (" + eaCliArtDivi + ").";
                    |MENAV aAlfa;
                    |PTEC 807;     || Ctrl+C
               |SINO;
                    pvp_ve = pvp_ve * #1#74 / #1#69; ||Cam.Base * Cambio
               |FINSI;
          |FINSI;
          eaCliArtDiviSN = "N";

          |HAZ EsCongecar;
          |SI FSalida = 0; #0#61 = enInterno; |FINSI;

          #0#6   = pvp_ve - dto_pt;   || Precio Venta. sin iva.
          #0#8   = dtos_1;            || 1 Dto.
          #0#33  = dtos_2;            || 2 Dto.

          |HAZ precio_divisa;  ||Convierte el precio en divisa
          |PINTA #0#33;
          |PINTA #0#8;

          |HAZ CalComision;

          #0#6 = pvp_ve - dto_pt;   || Precio Venta. sin iva.

          |HAZ EsTagloma;     || Precio Kit (dsz99986)
          |SI FSalida = 0;
               eaArticulo = #0#2;
               |HAZ EsKit;
               |SI FSalida = 0;
                    #0#6 = enPreKitCal;
               |FINSI;
          |FINSI;

          |HAZ precio_divisa;       ||Convierte el precio en divisa
          ||컴컴컴컴컴컴컴컴컴컴컴컴
          |PINTA #0#10;
          |PINTA #0#8;
     |FINSI;
|FPRC;

|PROCESO defecli;|TIPO 0;
     #0#15 = #1#3;
     #0#16 = #1#34;
     #0#17 = #1#35;
     |SI #0#2 ! #2#0;
          |ABRE #2;
          #2#0 = #0#2;
          |LEE 000#2=;
          |CIERRA #2;

          |ABRE #8;
          #8#0 = #0#2;
          #8#1 = #0#3;
          |LEE 000#8=;
          |CIERRA #8;
     |FINSI;
     #0#13 = #2#2;
     |SI #0#15 ! #6#0;
          |ABRE #6;
          #6#0 = #0#15;
          |LEE 000#6=;
          |CIERRA #6;
     |FINSI;
     |HAZ mirespor;
     |HAZ PrecioArti;
|FPRC;

|PROCESO licomis;|TIPO 0;
     |SI #0Campo ! Contenido;
         enDescuento1 = #0#8;
         enDescuento2 = #0#33;
         eaTComision  = #0#16;
         eaCliente    = #1#3;
         eaArticulo   = #0#2;
         eaRepre      = #1#6;
         enDirEnt = #1#84;
         enAlmacen = #0#3;
         |HAZ Comisiones;
         |HAZ ComiMarhu;
         #0#10 = enComision;
         |HAZ ComiOrts71;
         |PINTA #0#10;
     |FINSI;
|FPRC;

|PROCESO unidad; |TIPO 6;
     nModo = (FEntrada / 100) ! 0;
     nTecla = FSalida;
     |HAZ Promart;

     |SI nTecla = 12;
          |HAZ EsAparecida;
          |SI FSalida = 0;
               ||ARA38
               eaArticuloAparecida = #agifa071#2;
               eaClienteAparecida = #agifa010#3;
               efFechaAparecida = #agifa010#1;
               |HAZ CtrlStockDevolAparecida;
               |ERROR;
               |ACABA;
          |FINSI;
     |FINSI;

     |SI nTecla = 13;
          enTipEnvase = 1;
          |HAZ Envase71;
     |FINSI;

     |SI nTecla = 14;             ||F6
          eaAuto = "N";
          |HAZ Equivalentes;
          |ERROR;
          |ACABA;
     |FINSI;

     #0#5 = #0#5 ! n_dec;
     |PINTA #0#5;

     ||컴컴컴컴컴컴컴횺i쨅na
     |HAZ EsMinana;
     |SI FSalida = 0;  |Y  eaToIncidencia ! "";
         |HAZ Incidencia;
     |FINSI;

     |HAZ EsCongecar;
     |SI FSalida = 0; |Y nModo = 2;
          enInterno = #0#61;
          |HAZ ModiTariCongecar;
          |SI #0#61 ! enInterno;
               #0#61 = enInterno;
               #0#6 = pvp_ve;
               |HAZ precio_divisa;
          |FINSI;
     |FINSI;

     |SI #0#5 [ 0; |O #1#43 = "S"; |ACABA; |FINSI;
     qArti = #0#2;
     qUnid = #0#5;
     |HAZ ComproMin;
     |SI enErr ! 0;
          |ERROR;
          |ACABA;
     |FINSI;

|FPRC;

|PROCESO Riesgos71;
     enErrRie = 0;
     eaSerie = #0#29; eaTag = "AV";  |HAZ SacaRiesgo;

     eaCli = #0#15; enTiva = #0#11; efFiva = #0#1; |HAZ IVACli;
     nTota = #0#9 + (#0#9 * enIva / 100);
     nTota = nTota < #0#8 < #0#33;
     |SI eaRieSuma = "S"; nRieUtili = nRieUtili + #1#67 + nTota; |FINSI;
     |SI #1#43 = "N"; |Y #agifa142#6 = "S";
          eaDocu = "L";
          eaTipo = "A";
          enImpoDoc = #1#67 + #0#9;
          eaDesdeLinea = "S";
          |HAZ ControlRiesgo;
          eaDesdeLinea = "N";
          |SI enErrRie = 1; |ERROR; |ACABA; |FINSI;
          |SI enAudito = 0;
               |ABRE #43;
               |LEE 000#43u;
               |SI FSalida = 0;
                    nConAu = #43#0 + 1;
               |SINO;
                    nConAu = 1;
               |FINSI;
               |DDEFECTO #43;
               #43#0 = nConAu;          || contador
               #43#12 = "ALBARAN";      || tipo documento
               #43#1 = #1#52;           || serie
               #43#2 = #1#0;            || documento
               #43#3 = #1#1;            || fecha
               #43#4 = #1#3;            || cliente
               #43#5 = #1#4;            || nombre
               #43#6 = Usuario % 810;             || usuario
               #43#7 = nRieTotal;       || riesto concedido
               #43#8 = nRieUtili;       || riesgo actual
               #43#9 = #41#2;           || % exceso
               #43#10= #41#3;           || importe % exceso
               #43#11= #41#4;           || limite exceso
               |GRABA 020#43n;
               |CIERRA #43;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO borraa;
     |BORRA 021#91a;
|FPRC;

|DEFBUCLE borra_lotes;
     #91#1;
     ;
     #0#29, #0#0, #0#1, "        ";
     #0#29, #0#0, #0#1, "zzzzzzzz";
     be;
     NULL, borraa;
|FIN;

|PROCESO liacarti; |TIPO 2;
     || *(2)
     nForma = 0 +. 1;
     modo = (FEntrada / 100) ! 0;

     |ABRE #279; |LEE 000#279p; |CIERRA #279;

     |HAZ EsTagloma; nSwTagloma = FSalida;
     |HAZ EsTaller; nSwTaller = FSalida;
     |HAZ EsAparecida; nSwAparecida = FSalida;

     |SI nSwTaller = 0;
          |SI #0#63 = -1; |Y enModoCab10 ! 3;
               |SI nForma = -1;
                    |MENAV "0000Linea canon de articulo, no se puede modificar";
               |FINSI;
               |ERROR; |ACABA;
          |FINSI;
     |FINSI;
     |SI nSwAparecida = 0;
          |SI #0#63 = -1; |Y enModoCab10 ! 3;
               |SI nForma = -1;
                    |MENAV "0000Linea auto-descarga, no se puede modificar";
               |FINSI;
               |ERROR; |ACABA;
          |FINSI;
     |FINSI;

     |SI nSwTagloma = 0;
          |HAZ TagEsLinPost;
          |SI FSalida = 0; |Y enModoCab10 ! 3;
               |SI nForma = -1;
                    |MENAV "0000Linea de incremento de postformado, no se puede modificar...";
               |FINSI;
               |ERROR; |ACABA;
          |FINSI;
     |FINSI;

     |SI #0#63 = -1; |Y enModoCab10 ! 3;
          |SI nForma = -1;
               |MENAV "0000Linea de Promocion, no se puede modificar...";
          |FINSI;
          |ERROR; |ACABA;
     |FINSI;

     |SI #0#63 = -2; |Y enModoCab10 ! 3; || del modulo 001928, EsGuillen
/*
          |SI nForma = -1;
               |MENAV "0000Linea de envases automatica, no se puede modificar...";
          |FINSI;
          |ERROR; |ACABA;
*/
          |SI nForma = -1;
               |SI modo ! 3;
                    nSwModGui = 0;
                    |AVISO;
                    |CONFI "0000NLinea de envases automatica, modificar?";
                    |SI FSalida ! 0;
                         |ERROR; |ACABA;
                    |SINO;
                         nSwModGui = 1;
                    |FINSI;
               |SINO;
                    |MENAV "0000Linea de envases automatica, no se puede borrar...";
                    |ERROR; |ACABA;
               |FINSI;
          |SINO;
               |SI nSwModGui = 0;       || lo tiene que hacer siempre salvo
                    |ERROR; |ACABA;     ||/si se modifica la linea a traves
               |FINSI;                  ||/del CONFI (PRIEGO-19.08.08)
               nSwModGui = 0;           ||/tiquet 001928.00216
          |FINSI;
     |FINSI;

     |SI modo = 1;
          |HAZ Riesgos71;
          |SI enErrRie = 1; |ERROR; |ACABA; |FINSI;
     |FINSI;

     |SI modo = 2;|O modo = 3;
          efFec = #1#1;
          enAlma = #0#3;
          |HAZ MiraHisL;
          |SI enErrHis ! 0;
               |ERROR;
               |ACABA;
          |FINSI;
     |FINSI;
     |SI #0#19 = "S"; |O #0#20 = "S";|O #1#38 = "S"; |O #1#39 = 999999;
          |SI nForma < 0;
              |SI #0#19 = "S";
                  |MENAV "0000Esta linea proviene de un Pedido (use la opcion adecuada)";
              |FINSI;

              |SI #0#20 = "S";
                  |MENAV "0000Esta linea proviene de un Deposito (use la opcion adecuada)";
              |FINSI;

              |SI #1#38 = "S";
                  |MENAV "0000Este albaran esta FACTURADO";
              |FINSI;

              |SI #1#39 = 999999;
                  |MENAV "0000Este albaran esta en modo Exportacion";
              |FINSI;
          |FINSI;
          |ERROR;
          |ACABA;
     |FINSI;

     |HAZ EsSanchez;
     |SI FSalida = 0;
          |SI modo = 3; |Y enModoCab10 ! 3;
               |HAZ BajaSanchez;
          |FINSI;
          |SI modo = 2;
               |HAZ MiraSanchez;
               |SI nSwSanchez ! 0;
                    nSwSanchez = 0;
                    |SI nForma = - 1;
                         |MENAV "0000Modificacion no permitida, de baja la linea...";
                    |FINSI;
                    |ERROR; |ACABA;
               |FINSI;
          |FINSI;
     |FINSI;

     |SI nSwTagloma = 0; |Y #0#13 = "FMB";
          |SI enModoCab10 = 3;
               eaArticulo = #0#2;
               enAlmacen = #0#3;
               enUnidad1 = #0#5;
               enUnidad2 = #0#48;
               eaSerie = #0#29;
               enCodigo = #0#0;
               eaTipo = "A";
               |HAZ TagloModBlock;
          |SINO;
               |SI nForma = -1;
                    |MENAV "0000La linea pertenece a un block...";
               |FINSI;
               |SI nForma = 1; |Y modo = 1;
                    |MENAV "0000Articulo de familia block...";
               |FINSI;
               |ERROR; |ACABA;
          |FINSI;
     |FINSI;

     |SI nForma = 1; |Y #279#26 = "S"; |Y #0#11 = 0;
          |HAZ LeeParam071;
          |SI #21#30 = "N";
               |CONFI "0000NLinea albaran con tipo IVA=0. 풠ontinuar?";
               |SI FSalida ! 0; |ERROR; |ACABA; |FINSI;
          |FINSI;
     |FINSI;

     |SI modo = 3; |O nForma = 1;
          |HAZ EsGofre;
          |SI FSalida = 0;
               eaSerie = #0#29;
               enCodigo = #0#0;
               enLinea = #0#1;
               enUnidades = #0#5;
               eaCliente = #1#3;
               eaArticulo = #0#2;
               enModo = modo;
               |SUB_EJECUTA_NP "gofrem04";
          |FINSI;
     |FINSI;

     |HAZ EsSematel;
     |SI FSalida = 0;
          |HAZ HistoIMEI;
     |FINSI;

     |HAZ EsSebaLopez;
     |SI FSalida = 0;
          |HAZ SebaLopezHisto;
     |FINSI;

     |SI modo = 3;
          |SI nSwTagloma = 0;
               |HAZ BorTagloMerma71;
          |FINSI;
          |HAZ EsViarsa;
          |SI FSalida = 0;
               |HAZ ViaBajaAlbVta;
          |FINSI;
          |HAZ EsCampoJerez;
          |SI FSalida = 0;
               |HAZ CpjBajaAlbVta;
          |FINSI;
          |HAZ EsSematel;
          |SI FSalida = 0;
               enModo = 3;
               eaArticulo = #0#2;
               eaSerie = #0#29;
               enCodigo = #0#0;
               enLinea = #0#1;
               efFecha = #1#1;
               eaCliente = #1#3;
               eaRepre = #1#6;
               eaAbono = #1#43;
               enAlmacen = #0#3;
               |SUB_EJECUTA_NP "tlfw0002";
          |FINSI;
          |HAZ EsSebaLopez;
          |SI FSalida = 0;
               eaSerie = #0#29;
               enCodigo = #0#0;
               enLinea = #0#1;
               |SUB_EJECUTA_NP "sebalo04;BORRA";
          |FINSI;
          |HAZ EsDobleAmor;
          |SI FSalida = 0;
               eaSerie = #0#29;
               enCodigo = #0#0;
               enLinea = #0#1;
               |SUB_EJECUTA_NP "doblea01;BORRA";
          |FINSI;
          |HAZ EsQDClor;
          |SI FSalida = 0;
               eaSerie = #0#29;
               enCodigo = #0#0;
               enLinea = #0#1;
               |SUB_EJECUTA_NP "qdclor08;BAJA";
               eaTipo = "V";
               eaArticulo = #0#2;
               eaPartida = #0#49;
               |SUB_EJECUTA_NP "qdclor10;BAJA";
          |FINSI;
          |HAZ EsDefelino;
          |SI FSalida = 0;
               |HAZ DefelinoBorra;
          |FINSI;
          |HAZ EsOrts;
          |SI FSalida = 0;
               eaTipo = "A";
               eaSerie = #0#29;
               enCodigo = #0#0;
               enLinea = #0#1;
               |SUB_EJECUTA_NP "ortsm022;BAJA";
          |FINSI;
          |HAZ EsGesisat;
          |SI FSalida = 0;
               |HAZ GesiBorMaqui;
          |FINSI;
     |FINSI;

     |SI modo = 3; |O nForma = 1;
          |HAZ EsExtintor;
          |SI FSalida = 0;
               enModo = modo;
               eaArticulo = #0#2;
               eaSerie = #0#29;
               enCodigo = #0#0;
               enLinea = #0#1;
               enUnidades = #0#5;
               |SUB_EJECUTA_NP "extz0016";
          |FINSI;
     |FINSI;

     |HAZ EsMataMan;
     |SI FSalida = 0;
          |SI modo = 3; |O nForma = 1;
               eaSerie = #0#29;
               enCodigo = #0#0;
               enLinea = #0#1;
               enModo = modo;
               eaArticulo = #0#2;
               enUnidad1 = #0#5;
               enUnidad2 = #0#48;
               |SUB_EJECUTA_NP "matade01";
               #0#5 = enUnidad1;
               #0#48 = enUnidad2;
               |HAZ TotalLin71;
          |FINSI;
     |FINSI;

     |SI #0#9 > 0;
         nerror = 1;
     |SINO;
         nerror = -1;
         #0#9  = -#0#9;
         #0#37 = -#0#37;
     |FINSI;

     imneto  = ((((#0#9  < #1#5) < #1#32) < #1#7)) * nerror;
     imnetoD = ((((#0#37 < #1#5) < #1#32) < #1#7)) * nerror;
     #0#9    = #0#9  * nerror;
     #0#37   = #0#37 * nerror;

     |SI nForma = 1;
          |HAZ EsTecatel;
          |SI FSalida = 0;
               |HAZ CtrlImporte;
               |SI FSalida ! 0; |ERROR; |ACABA; |FINSI;
          |FINSI;
     |FINSI;

     ||-------------------Actualiza Historico, Articulo y Almacen
     enForma = 0 +. 1;
     |HAZ AcumulaAV;

     ||-------------------
     enTipEnvase = 2;
     |HAZ Envase71;

     |SI nSwTagloma = 0; |Y #0#61 = 9; ||  Campo INTERNO marcado con 9
          eaCliente = #1#3;
          eaArticulo = #0#2;
          #0#61 = 9
          enUniTagRes = -(#0#5 * enForma);
          |HAZ TagVentaVario;
     |FINSI;

     #0#14 = enCoste;
     #1#37 = #1#37 + (imneto - enCoste);

     |SI modo = 1; |O modo = 2;
          |HAZ grapre;                  || Graba Precio Cliente/Articulo

     |FINSI;

     |HAZ CalCabAgifa010;

     |SI modo ! 3; |HAZ visual_totales; |FINSI;

     || ACTUALIZA FICHERO DE LOTES...........................................

     sserie = #0#29;
     nnumer = #0#0;
     ffecha = #1#1;
     arti   = #0#2;
     cclien = #1#3;
     unid   = #0#5;
     desc   = #0#4;
     lineaa = #0#1;
     |SI enForma = 1;
          |HAZ act_lotes;
     |SINO;
          |BUCLE borra_lotes;
     |FINSI;

     |HAZ EsQDClor;
     |SI FSalida = 0;
          eaArticulo = #0#2;
          eaSerie = #0#29;
          enCodigo = #0#0;
          enLinea = #0#1;
          |SUB_EJECUTA_NP "qdclor08;ACT";
     |FINSI;

     |SI modo = 3;
          ||컴컴컴컴컴컴컴컴컴컴컴
          |HAZ EsAlbadis;
          |SI FSalida = 0;
               eaDocu = "AV";
               eaSerie = #0#29;
               enCodigo = #0#0;
               enLinea = #0#1;
               |HAZ BseBorraUni;
          |FINSI;

          eaTipo      = "AV";
          eaSerie     = #0#29;
          enCodigo    = #0#0;
          enLinea     = #0#1;
          efFecha     = #1#1;
          eaAbono     = #1#43;
          enTarifa    = #6#39;
          eaArticulo  = #0#2;
          enAlmacen   = #0#3;
          |SUB_EJECUTA_NP "dsz00002;BAJA";
          ||컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
          |SI nSwTagloma = 0;
               eaProg = "agifa010";
               |HAZ BorUniFami;
          |FINSI;
          ||컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
          |HAZ EsGrupoSolar;
          |SI FSalida = 0;
               |HAZ GrSolBorAlb;
          |FINSI;
          ||컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
          aTipoDA = "A"; |HAZ BajaDA;
          ||컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
          |HAZ BorraKit;
          ||컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
          |HAZ EsOrts;
          |SI FSalida = 0;
               eaDocu = "agifa071";
               eaSerie = #0#29;
               enCodigo = #0#0;
               enLinea = #0#1;
               |SUB_EJECUTA_NP "dsz99905;BORRA";
          |FINSI;
          ||컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴Bolsas
          Pos = -1;
          alfa1 = "";    |DBIN alfa1;
          alfa1 = "rt  " + alfa1 + "/mod00013.tab";
          |FABRE alfa1;
          |SI FSalida = 0;
              |FCIERRA FSalida;
              serfot = #0#29;||Relacion Alb.Bolsas;
              numfot = #0#0;
              linfot = #0#1;
              clifot = #1#3;
              artfot = #0#2;
              |SUB_EJECUTA_NP "mod00013";
          |FINSI;
     |FINSI;

     |HAZ EsCompaq;
     |SI FSalida = 0;
          eaSerie = #0#29;
          enCodigo = #0#0;
          enLinea = #0#1;
          eaArti = #0#2;
          enModo = modo;
          enForma = nForma;
          eaCliente = #1#3;
          efFecha = #1#1;
          eaNomCli = #1#4;
          |SUB_EJECUTA_NP "mcomp009;cheq";
     |FINSI;

     |SI nSwTagloma = 0; |HAZ TagLinPost; |FINSI;

     nSwPtec = 0;   || switch para controlar los ptec
                    || creados por Guillen y Albadist/Promociones
     |HAZ EsAlbadis;
     |SI #20#250 ! "N"; |O FSalida = 0;
          |SI nForma = 1;
               ||SI #0#66 > 0;
               |SI #0#66 ! 0;
                    aponer = Asino; |HAZ poncontr;
                    |HAZ CreaLinPromo71;
                    #0#63 = nLin;
                    aponer = Anosi; |HAZ poncontr;
                    |PTEC 809; |PTEC 816; |PTEC 806;
                    nSwPtec = 1;
               |SINO;
                    |HAZ BorraLinPromo71;
               |FINSI;
          |SINO;
               |SI modo = 3; |Y enModoCab10 ! 3;
                    |HAZ BorraLinPromo71;
                    |PTEC 809; |PTEC 808;
                    nSwPtec = 1;
               |FINSI;
          |FINSI;
     |FINSI;

     |HAZ EsGuillen;
     |SI FSalida = 0;
          |SI nForma = 1;
               |HAZ GuiCreaLineas;
          |SINO;
               |SI modo = 3; |Y enModoCab10 ! 3;
                    |HAZ GuiBorraLineas;
               |FINSI;
          |FINSI;
     |FINSI;

     |HAZ EsInforAlba;
     |SI FSalida = 0; |HAZ InforActMatri; |FINSI;

     |HAZ EsGesisat;
     |SI FSalida = 0; |HAZ GesiActMaqui; |FINSI;

     |HAZ EsVigor;
     |SI FSalida = 0;
          nTotUni = nTotUni +. #0#5;
          aAlfa = #0#5;
          #0#5 = nTotUni;
          |PINTA 1003, "Tot.Uni: ";
          |PINTA 1012, #0#5;
          #0#5 = aAlfa;
     |FINSI;

     |SI nSwTaller = 0; |HAZ TallerCanon71; |FINSI;
     |SI nSwAparecida = 0; |HAZ Aparecida71; |FINSI;
     |HAZ EsDesanch;
     |SI FSalida = 0;
          |HAZ ActDesanch71;
          |SI modo = 3;
               eaSerie = #0#29;
               enCodigo = #0#0;
               enLinea = #0#1;
               |SUB_EJECUTA_NP "desan033;BAJA";
          |FINSI;
     |FINSI;

     |HAZ EsInforpor;
     |SI FSalida = 0;
          enForma = nForma;
          |SI #1#43 = "S"; enForma = -enForma; |FINSI;
          |HAZ InfoEnviaWeb;
          enForma = nForma;
     |FINSI;

     |HAZ EsEvaristo;
     |SI FSalida = 0;
          |HAZ EvaGraba;
     |FINSI;

     |HAZ EsChampiEmar;
     |SI FSalida = 0;
          |SI modo = 1; |HAZ ChampiEmarEnv; |FINSI;
          |SI modo = 3; |HAZ ChampiEmarBor; |FINSI;
     |FINSI;

|FPRC;

|PROCESO CreaLinPromo71;
     |DDEF aAlfa; aAlfa = aAlfa + "agifa071";
     |CARGA_DEF aAlfa, referen1@;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |ABRE #referen1@;
     #referen1@#29 = #0#29;
     #referen1@#0 = #0#0;
     #referen1@#1 = #0#63;
     |LEE 000#referen1@.=;
     |SI FSalida = 0;
          nLin = #0#63;
          |SALVA_DATOS #0;
          |SALVA_DATOS #referen1@;
          |REPON_DATOS #0;
          #0#1 = #referen1@#1;
          enForma = -1;
          |HAZ AcumulaAV;
          |REPON_DATOS #0;
     |SINO;
          #referen1@#1 = 999;
          |LEE 000#referen1@.];
          |SI FSalida = 0;
               |LEE 000#referen1@.a;
          |SINO;
               |LEE 000#referen1@.u;
          |FINSI;
          |SI FSalida = 0; |Y #referen1@#29 = #0#29;  |Y #referen1@#0 = #0#0;
               nLin = #referen1@#1 + 1;
          |SINO;
               nLin = 1;
          |FINSI;
          |SI nLin = #0#1; nLin = nLin + 1; |FINSI;
          #referen1@#29 = #0#29;
          #referen1@#0 = #0#0;
          #referen1@#1 = nLin;
          |GRABA 020#referen1@.b;
     |FINSI;
     ||SI #0#66 > 0;
     |SI #0#66 ! 0;
          |SALVA_DATOS #0;
          |REPON_DATOS #referen1@;

          #referen1@#1 = nLin;
          #referen1@#5 = #0#66;
          #referen1@#6 = 0;
          #referen1@#7 = 0;
          #referen1@#8 = 0;
          #referen1@#9 = 0;
          #referen1@#33 = 0;
          #referen1@#36 = 0;
          #referen1@#37 = 0;
          #referen1@#38 = 0;
          #referen1@#39 = 0;
          #referen1@#63 = -1;

          |SALVA_DATOS #0;
          |SALVA_DATOS #referen1@;
          |REPON_DATOS #0;
          #0#1 = #referen1@#1;
          enForma = 1;
          |HAZ AcumulaAV;
          |REPON_DATOS #0;

          |GRABA 020#referen1@.a;
     |SINO;
          |BORRA 020#referen1@.c;
     |FINSI;
     |CIERRA #referen1@;
     |DESCARGA_DEF #referen1@;
|FPRC;

|PROCESO BorraLinPromo71;
     |DDEF aAlfa; aAlfa = aAlfa + "agifa071";
     |CARGA_DEF aAlfa, referen1@;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |ABRE #referen1@;
     #referen1@#29 = #0#29;
     #referen1@#0 = #0#0;
     #referen1@#1 = #0#63;
     |LEE 101#referen1@.=;
     |SI FSalida = 0;
          |SALVA_DATOS #0;
          |SALVA_DATOS #referen1@;
          |REPON_DATOS #0;
          #0#1 = #referen1@#1;
          enForma = -1;
          |HAZ AcumulaAV;
          |REPON_DATOS #0;
          |BORRA 020#referen1@.a;
          |PONCONTROL 23, "SI";
     |FINSI;
     |CIERRA #referen1@;
     |DESCARGA_DEF #referen1@;
|FPRC;

|PROCESO Tipo3_071; |TIPO 3;
     aAlfa = #0#2;
     |SI aAlfa ! ""; |Y DescAmpli = "S";
          aTipoDA = "A"; |HAZ AltaDA;
     |FINSI;

     nModo = (FEntrada/ 100) ! 0;
     |SI nModo = 1;
          |HAZ EsDesanch;
          |SI FSalida = 0;
               |HAZ Desan071;
          |FINSI;
     |FINSI;

     |HAZ EsGestral;
     |SI FSalida = 0;
          |ABRE #24;
          #24#0 = #0#2;
          #24#1 = #0#3;
          #24#2 = #0#49;
          |LEE 000#24=;
          |SI FSalida = 0; |Y #24#22 > 0;
               |CONFI "0000S풦mprimir etiqueta?";
               |SI FSalida = 0;
                    |HAZ ImpreEtiqueta;
               |FINSI;
          |FINSI;
          |CIERRA #24;
     |FINSI;
|FPRC;

|PROCESO pantalla; |TIPO 13;
     |HAZ visual_totales;
|FPRC;

|PROCESO art6alv; |TIPO 6;          || Antes de la Relacion 4 Clave.

     |SI codiBarra = "N"; |ACABA; |FINSI;

     |ABRE #36;
     |SELECT #2#36;
     #36#3 = #0#2;
     |LEE 010#36=;
     |SI FSalida=0; |Y #0#2 ! #36#1;
          #0#2 = #36#1;
          |PINTA #0#2;
          |ABRE #2;
          #2#0 = #0#2;
          |LEE 000#2=;
          |CIERRA #2;
     |FINSI;
     |CIERRA #36;
|FPRC;

|PROCESO nomodifi; |TIPO 0;

     |SI #0#2 = vacio;
          |C_M #0#3,  1, "N";
          |C_M #0#5,  1, "N";
          |SI #1#70 = "B";
            |C_M #0#6,  1, "N";
          |SINO;
            |C_M #0#36,  1, "N";
          |FINSI;
          |C_M #0#8,  1, "N";
          |C_M #0#33,  1, "N";
          |C_M #0#10, 1, "N";
          |C_M #0#11, 1, "N";
          |C_M #0#27, 1, "N";
     |SINO;
          |C_M #0#3,  1, "S";
          |C_M #0#5,  1, "S";
          |SI #1#70 = "B";
            |C_M #0#6,  1, "S";
          |SINO;
            |C_M #0#36,  1, "S";
          |FINSI;
          |C_M #0#8,  1, "S";
          |C_M #0#33, 1, "S";
          |C_M #0#10, 1, "S";
          |C_M #0#11, 1, "S";
          |C_M #0#27, 1, "S";
     |FINSI;
|FPRC;

|RUTINA ClaveBaja;
     #agis0002#30 = "A";
     #agis0002#20 = #agifa071#29;
     #agis0002#17 = #agifa071#0;
     #agis0002#18 = 1;
|FRUT;

|RUTINA ClaveAlta;
     #agis0002#30 = "A";
     #agis0002#20 = #agifa071#29;
     #agis0002#17 = #agifa071#0;
     #agis0002#18 = 99;
|FRUT;

|RUTINA EntregaCuenta;
     |SI nModo ! 4;
          |SI #20#86 ! "N";
               |SI #20#86 = "S";
                    |HAZ a_cta2;
               |FINSI;
          |SINO;
               |MENAV "    Entregas a cuenta desactivadas"; |ERROR;
          |FINSI;
     |SINO;
          |PUSHV 0501 2380;
          |ENTLINEAL #1#agis0002, -4, 4, 22, 1, ClaveBaja, ClaveAlta;
          |POPV;
     |FINSI;
|FRUT;

|PROCESO leeotro; |TIPO 11;
     nModo = (FEntrada / 100) ! 0;
     salida = FSalida;
     |SI salida = 10;     ||F2
          |VARIABLES; {20} aPopup = ""; |FINSI;
          aPopup1 = "-1";  || Si fuera -1 en la posicion
          aPopup2 = 10;
          aPopup3 = "<F3> Extracto Contable";
          aPopup4 = "<F4> Copiar Albaran";
          aPopup5 = "<F5> Doble Stock/Kit";

          |HAZ EsAlbadis;
          |SI FSalida = 0; aPopup5 = "<F5> Uni. Promocion"; |FINSI;
          |HAZ EsSebaLopez;
          |SI FSalida = 0; aPopup5 = "<F5> Envase/Tara"; |FINSI;
          |HAZ EsDobleAmor;
          |SI FSalida = 0; aPopup5 = "<F5> Paquetes"; |FINSI;
          |HAZ EsQDClor;
          |SI FSalida = 0; aPopup5 = "<F5> Boletin Anlisis"; |FINSI;
          |HAZ EsDefelino;
          |SI FSalida = 0; aPopup4 = "<F4> Introduccin por Surtido"; |FINSI;

          aPopup6 = "<F6> Entrega a Cuenta";
          aPopup7 = "<F7> Captura PSION"
          aPopup8 = "<F8> Descripcion Ampliada";

          |HAZ EsMataMan;
          |SI FSalida = 0; aPopup8 = "<F8> Consulta Peso"; |FINSI;

          aPopup9 = "<F9> Con.Trab.";

          |HAZ EsGestral;
          |SI FSalida = 0; aPopup9 = "<F9> Captura Lector"; |FINSI;

          aPopup10 = "<10> Extracto Contable";
          aPopup11 = "<F12> Consulta Cabecera";
          aPopup12 = "<Ctrl+F7> Captura PDA";
          IaPopup = aPopup1  <-;
          |ESPECIFICA "TRACKPOPUP", aPopup;
          nSal = FSalida;
          |SI FSalida = 1; nSal = 11; |FINSI;
          |SI FSalida = 2; nSal = 12; |FINSI;
          |SI FSalida = 3; nSal = 13; |FINSI;
          |SI FSalida = 4; nSal = 14; |FINSI;
          |SI FSalida = 5; nSal = 15; |FINSI;
          |SI FSalida = 6; nSal = 16; |FINSI;
          |SI FSalida = 7; nSal = 17; |FINSI;
          |SI FSalida = 8; nSal = 18; |FINSI;
          |SI FSalida = 9; nSal = 9; |FINSI;
          |SI FSalida = 10; nSal = 25; |FINSI;
          FSalida = nSal;
          |SI FSalida = 0; |ERROR; |ACABA; |FINSI;
          salida = FSalida;
     |FINSI;
     |SI salida = 9;
          |PUSHV 501 2380;
          |PINPA #0#1;
          |PINDA #0#1;
          |PAUSA;
          |POPV;
          |ERROR; |ACABA;
     |FINSI;
     |SI salida = 13;         || F5
          |HAZ EsAlbadis; ||*
          |SI FSalida = 0;
               |SI #0#63 = -1;
                    |MENAV "0000Linea de Promocion";
                    |ERROR; |ACABA;
               |FINSI;
               eaDocu = "AV";
               eaSerie = #0#29;
               enCodigo = #0#0;
               enLinea = #0#1;
               eaArticulo = #0#2;
               eaCli = #1#3;
               enModo = (FEntrada / 100) ! 0;
               enDto = #0#8;
               enPrecio = #0#6;
               enUnid1 = #0#5;
               enUnid2 = #0#66;
               enUnid3 = #0#35;
               Envase = #0#34;
               enImpDtoPromo = #0#64;
               enDtoPrePromo = #0#65;
               eaDivisa = #1#68;
               |SUB_EJECUTA_NP "dsz00080;VER";
               |ERROR; |ACABA;
          |FINSI;
          |HAZ EsOrts;
          |SI FSalida = 0;
               eaDocu = "agifa071";
               eaSerie = #0#29;
               enCodigo = #0#0;
               enLinea = #0#1;
               |SUB_EJECUTA_NP "dsz99905;VER";
          |FINSI;
          |HAZ EsSematel;
          |SI FSalida = 0;
               enModo = 4;
               eaArticulo = #0#2;
               eaSerie = #0#29;
               enCodigo = #0#0;
               enLinea = #0#1;
               efFecha = #1#1;
               eaCliente = #1#3;
               eaRepre = #1#6;
               eaAbono = #1#43;
               enAlmacen = #0#3;
               |SUB_EJECUTA_NP "tlfw0002";
          |FINSI;
          |HAZ EsSebaLopez;
          |SI FSalida = 0;
               eaSerie = #0#29;
               enCodigo = #0#0;
               enLinea = #0#1;
               |SUB_EJECUTA_NP "sebalo04;VER";
          |FINSI;
          |HAZ EsDobleAmor;
          |SI FSalida = 0;
               eaSerie = #0#29;
               enCodigo = #0#0;
               enLinea = #0#1;
               |SUB_EJECUTA_NP "doblea01;VER";
          |FINSI;
          |HAZ EsQDClor;
          |SI FSalida = 0;
               eaSerie = #0#29;
               enCodigo = #0#0;
               enLinea = #0#1;
               eaTipo = "V";
               eaArticulo = #0#2;
               eaPartida = #0#49;
               ||SUB_EJECUTA_NP "qdclor10;VER";
               |SUB_EJECUTA_NP "qdclor10;CON";
          |FINSI;

          |HAZ VerKit;
          |HAZ VerDobleUniV;

          |ERROR; |ACABA;
     |FINSI;

     |SI salida = 14;
          |HAZ EntregaCuenta;
     |FINSI;

     |SI salida = 16;
          |HAZ EsMataMan;
          |SI FSalida = 0
               eaSerie = #0#29;
               enCodigo = #0#0;
               enLinea = #0#1;
               enModo = 4;
               |SUB_EJECUTA_NP "matade01";
               |ERROR;
          |FINSI;
     |FINSI;

     aAlfa = #0#2; |QBF aAlfa;
     |SI salida = 16; |Y aAlfa ! ""; |Y DescAmpli = "S";
          aTipoDA = "A"; |HAZ VerDA;
          |ERROR;
     |FINSI;

     |SI salida = 17;
          |HAZ EsGestral;
          |SI FSalida = 0;
               |SI nModo = 4;
                    |MENAV "0000Opcion no disponible en consulta...";
               |SINO;
                    |HAZ GestralLector;
               |FINSI;
               |ACABA;
          |FINSI;
          |SI #agifa142#132 = "S";     || F9.
               programa = Control % 109;
               sserie = #0#29;
               nnumer = #0#0;
               ffecha = #1#1;
               cclien = #1#3;
               nnombr = #1#4;
               |PUSHV 0501 2380;
               consulta = "S";
               |SUB_EJECUTA_NP "agi00002";
               |POPV;
               salida = 0;
          |FINSI;
     |FINSI;

     |SI salida = 12;
          |HAZ EsDefelino;
          |SI FSalida = 0
               |HAZ DefelinoSurti; |ERROR; |ACABA;
          |FINSI;

          |SI recoge = "N";
               |PUSHV 0400 0479;
               |MENAV "0000Opcion no activada en Parametros Generales";
               |POPV;
               |ERROR;
               |ACABA;
          |FINSI;
          modo = (FEntrada/100) ! 0;
          || compruebo que este en la ultima linea y en modo alta
          LineaD = #0#1;    || Guardo puntero
          LineaD = LineaD +1;      || Porque si estoy en alta la linea en la que
                                   || estoy todavia no esta grabada
          |LEE 001#0];
          |SI FSalida ! 0;|O #0#0 ! #1#0; |O #0#29 ! #1#52;|Y modo = 1;
               LineaD = LineaD -1;
               || Recupero el puntero
               #0#0  = #1#0;    || Albaran
               #0#29 = #1#52;   || Serie
               #0#1  = LineaD;         || Numero de linea
               |LEE 001#0=;
               nerror = 0;
               |HAZ entradatos;
               |SI nerror = 0 ;
                    |HAZ leelineas;
                    |HAZ control2;
                    || Le meto 3 ptec's para cuando cambia de pantalla
                    |PTEC 809;    || Flecha abajo
                    |PTEC 809;    || Flecha abajo
                    |PTEC 809;    || Flecha abajo
               |SINO;
                    |ERROR;
               |FINSI;
          |SINO;
               || Recupero el puntero
               LineaD = LineaD -1;
               #0#0  = #1#0;    || Albaran
               #0#29 = #1#52;   || Serie
               #0#1  = LineaD;  || Numero de linea
               |LEE 001#0=;
               |MENAV "0000Debe estar en la ultima linea";
               |ERROR;
          |FINSI;    || Si #0#1 = 1 ...
          salida = 0;
     |FINSI;         || Si FSalida ...
     |SI salida = 18;
          aAlfa = "dsw00007;" + #1#3;    || Extracto Articulo
          |SUB_EJECUTA_NP aAlfa;
          |ERROR;
     |FINSI;

     |SI salida = 15;   ||F6
          |CONFI mensaje10;
          |SI FSalida = 0;
               |DELINDEX #22;
               programa = "/ds/bin/capser";
               |RSYSTEM programa;              ||Captura Datos Psion
               |HAZ prepaps;
               |PUSHV 1213 2380;
               |SUB_EJECUTA_NP "capsion.run;";
               |HAZ genelin;
               |POPV;
               |PTEC 807;
               |DELINDEX #22;
          |FINSI;
          salida = 0;
     |FINSI;

     |SI salida = 11;   ||F3
          modo = (FEntrada / 100) ! 0;
          |SI modo = 4;
               |ABRE #6;
               #6#0 = #1#3;
               |LEE 001#6=;
               |SI FSalida ! 0; |DDEFECTO #6; |FINSI;
               |CIERRA #6;
          |FINSI;
          |PUSHV 0501 2380;
          ext1 = #6#16;
          |SUB_EJECUTA_NP "caextrap.run";
          |POPV;
          salida = 0;
     |FINSI;
     |SI salida = 25; || Ctrl-F7
          |HAZ CreaTempo;
          eaFichero = Tempo;
          |SUB_EJECUTA_NP "psion066";
          |HAZ BoraTempo;
          |SI enError = 0;
               |DDEF aAlfa; aAlfa = aAlfa + "agifa071";
               |CARGA_DEF aAlfa, referen1@;
               |SI FSalida ! 0; |ACABA; |FINSI;
               |ABRE #referen1@;
               #referen1@#29 = #1#52;
               #referen1@#0 = #1#0;
               #referen1@#1 = 999;
               |LEE 000#referen1@.];
               |SI FSalida = 0;
                    |LEE 000#referen1@.a;
               |SINO;
                    |LEE 000#referen1@.u;
               |FINSI;
               |SI FSalida = 0; |Y #referen1@#29 = #1#52; |Y #referen1@#0 = #1#0;
                    nLin = #referen1@#1 + 1;
               |SINO;
                    nLin = 1;
               |FINSI;
               |CIERRA #referen1@;
               |DESCARGA_DEF #referen1@;

               |DDEF aAlfa; aAlfa = aAlfa + "psion067";
               |CARGA_DEF aAlfa, referen1@;
               |SI FSalida ! 0; |ACABA; |FINSI;
               |NOME_DAT #referen1@#eaFichero#;
               |ABRE #referen1@;
               |LEE 000#referen1@.p;
               |PARA; |SI FSalida = 0; |HACIENDO;
                    #0#29 = #1#52;
                    #0#0 = #1#00;
                    #0#1 = nLin;
                    |GRABA 020#0b;
                    #0#2 = #referen1@#0; ||Arti
                    #0#4 = #referen1@#1; ||Des
                    #0#3 = #referen1@#2; ||Alma
                    #0#5 = #referen1@#3; ||Uni
                    #0#49 = #referen1@#9; ||Parti
                    FEntrada = 100;     ||simula alta
                    |HAZ PrecioArti;
                    |HAZ TotalLin71;
                    |HAZ liacarti;
                    |GRABA 020#0a;
                    |LIBERA #0;
                    nLin = nLin + 1;
                    |LEE 000#referen1@.s;
               |SIGUE;
               |CIERRA #referen1@;
               |DELINDEX #referen1@;
               |DESCARGA_DEF #referen1@;
               |PONCONTROL 23, "SI"
               |PTEC 809;
               |PTEC 808;
          |FINSI;
          |ERROR; |ACABA;
     |FINSI;
     |SI salida = 33; || SHIFT + F5
          |ABRE #2; #2#0 = #0#2; |LEE 020#2=; |CIERRA #2;
          |SI #2#176 = "S";
               eaTipo      = "AV";
               eaSerie     = #0#29;
               enCodigo    = #0#0;
               enLinea     = #0#1;
               efFecha     = #1#1;
               eaArticulo  = #0#2;
               enAlmacen   = #0#3;
               enUnidades  = #0#5;
               enTBruto    = #0#7;
               eaAbono     = #1#43;
               enTarifa    = #6#39;
               eaCliente   = #1#3;
               enCamBas    = #1#69;
               eaMoneda    = #1#70;
               enCamDiv    = #1#74;
               enComision = #0#10;
               |SUB_EJECUTA_NP "dsz00002;CONSU";
          |FINSI;
          |ERROR;
     |FINSI;
|FPRC;

|| Recojo la serie y numero de albaran
|PROCESO entradatos;
         |PINTA 2420 , " Recogida de datos del albaran :      /    ";
         alfa1 = "";
         E_sup = 5;
         E_inf = "";
         alfa1 = 2453 ? 1;
         serie_o = alfa1;
         alfa2 = "";
         E_sup = 6;
         E_inf = "";
         alfa2 = 2459 ? 1;
         albaran_o = alfa2;
         |BLIN 24;

         ||No puedo leer en el que estoy sino se embuclaria
         |SI serie_o = #1#52;|Y albaran_o = #1#0;
             |MENAV "0000ATENCION !!! Esta en este albaran";
             nerror = 1;
         |FINSI;
|FPRC;

|PROCESO control1;
   aponer= Asino;
   |HAZ poncontr;
|FPRC;

|PROCESO control2;
   aponer= Anosi;
   |HAZ poncontr;
|FPRC;

|PROCESO poncontr;
         fiac = Control % A109;
         fiac = fiac + relleno;
         guarda = fiac % A109;
         fiac = Control % A1001;
         Control = Control + fiac;
         Control = Control + relleno;
         Control = Control % A120;
         Control = Control + aponer;
|FPRC;

|PROCESO CreaComponente;
     #905#0 = "AV";
     #905#1 = #0#29;
     #905#2 = #0#0;
     #905#3 = #0#1;
     #905#9 = #905#6;
     |GRABA 020#905n;
     |LIBERA #905;

     enUnidades   = #905#6;
     eaTipo       = "AV";
     eaSerie      = #0#29;
     enCodigo     = #0#0;
     enLinea      = #0#1;
     efFecha      = #1#1;
     eaArticulo   = #0#2;
     enAlmacen    = #0#3;
     eaComponente = #905#4;
     efFecha      = #1#1;
     enCamBas     = #1#69;
     eaMoneda     = #1#70;
     enCamDiv     = #1#74;

     |SUB_EJECUTA_NP "dsz00002;AVC";
|FPRC;

|DEFBUCLE dsm00005;
     #905#1;
     ;
     "AV", serie, albaran, nlinea, "      ";
     "AV", serie, albaran, nlinea, "zzzzzz";
     be;
     NULL, CreaComponente;
|FIN;

|PROCESO crealineasV;
    || Clave primaria
    #0#29= #1#52;    || Serie
    #0#0 = #1#0;     || Numero de Albaran
    #0#1 = LineaD;          || Numero de linea


    |DEFECTO #0#1;   || Cargo los valores de defecto de cab.albaran

    || Procedo a cambiar lo que no es igual
    #0#12 = "";             || Numero de pedido
    || Controles de procedencia, si vienen de pedido, deposito, etc..
    |PARA i = 18;|SI i [ 25;|HACIENDO i = i +1;
       #0i="";
    |SIGUE;
    #0#31 ="";    || Serie pedido
    #0#32 ="";    || Serie deposito


    |HAZ TotalLin71;
    |HAZ liacarti;     || Lo envio al tipo 2 para que calcule lo mismo que si fuera
                       || una linea introducida por el operador
    |GRABA 021#0b;
    |LIBERA #0;

    |BUCLE dsm00005;

    LineaD =LineaD + 1;  || Aumento contador de lineas
|FPRC;

|PROCESO leelineas;
      #0#29= serie_o;
      #0#0 = albaran_o;
      #0#1 = 1;
      |LEE 001#0];
      |SI FSalida = 0;
           |PARA;|SI FSalida = 0;|Y #0#29=serie_o;|Y #0#0=albaran_o;
                                                     |HACIENDO;
                  || Me guardo el puntero
                  serie   = #0#29;   || Serie y albaran actual
                  albaran = #0#0;
                  nlinea  = #0#1;

                  |HAZ crealineasV;

                  || Recupero puntero
                  #0#29 = serie;
                  #0#0  = albaran;
                  #0#1  = nlinea;
                  |LEE 001#0=;

                  |LEE 001#0s;
           |SIGUE;
      |SINO;
           |MENAV "0000Atencion !!! No se ha encontrado el albaran indicado";
           |ERROR;
      |FINSI;

      || Devuelvo el puntero de la linea
      #0#29= #1#52; || Serie
      #0#0 = #1#0;  || Albaran
      #0#1 = LineaD;       || Linea
      |LEE 001#0=;
|FPRC;

|PROCESO leeps;|TIPO 0;
     |SI #1#43 = AN;
        a = -1; b = 1;
        operacion = "AV";
        operainte = "AC"; || Si es una Serie Interna
     |SINO;
        a = 1;  b = -1;
        operacion = "BV";
        operainte = "BC"; || Si es una Serie Interna
     |FINSI;

|FPRC;

|PROCESO leelin;
     |ABRE #2;
     #2#0 = #22#2;
     |LEE 000#2=;
     |CIERRA #2;

     lin = lin + 1;
     |DDEFECTO #0;
     #0#0 = #1#0;
     #0#29 = #1#52;
     #0#1 = lin;
     #0#2 = #22#2;
     #0#3 = 1;
     #0#4 = #22#3;
     #0#5 = #22#4;
     #0#11 = #2#30;

     |HAZ defecli;
     |HAZ mirespor;
     |HAZ TotalLin71;
     |HAZ liacarti;
     |GRABA 121#0c;
     |LIBERA #0;
|FPRC;

|DEFBUCLE leelin;
     #22#1;
     5;
       1 ,    1 , "S";
     999 , 9999 , "S";
     be;
     NULL, leelin;
|FIN;

|PROCESO genelin;
     lin = 0;
     |BUCLE leelin;
|FPRC;

|PROCESO prepaps;          ||Preparacion Lineas Recogidas Del Psion
  lin = 0;
  path = "";
  |DFICE path;
  |QBF path;
  art ="rt  " + path + "ventas";
  |QBF art;
  |FABRE art;
  |SI FSalida < 0;  |ACABA;  |FINSI;
  f1 = FSalida;
  Pos = -1;
  varalfa = "";
  fs = 1;

  |PARA jj = 1; |SI fs ] 0;|HACIENDO jj = jj + 1;
        aux = "";
        varalfa = f1 + " 80";
        |FLEE varalfa;
        |SI FSalida < 0;  |SAL;  |FINSI;
        Pos = -1;
        aux = varalfa % 0104;   ||Numero Venta
        |QBF aux;
        |SI aux ! "    ";|Y aux ! "";
            lin = lin + 1;
            |ABRE #22;
            #22#0 = lin;
            aAlfa = varalfa % 0104;   ||Numero Venta
            #22#1 = aAlfa;
            aAlfa = varalfa % 0613;   ||Codigo articulo
            #22#2 = aAlfa;
            aAlfa = varalfa % 2107;     ||Unidades Venta
            #22#4 = aAlfa;
            |ABRE #2;
            #2#0 = #22#2;
            |LEE 001#2=;
            #22#3 = #2#1;             ||Descripcion
            |CIERRA #2;
            |GRABA 000#22c;
            |LIBERA #22;
            |CIERRA #22;
        |FINSI;
  |SIGUE;
  varalfa = f1;
  |FCIERRA varalfa;
  Pos = -1;
|FPRC;

||---------------------------------------------------------------------------
|| LOTES.      Alejandro 04/02/2000. Se ha a쨅dido lotes por meses
||---------------------------------------------------------------------------

|PROCESO act_lotes; |TIPO 2;
  |ABRET #90;
  |ABRET #91;
  #90#0 = #0#2;
  |LEE 101#90=;
  |SI FSalida = 0;
     |SI lotes = "S"; |Y #1#43 = "N"; |Y #90#9 = "U";
           nlote = #90#2;                     || GUARDA EL N.DE LOTE ACTUAL.
           nn = unid + #90#5;                 || UND.VENDIDAS + UND.ACUMULADAS.
           |SI nn = #90#4;                    || SI UND.ACUMULADAS = LIMITE UND.LOTES.
                |HAZ hist_lotes;
                |HAZ suma_lotes;
                unid = 0;                     || PONE A 0 LA UND.DE LOTE ACTUAL.
           |SINO;
                |SI nn > #90#4;               || SI UND.ACUMULADAS > LIMITE UND.LOTES.
                     nn = nn / #90#4;         || NUMERO DE LOTES.
                     tu = unid;               || GUARDA TOTAL UNIDADES VENDIDAS.
                     unid = #90#4 - #90#5;    || PRIMERAS UNIDADES.
                     nn1 = 0;
                     |PARA ind = 1; |SI ind < nn; |HACIENDO ind = ind + 1;
                           nn1 = nn1 + unid;
                           |HAZ hist_lotes;
                           |HAZ suma_lotes;
                           unid = #90#4;
                     |SIGUE;
                     |SI nn1 < tu;
                           unid = tu - nn1;
                           |HAZ hist_lotes;
                     |FINSI;
                     |SI unid = #90#4; unid = 0; |FINSI;
                |SINO;
                     |HAZ hist_lotes;
                     unid = nn;               || PASO A unid EL TOTAL DE UNIDADES PARA ACTUALIZAR EL FICHERO DE LOTES.
                |FINSI;
           |FINSI;
           #90#2 = nlote;
           #90#5 = unid;
           #90#9 = "U";
           |SI unid = 0;
               |HAZ suma_lotes;
           |FINSI;
           |GRABA 020#90a;
     |FINSI;

     |SI lotes = "S"; |Y #1#43 = "N"; |Y #90#9 = "M";
       aMes = "";
       aAnyo = "";
       fFecha = ~;

       |SI #90#10 = "S";  || en el lote hay mes
         fFecha = #1#1 % 0;    || entrega el mes de la fecha del albaran
         aMes = fFecha % 11; || ahora tomo solo el nombre del mes
         nPosicion = 100 + #90#11;
         aMes = aMes % nPosicion;
       |FINSI;

       |SI #90#13 = "S";
         aAnyo = #1#1 % -104;  || tomo el a쨚 de la fecha del albaran
         nPosicion = -(100 + #90#14);
         aAnyo = aAnyo % nPosicion;
       |FINSI;

       |SI #90#12 = 1; |Y #90#15 = 2;
          |SI #90#17 = "S";
               nlote = aMes + #90#16 + aAnyo;
          |SINO;
               nlote = aMes + aAnyo;
          |FINSI;
       |FINSI;

       |SI #90#12 = 2; |Y #90#15 = 1;
          |SI #90#17 = "S";
               nlote = aAnyo + #90#16 + aMes;
          |SINO;
               nlote = aAnyo + aMes;
          |FINSI;
       |FINSI;

       #90#2 = nlote;
       |GRABA 020#90a;
       |HAZ hist_lotes;
     |FINSI;

  |SINO;
     |SI lotes = "S";
         |ATRI P;
         |MENAV "0000EL ARTICULO INTRODUCIDO NO ESTA DADO DE ALTA EN EL FICHERO DE LOTES";
         |ATRI p;
     |FINSI;
  |FINSI;
  |CIERRAT #90;
  |CIERRAT #91;
|FPRC;

||---------------------------------------------------------------------------
|| ACTUALIZA EL HISTORICO DE LOTES.
||---------------------------------------------------------------------------
|PROCESO hist_lotes; |TIPO 2;
     #91#0 = sserie;
     #91#1 = nnumer;
     #91#8 = lineaa;
     #91#5 = #90#2;      || NUMERO LOTE.
     |LEE 101#91=;
     #91#2 = ffecha;
     #91#3 = arti;
     #91#7 = cclien;
     mod = 0 +. 1;
     |SI FSalida ! 0; |Y mod = 1;
          #91#4 = desc;
          #91#6 = unid;
          |GRABA 020#91n;
     |SINO;
          |SI mod = 1;
               #91#4 = desc;
               #91#6 = unid;
               |GRABA 020#91a;
          |SINO;
               |BUCLE borra_lotes;
          |FINSI;
     |FINSI;
|FPRC;

||---------------------------------------------------------------------------
|| CALCULA EL NUMERO DE LOTE.
||---------------------------------------------------------------------------
|PROCESO Suma;
     IC = C1<-;
     inc = #90#3;                  || INCREMENTO.
     halfa = #90#2; |QBF halfa;    || NUMERO LOTE.
     halfa = halfa % A0;
     longi = halfa;
     halfa = #90#2; |QBF halfa;    || NUMERO LOTE.
     longi = (longi * 100) + 1;
     |PARA hi = longi; |SI hi ] 101; |HACIENDO hi = hi - 100;
          letra = halfa % hi;
          |HAZ HallaPos;
          numero = inc $ hn;
          pos = pos + numero + resto;
          inc = (inc - numero) / hn;
          |SI pos > hn;
               resto = 1;
               pos = pos - hn;
          |SINO;
               resto = 0;
          |FINSI;
          |HAZ Cadena;
          |SI inc = 0;|Y resto = 0;
               hi = hi - 100;
               |SAL;
          |FINSI;
     |SIGUE;
     |PARA; |SI hi ] 101; |HACIENDO hi = hi - 100;
          letra = halfa % hi;
          C = letra;
          IC = IC + 1;
          hn1 = hn1 + 1;
     |SIGUE;
     |SI resto = 1;
          C = M1;
          hn1 = hn1 + 1;
     |FINSI;
     IC = C1<-;
     halfa = "";
     |PARA hi = 1; |SI hi [ hn1; |HACIENDO hi = hi + 1;
          halfa = C + halfa;
          IC = IC + 1;
     |SIGUE;
     #90#2 = halfa;            || NUMERO LOTE.
     nlote = halfa;
|FPRC;

|PROCESO Cadena;
     IM = M1<-;
     IM = IM + pos - 1;
     C = M;
     IC = IC + 1;
     hn1 = hn1 + 1;
|FPRC;

|PROCESO HallaPos;
     IM = M1<-;
     |PARA pos = 1; |SI pos [ hn; |HACIENDO pos = pos + 1;
          |SI letra = M; |ACABA; |FINSI;
          IM = IM + 1;
     |SIGUE;
     |MENAV "0000 La Cadena contiene caracteres extra쨚s !!!";
|FPRC;

|PROCESO suma_lotes; |TIPO 0;
     |SI mod = 1;
          hn = 0;
          hn1 = 0;
          IM = M1<-;
          |SI #90#6 = "S"; |HAZ Numeros; |FINSI;
          |SI #90#7 = "S"; |HAZ Mayus;   |FINSI;
          |SI #90#8 = "S"; |HAZ Minus;   |FINSI;
          |HAZ Suma;
     |FINSI;
|FPRC;

|PROCESO Numeros;
     |PARA hi = 48; |SI hi [ 57; |HACIENDO hi = hi + 1;
          hn = hn + 1;
          M = &hi;
          IM = IM + 1;
     |SIGUE;
|FPRC;

|PROCESO Mayus;
     |PARA hi = 65; |SI hi [ 90; |HACIENDO hi = hi + 1;
          hn = hn + 1;
          M = &hi;
          IM = IM + 1;
     |SIGUE;
|FPRC;

|PROCESO Minus;
     |PARA hi = 97; |SI hi [ 122; |HACIENDO hi = hi + 1;
          hn = hn + 1;
          M = &hi;
          IM = IM + 1;
     |SIGUE;
|FPRC;

|PROCESO Envase71;
     eaArticuloAparecida = #agifa071#2;
     eaClienteAparecida = #agifa010#3;
     efFechaAparecida = #agifa010#1;
     qAbono    = #1#43;
     Envase    = #0#34;
     Unidades1 = #0#35;
     Unidades2 = #0#5;
     VArticulo = #0#2;
     enAlmacen = #0#3;
     eaTipo = "V";
     eaProgEnv = "albaran";
     |HAZ EntraEnvase;

     |HAZ EsChampi;
     |SI FSalida = 0;
          |SI enBultos = 0;
               #0#34 = Envase;
               #0#35 = Unidades1;
               #0#5  = Unidades2;  |PINTA #0#5;
          |FINSI;
     |SINO;    || la estandar
          #0#34 = Envase;
          #0#35 = Unidades1;
          #0#5  = Unidades2;  |PINTA #0#5;
     |FINSI;
|FPRC;

|PROCESO Conversion;  |TIPO 7;
     aAlfa = #0#2; |QBF aAlfa;
     |SI aAlfa = ""; |ACABA; |FINSI;

     nModo = (FEntrada / 100) ! 0;
     |HAZ EsSebaLopez;
     nSwSebaLopez = FSalida;
     |SI FSalida = 0;
          eaSerie = #0#29;
          enCodigo = #0#0;
          enLinea = #0#1;
          eaArticulo = #0#2;
          |SUB_EJECUTA_NP "sebalo04";
          #0#5 = enUnidades; |PINTA #0#5;
          |C_M #0#5, 1, "N";
     |FINSI;

     |HAZ EsChampi;
     |SI FSalida = 0;
          eaTipo = "AV";
          eaSerie = #0#29;
          enCodigo = #0#0;
          enLinea = #0#1;
          eaArticulo = #0#2;
          |SUB_EJECUTA_NP "champ003";
          |HAZ ChampiPinAux;
          |SI enBultos ! 0; #0#5 = enUnidades; |FINSI;
     |FINSI;

     |HAZ EsChampiEmar;
     |SI FSalida = 0;
          eaTipo = "AV";
          eaSerie = #0#29;
          enCodigo = #0#0;
          enLinea = #0#1;
          eaArticulo = #0#2;
          |SI nModo = 1;
               aAlfa = "champi09;" + eaTmpAV816;
               |SUB_EJECUTA_NP aAlfa;
          |SINO;
               |SUB_EJECUTA_NP "champi03";
          |FINSI;
          |HAZ ChampiPinEmar;
          #0#5 = enUnidades;
          |C_M #0#5, 1, "N";
     |FINSI;

     |HAZ EsAlbadis;
     |SI #20#250 = "S"; |O FSalida = 0;
          |HAZ PrecioArti;
          eaDocu = "AV";
          eaSerie = #0#29;
          enCodigo = #0#0;
          enLinea = #0#1;
          eaArticulo = #0#2;
          eaCli = #1#3;
          enModo = (FEntrada / 100) ! 0;
          enDto = #0#8;
          enPrecio = #0#6;
          enUnid1 = #0#5;
          enUnid2 = #0#66;
          enUnid3 = #0#35;
          Envase = #0#34;
          enImpDtoPromo = #0#64;
          enDtoPrePromo = #0#65;
          eaDivisa = #1#68;
          |SUB_EJECUTA_NP "dsz00080";
          |SI enError ! 0; |ERROR; |ACABA; |FINSI;
          #0#8 = enDto;
          #0#6 = enPrecio;
          #0#5 = enUnid1;
          #0#66 = enUnid2;
          #0#35 = enUnid3;
          #0#34 = Envase;
          #0#64 = enImpDtoPromo;
          #0#65 = enDtoPrePromo;
          |SI eaProCliArt = "S"; |C_M #0#5, 1, "N"; |FINSI;
     |FINSI;

     |HAZ EsSematel;
     |SI FSalida = 0;
          enModo = (FEntrada / 100) ! 0;
          eaArticulo = #0#2;
          eaSerie = #0#29;
          enCodigo = #0#0;
          enLinea = #0#1;
          efFecha = #1#1;
          eaCliente = #1#3;
          eaNomCli = #1#29;
          eaRepre = #1#6;
          eaAbono = #1#43;
          enAlmacen = #0#3;
          |SUB_EJECUTA_NP "tlfw0002";
          |SI eaHayIMEI = "S";
               #0#5 = 1; |PINTA #0#5;
               |C_M #0#5, 1, "N";
               |ACABA;
          |FINSI;
     |FINSI;

     nUni2Ant = #0#48;
     |HAZ DobleUniV;
     |SI eaSw2Stock = "S";
          |C_M #0#5, 1, "N";
     |FINSI;

     |SI #20#250 = "X";
          |SI #20#68 = "S";
               |C_M #0#5, 1, "N";
          |SINO;
               |ABRE #134;
               #134#0 = #1#3;
               #134#1 = #0#2;
               |LEE 000#134=;
               |SI FSalida = 0; |C_M #0#5, 1, "N"; |FINSI;
               |CIERRA #134;
          |FINSI;
     |FINSI;

     |HAZ EsGrupoSolar;
     |SI FSalida = 0; |Y eaSw2Stock = "N";
          |HAZ GrSolUniAlb;
     |FINSI;

     |HAZ EsDobleAmor;
     |SI FSalida = 0;
          enUnidades = #0#5;
          eaSerie = #0#29;
          enCodigo = #0#0;
          enLinea = #0#1;
          |SUB_EJECUTA_NP "doblea01";
          #0#5 = enUnidades;
     |FINSI;

     |SI nSwSebaLopez = 0; |ACABA; |FINSI;

     |SI #20#72 = "S";
          |HAZ Envase71;
          |C_M #0#5, 1, "S";
          |SI enEntraEnvase ! 0; |C_M #0#5, 1, "N";  |FINSI;
     |FINSI;
     |HAZ EsQDClor;
     |SI FSalida = 0;
          |HAZ Boletin;
     |FINSI;
|FPRC;

|PROCESO grapre;
     |SI nForma = 1;
          cli_dt = #0#15;
          art_dt = #0#2;
          pvp_ve = #0#6;
          dtos_1 = #0#8;
          aParam = "grapre";
          enDirEnt = #1#84;
          enAlmacen = #0#3;
          enInterno = #0#61;
          eaSerie = #0#29;
          enCodigo = #0#0;
          enLinea = #0#1;
          eaModuloPre = "agifa071";
          |HAZ calcdtos;

          |HAZ EsCongecar;
          |SI FSalida = 0; #0#61 = enInterno;  |FINSI;
     |FINSI;
|FPRC;

|PROCESO unidad1;
     nSal = FSalida;
     |SI #2#176 = "S";
          |SI #1#70 = "D";  || Si la moneda de trabajo es la divisa ...
               #0#36 = nPrecio;
          |SINO;
               #0#6  = nPrecio;
          |FINSI;
          |HAZ EsRocai;
          |SI FSalida = 0; #0#10 = nComiRocai; |PINTA #0#10; |FINSI;
    |FINSI;
    |SI #1#70 = "D";  || Si la moneda de trabajo es la divisa ...
        #0#6 = #0#36 / #1#69 * #1#74;  || ... recalculo en funcion de la divisa
    |SINO;
        #0#36 = #0#6 / #1#74 * #1#69; || .. recalculo en funcion de la moneda base
    |FINSI;
    |HAZ visual_precio; || Visualiza el precio
    FSalida = nSal;
|FPRC;

|PROCESO precio_divisa;
   #0#36 = #0#6 / #1#74 * #1#69;  || Calculo el precio en divisa
   |HAZ unidad1;
|FPRC;

|PROCESO visual_precio; || Pinta el precio visual.
|SI #1#70 = "D";  || Si la moneda de trabajo es la divisa ...
  #0#38 = #0#6;   || ... el campo visualiz. es el precio en moneda base
  |PINTA #0#36;
|SINO;            || Si la moneda de trabajo es la moneda base ...
  #0#38 = #0#36;  || ... el campo visual. es el precio en divisa
  |PINTA #0#6;
|FINSI;
|SI ac_divisa = "S"; |Y #agifa321#3= "S";
  |PINTA #0#38; || Si las divisas y la visualizacion estan activadas, pinto
|FINSI;
|FPRC;

|PROCESO visual_totales;
     |ABRE #agifa321;
     |LEE 000#agifa321.p;
     |CIERRA #agifa321;

     |SI #1#70 = "D";
          |SI ac_divisa = "S"; |Y #agifa321#3= "S";
               |PINTA 1149,#1#79;
               |PINTA 1167,"       ";
               |PINTA 1167,#1#80;
          |FINSI;
          |PINTA 1353,#1#75;
          |PINTA 1367,#1#76;
     |SINO;
          |SI ac_divisa = "S"; |Y #agifa321#3= "S";
               |PINTA 1149,#1#75;
               |PINTA 1167,"       ";
               |PINTA 1167,#1#76;
          |FINSI;
          |PINTA 1353,#1#15;
          |PINTA 1367,#1#67;
     |FINSI;
|FPRC;

|PROCESO Promart;
     |HAZ EsAlbadis;
     |SI FSalida = 0;
          articulo = #0#2;
          |ACABA;
     |FINSI;

     |SI #20#250 ! "N"; |Y eaProCliArt = "S";
          articulo = #0#2;
          |ACABA;
     |FINSI;

     |SI nTecla = 16;
          eaArticulo = #0#2;
          eaGrupo = #6#158;
          enAlmacen = #0#3;
          eaCliente = #1#3;
          |HAZ PintaPromo;
          |ENCAMPO #5#0;
     |FINSI;

     enPromo = 1;
     |HAZ PrecioArti;
     enPromo = 0;
     ||컴컴컴컴컴컴컴컴컴컴컴컴컴
     articulo = #0#2;
|FPRC;

|PROCESO equiv;
     |SI #agifa142#218 = "S";
          eaArticulo = #0#2;
          enAlmacen = #0#3;
          |SUB_EJECUTA_NP "agifa294.tab;aTempo294";
          |SI enAlmacen = 0;
               |ERROR;
          |SINO;
               #0#2 = eaArticulo; |PINTA #0#2;
               #0#3 = enAlmacen; |PINTA #0#3;
               |ABRE #2;
               #2#0 = #0#2;
               |LEE 000#2=;
               |CIERRA #2;
               #0#4 = #2#1;
               |PINTA #0#4;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO CogeValores71;  |TIPO 7;
     |SI Campo = 5;
          |HAZ EsAparecida;
          |SI FSalida = 0;
               aAlfa = "0000<F4>Saldo Art./Cliente <F5>Envases <F6>Equivalentes <F8>Consulta Promociones";
               |MENSA aAlfa;
          |SINO;
               aAlfa = "0000<F5> Envases    <F6> Equivalentes   <F8> Consulta Promociones";
               |MENSA aAlfa;
          |FINSI;
     |FINSI;
     |SI Campo = 6;
          |HAZ EsTagloma;
          |SI FSalida = 0;
               aAlfa = "0000<F4> Imp.Total  <F6> Cons. Precios <F7> Cal.Prec.s/VA  <F9>Cal.Postform.";
          |SINO;
               aAlfa = "0000<F4> Importe Total,  <F6> Consulta Precios,  <F7> Calculo Precio Sin Iva";
          |FINSI;
          |MENSA aAlfa;
     |FINSI;

     |ABRE #20;
     |LEE 001#20p;
     |SI FSalida ! 0; |DDEFECTO #20; |FINSI;
     |CIERRA #20;

     aAlfa = #0#2; |QBF aAlfa;

     |SI Campo = 3; |Y aAlfa ! "";
         |C_M #0Campo, 1, "S";
         |SI #20#99 = "S";
             |C_M #0Campo, 1, "N";
             #0Campo = 1;  |PINTA #0Campo;
         |FINSI;
     |FINSI;

     |SI #2#176 = "N";  |ACABA;  |FINSI;

     |SI Campo = 3;
         |SI enAlmacen ! 0;
             #0#3 = enAlmacen;  |PINTA #0#3;
         |FINSI;
     |FINSI;

     |SI Campo = 5;
          |SI #2#176 = "S";
               |SI #0#5 ! enUnidades;  Contenido = #0#5;  |FINSI;
               #0#5 = enUnidades;  |PINTA #0#5;
          |FINSI;
     |FINSI;

     |SI Campo = 6;
         |SI nPrecio ! 0;
             #0#6 = nPrecio;  |PINTA #0#6;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO PideArt71;  |TIPO 7;
     nModo = (FEntrada / 100) ! 0;
     |SI #20#140 = "S"; |Y nModo = 1; #0#2 = eaArtAnt; |FINSI;

     aAlfa = "0000<F4> Modificar articulo";
     |HAZ EsTagloma;
     |SI FSalida = 0;
          aAlfa = "0000<F5> Consulta articulos pendientes  <F6> Modificacion unidades pendientes";
     |FINSI;
     |HAZ EsForestales;
     |SI FSalida = 0;
          aAlfa = "0000<F3> Buscar articulo  <F4> Modificar articulo";
     |FINSI;
     |MENSA aAlfa;

     |C_M #0#2, 1, "S";
     |C_M #0#3, 1, "N";

     |SI #0#2 ! "                    ";
         |ABRE #2;
         #2#0 = #0#2;
         |LEE 000#2=;
         |SI FSalida ! 0;  |DDEFECTO #2;  |FINSI;
         |CIERRA #2;
         |SI #2#176 = "S";
             |C_M #0#2, 1, "N";
             |C_M #0#3, 1, "N";
             |ACABA;
         |FINSI;
     |FINSI;

     |ABRE #910;
     |LEE 040#910p;
     |SI FSalida ! 0;  |DDEFECTO #910;  |FINSI;
     |CIERRA #910;

     |SI #910#2 [ 2;    |ACABA;  |FINSI;

     eAlfa = #0Campo;
     |SUB_EJECUTA_NP "dsz99990";                 || Por Pantalla

     |SI eAlfa = "-1";  |PTEC 807;  |ACABA;  |FINSI;
     |SI eAlfa = "-2";              |ACABA;  |FINSI;

     eaArticulo = eAlfa;      ||  700000-4215

     #0Campo = eAlfa;
     |PINTA #0Campo;
     |PTEC 802;
|FPRC;

|PROCESO Calc671;  |TIPO 6;
     nTecla = FSalida;
     eaArtAnt = #0#2;
     modo = (FEntrada / 100) ! 0;
     |SI modo = 1;
          #0#3 = def_alm;
          |PINTA #0#3;
     |FINSI;

     |HAZ EsCoimasa;
     |SI FSalida = 0;
          eaArtCoimasa = #agifa071#2;
          eaCliCoimasa = #agifa010#3;
          eaRepCoimasa = #agifa010#6;
          |HAZ CtrlRepCoimasa;
     |FINSI;

     |HAZ EsTecatel;
     |SI FSalida = 0;
          aAlfa = #0#2; |QBF aAlfa;
          aAlfa = aAlfa > "";
          |SI aAlfa = "FIN"; |ERROR; |PTEC 807; |PTEC 807; |ACABA; |FINSI;
     |FINSI;

     |SI nTecla = 11;   ||F3
          |HAZ EsForestales;
          |SI FSalida = 0;
               |SUB_EJECUTA_NP "goma0008";
               |SI eaArticulo ! "";
                    #0Campo = eaArticulo;
                    |PINTA #0Campo;
               |SINO;
                    |ERROR; |ACABA;
               |FINSI;
          |FINSI;
     |FINSI;

     |SI nTecla = 12; ||F4;
          aAlfa = "dsz99895;" + #0#2;
          |SUB_EJECUTA_NP aAlfa;
          |ERROR; |ACABA;
     |FINSI;

     |SI nTecla = 13; || F5
          |HAZ EsTagloma;
          |SI FSalida = 0;
               eaCliente = #1#3;
               eaArticulo = #0#2;
               |HAZ TagCogeArt;
               |SI FSalida = 0;
                    #0#2 = eaArticulo; |PINTA #0#2;
                    #0#5 = enUnidades; |PINTA #0#5;
                    #0#61 = 9; ||| Marco campo INTERNO con 9 !!!
               |SINO;
                    |ERROR; |ACABA;
               |FINSI;
          |FINSI;
     |FINSI;
     |SI nTecla = 14; || F6
          |HAZ EsTagloma;
          |SI FSalida = 0;
               eaCliente = #1#3;
               eaArticulo = #0#2;
               |SUB_EJECUTA_NP "tagz0007";
               |ERROR; |ACABA;
          |FINSI;
     |FINSI;

     |SI #0Campo ! Contenido; |Y Campo = 2;
          |HAZ EsTagloma;
          |SI FSalida = 0;    || Quita el F9 del postformado
               nTagQuitaPost = 1;
          |FINSI;
          eaArticulo = #0#2;
          eaCliente = #1#3;
          |HAZ DefectoMediV;
          #0#51 = enMedida1;
          #0#52 = enMedida2;
          #0#53 = enMedida3;
          |HAZ PintaMedidaV;
     |FINSI;
     |HAZ DobleArtiV;
     |SI eaSw2Stock = "S"; |ACABA; |FINSI;

     enAlta = 1;
     eaArticulo = #0Campo;
     |HAZ LlenaArticulo;
     |SI FSalida = 0;
          #0Campo = eaArticulo;
          |PINTA #0Campo;
     |SINO;
          |ERROR; |ACABA;
     |FINSI;

     |SI modo = 1; |HAZ equiv;  |FINSI;

     |ABRE #2;
     #2#0 = #0#2;
     |LEE 000#2=;
     |SI FSalida ! 0;  |DDEFECTO #2;  |FINSI;
     |CIERRA #2;

     |SI #2#126 = "VAR"; || Articulos varios
          |HAZ EsTagloma;
          |SI FSalida = 0; |Y #0#61 ! 9; || Marca de articulos varios
               |HAZ TagloAvisaEr73;
          |FINSI;
     |FINSI;

     |SI #2#176 = "S";
          eaTipo      = "AV";
          eaSerie     = #0#29;
          enCodigo    = #0#0;
          enLinea     = #0#1;
          efFecha     = #1#1;
          eaArticulo  = #0#2;
          enAlmacen   = #0#3;
          enUnidades  = #0#5;
          enTBruto    = #0#7;
          eaAbono     = #1#43;
          enTarifa    = #6#39;
          eaCliente   = #1#3;
          enCamBas    = #1#69;
          eaMoneda    = #1#70;
          enCamDiv    = #1#74;

          |HAZ EsRocai; |SI FSalida = 0; |HAZ CalComision; |FINSI;
          enComision = #0#10;

          |SUB_EJECUTA_NP "dsz00002";

          nComiRocai = enComision;

          #0#3    = enAlmacen;
          nPrecio = enTBruto / enUnidades;

          |PTEC 802;
          |PTEC 802;
          |PTEC 802;
          |PTEC 802;
     |FINSI;

     |HAZ art6alv;
     |HAZ nomodifi;

     |HAZ EsTecatel;
     |SI FSalida = 0; |Y PARAMETRO = "agrupa";
          |ABRE #2;
          #2#0 = #0#2;
          |LEE 000#2=;
          |SI FSalida ! 0;
               |MENAV "0000Codigo Inexistente....";
               |ERROR; |ACABA;
          |FINSI;
          |CIERRA #2;
          nModo = (FEntrada/100) ! 0;
          |SI #2#125 ! "NS";
               |SI nModo = 1;
                    #0#5 = 1;
                    |PTEC 802;
                    |PTEC 815;
               |FINSI;
          |SINO;
               |SI nModo = 1;
                    eaSerie = #0#29;
                    enCodigo = #0#0;
                    enLinea = #0#1;
                    eaArticulo = #0#2;
                    aTipoDA = "A";
                    |SUB_EJECUTA_NP "dsw00054";
                    #0#5 = 1;
                    |PTEC 802;
                    |PTEC 815;
               |SINO;
                    enFuerzaDA = 1;
                    aTipoDA = "A"; |HAZ AltaDA;
                    enFuerzaDA = 0;
               |FINSI;
          |FINSI;
     |FINSI;

     |ABRE #2;
     #2#0 = #0#2;
     |LEE 000#2=;
     |SI FSalida ! 0;
          aAlfa = "dsz99895;" + #0#2;
          |SUB_EJECUTA_NP aAlfa;        ||Alta Articulo
          |ERROR;
     |FINSI;
     |CIERRA #2;
|FPRC;

|PROCESO Alma71_6; |TIPO 6;
     |ABRE #8;
     #8#0 = #0#2;
     #8#1 = #0#3;
     |LEE 000#8=;
     |SI FSalida ! 0;
          aAlfa = "dsz99894;" + #0#2 + (("00000" + #0#3) % -105);
          |SUB_EJECUTA_NP aAlfa;        ||Alta Almacen
     |FINSI;
     |CIERRA #8;
|FPRC;

|PROCESO Tipo11071;  |TIPO 11;
     salida = FSalida;
     |SI FSalida = 7;
         |SI #2#176 = "S";
               |MENAV "      Imposible abortar;  Termine de introducir la linea y efectue una Baja.";
               |ERROR;
         |FINSI;
         |HAZ EsSematel;
         |SI FSalida = 0;
               |MENAV "      Imposible abortar;  Termine de introducir la linea y efectue una Baja.";
               |ERROR;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO verpre2;
     |ABRE #9;
     |SELECT #3#9;
     #9#10 = #1#3;  || Cliente.
     #9#0  = #0#2;  || Articulo.
     #9#1  = "31.12.2300";  || Fecha.
     #9#2  = "AV";  || Operacion.
     prevul = 0;
     |LEE 000#9];
     |SI FSalida = 0;
          |LEE 000#9a;
     |SINO;
          |LEE 000#9u;
     |FINSI;
     |SI FSalida = 0; |Y #9#10 = #1#3; |Y #9#0 = #0#2; |Y #9#2 = "AV";
          prevul = #9#9 / #1#74 * #1#69;  || Calculo el importe en divisas
          |SI #1#70 = "D";                     || Si la moneda de trabajo es la divisa ...
               prevul = prevul ! nDeci_PreDiv;
          |SINO;                               || Si la moneda de trabajo es la moneda base ...
               prevul = prevul ! nDeci_PreBase;
          |FINSI;
     |FINSI;
     |CIERRA #9;
|FPRC;

|PROCESO MinAlma71;
     #8#0 = #0#2;
     #8#1 = 1;
|FPRC;

|PROCESO MaxAlma71;
     #8#0 = #0#2;
     #8#1 = 99999;
|FPRC;

|PROCESO cierre; |TIPO 0;
     |SI FSalida = 13; || F5;
          |ABRE #8;
          #8#0 = #0#2;
          #8#1 = #0#3;
          |LEE 000#8];
          |CONSULTA_F_CLAVE #1#8, MinAlma71, MaxAlma71;
          |SI FSalida = 0;
               #0#3 = #8#1; |PINTA #0#3;
          |SINO;
               |ERROR; |ACABA;
          |FINSI;
          |CIERRA #8;
     |FINSI;

     efFec = #1#1;
     enAlma = #0#3;
     |HAZ MiraHisL;
     |SI enErrHis ! 0;
          |ERROR;
          |SI #20#99 = "S";
               |PTEC 807; |ACABA;
          |FINSI;
     |FINSI;

|FPRC;

|PROCESO Tipo5_071;  |TIPO 5;
     nModo = (FEntrada / 100) ! 0;

     aAlfa = #1#55; |QBF aAlfa;
     |SI aAlfa = ""; |Y nModo ! 4;
          |HAZ EsJamaica;
          |SI FSalida = 0;
               eaCliente = #1#3;
               |SUB_EJECUTA_NP "cafe0026;EMPRSAT";
               |SI enError = 2;
                    |MENAV "0000Debe de indicar la maquina de reparacin...";
                    |PTEC 807;
                    |ERROR;
               |FINSI;
               |SI enError = 1;
                    |MENAV "0000Debe de dar de alta el Cliente/Mquina en la aplicacin Control Depsitos...";
               |FINSI;
          |FINSI;
     |FINSI;

     nGuarda = enErr;
     enErr   = 0;
     |SI nModo = 2; |HAZ ModCliEntre; |FINSI;
     |SI nModo ! 4; |HAZ actal; |FINSI;
     enErr   = nGuarda;
|FPRC;


|PROCESO Dto071; |TIPO 0;
     |HAZ licomis;
     |HAZ TotalLin71;
     ||컴컴컴컴컴컴컴컴컴
     |HAZ EsTecatel;
     |SI FSalida = 0;
          art_dt = #0#2;
          dtos_1 = #0#8;
          dtos_2 = #0#33;
          |HAZ TecaCheqFijo;
          |SI FSalida ! 0; |ERROR; |FINSI;
          |SI Campo = 33;
               |HAZ CtrlImporte;
               |SI FSalida ! 0; |ERROR; |ACABA; |FINSI;
          |FINSI;
     |FINSI;
     ||컴컴컴컴컴컴컴컴컴
     eaArticulo = #0#2;
     enPrecio = #0#6;
     enDto1 = #0#8;
     enDto2 = #0#33;
     |HAZ CheqPCM_PVP;

     |SI #279#3 = "S";
          eaArticulo = #0#2;
          enPrecio = #0#6;
          enDto1 = #0#8;
          enDto2 = #0#33;
          nNume =  (enPrecio < enDto1) < enDto2;
          |SI nNume ! nPreDtoAnt;
               |SUB_EJECUTA_NP "dsz00100";
               |SI enError ! 0; |ERROR; |ACABA; |FINSI;
               nPreDtoAnt = nNume;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Equivalentes;
     articulo = #0#2;
     eaArticulo = #0#2;
     enAlmacen = #0#3;
     |SUB_EJECUTA_NP "agifa294";
     #0#2 = eaArticulo; |PINTA #0#2;
     #0#3 = enAlmacen; |PINTA #0#3;
     |ABRE #2;
     #2#0 = #0#2;
     |LEE 000#2=;
     |CIERRA #2;
     #0#4 = #2#1;
     #0#13 = #2#2;
     |PINTA #0#4;
     |SI articulo ! #0#2; |HAZ PrecioArti; |FINSI;
     |SI enSalida ! 0; |Y eaAuto = "N"; |ERROR; |FINSI;
|FPRC;

|PROCESO Descri071; |TIPO 6;
     |SI FSalida = 14;             ||F6
          eaAuto = "N";
          |HAZ Equivalentes;
     |FINSI;
     |HAZ PintaDes71;
|FPRC;

|PROCESO MinC071;
     #referen1@#29 = #1#52;
     #referen1@#0 = #1#0;
     #referen1@#1 = 001;
|FPRC;

|PROCESO MaxC071;
     #referen1@#29 = #1#52;
     #referen1@#0 = #1#0;
     #referen1@#1 = 999;
|FPRC;

|PROCESO Consulta071; |TIPO 66;
     nLin = 0;
     |DDEF aAlfa;
     aAlfa = aAlfa + "agifa071";
     |CARGA_DEF aAlfa, referen1@;
     |SI FSalida = 0;
          |ABRE #referen1@;
          |CONSULTA_F_CLAVE #1#referen1@, MinC071, MaxC071;
          |SI FSalida = 0; nLin = #referen1@#1; |FINSI;
          |CIERRA #referen1@;
          |DESCARGA_DEF #referen1@;
     |FINSI;
     |SI nLin ! 0;
          |PTEC 802;
          aAlfa = ("000" + nLin) % -103;
          aPtec = aAlfa % 301; nPtec = &aPtec;
          |PTEC nPtec;
          aPtec = aAlfa % 201; nPtec = &aPtec;
          |PTEC nPtec;
          aPtec = aAlfa % 101; nPtec = &aPtec;
          |PTEC nPtec;
     |FINSI;
|FPRC;

|PROCESO CtrlImporte; || modulo 000323 (tecatel)
     enTiva = #0#11;
     efFiva = #1#1;
     |HAZ SacaIVA;
     nTotal = #0#9 * enIva / 100; ||iva
     eaCliente = #1#3;
     |HAZ TecaMaxImpo;
     nTotal = #1#67 + #0#9 + nTotal;
     |SI nTotal > enMaxImpo; |Y enMaxImpo ! -1;
          |MENAV "0000EXCEDIDO IMPORTE DE VENTA";
          FSalida = 1;
     |SINO;
          FSalida = 0;
     |FINSI;
|FPRC;

|PROCESO TotalImp7_71; |TIPO 7;
     |HAZ EsViarsa;
     |SI FSalida = 0;
          |HAZ ViaModiAlbVta;
     |FINSI;
     |HAZ EsCampoJerez;
     |SI FSalida = 0;
          |HAZ CpjModiAlbVta;
     |FINSI;
|FPRC;

|PROCESO Alma71_66; |TIPO 66;
     |ABRE #29;
     #29#0 = #0#3;
     |LEE 000#29];
     |CONSULTA_CLAVE #1#29;
     |SI FSalida = 0;
          #0#3 = #29#0;
          |PINTA #0#3;
     |SINO;
          |ERROR;
     |FINSI;
     |CIERRA #29;
|FPRC;

|PROCESO TagloAvisaEr73;
     |DDEF aAlfa;
     aAlfa = aAlfa + "tagm0021";
     |CARGA_DEF aAlfa, referen1@;
     |SI FSalida = 0;
          |ABRE #referen1@;
          |SELECT #3#referen1@;
          #referen1@#2 = #0#2;
          |SI FSalida = 0; |Y #referen1@#12 = 0;
               |MENAV "0000Si introduce este tipo de artculos manualmente provocar fallos en el stock";
          |FINSI;
          |DESCARGA_DEF #referen1@;
     |FINSI;
|FPRC;

----------------------TAGLOMA POSTFORMADOS--------------------------------
|PROCESO TagEsLinPost;
     nSali = 1; || No es
     |DDEF aAlfa;
     aAlfa = aAlfa + "tagm0056";
     |CARGA_DEF aAlfa, tagm0056@;
     |SI FSalida = 0;
          |ABRE #tagm0056@;
          |SELECT #2#tagm0056@;
          #tagm0056@#0 = "AV";
          #tagm0056@#1 = #0#29;
          #tagm0056@#2 = #0#0;
          #tagm0056@#5 = #0#1;
          |LEE 000#tagm0056@.=;
          nSali = FSalida;
          |CIERRA #tagm0056@;
          |DESCARGA_DEF #tagm0056@;
     |FINSI;
     FSalida = nSali;
|FPRC;

|PROCESO TagLinPost;
     nSali = 1; || No es
     |DDEF aAlfa;
     aAlfa = aAlfa + "tagm0056";
     |CARGA_DEF aAlfa, tagm0056@;
     |SI FSalida = 0;
          |ABRE #tagm0056@;
          #tagm0056@#0 = "AV";
          #tagm0056@#1 = #0#29;
          #tagm0056@#2 = #0#0;
          #tagm0056@#3 = #0#1;
          |LEE 101#tagm0056@.=;
          nSali = FSalida;

          |SI nForma = 1;
               |SI nSali = 0;
                    aponer = Asino; |HAZ poncontr;
                    |SI nTagQuitaPost = 1;   || Cambia de articulo
                              |Y enTagEligePost = 0; ||y no elige otro incr.
                         |HAZ TagBorraLinPost;
                         |BORRA 040#tagm0056@.c;
                    |SINO;
                         |HAZ TagCreaLinPost;
                         #tagm0056@#5 = nLin;
                         |GRABA 020#tagm0056@.a;
                    |FINSI;
                    aponer = Anosi; |HAZ poncontr;
                    |PTEC 809; |PTEC 816; |PTEC 806;
                    |||PTEC 809; |PTEC 808;
               |SINO;
                    || enTagLinBorra la carga el tagm0058
                    ||
                    #tagm0056@#5 = enTagLinBorra;
                    |HAZ TagBorraLinPost;
                    |SI nTagBorLinPost = 0;
                         |PONCONTROL 23, "SI";
                    |FINSI;
               |FINSI;
          |SINO;
               |SI modo = 3; |Y enModoCab10 ! 3;
                    |HAZ TagBorraLinPost;
                    |SI nTagBorLinPost = 0;
                         |BORRA 040#tagm0056@.c;
                         |PONCONTROL 23, "SI";
                         |PTEC 809; |PTEC 808; |PTEC 808;
                    |FINSI;
               |FINSI;
               |SI modo = 3; |Y enModoCab10 = 3;
                    |BORRA 040#tagm0056@.c;
               |FINSI;
          |FINSI;

          |CIERRA #tagm0056@;
          |DESCARGA_DEF #tagm0056@;
     |FINSI;
     nTagQuitaPost = 0;
     enTagEligePost = 0;
|FPRC;

|PROCESO TagPreDesPost;
     nTagPre = 0;
     aTagDes = "";
     |DDEF aAlfa;
     aAlfa = aAlfa + "tagm0055";
     |CARGA_DEF aAlfa, referen3@;
     |SI FSalida = 0;
          |ABRE #referen3@;
          #referen3@#0 = #tagm0056@#4;
          |LEE 000#referen3@.=;
          |SI FSalida = 0;
               aTagDes = #referen3@#1;
               nTagPre = #referen3@#2;
               aTagArt = #referen3@#4;
          |FINSI;
          |CIERRA #referen3@;
          |DESCARGA_DEF #referen3@;
     |FINSI;
|FPRC;

|PROCESO AcuAlbaran;
     |HAZ CalCabAgifa010_2;
     |HAZ visual_totales;
|FPRC;

|PROCESO TagCreaLinPost;
     |DDEF aAlfa; aAlfa = aAlfa + "agifa071";
     |CARGA_DEF aAlfa, referen1@;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |ABRE #referen1@;
     #referen1@#29 = #0#29;
     #referen1@#0 = #0#0;
     #referen1@#1 = #tagm0056@#5;
     |LEE 000#referen1@.=;
     |SI FSalida = 0;
          nLin = #tagm0056@#5;
          |SALVA_DATOS #0;
          |SALVA_DATOS #referen1@;
          |REPON_DATOS #0;
          enForma = -1;
          |HAZ AcumulaAV;
          |HAZ AcuAlbaran;
          |REPON_DATOS #0;
     |SINO;
          #referen1@#1 = 999;
          |LEE 000#referen1@.];
          |SI FSalida = 0;
               |LEE 000#referen1@.a;
          |SINO;
               |LEE 000#referen1@.u;
          |FINSI;
          |SI FSalida = 0; |Y #referen1@#29 = #0#29;  |Y #referen1@#0 = #0#0;
               nLin = #referen1@#1 + 1;
          |SINO;
               nLin = 1;
          |FINSI;
          |SI nLin [ #0#1; nLin = #0#1 + 1; |FINSI;
          |DDEFECTO #referen1@;
          #referen1@#29 = #0#29;
          #referen1@#0 = #0#0;
          #referen1@#1 = nLin;
          |GRABA 020#referen1@.b;
     |FINSI;

     |HAZ TagPreDesPost;
     #referen1@#2 = aTagArt;
     #referen1@#3 = 1;
     #referen1@#4 = aTagDes;
     #referen1@#5 = #0#5;
     #referen1@#6 = nTagPre;
     #referen1@#8 = #0#8;
     #referen1@#10 = #0#10;
     #referen1@#11 = #0#11;

     |ABRE #2;
     #2#0 = #referen1@#2;
     |LEE 020#2=;
     |CIERRA #2;
     #referen1@#13 = #2#2;

     #referen1@#15 = #0#15;
     #referen1@#16 = #0#16;
     #referen1@#17 = #0#17;
     #referen1@#33 = #0#33;
     #referen1@#36 = nTagPre;
     |SALVA_DATOS #0;

     |SALVA_DATOS #referen1@;
     |REPON_DATOS #0;
     enForma = 1;
     |HAZ AcumulaAV;
     |HAZ TotalLin71;
     |HAZ AcuAlbaran;
     |SALVA_DATOS #0;
     |REPON_DATOS #referen1@;
     |GRABA 020#referen1@.a;

     |REPON_DATOS #0;

     |CIERRA #referen1@;
     |DESCARGA_DEF #referen1@;
||     |PONCONTROL 23, "SI";
|FPRC;

|PROCESO TagBorraLinPost;
     |DDEF aAlfa; aAlfa = aAlfa + "agifa071";
     |CARGA_DEF aAlfa, referen1@;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |ABRE #referen1@;
     #referen1@#29 = #0#29;
     #referen1@#0 = #0#0;
     #referen1@#1 = #tagm0056@#5;
     |LEE 101#referen1@.=;
     nTagBorLinPost = FSalida;
     |SI FSalida = 0;
          |SALVA_DATOS #0;
          |SALVA_DATOS #referen1@;
          |REPON_DATOS #0;

          enForma = -1;
          |HAZ AcumulaAV;
          |HAZ AcuAlbaran;
          |REPON_DATOS #0;
          |BORRA 020#referen1@.a;
||          |PONCONTROL 23, "SI";
     |FINSI;
     |CIERRA #referen1@;
     |DESCARGA_DEF #referen1@;
|FPRC;
--------------------------------------------------------------------------
|PROCESO TagloAvisaStock;
     |ABRE #238;
     #238#0 = #2#201;
     |LEE 000#238=;
     |SI FSalida = 0; |Y #238#8 ! 0; |Y #238#13 ! 0;
          nMts = #0#48;
          |SI nMts  < 0; nMul = 1; |SINO; nMul = 1; |FINSI;
          nMts = nMts * nMul;
          nMts = nMts / #238#13;
          nEntero = nMts ! 0;
          |SI nEntero > nMts;
               nMts = nEntero - 1;
          |SINO;
               nMts = nEntero;
          |FINSI;
          |SI #8#39 < nMts;
               aAlfa = "0000Supera el Stock disponible: " + #8#39;
               |MENAV aAlfa;
               |SI avisa_st = "X"; |ERROR;   |FINSI;
          |FINSI;
     |SINO;
          |SI #8#39 < #0#5;
               aAlfa = "0000Supera el Stock disponible: " + #8#39;
               |MENAV aAlfa;
               |SI avisa_st = "X"; |ERROR;   |FINSI;
          |FINSI;
     |FINSI;
     |CIERRA #238;
|FPRC;
----------------------------------------
|PROCESO desan001_71;
     |SI #referen2@#3 ! "S"; |ACABA; |FINSI;
     nCan = nUniDesanch / #referen2@#4;
     nCan = ((nCan - 0.49) ! 0) * #referen2@#5;
     |SI nCan [ 0; |ACABA; |FINSI;

     |SI nHay = 0; aponer = Asino; |HAZ poncontr; |FINSI;

     nLin = nLin + 1;
     #0#1 = nLin;
     #0#2 = #referen2@#1;   || Codigo
     |HAZ defecli;

     #0#4 = #2#1;
     #0#3 = nAlma;
     #0#14 = #2#30;
     #0#5 = nCan;
     #0#42 = nCan;
     #0#6 = 0;
     #0#36 = 0;
     |HAZ TotalLin71;
     |HAZ liacarti;
     |GRABA 020#0n;
     nHay = 1;
|FPRC;

|DEFBUCLE desan001_71;
     #referen2@#1002;
     ;
     #0#2,"                    ";
     #0#2,"zzzzzzzzzzzzzzzzzzzz";
     ;
     NULL, desan001_71;
|FIN;

|PROCESO Desan071;
     |DDEF aAlfa;
     aAlfa = aAlfa + "desan001";
     |CARGA_DEF aAlfa, referen2@;;
     |SI FSalida = 0;
          nLin = #0#1;
          nUniDesanch = #0#5;
          nAlma = #0#3;
          nHay = 0;
          |SALVA_DATOS #0;
          |BUCLE desan001_71;
          |REPON_DATOS #0;
          |DESCARGA_DEF #referen2@;;
          |SI nHay ! 0;
               aponer = Anosi; |HAZ poncontr;
               |PTEC 809; |PTEC 816; |PTEC 806;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO T071_6_0; |TIPO 0;
     |SI #279#3 = "S";
          eaArticulo = #0#2;
          enPrecio = #0#6;
          enDto1 = #0#8;
          enDto2 = #0#33;
          nNume =  (enPrecio < enDto1) < enDto2;
          |SI nNume ! nPreDtoAnt;
               |SUB_EJECUTA_NP "dsz00100";

               |SI enError ! 0; |ERROR; |ACABA; |FINSI;
               nPreDtoAnt = nNume;
          |FINSI;
     |FINSI;
|FPRC;
-------------------------
|RUTINA GuiCreaLineas;
     |ABRE #2;
     #2#0 = #0#2;
     |LEE 000#2=;
     |CIERRA #2;

     nMarca = #2#126;
     |DDEF aAlfa;
     aAlfa = aAlfa + "guillm01";
     |CARGA_DEF aAlfa, referen1@;
     |SI FSalida = 0;
          |DDEFECTO #referen1@;
          |ABRE #referen1@;
          #referen1@#0 = #0#2;
          |LEE 000#referen1@.=;
          |CIERRA #referen1@;

          aArtEnv = #referen1@#1; |QBF aArtEnv;
          aArtUni = #referen1@#2; |QBF aArtUni;
          |DESCARGA_DEF #referen1@;
     |FINSI;

     aDato = #0#47;
     #0#47 = ""; || Se guardan las lineas creadas en este campo
     |SI aArtEnv ! "";
          nUni = #0#66 + #0#5;
          aArti = aArtEnv;
          aAlfa = aDato % 103; nLin = aAlfa;

          aponer = Asino; |HAZ poncontr;
          |HAZ GuiCreaLineas0;
          aponer = Anosi; |HAZ poncontr;
          |SI nSwPtec = 0; |PTEC 809; |PTEC 816; |PTEC 806; |FINSI;
          nSwPtec = 1;

          aAlfa = ("000" + nLin) % -103;
          #0#47 = aAlfa;
     |FINSI;
     |SI aArtUni ! "";
          nUni = (#0#66 + #0#5) * nMarca;
          aArti = aArtUni;
          aAlfa = aDato % 403; nLin = aAlfa;

          aponer = Asino; |HAZ poncontr;
          |HAZ GuiCreaLineas0;
          aponer = Anosi; |HAZ poncontr;
          |SI nSwPtec = 0; |PTEC 809; |PTEC 816; |PTEC 806; |FINSI;
          nSwPtec = 1;

          aAlfa = #0#47 % 103;
          aAlfa = aAlfa + (("000" + nLin) % -103);
          #0#47 = aAlfa;
     |FINSI;
|FRUT;

|RUTINA GuiCreaLineas0;
     |DDEF aAlfa; aAlfa = aAlfa + "agifa071";
     |CARGA_DEF aAlfa, referen1@;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |DDEFECTO #2;
     |ABRE #2;
     #2#0 = aArti;
     |LEE 000#2=;
     |CIERRA #2;

     |ABRE #referen1@;
     #referen1@#29 = #0#29;
     #referen1@#0 = #0#0;
     #referen1@#1 = nLin;
     |LEE 000#referen1@.=;
     |SI FSalida = 0;
          |SALVA_DATOS #0;
          |SALVA_DATOS #referen1@;
          |REPON_DATOS #0;
          #0#1 = #referen1@#1;
          enForma = -1;
          |HAZ CalCabAgifa010_2;
          |HAZ AcumulaAV;
          |REPON_DATOS #0;
     |SINO;
          #referen1@#1 = 999;
          |LEE 000#referen1@.];
          |SI FSalida = 0;
               |LEE 000#referen1@.a;
          |SINO;
               |LEE 000#referen1@.u;
          |FINSI;
          |SI FSalida = 0; |Y #referen1@#29 = #0#29;  |Y #referen1@#0 = #0#0;
               nLin = #referen1@#1 + 1;
          |SINO;
               nLin = 1;
          |FINSI;
          |SI nLin = #0#1; nLin = nLin + 1; |FINSI;
          #referen1@#29 = #0#29;
          #referen1@#0 = #0#0;
          #referen1@#1 = nLin;
          |GRABA 020#referen1@.b;
     |FINSI;

     |SALVA_DATOS #0;
     |REPON_DATOS #referen1@;

     #referen1@#1 = nLin;
     #referen1@#2 = #2#0;
     #referen1@#4 = #2#1;
     #referen1@#5 = nUni;
     #referen1@#6 = #2#18;
     #referen1@#8 = 0;
     #referen1@#11 = #2#30;
     #referen1@#13 = #2#2;
     #referen1@#14 = enCoste;
     #referen1@#33 = 0;
     #referen1@#36 = #referen1@#6;
     #referen1@#63 = -2;
     #referen1@#64 = 0;
     #referen1@#65 = 0;
     #referen1@#66 = 0;

     |SALVA_DATOS #0;

     |SALVA_DATOS #referen1@;
     |REPON_DATOS #0;
     #0#1 = #referen1@#1;
     enForma = 1;

     |HAZ TotalLin71;
     |HAZ CalCabAgifa010_2;
     |HAZ AcumulaAV;

     |SALVA_DATOS #0;
     |REPON_DATOS #referen1@;
     |GRABA 020#referen1@.a;

     |REPON_DATOS #0;

     |CIERRA #referen1@;
     |DESCARGA_DEF #referen1@;
|FRUT;

|RUTINA GuiBorraLineas;
     |DDEF aAlfa; aAlfa = aAlfa + "agifa071";
     |CARGA_DEF aAlfa, referen1@;
     |SI FSalida ! 0; |ACABA; |FINSI;

     aAlfa = #0#47 % 103; nLin = aAlfa;
     |HAZ GuiBorraLineas0;

     aAlfa = #0#47 % 403; nLin = aAlfa;
     |HAZ GuiBorraLineas0;

     |DESCARGA_DEF #referen1@;

     |HAZ visual_totales;
|FRUT;

|RUTINA GuiBorraLineas0;
     |ABRE #referen1@;
     #referen1@#29 = #0#29;
     #referen1@#0 = #0#0;
     #referen1@#1 = nLin;
     |LEE 101#referen1@.=;
     |SI FSalida = 0;
          |SALVA_DATOS #0;
          |SALVA_DATOS #referen1@;
          |REPON_DATOS #0;
          #0#1 = #referen1@#1;
          enForma = -1;
          |HAZ CalCabAgifa010_2;
          |HAZ AcumulaAV;
          |REPON_DATOS #0;
          |BORRA 020#referen1@.a;
          |PONCONTROL 23, "SI";
          |SI nSwPtec = 0; |PTEC 809; |PTEC 808; |FINSI;
          nSwPtec = 1;
     |FINSI;
     |CIERRA #referen1@;
|FRUT;

|PROCESO tlfm0001;
     #tlfm0019@#0 = #tlfm0001@#0;
     #tlfm0019@#1 = #0#2;
     #tlfm0019@#2 = #1#1;
     |SI #1#43 = "S";
          #tlfm0019@#3 = "BV";
     |SINO;
          #tlfm0019@#3 = "AV";
     |FINSI;
     #tlfm0019@#4 = #0#29;
     #tlfm0019@#5 = #0#0;
     #tlfm0019@#6 = #0#1;
     #tlfm0019@#7 = 0;
     #tlfm0019@#8 = #0#3;
     #tlfm0019@#9 = #1#3;
     #tlfm0019@#10 = #0#6;
     |SI nForma = 1;
          |GRABA 020#tlfm0019@.n;
     |SINO;
          |BORRA 020#tlfm0019@.c;
     |FINSI;

     nHay = 0;
     |SI modo = 3; nHay = 1; |FINSI;
     |SI modo = 2; |Y nForma = -1; |Y #1#90 = "S"; nHay = 1; |FINSI;
     |SI nHay = 1;
          |SELECT #1#tlfm0023@;
          |LEE 101#tlfm0023@.u;
          |SI FSalida = 0;
               nNume = #tlfm0023@#0 + 1;
          |SINO;
               nNume = 1;
          |FINSI;
          #tlfm0023@#0 = nNume;
          #tlfm0023@#1 = #tlfm0019@#0;
          #tlfm0023@#2 = #tlfm0019@#1;
          #tlfm0023@#3 = #tlfm0019@#2;
          #tlfm0023@#4 = #tlfm0019@#3;
          #tlfm0023@#5 = #tlfm0019@#4;
          #tlfm0023@#6 = #tlfm0019@#5;
          #tlfm0023@#7 = #tlfm0019@#6;
          #tlfm0023@#8 = #tlfm0019@#7;
          #tlfm0023@#9 = #1#29;
          #tlfm0023@#10 = ~;
          aAlfa = Usuario % 810;
          #tlfm0023@#11 = aAlfa;
          |SI modo = 3;
               #tlfm0023@#12 = "B";
          |SINO;
               #tlfm0023@#12 = "M";
          |FINSI;
          |GRABA 020#tlfm0023@.n;
     |FINSI;
     |SI modo = 2; |Y nForma = 1; |Y #1#90 = "S";
          |SELECT #2#tlfm0023@;
          #tlfm0023@#1 = #tlfm0019@#0;
          #tlfm0023@#5 = #0#29;
          #tlfm0023@#6 = #0#0;
          #tlfm0023@#7 = #0#1;
          |BORRA 000#tlfm0023@.c;
     |FINSI;
|FPRC;

|DEFBUCLE tlfm0001;
     #tlfm0001@#5003;
     ;
     #0#29, #0#0, #0#1;
     #0#29, #0#0, #0#1;
     ;
     NULL, tlfm0001;
|FIN;

|PROCESO HistoIMEI0;
     |ABRE #tlfm0019@;
     |ABRE #tlfm0023@;
     |BUCLE tlfm0001;
     |CIERRA #tlfm0023@;
     |CIERRA #tlfm0019@;

     |ABRE #tlfm0001@;
     |SELECT #5#tlfm0001@;
     #tlfm0001@#25 = #0#29;
     #tlfm0001@#26 = #0#0;
     #tlfm0001@#27 = #0#1;
     |LEE 000#tlfm0001@.=;
     |SI FSalida = 0; |Y #tlfm0001@#60 ! 0;
          eaSerie = #0#29;
          enCodigo = #0#0;
          enLinea = #0#1;
          enModo = modo;
          |SUB_EJECUTA_NP "tlfw0005";
     |FINSI;
     |CIERRA #tlfm0001@;
|FPRC;

|PROCESO HistoIMEI;
     |DDEF aDef;
     aAlfa = aDef + "tlfm0001";
     |CARGA_DEF aAlfa, tlfm0001@;
     |SI FSalida = 0;
          aAlfa = aDef + "tlfm0019";
          |CARGA_DEF aAlfa, tlfm0019@;
          |SI FSalida = 0;
               aAlfa = aDef + "tlfm0023";
               |CARGA_DEF aAlfa, tlfm0023@;
               |SI FSalida = 0;
                    |HAZ HistoIMEI0;
                    |DESCARGA_DEF #tlfm0023@;
               |SINO;
                    |MENAV "0000Error al cargar 'tlfm0023'";
               |FINSI;
               |DESCARGA_DEF #tlfm0019@;
          |SINO;
               |MENAV "0000Error al cargar 'tlfm0019'";
          |FINSI;
          |DESCARGA_DEF #tlfm0001@;
     |SINO;
          |MENAV "0000Error al cargar 'tlfm0001'";
     |FINSI;
|FPRC;

----------------------------------------------
|PROCESO TallerCreaLin71;
     |DDEF aAlfa; aAlfa = aAlfa + "agifa071";
     |CARGA_DEF aAlfa, referen1@;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |ABRE #referen1@;
     |SI #0#63 > 0;
          nLin = #0#63;
          #referen1@#29 = #0#29;
          #referen1@#0 = #0#0;
          #referen1@#1 = nLin;
          |LEE 121#referen1@.=;
     |SINO;
          #referen1@#29 = #0#29;
          #referen1@#0 = #0#0;
          #referen1@#1 = 999;
          |LEE 000#referen1@.];
          |SI FSalida = 0;
               |LEE 000#referen1@.a;
          |SINO;
               |LEE 000#referen1@.u;
          |FINSI;
          |SI FSalida = 0; |Y #referen1@#29 = #0#29;  |Y #referen1@#0 = #0#0;
               nLin = #referen1@#1 + 1;
          |SINO;
               nLin = 1;
          |FINSI;
          |SI nLin [ #0#1; nLin = #0#1 + 1; |FINSI;
          |DDEFECTO #referen1@;
          #referen1@#29 = #0#29;
          #referen1@#0 = #0#0;
          #referen1@#1 = nLin;
          |GRABA 020#referen1@.b;
     |FINSI;
     aAlfa = "CANON " + #0#4;
     #referen1@#2 = "xxxxx";
     #referen1@#3 = 1;
     #referen1@#4 = aAlfa;
     #referen1@#5 = #0#5;
     #referen1@#6 = enCanon;
     #referen1@#11 = #0#11;
     #referen1@#13 = #0#13;
     #referen1@#15 = #0#15;
     #referen1@#36 = enCanon;
     #referen1@#63 = -1;
     |SALVA_DATOS #0;

     |SALVA_DATOS #referen1@;
     |REPON_DATOS #0;

     enForma = 1;
     |HAZ AcumulaAV;
     |HAZ TotalLin71;
     |HAZ AcuAlbaran;

     |SALVA_DATOS #0;
     |REPON_DATOS #referen1@;
     |GRABA 020#referen1@.a;

     |REPON_DATOS #0;

     #0#63 = nLin;  || Linea Promocion

     |CIERRA #referen1@;
     |DESCARGA_DEF #referen1@;
|FPRC;

|PROCESO TallerAcuLin71;
     |DDEF aAlfa; aAlfa = aAlfa + "agifa071";
     |CARGA_DEF aAlfa, referen1@;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |ABRE #referen1@;
     #referen1@#29 = #0#29;
     #referen1@#0 = #0#0;
     #referen1@#1 = #0#63;     || Usa linea promocion
     |LEE 101#referen1@.=;
     |SI FSalida = 0;
          |SALVA_DATOS #0;
          |SALVA_DATOS #referen1@;
          |REPON_DATOS #0;
          #0#1 = #referen1@#1;
          enForma = -1;
          |HAZ AcumulaAV;
          |HAZ TotalLin71;
          |HAZ AcuAlbaran;
          |REPON_DATOS #0;
     |FINSI;
     |CIERRA #referen1@;

     |DESCARGA_DEF #referen1@;
|FPRC;

|PROCESO TallerBorLin71;
     |DDEF aAlfa; aAlfa = aAlfa + "agifa071";
     |CARGA_DEF aAlfa, referen1@;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |ABRE #referen1@;
     #referen1@#29 = #0#29;
     #referen1@#0 = #0#0;
     #referen1@#1 = #0#63;     || Usa linea promocion
     |LEE 101#referen1@.=;
     nTallerBorLin = FSalida;
     |SI FSalida = 0;
          |BORRA 020#referen1@.a;
     |FINSI;
     |CIERRA #referen1@;

     |DESCARGA_DEF #referen1@;
|FPRC;

|PROCESO TallerCanon71;
     eaArticulo = #0#2; |QBF eaArticulo;
     |HAZ TallerCanon;
     |SI nForma = 1;
          |SI enCanon ! 0;
               aponer = Asino; |HAZ poncontr;
               |HAZ TallerCreaLin71;
               aponer = Anosi; |HAZ poncontr;
               |PTEC 809; |PTEC 816; |PTEC 806;
          |SINO;
               |SI #0#63 > 0;      || ha cambiado a un articulo sin canon
                    |HAZ TallerBorLin71;
                    #0#63 = 0;
               |FINSI;
          |FINSI;
     |SINO;
          |SI modo = 3; |Y enModoCab10 ! 3;
               |HAZ TallerAcuLin71;
               |HAZ TallerBorLin71;
               |SI nTallerBorLin = 0;
                    |PONCONTROL 23, "SI";
                    |PTEC 809; |PTEC 808;
               |FINSI;
          |SINO;
               |SI modo = 2;
                    |HAZ TallerAcuLin71;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO BorTagloMerma71;
     |DDEF aAlfa;
     aAlfa = aAlfa + "tagm0078";
     |CARGA_DEF aAlfa, referen1@;
     |SI FSalida ! 0;
          |MENAV "0000Error al cargar 'tagm0078'";
     |SINO;
          |ABRE #referen1@;
          #referen1@#0 = "A";
          #referen1@#1 = #0#29;
          #referen1@#2 = #0#0;
          #referen1@#3 = #0#1;
          |BORRA 000#referen1@.c;
          |CIERRA #referen1@;
          |DESCARGA_DEF #referen1@;
     |FINSI;
|FPRC;

|PROCESO PintaAparecida71;
     aAlfa = " " * 75;
     |PINTA 0803, aAlfa;
     |PINTA 0903, aAlfa;
     |ABRE #2;
     #2#0 = #0#2;
     |LEE 000#2=;
     |CIERRA #2;
     |SI #2#175 = "N"; |ACABA; |FINSI;

     |ABRE #910; |LEE 000#910p; |CIERRA #910;
     |DDEF aAlfa;
     aAlfa = aAlfa + "aparm005";
     |CARGA_DEF aAlfa, referen1@;
     |SI FSalida ! 0; |ACABA; |FINSI;
     |ABRE #referen1@; |LEE 000#referen1@.p; |CIERRA #referen1@;
     nPos1 = 0803;
     nPos2 = 0903;
     nCamDes = 3;
     nCamLon = 4;
     nPosArt = 100;
     nPosDes = 100;
     |PARA j = 1; |SI j [ 4; |HACIENDO j = j + 1;
          |PARA i = 2; |SI i [ 5; |HACIENDO i = i + 1;
               |SI j = #referen1@#i#;
                    nLon2 = i + 4;
                    nLon2 = #referen1@#nLon2#;
                    nLon1 = 10 + 1 + #910#nCamLon#;
                    |SI nLon2 > 0;
                         nPos = nPosArt + #910#nCamLon#;
                         aArti = #2#0 % nPos;

                         nPos = nPosDes + nLon2;
                         aDes = #2#1 % nPos;

                         |ATRI R; |PINTA nPos1, #910#nCamDes#; |ATRI 0;
                         nPos = nPos1 + 11;
                         |ATRI I; |PINTA nPos, aArti; |ATRI 0;
                         |ATRI N; |PINTA nPos2, aDes; |ATRI 0;
                         |SI nLon1 > nLon2;
                              nPos1 = nPos1 + nLon1 + 1;
                              nPos2 = nPos2 + nLon1 + 1;
                         |SINO;
                              nPos1 = nPos1 + nLon2 + 1;
                              nPos2 = nPos2 + nLon2 + 1;
                         |FINSI;

                         nPosArt = nPosArt + (100 * #910#nCamLon#);
                         nPosDes = nPosDes + (100 * (nLon2+1));
                         nCamDes = nCamDes + 4;
                         nCamLon = nCamLon + 4;
                    |FINSI;
               |FINSI;
          |SIGUE;
     |SIGUE;
     |DESCARGA_DEF #referen1@;
|FPRC;

|PROCESO PintaDes71;
     |HAZ EsAparecida;
     |SI FSalida = 0;
          |C_A #0#4, 0, nNume;
          |C_A #0#4, 1, 50;
          |PINTA 2302, "쿏escripcion: ";
          |PINTA 2316, #0#4;
          |C_A #0#4, 1, nNume;
     |FINSI;
|FPRC;

|PROCESO ApareceCreaLin71
     |DDEF aAlfa; aAlfa = aAlfa + "agifa071";
     |CARGA_DEF aAlfa, referen1@;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |ABRE #2;
     #2#0 = "9759999";
     |LEE 000#2=;
     |CIERRA #2;

     |ABRE #referen1@;
     |SI #0#63 > 0;
          nLin = #0#63;
          #referen1@#29 = #0#29;
          #referen1@#0 = #0#0;
          #referen1@#1 = nLin;
          |LEE 121#referen1@.=;
     |SINO;
          #referen1@#29 = #0#29;
          #referen1@#0 = #0#0;
          #referen1@#1 = 999;
          |LEE 000#referen1@.];
          |SI FSalida = 0;
               |LEE 000#referen1@.a;
          |SINO;
               |LEE 000#referen1@.u;
          |FINSI;
          |SI FSalida = 0; |Y #referen1@#29 = #0#29;  |Y #referen1@#0 = #0#0;
               nLin = #referen1@#1 + 1;
          |SINO;
               nLin = 1;
          |FINSI;
          |SI nLin [ #0#1; nLin = #0#1 + 1; |FINSI;
          |DDEFECTO #referen1@;
          #referen1@#29 = #0#29;
          #referen1@#0 = #0#0;
          #referen1@#1 = nLin;
          |GRABA 020#referen1@.b;
     |FINSI;
     #referen1@#2 = #2#0;
     #referen1@#3 = #0#3;;
     #referen1@#4 = #2#1;
     #referen1@#5 = -#0#5;
     #referen1@#6 = #0#6;
     #referen1@#8 = #0#8;
     #referen1@#10 = #0#10;
     #referen1@#11 = #0#11;
     #referen1@#13 = #2#2;
     #referen1@#14 = -#0#14;
     #referen1@#15 = #0#15;
     #referen1@#16 = #0#16;
     #referen1@#17 = #0#17;
     #referen1@#15 = #0#15;
     #referen1@#33 = #0#33;
     #referen1@#36 = #0#36;
     #referen1@#38 = #0#38;
     #referen1@#15 = #0#15;
     #referen1@#63 = -1;
     |SALVA_DATOS #0;

     |SALVA_DATOS #referen1@;
     |REPON_DATOS #0;

     enForma = 1;
     |HAZ AcumulaAV;
     |HAZ TotalLin71;
     |HAZ AcuAlbaran;

     |SALVA_DATOS #0;
     |REPON_DATOS #referen1@;
     |GRABA 020#referen1@.a;

     |REPON_DATOS #0;

     #0#63 = nLin;  || Linea Promocion

     |CIERRA #referen1@;
     |DESCARGA_DEF #referen1@;
|FPRC;

|PROCESO Aparecida71;
     |ABRE #6;
     #6#0 = #1#4;
     |LEE 000#6=;
     |CIERRA #6;
     |SI #6#113 ! "N"; |ACABA; |FINSI;
     |ABRE #2;
     #2#0 = #0#2;
     |LEE 000#2=;
     |CIERRA #2;

     |SI nForma = 1;
          |SI #2#2 = "975";
               aponer = Asino; |HAZ poncontr;
               |HAZ ApareceCreaLin71;
               aponer = Anosi; |HAZ poncontr;
               |PTEC 809; |PTEC 816; |PTEC 806;
          |SINO;
               |SI #0#63 > 0;      || ha cambiado a un articulo sin canon
                    |HAZ TallerBorLin71;
                    #0#63 = 0;
               |FINSI;
          |FINSI;
     |SINO;
          |SI modo = 3; |Y enModoCab10 ! 3;
               |HAZ TallerAcuLin71;
               |HAZ TallerBorLin71;
               |SI nTallerBorLin = 0;
                    |PONCONTROL 23, "SI";
                    |PTEC 809; |PTEC 808;
               |FINSI;
          |SINO;
               |SI modo = 2;
                    |HAZ TallerAcuLin71;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;


|PROCESO InforActMatri;
     aAlfa = #0#49; |QBF aAlfa;
     |SI aAlfa = ""; |ACABA; |FINSI;
     nSwPasa = 0;
     |DDEF aPath;
     aAlfa = aPath + "ialbm006";
     |CARGA_DEF aAlfa, referen1@;
     |SI FSalida = 0;
          |SI #0#29 = #referen1@#2; |O #0#29 = #referen1@#3;
                    |O #0#29 = #referen1@#4; |O #0#29 = #referen1@#5;
               nSwPasa = 1;
          |FINSI;
          |DESCARGA_DEF #referen1@;
     |FINSI;
     |SI nSwPasa = 1; |ACABA; |FINSI;

     aAlfa = aPath + "ialbm002";
     |CARGA_DEF aAlfa, referen1@;
     |SI FSalida = 0;
          |ABRE #referen1@;
          #referen1@#0 = #0#49;
          |LEE 101#referen1@.=;
          |SI FSalida = 0;
               |SI nForma = 1;
                    |ABRE #6;
                    #6#0 = #1#3;
                    |LEE 000#6=;
                    |CIERRA #6
                    #referen1@#6 = #6#0;
                    #referen1@#7 = #6#1;
                    #referen1@#8 = #1#1;
                    #referen1@#9 = #0#9;
                    #referen1@#10 = #1#6;
                    #referen1@#15 = #0#29;
                    #referen1@#16 = #0#0;
                    #referen1@#21 = #6#17;
               |SINO;
                    #referen1@#6 = "";
                    #referen1@#7 = "";
                    #referen1@#8 = "01.01.0000";
                    #referen1@#9 = "";
                    #referen1@#10 = "";
                    #referen1@#15 = "";
                    #referen1@#16 = "";
                    #referen1@#21 = "";
               |FINSI;
               |GRABA 020#referen1@.a;
          |FINSI;
          |CIERRA #referen1@;
          |DESCARGA_DEF #referen1@;
     |SINO;
          |MENAV "0000Error al cargar 'ialbm002'";
     |FINSI;
|FPRC;

|PROCESO IVA071_66; |TIPO 66;
     enTiva = #0Campo;
     efFiva = #1#1;
     |HAZ ConsuIVA;
     |SI eaDiva = "";
          |ERROR;
     |SINO;
          #0Campo = enTiva; |PINTA #0Campo;
     |FINSI;
|FPRC;

|PROCESO SumaUni71;
     nTotUni = nTotUni + #0#5;
|FPRC;

|DEFBUCLE SumaUni71;
     #0#1;
     ;
     #1#52, #1#0, 001;
     #1#52, #1#0, 999;
     ;
     NULL, SumaUni71;
|FIN;

|PROCESO VigorPin71;
     |SALVA_FICHA #0;
     nTotUni = 0;
     |BUCLE SumaUni71;
     #0#5 = nTotUni;
     |PINTA 1003, "Tot.Uni: ";
     |PINTA 1012, #0#5;
     |REPON_FICHA #0;
|FPRC;

|PROCESO ActDesanch71;
     nEsta = 0;
     |DDEF aPath;
     aAlfa = aPath + "desan001";
     |CARGA_DEF aAlfa, referen1@;
     |SI FSalida = 0;
          |ABRE #referen1@;
          |SELECT #2#referen1@;
          #referen1@#1 = #0#2;
          |LEE 000#referen1@.=;
          |SI FSalida = 0; |Y #referen1@#3 = "S";
               nEsta = 1;
          |FINSI;
          |DESCARGA_DEF #referen1@;
     |FINSI;

     |SI nEsta = 0; |ACABA; |FINSI;

     aAlfa = aPath + "desan026";
     |CARGA_DEF aAlfa, referen1@;
     |SI FSalida = 0;
          |ABRE #referen1@;
          #referen1@#0 = #0#2;
          #referen1@#1 = #1#1;
          |SI #1#43 = "S";
               #referen1@#2 = "BV";
               nUni = #0#5;
          |SINO;
               #referen1@#2 = "AV";
               nUni = -#0#5;
          |FINSI;
          #referen1@#3 = #0#29;
          #referen1@#4 = #0#0;
          #referen1@#5 = #0#1;
          #referen1@#6 = nUni;
          #referen1@#7 = #1#3;
          |SI nForma = 1;
               |GRABA 000#referen1@.n;
          |SINO;
               |BORRA 000#referen1@.c;
          |FINSI;
          |CIERRA #referen1@;
          |DESCARGA_DEF #referen1@;
     |FINSI;

     aAlfa = aPath + "desan025";
     |CARGA_DEF aAlfa, referen1@;
     |SI FSalida = 0;
          |DDEFECTO #referen1@;
          |ABRE #referen1@;
          #referen1@#0 = #1#3;
          #referen1@#1 = #0#2;
          |LEE 101#referen1@.=;
          |SI FSalida ! 0; |GRABA 020#referen1@.b; |FINSI;
          #referen1@#2 = #referen1@#2 + (nUni * nForma);
          |GRABA 020#referen1@.a;
          |CIERRA #referen1@;
          |DESCARGA_DEF #referen1@;
     |FINSI;
|FPRC;

|PROCESO DesanchUni;
     FSalida = 0;
     |SI #0#5 ] 0; |ACABA; |FINSI;
     nEsta = 0;
     |DDEF aPath;
     aAlfa = aPath + "desan001";
     |CARGA_DEF aAlfa, referen1@;
     |SI FSalida = 0;
          |ABRE #referen1@;
          |SELECT #2#referen1@;
          #referen1@#1 = #0#2;
          |LEE 000#referen1@.=;
          |SI FSalida = 0; |Y #referen1@#3 = "S";
               nEsta = 1;
          |FINSI;
          |DESCARGA_DEF #referen1@;
     |FINSI;

     FSalida = 0;
     |SI nEsta = 0; |ACABA; |FINSI;

     aAlfa = aPath + "desan025";
     |CARGA_DEF aAlfa, referen1@;
     |SI FSalida = 0;
          |DDEFECTO #referen1@;
          |ABRE #referen1@;
          #referen1@#0 = #1#3;
          #referen1@#1 = #0#2;
          |LEE 000#referen1@.=;
          nUni = #referen1@#2 + #0#5;
          |CIERRA #referen1@;
          |SI nUni < 0;
               aAlfa = "0000El cliente solo tiene: " + #referen1@#2 + " cascos. Continuar?"
               |CONFI aAlfa;
               aAlfa = FSalida;
          |FINSI;
          |DESCARGA_DEF #referen1@;
     |FINSI;
     FSalida = aAlfa;
|FPRC;

|PROCESO PinDesanch;
     |ATRI R; |PINTA 1239, "Garantia"; |ATRI 0;
     |DDEF aPath;
     aAlfa = aPath + "desan033";
     |CARGA_DEF aAlfa, referen1@;
     |SI FSalida = 0;
          |DDEFECTO #referen1@;
          |ABRE #referen1@;
          #referen1@#0 = #0#29;
          #referen1@#1 = #0#0;
          #referen1@#2 = #0#1;
          |LEE 000#referen1@.=;
          |CIERRA #referen1@;
          |ATRI I; |PINTA 1342, #referen1@#3; |ATRI 0;
          |DESCARGA_DEF #referen1@;
     |FINSI;
|FPRC;

|PROCESO PinQDClor71;
     |DDEF aPath;
     aAlfa = aPath + "qdclor08";
     |CARGA_DEF aAlfa, referen1@;
     |SI FSalida = 0;
          |DDEFECTO #referen1@;
          |ABRE #referen1@;
          #referen1@#0 = #0#29;
          #referen1@#1 = #0#0;
          #referen1@#2 = #0#1;
          |LEE 000#referen1@.=;
          |CIERRA #referen1@;
          |ATRI R;
          |PINTA 1235, "쿐nvases쿟ip쿍ol";
          |ATRI I;
          |PINTA 1335, "             ";
          |PINTA 1336, #referen1@#3;
          |PINTA 1345, #referen1@#4;
          |PINTA 1349, #referen1@#5;
          |ATRI 0;
          |DESCARGA_DEF #referen1@;
     |FINSI;
|FPRC;

----------------------------------------------------------
|PROCESO LeeDefeArt;
     eAlfa = #2#0;  |SUB_EJECUTA_NP "dsz99990;V";

     aDCodF1 = " " * 20;
     aDCodF2 = " " * 20;
     aDCodF3 = " " * 20;
     aDCodF4 = " " * 20;
     |SI #910#26 = 1;
         aDCodF1 = eAlfa1;
     |FINSI;
     |SI #910#26 = 2;
         aDCodF1 = eAlfa1;
         aDCodF2 = eAlfa2;
     |FINSI;
     |SI #910#26 = 3;
         aDCodF1 = eAlfa1;
         aDCodF2 = eAlfa2;
         aDCodF3 = eAlfa3;
     |FINSI;
     |SI #910#26 = 4;
         aDCodF1 = eAlfa1;
         aDCodF2 = eAlfa2;
         aDCodF3 = eAlfa3;
         aDCodF4 = eAlfa4;
     |FINSI;
     |SI #910#44 = "T";
         eAlfa1  = #2#177;  |QBF eAlfa1;
         eAlfa1  = eAlfa1 + ((" " * 20) % 120);

         aDCodF1 = eAlfa1;
         aDCodF2 = " " * 20;
         aDCodF3 = " " * 20;
         aDCodF4 = " " * 20;
     |FINSI;
     #916#0  = aDCodF1;
     #916#1  = aDCodF2;
     #916#2  = aDCodF3;
     #916#15 = aDCodF4;
     #916#3 = #905#4;
     |LEE 000#916=;
     |SI FSalida ! 0; |DDEFECTO #916; |FINSI;
|FPRC;

|PROCESO PreTalla;
     #6#0 = #1#3;
     |LEE 000#6=;
     |SI FSalida ! 0; |DDEFECTO #6; |FINSI;

     |SI #910#24 = "S";
          |HAZ LeeDefeArt;
          |SI #6#39 = 1;  #905#7 = #916#5;   |FINSI;
          |SI #6#39 = 2;  #905#7 = #916#6;   |FINSI;
          |SI #6#39 = 3;  #905#7 = #916#7;   |FINSI;
          |SI #6#39 = 4;  #905#7 = #916#8;   |FINSI;
          |SI #6#39 = 5;  #905#7 = #916#9;   |FINSI;
          |SI #6#39 = 6;  #905#7 = #916#10;  |FINSI;
          |SI #6#39 = 0;  #905#7 = #916#11;  |FINSI;
     |SINO;
          fed_dt    = #1#1;        || Fecha....
          art_dt    = #2#0;        || Articulo.
          cli_dt    = #6#0;        || Cliente..
          fam_dt    = #2#19;       || Familia.
          iva_dt    = #2#30;       || Tipo Iva.
          dtos_2    = 0;           || Descuento 2.
          dto_pt    = 0;           || Descuento Ptas.
          dtos_1    = 0;           || Descuento 1.
          pvp_ve    = 0;           || Precio Venta.
          tarifa    = #6#39;       || Tarifa Cliente....
          gru_dt    = #6#158;      || Grupo Cliente.
          uni_dt    = 0;
          aParam    = "";
          enMensaje = 1;
          eaSerie   = #referen1@#29;
          |HAZ calcdtos
          #905#7    = pvp_ve;  || Precio Venta. sin iva.
     |FINSI;
     #905#13 = #905#7 / enCamDiv * enCamBas;
|FPRC;

|PROCESO SurtidoTalla;
     #905#0 = "AV";
     #905#1 = #0#29;
     #905#2 = #0#0;
     #905#3 = #0#1;
     #905#4 = #referen2@#1;
     #905#5 = #referen2@#2;
     #905#6 = #referen2@#3 * enCajas;
     #905#11 = #905#6;
     enCamBas = #1#69
     eaMoneda = #1#70
     enCamDiv = #1#74
     |HAZ PreTalla;
     |SI eaMoneda = "B";
          #905#8 = #905#6 * #905#7;
          #905#13 = #905#7 / enCamDiv * enCamBas;
          #905#14 = #905#8 / enCamDiv * enCamBas;
     |SINO;
          #905#14 = #905#6 * #905#13;
          #905#7 = #905#13 / enCamBas * enCamDiv;
          #905#8 = #905#14 / enCamBas * enCamDiv ;
     |FINSI;
     |GRABA 020#905n;
     #referen1@#5 = #referen1@#5 + #905#6;   || Uni
     |SI eaMoneda = "B";
          enTBruto = enTBruto + (#905#6 * #905#7);
     |SINO;
          enTBruto = enTBruto + (#905#6 * #905#13);
     |FINSI;
|FPRC;

|DEFBUCLE SurtidoTalla;
     #referen2@#1002;
     ;
     enSurtido, "      ";
     enSurtido, "zzzzzz";
     ;
     NULL, SurtidoTalla;
|FIN;

|PROCESO Surtido;
     #referen1@#29 = #0#29;
     #referen1@#0 = #0#0;
     #referen1@#1 = 999;
     |LEE 000#referen1@.];
     |SI FSalida = 0;
          |LEE 000#referen1@.a;
     |SINO;
          |LEE 000#referen1@.u;
     |FINSI;
     |SI FSalida = 0; |Y #referen1@#29 = #0#29; |Y #referen1@#0 = #0#0;
          nLin = #referen1@#1 + 1;
     |SINO;
          nLin = 1;
     |FINSI;
     |DDEFECTO #referen1@;
     #referen1@#29 = #0#29;
     #referen1@#0 = #0#0;
     #referen1@#1 = nLin;
     #referen1@#2 = eaArticulo;
     #referen1@#3 = 1;
     #referen1@#4 = eaAlfa;
     #referen1@#5 = 0;

     #2#0 = #referen1@#2;
     |LEE 000#2=;
     |SI FSalida ! 0; |DDEFECTO #2; |FINSI;

     enTBruto = 0;
     |BUCLE SurtidoTalla;
     nPrecio = enTBruto / #referen1@#5;

     |SI #1#70 = "D";
          #referen1@#36 = nPrecio;
     |SINO;
          #referen1@#6  = nPrecio;
     |FINSI;
     |SI #1#70 = "D";
          #referen1@#6 = #referen1@#36 / #1#69 * #1#74;
     |SINO;
          #referen1@#36 = #referen1@#6 / #1#74 * #1#69;
     |FINSI;
     |SI #1#70 = "D";
          #referen1@#38 = #referen1@#6;
     |SINO;
          #referen1@#38 = #referen1@#36;
     |FINSI;

     #referen1@#11 = #2#30;
     #referen1@#13 = #2#19;
     #referen1@#15 = #1#3;
     #referen1@#16 = #1#34;
     #referen1@#17 = #1#35;

     |SALVA_DATOS #0;

     |SALVA_DATOS #referen1@;
     |REPON_DATOS #0;

     enForma = 1;
     |HAZ AcumulaAV;
     #0#14 = enCoste;
     |HAZ TotalLin71;
     |HAZ AcuAlbaran;

     enDescuento1 = #0#8;
     enDescuento2 = #0#33;
     eaTComision = #0#16;
     eaCliente = #1#3;
     eaArticulo = #0#2;
     eaRepre = #1#6;
     enDirEnt = #1#84;
     enAlmacen = #0#3;
     |HAZ Comisiones;
     #0#10 = enComision;

     |SALVA_DATOS #0;
     |REPON_DATOS #referen1@;
     |GRABA 020#referen1@.n;

     |REPON_DATOS #0;
|FPRC;

|PROCESO DefelinoSurti;
     aAlfa = "defelz04";
     |SUB_EJECUTA_NP "defelz04";
     |SI enSurtido = 0; |ACABA; |FINSI;

     |DDEF aPath;
     aAlfa = aPath + "agifa071";
     |CARGA_DEF aAlfa, referen1@;
     |SI FSalida = 0;
          aAlfa = aPath + "defelm05"; |CARGA_DEF aAlfa, referen2@;
          aAlfa = aPath + "defelm06"; |CARGA_DEF aAlfa, referen3@;
          |SI FSalida = 0;
               |ABRE #referen1@;
               |ABRE #2;
               |ABRE #6;
               |ABRE #916;
               |ABRE #905;
               |HAZ Surtido;
               |CIERRA #905;
               |CIERRA #916;
               |CIERRA #6;
               |CIERRA #2;
               |CIERRA #referen1@;

               |ABRE #referen3@;
               #referen3@#0 = "A";
               #referen3@#1 = #0#29;
               #referen3@#2 = #0#0;
               #referen3@#3 = #0#1;
               |LEE 101#referen3@.=;
               |SI FSalida ! 0; |GRABA 020#referen3@.b; |FINSI;
               #referen3@#4 = eaArticulo;
               #referen3@#5 = enSurtido;
               #referen3@#6 = enCajas;
               |GRABA 020#referen3@.a;
               |LIBERA #referen3@;
               |CIERRA #referen3@;
               |DESCARGA_DEF #referen3@;

               |DESCARGA_DEF #referen2@;
               |PTEC 809; |PTEC 816; |PTEC 812;
          |SINO;
               |MENAV "0000Error al cargar 'defelm05/6'";
          |FINSI;
          |DESCARGA_DEF #referen1@;
     |SINO;
          |MENAV "0000Error al cargar 'agifa073'";
     |FINSI;
|FPRC;

|PROCESO DefelinoBorra;
     |DDEF aPath;
     aAlfa = aPath + "defelm06";
     |CARGA_DEF aAlfa, referen1@;
     |SI FSalida = 0;
          |ABRE #referen1@;
          #referen1@#0 = #0#29;
          #referen1@#1 = #0#0;
          #referen1@#2 = #0#1;
          |BORRA 000#referen1@.c;
          |CIERRA #referen1@;
          |DESCARGA_DEF #referen1@;
     |SINO;
          |MENAV "0000Error al cargar 'defelm006'";
     |FINSI;
|FPRC;

|PROCESO gestrw02;
     #referen1@#29 = #0#29;
     #referen1@#0 = #0#0;
     #referen1@#1 = 999;
     |LEE 000#referen1@.];
     |SI FSalida = 0;
          |LEE 000#referen1@.a;
     |SINO;
          |LEE 000#referen1@.u;
     |FINSI;
     |SI FSalida = 0; |Y #referen1@#29 = #0#29; |Y #referen1@#0 = #0#0;
          nLin = #referen1@#1 + #20#236;
     |SINO;
          nLin = #20#236;
     |FINSI;
     |DDEFECTO #referen1@;
     #referen1@#29 = #0#29;
     #referen1@#0 = #0#0;
     #referen1@#1 = nLin;
     #referen1@#2 = #referen2@#7;
     #referen1@#3 = 1;
     #referen1@#4 = #referen2@#8;
     #referen1@#5 = #referen2@#6;
     #referen1@#11 = #referen2@#9;
     |SI def_exp = "S"; #referen1@#11 = 0; |FINSI;
     #referen1@#13 = #referen2@#10;
     #referen1@#15 = #1#3;
     #referen1@#16 = #1#34;
     #referen1@#17 = #1#35;
     #referen1@#48 = 1;
     #referen1@#49 = #referen2@#2;

     |SALVA_DATOS #0;

     |SALVA_DATOS #referen1@;
     |REPON_DATOS #0;
     |HAZ PrecioArti;
     enForma = 1;
     |HAZ AcumulaAV;
     #0#14 = enCoste;
     |HAZ TotalLin71;
     |HAZ AcuAlbaran;
     |SALVA_DATOS #0;
     |REPON_DATOS #referen1@;
     |GRABA 020#referen1@.n;

     |REPON_DATOS #0;
     nHay = 1;
|FPRC;

|DEFBUCLE gestrw02;
     #referen2@#1001;
     ;
     001;
     999;
     ;
     NULL, gestrw02;
|FIN;

|PROCESO GestralLector;
     nHay = 0;
     |DDEF aPath;
     aAlfa = aPath + "gestrw02";
     |CARGA_DEF aAlfa, referen2@;
     |SI FSalida = 0;
          aAlfa = aPath + "agifa071";
          |CARGA_DEF aAlfa, referen1@;
          |SI FSalida = 0;
               |HAZ CreaTempo; |NOME_DAT #referen2@#Tempo#; |DELINDEX #referen2@;
               eaSerie = #0#29;
               enCodigo = #0#0;
               aAlfa = "gestrw02;ALB" + Tempo;
               |SUB_EJECUTA_NP aAlfa;
               aponer = Asino; |HAZ poncontr;
               |ABRE #referen1@;
               |BUCLE gestrw02;
               |CIERRA #referen1@;
               aponer = Anosi; |HAZ poncontr;
               |HAZ BoraTempo; |DELINDEX #referen2@;
               |DESCARGA_DEF #referen1@;
          |FINSI;
          |DESCARGA_DEF #referen2@;
     |FINSI;
     |SI nHay = 1;
          |PTEC 816; |PTEC 812;
     |SINO;
          |PTEC 802;
          |ERROR;
     |FINSI;
|FPRC;

|PROCESO Boletin;
     |SI aArtBol ! #0#2; |O aPartBol ! #0#49;
          eaSerie = #0#29;
          enCodigo = #0#0;
          enLinea = #0#1;
          eaTipo = "V";
          eaArticulo = #0#2;
          eaPartida = #0#49;
          |SUB_EJECUTA_NP "qdclor10;ALTA";
          |HAZ PinQDClor71;
          aArtBol = #0#2;
          aPartBol = #0#49;
     |FINSI;
|FPRC;

|PROCESO CoimaCheqRep;
     |ABRE #6;
     #6#0 = #1#3;
     |LEE 000#6=;
     |SI FSalida ! 0; |DDEFECTO #6; |FINSI;
     |CIERRA #6;

     |DDEF aAlfa;
     aAlfa = aAlfa + "coima016";
     |CARGA_DEF aAlfa, referen1@;
     |SI FSalida = 0;
          |ABRE #referen1@;
          #referen1@#0 = #2#125;
          |LEE 000#referen1@.=;
          |SI FSalida ! 0; |DDEFECTO #referen1@; |FINSI;
          |CIERRA #referen1@;
          |SI #referen1@#1 = 1; |Y #1#6 ! #6#25;
               aAlfa = "0000El representante debera ser el 1: " + #6#25;
               |MENAV aAlfa;
          |FINSI;
          |SI #referen1@#1 = 2; |Y #1#6 ! #6#26;
               aAlfa = "0000El representante debera ser el 2: " + #6#26;
               |MENAV aAlfa;
          |FINSI;
          |DESCARGA_DEF #referen1@;
     |SINO;
          |MENAV "000Error al cargar 'coima016'";
     |FINSI;
|FPRC;

|PROCESO EvaGraba;
     |DDEF aAlfa;
     aAlfa = aAlfa + "evarm022";
     |CARGA_DEF aAlfa, referen1@;
     |SI FSalida = 0;
          |DDEFECTO #referen1@;
          |ABRE #referen1@;
          #referen1@#0 = #0#29;
          #referen1@#1 = #0#0;
          #referen1@#2 = #0#1;
          #referen1@#3 = #0#2;
          ||#referen1@#4
          #referen1@#5 = #0#31;
          #referen1@#6 = #0#12;
          #referen1@#7 = #0#21;
          ||#referen1@#8
          #referen1@#9 = #1#1;
          #referen1@#10 = #1#3;
          #referen1@#11 = #0#5;
          |LEE 101#referen1@.=;
          |SI nForma = 1;
               |SI FSalida ! 0;
                    |GRABA 020#referen1@.n;
               |SINO;
                    |GRABA 020#referen1@.a;
               |FINSI;
          |SINO;
               |SI FSalida = 0;
                    |BORRA 020#referen1@.a;
               |FINSI;
          |FINSI;
          |CIERRA #referen1@;
          |DESCARGA_DEF #referen1@;
     |SINO;
          |MENAV "0000Error al cargar 'evarm022'";
     |FINSI;
|FPRC;

|PROCESO ChampEnvase;
     nLin = nLin + 1;
     |SI nLin > 1;
          |SI nLin = 2;
               aponer = Asino; |HAZ poncontr;
          |FINSI;
          #referen1@#29 = #0#29;
          #referen1@#0 = #0#0;
          #referen1@#1 = 999;
          |LEE 000#referen1@.];
          |SI FSalida = 0;
               |LEE 000#referen1@.a;
          |SINO;
               |LEE 000#referen1@.u;
          |FINSI;
          |SI FSalida = 0; |Y #referen1@#29 = #0#29; |Y #referen1@#0 = #0#0;
               nLin = #referen1@#1 + #20#236;
          |SINO;
               nLin = #20#236;
          |FINSI;
          |SI nLin = #0#1; nLin = nLin + 1; |FINSI;

          |SALVA_DATOS #0;
          |REPON_DATOS #referen1@;
          #referen1@#1 = nLin;
          #referen1@#5 = #referen3@#3 - #referen3@#4;
          |SALVA_DATOS #referen1@;
          |REPON_DATOS #0;
          enForma = 1;
          |HAZ AcumulaAV;
          #0#14 = enCoste;
          |HAZ TotalLin71;
          |HAZ AcuAlbaran;
          |SALVA_DATOS #0;
          |REPON_DATOS #referen1@;
          |GRABA 020#referen1@.n;

          |DDEFECTO #referen2@;
          #referen2@#0 = #referen1@#29;
          #referen2@#1 = #referen1@#0;
          #referen2@#2 = #referen1@#1;
          |LEE 101#referen2@.=;
          |SI FSalida ! 0; |GRABA 020#referen2@.b; |FINSI;
          #referen2@#3 = #referen3@#2;
          #referen2@#4 = #referen3@#3;
          #referen2@#5 = #referen3@#4;
          #referen2@#6 = #referen3@#1;
          |GRABA 020#referen2@.a;
          |LIBERA #referen2@;
     |FINSI;
|FPRC;

|DEFBUCLE ChampEnvase;
     #referen3@#1001;
     ;
     001;
     999;
     ;
     NULL, ChampEnvase;
|FIN;

|PROCESO ChampiEmarEnv;
     |DDEF aPath;
     aAlfa = aPath + "agifa071";
     |CARGA_DEF aAlfa, referen1@;
     |SI FSalida = 0;
          aAlfa = aPath + "champi04";
          |CARGA_DEF aAlfa, referen2@;
          |SI FSalida = 0;
               aAlfa = aPath + "champi09";
               |CARGA_DEF aAlfa, referen3@;
               |SI FSalida = 0;
                    |NOME_DAT #referen3@#eaTmpAV816#;
                    nLin = 0;

                    |SALVA_DATOS #0;
                    |ABRE #referen1@;
                    |ABRE #referen2@;
                    |BUCLE ChampEnvase;
                    |CIERRA #referen2@;
                    |CIERRA #referen1@;
                    |REPON_DATOS #0;
                    |SI nLin > 1;
                         aponer = Anosi; |HAZ poncontr;
                         |PTEC 809; |PTEC 816; |PTEC 806;
                    |FINSI;

                    |DELINDEX #referen3@;
                    |DESCARGA_DEF #referen3@;
               |SINO;
                    |MENAV "0000Error al cargar 'champi09'";
               |FINSI;
               |DESCARGA_DEF #referen2@;
          |SINO;
               |MENAV "0000Error al cargar 'champi04'";
          |FINSI;
          |DESCARGA_DEF #referen1@;
     |SINO;
          |MENAV "0000Error al cargar 'agifa071'";
     |FINSI;
|FPRC;

|PROCESO ChampiEmarBor;
     |DDEF aPath;
     aAlfa = aPath + "champi04";
     |CARGA_DEF aAlfa, referen1@;
     |SI FSalida = 0;
          |ABRE #referen1@;
          #referen1@#0 = #0#29;
          #referen1@#1 = #0#0;
          #referen1@#2 = #0#1;
          |BORRA 000#referen1@.c;
          |CIERRA #referen1@;
     |SINO;
          |MENAV "0000Error al cargar 'champi04'";
     |FINSI;
|FPRC;

|PROCESO ExtinCheqUni;
     nUni = 0;
     |DDEF aPath;
     aAlfa = aPath + "extm0001";
     |CARGA_DEF aAlfa, referen2@;
     |SI FSalida = 0;
          |ABRE #referen2@;
          #referen2@#0 = #0#2;
          |LEE 000#referen2@.=;
          |SI FSalida = 0; |Y #referen2@#6 = "S";
               aAlfa = aPath + "extm0019";
               |CARGA_DEF aAlfa, referen1@;
               |SI FSalida = 0;
                    |ABRE #referen1@;
                    #referen1@#0 = #0#2;
                    #referen1@#1 = "";
                    |LEE 000#referen1@.];
                    |PARA; |SI FSalida = 0; |Y #referen1@#0 = #0#2; ; |HACIENDO;
                         |SI #referen1@#9 = 0;
                              nUni = nUni + 1;
                         |FINSI;
                         |LEE 000#referen1@.s;
                    |SIGUE;
                    |CIERRA #referen1@;
                    |DESCARGA_DEF #referen1@;
               |SINO;
                    |MENAV "0000Error al cargar 'extm0019'";
               |FINSI;
          |SINO;
               nUni = #0#5;
          |FINSI;
          |DESCARGA_DEF #referen2@;
     |SINO;
          |MENAV "0000Error al cargar 'extm0001'";
     |FINSI;
     FSalida = 0;
     |SI nUni < #0#5;
          aAlfa = "0000Numeros de serie pendientes de este articulo: " + nUni;
          |MENAV aAlfa;
          FSalida = 1;
     |FINSI;
|FPRC;

|PROCESO GesiActHisto;
     aAlfa = aPath + "gesim004";
     |CARGA_DEF aAlfa, referen2@;
     |SI FSalida = 0;
          |ABRE #referen2@;
          |LEE 000#referen2@.u;
          |SI FSalida = 0
               nLin = #referen2@#0 + 1;
          |SINO;
               nLin = 1;
          |FINSI;
          #referen2@#0 = nLin;
          #referen2@#1 = #referen1@#0;
          #referen2@#2 = #referen1@#1;
          #referen2@#3 = #referen1@#6;
          #referen2@#4 = #referen1@#7;
          #referen2@#5 = #referen1@#8;
          #referen2@#6 = #referen1@#9;
          #referen2@#7 = #referen1@#10;
          #referen2@#8 = #referen1@#11;
          #referen2@#9 = #referen1@#12;
          #referen2@#10 = #referen1@#13;
          #referen2@#11 = #referen1@#14;
          #referen2@#12 = #referen1@#15;
          #referen2@#13 = #referen1@#16;
          #referen2@#14 = #referen1@#17;
          #referen2@#15 = #referen1@#18;
          #referen2@#16 = #referen1@#19;
          #referen2@#17 = #referen1@#21;
          #referen2@#18 = #referen1@#22;
          #referen2@#19 = #referen1@#23;
          #referen2@#20 = #referen1@#24;
          #referen2@#21 = #referen1@#25;
          #referen2@#22 = #referen1@#26;
          #referen2@#23 = #referen1@#27;
          #referen2@#24 = #referen1@#32;
          |GRABA 020#referen2@.n;

          #referen1@#29 = #referen2@#0;

          |CIERRA #referen2@;
          |DESCARGA_DEF #referen2@;
     |FINSI;
|FPRC;

|PROCESO GesiActMaqui;
     |HAZ GesiLeeMaqui;
     |SI eaMatri = ""; |ACABA; |FINSI;
     nSwPasa = 0;
     |DDEF aPath;
     aAlfa = aPath + "gesim001";
     |CARGA_DEF aAlfa, referen1@;
     |SI FSalida = 0;
          |SI #0#29 = #referen1@#2; |O #0#29 = #referen1@#3;
                    |O #0#29 = #referen1@#4; |O #0#29 = #referen1@#5;
               nSwPasa = 1;
          |FINSI;
          |DESCARGA_DEF #referen1@;
     |FINSI;
     |SI nSwPasa = 1; |ACABA; |FINSI;

     nModo = (FEntrada / 100) ! 0;
     aAlfa = aPath + "gesim002";
     |CARGA_DEF aAlfa, referen1@;
     |SI FSalida = 0;
          |ABRE #referen1@;
          #referen1@#0 = eaMatri;
          |LEE 101#referen1@.=;
          |SI FSalida = 0;
               nRecoge = 0;
               |SI nModo = 1;
                    |SI #referen1@#6 = #1#3; |Y #0#5 = -1;
                         |SI #referen1@#16 ! 0; |O #referen1@#18 ! 0;
                              nRecoge = 1;
                         |FINSI;
                    |FINSI;
               |SINO;
                    |SI #referen1@#6 = "      "; |Y #0#5 = -1;
                         nRecoge = 1;
                    |FINSI;
               |FINSI;
               |SI nForma = 1; |Y nRecoge = 0;
                    |ABRE #6;
                    #6#0 = #1#3;
                    |LEE 000#6=;
                    |CIERRA #6
                    #referen1@#6 = #6#0;
                    #referen1@#7 = #6#1;
                    #referen1@#32 = #6#2;
                    #referen1@#8 = #1#1;
                    #referen1@#9 = #0#9;
                    #referen1@#10 = #1#6;
                    #referen1@#15 = #0#29;
                    #referen1@#16 = #0#0;
                    #referen1@#21 = #6#17;
                    #referen1@#26 = #6#196;
                    #referen1@#27 = #6#197;
                    |SI nModo = 1; |O #referen1@#29 = 0;
                         |HAZ GesiActHisto;
                    |FINSI;
               |SINO;
                    #referen1@#6 = "";
                    #referen1@#7 = "";
                    #referen1@#32 = "";
                    #referen1@#8 = "01.01.0000";
                    #referen1@#9 = "";
                    #referen1@#10 = "";
                    #referen1@#12 = "01.01.0000";
                    #referen1@#15 = "";
                    #referen1@#16 = "";
                    #referen1@#21 = "";
                    #referen1@#26 = "";
                    #referen1@#27 = "";
                    |SI nRecoge = 1; |Y nModo = 1;
                         #referen1@#29 = 0;
                    |FINSI;
               |FINSI;
               |GRABA 020#referen1@.a;
          |FINSI;
          |CIERRA #referen1@;
          |DESCARGA_DEF #referen1@;
     |SINO;
          |MENAV "0000Error al cargar 'gesim002'";
     |FINSI;
|FPRC;

|PROCESO GesiLeeMaqui;
     |DDEF aAlfa;
     aAlfa = aAlfa + "gesim024";
     |CARGA_DEF aAlfa, referen1@;
     |SI FSalida = 0;
          |ABRE #referen1@;
          #referen1@#0 = "AV";
          #referen1@#1 = #0#29;
          #referen1@#2 = #0#0;
          #referen1@#3 = #0#1;
          |LEE 000#referen1@.=;
          |SI FSalida = 0;
               eaMatri = #referen1@#4;
          |SINO;
               eaMatri = "";
          |FINSI;
          |CIERRA #referen1@;
          |DESCARGA_DEF #referen1@;
     |SINO;
          |MENAV "0000Error al cargar 'gesim024'";
     |FINSI;
|FPRC;

|PROCESO GesiBorMaqui;
     |DDEF aAlfa;
     aAlfa = aAlfa + "gesim024";
     |CARGA_DEF aAlfa, referen1@;
     |SI FSalida = 0;
          |ABRE #referen1@;
          #referen1@#0 = "AV";
          #referen1@#1 = #0#29;
          #referen1@#2 = #0#0;
          #referen1@#3 = #0#1;
          |LEE 101#referen1@.=;
          |SI FSalida = 0;
               |BORRA 020#referen1@.a;
          |FINSI;
          |CIERRA #referen1@;
          |DESCARGA_DEF #referen1@;
     |FINSI;
|FPRC;

|PROCESO Comi071; |TIPO 0;
     |SI FSalida ! 2;
          |HAZ EsOrts;
          |SI FSalida = 0;
               enModo = (FEntrada / 100) ! 0;
               eaTipo = "A";
               eaSerie = #0#29;
               enCodigo = #0#0;
               enLinea = #0#1;
               |SUB_EJECUTA_NP "ortsm022";
               |HAZ OrtsPin071;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO OrtsPin071;
     |DDEF aAlfa;
     aAlfa = aAlfa + "ortsm022";
     |CARGA_DEF aAlfa, referen1@;
     |SI FSalida = 0;
          |ABRE #referen1@;
          #referen1@#0 = "A";
          #referen1@#1 = #0#29;
          #referen1@#2 = #0#0;
          #referen1@#3 = #0#1;
          |LEE 000#referen1@.=;
          |SI FSalida ! 0; |DDEFECTO #referen1@; |FINSI;
          |ATRI R;
          |PINTA 1113, "%Com.Rep2:";
          |ATRI I;
          |PINTA 1123, #referen1@#7;
          |ATRI 0;
          |DESCARGA_DEF #referen1@;
     |FINSI;
|FPRC;

|PROCESO ComiOrts71;
     |HAZ EsOrts;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |DDEF aAlfa;
     aAlfa = aAlfa + "ortsm021";
     |CARGA_DEF aAlfa, referen1@;
     |SI FSalida = 0;
          |ABRE #referen1@;
          #referen1@#0 = "A";
          #referen1@#1 = #0#29;
          #referen1@#2 = #0#0;
          |LEE 000#referen1@.=;
          |CIERRA #referen1@;
          eaRepre = #referen1@#4;
          eaTComision = #referen1@#5;
          |DESCARGA_DEF #referen1@;

          |HAZ Comisiones;
          eaTipo = "A";
          eaSerie = #0#29;
          enCodigo = #0#0;
          enLinea = #0#1;
          |SUB_EJECUTA_NP "ortsm022;DEFECTO";
          |HAZ OrtsPin071;
     |FINSI;
|FPRC;

|PROCESO SebaLopezHisto;
     |DDEF aDef;
     aAlfa = aDef + "sebalo04";
     |CARGA_DEF aAlfa, referen2@;
     |SI FSalida = 0;
          |ABRE #referen2@;
          #referen2@#0 = #0#29;
          #referen2@#1 = #0#0;
          #referen2@#2 = #0#1;
          |LEE 000#referen2@.=;
          |SI FSalida ! 0; |DDEFECTO #referen2@; |FINSI;
          |CIERRA #referen2@;

          aNomEnvase = "";
          aAlfa = aDef + "sebalo02";
          |CARGA_DEF aAlfa, referen1@;
          |SI FSalida = 0;
               |ABRE #referen1@;
               #referen1@#0 = #referen2@#3;
               |LEE 000#referen1@.=;
               |CIERRA #referen1@;
               aNomEnvase = #referen1@#1;
               |DESCARGA_DEF #referen1@;
          |FINSI;

          aAlfa = aDef + "sebalo06";
          |CARGA_DEF aAlfa, referen1@;
          |SI FSalida = 0;
               |ABRE #referen1@;
               |SI nForma = 1;
                    |LEE 000#referen1@.u;
                    |SI FSalida = 0;
                         nConta = #referen1@#0 + 1;
                    |SINO;
                         nConta = 1;
                    |FINSI;
                    |DDEFECTO #referen1@;
                    #referen1@#0 = nConta;
                    #referen1@#1 = #0#29;
                    #referen1@#2 = #0#0;
                    #referen1@#3 = #0#1;
                    #referen1@#4 = #1#1;
                    #referen1@#5 = #1#3;
                    #referen1@#6 = #referen2@#3;
                    #referen1@#7 = #referen2@#5;
                    #referen1@#8 = aNomEnvase;
                    |GRABA 020#referen1@.n;
               |SINO;
                    |SELECT #2#referen1@;
                    #referen1@#1 = #0#29;
                    #referen1@#2 = #0#0;
                    #referen1@#3 = #0#1;
                    |LEE 101#referen1@.=;
                    |SI FSalida = 0; |BORRA 020#referen1@.a; |FINSI;
               |FINSI;
               |CIERRA #referen1@;
               |DESCARGA_DEF #referen1@;
          |FINSI;
          |DESCARGA_DEF #referen2@;
     |FINSI;
|FPRC;
