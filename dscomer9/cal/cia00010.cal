|FICHEROS;
 cia00010 #0;
 cia00011 #1;||Temporal;
 agifa071 #2;
 agifa010 #3;
|FIN;

|VARIABLES;
     &Tempo = "";
 mes   = "";
 mesnu = 0;
 dserie = "     ";
 hserie = "zzzzz";
 dalba  = 0;
 halba  = 999999;
 dcli   = "      ";
 hcli   = "zzzzzz";
 dart   = "                    ";
 hart   = "zzzzzzzzzzzzzzzzzzzz";
 informe = "cia00010";
 sw = 0;
 cliente = "";
 abono = 0;
|FIN;


|PROCESO index;
     |ATRI P;
     |PINTA 2224," Calculando Meses ........ ";
     |ATRI 0;
     |DDEFECTO #3;
     #3#0  = #2#0; ||Albaran cabecera;
     #3#52 = #2#29;||Serie Albaran;
     |LEE 040#3=;

     |SI #3#6 ] #cia00010#4; |Y #3#6 [ #cia00010#5;
          mes = #3#1 % 402;||Coge el mes de la fecha;

          |SI #3#43 = "S";
               abono = -1;
          |SINO;
               abono = 1;
          |FINSI;

          |DDEFECTO #1;
          #1#0 = #2#15;||Cliente;
          #1#1 = #2#2; ||Articulo;
          |LEE 101#1=;
          |SI FSalida = 0;
              mesnu   = mes;
              mesnu   = mesnu + 1;
              #1mesnu = #1mesnu + (#2#5 * abono) ;||Acumula unidades;
              |GRABA 020#1a;
              |LIBERA #1;
          |SINO;
              mesnu   = mes;
              mesnu   = mesnu + 1;
              #1mesnu = #2#5 * abono;              ||Acumula unidades;
              |GRABA 020#1b;
          |FINSI;
     |FINSI;
|FPRC;


|DEFBUCLE lineas;
 #2#1;
 2,15;
 dserie,dalba,001,#0#2,#0#0;
 hserie,halba,999,#0#3,#0#1;
 be;
 NULL,index;
|FIN;

|PROCESO impre;
|SI sw = 0;
    cliente = #1#0;
    sw = 1;
|FINSI;

|SI cliente ! #1#0;
    cliente = #1#0;
    |PIEINF;
    |PRINT;
|SINO;
    |PRINT;
|FINSI;
|FPRC;


|DEFBUCLE temporal;
 #1#1;
 ;
 dcli,dart;
 hcli,hart;
 be;
 NULL,impre;
|FIN;


|PROCESO tempo;|TIPO 3;
  |HAZ CreaTempo;
  |NOME_DAT #1 Tempo; |DELINDEX #1;

  |ABRE #1;
  |ABRE #3;
    |BUCLE lineas;
    |IMPRE 0;
    |SI FSalida = 0;
       |INFOR informe;
       |SI FSalida = 0;
          |BUCLE temporal;
          |||PRINT;
          |PIEINF;
          |FININF;
       |FINSI;
       |FINIMP;
    |FINSI;
  |CIERRA #1;
  |CIERRA #3;

  |HAZ BoraTempo; |DELINDEX #1;
|FPRC;
