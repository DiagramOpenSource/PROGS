     Chequea
     CreaReserva

|FICHEROS;
     sctrm001 #1;
     sctrm003 #3;
     sctrm010 #10;
     sctrm012 #12;
     sctrm036 #36;
     sctrm038 #38;
     sctrm046 #46;
     sctrm052 #52;
     sctrm053 #53;
     sctrm068 #68;
     sctrm074 #74;
     sctrm076 #76;
     sctrm015 #115;
     sctrm048 #148;
     agifa324 #324;

     sctrm079 #79;
     sctrm080 #80;
     sctrm081 #81;
     sctrm082 #82;
     sctrm083 #83;
     sctrm084 #84;

     referen@;
|FIN;

|VARIABLES;
     MINUTOS_EXPIRA = 15;

     &enForma = 0;
     &enPax = 0;
     &enLinea = 0;
     &eaSentido = "";
     &efFechaViaje = @;

     &eaError = "";
     &enError = 0;

     aTarifa = "";
     nPaxs = 0;
     nPax = 0;
     nCuenta1 = 0;
     nCuenta2 = 0;
     nCuenta3 = 0;
     nCuenta4 = 0;
     nCuenta5 = 0;
     nCuenta6 = 0;
     fHoy = @;
     aHora = "";
     nReg = 0;
     nNume = 0;
     aAlfa = "";
     nGrupo = 0;
     nTipo = 0;
     aTlf = "";
     aTlf1 = "";
     aTlf2 = "";
     nIncBillete = 0;
     nTotBillete = 0;
     nImpDtoAuto = 0;
     nLin = 0;
     aAgencia = "";
     nMinu = 0;
     fFecha = @;
     nMinuIda = 0;
     nMinuRese = 0;
     nMinuViaje = 0;
     nMinuAhora = 0;
     aPlataforma = "";
     aPoblaOrg = "";
     aPoblaDes = "";
     nImpoLocaOrg = 0;
     aLocalizador = "";
     nLineaSer = 0;
     fDFechaLinApi = @;
     fHFechaLinApi = @;
     nImpoTasaApi = 0;
     aTypes = "";
     aLon = "";
     aCar = "";
     nPos = 0;
     i = 0;
|FIN;

|PROCESO ReseCreadas;
     #52#0 = #84#1;
     |LEE 101#52=;
     |SI FSalida = 0;
          |SI aLocalizador = "";
               aLocalizador = #52#42;
          |FINSI;
          #52#42 = aLocalizador;
          #52#107 = nImpoLocaOrg;
/*
          aAgencia = #52#43; |QBF aAgencia;
          #36#1 = #52#43;
          |LEE 000#36=;
          |SI FSalida ! 0; |DDEFECTO #36; |FINSI;
          |SI aAgencia = ""; |O #36#73 = "N";
               #52#114 = #52#32;
          |FINSI;
*/
          #52#114 = #52#32;

          |GRABA 020#52a;
          |LIBERA #52;

          #84#2 = aLocalizador;
          |GRABA 020#84a;
          |LIBERA #84;
     |FINSI;
|FPRC;

|DEFBUCLE ReseCreadas;
     #84#1;
     ;
     #79#0, 0000000;
     #79#0, 9999999;
     be;
     NULL, ReseCreadas;
|FIN;

|PROCESO Comision;
     #46#0 = #52#4;
     |LEE 000#46=;
     |SI FSalida ! 0; |DDEFECTO #46; |FINSI;

     #52#55 = 0;
     #52#121 = 0;
     #52#153 = 0;

     aAgencia = #52#43;
     nLineaSer = #52#75;

     |SI #52#6 ] 2; |O #46#21 = "S";
          #38#0 = aAgencia;
          #38#2 = nLineaSer;
          |LEE 000#38=;
          |SI FSalida = 0;
               #52#55 = #38#4;
          |SINO;
               #12#0 = nLineaSer;
               |LEE 000#12=;
               |SI FSalida = 0;
                    #52#55 = #12#9;
               |FINSI;
          |FINSI;
     |FINSI;

     #12#0 = nLineaSer;
     |LEE 000#12=;
     |SI FSalida = 0;
          #52#121 = #12#20;
     |FINSI;

     |SI #52#6 = 4; |O #52#6 = 5;
          #38#0 = #52#151;
          #38#2 = #52#75;
          |LEE 000#38=;
          |SI FSalida = 0;
               #52#153 = #38#4;
          |SINO;
               #12#0 = #52#75;
               |LEE 000#12=;
               |SI FSalida = 0;
                    #52#153 = #12#9;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;


|PROCESO Minutos;
     aAlfa = fFecha % 102; nNume = aAlfa;
     nMinu = nNume * 24 * 60;
     aAlfa = fFecha % 402; nNume = aAlfa;
     nMinu = nMinu + (nNume * 30 * 24 * 60);
     aAlfa = fFecha % 704; nNume = aAlfa;
     nMinu = nMinu + (nNume * 365 * 30 * 24 * 60);
     aAlfa = aHora % 102; nNume = aAlfa;
     nMinu = nMinu + (nNume * 60);
     aAlfa = aHora % 402; nNume = aAlfa;
     nMinu = nMinu + nNume;
|FPRC;

|PROCESO Lineas;
     #52#36 = #52#36 + #53#13;

     #53#11 = #53#9 + #53#10 + #53#13;
     |SI #115#5 = "S";
          #52#32 = #52#32 + (#53#11 - (#53#11 * #115#2 / 100));
     |SINO;
          #52#32 = #52#32 + #53#10 + (#53#9 + #53#13 - ((#53#9 + #53#13) * #115#2 / 100));
     |FINSI;
     |GRABA 020#53a;

     #52#108 = #53#10;
     #52#109 = #53#9;
     #52#110 = #53#14;
     #52#111 = #53#15;
|FPRC;

|DEFBUCLE Lineas;
     #53#1;
     ;
     #52#0, 01;
     #52#0, 99;
     be;
     NULL, Lineas;
|FIN;

|PROCESO NumViajeDia;
     |DDEF aAlfa;
     aAlfa = aAlfa + "sctrm052";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          |SELECT #5#referen@;
          #referen@#1 = #52#1;
          #referen@#7 = 9999;
          #referen@#0 = 0;
          |LEE 000#referen@.];
          |SI FSalida = 0;
               |LEE 000#referen@.a;
          |SINO;
               |LEE 000#referen@.u;
          |FINSI;
          |SI FSalida = 0; |Y #referen@#1 = #52#1
               nLin = #referen@#7 + 1;
          |SINO;
               nLin = 1;
          |FINSI;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|PROCESO Oficina;
     |DDEFECTO #46;
     |SI #79#22 = "FRS";
          #46#0 = 2;
     |SINO;
          #46#0 = 1;
     |FINSI;
     |LEE 000#46=
|FPRC;

|PROCESO ReservaFlixbus;
     |HAZ Oficina;

     |ABRE #76; |SELECT #2#76;
     #76#1 = "999999";
     |LEE 000#76=;
     |CIERRA #76;
     #12#0 = #76#3;
     |LEE 000#12=;
     |SI FSalida ! 0; |DDEFECTO #12; |FINSI;
     fDFechaLinApi = #12#22;
     fHFechaLinApi = #12#23;
     nImpoTasaApi = #12#18;

     |LEE 000#52u;
     |SI FSalida = 0; nReg = #52#0 + 1; |SINO; nReg = 1; |FINSI;

     nPax = nPax + 1;
     |DDEFECTO #52;
     #52#0 = nReg;
     #52#1 = #79#15;
     #52#2 = #79#16;
     #52#3 = #79#21;
     #52#4 = #46#0;
     #52#5 = #46#1;
     aAgencia = #79#4; |QBF aAgencia;
     |SI aAgencia ! "";
          #52#6 = 5;
     |SINO;
          #52#6 = 4;
     |FINSI;
     |HAZ NumViajeDia;
     #52#7 = nLin;

     #3#0 = aPoblaOrg;
     |LEE 000#3=;
     |SI FSalida ! 0; |DDEFECTO #3; |FINSI;
     #52#8 = aPoblaOrg;
     #52#9 = #3#1;
     #52#10 = #3#2;
     #52#11 = #3#4;

     #3#0 = aPoblaDes;
     |LEE 000#3=;
     |SI FSalida ! 0; |DDEFECTO #3; |FINSI;
     #52#12 = aPoblaDes;
     #52#13 = #3#1;
     #52#14 = #3#2;
     #52#15 = #3#4;
     #52#17 = 1;
     #52#18 = "Ida Cerrada";
     #52#19 = 1;
     #52#20 = #83#6;
     #52#21 = #83#7;
     #52#22 = 0;
     #52#23 = #83#8;
     #52#24 = #83#9;
     #52#25 = #83#11;

     #52#33 = 1;
     #52#34 = "%0";
     aAlfa = (#52#1 % 704) + (#52#1 % 402) + (#52#1 % 102) + (("0000" + #52#7) % -104);
     #52#42 = aAlfa;

     #36#1 = #79#4;
     |LEE 000#36=;
     |SI FSalida ! 0; |DDEFECTO #36; |FINSI;

     aAgencia = #79#4; |QBF aAgencia;
     |SI aAgencia ! "";
          #148#0 = #79#5;
          #148#4 = #79#4;
          |LEE 000#148=;
          |SI FSalida ! 0; |DDEFECTO #148; |FINSI;

          #52#43 = #79#4;
          #52#44 = #36#2;
          #52#45 = #82#2;
          #52#46 = #79#5;
          #52#49 = #36#4;
          #52#50 = #36#6;
          #52#51 = #36#20;

          #38#0 = #52#43;
          #38#2 = #52#22;
          |LEE 000#38=;
          |SI FSalida ! 0; |DDEFECTO #38; |FINSI;

          #52#60 = #79#22;
     |FINSI;

     #52#116 = "T";
     #52#117 = #52#1;
     #52#127 = 1;
     |SI aAgencia = ""; |O #36#73 = "N";
          #52#38 = "T";
          #52#52 = "A";
          #52#53 = "A";
          #52#63 = "T";
          #52#64 = #52#1;
          #52#65 = #52#2;
          #52#66 = #79#21;
          #52#67 = "NO FORMALIZADO PAGO";
          #52#68 = 1;
          #52#69 = #79#21;
          #52#112 = "C";
     |SINO;
          #52#38 = "R";
          #52#52 = "P";
          #52#53 = "P";
          #52#115 = 0;
          #52#160 = "WEB";
     |FINSI;

     |SELECT #2#76;
     #76#1 = "999999";
     |LEE 000#76=;

     #12#0 = #76#3;
     |LEE 000#12=;
     |SI FSalida ! 0; |DDEFECTO #12; |FINSI;

     #10#0 = #12#10;
     |LEE 000#10=;
     |SI FSalida ! 0; |DDEFECTO #10; |FINSI;

     #52#75 = #76#3;
     #52#56 = #12#10;
     #52#57 = #10#1;
     nNume = #52#1 + #1#15;
     #52#58 = nNume;
     #52#61 = "01.01.0000";
     #52#76 = #12#1;
     #52#80 = #52#75;
     #52#81 = #52#76;
     #52#94 = #79#22;

     #324#0 = #52#94;
     |LEE 000#324=;
     |SI FSalida ! 0; |DDEFECTO #324; |FINSI;
     #52#95 = #324#1;

     #52#106 = nPaxs;
     #52#107 = #79#17;
     #52#111 = 0;
     #52#130 = "SC";
     #52#136 = #324#2;

     #36#1 = #76#1;
     |LEE 000#36=;
     |SI FSalida ! 0; |DDEFECTO #36; |FINSI;
     #52#150 = #76#0;
     #52#151 = #76#1;
     #52#152 = #36#2;
     #52#160 = #79#21;
     |HAZ Comision;
     |GRABA 020#52b;

     aTlf1 = #82#5; |QBF aTlf1;
     aTlf2 = #82#6; |QBF aTlf2;
     |SI aTlf1 = "";
          aTlf = aTlf2;
     |SINO;
          aTlf = aTlf1;
          |SI aTlf2 ! ""; aTlf = aTlf1 + ", " + aTlf2; |FINSI;
     |FINSI;
     |DDEFECTO #53;
     #53#0 = #52#0;
     #53#1 = 1;
     #53#2 = #82#4;
     #53#3 = #82#3;
     #53#4 = aTlf;
     #53#5 = #82#7;
     #53#6 = "";
     || En importe de la web ya trae sumada el importe del api
     #53#9 = (#83#10 - nImpoTasaApi * nPaxs) / nPaxs;
     #53#10 = 0;

     |SI #52#20 ] fDFechaLinApi; |Y #52#20 [ fHFechaLinApi;
          #53#10 = nImpoTasaApi;
     |FINSI;

     #53#11 = 0;
     #53#14 = 0;
     #53#15 = 0;
     #53#16 = 0;
     #53#13 = 0;
     #53#17 = #82#11;
     #53#18 = #82#12;
     |GRABA 020#53n;
     |HAZ Viajeros;

     |ABRE #115;
     #115#0 = #52#33;
     |LEE 000#115=;
     |SI FSalida ! 0; |DDEFECTO #115; |FINSI;
     |CIERRA #115;

     #52#36 = 0; #52#32 = 0;
     |BUCLE Lineas;
     |SI aAgencia = ""; |O #36#73 = "N";
          #52#72 = #52#32;
     |FINSI;
     |GRABA 020#52a;
     |LIBERA #52;
     nImpoLocaOrg = nImpoLocaOrg + #52#32;

     |DDEFECTO #84;
     #84#0 = #79#0;
     #84#1 = #52#0;
     #84#2 = #52#42;
     #84#5 = "flixbus";
     #84#6 = #52#8;
     #84#7 = #52#12;
     #84#8 = #82#8;
     |GRABA 020#84n;
|FPRC;

|PROCESO sctrm068;
     |SI #68#2 ! 0;
          |SI #68#2 ! #80#3; |ACABA; |FINSI;                    || Linea
          |SI #80#5 < #68#3; |O #80#5 > #68#4; |ACABA; |FINSI; || Servicio
     |FINSI;
     |SI #79#15 < #68#5; |O #79#15 > #68#7; |ACABA; |FINSI;       || F.Rese
     |SI #79#16 < #68#6; |O #79#16 > #68#8;; |ACABA; |FINSI;       || H.Rese

     nIncBillete = nIncBillete + ((nTotBillete * #68#10 / 100)!0);
|FPRC;

|DEFBUCLE sctrm068;
     #68#2;
     11;
     #80#16, #80#2, 0000000, #80#4;
     #80#16, #80#2, 9999999, #80#4;
     ;
     NULL, sctrm068;
|FIN;

|PROCESO IncDisBillete;
     nIncBillete = 0;
     |BUCLE sctrm068;
|FPRC;

|PROCESO Tarifas;
     aAlfa = #81#3 % 102;
     |SI aAlfa = nGrupo;
          aTarifa = #81#3;
     |FINSI;
|FPRC;

|DEFBUCLE Tarifas;
     #81#1;
     ;
     #79#0, #79#19, "       ";
     #79#0, #79#19, "zzzzzzz";
     ;
     NULL, Tarifas;
|FIN;

|PROCESO BuscaTarifa;
     |SELECT #2#74;      || Equivalentes de grupos
     #74#0 = "999999";
     #74#3 = #82#8;
     |LEE 000#74=;
     |SI FSalida ! 0; |DDEFECTO #74; |FINSI;

     aTarifa = "";
     nGrupo = #74#1;
     |BUCLE Tarifas;

     |ABRE #81;
     #81#0 = #79#0;
     #81#1 = #79#19;
     #81#3 = aTarifa;
     |LEE 020#81=;
     |CIERRA #81;
|FPRC;

|PROCESO ReservaDiagram;
     |HAZ Oficina;

     #80#0 = #79#0;
     #80#1 = #79#19;
     |LEE 000#80=;  || Servicio ida

     |LEE 000#52u;
     |SI FSalida = 0; nReg = #52#0 + 1; |SINO; nReg = 1; |FINSI;

     nPax = nPax + 1;
     |DDEFECTO #52;
     #52#0 = nReg;
     #52#1 = #79#15;
     #52#2 = #79#16;
     #52#3 = #79#21;
     #52#4 = #46#0;
     #52#5 = #46#1;
     #52#6 = 1;
     |HAZ NumViajeDia;
     #52#7 = nLin;

     #3#0 = #79#7;
     |LEE 000#3=;
     |SI FSalida ! 0; |DDEFECTO #3; |FINSI;
     #52#8 = #79#7;
     #52#9 = #3#1;
     #52#10 = #3#2;
     #52#11 = #3#4;

     #3#0 = #79#8;
     |LEE 000#3=;
     |SI FSalida ! 0; |DDEFECTO #3; |FINSI;
     #52#12 = #79#8;
     #52#13 = #3#1;
     #52#14 = #3#2;
     #52#15 = #3#4;
     #52#17 = #79#1;
     |SI #52#17 = 1; #52#18 = "Ida Cerrada"; |FINSI;
     |SI #52#17 = 2; #52#18 = "Ida Cerrada Vuelta Abierta"; |FINSI;
     |SI #52#17 = 3; #52#18 = "Ida y Vuelta Cerrada"; |FINSI;
     #52#19 = 1;
     #52#20 = #80#16;
     #52#21 = #80#7;
     #52#22 = #80#5;
     #52#23 = #80#17;
     #52#24 = #80#8;
     #52#25 = #80#18;

     |SI #52#17 = 3;
          |SALVA_DATOS #80;
          #80#0 = #79#0;
          #80#1 = #79#20;
          |LEE 000#80=;  || Servicio Vuelta

          #52#26 = #80#16;
          #52#27 = #80#7;
          #52#28 = #80#5;
          #52#29 = #80#17;
          #52#30 = #80#8;
          #52#31 = #80#18;

          #52#100 = #80#13;
          #52#102 = #80#4;
          #52#105 = #80#2;

          |REPON_DATOS #80;
     |FINSI;
     #52#33 = 1;
     #52#34 = "%0";
     aAlfa = (#52#1 % 704) + (#52#1 % 402) + (#52#1 % 102) + (("0000" + #52#7) % -104);
     #52#42 = aAlfa;

     #36#1 = #79#4;
     |LEE 000#36=;
     |SI FSalida ! 0; |DDEFECTO #36; |FINSI;

     aAgencia = #79#4; |QBF aAgencia;
     |SI aAgencia ! "";
          #52#6 = 2;
          #148#0 = #79#5;
          #148#4 = #79#4;
          |LEE 000#148=;
          |SI FSalida ! 0; |DDEFECTO #148; |FINSI;

          #52#43 = #79#4;
          #52#44 = #36#2;
          #52#45 = #82#2;
          #52#46 = #79#5;
          #52#49 = #36#4;
          #52#50 = #36#6;
          #52#51 = #36#20;

          #38#0 = #52#43;
          #38#2 = #52#22;
          |LEE 000#38=;
          |SI FSalida ! 0; |DDEFECTO #38; |FINSI;

          #52#60 = #79#22;
     |FINSI;

     #52#116 = "T";
     #52#117 = #52#1;
     #52#127 = 1;
     |SI aAgencia = ""; |O #36#73 = "N";
          #52#38 = "T";
          #52#52 = "A";
          #52#53 = "A";
          #52#63 = "T";
          #52#64 = #52#1;
          #52#65 = #52#2;
          #52#66 = #79#21;
          #52#67 = "NO FORMALIZADO PAGO";
          #52#68 = 1;
          #52#69 = #79#21;
          #52#112 = "C";
     |SINO;
          #52#38 = "R";
          #52#52 = "P";
          #52#53 = "P";
          #52#115 = 0;
          #52#160 = "WEB";
     |FINSI;

     #12#0 = #80#3;
     |LEE 000#12=;
     |SI FSalida ! 0; |DDEFECTO #12; |FINSI;

     #10#0 = #12#10;
     |LEE 000#10=;
     |SI FSalida ! 0; |DDEFECTO #10; |FINSI;

     #52#75 = #80#3;
     #52#56 = #12#10;
     #52#57 = #10#1;
     nNume = #52#1 + #1#15;
     #52#58 = nNume;
     #52#61 = "01.01.0000";
     #52#76 = #12#1;
     #52#80 = #52#75;
     #52#81 = #52#76;
     #52#94 = #79#22;

     #324#0 = #52#94;
     |LEE 000#324=;
     |SI FSalida ! 0; |DDEFECTO #324; |FINSI;
     #52#95 = #324#1;
     #52#96 = #80#2;
     #52#99 = #80#13;
     #52#101 = #80#4;
     #52#106 = nPaxs;
     #52#107 = #79#17;
     #52#130 = "SC";
     #52#136 = #324#2;
     |SI #52#6 = 1;
          #52#160 = #79#21;
     |FINSI;
     |HAZ Comision;
     |GRABA 020#52b;

     |HAZ BuscaTarifa;

     aAlfa = #81#3 % 102; nGrupo = aAlfa;
     aAlfa = #81#3 % 404; nTipo = aAlfa;

     aTlf1 = #82#5; |QBF aTlf1;
     aTlf2 = #82#6; |QBF aTlf2;
     |SI aTlf1 = "";
          aTlf = aTlf2;
     |SINO;
          aTlf = aTlf1;
          |SI aTlf2 ! ""; aTlf = aTlf1 + ", " + aTlf2; |FINSI;
     |FINSI;

     |DDEFECTO #53;
     #53#0 = #52#0;
     #53#1 = 1;
     #53#2 = #82#4;
     #53#3 = #82#3;
     #53#4 = aTlf;
     #53#5 = #82#7;
     #53#6 = "";
     #53#7 = nGrupo;
     #53#8 = nTipo
     #53#9 = #81#8;
     #53#10 = #81#9;
     #53#11 = 0;
     #53#14 = #81#6;
     #53#15 = #81#7;
     #53#16 = #81#11;
     #53#17 = #82#11;
     #53#18 = #82#12;

     nTotBillete = #53#9 + #53#10; |HAZ IncDisBillete;
     nImpDtoAuto = #53#9 * #53#16 / 100;
     #53#13 = nIncBillete - nImpDtoAuto;
     |GRABA 020#53n;
     |HAZ Viajeros;

     |ABRE #115;
     #115#0 = #52#33;
     |LEE 000#115=;
     |SI FSalida ! 0; |DDEFECTO #115; |FINSI;
     |CIERRA #115;

     #52#36 = 0; #52#32 = 0;
     |BUCLE Lineas;
     |SI aAgencia = ""; |O #36#73 = "N";
          #52#72 = #52#32;
     |FINSI;
     |GRABA 020#52a;
     |LIBERA #52;
     nImpoLocaOrg = nImpoLocaOrg + #52#32;

     #82#9 = #52#0;
     #82#10 = #52#42;
     |GRABA 020#82a;

     |DDEFECTO #84;
     #84#0 = #79#0;
     #84#1 = #52#0;
     #84#2 = #52#42;
     #84#5 = "diagram";
     #84#6 = #52#8;
     #84#7 = #52#12;
     #84#8 = #82#8;
     |GRABA 020#84n;

     enForma = 1;
     |HAZ Actualiza;

     nNume = #52#20 - #52#99 + 1;
     enPax = 1;
     enLinea = #52#75;
     eaSentido = #52#101;
     efFechaViaje = nNume;
     |HAZ CtrlViajerosAct;
|FPRC;

|PROCESO Paxs;
     |SI aPlataforma = "diagram";
          |SI #83#1 = "I";    || solo la ida ya que la de diagram
                              || graba ida y vuelta
               |HAZ ReservaDiagram;
          |FINSI;
     |SINO;
          |SI #83#1 = "I";
               aPoblaOrg = #83#4;
               aPoblaDes = #83#5;
          |SINO;
               aPoblaOrg = #83#5;
               aPoblaDes = #83#4;
          |FINSI;
          |HAZ ReservaFlixbus;
     |FINSI;
|FPRC;

|DEFBUCLE Paxs;
     #82#1;
     ;
     #79#0, 001;
     #79#0, 999;
     be;
     NULL, Paxs;
|FIN;

|PROCESO Viajes;
     aPlataforma = #83#3; |QBF aPlataforma;
     nPax = 0;
     |BUCLE Paxs;
|FPRC;

|DEFBUCLE Viajes;
     #83#1;
     ;
     #79#0, " ", 1;
     #79#0, "z", 3;
     be;
     NULL, Viajes;
|FIN;

|PROCESO CreaReserva;
     nImpoLocaOrg = 0;
     |ABRE #1; |LEE 000#1p; |CIERRA #1;
     |ABRE #3;
     |ABRE #10;
     |ABRE #12;
     |ABRE #36;
     |ABRE #38;
     |ABRE #46;
     |ABRE #52;
     |ABRE #53;
     |ABRE #74;
     |ABRE #76;
     |ABRE #80;
     |ABRE #84;
     |ABRE #148;
     |ABRE #324;
     |BUCLE Viajes;
     |CIERRA #324;
     |CIERRA #148;
     |CIERRA #84;
     |CIERRA #80;
     |CIERRA #76;
     |CIERRA #74;
     |CIERRA #53;
     |CIERRA #52;
     |CIERRA #46;
     |CIERRA #38;
     |CIERRA #36;
     |CIERRA #12;
     |CIERRA #10;
     |CIERRA #3;

     #79#17 = nImpoLocaOrg;
     |GRABA 020#79a;

     aLocalizador = "";
     |ABRE #36;
     |ABRE #52;
     |ABRE #84;
     |BUCLE ReseCreadas; || Act. Total Localizador Origen
     |CIERRA #84;
     |CIERRA #36;
     |CIERRA #52;
|FPRC;
-----------------------------------------------------------------
|PROCESO SacaGrupo;
     aTypes = #74#3; |QBT aTypes;  ||Puede haber varios separados por comas
     aLon = aTypes % A0;
     |PARA i = 1; |SI i [ aLon; |HACIENDO i = i + 1;
          nPos = i * 100 + 1;
          aCar = aTypes % nPos;
          |SI aCar ! ",";
               |SI aCar = #82#8;
                    nGrupo = #74#1;
                    |SAL; |ERROR;
               |FINSI;
          |FINSI;
     |SIGUE;
|FPRC;

|DEFBUCLE SacaGrupo;
     #74#1;
     ;
     "999999", 00
     "999999", 99;
     ;
     NULL, SacaGrupo;
|FIN;

|PROCESO CheqTarifa;
/*
     |SELECT #2#74;      || Equivalentes de grupos
     #74#0 = "999999";
     #74#3 = #82#8;
     |LEE 000#74=;
     |SI FSalida ! 0; |DDEFECTO #74; |FINSI;

     aTarifa = "";
     nGrupo = #74#1;
     |BUCLE Tarifas;
     |SI aTarifa = "";
          enError = 7;
          eaError = "No se encuentra tarifa a aplicar";
     |FINSI;
*/

     |BUCLE SacaGrupo;
     aTarifa = "";
     |BUCLE Tarifas;
     |SI aTarifa = "";
          enError = 7;
          eaError = "No se encuentra tarifa a aplicar";
     |FINSI;
|FPRC;

|DEFBUCLE CheqTarifa;
     #82#1;
     ;
     #79#0, 001;
     #79#0, 999;
     be;
     NULL, CheqTarifa;
|FIN;

|PROCESO CuentaPaxs;
     |SI #82#8 = 1; nCuenta1 = nCuenta1 + 1; |FINSI;
     |SI #82#8 = 2; nCuenta2 = nCuenta2 + 1; |FINSI;
     |SI #82#8 = 3; nCuenta3 = nCuenta3 + 1; |FINSI;
     |SI #82#8 = 4; nCuenta4 = nCuenta4 + 1; |FINSI;
     |SI #82#8 = 5; nCuenta5 = nCuenta5 + 1; |FINSI;
     |SI #82#8 = 6; nCuenta6 = nCuenta6 + 1; |FINSI;
|FPRC;

|DEFBUCLE CuentaPaxs;
     #82#1;
     ;
     #79#0, 001;
     #79#0, 999;
     ;
     NULL, CuentaPaxs;
|FIN;

|PROCESO CheqViajes;
     aAlfa = #83#3; |QBF aAlfa;
     |SI aAlfa = "diagram";   || Solo puede haber uno o ninguno de diagram
          |ABRE #80;
          #80#0 = #79#0;
          #80#1 = #79#19;
          |LEE 000#80=;
          |SI FSalida ! 0;
               eaError = "Servicio ida no disponible";
               enError = 8;
          |SINO;
               |SI #80#15 ! "I";
                    eaError = "Servicio ida incorrecto";
                    enError = 9;
               |FINSI;
          |FINSI;
          |SI #79#1 = 3; || Tipo viaje
               #80#0 = #79#0;
               #80#1 = #79#20;
               |LEE 000#80=;
               |SI FSalida ! 0;
                    eaError = "Servicio vuelta no disponible";
                    enError = 10;
               |SINO;
                    |SI #80#15 ! "V";
                         eaError = "Servicio vuelta incorrecto";
                         enError = 11;
                    |FINSI;
               |FINSI;
          |FINSI;

          |ABRE #74;
          |BUCLE CheqTarifa;
          |CIERRA #74;
     |FINSI;

     |SI enError ! 0; |ERROR10; |FINSI;
|FPRC;

|DEFBUCLE CheqViajes;
     #83#1;
     ;
     #79#0, "I", 1;      || Solo puede haber 3 viajes como m ximo
     #79#0, "I", 3;
     ;
     NULL, CheqViajes;
|FIN;

|PROCESO Chequea;
     |BUCLE CheqViajes;
     |SI enError ! 0; |ACABA; |FINSI;

     nPaxs = #79#9 + #79#10 + #79#11 + #79#12 + #79#13 + #79#14;
     nCuenta1 = 0;
     nCuenta2 = 0;
     nCuenta3 = 0;
     nCuenta4 = 0;
     nCuenta5 = 0;
     nCuenta6 = 0;
     |BUCLE CuentaPaxs;
     |SI nCuenta1 ! #79#9; eaError = "Numero de paxs senior incorrecto"; enError = 12; |ACABA; |FINSI;
     |SI nCuenta2 ! #79#10; eaError = "Numero de paxs adulto incorrecto"; enError = 13; |ACABA; |FINSI;
     |SI nCuenta3 ! #79#11; eaError = "Numero de paxs joven incorrecto"; enError = 14; |ACABA; |FINSI;
     |SI nCuenta4 ! #79#12; eaError = "Numero de paxs ni¤o incorrecto"; enError = 15; |ACABA; |FINSI;
     |SI nCuenta5 ! #79#13; eaError = "Numero de paxs bebe incorrecto"; enError = 16; |ACABA; |FINSI;
     |SI nCuenta6 ! #79#14; eaError = "Numero de paxs otro incorrecto"; enError = 17; |ACABA; |FINSI;

     fFecha = ~; |HORA aHora; |HAZ Minutos;
     nMinuAhora = nMinu;

     fFecha = #79#15; aHora = #79#16; |HAZ Minutos;
     nMinuRese = nMinu;

     nNume = nMinuAhora - nMinuRese;
     |SI nNume > MINUTOS_EXPIRA;
          eaError = "Reserva expirada";
          enError = 18;
          |ACABA;
     |FINSI;
     ||--- Todo ok
     enError = 0;
|FPRC;
