|FICHEROS;
     foto0030 #0;
     agifa017 #17;
     foto0011 #11;
     agifa019 #19;||articulos
     agifa065 #65;||historico
|FIN;

||*** PROCESOS QUE ACTUALIZAN EL HISTORICO

|PROCESO act_historicoP;
#65#0= #0#0;||cod art
#65#1=#0#3;||fecha
#65#2="ES";||codigo operacion
#65#3="  ";||codigo de documento
#65#5=#0#1;||almacen
#65#6=#0#2;||unidades
||#65#7=;||stock resultante
||#65#8=;||PCM
||#65#9=;||Precio Venta/Compra
#65#11="  ";||serie
|GRABA 000#65n;
|FPRC;

|PROCESO act_historicoN;
#65#0= #11#2;||cod art
#65#1=#0#3;||fecha
#65#2="SS";||codigo operacion
#65#3="  ";||codigo de documento
#65#5=#0#1;||almacen
#65#6=-(#0#2 * #11#3);||unidades
||#65#7=;||stock resultante
||#65#8=;||PCM
||#65#9=;||Precio Venta/Compra
#65#11="  ";||serie
|GRABA 000#65n;
|FPRC;



||*** PROCESOS QUE ACTUALIZA EL ARTICULO

|PROCESO Act_Art;
     #19#0 = #11#2;
     |LEE 000#19=;
     #19#6 = #19#6 - (#0#2 * #11#3);
     #19#104 = #19#104 - (#0#2 * #11#3);
     |GRABA 000#19a;
|FPRC;

|PROCESO foto011_1;
     #17#0=#11#2;
     #17#1=#0#1;
     |LEE 000#17=;
     |SI FSalida = 0;
            #17#5 = #17#5 - (#0#2 * #11#3);
            #17#39 = #17#39 - (#0#2 * #11#3);
            |GRABA 010#17a;
     |SINO;
            #17#5  = (#0#2 * #11#3);
            #17#39 = (#0#2 * #11#3);
            |GRABA 010#17n;
     |FINSI;
     |HAZ Act_Art;
     |HAZ act_historicoN;
|FPRC;

|DEFBUCLE foto0011;
     #11#1;
     ;
     #0#0,1;
     #0#0,999;
     be;
     NULL,foto011_1;
|FIN;

|PROCESO Act_Pack;
     #19#0 = #0#0;
     |LEE 000#19=;
     #19#6 = #19#6 + #0#2 ;
     #19#104 = #19#104 + #0#2;
     |GRABA 000#19a;
|FPRC;



|PROCESO inc_art_alm;
     #17#0=#0#0;
     #17#1=#0#1;
     |LEE 000#17=;
     |SI FSalida = 0;
            #17#5 = #17#5 + #0#2;
            #17#39 = #17#39 + #0#2;
            |GRABA 010#17a;
     |SINO;
            #17#5 = #0#2;
            #17#39 =#0#2;
            |GRABA 010#17n;
     |FINSI;
     |HAZ Act_Pack;
     |HAZ act_historicoP;
|FPRC;

|PROCESO actualiza_stock;|TIPO 30;
     |ABRET #17;
     |ABRE #19;
     |ABRE #65;
     |HAZ inc_art_alm;
     |BUCLE foto0011;
     |LIBERA #65;
     |CIERRA #65;
     |LIBERA #19;
     |LIBERA #17;
     |CIERRA #19;
     |CIERRAT #17;
|FPRC;
