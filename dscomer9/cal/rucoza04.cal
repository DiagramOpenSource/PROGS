|FICHEROS;
     rucom014 #14;
     agifa007 #7;
     agifa010 #10;
     agifa019 #19;
     agifa024 #24;
     agifa025 #25;
     agifa041 #41;
     agifa071 #71;
     agifa077 #77;
     agifa080 #80;
     agifa112 #112;
     agifa142 #142;
     agifa321 #321;
     agifa324 #324;
|FIN;

|VARIABLES;
     &enSwCheq = 0;
     &precio_base = 0;
     &nDeci_PreBase = 0;
     &enSwMenu = 0;
     &aMoneda = "";
     &aDivisa = "";
     &eaTag = "";
     &enDescuento1 = 0;
     &enDescuento2 = 0;
     &eaTComision = 0;
     &enComision = 0;
     nImpo = 0;
     aMes = "";
     nMes = 0;
     nForma = 0;
     aAlfa = "";
     importe = 0;
     cant = 0;
|FIN;

|INCLUYE i_varart;

|PROCESO pcmlinea;
     enPrecioB  = precio_base;
     enDeciB    = nDeci_PreBase;
     enForma = nForma;
     eaDocu = "agifa077";
     |HAZ StockEntra;

     |ABRE #112;
     nImpo = (#80#9 < #77#5) < #77#32;
     |SI #142#114 = "S";
          nImpo = nImpo < #77#7;
     |FINSI;
     #112#0 = #77#3;
     |LEE 101#112=;
     |SI FSalida = 0;
         aMes = #77#1 % A402;
         nMes = aMes + 26;
         |SI #77#42 = "N";
             #112nMes = #112nMes + (nImpo * nForma);
             #112#39 = #112#39 + (nImpo * nForma);
         |SINO;
             #112nMes = #112nMes - (nImpo * nForma);
             #112#39 = #112#39 - (nImpo * nForma);
         |FINSI;
         |GRABA 020#112a;
     |FINSI;
     |CIERRA #112;

     |SI #77#42 = "N";
          enImpPrvCom = nImpo * nForma;
     |SINO;
          enImpPrvCom = -nImpo * nForma;
     |FINSI;
     efFecha = #77#1;
     eaProve = #77#3;
     |HAZ AcumulaPrv;
|FPRC;

|PROCESO BajaLinCom;
     enForma = -1;
     eaDocu = "agifa080";
     |HAZ StockEntra;
     |BORRA 020#80a;
|FPRC;

|PROCESO BajaCom;
     |ABRE #77;
     #77#50 = #14#2;
     #77#0 = #14#14;
     |LEE 101#77=;
     |SI FSalida = 0;
          |SI enSwCheq = 1;
               eaSer = #77#50;
               enDocu = #77#0;
               efFec = #77#1;
               |HAZ MiraHisC;
               enError = enErrHis;
               |SI enError = 0;
                    |SI #77#38 = "S";
                         |MENAV "0000El albar n de compras esta facturado...";
                         enError = 1;
                    |FINSI;
               |FINSI;
               |SI enError = 0;
                    |SI #77#75 = "S";
                         |MENAV "0000El albar n de compras esta exportado...";
                         enError = 1;
                    |FINSI;
               |FINSI;
          |SINO;
               aMoneda = #77#58;
               aDivisa = #77#56;
               |HAZ Divisas077;
               nForma = -1;
               |BUCLELIN 0pcmlinea#77;
               |BUCLELIN 0BajaLinCom#77;
               |BORRA 020#77a;
          |FINSI;
     |FINSI;
     |CIERRA #77;
|FPRC;

|PROCESO AlbCom;
     |ABRE #112;
     #112#0 = #14#1;
     |LEE 020#112=;
     |CIERRA #112;
     |ABRE #19;
     #19#0 = #14#7;
     |LEE 020#19=;
     |CIERRA #19;
     |DFICB aAlfa;
     |PATH_DAT #41 aAlfa;
     |DFICE aAlfa;
     aAlfa = aAlfa % -205;
     |ABRE #41;
     #41#0 = aAlfa;
     |LEE 020#41=;
     |CIERRA #41;

     |ABRE #77;
     |ABRE #80;
     #77#50 = #14#2;
     enSwMenu = 1;
     |HAZ ContaAC7;
     |GRABA 020#77b;
     #77#1 = #14#6;
     #77#3 = #112#0;
     #77#4 = #112#2;
     #77#5 = #112#24;
     #77#7 = #112#25;
     #77#8 = #112#17;
     #77#9 = #112#22;
     #77#29 = #41#1;
     #77#30 = #41#2;
     #77#31 = #41#3;
     #77#32 = #112#41;
     #77#33 = #41#4;
     #77#36 = #112#58;
     #77#52 = #112#78;
     #77#56 = #112#81;
     #77#58 = #112#82;

     |ABRE #324;
     #324#0 = #77#56;
     |LEE 000#324=;
     #77#57 = #324#3;
     #77#61 = #321#9;
     #324#0 = #77#61;
     |LEE 000#324=;
     #77#62 = #324#3;
     |CIERRA #324;

     #77#72 = #112#87;

     aMoneda = #77#58;
     aDivisa = #77#56;
     |HAZ Divisas077;

     |HAZ LimCabAgifa077;

     |DDEFECTO #80;
     #80#27 = #77#50;
     #80#0 = #77#0;
     #80#1 = 1;
     #80#2 = #19#0;
     #80#3 = 1;
     #80#4 = #19#1;
     #80#5 = #14#8;
     #80#6 = #14#4;
     #80#8 = 0; ||#19#29;
     #80#11 = #19#30;
     #80#13 = #19#2;
     #80#15 = #77#3;
     #80#26 = 0; ||#19#129;
     #80#30 = #80#6;
     #80#32 = #80#6;
     #80#45 = 0; || #19#209;
     |HAZ TotalLin80;
     |GRABA 020#80n;

     |HAZ CalCabAgifa077;
     #77#41 = #77#41 + 1;
     |GRABA 020#77a;

     nForma = 1;
     enForma = 1;
     eaDocu = "agifa080";
     |HAZ StockEntra;
     |BUCLELIN 0pcmlinea#77;
     |CIERRA #77;
     |CIERRA #80;

     #14#14 = #77#0;
|FPRC;

|PROCESO actpf;
     |SI #10#15 ] 0;
          importe = 1;
     |SINO;
          importe = -1;
          #10#15 = -#10#15;
     |FINSI;
     cant = #10#15 < #10#5;
     cant = cant < #10#32;
     cant = cant < #10#7;
     cant = cant * importe;
     #10#15 = #10#15 * importe;
     |ABRE #24;
     #24#0 = #10#3;
     |LEE 121#24=;
     |SI FSalida = 0;
          |SI #10#43 = AN;
               #24#50 = #24#50 + (cant * nForma);    || es albaran
          |SINO;
               #24#50 = #24#50 - (cant * nForma);    || es abono
          |FINSI;
          |GRABA 020#24a;
     |FINSI;
     |CIERRA #24;

     |SI #10#43 = "N";
          enImpCliPen = cant * nForma;
     |SINO;
          enImpCliPen =  -cant * nForma;
     |FINSI;
     eaCliente = #10#3;
     efFecha = #10#1;
     |HAZ AcumulaCli;

     eaTag = "AV";  |HAZ Riesgos;
|FPRC;

|PROCESO BajaLinVta;
     enForma = -1;
     |HAZ AcumulaAV;
     |BORRA 020#71a;
|FPRC;

|PROCESO BajaVta;
     |ABRE #10;
     #10#52 = #14#5;
     #10#0 = #14#15;
     |LEE 101#10=;
     |SI FSalida = 0;
          |SI enSwCheq = 1;
               eaSer = #10#52;
               enDocu = #10#0;
               efFec = #10#1;
               |HAZ MiraHisV;
               enError = enErrHis;
               |SI enError = 0;
                    |SI #10#38 = "S";
                         |MENAV "0000El albar n de ventas esta facturado...";
                         enError = 1;
                    |FINSI;
               |FINSI;
               |SI enError = 0;
                    |SI #10#39 = 999999;
                         |MENAV "0000El albar n de ventas esta modoe Exportacion...";
                         enError = 1;
                    |FINSI;
               |FINSI;
          |SINO;
               aDivisa = #10#68;
               aMoneda = #10#70;
               |HAZ Divisas010;
               nForma = -1;
               |HAZ actpf;
               |BUCLELIN 0BajaLinVta#10;
               |BORRA 020#10a;
          |FINSI;
     |FINSI;
     |CIERRA #10;
|FPRC;

|PROCESO AlbVta;
     |ABRE #24;
     #24#0 = #14#3;
     |LEE 020#24=;
     |CIERRA #24;
     |ABRE #19;
     #19#0 = #14#17;
     |LEE 020#19=;
     |CIERRA #19;
     |ABRE #25;
     #25#0 = #24#25;
     |LEE 020#25=;
     |CIERRA #25;
     |ABRE #7;
     #7#25 = #14#5;
     |LEE 020#7=;
     |CIERRA #7;

     |ABRE #10;
     |ABRE #71;
     #10#52 = #14#5;
     enSwMenu = 1;
     |HAZ ContaAV7;
     |GRABA 020#10b;
     #10#1 = #14#16;
     #10#3 = #24#0;
     #10#4 = #24#2;
     #10#5 = #24#37;
     #10#6 = #25#0;
     #10#7 = #24#38;
     #10#8 = #24#20;
     #10#9 = #24#35;
     #10#29 = #24#2;
     #10#30 = #24#5;
     #10#31 = #24#6;
     #10#32 = #24#156;
     #10#33 = #24#7;
     #10#34 = #25#7;
     #10#35 = #24#4;
     #10#36 = #24#47;
     #10#40 = #24#41;
     #10#50 = #24#40;
     #10#51 = #7#28;
     #10#62 = #24#180;
     #10#63 = #24#15;
     #10#68 = #24#192;  ||Divisa
     #10#88 = #24#202;
     |ABRE #324;
     #324#0 = #10#68;
     |LEE 020#324=;
     #10#69 = #324#2;
     #10#70 = #24#193;
     #10#73 = #321#9;
     #324#0 = #10#73;
     |LEE 020#324=;
     #10#74 = #324#2; ||Cambio
     |CIERRA #324;
     #10#91 = #24#206;
     aDivisa = #10#68;
     aMoneda = #10#70;
     |HAZ Divisas010;
     |HAZ LimCabAgifa010;
     |DDEFECTO #71;
     #71#29 = #10#52;
     #71#0 = #10#0;
     #71#1 = 1;
     #71#2 = #19#0;
     #71#3 = 1;
     #71#4 = #19#1;
     #71#5 = #14#18;
     #71#6 = #14#19;
     #71#8 = 0;
     enDescuento1 = #71#8;
     enDescuento2 = #71#33;
     eaTComision = #71#16;
     eaCliente = #10#3;
     eaArticulo = #71#2;
     eaRepre = #10#6;
     enDirEnt = #10#84;
     enAlmacen = #71#3;
     |HAZ Comisiones;
     #71#10 = enComision;
     #71#11 = #19#30;
     #71#13 = #19#2;
     #71#15 = #10#3;
     #71#16 = #10#34;
     #71#17 = #10#35;
     #71#36 = #71#6;
     #71#38 = #71#6;
     |HAZ TotalLin71;
     enForma = 1;
     |HAZ AcumulaAV;
     #71#14 = enCoste;
     |HAZ CalCabAgifa010;
     |GRABA 020#71n;
     nForma = 1;
     |HAZ actpf;
     |GRABA 020#10a;
     |CIERRA #71;
     |CIERRA #10;

     #14#15 = #10#0;
|FPRC;
