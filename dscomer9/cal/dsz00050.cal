|FICHEROS;
     dsz00050 #0;

     agifa081 #81;
     agifa067 #67;

     agifa077 #77;
     agifa080 #80;

     agifa079 #79;
     agifa072 #72;


     tempo081 #1; || Temporal Albaranes
     tempo134 #2; || Temporal Facturas
|FIN;

|VARIABLES;
     &Tempo = "";
     &aDivisa   = "";
     &aMoneda   = "";
     aTmp1 = "";
     aTmp2 = "";
     aAlfa = "";
|FIN;

|PROCESO Modi; |TIPO 7;
     aAlfa = #0#8;
     |C_M #0#10, 1, aAlfa;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO Tmp2;
     #79#66 = #2#0;
     #79#0 = #2#1;
     |LEE 121#79=;
     |SI FSalida = 0;
          aDivisa = #79#75;
          aMoneda = #79#77;
          |HAZ Divisas079;

          |HAZ CalCabAgifa079;
          |GRABA 020#79a;
          |LIBERA #79;
     |FINSI;
|FPRC;

|DEFBUCLE Tmp2;
     #2#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Tmp2;
|FIN;

|PROCESO FacAdj;
     #1#0 = #72#17;
     #1#1 = #72#2;
     |LEE 000#1=;
     |SI FSalida = 0;
          #2#0 = #72#16;
          #2#1 = #72#0;
          |GRABA 000#2n;
     |FINSI;
|FPRC;

|DEFBUCLE FacAdj;
     #72#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, FacAdj;
|FIN;

|PROCESO RecalLinAlb;
     |HAZ TotalLin80;
     |GRABA 020#80a;
     |HAZ CalCabAgifa077;
|FPRC;

|PROCESO AsignaPrecio;
     #67#28 = #80#29;
     #67#0 = #80#12;
     #67#1 = #80#21;
     |LEE 020#67=;
     |SI FSalida = 0;
          #81#25 = #67#28;
          #81#0 = #67#0;
          |LEE 020#81=;

          aDivisa = #81#27;
          aMoneda = #81#29;
          |HAZ Divisas081;

          #80#6 = #67#6;
          #80#30 = #67#33;
          #80#32 = #67#35;
          |GRABA 020#80a;
     |FINSI;
     |LIBERA #80;
|FPRC;

|PROCESO Tmp1;
     #77#50 = #1#0;
     #77#0 = #1#1;
     |LEE 121#77=;
     |SI FSalida = 0;
          aDivisa = #77#56;
          aMoneda = #77#58;
          |HAZ Divisas077;
          |SI #0#10 = "S";
               |BUCLELIN 0 AsignaPrecio #77;
          |FINSI;
          |SI #0#8 = "S";
               aDivisa = #77#56;
               aMoneda = #77#58;
               |HAZ Divisas077;

               |HAZ LimCabAgifa077;
               |BUCLELIN 0 RecalLinAlb #77;
               |GRABA 020#77a;
          |FINSI;
          |LIBERA #77;
     |FINSI;
|FPRC;

|DEFBUCLE Tmp1;
     #1#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Tmp1;
|FIN;

|PROCESO AlbAdj;
     #1#0 = #80#27;
     #1#1 = #80#0;
     |GRABA 000#1n;
|FPRC;

|DEFBUCLE AlbAdj;
     #80#3;
     ;
     #67#28, #67#0, #67#1;
     #67#28, #67#0, #67#1;
     ;
     NULL, AlbAdj;
|FIN;

|PROCESO agifa067;
     |BUCLE AlbAdj;
|FPRC;

|PROCESO agifa081;
     aDivisa = #81#27;
     aMoneda = #81#29;

     |HAZ Divisas081;
     |HAZ CalCabAgifa081;
|FPRC;

|DEFBUCLE agifa081;
     #81#1;
     4,1;
     #0#0, #0#2, #0#4, #0#6;
     #0#1, #0#3, #0#5, #0#7;
     be;
     NULL, agifa081, agifa067;
|FIN;

|PROCESO Tipo3; |TIPO 3;
     |HAZ CreaTempo; aTmp1 = Tempo; |NOME_DAT #1 Tempo; |DELINDEX #1;
     |HAZ CreaTempo; aTmp2 = Tempo; |NOME_DAT #2 Tempo; |DELINDEX #2;

     |ABRE #1;
     |BUCLE agifa081;
     |CIERRA #1;

     |ABRE #67;
     |ABRE #77;
     |ABRE #81;
     |BUCLE Tmp1;
     |CIERRA #81;
     |CIERRA #77;
     |CIERRA #67;

     |SI #0#9 = "S";
          |ABRE #2;
          |ABRE #1;
          |BUCLE FacAdj;
          |CIERRA #1;
          |CIERRA #2;
          |ABRE #79;
          |BUCLE Tmp2;
          |CIERRA #79;
     |FINSI;
|ABRE #1;
|ABRE #2;
||CONSULTA_CLAVE #1#1;
||CONSULTA_CLAVE #1#2;
|CIERRA #1;
|CIERRA #2;

     |DELINDEX #1; Tempo = aTmp1; |HAZ BoraTempo;
     |DELINDEX #2; Tempo = aTmp2; |HAZ BoraTempo;
|FPRC;
