|FICHEROS;
     agifa027 #8;
     dsm00054 #30;
     dsm00055 #31;
     goparame #100;
     agifa077 #101,MANTE;
     agifa080 #102,MANTE;
     agifa017 #103;
     agifa019 #104;
     agifa024 #105;
|FIN;
--------------------------------------------------------------------------------
|VARIABLES;
     &xQtip         = 0;
     &nDeci_PreBase = 0;
     &nDeci_PreBaseMx = 0;
     &xQuien        = 0;
     &xDocTras      = 0;
     &xSerie        = "";
     &xFecDocu      = @;
     &xLinDocu      = 0;
     &xCodArti      = "";
     &xDesArti      = "";
     &xCanArti      = 0;
     &xAlmEntr      = 0;
     &xAlmSali      = 0;
     &xModo         = 0;
     &xForma        = 0;

     nSwAct         = 0;
     entrad         = 0;
     nModo          = 0;
     nConta         = 0;
|FIN;
--------------------------------------------------------------------------------
|INCLUYE i_varart;
--------------------------------------------------------------------------------
|PROGRAMA;
     |HAZ DecimalesBase;
     nDeci_PreBaseMx = nDeci_PreBase;

     |ABRE #30;
     |DDEFECTO #30;

     |SI xModo = 1;
          |SI xDocTras = -1;
               |HAZ ContMovi5;  ||llamado por guerw013
          |SINO;
               |HAZ ContMovi;
          |FINSI;
          xDocTras = #30#0;
     |FINSI;

     #30#0 = xDocTras;
     #30#2 = xSerie;
     |LEE 101#30=;

     |SI FSalida ! 0;
          |GRABA 020#30c;
     |FINSI;

     #30#1 = xFecDocu;                            ||Fecha Docuemnto.
     |ABRE #31;
     |DDEFECTO #31;
     #31#27 = xDocTras;                              ||Documento Trans.
     #31#11 = xLinDocu;                              ||Linea Documento.
     #31#28 = xSerie
     |LEE 000#31=;

     |SI FSalida ! 0;
          |GRABA 020#31c;
     |FINSI;

     #31#1  = xAlmSali;
     #31#0  = xCodArti;                               ||Codigo Articulo.
     #31#2  = xDesArti;                               ||Descripcion Articulo.
     #31#4  = xCanArti;                              ||Cantidad Salida.
     #31#5  = xAlmEntr;                              ||Cod. Almacen Entrada.
     #31#8  = xFecDocu;                               ||Fecha de movimientos.
     #31#16 = "000000000000001";                  ||Partida Salida.
     #31#17 = "000000000000001";                  ||Partida Entrada.
     enCodigo = xDocTras;                            ||Doc. Transpaso.
     entrad  = xForma;
     enForma = xForma;

     |SI enForma = 1;
          |HAZ StockArt;
          |HAZ Historico;
     |FINSI;

     |HAZ AcumulaME_MS;

     |SI xModo = 3;
         |BORRA 020#30a;
         |BORRA 020#31a;
         |CIERRA #100;
         |CIERRA #31;
         |CIERRA #30;
         |ACABA;
     |FINSI;

     |CIERRA #100;
     |GRABA 020#31a;
     |GRABA 020#30a;
     |CIERRA #31;|CIERRA #30;
|FPROG;
--------------------------------------------------------------------------------
|PROCESO ContMovi5;
     |ABRE #8;
     #8#2 = xSerie;
     #8#0 = "movcenal";
     |LEE 000#8=;
     |SI FSalida = 0;
          nConta = #8#1;
          |SI nConta < 500000;
               nConta = 500000;
          |FINSI;
          #8#1 = nConta + 1;
          |GRABA 020#8a;
     |SINO;
          nConta = 500001;
          #8#1 = 500002;
          |GRABA 020#8c;
     |FINSI;
     |CIERRA #8;
     #30#0 = nConta;
|FPRC;

|PROCESO ContMovi;
     |ABRE #8;
     #8#2 = xSerie;
     #8#0 = "movcenal";
     |LEE 000#8=;
     |SI FSalida = 0;
          nConta = #8#1;
          #8#1 = nConta + 1;
          |GRABA 020#8a;
     |SINO;
          #8#1 = 2;
          nConta = 1;
          |GRABA 020#8c;
     |FINSI;
     |CIERRA #8;
     #30#0 = nConta;
|FPRC;
-------------------------------------------------------------------------------
|PROCESO StockArt;
     |ABRE #103;
     #103#0 = #31#0;                              ||Cod.Artículo.
     #103#1 = #31#1;                              ||Almacen Salida.
     |LEE 000#103=;

     |SI FSalida = 0;
          #31#12 = #103#47;                       ||Stock Salida 2.
          #31#3  = #103#5;                        ||Stoxk Salida.
     |FINSI;

     #103#0 = #31#0;                              ||Cod.Artículo.
     #103#1 = #31#5;                              ||Almacen Entrada.
     |LEE 000#103=;

     |SI FSalida = 0;
          #31#13 = #103#47;                       ||Stock Salida 2.
          #31#6  = #103#5;                        ||Stock Entrada.
     |FINSI;

     |CIERRA #103;
     |ABRE #104;
     #104#0 = #31#0;                              ||Cod. Artículo.
     |LEE 000#104=;

     |SI FSalida = 0;
          #31#14 = #104#185;                      ||Stock Articulo 2.
          #31#7  = #104#6;                        ||Stock Articulo.
     |FINSI;

     |CIERRA #104;
     |ABRE #105;
     #105#0 = #31#0;                              ||Articulo;
     #105#1 = #31#1;                              ||Almacen Salida.
     #105#2 = #31#16;                             ||Partida Salida.
     |LEE 000#105=;

     |SI FSalida = 0;
          #31#19 = #105#23;                       ||Stock 1 Partida Salida.
          #31#20 = #105#22;                       ||Stock 2 Partida Salida.
     |FINSI;

     #105#0 = #31#0;                              ||Articulo;
     #105#1 = #31#5;                              ||Almacen Entrada.
     #105#2 = #31#17;                             ||Partida Entrada.
     |LEE 000#105=;

     |SI FSalida = 0;
          #31#21 = #105#23;                       ||Stock 1 Partida Entrada.
          #31#22 = #105#22;                       ||Stock 2 Partida Entrada.
     |FINSI;

     |CIERRA #105;
|FPRC;
-------------------------------------------------------------------------------
|PROCESO Historico;
     efFec  = xFecDocu;                               ||Fecha Entrada.
     enAlma = xAlmSali;                               ||Almacen Salida.
     |HAZ MiraHisL;
     |SI enErrHis ! 0;
          |ERROR;
          |ACABA;
     |FINSI;

     efFec  = xFecDocu;                               ||Fecha Entrada.
     enAlma = xAlmEntr;                              ||Almacen Entrada.
     |HAZ MiraHisL;
     |SI enErrHis ! 0;
          |ERROR;
          |ACABA;
     |FINSI;
|FPRC;
-------------------------------------------------------------------------------
