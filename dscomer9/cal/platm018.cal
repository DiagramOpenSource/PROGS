|FICHEROS;
     platm018 #0;
     platm011 #1; ||material
     platm001 #2; ||clientes
     platm013 #3; ||contratos
     platm020 #4; ||historico
     platm012 #5;
     platm006 #6; ||comunidades
     platm007 #7; ||plataformas
     platw001 #8,MANTE; ||aux desinstalaciones
     platm001 #9; ||lineas cltes
     platm026 #10; ||cabecera cltes
     platm019 #11; ||solicitudes
     platm19@ #12; ||aux. solic. no instaldas
     platm010 #13; ||instaladores
|FIN;

|VARIABLES;
     nHay = 0;
     aDPlata = "";
     aHPlata = "";
     aComu = "";
     aHDir = "";
     aHNum = "";;
     aHEsca = "";
     aHPiso = "";
     nHCod1 = 0;
     nHCod2 = 0;
     aDDir = "";
     aDNum = "";;
     aDEsca = "";
     aDPiso = "";
     nDCod1 = 0;
     nDCod2 = 0;

     aSerie = "";
     nSalida = 0;
     aCalle1 = "";
     aCalle2 = "";
     aNum1 = "";
     aNum2 = "";
     aDirec = "";
     aNumer = "";
     aPlata = "";
     aOpera = "";
     aSql = "";
     aFichero = "";
     aOtro = "";
     &aCliente = "";
     &aCod1 = "";
     &aCod2 = "";
     &aCodigo = "";
     aCli = "";
     nCli = 0;
     aNoCli = "";
     nUltima = 0;
     nNumero = 0;
     nCaDes = 0;
     contrato = "";
     numero = 000000;
     nCanti = 0;
     aFecha = "";
     aSalida = "";
     aElDni = "";
     &nDeci_PreBase = 0;
     &nDeci_PreBaseMx = 0;
     &nDeci_Base = 0;
     &nDeci_BaseMx = 0;
     aEstado = "";
     linea = 0;
     ii = 0;
     jj = 0;
     hh = 0;
     nModo = 0;
     aMerca = "";
     aContrato = "";
     aInstalac = "";
     aM = "";
     aAlfa="";
     nNumeroCodigo;
     aRef1 = "";
     aRef2 = "";
     aRef3 = "";
     aRef4 = "";
     aRef5 = "";
     aSinEspa = "";
     nSigno = 0;
     aPropio = "";
     aAlfa1 = "";
     nElMio = 0;
     nCampo = 0;
     aNifQbf1   = "";
     aNifQbf2   = "";

     &eaVarDni  = "";
     &enCalcCif = 0;
|FINSI;

|PROCESO mayus018;
     #0Campo = #0Campo > " ";
     |PINTA #0Campo;
|FPRC;

|PROCESO LeeContrato;
     |DDEFECTO #platm001;
     |ABRE #platm001;
     #platm001#0 = #platm013#1;
     |LEE 000#platm001.=;
     |CIERRA #platm001;
|FPRC;

|PROCESO Mercancia7; |TIPO 7;
     aAlfa1 = #0Campo;
     |QBF aAlfa1;
     |SI aAlfa1 = "";    |ACABA;   |FINSI;

     |HAZ LeeContrato;

     |ABRE #platm011;
     #platm011#0 = #0Campo;
     |LEE 000#platm011.=;
     |SI FSalida = 0;
          |SI #platm011#7 = "AVERIADO  ";|Y #platm018#43 ! #0Campo;
                                         |Y #platm018#44 ! #0Campo;
                                         |Y #platm018#45 ! #0Campo;
                                         |Y #platm018#46 ! #0Campo;
                                         |Y #platm018#47 ! #0Campo;
               || si esta 'averiado' y no es la linea donde se ha
               || indicado el estado de 'averiado' no se hace nada
               |C_M #0Campo, 1, "N";
          |SINO;
               |SI #platm011#7 = "ENVIOPLATA";
                    |C_M #0Campo, 1, "N";
               |SINO;
                    |C_M #0Campo, 1, "S";
               |FINSI;
          |FINSI;
     |FINSI;
     |CIERRA #platm011;
|FPRC;

|PROCESO Mercancia;
     aAlfa1 = #0Campo;
     |QBF aAlfa1;
     |SI aAlfa1 = "";    |ACABA;   |FINSI;

     |C_M #0Campo, 0, aAlfa1;
     |SI aAlfa1 = "N";   |ACABA;   |FINSI;

     |HAZ LeeContrato;

     |ABRE #platm011;
     #platm011#0 = #0Campo;
     |LEE 000#platm011.=;
     |SI FSalida = 0;
/*
          |SI #platm011#7 = "AVERIADO  ";|Y #platm018#43 ! #0Campo;
                                         |Y #platm018#44 ! #0Campo;
                                         |Y #platm018#45 ! #0Campo;
                                         |Y #platm018#46 ! #0Campo;
                                         |Y #platm018#47 ! #0Campo;
              || si esta 'averiado' y no es la linea donde se ha
              || indicado el estado de 'averiado' no se hace nada
          |SINO;
*/
               aEstado = #platm011#7;   |QBF aEstado;
               |SI aEstado ! "ALMACEN";
                    |MENAV "0000La mercancia no esta en 'ALMACEN'";
                    |ERROR;
               |FINSI;

               |SI #platm011#8 = "O";
                    |MENAV "0000Mercancia no seriada.";
                    |ERROR;
               |FINSI;

               aContrato = #platm011#5; |QBT aContrato;
               |SI aContrato ! "";
                    |SI #platm011#6 ! #platm018#1;|O #platm011#5 ! #platm018#0;
                         |SI #platm011#6 < 500;
                              aContrato = #platm011#5; |QBF aContrato;
                              aInstalac = #platm011#6; |QBF aInstalac;
                              aContrato = "0000Material ya instalado en contrato: " + aContrato;
                              aContrato = aContrato+ " Instal.: " + aInstalac;
                              |MENAV aContrato;
                         |FINSI;
                    |FINSI;
               |FINSI;
||          |FINSI;
     |FINSI;
     |CIERRA #platm011;
|FPRC;

|PROCESO Mercancia_Des;
     |SI #0Campo = Contenido; |ACABA; |FINSI;
     aAlfa1 = #0Campo;
     |QBF aAlfa1;
     |SI aAlfa1 = "";    |ACABA;   |FINSI;

     |HAZ LeeContrato;

     |ABRE #platm011;
     #platm011#0 = #0Campo;
     |LEE 000#platm011.=;
     |SI FSalida = 0;

          nCampo = Campo + 161;
          aEstado = #platm011#7;   |QBF aEstado;
          |SI #0nCampo = "S"; |Y aEstado ! "INSTALADO";
               |MENAV "0000La mercancia no esta en 'INSTALADO'";
               |ERROR;
          |FINSI;
          |SI #0nCampo = "N"; |Y aEstado ! "ALMACEN";
               |MENAV "0000La mercancia no esta en 'ALMACEN'";
               |ERROR;
          |FINSI;

          |SI #platm011#8 = "O";
               |MENAV "0000Mercancia no seriada.";
               |ERROR;
          |FINSI;

          |SI #0Campo = #0#8;|O #0Campo = #0#9; |O #0Campo = #0#10;
                             |O #0Campo = #0#15;|O #0Campo = #0#16;
               |MENAV "0000Utilice otra linea para este material.";
               |ERROR;
          |FINSI;

          aContrato = #platm011#5; |QBT aContrato;
          |SI aContrato ! ""; |Y #platm011#7 = "AVERIADO  ";
               |SI #platm011#6 ! #platm018#1;|O #platm011#5 ! #platm018#0;
                    aContrato = #platm011#5; |QBF aContrato;
                    aInstalac = #platm011#6; |QBF aInstalac;
                    aContrato = "0000Material recogido en contrato: " + aContrato;
                    aContrato = aContrato + " Instal: " + aInstalac;
                    |MENAV aContrato;
                    |ERROR;
               |FINSI;
          |FINSI;
     |FINSI;
     |CIERRA #platm011;
|FPRC;

|PROCESO QuitaInst;
     |QBF aMerca;
     |SI aMerca = "";    |ACABA;   |FINSI;

     |ABRE #platm011;
     #platm011#0 = aMerca;
     |LEE 101#platm011.=;
     |SI FSalida = 0;
          aMerca = (aMerca + "                    ") % 120;
          |SI #platm011#7 = "AVERIADO  ";|Y #platm018#43 ! aMerca;
                                         |Y #platm018#44 ! aMerca;
                                         |Y #platm018#45 ! aMerca;
                                         |Y #platm018#46 ! aMerca;
                                         |Y #platm018#47 ! aMerca;
              || si esta 'averiado' y no es la linea donde se ha
              || indicado el estado de 'averiado' no se hace nada
          |SINO;
               |SI #platm011#7 ! "ENVIOPLATA";
                    |QBF aMerca;
                    nSigno = -1;   |HAZ ActuaTipo;

                    #platm011#3 = "";   || cliente
                    #platm011#4 = "";   || plataforma
                    #platm011#5 = "";   || contrato
                    #platm011#6 = "";   || instalacion
                    #platm011#7 = "ALMACEN"; || estado

                    |GRABA 020#platm011.a;

                    |HAZ QuitaHist;

                    nSigno = 1;    |HAZ ActuaTipo;
               |FINSI;
          |FINSI;
     |FINSI;
     |LIBERA #platm011;
     |CIERRA #platm011;
|FPRC;

|PROCESO QuitaInst1;
     |QBF aMerca;
     |SI aMerca = "";    |ACABA;   |FINSI;

     |ABRE #platm011;
     #platm011#0 = aMerca;
     |LEE 101#platm011.=;
     |SI FSalida = 0;
/*
          aEstado = #platm011#7;   |QBF aEstado;
          |SI aPropio = "S"; |Y aEstado ! "INSTALADO";
                    || inconsistencia provocada con 'averiados a almacen'
               #platm011#3 = "";   || cliente
               #platm011#4 = "";   || plataforma
               #platm011#5 = "";   || contrato
               #platm011#6 = "";   || instalacion
               #platm011#7 = "INSTALADO"; ||**
               |GRABA 020#platm011.a;
               |LIBERA #platm011;
               |CIERRA #platm011;
               |ACABA;
          |FINSI;
          |SI aPropio = "N"; |Y aEstado ! "ALMACEN";
                    || inconsistencia provocada con 'averiados a almacen'
               #platm011#3 = "";   || cliente
               #platm011#4 = "";   || plataforma
               #platm011#5 = "";   || contrato
               #platm011#6 = "";   || instalacion
               #platm011#7 = "ALMACEN"; ||**
               |GRABA 020#platm011.a;
               |LIBERA #platm011;
               |CIERRA #platm011;
               |ACABA;
          |FINSI;
*/
          nSigno = -1;   |HAZ ActuaTipo;

          #platm011#3 = "";   || cliente
          #platm011#4 = "";   || plataforma
          #platm011#5 = "";   || contrato
          #platm011#6 = "";   || instalacion
          |SI aPropio ! "N";
               #platm011#7 = "INSTALADO";    || estado
          |SINO;
               #platm011#7 = "ALMACEN";      || estado
          |FINSI;

          |GRABA 020#platm011.a;

          |HAZ QuitaHist;

          nSigno = 1;    |HAZ ActuaTipo;
     |FINSI;
     |LIBERA #platm011;
     |CIERRA #platm011;
|FPRC;

|PROCESO Histor;
     |ABRE #platm020;
     |SELECT #3#platm020;
     #platm020#0 = aMerca;         || serie
     #platm020#1 = "INSTALACION";  || operacion
     #platm020#2 = #0#4;           || fecha
     |LEE 000#platm020.=;
     |SI FSalida ! 0;
          |SELECT #1#platm020;
          #platm020#0 = aMerca;
          #platm020#3 = 999;
          |LEE 000#platm020.];
          |SI FSalida = 0;
               |LEE 000#platm020.a;
          |SINO;
               |LEE 000#platm020.u;
          |FINSI;
          aSinEspa = #platm020#0;  |QBF aSinEspa;
          |SI aSinEspa = aMerca;|Y FSalida = 0;
               linea = #platm020#3;
          |SINO;
               linea = 0;
          |FINSI;
          |DDEFECTO #platm020;
          #platm020#0 = aMerca;
          #platm020#3 = linea + 1;
          #platm020#1 = "INSTALACION";
          #platm020#2 = #0#4;
          #platm020#4 = #0#0;
          #platm020#5 = #0#1;
          #platm020#6 = nCanti;
          |GRABA 020#platm020.n;
     |FINSI;
     |CIERRA #platm020;
|FPRC;

|PROCESO Histor1;
     |ABRE #platm020;
     |SELECT #3#platm020;
     #platm020#0 = aMerca;
     #platm020#1 = "DEVOLUCION";
     #platm020#2 = #0#4;
     |LEE 000#platm020.=;
     |SI FSalida ! 0;
          |SELECT #1#platm020;
          #platm020#0 = aMerca;
          #platm020#3 = 999;
          |LEE 000#platm020.];
          |SI FSalida = 0;
               |LEE 000#platm020.a;
          |SINO;
               |LEE 000#platm020.u;
          |FINSI;
          aSinEspa = #platm020#0;  |QBF aSinEspa;
          |SI aSinEspa = aMerca;|Y FSalida = 0;
               linea = #platm020#3;
          |SINO;
               linea = 0;
          |FINSI;

          |DDEFECTO #platm020;
          #platm020#0 = aMerca;
          #platm020#3 = linea + 1;
          #platm020#1 = "DEVOLUCION";
          #platm020#2 = #0#4;
          #platm020#4 = #0#0;
          #platm020#5 = #0#1;
          |GRABA 020#platm020.n;
     |FINSI;
     |CIERRA #platm020;
|FPRC;

|PROCESO QuitaHist1;
     aRef1 = #0#43; |QBT aRef1;
     aRef2 = #0#44; |QBT aRef2;
     aRef3 = #0#45; |QBT aRef3;
     aRef4 = #0#46; |QBT aRef4;
     aRef5 = #0#47; |QBT aRef5;

     |SI aRef1 ! "";|O aRef2 ! "";|O aRef3 ! "";|O aRef4 ! "";|O aRef5 ! "";
          |BORRA 020#platm020.a;
     |FINSI;
     |LIBERA #platm020;
|FPRC;

|DEFBUCLE QuitaHist;
     #platm020#2;
     ;
     #0#0, #0#1;
     #0#0, #0#1;
     be;
     NULL, QuitaHist1;
|FIN;

|PROCESO QuitaHist;
     |BUCLE QuitaHist;
|FPRC;

|PROCESO PonInst1;
     |QBF aMerca;
     |SI aMerca = "";    |ACABA;   |FINSI;

     |ABRE #platm011;
     #platm011#0 = aMerca;
     |LEE 101#platm011.=;
     |SI FSalida = 0;
/*
          aEstado = #platm011#7;   |QBF aEstado;
          |SI aPropio = "S"; |Y aEstado ! "INSTALADO";
                    || inconsistencia provocada en 'averiados a almacen'
               |LIBERA #platm011;
               |CIERRA #platm011;
               |ACABA;
          |FINSI;
          |SI aPropio = "N"; |Y aEstado ! "ALMACEN";
                    || inconsistencia provocada en 'averiados a almacen'
               |LIBERA #platm011;
               |CIERRA #platm011;
               |ACABA;
          |FINSI;
*/
          nSigno = -1;   |HAZ ActuaTipo;

          #platm011#3 = #platm018#171;  || cliente
          #platm011#4 = #platm018#150;  || plataforma
          #platm011#5 = #platm018#0;    || contrato
          #platm011#6 = #platm018#1;    || instalacion
          #platm011#7 = "AVERIADO";     || estado

          |GRABA 020#platm011.a;

          |HAZ Histor1;

          nSigno = 1;    |HAZ ActuaTipo;
     |FINSI;
     |LIBERA #platm011;
     |CIERRA #platm011;
|FPRC;

|PROCESO PonInst;
     |QBF aMerca;
     |SI aMerca = "";    |ACABA;   |FINSI;

     |ABRE #platm011;
     #platm011#0 = aMerca;
     |LEE 101#platm011.=;
     |SI FSalida = 0;

          aMerca = (aMerca + "                    ") % 120;
          |SI #platm011#7 = "AVERIADO  ";|Y #platm018#43 ! aMerca;
                                         |Y #platm018#44 ! aMerca;
                                         |Y #platm018#45 ! aMerca;
                                         |Y #platm018#46 ! aMerca;
                                         |Y #platm018#47 ! aMerca;
              || si esta 'averiado' y no es la linea donde se ha
              || indicado el estado de 'averiado' no se hace nada
          |SINO;
               |SI #platm011#7 ! "ENVIOPLATA";
                    |QBF aMerca;
                    nSigno = -1;   |HAZ ActuaTipo;

                    #platm011#3 = #platm018#171;  || cliente
                    #platm011#4 = #platm018#150;  || plataforma
                    #platm011#5 = #platm018#0;    || contrato
                    #platm011#6 = #platm018#1;    || instalacion
                    #platm011#7 = "INSTALADO";    || estado

                    |GRABA 020#platm011.a;

                    |HAZ Histor;

                    nSigno = 1;    |HAZ ActuaTipo;
               |FINSI;
          |FINSI;

     |FINSI;
     |LIBERA #platm011;
     |CIERRA #platm011;
|FPRC;

|PROCESO Quita;
     aPropio = "";       || solo para la desistalaciones !!!

     nCanti = 1;
     aMerca = #0#8;     |HAZ QuitaInst;
     aMerca = #0#9;     |HAZ QuitaInst;
     aMerca = #0#10;    |HAZ QuitaInst;
     aMerca = #0#15;    |HAZ QuitaInst;
     aMerca = #0#16;    |HAZ QuitaInst;

     nCanti = #0#37;     aMerca = #0#32;  |HAZ QuitaInst;
     nCanti = #0#38;     aMerca = #0#33;  |HAZ QuitaInst;
     nCanti = #0#39;     aMerca = #0#34;  |HAZ QuitaInst;
     nCanti = #0#40;     aMerca = #0#35;  |HAZ QuitaInst;
     nCanti = #0#41;     aMerca = #0#36;  |HAZ QuitaInst;
     nCanti = #0#197;    aMerca = #0#183; |HAZ QuitaInst;
     nCanti = #0#198;    aMerca = #0#184; |HAZ QuitaInst;
     nCanti = #0#199;    aMerca = #0#185; |HAZ QuitaInst;
     nCanti = #0#200;    aMerca = #0#186; |HAZ QuitaInst;
     nCanti = #0#201;    aMerca = #0#187; |HAZ QuitaInst;
     nCanti = #0#202;    aMerca = #0#188; |HAZ QuitaInst;
     nCanti = #0#203;    aMerca = #0#189; |HAZ QuitaInst;

     nCanti = 1;
     aMerca = #0#43;     aPropio = #0#204;   |HAZ QuitaInst1;
     aMerca = #0#44;     aPropio = #0#205;   |HAZ QuitaInst1;
     aMerca = #0#45;     aPropio = #0#206;   |HAZ QuitaInst1;
     aMerca = #0#46;     aPropio = #0#207;   |HAZ QuitaInst1;
     aMerca = #0#47;     aPropio = #0#208;   |HAZ QuitaInst1;
|FPRC;

|PROCESO Pon;
     aPropio = "";       || solo para la desistalaciones !!!

     nCanti = 1;
     aMerca = #0#8;  |HAZ PonInst;
     aMerca = #0#9;  |HAZ PonInst;
     aMerca = #0#10; |HAZ PonInst;
     aMerca = #0#15; |HAZ PonInst;
     aMerca = #0#16; |HAZ PonInst;

     nCanti = #0#37;     aMerca = #0#32;  |HAZ PonInst;
     nCanti = #0#38;     aMerca = #0#33;  |HAZ PonInst;
     nCanti = #0#39;     aMerca = #0#34;  |HAZ PonInst;
     nCanti = #0#40;     aMerca = #0#35;  |HAZ PonInst;
     nCanti = #0#41;     aMerca = #0#36;  |HAZ PonInst;
     nCanti = #0#197;    aMerca = #0#183; |HAZ PonInst;
     nCanti = #0#198;    aMerca = #0#184; |HAZ PonInst;
     nCanti = #0#199;    aMerca = #0#185; |HAZ PonInst;
     nCanti = #0#200;    aMerca = #0#186; |HAZ PonInst;
     nCanti = #0#201;    aMerca = #0#187; |HAZ PonInst;
     nCanti = #0#202;    aMerca = #0#188; |HAZ PonInst;
     nCanti = #0#203;    aMerca = #0#189; |HAZ PonInst;

     nCanti = 1;
     aMerca = #0#43;     aPropio = #0#204;   |HAZ PonInst1;
     aMerca = #0#44;     aPropio = #0#205;   |HAZ PonInst1;
     aMerca = #0#45;     aPropio = #0#206;   |HAZ PonInst1;
     aMerca = #0#46;     aPropio = #0#207;   |HAZ PonInst1;
     aMerca = #0#47;     aPropio = #0#208;   |HAZ PonInst1;
|FPRC;

|PROCESO ActuaTipo;
     |ABRE #platm012;
     #platm012#0 = #platm011#2;
     |LEE 101#platm012.=;
     |SI FSalida = 0;
          aEstado = #platm011#7;
          |QBF aEstado;

          |SI #platm011#8 = "O";   || los no seriados van por libre (RPC)
               |SI nElMio = -1;
                    |SI nSigno = -1;    nCampo = 3;    |FINSI;   || quita de INSTALADO
                    |SI nSigno =  1;    nCampo = 2;    |FINSI;   || /y pone en ALMACEN
               |SINO;
                    |SI nSigno = -1;    nCampo = 2;    |FINSI;   || quita de ALMACEN
                    |SI nSigno =  1;    nCampo = 3;    |FINSI;   || /y pone en INSTALADO
               |FINSI;
          |SINO;
               |SI aEstado = "ALMACEN";      nCampo = 2;     |FINSI;
               |SI aEstado = "INSTALADO";    nCampo = 3;     |FINSI;
               |SI aEstado = "ENVIOPLATA";   nCampo = 7;     |FINSI;
               |SI aEstado = "AVERIADO";     nCampo = 4;     |FINSI;
          |FINSI;

          #platm012#nCampo# = #platm012#nCampo# + (nCanti * nSigno);

          #platm012#6 = #platm012#2 + #platm012#3 + #platm012#4 + #platm012#5 + #platm012#7;

          |GRABA 020#platm012.a;
     |SINO;
          aAlfa1 = "0000Tipo de mercancia [" + #platm012#0 + "] inaccesible.";
          |MENAV aAlfa1;
     |FINSI;
     |LIBERA #platm012;
     |CIERRA #platm012;
|FPRC;

|PROCESO tipo2018; |TIPO 2;
     |HAZ LeeContrato;

     nModo = (FEntrada / 100) ! 0;

     nElMio = 0 +. 1;
     |SI nModo = 1;                     || alta (actualiza)
          |HAZ Pon;
     |FINSI;
     |SI nModo = 2;|Y nElMio = -1;      || modificacion (desactualiza)
          |HAZ Quita;
     |FINSI;
     |SI nModo = 2;|Y nElMio = 1;       || modificacion (actualiza)
          |HAZ Pon;
     |FINSI;
     |SI nModo = 3;                     || baja (desactualiza)
          |HAZ Quita;

          |ABRE #platm019;
          #platm019#0 = #platm018#175;
          |LEE 101#platm019.=;
          |SI FSalida = 0;
               #platm019#71 = "N";
               |GRABA 020#platm019.a;
          |FINSI;
          |LIBERA #platm019;
          |CIERRA #platm019;
     |FINSI;
|FPRC;

|PROCESO LetraDni018;|TIPO 6;
     |SI Campo ! 30; |Y Campo ! 173; |ACABA; |FINSI;
     |SI FSalida = 9;
          eaVarDni  = #0Campo;
          |HAZ CalculoNIFCIF;
          #0Campo = eaVarDni;
          |PINTA #0Campo;
          |ERROR; |ACABA;
     |FINSI;

     eaVarDni  = #0Campo;
     |HAZ CalculoNIFCIF;

     aNifQbf1 = #0Campo;   |QBF aNifQbf1;
     aNifQbf2 = eaVarDni;  |QBF aNifQbf2;

     |SI aNifQbf1 ! aNifQbf2; |Y aNifQbf1 ! "";
          aAlfa = "0000NEl NIF puede ser erróneo."+&13+"¿Desea calcularlo?";
          |CONFI aAlfa;
          |SI FSalida = 0;
               #0Campo = eaVarDni; |PINTA #0Campo;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO MiraIns;
aMerca = #0Campo;
|QBT aMerca;
|SI aMerca ! "";
  |ABRE #platm011;
  #platm011#0 = #0Campo;
  |LEE 010#platm011.=;
  |SI FSalida = 0;|Y #platm011#8 ="S";
    |SI #platm011#7 ! "INSTALADO ";
      |MENAV "0000 Este material NO esta INSTALADO";
      |ERROR;
    |FINSI;
  |FINSI;
  |LIBERA #platm011;
  |CIERRA #platm011;
|FINSI;
|FPRC;

|PROCESO Comision;
  |ABRE #platm007;
  #platm007#0 = #platm018#150; ||plataforma
  |LEE 010#platm007.=;
  |SI FSalida = 0;
    |PARA ii = 34;|SI ii [ 65;|HACIENDO ii = ii + 1;
      jj = ii + 46;
      hh = ii + 30;
      |SI hh >  79;
        hh = hh - 16;
      |FINSI;
      |SI #0hh = "S"; ||SI ESTA CONTRATADO
        #0jj = #7ii;
      |SINO;
        #0jj = 0;
      |FINSI;
    |SIGUE;
  |FINSI;
  |LIBERA #platm007;
  |CIERRA #platm007;
|FPRC;

|PROCESO LeeComisiones;
nModo = (FEntrada/100)!0;
|SI nModo = 1;
  |HAZ Comision;
|FINSI;
|FPRC;

|PROCESO NumeroIns;|TIPO 7;
nModo = (FEntrada/100)!0;
|SI nModo = 1;
  |SALVA_FICHA #0;
  |ABRE #0;
  contrato = #0#0;
  |PARA ii = 0;|SI ii < 1;|HACIENDO;
    numero = #0#1;
    |LEE 010#0s;
    |SI #0#0 ! contrato;|O FSalida ! 0;
      |SAL;
    |FINSI;
  |SIGUE;
  |LIBERA #0;
  |CIERRA #0;
  |REPON_FICHA #0;
  |SI numero  = 0;
   #0#1 = 1;
  |SINO;
    #0#1 = numero+1;
  |FINSI;
|FINSI;
|FPRC;

|PROCESO desins;
     |SI #0#1 [ 500;
          |CONFI "0000NPasar a Recogidas?";
     |SINO;
          FSalida = 0;
     |FINSI;
     |SI FSalida = 0;
          |PUSHV 0501 2380;
          |DDEFECTO #platw001;
          #platw001#0 = #0#42;
          #platw001#1 = #0#43;
          #platw001#2 = #0#44;
          #platw001#3 = #0#45;
          #platw001#4 = #0#46;
          #platw001#5 = #0#47;
          #platw001#6 = #0#204;
          #platw001#7 = #0#205;
          #platw001#8 = #0#206;
          #platw001#9 = #0#207;
          #platw001#10 = #0#208;
          |PINPA #0#platw001;
          |PINDA #0#platw001;
          |ENDATOS #1#platw001;
          |SI FSalida = 0;
               #0#42 = #platw001#0;
               #0#43 = #platw001#1;
               #0#44 = #platw001#2;
               #0#45 = #platw001#3;
               #0#46 = #platw001#4;
               #0#47 = #platw001#5;
               #0#204 = #platw001#6;
               #0#205 = #platw001#7;
               #0#206 = #platw001#8;
               #0#207 = #platw001#9;
               #0#208 = #platw001#10;
          |FINSI;
          |POPV;
      |FINSI;
|FPRC;

|PROCESO DescMat;
     |DDEFECTO #platm011;
     |ABRE #platm011;
     #platm011#0 = #0Campo;
     |LEE 000#platm011.=;
     |CIERRA #platm011;

     |SI Campo ] 183;
          nCaDes = Campo + 7;
     |SINO;
          nCaDes = Campo + 121;
     |FINSI;
     #0nCaDes = #platm011#1;
     |PINTA #0nCaDes;
|FPRC;

|PROCESO Desde;
     #platm001#0 = #platm026#0;
     #platm001#18 = 001;
|FPRC;

|PROCESO Hasta;
     #platm001#0 = #platm026#0;
     #platm001#18 = 999;
|FPRC;

|PROCESO DirIns; |TIPO 7;
nModo = (FEntrada/100)!0;
|SI nModo ! 1;|ACABA;|FINSI;
|SI #platm018#158 > 0;|ACABA;|FINSI;
|ABRE #platm026;
#platm026#0 = #platm018#171;
|LEE 010#platm026.=;
|SI FSalida = 0;
  |ABRE #platm001;
  #platm001#0 = #platm026#0;
  #platm001#18 = 1;
  |LEE 000#platm001.];
  |PARA;|SI FSalida = 0;|Y #platm001#0=#platm026#0;|HACIENDO;
    |LEE 000#platm001.s;
    |SI #platm001#0 = #platm026#0;
      nUltima = #platm001#18;
    |FINSI;
  |SIGUE;
  #platm001#0 = #platm026#0;
  #platm001#18 = 1; ||linea
  |LEE 010#platm001.];
  |SI FSalida = 0;|Y #platm001#0 = #platm026#0;
    nNumero = #platm001#18;
    |LEE 001#platm001.s;
    |SI FSalida = 0;|Y #platm001#0 = #platm026#0; ||si tiene mas de una direc
      |CONSULTA_F_CLAVE #1#platm001,Desde,Hasta;
      |SI FSalida = 0;
        #0#158 = #platm001#18;
        |PTEC 802;
      |SINO;
        #0#158 = nUltima + 1;
      |FINSI;
    |SINO;
      #0#158 = nNumero;
      |PTEC 802;
    |FINSI;
  |FINSI;
|FINSI;
|LIBERA #platm026;
|CIERRA #platm026;
|FPRC;

|PROCESO tipo3018; |TIPO 3;
     aNoCli = #platm013#3;    |QBT aNoCli;
     |SI aNoCli = "000000";
          #platm013#2 = #platm018#171;
          #platm013#3 = #platm018#172;
     |FINSI;

     |ABRE #platm001;
     #platm001#0 = #platm018#171;
     #platm001#18 = #platm018#158;
     |LEE 101#platm001.=;
     |SI FSalida = 0;
          #platm001#19 = #platm018#150;
          |GRABA 020#platm001.a;
     |FINSI;
     |LIBERA #platm001;
     |CIERRA #platm001;

     |ABRE #platm019;
     #platm019#0 = #platm018#175;
     |LEE 000#platm019.=;
     |SI FSalida = 0;
          #platm019#71 = "S";
          |GRABA 020#platm019.a;
     |FINSI;
     |LIBERA #platm019;
     |CIERRA #platm019;
|FPRC;

|PROCESO CodPos18;
 aCod1 = #0#162;
 aCod2 = #0#163;
 |HAZ cp1;
 #0#164 = aCodigo;
|FPRC;

|PROCESO Cli7; |TIPO 7;
     nModo = FEntrada $ 100;
     |SI nModo = 1;
          #0#171 = aCliente;
          |PINTA #0#171;
     |FINSI;
     |SI nModo = 3;
          |PTEC 802;
          |PTEC 806;
     |FINSI;
|FPRC;

|PROCESO Cli0; |TIPO 0;
     nModo = FEntrada $ 100;
     |SI nModo = 1;|Y Contenido ! #0#171;
          aCliente = #0#171;
     |FINSI;
|FPRC;

|PROCESO GrabaPlat;
|ABRE #platm007;
#platm007#0 = #platm018#150;
|LEE 010#platm007.=;
|SI FSalida = 0;
  |PARA ii = 2;|SI ii [ 17;|HACIENDO ii = ii + 1;
    jj = ii + 46;
    #0jj = #7ii;
    aOtro = #0jj;
    |QBF aOtro;
    |SI aOtro = "OTRO";
      |C_M #0jj, 1, "S";
    |SINO;
      |C_M #0jj, 1, "N";
    |FINSI;
  |SIGUE;
|FINSI;
|LIBERA #platm007;
|CIERRA #platm007;
|FPRC;

|PROCESO d19;
#platm19@#0 = "";
#platm19@#1 = #platm018#171;
#platm19@#72 = 000;
#platm19@#71 = "N";
|FPRC;

|PROCESO h19;
#platm19@#0 = "z"*10;
#platm19@#1 = #platm018#171;
#platm19@#72 = 999;
#platm19@#71 = "N";
|FPRC;

|PROCESO NumeroCodigo;
  |ABRE #10;
  |LEE 010#10u;
  |SI FSalida ! 0;
    nNumero = 1;
  |SINO;
    nNumero = #10#0;
    nNumero = nNumero + 1;
  |FINSI;

  aAlfa = ("000000" + nNumero) % -106;
  #0#171 = aAlfa;
  |PINTA #0#171;
  |LIBERA #10;
  |CIERRA #10;
|FPRC;

|PROCESO Sol;|TIPO 6;
|SI FSalida = 11; ||f3
  aSql = "SELECT * FROM platm019 INTO tempo.def WHERE 71 == N AND  1 = "+#platm018#171;
  |SQL aSql;
  |DDEF aFichero;
  |QBF aFichero;
  aFichero = aFichero + "tempo.mas"
  |CARGA_DEF aFichero,platm19@;
  |SI FSalida = 0;
    |ABRE #platm19@;
    |CONSULTA_F_CLAVE #2#platm19@,d19,h19;
    |SI FSalida = 0;
       |SI #platm19@#71 = "S";
         |MENAV "0000 Solicitud Ya Instalada";
         |ERROR;
       |FINSI;
       #0#2 = #platm19@#76;  ||cod.instalador
       |ABRE #platm010;
       #platm010#0 = #0#2;
       |LEE 010#platm010.=;
       |SI FSalida ! 0;|DDEFECTO #platm010;|FINSI;
       |LIBERA #platm010;
       |CIERRA #platm010;
       #0#3 = #platm010#1;
       #0#30 = #platm19@#3; ||pagador
       #0#150 = #platm19@#9; ||plataforma digital
       |PARA ii = 10;|SI ii [25;|HACIENDO ii = ii + 1;
         jj = ii + 38;
         #0jj = #12ii; ||NOMBRE CONCEPTOS
         hh = ii + 16;
         jj = ii + 54;
         #0jj = #12hh; ||aceptado s/n
       |SIGUE;
       #0#158 = #platm19@#72; ||n§ direcc.envio
       #0#159 = #platm19@#50; ||direccion
       #0#160 = #platm19@#51; ||poblacion
       #0#161 = #platm19@#53; ||provincia
       #0#162 = #platm19@#77; ||cp1
       #0#163 = #platm19@#78; ||cp2
       #0#164 = #platm19@#52; ||cod.post
       #0#167 = #platm19@#79; ||n§ calle
       #0#168 = #platm19@#80; ||escalera
       #0#169 = #platm19@#81; ||piso
       #0#170 = #platm19@#82; ||puerta
       #0#173 = #platm19@#54; ||nif cliente
       #0#174 = #platm19@#73; ||fecha nacimiento
       #0#31 = #platm19@#75; ||comunidad
       #0#175 = #platm19@#0; ||n§ solicitud
       |PINDA #0#0;
       |HAZ Comision;
    |FINSI;
    |DESCARGA_DEF #platm19@
  |FINSI;
|SINO  ||Calculamos numero de codigo
     aAlfa = #0#171;
     |QBT aAlfa;
     |SI aAlfa = "000000";
          |HAZ NumeroCodigo;
     |FINSI;
|FINSI;
|FPRC;

|PROCESO Dir0;|TIPO 6;
|SI FSalida = 10;
  #0#158 = 0;
  |HAZ DirIns;
|FINSI;
|FPRC;

|PROCESO Instalador; |TIPO 7;
     aAlfa1 = #platm018#2;
     |QBF aAlfa1;
     |SI aAlfa1 = "0000";|O aAlfa1 = "";
          |DDEFECTO #platm006;
          |ABRE #platm006;
          #platm006#0 = #platm018#31;
          |LEE 000#platm006.=;
          |CIERRA #platm006;

          #platm018#2 = #platm006#11;
          |PINTA #platm018#2;
     |FINSI;
|FPRC;

|PROCESO Limpia; |TIPO 0;
     |SI Contenido ! #platm018#31;
          #platm018#2 = "0000";    |PINTA #platm018#2;
          #platm018#3 = "";        |PINTA #platm018#3;
     |FINSI;
|FPRC;

|CALCULO Comunidad18;
     |SI #0Campo ! Contenido;
          |ABRE #6;
          |SELECT #3#6;
          #6#2 = #0#159;
          #6#3 = #0#160;
          #6#8 = #0#167;
          |LEE 000#6=;
          |SI FSalida = 0;
               #0#31 = #6#0;
               |PINTA #0#31;
          |FINSI;
          |CIERRA #6;
     |FINSI;
|FCAL;
