|FICHEROS;
vigm0047 #0; ||piens075
vigm0046 #1; ||piens074
agifa019 #2;
agifa017 #3;
agifa065 #4;
dsm00024 #24;
|FINSI;

|VARIABLES;
     nForma = 0;
pm    = 0;
st    = 0;
fecha = "";
mes   = 0;
modo  = 0;
|FIN;

|CALCULO modifi;|TIPO 2;
     modo = (FEntrada / 100) ! 0;
     nForma = 0 +. 1;

     #1#8 = #1#8 +. #0#4; |PINTA #1#8;
     #1#9 = #1#3 - #1#8;  |PINTA #1#9;

     |ABRE #2;
     |ABRE #3;
     fecha = #1#7;
     fecha = fecha % 402;
     mes = fecha;
     #2#0 = #0#2;
     |LEE 021#2=;
     |SI FSalida = 0;
         #3#0 = #0#2;
         #3#1 = #0#6;
         |LEE 000#3=;
         |SI FSalida ! 0;
             |DDEFECTO #3;
             #3#0 = #0#2;
             #3#1 = #0#6;
             |GRABA 010#3c;
             |LIBERA #3;
         |FINSI;
         #3#5 = #3#5 +. #0#4;
         #3#39 = #3#39 +. #0#4;
         mes = 10 + (mes * 2);
         #3mes = #3mes +. #0#4;
         #3#36 = #3#36 +. #0#4;

         |ABRE #24;
         #24#0 = #0#2;
         #24#1 = #0#6;
         #24#2 = #0#7;
         #24#4 = ~;
         |LEE 101#24=;
         |SI FSalida ! 0; |GRABA 020#24b; |FINSI;
         #24#9 = #24#9 +. #0#4;
         #24#22 = #24#22 + #0#4;
         |HAZ ValoraStock;
         |GRABA 020#24a;
         |LIBERA #24;

         |GRABA 020#3a;
         |LIBERA #3;

         #2#6 = #2#6 +. #0#4;
         #2#104 = #2#104 +. #0#4;
         #2#11 = #2#11 -. #0#4;

         pm = #2#10 +. (#0#4*#0#5);
         st = #2#6;
         |SI st>0;
             pm = pm / st;
             #2#10 = pm * st;
             #2#9 = pm;
          |SINO;
             #2#9 = #0#5;
             #2#10 = #0#5 * st;
          |FINSI;
          |GRABA 010#2a;
     |FINSI;
     |LIBERA #2;
     |CIERRA #2;
     |CIERRA #3;

     |DDEFECTO #4;
     |ABRE #4;
     #4#0 = #0#2;
     #4#1 = #1#7;
     #4#2 = "FB";
     #4#3 = #0#0;
     #4#4 = #0#1;
     #4#11 = "";
     |SI nForma ! 1;
          |BORRA 020#4c;
     |SINO;
          |LEE 000#4=;
          |SI FSalida ! 0;
               |GRABA 000#4b;
          |FINSI;
          #4#5 = #0#6;
          #4#6 = #0#4;
          #4#8 = #2#9;
          #4#9 = #0#5;
          #4#14 = #0#5;
          #4#18 = #0#7;
          |GRABA 021#4a;
     |FINSI;
     |CIERRA #4;
|FCAL;

|CALCULO piens075;|TIPO 0;
modo = (FEntrada / 100) ! 0;
|SI modo = 2;|O modo = 3;
    |MENAV "0000!! Las modificaciones o bajas NO afectaran a los componentes de la formula !!.    SI a los fabricados.";
|FINSI;
|FCAL;
