 |FICHEROS;
     alby0002 #0;
     albw0007 #1;
     agifa104 #104;
     agifa073 #73;

     albm0010 #10;  ||Aux.Cab.Ped.

     albm0025 #25;  || Lin Fab
     albm0026 #26;  ||Arti Lin Fab C
     albm0027 #27;  ||Arti Lin Fab L

     albm0010 #10;  ||Aux.Cab Ped
     albm0028 #28;  ||Aux.Lin Ped

     albm0048 #148;  ||Porcentaje Desviacion Fija
|FIN;

|VARIABLES;
     &enPorF = 100;
     &enPorV = 100;

     nPorF = 100;        ||Por defecto los 2 porcentajes son 100.
     nPorV = 100;

     aInform1 = "albya002";
     aInform2 = "albyb002";
     aInform3 = "albyc002";
     aInforme = "";
     nHay = 0;
     aAlfa = "";
     nLinFab = 0;
     nAnchoPasada = 0;
     nVelocidad = 0;
     nMts = 0;
     aLin = "";
     nCuenta = 0;
     nPedi = 0;
|FIN;

|PROCESO Tmp;
     |SI aLin = ""; aLin = #1#0; |FINSI;
     |SI aLin ! #1#0; |PIEINF; |FINSI;
     aLin = #1#0;

     #1#11 = #1#8 / #1#5;
     #1#11 = (#1#11 / nPorF) * 100;
     #1#11 = (#1#11 / nPorV) * 100;
     #1#11 = #1#11 / 60;

     #1#10 = #1#10 / 60;

     #1#12 = #1#9 / #1#5;
     #1#12 = (#1#12 / nPorF) * 100;
     #1#12 = (#1#12 / nPorV) * 100;
     #1#12 = #1#12 / 60;

     #1#19 = #1#19 / 60;

     |SI #1#6 = 0; #1#10 = 0; |FINSI;
     |SI #1#7 = 0; #1#19 = 0; |FINSI;
     |SI #1#10 = 0; |Y #1#19 = 0;
          #1#17 = 0;
     |FINSI;

     #1#17 = #1#17 / 60;

     #1#13 = #1#11 + #1#10;
     #1#14 = #1#12 + #1#19;

     #1#15 = #1#8 + #1#9;
     #1#16 = #1#11 + #1#12
     #1#18 = #1#16 + #1#17;

     #1#20 = #1#18 / 24;
     #1#21 = #1#20 / 5;

     |PRINT;
     nHay = 1;
|FPRC;

|DEFBUCLE Tmp;
     #1#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Tmp;
|FIN;

|PROCESO PonCambio;
     |DDEFECTO #25;
     #25#0 = #1#0;
     |LEE 000#25=;

     |SI aLin ! #1#0; nCuenta = #25#4; |FINSI;
     aLin = #1#0;

     nCuenta = nCuenta - 1;
     |SI nCuenta [ 0;
          #1#10 = #25#2; ||Maximo
          nCuenta = #25#4; ||empieza otra vez
     |SINO;
          #1#10 = #25#3; ||Minimo
     |FINSI;
     #1#19 = #1#10;
     #1#17 = #1#10;
     |GRABA 020#1a;
     |LIBERA #1;
|FPRC;

|DEFBUCLE PonCambio;
     #1#1;
     ;
     INICIO;
     FINAL;
     be;
     NULL, PonCambio;
|FIN;

|PROCESO CargaTmp;
     |DDEFECTO #1;
     #1#0 = nLinFab;
     #1#1 = #26#12;
     #1#2 = #26#0;
     |LEE 101#1=;
     |SI FSalida ! 0; |GRABA 020#1b; |FINSI;

     #1#3 = #26#2;
     #1#4 = nAnchoPasada;
     #1#5 = nVelocidad;
     |SI #28#3 = "S";
          #1#6 = #1#6 + nMts;
          #1#8 = #1#6 / #1#4;
     |SINO;
          #1#7 = #1#7 + nMts;
          #1#9 = #1#7 / #1#4;
     |FINSI;
     |GRABA 020#1a;
     |LIBERA #1;
|FPRC;

|PROCESO albm0027;
     nLinFab = #27#1;
     nAnchoPasada = #27#3;
     nVelocidad = #27#4;
     |HAZ CargaTmp;
|FPRC;

|DEFBUCLE albm0027;
     #27#1;
     ;
     #26#0, 01;
     #26#0, 99;
     ;
     NULL, albm0027;
|FIN;

|PROCESO agifa073;
     nPedi = #73#42 - #73#43 + #73#12;
     |SI nPedi = 0;  |ACABA;  |FINSI;
     |SI #73#43 ! 0;  |ACABA;  |FINSI;
     |DDEFECTO #10;
     #10#0 = #73#28;
     #10#1 = #73#0;
     |LEE 000#10=;
     |SI #0#0 ! "A"; |Y #10#6 ! #0#0;   ||Pedido Conforme
          |ACABA;
     |FINSI;

     |DDEFECTO #28;
     #28#0 = #73#28;
     #28#1 = #73#0;
     #28#2 = #73#1;
     |LEE 000#28=;
     |SI #0#1 ! "A"; |Y #28#3 ! #0#1;   ||En Fabricacion
          |ACABA;
     |FINSI;

     |DDEFECTO #26;
     #26#0 = #73#2;
     |LEE 000#26=;
     |SI #26#3 < #0#2; |O #26#3 > #0#3; ||Linea
          |ACABA;
     |FINSI;

     nMts = #73#5;

     nLinFab = #26#3;
     nAnchoPasada = #26#5;
     nVelocidad = #26#6;
     |HAZ CargaTmp;

     |SI #0#6 = 2; |Y #26#7 ! 0;     ||Principal / Opcional
          nLinFab = #26#7;
          nAnchoPasada = #26#9;
          nVelocidad = #26#10;
          |HAZ CargaTmp;
     |FINSI;
     |SI #0#6 = 3;          || General
          |BUCLE albm0027;
     |FINSI;
|FPRC;

|DEFBUCLE agifa073;
     #73#3;
     ;
     #0#4, "     ", 000001, "      ";
     #0#5, "zzzzz", 999999, "zzzzzz";
     ;
     NULL, agifa073;
|FIN;

|PROCESO Tipo3; |TIPO 3;
     |SI #0#6 = 1; aInforme = aInform1; |FINSI;
     |SI #0#6 = 2; aInforme = aInform2; |FINSI;
     |SI #0#6 = 3; aInforme = aInform3; |FINSI;
     |IMPRE 0;
     |SI FSalida = 0;
          |INFOR aInforme;
          |SI FSalida ! 0;
               aInforme = "0000No existe informe: " + aInforme;
               |MENAV aInforme;
          |SINO;
               |ABRE #albm0048;
               |DDEFECTO #albm0048;
               |LEE 000#albm0048.p;
               nPorF = #albm0048#1;
               |CIERRA #albm0048;

               nPorV = #alby0002#7;

               enPorF = nPorF;
               enPorV = nPorV;

               aAlfa = Usuario; |NOME_DAT #1 aAlfa; |DELINDEX #1;
               |ABRE #1;
               |ABRE #10;
               |ABRE #28;
               |ABRE #26;
               |BUCLE agifa073;
               |CIERRA #26;
               |CIERRA #28;
               |CIERRA #10;
               |CIERRA #1;

               |ABRE #25;
               |BUCLE PonCambio;
               |CIERRA #25;
               aLin = "";
               |BUCLE Tmp;
               |SI nHay ! 0; |PIEINF; |FINSI;
               |FININF;
               |DELINDEX #1;
          |FINSI;
          |FINIMP;
     |FINSI;
|FPRC;
