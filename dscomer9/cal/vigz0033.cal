|FICHEROS;
     vigz0033 #0;
     vigm0001 #1;
     vigm0006 #6;
     vigm0007 #7;
     agifa017 #17;
     vigw0018 #18; ||Tmp
     agifa019 #19;
     agifa065 #65;
     agist001 #101;
     agist002 #102;
     agifa073 #73;
|FIN;

|VARIABLES;
     &Tempo = "";
     nNume = 0;
|FIN;

|PROCESO Toma; |TIPO 0;
     |SI #0#6 = "S";
          |SI #0#7 = "01.01.0000"; #0#7 = ~; |FINSI;
          |C_M #0#7, 1, "S";
     |SINO;
          |C_M #0#7, 1, "N";
     |FINSI;
|FPRC;

|PROCESO Prealbaran;
     |SI #7#2 ] #0#1; |Y #7#2 [ #0#2;
          |SI #7#3 ] #0#3; |Y #7#3 [ #0#4;
               |DDEFECTO #18;
               #18#0 = #7#2;
               |LEE 101#18=;
               |SI FSalida ! 0; |GRABA 020#18b; |FINSI;
               #18#4 = #18#4 + #7#5;
               |GRABA 020#18a;
               |LIBERA #18;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE Prealbaran;
     #6#3;
     ;
     "      ", #0#8, "     ", 000001;
     "zzzzzz", #0#9, "zzzzz", 999999;
     ;
     NULL, NULL, Prealbaran;
|FIN;

|PROCESO Historico;
     |SI #65#2 = "MS"; |O #65#2 = "AV"; |O #65#2 = "BV";
          |DDEFECTO #18;
          #18#0 = #65#0;
          |LEE 101#18=;
          |SI FSalida ! 0; |GRABA 020#18b; |FINSI;
          #18#4 = #18#4 - #65#6;
          |GRABA 020#18a;
          |LIBERA #18;
     |FINSI;
|FPRC;

|DEFBUCLE Historico;
     #65#1;
     5;
     #0#1, #0#8, "  ", 000001, 00000, "     ", #0#3;
     #0#2, #0#9, "zz", 999999, 99999, "zzzzz", #0#4;
     ;
     NULL, Historico;
|FIN;

|PROCESO Tmp;
     |DDEFECTO #1;
     #1#0 = #18#0;
     |LEE 000#1=;

     |DDEFECTO #19;
     #19#0 = #18#0;
     |LEE 000#19=;

     #18#1 = #19#1;
     #18#3 = #1#9;

     #18#5 = #18#2 - #18#4;
     nNume = #18#5 ! 4;
     |SI nNume ] 0;
          #18#6 = "Ok";
     |SINO;
          #18#6 = "Falta";
     |FINSI;

     |SI #1#1 = #0#0;
          |PRINT;
     |FINSI;
|FPRC;

|DEFBUCLE Tmp;
     #18#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Tmp;
|FIN;

|PROCESO agifa017;
     |DDEFECTO #18;
     #18#0 = #17#0;
     |LEE 101#18=;
     |SI FSalida ! 0; |GRABA 020#18b; |FINSI;
     #18#2 = #18#2 + #17#39;
     |GRABA 020#18a;
     |LIBERA #18;
|FPRC;

|DEFBUCLE agifa017;
     #17#1;
     ;
     #0#1, #0#3;
     #0#2, #0#4;
     ;
     NULL, agifa017;
|FIN;

|PROCESO agist002;
     |SI #102#2 < #0#1; |O #102#2 > #0#2;    || Articulo
          |ACABA;
     |FINSI;
     |SI #102#3 < #0#3; |O #102#3 > #0#4;    || Almacen
          |ACABA;
     |FINSI;

     |DDEFECTO #18;
     #18#0 = #102#2;
     |LEE 101#18=;
     |SI FSalida ! 0; |GRABA 020#18b; |FINSI;
     #18#2 = #18#2 + #102#4;
     |GRABA 020#18a;
     |LIBERA #18;
|FPRC;

|DEFBUCLE agist001;
     #101#1;
     1;
     "     ", 000001, #0#7;
     "zzzzz", 999999, #0#7;
     ;
     NULL, NULL, agist002;
|FIN;

|PROCESO agifa073;
     |DDEFECTO #18;
     #18#0 = #73#2;
     |LEE 101#18=;
     |SI FSalida ! 0; |GRABA 020#18b; |FINSI;
     #18#4 = #18#4 + #73#5;
     |GRABA 020#18a;
     |LIBERA #18;
|FPRC;

|DEFBUCLE agifa073;
     #73#3;
     3, 13, 15;
     #0#1, "     ", 000001, "      ", #0#3, #0#8, "N";
     #0#2, "zzzzz", 999999, "zzzzzz", #0#4, #0#9, "N";
     ;
     NULL, agifa073;
|FIN;

|PROCESO Tipo3; |TIPO 3;
     Impresora = "Crystal Reports";
     |IMPRE 0;
     |SI FSalida = 0;
          |INFOR "vigz0033";
          |SI FSalida = 0;
               |HAZ CreaTempo; |NOME_DAT #18#Tempo#; |DELINDEX #18;
               |ABRE #18;
               |SI #0#6 = "S";
                    |BUCLE agist001;
                    |BUCLE agifa073;
                    |BUCLE Prealbaran;
               |SINO;
                    |BUCLE agifa017;
                    |BUCLE Historico;
                    |BUCLE Prealbaran;
               |FINSI;
               |CIERRA #18;
               |ABRE #1;
               |ABRE #19;
               |BUCLE Tmp;
               |CIERRA #19;
               |PIEINF;
               |FININF;
               |DELINDEX #18; |HAZ BoraTempo;
          |SINO;
               |MENAV "0000Error en informe 'vigz0033'";
          |FINSI;
          |FINIMP;
     |FINSI;
|FPRC;
