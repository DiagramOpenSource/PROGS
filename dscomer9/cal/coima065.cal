|FICHEROS;
     coima065 #0;
     coima066 #1;
     agifa019 #2;
     agifa017 #3;
     agifa046 #46;
     agifa321 #321;
     agifa324 #324;
     dsm00241 #241;
|FIN;

|VARIABLES;
     &nDeci_Base = 0;
     &nDeci_PreBase = 0;
     &nDeci_EsCab = 0;
     &nDeci_EsLin = 0;

     nUni = 0;
     nImpo = 0;
     nNume1 = 0;
     nNume2 = 0;
|FIN;

|PROCESO Tipo8;  |TIPO 8;
     |ABRE #agifa324;
     |ABRE #agifa321;
     |LEE 001#agifa321.p;
     #agifa324#0 = #agifa321#9;    ||Igualo a moneda base
     |LEE 001#agifa324.=;
     nDeci_Base = #agifa324#7;     ||Decimales moneda base
     nDeci_PreBase = #agifa324#9;  ||Decimales precio de moneda base
     |CIERRA #agifa321;
     |CIERRA #agifa324;

     |ABRE #46; |LEE 040#46p; |CIERRA #46;
     |ABRE #46; |LEE 040#46p; |CIERRA #46;

     nDeci_EsCab = #46#15;
     nDeci_EsLin = #46#16;
|FPRC;

|PROCESO LeeConverUni;
     |ABRE #2;
     #2#0 = #1#2;
     |LEE 000#2=;
     |CIERRA #2;

     |ABRE #3;
     #3#0 = #1#2;
     #3#1 = #1#9;
     |LEE 000#3=;
     |CIERRA #3;

     |DDEFECTO #241;
     |SI #2#204 = "S";
          |ABRE #241; |SELECT #2#241;
          #241#0 = #2#5;
          #241#2 = #1#14;
          |LEE 000#241=;
          |CIERRA #241;
     |FINSI;
|FPRC;

|PROCESO ConverUni;
     |HAZ LeeConverUni;

     |SI #241#6 = "D";
          nNume1 = #1#12 * #241#5;
          nNume2 = #1#15 / #241#5;
          #1#4 = nNume1;
          #1#5 = nNume2;
     |SINO;
          nNume1 = #1#12 / #241#5;
          nNume2 = #1#15 * #241#5;
          #1#4 = nNume1;
          #1#5 = nNume2;
     |FINSI;
|FPRC;

|PROCESO totliesc; |TIPO 0;
     |HAZ ConverUni;

     nUni = #1#4;

     |SI #1#16 = "D";
          nImpo = (nUni * #1#5) > #1#13;
     |SINO;
          nImpo = (nUni * #1#5) / ((100 - #1#13) / 100);
     |FINSI;

     #1#6 = nImpo;
     |PINTA #1#6;
|FPRC;
