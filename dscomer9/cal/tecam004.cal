|FICHEROS;
     tecam004 #0;
     tecam005 #1;
     agifa073 #73;

     tecam005@ #5;
|FIN;

|VARIABLES;
     nUni = 0;
     nPendiente = 0;
     nConta = 0;
     nModo = 0;
     aAlfa = "";
     nSw = 0;
     aDef = "";
     aAntes = 0;
|FIN;

|PROCESO Defecto;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 1;
          |HORA aAlfa;
          #0#2 = aAlfa;
          aAlfa = Usuario % 810;
          #0#3 = aAlfa;
          |PINTA #0#2;
          |PINTA #0#3;
     |FINSI;
|FPRC;

|PROCESO Lineas;
     |SI #1#6 ! "P";
          nSw = 1;
          |ERROR10;
     |FINSI;
|FPRC;

|PROCESO Tipo2; |TIPO 2;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 3;
          nSw = 0;
          |BUCLELIN 2 Lineas #0;
          |SI nSw ! 0;
               |ERROR;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Conta; |TIPO 7;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 1;
         |LEE 000#0u;
         |SI FSalida = 0;
               nConta = #0#0 + 1;
         |SINO;
               nConta = 1;
         |FINSI;
         |DDEFECTO #0;
         #0#0 = nConta;
     |FINSI;
|FPRC;

|PROCESO Tipo2Lin; |TIPO 2;
     nModo = (FEntrada / 100) ! 0;
     |SI #1#6 ! "P"; |Y nModo = 3;
          |MENAV "0000Baja no permitida...";
          |ERROR;
     |FINSI;
|FPRC;

|PROCESO Pendiente;
     nUni = #73#5 - #73#43;
     nPendiente = nPendiente + nUni;
|FPRC;

|DEFBUCLE Pendiente;
     #73#1;
     ;
     #1#2, #1#3, 001;
     #1#2, #1#3, 999;
     ;
     NULL, Pendiente;
|FIN;

|PROCESO NoRepe7; |TIPO 7;
     aAntes = #1Campo;
|FPRC;

|PROCESO NoRepe0; |TIPO 0;
     nModo = (FEntrada / 100) ! 0;

     |SI #1Campo = aAntes;
          |ACABA;
     |FINSI;
     |SI nModo = 1;
          nPendiente = 0;
          |BUCLE Pendiente;
          |SI nPendiente = 0;
               |MENAV "0000Pedido sin unidades pendientes...";
               |ERROR;
               |ACABA;
          |FINSI;
     |FINSI;

     |DDEF aDef;
     aDef = aDef + "tecam005";
     |CARGA_DEF aDef, tecam005@;
     |SI FSalida = 0;
          |ABRE #5; |SELECT #2#5;
          #5#2 = #1#2;
          #5#3 = #1#3;
          #5#0 = #1#0;
          |LEE 000#5=;
          |SI FSalida = 0;
               aAlfa = "0000ERROR, Pedido introducido en linea [" + #5#1 + "]";
               |MENAV aAlfa;
               |ERROR;
          |SINO;
               #5#0 = 0;
               |LEE 000#5];
               |PARA; |SI FSalida = 0; |Y #5#2 = #1#2; |Y #5#3 = #1#3; |HACIENDO;
                    aAlfa = "0000Atencion, Pedido introducido en lote [" + #5#0 + "]";
                    |MENAV aAlfa;
                    |LEE 000#5s;
               |SIGUE;
          |FINSI;
          |CIERRA #5;
          |DESCARGA_DEF #tecam005@;
     |FINSI;
|FPRC;
