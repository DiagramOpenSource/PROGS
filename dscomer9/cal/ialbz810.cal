|| Comunes:    CheqArtCto, ConsuArtCto, CheqMatCto, ConsuMatCto, Na, BtnSalir
               ImpreAviso, EditaAviso, AsignaMatri, HistoMaquina
               RecalAviso, EditaParte, CierraParte, ImpreParte
               AsignaMatriPar, Refresca1 2 3 4
               CreaAlba, EnvioSMS, EditaAviso
               EditaEntrega, CierraEntrega

|FICHEROS;
     ialbz010 #0;
     ialbm004 #4;
     dsm00003 #3;
     ialbm006 #6;
     ialbz009 #9;        || Pantalla Espera
     ialbm010 #10;
     ialbz013 #13,MANTE;  || Avisos
     ialbz029 #29,MANTE;  || Entregas
     ialbz014 #14,MANTE;  || Partes
     ialbz015 #15,MANTE;  || Asg Matri
     ialbm017 #17;
     ialbm018 #18;
     ialbm019 #19;
     ialbm020 #20;
     ialbm021 #21;
     ialbm022 #22;
     ialbm023 #23;  || Relacion Avisos/Albaranes
     agifa024 #24;
     agifa025 #25;
     agifa071 #71;
     agifa010 #100;
     agifa104 #104;
     agifa019 #119;
     ialbz017 #117,MANTE; ||Histo Matri
     ialbz018 #118,MANTE; ||Cierra Parte
     ialbz021 #121,MANTE; ||Productos
     ialbz019 #219,MANTE; ||Cierra Aviso
     agifa321 #321;
     agifa324 #324;

     ialbm010@;
     dscam023@;
     dscam038@;
     ialbm019@;
     referen@;

     &refera1@;
     &refera2@;
     &refera3@;
     &referb1@;
     &referb2@;
     &referb3@;
     &referc1@;
     &referc2@;
     &referc3@;
     &referd1@;
     &referd2@;
     &referd3@;
|FIN;

|INCLUYE i_varart;

|VARIABLES;
     &eaClienteAnt = "";
     &enDirEntAnt = 0;

     &abo_alb = "";
     &fec_alb = @;
     &ser_fac = "";
     &num_fac = 0;
     &reimp = "";
     &ser_alb = "";
     &num_alb = 0;
     &abono = "";
     &eaMenuImpre = "";
     &enSwMenu = 0;
     &enDescuento1  = 0;
     &enDescuento2  = 0;
     &enComision    = 0;
     &eaTComision   = "";
     &uni_dt        = 0;
     &eaTag = "";
     &aDivisa = "";
     &aMoneda = "";
     &enPosiciona = 0;
     &enGrida1 = 0;
     &enGrida2 = 0;
     &enGrida3 = 0;
     &enGridb1 = 0;
     &enGridb2 = 0;
     &enGridb3 = 0;
     &enGridc1 = 0;
     &enGridc2 = 0;
     &enGridc3 = 0;
     &enGridd1 = 0;
     &enGridd2 = 0;
     &enGridd3 = 0;
     &eaMatricula = "";
     &eaSerAviso = "";
     &enNumAviso = 0;
     &enSwImp = 0;
     &Tempo = "";
     &enTipo = 0;
     &eaTipCto = "";
     &eaCliCto = "";
     &eaMatCto = "";
     &eaArtCto = "";
     nSal = 0;
     aAlfa = "";
     nConta = 0;
     i = 0;
     aEmpre = "";
     aNumEmp = "";
     nNumEmp = 0;
     aPath = "";
     aPathDat = "";
     aPathDef = "";
     nHayParte = 0;
     nRango = 0;
     nPos1 = 0;
     nPos2 = 0;
     nPrecio = 0;
     nDto = 0;
     nHayProdu = 0;
     nHay = 0;
     nCampo = 0;
     aTmp19 = "";
     aFacturable = "N";
     importe = 0;
     cant = 0;
     nLin = 0;
     nModoPro = 0;
     aSerAlbAnt = "";
     nNumAlbAnt = 0;
     nVentana1 = 0;
     nVentana2 = 0;
     nVentana3 = 0;
     nVenEspera = -1;
 {-1}aVent = "";
     aVent1 = 0;
     aVent2 = 0;
     aVent3 = 0;
     aVent4 = 0;
     aVent5 = "";
     nBtnVerAviso = 0;
     nBtnVerParte = 0;
     nBtnAcepta = 0;
     nBtnCancela = 0;
     nPantaVnt = 0;
     nGridPar = 0;
     nGrid = 0;
     nPantaEnt = 0;
     nPantaPar = 0;
     nBtnAlta = 0;
     nBtnModi = 0;
     nBtnBaja = 0;
     nBtnConsu = 0;
     nError = 0;
|FINS;

|PROCESO BtnSalir;
     |PTEC 807;
|FPRC;

|PROCESO Na; |TIPO 12;
|FPRC;

|PROCESO CheqArtCto;
     |SI eaTipCto = "F";
          |ABRE #4;
          #4#0 = eaCliCto;
          #4#1 = eaMatCto;
          #4#2 = eaArtCto;
          |LEE 000#4=;
          nSal = FSalida;
          |CIERRA #4;
     |SINO;
          |ABRE #10; |SELECT #3#10;
          #10#1 = eaCliCto;
          #10#4 = eaMatCto;
          #10#2 = eaArtCto;
          |LEE 000#10=;
          nSal = FSalida;
          |CIERRA #10;
     |FINSI;
     FSalida = nSal;
|FPRC;

|PROCESO Min4b;
     #4#0 = eaCliCto;
     #4#1 = eaMatCto;
     #4#2 = "                    ";
|FPRC;

|PROCESO Max4b;
     #4#0 = eaCliCto;
     #4#1 = eaMatCto;
     #4#2 = "zzzzzzzzzzzzzzzzzzzz";
|FPRC;

|PROCESO ConsuArtCto;
     |SI eaTipCto = "F";
          |ABRE #4;
          #4#0 = eaCliCto;
          #4#1 = eaMatCto;
          #4#2 = eaArtCto;
          |LEE 000#4];
          |CONSULTA_F_CLAVE #1#4, Min4b, Max4b;
          nSal = FSalida;
          eaMatCto = #4#1;
          eaArtCto = #4#2;
          |CIERRA #4;
     |SINO;
          |DDEF aAlfa;
          aAlfa = aAlfa + "ialbm010";
          |CARGA_DEF aAlfa, ialbm010@;
          |SI FSalida = 0;
               |HAZ CreaTempo; |NOME_DAT #ialbm010@#Tempo#; |DELINDEX #ialbm010@;
               |ABRE #ialbm010@;
               |ABRE #10; |SELECT #3#10;
               #10#1 = eaCliCto;
               #10#4 = eaMatCto;
               #10#5 = "";
               |LEE 000#10];
               |PARA; |SI FSalida = 0; |Y #10#1 = eaCliCto; |Y #10#4 = eaMatCto; |HACIENDO;
                    |SALVA_DATOS #10;
                    |REPON_DATOS #ialbm010@;
                    |GRABA 020#ialbm010@.n;
                    |LEE 000#10s;
               |SIGUE;
               |CIERRA #10;
               |SELECT #3#ialbm010@;
               #ialbm010@#1 = eaCliCto;
               #ialbm010@#4 = eaMatCto;
               #ialbm010@#2 = eaArtCto;
               |LEE 000#ialbm010@.];
               |CONSULTA_CLAVE #1#ialbm010@;
               nSal = FSalida;
               eaArtCto = #ialbm010@#2;
               |CIERRA #ialbm010@;
               |HAZ BoraTempo; |DELINDEX #ialbm010@;
               |DESCARGA_DEF #ialbm010@;
          |FINSI;
     |FINSI;
     nSal = FSalida;
|FPRC;

|PROCESO CheqMatCto;
     nSal = 0;
     |SI eaTipCto = "F";
          |ABRE #4;
          #4#0 = eaCliCto;
          #4#1 = eaMatCto;
          #4#2 = "";
          |LEE 000#4];
          |SI FSalida ! 0; |O #4#0 ! eaCliCto; |O #4#1 ! eaMatCto;
               nSal = 1;
          |FINSI;
          |CIERRA #4;
     |SINO;
          |ABRE #10; |SELECT #3#10;
          #10#1 = eaCliCto;
          #10#4 = eaMatCto;
          #10#2 = eaArtCto;
          |LEE 000#10];
          |SI FSalida ! 0; |O #10#1 ! eaCliCto; |O #10#4 ! eaMatCto;
               nSal = 1;
          |FINSI;
          |CIERRA #10;
     |FINSI;
     FSalida = nSal;
|FPRC;

|PROCESO Min4a;
     #4#0 = eaCliCto;
     #4#1 = "               ";
     #4#2 = "                    ";
|FPRC;

|PROCESO Max4a;
     #4#0 = eaCliCto;
     #4#1 = "zzzzzzzzzzzzzzz";
     #4#2 = "zzzzzzzzzzzzzzzzzzzz";
|FPRC;

|PROCESO ConsuMatCto;
     |SI eaTipCto = "F";
          |ABRE #4;
          #4#0 = eaCliCto;
          #4#1 = eaMatCto;
          #4#2 = eaArtCto;
          |LEE 000#4];
          |CONSULTA_F_CLAVE #1#4, Min4a, Max4a;
          nSal = FSalida;
          eaMatCto = #4#1;
          eaArtCto = #4#2;
          |CIERRA #4;
     |SINO;
          |DDEF aAlfa;
          aAlfa = aAlfa + "ialbm010";
          |CARGA_DEF aAlfa, ialbm010@;
          |SI FSalida = 0;
               |HAZ CreaTempo; |NOME_DAT #ialbm010@#Tempo#; |DELINDEX #ialbm010@;
               |ABRE #ialbm010@;
               |ABRE #10; |SELECT #3#10;
               #10#1 = eaCliCto;
               #10#4 = "";
               #10#5 = "";
               |LEE 000#10];
               |PARA; |SI FSalida = 0; |Y #10#1 = eaCliCto; |HACIENDO;
                    |SALVA_DATOS #10;
                    |REPON_DATOS #ialbm010@;
                    |GRABA 020#ialbm010@.n;
                    |LEE 000#10s;
               |SIGUE;
               |CIERRA #10;
               |SELECT #3#ialbm010@;
               #ialbm010@#1 = eaCliCto;
               #ialbm010@#4 = eaMatCto;
               #ialbm010@#2 = eaArtCto;
               |LEE 000#ialbm010@.];
               |CONSULTA_CLAVE #1#ialbm010@;
               nSal = FSalida;
               eaMatCto = #ialbm010@#4; |PINTA eaMatCto;
               eaArtCto = #ialbm010@#2; |PINTA eaArtCto;
               |CIERRA #ialbm010@;
               |HAZ BoraTempo; |DELINDEX #ialbm010@;
               |DESCARGA_DEF #ialbm010@;
          |FINSI;
     |FINSI;
     FSalida = nSal;
|FPRC;

|PROCESO Productos;
     enSwImp = 2;
     |PRINT;
|FPRC;

|DEFBUCLE Productos;
     #19#1;
     ;
     #18#0, #18#1, #18#2, 001;
     #18#0, #18#1, #18#2, 999;
     ;
     NULL, Productos;
|FIN;

|PROCESO Partes;
     nHayParte = 1;
     enSwImp = 1;
     |PRINT;
     |BUCLE Productos;
|FPRC;

|PROCESO ImpAviso;
     |IMPRE 0;
     |SI FSalida = 0;
          |INFOR "ialbm017";
          |SI FSalida = 0;
               enSwImp = 0;
               nHayParte = 0;
               |BUCLELIN 2 Partes #17;
               |SI nHayParte = 0; |PRINT; |FINSI;
               |PIEINF;
               |FININF;
          |SINO;
               |MENAV "0000Error en informe 'ialbm017'"
          |FINSI;
          |FINIMP;
     |FINSI;
|FPRC;

|PROCESO NumPed; |TIPO 0;
     |SI #13#46 ! 0;
          |ABRE #104;
          #104#25 = #13#45;
          #104#0 = #13#46;
          |LEE 000#104=;
          |SI FSalida ! 0;
               |MENAV "0000No existe pedido...";
          |FINSI;
          |CIERRA #104;
     |SINO;
          #13#45 = ""; |PINTA #13#45;
     |FINSI;
|FPRC;

|PROCESO ContratoSN;
     |ABRE #4;
     #4#0 = #13#5;
     #4#1 = #13#22;
     #4#2 = #13#21;
     |LEE 000#4=;
     |SI FSalida ! 0;
          |ABRE #10;
          |SELECT #3#10;
          #10#1 = #13#5;
          #10#2 = #13#21;
          #10#4 = #13#22;
          |LEE 000#10=;
          |SI FSalida = 0;
               #13#63 = "S"; |PINTA #13#63;
          |SINO;
               #13#63 = "N"; |PINTA #13#63;
          |FINSI;
          |CIERRA #10;
     |SINO;
          #13#63 = "S"; |PINTA #13#63;
     |FINSI;
     |CIERRA #4;
|FPRC;

|PROCESO PonArt13;
     |ABRE #119;
     #119#0 = #13#21;
     |LEE 000#119=;
     |SI FSalida = 0;
          #13#64 = #119#1; |PINTA #13#64;
     |FINSI;
     |CIERRA #119;
|FPRC;

|PROCESO ArtCto0; |TIPO 0;
     nError = 0;
     eaTipCto = #13#20;
     eaCliCto = #13#5;
     eaMatCto = #13#22;
     eaArtCto = #13#21;
     |HAZ CheqMatCto;
     |SI FSalida = 0;
          eaTipCto = #13#20;
          eaCliCto = #13#5;
          eaMatCto = #13#22;
          eaArtCto = #13#21;
          |HAZ CheqArtCto;
          |SI FSalida ! 0;
               |MENAV "0000No existe art¡culo...";
               |ERROR; nError = 1;
          |FINSI;
     |SINO;
          |ABRE #agifa019;
          #agifa019#0 = #13#21;
          |LEE 000#agifa019.=;
          |SI FSalida ! 0;
               |MENAV "0000No existe art¡culo...";
               |ERROR; nError = 1;
          |FINSI;
          |CIERRA #agifa019;
     |FINSI;
     |SI nError = 0; |Y #13Campo ! Contenido;
          |HAZ PonArt13;
          |HAZ ContratoSN;
     |FINSI;
|FPRC;

|PROCESO ArtCto66;  |TIPO 66;
     eaTipCto = #13#20;
     eaCliCto = #13#5;
     eaMatCto = #13#22;
     eaArtCto = #13#21;
     |HAZ CheqMatCto;
     |SI FSalida = 0;
          eaTipCto = #13#20;
          eaCliCto = #13#5;
          eaMatCto = #13#22;
          eaArtCto = #13#21;
          |HAZ ConsuArtCto;
          |SI FSalida = 0;
               #13#21 = eaArtCto; |PINTA #13#21;
               |HAZ PonArt13;
          |SINO;
               |ERROR;
          |FINSI;
     |SINO;
          |ABRE #agifa019;
          |CONSULTA_CLAVE #1#agifa019;
          |SI FSalida = 0;
               #13#21 = #agifa019#0; |PINTA #13#21;
               |HAZ PonArt13;
          |SINO;
               |ERROR;
          |FINSI;
          |CIERRA #agifa019;
     |FINSI;
|FPRC;

|PROCESO MatCto0; |TIPO 0;
     eaTipCto = #13#20;
     eaCliCto = #13#5;
     eaMatCto = #13#22;
     eaArtCto = #13#21;
     |HAZ CheqMatCto;
     |SI FSalida ! 0;
          ||Dejamos que siga y que pueda meter luego el articulo.
     |FINSI;
     |SI #13Campo ! Contenido;
          |HAZ PonArt13;
          |HAZ ContratoSN;
     |FINSI;
|FPRC;

|PROCESO MatCto66; |TIPO 66;
     eaTipCto = #13#20;
     eaCliCto = #13#5;
     eaMatCto = #13#22;
     eaArtCto = #13#21;
     |HAZ ConsuMatCto;
     |SI FSalida = 0;
          #13#22 = eaMatCto; |PINTA #13#22;
          #13#21 = eaArtCto; |PINTA #13#21;
          |HAZ PonArt13;
     |SINO;
          |ERROR;
     |FINSI;
|FPRC;

|PROCESO DirEnt7; |TIPO 7;
     |SI enModo = 1;
          eaClienteAnt = "";
          enDirEntAnt = 0;
     |SINO;
          eaClienteAnt = #13#5;
          enDirEntAnt = #13#6;
     |FINSI;
|FPRC;

|PROCESO DirEnt0; |TIPO 0;
     |ABRE #3;
     #3#0 = #13#5;
     #3#1 = #13#6;
     |LEE 000#3=;
     |SI FSalida = 0;
          |SI #3#18 = "N";
               |MENAV "0000Direcci¢n no activa...";
          |SINO;
               |SI eaClienteAnt ! #13#5; |O enDirEntAnt ! #13#6;
                    #13#48 = #3#2;
                    #13#55 = #3#3;
                    #13#56 = #3#4;
                    #13#57 = #3#5;
                    #13#58 = #3#7;
                    #13#60 = #3#13;
                    #13#61 = #3#21;
                    #13#62 = #3#24;

                    |PINTA #13#48;
                    |PINTA #13#55;
                    |PINTA #13#56;
                    |PINTA #13#57;
                    |PINTA #13#58;
                    |PINTA #13#60;
                    |PINTA #13#61;
                    |PINTA #13#62;

                    eaClienteAnt = #13#5;
                    enDirEntAnt = #13#6;
               |FINSI;
          |FINSI;
     |SINO;
          |CONFI "0000NNo existe direcci¢n para este cliente. ¿Continuar?";
          |SI FSalida ! 0; |ERROR; |FINSI;
     |FINSI;
     |CIERRA #3;
|FPRC;

|PROCESO Min3;
     #3#0 = #13#5;
     #3#1 = 0001;
|FPRC;

|PROCESO Max3;
     #3#0 = #13#5;
     #3#1 = 9999;
|FPRC;

|PROCESO DirEnt66; |TIPO 66;
     |ABRE #3;
     #3#0 = #13#5;
     #3#1 = #13#6;
     |LEE 000#3];
     |CONSULTA_F_CLAVE #1#3, Min3, Max3;
     |SI FSalida = 0;
          #13#6 = #3#1; |PINTA #13#6;
     |SINO;
          |ERROR;
     |FINSI;
     |CIERRA #3;
|FPRC;

|PROCESO dscam038;
     aEmpre = ("00000" + #dscam038@#5) % -105;
     aPathDat = aPath + aEmpre + "/";
     |ERROR10;
|FPRC;

|DEFBUCLE dscam038;
     #dscam038@#1002;
     ;
     nNumEmp, 001;
     nNumEmp, 999;
     ;
     NULL, dscam038;
|FIN;

|PROCESO Cliente7; |TIPO 7;
     |SI enModo = 1;
          eaClienteAnt = "";
     |SINO;
          eaClienteAnt = #13#5;
     |FINSI;
|FPRC;

|PROCESO Cliente0; |TIPO 0;
     nError = 0;
     |DBASS aPath;
     aPath = aPath + "dscarter/";
     aPathDef = aPath + "def/";
     aAlfa = aPathDef + "dscam038";
     |CARGA_DEF aAlfa, dscam038@;
     |SI FSalida = 0;
          |DFICE aAlfa;
          aNumEmp = aAlfa % -205;
          nNumEmp = aNumEmp;
          aPath = aPath + "fich/";
          |PATH_DAT #dscam038@#aPath#;
          |BUCLE dscam038;
          |DESCARGA_DEF #dscam038@;

          aAlfa = aPathDef + "dscam023";
          |CARGA_DEF aAlfa, dscam023@;
          |SI FSalida ! 0; |MENAV "0000Error al cargar 'dscam023'"; |FINSI;
          |SI aPathDat = "";
               |MENAV "0000Error, no encuentro empresa cartera";
          |SINO;
               |PATH_DAT #dscam023@#aPathDat#;
               |ABRE #dscam023@;
               #dscam023@#0 = #13#5;
               |LEE 000#dscam023@.=;
               |SI FSalida = 0; |Y #dscam023@#9 = "S";
                    aAlfa = "0000Cliente con riesgo bloqueado [" + #dscam023@#10 + "]";
                    |MENAV aAlfa;
                    |ERROR; nError = 1;
               |FINSI;
               |CIERRA #dscam023@;
          |FINSI;
          |DESCARGA_DEF #dscam023@;
     |FINSI;

     |SI #13#5 ! eaClienteAnt;
          |ABRE #agifa024;
          |DDEFECTO #agifa024;
          #agifa024#0 = #13#5;
          |LEE 000#agifa024.=;
          |CIERRA #agifa024;

          #13#47 = #agifa024#1;
          #13#48 = #agifa024#5;
          #13#55 = #agifa024#6;
          #13#56 = #agifa024#178;
          #13#57 = #agifa024#179;
          #13#58 = #agifa024#7;
          #13#59 = #agifa024#15;
          #13#60 = #agifa024#17;
          #13#61 = #agifa024#18;
          #13#62 = #agifa024#197;

          |PINTA #13#47;
          |PINTA #13#48;
          |PINTA #13#55;
          |PINTA #13#56;
          |PINTA #13#57;
          |PINTA #13#58;
          |PINTA #13#59;
          |PINTA #13#60;
          |PINTA #13#61;
          |PINTA #13#62;

          eaClienteAnt = #13#5;
     |FINSI;
     |SI nError = 0; |Y #13Campo ! Contenido;
          |HAZ ContratoSN;
     |FINSI;
|FPRC;

|PROCESO GrabaDir;
     |ABRE #24;
     #24#0 = #13#5;
     |LEE 020#24=;
     |CIERRA #24;

     |DDEFECTO #3;
     |ABRE #3;
     #3#0 = #13#5;
     #3#1 = #13#6;
     |LEE 101#3=;
     |SI FSalida ! 0;
          #3#10 = #24#2;
          #3#2 = #13#48;
          #3#3 = #13#55;
          #3#4 = #13#56;
          #3#5 = #13#57;
          #3#7 = #13#58;
          #3#13 = #13#60;
          #3#21 = #13#61;
          #3#24 = #13#62;
          |GRABA 020#3n;
     |FINSI;
     |CIERRA #13;
|FPRC;

|PROCESO EditaAviso;
     enError = 1;
     |SI enModo = 1; |VENTANA 0709, 3490, -1, 17, "Nuevo Aviso"; |FINSI;
     |SI enModo = 2; |VENTANA 0709, 3490, -1, 17, "Modificar Aviso"; |FINSI;
     nVentana1 = FSalida;
     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentana1;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |ABRE #17;
     |SI enModo = 1;
          #17#0 = #6#6;
          #17#1 = 999999;
          |LEE 000#17];
          |SI FSalida = 0;
               |LEE 000#17a;
          |SINO;
               |LEE 000#17u;
          |FINSI;
          |SI FSalida = 0; |Y #17#0 = #6#6;
               nConta = #17#1 + 1;
          |SINO;
               nConta = 1;
          |FINSI;
          |DDEFECTO #17;
          #17#0 = #6#6;
          #17#1 = nConta;
          |GRABA 020#17b;
          |SI FSalida = 0;
               |HORA aAlfa;
               |DDEFECTO #13;
               #13#0 = #6#6;
               #13#1 = nConta;
               #13#2 = ~;
               #13#3 = aAlfa;
               #13#4 = Usuario % 810;
               #13#5 = #0#0;
               |PINPA #0#13;
               |PINDA #0#13;
               |ENDATOS #1#13;
               |SI FSalida = 0;
                    |PARA i = 0; |SI i [ 47; |HACIENDO i = i + 1;
                         #17i = #13i;
                    |SIGUE;
                    |HAZ GrabaDir;
                    |DDEFECTO #24;
                    |ABRE #24;
                    #24#0 = #17#5;
                    |LEE 000#24=;
                    |CIERRA #24;
                    #17#48 = #24#2;
                    #17#49 = #13#52;
                    #17#50 = #13#53;
                    #17#51 = #13#54;
                    #17#52 = #13#48;
                    #17#53 = #13#55;
                    #17#54 = #13#56;
                    #17#55 = #13#57;
                    #17#56 = #13#58;
                    #17#57 = #13#59;
                    #17#58 = #13#60;
                    #17#59 = #13#61;
                    #17#60 = #13#62;
                    #17#61 = #13#63;
                    #17#62 =  #13#64;
                    |GRABA 020#17a;
                    enError = 0;
                    |CONFI "0000¿Imprimir aviso?";
                    |SI FSalida = 0; |HAZ ImpAviso; |FINSI;
               |SINO;
                    |BORRA 020#17c;
               |FINSI;
          |FINSI;
     |FINSI;
     |SI enModo = 2;
          |LEE 121#17=;
          |PARA i = 0; |SI i [ 47; |HACIENDO i = i + 1;
               #13i = #17i;
          |SIGUE;
          #13#52 = #17#49;
          #13#53 = #17#50;
          #13#54 = #17#51;
          #13#64 = #17#62;
          |DDEFECTO #24;
          |ABRE #24;
          #24#0 = #13#5;
          |LEE 020#24=;
          |CIERRA #24;
          |DDEFECTO #3;
          |ABRE #3;
          #3#0 = #13#5;
          #3#1 = #13#6
          |LEE 020#3=
          |CIERRA #3;
          |DDEFECTO #20;
          |ABRE #20;
          #20#0 = #13#17;
          |LEE 020#20=;
          |CIERRA #20;
          |DDEFECTO #21;
          |ABRE #21;
          #21#0 = #13#18;
          |LEE 020#21=;
          |CIERRA #21;
          |DDEFECTO #22;
          |ABRE #22;
          #22#0 = #13#19;
          |LEE 020#22=;
          |CIERRA #22;

          #13#48 = #17#52;
          #13#49 = #20#1;
          #13#50 = #21#1;
          #13#51 = #22#1;
          #13#55 = #17#53;
          #13#56 = #17#54;
          #13#57 = #17#55;
          #13#58 = #17#56;
          #13#59 = #17#57;
          #13#60 = #17#58;
          #13#61 = #17#59;
          #13#62 = #17#60;
          #13#63 = #17#61;
          |PINPA #0#13;
          |PINDA #0#13;
          |ENDATOS #2#13;
          |SI FSalida = 0;
               |PARA i = 0; |SI i [ 47; |HACIENDO i = i + 1;
                    #17i = #13i;
               |SIGUE;
               |HAZ GrabaDir;
               |HAZ RecalAviso;
               |DDEFECTO #24;
               |ABRE #24;
               #24#0 = #17#5;
               |LEE 000#24=;
               |CIERRA #24;
               #17#48 = #24#2;
               #17#49 = #13#52;
               #17#50 = #13#53;
               #17#51 = #13#54;
               #17#52 = #13#48;
               #17#53 = #13#55;
               #17#54 = #13#56;
               #17#55 = #13#57;
               #17#56 = #13#58;
               #17#57 = #13#59;
               #17#58 = #13#60;
               #17#59 = #13#61;
               #17#60 = #13#62;
               #17#61 = #13#63;
               #17#62 =  #13#64;
               |GRABA 020#17a;
               enError = 0;
               |CONFI "0000¿Imprimir aviso?";
               |SI FSalida = 0; |HAZ ImpAviso; |FINSI;
          |FINSI;
     |FINSI;
     |CIERRA #17;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentana1;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;
     |FINVENTANA nVentana1;
     |PULSATECLA;

     |SI enModo = 1; |Y enError = 0;
          |HAZ EnvioSMS;
     |FINSI;
|FPRC;

|PROCESO ArtCto15_0; |TIPO 0;
     eaTipCto = #17#20;
     eaCliCto = #15#2;
     eaMatCto = #15#15;
     eaArtCto = #15#14;
     |HAZ CheqMatCto;
     |SI FSalida = 0;
          eaTipCto = #17#20;
          eaCliCto = #15#2;
          eaMatCto = #15#15;
          eaArtCto = #15#14;
          |HAZ CheqArtCto;
          |SI FSalida ! 0;
               |MENAV "0000No existe art¡culo...";
               |ERROR; nError = 1;
          |FINSI;
     |SINO;
          |ABRE #agifa019;
          #agifa019#0 = #15#14;
          |LEE 000#agifa019.=;
          |SI FSalida ! 0;
               |MENAV "0000No existe art¡culo...";
               |ERROR; nError = 1;
          |FINSI;
          |CIERRA #agifa019;
     |FINSI;
|FPRC;

|PROCESO ArtCto15_66;  |TIPO 66;
     eaTipCto = #17#20;
     eaCliCto = #15#2;
     eaMatCto = #15#15;
     eaArtCto = #15#14;
     |HAZ CheqMatCto;
     |SI FSalida = 0;
          eaTipCto = #17#20;
          eaCliCto = #15#2;
          eaMatCto = #15#15;
          eaArtCto = #15#14;
          |HAZ ConsuArtCto;
          |SI FSalida = 0;
               #15#14 = eaArtCto; |PINTA #15#14;
          |SINO;
               |ERROR;
          |FINSI;
     |SINO;
          |ABRE #agifa019;
          |CONSULTA_CLAVE #1#agifa019;
          |SI FSalida = 0;
               #15#14 = #agifa019#0; |PINTA #15#14;
               |HAZ PonArt13;
          |SINO;
               |ERROR;
          |FINSI;
          |CIERRA #agifa019;
     |FINSI;
|FPRC;

|PROCESO MatCto15_0; |TIPO 0;
     eaTipCto = #17#20;
     eaCliCto = #15#2;
     eaMatCto = #15#15;
     eaArtCto = #15#14;
     |HAZ CheqMatCto;
     |SI FSalida ! 0;
          ||Dejamos que siga y que pueda meter luego el articulo.
     |FINSI;
|FPRC;

|PROCESO MatCto15_66; |TIPO 66;
     eaTipCto = #17#20;
     eaCliCto = #15#2;
     eaMatCto = #15#15;
     eaArtCto = #15#14;
     |HAZ ConsuMatCto;
     |SI FSalida = 0;
          #15#15 = eaMatCto; |PINTA #15#15;
          #15#14 = eaArtCto; |PINTA #15#14;
     |SINO;
          |ERROR;
     |FINSI;
|FPRC;

|PROCESO AsgMatPar;
     #18#40 = #17#21;
     #18#41 = #17#22;
     |GRABA 020#18a;
     |LIBERA #18;
|FPRC;

|DEFBUCLE AsgMatPar;
     #18#1;
     ;
     #17#0, #17#1, 001;
     #17#0, #17#1, 999;
     be;
     NULL, AsgMatPar;
|FIN;

|PROCESO AsignaMatri;
     enError = 1;
     |VENTANA 0910, 2590, -1, 17, "Asignar Matr¡cula";
     nVentana1 = FSalida;
     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentana1;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |ABRE #17;
     |LEE 121#17=;
     #15#0 = #17#0;
     #15#1 = #17#1;
     #15#2 = #17#5;
     #15#3 = #17#6;
     #15#4 = #17#7;
     #15#5 = #17#8;
     #15#6 = #17#9;
     #15#7 = #17#10;
     #15#8 = #17#11;
     #15#9 = #17#12;
     #15#10 = #17#13;
     #15#11 = #17#14;
     #15#12 = #17#15;
     #15#13 = #17#16;
     #15#14 = #17#21;
     #15#15 = #17#22;

     |DDEFECTO #24;
     |ABRE #24;
     #24#0 = #15#2;
     |LEE 020#24=;
     |CIERRA #24;
     |DDEFECTO #3;
     |ABRE #3;
     #3#0 = #15#2;
     #3#1 = #15#3;
     |LEE 020#3=
     |CIERRA #3;
     |DDEFECTO #119;
     |ABRE #119;
     #119#0 = #15#14;
     |LEE 000#119=;
     |CIERRA #119;

     #15#16 = #24#1;
     #15#17 = #3#2;
     #15#18 = #119#0;

     |PINPA #0#15;
     |PINDA #0#15;
     |ENDATOS #2#15;
     |SI FSalida = 0;
          #17#21 = #15#14;
          #17#22 = #15#15;
          |GRABA 020#17a;
          |CONFI "0000SAsignar matr¡cula a todos los partes";
          |SI FSalida = 0;
               |BUCLE AsgMatPar;
          |FINSI;
          enError = 0;
     |FINSI;
     |CIERRA #17;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentana1;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;
     |FINVENTANA nVentana1;

     |PULSATECLA;
|FPRC;

|PROCESO ImpreAviso;
     |ABRE #17;
     |LEE 020#17=;
     |SI FSalida = 0;
          |HAZ ImpAviso;
     |FINSI;
     |CIERRA #17;
|FPRC;

|PROCESO BtnVerParte;
|FPRC;

|PROCESO BtnVerAviso;
|FPRC;

|PROCESO Max18;
     #18#41 = eaMatricula;
     #18#0 = eaSerAviso;
     #18#1 = enNumAviso;
|FPRC;

|PROCESO Min18;
     #18#41 = eaMatricula;
     #18#0 = "     ";
     #18#1 = 0;
|FPRC;

|PROCESO Evento18;
     |SI FSalida = 1; |O FSalida = 2;
          |LEE 000#18=;
     |FINSI;
|FPRC;

|PROCESO HistoMaquina;
     |VENTANA 0901, 3698, -1, 17, "Hist¢rico Matr¡cula";
     nVentana1 = FSalida;
     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentana1;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     #117#0 = eaMatricula;
     |PINPA #0#117; nPantaVnt = FSalida;
     |PINDA #0#117;
     |CONTROL_SIMPLE nPantaVnt, "BOTON,Ver aviso", 0672, 0684, BtnVerAviso;
     nBtnVerAviso = FSalida;
|ESTADO_CONTROL nBtnVerAviso, "HIDE";    ||NO ESTA HECHO
     |CONTROL_SIMPLE nPantaVnt, "BOTON,Ver parte", 0685, 0697, BtnVerParte;
     nBtnVerParte = FSalida;
|ESTADO_CONTROL nBtnVerParte, "HIDE";   ||NO ESTA HECHO
     nRango = 4 + 8 + 16 + 32;
     nPos1 = 0702;
     nPos2 = 3197;
     |ABRE #18;
     |LINEAL_SIMPLE #8#18, nRango, nPos1, nPos2, Min18, Max18, Evento18;
     nGridPar = FSalida;
     |PAUSA;
     |CIERRA #18;
     |DESTRUYECONTROL nGridPar;
     |FIN_CONTROL_WINDOWS nBtnVerAviso;
     |FIN_CONTROL_WINDOWS nBtnVerParte;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentana1;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;
     |FINVENTANA nVentana1;

     |PULSATECLA;
|FPRC;

|PROCESO RecalProdu;
     #19#9 = #19#6 * #19#7;
     #19#10 = (#19#6 * #19#7) < #19#8;
     |SI #19#12 = "O";   || M.Obra
          #18#32 = #18#32 + #19#6;
          #18#33 = #18#33 + (#19#6 * #19#16);
          #18#36 = #18#36 + #19#10;
          #17#38 = #17#38 + #19#6;
          #17#39 = #17#39 + (#19#6 * #19#16);
          #17#42 = #17#42 + #19#10;
     |FINSI;
     |SI #19#12 = "M";   || Materiales
          #18#34 = #18#34 + (#19#6 * #19#16);
          #18#37 = #18#37 + #19#10;
          #17#40 = #17#40 + (#19#6 * #19#16);
          #17#43 = #17#43 + #19#10;
     |FINSI;
     |SI #19#12 = "X";   || Otros
          #18#35 = #18#35 + (#19#6 * #19#16);
          #18#38 = #18#38 + #19#10;
          #17#41 = #17#41 + (#19#6 * #19#16);
          #17#44 = #17#44 + #19#10;
     |FINSI;
     |GRABA 020#19a;
     |LIBERA #19;
|FPRC;

|DEFBUCLE RecalProdu;
     #19#1;
     ;
     #18#0, #18#1, #18#2, 001;
     #18#0, #18#1, #18#2, 999;
     be;
     NULL, RecalProdu;
|FIN;

|PROCESO RecalParte;
     |PDEFECTO #18, 32, 39;
     |BUCLE RecalProdu;
     #18#42 = #17#45;
     #18#43 = #17#46;
     |GRABA 020#18a;
     |LIBERA #18;
|FPRC;

|PROCESO RecalAviso;
     |SALVA_DATOS #19;
     |SALVA_DATOS #18;

     |PDEFECTO #17, 38, 45;
     |BUCLELIN 0 RecalParte #17;
     |GRABA 020#17a;

     |REPON_DATOS #18; |LEE 000#18=;
     |REPON_DATOS #19; |LEE 000#19=;
|FPRC;

|PROCESO Min19;
     #19#0 = #18#0;
     #19#1 = #18#1;
     #19#2 = #18#2;
     #19#3 = 1;
|FPRC;

|PROCESO Max19;
     #19#0 = #18#0;
     #19#1 = #18#1;
     #19#2 = #18#2;
     #19#3 = 999;
|FPRC;

|PROCESO Evento19;
     |SI FSalida = 1; |O FSalida = 2;
          |LEE 000#19=;
     |FINSI;
|FPRC;

|PROCESO GraLineal19;
     |SALVA_DATOS #ialbm019@;
     |REPON_DATOS #19;
     |GRABA 020#19n;
|FPRC;

|DEFBUCLE GraLineal19;
     #ialbm019@#1004;
     ;
     #18#0, #18#1, #18#2, 001;
     #18#0, #18#1, #18#2, 999;
     ;
     NULL, GraLineal19;
|FIN;

|PROCESO Graba19;
     |SALVA_DATOS #19;
     |REPON_DATOS #ialbm019@;
     |GRABA 020#ialbm019@.n;
|FPRC;

|DEFBUCLE Graba19;
     #19#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Graba19;
|FIN;

|PROCESO Borra19;
     |BORRA 020#ialbm019@.a;
|FPRC;

|DEFBUCLE Borra19;
     #ialbm019@#1004;
     ;
     #18#0, #18#1, #18#2, 001;
     #18#0, #18#1, #18#2, 999;
     be;
     NULL, Borra19;
|FIN;

|PROCESO PonPrecio; |TIPO 0;
     |SI #121Campo ! Contenido;
          |DDEFECTO #24;
          |ABRE #24;
          #24#0 = #121#13;
          |LEE 020#24=;
          |CIERRA #24;
          |DDEFECTO #119;
          |ABRE #119;
          #119#0 = #121#4;
          |LEE 020#119=;
          |CIERRA #119;
          |SI #24#39 = 1; nPrecio = #119#18; nDto = #119#21; |FINSI;
          |SI #24#39 = 2; nPrecio = #119#19; nDto = #119#22; |FINSI;
          |SI #24#39 = 3; nPrecio = #119#20; nDto = #119#23; |FINSI;
          |SI #24#39 = 4; nPrecio = #119#147; nDto = #119#150; |FINSI;
          |SI #24#39 = 4; nPrecio = #119#148; nDto = #119#151; |FINSI;
          |SI #24#39 = 4; nPrecio = #119#149; nDto = #119#152; |FINSI;
          #121#7 = nPrecio; |PINTA #121#7;
          #121#8 = nDto; |PINTA #121#8;
          #121#16 = #119#9;
     |FINSI;
|FPRC;

|PROCESO Total; |TIPO 0;
     #121#9 = #121#6 * #121#7;
     #121#10 = (#121#6 * #121#7) < #121#8;
     |PINTA #121#9;
     |PINTA #121#10;
|FPRC;

|PROCESO UltLinParte;
     |DDEF aAlfa;
     aAlfa = aAlfa + "ialbm019";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |NOME_DAT #referen@#aTmp19#;
          |ABRE #referen@;
          #referen@#0 = #18#0;
          #referen@#1 = #18#1;
          #referen@#2 = #18#2;
          #referen@#3 = 999;
          |LEE 000#referen@.];
          |SI FSalida = 0;
               |LEE 000#referen@.a;
          |SINO;
               |LEE 000#referen@.u;
          |FINSI;
          |SI FSalida = 0; |Y #referen@#0 = #18#0; |Y #referen@#1 = #18#1;  |Y #referen@#2 = #18#2;
               nLin = #referen@#3 + 1;
          |SINO;
               nLin = 1;
          |FINSI;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|PROCESO EditaProdu;
     enError = 1;
     |SI nModoPro = 1; |VENTANA 1611, 2889, -1, 17, "Nuevo Producto"; |FINSI;
     |SI nModoPro = 2; |VENTANA 1611, 2889, -1, 17, "Modificar Producto"; |FINSI;
     |SI nModoPro = 4; |VENTANA 1611, 2889, -1, 17, "Consulta Producto"; |FINSI;
     nVentana3 = FSalida;
     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentana3;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;
     |SI nModoPro = 1;
          |DDEFECTO #121;
          |SI #17#63 = "S";        || Entrega
               #18#0 = #29#0;
               #18#1 = #29#1;
               #18#2 = 1;
               #18#3 = 0;
               #18#39 = #29#5;
               #18#40 = #29#21;
               #18#41 = #29#22;
          |FINSI;
          #121#0 = #18#0;
          #121#1 = #18#1;
          #121#2 = #18#2;
          #121#3 = 0;
          #121#13 = #18#39;
          #121#14 = #18#40;
          #121#15 = #18#41;
     |SINO;
          |PARA i = 0; |SI i [ 18; |HACIENDO i = i + 1;
               #121i = #19i;
          |SIGUE;
     |FINSI;
     |PINPA #0#121;
     |PINDA #0#121;
     |SI nModoPro = 1; |ENDATOS #1#121; |FINSI;
     |SI nModoPro = 2; |ENDATOS #2#121; |FINSI;
     |SI nModoPro = 4; |PAUSA; |FINSI;
     |SI FSalida = 0;
          |SI nModoPro = 1;
               |PARA i = 0; |SI i [ 18; |HACIENDO i = i + 1;
                    #19i = #121i;
               |SIGUE;
               |HAZ UltLinParte;
               #19#3 = nLin;
               |GRABA 020#19n;
          |FINSI;
          |SI nModoPro = 2;
               |PARA i = 0; |SI i [ 18; |HACIENDO i = i + 1;
                    #19i = #121i;
               |SIGUE;
               |GRABA 020#19a;
          |FINSI;
          enError = 0;
     |FINSI;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentana3;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;
     |FINVENTANA nVentana1;

     |PULSATECLA;
|FPRC;

|PROCESO BtnAlta;
     nModoPro = 1; |HAZ EditaProdu;
     |SI enError = 0;
          |REFRESCACONTROL nGridPar;
     |FINSI;
|FPRC;

|PROCESO BtnModi;
     |LEE 000#19=;
     |SI FSalida ! 0; |ACABA; |FINSI;

     nModoPro = 2; |HAZ EditaProdu;
     |SI enError = 0;
          |REFRESCACONTROL nGridPar;
     |FINSI;
|FPRC;

|PROCESO BtnBaja;
     |LEE 000#19=;
     |SI FSalida ! 0; |ACABA; |FINSI;

     aAlfa = "0000NBorrar linea de parte:" + (("000" + #19#3) % -103);
     |CONFI aAlfa;
     |SI FSalida = 0;
          |BORRA 020#19a;
          |REFRESCACONTROL nGridPar;
     |FINSI;
|FPRC;

|PROCESO BtnConsu;
     |LEE 000#19=;
     |SI FSalida ! 0; |ACABA; |FINSI;

     nModoPro = 4; |HAZ EditaProdu;
|FPRC;

|PROCESO PinPanParte;
     |PINPA #0#14; nPantaPar = FSalida;
     |PINDA #0#14;
     nRango = 4 + 8 + 16 + 32;
     nPos1 = 2202;
     nPos2 = 2981;
     |LINEAL_SIMPLE #1#19, nRango, nPos1, nPos2, Min19, Max19, Evento19;
     nGridPar = FSalida;
     |CONTROL_SIMPLE nPantaPar, "BOTON,{{193}}Alta", 2102, 2114, BtnAlta;
     nBtnAlta = FSalida;
     |CONTROL_SIMPLE nPantaPar, "BOTON,{{197}}Modificar", 2115, 2127, BtnModi;
     nBtnModi = FSalida;
     |CONTROL_SIMPLE nPantaPar, "BOTON,{{199}}Baja", 2128, 2140, BtnBaja;
     nBtnBaja = FSalida;
     |CONTROL_SIMPLE nPantaPar, "BOTON,{{204}}Consulta", 2141, 2153, BtnConsu;
     nBtnConsu = FSalida;
|FPRC;

|PROCESO BorPanParte;
     |DESTRUYECONTROL nGridPar;
     |FIN_CONTROL_WINDOWS nBtnAlta;
     |FIN_CONTROL_WINDOWS nBtnModi;
     |FIN_CONTROL_WINDOWS nBtnBaja;
     |FIN_CONTROL_WINDOWS nBtnConsu;
|FPRC;

|PROCESO Art14_0; |TIPO 0;
     nError = 0;
     eaTipCto = #17#20;
     eaCliCto = #14#39;
     eaMatCto = #14#41;
     eaArtCto = #14#40;
     |HAZ CheqMatCto;
     |SI FSalida = 0;
          eaTipCto = #17#20;
          eaCliCto = #14#39;
          eaMatCto = #14#41;
          eaArtCto = #14#40;
          |HAZ CheqArtCto;
          |SI FSalida ! 0;
               |MENAV "0000No existe art¡culo...";
               |ERROR; nError = 1;
          |FINSI;
     |SINO;
          |ABRE #agifa019;
          #agifa019#0 = #14#40;
          |LEE 000#agifa019.=;
          |SI FSalida ! 0;
               |MENAV "0000No existe art¡culo...";
               |ERROR; nError = 1;
          |FINSI;
          |CIERRA #agifa019;
     |FINSI;
|FPRC;

|PROCESO Art14_66;  |TIPO 66;
     eaTipCto = #17#20;
     eaCliCto = #14#39;
     eaMatCto = #14#41;
     eaArtCto = #14#40;
     |HAZ CheqMatCto;
     |SI FSalida = 0;
          eaTipCto = #17#20;
          eaCliCto = #14#39;
          eaMatCto = #14#41;
          eaArtCto = #14#40;
          |HAZ ConsuArtCto;
          |SI FSalida = 0;
               #14#40 = eaArtCto; |PINTA #14#40;
          |SINO;
               |ERROR;
          |FINSI;
     |SINO;
          |ABRE #agifa019;
          |CONSULTA_CLAVE #1#agifa019;
          |SI FSalida = 0;
               #14#40 = #agifa019#0; |PINTA #14#40;
          |SINO;
               |ERROR;
          |FINSI;
          |CIERRA #agifa019;
     |FINSI;
|FPRC;

|PROCESO Mat14_0; |TIPO 0;
     eaTipCto = #17#20;
     eaCliCto = #14#39;
     eaMatCto = #14#41;
     eaArtCto = #14#40;
     |HAZ CheqMatCto;
     |SI FSalida ! 0;
          ||Dejamos que siga y que pueda meter luego el articulo.
     |FINSI;
|FPRC;

|PROCESO Mat14_66; |TIPO 66;
     eaTipCto = #17#20;
     eaCliCto = #14#39;
     eaMatCto = #14#41;
     eaArtCto = #14#40;
     |HAZ ConsuMatCto;
     |SI FSalida = 0;
          #14#41 = eaMatCto; |PINTA #14#41;
          #14#40 = eaArtCto; |PINTA #14#40;
     |SINO;
          |ERROR;
     |FINSI;
|FPRC;

|PROCESO EditaParte
     enError = 1;
     |SI enModo = 1; |VENTANA 0710, 3490, -1, 17, "Nuevo Parte"; |FINSI;
     |SI enModo = 2; |VENTANA 0710, 3490, -1, 17, "Modificar Parte"; |FINSI;
     nVentana1 = FSalida;
     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentana1;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |DDEF aAlfa;
     aAlfa = aAlfa + "ialbm019";
     |CARGA_DEF aAlfa, ialbm019@;

     |HAZ CreaTempo; |NOME_DAT #19 Tempo; |DELINDEX #19; aTmp19 = Tempo;

     |ABRET #ialbm019@;
     |ABRET #17;
     |ABRET #18;
     |ABRET #19;
     |LEE 121#17=;
     |SI enModo = 1;
          #18#0 = #17#0;
          #18#1 = #17#1;
          #18#2 = 999;
          |LEE 000#18];
          |SI FSalida = 0;
               |LEE 000#18a;
          |SINO;
               |LEE 000#18u;
          |FINSI;
          |SI FSalida = 0; |Y #18#0 = #17#0; |Y #18#1 = #17#1;
               nConta = #18#2 + 1;
          |SINO;
               nConta = 1;
          |FINSI;
          |HORA aAlfa;
          |DDEFECTO #18;
          #18#0 = #17#0;
          #18#1 = #17#1;
          #18#2 = nConta;
          #18#3 = "A";
          #18#4 = Usuario % 810;
          #18#5 = ~;
          #18#6 = aAlfa;
          #18#10 = #17#19;
          #18#11 = #17#18;
          #18#12 = #17#7;
          #18#13 = #17#8;
          #18#14 = #17#9;
          #18#15 = #17#10;
          #18#16 = #17#11;
          #18#17 = #17#12;
          #18#18 = #17#13;
          #18#19 = #17#14;
          #18#20 = #17#15;
          #18#21 = #17#16;
          #18#39 = #17#5;
          #18#40 = #17#21;
          #18#41 = #17#22;
          #18#42 = #17#45;
          #18#43 = #17#46;
          |GRABA 020#18b;
          |SI FSalida = 0;
               |HORA aAlfa;
               |DDEFECTO #14;
               #14#0 = #18#0;
               #14#1 = #18#1;
               #14#2 = nConta;
               #14#3 = "A";
               #14#4 = Usuario % 810;
               #14#5 = ~;
               #14#6 = aAlfa;
               #14#7 = "01.01.0000";
               #14#10 = #17#19;
               #14#11 = #17#18;
               #14#12 = #17#7;
               #14#13 = #17#8;
               #14#14 = #17#9;
               #14#15 = #17#10;
               #14#16 = #17#11;
               #14#17 = #17#12;
               #14#18 = #17#13;
               #14#19 = #17#14;
               #14#20 = #17#15;
               #14#21 = #17#16;
               #14#39 = #17#5;
               #14#40 = #17#21;
               #14#41 = #17#22;
               #14#42 = #17#45;
               #14#43 = #17#46;
               |DDEFECTO #24;
               |ABRE #24;
               #24#0 = #14#39;
               |LEE 020#24=;
               |CIERRA #24;
               |DDEFECTO #21;
               |ABRE #21;
               #21#0 = #14#11;
               |LEE 020#21=;
               |CIERRA #21;
               |DDEFECTO #22;
               |ABRE #22;
               #22#0 = #14#10;
               |LEE 020#22=;
               |CIERRA #22;
               #14#44 = #24#1;
               #14#45 = #21#1;
               #14#46 = #22#1;
               |HAZ PinPanParte;
               |ENDATOS #1#14;
               |SI FSalida = 0;
                    |PARA i = 0; |SI i [ 43; |HACIENDO i = i + 1;
                         #18i = #14i;
                    |SIGUE;
                    |GRABA 020#18a;
                    |BUCLE Graba19;
                    enError = 0;
                    |CONFI "0000¿Imprimir aviso?";
                    |SI FSalida = 0; |HAZ ImpAviso; |FINSI;
               |SINO;
                   |BORRA 020#18c;
               |FINSI;
               |HAZ BorPanParte;
          |FINSI;
     |FINSI;
     |SI enModo = 2;
          |LEE 121#18=;
          |PARA i = 0; |SI i [ 43; |HACIENDO i = i + 1;
               #14i = #18i;
          |SIGUE;
          |DDEFECTO #24;
          |ABRE #24;
          #24#0 = #14#39;
          |LEE 020#24=;
          |CIERRA #24;
          |DDEFECTO #21;
          |ABRE #21;
          #21#0 = #14#11;
          |LEE 020#21=;
          |CIERRA #21;
          |DDEFECTO #22;
          |ABRE #22;
          #22#0 = #14#10;
          |LEE 020#22=;
          |CIERRA #22;
          #14#44 = #24#1;
          #14#45 = #21#1;
          #14#46 = #22#1;
          |BUCLE GraLineal19;
          |HAZ PinPanParte;
          |ENDATOS #2#14;
          |SI FSalida = 0;
               |PARA i = 0; |SI i [ 43; |HACIENDO i = i + 1;
                    #18i = #14i;
               |SIGUE;
               |GRABA 020#18a;
               |BUCLE Borra19;
               |BUCLE Graba19;
               enError = 0;
               |CONFI "0000¿Imprimir aviso?";
               |SI FSalida = 0; |HAZ ImpAviso; |FINSI;
          |FINSI;
          |HAZ BorPanParte;
     |FINSI;
     |CIERRAT #19;
     Tempo = aTmp19; |HAZ BoraTempo; |DELINDEX #19;
     aAlfa = "ialbm019"; |NOME_DAT #19aAlfa;
     |ABRET #19;
     |HAZ RecalAviso;
     |CIERRAT #19;
     |CIERRAT #18;
     |CIERRAT #17;
     |CIERRAT #ialbm019@;

     |DESCARGA_DEF #ialbm019@;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentana1;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;
     |FINVENTANA nVentana1;

     |PULSATECLA;
|FPRC;

|PROCESO MiraCerrados;
     |SI #17#63 = "S";
          |SI #18#3 = "A";
               nHay = 1;
               |ERROR10;
          |FINSI;
     |SINO;
          |SI #18#3 = "A"; |Y #18#2 ! #118#2;
               nHay = 1;
               |ERROR10;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE MiraCerrados;
     #18#1;
     ;
     #17#0, #17#1, 001;
     #17#0, #17#1, 999;
     ;
     NULL, MiraCerrados;
|FIN;

|PROCESO CierraAviso;
     |VENTANA 2111, 3089, -1, 17, "Cerrar Aviso";
     nVentana2 = FSalida;
     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentana2;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;
     |DDEFECTO #219;
     |PARA i = 0; |SI i [ 9; |HACIENDO i = i + 1;
          nCampo = i + 26;
          #219i = #17nCampo;
     |SIGUE;
     |PINPA #0#219;
     |PINDA #0#219;
     |ENDATOS #2#219;
     |SI FSalida = 0;
          |PARA i = 0; |SI i [ 9; |HACIENDO i = i + 1;
               aAlfa = #219i; |QBF aAlfa;
               |SI aAlfa ! ""; |SAL; |FINSI;
          |SIGUE;
          |SI i > 9;
               |MENAV "0000No se ha indicado el texto de soluci¢n, no se cierra el parte...";
          |SINO;
               |PARA i = 0; |SI i [ 9; |HACIENDO i = i + 1;
                    nCampo = i + 26;
                    #17nCampo = #219i;
               |SIGUE;
               #17#24 = "C";
               |GRABA 020#17a;
               enError = 0;
          |FINSI;
     |FINSI;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentana2;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;
     |FINVENTANA nVentana2;

     |PULSATECLA;
|FPRC;

|PROCESO CierraParte;
     enError = 1;
     |VENTANA 0910, 3390, -1, 17, "Cerrar Parte";
     nVentana1 = FSalida;
     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentana1;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |ABRE #17;
     |ABRET #18;
     |ABRET #19;
     |LEE 121#17=;
     |LEE 121#18=;
     |PARA i = 0; |SI i [ 43; |HACIENDO i = i + 1;
          #118i = #18i;
     |SIGUE;
     |DDEFECTO #24;
     |ABRE #24;
     #24#0 = #118#39;
     |LEE 020#24=;
     |CIERRA #24;
     |DDEFECTO #21;
     |ABRE #21;
     #21#0 = #118#11;
     |LEE 020#21=;
     |CIERRA #21;
     |DDEFECTO #22;
     |ABRE #22;
     #22#0 = #118#10;
     |LEE 020#22=;
     |CIERRA #22;
     |DDEFECTO #119;
     |ABRE #119;
     #119 = #118#40;
     |LEE 000#119=;
     |CIERRA #119;

     #118#44 = #24#1;
     #118#45 = #21#1;
     #118#46 = #22#1;
     #118#47 = #119#1;
     |PINPA #0#118;
     |PINDA #0#118;
     |ENDATOS #2#118;
     |SI FSalida = 0;
          |PARA i = 22; |SI i [ 31; |HACIENDO i = i + 1;
               aAlfa = #118i; |QBF aAlfa;
               |SI aAlfa ! ""; |SAL; |FINSI;
          |SIGUE;
          |SI i > 31;
               |MENAV "0000No se ha indicado el texto de soluci¢n, no se cierra el parte...";
          |SINO;
               nHay = 0;
               |SALVA_FICHA #18;
               |BUCLE MiraCerrados;
               |REPON_FICHA #18;
               |SI nHay = 0;
                    |HAZ CierraAviso;
                    FSalida = enError;
               |SINO;
                    FSalida = 0;
               |FINSI;
               |SI FSalida = 0;
                    |PARA i = 0; |SI i [ 43; |HACIENDO i = i + 1;
                         #18i = #118i;
                    |SIGUE;
                    #18#3 = "C";
                    #18#8 = ~;
                    #18#9 = Usuario % 810;
                    |GRABA 020#18a;
                    enError = 0;
               |FINSI;
          |FINSI;
     |FINSI;
     |HAZ RecalAviso;
     |CIERRAT #19;
     |CIERRAT #18;
     |CIERRA #17;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentana1;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;
     |FINVENTANA nVentana1;

     |PULSATECLA;
|FPRC;

|PROCESO Producto;
     nHayProdu = 1;
     |PRINT;
|FPRC;

|DEFBUCLE Producto;
     #19#1;
     ;
     #18#0, #18#1, #18#2, 001;
     #18#0, #18#1, #18#2, 999;
     ;
     NULL, Producto;
|FIN;

|PROCESO ImpParte;
     |IMPRE 0;
     |SI FSalida = 0;
          |INFOR "ialbm018";
          |SI FSalida = 0;
               nHayProdu = 0;
               |BUCLE Producto;
               |SI nHayProdu = 0; |PRINT; |FINSI;
               |PIEINF;
               |FININF;
          |SINO;
               |MENAV "0000Error en informe 'ialbm018'"
          |FINSI;
          |FINIMP;
     |FINSI;
|FPRC;

|PROCESO ImpreParte
     |ABRE #17;
     |ABRE #18;
     |LEE 020#17=;
     |LEE 020#18=;
     |SI FSalida = 0;
          |HAZ ImpParte;
     |FINSI;
     |CIERRA #18;
     |CIERRA #17;
|FPRC;

|PROCESO AsignaMatriPar;
     enError = 1;
     |VENTANA 0910, 2590, -1, 17, "Asignar Matr¡cula";
     nVentana1 = FSalida;
     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentana1;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |ABRET #17;
     |ABRET #18;
     |LEE 121#17=;
     |LEE 121#18=;
     #15#0 = #18#0;
     #15#1 = #18#1;
     #15#2 = #18#39;
     #15#3 = #17#6;
     #15#4 = #18#12;
     #15#5 = #18#13;
     #15#6 = #18#14;
     #15#7 = #18#15;
     #15#8 = #18#16;
     #15#9 = #18#17;
     #15#10 = #18#18;
     #15#11 = #18#19;
     #15#12 = #18#20;
     #15#13 = #18#21;
     #15#14 = #18#40;
     #15#15 = #18#41;

     |DDEFECTO #24;
     |ABRE #24;
     #24#0 = #15#2;
     |LEE 020#24=;
     |CIERRA #24;
     |DDEFECTO #3;
     |ABRE #3;
     #3#0 = #15#2;
     #3#1 = #15#3;
     |LEE 020#3=
     |CIERRA #3;
     |DDEFECTO #119;
     |ABRE #119;
     #119#0 = #15#14;
     |LEE 000#119=;
     |CIERRA #119;

     #15#16 = #24#1;
     #15#17 = #3#2;
     #15#18 = #119#0;

     |PINPA #0#15;
     |PINDA #0#15;
     |ENDATOS #2#15;
     |SI FSalida = 0;
          #18#40 = #15#14;
          #18#41 = #15#15;
          |GRABA 020#18a;
          |SALVA_FICHA #18;
          enError = 0;
          |CONFI "0000SAsignar matr¡cula a todos los partes";
          |SI FSalida = 0;
               #17#21 = #15#14;
               #17#22 = #15#15;
               |GRABA 020#17a;
               |BUCLE AsgMatPar;
          |FINSI;
          |REPON_FICHA #18;
     |FINSI;
     |CIERRAT #18;
     |CIERRAT #17;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentana1;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;
     |FINVENTANA nVentana1;

     |PULSATECLA;
|FPRC;

|PROCESO Refresca1;
     #refera2@#1 = 0; |REFRESCACONTROL enGrida3;
     #refera1@#1 = 0; |REFRESCACONTROL enGrida2;
     |SALVA_DATOS #17;
     |REPON_DATOS #refera1@;
     |LEE 000#refera1@.=;
     |REFRESCACONTROL enGrida1;
     |SI enPosiciona = 1; |FOCOTECLADO enGrida1; |FINSI;
|FPRC;

|PROCESO Refresca2;
     #referb2@#1 = 0; |REFRESCACONTROL enGridb3;
     #referb1@#1 = 0; |REFRESCACONTROL enGridb2;
     |SALVA_DATOS #17;
     |REPON_DATOS #referb1@;
     |LEE 000#referb1@.=;
     |REFRESCACONTROL enGridb1;
     |SI enPosiciona = 1; |FOCOTECLADO enGridb1; |FINSI;
|FPRC;

|PROCESO Refresca3;
     #referc2@#1 = 0; |REFRESCACONTROL enGridc3;
     #referc1@#1 = 0; |REFRESCACONTROL enGridc2;
     |SALVA_DATOS #17;
     |REPON_DATOS #referc1@;
     |LEE 000#referc1@.=;
     |REFRESCACONTROL enGridc1;
     |SI enPosiciona = 1; |FOCOTECLADO enGridc1; |FINSI;
|FPRC;

|PROCESO Refresca4;
     #referd2@#1 = 0; |REFRESCACONTROL enGridd3;
     #referd1@#1 = 0; |REFRESCACONTROL enGridd2;
     |SALVA_DATOS #17;
     |REPON_DATOS #referd1@;
     |LEE 000#referd1@.=;
     |REFRESCACONTROL enGridd1;
     |SI enPosiciona = 1; |FOCOTECLADO enGridd1; |FINSI;
|FPRC;

|PROCESO CreaLinAlb;
     |ABRE #119;
     #119#0 = #19#4;
     |LEE 000#119=;
     |CIERRA #119;

     enForma = 1;
     nLin = nLin + 1;
     |DDEFECTO #71;
     #71#29 = #100#52;
     #71#0 = #100#0;
     #71#1 = nLin;
     #71#2 = #19#4;
     #71#3 = 1;
     #71#4 = #19#5;
     #71#5 = #19#6 * enTipo;
     #71#6 = #19#7;
     #71#8 = #19#8;
     |SI #19#11 = "N";
          #71#6 = 0;
     |FINSI;
     #71#11 = #119#30;
     #71#13 = #119#2;
     #71#15 = #100#3;
     #71#16 = #100#34;
     #71#17 = #100#35;
     #71#36 = #71#6;
     #71#38 = #71#6;

     |HAZ AcumulaAV;
     #71#14 = enCoste;

     uni_dt = #71#5;
     enDescuento1 = #71#8;
     enDescuento2 = #71#33;
     eaTComision  = #71#16;
     eaCliente    = #100#3;
     eaArticulo   = #71#2;
     efFecha      = #100#1;
     eaRepre      = #100#6;
     enDirEnt = #100#84;
     enAlmacen = #71#3;
     |HAZ Comisiones;
     #71#10 = enComision;

     |HAZ TotalLin71;
     |GRABA 020#71n;
|FPRC;

|DEFBUCLE CreaLinAlb;
     #19#1;
     ;
     #17#0, #17#1, 001, 001;
     #17#0, #17#1, 999, 999;
     ;
     NULL, CreaLinAlb;
|FIN;

|PROCESO CheqFactu;
     |SI #19#11 = "S";
          aFacturable = "S";
          |ERROR10;
     |FINSI;
|FPRC;

|DEFBUCLE CheqFactu;
     #19#1;
     ;
     #17#0, #17#1, 001, 001;
     #17#0, #17#1, 999, 999;
     ;
     NULL, CheqFactu;
|FIN;

|PROCESO CreaAlba;
     aFacturable = "N";
     |BUCLE CheqFactu;
     |SI aFacturable = "N";
          #100#52 = #6#14;
     |SINO;
          #100#52 = #6#13;
     |FINSI;

     |LEE 121#17=;
     #17#23 = aFacturable;
     |GRABA 020#17a;
     |LIBERA #17;

     aSerAlbAnt = "";
     |SI enTipo = -1;
          aFacturable = "N";
          |ABRE #23;
          #23#0 = #17#0;
          #23#1 = #17#1;
          #23#4 = 999;
          |LEE 000#23];
          |SI FSalida = 0;
               |LEE 000#23a;
          |SINO;
               |LEE 000#23u;
          |FINSI;
          |SI FSalida = 0; |Y #23#0 = #17#0; |Y #23#1 = #17#1;
               aSerAlbAnt = #23#2;
               nNumAlbAnt = #23#3;
          |FINSI;
          |CIERRA #23;
     |FINSI;

     |ABRE #321; |LEE 000#321p; |CIERRA #321;

     |DDEFECTO #24;
     |ABRE #24;
     #24#0 = #17#5;
     |LEE 020#24=;
     |CIERRA #24;
     |DDEFECTO #3;
     |ABRE #3;
     #3#0 = #17#5;
     #3#1 = #17#6;
     |LEE 020#3=;
     |CIERRA #3;

     |DDEFECTO #25;
     |ABRE #25;
     |SI #3#14 = "  ";
          #25#0 = #24#25;
     |SINO;
          #25#0 = #3#14;
     |FINSI;
     |LEE 020#25=;
     |CIERRA #25;

     |ABRE #100;
     |ABRE #71;
     enSwMenu = 1;
     |HAZ ContaAV7;
     |GRABA 020#100b;
     enError = FSalida;
     |SI FSalida = 0;
          #17#36 = #100#52;
          #17#37 = #100#0;

          #100#3 = #24#0;
          #100#4 = #24#2;
          #100#5 = #24#37;
          #100#6 = #25#0;
          #100#7 = #24#38;
          #100#8 = #24#20;
          #100#29 = #17#47; || #3#10;
          #100#30 = #17#52; || #3#2;
          #100#31 = #17#53; || #3#3;
          #100#32 = #24#146;
          #100#33 = #17#56; ||#3#7;
          #100#34 = #25#7;
          #100#35 = #24#4;
          #100#36 = #24#47;
          #100#40 = #24#41;
          #100#51 = aFacturable;

          aAlfa = #17#0 + "/" + (("000000" + #17#1) % -106);
          #100#57 = aAlfa;

          aAlfa = (("00" + #17#54) % -102) + (("000" + #17#55) % -103);
          #100#62 = aAlfa; ||#3#6;

          #100#63 = #17#57; || #24#15;

          |ABRE #324
          #100#68 = #24#192;
          |DDEFECTO #324;
          #324#0 = #100#68;
          |LEE 000#324=;
          #100#69 = #324#2;
          #100#70 = #24#193;
          #100#73 = #321#9;
          |DDEFECTO #324;
          #324#0 = #100#73;
          |LEE 000#324=;
          #100#74 = #324#2;
          |CIERRA #324;
          aDivisa = #100#68;
          aMoneda = #100#70;
          |HAZ Divisas010;
          #100#84 = #3#1;
          nLin = 0;
          |BUCLE CreaLinAlb;
          |HAZ LimCabAgifa010;
          |BUCLELIN 0 CalCabAgifa010 #100;
          |HAZ actpf;
          |SI aSerAlbAnt ! "";
               aAlfa = aSerAlbAnt + "/" + (("000000" + nNumAlbAnt) % -106);
               #100#56 = aAlfa;
          |FINSI;
          |GRABA 020#100a;
          |LIBERA #100;
          |SI enTipo = 1;
               |CONFI "0000N¨Imprimir albar n?";
               |SI FSalida = 0;
                    ser_alb = #100#52;
                    num_alb = #100#0;
                    abono = #100#43;
                    eaMenuImpre = "N";
                    |SUB_EJECUTA_NP "agifa014";
               |FINSI;
               |CONFI "0000N¨Facturar albar n?";
               |SI FSalida = 0;
                    ser_alb = #100#52;
                    num_alb = #100#0;
                    fec_alb = #100#1;
                    abo_alb = #100#43;
                    |SUB_EJECUTA_NP "agifa057";
               |FINSI;
          |FINSI;

          |ABRE #23;
          #23#0 = #17#0;
          #23#1 = #17#1;
          #23#4 = 999;
          |LEE 000#23];
          |SI FSalida = 0;
               |LEE 000#23a;
          |SINO;
               |LEE 000#23u;
          |FINSI;
          |SI FSalida = 0; |Y #23#0 = #17#0;  |Y #23#1 = #17#1;
               nConta = #23#4 + 1;
          |SINO;
               nConta = 1;
          |FINSI;
          |DDEFECTO #23;
          #23#0 = #17#0;
          #23#1 = #17#1;
          #23#2 = #100#52;
          #23#3 = #100#0;
          #23#4 = nConta;
          |GRABA 020#23n;
          |CIERRA #23;
          |SI aSerAlbAnt ! "";
               aAlfa = #100#52 + "/" + (("000000" + #100#0) % -106);
               #100#52 = aSerAlbAnt;
               #100#0 = nNumAlbAnt;
               |LEE 121#100=;
               |SI FSalida = 0;
                    #100#51 = "N";
                    #100#56 = aAlfa;
                    |GRABA 020#100a;
               |FINSI;
          |FINSI;
     |FINSI;
     |CIERRA #71;
     |CIERRA #100;
|FPRC;

---------------------------------------------------------

|PROCESO NumPed29; |TIPO 0;
     |SI #29#46 ! 0;
          |ABRE #104;
          #104#25 = #29#45;
          #104#0 = #29#46;
          |LEE 000#104=;
          |SI FSalida ! 0;
               |MENAV "0000No existe pedido...";
          |FINSI;
          |CIERRA #104;
     |SINO;
          #29#45 = ""; |PINTA #29#45;
     |FINSI;
|FPRC;

|PROCESO ContratoSN29;
     |ABRE #4;
     #4#0 = #29#5;
     #4#1 = #29#22;
     #4#2 = #29#21;
     |LEE 000#4=;
     |SI FSalida ! 0;
          |ABRE #10;
          |SELECT #3#10;
          #10#1 = #29#5;
          #10#2 = #29#21;
          #10#4 = #29#22;
          |LEE 000#10=;
          |SI FSalida = 0;
               #29#63 = "S"; |PINTA #29#63;
          |SINO;
               #29#63 = "N"; |PINTA #29#63;
          |FINSI;
          |CIERRA #10;
     |SINO;
          #29#63 = "S"; |PINTA #29#63;
     |FINSI;
     |CIERRA #4;
|FPRC;

|PROCESO PonArt29;
     |ABRE #119;
     #119#0 = #29#21;
     |LEE 000#119=;
     |SI FSalida = 0;
          #29#64 = #119#1; |PINTA #29#64;
     |FINSI;
     |CIERRA #119;
|FPRC;

|PROCESO ArtCto290; |TIPO 0;
     nError = 0;
     eaTipCto = #29#20;
     eaCliCto = #29#5;
     eaMatCto = #29#22;
     eaArtCto = #29#21;
     |HAZ CheqMatCto;
     |SI FSalida = 0;
          eaTipCto = #29#20;
          eaCliCto = #29#5;
          eaMatCto = #29#22;
          eaArtCto = #29#21;
          |HAZ CheqArtCto;
          |SI FSalida ! 0;
               |MENAV "0000No existe art¡culo...";
               |ERROR; nError = 1;
          |FINSI;
     |SINO;
          |ABRE #agifa019;
          #agifa019#0 = #29#21;
          |LEE 000#agifa019.=;
          |SI FSalida ! 0;
               |MENAV "0000No existe art¡culo...";
               |ERROR; nError = 1;
          |FINSI;
          |CIERRA #agifa019;
     |FINSI;
     |SI nError = 0; |Y #29Campo ! Contenido;
          |HAZ PonArt29;
          |HAZ ContratoSN29;
     |FINSI;
|FPRC;

|PROCESO ArtCto2966;  |TIPO 66;
     eaTipCto = #29#20;
     eaCliCto = #29#5;
     eaMatCto = #29#22;
     eaArtCto = #29#21;
     |HAZ CheqMatCto;
     |SI FSalida = 0;
          eaTipCto = #29#20;
          eaCliCto = #29#5;
          eaMatCto = #29#22;
          eaArtCto = #29#21;
          |HAZ ConsuArtCto;
          |SI FSalida = 0;
               #29#21 = eaArtCto; |PINTA #29#21;
               |HAZ PonArt29;
          |SINO;
               |ERROR;
          |FINSI;
     |SINO;
          |ABRE #agifa019;
          |CONSULTA_CLAVE #1#agifa019;
          |SI FSalida = 0;
               #29#21 = #agifa019#0; |PINTA #29#21;
               |HAZ PonArt29;
          |SINO;
               |ERROR;
          |FINSI;
          |CIERRA #agifa019;
     |FINSI;
|FPRC;

|PROCESO MatCto290; |TIPO 0;
     eaTipCto = #29#20;
     eaCliCto = #29#5;
     eaMatCto = #29#22;
     eaArtCto = #29#21;
     |HAZ CheqMatCto;
     |SI FSalida ! 0;
          ||Dejamos que siga y que pueda meter luego el articulo.
     |FINSI;
     |SI #29Campo ! Contenido;
          |HAZ PonArt29;
          |HAZ ContratoSN29;
     |FINSI;
|FPRC;

|PROCESO MatCto2966; |TIPO 66;
     eaTipCto = #29#20;
     eaCliCto = #29#5;
     eaMatCto = #29#22;
     eaArtCto = #29#21;
     |HAZ ConsuMatCto;
     |SI FSalida = 0;
          #29#22 = eaMatCto; |PINTA #29#22;
          #29#21 = eaArtCto; |PINTA #29#21;
          |HAZ PonArt29;
     |SINO;
          |ERROR;
     |FINSI;
|FPRC;

|PROCESO Mini3;
     #3#0 = #29#5;
     #3#1 = 0001;
|FPRC;

|PROCESO Maxi3;
     #3#0 = #29#5;
     #3#1 = 9999;
|FPRC;

|PROCESO DirEnt2966; |TIPO 66;
     |ABRE #3;
     #3#0 = #29#5;
     #3#1 = #29#6;
     |LEE 000#3];
     |CONSULTA_F_CLAVE #1#3, Mini3, Maxi3;
     |SI FSalida = 0;
          #29#6 = #3#1; |PINTA #29#6;
     |SINO;
          |ERROR;
     |FINSI;
     |CIERRA #3;
|FPRC;

|PROCESO DirEnt297; |TIPO 7;
     |SI enModo = 1;
          eaClienteAnt = "";
          enDirEntAnt = 0;
     |SINO;
          eaClienteAnt = #29#5;
          enDirEntAnt = #29#6;
     |FINSI;
|FPRC;

|PROCESO DirEnt290; |TIPO 0;
     |ABRE #3;
     #3#0 = #29#5;
     #3#1 = #29#6;
     |LEE 000#3=;
     |SI FSalida = 0;
          |SI #3#18 = "N";
               |MENAV "0000Direcci¢n no activa...";
          |SINO;
               |SI eaClienteAnt ! #29#5; |O enDirEntAnt ! #29#6;
                    #29#48 = #3#2;
                    #29#55 = #3#3;
                    #29#56 = #3#4;
                    #29#57 = #3#5;
                    #29#58 = #3#7;
                    #29#60 = #3#13;
                    #29#61 = #3#21;
                    #29#62 = #3#24;

                    |PINTA #29#48;
                    |PINTA #29#55;
                    |PINTA #29#56;
                    |PINTA #29#57;
                    |PINTA #29#58;
                    |PINTA #29#60;
                    |PINTA #29#61;
                    |PINTA #29#62;

                    eaClienteAnt = #29#5;
                    enDirEntAnt = #29#6;
               |FINSI;
          |FINSI;
     |SINO;
          |CONFI "0000NNo existe direcci¢n para este cliente. ¿Continuar?";
          |SI FSalida ! 0; |ERROR; |FINSI;
     |FINSI;
     |CIERRA #3;
|FPRC;

|PROCESO Cliente297; |TIPO 7;
     |SI enModo = 1;
          eaClienteAnt = "";
     |SINO;
          eaClienteAnt = #29#5;
     |FINSI;
|FPRC;

|PROCESO Cliente290; |TIPO 0;
     nError = 0;
     |DBASS aPath;
     aPath = aPath + "dscarter/";
     aPathDef = aPath + "def/";
     aAlfa = aPathDef + "dscam038";
     |CARGA_DEF aAlfa, dscam038@;
     |SI FSalida = 0;
          |DFICE aAlfa;
          aNumEmp = aAlfa % -205;
          nNumEmp = aNumEmp;
          aPath = aPath + "fich/";
          |PATH_DAT #dscam038@#aPath#;
          |BUCLE dscam038;
          |DESCARGA_DEF #dscam038@;

          aAlfa = aPathDef + "dscam023";
          |CARGA_DEF aAlfa, dscam023@;
          |SI FSalida ! 0; |MENAV "0000Error al cargar 'dscam023'"; |FINSI;
          |SI aPathDat = "";
               |MENAV "0000Error, no encuentro empresa cartera";
          |SINO;
               |PATH_DAT #dscam023@#aPathDat#;
               |ABRE #dscam023@;
               #dscam023@#0 = #29#5;
               |LEE 000#dscam023@.=;
               |SI FSalida = 0; |Y #dscam023@#9 = "S";
                    aAlfa = "0000Cliente con riesgo bloqueado [" + #dscam023@#10 + "]";
                    |MENAV aAlfa;
                    |ERROR; nError = 1;
               |FINSI;
               |CIERRA #dscam023@;
          |FINSI;
          |DESCARGA_DEF #dscam023@;
     |FINSI;

     |SI #29#5 ! eaClienteAnt;
          |ABRE #agifa024;
          |DDEFECTO #agifa024;
          #agifa024#0 = #29#5;
          |LEE 000#agifa024.=;
          |CIERRA #agifa024;

          #29#47 = #agifa024#1;
          #29#48 = #agifa024#5;
          #29#55 = #agifa024#6;
          #29#56 = #agifa024#178;
          #29#57 = #agifa024#179;
          #29#58 = #agifa024#7;
          #29#59 = #agifa024#15;
          #29#60 = #agifa024#17;
          #29#61 = #agifa024#18;
          #29#62 = #agifa024#197;

          |PINTA #29#47;
          |PINTA #29#48;
          |PINTA #29#55;
          |PINTA #29#56;
          |PINTA #29#57;
          |PINTA #29#58;
          |PINTA #29#59;
          |PINTA #29#60;
          |PINTA #29#61;
          |PINTA #29#62;

          eaClienteAnt = #29#5;
     |FINSI;
     |SI nError = 0; |Y #29Campo ! Contenido;
          |HAZ ContratoSN;
     |FINSI;
|FPRC;

|PROCESO GrabaDir29;
     |ABRE #24;
     #24#0 = #29#5;
     |LEE 020#24=;
     |CIERRA #24;

     |DDEFECTO #3;
     |ABRE #3;
     #3#0 = #29#5;
     #3#1 = #29#6;
     |LEE 101#3=;
     |SI FSalida ! 0;
          #3#10 = #24#2;
          #3#2 = #29#48;
          #3#3 = #29#55;
          #3#4 = #29#56;
          #3#5 = #29#57;
          #3#7 = #29#58;
          #3#13 = #29#60;
          #3#21 = #29#61;
          #3#24 = #29#62;
          |GRABA 020#3n;
     |FINSI;
     |CIERRA #13;
|FPRC;

|PROCESO Graba18;
     |DDEFECTO #18;
     #18#0 = #17#0;
     #18#1 = #17#1;
     #18#2 = 1;
     #18#3 = "C";
     #18#4 = Usuario % 810;
     #18#5 = ~;
     |HORA aAlfa;
     #18#6 = aAlfa;
     #18#7 = ~;
     #18#8 = ~;
     #18#9 = Usuario % 810;
     #18#10 = #17#19;
     #18#11 = #17#18;
     #18#39 = #17#5;
     #18#40 = #17#21;
     #18#41 = #17#22;
     #18#42 = #17#45;
     #18#43 = #17#46;
     |GRABA 020#18n;
|FPRC;

|PROCESO PinPaEntre;
     |PINPA #0#29; nPantaEnt = FSalida;
     |PINDA #0#29;
     nRango = 4 + 8 + 16 + 32;
     nPos1 = 3002;
     nPos2 = 3481;
     |LINEAL_SIMPLE #1#19, nRango, nPos1, nPos2, Min19, Max19, Evento19;
     nGridPar = FSalida;
     |CONTROL_SIMPLE nPantaEnt, "BOTON,{{193}}Alta", 2902, 2914, BtnAlta;
     nBtnAlta = FSalida;
     |CONTROL_SIMPLE nPantaEnt, "BOTON,{{197}}Modificar", 2915, 2927, BtnModi;
     nBtnModi = FSalida;
     |CONTROL_SIMPLE nPantaEnt, "BOTON,{{199}}Baja", 2928, 2940, BtnBaja;
     nBtnBaja = FSalida;
     |CONTROL_SIMPLE nPantaEnt, "BOTON,{{204}}Consulta", 2941, 2953, BtnConsu;
     nBtnConsu = FSalida;
|FPRC;

|PROCESO EditaEntrega;
     enError = 1;
     |SI enModo = 1; |VENTANA 0509, 3590, -1, 17, "Nueva Entrega"; |FINSI;
     |SI enModo = 2; |VENTANA 0550, 3590, -1, 17, "Modificar Entrega"; |FINSI;
     nVentana1 = FSalida;
     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentana1;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |DDEF aAlfa;
     aAlfa = aAlfa + "ialbm019";
     |CARGA_DEF aAlfa, ialbm019@;

     |HAZ CreaTempo; |NOME_DAT #19 Tempo; |DELINDEX #19; aTmp19 = Tempo;

     |ABRET #ialbm019@;
     |ABRET #17;
     |ABRET #18;
     |ABRET #19;
     |SI enModo = 1;
          #17#0 = #6#6;
          #17#1 = 999999;
          |LEE 000#17];
          |SI FSalida = 0;
               |LEE 000#17a;
          |SINO;
               |LEE 000#17u;
          |FINSI;
          |SI FSalida = 0; |Y #17#0 = #6#6;
               nConta = #17#1 + 1;
          |SINO;
               nConta = 1;
          |FINSI;
          |DDEFECTO #17;
          #17#0 = #6#6;
          #17#1 = nConta;
          #17#63 = "S";       ||Es entrega
          |GRABA 020#17b;
          |SI FSalida = 0;
               |HORA aAlfa;
               |DDEFECTO #29;
               #29#0 = #6#6;
               #29#1 = nConta;
               #29#2 = ~;
               #29#3 = aAlfa;
               #29#4 = Usuario % 810;
               #29#5 = #0#0;
               |HAZ PinPaEntre;
               |ENDATOS #1#29;
               |SI FSalida = 0;
                    |PARA i = 0; |SI i [ 47; |HACIENDO i = i + 1;
                         #17i = #29i;
                    |SIGUE;
                    |HAZ GrabaDir29;
                    |DDEFECTO #24;
                    |ABRE #24;
                    #24#0 = #17#5;
                    |LEE 000#24=;
                    |CIERRA #24;
                    #17#48 = #24#2;
                    #17#49 = #29#52;
                    #17#50 = #29#53;
                    #17#51 = #29#54;
                    #17#52 = #29#48;
                    #17#53 = #29#55;
                    #17#54 = #29#56;
                    #17#55 = #29#57;
                    #17#56 = #29#58;
                    #17#57 = #29#59;
                    #17#58 = #29#60;
                    #17#59 = #29#61;
                    #17#60 = #29#62;
                    #17#61 = #29#63;
                    #17#62 =  #29#64;

                    #17#24 = "V";
                    #17#25 = Usuario % 810;

                    |GRABA 020#17a;
                    |HAZ Graba18;
                    |BUCLE Graba19;
                    |CONFI "0000N¿Imprimir aviso?";
                    |SI FSalida = 0; |HAZ ImpAviso; |FINSI;
                    enTipo = 1;
                    |HAZ CreaAlba;
                    |HAZ Refresca4;
               |SINO;
                    |BORRA 020#17c;
               |FINSI;
          |FINSI;
     |FINSI;
     |CIERRAT #19;
     |CIERRAT #18;
     |CIERRAT #17;

     |CIERRAT #ialbm019@;
     Tempo = aTmp19; |HAZ BoraTempo; |DELINDEX #19;
     aAlfa = "ialbm019"; |NOME_DAT #19aAlfa;
     |DESCARGA_DEF #ialbm019@;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentana1;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;
     |FINVENTANA nVentana1;
     |PULSATECLA;

     |SI enModo = 1; |Y enError = 0;
          |HAZ EnvioSMS;
     |FINSI;
|FPRC;

|PROCESO CierraEntrega;
     aAlfa = "0000N¿Cerrar entrega:" + #18#0 + "/" + (("000000" + #18#1) % -106) + "/" + #18#2 + "?";
     |CONFI aAlfa;
     enError = FSalida;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |ABRE #17;
     |ABRE #18;
     |LEE 121#17=;
     |LEE 121#18=;

     #18#3 = "C";
     #18#8 = ~;
     #18#9 = Usuario % 810;
     #18#9 = Usuario % 810;
     |GRABA 020#18a;
     nHay = 0;
     |BUCLE MiraCerrados;
     |SI nHay = 0;
          enTipo = 1;
          |HAZ CreaAlba;
          |SI enError = 0;
               #17#24 = "V";
               #17#25 = Usuario % 810;
               |GRABA 020#17a;
          |FINSI;
     |FINSI;
     |CIERRA #17;
     |CIERRA #18;
|FPRC;
