|FICHEROS;
     iber0027 #0;
     agitp001 #1;
     iber0004 #2;
     agifa007 #4;
     agifa017 #17;
     agifa019 #19;
     agifa067 #67;
     agifa081 #81;
     iber0016 #100;
     agifa112 #112;
     dsm00241 #241; ||Medida
     dsm00244 #244; ||Promo C
     dsm00245 #245; ||Promo L
     agifa321 #321;
     agifa324 #324;
     dsm00226;
     dsm00237;
|FIN;

|VARIABLES;
     nFactor   = 0;
     aProgram  = "";
     &enSwMenu = 0;
     aFech     = @;
     aSeri     = "";
     aAlfa     = "";
     aProv     = "";
     aDirEmp   = "";
     aDatos    = "";
     nCodEmp   = 0;
     nLin      = 0;
     nNume     = 0;
     &enSwConfi= -1;

     &nDeci_PreDiv = 0;
     &nDeci_PreVisP = 0;
     &nDeci_ImpVisP 0;
     &nDeci_Base = 0;
     &nDeci_PreBase = 0;
     &nDeci_BaseMxP   = 0;
     &nDeci_PreBasMxP= 0;
     &nDeci_TotVisP = 0;
     &nDeci_TotNoVisP = 0;
     &nDeci_DivP = 0;
     &nDeci_PreDivP = 0;
     &nDeci_ImpVisP = 0;

     decim_divisa = 0;
     decim_base = 0;
     precio_base = 0;
     precio_divisa = 0;

     nUnits  = 0;
     nPrecio = 0;

     aArti = "";
     aProve = "";
     nSwOfertaProv = 0;
     aAlfa1 = "";
     fFecha = @;
|FIN;

|CAMPOS;
     #19#16  art_prec;  #17#43  alm_prec;
     #19#183 art_prec2; #17#45  alm_prec2;
|FIN;

|PROCESO LeeMoneda;
     |ABRE #agifa321;
     |ABRE #agifa324;
     |LEE 010#agifa321.p;
     #81#32 = #agifa321#9;
     #agifa324#0 = #agifa321#9;
     |LEE 000#agifa324.=;
     #81#33 = #agifa324#3;

     #agifa324#0 = #81#27;
     |LEE 000#agifa324.=;
     decim_base = #agifa324#7;    ||Asigno los decimales de la moneda base
     precio_base = #agifa324#9;   ||Asigno los decimales del precio en la mon. base

     #81#28 = #agifa324#3;

     |CIERRA #agifa324;
     |CIERRA #agifa321;

     decim_divisa = #agifa324#7;  || Decimales de la divisa
     precio_divisa = #agifa324#9;  || Decimales en el precio de la divisa
     nDeci_DivP = decim_divisa;   || Decimales de la divisa
     nDeci_PreDivP = precio_divisa;  || Decimales en el precio de la divisa
     nDeci_PreDiv  = precio_divisa;  || Decimales en el precio de la divisa
     |SI #81#29 = "B";   ||Si trabajo con la moneda base ...
          nDeci_PreVisP  = precio_base;   || precio_divisa;
          nDeci_ImpVisP  = precio_base;   ||decim_divisa;
          nDeci_Base     = decim_base;
          nDeci_PreBase  = precio_base;
          nDeci_BaseMxP  = decim_base;
          nDeci_PreBasMxP= precio_base;
          nDeci_TotVisP  = decim_base;
          nDeci_TotNoVisP = decim_divisa;
     |SINO;     ||Si trabajo con la divisa ...
          nDeci_PreVisP  = precio_divisa; || precio_base;
          nDeci_ImpVisP  = precio_divisa; ||decim_base;
          nDeci_Base     = decim_base;    || Max. precision en los decimales de la moneda base
          nDeci_PreBase  = precio_base;   || Max. precision en los dec. del precio de la moneda base
          |SI #81#28 = 1;
              nDeci_BaseMxP   = decim_base;    || sin triangulacion
              nDeci_PreBasMxP = precio_base;
          |SINO;
              nDeci_BaseMxP   = #agifa321#10;  || con triangulacion
              nDeci_PreBasMxP = #agifa321#11;
          |FINSI;
          nDeci_TotVisP   = decim_divisa;
          nDeci_TotNoVisP = decim_base;
     |FINSI;
|FPRC;

|PROCESO Param_Divisas;
     |ABRE #agifa324;
     #agifa324#0 = #agifa081#27;
     |LEE 001#agifa324.=;   || Leo la divisa
     decim_divisa = #agifa324#7;  || Decimales de la divisa
     precio_divisa = #agifa324#9;  || Decimales en el precio de la divisa
     nDeci_DivP = decim_divisa;   || Decimales de la divisa
     nDeci_PreDivP = precio_divisa;  || Decimales en el precio de la divisa
     |SI #81#29 = "B";   ||Si trabajo con la moneda base ...
          nDeci_PreVisP  = precio_base;   || precio_divisa;
          nDeci_ImpVisP  = precio_base;   ||decim_divisa;
          nDeci_Base     = decim_base;
          nDeci_PreBase  = precio_base;
          nDeci_BaseMxP  = decim_base;
          nDeci_PreBasMxP= precio_base;
          nDeci_TotVisP  = decim_base;
          nDeci_TotNoVisP = decim_divisa;
     |SINO;     ||Si trabajo con la divisa ...
          nDeci_PreVisP   = precio_divisa; || precio_base;
          nDeci_ImpVisP   = precio_divisa; ||decim_base;
          nDeci_Base     = decim_base; || Max. precision en los decimales de la moneda base
          nDeci_PreBase  = precio_base;  || Max. precision en los dec. del precio de la moneda base
          |SI #81#28 = 1;
              nDeci_BaseMxP   = decim_base;    || sin triangulacion
              nDeci_PreBasMxP = precio_base;
          |SINO;
              nDeci_BaseMxP   = #agifa321#10;  || con triangulacion
              nDeci_PreBasMxP = #agifa321#11;
          |FINSI;
          nDeci_TotVisP   = decim_divisa;
          nDeci_TotNoVisP = decim_base;
     |FINSI;
     |CIERRA #agifa324;
|FPRC;

|PROCESO visual_totales;
     |SI #81#29 = "D";
          #81#37 = #81#34;
          #81#38 = #81#35;
          #81#39 = #81#36;
          #81#40 = #81#11;
          #81#41 = #81#12;
          #81#42 = #81#13;
     |SINO;
          #81#37 = #81#11;
          #81#38 = #81#12;
          #81#39 = #81#13;
          #81#40 = #81#34;
          #81#41 = #81#35;
          #81#42 = #81#36;
     |FINSI;
|FPRC;

|PROCESO AcumulaCab;
     #81#11 = #81#11 + #67#9;
     #81#12 = #81#12 + #67#11;
     #81#13 = #81#11 - #81#12;
     #81#34 = #81#11 / #81#33 * #81#28;
     #81#35 = #81#12 / #81#33 * #81#28;
     #81#36 = #81#13 / #81#33 * #81#28;
     |HAZ visual_totales;
|FPRC;

|PROCESO ActStock;
     art_prec = art_prec + #67#5;
     art_prec2 = art_prec2 + #67#41;

     alm_prec = alm_prec + #67#5;
     alm_prec2 = alm_prec2 + #67#41;
     |HAZ ValoraStock;
|FPRC;

|PROCESO CabPedi;
     |DDEFECTO #112;
     #112#0 = aProv;
     |LEE 000#112=;

     #81#25 = aSeri;       || Serie
     enSwMenu = 1;
     |HAZ ContaPC7;
     #81#1 = aFech;
     #81#4 = aProv;
     #81#8 = #112#2;
     #81#9 = #112#17;
     #81#18 = #100#2;
     #81#19 = #100#1;
     #81#20 = #100#3;
     #81#21 = #100#7;
     #81#27 = #112#81; ||Divisa
     #81#29 = #112#82; ||Moneda Tra
     |HAZ LeeMoneda;
     |HAZ Param_Divisas;
     |GRABA 020#81b;
|FPRC;

|PROCESO OfertasProveedor_1;
     #dsm00226#0 = #dsm00237#0;
     |LEE 000#dsm00226.=;
     |SI FSalida = 0; |Y fFecha ] #dsm00226#2; |Y fFecha [ #dsm00226#3;
          |SI nSwOfertaProv = 1;
               aAlfa1 = "0000Articulo [" + aArti + "]" +&13+ "en mas de una oferta.";
               |MENAV aAlfa1;
          |FINSI;
          #67#6 = #dsm00237#4 * nFactor;     || ofertas proveedor, precio
          #67#8 = #dsm00237#6;               || ofertas proveedor, dto.
          nSwOfertaProv = 1;
     |FINSI;
|FPRC;

|DEFBUCLE OfertasProveedor;
     #dsm00237#2;
     ;
     aProve, aArti;
     aProve, aArti;
     ;
     NULL, OfertasProveedor_1;
|FIN;

|PROCESO iber0004;
     |SI #2#5 = 0;
          |ACABA;
     |FINSI;

     |SI aProv ! #2#6; |O aFech ! #2#1; |O aSeri ! #2#7;
          |SI nNume ! 0;
               |HAZ Promocion;
          |FINSI;
          |LIBERA #81;
          aProv = #2#6;
          aFech = #2#1;
          aSeri = #2#7;
          |DDEFECTO #4;
          #4#26 = aSeri;
          |LEE 000#4=;
          |DDEFECTO #100;
          #100#0 = #2#0;
          |LEE 000#100=;
          |HAZ CabPedi;
          nLin = 0;
          nNume = #81#0;
     |FINSI;

     |DDEFECTO #19;
     #19#0 = #2#3;
     |LEE 101#19=;
     |SI FSalida ! 0; |GRABA 020#19b; |FINSI;

     |DDEFECTO #17;
     #17#0 = #2#3;
     #17#1 = #4#31;
     |LEE 101#17=;
     |SI FSalida ! 0; |GRABA 020#17b; |FINSI;

     #1#0 = aProv;
     #1#1 = #2#3;
     |LEE 000#1=;
     |SI FSalida ! 0; |DDEFECTO #1; |FINSI;

     nLin = nLin + 1;
     |DDEFECTO #67;
     #67#28 = #81#25;
     #67#0 = #81#0;
     #67#1 = nLin;
     #67#2 = #2#3;
     #67#3 = #4#31;
     #67#4 = #19#1;

     nUnits  = #2#5;
     nFactor = 1;
     |SI #19#204 = "S";
          |ABRE #241; |SELECT #2#241;
          #241#0 = #19#5;
          #241#2 = #2#10;
          |LEE 000#241=;
          |SI FSalida = 0;
                |SI #241#6 = "D";
                   nUnits = #2#5 * #241#5;
                   nFactor = 1 * #241#5;
               |SINO;
                   nUnits = #2#5 / #241#5;
                   nFactor = 1 / #241#5;
               |FINSI;
          |FINSI;
          |CIERRA #241;
     |FINSI;
     #67#5 = #2#5;  || UNIDADES
     #67#37 = nUnits;

     |SI #1#3 = 0;
          #67#6 = #19#28 * nFactor;          || ult.precio compra articulo
     |SINO;
          #67#6 = #1#3 * nFactor;            || ult.precio compra tarifa
          #67#8 = #1#4;                      || dto. tarifa
     |FINSI;
     aProve = #agifa081#4;
     aArti = #agifa067#2;
     nSwOfertaProv = 0;
     |BUCLE OfertasProveedor;                || ofertas proveedor

     #67#27 = #1#5;
     #67#57 = #1#10;
     #67#14 = #19#30;
     #67#18 = #19#2;
     #67#20 = aProv;
     #67#23 = #81#6;
     #67#24 = #81#7;
     #67#25 = #81#17;
     #67#26 = #81#9;
     #67#54 = #2#10;

     |HAZ TotalLin67;

     |HAZ ActStock;
     |GRABA 020#67n;
     |HAZ AcumulaCab;
     |GRABA 020#81a;
     |GRABA 020#17a;
     |GRABA 020#19a;
     #2#8 = #81#0;
     #2#9 = nLin;
     |GRABA 020#2a;
     |LIBERA #17;
     |LIBERA #19;
|FPRC;

|DEFBUCLE iber0004;
     #2#2;
     ;
     "      ","01.01.0000","     ",0;
     "zzzzzz","31.12.2300","zzzzz",0;
     be;
     NULL, iber0004;
|FIN;

|PROCESO Promocion;
     #81#25 = aSeri;
     #81#0 = nNume;
     |LEE 101#81=;
     |SI FSalida = 0;
          |HAZ Promociones;
          |LIBERA #81;
     |FINSI;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO ejec; |TIPO 12;
     |SI #0#0 ! "SI"; |ACABA; |FINSI;
/*
     |SI aProgram ! "";
          |IMPRE #0;
          |SI FSalida ! 0; |ACABA; |FINSI;
          |INFOR "iber0027";
          |SI FSalida ! 0; FINIMP; |ACABA; |FINSI;
     |FINSI;
*/
     |ABRE #agifa321;
     |ABRE #agifa324;
     |LEE 000#agifa321.p;
     #agifa324#0 = #agifa321#9;
     |LEE 000#agifa324.=;
     |CIERRA #agifa324;
     |CIERRA #agifa321;
     nDeci_PreDiv = #agifa324#9;
     nDeci_Base = #agifa324#7;
     nDeci_PreBase = #agifa324#9;

     fFecha = ~;

     |ABRE #81;
     |ABRE #67;
     |ABRE #112;
     |ABRE #17;
     |ABRET #19;
     |ABRE #1;
     |ABRE #dsm00226;
     |ABRE #4;
     |ABRE #100;
     |BUCLE iber0004;
     |SI nNume ! 0;
          |HAZ Promocion;
     |FINSI;
     |CIERRA #1;
     |CIERRA #dsm00226;
     |CIERRA #4;
     |CIERRA #112;
     |CIERRA #81;
     |CIERRA #67;
     |CIERRA #17;
     |CIERRAT #19;
     |CIERRA #100;
     |SI enSwConfi = 0;
          |PIEINF;
          |FININF;
          |FINIMP;
     |FINSI;
|FPRC;

|PROCESO tipo8; |TIPO 7;
||------ Proceso Para saber si es informe o generacion.
||------ empezado pero como no se sabe que es lo que quieren en el informe
||------ se paro.
/*
     aProgram = PARAMETRO;
     |QBF aProgram;
     |SI aProgram ! "";
          |PINTA 1121 , "INFORME   ";
     |SINO;
          |PINTA 1121 , "GENERACION";
     |FINSI;
*/
|FPRC;
