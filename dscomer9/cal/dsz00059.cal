|FICHEROS;
     dsz00059 #0;
     agifa007 #7;
     agifa010 #10;
     dsw00065 #65,MANTE;
|FIN;

|VARIABLES;
     &eaIva = "";
     &enTipo = 0;;
     &eaSerOrg = "";;
     &eaSerDes = "";
     &enNum = 0;
     &efFecOrg = @;
     &efFecDes = @;
     aAlfa = "";
|FIN;

|PROCESO Tecla; |TIPO 0;
     |SI FSalida = 0; |Y #65Campo = Contenido;
          |SI #65#6 = "*";
               #65#6 = "";
               #0#10 = #0#10 + #65#5;
               #0#11 = #0#11 - #65#5;
          |SINO;
               #65#6 = "*";
               #0#10 = #0#10 - #65#5;
               #0#11 = #0#11 + #65#5;
          |FINSI;
          #0#8 = #0#10 * 100 / #0#12;
          #0#9 = 100 - #0#8;
          |GRABA 020#65a;

          |PINTA #65#6;
          |PINTA #0#8;
          |PINTA #0#9;
          |PINTA #0#10;
          |PINTA #0#11;
     |FINSI;
|FPRC;

|PROCESO agifa010;
     #65#0 = #10#52;
     #65#1 = #10#0;
     #65#2 = #10#1;
     #65#3 = #10#3;
     #65#4 = #10#4;
     #65#5 = #10#77;
     |GRABA 020#65n;
     #0#8 = 100;
     #0#9 = 0;
     #0#10 = #0#10 + #65#5;
     #0#11 = 0;
     #0#12 = #0#10;
|FPRC;

|DEFBUCLE agifa010;
     #10#3;
     38;
     #0#0, #0#6, #0#2, #0#4, "N";
     #0#1, #0#7, #0#2, #0#5, "N";
     ;
     NULL, agifa010;
|FIN;

|PROCESO Min;
     #65#0 = "     ";
     #65#1 = 1;
|FPRC;

|PROCESO Max;
     #65#0 = "zzzzz";
     #65#1 = 999999;
|FPRC;

|PROCESO Tmp;
     |SI #65#6 = "*";
          |PINTA 2302, #65#0;
          |PINTA 2308, #65#1;
          |ABRE #10;
          #10#52 = #0#3;
          #10#0 = #65#1;
          |LEE 000#10=;
          |SI FSalida = 0;
               aAlfa = ("000000" + #10#0) % -106;
               aAlfa = "0000Albaran destino [" + #10#52 + "/" + aAlfa + "] ya existe...";
               |MENAV aAlfa;
               |CONFI "0000NContinuar con los siguientes registros?";
               |SI FSalida ! 0; |ERROR10; |FINSI;
          |SINO;
               enTipo = 2;
               eaSerOrg = #65#0;
               eaSerDes = #0#3;
               enNum = #65#1;
               efFecOrg = #65#2;
               efFecDes = #65#2;
               ||eaIva
               |SUB_EJECUTA_NP "agifa186";
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE Tmp;
     #65#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Tmp;
|FIN;

|PROCESO Tipo3; |TIPO 3;
     |SI #0#2 = #0#3;
          |MENAV "0000La series no pueden ser iguales";
          |ACABA;
     |FINSI;

     aAlfa = Usuario; |QBF aAlfa;
     |NOME_DAT #65 aAlfa;
     |DELINDEX #65;

     |ABRE #65;
     |BUCLE agifa010;
     |CIERRA #65;

     |PINPA #0#65;
     |C_V #0#8, 1, "S";
     |C_V #0#9, 1, "S";
     |C_V #0#10, 1, "S";
     |C_V #0#11, 1, "S";
     |ABRE #7;
     #7#26 = #0#2;
     |LEE 000#7=;
     |PINTA 0517, #7#26; |PINTA 0523, #7#27;
     #7#26 = #0#3;
     |LEE 000#7=;
     |PINTA 0617, #7#26; |PINTA 0623, #7#27;
     |CIERRA #7;
     |PINTA #0#8;
     |PINTA #0#9;
     |PINTA #0#10;
     |PINTA #0#11;
     |ENTLINEAL #1#65, 1, 4, 22, 0, Min, Max;
     |CONFI "0000NProceder con el cambio?";
     |SI FSalida = 0;
          eaIva = "*";                          || No cambia el IVA
          |ABRE #7;
          #7#26 = #0#2;
          |LEE 000#7=
          |SI #7#30 = "S"; eaIva = "X"; |FINSI; ||Cambia IVA segun arti
          #7#26 = #0#3;
          |LEE 000#7=;
          |SI #7#30 = "S"; eaIva = "0"; |FINSI; ||Cambia IVA = 0
          |CIERRA #7;

          |BUCLE Tmp;
     |FINSI;

     |DELINDEX #65;
|FPRC;
