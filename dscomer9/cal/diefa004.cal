|FICHEROS;
     diefa004 #0;   || Este def.
     agifa134 #1;   || Facturas(C).
     agifa059 #2;   || Facturas(L).
     agifa024 #3;   || Clientes.
     agifa010 #4;   || Albaranes(C).
     agifa071 #5;   || Albaranes(L).
     agifa091 #6;   || Formas de pago.
     dsz99984 #11;
     agifa104 #12;  || Pedidos(C).
     agifa038 #13;  || Descripcion ampliada.
     agifa025 #14;  || Comisionistas.
     agifa048 #15;  || Escandallos(C).
     agifa049 #16;  || Escandallos(L).
     agifa133 #17;  || fichero de vencimientos de las facturas
     agifa007 #40;  || Series.
     agifa142 #41;  || Parametros generales.
     agi00002 #50;  || Trabajos(C).
     agi00003 #51;  || Trabajos(L).

     agifa023 #60;  || Precios Clientes / Articulos.

     agifm001 #80;  || Zonas Clientes.
     tmp00136 #97;  || Temporal para la impresion en modo columnas.
     agis0002 #98;  || Recibos adelantados.
     agifa177 #99;  || Tipos de Recibos.
     refer71@ #71;
     dsm00053 #53;
     &marhu355@ #100;
     agifa321 #321;
     agifa324 #324;
     agi00101 #1000; ||Lotes
|FIN;

|VARIABLES;
     &enDirEnt      = 0;

     nSw            = 0;
     nSwGuerola     = 0;
     &dtrab         = "";
     &swt           = 0;
     &eaLote        = "";
     &eaProg        = "";
     &Tempo         = "";
     aTempo97       = "";
     &nFactor       = 0;
     &siExis        = 0;
     &aCopia        = "";
     &enSwMarhu     = 0;
     &aDivisa       = "";
     &aMoneda       = "";
     &enSwDes       = 0;
     &enEscan       = 0;
     &enAcuenta     = 0;
     nTota          = 0;
     nTotaFac       = 0;
     suma           = 0;
     nVto           = 0;
     nCam5          = 0;
     nCam7          = 0;
     nCam9          = 0;
     nCam37         = 0;
     nCam39         = 0;
     nCam43         = 0;
     nCam44         = 0;
     nCam48         = 0;
     nUni           = 0;
     aAlfa          = "";
     aArti          = "";
     nPre           = 0;
     nDt1           = 0;
     nDt2           = 0;
     &eaOrdenado    = "";
     &eaImprime     = "";
     &impal =0;
     &impor =0;
     mes = "";
     mesnum = 0;
     &mesimp = "";
     num = 0;
     importe = 0;
     resto = 0;
     i = 0;
     j = 0;
     a = 0;
     saltar = 0;
     indtope = 0;
     ind = 0;
     informe1 = "agifa134";     ||Factura
     informe2 = "agif1134";     ||Factura Resumida
     informe3 = "agif2134";     ||Abono
     informe4 = "agif3134";     ||Abono resumido
     informe  = "";
     &iva1    = 0;
     &iva2    = 0;
     &iva3    = 0;
     &iva4    = 0;
     &iva5    = 0;
     &re1     = 0;
     &re2     = 0;
     &re3     = 0;
     &re4     = 0;
     &re5     = 0;
     &fechae  = @;
     &codigo="";
     &descrip=""
     &precio=0;
     &dto=0;
     &dto1=0;
     &unid=0;
     &imptot=0;
     &tiva=0;
     &linea=0;
     vacio="";
     lafecha = @;
     yaesta  = 1;
     k = 0;
     em = 0;
     num1 = 0;
     fecha = "          ";
     cafe = "";
     diafe = "";
     dianu = "";
     redondeo = 0;
     &f1 = @; &f2 = @; &f3 = @; &f4 = @; &f5 = @; &f6 = @; &f7 = @; &f8 = @;
     &f9 = @; &f10 = @; &f11 = @; &f12 = @;
     &i1 = 0; &i2 = 0; &i3 = 0; &i4 = 0; &i5 = 0; &i6 = 0; &i7 = 0; &i8 = 0;
     &i9 = 0; &i10 = 0; &i11 = 0; &i12 = 0;
     num2 = 0;
     sw1 = 0;
     &bl  = "                              ";
     &ser_fac  = "";
     &num_fac  = 0;
     &reimp    = "N";
     &n_copia   = 0;
     trabajo   = "";
     swcab = 0;
     nlinea = 0;
     &t_linea1 = 0;
     &t_linea2 = 0;
     swimp = 0;
     alfa      = "";
     alfa1     = "";
     alfa2     = "";
     fechaant  = "";
     cliant    = "";
     artant    = "";
     artcant   = "";
     usu       = "";
     fichero   = "";
     n         = 0;
     n1        = 0;
     campo     = 0;
     &swi      = 0;
     &xxx      = "";
     &xx2      = "";
     albaran   = "";
     &t1       = "";
     &t2       = "";
     &t3       = "";
     &t4       = "";
     &t5       = "";
     &t6       = "";
     &t7       = "";
     &t8       = "";
     &t9       = "";
     &t10      = "";
     &tu       = 0;
     &ti       = 0;
/*
     &EURO     = 0;
     &EURODB   = 0;
     &EURODV   = 0;
     &decim_divisa = 0;
*/
|FIN;

||INC-LUYE llena_c1;

|PROCESO LeeLote;
     eaLote = "";
     |ABRE #1000;
     #1000#0 = #5#29;
     #1000#1 = #5#0;
     #1000#8 = #5#1;
     #1000#5 = "";
     |LEE 000#1000];
     |SI #1000#0 = #5#29; |Y #1000#1 = #5#0; |Y #1000#8 = #5#1;
          eaLote = #1000#5;
     |FINSI;
     |CIERRA #1000;
|FPRC;

|PROCESO &leevenci;
     aDivisa = #1#58;
     |HAZ HallaFactor;
     |PDEFECTO #0, 13, 37;
     i1 = 0; i2 = 0; i3 = 0; i4 = 0; i5 = 0; i6 = 0; i7 = 0; i8 = 0;
     i9 = 0; i10 = 0; i11 = 0; i12 = 0;
     sw1 = 0;
     |ABRE #17;
     #17#0 = #1#0;
     #17#4 = #1#49;
     #17#1 = 1;
     |LEE 000#17];
     |PARA; |SI FSalida = 0; |Y #17#0 = #1#0;|Y #17#4 = #1#49; |HACIENDO;
          sw1 = sw1 + 1;
          |SI sw1 = 1;f1 = #17#3;i1 = #17#2;|FINSI;
          |SI sw1 = 2;f2 = #17#3;i2 = #17#2;|FINSI;
          |SI sw1 = 3;f3 = #17#3;i3 = #17#2;|FINSI;
          |SI sw1 = 4;f4 = #17#3;i4 = #17#2;|FINSI;
          |SI sw1 = 5;f5 = #17#3;i5 = #17#2;|FINSI;
          |SI sw1 = 6;f6 = #17#3;i6 = #17#2;|FINSI;
          |SI sw1 = 7;f7 = #17#3;i7 = #17#2;|FINSI;
          |SI sw1 = 8;f8 = #17#3;i8 = #17#2;|FINSI;
          |SI sw1 = 9;f9 = #17#3;i9 = #17#2;|FINSI;
          |SI sw1 = 10;f10 = #17#3;i10 = #17#2;|FINSI;
          |SI sw1 = 11;f11 = #17#3;i11 = #17#2;|FINSI;
          |SI sw1 = 12;f12 = #17#3;i12 = #17#2;|FINSI;

          |SI sw1 = 1;#0#14 = #17#3;#0#13 = #17#2 * nFactor;|FINSI;
          |SI sw1 = 2;#0#16 = #17#3;#0#15 = #17#2 * nFactor;|FINSI;
          |SI sw1 = 3;#0#18 = #17#3;#0#17 = #17#2 * nFactor;|FINSI;
          |SI sw1 = 4;#0#20 = #17#3;#0#19 = #17#2 * nFactor;|FINSI;
          |SI sw1 = 5;#0#22 = #17#3;#0#21 = #17#2 * nFactor;|FINSI;
          |SI sw1 = 6;#0#24 = #17#3;#0#23 = #17#2 * nFactor;|FINSI;
          |SI sw1 = 7;#0#26 = #17#3;#0#25 = #17#2 * nFactor;|FINSI;
          |SI sw1 = 8;#0#28 = #17#3;#0#27 = #17#2 * nFactor;|FINSI;
          |SI sw1 = 9;#0#30 = #17#3;#0#29 = #17#2 * nFactor;|FINSI;
          |SI sw1 =10;#0#32 = #17#3;#0#31 = #17#2 * nFactor;|FINSI;
          |SI sw1 =11;#0#34 = #17#3;#0#33 = #17#2 * nFactor;|FINSI;
          |SI sw1 =12;#0#36 = #17#3;#0#35 = #17#2 * nFactor;|FINSI;
          |LEE 000#17s;
     |SIGUE;
     nTota = #0#13+#0#15+#0#17+#0#19+#0#21+#0#23+#0#25+#0#27+#0#29+#0#31+#0#33+#0#35;
     nTotaFac = #1#101; ||| - #1#32;
     |SI nTota ! nTotaFac;
          |SI #321#9 ! aDivisa;
               nTota = nTota - #1#101;
               sw1 = (sw1 * 2) + 11;
               #0sw1 = #0sw1 - nTota;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO meses;
     mes = #1#1 % 402; mesnum = mes;
     |SI mesnum =  1;  mesimp = "Enero     ";  |FINSI;
     |SI mesnum =  2;  mesimp = "Febrero   ";  |FINSI;
     |SI mesnum =  3;  mesimp = "Marzo     ";  |FINSI;
     |SI mesnum =  4;  mesimp = "Abril     ";  |FINSI;
     |SI mesnum =  5;  mesimp = "Mayo      ";  |FINSI;
     |SI mesnum =  6;  mesimp = "Junio     ";  |FINSI;
     |SI mesnum =  7;  mesimp = "Julio     ";  |FINSI;
     |SI mesnum =  8;  mesimp = "Agosto    ";  |FINSI;
     |SI mesnum =  9;  mesimp = "Septiembre";  |FINSI;
     |SI mesnum = 10;  mesimp = "Octubre   ";  |FINSI;
     |SI mesnum = 11;  mesimp = "Noviembre ";  |FINSI;
     |SI mesnum = 12;  mesimp = "Diciembre ";  |FINSI;
|FPRC;

|PROCESO imprime;
     || PEPE
     #agifa071#29 = #97#0;
     #agifa071#0  = #97#1;
     #agifa071#1  = #97#2;
     |LEE 000#agifa071.=;
     unid = #agifa071#5;
     |PRINT; swi = 0;
|FPRC;

|DEFBUCLE lc3;   || ARTICULO,CLIENTE,FECHA.
     #97#1;
     ;
     "                    ";
     "zzzzzzzzzzzzzzzzzzzz";
     ;
     NULL,imprime;
|FIN;

|PROCESO terminaciones;
     || COGE LA TERMINACION DEL ARTICULO.....................................
     n = ((#41#44 + 1) * 100) + 13;
     n1 = #41#44 + 100;
     alfa = #5#2;
     alfa = alfa % n;
     |QBF alfa;
     |HAZ titulos;
     || RELLENA EL TEMPORAL PARA EL INFORME POR TERMINACIONES................
     campo = ind + 5;
     #97#4 = #5#2;      || ARTICULO.
     |LEE 101#97=;
     |SI FSalida = 0;
          #97campo = #97campo + #5#5;
          #97#17 = #97#17 + #5#5;
/*
          #97#17 = #97#6 + #97#7 + #97#8 + #97#9 + #97#10 + #97#11 + #97#12;
          #97#17 = #97#17 + #97#13 + #97#14 + #97#15;  || TOTAL UNIDADES.
*/
          #97#18 = #97#18 + #5#9;       || TOTAL IMPORTE.
          #97#19 = #5#8;                || DTO1.LINEA.
          |GRABA 021#97a;
     |SINO;
          |DDEFECTO #97;
          #97#0  = #5#29;
          #97#1  = #5#0;
          #97#2  = #5#1;
          #97#16 = #5#2;                || COD.ARTICULO COMPLETO.
          #97#4 = #5#2;                 || ARTICULO.
/*
          #97campo = #5#5;              || UNIDADES.
          #97#17 = #97#6 + #97#7 + #97#8 + #97#9 + #97#10 + #97#11 + #97#12;
          #97#17 = #97#17 + #97#13 + #97#14 + #97#15;  || TOTAL UNIDADES.
*/
          #97#17 = #5#5;
          #97#18 = #5#9;                || TOTAL IMPORTE.
          #97#19 = #5#8;                || DTO1.LINEA.
          #97#20 = #5#6;                || PRECIO.
          |GRABA 021#97n;
     |FINSI;
|FPRC;

|DEFBUCLE leealb;
     #5#1;
     ;
     #2#15,#2#2,001;
     #2#15,#2#2,999;
     ;
     NULL,terminaciones;
|FIN;

|PROCESO columnas;
     swi = 1;
     |HAZ CreaTempo; aTempo97 = Tempo;
     |NOME_DAT #97 aTempo97; |DELINDEX #97;

     |ABRE #97;
     |BUCLE leealb;
     |BUCLE lc3;
     |CIERRA #97;

     |DELINDEX #97; Tempo = aTempo97; |HAZ BoraTempo;
|FPRC;

|PROCESO ultimo;
     nlinea  = #51#1;
|FPRC;

|PROCESO i_trabajo;
     swimp = 1;
     |SI nlinea  = #51#1;t_linea2 = #4#15;|FINSI;
     dtrab = #51#2;
     swt = 1;
     |PRINT;
     swt = 0;
|FPRC;

|PROCESO imp_trabajos;
     nlinea = 0;
     t_linea1 = 0;
     t_linea2 = 0;
     |ABRE #50;
     |SELECT #4#50;
     #50#2 = #2#15;
     #50#3 = #2#2;
     |LEE 001#50=;
     |SI FSalida = 0;
         |BUCLELIN 2ultimo#50;
     |FINSI;
     |SELECT #1#50;
     |CIERRA #50;

     |ABRE #50;
     |SELECT #4#50;
     #50#2 = #2#15;
     #50#3 = #2#2;
     |LEE 001#50=;
     |SI FSalida = 0;
         |BUCLELIN 2i_trabajo#50;
     |FINSI;
     |SELECT #1#50;
     |CIERRA #50;
|FPRC;

|CALCULO escanlinea;
    unid = #16#4 * #5#5;
    descrip = #16#3;
    codigo = "";
    dto = 0;
    precio = 0;
    imptot = 0;
    tiva = 0;
    linea = 1;
    enEscan = 1;
    |PRINT;
    enEscan = 0;
|FCAL;

|CALCULO xx;
     indtope = 0
     |PARA ind=6;|SI ind>0;|HACIENDO ind=ind-1;
          descrip=#13ind;
          |QBF descrip;
          |SI descrip ! vacio;
               indtope=ind+1;
               ind=0
          |FINSI;
     |SIGUE;
     |PARA ind = 1; |SI ind < indtope; |HACIENDO ind = ind + 1;
           descrip = #13ind;
           linea=0;
           |PRINT;
     |SIGUE;
|FCAL;

|CALCULO impdesam;
     #13#0 = #5#27;
     |ABRE #13;
     |LEE 101#13=;
     |SI FSalida = 0; |HAZ xx; |FINSI;
     |LIBERA #13;
     |CIERRA #13;
|FCAL;

|PROCESO hazreci;
     |ABRE #17;
     |ABRE #98;
     |ABRE #99;

     nVto = 0;
     #17#0 = #1#0;
     #17#4 = #1#49;
     #17#1 = 0;
     |LEE 000#17];
     |PARA ; |SI FSalida = 0; |Y #17#0 = #1#0;|Y #17#4 = #1#49; |HACIENDO;
          nVto = nVto + 1;
          |LEE 000#17s;
     |SIGUE;

     |HAZ AbreRecVenta;

     #17#0 = #1#0;
     #17#4 = #1#49;
     #17#1 = 0;
     |LEE 000#17];
     |PARA ; |SI FSalida = 0; |Y #17#0 = #1#0;|Y #17#4 = #1#49; |HACIENDO;
          |SI #17#5 = "S";
               |DDEFECTO #98;
               #98#30 = "A";       || busca como albaran
               #98#20 = #17#6;     || Serie pedido.
               #98#17 = #17#7;     || Numero pedido.
               #98#18 = #17#8;     || Numero recibo.
               |LEE 000#98=;
               |SI FSalida ! 0;
                    #98#30 = "P";       || busca como pedido
                    |LEE 000#98=;
               |FINSI;
          |FINSI;
          |DDEFECTO #11;
          #11#17 = #1#49;
          #11#0 = #1#0;
          #11#1 = #17#1;           || Linea;
          #11#2 = #1#2;            || cliente
          #11#3 = #1#3;            || nombre del cliente
          #11#4 = #1#9;            || Banco
          #11#5 = "S";             || domiciliado
          #11#6 = "N";             || aceptado
          #11#7 = #1#1;            || fecha de emision
          #11#8 = #17#3;           || Fecha de vencimiento
          #11#9 = #17#2;           || Importe
          |SI #17#5 = "S";
               #11#10 = #98#10;
               #11#11 = #98#11;
          |SINO;
               #11#10 = "N";            || Impreso
               #11#11 = "N";            || Contabilizado
          |FINSI;
          |SI #41#63 = "S";     ||  COGE LA CTA.CONTABLE DEL TIPO DE RECIBO.
               #99#0 = #6#69;
               |LEE 000#99=;
               |SI FSalida = 0;
                    #11#12 = #99#3;     || NUMERO CTA.CONTABLE.
               |SINO;
                    #11#12 = #1#12;     || NUMERO CTA.CONTABLE.
               |FINSI;
          |SINO;
               #11#12 = #1#12;     || NUMERO CTA.CONTABLE.
          |FINSI;
          #11#13 = #98#13;
          #11#16 = #98#16;
          #11#22 = "Cobrado";
          #11#24 = #1#11;          || Forma de Pago
          #11#25 = #6#1;           || Descripcion de la forma de Pago
          #11#14 = "N";            || Impagado
          #11#15 = #3#161;         || A aceptar
          |SI #17#5 = "S";
               #11#21 = #98#22;         || Tipo de Recibo (entr.a cta.)
          |SINO;
               #11#21 = #6#69;          || Tipo de Recibo (forma de pago)
          |FINSI;
          #11#23 = nVto;
          #11#24 = #6#0;
          #11#25 = #6#1;
          eaProg = "agifa134";
          ||HAZ CreaRecVenta;
          |HAZ RecVenta;
          |LEE 000#17s;
     |SIGUE;
     |HAZ CierraRecVenta;

     #17#0 = #1#0;
     #17#4 = #1#49;
     #17#1 = 0;
     |LEE 101#17];
     |PARA ; |SI FSalida = 0; |Y #17#0 = #1#0;|Y #17#4 = #1#49; |HACIENDO;
          #11#17 = #17#4;
          #11#0 = #17#0;
          #11#1 = #17#1;
          eaProg = "agifa134";
          |HAZ LeeRecVenta;
          #1#32 = #1#32 + enAcuenta;
          #17#2 = #17#2 - enAcuenta;
          |GRABA 020#17a;
          |LIBERA #17;
          |LEE 101#17s;
     |SIGUE;
     |LIBERA #17;

     |CIERRA #11;
     |CIERRA #17;
     |CIERRA #98;
     |CIERRA #99;
|FPRC;

|PROCESO miralinea;
     #4#0  = #2#2;
     #4#52 = #2#15;
     |LEE 000#4=;
     |ERROR;
     enDirEnt = #agifa010#84;
|FPRC;

|PROCESO mirainf;
     |BUCLELIN 0miralinea#1;

     |SI nSwGuerola = 0;|Y #0#41 ! "        ";
          informe = #0#41; |QBF informe;
          |ACABA;
     |FINSI;

     |ABRE #40;
     #40#26 = #1#49;
     |LEE 001#40=;
     |SI FSalida = 0;
          |SI #4#43 = "N";    ||No es abono
               |SI #3#42 = AS;
                   informe = #40#9;
               |SINO;
                   informe = #40#8;
               |FINSI;
          |SINO;
               |SI #3#42 = AS;
                   informe = #40#18;
               |SINO;
                   informe = #40#17;
               |FINSI;
          |FINSI;
     |SINO;
          |SI #4#43 = "N";    ||No es abono
               |SI #3#42 = AS;
                   informe = informe2;
               |SINO;
                   informe = informe1;
               |FINSI;
          |SINO;
               |SI #3#42 = AS;
                   informe = informe4;
               |SINO;
                   informe = informe3;
               |FINSI;
          |FINSI;
     |FINSI;
     |CIERRA #40;
     |QBF informe;

|FPRC;


________/ R.AGUERA 15-06-98 __/ IMPRIMIR FACTURA EN MODO COLUMNAS.
________/ CODIGO ARTICULO = LONGITUD INICIAL ARTICULO (PARAMETROS GENERALES).
________/ CODIGO COLUMNAS = RESTO CODIGO ARTICULO.

__________________________________/ RELLENA LOS TITULOS DE LAS TERMINACIONES.
|PROCESO titulos;
|| R.AGUERA 18-08-98 CON ESTA RUTINA ORDENA LOS COLORES DEL 01 AL 10, Y ESTAN
||                   OBLIGADAS LAS TERMINACIONES A SER 01,02,03... 10.

|| NO PODIA SER OTRO PARA ESTA       P O R Q U E R I A
     ind = 0;
     |SI alfa = "01";
          t1 = alfa;
          ind = 1;
     |SINO;
          |SI alfa = "02";
               t2 = alfa;
               ind = 2;
          |SINO;
               |SI alfa = "03";
                    t3 = alfa;
                    ind = 3;
               |SINO;
                    |SI alfa = "04";
                         t4 = alfa;
                         ind = 4;
                    |SINO;
                         |SI alfa = "05";
                              t5 = alfa;
                              ind = 5;
                         |SINO;
                              |SI alfa = "06";
                                   t6 = alfa;
                                   ind = 6;
                              |SINO;
                                   |SI alfa = "07";
                                        t7 = alfa;
                                        ind = 7;
                                   |SINO;
                                        |SI alfa = "08";
                                             t8 = alfa;
                                             ind = 8;
                                        |SINO;
                                             |SI alfa = "09";
                                                  t9 = alfa;
                                                  ind = 9;
                                             |SINO;
                                                  |SI alfa = "10";
                                                       t10 = alfa;
                                                       ind = 10;
                                                  |FINSI;
                                             |FINSI;
                                        |FINSI;
                                   |FINSI;
                              |FINSI;
                         |FINSI;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|CALCULO facimpr2;
     |SI #1#45 = AN;
          |SI #41#146 ! "N"; |O #1#101 ! 0;
               |HAZ hazreci;
          |FINSI;
          #1#45 = AS;
          |BORRA 020#1a;
          |GRABA 020#1n;
     |FINSI;
     |PIEINF;
     impor = 0;
     impal = 0;
|FCAL;

|PROCESO dsm00053;
     enSwDes = 1;
     |PRINT;
     enSwDes = 0;
|FPRC;

|DEFBUCLE dsm00053;
     #53#1;
     ;
     "A", #5#29, #5#0, #5#1, 0001;
     "A", #5#29, #5#0, #5#1, 9999;
     ;
     NULL, dsm00053;
|FIN;

|CALCULO imprelin;
     |SI #5#5 = 0; |Y #0#38 = "N"; |ACABA; |FINSI;
     |SI #5#36 = 0; |Y #0#39 = "N"; |ACABA; |FINSI;

     #12#0  = #5#12;
     #12#25 = #5#31;
     |LEE 041#12=;
     codigo  = #5#2;
     descrip = #5#4;
     |SI codigo = "9999999999999";||Puesto para Ciagan;
         impal = impal + #5#9;
         codigo = "";
     |FINSI;
     |SI codigo = "9999999999998";
         impor = impor + #5#9;
         codigo = "";
     |FINSI;

     descrip = #5#4;
     dto    = #5#8;
     dto1   = #5#33;
     precio = #5#6;
     unid   = #5#5;
     imptot = #5#9;
     tiva   = #5#11;
     linea  = 1
     |SI #41#70 = "S";
          |SI albaran ! #2#2;
               albaran = #2#2;
               |HAZ columnas;
          |FINSI;
     |SINO;
          |PRINT;
          |BUCLE dsm00053;
     |FINSI;
     || Aqui pone como impresa la factura en el albaran;
     |SI swcab = 0;
          #4#10 = "S";
          |GRABA 020#4a;
          |LIBERA #4;
          swcab = 1;
     |FINSI;
     |HAZ impdesam;
     |SI #41#16 = "S";
          |ABRE #15;
          #15#0 = #5#2;
          |LEE 040#15=;
               |SI FSalida = 0;
                    |BUCLELIN 0 escanlinea #15;
               |FINSI;
          |CIERRA #15;
     |FINSI;
|FCAL;

|PROCESO ImpreLinAgr;
     |SALVA_DATOS #refer71@;
     |REPON_DATOS #5;
     |HAZ imprelin;
     |DDEFECTO  #refer71@;
|FPRC;

|PROCESO AgrupaArti;
     |SI aArti = "";
          aArti = #5#2; nDt1 = #5#8; nDt2 = #5#33; nPre = #5#6;
     |FINSI;
     |SI aArti ! #5#2; |O nDt1 ! #5#8; |O nDt2 ! #5#33; |O nPre ! #5#6;
          aArti = #5#2;
          nDt1 = #5#8;
          nDt2 = #5#33;
          nPre = #5#6;
          |SALVA_DATOS #5;
          |HAZ ImpreLinAgr;
          |REPON_DATOS #5;
     |FINSI;
     nCam5 = #refer71@#5;
     nCam7 = #refer71@#7;
     nCam9 = #refer71@#9;
     nCam37 = #refer71@#37;
     nCam39 = #refer71@#39;
     nCam43 = #refer71@#43;
     nCam44 = #refer71@#44;
     nCam48 = #refer71@#48;
     |SALVA_DATOS #5;
     |REPON_DATOS #refer71@;
     #refer71@#5 = #refer71@#5 + nCam5;
     #refer71@#7 = #refer71@#7 + nCam7;
     #refer71@#9 = #refer71@#9 + nCam9;
     #refer71@#37 = #refer71@#37 + nCam37;
     #refer71@#39 = #refer71@#39 + nCam39;
     #refer71@#43 = #refer71@#43 + nCam43;
     #refer71@#44 = #refer71@#44 + nCam44;
     #refer71@#48 = #refer71@#48 + nCam48;
|FPRC;

|DEFBUCLE AgrupaArti;
     #5#1;
     ;
     #4#52, #4#0, 001;
     #4#52, #4#0, 999;
     ;
     NULL, NULL, NULL, NULL, NULL, AgrupaArti;
     #5#2, #5#8, #5#33;
|FIN;

|PROCESO Marhuenda;
     #5#29 = #100#0;
     #5#0 = #100#1;
     #5#1 = #100#2;
     |LEE 020#5=;

     |ABRE #60;
     |DDEFECTO #60;
     #60#0 = #1#3; ||Cod.Cliente.
     #60#1 = #5#2; ||Cod.Articulo.
     |LEE 000#60=;
     |SI FSalida = 0;
          siExis = 1;
     |SINO;
          siExis = 0;
     |FINSI;
     |CIERRA #60;

     |HAZ imprelin;
|FPRC;

|DEFBUCLE Marhuenda;
     #100#2004;
     ;
     "          ", #4#52, #4#0, 001;
     "zzzzzzzzzz", #4#52, #4#0, 999;
     ;
     NULL, Marhuenda;
|FIN;

|CALCULO facimprl;|TIPO 0;
     aDivisa = #agifa010#68;
     aMoneda = #agifa010#70;
     |HAZ Divisas010;

     |HAZ meses;
     |ABRE #12;
     #4#0 = #2#2;
     #4#52= #2#15;
     swcab = 0;
     |LEE 040#4=;
     |SI 0 ! FSalida;
          |DDEFECTO #4;
     |SINO;
          |SI #3#42 = AS;
               |SI trabajo = "S";
                    swimp = 0;
                    |HAZ imp_trabajos;
                    |SI swimp = 0;
                         t_linea1 = #4#15;
                         |PRINT;
                    |FINSI;
               |SINO;
                    |PRINT;
               |FINSI;
          |SINO;
               |SI #41#142 = "S";
                    |DDEFECTO #refer71@;
                    aArti = "";
                    |BUCLE AgrupaArti;
                    |HAZ ImpreLinAgr;
               |SINO;
                    |SI enSwMarhu = 0;
                         |ABRE #5;
                         |BUCLE Marhuenda;
                         |CIERRA #5;
                    |SINO;
                         |BUCLELIN 2 imprelin #4;
                    |FINSI;
               |FINSI;
               |SI trabajo = "S";
                    |HAZ imp_trabajos;
               |FINSI;
          |FINSI;
     |FINSI;
     |CIERRA #12;
|FCAL;

|DEFBUCLE facimprl_2;
     #2#1;
     15,2;
     #1#49,#1#0,001,"     ",000001;
     #1#49,#1#0,999,"zzzzz",999999;
     ;
     NULL, NULL, NULL, NULL, NULL, facimprl;
     #2#15,#2#2;
|FIN;

|PROCESO MiraAlba;
     #4#52 = #2#15;
     #4#0 = #2#2;
     |LEE 020#4=;
     |SI FSalida ! 0; |ACABA; |FINSI;
     |SI #4#88 < #0#44; |O #4#88 > #0#45; |ACABA; |FINSI; ||Agencia
     nSw = 1;
|FPRC;

|CALCULO agifa134;
     |DDEFECTO #3;
     #3#0 = #1#2;
     |LEE 020#3=;
     |SI #3#189 < #0#42; |O #3#189 > #0#43; |ACABA; |FINSI; ||Ruta

     nSw = 0;
     |BUCLELIN 0 MiraAlba #1;
     |SI nSw = 0; |ACABA; |FINSI;
/*
     EURODB = decim_divisa;
     |SI EURODB = 2;
          EURO = 166.386;
          EURODV = 0;
     |SINO;
          EURO = 1 / 166.386;
          EURODV = 2;
     |FINSI;
*/
     #0#40 = #agifa134#101;   || para poder imprimir el importe en letras

     |SI #3#0 ! #1#2;
          #3#0 = #1#2;
          |LEE 041#3=;
          |SI 0 ! FSalida;|DDEFECTO #3;|FINSI;
          |DDEFECTO #80;
          |ABRE #80;
          #80#0 = #3#3; ||Zona Cliente.
          |LEE 000#80=;
          |CIERRA #80;
     |FINSI;
     |ABRE #13;
     |DDEFECTO #13;
     #13#0 = #1#7;
     |LEE 000#13=;
     |CIERRA #13;
     |HAZ mirainf;
     iva1 = #1#39; re1 = #1#40;
     iva2 = #1#41; re2 = #1#42;
     iva3 = #1#43; re3 = #1#44;
     iva4 = #1#50; re4 = #1#51;
     iva5 = #1#52; re5 = #1#53;
     |INFOR informe;
     |SI FSalida ! 0;
          aAlfa = "0000NO existe informe [" + informe + "]";
          |MENAV aAlfa;
          |SI nSwGuerola = 0;
               |ERROR10;
          |FINSI;
     |SINO;
          aCopia = "";
          |SI #6#0 ! #1#11;
               |ABRE #6;
               #6#0 = #1#11;
               |LEE 021#6=;
               |SI 0 ! FSalida;|DDEFECTO #6;|FINSI;
               |CIERRA #6;
          |FINSI;
          |HAZ OrdenaMarhu;
          |SI eaOrdenado = "N";
               |BUCLELIN 0 facimprl #1;
          |SINO;
               |BUCLE facimprl_2;
          |FINSI;
          aMoneda = #agifa134#60;
          aDivisa = #agifa134#58;
          |HAZ Divisas134;
          |HAZ facimpr2;
          |PARA n_copia = 0; |SI n_copia < #3#44; |HACIENDO n_copia = n_copia + 1;
               suma = n_copia + 1;
               aCopia = "COPIA: " + suma;
               |SI eaOrdenado = "N";
                    |BUCLELIN 0 facimprl #1;
               |SINO;
                    |BUCLE facimprl_2;
               |FINSI;
               |PIEINF;
               aMoneda = #agifa134#60;
               aDivisa = #agifa134#58;
               |HAZ Divisas134;
               impal =0;
               impor =0;
          |SIGUE;
          |FININF;
     |FINSI;
|FCAL;

|DEFBUCLE agifa134;
     #1#1;
     2,1,45,31;
     #0#9, #0#2 , #0#0 , #0#4 , #0#6 ,  #0#7;
     #0#10,#0#3 , #0#1 , #0#5 , #0#6 ,  #0#8;
     be;
     NULL, agifa134;
|FIN;

|DEFBUCLE agifa134_1;
     #1#1;
     45;
     #0#9, #0#2 , reimp;
     #0#10,#0#3 , reimp;
     be;
     NULL, agifa134;
|FIN;

|PROGRAMA;
     |HAZ IniMarhu;
     nSwGuerola = 1;

     |DDEF aAlfa;
     aAlfa = aAlfa + "agifa071";
     |CARGA_DEF aAlfa, refer71@;
     |SI aAlfa ! 0;
          |HAZ FinMarhu;
          aAlfa = "0000No puedo cargar " + aAlfa;
          |MENAV aAlfa; |ACABA;
     |FINSI;

     |ABRE #41; |LEE 000#41p; |CIERRA #41;

     trabajo = #41#132;

     |SI ser_fac = ""; |Y num_fac = 0;
          #0#11 = #41#141;
          |CLS;
          |CABEZA "Imp.Facturas";
          |DDEFECTO #0;
          |PINPA #0#0;
          |SI nSwGuerola = 0;
               |C_V #0#41, 1, "S";
               |PINTA 2216, "Informe para impresion......................";
          |FINSI;
          |PINDA #0#0;
          |ENDATOS #1#0;
          eaOrdenado = #0#11;
     |SINO;
          #0#9 = ser_fac;
          #0#10 = ser_fac;
          #0#2 = num_fac;
          #0#3 = num_fac;
          #0#6 = reimp;
          FSalida = 0;
     |FINSI;
     |SI FSalida = 0;
          |ABRE #5;
          |ABRE #4;
          |ABRE #3;
          |SI eaImprime ! "";
               Impresora = eaImprime;
               |IMPRE -1;
          |SINO;
               |IMPRE 2;
          |FINSI;
          |SI 0 = FSalida;
               |SI ser_fac = ""; |Y num_fac = 0;
                    |BUCLE agifa134;
               |SINO;
                    |BUCLE agifa134_1;
               |FINSI;
               |FINIMP;
          |FINSI;
          |CIERRA #3;
          |CIERRA #4;
          |CIERRA #5;
     |FINSI;

     |DESCARGA_DEF #refer71@;

     |HAZ FinMarhu;
|FPRO;
