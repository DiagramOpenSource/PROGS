     || Creacion Pedidos y Albaranes

|FICHEROS;
     bogem003 #3,MANTE;
     bogem007 #7,MANTE;
     bogew016 #16;       || Tmp Impresion Alb vta
     bogem020 #20,MANTE;
     bogem021 #21;
     bogem023 #23,MANTE;
     bogem024 #24,MANTE;
     bogem025 #25,MANTE;
     bogem026 #26,MANTE;
     bogem027 #27,MANTE;
     bogem028 #28,MANTE;

     agifa010 #10;
     agifa019 #19;
     agifa041 #41;
     agifa067 #67;
     agifa071 #71;
     agifa073 #73;
     agifa077 #77;
     agifa080 #80;
     agifa081 #81;
     agifa104 #104;
     agifa112 #112;
     agifa024 #124;
     agifa025 #125;
     agifa142 #142;
     agifa219 #219;
     agifa220 #220;
     agifa321 #321;
     agifa324 #324;
     agifa007 #107;
     dsm00081 #1081;
     dsm00082 #1082;
|FIN;

|VARIABLES;
 {-1}aMenuImpPedCom = "";
     aMenuImpPedCom1 = "2400";
     aMenuImpPedCom2 = "1";
     aMenuImpPedCom3 = "Impresion:";
     aMenuImpPedCom4 = "PEL";
     aMenuImpPedCom5 = " Pedido ";
     aMenuImpPedCom6 = " Etiquetas ";
     aMenuImpPedCom7 = " Packing List ";
     i = 0;
     &enEtiqueta = 0;
     &eaEsLote = "";
     &Tempo = "";
     aInforme = "";
     aInfPedCom = "bpedicom";
     aInfPedVta = "bpedivta";
     &enHayAmpli = 0;

     &enCoste = 0;
     &eaProgVta = "";
     &enUnidPend = 0;
     &eaBorCab = "";
     &eaNueva = "";
     &eaDefImpre = "";
     &ser_alb = "";
     &num_alb = 0;
     abono = "";
     &ser_ped = "";
     &num_ped = 0;
     &eaMovimi = "";
     &enCodigo = 0;
     &eaSerie = "";
     &enLinea = 0;
     &eaCliente = "";
     &enImpCliPed = 0;

     &enForma = 0;
     &eaDocu = "";
     &enImpPrvPed = 0;
     &efFecha = @;
     &eaProve = "";
     &enSwMenu = 0;
     &aDivisa = "";
     &aMoneda = "";
     nLinea = 0;
     nSubLinea = 0;
     aAlfa = "";
     nNume = 0;
     nImpo = 0;
     aDirEmp = "";
     aDatos = "";
     nCodEmp = 0;
|FIN;
------------------------------------------------Pedido Compras
|PROCESO dsm00082;
     #23#3 = "";
     #23#4 = #1082#2;
     #23#5 = 0;

     enHayAmpli = 1;
     |PRINT;
     enHayAmpli = 0;
|FPRC;

|DEFBUCLE dsm00082;
     #1082#1;
     ;
     #1081#0, 000;
     #1081#0, 999;
     ;
     NULL, dsm00082;
|FIN;

|PROCESO EtiqPack;
     |PARA i = 1; |SI i [ #23#9; |HACIENDO i = i + 1;
          enEtiqueta = i;
          |PRINT;
          |PIEINF;
     |SIGUE;
|FPRC;

|DEFBUCLE EtiqPack;
     #23#1;
     ;
     #3#0, #3#18, 001;
     #3#0, #3#18, 999;
     ;
     NULL, EtiqPack;
|FIN;

|PROCESO ImpPedComLin;
     |PRINT;

     #1081#0 = #23#3;
     |LEE 000#1081=;
     |SI FSalida = 0; |Y #1081#2 = "S";
          |BUCLE dsm00082
     |FINSI;

     |SI #23#8 ! 0; || montamos sobre el articulo anterior para simplificar
          #23#3 = #23#10;
          #23#4 = #23#12;
          #23#5 = #23#8;
          #23#6 = #23#20;
          #23#7 = 0;
          |PRINT;
     |FINSI;
     |SI #23#9 ! 0;
          #23#3 = #23#11;
          #23#4 = #23#13;
          #23#5 = #23#9;
          #23#6 = #23#21;
          #23#7 = 0;
          |PRINT;
     |FINSI;
|FPRC;

|DEFBUCLE ImpPedComLin;
     #23#1;
     ;
     #3#0, #3#18, 001;
     #3#0, #3#18, 999;
     ;
     NULL, ImpPedComLin;
|FIN;

|PROCESO ImpPedCom;
     |DDEFECTO #112;
     |ABRE #112;
     #112#0 = #3#2;
     |LEE 000#112=;
     |CIERRA #112;
  |ET ImpPed;
     Impresora = "Crystal Reports";
     |MENU aMenuImpPedCom;
     |SI FSalida = 1;         || pedido
          |IMPRE 0;
          |SI FSalida = 0;
               |INFOR aInfPedCom;
               |SI FSalida ! 0;
                    aAlfa = "0000Error en informe:" + aInfPedCom;
                    |MENAV aAlfa;
               |SINO;
                    |ABRE #1081;
                    |BUCLE ImpPedComLin;
                    |CIERRA #1081;
                    |PIEINF;
                    |FININF;
               |FINSI;
               |FINIMP;
          |FINSI;
          |VETE ImpPed;
     |FINSI;
     |SI FSalida = 2;    || Etiquetas
          |IMPRE 0;
          |SI FSalida = 0;
               |INFOR "bpedieti";
               |SI FSalida = 0;
                    |BUCLE EtiqPack;
                    |FININF;
               |SINO;
                    |MENAV "0000Error en informe 'bpedieti'";
               |FINSI;
               |FINIMP;
          |FINSI;
          |VETE ImpPed;
     |FINSI;
     |SI FSalida = 3;    || Packing list
          |IMPRE 0;
          |SI FSalida = 0;
               |INFOR "bpedipac";
               |SI FSalida = 0;
                    |BUCLE EtiqPack;
                    |FININF;
               |SINO;
                    |MENAV "0000Error en informe 'bpedipac'";
               |FINSI;
               |FINIMP;
          |FINSI;
          |VETE ImpPed;
     |FINSI;
|FPRC;

|PROCESO BorraPedComLin;
     eaDocu = "agifa067";
     |HAZ StockEntra;
     |BORRA 020#67a;
     |HAZ AcuProveedor;
|FPRC;

|PROCESO BorraPedCom;
     enForma = -1;
     |ABRE #81;
     |ABRE #67;
     #81#25 = #3#19;
     #81#0 = #3#20;
     |LEE 101#81=;
     |SI FSalida = 0;
          |BUCLELIN 2 BorraPedComLin #81;
          |SI eaBorCab = "S";
               |BORRA 020#81a;
          |FINSI;
     |FINSI;
     |CIERRA #67;
     |CIERRA #81;
|FPRC;

|RUTINA AcuProveedor;
     |ABRE #19;
     #19#0 = #67#2;
     |LEE 020#19=;
     |CIERRA #19;

     aAlfa= #81#1 % A402;
     nNume = aAlfa + 42;
     |SI #19#196 = 2;
          nImpo = (((((#67#41 * #67#6) < #67#8) < #67#27) < #67#57) < #81#5) < #81#17;
     |SINO;
          nImpo = (((((#67#5 * #67#6) < #67#8) < #67#27) < #67#57) < #81#5) < #81#17;
     |FINSI;
     |SI #142#114 = "S";
          nImpo = nImpo < #81#6;
     |FINSI;

     |DDEFECTO #112;
     |ABRE #112;
     #112#0 = #81#4;
     |LEE 101#112=;
     |SI FSalida ! 0; |GRABA 020#112b; |FINSI;
     |SI FSalida = 0;
          #112nNume = #112nNume + (nImpo * enForma);
          #112#55 = #112#55 + (nImpo * enForma);
          |GRABA 020#112a;

          enImpPrvPed = nImpo * enForma;
          efFecha = #81#1;
          eaProve = #81#4;
          |HAZ AcumulaPrv;
     |FINSI;
     |CIERRA #112;
|FRUT;

|PROCESO CreaPedComLin;
     |DDEFECTO #19;
     |ABRE #19;
     #19#0 = #23#3;
     |LEE 000#19=;
     |CIERRA #19;

     nLinea = #23#1 * 3 - 2; || multiplo de 3
     |DDEFECTO #67;
     #67#28 = #81#25;
     #67#0 = #81#0;
     #67#1 = nLinea;
     #67#2 = #19#0;
     #67#3 = 1;
     #67#4 = #23#4;
     #67#5 = #23#5;
     #67#6 = #23#6;
     #67#13 = #81#2;
     #67#14 = #19#30;
     #67#18 = #19#2;
     #67#20 = #81#4;
     #67#23 = #81#5;
     #67#24 = #81#6;
     #67#25 = #81#17;
     #67#26 = #81#9;
     #67#35 = #67#6;

     #67#33 = #67#6;
     #67#37 = #67#5;
     |GRABA 020#67n;

     eaDocu = "agifa067";
     |HAZ StockEntra;
     |HAZ AcuProveedor;

     |SI #23#8 ! 0;      || Cajas
          |DDEFECTO #19;
          |ABRE #19;
          #19#0 = #23#10;
          |LEE 000#19=;
          |CIERRA #19;

          nSubLinea = nLinea + 1;
          |DDEFECTO #67;
          #67#28 = #81#25;
          #67#0 = #81#0;
          #67#1 = nSubLinea;
          #67#2 = #19#0;
          #67#3 = 1;
          #67#4 = #23#12;
          #67#5 = #23#8;
          #67#6 = #23#20;
          #67#13 = #81#2;
          #67#14 = #19#30;
          #67#18 = #19#2;
          #67#20 = #81#4;
          #67#23 = #81#5;
          #67#24 = #81#6;
          #67#25 = #81#17;
          #67#26 = #81#9;
          #67#35 = #67#6;

          #67#33 = #67#6;
          #67#37 = #67#5;
          |GRABA 020#67n;

          eaDocu = "agifa067";
          |HAZ StockEntra;
          |HAZ AcuProveedor;
     |FINSI;

     |SI #23#9 ! 0;      || Cajas
          |DDEFECTO #19;
          |ABRE #19;
          #19#0 = #23#11;
          |LEE 000#19=;
          |CIERRA #19;

          nSubLinea = nLinea + 2;
          |DDEFECTO #67;
          #67#28 = #81#25;
          #67#0 = #81#0;
          #67#1 = nSubLinea;
          #67#2 = #19#0;
          #67#3 = 1;
          #67#4 = #23#13;
          #67#5 = #23#9;
          #67#6 = #23#21;
          #67#13 = #81#2;
          #67#14 = #19#30;
          #67#18 = #19#2;
          #67#20 = #81#4;
          #67#23 = #81#5;
          #67#24 = #81#6;
          #67#25 = #81#17;
          #67#26 = #81#9;
          #67#35 = #67#6;
          #67#33 = #67#6;
          #67#37 = #67#5;
          |GRABA 020#67n;

          eaDocu = "agifa067";
          |HAZ StockEntra;
          |HAZ AcuProveedor;
     |FINSI;
|FPRC;

|DEFBUCLE CreaPedComLin;
     #23#1;
     ;
     #3#0, #3#18, 001;
     #3#0, #3#18, 999;
     ;
     NULL, CreaPedComLin;
|FIN;

|PROCESO CreaPedCom;
     enForma = 1;
     |DDEFECTO #81;
     |ABRE #81;
     |ABRE #67;
     #81#25 = #3#19;
     #81#0 = #3#20;
     |SI eaNueva = "S";
          enSwMenu = 1;
          |HAZ ContaPC7;
          |GRABA 000#81b;
          |PARA; |SI FSalida ! 0; |HACIENDO;
               #81#0 = #81#0 + 1;
               |GRABA 000#81b;
          |SIGUE;
     |SINO;
          |LEE 101#81=;
          |SI FSalida ! 0; |GRABA 020#81b; |FINSI;
     |FINSI;
     |SI FSalida = 0;
          |DDEFECTO #112;
          |ABRE #112;
          #112#0 = #3#2;
          |LEE 000#112=;
          |CIERRA #112;

          #81#1 = #3#1;
          #81#2 = #3#1;
          #81#4 = #3#2;
          #81#5 = #112#24;
          #81#6 = #112#25;
          #81#8 = #3#3;
          #81#9 = #3#8;
          #81#15 = #3#10;
          #81#17 = #112#41;
          #81#18 = #112#3;
          #81#19 = #3#3;
          #81#20 = #112#4;
          #81#21 = #112#104;

          #81#27 = #112#81;
          #324#0 = #81#27;
          |LEE 000#324=;
          #81#28 = #324#2;
          #81#29 = #112#82;
          #81#32 = #321#9;
          #324#0 = #81#32;
          |LEE 000#324=;
          #81#33 = #324#2;

          #81#43 = #20#0;

          aDivisa = #81#27;
          aMoneda = #81#29;
          |HAZ Divisas081;

          |BUCLE CreaPedComLin;
          |HAZ CalCabAgifa081;
          |GRABA 020#81a;
     |FINSI;
     |CIERRA #67;
     |CIERRA #81;

     #3#19 = #81#25;
     #3#20 = #81#0;
|FPRC;
------------------------------------------------Albaran Compras
|PROCESO ImpAlbCom;
     ser_ped = #24#18;
     num_ped = #24#19;
     |SUB_EJECUTA_NP "agifa016";
|FPRC;

|PROCESO BorraAlbConLin;
     enUnidPend = #80#5;
     eaDocu = "agifa213";
     |HAZ StockEntra;
     |HAZ ActPedCom;
     |BORRA 020#80a;
|FPRC;

|RUTINA PcmCab;
     eaDocu = "agifa212";
     |HAZ StockEntra;
|FRUT;

|PROCESO BorraAlbCom;
     enForma = -1;
     |ABRE #77;
     |ABRE #80;
     #77#50 = #24#18;
     #77#0 = #24#19;
     |LEE 101#77=;
     |SI FSalida = 0;
          |BUCLELIN 2 PcmCab #77;
          |BUCLELIN 2 BorraAlbConLin #77;
          |SI eaBorCab = "S";
               |BORRA 020#77a;
          |FINSI;
     |FINSI;
     |CIERRA #77;
     |CIERRA #80;
|FPRC;

|RUTINA ActPedCom;
     |ABRE #67;
     #67#28 = #80#29;
     #67#0 = #80#12;
     #67#1 = #80#21;
     |LEE 101#67=;
     |SI FSalida = 0;
          #67#38 = #67#38 + (#80#5 * enForma);
          |GRABA 020#67a;
          |LIBERA #67;

          |ABRE #81;
          #81#25 = #67#28;
          #81#0 = #67#0;
          |LEE 101#81=;
          |SI FSalida = 0;
               |HAZ CalCabAgifa081;
               |GRABA 020#81a;
          |FINSI;
          |CIERRA #81;

     |FINSI;
     |CIERRA #67;
|FRUT;

|PROCESO CreaAlbComLin;
     #3#0 = #25#0;
     #3#18 = #25#15;
     |LEE 000#3=;

     nLinea = #25#1 * 3 - 2; || multiplo de 3
     |DDEFECTO #80;
     #80#27 = #77#50;
     #80#0 = #77#0;
     #80#1 = nLinea;
     |ABRE #19;
     #19#0 = #25#3;
     |LEE 000#19=;
     |CIERRA #19;
     #80#2 = #25#3;
     #80#3 = 1;
     #80#4 = #25#4;
     #80#5 = #25#5;
     #80#6 = #25#6;
     #80#11 = #19#30;

     #80#29 = #3#19;
     #80#12 = #3#20;
     #80#21 = #25#16 * 3 - 2;

     #80#13 = #19#2;
     #80#15 = #77#3;
     #80#30 = #80#6;
     #80#37 = #25#20;    ||partida = lote
     |HAZ TotalLin80;
     |HAZ CalCabAgifa077;
     |GRABA 020#80n;

     #77#41 = #77#41 + 1;

     enUnidPend = #80#5;
     eaDocu = "agifa213";
     |HAZ StockEntra;
     |HAZ ActPedCom;

     |SI #25#8 ! 0;
          nSubLinea = nLinea + 1;
          |DDEFECTO #80;
          #80#27 = #77#50;
          #80#0 = #77#0;
          #80#1 = nSubLinea;
          |ABRE #19;
          #19#0 = #25#10;
          |LEE 000#19=;
          |CIERRA #19;
          #80#2 = #25#10;
          #80#3 = 1;
          #80#4 = #25#12;
          #80#5 = #25#8;
          #80#6 = 0;
          #80#11 = #19#30;

          #80#29 = #3#19;
          #80#12 = #3#20;
          #80#21 = (#25#16 * 3 - 2) + 1;

          #80#13 = #19#2;
          #80#15 = #77#3;
          #80#30 = #80#6;
          #80#37 = #25#20;    ||partida = lote
          |GRABA 020#80n;

          enUnidPend = #80#5;
          eaDocu = "agifa213";
          |HAZ StockEntra;
          |HAZ ActPedCom;

          #77#41 = #77#41 + 1;
     |FINSI;

     |SI #25#9 ! 0;
          nSubLinea = nLinea + 2;
          |DDEFECTO #80;
          #80#27 = #77#50;
          #80#0 = #77#0;
          #80#1 = nSubLinea;
          |ABRE #19;
          #19#0 = #25#11;
          |LEE 000#19=;
          |CIERRA #19;
          #80#2 = #25#11;
          #80#3 = 1;
          #80#4 = #25#13;
          #80#5 = #25#9;
          #80#6 = 0;
          #80#11 = #19#30;

          #80#29 = #3#19;
          #80#12 = #3#20;
          #80#21 = (#25#16 * 3 - 2) + 2;

          #80#13 = #19#2;
          #80#15 = #77#3;
          #80#30 = #80#6;
          #80#37 = #25#20;    ||partida = lote
          |GRABA 020#80n;

          enUnidPend = #80#5;
          eaDocu = "agifa213";
          |HAZ StockEntra;
          |HAZ ActPedCom;

          #77#41 = #77#41 + 1;
     |FINSI;
|FPRC;

|DEFBUCLE CreaAlbComLin;
     #25#1;
     ;
     #24#0, #24#17, 001;
     #24#0, #24#17, 999;
     ;
     NULL, CreaAlbComLin;
|FIN;

|PROCESO CreaAlbCom;
     enForma = 1;

     |DDEFECTO #77;
     |ABRE #77;
     |ABRE #80;
     #77#50 = #24#18;
     #77#0 = #24#19;
     |SI eaNueva = "S";
          |GRABA 000#77b;
          |SI FSalida ! 0;
               aAlfa = "0000Albaran existente: " + #77#50 + "/" + #77#0;
               |MENAV aAlfa;
               enSwMenu = 1;
               |HAZ ContaAC7;
               |GRABA 000#77b;
               |PARA; |SI FSalida ! 0; |HACIENDO;
                    #77#0 = #77#0 + 1;
                    |GRABA 000#77b;
               |SIGUE;
               aAlfa = "0000Albaran asignado automaticamente: " + #77#50 + "/" + #77#0;
               |MENAV aAlfa;
          |FINSI;
     |SINO;
          |LEE 101#77=;
          |SI FSalida ! 0; |GRABA 020#77b; |FINSI;
     |FINSI;
     |SI FSalida = 0;
          |ABRE #112;
          #112#0 = #24#2;
          |LEE 000#112=;
          |CIERRA #112;

          #77#1 = #24#1;
          #77#3 = #24#2;
          #77#4 = #24#3;
          #77#8 = #24#8;

          |DFICE aDirEmp;
          |DFICB aDatos;
          aDirEmp = aDirEmp % -205;
          nCodEmp = aDirEmp;
          |PATH_DAT #41 aDatos;
          |ABRE #41;
          #41#0 = nCodEmp;
          |LEE 020#41=;
          |SI FSalida = 0;
               #77#29 = #41#1;
               #77#30 = #41#2;
               #77#31 = #41#3;
               #77#33 = #41#4;
          |FINSI;
          |CIERRA #41;
          |ABRE #324;
          #77#56 = #112#81;
          #324#0 = #77#56;
          |LEE 000#324=;
          #77#57 = #324#3;
          #77#61 = #321#9;
          #324#0 = #77#61;
          |LEE 000#324=;
          #77#62 = #324#3;
          |CIERRA #324;

          #77#71 = #20#0;

          aDivisa = #77#56;
          aMoneda = #77#58;
          |HAZ Divisas077;

          |HAZ LimCabAgifa077;
          |ABRE #3;
          |BUCLE CreaAlbComLin;
          |CIERRA #3;
          |GRABA 020#77a;

          |BUCLELIN 2 PcmCab #77;
     |FINSI;
     |CIERRA #77;
     |CIERRA #80;

     #24#18 = #77#50;
     #24#19 = #77#0;
|FPRC;
------------------------------------------------Pedido Ventas
|PROCESO agifa220;
     #26#3 = "";
     #26#4 = #220#2;
     #26#5 = 0;
     #26#6 = 0;
     #26#7 = 0;
     enHayAmpli = 1;
     |PRINT;
     enHayAmpli = 0;
|FPRC;

|DEFBUCLE agifa220;
     #220#1;
     ;
     #219#0, 000;
     #219#0, 999;
     ;
     NULL, agifa220;
|FIN;

|PROCESO ImpPedLinVta;
     |PRINT;

     #219#0 = #26#3;
     |LEE 000#219=;
     |SI FSalida = 0; |Y #219#2 = "S";
          |BUCLE agifa220;
     |FINSI;
     |SI #26#8 ! 0; || montamos sobre el articulo anterior para simplificar
          #26#3 = #26#10;
          #26#4 = #26#12;
          #26#5 = #26#8;
          #26#6 = #26#16;
          #26#7 = 0;
          |PRINT;
     |FINSI;
     |SI #26#9 ! 0;
          #26#3 = #26#11;
          #26#4 = #26#13;
          #26#5 = #26#9;
          #26#6 = #26#17;
          #26#7 = 0;
          |PRINT;
     |FINSI;
|FPRC;

|DEFBUCLE ImpPedLinVta;
     #26#1;
     ;
     #7#0, #7#19, 001;
     #7#0, #7#19, 999;
     ;
     NULL, ImpPedLinVta;
|FIN;

|PROCESO ImpPedVta;
     Impresora = "Crystal Reports";
     |IMPRE 0;
     |SI FSalida = 0;
          |INFOR aInfPedVta;
          |SI FSalida ! 0;
               aAlfa = "0000Error en informe:" + aInfPedVta;
               |MENAV aAlfa;
          |SINO;
               |ABRE #219;
               |BUCLE ImpPedLinVta;
               |CIERRA #219;
               |PIEINF;
               |FININF;
          |FINSI;
          |FINIMP;
     |FINSI;
|FPRC;

|PROCESO BorraPedVtaLin;
     eaMovimi = "PV";
     enCodigo = #73#0;
     eaSerie = #73#28;
     enLinea = #73#1;
     |SUB_EJECUTA_NP "dsz90002";

     |HAZ AcuCliente;
     |BORRA 020#73a;
|FPRC;

|PROCESO BorraPedVta;
     enForma = -1;
     |ABRE #104;
     |ABRE #73;
     #104#25 = #7#20;
     #104#0 = #7#21;
     |LEE 101#104=;
     |SI FSalida = 0;
          |BUCLELIN 2 BorraPedVtaLin #104;
          |SI eaBorCab = "S";
               |BORRA 020#104a;
          |FINSI;
     |FINSI;
     |CIERRA #73;
     |CIERRA #104;
|FPRC;

|RUTINA AcuCliente;
     |ABRE #19;
     #19#0 = #73#2;
     |LEE 020#19=;
     |CIERRA #19;
     |ABRE #124;
     #124#0 = #104#4;
     |LEE 121#124=;
     |SI FSalida = 0;
          |SI #19#194 = 2;
               nImpo = ((((#73#44 * #73#6) < #73#8) < #73#29) < #104#5) < #104#17;
          |SINO;
               nImpo = ((((#73#5 * #73#6) < #73#8) < #73#29) < #104#5) < #104#17;
          |FINSI;
          |SI #142#115 = "S";
               nImpo = nImpo < #104#6;
          |FINSI;
          nImpo = nImpo * enForma;
          aAlfa = #104#1 % A402;
          nNume = aAlfa - 1;
          nNume = nNume * 3;
          nNume = nNume + 114;
          #124nNume = #124nNume + nImpo;     || VENTA.
          #124#150 = #124#150 + nImpo;
          |GRABA 020#124a;

          eaCliente = #agifa104#4;
          efFecha = #agifa104#1;
          enImpCliPed = nImpo;
          |HAZ AcumulaCli;
     |FINSI;
     |CIERRA #124;
|FRUT;

|PROCESO CreaPedVtaLin;
     |DDEFECTO #19;
     |ABRE #19;
     #19#0 = #26#3;
     |LEE 000#19=;
     |CIERRA #19;

     nLinea = #26#2 * 3 - 2; || multiplo de 3

     |DDEFECTO #73;
     #73#28 = #104#25;
     #73#0 = #104#0;
     #73#1 = nLinea;
     #73#2 = #26#3;
     #73#3 = 1;
     #73#4 = #26#4;
     #73#5 = #26#5;
     #73#6 = #26#6;
     #73#13 = #104#2;
     #73#14 = #19#30;
     #73#16 = #104#7;
     #73#18 = #19#2;
     #73#19 = #104#18;
     #73#20 = #104#4;
     #73#23 = #104#5;
     #73#24 = #104#6;
     #73#25 = #104#17;
     #73#26 = #104#9;
     #73#38 = #73#6;
     #73#42 = #73#5;
     |GRABA 020#73n;

     eaMovimi = "PV";
     enCodigo = #73#0;
     eaSerie = #73#28;
     enLinea = #73#1;
     |SUB_EJECUTA_NP "dsz90002"; ||HAZ AcumulaPV;
     |HAZ AcuCliente;

     |SI #26#8 ! 0; ||Cajas
          |DDEFECTO #19;
          |ABRE #19;
          #19#0 = #26#10;
          |LEE 000#19=;
          |CIERRA #19;

          |DDEFECTO #73;
          #73#28 = #104#25;
          #73#0 = #104#0;
          #73#1 = nLinea + 1;
          #73#2 = #26#10;
          #73#3 = 1;
          #73#4 = #26#12;
          #73#5 = #26#8;
          #73#6 = #26#16;
          #73#13 = #104#2;
          #73#14 = #19#30;
          #73#16 = #104#7;
          #73#18 = #19#2;
          #73#19 = #104#18;
          #73#20 = #104#4;
          #73#23 = #104#5;
          #73#24 = #104#6;
          #73#25 = #104#17;
          #73#26 = #104#9;
          #73#38 = #73#6;
          #73#42 = #73#5;
          |GRABA 020#73n;

          eaMovimi = "PV";
          enCodigo = #73#0;
          eaSerie = #73#28;
          enLinea = #73#1;
          |SUB_EJECUTA_NP "dsz90002"; ||HAZ AcumulaPV;
     |FINSI;
     |SI #26#9 ! 0; ||Palets
          |DDEFECTO #19;
          |ABRE #19;
          #19#0 = #26#11;
          |LEE 000#19=;
          |CIERRA #19;

          |DDEFECTO #73;
          #73#28 = #104#25;
          #73#0 = #104#0;
          #73#1 = nLinea + 2;
          #73#2 = #26#11;
          #73#3 = 1;
          #73#4 = #26#13;
          #73#5 = #26#9;
          #73#6 = #26#17;
          #73#13 = #104#2;
          #73#14 = #19#30;
          #73#16 = #104#7;
          #73#18 = #19#2;
          #73#19 = #104#18;
          #73#20 = #104#4;
          #73#23 = #104#5;
          #73#24 = #104#6;
          #73#25 = #104#17;
          #73#26 = #104#9;
          #73#38 = #73#6;
          #73#42 = #73#5;
          |GRABA 020#73n;

          eaMovimi = "PV";
          enCodigo = #73#0;
          eaSerie = #73#28;
          enLinea = #73#1;
          |SUB_EJECUTA_NP "dsz90002"; ||HAZ AcumulaPV;
     |FINSI;
|FPRC;

|DEFBUCLE CreaPedVtaLin;
     #26#1;
     ;
     #7#0, #7#19, 001;
     #7#0, #7#19, 999;
     ;
     NULL, CreaPedVtaLin;
|FIN;

|PROCESO CreaPedVta;
     enForma = 1;
     |DDEFECTO #104;
     |ABRE #104;
     |ABRE #73;
     #104#25 = #7#20;
     #104#0 = #7#21;
     |SI eaNueva = "S";
          enSwMenu = 1;
          |HAZ ContaPV7;
          |GRABA 000#104b;
          |PARA; |SI FSalida ! 0; |HACIENDO;
               #104#0 = #104#0 + 1;
               |GRABA 000#104b;
          |SIGUE;
     |SINO;
          |LEE 101#104=;
          |SI FSalida ! 0; |GRABA 020#104b; |FINSI;
     |FINSI;
     |SI FSalida = 0;
          |DDEFECTO #124;
          |ABRE #124;
          #124#0 = #7#2;
          |LEE 000#124=;
          |CIERRA #124;
          |DDEFECTO #125;
          |ABRE #125;
          #125#0 = #124#25;
          |LEE 000#125=;
          |CIERRA #125;

          #104#1 = #7#1;
          #104#2 = #7#4;
          #104#4 = #7#2;
          #104#5 = #124#37;
          #104#6 = #124#38;
          #104#7 = #7#16;
          #104#8 = #7#3;
          #104#9 = #7#8;
          #104#15 = #7#10;
          #104#16 = #125#7;
          #104#17 = #124#156;
          #104#18 = #124#4;
          #104#19 = #7#3;
          #104#14 = #124#5;
          #104#20 = #124#6;
          #104#21 = #124#7;
          aAlfa = (("00" + #124#178) % -102) + (("000" + #124#179) % -104);
          #104#59 = aAlfa;
          #104#22 = #124#47;
          #104#23 = #124#41;

          #104#35 = #124#192;
          #324#0 = #104#35;
          |LEE 000#324=;
          #104#36 = #324#2;
          #104#37 = #124#193;
          #104#40 = #321#9;
          #324#0 = #104#40;
          |LEE 000#324=;
          #104#41 = #324#2;
          #104#60 = #124#202;
          #104#61 = #124#208;

          #104#51 = #20#0;

          aDivisa = #104#35;
          aMoneda = #104#37;
          |HAZ Divisas104;

          |BUCLE CreaPedVtaLin;
          |HAZ CalCabAgifa104;
          |GRABA 020#104a;
     |FINSI;
     |CIERRA #73;
     |CIERRA #104;

     #7#20 = #104#25;
     #7#21 = #104#0;
|FPRC;
------------------------------------------------Albaran Ventas
|PROCESO ImpAlbVta;
     eaDefImpre = "Crystal Reports";
     ser_alb = #10#52;
     num_alb = #10#0;
     abono = "N";
     |||SUB_EJECUTA_NP "agifa014";
     |HAZ ImpAlbVta0;
|FPRC;

|PROCESO BorraAlbVtaLin;
     enUnidPend = #71#5;
     eaProgVta = "agifa210";
     |HAZ AcumulaAV;
     |BORRA 020#71a;

     |HAZ ActPedVta;
|FPRC;

|RUTINA ActPedVta;
     |ABRE #73;
     #73#28 = #71#31;
     #73#0 = #71#12;
     #73#1 = #71#21;
     |LEE 101#73=;
     |SI FSalida = 0;
          #73#43 = #73#43 + (#71#5 * enForma);
          |GRABA 020#73a;
          |LIBERA #73;

          |ABRE #104;
          #104#25 = #73#28;
          #104#0 = #73#0;
          |LEE 101#104=;
          |SI FSalida = 0;
               |HAZ CalCabAgifa104;
               |GRABA 020#104a;
          |FINSI;
          |CIERRA #104;

     |FINSI;
     |CIERRA #73
|FRUT;

|PROCESO BorraAlbVta;
     enForma = -1;
     |ABRE #10;
     |ABRE #71;
     #10#52 = #27#20;
     #10#0 = #27#21;
     |LEE 101#10=;
     |SI FSalida = 0;
          |BUCLELIN 0 BorraAlbVtaLin #10;
          |SI eaBorCab = "S";
               |BORRA 020#10a;
          |FINSI;
     |FINSI;
     |CIERRA #71;
     |CIERRA #10;

     |ABRE #21;
     #21#0 = #27#0;
     #21#2 = #27#20;
     #21#3 = #27#21;
     |LEE 101#21=;
     |SI FSalida = 0;
          |BORRA 020#21a;
     |FINSI;
     |CIERRA #21;
|FPRC;

|PROCESO CreaAlbVtaLin;
     #7#0 = #28#0;
     #7#19 = #28#14;
     |LEE 000#7=;

     nLinea = #28#2 * 3 - 2; || multiplo de 3
     |DDEFECTO #71;
     #71#29 = #10#52;
     #71#0 = #10#0;
     #71#1 = nLinea;
     |ABRE #19;
     #19#0 = #28#3;
     |LEE 000#19=;
     |CIERRA #19;
     #71#2 = #28#3;
     #71#3 = 1;
     #71#4 = #28#4;
     #71#5 = #28#5;
     #71#6 = #28#6;
     #71#11 = #19#30;
     #71#13 = #19#2;
     #71#15 = #10#3;
     #71#16 = #10#34;
     #71#17 = #10#35;
     #71#36 = #71#6;

     #71#31 = #7#20;
     #71#12 = #7#21;
     #71#21 = #28#15 * 3 - 2;

     |HAZ TotalLin71;
     |HAZ CalCabAgifa010;
     enUnidPend = #71#5;
     eaProgVta = "agifa210";
     |HAZ AcumulaAV;
     |HAZ ActPedVta;
     #71#14 = enCoste;
     |GRABA 020#71n;

     |SI #28#8 ! 0;
          |DDEFECTO #71;
          #71#29 = #10#52;
          #71#0 = #10#0;
          #71#1 = nLinea + 1;
          |ABRE #19;
          #19#0 = #28#10;
          |LEE 000#19=;
          |CIERRA #19;
          #71#2 = #28#10;
          #71#3 = 1;
          #71#4 = #28#12;
          #71#5 = #28#8;
          #71#6 = #28#20;
          #71#11 = #19#30;
          #71#13 = #19#2;
          #71#15 = #10#3;
          #71#16 = #10#34;
          #71#17 = #10#35;
          #71#36 = #71#6;

          #71#31 = #7#20;
          #71#12 = #7#21;
          #71#21 = #28#15 * 3 - 2;
          |HAZ TotalLin71;
          |HAZ CalCabAgifa010;
          enUnidPend = #71#5;
          eaProgVta = "agifa210";
          |HAZ AcumulaAV;
          |HAZ ActPedVta;
          #71#14 = enCoste;
          |GRABA 020#71n;
     |FINSI;

     |SI #28#9 ! 0;
          |DDEFECTO #71;
          #71#29 = #10#52;
          #71#0 = #10#0;
          #71#1 = nLinea + 2;
          |ABRE #19;
          #19#0 = #28#11;
          |LEE 000#19=;
          |CIERRA #19;
          #71#2 = #28#11;
          #71#3 = 1;
          #71#4 = #28#13;
          #71#5 = #28#9;
          #71#6 = #28#21;
          #71#11 = #19#30;
          #71#13 = #19#2;
          #71#15 = #10#3;
          #71#16 = #10#34;
          #71#17 = #10#35;
          #71#36 = #71#6;

          #71#31 = #7#20;
          #71#12 = #7#21;
          #71#21 = #28#15 * 3 - 2;
          |HAZ TotalLin71;
          |HAZ CalCabAgifa010;
          enUnidPend = #71#5;
          eaProgVta = "agifa210";
          |HAZ AcumulaAV;
          #71#14 = enCoste;
          |HAZ ActPedVta;
          |GRABA 020#71n;

     |FINSI;
|FPRC;

|DEFBUCLE CreaAlbVtaLin;
     #28#1;
     ;
     #27#0, #27#19, 001;
     #27#0, #27#19, 999;
     ;
     NULL, CreaAlbVtaLin;
|FIN;

|PROCESO CreaAlbVta;
     enForma = 1;
     |DDEFECTO #10;
     |ABRE #10;
     |ABRE #71;
     #10#52 = #27#20;
     #10#0 = #27#21;
     |SI eaNueva = "S";
          |GRABA 000#10b;
          |SI FSalida ! 0;
               aAlfa = "0000Albaran existente: " + #10#52 + "/" + #10#0;
               |MENAV aAlfa;
               enSwMenu = 1;
               |HAZ ContaAV7;
               |GRABA 000#10b;
               |PARA; |SI FSalida ! 0; |HACIENDO;
                    #10#0 = #10#0 + 1;
                    |GRABA 000#10b;
               |SIGUE;
               aAlfa = "0000Albaran asignado automaticamente: " + #10#52 + "/" + #10#0;
               |MENAV aAlfa;
          |FINSI;
     |SINO;
          |LEE 101#10=;
          |SI FSalida ! 0; |GRABA 020#10b; |FINSI;
     |FINSI;
     |SI FSalida = 0;
          |ABRE #124;
          #124#0 = #27#2;
          |LEE 000#124=;
          |CIERRA #124;

          #10#1 = #27#1;
          #10#3 = #27#2;
          #10#4 = #27#3;
          #10#6 = #27#16;
          #10#8 = #27#8;

          #10#29 = #27#18;
          #10#30 = #27#14;
          #10#31 = #27#15;
          #10#33 = #124#7;
          #10#40 = #124#41;
          #10#50 = #124#40;
          #10#55 = #27#23;
          #10#56 = #27#24;
          #10#57 = #27#25;
          aAlfa = (("00" + #124#178) % -102) + (("000" + #124#179) % -104);
          #10#62 = aAlfa;
          #10#63 = #124#15;
          #10#68 = #124#192;
          #324#0 = #10#68;
          |LEE 000#324=;
          #10#69 = #324#2;
          #10#73 = #321#9;
          #324#0 = #10#73;
          |LEE 000#324=;
          #10#74 = #324#2;

          #10#83 = #20#0;

          aDivisa = #10#68;
          aMoneda = #10#70;
          |HAZ Divisas010;

          |HAZ LimCabAgifa010;
          |ABRE #7;
          |BUCLE CreaAlbVtaLin;
          |CIERRA #7;
          |GRABA 020#10a;
     |FINSI;
     |CIERRA #71;
     |CIERRA #10;

     #27#20 = #10#52;
     #27#21 = #10#0;

     |ABRE #21;
     #21#0 = #27#0;
     #21#2 = #27#20;
     #21#3 = #27#21;
     |LEE 101#21=;
     |SI FSalida ! 0; |GRABA 020#21b; |FINSI;
     #21#1 = #27#16;
     #21#4 = #10#1;
     #21#5 = #10#3;
     #21#6 = #10#4;
     |GRABA 020#21a;
     |CIERRA #21;
|FPRC;
------------------
|PROCESO AgrupaLinAlb;
     |DDEFECTO #16;
     #16#0 = 1;     || articulo
     #16#1 = #28#3;
     #16#3 = #28#19 + #28#22 + #28#23 + #28#24 + #28#25;
     #16#6 = #28#6;
     |LEE 101#16=;
     |SI FSalida ! 0; |GRABA 020#16b; |FINSI;
     #16#2 = #28#18;
     #16#4 = #28#4;
     #16#5 = #16#5 + #28#5;
     #16#7 = #16#5 * #16#6;
     #16#8 = #28#19;
     #16#9 = #28#22;
     #16#10 = #28#23;
     #16#11 = #28#24;
     #16#12 = #28#25;
     |GRABA 020#16a;
     |LIBERA #16;

     |SI #28#8  ! 0;
          |DDEFECTO #16;
          #16#0 = 2;     || cajas
          #16#1 = #28#10;
          #16#3 = "";
          #16#6 = #28#20;
          |LEE 101#16=;
          |SI FSalida ! 0; |GRABA 020#16b; |FINSI;
          #16#2 = #28#18;
          #16#4 = #28#12;
          #16#5 = #16#5 + #28#8;
          #16#7 = #16#5 * #16#6;
          |GRABA 020#16a;
          |LIBERA #16;
     |FINSI;

     |SI #28#9 ! 0;
          |DDEFECTO #16;
          #16#0 = 3;     || palets
          #16#1 = #28#11;
          #16#3 = "";
          #16#6 = #28#21;
          |LEE 101#16=;
          |SI FSalida ! 0; |GRABA 020#16b; |FINSI;
          #16#2 = #28#18;
          #16#4 = #28#13;
          #16#5 = #16#5 + #28#9;
          #16#7 = #16#5 * #16#6;
          |GRABA 020#16a;
          |LIBERA #16;
     |FINSI;
|FPRC;

|DEFBUCLE AgrupaLinAlb;
     #28#1;
     ;
     #27#0, #27#19, 001;
     #27#0, #27#19, 999;
     ;
     NULL, AgrupaLinAlb;
|FIN;

|PROCESO ImpAgrupado;
     eaEsLote = "N";
     |PRINT;
     |SI #16#0 = 1;
          eaEsLote = "S";
          |PRINT;
     |FINSI;
|FPRC;

|DEFBUCLE ImpAgrupado;
     #16#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, ImpAgrupado;
|FIN;

|RUTINA ImpAlbVta0;
     |ABRE #107;
     #107#26 = ser_alb;
     |LEE 020#107=;
     |CIERRA #107;

     |ABRE #10;
     #10#52 = ser_alb;
     #10#0 = num_alb;
     |LEE 020#10=;
     |CIERRA #10;

     |HAZ CreaTempo; |NOME_DAT #16 Tempo; |DELINDEX #16; |ABRE #16;

     |BUCLE AgrupaLinAlb;
     Impresora = "Crystal Reports";
     |IMPRE 0;
     |SI FSalida = 0;
          |SI #10#43 = "S";
               aInforme = #107#5;
          |SINO;
               |SI #10#50 = "S";
                    aInforme = #107#3;
               |SINO;
                    aInforme = #107#4;
               |FINSI;
          |FINSI;
          |QBF aInforme;
          |INFOR aInforme;
          |SI FSalida ! 0;
               aAlfa = "0000Error en informe:" + aInforme;
          |SINO;
               |BUCLE ImpAgrupado;
               |PIEINF;
               |FININF;
          |FINSI;
          |FINIMP;
     |FINSI;

     |HAZ BoraTempo; |CIERRA #16; |DELINDEX #16;
|FRUT;
