|FICHEROS;
     guerw012 #0;
     guerm001 #1;          ||Cabeceras
     guerm002 #2;          ||Lineas
     guerm014 #14;          ||cab mov alm
     guerm015 #15;          ||lin mov alm
     guerm101 #11;        ||Cabeceras Exportacion
     guerm102 #12;        ||Lineas Exportacion
     guerm114 #114;         ||cab exp alm
     guerm115 #115;         ||lin exp alm

     agifa017 #17;
     agifa019 #19;
     dsm00043 #43;
     dsm00044 #44;

     dsm00056 #56;
     dsm00057 #57;
     dsm00056@ #156;
     dsm00057@ #157;

     agifa112 #112;
     agifa017 #17;
     agifa019 #19;
|FIN;

|INCLUYE i_varart;
|VARIABLES;
     sto       = 0;
     aDef      = "";
     i         = 0;
     nCampo    = 0;
     fmes      = "";
     fecha     = @;
     pelas     = 0;
     mes       = 0;

     &programa = "";
     path = "";
     copia = "";
     mensaje = "";
     cab = "Lectura Diskette";
     sistem = "";
     fichero = "";
     alfa1 = "";

     aAlfa = "";
     aDestino = ""; aOrigen = "";
     aTraba = "";
     aTrab1 = "";
     aEmpre = "";
     aNombr = "";
     swinf = 0;
     informe = "guerw012";
     &aError = "";
|FIN;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO RegularizaL;
     |ABRE #43;
     |ABRE #44;
     |DDEFECTO #43;
     |DDEFECTO #44;
     #43#4 = "";
     #43#0 = #15#1;
     |LEE 000#43=;
     |SI FSalida ! 0; |GRABA 020#43n; |FINSI;

     #44#21 = #43#4;
     #44#18 = #43#0;
     #44#8 = #15#0;

     |DDEFECTO #19;
     |ABRE #19;
     #19#0 = #15#2;
     |LEE 000#19=;
     |CIERRA #19;
     |DDEFECTO #17;
     |ABRE #17;
     #17#0 = #15#2;
     #17#1 = #14#41;
     |LEE 000#17=;
     |CIERRA #17;

     #44#0 = #15#2;
     #44#1 = #14#41;
     #44#2 = #15#3;
     #44#3 = #17#39;
     #44#4 = #15#4;
     #44#5 = #43#1;
     #44#6 = #19#6;
     #44#7 = "E";
     #44#19 = #17#5;
     #44#20 = #19#104;
     |GRABA 020#44n;

     enForma = 1;
     enCodigo = #44#18;
     |HAZ AcumulaES_SS;

     |CIERRA #44;
     |CIERRA #43;
|FPRC;

|PROCESO RegularizaC;
     |ABRE #43;
     |DDEFECTO #43;
     #43#4 = "";
     #43#0 = #14#0;
     #43#1 = #14#1;
     |LEE 000#43=;
     |SI FSalida ! 0; |GRABA 020#43n; |FINSI;
     |CIERRA #43;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO actualmas;
     #17#0 = #19#0;
     FSalida = 0;
     |PARA #17#1 = 0;|SI FSalida = 0; |HACIENDO ;
          |LEE 101#17>;
          |SI #17#0 = #19#0; |Y FSalida = 0;
               sto = #17#5 - #17#4;
               #17#3 = sto * #19#9;
               #17#50 = #17#42 + #17#6 - #17#43 - #17#39; || necesidades
               #17#50 = #17#50 - #17#4 - #17#9 - #17#8;
               |GRABA 020#17a;
               |LIBERA #17;
          |SINO;
               FSalida = 2 ;
          |FINSI;
     |SIGUE;
|FPRC;

|PROCESO salida;
     |DDEFECTO #19;
     #19#0 = #57#0;
     |LEE 101#19=;
     |SI FSalida ! 0;  |GRABA 020#19b;  |FINSI;

     |DDEFECTO #17;
     #17#0 = #57#0;
     #17#1 = #57#1;
     |LEE 101#17=;
     |SI FSalida ! 0;  |GRABA 020#17b; |FINSI;

     |DDEFECTO #112;
     #112#0 = #57#5;
     |LEE 101#112=;
     |SI FSalida ! 0;  |GRABA 020#112b;  |FINSI;

     eaProve = #112#0;
     enCodigo = #57#27;
     enForma = 1;
     |HAZ AcumulaEV;

     #57#3 = #17#39;
     |SI #57#12 ] #19#26; |Y enForma = 1;
         #19#26 = #57#12;         || Ultima Fecha de Compra
         #19#27 = #57#5;          || Ultimo Proveedor
         |SI #57#6 ! 0;
             #19#28  = #57#6;     || Ultimo Precio de Compra
             #19#165 = #57#18;    || Divisa UPC
             #19#163 = #57#19;    || UPC Divisa
         |FINSI;
         #19#29  = #57#7;                      || Ultimo Descuento Compra 1
         #19#129 = #57#20;                     || Ultimo Descuento Compra 2
         #19#209 = #57#30;
         #19#133 = ((#19#28 < #19#29) < #19#129) < #19#209;  || Precio Ult.Compra Descuento
         #19#164 = ((#19#163 < #19#29) < #19#129) < #19#209; || UPC Divida con Dto.
     |FINSI;

     |SI #57#4 = 0;
          pelas = 0;
     |SINO;
          |SI #19#196 = 1;
               pelas = #57#4 * #57#11;
          |SINO;
               pelas = #57#21 * #57#11;
          |FINSI;
     |FINSI;

     fecha = #57#12;
     fmes  = fecha % A402;
     mes   = fmes - 1;
     mes   = mes + 27;
     #112mes = #112mes +. pelas;
     #112#39 = #112#39 +. pelas;
     #19#123 = "N";
     #19#124 = "00.00.0000";
     |GRABA 020#19a;  |LIBERA #19;
     |GRABA 020#17a;  |LIBERA #17;

     enImpPrvCom = pelas;
     efFecha = #57#12;
     eaProve = #57#5;
     |HAZ AcumulaPrv;

     |HAZ actualmas;
     |GRABA 020#112a;
     |LIBERA #112;
|FPRC;

|PROCESO dsm00157;
     aAlfa = "|NC";
     aAlfa = #57#aAlfa#;
     nCampo = aAlfa; nCampo = nCampo - 1;
     |PARA i = 0; |SI i [ nCampo; |HACIENDO i = i + 1;
          #57i = #157i;
     |SIGUE;
     #57#1 = 99999;
     |GRABA 000#57n;
     |SI FSalida ! 0;
          |SI swinf = 0; |HAZ pideimp; |FINSI;
          |SI swinf = 1;
               aError = "Linea duplicada EV " + #157#28 + " " + #157#27 + " " + #157#14;
               |PRINT;
          |FINSI;
     |SINO;
          |HAZ salida;
     |FINSI;
|FPRC;

|DEFBUCLE dsm00157;
     #157#1003;
     ;
     #156#2, #156#0, 001;
     #156#2, #156#0, 999;
     ;
     NULL, dsm00157;
|FIN;

|PROCESO dsm00156;
     aAlfa = "|NC";
     aAlfa = #56#aAlfa#;
     nCampo = aAlfa; nCampo = nCampo - 1;
     |PARA i = 0; |SI i [ nCampo; |HACIENDO i = i + 1;
          #56i = #156i;
     |SIGUE;
     |GRABA 000#56n;
     |SI FSalida ! 0;
          |SI swinf = 0; |HAZ pideimp; |FINSI;
          |SI swinf = 1;
               aError = "Entrada Valorada " + #156#2 + " " + #156#0;
               |PRINT;
          |FINSI;
     |FINSI;

     |BUCLE dsm00157;
|FPRC;

|DEFBUCLE dsm00156;
     #156#1002;
     ;
     "     ", 000001;
     "zzzzz", 999999;
     ;
     NULL, dsm00156;
|FIN;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO pideimp;
  |IMPRE 0;
  |SI FSalida ! 0;  |ACABA;  |FINSI;
  |INFOR informe;
  |SI FSalida ! 0;  |FINIMP;  |ACABA;  |FINSI;
  swinf = 1;
|FPRC;

|PROCESO guerm102;
  #2#0 = #12#0;  #2#1 = #12#1;  #2#2 = #12#2;  #2#3 = #12#3;  #2#4 = #12#4;
  #2#5 = #12#5;  #2#6 = #12#6;  #2#7 = #12#7;  #2#8 = #12#8;
  |GRABA 000#2n;
  |SI FSalida ! 0;
      |SI swinf = 0;  |HAZ pideimp;  |FINSI;
      |SI swinf = 1;
          aError = "Linea duplicada " + #12#1 + " " + #12#0;
         |PRINT;
      |FINSI;
  |FINSI;
|FPRC;

|DEFBUCLE guerm102;
#12#1;
;
000000, 00;
999999, 99;
be;
NULL,guerm102;
|FIN;

|PROCESO guerm101;
  #1#0  = #11#0;   #1#1  = #11#1;   #1#2  = #11#2;   #1#3  = #11#3;   #1#4  = #11#4;
  #1#5  = #11#5;   #1#6  = #11#6;   #1#7  = #11#7;   #1#8  = #11#8;   #1#9  = #11#9;
  #1#10 = #11#10;  #1#11 = #11#11;  #1#12 = #11#12;  #1#13 = #11#13;  #1#14 = #11#14;
  #1#15 = #11#15;  #1#16 = #11#16;  #1#17 = #11#17;  #1#18 = #11#18;  #1#19 = #11#19;
  #1#20 = #11#20;  #1#21 = #11#21;  #1#22 = #11#22;  #1#23 = #11#23;  #1#24 = #11#24;
  #1#25 = #11#25;  #1#26 = #11#26;  #1#27 = #11#27;  #1#28 = #11#28;  #1#29 = #11#29;
  #1#30 = #11#30;  #1#31 = #11#31;  #1#32 = #11#32;  #1#33 = #11#33;  #1#34 = #11#34;
  #1#35 = #11#35;  #1#36 = #11#36;  #1#37 = #11#37;  #1#38 = #11#38;  #1#39 = #11#39;
  #1#40 = #11#40;
  |GRABA 000#1n;
  |SI FSalida ! 0;
      |SI swinf = 0;  |HAZ pideimp;  |FINSI;
      |SI swinf = 1;
          aError = "Movimiento Duplicado " + #11#0;
          |PRINT;
      |FINSI;
  |FINSI;
|FPRC;

|DEFBUCLE guerm101;
#11#1;
;
000000;
999999;
be;
NULL,guerm101;
|FIN;

|PROCESO guerm115;
  #15#0 = #115#0;  #15#1 = #115#1;  #15#2 = #115#2;  #15#3 = #115#3;  #15#4 = #115#4;
  #15#5 = #115#5;  #15#6 = #115#6;  #15#7 = #115#7;  #15#8 = #115#8;
  |GRABA 000#15n;
  |SI FSalida ! 0;
      |SI swinf = 0;  |HAZ pideimp;  |FINSI;
      |SI swinf = 1;
          aError = "Linea Movimiento de Almacen duplicada " + #115#1 + " " + #115#0;
         |PRINT;
      |FINSI;
  |SINO;
     |HAZ RegularizaL;
  |FINSI;
|FPRC;

|DEFBUCLE guerm115;
#115#1;
;
000000, 00;
999999, 99;
be;
NULL,guerm115;
|FIN;

|PROCESO guerm114;
  #14#0  = #114#0;   #14#1  = #114#1;   #14#2  = #114#2;   #14#3  = #114#3;   #14#4  = #114#4;
  #14#5  = #114#5;   #14#6  = #114#6;   #14#7  = #114#7;   #14#8  = #114#8;   #14#9  = #114#9;
  #14#10 = #114#10;  #14#11 = #114#11;  #14#12 = #114#12;  #14#13 = #114#13;  #14#14 = #114#14;
  #14#15 = #114#15;  #14#16 = #114#16;  #14#17 = #114#17;  #14#18 = #114#18;  #14#19 = #114#19;
  #14#20 = #114#20;  #14#21 = #114#21;  #14#22 = #114#22;  #14#23 = #114#23;  #14#24 = #114#24;
  #14#25 = #114#25;  #14#26 = #114#26;  #14#27 = #114#27;  #14#28 = #114#28;  #14#29 = #114#29;
  #14#30 = #114#30;  #14#31 = #114#31;  #14#32 = #114#32;  #14#33 = #114#33;  #14#34 = #114#34;
  #14#35 = #114#35;  #14#36 = #114#36;  #14#37 = #114#37;  #14#38 = #114#38;  #14#39 = #114#39;
  #14#40 = #114#40;  #14#41 = #114#41;  #14#42 = #114#42;
  |GRABA 000#14n;
  |SI FSalida ! 0;
      |SI swinf = 0;  |HAZ pideimp;  |FINSI;
      |SI swinf = 1;
          aError = "Movimiento Almacen Duplicado " + #14#0;
          |PRINT;
      |FINSI;
  |SINO;
     |HAZ RegularizaC;
  |FINSI;
|FPRC;

|DEFBUCLE guerm114;
#114#1;
;
000000;
999999;
be;
NULL,guerm114;
|FIN;

|PROCESO copiando;
     aAlfa = "";
     |IP_REMOTO aAlfa;
     |QBT aAlfa;
     |SI aAlfa ! "";
          |RECIBE_FICHERO aOrigen, aDestino;
     |SINO;
         |COPIA_FICHERO aOrigen, aDestino;
     |FINSI;
|FPRC;

|PROGRAMA;
  |CLS;
  |PINPA #0#0;
  |CABEZA cab;

  |ATRI R;
  |PINTA 0838, programa;
  |ATRI 0;

  |PINDA #0#0;
  |ENDATOS #1#0;
  |SI FSalida ! 0;  |ACABA;  |FINSI;
  |DFICE path;
  |ATRI P; |ATRI R;
  mensaje = " Introduzca disco en la unidad " + #0#0 + ": ";
  |PINTA 2320,mensaje;
  |ATRI 0;
  |PAUSA;
||  |SI FSalida ! 0; |ACABA; |FINSI;
  |BLIN 23;

  |DFICE aTraba;
  |DFICB aTrab1;
  aEmpre = aTraba - aTrab1;
  aEmpre = aEmpre - "/";

  aNombr = "cab" + aEmpre + ".dat";
  aDestino = path + aNombr;
  aOrigen = #0#0 + ":/" + aNombr;
  aTraba = "Copiando: " + aNombr;
  |ATRI P; |ATRI R; |PINTA 2420, aTraba; |ATRI 0;
  |HAZ copiando;

  aNombr = "cab" + aEmpre + ".ddx";
  aDestino = path + aNombr;
  aOrigen = #0#0 + ":/" + aNombr;
  aTraba = "Copiando: " + aNombr;
  |ATRI P; |ATRI R; |PINTA 2420, aTraba; |ATRI 0;
  |HAZ copiando;

  aNombr = "cab" + aEmpre + ".ixx";
  aDestino = path + aNombr;
  aOrigen = #0#0 + ":/" + aNombr;
  aTraba = "Copiando: " + aNombr;
  |ATRI P; |ATRI R; |PINTA 2420, aTraba; |ATRI 0;
  |HAZ copiando;

  aNombr = "lin" + aEmpre + ".dat";
  aDestino = path + aNombr;
  aOrigen = #0#0 + ":/" + aNombr;
  aTraba = "Copiando: " + aNombr;
  |ATRI P; |ATRI R; |PINTA 2420, aTraba; |ATRI 0;
  |HAZ copiando;

  aNombr = "lin" + aEmpre + ".ddx";
  aDestino = path + aNombr;
  aOrigen = #0#0 + ":/" + aNombr;
  aTraba = "Copiando: " + aNombr;
  |ATRI P; |ATRI R; |PINTA 2420, aTraba; |ATRI 0;
  |HAZ copiando;

  aNombr = "lin" + aEmpre + ".ixx";
  aDestino = path + aNombr;
  aOrigen = #0#0 + ":/" + aNombr;
  aTraba = "Copiando: " + aNombr;
  |ATRI P; |ATRI R; |PINTA 2420, aTraba; |ATRI 0;
  |HAZ copiando;

  aNombr = "cmo" + aEmpre + ".dat";
  aDestino = path + aNombr;
  aOrigen = #0#0 + ":/" + aNombr;
  aTraba = "Copiando: " + aNombr;
  |ATRI P; |ATRI R; |PINTA 2420, aTraba; |ATRI 0;
  |HAZ copiando;

  aNombr = "cmo" + aEmpre + ".ddx";
  aDestino = path + aNombr;
  aOrigen = #0#0 + ":/" + aNombr;
  aTraba = "Copiando: " + aNombr;
  |ATRI P; |ATRI R; |PINTA 2420, aTraba; |ATRI 0;
  |HAZ copiando;

  aNombr = "cmo" + aEmpre + ".ixx";
  aDestino = path + aNombr;
  aOrigen = #0#0 + ":/" + aNombr;
  aTraba = "Copiando: " + aNombr;
  |ATRI P; |ATRI R; |PINTA 2420, aTraba; |ATRI 0;
  |HAZ copiando;

  aNombr = "lmo" + aEmpre + ".dat";
  aDestino = path + aNombr;
  aOrigen = #0#0 + ":/" + aNombr;
  aTraba = "Copiando: " + aNombr;
  |ATRI P; |ATRI R; |PINTA 2420, aTraba; |ATRI 0;
  |HAZ copiando;

  aNombr = "lmo" + aEmpre + ".ddx";
  aDestino = path + aNombr;
  aOrigen = #0#0 + ":/" + aNombr;
  aTraba = "Copiando: " + aNombr;
  |ATRI P; |ATRI R; |PINTA 2420, aTraba; |ATRI 0;
  |HAZ copiando;

  aNombr = "lmo" + aEmpre + ".ixx";
  aDestino = path + aNombr;
  aOrigen = #0#0 + ":/" + aNombr;
  aTraba = "Copiando: " + aNombr;
  |ATRI P; |ATRI R; |PINTA 2420, aTraba; |ATRI 0;
  |HAZ copiando;

  aNombr = "cab" + aEmpre;
  |NOME_DAT #11 aNombr;
  aNombr = "lin" + aEmpre;
  |NOME_DAT #12 aNombr;
  |ABRE #1;
  |ABRE #2;
  |ABRE #12;
  |BUCLE guerm101;
  |BUCLE guerm102;
  |CIERRA #1;
  |CIERRA #2;
  |CIERRA #12;

  aNombr = "cmo" + aEmpre;
  |NOME_DAT #114 aNombr;
  aNombr = "lmo" + aEmpre;
  |NOME_DAT #115 aNombr;
  |ABRE #14;
  |ABRE #15;
  |ABRE #115;

  |BUCLE guerm114;
  |BUCLE guerm115;
  |CIERRA #14;
  |CIERRA #15;
  |CIERRA #115
  ||컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
     aNombr = "vac" + aEmpre + ".ixx"; |HAZ MiCopia;
     aNombr = "vac" + aEmpre + ".dat"; |HAZ MiCopia;
     aNombr = "vac" + aEmpre + ".ddx"; |HAZ MiCopia;
     aNombr = "val" + aEmpre + ".ixx"; |HAZ MiCopia;
     aNombr = "val" + aEmpre + ".dat"; |HAZ MiCopia;
     aNombr = "val" + aEmpre + ".ddx"; |HAZ MiCopia;

     |DDEF aDef;
     aAlfa = aDef + "dsm00056";
     |CARGA_DEF aAlfa, dsm00056@;
     |SI FSalida = 0;
          aAlfa = aDef + "dsm00057";
          |CARGA_DEF aAlfa, dsm00057@;
          |SI FSalida = 0;
               |DFICE aTraba;
               |DFICB aTrab1;
               aEmpre = aTraba - aTrab1;
               aEmpre = aEmpre - "/";
               aNombr = "vac" + aEmpre;
               |NOME_DAT #156 aNombr;
               aNombr = "val" + aEmpre;
               |NOME_DAT #157 aNombr;
               |ABRE #56;
               |ABRE #57;
               |ABRET #19;
               |ABRET #17;
               |ABRET #112;
               |BUCLE dsm00156;
               |CIERRAT #112;
               |CIERRAT #17;
               |CIERRAT #19;
               |CIERRA #57;
               |CIERRA #56;
          |SINO;
               aAlfa = "0000Error al cargar " + aDef;
               |MENAV aAlfa;
          |FINSI;
     |SINO;
          aAlfa = "0000Error al cargar " + aDef;
          |MENAV aAlfa;
     |FINSI;

  ||컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
  |SI swinf = 1;
      |PIEINF;
      |FININF;
      |FINIMP;
  |FINSI;
|FPRO;

|PROCESO MiCopia;
     aDestino = path + aNombr;
     aOrigen = #0#0 + ":/" + aNombr;
     aTraba = "Copiando: " + aNombr;
     |ATRI P; |ATRI R; |PINTA 2420, aTraba; |ATRI 0;
     |HAZ copiando;
|FPRC;
