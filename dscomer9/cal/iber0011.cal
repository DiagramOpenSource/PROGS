|FICHEROS;
     iber0011 #0;
     referen@ #1;
     refere2@ #2;

     agifa142 #142;
     iber0018 #18;  ||Prod. Centro
     iber0023 #100; ||Historico
     dsw00011 #999; ||Usado de temporal para escandallo
     iber0075 #75;  ||Envio
     dsm00204 #204; ||Mails
||컴컴 A Exportar 컴컴컴컴컴컴컴컴컴컴컴

     iber0016 #16;  ||Centros
     agifa024 #24;
     agifa019 #19;
     agifa112 #112;
     agifa505 #505; ||Cajas
     agifa081 #81;  ||Ped. Comp
     agifa067 #67;  || ''
     iber0017 #117; ||Prod. Centro
     iber0018 #118; || ''
     iber0019 #119; ||Prod. Centro/Punto Venta
     iber0020 #120; || ''
     iber0001 #101; ||Prove. Homol
     iber0002 #102; || ''
     agifa048 #480; ||Escan
     agifa049 #49;  || ''
     agifa007 #7;   ||Series
     agifa029 #29;  ||Almacenes
     iber0040 #40;  ||Usuarios
     iber0041 #41;  ||Terminales
     iber0101 #1001;||Operarios
     iber0056 #56;  ||Orden
     iber0063 #163;
     iber0064 #164;
     iber0066 #166;
     iber0067 #167;
     iber0068 #168;
     iber0069 #169;
     iber0070 #170;
     iber0074 #174;
     iber0076 #176;
     dsm00018 #918;
     iber0113 #113;
|FIN;

|VARIABLES;
     &Tempo    = "";
     &aPath    = "";
     &enSwCheq = 0;
     fFecha    = @;
     aPathImg  = "";
     aReceta   = "";
     aTempo75  = "";
     aDele     = "";
     aParam    = "";
     a1        = "";
     a2        = "";
     aTar      = "";
     aEmp      = "";
     aFic2     = "";
     aFic      = "";
     aDef      = "";
     aAlfa     = "";
     aAlf1     = "";
     aAlf2     = "";
     aSwPath   = "";
     aOrg      = "";
     aDes      = "";
     aFicher1  = "";
     aDSer     = "";
     aHSer     = "";
     aLon      = "";
     aImg      = "";
     aLetra    = "";
     nHandl1   = 0;
     nCampo1   = 0;
     nCampo2   = 0;
     i         = 0;
     nLin      = 0;
     nPvp      = 0;
     nDCaja    = 0;
     nHCaja    = 0;
     nDAlma    = 0;
     nHAlma    = 0;
     nPos      = 0;
     nSwExp    = 0;
     nLong     = 0;
     aFich     = "";
     aDev      = "";
     aLong     = "";
|FIN;

|INCLUYE i_escand;

|PROCESO CargaDef;
     |DDEF aDef;
     aDef = aDef + aFic;
     |CARGA_DEF aDef, referen@;
     |SI FSalida ! 0;
          aAlfa = "0000 Error al cargar " + aDef;
          |MENAV aAlfa;
     |FINSI;
|FPRC;

|PROCESO CargaDef2;
     |DDEF aDef;
     aDef = aDef + aFic2;
     |CARGA_DEF aDef, refere2@;
     |SI FSalida ! 0;
          aAlfa = "0000 Error al cargar " + aDef;
          |MENAV aAlfa;
     |FINSI;
|FPRC;

|PROCESO NomeDat;
     |PATH_DAT #1 aPath;
     aAlfa = "exp" + (aFic % -105);
     |NOME_DAT #1 aAlfa;
     aAlfa = "|NC";
     aAlfa = #referen@#aAlfa#;
     nCampo1 = aAlfa; nCampo1 = nCampo1 - 1;
     |DELINDEX #1;
     |ABRE #referen@;
|FPRC;

|PROCESO NomeDat2;
     |PATH_DAT #2 aPath;
     aAlfa = "exp" + (aFic2 % -105);
     |NOME_DAT #2 aAlfa;
     aAlfa = "|NC";
     aAlfa = #refere2@#aAlfa#;
     nCampo2 = aAlfa; nCampo2 = nCampo2 - 1;
     |DELINDEX #2;
     |ABRE #refere2@;
|FPRC;

|PROCESO DescargaDef;
     |CIERRA #referen@;
     |DESCARGA_DEF #referen@;
|FPRC;

|PROCESO DescargaDef2;
     |CIERRA #refere2@;
     |DESCARGA_DEF #refere2@;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO Definibles;
     |DFICE aFich;
     |_PDIR aFich;
     |PARA; |SI FSalida = 0; |HACIENDO;
          aAlfa = aFich % -1003;  aAlfa = aAlfa < "";
          |SI aAlfa = "lis";
               aAlfa = aFich % -112;
               aOrg = aFich;
               aDes = aPath + aAlfa;
               aDes = aDes < "";
               |COPIA_FICHERO aOrg, aDes;
          |FINSI;
          |_SDIR aFich;
     |SIGUE;

     |DBASS aDev;
     aDev = aDev + "dev/imp/";
     aOrg = aDev + "etiqueta.d"; aDes = aPath + "etiqueta.d";
     |COPIA_FICHERO aOrg, aDes;
     aOrg = aDev + "mailing.d"; aDes = aPath + "mailing.d";
     |COPIA_FICHERO aOrg, aDes;

     |_PDIR aDev;
     |PARA; |SI FSalida = 0; |HACIENDO;
          aAlfa = aDev % -103;  aAlfa = aAlfa < "";
          |SI aAlfa = "inf";
               aAlfa = "";
               aLong = aDev % A0;
               |PARA i = aLong; |SI i ] 0; |HACIENDO i = i - 1;
                    nLong = (i*100) + 1;
                    aAlf1 = aDev % nLong;
                    |SI aAlf1 = "/"; |O aAlf1 = "\";
                         |SAL;
                    |FINSI;
                    aAlfa = aAlf1 + aAlfa;
               |SIGUE;
               aOrg = aDev;
               aDes = aPath + aAlfa;
               aDes = aDes < "";
               |COPIA_FICHERO aOrg, aDes;
          |FINSI;
          |_SDIR aDev;
     |SIGUE;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO CopiaImagen;
     |DBASE aPathImg;

     aOrg = #176#16; |QBF aOrg;
     aOrg = aPathImg + "recetas/" + aOrg;

     aImg = "";
     aLon = aOrg % A0;
     |PARA i = aLon; |SI i > 0; |HACIENDO i = i - 1;
          nPos =  (i * 100 + 1)
          aLetra = aOrg % nPos;
          |SI aLetra = "/"; |O aLetra = "\"; |SAL; |FINSI;
          aImg = aLetra + aImg;
     |SIGUE;

     aDes = aPath + aImg;
     aDes = aDes < "";
     |COPIA_FICHERO aOrg, aDes;
|FPRC;

|DEFBUCLE Imagenes;
     #176#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, CopiaImagen;
|FIN;

|PROCESO CopiaFichero;
     aAlfa = "exp" + (aFic % -105);

     aOrg = aSwPath + aAlfa + ".ixx";
     aDes = aPath + aAlfa + ".ixx";
     |COPIA_FICHERO aOrg, aDes;

     aOrg = aSwPath + aAlfa + ".ddx";
     aDes = aPath + aAlfa + ".ddx";
     |COPIA_FICHERO aOrg, aDes;

     aOrg = aSwPath + aAlfa + ".dat";
     aDes = aPath + aAlfa + ".dat";
     |COPIA_FICHERO aOrg, aDes;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO dsm00018;
     |PARA i = 0; |SI i [ nCampo2; |HACIENDO i = i + 1;
          #2i = #918i;
     |SIGUE;
     |GRABA 020#2n;
|FPRC;

|DEFBUCLE dsm00018;
     #918#1;
     ;
     aReceta, "IB", 001;
     aReceta, "IB", 999;
     ;
     NULL, dsm00018;
|FIN;

|PROCESO iber0076;
     |HAZ CopiaImagen;

     |PARA i = 0; |SI i [ nCampo1; |HACIENDO i = i + 1;
          #1i = #176i;
     |SIGUE;
     |GRABA 020#1n;

     #176#15 = "S";      ||Expo
     |GRABA 020#176a;
     |LIBERA #176;

     aReceta = ("000000" + #176#0) % -106;
     |BUCLE dsm00018;
|FPRC;

|DEFBUCLE iber0076;
     #176#1;
     15;
     000001, "N";
     999999, "N";
     be;
     NULL, iber0076;
|FIN;

|PROCESO iber0074;
     |PARA i = 0; |SI i [ nCampo1; |HACIENDO i = i + 1;
          #1i = #174i;
     |SIGUE;
     |GRABA 020#1n;
|FPRC;

|DEFBUCLE iber0074;
     #174#1;
     ;
     #16#0, 01, 01;
     #16#0, 99, 99;
     ;
     NULL, iber0074;
|FIN;

|PROCESO iber0064;
     |PARA i = 0; |SI i [ nCampo2; |HACIENDO i = i + 1;
          #2i = #164i;
     |SIGUE;
     |GRABA 020#2n;
|FPRC;

|PROCESO iber0063;
     |PARA i = 0; |SI i [ nCampo1; |HACIENDO i = i + 1;
          #1i = #163i;
     |SIGUE;
     |GRABA 020#1n;
|FPRC;

|DEFBUCLE iber0063;
     #163#1;
     ;
     #16#0;
     #16#0;
     ;
     NULL, iber0063, iber0064;
|FIN;

|PROCESO iber0070;
     |PARA i = 0; |SI i [ nCampo1; |HACIENDO i = i + 1;
          #1i = #170i;
     |SIGUE;
     |GRABA 020#1n;
|FPRC;

|DEFBUCLE iber0070;
     #170#1;
     ;
     #16#0, "     ", 0;
     #16#0, "zzzzz", 99;
     ;
     NULL, iber0070;
|FIN;

|PROCESO iber0067;
     |PARA i = 0; |SI i [ nCampo2; |HACIENDO i = i + 1;
          #2i = #167i;
     |SIGUE;
     |GRABA 020#2n;
|FPRC;

|DEFBUCLE iber0067;
     #167#1;
     ;
     #166#0, #166#1, #166#2, #166#3, "                    ", " ";
     #166#0, #166#1, #166#2, #166#3, "zzzzzzzzzzzzzzzzzzzz", "z";
     ;
     NULL, iber0067;
|FIN;

|PROCESO iber0066;
     |PARA i = 0; |SI i [ nCampo1; |HACIENDO i = i + 1;
          #1i = #166i;
     |SIGUE;
     |GRABA 020#1n;
     |BUCLE iber0067;
|FPRC;

|DEFBUCLE iber0066;
     #166#1;
     ;
     #16#0, 01, 01, "01.01.0000";
     #16#0, 99, 99, "31.12.9999";
     ;
     NULL, iber0066, iber0067;
|FIN;

|PROCESO iber0069;
     |PARA i = 0; |SI i [ nCampo2; |HACIENDO i = i + 1;
          #2i = #169i;
     |SIGUE;
     |GRABA 020#2n;
|FPRC;

|PROCESO iber0068;
     |PARA i = 0; |SI i [ nCampo1; |HACIENDO i = i + 1;
          #1i = #168i;
     |SIGUE;
     |GRABA 020#1n;
|FPRC;

|DEFBUCLE iber0068;
     #168#1;
     ;
     #16#0;
     #16#0;
     ;
     NULL, iber0068, iber0069;
|FIN;

|PROCESO iber0056;
     |PARA i = 0; |SI i [ nCampo1; |HACIENDO i = i + 1;
          #1i = #56i;
     |SIGUE;
     |GRABA 020#1n;
|FPRC;

|DEFBUCLE iber0056;
     #56#1;
     ;
     #16#0, 01, "     ";
     #16#0, 99, "zzzzz";
     ;
     NULL, iber0056;
|FIN;

|PROCESO agifa024;
     #24#175 = "S";
     #24#176 = fFecha;
     |GRABA 020#24a;

     |PARA i = 0; |SI i [ nCampo1; |HACIENDO i = i + 1;
          #1i = #24i;
     |SIGUE;
     |GRABA 020#1n;
|FPRC;

|DEFBUCLE agifa024;
     #24#1;
     175;
     "      ", "N";
     "zzzzzz", "N";
     be;
     NULL, agifa024;
|FIN;

|PROCESO agifa019;
     #18#0 = #16#0;
     #18#1 = #19#0;
     |LEE 000#18=;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |PARA i = 0; |SI i [ nCampo1; |HACIENDO i = i + 1;
          #1i = #19i;
     |SIGUE;
     |SI #18#10 = 1; nPvp = #19#18; |FINSI;
     |SI #18#10 = 2; nPvp = #19#19; |FINSI;
     |SI #18#10 = 3; nPvp = #19#20; |FINSI;
     |SI #18#10 = 4; nPvp = #19#147; |FINSI;
     |SI #18#10 = 5; nPvp = #19#148; |FINSI;
     |SI #18#10 = 6; nPvp = #19#149; |FINSI;
     #1#18 = nPvp;
     #1#19 = 0; #1#20 = 0; #1#147 = 0; #1#148 = 0;#1#149 = 0;

     |GRABA 020#1n;
|FPRC;

|DEFBUCLE agifa019;
     #19#1;
     ;
     "                    ";
     "zzzzzzzzzzzzzzzzzzzz";
     be;
     NULL, agifa019;
|FIN;

|PROCESO agifa112;
     #102#0 = #16#0;
     #102#2 = #112#0;
     |LEE 000#102=;
     |SI FSalida ! 0;
          #164#0 = #16#0;
          #164#2 = #112#0;
          |LEE 000#164=;
          |SI FSalida ! 0; |ACABA; |FINSI;
     |FINSI;

     |PARA i = 0; |SI i [ nCampo1; |HACIENDO i = i + 1;
          #1i = #112i;
     |SIGUE;
     |GRABA 020#1n;
|FPRC;

|DEFBUCLE agifa112;
     #112#1;
     ;
     "      ";
     "zzzzzz";
     be;
     NULL, agifa112;
|FIN;

|PROCESO iber0017;
     |PARA i = 0; |SI i [ nCampo1; |HACIENDO i = i + 1;
          #1i = #117i;
     |SIGUE;
     |GRABA 020#1n;
|FPRC;

|DEFBUCLE iber0017;
     #117#1;
     ;
     #16#0;
     #16#0;
     ;
     NULL, iber0017;
|FIN;

|PROCESO iber0018;
     |PARA i = 0; |SI i [ nCampo1; |HACIENDO i = i + 1;
          #1i = #118i;
     |SIGUE;
     |GRABA 020#1n;
|FPRC;

|DEFBUCLE iber0018;
     #118#1;
     ;
     #16#0, "                    ";
     #16#0, "zzzzzzzzzzzzzzzzzzzz";
     ;
     NULL, iber0018;
|FIN;

|PROCESO iber0019;
     |PARA i = 0; |SI i [ nCampo1; |HACIENDO i = i + 1;
          #1i = #119i;
     |SIGUE;
     |GRABA 020#1n;
|FPRC;

|DEFBUCLE iber0019;
     #119#1;
     ;
     #16#0, 01;
     #16#0, 99;
     ;
     NULL, iber0019;
|FIN;

|PROCESO iber0020;
     |PARA i = 0; |SI i [ nCampo1; |HACIENDO i = i + 1;
          #1i = #120i;
     |SIGUE;
     |GRABA 020#1n;
|FPRC;

|DEFBUCLE iber0020;
     #120#1;
     ;
     #16#0, 01, "                    ";
     #16#0, 99, "zzzzzzzzzzzzzzzzzzzz";
     ;
     NULL, iber0020;
|FIN;

|PROCESO iber0001;
     |PARA i = 0; |SI i [ nCampo1; |HACIENDO i = i + 1;
          #1i = #101i;
     |SIGUE;
     |GRABA 020#1n;
|FPRC;

|DEFBUCLE iber0001;
     #101#1;
     ;
     #16#0;
     #16#0;
     ;
     NULL, iber0001;
|FIN;

|PROCESO iber0002;
     |PARA i = 0; |SI i [ nCampo1; |HACIENDO i = i + 1;
          #1i = #102i;
     |SIGUE;
     |GRABA 020#1n;
|FPRC;

|DEFBUCLE iber0002;
     #102#1;
     ;
     #16#0, 01;
     #16#0, 99;
     ;
     NULL, iber0002;
|FIN;

|PROCESO iber0016;
     |PARA i = 0; |SI i [ nCampo1; |HACIENDO i = i + 1;
          #1i = #16i;
     |SIGUE;
     |GRABA 020#1n;
|FPRC;

|PROCESO agifa505;
     |PARA i = 0; |SI i [ nCampo1; |HACIENDO i = i + 1;
          #1i = #505i;
     |SIGUE;
     |GRABA 020#1n;
|FPRC;

|DEFBUCLE agifa505;
     #505#1;
     ;
     nDCaja;
     nHCaja;
     ;
     NULL, agifa505;
|FIN;

|PROCESO agifa067;
     |PARA i = 0; |SI i [ nCampo2; |HACIENDO i = i + 1;
          #2i = #67i;
     |SIGUE;
     |GRABA 020#2n;
|FPRC;

|PROCESO agifa081;
     #81#22 = "S";
     #81#23 = fFecha;
     |GRABA 020#81a;
     |PARA i = 0; |SI i [ nCampo1; |HACIENDO i = i + 1;
          #1i = #81i;
     |SIGUE;
     |GRABA 020#1n;
|FPRC;

|DEFBUCLE agifa081;
     #81#1
     22;
     #16#11, 000001, "N";
     #16#11, 999999, "N";
     be;
     NULL, agifa081, agifa067;
|FIN;

|PROCESO agifa048;
     #18#0 = #16#0;
     #18#1 = #480#0;
     |LEE 000#18=;
     |SI FSalida ! 0; |ACABA; |FINSI;
     |SI #18#7 = "N"; |ACABA; |FINSI;

     #999#1 = #480#0;
     |GRABA 020#999n;
|FPRC;

|DEFBUCLE agifa048;
     #480#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, agifa048;
|FIN;

|PROCESO LinEscan;
     #480#0 = #49#0;
     |LEE 000#480=;

     |PARA i = 0; |SI i [ nCampo1; |HACIENDO i = i + 1;
          #1i = #480i;
     |SIGUE;
     |SI nNivelEscan > 1;
          #1#10 = #16#14;
     |SINO;
          #1#10 = #16#15;
     |FINSI;
     |GRABA 000#1n;

     |PARA i = 0; |SI i [ nCampo2; |HACIENDO i = i + 1;
          #2i = #49i;
     |SIGUE;
     #2#9 = #16#14;
     |GRABA 000#2n;
|FPRC;

|PROCESO Tmp999;
     aEscan = #999#1;
     |HAZ DesglosaEscan;
|FPRC;

|DEFBUCLE Tmp999;
     #999#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Tmp999;
|FIN;

|PROCESO agifa007;
     |PARA i = 0; |SI i [ nCampo1; |HACIENDO i = i + 1;
          #1i = #7i;
     |SIGUE;
     |GRABA 020#1n;
|FPRC;

|DEFBUCLE agifa007;
     #7#1;
     ;
     aDSer;
     aHSer;
     ;
     NULL, agifa007;
|FIN;

|PROCESO agifa029;
     |PARA i = 0; |SI i [ nCampo1; |HACIENDO i = i + 1;
          #1i = #29i;
     |SIGUE;
     |GRABA 020#1n;
|FPRC;

|DEFBUCLE agifa029;
     #29#1;
     ;
     nDAlma;
     nHAlma;
     ;
     NULL, agifa029;
|FIN;

|PROCESO iber0040;
     |PARA i = 0; |SI i [ nCampo1; |HACIENDO i = i + 1;
          #1i = #40i;
     |SIGUE;
     |GRABA 020#1n;
|FPRC;

|DEFBUCLE iber0040;
     #40#1;
     ;
     #16#0, "        ";
     #16#0, "zzzzzzzz";
     ;
     NULL, iber0040;
|FIN;

|PROCESO iber0041;
     |PARA i = 0; |SI i [ nCampo1; |HACIENDO i = i + 1;
          #1i = #41i;
     |SIGUE;
     |GRABA 020#1n;
|FPRC;

|DEFBUCLE iber0041;
     #41#1;
     ;
     #16#0, 01;
     #16#0, 99;
     ;
     NULL, iber0041;
|FIN;

|PROCESO iber0101;
     |PARA i = 0; |SI i [ nCampo1; |HACIENDO i = i + 1;
          #1i = #1001i;
     |SIGUE;
     |GRABA 020#1n;
|FPRC;

|DEFBUCLE iber0101;
     #1001#1;
     ;
     #16#0, 00001;
     #16#0, 99999;
     ;
     NULL, iber0101;
|FIN;

|PROCESO iber0113;
     |PARA i = 0; |SI i [ nCampo1; |HACIENDO i = i + 1;
          #1i = #113i;
     |SIGUE;
     |GRABA 020#1n;
|FPRC;

|DEFBUCLE iber0113;
     #113#1;
     ;
     #16#0, "      ", "                    ", "     ";
     #16#0, "zzzzzz", "zzzzzzzzzzzzzzzzzzzz", "zzzzz";
     ;
     NULL, iber0113;
|FIN;

|DEFBUCLE iber0113Cero;
     #113#1;
     ;
     0, "      ", "                    ", "     ";
     0, "zzzzzz", "zzzzzzzzzzzzzzzzzzzz", "zzzzz";
     ;
     NULL, iber0113;
|FIN;
|DEFBUCLE iber0113Nueve;
     #113#1;
     ;
     999, "      ", "                    ", "     ";
     999, "zzzzzz", "zzzzzzzzzzzzzzzzzzzz", "zzzzz";
     ;
     NULL, iber0113;
|FIN;

컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO Centros;
     aPath = #142#150; |QBF aPath;
     aAlfa = ("000" + #16#0) % -103;
     aPath = aPath + aAlfa + "/";
     |MKDIR aPath;
     ||컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
     |ABRE #18;
     aFic = "agifa019";
     |HAZ CargaDef;
     |SI FSalida = 0;
          |HAZ NomeDat;
          |BUCLE agifa019;
          |HAZ DescargaDef;
     |FINSI;
     |CIERRA #18;
     ||컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
     |ABRE #102;
     |ABRE #164;
     |SELECT #2#102;
     |SELECT #2#164;
     aFic = "agifa112";
     |HAZ CargaDef;
     |SI FSalida = 0;
          |HAZ NomeDat;
          |BUCLE agifa112;
          |HAZ DescargaDef;
     |FINSI;
     |CIERRA #102;
     |CIERRA #164;
     ||컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
     aFic = "iber0017";
     |HAZ CargaDef;
     |SI FSalida = 0;
          |HAZ NomeDat;
          |BUCLE iber0017;
          |HAZ DescargaDef;
     |FINSI;
     ||컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
     aFic = "iber0018";
     |HAZ CargaDef;
     |SI FSalida = 0;
          |HAZ NomeDat;
          |BUCLE iber0018;
          |HAZ DescargaDef;
     |FINSI;
     ||컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
     aFic = "iber0019";
     |HAZ CargaDef;
     |SI FSalida = 0;
          |HAZ NomeDat;
          |BUCLE iber0019;
          |HAZ DescargaDef;
     |FINSI;
     ||컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
     aFic = "iber0020";
     |HAZ CargaDef;
     |SI FSalida = 0;
          |HAZ NomeDat;
          |BUCLE iber0020;
          |HAZ DescargaDef;
     |FINSI;
     ||컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
     aFic = "iber0001";
     |HAZ CargaDef;
     |SI FSalida = 0;
          |HAZ NomeDat;
          |BUCLE iber0001;
          |HAZ DescargaDef;
     |FINSI;
     ||컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
     aFic = "iber0002";
     |HAZ CargaDef;
     |SI FSalida = 0;
          |HAZ NomeDat;
          |BUCLE iber0002;
          |HAZ DescargaDef;
     |FINSI;
     ||컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
     aFic = "iber0016";
     |HAZ CargaDef;
     |SI FSalida = 0;
          |HAZ NomeDat;
          |HAZ iber0016;
          |HAZ DescargaDef;
     |FINSI;
     ||컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
     aFic = "agifa505";
     |HAZ CargaDef;
     |SI FSalida = 0;
          nDCaja = #16#0 * 100;
          nHCaja = #16#0 * 100 + 99;
          |HAZ NomeDat;
          |BUCLE agifa505;
          |HAZ DescargaDef;
     |FINSI;
     ||컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
     aFic = "agifa081";
     |HAZ CargaDef;
     |SI FSalida = 0;
          aFic2 = "agifa067";
          |HAZ CargaDef2;
          |SI FSalida = 0;
               |HAZ NomeDat;
               |HAZ NomeDat2;
               |BUCLE agifa081;
               |HAZ DescargaDef2;
          |FINSI;
          |HAZ DescargaDef;
     |FINSI;
     ||컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
     aAlfa = Usuario; |QBF aAlfa;
     |NOME_DAT #999 aAlfa;
     |DELINDEX #999;

     |ABRE #18;
     |ABRE #999;
     |BUCLE agifa048;
     |CIERRA #999;
     |CIERRA #18;

     |ABRE #480;
     aFic = "agifa048";
     |HAZ CargaDef;
     |SI FSalida = 0;
          aFic2 = "agifa049";
          |HAZ CargaDef2;
          |SI FSalida = 0;
               |HAZ NomeDat;
               |HAZ NomeDat2;
               |BUCLE Tmp999;
               |HAZ DescargaDef2;
          |FINSI;
          |HAZ DescargaDef;
     |FINSI;
     |CIERRA #480;

     |DELINDEX #999;
     ||컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
     aFic = "agifa007";
     |HAZ CargaDef;
     |SI FSalida = 0;
          aDSer = (("000" + #16#0) % -103) + "  ";
          aHSer = (("000" + #16#0) % -103) + "zz";
          |HAZ NomeDat;
          |BUCLE agifa007;
          |HAZ DescargaDef;
     |FINSI;
     ||컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
     aFic = "agifa029";
     |HAZ CargaDef;
     |SI FSalida = 0;
          nDAlma = #16#0 * 100;
          nHAlma = #16#0 * 100 + 99;
          |HAZ NomeDat;
          |BUCLE agifa029;
          |HAZ DescargaDef;
     |FINSI;
     ||컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
     aFic = "iber0040";
     |HAZ CargaDef;
     |SI FSalida = 0;
          |HAZ NomeDat;
          |BUCLE iber0040;
          |HAZ DescargaDef;
     |FINSI;
     ||컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
     aFic = "iber0041";
     |HAZ CargaDef;
     |SI FSalida = 0;
          |HAZ NomeDat;
          |BUCLE iber0041;
          |HAZ DescargaDef;
     |FINSI;
     ||컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
     aFic = "iber0101";
     |HAZ CargaDef;
     |SI FSalida = 0;
          |HAZ NomeDat;
          |BUCLE iber0101;
          |HAZ DescargaDef;
     |FINSI;
     ||컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
     aFic = "iber0056";
     |HAZ CargaDef;
     |SI FSalida = 0;
          |HAZ NomeDat;
          |BUCLE iber0056;
          |HAZ DescargaDef;
     |FINSI;
     ||컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
     aFic = "iber0066";
     |HAZ CargaDef;
     |SI FSalida = 0;
          aFic2 = "iber0067";
          |HAZ CargaDef2;
          |SI FSalida = 0;
               |HAZ NomeDat;
               |HAZ NomeDat2;
               |BUCLE iber0066;
               |HAZ DescargaDef2;
          |FINSI;
          |HAZ DescargaDef;
     |FINSI;
     ||컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
     aFic = "iber0068";
     |HAZ CargaDef;
     |SI FSalida = 0;
          aFic2 = "iber0069";
          |HAZ CargaDef2;
          |SI FSalida = 0;
               |HAZ NomeDat;
               |HAZ NomeDat2;
               |BUCLE iber0068;
               |HAZ DescargaDef2;
          |FINSI;
          |HAZ DescargaDef;
     |FINSI;
     ||컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
     aFic = "iber0070";
     |HAZ CargaDef;
     |SI FSalida = 0;
          |HAZ NomeDat;
          |BUCLE iber0070;
          |HAZ DescargaDef;
     |FINSI;
     ||컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
     aFic = "iber0063";
     |HAZ CargaDef;
     |SI FSalida = 0;
          aFic2 = "iber0064";
          |HAZ CargaDef2;
          |SI FSalida = 0;
               |HAZ NomeDat;
               |HAZ NomeDat2;
               |BUCLE iber0063;
               |HAZ DescargaDef2;
          |FINSI;
          |HAZ DescargaDef;
     |FINSI;
     ||컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
     aFic = "iber0074";
     |HAZ CargaDef;
     |SI FSalida = 0;
          |HAZ NomeDat;
          |BUCLE iber0074;
          |HAZ DescargaDef;
     |FINSI;
     ||컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
     aFic = "iber0113";
     |HAZ CargaDef;
     |SI FSalida = 0;
          |HAZ NomeDat;
          |BUCLE iber0113;
          |BUCLE iber0113Cero;
          |BUCLE iber0113Nueve;
          |HAZ DescargaDef;
     |FINSI;
     ||컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
     |SI aSwPath = "";               || La primera
          aFic = "agifa024";
          |HAZ CargaDef;
          |SI FSalida = 0;
               |HAZ NomeDat;
               |BUCLE agifa024;
               |HAZ DescargaDef;
          |FINSI;

          aFic = "iber0076";
          |HAZ CargaDef;
          |SI FSalida = 0;
               aFic2 = "dsm00018";
               |HAZ CargaDef2;
               |SI FSalida = 0;
                    |HAZ NomeDat;
                    |HAZ NomeDat2;
                    |BUCLE iber0076;
                    |HAZ DescargaDef2;
               |FINSI;
               |HAZ DescargaDef;
          |FINSI;
          aSwPath = aPath;
     |SINO;                           || Las otras los copio
          aFic = "agifa024"; |HAZ CopiaFichero;
          aFic = "dsm00018"; |HAZ CopiaFichero;
          |PATH_DAT #918 aPath;
          |NOME_DAT #918 aAlfa;

          aFic = "iber0076"; |HAZ CopiaFichero;
          |PATH_DAT #176 aPath;
          |NOME_DAT #176 aAlfa;

          |BUCLE Imagenes;
     |FINSI;
     ||컴컴컴컴컴컴컴컴컴컴컴컴
     |HAZ Auxiliares;
     |HAZ Definibles;
|FPRC;

|DEFBUCLE Centros;
     #16#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Centros;
|FIN;

컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
  El Nombre del Fichero:  yymmdd + empresa + "." + Linea Histo
           digitos....   Fecha(6)   (5)             (3)
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO UltHistorico;
     #100#0 = "E";
     #100#6 = #16#0;
     #100#1 = fFecha;
     #100#2 = 999;
     |LEE 000#100];
     |SI FSalida = 0;
          |LEE 000#100a;
     |SINO;
          |LEE 000#100u;
     |FINSI;
     |SI FSalida = 0; |Y #100#0 = "E"; |Y #100#6 = #16#0; |Y #100#1 = fFecha;
          nLin = #100#2 + 1;
     |SINO;
          nLin = 1;
     |FINSI;
|FPRC;

|PROCESO Paquete;
     aPath = #142#150; |QBF aPath;
     aAlfa = ("000" + #16#0) % -103;
     aPath = aPath + aAlfa + "/";

     |ABRE #100;
     |HAZ UltHistorico;

     |DFICE aEmp;
     aEmp = aEmp % -205;

     aFic = (fFecha % -102) + (fFecha % 402) + (fFecha % 102);

     aAlfa = ("000" + nLin) % -103;
     aTar = aFic + aEmp + "." + aAlfa;    ||->Nombre del Fichero

     a1 = aPath + aTar + " *.dat *.ixx *.ddx *.jpg lis*.* *.inf *.d";
     a2 = aPath;
     |ATAR a1, a2;

     a1 = aPath + aTar;
     |COMPRIME a1;
     |FBORRA a1;
     a2 = aPath + aFic + aEmp + ".gz";
     |RENOMBRA_FICHERO a2, a1;

     aFic = aPath + aTar;
     |XABRE "E", aFic, 0;
     |SI FSalida ! 0;
          aAlfa = "0000No puede compactar... " + aTar;
          |MENAV aAlfa;
          aTar = "ERROR EN TAR";
     |SINO;
          aFic = aPath;
          |_PDIR aFic;
          |PARA; |SI FSalida = 0; |HACIENDO;
               aAlfa = aFic % -103;  aAlfa = aAlfa < "";
               aAlf1 = aFic % -1003; aAlf1 = aAlf1 < "";
               aAlf2 = aFic % -102;  aAlf1 = aAlf1 < "";
               |SI aAlfa = "ddx"; |O aAlfa = "ixx"; |O aAlfa = "dat";
                         |O aAlfa = "jpg"; |O aAlfa = "inf"; |O aAlf1 = "lis";
                         |O aAlf2 = ".d";
                    |SI aAlfa = "jpg"; |O aAlf1 = "lis"; |O aAlf2 = ".d";
                              |O aAlfa = "inf";
                         |FBORRA aFic;
                    |SINO;
                         aAlfa = aFic % -1102;
                         |SI aAlfa = "ex"; |FBORRA aFic; |FINSI;
                    |FINSI;
               |FINSI;
               |_SDIR aFic;
          |SIGUE;
     |FINSI;

     |HORA aAlfa;
     |DDEFECTO #100;
     #100#0 = "E";
     #100#1 = fFecha;
     #100#2 = nLin;
     #100#3 = aAlfa;
     #100#4 = Usuario % 810;
     #100#5 = aTar;
     #100#6 = #16#0;
     |GRABA 020#100n;
     |CIERRA #100;

     aDele = #16#0 + "00";
     |DDEFECTO #204;
     #204#0 = aDele;
     |LEE 000#204=;

     |DDEFECTO #75;
     #75#0 = #16#0;
     #75#1 = #16#1;
     #75#2 = "*";
     #75#3 = #204#3;
     #75#4 = aPath + aTar;
     |GRABA 020#75n;
     nSwExp = 1;
|FPRC;

|DEFBUCLE Paquete;
     #16#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Paquete;
|FIN;

|PROCESO Tipo3; |TIPO 3;
     |SI #0#0 = "NO"; |ACABA; |FINSI;

     |SI #0#1 = "S";
          |HAZ Chequea;
          |SI enSwCheq ! 0;
               aAlfa = "0000NERROR en Productos." + &13 + "쭰esea Continuar?";
               |CONFI aAlfa;
               |SI FSalida ! 0; |ACABA; |FINSI;
          |FINSI;
     |FINSI;

     |HAZ DecimalesBase;

     fFecha = ~;
     |ABRE #142; |LEE 000#142p; |CIERRA #142;
     aPath = #142#150; |QBF aPath;
     |SI aPath = "";
          |MENAV "0000Directorio no indicado....";
     |SINO;
          |BUCLE Centros;
          |BUCLE Paquete;
     |FINSI;
|FPRC;

|PROGRAMA;
     |HAZ CreaTempo; aTempo75 = Tempo;
     |NOME_DAT #75 aTempo75; |DELINDEX #75;

     |ABRE #75;
     |ABRE #204;
     |SI aParam ! "";
          #0#0 = "SI";
          |HAZ Tipo3;
     |SINO;
          |MANTE #0;
     |FINSI;
     |CIERRA #204;
     |CIERRA #75;

     |SI nSwExp ! 0;
          aAlfa = "iber0075;" + aTempo75;
          |SUB_EJECUTA_NP aAlfa;          ||Envio correo
     |FINSI;

     |DELINDEX #75; Tempo = aTempo75; |HAZ BoraTempo;
|FPRO;
