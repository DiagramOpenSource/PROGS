          Modulo 000845   Alba Distribucion

|FICHEROS;
     agifa007 #7;
     agifa010 #10;
     agifa019 #19;
     agifa024 #24;
     tmp00071 #71;
     tmp00010 #100;
     agifa077 #77;
     referen@;
     refere1@;
|FIN;

|VARIABLES;
     &enSwRecalAlb = 0;
     aSerSinRec = "";
     &ser_alb = "";
     &num_alb = 0;
     &enForma = 0;

     &eaSerie = "";
     &enCodigo = 0;
     &enLinea = 0;
     &efFecha = @;
     &enPrecio = 0;
     &eaCliente = "";
     &eaArticulo = "";
     &eaDocu = "";

     &eaCam71_2 = "";
     &eaCam71_3 = "";
     &eaCam71_4 = "";
     &eaCam71_5 = "";
     &eaCam71_49 = "";

     nModo = 0;
     nHay = 0;
     aAlfa = "";
     aDef = "";
     aMarca = "";
     aInfor = "";
     aSerSin = "";
     aSerRegu = "";
     nLin = 0;
     nConta = 0;
     nDto = 0;
     nPrecio = 0;
     nSw = 0;
|FIN;

|PROCESO CargDefAlb;
     |DDEF aAlfa;
     aAlfa = aAlfa + aDef;
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida ! 0;
          aAlfa = "0000ERROR al cargar:" + aAlfa;
          |MENAV aAlfa;
     |FINSI;
|FPRC;

|PROCESO AlbaPideArt;
     aDef = "albad002";
     |HAZ CargDefAlb;
     |SI FSalida = 0;
          |DDEFECTO #referen@;
          |ABRE #referen@;
          #referen@#0 = #19#0;
          |LEE 101#referen@.=;
          |SI FSalida ! 0; |GRABA 020#referen@.b; |FINSI;
          |ENCAMPO #1#referen@;
          |GRABA 020#referen@.a;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|PROCESO AlbaPinArt;
     aDef = "albad002";
     |HAZ CargDefAlb;
     |SI FSalida = 0;
          |DDEFECTO #referen@;
          |ABRE #referen@;
          #referen@#0 = #19#0;
          |LEE 000#referen@.=;
          |CIERRA #referen@;
          |ATRI 0;
          |PINTA 725, "Ù  Producto GCC:                                  ³";
          |PINTA #referen@#1;
          |ATRI I;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|PROCESO AlbaBorArt;
     aDef = "albad002";
     |HAZ CargDefAlb;
     |SI FSalida = 0;
          |DDEFECTO #referen@;
          |ABRE #referen@;
          #referen@#0 = #19#0;
          |LEE 101#referen@.=;
          |SI FSalida = 0; |BORRA 020#referen@.a; |FINSI;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|PROCESO AlbaPideAlb;
     aDef = "albad003";
     |HAZ CargDefAlb;
     |SI FSalida = 0;
          |DDEFECTO #referen@;
          |ABRE #referen@;
          #referen@#0 = #10#52;
          #referen@#1 = #10#0;
          |LEE 101#referen@.=;
          |SI FSalida ! 0; |GRABA 020#referen@.b; |FINSI;
          nModo = (FEntrada / 100) ! 0;
          |SI nModo = 1;
               |ENCAMPO #2#referen@;
               |GRABA 020#referen@.a;
          |FINSI;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|PROCESO AlbaPinAlb;
     aDef = "albad003";
     |HAZ CargDefAlb;
     |SI FSalida = 0;
          |DDEFECTO #referen@;
          |ABRE #referen@;
          #referen@#0 = #10#52;
          #referen@#1 = #10#0;
          |LEE 000#referen@.=;
          |CIERRA #referen@;
          |ATRI 0;
          |PINTA 933, "Obs: ";
          |PINTA #referen@#2;
          |ATRI I;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|PROCESO AlbaBorAlb;
     aDef = "albad003";
     |HAZ CargDefAlb;
     |SI FSalida = 0;
          |DDEFECTO #referen@;
          |ABRE #referen@;
          #referen@#0 = #10#52;
          #referen@#1 = #10#0;
          |LEE 101#referen@.=;
          |SI FSalida = 0; |Y #referen@#4 = 0;   ||Si hay movi regu.
               |BORRA 020#referen@.a;            ||se borra al borra las lineas
          |FINSI;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
     aDef = "albad037";
     |HAZ CargDefAlb;
     |SI FSalida = 0;
          |ABRE #referen@;
          #referen@#17 = #10#52;
          #referen@#0 = #10#0;
          #referen@#1 = 1;
          |BORRA 040#referen@.c;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|PROCESO AlbaPideAlbC;
     aDef = "albad004";
     |HAZ CargDefAlb;
     |SI FSalida = 0;
          |DDEFECTO #referen@;
          |ABRE #referen@;
          #referen@#0 = #77#50;
          #referen@#1 = #77#0;
          |LEE 101#referen@.=;
          |SI FSalida ! 0; |GRABA 020#referen@.b; |FINSI;
          |ENCAMPO #3#referen@;
      |ET OtroCli;
          |ENCAMPO #2#referen@;
          |SI FSalida = 13;        || F5;
               |ABRE #24;
               #24#0 = #referen@#2;
               |LEE 000#24];
               |CONSULTA_CLAVE #1#24;
               |SI FSalida = 0;
                    #referen@#2 = #24#0;
               |FINSI;
               |CIERRA #24;
               |VETE OtroCli;
          |FINSI;
          |GRABA 020#referen@.a;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|PROCESO AlbaPinAlbC;
     aDef = "albad004";
     |HAZ CargDefAlb;
     |SI FSalida = 0;
          |DDEFECTO #referen@;
          |ABRE #referen@;
          #referen@#0 = #77#50;
          #referen@#1 = #77#0;
          |LEE 000#referen@.=;
          |CIERRA #referen@;
          |ATRI 0;
          |PINTA 1131, "Ù Pedido Numero:             Cliente:           ³";
          |PINTA #referen@#2;
          |PINTA #referen@#3;
          |ATRI I;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|PROCESO AlbaBorAlbC;
     aDef = "albad004";
     |HAZ CargDefAlb;
     |SI FSalida = 0;
          |DDEFECTO #referen@;
          |ABRE #referen@;
          #referen@#0 = #77#50;
          #referen@#1 = #77#0;
          |LEE 101#referen@.=;
          |SI FSalida = 0; |BORRA 020#referen@.a; |FINSI;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|PROCESO LineasAlb;
     |DDEFECTO #19;
     #19#0 = #71#2;
     |LEE 000#19=;

     |SI nSw = 1; || Chequeo
          |SI #71#63 = -1; |Y aMarca = #19#126;
               nHay = 1;
          |FINSI;
     |SINO;       || Impresion
          |SI #71#63 = -1; |Y aMarca = #19#126;
               |PRINT;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE LineasAlb;
     #71#1;
     ;
     ser_alb, num_alb, 001;
     ser_alb, num_alb, 999;
     ;
     NULL, LineasAlb;
|FIN;

|PROCESO AlbaImpAlb;
     aDef = "albad001";
     |HAZ CargDefAlb;
     |SI FSalida = 0;
          |ABRE #referen@;
          |LEE 000#referen@.p;
          |CIERRA #referen@;
          aMarca = #referen@#1;
          |DESCARGA_DEF #referen@
     |FINSI;
     nHay = 0;
     nSw = 1;
     |ABRE #19;
     |BUCLE LineasAlb;
     |SI nHay ! 0;
          aInfor = #7#22; |QBF aInfor;
          |INFOR aInfor;
          |SI FSalida = 0;
               nSw = 2;
               |BUCLE LineasAlb;
               |PIEINF;
               |FININF;
          |SINO;
               |MENAV "0000No existe informe promocion...";
          |FINSI;
     |FINSI;
     |CIERRA #19;
|FPRC;


|PROCESO AlbaSinMovi;
     aDef = "albad001";
     |HAZ CargDefAlb;
     |SI FSalida = 0;
          |ABRE #referen@;
          |LEE 000#referen@.p;
          |CIERRA #referen@;
          aSerSin = #referen@#3;
          aSerRegu = #referen@#5;
          |DESCARGA_DEF #referen@
     |FINSI;
     aDef = "albad003";
     |HAZ CargDefAlb;
     |SI FSalida = 0;
          |DDEFECTO #referen@;
          |ABRE #referen@;
          #referen@#0 = #10#52;
          #referen@#1 = #10#0;
          |LEE 000#referen@.=;
          |CIERRA #referen@;
          |SI #referen@#2 = "S"; |O aSerSin = #10#52;
               eaSerie = #71#29;
               enCodigo = #71#0;
               enLinea  = #71#1;
               efFecha = #10#1;
               eaCam71_2 = #71#2;
               eaCam71_3 = #71#3;
               eaCam71_4 = #71#4;
               eaCam71_5 = #71#5;
               eaCam71_49 = #71#49;
               |SUB_EJECUTA_NP "albad006";
          |FINSI;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|PROCESO HazRec;
     |DDEFECTO #referen@;
     #referen@#17 = #10#52;
     #referen@#0 = #10#0;
     #referen@#1 = 1;
     |LEE 101#referen@.=;
     |SI FSalida ! 0; |GRABA 021#referen@.b; |FINSI;
     |ABRE #24;
     |DDEFECTO #24;
     #24#0 = #10#3;
     |LEE 000#24=;
     |CIERRA #24;
     #referen@#2 = #10#3; ||cliente
     #referen@#3 = #10#4; ||nombre del cliente
     #referen@#4 = #24#29; ||banco
     #referen@#5 = "S"; ||domiciliado
     #referen@#6 = "N"; ||aceptado
     #referen@#7 = #10#1; ||fecha de emision
     #referen@#8 = #10#1; ||fecha de vencimiento
     #referen@#9 = 0;
     #referen@#9 = #10#16 + #10#19 + #10#22 + #10#28 + #10#44 + #10#47 + #10#17; ||importe
     #referen@#9 = #referen@#9 + #10#18 + #10#20 + #10#21 + #10#23 + #10#54 + #10#45; ||importe
     #referen@#9 = #referen@#9 + #10#46 + #10#48 + #10#49; ||importe
     #referen@#10 = "N"; ||Impreso;
     #referen@#11 = "N"; ||Contabilizado;
     #referen@#12 = #24#16; ||numero contable
     #referen@#13 = "N"; ||Cobrado
     #referen@#14 = "N"; ||Impagado
     #referen@#15 = #24#161; ||A aceptar;
     #referen@#16 = "01.01.0000"; ||fecha de cobro
     |GRABA 021#referen@.a;
|FPRC;

|PROCESO BorraRec;
     |BORRA 020#refere1@.a;
|FPRC;

|DEFBUCLE BorraRec;
     #refere1@#1004;
     ;
     #referen@#17, #referen@#0, #referen@#1, 001;
     #referen@#17, #referen@#0, #referen@#1, 999;
     be;
     NULL, BorraRec;
|FIN;

|PROCESO AlbaRecAlb;
     aDef = "albad001";
     |HAZ CargDefAlb;
     |SI FSalida = 0;
          |ABRE #referen@; |LEE 000#referen@.p; |CIERRA #referen@;
          aSerSinRec = #referen@#6;
          |DESCARGA_DEF #referen@
     |FINSI;
     |SI eaSerie = aSerSinRec; |ACABA; |FINSI;

     |ABRE #10;
     #10#52 = eaSerie;
     #10#0 = enCodigo;
     |LEE 020#10=;
     |SI FSalida ! 0; |ACABA; |FINSI;
     |CIERRA #10;
     |SI #10#51 ! "S"; |ACABA; |FINSI;
     aDef = "albad037";
     |HAZ CargDefAlb;
     |SI FSalida = 0;
          |ABRE #referen@;
          #referen@#17 = #10#52;
          #referen@#0 = #10#0;
          #referen@#1 = 1;
          |LEE 101#referen@.=;
          |SI FSalida = 0;
               |SI enSwRecalAlb = 1; || cuando lo llama albap022
                    FSalida = 0;
               |SINO;
                    |AVISO;
                    aAlfa = "0000Recibos del albaran '" + #10#52 + "/" + (("000000" + #10#0) % -106) + "' Existentes";
                    |MENSA aAlfa;
                    aAlfa = "0000NDesea Regenerar Los Recibos?";
                    |CONFI aAlfa;
               |FINSI;
               |SI FSalida = 0;
                    |BORRA 020#referen@.a;
                    |DDEF aDef;
                    aDef = aDef + "albad038";
                    |CARGA_DEF aDef, refere1@;
                    |SI FSalida = 0;
                         |BUCLE BorraRec;
                         |DESCARGA_DEF #refere1@;
                    |FINSI;
                    |HAZ HazRec;
               |FINSI;
          |SINO;
               |HAZ HazRec;
          |FINSI;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@
     |FINSI;
|FPRC;
