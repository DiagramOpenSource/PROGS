|FICHEROS;
     dsy00011 #0;
     agifa010 #10;
     agifa019 #19;
     agifa071 #71;
     agifa073 #73;
     agifa104 #104;
     agifa134 #134;
     agifa142 #142;

     rodm0001@;     || Modulo Rodacal

     dsw00075 #75;  ||Tmp
|FIN;

|VARIABLES;
     nHayFac = 0;
     nGrabar = 0;
     aInf = "";
     aAlfa = "";
     aEmpresa = "";
     nDias = 0;
     nHay = 0;
     nSwRodacal = 0;
     aEmpAnt = "";
     nPendiente = 0;
     nPendiente2 = 0;
     aDPrv = "";
     aHPrv = "";
|FIN;

|PROCESO Temporal;
     |PRINT;
     nHay = 1;
|FPRC;

|DEFBUCLE Temporal7;
     #75#8;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Temporal;
|FIN;

|DEFBUCLE Temporal6;
     #75#7;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Temporal;
|FIN;

|DEFBUCLE Temporal5;
     #75#6;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Temporal;
|FIN;

|DEFBUCLE Temporal4;
     #75#5;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Temporal;
|FIN;

|DEFBUCLE Temporal3;
     #75#4;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Temporal;
|FIN;

|DEFBUCLE Temporal2;
     #75#3;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Temporal;
|FIN;

|DEFBUCLE Temporal1;
     #75#2;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Temporal;
|FIN;

|PROCESO LinAlba;
     |DDEFECTO #10;
     #10#52 = #71#29;
     #10#0 = #71#0;
     |LEE 000#10=;

     |SI #10#38 = "S";
          #134#49 = #10#53;
          #134#0 = #10#39;
          |LEE 000#134=;
          nHayFac = FSalida;
     |FINSI;

     |SI #0#16 = "P";
          |SI #75#11 [ #10#1;      || Se queda con el ultimo Alba
               #75#4 = #10#52;
               #75#5 = #10#0;
               #75#11 = #10#1;     ||F.Alb
               |SI nHayFac = 0;
                    #75#13 = #134#1;    ||F.Fac
               |FINSI;
          |FINSI;
     |SINO;
          |SI #75#11 [ #10#1;      || Se queda con el ultimo Alba
               #75#4 = #71#29;
               #75#5 = #71#0;
               #75#6 = #71#1;
               #75#11 = #10#1;     ||F.Alb
               |SI nHayFac = 0;
                    #75#13 = #134#1;    ||F.Fac
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE LinAlba;
     #71#4;
     ;
     #73#28, #73#0, #73#1;
     #73#28, #73#0, #73#1;
     ;
     NULL, LinAlba;
|FIN;

|PROCESO LinPedido;
     |SI #73#2 < #0#11; |O #73#2 > #0#12;
          |ACABA; ||Articulo
     |FINSI;

     |DDEFECTO #19;
     #19#0 = #73#2;
     |LEE 000#19=;

     |SI #0#13 = "S"; |O #0#13 = "P";
          nPendiente = #73#5 - #73#43;
          nPendiente2 = #73#44 - #73#49;
          |SI #19#179 = "N"; |O #142#117 = "N";||Sin Doble Stock
               |SI #0#13 = "S";
                    |SI nPendiente ! 0; nGrabar = 0; |ACABA; |FINSI;
               |SINO;
                    |SI #73#43 = 0; nGrabar = 0; |ACABA; |FINSI;
               |FINSI;
          |SINO;
               |SI #0#13 = "S";
                    |SI #142#224 = "B";
                        |SI nPendiente ! 0; |O nPendiente2 ! 0; nGrabar = 0; |ACABA; |FINSI;
                    |SINO;
                        |SI nPendiente ! 0; |Y nPendiente2 ! 0; nGrabar = 0; |ACABA; |FINSI;
                    |FINSI;
               |SINO;
                    |SI #73#43 = 0; |Y #73#49 = 0; nGrabar = 0; |ACABA; |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;

     |SI #0#16 = "P";
          nGrabar = 1;
          |BUCLE LinAlba;
     |SINO;
          |DDEFECTO #75;
          #75#0 = aEmpresa;
          #75#1 = #73#28;
          #75#2 = #73#0;
          #75#3 = #73#1;

          #75#7 = #104#4;     ||Cli
          #75#8 = #73#2;      ||Art
          #75#9 = #104#1;     ||F.Ped
          #75#10 = #73#13;    ||F.Prev.
          #75#14 = #104#7;    ||Repre
          #75#16 = #104#59;
          #75#17 = #75#16 % 102;
          |BUCLE LinAlba;
          nDias = 0;
          |SI #75#11 ! "01.01.0000";
               nDias = #75#11 - #75#10;
          |FINSI;
          #75#12 = nDias;
          |GRABA 020#75n;
     |FINSI;
|FPRC;

|PROCESO FinPed;
     |SI #0#16 = "P"; |Y nGrabar = 1;
          #75#0 = aEmpresa;
          #75#1 = #104#25;
          #75#2 = #104#0;
          #75#7 = #104#4;
          #75#9 = #104#1;
          #75#10 = #104#2;
          #75#16 = #104#59;
          #75#17 = #75#16 % 102;
          nDias = 0;
          |SI #75#11 ! "01.01.0000";
               nDias = #75#11 - #75#10;
          |FINSI;
          #75#12 = nDias;
          |GRABA 020#75n;
     |FINSI;
|FPRC;

|PROCESO Pedido;
     |DDEFECTO #75;
     nGrabar = 1;
|FPRC;

|DEFBUCLE Pedido;
     #104#2;
     1, 7, 59;
     #0#4, #0#0, #0#2, #0#6, #0#8, aDPrv;
     #0#5, #0#1, #0#3, #0#7, #0#9, aHPrv;
     ;
     NULL, Pedido, LinPedido, FinPed;
|FIN;

|PROCESO EmpreRodacal;
     |DDEF aAlfa;
     aAlfa = aAlfa + "rodm0001";
     |CARGA_DEF aAlfa, rodm0001@;
     |SI FSalida = 0;
          |ABRE #rodm0001@;
          |LEE 000#rodm0001@.p;
          |CIERRA #rodm0001@;
          aEmpresa = ("00000" + #rodm0001@#1) % -105;
          |DESCARGA_DEF #rodm0001@;
     |FINSI;
|FPRC;

|PROCESO ProcRodacal;
     aEmpAnt = aEmpresa;
     |HAZ EmpreRodacal;
     |SI aEmpAnt = aEmpresa; |ACABA; |FINSI; ||Si es la misma

     |DBASE aAlfa;
     aAlfa = aAlfa + "fich/" + aEmpresa + "/";
     |PATH_DAT #10 aAlfa;
     |PATH_DAT #71 aAlfa;
     |PATH_DAT #73 aAlfa;
     |PATH_DAT #104 aAlfa;
     |PATH_DAT #134 aAlfa;

     |ABRE #75;
     |ABRE #10;
     |ABRE #134;
     |ABRE #19;
     |BUCLE Pedido;
     |CIERRA #19;
     |CIERRA #134;
     |CIERRA #10;
     |CIERRA #75;
|FPRC;

|PROCESO TipoInf; |TIPO 0;
     |SI #0#16 = "P";
          |C_M #0#11, 1, "N";
          |C_M #0#12, 1, "N";
     |SINO;
          |C_M #0#11, 1, "S";
          |C_M #0#13, 1, "S";
     |FINSI;
|FPRC;

|PROCESO Tipo3; |TIPO 3;
     |ABRE #142; |LEE 000#142p; |CIERRA #142;

     |HAZ EsRodacal;
     nSwRodacal = FSalida;

     |DFICE aEmpresa;
     aEmpresa = aEmpresa % -205;

     aDPrv = (("00" + #0#14) % -102) + "   ";
     aHPrv = (("00" + #0#15) % -102) + "zzz";

     |SI #0#10 = 7;
          |SI #0#16 = "P";
               aInf = "dsx70011";
          |SINO;
               aInf = "dsy70011";
          |FINSI;
     |SINO;
          |SI #0#16 = "P";
               aInf = "dsx00011";
          |SINO;
               aInf = "dsy00011";
          |FINSI;
     |FINSI;

     |IMPRE 0;
     |SI FSalida = 0;
          |INFOR aInf;
          |SI FSalida = 0;
               aAlfa = Usuario;
               |NOME_DAT #75 aAlfa;
               |DELINDEX #75;
               |ABRE #75;
               |ABRE #10;
               |ABRE #134;
               |ABRE #19;
               |BUCLE Pedido;
               |CIERRA #19;
               |CIERRA #134;
               |CIERRA #10;
               |CIERRA #75;
               |SI nSwRodacal = 0; || Modulo a Medida;
                    |HAZ ProcRodacal;
               |FINSI;
               |SI #0#10 = 1; |BUCLE Temporal1; |FINSI;
               |SI #0#10 = 2; |BUCLE Temporal2; |FINSI;
               |SI #0#10 = 3; |BUCLE Temporal3; |FINSI;
               |SI #0#10 = 4; |BUCLE Temporal4; |FINSI;
               |SI #0#10 = 5; |BUCLE Temporal5; |FINSI;
               |SI #0#10 = 6; |BUCLE Temporal6; |FINSI;
               |SI #0#10 = 7; |BUCLE Temporal7; |FINSI;
               |SI nHay = 0;
                    |MENAV "0000Seleccion vacia...";
               |SINO;
                    |PIEINF;
               |FINSI;
               |DELINDEX #75;
               |FININF;
          |SINO;
               aAlfa =  "0000No existe informe " + aInf;
               |MENAV aAlfa;
          |FINSI;
          |FINIMP;
     |FINSI;
|FPRC;
