     || Carga Proformas modulo:004030


|FICHEROS;
     agifa501 #0;
     agifa502@ #1;
     agifa019 #19;
     agifa024 #24;
     agifa146 #146;
     agifa147 #147;
     referen@;
|FIN;

|VARIABLES;
     &eaSerPro = "";
     &enNumPro = 0;
     nHay = 0;
     aAlfa = "";
|FIN;

|PROCESO Proforma;
     |SI #146#83 ! "R";
          nHay = 1;
          |SALVA_DATOS #146;
          |REPON_DATOS #referen@;
          |GRABA 020#referen@.n;
     |FINSI;
|FPRC;

|DEFBUCLE Proforma;
     #146#3;
     ;
     "      ";
     "      ";
     ;
     NULL, Proforma;
|FIN;

|PROCESO Cajero7; |TIPO 7;
     |MENSA "0000Introduzca N§ de Cajero Personal.";
     |HAZ EsAparecida;
     |SI FSalida = 0;
          |MENSA "0000<F9> Recoger factura proforma";
          eaSerPro = "";
          enNumPro = 0;
     |FINSI;
|FPRC;

|PROCESO Cajero0; |TIPO 0;
     |SI FSalida = 17;
          |HAZ EsAparecida;
          |SI FSalida = 0;
               |DDEF aAlfa;
               aAlfa = aAlfa + "agifa146";
               |CARGA_DEF aAlfa, referen@;
               |SI FSalida = 0;
                    aAlfa = Usuario % 810;
                    |NOME_DAT #referen@#aAlfa#;
                    |DELINDEX #referen@;

                    nHay = 0;
                    |ABRE #referen@;
                    |BUCLE Proforma;
                    |SI nHay ! 0;
                         |LEE 000#referen@.p;
                         |CONSULTA_CLAVE #1#referen@;
                         |SI FSalida = 0;
                              eaSerPro = #referen@#48;
                              enNumPro = #referen@#0;
                              #0#1 = #referen@#3; |PINTA #0#1;
                         |SINO;
                              eaSerPro = "";
                              enNumPro = 0;
                         |FINSI;
                    |SINO;
                         |MENAV "0000No existen proformas pendientes de asignar...";
                    |FINSI;
                    |CIERRA #referen@;
                    |ERROR;

                    |DELINDEX #referen@;
                    |DESCARGA_DEF #referen@;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO CargaLinPro;
     |DDEFECTO #19;
     #19#0 = #147#2;
     |LEE 000#19=;

     |DDEFECTO #1;
     #1#20 = #0#36;
     #1#0 = #0#0;
     #1#1 = #147#1;
     #1#2 = #147#2;
     #1#3 = #147#3;
     #1#4 = #0#1;
     #1#5 = #147#5;
     #1#8 = #147#4;
     #1#9 = #0#14;
     #1#10 = #147#6;
     #1#11 = #19#2;
     #1#12 = #19#3;
     #1#13 = #147#11;
     #1#14 = #147#8;
     #1#15 = #0#12;
     #1#17 = #0#33;
     #1#20 = #0#36;
     #1#22 = #19#128;
     #1#29 = #147#28;
     #1#30 = #147#29;
     #1#31 = #147#30;
     #1#32 = #147#31;
     #1#33 = #147#32;
     #1#34 = #147#33;
     |GRABA 020#1n;
|FPRC;

|PROCESO CargaProforma;
     |ABRE #146;
     #146#48 = eaSerPro;
     #146#0 = enNumPro;
     |LEE 101#146=;
     |SI FSalida = 0; |Y #146#61 = "      "; |Y #146#83 ! "R";
          |DDEF aAlfa;
          aAlfa = aAlfa + "agifa502";
          |CARGA_DEF aAlfa, agifa502@;
          |SI FSalida = 0;
               |ABRE #1;
               |ABRE #19;
               |BUCLELIN 0 CargaLinPro #146;
               |CIERRA #19;
               |CIERRA #1;
               |GRABA 020#146a;
               |DESCARGA_DEF #agifa502@;
          |FINSI;
     |SINO;
          eaSerPro = "";
          enNumPro = 0;
     |FINSI;
     |CIERRA #146;
|FPRC;

|PROCESO GrabaSerPro;
     |SI eaSerPro ! "";
          |ABRE #146;
          #146#48 = eaSerPro;
          #146#0 = enNumPro;
          |LEE 101#146=;
          |SI FSalida = 0;
               #146#60 = #0#57;
               #146#61 = ("000000" + #0#58) % -106;
               #146#62 = "T";
               |GRABA 020#146a;
          |FINSI;
          |CIERRA #146;
          eaSerPro = "";
          enNumPro = 0;
     |FINSI;
|FPRC;
