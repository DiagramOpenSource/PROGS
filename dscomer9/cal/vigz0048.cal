alba0017

|FICHEROS;
vigz0048 #0;
agifa071 #1;
agifa010 #2;
agifa019 #3;
agifa025 #4;
vigw0025 #5;   ||Temporal.
agifa024 #6;
agifa134 #7;
agifa007;
vigm0043 #43;
|FIN;

|VARIABLES;
&Tempo = "";
mtpkg = 0;
nPta = 166.386;
&enMtKg = 0;
nZona = 0;
nTota = 0;
nRep = 0;
nPorZona = 0;
nPorTota = 0;
nPorRep = 0;
informe = "";
aSerie = "";
&zona     = "";
&repres   = "";
i         = 0;
sw        = 0;
&swlin    = 0;
&t1       = 0;
&t2       = 0;
&t3       = 0;
&t4       = 0;
&t5       = 0;
&t6       = 0;
&tr1      = 0;
&tr2      = 0;
&tr3      = 0;
&tr4      = 0;
&tr5      = 0;
&tr6      = 0;
&tt1      = 0;
&tt2      = 0;
&tt3      = 0;
&tt4      = 0;
&tt5      = 0;
&tt6      = 0;
|FIN;

|PROCESO EsInterno;
     |DDEFECTO #agifa007;
     #agifa007#26 = aSerie;
     |LEE 000#agifa007.=;

     |SI #agifa007#37 = "S";
          FSalida = 0;
     |SINO;
          FSalida = 1;
     |FINSI;
|FPRC;

|PROCESO &Suma;

|FPRC;

|CALCULO impresion;
     |DDEFECTO #6;
     #6#0 = #5#1;
     |LEE 000#6=;

     |SI sw = 0;
         sw = 1;
         repres  = #5#10;
         zona    = #5#0;
         swlin = 3;  ||Datos Representante
         |PRINT;
         swlin = 0;
         swlin = 2;  ||Datos Zona
         |PRINT;
         swlin = 0;
     |FINSI;

     |SI sw = 1;
         |SI repres ! #5#10;
             ||enMtKg = ((t4 / t2) * nPta) - ((nPorZona/nZona));
             enMtKg = nPorZona / t2;
             swlin = 1;   ||Totales Zona
             |PRINT;
             swlin = 0;
             ||enMtKg = ((tr4 / tr2) * nPta) - ((nPorRep/nRep));
             enMtKg = nPorRep / tr2;
             swlin = 4;   ||Totales Representante
             |PRINT;
             swlin = 0;
             |PIEINF;
             repres  = #5#10;
             zona    = #5#0;
             swlin = 3;   ||Datos Representante
             |PRINT;
             swlin = 0;
             swlin = 2;   ||Datos Zona
             |PRINT;
             swlin = 0;
             t1 = 0;
             t2 = 0;
             t3 = 0;
             t4 = 0;
             t5 = 0;
             t6 = 0;

             tr1 = 0;
             tr2 = 0;
             tr3 = 0;
             tr4 = 0;
             tr5 = 0;
             tr6 = 0;
             nRep = 0;
             nZona = 0;
             nPorRep = 0;
             nPorZona = 0;
         |FINSI;

         |SI zona ! #5#0;
             ||enMtKg = ((t4 / t2) * nPta) - ((nPorZona/nZona));
             enMtKg = nPorZona / t2;
             swlin = 1;  ||Totales Zona
             |PRINT;
             swlin = 0;
             zona = #5#0;
             swlin = 2;  ||Datos Zona
             |PRINT;
             swlin = 0;
             t1 = 0;
             t2 = 0;
             t3 = 0;
             t4 = 0;
             t5 = 0;
             t6 = 0;
             nZona = 0;
             nPorZona = 0;
         |FINSI;
     |FINSI;

     t1 = t1 + #5#4;
     t2 = t2 + #5#5;
     t3 = t3 + #5#6;
     t4 = t4 + #5#7;
     t5 = (t4 / t1) * 100;
     t6 = t3 / t2;

     tr1 = tr1 + #5#4;
     tr2 = tr2 + #5#5;
     tr3 = tr3 + #5#6;
     tr4 = tr4 + #5#7;
     tr5 = (tr4 / tr1) * 100;
     tr6 = tr3 / tr2;

     tt1 = tt1 + #5#4;
     tt2 = tt2 + #5#5;
     tt3 = tt3 + #5#6;
     tt4 = tt4 + #5#7;
     tt5 = (tt4 / tt1) * 100;
     tt6 = tt3 / tt2;

     nRep = nRep + 1;
     nZona = nZona + 1;
     nTota = nTota + 1;

     mtpkg = #5#7 * nPta;
     mtpkg = mtpkg / #5#5;
     mtpkg = mtpkg - #6#170;

     nPorRep = nPorRep + (mtpkg * #5#5);
     nPorZona = nPorZona + (mtpkg * #5#5);
     nPorTota = nPorTota + (mtpkg * #5#5);

     |PRINT;
|FCAL;

|DEFBUCLE impresion;
     #5#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, NULL, NULL, NULL, NULL, impresion;
     #5#10,#5#0,#5#3,#5#1;
|FIN;

|DEFBUCLE NueImpre;
     #5#2;
     ;
     INICIO;
     FINAL;
     ;
     NULL, impresion;
|FIN;

|CALCULO pasa_lin;
     |DDEFECTO #2;
     #2#52 = #1#29;
     #2#0 = #1#0;
     |LEE 000#2=;

     aSerie = #agifa010#52;
     |HAZ EsInterno;
     |SI FSalida = 0; |ACABA; |FINSI;

     |DDEFECTO #3;
     #3#0 = #1#2;
     |LEE 000#3=;

     |DDEFECTO #4;
     #4#0 = #2#6;
     |LEE 000#4=;

     |DDEFECTO #6;
     #6#0 = #2#3;
     |LEE 000#6=;

     |DDEFECTO #7;
     #7#0 = #2#39;
     #7#49 = #2#53;
     |LEE 000#7=;

     |SI #2#1 ] #0#3;|Y #2#1 [ #0#4;
        |SI #2#6 ] #0#7;|Y #2#6 [ #0#8;
            |SI #6#3 ] #0#9;|Y #6#3 [ #0#10;
                |SI #2#3 ] #0#11;|Y #2#3 [ #0#12;
                    |DDEFECTO #5;
                    #5#10 = #2#6;
                    #5#0  = #6#3;
                    #5#1  = #2#3;
                    |LEE 000#5=;
                    |SI FSalida ! 0; |GRABA 020#5b; |FINSI;
                    #5#2  = #6#1;
                    #5#3  = #6#6;
                    #5#4  = #5#4 + #1#9;
                    #5#5  = #5#5 + #1#5;
                    #5#6  = #5#6 + #1#14;
                    #5#7  = #5#4 - #5#6;
                    #5#8  = (#5#7 / #5#4) * 100;
                    #5#9  = #5#6 / #5#5;
                    #5#11 = (#5#7 * nPta / #5#5) - #6#170;
                    |GRABA 020#5a;
                    |LIBERA #5;
                |FINSI;
            |FINSI;
        |FINSI;
    |FINSI;
|FCAL;

|DEFBUCLE lee_lin;
     #1#1;
     2;
     #0#1 , 000001,  0, #0#13;
     #0#2 , 999999,999, #0#14;
     be;
     NULL,pasa_lin;
|FIN;

|PROCESO HistoTras;
     aSerie = #43#0;
     |HAZ EsInterno;
     |SI FSalida = 0; |ACABA; |FINSI;

     |DDEFECTO #3;
     #3#0 = #43#12;
     |LEE 000#3=;

     |DDEFECTO #4;
     #4#0 = #43#10;
     |LEE 000#4=;

     |DDEFECTO #6;
     #6#0 = #43#8;
     |LEE 000#6=;

     |SI #43#6 ] #0#3;|Y #43#6 [ #0#4;
        |SI #43#10 ] #0#7;|Y #43#10 [ #0#8;
            |SI #43#9 ] #0#9;|Y #43#9 [ #0#10;
                |SI #43#8 ] #0#11;|Y #43#8 [ #0#12;
                    |DDEFECTO #5;
                    #5#10 = #43#10;
                    #5#0  = #43#9;
                    #5#1  = #43#8;
                    |LEE 000#5=;
                    |SI FSalida ! 0; |GRABA 020#5b; |FINSI;
                    #5#2  = #6#1;
                    #5#3  = #6#6;
                    #5#4  = #5#4 + #43#15;
                    #5#5  = #5#5 + #43#13;
                    #5#6  = #5#6 + #43#16;
                    #5#7  = #5#4 - #5#6;
                    #5#8  = (#5#7 / #5#4) * 100;
                    #5#9  = #5#6 / #5#5;
                    #5#11 = (#5#7 * nPta / #5#5) - #6#170;
                    |GRABA 020#5a;
                    |LIBERA #5;
                |FINSI;
            |FINSI;
        |FINSI;
    |FINSI;
|FPRC;

|DEFBUCLE HistoTras;
     #43#1;
     12;
     #0#1, 000001, 001, #0#13;
     #0#2, 999999, 999, #0#14;
     ;
     NULL, HistoTras;
|FIN;

|CALCULO alba0017;|TIPO 3;
     |SI #0#5 ! "SI"; |ACABA; |FINSI;

     |HAZ CreaTempo; |NOME_DAT #5 Tempo; |DELINDEX #5;
     |IMPRE 0;
     |SI FSalida = 0;
          |SI #0#16 = "S";
               informe = "vigza048";
          |SINO;
               |SI #0#15 = "S";
                    informe = "vigzc048";
               |SINO;
                    informe = "vigz0048";
               |FINSI;
          |FINSI;
          |INFOR informe;
          |SI FSalida = 0;
               |ABRE #agifa007;
               |ABRE #2;
               |ABRE #3;
               |ABRE #4;
               |ABRE #5;
               |ABRE #6;
               |ABRE #7;
               |BUCLE lee_lin;
               |BUCLE HistoTras;
               |CIERRA #7;
               |CIERRA #6;
               |CIERRA #5;
               |CIERRA #4;
               |CIERRA #3;
               |CIERRA #2;
               |CIERRA #agifa007;
               |ABRE #6;
               |SI #0#16 = "S";
                    |BUCLE NueImpre;
               |SINO;
                    |BUCLE impresion;
               |FINSI;
               |CIERRA #6;
               ||enMtKg = ((t4 / t2) * nPta) - ((nPorZona/nZona));
               enMtKg = nPorZona / t2;
               swlin = 1;  ||Totales Zona
               |PRINT;
               swlin = 0;
               ||enMtKg = ((tr4 / tr2) * nPta) - ((nPorRep/nRep));
               enMtKg = nPorRep / tr2;
               swlin = 4;  ||Totales Representante
               |PRINT;
               swlin = 0;
               |PIEINF;
               ||enMtKg = ((tt4 / tt2) * nPta) - ((nPorTota/nTota));
               enMtKg = nPorTota / tt2;
               swlin = 10;
               |PIEINF;
               swlin = 0;
               |FININF;
          |FINSI;
          |FINIMP;
     |FINSI;
     |HAZ BoraTempo; |DELINDEX #5;
|FCAL;
