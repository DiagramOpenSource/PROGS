|FICHEROS;
     iber0211 #0;
     agifa067 #1;
     agifa67@ #67;       ||CARGA_DEF agifa067

     iber0016 #16;       ||Centro Ventas

     agifa048 #248;      ||Escandallos Cabs.
     agifa48@ #148;      ||Escandallos Cabs. CARGA_DEF
     agifa049 #249;      ||Escandallos Lins.
     agifa49@ #149;      ||Escandallos Lins. CARGA_DEF

     iber004@ #4;        ||Pedidos Central (L)
|FIN;

|VARIABLES;
     &eaDocu  = "";
     aMensaje = "";
     &eaPathEjecuta = "";
     aPath = "";
     aFic67 = "";
     aFic48 = "";
     aFic49 = "";
     aFic04 = "";
     aPathDatos = "";
     &enForma  = 0;
     aAlfa = "";
     nCampo2 = 0;
     i = 0;
     aDatos67 = "";
     aDatos48 = "";
     aDatos49 = "";
     aDatos04 = "";
     nHandle = 0;
     aPathEmp = "";
     aAlmLin = "";
     aAlmCab = "";
     aCentro = "";
     aEmpresa = "";
|FIN;

|PROCESO agifa049;
     #agifa049#0 = #agifa49@#0;
     #agifa049#1 = #agifa49@#1;
     |LEE 101#agifa049.=;
     |SI FSalida = 0;
          #agifa049#9 = aAlmLin;
          |GRABA 020#agifa049.a;
          |LIBERA #agifa049;
     |FINSI;
|FPRC;

|DEFBUCLE agifa49;
 #agifa49@#1002;
 ;
 #agifa48@#0,   1;
 #agifa48@#0, 999;
 ;
 NULL, agifa049;
|FIN;

|PROCESO agifa048;
     #agifa048#0 = #agifa48@#0;
     |LEE 101#agifa048.=;
     |SI FSalida = 0;
          |BUCLE agifa49;
          #agifa048#10 = aAlmCab;
          |GRABA 020#agifa048.a;
          |LIBERA #agifa048;
     |FINSI;
|FPRC;

|DEFBUCLE agifa48;
 #agifa48@#1001;
 ;
 "                    ";
 "zzzzzzzzzzzzzzzzzzzz";
 ;
 NULL, agifa048;
|FIN;

|PROCESO agifa067;
     |PARA i = 0; |SI i [ nCampo2; |HACIENDO i = i + 1;
          #agifa067#i# = #agifa67@#i#;
     |SIGUE;
     |LEE 000#agifa067.=;
     |SI FSalida = 0;
          enForma = 1;
          eaDocu = "agifa067";
          |HAZ StockEntra;
     |FINSI;
|FPRC;

|DEFBUCLE agifa67;
 #agifa67@#1003;
 ;
 "     ", 000001, 001;
 "zzzzz", 999999, 999;
 ;
 NULL, agifa067;
|FIN;

|PROCESO iber0004;
     |SI #iber004@#8 ! 0;          ||Numero Pedido
          #agifa067#28 = #iber004@#7;
          #agifa067#0 = #iber004@#8;
          #agifa067#1 = #iber004@#2;
          |LEE 000#agifa067.=;
          |SI FSalida = 0;
               enForma = -1;
               eaDocu = "agifa067";
               |HAZ StockEntra;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE iber0004;
 #iber004@#1003;
 ;
     1, "01.01.0001",  001;
 99999, "31.12.9999",  999;
 ;
 NULL, iber0004;
|FIN;

|PROGRAMA;
     aPathDatos = eaPathEjecuta;
     |QBF aPathDatos;

     |DFICE aPathEmp;
     aEmpresa = aPathEmp % -106;
     aEmpresa = aEmpresa % 105;
     aCentro = aEmpresa % 103;

     aDatos67 = aPathDatos + "agifa067.dat";
     |XABRE "E", aDatos67, nHandle;
     |SI FSalida = 0;
          |DBASE aPath;
          |QBF aPath;
          aFic67 = aPath + "def/agifa067";
          |CARGA_DEF aFic67, agifa67@;
          |SI FSalida = 0;
               |PATH_DAT #67 aPathDatos;
               aAlfa = "|NC";
               aAlfa = #agifa67@#aAlfa#;
               nCampo2 = aAlfa;
               nCampo2 = nCampo2 - 1;
               |ABRE #agifa067;
               |BUCLE agifa67;
               |CIERRA #agifa067;
               |DESCARGA_DEF #agifa67@;
          |SINO;
               aMensaje = "0000Problemas CARGA_DEF " + aFic67;
               ||MENAV aMensaje;
          |FINSI;
     |FINSI;

     aDatos48 = aPathDatos + "agifa048.dat";
     |XABRE "E", aDatos48, nHandle;
     |SI FSalida = 0;
          |DBASE aPath;
          |QBF aPath;
          aFic48 = aPath + "def/agifa048";
          |CARGA_DEF aFic48, agifa48@;
          |SI FSalida = 0;
               |PATH_DAT #148 aPathDatos;
               aFic49 = aPath + "def/agifa049";
               |CARGA_DEF aFic49, agifa49@;
               |SI FSalida = 0;
                    |PATH_DAT #149 aPathDatos;
                    |ABRE #agifa048;
                    |ABRE #agifa049;
                    |ABRE #iber0016;
                    #iber0016#0 = aCentro;
                    |LEE 000#iber0016.=;
                    |SI FSalida = 0;
                         aAlmLin = #iber0016#14;
                         aAlmCab = #iber0016#15;
                    |SINO;
                         aAlmLin = #iber0016#14;
                         aAlmCab = #iber0016#15;
                    |FINSI;
                    |CIERRA #iber0016;
                    |BUCLE agifa48;
                    |CIERRA #agifa048;
                    |CIERRA #agifa049;
                    |DESCARGA_DEF #agifa49@;
                    |DESCARGA_DEF #agifa48@;
               |SINO;
                    aMensaje = "0000Problemas CARGA_DEF " + aFic48;
                    ||MENAV aMensaje;
                    |DESCARGA_DEF #agifa48@;
               |FINSI;
          |SINO;
               aMensaje = "0000Problemas CARGA_DEF " + aFic48;
               ||MENAV aMensaje;
          |FINSI;
     |FINSI;


     aDatos04 = aPathDatos + "iber0004.dat";
     |XABRE "E", aDatos04, nHandle;
     |SI FSalida = 0;
          |DBASE aPath;
          |QBF aPath;
          aFic04 = aPath + "def/iber0004";
          |CARGA_DEF aFic04, iber004@;
          |SI FSalida = 0;
               |PATH_DAT #4 aPathDatos;
               |ABRE #agifa067;
               |BUCLE iber0004;
               |CIERRA #agifa067;
               |DESCARGA_DEF #iber004@;
          |SINO;
               aMensaje = "0000Problemas CARGA_DEF " + aFic04;
               ||MENAV aMensaje;
          |FINSI;
     |FINSI;
|FPRO;
