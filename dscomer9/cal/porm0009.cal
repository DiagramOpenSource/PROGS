|FICHEROS;
     porm0009 #0;   || pantalla de presentacion
     porm0010 #1,MANTE;  || temporal de grupos de descuento con datos
     porm0011 #2,MANTE;  || temporal de grupos de descuento
     agifa024 #24;  || clientes
     porm0003 #3;   || clientes nuevos
     marhup09 #10;  || maximo descuento cliente
     marhup07 #11;  || grupos de descuento
     agifa129 #12;  || tabla descuento comision
     porconrp #17;  || cabecera control representante
     agifa025 #23;  || representantes

|FIN;

|VARIABLES;
     aAutonomo ="";
     aCadena="";
     nCero=0;
     aParametro="";
     &aClienteSuper="";

     nBotonx1=0;
     nBotonx2=0;
     nBotonx3=0;
     nBotonx4=0;
     nBotonx5=0;
     nBotonx6=0;
     nBotonx7=0;
     nBotonx8=0;
     nBotonx9=0;
     nBotonx10=0;

     aTitulo="";
     nMaximo=0;
|FIN;


|PROCESO GrabaMaximoDescuento;
     |ABRE #10;
     #10#0=#0#0;  || cliente
     #10#3=#1#0;  || grupo
     |LEE 101#10=;
     |SI FSalida=0;
          #10#2=nMaximo;
          |GRABA 020#10a;
     |FINSI;
     |LIBERA #10;
     |CIERRA #10;

     |ABRE #1;
     #1#0=#2#0;
     |LEE 101#1=;
     #1#3="N";
     #1#6="N";
     #1#9="N";
     #1#12="N";
     #1#15="N";
     #1#18="N";
     #1#21="N";

     |SI nMaximo=1;
          #1#3="S";
     |FINSI;
     |SI nMaximo=2;
          #1#6="S";
     |FINSI;
     |SI nMaximo=3;
          #1#9="S";
     |FINSI;
     |SI nMaximo=4;
          #1#12="S";
     |FINSI;
     |SI nMaximo=5;
          #1#15="S";
     |FINSI;
     |SI nMaximo=6;
          #1#18="S";
     |FINSI;
     |SI nMaximo=7;
          #1#21="S";
     |FINSI;


     |GRABA 020#1a;
     |LIBERA #1;
     |CIERRA #1;
     |PINDA #0#1;
|FPRC;


|PROCESO PulsaS1;
     nMaximo=1;
     |HAZ GrabaMaximoDescuento;
     |PULSATECLA;
|FPRC;

|PROCESO PulsaS2;
     nMaximo=2;
     |HAZ GrabaMaximoDescuento;
|FPRC;

|PROCESO PulsaS3;
     nMaximo=3;
     |HAZ GrabaMaximoDescuento;
|FPRC;

|PROCESO PulsaS4;
     nMaximo=4;
     |HAZ GrabaMaximoDescuento;
|FPRC;

|PROCESO PulsaS5;
     nMaximo=5;
     |HAZ GrabaMaximoDescuento;
|FPRC;

|PROCESO PulsaS6;
     nMaximo=6;
     |HAZ GrabaMaximoDescuento;
|FPRC;

|PROCESO PulsaS7;
     nMaximo=7;
     |HAZ GrabaMaximoDescuento;
|FPRC;

|PROCESO PulsaSubir;
     |PTEC 808;
|FPRC;

|PROCESO PulsaBajar;
     |PTEC 809;
|FPRC;

|PROCESO PulsaSalir;
     |PTEC 807;
|FPRC;


|PROCESO PonBotones;
     aTitulo="BOTON,Seleccionar";
     |CONTROL_SIMPLE 0, aTitulo, 1303, 1313, PulsaS1;
     nBotonx1 = FSalida;
     |CONTROL_SIMPLE 0, aTitulo, 1403, 1413, PulsaS2;
     nBotonx2 = FSalida;
     |CONTROL_SIMPLE 0, aTitulo, 1503, 1513, PulsaS3;
     nBotonx3 = FSalida;
     |CONTROL_SIMPLE 0, aTitulo, 1603, 1613, PulsaS4;
     nBotonx4 = FSalida;
     |CONTROL_SIMPLE 0, aTitulo, 1703, 1713, PulsaS5;
     nBotonx5 = FSalida;
     |CONTROL_SIMPLE 0, aTitulo, 1803, 1813, PulsaS6;
     nBotonx6 = FSalida;
     |CONTROL_SIMPLE 0, aTitulo, 1903, 1913, PulsaS7;
     nBotonx7 = FSalida;

     |CONTROL_SIMPLE 0,"BOTON,Subir", 1567, 1573, PulsaSubir;
     nBotonx8 = FSalida;
     |CONTROL_SIMPLE 0,"BOTON,Bajar", 1767, 1773, PulsaBajar;
     nBotonx9 = FSalida;

     |CONTROL_SIMPLE 0,"BOTON,Volver", 2515, 2525, PulsaSalir;
     nBotonx10 = FSalida;

|FPRC;

|PROCESO QuitaBotones;
     |FIN_CONTROL_WINDOWS nBotonx1;
     |FIN_CONTROL_WINDOWS nBotonx2;
     |FIN_CONTROL_WINDOWS nBotonx3;
     |FIN_CONTROL_WINDOWS nBotonx4;
     |FIN_CONTROL_WINDOWS nBotonx5;
     |FIN_CONTROL_WINDOWS nBotonx6;
     |FIN_CONTROL_WINDOWS nBotonx7;
     |FIN_CONTROL_WINDOWS nBotonx8;
     |FIN_CONTROL_WINDOWS nBotonx9;
     |FIN_CONTROL_WINDOWS nBotonx10;
     |PULSATECLA;
|FPRC;


|PROCESO PonDatosClienteA;
     |ABRE #24;
     #24#0=aClienteSuper;
     |LEE 000#24=;
     |SI FSalida=nCero;
          #0#0=#24#0;
          #0#1=#24#1;
     |FINSI;
     |CIERRA #24;
|FPRC;

|PROCESO PonDatosClienteN;
     |ABRE #3;
     #3#0=aClienteSuper;
     |LEE 000#3=;
     |SI FSalida=nCero;
          #0#0=#3#0;
          #0#1=#3#2;
     |FINSI;
     |CIERRA #3;
|FPRC;

|PROCESO PGruposCliente;
     #1#0=#10#3;
     #11#0 = #10#3;
     |LEE 000#11=;
     |SI aAutonomo = "S";
               #12#0 = #11#3;
     |SINO;
               #12#0 = #11#2;
     |FINSI;
     |LEE 000#12=;
     #1#1=#12#1; #1#2=#12#2; #1#3="N";
     #1#4=#12#3; #1#5=#12#4; #1#6="N";
     #1#7=#12#5; #1#8=#12#6; #1#9="N";
     #1#10=#12#7; #1#11=#12#8; #1#12="N";
     #1#13=#12#9; #1#14=#12#10; #1#15="N";
     #1#16=#12#11; #1#17=#12#12; #1#18="N";
     #1#19=#12#13; #1#20=#12#14; #1#21="N";

     |SI #10#2=1;
          #1#3="S";
     |FINSI;
     |SI #10#2=2;
          #1#6="S";
     |FINSI;
     |SI #10#2=3;
          #1#9="S";
     |FINSI;
     |SI #10#2=4;
          #1#12="S";
     |FINSI;
     |SI #10#2=5;
          #1#15="S";
     |FINSI;
     |SI #10#2=6;
          #1#18="S";
     |FINSI;
     |SI #10#2=7;
          #1#21="S";
     |FINSI;


     |GRABA 020#1n;

     #2#0=#10#3;
     #2#1=#10#4;
     |GRABA 020#2n;
|FPRC;

|DEFBUCLE BGruposCliente;
     #10#1;
     ;
     #0#0,"  ";
     #0#0,"zz";
     ;
     NULL,PGruposCliente;
|FIN;


|PROCESO BuscaGruposCliente;
     |DELINDEX #1;
     |DELINDEX #2;
     |ABRE #1;
     |ABRE #2;
     |ABRE #10;
     |ABRE #11;
     |ABRE #12;
     |BUCLE BGruposCliente;
     |CIERRA #12;
     |CIERRA #11;
     |CIERRA #10;
     |CIERRA #2;
     |CIERRA #1;
|FPRC;

|PROCESO PAnyadeRestantes;
     #10#0=#0#0;
     #10#3=#11#0;
     |LEE 101#10=;
     |SI FSalida!0;  || si no existe este grupo-cliente, se crea
          |DDEFECTO #10;
          #10#0=#0#0;  || codigo cliente
          #10#3=#11#0; || grupo
          #10#1=#0#1;  || nombre
          #10#2=1;     || maximo
          #10#4=#11#1;
          |GRABA 020#10n;
     |SINO;
          #10#4=#11#1;   || refresca la descripcion
          |GRABA 020#10a;
     |FINSI;
     |LIBERA #10;
|FPRC;

|DEFBUCLE BAnyadeRestantes;
     #11#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL,PAnyadeRestantes;
|FIN;


|PROCESO AnyadeGruposRestantes;
     |ABRE #10;
     |BUCLE BAnyadeRestantes;
     |LIBERA #10;
     |CIERRA #10;
|FPRC;

|PROCESO min;
     #2#0="  ";
|FPRC;

|PROCESO max;
     #2#0="zz";
|FPRC;



|PROGRAMA;
     |HAZ RepresAutonomo;
     aParametro=PARAMETRO;

     |SI aParametro="porm0001a";
          |HAZ PonDatosClienteA;
          |PINPA #0#0;
          |PINDA #0#0;
     |FINSI;

     |SI aParametro="porm0001n";
          |HAZ PonDatosClienteN;
          |PINPA #0#0;
          |PINDA #0#0;
     |FINSI;

     |HAZ AnyadeGruposRestantes; || a¤ade los grupos que le faltan

     |HAZ BuscaGruposCliente;  || crea temporal

     |HAZ PonBotones;
     |ENTLINEAL #1#2,1,4,22,0,min,max;
     |HAZ QuitaBotones;
|FPRO;

|PROCESO RepresAutonomo;
     |ABRE #17;
     |LEE 000#17p;
     |SI FSalida = 0;
          |DDEFECTO #23;
          |ABRE #23;
          #23#0 = #17#0;
          |LEE 000#23=;
          aAutonomo = #23#57;
          |CIERRA #23;
     |SINO;
          aAutonomo = "N";
     |FINSI;
     |CIERRA #17;
|FPRC;
