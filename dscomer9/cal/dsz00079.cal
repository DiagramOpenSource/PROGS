|FICHEROS;
     dsz00079 #0;
     agifa017 #17;
     vipem018 #18;
     agifa019 #19;
     dsm00120 #120;
     dsm00121 #121;
     agifa065 #65;
     agifa501 #501;
|FIN;

|VARIABLES;
     &efFecha1 = @;
     &efFecha2 = @;
     fFecha = @;
     aExiste = "N";
     nConta = 0;
|FINSI;

|PROCESO Antes; |TIPO 0;
     |ABRE #120;
     #120#0 = #0#0;
     |LEE 000#120=;
     |SI FSalida ! 0;
          |MENAV "0000No existe el recuento anterior.";
          |ERROR;
     |FINSI;
     |CIERRA #120;
|FPRC;

|PROCESO Ahora; |TIPO 0;
     |ABRE #120;
     #120#0 = #0#1;
     |LEE 000#120=;
     |SI FSalida ! 0;
          |MENAV "0000No existe el recuento actual.";
     |FINSI;
     |CIERRA #120;
|FPRC;

|PROCESO Final;
     |SI #18#31 = "N";
          #18#13 = #18#7 + #18#8 + #18#9 - #18#10 - #18#11;
     |SINO;
          #18#12 = #18#7 + #18#8 + #18#9 - #18#14 - #18#10;
          #18#9 = #18#13 - (#18#7 + #18#8 - #18#10 - #18#11);
     |FINSI;
     |GRABA 020#18a;
     |LIBERA #18;
|FPRC;

|DEFBUCLE Final;
     #18#2;
     ;
     "                    ", #0#1, 00000;
     "zzzzzzzzzzzzzzzzzzzz", #0#1, 99999;
     be;
     NULL, Final;
|FIN;

|PROCESO Historico;
     #18#1 = #65#5;
     #18#3 = #0#1;
     #18#4 = #65#0;
     |LEE 101#18=;
     |SI FSalida = 0;
          |SI #65#2 = "AC"; |O #65#2 = "EV"; |O #65#2 = "BC";
               #18#8 = #18#8 + #65#6;
          |FINSI;
          |SI #65#2 = "TI";
               |DDEFECTO #501;
               #501#35 = "T";
               #501#57 = #65#11;
               #501#58 = #65#3;
               |LEE 000#501=;
               |SI #501#31 = "R";
                    #18#10 = #18#10 - #65#6;
               |SINO;
                    #18#11 = #18#11 - #65#6;
               |FINSI;
          |FINSI;
          |SI #65#2 = "AV"; |O #65#2 = "BV"; |O #65#2 = "FC";
               #18#11 = #18#11 - #65#6;
          |FINSI;
          |SI #65#2 = "ES"; |O #65#2 = "SS";
               |SI #18#31 = "N";
                    #18#9 = #18#9 + #65#6;
               |FINSI;
          |FINSI;
          |GRABA 020#18a;
          |LIBERA #18;
     |FINSI;
|FPRC;

|DEFBUCLE Historico;
     #65#1;
     ;
     "                    ", fFecha, "  ", 000000, 00000, "     ";
     "zzzzzzzzzzzzzzzzzzzz", #0#1, "zz", 999999, 99999, "zzzzz";
     ;
     NULL, Historico;
|FIN;

|PROCESO Actual;
     #18#4 = #121#1;
     #18#3 = #0#1;
     #18#1 = #121#3;
     |LEE 101#18=;
     |SI FSalida = 0;
          #18#13 = #121#4;
          #18#14 = #121#5;
          #18#15 = #121#6;
          #18#30 = #120#5;
          |GRABA 020#18a;
          |LIBERA #18;
     |FINSI;
|FPRC;

|DEFBUCLE Actual;
     #121#1;
     ;
     #0#1, "                    ", 00000, "               ";
     #0#1, "zzzzzzzzzzzzzzzzzzzz", 99999, "zzzzzzzzzzzzzzz";
     ;
     NULL, Actual;
|FIN;

|PROCESO Inicial;
     #18#4 = #121#1;
     #18#3 = #0#1;
     #18#1 = #121#3;
     |LEE 101#18=;
     |SI FSalida = 0;
          #18#7 = #121#5;
          |GRABA 020#18a;
          |LIBERA #18;
     |FINSI;
|FPRC;

|DEFBUCLE Inicial;
     #121#1;
     ;
     #0#0, "                    ", 00000, "               ";
     #0#0, "zzzzzzzzzzzzzzzzzzzz", 99999, "zzzzzzzzzzzzzzz";
     ;
     NULL, Inicial;
|FIN;

|PROCESO ArtiAlma;
     #19#0 = #17#0;
     |LEE 000#19=;
     |SI #19#137 = "N"; |ACABA; |FINSI;

     nConta = nConta + 1;
     |DDEFECTO #18;
     #18#0 = nConta;
     #18#1 = #17#1;
     #18#2 = #0#0;
     #18#3 = #0#1;
     #18#4 = #17#0;
     #18#5 = #17#40;
     #18#31 = aExiste;
     |GRABA 020#18n;
|FPRC;

|DEFBUCLE ArtiAlma;
     #17#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, ArtiAlma;
|FIN;

|PROCESO Borra18;
     |BORRA 020#18a;
|FPRC;

|DEFBUCLE Borra18;
     #18#2;
     ;
     "                    ", #0#1, 00000;
     "zzzzzzzzzzzzzzzzzzzz", #0#1, 99999;
     be;
     NULL, Borra18;
|FIN;

|PROCESO Tipo3; |TIPO 3;
     |ABRE #120;
     #120#0 = #0#1;
     |LEE 000#120=;
     |SI FSalida ! 0;
          aExiste = "N";
     |SINO;
          aExiste = "S";
     |FINSI;
     |CIERRA #120;

     |BUCLE Borra18;
     |ABRE #18;
     |LEE 000#18u;
     nConta = #18#0 + 1;
     |ABRE #19;
     |BUCLE ArtiAlma;
     |CIERRA #19;
     |SELECT #2#18;
     |BUCLE Inicial;
     |BUCLE Actual;
     fFecha = #0#0 + 1;
     |ABRE #501;
     |SELECT #2#501;
     |BUCLE Historico;
     |CIERRA #501;
     |CIERRA #18;
     |BUCLE Final;
|FPRC;

|PROGRAMA;
     |SI PARAMETRO = "";
          |MANTE #0;
     |SINO;
          #0#0 = efFecha1;
          #0#1 = efFecha2;
     |FINSI;
|FPRO;
