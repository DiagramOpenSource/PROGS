|FICHEROS;
     dsfa0006 #0;
     dsfa0007 #1,MANTE;
     dsfa0008 #2;  ||Historico Partir
     agifa019 #19;
     agifa084 #84;
     agifa142 #142;
     agifa501 #501;
     agifa509 #509;
     agifa517 #517;
|FIN;

|VARIABLES;
     &nElTicket= 0;
     &aSesion  = "";
     &Tempo    = "";
     aTempo1   = "";
     aMensa    = "";
     aAlfa     = "";
     nErr      = 0;
     nModo     = 0;
     nErrResu  = 0;
     nForma    = 0;
     aEmpre    = "";
 {-1}Menu      = "";
     Menu1     = "2400";
     Menu2     = "1";
     Menu3     = "";
     Menu4     = "RFC";
     Menu5     = " Repasar ";
     Menu6     = " Facturar ";
     Menu7     = " Cancelar ";
|FIN;

|PROCESO Tipo6; |TIPO 6;
     |SI FSalida = 1;
          |ERROR; |PTEC 807;
     |FINSI;
|FPRC;

컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO Historico;
     |SI #2#6 = "E";
          #509#52 = #509#52 + (#2#7*nForma); ||Efe
     |FINSI;
     |SI #2#6 = "T";
          #509#53 = #509#53 + (#2#7*nForma); ||Ta
     |FINSI;
     |SI #2#6 = "C";
          #509#54 = #509#54 + (#2#7*nForma); ||Che
     |FINSI;
     #509#55 = #509#55 +  (#2#7*nForma);
|FPRC;

|DEFBUCLE Historico;
     #2#1;
     ;
     #0#4, #0#5, 001;
     #0#4, #0#5, 999;
     ;
     NULL, Historico;
|FIN;

|PROCESO ModResu;
     |SI #1#2 = "E";
          #509#52 = #509#52 + (#1#1*nForma); ||Efe
     |FINSI;
     |SI #1#2 = "T";
          #509#53 = #509#53 + (#1#1*nForma); ||Ta
     |FINSI;
     |SI #1#2 = "C";
          #509#54 = #509#54 + (#1#1*nForma); ||Che
     |FINSI;
     #509#55 = #509#55 +  (#1#1*nForma);
|FPRC;

|DEFBUCLE ModResu;
     #1#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, ModResu;
|FIN;

|PROCESO ModiResumen;
     |DFICE aEmpre;
     aEmpre = aEmpre % -205;

     nErrResu = 0;
     |ABRE #509;
     #509#63 = aEmpre;
     #509#0 = #0#7;
     #509#1 = #0#6;
     |LEE 101#509=;
     |SI FSalida = 0;
          |SI #509#56 ! "S";
               |MENAV "0000Resumen Cerrado...";
               nErrResu = 1;
          |SINO;
               #509#52 = #509#52 - (#501#38 * nForma); ||Efe
               #509#54 = #509#54 - (#501#39 * nForma); ||Che
               #509#53 = #509#53 - (#501#40 * nForma); ||Ta
               #509#55 = #509#55 - ((#501#38 + #501#39 + #501#40)*nForma);
               |SI nForma = 1;
                    |BUCLE ModResu;
               |SINO;
                    |BUCLE Historico;
               |FINSI;
               |GRABA 020#509a;
          |FINSI;
     |SINO;
          |MENAV "0000No existe Resumen....";
          nErrResu = 1;
     |FINSI;
     |CIERRA #509;
|FPRC;

컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO DefImp; |TIPO 7;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo ! 1; |ACABA; |FINSI;
     #1#1 = #0#2 - #0#3;
     #1#8 = #19#1; |PINTA #1#8;
|FPRC;

|PROCESO Tipo2; |TIPO 2;
     #0#3 = #0#3 +. #1#1;
     |PINTA #0#3;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO BorraHisParte;
     |BORRA 020#2a;
|FPRC;

|DEFBUCLE BorraHisParte;
     #2#1;
     ;
     #0#4, #0#5, 01;
     #0#4, #0#5, 99;
     be;
     NULL, BorraHisParte;
|FIN;

|PROCESO MiraReparto;
     nErr = 1;
     |ABRE #2;
     #2#0 = #0#4;
     #2#1 = #0#5;
     #2#2 = 0;
     |LEE 000#2];
     |SI FSalida = 0; |Y #2#0 = #501#36; |Y #2#1 = #501#0;
          aAlfa = "0000NEsta Factura ya ha sido repartida" + &13;
          aAlfa = aAlfa + "Anular reparto anterior";
          |CONFI aAlfa;
          nErr = FSalida;
     |FINSI;
     |CIERRA #2;
|FPRC;

|PROCESO Inf;
     #1#0 = 1;
|FPRC;

|PROCESO Sup;
     #1#0 = 99;
|FPRC;

|PROCESO Tipo12; |TIPO 12;
     |SI FSalida ! 0; |ACABA; |FINSI;

     aMensa = "";
     |ABRE #501;
     |SELECT #2#501;
     #501#35 = "F";
     #501#57 = #0#0;
     #501#58 = #0#1;
     |LEE 000#501=;
     |SI FSalida ! 0;
          aMensa = "0000Tiquet no encontrado...";
          |ABRE #2;
          |SELECT #2#2;
          #2#3 = "F";
          #2#4 = #0#0;
          #2#5 = #0#1;
          |LEE 000#2=;
          |SI FSalida = 0;
               |SELECT #1#501;
               #501#36 = #2#0;
               #501#0 = #2#1;
               |LEE 000#501=;
               |SI FSalida = 0;
                    #0#0 = #501#57;
                    #0#1 = #501#58;
                    aMensa = "";
               |FINSI;
          |FINSI;
          |CIERRA #2;
     |FINSI;
     |SI aMensa ! "";
          |MENAV aMensa;
     |SINO;
          #0#4 = #501#36;
          #0#5 = #501#0;
          #0#6 = #501#14;
          #0#7 = #501#12;
          |HAZ MiraReparto;
          |SI nErr = 0;
               nForma = -1;
               |HAZ ModiResumen;
               |SI nErrResu = 0;
                    |HAZ BorraFac;
                    |HAZ BorraAlba; || Este Restaura la Factura
                    |BUCLE BorraHisParte;
               |FINSI;
          |FINSI;

          |SI nErr = 1;
               |PARA; |SI Menu2 = 1; |HACIENDO;
                    |ENTLINEAL #1#1, -1, 1, 21, 0, Inf, Sup;
                    |MENU Menu;
                    Menu2 = FSalida;
                    |SI Menu2 = 2; |Y #0#3 ! #0#2;
                         |MENAV "0000Reparto incorrecto...";
                         Menu2 = 1;
                    |FINSI;
               |SIGUE;

               |SI Menu2 = 2;
                    nForma = 1;
                    |HAZ ModiResumen;
                    |SI nErrResu = 0;
                         |HAZ Albaran;
                         |HAZ Factura;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
     |CIERRA #501;
|FPRC;

|PROGRAMA;
     |ABRE #142; |LEE 000#142p; |CIERRA #142;
     |ABRE #517; |LEE 000#517p; |CIERRA #517;
     |SI nElTicket ! 0;      || Lo llama 'iber0200' (tactil)
          |ABRE #501;
          #501#36 = aSesion;
          #501#0 = nElTicket;
          |LEE 000#501=;
          |SI FSalida = 0;
               #0#0 = #501#57;
               #0#1 = #501#58;
               #0#4 = #501#36;
               #0#5 = #501#0;
               #0#6 = #501#14;
               #0#7 = #501#12;
               |HAZ BorraFac;
               |HAZ BorraAlba; || Este Restaura la Factura
               |BUCLE BorraHisParte;
          |FINSI;
          |CIERRA #501;
     |SINO;
          |HAZ CreaTempo; aTempo1 = Tempo;
          |NOME_DAT #1 aTempo1; |DELINDEX #1;

          |ABRE #19;
          #19#0 = #517#25;
          |LEE 000#19=;
          |CIERRA #19;

          |CLS;
          |PINPA #0#0;
          |ENTLINEAL #1#1, -1, 7, 21, 1, Inf, Sup;
          |PINDA #0#0;
          |ENDATOS #1#0;

          |DELINDEX #1; Tempo = aTempo1; |HAZ BoraTempo;
     |FINSI;
|FPRO;
