|FICHEROS;
     legiz004 #0;
     legim003 #3;
     legim004 #4;
     agifa010 #10;
     legim017 #17;
     agifa019 #19;
     dsm00003 #30;
     agifa024 #24;
     agifa025 #25;
     dsm00053 #53;
     agifa071 #71;
     agifa142 #142;
     agifa321 #321;
     agifa324 #324;
|FIN;

|INCLUYE i_varart;

|VARIABLES;
     &eaTag = "";
     &enSwMenu = 0;
     &aDivisa = "";
     &aMoneda = "";
     nExiste = 0;
     aMensaje = "";
     aCli = "";
     aRep = "";
     aAlfa = "";
     nLin = 0;
     nImpo = 0;
     nCalc = 0;
|FIN;

|PROCESO ActCli;
     nImpo = #10#15 < #10#5;
     nImpo = nImpo < #10#32;
     nImpo = nImpo < #10#7;
     |ABRE #24;
     #24#0 = #10#3;
     |LEE 121#24=;
     |SI FSalida = 0;
         #24#50 = #24#50 + nImpo;
         |GRABA 020#24a;
     |FINSI;
     |CIERRA #24;

     enForma = 1;
     enImpCliPen = nImpo;
     eaCliente = #10#3;
     efFecha = #10#1;
     |HAZ AcumulaCli;
|FPRC;

|PROCESO CopiaDA;
     #53#0 = "A";
     #53#1 = #71#29;
     #53#2 = #71#0;
     #53#3 = #71#1;
     #53#4 = #17#4;
     #53#5 = #17#5;
     |GRABA 020#53n;
|FPRC;

|DEFBUCLE CopiaDA;
     #17#1;
     ;
     "P", #4#0, #4#1, #4#2, 0001;
     "P", #4#0, #4#1, #4#2, 9999;
     ;
     NULL, CopiaDA;
|FIN;

|PROCESO BorraDA;
     |BORRA 020#53a;
|FPRC;

|DEFBUCLE BorraDA;
     #53#1;
     ;
     "A", #71#29, #71#0, #71#1, 0001;
     "A", #71#29, #71#0, #71#1, 9999;
     be;
     NULL, BorraDA;
|FIN;

|PROCESO LinAlb;
     |ABRE #19;
     #19#0 = #4#3;
     |LEE 000#19=;
     |SI FSalida ! 0; |DDEFECTO #19; |FINSI;

     nLin = nLin + #142#236;
     |DDEFECTO #71;
     #71#29 = #10#52;
     #71#0 = #10#0;
     #71#1 = nLin;
     #71#2 = #4#3;
     #71#3 = 1;
     #71#4 = #4#4;
     #71#5 = #4#7;
     #71#6 = #4#8;
     #71#8 = #4#10;
     #71#11 = #19#30;
     #71#12 = #4#1;
     #71#13 = #4#5;
     #71#15 = #10#3;
     #71#16 = #10#34;
     #71#15 = #10#35;
     #71#21 = #4#2;
     #71#23 = #4#7;
     #71#31 = #4#0;
     #71#33 = #4#11;
     #71#36 = #71#6;
     #71#38 = #71#6;
     |HAZ TotalLin71;
     |GRABA 020#71n;
     |CIERRA #19;

     enForma = 1;
     |HAZ AcumulaAV;

     #10#41 = #10#41 + 1;

     |BUCLE BorraDA;
     |ABRE #53;
     |BUCLE CopiaDA;
     |CIERRA #53;
|FPRC;

|PROCESO CabAlb;
     #10#52 = #0#9;
     enSwMenu = 1;
     |HAZ ContaAV7;
     |GRABA 020#10b;

     |ABRE #24;
     #24#0 = #3#2;
     |LEE 000#24=;
     |SI FSalida ! 0; |DDEFECTO #24; |FINSI;
     |CIERRA #24;

     #30#0 = #3#2;
     #30#1 = 1;
     |LEE 000#30=;
     |SI FSalida ! 0; |DDEFECTO #30; |FINSI;

     #10#1 = #0#10;
     #10#3 = #3#2;
     #10#4 = #3#3;
     #10#6 = #3#13;
     #10#8 = #24#20;
     #10#9 = #24#35;

     #10#29 = #30#10;
     #10#30 = #30#2;
     #10#31 = #30#3;
     #10#33 = #30#7;
     #10#62 = #30#6;

     #25#0 = #10#6;
     |LEE 000#25=;
     |SI FSalida ! 0; |DDEFECTO #25; |FINSI;

     #10#34 = #25#7;
     #10#35 = #24#4;
     #10#26 = #24#47;
     #10#40 = #24#41;
     #10#50 = #24#40;
     #10#51 = #24#28;
     #10#63 = #24#15;
     #10#64 = #24#208;
     #10#68 = #24#192;
     #10#70 = #24#193;
     #10#73 = #321#9;
     |ABRE #324;
     #324#0 = #10#68;
     |LEE 000#324=;
     |SI FSalida ! 0; |DDEFECTO #324; |FINSI;
     #10#69 = #324#2;
     #324#0 = #10#73;
     |LEE 000#324=;
     |SI FSalida ! 0; |DDEFECTO #324; |FINSI;
     #10#74 = #324#2;
     |CIERRA #324;
     #10#91 = #24#206;

     aDivisa = #10#68;
     aMoneda = #10#70;
     |HAZ Divisas010;
|FPRC;

|PROCESO Fin;
     |SI aCli = ""; |ACABA; |FINSI;

     |GRABA 020#10a;
     |LIBERA #10;

     |HAZ ActCli;
|FPRC;

|PROCESO Adj;
     |SI aCli ! #3#2; |O aRep ! #3#13;
          |HAZ Fin;
          |HAZ CabAlb;
          |HAZ LimCabAgifa010;
          aCli = #3#2;
          aRep = #3#13;
          nLin = 0;
     |FINSI;
     |HAZ LinAlb;
     |HAZ CalCabAgifa010;

/* No hay riesgos en pedidos
     enTiva = #71#11;
     efFiva = #3#6;
     |HAZ SacaIVA;
     nCalc = (#4#12 % enIva);
     |SI #24#47 = "S";
          nCalc = nCalc + (#10#11 % enRec);
     |FINSI;
     nCalc = nCalc ! 2;
     nImpo = #4#12 + nCalc;
     eaTag = "PAU"; |HAZ Riesgos;
*/
     eaTag = "AV";  |HAZ Riesgos;

     #3#15 = "S";
     #3#17 = #10#52;
     #3#18 = #10#0;
     |GRABA 020#3a;
     |LIBERA #3;
|FPRC;

|PROCESO Cab;
|FPRC;

|DEFBUCLE legim003;
     #3#1;
     2, 6, 15, 12;
     #0#1, #0#3, #0#5, #0#7, "N", "S";
     #0#2, #0#4, #0#6, #0#8, "N", "S";
     be;
     NULL, NULL, NULL, NULL, Fin, Cab, Adj;
     #3#2, #3#13, #3#0, #3#1;
|FIN;

|PROCESO Principal;
     |ABRE #142; |LEE 000#142p; |CIERRA #142;
     |ABRE #321; |LEE 000#321p; |CIERRA #321;
     |ABRE #10;
     |ABRE #25;
     |ABRE #30;
     |ABRE #71;
     |BUCLE legim003;
     |CIERRA #71;
     |CIERRA #30;
     |CIERRA #25;
     |CIERRA #10;
|FPRC;

|PROGRAMA;
     |CLS;
     |ABRE #0;
     |DDEFECTO #0;
     |LEE 101#0p;
     nExiste = FSalida;
     |PINPA #0#0;
     |PINDA #0#0;
     |ENDATOS #1#0;
     |SI FSalida = 0;
          |SI nExiste = 0;
               |GRABA 020#0a;
          |SINO;
               |GRABA 020#0n;
          |FINSI;
          |HAZ Principal;
     |FINSI;
     |LIBERA #0;
     |CIERRA #0;
|FPRO;
