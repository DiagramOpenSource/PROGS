     COPIA TEMPORAL DEL agifa017 PARA PODER MOSTRARLO SEGUN PARAMETRO GENERAL

|FICHEROS;
     tecaz024 #0,MANTE;
     agifa017 #17;
     agifa019 #19;
     tecam028 #28;
     agifa142 #142;
     agifa321;
     agifa324;
|FIN;

|VARIABLES;
     aAlfa = "";
     nSal = 0;
     &nDeci_Base    = 0;
     &nDeci_PreBase = 0;
     &nDeci_PreDiv = 0;
     cambio_div = 0;
     cambio_base = 0;
     i = 0;
|FIN;

|INCLUYE i_varart;

|PROCESO pvps017;
     |SI #0#70 = "S"; |O #0#70 = "G";

          |PARA i = 51; |SI i [ 92; |HACIENDO i = i + 1;
               #17i = #0i;
          |SIGUE;
          |ABRE #19;
          |HAZ CalPreTeca023;
          |CIERRA #19;
          |PINDA #0#0;
     |FINSI;
|FPRC;

|PROCESO Precios1;
     |SI #0Campo ! Contenido;
          |SI Campo ] 70; |Y Campo [ 77;
               |HAZ pvps017;
               |ACABA;
          |FINSI;
          |SI #142#60 = 1;
               |SI Campo = 20;
                    |HAZ pvps017;
               |FINSI;
          |FINSI;
          |SI #142#60 = 2;
               |SI Campo = 30; |O Campo = 33;
                    |HAZ pvps017;
               |FINSI;
          |FINSI;
          |SI #142#60 = 3;
               |SI Campo = 31; |O Campo = 34;
                    |HAZ pvps017;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO PreDiv1;
     |SI #0Campo = Contenido; |ACABA; |FINSI;
     |HAZ Divisa1;

     |SI Campo = 30;|O Campo = 32;  ||Estoy en campo divisa de UPC o UPC Base
          #0#33 = #0#30 / cambio_base * cambio_div; ||U.P.C Div
          #0#34 = #0#31 / cambio_base * cambio_div; ||U.P.C Div con Dto
     |FINSI;
     |SI Campo = 33; ||Estoy en UPC Divisa
          #0#30 = #0#33 / cambio_div * cambio_base;  ||U.P.C
          #0#34 = #0#33 < #0#35;
          #0#34 = #0#34 < #0#36;
          #0#31 = #0#34 / cambio_div * cambio_base; ||U.P.C con Dto
     |FINSI;
     |SI Campo = 34; ||Estoy en UPC Div con Dto
          #0#31 = #0#34 / cambio_div * cambio_base;  ||U.P.C con Dto
     |FINSI;
     |SI Campo = 31; ||Estoy en UPC con Dto
          #0#34 = #0#31 / cambio_div * cambio_base; ||U.P.C Div con Dto
     |FINSI;
     |PINTA #0#33;
     |PINTA #0#34;
     |PINTA #0#30;
     |PINTA #0#31;
|FPRC;

|PROCESO Divisa1;
     |ABRE #agifa324;
     #agifa324#0 = #0#32;
     |LEE 001#agifa324.=;
     nDeci_PreDiv = #agifa324#9;
     cambio_div = #agifa324#3;
     |ABRE #agifa321;
     |LEE 001#agifa321.p;
     #agifa324#0 = #agifa321#9; ||Igualo a moneda base
     |LEE 001#agifa324.=;
     nDeci_Base = #agifa324#7;  ||Decimales moneda base
     nDeci_PreBase = #agifa324#9;  ||Decimales precio de moneda base
     cambio_base = #agifa324#3;
     |CIERRA #agifa321;
     |CIERRA #agifa324;
|FPRC;

|PROCESO TecPreArtAlm;
     aAlfa = #142#30;
     |C_M #0#69, 1, aAlfa;

     |PARA i = 0; |SI i [ 92; |HACIENDO i = i + 1;
          #0i = #17i;
     |SIGUE;
     |PUSHV 0501 2380;
     |PINPA #0#0;
     |PINDA #0#0;
     |ENDATOS #1#0;
     nSal = FSalida;
     |SI FSalida = 0;
          |PARA i = 51; |SI i [ 92; |HACIENDO i = i + 1;
               #17i = #0i;
          |SIGUE;
     |FINSI;
     |POPV;
     enSalida = nSal;
|FPRC;

|PROGRAMA;
     |ABRE #142; |LEE 000#142p; |CIERRA #142;

     |SI #142#138 = "S";
          aAlfa = Usuario % 810;
          |ABRE #28;
          #28#0 = aAlfa;
          |LEE 000#28=;
          |SI FSalida ! 0;
               |C_V #0#69, 1, "N";
               |C_V #0#79, 1, "N";|C_V #0#80, 1, "N";|C_V #0#89, 1, "N";|C_V #0#90, 1, "N";
               |C_V #0#82, 1, "N";|C_V #0#83, 1, "N";|C_V #0#91, 1, "N";|C_V #0#92, 1, "N";
          |FINSI;
          |CIERRA #28;
     |FINSI;

     |ABRE #17;
     #17#0 = eaArticulo;
     #17#1 = enAlmacen;
     |LEE 121#17=;
     |SI FSalida = 0;
          |HAZ TecPreArtAlm;
          |SI enSalida = 0;
               |GRABA 020#17a;
          |FINSI;
     |FINSI;
     |CIERRA #17;
|FPRO;
