|FICHEROS;
     pcegz071 #0;
     pcegm012 #12;
     agifa017 #17;
     agifa019 #19;
     pcegm038 #38;
|FIN;

|VARIABLES;
     nAlma = 0;
     aAlfa = "";
     aPath = "";
     aDato = "";
     nHandle = 0;
     aFic = "";
     aOrg = "";
     aDes = "";
|FIN;

|PROCESO Almacen;
     #12#0 = #17#0;
     |LEE 000#12=;
     |SI FSalida ! 0; |DDEFECTO #12; |FINSI;

     #19#0 = #17#0;
     |LEE 000#19=;
     |SI FSalida ! 0; |DDEFECTO #19; |FINSI;

     aDato = &34 + #17#0 + &34;
     aDato = aDato + "," + &34 + #19#1 + &34;
     aDato = aDato + "," + #17#1;
     aDato = aDato + "," + #17#42;
     aDato = aDato + "," + #17#8;
     aDato = aDato + "," + #17#43;
     aDato = aDato + "," + #17#5;
     aDato = aDato + "," + #17#39;
     aDato = aDato + "," + #17#3;

     aDato = aDato + "," + #19#18;
     aDato = aDato + "," + #19#149;
     aDato = aDato + "," + #19#12;
     aDato = aDato + "," + #12#1;

     aDato = aDato + &13; aDato = aDato + &10;
     |XGRABA nHandle, aDato;
|FPRC;

|DEFBUCLE Almacen;
     #17#1;
     ;
     "                    ", nAlma;
     "zzzzzzzzzzzzzzzzzzzz", nAlma;
     ;
     NULL, Almacen;
|FIN;

|PROGRAMA;
     |SI PARAMETRO = "menu";
          |CONFI "0000NRealizar exportación stock?";
          |SI FSalida ! 0; |ACABA; |FINSI;
     |FINSI;

     |ABRE #38; |LEE 000#38p; |CIERRA #38;
     nAlma = #38#8;

     |DFICE aPath;
     aOrg = aPath + "expor.csv";

     aDes = #38#10; |QBF aDes;

     |XABRE "WB", aOrg, nHandle;
     |SI FSalida ] 0;
          |ABRE #19;
          |ABRE #12;
          |BUCLE Almacen;
          |CIERRA #12;
          |CIERRA #19;
          |XCIERRA nHandle;


          aAlfa = "";
          |IP_REMOTO aAlfa;
          |SI aAlfa = "";
               |MKDIR aPath;
               |COPIA_FICHERO aOrg, aDes;
          |SINO;
               |RMKDIR aPath;
               |ENVIA_FICHERO aOrg, aDes;
          |FINSI;
          |FBORRA aOrg;
     |FINSI;
|FPRO;
