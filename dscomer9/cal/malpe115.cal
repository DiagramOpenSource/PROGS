|FICHEROS;
     malpe115 #0;

     agifa704 #10;

     canempr@ #1000;
     calibro@ #1001;
     agicen14@;
|FIN;

|VARIABLES;
   aDir  = "";
   aAlfa = "";
   aBase = "";

   nTecla = 0;
|FIN;

|PROCESO Inf14;
     #agicen14@#0 = #malpe115#2;
     #agicen14@#1 = 1;
|FPRC;

|PROCESO Sup14;
     #agicen14@#0 = #malpe115#2;
     #agicen14@#1 = 99;
|FPRC;

|PROCESO MiraActividad;
     |C_M #malpe115#11, 0, aAlfa;
     |SI aAlfa = "N";
         #malpe115#11 = "";  |PINTA #malpe115#11;
         #malpe115#12 = "";  |PINTA #malpe115#12;

         |ACABA;
     |FINSI;

     aAlfa = #malpe115#11;  |QBT aAlfa;
     #malpe115#11 = ("00" + aAlfa) % -102;  |PINTA #malpe115#11;

     nTecla = FSalida;

     |DBASS aBase;  |QBF aBase;
     aAlfa = aBase + "basica/def/agicen14.mas";
     |CARGA_DEF aAlfa, agicen14@;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |ABRE #agicen14@;
     |SI nTecla = 10;
         #agicen14@#0 = #malpe115#2;
         #agicen14@#1 = #malpe115#11;
         |LEE 000#agicen14@.];
         |CONSULTA_F_CLAVE #1#agicen14@, Inf14, Sup14;
         |SI FSalida = 0;
             #malpe115#11 = ("00" + #agicen14@#1) % -102;  |PINTA #malpe115#11;
             #malpe115#12 = #agicen14@#4; |PINTA #malpe115#12;
         |FINSI;
     |FINSI;

     #agicen14@#0 = #malpe115#2;
     #agicen14@#1 = #malpe115#11;
     |LEE 000#agicen14@.=;
     |SI FSalida = 0;
         #malpe115#12 = #agicen14@#4; |PINTA #malpe115#12;
     |SINO;
         |MENAV "0000No existe actividad.";
         |ERROR;
     |FINSI;

     |CIERRA #agicen14@;
     |DESCARGA_DEF #agicen14@;
|FPRC;

|PROCESO MiraLibros;
     nTecla = FSalida;

     |ABRE #agifa704;
     #agifa704#0 = #malpe115#1;
     |LEE 000#agifa704.=;
     |SI FSalida ! 0; |DDEFECTO #agifa704; |FINSI;
     |CIERRA #agifa704;

     aDir  = #agifa704#6; |QBF aDir;
     aAlfa = aDir + "def/calibros.mas";
     |CARGA_DEF aAlfa, calibro@;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     aAlfa = aDir + "fich/" + (("00000" + #agifa704#4) % -105) + #agifa704#5 + "/";
     |PATH_DAT #1001 aAlfa;
     |ABRE #calibro@;
     |SI nTecla = 10;
         #calibro@#0 = #malpe115#4;
         |LEE 000#calibro@.];
         |CONSULTA_CLAVE #1#calibro@;
         |SI FSalida = 0;
             #malpe115#4 = #calibro@#0; |PINTA #malpe115#4;
         |FINSI;
     |FINSI;

     #calibro@#0 = #malpe115#4;
     |LEE 000#calibro@.=;
     |SI FSalida = 0;
         #malpe115#7 = #calibro@#1; |PINTA #malpe115#7;
     |FINSI;

     |CIERRA #calibro@;
     |DESCARGA_DEF #calibro@;
|FPRC;

|PROCESO MiraEmpresa;
     nTecla = FSalida;

     |ABRE #agifa704;
     #agifa704#0 = #malpe115#1;
     |LEE 000#agifa704.=;
     |SI FSalida ! 0; |DDEFECTO #agifa704; |FINSI;
     |CIERRA #agifa704;

     |C_M #malpe115#11, 1, "N";

     aDir  = #agifa704#6; |QBF aDir;
     aAlfa = aDir + "def/canempre.mas";
     |CARGA_DEF aAlfa, canempr@;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     aAlfa = aDir + "fich/"; |PATH_DAT #1000 aAlfa;
     |ABRE #canempr@;
     |SI nTecla = 10;
         #canempr@#2 = #malpe115#2;
         #canempr@#3 = #malpe115#3;
         |LEE 000#canempr@.];
         |CONSULTA_CLAVE #1#canempr@;
         |SI FSalida = 0;
             #malpe115#2 = #canempr@#2; |PINTA #malpe115#2;
             #malpe115#3 = #canempr@#3; |PINTA #malpe115#3;
         |FINSI;
     |FINSI;

     #canempr@#2 = #malpe115#2;
     #canempr@#3 = #malpe115#3;
     |LEE 000#canempr@.=;
     |SI FSalida = 0;
         #malpe115#6 = #canempr@#1; |PINTA #malpe115#6;

         |SI #canempr@#24 = "S";
             |C_M #malpe115#11, 1, "S";
         |FINSI;
     |FINSI;

     |CIERRA #canempr@;
     |DESCARGA_DEF #canempr@;
|FPRC;

|PROCESO MiraEnlace;
     |ABRE #agifa704;
     #agifa704#0 = #malpe115#1;
     |LEE 000#agifa704.=;
     |SI FSalida = 0;
         |SI #malpe115#10 = "V";
             |SI #agifa704#2 ! "FV"; |Y #agifa704#2 ! "FD";
                 |MENAV "    No es un enlace de facturas de venta";
                 |ERROR;
             |FINSI;
         |FINSI;

         |SI #malpe115#10 = "C";
             |SI #agifa704#2 ! "FC";
                 |MENAV "    No es un enlace de facturas de compra";
                 |ERROR;
             |FINSI;
         |FINSI;
     |FINSI;
     |CIERRA #agifa704;
|FPRC;

|RUTINA infmalpe115;
     #malpe115#0 = "     ";
     #malpe115#9 = "+";
     #malpe115#10 = "C";
|FRUT;

|RUTINA supmalpe115;
     #malpe115#0 = "zzzzz";
     #malpe115#9 = "-";
     #malpe115#10 = "V";
|FRUT;

|PROGRAMA;
     |CLS;
     |CABEZA " Asignacion series a enlaces contables ";
     |PINPA #0#0;

     |ENTLINEAL #1#malpe115, -1, 1, 16, 1, infmalpe115, supmalpe115;
|FPRO;
