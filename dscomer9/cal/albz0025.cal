|FICHEROS;
     albm0031 #0,MANTE;        ||Introd.Mezcladas CAB

     albz0025 #600;

     albm0061 #61;       ||Mezclad.PorConfirmar
     albw0040 #40;       ||Rel. PreMezcla/Orden
     albm0060 #60;       ||Rel. Orden/Mezclada
|FIN;

|VARIABLES;
     nSalida = 0;
     &eaDescrip = "";
     &efFecha = @;
     &eaFormula = "";
     &eaDesFor = "";
     &enLinea = 0;
     &eaDesLin = "";
     &enCuarto = 0;
     &eaDesCua = "";
     &enTrabaj = 0;
     &eaDesTra = "";
     &enAlmacen = 0;
     &eaDesAlm = "";
     &enKgRea = 0;

     &enClave61 = 0;

     aMensaje = "";
     nDocum = 0;
|FIN;

|PROCESO albw0040;
     |DDEFECTO #albm0060;
     #albm0060#2 = #albw0040#2;         ||Serie Orden
     #albm0060#0 = #albw0040#1;         ||Orden
     #albm0060#3 = "";                  ||Serie Mezclada  (VACIO)
     #albm0060#1 = #albm0031#0;         ||Numero Mezclada
     |LEE 101#albm0060.=;
     |SI FSalida ! 0;
          |GRABA 020#albm0060.n;
     |FINSI;
     |LIBERA #albm0060;
     |BORRA 020#albw0040.a;
|FPRC;

|DEFBUCLE albw0040;
 #albw0040#1;
 ;
 enClave61, "     ", 000000;
 enClave61, "zzzzz", 999999;
 be;
 NULL, albw0040;
|FIN;

|PROGRAMA;
     |ABRE #albm0060;

     ||Primero averiguo el numero de Mezclada
     ||Luego relleno los campos que me interesa
     ||Y ya se termina de rellenar.
     |ABRE #0;
     |HAZ NumeroMezclada;


     |PINPA #0#0;

     |DDEFECTO #albm0031;
     #albm0031#0 = nDocum;
     |LEE 101#albm0031.=;
     nSalida = FSalida;

     #0#1 = eaDescrip;
     #0#2 = efFecha;
     #0#3 = eaFormula;
     #0#4 = eaDesFor;
     #0#5 = enLinea;
     #0#6 = eaDesLin;
     #0#7 = enCuarto;
     #0#8 = eaDesCua;
     #0#9 = enTrabaj;
     #0#10 = eaDesTra;
     #0#11 = enAlmacen;
     #0#12 = eaDesAlm ;
     #0#13 = enKgRea;

     |C_M #0#23, 1, "N";
     |C_M #0#24, 1, "N";

     |PINDA #0#0;
     |ENDATOS #1#0;
     |SI FSalida = 0;
          |SI nSalida = 0;
               |GRABA 020#albm0031.a;
          |SINO;
               |GRABA 020#albm0031.n;
          |FINSI;

          |BUCLE albw0040;

          ||Borrar la linea del albm0061.
          |ABRE #albm0061;
          #albm0061#24 = enClave61;
          |LEE 101#albm0061.=;
          |SI FSalida = 0;
               |BORRA 020#albm0061.a;
               |LIBERA #albm0061;
          |FINSI;
          |CIERRA #albm0061;
     |FINSI;
     |LIBERA #albm0031;

     |C_M #0#23, 1, "S";
     |C_M #0#24, 1, "S";

     |CIERRA #0;

     |CIERRA #albm0060;
|FPRO;

|PROCESO NumeroMezclada;
     |LEE 000#albm0031.u;
     nDocum = #albm0031#0 + 1;
|FPRC;
