|FICHEROS;
   pcegz100 #0;

   :/dscarter/def/dscam003 #10;
   :/dscarter/def/dscam014 #11;
   :/dscarter/def/dscam045 #12;

   :/contagen/def/canempre #20;
   :/contagen/def/camaniva #21;
   :/contagen/def/caivalin #22;
   :/contagen/def/camaasil #23;

   agifa024 #50;
   agifa081 #51;
   agifa067 #52;
   agifa019 #53;
   agifa112 #54;
|FIN;

|VARIABLES;
   &enSumaPRecE = 0;
   &enSumaPRecD = 0;
   &enSumaCliEx = 0;
   &enSumaCli1 = 0;
   &enSumaCli2 = 0;
   &enSumaCli3 = 0;
   &enSumaCli4 = 0;
   &enSumaCli5 = 0;
   &enSumaCli6 = 0;
   &enSumaCli7 = 0;
   &enSumaCli8 = 0;

   &enSumaPrv1aD = 0;
   &enSumaPrv2aD = 0;
   &enSumaPrv3aD = 0;
   &enSumaPrv4aD = 0;
   &enSumaPrv5aD = 0;
   &enSumaPrv6aD = 0;
   &enSumaPrv7aD = 0;
   &enSumaPrv8aD = 0;
   &enSumaPrv1bD = 0;
   &enSumaPrv2bD = 0;
   &enSumaPrv3bD = 0;
   &enSumaPrv4bD = 0;
   &enSumaPrv5bD = 0;
   &enSumaPrv6bD = 0;
   &enSumaPrv7bD = 0;
   &enSumaPrv8bD = 0;

   &enSumaPrv1aE = 0;
   &enSumaPrv2aE = 0;
   &enSumaPrv3aE = 0;
   &enSumaPrv4aE = 0;
   &enSumaPrv5aE = 0;
   &enSumaPrv6aE = 0;
   &enSumaPrv7aE = 0;
   &enSumaPrv8aE = 0;
   &enSumaPrv1bE = 0;
   &enSumaPrv2bE = 0;
   &enSumaPrv3bE = 0;
   &enSumaPrv4bE = 0;
   &enSumaPrv5bE = 0;
   &enSumaPrv6bE = 0;
   &enSumaPrv7bE = 0;
   &enSumaPrv8bE = 0;
   &enSumaPdtGiro = 0;
   &enSumaPdtCtRe = 0;

   &enSumaVencid = 0;
   &enStockVal = 0;
   &enSuma1    = 0;
   &enSuma2    = 0;
   &enResult   = 0;
   &enSumaReperc = 0;
   &enSumaSoport = 0;

   fFechaHoy = @;
   fDFecha   = @;
   fHFecha   = @;
   fFechaIni = @;
   fFechaFin = @;

   nTotalIRPF = 0;

   nSwCalc115 = 0;
   nEmpCartera = 0;
   nCampo = 0;
   nCalc  = 0;
   nCalc1 = 0;
   nCalc2 = 0;
   nCont  = 0;
   nCont1 = 0;
   nTecla = 0;
   nSumaPdte = 0;
   nSw    = 0;

   aAlfa  = "";
   aAlfa1 = "";
   aAlfa2 = "";
   aTituloDiv = "";
|FIN;

|PROCESO T15man;
|FPRC;
|PROCESO T16man;
|FPRC;
|PROCESO T17man;
|FPRC;

|PROCESO Camaniva_15;
|FPRC;
|PROCESO Camaniva_16;
|FPRC;
|PROCESO Camaniva_17;
|FPRC;

|PROCESO Cacuenta_15;
|FPRC;
|PROCESO Cacuenta_16;
|FPRC;
|PROCESO Cacuenta_17;
|FPRC;

|PROCESO MiraProveedor;
   nTecla = FSalida;
   |ABRE #agifa112;
   |SI nTecla = 10;
      |CONSULTA_CLAVE #1#agifa112;
      |SI FSalida = 0;
         nCalc = Campo + 1;
         #pcegz100#Campo# = #agifa112#0; |PINTA #pcegz100#Campo#;
         #pcegz100#nCalc# = #agifa112#1; |PINTA #pcegz100#nCalc#;
      |FINSI;
      |ERROR;
      |CIERRA #agifa112; |ACABA;
   |FINSI;
   #agifa112#0 = #pcegz100#Campo#;
   |LEE 000#agifa112.=;
   |SI FSalida ! 0;
      |MENAV "    Proveedor inexistente"; |ERROR;
   |SINO;
      nCalc = Campo + 1;
      #pcegz100#nCalc# = #agifa112#1; |PINTA #pcegz100#nCalc#;
   |FINSI;

   |CIERRA #agifa112;
|FPRC;

|PROCESO CogeNomBanco;
   |CIERRA #dscam014;
   |DBASS aAlfa; |QBF aAlfa; aAlfa = aAlfa + "dscarter/fich/";
   aAlfa = aAlfa + (("00000" + nEmpCartera) % -105) + "/";
   |PATH_DAT #dscam014#aAlfa#; |ABRE #dscam014;

   nCampo = Campo + 1;
   #dscam014#0 = #pcegz100#Campo#;
   |LEE 000#dscam014.=;
   |SI FSalida ! 0;
      |MENAV "    Banco inexistente";
      |ERROR;
   |SINO;
      #pcegz100#nCampo# = #dscam014#1; |PINTA #pcegz100#nCampo#;
   |FINSI;
|FPRC;

|PROCESO LinPedidosPdtes;
   nSumaPdte = nSumaPdte + #agifa067#11;
|FPRC;

|DEFBUCLE LinPedidosPdtes;
#agifa067#1;
;
#agifa081#25, #agifa081#0, 000;
#agifa081#25, #agifa081#0, 999;
;
NULL, LinPedidosPdtes;
|FIN;

|PROCESO PedidosPdtes;
   |SI #agifa081#12 ! 0;
      enSumaPRecE = enSumaPRecE + #agifa081#12;
   |FINSI;
   nSw = 0;
   |PARA nCont1 = 24; |SI nCont1 [ 68; |HACIENDO nCont1 = nCont1 + 3;
      |SI #pcegz100#nCont1# = #agifa081#4; nSw = nCont1; |SAL; |FINSI;
      |SI nCont1 = 36; nCont1 = 59; |FINSI;
   |SIGUE;
   |SI nSw = 0;
      |PARA nCont1 = 71; |SI nCont1 [ 115; |HACIENDO nCont1 = nCont1 + 3;
         |SI #pcegz100#nCont1# = #agifa081#4; nSw = nCont1; |SAL; |FINSI;
         |SI nCont1 = 83; nCont1 = 106; |FINSI;
      |SIGUE;
   |FINSI;

   |SI nSw ! 0;
      nSumaPdte = 0; |BUCLE LinPedidosPdtes;
      |SI nSw = 24;  enSumaPrv1aE = enSumaPrv1aE + nSumaPdte; |FINSI;
      |SI nSw = 27;  enSumaPrv2aE = enSumaPrv2aE + nSumaPdte; |FINSI;
      |SI nSw = 30;  enSumaPrv3aE = enSumaPrv3aE + nSumaPdte; |FINSI;
      |SI nSw = 33;  enSumaPrv4aE = enSumaPrv4aE + nSumaPdte; |FINSI;
      |SI nSw = 36;  enSumaPrv5aE = enSumaPrv5aE + nSumaPdte; |FINSI;
      |SI nSw = 62;  enSumaPrv6aE = enSumaPrv6aE + nSumaPdte; |FINSI;
      |SI nSw = 65;  enSumaPrv7aE = enSumaPrv7aE + nSumaPdte; |FINSI;
      |SI nSw = 68;  enSumaPrv8aE = enSumaPrv8aE + nSumaPdte; |FINSI;
      |SI nSw = 71;  enSumaPrv1bE = enSumaPrv1bE + nSumaPdte; |FINSI;
      |SI nSw = 74;  enSumaPrv2bE = enSumaPrv2bE + nSumaPdte; |FINSI;
      |SI nSw = 77;  enSumaPrv3bE = enSumaPrv3bE + nSumaPdte; |FINSI;
      |SI nSw = 80;  enSumaPrv4bE = enSumaPrv4bE + nSumaPdte; |FINSI;
      |SI nSw = 83;  enSumaPrv5bE = enSumaPrv5bE + nSumaPdte; |FINSI;
      |SI nSw = 109; enSumaPrv6bE = enSumaPrv6bE + nSumaPdte; |FINSI;
      |SI nSw = 112; enSumaPrv7bE = enSumaPrv7bE + nSumaPdte; |FINSI;
      |SI nSw = 115; enSumaPrv8bE = enSumaPrv8bE + nSumaPdte; |FINSI;
   |FINSI;
|FPRC;

|DEFBUCLE PedidosPdtes;
#agifa081#1;
1;
"     ", 000000, #pcegz100#49;
"zzzzz", 999999, #pcegz100#50;
be;
NULL, PedidosPdtes;
|FIN;

|PROCESO RecsPdtes;
   |SI #dscam003#12 = 6;
      |SI #dscam003#14 ! "L"; |Y #dscam003#14 ! "A"; |Y #dscam003#14 ! "R";
         |Y #dscam003#69 ! "P"; |Y #dscam003#14 ! "D";
         enSumaPdtGiro = enSumaPdtGiro + #dscam003#31;
      |FINSI;
   |FINSI;

   |SI #dscam003#12 = 5;
      |SI #dscam003#14 = "P";
         enSumaPdtCtRe = enSumaPdtCtRe + #dscam003#31;
      |FINSI;
   |FINSI;

   |SI #dscam003#3 [ fFechaHoy;
      enSumaVencid = enSumaVencid + #dscam003#31;
      |SI #dscam003#12 = 4; |Y #dscam003#14 ! "L"; |Y #dscam003#14 ! "A";
       |Y #dscam003#69 ! "P"; |Y #dscam003#14 ! "D";
         enSuma1 = enSuma1 + #dscam003#31;
      |FINSI;
   |SINO;
      |SI #dscam003#12 =  4; |O #dscam003#12 =  5; |O #dscam003#12 =  6;
       |O #dscam003#12 = 10; |O #dscam003#12 = 11;
         enSuma2 = enSuma2 + #dscam003#31;
      |FINSI;
   |FINSI;

   |SI #dscam003#12 = 4; |Y #dscam003#14 ! "L"; |Y #dscam003#14 ! "A";
    |Y #dscam003#69 ! "P"; |Y #dscam003#14 ! "D";
      |SI #dscam003#32 ! #pcegz100#39; |Y #dscam003#32 ! #pcegz100#40;
       |Y #dscam003#32 ! #pcegz100#41; |Y #dscam003#32 ! #pcegz100#42;
       |Y #dscam003#32 ! #pcegz100#43; |Y #dscam003#32 ! #pcegz100#44;
       |Y #dscam003#32 ! #pcegz100#45; |Y #dscam003#32 ! #pcegz100#46;
         enSumaCliEx = enSumaCliEx + #dscam003#31;
      |SINO;
         |SI #dscam003#32 ! "      ";
            |SI #dscam003#32 = #pcegz100#39; enSumaCli1 = enSumaCli1 + #dscam003#31; |FINSI;
            |SI #dscam003#32 = #pcegz100#40; enSumaCli2 = enSumaCli2 + #dscam003#31; |FINSI;
            |SI #dscam003#32 = #pcegz100#41; enSumaCli3 = enSumaCli3 + #dscam003#31; |FINSI;
            |SI #dscam003#32 = #pcegz100#42; enSumaCli4 = enSumaCli4 + #dscam003#31; |FINSI;
            |SI #dscam003#32 = #pcegz100#43; enSumaCli5 = enSumaCli5 + #dscam003#31; |FINSI;
            |SI #dscam003#32 = #pcegz100#44; enSumaCli6 = enSumaCli6 + #dscam003#31; |FINSI;
            |SI #dscam003#32 = #pcegz100#45; enSumaCli7 = enSumaCli7 + #dscam003#31; |FINSI;
            |SI #dscam003#32 = #pcegz100#46; enSumaCli8 = enSumaCli8 + #dscam003#31; |FINSI;
         |FINSI;
      |FINSI;
   |FINSI;
|FPRC;

|DEFBUCLE RecsPdtes;
#dscam003#1;
;
0000000001;
9999999999;
;
NULL, RecsPdtes;
|FIN;

|PROCESO Articulos;
   aAlfa = #agifa019#0; |QBF aAlfa;
   aAlfa = aAlfa % 0103;

   |SI aAlfa = "CAL"; |O #agifa019#6 < 0; |ACABA; |FINSI;

   enStockVal = enStockVal + (#agifa019#6 * #agifa019#149);
|FPRC;

|DEFBUCLE Articulos;
#agifa019#1;
;
INICIO;
FINAL;
;
NULL, Articulos;
|FIN;

|PROCESO Emite;
   || Calculo 1 - Suma de los importes de los bancos introducidos
   ||    Se hace en el informe
   || Calculo 2 - Suma de los pedidos pendientes de recibir y por proveedor
   enSumaPRecE = 0;
   enSumaPrv1aD = 0; enSumaPrv2aD = 0; enSumaPrv3aD = 0; enSumaPrv4aD = 0;
   enSumaPrv5aD = 0; enSumaPrv6aD = 0; enSumaPrv7aD = 0; enSumaPrv8aD = 0;
   enSumaPrv1bD = 0; enSumaPrv2bD = 0; enSumaPrv3bD = 0; enSumaPrv4bD = 0;
   enSumaPrv5bD = 0; enSumaPrv6bD = 0; enSumaPrv7bD = 0; enSumaPrv8bD = 0;

   |BUCLE PedidosPdtes;
   enSumaPRecD = enSumaPRecE * #pcegz100#48;
   enSumaPrv1aD = enSumaPrv1aE * #pcegz100#48; enSumaPrv2aD = enSumaPrv2aE * #pcegz100#48;
   enSumaPrv3aD = enSumaPrv3aE * #pcegz100#48; enSumaPrv4aD = enSumaPrv4aE * #pcegz100#48;
   enSumaPrv5aD = enSumaPrv5aE * #pcegz100#48; enSumaPrv6aD = enSumaPrv6aE * #pcegz100#48;
   enSumaPrv7aD = enSumaPrv7aE * #pcegz100#48; enSumaPrv8aD = enSumaPrv8aE * #pcegz100#48;
   enSumaPrv1bD = enSumaPrv1bE * #pcegz100#48; enSumaPrv2bD = enSumaPrv2bE * #pcegz100#48;
   enSumaPrv3bD = enSumaPrv3bE * #pcegz100#48; enSumaPrv4bD = enSumaPrv4bE * #pcegz100#48;
   enSumaPrv5bD = enSumaPrv5bE * #pcegz100#48; enSumaPrv6bD = enSumaPrv6bE * #pcegz100#48;
   enSumaPrv7bD = enSumaPrv7bE * #pcegz100#48; enSumaPrv8bD = enSumaPrv8bE * #pcegz100#48;

   || Calculo 3 - Suma de los importes de los proveedores introducidos
   ||    Se hace en el informe
   || Calculo 4 - Suma de los importes pdtes. de los recibos de venta con
   ||             estado "P" o "C" excluyendo a los clientes indicados
   || Calculo 5 - Suma de los importes pdtes. de los recibos de venta con
   ||             estado "P" o "C" de cada uno de los clientes indicados
   || Calculo 6 - Suma de los importes pdtes. de los recibos de venta con
   ||             estado "P" o "C" con fecha de vto anterior a hoy
   || Calculo 7 - Suma del stock valorado (Stock Total * PVP 6) de todos
   ||             los articulos con stock total ] 0 y omitiendo los articulos
   ||             cuyo codigo comience por CAL

   enStockVal = 0;
   enSumaVencid = 0;
   enSumaCliEx = 0;
   enSumaCli1 = 0; enSumaCli2 = 0; enSumaCli3 = 0; enSumaCli4 = 0;
   enSumaCli5 = 0; enSumaCli6 = 0; enSumaCli7 = 0; enSumaCli8 = 0;
   enSumaPdtGiro = 0; enSumaPdtCtRe = 0;
   fFechaHoy = #pcegz100#133;
   |BUCLE RecsPdtes;

   enSuma1 = enSuma1 - (enSumaCli1 + enSumaCli2 + enSumaCli3 + enSumaCli4);
   enSuma1 = enSuma1 - (enSumaCli5 + enSumaCli6 + enSumaCli7 + enSumaCli8);

   |BUCLE Articulos;
|FPRC;

|PROCESO CamposDivisa;
|FPRC;

|PROCESO NomCliente;
   |SI FSalida = 2; |ACABA; |FINSI;
   nTecla = FSalida;

   |ABRE #agifa024;
   #agifa024#0 = #pcegz100#Campo#;
   |SI nTecla = 10;
      |CONSULTA_CLAVE #1#agifa024;
      #pcegz100#Campo# = #agifa024#0; |PINTA #pcegz100#Campo#;
   |FINSI;
   |LEE 000#agifa024.=;
   |SI FSalida ! 0;
      |MENAV "    Cliente inexistente";
      |ERROR;
   |SINO;
      nCalc = Campo + 13;
      #pcegz100#nCalc# = #agifa024#1; |PINTA #pcegz100#nCalc#;
   |FINSI;
   |CIERRA #agifa024;
   FSalida = nTecla;
|FPRC;

|PROCESO ActDivisa;
   nTecla = FSalida;
   |SI Campo = 64;  |O Campo = 67;  |O Campo = 70;
    |O Campo = 111; |O Campo = 114; |O Campo = 117;
      #pcegz100#51 = #pcegz100#Campo# / #pcegz100#48;
   |SINO;
      #pcegz100#51 = #pcegz100#Campo# * #pcegz100#48;
   |FINSI;
   |C_P #pcegz100#Campo#, 0, nCalc; nCalc = nCalc + 16;
   |PINTA nCalc, #pcegz100#51;
   FSalida = nTecla;
|FPRC;

|PROCESO PintaDivisa1; |TIPO 7;
   nTecla = FSalida;
   aAlfa = #pcegz100#47; |QBF aAlfa;
   aAlfa1 = aAlfa % 0; nCalc = aAlfa1;
   nCalc = 19 - nCalc;
   nCalc1 = (nCalc / 2) ! 0; nCalc2 = nCalc1 * 2;

   |SI nCalc ! nCalc2; aAlfa = " " + aAlfa; |FINSI;
   aTituloDiv = (" " * nCalc1) + aAlfa + (" " * nCalc1);

   |ATRI R; |PINTA 0759, aTituloDiv; |ATRI N;
   |ATRI R; |PINTA 1759, aTituloDiv; |ATRI N;
   |PARA nCont = 26; |SI nCont [ 70; |HACIENDO nCont = nCont + 3;
      #pcegz100#51 = #pcegz100#nCont# * #pcegz100#48;
      |C_P #pcegz100#nCont#, 0, nCalc; nCalc = nCalc + 16;
      |PINTA nCalc, #pcegz100#51;
      |SI nCont = 38; nCont = 61; |FINSI;
   |SIGUE;
   |PARA nCont = 21; |SI nCont [ 132; |HACIENDO nCont = nCont + 1;
      #pcegz100#51 = #pcegz100#nCont# * #pcegz100#48;
      |C_P #pcegz100#nCont#, 0, nCalc; nCalc = nCalc + 16;
      |PINTA nCalc, #pcegz100#51;
      |SI nCont = 23; nCont = 126; |FINSI;
   |SIGUE;
   FSalida = nTecla;
|FPRC;

|PROCESO PintaDivisa2; |TIPO 7;
   nTecla = FSalida;
   aAlfa = #pcegz100#47; |QBF aAlfa;
   aAlfa1 = aAlfa % 0; nCalc = aAlfa1;
   nCalc = 19 - nCalc;
   nCalc1 = (nCalc / 2) ! 0; nCalc2 = nCalc1 * 2;

   |SI nCalc ! nCalc2; aAlfa = " " + aAlfa; |FINSI;
||   aTituloDiv = (" " * nCalc1) + aAlfa + (" " * nCalc1);
   aTituloDiv = (" " * nCalc1) + aAlfa + (" " * nCalc1);

   |ATRI R; |PINTA 0743, aTituloDiv; |ATRI N;
   |ATRI R; |PINTA 1259, aTituloDiv; |ATRI N;
   |ATRI R; |PINTA 1943, aTituloDiv; |ATRI N;
   |PARA nCont = 64; |SI nCont [ 117; |HACIENDO nCont = nCont + 3;
      |SI nCont = 64;  |O nCont = 67;  |O nCont = 70;
       |O nCont = 111; |O nCont = 114; |O nCont = 117;
         #pcegz100#51 = #pcegz100#nCont# / #pcegz100#48;
      |SINO;
         #pcegz100#51 = #pcegz100#nCont# * #pcegz100#48;
      |FINSI;
      |C_P #pcegz100#nCont#, 0, nCalc; nCalc = nCalc + 16;
      |PINTA nCalc, #pcegz100#51;
      |SI nCont = 41; nCont = 61;  |FINSI;
      |SI nCont = 85; nCont = 108; |FINSI;
   |SIGUE;
   FSalida = nTecla;
|FPRC;

|PROCESO PintaRetrDiv; |TIPO 7;
   |SI FSalida = 2; |O FSalida = 4; |HAZ PintaDivisa; |FINSI;
|FPRC;

|PROCESO PintaRetrDiv1; |TIPO 7;
   |SI FSalida = 2; |O FSalida = 4; |HAZ PintaDivisa1; |FINSI;
|FPRC;

|PROCESO PintaRetrDiv2; |TIPO 7;
   |SI FSalida = 2; |O FSalida = 4; |HAZ PintaDivisa2; |FINSI;
|FPRC;

|PROCESO PintaDivisa;
   nTecla = FSalida;
   aAlfa = #pcegz100#47; |QBF aAlfa;
   aAlfa1 = aAlfa % 0; nCalc = aAlfa1;
   nCalc = 19 - nCalc;
   nCalc1 = (nCalc / 2) ! 0; nCalc2 = nCalc1 * 2;

   |SI nCalc ! nCalc2; aAlfa = " " + aAlfa; |FINSI;
   aTituloDiv = (" " * nCalc1) + aAlfa + (" " * nCalc1);

   |ATRI R; |PINTA 1259, aTituloDiv; |ATRI N;
   |PARA nCont = 5; |SI nCont [ 61; |HACIENDO nCont = nCont + 1;
      #pcegz100#51 = #pcegz100#nCont# * #pcegz100#48;
      |C_P #pcegz100#nCont#, 0, nCalc; nCalc = nCalc + 16;
      |PINTA nCalc, #pcegz100#51;
      |SI nCont ] 5; |Y nCont < 14; nCont = nCont + 2; |FINSI;
      |SI nCont = 17; nCont = 59; |FINSI;
   |SIGUE;
   FSalida = nTecla;
|FPRC;

|PROCESO Periodo303;
   |SI #pcegz100#118 ! 99;
      |SI #pcegz100#118 < 1; |O #pcegz100#118 > 12;
         |AVISO; |ERROR;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO Calcula303;
   |SI FSalida = 2; |ACABA; |FINSI;
   |SI #pcegz100#118 = Contenido; |ACABA; |FINSI;

||      |SUB_EJECUTA ":modelos/dsmoy010.tab;04327-09/2010";
   aAlfa1 = ":modelos/dsmoy010.tab;" + (("00000" + #pcegz100#141) % -105) + "-";
   aAlfa1 = aAlfa1 + (("00" + #pcegz100#118) % -102) + "/" + #pcegz100#142;

   |MENSA "    Calculando prevision modelo 303"
   |SUB_EJECUTA aAlfa1;
   |BLIN 4;

   #pcegz100#61 = enResult; |PINTA #pcegz100#61;
   #pcegz100#51 = #pcegz100#61 * #pcegz100#48;
   |C_P #pcegz100#61, 0, nCalc; nCalc = nCalc + 16;
   |PINTA nCalc, #pcegz100#51;
|FPRC;

|PROCESO LineasRegIva;
   |SI #caivalin#18 = 401;
      nTotalIRPF = nTotalIRPF + #caivalin#22;
   |FINSI;
|FPRC;

|DEFBUCLE LineasRegIva;
#caivalin#1;
;
#camaniva#0, #camaniva#1, 01;
#camaniva#0, #camaniva#1, 99;
;
NULL, LineasRegIva;
|FIN;

|PROCESO RegistroIVA;
   |BUCLE LineasRegIva;
|FPRC;

|DEFBUCLE RegistroIVA;
#camaniva#5;
;
fDFecha, 00, 0000000000;
fHFecha, 99, 9999999999;
;
NULL, RegistroIVA;
|FIN;

|PROCESO Extracto;
   |SI #camaasil#4 ] #pcegz100#137; |Y #camaasil#4 [ #pcegz100#138;
      enSumaReperc = enSumaReperc + #camaasil#9;
   |FINSI;
   |SI #camaasil#4 ] #pcegz100#139; |Y #camaasil#4 [ #pcegz100#140;
      enSumaSoport = enSumaSoport + #camaasil#9;
   |FINSI;
|FPRC;

|DEFBUCLE Extracto;
#camaasil#1;
;
#pcegz100#134, #pcegz100#135, 000000, 0000;
#pcegz100#134, #pcegz100#136, 999999, 9999;
;
NULL, Extracto;
|FIN;

|PROCESO MiraFecha115;
   |SI nSwCalc115 = 0;
      |SI #pcegz100#Campo# ! Contenido; |O #pcegz100#17 = 0;
         nSwCalc115 = 1;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO RevisaConta;
   || Hago un bucle de la empresa corriente en el canempre por fechas

   |DBASS aAlfa; |QBF aAlfa;
   aAlfa = aAlfa + "contagen/fich/"; |PATH_DAT #canempre#aAlfa#;
   |ABRE #canempre;
   #canempre#2 = #pcegz100#141;
   #canempre#3 = 0;
   |LEE 000#canempre.];
   |PARA; |SI FSalida = 0; |Y #canempre#2 = #pcegz100#141; |HACIENDO;
      |SI #canempre#26 < 80;
         nCalc = 2000 + #canempre#26;
      |SINO;
         nCalc = 1900 + #canempre#26;
      |FINSI;

      |SI nCalc = #pcegz100#142;
         aAlfa = nCalc;
         aAlfa1 = (("00" + #canempre#12) % -102) + "." + aAlfa;
         |SI #canempre#12 = 2;
            aAlfa1 = "29." + aAlfa1;
         |SINO;
            |SI #canempre#12 = 1; |O #canempre#12 = 3; |O #canempre#12 = 5;
             |O #canempre#12 = 7; |O #canempre#12 = 8; |O #canempre#12 = 10;
             |O #canempre#12 = 12;
               aAlfa1 = "31." + aAlfa1;
            |SINO;
               aAlfa1 = "30." + aAlfa1;
            |FINSI;
         |FINSI;
         aAlfa  = "01." + (("00" + #canempre#11) % -102) + "." + aAlfa;
         fDFecha = aAlfa; fHFecha = aAlfa1;

         |SI fDFecha < fFechaIni; fDFecha = fFechaIni; |FINSI;
         |SI fHFecha < fFechaFin; fHFecha = fFechaFin; |FINSI;

         |DBASS aAlfa2; |QBF aAlfa2;
         aAlfa2 = aAlfa2 + "contagen/fich/" + (("00000" + #canempre#2) % -105) + #canempre#3 + "/";
         |PATH_DAT #camaniva#aAlfa2#; |PATH_DAT #caivalin#aAlfa2#;
         |PATH_DAT #camaasil#aAlfa2#;

         |SI nSw = 1;
            |ABRE #camaniva; |ABRE #caivalin;
            |BUCLE RegistroIVA;
            |CIERRA #camaniva; |CIERRA #caivalin;
         |FINSI;

         |SI nSw = 2;
            |ABRE #camaasil;
            |BUCLE Extracto;
            |CIERRA #camaasil;
         |FINSI;

         |SAL;
      |SINO;
         |LEE 000#canempre.s;
      |FINSI;
   |SIGUE;
   |CIERRA #canempre;
|FPRC;

|PROCESO CalculaExtracto;
   enSumaReperc = 0; enSumaSoport = 0;
   |MENSA "    Calculando prevision repercutido y soportado"
   fFechaIni = #pcegz100#135; fFechaFin = #pcegz100#136;
   nSw = 2; |HAZ RevisaConta;
   |BLIN 4;
|FPRC;

|PROCESO Calcula115;
   |SI nSwCalc115 = 0; |O FSalida = 2; |ACABA; |FINSI;
   nTotalIRPF = 0;

   |MENSA "    Calculando prevision modelo 115"
   fFechaIni = #pcegz100#119; fFechaFin = #pcegz100#120;
   nSw = 1; |HAZ RevisaConta;
   |BLIN 4;

   #pcegz100#17 = nTotalIRPF; |PINTA #pcegz100#17;
   #pcegz100#51 = #pcegz100#17 * #pcegz100#48;
   |C_P #pcegz100#17, 0, nCalc; nCalc = nCalc + 16;
   |PINTA nCalc, #pcegz100#51;

   nSwCalc115 = 0;
|FPRC;

|PROGRAMA;
   |CLS;
   |CABEZA "Informe global estados";

   |DBASS aAlfa; |QBF aAlfa; aAlfa = aAlfa + "dscarter/fich/";
   |PATH_DAT #dscam045#aAlfa#;
   |ABRE #dscam045;
   #dscam045#0 = #48#0;
   #dscam045#1 = 1;
   |LEE 000#dscam045.];
   |SI FSalida = 0; |Y #dscam045#0 = #48#0;
      |DBASS aAlfa; |QBF aAlfa; aAlfa = aAlfa + "dscarter/fich/";
      aAlfa = aAlfa + (("00000" + #dscam045#6) % -105) + "/";
      |PATH_DAT #dscam014#aAlfa#; |PATH_DAT #dscam003#aAlfa#; nEmpCartera = #dscam045#6;
   |FINSI;
   |SELECT #1#dscam045;
   |CIERRA #dscam045;

   fFechaHoy = ~;

   |ABRE #dscam003;
   |ABRE #dscam014; |ABRE #pcegz100;
   |LEE 000#pcegz100.p;
   |SI FSalida ! 0;
      aAlfa = fFechaHoy; |QBF aAlfa; aAlfa = aAlfa % -104;

      |DDEFECTO #pcegz100;
      #pcegz100#142 = aAlfa;
      |GRABA 020#pcegz100.c;
      |PINPA #0#0; |PINDA #0#0;
   |SINO;
      |SI #pcegz100#142 = 0;
         aAlfa = fFechaHoy; |QBF aAlfa; aAlfa = aAlfa % -104;
         #pcegz100#142 = aAlfa;
      |FINSI;
      |PINPA #0#0; |PINDA #0#0;
      |HAZ PintaDivisa;
   |FINSI;

   |ENDATOS #1#0;
   |SI FSalida = 0;
      |GRABA 020#pcegz100.a;

      Impresora = "CrystalReport";
      |IMPRE -1;
      |SI FSalida = 0;
         |INFOR "pcegz100";
         |SI FSalida = 0;
            |HAZ Emite;
            |PRINT;
            |PIEINF; |FININF;
         |FINSI;
         |FINIMP;
      |FINSI;
   |FINSI;

   |CIERRA #dscam014; |CIERRA #pcegz100;
|FPRO;
