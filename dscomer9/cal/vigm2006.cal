     || ContaVi7

|FICHEROS;
     referen@ #100;
     vigm0006 #10;
     agifa027 #27;
     agifa036 #36;
     dsw00069 #69;
     vigm0007 #71;
     agifa142 #142;
|FIN;

|VARIABLES;
     nNum = 0;
     nUltimo = 0;
     aPath = "";

     &nCon_Conta = 0;
     &aCon_Serie = "";

     &efFecConta = @;
     fFecha = @;
     nLin = 0;
     aDef = "";
     &eaDocu = "";
     &enSwMenu      = 0;
     &enCodigo      = 0;
     &enCodAlbNegro = 0;
     &eaSerie       = "";
     &enSwSimula    = 0;
     &enDesdeX      = 0;

 {-1}aMenu          = "";
     aMenu1         = "2400";
     aMenu2         = "1";
     aMenu3         = " Contador: ";
     aMenu4         = "AM";
     aMenu5         = " Automatico ";
     aMenu6         = " Manual ";
     aClave         = "";
     aSerie         = "";
     aAlfa          = "";
     nConta         = 0;
     nNume          = 0;
     nModo          = 0;
     nSalMenu       = 0;

     &eaSwClaveRepre= "";
     nConta2        = 0;
     aRef           = "";
|FIN;

|PROCESO ContaVi7; |TIPO 7;
     |SI enSwMenu = 0;
          nModo = (FEntrada/100) !  0;
          |SI nModo ! 1; |ACABA; |FINSI;
     |FINSI;
     eaSwClaveRepre = "";||Inicializa Sw Clave Representante ver 'dsz99995'

     nConta = 1;
     aSerie = #10#52;
     #10#0 = 999999;
     |LEE 000#10];
     |SI FSalida = 0;
          |LEE 000#10a;
     |SINO;
          |LEE 000#10u;
     |FINSI;
     |SI FSalida  = 0; |Y #10#52 = aSerie;
          nConta = #10#0 + 1;
     |FINSI;

     aClave = "valbaran";
     |HAZ ContadorFicVi;

     |DDEFECTO #10;
     #10#52 = aSerie;
     |SI enSwMenu = 0;
          |SI nSalMenu = 1;
               #10#0 = nConta;
               |PTEC 802;
          |SINO;
               #10#0 = 1;
          |FINSI;
     |SINO;
          #10#0 = nConta;
     |FINSI;
     enSwMenu = 0;
|FPRC;

|PROCESO ContaVi0; |TIPO 0;
     nNume = #10#0;
     |HAZ CompruContaVi;
|FPRC;

|PROCESO ContadorFicVi;
     |ABRE #142; |LEE 000#142p; |CIERRA #142;

     |SI enSwMenu = 0;
         |SI enDesdeX = 1;
             aMenu1 = "2800";
         |FINSI;
          |MENU aMenu
          nSalMenu = FSalida;
          |SI nSalMenu ! 1; |ACABA; |FINSI;
     |FINSI;

     |SI #142#137 = "F";
          |ABRE #27;
          #27#2 = aSerie;
          #27#0 = aClave;
          |LEE  101#27=;
          |SI FSalida ! 0;
               #27#1 = 1;
               |GRABA 020#27b;
          |FINSI;
          nConta = #27#1;
          |SI enSwSimula = 0;       ||Lo usa la adj. de facturas ventas
               #27#1 = #27#1 + 1;
               |GRABA 020#27a;
          |FINSI;
          |CIERRA #27;
     |FINSI;
|FPRC;

|PROCESO CompruContaVi;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo ! 1; |ACABA; |FINSI;

     |SI #142#137 = "F"; |ACABA; |FINSI;

     |SI #142#136 ! "S";
          aAlfa = ("000000" + nConta ) % -106;
          |SI #142#136 = "N";
               |SI nNume > nConta;
                    aAlfa = "0000Numero incorrecto. No puede ser mayor de " + aAlfa;
                    |MENAV aAlfa;
                    |ERROR;
               |FINSI;
          |SINO;
               |SI nNume > nConta;
                    aAlfa = "0000Numero superior a " + aAlfa;
                    |MENAV aAlfa;
                    |CONFI "0000N¿Esta Seguro?";
                    |SI FSalida ! 0; |ERROR; |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;
