|FICHEROS;
     diam0100;
     diaz0027;
|FIN;

|VARIABLES;
     n0Ven               = 0;
     nHand               = 0;

     aFic                = "";
     aExt                = "";
     aLee                = "";
     aFac                = "";
     aPun                = "";
     aOri                = "";
     aDes                = "";
     aIP                 = "";
     aBase               = "";
     aAlfa               = "";
     aPathRem            = "";
     aFicOri             = "";
     aFicDes             = "";
     aDirDoc             = "";
     aDocRem             = "";
     aDocSer             = "";

 {1}aContiene            = "";

|FIN;

|PROCESO Exporta;
     #diaz0027#1 = #diaz0027#1 + 1;

     #diam0100#8  = "DS";
     #diam0100#11 = aLee;
     |LEE 000#diam0100.=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |SI #diam0100#0 = "      ";  |ACABA;  |FINSI;

     aFicOri = #diam0100#10;     |QBT aFicOri;
     aPun    = aFicOri % -401;
     aExt    = "";

     |SI aPun = ".";
         aExt = aFicOri % -103;
     |SINO;
         aPun    = aFicOri % -501;
         |SI aPun = ".";
             aExt = aFicOri % -104;
         |FINSI;
     |FINSI;

     |SI aExt = "";
         |ACABA;
     |FINSI;

     aDirDoc = aBase + "000577/pdfcompras/" + (("00000" + #48#0) % -105) + "/";

     aFicDes = ("00000" + #diaz0027#1) % -105;
     aFicDes = aFicDes + "_DS_" + (("000000" + #diam0100#11) % -106) + "." + aExt;

     aOri = aDirDoc + aFicOri;
     aDes = aPathRem + "/" + aFicDes;  |QBF aDes;

     aContiene1 = aDes;
     |ESPECIFICA "REMOTOMD5", aContiene;
     aDocRem = FSalida;  |QBF aDocRem;

     aContiene1 = aOri;
     |ESPECIFICA "MD5", aContiene;
     aDocSer = FSalida;  |QBF aDocSer;

     |SI aDocRem ! aDocSer;
         |SI aIP ! "";
             |ENVIA_FICHERO aOri, aDes;
         |SINO;
             |COPIA_FICHERO aOri, aDes;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO T12;  |TIPO 12;
     |SI FSalida = 7;
         |ACABA;
     |FINSI;

     aPathRem = "C:/DOCUMENTOS";              |RMKDIR aPathRem;
     aPathRem = "C:/DOCUMENTOS/DSCOMPRAS";    |RMKDIR aPathRem;
     aPathRem = "C:/DOCUMENTOS/DSCOMPRAS/";

     aIP = "";
     |IP_REMOTO aIP;  |QBF aIP;

     |DBASE aBase;  |QBT aBase;

     aFic = "F*.csv";
     |BROWSE aFic;  |QBF aFic;
     |SI aFic = "F";
         |MENAV "0000Proceso cancelado";
         |ACABA;
     |FINSI;

     aFic = aFic % 0299;
     aExt = (aFic % -103) > "";
     |SI aExt ! "CSV";
         |MENAV "0000Formato exigido CSV.";
         |ACABA;
     |FINSI;

     |XABRE "C", aFic, nHand;
     |PARA;  |SI FSalida ] 0;  |HACIENDO;
          |XLEE nHand, 250, aLee;
          |SI FSalida < 0;  |SAL;  |FINSI;

          |SI aLee ! aFac;
              |HAZ Exporta;
          |FINSI;

          aFac = aLee;
     |SIGUE;
     |XCIERRA nHand;

     aAlfa = "0000Los documentos exportados se encuentran en ";
     aAlfa = aAlfa + aPathRem;
     |MENAV aAlfa;
|FPRC;

|PROGRAMA;
     |VENTANA 0501, 0930, -1, 16, "";
     n0Ven = FSalida;

     |PINPA #0#diaz0027;
     |PINPA #0#diaz0027;
     |ENDATOS #1#diaz0027;

     |FINVENTANA n0Ven;
|FPRO;

|PROCESO T80;  |TIPO 80;
     |ABRET #diaz0027;
     |ABRET #diam0100;  |SELECT #3#diam0100;

     |LEE 101#diaz0027.p;
     |SI FSalida ! 0;
         |DDEFECTO #diaz0027;
         |GRABA 020#diaz0027.b;
     |FINSI;
|FPRC;

|PROCESO T90;  |TIPO 90;
     |GRABA 020#diaz0027.a;
     |LIBERA #diaz0027;

     |CIERRAT #diaz0027;
     |CIERRAT #diam0100;
|FPRC;
