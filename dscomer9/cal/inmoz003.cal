|FICHEROS;
     inmoz003 #0;
     inmom008 #8;
|FIN;

|VARIABLES;
     aArt = "";
     aPmp = "";
     aPart = "";
     aVMP = "";
     aFic = "";
     aLon = "";
     nPos = 0;
     nBoton = 0;
     aRuta = "";
     aAlfa = "";
     aDato = "";
     i = 0;
     aExcel = "";
     nXls = 0;
     aAlf1 = "";
     aAlf2 = "";
     nSal = 0;

     aCB = "";
     aNPalet = "";
     aIntMax = "";

     aDes = "";
     aSer = "";
     aVoc = "";
     aIsc = "";
     aFf = "";
|FIN;

|PROCESO SacaFic;
     aFic = "";
     aLon = aRuta % A0;
     |PARA i = aLon; |SI i > 0; |HACIENDO i = i - 1;
          nPos = i * 100 + 1;
          aAlfa = aRuta % nPos;
          |SI aAlfa = "/"; |O aAlfa = "\"; |SAL; |FINSI;
          aFic = aAlfa + aFic;
     |SIGUE;
|FPRC;

|PROCESO Graba;
     |DDEFECTO #8;
     #8#0 = #0#3;
     #8#1 = aCB;
     #8#2 = nXls;
     |LEE 000#8=;
     |SI FSalida ! 0;
          #8#3 = aNPalet;
          #8#4 = aIntMax;
          #8#5 = aFic;
          #8#7 = aVMP;
          #8#8 = aArt;
          #8#9 = aPmp;
          #8#10 = aPart;
          #8#11 = aDes;
          #8#12 = aSer;
          #8#13 = aVoc;
          #8#14 = aIsc;
          #8#15 = aFf;
          |GRABA 020#8n;
     |FINSI;
|FPRC;

|PROCESO ImpXLS;
     aExcel = #0#1; |QBF aAlfa;
     |XABRE "CE", aExcel, 0;
     |SI FSalida < 0
          |MENAV "0000No puedo abrir el fichero a importar";
     |SINO;
          |CARGADLL "agixl97.dll";
          |SI FSalida < 0;
               |MENAV "0000No se puede usar agixl97.dll";
          |SINO;
               |ALFACALLDLL "agixl97.dll", "carga_book", aExcel;
               |ALFACALLDLL "agixl97.dll", "selecciona_hoja", "Hoja1";
               |SI FSalida = 0;
                    |PARA nXls = 1; |SI nXls < 65536; |HACIENDO nXls = nXls + 1;
                         aAlfa = "Importando:" + nXls;
                         |PINTA 2003, aAlfa;

                         aAlf2 = "B" + nXls; |ALFACALLDLL "agixl97.dll", "peek_dato", aAlf2;
                         |SI FSalida ! 0; |SAL; |FINSI;
                         |QBF aAlf2;
                         |SI aAlf2 = ""; |SAL; |FINSI;

                         aCB = aAlf2;
                         aNPalet = "I" + nXls; |ALFACALLDLL "agixl97.dll", "peek_dato", aNPalet;
                         |SI FSalida ! 0; |SAL; |FINSI;

                         aIntMax = "D" + nXls; |ALFACALLDLL "agixl97.dll", "peek_dato", aIntMax;
                         |SI FSalida ! 0; |SAL; |FINSI;

                         aVMP = "C" + nXls; |ALFACALLDLL "agixl97.dll", "peek_dato", aVMP;
                         |SI FSalida ! 0; |SAL; |FINSI;

                         aArt = "E" + nXls; |ALFACALLDLL "agixl97.dll", "peek_dato", aArt;
                         |SI FSalida ! 0; |SAL; |FINSI;

                         aPmp = "F" + nXls; |ALFACALLDLL "agixl97.dll", "peek_dato", aPmp;
                         |SI FSalida ! 0; |SAL; |FINSI;

                         aPart = "G" + nXls; |ALFACALLDLL "agixl97.dll", "peek_dato", aPart;
                         |SI FSalida ! 0; |SAL; |FINSI;

                         aDes = "J" + nXls; |ALFACALLDLL "agixl97.dll", "peek_dato", aDes;
                         |SI FSalida ! 0; |SAL; |FINSI;

                         aSer = "K" + nXls; |ALFACALLDLL "agixl97.dll", "peek_dato", aSer;
                         |SI FSalida ! 0; |SAL; |FINSI;

                         aVoc = "L" + nXls; |ALFACALLDLL "agixl97.dll", "peek_dato", aVoc;
                         |SI FSalida ! 0; |SAL; |FINSI;

                         aIsc = "L" + nXls; |ALFACALLDLL "agixl97.dll", "peek_dato", aIsc;
                         |SI FSalida ! 0; |SAL; |FINSI;

                         aFf = "L" + nXls; |ALFACALLDLL "agixl97.dll", "peek_dato", aFf;
                         |SI FSalida ! 0; |SAL; |FINSI;

                         |HAZ Graba;
                         |SI nSal = 1; |SAL; |FINSI;
                    |SIGUE;
                    |ALFACALLDLL "agixl97.dll", "fin_book", "salva";
               |FINSI;
          |FINSI;
          |DESCARGADLL "agixl97.dll";
     |FINSI;
|FPRC;

|PROCESO Tipo3; |TIPO 3;
     |SI #0#2 ! "SI"; |ACABA; |FINSI;

     |ESTADO_CONTROL nBoton, "DISABLE";

     |ABRE #8
     #8#0 = #0#3;
     #8#1 = "";
     #8#2 = "";
     |LEE 000#8];
     |SI FSalida = 0; |Y #8#0 = #0#3;
          |MENAV "0000Expedicion existente, proceso cancelado";
     |SINO;
          aRuta = #0#1; |QBF aRuta;
          |HAZ SacaFic;
          |HAZ ImpXLS;
     |FINSI;
     |CIERRA #8;
|FPRC;

|PROCESO Tipo0; |TIPO 0;
     |SI FSalida ! 13; |ACABA; |FINSI;
     |ESTADO_CONTROL nBoton, "DISABLE";

     aRuta = #0#1;  |QBF aRuta;
     |SI aRuta = "";
         aRuta = "*.xls";
     |FINSI;
     aRuta = "F" + aRuta;

     |BROWSE aRuta;

     aRuta = aRuta % 2;
     |SI aRuta ! "F";
          #0#1 = aRuta;
     |FINSI;
     |PINTA #0#1;

     |ESTADO_CONTROL nBoton, "SHOW";
     |ERROR;
|FPRC;

|PROCESO Boton;
     |PTEC 827;
|FPRC;

|PROGRAMA;
     |ABRE #0;
     |LEE 101#0p;
     |SI FSalida ! 0; |GRABA 020#0b; |FINSI;
     |CLS;
     #0#2 = "NO";
     |PINPA #0#0;
     |PINDA #0#0;
     |CONTROL_SIMPLE 0, "BOTON, Fichero", 0910, 0918, Boton;
     nBoton = FSalida;
     |ENDATOS #1#0;
     |SI FSalida = 0;
          |GRABA 020#0a;
     |FINSI;
     |CIERRA #0;
     |FIN_CONTROL_WINDOWS nBoton;
|FPRO;
