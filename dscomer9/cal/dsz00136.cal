|FICHEROS;
     dsz00136 #0;
     agifa091 #91;
     dsw00108 #108; ||Tmp
     agifa134 #134;
     agifa142 #142;
     dsarm005@;
|FIN;

|VARIABLES;
     aPath = "";
     aTmp = "";
     &ser_fac = "";
     &num_fac = 0;
     &reimp = "";
     &eaOrdenado = "";
     &Tempo = "";
     aAlfa = "";
     nSwArchi = 0;
     aArchivada = "N";
     aEnviada = "N";
     aEmpresa = "";
|FIN;

|PROCESO BuscaDsarchi;
     #dsarm005@#84 = "FV";
     #dsarm005@#85 = #134#49;
     #dsarm005@#86 = #134#0;
     |LEE 000#dsarm005@.];
     |PARA; |SI FSalida = 0; |Y #dsarm005@#84 = "FV";
               |Y #dsarm005@#85 = #134#49; |Y #dsarm005@#86 = #134#0;
               |HACIENDO;

          |SI #dsarm005@#88 = aEmpresa;
               aArchivada = "S";
               aEnviada = #dsarm005@#82;
               |SAL;
          |FINSI;

          |LEE 000#dsarm005@.s;
     |SIGUE;
|FPRC;

|PROCESO Facturas;
     #91#0 = #134#11;
     |LEE 000#91=;
     |SI #91#69 < #0#12; |O #91#69 > #0#13; ||Tipo Recibo
          |ACABA;
     |FINSI;

     |SI #0#15 ! "T";
          |SI #134#48 ! #0#15; |ACABA; |FINSI;
     |FINSI;

     |SI #0#16 ! "T";
          |SI #134#45 ! #0#16; |ACABA; |FINSI;
     |FINSI;

     aArchivada = "N";
     aEnviada = "N";
     |SI nSwArchi = 1;
          |HAZ BuscaDsarchi;
     |FINSI;

     |SI #0#17 ! "T";
          |SI aArchivada ! #0#17; |ACABA; |FINSI;
     |FINSI;

     |SI #0#18 ! "T";
          |SI aEnviada ! #0#18; |ACABA; |FINSI;
     |FINSI;


     #108#0 = #134#49;
     #108#1 = #134#0;
     #108#2 = #134#1;
     #108#3 = #134#2;
     #108#4 = #134#3;
     #108#5 = #134#48;
     #108#6 = #134#45;
     #108#7 = aArchivada;
     #108#8 = aEnviada;
     #108#9 = #134#31;
     |GRABA 020#108n;
|FPRC;

|DEFBUCLE Facturas;
     #134#1;
     2, 1, 31, 11;
     #0#0, #0#2, #0#4, #0#6, #0#8, #0#10;
     #0#1, #0#3, #0#5, #0#7, #0#9, #0#11;
     ;
     NULL, Facturas;
|FIN;

|PROCESO T3; |TIPO 3;
     |DFICE aAlfa;
     aEmpresa = aAlfa % -205;

     |DBASS aPath;
     aAlfa = aPath + "dsarchi/def/dsarm005.mas";
     |CARGA_DEF aAlfa, dsarm005@;
     |SI FSalida ! 0;
          |MENAV "0000Error al cargar 'dsarm005' de dsarchi...";
     |SINO;
          aAlfa = aPath + "dsarchi/fich/";
          |PATH_DAT #dsarm005@#aAlfa#;

          |ABRE #dsarm005@;
          |SELECT #15#dsarm005@;
          nSwArchi = 1;
     |FINSI;

     |HAZ CreaTempo; |NOME_DAT #108 Tempo; |DELINDEX #108; aTmp = Tempo;
     |ABRE #108;
     |ABRE #91;
     |BUCLE Facturas;
     |CIERRA #91;
     |LEE 000#108p;
     |SI FSalida = 0;
          |PARA; |SI; |HACIENDO;
               |CONSULTA_CLAVE #1#108;
               |SI FSalida ! 0;
                    |SAL;
               |SINO;
                    |ABRE #134;
                    #134#49 = #108#0;
                    #134#0 = #108#1;
                    |LEE 020#134=;
                    |SI FSalida = 0;
                         ser_fac = #134#49;
                         num_fac = #134#0;
                         reimp = #134#45;
                         eaOrdenado = #142#141;
                        |SUB_EJECUTA_NP "agifa136";
                    |FINSI;
               |FINSI;
          |SIGUE;
     |SINO;
          |MENAV "0000Seleccion vacia...";
     |FINSI;
     |CIERRA #108;
     Tempo = aTmp; |HAZ BoraTempo; |DELINDEX #108;

     |SI nSwArchi = 1;
          |CIERRA #dsarm005@;
          |DESCARGA_DEF #dsarm005@;
     |FINSI;
|FPRC;

|PROGRAMA;
     |ABRE #142; |LEE 000#142p; |CIERRA #142;
     |ABRE #0;
     |LEE 101#0p;
     |SI FSalida ! 0; |GRABA 020#0b; |FINSI;
     |PINPA #0#0;
     |PINDA #0#0;
     |ENDATOS #1#0;
     |SI FSalida = 0; |GRABA 020#0a; |FINSI;
     |CIERRA #0;
|FPRO;
