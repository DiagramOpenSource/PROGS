 piens036

|FICHEROS;
 vigz0009 #0;
 vigw0006 #1;
 agifa019 #2;
 agifa017 #3;
 agifa010 #4;
 agifa071 #5;
 agifa077 #6;
 agifa080 #7;
 agifa065 #8;
 agifa029 #9;
 agifa060 #10;
 vigw0007 #11;
 vigw0008 #12;
 vigm0043 #43;
 agifa007;
|FIN;


|VARIABLES;
 &Tempo = "";
 dia2 = 0;
 tipoa = 0;
 sinoa = "";
 fecha  = "";
 fecha1 = @00.00.0000;
 primer1 =0;
 almacen = 0;
 primer = 0;
 &tipo = 0;
 familia = "";
 almac = "";
 almac1 = 0;
 descri = "";
 sw = 0;
 fam = "";
 preciom = 0;
 unidad = 0;
 importe = 0;
 aTmp1 = "";
 aTmp11 = "";
 aTmp12 = "";
 aSerie = "";
|FIN;

|PROCESO EsInterno;
     |ABRE #agifa007;
     #agifa007#26 = aSerie;
     |LEE 000#agifa007.=;
     |CIERRA #agifa007;

     |SI #agifa007#37 = "S";
          FSalida = 0;
     |SINO;
          FSalida = 1;
     |FINSI;
|FPRC;

|PROCESO lineaventa;
 |ABRE #1;
 || #1#0 = #5#13;
 |ABRE #2;#2#0 = #5#2;|LEE 010#2=;|LIBERA #2;|CIERRA #2;
 fam = #2#2;
 #1#0 = #2#2;
 #1#1 = #5#2;
 #1#11 = #5#3;
 |LEE 010#1=;
 |SI FSalida ! 0;
   |DDEFECTO #1;
 ||  #1#0 = #5#13;
   #1#0 = #2#2;
   #1#1 = #5#2;
   #1#11 = #5#3;
   |GRABA 010#1b;
   |LIBERA #1;
 |FINSI;
 #1#6 = #1#6 + #5#5;
 #1#8 = #1#8 + #5#9;
 |GRABA 010#1a;
 |LIBERA #1;
 |CIERRA #1;
 |ABRE #9;
 #9#0 = #5#3;|LEE 010#9=;|LIBERA #9;|CIERRA #9;
 |SI #9#6 = 2;
   almac1 = 98;
   descri = "Resumen Piensos: ";
   sw = 1;
 |SINO;
   |SI #9#6 = 5;
     almac1 = 97;
     descri = "Resumen Premez.: ";
     sw = 1;
   |SINO;
     sw = 0;
   |FINSI;
 |FINSI;
 |SI sw = 1;
   |HAZ resuven;
 |FINSI;
 |ABRE #10;
 #10#0 = #2#2;|LEE 010#10=;|LIBERA #10;|CIERRA #10;
 |SI #10#4 = 11;
    almac1 = 96;
    descri = "Resumen Ufalac";
    |HAZ resuven;
 |SINO;
   |SI #10#4 = 12;
     almac1 = 95;
     descri = "Resumen Premezclas";
     |HAZ resuven;
   |FINSI;
 |FINSI;
|FPRC;

|PROCESO resuven;
  |ABRE #9;
  #9#0 = almac1;
  |LEE 010#9=;
  |SI FSalida ! 0;
   |DDEFECTO #9;
   #9#0 = almac1;
   #9#1 = descri;
   |GRABA 010#9b;
   |LIBERA #9;
  |FINSI;
  |LIBERA #9;
  |CIERRA #9;
  |ABRE #1;
  #1#0 = #2#2;
  #1#1 = #5#2;
  #1#11 = almac1;
  |LEE 010#1=;
  |SI FSalida ! 0;
    |DDEFECTO #1;
    #1#0 = #2#2;
    #1#1 = #5#2;
    #1#11 = almac1;
    |GRABA 010#1b;
    |LIBERA #1;
  |FINSI;
  #1#6 = #1#6 + #5#5;
  #1#8 = #1#8 + #5#9;
  |GRABA 010#1a;
  |LIBERA #1;
  |CIERRA #1;
|FPRC;

|PROCESO venta;
     aSerie = #agifa010#52;
     |HAZ EsInterno;
     |SI FSalida ! 0;
          |BUCLELIN 0lineaventa#4;
     |FINSI;
|FPRC;

|DEFBUCLE ventas;
#4#7;
;
#0#0, "     ", 000001;
#0#1, "zzzzz", 999999;
be;
NULL,venta;
|FIN;

|DEFBUCLE ventas1;
#4#3;
;
"      ", fecha1, "     ", 000001;
"zzzzzz", #0#4,   "zzzzz", 999999;
be;
NULL,venta;
|FIN;


|PROCESO resucon;
|ABRE #9;
#9#0 = almac1;
|LEE 010#9=;
|SI FSalida ! 0;
 |DDEFECTO #9;
 #9#0 = almac1;
 #9#1 = descri;
 |GRABA 010#9b;
 |LIBERA #9;
|FINSI;
|CIERRA #9;
|ABRE #1;
#1#0 = #2#2;
#1#1 = #7#2;
#1#11 = almac1;
|LEE 010#1=;
|SI FSalida ! 0;
 |DDEFECTO #1;
 #1#0 = #2#2;
 #1#1 = #7#2;
 #1#11 = almac1;
 |GRABA 010#1b;
 |LIBERA #1;
|FINSI;
#1#9 = #1#9 + #7#5;
#1#10 = #1#10 + #7#9 + (#7#31*#7#5);
|GRABA 010#1a;
|LIBERA #1;
|CIERRA #1;
|FPRC;

|PROCESO lineacompra;
|ABRE #9;
#9#0 = #7#3;
|LEE 010#9=;|LIBERA #9;|CIERRA #9;
 |ABRE #1;
 |ABRE #2;#2#0 = #7#2;|LEE 010#2=;
 |SI FSalida ! 0;|DDEFECTO #2;|FINSI;
 |LIBERA #2;|CIERRA #2;
 #1#0 = #2#2;
 #1#1 = #7#2;
 #1#11 = #7#3;
 |LEE 010#1=;
 |SI FSalida ! 0;
   |DDEFECTO #1;
   #1#0 = #2#2;
   #1#1 = #7#2;
   #1#11 = #7#3;
   |GRABA 010#1b;
   |LIBERA #1;
 |FINSI;
 #1#9 = #1#9 + #7#5;
 #1#10 = #1#10 + #7#9 + (#7#31*#7#5); || mas portes
 |GRABA 010#1a;
 |LIBERA #1;
 |CIERRA #1;
 || ***********************************
 |ABRE #9;
 #9#0 = #7#3;|LEE 010#9=;
 |SI FSalida ! 0;|DDEFECTO #9;|FINSI;
 |LIBERA #9;|CIERRA #9;
 |SI #9#6 = 2;
   almac1 = 98;
   descri = "Resumen Piensos: ";
   |HAZ resucon;
   sw = 1;
 |SINO;
   |SI #9#6 = 5;
     almac1 = 97;
     descri = "Resumen Premez.: ";
     |HAZ resucon;
     sw = 1;
   |SINO;
     sw = 0;
   |FINSI;
 |FINSI;
 |ABRE #10;
 #10#0 = #2#2;|LEE 010#10=;|LIBERA #10;|CIERRA #10;
 |SI #10#4 = 11;
    almac1 = 96;
    descri = "Resumen Ufalac";
    |HAZ resucon;
 |SINO;
   |SI #10#4 = 12;
     almac1 = 95;
     descri = "Resumen Premezclas";
     |HAZ resucon;
   |FINSI;
 |FINSI;
|| ***********************************
|FPRC;

|PROCESO compra;
 |BUCLELIN 0lineacompra#6;
|FPRC;

|DEFBUCLE compras;
#6#3;
;
"      ", #0#0, "     ", 000001;
"zzzzzz", #0#1, "zzzzz", 999999;
be;
NULL,compra;
|FIN;

|DEFBUCLE compras1;
#6#3;
;
"      ", fecha1, "     ", 000001;
"zzzzzz", #0#4, "zzzzz", 999999;
be;
NULL,compra;
|FIN;

|PROCESO imprime;
|ABRE #2;
|ABRE #3;
#2#0 = #1#1;
|LEE 010#2=;
|SI FSalida = 0;
  #1#2 = #2#2;
  |SI #1#11 ] 94;
     |ABRE #11;
     #11#0=#2#0;
     |LEE 010#11=;
     |SI FSalida ! 0;|DDEFECTO #11;|FINSI;
     |LIBERA #11;|CIERRA #11;
     #1#3 = #11#1;
     #1#4 = #11#4;
     #1#7 = #1#4;
  |FINSI;
|FINSI;
|SI #1#11 < 94;
  #3#0 = #1#1;
  #3#1 = #1#11;
  |LEE 010#3=;
  |SI FSalida = 0;
   ||  |SI #1#1 = "8066         ";|Y #1#11 = 43;|PAUSA;|FINSI;
   |ABRE #12;
   #12#0 = #3#0;
   #12#1 = #3#1;
   |LEE 010#12=;
   |SI FSalida ! 0;|DDEFECTO #12;|FINSI;
   |LIBERA #12;|CIERRA #12;
   |ABRE #11;
   #11#0 = #1#1;
   |LEE 010#11=;
   |SI FSalida ! 0;|DDEFECTO #11;|FINSI;
   |LIBERA #11;
   |CIERRA #11;
   #1#3 = #12#2;
   #1#4 = #11#4;
   #1#7 = #1#4;
   |CIERRA #12;
  |FINSI;
|FINSI;
  #1#5 = #1#3 * #1#4;
  #1#13 = #1#12 * #1#4;
  |GRABA 010#1a;
  |LIBERA #1;
tipo = 1;
|SI familia ! #1#0;
  |SI primer1 = 0;
    primer1=1;
  |SINO;
    tipo = 2;
    |PRINT;
    tipo = 1;
  |FINSI;
  familia = #1#0;
|FINSI;
|SI almacen ! #1#11;
  |SI primer = 0;
    primer = 1;
  |SINO;
    |PIEINF;
  |FINSI;
  almacen = #1#11;
|FINSI;
|PRINT;
|FPRC;

|DEFBUCLE repaso;
#1#1;
;
INICIO;
FINAL;
be;
NULL,imprime;
|FIN;

|PROCESO regular1;
 |ABRE #9;
 #9#0 = almac1;
 |LEE 010#9=;
 |SI FSalida ! 0;
   |DDEFECTO #9;
   #9#0 = almac1;
   #9#1 = descri;
   |GRABA 010#9b;
   |LIBERA #9;
 |FINSI;
 |CIERRA #9;
 |SI #8#2 = "SS";|O #8#2 = "ES";|O #8#2 = "EV";
    |ABRE #2;
    #2#0  = #8#0;
    |LEE 010#2=;
    |SI FSalida = 0;
       |ABRE #1;
       #1#0 = #2#2;
       #1#1 = #8#0;
       #1#11 = almac1;
       |LEE 010#1=;
       |SI FSalida ! 0;
          |DDEFECTO #1;
          #1#0 = #2#2;
          #1#1 = #8#0;
          #1#11 = almac1;
          |GRABA 010#1b;
          |LIBERA #1;
       |FINSI;
       #1#12 = #1#12 + #8#6;
       |GRABA 010#1a;
       |LIBERA #1;
       |CIERRA #1;
    |FINSI;
 |FINSI;
 |SI #8#2 = "TE";|O #8#2 = "TS";|O #8#2 = "ME"; |O #8#2 = "MS";
     |ABRE #2;
     #2#0  = #8#0;
     |LEE 010#2=;
     |SI FSalida = 0;
        |ABRE #1;
        #1#0 = #2#2;
        #1#1 = #8#0;
        #1#11 = almac1;
        |LEE 010#1=;
        |SI FSalida ! 0;
           |DDEFECTO #1;
           #1#0 = #2#2;
           #1#1 = #8#0;
           #1#11 = almac1;
           |GRABA 010#1b;
           |LIBERA #1;
        |FINSI;
        #1#15 = #1#15 + #8#6;
        |GRABA 010#1a;
        |LIBERA #1;
        |CIERRA #1;
     |FINSI;
 |FINSI;
 |SI #8#2 = "SF";
    |ABRE #2;#2#0 = #8#0;|LEE 010#2=;|LIBERA #2;|CIERRA #2;
    |ABRE #1;
    #1#0 = #2#2;
    #1#1 = #8#0;
    #1#11 = almac1;
    |LEE 010#1=;
    |SI FSalida ! 0;
      |DDEFECTO #1;
      #1#0 = #2#2;
      #1#1 = #8#0;
      #1#11 = almac1;
      |GRABA 010#1b;
      |LIBERA #1;
    |FINSI;
    #1#14 = #1#14 + #8#6;
    #1#16 = #1#16 + (#8#6*#8#9);
    |GRABA 010#1a;
    |LIBERA #1;
    |CIERRA #1;
 |FINSI;
 |SI #8#2 = "FB";
  |ABRE #2;#2#0 = #8#0;|LEE 010#2=;
  |SI FSalida ! 0;
    |DDEFECTO #2;
  |FINSI;
  |LIBERA #2;|CIERRA #2;
||  |SI tipoa = 2;   ||PARA CUANDO SE CONTROLABA POR TIPO ALMACEN
||    |SI sinoa = "S";
      |ABRE #1;
      #1#0 = #2#2;
      #1#1 = #8#0;
      #1#11 = almac1;
      |LEE 010#1=;
      |SI FSalida ! 0;
        |DDEFECTO #1;
        #1#0 = #2#2;
        #1#1 = #8#0;
        #1#11 = almac1;
        |GRABA 010#1b;
        |LIBERA #1;
      |FINSI;
    ||  #1#9 = #1#9 + #8#6;   ||CUANDO SE CONTROLABA SI EL ALMACEN ES DE COMPRAS
    ||  #1#10 = #1#10 + (#8#6 * #8#9);
      #1#14 = #1#14 + #8#6;   ||CUANDO SE CONTROLABA SI EL ALMACEN ES DE COMPRAS
      #1#16 = #1#16 + (#8#6 * #8#9);
      |GRABA 010#1a;
      |LIBERA #1;
      |CIERRA #1;
    |FINSI;
||  |FINSI;
|| |FINSI;
 |LIBERA #2;
 |CIERRA #2;
|FPRC;

|PROCESO regular;
     aSerie = #agifa065#11;
     |HAZ EsInterno;
     |SI FSalida = 0; |ACABA; |FINSI;


 |SI #8#2 = "SS";|O #8#2 = "ES";|O #8#2 = "EV";
    |ABRE #2;
    #2#0  = #8#0;
    |LEE 010#2=;
    |SI FSalida = 0;
       |ABRE #1;
       #1#0 = #2#2;
       #1#1 = #8#0;
       #1#11 = #8#5;
       |LEE 010#1=;
       |SI FSalida ! 0;
          |DDEFECTO #1;
          #1#0 = #2#2;
          #1#1 = #8#0;
          #1#11 = #8#5;
          |GRABA 010#1b;
          |LIBERA #1;
       |FINSI;
       #1#12 = #1#12 + #8#6;
       |GRABA 010#1a;
       |LIBERA #1;
       |CIERRA #1;
    |FINSI;
 |FINSI;
  |SI #8#2 = "TE";|O #8#2 = "TS"; |O #8#2 = "MS"; |O #8#2 = "ME";
     |ABRE #2;
     #2#0  = #8#0;
     |LEE 010#2=;
     |SI FSalida = 0;
        |ABRE #1;
        #1#0 = #2#2;
        #1#1 = #8#0;
        #1#11 = #8#5;
        |LEE 010#1=;
        |SI FSalida ! 0;
           |DDEFECTO #1;
           #1#0 = #2#2;
           #1#1 = #8#0;
           #1#11 = #8#5;
           |GRABA 010#1b;
           |LIBERA #1;
        |FINSI;
        #1#15 = #1#15 + #8#6;
        |GRABA 010#1a;
        |LIBERA #1;
        |CIERRA #1;
     |FINSI;
  |FINSI;
 |SI #8#2 = "SF";
    |ABRE #2;#2#0 = #8#0;|LEE 010#2=;|LIBERA #2;|CIERRA #2;
    |ABRE #1;
    #1#0 = #2#2;
    #1#1 = #8#0;
    #1#11 = #8#5;
    |LEE 010#1=;
    |SI FSalida ! 0;
      |DDEFECTO #1;
      #1#0 = #2#2;
      #1#1 = #8#0;
      #1#11 = #8#5;
      |GRABA 010#1b;
      |LIBERA #1;
    |FINSI;
    #1#14 = #1#14 + #8#6;
    #1#16 = #1#16 + (#8#6*#8#9);
    |GRABA 010#1a;
    |LIBERA #1;
    |CIERRA #1;
 |FINSI;
 |SI #8#2 = "FB";
  |ABRE #2;#2#0 = #8#0;|LEE 010#2=;
  |SI FSalida ! 0;|DDEFECTO #2;|FINSI;
  |LIBERA #2;|CIERRA #2;
  |ABRE #9;#9#0=#8#5;|LEE 010#9=;
  |SI FSalida ! 0;|DDEFECTO #9;|FINSI;
  |LIBERA #9;|CIERRA #9;
||  |SI #9#6 = 2;
||    |SI #9#7 = "S";
      |ABRE #1;
      #1#0 = #2#2;
      #1#1 = #8#0;
      #1#11 = #8#5;
      |LEE 010#1=;
      |SI FSalida ! 0;
        |DDEFECTO #1;
        #1#0 = #2#2;
        #1#1 = #8#0;
        #1#11 = #8#5;
        |GRABA 010#1b;
        |LIBERA #1;
      |FINSI;
||      #1#9 = #1#9 + #8#6;    ||cuando se controlaba por almacen de piensos
||      #1#10 = #1#10 + (#8#6 * #8#9);
        #1#14 = #1#14 + #8#6; ||toda la fabricacion a fabricacion
        #1#16 = #1#16 + (#8#6 * #8#9);
      |GRABA 010#1a;
      |LIBERA #1;
      |CIERRA #1;
||    |FINSI;
||  |FINSI; ||si el almacen es de piensos
 |FINSI;
 |LIBERA #2;
 |CIERRA #2;
 || ***********************************
  |ABRE #9;
  #9#0 = #8#5;|LEE 010#9=;
  |SI FSalida ! 0;
   |DDEFECTO #9;
  |FINSI;
  |LIBERA #9;|CIERRA #9;
  |SI #9#6 = 2;
    almac1 = 98;
    descri = "Resumen Piensos: ";
    tipoa = 2;
    sinoa = "S";
    |HAZ regular1;
  |SINO;
    |SI #9#6 = 5;
      almac1 = 97;
      descri = "Resumen Premez.: ";
      tipoa = 5;
      sinoa = "N";
     |HAZ regular1;
    |FINSI;
  |FINSI;
  |ABRE #10;
  #10#0 = #2#2;|LEE 010#10=;|LIBERA #10;|CIERRA #10;
  |SI #10#4 = 11;
     almac1 = 96;
     descri = "Resumen Ufalac";
     |HAZ regular1;
  |SINO;
    |SI #10#4 = 12;
      almac1 = 95;
      descri = "Resumen Premezclas";
      |HAZ regular1;
    |FINSI;
  |FINSI;
 || ***********************************
|FPRC;

|DEFBUCLE regul;
#8#4;
;
#0#0, 00001, "                    ";
#0#1, 99999, "zzzzzzzzzzzzzzzzzzzz";
be;
NULL,regular;
|FIN;

|DEFBUCLE regul1;
#8#4;
;
fecha1, 00001, "                    ";
#0#4, 99999, "zzzzzzzzzzzzzzzzzzzz";
be;
NULL,regular;
|FIN;

|PROCESO impre2;
#1#13 = #1#12 * #1#4;
|ABRE #2;
#2#0 = #1#1;
|LEE 010#2=;
|LIBERA #2;
|CIERRA #2;
tipo = 1;
|SI familia ! #1#0;
  |SI primer1 = 0;
    primer1=1;
  |SINO;
    tipo = 2;
    |PRINT;
    tipo = 1;
  |FINSI;
  familia = #1#0;
|FINSI;
|SI almacen ! #1#11;
  |SI primer = 0;
    primer = 1;
  |SINO;
    |PIEINF;
  |FINSI;
  almacen = #1#11;
|FINSI;
|PRINT;
|FPRC;

|DEFBUCLE impr2;
#1#1;
;
INICIO;
FINAL;
be;
NULL,impre2;
|FIN;

|PROCESO sth;
     aSerie = #agifa065#11;
     |HAZ EsInterno;
     |SI FSalida = 0; |ACABA; |FINSI;

|ABRE #11;
#11#0 = #8#0;
|LEE 010#11=;
|SI FSalida ! 0;
  |DDEFECTO #11;
  #11#0 = #8#0;
  |GRABA 010#11b;
  |LIBERA #11;
|FINSI;
#11#1 = #11#1 + #8#6;
|SI #8#2 = "AC";|O #8#2 = "BC"; |O #8#2 = "EV";|O #8#2="FB";
  #11#3 = #11#3 + #8#6;
  #11#2 = #11#2 + (#8#6*#8#9);
|FINSI;
|SI #8#8 ! 0;   ||SI EL MOVIMIENTO NO TIENE PRECIO MEDIO, DEBE COGER EL ANTERIOR
  #11#4 = #8#8;
|FINSI;
|GRABA 010#11a;
|LIBERA #11;
|CIERRA #11;
|ABRE #12;
#12#0 = #8#0;
#12#1 = #8#5;
|LEE 010#12=;
|SI FSalida ! 0;
  |DDEFECTO #12;
  #12#0 = #8#0;
  #12#1 = #8#5;
  |GRABA 010#12b;
  |LIBERA #12;
|FINSI;
#12#2 = #12#2 + #8#6;
|GRABA 010#12a;
|LIBERA #12;
|CIERRA #12;
|SI #8#1 ] #0#0;|Y #8#1 [ #0#1;
 |HAZ regular;
|FINSI;
|FPRC;

|DEFBUCLE stockh;
#8#4;
;
"01.01.1900", 00001, "                    ";
#0#1,         99999, "zzzzzzzzzzzzzzzzzzzz";
be;
NULL,sth;
|FIN;

|PROCESO sta;
|ABRE #11;
#11#0 = #2#0;
|LEE 010#11=;
|SI FSalida ! 0;
  |DDEFECTO #11;
  #11#0 = #2#0;
  |GRABA 010#11b;
  |LIBERA #11;
|FINSI;
#11#1 = #2#6;
#11#2 = #2#9;
#11#3 = 1;
|GRABA 010#11a;
|LIBERA #11;
|CIERRA #11;
|FPRC;

|DEFBUCLE stocka;
#2#1;
;
INICIO;
FINAL;
be;
NULL,sta;
|FIN;

|PROCESO sta1;
 |ABRE #12;
 #12#0 = #3#0;
 #12#1 = #3#1;
 |LEE 010#12=;
 |SI FSalida ! 0;
   |DDEFECTO #12;
   #12#0 = #3#0;
   #12#1 = #3#1;
   |GRABA 010#12b;
 |FINSI;
 #12#2 = #3#5;
 |GRABA 010#12a;
 |LIBERA #12;
 |CIERRA #12;
|FPRC;

|DEFBUCLE stocka1;
#3#1;
;
INICIO;
FINAL;
be;
NULL,sta1;
|FIN;

|PROCESO crea;
 |ABRE #2;
 #2#0 = #3#0;
 |LEE 010#2=;
 |SI FSalida ! 0; |DDEFECTO #2;|FINSI;
 |CIERRA #2;
 |ABRE #10;
 #10#0 = #2#2;
 |LEE 010#10=;
 |SI FSalida ! 0; |DDEFECTO #10;|FINSI;
 |CIERRA #10;
 |ABRE #9;
 #9#0 = #3#1;
 |LEE 010#9=;
 |SI FSalida ! 0; |DDEFECTO #9;|FINSI;
 |CIERRA #9;
 |ABRE #1;
 #1#0 = #2#2;
 #1#1 = #3#0;
 #1#11 = #3#1;
 |LEE 010#1=;
 |SI FSalida ! 0;
   |DDEFECTO #1;
   #1#0 = #2#2;
   #1#1 = #3#0;
   #1#11 = #3#1;
   |GRABA 010#1n;
   |LIBERA #1;
 |FINSI;
 |SI #10#4 = 12;
   #1#0 = #2#2;
   #1#1 = #3#0;
   #1#11 = 95;
   |LEE 010#1=;
   |SI FSalida ! 0;
     |DDEFECTO #1;
     #1#0 = #2#2;
     #1#1 = #3#0;
     #1#11 = 95;
     |GRABA 010#1n;
     |LIBERA #1;
   |FINSI;
 |FINSI;
 |SI #10#4 = 11;
    #1#0 = #2#2;
    #1#1 = #3#0;
    #1#11 = 96;
    |LEE 010#1=;
    |SI FSalida ! 0;
      |DDEFECTO #1;
      #1#0 = #2#2;
      #1#1 = #3#0;
      #1#11 = 96;
      |GRABA 010#1n;
      |LIBERA #1;
    |FINSI;
  |FINSI;
  |SI #9#6 = 2;
    #1#0 = #2#2;
    #1#1 = #3#0;
    #1#11 = 98;
    |LEE 010#1=;
    |SI FSalida ! 0;
      |DDEFECTO #1;
      #1#0 = #2#2;
      #1#1 = #3#0;
      #1#11 = 98;
      |GRABA 010#1n;
      |LIBERA #1;
    |FINSI;
  |FINSI;
  |SI #9#6 = 5;
    #1#0 = #2#2;
    #1#1 = #3#0;
    #1#11 = 97;
    |LEE 010#1=;
    |SI FSalida ! 0;
      |DDEFECTO #1;
      #1#0 = #2#2;
      #1#1 = #3#0;
      #1#11 = 97;
      |GRABA 010#1n;
      |LIBERA #1;
    |FINSI;
   |FINSI;
 |CIERRA #1;
|FPRC;

|DEFBUCLE primero;
#3#1;
;
INICIO;
FINAL;
be;
NULL,crea;
|FIN;

|PROCESO ResuTras;
     |DDEFECTO #9;
     |ABRE #9;
     #9#0 = almac1;
     #9#1 = descri;
     |LEE 101#9=;
     |SI FSalida ! 0; |GRABA 010#9b; |FINSI;
     |LIBERA #9;
     |CIERRA #9;

     |DDEFECTO #1;
     |ABRE #1;
     #1#0 = #43#11;
     #1#1 = #43#12;
     #1#11 = almac1;
     |LEE 101#1=;
     |SI FSalida ! 0; |GRABA 020#1b; |FINSI;

     #1#6 = #1#6 + #43#13;
     #1#8 = #1#8 + #43#15;
     |GRABA 020#1a;
     |LIBERA #1;
     |CIERRA #1;
|FPRC;

|PROCESO HistoTras;
     aSerie = #43#0;
     |HAZ EsInterno;
     |SI FSalida = 0; |ACABA; |FINSI;

     |DDEFECTO #1;
     |ABRE #1;
     fam = #43#11;
     #1#0 = #43#11;
     #1#1 = #43#12;
     #1#11 = #43#17;
     |LEE 101#1=;
     |SI FSalida ! 0; |GRABA 010#1b; |FINSI;

     #1#6 = #1#6 + #43#13;
     #1#8 = #1#8 + #43#15;
     |GRABA 020#1a;
     |LIBERA #1;
     |CIERRA #1;

     |ABRE #9;
     #9#0 = #43#17;|LEE 010#9=;|LIBERA #9;|CIERRA #9;
     |SI #9#6 = 2;
          almac1 = 98;
          descri = "Resumen Piensos: ";
          sw = 1;
     |SINO;
          |SI #9#6 = 5;
               almac1 = 97;
               descri = "Resumen Premez.: ";
               sw = 1;
          |SINO;
               sw = 0;
          |FINSI;
     |FINSI;
     |SI sw = 1;
          |HAZ ResuTras
     |FINSI;
     |ABRE #10;
     #10#0 = #43#11;|LEE 010#10=;|LIBERA #10;|CIERRA #10;
     |SI #10#4 = 11;
          almac1 = 96;
          descri = "Resumen Ufalac";
          |HAZ ResuTras
     |SINO;
          |SI #10#4 = 12;
               almac1 = 95;
               descri = "Resumen Premezclas";
               |HAZ ResuTras
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE HistoTras;
     #43#3;
     ;
     #0#0;
     #0#1;
     ;
     NULL, HistoTras;
|FIN;

|PROGRAMA;
|CLS;
|HAZ CreaTempo; |NOME_DAT #1 Tempo; aTmp1 = Tempo;
|DELINDEX #1;
|HAZ CreaTempo; |NOME_DAT #11 Tempo; aTmp11 = Tempo;
|DELINDEX #11;
|HAZ CreaTempo; |NOME_DAT #12 Tempo; aTmp12 = Tempo;
|DELINDEX #12;

|PINPA #0#0;
|DDEFECTO #0;
|PINDA #0#0;
|ENDATOS #1#0;
|SI FSalida = 0;
 fecha = #0#0
 fecha = fecha % -104;
 fecha = "01.01."+fecha;
 fecha1 = fecha;
 dia2 = #0#0 -1;
 #0#4 = dia2;
 |PINTA 1910,"Creando Fichero inicial.......";
 |BUCLE primero;
 |PINTA 1910,"Calculando Stock..............";
 |SI #0#3 = "F";
   |BUCLE stockh;
 |SINO;
   |BUCLE stocka;
   |BUCLE stocka1;
 |FINSI;
 |PINTA 1910,"Acumulando Ventas.............";
 |BUCLE ventas;
 |BUCLE HistoTras;
 |PINTA 1910,"Acumulando Compras............";
 |BUCLE compras;
 |PINTA 1910,"Acumulando Regularizaciones..."
 |SI #0#3 = "A";
   |BUCLE regul;
 |FINSI;
 |PINTA 1910,"Imprimiendo...................";
 |IMPRE 0;
 |SI FSalida  = 0;
   |INFOR "vigz0009";
   |SI FSalida = 0;
     |BUCLE repaso;
     tipo = 2;
     |PRINT;
     |PIEINF;
   |FINSI;
   |FININF;
   |PINTA 1910,"Acumulando Ventas a¤o.........";
   |BUCLE ventas1;
   |PINTA 1910,"Acumulando Compras a¤o........";
   |BUCLE compras1;
   |PINTA 1910,"Acumulando Regulariz. a¤o ....";
   |BUCLE regul1;
   |INFOR "vigz1009";
   |SI FSalida = 0;
     primer = 0;
     primer1 = 0;
     |BUCLE impr2;
     tipo = 2;
     |PRINT;
     |PIEINF;
   |FINSI;
   |FININF;
 |FINSI;
 |FINIMP;
|FINSI;
Tempo = aTmp1; |HAZ BoraTempo; |DELINDEX #1;
Tempo = aTmp11; |HAZ BoraTempo; |DELINDEX #11;
Tempo = aTmp12; |HAZ BoraTempo; |DELINDEX #12;
|FPRO;
