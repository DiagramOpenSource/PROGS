|FICHEROS;
     diam0015 #15;
     diam0016 #16;
     diam0017 #17,MANTE;
     agifa019 #19;
     agifa024 #24;
     agifa142 #142;

     diaw0018 #100;
|FIN;

|VARIABLES;
     &Tempo = "";
     aAlfa        = "";
     aAlfa1       = "";

     nModo        = 0;

     &enDirEnt    = 0;
     &enPromo     = 0;
     &efFecha     = @;
     &nPromo = 0;
     &uni_dt = 0;   || Unidades
     &fed_dt = @;   || Fecha....
     &art_dt = "";  || Articulo.
     &cli_dt = "";  || Cliente..
     &fam_dt = "";  || Familia.
     &iva_dt = 0;   || Tipo Iva.
     &dtos_2 = 0;   || Descuento 2.
     &dto_pt = 0;   || Descuento Ptas.
     &dtos_1 = 0;   || Descuento 1.
     &pvp_ve = 0;   || Precio Venta.
     &gru_dt = "";  || Grupo Cliente.
     &tarifa = 0;   || Tarifa Cliente.
     &quedto = 0;   || 1=cli./art, 2=cli./familia, 3=cli./subfam.
     &enMensaje = 0;
     &aParam  = "";
     &eaCompras = "";
     &enHard    = 0;
|FIN;

|PROCESO ClaveBaja19;
     #19#2 = #17#3;
     #19#0 = "";
|FPRC;

|PROCESO ClaveAlta19;
     #19#2 = #17#3;
     #19#0 = "zzzzzzzzzzzzzzzzzzzz";
|FPRC;

|PROCESO CogeProducto;  |TIPO 7;
     nModo = (FEntrada / 100) ! 0;

     |SI nModo ! 1;                       |ACABA;  |FINSI;
     |SI #17#5 ! "                    ";  |ACABA;  |FINSI;

     |SI #17#3 = #15#34;
         #17#5 = #15#35;
         #17#6 = #15#36;
     |FINSI;

     |SI #17#3 = #15#37;
         #17#5 = #15#38;
         #17#6 = #15#39;
     |FINSI;

     |PINTA #17#5;
     |PINTA #17#6;
|FPRC;

|PROCESO Temporal;
   |DDEFECTO #diaw0018;
   #diaw0018#0 = #agifa019#0;
   #diaw0018#1 = #agifa019#1;
   #diaw0018#2 = #agifa019#2;
   #diaw0018#3 = #agifa019#125;
   #diaw0018#4 = #agifa019#126;
   |GRABA 020#diaw0018.n;
|FPRC;

|DEFBUCLE Temporal;
#agifa019#7;
125;
#17#3, "                    ", "S1";
#17#3, "zzzzzzzzzzzzzzzzzzzz", "S1";
;
NULL,Temporal;
|FIN;

|PROCESO ConsuProducto;  |TIPO 66;
     |HAZ CreaTempo;
     |NOME_DAT #diaw0018#Tempo#; |DELINDEX #diaw0018; |ABRE #diaw0018;
     |BUCLE Temporal;
     #diaw0018#2 = #17#3;
     #diaw0018#0 = #17#5;
     |LEE 000#diaw0018.];
     |CONSULTA_CLAVE #2#diaw0018;
     |SI FSalida = 0;
         #17#5 = #diaw0018#0;  |PINTA #17#5;
     |FINSI;
     |CIERRA #diaw0018;
     |HAZ BoraTempo; |DELINDEX #diaw0018;
/*
     |ABRE #19;
     |SELECT #7#19;
     #19#2 = #17#3;
     #19#0 = #17#5;
     |LEE 040#19=;
     aAlfa = #17#3; aAlfa = aAlfa % -102;
     aAlfa1 = #17#2;
     |CONSULTA_F_CLAVE #7#19, ClaveBaja19, ClaveAlta19;
     |SI FSalida = 0;
         #17#5 = #19#0;  |PINTA #17#5;
     |FINSI;
     |CIERRA #19;
*/
     |ERROR;
|FPRC;

|PROCESO Producto;
     nModo = (FEntrada / 100) ! 0;

     |ABRE #19;
     #19#0 = #17#5;
     |LEE 040#19=;
     |SI FSalida ! 0;
         |MENAV "0000 Producto inexistente.";
         |ERROR;
         |CIERRA #19;
         |ACABA;
     |FINSI;
     |CIERRA #19;

     |SI #19#2 ! #17#3;
         |MENAV "0000 Producto con familia distinta.";
         |ERROR;
         |ACABA;
     |FINSI;

     |SI #17#5 ! Contenido;
         #17#6 = #19#1;  |PINTA #17#6;
     |FINSI;

     |SI nModo ! 1;  |ACABA;  |FINSI;

     |ABRE #142;
     |LEE 040#142p;
     |SI FSalida ! 0;  |DDEFECTO #142;  |FINSI;
     |CIERRA #142;

     |ABRE #24;
     #24#0 = #16#0;
     |LEE 000#24=;
     |CIERRA #24;

     |SI #142#60 = 1; #17#10 = #19#9;   |FINSI;
     |SI #142#60 = 2; #17#10 = #19#28;  |FINSI;
     |SI #142#60 = 3; #17#10 = #19#133; |FINSI;
     |PINTA #17#10;

     fed_dt    = #16#1;   || Fecha....
     art_dt    = #17#5;   || Articulo.
     cli_dt    = #16#0;   || Cliente..
     fam_dt    = #19#2;  || Familia.
     iva_dt    = #19#30; || Tipo Iva.
     dtos_2    = 0;      || Descuento 2.
     dto_pt    = 0;      || Descuento Ptas.
     dtos_1    = 0;      || Descuento 1.
     pvp_ve    = 0;      || Precio Venta.
     tarifa    = #24#39; || Tarifa Cliente....
     gru_dt    = #24#158;|| Grupo Cliente.
     uni_dt    = 0;
     enMensaje = 0;
     enDirEnt  = 0;
     aParam    = "";
     |SI #19#176 = "S";  enMensaje = 1;  |FINSI;

     |HAZ calcdtos;

     #17#8 = pvp_ve - dto_pt;   || Precio Venta. sin iva.
     |PINTA #17#8;
|FPRC;

|PROCESO Total;
     #17#9  = #17#7 * #17#8;   |PINTA #17#9;
     #17#11 = #17#7 * #17#10;  |PINTA #17#11;
|FPRC;

|PROCESO Pedido;
     |SI eaCompras ! "S";
         |C_M #17#13, 1, "N";
         |ACABA;
     |FINSI;

     |C_M #17#13, 1, "S";

     |SI #17#12 = "N";
         |C_M #17#13, 1, "N";
         #17#13 = "";
         |PINTA #17#13;
     |FINSI;
|FPRC;

|PROCESO Tipo2m17;  |TIPO 2;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo  ! 3;  |ACABA;  |FINSI;
     |SI enHard = 0;  |ACABA;  |FINSI;

     |DBASE aAlfa;  |QBF aAlfa;
     aAlfa = aAlfa + "000577/documentos";
     aAlfa = aAlfa + "/" + #17#14;  |QBF aAlfa;
     |FBORRA aAlfa;
|FPRC;

|PROCESO Tipo0m17; |TIPO 0;
     nModo = (FEntrada / 100) ! 0;
|FPRC;
