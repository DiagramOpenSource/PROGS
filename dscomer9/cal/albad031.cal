|FICHEROS;
     albad031 #0;
     agifa019 #19;  ||Articulos
     agifa017 #17;  ||Datos Articulo/Almacen
     alba0034 #5;   ||Cabecera Documentos Psion
     alba0035 #6;   ||Lineas Documentos Psion
     albad032 #7;   ||Temporal Listado Psion019
     albad033 #8;   ||Temporal Listado Psion019
     dsm00054 #54;
     dsm00055 #55;
|FIN;

|VARIABLES;
     &Tempo = "";
     aTempo7 = "";
     aTempo8 = "";
     nNume = 0;
     aSerie = "";
     nPrime = 0;
     nLin = 0;
     &enForma = 1;
|FIN;

|CALCULO alma;|TIPO 0;
     |SI #0#9 = #0#10;|Y #0#8 = "SI";
          |MENAV "0400El Almacen De Salida NO Puede Ser Igual Al Almacen De Entrada";
          |ERROR;
     |FINSI;
|FCAL;

|CALCULO movim;
     |CAMPO_MODIFICA #0#9 , 1 , "S";
     |CAMPO_MODIFICA #0#10 , 1 , "S";
     |CAMPO_MODIFICA #0#11 , 1 , "S";
     |SI #0#8 = "NO";
          |CAMPO_MODIFICA #0#9 , 1 , "N";
          |CAMPO_MODIFICA #0#10 , 1 , "N";
          |CAMPO_MODIFICA #0#11 , 1 , "N";
     |FINSI;
|FCAL;

|CALCULO listado;
     |ABRE #19;
     #19#0 = #7#0;
     |LEE 000#19=;
     |CIERRA #19;

     |PRINT;

     |DDEFECTO #8;  ||Grabacion Totales Por Unidades De Carga
     #8#0 = #19#5;
     |LEE 000#8=;
     |SI FSalida ! 0;
          |GRABA 000#8b;
     |FINSI;
     #8#1 = #8#1 + #7#2;
     |GRABA 000#8a;
     |LIBERA #8;

     |SI #0#8 ! "SI"; |ACABA; |FINSI;        ||Genera Movimientos

     |SI nPrime = 0; |O nLin ] 999;
          nLin = 0;
          nPrime = 1;
          #54#2 = aSerie;
          aSerie = #54#2;     || Formateo
          #54#0 = 999999;
          |LEE 000#54];
          |SI FSalida = 0;
               |LEE 000#54a;
          |SINO;
               |LEE 000#54u;
          |FINSI;
          |SI FSalida = 0; |Y #54#2 = aSerie;
               nNume = #54#0 + 1;
          |SINO;
               nNume = 1;
          |FINSI;
          |DDEFECTO #54;
          #54#0 = nNume;
          #54#2 = aSerie;
          #54#1 = #0#11;
          |GRABA 020#54n;
     |FINSI;
     nLin = nLin + 1;
     |DDEFECTO #55;
     #55#28 = #54#2;
     #55#27 = #54#0;
     #55#11 = nLin;

     #55#7 = #19#6;
     |ABRE #17;
     #17#0 = #7#0;
     #17#1 = #0#9;
     |LEE 000#17=;
     #55#3 = #17#5;
     #17#1 = #0#10;
     |LEE 000#17=;
     #55#6 = #17#5;
     |CIERRA #17;

     #55#0 = #7#0;
     #55#1 = #0#9;
     #55#2 = #7#1;
     #55#4 = #7#2;
     #55#5 = #0#10;
     #55#8 = #54#1;
     |GRABA 020#55n;
     enForma = 1;
     |HAZ AcumulaME_MS;
|FCAL;

|DEFBUCLE lee_car;
     #7#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL,listado
|FIN;

|CALCULO lee_lin;
     |DDEFECTO #7;
     #7#0 = #6#4;
     |LEE 000#7=;
     |SI FSalida ! 0;
          |GRABA 000#7b;
     |FINSI;
     #7#1 = #6#5;
     #7#2 = #7#2 + #6#6;
     |GRABA 000#7a;
     |LIBERA #7;
|FCAL;

|DEFBUCLE lee_cab;
     #5#1;
     3;
     #0#4 , #0#0 , #0#2 , #0#6;
     #0#5 , #0#1 , #0#3 , #0#7;
     be;
     NULL, NULL, lee_lin;
|FIN;

|PROCESO inicio; |TIPO 3;
     |SI #0#12 ! "SI"; |ACABA; |FINSI;

     |HAZ CreaTempo; aTempo7 = Tempo;
     |NOME_DAT #7 aTempo7; |DELINDEX #7;
     |HAZ CreaTempo; aTempo8 = Tempo;
     |NOME_DAT #8 aTempo8; |DELINDEX #8;

     |ABRE #7;
     |BUCLE lee_cab;           ||Grabacion Temporal Y Movimientos
     |CIERRA #7;

     |IMPRE 1;
     |SI FSalida = 0;
          |INFOR "albad031";
          |SI FSalida ! 0;
               |MENAV "0000No existe informe 'albad031'";
          |SINO;
               |ABRE #54;
               |ABRE #55;
               |ABRE #8;
               |BUCLE lee_car;           ||Listado Cargas.
               |CIERRA #8;
               |CIERRA #55;
               |CIERRA #54;
               |PIEINF;
               |FININF;
          |FINSI;
          |FINIMP;
     |FINSI;

     Tempo = aTempo7; |HAZ BoraTempo; |DELINDEX #7;
     Tempo = aTempo8; |HAZ BoraTempo; |DELINDEX #8;
|FPRC;
