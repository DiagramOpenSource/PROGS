|FICHEROS;
     dsfa0001 #0;
     agifa077 #1;   || Alba C
     agifa079 #2;   || Fact C
     agifa072 #3;   || Fact L
     agifa019 #4;

     agifa112 #5;   || Prov
     agifa080 #7;   || Alba L
     agifa321 #45;  || Parametros de Divisas
     agifa322 #46;  || Lineas de Proveedores/Divisas
     agifa323 #47;  || Proveedores/Divisas
     agifa324 #42;  || Divisas
     agifa325 #30;  || Historico de Actualizaciones
|FIN;

|VARIABLES;
     &aDivisa = "";
     &aMoneda = "";
     &nDeci_PreDiv = 0;
     &eaPrv       = "";
     &enTiva     = 0;
     &enIva       = 0;
     &enRec       = 0;
     nBrutoAlb=0;nNeto=0;nIVA=0;nTotLin=0;
     nBaseAlb0=0;nBaseAlb1=0;nBaseAlb2=0;nBaseAlb3=0;nBaseAlb4=0;nBaseAlb5=0;
     nIvaAlb1=0;nIvaAlb2=0;nIvaAlb3=0;nIvaAlb4=0;nIvaAlb5=0;
     nRecAlb1=0;nRecAlb2=0;nRecAlb3=0;nRecAlb4=0;nRecAlb5=0;nReteAlb=0;
     tPortes   = 0;
     tVarios   = 0;
     abo       = 0;
     &enErr    = 0;
     i         = 0;
     alfa      = "";
     &Serie    = "";
     &Numero   = 0;

   &nDeci_Base      = 0;   || Decimales en Totales de la moneda base
   &nDeci_PreBase   = 0;   || Decimales en el Precio en moneda base
   &nDeci_BaseMx    = 0;   || Decimales en Totales de la moneda base
   &nDeci_PreBaseMx = 0;   || Decimales en el Precio en moneda base
   &nDeci_DivF      = 0;   || Decimales en Totales de la divisa
   &nDeci_BaseMxF   = 0;   || Decimales en Totales de la moneda base
   &nDeci_PreBasMxF = 0;   || Decimales en el Precio en moneda base
   &nDeci_PreDivF   = 0;   || Decimales en el Precio en divisa
   &nDeci_TotVisF   = 0;   || Decimales en Totales visibles (el de la moneda de trabajo)
   &nDeci_TotNoVisF = 0;   || Decimales en Totales no visibles (el de la otra moneda)
   &nDeci_PreVisF   = 0;   || Decimales en el Precio visual. (lineas)
   &nDeci_ImpVisF   = 0;   || Decimales en el Importe visual. (lineas)
   nfecha    = 0;
                         || activadas y la serie es de divisas
   &decim_divisa = 0;  || Decimales de la divisa
   &precio_divisa = 0; || Decimales del precio en divisa
   &decim_base = 0;    || Decimales de la moneda base
   &precio_base = 0;   || Decimales del precio en moneda base
   div_act = 0;        || Divisa actualizada. Me sirve en un PARA para que
                      || no salga hasta que este actualizada (div_act=1)
  &prov_divisa = "";  || Codigo de Proveedor. Se pasa a PROVEED/DIVISAS
  &divisa = "";       || Codigo de Divisa. Se pasa a ACTUAL. de DIVISAS
  factor = 0;         || factor de diferencia de cambio de albaran /factura
  div    = "";        || Variable de pintado
  sali = 0;           || Para condicio de salida
  camb = 0;           || Var. aux. para guardar el cambio
  fecha1 = 0;
  fecha2 = 0;
  fecha3 = 0;
  fecha4 = 0;
  fecha5 = 0;
  fecha6 = 0;
  mascara = "000000";
  tempo = " ";
  filtro = "-106";
  provee = 0;
  contador = 0;
  linea = 0;
  sw = 0;
  base1 = 0;
  base2 = 0;
  base3 = 0;
  base4 = 0;
  base5 = 0;
  base = 0;
  porte = 0;
  vario = 0;
  totiv = 0;
  total = 0;
  descu = 0;
  base0 = 0;
  cuot1 = 0;
  cuot2 = 0;
  cuot3 = 0;
  cuot4 = 0;
  cuot5 = 0;
  cuor1 = 0;
  cuor2 = 0;
  cuor3 = 0;
  cuor4 = 0;
  cuor5 = 0;
  bruto = 0;
  reten = 0;
  nPPort1 = 0;
  nPPort2 = 0;
  nImpDiv = 0;
|FIN;

|PROCESO Tipo8; |TIPO 8;
     |HAZ ControlUsuFC;
     |SI enErr ! 0; |PTEC 807; |ACABA; |FINSI;
|FPRC;


|PROCESO LineasAlbaranes;
     |HAZ TotalLin80;

     #7#28 = #2#66;
     #7#25 = #2#0;
     |GRABA 021#7a;
     |LIBERA #7;

     |HAZ CalCabAgifa077;
|FPRC;

|PROCESO MiraAlbaran;
     #1#50 = #3#17;
     #1#0  = #3#2;
     |LEE 101#1=;
     |SI FSalida = 0;
          aDivisa = #1#56;
          aMoneda = #1#58;
          |HAZ Divisas077;

          |HAZ LimCabAgifa077;
          |BUCLELIN 2 LineasAlbaranes #1;
          |GRABA 020#1a;
          |LIBERA #1;
     |FINSI;

     |HAZ CalLinAgifa079;
     |GRABA 020#3a;
     |LIBERA #3;
|FPRC;

|DEFBUCLE agifa072;
     #3#1;
     ;
     #2#66, #2#0, 001;
     #2#66, #2#0, 999;
     be;
     NULL, MiraAlbaran;
|FIN;

|PROCESO LeeFacturas;
     #0#4 = #2#66; |PINTA #0#4;
     #0#5 = #2#0;  |PINTA #0#5;

     aDivisa = #2#75;
     aMoneda = #2#77;
     |HAZ Divisas079;

     |ABRE #5;
     #5#0 = #2#2;
     |LEE 020#5=;
     |CIERRA #5;

     |BUCLE agifa072;

     |HAZ CalCabAgifa079;
     |GRABA 020#2a;
     |LIBERA #2;
|FPRC;

|DEFBUCLE agifa079;
     #2#1;
     48;
     #0#0, #0#2, "N";
     #0#1, #0#3, "N";
     be;
     NULL, LeeFacturas;
|FIN;

|PROCESO tipo3; |TIPO 3;
     |ABRE #1;
     |ABRE #3;
     |BUCLE agifa079;
     |CIERRA #1;
     |CIERRA #3;
|FPRC;
