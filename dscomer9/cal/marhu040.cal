|FICHEROS;
     marhu040 #0;    ||Este Def.
     agifa024 #1;    ||Cliente
     agifa073 #2;    ||Lineas de Pedido
     agifa017 #3;    ||Articulo/Almacen
     tmpmarhu #10;   ||Temporal Con los pedidos asignados
     marhu041 #20;   ||Temporal para Clasificar Por Ubicacion.
     marhu042 #30;   ||Orden Actuacion.
     marhu060 #40;   ||Temporal Sin Localizacion.
     agifa104 #4;    ||Pedidos. Cab.
     dsm00046 #22;   ||Kit.......................
     agifa019 #19;
|FIN;

|VARIABLES;
     &Tempo    = "";
     aTempo20  = "";
     aTempo40  = "";
     swNokit = 0;
     &nTip = 0;
     swUna = 0;
     aFich = "";
     aFic2 = "";
     nGrup = 0;
     nSum  = 0;
     nSum6 = 0;
     sWimp = 0;
     aPlan = "";
     aClav = "";
     aAlfa = "";
     nRom  = 0;
|FIN;

|PROCESO marhu041;
     |DDEFECTO #19;
     #19#0 = #20#1;
     |LEE 000#19=;

     |PRINT;
     sWimp = 1;
|FPRC;

|DEFBUCLE marhu041;
     #20#2;
     ;
     aClav,0001;
     aClav,9999;
     ;
     NULL,marhu041;
|FIN;

|PROCESO marhu060;
     |DDEFECTO #19;
     #19#0 = #40#1;
     |LEE 000#19=;

     |PRINT;
     sWimp = 1;
|FPRC;

|DEFBUCLE marhu060;
     #40#1;
     ;
     "     ",000001,  1;
     "zzzzz",999999,999;
     ;
     NULL,marhu060;
|FIN;

|PROCESO dsm00046;
     |DDEFECTO #3;
     #3#0 = #22#3;       ||Cod.Articulo.
     #3#1 = #22#4;       ||Almacen.
     |LEE 000#3=;

     swNokit = 1;
     |DDEFECTO #20;
     nSum = nSum + 1;
     #20#0  = nSum;      ||Secuencial
     #20#1  = #22#3;     ||Cod.Articulo
     #20#2  = #3#40;     ||Descripcion.
     #20#3  = (#22#5 * #2#5);            ||Unidades.Unidades Pedido Por U,Kit
     #20#4  = #22#0;     ||Serie Pedido.
     #20#5  = #22#1;     ||Numero.
     #20#6  = #10#4;     ||Serie Albaran
     #20#7  = #10#5;     ||Numero.
     #20#9  = "";        ||Observaciones.
     #20#13 = #10#3;     ||Grupo.
     #20#14 = #4#4;      ||Cliente.
     #20#15 = #4#8;      ||Nombre.


     #20#8  = (#2#5 - #2#43) * #22#5; || Pdte Servir. #3#39;     ||Stock
     #20#10 = #3#2;      ||Ubicacion.

     ||------------- Sacar El Orden de Actuacion.
     #30#2 = #20#10 % 101;
     #30#3 = #20#10 % 201;
     #30#4 = #20#10 % 301;
     #30#5 = #20#10 % 401;
     #30#6 = #20#10 % 502;

     aAlfa = #3#2; |QBF aAlfa;
     |LEE 000#30=;
     |SI FSalida = 0; |Y aAlfa ! "";
          aAlfa = #30#7;
          |QBF aAlfa;
          aAlfa = ("00" + aAlfa) % -101;
          #20#11 = #30#0 + aAlfa;
          #20#12 = #30#1;
     |SINO;
          |SI swUna = 0;
               |MENAV "0000Hay Localizaciones Sin Definir..........."
               swUna = 1;
          |FINSI;
          |DDEFECTO #40;
          #40#4  = #2#28;     ||Serie Pedido.
          #40#5  = #2#0;      ||Numero.
          #40#14 = #2#1;      ||Numero Linea.
          |LEE 000#40=;
          |SI FSalida ! 0;
               #40#0  = 0;         ||Secuencial
               #40#1  = #22#3;     ||Cod.Articulo
               #40#2  = #3#40;     ||Descripcion.
               #40#3  = (#2#5 * #22#5);      ||Unidades.
               #40#6  = #10#4;     ||Serie Albaran
               #40#7  = #10#5;     ||Numero.
               #40#9  = "";        ||Observaciones.
               #40#13 = #10#3;     ||Grupo.

               |DDEFECTO #3;
               #3#0 = #22#3;        ||Cod.Articulo.
               #3#1 = #22#4;        ||Almacen.
               |LEE 000#3=;

               #40#8  = (#2#5 - #2#43) * #22#5; ||Pdte.Servir.#3#39;     ||Stock
               #40#10 = #3#2;      ||Ubicacion.
               #40#11 =  999;
               #40#12 =  999;
               |GRABA 020#40n;
          |FINSI;
     |FINSI;

     |GRABA 020#20n;
|FPRC;


|DEFBUCLE dsm00046;
     #22#1;
     ;
     #2#28,#2#0,#2#1, 001;
     #2#28,#2#0,#2#1, 999;
     ;
     NULL, dsm00046;
|FIN;


|PROCESO agifa073;
     |ABRE #4;
     |DDEFECTO #4;
     #4#25 = #2#28;
     #4#0  = #2#0;
     |LEE 000#4=;
     |CIERRA #4;
     swNokit = 0;
     |BUCLE dsm00046;
     |SI swNokit ! 0; |ACABA; |FINSI;
     |DDEFECTO #20;
     nSum = nSum + 1;
     #20#0  = nSum;      ||Secuencial
     #20#1  = #2#2;      ||Cod.Articulo
     #20#2  = #2#4;      ||Descripcion.
     #20#3  = #2#5;      ||Unidades.
     #20#4  = #2#28;     ||Serie Pedido.
     #20#5  = #2#0;      ||Numero.
     #20#6  = #10#4;     ||Serie Albaran
     #20#7  = #10#5;     ||Numero.
     #20#9  = "";        ||Observaciones.
     #20#13 = #10#3;     ||Grupo.
     #20#14 = #4#4;      ||Cliente.
     #20#15 = #4#8;      ||Nombre.

     |DDEFECTO #3;
     #3#0 = #2#2;        ||Cod.Articulo.
     #3#1 = #2#3;        ||Almacen.
     |LEE 000#3=;

     #20#8  = #2#5 - #2#43; || Pdte Servir. #3#39;     ||Stock
     #20#10 = #3#2;      ||Ubicacion.

     ||------------- Sacar El Orden de Actuacion.
     #30#2 = #20#10 % 101;
     #30#3 = #20#10 % 201;
     #30#4 = #20#10 % 301;
     #30#5 = #20#10 % 401;
     #30#6 = #20#10 % 502;

     aAlfa = #3#2; |QBF aAlfa;
     |LEE 000#30=;
     |SI FSalida = 0; |Y aAlfa ! "";
          aAlfa = #30#7;
          |QBF aAlfa;
          aAlfa = ("00" + aAlfa) % -101;
          #20#11 = #30#0 + aAlfa;
          #20#12 = #30#1;
     |SINO;
          |SI swUna = 0;
             |MENAV "0000Hay Localizaciones Sin Definir..........."
             swUna = 1;
          |FINSI;
          |DDEFECTO #40;
          #40#4  = #2#28;     ||Serie Pedido.
          #40#5  = #2#0;      ||Numero.
          #40#14 = #2#1;      ||Numero Linea.
          |LEE 000#40=;
          |SI FSalida ! 0;
               #40#0  = 0;         ||Secuencial
               #40#1  = #2#2;      ||Cod.Articulo
               #40#2  = #2#4;      ||Descripcion.
               #40#3  = #2#5;      ||Unidades.
               #40#6  = #10#4;     ||Serie Albaran
               #40#7  = #10#5;     ||Numero.
               #40#9  = "";        ||Observaciones.
               #40#13 = #10#3;     ||Grupo.

               |DDEFECTO #3;
               #3#0 = #2#2;        ||Cod.Articulo.
               #3#1 = #2#3;        ||Almacen.
               |LEE 000#3=;

               #40#8  = #2#5 - #2#43; ||Pdte.Servir.#3#39;     ||Stock
               #40#10 = #3#2;      ||Ubicacion.
               #40#11 =  999;
               #40#12 =  999;
               |GRABA 020#40n;
          |FINSI;
     |FINSI;

     |GRABA 020#20n;

|FPRC;

|DEFBUCLE agifa073;
     #2#1;
     ;
     #10#0,#10#1,  1;
     #10#0,#10#1,999;
     ;
     NULL,agifa073;
|FIN;

|PROCESO tmpmarhub;
     |BUCLE agifa073;
|FPRC;

|DEFBUCLE tmpmarhub;
     #10#2;
     ;
     nGrup;
     nGrup;
     ;
     NULL,tmpmarhub;
|FIN;

|PROCESO marhu040b;
     nSum = 0;
     nGrup = #0#0;
     |ABRE #20;
     |BUCLE tmpmarhub;
     |CIERRA #20;
     |SI nSum ! 0;
          |PARA nRom = 1; |SI nRom [ 9; |HACIENDO nRom = nRom + 1;
               sWimp = 0;
               aAlfa = nRom;
               |QBF aAlfa;
               aAlfa = ("00" + aAlfa ) % -101;
               aClav = aPlan + aAlfa;
               |BUCLE marhu041;
               |SI sWimp ! 0;
                    |PIEINF;
               |FINSI;
          |SIGUE;
     |FINSI;
     |DELINDEX #20;
|FPRC;

|DEFBUCLE marhu040b;
     #0#1;
     ;
       1;
     999;
     ;
     NULL,marhu040b;
|FIN;

|PROCESO marhu040;
     |SI #1#189 = #0#1; |O #1#189 = #0#2; |O #1#189 = #0#3; |O #1#189 = #0#4;
          nGrup = #0#0;
          |ERROR10;
     |FINSI;
|FPRC;

|DEFBUCLE marhu040;
     #0#1;
     ;
       1;
     999;
     ;
     NULL,marhu040;
|FIN;

|PROCESO tmpmarhu;
     #1#0 = #10#2;
     |LEE 000#1=;
     |SI FSalida ! 0; |ACABA; |FINSI;
     nGrup = 0;
     |BUCLE marhu040;
     |SI nGrup ! 0;
          #10#3 = nGrup;
          |GRABA 020#10a;
     |FINSI;
|FPRC;

|DEFBUCLE tmpmarhu;
     #10#1;
     ;
     "     ",000001;
     "zzzzz",999999;
     ;
     NULL,tmpmarhu;
|FIN;

|RUTINA inf;
     #0#0 = 1;
|FRUT;

|RUTINA sup;
     #0#0 = 999;
|FRUT;

|PROGRAMA;
     |CLS;
     |CABEZA "Separacion Pedidos V";
     |ENTLINEAL #1#0, -1 , 7 , 21 , 1 , inf , sup;
     |ABRE #0;
     |LEE 000#0p;
     |SI FSalida = 0;
          |MENAV "0000Proceso BLOQUEADO por otro usuario...";
          |ACABA;
     |SINO;
          #0#0 = 0;
          |GRABA 020#0n;
     |FINSI;
     |CIERRA #0;

     |ENTLINEAL #1#0, -1 , 1 , 21 , 1 , inf , sup;
     |CONFI "0000SEjecutar Pase Pedidos a Albaran S/N";
     |SI FSalida = 0;
          |SUB_EJECUTA "agifa098.tab;marhu";
          |IMPRE 0;
          |SI FSalida ! 0; |ACABA; |FINSI;
          |INFOR "marhu040";
          |SI FSalida ! 0; |FINIMP; |ACABA; |FINSI;
          |HAZ CreaTempo; aTempo40 = Tempo;
          |NOME_DAT #40 aTempo40; |DELINDEX #40;
          |HAZ CreaTempo; aTempo20 = Tempo;
          |NOME_DAT #20 aTempo20; |DELINDEX #40;
          |ABRE #19;
          |ABRE #1;
          |ABRE #3;
          |ABRE #40;
          |BUCLE tmpmarhu;
          |ABRE #30;
          |SELECT #2#30;
          aPlan = "P";
          |BUCLE marhu040b;
          aPlan = "A";
          |BUCLE marhu040b;
          |CIERRA #40;
          nTip  = 1;
          sWimp = 0;
          |BUCLE marhu060;
          |SI sWimp ! 0;
               |PIEINF;
          |FINSI;
          |FININF;
          |FINIMP;
          |CIERRA #19;
          |CIERRA #1;
          |CIERRA #3;
          |CIERRA #30;
          |CONFI "0000SEjecutar Emision Albaranes S/N";
          |SI FSalida = 0;
               |SUB_EJECUTA "marhu062";
          |FINSI;
          |DELINDEX #20;  Tempo = aTempo20; |HAZ BoraTempo;
          |DELINDEX #40;  Tempo = aTempo40; |HAZ BoraTempo;
     |FINSI;
     |DELINDEX #0;
|FPRO;
