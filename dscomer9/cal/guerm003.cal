|FICHEROS;
  guerm001 #0;        || Mante Factu/Alba(C)
  guerm002 #1;        || Mante Factu/Alba(L)
  agifa027 #3;        || Contadores
  agifa024 #4;        || Clientes
  guerm005 #5;        || Control
  guerw001 #6;        || Cantidad Entregada
  guerm003 #7;        || Este
  guerm004 #8;        || Camiones
|FIN;

|VARIABLES;
     &enTiva = 0;
     &efFiva = @;
     &eaDiva = "";
     &enIva = 0;
     &enRec = 0;

  nConta  = 0;
  aTipo   = "";
  &EURODB = 0;
  fecha     = @;
  hora      = "";
  &tipo     = "";
  &codpos   = "01010";
  &sumalin  = 0;
  &descrip = "";
  &programa = 0;
  nume = 0;
  traba = "";
  modifica = "";
  x = 0;
  alfa = "";
  alf1 = "";
{-1}menu  = "";
    menu1     = "2400";
    menu2     = "1";
    menu3     = "Elija:";
    menu4     = "AFTN";
    menu5     = " Albaran ";
    menu6     = " Factura ";
    menu7     = " Ticket  ";
    menu8     = " Anular  ";
    opmenu    = 0;
    mensa = "";
|FIN;

|PROCESO BorraLineas;
     |BORRA 020#1a;
|FPRC;

|DEFBUCLE BorraLineas
     #1#1;
     ;
     #5#35, 01;
     #5#35, 99;
     be;
     NULL, BorraLineas;
|FIN;

|PROCESO Contador;
     |ABRE #3;
     #3#2 = "";
     |SI aTipo = "M"; #3#0 = "vfactuco"; #3#2 = "";|FINSI;
     |SI aTipo = "A"; #3#0 = "valbaran"; #3#2 = #5#0; |FINSI;
     |SI aTipo = "F"; #3#0 = "vfactuco"; #3#2 = #5#1; |FINSI;
     |SI aTipo = "T"; #3#0 = "vfactuco"; #3#2 = #5#2; |FINSI;
     |LEE 101#3=;
     |SI FSalida ! 0;
          nConta = 1;
          #3#1 = 2;
          |GRABA 021#3b;
     |SINO;
          nConta = #3#1;
          #3#1 = #3#1 + 1;
          |GRABA 021#3a;
     |FINSI;
     |CIERRA #3;
|FPRC;

|PROCESO Pinta;
  |PRINT;
|FPRC;

|PROCESO Imprime;
  nume = (#0#6 * 1000) + #0#7;
  traba = nume;
  traba = "00000" + traba;
  codpos = traba % -105;
  Impresora = #5#5;
  |QBF Impresora;
  |SI #5#6 = "N";
      |IMPRE -1;
  |SINO;
      |IMPRE 0;
  |FINSI;
  |SI FSalida ! 0;  |ACABA;  |FINSI;
  |SI #0#15 = "A";
      |INFOR "cantealb";
      |SI FSalida ! 0;  |FINIMP;  |ACABA;  |FINSI;
  |FINSI;
  |SI #0#15 = "T";
      |INFOR "cantetic";
      |SI FSalida ! 0;  |FINIMP;  |ACABA;  |FINSI;
  |FINSI;
  |SI #0#15 = "F";
      |INFOR "cantefac";
      |SI FSalida ! 0;  |FINIMP;  |ACABA;  |FINSI;
  |FINSI;
  |SI #0#15 = "a";
      |INFOR "cannnalb";
      |SI FSalida ! 0;  |FINIMP;  |ACABA;  |FINSI;
  |FINSI;
  |SI #0#15 = "t";
      |INFOR "cannntic";
      |SI FSalida ! 0;  |FINIMP;  |ACABA;  |FINSI;
  |FINSI;
  |PARA x = 1;  |SI x [ #0#25;  |HACIENDO x = x + 1;
        |BUCLELIN 0Pinta#0;
        |PIEINF;
  |SIGUE;
  |FININF;
  |FINIMP;
|FPRC;

|PROCESO leecamion;
  |ABRE #8;
  #8#0 = #0#11;
  |LEE 101#8=;
  |SI FSalida = 0;
      #0#35 = #8#6;
      |SI #8#7 = #0#3;
          #0#35 = "N";
      |FINSI;
      |PINTA #0#35;
  |FINSI;
  |CIERRA #8;
|FPRC;

|PROCESO Min;
     #1#0 = 1;
     #1#1 = #0#0;
|FPRC;

|PROCESO Max;
     #1#0 = 99;
     #1#1 = #0#0;
|FPRC;

|PROGRAMA;
  |ABRE #0;

  |ABRE #5;
  |LEE 101#5p;
  |SI FSalida ! 0; |GRABA 021#5b; |FINSI;
  |CIERRA #5;

  |HAZ DecimalesBase;

  |CLS;
  |CABEZA "Entrada Facturas/Albaranes";
|ET otra;

  |ABRE #5;
  |LEE 101#5p;
  #5#35 = #5#35 + 1;
  |GRABA 101#5a;
  |CIERRA #5;

  |DDEFECTO #0;
  |DDEFECTO #1;
  |PINPA #0#7;
  |PINDA #0#1;
  |PINDA #0#0;
  #0#0 = #5#35;

|ET Anula;
  ||컴컴컴컴컴컴컴컴컴컴횾or si existe... o anula
  |BORRA 000#0c;
  |BUCLE BorraLineas;
  ||컴컴컴컴컴컴컴컴컴컴
  |SI opmenu = 4;
     |ENTLINEAL #1#1, 2, 7, 21, 0, Min, Max;
  |FINSI;

  fecha = ~;
  |HORA hora;
  #0#1 = fecha;
  #0#2 = hora;

  enTiva = #5#8;
  efFiva = #0#1;
  |HAZ SacaIVA;
  |SI eaDiva = "";
     |MENAV "0000No existe IVA para esta fecha...";
     |ACABA;
  |SINO;
     #0#14 = enIva; |PINTA #0#14;
  |FINSI;


  |PINTA #0#0;
  |PINTA #0#1;
  |PINTA #0#2;
  |ENDATOS #1#0;
  |SI FSalida ! 0;  |CIERRA #0;  |CIERRA #5;  |ACABA;  |FINSI;

|ET sigue;
  |MENU menu;
  |SI FSalida [ 0; |VETE sigue; |FINSI;
  |SI FSalida ] 0;
      opmenu = FSalida;
      |SI opmenu = 4;
          |VETE Anula;
      |FINSI;
      |SI opmenu = 1;    ||......... Albaran
          |SI #0#14 ! 0;
              aTipo = "A";
              |HAZ Contador;
              alfa = nConta;
              alfa = "000000" + alfa;
              alf1 = alfa % -106;
              ||tipo = "          " + alf1;
              tipo = #5#0 + " " + alf1;
              #0#15 = "A";     ||.. Tipo
              #0#18 = nConta;    ||.. N Albaran
              #0#40 = #5#0;       ||serie Albaran
          |SINO;
              |ABRE #5;
              |LEE 101#5p;
              #5#28 = #5#28 + 1;
              |GRABA 101#5a;
              |CIERRA #5;
              alfa = #5#28;
              alfa = "000000" + alfa;
              alf1 = alfa % -106;
              ||tipo = "          " + alf1;
              tipo = #5#26 + " " + alf1;
              #0#15 = "a";     ||.. Tipo
              #0#18 = #5#28;    ||.. N Albaran
              #0#40 = #5#26;     ||serie Albaran
          |FINSI;
          #0#19 = 0;       ||.. Cantidad
          #0#21 = 0;
          #0#22 = 0;
          #0#23 = 0;
          #0#24 = 0;
      |FINSI;
      |SI opmenu = 2;    ||......... Factura
          aTipo = "F";
          |HAZ Contador;
          #0#21 = 0;
          #0#22 = #0#20;
          #0#23 = ((#0#22 * #0#14) / 100) ! EURODB;
          #0#24 = #0#22 + #0#23;
          traba = #0#22;
          mensa = "B.Imponible: " + traba;
          traba = #0#23;
          mensa = mensa + " IVA: " + traba;
          traba = #0#24;
          mensa = mensa + " T.FACTURA: " + traba;
          |PINTA 2304,mensa;
          |PUSHV 0501 2380;
          |BLANCO 1221 1852;
          |PINPA #0#6;
          #6#0 = #0#24;
          |PINDA #0#6;
          |ENDATOS #1#6;
          |POPV;
          |SI FSalida ! 0; |VETE sigue; |FINSI;
          |SI #6#0 ! #0#24;
              #0#22 = (#6#0 / (1 + (#0#14 / 100))) ! EURODB;
              #0#21 = #0#20 - #0#22;
              #0#23 = #6#0 - #0#22;
              #0#24 = #6#0;
          |FINSI;
          |SI #0#21 ! 0;
              descrip = "DESCUENTO";
          |SINO;
              descrip = " ";
          |FINSI;
          alfa = nConta;
          alfa = "000000" + alfa;
          alf1 = alfa % -106;
          ||tipo = "XXXXXXXX  " + alf1 + "   Factura";
          tipo = #5#1 + " " + alf1;
          #0#15 = "F";     ||.. Tipo
          #0#17 = nConta;    ||.. N Factura
          #0#39 = #5#1;     ||Serie Factura
          #0#19 = #6#0;    ||.. Cantidad
      |FINSI;
      |SI opmenu = 3;    ||......... Ticket
          |SI #0#14 ! 0;
              aTipo = "T";
              |HAZ Contador;
              |PUSHV 1322 1853;
              |PINPA #0#6;
              #6#0 = #0#20;
              |PINDA #0#6;
              |ENDATOS #1#6;
              |POPV;
              |SI FSalida ! 0; |VETE sigue; |FINSI;
              alfa = nConta;
              alfa = "000000" + alfa;
              alf1 = alfa % -106;
              ||tipo = "XXXXXXXX  " + alf1 + "   Ticket";
              tipo = #5#2 + " " + alf1;
              #0#15 = "T";     ||.. Tipo
              #0#16 = nConta;    ||.. N Ticket
              #0#38 = #5#2;       ||Serie Ticket
          |SINO;
              |ABRE #5;
              |LEE 101#5p;
              #5#29 = #5#29 + 1;
              |GRABA 101#5a;
              |CIERRA #5;
              alfa = #5#29;
              alfa = "000000" + alfa;
              alf1 = alfa % -106;
              ||tipo = "XXXXXXXX  " + alf1 + "   Ticket";
              tipo = #5#27 + " " + alf1;
              #0#15 = "T";     ||.. Tipo
              #0#16 = #5#29;    ||.. N Ticket
              #0#38 = #5#2;       ||Serie Ticket
          |FINSI;
          #0#19 = #6#0;    ||.. Cantidad
          #0#21 = #0#20 - #0#19;
          #0#22 = #0#19;
          #0#23 = 0;
          #0#24 = #0#19;
      |FINSI;
      |GRABA 021#0n;
      |LIBERA #0;

      |ABRE #8;
      #8#0 = #0#11; || Matricula
      |LEE 121#8=;
      |SI FSalida = 0;
          #8#4 = #0#1; || Fecha Ult. movimiento
          |GRABA 021#8a;
      |FINSI;
      |CIERRA #8;

      |HAZ Imprime;
      |CONFI "0000NReimprimir documento";
      |SI FSalida = 0;
          |HAZ Imprime;
      |FINSI;
      |VETE otra;
  |FINSI;
  |CIERRA #0;
  |CIERRA #5;
|FPRO;
---------------------------------------------

|PROCESO cliente; |TIPO 0;
  sumalin = #0#20;
  #0#14 = #5#3;
  |PINTA #0#14;
  modifica = "N";
  |SI #0#3 = 999999;  modifica = "S";  |FINSI;
  |C_M #0#4,  1, modifica;
  |C_M #0#5,  1, modifica;
  |C_M #0#6,  1, modifica;
  |C_M #0#7,  1, modifica;
  |C_M #0#9,  1, modifica;
  |C_M #0#10, 1, modifica;
  |SI #0#3 = 999999;
      |HAZ leecamion;
      |ACABA;
  |FINSI;
  |SI #0#3 ] 900000;
      |C_M #0#27, 1, "S";
  |SINO;
      #0#27 = 0;
      |PINTA #0#27;
      |C_M #0#27, 1, "N";
  |FINSI;
  |ABRE #4;
  |DDEFECTO #4;
  #4#0 = #0#3;
  |LEE 101#4=;
  |SI FSalida ! 0;
      |ERROR;
  |SINO;
      #0#4 = #4#1;    || Nombre
      #0#5 = #4#8;    || Direccion
      #0#6 = #4#181;  || Cp1
      #0#7 = #4#182;  || Cp2
      #0#8 = #4#10;   || Provincia
      #0#9 = #4#9;    || Poblacion
      #0#10= #4#15;   || CIF
      |PINTA #0#4;
      |PINTA #0#5;
      |PINTA #0#6;
      |PINTA #0#7;
      |PINTA #0#8;
      |PINTA #0#9;
      |PINTA #0#10;
  |FINSI;
  |CIERRA #4;
  |HAZ leecamion;
|FPRC;

|PROCESO transporte;
||   |SI #0#3 ] 900000;  |Y #0#3 < 999999;
||       |SI #0#27 = 0;
||          |MENAV "     Debe Informar una empresa de Transporte";
||           |ERROR;
||       |FINSI;
||   |SINO;
||       #0#27 = 0;
||       |PINTA #0#27;
||   |FINSI;
|FPRC;
컴컴컴컴컴컴컴컴컴
|PROCESO RefresHora7; |TIPO 7;
     |HAZ RefresHora0;
|FPRC;

|PROCESO RefresHora0; |TIPO 0;
     |HORA hora;
     #0#2 = hora;
     |PINTA #0#2;
|FPRC;

|PROCESO Tara; |TIPO 6;
  |SI FSalida = 13;
      |C_M #0#13, 1, "S";
      |ENCAMPO #13#0;
      |C_M #0#13, 1, "N";
      |ERROR;
  |FINSI;
  |SI FSalida = 14;
      |C_M #0#14, 1, "S";
      |ENCAMPO #14#0;
      |C_M #0#14, 1, "N";
      |ERROR;
  |FINSI;
|FPRC;
