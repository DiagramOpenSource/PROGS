piens030

|FICHEROS
  vigz0005 #0;
  vigw0001 #1; ||Tmp
  agifa071 #2;
  agifa010 #3;
  agifa134 #4;
  agifa059 #5;
  agifa024 #6;
  agifa019 #7;
  agifa007;
  vigm0043 #43;
|FIN;

|VARIABLES;
 &Tempo = "";
 c1=0;
 c2=0;
 c3=0;
 c4=0;
 c6=0;
 aSerie = "";
|FIN;

|PROCESO EsInterno;
     |ABRE #agifa007;
     #agifa007#26 = aSerie;
     |LEE 000#agifa007.=;
     |CIERRA #agifa007;

     |SI #agifa007#37 = "S";
          FSalida = 0;
     |SINO;
          FSalida = 1;
     |FINSI;
|FPRC;

|PROCESO lineas;
  |ABRE #1;
  #1#0 = #4#1;
  |LEE 010#1=;
  |SI FSalida ! 0;
    |DDEFECTO #1;
    #1#0 = #4#1;
    |GRABA 010#1b;
  |FINSI;
  #1#1 = #1#1+#2#5;
  #1#2 = #1#2+(#2#9 - #2#14);
  |ABRE #6;
  #6#0 = #2#15;
  |LEE 010#6=;
  |SI FSalida ! 0; |DDEFECTO #6; |FINSI;
  |LIBERA #6;
  |CIERRA #6;
  |ABRE #7;
  #7#0 = #2#2;
  |LEE 010#7=;
  |SI FSalida ! 0; |DDEFECTO #7;|FINSI;
  |SI FSalida = 0;
    |SI #6#39 = 1;
      #1#4 = #1#4 + (#2#5 * #7#18);
    |FINSI;
    |SI #6#39 = 2;
      #1#4 = #1#4 + (#2#5 * #7#19);
    |FINSI;
    |SI #6#39 = 3;
      #1#4 = #1#4 + (#2#5 * #7#20);
    |FINSI;
  |FINSI;
  |CIERRA #6;
  |CIERRA #7;
  #1#6 = #1#6+#2#14;
  |GRABA 010#1a;
  |LIBERA #1;
  |CIERRA #1;
|FPRC;

|PROCESO listado1;
     aSerie = #agifa010#52;
     |HAZ EsInterno;
     |SI FSalida ! 0;
          |BUCLELIN 0lineas#3;
     |FINSI;
|FPRC;

|DEFBUCLE listado;
#3#1;
;
#5#15,#5#2;
#5#15,#5#2;
be;
NULL,listado1;
|FIN;

|PROCESO linfra;
 |BUCLE listado;
|FPRC;

|PROCESO fra;
  |BUCLELIN 0linfra#4;
|FPRC;

|DEFBUCLE factura;
     #4#3;
     ;
     "      ", #0#0, "     ", 000001;
     "zzzzzz", #0#1, "zzzzz", 999999;
     be;
     NULL,fra;
|FIN;

|PROCESO repaso1;
 #1#3 = (#1#2 *100) / #1#6;
 #1#5 = #1#2 / #1#1;
 #1#7 = (#1#2 + #1#6) - #1#4;
 |GRABA 010#1a;
 |LIBERA #1;
 |PRINT;
|FPRC

|DEFBUCLE repaso;
#1#1;
;
"00.00.0000";
"31.12.9999";
be;
NULL,repaso1;
|FIN;

|PROCESO acum;
  c1 = c1 + #1#1;
  c2 = c2 + #1#2;
  c4 = c4 + #1#4;
  c6 = c6 + #1#6;
  #1#1 = c1;
  #1#2 = c2;
  #1#4 = c4;
  #1#6 = c6;
  |GRABA 010#1a;
  |LIBERA #1;
|FPRC;

|DEFBUCLE acumula;
#1#1;
;
"00.00.0000";
"31.12.9999";
be;
NULL,acum;
|FIN;

|PROCESO HistoTras;
     aSerie = #43#0;
     |HAZ EsInterno;
     |SI FSalida = 0; |ACABA; |FINSI;

     |DDEFECTO #1;
     |ABRE #1;
     #1#0 = #43#7;
     |LEE 101#1=;
     |SI FSalida ! 0; |GRABA 020#1b; |FINSI;

     #1#1 = #1#1 + #43#13;
     #1#2 = #1#2 + (#43#15 - #43#16);

     |ABRE #6;
     #6#0 = #43#8;
     |LEE 000#6=;
     |SI FSalida ! 0; |DDEFECTO #6; |FINSI;
     |CIERRA #6;

     |ABRE #7;
     #7#0 = #43#12;
     |LEE 000#7=;
     |SI FSalida ! 0; |DDEFECTO #7;|FINSI;
     |SI FSalida = 0;
          |SI #6#39 = 1;
               #1#4 = #1#4 + (#43#13 * #7#18);
          |FINSI;
          |SI #6#39 = 2;
               #1#4 = #1#4 + (#43#13 * #7#19);
          |FINSI;
          |SI #6#39 = 3;
              #1#4 = #1#4 + (#43#13 * #7#20);
          |FINSI;
     |FINSI;
     |CIERRA #6;
     |CIERRA #7;
     #1#6 = #1#6 + #43#16;
     |GRABA 010#1a;
     |LIBERA #1;
     |CIERRA #1;
|FPRC;

|DEFBUCLE HistoTras;
     #43#2;
     ;
     #0#0;
     #0#1;
     ;
     NULL, HistoTras;
|FIN;

|PROGRAMA;
  |CLS;
  |HAZ CreaTempo; |NOME_DAT #1 Tempo;
  |DELINDEX #1;
  c1 = 0;
  c2 = 0;
  c3 = 0;
  c4 = 0;
  c6 = 0;
  |PINPA #0#0;
  |DDEFECTO #0;
  |PINDA #0#0
  |ENDATOS #1#0;
  |SI FSalida = 0;
  |BUCLE factura;
  |BUCLE HistoTras;
  |BUCLE acumula;
  |IMPRE 0;
  |SI FSalida = 0;
    |INFOR "vigz0005";
    |SI FSalida = 0;
      |BUCLE repaso;
      |PIEINF;
    |FINSI;
    |FININF;
  |FINSI;
  |FINIMP;
  |FINSI;
  |HAZ BoraTempo; |DELINDEX #1;
|FPRO;
