|FICHEROS;
     guerz074 #0;
     agifa007 #7;
     agifa010 #10; ||Alb cab
     agifa019 #19;
     agifa024 #24;
     agifa036 #36; ||Depo cab
     agifa070 #70; ||Depo lin
     agifa071 #71; ||Alb lin
     dsm00053 #53; ||Da
     guerm056 #56; ||Depo aux.
     guerm057 #57;
     guerm058 #58;
     guerm214 #214;
     guerz201 #201; || Albaran-Obra
     dsm00238 #238;
     referen@;
|FIN;

|VARIABLES;
     &aDivisa = "";
     &aMoneda = "";
     nError = 0;
     i = 0;
     nDias = 0;
     &enForma = 1;
     &enSwMenu = 0;
     nLinAlb = 0;
     aSer = "";
     aAlfa = "";
     nNum = 0;
     nUltLin = 0;
     nLinDepo = 0;
     nDia = 0;
     nMes = 0;
     aTrabaja = "";
     fFechaDepo = @;
     f = @;
     aArti = "";
|FIN;

|PROCESO CalcuDias;
     |SI fFechaDepo = "01.01.0000";
          fFechaDepo = #36#1;
     |FINSI;
     nDias = 0;
     |DDEFECTO #58;
     #58#0 = #71#2;
     |LEE 000#58=;
     |SI #58#1 = "R"; ||Dias Reales;
          nDias = #0#11 - fFechaDepo + 1;

     |SINO;    || "L"   Segun Calendario
          |DDEFECTO #214;
          #214#0 = #57#1;
          #214#13 = #57#2;
          |LEE 000#214=;
          |PARA f = fFechaDepo; |SI f [ #0#11; |HACIENDO f = f + 1;
               aAlfa = f % 102; nDia = aAlfa;
               aAlfa = f % 402; nMes = aAlfa;
               aAlfa = #214nMes;
               nDia = nDia * 100 + 1;
               aTrabaja = aAlfa % nDia;
               |SI aTrabaja = 0;
                    nDias = nDias + 1;
               |FINSI;
          |SIGUE;
     |FINSI;
|FPRC;

|PROCESO CreaDA;
     #53#3 = nLinDepo;
     |GRABA 020#53n;
|FPRC;

|DEFBUCLE CreaDA;
     #53#1;
     ;
     "D", #70#22, #70#0, #70#1, 0001;
     "D", #70#22, #70#0, #70#1, 9999;
     ;
     NULL, CreaDA;
|FIN;

|PROCESO CreaLinDepo;
     |SI #70#5 = 0; |O #70#1 > nUltLin;
          |ACABA;
     |FINSI;
     |ABRE #19;
     #19#0 = #70#2;
     |LEE 000#19=;
     |CIERRA #19;
     |SI #19#179  = "N";
          #70#5 = 0;
          #70#28 = 0;
          |HAZ TotalLin70;
          |GRABA 020#70a;
          |LIBERA #70;
          |ACABA;
     |FINSI;

     #referen@#22 = #70#22;
     #referen@#0 = #70#0;
     #referen@#1 = 999;
     |LEE 000#referen@.];
     |SI FSalida = 0;
          |LEE 000#referen@.a;
     |SINO;
          |LEE 000#referen@.u;
     |FINSI;
     |SI FSalida = 0; |Y #referen@#22 = #70#22; |Y #referen@#0 = #70#0;
          nLinDepo = #referen@#1 + 1;
     |SINO;
          nLinDepo = 1;
     |FINSI;

     |SALVA_DATOS #70;
     |REPON_DATOS #referen@;
     #referen@#1 = nLinDepo;

     |SI nLinDepo > 999;
          aAlfa = "0000Superado linea > 999, deposito:" + #70#23 + "/" + #70#1;
          |MENAV aAlfa;
     |SINO;
          |GRABA 020#referen@.n;

          |BUCLE CreaDA;

          #70#5 = 0;
          #70#28 = 0;
          |HAZ TotalLin70;
          |GRABA 020#70a;
          |LIBERA #70;
     |FINSI;
|FPRC;

|PROCESO DepoFin;
     |DDEF aAlfa;
     aAlfa = aAlfa + "agifa070";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          |BUCLELIN 2CreaLinDepo#36;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|PROCESO CopiaDA;
     #53#0 = "A";
     #53#1 = #71#29;
     #53#2 = #71#0
     #53#3 = #71#1;
     |GRABA 020#53n;
|FPRC;

|DEFBUCLE CopiaDA;
     #53#1;
     ;
     "D", #70#22, #70#0, #70#1, 001;
     "D", #70#22, #70#0, #70#1, 999;
     ;
     NULL, CopiaDA;
|FIN;

|PROCESO CreaLinAlb;
     nLinAlb = nLinAlb + 1;

     #10#42 = #10#42 + 1;     ||Control Deposito

     #71#29 = #10#52;
     #71#0 = #10#0;
     #71#1 = nLinAlb;
     |PARA i = 2; |SI i [ 17; |HACIENDO i = i + 1;
          #71i = #70i;
     |SIGUE;
     #71#12 = 0;
     #71#18 = #70#0;
     #71#20 = "S";
     #71#22 = #70#1;
     #71#27 = #70#21;
     #71#32 = #70#22;
     #71#33 = #70#23;
     #71#34 = #70#31;
     #71#35 = #70#32;
     #71#49 = #70#29;
     #71#50 = #70#30;
     #71#63 = #70#38;
     #71#64 = #70#39;

     |ABRE #19;
     #19#0 = #71#2;
     |LEE 000#19=;
     |CIERRA #19;
     |SI #19#179 = "S";
          |HAZ CalcuDias;
          #71#51 = nDias;          || Medida1
          #71#48 = #71#5 * #71#51; || Unidades2
     |SINO;
          #71#48 = #70#28;
          #71#49 = #70#29;
          #71#50 = #70#30;
          #71#51 = #70#33;
          #71#52 = #70#34;
          #71#53 = #70#35;
     |FINSI;
     |HAZ TotalLin71;
     |GRABA 020#71n;
     |SI FSalida = 0;
          |BUCLE CopiaDA;
          enForma = 1;
          |HAZ AcumulaAV;
     |FINSI;
|FPRC;

|PROCESO CreaCabAlb;
     |LIBERA #10;

     |SI #0#0 = "*****";
          #10#52 = #36#46;
     |SINO;
          #10#52 = #0#0;
     |FINSI;
     enSwMenu = 1;
     |HAZ ContaAV7;
     |GRABA 020#10b;
     |SI FSalida = 0;
          |DDEFECTO #24;
          #24#0 = #36#3;
          |LEE 000#24=;

          #10#1 = #0#11;
          #10#2 = #36#2;
          #10#3 = #36#3;
          #10#4 = #36#4;
          #10#5 = #36#5;
          #10#6 = #36#6;
          #10#7 = #36#7;
          #10#8 = #36#8;
          #10#9 = #36#9;
          #10#11 = #36#11;
          #10#12 = #36#12;
          #10#13 = #36#13;
          #10#14 = #36#14;
          #10#27 = #36#27;
          #10#29 = #36#29;
          #10#30 = #36#30;
          #10#31 = #36#31;
          #10#32 = #36#32;
          #10#33 = #36#33;
          #10#34 = #36#34;
          #10#35 = #36#35;
          #10#36 = #36#36;
          #10#40 = #36#38;
          #10#40 = #36#38;
          #10#50 = #24#40;    || Valorado S/N
          #10#51 = #7#28;     || Facturable
          #10#62 = #24#180; || CP
          #10#63 = #24#15;
          #10#64 = #24#208;
          #10#68 = #36#49;
          #10#69 = #36#50;
          #10#70 = #36#51;
          #10#73 = #36#52;
          #10#74 = #36#53;
          #10#84 = #36#61;    || Dir entrega
          #10#89 = #36#60;

          aDivisa = #10#68;
          aMoneda = #10#70;
          |HAZ Divisas010;
          |GRABA 020#10a;

          |DDEFECTO #201;
          #201#0 = #10#52;
          #201#1 = #10#0;
          |LEE 101#201=;
          |SI FSalida ! 0; |GRABA 020#201b; |FINSI;
          #201#2 = #56#3;
          |GRABA 020#201a;
          |LIBERA #201;
     |FINSI;
|FPRC;

|PROCESO DepoLin;
     nUltLin = #70#1;
     |SI #70#5 = 0;
          |ACABA;
     |FINSI;

     |SI aSer ! #36#46; |O nNum ! #36#0; |O aSer = "";
          aSer = #36#46;
          nNum = #36#0;

          fFechaDepo = #56#4;
          |SI #56#4 ! "01.01.0000";
               fFechaDepo = #56#4 + 1;
          |FINSI;

          |HAZ CreaCabAlb;
          |HAZ LimCabAgifa010;

          #56#0 = #36#46;
          #56#1 = #36#0;
          |LEE 101#56=;
          |SI FSalida = 0;
               #56#4 = #0#11;
               |GRABA 020#56a;
               |LIBERA #56;
          |FINSI;
     |FINSI;
     |HAZ CreaLinAlb;
     |HAZ CalCabAgifa010;
     |GRABA 020#10a;
|FPRC;

|PROCESO Chequea;
     |SI #70#5 = 0; |O #70#6 = 0;
          |ACABA;
     |FINSI;

     aArti = #70#2; |QBF aArti;
     aArti = "'" + aArti + "'";

     #19#0 = #70#2;
     |LEE 000#19=;
     |SI #19#179 = "N";
        ||  aAlfa = "0000Articulo " + aArti + " sin doble stock...";
        ||  |MENAV aAlfa;
        ||  nError = 1;
          |ACABA;
     |SINO;
          |DDEFECTO #238;
          #238#0 = #19#201;
          |LEE 000#238=;
          |SI #238#6 = 1;
               aAlfa = "0000Articulo " + aArti + " no factura unidades2...";
               |MENAV aAlfa;
               nError = 1;
          |SINO;
               |SI #238#8 ! 1;
                    aAlfa = "0000Articulo " + aArti + " tipo stock incorrecto...";
                    |MENAV aAlfa;
                    nError = 1;
               |FINSI;
          |FINSI;
     |FINSI;
     |SI nError = 0;
          #58#0 = #70#2;
          |LEE 000#58=;
          |SI FSalida ! 0;
               aAlfa = "0000Articulo " + aArti + " sin tipo facturacion...";
               |MENAV aAlfa;
               nError = 1;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO DepoCab;
     |DDEFECTO #56;
     #56#0 = #36#46;
     #56#1 = #36#0;
     |LEE 000#56=;
     |SI #56#3 < #0#7; |O #56#3 > #0#8; |ERROR; |ACABA; |FINSI; ||Obra
     |SI #56#4 ! "01.01.0000";
          |SI #56#4 < #0#9; |O #56#4 > #0#10; |ERROR; |ACABA; |FINSI; ||F.Depo
     |FINSI;

     |SI #56#4 = "01.01.0000";
          |SI #0#11 [ #36#1; |ERROR; |ACABA; |FINSI;
     |SINO;
          |SI #0#11 [ #56#4; |ERROR; |ACABA; |FINSI;
     |FINSI;

     nError = 0;
     |ABRE #19;
     |ABRE #238;
     |BUCLELIN 2Chequea#36;
     |CIERRA #238;
     |CIERRA #19;
     |SI nError ! 0;
          aAlfa = "0000Deposito " + #36#47 + "/" + #36#0 + " no se adjudica...";
          |MENAV aAlfa;
          |ERROR; |ACABA;
     |FINSI;
     nLinAlb = 0;
|FPRC;

|DEFBUCLE Depositos;
     #36#3;
     ;
     #0#5, "01.01.0000", #0#1, #0#3;
     #0#6, "31.12.9999", #0#2, #0#4;
     be;
     NULL, DepoCab, DepoLin, DepoFin;
|FIN;

|PROCESO Tipo3; |TIPO 3;
     |ABRE #57; |LEE 000#57p; |CIERRA #57;

     |ABRE #56;
     |ABRE #71;
     |ABRE #10;
     |ABRE #24;
     |ABRE #58;
     |ABRE #214;
     |ABRE #201;
     |BUCLE Depositos;
     |CIERRA #201;
     |CIERRA #214;
     |CIERRA #58;
     |CIERRA #24;
     |CIERRA #10;
     |CIERRA #71;
     |CIERRA #56;
|FPRC;
