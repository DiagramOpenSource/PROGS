|FICHEROS;
agifa046 #0;
agifa019 #1;
agifa017 #2;
agifa112 #3;
agifa027 #4;
agifa065 #9;
agifa142 #10;
albap015 #11;
agifa029 #12;
|FIN;

|VARIABLES;
 uni = 0;
 suma = 0;
 suma1 = 0;
 FSAlida = 0;
 s = 0;
 qp = 0;
 qp1 = 0;
 pelas = 0;
 mes = 0;
clave = "entraval";
operacion = "EV";
orden = 1;
forden = "";
sto = 0;
sto1 = 0;
linea = 14;
fmes = "";
fecha = @;
mm1="0401Descripcion:                                Stock:          Neto:";
mascara = "0000000";
tempo = " ";
filtro = "-106";
codigo = "";
ncontador = 0;
m1 = 0;
m2 = 0;
m3 = 0;
flag = 0;
|FIN;

|CAMPOS;
#1#11 nec  ; #1#15 sps;    #1#16 spr;
#1#7 stmia ; #1#104 stdia; #1#9 pcm;
#1#12 stres; #1#17 pdva;   #4#1 contador;#1#13 stfa;
#1#18 pvp1 ; #1#19 pvp2;   #1#20 pvp3; #1#109 redo;
|FIN;


|CALCULO cuenta; |TIPO 0;
|ABRE #4;

|SI 0 ! FSalida;
   |INDEXA #4;
   |LIBERA #4;
   |CIERRA #4;
   |ABRE #4;
|FINSI;

#4#0 = clave;
|LEE 140#4=;
|LIBERA #4;
|SI FSalida ! 0;
   #4#0 = clave;
   #4#1 = 1 ;
   |GRABA 020#4b;
   |LIBERA #4;
|FINSI;
|FCAL;
|CALCULO altahis;|TIPO 0;
|SI flag = 0;
   |HAZ cuenta;
   flag = 1;
|FINSI;
|ABRE #9;
|DDEFECTO #9;
#9#0 = #11#0;
#9#1 = #11#5;       ||fecha de entrada;
|SI #11#4 = "E";
  operacion ="ES";
  uni = #11#3
|SINO;
  operacion ="SS";
  uni = #11#3 * (-1);
|FINSI;
#9#2 = operacion;
#9#3 = codigo;
#9#4 = orden;
|ABRE #12;
#12#0 = #11#2;
|LEE 101#12=;
|LIBERA #12;
|SI FSalida ! 0;
  |GRABA 001#12n;
  |LIBERA #12;
|FINSI;
|LIBERA #12;
|CIERRA #12;
#9#5 = #11#2;        || almacen entrada
#9#6 = uni;
#9#7 = #1#6;
#9#8 = #1#9;
#9#9 = 0;
|GRABA 121#9n;
|LIBERA #9;
|CIERRA #9;
|FCAL;

|CALCULO actualmas;|TIPO 0;
#2#0 = #1#0;
FSalida = 0;
|PARA #2#1 = 0;|SI FSalida = 0; |HACIENDO ;
   |LEE 101#2>;
   |LIBERA #2;
   |SI #2#0 = #1#0;|Y FSalida = 0;
      sto = #2#5 - #2#4;
      #2#3 = sto * #1#9;
      |GRABA 020#2a;
      |LIBERA #2;
   |SINO;
      FSalida = 2 ;
   |FINSI;
|SIGUE;
|FCAL;

|CALCULO salida; ||pablo

#1#0 = #11#0;
#2#0 = #11#0;
#2#1 = #11#2;

|ABRE #1;
|ABRE #2;
|LEE 120#1=;
|LIBERA #1;
|SI 0 = FSalida;
 |LEE 010#2=;
 |LIBERA #2;
 |SI FSalida ! 0;
   |GRABA 010#2c;
   |LIBERA #2;
 |FINSI;
 |SI 0 = FSalida;
     |SI #11#4 ="E";
       #2#39 = #2#39 + #11#3;
       #2#5 = #2#5 + #11#3;
       #1#104 = #1#104 + #11#3;

       sto1 = #1#6 - #1#17;

       #1#6 = #1#6 + #11#3;
  ||   #0#3 = #2#39; pablo
       #1#26 = #11#5;
       sto = #1#6 - #1#17;
     |SINO;
       #2#39 = #2#39 - #11#3;
       #2#5 = #2#5 - #11#3;
       #1#104 = #1#104 - #11#3;
       sto1 = #1#6 - #1#17;
       #1#6 = #1#6 - #11#3;
  ||   #0#3 = #2#39; pablo
       #1#26 = #11#5;
       sto = #1#6 - #1#17;

     |FINSI;
     |SI sto > 0;
        #1#10 = sto * #1#9;
     |SINO;
        #1#10 = 0;
     |FINSI;

     pelas = 0;
     fecha = #11#5;
     fmes = fecha % A402;
     |SI #11#4 = "E";
       suma=32;
       suma1=12;
     |SINO;
       suma = 34;
       suma1=11;
     |FINSI;
     mes = fmes - 1;
     mes = mes * 5;
     mes = mes + suma;
     #1mes = #1mes + #11#3;
     mes = mes + 1;
     #1mes = #1mes + pelas;
     #1#92 = #1#92 + #11#3;
     #1#93 = #1#93 + pelas;
     mes = fmes - 1;
     mes = mes * 2;
     mes = mes + suma1;
     #2mes = #2mes + #11#3;
     #2#36 = #2#36 + #11#3;
     mes = fmes - 1;
     mes = mes + 27;

     sto = #2#5 - #2#4;
     |SI sto > 0;
         #2#3 = sto * #1#9;
     |SINO;
         #2#3 = 0;
     |FINSI;

     nec = sps + stmia; nec = nec - spr; nec = nec - stdia;
     nec = nec - pdva;  nec = nec - stfa;nec = nec - stres;


     |GRABA 020#1a;
     |LIBERA #1;
     |GRABA 020#2a;
     |LIBERA #2;

     |HAZ altahis;
     |HAZ actualmas;

 |FINSI;
|FINSI;
|LIBERA #2;
|LIBERA #1;
|LIBERA #3;
|CIERRA #2;
|CIERRA #1;
|CIERRA #3;

||FINSI;
|FCAL;



|DEFBUCLE proceso;
#11#1;
;
0;
9999;
e;
NULL,salida;
|FIN;
|PROGRAMA;
  |ABRE #11;
  |BUCLE proceso;
  |LIBERA #11;
  |CIERRA #11;
|FPRO;
