|FICHEROS;
     dsz00110 #0;
     agifa019 #19;
|FIN;

|VARIABLES;
     nNume = 0;
     &enTiva = 0;
     &enIva = 0;
     &efFiva = @;
     &eaDiva = "";
     aAlfa = "";
     nIva = -1;
     nIvaAnt = 0;
     nIvaAct = 0;
     nPvp = 0;
     nError = 0;
|FIN;

|PROCESO Calcula;
     |SI #19#130 = "S";
          nPvp = #19#18 / (1+(nIvaAnt/100))
          #19#18 = nPvp > nIvaAct;
     |FINSI;
     |SI #19#131 = "S";
          nPvp = #19#19 / (1+(nIvaAnt/100))
          #19#19 = nPvp > nIvaAct;
     |FINSI;
     |SI #19#132 = "S";
          nPvp = #19#20 / (1+(nIvaAnt/100))
          #19#20 = nPvp > nIvaAct;
     |FINSI;
     |SI #19#153 = "S";
          nPvp = #19#147 / (1+(nIvaAnt/100))
          #19#147 = nPvp > nIvaAct;
     |FINSI;
     |SI #19#154 = "S";
          nPvp = #19#148 / (1+(nIvaAnt/100))
          #19#148 = nPvp > nIvaAct;
     |FINSI;
     |SI #19#155 = "S";
          nPvp = #19#149 / (1+(nIvaAnt/100))
          #19#149 = nPvp > nIvaAct;
     |FINSI;
     |GRABA 020#19a;
     |LIBERA #19;
|FPRC;

|PROCESO agifa019;
     |SI nError = 0; |O nIva ! #19#30;
          nIva = #19#30;
          nError = 0;

          enTiva = #19#30;
          nNume = #0#2;
          nNume = nNume - 1;
          efFiva = nNume;
          |HAZ SacaIVA;
          |SI eaDiva = "";
               nError = 1;
               aAlfa = "0000No existe tipo iva " + enTiva + " anterior al " + efFiva;
               |MENAV aAlfa;
          |SINO;
               nIvaAnt = enIva;
               enTiva = #19#30;
               efFiva = #0#2;
               |HAZ SacaIVA;
               |SI eaDiva = "";
                    nError = 1;
                    aAlfa = "0000No existe tipo iva " + enTiva + " posterior o igual al " + efFiva;
                    |MENAV aAlfa;
               |SINO;
                    nIvaAct = enIva;
                    |HAZ Calcula;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE agifa019;
     #19#1;
     ;
     #0#0;
     #0#1;
     be;
     NULL, NULL, NULL, NULL, NULL, agifa019;
     #19#30;
|FIN;

|PROCESO Tipo3; |TIPO 3;
     |HAZ DecimalesBase;
     |BUCLE agifa019;
|FPRC;
