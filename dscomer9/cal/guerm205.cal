|FICHEROS;
  guerm205 #0;       || Cabeceras
  guerm206 #1;
  agifa027 #3;           ||Contadores
  agifa024 #4;       || Clientes
  guerm200 #5;       || Control
  guerm201 #8;       || Camiones
  guerm202 #9;
  guerm049;
  referen@;
  guerm204 #204;
  guerm207 #207;
  guerm208 #208;
  guerm210 #210;
  guerm211 #211;
  guerm220 #220;
  guerm225 #225;
|FIN;

|VARIABLES;
     &enTiva = 0;
     &efFiva = @;
     &eaDiva = "";
     &enIva = 0;
     &enRec = 0;

  aSql = "";
  aDef = "";
  aAlfa = "";
  nModo = 0;
  fecha     = @;
  hora      = "";
  opcion    = 0;
  opcio     = 0;
  &tipo     = "";
  &sumalin  = 0;
  &codpos   = "";
  &descrip  = "";
  traba = "";
  nume = 0;
  x = 0;
  alfa = "";
  alf1 = "";
  &EURODB = 0;
  &estoyen = "";
  nConta = 0;
     || MENU PARA INTRODUCIR EL CODIGO DEL CLIENTE DE FORMA AUTOMATICA.
 {-1}menu           = "";
     menu1          = "2400";
     menu2          = "1";
     menu3          = "Contador:  ";
     menu4          = "AM";
     menu5          = " Automatico ";
     menu6          = " Manual ";
|FIN;

|PROCESO ModoFac; |TIPO 0;
     nModo = (FEntrada / 100)
     |ABRE #5; |LEE 101#5p; |CIERRA #5;
     |MODULO aAlfa;
     |SI aAlfa = "guerm205";
          |SI #0#53 ! "N"; |Y #0#53 ! "C";
               |MENAV "0000En introduccion directa solo se permite 'N' y 'C'";
               |ERROR;
          |FINSI;
     |FINSI;

     |C_M #0#15, 1, "S";
     |C_M #0#40, 1, "S";
     |C_M #0#18, 1, "S";
     |SI #0#51 = "N";
          |SI #0#15 = "A";  #0#40 = #5#0;   |PINTA #0#40;  |FINSI;
          |SI #0#15 = "a";  #0#40 = #5#26;  |PINTA #0#40;  |FINSI;
     |FINSI;
|FPRC;

|PROCESO Menus2;
  |SI opcion ! 1;  |ACABA;  |FINSI;
  |MENU menu;
  |SI FSalida = 1;    ||Automatico
      |ABRE #5;
      |LEE 101#5p;
      #5#35 = #5#35 + 1;
      |GRABA 101#5a;
      #0#0 = #5#35;
      |PINTA #0#0;
      |CIERRA #5;
  |FINSI;
|FPRC;

|PROCESO quemodifico;
  #0#14 = 0;
  #0#16 = 0;
  #0#17 = 0;
  |PINTA #0#14;
|FPRC;

|PROCESO Contador;
  |SI FSalida ! 13;  |ACABA;  |FINSI;
  |ABRE #5;
  |LEE 101#5p;
  |SI #0#15 = "A";
      |ABRE #3;
      #3#0 = "valbaran";
      #3#2 = #0#40;
      |LEE 101#3=;
      |SI FSalida ! 0;
          nConta = 1;
          #3#1 = 2;
          |GRABA 021#3b;
      |SINO;
          nConta = #3#1;
          #3#1 = #3#1 + 1;
          |GRABA 021#3a;
      |FINSI;
      #0#18 = nConta;
      |PINTA #0#18;
      |CIERRA #3;
  |FINSI;
  |SI #0#15 = "a";
      #5#28 = #5#28 + 1;
      #0#18 = #5#28;
      #0#14 = 0;
      |PINTA #0#14;
      |PINTA #0#18;
      |GRABA 101#5a;
  |FINSI;
  |CIERRA #5;
|FPRC;

|PROCESO tipo8;  |TIPO 8;
  |ABRE #5;
  |LEE 101#5p;
  |SI FSalida ! 0;  |DDEFECTO #5;  |FINSI;
  |CIERRA #5;
  estoyen = #5#25;

  |HAZ DecimalesBase;
|FPRC;

--------------------------------------------
|PROCESO tipo1;  |TIPO 1;
  |SI #0#37 = "S";
      |CONFI "2400NAlbaran pasado a Facturacion CONTINUAR";
      |SI FSalida ! 0;
          |PTEC 807; || Ctrl-C
          |ACABA;
      |FINSI;
      |MENAV "    LAS MODIFICACIONES NO SE REFLEJARAN EN FACTURACION";
  |FINSI;
|FPRC;

|PROCESO movi; |TIPO 7;
  opcion = (FEntrada / 100) ! 0;
  |SI opcion = 1;  |Y #5#25 = "C";
      |MENAV "0000No puede dar de alta";
      |PTEC 807; || Ctrl-C
      |ACABA;
  |FINSI;
  |SI opcion = 2;  |O opcion = 1;
      |CAMPO_MODIFICA #0#1,  1, "S";
      |CAMPO_MODIFICA #0#18, 1, "S";
      |CAMPO_MODIFICA #0#40, 1, "S";
  |SINO;
      |CAMPO_MODIFICA #0#1,  1, "N";
      |CAMPO_MODIFICA #0#18, 1, "N";
      |CAMPO_MODIFICA #0#40, 1, "N";
  |FINSI;
  |SI opcion = 1;  |O opcion = 2;
      |C_M #0#15, 1, "S";
  |SINO;
      |C_M #0#15, 1, "N";
  |FINSI;
  |HAZ Menus2;
|FPRC;

|PROCESO consultando; |TIPO 7;
  opcio = (FEntrada / 100) ! 0;
  |SI opcio = 1;  |O opcio = 2;
      |SI #0#37 = "S";
         |CONFI "    NAtencion ALBARAN PASADO A FACTURACION DESEA CONTINUAR";
      |FINSI;
  |FINSI;

  |SI opcio ! 2;  |Y opcio ! 1;
      |CAMPO_MODIFICA #0#1,  1, "N";
      |CAMPO_MODIFICA #0#15, 1, "N";
      |CAMPO_MODIFICA #0#18, 1, "N";
      |CAMPO_MODIFICA #0#37, 1, "N";
      |CAMPO_MODIFICA #0#40, 1, "N";
  |SINO;
      |CAMPO_MODIFICA #0#1,  1, "S";
      |CAMPO_MODIFICA #0#15, 1, "S";
      |CAMPO_MODIFICA #0#18, 1, "S";
      |CAMPO_MODIFICA #0#37, 1, "S";
      |CAMPO_MODIFICA #0#40, 1, "S";
  |FINSI;
  |HAZ Litros7;
|FPRC;

---------------------------------------------
|PROCESO elcliente; |TIPO 0;
  sumalin = #0#20;
  |CAMPO_MODIFICA #0#4,1,"S";
  |CAMPO_MODIFICA #0#5,1,"S";
  |CAMPO_MODIFICA #0#6,1,"S";
  |CAMPO_MODIFICA #0#7,1,"S";
  |CAMPO_MODIFICA #0#9,1,"S";
  |CAMPO_MODIFICA #0#10,1,"S";
  |SI #0#3 = 999999;
      |SI Contenido ! 999999;
          #0#4= "";
          #0#5= "";
          #0#6= "";
          #0#7= "";
          #0#9= "";
          #0#10= "";
          |PINTA #0#4;
          |PINTA #0#5;
          |PINTA #0#6;
          |PINTA #0#7;
          |PINTA #0#8;
          |PINTA #0#9;
          |PINTA #0#10;
      |FINSI;
      |HAZ leecamion;
      |ACABA;
  |FINSI;
  |ABRE #4;
  |DDEFECTO #4;
  #4#0 = #0#3;
  |LEE 101#4=;
  |SI FSalida ! 0;
      |ERROR;
  |SINO;
      #0#4 = #4#1;   || Nombre
      #0#5 = #4#8;   || Direccion
      #0#6 = #4#181; || Cp1
      #0#7 = #4#182; || Cp2
      #0#8 = #4#10;  || Provincia
      #0#9 = #4#9;   || Poblacion
      #0#10= #4#15;   || CIF
      |PINTA #0#4;
      |PINTA #0#5;
      |PINTA #0#6;
      |PINTA #0#7;
      |PINTA #0#8;
      |PINTA #0#9;
      |PINTA #0#10;
      |CAMPO_MODIFICA #0#4,1,"N";
      |CAMPO_MODIFICA #0#5,1,"N";
      |CAMPO_MODIFICA #0#6,1,"N";
      |CAMPO_MODIFICA #0#7,1,"N";
      |CAMPO_MODIFICA #0#9,1,"N";
      |CAMPO_MODIFICA #0#10,1,"N";
  |FINSI;
  |LIBERA #4;
  |CIERRA #4;
  |HAZ leecamion;
|FPRC;

|PROCESO leecamion;
  |ABRE #8;
  #8#0 = #0#11;
  |LEE 101#8=;
  |SI FSalida = 0;
      #0#35 = #8#6;
      |SI #8#7 = #0#3;
          #0#35 = "N";
      |FINSI;
  |FINSI;
  |CIERRA #8;
|FPRC;

|PROCESO antesde;  |TIPO 7;
  |SI #0#15 = "A";
      |CAMPO_MODIFICA #0#21, 1, "N";
  |SINO;
      |CAMPO_MODIFICA #0#21, 1, "S";
  |FINSI;
|FPRC;

|PROCESO despuesde;
  #0#22 = #0#20 - #0#21;
  #0#23 = ((#0#22 * #0#14) / 100) ! EURODB;
  #0#24 = #0#22 + #0#23;
  |SI #0#15 = "A";
      #0#21 = 0;
      #0#22 = 0;
      #0#23 = 0;
      #0#24 = 0;
  |FINSI;
  |PINTA #0#22;
  |PINTA #0#23;
  |PINTA #0#24;
|FPRC;

|PROCESO Kmts;
     #0#43 = #0#42 - #0#41;
     |PINTA #0#43;
|FPRC;


|PROCESO Litros7; |TIPO 7;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 1;
          |ABRE #guerm049;
          |LEE 000#guerm049.p;
          |CIERRA #guerm049;
          #0#44 = #guerm049#1;
          |PINTA #0#44;
     |FINSI;
|FPRC;

|PROCESO Litros0; |TIPO 0;
     |SI #0Campo ! Contenido;
          #0#45 = #0#44 * #0#46;
          |PINTA #0#45;
     |FINSI;
|FPRC;

|PROCESO Obra205_0; |TIPO 0;
     |ABRE #9;
     #9#0 = #0#3;
     #9#2 = #0#29;
     |LEE 000#9=;
     |SI #9#6 = "N";
          |MENAV "0000Obra Cerrada...";
          |ERROR;
     |FINSI;
     |CIERRA #9;
|FPRC;

|PROCESO Obra205_66; |TIPO 66;
     aSql = "SELECT * FROM guerm202 INTO sq" + Usuario + ".def WHERE ";
     aSql = aSql + "6 == S AND 0 == " + #0#3;

     |SQL aSql;
     |SI FSalida = 0;
          |DDEF aDef; |QBF aDef;
          aDef = aDef + "sq" + Usuario + ".mas";
          |CARGA_DEF aDef, referen@;
          |SI FSalida = 0;
               |ABRE #referen@;
               |CONSULTA_CLAVE #1#referen@;
               |SI FSalida = 0;
                    #0#29 = #referen@#2;
                    #0#30 = #referen@#4;
                    |PINTA #0#29;
                    |PINTA #0#30;
               |SINO;
                    |ERROR;
               |FINSI;
               |CIERRA #referen@;
               |DELINDEX #referen@;
               |DESCARGA_DEF #referen@;
               |FBORRA aDef;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Movi0; |TIPO 0;
     nModo = (FEntrada/ 100) ! 0;
     |SI nModo ! 1; |ACABA; |FINSI;

     |ABRE #210;
     |CONSULTA_CLAVE #1#210;
     |SI FSalida ! 0;
          |ERROR;
     |SINO;
          #0#47 = "S";
          #0#48 = #210#0;
          #0#49 = #210#1;
          #0#50 = #210#6;
          #0#54 = 0; || Linea Pedido (se identifica la salida manual cuando es 0)
          #0#51 = "S"; ||Finalizada
          |PINTA #0#47;
          |PINTA #0#48;
          |PINTA #0#49;
          |PINTA #0#50;
          |PINTA #0#51;
          #0#3 = #210#3; |PINTA #0#3;
          #0#4 = #210#4; |PINTA #0#4;
          #0#29 = #210#7; |PINTA #0#29;
          #0#30 = #210#8; |PINTA #0#30;
          |ABRE #210;
          #210#0 = #0#48;
          #210#1 = #0#49;
          |LEE 000#210=;
          |SI FSalida = 0;
               |ABRE #207;
               #207#0 = #210#6;
               |LEE 000#207=;
               |SI FSalida = 0;
                    #0#53 = #207#11;
                    |PINTA #0#53;
               |FINSI;
               |CIERRA #207;
          |SINO;
               |ERROR;
          |FINSI;
          |CIERRA #210;
     |FINSI;
     |CIERRA #210;
|FPRC;

|PROCESO CargaLin;
     |DDEFECTO #1;
     #1#0 = #211#2;
     #1#1 = #0#0;
     #1#2 = #211#3;
     #1#3 = #211#4;
     #1#5 = #211#7;
     #1#8 = #211#12;

     |DDEFECTO #204;
     |ABRE #204;
     #204#0 = #0#3;
     #204#1 = #0#29;
     #204#2 = #1#2;
     |LEE 000#204=;
     |SI FSalida ! 0;
/*
          |PUSHV 0501 2380;
          #204#3 = #0#4;
          #204#4 = #0#30;
          #204#5 = #1#3;
          #204#6 = #1#5;
          |PINPA #0#204;
          |PINDA #0#204;
          |ENDATOS #1#204;
          |SI FSalida = 0;
               #1#5 = #204#6;
               |GRABA 020#204n;
          |FINSI;
          |POPV;
*/
     |FINSI;
     |CIERRA #204;

     |DDEFECTO #225;
     |ABRE #225;
     |ABRE #8;
     #8#0 = #0#11;
     |LEE 000#8=;
     |SI FSalida = 0; |Y #8#11 = "S";
          #225#0 = #8#12;
     |SINO;
          #225#0 = "000000";
     |FINSI;
     |CIERRA #8;
     #225#6 = #0#3;
     #225#1 = #0#29;
     #225#2 = #0#29;
     #225#3 = #1#2;
     |LEE 000#225=;
     |SI FSalida ! 0;
/*
          |PUSHV 0501 2380;
          #225#2 = #0#30;
          #225#4 = #1#3;
          |PINPA #0#225;
          |PINDA #0#225;
          |PARA; |SI; |HACIENDO;
               |ENDATOS #1#225;
               |SI FSalida = 0; |SAL; |FINSI;
          |SIGUE;
          |POPV;
          |GRABA 020#225n;
          #1#9 = #225#5;
*/
     |FINSI;
     |CIERRA #225;

     #0#56 = #0#56 + (#1#7 * #1#9);

     |GRABA 020#1n;
|FPRC;

|PROCESO Tipo5; |TIPO 5;
     nModo = (FEntrada/ 100) ! 0;
     |SI nModo ! 1; |ACABA; |FINSI;
     |ABRE #210;
     #210#0 = #0#48;
     #210#1 = #0#49;
     |LEE 020#210=;
     |SI FSalida = 0;
          |ABRE #1;
          |ABRE #208;
          |BUCLELIN 2CargaLin#210;
          |CIERRA #1;
          |CIERRA #208;
     |FINSI;
     |CIERRA #210;
     |PINTA #0#56;
|FPRC;

|PROCESO Tipo2Cab; |TIPO 2;
     |ABRE #220;
     |SELECT #2#220;
     #220#27 = #0#0;
     |LEE 101#220=;
     |SI FSalida = 0;
          #220#37 = "N";
          |GRABA 020#220a;
     |FINSI;
     |CIERRA #220;
|FPRC;

|PROCESO BorraLin;
     |SI #1#7 = 0;
          |BORRA 020#1a;
     |FINSI;
|FPRC;

|DEFBUCLE BorraLin;
     #1#1;
     ;
     #0#0, 001;
     #0#0, 999;
     be;
     NULL, BorraLin;
|FIN;

|PROCESO Tipo3; |TIPO 3;
     |CONFI "0000N¿BORRAR LINEAS CON UNIDADES '0'?";
     |SI FSalida = 0;
          |BUCLE BorraLin;
     |FINSI;
|FPRC;

|PROCESO DefeIVA; |TIPO 0;
     |ABRE #5; |LEE 000#5p; |CIERRA #5;
     enTiva = #5#8;
     efFiva = #0#1;
     |HAZ SacaIVA;
     |SI eaDiva = "";
          |MENAV "0000No existe IVA para esta fecha...";
     |SINO;
          #0#14 = enIva; |PINTA #0#14;
     |FINSI;
|FPRC;
