|FICHEROS;
     agifa512 #512;
     tmp00501 #501;           || Es el agifa501
     dsz00046 #46;
     agifa024 #14;
     agifa510 #7;
     agifa509 #8;
     agifa515 #19;
     agifa516 #20;
     agifa142 #142;
     agifa505 #4;
|FIN;

|VARIABLES;
     &eFecha   = "";
     &eCaja    = 0;
     aEmp      = "";
     nHay      = 0;
     nForma    = 0;
     nNume     = 0;
     nDto      = 0;
     nNeto     = 0;
     nImpo     = 0;
     aMes      = "";
     nMes      = 0;
     periodo   = 0;
     i         = 0;
     j         = 0;
     puente_n  = 0;
     puente_a  = "";
|FIN;

|INCLUYE i_varart;

|PROCESO Print;
     nHay = 1;
     |PRINT;
|FPRC;

|DEFBUCLE Pagos;
     #512#3;
     5;
     "      ", eFecha, "     ", 000000, eCaja;
     "zzzzzz", eFecha, "zzzzz", 999999, eCaja;
     ;
     NULL, Print;
|FIN;

|PROCESO InfPago;
     |IMPRE 0;
     |SI FSalida = 0;
          |INFOR "infopago";
          |SI FSalida = 0;
               nHay = 0;
               |BUCLE Pagos;
               |SI nHay ! 0; |PIEINF; |FINSI;
               |FININF;
          |SINO;
               |MENAV "0000Informe 'infopago' inexistente...";
          |FINSI;
          |FINIMP;
     |FINSI;
|FPRC;

|DEFBUCLE Tiquets;
     #501#3;
     12;
     eFecha, "      ", " ", "     ", 000001, eCaja;
     eFecha, "zzzzzz", "z", "zzzzz", 999999, eCaja;
     ;
     NULL, NULL, NULL, NULL, NULL, Print;
     #501#35, #501#57, #501#58;
|FIN;

|PROCESO InfVenta;
     |IMPRE 0;
     |SI FSalida = 0;
          |INFOR "infovent";
          |SI FSalida = 0;
               nHay = 0;
               |BUCLE Tiquets;
               |SI nHay ! 0; |PIEINF; |FINSI;
               |FININF;
          |SINO;
               |MENAV "0000Informe 'infovent' inexistente...";
          |FINSI;
          |FINIMP;
     |FINSI;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO MiraTiquet; |TIPO 0;
     |ABRE #501;
     #501#35 = "T";
     #501#57 = #46#0;
     #501#58 = #46#1;
     |LEE 000#501=;
     |SI FSalida ! 0;
          |MENAV "0000El tiquet no existe...";
          |ERROR;
     |SINO;
          |SI #501#14 ! eFecha;
               |MENAV "0000El tiquet es de otro dia...";
               |ERROR;
          |SINO;
               |SI #501#31 = "V";
                    |MENAV "0000Los vales no se pueden cambiar...";
                    |ERROR;
               |SINO;
                    |SI #501#31 = "D";
                         |MENAV "0000Las deudas no se pueden cambiar...";
                         |ERROR;
                    |SINO;
                         #46#2 = #501#9;
                         #46#3 = #501#10;
                         #46#4 = #501#11;
                         #46#5 = #501#31;
                         #46#6 = #501#36;
                         #46#7 = #501#0;
                         |PINDA #0#46;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
     |CIERRA #501;
|FPRC;

|PROCESO Tipo66; |TIPO 66;
     |ABRE #501;
     |SELECT #3#501;
     #501#35 = "T";
     #501#57 = #46#0;
     #501#58 = #46#1;
     |LEE 000#501];
     |CONSULTA_CLAVE #3#501;
     |SI FSalida = 0;
          #46#0 = #501#57;
          #46#1 = #501#57;
          |PINTA #46#0;
          |PINTA #46#1;
     |FINSI;
     |CIERRA #501;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO ActuaTarjeta;
     |SI #501#40 = 0; |ACABA; |FINSI;
     |ABRE #19;
     |ABRE #20;

     |DDEFECTO #19;
     #19#0 = #501#46;
     |LEE 141#19=;
     |SI FSalida ! 0; |GRABA 040#19b; |FINSI;
     #19#2 = #19#2 + (#501#40 * nForma);    ||Total Ptas cargadas
     #19#3 = #501#14;                       ||Fecha Ult. Oper.
     #19#4 = #501#40;                       ||Ptas Cargadas
     |GRABA 040#19a;

     |DDEFECTO #20;
     #20#0 = #501#46;
     #20#1 = #501#14;
     |LEE 141#20=;
     |SI FSalida ! 0; |GRABA 040#20b; |FINSI;
     #20#2 = #20#2 + (#501#40 * nForma);  ||Total Ptas cargadas
     |GRABA 040#20a;

     |CIERRA #19;
     |CIERRA #20;
|FPRC;

|PROCESO ActuaCliente;
     |DDEFECTO #14;
     |ABRE #14;
     #14#0 = #501#1;
     |LEE 141#14=;
     |SI FSalida ! 0; |GRABA 040#14b; |FINSI;

     |SI #501#3 > 0; nNume = 1; |SINO; nNume = -1; |FINSI;
     #501#3 = #501#3 * nNume;
     nDto = (((#501#3 < #501#17) < #501#19) < #501#18) * nNume;
     #501#3 = #501#3 * nNume;

     nDto = #501#3 - nDto;   || Total Dto Cabecera
     nNeto = #501#3 - nDto;

     |SI #501#35 = "A";
          #14#50 = #14#50 + (nNeto * nForma);
          enImpCliPen = (nNeto * nForma);
     |SINO;
          |SI #142#115 = "N";
               nImpo = (nNeto * 100) / (100 - #501#18);
               nDto = nDto + (nNeto - nImpo);
          |SINO;
               nImpo = nNeto;
          |FINSI;
          aMes = #501#14 % A402;
          nMes = ((aMes - 1) * 4) + 54;
          #14nMes = #14nMes + (nImpo * nForma);

          nMes = nMes + 1;
          #14nMes = #14nMes + (nDto * nForma);

          nMes = nMes + 1;
          #14nMes = #14nMes + (#501#8 * nForma);

          #14#102 = #14#102 + (nImpo * nForma);
          #14#103 = #14#103 + (nDto * nForma);
          #14#104 = #14#104 + (#501#8 * nForma);
          #14#45 = #501#14;
          #14#46 = nNeto;
          #14#110 = #14#110 + (nNeto * nForma);

          enImpCliCom = (nImpo * nForma);
          enImpCliDto = (nDto * nForma);
          enImpCliMar = (#501#8 * nForma);
          enImpCliFac = (nNeto * nForma);
     |FINSI;
     eaCliente = #501#1;
     efFecha = #501#14;
     |HAZ AcumulaCli;


     |GRABA 040#14a;
     |CIERRA #14;
|FPRC;

|PROCESO horario;
     periodo = 0;
     |PARA i = 1; |SI i [ 19; |HACIENDO i = i + 2;
          j = i + 1;
          periodo = periodo + 1;
          |SI puente_n ] #7#i#; |Y puente_n [ #7#j#;
               |SAL;
          |FINSI;
     |SIGUE;
|FPRC;

|PROCESO ActuaResumen;
     |ABRE #7;          ||Horario
     #7#0 = #4#18;
     |LEE 000#7=;
     |CIERRA #7;

     |ABRE #8;
     |DDEFECTO #8;
     #8#63 = aEmp;
     #8#0 = eCaja;
     #8#1 = eFecha;
     |LEE 141#8=;
     |SI FSalida ! 0; |GRABA 040#8b; |FINSI;
     |SI #501#31 ! "V";
          |SI #501#31 = "R";  ||Rotura=Basura
               #8#67 = #8#67 + (#501#9 * nForma);
          |SINO;
               |SI #501#31 = "A";
                    #8#68 = #8#68 + (#501#63 * nForma);  || Invitacion
               |SINO;
                    |SI #501#35 ! "A";
                         #8#24 = #8#24 + (#501#9 * nForma);   ||Venta con imp.
                         #8#25 = #8#25 + (#501#4 * nForma);   ||Total iva
                         #8#26 = #8#26 + (nForma *(#501#22+#501#25+#501#47+#501#50+#501#53));
                         #8#27 = #8#24 - #8#25 - #8#26;
                         #8#28 = #8#28 + (#501#28 * nForma);  ||Total dto
                         #8#29 = #8#29 + (#501#3 * nForma);   ||Total bruto
                    |FINSI;
                    |SI #501#35 = "A";
                         #8#8 = #8#8 + nForma;
                         #8#17 = #8#17 + (#501#9 * nForma);
                    |SINO;
                         |SI #501#35 = "F";
                              #8#7 = #8#7 + nForma;
                              #8#16 = #8#16 + (#501#9 * nForma);
                         |SINO;
                              #8#6 = #8#6 + nForma;
                              #8#15 = #8#15 + (#501#9 * nForma);
                         |FINSI;
                    |FINSI;
                    puente_a = (#501#34 % 102) + (#501#34 % 402);
                    puente_n = puente_a;
                    |HAZ horario;
                    puente_n = periodo + 29;
                    #8#puente_n# = #8#puente_n# + nForma;
                    puente_n = puente_n + 10;
                    #8#puente_n# = #8#puente_n# + (#501#9*nForma);
                    |SI #4#163 = "S"; |O #501#9 > 0;
                         #8#52 = #8#52 + (#501#38 * nForma);       ||Efectivo
                         #8#55 = #8#55 + ((#501#38 + #501#40 + #501#39)*nForma);
                    |FINSI;
                    #8#53 = #8#53 + (#501#40 * nForma);            ||Tarjeta
                    #8#54 = #8#54 + (#501#39 * nForma);            ||Cheque
                    #8#58 = #8#58 + (#501#41 * nForma);            ||Pendiente de credito
                    #8#57 = #8#57 + (#501#15 * nForma);            ||Restos no cobrados
               |FINSI;
          |FINSI;
     |SINO;
          #8#84 = #8#84 + (#501#66 * nForma);  ||Vales
     |FINSI;

     |GRABA 040#8a;
     |CIERRA #8;
|FPRC;
