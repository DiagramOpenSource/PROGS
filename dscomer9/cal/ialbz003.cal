|FICHEROS;
     ialbz003 #0;
     ialbm009 #1;
     ialbm010 #2;
     ialbm006 #6;
     agifa019 #19;
     agifa024 #24;
     agifa025 #25;
     agifa010 #10;
     agifa071 #71;
     ialbm001 #100;
     agifa142 #142;
     agifa321 #321;
     agifa324 #324;
|FIN;

|VARIABLES;
     &aDivisa = "";
     &aMoneda = "";
     &enSwMenu = 0;
     &enForma = 0;
     &enCoste = 0;
     fecha = "";
     a¤o = "";
     nSw = 0;
     cant = 0;
     importe = 0;
     &eaTag = "";
     &enImpCliPen = 0;
     eaCliente = "";
     efFecha = @;

     &uni_dt = 0;   || Unidades
     &fed_dt = @;   || Fecha....
     &art_dt = "";  || Articulo.
     &cli_dt = "";  || Cliente..
     &fam_dt = "";  || Familia.
     &iva_dt = 0;   || Tipo Iva.
     &dtos_2 = 0;   || Descuento 2.
     &dto_pt = 0;   || Descuento Ptas.
     &dtos_1 = 0;   || Descuento 1.
     &pvp_ve = 0;   || Precio Venta.
     &tarifa = 0;   || Tarifa Cliente.
     &quedto = 0;   || 1=cli./art, 2=cli./familia, 3=cli./subfam.
     &gru_dt = "";  || Grupo Cliente.
     &nPromo = 0;
     &enDescuento1 = 0;
     &enDescuento2 = 0;
     &eaTComision  = "";
     &enComision   = 0;
     &enMensaje = 0;
     &eaSerie = "";
     &eaArticulo = "";
     &eaRepre = "";
     &enDirEnt = 0;
     &enAlmacen = 0;
|FIN;

|PROCESO DtoComi;
     fed_dt = #10#1;   || Fecha....
     art_dt = #71#2;   || Articulo.
     cli_dt = #71#15;  || Cliente..
     fam_dt = #71#13;  || Familia.
     iva_dt = #71#11;  || Tipo Iva.
     dtos_2 = 0;      || Descuento 2.
     dto_pt = 0;      || Descuento Ptas.
     dtos_1 = 0;      || Descuento 1.
     pvp_ve = 0;      || Precio Venta.
     tarifa = #24#39;  || Tarifa Cliente....
     gru_dt = #24#158; || Grupo Cliente.
     nPromo = #10#89;
     |SI #71#35 ! 0;
          uni_dt = #71#35;
     |SINO;
          uni_dt = #71#5;
     |FINSI;
     enMensaje = 0;
     eaSerie = #71#29;
     enDirEnt = #10#84;
     enAlmacen = #71#3;

     |HAZ calcdtos;              || Calculo Dtos.....
||     #71#6   = pvp_ve - dto_pt;   || Precio Venta. sin iva.
     #71#8   = dtos_1;            || 1¦ Dto.
     #71#33  = dtos_2;            || 2§ Dto.

     enDescuento1 = #71#8;
     enDescuento2 = #71#33;
     eaTComision  = #71#16;
     eaCliente    = #10#3;
     eaArticulo   = #71#2;
     eaRepre      = #10#6;
     efFecha      = #10#1;
     enDirEnt = #10#84;
     enAlmacen = #71#3;
     |SI #71#35 ! 0;
          uni_dt = #71#35;
     |SINO;
          uni_dt = #71#5;
     |FINSI;
     |HAZ Comisiones;

     #71#8 = enDescuento1;
     #71#10 = enComision;
||     #71#6 = pvp_ve - dto_pt;   || Precio Venta. sin iva.

     #71#36 = #71#6 / #10#74 * #10#69;
|FPRC;

|PROCESO actpf;
     |SI #10#15 ] 0;
          importe = 1;
     |SINO;
          importe = -1;
          #10#15 = -#10#15;
     |FINSI;
     cant = #10#15 < #10#5;
     cant = cant < #10#32;
     cant = cant < #10#7;
     cant = cant * importe;
     #10#15 = #10#15 * importe;
     |ABRE #24;
     #24#0 = #10#3;
     |LEE 121#24=;
     |SI FSalida = 0;
        |SI #10#43 = AN;
           #24#50 = #24#50 + cant;    || es albaran
        |SINO;
           #24#50 = #24#50 - cant;    || es abono
        |FINSI;
        |GRABA 020#24a;
        |LIBERA #24;
     |FINSI;
     |CIERRA #24;

     |SI #10#43 = "N";
          enImpCliPen = cant;
     |SINO;
          enImpCliPen =  -cant;
     |FINSI;
     eaCliente = #10#3;
     efFecha = #10#1;
     |HAZ AcumulaCli;

     eaTag = "AV";  |HAZ Riesgos;
|FPRC;

|PROCESO CreaLin;
     nSw = 0;
     |HAZ LinCarton;
     |SI nSw = 0; |ACABA; |FINSI;

     |ABRE #19;
     #19#0 = #2#2;
     |LEE 000#19=;
     |CIERRA #19;

     |DDEFECTO #71;
     #71#29 = #10#52;
     #71#0 = #10#0;
     #71#1 = #2#0;
     #71#2 = #2#2;
     #71#3 = 1;
     #71#4 = #2#3;
     #71#5 = 1;
     #71#6 = #2#12;
     #71#11 = 2;
     #71#13 = #19#2;
     #71#15 = #10#3;
     #71#16 = #10#34;
     #71#17 = #10#35;

     |HAZ DtoComi;

     |HAZ TotalLin71;
     |HAZ CalCabAgifa010;
     |HAZ AcumulaAV;
     #71#14 = enCoste;
     |GRABA 020#71n;
|FPRC;

|PROCESO CreaCab;
     |ABRE #24;
     #24#0 = #1#0;
     |LEE 000#24=;
     |CIERRA #24;

     |DDEFECTO #100;
     #100#0 = #1#0;
     |LEE 000#100=;

     #10#52 = #0#8;
     enSwMenu = 1;
     |HAZ ContaAV7;

     |SI #10#52 = #6#9; |O #10#52 = #6#10; |O #10#52 = #6#11; |O #10#52 = #6#12;
          #10#5 = #100#1;
     |SINO;
          #10#5 = #24#37;
          #10#7 = #24#38;
          #10#32 = #24#156;
     |FINSI;

     #10#1 = #0#11;
     #10#3 = #1#0;
     #10#4 = #1#1;
     #10#6 = "00";
     #10#12 = 2;
     #10#14 = 2;
     #10#29 = #1#1;
     #10#30 = #1#3;
     #10#31 = #1#4;
     #10#33 = #1#5;
     #10#36 = "N";
     #10#43 = "N";
     #10#51 = "S";
     #10#55 = #1#14;
     #10#56 = #1#15;
     #10#57 = #1#16;
     #10#8 = #24#20;
     #10#9 = #24#35;
     #10#35 = #24#4;
     #10#40 = #24#41;
     #10#50 = #24#40;
     #10#5 = #24#37;

     |ABRE #324;
     #10#68 = #24#192;
     #324#0 = #10#68;
     |LEE 000#324=;
     #10#69 = #324#2;
     #10#70 = #24#193;
     #10#73 = #321#9;
     #324#0 = #10#73;
     |LEE 000#324=;
     #10#74 = #324#2;
     |CIERRA #324;

     |GRABA 020#10b;
     aDivisa = #10#68;
     aMoneda = #10#70;
     |HAZ Divisas010;
     |HAZ LimCabAgifa010;
|FPRC;

|PROCESO FinCarton;
     |SI nSw = 0;
          |ACABA;
     |FINSI;
     enForma = 1;
     |ABRE #10;
     |ABRE #71;
     |HAZ CreaCab;
     |BUCLELIN 0 CreaLin #1;
     |GRABA 020#10a;
     |CIERRA #71;
     |CIERRA #10;
     |HAZ actpf;
|FPRC;

|PROCESO LinCarton;
     fecha = #2#7;
     a¤o = fecha % A704;
     |SI #2#14 = #0#3;
          |SI #2#9 = #0#2;
               |SI #2#5 ] #0#6;|Y #2#5 [ #0#7;
                    |SI #2#6 = #0#9;
                         |SI #0#4 ] a¤o;
                              nSw = 1;
                         |FINSI;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Carton;
     nSw = 0;
|FPRC;

|DEFBUCLE Carton;
     #1#1;
     ;
     #0#0;
     #0#1;
     be;
     NULL, Carton, LinCarton, FinCarton;
|FIN;

|CALCULO pasealb;|TIPO 3;
     |ABRE #142; |LEE 000#142p; |CIERRA #142;
     |ABRE #321; |LEE 000#321p; |CIERRA #321;
     |ABRE #6; |LEE 000#6p; |CIERRA #6;

     |ABRE #100;
     |BUCLE Carton;
     |CIERRA #100;
|FCAL;
