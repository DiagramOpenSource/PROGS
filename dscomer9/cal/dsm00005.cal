     || Lo llama el dsz00002

|FICHEROS;
     dsz00002 #0;
     referen@ #5;
     agi00014 #14;
     agifa017 #17;
     agifa019 #19;
     agifa024 #24;
     agifa142 #142;
     dsm00004 #904;
     dsm00005 #905;
     dsm00006 #906;
     dsm00010 #910;
     dsm00014 #914;
     dsw00015 #916,MANTE;     || Reflejo dsm00016 porque saca un Entlineal Especial
     dsm00075 #75;
     dsm00076 #76;
     agifa561 #561;
     agitp001 #562;
     agifa081 #81;
|FIN;

|VARIABLES;
     &eaCtrStock = "";
     &enPreCom = 0;
     &enPVP = 0;
     &enInc = 0;
     &eaInc = "";
     &enRedo = 0;
     &aSer_baja = "";
     &nPed_baja = 0;
     &nLin_baja = 0;
     &eaEle_baja = "";
     nPosi1      = 0;
     nPosi2      = 0;
     nTecla      = 0;
     nTecla1     = 0;
     nPrecio     = 0;
     nContaColor = 0;
     nNume       = 0;
     nVisualPrec = 0;
     nPendiente  = 0;
     nModo       = 0;

     aDef       = "";
     aUltEleme  = "";
     aTeclaConf = "";
     aTecla     = "";
     aAlfa      = "";
     aContenido = "";
     aDCodF1    = "";
     aHCodF1    = "";
     aDCodF2    = "";
     aHCodF2    = "";
     aDCodF3    = "";
     aHCodF3    = "";
     aDCodF4    = "";
     aHCodF4    = "";

     nUnidades   = 0;
     aMensaje    = "";
     aServir     = "";

     &aParam    = "";
     &enMensaje = 0;
     &fed_dt = @;   || Fecha....
     &art_dt = "";  || Articulo.
     &cli_dt = "";  || Cliente..
     &fam_dt = "";  || Familia.
     &iva_dt = 0;   || Tipo Iva.
     &dtos_2 = 0;   || Descuento 2.
     &dto_pt = 0;   || Descuento Ptas.
     &dtos_1 = 0;   || Descuento 1.
     &pvp_ve = 0;   || Precio Venta.
     &tarifa = 0;   || Tarifa Cliente.
     &quedto = 0;   || 1=cli./art, 2=cli./familia, 3=cli./subfam.
     &gru_dt = "";  || Grupo Cliente.
     &uni_dt = 0;
     &articulo = "";
     &enSwMalo = 0;
     nHay = 0;
     aPath = "";
     &enComision = 0;
|FIN;

|INCLUYE i_varart;

|PROCESO PreArti;
     |SI eaTipo = "PV"; |O eaTipo = "DP"; |O eaTipo = "AV";
               |O eaTipo = "FC"; |O eaTipo = "FP";
          |ABRE #75;
          #75#0 = eaCliente;
          #75#1 = #0#3;
          #75#2 = #905#4;
          |LEE 000#75=;
          |SI FSalida = 0;
               #905#7 = #75#4;
          |FINSI;
          |CIERRA #75;
     |FINSI;
     |SI eaTipo = "PC"; |O eaTipo = "AC";
          |SI #142#74 = "U";
               |ABRE #76;
               #76#0 = eaProve;
               #76#1 = #0#3;
               #76#2 = #905#4;
               |LEE 000#76=;
               |SI FSalida = 0;
                    #905#7 = #76#4;
               |FINSI;
               |CIERRA #76;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO PreDivisa;
     #905#13 = #905#7 / enCamDiv * enCamBas;
|FPRC;

|PROCESO CogePrecio;
     |SI eaTipo = "W1";      || Entrada Valorada
          #905#7 = #19#28;   || Ult. Precio Compra
          |HAZ PreDivisa;
          |ACABA;
     |FINSI;

     |HAZ EsEvaristo;
     |SI FSalida = 0; |HAZ PreEvaristo; |ACABA; |FINSI;

     |SI #910#24 = "S";
          |SI enTarifa = 1;  #905#7 = #916#5;   |FINSI;
          |SI enTarifa = 2;  #905#7 = #916#6;   |FINSI;
          |SI enTarifa = 3;  #905#7 = #916#7;   |FINSI;
          |SI enTarifa = 4;  #905#7 = #916#8;   |FINSI;
          |SI enTarifa = 5;  #905#7 = #916#9;   |FINSI;
          |SI enTarifa = 6;  #905#7 = #916#10;  |FINSI;
          |SI enTarifa = 0;  #905#7 = #916#11;  |FINSI;
          |HAZ PreArti;
          |HAZ PreDivisa;
     |SINO;
          |SI enTarifa ! 0;
               |ABRE #24;
               #24#0 = eaCliente;
               |LEE 040#24=;
               |SI FSalida ! 0;  |DDEFECTO #24;  |FINSI;
               |CIERRA #24;

               articulo  = #0#3;
               fed_dt    = efFecha;     || Fecha....
               art_dt    = #0#3;        || Articulo.
               cli_dt    = eaCliente;   || Cliente..
               fam_dt    = #19#19;      || Familia.
               iva_dt    = #19#30;      || Tipo Iva.
               dtos_2    = 0;           || Descuento 2.
               dto_pt    = 0;           || Descuento Ptas.
               dtos_1    = 0;           || Descuento 1.
               pvp_ve    = 0;           || Precio Venta.
               tarifa    = #24#39;      || Tarifa Cliente....
               gru_dt    = #24#158;     || Grupo Cliente.
               uni_dt    = 0;
               aParam    = "";
               enMensaje = 1;
               eaSerie = #0#0;
               |HAZ calcdtos
               #905#7    = pvp_ve;  || Precio Venta. sin iva.
               |HAZ PreArti;
               |HAZ PreDivisa;
         |SINO;
               |ABRE #142; |LEE 000#142p; |CIERRA #142;
               |SI #142#74 = "T";
                    |ABRE #561;
                    #561#0 = #0#3;    ||Articulo
                    #561#1 = eaProve;  ||Proveedor
                    |LEE 000#561=;
                    |SI FSalida = 0;
                         #905#7 = #561#26;
                    |SINO;
                         #905#7 = #19#28;
                    |FINSI;
                    |CIERRA #561;
                    |HAZ PreDivisa;
               |SINO;
                    |ABRE #562;
                    #562#0 = eaProve;             || Proveedor.
                    #562#1 = #0#3;                || Articulo.
                    |LEE 101#562=;
                    |SI FSalida ! 0;  |DDEFECTO #562; |FINSI;
                    |CIERRA #562;
                    |SI #562#9 = 0;
                         #562#9 = #562#3;
                    |FINSI;
                    #905#7 = #562#9;  ||Precio en mon base en tarifas proveedor
                    |HAZ PreDivisa;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|| ACTUALIZACIONES

|PROCESO GrabaFijos;
     |DDEFECTO #905;
     #905#0 = eaTipo;
     #905#1 = #0#0;
     #905#2 = #0#1;
     #905#3 = #0#2;
     #905#4 = #916#3;
     |LEE 040#905=;
     |SI FSalida = 0;  |ACABA; |FINSI;

     #905#0 = eaTipo;
     #905#1 = #0#0;
     #905#2 = #0#1;
     #905#3 = #0#2;
     #905#4 = #916#3;
     #905#5 = #916#4;
     #905#16 = #0#3;
     |HAZ CogePrecio;

     |GRABA 020#905n;
     |LIBERA #905;
|FPRC;

|DEFBUCLE dsm00016;
     #916#1;
     ;
     aDCodF1, aDCodF2, aDCodF3, aDCodF4, "      ";
     aHCodF1, aHCodF2, aHCodF3, aHCodF4, "zzzzzz";
     be;
     NULL, GrabaFijos;
|FIN;

|PROCESO Tipo5m5;  |TIPO 5;
     |C_P #905#7, 0, nPosi1;
     |C_P #905#8, 0, nPosi2;
     |SI eaMoneda = "B";
          |C_V #905#7 , 1, "S";
          |C_V #905#8 , 1, "S";
          |C_V #905#13, 1, "N";
          |C_V #905#14, 1, "N";
     |SINO;
          |C_P #905#13, 1, nPosi1;
          |C_P #905#14, 1, nPosi2;
          |C_V #905#7,  1, "N";
          |C_V #905#8,  1, "N";
          |C_V #905#13, 1, "S";
          |C_V #905#14, 1, "S";
     |FINSI;

     |ABRE #910; |LEE 040#910p; |CIERRA #910;

     nNume         = #910#21;
     aAlfa         = "\" + #910#23 + "+#";
     |CAMPO_ANCHO  #905#4, 1, nNume;
     |CAMPO_MAXIMO #905#4, 1, aAlfa;

     aAlfa = eaTipo % 101;
     |SI aAlfa = "T";
         nVisualPrec = 1;
         |C_V #905#7, 1, "N";  |C_M #905#7, 1, "N";
         |C_V #905#8, 1, "N";  |C_M #905#8, 1, "N";
         |C_V #905#13, 1, "N"; |C_M #905#13, 1, "N";
         |C_V #905#14, 1, "N"; |C_M #905#14, 1, "N";
     |FINSI;
/*
     |SI eaTipo ! "PV"; |Y eaTipo ! "PC";
         |C_V #905#9, 1, "N";  |C_M #905#9, 1, "N";
     |FINSI;
*/
     |ATRI S;
     aAlfa = #910#20;
     |PINTA 1804, aAlfa;

     |SI #910#25 = "X";
         |PINTA 1054, "(F10) Tablas/Defectos";
     |FINSI;
     |ATRI s;

     |SI enModo = 7; |ACABA;  |FINSI;

     |SI #910#25 = "N";  |ACABA;  |FINSI;
     |SI #910#25 = "X";  |ACABA;  |FINSI;

     #905#0 = eaTipo;
     #905#1 = #0#0;
     #905#2 = #0#1;
     #905#3 = #0#2;
     #905#4 = "      ";
     |LEE 040#905];
     |SI FSalida = 0; |Y #905#0 = eaTipo; |Y #905#1 = #0#0;
               |Y #905#2  = #0#1; |Y #905#3 = #0#2;
         |SI #910#45 = "N";  |ACABA;  |FINSI;
         |SI eaSeriePedido ! "";  |O enCodigPedido ! 0;
             |ACABA;
         |FINSI;
     |FINSI;

     eAlfa = #0#3;  |SUB_EJECUTA_NP "dsz99990;V";

     |SI #910#26 = 1;
         aDCodF1 = eAlfa1;     aHCodF1 = eAlfa1;
         aDCodF2 = " " * 20;   aHCodF2 = " " * 20;
         aDCodF3 = " " * 20;   aHCodF3 = " " * 20;
         aDCodF4 = " " * 20;   aHCodF4 = " " * 20;
     |FINSI;

     |SI #910#26 = 2;
         aDCodF1 = eAlfa1;     aHCodF1 = eAlfa1;
         aDCodF2 = eAlfa2;     aHCodF2 = eAlfa2;
         aDCodF3 = " " * 20;   aHCodF3 = " " * 20;
         aDCodF4 = " " * 20;   aHCodF4 = " " * 20;
     |FINSI;

     |SI #910#26 = 3;
         aDCodF1 = eAlfa1;     aHCodF1 = eAlfa1;
         aDCodF2 = eAlfa2;     aHCodF2 = eAlfa2;
         aDCodF3 = eAlfa3;     aHCodF3 = eAlfa3;
         aDCodF4 = " " * 20;   aHCodF4 = " " * 20;
     |FINSI;

     |SI #910#26 = 4;
         aDCodF1 = eAlfa1;     aHCodF1 = eAlfa1;
         aDCodF2 = eAlfa2;     aHCodF2 = eAlfa2;
         aDCodF3 = eAlfa3;     aHCodF3 = eAlfa3;
         aDCodF4 = eAlfa4;     aHCodF4 = eAlfa4;
     |FINSI;

     |ABRE #19;
     #19#0 = #0#3;
     |LEE 040#19=;
     |SI FSalida ! 0;  |DDEFECTO #19;  |FINSI;
     |CIERRA #19;

     |SI #910#44 = "T";
         eAlfa1  = #19#177;  |QBF eAlfa1;
         eAlfa1  = eAlfa1 + ((" " * 20) % 120);

         aDCodF1 = eAlfa1;     aHCodF1 = eAlfa1;
         aDCodF2 = " " * 20;   aHCodF2 = " " * 20;
         aDCodF3 = " " * 20;   aHCodF3 = " " * 20;
         aDCodF4 = " " * 20;   aHCodF4 = " " * 20;
     |FINSI;

     enMensaje = 0;
     |BUCLE dsm00016;
|FPRC;

|PROCESO Ultimo;
     |SI #910#25 = "F";
     |SINO;
          |SI #910#25 = "N"; |O #910#25 = "X"; |O #910#27 = "N";
               |ACABA;
          |FINSI;
          |SI #910#25 = "S"; |Y #910#27 = "S";
               |ACABA;
          |FINSI;
     |FINSI;

     |DDEF aDef; |QBF aDef;
     aDef = aDef + "dsm00005";
     |CARGA_DEF aDef, referen@;
     |SI FSalida = 0;
          |ABRE #5;
          #5#0 = #905#0;
          #5#1 = #905#1;
          #5#2 = #905#2;
          #5#3 = #905#3;
          #5#4 = aUltEleme;
          |LEE 000#5=;
          |SI FSalida ! 0; |ACABA; |FINSI;  || La primera vez
          |LEE 000#5s;
          |SI FSalida ! 0; |O #905#0 ! #5#0; |O #905#1 ! #5#1;
                    |O #905#2 ! #5#2; |O #905#3 ! #5#3;
               aAlfa = "";
          |FINSI;
          |CIERRA #5;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|| CHEQUEA LOS COMPONENTES

|PROCESO No0;  |TIPO 6;
     |SI #910#22 ! "A";
          nNume = #905#4;
          |SI nNume = 0;  |ERROR;  |FINSI;
     |SINO;
          aAlfa = #905#4;
 ||컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
 || ERROR en el ultimo elemento (Regularizacion Exis.)
 || se quedaba haciendo PTEC
          |HAZ Ultimo;
          aUltEleme = #905#4;
 ||컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
          |SI aAlfa = ""; |ERROR; |PTEC 807; |FINSI;
     |FINSI;
|FPRC;


|PROCESO Chequea;
     nModo = (FEntrada / 100) ! 0;

     /* Tiquet: 3218/3082 permitir adj unidades no pedidas
     |SI eaSeriePedido ! ""; |O enCodigPedido ! 0;  |O enLineaPedido ! 0;
          |SI nModo = 1;
               |MENAV "      No te puedo dejar dar de alta, estas sobre un Pedido";
               |ERROR;
               |ACABA;
         |FINSI;
     |FINSI; */

     |SI #910#22 = "N";
         eAlfa = #905Campo;  |QBF eAlfa;  |SUB_EJECUTA_NP "dsz99990;C";
         |SI enSwMalo = 1;
             |MENAV "     Introduccion Erronea";
             |ERROR;
             |ACABA;
         |FINSI;
     |FINSI;

     |SI #910#25 = "F";  |ACABA;  |FINSI;
     |SI #910#25 = "N";  |ACABA;  |FINSI;
     |SI #910#27 = "N";  |ACABA;  |FINSI;

     eAlfa = #0#3;  |SUB_EJECUTA_NP "dsz99990;V";

     aDCodF1 = " " * 20;
     aDCodF2 = " " * 20;
     aDCodF3 = " " * 20;
     aDCodF4 = " " * 20;

     |SI #910#26 = 1;
         aDCodF1 = eAlfa1;
     |FINSI;
     |SI #910#26 = 2;
         aDCodF1 = eAlfa1;
         aDCodF2 = eAlfa2;
     |FINSI;
     |SI #910#26 = 3;
         aDCodF1 = eAlfa1;
         aDCodF2 = eAlfa2;
         aDCodF3 = eAlfa3;
     |FINSI;
     |SI #910#26 = 4;
         aDCodF1 = eAlfa1;
         aDCodF2 = eAlfa2;
         aDCodF3 = eAlfa3;
         aDCodF4 = eAlfa4;
     |FINSI;

     |SI #910#44 = "T";
         |ABRE #19;
         #19#0 = #0#3;
         |LEE 040#19=;
         |SI FSalida ! 0;  |DDEFECTO #19;  |FINSI;
         |CIERRA #19;

         eAlfa1  = #19#177;  |QBF eAlfa1;
         eAlfa1  = eAlfa1 + ((" " * 20) % 120);

         aDCodF1 = eAlfa1;     aHCodF1 = eAlfa1;
         aDCodF2 = " " * 20;   aHCodF2 = " " * 20;
         aDCodF3 = " " * 20;   aHCodF3 = " " * 20;
         aDCodF4 = " " * 20;   aHCodF4 = " " * 20;
     |FINSI;

     |HAZ EsEvaristo;
     |SI FSalida = 0; |ACABA; |FINSI;

     ||Para la estandar
     |ABRE #916;
     #916#0  = aDCodF1;
     #916#1  = aDCodF2;
     #916#2  = aDCodF3;
     #916#15 = aDCodF4;
     #916#3  = #905#4;
     |LEE 040#916=;
     |SI FSalida ! 0;
          |AVISO;
          |AVISO;
          |AVISO;
          |MENSA "     Elemento no configurado en el Fichero de Tablas/Defectos. Pulse Av/Pag";
          aTecla     = "";
          aTeclaConf = &255 + "815";
          |PARA; |SI aTecla ! aTeclaConf; |HACIENDO;
               |LEETECLA aTecla;
          |SIGUE;
          |ERROR;
     |FINSI;
     |CIERRA #916;
|FPRC;

|| CONTROLES CUANDO SOLO PEDIMOS UNIDADES O PRECIOS Y NO PASAMO POR LA CLAVE
|| CUALQUIER MODIFICACION PUEDE ALTERAR EL BUEN FUNCIONAMIENTO YA QUE HAY
|| TRES FORMAS DIFERENTES DE METER UNIDADES.

|PROCESO Ptecs;  |TIPO 7;
     |SI nTecla = -1;  |ACABA;  |FINSI;

     nTecla  = nTecla1;
     nTecla1 = 0;

     |SI #910#25 ! "F";  |ACABA;  |FINSI;

     |SI nTecla = 7;  |PTEC 806;  |ACABA;  |FINSI;
     |SI nTecla = 1;  |PTEC 807;  |ACABA;  |FINSI;
     |SI nTecla = 2;
         nTecla = -1;
         |PTEC 802;
         |PTEC 802;
         |PTEC 808;
         |ACABA;
     |FINSI;

     |SI #910#24 = "N";
         |SI aContenido = #905#4;
             |PTEC 807;
             |ACABA;
         |SINO;
             |LEE 040#905=;
             |SI FSalida ! 0;
                |PTEC 807;
                |ACABA;
             |FINSI;
         |FINSI;
     |FINSI;

     nTecla = 0;

     |PTEC 802;
     |PTEC 802;
|FPRC;

|PROCESO PonTecla;  |TIPO 0;
     |SI nTecla = -1;  nTecla = 0;  |FINSI;

     aContenido = Contenido;
|FPRC;

|PROCESO Precio7;  |TIPO 7;
     aAlfa = "0000Precio";
     |HAZ EsRocai;
     |SI FSalida = 0;
          aAlfa = "0000<F3> Tarifa";
     |FINSI;
     |MENSA aAlfa;


     |C_V #905Campo, 0, aAlfa;        || para que solo entre en el visible
     |SI aAlfa = "N"; |ACABA; |FINSI; || el precio base o precio divisa
     nModo = (FEntrada / 100) ! 0;
     |SI nModo ! 1; |ACABA; |FINSI;   || solo en alta

     |ABRE #916;
     #916#0  = aDCodF1;
     #916#1  = aDCodF2;
     #916#2  = aDCodF3;
     #916#15 = aDCodF4;
     #916#3 = #905#4;
     |LEE 040#916=;
     |SI FSalida ! 0;  |DDEFECTO #916;  |FINSI;
     |CIERRA #916;
     |HAZ CogePrecio;

     |SI #905#7 = 0;
          |SI nContaColor > 0;
               #905#7 = nPrecio;  |PINTA #905#7;
          |FINSI;
     |FINSI;

     |SI #910#24 = "N";
          |SI nContaColor > 0;
               #905#7 = nPrecio;  |PINTA #905#7;
          |FINSI;
     |FINSI;

     |HAZ PreDivisa;

     |SI eaModifi = "";   eaModifi = #905#4;  |FINSI;

     |SI eaModifi = #905#4;  |Y nVisualPrec = 0;
          |C_M #905#7, 1, "S";
          |C_M #905#13, 1, "S";
          |SI eaMoneda = "D";
               |ERROR;    ||NO ME PREGUNTEIS PORQUE PERO FURRURRA
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO TotalBruto;
     |SI eaMoneda = "B";
          #905#8 = #905#6 * #905#7;
          #905#13 = #905#7 / enCamDiv * enCamBas;
          #905#14 = #905#8 / enCamDiv * enCamBas;
          |PINTA #905#8;
     |SINO;
          #905#14 = #905#6 * #905#13;
          #905#7 = #905#13 / enCamBas * enCamDiv;
          #905#8 = #905#14 / enCamBas * enCamDiv ;
          |PINTA #905#14;
     |FINSI;
|FPRC;

|PROCESO Precio6;  |TIPO 6;
     |SI FSalida = 11; ||F3
          |HAZ EsRocai;
          |SI FSalida = 0;
               enPrecio = #905Campo;
               ||enComision =
               ||eaCliente =
               ||eaArticulo =
               |SUB_EJECUTA_NP "rocaiz01";
               #905Campo = enPrecio; |PINTA #905Campo;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Precio0;  |TIPO 0;
     nModo = (FEntrada / 100) ! 0;
     aAlfa = #910#24;
     |C_M #905#7, 1, aAlfa;
     |C_M #905#13, 1, aAlfa;

     |HAZ TotalBruto;

     nPrecio = #905#7;

     || Precios iguales para todos los colores
     || asigna precio a todos
     |SI #905Campo ! Contenido; |Y #910#24 = "N"; |Y nModo = 2;
          |DDEF aDef; |QBF aDef;
          aDef = aDef + "dsm00005";
          |CARGA_DEF aDef, referen@;
          |SI FSalida = 0;
               |LIBERA #905;
               |ABRE #5;
               #5#0 = #905#0;
               #5#1 = #905#1;
               #5#2 = #905#2;
               #5#3 = #905#3;
               #5#4 = "";
               |LEE 101#5];
               |PARA; |SI FSalida = 0; |Y #5#0 = #905#0; |Y #5#1 = #905#1;
                         |Y #5#2 = #905#2; |Y #5#3 = #905#3; |HACIENDO;
                    #5#7 = #905#7;
                    #5#8 = #905#8;
                    #5#13 = #905#13;
                    #5#14 = #905#14;
                    |GRABA 020#5a;
                    |LIBERA #5;
                    |LEE 101#5s;
               |SIGUE;
               |CIERRA #5;
               |DESCARGA_DEF #referen@;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO CogeUnidad;  |TIPO 7;
     enUnidAnt = #905#6;

     |ABRE #19;
     #19#0 = #0#3;
     |LEE 000#19=;
     |SI FSalida ! 0; |DDEFECTO #19; |FINSI;
     |CIERRA #19;
     |ABRE #17;
     #17#0 = #0#3;
     #17#1 = #0#4;
     |LEE 000#17=;
     |SI FSalida ! 0; |DDEFECTO #17; |FINSI;
     |CIERRA #17;
     |ABRE #904;
     #904#0 = #0#3;
     #904#1 = #0#4;
     #904#2 = #905#4;
     |LEE 000#904=;
     |SI FSalida ! 0; |DDEFECTO #904; |FINSI;
     |CIERRA #904;

     |SI eaTipo = "T3";
          |PINTA 2127, #19#6;  |PINTA 2147, #17#5; |PINTA 2170, #904#12;
          |PINTA 2227, #19#104; |PINTA 2247, #17#39; |PINTA 2270, #904#13;
     |FINSI;
     aAlfa = "0000Stock Disponible Almacen: " + #904#13+"  Minimo: "+#904#10;
     |MENSA aAlfa;
|FPRC;

|PROCESO Pendiente;
     nTecla1 = FSalida;

     |HAZ TotalBruto;

     |SI #910#25 = "X";  |Y #905#6 = 0;
         |SI #905#0 = "PV";  |O #905#0 = "PC";
             |ERROR;
             |ACABA;
         |FINSI;
     |FINSI;

     |SI #905#0 ! "PV";  |Y #905#0 ! "PC";  |ACABA;  |FINSI;

     |SI Campo = 6;
          |SI eaTipo = "PV";  |O eaTipo = "PC";
              #905#11 = #905#6;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO MasOMenos;
     |SI eaCtrStock = "S"; |O eaCtrStock = "X";
          |ABRE #904;
          #904#0 = #0#3;
          #904#1 = #0#4;
          #904#2 = #905#4;
          |LEE 000#904=;
          |CIERRA #904;
          |SI #905#6 > #904#13;
               aAlfa = "0000Se supera el stock disponible: " + #904#13;
               |MENAV aAlfa;
               |SI eaCtrStock = "X"; |ERROR; |ACABA; |FINSI;
          |FINSI;
     |FINSI;

     |SI #905#0 = "W3";  || Solo Adj. Ped. Compras por Articulo
          |SI #905#6 > #905#12;  || El campo #905#12 tiene las unidades
                                 || pendientes de Servir
               |MENAV "0000No se permite servir mas de lo pedido en adj. por cantidad ...";
               |ERROR; |ACABA;
          |FINSI;
     |FINSI;

     |SI eaDeposito = "S";
         |SI #905#6 > enPendiente;
             #905#6 = enPendiente;  |PINTA #905#6;
         |FINSI;
         |ACABA;
     |FINSI;

     ||SI eaSeriePedido = ""; |Y enCodigPedido = 0;  |Y enLineaPedido = 0;
     |SI enLineaPedido = 0;
         |ACABA;
     |FINSI;

     |SI #905#0 = "AC";
          |HAZ EstaEnPedidoCom;
          |SI FSalida ! 0; |ACABA; |FINSI;
          |HAZ TienePedidasCom;
          |SI FSalida = 0; |ACABA; |FINSI;
     |FINSI;
     |SI #905#0 = "AV";
          |HAZ EstaEnPedidoVta;
          |SI FSalida ! 0; |ACABA; |FINSI;
          |HAZ TienePedidasVta;
          |SI FSalida = 0; |ACABA; |FINSI;
     |FINSI;

     |ABRE #904;
     |HAZ LeeComponente;
     |CIERRA #904;

     |SI ctrl_st = "S"; |O ctrl_st = "X";
         |SI eaReservado  = "S";
             nUnidades = #904#13 + #904#7;
         |SINO;
             nUnidades = #904#13;
         |FINSI;

         aServir  = "S";
         aMensaje = "";
         nPendiente = #905#6 - #905#12;
         |SI nUnidades < nPendiente;
             aMensaje = "0000No existe Stock Disponible";
             aServir  = "N";
         |SINO;
             nNume = #905#9 - #905#6;
             |SI nNume < #904#10; |Y nNume > 0;
                 aMensaje = "0000Se sobrepasa el Stock Minimo";
                 aServir = "N";
             |FINSI;
         |FINSI;

         |SI aServir = "N";
             |MENAV aMensaje;
             |SI ctrl_st = "X"; |ERROR; |ACABA; |FINSI;
         |FINSI;
     |FINSI;

     eaCompoNue   = "";
     eaDespreciar = "N";
     #905#12      = 0;

     |SI #905#6 ! enPendiente; |Y eaPedRese = "S";
          |MENAV "0000Linea Reservada. Modifique el Pedido...";
          |ERROR; |ACABA;
     |FINSI;

     |SI #905#6 > enPendiente;
         |AVISO;
         |CONFI "2400NEsta sirviendo mas de lo Pedido, Continuar : ";
         |SI FSalida ! 0;
             #905#6 = enUnidAnt;  |PINTA #905#6;
         |SINO;
             eaDespreciar = "S";
             #905#12      = 1;
         |FINSI;
     |FINSI;

     |SI #905#6 < enPendiente;
         |SI #142#211 = "E";
              |AVISO;
              |CONFI "2400NEsta sirviendo menos de lo Pedido, Despreciar : ";
         |FINSI;
         |SI #142#211 = "D"; FSalida = 0; |FINSI;
         |SI #142#211 = "P"; FSalida = 1; |FINSI;
         |SI FSalida = 0;
             |SI #905#6 = 0;
                 |CONFI "2400NDesea Adjudicarlo a otro Componente : ";
                 |SI FSalida = 0;
                     nNume = #910#21;
                     aAlfa = "\" + #910#23 + "+#";

                     |CAMPO_ANCHO  #914#0, 1, nNume;
                     |CAMPO_MAXIMO #914#0, 1, aAlfa;

                     |ABRE #914;
                     |LEE 040#914p;
                     |CONSULTA_CLAVE #1#914;
                     |CIERRA #914;
                     eaCompoNue = #914#0;
                 |FINSI;
             |FINSI;
             eaDespreciar = "S";
             #905#12      = 1;
         |FINSI;
     |FINSI;
|FPRC;

------------------ ACTUALIZA COMPONENTES DEL ALMACEN -------------------------

|PROCESO Tipo2m5;  |TIPO 2;
     #905#16 = #0#3;
     nModo = (FEntrada / 100) ! 0;
     enForma = 0 +. 1;

     |SI enForma = 1;
          |SI #905#0 = "AC"; |Y enLineaPedido ! 0;
               |HAZ EstaEnPedidoCom;
               |SI FSalida ! 0; |HAZ ModiPedCom; |FINSI;
          |FINSI;
          |SI #905#0 = "AV"; |Y enLineaPedido ! 0;
               |HAZ EstaEnPedidoVta;
               |SI FSalida ! 0; |HAZ ModiPedVta; |FINSI;
          |FINSI;
     |FINSI;

     |SI enForma = -1;  eaDespreciar = "N";  |FINSI;

     eaComponente = #905#4;

     |SI #905#0 = "PV";  |O #905#0 = "PC";
         enUnidades = (#905#6 - #905#12) * enForma;
         |SI eaAbono = "S";
             enUnidades = #905#6 * enForma;
         |FINSI;
     |SINO;
         enUnidades = #905#6 * enForma;
     |FINSI;

     |SI #905#0 ! "W1"; |Y #905#0 ! "W2";
               |Y #905#0 ! "T3"; |Y #905#0 ! "T4"; |Y #905#0 ! "W3";
               |Y #905#0 ! "OF";
          |HAZ ActComponente;
     |FINSI;

     |SI enForma = -1; |PINTA #0#8; |PINTA #0#9; |FINSI;

     #0#8 = #0#8 +. #905#6;
     |SI eaMoneda = "B";
          #0#9 = #0#9 +. #905#8;
     |SINO;
          #0#9 = #0#9 +. #905#14;
     |FINSI;

     |SI enForma = 1; |PINTA #0#8; |PINTA #0#9; |FINSI;

     |SI #905#0 = "AV"; |Y nModo = 3; |Y enCodigPedido ! 0; |Y enLineaPedido ! 0;
          |CONFI "0000NDespreciar unidades pedido";
          |SI FSalida = 0;
               aSer_baja = eaSeriePedido;
               nPed_baja = enCodigPedido;
               nLin_baja = enLineaPedido;
               eaEle_baja = #905#4;
               |SUB_EJECUTA "dsz00006";
          |FINSI;
     |FINSI;

     nContaColor = 0 +. 1;
|FPRC;

|PROCESO CalPrecio;
     |SI eaMoneda = "B";
          #905#13 = #905#7 / enCamDiv * enCamBas;
          #905#8 = #905#6 * #905#7;
          #905#14 = #905#6 * #905#13;
     |SINO;
          #905#7 = #905#13 / enCamBas * enCamDiv;
          #905#8 = #905#6 * #905#7;
          #905#14 = #905#6 * #905#13;
     |FINSI;
|FPRC;

|PROCESO GrabaPrecio;
     |SI eaMoneda = "B";
          #0#9 = #0#9 - #905#8;
          #905#7 = nPrecio;
          |HAZ CalPrecio;
          #0#9 = #0#9 + #905#8;
     |SINO;
          #0#9 = #0#9 - #905#14;
          #905#7 = nPrecio;
          |HAZ PreDivisa;
          |HAZ CalPrecio;
          #0#9 = #0#9 + #905#14;
     |FINSI;
     |GRABA 020#905a;
     |LIBERA #905;
|FPRC;

|DEFBUCLE dsm00005;
     #905#1;
     ;
     eaTipo, #0#0, #0#1, #0#2, "      ";
     eaTipo, #0#0, #0#1, #0#2, "zzzzzz";
     be;
     NULL, GrabaPrecio;
|FIN;

|PROCESO Tipo3m5;  |TIPO 3;
     |SI eaModifi = #905#4;  |Y nVisualPrec = 0; |Y #910#24 = "N";
         |SALVA_FICHA #905;
         |GRABA 020#905a;
         |LIBERA #905;

         |BUCLE dsm00005;

         |REPON_FICHA #905;

         |PINTA #0#9;

         |SI #910#25 ! "F";  |ACABA;  |FINSI;

     |FINSI;
|FPRC;

|RUTINA ClaveBaja916;
     #916#0  = aDCodF1;
     #916#1  = aDCodF2;
     #916#2  = aDCodF3;
     #916#15 = aDCodF4;
     #916#3 = "";
|FRUT;

|RUTINA ClaveAlta916;
     #916#0  = aDCodF1;
     #916#1  = aDCodF2;
     #916#2  = aDCodF3;
     #916#15 = aDCodF4;
     #916#3  = "zzzzzz";
|FRUT;

|PROCESO Tipo11m5;  |TIPO 11;
     |SI #910#25 ! "X";  |ACABA;  |FINSI;
     |SI FSalida ! 18;   |ACABA;  |FINSI;

     eAlfa = #0#3;  |SUB_EJECUTA_NP "dsz99990;V";

     aDCodF1 = " " * 20;
     aDCodF2 = " " * 20;
     aDCodF3 = " " * 20;
     aDCodF4 = " " * 20;

     |SI #910#26 = 1;
         aDCodF1 = eAlfa1;
     |FINSI;
     |SI #910#26 = 2;
         aDCodF1 = eAlfa1;
         aDCodF2 = eAlfa2;
     |FINSI;
     |SI #910#26 = 3;
         aDCodF1 = eAlfa1;
         aDCodF2 = eAlfa2;
         aDCodF3 = eAlfa3;
     |FINSI;
     |SI #910#26 = 4;
         aDCodF1 = eAlfa1;
         aDCodF2 = eAlfa2;
         aDCodF3 = eAlfa3;
         aDCodF4 = eAlfa4;
     |FINSI;

     |SI #910#44 = "T";
         |ABRE #19;
         #19#0 = #0#3;
         |LEE 040#19=;
         |SI FSalida ! 0;  |DDEFECTO #19;  |FINSI;
         |CIERRA #19;

         eAlfa1  = #19#177;  |QBF eAlfa1;
         eAlfa1  = eAlfa1 + ((" " * 20) % 120);

         aDCodF1 = eAlfa1;     aHCodF1 = eAlfa1;
         aDCodF2 = " " * 20;   aHCodF2 = " " * 20;
         aDCodF3 = " " * 20;   aHCodF3 = " " * 20;
         aDCodF4 = " " * 20;   aHCodF4 = " " * 20;
     |FINSI;

     eaColor = eaColor;

     |ABRE #916;
     #916#0  = aDCodF1;
     #916#1  = aDCodF2;
     #916#2  = aDCodF3;
     #916#15 = aDCodF4;
     #916#3 = "";
     |LEE 040#916];
     |SI FSalida ! 0;
         |MENAV "     No hay Tabla/Defecto Asociado";
     |SINO;
         |PUSHV 0501 2380;
         |ENTLINEAL #1#916, 4, 4, 22, 1, ClaveBaja916, ClaveAlta916;
         |POPV;
     |FINSI;
     |CIERRA #916;

     #905#4 = eaColor;  |PINTA #905#4;

     |LIBERA #905;
     |LIBERA #905;
     |ERROR;
|FPRC;

|PROCESO DefePVP0; |TIPO 0;
     |C_V #905#15, 0, aAlfa;
     |SI aAlfa = "N"; |ACABA; |FINSI;

     |DDEFECTO #916;
     |ABRE #916;
     #916#0 = #0#3;
     #916#3 = #905#4;
     |LEE 101#916=;
     #916#4 = #905#5; || Descripcion
     |SI FSalida ! 0; |GRABA 020#916b; |FINSI;
     #916#11 = #905#7;
     #916#12 = #905#13;
     #916#5 = #905#15;
     |GRABA 020#916a;
     |CIERRA #916;

     |DDEFECTO #904;
     |ABRE #904;
     #904#0 = #0#3;
     #904#1 = #0#4;
     #904#2 = #905#4;
     |LEE 101#904=;
     #904#3 = #905#5; || Descripcion
     |SI FSalida ! 0; |GRABA 020#904b; |FINSI;
     #904#14 = #905#15;
     #904#20 = #905#7;
     #904#21 = #905#13;
     |GRABA 020#904a;
     |CIERRA #904;
|FPRC;

|PROCESO DefePVP7; |TIPO 7;
     |C_V #905#15, 0, aAlfa;
     |SI aAlfa = "N"; |ACABA; |FINSI;

     |ABRE #142; |LEE 000#142p; |CIERRA #142;
     |ABRE #19; #19#0 = #0#3; |LEE 000#19=; |CIERRA #19;
     |ABRE #14; #14#0 = #0#11; |LEE 000#14=; |CIERRA #14;
     |SI #14#3 ! "N";
          eaInc = #14#3;
          enRedo = #14#2;
          enInc = #14#4;
          enPVP = #19#18;
          enPreCom = #905#7;
          |HAZ CalpreVertical;
          #905#15 = enPVP; |PINTA #905#15;
     |FINSI;
     |SI #19#108 ! "N"; |O #14#3 ! "N";
          eaInc = #19#108;
          enRedo = #19#109;
          enInc = #19#105;
          enPVP = #19#18;
          enPreCom = #905#7;
          |HAZ CalpreVertical;
          #905#15 = enPVP; |PINTA #905#15;
     |FINSI;
|FPRC;

|PROCESO PreEvaristo;
     nHay = 0;
     |ABRE #19;
     #19#0 = #0#3;
     |LEE 000#19=;
     |SI FSalida ! 0;  |DDEFECTO #19;  |FINSI;
     |CIERRA #19;
/*
     |DDEF aPath;
     aAlfa = aPath + "evarm003";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          #referen@#0 = eaCliente;
          #referen@#1 = #0#3;
          |LEE 000#referen@.=;
          |SI FSalida = 0;
               nPrecio = #referen@#4;
               nHay = 1;
          |FINSI;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
*/
     |SI nHay = 0;
          aAlfa = aPath + "evarm002";
          |CARGA_DEF aAlfa, referen@;
          |SI FSalida = 0;
               |ABRE #referen@;
               #referen@#0 = #0#3;
               #referen@#1 = #905#4;
               |LEE 000#referen@.=;
               |SI FSalida = 0;
                    |SI enTarifa = 1; nPrecio = #referen@#3; |FINSI;
                    |SI enTarifa = 2; nPrecio = #referen@#4; |FINSI;
                    |SI enTarifa = 3; nPrecio = #referen@#5; |FINSI;
                    |SI enTarifa = 4; nPrecio = #referen@#6; |FINSI;
                    |SI enTarifa = 5; nPrecio = #referen@#7; |FINSI;
                    |SI enTarifa = 6; nPrecio = #referen@#8; |FINSI;
                    nHay = 1;
               |FINSI;
               |CIERRA #referen@;
               |DESCARGA_DEF #referen@;
          |FINSI;
     |FINSI;
     |SI nHay = 0;
          |ABRE #916;
          #916#0 = #19#177;
          #916#1 = "";
          #916#2 = "";
          #916#15 = "";
          #916#3 = #905#4;
          |LEE 000#916=;
          |SI FSalida = 0;
               |SI enTarifa = 1; nPrecio = #916#5; |FINSI;
               |SI enTarifa = 2; nPrecio = #916#6; |FINSI;
               |SI enTarifa = 3; nPrecio = #916#7; |FINSI;
               |SI enTarifa = 4; nPrecio = #916#8; |FINSI;
               |SI enTarifa = 5; nPrecio = #916#9; |FINSI;
               |SI enTarifa = 6; nPrecio = #916#10; |FINSI;
               nHay = 1;
          |FINSI;
          |CIERRA #916;
     |FINSI;
     |SI nHay = 0;
          |SI enTarifa = 1; nPrecio = #19#18; |FINSI;
          |SI enTarifa = 2; nPrecio = #19#19; |FINSI;
          |SI enTarifa = 3; nPrecio = #19#20; |FINSI;
          |SI enTarifa = 4; nPrecio = #19#147; |FINSI;
          |SI enTarifa = 5; nPrecio = #19#148; |FINSI;
          |SI enTarifa = 6; nPrecio = #19#149; |FINSI;
     |FINSI;
     #905#7 = nPrecio;
     |HAZ PreDivisa;
|FPRC;

  /* Tiquet: 3218/3082 permitir adj unidades no pedidas*/
|PROCESO EstaEnPedidoCom;
     |DDEF aAlfa;
     aAlfa = aAlfa + "dsm00005";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          #referen@#0 = "PC";
          #referen@#1 = eaSeriePedido;
          #referen@#2 = enCodigPedido;
          #referen@#3 = enLineaPedido;
          #referen@#4 = #905#4;
          |LEE 000#referen@.=;
          aAlfa = FSalida;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
     FSalida = aAlfa;
|FPRC;

|PROCESO ModiPedCom;     ||A쨅de componente con unidades 0 al pedido
     |SALVA_FICHA #905;

     #905#0 = "PC";
     #905#1 = eaSeriePedido;
     #905#2 = enCodigPedido;
     #905#3 = enLineaPedido;
     #905#8 = 0;
     #905#9 = 0;
     #905#10 = "";
     #905#11 = 0;
     #905#12 = 0;
     #905#14 = 0;
     |GRABA 020#905n;

     |REPON_FICHA #905;

     eaDespreciar = "S";
     #905#12 = 1;
|FPRC;

|PROCESO TienePedidasCom;
     |SALVA_FICHA #905;

     #905#0 = "PC";
     #905#1 = eaSeriePedido;
     #905#2 = enCodigPedido;
     #905#3 = enLineaPedido;
     |LEE 000#905=;
     aAlfa = #905#11;

     |REPON_FICHA #905;
     FSalida = aAlfa;
|FPRC;

|PROCESO EstaEnPedidoVta;
     |DDEF aAlfa;
     aAlfa = aAlfa + "dsm00005";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          #referen@#0 = "PV";
          #referen@#1 = eaSeriePedido;
          #referen@#2 = enCodigPedido;
          #referen@#3 = enLineaPedido;
          #referen@#4 = #905#4;
          |LEE 000#referen@.=;
          aAlfa = FSalida;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
     FSalida = aAlfa;
|FPRC;

|PROCESO ModiPedVta;     ||A쨅de componente con unidades 0 al pedido
     |SALVA_FICHA #905;

     #905#0 = "PV";
     #905#1 = eaSeriePedido;
     #905#2 = enCodigPedido;
     #905#3 = enLineaPedido;
     #905#8 = 0;
     #905#9 = 0;
     #905#10 = "";
     #905#11 = 0;
     #905#12 = 0;
     #905#14 = 0;
     |GRABA 020#905n;

     |REPON_FICHA #905;

     eaDespreciar = "S";
     #905#12 = 1;
|FPRC;

|PROCESO TienePedidasVta;
     |SALVA_FICHA #905;

     #905#0 = "PV";
     #905#1 = eaSeriePedido;
     #905#2 = enCodigPedido;
     #905#3 = enLineaPedido;
     |LEE 000#905=;
     aAlfa = #905#11;

     |REPON_FICHA #905;
     FSalida = aAlfa;
|FPRC;
     /*   */
