|FICHEROS;
  psion019 #0;
  agifa010 #2;
  agifa024 #4;
  agifa321 #14;  || Divisas-Parametros.
  agifa324 #15;  || Divisas-Divisas.
  agifa025 #25;
  agifa091 #100;
  agis0002 #101;

  dscamrec@ #600;
  dsm00289 #289;
|FIN;

|VARIABLES;
&eaCtaDesprecio = "";
&eaCuenta = "";
&aCPath   = "";
&aCNome   = "";
&eaTag    = "";
&nDeci_Div = 0;
&efFecha   = @;

nSwJamaica = 0;
nSwError  = 0;
aPath     = "";
aDef00    = "";
aMensa    = "";
Tempo     = "";
aTempo600 = "";
Comodin   = "";
numero  = "";

recibo = 1;
sw = 0;

nHandle = 0;
nNumRec = 0;
aAlfa   = "";
nNume = 0;
|FIN;

|PROCESO JamaEntregaPen;
     |ABRE #101;
     #101#30 = "A";
     #101#20 = #0#0;
     #101#17 = #0#1;
     #101#18 = 99;
     |LEE 000#101];
     |SI FSalida = 0;
          |LEE 000#101a;
     |SINO;
          |LEE 000#101u;
     |FINSI;
     |SI FSalida = 0; |Y #101#30 = "A"; |Y #101#20 = #0#0; |Y #101#17 = #0#1;
          nNumRec = #101#18 + 1;
     |SINO;
          nNumRec = 1;
     |FINSI;

     |DDEFECTO #101;
     #101#30 = "A";
     #101#20 = #0#0;
     #101#17 = #0#1;
     #101#18 = nNumRec;
     #101#0  = #0#0;
     #101#1  = nNumRec;
     #101#2  = #2#3;
     #101#3  = #4#1;
     #101#4  = #4#29;
     #101#5  = "N";
     #101#6  = "N";
     #101#7  = #2#1;
     #101#8  = #2#1;
     #101#9  = #0#4 - #0#5;
     #101#10 = "N";
     #101#11 = "N";
     #101#12 = #4#16;
     #101#14 = "N";
     #101#15 = "N";
     #101#16 = efFecha;
     #101#19 = #psion019#0;
     #101#22 = 3;        ||Tipo recibo
     #101#23 = 0;
     #101#24 = #agifa024#20;
     #101#25 = 0;
     #101#26 = 0;
     #101#27 = 0;
     #101#28 = eaCtaDesprecio;
     |GRABA 020#101n;
     |CIERRA #101;

     |DBASS aAlfa;
     aAlfa = aAlfa + "dscarter/fich/dscam000.dat";
     |XABRE "E", aAlfa, nHandle;
     |SI FSalida = 0;
          |DBASS aPath;
          aPath = aPath + "dscarter/";
          aDef00 = aPath + "def/dscamrec";
          |CARGA_DEF aDef00, dscamrec@;
          |SI FSalida ! 0;
               aMensa = "0000Error al cargar:" + aDef00;
               |MENAV aMensa;
          |SINO;
               |HAZ CreaTempo; aTempo600 = Tempo;
               |PATH_DAT #600 aPath; |NOME_DAT #600 aTempo600; |DELINDEX #600;
               |ABRE #600;
               aCPath = aPath; aCNome = aTempo600;

               |DFICE Comodin;
               Comodin = Comodin % -106;
               Comodin = Comodin % 0105;
               nDeci_Div = 2;

               |DDEFECTO #25;
               #25#0 = #2#6
               |LEE 000#25=;

               |DDEFECTO #dscamrec@;
               #600#1  = #101#20;||Serie
               #600#2  = #101#17;||Fact
               #600#3  = #101#18;||N§ Rec
               #600#4  = #101#8; ||F.V
               #600#5  = #101#7; ||F.E
               #600#6  = #101#12;||Cuenta Cli
               #600#7  = #101#3; ||Nom Cli
               #600#8  = #101#4; ||Nom Banco
               #600#9  = #agifa024#32;      ||Entidad
               #600#10 = #agifa024#33;      ||Sucursal
               #600#11 = #agifa024#31;      ||DC
               #600#12 = #agifa024#30;      ||Cuenta
               #600#13 = #101#22;||Tipo Rec
               #600#15 = #101#9; ||Importe
               #600#16 = #101#16;||A aceptar
               #600#17 = #101#6; ||Aceptado
               #600#18 = #101#2; ||Cliente
               #600#19 = #25#0;
               #600#20 = #25#1;
               #600#21 = #agifa024#3; ||Zona
               #600#22 = 1;           ||Documento
               #600#25 = Comodin;     ||Empresa ges
               #600#27 = "V";         ||Tipo
               #600#28 = "A";         ||Ope
               #600#29 = "EUR";
               #600#30 = "EURO";           ||Nombre
               #600#31 = 1;                ||Cambio Divisa
               #600#32 = 1;                ||Cambio Base
               #600#33 = #agifa024#203;
               #600#34 = 0;
               #600#35 = "A";
               #600#36 = #101#28;
               #600#38 = #101#16;
               #600#39 = #101#10;
               aAlfa = "|NC"; aAlfa = #600#aAlfa#;
               |SI aAlfa > 48;
                    #600#48 = #agifa024#215;
                    #600#49 = #agifa024#216;
               |FINSI;
               |SI aAlfa > 50;
                    #600#50 = #agifa024#217;
                    |ABRE #289;
                    #289#0 = #agifa024#0;
                    |LEE 000#289=;
                    |SI FSalida ! 0; |DDEFECTO #289; |FINSI;
                    |CIERRA #289;
                    #600#51 = #289#1;
               |FINSI;

               |GRABA 020#600n;
               |SUB_EJECUTA_NP ":dscarter/dsrecibo";
               #600#22 = 1;           ||Documento
               |LEE 000#600=;
               |SI FSalida ! 0; |O #600#37 = "ERROR               ";
                    nSwError = 1;
                    |MENAV "    La entrega tiene movimientos. Proceso abortado";
               |SINO;
                    eaTag = "RAP"; |HAZ Riesgos;
               |FINSI;
               Tempo = aTempo600; |HAZ BoraTempo;
               |CIERRA #600; |DELINDEX #600; |DESCARGA_DEF #dscamrec@;
          |FINSI;
     |FINSI;
|FPRC;

|CALCULO pasecob;
     |HAZ LeeDivisa;
     recibo = 1;
     sw = 0;
     #2#52 = #0#0;
     #2#0 = #0#1;
     |LEE 101#2=;
     |SI FSalida = 0; ||Y #2#38 = "N";       || R.PRIEGO (27.09.99)
         sw = 1;
         #2#61 = #2#61 + #0#5;
         #2#61 = #2#61 ! #15#7;
         |GRABA 020#2a;
     |FINSI;
     |LIBERA #2;

     |ABRE #agifa024;
     #agifa024#0 = #2#3;
     |LEE 000#agifa024.=;
     |SI FSalida ! 0; |DDEFECTO #agifa024; |FINSI;
     |CIERRA #agifa024;

     |ABRE #agifa091; |ABRE #agis0002;

     #agifa091#0 = #agifa024#20;
     |LEE 000#agifa091.=;
     |SI FSalida ! 0; |DDEFECTO #agifa091; |FINSI;
     nNumRec = 1; aAlfa = #psion019#0;
     #agis0002#30 = "A";
     numero = "000000" + #psion019#1; numero = numero % -106;
     #agis0002#20 = aAlfa;
     #agis0002#17 = #psion019#1;
     #agis0002#18 = 1;
     |LEE 000#agis0002.];
     |PARA; |SI FSalida = 0; |Y #agis0002#20 = aAlfa; |Y #agis0002#30 = "A"; |Y #agis0002#17 = #psion019#1; |HACIENDO;
        nNumRec = #agis0002#18 + 1;
        |LEE 000#agis0002.s;
     |SIGUE;
     |DDEFECTO #agis0002;
     #agis0002#30 = "A";
     #agis0002#20 = aAlfa;
     #agis0002#17 = numero;
     #agis0002#18 = nNumRec;
     |GRABA 020#agis0002.b;
     #agis0002#0  = numero;
     #agis0002#1  = nNumRec;
     #agis0002#2  = #2#3;
     #agis0002#3  = #4#1;
     #agis0002#4  = #4#29;
     #agis0002#5  = "N";
     #agis0002#6  = "N";
     #agis0002#7  = #2#1;
     #agis0002#8  = #2#1;
     #agis0002#9  = #psion019#5;
     #agis0002#10 = "N";
     #agis0002#11 = "N";
     #agis0002#12 = #4#16;
     #agis0002#14 = "N";
     #agis0002#15 = "N";
     #agis0002#16 = efFecha;
     #agis0002#19 = #psion019#0;
     #agis0002#22 = #agifa091#69;
     #agis0002#23 = 0;
     #agis0002#24 = #agifa024#20;
     #agis0002#25 = 0;
     #agis0002#26 = 0;
     #agis0002#27 = 0;
     #agis0002#28 = eaCuenta;
     |SI #psion019#7 ! 0;
       #agis0002#22 = #psion019#7; || Tipo recibo
       #agis0002#7 = #psion019#8; || F.Emision
     |FINSI;
     |GRABA 020#agis0002.a; |LIBERA #agis0002;
     |CIERRA #agifa091; |CIERRA #agis0002;
     |DBASS aAlfa;
     aAlfa = aAlfa + "dscarter/fich/dscam000.dat";
     |XABRE "E", aAlfa, nHandle;
     |SI FSalida = 0;
          |DBASS aPath;
          aPath = aPath + "dscarter/";
          aDef00 = aPath + "def/dscamrec";
          |CARGA_DEF aDef00, dscamrec@;
          |SI FSalida ! 0;
               aMensa = "0000Error al cargar:" + aDef00;
               |MENAV aMensa;
          |SINO;
               |HAZ CreaTempo; aTempo600 = Tempo;
               |PATH_DAT #600 aPath; |NOME_DAT #600 aTempo600; |DELINDEX #600;
               |ABRE #600;
               aCPath = aPath; aCNome = aTempo600;

               |DFICE Comodin;
               Comodin = Comodin % -106;
               Comodin = Comodin % 0105;
               nDeci_Div = 2;

               |DDEFECTO #25;
               #25#0 = #2#6
               |LEE 000#25=;

               |DDEFECTO #dscamrec@;
               #600#1  = #agis0002#20;||Serie
               #600#2  = #agis0002#17;||Fact
               #600#3  = #agis0002#18;||N§ Rec
               #600#4  = #agis0002#8; ||F.V
               #600#5  = #agis0002#7; ||F.E
               #600#6  = #agis0002#12;||Cuenta Cli
               #600#7  = #agis0002#3; ||Nom Cli
               #600#8  = #agis0002#4; ||Nom Banco
               #600#9  = #agifa024#32;      ||Entidad
               #600#10 = #agifa024#33;      ||Sucursal
               #600#11 = #agifa024#31;      ||DC
               #600#12 = #agifa024#30;      ||Cuenta
               #600#13 = #agis0002#22;||Tipo Rec
               #600#15 = #agis0002#9; ||Importe
               #600#16 = #agis0002#16;||A aceptar
               #600#17 = #agis0002#6; ||Aceptado
               #600#18 = #agis0002#2; ||Cliente
               #600#19 = #25#0;
               #600#20 = #25#1;
               #600#21 = #agifa024#3; ||Zona
               #600#22 = 1;           ||Documento
               #600#25 = Comodin;     ||Empresa ges
               #600#27 = "V";         ||Tipo
               #600#28 = "A";         ||Ope
               #600#29 = "EUR";
               #600#30 = "EURO";           ||Nombre
               #600#31 = 1;                ||Cambio Divisa
               #600#32 = 1;                ||Cambio Base
               #600#33 = #agifa024#203;
               #600#34 = 0;
               #600#35 = "A";
               #600#36 = #agis0002#28;
               #600#38 = #agis0002#16;
               #600#39 = #agis0002#10;

               aAlfa = "|NC"; aAlfa = #600#aAlfa#;
               |SI aAlfa > 48;
                    #600#48 = #agifa024#215;
                    #600#49 = #agifa024#216;
               |FINSI;
               |SI aAlfa > 50;
                    #600#50 = #agifa024#217;
                    |ABRE #289;
                    #289#0 = #agifa024#0;
                    |LEE 000#289=;
                    |SI FSalida ! 0; |DDEFECTO #289; |FINSI;
                    |CIERRA #289;
                    #600#51 = #289#1;
               |FINSI;
               |GRABA 020#600n;
               |SUB_EJECUTA_NP ":dscarter/dsrecibo";
               #600#22 = 1;           ||Documento
               |LEE 000#600=;
               |SI FSalida ! 0; |O #600#37 = "ERROR               ";
                    nSwError = 1;
                    |MENAV "    La entrega tiene movimientos. Proceso abortado";
               |SINO;
                    eaTag = "RAP"; |HAZ Riesgos;
               |FINSI;
               Tempo = aTempo600; |HAZ BoraTempo;
               |CIERRA #600; |DELINDEX #600; |DESCARGA_DEF #dscamrec@;
          |FINSI;
     |FINSI;
     |SI nSwJamaica = 0;
          nNume = #0#4 - #0#5;
          |SI #0#6 = "S"; |Y nNume ! 0;
               |HAZ JamaEntregaPen;
          |FINSI;
     |FINSI;

     #0#9 = "S";
     |GRABA 020#0a;
     |LIBERA #0;
|FCAL;

|DEFBUCLE pasecobros;
     #0#1;
     6,9;
     "     " ,       0 , 000 , 00, "S", "N";
     "zzzzz" ,  999999 , 999 , 99, "S", "N";
     be;
     NULL,pasecob;
|FIN;

|DEFBUCLE CobrosJamaica;
     #0#1;
     9;
     "     " ,       0 , 000 , 00, "N";
     "zzzzz" ,  999999 , 999 , 99, "N";
     be;
     NULL,pasecob;
|FIN;

|PROGRAMA;
     |HAZ EsJamaica;
     nSwJamaica = FSalida;

     |ABRE #2;
     |ABRE #25;
     |SI nSwJamaica = 0;
          |BUCLE CobrosJamaica;
     |SINO;
          |BUCLE pasecobros;
     |FINSI;
     |CIERRA #25;
     |CIERRA #2;
|FPRO;

|PROCESO LeeDivisa;
     |HAZ DecimalesBase;

     |ABRE #14;
     |ABRE #15;
     #14#0 = "A";
     |LEE 001#14=;
     |SI FSalida ! 0; |DDEFECTO #14; |FINSI;
     #15#0 = #14#9;
     |LEE 001#15=;
     |SI FSalida ! 0; |DDEFECTO #15; |FINSI;
     |LIBERA #14; |CIERRA #14;
     |LIBERA #15; |CIERRA #15;
|FPRC;
