|FICHEROS;
     agifa561 #0;    || Tarifas
     agifa019 #1;    || Articulos
     agifa112 #2;    || Proveedores
     agifa204 #10;   || Configuracion de titulos variables
     agifa321 #321;
     agifa324 #324;
     agifa142 #142;
|FIN;

|VARIABLES;
     &enTiva = 0;
     &efFiva = @;
     &eaDiva = "";
     &enIva = 0;
     &enRec = 0;
     &enAlta = 0;
     &eaArticulo = "";
     &nDeci_PreBase = 0;
     nRedo     = 0;
     nMulti    = 0;
     aAlfa     = "";
     var       = "X";
     path      = "";
     dir_fich  = "";
     dir_fich2 = "";
     empresa   = "";

     m1        = 0;
     m2        = 0;
     m3        = 0;
     m4        = 0;
     m5        = 0;
     m6        = 0;
     porcen1   = 0;
     porcen2   = 0;
     porcen3   = 0;
     porcen4   = 0;
     porcen5   = 0;
     porcen6   = 0;
     modo      = 0;
     modos     = 0;
     precio1   = 0;
     precio2   = 0;
     iva1      = 0;
     iva2      = 0;
     iva3      = 0;
     iva4      = 0;
     iva5      = 0;
     preu      = 0;
     aumento   = 0;
     i         = 0;
     ii        = 0;
     j         = 0;
     nprimera  = 0;
|FIN;

|CAMPOS;
    #0#10 pvp1;
    #0#11 pvp2;
    #0#12 pvp3;
    #0#31 pvp4;
    #0#32 pvp5;
    #0#33 pvp6;
    #0#9  redo;
|FIN;

|PROCESO tipo8; |TIPO 8;
     |ABRE #142;
     |LEE 000#142p;
     |SI #142#74 ! "T";
          |MENAV "    Parametros configurados para tarifas ultimo precio ...";
     |FINSI;
     |CIERRA #142;
     |ABRE #321; |LEE 000#321p; |CIERRA #321;
     |ABRE #324;
     #324#0 = #321#9;
     |LEE 000#324=;
     |CIERRA #324;
     nDeci_PreBase = #324#9;
|FPRC;

|| Este proceso calcula el pvp a partir del coste como margen ganancial
|| La formula es  -porcentaje = 100 - porcentaje
||                -cantidad resultante   = cantidad de partida*100 / porcentaje
|CALCULO pvp;|TIPO 0;
     |HAZ tipiva;
     porcen1 = #0#6;   || Aumentos
     porcen2 = #0#7;
     porcen3 = #0#8;
     porcen4 = #0#28;
     porcen5 = #0#29;
     porcen6 = #0#30;

     porcen1 = 100 - porcen1;
     porcen2 = 100 - porcen2;
     porcen3 = 100 - porcen3;
     porcen4 = 100 - porcen4;
     porcen5 = 100 - porcen5;
     porcen6 = 100 - porcen6;

     || **************** TARIFA UNO ********************
     |CAMPO_MODIFICA #0#6, 0, var;
     |SI Campo = 6;|Y var = "S";
          |SI #0#14 = "S";
               || Segun el tipo de iva
               |SI #1#30 = 1;
                    |SI #0#27 = "P";
                         pvp1 = (#0#5 > #0#6) > iva1;
                    |SINO;
                         pvp1 = ((#0#5*100)/porcen1)>iva1;
                    |FINSI;
               |FINSI;
               |SI #1#30 = 2;
                    |SI #0#27 = "P";
                         pvp1 = (#0#5 > #0#6) > iva2;
                    |SINO;
                         pvp1 = ((#0#5*100)/porcen1)>iva2;
                    |FINSI;
               |FINSI;
               |SI #1#30 = 3;
                    |SI #0#27 = "P";
                         pvp1 = #0#5 > #0#6 > iva3;
                    |SINO;
                         pvp1 = ((#0#5*100)/porcen1)>iva3;
                    |FINSI;
               |FINSI;
               |SI #1#30 = 4;
                    |SI #0#27 = "P";
                         pvp1 = #0#5 > #0#6 > iva4;
                    |SINO;
                         pvp1 = ((#0#5*100)/porcen1)>iva4;
                    |FINSI;
               |FINSI;
               |SI #1#30 = 5;
                    |SI #0#27 = "P";
                         pvp1 = (#0#5 > #0#6) > iva5;
                    |SINO;
                         pvp1 = ((#0#5*100)/porcen1)>iva5;
                    |FINSI;
               |FINSI;
          |SINO;
               |SI #0#27 = "P";
                    pvp1 = #0#5 > #0#6;
               |SINO;
                    pvp1 = (#0#5*100)/porcen1;
               |FINSI;
          |FINSI;
     |FINSI;   ||Finsi de si Campo =6

     || ********************** TARIFA 2
     |CAMPO_MODIFICA #0#7,0,var;
     |SI Campo = 7; |Y var = "S";
          |SI #0#15 = "S";
               || Segun el tipo de iva
               |SI #1#30 = 1;
                    |SI #0#27 = "P";
                         pvp2 = (#0#5 > #0#7) > iva1;
                    |SINO;
                         pvp2 = ((#0#5*100)/porcen2)>iva1;
                    |FINSI;
               |FINSI;
               |SI #1#30=2;
                    |SI #0#27 = "P";
                         pvp2 = (#0#5 > #0#7) > iva2;
                    |SINO;
                         pvp2 = ((#0#5*100)/porcen2)>iva2;
                    |FINSI;
               |FINSI;
               |SI #1#30 = 3;
                    |SI #0#27 = "P";
                         pvp2 = (#0#5 > #0#7) > iva3;
                    |SINO;
                         pvp2 = ((#0#5*100)/porcen2)>iva3;
                    |FINSI;
               |FINSI;
               |SI #1#30 = 4;
                    |SI #0#27 = "P";
                         pvp2 = (#0#5 > #0#7) > iva4;
                    |SINO;
                         pvp2 = ((#0#5*100)/porcen2)>iva4;
                    |FINSI;
               |FINSI;
               |SI #1#30 = 5;
                    |SI #0#27 = "P";
                         pvp2 = (#0#5 > #0#7) > iva5;
                    |SINO;
                         pvp2 = ((#0#5*100)/porcen2)>iva5;
                    |FINSI;
               |FINSI;
          |SINO;
               |SI #0#27 = "P";
                    pvp2 = #0#5 > #0#7;
               |SINO;
                    pvp2 = (#0#5*100)/porcen2;
               |FINSI;
          |FINSI;
     |FINSI;   ||Finsi del Campo=7

     || ********************** TARIFA 3
     |CAMPO_MODIFICA #0#8, 0, var;
     |SI Campo = 8;|Y var = "S";
          |SI #0#16="S";
               || Segun el tipo de iva
               |SI #1#30 = 1;
                    |SI #0#27 = "P";
                         pvp3 = (#0#5 > #0#8) > iva1;
                    |SINO;
                         pvp3 = ((#0#5*100)/porcen3)>iva1;
                    |FINSI;
               |FINSI;
               |SI #1#30 = 2;
                    |SI #0#27 = "P";
                         pvp3 = (#0#5 > #0#8) > iva2;
                    |SINO;
                         pvp3 = ((#0#5*100)/porcen3)>iva2;
                    |FINSI;
               |FINSI;
               |SI #1#30 = 3;
                    |SI #0#27 = "P";
                         pvp3 = (#0#5 > #0#8) > iva3;
                    |SINO;
                         pvp3 = ((#0#5*100)/porcen3)>iva3;
                    |FINSI;
               |FINSI;
               |SI #1#30 = 4;
                    |SI #0#27 = "P";
                         pvp3 = (#0#5 > #0#8) > iva4;
                    |SINO;
                         pvp3 = ((#0#5*100)/porcen3)>iva4;
                    |FINSI;
               |FINSI;
               |SI #1#30 = 5;
                    |SI #0#27 = "P";
                         pvp3 = (#0#5 > #0#8) > iva5;
                    |SINO;
                         pvp3 = ((#0#5*100)/porcen3)>iva5;
                    |FINSI;
               |FINSI;
          |SINO;
               |SI #0#27 = "P";
                    pvp3 = #0#5 > #0#8;
               |SINO;
                    pvp3 = (#0#5*100)/porcen3;
               |FINSI;
          |FINSI;
     |FINSI;   ||Campo=8

     || ********************** TARIFA 4
     |CAMPO_MODIFICA #0#28, 0, var;
     |SI Campo = 28;|Y var = "S";
          |SI #0#16="S";
               || Segun el tipo de iva
               |SI #1#30 = 1;
                    |SI #0#27 = "P";
                         pvp4 = (#0#5 > #0#28) > iva1;
                    |SINO;
                         pvp4 = ((#0#5*100)/porcen4)>iva1;
                    |FINSI;
               |FINSI;
               |SI #1#30 = 2;
                    |SI #0#27 = "P";
                         pvp4 = (#0#5 > #0#28) > iva2;
                    |SINO;
                         pvp4 = ((#0#5*100)/porcen4)>iva2;
                    |FINSI;
               |FINSI;
               |SI #1#30 = 3;
                    |SI #0#27 = "P";
                         pvp4 = (#0#5 > #0#28) > iva3;
                    |SINO;
                         pvp4 = ((#0#5*100)/porcen4)>iva3;
                    |FINSI;
               |FINSI;
               |SI #1#30 = 4;
                    |SI #0#27 = "P";
                         pvp4 = (#0#5 > #0#28) > iva4;
                    |SINO;
                         pvp4 = ((#0#5*100)/porcen4)>iva4;
                    |FINSI;
               |FINSI;
               |SI #1#30 = 5;
                    |SI #0#27 = "P";
                         pvp4 = (#0#5 > #0#28) > iva5;
                    |SINO;
                         pvp4 = ((#0#5*100)/porcen4)>iva5;
                    |FINSI;
               |FINSI;
          |SINO;
               |SI #0#27 = "P";
                    pvp4 = #0#5 > #0#28;
               |SINO;
                    pvp4 = (#0#5*100)/porcen4;
               |FINSI;
          |FINSI;
     |FINSI;

     || ********************** TARIFA 5
     |CAMPO_MODIFICA #0#29, 0, var;
     |SI Campo = 29;|Y var = "S";
          |SI #0#16 = "S";
               || Segun el tipo de iva
               |SI #1#30 = 1;
                    |SI #0#27 = "P";
                         pvp5 = (#0#5 > #0#29) > iva1;
                    |SINO;
                         pvp5 = ((#0#5*100)/porcen5)>iva1;
                    |FINSI;
               |FINSI;
               |SI #1#30 = 2;
                    |SI #0#27 = "P";
                         pvp5 = (#0#5 > #0#29) > iva2;
                    |SINO;
                         pvp5 = ((#0#5*100)/porcen5)>iva2;
                    |FINSI;
               |FINSI;
               |SI #1#30 = 3;
                    |SI #0#27 = "P";
                         pvp5 = (#0#5 > #0#29) > iva3;
                    |SINO;
                         pvp5 = ((#0#5*100)/porcen5)>iva3;
                    |FINSI;
               |FINSI;
               |SI #1#30 = 4;
                    |SI #0#27 = "P";
                         pvp5 = (#0#5 > #0#29) > iva4;
                    |SINO;
                         pvp5 = ((#0#5*100)/porcen4)>iva4;
                    |FINSI;
               |FINSI;
               |SI #1#30 = 5;
                    |SI #0#27 = "P";
                         pvp5 = (#0#5 > #0#29) > iva5;
                    |SINO;
                         pvp5 = ((#0#5*100)/porcen5)>iva5;
                    |FINSI;
               |FINSI;
          |SINO;
               |SI #0#27 = "P";
                    pvp5 = #0#5 > #0#29;
               |SINO;
                    pvp5 = (#0#5*100)/porcen5;
               |FINSI;
          |FINSI;
     |FINSI;

     || ********************** TARIFA 6
     |CAMPO_MODIFICA #0#30, 0, var;
     |SI Campo = 30;|Y var = "S";
          |SI #0#16 = "S";
               || Segun el tipo de iva
               |SI #1#30 = 1;
                    |SI #0#27 = "P";
                         pvp6 = (#0#5 > #0#30) > iva1;
                    |SINO;
                         pvp6 = ((#0#5*100)/porcen6)>iva1;
                    |FINSI;
               |FINSI;
               |SI #1#30 = 2;
                    |SI #0#27 = "P";
                         pvp6 = (#0#5 > #0#30) > iva2;
                    |SINO;
                         pvp6 = ((#0#5*100)/porcen6)>iva2;
                    |FINSI;
               |FINSI;
               |SI #1#30 = 3;
                    |SI #0#27 = "P";
                         pvp6 = (#0#5 > #0#30) > iva3;
                    |SINO;
                         pvp6 = ((#0#5*100)/porcen6)>iva3;
                    |FINSI;
               |FINSI;
               |SI #1#30 = 4;
                    |SI #0#27 = "P";
                         pvp6 = (#0#5 > #0#30) > iva4;
                    |SINO;
                         pvp6 = ((#0#5*100)/porcen6)>iva4;
                    |FINSI;
               |FINSI;
               |SI #1#30 = 5;
                    |SI #0#27 = "P";
                         pvp6 = (#0#5 > #0#30) > iva5;
                    |SINO;
                         pvp6 = ((#0#5*100)/porcen6)>iva5;
                    |FINSI;
               |FINSI;
          |SINO;
               |SI #0#27 = "P";
                    pvp6 = #0#5 > #0#30;
               |SINO;
                    pvp6 = (#0#5*100)/porcen6;
               |FINSI;
          |FINSI;
     |FINSI;

     |SI redo > 0;    || Si queremos redondeo
          |HAZ redon;
     |FINSI;
     |PINTA pvp1;
     |PINTA pvp2;
     |PINTA pvp3;
     |PINTA pvp4;
     |PINTA pvp5;
     |PINTA pvp6;
|FCAL;

|CALCULO redon;|TIPO 0;
     aAlfa = "0" * nDeci_PreBase;
     aAlfa = "1" + aAlfa;
     nMulti = aAlfa;
     nRedo = redo * nMulti;

     pvp1 = (pvp1 * nMulti) ! 0;
     pvp2 = (pvp2 * nMulti) ! 0;
     pvp3 = (pvp3 * nMulti) ! 0;
     pvp4 = (pvp4 * nMulti) ! 0;
     pvp5 = (pvp5 * nMulti) ! 0;
     pvp6 = (pvp6 * nMulti) ! 0;

     m1 = pvp1 $ nRedo;
     m2 = pvp2 $ nRedo;
     m3 = pvp3 $ nRedo;
     m4 = pvp4 $ nRedo;
     m5 = pvp5 $ nRedo;
     m6 = pvp6 $ nRedo;

     |SI m1 ! 0;
          m1 = nRedo - m1;
          pvp1 = pvp1 + m1;
     |FINSI;
     |SI m2 ! 0;
           m2 = nRedo - m2;
           pvp2 = pvp2 + m2;
     |FINSI;
     |SI m3 ! 0;
          m3 = nRedo - m3;
          pvp3 = pvp3 + m3;
     |FINSI;
     |SI m4 ! 0;
          m4 = nRedo - m4;
          pvp4 = pvp4 + m4;
     |FINSI;
     |SI m5 ! 0;
          m5 = nRedo - m5;
          pvp5 = pvp5 + m5;
     |FINSI;
     |SI m6 ! 0;
          m6 = nRedo - m6;
          pvp6 = pvp6 + m6;
     |FINSI;

     pvp1 = pvp1 / nMulti;
     pvp2 = pvp2 / nMulti;
     pvp3 = pvp3 / nMulti;
     pvp4 = pvp4 / nMulti;
     pvp5 = pvp5 / nMulti;
     pvp6 = pvp6 / nMulti;

     |PINTA pvp1;
     |PINTA pvp2;
     |PINTA pvp3;
     |PINTA pvp4;
     |PINTA pvp5;
     |PINTA pvp6;
|FCAL;

|CALCULO aumenta;|TIPO 0;
     |HAZ pvp;
|FCAL;

|| Este proceso recoge los datos del fichero de articulos siempre que este
|| en modo alta
|PROCESO recoge;|TIPO 0;
     modo = FEntrada / 100;       || Averiguo el modo en el que estoy
     modo = modo ! 0;

     |SI modo = 1;   || Solo si se trata de alta
     |ABRE #1;
     #1#0=#0#0;     ||Miro los datos del fichero de articulos
     |LEE 001#1=;
     |CIERRA #1;
          || Asigno valores del fichero de articulos
          #0#3 = #1#29;   || Ultimo dto. compra
          #0#6 = #1#105;  || % Aumento 1
          #0#7 = #1#106;  || % Aumento 2
          #0#8 = #1#107;  || % Aumento 3
          #0#28 = #1#156;  || % Aumento 4
          #0#29 = #1#157;  || % Aumento 5
          #0#30 = #1#158;  || % Aumento 6
          #0#10 = #1#18;  || pvp1
          #0#11 = #1#19;  || pvp2
          #0#12 = #1#20;  || pvp3
          #0#31 = #1#147;  || pvp4
          #0#32 = #1#148;  || pvp5
          #0#33 = #1#149;  || pvp6
          #0#9  = #1#109; || Redondeo a n ptas.
          #0#1 = #1#27;  ||Ultimo proveedor
          #0#2 = #1#28;  ||Ultimo precio compra
     |PINDA #0#0;
    |FINSI;

|FPRC;

|| Actualiza los datos del fichero articulo una vez hayamos salido de la
|| pantalla en base a los cambios de precios efectuados
|PROCESO fin;|TIPO 3;
     modos =(FEntrada/100)!0;
     |HAZ recal_dto;
     |ABRE #1;
     #1#0=#0#0;
     |LEE 101#1=;
     |SI FSalida=0;
          #1#105 = #0#6;  || % Aumento 1
          #1#106 = #0#7;  || % Aumento 2
          #1#107 = #0#8;  || % Aumento 3
          #1#156 = #0#28;  || % Aumento 4
          #1#157 = #0#29;  || % Aumento 5
          #1#158 = #0#30;  || % Aumento 6
          |SI #0#17 ! 8;
               #1#18 = #0#10;  || pvp1
               #1#19 = #0#11;  || pvp2
               #1#20 = #0#12;  || pvp3
               #1#147 = #0#31;  || pvp4
               #1#148 = #0#32;  || pvp5
               #1#149 = #0#33;  || pvp6
          |FINSI;
          #1#109  = #0#9; || Redondeo a n ptas.
          #1#123 = "N";  || Marco como exportado no para que pueda ser
                         || exportado al resto de tiendas
          #1#124 = "00.00.0000";   ||Fecha de exportacion
          |GRABA 001#1a;
     |FINSI;
     |LIBERA #1;
     |CIERRA #1;
|FPRC;

|PROCESO recal_dto;
     aumento = 100 - #0#37;
     aumento = (#0#5 * 100) / aumento;
     #0#26 = aumento;
     aumento = 100 - #0#4;
     aumento = (#0#26 * 100) / aumento;
     #0#26 = aumento;
     aumento = 100 - #0#3;
     aumento = (#0#26 * 100) / aumento;
     #0#26 = aumento;
     |PINTA #0#26;
|FPRC;

|PROCESO suma;|TIPO 0;
|FPRC;

||Calculo de los tipos de iva
|PROCESO tipiva;

    enTiva = 1; efFiva = ~; |HAZ SacaIVA;
    |SI eaDiva = ""; |MENAV "0000NO existe el Tipo de IVA 1";|FINSI;

    enTiva = 2; efFiva = ~; |HAZ SacaIVA;
    |SI eaDiva = ""; |MENAV "0000NO existe el Tipo de IVA 2";|FINSI;

    enTiva = 1; efFiva = ~; |HAZ SacaIVA;
    |SI eaDiva = ""; |MENAV "0000NO existe el Tipo de IVA 3";|FINSI;

    enTiva = 1; efFiva = ~; |HAZ SacaIVA;
    |SI eaDiva = ""; |MENAV "0000NO existe el Tipo de IVA 4";|FINSI;

    enTiva = 1; efFiva = ~; |HAZ SacaIVA;
    |SI eaDiva = ""; |MENAV "0000NO existe el Tipo de IVA 5";|FINSI;
|FPRC;

|PROCESO iva1;|TIPO 0;
     |SI #0#14 ! Contenido;
          |SI #0#14 = "S";
               |SI #1#30 = 1;
                    |SI #0#27 = "P";
                         pvp1 = (#0#5 > #0#6) > iva1;
                    |SINO;
                         pvp1 = ((#0#5*100)/porcen1)>iva1;
                    |FINSI;
               |FINSI;
               |SI #1#30 = 2;
                    |SI #0#27 = "P";
                         pvp1 = (#0#5 > #0#6) > iva2;
                    |SINO;
                         pvp1 = ((#0#5*100)/porcen1)>iva2;
                    |FINSI;
               |FINSI;
               |SI #1#30 = 3;
                    |SI #0#27 = "P";
                         pvp1 = (#0#5 > #0#6) > iva3;
                    |SINO;
                         pvp1 = ((#0#5*100)/porcen1)>iva3;
                    |FINSI;
               |FINSI;
               |SI #1#30 = 4;
                    |SI #0#27 = "P";
                         pvp1 = (#0#5 > #0#6) > iva4;
                    |SINO;
                         pvp1 = ((#0#5*100)/porcen1)>iva4;
                    |FINSI;
               |FINSI;
               |SI #1#30 = 5;
                    |SI #0#27 = "P";
                         pvp1 = (#0#5 > #0#6) > iva5;
                    |SINO;
                         pvp1 = ((#0#5*100)/porcen1)>iva5;
                    |FINSI;
               |FINSI;
          |SINO;
               |SI #0#27 = "P";
                    pvp1 = #0#5 > #0#6;
               |SINO;
                    pvp1 = (#0#5*100)/porcen1;
               |FINSI;
          |FINSI;
          |SI redo >0 ;|HAZ redon; |FINSI;
     |FINSI;
|FPRC;

|PROCESO iva2;|TIPO 0;
     |SI #0#15 ! Contenido;
          |SI #0#15="S";
               |SI #1#30 = 1;
                    |SI #0#27 = "P";
                         pvp2 = (#0#5 > #0#7) > iva1;
                    |SINO;
                         pvp2 = ((#0#5*100)/porcen2)>iva1;
                    |FINSI;
               |FINSI;
               |SI #1#30 = 2;
                    |SI #0#27 = "P";
                         pvp2 = (#0#5 > #0#7) > iva2;
                    |SINO;
                         pvp2 = ((#0#5*100)/porcen2)>iva2;
                    |FINSI;
               |FINSI;
               |SI #1#30 = 3;
                    |SI #0#27 = "P";
                         pvp2 = (#0#5 > #0#7) > iva3;
                    |SINO;
                         pvp2 = ((#0#5*100)/porcen2)>iva3;
                    |FINSI;
               |FINSI;
               |SI #1#30 = 4;
                    |SI #0#27 = "P";
                         pvp2 = (#0#5 > #0#7) > iva4;
                    |SINO;
                         pvp2 = ((#0#5*100)/porcen2)>iva4;
                    |FINSI;
               |FINSI;
               |SI #1#30 = 5;
                    |SI #0#27 = "P";
                         pvp2 = (#0#5 > #0#7) > iva5;
                    |SINO;
                         pvp2 = ((#0#5*100)/porcen2)>iva5;
                    |FINSI;
               |FINSI;
          |SINO;
               |SI #0#27 = "P";
                    pvp2 = #0#5 > #0#7;
               |SINO;
                    pvp2 = (#0#5*100)/porcen2;
               |FINSI;
          |FINSI;
          |SI redo >0 ;|HAZ redon; |FINSI;
     |FINSI;
|FPRC;

|PROCESO iva3;|TIPO 0;
     |SI #0#16 ! Contenido;
          |SI #0#16 = "S";
               |SI #1#30 = 1;
                    |SI #0#27 = "P";
                         pvp3 = (#0#5 > #0#8) > iva1;
                    |SINO;
                         pvp3 = ((#0#5*100)/porcen3)>iva1;
                    |FINSI;
               |FINSI;
               |SI #1#30 = 2;
                    |SI #0#27 = "P";
                         pvp3 = (#0#5 > #0#8) > iva2;
                    |SINO;
                         pvp3 = ((#0#5*100)/porcen3)>iva2;
                    |FINSI;
               |FINSI;
               |SI #1#30 = 3;
                    |SI #0#27 = "P";
                         pvp3 = (#0#5 > #0#8) > iva3;
                    |SINO;
                         pvp3 = ((#0#5*100)/porcen3)>iva3;
                    |FINSI;
               |FINSI;
               |SI #1#30 = 4;
                    |SI #0#27 = "P";
                         pvp3 = (#0#5 > #0#8) > iva4;
                    |SINO;
                         pvp3 = ((#0#5*100)/porcen3)>iva4;
                    |FINSI;
               |FINSI;
               |SI #1#30 = 5;
                    |SI #0#27 = "P";
                         pvp3 = (#0#5 > #0#8) > iva5;
                    |SINO;
                         pvp3 = ((#0#5*100)/porcen3)>iva5;
                    |FINSI;
               |FINSI;
          |SINO;
               |SI #0#27 = "P";
                    pvp3 = #0#5 > #0#8;
               |SINO;
                    pvp3 = (#0#5*100)/porcen3;
               |FINSI;
          |FINSI;
          |SI redo >0 ;|HAZ redon; |FINSI;
     |FINSI;
|FPRC;

|PROCESO iva4;|TIPO 0;
     |SI #0#34 ! Contenido;
          |SI #0#34 = "S";
               |SI #1#30 = 1;
                    |SI #0#27 = "P";
                         pvp4 = (#0#5 > #0#28) > iva1;
                    |SINO;
                         pvp4 = ((#0#5*100)/porcen4)>iva1;
                    |FINSI;
               |FINSI;
               |SI #1#30 = 2;
                    |SI #0#27 = "P";
                         pvp4 = (#0#5 > #0#28) > iva2;
                    |SINO;
                         pvp4 = ((#0#5*100)/porcen4)>iva2;
                    |FINSI;
               |FINSI;
               |SI #1#30 = 3;
                    |SI #0#27 = "P";
                         pvp4 = (#0#5 > #0#28) > iva3;
                    |SINO;
                         pvp4 = ((#0#5*100)/porcen4)>iva3;
                    |FINSI;
               |FINSI;
               |SI #1#30 = 4;
                    |SI #0#27 = "P";
                         pvp4 = (#0#5 > #0#28) > iva4;
                    |SINO;
                         pvp4 = ((#0#5*100)/porcen4)>iva4;
                    |FINSI;
               |FINSI;
               |SI #1#30 = 5;
                    |SI #0#27 = "P";
                         pvp4 = (#0#5 > #0#28) > iva5;
                    |SINO;
                         pvp4 = ((#0#5*100)/porcen4)>iva5;
                    |FINSI;
               |FINSI;
          |SINO;
               |SI #0#27 = "P";
                    pvp4 = #0#5 > #0#28;
               |SINO;
                    pvp4 = (#0#5*100)/porcen4;
               |FINSI;
          |FINSI;
          |SI redo >0 ;|HAZ redon; |FINSI;
     |FINSI;
|FPRC;

|PROCESO iva5;|TIPO 0;
     |SI #0#35 ! Contenido;
          |SI #0#34 = "S";
               |SI #1#30 = 1;
                    |SI #0#27 = "P";
                         pvp5 = (#0#5 > #0#29) > iva1;
                    |SINO;
                         pvp5 = ((#0#5*100)/porcen5)>iva1;
                    |FINSI;
               |FINSI;
               |SI #1#30 = 2;
                    |SI #0#27 = "P";
                         pvp5 = (#0#5 > #0#29) > iva2;
                    |SINO;
                         pvp5 = ((#0#5*100)/porcen5)>iva2;
                    |FINSI;
               |FINSI;
               |SI #1#30 = 3;
                    |SI #0#27 = "P";
                         pvp5 = (#0#5 > #0#29) > iva3;
                    |SINO;
                         pvp5 = ((#0#5*100)/porcen5)>iva3;
                    |FINSI;
               |FINSI;
               |SI #1#30 = 4;
                    |SI #0#27 = "P";
                         pvp5 = (#0#5 > #0#29) > iva4;
                    |SINO;
                         pvp5 = ((#0#5*100)/porcen5)>iva4;
                    |FINSI;
               |FINSI;
               |SI #1#30 = 5;
                    |SI #0#27 = "P";
                         pvp5 = (#0#5 > #0#29) > iva5;
                    |SINO;
                         pvp5 = ((#0#5*100)/porcen5)>iva5;
                    |FINSI;
               |FINSI;
          |SINO;
               |SI #0#27 = "P";
                    pvp5 = #0#5 > #0#29;
               |SINO;
                    pvp5 = (#0#5*100)/porcen5
               |FINSI;
          |FINSI;
          |SI redo >0 ;|HAZ redon; |FINSI;
     |FINSI;
|FPRC;

|PROCESO iva6;|TIPO 0;
     |SI #0#36 ! Contenido;
          |SI #0#36 = "S";
               |SI #1#30 = 1;
                    |SI #0#27 = "P";
                         pvp6 = (#0#5 > #0#30) > iva1;
                    |SINO;
                         pvp6 = ((#0#5*100)/porcen6)>iva1;
                    |FINSI;
               |FINSI;
               |SI #1#30 = 2;
                    |SI #0#27 = "P";
                         pvp6 = (#0#5 > #0#30) > iva2;
                    |SINO;
                         pvp6 = ((#0#5*100)/porcen6)>iva2;
                    |FINSI;
               |FINSI;
               |SI #1#30 = 3;
                    |SI #0#27 = "P";
                         pvp6 = (#0#5 > #0#30) > iva3;
                    |SINO;
                         pvp6 = ((#0#5*100)/porcen6)>iva3;
                    |FINSI;
               |FINSI;
               |SI #1#30 = 4;
                    |SI #0#27 = "P";
                         pvp6 = (#0#5 > #0#30) > iva4;
                    |SINO;
                         pvp6= ((#0#5*100)/porcen6)>iva4;
                    |FINSI;
               |FINSI;
               |SI #1#30 = 5;
                    |SI #0#27 = "P";
                         pvp6 = (#0#5 > #0#30) > iva5;
                    |SINO;
                         pvp6 = ((#0#5*100)/porcen6)>iva5;
                    |FINSI;
               |FINSI;
          |SINO;
               |SI #0#27 = "P";
                    pvp6 = #0#5 > #0#30;
               |SINO;
                    pvp6 = (#0#5*100)/porcen6;
               |FINSI;
          |FINSI;
          |SI redo >0 ;|HAZ redon; |FINSI;
     |FINSI;
|FPRC;

|PROCESO noaumento1;|TIPO 0;
     |SI #0Campo!Contenido;
          |HAZ tipiva;
          |SI #0#14="S";
               preu=0;
               |SI #1#30=1; preu = #0#10 < iva1; |FINSI;
               |SI #1#30=2; preu = #0#10 < iva2; |FINSI;
               |SI #1#30=3; preu = #0#10 < iva3; |FINSI;
               |SI #1#30=4; preu = #0#10 < iva4; |FINSI;
               |SI #1#30=5; preu = #0#10 < iva5; |FINSI;
               aumento = #0#5 * 100 / preu;
          |SINO;
               aumento = #0#5*100/#0#10;
          |FINSI;

          |SI #0#27 = "G";
               #0#6 = (100 - aumento) ! 2;
          |SINO;
              #0#6 = aumento;
          |FINSI;
          |PINTA #0#6;
     |FINSI;
|FPRC;

|PROCESO noaumento2;|TIPO 0;
     |SI #0Campo!Contenido;
          |HAZ tipiva;
          |SI #0#15 = "S";
               preu=0;
               |SI #1#30=1; preu = #0#11 < iva1; |FINSI;
               |SI #1#30=2; preu = #0#11 < iva2; |FINSI;
               |SI #1#30=3; preu = #0#11 < iva3; |FINSI;
               |SI #1#30=4; preu = #0#11 < iva4; |FINSI;
               |SI #1#30=5; preu = #0#11 < iva5; |FINSI;
               aumento = #0#5 * 100 / preu;
          |SINO;
               aumento = #0#5 * 100 / #0#11;
          |FINSI;
          |SI #0#27 = "G";
               #0#7 = (100 - aumento) ! 2;
          |SINO;
               #0#7 = aumento;
          |FINSI;
          |PINTA #0#7;
     |FINSI;
|FPRC;

|PROCESO noaumento3;|TIPO 0;
     |SI #0Campo ! Contenido;
          |HAZ tipiva;
          |SI #0#16 = "S";
               preu=0;
               |SI #1#30=1; preu = #0#12 < iva1; |FINSI;
               |SI #1#30=2; preu = #0#12 < iva2; |FINSI;
               |SI #1#30=3; preu = #0#12 < iva3; |FINSI;
               |SI #1#30=4; preu = #0#12 < iva4; |FINSI;
               |SI #1#30=5; preu = #0#12 < iva5; |FINSI;
               aumento = #0#5 * 100 / preu;
          |SINO;
               aumento = #0#5 * 100 / #0#12;
          |FINSI;
          |SI #0#27 = "G";
               #0#8 = (100 - aumento) ! 2;
          |SINO;
               #0#8 = aumento;
          |FINSI;
          |PINTA #0#8;
     |FINSI;
|FPRC;

|PROCESO noaumento4;|TIPO 0;
     |SI #0Campo ! Contenido;
          |HAZ tipiva;
          |SI #0#34 = "S";
               preu = 0;
               |SI #1#30=1; preu = #0#31 < iva1; |FINSI;
               |SI #1#30=2; preu = #0#31 < iva2; |FINSI;
               |SI #1#30=3; preu = #0#31 < iva3; |FINSI;
               |SI #1#30=4; preu = #0#31 < iva4; |FINSI;
               |SI #1#30=5; preu = #0#31 < iva5; |FINSI;
               aumento = #0#5 * 100 / preu;
          |SINO;
               aumento = #0#5 * 100 / #0#31;
          |FINSI;
          |SI #0#27 = "G";
               #0#28 = (100 - aumento) ! 2;
          |SINO;
               #0#28 = aumento;
          |FINSI;
          |PINTA #0#28;
     |FINSI;
|FPRC;

|PROCESO noaumento5;|TIPO 0;
     |SI #0Campo ! Contenido;
          |HAZ tipiva;
          |SI #0#3 = "S";
               preu = 0;
               |SI #1#30=1; preu = #0#32 < iva1; |FINSI;
               |SI #1#30=2; preu = #0#32 < iva2; |FINSI;
               |SI #1#30=3; preu = #0#32 < iva3; |FINSI;
               |SI #1#30=4; preu = #0#32 < iva4; |FINSI;
               |SI #1#30=5; preu = #0#32 < iva5; |FINSI;
               aumento = #0#5 * 100 / preu;
          |SINO;
               aumento = #0#5 * 100 / #0#32;
          |FINSI;
          |SI #0#27 = "G";
               #0#29 = (100 - aumento) ! 2;
          |SINO;
               #0#29 = aumento;
          |FINSI;
          |PINTA #0#29;
     |FINSI;
|FPRC;

|PROCESO noaumento6;|TIPO 0;
     |SI #0Campo ! Contenido;
          |HAZ tipiva;
          |SI #0#3 = "S";
               preu = 0;
               |SI #1#30=1; preu = #0#33 < iva1; |FINSI;
               |SI #1#30=2; preu = #0#33 < iva2; |FINSI;
               |SI #1#30=3; preu = #0#33 < iva3; |FINSI;
               |SI #1#30=4; preu = #0#33 < iva4; |FINSI;
               |SI #1#30=5; preu = #0#33 < iva5; |FINSI;
               aumento = #0#5 * 100 / preu;
          |SINO;
               aumento = #0#5 * 100 / #0#33;
          |FINSI;
          |SI #0#27 = "G";
               #0#30 = (100 - aumento) ! 2;
          |SINO;
               #0#30 = aumento;
          |FINSI;
          |PINTA #0#30;
     |FINSI;
|FPRC;

|PROCESO precios;|TIPO 0;
     |CAMPO_MODIFICA #0#6,1,AN;    ||Incremento 1
     |CAMPO_MODIFICA #0#7,1,AN;    ||Incremento 2
     |CAMPO_MODIFICA #0#8,1,AN;    ||Incremento 3
     |CAMPO_MODIFICA #0#28,1,AN;    ||Incremento 4
     |CAMPO_MODIFICA #0#29,1,AN;    ||Incremento 5
     |CAMPO_MODIFICA #0#30,1,AN;    ||Incremento 6
     |CAMPO_MODIFICA #0#10,1,AN;   ||PVP
     |CAMPO_MODIFICA #0#11,1,AN;   ||
     |CAMPO_MODIFICA #0#12,1,AN;   ||
     |CAMPO_MODIFICA #0#31,1,AN;   ||
     |CAMPO_MODIFICA #0#32,1,AN;   ||
     |CAMPO_MODIFICA #0#33,1,AN;   ||
     |CAMPO_MODIFICA #0#14,1,AN;   ||IVAS
     |CAMPO_MODIFICA #0#15,1,AN;   ||
     |CAMPO_MODIFICA #0#16,1,AN;   ||
     |CAMPO_MODIFICA #0#34,1,AN;   ||
     |CAMPO_MODIFICA #0#35,1,AN;   ||
     |CAMPO_MODIFICA #0#36,1,AN;   ||

     |SI #0#17="1"; |O #0#17 = "4"; |O #0#17 = "5";
          |CAMPO_MODIFICA #0#6,1,AS;    ||Incremento 1
          |CAMPO_MODIFICA #0#10,1,AS;   ||PVP
          |CAMPO_MODIFICA #0#14,1,AS;   ||IVAS
     |FINSI;
     |SI #0#17="2"; |O #0#17 = "4"; |O #0#17 = "6";
          |CAMPO_MODIFICA #0#7,1,AS;    ||Incremento 2
          |CAMPO_MODIFICA #0#11,1,AS;   ||
          |CAMPO_MODIFICA #0#15,1,AS;   ||
     |FINSI;
     |SI #0#17="3"; |O #0#17 = "5"; |O #0#17 = "6";
          |CAMPO_MODIFICA #0#8,1,AS;   ||
          |CAMPO_MODIFICA #0#12,1,AS;   ||
          |CAMPO_MODIFICA #0#16,1,AS;   ||
     |FINSI;
     |SI #0#17="7";       ||TODOS
          |CAMPO_MODIFICA #0#6,1,AS;    ||Incremento 1
          |CAMPO_MODIFICA #0#7,1,AS;    ||Incremento 2
          |CAMPO_MODIFICA #0#8,1,AS;    ||Incremento 3
          |CAMPO_MODIFICA #0#28,1,AS;    ||Incremento 4
          |CAMPO_MODIFICA #0#29,1,AS;    ||Incremento 5
          |CAMPO_MODIFICA #0#30,1,AS;    ||Incremento 6
          |CAMPO_MODIFICA #0#10,1,AS;   ||PVP
          |CAMPO_MODIFICA #0#11,1,AS;   ||
          |CAMPO_MODIFICA #0#12,1,AS;   ||
          |CAMPO_MODIFICA #0#31,1,AS;   ||
          |CAMPO_MODIFICA #0#32,1,AS;   ||
          |CAMPO_MODIFICA #0#33,1,AS;   ||
          |CAMPO_MODIFICA #0#14,1,AS;   ||IVAS
          |CAMPO_MODIFICA #0#15,1,AS;   ||
          |CAMPO_MODIFICA #0#16,1,AS;   ||
          |CAMPO_MODIFICA #0#34,1,AS;   ||
          |CAMPO_MODIFICA #0#35,1,AS;   ||
          |CAMPO_MODIFICA #0#36,1,AS;   ||
     |FINSI;
     |SI #0#17="8";       || Ningumo
     |FINSI;
|FPRC;

|PROCESO suma2;
     || A partir del precio inicial le cargo los posibles cargos que hayan
     || por diversos costes (Grua, Varios, etc...)
     #0#2=#0#18+#0#19+#0#20+#0#21;
     |PINTA #0#2;
|FPRC;


|| Pinta los titulos de los costes informados en AGIFA204
|PROCESO titulos;|TIPO 7;
    |SI nprimera = 0;
       nprimera=1;
       |ABRE #agifa204;
        #agifa204#0="A";
        |LEE 001#agifa204.=;
        |SI FSalida =0;
             |PINTA 0949,#agifa204#1;    || Titulos
             |PINTA 1049,#agifa204#2;
             |PINTA 1149,#agifa204#3;
             |PINTA 1849,#agifa204#4;
             |PINTA 1949,#agifa204#5;
             |PINTA 2049,#agifa204#9;
        |FINSI;
      |CIERRA #agifa204;
      |FINSI;
|FPRC;

|PROCESO dtos; |TIPO 0;
     #0#25 = #0#2 < #0#3;
     #0#25 = #0#25 < #0#4;
     #0#25 = #0#25 < #0#37;
     |PINTA #0#25;
|FPRC;

|PROCESO suma3; |TIPO 0;
     #0#5 = #0#25 + #0#22 + #0#23 + #0#24;
     |PINTA #0#5;
|FPRC;

|PROCESO Llena561; |TIPO 6;
     enAlta = 1;
     eaArticulo = #0Campo;
     |HAZ LlenaArticulo;
     |SI FSalida = 0;
          #0Campo = eaArticulo;
          |PINTA #0Campo;
     |SINO;
          |ERROR; |ACABA;
     |FINSI;
|FPRC;
