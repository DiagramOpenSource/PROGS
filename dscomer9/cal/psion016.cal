/*
                    ANULADO

|FICHEROS;
     agifa019 #1;
     agifa017 #2;
     agifa112 #3;
     agifa027 #4;
     agifa065 #9;
     agifa142 #10;
     psion015 #11;
     agifa029 #12;
     dsm00024 #24;
|FIN;

|VARIABLES;
 uni = 0;
 suma = 0;
 suma1 = 0;
 pelas = 0;
 mes = 0;
 clave = "";
 operacion = "";
 orden = 1;
 sto = 0;
 sto1 = 0;
 fmes = "";
 fecha = @;
 codigo = "";
|FIN;

|INCLUYE i_varart;

|CALCULO cuenta;
     |ABRE #4;
     #4#0 = clave;
     |LEE 140#4=;
     |LIBERA #4;
     |SI FSalida ! 0;
         #4#0 = clave;
         #4#1 = 1;
         |GRABA 020#4c;
         |LIBERA #4;
     |FINSI;
     codigo =  #4#1;
     #4#1 = #4#1 + 1;
     |GRABA 020#4a;
     |LIBERA #4;
     |CIERRA #4;
|FCAL;

|CALCULO altahis;|TIPO 0;
orden = 1;
|SI #11#4 = "E";
    clave = "entrada";
|FINSI;
|SI #11#4 = "S";
    clave = "salida";
|FINSI;
|SI #11#4 = "T";
    clave = "movimiento";
|FINSI;
|HAZ cuenta;
|ABRE #9;
|DDEFECTO #9;
#9#0 = #11#0;
#9#1 = #11#5;       ||fecha de entrada;
|SI #11#4 = "E";
    operacion ="ES";
    uni = #11#3
|FINSI;
|SI #11#4 = "S";
    operacion ="SS";
    uni = #11#3 * (-1);
|FINSI;
|| ------ Entradas/Salidas Almacenes ------
|SI #11#4 = "E";|O #11#4 = "S";
    #9#2 = operacion;
    #9#3 = codigo;
    #9#4 = orden;
    |ABRE #12;
    #12#0 = #11#2;
    |LEE 101#12=;
    |LIBERA #12;
    |SI FSalida ! 0;
        |GRABA 001#12n;
        |LIBERA #12;
    |FINSI;
    |LIBERA #12;
    |CIERRA #12;
    #9#5 = #11#2;        || almacen
    #9#6 = uni;
    #9#7 = #1#6;
    #9#8 = #1#9;
    #9#9 = 0;
    #9#12 = 0;
    #9#13 = 0;
    #9#14 = 0;
    #9#18 = #11#9;
    |GRABA 121#9n;
    |LIBERA #9;
    |CIERRA #9;
|FINSI;

|| ------------- Traspaso Entre Almacenes -----------
|| -------- Entrada Traspaso Entre Almacenes --------
|SI #11#4 = "T";
    #9#2 = "ME";
    #9#3 = codigo;
    #9#4 = orden;
    |ABRE #12;
    #12#0 = #11#8;
    |LEE 101#12=;
    |LIBERA #12;
    |SI FSalida ! 0;
        |GRABA 001#12n;
        |LIBERA #12;
    |FINSI;
    |LIBERA #12;
    |CIERRA #12;
    #9#5 = #11#8;        || almacen entrada traspaso
    uni = #11#3
    #9#6 = uni;
    #9#7 = #1#6;
    #9#8 = #1#9;
    #9#9 = 0;
    #9#12 = 0;
    #9#13 = 0;
    #9#14 = 0;
    #9#18 = #11#9;
    |GRABA 121#9c;
    |LIBERA #9;

    || -------- Salida Traspaso Entre Almacenes --------
    #9#2 = "MS";
    #9#3 = codigo;
    #9#4 = orden;
    |ABRE #12;
    #12#0 = #11#7;
    |LEE 101#12=;
    |LIBERA #12;
    |SI FSalida ! 0;
        |GRABA 001#12n;
        |LIBERA #12;
    |FINSI;
    |LIBERA #12;
    |CIERRA #12;
    #9#5 = #11#7;        || almacen salida traspaso
    uni = #11#3 * (-1);
    #9#6 = uni;
    #9#7 = #1#6;
    #9#8 = #1#9;
    #9#9 = 0;
    #9#12 = 0;
    #9#13 = 0;
    #9#14 = 0;
    #9#18 = #11#9;
    |GRABA 121#9c;
    |LIBERA #9;
|FINSI;
|LIBERA #9;
|CIERRA #9;
|FCAL;

|PROCESO EntraTras;
     |SI #11#4 = "T";
         #2#0 = #11#0;
         #2#1 = #11#8;
     |FINSI;
     |LEE 101#2=;
     |SI FSalida ! 0; |GRABA 020#2b; |FINSI;
     |DDEFECTO #24;
     #24#0 = #2#0;
     #24#1 = #2#1;
     #24#2 = #11#9;
     |LEE 101#24=;
     |SI FSalida ! 0; |GRABA 020#24b; |FINSI;

     #2#39 = #2#39 + #11#3;
     #2#5 = #2#5 + #11#3;
     #1#104 = #1#104 + #11#3;
     #1#6 = #1#6 + #11#3;
     #24#9 = #24#9 + #11#3;
     #24#22 = #24#22 + #11#3;

     pelas = 0;
     fecha = #11#5;
     fmes = fecha % A402;
     suma = 12;
     mes = fmes - 1;
     mes = mes * 2;
     mes = mes + suma;
     #2mes = #2mes + #11#3;
     #2#36 = #2#36 + #11#3;

     |HAZ ValoraStock;
     |GRABA 020#1a;
     |GRABA 020#2a;
     |GRABA 020#24a;
     |LIBERA #1;
     |LIBERA #2;
     |LIBERA #24;

      efFecha = #11#5;
      eaArticulo = #2#0;
      enAlmacen = #2#1;
      enUniEnt = #11#3;
      |HAZ AcumulaAlm;
|FPRC;

|PROCESO SalTras;
     |SI #11#4 = "T";
         #2#0 = #11#0;
         #2#1 = #11#7;
     |FINSI;
     |LEE 101#2=;
     |SI FSalida ! 0; |GRABA 010#2b; |FINSI;
     |DDEFECTO #24;
     #24#0 = #2#0;
     #24#1 = #2#1;
     #24#2 = #11#9;
     |LEE 101#24=;
     |SI FSalida ! 0; |GRABA 020#24b; |FINSI;

     #2#39 = #2#39 - #11#3;
     #2#5 = #2#5 - #11#3;
     #1#104 = #1#104 - #11#3;
     #1#6 = #1#6 - #11#3;
     #24#11 = #24#11 + #11#3;
     #24#22 = #24#22 - #11#3;

     pelas = 0;
     fecha = #11#5;
     fmes = fecha % A402;
     suma = 11;
     mes = fmes - 1;
     mes = mes * 2;
     mes = mes + suma;
     #2mes = #2mes + #11#3;
     #2#35 = #2#35 + #11#3;

     |HAZ ValoraStock;
     |GRABA 020#1a;
     |GRABA 020#2a;
     |GRABA 020#24a;
     |LIBERA #1;
     |LIBERA #2;
     |LIBERA #24;

     efFecha = #11#5;
     eaArticulo = #2#0;
     enAlmacen = #2#1;
     enUniSal = #11#3;
     |HAZ AcumulaAlm;
|FPRC;

|CALCULO salida;
     #1#0 = #11#0;
     |LEE 121#1=;
     |SI 0 = FSalida;
          |DDEFECTO #2;
          #2#0 = #11#0;
          #2#1 = #11#2;
          |SI #11#4 ="E";|O #11#4 = "T";
               |HAZ EntraTras;
          |FINSI;
          |SI #11#4 ="S";|O #11#4 = "T";
               |HAZ SalTras;
          |FINSI;
          |HAZ altahis;
     |FINSI;
|FCAL;

|DEFBUCLE proceso;
     #11#1;
     ;
     0;
     9999;
     e;
     NULL,salida;
|FIN;

|PROGRAMA;
     |ABRE #1;
     |ABRE #2;
     |ABRE #3;
     |ABRE #24;
     |BUCLE proceso;
     |CIERRA #24;
     |CIERRA #3;
     |CIERRA #2;
     |CIERRA #1;
|FPRO;
*/
