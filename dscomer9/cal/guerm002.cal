|FICHEROS;
     guerm002 #0; || Este
     guerm001 #1; || Cabecera
     guerm005 #5;
     agifa023 #23;
     agifa024 #24;
     agifa019 #19;
     comunica #100;
     guerm011 #11;
|FIN;

|VARIABLES;
     aResul    = "";
     nHandle   = 0;
     aFic      = "":
     nCuenta   = 0;
     nLinea    = 0;
     nBytes    = 0;
     nNum      = 0;
     &sumalin  = 0;
     &programa = 1;
     &EURODB   = 0;
     &estoyen   = "";
     nPrecio   = 0;
     aPuerto   = "";
     aParidad  = "";
     nVelocidad= 0;
     nBits     = 0;
     nStop     = 0;
     nSw       = 0;
     i         = 0;
     j         = 0;
     nPos      = 0;
     aLon      = "";
     aAlfa     = "";
     aHandle   = "";
     aValor    = "";
     aInicio   = "";
     aFin      = "";
     niDato    = 0;
     aDato     = "";
     nNumValores = 0;
   {200}pValor  = "";
     nVueltas  = 0;
     nNume = 0;
     nMaximo  = 0;
     nPara1 = 0;
     nSwEspa = 0;
     bruto     = 0;
     descu     = 0;
|FIN;


|PROCESO camion;
     |HAZ Bascula;
     |SI #0#7 ! 0;
         |SI #0#7 < #1#13;
             |MENAV "      ATENCION PESO INFERIOR A LA TARA";
             |ERROR;
             |ACABA;
         |FINSI;
         #0#4 = #0#7 - #1#13;
         |PINTA #0#4;
     |FINSI;
|FPRC;

|PROCESO total; |TIPO 0;
  |SI FSalida = 9;
      |CAMPO_MODIFICA #0#5, 1, "S";
      |CAMPO_MODIFICA #0#8, 1, "S";
  |FINSI;
  bruto = ((#0#4 / 1000) * #0#5) ! EURODB;
  descu = (bruto % #0#8) ! EURODB;;
  #0#6 = bruto - descu;
  |PINTA #0#6;
|FPRC;

|PROCESO alsalir1;
  |CAMPO_MODIFICA #0#5, 1, "N";
|FPRC;

|PROCESO alsalir2;
  |CAMPO_MODIFICA #0#8, 1, "N";
|FPRC;

|PROCESO suma; |TIPO 2;
  sumalin = sumalin +. #0#6;
  #1#33 = #1#33 +. #0#7;
  #1#34 = #1#34 +. #0#4;

  #1#20 = sumalin;
  #1#22 = #1#20 - #1#21;
  #1#23 = ((#1#22 * #1#14) / 100) ! EURODB;
  #1#24 = #1#22 + #1#23;
  |SI #1#15 = "A";
       #1#21 = 0;
       #1#22 = 0;
       #1#23 = 0;
       #1#24 = 0;
  |FINSI;
  |SI #1#15 = "T";
      #1#23 = 0;
      #1#24 = #1#22;
  |FINSI;
  |PINTA #1#20;
  |PINTA #1#33;
  |PINTA #1#34;
  |SI programa = 1;
      |PINTA #1#22;
      |PINTA #1#23;
      |PINTA #1#24;
  |FINSI;
|FPRC;

|PROCESO articuloficina;
  |ABRE #11;
  #11#0 = #1#3;
  #11#1 = #1#29;
  #11#2 = #0#2;
  |LEE 101#11=;
  |SI FSalida ! 0;
      |DDEFECTO #11;
      #11#0 = #1#3;
      #11#1 = #1#29;
      #11#2 = #0#2;
      #11#3 = #1#4;
      #11#4 = #1#30;
      #11#5 = #0#3;
      |PUSHV 0501 2380;
      |PINPA #0#11;
      |PINDA #0#11;
      |ENDATOS #1#11;
      |SI FSalida = 0;
          #0#5 = #11#6;
          #0#8 = #11#7;
          |GRABA 101#11n;
      |SINO;
          |MENAV "     ARTICULO CLIENTE OBRA INEXISTENTE";
          |ERROR;
      |FINSI;
      |POPV;
  |FINSI;
  |CIERRA #11;
  #0#5 = #11#6;
  #0#8 = #11#7;
  |PINTA #0#5;
  |PINTA #0#8;
|FPRC;

|PROCESO Precio; |TIPO 0;

  |SI estoyen = "O";
      |HAZ articuloficina;
      |ACABA;
  |FINSI;

     |SI #0Campo = Contenido; |ACABA; |FINSI;

     |ABRE #24;
     #24#0 = #1#3;
     |LEE 000#24=;
     |CIERRA #24;

     |ABRE #23;
     #23#0 = #24#0;
     #23#1 = #0#2;
     |LEE 000#23=;
     |SI FSalida = 0; |Y #23#28 ] #1#1; |Y #23#29 [ #1#1;
          nPrecio = #23#2;
     |SINO;
          |ABRE #19;
          #19#0 = #0#2;
          |LEE 000#19=;
          |SI FSalida = 0;
               |SI #24#39 = 1; nPrecio = #19#18; |FINSI;
               |SI #24#39 = 2; nPrecio = #19#19; |FINSI;
               |SI #24#39 = 3; nPrecio = #19#20; |FINSI;
               |SI #24#39 = 4; nPrecio = #19#147; |FINSI;
               |SI #24#39 = 5; nPrecio = #19#148; |FINSI;
               |SI #24#39 = 6; nPrecio = #19#149; |FINSI;
          |FINSI;
          |CIERRA #19;
     |FINSI;
     |CIERRA #23;
     #0#5 = nPrecio;
     |PINTA #0#5;
|FPRC;

|PROCESO PintaDato;
     |SI #5#18 ! "S"; |ACABA; |FINSI;
     |SI nLinea > 1600; |O nLinea = 0;
          nLinea = 0602;
     |FINSI;

     aAlfa = aDato + aValor; |QBF aAlfa;
     |SI aAlfa ! "";
          aAlfa = "Valor:" + aValor + " Dato:" + aDato;
          |PINTA nLinea, aAlfa;
          nLinea = nLinea + 100;
     |FINSI;
|FPRC;


|RUTINA sacavalor;
    nPos = (#5#21 * 100 + #5#22);
    aValor = aResul % nPos;              || Peso
    |QBT aValor;
    nPos = 100 + #5#24;
    aValor = aValor % nPos;
|FRUT;

|PROCESO Bascula_ANTIGUA; |TIPO 0;      ||| NO VALE
     |SI FSalida = 13;
          |ET Pesa;
          nMaximo = 0;
          #0#7 = 0;
          |SUB_EJECUTA_NP "comunica;guerola";

          |ABRE #100; |LEE 000#100p; |CIERRA #100;
          aFic = #100#8; |QBF aFic;

          |ABRE #5; |LEE 000#5p; |CIERRA #5;
          nNum = #5#15; aInicio = &nNum;
          nNum = #5#16; aFin = &nNum;
          nSw = 0; nCuenta = 0;
          aValor = "";
          aDato = "";
          nNumValores = 0;
          IpValor  = pValor1<-;

          |XABRE "B", aFic, nHandle;
          |SI FSalida ] 0;

           |ET Otra;
               |SI nNumValores ] 200;
                  |VETE SalFuera;
               |FINSI;
               |XLEE nHandle, 1, aValor;
               |SI FSalida = 0; |VETE SalFuera; |FINSI;

               |SI aValor = aInicio; |Y nSw = 0;
                    nSw = 1;
                    |VETE Otra;
               |FINSI;
               |SI aValor = "q"; |Y nSw = 1;
                    aDato = aDato + aValor;
                    nSw = 2;
                    |VETE Otra;
               |FINSI;
               |SI aValor = "0"; |Y nSw = 2;
                    aDato = aDato + aValor;
                    nSw = 3;
                    |VETE Otra;
               |FINSI;
               |SI nSw ! 3;
                    aDato = "";
                    nSw = 0;
                    |VETE Otra;
               |FINSI;

               |SI aValor = aInicio;
                    aDato = "";
                    nSw = 1;
                    |VETE Otra;
               |FINSI;

               |SI aValor ! aFin;
                    |SI nSw = 3;
                         aDato = aDato + aValor;
                    |FINSI;
                    |VETE Otra;
               |FINSI;


               aResul = aDato;
               |HAZ sacavalor;
               nNume = aValor;
               |SI nNume = 0;
                   aDato = "";
                   nSw = 0;
                   |VETE Otra;
               |FINSI;
            nNume = nNume $ 20; || ajusta a multiplo de 20
            |SI nNume ! 0;
                aDato = "";
                nSw = 0;
                |VETE Otra;
            |FINSI;
               |SI nMaximo < aValor;
                   nMaximo = aValor;
               |FINSI;
               pValor = aValor;
               IpValor = IpValor + 1;
               nNumValores = nNumValores + 1;
               aDato = "";
               nSw = 0;
               |VETE Otra;
          |FINSI;
       |ET SalFuera;
          |XCIERRA nHandle;

          |SI nMaximo = 0;
               |ERROR;
               |MENAV "0000Sin Lectura Valida ...";
          |SINO;
               aValor = nMaximo;
               #0#7 = aValor;
               |PINTA #0#7;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Bascula; |TIPO 0;         || Proceso nuevo por cambio bascula
     |SI FSalida = 13;
          nMaximo = 0;
          #0#7 = 0;
          |SUB_EJECUTA_NP "comunica;guerola";

          |ABRE #100; |LEE 000#100p; |CIERRA #100;
          aFic = #100#8; |QBF aFic;

          |ABRE #5; |LEE 000#5p; |CIERRA #5;
          nNum = #5#15; aInicio = &nNum;
          nNum = #5#16; aFin = &nNum;
          nSw = 0; nCuenta = 0;
          aValor = "";
          aDato = "";
          nNumValores = 0;
          IpValor  = pValor1<-;

          |XABRE "B", aFic, nHandle;
          |SI FSalida ] 0;

           |ET Otra1;
               |SI nNumValores ] 200;
                   |VETE SalFuera1;
               |FINSI;
               |XLEE nHandle, 1, aValor;
               |SI FSalida = 0; |VETE SalFuera1; |FINSI;

               |SI aValor = aInicio;
                    aDato = "";
                    nSw = 1;
                    |VETE Otra1;
               |FINSI;
               |SI aValor ! aFin;
                    aDato = aDato + aValor;
                    |VETE Otra1;
               |FINSI;
               |SI nSw = 0; |VETE Otra1; |FINSI;

               aResul = aDato;
               |HAZ sacavalor;
               nNume = aValor;
               |SI nNume = 0;
                   aDato = "";
                   nSw = 0;
                   |VETE Otra1;
               |FINSI;

               nNume = nNume $ 20; || ajusta a multiplo de 20
               |SI nNume ! 0;
                    aDato = "";
                    nSw = 0;
                    |VETE Otra1;
               |FINSI;

               |SI nMaximo < aValor;
                   nMaximo = aValor;
               |FINSI;
               pValor = aValor;
               IpValor = IpValor + 1;
               nNumValores = nNumValores + 1;
               aDato = "";
               nSw = 0;
               |VETE Otra1;
          |FINSI;
       |ET SalFuera1;
          |XCIERRA nHandle;

          |SI nMaximo = 0;
               |ERROR;
               |MENAV "0000Sin Lectura Valida ...";
          |SINO;
               aValor = nMaximo;
               #0#7 = aValor;
               |PINTA #0#7;
          |FINSI;
     |FINSI;
|FPRC;
