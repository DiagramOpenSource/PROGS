|FICHEROS;
     dsm00079 #0;
     dsm00080 #80;
     agifa505 #505;
     agifa509 #509;
|FIN;

|VARIABLES;
     &enNumCaja= 0;
     nLin      = 0;
     aHora     = "";
     aEmpre    = "";
|FIN;

|PROCESO Historico;
     |ABRE #80;
     #80#0 = #509#0;
     #80#1 = #509#1;
     #80#2 = 999;
     |LEE 000#80];
     |SI FSalida = 0;
          |LEE 000#80a;
     |SINO;
          |LEE 000#80u;
     |FINSI;
     |SI FSalida = 0; |Y #80#0 = #509#0; |Y #80#1 = #509#1;
          nLin = #80#2 + 1;
     |SINO;
          nLin = 1;
     |FINSI;

     |HORA aHora;

     |DDEFECTO #80;
     #80#0 = #509#0;
     #80#1 = #509#1;
     #80#2 = nLin;
     #80#3 = #0#2;
     #80#4 = #0#1;
     #80#5 = Usuario % 810;
     #80#6 = aHora;
     #80#7 = #0#3;
     |GRABA 020#80n;
     |CIERRA #80;
|FPRC;

|PROCESO Tipo3; |TIPO 3;
     |SI #0#2 = 0; |ACABA; |FINSI;

     |DFICE aEmpre;
     aEmpre = aEmpre % -205;

     |ABRE #505;
     |ABRE #509;
     #505#0 = #0#0;
     |LEE 020#505=;
     |SI FSalida = 0;
          |SI #505#23 = "S";
               #509#63 = aEmpre;
               #509#0 = #505#0;
               #509#1 = #505#24;
               |LEE 101#509=;
               |SI FSalida = 0;
                    #509#108 = #509#108 + #0#2;
                    #509#55 = #509#55 - #0#2;
                    |SI #509#55 > 0;
                         |GRABA 020#509a;
                         |HAZ Historico;
                    |SINO;
                         |MENAV "0000El importe SUPERA el efectivo de la caja...";
                    |FINSI;
               |SINO;
                    |MENAV "0000NO EXISTE Resumen Caja...";
               |FINSI;
          |SINO;
               |MENAV "0000Caja CERRADA...";
          |FINSI;
     |FINSI;
     |CIERRA #509;
     |CIERRA #505;
|FPRC;

|PROCESO Defecto; |TIPO 7;
     |SI #0#0 = 0;
          |ABRE #505;
          |LEE 000#505p;
          |CIERRA #505;
          #0#0 = #505#0;
          |HAZ EsIber21;
          |SI FSalida = 0;
               enNumCaja = #0#0;
               |HAZ CajaDefecto;
               #0#0 = enNumCaja;
          |FINSI;
     |FINSI;
|FPRC;
