|FICHEROS;
     con00623 #0;
     con00670 #1;
     con00673 #673;
     con00690 #690;

     agifa134 #20;
     agifa059 #21;
     agifa024 #24;
     agifa091 #50;
     dsz99984 #51;
     agifa133 #52;
     agis0002 #53;
     agifa177 #54;
     agifa142 #55;

     Refere1@ #1000;
|FIN;

|VARIABLES;
     &aMoneda = "";
     &aDivisa = "";
     modo     = 0;
     nFlag    = 0;
     aInf     = "";
     aAlfa    = "";
     aAlfaX   = "";
|FIN;

|PROCESO baja; |TIPO 2;
modo = (FEntrada / 100 ) ! 0;
nFlag = 0 +. 1;
|SI modo = 3;
     |ABRE #1;
     |SELECT #3#1;
     #1#31 = #0#0;
     #1#32 = #0#1;
     |LEE 021#1=;
     |SI FSalida = 0;
          #1#31 = "";
          #1#32 = 0;
          |GRABA 021#1a;
     |FINSI;
     |LIBERA #1;
     |CIERRA #1;
|FINSI;

|ABRE #20;
|SI nFlag < 0;
   |HAZ BorraFactVenta;
|SINO;
   |HAZ CreaFactVenta;
|FINSI;
|CIERRA #20;
|FPRC;

|PROCESO BorraVinculoEntrega;
   |ABRE #agis0002; |SELECT #4#agis0002;
   #agis0002#34 = #agifa134#49;
   #agis0002#35 = #agifa134#0;
   |LEE 101#agis0002.=;
   |SI FSalida = 0;
      #agis0002#34 = "";
      #agis0002#35 = 0;
      |GRABA 020#agis0002.a; |LIBERA #agis0002;
   |FINSI;
   |LIBERA #agis0002;
   |SELECT #1#agis0002; |CIERRA #agis0002;
|FPRC;

|PROCESO BorraFactVenta;
   |ABRE #20;
   |ABRE #21;
   #20#0 = #0#1;
   #20#49 = #0#0;
   |HAZ BorraRecVenta;

   #20#49 = #0#0;
   #20#0 = #0#1;
   |HAZ BorraVinculoEntrega;

   #20#49 = #0#0;
   #20#0 = #0#1;
   |BORRA 001#20c;

   #21#0 = #0#1;
   #21#1 = 1;
   #21#14 = #0#0;
   |BORRA 001#21c;
   |LIBERA #20;
   |LIBERA #21;
   |CIERRA #20;
   |CIERRA #21;
|FPRC;

|PROCESO CreaFactVenta;
     aMoneda = "B"
     aDivisa = "EUR";
     |HAZ Divisas134;
     |ABRE #20;
     |ABRE #21;
     |ABRE #agifa024;

     #agifa024#0 = #0#3;
     |LEE 000#agifa024.=;
     |SI FSalida ! 0; |DDEFECTO #agifa024; |FINSI;

     |DDEFECTO #20;
     #20#0 = #0#1;
     #20#1 = #0#2;
     #20#2 = #0#3;
     #20#3 = #0#4;
     #20#12 = #agifa024#16;
     #20#49 = #0#0;

     #20#47 = #0#6; ||Exenta

     #20#18 = #0#7 + #0#6; ||Bruto
     #20#65 = #20#18;
     #20#88 = #20#18;

     #20#21 = #0#7; ||Base1
     #20#68 = #20#21;
     #20#91 = #20#21;

     #20#22 = #0#10;||Cuota1
     #20#69 = #20#22;
     #20#92 = #20#22;

     #20#29 = #0#10; ||T.IVA
     #20#76 = #20#29;
     #20#99 = #20#29;

     #20#31 = #0#11; ||T.Fac
     #20#78 = #20#31;
     #20#101 = #20#31;

     #20#39 = #0#9;  ||%iva1

     #20#58 = "EUR";
     #20#59 = 1;
     #20#60 = "B";
     #20#61 = "EUR";
     #20#62 = 1;

     |GRABA 001#20c;
     |LIBERA #20;
     |HAZ VenciVta; |HAZ CreaRecibos;
     |CIERRA #20;
     #21#0 = #0#1;
     #21#1 = 1;
     #21#14 = #0#0;
     |GRABA 001#21n;
     |LIBERA #21;
     |CIERRA #21;
     |CIERRA #agifa024;
|FPRC;

|VARIABLES;
   &eaProg = "";
   &enAcuenta = 0;

   nVto = 0;
|FIN;

|PROCESO CreaRecibos;
     |ABRE #agifa133;
     |ABRE #agis0002;
     |ABRE #agifa177;
     |ABRE #agifa091;
     |ABRE #agifa142;

     |LEE 000#agifa142.p;
     |SI FSalida ! 0; |DDEFECTO #agifa142; |FINSI;

     #agifa024#0 = #agifa134#2;
     |LEE 000#agifa024.=;
     |SI FSalida ! 0; |DDEFECTO #agifa024; |FINSI;

     #agifa091#0 = #agifa134#11;
     |LEE 000#agifa091.=;
     |SI FSalida ! 0; |DDEFECTO #agifa091; |FINSI;

     nVto = 0;
     #agifa133#0 = #agifa134#0;
     #agifa133#4 = #agifa134#49;
     #agifa133#1 = 0;
     |LEE 000#agifa133.];
     |PARA ; |SI FSalida = 0; |Y #agifa133#0 = #agifa134#0;|Y #agifa133#4 = #agifa134#49; |HACIENDO;
          nVto = nVto + 1;
          |LEE 000#agifa133.s;
     |SIGUE;

     |HAZ AbreRecVenta;

     #agifa133#0 = #agifa134#0;
     #agifa133#4 = #agifa134#49;
     #agifa133#1 = 0;
     |LEE 000#agifa133.];
     |PARA ; |SI FSalida = 0; |Y #agifa133#0 = #agifa134#0;|Y #agifa133#4 = #agifa134#49; |HACIENDO;
          |SI #agifa133#5 = "S";
               |DDEFECTO #agis0002;
               #agis0002#30 = "A";       || busca como albaran
               #agis0002#20 = #agifa133#6;     || Serie pedido.
               #agis0002#17 = #agifa133#7;     || Numero pedido.
               #agis0002#18 = #agifa133#8;     || Numero recibo.
               |LEE 000#agis0002.=;
               |SI FSalida ! 0;
                    #agis0002#30 = "P";       || busca como pedido
                    |LEE 000#agis0002.=;
               |FINSI;
          |FINSI;
          |DDEFECTO #dsz99984;
          #dsz99984#17 = #agifa134#49;
          #dsz99984#0 = #agifa134#0;
          #dsz99984#1 = #agifa133#1;           || Linea;
          #dsz99984#2 = #agifa134#2;           || cliente
          #dsz99984#3 = #agifa134#3;           || nombre del cliente
          #dsz99984#4 = #agifa134#9;           || Banco
          #dsz99984#5 = "S";                   || domiciliado
          #dsz99984#6 = "N";                   || aceptado
          #dsz99984#7 = #agifa134#1;           || fecha de emision
          #dsz99984#8 = #agifa133#3;           || Fecha de vencimiento
          #dsz99984#9 = #agifa133#2;           || Importe
          |SI #agifa133#5 = "S";
               #dsz99984#10 = #agis0002#10;
               #dsz99984#11 = #agis0002#11;
          |SINO;
               #dsz99984#10 = "N";            || Impreso
               #dsz99984#11 = "N";            || Contabilizado
          |FINSI;
          |SI #agifa142#63 = "S";     ||  COGE LA CTA.CONTABLE DEL TIPO DE RECIBO.
               #agifa177#0 = #agifa091#69;
               |LEE 000#agifa177.=;
               |SI FSalida = 0;
                    #dsz99984#12 = #agifa177#3;     || NUMERO CTA.CONTABLE.
               |SINO;
                    #dsz99984#12 = #agifa134#12;     || NUMERO CTA.CONTABLE.
               |FINSI;
          |SINO;
               #dsz99984#12 = #agifa134#12;     || NUMERO CTA.CONTABLE.
          |FINSI;
          #dsz99984#13 = #agis0002#13;
          #dsz99984#16 = #agis0002#16;
          #dsz99984#22 = "Cobrado";
          #dsz99984#24 = #agifa134#11;          || Forma de Pago
          #dsz99984#25 = #agifa091#1;           || Descripcion de la forma de Pago
          #dsz99984#14 = "N";            || Impagado
          #dsz99984#15 = #agifa024#161;         || A aceptar
          |SI #agifa133#5 = "S";
               #dsz99984#21 = #agis0002#22;         || Tipo de Recibo (entr.a cta.)
          |SINO;
               #dsz99984#21 = #agifa091#69;          || Tipo de Recibo (forma de pago)
          |FINSI;
          #dsz99984#23 = nVto;
          #dsz99984#24 = #agifa091#0;
          #dsz99984#25 = #agifa091#1;
          eaProg = "agifa134";
          |HAZ RecVenta;
          |LEE 000#agifa133.s;
     |SIGUE;
     |HAZ CierraRecVenta;

     #agifa133#0 = #agifa134#0;
     #agifa133#4 = #agifa134#49;
     #agifa133#1 = 0;
     |LEE 101#agifa133.];
     |PARA ; |SI FSalida = 0; |Y #agifa133#0 = #agifa134#0;|Y #agifa133#4 = #agifa134#49; |HACIENDO;
          #dsz99984#17 = #agifa133#4;
          #dsz99984#0 = #agifa133#0;
          #dsz99984#1 = #agifa133#1;
          eaProg = "agifa134";
          |HAZ LeeRecVenta;
          #agifa134#32 = #agifa134#32 + enAcuenta;
          #agifa133#2 = #agifa133#2 - enAcuenta;
          |GRABA 020#agifa133.a;
          |LIBERA #agifa133;
          |LEE 101#agifa133.s;
     |SIGUE;
     |LIBERA #agifa133;

     |CIERRA #agifa091;
     |CIERRA #dsz99984;
     |CIERRA #agifa133;
     |CIERRA #agis0002;
     |CIERRA #agifa177;
|FPRC;

|PROCESO Lineas;
     |PRINT;
|FPRC;

|DEFBUCLE Lineas;
     #673#1;
     10;
     #0#5, #0#14, 001, "S";
     #0#5, #0#14, 999, "S";
     ;
     NULL, Lineas;
|FIN;

|PROCESO Tipo4; |TIPO 4;
     |ABRE #690;
     #690#0 = #0#0;
     |LEE 000#690=;
     |CIERRA #690;
     aInf = #690#8; |QBF aAlfa;

     |IMPRE 0;
     |SI FSalida = 0;
          |INFOR aInf;
          |SI FSalida ! 0;
               aAlfa = "0000No existe Informe: " + aInf;
               |MENAV aAlfa;
          |SINO;
               |BUCLE Lineas;
               |PIEINF;
               |FININF;
          |FINSI;
          |FINIMP;
     |FINSI;
|FPRC;

|PROCESO Tipo13_623; |TIPO 13;
     |HAZ TallerDeci;
|FPRC;
