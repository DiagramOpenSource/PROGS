|FICHEROS;
     diapre04  #0;
     diapre01  #1;
     diapre02  #2;

     diam0003  #3;
     agifa024  #24;
     agifa104  #104;
     agisys@   #100;
|FIN;

|VARIABLES;
     &Tempo = "";
     aTmp1 = "";
     aTmp2 = "";
     aAlfa     = "";
     aAlfa1    = "";
     aAlfa2    = "";
     aAlfa3    = "";
     aAlfa4    = "";
     aAlfa5    = "";
     aAlfa6    = "";
     aSoft     = "";
     aHard     = "";
     aBase     = "";
     aAbre     = "";

     nHandle   = 0;
|FIN;

/*
|PROCESO diam0003;
     |SI #3#6 = "A";
          |SI #104#25 ! #3#0; |O #104#0 ! #3#1;
               #104#25 = #3#0;
               #104#0 = #3#1;
               |LEE 000#104=;
               |SI FSalida = 0;
                    #2#0 = #104#25;
                    #2#1 = #104#0;
                    #2#2 = #104#1;
                    #2#3 = #104#4;
                    #2#4 = #104#45;
                    #2#5 = #104#8;
                    |GRABA 000#2n;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE diam0003;
     #3#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, diam0003;
|FIN;
*/

/*
|PROCESO agisys;
     |SI #agisys@#4 ! "01";        || la seccion "01" es baja
          |SI #agisys@#1 = "S";    aSoft = "S";   |FINSI;
          |SI #agisys@#1 = "H";    aHard = "S";   |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE agisys;
     #agisys@#2002;
     28;
     #agifa024#0,      1, "S";          || vigente SI
     #agifa024#0, 999999, "S";
     ;
     NULL, agisys;
|FIN;
*/

|PROCESO agisys;
    |SI #agisys@#1 = "S";    aSoft = "S";   |FINSI;
    |SI #agisys@#1 = "H";    aHard = "S";   |FINSI;
|FPRC;

|DEFBUCLE agisys;
     #agisys@#2002;
     ;
     #agifa024#0,      1;          || todos
     #agifa024#0, 999999;
     ;
     NULL, agisys;
|FIN;

|PROCESO diapre04;
     |DDEFECTO #24;
     #24#0 = #1#0;
     |LEE 000#24=;
     |SI FSalida = 0;
||          aAlfa = #24#163; |QBF aAlfa;
||          |SI aAlfa = "XX";
||               |BORRA 020#1a;
||          |FINSI;
          aSoft = "N";
          aHard = "N";
          |BUCLE agisys;
          |SI aSoft = "N"; |Y aHard = "N";
               |BORRA 020#1a;
          |FINSI;
     |SINO;
          |BORRA 020#1a;
     |FINSI;
|FPRC;

|DEFBUCLE diapre04;
     #1#1;
     ;
     INICIO;
     FINAL;
     be;
     NULL, diapre04;
|FIN;

|PROCESO agifa024;
||     aAlfa = #24#163; |QBF aAlfa;
||     |SI aAlfa ! "XX";
          aSoft = "N";
          aHard = "N";
          |BUCLE agisys;
||          |SI aSoft ! "N"; |O aHard ! "N";
               |DDEFECTO #1;
               #1#0 = #24#0;
               |LEE 101#1=;
               |SI FSalida ! 0;    |GRABA 020#1b; |FINSI;

               #1#1 = #24#1;       || nombre fiscal
               #1#2 = #24#9;       || poblacion
               #1#3 = #24#17;      || telefono
               #1#4 = aSoft;       || contrato de soft
               #1#5 = aHard;       || contrato de hard
               #1#6 = #24#2;       || nombre comercial

               #1#1 = #1#1 > #1#1; || lo pasa a mayusculas
               #1#6 = #1#6 > #1#6; || lo pasa a mayusculas

               |GRABA 020#1a;
               |LIBERA #1;
||          |FINSI;
||     |FINSI;
|FPRC;

|DEFBUCLE agifa024;
     #24#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, agifa024;
|FIN;

|PROGRAMA;
     |ABRE #diapre04;
     |LEE 101#diapre04.p;
     |SI FSalida ! 0;    |GRABA 020#diapre04.b;   |FINSI;

     aAlfa1 = "";   |DBASS aAlfa1; aAlfa1 = aAlfa1 + "dsman9/def/ma000001.mas";
     |CARGA_DEF aAlfa1, agisys@;
     |SI FSalida = 0;
          aAlfa1 = "";   |DBASS aAlfa1; aAlfa1 = aAlfa1 + "dsman9/fich/84/";
          |PATH_DAT #agisys@#aAlfa1#;

          |ABRE #1;
          |BUCLE agifa024;    || graba posibles nuevos
          |CIERRA #1;

||          |ABRE #24;
||          |BUCLE diapre04;    || borra posibles XX
||          |CIERRA #24;

          |DESCARGA_DEF #agisys@;
     |SINO;
          |MENAV "0000DSMAN9 mal instalado.";
     |FINSI;

/*
     |ABRE #2;
     |ABRE #104;
     |BUCLE diam0003;
     |CIERRA #104;
     |CIERRA #2;
*/
     |CIERRA #diapre04;
|FPRO;
