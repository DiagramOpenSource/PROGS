     || Calculo llamado desde nominas

|FICHEROS;
     gomatcab #1;
     gomatlin #2;
     gomatljn #3;
     gomantho #4;   ||Expediente
     goalbpa1 #11;
     goalbpa2 #12;
     goalbpa3 #13;  ||=gopartia
     agifa077 #77;
|FIN;

|VARIABLES;
     &PRMNT_param = "";
     &eaFecConstru = "M";
     &nNumerAlba = 0;
     &cSerieExpe = "";
     &nNumerExpe = 0;
     &cSeriePres = "";
     &nNumerPres = 0;
     &nTotComTra = 0;
     &nTotVenTra = 0;
     &nTotComBas = 0;
     &nTotVenBas = 0;
     &nErrorSal  = 1;
     &neSObras = 1;
     &cProveAlba = "";
     &cNombrAlba = "";
     &cSuAlbaran = "";
     &cSerieAlba = "";
     &fFechaAlba = @;
     &nEurComTrab   = 0;
     &nEurComBase   = 0;
     &nEurVenTrab   = 0;
     &nEurVenBase   = 0;
     &cCodMonBase = "";
     &cCodMonTrab = "";

     aAlfa = "";
     aSerExp = "";
     aSerPre = "";
     nNumExp = 0;
     nNumPre = 0;
     fFecha = @;
     nLin = 0;
|FIN;

|PROGRAMA;
     aSerPre = PRMNT_param % 105;
     aAlfa = PRMNT_param % 606;
     nNumPre = aAlfa;
     aSerExp = PRMNT_param % 1205;
     aAlfa = PRMNT_param % 1706;
     nNumExp = aAlfa;
     aAlfa = PRMNT_param % 2310;
     fFecha = aAlfa;

     |ABRE #4;
     #4#0 = aSerExp;
     #4#1 = nNumExp;
     |LEE 020#4=;
     |CIERRA #4;

     |ABRE #1;
     |ABRE #2;
     |ABRE #3;
     #1#0 = aSerExp;
     #1#1 = nNumExp;
     |LEE 000#1=;
     |SI FSalida ! 0;
          #1#18 = #4#2;
          #1#19 = #4#8;
          #1#20 = #4#6;
          cCodMonTrab = #1#20;
          |HAZ MonBas;
          #1#21 = cCodMonBase;          ||Moneda Base.
          #1#23 = nEurVenBase;          ||Valor cambio Base.
          #1#22 = nEurVenTrab;          ||Valor cambio Trabajo.
          |GRABA 020#1n;
     |FINSI;

     |SELECT #2#2;
     #2#3 = aSerPre;
     #2#4 = nNumPre;
     |LEE 000#2=;
     |SI FSalida ! 0;
          |SELECT #1#2;
          #2#0 = aSerExp;
          #2#1 = nNumExp;
          #2#2 = 9999;
          |LEE 000#2];
          |SI FSalida = 0;
               |LEE 000#2a;
          |SINO;
               |LEE 000#2u;
          |FINSI;
          |SI FSalida = 0; |Y #2#0 = aSerExp;  |Y #2#1 = nNumExp;
               nLin = #2#2 + 1;
          |SINO;
               nLin = 1;
          |FINSI;
          |DDEFECTO #2;
          #2#0 = aSerExp;
          #2#1 = nNumExp;
          #2#2 = nLin;
          #2#3 = aSerPre;
          #2#4 = nNumPre;
          #2#9 = "A";
          |GRABA 020#2n;
     |FINSI;

     #3#0 = aSerPre;
     #3#1 = nNumPre;
     #3#2 = 9999;
     |LEE 000#3];
     |SI FSalida = 0;
          |LEE 000#3a;
     |SINO;
          |LEE 000#3u;
     |FINSI;
     |SI #3#0 = aSerPre; |Y #3#1 = nNumPre;
          nLin = #3#2 + 1;
     |SINO;
          nLin = 1;
     |FINSI;
     |DDEFECTO #3;
     #3#0 = aSerPre;
     #3#1 = nNumPre;
     #3#2 = nLin;
     #3#3 = fFecha;
     #3#14 = #1#0;                                ||Serie Expe.
     #3#15 = #1#1;                                ||Nume. Expe.
     |GRABA 020#3n;

     nNumerAlba = 0;
     cSerieExpe = #2#0;
     nNumerExpe = #2#1;
     cSeriePres = #2#3;
     nNumerPres = #2#4;
     nTotComTra = 0;
     nTotVenTra = 0;
     nTotComBas = 0;
     nTotVenBas = 0;
     nErrorSal  = 1;
     neSObras = 1;
     |PTEC 802; |PTEC 802; |PTEC 810;
     eaFecConstru = #3#3;
     |SUB_EJECUTA_NP "goalbpa1;MATERIAL";
     eaFecConstru  = "";

     |LEE 121#1=;
     |LEE 121#2=;
     |LEE 121#3=;
     #3#3  = fFechaAlba;                          ||Fecha Alba.
     #3#4  = cSuAlbaran;                          ||Su Albaran.
     #3#5  = cSerieAlba;                          ||Serie Alba.
     #3#6  = nNumerAlba;                          ||Nume. Alba.
     #3#7  = cProveAlba;                          ||Proveedor .
     #3#8  = cNombrAlba;                          ||N. Provedo.
     #3#9  = nTotComTra;                          ||I.Comp.Tra.
     #3#10 = nTotComBas;                          ||I.Comp.Bas.
     #3#11 = nTotVenTra;                          ||I.Vent.Tra.
     #3#12 = nTotVenBas;                          ||I.Vent.Bas.

     #2#5 = #2#5 + #3#9;
     #2#6 = #2#6 + #3#10;
     #2#7 = #2#7 + #3#11;
     #2#8 = #2#8 + #3#12;

     #1#6 = #1#6 + #2#5;         ||Admi. Costo.
     #1#8 = #1#8 + #2#7;         ||Admi. Venta.

     #1#14 = #1#4 + #1#8 + #1#12;           ||Total Gen. Venta.
     #1#16 = #1#2 + #1#6 + #1#10;           ||Total Gen. Venta.

     |GRABA 020#3a;
     |GRABA 020#2a;
     |GRABA 020#1a;
     |CIERRA #3;
     |CIERRA #2;
     |CIERRA #1;
|FPRO;
