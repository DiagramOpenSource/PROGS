|FICHEROS;
     agifa019 #19;
     dsm00053 #53,MANTE;
     agifa073 #73;
     agifa071 #71;
     agifa070 #70;
     agifa069 #69;
     agifa147 #147;
     agifa219 #219;
     agifa220 #220;

     dsw00054 #540; ||Tmp Cod. Barras Tecatel
     dsw00055 #550;
|FIN;

|VARIABLES;
     &enFuerzaDA = 0;
     &aArtiDA  = ""; || Controla si cambia el articulo
                     || solo se utiliza en este calculo
     nSwInforpor = 0;
     nTecla    = 0;
     nForma    = 0;
     &aTipoDA  = "";
     nSwTieneDA= 0;
     aSer      = "";
     nNume     = 0;
     nLin      = 0;
     nLinea    = 0;
     aArti     = "";
     nModo     = 0;

     aAlfa     = "";
     aDato     = "";
     aReg      = "";
     nPos      = 0;
     aLon      = "";
     i         = 0;
     nLon      = 0;
     n2Lin     = 0;
     nHay      = 0;
     &eaSerie = "";
     &enCodigo = 0;
     &enLinea = 0;
     &eaArticulo = "";
|FIN;

|RUTINA Inf;
     #53#0 = aTipoDA;
     #53#1 = aSer;
     #53#2 = nNume;
     #53#3 = nLin;
     #53#4 = 0001;
|FRUT;

|RUTINA Sup;
     #53#0 = aTipoDA;
     #53#1 = aSer;
     #53#2 = nNume;
     #53#3 = nLin;
     #53#4 = 9999;
|FRUT;

|PROCESO BorraDA;
     |BORRA 020#53a;
|FPRC;

|DEFBUCLE BorraDA;
     #53#1;
     ;
     aTipoDA, aSer, nNume, nLin, 0001;
     aTipoDA, aSer, nNume, nLin, 9999;
     be;
     NULL, BorraDA;
|FIN;

|PROCESO GrabaLin;
     nLinea = nLinea + 1;
     #53#0 = aTipoDA;
     #53#1 = aSer;
     #53#2 = nNume;
     #53#3 = nLin;
     #53#4 = nLinea;
     #53#5 = #220#2;
     |GRABA 020#53n;
|FPRC;

|PROCESO AltaDALin;
     |BUCLE BorraDA;
     |ABRE #219;
     #219#0 = aArti;
     |LEE 000#219=;
     |SI FSalida = 0; |Y #219#2 = "S";
          nLinea = 0;
          |ABRE #53;
          |BUCLELIN 2 GrabaLin #219;
          |CIERRA #53;
     |FINSI;
     |CIERRA #219;
|FPRC;

|PROCESO CopiaDA;
     #53#0 = "A";
     #53#1 = #71#29;
     #53#2 = #71#0;
     #53#3 = #71#1;
 ||  #53#4
 ||  #53#5
     |GRABA 020#53n;
|FPRC;

|DEFBUCLE CopiaDA;
     #53#1;
     ;
     aTipoDA, aSer, nNume, nLin, 0001;
     aTipoDA, aSer, nNume, nLin, 9999;
     ;
     NULL, CopiaDA;
|FIN;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|RUTINA VarDA;
     |SI aTipoDA = "P";
          aSer = #73#28;
          nNume = #73#0;
          nLin = #73#1;
          aArti = #73#2;
     |FINSI;
     |SI aTipoDA = "D";
          aSer = #70#22;
          nNume = #70#0;
          nLin = #70#1;
          aArti = #70#2;
     |FINSI;
     |SI aTipoDA = "A";
          aSer = #71#29;
          nNume = #71#0;
          nLin = #71#1;
          aArti = #71#2;
     |FINSI;
     |SI aTipoDA = "F";
          aSer = #69#20;
          nNume = #69#0;
          nLin = #69#1;
          aArti = #69#2;
     |FINSI;
     |SI aTipoDA = "X";
          aSer = #147#20;
          nNume = #147#0;
          nLin = #147#1;
          aArti = #147#2;
     |FINSI;

     |HAZ EsPCEGroup;
     |SI FSalida = 0;
          |SI aTipoDA = "X"; |O aTipoDA = "P";
               aSer = eaSerie;
               nNume = enCodigo;
               nLin = enLinea;
               aArti = eaArticulo;
          |FINSI;
     |FINSI;


     |ABRE #219;
     #219#0 = aArti;
     |LEE 000#219=;
     |SI FSalida = 0;
          nSwTieneDA = 0;
     |SINO;
          nSwTieneDA = -1;
     |FINSI;
     |CIERRA #219;

     |HAZ EsInforpor;
     nSwInforpor = FSalida;
     |SI FSalida = 0;
          |ABRE #19;
          #19#0 = aArti;
          |LEE 020#19=;
          |CIERRA #19;

          |SI #19#114 = 0;
               nSwTieneDA = -1;
          |FINSI;

/*
          |SI #19#126 ! "MAQ";
                    |Y #19#126 ! "5T ";
                    |Y #19#126 ! "T5 ";
                    |Y #19#126 ! "GJ ";
                    |Y #19#126 ! "GN ";
                    |Y #19#126 ! "GO ";
                    |Y #19#126 ! "GP ";
                    |Y #19#126 ! "GK ";
                    |Y #19#126 ! "GL ";
               nSwTieneDA = -1;
          |FINSI;
*/
     |FINSI;
|FRUT;

|PROCESO VerDA;
     nModo = (FEntrada / 100) ! 0;

     |HAZ VarDA;

     FSalida = 0;   ||la estandar
     |SI nSwInforpor = 0;
          |SI #19#114 = 0;
               |MENAV "0000Articulo no permitido para la funcion..";
               FSalida = 1; |ERROR;
          |FINSI;
/*
          |SI #19#126 ! "MAQ";
                    |Y #19#126 ! "5T ";
                    |Y #19#126 ! "T5 ";
                    |Y #19#126 ! "GJ ";
                    |Y #19#126 ! "GN ";
                    |Y #19#126 ! "GO ";
                    |Y #19#126 ! "GP ";
                    |Y #19#126 ! "GK ";
                    |Y #19#126 ! "GL ";
               |MENAV "0000Articulo no permitido para la funcion..";
               FSalida = 1; |ERROR;
          |FINSI;
*/

     |FINSI;

     |SI FSalida = 0;
          |PUSHV 0501 2380;
          |ENTLINEAL #1#53, -5, nModo, 22, 1, Inf, Sup;
          |POPV;
     |FINSI;
|FPRC;

|PROCESO BajaDA;
     nModo = (FEntrada / 100) ! 0;

     |HAZ VarDA;
     |BUCLE BorraDA;
|FPRC;

|PROCESO AltaDA;
     nModo = (FEntrada / 100) ! 0;
     |SI aTipoDA = "AD"; |O aTipoDA = "AP";
          |SI aTipoDA = "AD";
               aTipoDA = "D";
               |HAZ VarDA;
          |SINO;
               aTipoDA = "P";
               |HAZ VarDA;
          |FINSI;
          ||SI nSwTieneDA = 0;
               |BUCLE CopiaDA;
          ||FINSI;
     |SINO;
          |HAZ VarDA;
          |SI nSwTieneDA = 0; |O enFuerzaDA = 1;
               |SI nModo = 1;
                    |HAZ AltaDALin;
               |FINSI;
               |PUSHV 0501 2380;

               |HAZ EsTecatel;
               |SI FSalida = 0;
                    |MENSA "0000<F5> Introduccion Codigo Barras";
                    |AVISO; |AVISO;
               |FINSI;

               |ENTLINEAL #1#53, -5, 2, 22, 1, Inf, Sup;
               |POPV;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO DescriDA;
     nModo = (FEntrada / 100) ! 0;
     |HAZ VarDA;


     |SI aArtiDA ! aArti; |Y nModo = 1;
          |HAZ AltaDALin;
          nModo = 1;
     |FINSI;

     |SI nModo = 1; |Y #219#2 = "S"; |Y nSwTieneDA = 0;
          |SI aTipoDA = "P";
               #73#4 = #219#1;
               |PINTA #73#4;
          |FINSI;
          |SI aTipoDA = "D";
               #70#4 = #219#1;
               |PINTA #70#4;
          |FINSI;
          |SI aTipoDA = "A";
               #71#4 = #219#1;
               |PINTA #71#4;
          |FINSI;
          |SI aTipoDA = "F";
               #69#4 = #219#1;
               |PINTA #69#4;
          |FINSI;
          |SI aTipoDA = "X";
               #147#4 = #219#1;
               |PINTA #147#4;
          |FINSI;
     |FINSI;
     aArtiDA  = aArti;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
                     SOLO TECATEL 000323
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO UltimoCB;
     #550#0 = #540#0;
     #550#1 = 9999;
     |LEE 000#550];
     |SI FSalida = 0;
          |LEE 000#550a;
     |SINO;
          |LEE 000#550u;
     |FINSI;
     |SI FSalida = 0; |Y #550#0 = #540#0;
          n2Lin = #550#1 + 1;
     |SINO;
          n2Lin = 1;
     |FINSI;
|FPRC;

|PROCESO UltimaLinDA;
     #53#0 = aTipoDA;
     #53#1 = aSer;
     aTipoDA = #53#0; aSer = #53#1; ||Formateo
     #53#2 = nNume;
     #53#3 = nLin;
     #53#4 = 999;
     |LEE 000#53];
     |SI FSalida = 0;
          |LEE 000#53a;
     |SINO;
          |LEE 000#53u;
     |FINSI;
     |SI FSalida = 0; |Y #53#0 = aTipoDA; |Y #53#1 = aSer;
               |Y #53#2 = nNume; |Y #53#3 = nLin;
          n2Lin = #53#4 + 1;
     |SINO;
          n2Lin = 1;
     |FINSI;
|FPRC;

|PROCESO CargaBar;
     aAlfa = #53#5; |QBF aAlfa;
     aLon = aAlfa % A0;
     aReg = "";
     nHay = 0;
     |PARA i = 1; |SI i [ aLon; |HACIENDO i = i + 1;
          nPos = i * 100 + 1;
          aDato = aAlfa % nPos;
          |SI aDato = "|";
               #540#0 = aReg;
               |HAZ UltimoCB;
               #550#0 = aReg;
               #550#1 = n2Lin;
               |GRABA 020#550n;
               aReg = "";
               nHay = 1;
          |SINO;
               aReg = aReg + aDato;
          |FINSI;
     |SIGUE;
     |SI nHay ! 0; |BORRA 020#53a; |FINSI;
|FPRC;

|DEFBUCLE CargaBar;
     #53#1;
     ;
     aTipoDA, aSer, nNume, nLin, 0001;
     aTipoDA, aSer, nNume, nLin, 9999;
     ;
     NULL, CargaBar;
|FIN;

|PROCESO GrabaCodBar;
     |HAZ UltimoCB;
     |SI n2Lin ! 1;
          |AVISO;
          aAlfa = "0000N" + #540#0 + &13 + "El codigo existe. Continuar?";
          |CONFI aAlfa;
          |SI FSalida ! 0; |ACABA; |FINSI;
     |FINSI;
     #550#0 = #540#0;
     #550#1 = n2Lin;
     |GRABA 020#550n;
|FPRC;

|PROCESO DesCargaBar;
     aAlfa = aReg + #550#0 + "|";
     aLon = aAlfa % A0;
     |SI aLon > nLon;
          |HAZ UltimaLinDA;
          #53#0 = aTipoDA;
          #53#1 = aSer;
          #53#2 = nNume;
          #53#3 = nLin;
          #53#4 = n2Lin;
          #53#5 = aReg;
          |GRABA 020#53n;
          aReg = #550#0 + "|";
     |SINO;
          aReg = aReg + #550#0 + "|";
     |FINSI;
|FPRC;

|DEFBUCLE DesCargaBar;
     #550#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, DesCargaBar;
|FIN;

|PROCESO TecaCodBar; |TIPO 11;
     nTecla = FSalida;
     |HAZ EsTecatel;
     |SI FSalida  = 0;
          |SI nTecla = 13;   ||F5
               |PUSHV 0501 2380;
               aAlfa = Usuario; |QBF aAlfa;
               |NOME_DAT #550 aAlfa;
               |DELINDEX #550;
               |ABRE #550;
               |BUCLE CargaBar;
               |DDEFECTO #540;
               |PINPA #0#540;
               |PINDA #0#540;
               |PARA; |SI; |HACIENDO;
                    |ENCAMPO #0#540;
                    |SI FSalida ! 0; |SAL; |FINSI;
                    |HAZ GrabaCodBar;
               |SIGUE;

               aLon = #53#5;
               aLon = aLon % A0;
               nLon = aLon;
               aReg = "";
               |BUCLE DesCargaBar;
               |SI aReg ! "";
                    nLon = 0;
                    |HAZ DesCargaBar;
               |FINSI;
               |CIERRA #550;
               |DELINDEX #550;
               |POPV;
               |PTEC 807;
          |FINSI;
     |FINSI;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
