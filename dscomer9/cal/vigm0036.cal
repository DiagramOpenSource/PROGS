|FICHEROS;
     vigm0036 #0; || = vigm0017       || Lineas Adjudicacion
     vigm0035 #1; || = agifa212       || Cabecera Adjudicacion
     agifa081 #2;        || Cabecera Pedidos
     agifa067 #3;        || Lineas Pedidos
     agifa019 #4;        || Articulos
     agifa017 #5;        || Almacen
     agifa112 #6;        || Clientes
     agifa215 #20;       || Temporal Seleccion Articulos
     agifa007 #21;       || Series.
     agifa321 #15;       || DIV - Parametros
     agifa324 #16;       || DIVISAS
     agifa142 #142;
     dsm00005 #905;
     dsw00022 #922;      || Tmp Adj por Articulos Elemento
     dsm00065 #965;
     dsm00066 #966;
     dsw00031 #88,MANTE;       ||Auxiliar Rechazos.
     referen@;
     agifa048 #480;
     dsw00066 #66;
     dsm00083 #83;
     agifa029 #29;
     agifa080 #80;
|FIN;

|INCLUYE i_varart;

|VARIABLES;
     nPreTon = 0;
     nPdte1 = 0;
     nPdte2 = 0;
     &enModoCab = 0;
     nGuarda = 0;
     &enNumero = 0;
     &enEsCto = 0;
     articulo = "";
     nalmacen = 0;
     nImporDescue1 = 0;
     nImporDescue2 = 0;
     nImporDescue3 = 0;
     nImporMoneda1 = 0;
     nImporMoneda2 = 0;
     nBrutoMoneda1 = 0;
     nBrutoMoneda2 = 0;
     &enUniTagPen = 0;
     &enUniTagRes = 0;
     nSwSirveArt = 0;
     nSwBsegui = 0;
     aTipo = "";
     nLinV = 0;
     nTecla = 0;
     ||Variables Mod.Obras .....(Reysor)
     &prefot    = 0;
     &numfot    = 0;
     &modfot    = 0;
     &serfot    = "";
     &linfot    = 0;
     &canfot    = 0;
     &impfot    = 0;
     &artfot    = "";
     nSwObra    = 0;
     ||컴컴컴컴컴컴컴컴컴컴
     &enSwIber = 0;
     nModo = 0;
     nPrime = 0;
     nPtec = 0;
     aPtec = "";
     nLin = 0;
     &enProg213 = 0;
     nVaria1     = 0 ;
     nVaria2     = 0 ;
     &Tempo      = "";
     &eaTempo020 = "";
     &eaTempo922 = "";
     &enSwArtiElem= 1;
     &enSinPanta= 0;
     &Envase    = "";
     &Unidades1 = 0;
     &Unidades2 = 0;
     &VArticulo = "";
     &aSerAntes = "";
     &nNumAntes = 0;
     &ser_ped   = "";
     &num_ped   = 0;
     &lin_ped   = 0;
     &enSwPanta = 1;
     nSwNoQuiero  = 0;
     nPrecio      = 0;
     nNume        = 0;
     nForma       = 0;
     nPendiente   = 0;
     nPendiente2  = 0;
     aDespreciar  = "";

     &nDeci_Base     = 0;   || Decimales en Totales de la moneda base
     &nDeci_PreBase  = 0;   || Decimales en el Precio en moneda base
     &nDeci_BaseMx   = 0;   || Decimales en Totales de la moneda base (Maxima precision)
     &nDeci_PreBaseMx= 0;   || Decimales en el Precio en moneda base (Maxima precision)
     &nDeci_Div      = 0;   || Decimales en Totales de la divisa
     &nDeci_PreDiv   = 0;   || Decimales en el Precio en divisa
     &nDeci_TotVis   = 0;   || Decimales en Totales visibles (el de la moneda de trabajo)
     &nDeci_TotNoVis = 0;   || Decimales en Totales no visibles (el de la otra moneda)
     &nDeci_PreVis   = 0;   || Decimales en el Precio visual. (lineas)
     &nDeci_ImpVis   = 0;   || Decimales en el Importe visual. (lineas)
     &nDeci_BaseMxP  = 0;   || Decimales en Totales de la moneda base (Maxima precision)
     &nDeci_PreBasMxP= 0;   || Decimales en el Precio en moneda base (Maxima precision)
     &nDeci_DivP     = 0;   || Decimales en Totales de la divisa
     &nDeci_PreDivP  = 0;   || Decimales en el Precio en divisa
     &nDeci_TotVisP  = 0;   || Decimales en Totales visibles (el de la moneda de trabajo)
     &nDeci_TotNoVisP= 0;   || Decimales en Totales no visibles (el de la otra moneda)
     &nDeci_PreVisP  = 0;   || Decimales en el Precio visual. (lineas)
     &nDeci_ImpVisP  = 0;   || Decimales en el Importe visual. (lineas)
     tecla      = "";
     &ac_divisa = ""; ||
     mensa      = ""; || Linea de visualizacion
     &pintado   = 0;|| Controla el pintado de mensa para que solo lo haga 1 vez
     titdiv = "";   || Encabezado de precio e imp. con la divisa "Imp.Tot(USD)"
     aprograma = "";
     sw_adjf1       = 0;
     asto           = 0;
     desp           = "";
     &salida        = 0;
     &programa      = "agifa212";
     &cliente       = "";
     &serv_art      = "N";
     &correcto      = "N";
     &act_ent       = "N";
     &fichero       = "";
     &enFichero     = "";
     servir         = "N";
     aPedCompleto   = "N";
     fmes           = "";
     fiac           = "  ";
     guarda         = "  ";
     relleno        = "                                       ";
     aponer         = "  ";
     mensaje        = "";
     &sw_modo       = 0;
     modo           = 0;
     i              = 0;
     linea          = 0;
     importe        = 0;
     gmodo          = 0;
     l1_inf         = "";
     l1_sup         = "";
     fich           = "";
     aAlfa          = "";
     nPPort1        = 0;
     nPPort2        = 0;
     importeD       = 0;
     nImpDiv        = 0;
     nHandle = 0;
     nPeso = 0;
|FIN;

|PROCESO DefSer213; |TIPO 7;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 1;
          #0#29 = #0#27;
          |SI #agifa142#185 = "S"; #0#29 = #agifa142#192; |FINSI;
     |FINSI;
|FPRC;

|PROCESO Llena213; |TIPO 6;
     enAlta = 1;
     eaArticulo = #0Campo;
     |HAZ LlenaArticulo;
     |SI FSalida = 0;
          #0Campo = eaArticulo;
          |PINTA #0Campo;
     |SINO;
          |ERROR; |ACABA;
     |FINSI;
|FPRC;

|PROCESO Descri213;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 1; |Y #0#12 = 0;
          |ABRE #4;
          #4#2 = #0#4;
          |LEE 000#4=;
          |CIERRA #4;
          #0#4 = #4#195;
          |PINTA #0#4;
     |FINSI;
|FPRC;

|PROCESO licogea; |TIPO 0;
     sw_adjf1 = 0;
     aPedCompleto = "N";
     modo = ((FEntrada / 100) ! 0);
     |SI modo = 1;
          |SI nNumAntes ! 0;
               #0#29 = aSerAntes; |PINTA #0#29;
               #0#12 = nNumAntes; |PINTA #0#12;
          |FINSI;
          |C_M #0#12 , 1 , "S";
          |C_M #0#21 , 1 , "S";
          |C_M #0#29 , 1 , "S";
          |C_M #0#2  , 1 , "N";
     ||     |C_M #0#3  , 1 , "N";
          |C_M #0#4  , 1 , "N";
          |C_M #0#5  , 1 , "N";
          |SI #1#58 = "B";
               |C_M #0#6  , 1 , "N";
          |SINO;
               |C_M #0#30 , 1 , "N";
          |FINSI;
          |C_M #0#8  , 1 , "N";
          |C_M #0#10 , 1 , "N";
          |C_M #0#11 , 1 , "N";
          |C_M #0#27 , 1 , "N";
          |C_M #0#28 , 1 , "N";
          |C_M #0#26 , 1 , "N";
          |C_M #0#45 , 1 , "N";
     |SINO;
          |C_M #0#12 , 1 , "N";
          |C_M #0#21 , 1 , "N";
          |C_M #0#29 , 1 , "N";
          |C_M #0#2  , 1 , "N";
          |C_M #0#3  , 1 , "S";
          |C_M #0#4  , 1 , "S";
          |SI #0#2 = "                    ";
               |C_M #0#5  , 1 , "N";
               |SI #1#58 = "B";
                 |C_M #0#6  , 1 , "N";
               |SINO;
                 |C_M #0#30 , 1 , "N";
               |FINSI;
               |C_M #0#8  , 1 , "N";
               |C_M #0#10 , 1 , "N";
               |C_M #0#11 , 1 , "N";
               |C_M #0#27 , 1 , "N";
               |C_M #0#28 , 1 , "N";
               |C_M #0#26 , 1 , "N";
               |C_M #0#45 , 1 , "N";
          |SINO;
               |C_M #0#5  , 1 , "S";
               |SI #1#58 = "B";
                    |C_M #0#6  , 1 , "S";
               |SINO;
                    |C_M #0#30 , 1 , "S";
               |FINSI;
               |C_M #0#8  , 1 , "S";
               |C_M #0#10 , 1 , "S";
               |C_M #0#11 , 1 , "S";
               |C_M #0#27 , 1 , "S";
               |C_M #0#28 , 1 , "S";
               |C_M #0#26 , 1 , "S";
               |C_M #0#45 , 1 , "S";
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO liadju; |TIPO 0;
     |SI Campo = 21; |Y #0#21 = 0; ||Campo Linea
          |SI FSalida = 2; |ACABA; |FINSI;
          |SI FSalida ! 0; |ERROR; |ACABA; |FINSI;
     |FINSI;

     |SI nSwNoQuiero = 1;  |ACABA;  |FINSI;
     |SI #0#12 = 0; #0#21 = 0; |FINSI;

     |SI #0#12 = 0; |Y #0#21 = 0;
          |C_M #0#2,  1, "S";
          |C_M #0#3,  1, "S";
          |C_M #0#11, 1, "S";
          |C_M #0#8,  1, "S";
          |C_M #0#26, 1, "S";
          |C_M #0#45, 1, "S";
          |C_V #0#30, 0, aAlfa;
          |SI aAlfa = "S";
               |C_M #0#30, 1, "S";
               |C_M #0#6,  1, "N";
          |SINO;
               |C_M #0#6,  1, "S";
               |C_M #0#30, 1, "N";
          |FINSI;
          |ACABA;
     |SINO;
          |C_M #0#2,  1, "N";
       ||   |C_M #0#3,  1, "N";
          |C_M #0#11, 1, "N";
     |FINSI;

     |SI modo = 1; |Y correcto = "N";
          aSerAntes = #0#29;
          nNumAntes = #0#12;
          |ABRE #2;
          #2#25 = #0#29;
          #2#0  = #0#12;
          |LEE 001#2=;               ||Leo el pedido
          |SI FSalida = 0;
               servir = "N";
               |SI #0#21 = 0;         ||Si linea = 0 es completo
                    |ABRE #4;
                    |BUCLELIN 2miraserv#2;
                    |CIERRA #4;
                    aPedCompleto = "S";
                    |HAZ EsTagloma;
                    |SI FSalida = 0; |BUCLELIN 2CheqPreTagloma#2; |FINSI;
               |SINO;                 ||Solo una linea
                    aPedCompleto = "N";
                    |ABRE #3;
                    #3#28 = #2#25;
                    #3#0 = #2#0;
                    #3#1 = #0#21;
                    |LEE 001#3=;
                    |SI FSalida = 0;
                         efFec = #1#1;
                         enAlma = #3#3;
                         |HAZ MiraHisL;
                         |SI enErrHis ! 0;
                              |ERROR;
                              |ACABA;
                         |FINSI;
                         mensaje = "";
                         |ABRE #4;
                         |HAZ miraserv2;
                         |CIERRA #4;
                         |SI servir = "S"; |O #3#2 = "                    ";
                              servir = "S";
                         |SINO;
                              |SI mensaje = "";
                                   mensaje = "0000La linea de Pedido ya esta Sevida";
                              |FINSI;
                         |FINSI;
                         |HAZ EsTagloma;
                         |SI FSalida = 0; |HAZ CheqPreTagloma; |FINSI;
                    |SINO;
                         mensaje = "0000La linea de Pedido no Existe";
                    |FINSI;
                    |CIERRA #3;
               |FINSI;

               |SI servir = "N";
                    |MENAV mensaje;
                    |ERROR;
               |SINO;
                    |SI sw_modo = 1;
                         #1#5 = #2#5;         ||Dto
                         #1#7 = #2#6;         ||P.P
                         #1#8 = #2#9;         ||Forma Pago
                         #1#32 = #2#17;       ||Dto Acumulado
                         |SI act_ent = "S";
                              #1#29 = #2#19;       ||Entregar a
                              #1#30 = #2#18;       ||Dir. Ent.
                              #1#31 = #2#20;       ||Pob. Ent.
                              #1#33 = #2#21;       ||Pro. Ent.
                         |FINSI;
                    |SINO;
                         |SI #1#3 ! #2#4; |O #1#5 ! #2#5;
                         |O  #1#7 ! #2#6; |O  #1#8 ! #2#9;
                         |O  #1#32 ! #2#17;
                              |MENAV "0000Los datos del Albaran no se Corresponden con el Pedido";
                              |ERROR;
                              |ACABA;
                         |FINSI;
                    |FINSI;
                    linea = #0#1 - 1;
                    |SI #2#10 = "S";
                         |AVISO;
                         |CONFI "2400NAtencion este pedido esta bloqueado, Continuar : ";
                         |SI FSalida ! 0;
                              |ERROR;
                         |SINO;
                              |HAZ graba_lin;
                              |SI aPedCompleto = "S";
                                   |ERROR;
                                   |PTEC 807;
                              |SINO;
                                   |PTEC 806;
                              |FINSI;
                         |FINSI;
                    |SINO;
                         |HAZ graba_lin;
                         |SI aPedCompleto = "S";
                              |ERROR;
                              |PTEC 816;
                              |PTEC 807;
                         |SINO;
                              |PTEC 806;
                         |FINSI;
                    |FINSI;
               |FINSI;
          |FINSI;
          |CIERRA #2;
     |SINO;
          |CIERRA #2;
     |FINSI;
|FPRC;

|PROCESO comp_215;
     |SI #20#6 [ 0; |ACABA; |FINSI;

     #2#25 = #20#2;
     #2#0 = #20#3;
     |LEE 000#2=;
     aAlfa = "";
     |SI #2#4 ! #1#3; ||Prv
               |O #2#9 ! #1#8; ||FP
               |O #2#5 ! #1#5; |O #2#17 ! #1#32; |O #2#6 ! #1#7; ||Dto
          aAlfa = "0000Condiciones del pedido distintas al albaran.";
     |FINSI;
     #3#28 = #20#2;
     #3#0  = #20#3;
     #3#1  = #20#4;
     |LEE 000#3=;
     |SI aAlfa ! ""; |Y FSalida = 0;
          |MENAV aAlfa;
          #66#2 = #2#9;  #66#9 = #1#8;
          #66#4 = #2#5;  #66#11 = #1#5;
          #66#5 = #2#17; #66#12 = #1#32;
          #66#6 = #2#6;  #66#13 = #1#7;
          #66#14 = #2#25;
          #66#15 = #2#0;
          |C_V #66#3, 1, "N"; |C_V #66#10, 1, "N";
          |C_V #66#16, 1, "N"; |C_V #66#17, 1, "N";
          |PUSHV 0501 2380;
          |BLANCO 11222261;
          |PINPA #0#66;
          |PINTA 1924, "                    ";
          |PINTA 2024, "                    ";
          |PINDA #0#66;
          |PAUSA;
          |POPV;
          |SI #1#41 = 0;
               |CONFI "0000NCambiar condiciones del albaran actual:";
               |SI FSalida = 0;
                    #1#3 = #2#4;
                    #1#8 = #2#9;
                    #1#5 = #2#5;
                    #1#32 = #2#17;
                    #1#7 = #2#6;
               |FINSI;
          |SINO;
               aAlfa = "0000Linea de Pedido: [" + #20#2 + "/" + #20#3 + "/" + #20#4 + "], no se asigna";
               |MENAV aAlfa;
               FSalida = 1;
          |FINSI;
     |FINSI;
     |SI FSalida = 0;
         |HAZ SirveLinea;
         nSwSirveArt = 1;
     |FINSI;
|FPRC;

|DEFBUCLE lee_215;
     #20#1;
     ;
     "                    " ,   1;
     "zzzzzzzzzzzzzzzzzzzz" , 999;
     ;
     NULL , comp_215;
|FIN;

|PROCESO MiraSerie; |TIPO 0;
     |SI #142#127 = "S"; |Y #1#50 ! #0#29;
          |MENAV "0000Las series Albaran/Pedido no se Corresponden";
          |ERROR;
          |ACABA;
     |FINSI;
|FPRC;

|RUTINA Ptecs;          ||Pone los Ptec en la linea de pedido
     |ABRE #3;
     #3#28 = #2#25
     #3#0 = #2#0;
     #3#1 = 999;
     |LEE 000#3];
     |SI FSalida = 0;
          |LEE 000#3a
     |SINO;
          |LEE 000#3u;
     |FINSI;
     |SI FSalida = 0; |Y #3#28 = #2#25; |Y #3#0 = #2#0;
          nLin = #3#1 + 1;
     |SINO;
          nLin = 1;
     |FINSI;
     |CIERRA #3;

     |SI nLin < #142#168; nLin = #142#168; |FINSI;
     aAlfa = ("000" + nLin) % -103;
     aPtec = aAlfa % 301; nPtec = &aPtec;
     |PTEC nPtec;
     aPtec = aAlfa % 201; nPtec = &aPtec;
     |PTEC nPtec;
     aPtec = aAlfa % 101; nPtec = &aPtec;
     |PTEC nPtec;
|FRUT;

|PROCESO que_art; |TIPO 6;
     enSwArtiElem = 0;
     nSwNoQuiero = 0;
     salida = FSalida;   || LO UTILIZO PARA EL CONTROL DE ADJ.POR ARTICULOS.
     |SI modo = 1; |Y FSalida = 9;
          |SI serv_art ! "S";
               |MENAV "0000Opcion no activa en parametros opcionales...";
               |ERROR;
               |ACABA;
          |FINSI;
          eaSeriePedido = "";
          enCodigPedido = "";
          enLineaPedido = "";

          cliente = #1#3;
          correcto = "N";
          eaSerie = #0#27;
          enCodigo = #0#0;
          enLinea = #0#1;

          |HAZ CreaTempo; eaTempo020 = Tempo;
          |HAZ CreaTempo; eaTempo922 = Tempo;
          |NOME_DAT #20 eaTempo020;  |DELINDEX #20;
          |NOME_DAT #922 eaTempo922; |DELINDEX #922;
          |SUB_EJECUTA_NP "agifa214.run";

          |SI correcto = "S";
               aponer = Asino;
               |HAZ poncontr213;
               aPedCompleto = "S";

               nSwSirveArt = 0;
               |ABRET #2;
               |ABRET #3;
               |BUCLE lee_215;
               |CIERRAT #2;
               |CIERRAT #3;

               |SI nSwSirveArt = 0;
                    |ERROR;
               |SINO;
                    aPedCompleto = "N";
                    aponer = Anosi;
                    |HAZ poncontr213;
                    |C_M #0#3  , 1 , "N";
                    |C_M #0#5  , 1 , "N";
                    |C_M #0#12 , 1 , "N";
                    |C_M #0#21 , 1 , "N";
                    |C_M #0#2  , 1 , "N";
                    |C_M #0#3  , 1 , "N";
                    |C_M #0#4  , 1 , "N";
                    sw_adjf1 = 1;
                    nSwNoQuiero = 1;
                    |SI linea = 2;
                         |PTEC 808;
                    |FINSI;
                    |PTEC 815;     || AV.PAG.
               |FINSI;
          |SINO;
               |ERROR;
          |FINSI;
          correcto = "N";
          |DELINDEX #20;  Tempo = eaTempo020; |HAZ BoraTempo;
          |DELINDEX #922; Tempo = eaTempo922; |HAZ BoraTempo;
     |FINSI;


     |SI modo = 1; |Y FSalida = 18; || F10 Crea linea pedido
          |MENAV "0000Opcion Anulada, introduzca pedido=0 para crear linea sin pedido";
          |ERROR;
     |FINSI;

/*           QUITADO Tue Feb 26 13:23:01 CET 2002

     |SI modo = 1; |Y FSalida = 18; || F10 Crea linea pedido
          eaSeriePedido = "";
          enCodigPedido = 0;
          enLineaPedido = 0;
          enProg213 = 213;
          |ABRE #2;
       |ET OtraVez;
          #2#25 = #0#29;
          #2#0 = #0#12;
          |LEE 101#2=;
          |SI FSalida = 0;
               |HAZ Ptecs;                       || Pongo el numero de linea
               |PTEC 815; |PTEC 815; |PTEC 815;  || Lo meto en las lineas
               |PUSHV 0101 2380;
               |CLS;
               |PINPA #0#2;
               |PINDA #0#2;
               |ENDATOS #2#2;
               |SI FSalida = 0; |GRABA 020#2a; |FINSI;
               |POPV;
               #0#21 = nLin; |PINTA #0#21;
               |PINTA #0#12;
               |PINTA #0#29;
          |SINO;
               |CONSULTA_CLAVE #1#2;
               |SI FSalida = 0;
                    #0#29 = #2#25;
                    #0#12 = #2#0;
                    |VETE OtraVez;
               |FINSI;
               |ERROR;
          |FINSI;
          |CIERRA #2;
          enProg213 = 0;
     |FINSI;
*/
|FPRC;

|PROCESO ActuaResto;
     #1#41  = #1#41 +. 1;
     nForma = 0 +. 1;
     |ABRE #4;
     |ABRE #5;
     |ABRE #6;
     |HAZ lee_arti;
     |HAZ lee_clien;

     |SI #0#12 ! 0;  |O #0#29 ! "     ";
          |HAZ AlPedido;
          aAlfa = #1#71; |QBF aAlfa;
          |SI aAlfa = "";
               #1#71 = #2#43; |PINTA #1#71;
          |FINSI;
     |FINSI;

     importe = #0#9 < #1#5;
     importe = importe < #1#7;
     importe = importe < #1#32;
     importe = importe;
     |HAZ actua_cabe;
     #0#23 = #3#5;
     |LIBERA #6;
     |CIERRA #6;
     |CIERRA #4;
     |CIERRA #5;
|FPRC;

|PROCESO GrabaCompo21;
     |DDEFECTO #905;
     #905#0 = "AC";
     #905#1 = #0#27;
     #905#2 = #0#0;
     #905#3 = #0#1;
     #905#4 = #922#4;
     #905#5 = #922#5;
     #905#6 = #922#6;
     #905#7 = #922#7;
     #905#8 = #922#6 * #922#7;
     |GRABA 020#905n;
     |LIBERA #905;

     eaTipo        = "AC";
     eaSerie       = #0#27;
     enCodigo      = #0#0;
     enLinea       = #0#1;
     efFecha       = #1#1;
     eaArticulo    = #0#2;
     enAlmacen     = #0#3;
     eaComponente  = #905#4;
     enUnidades    = #0#5;
     enTBruto      = #0#7;
     eaAbono       = #1#42;
     enTarifa      = 0;
     eaSeriePedido = #0#29;
     enCodigPedido = #0#12;
     enLineaPedido = #0#21;
     eaEsNecesario = "S";
     enCamBas      = #1#57;
     eaMoneda      = #1#58;
     enCamDiv      = #1#62;
     |SUB_EJECUTA_NP "dsz00002;ACC";
|FPRC;

|DEFBUCLE dsw00021;
     #922#1;
     ;
     "W3", #20#2, #20#3, #20#4, "      ";
     "W3", #20#2, #20#3, #20#4, "zzzzzz";
     ;
     NULL, GrabaCompo21;
|FIN;

|PROCESO GrabaCompoN;
     |SALVA_DATOS #905;

     #905#0  = "AC";
     #905#1  = #0#27;
     #905#2  = #0#0;
     #905#3  = #0#1;
     #905#6  = #905#6 - #905#12;
     #905#8  = #905#6 * #905#7;
     #905#9  = 0;
     #905#11 = 0;
     #905#12 = 0;
     |GRABA 020#905n;
     |LIBERA #905;

     |REPON_DATOS #905;
     |LEE 040#905=;

     eaTipo        = "AC";
     eaSerie       = #0#27;
     enCodigo      = #0#0;
     enLinea       = #0#1;
     efFecha       = #1#1;
     eaArticulo    = #0#2;
     enAlmacen     = #0#3;
     eaComponente  = #905#4;
     enUnidades    = #0#5;
     enTBruto      = #0#7;
     eaAbono       = #1#42;
     enTarifa      = 0;
     eaSeriePedido = #0#29;
     enCodigPedido = #0#12;
     enLineaPedido = #0#21;
     eaEsNecesario = "S";
     enCamBas      = #1#57;
     eaMoneda      = #1#58;
     enCamDiv      = #1#62;
     |SUB_EJECUTA_NP "dsz00002;ACC";
|FPRC;

|DEFBUCLE dsm00005N;
     #905#1;
     ;
     "PC", #0#29, #0#12, nLinV, "      ";
     "PC", #0#29, #0#12, nLinV, "zzzzzz";
     ;
     NULL, GrabaCompoN;
|FIN;

|PROCESO dsm00065;
     #966#0 = #0#29;
     #966#1 = #0#0;
     #966#2 = #0#1;
     #966#3 = #965#3;
     #966#4 = #965#4;
     #966#5 = #965#5;
     #966#6 = #965#6;
     #966#7 = #965#7;
     |GRABA 020#966n;
|FPRC;

|DEFBUCLE dsm00065;
     #965#1;
     ;
     #3#28, #3#0, #3#1, 001;
     #3#28, #3#0, #3#1, 999;
     ;
     NULL, dsm00065;
|FIN;

|PROCESO CopiaDesAmpli;
     #83#0 = "A";
     #83#1 = #0#27;
     #83#2 = #0#0;
     #83#3 = #0#1;
     |GRABA 020#83n;
|FPRC;

|DEFBUCLE CopiaDesAmpli;
     #83#1;
     ;
     "P", #0#29, #0#12, #0#21, 001;
     "P", #0#29, #0#12, #0#21, 999;
     ;
     NULL, CopiaDesAmpli;
|FIN;

|PROCESO BorraDesAmpli;
     |BORRA 020#83a;
|FPRC;

|DEFBUCLE BorraDesAmpli;
     #83#1;
     ;
     "A", #0#29, #0#12, #0#21, 001;
     "A", #0#29, #0#12, #0#21, 999;
     be;
     NULL, BorraDesAmpli;
|FIN;

|PROCESO SirveLinea;      ||Pinto la linea en cuestion
     |ABRE #4;
     #4#0 = #3#2;
     |LEE 040#4=;
     |SI FSalida ! 0;  |DDEFECTO #4;  |FINSI;
     |CIERRA #4;

     aAlfa = #3#2; |QBF aAlfa;
     |SI aAlfa ! "";
          |SI #142#225 = "B";
               |SI #4#179 = "S"; |Y  #142#117 = "S";
                    |SI #3#38 = #3#5; |Y #3#46 = #3#41; |ACABA;  |FINSI;
               |SINO;
                    |SI #3#38 = #3#5; |ACABA;  |FINSI;
               |FINSI;
          |SINO;
               |SI #3#38 = #3#5; |ACABA;  |FINSI;
               |SI #4#179 = "S"; |Y #142#117 = "S";
                    |SI #3#46 = #3#41; |ACABA; |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
     efFec = #1#1;
     enAlma = #3#3;
     |HAZ MiraHisL;
     |SI enErrHis ! 0;
          |ERROR;
          |ACABA;
     |FINSI;

     FSalida = 0;
     linea = 1;
     |PARA ; |SI FSalida = 0; |HACIENDO ;
          |DDEFECTO #0;
          #0#27 = #1#50;       ||Serie
          #0#0 = #1#0;         ||Albaran
          #0#1 = linea;
          |LEE 001#0=;
          linea = linea + 1;
     |SIGUE;

     |PARA i = 2; |SI i [ 10; |HACIENDO i = i + 1;
           #0i = #3i;
     |SIGUE;
     #0#45 = #3#57;

     |SI correcto = "S";
         #0#5 = #20#6;
         |SI enSwArtiElem= 1;
               |SI #1#58 = "D";  || Si la moneda de trabajo es la divisa ...
                    #0#30 = #20#7;
               |SINO;
                    #0#6 = #20#7;
               |FINSI;
          |FINSI;
     |SINO;
         #0#5 = #3#5 - #3#38;
         #0#36 = #3#41 - #3#46;
     |FINSI;

     nSwBsegui = 1; |HAZ BseguiAdj;

     enSinPanta = 1;
     #0#34 = #3#39;                     || codigo de envase
     #0#35 = #3#40;                     || unidades de envase

     |ABRE #21;
     #21#26 = #0#27;
     |LEE 000#21=;
     |CIERRA #21;

     #0#37 = #3#42;      ||Partida
     #0#39 = #3#47;      ||Medida1
     #0#40 = #3#48;      ||Medida2
     #0#41 = #3#49;      ||Medida3
     #0#43 = #3#54;      ||Cod.Unidades
     |SI #21#30 = "S";  || Exportacion
          #0#11 = 0;
     |SINO;
          #0#11 = #3#14;                 || Tipo de Iva
     |FINSI;
     #0#12 = #3#0;                       ||Pedido
     #0#13 = #3#18;                      ||Familia
     #0#15 = #1#3;                       ||Cliente
     #0#16 = #3#17;                      ||Tipo comision
     #0#17 = #2#19;                      ||Tipo Cliente
     #0#19 = "S";                               ||Entrega Pedido
     #0#21 = #3#1;                       ||Linea Pedido
     #0#23 = #3#5 - #3#38;               ||Unidades Pedidas
     #0#29 = #3#28;                      ||Serie Pedido
     #0#26 = #3#27;                      ||Dto 2
     #0#45 = #3#57;                      ||Dto 2
     #0#30 = #3#33;                      ||Precio en DIV

     ||TODO CCC
     |ABRE #agifa142; |LEE 000#agifa142.p; |CIERRA #agifa142;
     |SI #agifa142#148 = "S";
          #0#42 = #3#50;
     |FINSI;

     aAlfa = #0#37; |QBF aAlfa;
     |SI aAlfa = ""; |Y #agifa142#241 = "N"; |Y #agifa019#180 = "S";
          enSinPanta = 0;
          |HAZ DobleParti;
          enSinPanta = 1;
     |FINSI;

     |HAZ TotalLinVig80;
     |PINDA #0#0;

     aTipo = #142#12;
     |SI aTipo = "X";
          |ABRE #480;
          #480#0 = #0#2;
          |LEE 000#480=;
          |SI FSalida = 0;
               aTipo = #480#33;
          |FINSI;
          |CIERRA #480;
     |FINSI;
     |SI aTipo = "K";
          |ABRE #966;
          |BUCLE dsm00065;
          |CIERRA #966;
     |FINSI;

     |SI aPedCompleto = "S";
         |HAZ ActuaResto; ||Separo del t i p o 2 resto, sino mal adj (Carlos)

         |GRABA 021#0c;
     |FINSI;
     |SI enSwArtiElem = 1;
          |ABRE #905;
          |BUCLE dsw00021;
          |CIERRA #905;
     |SINO;
          nLinV = #0#21;
          |BUCLE dsm00005N;
     |FINSI;

     |HAZ TotalLinVig80;
     ||||HAZ ModPrvArt;

     nSwObra = 1;
     |HAZ Obras;
     |BUCLE CopiaDesAmpli;
|FPRC;

|PROCESO graba_lin;
     |SI aPedCompleto = "S";
          |ABRE #2;
          aponer = Asino;
          |HAZ poncontr213;
          |BUCLELIN 2SirveLinea#2;
          aponer = Anosi;
          |HAZ poncontr213;
          |CIERRA #2;
     |SINO;
          |SI #3#2 = "                    ";
               |C_M #0#3  , 1 , "N";
               |C_M #0#5  , 1 , "N";
          |SINO;
               |C_M #0#3  , 1 , "S";
               |C_M #0#5  , 1 , "S";
          |FINSI;
          |HAZ SirveLinea;
     |FINSI;
|FPRC;

|PROCESO miraserv;       ||Verifica que las lineas se puedan servir
     nPendiente = #3#5 - #3#38;
     nPendiente2 = #3#41 - #3#46;
/*
     |SI nPendiente > 0; |O nPendiente2 > 0;
          servir = "S";
          |ERROR;
     |FINSI;
*/
     #4#0 = #3#2;
     |LEE 000#4=;
     |SI #4#179 = "N"; |O #agifa142#117 = "N";  || No Tiene Doble Stock
          |SI nPendiente ! 0;
               servir = "S";
               |ERROR;
          |FINSI;
     |SINO;
          |SI #agifa142#225 = "B";
               |SI nPendiente ! 0; |O nPendiente2 ! 0;
                    servir = "S";
                    |ERROR;
               |FINSI;
          |SINO;
               |SI nPendiente ! 0; |Y nPendiente2 ! 0;
                    servir = "S";
                    |ERROR;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO CheqPreTagloma;
     |SI servir = "S";
          |ABRE #4;
          #4#0 = #3#2;
          |LEE 040#4=;
          |CIERRA #4;
          aAlfa = #3#2; |QBF aAlfa;
          |SI aAlfa ! "";
               |SI #142#225 = "B";
                    |SI #4#179 = "S"; |Y  #142#117 = "S";
                         |SI #3#38 = #3#5; |Y #3#46 = #3#41; |ACABA;  |FINSI;
                    |SINO;
                         |SI #3#38 = #3#5; |ACABA;  |FINSI;
                    |FINSI;
               |SINO;
                    |SI #3#38 = #3#5; |ACABA;  |FINSI;
                    |SI #4#179 = "S"; |Y #142#117 = "S";
                         |SI #3#46 = #3#41; |ACABA; |FINSI;
                    |FINSI;
               |FINSI;
          |FINSI;

          eaSerie = #3#28;
          enDocu = #3#0;
          enLinea = #3#1;
          |HAZ TagCheqPre;
          |SI enPrecio = 0;
               servir = "N";
               mensaje = "0000ERROR - PRECIO VENTA = 0";
               |ERROR10;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO miraserv2;       ||Verifica que las lineas se puedan servir
     nPendiente = #3#5 - #3#38;
     nPendiente2 = #3#41 - #3#46;
/*
     |SI nPendiente > 0; |O nPendiente2 > 0;
          servir = "S";
     |FINSI;
*/
     #4#0 = #3#2;
     |LEE 020#4=;

     |SI #4#179 = "N"; |O #agifa142#117 = "N";  || Tiene Doble Stock
          |SI nPendiente ! 0;
               servir = "S";
          |FINSI;
     |SINO;
          |SI #agifa142#225 = "B";
               |SI nPendiente ! 0; |O nPendiente2 ! 0;
                    servir = "S";
               |FINSI;
          |SINO;
               |SI nPendiente ! 0; |Y nPendiente2 ! 0;
                    servir = "S";
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

||Pend = Pedi + Vari - Reci

||Verifico si estoy sirviendo mas o menos de lo pedido
|PROCESO mas_o_menos; |TIPO 0;
     |SI FSalida = 17; |Y Campo = 5; || F9
          |HAZ LeePeso;
     |FINSI;
     |SI #0#12 = 0; |Y #0#21 = 0; |ACABA; |FINSI;
     |SI modo = 1; |Y #0#21 = 0; aPedCompleto = "S"; |FINSI;
     |SI aPedCompleto = "N"; |Y correcto = "N"; |Y sw_adjf1 ! 1;
         aDespreciar = "N";
         nPendiente  = #3#5 - #3#38;
         nPendiente2 = #3#41 - #3#46;
         |SI #0#5 > nPendiente; |O #0#36 > nPendiente2;
             |SI #4#176 ! "S";
                 |AVISO;
                 FSalida = 1;
                 |SI nPendiente [ 0; |O nPendiente2 [ 0;
                     |SI #agifa142#225 = "B";
                          FSalida = 0;
                     |FINSI;
                 |FINSI;
                 |SI FSalida = 1;
                      |CONFI "2400NEsta recibiendo mas de lo Pedido, Continuar : ";
                 |FINSI;
                 |SI FSalida ! 0;
                     #0#5  = nPendiente;
                     #0#36 = nPendiente2;
                     |PINTA #0#5;
                     |ERROR;
                  |SINO;
                      aDespreciar = "S";
                  |FINSI;
             |FINSI;
          |FINSI;
          |SI #0#5 < nPendiente; |O #0#36 < nPendiente2;
               |SI #4#176 ! "S";
                    |SI #142#211 = "E";
                         |AVISO;
                         |CONFI "2400NEsta recibiendo menos de lo Pedido, Despreciar : ";
                    |FINSI;
                    |SI #142#211 = "D"; FSalida = 0; |FINSI;
                    |SI #142#211 = "P"; FSalida = 1; |FINSI;
                    aDespreciar = "N";
                    |SI FSalida = 0;
                         aDespreciar = "S";
                    |FINSI;
               |FINSI;
          |FINSI;
          ||____________ Rechazos.
          |SI #142#162 = "S";
               |CONFI "2400NHay Rechazadas.. ";
               |SI FSalida = 0;
                    |PUSHV 0501 2280;
                    |BLANCO 0711 2270;
                    |ENTLINEAL #1#88 , -4 , 2 , 21 , 1 , infmot , supmot;
                    |POPV;
                |FINSI;
          |FINSI;
     |FINSI;
     |HAZ totli;
|FPRC;

|RUTINA infmot;
     #88#0 = #3#28;
     #88#1 = #3#0;
     #88#2 = #3#1;
     #88#3 = 1;
|FRUT;

|RUTINA supmot;
     #88#0 = #3#28;
     #88#1 = #3#0;
     #88#2 = #3#1;
     #88#3 = 99999;
|FRUT;

|PROCESO NoEntra; |TIPO 7;
     |SI #142#164 = "D";
          |HAZ EsIber21;
          |SI enSwIber = 0;
               |C_M #0#6, 1, "N";
               |C_M #0#30, 1, "N";
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO totli; |TIPO 0;           ||Este proceso calcula los precios
     |HAZ TotalLinVig80;
     |HAZ visual_importe2;
|FPRC;

|PROCESO poncontr213;
         fiac = Control % A109;
         fiac = fiac + relleno;
         guarda = fiac % A109;
         fiac = Control % A1001;
         Control = Control + fiac;
         Control = Control + relleno;
         Control = Control % A120;
         Control = Control + aponer;
|FPRC;

|PROCESO Conversion1;  |TIPO 7;
     |HAZ EsAlbadis;
     |SI FSalida = 0;
          eaDocu = "AC";
          eaSerie = #0#27;
          enCodigo = #0#0;
          enLinea = #0#1;
          eaArticulo = #0#2;
          eaProve = #1#3;
          enPrecio = #0#6;
          eaDivisa = #1#56;
          eaEnvase = #agifa142#72;
          |HAZ BseEntraUniC;
          #0#5 = enUnid1;
          #0#36 = enUnid2;
          #0#6 = enPrecio;
          #0#34 = Envase;
          #0#35 = enUnid3;
          |C_M #0#5, 1, "N";
     |FINSI;
     ||컴컴컴컴컴컴 Doble/Multi
     eaDocu = "agifa213";
     |HAZ DobleUni;
     |SI eaSw2Stock = "S";
          |C_M #0#5, 1, "N";
          enSinPanta = 0;
     |FINSI;
     ||컴컴컴컴컴컴컴컴컴컴컴컴
     |HAZ Envase213;
|FPRC;

|PROCESO Envase213;
     Envase    = #0#34;
     Unidades1 = #0#35;
     Unidades2 = #0#5;
     VArticulo = #0#2;
     enAlmacen = #0#3;
     eaTipo = "C";
     eaProgEnv = "albaran";
     |HAZ EntraEnvase;
     #0#34 = Envase;
     #0#35 = Unidades1;
     #0#5  = Unidades2;  |PINTA #0#5;
     |C_M #0#5, 1, "S";
     |SI enEntraEnvase ! 0;  |C_M #0#5, 1, "N";  |FINSI;
     enSinPanta = 0;
|FPRC;

|PROCESO liacarti; |TIPO 2;
     |HAZ CopiaAl80;
     |ABRE #142; |LEE 000#142p; |CIERRA #142;

     |SI nSwNoQuiero = 1;  nSwNoQuiero = 0;  |ACABA;  |FINSI;

     nForma = 0 +. 1;
     modo   = (FEntrada / 100) ! 0;
     |SI modo = 2;|O modo = 3;
          efFec = #1#1;
          enAlma = #0#3;
          |HAZ MiraHisL;
          |SI enErrHis ! 0;
               |ERROR;
               |ACABA;
          |FINSI;
     |FINSI;

        || Si es en modo de baja a todos los efectos es como si no fuera
        || completo
     |SI modo = 3; aPedCompleto = "N"; |FINSI;
     |SI aPedCompleto = "N";
          ||컴컴컴컴컴컴 Doble/Multi
          eaDocu = "agifa212";
          |HAZ UnidadMulti;
          ||컴컴컴컴컴컴컴컴컴컴컴컴컴
          |HAZ ActuaResto;
     |FINSI;
     |SI #0#12 = 0; |Y #0#21 = 0;
          enUnidPend = 0; enUnidPend2 = 0;
          enForma = nForma;
          eaDocu = "agifa213";
          |HAZ StockEntra;

          |HAZ EsTagloma;
          |SI FSalida = 0;
               eaArticulo = #0#2;
               enUniTagRes = #0#5 * nForma;
               enUniTagPen = -enUniTagRes;
               eaSerie = #0#29;
               enDocu = #0#12;
               enLinea = #0#21;
               |HAZ TagCompraVario;
          |FINSI;

          enTipEnvase = 2;
          |HAZ Envase213;

          |SI nForma = 1;
               |HAZ EsIber21;
               |SI FSalida = 0;
                    |HAZ MinimoIber;
               |FINSI;
          |FINSI;
     |FINSI;
     |SI modo = 3;
          |BUCLE BorraDesAmpli;
          ||컴컴컴컴컴컴컴컴컴컴컴
          |HAZ EsAlbadis;
          |SI FSalida = 0;
               eaDocu = "AC";
               eaSerie = #0#27;
               enCodigo = #0#0;
               enLinea = #0#1;
               |HAZ BseBorraUni;
          |FINSI;

          eaTipo        = "AC";
          eaSerie       = #0#27;
          enCodigo      = #0#0;
          enLinea       = #0#1;
          efFecha       = #1#1;
          eaArticulo    = #0#2;
          enAlmacen     = #0#3;
          enUnidades    = #0#5;
          eaAbono       = #1#42;
          eaSeriePedido = #0#29;
          enCodigPedido = #0#12;
          enLineaPedido = #0#21;
          eaDespreciar  = "N";
          eaEsNecesario = "S";
          |SUB_EJECUTA_NP "dsz00002;BAJA";
          |HAZ BorraKit;
     |FINSI;

     |SI nSwObra = 0;
          |SI nForma = 1; |HAZ Obras; |FINSI;
     |SINO;
          nSwObra = 0;
     |FINSI;

     |SI #0#12 = 0; #0#29 = ""; |PINTA #0#29; |FINSI;
|FPRC;

|PROCESO actua_cabe;
     |HAZ CalCabAgifa077;
     |HAZ pantcomp2;
|FPRC;

|PROCESO AlPedido;
     |ABRE #4;
     |ABRE #2;
     |ABRE #3;
     #2#25 = #0#29;
     #2#0 = #0#12;
     |LEE 101#2=;                    ||Leo el pedido Original
     |SI FSalida = 0;
          #3#28 = #2#25;
          #3#0 = #2#0;
          #3#1 = #0#21;
          |LEE 101#3=;               ||Leo la linea de pedido
          |SI FSalida = 0;
               #4#0 = #0#2;
               |LEE 000#4=;

               |HAZ ActuaPedido;
               |HAZ tot_ped_div;

               enForma = nForma;
               |GRABA 021#3a;
               |LIBERA #3;
          |FINSI;
          |GRABA 021#2a;
     |FINSI;
     |LIBERA #2;
     |CIERRA #2;
     |CIERRA #2;
     |CIERRA #4;
     |CIERRA #3;
     |SI nForma = 1;
          |HAZ ModPrvArt;
     |FINSI;
     |HAZ EsAlbero;
     |SI FSalida = 0;
          |HAZ AlbeFecPedi;
     |FINSI;
|FPRC;

|PROCESO MiraQueTraes;
     aDespreciar = "S";
     #905#12 = 0;
     |GRABA 020#905a;
     |LIBERA #905;
|FPRC;

|DEFBUCLE dsm00005P;
     #905#1;
     12;
     "AC", #0#27, #0#0, nLinV, "      ", 1;
     "AC", #0#27, #0#0, nLinV, "zzzzzz", 1;
     be;
     NULL, MiraQueTraes;
|FIN;

|PROCESO VariPedido;
     #3#12 = #3#12 + #905#9;
|FPRC;

|DEFBUCLE VariPedido;
     #905#1;
     ;
     "PC", #0#29, #0#12, nLinV, "      ";
     "PC", #0#29, #0#12, nLinV, "zzzzzz";
     ;
     NULL, VariPedido;
|FIN;

|PROCESO ActuaPedido;
     nLinV = #0#1;
     |SI #4#176 = "S"; |BUCLE dsm00005P;  |FINSI;

     nPreTon = 1;
     |HAZ EsVigor;
     |SI FSalida = 0;
          aAlfa = #4#110; |QBF aAlfa;   || Alfanumerico1
          aAlfa = aAlfa > "";
          |SI aAlfa = "S"; nPreTon = 1000; |FINSI;
     |FINSI;

     |SI #2#29 = "D";
          nPPort1 = #3#50 / #2#28 * #2#33;
          nPPort2 = #3#50;
     |SINO;
          nPPort1 = #3#50;
          nPPort2 = #3#50 / #2#33 * #2#28;
     |FINSI;

     importe  = #2#13;                || Imp Servido (C)
     importeD = #2#36;                || Imp Servido (C)
     |SI #4#196 = 2;
         #2#13 = #3#46 * #3#6 / nPreTon;
         #2#36 = #3#46 * #3#33 / nPreTon;
     |SINO;
         #2#13 = #3#38 * #3#6 / nPreTon;
         #2#36 = #3#38 * #3#33 / nPreTon;
     |FINSI;

     #2#13 = ((#2#13 < #3#8) < #3#27) < #3#57;
     #2#36 = ((#2#36 < #3#8) < #3#27) < #3#57;

     |SI #4#196 = 2;
          #2#13 = (#2#13 + (#3#46 * nPPort1));
          #2#36 = (#2#36 + (#3#46 * nPPort2));
     |SINO;
          #2#13 = (#2#13 + (#3#38 * nPPort1));
          #2#36 = (#2#36 + (#3#38 * nPPort2));
     |FINSI;
/*
     #2#13 = ((#2#13 < #2#5) < #2#17) < #2#6;
     #2#36 = ((#2#36 < #2#5) < #2#17) < #2#6;
*/
     nBrutoMoneda1 = #2#13;
     nImporDescue1 = (nBrutoMoneda1 % #2#5) ! nDeci_BaseMxP;
     nBrutoMoneda1 = nBrutoMoneda1 - nImporDescue1;
     nImporDescue2 = (nBrutoMoneda1 % #2#17) ! nDeci_BaseMxP;
     nBrutoMoneda1 = nBrutoMoneda1 - nImporDescue2;
     nImporDescue3 = (nBrutoMoneda1 % #2#6) ! nDeci_BaseMxP
     nBrutoMoneda1 = nBrutoMoneda1 - nImporDescue3;
     #2#13 = nBrutoMoneda1;

     nBrutoMoneda2 = #2#36;
     nImporDescue1 = (nBrutoMoneda2 % #2#5) ! nDeci_DivP;
     nBrutoMoneda2 = nBrutoMoneda2 - nImporDescue1;
     nImporDescue2 = (nBrutoMoneda2 % #2#17) ! nDeci_DivP;
     nBrutoMoneda2 = nBrutoMoneda2 - nImporDescue2;
     nImporDescue3 = (nBrutoMoneda2 % #2#6) ! nDeci_DivP;
     nBrutoMoneda2 = nBrutoMoneda2 - nImporDescue3;
     #3#36 = nBrutoMoneda2;

     #2#13 = importe - #2#13;
     #2#36 = importeD - #2#36;

     #3#38 = #3#38 +. #0#5;
     #3#46 = #3#46 +. #0#36;

     |SI aDespreciar = "S";
          nVaria1 = #3#12;
          nVaria2 = #3#44;
          |SI #4#176 = "S";   || Division Vertical
               #3#12 = 0;
               #3#44 = 0;
               nLinV = #0#21;
               |BUCLE VariPedido;
          |SINO;
               #3#12 = #3#38 - #3#37;
               #3#44 = #3#46 - #3#45;
          |FINSI;
          nVaria1 = #3#12 - nVaria1;
          nVaria2 = #3#44 - nVaria2;
          #0#22 = nVaria1;
          #0#24 = nVaria2;
     |SINO;
          |SI #142#225 = "B";
               |SI #3#37 = 0;
                    #3#12 = #3#38 - #3#37;
               |FINSI;
               |SI #3#45 = 0;
                    #3#44 = #3#46 - #3#45;
               |FINSI;
          |FINSI;
     |FINSI;

     enUnidPend =  0;
     enUnidPend2 =  0;
     |SI nForma = -1;  || Restaura Unid. Variacion Pedido
          #3#12 = #3#12 - #0#22;
          #3#44 = #3#44 - #0#24;
          enUnidPend =  #0#22;
          enUnidPend2 =  #0#24;
          #0#22 = 0;
          #0#24 = 0;
     |FINSI;

     #2#11 = #2#11 - #3#9;
     #2#34 = #2#34 - #3#34;

     #3#5  = #3#37 + #3#12;
     #3#41 = #3#45 + #3#44;

     |SI #4#196 = 2;
          #3#7    = #3#41 * #3#6 / nPreTon;
          nImpDiv = #3#41 * #3#33 / nPreTon;
     |SINO;
          #3#7    = #3#5 * #3#6 / nPreTon;
          nImpDiv = #3#5 * #3#33 / nPreTon;
     |FINSI;
     #2#44 = #2#44 - #3#56; ||P.Verde
     #3#56 = #3#5 * #4#208;
     #2#44 = #2#44 + #3#56;

     #3#9  = ((#3#7 < #3#8) < #3#27) < #3#57;
     #3#34 = ((nImpDiv < #3#8) < #3#27) < #3#57;
     |SI #4#196 = 2;
         #3#9  = (#3#9  + (#3#41 * nPPort1/nPreTon));
         #3#34 = (#3#34 + (#3#41 * nPPort2/nPreTon));
     |SINO;
         #3#9  = (#3#9  + (#3#5 * nPPort1/nPreTon));
         #3#34 = (#3#34 + (#3#5 * nPPort2/nPreTon));
     |FINSI;
/*
     #3#9  = ((#3#9  < #2#5) < #2#17) < #2#6;
     #3#34 = ((#3#34 < #2#5) < #2#17) < #2#6;
*/
     nBrutoMoneda1 = #3#9;
     nImporDescue1 = (nBrutoMoneda1 % #2#5) ! nDeci_BaseMxP;
     nBrutoMoneda1 = nBrutoMoneda1 - nImporDescue1;
     nImporDescue2 = (nBrutoMoneda1 % #2#17) ! nDeci_BaseMxP;
     nBrutoMoneda1 = nBrutoMoneda1 - nImporDescue2;
     nImporDescue3 = (nBrutoMoneda1 % #2#6) ! nDeci_BaseMxP
     nBrutoMoneda1 = nBrutoMoneda1 - nImporDescue3;
     #3#9 = nBrutoMoneda1;

     nBrutoMoneda2 = #3#34;
     nImporDescue1 = (nBrutoMoneda2 % #2#5) ! nDeci_DivP;
     nBrutoMoneda2 = nBrutoMoneda2 - nImporDescue1;
     nImporDescue2 = (nBrutoMoneda2 % #2#17) ! nDeci_DivP;
     nBrutoMoneda2 = nBrutoMoneda2 - nImporDescue2;
     nImporDescue3 = (nBrutoMoneda2 % #2#6) ! nDeci_DivP;
     nBrutoMoneda2 = nBrutoMoneda2 - nImporDescue3;
     #3#34 = nBrutoMoneda2;

     #2#11 = #2#11 + #3#9;
     #2#34 = #2#34 + #3#34;

     |SI #2#29 = "D";
         #3#36 = #3#9;
     |SINO;
         #3#36 = #3#34;
     |FINSI;

     |SI #4#196 = 2;
          importe  = #3#46 * #3#6 / nPreTon ;
          importe  = ((importe < #3#8) < #3#27) < #3#57;
          importe  = importe + (#3#46 * nPPort1);

          importeD = #3#46 * #3#33 / nPreTon;
          importeD = ((importeD < #3#8) < #3#27) < #3#57 ;
          importeD = importeD + (#3#46 * nPPort2);
     |SINO;
          importe  = #3#38 * #3#6 / nPreTon;
          importe  = ((importe < #3#8) < #3#27) < #3#57;
          importe  = importe + (#3#38 * nPPort1);

          importeD = #3#38 * #3#33 / nPreTon;
          importeD = ((importeD < #3#8) < #3#27) < #3#57;
          importeD = importeD + (#3#38 * nPPort2);
     |FINSI;
/*
     importe  = ((importe  < #2#5) < #2#17) < #2#6;
     importeD = ((importeD < #2#5) < #2#17) < #2#6;
*/
     nBrutoMoneda1 = importe;
     nImporDescue1 = (nBrutoMoneda1 % #2#5) ! nDeci_BaseMxP;
     nBrutoMoneda1 = nBrutoMoneda1 - nImporDescue1;
     nImporDescue2 = (nBrutoMoneda1 % #2#17) ! nDeci_BaseMxP;
     nBrutoMoneda1 = nBrutoMoneda1 - nImporDescue2;
     nImporDescue3 = (nBrutoMoneda1 % #2#6) ! nDeci_BaseMxP
     nBrutoMoneda1 = nBrutoMoneda1 - nImporDescue3;
     importe = nBrutoMoneda1;

     nBrutoMoneda2 = importeD;
     nImporDescue1 = (nBrutoMoneda2 % #2#5) ! nDeci_DivP;
     nBrutoMoneda2 = nBrutoMoneda2 - nImporDescue1;
     nImporDescue2 = (nBrutoMoneda2 % #2#17) ! nDeci_DivP;
     nBrutoMoneda2 = nBrutoMoneda2 - nImporDescue2;
     nImporDescue3 = (nBrutoMoneda2 % #2#6) ! nDeci_DivP;
     nBrutoMoneda2 = nBrutoMoneda2 - nImporDescue3;
     importeD = nBrutoMoneda2;

     #3#11 = #3#9  - importe;

     #2#13 = #2#13 + importe;         || Imp Servido (C)
     #2#12 = #2#11 - #2#13;           || Imp Pdte serv (C)

     #2#36 = #2#36 + importeD;        || Imp Servido (C)
     #2#35 = #2#34 - #2#36;           || Imp Pdte serv (C)

     #2#24 = #2#24 +. #0#5;           || Ctrl Servido (C)
     ||컴컴컴컴컴컴 Doble/Multi
     |SI aDespreciar = "S";
         enUnidPend = #0#5 + (nPendiente - #0#5);
         enUnidPend2 = #0#36 + (nPendiente2 - #0#36);
     |SINO;
          enUnidPend = #0#5 - enUnidPend;
          enUnidPend2 = #0#36 - enUnidPend2;
          |SI #3#37 = 0; enUnidPend = 0; |FINSI;
          |SI #3#45 = 0; enUnidPend2 = 0; |FINSI;
     |FINSI;

     |HAZ CopiaAl80;
     enForma = nForma;
     eaDocu = "agifa213";
||------ como el almacen se puede modificar, corregimos el pdte
     nPdte1 = enUnidPend;
     nPdte2 = enUnidPend2;
     enUnidPend = 0;
     enUnidPend2 = 0;
     |HAZ StockEntra;
     |HAZ StockPdte;
||-------
     |HAZ EsTagloma;
     |SI FSalida = 0;
          eaArticulo = #0#2;
          enUniTagRes = #0#5 * nForma;
          enUniTagPen = -enUniTagRes;
          eaSerie = #0#29;
          enDocu = #0#12;
          enLinea = #0#21;
          |HAZ TagCompraVario;
     |FINSI;

     enTipEnvase = 2;
     |HAZ Envase213;

     |SI nForma = 1;
          |HAZ MinimoIber;
     |FINSI;

     eaDesprecia = aDespreciar;
     nSwBsegui = 2; |HAZ BseguiAdj;

     aDespreciar = "N";
|FPRC;

||__________________________________________/ ACTUALIZACIONES

|PROCESO lee_arti;
     #4#0 = #0#2;
     |LEE 101#4=;
     |SI FSalida ! 0;
          |DDEFECTO #4;
          #4#0 = #0#2;
          #4#1 = #0#4;
          |GRABA 021#4b;
     |FINSI;
     |LIBERA #4;

     #5#0 = #0#2;
     #5#1 = #0#3;
     |LEE 101#5=;
     |SI FSalida ! 0;
          |DDEFECTO #5;
          #5#0 = #0#2;
          #5#1 = #0#3;
          #5#40 = #0#4;
          |GRABA 021#5b;
     |FINSI;
     |LIBERA #5;
|FPRC;

|PROCESO lee_clien;
     #6#0 = #0#15;
     |LEE 101#6=;
     |SI FSalida ! 0;
          |DDEFECTO #6;
          #6#0 = #0#15;
          |GRABA 021#6b;
     |FINSI;
|FPRC;

|PROCESO pend; |TIPO 6;
     nGuarda = FSalida;

     |SI FSalida = 12;
          eaProve = #1#3;
          |SI Campo = 29;     ||Llamado desde campo serie
               eaSer = "";
               enDocu = "";
               |SUB_EJECUTA "dsz00018";
               |SI enLinea ! 0;
                    #0#29 = eaSer;  |PINTA #0#29;
                    #0#12 = enDocu; |PINTA #0#12;
                    #0#21 = enLinea;|PINTA #0#21;
                    |PTEC 802;
                    |PTEC 802;
               |SINO;
                    |ERROR;
               |FINSI;
          |FINSI;
          |SI Campo = 12;
               eaSer = #0#29;
               enDocu = "";
               |SUB_EJECUTA "dsz00018";
               |SI enLinea ! 0;
                    #0#29 = eaSer;  |PINTA #0#29;
                    #0#12 = enDocu; |PINTA #0#12;
                    #0#21 = enLinea;|PINTA #0#21;
                    |PTEC 802;
               |SINO;
                    |ERROR;
               |FINSI;
          |FINSI;
          |SI Campo  = 21;
               enDocu = #0#12;
               eaSer = #0#29;
               |SUB_EJECUTA "dsz00018";
               |SI enLinea ! 0;
                    #0#29 = eaSer;  |PINTA #0#29;
                    #0#12 = enDocu; |PINTA #0#12;
                    #0#21 = enLinea;|PINTA #0#21;
               |SINO;
                    |ERROR;
               |FINSI;
          |FINSI;
     |FINSI;

     FSalida = nGuarda;
|FPRC;

|CALCULO pantcomp2;|TIPO 13;
     |SI enModoCab = 3; |ACABA; |FINSI;
     |HAZ visual_totales2; || Visualiza los totales
     ||TODO CCC
     |ABRE #142; |LEE 000#142p; |CIERRA #142;
     |SI #142#148 = "N";
          |C_V #vigm0036#42, 1, "N";
          |C_M #vigm0036#42, 1, "N";
     |SINO;
          |C_V #vigm0036#42, 1, "S";
          |C_M #vigm0036#42, 1, "S";
          |PINTA 1053, "Portes:";
     |FINSI;
     |HAZ EsTagloma;
     |SI FSalida = 0;
          eaSerie = #0#29;
          enDocu = #0#12;
          enLinea = #0#21;
          |HAZ TagPinCliArt;
     |FINSI;
|FCAL;

|PROCESO decim2;
     |SI #4#176 = "S";  |Y nPrecio ! 0;
         |SI #1#58 = "D";  || Si la moneda de trabajo es la divisa ...
             #0#30 = nPrecio;
         |SINO;
             #0#6  = nPrecio;
         |FINSI;
     |FINSI;

     |SI #1#58 = "D";  || Si la moneda de trabajo es la divisa ...
         #0#6 = #0#30 / #1#57 * #1#62;  || ... recalculo en funcion de la divisa
     |SINO;
         #0#30 = #0#6 / #1#62 * #1#57; || .. recalculo en funcion de la moneda base
     |FINSI;

     |HAZ visual_precio2; || Visualiza el precio
     ||컴컴컴컴컴컴 Doble/Multi
     eaDocu = "agifa213";
     |HAZ PintaUniMediC;
|FPRC;

|PROCESO LinDiv2;  |TIPO 7;
     aAlfa = "0000<F1> Consulta cabecera;  <F3> Estado del Pedido;  <F5> Ver Doble Stock";
     |HAZ EsTagloma;
     |SI FSalida = 0;
          aAlfa = "0000<F1> Cabecera;  <F3> Estado Pedido;  <F5> Ver Doble Stock;  <Ctrl-F2> Pre. Vta.";
     |FINSI;
     |MENSA aAlfa;

     ||컴컴컴컴컴컴 Doble/Multi
     eaDocu = "agifa213";
     |HAZ PintaUniMediC;
     ||컴컴컴컴컴컴컴컴컴컴컴컴
     |HAZ EsAlbero;
     |SI FSalida = 0;
          |HAZ AlbeAlbComLin1;
     |FINSI;
     ||컴컴컴컴컴컴컴컴컴컴컴컴
     |ABRE #agifa321;
     |LEE 001#agifa321.p;  || Leo parametros de divisa
     |SI ac_divisa = "S"; |Y pintado = 0; || Si divisas estan activadas y no he pintado ...
       |SI #1#58 = "D";   || Si la moneda de trabajo es la divisa la pinto en
         |ATRI R;         || el encabezado del precio y el importe
         titdiv = "Precio" + "(" + #1#56 + ")";
         |PINTA 1444,titdiv;
         titdiv = "I.Tot." + "(" + #1#56 + ")";
         |PINTA 1468,titdiv;
         |ATRI r;
       |FINSI;
       |SI #agifa321#4 = "S";  || Si la visualizacion esta activada ...
         mensa = "Precio:            Imp.:              T.Bruto:             T.ALB:             ";
         |PINTA 1102,mensa;  || ... pinto la linea de visualizacion
         |PINTA #0#32; || Pinto precio visual
         |PINTA #0#33; || Pinto importe visual
         |SI #1#58 = "D"; || Si la moneda de trabajo es la divisa
           |PINTA 1149,#1#67;
           |PINTA 1168,#1#68;
         |SINO;
           |PINTA 1149,#1#63;
           |PINTA 1168,#1#64;
         |FINSI;
         pintado = 1;  || Ya hemos pintado
       |FINSI;
     |FINSI;
     |CIERRA #agifa321;
|FPRC;


|PROCESO visual_precio2; || Pinta el precio visual.
|SI #1#58 = "D";  || Si la moneda de trabajo es la divisa ...
  #0#32 = #0#6;   || ... el campo visualiz. es el precio en moneda base
  |PINTA #0#30;
|SINO;            || Si la moneda de trabajo es la moneda base ...
  #0#32 = #0#30;  || ... el campo visual. es el precio en divisa
  |PINTA #0#6;
|FINSI;
|SI ac_divisa = "S"; |Y #agifa321#4= "S";
  |PINTA #0#32; || Si las divisas y la visualizacion estan activadas, pinto
|FINSI;
|FPRC;


|PROCESO visual_importe2;  || Pinta el importe visual
|SI #1#58 = "D";  || Si la moneda de trabajo es la divisa ...
  #0#33 = #0#9;   || el campo visualiz. es el importe en moneda base
  |PINTA #0#31;
|SINO;            || Si la moneda de trabajo es la moneda base ...
  #0#33 = #0#31;  || el campo visualiz. es el importe en divisa
  |PINTA #0#9;
|FINSI;
|SI ac_divisa = "S"; |Y #agifa321#4= "S";
  |PINTA #0#33; || Si las divisas y la visualizacion estan activadas, pinto
|FINSI;
|FPRC;

|PROCESO visual_totales2;
     |MODULO aprograma;
     |SI aprograma = "vigm0035";
          |ABRE #agifa321;
          |LEE 001#agifa321.p;
          |SI #1#58 = "D";
               |SI ac_divisa = "S"; |Y #agifa321#4= "S";
                    |PINTA 1149,#1#67;
                    |PINTA 1168,"        ";
                    |PINTA 1168,#1#68;
               |FINSI;
               |CIERRA #agifa321;
               |PINTA 1366,#1#64;
          |SINO;
               |SI ac_divisa = "S"; |Y #agifa321#4= "S";
                    |PINTA 1149,#1#63;
                    |PINTA 1168,"        ";
                    |PINTA 1168,#1#64;
               |FINSI;
               |CIERRA #agifa321;
               |PINTA 1366,#1#55;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO PrimeraLin;
     |DDEF aAlfa;
     aAlfa = aAlfa + "agifa080";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          #referen@#27 = #0#27;
          #referen@#0 = #0#0;
          #referen@#1 = 1;
          |LEE 000#referen@.];
          |SI FSalida = 0;|Y #referen@#27 = #0#27; |Y #referen@#0 = #0#0;
               nPrime = 0;
          |SINO;
               nPrime = 1;
          |FINSI;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |SINO;
          aAlfa = "0000Error al cargar " + aAlfa;
          |MENAV aAlfa;
     |FINSI;
|FPRC;

|PROCESO tot_ped_div;
   |SI #2#29 = "B";  || Asigna campos visual. y no visual. en el pedido segun la moneda de trabajo
     #2#37 = #2#11;
     #2#38 = #2#12;
     #2#39 = #2#13;
     #2#40 = #2#34;
     #2#41 = #2#35;
     #2#42 = #2#36;
   |SINO;
     #2#37 = #2#34;
     #2#38 = #2#35;
     #2#39 = #2#36;
     #2#40 = #2#11;
     #2#41 = #2#12;
     #2#42 = #2#13;
   |FINSI;
|FPRC;

|PROCESO comp_div; |TIPO 0;
     |SI #0#12 = 0; |Y #0#29 = 0; |ACABA; |FINSI;

     |ABRE #2;
     #2#0   = #0#12;
     #2#25  = #0#29;
     |LEE 010#2=;
     |SI FSalida = 0;
          |HAZ LeeMonBase2;
          |HAZ LeeParamDiv2;
          |HAZ PrimeraLin;
          |SI nPrime = 1;
               #1#56 = #2#27; ||Divisa
               #1#58 = #2#29; ||Moneda
               #1#3 =  #2#4;  ||Prove
               #1#8 =  #2#9;  ||FP
               #1#5 =  #2#5;  ||Dto
               #1#32 = #2#17; ||Dto
               #1#7 =  #2#6;  ||Dto
               #1#4 =  #2#8;  ||Nombre Prv
               |HAZ Param_Divisas2;
          |SINO;
               |SI #2#27 ! #1#56; |O #2#29 ! #1#58;
                    |MENAV "0000No coincide la divisa y/o la moneda de trabajo";
                    |ERROR;
                    |ACABA;
               |FINSI;
               |SI #2#4 ! #1#3;
                    |MENAV "0000Este pedido es de otro Proveedor...";
                    |ERROR;
                    |ACABA;
               |FINSI;
               |SI #2#9 ! #1#8;
                    |MENAV "0000Las forma de pago del pedido y albaran son distintas";
                    |ERROR;
                    |ACABA;
               |FINSI;
               |SI #2#5 ! #1#5; |O #2#17 ! #1#32; |O #2#6 ! #1#7;
                    |MENAV "0000Los descuentos de cabecera del pedido y albaran son distintos";
                    |ERROR;
                    |ACABA;
               |FINSI;
          |FINSI;
     |SINO;
          |MENAV "0000Este pedido no existe...";
          |ERROR;
     |FINSI;
     |CIERRA #2;
|FPRC;

|PROCESO DecimPedido; |TIPO 0;
|ABRE #agifa324;
pintado = 0;  ||Controla pintados de las lineas
#agifa324#0 = #agifa081#27;
|LEE 001#agifa324.=;   || Leo la divisa
nDeci_DivP = #agifa324#7;  || Decimales de la divisa
nDeci_PreDivP = #agifa324#9;  || Decimales en el precio de la divisa
|CIERRA #agifa324;
|FPRC;

|PROCESO Tipo7Uni;  |TIPO 7;
     |SI enSwArtiElem = 1; |ACABA; |FINSI;

     |SI #4#176 = "N";  |ACABA;  |FINSI;

     eaTipo        = "AC";
     eaSerie       = #0#27;
     enCodigo      = #0#0;
     enLinea       = #0#1;
     efFecha       = #1#1;
     eaArticulo    = #0#2;
     enAlmacen     = #0#3;
     enUnidades    = #0#5;
     enTBruto      = #0#7;
     eaAbono       = #1#42;
     enTarifa      = 0;
     eaSeriePedido = #0#29;
     enCodigPedido = #0#12;
     enLineaPedido = #0#21;
     eaDespreciar  = "N";
     eaEsNecesario = "S";
     eaProve       = #1#3;
     enCamBas      = #1#57;
     eaMoneda      = #1#58;
     enCamDiv      = #1#62;
     |SUB_EJECUTA_NP "dsz00002";

     #0#3    = enAlmacen;
     #0#5    = enUnidades;
     nPrecio = enTBruto / enUnidades;
     #0#6    = nPrecio;

     |PTEC 802;
     |PTEC 802;
|FPRC;

|PROCESO Tipo11213;  |TIPO 11;
     nTecla = FSalida;
     ||컴컴컴컴컴컴컴컴컴컴컴컴
     |HAZ EsAlbero;
     |SI FSalida = 0;
          |HAZ AlbeAlbComLin2;
     |FINSI;
     ||컴컴컴컴컴컴컴컴컴컴컴컴
     |SI nTecla = 7;  |Y #4#176 = "S";
         |MENAV "      Imposible abortar;  Termine de introducir la linea y efectue una Baja.";
         |ERROR; |ACABA;
     |FINSI;

     |SI nTecla = 13;         ||F5
          |HAZ EsAlbadis;
          |SI FSalida = 0;
               eaDocu = "AC";
               eaSerie = #0#27;
               enCodigo = #0#0;
               enLinea = #0#1;
               enPrecio = #0#6;
               enPVerde = #0#44;
               |HAZ BseVerUni;
               |ERROR; |ACABA;
          |FINSI;

          |HAZ VerKit;
          ||컴컴컴컴컴컴 Doble/Multi
          eaDocu = "agifa213";
          |HAZ VerDobleUni;
          |ERROR; |ACABA;
          ||컴컴컴컴컴컴컴컴컴컴컴컴
     |FINSI;

     |SI nTecla = 11;
          ser_ped = #0#29;
          num_ped = #0#12;
          lin_ped = #0#21;
          |SUB_EJECUTA_NP "dsy00003";
          |ERROR;
          |ACABA;
     |FINSI;
     |SI nTecla = 20;          ||Ctrl+F2
          |HAZ EsTagloma;
          |SI FSalida = 0;
               eaArticulo = #0#2;
               |HAZ TagPrecio;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Tipo5_213;  |TIPO 5;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo ! 4;
          |HAZ actalc;
     |FINSI;
|FPRC;

|PROCESO ModPrvArt;
     |SI #142#209 = "S";
          |ABRE #4;
          #4#0 = #0#2;
          |LEE 101#4=;
          |SI FSalida = 0; |Y  #4#27 ! #1#3;
               aAlfa = "0000N Modificar Proveedor en Articulo:"+&13+"Articulo:["+#0#2+"]"+&13+"Actual:["+#4#27+"]";
               |CONFI aAlfa;
               |SI FSalida = 0; #4#27 = #1#3; |GRABA 020#4a; |FINSI;
          |FINSI;
          |CIERRA #4;
     |FINSI;
|FPRC;

|PROCESO Obras;
     |HAZ EsReysor;
     |SI FSalida = 0;
         modfot = (FEntrada / 100) ! 0;
         serfot = #0#27;
         numfot = #0#0;
         linfot = #0#1;
         canfot = #0#5;
         impfot = #0#9;
         artfot = #0#2;
         prefot = #0#30;
         |SUB_EJECUTA_NP "obras016";
     |FINSI;
|FPRC;

|PROCESO BseguiAdj;
     |HAZ EsAlbadis;
     |SI FSalida = 0;
          eaSeriePedido = #3#28;
          enCodigPedido = #3#0;
          enLineaPedido = #3#1;
          eaSerie = #0#27;
          enCodigo = #0#0;
          enLinea = #0#1;
          |SI nSwBsegui = 1; |HAZ BseAdjUniC1; |FINSI;
          |SI nSwBsegui = 2; |HAZ BseAdjUniC2; |FINSI;
     |FINSI;
|FPRC;

|PROCESO MinC213;
     #referen@#27 = #1#50;
     #referen@#0 = #1#0;
     #referen@#1 = 001;
|FPRC;

|PROCESO MaxC213;
     #referen@#27 = #1#50;
     #referen@#0 = #1#0;
     #referen@#1 = 999;
|FPRC;

|PROCESO Consulta213; |TIPO 66;
     nLin = 0;
     |DDEF aAlfa;
     aAlfa = aAlfa + "agifa080";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          |CONSULTA_F_CLAVE #1#referen@, MinC213, MaxC213;
          |SI FSalida = 0; nLin = #referen@#1; |FINSI;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
     |SI nLin ! 0;
          |PTEC 802;
          aAlfa = ("000" + nLin) % -103;
          aPtec = aAlfa % 301; nPtec = &aPtec;
          |PTEC nPtec;
          aPtec = aAlfa % 201; nPtec = &aPtec;
          |PTEC nPtec;
          aPtec = aAlfa % 101; nPtec = &aPtec;
          |PTEC nPtec;
     |FINSI;
|FPRC;

|PROCESO Tipo7_2_213; |TIPO 7;
     articulo = #0#2;
|FPRC;

|PROCESO Tipo7_3_213; |TIPO 7;
     nalmacen = #0#3;
|FPRC;

|PROCESO MinAlma213;
     #5#0 = #0#2;
     #5#1 = 1;
|FPRC;

|PROCESO MaxAlma213;
     #5#0 = #0#2;
     #5#1 = 99999;
|FPRC;

|PROCESO CogePreCom;
     |SI FSalida = 13; || F5;
          |ABRE #5;
          #5#0 = #0#2;
          #5#1 = #0#3;
          |LEE 000#5];
          |CONSULTA_F_CLAVE #1#5, MinAlma213, MaxAlma213;
          |SI FSalida = 0;
               #0#3 = #5#1; |PINTA #0#3;
          |SINO;
               |ERROR; |ACABA;
          |FINSI;
          |CIERRA #5;
     |FINSI;

     nModo = (FEntrada / 100) ! 0;
     |SI #0#21 ! 0; |ACABA; |FINSI;
     |SI nModo = 1; |O articulo ! #0#2; |O nalmacen ! #0#3;
          articulo = #0#2;
          nalmacen = #0#3;
          ||컴컴컴컴컴컴 Doble/Multi
          eaDocu = "agifa080";
          |HAZ LeePreDtoCom;
          #0#6 = enPrecio;
          #0#30 = enPreDiv;
          #0#8 = enDto1;
          #0#26 = enDto2;
          #0#45 = enDto3;
          ||컴컴컴컴컴컴컴컴컴컴컴컴컴
          |PINTA #0#8;
          |PINTA #0#26;
          |PINTA #0#45;
          |SI #1#58 = "D";  || Si la moneda de trabajo es la divisa ...
              #0#6 = #0#30 / #1#57 * #1#62;  || ... recalculo en funcion de la divisa
              |PINTA #0#30;
          |SINO;
              #0#30 = #0#6 / #1#62 * #1#57; || .. recalculo en funcion de la moneda base
              |PINTA #0#6;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Alma213_66; |TIPO 66;
     |ABRE #29;
     #29#0 = #0#3;
     |LEE 000#29];
     |CONSULTA_CLAVE #1#29;
     |SI FSalida = 0;
          #0#3 = #29#0;
          |PINTA #0#3;
     |SINO;
          |ERROR;
     |FINSI;
     |CIERRA #29;
|FPRC;

|PROCESO CalcuUni; |TIPO 0;
     |SI FSalida = 17; || F9
          |HAZ LeePeso;
     |FINSI;
     |SI #0Campo ! Contenido;
          #0#5 = #0#45 - #0#46;
          |PINTA #0#5;
     |FINSI;
|FPRC;

|PROCESO LeePeso; |TIPO 0;
     nPeso = 0;
     aAlfa = "/ds/bin/leepeso";
     |RSYSTEM aAlfa;
     |SLEEP 1;
     aAlfa = "/ds/peso.txt";
     |XABRE "CU", aAlfa, nHandle;
     |SI FSalida ! 0 ;
          aAlfa = "0000no puede abrir " + aAlfa;
          |MENAV aAlfa;
     |SINO;
          |XLEE nHandle ,250 , aAlfa;
          nPeso = aAlfa;
          |XCIERRA nHandle;
     |FINSI;
     #0Campo = nPeso;
     |PINTA #0Campo;
|FPRC;

|PROCESO CopiaAl80;
     |PARA i = 0; |SI i [ 45; |HACIENDO i = i + 1;
          #80i = #i;
     |SIGUE;
|FPRC;

|PROCESO StockPdte;
     |ABRE #5;
     #5#0 = #3#2;
     #5#1 = #3#3;
     |LEE 101#5=;
     |SI FSalida = 0;
          #5#43 = #5#43 - (nPdte1 * nForma);
          #5#45 = #5#45 - (nPdte2 * nForma);
          |GRABA 020#5a;
     |FINSI;
     |CIERRA #5;
|FPRC;

|PROCESO IVA036_66; |TIPO 66;
     enTiva = #0Campo;
     efFiva = #1#1;
     |HAZ ConsuIVA;
     |SI eaDiva = "";
          |ERROR;
     |SINO;
          #0Campo = enTiva; |PINTA #0Campo;
     |FINSI;
|FPRC;

|PROCESO IVA036_0; |TIPO 0;
     enTiva = #0Campo;
     efFiva = #1#1;
     |HAZ SacaIVA;
     |SI eaDiva = "";
          |MENAV "0000No existe tipo iva para esta fecha...";
          |ERROR; |ACABA;
     |FINSI;
|FPRC;
