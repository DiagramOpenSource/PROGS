|FICHEROS;
     agifa142 #0;
     goparame #1;
     gomantho #2;
     agifa081 #3;
     gocodpos #4;
     agifa017 #17;
     agifa019 #19;
     agifa029 #29;
     agif0041 #41;

     gomantl1 #100;

     gocerc01 #101;
     gocerc02 #102;
     agifa724 #724;
     gopre001 #201;
|FIN;
----------------------------------------------------------------------
|VARIABLES;
     &enAlmaCompras = 0;
     &enAlmaDepo = 0;
     qAlta = "";
     &eaSerie   = "";
     &enNuPre   = 0;
     i         = 0;
     nModo     = 0;
     &cSerFmt  = "";
     &nDecUni  = "";
     aAlfa     = "";
     nPos      = 0;
     aEmp      = "";
     nEmp      = 0;
     aBase     = "";
|FIN;
----------------------------------------------------------------------
|PROCESO FmtSerie; |TIPO 0;
     |ABRE #0;
     |LEE 000#0p;

     |SI FSalida ! 0;
          |CONFI "0000SPARAMETROS GENERALES DE GESTION NO DEFINIDOS";

          |SI FSalida = 0;
               |SUB_EJECUTA_NP "agifa142"
               |LEE 000#0p;
          |SINO;
               cSerFmt = "";
               |ACABA;
          |FINSI;

     |FINSI;


     |SI FSalida = 0;
          aAlfa = cSerFmt; |QBF aAlfa;
          nPos = 100 + #0#155;
          cSerFmt = aAlfa % nPos;
     |FINSI;

     |CIERRA #0;
|FPRC;
-------------------------------------------------------------------------------
|PROCESO DirEnvObra; |TIPO 0;
     |ABRE #2;
     |SELECT #2#2;
     #2#28 = #3#25;
     |LEE 000#2=;
     |SI FSalida = 0;
          #3#19 = #2#29;       || nombre de la empresa
          #3#18 = #2#3;        || direccion de la empresa
          |ABRE #4;
          #4#0 = #2#4;
          |LEE 000#4=;
          #3#20 = #4#1;        || poblacion de la empresa
          #3#21 = #4#3;        || provincia de la empresa
          |CIERRA #4;
     |FINSI;
     |CIERRA #2;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
   CONSULTA PRESUPUESTOS
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴

|PROCESO CopPresu;
     |PARA i = 0; |SI i [ 26; |HACIENDO i = i + 1;
          #102i = #100i;
     |SIGUE;
     |ABRE #201;
     #201#0 = #102#3;
     #201#1 = #102#4;
     |LEE 000#201=;
     |CIERRA #201;

     #102#27 = #201#8;     || Titulo
     |GRABA 020#102n;
|FPRC;

|DEFBUCLE CopPresu;
     #100#1;
     ;
     #101#0, #101#1, 001;
     #101#0, #101#1, 999;
     ;
     NULL, CopPresu;
|FIN;

|PROCESO CopSerie;
     |PARA i = 0; |SI i [ 34; |HACIENDO i = i + 1;
          #101i = #2i;
     |SIGUE;
     |GRABA 020#101n;
|FPRC;

|DEFBUCLE CopSerie;
     #2#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, CopSerie;
|FIN;

|PROCESO ConsuPres; |TIPO 0;
     |SI FSalida ! 13;
          |ACABA;
     |FINSI;

     eaSerie = "";
     enNuPre = 0;

     aAlfa = Usuario; |QBF aAlfa;
     aAlfa = "1" + aAlfa;
     |NOME_DAT #101 aAlfa;
     |DELINDEX #101;
     |ABRE #101;
     |BUCLE CopSerie;
     |LEE 000#101p;
     |CONSULTA_CLAVE #1#101;
     |SI FSalida = 0;
          aAlfa = Usuario; |QBF aAlfa;
          aAlfa = "2" + aAlfa;
          |NOME_DAT #102 aAlfa;
          |DELINDEX #102;
          |ABRE #102;
          |BUCLE CopPresu;
          |CONSULTA_CLAVE #1#102;
          |SI FSalida = 0;
               eaSerie = #102#3;
               enNuPre = #102#4;
          |SINO;
               |ERROR;
          |FINSI;
          |CIERRA #102;
          |DELINDEX #102;
     |SINO;
          |ERROR;
     |FINSI;
     |CIERRA #101;
     |DELINDEX #101;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO LeeEmpresa;
     |DFICE aAlfa;
     aEmp = aAlfa % -205;
     nEmp = aEmp;

     |DBASE aBase;
     aBase = aBase + "fich/";
     |PATH_DAT #41 aBase;
     |ABRE #41;
     #41#0 = nEmp;
     |LEE 000#41=;
     |CIERRA #41;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴

|PROCESO ModifPres; |TIPO 6;
  |FICHEROS;
     gopre001 #1000;
  |FIN;

  |VARIABLES;
      nNume1  = 0;

      &eaTipo = "";
      &enNum = 0;   || Devuelve el incremento que se le debe dar al tipo
                    || seleccionado. Devuelve cero en caso de no haber
                    || duplicacion
      &eaSer = "";
  |FIN;

  |ABRE #goparame;
  |LEE 000#goparame.p;
  |SI FSalida ! 0;
     |DDEFECTO #goparame;
  |FINSI;
  |CIERRA #goparame;

  |QBF eaTipo; |SALVA_DATOS #gopre001;

  |SI eaTipo = "F";
     |SI enNum < #goparame#58; |O enNum > #goparame#59;
          |ACABA;
        |||MENAV "    Contador fuera del rango";
        ||enNum = -1; |ACABA;
     |FINSI;

     |SI #goparame#52 = "N"; |ACABA; |FINSI;
     |SI #goparame#55 = "N";
        |MENAV "    No hay copias de trabajo del presupuesto"; |ACABA;
     |FINSI;

     |SI #goparame#55 = "S";
        nNume1 = enNum; enNum = enNum + #goparame#54;
        #gopre001#0 = eaSer;
        #gopre001#1 = enNum;
        |LEE 000#gopre001.=;
        |SI FSalida ! 0; enNum = nNume1; |FINSI;
     |FINSI;
  |FINSI;

  |SI eaTipo = "P";
     nModo = (FEntrada / 100) ! 0;
     |SI nModo ! 3;
        |SI enNum < #goparame#58; |O enNum > #goparame#59;
           |MENAV "    Contador fuera del rango";
           enNum = -1; |ACABA;
        |FINSI;
     |FINSI;

     |SI #goparame#52 = "N"; |ACABA; |FINSI;
     |SI #goparame#55 = "N";
        |MENAV "    No hay copias de trabajo del presupuesto"; |ACABA;
     |FINSI;

     |SI #goparame#55 = "S";
        nNume1 = enNum; enNum = enNum + #goparame#54;
        #gopre001#0 = eaSer;
        #gopre001#1 = enNum;
        |LEE 000#gopre001.=;
        |SI FSalida ! 0; enNum = nNume1; |FINSI;
     |FINSI;
  |FINSI;

  |SI eaTipo = "C";
     |SI #goparame#52 = "N"; |ACABA; |FINSI;
     |SI #goparame#55 = "N";
        |MENAV "    No hay copias de trabajo del presupuesto"; |ACABA;
     |FINSI;

     |SI #goparame#55 = "S";
        nNume1 = enNum; enNum = enNum + #goparame#54;
        #gopre001#0 = eaSer;
        #gopre001#1 = enNum;
        |LEE 000#gopre001.=;
        |SI FSalida ! 0; enNum = nNume1; |FINSI;
     |FINSI;
  |FINSI;

  |SI eaTipo = "E1";
     nModo = (FEntrada / 100) ! 0;
     |SI nModo ! 3;
        |SI enNum < #goparame#58; |O enNum > #goparame#59;
           |MENAV "    Contador fuera del rango";
           enNum = -1; |ACABA;
        |FINSI;
     |FINSI;

     |SI #goparame#52 = "N"; |ACABA; |FINSI;
     |SI #goparame#55 = "S";
        nNume1 = enNum; enNum = enNum + #goparame#54;
        #gopre001#0 = eaSer;
        #gopre001#1 = enNum;
        |LEE 000#gopre001.=;
        |SI FSalida ! 0; enNum = nNume1; |FINSI;
     |FINSI;
     |SI #goparame#57 = "S"; |Y #goparame#55 = "N";
        nNume1 = enNum; enNum = enNum + #goparame#56;
        #gopre001#0 = eaSer;
        #gopre001#1 = enNum;
        |LEE 000#gopre001.=;
        |SI FSalida ! 0; enNum = nNume1; |FINSI;
     |FINSI;
  |FINSI;

  |SI eaTipo = "E2";
     |SI #goparame#52 = "N"; |ACABA; |FINSI;
     |SI #goparame#57 = "S";
        nNume1 = enNum; enNum = enNum + #goparame#56;
        #gopre001#0 = eaSer;
        #gopre001#1 = enNum;
        |LEE 000#gopre001.=;
        |SI FSalida ! 0; enNum = nNume1; |FINSI;
     |FINSI;
  |FINSI;

  |SI eaTipo = "E";
     |SI enNum < #goparame#58; |O enNum > #goparame#59;
        |MENAV "    Contador fuera del rango";
        enNum = -1; |ACABA;
     |FINSI;
     |SI #goparame#52 = "N"; |ACABA; |FINSI;
     |SI #goparame#55 = "S";
        nNume1 = enNum; enNum = enNum + #goparame#54;
     |FINSI;
  |FINSI;
/*
  nModo = (FEntrada / 100) ! 0;
  |SI nModo = 1; |Y eaTipo ! "C"; |Y eaTipo ! "F"; |ACABA; |FINSI;

  |SI eaTipo = "E"; |O eaTipo = "F";
     |SI enNum < #goparame#58; |O enNum > #goparame#59;
        |MENAV "    Contador fuera del rango";
        enNum = -1; |ACABA;
     |FINSI;
  |FINSI;

  |SI #goparame#52 = "N"; |ACABA; |FINSI;
  |SI #goparame#55 = "N"; |Y #goparame#57 = "N";
     |MENAV "    No hay copias de trabajo del presupuesto"; |ACABA;
  |FINSI;

  |SALVA_DATOS #gopre001;
  |SI #goparame#55 = "S";
     nNume1 = enNum; enNum = enNum + #goparame#54;
     #gopre001#0 = eaSer;
     #gopre001#1 = enNum;
     |LEE 000#gopre001.=;
     |SI FSalida ! 0; enNum = nNume1; |FINSI;
  |FINSI;
  |SI #goparame#57 = "S"; |Y eaTipo = "E";
     nNume1 = enNum; enNum = enNum + #goparame#56;
     #gopre001#0 = eaSer;
     #gopre001#1 = enNum;
     |LEE 000#gopre001.=;
     |SI FSalida ! 0; enNum = nNume1; |FINSI;
  |FINSI;
*/
  |REPON_DATOS #gopre001; |LEE 000#gopre001.=;
|FPRC;
