|FICHEROS;
     solz0007 #0;
     solm0002 #2;
     solm0003 #3;
     solm0005 #5;
     solm0017 #17;
     solm0017@;
|FIN;

|VARIABLES;
     &enHuerto = 0;
     &enContra = 0;
     &enConta = 0;
     &enAno = 0;

     f = @;
     fDesde = @;
     fHasta = @;
     fFecha = @;
     aAlfa = "";
|FIN;

|PROCESO Lecturas;
     #17#6 = #17#6 + #5#9;
|FPRC;

|DEFBUCLE Lecturas;
     #5#1;
     ;
     #17#0, #17#1, #17#2, #17#3, 01;
     #17#0, #17#1, #17#2, #17#3, 12;
     ;
     NULL, Lecturas;
|FIN;

|PROCESO GraMaximos;
     #17#4 = #3#18;
     #17#5 = #3#17;
     #17#6 = 0;
     #17#7 = #3#2;
     |BUCLE Lecturas;
     |SI #3#18 ! 0;
          #solm0017@#0 = #17#0;
          #solm0017@#1 = #17#1;
          #solm0017@#2 = #3#18;
          #solm0017@#3 = #17#3;
          |LEE 000#solm0017@.=;
          |SI FSalida = 0;
               #17#6 = #17#6 + #solm0017@#6;
          |FINSI;
     |FINSI;
     |GRABA 020#17a;
     |LIBERA #17;
|FPRC;

|PROCESO ContratoLin;
     aAlfa = "01.01." + (#3#5 % -104);
     fDesde = aAlfa;

     aAlfa = "01.01." + (#3#6 % -104);
     fHasta = aAlfa;

     |SI fFecha < fDesde; |O fFecha > fHasta;
          |ACABA;
     |FINSI;

     |DDEFECTO #17;
     #17#0 = #3#0;
     #17#1 = #3#1;
     #17#2 = #3#3;
     #17#3 = #0#0;
     |LEE 000#17=;
     |SI FSalida ! 0; |GRABA 020#17b; |FINSI;
     |HAZ GraMaximos;
|FPRC;

|PROCESO Contrato;
     aAlfa = "01.01." + (("0000" + #0#0) % -104)
     fFecha = aAlfa;

     aAlfa = "01.01." + (#2#2 % -104);
     fDesde = aAlfa;

     aAlfa = "01.01." + (#2#3 % -104);
     fHasta = aAlfa;
     |SI #2#3 [ "01.01.0000";
          fHasta = "31.12.9999";
     |FINSI;

     |SI fFecha < fDesde; |O fFecha > fHasta;
          |ERROR;
     |FINSI;
|FPRC;

|DEFBUCLE Contrato;
     #2#1;
     ;
     #0#1, #0#3;
     #0#2, #0#4;
     ;
     NULL, Contrato, ContratoLin;
|FIN;

|PROCESO Tipo7; |TIPO 7;
     f = ~;
     aAlfa = f % 704;
     #0#0 = aAlfa;
|FPRC;

|PROCESO Tipo3; |TIPO 3;
     |ABRE #17;
     |BUCLE Contrato;
     |CIERRA #17;
|FPRC;

|PROGRAMA;
     |DDEF aAlfa;
     aAlfa = aAlfa + "solm0017";
     |CARGA_DEF aAlfa, solm0017@;
     |SI FSalida = 0;
          |ABRE #solm0017@;
          |SI enAno = 0;
               |MANTE #0;
          |SINO;
               |DDEFECTO #3;
               |ABRE #3;
               |SELECT #2#3;
               #3#3 = enConta;
               #3#0 = enHuerto;
               #3#1 = enContra;
               |LEE 000#3=;
               |CIERRA #3;

               |ABRE #17;
               |DDEFECTO #17;
               #17#0 = enHuerto;
               #17#1 = enContra;
               #17#2 = enConta;
               #17#3 = enAno;
               |LEE 101#17=;
               |SI FSalida ! 0; |GRABA 020#17b; |FINSI;
               |HAZ GraMaximos;
               |CIERRA #17;
          |FINSI;
          |CIERRA #solm0017@;
          |DESCARGA_DEF #solm0017@;
     |FINSI;
|FPRO;
