|FICHEROS;
     fergam06 #0;
     fergam07 #1,MANTE;
     fergam08 #2,MANTE;
     fergam11 #3,MANTE;
     fergam03 #30;
     agifa019 #19;
     agifa073 #73;
     agifa104 #104;
     referen@ #10;
|FIN;

|VARIABLES;
     nHora = 0;
     nHora1 = 0;
     nHora2 = 0;
     nTiempo = 0;
     aLon = "";
     aHora = "";
     nMinu = 0;
     aAlf1 = "";
     aAlf2 = "";
     aAlf3 = "";
     nPanta = 0;
     nModo = 0;
     nModoEntra = 0;
     aAlfa = "";
     nGrid1 = -1;
     nRango = 0;
     nForma = 0;
     nId = 0;
     nLin = 0;
     nBtnConsulta = -1;
     nGrid = 0;
     nGrid2 = 0;
     nGrid3 = 0;
     nNum = 0;
     nPendiente = 0;
     aEstaPendiente = "";
     &Tempo = "";
     nError = 0;
     aMensa = "";
     aConte = "";
|FIN;

|INCLUYE i_escand;

|PROCESO Evento;
     |SI FSalida = 1; |O FSalida = 2;
          |SELECT #1#1;
          |LEE 000#1=;
          |REFRESCACONTROL nGrid3;
          |REFRESCACONTROL nGrid2
     |FINSI;
     |SI FSalida = 4;
     |FINSI;
|FPRC;

|PROCESO Min3;
     #3#0 = #1#0;
     #3#1 = #1#1;
     #3#2 = "                              ";
|FPRC;

|PROCESO Max3;
     #3#0 = #1#0;
     #3#1 = #1#1;
     #3#2 = "zzzzzzzzzzzzzzzzzzzzzzzzzzzzzz";
|FPRC;

|PROCESO Min2;
     #2#0 = #1#0;
     #2#1 = #1#1;
     #2#2 = 001;
|FPRC;

|PROCESO Max2;
     #2#0 = #1#0;
     #2#1 = #1#1;
     #2#2 = 999;
|FPRC;

|PROCESO Min;
     #1#0 = #0#0;
     #1#1 = 001;
|FPRC;

|PROCESO Max;
     #1#0 = #0#0;
     #1#1 = 999;
|FPRC;

|PROCESO T3_14; |TIPO 14;    ||(*)
     |SI nGrid1 = -1;
          nRango = 4 + 8 + 16 + 32;
          |LINEAL_SIMPLE #1#1, nRango, 1502, 2770, Min, Max, Evento;
          nGrid1 = FSalida;

          |LINEAL_SIMPLE #1#3, nRango, 1572, 2798, Min3, Max3, NULL;
          nGrid3 = FSalida;

          nRango = 1 + 4 + 8 + 16 + 32;
          |LINEAL_SIMPLE #1#2, nRango, 2802, 4498, Min2, Max2, NULL;
          nGrid2 = FSalida;
     |FINSI;
|FPRC;

|PROCESO T3_8; |TIPO 8; ||(*)
     |ABRET #1;
     |ABRET #2;
     |ABRET #3;
|FPRC;

|PROCESO T3_9; |TIPO 9; ||(*)
     |CIERRAT #3;
     |CIERRAT #2;
     |CIERRAT #1;
|FPRC;

|PROCESO BorraPartida;
     |BORRA 020#3a;
     |LIBERA #3;
|FPRC;

|DEFBUCLE BorraPartida;
     #3#1;
     ;
     #1#0, #1#1, "                              ";
     #1#0, #1#1, "zzzzzzzzzzzzzzzzzzzzzzzzzzzzzz";
     be;
     NULL, BorraPartida;
|FIN;

|PROCESO BorraMaquina;
     |BORRA 020#2a;
     |LIBERA #2;
|FPRC;

|DEFBUCLE BorraMaquina;
     #2#1;
     ;
     #1#0, #1#1, 001;
     #1#0, #1#1, 999;
     be;
     NULL, BorraMaquina;
|FIN;

|PROCESO BorraCompo;
     |BUCLE BorraMaquina;
     |BUCLE BorraPartida;

     |BORRA 020#1a;
     |LIBERA #1;
|FPRC;

|DEFBUCLE BorraCompo;
     #1#1;
     ;
     #0#0, 001;
     #0#0, 999;
     be;
     NULL, BorraCompo;
|FIN;

|PROCESO T3_2; |TIPO 2; ||(*)
     nModo = (FEntrada / 100) ! 0;
     nForma = 0 +. 1;
     |SI nModo = 3;
          |HAZ CheqOrden;
          |SI nError ! 0;
               |SI nForma = -1;
                    |MENAV aMensa;
               |FINSI;
               |ERROR; |ACABA;
          |FINSI;
     |FINSI;
     |SI nModo = 3;
          |BUCLE BorraCompo;
     |FINSI;
|FPRC;

|PROCESO T3_0; |TIPO 0;     ||(*)
     aAlfa  = "|X000"; aAlfa = #0aAlfa; nId = aAlfa;
     |ESTADO_CONTROL nId, "ENABLE";

     |REFRESCACONTROL nGrid3;
     |REFRESCACONTROL nGrid1;
|FPRC

|PROCESO T3_12; |TIPO 12;    ||(*)
     |SI nModoEntra = 1; |Y FSalida = 7;
          |BUCLE BorraCompo;
     |FINSI;
|FPRC;

|PROCESO T3_30; |TIPO 30;    ||(*)
     nModo = (FEntrada / 100) ! 0;

     #1#0 = #0#0;
     #1#1 = 1;
     |LEE 000#1];
     |SI FSalida ! 0; |O #1#0 ! #0#0;
          |SI nModo = 1;
               |MENAV "0000Se anulan los datos entrados.";
          |SINO;
               |MENAV "0000No existen lineas, se borra la cabecera.";
          |FINSI;
          |BORRA 020#0a;
          |ERROR;
     |FINSI;
|FPRC;

|PROCESO T3_13; |TIPO 13;
     |PINPA #0#0; nPanta = FSalida;
|FPRC;

|PROCESO T3_20; |TIPO 20;
     nModo = (FEntrada / 100) ! 0;
     |SI FSalida = "OPCION";
          FSalida = "";
     |SINO;
     |FINSI;
|FPRC;

|PROCESO T3_7; |TIPO 7;
     nModoEntra = (FEntrada / 100) ! 0;
     |SI nModoEntra = 1;
          aAlfa  = "|X000"; aAlfa = #0aAlfa; nId = aAlfa;
          |ESTADO_CONTROL nId, "DISABLE";

          |HAZ DefNumero;
     |FINSI;
|FPRC;

|PROCESO T3_1_7; |TIPO 7;
     nModoEntra = (FEntrada / 100) ! 0;
     |SI nModoEntra = 1;
          |BUCLE BorraCompo;
          |REFRESCACONTROL nGrid3;
          |REFRESCACONTROL nGrid1;
     |FINSI;
     |ESTADO_CONTROL nBtnConsulta, "DISABLE";
|FPRC;

|PROCESO DefeLin; |TIPO 7;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 1;
          #1#0 = #0#0;
          #1#1 = 999;
          |LEE 000#1];
          |SI FSalida = 0;
               |LEE 000#1a;
          |SINO;
               |LEE 000#1u;
          |FINSI;
          |SI FSalida = 0; |Y #1#0 = #0#0;
               nLin = #1#1 + 1;
          |SINO;
               nLin = 1;
          |FINSI;
          |DDEFECTO #1;
          #1#0 = #0#0;
          #1#1 = nLin; |PINTA #1#1;
          #1#2 = #0#2; |PINTA #1#2;
          #1#3 = #0#3; |PINTA #1#3;
          aAlfa  = "|X000"; aAlfa = #0aAlfa; nId = aAlfa;
          |ESTADO_CONTROL nId, "ENABLE";
     |FINSI;
|FPRC;

|PROCESO DefNumero;
     |LEE 000#0u;
     |SI FSalida = 0;
          nNum = #0#0 + 1;
     |SINO;
          nNum = 1;
     |FINSI;
     |DDEFECTO #0;
     #0#0 = nNum;
|FPRC;

|PROCESO Pedido66; |TIPO 66;
     |ABRE #104;
     #104#25 = #0#2;
     #104#0 = #0#3;
     |LEE 000#104=;
     |CONSULTA_CLAVE #1#104;
     |SI FSalida = 0;
          #0#2 = #104#25; |PINTA #0#2;
          #0#3 = #104#0; |PINTA #0#3;
     |SINO;
          |ERROR;
     |FINSI;
     |CIERRA #104;
|FPRC;

|PROCESO CabPed;
     aEstaPendiente = "N";
|FPRC;

|PROCESO LinPed;
     nPendiente = #73#5 - #73#43;
     |SI nPendiente > 0;
          aEstaPendiente = "S";
     |FINSI;
|FPRC;

|PROCESO FinPed;
     |SI aEstaPendiente = "S";
          |SALVA_DATOS #104;
          |REPON_DATOS #referen@;
          |GRABA 020#referen@.n;
     |FINSI;
|FPRC;

|DEFBUCLE Pedidos;
     #104#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, CabPed, LinPed, FinPed;
|FIN;

|PROCESO Pdte; |TIPO 6;
     |SI FSalida = 13;
          |DDEF aAlfa;
          aAlfa = aAlfa + "agifa104";
          |CARGA_DEF aAlfa, referen@;
          |SI FSalida = 0;
               |HAZ CreaTempo; |NOME_DAT #referen@#Tempo#; |DELINDEX #referen@;
               |ABRE #referen@;
               |BUCLE Pedidos;
               |LEE 000#referen@.p;
               |SI FSalida = 0;
                    |CONSULTA_CLAVE #1#referen@;
                    |SI FSalida = 0;
                         #0#2 = #referen@#25; |PINTA #0#2;
                         #0#3 = #referen@#0; |PINTA #0#3;
                    |SINO;
                         |ERROR;
                    |FINSI;
               |SINO;
                    |MENAV "0000No hay pedidos pendientes...";
                    |ERROR;
               |FINSI;
               |CIERRA #referen@; |HAZ BoraTempo; |DELINDEX #referen@;
               |DESCARGA_DEF #referen@;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO CheqOrden;
     nError = 0;
     |SI #0#7 ! 0; |O #0#8 = "S";
          aMensa = "0000Orden con unidades fabricadas y/o finallizada...";
          nError = 1;
     |SINO;
          #2#0 = #0#0;
          #2#1 = 0;
          #2#2 = 0;
          |LEE 000#2];
          |SI FSalida = 0; |Y #2#0 = #0#0;
               aMensa = "0000Orden con tiempos informados...";
               nError = 1;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Pedido0; |TIPO 0;
     nModo = (FEntrada / 100) ! 0;
/*
     |SI nModo = 2;
          |SI #0Campo ! Contenido;
               |HAZ CheqOrden;
               |SI nError ! 0;
                    aMensa = "0000Orden con unidades fabricadas y/o finallizada...";
                    |MENAV aMensa;
                    |ERROR; |ACABA;
               |FINSI;
          |FINSI;
     |FINSI;
*/
     |SI nModo ! 1; |ACABA; |FINSI;

     |ABRE #104;
     #104#25 = #0#2;
     #104#0 = #0#3;
     |LEE 000#104=;
     |SI FSalida ! 0;
          |MENAV "0000No existe pedido...";
          |ERROR;
     |SINO;
          |ABRE #73;
          #73#28 = #0#2;
          #73#0 = #0#3;
          #73#1 = 1;
          |LEE 000#73];
          |SI FSalida = 0; |Y #73#28 = #0#2; |Y #73#0 = #0#3;
               aEstaPendiente = "N";
               |HAZ LinPed;
               |SI aEstaPendiente = "N";
                    |MENAV "0000El pedido no esta pendiente...";
                    |ERROR;
               |SINO;
                    #0#4 = #73#2; |PINTA #0#4;
                    #0#5 = #73#4; |PINTA #0#5;
                    #0#6 = nPendiente; |PINTA #0#6;
                    #0#12 = #104#4; |PINTA #0#12;
                    #0#13 = #104#8; |PINTA #0#13;
                    #0#14 = #104#57; |PINTA #0#14;
                    #0#15 = #104#19; |PINTA #0#15;
                    nLin = 0;
                    aEscan = #0#4;
                    nCantiEscan = #0#6;
                    nMaxNivel = 1;
                    |HAZ DesglosaEscan;
                    |REFRESCACONTROL nGrid3;
                    |REFRESCACONTROL nGrid1;
               |FINSI;
          |SINO;
               |MENAV "0000Pedido sin lineas !!!";
          |FINSI;
          |CIERRA #73;
     |FINSI;
     |CIERRA #104;
|FPRC;

|PROCESO fergam03;
     #3#0 = #1#0
     #3#1 = #1#1
     #3#2 = #30#4;
     |GRABA 000#3n; || Sin errores, se puede repetir
|FPRC;

|DEFBUCLE fergam03;
     #30#2;
     ;
     aEscan, 001;
     aEscan, 999;
     ;
     NULL, fergam03;
|FIN;

|PROCESO LinEscan;
     nLin = nLin + 1;
     #1#0 = #0#0;
     #1#1 = nLin;
     #1#2 = aEscan;
     #1#3 = #401#3;
     #1#4 = #401#12; ||nCantiEscan;
     |GRABA 020#1n;
     |BUCLE fergam03;
|FPRC;

|PROCESO Conte; |TIPO 7;
     aConte = #0Campo;
|FPRC;

|PROCESO T80; |TIPO 80;
     FSalida = 4599;
|FPRC;

-----------fergam08
|PROCESO Tiempo;
     nHora = (A\(#2#5 % 102));
     nMinu = (A\(#2#5 % 402));
     nHora1 = nHora * 60 + nMinu;

     nHora = (A\(#2#6 % 102));
     nMinu = (A\(#2#6 % 402));
     nHora2 = nHora * 60 + nMinu;

     |SI nHora2 < nHora1;
          nTiempo = ((24*60 - nHora1) + nHora2) / 60;
     |SINO;
          nTiempo = (nHora2 - nHora1) / 60;
     |FINSI;
     #2#7 = nTiempo; |PINTA #2#7;
|FPRC;


|PROCESO FormaHora;
     aHora = #2Campo;
     aLon = aHora % A0;
     |SI aLon = 5;
          aAlf1 = aHora % 102;
          aAlf2 = aHora % 402;
          nNum = aAlf1 $ 24; aAlf1 = nNum;
          nNum = aAlf2 $ 60; aAlf2 = nNum;
          aHora = (("00" + aAlf1)%-102)+":"+(("00" + aAlf2)%-102);
     |SINO;
          aAlf1 = aHora % 102;
          aAlf2 = aHora % 402;
          aAlf3 = aHora % 702;
          nNum = aAlf1 $ 24; aAlf1 = nNum;
          nNum = aAlf2 $ 60; aAlf2 = nNum;
          nNum = aAlf3 $ 60; aAlf3 = nNum;
          aHora = (("00" + aAlf1)%-102)+":"+(("00" + aAlf2)%-102)+":"+(("00" + aAlf3)%-102);
     |FINSI;
     #2Campo = aHora; |PINTA #2Campo;

     |HAZ Tiempo;
|FPRC;
