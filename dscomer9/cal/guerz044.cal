|FICHEROS;
     guerz044 #0;
     goalbpa1 #1;
     goalbpa2 #2;
     goalbpa3 #3; || => gopartia
     gomatljn #4;
     gomatcab #5;
     gomatlin #6;
     gomantho #7;
     gomantl1 #8;
     agifa029 #29;
     agifa077 #77;
     agifa080 #80;
     guerw041 #41; ||Tmp
|FIN;

|VARIABLES;
     nCosTra = 0;
     nCosBas = 0;
     nVtaTra = 0;
     nVtaBas = 0;
     nLin = 0;
     nCanal = 0;
     aMensaje = "";
     aRuta = "";
     aAlfa = "";
     aAlf1 = "";
     aAlf2 = "";
     aAlf3 = "";
     aAlf4 = "";
     nBoton = 0;
     nXls = 0;
|FIN;

|PROCESO gomatcab;
     |DDEFECTO #5;
     #5#0 = #7#0;
     #5#1 = #7#1;
     |LEE 101#5=;
     |SI FSalida ! 0;
          #5#18 = #7#2;
          #5#19 = #7#8;
          #5#20 = #7#6;
          #5#21 = #7#6;
          #5#22 = 1;
          #5#23 = 1;
          |GRABA 020#5b;
     |FINSI;
|FPRC;

|PROCESO gomatlin;
     |DDEFECTO #6;
     |SELECT #2#6;
     #6#3 = #8#3;
     #6#4 = #8#4;
     |LEE 101#6=;
     |SI FSalida ! 0;
          |SELECT #1#6;
          #6#0 = #5#0;
          #6#1 = #5#1;
          #6#2 = 9999;
          |LEE 000#6];
          |SI FSalida ! 0;
               |LEE 000#6u;
          |SINO;
               |LEE 000#6a;
          |FINSI;
          |SI FSalida = 0; |Y #6#0 = #5#0; |Y #6#1 = #5#1;
               nLin = #6#2 + 1;
          |SINO;
               nLin = 1;
          |FINSI;
          |DDEFECTO #6;
          #6#0 = #5#0;
          #6#1 = #5#1;
          #6#2 = nLin;
          #6#3 = #8#3;
          #6#4 = #8#4;
          #6#9 = #8#5;
          |GRABA 020#6b;
     |FINSI;
|FPRC;

|PROCESO gomatljn;
     |DDEFECTO #4;
     |SELECT #5#4;
     #4#0 = #8#3;
     #4#1 = #8#4;
     #4#5 = #41#0;
     #4#6 = #41#1;
     |LEE 101#4=;
     |SI FSalida ! 0;
          |SELECT #1#4;
          #4#0 = #8#3;
          #4#1 = #8#4;
          #4#2 = 9999;
          |LEE 000#4];
          |SI FSalida = 0;
               |LEE 000#4a;
          |SINO;
               |LEE 000#4u;
          |FINSI;
          |SI FSalida = 0; |Y #4#0 = #8#3; |Y #4#1 = #8#4;
               nLin = #4#2 + 1;
          |SINO;
               nLin = 1;
          |FINSI;
          |DDEFECTO #4;
          #4#0 = #8#3;
          #4#1 = #8#4;
          #4#2 = nLin;
          #4#3 = #77#1;
          #4#4 = #77#54;
          #4#5 = #77#50;
          #4#6 = #77#0;
          #4#7 = #77#3;
          #4#8 = #77#4;
          #4#13 = #6#9;
          |GRABA 020#4b;
     |FINSI;
|FPRC;

|PROCESO goalbpa1;
     |DDEFECTO #1;
     #1#0 = #77#50;
     #1#1 = #77#0;
     |LEE 1010#1=;
     |SI FSalida ! 0; |GRABA 020#1b; |FINSI;
     #1#2 = #77#1;
     #1#3 = #77#3;
     #1#4 = #77#4;
     #1#5 = #77#15;
     #1#6 = #77#56;
     #1#7 = #77#54;
     |GRABA 020#1a;
|FPRC;

|PROCESO goalbpa2;
     |DDEFECTO #2;
     #2#0 = #80#27;
     #2#1 = #80#0;
     #2#2 = #80#1;
     |LEE 101#2=;
     |SI FSalida ! 0; |GRABA 020#2b; |FINSI;
     #2#3 = #80#2;
     #2#4 = #80#4;
     #2#5 = #80#5;
     #2#6 = #80#5;
     #2#7 = 0;
     #2#8 = #80#3;
     #2#9 = #80#6;
     #2#10 = #80#9;
     |GRABA 020#2a;
|FPRC;

|PROCESO goalbpa3;
     |DDEFECTO #3;
     #3#34 = "M";
     #3#4 = #80#27;
     #3#5 = #80#0;
     #3#6 = #80#1;
     #3#7 = 1;

     #3#0 = #8#3;
     #3#1 = #8#4;
     #3#2 = #8#0;
     #3#3 = #8#1;
     #3#10 = #80#5;
/*
     #3#11 = ||Pre Venta
     #3#12 = ||Pre Coste
     #3#13 = ||Imp Venta
     #3#14 = ||Imp Coste
*/
     #3#15 = #7#2;
     #3#16 = #7#8;
     #3#17 = #80#3;
     #3#18 = #29#1;
     #3#20 = #80#2;
     #3#21 = #7#6;
/*
     #3#22 = ||Prec Venta Bas
     #3#23 = ||Prec Compra Bas
     #3#24 = ||Impo Ventas Bas
     #3#25 = ||Impo Compra Bas
*/
     #3#29 = "M";
     #3#30 = #80#4;
     #3#41 = #80#6;
     #3#42 = #80#8;
     #3#43 = #80#26;
     |HAZ CalcuGopartia;
     |GRABA 020#3n;
|FPRC;

|PROCESO Adjudica;
     #80#27 = #41#0;
     #80#0 = #41#1;
     #80#1 = #41#2;
     |LEE 000#80=;
     |SI FSalida ! 0;
          aAlfa = "0000No existe Linea Albaran:"+#80#27+"/"+#80#0+"-"+#80#1;
          |MENAV aAlfa;
          |ACABA;
     |FINSI;
     #77#50 = #41#0;
     #77#0 = #41#1;
     |LEE 000#77=;
     |SI FSalida ! 0;
          aAlfa = "0000No existe Albaran:" + #77#50 + "/" + #77#0;
          |MENAV aAlfa;
          |ACABA;
     |FINSI;
     |SI #77#34 = "AS";
          aAlfa = "0000Albaran asignado:" + #77#50 + "/" + #77#0;
          |MENAV aAlfa;
          |ACABA;
     |FINSI;
     ||----busca expe
     #7#0 = #41#0;
     #7#1 = 1;
     |LEE 000#7];
     |SI FSalida ! 0; |O #7#0 ! #41#0;
          aAlfa = "0000No existe expediente con serie: [" + #41#0 + "]";
          |MENAV aAlfa;
          |ACABA;
     |FINSI;
     ||----busca presu
     #8#0 = #7#0;
     #8#1 = #7#1;
     #8#2 = 1;
     |LEE 000#8];
     |SI FSalida ! 0; |O #8#0 ! #7#0; |O #8#1 ! #7#1;
          aAlfa = "0000No existe presupuesto en expediente:" + #7#0 + "/" + #7#1;
          |MENAV aAlfa;
          |ACABA;
     |FINSI;

     |DDEFECTO #29;
     #29#0 = #80#3;
     |LEE 000#29=;

     |HAZ gomatcab;
     |SI FSalida = 0; |HAZ gomatlin; |FINSI;
     |SI FSalida = 0; |HAZ gomatljn; |FINSI;
     |SI FSalida = 0; |HAZ goalbpa1; |FINSI;
     |SI FSalida = 0; |HAZ goalbpa2; |FINSI;
     |SI FSalida = 0; |HAZ goalbpa3; |FINSI;
     |SI FSalida = 0;
          nCosTra = #3#14;
          nCosBas = #3#25;
          nVtaTra = #3#13;
          nVtaBas = #3#24;
          |SI #6#9 = "P";
               #5#2 = #5#2 + nCosTra; ||Tot Costo Tra Pre
               #5#3 = #5#3 + nCosBas; ||Tot Costo Bas Pre
               #5#4 = #5#4 + nVtaTra; ||Tot Vta Tra Pre
               #5#5 = #5#5 + nVtaBas; ||Tot Vta Bas Pre
          |FINSI;
          |SI #6#9 = "A";
               #5#6 = #5#6 + nCosTra; ||Tot Costo Tra Adm
               #5#7 = #5#7 + nCosBas; ||Tot Costo Bas Adm
               #5#8 = #5#8 + nVtaTra; ||Tot Vta Tra Adm
               #5#9 = #5#9 + nVtaBas; ||Tot Vta Bas Adm
          |FINSI;
          |SI #6#9 = "E";
               #5#10 = #5#10 + nCosTra; ||Tot Costo Tra Ex
               #5#11 = #5#11 + nCosBas; ||Tot Costo Bas Ex
               #5#12 = #5#12 + nVtaTra; ||Tot Vta Tra Ex
               #5#13 = #5#13 + nVtaBas; ||Tot Vta Bas Ex
          |FINSI;
          #5#14 = #5#14 + nVtaTra; ||Tot Vta Tra
          #5#15 = #5#15 + nVtaBas; ||Tot Vta Bas
          #5#16 = #5#16 + nCosTra; ||Tot Cos Tra
          #5#17 = #5#17 + nCosBas; ||Tot Cos Bas
          |GRABA 020#5a;

          #6#5 = #6#5 + nCosTra;
          #6#6 = #6#6 + nCosBas;
          #6#7 = #6#7 + nVtaTra
          #6#8 = #6#8 + nVtaBas;
          |GRABA 020#6a;

          #4#9 = #4#9 + nCosTra;
          #4#10 = #4#10 + nCosBas;
          #4#11 = #4#11 + nVtaTra;
          #4#12 = #4#12 + nVtaBas;
          |GRABA 020#4a;

          |GRABA 020#1a;
          |GRABA 020#2a;

          #41#3 = "S";
          |GRABA 020#41a;
     |FINSI;
     |LIBERA #5;
     |LIBERA #6;
     |LIBERA #4;
     |LIBERA #1;
     |LIBERA #2;
|FPRC;

|DEFBUCLE Adjudica;
     #41#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Adjudica;
|FIN;

|PROCESO MarcaAlb;
     |SI #41#3 = "S";
          #77#50 = #41#0;
          #77#0 = #41#1;
          |LEE 121#77=;
          |SI FSalida = 0;
               #77#34 = "AS";
               |GRABA 020#77a;
               |LIBERA #77;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE MarcaAlb;
     #41#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, MarcaAlb;
|FIN;

|PROCESO CreaAdj;
     |ABRE #1;
     |ABRE #2;
     |ABRE #3;
     |ABRE #5;
     |ABRE #6;
     |ABRE #7;
     |ABRE #8;
     |ABRE #77;
     |ABRE #80;
     |ABRE #29;
     |ABRE #4;
     |BUCLE Adjudica;
     |BUCLE MarcaAlb;
     |CIERRA #4;
     |CIERRA #29;
     |CIERRA #80;
     |CIERRA #77;
     |CIERRA #8;
     |CIERRA #7;
     |CIERRA #6;
     |CIERRA #5;
     |CIERRA #3;
     |CIERRA #2;
     |CIERRA #1;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO Registro;
     #41#0 = aAlf1;
     #41#1 = aAlf2;
     #41#2 = aAlf3;
     |GRABA 020#41n;
     aAlfa = "[" + #41#0 + "/" + #41#1 + "-" + #41#2 + "]";
     |PINTA 2210, aAlfa;
|FPRC;

|PROCESO Importa;
     |CARGADLL "agixl97.dll";
     |SI FSalida < 0;
          |MENAV "0000No se puede usar agixl97.dll";
     |SINO;
          aAlfa = #0#1; |QBF aAlfa;
          |ALFACALLDLL "agixl97.dll", "carga_book", aAlfa;
          |ALFACALLDLL "agixl97.dll", "selecciona_hoja", "Hoja1";
          |PARA nXls = 1; |SI nXls < 65536; |HACIENDO nXls = nXls + 1;
               aAlf1 = "A" + nXls; |ALFACALLDLL "agixl97.dll", "peek_dato", aAlf1;
               aAlf2 = "B" + nXls; |ALFACALLDLL "agixl97.dll", "peek_dato", aAlf2;
               aAlf3 = "F" + nXls; |ALFACALLDLL "agixl97.dll", "peek_dato", aAlf3;
               |QBF aAlf1;
               |SI aAlf2 = ""; |SAL; |FINSI;
               |HAZ Registro;
          |SIGUE;
          |ALFACALLDLL "agixl97.dll", "fin_book", "salva";
          |DESCARGADLL "agixl97.dll";
    |FINSI;
|FPRC;

|PROCESO Tipo3; |TIPO 3;
     |HAZ Quita;
     aAlfa = Usuario;
     |NOME_DAT #41 aAlfa; |DELINDEX #41;

     aAlfa = #0#1; |QBF aAlfa;
     |XABRE "CE", aAlfa, nCanal;
     |SI FSalida ] 0;
          |ABRE #41;
          |HAZ Importa;
          |CIERRA #41;
          |HAZ CreaAdj;
     |SINO;
          aMensaje = "0000No puedo abrir " + aAlfa;
          |MENAV aMensaje;
     |FINSI;
     |DELINDEX #41;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO Quita; |TIPO 0;
     |ESTADO_CONTROL nBoton, "DISABLE";
|FPRC;

|PROCESO Pone; |TIPO 7;
     |ESTADO_CONTROL nBoton, "ENABLE";
|FPRC;

|PROCESO Boton1;
     |PTEC 824;
|FPRC;

|PROCESO Browser;
     |SI FSalida ! 10; |ACABA; |FINSI;

     aRuta = #0#0;  |QBF aRuta;
     |SI aRuta = "";
         aRuta = "\*.xls";
     |FINSI;
     aRuta = "F" + aRuta;

     |BROWSE aRuta;

     aRuta = aRuta % 299;

     #0#1 = aRuta;
     #0#1 = #0#1 > #0#1;
     |PINTA #0#1;
|FPRC;

|PROGRAMA;
     |CONTROL_SIMPLE 0, "BOTON, Fichero:", 0911, 0919, Boton1;
     nBoton = FSalida;

     |ABRE #0;
     |LEE 101#0=;
     |SI FSalida ! 0; |GRABA 020#0b; |FINSI;
     |CLS;
     |PINPA #0#0;
     |PINDA #0#0;
     |ENDATOS #1#0;
     |SI FSalida = 0;
          |GRABA 020#0a;
     |FINSI;
     |CIERRA #0;

     |FIN_CONTROL_WINDOWS nBoton;
     |PULSATECLA;
|FPRO;
