     Procesos ActCab y ActLin (copiado del sctrz037)

|FICHEROS;
     sctrm003 #3;
     sctrm021 #21;
     sctrm026 #26;
     sctrm050 #50;
     sctrm051 #51;
     sctrm052 #52;
|FIN;

|VARIABLES;
     nSw = 0;
     aUsu = "";
     &enForma = 0;
     nForma = 0;
     nKmsGrupo = 0;
     aPobla = "";
     fFecha = @;
     nPax = 0;
     nPaxRese = 0;
     nNume = 0;
     aMensa = "";
     aAlfa = "";
     nError = 0;
     fSal1 = @;
|FIN;

|PROCESO PoblaInter;
     |ABRE #3;
     #3#0 = aPobla;
     |LEE 000#3=;
     |SI FSalida = 0; |Y #3#13 = "    ";
          aAlfa = "1"
     |SINO;
          aAlfa = 0;
     |FINSI;
     |CIERRA #3
     FSalida = aAlfa;
|FPRC;

|PROCESO ReservasAct;
     |SI nSw = 1;
          |SI #52#128 = "N"; |ACABA; |FINSI;

          |SI #52#20 = #50#0;
               |SI #52#99 ! 1; |ACABA; |FINSI;
          |SINO;
               |SI #52#99 ! 2; |ACABA; |FINSI;
          |FINSI;
     |SINO;
          |SI #52#129 = "N"; |ACABA; |FINSI;

          |SI #52#26 = #50#0;
               |SI #52#100 ! 1; |ACABA; |FINSI;
          |SINO;
               |SI #52#100 ! 2; |ACABA; |FINSI;
          |FINSI;
     |FINSI;

     |SI #52#52 = "L";
          |ACABA;
     |FINSI;

     nNume = #52#20 - #52#99 + 1;
     fFecha = nNume;
     |SI #52#101 = #50#6; |Y fFecha = #50#0; ||...Salidas
          |SI #52#74 ! 0;     || Ya esta asignada
               |SI nForma = -1;
                    |SI #52#73 = #50#0; |Y #52#74 = #50#1;
                         |LEE 140#52=;
                         |SI FSalida ! 0;
                              aAlfa = ("0000000" + #52#0) % -107;
                              aUsu = Usuario % 810;
                              aAlfa = "0000Reserva  " + aAlfa + " bloqueada por " + aUsu + ", compruebe la creaci¢n de la hoja de ruta...";
                              |MENAV aAlfa;
                         |SINO;
                              #52#73 = "01.01.0000";
                              #52#74 = 0;
                              #52#77 = 0;
                              |SI #52#52 = "C"; #52#52 = "P"; |FINSI;
                              #52#103 = 0;
                              #52#122 = 0;
                              |GRABA 020#52a;
                              |LIBERA #52;
                         |FINSI;
                    |FINSI;
               |FINSI;
               |ACABA;
          |FINSI;
          aPobla = #52#8;
          |HAZ PoblaInter;
          |SI FSalida ! 0; |ACABA; |FINSI; || No tiene poblaci¢m intercambiador

          |SI #52#52 = "A";
               |SI #52#63 = "T"; |O #52#63 = "S";
                    |ACABA;
               |FINSI;
          |FINSI;
          |SI #52#22 ! #51#3; |ACABA; |FINSI;
/*
          nPax = nPaxRese + #52#19;
          |SI nPax > #50#19;
               |SI aMensa = "";
                    aMensa = "0000Pax viajeros transportados superado...";
                    |MENAV aMensa;
               |FINSI;
               |SI #52#19 = 1; nError = 1; |ERROR10; |FINSI;
               |ACABA;
          |FINSI;
*/
          |LEE 140#52=;
          |SI FSalida ! 0;
               aAlfa = ("0000000" + #52#0) % -107;
               aUsu = Usuario % 810;
               aAlfa = "0000Reserva  " + aAlfa + " bloqueada por " + aUsu + ", compruebe la creaci¢n de la hoja de ruta...";
               |MENAV aAlfa;
          |SINO;
               |SI nForma = 1;
                    #52#73 = #50#0;
                    #52#74 = #50#1;
                    #52#77 = #50#2;
               |SINO;
                    #52#73 = "01.01.0000";
                    #52#74 = 0;
                    #52#77 = 0;
                    #52#103 = 0;
                    #52#122 = 0;
               |FINSI;
               |GRABA 020#52a;
               |LIBERA #52;
          |FINSI;
          nPaxRese = nPaxRese + #52#19;
     |FINSI;

     nNume = #52#26 - #52#100 + 1;
     fFecha = nNume;
     |SI #52#102 = #50#6; |Y fFecha = #50#0; ||...Llegadas
          |SI #52#79 ! 0;     || Ya esta asignada
               |SI nForma = -1;
                    |SI #52#78 = #50#0; |Y #52#79 = #50#1;
                         |LEE 140#52=;
                         |SI FSalida ! 0;
                              aAlfa = ("0000000" + #52#0) % -107;
                              aUsu = Usuario % 810;
                              aAlfa = "0000Reserva  " + aAlfa + " bloqueada por " + aUsu + ", compruebe la creaci¢n de la hoja de ruta...";
                              |MENAV aAlfa;
                         |SINO;
                              #52#78 = "01.01.0000";
                              #52#79 = 0;
                              #52#82 = 0;
                              |SI #52#53 = "C"; #52#53 = "P"; |FINSI;
                              #52#104 = 0;
                              #52#123 = 0;
                              |GRABA 020#52a;
                              |LIBERA #52;
                         |FINSI;
                    |FINSI;
               |FINSI;
               |ACABA;
          |FINSI;
          aPobla = #52#12;
          |HAZ PoblaInter;
          |SI FSalida ! 0; |ACABA; |FINSI; || No tiene poblaci¢m intercambiador

          |SI #52#52 = "A";
               |SI #52#63 = "T"; |O #52#63 = "R";
                    |ACABA;
               |FINSI;
          |FINSI;
          |SI #52#28 ! #51#3; |ACABA; |FINSI;

          nPax = nPaxRese + #52#19;
          |SI nPax > #50#19;
               |SI aMensa = "";
                    aMensa = "0000Pax viajeros transportados superado...";
                    |MENAV aMensa;
               |FINSI;
               |SI #52#19 = 1; nError = 1; |ERROR10; |FINSI;
               |ACABA;
          |FINSI;

          |LEE 140#52=;
          |SI FSalida ! 0;
               aAlfa = ("0000000" + #52#0) % -107;
               aUsu = Usuario % 810;
               aAlfa = "0000Reserva  " + aAlfa + " bloqueada por " + aUsu + ", compruebe la creaci¢n de la hoja de ruta...";
               |MENAV aAlfa;
          |SINO;
               |SI nForma = 1;
                    #52#78 = #50#0;
                    #52#79 = #50#1;
                    #52#82 = #50#2;
               |SINO;
                    #52#78 = "01.01.0000";
                    #52#79 = 0;
                    #52#82 = 0;
                    #52#104 = 0;
                    #52#123 = 0;
               |FINSI;
               |GRABA 020#52a;
               |LIBERA #52;
          |FINSI;
          nPaxRese = nPaxRese + #52#19;
     |FINSI;
|FPRC;

|DEFBUCLE ReservasActIda;
     #52#2;
     ;
     #50#0, 000000, 0000000;
     fSal1, 999999, 9999999;
     ;
     NULL, ReservasAct;
|FIN;

|DEFBUCLE ReservasActVta;
     #52#3;
     ;
     #50#0, 000000, 0000000;
     fSal1, 999999, 9999999;
     ;
     NULL, ReservasAct;
|FIN;

|PROCESO LinApertura;
     fSal1 = #50#0 + 1;
     nSw = 1; |BUCLE ReservasActIda;
     nSw = 2; |BUCLE ReservasActVta;
     |SI nError = 1; |ERROR10; |FINSI;
|FPRC;

|DEFBUCLE LinApertura;
     #51#1;
     ;
     #50#0, #50#1, 0;
     #50#0, #50#1, 999;
     be;
     NULL, LinApertura;
|FIN;

|PROCESO ActCab;
     nForma = enForma;
     nPaxRese = #50#20;
     nError = 0;
     aMensa = "";
     |BUCLE LinApertura;
|FPRC;

|PROCESO ActLin;
     nForma = enForma;

     |||ABRE #21;
     #21#0 = #50#5;
     #21#2 = #51#5;
     #21#4 = #51#8;
     |LEE 000#21=;
     |SI FSalida ! 0;
          #21#2 = #51#8;
          #21#4 = #51#5;
          |LEE 000#21=;
     |FINSI;
     |SI FSalida = 0;
          nKmsGrupo = #21#6;
     |SINO;
          nKmsGrupo = 0;
     |FINSI;
     |||CIERRA #21;

/*
     |ABRE #26;
     |SELECT #3#26;
     #26#0 = #50#3;
     #26#4 = #50#6;
     #26#5 = #51#3;
     #26#7 = #50#0;
     |LEE 121#26=;
     |SI FSalida = 0;
*/
          #26#22 = (nKmsGrupo * nForma);
          |SI nForma = -1;
               ||#26#26 = #26#26 - #51#12;
               #26#27 = 0;

               #26#11 = 0;
               #26#23 = 0;
               #26#25 = 0;
               #26#29 = 0;
               #26#31 = 0;
               #26#33 = 0;
               #26#12 = "";
               #26#30 = "";
               #26#32 = "";
               #26#34 = "";
          |SINO;
               ||#26#26 = #26#26 + #51#12;
               #26#27 = #51#1;
               #26#28 = Usuario % 810;
               #26#9 = #50#7;
               #26#10 = #50#8;
               #26#29 = #50#11;
               #26#30 = #50#12;
               #26#31 = #50#13;
               #26#32 = #50#14;
               #26#33 = #50#15;
               #26#34 = #50#16;
               #26#37 = #50#21

               #26#11 = #50#9;
               #26#12 = #50#10;
               |SI #50#22 = "S";
                    #26#22 =  #50#17 * 2;
               |SINO;
                    #26#22 = #50#17;
               |FINSI;
               #26#23 = #50#18;
               #26#25 = #50#19;
               #26#29 = #50#11;
               #26#30 = #50#12;
               #26#31 = #50#13;
               #26#32 = #50#14;
               #26#33 = #50#15;
               #26#34 = #50#16;
          |FINSI;
          |GRABA 020#26a;
/*
     |FINSI;
     |CIERRA #26;
*/
|FPRC;
