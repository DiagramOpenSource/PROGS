    COPIA DE  LOS FICHEROS:
          dsm00024 <-> albm0046
             824   <->   846

|FICHEROS;
     albw0002@ #2;   ||Tmp F.E
     albw0004@ #4;   ||Tmp F.V
     albw0008@ #88;  ||Tmp F.E
     albw0009@ #99;  ||Tmp F.V
     albw0026@ #726; ||Aux. Boton Entradas1
     albw0027@ #727; ||Aux. Boton Entradas2

     albm0003@ #3;   ||Pendiente de Recibir
     albm0006@ #6;   ||F.V. Pedi Com
     albm0007@ #7;   ||F.V. Alba Com
     albm0008@ #8;   ||F.V. Factu Com
     albm0009@ #9;   ||F.Entrea Ped Lin Com
     albm0010@ #10;  ||F.V. Pedi Vta
     albm0011@ #11;  ||F.V. Alba Vta
     albm0012@ #12;  ||F.V. Factu Vta
     albm0028@ #28;  ||Aux. Ped.Lin
     albm0013@;  ||Parametros

     agifa019 #19;
     agifa081 #81;  ||Ped Com
     agifa066 #66;||*
     agifa067 #67;  ||Ped Com Lin
     agifa077 #77;  ||Alb Com
     agifa080 #80;  ||Alb Com Lin
     agifa079 #79;  ||Fac Com
     agifa072 #72;  ||Fac Com Lin

     agifa104 #104;
     agifa010 #110;
     agifa071 #71;
     agifa073 #73;
     agifa134 #134;
     agifa059 #59;

     agifa091 #91;
     agifa067@ #100;
     agifa112 #112;

     dsm00056 #756;
     dsm00057 #757;

     albm0045@ #945;     ||Contadores Partidas
     ||albm0046@  #946;     ||Art./Alm./PartidaCAB
     albm0047@ #947;     ||Art./Alm./Partidalin

     albm0044@ #944;     ||Articulos Proveedor

     agist002 #600;      ||Lineas Entrada Stocks Inicial
     agist001 #601;      ||Cabeceras Entrada Stocks Inicial
     dsm00043 #643;      ||Reg. Existencias (C)
     dsm00044 #644;      ||Reg. Existencias (L)

     ||dsm00024@ #924;      ||Art./Alm./Partida

     dsm00024 #824;      ||Art./Alm./Partida
     albm0046 #846;      ||Alm./Partida en Albero

     albm0063@ #863;     ||PesoMtsPzas OrdenFab
     albm0037@ #837;     ||Orden (C)
     referen@;
|FIN;

|VARIABLES;
     nParam1 = 0;
     nParam2 = 0;
     nParam3 = 0;
     nParam4 = 0;
     &enTiva = 0;
     &efFiva = @;
     &eaDiva = "";
     &enIva = 0;
     &enRec = 0;
     aLong = "";
     nLong = 0;
     aAuxLetra = "";
     nNumMez = 0;
     aAux1 = "";
     aAux2 = "";

     nExistencias = 0;
     nTotalLin = 0;

     &eaArt61 = "";
     &enAlm61 = 0;
     &eaPar61 = "";
     &eaSer61 = "";
     &enNum61 = 0;
     &enLin61 = 0;

     nAux = 0;
     &eaObser47 = "";
     &enPreHis = 0;
     &eaProvAlbero = "";
     &eaArtAlbero = "";
     nPrecioBase = 0;

     nPrimero = 0;
     aFecUlt = "";
     nPreUlt = 0;
     nPreAnt = 0;
     fFechaUlt = @;
     aFecha = "";


     &enPrecio = 0;
     nRango = 0;
     aAlfa2 = "";
     aPartidaDes = "";
     aSerieDes = "";
     aNumDes = "";
     nNumDes = 0;
     aSerieBona = "";

     aMensaje = "";
     &eaArtOF = "";
     &enAlmOF = 0;
     &eaSerOF = "";
     &eaNumOF = "";
     &enLinOF = 0;
     &eaParOF = "";
     &efFecOF = @;

     &enNoModCab = 0;

     &efDFecha = @;
     &efHFecha = @;

     &enTipoCal = 0;
     &eaArtPrv = "";
     &eaArtPLB = "";
     &eaPrvPLB = "";

     &enUni1 = 0;
     &enUni2 = 0;
     &enAlbForma = 0;
     aArticulo = "";
     nAlmacen = 0;
     aPartida46 = "";
     &eaIncPar = "";

     &enAlbeAlm = 0;
     &eaTipoMov = "";
     &eaAlbePar = "";
     &eaAlbeArt = "";
     &eaAlbeArtEs = "";

     &enFecVto = 0;
     &enDesdeX = 0;
     &efFecha  = @;
     &efFecVto = @;

     aSerie  = "";
     nNumero = 0;

     fFecha = @;
     fDFecha = @;
     fHFecha = @;
     aAlfa = "";
     &enBoton1 = 0;
     &enBoton2 = 0;
     &enBoton3 = 0;
     nNume = 0;
     nImpo = 0;
     nUni = 0;
     nUni1 = 0;
     nUni2 = 0;
     aArt = "";
     aDef = "";
     aProve = "";
     aPago = "";
     nDiaPago       = 0;
     nDias          = 0;
     nCamFPago      = 0;
     nAbono         = 0;
     nMult          = 0;
     nEuro          = 0;
     nDia1          = 0;
     nDia2          = 0;
     nDia3          = 0;
     aDia           = "";
     aMes           = "";
     bAlfa          = "";
     fFecha1        = @;
     fFechaFac      = @;
     fFecVto        = @;
     aMas           = "";
     aObserva = "";

     nForma = 0;
     aProveedor = "";
     fFechaEnt = @;
     aTipoDoc = "";
     nUnidades1 = 0;
     nUnidades2 = 0;
     aSerPed = "";
     nNumPed = 0;
     nPrecio = 0;
     aIncPar = "";
     aSerLin = "";
     nNumLin = 0;
     nLinLin = 0;
     aArtPartida = "";
     nAlmPartida = 0;
     aParPartida = "";
     nLinea = 0;
     aProducido = "";
     aProduDes = "";
     aObs = "";
     nUdAct = 0;
     nPreAct = 0;
     nUdNou = 0;
     nPreNou = 0;
     &enRecalculo = 0;

     &enAlberoDentro = 0; || sirve para evitar reentradas
     i = 0;
     aPath = "";
     nError = 0;
     aBeta = "";
     aAux = "";

     &enAlmPar = 0;
     &eaNumPar = "";
     &eaProducido = "";
     &eaDesPro = "";

     &eaSerAlb = "";
     &enNumAlb = 0;
     &enLinAlb = 0;
     &enSwEstaDoc = 0;

     &eaDocExt = "";          ||Para meter los campos en el albm0047.
     &eaSerExt = "";          ||Documento Externo, MeZclada, Tintadas, etc
     &enNumExt = 0;

     &eaDocAlbero = "";       ||Nos dice si viene de un proceso Externo.
     &eaSerAlbero = "";
     &enNumAlbero = 0;
     &eaCerrarPar = "";

     aDocuAux = "";         ||Auxiliares
     aSeriAux = "";
     nNumeAux = 0;
     nSalida = 0;
|FIN;

|PROCESO Baja88;
     #88#0 = #2#0;
     #88#1 = #2#2;
     #88#2 = "     ";
     #88#3 = 0;
     #88#4 = 0;
|FPRC;

|PROCESO Alta88;
     #88#0 = #2#0;
     #88#1 = #2#2;
     #88#2 = "zzzzz";
     #88#3 = 999999;
     #88#4 = 999;
|FPRC;

|PROCESO Baja99;
     #99#0 = #4#0;
     #99#1 = "";
     #99#2 = "";
|FPRC;

|PROCESO Alta99;
     #99#0 = #4#0;
     #99#1 = "zzzzzz";
     #99#2 = "zzzzzzzzzzzzzzzzzzzz";
|FPRC;

|PROCESO Graba4;
     |SI nImpo = 0;  |ACABA;  |FINSI;

     #4#0 = fFecha;
     |LEE 101#4=;
     |SI FSalida ! 0;
         |DDEFECTO #4;
          #4#0 = fFecha;
          |GRABA 020#4b;
     |FINSI;

     #4#1 = #4#1 + nImpo;
     |GRABA 020#4a;
     |LIBERA #4;
|FPRC;

|PROCESO AlbaLins;
     #99#0 = fFecha;
     #99#1 = #77#3;
     #99#2 = #80#2;
     |LEE 101#99=;
     |SI FSalida ! 0;
         |DDEFECTO #99;
         #99#0 = fFecha;
         #99#1 = #77#3;
         #99#2 = #80#2;
         |GRABA 020#99b;
     |FINSI;

     #99#3 = #99#3 + #80#5;
     #99#4 = #99#4 + #80#35;
     nImpo = #80#9;
     |SI #77#42 = "S";
         nImpo = -#80#9;
     |FINSI;
     #99#5 = #99#5 + nImpo;
     #99#6 = #77#4;
     #99#7 = #80#4;
     |GRABA 020#99a;
     |LIBERA #99;
|FPRC;

|PROCESO agifa072;
     |ABRE #77;
     #77#50 = #72#17;
     #77#0  = #72#2;
     |LEE 040#77=;
     |SI FSalida = 0;
         |BUCLELIN 2AlbaLins#77;
     |FINSI;
     |CIERRA #77;
|FPRC;

|PROCESO albm0008;
     #79#66 = #8#0;
     #79#0  = #8#1;
     |LEE 000#79=;
     |SI FSalida ! 0; |ACABA; |FINSI;

     nImpo = #79#118;

     fFecha = #8#2;

     |HAZ Graba4;

     |BUCLELIN 2agifa072#79;
|FPRC;

|PROCESO albm0007;
     #77#50 = #7#0;
     #77#0  = #7#1;
     |LEE 000#77=;
     |SI FSalida ! 0; |ACABA; |FINSI;
     |SI #77#38 = "S"; |ACABA; |FINSI;

     nImpo = #77#66;
     |SI #77#42 = "S";
          nImpo = -#77#66;
     |FINSI;
     fFecha = #7#2;
     |HAZ Graba4;

     |BUCLELIN 2AlbaLins#77;
|FPRC;

|PROCESO agifa067_alb;
     enTiva = #67#14;
     efFiva = #81#1;
     |HAZ SacaIVA2;

     #19#0 = #67#2;
     |LEE 020#19=;

     |ABRE #81;
     #81#25 = #67#28;
     #81#0  = #67#0;
     |LEE 040#81=;
     |SI FSalida ! 0;  |DDEFECTO #81;  |FINSI;
     |CIERRA #81;


     |ABRE #112;
     |DDEFECTO #112;
     #112#0 = #81#4;
     |LEE 000#112=;
     |CIERRA #112;

     |SI #19#196 = 2;
          nImpo = (#67#41 - #67#46) * #67#6;
     |SINO;
          nImpo = (#67#5 - #67#38)  * #67#6;
     |FINSI;

     nImpo = ((nImpo < #67#8) < #67#27) < #67#57;
     nImpo = ((nImpo  < #81#5) < #81#17) < #81#6;

     ||ARA55
     |SI #112#58 = "N";
          nImpo = nImpo + (nImpo * enIva / 100);
     |SINO;
          nImpo = nImpo + (nImpo * (enIva + enRec) / 100);
     |FINSI;
     fFecha = #6#2;
     |HAZ Graba4;

     |ABRE #81;
     #81#25 = #67#28;
     #81#0  = #67#0;
     |LEE 040#81=;
     |SI FSalida ! 0;  |DDEFECTO #81;  |FINSI;
     |CIERRA #81;

     nUni1 = #67#5 - #67#38;
     nUni2 = #67#41 - #67#46;

     #99#0 = fFecha;
     #99#1 = #81#4;
     #99#2 = #67#2;
     |LEE 101#99=;
     |SI FSalida ! 0;
         |DDEFECTO #99;
         #99#0 = fFecha;
         #99#1 = #81#4;
         #99#2 = #67#2;
         |GRABA 020#99b;
     |FINSI;

     #99#3 = #99#3 + nUni1;
     #99#4 = #99#4 + nUni2;
     #99#5 = #99#5 + nImpo;
     #99#6 = #81#8;
     #99#7 = #67#4;
     |GRABA 020#99a;
     |LIBERA #99;
|FPRC;

|DEFBUCLE agifa067;
     #67#1;
     ;
     aSerie, nNumero, 001;
     aSerie, nNumero, 999;
     ;
     NULL, agifa067_alb;
|FIN;

|PROCESO albm0006;
     aSerie = #albm0006@#0; nNumero = #albm0006@#1;
     |BUCLE agifa067;
|FPRC;

|DEFBUCLE albm0006;
     #6#2001;
     ;
     fDFecha;
     fHFecha;
     ;
     NULL, albm0006;
|FIN;

|DEFBUCLE albm0007;
     #7#2001;
     ;
     fDFecha;
     fHFecha;
     ;
     NULL, albm0007;
|FIN;

|DEFBUCLE albm0008;
     #8#2001;
     ;
     fDFecha;
     fHFecha;
     ;
     NULL, albm0008;
|FIN;

|PROCESO AlbeConsuVal;
     |HAZ AlbParam;

     |DBASE aAlfa; |QBF aAlfa;
     aMas = aAlfa + "def/albw0004.mas";
     |CARGA_DEF aMas, albw0004@;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     aMas = aAlfa + "def/albw0009.mas";
     |CARGA_DEF aMas, albw0009@;
     |SI FSalida ! 0;
         |DESCARGA_DEF #albw0004@;
         |ACABA;
     |FINSI;

     aAlfa = Usuario; |QBF aAlfa;
     aAlfa = "0"+ aAlfa;
     |NOME_DAT #4 aAlfa;
     |DELINDEX #4;

     aAlfa = Usuario; |QBF aAlfa;
     aAlfa = "1"+ aAlfa;
     |NOME_DAT #99 aAlfa;
     |DELINDEX #99;

     |SI enTipoCal = 0;
          nNume = fFecha; nNume = nNume - nParam3;
          fDFecha = nNume;
          nNume = fFecha; nNume = nNume + nParam4;
          fHFecha = nNume;
     |SINO;
          fDFecha = efDFecha;
          fHFecha = efHFecha;
     |FINSI;

     |ABRE #4;
     |ABRE #99;

     |DBASE aAlfa; |QBF aAlfa;
     aAlfa = aAlfa + "def/albm0006.mas";
     |CARGA_DEF aAlfa, albm0006@;
     |SI FSalida = 0;
         |ABRE #19;
         |BUCLE albm0006;
         |CIERRA #19;
         |DESCARGA_DEF #albm0006@;
     |FINSI;

     |DBASE aAlfa; |QBF aAlfa;
     aAlfa = aAlfa + "def/albm0007.mas";
     |CARGA_DEF aAlfa, albm0007@;
     |SI FSalida = 0;
         |ABRE #77;
         |BUCLE albm0007;
         |CIERRA #77;
         |DESCARGA_DEF #albm0007@;
     |FINSI;

     |DBASE aAlfa; |QBF aAlfa;
     aAlfa = aAlfa + "def/albm0008.mas";
     |CARGA_DEF aAlfa, albm0008@;
     |SI FSalida = 0;
         |ABRE #79;
         |BUCLE albm0008;
         |CIERRA #79;
         |DESCARGA_DEF #albm0008@;
     |FINSI;

     |LEE 000#4p;
     |PARA;  |SI;  |HACIENDO;
          |CONSULTA_CLAVE #1#4;
          |SI FSalida ! 0;  |SAL;  |FINSI;

          |CONSULTA_F_CLAVE #1#99, Baja99, Alta99;
     |SIGUE;
     |CIERRA #4;
     |CIERRA #99;

     |DELINDEX #4;
     |DELINDEX #99;

     |DESCARGA_DEF #albw0009@;
     |DESCARGA_DEF #albw0004@;
|FPRC;

|PROCESO AlbeLeeProve;
     |DDEFECTO #112;
     |ABRE #112;
     #112#0 = aProve;
     |LEE 000#112=;
     |CIERRA #112;
|FPRC;

|PROCESO AlbeLeePago;
     |DDEFECTO #91;
     |ABRE #91;
     #91#0 = aPago;
     |LEE 000#91=;
     |CIERRA #91;
|FPRC;

|PROCESO AlbeCambios;
     fFecha1 = fFecha;
     aDia = fFecha1 % 102;
     nDiaPago = aDia;
|FPRC;

|PROCESO AlbeDiasFijos;
     |SI nDia1 = 0;
          |VETE AlbeFinFijos;
     |FINSI;
     |HAZ AlbeCambios;
     |SI nDiaPago > nDia1;
          |VETE  AlbeFijos2;
     |FINSI;

  |ET AlbeFijos1;
     |SI nDiaPago = nDia1;
          |VETE AlbeFinFijos;
     |FINSI;
     fFecha = fFecha + 1;
     |HAZ AlbeCambios;
     |VETE AlbeFijos1;

  |ET AlbeFijos2;
     |SI nDia2 = 0; |O nDiaPago [ nDia1;
          |VETE AlbeFijos1;
     |FINSI;
     |SI nDiaPago > nDia2;
          |VETE AlbeFijos3;
     |FINSI;
     |SI nDiaPago = nDia2;
          |VETE AlbeFinFijos;
     |FINSI;
     fFecha = fFecha + 1;
     |HAZ AlbeCambios;
     |VETE AlbeFijos2;

  |ET AlbeFijos3;
     |SI nDia3 = 0;|O nDiaPago > nDia3; |O nDiaPago [ nDia1; |O nDiaPago [ nDia2;
          |VETE AlbeFijos1;
     |FINSI;
     |SI nDiaPago = nDia3;
         |VETE AlbeFinFijos;
     |FINSI;
     fFecha = fFecha + 1;
     |HAZ AlbeCambios;
     |VETE AlbeFijos3;

  |ET AlbeFinFijos;
     fFecha1 = fFecha;
|FPRC;

|PROCESO AlbeVto;
     nCamFPago = 6;
     |SI #91#5 = "N";
          nMult = 1;
     |SINO;
          nMult = 1000;
     |FINSI;
     nDias = #91nCamFPago / nMult;
     |SI nDias ! 0; |O nDia1 ! 0; |O nDia2 ! 0; |O nDia3 ! 0;
          fFecha = fFechaFac + nDias;
          |HAZ AlbeDiasFijos;
          aMes = fFecha % 402;
          |SI aMes = #112#18;          ||Si es mes de no pago...
               fFecha = fFecha + .001;
               fFecha1 = fFecha;
          |FINSI;
          fFecVto   = fFecha1;
          efFecVto  = fFecha1;
     |SINO;
          fFecVto  = fFechaFac;
          efFecVto = fFechaFac;
     |FINSI;
|FPRC;

|PROCESO ConsuPediFec;
     |SI aArt = #67#2;
          nUni1 = #67#5 - #67#38;
          nUni2 = #67#41 - #67#46;
          |SI nUni1 ! 0; |O nUni2 ! 0;
               |DDEFECTO #2;
               #2#0 = #67#2;
               #2#2 = #67#13;
               |LEE 101#2=;
               |SI FSalida ! 0; |GRABA 020#2b; |FINSI;
               #2#1 = #67#4;
               #2#3 = #2#3 + nUni1;
               #2#4 = #2#4 + nUni2;
               #2#5 = #2#5 + 1;
               |GRABA 020#2a;
               |LIBERA #2;

               #88#0 = #2#0;
               #88#1 = #2#2;
               #88#2 = #67#28;
               #88#3 = #67#0;
               #88#4 = #67#1;
               |LEE 101#88=;
               |SI FSalida ! 0;
                   |DDEFECTO #88;
                   #88#0 = #2#0;
                   #88#1 = #2#2;
                   #88#2 = #67#28;
                   #88#3 = #67#0;
                   #88#4 = #67#1;
                   #88#7 = #81#4;
                   #88#8 = #81#8;
                   |GRABA 020#88b;
               |FINSI;
               #88#5 = #88#5 + nUni1;
               #88#6 = #88#6 + nUni2;
               |GRABA 020#88a;
               |LIBERA #88;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE ConsuPediFec;
     #67#2;
     ;
     "      ", fDFecha,     0,     0,     0, "  ", "     ", 000001;
     "zzzzzz", fHFecha, 99.99, 99.99, 99.99, "zz", "zzzzz", 999999;
     ;
     NULL, ConsuPediFec;
|FIN;

|PROCESO AlbeConsuLin2;
     fFecha = #67#13;
     aArt   = #67#2;
     |HAZ AlbParam;
     nNume = fFecha; nNume = nNume - nParam1;
     fDFecha = nNume;
     nNume = fFecha; nNume = nNume + nParam2;
     fHFecha = nNume;
     |DDEF aDef;
     aDef = aDef + "agifa067";
     |CARGA_DEF aDef, agifa067@;
     |SI FSalida = 0;
          |BUCLE ConsuPediFec;
          |DESCARGA_DEF #agifa067@;
     |FINSI;
|FPRC;

|PROCESO PedComVal2;
     |DBASE aAlfa; |QBF aAlfa;
     aAlfa = aAlfa + "def/albm0006.mas";
     |CARGA_DEF aAlfa, albm0006@;
     |SI FSalida = 0;
         |DDEFECTO #6;
         |ABRE #6;
         #6#0 = #81#25;
         #6#1 = #81#0;
         |LEE 000#6=;
         |SI FSalida ! 0;  |DDEFECTO #6;  |FINSI;
         fFecha = #6#2;
         |DESCARGA_DEF #albm0006@;
     |FINSI;
     |HAZ AlbeConsuVal;
|FPRC;

|PROCESO PedComVal;
     fFecha = efFecha;
     |HAZ AlbeConsuVal;
|FPRC;

|PROCESO AlbComVal2;
     |DBASE aAlfa; |QBF aAlfa;
     aAlfa = aAlfa + "def/albm0007.mas";
     |CARGA_DEF aAlfa, albm0007@;
     |SI FSalida = 0;
         |DDEFECTO #7;
         |ABRE #7;
         #7#0 = #77#50;
         #7#1 = #77#0;
         |LEE 000#7=;
         |SI FSalida ! 0; |DDEFECTO #7; |FINSI;
         |CIERRA #7;

         fFecha = #7#2;
         |DESCARGA_DEF #albm0007@;
     |FINSI;
     |HAZ AlbeConsuVal;
|FPRC;

|PROCESO AlbComVal;
     fFecha = efFecha;
     |HAZ AlbeConsuVal;
|FPRC;

|PROCESO FacComVal;
     |DBASE aAlfa; |QBF aAlfa;
     aAlfa = aAlfa + "def/albm0008.mas";
     |CARGA_DEF aAlfa, albm0008@;
     |SI FSalida = 0;
         |ABRE #8;
         #8#0 = #79#66;
         #8#1 = #79#0;
         |LEE 000#8=;
         |SI FSalida ! 0; |DDEFECTO #8;  |FINSI;
         |CIERRA #8;

         fFecha = #8#2;
         |DESCARGA_DEF #albm0008@;
     |FINSI;
     |HAZ AlbeConsuVal;
|FPRC;

|PROCESO PedComEntL;
     ||HAZ AlbeConsuLin;
     |HAZ AlbeEntLin;
|FPRC;

|PROCESO PedComEnt;
     ||HAZ AlbeConsuCab;
     |HAZ AlbeEntCab;
|FPRC;

|PROCESO PonFechaEnt;
     |SI nUni < #67#5;
          nUni = #67#5;
          #81#2 = #67#13; ||F.Entrega
     |FINSI;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
          Llamadas externas
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO AlbePedComLin2;
     |ESTADO_CONTROL enBoton1, "SHOW";
     |ESTADO_CONTROL enBoton2, "HIDE";
     |ESTADO_CONTROL enBoton3, "SHOW";
|FPRC;

|PROCESO AlbePedComLin1;
     |ESTADO_CONTROL enBoton1, "HIDE";
     |ESTADO_CONTROL enBoton2, "SHOW";
     |ESTADO_CONTROL enBoton3, "HIDE";
|FPRC;

|PROCESO AlbePedCom8;
     aAlfa = "BOTON, F. Entrega:";
     |CONTROL_SIMPLE 0, aAlfa, 1404, 1418, PedComEnt;
     enBoton1 = FSalida;
     |ESTADO_CONTROL enBoton1, "SHOW";

     aAlfa = "BOTON,F.Entrega";
     |CONTROL_SIMPLE 0, aAlfa, 1231, 1241, PedComEntL;
     enBoton2 = FSalida;
     |ESTADO_CONTROL enBoton2, "HIDE";

     aAlfa = "BOTON, F.Valor:";
     |CONTROL_SIMPLE 0, aAlfa, 1304, 1318, PedComVal2;
     enBoton3 = FSalida;
     |ESTADO_CONTROL enBoton3, "SHOW";
|FPRC;

|PROCESO AlbePedCom9;
     |PULSATECLA;
     |FIN_CONTROL_WINDOWS enBoton1;
     |FIN_CONTROL_WINDOWS enBoton2;
     |FIN_CONTROL_WINDOWS enBoton3;
     |PULSATECLA;
|FPRC;

|PROCESO AlbePedBorra;
     |DBASE aAlfa; |QBF aAlfa;
     aAlfa = aAlfa + "def/albm0006.mas";
     |CARGA_DEF aAlfa, albm0006@;
     |SI FSalida = 0;
        |ABRE #6;
        #6#0 = #81#25;
        #6#1 = #81#0;
        |BORRA 000#6c;
        |CIERRA #6;
        |DESCARGA_DEF #albm0006@;
     |FINSI;
|FPRC;

|PROCESO AlbePedPinta;
     |DBASE aAlfa; |QBF aAlfa;
     aAlfa = aAlfa + "def/albm0006.mas";
     |CARGA_DEF aAlfa, albm0006@;
     |SI FSalida = 0;
        |DDEFECTO #6;
        |ABRE #6;
        #6#0 = #81#25;
        #6#1 = #81#0;
        |SI FSalida ! 0; |GRABA 020#6n; |FINSI;
        |LEE 000#6=;
        |CIERRA #6;
        |PINTA 1303, " Fecha Valor                   ";
        |ATRI I;
        |PINTA 1320, #6#2;
        |PINTA 1332, #6#3;
        |ATRI 0;
        |DESCARGA_DEF #albm0006@;
     |FINSI;
|FPRC;

|PROCESO AlbePedEntra;
     |SI FSalida ! 0; |ACABA; |FINSI;

  |ET E1;
     |DBASE aAlfa; |QBF aAlfa;
     aAlfa = aAlfa + "def/albm0006.mas";
     |CARGA_DEF aAlfa, albm0006@;
     |SI FSalida = 0;
        |DDEFECTO #6;
        |ABRE #6;
        #6#0 = #81#25;
        #6#1 = #81#0;
        |LEE 101#6=;
        |SI FSalida ! 0; |GRABA 020#6b; |FINSI;
        |MENSA "0000F5> Consulta";
        |ENCAMPO #2#6;
        |SI FSalida = 13;    ||F5;
             |GRABA 020#6a;
             |LIBERA #6;
             |CIERRA #6;
             efFecha = #6#2;
             |DESCARGA_DEF #albm0006@;

             |HAZ PedComVal2;
             |VETE E1;
        |SINO;
             |SI FSalida = 0;
                  |MENSA "0000Valor Acordado S/N";
                  |ENCAMPO #3#6;
             |FINSI;
        |FINSI;
        |GRABA 020#6a;
        |CIERRA #6;
        |DESCARGA_DEF #albm0006@;
     |FINSI;
|FPRC;

|PROCESO AlbePedPintaL;
     |DBASE aAlfa; |QBF aAlfa;
     aAlfa = aAlfa + "def/albm0009.mas";
     |CARGA_DEF aAlfa, albm0009@;
     |SI FSalida = 0;
        |DDEFECTO #9;
        |ABRE #9;
        #9#0 = #67#28;
        #9#1 = #67#0;
        #9#2 = #67#1;
        |LEE 000#9=;
        |SI FSalida ! 0; |GRABA 020#9n; |FINSI;
        |CIERRA #9;
        |PINTA 1002, "F.Entrada Real: ";
        |ATRI I; |PINTA 1018, #9#3; |ATRI 0;
        |DESCARGA_DEF #albm0009@;
     |FINSI;

     |DBASE aAlfa; |QBF aAlfa;
     aAlfa = aAlfa + "def/albm0044.mas";
     |CARGA_DEF aAlfa, albm0044@;
     |SI FSalida = 0;
        |DDEFECTO #albm0044@;
        |ABRE #albm0044@;
        #albm0044@#0 = #81#4;
        #albm0044@#1 = #67#2;
        |LEE 000#albm0044@.=;
        |CIERRA #albm0044@;
        |PINTA 1102, "Art./Prov.:";
        |ATRI I; |PINTA 1114, #albm0044@#3; |ATRI 0;
        |DESCARGA_DEF #albm0044@;
     |FINSI;
|FPRC;

|PROCESO AlbeFinPedi;
     nUni = 0;
     |BUCLELIN 2PonFechaEnt#81;
|FPRC;

|PROCESO AlbePedFec;
     ||컴컴컴컴횮alcula Fecha Valor
     aProve = #81#4;
     |HAZ AlbeLeeProve;

     nDia1 = #112#19;
     nDia2 = #112#20;
     nDia3 = #112#21;
     fFechaFac = #81#2;

     aPago = #81#9;
     |HAZ AlbeLeePago;

     |HAZ AlbeVto;

     |DBASE aAlfa; |QBF aAlfa;
     aAlfa = aAlfa + "def/albm0006.mas";
     |CARGA_DEF aAlfa, albm0006@;
     |SI FSalida = 0;
        |ABRE #6;
        #6#0 = #81#25;
        #6#1 = #81#0;
        |LEE 101#6=;
        |SI FSalida ! 0; |GRABA 020#6b; |FINSI;
        #6#2 = fFecVto;
        |GRABA 020#6a;
        |CIERRA #6;
        |DESCARGA_DEF #albm0006@;
     |FINSI;
|FPRC;

|PROCESO AlbePedFec2;
     ||컴컴컴컴횮alcula Fecha Valor
     aProve = #81#4;
     |HAZ AlbeLeeProve;

     nDia1 = #112#19;
     nDia2 = #112#20;
     nDia3 = #112#21;
     fFechaFac = #81#2;

     aPago = #81#9;
     |HAZ AlbeLeePago;

     |HAZ AlbeVto;
|FPRC;

|PROCESO AlbeConsuLin;
     |DBASE aAlfa; |QBF aAlfa;
     aMas = aAlfa + "def/albw0002.mas";
     |CARGA_DEF aMas, albw0002@;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     aMas = aAlfa + "def/albw0008.mas";
     |CARGA_DEF aMas, albw0008@;
     |SI FSalida ! 0;
         |DESCARGA_DEF #albw0002@;
         |ACABA;
     |FINSI;

     aAlfa = Usuario; aAlfa = "0" + aAlfa;
     |NOME_DAT #2 aAlfa;
     |DELINDEX #2; |ABRE #2;

     aAlfa = Usuario; aAlfa = "1" + aAlfa;
     |NOME_DAT #88 aAlfa;
     |DELINDEX #88; |ABRE #88;

     |HAZ AlbeConsuLin2;
     |LEE 000#2p;
     |PARA;  |SI;  |HACIENDO;
          |CONSULTA_CLAVE #1#2;
          |SI FSalida ! 0;  |SAL;  |FINSI;

          |CONSULTA_F_CLAVE #1#88, Baja88, Alta88;
     |SIGUE;

     |CIERRA #2; |DELINDEX #2;
     |CIERRA #88; |DELINDEX #88;

     |DESCARGA_DEF #albw0008@;
     |DESCARGA_DEF #albw0002@;
|FPRC;

|PROCESO AlbeConsuCab;
     |DBASE aAlfa; |QBF aAlfa;
     aMas = aAlfa + "def/albw0002.mas";
     |CARGA_DEF aMas, albw0002@;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     aMas = aAlfa + "def/albw0008.mas";
     |CARGA_DEF aMas, albw0008@;
     |SI FSalida ! 0;
         |DESCARGA_DEF #albw0002@;
         |ACABA;
     |FINSI;

     aAlfa = Usuario; aAlfa = "0" + aAlfa;
     |NOME_DAT #2 aAlfa;
     |DELINDEX #2;  |ABRE #2;

     aAlfa = Usuario; aAlfa = "1" + aAlfa;
     |NOME_DAT #88 aAlfa;
     |DELINDEX #88; |ABRE #88;

     |BUCLELIN 2AlbeConsuLin2#81;

     |LEE 000#2p;
     |PARA;  |SI;  |HACIENDO;
          |CONSULTA_CLAVE #1#2;
          |SI FSalida ! 0;  |SAL;  |FINSI;

          |CONSULTA_F_CLAVE #1#88, Baja88, Alta88;
     |SIGUE;

     |CIERRA #2;   |DELINDEX #2;
     |CIERRA #88;  |DELINDEX #88;

     |DESCARGA_DEF #albw0008@;
     |DESCARGA_DEF #albw0002@;
|FPRC;

|PROCESO AlbeFecPedi;
     |SI #80#12 = 0; |O #80#21 = 0; |ACABA; |FINSI;

     |DBASE aAlfa; |QBF aAlfa;
     aAlfa = aAlfa + "def/albm0009.mas";
     |CARGA_DEF aAlfa, albm0009@;
     |SI FSalida = 0;
        |ABRE #9;
        #9#0 = #80#29;
        #9#1 = #80#12;
        #9#2 = #80#21;
        |LEE 101#9=;
        |SI FSalida ! 0; |GRABA 020#9b; |FINSI;
        #9#3 = #77#1;
        |GRABA 020#9a;
        |LIBERA #9;
        |CIERRA #albm0009@; |DESCARGA_DEF #albm0009@;
     |FINSI;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO AlbeAlbComLin2;
     |ESTADO_CONTROL enBoton1, "SHOW";
|FPRC;

|PROCESO AlbeAlbComLin1;
     |ESTADO_CONTROL enBoton1, "HIDE";
|FPRC;

|PROCESO AlbeAlbCom8;
     aAlfa = "BOTON, F. Valor:";
     |CONTROL_SIMPLE 0, aAlfa, 1304, 1325, AlbComVal2;
     enBoton1 = FSalida;
     |ESTADO_CONTROL enBoton1, "SHOW";
|FPRC;

|PROCESO AlbeAlbCom9;
     |PULSATECLA;
     |FIN_CONTROL_WINDOWS enBoton1;
     |PULSATECLA;
|FPRC;

|PROCESO AlbeAlbBorra;
     |DBASE aAlfa; |QBF aAlfa;
     aAlfa = aAlfa + "def/albm0007.mas";
     |CARGA_DEF aAlfa, albm0007@;
     |SI FSalida = 0;
        |ABRE #7;
        #7#0 = #77#50;
        #7#1 = #77#0;
        |BORRA 000#7c;
        |CIERRA #7;
        |DESCARGA_DEF #albm0007@;
     |FINSI;
|FPRC;

|PROCESO AlbeAlbPinta;
     |DBASE aAlfa; |QBF aAlfa;
     aAlfa = aAlfa + "def/albm0007.mas";
     |CARGA_DEF aAlfa, albm0007@;
     |SI FSalida = 0;
        |DDEFECTO #7;
        |ABRE #7;
        #7#0 = #77#50;
        #7#1 = #77#0;
        |LEE 000#7=;
        |SI FSalida ! 0; |GRABA 020#7n; |FINSI;
        |CIERRA #7;
        |PINTA 1303, " Fecha Valor                   ";
        |ATRI I; |PINTA 1326, #7#2; |ATRI 0;
        |DESCARGA_DEF #albm0007@;
     |FINSI;
|FPRC;

|PROCESO AlbeAlbEntra;
     |SI FSalida ! 0; |ACABA; |FINSI;
     |DBASE aAlfa; |QBF aAlfa;
     aAlfa = aAlfa + "def/albm0007.mas";
     |CARGA_DEF aAlfa, albm0007@;
     |SI FSalida = 0;
  |ET E2;
        |DDEFECTO #7;
        |ABRE #7;
        #7#0 = #77#50;
        #7#1 = #77#0;
        |LEE 101#7=;
        |SI FSalida ! 0; |GRABA 020#7b; |FINSI;
        |MENSA "0000<F5> Consulta";
        |ENCAMPO #2#7;
        |SI FSalida = 13;    ||F5;
             |CIERRA #7;
             |HAZ AlbComVal2;
             |VETE E2;
        |FINSI;
        |GRABA 020#7a;
        |CIERRA #7;
        |DESCARGA_DEF #albm0007@;
     |FINSI;
|FPRC;

|PROCESO AlbeAlbFec;
     ||컴컴컴컴횮alcula Fecha Valor
     aProve = #77#3;
     |HAZ AlbeLeeProve;

     nDia1 = #112#19;
     nDia2 = #112#20;
     nDia3 = #112#21;
     fFechaFac = #77#1;

     aPago = #77#8;
     |HAZ AlbeLeePago;

     |HAZ AlbeVto;

     |DBASE aAlfa; |QBF aAlfa;
     aAlfa = aAlfa + "def/albm0007.mas";
     |CARGA_DEF aAlfa, albm0007@;
     |SI FSalida = 0;
        |ABRE #7;
        #7#0 = #77#50;
        #7#1 = #77#0;
        |LEE 101#7=;
        |SI FSalida ! 0; |GRABA 020#7b; |FINSI;
        #7#2 = fFecVto;
        |GRABA 020#7a;
        |CIERRA #7;
        |DESCARGA_DEF #albm0007@;
     |FINSI;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO AlbeFacComLin2;
     |ESTADO_CONTROL enBoton1, "SHOW";
|FPRC;

|PROCESO AlbeFacComLin1;
     |ESTADO_CONTROL enBoton1, "HIDE";
|FPRC;

|PROCESO AlbeFacCom8;
     aAlfa = "BOTON, F. Valor:";
     |CONTROL_SIMPLE 0, aAlfa, 1102, 1124, FacComVal;
     enBoton1 = FSalida;
     |ESTADO_CONTROL enBoton1, "SHOW";
|FPRC;

|PROCESO AlbeFacCom9;
     |PULSATECLA;
     |FIN_CONTROL_WINDOWS enBoton1;
     |PULSATECLA;
|FPRC;

|PROCESO AlbeFacBorra;
     |DBASE aAlfa; |QBF aAlfa;
     aAlfa = aAlfa + "def/albm0008.mas";
     |CARGA_DEF aAlfa, albm0008@;
     |SI FSalida = 0;
        |ABRE #8;
        #8#0 = #79#66;
        #8#1 = #79#0;
        |BORRA 000#8c;
        |CIERRA #8;
        |DESCARGA_DEF #albm0008@;
     |FINSI;
|FPRC;

|PROCESO AlbeFacPinta;
     |DBASE aAlfa; |QBF aAlfa;
     aAlfa = aAlfa + "def/albm0008.mas";
     |CARGA_DEF aAlfa, albm0008@;
     |SI FSalida = 0;
        |DDEFECTO #8;
        |ABRE #8;
        #8#0 = #79#66;
        #8#1 = #79#0;
        |LEE 000#8=;
        |SI FSalida ! 0; |GRABA 020#8n; |FINSI;
        |CIERRA #8;
        |PINTA 1103, " Fecha Valor                   ";
        |ATRI I; |PINTA 1125, #8#2; |ATRI 0;
        |DESCARGA_DEF #albm0008@;
     |FINSI;
|FPRC;

|PROCESO AlbeFacEntra;
     |SI FSalida ! 0; |ACABA; |FINSI;
     |DBASE aAlfa; |QBF aAlfa;
     aAlfa = aAlfa + "def/albm0008.mas";
     |CARGA_DEF aAlfa, albm0008@;
     |SI FSalida = 0;
  |ET E3;
        |DDEFECTO #8;
        |ABRE #8;
        #8#0 = #79#66;
        #8#1 = #79#0;
        |LEE 101#8=;
        |SI FSalida ! 0; |GRABA 020#8b; |FINSI;
        |MENSA "0000<F5> Consulta";
        |ENCAMPO #2#8;
        |SI FSalida = 13;    ||F5;
             |CIERRA #8;
             |HAZ AlbComVal2;
             |VETE E3;
        |FINSI;
        |GRABA 020#8a;
        |CIERRA #8;
        |DESCARGA_DEF #albm0008@;
     |FINSI;
|FPRC;

|PROCESO AlbeFacFec;
     ||컴컴컴컴횮alcula Fecha Valor
     aProve = #79#2;
     |HAZ AlbeLeeProve;

     nDia1 = #79#14;
     nDia2 = #79#15;
     nDia3 = #79#16;
     fFechaFac = #79#1;

     aPago = #79#11;
     |HAZ AlbeLeePago;

     |HAZ AlbeVto;

     |DBASE aAlfa; |QBF aAlfa;
     aAlfa = aAlfa + "def/albm0008.mas";
     |CARGA_DEF aAlfa, albm0008@;
     |SI FSalida = 0;
        |ABRE #8;
        #8#0 = #79#66;
        #8#1 = #79#0;
        |LEE 101#8=;
        |SI FSalida ! 0; |GRABA 020#8b; |FINSI;
        #8#2 = fFecVto;
        |GRABA 020#8a;
        |CIERRA #8;
        |DESCARGA_DEF #albm0008@;
     |FINSI;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO AlbePedVEntra;
     |DBASE aAlfa; |QBF aAlfa;
     aAlfa = aAlfa + "def/albm0010.mas";
     |CARGA_DEF aAlfa, albm0010@;
     |SI FSalida = 0;
        |DDEFECTO #10;
        |ABRE #10;
        #10#0 = #104#25;
        #10#1 = #104#0;
        |LEE 101#10=; |SI FSalida ! 0; |GRABA 020#10b; |FINSI;
        |ENCAMPO #2#10;
        |ENCAMPO #3#10;
        |GRABA 020#10a;
        |CIERRA #10;
        |DESCARGA_DEF #albm0010@;
     |FINSI;
|FPRC;

|PROCESO AlbePedVPinta;
     |DBASE aAlfa; |QBF aAlfa;
     aAlfa = aAlfa + "def/albm0010.mas";
     |CARGA_DEF aAlfa, albm0010@;
     |SI FSalida = 0;
        |DDEFECTO #10;
        |ABRE #10;
        #10#0 = #104#25;
        #10#1 = #104#0;
        |LEE 000#10=;
        |SI FSalida ! 0; |GRABA 020#10n; |FINSI;
        |CIERRA #10;
        |PINTA 1203, "F.V.:           F.C.:          ";
        |PINTA 1244, "Fax Rec:   Fax Env:  Conforme:  ";
        |ATRI I;
        |PINTA 1207, #10#2; |PINTA 1223, #10#3;
        |PINTA 1252, #10#4; |PINTA 1263, #10#5; |PINTA 1274, #10#6;
        |ATRI 0;
        |DESCARGA_DEF #albm0010@;
     |FINSI;
|FPRC;

|PROCESO AlbePedVBorra;
     |DBASE aAlfa; |QBF aAlfa;
     aAlfa = aAlfa + "def/albm0010.mas";
     |CARGA_DEF aAlfa, albm0010@;
     |SI FSalida = 0;
        |ABRE #10;
        #10#0 = #104#25;
        #10#1 = #104#0;
        |BORRA 000#10c;
        |CIERRA #10;
        |DESCARGA_DEF #albm0010@;
     |FINSI;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO AlbeAlbVEntra;
     |DBASE aAlfa; |QBF aAlfa;
     aAlfa = aAlfa + "def/albm0011.mas";
     |CARGA_DEF aAlfa, albm0011@;
     |SI FSalida = 0;
        |SI enDesdeX ! 0;
            |C_P #11#2, 1, 0887;
        |SINO;
            |MODULO aAlfa;
            |SI aAlfa ! "agifa010";
                |C_P #11#2, 1, 1312;
            |FINSI;
        |FINSI;

        |DDEFECTO #11;
        |ABRE #11;
        #11#0 = #110#52;
        #11#1 = #110#0;
        |LEE 101#11=; |SI FSalida ! 0; |GRABA 020#11b; |FINSI;
        |ENCAMPO #2#11;
        |GRABA 020#11a;
        |CIERRA #11;
        |DESCARGA_DEF #11;
     |FINSI;
|FPRC;

|PROCESO AlbeAlbVPinta;
     |DBASE aAlfa; |QBF aAlfa;
     aAlfa = aAlfa + "def/albm0011.mas";
     |CARGA_DEF aAlfa, albm0011@;
     |SI FSalida = 0;
        |DDEFECTO #11;
        |ABRE #11;
        #11#0 = #110#52;
        #11#1 = #110#0;
        |LEE 000#11=;
        |SI FSalida ! 0; |GRABA 020#11n; |FINSI;
        |CIERRA #11;
        |MODULO aAlfa;

        |SI enDesdeX = 0;
            |SI aAlfa = "agifa010";
                |PINTA 1203, "F.Valor:                ";
                |ATRI I; |PINTA 1212, #11#2; |ATRI 0;
            |SINO;
                |PINTA 1203, "F.Valor:                ";
                |ATRI I; |PINTA 1312, #11#2; |ATRI 0;
            |FINSI;
        |SINO;
            |ATRI I; |PINTA 0887, #11#2; |ATRI 0;
        |FINSI;
        |DESCARGA_DEF #11;
     |FINSI;
|FPRC;

|PROCESO AlbeAlbVBorra;
     |DBASE aAlfa; |QBF aAlfa;
     aAlfa = aAlfa + "def/albm0011.mas";
     |CARGA_DEF aAlfa, albm0011@;
     |SI FSalida = 0;
        |ABRE #11;
        #11#0 = #110#52;
        #11#1 = #110#0;
        |BORRA 000#11c;
        |CIERRA #11;
        |DESCARGA_DEF #11;
     |FINSI;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO AlbeFacVEntra;
     |DBASE aAlfa; |QBF aAlfa;
     aAlfa = aAlfa + "def/albm0012.mas";
     |CARGA_DEF aAlfa, albm0012@;
     |SI FSalida = 0;
        |DDEFECTO #12;
        |ABRE #12;
        #12#0 = #134#49;
        #12#1 = #134#0;
        |LEE 101#12=; |SI FSalida ! 0; |GRABA 020#12b; |FINSI;
        |ENCAMPO #2#12;
        |GRABA 020#12a;
        |CIERRA #12;
        |DESCARGA_DEF #albm0012@;
     |FINSI;
|FPRC;

|PROCESO AlbeFacVPinta;
     |DBASE aAlfa; |QBF aAlfa;
     aAlfa = aAlfa + "def/albm0012.mas";
     |CARGA_DEF aAlfa, albm0012@;
     |SI FSalida = 0;
        |DDEFECTO #12;
        |ABRE #12;
        #12#0 = #134#49;
        #12#1 = #134#0;
        |SI FSalida ! 0; |GRABA 020#12n; |FINSI;
        |LEE 000#12=;
        |CIERRA #12;

        |PINTA 1101, " Fecha Valor:                  ";
        |ATRI I; |PINTA 1115, #12#2; |ATRI 0;
        |DESCARGA_DEF #albm0012@;
     |FINSI;
|FPRC;

|PROCESO AlbeFacVBorra;
     |DBASE aAlfa; |QBF aAlfa;
     aAlfa = aAlfa + "def/albm0012.mas";
     |CARGA_DEF aAlfa, albm0012@;
     |SI FSalida = 0;
        |ABRE #12;
        #12#0 = #134#49;
        #12#1 = #134#0;
        |BORRA 000#12c;
        |CIERRA #12;
        |DESCARGA_DEF #12;
     |FINSI;
|FPRC;

|PROCESO AlbeFecVto;
     |DBASE aAlfa; |QBF aAlfa;
     aAlfa = aAlfa + "def/albm0012.mas";
     |CARGA_DEF aAlfa, albm0012@;
     |SI FSalida = 0;
        |ABRE #12;
        #12#0 = #134#49;
        #12#1 = #134#0;
        |LEE 000#12=;
        |SI FSalida = 0; |Y #12#2 ! "01.01.0000";
             enFecVto = #12#2;
        |FINSI;
        |CIERRA #12;
        |DESCARGA_DEF #12;
     |FINSI;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO AlbePed2Alb;
     |DBASE aAlfa; |QBF aAlfa;
     aAlfa = aAlfa + "def/albm0010.mas";
     |CARGA_DEF aAlfa, albm0010@;
     |SI FSalida = 0;
        |DDEFECTO #10;
        |ABRE #10;
        #10#0 = #71#31;
        #10#1 = #71#12;
        |LEE 000#10=;
        |CIERRA #10;
        |DESCARGA_DEF #albm0010@;
     |FINSI;

     |DBASE aAlfa; |QBF aAlfa;
     aAlfa = aAlfa + "def/albm0011.mas";
     |CARGA_DEF aAlfa, albm0011@;
     |SI FSalida = 0;
        |ABRE #11;
        #11#0 = #71#29;
        #11#1 = #71#0;
        |LEE 101#11=;
        |SI FSalida ! 0; |GRABA 020#11b; |FINSI;
        #11#2 = #10#2;
        |GRABA 020#11a;
        |CIERRA #11;
        |DESCARGA_DEF #11;
     |FINSI;
|FPRC;

|PROCESO AlbeAlb2Fac;
     |DBASE aAlfa; |QBF aAlfa;
     aAlfa = aAlfa + "def/albm0011.mas";
     |CARGA_DEF aAlfa, albm0011@;
     |SI FSalida = 0;
        |DDEFECTO #11;
        |ABRE #11;
        #11#0 = #59#15;
        #11#1 = #59#2;
        |LEE 000#11=;
        |CIERRA #11;
        |DESCARGA_DEF #11;
     |FINSI;

     |DBASE aAlfa; |QBF aAlfa;
     aAlfa = aAlfa + "def/albm0012.mas";
     |CARGA_DEF aAlfa, albm0012@;
     |SI FSalida = 0;
        |ABRE #12;
        #12#0 = #59#14;
        #12#1 = #59#0
        |LEE 101#12=;
        |SI FSalida ! 0; |GRABA 020#12b; |FINSI;
        #12#2 = #11#2;
        |CIERRA #12;
        |DESCARGA_DEF #12;
     |FINSI;
|FPRC;

|PROCESO AlbePedPintaLV;
     |DBASE aAlfa; |QBF aAlfa;
     aAlfa = aAlfa + "def/albm0028.mas";
     |CARGA_DEF aAlfa, albm0028@;
     |SI FSalida = 0;
        |DDEFECTO #28;
        |ABRE #28;
        #28#0 = #73#28;
        #28#1 = #73#0;
        #28#2 = #73#1;
        |LEE 000#28=;
        |SI FSalida ! 0; |GRABA 020#28n; |FINSI;
        |CIERRA #28;
        |PINTA 1045, "En Fabr..:";
        |ATRI I; |PINTA 1055, #28#3; |ATRI 0;
        |DESCARGA_DEF #albm0028@;
     |FINSI;
|FPRC;

|PROCESO ImpAlbeFax;
     |PRINT;
|FPRC;

|PROCESO AlberoEnvFax;
     |DBASE aAlfa; |QBF aAlfa;
     aAlfa = aAlfa + "def/albm0010.mas";
     |CARGA_DEF aAlfa, albm0010@;
     |SI FSalida = 0;
          |DDEFECTO #10;
          |ABRE #10;
          #10#0 = #104#25;
          #10#1 = #104#0;
          |LEE 101#10=;
          |SI FSalida ! 0; |GRABA 020#10b; |FINSI;
          |IMPRE 0;
          |SI FSalida = 0;
               |INFOR "alberfax";
               |SI FSalida ! 0;
                    |MENAV "0000No existe informe 'alberfax'";
               |SINO;
                    |BUCLELIN 2ImpAlbeFax#104;
                    |FININF;
                    |PIEINF;
                    #10#5 = "S";
               |FINSI;
               |FINIMP;
          |FINSI;
          |GRABA 020#10a;
          |CIERRA #10;
          |DESCARGA_DEF #albm0010@;
     |FINSI;
|FPRC;

|PROCESO AlbeBorraPdte;
     |DBASE aAlfa; |QBF aAlfa;
     aAlfa = aAlfa + "def/albm0003.mas";
     |CARGA_DEF aAlfa, albm0003@;
     |SI FSalida = 0;
         |ABRE #3;
         #3#0 = #67#28;
         #3#1 = #67#0;
         |LEE 101#3=;
         |SI FSalida = 0;  |Y #67#2 = #3#4;  |Y #67#20 = #3#7;
             |BORRA 020#3a;
         |FINSI;
         |LIBERA #3;
         |CIERRA #3;
         |DESCARGA_DEF #albm0003@;
     |FINSI;
|FPRC;

|PROCESO AlbeModifPdte;
     |DBASE aAlfa; |QBF aAlfa;
     aAlfa = aAlfa + "def/albm0003.mas";
     |CARGA_DEF aAlfa, albm0003@;
     |SI FSalida = 0;
         |ABRE #3;
         #3#0 = #67#28;
         #3#1 = #67#0;
         |LEE 101#3=;
||         |SI FSalida = 0;  |Y #67#2 = #3#4;  |Y #67#20 = #3#7;
         |SI FSalida = 0;
             #3#3 = #67#3;    ||Almacen
             #3#4 = #67#2;    ||Articulo
             #3#5 = #67#4;    ||Desc. Articulo
             #3#6 = #67#5;    ||Unidades
             #3#7 = #67#20;   ||Proveedor
             #3#8 = #67#6;    ||Precio
             |GRABA 020#3a;
         |FINSI;
         |LIBERA #3;
         |CIERRA #3;
         |DESCARGA_DEF #albm0003@;
     |FINSI;
|FPRC;

||ACI

|PROCESO AlberoActPartidas;
     nForma = enAlbForma;
     aArticulo = #80#2;
     nAlmacen = #80#3;
     aPartida46 = #80#37;
     aProveedor = #77#3;
     fFechaEnt = #77#1;
     aTipoDoc = "AC";
     nUnidades1 = enUni1;
     nUnidades2 = enUni2;
     aSerPed = #80#29;
     nNumPed = #80#12;
     nPrecio = #80#30;
     aIncPar = eaIncPar;

     ||Para las lineas
     aSerLin = #80#27;
     nNumLin = #80#0;
     nLinLin = #80#1;
     aArtPartida = "";
     nAlmPartida = 0;
     aParPartida = "ENTRADA";
     aProducido = "";
     aProduDes = "";
     aObs = "";

     |HAZ AlbeEntPartidasTODOS;
|FPRC;

|PROCESO AlberoActPartidasEV;
     nForma = enAlbForma;
     aArticulo = #dsm00057#0;
     nAlmacen = #dsm00057#1;
     aPartida46 = #dsm00057#22;
     aProveedor = #dsm00057#5;
     fFechaEnt = #dsm00056#1;
     aTipoDoc = "EV";
     nUnidades1 = enUni1;
     nUnidades2 = enUni2;

     nPrecio = #dsm00057#19;

     ||Tiquet. 3026/762
     aAuxLetra = aPartida46 % 101;
     |SI aAuxLetra = "M";
          aAuxLetra = aPartida46 - "M";
          nNumMez = aAuxLetra;
          |SI nNumMez ! 0;
               |DBASE aAlfa; |QBF aAlfa;
               aMas = aAlfa + "def/albm0031.mas";
               |CARGA_DEF aMas, referen@;
               |SI FSalida ! 0;  |ACABA;  |FINSI;

               |ABRE #referen@;
               #referen@#0 = nNumMez;
               |LEE 000#referen@.=;
               |SI FSalida = 0;
                    aAux1 = aPartida46;
                    aAux2 = #referen@#20;
                    |QBF aAux1;
                    |QBF aAux2;
                    |SI aAux1 = aAux2;
                         nPrecio = #referen@#22;
                    |FINSI;
               |FINSI;

               |CIERRA #referen@;
               |DESCARGA_DEF #referen@;
          |FINSI;
     |FINSI;

     aIncPar = "N";

     ||Para las lineas
     aSerLin = #dsm00057#28;
     nNumLin = #dsm00057#27;
     nLinLin = #dsm00057#14;

     aArtPartida = "";
     nAlmPartida = enAlmPar;
     |SI nUnidades1 < 0; |O nUnidades2 < 0;
          aParPartida = "SALIDA";
     |SINO;
          aParPartida = "ENTRADA";
     |FINSI;
     aAux = eaNumPar;
     |QBF aAux;
     |SI aAux ! "";
          aParPartida = eaNumPar;
          |QBF aParPartida;
     |FINSI;
     aProducido = "";
     aProduDes = "";
     |SI eaObser47 ! "";
          aObs = eaObser47;  || Llamada del albz0001
     |SINO;
          aObs = #dsm00057#15 + #dsm00057#16;
     |FINSI;

     |HAZ AlbeEntPartidasTODOS;
|FPRC;

|PROCESO AlberoActPartidasSA;
     nForma = enAlbForma;
     aArticulo = #agist002#2;
     nAlmacen = #agist002#3;
     aPartida46 = #agist002#8;
     fFechaEnt = #agist001#1;
     aTipoDoc = "SA";
     nUnidades1 = enUni1;
     nUnidades2 = enUni2;
     nPrecio = #agist002#5;
     aIncPar = "N";

     ||Para las lineas
     aSerLin = #agist002#13;
     nNumLin = #agist002#0;
     nLinLin = #agist002#1;
     aArtPartida = "";
     nAlmPartida = 0;
     |SI nUnidades1 < 0; |O nUnidades2 < 0;
          aParPartida = "SALIDA";
     |SINO;
          aParPartida = "ENTRADA";
     |FINSI;
     aProducido = "";
     aProduDes = "";
     aObs = "";

     |HAZ AlbeEntPartidasTODOS;
|FPRC;

|PROCESO AlberoActPartidasES;
     nForma = enAlbForma;
     aArticulo = #dsm00044#0;
     nAlmacen = #dsm00044#1;
     aPartida46 = #dsm00044#13;
     fFechaEnt = #dsm00043#1;
     aTipoDoc = "ES";
     nUnidades1 = enUni1;
     nUnidades2 = enUni2;
     aIncPar = eaIncPar;

     ||Para las lineas
     aSerLin = #dsm00044#21;
     nNumLin = #dsm00044#18;
     nLinLin = #dsm00044#8;
     aArtPartida = "";
     nAlmPartida = enAlmPar;
     |SI #dsm00044#7 = "S";
          aParPartida = "SALIDA";
     |SINO;
          aParPartida = "ENTRADA";
     |FINSI;
     aAux = eaNumPar;
     |QBF aAux;
     |SI aAux ! "";
          aParPartida = eaNumPar;
     |FINSI;

     aProducido = eaProducido;
     aProduDes = eaDesPro;
     |SI eaObser47 ! "";
          aObs = eaObser47;  || Llamada del albz0001
     |SINO;
          aObs = "";
     |FINSI;

     |HAZ AlbeEntPartidasTODOS;
|FPRC;

|PROCESO AlberoActPartidasOF2;      ||Orden Fabricacion PArtidas SALIDA
     nForma = enAlbForma;
     aArticulo = eaArtOF;
     nAlmacen = enAlmOF;
     aPartida46 = eaParOF;
     fFechaEnt = efFecOF;
     aTipoDoc = "OF2";
     nUnidades1 = enUni1;
     nUnidades2 = enUni2;
     aIncPar = eaIncPar;
     aProveedor = "000000";

     ||Para las lineas
     aSerLin = eaSerOF;
     nNumLin = eaNumOF;
     nLinLin = enLinOF;
     aArtPartida = "";
     nAlmPartida = 000000;
     aParPartida = "SALIDA";
     aProducido = eaProducido;
     aProduDes = eaDesPro;
     aObs = "";
     |HAZ AlbeEntPartidasTODOS;
|FPRC;

|PROCESO AlberoActPartidasOF;      ||Orden Fabricacion
     nForma = enAlbForma;
     aArticulo = eaArtOF;
     nAlmacen = enAlmOF;
     aPartida46 = eaParOF;
     fFechaEnt = efFecOF;
     aTipoDoc = "OF";
     nUnidades1 = enUni1;
     nUnidades2 = enUni2;
     aIncPar = eaIncPar;
     aProveedor = "000000";

     ||Para las lineas
     aSerLin = eaSerOF;
     nNumLin = eaNumOF;
     nLinLin = 0;
     aArtPartida = "";
     nAlmPartida = 000000;
     aParPartida = "";
     aProducido = "";
     aProduDes = "";
     aObs = "";
     |HAZ AlbeEntPartidasTODOS;
|FPRC;

|PROCESO AlberoActPartidasAV;
     nForma = enAlbForma;
     aArticulo = #71#2;
     nAlmacen = #71#3;
     aPartida46 = #71#49;
     aProveedor = "";
     fFechaEnt = #110#1;
     aTipoDoc = "AV";
     nUnidades1 = -enUni1;
     nUnidades2 = -enUni2;
     aSerPed = "";
     nNumPed = "";
     nPrecio = #71#6;
     aIncPar = eaIncPar;

     ||Para las lineas
     aSerLin = #71#29;
     nNumLin = #71#0;
     nLinLin = #71#1;
     aArtPartida = "";
     nAlmPartida = 0;
     aParPartida = "SALIDA";
     aProducido = "";
     aProduDes = "";
     aObs = "";

     |HAZ AlbeEntPartidasTODOS;
|FPRC;

|PROCESO AlberoActPartidasMS;
     nForma = enAlbForma;
     aArticulo = eaArt61;
     nAlmacen = enAlm61;
     aPartida46 = eaPar61;
     aProveedor = "";
     fFechaEnt = "";
     aTipoDoc = "MS";
     nUnidades1 = enUni1;
     nUnidades2 = enUni2;
     nPrecio = 0;
     aIncPar = "N";

     ||Para las lineas
     aSerLin = eaSer61;
     nNumLin = enNum61;
     nLinLin = enLin61;

     aArtPartida = "";
     nAlmPartida = 0;
     aParPartida = "SALIDA";
     aProducido = "";
     aProduDes = "";

     |HAZ AlbeEntPartidasTODOS;
|FPRC;


|PROCESO AlberoActPartidasME;
     nForma = enAlbForma;
     aArticulo = eaArt61;
     nAlmacen = enAlm61;
     aPartida46 = eaPar61;
     aProveedor = "";
     fFechaEnt = "";
     aTipoDoc = "ME";
     nUnidades1 = enUni1;
     nUnidades2 = enUni2;
     nPrecio = 0;
     aIncPar = "N";

     ||Para las lineas
     aSerLin = eaSer61;
     nNumLin = enNum61;
     nLinLin = enLin61;

     aArtPartida = "";
     nAlmPartida = 0;
     aParPartida = "ENTRADA";
     aProducido = "";
     aProduDes = "";

     |HAZ AlbeEntPartidasTODOS;
|FPRC;


|PROCESO AlbeDamePartida;
     |DBASE aAlfa; |QBF aAlfa;
     aAlfa = aAlfa + "def/albm0045.mas";
     |CARGA_DEF aAlfa, albm0045@;
     |SI FSalida = 0;
          |ABRE #albm0045@;
          #albm0045@#0 = enAlbeAlm;
          #albm0045@#1 = eaTipoMov;
          |LEE 101#albm0045@.=;
          |SI FSalida ! 0; |GRABA 020#albm0045@.b; |FINSI;
          #albm0045@#2 = #albm0045@#2 + 1;

          |ABRE #albm0046;
          #albm0046#1 = enAlbeAlm;
          #albm0046#2 = #albm0045@#2;
          |LEE 000#albm0046.=;
          nSalida = FSalida;
          |PARA; |SI nSalida = 0; |HACIENDO;
               #albm0045@#2 = #albm0045@#2 + 1;
               #albm0046#1 = enAlbeAlm;
               #albm0046#2 = #albm0045@#2;
               |LEE 000#albm0046.=;
               nSalida = FSalida;
          |SIGUE;
          |CIERRA #albm0046;

          |GRABA 020#albm0045@.a;
          |LIBERA #albm0045@;
          |CIERRA #albm0045@;
          eaAlbePar = #albm0045@#2;
          |DESCARGA_DEF #albm0045@;
     |FINSI;
|FPRC;

|PROCESO AlbeDimeArtAra;
     |ABRE #albm0046;
     |DDEFECTO #albm0046;
     #albm0046#1 = enAlbeAlm;
     #albm0046#2 = eaAlbePar;
     |LEE 000#albm0046.=;
     |SI FSalida = 0;
          eaAlbeArt = #albm0046#0;
     |FINSI;
     |CIERRA #albm0046;
|FPRC;

|PROCESO AlbeArtPrv;
     |DBASE aAlfa; |QBF aAlfa;
     aAlfa = aAlfa + "def/albm0044.mas";
     |CARGA_DEF aAlfa, albm0044@;
     |SI FSalida = 0;
        |ABRE #albm0044@;
        |DDEFECTO #albm0044@;
        #albm0044@#0 = eaPrvPLB;
        #albm0044@#1 = eaArtPLB;
        |LEE 000#albm0044@.=;
        eaArtPrv = #albm0044@#3
        |CIERRA #albm0044@;
        |DESCARGA_DEF #albm0044@;
     |FINSI;
|FPRC;

|PROCESO AlbePedModL;
     |DBASE aAlfa; |QBF aAlfa;
     aAlfa = aAlfa + "def/albm0044.mas";
     |CARGA_DEF aAlfa, albm0044@;
     |SI FSalida = 0;
        |DDEFECTO #albm0044@;
        |ABRE #albm0044@;
        #albm0044@#0 = #81#4;
        #albm0044@#1 = #67#2;
        |LEE 101#albm0044@.=;
        |SI FSalida ! 0; |GRABA 020#albm0044@.b; |FINSI;
        |C_P #albm0044@#3, 1, 1114;
        |ATRI I; |PINTA 1114, #albm0044@#3; |ATRI 0;
        |ENCAMPO #3#albm0044@;
        |GRABA 020#albm0044@.a;
        |LIBERA #albm0044@;
        |CIERRA #albm0044@;
        |DESCARGA_DEF #albm0044@;
     |FINSI;
|FPRC;

____________________________________________________________________________
____________________________________________________________________________
____________________________________________________________________________

|PROCESO Baja727;
     #727#0 = #726#0;
     #727#1 = "     ";
     #727#2 = 0;
     #727#3 = 0;
|FPRC;

|PROCESO Alta727;
     #727#0 = #726#0;
     #727#1 = "zzzzz";
     #727#2 = 999999;
     #727#3 = 999;
|FPRC;

|PROCESO EntPediFec;
     nUni1 = #67#5 - #67#38;
     nUni2 = #67#41 - #67#46;
     |SI nUni1 ! 0; |O nUni2 ! 0;
          |DDEFECTO #726;
          #726#0 = #67#13;
          |LEE 101#726=;
          |SI FSalida ! 0; |GRABA 020#726b; |FINSI;
          #726#1 = #726#1 + nUni1;
          #726#2 = #726#2 + nUni2;
          #726#3 = #726#3 + 1;
          |GRABA 020#726a;
          |LIBERA #726;

          #727#0 = #726#0;
          #727#1 = #67#28;
          #727#2 = #67#0;
          #727#3 = #67#1;
          |LEE 101#727=;
          |SI FSalida ! 0;
              |DDEFECTO #727;
              #727#0 = #726#0;
              #727#1 = #67#28;
              #727#2 = #67#0;
              #727#3 = #67#1;
              #727#6 = #81#4;
              #727#7 = #81#8;
              |GRABA 020#727b;
          |FINSI;
          #727#4 = #727#4 + nUni1;
          #727#5 = #727#5 + nUni2;
          |GRABA 020#727a;
          |LIBERA #727;
     |FINSI;
|FPRC;

|DEFBUCLE EntPediFec;
     #67#2;
     ;
     "      ", fDFecha,     0,     0,     0, "  ", "     ", 000001;
     "zzzzzz", fHFecha, 99.99, 99.99, 99.99, "zz", "zzzzz", 999999;
     ;
     NULL, EntPediFec;
|FIN;

|PROCESO AlbeEntLin2;
     fFecha = #67#13;
     |HAZ AlbParam;
     nNume = fFecha; nNume = nNume - nParam1;
     fDFecha = nNume;
     nNume = fFecha; nNume = nNume + nParam2;
     fHFecha = nNume;
     |DDEF aDef;
     aDef = aDef + "agifa067";
     |CARGA_DEF aDef, agifa067@;
     |SI FSalida = 0;
          |BUCLE EntPediFec;
          |DESCARGA_DEF #agifa067@;
     |FINSI;
|FPRC;

|PROCESO AlbeEntLin;
     |DBASE aAlfa; |QBF aAlfa;
     aMas = aAlfa + "def/albw0026.mas";
     |CARGA_DEF aMas, albw0026@;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     aMas = aAlfa + "def/albw0027.mas";
     |CARGA_DEF aMas, albw0027@;
     |SI FSalida ! 0;
         |DESCARGA_DEF #albw0026@;
         |ACABA;
     |FINSI;

     aAlfa = Usuario; aAlfa = "3" + aAlfa;
     |NOME_DAT #726 aAlfa;
     |DELINDEX #726; |ABRE #726;

     aAlfa = Usuario; aAlfa = "4" + aAlfa;
     |NOME_DAT #727 aAlfa;
     |DELINDEX #727; |ABRE #727;

     |HAZ AlbeEntLin2;
     |LEE 000#726p;
     |PARA;  |SI;  |HACIENDO;
          |CONSULTA_CLAVE #1#726;
          |SI FSalida ! 0;  |SAL;  |FINSI;

          |CONSULTA_F_CLAVE #1#727, Baja727, Alta727;
     |SIGUE;

     |CIERRA #726; |DELINDEX #726;
     |CIERRA #727; |DELINDEX #727;

     |DESCARGA_DEF #albw0027@;
     |DESCARGA_DEF #albw0026@;
|FPRC;

|PROCESO AlbeEntCab;
     |DBASE aAlfa; |QBF aAlfa;
     aMas = aAlfa + "def/albw0026.mas";
     |CARGA_DEF aMas, albw0026@;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     aMas = aAlfa + "def/albw0027.mas";
     |CARGA_DEF aMas, albw0027@;
     |SI FSalida ! 0;
         |DESCARGA_DEF #albw0026@;
         |ACABA;
     |FINSI;

     aAlfa = Usuario; aAlfa = "3" + aAlfa;
     |NOME_DAT #726 aAlfa;
     |DELINDEX #726;  |ABRE #726;

     aAlfa = Usuario; aAlfa = "4" + aAlfa;
     |NOME_DAT #727 aAlfa;
     |DELINDEX #727; |ABRE #727;

     |BUCLELIN 2AlbeEntLin2#81;

     |LEE 000#726p;
     |PARA;  |SI;  |HACIENDO;
          |CONSULTA_CLAVE #1#726;
          |SI FSalida ! 0;  |SAL;  |FINSI;

          |CONSULTA_F_CLAVE #1#727, Baja727, Alta727;
     |SIGUE;

     |CIERRA #726;  |DELINDEX #726;
     |CIERRA #727;  |DELINDEX #727;

     |DESCARGA_DEF #albw0027@;
     |DESCARGA_DEF #albw0026@;
|FPRC;


____________________________________________________________________________
____________________________________________________________________________
____________________________________________________________________________

|PROCESO albm0047_totallin;
     nTotalLin = nTotalLin + #albm0047@#8;
|FPRC;

|DEFBUCLE albm0047_totallin;
 #albm0047@#1003;
 ;
 nAlmacen, aPartida46, 001;
 nAlmacen, aPartida46, 999;
 ;
 NULL, albm0047_totallin;
|FIN;

|PROCESO AlbeEntPartidasTODOS;
     |DBASE aAlfa; |QBF aAlfa;

     aMas = aAlfa + "def/albm0047.mas";
     |CARGA_DEF aMas, albm0047@;
     |SI FSalida ! 0; |ACABA; |FINSI;


     |SI enNoModCab = 0;
          |ABRE #albm0046;
          |DDEFECTO #albm0046;
          #albm0046#1 = nAlmacen;
          #albm0046#2 = aPartida46;
          |LEE 101#albm0046.=;
          |SI FSalida ! 0;
               #albm0046#0 = aArticulo;
               |GRABA 020#albm0046.b;
          |FINSI;

          |SI nForma = 1;
               aBeta = #albm0046#0;
               |QBF aBeta;
               |SI aBeta = "";
                    #albm0046#0 = aArticulo;
               |FINSI;
          |FINSI;

          |SI aTipoDoc ! "SA"; |Y aTipoDoc ! "ES"; |Y aTipoDoc ! "AV"; |Y aTipoDoc ! "MS"; |Y aTipoDoc ! "ME";
               #albm0046#3 = aProveedor;
          |FINSI;

          |SI #albm0046#4 = "01.01.0000";
               #albm0046#4 = fFechaEnt;
          |FINSI;

          |SI enRecalculo = 1;
               |SI aTipoDoc = "ES";
                    |SI aParPartida = "ENTRADA";
                         #albm0046#9 = #albm0046#9 + (nUnidades1 * nForma);
                         #albm0046#10 = #albm0046#10 + (nUnidades2 * nForma);
                    |SINO;
                         #albm0046#11 = #albm0046#11 + (nUnidades1 * nForma * -1);
                         #albm0046#12 = #albm0046#12 + (nUnidades2 * nForma * -1);
                    |FINSI;
                    #albm0046#31 = #albm0046#31 + (nUnidades1 * nForma);
                    #albm0046#32 = #albm0046#32 + (nUnidades2 * nForma);
               |SINO;
                    |SI aTipoDoc = "SA"; |O aTipoDoc = "EV"; |O aTipoDoc = "AV";
                         |SI aParPartida = "ENTRADA";
                              #albm0046#9 = #albm0046#9 + (nUnidades1 * nForma);
                              #albm0046#10 = #albm0046#10 + (nUnidades2 * nForma);
                         |SINO;
                              #albm0046#11 = #albm0046#11 + (nUnidades1 * nForma * -1);
                              #albm0046#12 = #albm0046#12 + (nUnidades2 * nForma * -1);
                         |FINSI;
                    |SINO;
                         |SI aTipoDoc = "MS"; |O aTipoDoc = "OF2";
                              #albm0046#11 = #albm0046#11 + (nUnidades1 * nForma);
                              #albm0046#12 = #albm0046#12 + (nUnidades2 * nForma);
                         |SINO;
                              #albm0046#9 = #albm0046#9 + (nUnidades1 * nForma);
                              #albm0046#10 = #albm0046#10 + (nUnidades2 * nForma);
                         |FINSI;
                    |FINSI;
                    |SI aTipoDoc = "MS";
                         #albm0046#31 = #albm0046#31 + (nUnidades1 * nForma * -1);
                         #albm0046#32 = #albm0046#32 + (nUnidades2 * nForma * -1);
                    |SINO;
                         #albm0046#31 = #albm0046#31 + (nUnidades1 * nForma);
                         #albm0046#32 = #albm0046#32 + (nUnidades2 * nForma);
                    |FINSI;
               |FINSI;
               |SI aTipoDoc = "AC";
                    #albm0046#35 = aSerPed;
                    #albm0046#36 = nNumPed;
               |FINSI;
          |SINO;
               |SI aTipoDoc = "AC";
                    ||Estos 2 valores se actualizan antes de llamar a este proceso.
                    ||#albm0046#9 = #albm0046#9 + (nUnidades1 * nForma);
                    ||#albm0046#10 = #albm0046#10 + (nUnidades2 * nForma);
                    #albm0046#31 = #albm0046#31 + (nUnidades1 * nForma);
                    #albm0046#32 = #albm0046#32 + (nUnidades2 * nForma);

                    #albm0046#35 = aSerPed;
                    #albm0046#36 = nNumPed;
               |FINSI;

               ||TODO ... RESTO DE DOCUMENTOS ...
               |SI aTipoDoc = "EV"; |O aTipoDoc = "ES";
                    ||Estos 4 valores se actualizan antes de llamar a este proceso.
                    ||#albm0046#9 = #albm0046#9 + (nUnidades1 * nForma);
                    ||#albm0046#10 = #albm0046#10 + (nUnidades2 * nForma);
                    ||#albm0046#31 = #albm0046#31 + (nUnidades1 * nForma);
                    ||#albm0046#32 = #albm0046#32 + (nUnidades2 * nForma);
               |FINSI;

               |SI aTipoDoc = "SA"; |O aTipoDoc = "AV";
                    |SI aParPartida = "ENTRADA";
                         #albm0046#9 = #albm0046#9 + (nUnidades1 * nForma);
                         #albm0046#10 = #albm0046#10 + (nUnidades2 * nForma);
                    |SINO;
                         #albm0046#11 = #albm0046#11 + (nUnidades1 * nForma * -1);
                         #albm0046#12 = #albm0046#12 + (nUnidades2 * nForma * -1);
                    |FINSI;
                    #albm0046#31 = #albm0046#31 + (nUnidades1 * nForma);
                    #albm0046#32 = #albm0046#32 + (nUnidades2 * nForma);
               |FINSI;
               |SI aTipoDoc = "OF";     ||Orden de Fabricacion
                    |SI nUnidades1 ] 0;
                         #albm0046#9 = #albm0046#9 + (nUnidades1 * nForma);
                         #albm0046#10 = #albm0046#10 + (nUnidades2 * nForma);
                         #albm0046#31 = #albm0046#31 + (nUnidades1 * nForma);
                         #albm0046#32 = #albm0046#32 + (nUnidades2 * nForma);
                    |SINO;
                         #albm0046#11 = #albm0046#11 + (nUnidades1 * nForma * -1);
                         #albm0046#31 = #albm0046#31 + (nUnidades1 * nForma );
                         #albm0046#10 = #albm0046#10 + (nUnidades2 * nForma * -1);
                         #albm0046#32 = #albm0046#32 + (nUnidades2 * nForma );
                    |FINSI;
               |FINSI;
               |SI aTipoDoc = "OF2";    ||Orden de Fabricacion. Partidas de Salida
                    #albm0046#11 = #albm0046#11 + (nUnidades1 * nForma * -1);
                    #albm0046#12 = #albm0046#12 + (nUnidades2 * nForma * -1);
                    #albm0046#31 = #albm0046#31 + (nUnidades1 * nForma);
                    #albm0046#32 = #albm0046#32 + (nUnidades2 * nForma);
               |FINSI;
               |SI aTipoDoc = "MS";    ||Albaran de Venta o Mov. Salida Almacen
                    #albm0046#11 = #albm0046#11 + (nUnidades1 * nForma);
                    #albm0046#12 = #albm0046#12 + (nUnidades2 * nForma);
                    #albm0046#31 = #albm0046#31 + (nUnidades1 * nForma * -1);
                    #albm0046#32 = #albm0046#32 + (nUnidades2 * nForma * -1);
               |FINSI;
               |SI aTipoDoc = "ME";
                    #albm0046#9 = #albm0046#9 + (nUnidades1 * nForma);
                    #albm0046#10 = #albm0046#10 + (nUnidades2 * nForma);
                    #albm0046#31 = #albm0046#31 + (nUnidades1 * nForma);
                    #albm0046#32 = #albm0046#32 + (nUnidades2 * nForma);
               |FINSI;
          |FINSI;

          |SI aTipoDoc = "EV";
               ||Tiquet. 3026/662
               #albm0046#38 = nPrecio;
/*
               |SI nUnidades1 < 0;
                    #albm0046#38 = #albm0046#38;  ||No se modifica el precio
               |SINO;
                    nUdAct = #albm0046#31 - (nUnidades1 * nForma);
                    nPreAct = #albm0046#38;
                    nUdNou = nUnidades1;
                    nPreNou = nPrecio;
                    nAux = (nUdAct + (nUdNou * nForma));
                    |SI nAux = 0;
                         #albm0046#38 = nPrecio;
                    |SINO;
                         #albm0046#38 = ((nUdAct * nPreAct) + ((nUdNou * nPreNou) * nForma)) / (nUdAct + (nUdNou * nForma));
                    |FINSI;
               |FINSI;
*/
          |SINO;
               |SI aTipoDoc = "AC"; |O aTipoDoc = "SA";
                    nUdAct = #albm0046#31 - (nUnidades1 * nForma);
                    nPreAct = #albm0046#38;
                    nUdNou = nUnidades1;
                    nPreNou = nPrecio;
                    #albm0046#38 = ((nUdAct * nPreAct) + ((nUdNou * nPreNou) * nForma)) / (nUdAct + (nUdNou * nForma));
               |SINO;
                    |SI aTipoDoc ! "ES"; |Y aTipoDoc ! "AV";
                         #albm0046#38 = #albm0046#38 + (nPrecio * nForma);
                    |FINSI;
               |FINSI;
          |FINSI;


          |SI aIncPar = ""; |O aIncPar = "N";
               ||Solo se actualiza si se Marca, es decir alguna incidencia
               ||#albm0046#39 = "N";
          |SINO;
               #albm0046#39 = "S";
          |FINSI;
          |SI eaCerrarPar = ""; |O eaCerrarPar = "N";
               #albm0046#42 = "N";
          |SINO;
               #albm0046#42 = "S";
          |FINSI;

          #albm0046#46 = #albm0046#38 * #albm0046#31;
          |GRABA 020#albm0046.a;
          |LIBERA #albm0046;
          |CIERRA #albm0046;
     |FINSI;


     |SI nForma = -1;
          ||Se borra la linea
          |ABRE #albm0047@;
          |SELECT #2#albm0047@;
          #albm0047@#1 = nAlmacen;
          #albm0047@#2 = aPartida46;
          |SI aTipoDoc = "OF2";
               #albm0047@#13 = "OF";
          |SINO;
               #albm0047@#13 = aTipoDoc;
          |FINSI;
          #albm0047@#14 = aSerLin;
          #albm0047@#15 = nNumLin;
          #albm0047@#16 = nLinLin;
          |LEE 101#albm0047@.=;
          |SI FSalida = 0;
               |BORRA 020#albm0047@.a;
          |FINSI;
          |LIBERA #albm0047@;
          |CIERRA #albm0047@;
     |SINO;
          ||Se mete la linea .. :) .. Necesito sabe la ultima linea
          nLinea = 0;
          |HAZ UltimaLinea99961;
          nLinea = nLinea + 1;
          |ABRE #albm0047@;
          |DDEFECTO #albm0047@;
          |SELECT #1#albm0047@;
          #albm0047@#1 = nAlmacen;
          #albm0047@#2 = aPartida46;
          #albm0047@#3 = nLinea;
          |LEE 101#albm0047@.=;
          |SI FSalida ! 0; |GRABA 020#albm0047@.b; |FINSI;
          #albm0047@#0 = aArticulo;
          #albm0047@#4 = fFechaEnt;
          #albm0047@#5 = aArtPartida;
          #albm0047@#6 = nAlmPartida;
          #albm0047@#7 = aParPartida;
          #albm0047@#8 = #albm0047@#8 + (nUnidades1 * nForma);
          #albm0047@#9 = #albm0047@#9 + (nUnidades2 * nForma);
          #albm0047@#10 = aProducido;
          #albm0047@#11 = aProduDes;
          #albm0047@#12 = aObs;
          |SI aTipoDoc = "OF2";
               #albm0047@#13 = "OF";
          |SINO;
               #albm0047@#13 = aTipoDoc;
          |FINSI;
          #albm0047@#14 = aSerLin;
          #albm0047@#15 = nNumLin;
          #albm0047@#16 = nLinLin;
          #albm0047@#17 = eaDocExt;
          #albm0047@#18 = eaSerExt;
          #albm0047@#19 = enNumExt;
          |GRABA 020#albm0047@.a;
          |LIBERA #albm0047@;
          |CIERRA #albm0047@;
     |FINSI;

     |SI aTipoDoc = "EV";
          nExistencias = #albm0046#31;
          nTotalLin = 0;
          |BUCLE albm0047_totallin;
          |SI nExistencias ! nTotalLin;
               aMensaje = "0000Atencion: Descuadre en la Partida: Alm.: " + nAlmacen + " Part.:" + aPartida46;
               |QBF aMensaje;
               |MENAV aMensaje;
          |FINSI;
     |FINSI;

     |DESCARGA_DEF #albm0047@;
|FPRC;

||ARA
|PROCESO albm0047_linea;
     nLinea = #albm0047@#3;
|FPRC;

|DEFBUCLE albm0047_linea;
 #albm0047@#1003;
 ;
 nAlmacen, aPartida46, 000;
 nAlmacen, aPartida46, 999;
 ;
 NULL, albm0047_linea;
|FIN;

|PROCESO UltimaLinea99961;
     nLinea = 0;
     |BUCLE albm0047_linea;
/*
     ||NO va fino, con partidas con caracteres alfanumericos

     |SELECT #1#albm0047@;
     #albm0047@#1 = nAlmacen;
     #albm0047@#2 = aPartida46;
     #albm0047@#3 = 999;
     |LEE 000#albm0047@.];
     |SI FSalida = 0;
          |LEE 000#albm0047@.a;
     |SINO;
          |LEE 000#albm0047@.u;
     |FINSI;
     |SI FSalida = 0; |Y #albm0047@#1 = nAlmacen; |Y #albm0047@#2 = aPartida46;
          nLinea = #albm0047@#3;
     |SINO;
          nLinea = 0;
     |FINSI;
*/
|FPRC;


____________________________________________________________________________

||Copia de ficheros

|PROCESO EsIber_21a; ||Igual que EsIber21
     |DBASE aPath;
     aPath = aPath + "/bin/iber0001.tab";
     |XABRE "E", aPath, 0;
|FPRC;

|PROCESO Es_Albero;   || Igual que EsAlbero
     |DBASE aPath;
     aPath = aPath + "/def/albm0001.mas";
     |XABRE "E", aPath, 0;
     |SI FSalida = 0;
          |HAZ EsIber_21a;
          |SI FSalida = 0;
              FSalida = 1;
          |SINO;
              FSalida = 0;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Es_Malpesa0;  || Igual que EsMalpesa;
     |DBASE aPath;
     aPath = aPath + "/def/malpe001.mas";
     |XABRE "E", aPath, 0;
     |SI FSalida = 0;
          |HAZ EsIber_21a;
          |SI FSalida = 0;
              FSalida = 1;
          |SINO;
              FSalida = 0;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Par24_15; |TIPO 15;
     |SI enAlberoDentro = 1; |ACABA; |FINSI;
     enAlberoDentro = 1;

     |HAZ dsm00291G;

     |HAZ Es_Albero;
     |SI FSalida = 0;
          |HAZ AlberoGra;
     |FINSI;
     enAlberoDentro = 0;
|FPRC;

|PROCESO Par24_16; |TIPO 16;
     |SI enAlberoDentro = 1; |ACABA; |FINSI;
     enAlberoDentro = 1;

     |HAZ dsm00291G;

     |HAZ Es_Albero;
     |SI FSalida = 0;
          |HAZ AlberoMod;
     |FINSI;
     |HAZ Es_Malpesa0;
     |SI FSalida = 0;
          |HAZ MalpesaMod;
     |FINSI;
     enAlberoDentro = 0;
|FPRC;

|PROCESO Par24_17; |TIPO 17;
     |SI enAlberoDentro = 1; |ACABA; |FINSI;
     enAlberoDentro = 1;

     |HAZ dsm00291B;

     |HAZ Es_Albero;
     |SI FSalida = 0;
          |HAZ AlberoBor;
     |FINSI;
     enAlberoDentro = 0;
|FPRC;

|PROCESO Albero46_15; |TIPO 15;
     |SI enAlberoDentro = 1; |ACABA; |FINSI;
     enAlberoDentro = 1;

     |HAZ Es_Albero;
     |SI FSalida = 0;
          |HAZ AlbParGra;
     |FINSI;
     enAlberoDentro = 0;
|FPRC;

|PROCESO Albero46_16; |TIPO 16;

     |SI enAlberoDentro = 1; |ACABA; |FINSI;
     enAlberoDentro = 1;

     |HAZ Es_Albero;
     |SI FSalida = 0;
          |HAZ AlbParMod;
     |FINSI;
     enAlberoDentro = 0;
|FPRC;

|PROCESO Albero46_17; |TIPO 17;
     |SI enAlberoDentro = 1; |ACABA; |FINSI;
     enAlberoDentro = 1;

     |HAZ Es_Albero;
     |SI FSalida = 0;
          |HAZ AlbParBor;
     |FINSI;
     enAlberoDentro = 0;
|FPRC;



|PROCESO AlberoGra;
     |DDEFECTO #846;
     |ABRE #846;
     #846#1 = #824#1;
     #846#2 = #824#2;
     |GRABA 000#846n;
     |CIERRA #846;
|FPRC;

|PROCESO AlberoMod;
     |ABRE #846;
     #846#1 = #824#1;
     #846#2 = #824#2;
     |LEE 101#846=;
     |SI FSalida ! 0; |GRABA 020#846b; |FINSI;
     |PARA i = 0; |SI i [ 47; |HACIENDO i = i + 1;
          #846i = #824i;
     |SIGUE;
     #846#46 = #846#38 * #846#31;
     |GRABA 020#846a;
     |CIERRA #846;
|FPRC;

|PROCESO AlberoBor;
     |ABRE #846;
     #846#1 = #824#1;
     #846#2 = #824#2;
     |BORRA 000#846c;
     |CIERRA #846;
|FPRC;


|PROCESO AlbParGra;
     aArticulo = #846#0;
     |QBF aArticulo;
     |SI aArticulo ! "";
          |ABRE #824;
          #824#0 = #846#0;
          #824#1 = #846#1;
          #824#2 = #846#2;
          |GRABA 000#824n;
          |CIERRA #824;
     |FINSI;
|FPRC;

|PROCESO AlbParMod;
     |ABRE #824;
     #824#0 = #846#0;
     #824#1 = #846#1;
     #824#2 = #846#2;
     |LEE 101#824=;
     |SI FSalida ! 0; |GRABA 020#824b; |FINSI;
     |PARA i = 0; |SI i [ 47; |HACIENDO i = i + 1;
          #824i = #846i;
     |SIGUE;
     |GRABA 020#824a;
     |CIERRA #824;
|FPRC;

|PROCESO AlbParBor;
     |ABRE #824;
     #824#0 = #846#0;
     #824#1 = #846#1;
     #824#2 = #846#2;
     |BORRA 000#824c;
     |CIERRA #824;
|FPRC;


|PROCESO EsArticuloPartida;
     eaAlbeArtEs = "";
     nError = 0;
     |ABRE #albm0046;
     #albm0046#1 = enAlbeAlm;
     #albm0046#2 = eaAlbePar;
     |LEE 000#albm0046.=;
     |SI FSalida = 0;
          |SI #albm0046#0 = eaAlbeArt;
               nError = 0;
          |SINO;
               eaAlbeArtEs = #albm0046#0;
               nError = 1;
          |FINSI;
     |FINSI;
     |CIERRA #albm0046;
     FSalida = nError;
|FPRC;

|PROCESO albm0047_ctrl;
     aDocuAux = #albm0047@#17;
     aSeriAux = #albm0047@#18;
     nNumeAux = #albm0047@#19;
     |QBF aDocuAux;
     |QBF aSeriAux;
     |SI aDocuAux ! ""; |O aSeriAux ! ""; |O nNumeAux ! 0;
          enSwEstaDoc = 1;
          eaDocAlbero = #albm0047@#17;
          eaSerAlbero = #albm0047@#18;
          enNumAlbero = #albm0047@#19;
          |ERROR10;
     |FINSI;
|FPRC;

|DEFBUCLE albm0047_ctrl;
 #albm0047@#2006;
 ;
 00001, "               ", eaTipoMov, eaSerAlb, enNumAlb, 00000;
 99999, "zzzzzzzzzzzzzzz", eaTipoMov, eaSerAlb, enNumAlb, 99999;
 ;
 NULL, albm0047_ctrl;
|FIN;

|PROCESO AlberoCtrlModBaj;
     |DBASE aAlfa; |QBF aAlfa;

     aMas = aAlfa + "def/albm0047.mas";
     |CARGA_DEF aMas, albm0047@;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |BUCLE albm0047_ctrl;
     |DESCARGA_DEF #albm0047@;
|FPRC;

|PROCESO AlberoPintaArt;
     |ATRI 0;
     |PINTA 1303, "Familia ...:";
     |PINTA 1203, "Color .....:";
     |PINTA 1121, "Ancho:";
     |PINTA 1321, "Calid:";
     |ATRI I;
     |PINTA 2141, "Col:";
     |PINTA 2241, "Fam:";
     |ATRI i;
     |ATRI I;
|FPRC;

|PROCESO AlbePreValora;
     |ABRE #846;
     #846#1 = #757#1;
     #846#2 = #757#22;
     |LEE 000#846=;
     |SI FSalida = 0;
          #757#6 = #846#38;
     |FINSI;
     |CIERRA #846;
|FPRC;


|PROCESO AlberoDesgloseOF;
     aPartidaDes = #albm0046#2;
     |QBF aPartidaDes;
     aAlfa2 = aPartidaDes % -301;
     |SI aAlfa2 ! "/";
          aMensaje = "0000Esta partida NO esta asociada a una Orden de Fabricacion";
          |MENAV aMensaje;
          |ACABA;
     |SINO;
          aLong = aPartidaDes % A0;
          nLong = aLong;
          |SI nLong > 7;
               aMensaje = "0000Esta partida NO esta asociada a una Orden de Fabricacion";
               |MENAV aMensaje;
               |ACABA;
          |FINSI;
     |FINSI;

     aSerieDes = aPartidaDes % -102;
     aAux = aPartidaDes % -103;
     aNumDes = aPartidaDes - aAux;
     nNumDes = aNumDes;

     |DBASE aAlfa; |QBF aAlfa;

     aMas = aAlfa + "def/albm0037.mas";
     |CARGA_DEF aMas, albm0037@;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     aMas = aAlfa + "def/albm0063.mas";
     |CARGA_DEF aMas, albm0063@;
     |SI FSalida ! 0;
         |DESCARGA_DEF #albm0037@;
         |ACABA;
     |FINSI;

     |ABRE #albm0037@;
     #albm0037@#16 = aSerieDes;
     #albm0037@#0 = nNumDes;
     |LEE 000#albm0037@.=;
     |SI FSalida = 0;
          aSerieBona = aSerieDes;
          |HAZ MuestraDesglose;
     |SINO;
          aAlfa2 = aSerieDes - "0";
          aAlfa2 = aAlfa2 - "0";
          aSerieDes = ("  " + aAlfa2) % -102;
          #albm0037@#16 = aSerieDes;
          #albm0037@#0 = nNumDes;
          |LEE 000#albm0037@.=;
          |SI FSalida = 0;
               aSerieBona = aSerieDes;
               |HAZ MuestraDesglose;
          |SINO;
               aMensaje = "0000No Existe la Orden de Fabricacion";
               |MENAV aMensaje;
               |CIERRA #albm0037@;
               |DESCARGA_DEF #albm0063@;
               |DESCARGA_DEF #albm0037@;
               |ACABA;
          |FINSI;
     |FINSI;

     |CIERRA #albm0037@;
     |DESCARGA_DEF #albm0063@;
     |DESCARGA_DEF #albm0037@;
|FPRC;

|PROCESO MuestraDesglose;
     |ABRE #albm0063@;
     |PUSHV 0741 2378;
     nRango = 4 + 8 + 16 + 128;
     |LINEAL_SIMPLE #1#863, nRango, 0721, 2378, MiniPeso63, MaxiPeso63, NULL;
     |POPV;
     |CIERRA #albm0063@;
|FPRC;

|PROCESO MiniPeso63;
     #albm0063@#0 = aSerieBona;
     #albm0063@#1 = nNumDes;
     #albm0063@#2 = 01;
     #albm0063@#3 = 00;
     #albm0063@#4 = 0001;
|FPRC;

|PROCESO MaxiPeso63;
     #albm0063@#0 = aSerieBona;
     #albm0063@#1 = nNumDes;
     #albm0063@#2 = 99;
     #albm0063@#3 = 99;
     #albm0063@#4 = 9999;
|FPRC;

|PROCESO MalpesaMod;
     |DDEF aDef;
     aDef = aDef + "malpe085";
     |CARGA_DEF aDef, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          #referen@#0 = #824#0;
          #referen@#1 = #824#1;
          #referen@#2 = #824#2;
          |LEE 000#referen@.=;
          |SI FSalida = 0;
               #824#31 = #824#22 - #referen@#9 - #824#20;
          |SINO;
               #824#31 = #824#22 - #824#20;
          |FINSI;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|PROCESO agifa067_miraPLB;
     #referen@#25 = #agifa067@#28;
     #referen@#0 = #agifa067@#0;
     |LEE 000#referen@.=;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |SI #agifa067@#6 ! nPrecioBase;
          |SI #agifa067@#6 ! nPreAnt;
               |SI fFechaUlt < #referen@#1;
                    nPreAnt = #agifa067@#6;
                    nPrecio = #agifa067@#6;
                    aFecha = #referen@#1;
                    fFechaUlt = #referen@#1;
               |FINSI;
          |FINSI;
     |SINO;
          |SI nPrimero = 1;
               aFecUlt = #referen@#1;
               nPreUlt = #agifa067@#06;
               nPrimero = 0;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE agifa067_miraPLB;
    #agifa067@#3004;
    ;
    eaArtAlbero, "     ", 000001, eaProvAlbero;
    eaArtAlbero, "zzzzz", 999999, eaProvAlbero;
    ;
    NULL, agifa067_miraPLB;
|FIN;

|PROCESO PreUltPedCompra3026;
     nPrecio = enPrecio;
     nPrimero = 1;
     nPreUlt = nPrecio;
     aFecha = "01.01.0000";
     nPrecio = 0;
     nPreAnt = 0;
     fFechaUlt = "01.01.0000";

     |DDEF aDef;
     aAlfa = aDef + "agifa067";
     |CARGA_DEF aAlfa, agifa067@;
     |SI FSalida = 0;
          aAlfa = aDef + "agifa081";
          |CARGA_DEF aAlfa, referen@;
          |SI FSalida = 0;
               |ABRE #referen@;
               |BUCLE agifa067_miraPLB;
               |CIERRA #referen@;
               |DESCARGA_DEF #referen@;
          |FINSI;
          |DESCARGA_DEF #agifa067@;
     |FINSI;

     |SI nPreAnt = 0;
          nPrecio = nPreUlt;
     |FINSI;

     enPrecio = nPrecio;
     |SI enPrecio = 0;
          enPrecio = nPrecioBase;
     |FINSI;
|FPRC;

|PROCESO SacaIVA2; || se llama con enTiva y efFiva
     eaDiva = "";  || y retorna eaDiva, enIva y enRec
     enIva = 0;
     enRec = 0;

     |ABRE #66;
     #66#0 = enTiva
     #66#4 = "01.01.0000";
     |LEE 000#66];
     |PARA; |SI FSalida = 0; |Y #66#0 = enTiva; |Y efFiva ] #66#4; |HACIENDO;
          eaDiva = #66#1;
          enIva = #66#2;
          enRec = #66#3;
          |LEE 000#66s;
     |SIGUE;
     |CIERRA #66;
|FPRC;

|PROCESO AlbParam;
     |DDEF aDef;
     aDef = aDef + "albm0013";
     |CARGA_DEF aDef, referen@;
     |SI FSalida = 0;
          |ABRE #referen@; |LEE 000#referen@.p; |CIERRA #referen@;
          nParam1 = #referen@#1;
          nParam2 = #referen@#2;
          nParam3 = #referen@#3;
          nParam4 = #referen@#4;
          |DESCARGA_DEF #referen@;
     |SINO;
          |MENAV "000Error al cargar 'albm0013'";
     |FINSI;
|FPRC;

|PROCESO dsm00291G;
     |DDEF aAlfa;
     aAlfa = aAlfa + "dsm00291";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          #referen@#0 = #824#0;
          #referen@#1 = #824#1;
          #referen@#2 = #824#2;
          |LEE 101#referen@.=;
          |SI FSalida ! 0; |GRABA 020#referen@.b; |FINSI;
          #referen@#3 = #824#27;
          |GRABA 020#referen@.a;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;

|PROCESO dsm00291B;
     |DDEF aAlfa;
     aAlfa = aAlfa + "dsm00291";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          #referen@#0 = #824#0;
          #referen@#1 = #824#1;
          #referen@#2 = #824#2;
          |LEE 101#referen@.=;
          |SI FSalida = 0; |BORRA 020#referen@.a; |FINSI;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;
