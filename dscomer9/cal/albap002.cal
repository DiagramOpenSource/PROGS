|FICHEROS;
     albap002 #99;  || Este def.
     albap001 #0;   || Fichero de control de parametros para el pase.
     agifa091 #1;   || Formas de Pago.
     agifa024 #2;   || Clientes.
     agifa019 #3;   || Articulos.
     agifa027 #5;   || Contadores.
     ||agifa114 #6;   || Recibos de cobros.
     agifa017 #7;   || Datos Articulo Almacen.
     dsm00134 #8;   || Promociones.
     alba0037 #9;   || Visitas. = visitas.mas
     ||agif9114 #10;  Recibos de cobros albaranes.
     dscam045@ #200;
     dscam003@ #201;
     agifa142 #142;
|FIN;

|VARIABLES;
     &enTiva = 0;
     &efFiva = @;
     &eaDiva = "";
     &enIva = 0;
     &enRec = 0;
     aTmp134 = "";
     &Tempo = "";
     aDef = "";
     nEmpresa = 0;
     variable = "";
     aAlfa = "";
     empresa  = "";
     cadena   = "";
     fichero  = "";
     long     = "";
     caracter = "";
     campo    = "";
     var      = "";
     alfa     = "";
     tab1     = 0;
     final1   = 0;
     final2   = 0;
     tab      = "";
     final    = "";
     i        = 0;
     f        = 0;
     ind      = 0;
     valor    = 0;
     sw       = 0;
     pasa     = 0;
     jj       = 0;
     sal      = 0;
     guarda   = 0;
     se1      = "";
     se2      = "";
     se3      = "";
     se4      = "";
     se5      = "";
     se6      = "";
     se7      = "";
     se8      = "";
     se9      = "";
     se10     = "";
     se11     = "";
     se12     = "";
     con1     = 0;
     con2     = 0;
     con3     = 0;
     con4     = 0;
     con5     = 0;
     con6     = 0;
     con7     = 0;
     con8     = 0;
     con9     = 0;
     con10    = 0;
     con11    = 0;
     con12    = 0;
     pp = 0;
|FIN;

||------------------------------  CLIENTES ----------------------------------

|PROCESO pasa_cli;
     |SI f ] 0;
          campo = #2#0; |QBF campo;
          var = campo + tab;
          campo = #2#1; |QBF campo;
          var = var + campo + tab;
               |PINTA 1922,"                                                         ";
               |PINTA 1922,"CLIENTES : ";
               |PINTA 1942,campo;
          campo = #2#5; |QBF campo;
          var = var + campo + tab;
          campo = #2#6; |QBF campo;
          var = var + campo + tab;
          campo = #2#180; |QBF campo;
          var = var + campo + tab;
          campo = #2#2; |QBF campo;
          var = var + campo + tab;
          campo = #2#15; |QBF campo;
          var = var + campo + tab;
          campo = #2#47; |QBF campo;
          var = var + campo + tab;
          campo = #2#20; |QBF campo;
          var = var + campo + tab;
          campo = #2#22; |QBF campo;
          var = var + campo + tab;
          campo = #2#23; |QBF campo;
          var = var + campo + tab;
          campo = #2#24; |QBF campo;
          var = var + campo + tab;
          campo = #2#39; |QBF campo;
          var = var + campo + tab;
          campo = #2#3; |QBF campo;
          var = var + campo + tab;
          campo = #2#37; |QBF campo;
          var = var + campo + tab;
          campo = #2#38; |QBF campo;
          var = var + campo + final;
          cadena = f + " " + var;
          |FGRABA cadena;
          campo = "";
          var = "";
          cadena = "";
     |FINSI;
|FPRC;

|DEFBUCLE lee_cli;
     #2#1;
     3;
     #0#2,#0#4;
     #0#3,#0#5;
     be;
     NULL,pasa_cli;
|FIN;

|PROCESO clientes;
     |DFICE empresa;
     empresa = empresa + "clientes.asc";
     |QBF empresa;
     fichero = "wt  " + empresa;
     |QBF fichero;
     |FABRE fichero;
     f = FSalida;
     |BUCLE lee_cli;
     f = 0;
     FSalida = f;
     |FCIERRA FSalida;
     Pos = -1;
|FPRC;

||--------------------------  ARTICULOS  ------------------------------------

|PROCESO pasa_art;
     |SI f ] 0;
          campo = #3#0; |QBF campo;
          var = campo + tab;
          campo = #3#1; |QBF campo;
          var = var + campo + tab;
               |PINTA 1922,"                                                         ";
               |PINTA 1922,"ARTICULOS : ";
               |PINTA 1942,campo;
          campo = #3#18; |QBF campo;
          var = var + campo + tab;
          campo = #3#19; |QBF campo;
          var = var + campo + tab;
          campo = #3#20; |QBF campo;
          var = var + campo + tab;
          campo = #3#21; |QBF campo;
          var = var + campo + tab;
          campo = #3#22; |QBF campo;
          var = var + campo + tab;
          campo = #3#23; |QBF campo;
          var = var + campo + tab;
          |ABRE #7;
          #7#0 = #3#0;
          #7#1 = #0#27;
          |LEE 111#7=;
          campo = #7#5; |QBF campo;
          var = var + campo + tab;
          |LIBERA #7;
          |CIERRA #7;
          campo = #3#30; |QBF campo;
          var = var + campo + tab;
          campo = #3#208; |QBF campo;
          var = var + campo + final;
          cadena = f + " " + var;
          |FGRABA cadena;
          campo = "";
          var = "";
          cadena = "";
     |FINSI;
|FPRC;

|DEFBUCLE lee_art;
     #3#1;
     2;
     #0#7,#0#9;
     #0#8,#0#10;
     be;
     NULL,pasa_art;
|FIN;

|PROCESO articulos;
     |DFICE empresa;
     empresa = empresa + "articulo.asc";
     |QBF empresa;
     fichero = "wt  " + empresa;
     |QBF fichero;
     |FABRE fichero;
     f = FSalida;
     |BUCLE lee_art;
     f = 0;
     FSalida = f;
     |FCIERRA FSalida;
     Pos = -1;
|FPRC;

||---------------------------- FORMAS DE PAGO -------------------------------

|PROCESO pasa_pago;
     |SI f ] 0;
          campo = #1#0; |QBF campo;
          var = campo + tab;
          campo = #1#1; |QBF campo;
          var = var + campo + tab;
               |PINTA 1922,"                                                         ";
               |PINTA 1922,"F. PAGO : ";
               |PINTA 1942,campo;
          campo = #1#3; |QBF campo;
          var = var + campo + tab;
          campo = #1#2; |QBF campo;
          var = var + campo + tab;
          campo = #1#4; |QBF campo;
          var = var + campo + final;
          cadena = f + " " + var;
          |FGRABA cadena;
          campo = "";
          var =  "";
          cadena = "";
     |FINSI;
|FPRC;

|DEFBUCLE lee_pago;
     #1#1;
     ;
     "  ";
     "zz";
     be;
     NULL,pasa_pago;
|FIN;

|PROCESO f_pago;
     |DFICE empresa;
     empresa = empresa + "fpago.asc";
     |QBF empresa;
     fichero = "wt  " + empresa;
     |QBF fichero;
     |FABRE fichero;
     f = FSalida;
     |BUCLE lee_pago;
     f = 0;
     FSalida = f;
     |FCIERRA FSalida;
     Pos = -1;
|FPRC;

||------------------------- FICHERO DE I.V.A. ------------------------------

|PROCESO lee_iva;
     |PARA enTiva = 0; |SI enTiva [ 5; |HACIENDO enTiva = enTiva + 1;
          efFiva = ~;
          |HAZ SacaIVA;
          |SI f ] 0; |Y eaDiva ! "";
               campo = enTiva; |QBF campo;
               var = campo + tab;
               campo = enIva; |QBF campo;
               var = var + campo + tab;
               campo = enRec; |QBF campo;
               var = var + campo + final;
                    |PINTA 1922,"                                                         ";
                    |PINTA 1922,"TIPOS I.V.A. : ";
                    |PINTA 1942,campo;
               cadena = f + " " + var;
               |FGRABA cadena;
               campo = "";
               var = "";
               cadena = "";
          |FINSI;
     |SIGUE;
|FPRC;

|PROCESO f_iva;
     |DFICE empresa;
     empresa = empresa + "iva.asc";
     |QBF empresa;
     fichero = "wt  " + empresa;
     |QBF fichero;
     |FABRE fichero;
     f = FSalida;
     |HAZ lee_iva;
     f = 0;
     FSalida = f;
     |FCIERRA FSalida;
     Pos = -1;
|FPRC;

||----------------------- FICHERO DE CONTADOR ----------------------------

|PROCESO pasa_contador;
     |SI f ] 0;
          alfa = #5#0;
          |QBF alfa;
          |SI alfa = "valbaran";
               |SI #5#2=#0#12; |O #5#2=#0#13; |O #5#2=#0#14; |O #5#2=#0#15;
                    |SI se1 = ""; se1 = #5#2; con1 = #5#1 - 1; |ACABA; |FINSI;
                    |SI se2 = ""; se2 = #5#2; con2 = #5#1 - 1; |ACABA; |FINSI;
                    |SI se3 = ""; se3 = #5#2; con3 = #5#1 - 1; |ACABA; |FINSI;
                    |SI se4 = ""; se4 = #5#2; con4 = #5#1 - 1; |ACABA; |FINSI;
               |FINSI;
          |FINSI;
          |SI alfa = "vfactuco";
               |SI #5#2=#0#16; |O #5#2=#0#17; |O #5#2=#0#18; |O #5#2=#0#19;
                    |SI se5 = ""; se5 = #5#2; con5 = #5#1 - 1; |ACABA; |FINSI;
                    |SI se6 = ""; se6 = #5#2; con6 = #5#1 - 1; |ACABA; |FINSI;
                    |SI se7 = ""; se7 = #5#2; con7 = #5#1 - 1; |ACABA; |FINSI;
                    |SI se8 = ""; se8 = #5#2; con8 = #5#1 - 1; |ACABA; |FINSI;
               |FINSI;
          |FINSI;
          |SI alfa = "vpedido";
               |SI #5#2=#0#23; |O #5#2=#0#24; |O #5#2=#0#25; |O #5#2=#0#26;
                    |SI se9  = ""; se9  = #5#2; con9  = #5#1 - 1; |ACABA; |FINSI;
                    |SI se10 = ""; se10 = #5#2; con10 = #5#1 - 1; |ACABA; |FINSI;
                    |SI se11 = ""; se11 = #5#2; con11 = #5#1 - 1; |ACABA; |FINSI;
                    |SI se12 = ""; se12 = #5#2; con12 = #5#1 - 1; |ACABA; |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE lee_contador;
     #5#1;
     ;
     "     ","                              ";
     "zzzzz","zzzzzzzzzzzzzzzzzzzzzzzzzzzzzz";
     be;
     NULL,pasa_contador;
|FIN;

|PROCESO f_contador;
     |DFICE empresa;
     empresa = empresa + "contador.asc";
     |QBF empresa;
     fichero = "wt  " + empresa;
     |QBF fichero;
     |FABRE fichero;
     f = FSalida;
     |BUCLE lee_contador;
     FSalida = f;
     campo = se1; |QBF campo;
     var = campo + tab;
     campo = se2; |QBF campo;
     var = var + campo + tab;
     campo = se3; |QBF campo;
     var = var + campo + tab;
     campo = se4; |QBF campo;
     var = var + campo + tab;
     campo = se5; |QBF campo;
     var = var + campo + tab;
     campo = se6; |QBF campo;
     var = var + campo + tab;
     campo = se7; |QBF campo;
     var = var + campo + tab;
     campo = se8; |QBF campo;
     var = var + campo + tab;
     campo = se9; |QBF campo;
     var = var + campo + tab;
     campo = se10; |QBF campo;
     var = var + campo + tab;
     campo = se11; |QBF campo;
     var = var + campo + tab;
     campo = se12; |QBF campo;
     var = var + campo + tab;
     campo = con1; |QBF campo;
     var = var + campo + tab;
     campo = con2; |QBF campo;
     var = var + campo + tab;
     campo = con3; |QBF campo;
     var = var + campo + tab;
     campo = con4; |QBF campo;
     var = var + campo + tab;
     campo = con5; |QBF campo;
     var = var + campo + tab;
     campo = con6; |QBF campo;
     var = var + campo + tab;
     campo = con7; |QBF campo;
     var = var + campo + tab;
     campo = con8; |QBF campo;
     var = var + campo + tab;
     campo = con9; |QBF campo;
     var = var + campo + tab;
     campo = con10; |QBF campo;
     var = var + campo + tab;
     campo = con11; |QBF campo;
     var = var + campo + tab;
     campo = con12; |QBF campo;
     var = var + campo + final;
     cadena = f + " " + var;
     |FGRABA cadena;
     f = 0;
     FSalida = f;
     |FCIERRA FSalida;
     Pos = -1;
     cadena = "";
     campo = "";
     var = "";
|FPRC;

||------------------------- FICHERO DE COBROS FACTURAS -------------------------------

|PROCESO pasa_recibos;
 |SI #dscam003@#14 ! "P"; |O #dscam003@#14 ! "C"; |O #dscam003@#14 ! "I"; |ACABA; |FINSI;
 aAlfa = "|C090TIPO"; aAlfa = #dscam003@#aAlfa#;
 |SI aAlfa ! "F";
    |SI #dscam003@#90 = "S"; |ACABA; |FINSI;
 |FINSI;
 |SI #dscam003@#46 ! #48#0;  |ACABA; |FINSI;

 |ABRE #2;
 #2#0 = #dscam003@#32;
 |LEE 000#2=;
 |LIBERA #2;
 |SI #2#0 ] #0#2;|Y #2#0 [ #0#3; |Y #2#3 ] #0#4;|Y #2#3 [ #0#5; |Y f ] 0;
              campo = #dscam003@#0; |QBF campo;
              variable = campo + tab;
              campo = #dscam003@#1; |QBF campo;
              variable = variable + campo + tab;
                   |PINTA 1922,"                                                         ";
                   |PINTA 1922,"REC.COBROS:";
                   |PINTA 1935,variable;
              pp = #dscam003@#2;
              campo = #dscam003@#2;  |QBF campo;
              variable = variable + campo + tab;
              campo = #dscam003@#6;  |QBF campo;
              variable = variable + campo + tab;
              campo = #dscam003@#30;  |QBF campo;
              variable = variable + campo + tab;
              campo = #dscam003@#23; |QBF campo;
              variable = variable + campo + tab;
              campo = "N";   |QBF campo;
              variable = variable + campo + tab;
              campo = #2#2;  |QBF campo;
              |SI campo = "";
                campo = #2#1;  |QBF campo;
              |FINSI;
              campo = campo + (("000000000" + #dscam003@#40) % -109);
              variable = variable + campo + final;
              cadena = f + " " + variable;
              |FGRABA cadena;
              campo = "";
              variable = "";
              cadena = "";
 |FINSI;
 |LIBERA #2;
 |CIERRA #2;
|FPRC;

|DEFBUCLE lee_recibos;
   #dscam003@#12006;
   31;
   #dscam045@#4, 000000, 000, "00.00.0000", "            ", #0#2, 0.0001;
   #dscam045@#5, 999999, 999, "31.12.9999", "zzzzzzzzzzzz", #0#3, 9999999999.9999;
   be;
   NULL,pasa_recibos;
|FIN;

|PROCESO LineasCtrl;
   |DBASS aAlfa; |QBF aAlfa;
   aAlfa = aAlfa + "dscarter/fich/" + (("00000" + #dscam045@#6) % -105) + "/"; |PATH_DAT #201 aAlfa;
   |ABRE #dscam003@;
   |BUCLE lee_recibos;
   |CIERRA #dscam003@;
|FPRC;

|DEFBUCLE LineasCtrl;
#dscam045@#1002;
2;
nEmpresa, 001, "V";
nEmpresa, 999, "V";
;
NULL,LineasCtrl;
|FIN;

|PROCESO f_cobros;
     |DFICE empresa;
     |QBF empresa;
     empresa = empresa + "cobros.asc";
      |QBF empresa;
     fichero = "wt  " + empresa;
     |QBF fichero;
     |FABRE fichero;
     f = FSalida;

     |DBASS aAlfa; |QBF aAlfa; aAlfa = aAlfa + "dscarter/def/dscam045.mas";
     |CARGA_DEF aAlfa, dscam045@;
     |SI FSalida = 0;
        |DBASS aAlfa; |QBF aAlfa;
        aAlfa = aAlfa + "dscarter/fich/"; |PATH_DAT #200 aAlfa;
        |DBASS aAlfa; |QBF aAlfa;
        aAlfa = aAlfa + "dscarter/def/dscam003.mas";
        |CARGA_DEF aAlfa, dscam003@;
        |SI FSalida = 0;
           nEmpresa = #48#0; |BUCLE LineasCtrl;
           |DESCARGA_DEF #dscam003@;
        |FINSI;
        |DESCARGA_DEF #dscam045@;
     |FINSI;

     f = 0;
     FSalida = f;
     |FCIERRA FSalida;
     Pos = -1;
|FPRC;
||------------------------- FICHERO DE VISITAS ----------------------------

|PROCESO pasa_visitas;
     |SI f ] 0;
          campo = #9#2; |QBF campo;
          var = campo + tab;
          campo = #9#0; |QBF campo;
          var = var + campo + tab;
          |ABRE #2;
          #2#0 = #9#0;
          |LEE 111#2=;
          campo =  #2#2;  |QBF campo;
          var = var + campo + tab;
               |PINTA 1922,"                                                         ";
               |PINTA 1922,"VISITAS : ";
               |PINTA 1942,campo;
          |LIBERA #2;
          |CIERRA #2;
          campo = #9#1;  |QBF campo;
          var = var + campo + final;
          cadena = f + " " + var;
          |FGRABA cadena;
          campo = "";
          var = "";
          cadena = "";
     |FINSI;
|FPRC;

|DEFBUCLE lee_visitas;
     #9#1;
     ;
     #0#2,#0#4;
     #0#3,#0#5;
     be;
     NULL,NULL,NULL,NULL,NULL,pasa_visitas;
     #9#2;
|FIN;

|PROCESO f_visitas;
     |DFICE empresa;
     empresa = empresa + "visitas.asc";
     |QBF empresa;
     fichero = "wt  " + empresa;
     |QBF fichero;
     |FABRE fichero;
     f = FSalida;
     |BUCLE lee_visitas;
     f = 0;
     FSalida = f;
     |FCIERRA FSalida;
     Pos = -1;
|FPRC;

||------------------------- FICHERO DE PROMOCIONES -------------------------
|PROCESO dsm00134;
     |SI f ] 0;
          campo = #8#0; |QBF campo;
          campo = campo + #8#1; |QBF campo;
          var = campo + tab;
               |PINTA 1922,"                                                         ";
               |PINTA 1922,"PROMOCLIART : ";
               |PINTA 1942,campo;
          campo = #8#2;  |QBF campo; var = var + campo + tab;
          campo = #8#3;  |QBF campo; var = var + campo + tab;
          campo = #8#4; |QBF campo; var = var + campo + tab;
          campo = #8#5; |QBF campo; var = var + campo + tab;
          campo = #8#6; |QBF campo; var = var + campo + tab;
          campo = #8#7; |QBF campo;
          var = var + campo + final;
          cadena = f + " " + var;
          |FGRABA cadena;
          campo = "";
          var = "";
          cadena = "";
     |FINSI;
|FPRC;

|DEFBUCLE dsm00134;
     #8#1;
     ;
     #0#2, #0#7;
     #0#3, #0#8;
     ;
     NULL, dsm00134;
|FIN;

|PROCESO PromoCliArt;
     |DFICE empresa;
     empresa = empresa + "prcliart.asc";
     |QBF empresa;
     fichero = "wt  " + empresa;
     |QBF fichero;
     |FABRE fichero;
     f = FSalida;
     |SI #142#250 = "S";
          |BUCLE dsm00134;
     |FINSI;
     f = 0;
     FSalida = f;
     |FCIERRA FSalida;
     Pos = -1;

|FPRC;
||--
|PROCESO pasa_promoc;
     |SI f ] 0;
          campo = #8#0; |QBF campo;
          campo = campo + #8#1; |QBF campo;
          var = campo + tab;
               |PINTA 1922,"                                                         ";
               |PINTA 1922,"PROMOCIONES : ";
               |PINTA 1942,campo;
          campo = #8#3;  |QBF campo;
          var = var + campo + tab;
          campo = #8#4;  |QBF campo;
          var = var + campo + tab;
          campo = #8#6; |QBF campo;
          var = var + campo + tab;
          campo = #8#7; |QBF campo;
          var = var + campo + tab;
          campo = #8#2; |QBF campo;
          var = var + campo + tab;
          campo = #8#5; |QBF campo;
          var = var + campo + final;
          cadena = f + " " + var;
          |FGRABA cadena;
          campo = "";
          var = "";
          cadena = "";
     |FINSI;
|FPRC;

|DEFBUCLE lee_promoc;
     #8#1;
     ;
     #0#2, #0#7;
     #0#3, #0#8;
     ;
     NULL, pasa_promoc;
|FIN;

|PROCESO f_promoc;
     |DFICE empresa;
     empresa = empresa + "promoc.asc";
     |QBF empresa;
     fichero = "wt  " + empresa;
     |QBF fichero;
     |FABRE fichero;
     f = FSalida;
     |BUCLE lee_promoc;
     f = 0;
     FSalida = f;
     |FCIERRA FSalida;
     Pos = -1;
|FPRC;


||------------------------- RUTINA PRINCIPAL --------------------------------

|PROCESO pasa_psion; |TIPO 3;
     |SI #99#1 = "SI";
          |ABRE #142; |LEE 000#142p; |CIERRA #142;

          tab1 = 9;
          final1 = 10;
          final2 = 13;
          tab = &tab1;
       ||   final = &final2;
          final = "";
          |SI #0#1  = "S"; |HAZ clientes;   |FINSI;
          |SI #0#6  = "S"; |HAZ articulos;  |FINSI;
          |SI #0#11 = "S"; |HAZ f_contador; |FINSI;
          |SI #0#20 = "S"; |HAZ f_iva;      |FINSI;
          |SI #0#21 = "S"; |HAZ f_pago;     |FINSI;
          |SI #0#22 = "S"; |HAZ f_cobros;   |FINSI;
          |SI #0#28 = "S"; |HAZ f_promoc;   |FINSI;
          |SI #0#31 = "S"; |HAZ f_visitas;  |FINSI;
          |HAZ PromoCliArt;
          |ATRI P;
          |MENAV "0000FIN DE PROCESOS";
          |ATRI p;
     |FINSI;
|FPRC;
