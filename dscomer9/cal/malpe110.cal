|FICHEROS;
     malpe110 #0;
     malpt008 #1,MANTE;
     agifa027 #27;
     malpe087 #87;
     malpe088 #88;
     malpe085 #85;
     agifa146 #146;
     agifa147 #147;
|FIN;

|VARIABLES;
     aAlfa = "";
     &aDivisa = "";
     &aMoneda = "";
     &enSwMenu = 0;

     &serie = "";
     &numero = 0;
     &reimpr = "";

     nLin = 0;
     nConta = 0;
|FIN;

|PROCESO CreaLin;
     |SI #1#8 = 0;
          |ACABA;
     |FINSI;
     #88#28 = #0#0;
     #88#0 = #0#1;
     #88#1 = #1#0;
     |LEE 020#88=;
     |SI FSalida ! 0; |ACABA; |FINSI;

     nLin = nLin + 1;
     #147#20 = #146#48;
     #147#0 = #146#0;
     #147#1 = nLin;
     #147#2 = #1#1;
     #147#3 = #1#2;
     #147#4 = #1#4;
     #147#5 = #1#6; ||Uni
     #147#29 = #1#3; ||Lote
     #147#6 = #1#7;
     #147#10 = #88#10;
     #147#11 = #88#14;
     #147#12 = #88#0; ||Numero Pedido
     #147#13 = #88#18;
     #147#15 = #88#20;
     #147#16 = #88#17;
     #147#17 = #88#19;
     #147#18 = #88#27;

     |HAZ TotalLin147;
     |GRABA 020#147n;
|FPRC;

|DEFBUCLE CreaLin;
     #1#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, CreaLin;
|FIN;

|PROCESO Proforma;
     |ABRE #88;
     |ABRE #146;
     |ABRE #147;
     #146#48 = #0#0;     ||Serie
     enSwMenu = 1;
     |HAZ ContaPR0;
     nConta = #146#0;

     #146#0 = nConta;
     #146#48 = #0#0;
     |LEE 000#146=;
     |SI FSalida = 0;
          |PARA; |SI FSalida = 0; |HACIENDO nConta = nConta + 1;
               #146#0 = nConta;
               |LEE 000#146=;
          |SIGUE;
          |ABRE #27;
          #27#2 = #0#0;
          #27#0 = "valbaran";
          |LEE 101#27=;
          |SI FSalida = 0;
               #27#1 = nConta;
               |GRABA 020#27a;
          |FINSI;
          |CIERRA #27;
          nConta = #146#0;
     |FINSI;

     |DDEFECTO #146;
     #146#0 = nConta;
     #146#48 = #0#0;
     |GRABA 020#146b;

     #146#1 = ~;  || Fecha
     #146#3 = #87#4;
     #146#4 = #87#8;
     #146#5 = #87#5;
     #146#6 = #87#7;
     #146#7 = #87#6;
     #146#8 = #87#9;
     #146#29 = #87#64
     #146#30 = #87#14;
     #146#31 = #87#20;
     #146#32 = #87#17;
     #146#33 = #87#21;
     #146#34 = #87#16;
     #146#35 = #87#18;
     #146#36 = #87#22;
     #146#65 = #87#35;
     #146#66 = #87#36;
     #146#67 = #87#37;
     #146#68 = #87#40;
     #146#69 = #87#41;
     #146#78 = #87#60;
     #146#80 = #87#57;

     #146#60 = #87#25;
     #146#61 = ("000000" + #87#0) % -106;
     |HAZ LimCabAgifa146;
|||-----
     aDivisa = #146#65;
     aMoneda = #146#67;
     |HAZ Divisas146;
     nLin = 0;
     |BUCLE CreaLin;
     |BUCLELIN 0 CalCabAgifa146 #146;
     |GRABA 020#146a;

     |CIERRA #146;
     |CIERRA #147;
     |CIERRA #88;
|FPRC;

|PROCESO Tecla; |TIPO 0;
     |SI #1Campo = Contenido;
          #0#3 = #0#3 - #1#8;
          |ENCAMPO #5#1;
        |ET E1;
          |ENCAMPO #6#1;
          |SI FSalida = 2; |VETE E1; |FINSI;
          #0#3 = #0#3 + #1#8;
          |PINTA #0#3;
          |GRABA 020#1a;
     |FINSI;
|FPRC;

|PROCESO UniPalet; |TIPO 0;
     |ABRE #85;
     #85#0 = #1#1;
     #85#1 = #1#2;
     #85#2 = #1#3;
     |LEE 101#85=;
     |CIERRA #85;

     |SI Campo = 5;
          #1#6 = #1#5 * #85#4;
          |PINTA #1#6;
     |SINO;
          #1#5 = #1#6 / #85#4;
          |PINTA #1#5;
     |FINSI;
     #1#8 = #1#6 * #1#7;
     |PINTA #1#8;
|FPRC;

|PROCESO Lineas;
     #1#0 = #88#1;
     #1#1 = #88#2;
     #1#2 = #88#3;
     #1#3 = #88#45;
     #1#4 = #88#4;
     #1#5 = #88#57;
     #1#6 = #88#5;
     #1#7 = #88#6;
     #1#8 = #88#9;
     |GRABA 020#1n;
|FPRC;

|PROCESO Min;
     #1#0 = 1;
|FPRC;

|PROCESO Max;
     #1#0 = 999;
|FPRC;

|PROCESO Tipo12; |TIPO 12;
     |SI FSalida ! 0; |O #0#1 = 0; |ACABA; |FINSI;

     |ABRE #1;
     |ABRE #87;
     #87#25 = #0#0;
     #87#0 = #0#1;
     |LEE 000#87=;
     |SI FSalida = 0;
          aDivisa = #87#35
          aMoneda = #87#37;
          |HAZ Divisas104;
          |BUCLELIN 2Lineas#87;
          #0#2 = #87#45; |PINTA #0#2;
          #0#3 = #0#2 ; |PINTA #0#3;
          |ENTLINEAL #1#1, 1, 4, 20, 0, Min, Max;
          |CONFI "0000NCrear Factura Proforma";
          |SI FSalida = 0; |Y #0#3 ! 0;
               |HAZ Proforma;
               serie = #146#48;
               numero = #146#0;
               reimpr = "N";
               |SUB_EJECUTA_NP "agifa150";
          |FINSI;
     |SINO;
          |MENAV "0000No existe Pedido";
     |FINSI;
     |CIERRA #87;
     |CIERRA #1;
|FPRC;

|PROGRAMA;
     |CLS;
     aAlfa = Usuario;
     |NOME_DAT #1 aAlfa;
     |DELINDEX #1;
     |PINPA #0#0;
     |ENTLINEAL #1#1, 1, 7, 20, 1, Min, Max;
     |PINDA #0#0;
     |ENDATOS #1#0;
     |DELINDEX #1;
|FPRO;
