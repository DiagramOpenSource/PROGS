|FICHEROS;
     iber0058 #0; ||Este Def.
     agifa017 #1; ||Articulos/Almacen.
     agifa019 #2; ||Articulos.
     iber0018 #3; ||Articulos Por Centro.
     iber0003 #7; ||Pedidos (C).
     iber0004 #8; ||Pedidos (L).
     iber0016 #9; ||Centro Venta.
     dsm00241 #241; ||Medida

     agifa067 #67;       ||Lineas Pedidos Compra
     agifa007 #1007;     ||Serie
|FIN;

|VARIABLES;
     &eaDocu = "";
     aInforme= "iber0058";
     &Tempo  = "";
     aTempo7 = "";
     aTempo8 = "";
     nFactor = 0;
     nUni    = 0;
     nSw     = 0;
     nUnid   = 0;
     nDife   = 0;
     nResto  = 0;
     aCentro = "";
     nSum    = 0;
     nSal    = 0;
     aAlmacen = "";
     &enForma  = 0;
|FIN;

|PROCESO Impresion;
     |PRINT;
|FPRC;

|PROCESO Pie;
     |PIEINF;
|FPRC;

|DEFBUCLE Impresion;
     #7#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, NULL, Impresion, Pie;
|FIN;

|PROCESO agifa017;
     |DDEFECTO #3;
     #3#0 = aCentro;
     #3#1 = #1#0;
     |LEE 000#3=;
     |SI FSalida ! 0; |O #3#7 = "S"; |ACABA; |FINSI;  ||Fabricacion Propia.

     |SI #1#6 ] #1#49;
          nUnid = #1#6;
     |SINO;
          nUnid = #1#49;
     |FINSI;
     |SI nUnid = 0;      |ACABA; |FINSI;
     |SI nUnid < #1#39;  |ACABA; |FINSI;

     nDife = nUnid - #1#39;

     |SI nSw = 0;
          |DDEFECTO #7;
          #7#0 = aCentro;
          #7#1 = ~;
          |LEE 101#7=;
          |SI FSalida ! 0;
               |GRABA 020#7n;
          |FINSI;
          |LIBERA #7;
          nSw = 1;
     |FINSI;

     ||--------Lectura Articulo.
     |DDEFECTO #2;
     #2#0 = #1#0;
     |LEE 000#2=;

     |DDEFECTO #8;
     nSum = nSum + 1;
     #8#0 = #7#0;
     #8#1 = #7#1;
     #8#2 = nSum;
     |LEE 101#8=;
     nSal = FSalida;
     #8#3 = #2#0;
     #8#4 = #2#1;
     #8#6 = #2#27;
     #8#10 = #3#12;

     |SI #2#204 = "N";
          nFactor = 1;
     |SINO;
          |DDEFECTO #241;
          #241#0 = #2#5;
          #241#2 = #8#10; || Unidad Stock
          |LEE 000#241=;

          |SI #241#6 = "D";
               nFactor = 1 / #241#5;
          |SINO;
               nFactor = 1 * #241#5;
          |FINSI;
     |FINSI;

     nUni = (nDife * nFactor);
     nUni = (nUni + 0.49) ! 0;

     |SI nUni ! 0;
          #8#5 = nUni;  ||Total Pedido.
          #8#6 = #3#9;  ||Proveedor.

          |SI #3#8 = "C";
               #8#7 = #9#11;
          |FINSI;
          |SI #3#8 = "O";
               #8#7 = #9#12;
          |FINSI;
          |SI #3#8 = "P";
               #8#7 = #9#13;
          |FINSI;

          |ABRE #agifa067;
          |ABRE #agifa007;
          #agifa007#26 = #8#7;
          |LEE 000#agifa007.=;
          |SI FSalida = 0;
               aAlmacen = #agifa007#31;
          |FINSI;
          |CIERRA #agifa007;
          |DDEFECTO #agifa067;
          #agifa067#2 = #iber0004#3;
          #agifa067#3 = aAlmacen;
          #agifa067#5 = #iber0004#5;

          enForma = 1;
          eaDocu = "agifa067";
          |HAZ StockEntra;

          |CIERRA #agifa067;

          |SI nSal = 0; |GRABA 020#8a; |FINSI;
          |SI nSal ! 0; |GRABA 020#8n; |FINSI;
     |FINSI;
     |LIBERA #8;
|FPRC;


|DEFBUCLE agifa017;
     #1#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL,agifa017;
|FIN;

|PROCESO ejec; |TIPO 12;
     |SI #0#0 ! "SI"; |ACABA; |FINSI;

     |DFICE aCentro;
     aCentro = aCentro % -403;

     |SI #0#1 = "I";
          |HAZ CreaTempo; aTempo7 = Tempo; |NOME_DAT #7 aTempo7; |DELINDEX #7;
          |HAZ CreaTempo; aTempo8 = Tempo; |NOME_DAT #8 aTempo8; |DELINDEX #8;
     |FINSI;

     |DDEFECTO #9;
     |ABRE #9;
     #9#0 = aCentro;
     |LEE 000#9=;
     |CIERRA #9;

     |ABRE #2;
     |ABRE #3;
     |ABRE #7;
     |ABRE #8;
     |ABRE #241;
     |SELECT #2#241;
     |BUCLE agifa017;
     |CIERRA #2;
     |CIERRA #3;
     |CIERRA #7;
     |CIERRA #8;
     |CIERRA #241;

     |SI #0#1 = "I";
          |IMPRE 0;
          |SI FSalida = 0;
               |INFOR aInforme;
               |SI FSalida = 0;
                    |BUCLE Impresion;
                    |FININF;
               |FINSI;
               |FINIMP;
          |FINSI;
          |DELINDEX #7; Tempo = aTempo7; |HAZ BoraTempo;
          |DELINDEX #8; Tempo = aTempo7; |HAZ BoraTempo;
     |FINSI;
|FPRC;

|PROGRAMA;
     |SI PARAMETRO = "";
          |MANTE #0;
     |SINO;
          #0#0 = "SI";
          #0#1 = "I";
          |HAZ ejec;
     |FINSI;
|FPRO;
