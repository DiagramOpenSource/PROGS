|FICHEROS;
     dsfa0006 #0;
     dsfa0007 #1,MANTE;
     dsfa0008 #2;  ||Historico Partir
     agifa019 #19;
     agifa065 #65;
     agifa069 #69;
     agifa084 #84;
     agifa142 #142;
     agifa501 #501;
     agifa502 #502;
     agifa508 #508;       ||Documentos Borrados
     agifa517 #517;
|FIN;

|VARIABLES;
     &enTiva = 0;
     &efFiva = @;
     &eaDiva = "";
     &enIva = 0;
     &enRec = 0;
     &nDeci_PreDiv = 0;
     &eaProgVta= "";
     &enSwMenu = 0;
     &enForma  = 0;
     &serie    = "";
     &numero   = 0;
     &reimpr   = "";

     nConta    = 0;
     i         = 0;
     nImpDiv   = 0;
     nMult     = 0;
     nSwPrime  = 0;
     nLin      = 0;
     aAlfa     = "";
|FIN;

|PROCESO HistoParteFC;
     |ABRE #2;
     #2#0 = #0#4;
     #2#1 = #0#5;
     #2#2 = 99;
     |LEE 000#2];
     |SI FSalida = 0;
          |LEE 000#2a;
     |SINO;
          |LEE 000#2u;
     |FINSI;
     |SI FSalida = 0; |Y #2#0 = #0#4; |Y #2#1 = #0#5;
          nLin = #2#2 + 1;
     |SINO;
          nLin = 1;
     |FINSI;
     #2#0 = #0#4;
     #2#1 = #0#5;
     #2#2 = nLin;
     #2#3 = "F";
     #2#4 = #84#48;
     #2#5 = #84#0;
     #2#6 = #1#2;
     #2#7 = #1#1;
     |GRABA 020#2n;
     |CIERRA #2;
|FPRC;

|PROCESO BorraLinFac;
     enForma  = -1;
     eaProgVta = "agifa084";
     |HAZ AcumulaFC;
     |BORRA 020#69a;
|FPRC;

|PROCESO LinFac;
     #69#20 = #0#0;
     #69#0 = nConta;
     #69#5 = -#69#5;    || EN NEGATIVO
     |HAZ TotalLin69;
     |GRABA 020#69n;
|FPRC;

|PROCESO Tempo;
     |SI nSwPrime ! 0;
          |ABRE #508;         || Doc. Borrados
          |DDEFECTO #508;
          |SI #142#26 = "S";
               #508#0 = "vfactura";
          |SINO;
               #508#0 = "vfactuco";
          |FINSI;
          aAlfa = #508#0;
          nConta = 0;
          |LEE 101#508];
          |PARA; |SI FSalida = 0; |Y #508#0 = aAlfa; |HACIENDO;
               |SI #508#3 = #84#1;
                    nConta = #508#2;
                    |BORRA 020#508a;
                    |SAL;
               |FINSI;
               |LIBERA #508;
               |LEE 101#508s;
          |SIGUE;
          |SI nConta !  0;
               |SALVA_DATOS #84;
               #84#0 = nConta;
               |GRABA 020#84b;
               |REPON_DATOS #84;
          |SINO;
               |SALVA_DATOS #84;
               enSwMenu = 1; |HAZ ContaFD7;
               nConta = #84#0;
               |GRABA 020#84b;
               |REPON_DATOS #84;
          |FINSI;
          |CIERRA #508;
     |FINSI;
     nSwPrime = 1;

     #84#48 = #0#0;
     #84#0 = nConta;
     #84#3 = #1#3;
     #84#4 = #1#4;
     #84#29 = #1#4;
     #84#30 = #1#6;
     #84#31 = #1#7;
     #84#64 = "";
     #84#33 = "";
     #84#60 = #1#5;
     |PARA i = 15; |SI i [ 26; |HACIENDO i = i + 1;
          #84i = 0;
     |SIGUE;
     #84#28 = 0;
     #84#37 = 0;
     |PARA i = 41; |SI i [ 47; |HACIENDO i = i + 1;
          #84i = 0;
     |SIGUE;
     #84#49 = 0;
     |PARA i = 70; |SI i [ 77; |HACIENDO i = i + 1;
          #84i = 0;
     |SIGUE;
     |GRABA 020#84a;

     |ABRE #19;
     #19#0 = #517#25;
     |LEE 000#19=;
     |CIERRA #19;

     enTiva = #19#30;
     efFiva = #84#1;
     |HAZ SacaIVA;

     |DDEFECTO #69;
     #69#20 = #0#0;
     #69#0 = nConta;
     #69#1 = 1;
     #69#2 = #517#25;
     #69#3 = 1;
     #69#4 = #1#8;
     #69#5 = 1;
     #69#6 = #1#1 / (1+(enIva/100));
     |HAZ TotalLin69;
     |GRABA 020#69n;

     enForma  = 1;
     eaProgVta = "agifa084";
     |HAZ AcumulaFC;

     |HAZ CalCabAgifa084;

     |GRABA 020#84a;
     |LIBERA #84;

     |HAZ HistoParteFC;

     serie = #84#48;
     numero = #84#0;
     reimpr = #84#10;
     |SUB_EJECUTA_NP "agifa086";
|FPRC;

|DEFBUCLE Tempo;
     #1#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Tempo;
|FIN;

|PROCESO Factura;
     |ABRE #65;
     |ABRE #69;
     |ABRE #84;

     #84#48 = #0#0;
     #84#0 = #0#1;
     |LEE 000#84=;
     |BUCLELIN 0 BorraLinFac #84;

     nConta = #84#0;
     nSwPrime = 0;
     |BUCLE Tempo;

     |CIERRA #69;
     |CIERRA #84;
     |CIERRA #65;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO BorraFac0;
     #84#48 = #2#4;
     #84#0 = #2#5;
     |LEE 101#84=;
     |SI FSalida = 0;
          |BUCLELIN 0 BorraLinFac #84;
          |BORRA 020#84a;
     |FINSI;
     |SI nSwPrime ! 0;
          |ABRE #508;         || Doc. Borrados
          |SI #142#26 = "S";
               #508#0 = "vfactura";
          |SINO;
               #508#0 = "vfactuco";
          |FINSI;
          #508#1 = #84#48;
          #508#2 = #84#0;
          #508#3 = #84#1;
          |GRABA 040#508n;
          |CIERRA #508;
     |FINSI;
     nSwPrime = 1;
|FPRC;

|DEFBUCLE BorraFac0;
     #2#1;
     3;
     #0#4, #0#5, 01, "F";
     #0#4, #0#5, 99, "F";
     ;
     NULL, BorraFac0;
|FIN;

|PROCESO BorraFac;
     |ABRE #84;
     nSwPrime = 0;
     |BUCLE BorraFac0;
     |CIERRA #84;
|FPRC;
