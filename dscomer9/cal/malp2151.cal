   STOCK PEDIDO: AcumulaLin

|FICHEROS;
     agifa019 #19;
     agifa017 #17;
     dsm00024 #24,MANTE;
     malpe087 #87,MANTE; ||Pedidos Vta
     malpe088 #88;
     malpe083 #83; ||Arti
     malpe085 #85; ||Lote
     malpe104@ #104;
|FIN;


|INCLUYE i_varart;

|VARIABLES;
     aDef = "";
     aArti = "";
     aParti = "";
     nAlma = "";
     nPrecio = 0;
|FIN;

|PROCESO GrabaArtiMp2;
     |HAZ ValoraStock;
     |GRABA 020#19a;
     |GRABA 020#17a;
     |GRABA 020#85a;
     |LIBERA #85;
     |GRABA 020#24a;
     |CIERRA #85;
     |CIERRA #24;
     |CIERRA #17;
     |CIERRA #19;
|FPRC;

|PROCESO LeeArtiMp2;
     |DDEFECTO #19;
     |DDEFECTO #17;
     |DDEFECTO #24;
     |DDEFECTO #85;
     |ABRE #19;
     |ABRE #17;
     |ABRE #24;
     |ABRE #85;
     #19#0 = aArti;
     |LEE 101#19=;
     |SI FSalida ! 0; |GRABA 020#19b; |FINSI;
     #17#0 = aArti;
     #17#1 = nAlma;
     |LEE 101#17=;
     |SI FSalida ! 0; |GRABA 020#17b; |FINSI;
     #24#0 = aArti;
     #24#1 = nAlma;
     #24#2 = aParti;
     |LEE 101#24=;
     |SI FSalida ! 0; |GRABA 020#24b; |FINSI;
     #85#0 = aArti;
     #85#1 = nAlma;
     #85#2 = aParti;
     |LEE 101#85=;
     |SI FSalida ! 0; |GRABA 020#85b; |FINSI;
|FPRC;

|PROCESO AcumuLotePV2;
     |DDEFECTO #24;
     #24#0 = #104#8;
     #24#1 = #104#9;
     #24#2 = #104#10;
     |LEE 101#24=;
     |SI FSalida ! 0; |GRABA 020#24b; |FINSI;
     #24#16 = #24#16 + ((#104#5 - #104#7) * enForma);
     |GRABA 020#24a;
|FPRC;

|DEFBUCLE AcumuLotePV2;
     #104#1004;
     ;
     #88#28, #88#0, #88#1, 001;
     #88#28, #88#0, #88#1, 999;
     ;
     NULL, AcumuLotePV2;
|FIN;

|PROCESO AcumulaLin;
     aArti = #88#2;
     nAlma = #88#3;
     aParti = #88#45;
     |HAZ LeeArtiMp2;
     #19#15 = #19#15 + (#88#5 * enForma);
     #17#42 = #17#42 + (#88#5 * enForma);

     |DDEF aDef;
     aDef = aDef + "malpe104";
     |CARGA_DEF aDef, malpe104@;
     |SI FSalida = 0;
          |BUCLE AcumuLotePV2;
          |DESCARGA_DEF #malpe104@;
     |FINSI;
     |HAZ GrabaArtiMp2;
|FPRC;
