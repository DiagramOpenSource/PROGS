|FICHEROS;
     mecaz005 #0;
     mecam001 #1;
     mecam004 #4;
     mecam005 #5;
     mecam006 #6;
     mecam007 #7;
     mecam008 #8;
     mecam009 #9;
     mecam010 #10;
     mecam011 #11;
     mecam012 #12;
     agifa017 #17;
     agifa019 #19;
     agifa049 #49;

     agifa073 #73;

     agifa073 #73;

     agifa104 #104;
     mecaz005@;
|FIN;

|VARIABLES;
     &eaSerie = "";
     &enOrden = 0;
     nUni = 0;
     aArti = "";
     nPrime = 0;
     nLinCompo = 0;
     aSerie = "     ";
     aTmp = "";
     nUnidades = 0;
     nConta = 0;
     &Tempo = "";
     aTmp0 = "";
     aAlfa = "";
     nNumero = "";
     nLinea = 0;
     aEligeMaestra = "";
     {-1}Menu = "";
     Menu1 = "2400";
     Menu2 = "1";
     Menu3 = "Opciones:";
     Menu4 = "RAC";
     Menu5 = " Repasar ";
     Menu6 = " Aceptar ";
     Menu7 = " Cancelar ";
     nPaquete = 0;
     nErrOrdena = 0;
     aPath = "";
|FIN;

|PROCESO StockFab; ||---------------Actualiza Articulo/Almacen
     #19#0 = #0#3;
     |LEE 101#19=;
     |SI FSalida = 0;
          |SI #0#16 = 0;
               #19#13 = #19#13 + #0#6;
          |SINO;
               #19#13 = #19#13 + #0#16;
          |FINSI;
          #17#0 = #19#0;
          #17#1 = #0#17;          || Almacen
          |LEE 101#17=;
          |SI FSalida = 0;
               |SI #0#16 = 0;
                    #17#9 = #17#9 + #0#6;
               |SINO;
                    #17#9 = #17#9 + #0#16;
               |FINSI;
               |HAZ ValoraStock;
               |GRABA 020#17a;
               |LIBERA #17;
          |SINO;
               |HAZ ValoraStock;
          |FINSI;
          |GRABA 020#19a;
          |LIBERA #19;
     |FINSI;
|FPRC;

|PROCESO CreaNumOrdenLin;
     |DDEFECTO #10;
     #10#0 = aSerie;
     #10#1 = nConta;
     #10#2 = #0#0;
     #10#3 = #0#1;
     #10#4 = #0#2;
     |GRABA 020#10n;
|FPRC;

|PROCESO CreaNumOrden;
     |DDEFECTO #9;
     #9#0 = aSerie;
     #9#1 = 999999;
     |LEE 000#9];
     |SI FSalida = 0;
          |LEE 000#9a;
     |SINO;
          |LEE 000#9u;
     |FINSI;
     |SI FSalida = 0; |Y #9#0 = aSerie;
          nConta = #9#1 + 1;
     |SINO;
          nConta = 1;
     |FINSI;

     |DDEFECTO #9;
     #9#0 = aSerie;
     #9#1 = nConta;
     #9#2 = ~;
     |SI aEligeMaestra = "S";
          #9#3 = aArti;
     |FINSI;
     |GRABA 020#9n;
|FPRC;

|PROCESO Escandallo;
     |DDEFECTO #6;
     #6#0 = #0#0;
     #6#1 = #0#1;
     #6#2 = #0#2;
     |LEE 000#6=;

     |DDEFECTO #4;
     #4#0 = #49#0;
     #4#1 = #49#1;
     |LEE 000#4=;

     nUnidades = #0#16 * #49#12;
     |SI nUnidades = 0;
          nUnidades = #0#6 * #49#12;
     |FINSI;
     |SI #4#2 = "S";     || Film
          |SI #6#3 = "N"; |ACABA; |FINSI;
          |SI #6#3 = "A";
               nUnidades = nUnidades * 2;
          |FINSI;
     |FINSI;

     |DDEFECTO #19;
     #19#0 = #49#2;
     |LEE 000#19=;

     |DDEFECTO #11;
     #11#0 = aSerie;
     #11#1 = nConta;
     #11#2 = #0#3;
     #11#3 = #49#2;
     #11#5 = #4#3;
     |LEE 101#11=;
     |SI FSalida ! 0; |GRABA 020#11b; |FINSI;
     #11#4 = #49#9;
     #11#6 = #19#180;
     #11#7 = #11#7 + nUnidades;
     |GRABA 020#11a;
     |LIBERA #11;

     |DDEFECTO #19;
     #19#0 = #49#2;
     |LEE 000#19=;

     |SI #19#180 = "N"; |ACABA; |FINSI;

     |DDEFECTO #12;
     #12#0 = aSerie;
     #12#1 = nConta;
     #12#2 = #0#3;
     #12#3 = #49#2;
     #12#4 = #49#9;
     #12#5 = #4#3;
     #12#6 = "";
     |LEE 101#12=;
     |SI FSalida ! 0; |GRABA 020#12b; |FINSI;
     #12#7 = #12#7 + nUnidades;
     #12#8 = 0;
     |GRABA 020#12a;
     |LIBERA #12;
|FPRC;

|DEFBUCLE Escandallo;
     #49#1;
     ;
     #0#3, 001;
     #0#3, 999;
     ;
     NULL, Escandallo;
|FIN;

|PROCESO MarcaPaquete;
     #7#0 = #8#0;
     #7#1 = #8#1;
     #7#2 = #8#2;
     |LEE 101#7=;
     |SI FSalida = 0;
          #7#5 = aSerie;
          #7#6 = nConta;
          |GRABA 020#7a;
          |LIBERA #7;
     |FINSI;
|FPRC;

|DEFBUCLE MarcaPaquete;
     #8#2;
     ;
     #6#0, #6#1, #6#2;
     #6#0, #6#1, #6#2;
     be;
     NULL, MarcaPaquete;
|FIN;

|PROCESO MarcaPedi;
     #6#0 = #0#0;
     #6#1 = #0#1;
     #6#2 = #0#2;
     |LEE 101#6=;
     |SI FSalida = 0;
          #6#14 = aSerie;
          #6#8 = nConta;
          |GRABA 020#6a;
          |LIBERA #6;
     |FINSI;
     |BUCLE MarcaPaquete;
|FPRC;

|PROCESO CreaOrden;
     |SI #0#10 ! "*";
          |ACABA;
     |FINSI;
     |SI nPrime = 0;
          nPrime = 1;
          |HAZ CreaNumOrden;
     |FINSI;
     |HAZ CreaNumOrdenLin;
     |HAZ StockFab;
     |BUCLE Escandallo;
     |HAZ MarcaPedi;
|FPRC;

|DEFBUCLE CreaOrden;
     #0#3;
     ;
     INICIO;
     FINAL;
     ;
     NULL, CreaOrden;
|FIN;

|PROCESO CreaOrden0;
     |ABRE #4;
     |ABRE #9;
     |ABRE #10;
     |ABRE #11;
     |ABRE #12;
     |ABRE #17;
     |ABRE #19;
     |ABRE #6;
     |ABRE #7;
     |BUCLE CreaOrden;
     |CIERRA #6;
     |CIERRA #7;
     |CIERRA #19;
     |CIERRA #17;
     |CIERRA #12;
     |CIERRA #11;
     |CIERRA #10;
     |CIERRA #9;
     |CIERRA #4;
     |SI nPrime ! 0;
          aAlfa = ("000000" + #9#1) % -106;
          aAlfa = "0000Orden realizada: " + #9#0 + "/" + aAlfa;
          |MENAV aAlfa;
     |FINSI;
|FPRC;

|PROCESO CheqPedLin;
     |SELECT #2#8;
     |DDEFECTO #8;
     #8#0 = #73#28;
     #8#1 = #73#0;
     #8#3 = #73#1;
     |LEE 000#8=;
     |SI #0#14 ! #8#2; |ACABA; |FINSI;

     #mecaz005@#0 = #73#28;
     #mecaz005@#1 = #73#0;
     #mecaz005@#2 = #73#1;
     |LEE 000#mecaz005@.=;
     |SI FSalida = 0;
           |SI #mecaz005@#10 ! "*";
               nErrOrdena = 1;
               aAlfa = "0000Falta marcar " + #73#28 + "/" + #73#0 + "/" + #73#1;
               |MENAV aAlfa;
           |FINSI;
     |FINSI;
|FPRC;

|PROCESO CheqTmp;
     |SI #0#10 ! "*";
          |ACABA;
     |FINSI;

     #104#25 = #0#0;
     #104#0 = #0#1;
     |LEE 000#104=;
     |SI FSalida = 0;
          |BUCLELIN 2CheqPedLin#104;
     |FINSI;
|FPRC;

|DEFBUCLE CheqTmp;
     #0#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, CheqTmp;
|FIN;

|PROCESO CheqOrdena;
     nErrOrdena = 0;
     |DDEF aPath;
     aAlfa = aPath + "mecaz005";
     |CARGA_DEF aAlfa, mecaz005@;
     |SI FSalida ! 0; |ACABA; |FINSI;
     |NOME_DAT #mecaz005@#aTmp0#;
     |ABRE #mecaz005@;
     |ABRE #0;
     |ABRE #104;
     |ABRE #7;
     |ABRE #8;
     |BUCLE CheqTmp;
     |CIERRA #7;
     |CIERRA #8;
     |CIERRA #104;
     |CIERRA #0;
     |CIERRA #mecaz005@;
     |DESCARGA_DEF #mecaz005@;
     FSalida = nErrOrdena;
|FPRC;

|PROCESO Marcala;
     #mecaz005@#10 = "*";
     |GRABA 020#mecaz005@.a;
|FPRC;

|DEFBUCLE Marcala;
     #mecaz005@#1003;
     13;
     aSerie, nNumero, 001, nLinea;
     aSerie, nNumero, 999, nLinea;
     ;
     NULL, Marcala;
|FIN;

|PROCESO MarcaAuto;
     |DDEF aAlfa;
     aAlfa = aAlfa + "mecaz005";
     |CARGA_DEF aAlfa, mecaz005@;
     |SI FSalida = 0;
          |NOME_DAT #mecaz005@#aTmp0#;
          |BUCLE Marcala;
          |DESCARGA_DEF #mecaz005@;
     |FINSI;
|FPRC;

|PROCESO Marca; |TIPO 0;
     |SI FSalida = 0; |Y #0Campo = Contenido;
          |DDEFECTO #6;
          |ABRE #6;
          #6#0 = #0#0;
          #6#1 = #0#1;
          #6#2 = #0#2;
          |LEE 000#6=;
          |CIERRA #6;

          |SI #0#10 = "*";
               #0#10 = "";
          |SINO;
               #0#10 = "*";
          |FINSI;

          |SI #0#10 = "*";
               |SI #6#13 = 0; || Linea Maestra;
                    |SI aEligeMaestra = "S"; |Y aArti ! #0#3;
                         aAlfa = "0000Ya se ha elegido el articulo maestro:" + aArti;
                         #0#10 = "";
                         |MENAV aAlfa;
                         |ERROR; |ACABA;
                    |FINSI;
                    aEligeMaestra = "S";
                    aSerie = #0#0;
                    nNumero = #0#1;
                    nLinea = #0#2;
                    aArti = #0#3;
                    nUni = #0#6;
                    |CONFI "0000SOrdenar las lineas automaticas";
                    |SI FSalida = 0;
                         |HAZ MarcaAuto;
                         |PONCONTROL 23, "SI";
                    |FINSI;
               |FINSI;
          |SINO;
               |SI #0#0 = aSerie; |Y #0#1 = nNumero; |Y #0#2 = nLinea;
                    aEligeMaestra = "N";
               |FINSI;
          |FINSI;
          |GRABA 020#0a;
          |PINTA #0#10;
     |FINSI;
|FPRC;

|PROCESO LinPedidos;
     |DDEFECTO #6;
     #6#0 = #73#28;
     #6#1 = #73#0;
     #6#2 = #73#1;
     |LEE 000#6=;
     |SI #6#4 ! "S"; |ACABA; |FINSI;
     |SI #6#8 ! 0; |ACABA; |FINSI;
     |SI #6#10 = "S"; |ACABA; |FINSI;

     |DDEFECTO #1;
     #1#0 = #73#2;
     |LEE 000#1=;
     |SI #1#3 ! "S"; |ACABA; |FINSI;

     |SELECT #2#8;
     |DDEFECTO #8;
     #8#0 = #73#28;
     #8#1 = #73#0;
     #8#3 = #73#1;
     |LEE 000#8=;

     #0#0 = #73#28;
     #0#1 = #73#0;
     #0#2 = #73#1;
     #0#3 = #73#2;
     #0#4 = #73#13;
     #0#5 = #73#50;
     #0#6 = #73#5;
     #0#7 = #104#4;
     #0#8 = #104#8;
     #0#9 = #73#4;
     #0#13 = #6#13;
     #0#14 = #8#2;
     #0#15 = #6#3;
     #0#16 = #73#44;
     #0#17 = #73#3;
     |GRABA 020#0n;
|FPRC;

|PROCESO Pedidos;
     |DDEFECTO #5;
     #5#0 = #104#25;
     #5#1 = #104#0;
     |LEE 000#5=;
     |SI #5#2 ! "S"; |O #5#5 ! "S"; |ERROR; |FINSI;
|FPRC;

|DEFBUCLE Pedidos;
     #104#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Pedidos, LinPedidos;
|FIN;

|PROCESO Min;
     #0#3 = " " * 20;
     #0#4 = "01.01.0000";
     #0#5 = 0;
|FPRC;

|PROCESO Max;
     #0#3 = "z" * 20;
     #0#4 = "31.12.9999";
     #0#5 = 999.999;
|FPRC;

|PROGRAMA;
     |CLS;
     |CABEZA "Creacion Ordenes Fabricacion";

     |HAZ CreaTempo; |NOME_DAT #0 Tempo; |DELINDEX #0; aTmp0 = Tempo;
     |ABRE #0;
     |ABRE #1;
     |ABRE #5;
     |ABRE #6;
     |ABRE #8;
     |BUCLE Pedidos;
     |CIERRA #8;
     |CIERRA #6;
     |CIERRA #5;
     |CIERRA #1;
     |CIERRA #0;

     |PINPA #0#0;
     |PARA; |SI; |HACIENDO;
          |ENTLINEAL #2#0, 1, 4, 19, 0, Min, Max;
          |MENU Menu;
          |SI FSalida = 0; |O FSalida = 3; |SAL; |FINSI;
          |SI FSalida = 2;
               |HAZ CheqOrdena;
               |SI FSalida = 0;
                    |HAZ CreaOrden0;
                    |SAL;
               |FINSI;
          |FINSI;
     |SIGUE;

     Tempo = aTmp0; |HAZ BoraTempo; |DELINDEX #0;
|FPRO;
