|FICHEROS;
     cafe0020 #0;
     agifa041 #1;
     cafe0022 #2;

     dsm00003 #3;
     agifa019 #19;
     agifa024 #24;
     agifa010 #10;
     agifa071 #71;
     agifa142 #142;
     agifa007;
     agifa017;
     dsm00024;
     agifa027;
     agifa065;
     agifa321;
     agifa324;
     agifa066; ||*
     dsm00113;

     agifa010@;
     agifa071@;
|FIN;

|VARIABLES;
     &enImpCliPen = 0;
     &eaCliente = "";
     &efFecha = @;
     &enModo = 0;
     &enCodigo = 0;
     &eaSerie = "";
     &aMoneda = "";
     &aDivisa = "";
     &enForma = 0;
     &enCoste = 0;
     &enSwMenu = 0;
     i = 0;
     nModo = 0;
     nCampo = 0;
     nPrecio = 0;
     nConta = 0;
     aCliente = "";
     aSerie = "";
     aAlfa = "";
     aPath = "";
     aBase = "";
     cant = 0;
     importe = 0;
     aSerieBaja = "";
     nContaBaja = 0;
     aRepre = "";
|FIN;

|PROCESO ActCli;
     |SI #10#15 ] 0;
          importe = 1;
     |SINO;
          importe = -1;
          #10#15 = -#10#15;
     |FINSI;
     cant = #10#15 < #10#5;
     cant = cant < #10#32;
     cant = cant < #10#7;
     cant = cant * importe;
     #10#15 = #10#15 * importe;

     |ABRE #24;
     #24#0 = #10#3;
     |LEE 121#24=;
     |SI FSalida = 0;
        |SI #10#43 = AN;
           #24#50 = #24#50 + (cant * enForma);    || es albaran
        |SINO;
           #24#50 = #24#50 - (cant * enForma);    || es abono
        |FINSI;
        |GRABA 020#24a;
        |LIBERA #24;
     |FINSI;
     |CIERRA #24;

     |SI #10#43 = "N";
          enImpCliPen = cant * enForma;
     |SINO;
          enImpCliPen =  -cant * enForma;
     |FINSI;
     eaCliente = #10#3;
     efFecha = #10#1;
     |HAZ AcumulaCli;

||     eaTag = "AV";  |HAZ Riesgos;
|FPRC;

|PROCESO Lineas;
     |SALVA_DATOS #agifa071@;
     |REPON_DATOS #71;
     #71#29 = #10#52;
     #71#0 = #10#0;
     |GRABA 020#71b;

     |DDEFECTO #19;
     |ABRE #19;
     #19#0 = #71#2;
     |LEE 020#19=;
     |SI #24#39 = 1; nPrecio = #19#18; |FINSI;
     |SI #24#39 = 2; nPrecio = #19#19; |FINSI;
     |SI #24#39 = 3; nPrecio = #19#20; |FINSI;
     |SI #24#39 = 4; nPrecio = #19#147; |FINSI;
     |SI #24#39 = 5; nPrecio = #19#148; |FINSI;
     |SI #24#39 = 6; nPrecio = #19#149; |FINSI;

     #71#15 = #10#3;
     #71#6 = nPrecio;
     #71#36 = nPrecio;
     |HAZ TotalLin71;

     |HAZ CalCabAgifa010;

     enForma = 1;
     |HAZ AcumulaAV;
     #71#14 = enCoste;

     |GRABA 020#71a;
     |LIBERA #71;
|FPRC;

|DEFBUCLE Lineas;
     #agifa071@#1003;
     ;
     #agifa010@#52, #agifa010@#0, 001;
     #agifa010@#52, #agifa010@#0, 999;
     ;
     NULL, Lineas;
|FIN;

|PROCESO DatosCli;
     |ABRE #24;
     #24#0 = aCliente;
     |LEE 020#24=;
     |CIERRA #24;

     |ABRE #3;
     #3#0 = aCliente;
     #3#1 = #10#84;
     |LEE 020#3=;
     |CIERRA #3;

     #10#3 = #3#0;
     #10#4 = #24#2;
     #10#29 = #3#10;
     #10#30 = #3#2;
     #10#31 = #3#3;
     #10#33 = #3#7;
     #10#62 = #3#6;
     #10#84 = #3#1;
     |SI #3#14 = "  ";
         #10#6 = #24#25;
     |SINO;
         #10#6 = #3#14;
     |FINSI;
     #10#63 = #24#15;
|FPRC;

|PROCESO Path;
     |DDEF aPath;
     aAlfa = (("00000") + #0#0) % -105;
     aPath = aBase + "fich/" + aAlfa + "/";

     |PATH_DAT #3 aPath;
     |PATH_DAT #19 aPath;
     |PATH_DAT #24 aPath;
     |PATH_DAT #10 aPath;
     |PATH_DAT #71 aPath;
     |PATH_DAT #agifa142#aPath#;
     |PATH_DAT #agifa007#aPath#;
     |PATH_DAT #agifa017#aPath#;
     |PATH_DAT #dsm00024#aPath#;
     |PATH_DAT #agifa027#aPath#;
     |PATH_DAT #agifa065#aPath#;
     |PATH_DAT #agifa321#aPath#;
     |PATH_DAT #agifa324#aPath#;
     |PATH_DAT #agifa066#aPath#;
     |PATH_DAT #dsm00113#aPath#;

     |ABRE #142; |LEE 000#142p; |CIERRA #142;
|FPRC;

|PROCESO BorraLin;
     |HAZ AcumulaAV;
     |BORRA 020#71a;
     |LIBERA #71;
|FPRC;

|PROCESO Baja;
     |HAZ Path;

     #2#0 = eaSerie;
     #2#1 = enCodigo;
     |LEE 101#2=;
     |SI FSalida = 0;
          |ABRE #10;
          #10#52 = #2#3;
          #10#0 = #2#4;
          |LEE 101#10=;
          |SI FSalida = 0;
               |SI aRepre = #10#6; |O aRepre = "00";
                    nContaBaja = #10#0;
                    aSerieBaja = #10#52;
                    enForma = -1;
                    |HAZ ActCli;
                    |BUCLELIN 0 BorraLin #10;
                    |BORRA 020#10a;
               |FINSI;
          |FINSI;
          |CIERRA #10;

          |BORRA 020#2a;
          |LIBERA #2;
     |FINSI;
|FPRC;

|PROCESO Alta;
     |HAZ Path;

     |DDEF aPath;
     aAlfa = aPath + "agifa010";
     |CARGA_DEF aAlfa, agifa010@;
     |SI FSalida ! 0; |ACABA; |FINSI;

     aAlfa = aPath + "agifa071";
     |CARGA_DEF aAlfa, agifa071@;
     |SI FSalida = 0;
          |ABRE #agifa010@;
          #agifa010@#52 = eaSerie;
          #agifa010@#0 = enCodigo;
          |LEE 020#agifa010@.=;
          |SI FSalida = 0;
               |SI aRepre = #agifa010@#6; |O aRepre = "00";
                    |ABRE #10;
                    |ABRE #71;
                    |SI nContaBaja = 0;
                         #10#52 = aSerie;
                         enSwMenu = 1;
                         |HAZ ContaAV7;
                         nConta = #10#0;
                    |SINO;
                         aSerie = aSerieBaja;
                         nConta = nContaBaja;
                    |FINSI;
                    |SALVA_DATOS #agifa010@;
                    |REPON_DATOS #10;
                    #10#52 = aSerie;
                    #10#0 = nConta;
                    |GRABA 020#10b;

                   |SI aCliente = "000000";
                         aCliente = #agifa010@#3;
                    |FINSI;
                    |HAZ DatosCli;

                    aMoneda = #10#70;
                    aDivisa = #10#68;
                    |HAZ Divisas010;

                    |HAZ LimCabAgifa010;
                    |BUCLE Lineas;
                    |GRABA 020#10a;

                    enForma = 1;
                    |HAZ ActCli;

                    |CIERRA #71;
                    |CIERRA #10;

                    #2#0 = #agifa010@#52;
                    #2#1 = #agifa010@#0;
                    #2#2 = #agifa010@#3;
                    #2#3 = #10#52;
                    #2#4 = #10#0;
                    #2#5 = #10#3;
                    #2#6 = #0#0;
                    |GRABA 020#2n;
               |FINSI;
          |FINSI;
          |CIERRA #agifa010@;
          |DESCARGA_DEF #agifa071@;
     |FINSI;
     |DESCARGA_DEF #agifa010@;
|FPRC;

|PROCESO Control;
     #1#0 = #0#0;
     |LEE 000#1=;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |PARA i = 4; |SI i [ 12; |HACIENDO i = i + 2;
          |SI #0i = eaSerie;
               nCampo = i + 1;
               aSerie = #0i;
               aCliente = #0nCampo;
               nCampo = (i - 2) / 2 + 13;
               aRepre = #0nCampo;
               |SI enModo = 1; |Y #0#1 = "S"; |HAZ Alta; |FINSI;
               |SI enModo = 2; |Y #0#2 = "S";
                    |HAZ Baja;
                    |HAZ Alta;
               |FINSI;
               |SI enModo = 3; |Y #0#1 = "S"; |HAZ Baja; |FINSI;
          |FINSI;
     |SIGUE;
|FPRC;

|DEFBUCLE Control;
     #0#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Control;
|FIN;

|PROGRAMA;
     |DBASE aBase;
     aAlfa = aBase + "fich/";
     |PATH_DAT #1 aAlfa;

     |ABRE #1;
     |ABRE #2;
     |BUCLE Control;
     |CIERRA #2;
     |CIERRA #1;
|FPRO;
