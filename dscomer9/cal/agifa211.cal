|FICHEROS;
     agifa071 #0;        || Lineas Adjudicacion
     agifa010 #1;        || Cabecera Adjudicacion
     agifa104 #2;        || Cabecera Pedidos
     agifa073 #3;        || Lineas Pedidos
     agifa019 #4;        || Articulos
     agifa017 #5;        || Almacen
     agifa024 #6;        || Clientes
     agifa112 #9;        || Proveedores
     agifa215 #20;       || Temporal seleccion Articulos
     agifa007 #21;       || Series.
     dsm00024 #24;
     agifa065 #65;
     dsw00066 #66;
     tempo081 #81;
     agifa321 #15;       || DIV - Parametros
     agifa324 #15;       || DIVISAS
     agifa142 #42;
     dsm00004 #904;
     dsm00005 #905;
     dsm00010 #910;
     dsw00022 #922;      || Tmp Adj por Articulos Elemento
     dsm00046 #946;
     dsm00047 #947;
     dsm00234 #234;
     dsm00235 #235;
     dsm00246 #40;       ||Control Riesgo Por Usuarios.
     dsm00247 #41;       ||Pantalla Informe Riesgo.
     dsm00248 #43;
     dsm00020 #200;
     agifa553 #553;
     agis0002 #1000;
     agifa029 #29;
     dsm00238 #238;
     dsw00083 #83; || Ordenacion Art/Alma/Part
     dsm00279 #279;
     agit0002 #300;
     dsm00113;

     refere1@ #101;
     refere2@ #102;
     refere3@ #103;
     gestral@;
     tagm0056@;
     mecano@;
     guiw0002@;
     tlfm0001@;
     tlfm0019@;
     tlfm0023@;
|FIN;

|VARIABLES;
     &eaTmpEvaSer = "";
     aTipo = "";
     nPen = 0;
     nLinAct = 0;
     &eaFicPdte = "";
     &eaCongeCarVar = "";
     aGuarda = "";
     nEvaConTalla = 0;
     nContaUni = 0;
     nSwTalla = 0;
     nAncho2 = 0;
     nAncho4 = 0;
     &eaTmpAV816 = "";
     nUni1Ant = 0;
     nUni2Ant = 0;
     &enPedido = 0;
     &eaSerAlb = "";
     &enNumAlb = 0;
     &enLinAlb = 0;
     aParGestral = "";
     nSwOrts = 0;
     aPartiAnt = "";
     nHay = 0;
     nSwPtec = 0;
     nSwGestral = 0;
     &eaSwCtrlStockReseCoimasa = "";
     &enReservadasPrio = 0;
     &enCoimaPrio = 0;
     &enCoimaPrioPed = 0;
     &enModoCoimasa = 0;
     &enFormaCoimasa = 0;


     &eaArtCoimasa = "";
     &eaCliCoimasa = "";
     &eaRepCoimasa = "";
     nSwAdjInforpor = 0;
     nSirve = 0;
     mensaje5       = "0000 Albaran para Exportacion. Tipo IVA = 0 !!!";
     &enBultos = 0;
     aDef = "";
     nEsta = 0;
     nTotUni = 0;
     &eaTmpGui = "";
     nSwPasa = 0;
     nPdte = 0;
     aRese = "";
     &enMenuPrimi = 0;
     &enMenuVallc = 0;
     nCamUni = 0; nCamAlm = 0; aCamLote = ""; aCamArti = "";
     {24}aCampo = "";
     nDto1 = 0;
     nDto2 = 0;
     nLinCanonSC = 0;
     nTallerBorLin = 0;
     nSwTaller = 0;
     nUniVarAnt = 0;
     aConte = "";
     nPreDtoAnt = 0;
     nUni = 0;
     &enMecaDeOrden = 0;
     &enModoCab210 = 0;
     nTagLinPedPos = 0;
     nTagDocPos = 0;
     nTagLinPos = 0;
     nTagIncPos = 0;
     aTagDesPos = "";
     nTagLinOrgPos = 0;
     nSali = 0;
     aPath = "";
     aTmp83 = "";
     aPartida = "";
     nUniAsig = 0;
     nUnidades = 0;
     c13 = 0;
     c44 = 0;
     nSwTagCamPed = 0;
     nSwTagloma = 0;
     aArti = "";
     nUni1 = 0;
     nUni2 = 0;
     nFactor = 0;
     nSal = 0;
     aModi = "";
     &c_clien       = "";
     &c_artic       = "";
     &c_serie       = "";
     &entrada       = 0;
     &enLinAuto = 0;
     &uni_dt = 0;   || Unidades
     &uni_dt2 = 0;   || Unidades2
     &fed_dt = @;   || Fecha....
     &art_dt = "";  || Articulo.
     &cli_dt = "";  || Cliente..
     &fam_dt = "";  || Familia.
     &iva_dt = 0;   || Tipo Iva.
     &dtos_2 = 0;   || Descuento 2.
     &dto_pt = 0;   || Descuento Ptas.
     &dtos_1 = 0;   || Descuento 1.
     &pvp_ve = 0;   || Precio Venta.
     &tarifa = 0;   || Tarifa Cliente.
     &quedto = 0;   || 1=cli./art, 2=cli./familia, 3=cli./subfam.
     &gru_dt = "";  || Grupo Cliente.
     &nPromo = 0;
     &enMensaje = 0;
     &aParam    = "";

     &enDto = 0;
     &enNumero = 0;
     &enEsCto = 0;
     nImporDescue1 = 0;
     nImporDescue2 = 0;
     nImporDescue3 = 0;
     nImporMoneda1 = 0;
     nImporMoneda2 = 0;
     nBrutoMoneda1 = 0;
     nBrutoMoneda2 = 0;
     &enUniTagRes = 0;
     &enCliAdj = "";
     &enSwMenu = 0;
     nSwSirveArt = 0;
     nSwBsegui = 0;
     nLinV          = 0;
     &enUniKit      = 0;
     nSwServida     = 0;
     nModo          = 0;
     &nDispoKit     = 0;
     &Nopregunta    = 0;
     &nPed_baja     = 0;
     &aSer_baja     = "";
     &nLin_baja     = 0;
     articulo = "";
     &enDescuento1 = 0;
     &enDescuento2 = 0;
     &eaTComision = "";
     &enComision = 0;
     &eaCliPlb = "";
     &enObraPlb = 0;
     &eaTipoPlb = "";
     &eaArticuloHor = "";
     nGuardaPrecio = 0;
     nObra = 0;
     aTipoEmp = "";
     aSerie = "";
     aLetra = "";

     nRiePed = 0; DLinea = 0; HLinea = 0;

     nCalc = 0;
     nImpAd = 0;

     nEsKit         = 0;
     nConAu         = 0;
     &nMasRies      = 0;
     nTries         = 0;
     nAudito        = 0;
     aUs            = "";
     &Tempo         = "";
     aTempo81       = "";
     &eaTempo020    = "";
     &eaTempo922    = "";
     nDesprecia     = 0;
     aMensa         = "";
     aObs           = "";
     &eaTag         = "";
     nMult          = 0;
     &nImpo         = 0;
     mes            = 0;
     &enTipo        = 0;
     &aSerAntes     = "";
     &nNumAntes     = 0;
     aPtec          = "";
     nPtec          = 0;
     nPrecio        = 0;
     nLin           = 0;
     nNume          = 0;
     nForma         = 0;
     nCampo         = 0;
     aAlfa          = "";
     nTecla         = 0;

     &ser_alb        = "";
     &num_alb        = 0;
     &enLineaAlb     = 0;
     &enSwPanta      = 1;
     &enPedCab       = 0;
     &ser_ped        = "";
     &num_ped        = 0;
     &lin_ped        = 0;

     &nDeci_Base     = 0;   || Decimales en Totales de la moneda base
     &nDeci_PreBase  = 0;   || Decimales en el Precio en moneda base
     &nDeci_BaseMx   = 0;   || Decimales en Totales de la moneda base (Maxima precision)
     &nDeci_PreBaseMx= 0;   || Decimales en el Precio en moneda base (Maxima precision)
     &nDeci_Div      = 0;   || Decimales en Totales de la divisa
     &nDeci_PreDiv   = 0;   || Decimales en el Precio en divisa
     &nDeci_TotVis   = 0;   || Decimales en Totales visibles (el de la moneda de trabajo)
     &nDeci_TotNoVis = 0;   || Decimales en Totales no visibles (el de la otra moneda)
     &nDeci_PreVis   = 0;   || Decimales en el Precio visual. (lineas)
     &nDeci_ImpVis   = 0;   || Decimales en el Importe visual. (lineas)
     &nDeci_BaseMxP  = 0;   || Decimales en Totales de la moneda base (Maxima precision)
     &nDeci_PreBasMxP= 0;   || Decimales en el Precio en moneda base (Maxima precision)
     &nDeci_DivP     = 0;   || Decimales en Totales de la divisa
     &nDeci_PreDivP  = 0;   || Decimales en el Precio en divisa
     &nDeci_TotVisP  = 0;   || Decimales en Totales visibles (el de la moneda de trabajo)
     &nDeci_TotNoVisP= 0;   || Decimales en Totales no visibles (el de la otra moneda)
     &nDeci_PreVisP  = 0;   || Decimales en el Precio visual. (lineas)
     &nDeci_ImpVisP  = 0;   || Decimales en el Importe visual. (lineas)
     tecla      = "";
     &ac_divisa = ""; ||
     mensa      = ""; || Linea de visualizacion
     &pintado   = 0;|| Controla el pintado de mensa para que solo lo haga 1 vez
     titdiv = "";   || Encabezado de precio e imp. con la divisa "Imp.Tot(USD)"
     aprograma = "";
     vcontrol       = "";
     &Envase    = "";
     &Unidades1 = 0;
     &Unidades2 = 0;
     &VArticulo = "";
     &qAbono    = "";

     sw_adjf1       = 0;
     asto           = 0;
     tuni           = 0;
     a              = 0;
     b              = 0;
     operacion      = "";
     operainte      = "";
     inkey          = 0;
     &act_ent       = "N";
     &correcto      = "N";
     &fichero       = "";
     &cliente       = "";
     &serv_art      = "N";
     &programa      = "agifa210";
     servir         = "N";
     fmes           = "";
     fiac           = "  ";
     guarda         = "  ";
     relleno        = "                                       ";
     aponer         = "  ";
     mensaje        = "";
     &n_dec         = 0;
     &n_pre         = 0;
     &sw_modo       = 0;
     modo           = 0;
     i              = 0;
     linea          = 0;
     cantidad       = 0;
     importe        = 0;
     &serie         = "";
     &pedido        = 0;
     &lineap        = 0;
     &codigo        = "";
     &descrip       = "";
     &unid          = 0;
     &Cliente = "";
     &SPedido = "";
     &NPedido = 0;
     &PPedido = "";
     &FPedido = @;
     &TPedido = 0;
     &BAdela  = 0;
     &TipoCta = "A";
     &ser           = "";
     &doc           = 0;
     abono          = 1;

     l1_inf         = "";
     l1_sup         = "";
     &ser_ped_inf   = ""; ||Serie (inf. y sup.) del pedido que pasaremos
     &ser_ped_sup   = ""; ||al defbucle de agit0001
     fich           = "";

     aDespreCanon = "N";
     aDespreciar    = "";
     aPedCompleto   = "N";
     nPendiente     = 0;
     nPendiente2    = 0;
     nPorArticulo   = 0;
     nSoloEstas1    = 0;
     nSoloEstas2    = 0;
     &nRieUtili     = 0;
     &nRieTotal     = 0;

     &qArti         = "";
     &qUnid         = 0;

     importeD      = 0;
     nImpDiv        = 0;
     nSw = 0;
     mensaje3 = "";
     prevul = 0;
     precom = 0;
     prepcm = 0;
     nHayPed = 0;
     aPedi = "";
|FIN;

|INCLUYE i_varart;

|PROCESO DefSer211; |TIPO 7;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 1;
          #0#31 = #0#29;
          |SI #agifa142#185 = "S"; #0#31 = #agifa142#186; |FINSI;
          |SI nNumAntes ! 0;
               #0#31 = aSerAntes; |PINTA #0#31;
               #0#12 = nNumAntes; |PINTA #0#12;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO licogea; |TIPO 0;
     sw_adjf1 = 0;
     aPedCompleto = "N";
     modo = (FEntrada / 100) ! 0;
     articulo = #0#2;

     |SI modo = 1;
          |C_M #0#12 , 1 , "S";
          |C_M #0#21 , 1 , "S";
          |C_M #0#31 , 1 , "S";
          |SI #0#12 = 0;
               |C_M #0#2  , 1 , "S";
               |C_M #0#3  , 1 , "S";
               |C_M #0#4  , 1 , "S";
               |C_M #0#10 , 1 , "S";
               |C_M #0#27 , 1 , "S";
               |C_M #0#11 , 1 , "S";
               |C_M #0#5  , 1 , "S";
               |SI #1#70 = "B";
                    |C_M #0#6  , 1 , "S";
               |SINO;
                    |C_M #0#36 , 1 , "S";
               |FINSI;
               |C_M #0#8  , 1 , "S";
               |C_M #0#33 , 1 , "S";
          |SINO;
               |C_M #0#2  , 1 , "N";
               |C_M #0#3  , 1 , "N";
               |C_M #0#4  , 1 , "N";
               |C_M #0#10 , 1 , "N";
               |C_M #0#27 , 1 , "N";
               |C_M #0#11 , 1 , "N";
               |C_M #0#5  , 1 , "N";
               |SI #1#70 = "B";
                    |C_M #0#6  , 1 , "N";
               |SINO;
                    |C_M #0#36 , 1 , "N";
               |FINSI;
               |C_M #0#8  , 1 , "N";
               |C_M #0#33 , 1 , "N";
          |FINSI;
          |C_M #0#28 , 1 , "N";

     |SINO;
          |C_M #0#12 , 1 , "N";
          |C_M #0#21 , 1 , "N";
          |C_M #0#31 , 1 , "N";
          |SI #0#12 = 0;
               |C_M #0#2  , 1 , "S";
          ||     |C_M #0#3  , 1 , "S";
          |SINO;
               |C_M #0#2  , 1 , "N";
          ||     |C_M #0#3  , 1 , "N";
          |FINSI;
          |C_M #0#3  , 1 , "S";
          |C_M #0#4  , 1 , "S";
          |SI #0#2 = "                    ";
               |C_M #0#5  , 1 , "N";
               |SI #1#70 = "B";
                 |C_M #0#6  , 1 , "N";
               |SINO;
                 |C_M #0#36 , 1 , "N";
               |FINSI;
               |C_M #0#8  , 1 , "N";
               |C_M #0#10 , 1 , "N";
               |C_M #0#11 , 1 , "N";
               |C_M #0#27 , 1 , "N";
               |C_M #0#28 , 1 , "N";
               |C_M #0#33 , 1 , "N";
          |SINO;
               |C_M #0#5  , 1 , "S";
               |SI #1#70 = "B";
                 |C_M #0#6  , 1 , "S";
               |SINO;
                 |C_M #0#36 , 1 , "S";
               |FINSI;
               |C_M #0#8  , 1 , "S";
               |C_M #0#10 , 1 , "S";
               |C_M #0#11 , 1 , "S";
               |C_M #0#27 , 1 , "S";
               |C_M #0#28 , 1 , "S";
               |C_M #0#33 , 1 , "S";
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO IncluyeACtas;
   nRiePed = nRiePed + #agis0002#9;
|FPRC;

|DEFBUCLE IncluyeACtas;
#agis0002#1;
;
"P", #agifa071#31, #agifa071#12, DLinea;
"P", #agifa071#31, #agifa071#12, HLinea;
;
NULL,IncluyeACtas;
|FIN;

|PROCESO CalTotPediIVA;
     |ABRE #dsm00113;
     #dsm00113#0 = #agifa104#4;
     #dsm00113#1 = #agifa073#14;
     |LEE 000#dsm00113.=;
     |SI FSalida = 0;
        nCalc = #agifa073#11 % #dsm00113#3;
        |SI #agifa024#47 = "S";
           nCalc = nCalc + (#agifa073#11 % #dsm00113#4);
        |FINSI;
     |SINO;
        enTiva = #agifa073#14;
        efFiva = #agifa104#1;
        |HAZ SacaIVA;

        nCalc = #agifa073#11 % enIva;
        |SI #agifa024#47 = "S";
              nCalc = nCalc + (#agifa073#11 % enRec);
        |FINSI;

     |FINSI;
     |CIERRA #dsm00113;

     nImpo = nImpo + (#agifa073#11 + nCalc);
|FPRC;

|DEFBUCLE CalTotPediIVA;
     #3#1;
     ;
     #0#31, #0#12, DLinea;
     #0#31, #0#12, HLinea;
     ;
     NULL, CalTotPediIVA;
|FIN;

|PROCESO liadju; |TIPO 0;
     nSwServida = 0;
     |SI FSalida = 2; |ACABA; |FINSI;
     |SI modo ! 1; |Y modo ! -1;  |ACABA;  |FINSI;
     |SI correcto ! "N";          |ACABA;  |FINSI;
     |SI FSalida = 12;
          pedido = #0#12;
          cliente = #1#3;
          ser_ped_inf = #0#31;
          ser_ped_sup = #0#31;
          lineap = 0;
          enTipo = 1;
          |SUB_EJECUTA_NP "agit0002";
          |SI pedido = 0;
               |ERROR;
          |SINO;
               enPedCab = pedido;
               |PTEC 807; |ACABA;
          |FINSI;
/*
          |SI lineap = 0;
               |ERROR; |ACABA;
          |SINO;
               #0#31 = serie;
               #0#12 = pedido;
               #0#21 = lineap;
               #0#2  = codigo;
               #0#4  = descrip;
               #0#5  = unid;
               |PINDA #0#0;
               |ATRI I;
          |FINSI;
*/
     |FINSI;
     ||컴컴컴컴컴컴컴컴컴컴컴횺odulo
     |HAZ EsFeldo;
     |SI FSalida = 0;
          |HAZ FeldoUnPed;
          aAlfa = #0#31 + #0#12;
          |SI nHayPed = 1; |Y aAlfa ! aPedi;
               |MENAV "0000No se puede adjudicar a mas de un pedido con portes proforma...";
               |ERROR; |ACABA;
          |FINSI;
          |SI nHayPed = 2;
               |MENAV "0000No se puede adjudicar a mas de un pedido con portes proforma...";
               |ERROR; |ACABA;
          |FINSI;
     |FINSI;
     |HAZ EsDiagram;
     |SI FSalida = 0;
          |HAZ DiagObsAdj;
     |FINSI;
     ||컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
     |SI #0#21 = 0;
          nNumAntes = 0;
     |SINO;
          aSerAntes = #0#31;
          nNumAntes = #0#12;
     |FINSI;

     nPorArticulo = 0;

     |SI #0#21 = -1;     #0#21 = 0;     nPorArticulo = 1;   |FINSI;

     |HAZ EsEvaristo;
     |SI FSalida ! 0;         ||Esto solo para la estandar
          |ABRE #6;
          #6#0 = #1#3;
          |LEE 001#6=;
          |SI FSalida = 0; |Y #6#157 = "S";
              |AVISO;
              |MENSA "0000ESTE CLIENTE TIENE RETENIDOS LOS PEDIDOS";
              |CONFI "2400NCliente con pedidos retenidos. Aun asi desea Servir : ";
              |SI FSalida ! 0;
                  |CIERRA #6;
                  |ERROR;
                  |ACABA;
              |FINSI;
          |FINSI;
          |CIERRA #6;
     |FINSI;

     |ABRE #2;
     #2#25 = #0#31;
     #2#0 = #0#12;
     |LEE 001#2=;                       || Leo el pedido
     |SI FSalida ! 0; |CIERRA #2;  |ACABA;  |FINSI;
     |CIERRA #2;

     |ABRE #910; |LEE 000#910p; |CIERRA #910;

     |HAZ EsTagloma;
     |SI FSalida = 0;
          |HAZ TagEsLinPostP;
          |SI FSalida = 0;
               |MENAV "0000Linea de incremento de postformado";
               |ERROR; |ACABA;
          |FINSI;
     |FINSI;

     |SI #2#34 = "S";         || este campo ya no es ABONO S/N
         abono = -1;          ||/no obstante, se deja asi para
     |SINO;                   ||/compatibilizar con pedidos importados
         abono = 1;           ||/de versiones 7 o anteriores, en version 8
     |FINSI;                  ||/o superior nunca tendra el valor "S"
     servir = "N";

     mensaje = "0000Pedido Servido Completamente...";
     |SI #0#21 = 0;
         |ABRE #4;
         |BUCLELIN 2 miraserv #2;
         |CIERRA #4;
         aPedCompleto = "S";
     |SINO;                        || Solo una linea
         aPedCompleto = "N";
         |ABRE #3;
         #3#28 = #2#25;
         #3#0  = #2#0;
         #3#1  = #0#21;
         |LEE 001#3=;
         |SI FSalida = 0;
               |HAZ EsCoimasa;
               |SI FSalida = 0;
                    eaArtCoimasa = #agifa073#2;
                    eaCliCoimasa = #agifa104#4;
                    eaRepCoimasa = #agifa104#7;
                    |HAZ CtrlRepCoimasa;
               |FINSI;

               |HAZ EsTaller;
               |SI FSalida = 0; |Y #3#55 = -1;
                    |MENAV "0000Linea de canon, adjudique la linea principal";
                    |ERROR; |ACABA;
               |FINSI;
               efFec = #1#1;
               enAlma = #3#3;
               |HAZ MiraHisL;
               |SI enErrHis ! 0;
                    |ERROR;
                    |ACABA;
               |FINSI;
               |SI #3#15 = "S";  || (7)
                    mensaje = "0000La linea de Pedido esta Bloqueada";
               |SINO;
                    |SI #3#2 = "                    ";
                        servir = "S";
                        mensaje = "";
                    |FINSI;

                    |ABRE #4;
                    #4#0 = #3#2;
                    |LEE 000#4=;
                    |CIERRA #4;
                    nPendiente = #3#5 - #3#43;
                    nPendiente2 = #3#44 - #3#49;
                    |SI #4#179 = "N"; |O #agifa142#117 = "N";||Sin Doble Stock
                         |SI nPendiente ! 0;
                              servir = "S";
                              mensaje = "";
                         |FINSI;
                    |SINO;
                         |SI #agifa142#224 = "B";
                              |SI nPendiente ! 0; |O nPendiente2 ! 0;
                                   servir = "S";
                                   mensaje = "";
                              |FINSI;
                         |SINO;
                              |SI nPendiente ! 0; |Y nPendiente2 ! 0;
                                   servir = "S";
                                   mensaje = "";
                              |FINSI;
                         |FINSI;
                    |FINSI;
               |FINSI;
               |SI servir = "S"; |HAZ CtrlStock; |FINSI;
          |SINO;
               mensaje = "0000La linea de Pedido no Existe";
          |FINSI;
          |CIERRA #3;

          |HAZ EsMecanogra;
          |SI FSalida = 0; |Y servir = "S";
               |HAZ MecaPedFinaliza;
               |SI FSalida ! 0;
                    servir = "N";
                    mensaje = "0000La linea de pedido no esta finalizada";
               |FINSI;
               |SI servir = "S";
                    |HAZ MecaAdjudicable;
                    |SI FSalida ! 0;
                         servir = "N";
                         mensaje = "0000La linea es de un producto de fabricacion";
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;

     |SI servir = "S";
          eaMuestra = "S";
          eaSerie = #agifa071#29; eaTag = "AV";  |HAZ SacaRiesgo;
          nRiePed = 0;
          |SI #agifa071#21 = 0;
             DLinea = 001; HLinea = 999;
          |SINO;
             DLinea = #agifa071#21; HLinea = #agifa071#21;
          |FINSI;
          |BUCLE IncluyeACtas;

          nImpo = 0;
          |SALVA_FICHA #3;
          |BUCLE CalTotPediIVA;
          |REPON_FICHA #3;

          |SI eaRieSuma = "S"; nRieUtili = nRieUtili + nImpo + #1#67 - #1#61 - nRiePed; |FINSI;

          |SI #1#43 = "N"; |Y #agifa142#6 = "S";
               eaDocu = "L";
               eaTipo = "A";
               enImpoDoc = #1#67 + nImpo;
               eaDesdeLinea = "S";
               |HAZ ControlRiesgo;
               eaDesdeLinea = "N";
               |SI enErrRie = 1; |ERROR; |ACABA; |FINSI;
               |SI enAudito = 0;
                    |ABRE #43;
                    |LEE 000#43u;
                    |SI FSalida = 0;
                         nConAu = #43#0 + 1;
                    |SINO;
                         nConAu = 1;
                    |FINSI;
                    |DDEFECTO #43;
                    #43#0 = nConAu;          || contador
                    #43#12 = "ALBARAN";      || tipo documento
                    #43#1 = #1#52;           || serie
                    #43#2 = #1#0;            || documento
                    #43#3 = #1#1;            || fecha
                    #43#4 = #1#3;            || cliente
                    #43#5 = #1#4;            || nombre
                    #43#6 = aUs;             || usuario
                    #43#7 = nRieTotal;       || riesto concedido
                    #43#8 = nRieUtili;       || riesgo actual
                    #43#9 = #41#2;           || % exceso
                    #43#10= #41#3;           || importe % exceso
                    #43#11= #41#4;           || limite exceso
                    |GRABA 020#43n;
                    |CIERRA #43;
               |FINSI;
          |FINSI;
     |FINSI;

     |SI servir = "N";
          |ERROR; |ACABA;
     |FINSI;

     |SALVA_DATOS #2;     || Guarda los datos por si el modulo los cambia
     |HAZ EsTagloma;
     |SI FSalida = 0;
          eaAlfa = #1#52;
          |HAZ TagloDefFP;
          |SI eaAlfa ! "";
               #1#8 = eaAlfa; #2#9 = eaAlfa;
          |FINSI;
          |SI eaQuitaDto = "S";
               #1#5 = 0; #1#32 = 0; #1#7 = 0;
               #2#5 = 0; #2#17 = 0; #2#6 = 0;
          |FINSI;
     |FINSI;
     |HAZ EsGestral;
     |SI FSalida = 0;
          eaAlfa = #1#52;
          |HAZ GestrDefFP;
          |SI eaAlfa ! "";
               #1#8 = eaAlfa; #2#9 = eaAlfa;
          |FINSI;
          |SI eaQuitaDto = "S";
               #1#5 = 0; #1#32 = 0; #1#7 = 0;
               #2#5 = 0; #2#17 = 0; #2#6 = 0;
          |FINSI;
     |FINSI;

     |SI sw_modo = 1;
          sw_modo = 0;
          #1#5 = #2#5;         ||Dto
          #1#6 = #2#7; |PINTA #1#6;        ||Rep.
          #1#7 = #2#6;         ||P.P
          #1#8 = #2#9; |PINTA #1#8;         ||Forma Pago
          #1#32 = #2#17;       ||Dto Acumulado
          #1#64 = #2#61;       ||Porte P/D
          #1#63 = #2#64;
          |SI act_ent = "S";
               #1#29 = #2#19;       ||Entregar a
               #1#30 = #2#14;       ||Dir. Ent.
               #1#31 = #2#20;       ||Pob. Ent.
               #1#62 = #2#59;       ||Cod.Pos
               #1#33 = #2#21;       ||Pro. Ent.
               #1#83 = #2#51; |PINTA #1#83;     || Curso
               #1#97 = #2#15;      || Observ
               #1#84 = #2#57; |PINTA #1#84;     ||Dir
          |FINSI;
          |HAZ OrtsAlbRep2;
     |SINO;
          |SI #1#3 ! #2#4; |O #1#5 ! #2#5;
                    |O #1#6 ! #2#7; |O #1#7 ! #2#6;
                    |O #1#8 ! #2#9; |O #1#32 ! #2#17;
                    |O #1#63 ! #2#64;
             |MENAV "0000Los datos del Albaran no se Corresponden con el Pedido";
             |REPON_DATOS #2;
             |ERROR; |ACABA;
          |FINSI;
     |FINSI;
     |REPON_DATOS #2;

     linea = #0#1 - 1;
     |SI #2#10 = "S";
          |AVISO;
          |CONFI "2400NAtencion este pedido esta bloqueado, Continuar : ";
          |SI FSalida ! 0;
               |ERROR; |ACABA;
          |FINSI;
     |FINSI;

     |HAZ graba_lin;
     |SI nSwPtec ! 0; |ACABA; |FINSI;

     |PTEC 816;|| antes estaba antes del graba_lin,
     |PTEC 812;|| cambiado para inforalba porque pide la matricula

     |SI nSwServida = 0;
          |ERROR;
     |SINO;
          |SI aPedCompleto = "S";
               |HAZ ChampiEmarPorte;
               |ERROR;
               |PTEC 807;
          |SINO;
               aAlfa = #0#2; |QBF aAlfa;
               |SI aAlfa ! ""; |PTEC 806; |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO CtrlStock;
     aRese = #3#22;
     |HAZ EsCoimasa;
     |SI FSalida = 0; aRese = "N"; |FINSI;    ||para que chequee el stock

     |SI aRese = "S";
          |ACABA;
     |FINSI;

     |SI ctrl_st = "S"; |O ctrl_st = "X";
          |ABRE #5;
          #5#0 = #3#2;
          #5#1 = #3#3;
          |LEE 001#5=;
          |SI FSalida ! 0; |DDEFECTO #5; |FINSI;
          |CIERRA #5;
          nPendiente = #3#5 - #3#43;
          nPendiente2 = #3#44 - #3#49;
          nSw = 0;

          |HAZ EsCoimasa;
          |SI FSalida = 0;
               eaSwCtrlStockReseCoimasa = "";
               enReservadasPrio = 0;
               |HAZ StockReservadoCoimasa;

               |SI enCoimaPrio ! enCoimaPrioPed;
                 |SI eaSwCtrlStockReseCoimasa = "S"; |O eaSwCtrlStockReseCoimasa = "X";
                    |SI enReservadasPrio ! 0;
                         #5#5 = #5#5 - enReservadasPrio;
                         eaArticulo = #3#2;
                         |HAZ EsKit;
                         |SI FSalida = 0;
                              |HAZ DispoKit;
                              nSw = nDispoKit;
                         |SINO;
                              |SI #4#179 = "N"; |O #agifa142#117 = "N";||Sin Doble Stock
                                   |SI #5#5 < nPendiente;
                                        nSw = 1;
                                   |FINSI;
                              |SINO;
                                   |SI #5#5 < nPendiente; |O #5#47 < nPendiente2;
                                        nSw = 1;
                                   |FINSI;
                              |FINSI;
                         |FINSI;

                         |SI nSw = 1;
                              servir = "N";
                              mensaje = "0000No hay stock suficiente. existe stock reservado " + #3#2 ;
                              |SI eaSwCtrlStockReseCoimasa = "S";
                                   |MENAV mensaje;
                                   |CONFI "0000NDesea continuar S/N:";
                                   |SI FSalida = 0; servir = "S"; |FINSI;
                              |SINO;
                                   mensaje = "0000No hay stock suficiente. existe stock reservado " + #3#2 + ".  Servido : " + #5#5;
                                   |MENAV mensaje;
                              |FINSI;
                         |FINSI;
                         |ACABA;
                    |FINSI;
                  |FINSI;
               |FINSI;
          |FINSI;

          eaArticulo = #3#2;
          |HAZ EsKit;
          |SI FSalida = 0;
               |HAZ DispoKit;
               nSw = nDispoKit;
          |SINO;
               |SI #910#52 = "S";
                    nLinV = #0#21;
                    |HAZ StockEleme;
                    |ACABA;
               |SINO;
                    |SI #4#179 = "N"; |O #agifa142#117 = "N";||Sin Doble Stock
                         |SI #5#5 < nPendiente;
                              nSw = 1;
                         |FINSI;
                    |SINO;
                         |SI #5#5 < nPendiente; |O #5#47 < nPendiente2;
                              nSw = 1;
                         |FINSI;
                    |FINSI;
               |FINSI;
          |FINSI;

          |SI nSw = 1;
               servir = "N";
               mensaje = "0000Superado Stock Disponible " + #3#2 ;
               |SI ctrl_st = "S";
                    |MENAV mensaje;
                    servir = "S";
               |FINSI;
               |SI ctrl_st = "X";
                   |SI #5#5 [ 0;  |Y #5#47 [ 0;
                       servir = "N";
                       mensaje = "0000 Stock disponible 0 " + #3#2;
                   |SINO;
                       servir = "S";
                       mensaje = "0000Superado Stock Disponible " + #3#2 + ".  Servido : " + #5#5;
                       |MENAV mensaje;
                       nSoloEstas1 = #5#5;
                       nSoloEstas2 = #5#47;
                   |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO StockEleme;
     nSoloEstas1 = 0;
     nSoloEstas2 = 0;

     |ABRE #904;
     |ABRE #905;
     #905#0 = "PV";
     #905#1 = #0#31;
     #905#2 = #0#12;
     #905#3 = nLinV;
     #905#4 = "";
     |LEE 000#905];
     |PARA; |SI FSalida = 0; |Y #905#0 = "PV"; |Y #905#1 = #0#31;
               |Y #905#2 = #0#12; |Y #905#3 = nLinV; |HACIENDO;
          |DDEFECTO #904;
          #904#0 = #3#2;
          #904#1 = #3#3;
          #904#2 = #905#4;
          |LEE 000#904=;
          nPen  = #905#11 - #905#12;
          |SI #904#12 < nPen;
               mensaje = "0000Superado Stock Disponible" + &13;
               mensaje = mensaje + #3#2 + " " + #905#4;
               |SI ctrl_st = "S";
                    |MENAV mensaje;
                    servir = "S";
                    nSoloEstas1 = nSoloEstas1 + nPen;
               |FINSI;
               |SI ctrl_st = "X";
                   |SI #904#12 [ 0;
                       mensaje = "0000Superado Stock Disponible" + &13;
                       mensaje = mensaje + #3#2 + " " + #905#4;
                   |SINO;
                       servir = "S";
                       mensaje = "0000Superado Stock Disponible" + &13;
                       mensaje = mensaje + #3#2 + " " + #905#4;
                       mensaje = mensaje + &13 + "Servido: " + #904#12;
                       |MENAV mensaje;
                       nSoloEstas1 = nSoloEstas1 + #904#12;
                   |FINSI;
               |FINSI;
          |SINO;
              nSoloEstas1 = nSoloEstas1 + nPen;
          |FINSI;
          |LEE 000#905s;
     |SIGUE;
     |CIERRA #904;
     |CIERRA #905;

     |SI nSoloEstas1 = 0;
          servir = "N";
     |SINO;
          servir = "S";
     |FINSI;
|FPRC;

|PROCESO GrabaCompoN;
     nPen =  #905#11 - #905#12;
     |SI #910#52 = "S";
          #904#0 = #3#2;
          #904#1 = #3#3;
          #904#2 = #905#4;
          |LEE 000#904=;
          nPen  = #905#11 - #905#12;
          |SI #904#12 < nPen;
               |SI ctrl_st = "X";
                    nPen = #904#12;
               |FINSI;
          |FINSI;
     |FINSI;

     |SALVA_DATOS #905;

     #905#0  = "AV";
     #905#1  = #0#29;
     #905#2  = #0#0;
     #905#3  = #0#1;
     #905#6  = nPen;    ||  #905#6 - #905#12;
     #905#8  = #905#6 * #905#7;
     #905#9  = 0;
     #905#11 = 0;
     #905#12 = 0;
     |GRABA 020#905n;
     |LIBERA #905;

     |REPON_DATOS #905;
     |LEE 040#905=;

     eaTipo        = "AV";
     eaSerie       = #0#29;
     enCodigo      = #0#0;
     enLinea       = #0#1;
     efFecha       = #1#1;
     eaArticulo    = #0#2;
     enAlmacen     = #0#3;
     eaComponente  = #905#4;
     enUnidades    = #0#5;
     enTBruto      = #0#7;
     eaAbono       = #1#43;
     enTarifa      = #6#39;
     eaSeriePedido = #0#31;
     enCodigPedido = #0#12;
     enLineaPedido = #0#21;
     eaEsNecesario = "S";
     enCamBas      = #1#69;
     eaMoneda      = #1#70;
     enCamDiv      = #1#74;
     |SUB_EJECUTA_NP "dsz00002;AVC";
|FPRC;

|DEFBUCLE dsm00005N;
     #905#1;
     ;
     "PV", #0#31, #0#12, nLinV, "      ";
     "PV", #0#31, #0#12, nLinV, "zzzzzz";
     ;
     NULL, GrabaCompoN;
|FIN;

|PROCESO ActuaResto;
     #1#41 = #1#41 + nForma;
     ||nForma = 0 +. 1;  ahora se llama con nForma cargado    6/2/2013

     |ABRE #4;
     |ABRE #6;
     |ABRE #9;

     |HAZ lee_arti;
     |HAZ lee_clien;
     importe = ((((#0#9 < #1#5) < #1#32) < #1#7));
     #6#50 = #6#50 + (importe * nForma);
     |GRABA 021#6a;

     |SI #0#12 ! 0; |O #0#31 ! "     ";
         |HAZ AlPedido;
     |FINSI;

     #0#23 = #3#5 * abono;
     #0#24 = #3#5 - #3#43;

     |CIERRA #6;
     |CIERRA #4;
     |CIERRA #9;

     |HAZ actua_cabe;

     enImpCliPen = importe * nForma;
     eaCliente = #1#3;
     efFecha = #1#1;
     |HAZ AcumulaCli;
|FPRC;

|PROCESO dsm00046;
     |DDEFECTO #947;
     #947#0 = #0#29;
     #947#1 = #0#0;
     #947#2 = #0#1;
     #947#3 = #946#3;
     #947#4 = #946#4;
     #947#5 = #946#5;
     #947#6 = #946#6;
     #947#7 = #946#7;
     #947#8 = #946#8;
     #947#9 = #946#9;
     #947#10 = #946#10;
     #947#11 = #946#11;
     #947#12 = #946#12;
     |GRABA 020#947n;
|FPRC;

|DEFBUCLE dsm00046;
     #946#1;
     ;
     #3#28, #3#0, #3#1, 001;
     #3#28, #3#0, #3#1, 999;
     ;
     NULL, dsm00046;
|FIN;

|PROCESO Bor_dsm00047;
     |BORRA 020#947a;
     |LIBERA #947;
|FPRC,

|DEFBUCLE Bor_dsm00047;
     #947#1;
     ;
     #0#29, #0#0, #0#1, 001;
     #0#29, #0#0, #0#1, 999;
     be;
     NULL, Bor_dsm00047;
|FIN;

|PROCESO SirveLinea;
     |SI #3#15 = "S"; |ACABA; |FINSI;   || Linea Bloqueada

     |SI aPedCompleto = "S";
          |HAZ EsCoimasa;
          |SI FSalida = 0;
               eaArtCoimasa = #agifa073#2;
               eaCliCoimasa = #agifa104#4;
               eaRepCoimasa = #agifa104#7;
               |HAZ CtrlRepCoimasa;
          |FINSI;
     |FINSI;

     |HAZ EsMecanogra;
     |SI FSalida = 0;
          |HAZ MecaPedFinaliza;
          |SI FSalida ! 0; |ACABA; |FINSI;
          |HAZ MecaAdjudicable;
          |SI FSalida ! 0; |ACABA; |FINSI;
     |FINSI;

     |ABRE #4; #4#0 = #3#2; |LEE 000#4=; |CIERRA #4;

     aArti = #3#2; |QBF aArti;

     nSirve = 0;         || se sirve
     |SI aArti ! "";
          |SI #42#224 = "B";
               |SI #4#179 = "S";
                    |SI #3#43 = #3#5; |Y #3#49 = #3#44; |ACABA; |FINSI;
               |SINO;
                    |SI #3#43 = #3#5; nSirve = 1; |FINSI;
               |FINSI;
          |SINO;
               |SI #3#43 = #3#5;  nSirve = 1; |FINSI;
               |SI #4#179 = "S";
                    |SI #3#49 = #3#44; nSirve = 1; |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
     |SI #3#5 = 0; |Y #279#19 = "S"; ||sirve Uni=0 segun parametro
          nSirve = 0;
     |FINSI;
     |SI nSirve ! 0; |ACABA; |FINSI;

     |SI aPedCompleto = "S"; |Y aArti = "";  || la linea de postformado
          |HAZ EsTagloma; || tiene el codigo blanco, chequeamos las unidades
          |SI FSalida = 0;|| para dejarla asignar
               |SI #3#43 = #3#5; |Y #3#5 ! 0;
                    |ACABA;
               |FINSI;
          |FINSI;
     |FINSI;

     efFec = #1#1;
     enAlma = #3#3;
     |HAZ MiraHisL;
     |SI enErrHis ! 0;
          |ACABA;
     |FINSI;

     enUniKit = 0;
     nDispoKit = 0;
     eaArticulo = #3#2;
     |HAZ EsKit;
     nEsKit = FSalida;

     aRese = #3#22;
     |HAZ EsCoimasa;
     |SI FSalida = 0; aRese = "N"; |FINSI;  || para que chequee el stock

     |SI aPedCompleto ! "S";
          |SI nEsKit = 0;
               |SI ctrl_st ! "N"; |Y aRese = "N";
                    enProg211 = 1;
                    |HAZ DispoKit;
                    enProg211 = 0;
               |FINSI;
               |SI nDispoKit ! 0;
                    |SI ctrl_st = "S"; |O ctrl_st = "X";
                         aMensa = "0000Superado Stock para KIT."+&13+"Linea Pedido:" + #3#1;
                         |MENAV aMensa;
                         |SI enUniKit > 0;
                              aAlfa = "0000NDisponibles:" + enUniKit + &13 + "풞djudicar disponible?";
                               |CONFI aAlfa;
                         |SINO;
                              FSalida = 1;
                         |FINSI;
                         |SI FSalida ! 0;
                              |SI ctrl_st = "X";
                                   servir = "N";
                                   |ACABA;
                              |FINSI;
                         |FINSI;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
     |SI aPedCompleto = "S";
          |SI nEsKit = 0;
               |SI ctrl_st ! "N"; |Y aRese = "N";
                    enProg211 = 1;
                    |HAZ DispoKit;
                    enProg211 = 0;
               |FINSI;
               |SI nDispoKit ! 0;
                    |SI ctrl_st = "S"; |O ctrl_st = "X";
                         aMensa = "0000Superado Stock para KIT."+&13+"Linea Pedido:" + #3#1;
                         |MENAV aMensa;
                         |SI ctrl_st = "X";
                              |SI enUniKit > 0;
                                   aAlfa = "0000NDisponibles:" + enUniKit + &13 + "풞djudicar disponible?";
                                    |CONFI aAlfa;
                              |SINO;
                                   FSalida = 1;
                              |FINSI;
                              |SI FSalida ! 0;
                                   servir = "N";
                                   |ACABA;
                              |FINSI;
                         |FINSI;
                    |FINSI;
               |FINSI;
          |SINO;
               |SI aRese = "N";
                    |SI ctrl_st = "S"; |O ctrl_st = "X";
                         |ABRE #5;
                         #5#0 = #3#2;
                         #5#1 = #3#3;
                         |LEE 001#5=;
                         |SI FSalida ! 0; |DDEFECTO #5; |FINSI;
                         |CIERRA #5;

                         nPendiente  = #3#5 - #3#43;
                         nPendiente2 = #3#44 - #3#49;

                         |SI #4#179 = "N";    || se evita posibles fallos
                              nPendiente2 = 0;|| si no tiene doble stock
                              #5#47 = 0;      ||
                         |FINSI;

                         |SI #910#52 = "S";
                              nLinV = #3#1;
                              |HAZ StockEleme;
                         |SINO;
                              aMensa = "";
                              |SI #5#5 < nPendiente; |O #5#47 < nPendiente2;
                                  aMensa = "0000Superado Stock:"+ #3#2 +&13+"Linea Pedido:" + #3#1;
                              |SINO;
                                  i = #5#5 - #3#5;
                                  |SI i < #5#6;  |Y #5#6 ! 0;
                                      aMensa = "0000Superado Stock Minimo:"+#3#2+&13+" Linea Pedido:" + #3#1;
                                      |MENAV aMensa; aMensa  = "";
                                  |FINSI;
                              |FINSI;

                              |SI aMensa ! "";
                                  |SI ctrl_st = "X";
                                      |SI #5#5 [ 0; |Y #5#47 [ 0;
                                          mensaje = "0000Superado Stock Disponible.  Servido : 0";
                                          |MENAV mensaje;
                                          |ACABA;
                                      |SINO;
                                          mensaje = "0000Superado Stock Disponible.  Servido : " + #5#5;
                                          |MENAV mensaje;
                                          servir = "S";
                                          nSoloEstas1 = #5#5;
                                          nSoloEstas2 = #5#47;
                                      |FINSI;
                                   |SINO;
                                       |MENAV aMensa;
                                   |FINSI;
                              |FINSI;
                         |FINSI;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;

     ||********************* SERVIMOS LA LINEA ****************

     |ABRE #4;
     #4#0 = #3#2;
     |LEE 020#4=;
     |CIERRA #4;

     nSwServida = nSwServida + 1;
     nUniAsig = #3#5 - #3#43;
     |SI #42#118 = "S"; |Y #42#119 = "S"; |Y nUniAsig > 0; |Y #4#180 = "S";
          || Con partidas y asignacion automatica
          |HAZ CreaTempo; aTmp83 = Tempo; |NOME_DAT #83#Tempo#;
          |HAZ CreaTmpAlmParti;
          |ABRE #83;

          |SELECT #2#83;
          #83#0 = #3#2;
          #83#1 = #3#3;
          #83#2 = #3#45;
          |LEE 000#83=;
          |SI FSalida = 0;
               |SI #83#4 < nUniAsig;
                    nUnidades = #83#4;
                    aPartida = #83#2;
                    nUniAsig = nUniAsig - nUnidades;
                    |HAZ ServirLinea;
                    |BORRA 020#83a;
                |SINO;
                    nUnidades = nUniAsig
                    aPartida = #83#2;
                    |HAZ ServirLinea;
                    nUniAsig = 0;
                |FINSI;
          |FINSI;
          |SELECT #1#83;

          |LEE 000#83p;
          |PARA; |SI FSalida = 0; |HACIENDO;
               |SI nUniAsig [ 0; |SAL; |FINSI;
               |SI #83#4 < nUniAsig;
                    nUnidades = #83#4;
                    aPartida = #83#2;
                    nUniAsig = nUniAsig - nUnidades;
                    |HAZ ServirLinea;
                    |LEE 000#83s;
                |SINO;
                    nUnidades = nUniAsig
                    aPartida = #83#2;
                    |HAZ ServirLinea;
                    |SAL;
                |FINSI;
          |SIGUE;
          |CIERRA #83;
          Tempo = aTmp83; |HAZ BoraTempo; |DELINDEX #83;
     |SINO;
          || Asignacion Normal
          nUnidades = #3#5 - #3#43;
          aPartida = #3#45;
          |HAZ ServirLinea;
     |FINSI;
     |LIBERA #0;

     |HAZ EsCoimasa;
     |SI FSalida = 0;
          |SI aPedCompleto = "S";
               ||Si es un pedido completo, se sale de la linea con |ERROR
               ||por lo tanto tengo que simular el proceso que se hace en
               ||el tipo  2
               ||Es una alta. que funciona a la inversa que los pedidos
               ||Por eso lo pongo como si fuera una baja.
               enModoCoimasa = 3;
               |HAZ CtrlPrioridaReservarAlb;
          |FINSI;
     |FINSI;
     |HAZ EsEvaristo;
     |SI FSalida = 0;
          |HAZ EvaGrabaAlta;
     |FINSI;
|FPRC;

|PROCESO ServirLinea;
     nLinCanonSC = #3#55;
     linea = #0#1;
     |PARA FSalida = 0;  |SI FSalida = 0;  |HACIENDO ;
          |DDEFECTO #0;
          #0#29 = #1#52;       ||Serie
          #0#0 = #1#0;         ||Albaran
          #0#1 = linea;
          |LEE 001#0=;
          linea = linea + #42#236;
     |SIGUE;

     |PARA i = 2; |SI i [ 10; |HACIENDO i = i + 1;
           #0i = #3i;
     |SIGUE;
     |HAZ ComiOrtsPed;
     |HAZ AgeTrans;
     aAlfa = #0#2; |QBF aAlfa;
     |SI aAlfa ! "";
          |SI #42#202 = "S"; |O #42#40 = "S";
               aTipoDA = "AP"; |HAZ AltaDA;
          |FINSI;
     |FINSI;

     aRese = #3#22;
     |HAZ EsCoimasa;
     |SI FSalida = 0; aRese = "N"; |FINSI; ||para que chequee el stock

     |SI ctrl_st = "N"; |O ctrl_st = "S"; |Y aRese = "N";
          || si el parametro no es X servimos lo pendiente del kit
          nDispoKit = 0;
     |FINSI;

     |SI enUniKit ! 0; |Y nDispoKit ! 0;
          #0#5 = enUniKit;                   ||Uni disponible en kit
     |SINO;
          |SI correcto = "S";
               #0#5 = #20#6;                 || Cantidad a Servir del 215
          |SINO;
               #0#5 = nUnidades; ||#3#5 - #3#43;          || Unidades Pedido
               #0#48 = #3#44 - #3#49;
          |FINSI;
     |FINSI;

     |SI nSoloEstas1 > 0;  #0#5  = nSoloEstas1;  |FINSI;
     |SI nSoloEstas2 > 0;  #0#47 = nSoloEstas2;  |FINSI;

     nSoloEstas1 = 0;
     nSoloEstas2 = 0;

     nSwBsegui = 1; |HAZ BseguiAdj;

     eaArticulo = #0#2;
     |HAZ EsKit;
     |SI FSalida = 0;
          |BUCLE Bor_dsm00047;
          |ABRE #947;
          |BUCLE dsm00046;
          |CIERRA #947;
     |FINSI;

     |ABRE #6;
     #6#0 = #1#3;
     |LEE 020#6=;
     |CIERRA #6;
     |ABRE #21;
     #21#26 = #0#29;
     |LEE 000#21=;
     |CIERRA #21;
     |ABRE #4;
     #4#0 = #0#2;
     |LEE 020#4=;
     |CIERRA #4;

     #0#5  = #0#5 * abono;              || Multiplica por -1 cuando el pedido es abono.
     #0#48 = #0#48 * abono;
     #0#49 = aPartida; || #3#45;                     || Partida
     #0#50 = #3#46;                     || Merma
     #0#51 = #3#50;                     || Medida1
     #0#52 = #3#51;                     || Medida2
     #0#53 = #3#52;                     || Medida3
     |SI #6#28 = "S"; |O #21#30 = "S";  || Exportacion
          #0#11 = 0;
     |SINO;
          #0#11 = #3#14;                || Tipo de Iva
     |FINSI;
     #0#12 = #3#0;                      || Pedido
     #0#13 = #3#18;                     || Familia
     #0#15 = #1#3;                      || Cliente
     #0#16 = #3#17;                     || Tipo comision
     #0#17 = #2#19;                     || Tipo Cliente
     #0#19 = "S";                       || Entrega Pedido
     #0#21 = #3#1;                      || Linea Pedido
     #0#23 = #3#5 - #3#43;              || Unidades Pedidas
     #0#24 = 0;                         || Unidades Pendientes
     #0#27 = #3#27;                     || Desc. Ampliada
     #0#31 = #3#28;                     || Serie Pedido
     #0#33 = #3#29;                     || Dto 2
     #0#34 = #3#35;                     || Envase Conversion
     #0#35 = #3#36 - #3#37;
     #0#36 = #3#38;                     || Precio en divisa
     #0#61 = #3#53; || INTERNO
     #0#63 = #3#55; || Canon

     |HAZ EsGestral;
     |SI FSalida = 0;
          |HAZ GestralPreDibu;
          |HAZ GestralAdjUni;
     |FINSI;
/*
     aAlfa = #0#49; |QBF aAlfa;
     |SI aAlfa = ""; |Y #agifa142#242 = "N"; |Y #agifa019#180 = "S";
               |Y aPedCompleto = "N";
          |HAZ DoblePartiV;
          |PTEC 809; |PTEC 808;
     |FINSI;
*/
     |HAZ TotalLin71;
     |PINDA #0#0;

     |SI aPedCompleto = "S";
          nForma = 1;
          |HAZ ActuaResto;
     |FINSI;

     |SI #2#52 ! 0;
          aAlfa = #6#198 + "P" + (("000" + #2#52) % -103);
          #0#47 = aAlfa;
          #1#85 = "E";
     |FINSI;

     |GRABA 021#0b;
     nLinV = #0#21;
     |ABRE #904;
     |BUCLE dsm00005N;
     |CIERRA #904;

     ||컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
     |HAZ EsTagloma;
     |SI FSalida = 0;
          |HAZ TagAdjUniFami;
          |HAZ TagGrabaPos0;
     |FINSI;
     |HAZ EsInforAlba;
     |SI FSalida = 0;
          aAlfa = #0#49; |QBF aAlfa;
          |SI aAlfa = "";
               aAlfa = "0000Articulo [" + #0#2 + "] con matricula...";
               |MENAV aAlfa;
          |FINSI;
          |HAZ InfAlbPideMat;
          |GRABA 020#0a;
          |HAZ InforActMatri;
     |FINSI;

     |SI #4#174 = "S";
          |HAZ EsGesisat;
          |SI FSalida = 0;
               |HAZ GesiLeeMaqui;
               aAlfa = eaMatri; |QBF aAlfa;
               |SI aAlfa = "";
                    aAlfa = "0000Articulo [" + #0#2 + "] con matricula...";
                    |MENAV aAlfa;
               |FINSI;
               |HAZ GesiAlbPideMat;
               |GRABA 020#0a;
               |HAZ GesiActMaqui;
          |FINSI;
     |FINSI;

     |HAZ EsDesanch;
     |SI FSalida = 0;
          |HAZ ActDesanch211;
     |FINSI;
     |HAZ EsSematel;
     |SI FSalida = 0;
          |HAZ HistoIMEI;
     |FINSI;
     |HAZ EsInforpor;
     |SI FSalida = 0;
          nSwAdjInforpor = 1;
          aTipoDA = "A"; |HAZ AltaDA;
     |FINSI;

     |HAZ EsFeldo;
     |SI FSalida = 0;
          |HAZ FeldoUnPed;
          |SI nHayPed = 0; |HAZ FeldoPortes; |FINSI;
     |FINSI;
     |HAZ EsQDClor;
     |SI FSalida = 0;
          |HAZ QDClorCamAdj;
          eaArticulo = #0#2;
          eaSerie = #0#29;
          enCodigo = #0#0;
          enLinea = #0#1;
          eaPartida = #0#49;
          eaTipo = "VA";
          |SUB_EJECUTA_NP "qdclor10;ALTA";
     |FINSI;
     |HAZ EsChampiEmar;
     |SI FSalida = 0;
          |HAZ ChampEmarEnv;
     |FINSI;
     |HAZ EsOrts;
     |SI FSalida = 0;
          aTipo = "A"; |HAZ OrtsAlbConsumo;
     |FINSI;
|FPRC;

|PROCESO comp_215;

     |SI #20#6 [ 0; |ACABA;  |FINSI;

     #2#25 = #20#2;
     #2#0 = #20#3;
     |LEE 020#2=;

     |SALVA_DATOS #2;     || Guarda los datos por si el modulo los cambia
     |HAZ EsTagloma;
     |SI FSalida = 0;
          eaAlfa = #1#52;
          |HAZ TagloDefFP;
          |SI eaAlfa ! "";
               #1#8 = eaAlfa; #2#9 = eaAlfa;
          |FINSI;
          |SI eaQuitaDto = "S";
               #1#5 = 0; #1#32 = 0; #1#7 = 0;
               #2#5 = 0; #2#17 = 0; #2#6 = 0;
          |FINSI;
     |FINSI;

     aAlfa = "";
     |SI #2#9 ! #1#8;
               |O #2#7 ! #1#6;
               |O #2#57 ! #1#84;
               |O #2#5 ! #1#5; |O #2#17 ! #1#32; |O #2#6 ! #1#7;
          aAlfa = "0000Condiciones del pedido distintas al albaran.";
     |FINSI;


     #3#28 = #20#2;
     #3#0  = #20#3;
     #3#1  = #20#4;
     |LEE 000#3=;
     |SI aAlfa ! ""; |Y FSalida = 0;
          |MENAV aAlfa;
          #66#2 = #2#9;  #66#9 = #1#8;
          #66#3 = #2#57; #66#10 = #1#84;
          #66#4 = #2#5;  #66#11 = #1#5;
          #66#5 = #2#17; #66#12 = #1#32;
          #66#6 = #2#6;  #66#13 = #1#7;
          #66#16 = #2#7; #66#17 = #1#6;
          #66#14 = #2#25;
          #66#15 = #2#0;
          |PUSHV 0501 2380;
          |BLANCO 1122 2261;
          |PINPA #0#66;
          |PINDA #0#66;
          |PAUSA;
          |POPV;
          |SI #1#41 = 0;
               |CONFI "0000NCambiar condiciones del albaran actual:";
               |SI FSalida = 0;
                    #1#5 = #2#5;
                    #1#32 = #2#17;
                    #1#7 = #2#6;
                    #1#6 = #2#7;
                    #1#8 = #2#9;
                    #1#84 = #2#57;
               |FINSI;
          |SINO;
               aAlfa = "0000Linea de Pedido: [" + #20#2 + "/" + #20#3 + "/" + #20#4 + "], no se asigna";
               |MENAV aAlfa;
               FSalida = 1;
          |FINSI;
     |FINSI;
     nSal = FSalida;
     |REPON_DATOS #2;
     FSalida = nSal;

     |SI FSalida = 0;
          |HAZ SirveLinea;
          nSwSirveArt = 1;
     |FINSI;
|FPRC;

|DEFBUCLE lee_215;
     #20#1;
     ;
     "                    " ,   1;
     "zzzzzzzzzzzzzzzzzzzz" , 999;
     ;
     NULL, comp_215;
|FIN;

|PROCESO poncontr211;
         fiac = Control % A109;
         fiac = fiac + relleno;
         guarda = fiac % A109;
         fiac = Control % A1001;
         Control = Control + fiac;
         Control = Control + relleno;
         Control = Control % A120;
         Control = Control + aponer;
|FPRC;

|PROCESO MiraSerie; |TIPO 0;
     |SI #42#127 = "S"; |Y #1#52 ! #0#31;
          |MENAV "0000Las series Albaran/Pedido no se Corresponden";
          |ERROR;
          |ACABA;
     |FINSI;
|FPRC;

|PROCESO MinPed;
     #2#4 = #1#3;
     #2#25 = "     ";
     #2#0 = 1;
|FPRC;

|PROCESO MaxPed;
     #2#4 = #1#3;
     #2#25 = "zzzzz";
     #2#0 = 999999;
|FPRC;

|PROCESO que_art; |TIPO 6;
     nTecla = FSalida;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 1; |Y Campo = 31;
          |SI nTecla = 1; |O nTecla = 4; |O nTecla = 2; ||Anula ESC y Flechas
               |ERROR; |PTEC 807; |ACABA;
          |FINSI;
     |FINSI;

     |ABRE #2;
     #2#25 = #0#32;
     #2#0 = #0#12;
     |LEE 000#2=;
     |CIERRA #2;

     |SI modo = 1; |Y nTecla = 9; |Y serv_art = "S";
         cliente  = #1#3;
         correcto = "N";
         |HAZ CreaTempo; eaTempo020 = Tempo;
         |HAZ CreaTempo; eaTempo922 = Tempo;
         |NOME_DAT #20 eaTempo020;  |DELINDEX #20;
         |NOME_DAT #922 eaTempo922; |DELINDEX #922;
         |SUB_EJECUTA_NP "agifa214";
         |SI correcto = "S";
             aponer = Asino; |HAZ poncontr211;
             |QBF fichero;
             aPedCompleto   = "S";
             nSwSirveArt = 0;
             |ABRET #2;
             |ABRET #3;
             |BUCLE lee_215;
             |CIERRAT #3;
             |CIERRAT #2;

             |SI nSwSirveArt = 0;
                  |ERROR;
             |SINO;
                  aPedCompleto = "N";
                  aponer = Anosi; |HAZ poncontr211;
                  |C_M #0#3  , 1 , "N";
                  |C_M #0#5  , 1 , "N";
                  |C_M #0#12 , 1 , "N";
                  |C_M #0#21 , 1 , "N";
                  |C_M #0#31 , 1 , "N";
                  |C_M #0#2  , 1 , "N";
                  |C_M #0#4  , 1 , "N";
                  sw_adjf1 = 1;
                  |ERROR;
                  |PTEC 815;     || AV.PAG.
                  |PTEC 807;     || ESC
             |FINSI;
         |SINO;
             |DELINDEX #922; Tempo = eaTempo922; |HAZ BoraTempo;
             |DELINDEX #20;  Tempo = eaTempo020; |HAZ BoraTempo;
             |ERROR;
             |ACABA;
         |FINSI;
         correcto = "N";
         |DELINDEX #922; Tempo = eaTempo922; |HAZ BoraTempo;
         |DELINDEX #20;  Tempo = eaTempo020; |HAZ BoraTempo;
     |FINSI;

|| CONSULTA LOS PEDIDOS PENDIENTES DE SERVIR ................................
     |SI modo = 1; |Y nTecla = 10;
          |SI enPedCab ! 0;             ||Elige en la Cabecera
               #0#31 = serie;
               #0#12 = pedido;
               #0#21 = lineap;
               enPedCab = 0;
          |SINO;
               pedido = 0;
               cliente = #1#3;
               nCampo = Campo;
               |SI nCampo = 31;
                    ser_ped_inf = "     ";
                    ser_ped_sup = "zzzzz";
               |SINO;
                   ser_ped_inf = #0#31;
                   ser_ped_sup = #0#31;
               |FINSI;
               enTipo = 1;
               |HAZ CreaTempo; eaFicPdte = Tempo;
               |SUB_EJECUTA_NP "agit0002";
               |SI pedido = 0;
                    |ERROR;
               |SINO;
                    enPedCab = pedido;
                    |PTEC 807;
/*
                    |SI lineap ! 0;     || Adj. una linea
                         #0#31 = serie;
                         #0#12 = pedido;
                         #0#21 = lineap;
                         #0#2  = codigo;
                         #0#4  = descrip;
                         #0#5  = unid;
                         |PINDA #0#0;
                         |ATRI I;
                    |SINO;              || Adj Ped. completo
                         #0#31 = serie;
                         #0#12 = pedido;
                    |FINSI;
                    |SI nCampo = 31;
                         |PTEC 802;
                         |PTEC 802;
                    |SINO;
                         |PTEC 802;
                    |FINSI;
*/
               |FINSI;
          |FINSI;
     |FINSI;
     |SI modo = 1; |Y nTecla = 18; || F10 Crea linea pedido
          eaSeriePedido = "";
          enCodigPedido = 0;
          enLineaPedido = 0;
          enProg211 = 211;
          |ABRE #2;
       |ET OtraVez;
          #2#25 = #0#31;
          #2#0 = #0#12;
          |LEE 000#2=;
          |SI FSalida = 0;
               |PTEC 802;
               |HAZ Ptecs;                       || Pongo el numero de linea
               |PTEC 809;
               |PTEC 816; |PTEC 815; |PTEC 815;  || Lo meto en las lineas
               |PUSHV 0101 2380;
/*
               |CLS;
               |PINPA #0#2;
               |PINDA #0#2;
               |ENDATOS #2#2;
               |SI FSalida = 0; |GRABA 020#2a; |FINSI;
*/
               ser_ped = #0#31;
               num_ped = #0#12;
               enLinAuto = nLin;
               |SUB_EJECUTA_NP "dsz99920";
               enLinAuto = 0;
               |POPV;
               #0#21 = nLin; |PINTA #0#21;
               |PINTA #0#12;
               |PINTA #0#31;
          |SINO;
               |CONSULTA_F_CLAVE #2#2, MinPed, MaxPed;
               |SI FSalida = 0;
                    #0#31 = #2#25;
                    #0#12 = #2#0;
                    |VETE OtraVez;
               |FINSI;
               |ERROR;
          |FINSI;
          |CIERRA #2;
          enProg211 = 0;
     |FINSI;
     |SI modo = 1; |Y nTecla = 13; || F5  Nuevo pedido
          |ABRE #2;
          #2#25 = #0#31;
          enSwMenu = 1;
          |HAZ ContaPV7;
          |CIERRA #2;
          #0#12 = #2#0; |PINTA #0#12;
          enCliAdj = #1#3;
     |FINSI;
     |SI modo = 1; |Y #0#12 ! 0;
          |HAZ EsJamaica;
          |SI FSalida = 0;
               |HAZ JamaCheqEntrega;
               |SI FSalida ! 0; |ERROR; |ACABA; |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|RUTINA Ptecs;          ||Pone los Ptec en la linea de pedido
     |ABRE #3;
     #3#28 = #2#25
     #3#0 = #2#0;
     #3#1 = 999;
     |LEE 000#3];
     |SI FSalida = 0;
          |LEE 000#3a
     |SINO;
          |LEE 000#3u;
     |FINSI;
     |SI FSalida = 0; |Y #3#28 = #2#25; |Y #3#0 = #2#0;
          nLin = #3#1 + 1;
     |SINO;
          nLin = 1;
     |FINSI;
     |CIERRA #3;

     |SI nLin < #42#123; nLin = #42#123; |FINSI;

     aAlfa = ("000" + nLin) % -103;
     aPtec = aAlfa % 301; nPtec = &aPtec;
     |PTEC nPtec;
     aPtec = aAlfa % 201; nPtec = &aPtec;
     |PTEC nPtec;
     aPtec = aAlfa % 101; nPtec = &aPtec;
     |PTEC nPtec;
|FRUT;

|DEFBUCLE SirveLi2;
     #3#1;
     15;
     #0#31,#0#12,  1, "N";
     #0#31,#0#12,999, "N";
     ;
     NULL,NULL,NULL,NULL,NULL,SirveLinea;
     #3#2;
|FIN;

|PROCESO graba_lin;
     |SI aPedCompleto = "S";
          |ABRE #2;
          aponer = Asino;
          |HAZ poncontr211;
          |SI #0#21 = 0; |Y nPorArticulo = 1;
               |BUCLE SirveLi2;
          |SINO;
               |BUCLELIN 2 SirveLinea #2;
          |FINSI;
          aponer = Anosi;
          |HAZ poncontr211;
          |CIERRA #2;
     |SINO;
          |SI #3#2 = "                    ";
               |C_M #0#3  , 1 , "N";
               |C_M #0#5  , 1 , "N";
          |SINO;
               |C_M #0#3  , 1 , "S";
               |C_M #0#5  , 1 , "S";
          |FINSI;

          |HAZ SirveLinea;

          |SI nSwServida ! 0;
               |HAZ UniGofre;

               |HAZ EsTagloma;
               |SI FSalida = 0;
                    |HAZ TagTienePosP;
                    |SI FSalida = 0;
                         |HAZ TagAsignaPost;
                    |FINSI;
               |FINSI;

               |SI nLinCanonSC > 0;
                    |HAZ EsTaller;
                    |SI FSalida = 0;
                         |HAZ TallerAsignaCanon;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO miraserv;       ||Verifica que las lineas se puedan servir
     |HAZ EsMecanogra;
     |SI FSalida = 0;
          |HAZ MecaPedFinaliza;
          |SI FSalida ! 0; |ACABA; |FINSI;
          |HAZ MecaAdjudicable;
          |SI FSalida ! 0; |ACABA; |FINSI;
     |FINSI;

     #4#0 = #3#2;
     |LEE 000#4=;
     nPendiente = #3#5 - #3#43;
     nPendiente2 = #3#44 - #3#49;
     |SI #4#179 = "N"; |O #agifa142#117 = "N";  ||Sin Doble Stock
          |SI nPendiente ! 0;
               servir = "S";
               |ERROR;
          |FINSI;
     |SINO;
          |SI #agifa142#224 = "B";
               |SI nPendiente ! 0; |O nPendiente2 ! 0;
                    servir = "S";
                    |ERROR;
               |FINSI;
          |SINO;
               |SI nPendiente ! 0; |Y nPendiente2 ! 0;
                    servir = "S";
                    |ERROR;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Envase211;
     qAbono    = "N";
     Envase    = #0#34;
     Unidades1 = #0#35;
     Unidades2 = #0#5;
     VArticulo = #0#2;
     enAlmacen = #0#3;
     eaTipo = "V";
     eaProgEnv = "albaran";
     |HAZ EntraEnvase;
     #0#34 = Envase;
     #0#35 = Unidades1;
     #0#5  = Unidades2;  |PINTA #0#5;
|FPRC;

|PROCESO Conver211;  |TIPO 7;
     |SI nSwServida = 1; |ACABA; |FINSI;  ||Tic:4120:48
     |SI #0#12 = 0; |O nModo ! 1;
          |HAZ EsChampiEmar;
          |SI FSalida = 0;
               eaTipo = "AV";
               eaSerie = #0#29;
               enCodigo = #0#0;
               enLinea = #0#1;
               eaArticulo = #0#2;
               |SI nModo = 1;
                    aAlfa = "champi09;" + eaTmpAV816;
                    |SUB_EJECUTA_NP aAlfa;
               |SINO;
                    |SUB_EJECUTA_NP "champi03";
               |FINSI;
               |HAZ ChampiPinEmar;
               #0#5 = enUnidades;
               |C_M #0#5, 1, "N";
          |FINSI;
     |FINSI;
     nUni1Ant = #0#5; nUni2Ant = #0#48;
     aPartiAnt = #0#49;
     |HAZ DobleUniV;
     |SI eaSw2Stock = "S";
          |C_M #0#5, 1, "N";
     |FINSI;
     |HAZ EsGestral;
     |SI FSalida = 0;
          |SI nUni1Ant ! #0#5; |O nUni2Ant ! #0#48;
               articulo = "";
               |HAZ PrecioArti;
               articulo = #0#2;
          |FINSI;
     |FINSI;
     |SI #agifa142#72 = "S";
          |HAZ Envase211;
          |C_M #0#5, 1, "S";
          |SI enEntraEnvase ! 0;  |C_M #0#5, 1, "N";  |FINSI;
     |FINSI;

     |SI aPartiAnt ! #0#49;
          |HAZ EsQDClor;
          |SI FSalida = 0;
               eaArticulo = #0#2;
               eaSerie = #0#29;
               enCodigo = #0#0;
               enLinea = #0#1;
               eaPartida = aPartiAnt;
               eaTipo = "V";
               |SUB_EJECUTA_NP "qdclor10;BAJA";
               eaPartida = #0#49;
               |SUB_EJECUTA_NP "qdclor10;ALTA";
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO ControlDispo;
|FPRC;

|PROCESO mas_o_menos; |TIPO 0;          ||Verifico si estoy sirviendo mas o
                                        ||menos de lo pedido
     |HAZ decimal;
     |SI modo = 1; |Y #0#21 = 0;
         aPedCompleto = "S";
     |FINSI;


     aRese = #3#22;
     |HAZ EsCoimasa;
     |SI FSalida = 0; aRese = "N"; |FINSI; || Para que chequee el stock

     |HAZ EsEvaristo;
     |SI FSalida = 0; |HAZ EvaConTalla; |FINSI;

     |SI aPedCompleto = "N"; |Y correcto = "N"; |Y sw_adjf1 = 0;
          |SI #3#22 = "N";
               |SI ctrl_st = "S"; |O ctrl_st = "X";
                    servir = "S";
                    |ABRE #5;
                    #5#0 = #3#2;         ||Articulo
                    #5#1 = #3#3;         ||Almacen
                    |LEE 001#5=;
                    |SI FSalida ! 0;|DDEFECTO #5; |FINSI;
                    |CIERRA #5;

                    |HAZ EsKit;
                    |SI nEsKit = 0;
                         |SI ctrl_st ! "N";
                              |HAZ DispoKit;
                         |FINSI;
                         |SI nDispoKit ! 0; servir = "N"; |FINSI;
                    |SINO;
                         |SI #3#22 = "S";         || Linea pedido reservada
                              tuni = #5#39 + #5#8;
                         |SINO;
                              tuni = #5#39;
                         |FINSI;
                         |SI tuni < #0#5;
                              mensaje = "0000No existe Stock Disponible";
                              servir = "N";
                         |SINO;
                              i = #5#5 - #0#5;
                              |SI i < #5#6;  |Y i ! 0;
                                   ||mensaje = "0000Se sobrepasa el Stock Minimo";
                                   ||servir = "N";
                                   ||quitado por R.PRIEGO por orden de R.AURA
                              |FINSI;
                         |FINSI;
                         nStock = #5#5 - #0#5;
                         |SI #5#6 > nStock; |Y #agifa142#219 = "S";
                              |MENAV "0000Supera el Stock minimo...";
                         |FINSI;
                    |FINSI;
                    |SI servir = "N";
                         |MENAV mensaje;
                         |SI ctrl_st = "X";
                              |SI Unidades1 = 0;
                                   |ERROR;
                              |SINO;
                                   |HAZ Conver211;
                                   |ERROR;
                               |FINSI;
                               |ACABA;
                          |FINSI;
                    |FINSI;
               |FINSI;
          |FINSI;

          |SI #0#12 ! 0; |O #0#31 ! "     ";  || (7)
             aDespreciar = "N";
             aDespreCanon = "N";
             nPendiente  = #3#5 - #3#43;
             nPendiente2 = #3#44 - #3#49;

             |SI #0#5 > nPendiente; |O #0#48 > nPendiente2;
                 |SI #4#176 ! "S";
                     |AVISO;
                     FSalida = 1;
                     |SI nPendiente [ 0; |O nPendiente2 [ 0;
                         |SI #agifa142#224 = "B";
                              FSalida = 0;
                         |FINSI;
                     |FINSI;
                     |SI FSalida = 1;
                          |SI #0#12 = 0; |Y #0#21 = 0;  || Sin Pedido
                              FSalida = 0;
                          |SINO;
                              |SI nEvaConTalla = 1;    ||Evaristo
                                   |MENAV "0000No se puede servir mas de lo pedido...";
                                   |ERROR; |ACABA;
                              |FINSI;
                              |SI nSwTagCamPed ! 0;    ||Tagloma
                                   FSalida = 0;
                              |SINO;
                                   |CONFI "2400NEsta sirviendo mas de lo Pedido, Continuar : ";
                              |FINSI;
                          |FINSI;
                     |FINSI;

                     |SI FSalida ! 0;
                         #0#5  = nPendiente;
                         #0#48 = nPendiente2;
                         #0#35 = #3#36 - #3#37;
                         |PINTA #0#5;
                         |ERROR;
                     |SINO;
                         aDespreciar = "S";
                         aDespreCanon = "S";
                     |FINSI;
                 |FINSI;
             |FINSI;
             |SI #0#5 < nPendiente; |O #0#48 < nPendiente2;
                 |SI #4#176 ! "S"; || Si Division Vertical
                     |SI nEvaConTalla = 1; aGuarda = ctrl_st; ctrl_st = "X"; |FINSI;
                     |SI ctrl_st ! "X";
                         |SI #42#211 = "E";
                              |AVISO;
                              |CONFI "2400NEsta sirviendo menos de lo Pedido, Despreciar : ";
                         |FINSI;
                         |SI #42#211 = "D"; FSalida = 0; |FINSI;
                         |SI #42#211 = "P"; FSalida = 1; |FINSI;
                     |SINO;
                         FSalida = 1;
                     |FINSI;
                     |SI FSalida = 0;
                         nDesprecia = nPendiente - #0#5;
                         |HAZ HistoDespreciar;
                         aDespreciar = "S";
                         aDespreCanon = "S";
                     |SINO;
                         aDespreciar = "N";
                         aDespreCanon = "N";
                     |FINSI;
                     |SI nEvaConTalla = 1; ctrl_st = aGuarda; |FINSI;
                 |FINSI;
             |FINSI;
         |FINSI;
     |FINSI;

     |SI #0Campo ! Contenido; |Y #42#93 = "S";
          enPromo = 2;
          |HAZ PrecioArti;
          enPromo = 0;
     |FINSI;

     |HAZ TotalLin71;
|FPRC;

|PROCESO BorraHistoDespreciar;
     |DFICE aAlfa; aAlfa = aAlfa % -205;

     |ABRE #235;
     #235#0 = aAlfa;
     #235#1 = #0#29;
     #235#2 = #0#0;
     #235#3 = #0#1;
     |BORRA 101#235c;
     |CIERRA #235;
|FPRC;

|PROCESO HistoDespreciar;
     |ABRE #234;
     |LEE 000#234p;
     |SI FSalida ! 0; |CIERRA #234; |ACABA; |FINSI;

     |PARA FSalida = 1; |SI FSalida ! 0; |HACIENDO;
          |CONSULTA_CLAVE #1#234;
     |SIGUE;
     |CIERRA #234;

     |DFICE aAlfa; aAlfa = aAlfa % -205;

     |ABRE #235;
     |DDEFECTO #235;
     #235#0 = aAlfa;
     #235#1 = #0#29;
     #235#2 = #0#0;
     #235#3 = #0#1;
     |LEE 101#235=;
     |SI FSalida ! 0; |GRABA 020#235b; |FINSI;
     #235#4 = #0#31;
     #235#5 = #0#12;
     #235#6 = #0#21;
     #235#7 = #0#2;
     #235#8 = #3#42;              || Ped
     |SI #234#2 = "D";
          #235#9 = nDesprecia;    || Devu
          #235#10= 0;             || Recha
     |SINO;
          #235#9 = 0;             || Devu
          #235#10 = nDesprecia;   || Recha
     |FINSI;
     #235#11= #234#0;
     #235#12= #234#1;
     |GRABA 020#235a;
     |CIERRA #235;
|FPRC;

|PROCESO liacarti; |TIPO 2;
     |ABRE #42; |LEE 000#42p; |CIERRA #42;
     modo   = (FEntrada / 100) ! 0;
     nForma = 0 +. 1;

     enUnidPend = 0;
     enUnidPend2 = 0;
     eaCongeCarVar = #1#1;

     |ABRE #4;
     #4#0 = #0#2;
     |LEE 000#4=;
     |CIERRA #4;
     aAlfa = #4#111; |QBF aAlfa;
     |SI aAlfa ! ""; |Y modo = 3;
          |HAZ EsPrimicias;
          |SI FSalida = 0;
               |HAZ CheqPrimicias;
               |SI PARAMETRO ! "primicias";
                    |SI enError ! 0;
                         |SI nForma = -1; |O modo = 1;
                              |MENAV "0000Adjudicacion realizada por el mantenimiento del modulo...";
                         |FINSI;
                         |ERROR; |ACABA;
                    |FINSI;
               |FINSI;
          |FINSI;
          |HAZ EsVallcorba;
          |SI FSalida = 0;
               |HAZ CheqVallcorba;
               |SI PARAMETRO ! "vallcorba";
                    |SI enError ! 0;
                         |SI nForma = -1; |O modo = 1;
                              |MENAV "0000Adjudicacion realizada por el mantenimiento del modulo...";
                         |FINSI;
                         |ERROR; |ACABA;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;

     |HAZ EsTagloma; nSwTagloma = FSalida;
     |HAZ EsTaller; nSwTaller = FSalida;

     |SI nSwTaller = 0;
          |SI #0#63 = -1; |Y enModoCab210 ! 3;
               |SI nForma = -1;
                    |MENAV "0000Linea canon de articulo, no se puede modificar";
               |FINSI;
               |ERROR; |ACABA;
          |FINSI;
     |FINSI;

     |SI nSwTagloma = 0;
          |HAZ TagEsLinPostA;
          |SI FSalida = 0; |Y enModoCab210 ! 3;
               |SI nForma = -1;
                    |MENAV "0000Linea de incremento de postformado, no se puede modificar...";
               |FINSI;
               |ERROR; |ACABA;
          |FINSI;
     |FINSI;

     |SI enModoCab210 ! 3; || en baja dejamos pasar
          |HAZ EsMecanogra;
          |SI FSalida = 0;
               |HAZ MecaDeOrdenLin;
               |SI FSalida = 0;
                    |SI nForma = -1;
                         |MENAV "0000No se puede modificar, creado desde una orden de carga.";
                    |FINSI;
                    |ERROR; |ACABA;
               |FINSI;
          |FINSI;
     |FINSI;

     || Si es en modo de baja a todos los efectos es como si no fuera
     || completo
     |SI modo = 2;|O modo = 3;
          efFec = #1#1;
          enAlma = #0#3;
          |HAZ MiraHisL;
          |SI enErrHis ! 0;
               |ERROR;
               |ACABA;
          |FINSI;
     |FINSI;

     |SI modo = 2; |Y nForma = 1;
          |HAZ Riesgos211;
          |SI enErrRie ! 0; |ACABA; |FINSI;
     |FINSI;

     |SI modo = 3;
          aPedCompleto = "N";
     |FINSI;

     |SI aPedCompleto = "N";
         |HAZ ActuaResto;
     |FINSI;

     |SI #0#12 = 0; |Y modo = 1;
         |HAZ ActuaResto;
     |FINSI;

     |SI modo = 3; |O nForma = 1;
          |SI modo ! 1; |HAZ UniGofre; |FINSI;
     |FINSI;

     |SI #0#12 = 0;
          enForma = 0 +. 1;
          |HAZ AcumulaAV;
          ||컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
          |SI nSwTagloma = 0;
               eaCliente = #1#3;
               eaArticulo = #0#2;
               enUniTagRes = -(#0#5 * enForma);
               |HAZ TagVentaVario;
          |FINSI;
          enTipEnvase = 2;
          |HAZ Envase211;
     |FINSI;

     |SI modo = 2;
          |ABRE #6;
          |ABRE #4;
          |HAZ ActualizaCliente;
          |CIERRA #4;
          |CIERRA #6;

          |SI nSwTagloma = 0;
               |HAZ TagModiPos;
          |FINSI;

          |SI nSwTaller = 0; |Y #0#12 ! 0;
               |HAZ TallerModiCanon;
          |FINSI;
     |FINSI;

     |SI modo = 3;
          |HAZ EsAlbadis;
          |SI FSalida = 0;
               eaDocu = "AV";
               eaSerie = #0#29;
               enCodigo = #0#0;
               enLinea = #0#1;
               |HAZ BseBorraUni;
          |FINSI;
          |HAZ EsMecanogra;
          |SI FSalida = 0;
               |HAZ MecaBorrPaq;
          |FINSI;
          |HAZ EsOrts;
          |SI FSalida = 0;
               eaDocu = "agifa071";
               eaSerie = #0#29;
               enCodigo = #0#0;
               enLinea = #0#1;
               |SUB_EJECUTA_NP "dsz99905;BORRA";
          |FINSI;
          |SI nSwTagloma = 0;
               |HAZ BorTagloMerma211;

               |SI enModoCab210 ! 3;
                    |HAZ TagBorraLinPos;
                    |SI nLin_baja ! 0;
                         |HAZ TagDespreciaPos;
                    |FINSI;
               |FINSI;
               |HAZ TagBorraPos;
          |FINSI;
          |SI nSwTaller = 0; |Y #0#12 ! 0;
               |SI enModoCab210 ! 3;
                    |HAZ TallerBorraCanon;
                    |SI nLin_baja ! 0;
                         |HAZ TallerDespreCanon;
                    |FINSI;
               |FINSI;
          |FINSI;
          |HAZ EsPCEGroup;    || se da debaja aqui porque no existe
          |SI FSalida = 0;    || pedido en la estandar
               enForma = -1;
               eaReservado = 0;
               |HAZ AcumulaAV;
               |HAZ Stock211PCEG;
          |FINSI;
          |HAZ EsQDClor;
          |SI FSalida = 0;
               eaArticulo = #0#2;
               eaSerie = #0#29;
               enCodigo = #0#0;
               enLinea = #0#1;
               |SUB_EJECUTA_NP "qdclor09;BAJA";
               eaPartida = #0#49;
               eaTipo = "V";
               |SUB_EJECUTA_NP "qdclor10;BAJA";
          |FINSI;
          |HAZ EsExtintor;
          |SI FSalida = 0;
               enModo = modo;
               eaSerie = #0#29;
               enCodigo = #0#0;
               enLinea = #0#1;
               |SUB_EJECUTA_NP "extz0016";
          |FINSI;
          |HAZ EsOrts;
          |SI FSalida = 0;
               eaTipo = "AD";
               eaSerie = #0#29;
               enCodigo = #0#0;
               enLinea = #0#1;
               |SUB_EJECUTA_NP "ortsm022;BAJA";
          |FINSI;
          |HAZ EsGesisat;
          |SI FSalida = 0;
               |HAZ GesiBorMaqui;
          |FINSI;
          ||컴컴컴컴컴컴컴컴컴컴컴
          |HAZ BorraHistoDespreciar;

          aTipoDA = "A"; |HAZ BajaDA;

          |HAZ BorraKit;

          eaTipo        = "AV";
          eaSerie       = #0#29;
          enCodigo      = #0#0;
          enLinea       = #0#1;
          efFecha       = #1#1;
          eaArticulo    = #0#2;
          enAlmacen     = #0#3;
          enUnidades    = #0#5;
          eaAbono       = #1#43;
          eaSeriePedido = #0#31;
          enCodigPedido = #0#12;
          enLineaPedido = #0#21;
          eaEsNecesario = "S";
          |SUB_EJECUTA_NP "dsz00002;BAJA";
          nLin_baja = 0;
          |SI Nopregunta = 0;
               |SI #0#12 ! 0; |Y #0#21 ! 0;
                    |AVISO;
                    aAlfa = "2400NDespreciar Pedido S/N";
                    |CONFI aAlfa;
                    |SI FSalida = 0;
                         nPed_baja = #0#12;
                         aSer_baja = #0#31;
                         nLin_baja = #0#21;
                         |SUB_EJECUTA "dsz00006";
                         nLin_baja = #0#21;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;

     |HAZ EsInforAlba;
     |SI FSalida = 0; |HAZ InforActMatri; |FINSI;

     |HAZ EsGesisat;
     |SI FSalida = 0; |HAZ GesiActMaqui; |FINSI;

     || Modulo Tagloma;
     |SI nSwTagloma = 0; |Y nSwTagCamPed ! 0; |Y nForma = 1;
          |HAZ TagloActPed;
     |FINSI;
     nSwTagCamPed = 0;

     |HAZ EsVigor;
     |SI FSalida = 0;
          nTotUni = nTotUni +. #0#5;
          aAlfa = #0#5;
          #0#5 = nTotUni;
          |PINTA 1002, "Tot.Uni: ";
          |PINTA 1011, #0#5;
          #0#5 = aAlfa;
     |FINSI;

     |SI nSwTaller = 0; |Y #0#12 = 0; || No es de pedido
          |HAZ TallerCanon71;
     |FINSI;

     |HAZ EsDesanch;
     |SI FSalida = 0;
          |HAZ ActDesanch211;
     |FINSI;

     |HAZ EsSematel;
     |SI FSalida = 0;
          |HAZ HistoIMEI;
     |FINSI;
     |SI nForma = 1; |Y modo ! 1;
          |HAZ EsInforpor;
          |SI FSalida = 0;
                aTipoDA = "A"; |HAZ AltaDA;
          |FINSI;
     |FINSI;
     |HAZ EsInforpor;
     |SI FSalida = 0; |Y #0#12 = 0;
          enForma = nForma;
          |SI #1#43 = "S"; enForma = -enForma; |FINSI;
          |HAZ InfoEnviaWeb;
          enForma = nForma;
     |FINSI;

     |HAZ EsCoimasa;
     |SI FSalida = 0;
          ||ARA
          |ABRE #agifa073;
          #agifa073#28 = #0#31;
          #agifa073#0 = #0#12;
          #agifa073#1 = #0#21;
          |LEE 000#agifa073.=;
          |SI FSalida = 0;
               ||Funciona a la inversa que los pedidos.
               modo = (FEntrada / 100) ! 0;
               |SI modo = 1;
                    enModoCoimasa = 3;
               |SINO;
                    |SI modo = 3;
                         enModoCoimasa = 1;
                    |SINO;
                         enModoCoimasa = 2;
                         enFormaCoimasa = nForma * -1;
                    |FINSI;
               |FINSI;
               |HAZ CtrlPrioridaReservarAlb;
          |FINSI;
          |CIERRA #agifa073;
     |FINSI;
     |HAZ EsChampiEmar;
     |SI FSalida = 0;
          |SI modo = 1; |HAZ ChampiEmarEnv1; |FINSI;
          |SI modo = 3; |HAZ ChampEmarBor; |FINSI;
     |FINSI;
     |HAZ EsOrts;
     |SI FSalida = 0;
          |SI modo = 1; aTipo = "A"; |FINSI;
          |SI modo = 2; aTipo = "M"; |FINSI;
          |SI modo = 3; aTipo = "B"; |FINSI;
          |HAZ OrtsAlbConsumo;
     |FINSI;
|FPRC;

|PROCESO ActualizaCliente;
     #4#0 = #0#2;
     |LEE 020#4=;

     #6#0 = #0#15;
     |LEE 121#6=;
     |SI 0 = FSalida;
          |SI #4#194 = 2;
               nImpo = (((((#0#48 * #0#6) < #0#8) < #0#33) < #1#5) < #1#32);
          |SINO;
               nImpo = (((((#0#5 * #0#6) < #0#8) < #0#33) < #1#5) < #1#32);
          |FINSI;
          |SI #42#115 = "S";
               nImpo = nImpo < #1#7;
          |FINSI;
          nImpo = nImpo * nForma;
          fmes = #1#1 % A402;
          mes = fmes - 1;
          mes = mes * 3;
          mes = mes + 114;
          |SI #1#43 = "S";
               #6mes  = #6mes   - nImpo;     || ABONO.
               #6#150 = #6#150  - nImpo;
          |SINO;
               #6mes  = #6mes   + nImpo;     || VENTA.
               #6#150 = #6#150  + nImpo;
          |FINSI;
          |GRABA 020#6a;


          |SI #1#43 = "S"; nImpo = -nImpo; |FINSI;
          eaCliente = #agifa104#4;
          efFecha = #agifa104#1;
          enImpCliPed = nImpo;
          |HAZ AcumulaCli;
     |FINSI;
|FPRC;

|PROCESO actua_cabe;
     |HAZ CalCabAgifa010;

     aObs = #2#53;
     |QBF aObs;
     |SI aObs ! "";
          #1#55 = #2#53;
     |FINSI;
     aObs = #2#54;
     |QBF aObs;
     |SI aObs ! "";
          #1#56 = #2#54;
     |FINSI;
     aObs = #2#55;
     |QBF aObs;
     |SI aObs ! "";
         #1#57 = #2#55;
     |FINSI;

     nModo = (FEntrada / 100) ! 0;
     |SI nModo ! 3;
          |HAZ visual_totales2; || Visualiza los totales
     |FINSI;
|FPRC;

|PROCESO AlPedido;
     |ABRE #2;
     |ABRE #3;
     #2#25 = #0#31;
     #2#0 = #0#12;
     |LEE 101#2=;                       || Leo el pedido Original.
     |SI FSalida = 0;
          #3#28 = #2#25;
          #3#0  = #2#0;
          #3#1  = #0#21;                 || Linea de Pedido.
          |LEE 101#3=;                  || Leo la linea de pedido.
          |SI FSalida = 0;
               #0#14 = #0#5 * #4#9;     || Precio de coste medio.
               cantidad = #0#5;

               |HAZ ActuaPedido;

               |HAZ tot_ped_div; || Calcula totales de pedido en divisa y campos visual. y no visual.
               |GRABA 021#3a;
               |LIBERA #3;
          |FINSI;
          |GRABA 021#2a;
          |LIBERA #2;
     |FINSI;
     |CIERRA #2;
     |CIERRA #3;
     ||컴컴컴컴컴컴컴컴컴컴
     |HAZ EsAlbero;
     |SI FSalida = 0;
          |HAZ AlbePed2Alb;
     |FINSI;
     ||컴컴컴컴컴컴컴컴컴컴
     |HAZ EsOrts;
     |SI FSalida = 0;
          eaSeriePedido = #agifa073#28;
          enCodigPedido = #agifa073#0;
          enLineaPedido = #agifa073#1;
          eaSerie = #agifa071#29;
          enCodigo = #agifa071#0;
          enLinea = #agifa071#1;
          |SUB_EJECUTA_NP "dsz99905;ADJPED";
     |FINSI;
|FPRC;

__________________________________/ ACTUALIZA EL PEDIDO

|PROCESO VariPedido;
     nPendiente = nPendiente + (#905#6 - #905#12 - #905#11);
     #3#12 = #3#12 + #905#9;
|FPRC;

|DEFBUCLE VariPedido;
     #905#1;
     ;
     "PV", #0#31, #0#12, nLinV, "      ";
     "PV", #0#31, #0#12, nLinV, "zzzzzz";
     ;
     NULL, VariPedido;
|FIN;

|PROCESO MiraQueTraes;
     aDespreciar = "S";
     aDespreCanon = "S";
     #905#12 = 0;
     |GRABA 020#905a;
     |LIBERA #905;
|FPRC;

|DEFBUCLE dsm00005P;
     #905#1;
     12;
     "AV", #0#29, #0#0, nLinV, "      ", 1;
     "AV", #0#29, #0#0, nLinV, "zzzzzz", 1;
     be;
     NULL, MiraQueTraes;
|FIN;

|RUTINA ActuaPedido;
     nLinV = #0#1;
     |SI #4#176 = "S"; |BUCLE dsm00005P;  |FINSI;

     || nMult corrige redondeo importe negativo
     |SI #4#194 = 2;
          nImpo = #3#44 * #3#6;
     |SINO;
          nImpo = #3#5 * #3#6;
     |FINSI;
     |SI nImpo < 0; nMult = -1; |SINO; nMult = 1; |FINSI;

     importe  = #2#13;
     importeD = #2#44;

     |SI #4#194 = 2;
          #2#13 = (#3#49 * #3#6)  * nMult;
          #2#44 = (#3#49 * #3#38) * nMult;
     |SINO;
          #2#13 = (#3#43 * #3#6)  * nMult;
          #2#44 = (#3#43 * #3#38) * nMult;
     |FINSI;

/*
     #2#13 = ((((#2#13 < #3#8) < #3#29) < #2#5) < #2#17) < #2#6;
     #2#44 = ((((#2#44 < #3#8) < #3#29) < #2#5) < #2#17) < #2#6;
*/

     nBrutoMoneda1 = ((#2#13 < #3#8) < #3#29) ! nDeci_BaseMxP;
     nImporDescue1 = (nBrutoMoneda1 % #2#5) ! nDeci_BaseMxP;
     nBrutoMoneda1 = nBrutoMoneda1 - nImporDescue1;
     nImporDescue2 = (nBrutoMoneda1 % #2#17) ! nDeci_BaseMxP;
     nBrutoMoneda1 = nBrutoMoneda1 - nImporDescue2;
     nImporDescue3 = (nBrutoMoneda1 % #2#6) ! nDeci_BaseMxP
     nBrutoMoneda1 = nBrutoMoneda1 - nImporDescue3;
     #2#13 = nBrutoMoneda1;

     nBrutoMoneda2 = ((#2#44 < #3#8) < #3#29) ! nDeci_BaseMxP;
     nImporDescue1 = (nBrutoMoneda2 % #2#5) ! nDeci_DivP;
     nBrutoMoneda2 = nBrutoMoneda2 - nImporDescue1;
     nImporDescue2 = (nBrutoMoneda2 % #2#17) ! nDeci_DivP;
     nBrutoMoneda2 = nBrutoMoneda2 - nImporDescue2;
     nImporDescue3 = (nBrutoMoneda2 % #2#6) ! nDeci_DivP;
     nBrutoMoneda2 = nBrutoMoneda2 - nImporDescue3;
     #2#44 = nBrutoMoneda2;

     #2#13 = importe - (#2#13 * nMult);       || Imp Servido (C)
     #2#44 = importeD - (#2#44 * nMult);       || Imp Servido (C)

     #3#43 = #3#43 + (#0#5 * nForma);
     #3#49 = #3#49 + (#0#48 * nForma);

     |SI aDespreciar = "S";
          |SI #4#176 = "S";
               #3#12 = 0;
               nLinV = #0#21;
               |BUCLE VariPedido;
          |SINO;
               #3#12 = #3#43 - #3#42;
               #3#47 = #3#49 - #3#48;
          |FINSI;
     |SINO;
          |SI #42#224 = "B";
               |SI #3#42 = 0;
                    #3#12 = #3#43 - #3#42;
               |FINSI;
               |SI #3#48 = 0;
                    #3#47 = #3#49 - #3#48;
               |FINSI;
          |FINSI;
     |FINSI;

     #2#11 = #2#11 - #3#9;
     #2#42 = #2#42 - #3#39;
     #2#63 = #2#63 - #3#54;

     #3#5  = #3#42 + #3#12;
     #3#44 = #3#48 + #3#47;
     #3#54 = #3#5 * #4#208; ||Punto Verde

     |SI #4#194 = 2;
          #3#7    = (#3#44 * #3#6) * nMult;
          nImpDiv = (#3#44 * #3#38) * nMult;
     |SINO;
          #3#7    = (#3#5 * #3#6)  * nMult;
          nImpDiv = (#3#5 * #3#38) * nMult;
     |FINSI;
/*
     #3#9  = ((((#3#7 < #3#8) < #3#29) < #2#5) < #2#17) < #2#6;
     #3#39 = ((((nImpDiv < #3#8) < #3#29) < #2#5) < #2#17) < #2#6;
*/
     nBrutoMoneda1 = ((#3#7 < #3#8) < #3#29) ! nDeci_BaseMxP;
     nImporDescue1 = (nBrutoMoneda1 % #2#5) ! nDeci_BaseMxP;
     nBrutoMoneda1 = nBrutoMoneda1 - nImporDescue1;
     nImporDescue2 = (nBrutoMoneda1 % #2#17) ! nDeci_BaseMxP;
     nBrutoMoneda1 = nBrutoMoneda1 - nImporDescue2;
     nImporDescue3 = (nBrutoMoneda1 % #2#6) ! nDeci_BaseMxP
     nBrutoMoneda1 = nBrutoMoneda1 - nImporDescue3;
     #3#9 = nBrutoMoneda1;

     nBrutoMoneda2 = ((nImpDiv < #3#8) < #3#29) ! nDeci_BaseMxP;
     nImporDescue1 = (nBrutoMoneda2 % #2#5) ! nDeci_DivP;
     nBrutoMoneda2 = nBrutoMoneda2 - nImporDescue1;
     nImporDescue2 = (nBrutoMoneda2 % #2#17) ! nDeci_DivP;
     nBrutoMoneda2 = nBrutoMoneda2 - nImporDescue2;
     nImporDescue3 = (nBrutoMoneda2 % #2#6) ! nDeci_DivP;
     nBrutoMoneda2 = nBrutoMoneda2 - nImporDescue3;
     #3#39 = nBrutoMoneda2;

     #3#7  = #3#7 * nMult;
     #3#9  = #3#9 * nMult;
     #3#39 = #3#39 * nMult;

     #2#11 = #2#11 + #3#9;
     #2#42 = #2#42 + #3#39;
     #2#63 = #2#63 + #3#54;

     |SI #2#37 = "D";
         #3#41 = #3#9;
     |SINO;
         #3#41 = #3#39;
     |FINSI;

     |SI #4#194 = 2;
          importe  = (#3#49 * #3#6)  * nMult;
          importeD = (#3#49 * #3#38) * nMult;
     |SINO;
          importe  = (#3#43 * #3#6)  * nMult;
          importeD = (#3#43 * #3#38) * nMult;
     |FINSI;
     importe = importe ! nDeci_BaseMxP;  || Tiquet 002359/355
     importeD = importeD ! nDeci_BaseMxP;|| "" (dif. servido/por servir en pedido)
/*
     importe  = ((((importe  < #3#8) < #3#29) < #2#5) < #2#17) < #2#6;
     importeD = ((((importeD < #3#8) < #3#29) < #2#5) < #2#17) < #2#6;
*/
     nBrutoMoneda1 = ((importe < #3#8) < #3#29) ! nDeci_BaseMxP;
     nImporDescue1 = (nBrutoMoneda1 % #2#5) ! nDeci_BaseMxP;
     nBrutoMoneda1 = nBrutoMoneda1 - nImporDescue1;
     nImporDescue2 = (nBrutoMoneda1 % #2#17) ! nDeci_BaseMxP;
     nBrutoMoneda1 = nBrutoMoneda1 - nImporDescue2;
     nImporDescue3 = (nBrutoMoneda1 % #2#6) ! nDeci_BaseMxP
     nBrutoMoneda1 = nBrutoMoneda1 - nImporDescue3;
     importe = nBrutoMoneda1;

     nBrutoMoneda2 = ((importeD < #3#8) < #3#29) ! nDeci_BaseMxP;
     nImporDescue1 = (nBrutoMoneda2 % #2#5) ! nDeci_DivP;
     nBrutoMoneda2 = nBrutoMoneda2 - nImporDescue1;
     nImporDescue2 = (nBrutoMoneda2 % #2#17) ! nDeci_DivP;
     nBrutoMoneda2 = nBrutoMoneda2 - nImporDescue2;
     nImporDescue3 = (nBrutoMoneda2 % #2#6) ! nDeci_DivP;
     nBrutoMoneda2 = nBrutoMoneda2 - nImporDescue3;
     importeD = nBrutoMoneda2;

     enTiva = #3#14;
     efFiva = #2#1;
     |HAZ SacaIVA;
     nCalc = #3#11 % enIva;
     |SI #agifa024#47 = "S";
           nCalc = nCalc + (#3#11 % enRec);
     |FINSI;

     nImpo = #3#11 + nCalc;
     eaTag = "PAA";  |HAZ Riesgos;

     #3#11 = #3#9  - (importe * nMult);|| Imp. Pdte (L)
     #3#37 = #3#37 +. #0#35;

     enTiva = #3#14;
     efFiva = #2#1;
     |HAZ SacaIVA;
     nCalc = #3#11 % enIva;
     |SI #agifa024#47 = "S";
           nCalc = nCalc + (#3#11 % enRec);
     |FINSI;

     nImpo = #3#11 + nCalc;
     eaTag = "PAM";  |HAZ Riesgos;

     nImpo = #2#13;
     #2#13 = importe;                 || Imp Servido (C)
     #2#13 = (#2#13 * nMult) + nImpo;
     #2#12 = #2#11 - #2#13;           || Imp Pdte serv (C)

     nImpo = #2#44;
     #2#44 = importeD;                || Imp Servido (C)
     #2#44 = (#2#44 * nMult) + nImpo;
     #2#43 = #2#42 - #2#44;           || Imp Pdte serv (C)


     #2#24 = #2#24 + (#0#5 * nForma);           || Ctrl Servido (C)

     ||-------------------Actualiza Historico, Articulo y Almacen
     |SI aDespreciar = "S";
          |SI #4#176 = "S";
               enUnidPend = -nPendiente;
          |SINO;
               enUnidPend = #0#5 + (nPendiente - #0#5);
               enUnidPend2 = #0#48 + (nPendiente2 - #0#48);
          |FINSI;
     |SINO;
          enUnidPend = #0#5;
          enUnidPend2 = #0#48;
          |SI #3#42 = 0; enUnidPend = 0; |FINSI;  ||#3#43
          |SI #3#48 = 0; enUnidPend2 = 0; |FINSI;
     |FINSI;
     enForma = nForma;
     eaReservado = #3#22;
     |HAZ AcumulaAV;

     enTipEnvase = 2;
     |HAZ Envase211;

     eaDesprecia = aDespreciar;
     nSwBsegui = 2; |HAZ BseguiAdj;

     ||컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
     |HAZ EsTagloma;
     |SI FSalida = 0;
          eaCliente = #1#3;
          eaArticulo = #0#2;
          enUniTagRes = -(#0#5 * enForma);
          |HAZ TagVentaVario;
     |FINSI;

     nNume  = ((((#0#9 < #1#5) < #1#32) < #1#7)) * nForma;
     #0#14  = enCoste;
     #1#37  = #1#37 + (nNume - enCoste)
     aDespreciar = "N";

     |HAZ EsEvaristo;
     |SI FSalida = 0;
          |HAZ EvaGrabaModi;
     |FINSI;
|FRUT;

||__________________________________________/ ACTUALIZACIONES

|RUTINA lee_arti;
     #4#0 = #0#2;
     |LEE 101#4=;
     |SI FSalida ! 0;
          |DDEFECTO #4;
          #4#0 = #0#2;
          #4#1 = #0#4;
          |GRABA 021#4b;
     |FINSI;
     |LIBERA #4;
|FRUT;

|RUTINA lee_clien;
     #6#0 = #0#15;
     |LEE 101#6=;
     |SI FSalida ! 0;
          |DDEFECTO #6;
          #6#0 = #0#15;
          |GRABA 021#6b;
     |FINSI;
|FRUT;

_____________________________________/ ACTUALIZA EL HISTORICO DE MOVIMIENTOS.
|CALCULO miraques;|TIPO 0;
     |SI #1#43 = AN;
          a = -1; b = 1;
          operacion = "AV";
          operainte = "AC"; || Si es una Serie Interna
     |SINO;
          a = 1;  b = -1;
          operacion = "BV";
          operainte = "BC"; || Si es una Serie Interna
     |FINSI;
|FCAL;

|PROCESO decimal; |TIPO 0;
     #0#5 = #0#5 ! n_dec;
     |PINTA #0#5;
|FPRC;

|PROCESO Mini; |TIPO 0;
     |SI nSwServida = 1; |ACABA; |FINSI;  ||Tic:4120:48

     nTecla = FSalida;
     |SI FSalida = 5;
          enTipEnvase = 1;
          |HAZ Envase211;
     |FINSI;
     |SI nTecla = 15;    ||F7
          |HAZ EsEvaristo;
          |SI FSalida = 0;
               eaSerie = #0#31;
               enPedido = #0#12;
               enLinea = #0#21;
               enUnidades = #0#5;
               eaSerAlb = #0#29;
               enNumAlb = #0#0;
               enLinAlb = #0#1;
               efFecha = #1#1;
               |SUB_EJECUTA_NP "evarz030";
               #0#5 = enUnidades; |PINTA #0#5;
          |FINSI;
     |FINSI;

     |SI #0#5 [ 0; |ACABA; |FINSI;
     qArti = #0#2;
     qUnid = #0#5;
     |HAZ ComproMin;
     |SI enErr ! 0;
          |ERROR;
     |FINSI;
|FPRC;

|PROCESO a_cta;|TIPO 11;
     nModo = (FEntrada / 100) ! 0;
     nTecla = FSalida;

     |HAZ EsGestral; nSwGestral = FSalida;
     |HAZ EsOrts; nSwOrts = FSalida;

     |SI nTecla = 10;     ||F2
          |VARIABLES; {20} aPopup = ""; |FINSI;
          aPopup1 = "-1";  || Si fuera -1 en la posicion
          aPopup2 = 5;
          aPopup3 = "<F3> Estado del pedido";
          aPopup4 = "<F5> Doble Stock/Kit";

          |HAZ EsQDClor;
          |SI FSalida = 0; aPopup4 = "<F5> Boletin Anlisis"; |FINSI;
          |HAZ EsOrts;
          |SI FSalida = 0; aPopup4 = "<F5> Combinacin Pedidos"; |FINSI;

          aPopup5 = "<F6> Entregas a cuenta albaran";
          aPopup6 = "<F8> Descripcin ampliada";
          aPopup7 = "<F12> Entregas a cuenta pedido";

          |SI nSwGestral = 0;
               aPopup6 = "<F9> Captura Lector";
               aPopup7 = "<F12> Entregas a cuenta pedido";
               aPopup2 = 5;
          |FINSI;

          IaPopup = aPopup1  <-;
          |ESPECIFICA "TRACKPOPUP", aPopup;
          nSal = FSalida;
          |SI FSalida = 1; nSal = 11; |FINSI;
          |SI FSalida = 2; nSal = 13; |FINSI;
          |SI FSalida = 3; nSal = 14; |FINSI;
          |SI FSalida = 4; nSal = 16; |FINSI;
          |SI FSalida = 5; nSal = 9; |FINSI;
          |SI nSwGestral = 0;
               |SI FSalida = 4; nSal = 17; |FINSI;
               |SI FSalida = 5; nSal = 9; |FINSI;
          |FINSI;
          FSalida = nSal;
          |SI FSalida = 0; |ERROR; |ACABA; |FINSI;
          nTecla = FSalida;
     |FINSI;

     |SI nTecla = 13;         || F5
/*
          |HAZ EsAlbadis; ||*
          |SI FSalida = 0;
               eaDocu = "AV";
               eaSerie = #0#29;
               enCodigo = #0#0;
               enLinea = #0#1;
               enPrecio = #0#6;
               enPVerde = #0#62;
               |HAZ BseVerUni;
               |ERROR; |ACABA;
          |FINSI;
*/
          |HAZ EsOrts;
          |SI FSalida = 0;
               /*
               eaDocu = "agifa071";
               eaSerie = #0#29;
               enCodigo = #0#0;
               enLinea = #0#1;
               |SUB_EJECUTA_NP "dsz99905;VER";
               */
               eaSerie = #0#31;
               enCodigo = #0#12;
               enLinea = #0#21;
               |SUB_EJECUTA_NP "ortsz009";
          |FINSI;
          |HAZ EsQDClor;
          |SI FSalida = 0;
               eaArticulo = #0#2;
               eaSerie = #0#29;
               enCodigo = #0#0;
               enLinea = #0#1;
               eaPartida = #0#49;
               eaTipo = "V";
               ||SUB_EJECUTA_NP "qdclor10;VER";
               |SUB_EJECUTA_NP "qdclor10;CON";
          |FINSI;

          |HAZ VerKit;
          |HAZ VerDobleUniV;
          |ERROR; |ACABA;
     |FINSI;

     |SI nTecla = 11;
         ser_ped = #0#31;
         num_ped = #0#12;
         lin_ped = #0#21;

         |SUB_EJECUTA_NP "dsy00002";
         |ERROR;
         |ACABA;
     |FINSI;

     aAlfa = #0#2; |QBF aAlfa;
     |SI nTecla = 16; |Y aAlfa ! "";
          |SI #42#202 = "S"; |O #42#40 = "S";
               aTipoDA = "A"; |HAZ VerDA;
          |FINSI;
          |ERROR;
     |FINSI;

     |SI nTecla =  9;
       |SI #42#86 = "S";
          TipoCta = "P";
          Cliente = #0#15;
          SPedido = #0#31;
          NPedido = #0#12;
          FPedido = #1#1;
          PPedido = #1#8;
          TPedido = 0;
          BAdela  = 0;
          |SUB_EJECUTA_NP "agis0002";
          |BLIN 24;
          |CONFI "2400NDesea imprimir el recibo? ";
          |SI FSalida = 0;
               ser = SPedido;
               doc = NPedido;
               eaDivisa = #1#68;
               |HAZ ImpreACta;
           |FINSI;
           |ERROR;
        |SINO;
           |MENAV "    Entregas a cuenta desactivadas";
           |ERROR;
        |FINSI;
     |FINSI;

     |SI nTecla =  14;
       |SI #42#86 = "S";
          TipoCta = "A";
          Cliente = #0#15;
          SPedido = #0#29;
          NPedido = #0#0;
          FPedido = #1#1;
          PPedido = #1#8;
          TPedido = 0;
          BAdela  = 0;
          |SUB_EJECUTA_NP "agis0002";
          |BLIN 24;
          |CONFI "2400NDesea imprimir el recibo? ";
          |SI FSalida = 0;
               ser = SPedido;
               doc = NPedido;
               eaDivisa = #1#68;
               |HAZ ImpreACta;
           |FINSI;
           |ERROR;
        |SINO;
           |MENAV "    Entregas a cuenta desactivadas";
           |ERROR;
        |FINSI;
     |FINSI;


     |SI nTecla = 17;
          |HAZ EsGestral;
          |SI FSalida = 0;
               |SI nModo = 4;
                    |MENAV "0000Opcion no disponible en consulta...";
               |SINO;
                    |HAZ GestralLector;
               |FINSI;
               |ACABA;
          |FINSI;
     |FINSI;

     |SI nTecla = 1; |O nTecla = 7;
          |SI #agifa142#242 = "N"; |HAZ CheqPartiBlan; |FINSI;

          |HAZ EsExtintor;
          |SI FSalida = 0;
               enModo = enModoCab210;
               eaSerie = #0#29;
               enCodigo = #0#0;
               |SUB_EJECUTA_NP "extz0016;ADJ";
               |SI enCodigo = 0; |ERROR; |ACABA; |FINSI;
          |FINSI;

          |HAZ EsGofre;
          |SI FSalida = 0;
               eaSerie = #0#29;
               enCodigo = #0#0;
               eaCliente = #1#3;
               |SUB_EJECUTA_NP "gofrez01";
          |FINSI;
     |FINSI;
|FPRC;

|CALCULO pantcomp2;|TIPO 13;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo ! 3;
          |HAZ visual_totales2; || Visualiza los totales
     |FINSI;
|FCAL;

|PROCESO decim2;
     |SI Campo = 6; |O Campo = 36;
          |SI FSalida = 11; || F3
               |HAZ EsRocai;
               |SI FSalida = 0;
                    enPrecio = #0#6;
                    enComision = #0#10;
                    eaCliente = #1#3;
                    eaArticulo = #0#2;
                    |SUB_EJECUTA_NP "rocaiz01";
                    #0#10 = enComision; |PINTA #0#10;
                    #0#6 = enPrecio; |PINTA #0#6;
               |FINSI;
          |FINSI;
          |SI FSalida = 13;
               |HAZ EsAparecida;
               |SI FSalida = 0;
                    enPrecio = #0Campo;
                    eaArticulo = #0#2;
                    eaCliente = #1#3;
                    |SUB_EJECUTA_NP "aparm010";
                    #0Campo = enPrecio; |PINTA #0Campo;
                    |ERROR;
               |FINSI;
          |FINSI;
          |SI FSalida = 14;             || F6
               c_clien = #1#3;
               c_artic = #0#2;
               c_serie = #1#52;
               entrada = 1;
               |SUB_EJECUTA_NP "agifa283.run";
               |ERROR;
          |FINSI;
     |FINSI;
     |SI #1#70 = "D";  || Si la moneda de trabajo es la divisa ...
         #0#6 = #0#36 / #1#69 * #1#74;  || ... recalculo en funcion de la divisa
     |SINO;
         #0#36 = #0#6 / #1#74 * #1#69; || .. recalculo en funcion de la moneda base
     |FINSI;
|FPRC;

|PROCESO Alma7_211; |TIPO 7;
     |SI nSwServida = 1; |ACABA; |FINSI;  ||Tic:4120:48

     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 1; |Y #0#12 = 0;
          |ABRE #21;
          #21#26 = #0#29;
          |LEE 000#21=;
          |CIERRA #21;
          #0#3 = #21#29;
     |FINSI;
|FPRC;

|PROCESO LinDiv7;  |TIPO 7;
     nSwServida = 0;
     |SI nSwAdjInforpor = 1;
          nSwAdjInforpor = 0;
          |PTEC 809;
          |PTEC 816;
          |PTEC 812;
     |FINSI;

     |ABRE #42; |LEE 000#42p; |CIERRA #42;

     |ABRE #279; |LEE 000#279p; |CIERRA #279;
     nPreDtoAnt = 0;

     nModo = (FEntrada / 100) ! 0;

     |HAZ PintaMedidaV;

     |ABRE #agifa321;
     |LEE 001#agifa321.p;  || Leo parametros de divisa
     |CIERRA #agifa321;

     |SI ac_divisa ! "S";
          |ATRI R;
          |PINTA 1447, "Precio";
          |PINTA 1470, "I.Total";
          |ATRI r;
     |SINO;
          |SI pintado = 0; || Si divisas estan activadas y no he pintado ...
               |SI #1#70 = "D";   || Si la moneda de trabajo es la divisa la pinto en
                    |ATRI R;         || el encabezado del precio y el importe
                    titdiv = "Precio" + "(" + #1#68 + ")";
                    |PINTA 1444,titdiv;
                    titdiv = "I.Tot." + "(" + #1#68 + ")";
                    |PINTA 1468,titdiv;
                    |ATRI r;
               |SINO;
                    |ATRI R;
                    |PINTA 1447, "Precio";
                    |PINTA 1470, "I.Total";
                    |ATRI r;
               |FINSI;
               |SI #agifa321#3 = "S";  || Si la visualizacion esta activada ...
                    ||mensa = "Precio:            Imp.:              T.Bruto:             T.ALB:            ";
                    ||PINTA 1102,mensa;  || ... pinto la linea de visualizacion
                    |PINTA 1102, "Precio:";
                    |PINTA 1121, "Imp.:";
                    |PINTA 1140, "T.Bruto:";
                    |PINTA 1161, "T.ALB:";
                    |PINTA #0#38; || Pinto precio visual
                    |PINTA #0#39; || Pinto importe visual
                    |SI #1#70 = "D"; || Si la moneda de trabajo es la divisa
                         |PINTA 1149,#1#79;
                         |PINTA 1168,#1#80;
                    |SINO;
                         |PINTA 1149,#1#75;
                         |PINTA 1168,#1#76;
                    |FINSI;
                    pintado = 1;  || Ya hemos pintado
               |FINSI;
          |FINSI;
     |FINSI;

     |SI nModo = 1;
          #0#1 = #0#1 + #agifa142#236 - 1;
     |FINSI;

     || Esto es para que no se de de alta el pedido por relacion,
     || porque la relacion que existe no se puede quitar, ya que
     || al consultar el pedido (shift+F11) los campos se ven mal
     |MODO_RELACION #0, 1, "agifa104", "N", "N";

     |HAZ PintaDes211;

     |HAZ EsInforAlba;
     |SI FSalida = 0;
          |C_V #0#38, 1, "N";
          |C_V #0#39, 1, "N";
          |C_V #0#36, 1, "N";
          |C_V #0#37, 1, "N";
          |PINTA 1101, "쿘atricula:                          ";
          |C_V #0#49, 1, "S";
          |ATRI I; |PINTA 1113, #0#49; |ATRI 0;
     |FINSI;
     |HAZ EsGesisat;
     |SI FSalida = 0;
          |C_V #0#38, 1, "N";
          |C_V #0#39, 1, "N";
          |C_V #0#36, 1, "N";
          |C_V #0#37, 1, "N";
          |PINTA 1101, "쿘aquina..:                          ";
          |HAZ GesiLeeMaqui;
          aAlfa = #0#49; #0#49 = eaMatri;
          |C_V #0#49, 1, "S";
          |ATRI I; |PINTA 1113, #0#49; |ATRI 0;
          |C_V #0#49, 1, "N";
          #0#49 = aAlfa;
     |FINSI;
     |HAZ EsVigor;
     |SI FSalida = 0;
          |HAZ VigorPin71;
     |FINSI;
     |HAZ EsQDClor;
     |SI FSalida = 0;
          |HAZ PinQDClor71;
     |FINSI;
     |HAZ EsInforpor;
     |SI FSalida = 0;
          |ATRI R; |PINTA 1001, "쿛romocion      "; |ATRI 0;
          |PINTA 1101, "               ";
          |C_V #0#49, 1, "S"; |PINTA #0#49;
     |FINSI;
     |HAZ EsChampiEmar;
     |SI FSalida = 0;
          eaTipo      = "AV";
          eaSerie     = #0#29;
          enCodigo    = #0#0;
          enLinea     = #0#1;
          |HAZ ChampiPinEmar;
     |FINSI;
     |HAZ EsOrts;
     |SI FSalida = 0;
          |HAZ OrtsPin211;
     |FINSI;

     |SI enPedCab ! 0;
          |HAZ AdjudicaPdte;
     |FINSI;
|FPRC;

|PROCESO visual_precio2; || Pinta el precio visual.
|SI #1#70 = "D";  || Si la moneda de trabajo es la divisa ...
  #0#38 = #0#6;   || ... el campo visualiz. es el precio en moneda base
  |PINTA #0#36;
|SINO;            || Si la moneda de trabajo es la moneda base ...
  #0#38 = #0#36;  || ... el campo visual. es el precio en divisa
  |PINTA #0#6;
|FINSI;
|SI ac_divisa = "S"; |Y #agifa321#3= "S";
  |PINTA #0#38; || Si las divisas y la visualizacion estan activadas, pinto
|FINSI;
|FPRC;


|PROCESO visual_importe2;  || Pinta el importe visual
|SI #1#70 = "D";  || Si la moneda de trabajo es la divisa ...
  #0#39 = #0#9;   || el campo visualiz. es el importe en moneda base
  |PINTA #0#37;
|SINO;            || Si la moneda de trabajo es la moneda base ...
  #0#39 = #0#37;  || el campo visualiz. es el importe en divisa
  |PINTA #0#9;
|FINSI;
|SI ac_divisa = "S"; |Y #agifa321#3= "S";
  |PINTA #0#39;   || Si las divisas y la visualizacion estan activadas, pinto
|FINSI;
|FPRC;

|PROCESO visual_totales2;
     |ABRE #agifa321;
     |LEE 001#agifa321.p;
     |SI #1#70 = "D";
          |SI ac_divisa = "S"; |Y #agifa321#3= "S";
               |PINTA 1149,#1#79;
               |PINTA 1168,"        ";
               |PINTA 1168,#1#80;
          |FINSI;
          |CIERRA #agifa321;
          |PINTA 1355,#1#75;
          |PINTA 1368,#1#76;
     |SINO;
          |SI ac_divisa = "S"; |Y #agifa321#3= "S";
               |PINTA 1149,#1#75;
               |PINTA 1168,"        ";
               |PINTA 1168,#1#76;
          |FINSI;
          |CIERRA #agifa321;
          |PINTA 1355,#1#15;
          |PINTA 1368,#1#67;
     |FINSI;
|FPRC;

|PROCESO tot_ped_div;
     |SI #2#37 = "B";  || Asigna campos visual. y no visual. en el pedido segun la moneda de trabajo
       #2#45 = #2#11;
       #2#46 = #2#12;
       #2#47 = #2#13;
       #2#48 = #2#42;
       #2#50 = #2#43;
       #2#49 = #2#44;
     |SINO;
       #2#45 = #2#42;
       #2#46 = #2#43;
       #2#47 = #2#44;
       #2#48 = #2#11;
       #2#50 = #2#12;
       #2#49 = #2#13;
     |FINSI;
|FPRC;

|PROCESO AgeTrans;
     |ABRE #200;
     #200#0 = #1#88;
     |LEE 000#200=;
     |CIERRA #200;

     #1#9 = #200#1;
|FPRC;

|PROCESO comp_div; |TIPO 0;
     nModo = (FEntrada / 100) ! 0;

     ||컴컴컴컴컴컴컴Modulo 000577
     |HAZ EsDiagram;
     |SI FSalida = 0;
          |HAZ DiagAdjPed;
          |SI FSalida ! 0;
               |ERROR; |ACABA;
          |FINSI;
     |FINSI;

     |HAZ DecimPedido;
     |SI #0#12 ! 0;
          |ABRE #2;
          #2#0   = #0#12;
          #2#25  = #0#31;
          |LEE 101#2=;
          |SI FSalida = 0;
               |SI #2#35 ! #1#68; |O #2#37 ! #1#70;
                    |MENAV "0000No coincide la divisa y/o la moneda de trabajo";
                    |ERROR; |ACABA;
               |FINSI;
               |SI #2#4 ! #1#3;  || (7)
                    |MENAV "0000Este Pedido es de otro Cliente...";
                    |ERROR; |ACABA;
               |FINSI;
               |SI #1#84 ! #2#57; |Y nModo = 1;
                    |AVISO;
                    aAlfa = "0000NPedido con Dir. Entrega [" + #2#57 + "]."+&13+"Continuar :";
                    |CONFI aAlfa;
                    |SI FSalida ! 0;
                         |ERROR; |ACABA;
                    |FINSI;
               |FINSI;

               |SI #1#88 = 0;
                    |HAZ EsAlbero;
                    |SI FSalida ! 0;
                         #1#88 = #2#60;
                         |HAZ AgeTrans;
                    |FINSI;
               |FINSI;

               |HAZ EsOrts;   ||Aviso agencia quitado para el modulo
               |SI #1#88 ! #2#60; |Y FSalida ! 0;
                    |HAZ EsTagloma;
                    |SI FSalida = 0;    || modulo
                         |AVISO;
                         aAlfa = "0000NAgencia del Pedido distinta a la del Albaran. Actualizar el Pedido";
                         |CONFI aAlfa;
                         |SI FSalida = 0;
                             #2#60 = #1#88;
                             |GRABA 020#2a;
                         |FINSI;
                    |SINO;         || la estandar
                         |AVISO;
                         aAlfa = "0000NAgencia del Pedido distinta a la del Albaran. Recoger la del Pedido";
                         |CONFI aAlfa;
                         |SI FSalida = 0;
                             #1#88 = #2#60;
                             |HAZ AgeTrans;
                         |FINSI;
                    |FINSI;
               |FINSI;
          |SINO;
               |MENAV "0000El pedido no existe...";
               |ERROR;
          |FINSI;
          |CIERRA #2;
     |FINSI;
|FPRC;

|PROCESO DecimPedido; |TIPO 0;
     |ABRE #agifa324;
     pintado = 0;  ||Controla pintados de las lineas
     #agifa324#0 = #agifa104#35;
     |LEE 001#agifa324.=;   || Leo la divisa
     nDeci_DivP    = #agifa324#7;   || Decimales de la divisa
     nDeci_PreDivP = #agifa324#9;  || Decimales en el precio de la divisa
     |CIERRA #agifa324;

     |SI #2#37 = "B";   ||Si trabajo con la moneda base ...
          nDeci_TotVisP   = #agifa324#9;
          nDeci_TotNoVisP = #agifa324#7;
     |SINO;     ||Si trabajo con la divisa ...
          nDeci_TotVisP   = #agifa324#7;
          nDeci_TotNoVisP = #agifa324#9;
     |FINSI;
|FPRC;

|PROCESO Llena211; |TIPO 6;
     |SI nSwServida = 1; |ACABA; |FINSI;  ||Tic:4120:48

     nTecla = FSalida;
     aConte = Contenido;

     |ABRE #4;
     #4#0 = #0#2;
     |LEE 000#4=;
     |SI FSalida ! 0;
          eaArticulo = #0#2;
          |SUB_EJECUTA_NP "dsz99912;ARTI";
          |SI enSalida ! 0; |ERROR; |ACABA; |FINSI;
     |FINSI;
     |CIERRA #4;

     |SI #0#12 = 0; |Y #0#21 = 0; || Sin Pedido
          |C_M #0#3, 1, "S";
          |SI #0Campo ! aConte;
               eaArticulo = #0#2;
               eaCliente = #1#3;
               |HAZ DefectoMediV;
               #0#51 = enMedida1;
               #0#52 = enMedida2;
               #0#53 = enMedida3;
               |HAZ PintaMedidaV;
          |FINSI;
          |HAZ DobleArtiV;
          |SI eaSw2Stock = "S"; |ACABA; |FINSI;
     |SINO;
          |C_M #0#3, 1, "N";
     |FINSI;
     eaArticulo = #0Campo;
     |HAZ LlenaArticulo;
     |SI FSalida = 0;
          #0Campo = eaArticulo;
          |PINTA #0Campo;
     |SINO;
          |ERROR; |ACABA;
     |FINSI;

     |HAZ EsGesisat;
     |SI FSalida = 0;
          |C_M #0#3, 1, "S";
     |FINSI;

     FSalida = nTecla;
|FPRC;

|PROCESO PideArt211;  |TIPO 7;
     |SI #0#12 ! 0; |ACABA; |FINSI;

     |HAZ EsTagloma;
     |SI FSalida = 0;
          |MENSA "0000<F5> Consulta articulos pendientes  <F6> Modificacion unidades pendientes";
     |FINSI;
     |C_M #0#2, 1, "S";
     |C_M #0#3, 1, "N";

     |SI #0#2 ! "                    ";
         |ABRE #4;
         #4#0 = #0#4;
         |LEE 000#4=;
         |SI FSalida ! 0;  |DDEFECTO #4;  |FINSI;
         |CIERRA #4;
         |SI #4#176 = "S";
             |C_M #0#2, 1, "N";
             |C_M #0#3, 1, "N";
             |ACABA;
         |FINSI;
     |FINSI;

     |ABRE #910; |LEE 000#910p; |CIERRA #910;

     |SI #910#2 [ 2;    |ACABA;  |FINSI;

     eAlfa = #0Campo;
     |SUB_EJECUTA_NP "dsz99990";                 || Por Pantalla

     |SI eAlfa = "-1";  |PTEC 807;  |ACABA;  |FINSI;
     |SI eAlfa = "-2";              |ACABA;  |FINSI;

     eaArticulo = eAlfa;      ||  700000-4215

     #0Campo = eAlfa;
     |PINTA #0Campo;
     |PTEC 802;
|FPRC;

|PROCESO Tipo7Uni;  |TIPO 7;
     |SI nSwServida = 1; |ACABA; |FINSI;  ||Tic:4120:48

     aAlfa = "0000<F5> Envases";
     |HAZ EsEvaristo;
     |SI FSalida = 0;
          aAlfa = "0000<F7>Desglose Etiqueta";
     |FINSI;
     |MENSA aAlfa;

     |SI #4#176 = "N";  |ACABA;  |FINSI;

     eaTipo        = "AV";
     eaSerie       = #0#29;
     enCodigo      = #0#0;
     enLinea       = #0#1;
     efFecha       = #1#1;
     eaArticulo    = #0#2;
     enAlmacen     = #0#3;
     enUnidades    = #0#5;
     enTBruto      = #0#7;
     eaAbono       = #1#43;
     enTarifa      = #6#39;
     eaSeriePedido = #0#31;
     enCodigPedido = #0#12;
     enLineaPedido = #0#21;
     eaCliente     = #1#3;
     eaPedRese     = #3#22;
     enCamBas      = #1#69;
     eaMoneda      = #1#70;
     enCamDiv      = #1#74;
     |SUB_EJECUTA_NP "dsz00002";
     eaPedRese     = "N";
     #0#3    = enAlmacen;
     #0#5    = enUnidades;
     nPrecio = enTBruto / enUnidades;
     |SI #1#70 = "D";  || Si la moneda de trabajo es la divisa ...
          #0#36 = nPrecio;
     |SINO;
          #0#6  = nPrecio;
     |FINSI;

     |PTEC 802;
     |PTEC 802;
|FPRC;

|PROCESO Tipo11211;  |TIPO 11;
     |SI FSalida = 7;  |Y #4#176 = "S";
         |MENAV "      Imposible abortar;  Termine de introducir la linea y efectue una Baja.";
         |ERROR;
     |FINSI;
|FPRC;

|PROCESO Tipo5_211;  |TIPO 5;
     nModo = (FEntrada / 100) ! 0;
     |SI PARAMETRO = "primicias";
          eaCliente = #1#3;
          eaRepre = #1#6;
          eaSerie = #1#52;
          enCodigo = #1#0;
          enModo = nModo;
          |SI nModo = 2;
               |ABRE #65;
            ||   |HAZ DesActPrimi;
               |CIERRA #65;
          |FINSI;
          |SI nModo = 1; |O nModo = 4;
               |GRABA 020#1a;
          |FINSI;
          |LIBERA #1;
          |SUB_EJECUTA_NP "primz004";
          |SI enMenuPrimi = 2; |O enMenuPrimi = 3;
               |LEE 121#1=;
               |HAZ CargaPrimicia;
          |FINSI;
          |PTEC 806;
     |FINSI;
     |SI PARAMETRO = "vallcorba";
          eaCliente = #1#3;
          eaRepre = #1#6;
          eaSerie = #1#52;
          enCodigo = #1#0;
          enBultos = #1#2;
          enModo = nModo;
          |SI nModo = 1; |O nModo = 4;
               |GRABA 020#1a;
          |FINSI;
          |LIBERA #1;
          |SUB_EJECUTA_NP "vallcz01";
          |SI enMenuVallc = 2; |O enMenuVallc = 3;
               |LEE 121#1=;
               #1#2 = enBultos;
               |HAZ CargaVallcorba;
          |FINSI;
          |PTEC 806;
     |FINSI;

     |HAZ Gui211;

     |SI nModo ! 4;
          |HAZ actal;
     |FINSI;
|FPRC;

|PROCESO Gui211;
     |HAZ EsInforpor;
     |SI FSalida ! 0; |O nModo ! 1; |O PARAMETRO ! "001928"; |ACABA; |FINSI;
     eaCliente = #1#3;
     eaRepre = #1#6;
     eaTmpGui = "tg" + Usuario;
     |SUB_EJECUTA_NP "guiz0004";
     |DDEF aAlfa;
     aAlfa = aAlfa + "guiw0002";
     |CARGA_DEF aAlfa, guiw0002@;
     |SI FSalida = 0;
          |NOME_DAT #guiw0002@#eaTmpGui#;
          |ABRE #guiw0002@;
          |LEE 000#guiw0002@.p;
          |PARA; |SI FSalida = 0; |HACIENDO;
               |ABRE #4;
               #4#0 = #guiw0002@#9;
               |LEE 000#4=;
               |CIERRA #4;
               |DDEFECTO #0;
               #0#29 = #1#52;
               #0#0 = #1#0;
               #0#1 = #guiw0002@#0;
               #0#2 = #guiw0002@#9;
               #0#3 = 1;
               #0#4 = #guiw0002@#4;
               #0#5 = #guiw0002@#2;
               #0#6 = #guiw0002@#10;
               #0#8 = #guiw0002@#11;
               #0#10 = #guiw0002@#12;
               #0#11 = #guiw0002@#13;
               #0#12 = #guiw0002@#8;
               #0#13 = #4#2;
               #0#15 = #1#3;
               #0#16 = #1#34;
               #0#17 = #1#35;
               #0#33 = #guiw0002@#14;
               #0#31 = #guiw0002@#7;
               #0#12 = #guiw0002@#8;
               #0#21 = #guiw0002@#3;
               aDespreciar = #guiw0002@#5;
               |HAZ liacarti;
               |HAZ TotalLin71;
               |GRABA 020#0n;
               |LEE 000#guiw0002@.s;
          |SIGUE;
          |CIERRA #guiw0002@;
          |DELINDEX #guiw0002@;
          |DESCARGA_DEF #guiw0002@;
          |PTEC 806;
     |FINSI;
|FPRC;

|PROCESO Dto211; |TIPO 0;
     |SI #0Campo ! Contenido;
          enDescuento1 = #0#8;
          enDescuento2 = #0#33;
          eaTComision  = #0#16;
          eaCliente    = #1#3;
          eaArticulo   = #0#2;
          eaRepre      = #1#6;
          efFecha      = #1#1;
          enDirEnt = #1#84;
          enAlmacen = #0#3;
          |HAZ Comisiones;
          ||컴컴컴컴컴컴컴횺arhuenda
          |HAZ ComiMarhu;
          #0#10 = enComision; |PINTA #0#10;
          |HAZ ComiOrts211;
     |FINSI;

     |HAZ TotalLin71;
     ||컴컴컴컴컴컴컴컴컴
     |HAZ EsTecatel;
     |SI FSalida = 0;
          art_dt = #0#2;
          dtos_1 = #0#8;
          dtos_2 = #0#33;
          |HAZ TecaCheqFijo;
          |SI FSalida ! 0; |ERROR; |ACABA; |FINSI;
     |FINSI;
     ||컴컴컴컴컴컴컴컴컴
     eaArticulo = #0#2;
     enPrecio = #0#6;
     enDto1 = #0#8;
     enDto2 = #0#33;
     |HAZ CheqPCM_PVP;

     |SI #279#3 = "S";
          eaArticulo = #0#2;
          enPrecio = #0#6;
          enDto1 = #0#8;
          enDto2 = #0#33;
          nNume =  (enPrecio < enDto1) < enDto2;
          |SI nNume ! nPreDtoAnt;
               |SUB_EJECUTA_NP "dsz00100";
               |SI enError ! 0; |ERROR; |ACABA; |FINSI;
               nPreDtoAnt = nNume;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO BseguiAdj;
     |HAZ EsAlbadis; ||*
     |SI FSalida = 0;
          eaSeriePedido = #3#28;
          enCodigPedido = #3#0;
          enLineaPedido = #3#1;
          eaSerie = #0#29;
          enCodigo = #0#0;
          enLinea = #0#1;
          |SI nSwBsegui = 1; |HAZ BseAdjUniV1; |FINSI;
          |SI nSwBsegui = 2; |HAZ BseAdjUniV2; |FINSI;
     |FINSI;
|FPRC;

|PROCESO MinC211;
     #refere2@#29 = #1#52;
     #refere2@#0 = #1#0;
     #refere2@#1 = 001;
|FPRC;

|PROCESO MaxC211;
     #refere2@#29 = #1#52;
     #refere2@#0 = #1#0;
     #refere2@#1 = 999;
|FPRC;

|PROCESO Consulta071; |TIPO 66;
     nLin = 0;
     |DDEF aAlfa;
     aAlfa = aAlfa + "agifa071";
     |CARGA_DEF aAlfa, refere2@;
     |SI FSalida = 0;
          |ABRE #refere2@;
          |CONSULTA_F_CLAVE #1#refere2@, MinC211, MaxC211;
          |SI FSalida = 0; nLin = #refere2@#1; |FINSI;
          |CIERRA #refere2@;
          |DESCARGA_DEF #refere2@;
     |FINSI;
     |SI nLin ! 0;
          |PTEC 802;
          aAlfa = ("000" + nLin) % -103;
          aPtec = aAlfa % 301; nPtec = &aPtec;
          |PTEC nPtec;
          aPtec = aAlfa % 201; nPtec = &aPtec;
          |PTEC nPtec;
          aPtec = aAlfa % 101; nPtec = &aPtec;
          |PTEC nPtec;
     |FINSI;
|FPRC;

|PROCESO PintaLinArt;
     |ABRE #4;
     #4#0 = #0#2;
     |LEE 000#4=;
     |CIERRA #4;
     |DDEFECTO #553;
     |ABRE #553;
     #553#0 = #4#125;
     |LEE 000#553=;
     |CIERRA #553;
     |PINTA 2302, #553#1;
|FPRC;

|PROCESO Arti0_211; |TIPO 0;
     |SI nSwServida = 1; |ACABA; |FINSI;  ||Tic:4120:48

     |SI #0Campo ! Contenido; |O nModo = 1;
          |SI #0#12 = 0;
               |ABRE #4;
               #4#0 = #0#2;
               |LEE 000#4=;
               |CIERRA #4;
               #0#11 = #4#30; |PINTA #0#11;

               |HAZ EsQDClor;
               |SI FSalida = 0;
                    eaArticulo = #0#2;
                    eaSerie = #0#29;
                    enCodigo = #0#0;
                    enLinea = #0#1;
                    eaPartida = #0#49;
                    eaTipo = "V";
                    |SUB_EJECUTA_NP "qdclor10;ALTA";
                    |HAZ PinQDClor71;
               |FINSI;
          |FINSI;
     |FINSI;

     |SI nTecla = 13; || F5
          |HAZ EsTagloma;
          |SI FSalida = 0;
               eaCliente = #1#3;
               eaArticulo = #0#2;
               |HAZ TagCogeArt;
               |SI FSalida = 0;
                    #0#2 = eaArticulo; |PINTA #0#2;
                    #0#5 = enUnidades; |PINTA #0#5;
                    #0#61 = 9; ||| Marco campo INTERNO con 9 !!!
                    ||..
                    eaArticulo = #0#2;
                    eaCliente = #1#3;
                    |HAZ DefectoMediV;
                    #0#51 = enMedida1;
                    #0#52 = enMedida2;
                    #0#53 = enMedida3;
                    |HAZ PintaMedidaV;
                    |ABRE #4;
                    #4#0 = #0#2;
                    |LEE 000#4=;
                    |CIERRA #4;
                    #0#4 = #4#1; |PINTA #0#4;
               |SINO;
                    |ERROR; |ACABA;
               |FINSI;
          |FINSI;
     |FINSI;
     |SI nTecla = 14; || F6
          |HAZ EsTagloma;
          |SI FSalida = 0;
               eaCliente = #1#3;
               eaArticulo = #0#2;
               |SUB_EJECUTA_NP "tagz0007";
               |ERROR; |ACABA;
          |FINSI;
     |FINSI;
     |HAZ EsJamaica;
     |SI FSalida = 0;
          aAlfa = "cafe0026;CHEQFAM" + #0#2 + #1#3;
          |SUB_EJECUTA_NP aAlfa;
          |SI enError ! 0; |ERROR; |ACABA; |FINSI;
     |FINSI;
|FPRC;

|PROCESO MinAlma211;
     #5#0 = #0#2;
     #5#1 = 1;
|FPRC;

|PROCESO MaxAlma211;
     #5#0 = #0#2;
     #5#1 = 99999;
|FPRC;

|PROCESO Alma6_211; |TIPO 6;
     |SI nSwServida = 1; |ACABA; |FINSI;  ||Tic:4120:48

     |ABRE #5;
     #5#0 = #0#2;
     #5#1 = #0#3;
     |LEE 000#5=;
     |SI FSalida ! 0;
          eaArticulo = #0#2;
          enAlmacen = #0#3;
          |SUB_EJECUTA_NP "dsz99912;ALMA";
          |SI enSalida ! 0; |ERROR; |ACABA; |FINSI;
     |FINSI;
     |CIERRA #5;
|FPRC;

|PROCESO Alma0_211; |TIPO 0;
     |SI nSwServida = 1; |ACABA; |FINSI;  ||Tic:4120:48

     |SI FSalida = 13; || F5;
          |ABRE #5;
          #5#0 = #0#2;
          #5#1 = #0#3;
          |LEE 000#5];
          |CONSULTA_F_CLAVE #1#5, MinAlma211, MaxAlma211;
          |SI FSalida = 0;
               #0#3 = #5#1; |PINTA #0#3;
          |SINO;
               |ERROR; |ACABA;
          |FINSI;
          |CIERRA #5;
     |FINSI;

     |SI #0#12 = 0; |Y #0#21 = 0; || Sin pedido
          |HAZ PrecioArti;
     |FINSI;
     |HAZ liinfo;
     |HAZ mirespor211;
|FPRC;

|PROCESO verpre211;
     |ABRE #65;
     |SELECT #3#65;
     #65#10 = #1#3;  || Cliente.
     #65#0  = #0#2;  || Articulo.
     #65#1  = "31.12.2300";  || Fecha.
     #65#2  = "AV";  || Operacion.
     prevul = 0;
     |LEE 000#65];
     |SI FSalida = 0;
          |LEE 000#65a;
     |SINO;
          |LEE 000#65u;
     |FINSI;
     |SI FSalida = 0; |Y #65#10 = #1#3; |Y #65#0 = #0#2; |Y #65#2 = "AV";
          prevul = #65#9 / #1#74 * #1#69;  || Calculo el importe en divisas
          |SI #1#70 = "D";                     || Si la moneda de trabajo es la divisa ...
               prevul = prevul ! nDeci_PreDiv;
          |SINO;                               || Si la moneda de trabajo es la moneda base ...
               prevul = prevul ! nDeci_PreBase;
          |FINSI;
     |FINSI;
     |CIERRA #65;
|FPRC;

|PROCESO liinfo;|TIPO 0;
     |SI #42#101 ! "S";
          mensaje3 = "0410Stock Disponible Almacen : " + #5#39+"     Stock Minimo : "+#5#6;
          |MENSA mensaje3;
     |SINO;
          |HAZ verpre211;
          precom = #4#133 / #1#74 * #1#69;  || Calculo el importe en divisas
          prepcm = #4#9 / #1#74 * #1#69;    || Calculo el importe en divisas
          |SI #1#70 = "D";                     || Si la moneda de trabajo es la divisa ...
               precom = precom ! nDeci_PreDiv;
               prepcm = prepcm ! nDeci_PreDiv;
         |SINO;                               || Si la moneda de trabajo es la moneda base ...
               precom = precom ! nDeci_PreBase;
               prepcm = prepcm ! nDeci_PreBase;
         |FINSI;
         mensaje3 = "0401Disponible.: [" + #5#39 + "] Min.: [" + #5#6 + "] PC.: [" + precom + "] PMC.: [" +prepcm+"] PVU.: [" + prevul+"]";
         mensaje3 = mensaje3 % 180;
         |MENSA mensaje3;
     |FINSI;
|FPRC;

|PROCESO PrecioArti;
     |ABRE #6;
     #6#0 = #1#3;
     |LEE 020#6=;
     |CIERRA #6;
     |ABRE #4;
     #4#0 = #0#2;
     |LEE 000#4=;
     |CIERRA #4;

     #0#15 = #1#3;
     #0#13 = #4#2;
     |SI #0#21 = 0;
          #0#16 = #1#34;
          #0#17 = #1#35;
     |FINSI;

     modo = (FEntrada / 100) ! 0;
     fed_dt = #1#1;   || Fecha....
     art_dt = #0#2;   || Articulo.
     cli_dt = #0#15;  || Cliente..
     fam_dt = #0#13;  || Familia.
     iva_dt = #4#30;  || Tipo Iva.
     dtos_2 = 0;      || Descuento 2.
     dto_pt = 0;      || Descuento Ptas.
     dtos_1 = 0;      || Descuento 1.
     pvp_ve = 0;      || Precio Venta.
     tarifa = #6#39;  || Tarifa Cliente....
     gru_dt = #6#158; || Grupo Cliente.
     nPromo = #1#89;
     |SI #0#35 ! 0;
          uni_dt = #0#35;
     |SINO;
          uni_dt = #0#5;
     |FINSI;
     uni_dt2 = #0#48;
     enMensaje = 0;
     aParam = "";
     eaSerie = #0#29;
     enDirEnt = #1#84;
     enAlmacen = #0#3;
     |SI modo = 1; |O articulo ! #0#2; |O enPromo = 2;
          |SI enPromo = 2; pvp_ve = #0#6; |FINSI;
          |SI #4#176 = "S";  enMensaje = 1;  |FINSI;
          |HAZ calcdtos;
          |SI enPromo = 2;       || solo cambia el precio
               #0#6 = pvp_ve;
          |SINO;
               #0#6 = pvp_ve - dto_pt;   || Precio Venta. sin iva.
               #0#8 = dtos_1;            || 1 Dto.
               #0#33 = dtos_2;            || 2 Dto.
          |FINSI;
          |HAZ decim2;
          |PINTA #0#6;
          |PINTA #0#33;
          |PINTA #0#8;

          enDescuento1 = #0#8;
          enDescuento2 = #0#33;
          eaTComision  = #0#16;
          eaCliente    = #1#3;
          eaArticulo   = #0#2;
          eaRepre      = #1#6;
          efFecha      = #1#1;
          enDirEnt = #1#84;
          enAlmacen = #0#3;
          |HAZ Comisiones;
          ||컴컴컴컴컴컴컴횺arhuenda
          |HAZ ComiMarhu;
          #0#8 = enDescuento1;
          #0#10 = enComision;
          |HAZ ComiOrts211;
          #0#6 = pvp_ve - dto_pt;   || Precio Venta. sin iva.
          ||컴컴컴컴컴컴컴컴컴컴컴컴
          |PINTA #0#10;
          |PINTA #0#8;
     |FINSI;
|FPRC;

|PROCESO Alma211_66; |TIPO 66;
     |ABRE #29;
     #29#0 = #0#3;
     |LEE 000#29];
     |CONSULTA_CLAVE #1#29;
     |SI FSalida = 0;
          #0#3 = #29#0;
          |PINTA #0#3;
     |SINO;
          |ERROR;
     |FINSI;
     |CIERRA #29;
|FPRC;

|PROCESO EntraDes211; |TIPO 7;
     |SI nSwServida = 1; |ACABA; |FINSI;  ||Tic:4120:48

     |HAZ EsTagloma;
     |SI FSalida = 0;
          |MENSA "0000<F2> Cambiar articulo del pedido";
     |FINSI;
|FPRC;

|PROCESO SalDes211; |TIPO 0;
     |SI nSwServida = 1; |ACABA; |FINSI;  ||Tic:4120:48

     nSal = FSalida;
     |HAZ EsTagloma;
     |SI FSalida = 0;
          nSwTagCamPed = 0;
          |SI nSal = 10;           || F2.- Cambio articulo en pedido
               eaArticulo = #0#2;
               |HAZ EsKit;
               |SI FSalida = 0;
                    |MENAV "0000Funcion no permitida para Kits.";
                    |ERROR;
                    |ACABA;
               |FINSI;

               eaArticulo = #0#2;
               |SUB_EJECUTA_NP "tagz0016";
               |SI eaArticulo = #0#2; |ACABA; |FINSI;

               |HAZ EsKit;
               |SI FSalida = 0;
                    |MENAV "0000Funcion no permitida para Kits.";
                    |ERROR; |ACABA;
               |FINSI;

               |ABRE #4;
               #4#0 = eaArticulo;
               |LEE 020#4=;
               |CIERRA #4;

               |ABRE #3;
               #3#28 = #0#31;
               #3#0 = #0#12;
               #3#1 = #0#21;
               |LEE 101#3=;
               |SI FSalida = 0;
                    nSwTagCamPed = 1;

                    aArti = #0#2;
                    #0#2 = #4#0; |PINTA #0#2;
                    #0#4 = #4#1; |PINTA #0#4;

                    eaCliente = #1#3;
                    |HAZ DefectoMediV;
                    #0#51 = enMedida1;
                    #0#52 = enMedida2;
                    #0#53 = enMedida3;
                    |HAZ PintaMedidaV;
                    |HAZ PrecioArti;

                    #3#2 = #0#2;
                    #3#4 = #0#4;
                    #3#50 = enMedida1;
                    #3#51 = enMedida2;
                    #3#52 = enMedida3;
                    |GRABA 020#3a;
                    |SI FSalida = 0;
                         nUni1 = -#3#5;
                         nUni2 = -#3#44;
                         |HAZ ModiStockPedi;
                         aArti = #0#2;
                         nUni1 = #3#5;
                         nUni2 = #3#44;
                         |HAZ ModiStockPedi;
                    |FINSI;
               |SINO;
                    |MENAV "0000Linea Sin Pedido...";
               |FINSI;
               |CIERRA #3;
          |FINSI;
     |FINSI;
     |HAZ PintaDes211;
|FPRC;

|PROCESO ModiStockPedi;
     |ABRE #24;
     |ABRE #4;
     |ABRE #5;
     |DDEFECTO #4;
     |DDEFECTO #5;
     #4#0 = aArti;
     |LEE 101#4=;
     |SI FSalida ! 0; |GRABA 020#4b; |FINSI;
     #5#0 = aArti;
     #5#1 = #3#3;
     |LEE 101#5=;
     |SI FSalida ! 0; |GRABA 020#5b; |FINSI;
     #4#15 = #4#15 + nUni1;
     #4#182 = #4#182 + nUni2;
     |SI #3#22 = "S";
          #4#12 = #4#12 + nUni1;
          #4#104 = #4#104 - nUni1;
          #4#193 = #4#193 - nUni2;
     |FINSI;

     #5#42 = #5#42 + nUni1;
     #5#44 = #5#44 + nUni2;
     |SI #3#22 = "S";
          #5#8 = #5#8 + nUni1;
          #5#39 = #5#39 - nUni1;
          #5#48 = #5#48 - nUni2;
     |FINSI;
     |HAZ ValoraStock;
     |GRABA 0020#4a;
     |GRABA 020#5a;
     #24#0 = aArti;
     #24#1 = #3#3;
     #24#2 = #0#49;
     |LEE 101#24=;
     |SI FSalida = 0;
          #24#16 = #24#16 + nUni1;
          #24#16 = #24#16 + nUni2;
          |GRABA 020#24a;
     |FINSI;
     |CIERRA #5;
     |CIERRA #4;
     |CIERRA #24;
|FPRC;

|PROCESO TagloActPed;
     |ABRE #3;
     #3#28 = #0#31;
     #3#0 = #0#12;
     #3#1 = #0#21;                 || Linea de Pedido.
     |LEE 121#3=;                  || Leo la linea de pedido.
     |SI FSalida = 0;
          nFactor = 1;
          |ABRE #4;
          #4#0 = #3#2;
          |LEE 000#4=;
          |CIERRA #4;
          |SI #4#179 = "S";
               |ABRE #238;
               #238#0 = #4#201;
               |LEE 000#238=;
               |SI FSalida = 0;
                    |SI #238#8 = 1; nFactor = #3#50; |FINSI;
                    |SI #238#8 = 2; nFactor = (#3#50 + #3#51); |FINSI;
                    |SI #238#8 = 3; nFactor = (#3#50 + #3#51 + #3#52); |FINSI;
               |FINSI;
               |CIERRA #238;
          |FINSI;
          #3#47 = #3#12 * nFactor;  || Variacion
          #3#49 = #3#43 * nFactor;  || Servidas
          #3#44 = #3#5 * nFactor; || Unidades
          #3#48 = #3#42 * nFactor; || Pedidas
          #3#4 = #0#4; ||Descri
          #3#8 = #0#8; ||Dto1
          #3#29 = #0#33; ||Dto2
          #3#6 = #0#6;   ||Precio
          #3#38 = #0#36; ||Precio
          #3#40 = #0#38; ||Precio
          #3#50 = #0#51; ||Precio
          #3#51 = #0#52; ||Dto1
          #3#52 = #0#53; ||Dto2
          |GRABA 020#3a;
     |FINSI;
     |CIERRA #3;

     |ABRE #2;
     #2#25 = #0#31;
     #2#0 = #0#12;
     |LEE 121#2=;
     |SI FSalida = 0;
          |HAZ CalCabAgifa104;
          |GRABA 020#2a;
     |FINSI;
     |CIERRA #2;

     |DDEF aAlfa;
     aAlfa = aAlfa + "tagm0079";
     |CARGA_DEF aAlfa, refere1@;
     |SI FSalida = 0;
          |ABRE #refere1@;
          #refere1@#0 = #0#31;
          #refere1@#1 = #0#12;
          |LEE 101#refere1@.=;
          |SI FSalida = 0;
               |SI #refere1@#4 = "S";
                    |SI #refere1@#19 = "X"; |O #refere1@#19 = "P";
                         #refere1@#19 = "A";
                    |FINSI;
               |FINSI;
               |SI #refere1@#5 = "S";
                    |SI #refere1@#20 = "X"; |O #refere1@#20 = "P";
                         #refere1@#20 = "A";
                    |FINSI;
               |FINSI;
               |SI #refere1@#6 = "S";
                    |SI #refere1@#21 = "X"; |O #refere1@#21 = "P";
                         #refere1@#21 = "A";
                    |FINSI;
               |FINSI;
               |GRABA 020#refere1@.a;
          |FINSI;
          |CIERRA #refere1@;

          |DESCARGA_DEF #refere1@;
     |SINO;
          |MENAV "0000Error al cargar 'tagm0079'...";
     |FINSI;
|FPRC;

|PROCESO CreaTmpAlmParti;
     |DELINDEX #83;
     |ABRE #83;
     |ABRE #24;
     #24#0 = #3#2;
     #24#1 = #3#3;
     #24#2 = "";
     |LEE 000#24];
     |PARA; |SI FSalida = 0; |Y #24#0 = #3#2; |Y #24#1 = #3#3; |HACIENDO;
          #83#0 = #24#0;
          #83#1 = #24#1;
          #83#2 = #24#2;
          #83#3 = #24#4; || Ordenado por F.Entrada
          #83#4 = #24#31;
          #83#5 = #24#32;
          |SI #83#4 > 0;
               |GRABA 020#83n;
          |FINSI;
          |LEE 000#24s;
     |SIGUE;
     |CIERRA #24;
     |CIERRA #83;
|FPRC;

|PROCESO MecaPedFinaliza;
     |DDEF aAlfa;
     aAlfa = aAlfa + "mecam006";
     |CARGA_DEF aAlfa, refere2@;
     |SI FSalida = 0;
          |ABRE #refere2@;
          #refere2@#0 = #3#28;
          #refere2@#1 = #3#0;
          #refere2@#2 = #3#1;
          |LEE 000#refere2@.=;
          |CIERRA #refere2@;
          aAlfa = #refere2@#10;
          |DESCARGA_DEF #refere2@;
     |FINSI;
     |SI aAlfa = "S";
          FSalida = 0;
     |SINO;
          FSalida = 1;
     |FINSI;
|FPRC;

|PROCESO BorraPaquete;
     #mecano@#6 = "";
     #mecano@#7 = 0;
     #mecano@#8 = 0;
     |GRABA 020#mecano@.a;
     |LIBERA #mecano@;

     #refere2@#0 = #mecano@#0;
     #refere2@#1 = #mecano@#1;
     #refere2@#2 = #mecano@#2;
     |LEE 101#refere2@.=;
     |SI FSalida = 0;
          #refere2@#7 = "N";
          |GRABA 020#refere2@.a;
          |LIBERA #refere2@;
     |FINSI;
|FPRC;

|DEFBUCLE BorraPaquete;
     #mecano@#3003;
     ;
     #0#29, #0#0, #0#1;
     #0#29, #0#0, #0#1;
     be;
     NULL, BorraPaquete;
|FIN;

|PROCESO MecaBorrPaq;
     |DDEF aPath;
     aAlfa = aPath + "mecam007";
     |CARGA_DEF aAlfa, refere2@;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |ABRE #refere2@;

     aAlfa = aPath + "mecam008";
     |CARGA_DEF aAlfa, mecano@;
     |SI FSalida = 0;
          |BUCLE BorraPaquete;
          |DESCARGA_DEF #mecano@;
     |FINSI;

     |CIERRA #refere2@;
     |DESCARGA_DEF #refere2@;
|FPRC;

----------------------TAGLOMA POSTFORMADOS--------------------------------

|PROCESO TagEsLinPostP;
     nSali = 1; || No es
     |DDEF aAlfa;
     aAlfa = aAlfa + "tagm0056";
     |CARGA_DEF aAlfa, tagm0056@;
     |SI FSalida = 0;
          |ABRE #tagm0056@;
          |SELECT #2#tagm0056@;
          #tagm0056@#0 = "PV";
          #tagm0056@#1 = #0#31;
          #tagm0056@#2 = #0#12;
          #tagm0056@#5 = #0#21;
          |LEE 000#tagm0056@.=;
          nSali = FSalida;
          nTagIncPos = #tagm0056@#4;
          nTagDocPos = #tagm0056@#3;
          aTagDesPos = #tagm0056@#6;
          |CIERRA #tagm0056@;
          |DESCARGA_DEF #tagm0056@;
     |FINSI;
     FSalida = nSali;
|FPRC;

|PROCESO TagEsLinPostA;
     nSali = 1; || No es
     |DDEF aAlfa;
     aAlfa = aAlfa + "tagm0056";
     |CARGA_DEF aAlfa, tagm0056@;
     |SI FSalida = 0;
          |ABRE #tagm0056@;
          |SELECT #2#tagm0056@;
          #tagm0056@#0 = "AV";
          #tagm0056@#1 = #0#29;
          #tagm0056@#2 = #0#0;
          #tagm0056@#5 = #0#1;
          |LEE 000#tagm0056@.=;
          nSali = FSalida;
          |CIERRA #tagm0056@;
          |DESCARGA_DEF #tagm0056@;
     |FINSI;
     FSalida = nSali;
|FPRC;

|PROCESO TagTienePosP;
     nSali = 1; || No es
     |DDEF aAlfa;
     aAlfa = aAlfa + "tagm0056";
     |CARGA_DEF aAlfa, tagm0056@;
     |SI FSalida = 0;
          |ABRE #tagm0056@;
          #tagm0056@#0 = "PV";
          #tagm0056@#1 = #0#31;
          #tagm0056@#2 = #0#12;
          #tagm0056@#3 = #0#21;
          |LEE 101#tagm0056@.=;
          nSali = FSalida;
          nTagIncPos = #tagm0056@#4;
          nTagLinPos = #tagm0056@#5;
          aTagDesPos = #tagm0056@#6;
          |CIERRA #tagm0056@;
          |DESCARGA_DEF #tagm0056@;
     |FINSI;
     FSalida = nSali;
|FPRC;

|PROCESO TagTienePosA;
     nSali = 1; || No es
     |DDEF aAlfa;
     aAlfa = aAlfa + "tagm0056";
     |CARGA_DEF aAlfa, tagm0056@;
     |SI FSalida = 0;
          |ABRE #tagm0056@;
          #tagm0056@#0 = "AV";
          #tagm0056@#1 = #0#29;
          #tagm0056@#2 = #0#0;
          #tagm0056@#3 = #0#1;
          |LEE 101#tagm0056@.=;
          nSali = FSalida;
          nTagLinPos = #tagm0056@#5;
          |CIERRA #tagm0056@;
          |DESCARGA_DEF #tagm0056@;
     |FINSI;
     FSalida = nSali;
|FPRC;

|PROCESO TagAsignaPost;
     aponer = Asino;
     |HAZ poncontr211;

     |GRABA 020#0a;
     |SALVA_FICHA #0;

     nTagLinOrgPos = #0#1;

     |PARA; |SI; |HACIENDO;
          #0#1 = #0#1 + 1;
          |GRABA 020#0b;
          |SI FSalida = 0; |SAL; |FINSI;
     |SIGUE;

     #0#21 = nTagLinPos;
     nTagLinPos = #0#1;

     |SALVA_DATOS #3;
     |ABRE #3;
     #3#28 = #0#31;
     #3#0 = #0#12;
     #3#1 = #0#21;
     |LEE 101#3=;
     |SI FSalida = 0;
          nUnidades = #3#5 - #3#43;
          aPartida = #3#45;
          |HAZ TagAsinarPos;
          |GRABA 020#0a;
          |HAZ TagGrabaPos;
          |PTEC 815; || Avpag
     |FINSI;
     |CIERRA #3;
     |REPON_DATOS #3;

     |REPON_FICHA #0;

     aponer = Anosi;
     |HAZ poncontr211;
|FPRC;

|PROCESO TagAsinarPos;
     |PARA i = 2; |SI i [ 10; |HACIENDO i = i + 1;
           #0i = #3i;
     |SIGUE;
     |HAZ AgeTrans;

     #0#5 = nUnidades; ||#3#5 - #3#43;          || Unidades Pedido
     #0#48 = #3#44 - #3#49;

     |SI nSoloEstas1 > 0;  #0#5  = nSoloEstas1;  |FINSI;
     |SI nSoloEstas2 > 0;  #0#47 = nSoloEstas2;  |FINSI;

     nSoloEstas1 = 0;
     nSoloEstas2 = 0;

     |ABRE #6;
     #6#0 = #1#3;
     |LEE 020#6=;
     |CIERRA #6;

     |ABRE #21;
     #21#26 = #0#29;
     |LEE 000#21=;
     |CIERRA #21;

     #0#5  = #0#5 * abono;              || Multiplica por -1 cuando el pedido es abono.
     #0#48 = #0#48 * abono;
     #0#49 = aPartida; || #3#45;                     || Partida
     #0#50 = #3#46;                     || Merma
     #0#51 = #3#50;                     || Medida1
     #0#52 = #3#51;                     || Medida2
     #0#53 = #3#52;                     || Medida3
     |SI #6#28 = "S"; |O #21#30 = "S";  || Exportacion
          #0#11 = 0;
     |SINO;
          #0#11 = #3#14;                || Tipo de Iva
     |FINSI;
     #0#12 = #3#0;                      || Pedido
     #0#13 = #3#18;                     || Familia
     #0#15 = #1#3;                      || Cliente
     #0#16 = #3#17;                     || Tipo comision
     #0#17 = #2#19;                     || Tipo Cliente
     #0#19 = "S";                       || Entrega Pedido
     #0#21 = #3#1;                      || Linea Pedido
     #0#23 = #3#5 - #3#43;              || Unidades Pedidas
     #0#24 = 0;                         || Unidades Pendientes
     #0#27 = #3#27;                     || Desc. Ampliada
     #0#31 = #3#28;                     || Serie Pedido
     #0#33 = #3#29;                     || Dto 2
     #0#34 = #3#35;                     || Envase Conversion
     #0#35 = #3#36 - #3#37;
     #0#36 = #3#38;                     || Precio en divisa
     #0#61 = #3#53; || INTERNO

     |HAZ TotalLin71;
     nForma = 0 +. 1;
     |HAZ ActuaResto;
     |PINDA #0#0;
|FPRC;

|PROCESO TagGrabaPos;
     |DDEF aAlfa;
     aAlfa = aAlfa + "tagm0056";
     |CARGA_DEF aAlfa, tagm0056@;
     |SI FSalida = 0;
          |ABRE #tagm0056@;
          #tagm0056@#0 = "AV";
          #tagm0056@#1 = #0#29;
          #tagm0056@#2 = #0#0;
          #tagm0056@#3 = nTagLinOrgPos;
          |LEE 101#tagm0056@.=;
          |SI FSalida ! 0; |GRABA 020#tagm0056@.b; |FINSI;
          #tagm0056@#4 = nTagIncPos;
          #tagm0056@#5 = nTagLinPos;
          #tagm0056@#6 = aTagDesPos;
          |GRABA 020#tagm0056@.a;
          |CIERRA #tagm0056@;
          |DESCARGA_DEF #tagm0056@;
     |FINSI;
|FPRC;

|PROCESO TagGrabaPos0;
     |HAZ TagEsLinPostP;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |DDEF aAlfa;
     aAlfa = aAlfa + "agifa071";
     |CARGA_DEF aAlfa, refere2@;
     |SI FSalida = 0;
          |ABRE #refere2@;
          |SELECT #4#refere2@;
          #refere2@#31 = #0#31;
          #refere2@#12 = #0#12;
          #refere2@#21 = nTagDocPos;
          |LEE 000#refere2@.=;
          |SI FSalida = 0;
               nTagLinOrgPos = #refere2@#1;
               nTagLinPos = #0#1;
               |HAZ TagGrabaPos;
          |FINSI;
          |DESCARGA_DEF #refere2@;
     |FINSI;
|FPRC;

|PROCESO TagBorraPos;
     |DDEF aAlfa;
     aAlfa = aAlfa + "tagm0056";
     |CARGA_DEF aAlfa, tagm0056@;
     |SI FSalida = 0;
          |ABRE #tagm0056@;
          #tagm0056@#0 = "AV";
          #tagm0056@#1 = #0#29;
          #tagm0056@#2 = #0#0;
          #tagm0056@#3 = #0#1;
          |BORRA 141#tagm0056@.c;
          |CIERRA #tagm0056@;
          |DESCARGA_DEF #tagm0056@;
     |FINSI;
|FPRC;

|PROCESO TagDespreciaPos;
     |HAZ TagTienePosA;
     |SI FSalida = 0;
          nPed_baja = #0#12;
          aSer_baja = #0#31;
          nLin_baja = nTagLinPedPos;
          |SUB_EJECUTA "dsz00006";
     |FINSI;
|FPRC;

|PROCESO TagBorraLinPos;
     |HAZ TagTienePosA;
     |SI FSalida = 0;
          |SALVA_FICHA #0;

          #0#1 = nTagLinPos;
          |LEE 101#0=;
          |SI FSalida = 0;
               nTagLinPedPos = #0#21;
               aponer = Asino;
               |HAZ poncontr211;
               nForma = 0 +. 1;
               |HAZ ActuaResto;
               |ABRE #6;
               |ABRE #4;
               |HAZ ActualizaCliente;
               |CIERRA #4;
               |CIERRA #6;
               |HAZ BorraHistoDespreciar;

               |BORRA 020#0a;
               |LIBERA #0;
               aponer = Anosi;
               |HAZ poncontr211;
          |FINSI;

          |REPON_FICHA #0;
     |FINSI;
|FPRC;

|PROCESO TagModiPos;
     |HAZ TagTienePosA;
     |SI FSalida = 0;
          |SALVA_FICHA #0;
          |SALVA_DATOS #3;

          nUni = #0#5;
          nDto1 = #0#8;
          nDto2 = #0#33;

          #0#1 = nTagLinPos;
          |LEE 101#0=;
          |SI FSalida = 0;
               |SI nForma = 1;
                    #0#5 = nUni;
                    #0#8 = nDto1;
                    #0#33 = nDto2;
               |FINSI;
               |HAZ TotalLin71;
               |HAZ ActuaResto;
               |ABRE #6;
               |ABRE #4;
               |HAZ ActualizaCliente;
               |CIERRA #4;
               |CIERRA #6;

               |GRABA 020#0a;
               |LIBERA #0;
          |FINSI;

          |REPON_DATOS #3;
          |REPON_FICHA #0;
     |FINSI;
|FPRC;

|PROCESO MecaDeOrdenLin;
     |DDEF aAlfa;
     aAlfa = aAlfa + "mecam008";
     |CARGA_DEF aAlfa, mecano@;
     |SI FSalida = 0;
          |ABRE #mecano@;
          |SELECT #3#mecano@;
          #mecano@#6 = #0#29;
          #mecano@#7 = #0#0;
          #mecano@#8 = #0#1;
          |LEE 000#mecano@.=;
          |SI FSalida = 0;
               aAlfa = "0";
          |SINO;
               aAlfa = "1";
          |FINSI;
          |CIERRA #mecano@;
          |DESCARGA_DEF #mecano@;
     |FINSI;
     FSalida = aAlfa;
|FPRC;

|PROCESO MecaAdjudicable;
     |SI enMecaDeOrden = 0; |Y enModoCab210 = 2;
          |DDEF aAlfa;
          aAlfa = aAlfa + "mecam001";
          |CARGA_DEF aAlfa, mecano@;
          |SI FSalida = 0;
               |ABRE #mecano@;
               #mecano@#0 = #3#2;
               |LEE 000#mecano@.=;
               |SI #mecano@#1 = 0; |Y #mecano@#3 = "N";
                    aAlfa = "0";
               |SINO;
                    aAlfa = "1";
               |FINSI;
               |CIERRA #mecano@;
               |DESCARGA_DEF #mecano@;
          |FINSI;
          FSalida = aAlfa;
     |SINO;
          FSalida = 0;
     |FINSI;
|FPRC;

|PROCESO T211_6_0; |TIPO 0;
     |SI #279#3 = "S";
          eaArticulo = #0#2;
          enPrecio = #0#6;
          enDto1 = #0#8;
          enDto2 = #0#33;
          nNume =  (enPrecio < enDto1) < enDto2;
          |SI nNume ! nPreDtoAnt;
               |SUB_EJECUTA_NP "dsz00100";
               |SI enError ! 0; |ERROR; |ACABA; |FINSI;
               nPreDtoAnt = nNume;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Riesgos211;
     enErrRie = 0;
     eaSerie = #0#29; eaTag = "AV";  |HAZ SacaRiesgo;

     DLinea = #agifa071#21; HLinea = #agifa071#21;
     |BUCLE IncluyeACtas;

     |SI eaRieSuma = "S"; nRieUtili = nRieUtili + #1#67 + #0#9 -nRiePed; |FINSI;
     |SI #1#43 = "N"; |Y #agifa142#6 = "S";
          eaDocu = "L";
          eaTipo = "A";
          enImpoDoc = #1#67 + #0#9;
          |HAZ ControlRiesgo;
          |SI enErrRie = 1; |ERROR; |ACABA; |FINSI;
          |SI enAudito = 0;
               |ABRE #43;
               |LEE 000#43u;
               |SI FSalida = 0;
                    nConAu = #43#0 + 1;
               |SINO;
                    nConAu = 1;
               |FINSI;
               |DDEFECTO #43;
               #43#0 = nConAu;          || contador
               #43#12 = "ALBARAN";      || tipo documento
               #43#1 = #1#52;           || serie
               #43#2 = #1#0;            || documento
               #43#3 = #1#1;            || fecha
               #43#4 = #1#3;            || cliente
               #43#5 = #1#4;            || nombre
               #43#6 = Usuario % 810;   || usuario
               #43#7 = nRieTotal;       || riesto concedido
               #43#8 = nRieUtili;       || riesgo actual
               #43#9 = #41#2;           || % exceso
               #43#10= #41#3;           || importe % exceso
               #43#11= #41#4;           || limite exceso
               |GRABA 020#43n;
               |CIERRA #43;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Stock211PCEG;
     |DDEF aAlfa;
     aAlfa = aAlfa + "pcegm012";
     |CARGA_DEF aAlfa, refere2@;
     |SI FSalida = 0;
          |ABRE #refere2@;
          #refere2@#0 = #0#2;
          |LEE 101#refere2@.=;
          |SI FSalida = 0;
               #refere2@#1 = #refere2@#1 + #0#5;
               |GRABA 020#refere2@.a;
          |FINSI;
          |CIERRA #refere2@;
          |DESCARGA_DEF #refere2@;
     |SINO;
          |MENAV "0000Error al cargar 'pcegm012'";
     |FINSI;
|FPRC;

----------------------------------------------
|PROCESO TallerCreaLin71;
     |DDEF aAlfa; aAlfa = aAlfa + "agifa071";
     |CARGA_DEF aAlfa, refere2@;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |ABRE #refere2@;
     |SI #0#63 > 0;
          nLin = #0#63;
          #refere2@#29 = #0#29;
          #refere2@#0 = #0#0;
          #refere2@#1 = nLin;
          |LEE 121#refere2@.=;
     |SINO;
          #refere2@#29 = #0#29;
          #refere2@#0 = #0#0;
          #refere2@#1 = 999;
          |LEE 000#refere2@.];
          |SI FSalida = 0;
               |LEE 000#refere2@.a;
          |SINO;
               |LEE 000#refere2@.u;
          |FINSI;
          |SI FSalida = 0; |Y #refere2@#29 = #0#29;  |Y #refere2@#0 = #0#0;
               nLin = #refere2@#1 + 1;
          |SINO;
               nLin = 1;
          |FINSI;
          |SI nLin [ #0#1; nLin = #0#1 + 1; |FINSI;
          |DDEFECTO #refere2@;
          #refere2@#29 = #0#29;
          #refere2@#0 = #0#0;
          #refere2@#1 = nLin;
          |GRABA 020#refere2@.b;
     |FINSI;
     aAlfa = "CANON " + #0#4;
     #refere2@#2 = "xxxxx";
     #refere2@#3 = 1;
     #refere2@#4 = aAlfa;
     #refere2@#5 = #0#5;
     #refere2@#6 = enCanon;
     #refere2@#11 = #0#11;
     #refere2@#13 = #0#13;
     #refere2@#15 = #0#15;
     #refere2@#36 = enCanon;
     #refere2@#63 = -1;
     |SALVA_DATOS #0;

     |SALVA_DATOS #refere2@;
     |REPON_DATOS #0;

     enForma = 1;
     |HAZ AcumulaAV;
     |HAZ TotalLin71;
     |HAZ AcuAlbaran;

     |SALVA_DATOS #0;
     |REPON_DATOS #refere2@;
     |GRABA 020#refere2@.a;

     |REPON_DATOS #0;

     #0#63 = nLin;  || Linea Promocion

     |CIERRA #refere2@;
     |DESCARGA_DEF #refere2@;
|FPRC;

|PROCESO TallerAcuLin71;
     |DDEF aAlfa; aAlfa = aAlfa + "agifa071";
     |CARGA_DEF aAlfa, refere2@;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |ABRE #refere2@;
     #refere2@#29 = #0#29;
     #refere2@#0 = #0#0;
     #refere2@#1 = #0#63;     || Usa linea promocion
     |LEE 101#refere2@.=;
     |SI FSalida = 0;
          |SALVA_DATOS #0;
          |SALVA_DATOS #refere2@;
          |REPON_DATOS #0;
          #0#1 = #refere2@#1;
          enForma = -1;
          |HAZ AcumulaAV;
          |HAZ TotalLin71;
          |HAZ AcuAlbaran;
          |REPON_DATOS #0;
     |FINSI;
     |CIERRA #refere2@;

     |DESCARGA_DEF #refere2@;
|FPRC;

|PROCESO TallerBorLin71;
     |DDEF aAlfa; aAlfa = aAlfa + "agifa071";
     |CARGA_DEF aAlfa, refere2@;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |ABRE #refere2@;
     #refere2@#29 = #0#29;
     #refere2@#0 = #0#0;
     #refere2@#1 = #0#63;     || Usa linea promocion
     |LEE 101#refere2@.=;
     nTallerBorLin = FSalida;
     |SI FSalida = 0;
          |BORRA 020#refere2@.a;
     |FINSI;
     |CIERRA #refere2@;

     |DESCARGA_DEF #refere2@;
|FPRC;

|PROCESO TallerCanon71;
     eaArticulo = #0#2; |QBF eaArticulo;
     |HAZ TallerCanon;
     |SI nForma = 1;
          |SI enCanon ! 0;
               aponer = Asino; |HAZ poncontr211;
               |HAZ TallerCreaLin71;
               aponer = Anosi; |HAZ poncontr211;
               |PTEC 809; |PTEC 816; |PTEC 806;
          |SINO;
               |SI #0#63 > 0;      || ha cambiado a un articulo sin canon
                    |HAZ TallerBorLin71;
                    #0#63 = 0;
               |FINSI;
          |FINSI;
     |SINO;
          |SI modo = 3; |Y enModoCab210 ! 3;
               |HAZ TallerAcuLin71;
               |HAZ TallerBorLin71;
               |SI nTallerBorLin = 0;
                    |PONCONTROL 23, "SI";
                    |PTEC 809; |PTEC 808;
               |FINSI;
          |SINO;
               |SI modo = 2;
                    |HAZ TallerAcuLin71;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO AcuAlbaran;
     |HAZ CalCabAgifa010_2;
     |HAZ visual_totales2;
|FPRC;

|PROCESO TallerAsignaCanon;
     aponer = Asino;
     |HAZ poncontr211;

     |GRABA 020#0a;
     |SALVA_FICHA #0;

     |PARA; |SI; |HACIENDO;
          #0#1 = #0#1 + 1;
          |GRABA 020#0b;
          |SI FSalida = 0; |SAL; |FINSI;
     |SIGUE;

     #0#21 = nLinCanonSC;
     nLinCanonSC = #0#1;

     |SALVA_DATOS #3;
     |ABRE #3;
     #3#28 = #0#31;
     #3#0 = #0#12;
     #3#1 = #0#21;
     |LEE 101#3=;
     |SI FSalida = 0;
          nUnidades = #3#5 - #3#43;
          aPartida = #3#45;
          |HAZ TagAsinarPos;            || lo mismo que tagloma
          #0#63 = #3#55;
          |GRABA 020#0a;
          |PTEC 815; || Avpag
     |FINSI;
     |CIERRA #3;
     |REPON_DATOS #3;

     |REPON_FICHA #0;
     #0#63 = nLinCanonSC;
     |GRABA 020#0a;

     aponer = Anosi;
     |HAZ poncontr211;
|FPRC;

|PROCESO TallerModiCanon;
     aDespreciar = aDespreCanon;
     |SI #0#63 > 0;
          |SALVA_FICHA #0;
          |SALVA_DATOS #3;

          nUni = #0#5;

          #0#1 = #0#63
          |LEE 101#0=;
          |SI FSalida = 0;
               |SI nForma = 1;
                    #0#5 = nUni;
               |FINSI;
               |HAZ TotalLin71;
               |HAZ ActuaResto;
               |ABRE #6;
               |ABRE #4;
               |HAZ ActualizaCliente;
               |CIERRA #4;
               |CIERRA #6;

               |GRABA 020#0a;
               |LIBERA #0;
          |FINSI;

          |REPON_DATOS #3;
          |REPON_FICHA #0;
     |FINSI;
     aDespreCanon = "N";
     aDespreciar = "N";
|FPRC;

|PROCESO TallerBorraCanon;
     |SI #0#63 > 0;
          |SALVA_FICHA #0;

          #0#1 = #0#63;
          |LEE 101#0=;
          |SI FSalida = 0;
               aponer = Asino;
               |HAZ poncontr211;
               nForma = 0 +. 1;
               |HAZ ActuaResto;
               |ABRE #6;
               |ABRE #4;
               |HAZ ActualizaCliente;
               |CIERRA #4;
               |CIERRA #6;
               |HAZ BorraHistoDespreciar;

               |BORRA 020#0a;
               |LIBERA #0;
               aponer = Anosi;
               |HAZ poncontr211;
          |FINSI;

          |REPON_FICHA #0;
     |FINSI;
|FPRC;

|PROCESO TallerDespreCanon;
     |SI #0#63 > 0;
          nPed_baja = #0#12;
          aSer_baja = #0#31;
          nLin_baja = #0#63;
          |SUB_EJECUTA "dsz00006";
     |FINSI;
|FPRC;

|PROCESO BorTagloMerma211;
     |DDEF aAlfa;
     aAlfa = aAlfa + "tagm0078";
     |CARGA_DEF aAlfa, refere2@;
     |SI FSalida ! 0;
          |MENAV "0000Error al cargar 'tagm0078'";
     |SINO;
          |ABRE #refere2@;
          #refere2@#0 = "A";
          #refere2@#1 = #0#29;
          #refere2@#2 = #0#0;
          #refere2@#3 = #0#1;
          |BORRA 000#refere2@.c;
          |CIERRA #refere2@;
          |DESCARGA_DEF #refere2@;
     |FINSI;
|FPRC;

|PROCESO Precio211_7; |TIPO 7;
     aAlfa = "0000<F6> Consulta Precios";
     |HAZ EsAparecida;
     |SI FSalida = 0;
          aAlfa = "0000<F5> Tarifas     <F6> Consulta Precios";
     |FINSI;
     |HAZ EsRocai;
     |SI FSalida = 0;
          aAlfa = "0000<F3> Tarifas     <F6> Consulta Precios";
     |FINSI;
     |MENSA aAlfa;
|FPRC;
---------------------
|PROCESO ActPrimicia;
     |ABRE #6;
     |ABRE #4;
     |HAZ ActualizaCliente;
     |CIERRA #4;
     |CIERRA #6;
     #1#41 = #1#41 + nForma;
|FPRC;

|PROCESO CargaLinPri;
     |ABRE #4;
     #4#0 = #3#2;
     |LEE 000#4=;
     |CIERRA #4;
     aAlfa = #4#111; |QBF aAlfa;
     |SI aAlfa ! ""; |ACABA; |FINSI;

     nPdte = #3#5 - #3#43;
     |SI nPdte [ 0; |Y #3#5 ! 0; |ACABA; |FINSI;

     nLin = nLin + 1;
     |DDEFECTO #0;
     #0#29 = #1#52;
     #0#0 = #1#0;
     #0#1 = nLin;
     #0#2 = #3#2;
     #0#3 = #3#3;
     #0#4 = #3#4;
     #0#5 = nPdte;
     #0#6 = #3#6;
     #0#8 = #3#8;
     #0#10 = #3#10;
     #0#11 = #3#14;
     #0#12 = #3#0;
     #0#13 = #3#18;
     #0#15 = #1#3;
     #0#16 = #3#17;
     #0#17 = #3#19;
     #0#21 = #3#1;
     #0#27 = #3#27;
     #0#31 = #3#28;
     #0#33 = #3#29;
     #0#34 = #3#35;
     #0#35 = #3#36;
     #0#36 = #3#38;
     #0#49 = #3#45;
     nForma = 1;
     |HAZ ActPrimicia;
     #0#14 = #0#5 * #4#9;     || Precio de coste medio.
     |HAZ TotalLin71;
     |GRABA 020#0n;

     enForma = 1;
     enUnidPend = #0#5;
     eaReservado = #3#22;
     eaDesprecia = "N";
     eaProgVta = "agifa210";
     |HAZ AcumulaAV;

     #3#43 = #3#43 + #0#5;  || Servidas
     |GRABA 020#3a;
     |LIBERA #3;
|FPRC;

|DEFBUCLE CargaLinPri;
     #3#1;
     ;
     aSerie, nNume, 001;
     aSerie, nNume, 999;
     be;
     NULL, CargaLinPri;
|FIN;

|PROCESO LinPrimicias;
     |SI aCamArti = ""; |ACABA; |FINSI;

     nLin = nLin + 1;
     |DDEFECTO #0;
     #0#29 = #1#52;
     #0#0 = #1#0;
     #0#1 = nLin;
     #0#2 = aCampo9;
     #0#3 = aCampo4;
     #0#4 = aCampo3;
     #0#5 = nCamUni;
     #0#6 = aCampo12;
     #0#8 = aCampo13;
     #0#10 = aCampo14;
     #0#11 = aCampo15;
     #0#12 = aCampo8;
     #0#13 = aCampo16;
     #0#14 = enCoste;
     #0#15 = #1#3;
     #0#16 = aCampo17;
     #0#17 = aCampo18;
     #0#21 = aCampo24;
     #0#27 = aCampo19;
     #0#31 = aCampo7;
     #0#33 = aCampo20;
     #0#34 = aCampo21;
     #0#35 = aCampo22;
     #0#36 = aCampo23;
     #0#49 = aCampo5;
     nForma = 1;
     |HAZ ActPrimicia;
     #0#14 = #0#5 * #4#9;     || Precio de coste medio.
     |HAZ TotalLin71;
     |GRABA 020#0n;

     #3#28 = #0#31;
     #3#0 = #0#12;
     #3#1 = #0#21;
     |LEE 121#3=;

     enForma = 1;
     enUnidPend = #0#5;
     eaReservado = #3#22;
     eaDesprecia = "N";
     eaProgVta = "agifa210";
     |HAZ AcumulaAV;
     |LIBERA #3;
|FPRC;

|PROCESO Primicias;
     aSerie = #refere2@#7;
     nNume = #refere2@#8;

     nCamUni = #refere2@#2;
     aCamArti = #refere2@#9;
     nCamAlm = #refere2@#4;
     aCamLote = #refere2@#5;
     IaCampo = aCampo1<-;
     |PARA i = 1; |SI i [ 24; |HACIENDO i = i + 1;
          aCampo = #refere2@#i#;
          IaCampo = IaCampo + 1;
     |SIGUE;
     |HAZ LinPrimicias;
|FPRC;

|PROCESO PrimiAgrupa;
     aSerie = #refere2@#7;
     nNume = #refere2@#8;

     |SI aCamArti ! #refere2@#9; |O nCamAlm ! #refere2@#4;
               |O aCamLote ! #refere2@#5;
          |HAZ LinPrimicias;
          nCamUni = 0;
     |FINSI;
     nCamUni = nCamUni + #refere2@#2;
     aCamArti = #refere2@#9;
     nCamAlm = #refere2@#4;
     aCamLote = #refere2@#5;
     IaCampo = aCampo1<-;
     |PARA i = 1; |SI i [ 24; |HACIENDO i = i + 1;
          aCampo = #refere2@#i#;
          IaCampo = IaCampo + 1;
     |SIGUE;
|FPRC;

|DEFBUCLE PrimiNormal;
     #refere2@#1003;
     ;
     #1#52, #1#0, 001;
     #1#52, #1#0, 999;
     ;
     NULL, Primicias;
|FIN;

|DEFBUCLE PrimiAgrupa;
     #refere2@#3006;
     ;
     #1#52, #1#0, "                    ", 00001, "      ", 00000;
     #1#52, #1#0, "zzzzzzzzzzzzzzzzzzzz", 99999, "zzzzzz", 99999;
     ;
     NULL, PrimiAgrupa;
|FIN;

|PROCESO Recalcula;
     |HAZ CalCabAgifa010;
|FPRC;

|DEFBUCLE Recalcula;
     #0#1;
     ;
     #1#52, #1#0, 001;
     #1#52, #1#0, 999;
     be;
     NULL, Recalcula;
|FIN;

|PROCESO CargaPrimicia;
     |DDEF aAlfa;
     aAlfa = aAlfa + "prim0003";
     |CARGA_DEF aAlfa, refere2@;
     |SI FSalida = 0;
          nLin = 0;
          |ABRE #3;
          |SI enMenuPrimi = 2;
               |BUCLE PrimiNormal;
          |SINO;
               aCamArti = "";
               |BUCLE PrimiAgrupa;
               |HAZ LinPrimicias;
          |FINSI;
          |CIERRA #3;
          |SI nLin > 0;
               |BUCLE CargaLinPri;
               |ABRE #2;
               #2#25 = aSerie;
               #2#0 = nNume;
               |LEE 121#2=;
               |SI FSalida = 0;
                    #1#55 = #2#53;
                    #1#56 = #2#54;
                    #1#57 = #2#55;
                    |HAZ CalCabAgifa104;
                    |LIBERA #2;
               |FINSI;
               |CIERRA #2;
          |SINO;
               |BORRA 000#1c;
          |FINSI;
          |DESCARGA_DEF #refere2@;
     |FINSI;
|FPRC;

|PROCESO DesActPrimi0;
     |HAZ ActPrimicia;
     |BORRA 020#0a;

     |ABRE #4;
     #4#0 = #0#4;
     |LEE 000#4=;
     |CIERRA #4;
     aAlfa = #4#111; |QBF aAlfa;

     |SI aAlfa = ""; |Y #0#5 = 0;
          #65#0 = #0#2;
          #65#1 = #1#1;
          #65#2 = "AV";
          #65#3 = #0#0;
          #65#4 = #0#1;
          #65#11 = #0#29;
          |BORRA 020#65c;
     |FINSI;
|FPRC;

|DEFBUCLE DesActPrimi0;
     #0#1;
     ;
     #1#52, #1#0, 001;
     #1#52, #1#0, 999;
     be;
     NULL, DesActPrimi0;
|FIN;

|PROCESO DesActPrimi;
     nForma = -1;
     |BUCLE DesActPrimi0;
|FPRC;

|PROCESO PintaDes211;
     |HAZ EsAparecida;
     |SI FSalida = 0;
          |C_A #0#4, 0, nNume;
          |C_A #0#4, 1, 50;
          |PINTA 2302, "쿏escripcion: ";
          |PINTA 2316, #0#4;
          |C_A #0#4, 1, nNume;
     |FINSI;
|FPRC;

|PROCESO InforActMatri;
     aAlfa = #0#49; |QBF aAlfa;
     |SI aAlfa = ""; |ACABA; |FINSI;
     nSwPasa = 0;
     |DDEF aPath;
     aAlfa = aPath + "ialbm006";
     |CARGA_DEF aAlfa, refere2@;
     |SI FSalida = 0;
          |SI #0#29 = #refere2@#2; |O #0#29 = #refere2@#3;
                    |O #0#29 = #refere2@#4; |O #0#29 = #refere2@#5;
               nSwPasa = 1;
          |FINSI;
          |DESCARGA_DEF #refere2@;
     |FINSI;
     |SI nSwPasa = 1; |ACABA; |FINSI;

     aAlfa = aPath + "ialbm002";
     |CARGA_DEF aAlfa, refere2@;
     |SI FSalida = 0;
          |ABRE #refere2@;
          #refere2@#0 = #0#49;
          |LEE 101#refere2@.=;
          |SI FSalida = 0;
               |SI nForma = 1;
                    |ABRE #6;
                    #6#0 = #1#3;
                    |LEE 000#6=;
                    |CIERRA #6
                    #refere2@#6 = #6#0;
                    #refere2@#7 = #6#1;
                    #refere2@#8 = #1#1;
                    #refere2@#9 = #0#9;
                    #refere2@#10 = #1#6;
                    #refere2@#15 = #0#29;
                    #refere2@#16 = #0#0;
                    #refere2@#21 = #6#17;
               |SINO;
                    #refere2@#6 = "";
                    #refere2@#7 = "";
                    #refere2@#8 = "01.01.0000";
                    #refere2@#9 = "";
                    #refere2@#10 = "";
                    #refere2@#15 = "";
                    #refere2@#16 = "";
                    #refere2@#21 = "";
               |FINSI;
               |GRABA 020#refere2@.a;
          |FINSI;
          |CIERRA #refere2@;
          |DESCARGA_DEF #refere2@;
     |SINO;
          |MENAV "0000Error al cargar 'ialbm002'";
     |FINSI;
|FPRC;

|PROCESO IVA211_0; |TIPO 0;
     enTiva = #0Campo;
     efFiva = #1#1;
     |HAZ SacaIVA;
     |SI eaDiva = "";
          |MENAV "0000No existe tipo iva para esta fecha...";
          |ERROR; |ACABA;
     |FINSI;

     |HAZ EsInforAlba;
     |SI FSalida = 0; |HAZ InfAlbPideMat; |FINSI;

     |HAZ EsGesisat;
     |SI FSalida = 0; |HAZ GesiAlbPideMat; |FINSI;

     |HAZ EsQDClor;
     |SI FSalida = 0;
          eaArticulo = #0#2;
          eaSerie = #0#29;
          enCodigo = #0#0;
          enLinea = #0#1;
          |SUB_EJECUTA_NP "qdclor09";
          |HAZ PinQDClor71;
     |FINSI;
|FPRC;

|PROCESO InfAlbPideMat;
     |ABRE #4;
     #4#0 = #0#2;
     |LEE 000#4=;
     |SI FSalida = 0; |Y #4#174 = "S ";
          eaArticulo = #0#2;
          eaMatri = #0#49;
          |SUB_EJECUTA_NP "ialbz001;AJ";
          #0#49 = eaMatri;
     |SINO;
          #0#49 = "";
     |FINSI;
     |C_V #0#49, 1, "S";
     |PINTA 1113, #0#49;
     |CIERRA #4;
|FPRC;

|PROCESO IVA211_66; |TIPO 66;
     enTiva = #0Campo;
     efFiva = #1#1;
     |HAZ ConsuIVA;
     |SI eaDiva = "";
          |ERROR;
     |SINO;
          #0Campo = enTiva; |PINTA #0Campo;
     |FINSI;
|FPRC;

|PROCESO SumaUni71;
     nTotUni = nTotUni + #0#5;
|FPRC;

|DEFBUCLE SumaUni71;
     #0#1;
     ;
     #1#52, #1#0, 001;
     #1#52, #1#0, 999;
     ;
     NULL, SumaUni71;
|FIN;

|PROCESO VigorPin71;
     |SALVA_FICHA #0;
     nTotUni = 0;
     |BUCLE SumaUni71;
     #0#5 = nTotUni;
     |PINTA 1002, "Tot.Uni: ";
     |PINTA 1011, #0#5;
     |REPON_FICHA #0;
|FPRC;

|PROCESO ActDesanch211;
     nEsta = 0;
     |DDEF aPath;
     aAlfa = aPath + "desan001";
     |CARGA_DEF aAlfa, refere2@;
     |SI FSalida = 0;
          |ABRE #refere2@;
          |SELECT #2#refere2@;
          #refere2@#1 = #0#2;
          |LEE 000#refere2@.=;
          |SI FSalida = 0; |Y #refere2@#3 = "S";
               nEsta = 1;
          |FINSI;
          |DESCARGA_DEF #refere2@;
     |FINSI;

     |SI nEsta = 0; |ACABA; |FINSI;

     aAlfa = aPath + "desan026";
     |CARGA_DEF aAlfa, refere2@;
     |SI FSalida = 0;
          |ABRE #refere2@;
          #refere2@#0 = #0#2;
          #refere2@#1 = #1#1;
          |SI #1#43 = "S";
               #refere2@#2 = "BV";
               nUni = #0#5;
          |SINO;
               #refere2@#2 = "AV";
               nUni = -#0#5;
          |FINSI;
          #refere2@#3 = #0#29;
          #refere2@#4 = #0#0;
          #refere2@#5 = #0#1;
          #refere2@#6 = nUni;
          #refere2@#7 = #1#3;
          |SI nForma = 1;
               |GRABA 000#refere2@.n;
          |SINO;
               |BORRA 000#refere2@.c;
          |FINSI;
          |CIERRA #refere2@;
          |DESCARGA_DEF #refere2@;
     |FINSI;

     aAlfa = aPath + "desan025";
     |CARGA_DEF aAlfa, refere2@;
     |SI FSalida = 0;
          |DDEFECTO #refere2@;
          |ABRE #refere2@;
          #refere2@#0 = #1#3;
          #refere2@#1 = #0#2;
          |LEE 101#refere2@.=;
          |SI FSalida ! 0; |GRABA 020#refere2@.b; |FINSI;
          #refere2@#2 = #refere2@#2 + (nUni * nForma);
          |GRABA 020#refere2@.a;
          |CIERRA #refere2@;
          |DESCARGA_DEF #refere2@;
     |FINSI;
|FPRC;

|PROCESO tlfm0001;
     #tlfm0019@#0 = #tlfm0001@#0;
     #tlfm0019@#1 = #0#2;
     #tlfm0019@#2 = #1#1;
     |SI #1#43 = "S";
          #tlfm0019@#3 = "BV";
     |SINO;
          #tlfm0019@#3 = "AV";
     |FINSI;
     #tlfm0019@#4 = #0#29;
     #tlfm0019@#5 = #0#0;
     #tlfm0019@#6 = #0#1;
     #tlfm0019@#7 = 0;
     #tlfm0019@#8 = #0#3;
     #tlfm0019@#9 = #1#3;
     #tlfm0019@#10 = #0#6;
     |SI nForma = 1;
          |GRABA 020#tlfm0019@.n;
     |SINO;
          |BORRA 020#tlfm0019@.c;
     |FINSI;

     nHay = 0;
     |SI modo = 3; nHay = 1; |FINSI;
     |SI modo = 2; |Y nForma = -1; |Y #1#90 = "S"; nHay = 1; |FINSI;
     |SI nHay = 1;
          |SELECT #1#tlfm0023@;
          |LEE 101#tlfm0023@.u;
          |SI FSalida = 0;
               nNume = #tlfm0023@#0 + 1;
          |SINO;
               nNume = 1;
          |FINSI;
          #tlfm0023@#0 = nNume;
          #tlfm0023@#1 = #tlfm0019@#0;
          #tlfm0023@#2 = #tlfm0019@#1;
          #tlfm0023@#3 = #tlfm0019@#2;
          #tlfm0023@#4 = #tlfm0019@#3;
          #tlfm0023@#5 = #tlfm0019@#4;
          #tlfm0023@#6 = #tlfm0019@#5;
          #tlfm0023@#7 = #tlfm0019@#6;
          #tlfm0023@#8 = #tlfm0019@#7;
          #tlfm0023@#9 = #1#29;
          #tlfm0023@#10 = ~;
          aAlfa = Usuario % 810;
          #tlfm0023@#11 = aAlfa;
          |SI modo = 3;
               #tlfm0023@#12 = "B";
          |SINO;
               #tlfm0023@#12 = "M";
          |FINSI;
          |GRABA 020#tlfm0023@.n;
     |FINSI;
     |SI modo = 2; |Y nForma = 1; |Y #1#90 = "S";
          |SELECT #2#tlfm0023@;
          #tlfm0023@#1 = #tlfm0019@#0;
          #tlfm0023@#5 = #0#29;
          #tlfm0023@#6 = #0#0;
          #tlfm0023@#7 = #0#1;
          |BORRA 000#tlfm0023@.c;
     |FINSI;
|FPRC;

|DEFBUCLE tlfm0001;
     #tlfm0001@#5003;
     ;
     #0#29, #0#0, #0#1;
     #0#29, #0#0, #0#1;
     ;
     NULL, tlfm0001;
|FIN;

|PROCESO HistoIMEI;
     |DDEF aDef;
     aAlfa = aDef + "tlfm0001";
     |CARGA_DEF aAlfa, tlfm0001@;
     |SI FSalida = 0;
          |SI nForma ! 1;
               aAlfa = aDef + "tlfm0019";
               |CARGA_DEF aAlfa, tlfm0019@;
               |SI FSalida = 0;
                    aAlfa = aDef + "tlfm0023";
                    |CARGA_DEF aAlfa, tlfm0023@;
                    |SI FSalida = 0;
                         |ABRE #tlfm0019@;
                         |ABRE #tlfm0023@;
                         |BUCLE tlfm0001;
                         |CIERRA #tlfm0023@;
                         |CIERRA #tlfm0019@;
                         |DESCARGA_DEF #tlfm0023@;
                    |SINO;
                         |MENAV "0000Error al cargar 'tlfm0023'";
                    |FINSI;
                    |DESCARGA_DEF #tlfm0019@;
               |FINSI;
          |FINSI;

          |ABRE #tlfm0001@;
          |SELECT #10#tlfm0001@;
          #tlfm0001@#58 = #0#31;
          #tlfm0001@#59 = #0#12;
          #tlfm0001@#60 = #0#21;
          |LEE 101#tlfm0001@.=;
          |SI FSalida = 0;
               |SELECT #1#tlfm0001@;
               |LEE 121#tlfm0001@.=;
               |SI nForma = 1;
                    #tlfm0001@#25 = #0#29;
                    #tlfm0001@#26 = #0#0;
                    #tlfm0001@#27 = #0#1;
                    #tlfm0001@#28 = #1#1;
               |SINO;
                    #tlfm0001@#25 = "";
                    #tlfm0001@#26 = 0;
                    #tlfm0001@#27 = 0;
                    #tlfm0001@#28 = "01.01.0000";
               |FINSI;
               |GRABA 020#tlfm0001@.a;
          |FINSI;
          |CIERRA #tlfm0001@;

          aAlfa = aDef + "tlfm0002";
          |CARGA_DEF aAlfa, tlfm0019@;
          |SI FSalida = 0;
               |ABRE #tlfm0019@;
               |SELECT #8#tlfm0019@;
               #tlfm0019@#51 = #0#31;
               #tlfm0019@#52 = #0#12;
               #tlfm0019@#53 = #0#21;
               |LEE 101#tlfm0019@.=;
               |SI FSalida = 0;
                    |SELECT #1#tlfm0019@;
                    |LEE 121#tlfm0019@.=;
                    |SI nForma = 1;
                         #tlfm0019@#25 = #0#29;
                         #tlfm0019@#26 = #0#0;
                         #tlfm0019@#27 = #0#1;
                         #tlfm0019@#28 = #1#1;
                    |SINO;
                         #tlfm0019@#25 = "";
                         #tlfm0019@#26 = 0;
                         #tlfm0019@#27 = 0;
                         #tlfm0019@#28 = "01.01.0000";
                    |FINSI;
                    |GRABA 020#tlfm0019@.a;
               |FINSI;
               |CIERRA #tlfm0019@;
               |DESCARGA_DEF #tlfm0019@;
          |SINO;
               |MENAV "0000Error al cargar 'tlfm0019'";
          |FINSI;
          |SI nForma = 1;
               aAlfa = aDef + "tlfm0019";
               |CARGA_DEF aAlfa, tlfm0019@;
               |SI FSalida = 0;
                    aAlfa = aDef + "tlfm0023";
                    |CARGA_DEF aAlfa, tlfm0023@;
                    |SI FSalida = 0;
                         |ABRE #tlfm0019@;
                         |ABRE #tlfm0023@;
                         |BUCLE tlfm0001;
                         |CIERRA #tlfm0023@;
                         |CIERRA #tlfm0019@;
                         |DESCARGA_DEF #tlfm0023@;
                    |SINO;
                         |MENAV "0000Error al cargar 'tlfm0023'";
                    |FINSI;
                    |DESCARGA_DEF #tlfm0019@;
               |FINSI;
          |FINSI;
          |DESCARGA_DEF #tlfm0001@;
     |SINO;
          |MENAV "0000Error al cargar 'tlfm0001'";
     |FINSI;
|FPRC;
-------------
|PROCESO ActVallcorba;
     |ABRE #6;
     |ABRE #4;
     |HAZ ActualizaCliente;
     |CIERRA #4;
     |CIERRA #6;
     #1#41 = #1#41 + nForma;
|FPRC;

|PROCESO CargaLinVall;
     |ABRE #4;
     #4#0 = #3#2;
     |LEE 000#4=;
     |CIERRA #4;
     aAlfa = #4#111; |QBF aAlfa;
     |SI aAlfa ! ""; |ACABA; |FINSI;

     nPdte = #3#5 - #3#43;
     |SI nPdte [ 0; |Y #3#5 ! 0; |ACABA; |FINSI;

     nLin = nLin + 1;
     |DDEFECTO #0;
     #0#29 = #1#52;
     #0#0 = #1#0;
     #0#1 = nLin;
     #0#2 = #3#2;
     #0#3 = #3#3;
     #0#4 = #3#4;
     #0#5 = nPdte;
     #0#6 = #3#6;
     #0#8 = #3#8;
     #0#10 = #3#10;
     #0#11 = #3#14;
     #0#12 = #3#0;
     #0#13 = #3#18;
     #0#15 = #1#3;
     #0#16 = #3#17;
     #0#17 = #3#19;
     #0#21 = #3#1;
     #0#27 = #3#27;
     #0#31 = #3#28;
     #0#33 = #3#29;
     #0#34 = #3#35;
     #0#35 = #3#36;
     #0#36 = #3#38;
     #0#49 = #3#45;
     nForma = 1;
     |HAZ ActVallcorba;
     #0#14 = #0#5 * #4#9;     || Precio de coste medio.
     |HAZ TotalLin71;
     |GRABA 020#0n;

     enForma = 1;
     enUnidPend = #0#5;
     eaReservado = #3#22;
     eaDesprecia = "N";
     eaProgVta = "agifa210";
     |HAZ AcumulaAV;

     #3#43 = #3#43 + #0#5;  || Servidas
     |GRABA 020#3a;
     |LIBERA #3;
|FPRC;

|DEFBUCLE CargaLinVall;
     #3#1;
     ;
     aSerie, nNume, 001;
     aSerie, nNume, 999;
     be;
     NULL, CargaLinVall;
|FIN;

|PROCESO LinVallcorba;
     |SI aCamArti = ""; |ACABA; |FINSI;

     nLin = nLin + 1;
     |DDEFECTO #0;
     #0#29 = #1#52;
     #0#0 = #1#0;
     #0#1 = nLin;
     #0#2 = aCampo9;
     #0#3 = aCampo4;
     #0#4 = aCampo3;
     #0#5 = nCamUni;
     #0#6 = aCampo12;
     #0#8 = aCampo13;
     #0#10 = aCampo14;
     #0#11 = aCampo15;
     #0#12 = aCampo8;
     #0#13 = aCampo16;
     #0#14 = enCoste;
     #0#15 = #1#3;
     #0#16 = aCampo17;
     #0#17 = aCampo18;
     #0#21 = aCampo24;
     #0#27 = aCampo19;
     #0#31 = aCampo7;
     #0#33 = aCampo20;
     #0#34 = aCampo21;
     #0#35 = aCampo22;
     #0#36 = aCampo23;
     #0#49 = aCampo5;
     nForma = 1;
     |HAZ ActVallcorba;
     #0#14 = #0#5 * #4#9;     || Precio de coste medio.
     |HAZ TotalLin71;
     |GRABA 020#0n;

     #3#28 = #0#31;
     #3#0 = #0#12;
     #3#1 = #0#21;
     |LEE 121#3=;

     enForma = 1;
     enUnidPend = #0#5;
     eaReservado = #3#22;
     eaDesprecia = "N";
     eaProgVta = "agifa210";
     |HAZ AcumulaAV;
     |LIBERA #3;
|FPRC;

|PROCESO Vallcorba;
     aSerie = #refere2@#7;
     nNume = #refere2@#8;

     nCamUni = #refere2@#2;
     aCamArti = #refere2@#9;
     nCamAlm = #refere2@#4;
     aCamLote = #refere2@#5;
     IaCampo = aCampo1<-;
     |PARA i = 1; |SI i [ 24; |HACIENDO i = i + 1;
          aCampo = #refere2@#i#;
          IaCampo = IaCampo + 1;
     |SIGUE;
     |HAZ LinVallcorba;
|FPRC;

|PROCESO VallAgrupa;
     aSerie = #refere2@#7;
     nNume = #refere2@#8;

     |SI aCamArti ! #refere2@#9; |O nCamAlm ! #refere2@#4;
               |O aCamLote ! #refere2@#5;
          |HAZ LinVallcorba;
          nCamUni = 0;
     |FINSI;
     nCamUni = nCamUni + #refere2@#2;
     aCamArti = #refere2@#9;
     nCamAlm = #refere2@#4;
     aCamLote = #refere2@#5;
     IaCampo = aCampo1<-;
     |PARA i = 1; |SI i [ 24; |HACIENDO i = i + 1;
          aCampo = #refere2@#i#;
          IaCampo = IaCampo + 1;
     |SIGUE;
|FPRC;

|DEFBUCLE VallNormal;
     #refere2@#1003;
     ;
     #1#52, #1#0, 001;
     #1#52, #1#0, 999;
     ;
     NULL, Vallcorba;
|FIN;

|DEFBUCLE VallAgrupa;
     #refere2@#3006;
     ;
     #1#52, #1#0, "                    ", 00001, "      ", 00000;
     #1#52, #1#0, "zzzzzzzzzzzzzzzzzzzz", 99999, "zzzzzz", 99999;
     ;
     NULL, VallAgrupa;
|FIN;

|PROCESO CargaVallcorba;
     |DDEF aAlfa;
     aAlfa = aAlfa + "vallcm01";
     |CARGA_DEF aAlfa, refere2@;
     |SI FSalida = 0;
          nLin = 0;
          |ABRE #3;
          |SI enMenuVallc = 2;
               |BUCLE VallNormal;
          |SINO;
               aCamArti = "";
               |BUCLE VallAgrupa;
               |HAZ LinVallcorba;
          |FINSI;
          |CIERRA #3;
          |SI nLin > 0;
/* esto no es necesario para este modulo
               |BUCLE CargaLinVall;
               |ABRE #2;
               #2#25 = aSerie;
               #2#0 = nNume;
               |LEE 121#2=;
               |SI FSalida = 0;
                    #1#55 = #2#53;
                    #1#56 = #2#54;
                    #1#57 = #2#55;
                    |HAZ CalCabAgifa104;
                    |LIBERA #2;
               |FINSI;
               |CIERRA #2;
*/
          |SINO;
               |BORRA 000#1c;
          |FINSI;
          |DESCARGA_DEF #refere2@;
     |FINSI;
|FPRC;
---------------------

|PROCESO mirespor211;|TIPO 0;
     |ABRE #21;
     #21#26 = #0#29;
     |LEE 020#21=;
     |CIERRA #21;

     |ABRE #6;
     #6#0 = #1#3;
     |LEE 020#6=;
     |CIERRA #6;

     |SI #6#28 = "S"; |Y #0#11 ! 0;
          |MENAV mensaje5; #0#11 = 0; |PINTA #0#11;
     |SINO;
          |SI #0#11 ! 0; |Y #21#30 = "S";
               |MENSA mensaje5; #0#11 = 0; |PINTA #0#11;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO FeldoPortes;
     |DDEF aAlfa;
     aAlfa = aAlfa + "feldo001";
     |CARGA_DEF aAlfa, refere3@;
     |SI FSalida = 0;
          |ABRE #refere3@;
          |SELECT #2#refere3@;
          #refere3@#2 = #0#31;
          #refere3@#3 = #0#12;
          |LEE 101#refere3@.=;
          |SI FSalida = 0;
               #1#81 = #refere3@#4;
               #1#11 = #refere3@#4;
               #1#12 = #refere3@#5;
          |FINSI;
          |CIERRA #refere3@;
          |DESCARGA_DEF #refere3@;
     |SINO;
          |MENAV "0000Error al cargar 'feldo001'";
     |FINSI;
|FPRC;

|PROCESO Lineas211;
     |SI #refere2@#1 = #0#1;
          |ACABA;
     |FINSI;

     #refere3@#2 = #0#31;
     #refere3@#3 = #0#12;
     |LEE 000#refere3@.=;
     |SI FSalida = 0;
          |SI aPedi = "";
               aPedi = #refere2@#31 + #refere2@#12;
               nHayPed = 1;
          |SINO;
               aAlfa = #refere2@#31 + #refere2@#12;
               |SI aAlfa ! aPedi;
                    nHayPed = 2;
                    |ERROR10;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE Lineas211;
     #refere2@#1003;
     ;
     #0#29, #0#0, 001;
     #0#29, #0#0, 999;
     ;
     NULL, Lineas211;
|FIN;

|PROCESO FeldoUnPed;
     nHayPed = 0;
     aPedi = "";
     |DDEF aPath;
     aAlfa = aPath + "agifa071";
     |CARGA_DEF aAlfa, refere2@;
     |SI FSalida = 0;
          aAlfa = aPath + "feldo001";
          |CARGA_DEF aAlfa, refere3@;
          |SI FSalida = 0;
               |ABRE #refere3@;
               |SELECT #2#refere3@;
               |BUCLE Lineas211;
               |CIERRA #refere3@;
               |DESCARGA_DEF #refere3@;
          |SINO;
               |MENAV "0000Error al cargar 'feldo001'";
          |FINSI;
          |DESCARGA_DEF #refere2@;
     |SINO;
          |MENAV "0000Error al cargar 'agifa211'";
     |FINSI;
|FPRC;

|PROCESO QDClorCamAdj;
     |DDEF aPath;
     aAlfa = aPath + "qdclor08";
     |CARGA_DEF aAlfa, refere2@;
     |SI FSalida = 0;
          |DDEFECTO #refere2@;
          |ABRE #refere2@;
          #refere2@#0 = #0#29;
          #refere2@#1 = #0#0;
          #refere2@#2 = #0#1;
          |LEE 101#refere2@.=;
          |SI FSalida ! 0; |GRABA 020#refere2@.b; |FINSI;

          aAlfa = aPath + "qdclor06";
          |CARGA_DEF aAlfa, refere1@;
          |SI FSalida = 0;
               |DDEFECTO #refere1@;
               |ABRE #refere1@;
               #refere1@#0 = #0#31;
               #refere1@#1 = #0#12;
               #refere1@#2 = #0#21;
               |LEE 000#refere1@.=;
               |CIERRA #refere1@;
               #refere2@#3 = #refere1@#3; ||Envases
               #refere2@#4 = #refere1@#4; ||Tipo
               |DESCARGA_DEF #refere1@;
          |FINSI;

          aAlfa = aPath + "qdclor01";
          |CARGA_DEF aAlfa, refere1@;
          |SI FSalida = 0;
               |DDEFECTO #refere1@;
               |ABRE #refere1@;
               #refere1@#0 = #0#2;
               |LEE 000#refere1@.=;
               |CIERRA #refere1@;
               #refere2@#5 = #refere1@#2; ||Emite Boletin
               |DESCARGA_DEF #refere1@;
          |FINSI;

          |GRABA 020#refere2@.a;
          |CIERRA #refere2@;
          |DESCARGA_DEF #refere2@;
     |FINSI;
|FPRC;

|PROCESO PinQDClor71;
     |DDEF aPath;
     aAlfa = aPath + "qdclor09";
     |CARGA_DEF aAlfa, refere2@;
     |SI FSalida = 0;
          |DDEFECTO #refere2@;
          |ABRE #refere2@;
          #refere2@#0 = #0#29;
          #refere2@#1 = #0#0;
          #refere2@#2 = #0#1;
          |LEE 000#refere2@.=;
          |CIERRA #refere2@;
          |ATRI R;
          |PINTA 0802, "Envases쿟ip쿍ol";
          |ATRI I;
          |PINTA 817, "";
          |PINTA 901, "             ";
          |PINTA 903, #refere2@#3;
          |PINTA 911, #refere2@#4;
          |PINTA 915, #refere2@#5;
          |ATRI 0;
          |DESCARGA_DEF #refere2@;
     |FINSI;
|FPRC;

|PROCESO gestrw02;
     #refere1@#29 = #0#29;
     #refere1@#0 = #0#0;
     #refere1@#1 = 999;
     |LEE 000#refere1@.];
     |SI FSalida = 0;
          |LEE 000#refere1@.a;
     |SINO;
          |LEE 000#refere1@.u;
     |FINSI;
     |SI FSalida = 0; |Y #refere1@#29 = #0#29; |Y #refere1@#0 = #0#0;
          nLin = #refere1@#1 + #42#236;
     |SINO;
          nLin = #42#236;
     |FINSI;
     |DDEFECTO #refere1@;
     #refere1@#29 = #0#29;
     #refere1@#0 = #0#0;
     #refere1@#1 = nLin;
     #refere1@#31 = #refere2@#3;
     #refere1@#12 = #refere2@#4;
     #refere1@#21 = #refere2@#5;
     aParGestral = #refere2@#2;

     |SALVA_DATOS #0;

     |SALVA_DATOS #refere1@;
     |REPON_DATOS #0;

     FSalida = 0;
     modo = 1;
     correcto = "N";
     nSwPtec = 1;
     |HAZ liadju;
     nSwPtec = 0;
     |SI nSwServida ! 0;
          |HAZ liacarti;
     |FINSI;

     |REPON_DATOS #0;
     nHay = 1;
|FPRC;

|DEFBUCLE gestrw02;
     #refere2@#1001;
     ;
     001;
     999;
     ;
     NULL, gestrw02;
|FIN;

|PROCESO GestralLector;
     nHay = 0;
     |DDEF aPath;
     aAlfa = aPath + "gestrw02";
     |CARGA_DEF aAlfa, refere2@;
     |SI FSalida = 0;
          aAlfa = aPath + "agifa211";
          |CARGA_DEF aAlfa, refere1@;
          |SI FSalida = 0;
               |HAZ CreaTempo; |NOME_DAT #refere2@#Tempo#; |DELINDEX #refere2@;
               aAlfa = "gestrw02;PED" + Tempo;
               |SUB_EJECUTA_NP aAlfa;
               |ABRE #refere1@;
               aponer = Asino; |HAZ poncontr211;
               |BUCLE gestrw02;
               aponer = Anosi; |HAZ poncontr211;
               |CIERRA #refere1@;
               |HAZ BoraTempo; |DELINDEX #refere2@;
               |DESCARGA_DEF #refere1@;
          |FINSI;
          |DESCARGA_DEF #refere2@;
     |FINSI;
     |SI nHay = 1;
          |PTEC 816;
          |PTEC 812;
     |SINO;
          |PTEC 802;
          |ERROR;
     |FINSI;
|FPRC;

|PROCESO T211_3; |TIPO 3;
|FPRC;

|PROCESO EvaPenSer;
     aAlfa = #refere2@#0; |QBF aAlfa;
     |SI aAlfa = "";     || Si no tiene CB es un articulo normal, sin tallas
          |SI nSwTalla = 1; |ERROR10; |ACABA; |FINSI;
          nUni = #0#5;
     |SINO;
          nUni = 1;
          nContaUni = nContaUni - 1;
          |SI nContaUni < 0; |ERROR10; |ACABA; |FINSI;
     |FINSI;

     #refere2@#14 = #refere2@#14 + nUni;
     |SI #refere2@#14 ] #refere2@#13;
          #refere2@#11 = "S";
     |SINO;
          #refere2@#11 = "N";
     |FINSI;
     |GRABA 020#refere2@.a;

     |DDEFECTO #refere1@;
     #refere1@#0 = #0#29;
     #refere1@#1 = #0#0;
     #refere1@#2 = #0#1;
     #refere1@#3 = #0#2;
     #refere1@#5 = #0#31;
     #refere1@#6 = #0#12;
     #refere1@#7 = #0#21;
     #refere1@#9 = #1#1;
     #refere1@#10 = #1#3;
     #refere1@#11 = nUni;
     #refere1@#4 = #refere2@#3; || modelo
     #refere1@#8 = #refere2@#7; || referencia
     |SI aAlfa ! "";
          #refere1@#12 = #refere2@#2;|| talla
          #refere1@#13 = #refere2@#0; || CB
     |FINSI;
     |LEE 101#refere1@.=;
     |SI FSalida ! 0;
          |GRABA 020#refere1@.n;
     |SINO;
          |GRABA 020#refere1@.a;
     |FINSI;
     |LIBERA #refere1@;
|FPRC;

|DEFBUCLE EvaPenSer;
     #refere2@#3003;               ||evarm021
     11;
     #0#31, #0#12, #0#21, "N";
     #0#31, #0#12, #0#21, "N";
     be;
     NULL, EvaPenSer;
|FIN;

|PROCESO TmpUniServidas;
     #refere2@#4 = #refere3@#5;
     #refere2@#5 = #refere3@#6;
     #refere2@#6 = #refere3@#7;
     #refere2@#0 = #refere3@#13;
     |LEE 121#refere2@.=;
     #refere2@#14 = #refere2@#14 + 1;
     |SI #refere2@#14 ] #refere2@#13;
          #refere2@#11 = "S";
     |SINO;
          #refere2@#11 = "N";
     |FINSI;
     |GRABA 020#refere2@.a;
     |LIBERA #refere2@;

     |DDEFECTO #refere1@;
     #refere1@#0 = #0#29;
     #refere1@#1 = #0#0;
     #refere1@#2 = #0#1;
     #refere1@#3 = #0#2;
     #refere1@#5 = #0#31;
     #refere1@#6 = #0#12;
     #refere1@#7 = #0#21;
     #refere1@#9 = #refere3@#9;
     #refere1@#10 = #refere3@#10;
     #refere1@#11 = #refere3@#11;
     #refere1@#4 = #refere3@#4;
     #refere1@#8 = #refere3@#8;
     #refere1@#12 = #refere3@#12;
     #refere1@#13 = #refere3@#13;
     |LEE 101#refere1@.=;
     |SI FSalida ! 0;
          |GRABA 020#refere1@.n;
     |SINO;
          |GRABA 020#refere1@.a;
     |FINSI;
     |LIBERA #refere1@;
|FPRC;

|DEFBUCLE TmpUniServidas;
     #refere3@#4001;
     ;
     "      ";
     "zzzzzz";
     ;
     NULL, TmpUniServidas;
|FIN;

|PROCESO EvaGrabaAlta;
     |DDEF aPath;
     aAlfa = aPath + "evarm021";
     |CARGA_DEF aAlfa, refere2@;
     |SI FSalida = 0;
          aAlfa = aPath + "evarm022";
          |CARGA_DEF aAlfa, refere1@;
          |SI FSalida = 0;
               |SI nSwTalla = 1; |Y eaTmpEvaSer  ! "";
                    || El temporal se graba al pulsar F7 en la unidades, en
                    || el proceso evarz030, estas son las unidades a servir
                    |CARGA_DEF aAlfa, refere3@;
                    |SI FSalida = 0;
                         |NOME_DAT #refere3@#eaTmpEvaSer#;
                         |ABRE #refere2@;
                         |ABRE #refere1@;
                         |BUCLE TmpUniServidas;
                         |CIERRA #refere1@;
                         |CIERRA #refere2@;

                         eaTmpEvaSer = "";
                         |DELINDEX #refere3@;
                         |DESCARGA_DEF #refere3@;
                    |FINSI;
               |SINO;
                    nContaUni = #0#5;
                    |ABRE #refere1@;
                    |BUCLE EvaPenSer;
                    |CIERRA #refere1@;
               |FINSI;
               |DESCARGA_DEF #refere1@;
          |SINO;
               |MENAV "0000Error al cargar 'evarm022'";
          |FINSI;
          |DESCARGA_DEF #refere2@;
     |SINO;
          |MENAV "0000Error al cargar 'evarm021'";
     |FINSI;
|FPRC;

|PROCESO EvaServidos;
     aAlfa = #refere1@#13; |QBF aAlfa;
     |SI aAlfa = "";   ||  Si no tiene CB es un articulo normal, sin tallas
          #refere1@#11 = #0#5;

          #refere2@#4 = #refere1@#5;
          #refere2@#5 = #refere1@#6;
          #refere2@#6 = #refere1@#7;
          #refere2@#0 = #refere1@#13;
          |LEE 101#refere2@.=;
          |SI FSalida = 0;
               #refere2@#14 = #refere2@#14 + ((#refere1@#11 - #3#12) * nForma);
               #refere2@#12 = #refere2@#13 - #refere2@#14;
               |SI #refere2@#12 [ 0;
                    #refere2@#11 = "S";
               |SINO;
                    #refere2@#11 = "N";
               |FINSI;
               |GRABA 020#refere2@.a;
               |LIBERA #refere2@;
          |FINSI;
          |SI modo = 3;
               |BORRA 020#refere1@.a;
          |SINO;
               |GRABA 020#refere1@.a;
          |FINSI;
     |SINO;
          #refere2@#4 = #refere1@#5;
          #refere2@#5 = #refere1@#6;
          #refere2@#6 = #refere1@#7;
          #refere2@#0 = #refere1@#13;
          |LEE 101#refere2@.=;
          |SI FSalida = 0;
               #refere2@#11 = "N";
               |GRABA 020#refere2@.a;
               |LIBERA #refere2@;
          |FINSI;
          |BORRA 020#refere1@.a;
     |FINSI;
|FPRC;

|DEFBUCLE EvaServidos;
     #refere1@#1004;
     ;
     #0#29, #0#0, #0#1, "            ";
     #0#29, #0#0, #0#1, "zzzzzzzzzzzz";
     be;
     NULL, EvaServidos;
|FIN;

|PROCESO EvaGrabaModi;
     |SI modo = 1;
          |ACABA;
     |FINSI;

     |DDEF aPath;
     aAlfa = aPath + "evarm021";
     |CARGA_DEF aAlfa, refere2@;
     |SI FSalida = 0;
          aAlfa = aPath + "evarm022";
          |CARGA_DEF aAlfa, refere1@;
          |SI FSalida = 0;
               |ABRE #refere2@;
               nUni = #0#5;
               |BUCLE EvaServidos;
               |CIERRA #refere2@;
               |DESCARGA_DEF #refere1@;
          |SINO;
               |MENAV "0000Error al cargar 'evarm022'";
          |FINSI;
          |DESCARGA_DEF #refere2@;
     |SINO;
          |MENAV "0000Error al cargar 'evarm021'";
     |FINSI;
     |SI nForma = 1;
          nSwTalla = 1;
          |HAZ EvaGrabaAlta;
          nSwTalla = 0;
     |FINSI;
|FPRC;

|PROCESO GestralPreDibu;
     nFactor = 1;
     |DDEF aPath;
     aAlfa = aPath + "gestrm13";
     |CARGA_DEF aAlfa, gestral@;
     |SI FSalida = 0;
          |ABRE #gestral@;
          #gestral@#0 = #4#126;
          |LEE 000#gestral@.=;
          |SI FSalida = 0;
               nFactor = #gestral@#2;
          |FINSI;
          |CIERRA #gestral@;
          |DESCARGA_DEF #gestral@;
     |SINO;
          |MENAV "0000Error al cargar 'gestrm13'...";
     |FINSI;

     aAlfa = aPath + "gestrm12";
     |CARGA_DEF aAlfa, gestral@;
     |SI FSalida = 0;
          |ABRE #gestral@;
          #gestral@#0 = #1#3;
          #gestral@#1 = #4#2;
          |LEE 000#gestral@.=;
          |SI FSalida = 0;
               |SI #0#48 = 0;
                    #0#6 = #gestral@#5 * nFactor;
                    #0#36 = #gestral@#5 * nFactor;
                    #0#38 = #gestral@#5 * nFactor;
               |SINO;
                    #0#6 = #gestral@#4 * nFactor;
                    #0#36 = #gestral@#4 * nFactor;
                    #0#38 = #gestral@#4 * nFactor;
               |FINSI;
          |FINSI;
          |CIERRA #gestral@;
          |DESCARGA_DEF #gestral@;
     |FINSI;
|FPRC;

|PROCESO GestralAdjUni;
     #0#49 = aParGestral;
     aAlfa = #0#49; |QBF aAlfa;
     |SI aAlfa = ""; |ACABA; |FINSI;
     aParGestral = "";

     |ABRE #24;
     #24#0 = #0#2;
     #24#1 = #0#3;
     #24#2 = #0#49;
     |LEE 000#24=;
     |SI FSalida ! 0;
          aAlfa = "0000No existe partida:" + #0#49; |QBF aAlfa;
          |MENAV aAlfa;
          |DDEFECTO #24;
     |FINSI;
     |CIERRA #24;

     |SI #0#48 = 0; || adj. por metros
          |SI #0#5 > #24#22;
               #0#5 = #24#22;
               aDespreciar = "S";
          |FINSI;
     |SINO;         || adj. por piezas
          |SI #24#23 ] 1;
               #0#48 = 1;
               #0#5 = #24#22;
               |SI nPendiente2 = 1;
                    aDespreciar = "S";
               |FINSI;
          |SINO;
               #0#48 = 0;
               #0#5 = 0;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO ChampEmarEnv;
     |DDEF aPath;
     aAlfa = aPath + "champi10";
     |CARGA_DEF aAlfa, refere2@;
     |SI FSalida = 0;
          aAlfa = aPath + "champi04";
          |CARGA_DEF aAlfa, refere1@;
          |SI FSalida = 0;
               |ABRE #refere2@;
               #refere2@#0 = #3#28;
               #refere2@#1 = #3#0;
               #refere2@#2 = #3#1;
               |LEE 000#refere2@.=;
               |SI FSalida ! 0; |DDEFECTO #refere2@; |FINSI;
               |CIERRA #refere2@;

               |ABRE #refere1@;
               #refere1@#0 = #0#29;
               #refere1@#1 = #0#0;
               #refere1@#2 = #0#1;
               |LEE 000#refere1@.=;
               |SI FSalida ! 0; |GRABA 020#refere1@.b; |FINSI;
               |SI #0#5 = #3#5;
                   #refere1@#3 = #refere2@#3;
                    #refere1@#5 = #refere2@#5;
                    #refere1@#4 = #refere2@#4;
                    #refere1@#6 = #refere2@#6;
               |SINO;
                    #refere1@#3 = #0#5 * #refere2@#3 / #3#5;
                    #refere1@#5 = #refere1@#3 * (#refere2@#5/#refere2@#3);
                    #refere1@#4 = #0#5 + #refere1@#5;
                    #refere1@#6 = #refere2@#6;
               |FINSI;
               |GRABA 020#refere1@.a;
               |CIERRA #refere2@;

               |DESCARGA_DEF #refere1@;
          |SINO;
               |MENAV "0000Error al cargar 'champi004'...";
          |FINSI;
          |DESCARGA_DEF #refere2@;
     |SINO;
          |MENAV "0000Error al cargar 'champi010'...";
     |FINSI;
|FPRC;

|PROCESO ChampEnvase1;
     nLin = nLin + 1;
     |SI nLin > 1;
          |SI nLin = 2;
               aponer = Asino; |HAZ poncontr211;
          |FINSI;
          #refere1@#29 = #0#29;
          #refere1@#0 = #0#0;
          #refere1@#1 = 999;
          |LEE 000#refere1@.];
          |SI FSalida = 0;
               |LEE 000#refere1@.a;
          |SINO;
               |LEE 000#refere1@.u;
          |FINSI;
          |SI FSalida = 0; |Y #refere1@#29 = #0#29; |Y #refere1@#0 = #0#0;
               nLin = #refere1@#1 + #42#236;
          |SINO;
               nLin = #42#236;
          |FINSI;
          |SI nLin = #0#1; nLin = nLin + 1; |FINSI;

          |SALVA_DATOS #0;
          |REPON_DATOS #refere1@;
          #refere1@#1 = nLin;
          #refere1@#5 = #refere3@#3 - #refere3@#4;
          |SALVA_DATOS #refere1@;
          |REPON_DATOS #0;
          enForma = 1;
          |HAZ AcumulaAV;
          #0#14 = enCoste;
          |HAZ TotalLin71;
          |HAZ AcuAlbaran;
          |SALVA_DATOS #0;
          |REPON_DATOS #refere1@;
          |GRABA 020#refere1@.n;

          |DDEFECTO #refere2@;
          #refere2@#0 = #refere1@#29;
          #refere2@#1 = #refere1@#0;
          #refere2@#2 = #refere1@#1;
          |LEE 101#refere2@.=;
          |SI FSalida ! 0; |GRABA 020#refere2@.b; |FINSI;
          #refere2@#3 = #refere3@#2;
          #refere2@#4 = #refere3@#3;
          #refere2@#5 = #refere3@#4;
          #refere2@#6 = #refere3@#1;
          |GRABA 020#refere2@.a;
          |LIBERA #refere2@;
     |FINSI;
|FPRC;

|DEFBUCLE ChampEnvase1;
     #refere3@#1001;
     ;
     001;
     999;
     ;
     NULL, ChampEnvase1;
|FIN;

|PROCESO ChampiEmarEnv1;
     |DDEF aPath;
     aAlfa = aPath + "agifa071";
     |CARGA_DEF aAlfa, refere1@;
     |SI FSalida = 0;
          aAlfa = aPath + "champi04";
          |CARGA_DEF aAlfa, refere2@;
          |SI FSalida = 0;
               aAlfa = aPath + "champi09";
               |CARGA_DEF aAlfa, refere3@;
               |SI FSalida = 0;
                    |NOME_DAT #refere3@#eaTmpAV816#;
                    nLin = 0;

                    |SALVA_DATOS #0;
                    |ABRE #refere1@;
                    |ABRE #refere2@;
                    |BUCLE ChampEnvase1;
                    |CIERRA #refere2@;
                    |CIERRA #refere1@;
                    |REPON_DATOS #0;
                    |SI nLin > 1;
                         aponer = Anosi; |HAZ poncontr211;
                         |PTEC 809; |PTEC 816; |PTEC 806;
                    |FINSI;

                    |DELINDEX #refere3@;
                    |DESCARGA_DEF #refere3@;
               |SINO;
                    |MENAV "0000Error al cargar 'champi09'";
               |FINSI;
               |DESCARGA_DEF #refere2@;
          |SINO;
               |MENAV "0000Error al cargar 'champi04'";
          |FINSI;
          |DESCARGA_DEF #refere1@;
     |SINO;
          |MENAV "0000Error al cargar 'agifa071'";
     |FINSI;
|FPRC;

|PROCESO ChampEmarBor;
     |DDEF aPath;
     aAlfa = aPath + "champi04";
     |CARGA_DEF aAlfa, refere1@;
     |SI FSalida = 0;
          |ABRE #refere1@;
          #refere1@#0 = #0#29;
          #refere1@#1 = #0#0;
          #refere1@#2 = #0#1;
          |BORRA 000#refere1@.c;
          |CIERRA #refere1@;
     |SINO;
          |MENAV "0000Error al cargar 'champi04'";
     |FINSI;
|FPRC;

|PROCESO CheqPartiBlan0;
     aAlfa = #0#49; |QBF aAlfa;
     #4#0 = #0#2;
     |LEE 020#4=;
     |SI FSalida = 0; |Y #4#180 = "S"; |Y aAlfa = "";
          enForma = -1;
          nForma = -1;
          |HAZ ActuaResto;
          |HAZ AcuAlbaran;

          |PUSHV 0501 2380;
          |C_A #0#2, 0, nAncho2; |C_A #0#2, 1, 20;
          |C_A #0#4, 0, nAncho4; |C_A #0#4, 1, 47;
          |PINTA 2302, "Articulo:"; |PINTA 2311, #0#2; |PINTA 2332, #0#4;
          |HAZ DobleUniV;
          aPedCompleto = "N";
          |HAZ mas_o_menos;
          |C_A #0#2, 1, nAncho2;
          |C_A #0#4, 1, nAncho4;
          |POPV;

          enForma = 1;
          nForma = 1;
          |HAZ ActuaResto;
          |HAZ AcuAlbaran;
          |GRABA 020#0a;
     |FINSI;
|FPRC;

|DEFBUCLE CheqPartiBlan0;
     #0#1;
     ;
     #1#52, #1#0, 001;
     #1#52, #1#0, 999;
     be;
     NULL, CheqPartiBlan0;
|FIN;

|PROCESO CheqPartiBlan;
     |ABRE #4;
     |BUCLE CheqPartiBlan0;
     |CIERRA #4;
|FPRC;

|PROCESO GesiAlbPideMat;
     |ABRE #4;
     #4#0 = #0#2;
     |LEE 000#4=;
     |SI FSalida = 0; |Y #4#174 = "S ";
          eaArticulo = #0#2;
          eaCliente = #1#3;
          efFecha = #1#1;
          aAlfa = "gesiz019;AJ" + #0#29 + (("000000"+#0#0)%-106) + #0#1;
          |SUB_EJECUTA_NP aAlfa;
          |SI eaMatri = ""; |ERROR; |FINSI;
     |SINO;
          |HAZ GesiBorMaqui;
     |FINSI;
     |CIERRA #4;
     aAlfa = #0#49; #0#49 = eaMatri;
     |C_V #0#49, 1, "S";
     |PINTA 1113, #0#49;
     |C_V #0#49, 1, "N";
     #0#49 = aAlfa;
|FPRC;

|PROCESO GesiActMaqui;
     |HAZ GesiLeeMaqui;
     |SI eaMatri = ""; |ACABA; |FINSI;
     nSwPasa = 0;
     |DDEF aPath;
     aAlfa = aPath + "gesim006";
     |CARGA_DEF aAlfa, refere2@;
     |SI FSalida = 0;
          |SI #0#29 = #refere2@#2; |O #0#29 = #refere2@#3;
                    |O #0#29 = #refere2@#4; |O #0#29 = #refere2@#5;
               nSwPasa = 1;
          |FINSI;
          |DESCARGA_DEF #refere2@;
     |FINSI;
     |SI nSwPasa = 1; |ACABA; |FINSI;

     aAlfa = aPath + "gesim002";
     |CARGA_DEF aAlfa, refere2@;
     |SI FSalida = 0;
          |ABRE #refere2@;
          #refere2@#0 = eaMatri;
          |LEE 101#refere2@.=;
          |SI FSalida = 0;
               |SI nForma = 1;
                    |ABRE #6;
                    #6#0 = #1#3;
                    |LEE 000#6=;
                    |CIERRA #6
                    #refere2@#6 = #6#0;
                    #refere2@#7 = #6#1;
                    #refere2@#8 = #1#1;
                    #refere2@#9 = #0#9;
                    #refere2@#10 = #1#6;
                    #refere2@#15 = #0#29;
                    #refere2@#16 = #0#0;
                    #refere2@#21 = #6#17;
               |SINO;
                    #refere2@#6 = "";
                    #refere2@#7 = "";
                    #refere2@#8 = "01.01.0000";
                    #refere2@#9 = "";
                    #refere2@#10 = "";
                    #refere2@#15 = "";
                    #refere2@#16 = "";
                    #refere2@#21 = "";
               |FINSI;
               |GRABA 020#refere2@.a;
          |FINSI;
          |CIERRA #refere2@;
          |DESCARGA_DEF #refere2@;
     |SINO;
          |MENAV "0000Error al cargar 'gesim002'";
     |FINSI;
|FPRC;

|PROCESO GesiLeeMaqui;
     |DDEF aAlfa;
     aAlfa = aAlfa + "gesim024";
     |CARGA_DEF aAlfa, refere1@;
     |SI FSalida = 0;
          |ABRE #refere1@;
          #refere1@#0 = "AV";
          #refere1@#1 = #0#29;
          #refere1@#2 = #0#0;
          #refere1@#3 = #0#1;
          |LEE 000#refere1@.=;
          |SI FSalida = 0;
               eaMatri = #refere1@#4;
          |SINO;
               eaMatri = "";
          |FINSI;
          |CIERRA #refere1@;
          |DESCARGA_DEF #refere1@;
     |SINO;
          |MENAV "0000Error al cargar 'gesim024'";
     |FINSI;
|FPRC;

|PROCESO GesiBorMaqui;
     |DDEF aAlfa;
     aAlfa = aAlfa + "gesim024";
     |CARGA_DEF aAlfa, refere1@;
     |SI FSalida = 0;
          |ABRE #refere1@;
          #refere1@#0 = "AV";
          #refere1@#1 = #0#29;
          #refere1@#2 = #0#0;
          #refere1@#3 = #0#1;
          |LEE 101#refere1@.=;
          |SI FSalida = 0;
               |BORRA 020#refere1@.a;
          |FINSI;
          |CIERRA #refere1@;
          |DESCARGA_DEF #refere1@;
     |FINSI;
|FPRC;

|PROCESO Comi211; |TIPO 0;
     |SI FSalida ! 2;
          |HAZ EsOrts;
          |SI FSalida = 0;
               enModo = (FEntrada / 100) ! 0;
               eaTipo = "AD";
               eaSerie = #0#29;
               enCodigo = #0#0;
               enLinea = #0#1;
               |SUB_EJECUTA_NP "ortsm022";
               |HAZ OrtsPin211;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO OrtsPin211;
     |DDEF aAlfa;
     aAlfa = aAlfa + "ortsm022";
     |CARGA_DEF aAlfa, refere1@;
     |SI FSalida = 0;
          |ABRE #refere1@;
          #refere1@#0 = "AD";
          #refere1@#1 = #0#29;
          #refere1@#2 = #0#0;
          #refere1@#3 = #0#1;
          |LEE 000#refere1@.=;
          |SI FSalida ! 0; |DDEFECTO #refere1@; |FINSI;
          |ATRI R;
          |PINTA 1130, "%Com.Rep2:";
          |ATRI I;
          |PINTA 1140, #refere1@#7;
          |ATRI 0;
          |DESCARGA_DEF #refere1@;
     |FINSI;
|FPRC;

|PROCESO ComiOrts211;
     |HAZ EsOrts;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |DDEF aAlfa;
     aAlfa = aAlfa + "ortsm021";
     |CARGA_DEF aAlfa, refere1@;
     |SI FSalida = 0;
          |ABRE #refere1@;
          #refere1@#0 = "A";
          #refere1@#1 = #0#29;
          #refere1@#2 = #0#0;
          |LEE 000#refere1@.=;
          |CIERRA #refere1@;
          eaRepre = #refere1@#4;
          eaTComision = #refere1@#5;
          |DESCARGA_DEF #refere1@;

          |HAZ Comisiones;
          eaTipo = "A";
          eaSerie = #0#29;
          enCodigo = #0#0;
          enLinea = #0#1;
          |SUB_EJECUTA_NP "ortsm022;DEFECTO";
          |HAZ OrtsPin211;
     |FINSI;
|FPRC;

|PROCESO ComiOrtsPed;
     |HAZ EsOrts;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |DDEF aAlfa;
     aAlfa = aAlfa + "ortsm022";
     |CARGA_DEF aAlfa, refere1@;
     |SI FSalida = 0;
          |ABRE #refere1@;
          #refere1@#0 = "P";
          #refere1@#1 = #3#28;
          #refere1@#2 = #3#0;
          #refere1@#3 = #3#1;
          |LEE 000#refere1@.=;
          |CIERRA #refere1@;
          enComision = #refere1@#7;
          |DESCARGA_DEF #refere1@;
          eaTipo = "A";
          eaSerie = #0#29;
          enCodigo = #0#0;
          enLinea = #0#1;
          |SUB_EJECUTA_NP "ortsm022;DEFECTO";
          |HAZ OrtsPin211;
     |FINSI;
|FPRC;

|PROCESO OrtsAlbRep2;
     |DDEF aAlfa;
     aAlfa = aAlfa + "ortsm021";
     |CARGA_DEF aAlfa, refere1@;
     |SI FSalida = 0;
          |ABRE #refere1@;
          #refere1@#0 = "P";
          #refere1@#1 = #2#25;
          #refere1@#2 = #2#0;
          |LEE 000#refere1@.=;
          |SI FSalida = 0;
               aAlfa = #refere1@#4;
               #refere1@#0 = "A";
               #refere1@#1 = #0#52;
               #refere1@#2 = #0#0;
               |LEE 101#refere1@.=;
               |SI FSalida = 0;
                    #refere1@#4 = aAlfa;
                    |GRABA 020#refere1@.a;
               |FINSI;
          |FINSI;
          |CIERRA #refere1@;
          |DESCARGA_DEF #refere1@;
     |FINSI;
|FPRC;

|PROCESO EvaConTalla;
     nEvaConTalla = 0;
     |DDEF aAlfa;
     aAlfa = "evarm021";
     |CARGA_DEF aAlfa, refere1@;
     |SI FSalida = 0;
          |ABRE #refere1@;
          #refere1@#4 = #0#31;
          #refere1@#5 = #0#12;
          #refere1@#6 = #0#21;
          #refere1@#4 = "";
          |LEE 000#refere1@.];
          |SI FSalida = 0; |Y #refere1@#4 = #0#31; |Y #refere1@#5 = #0#12;
                    |Y #refere1@#6 = #0#21;
               aAlfa = #refere1@#0; |QBF aAlfa;
               |SI aAlfa ! ""; nEvaConTalla = 1; |FINSI;
          |FINSI;
          |CIERRA #refere1@;
          |DESCARGA_DEF #refere1@;
     |FINSI;
|FPRC;

|PROCESO UniGofre;
     |HAZ EsGofre;
     |SI FSalida = 0;
          eaSerie = #0#29;
          enCodigo = #0#0;
          enLinea = #0#1;
          enUnidades = #0#5;
          eaCliente = #1#3;
          eaArticulo = #0#2;
          enModo = modo;
          |SUB_EJECUTA_NP "gofrem04";
     |FINSI;
|FPRC;

|PROCESO AdjudicaPdte;
     enPedCab = 0;
     nLinAct = #0#1;
     aponer = Asino; |HAZ poncontr211;
     |NOME_DAT #300 eaFicPdte;
     |ABRE #300;
     |SELECT #2#300;
     |LEE 000#300p;
     |PARA; |SI FSalida = 0; |HACIENDO;
          |SI #300#12 = "*";
               #0#1 = nLinAct;
               #0#31 = #300#0;
               #0#12 = #300#1;
               #0#21 = #300#2;

               FSalida = 0;
               modo = 1;
               correcto = "N";
               nSwPtec = 1;
               |HAZ liadju;
               nSwPtec = 0;
               |SI nSwServida > 0;
                    |HAZ liacarti;
                    nLinAct = nLinAct + #42#236;
               |FINSI;
          |FINSI;
          |LEE 000#300s;
     |SIGUE;
     |DELINDEX #300; Tempo = eaFicPdte; |HAZ BoraTempo;
     aponer = Anosi; |HAZ poncontr211;
|FPRC;

|PROCESO OrtsAlbConsumo;
     |DDEF aAlfa;
     aAlfa = aAlfa + "ortsm035";
     |CARGA_DEF aAlfa, refere1@;
     |SI FSalida = 0;
          |HORA aAlfa;
          |ABRE #refere1@;
          #refere1@#0 = #0#29;
          #refere1@#1 = #0#0;
          #refere1@#2 = #0#1;
          |LEE 101#refere1@.=;
          |SI FSalida ! 0; |GRABA 020#refere1@.b; |FINSI;
          #refere1@#3 = ~;
          #refere1@#4 = aAlfa;
          #refere1@#5 = #0#31;
          #refere1@#6 = #0#12;
          #refere1@#7 = #0#21;
          #refere1@#8 = aTipo;
          #refere1@#9 = "N";
          |GRABA 020#refere1@.a;
          |CIERRA #refere1@;
          |DESCARGA_DEF #refere1@;
     |FINSI;
|FPRC;

|PROCESO ChampiEmarPorte;
     |DDEF aAlfa;
     aAlfa = aAlfa + "champi14";
     |CARGA_DEF aAlfa, refere1@;
     |SI FSalida = 0;
          |ABRE #refere1@;
          #refere1@#0 = #0#31;
          #refere1@#1 = #0#12;
          |LEE 000#refere1@.=;
          |SI FSalida = 0;
               #1#11 = #1#11 + #refere1@#2;
               #1#81 = #1#81 + #refere1@#2;
          |FINSI;
          |CIERRA #refere1@;
          |DESCARGA_DEF #refere1@;
     |FINSI;
|FPRC;

|PROCESO JamaCheqEntrega;
     aAlfa = "";
     |ABRE #1000;
     #1000#30 = "P";
     #1000#20 = #0#31;
     #1000#17 = #0#12;
     #1000#18 = 0;
     |LEE 000#1000];
     |SI FSalida = 0; |Y #1000#30 = "P"; |Y #1000#20 = #0#31; |Y #1000#17 = #0#12;
          aAlfa = "0000Pedido con entregas." + &13 + "Use la adj. automtica...";
          |MENAV aAlfa;
     |FINSI;
     |CIERRA #1000;
     |SI aAlfa = ""; FSalida = 0; |SINO; FSalida = 1; |FINSI;
|FPRC;
