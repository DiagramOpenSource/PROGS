|FICHEROS;
     agift552 #0;

     expor024@ #1;        ||Cliente a exportar
     agifa024 #11;

     expor019@ #2;        ||Articulo a exportar
     agifa019 #12;

     expor112@ #3;        ||Proveedor a importar
     agifa112 #13;

     expor025@ #4;        ||Comisionista a importar
     agifa025 #14;

     expor010@ #5;        || Albaran a exportar (Cab y lineas)
     agifa010 #15;

     expor071@ #6;
     agifa071 #16;

     expor084@ #7;        ||Factura contado
     agifa084 #17;

     expor069@ #8;        ||Linea factura contado
     agifa069 #18;

     expor501@ #9;
     agifa501 #19;       || Cabecera de tiquet

     expor502@ #10;
     agifa502 #20;       || Linea de tiquet

     expor513@ #21;
     agifa513 #31;       ||Cobros pase

     expor512@ #22;          ||Pagos pase
     agifa512 #32;

     expor509@ #53;  ||Resumen Parcial pase
     agifa509 #54;  ||Resumen Parcial

     expor001@ #55;  ||Cod. Barras
     dsl00001 #56;

     expor065@ #23;
     agifa065 #33;

     agift555 #50;       || Fichero CONTROL CAMINO EXPORT/IMPORT

     testigo  #51;  ||testigo de exportacion
     agif0041 #52;  ||Empresas
     dsm00032 #100;

     expord05@ #805;
     dsm00005 #905;

     expord06@ #806;
     dsm00006 #906;
     ||컴컴컴컴컴컴컴컴컴컴컴컴횺arhuenda
     expor334@ #334
     marhu334@ #434;
     expor335@ #335
     marhu335@ #435;
     ||컴컴컴컴컴컴컴컴컴컴컴컴
|FIN;

|VARIABLES;
     &eaNomDef = "";
     &enCamposDef = 0;
     nCampos  = 0;
     nSwMarhu = 0;
     aParam    = "";
     n024 = 0; n019 = 0; n112 = 0; n025 = 0; n010 = 0; n071 = 0;
     n084 = 0; n069 = 0; n501 = 0; n502 = 0; n513 = 0; n512 = 0;
     n509 = 0; n065 = 0; n001 = 0; n905 = 0; n906 = 0;
     ddx = "";
     fich = "";
     org = "";
     num = 0;
     bufer = 0;
     err = 0;
     fdes = "";
     des = "";
     fdef = "";
     def = "";
     exp = 0;
     sw_pasada = 0;
     &qFichero = "";
     desdec="      ";
     hastac="zzzzzz";
     desdea="                    ";
     hastaa="zzzzzzzzzzzzzzzzzzzz";
     desdep="    ";
     hastap="zzzz";
     desdecom="  ";
     hastacom="zz";
     desdeser="  ";
     hastaser="zz";
     desdealb=0;
     hastaalb=999999;
     desdefa="      ";
     hastafa="zzzzzz";
     desfecha= "00.00.0000";
     hasfecha= "31.12.9999";
     i=0;
     sist="";
     dirfich="";
     mandato="";
     mandato1="";
     mensaje1= "0000ATENCION No puedo abrir fichero de control EXPORT/IMPORT";
     mensaje2= "0000ATENCION Debe informar del CONTROL CAMINO EXPORT/IMPORT";
     path="";
     no="N";
     fecha="00.00.0000";
     copia="";
     p="";
     p1="";
     campos=0;
     cam="";
     si="S";
     blanco="                         ";
     blanco1="                    ";
     tipo = "";
     pintar = "";
     longfich = "";
     longfich1 = 0;
     longfich2 = "";
     empresa = "";
     hora = "";
     horat = "";

     a1        = "";
     a2        = "";
     aFic      = "";
     aTar      = "";
     aAlfa     = "";
     fFecha    = @;
     nLin      = 0;

     swErr    = 0;
     aMensa   = "";
     aPath    = "";
     aDef     = "";
     aDef1    = "";
     aDef2    = "";
     aDef3    = "";
     aDef4    = "";
     aDef5    = "";
     aDef6    = "";
     aDef7    = "";
     aDef8    = "";
     aDef9    = "";
     aDef10   = "";
     aDef11   = "";
     aDef12   = "";
     aDef13   = "";
     aDef14   = "";
     aDef15   = "";
     aDef16   = "";
     aDef17   = "";
     aDef18   = "";
     aDef19   = "";
|FIN;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
  El Nombre del Fichero:  ddmmyy + empresa + "." + Linea Histo
           digitos....   Fecha(6)   (5)             (3)
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴

|PROCESO Comprime;
     |ABRE #100;
     #100#0 = "E";
     #100#1 = fFecha;
     #100#2 = 999;
     |LEE 000#100];
     |SI FSalida = 0;
          |LEE 000#100a;
     |SINO;
          |LEE 000#100u;
     |FINSI;
     |SI FSalida = 0; |Y #100#0 = "E"; |Y #100#1 = fFecha;
          nLin = #100#2 + 1;
     |SINO;
          nLin = 1;
     |FINSI;

     aFic = (fFecha % 102) + (fFecha % 402) + (fFecha % -102);
     aAlfa = ("000" + nLin) % -103;
     aTar = aFic + empresa + "." + aAlfa;    ||->Nombre del Fichero

     a1 = path + aTar + " *.dat *.ixx *.ddx";
     a2 = path;
     |ATAR a1, a2;

     a1 = path + aTar;
     |COMPRIME a1;
     |FBORRA a1;
     a2 = path + aFic + empresa + ".gz";
     |RENOMBRA_FICHERO a2, a1;

     aFic = path + aTar;
     |XABRE "E", aFic, 0;
     |SI FSalida ! 0;
          aAlfa = "0000No puede compactar... " + aTar;
          |MENAV aAlfa;
          aTar = "ERROR EN TAR";
     |SINO;
          aFic = path;
          |_PDIR aFic;
          |PARA; |SI FSalida = 0; |HACIENDO;
               aAlfa = aFic % -103;
               |SI aAlfa = "ddx"; |O aAlfa = "ixx"; |O aAlfa = "dat";
                    aAlfa = aFic % -0805;
                    |SI aAlfa = "expor"; |FBORRA aFic; |FINSI;
                    aAlfa = aFic % -0507;
                    |SI aAlfa = "testigo"; |FBORRA aFic; |FINSI;
               |FINSI;
               |_SDIR aFic;
          |SIGUE;
     |FINSI;
     ||--------------------Registro
     |HORA aAlfa;
     |DDEFECTO #100;
     #100#0 = "E";
     #100#1 = fFecha;
     #100#2 = nLin;
     #100#3 = aAlfa;
     #100#4 = Usuario % 810;
     #100#5 = aTar;
     |GRABA 020#100n;
|FPRC;

||**********NO SE INCLUYEN ACUMULADOS
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO marhu335;
     aAlfa = "|NC";
     aAlfa = #435#aAlfa#;
     nCampos = aAlfa; nCampos = nCampos - 1;
     |PARA i = 0; |SI i [ nCampos; |HACIENDO i = i + 1;
          #335i = #435i;
     |SIGUE;
     |GRABA 020#335n;
|FPRC;

|DEFBUCLE marhu335;
     #435#1003;
     ;
     #434#0, #434#1, 001;
     #434#0, #434#1, 999;
     ;
     NULL, marhu335;
|FIN;

|PROCESO marhu334;
     sw_pasada = 1;
     |SI #434#5 = "C"; |ERROR; |ACABA; |FINSI; || Completado
     |SI #434#3 = "S"; |ERROR; |ACABA; |FINSI; || Exportado
     aAlfa = "|NC";
     aAlfa = #434#aAlfa#;
     nCampos = aAlfa; nCampos = nCampos - 1;
     |PARA i = 0; |SI i [ nCampos; |HACIENDO i = i + 1;
          #334i = #434i;
     |SIGUE;
     |GRABA 020#334n;
     #434#3 = "S";
     #434#4 = fFecha;
     |GRABA 020#434a;
     |BUCLE marhu335;
|FPRC;

|DEFBUCLE marhu334;
     #434#1002;
     ;
     00001, 000001;
     99999, 999999;
     be;
     NULL, marhu334, marhu335;
|FIN;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO CodBarra;
     sw_pasada = 1;
     |PINTA 2163 , blanco1;
     |PINTA 2163 , #56#1;
     |PARA i = 0; |SI i [ n001; |HACIENDO i = i + 1;
          #55i = #56i;
     |SIGUE;
     |GRABA 011#55n;
     #56#4 = "S";
     #56#5 = #0#4;
     |GRABA 011#56a;
     |LIBERA #56;
|FPRC;

|PROCESO miracli;
     sw_pasada = 1;
     |PINTA 2163 , blanco1;
     |PINTA 2163 , #11#0;
     |PARA i = 0; |SI i [ n024; |HACIENDO i = i + 1;
          #1i = #11i;
     |SIGUE;
     |GRABA 011#1n; ||grabo el nuevo
     #11#175 = "S";
     #11#176 = #0#4;
     |GRABA 011#11a;     ||Graba el original
     |LIBERA #11;
|FPRC;

|PROCESO miraarti;
     sw_pasada = 1;
     |PINTA 2163 , blanco1;
     |PINTA 2163 , #12#0;
     |PARA i = 0; |SI i [ n019; |HACIENDO i = i + 1;
          #2i = #12i;
     |SIGUE;
     |GRABA 011#2n;
     #12#123 = "S";
     #12#124 = #0#4;
     |GRABA 011#12a;     ||Graba el original
     |LIBERA #12;
|FPRC;

|PROCESO miraprove;
     sw_pasada = 1;
     |PINTA 2163 , blanco1;
     |PINTA 2163 , #13#0;
     |PARA i = 0; |SI i [ n112; |HACIENDO i = i + 1;
          #3i = #13i;
     |SIGUE;
     |GRABA 011#3n;
     #13#71 = "S";
     #13#72 = #0#4;
     |GRABA 011#13a;     ||Graba el original
     |LIBERA #13;
|FPRC;

|PROCESO miracomis;
     sw_pasada = 1;
     |PINTA 2163 , blanco1;
     |PINTA 2163 , #14#0;
     |PARA i = 0; |SI i [ n025; |HACIENDO i = i + 1;
          #4i = #14i;
     |SIGUE;
     |GRABA 011#4n;
     #14#54 = "S";
     #14#55 = #0#4;
     |GRABA 011#14a;     ||Graba el original
     |LIBERA #14;
|FPRC;

|PROCESO HistoEleme;
     |PARA i = 0; |SI i [ n906; |HACIENDO i = i + 1;
          #806i = #906i;
     |SIGUE;
     |GRABA 000#806n;
|FPRC;

|DEFBUCLE HistoEleme;
     #906#1;
     ;
     #33#0, #33#5, #33#1, #33#2, #33#11, #33#3, #33#4, "      ";
     #33#0, #33#5, #33#1, #33#2, #33#11, #33#3, #33#4, "zzzzzz";
     ;
     NULL, HistoEleme;
|FIN;

|PROCESO mirahis;
     |SI #33#2 = "ES"; |O #33#2 = "SS"; |O #33#2 = "EV"; |O #33#2 = "ME"; |O #33#2 = "MS";
          |PINTA 1763 , blanco1;
          |PINTA 1763 , #33#0;
          |PARA i = 0; |SI i [ n065; |HACIENDO i = i + 1;
               #23i = #33i;
          |SIGUE;
          |GRABA 011#23n;
          |LIBERA #23;
          #33#15 = "S";
          #33#16 = #0#4;
          |GRABA 011#33a;     ||Graba el original
          |LIBERA #33;
          sw_pasada = 1;
          |BUCLE HistoEleme;
     |FINSI;
|FPRC;

|PROCESO miralin;        ||Lineas de albaran
     sw_pasada = 1;
     |PARA i = 0; |SI i [ n071; |HACIENDO i = i + 1;
          #6i = #16i;
     |SIGUE;
     |GRABA 011#6n;      ||Grabo en el fichero destino
|FPRC;

|DEFBUCLE miralin;
     #16#1;
     ;
     #15#52, #15#0, 001;
     #15#52, #15#0, 999;
     ;
     NULL, miralin;
|FIN;

|PROCESO AlbaEleme;
     |PARA i = 0; |SI i [ n905; |HACIENDO i = i + 1;
          #805i = #905i;
     |SIGUE;
     |GRABA 000#805n;
|FPRC;

|DEFBUCLE AlbaEleme;
     #905#1;
     ;
     "AV", #15#52, #15#0, 001, "      ";
     "AV", #15#52, #15#0, 999, "zzzzzz";
     ;
     NULL, AlbaEleme;
|FIN;

|PROCESO miraalba;       ||albaran
     sw_pasada = 1;
     |PINTA 2163 , blanco1;
     pintar = #15#44 + " / " + #15#0;
     |PINTA 2163 , pintar;

     |PARA i = 0; |SI i [ n010; |HACIENDO i = i + 1;
          #5i = #15i;
     |SIGUE;
     #5#61 = #15#61;     || *(1)  A cuenta

     |GRABA 011#5n;      ||Grabo en el fichero destino
     #15#58 = "S";
     #15#59 = #0#4;

     |GRABA 011#15a;     ||Grabo en el origen que esta exportado
     |LIBERA #15;
     |BUCLE miralin;     || Por cada una de las lineas del albaran
     |BUCLE AlbaEleme;
|FPRC;

|PROCESO miralinfac;        ||Lineas de factura contado
     sw_pasada = 1;
     |PARA i = 0; |SI i [ n069; |HACIENDO i = i + 1;
          #8i = #18i;
     |SIGUE;
     |GRABA 011#8n;      ||Grabo en el fichero destino
|FPRC;

|DEFBUCLE miralinfac;
     #18#1;
     ;
     #17#48, #17#0, 001;
     #17#48, #17#0, 999;
     ;
     NULL, miralinfac;
|FIN;

|PROCESO FacEleme;
     |PARA i = 0; |SI i [ n905; |HACIENDO i = i + 1;
          #805i = #905i;
     |SIGUE;
     |GRABA 000#805n;
|FPRC;

|DEFBUCLE FacEleme;
     #905#1;
     ;
     "FC", #17#48, #17#0, 001, "      ";
     "FC", #17#48, #17#0, 999, "zzzzzz";
     ;
     NULL, FacEleme;
|FIN;

|PROCESO mirafac;       ||Facturas contado
     sw_pasada = 1;
     |PINTA 2163 , blanco1;
     pintar = #17#48 + " / " + #17#0;
     |PINTA 2163 , pintar;

     |PARA i = 0; |SI i [ n084; |HACIENDO i = i + 1;
          #7i = #17i;
     |SIGUE;
     #7#63= #17#63;      || *(1) A cuenta

     |GRABA 011#7n;      ||Grabo en el fichero destino
     #17#61 = "S";
     #17#62 = #0#4;
     |GRABA 011#17a;     ||Grabo en el origen que esta exportado y la fecha
     |LIBERA #17;
     |BUCLE miralinfac;      || Creo todas las lineas de esta factura
     |BUCLE FacEleme;
|FPRC;

|PROCESO miralintpv;        ||Lineas de tpv
     sw_pasada = 1;

     || *(1) Actualizo a cuenta
     |PARA i = 0; |SI i [ n502; |HACIENDO i = i + 1;
          #10i = #20i;
     |SIGUE;
     |GRABA 011#10n;      ||Grabo en el fichero destino
|FPRC;

|DEFBUCLE miralintpv;
     #20#1;
     ;
     #19#36, #19#0, 001;
     #19#36, #19#0, 999;
     ;
     NULL, miralintpv;
|FIN;

|PROCESO miratpv;          || Tiquets
     |PINTA 2163 , blanco1;
     pintar = #19#36 + " / " + #19#0;
     |PINTA 2163 , pintar;

||Actualizo los campos
     sw_pasada = 1;
     || *(1) Se incluye a cuenta
     |PARA i = 0; |SI i [ n501; |HACIENDO i = i + 1;
          #9i = #19i;
     |SIGUE;
     |GRABA 011#9n;      ||Grabo en el fichero destino
     #19#44 = "S";
     #19#45 = #0#4;
     |GRABA 011#19a;     ||Grabo en el origen que esta exportado y la fecha
     |LIBERA #19;
     |BUCLE miralintpv;      || Creo todas las lineas de este tiquet
|FPRC;

|PROCESO miracobro;      ||Cobros
     sw_pasada = 1;
     |PINTA 2163 , blanco1;
     pintar = #31#14 + " / " + #31#0;
     |PINTA 2163 , pintar;
     |PARA i = 0; |SI i [ n513; |HACIENDO i = i + 1;
          #21i=#31i;
     |SIGUE;
     |GRABA 011#21n;
     #31#9 = "S";          ||Exportado "S"
     #31#10 = #0#4;        ||Fecha export
     |GRABA 011#31a;
     |LIBERA #31;
|FPRC;

|PROCESO mirapago;       ||pagos
     sw_pasada = 1;
     |PINTA 2163 , blanco1;
     pintar = #32#12 + " / " + #32#0;
     |PINTA 2163 , pintar;
     |PARA i = 0; |SI i [ n512; |HACIENDO i = i + 1;
          #22i = #32i;
     |SIGUE;
     |GRABA 011#22n;
     #32#9="S";          ||Exportado "S"
     #32#10=#0#4;        ||Fecha export
     |GRABA 011#32a;
     |LIBERA #32;
|FPRC;

|DEFBUCLE 0;        ||CLientes #1
     #11#7;
     ;
     no,"      ";
     no,"zzzzzz";
     be;
     NULL,miracli;
|FIN;

|DEFBUCLE 1;        ||Articulos #2
     #12#3;
     ;
     no,"00.00.0000","                    ";
     no,"31.12.9999","zzzzzzzzzzzzzzzzzzzz";
     be;
     NULL,miraarti;
|FIN;

|DEFBUCLE 2;        ||Proveedor #3
     #13#4;
     ;
     no,"00.00.0000","      ";
     no,"01.01.9999","zzzzzz";
     be;
     NULL,miraprove;
|FIN;

|DEFBUCLE 3;        ||Comisionista #4
     #14#3;
     ;
     no,"  ";
     no,"zz";
     be;
     NULL,miracomis;
|FIN;

|DEFBUCLE 33;        ||Historico
     #33#6;
     ;
     "N"; || "                    ", "01.01.1900", "  ", 000000, 00000, "     ", "N";
     "N"; || "zzzzzzzzzzzzzzzzzzzz", "31.12.9999", "zz", 999999, 99999, "zzzzz", "N";
     be;
     NULL,mirahis;
|FIN;

|DEFBUCLE 4;        ||albaran#4
     #15#1;
     58;
     "     " ,       0 , no;
     "zzzzz" ,  999999 , no;
     be;
     NULL,miraalba;
|FIN;


|DEFBUCLE 5;        ||Facturas contado
     #17#1;
     61;
     "     " ,       0 , no;
     "zzzzz" ,  999999 , no;
     be;
     NULL,mirafac;
|FIN;


|| Por este defbucle se pasara dos veces una para cuando los tiquets sean tipo
|| de documento "T" y otra para cuando sean " ";
|DEFBUCLE 6;
  #19#2;
  44;
  tipo , "     ",       0, no;
  tipo , "zzzzz",  999999, no;
  be;
  NULL,miratpv;
|FIN;


|DEFBUCLE 7;        ||Defbucle de cobros
     #31#2;
     ;
     "     " ,       0 , no , "00.00.0000";
     "zzzzz" ,  999999 , no , "31.12.9999";
     be;
     NULL,miracobro;
|FIN;

|DEFBUCLE 8;        ||Defbucle de pagos
     #32#2;
     ;
     "     " ,       0 , no , "00.00.0000";
     "zzzzz" ,  999999 , no , "01.01.9999";
     be;
     NULL,mirapago;
|FIN;

|DEFBUCLE CodBarra;
     #56#4;
     ;
     no,0000001;
     no,9999999;
     be;
     NULL, CodBarra;
|FIN;

|PROCESO pasares;
     sw_pasada = 1;
     |DDEFECTO #53;
     |PARA i = 0; |SI i [ n509; |HACIENDO i = i + 1;
          #53i = #54i;
     |SIGUE;
     |GRABA 021#53n;
     |LIBERA #53;
     #54#60 = "S";
     #54#61 = #0#4;
     |GRABA 021#54a;
     |LIBERA #54;
|FPRC;

|DEFBUCLE resum;
#54#2;
56;  ||No paso las que la caja este abierta
0  ,  0 , "00.00.0000" , " " , "          " , " ";
99 , 99 , "31.12.9999" , "N" , "31.12.9999" , "N";     ||Las fechas se desactualizan
be;
NULL ,pasares;
|FIN;

|PROCESO resumen1;
|PATH_DAT #53 path;
|ABRE #53;
|CIERRA #53;
|DELINDEX #53;
|ABRE #53;
|BUCLE resum;
|CIERRA #53;
|FPRC;
=======================================================================
|PROCESO BusCampos;
     |DFICE org; |QBF org;
     |DBASE des; |QBF des;
     |DDEF  def; |QBF def;
     eaNomDef = "agifa024"; |HAZ CamposDef; n024 = enCamposDef;
     eaNomDef = "agifa019"; |HAZ CamposDef; n019 = enCamposDef;
     eaNomDef = "agifa112"; |HAZ CamposDef; n112 = enCamposDef;
     eaNomDef = "agifa025"; |HAZ CamposDef; n025 = enCamposDef;
     eaNomDef = "agifa010"; |HAZ CamposDef; n010 = enCamposDef;
     eaNomDef = "agifa071"; |HAZ CamposDef; n071 = enCamposDef;
     eaNomDef = "agifa084"; |HAZ CamposDef; n084 = enCamposDef;
     eaNomDef = "agifa069"; |HAZ CamposDef; n069 = enCamposDef;
     eaNomDef = "agifa501"; |HAZ CamposDef; n501 = enCamposDef;
     eaNomDef = "agifa502"; |HAZ CamposDef; n502 = enCamposDef;
     eaNomDef = "agifa513"; |HAZ CamposDef; n513 = enCamposDef;
     eaNomDef = "agifa512"; |HAZ CamposDef; n512 = enCamposDef;
     eaNomDef = "agifa509"; |HAZ CamposDef; n509 = enCamposDef;
     eaNomDef = "agifa065"; |HAZ CamposDef; n065 = enCamposDef;
     eaNomDef = "dsl00001"; |HAZ CamposDef; n001 = enCamposDef;
     eaNomDef = "dsm00005"; |HAZ CamposDef; n905 = enCamposDef;
     eaNomDef = "dsm00006"; |HAZ CamposDef; n906 = enCamposDef;
|FPRC;
==================================================================
|PROCESO Marhuenda;
     aAlfa = ""; |DBIN aAlfa;
     aAlfa = aAlfa + "marhu334.tab";
     |XABRE "E", aAlfa, 0;
     |SI FSalida = 0
          |DBASE aPath;
          aAlfa = aPath + "def/marhu334";
          |CARGA_DEF aAlfa, marhu334@;
          |SI FSalida = 0;
               aAlfa = aPath + "def/marhu335";
               |CARGA_DEF aAlfa, marhu335@;
               |SI FSalida = 0;
                    nSwMarhu = 1;
               |SINO;
                    aAlfa = "0000Error al cargar " + aAlfa;
                    |MENAV aAlfa;
               |FINSI;
          |SINO;
               aAlfa = "0000Error al cargar " + aAlfa;
               |MENAV aAlfa;
          |FINSI;

     |FINSI;
|FPRC;

|PROCESO inicio;|TIPO 3;
     fFecha = ~;
     #0#4 = fFecha;

     |HAZ BusCampos;
     |SI err ! 0;
          |MENAV "0000Proceso Anulado...";
          |ACABA;
     |FINSI;

     |ABRE #50;
     |LEE 000#50p;
     |CIERRA #50;
     path = #50#2; |QBF path;
     |DFICE dirfich; |QBF dirfich;      ||Directorio de la empresa
     empresa = dirfich % -205;

     |SI path = "";
          |MENAV mensaje2;
          |ACABA;
     |FINSI;

     |ABRE #100;
     #100#0 = "E";
     #100#1 = fFecha;
     #100#2 = 0;
     |LEE 000#100];
     |SI FSalida = 0; |Y #100#0 = "E"; |Y #100#1 = fFecha;
          |AVISO;
          aAlfa = "0000NSe genero una exportacion hoy " + fFecha  + ". Crear otra S/N ";
          |CONFI aAlfa;
          |SI FSalida ! 0; |ACABA; |FINSI;
     |FINSI;
     |CIERRA #100;

     |HAZ Marhuenda;
     |HAZ CargaDef;
     |SI swErr ! 0;
          aMensa = "0000Error al cargar:" + aDef;
          |MENAV aMensa;
          |HAZ DesCargaDef;
          |ACABA;
     |FINSI;


     ||Clientes
     |SI #0#5="S";    || Si he decidido pasar clientes
          |PINTA 2124,blanco;
          |PINTA 2124,"Clientes";

          |PATH_DAT #1 path;   || Informo del camino del fichero de clientes

          |DELINDEX #1;        || Borro los del anterior pase y creo de nuevo

          |ABRE #11;
          |SI FSalida=0;      ||Clientes
               |ABRE #1;
               |BUCLE 0;
               |LIBERA #1;
               |CIERRA #1;

          |FINSI;
          |LIBERA #11;
          |CIERRA #11;
     |FINSI;


     ||Articulo
     |SI #0#6="S";     ||  Si he decidido pasar articulos
          |PINTA 2124,blanco;
          |PINTA 2124,"Articulos";

          |PATH_DAT #2 path;   || Informo del camino del fichero de articulos
          |DELINDEX #2;
          |ABRE #12;
          |SI FSalida=0;
               |ABRE #2;
               |BUCLE 1;
               |LIBERA #2;
               |CIERRA #2;
          |FINSI;
          |LIBERA #12;
          |CIERRA #12;
     |FINSI;

     ||Proveedores
     |SI #0#7="S";         || Si he decidido pasar proveedores
          |PINTA 2124,blanco;
          |PINTA 2124,"Proveedores";

          |PATH_DAT #3 path;   || Informo del camino del fichero de proveedores
          |DELINDEX #3;
          |ABRE #13;
          |SI FSalida=0;
               |ABRE #3;
               |BUCLE 2;
               |LIBERA #3;
               |CIERRA #3;
          |FINSI;
          |LIBERA #13;
          |CIERRA #13;
     |FINSI;


     ||Comisionistas
     |SI #0#8="S";      || Si he decidido pasar comisionistas
          |PINTA 2124,blanco;
          |PINTA 2124,"Comisionistas";

          |PATH_DAT #4 path;   || Informo del camino del fichero de comisionistas
          |DELINDEX #4;
          |ABRE #14;
          |SI FSalida=0;
               |ABRE #4;
               |BUCLE 3;
               |LIBERA #4;
               |CIERRA #4;
          |FINSI;
          |LIBERA #14;
          |CIERRA #14;
     |FINSI;

     ||Historico
     |SI #0#17="S";
          |PINTA 2124,blanco;
          |PINTA 2124,"Historico    ";

          |PATH_DAT #23 path;
          |PATH_DAT #806 path;
          |DELINDEX #23;
          |DELINDEX #806;

          |ABRE #23; |ABRE #806;
          |BUCLE 33;
          |CIERRA #23; |CIERRA #806;
     |FINSI;

     |PATH_DAT #805 path;
     |DELINDEX #805;

     ||Albaranes
     |SI #0#9="S";
          |PINTA 2124,blanco;
          |PINTA 2124,"Albaranes";

          |PATH_DAT #5 path;
          |PATH_DAT #6 path;
          |DELINDEX #5;
          |DELINDEX #6;
          |ABRE #5;
          |ABRE #6;
          |ABRE #805;
          |BUCLE 4;
          |CIERRA #5;
          |CIERRA #6;
          |CIERRA #805;
     |FINSI;


     ||Facturas de Contado
     |SI #0#10="S";
          |PINTA 2124,blanco;
          |PINTA 2124,"Facturas Contado";

          |PATH_DAT #7 path;
          |PATH_DAT #8 path;
          |DELINDEX #7;
          |DELINDEX #8;

          |ABRE #7;
          |ABRE #8;
          |ABRE #805;
          |BUCLE 5;
          |CIERRA #8;
          |CIERRA #7;
          |CIERRA #805;
     |FINSI;


     || Tiquets
     |SI #0#11="S";       || Si he decidido pasar tiquets
          |PINTA 2124,blanco;
          |PINTA 2124,"Tiquets          ";

          |PATH_DAT #9  path;   || Informo del camino del fichero tpv cabeceras
          |PATH_DAT #10 path;   || Informo del camino del fichero de LINEAS
          |DELINDEX #9;
          |DELINDEX #10;
          |ABRE #19;          || Tiquet (cab.)
          |ABRE #20;          || tiquet (lin.)
          |SI FSalida=0;
               |ABRE #9;      || Abro tiquet cab. pase
               |ABRE #10;     || Abro tiquet lin. pase
               tipo= "T";     || Tipo de documento (tiquet)
               |BUCLE 6;      || Paso por el bucle con tipo de documento "T"
               |LIBERA #10;
               tipo =" ";     || Tipo de documento (blanco)
               |BUCLE 6;      || Paso por el bucle con tipo de documento "T"
               |LIBERA #10;

               |CIERRA #10;
               |LIBERA #9;
               |CIERRA #9;


          |FINSI;
          |LIBERA #20;
          |CIERRA #20;
          |LIBERA #19;
          |CIERRA #19;
     |FINSI;


     || Cobros
     |SI #0#12="S";       || Si he decidido pasar Cobros
          |PINTA 2124,blanco;
          |PINTA 2124,"Cobros           ";

          |PATH_DAT #21  path;   || Informo del camino del fichero tpv cabeceras
          |DELINDEX #21;
          |INDEXA #21;
          |ABRE #31;          || Tiquet (cab.)
          |SI FSalida=0;
               |ABRE #21;      || AbrO COBRO pase
               |BUCLE 7;
               |LIBERA #21;
               |CIERRA #21;
          |FINSI;
          |LIBERA #31;
          |CIERRA #31;
     |FINSI;

     || Pagos
     |SI #0#13="S";
          |PINTA 2124,blanco;
          |PINTA 2124,"Pagos            ";

          |PATH_DAT #22  path;   || Informo del camino de pagos
          |DELINDEX #22;
          |ABRE #32;          || Pagos original
          |SI FSalida=0;
               |ABRE #22;      || AbrO pago pase
               |BUCLE 8;
               |LIBERA #22;
               |CIERRA #22;
          |FINSI;
          |LIBERA #32;
          |CIERRA #32;
     |FINSI;

     ||Cod.Barras
     |SI #0#18="S";
          |PINTA 2124,blanco;
          |PINTA 2124,"Cod.Barras";
          |PATH_DAT #55 path;
          |DELINDEX #55;
          |ABRE #55;
          |BUCLE CodBarra;
          |CIERRA #55;
     |FINSI;


     |SI nSwMarhu = 1;
          |PINTA 2124,blanco;
          |PINTA 2124,"Ped.Reposicion";
          |PATH_DAT #334 path;
          |PATH_DAT #335 path;
          |DELINDEX #334;
          |DELINDEX #335;
          |ABRE #334;
          |ABRE #335;
          |BUCLE marhu334;
          |CIERRA #334;
          |CIERRA #335;
     |FINSI;

     |PATH_DAT #51 path;
     |ABRE #51;
     |CIERRA #51;
     |DELINDEX #51;
     |ABRE #51;
     |DDEFECTO #51;
     #51#0 = empresa;
     |PATH_DAT #52 dirfich;
     |ABRE #52;
     #52#0 = #51#0;
     |LEE 001#52=;
     |CIERRA #52;
     #51#1 = #52#1;      ||Nombre de la empresa
     |HORA hora;
     horat = hora % 102 + hora % 402;
     #51#3 = horat;
     #51#4 = "N";
     #51#5 = "00.00.0000";
     |GRABA 021#51n;
     |LIBERA #51;
     |CIERRA #51;

     |HAZ resumen1;

     |SI nSwMarhu = 1;
          |DESCARGA_DEF #marhu334@;
          |DESCARGA_DEF #marhu335@;
     |FINSI;

     |HAZ DesCargaDef;

     |SI sw_pasada = 1;
          |HAZ Comprime;
          |SI #0#19 = "S";        || SI quiere envio Por Correo.
               qFichero = path + aTar;
               |CONFI "0000SEnviar Exportacion a Central ahora: ";
               |SI FSalida = 0;
                   |MENAV "0000Atencion!! Debe estar conectado a internet";
                   |SUB_EJECUTA "dsm00205.tab;moddel";
               |FINSI;
          |FINSI;
     |SINO;
          |MENAV "0000No hay nada nuevo para exportar!!";
     |FINSI;

|FPRC;

|PROGRAMA;
     aParam = PARAMETRO; |QBF aParam;

     |ABRE #0
     |LEE 101#0p;
     |SI FSalida ! 0; |GRABA 020#0b; |FINSI;

     |SI aParam ! "";   || del agifa518
          |HAZ inicio;
     |SINO;
          |CLS;
          |CABEZA "Exportacion";
          |PINPA #0#0;
          |PINDA #0#0;
          |ENDATOS #1#0;
          |SI FSalida = 0;
               |GRABA 020#0a;
          |FINSI;
     |FINSI;

     |CIERRA #0;
|FPRO;

|PROCESO CargaDef;
     |DBASE aPath;

     aDef1 = aPath + "def/" + "agifa024";
     aDef  = aDef1;
     |CARGA_DEF aDef, expor024@;
     |SI FSalida ! 0;
          swErr = 1;
          aDef1 = "";
          |ACABA;
     |FINSI;
     aDef2 = aPath + "def/" + "agifa019";
     aDef  = aDef2;
     |CARGA_DEF aDef, expor019@;
     |SI FSalida ! 0;
          swErr = 1;
          aDef2 = "";
          |ACABA;
     |FINSI;
     aDef3 = aPath + "def/" + "agifa112";
     aDef  = aDef3;
     |CARGA_DEF aDef, expor112@;
     |SI FSalida ! 0;
          swErr = 1;
          aDef3 = "";
          |ACABA;
     |FINSI;
     aDef4 = aPath + "def/" + "agifa025";
     aDef  = aDef4;
     |CARGA_DEF aDef, expor025@;
     |SI FSalida ! 0;
          swErr = 1;
          aDef4 = "";
          |ACABA;
     |FINSI;
     aDef5 = aPath + "def/" + "agifa065";
     aDef  = aDef5;
     |CARGA_DEF aDef, expor065@;
     |SI FSalida ! 0;
          swErr = 1;
          aDef5 = "";
          |ACABA;
     |FINSI;
     aDef6 = aPath + "def/" + "dsl00001";
     aDef  = aDef6;
     |CARGA_DEF aDef, expor001@;
     |SI FSalida ! 0;
          swErr = 1;
          aDef6 = "";
          |ACABA;
     |FINSI;
     aDef7 = aPath + "def/" + "agifa010";
     aDef  = aDef7;
     |CARGA_DEF aDef, expor010@;
     |SI FSalida ! 0;
          swErr = 1;
          aDef7 = "";
          |ACABA;
     |FINSI;
     aDef8 = aPath + "def/" + "dsm00006";
     aDef  = aDef8;
     |CARGA_DEF aDef, expord06@;
     |SI FSalida ! 0;
          swErr = 1;
          aDef8 = "";
          |ACABA;
     |FINSI;
     aDef9 = aPath + "def/" + "agifa071";
     aDef  = aDef9;
     |CARGA_DEF aDef, expor071@;
     |SI FSalida ! 0;
          swErr = 1;
          aDef9 = "";
          |ACABA;
     |FINSI;
     aDef10 = aPath + "def/" + "agifa084";
     aDef  = aDef10;
     |CARGA_DEF aDef, expor084@;
     |SI FSalida ! 0;
          swErr = 1;
          aDef10 = "";
          |ACABA;
     |FINSI;
     aDef11 = aPath + "def/" + "agifa069";
     aDef  = aDef11;
     |CARGA_DEF aDef, expor069@;
     |SI FSalida ! 0;
          swErr = 1;
          aDef11 = "";
          |ACABA;
     |FINSI;
     aDef12 = aPath + "def/" + "agifa501";
     aDef  = aDef12;
     |CARGA_DEF aDef, expor501@;
     |SI FSalida ! 0;
          swErr = 1;
          aDef12 = "";
          |ACABA;
     |FINSI;
     aDef13 = aPath + "def/" + "agifa502";
     aDef  = aDef13;
     |CARGA_DEF aDef, expor502@;
     |SI FSalida ! 0;
          swErr = 1;
          aDef13 = "";
          |ACABA;
     |FINSI;
     aDef14 = aPath + "def/" + "agifa513";
     aDef  = aDef14;
     |CARGA_DEF aDef, expor513@;
     |SI FSalida ! 0;
          swErr = 1;
          aDef14 = "";
          |ACABA;
     |FINSI;
     aDef15 = aPath + "def/" + "agifa512";
     aDef  = aDef15;
     |CARGA_DEF aDef, expor512@;
     |SI FSalida ! 0;
          swErr = 1;
          aDef15 = "";
          |ACABA;
     |FINSI;
     aDef16 = aPath + "def/" + "agifa509";
     aDef  = aDef16;
     |CARGA_DEF aDef, expor509@;
     |SI FSalida ! 0;
          swErr = 1;
          aDef16 = "";
          |ACABA;
     |FINSI;
     aDef17 = aPath + "def/" + "dsm00005";
     aDef  = aDef17;
     |CARGA_DEF aDef, expord05@;
     |SI FSalida ! 0;
          swErr = 1;
          aDef17 = "";
          |ACABA;
     |FINSI;

     |SI nSwMarhu = 1;
          aDef18 = aPath + "def/" + "marhu334";
          aDef  = aDef18;
          |CARGA_DEF aDef, expor334@;
          |SI FSalida ! 0;
               swErr = 1;
               aDef18 = "";
               |ACABA;
          |FINSI;
          aDef19 = aPath + "def/" + "marhu335";
          aDef  = aDef19;
          |CARGA_DEF aDef, expor335@;
          |SI FSalida ! 0;
               swErr = 1;
               aDef19 = "";
               |ACABA;
          |FINSI;
     |FINSI;
     |HAZ NomeDat;

|FPRC;

|PROCESO DesCargaDef;
     |SI nSwMarhu = 1;
          |SI aDef19 ! ""; |DESCARGA_DEF #expor335@; |FINSI;
          |SI aDef18 ! ""; |DESCARGA_DEF #expor334@; |FINSI;
     |FINSI;
     |SI aDef17 ! ""; |DESCARGA_DEF #expord05@; |FINSI;
     |SI aDef16 ! ""; |DESCARGA_DEF #expor509@; |FINSI;
     |SI aDef15 ! ""; |DESCARGA_DEF #expor512@; |FINSI;
     |SI aDef14 ! ""; |DESCARGA_DEF #expor513@; |FINSI;
     |SI aDef13 ! ""; |DESCARGA_DEF #expor502@; |FINSI;
     |SI aDef12 ! ""; |DESCARGA_DEF #expor501@; |FINSI;
     |SI aDef11 ! ""; |DESCARGA_DEF #expor069@; |FINSI;
     |SI aDef10 ! ""; |DESCARGA_DEF #expor084@; |FINSI;
     |SI aDef9  ! ""; |DESCARGA_DEF #expor071@; |FINSI;
     |SI aDef8  ! ""; |DESCARGA_DEF #expord06@; |FINSI;
     |SI aDef7  ! ""; |DESCARGA_DEF #expor010@; |FINSI;
     |SI aDef6  ! ""; |DESCARGA_DEF #expor001@; |FINSI;
     |SI aDef5  ! ""; |DESCARGA_DEF #expor065@; |FINSI;
     |SI aDef4  ! ""; |DESCARGA_DEF #expor025@; |FINSI;
     |SI aDef3  ! ""; |DESCARGA_DEF #expor112@; |FINSI;
     |SI aDef2  ! ""; |DESCARGA_DEF #expor019@; |FINSI;
     |SI aDef1  ! ""; |DESCARGA_DEF #expor024@; |FINSI;
|FPRC;

|PROCESO NomeDat;
     |SI nSwMarhu = 1;
          |NOME_DAT #335 "expor335";     ||   19
          |NOME_DAT #334 "expor334";     ||   18
     |FINSI;
     |NOME_DAT #805 "expord05";     ||   17
     |NOME_DAT #53  "expor509";     ||   16
     |NOME_DAT #22  "expor512";     ||   15
     |NOME_DAT #21  "expor513";     ||   14
     |NOME_DAT #10  "expor502";     ||   13
     |NOME_DAT #9   "expor501";     ||   12
     |NOME_DAT #8   "expor069";     ||   11
     |NOME_DAT #7   "expor084";     ||   10
     |NOME_DAT #6   "expor071";     ||   9
     |NOME_DAT #806 "expord06";     ||   8
     |NOME_DAT #5   "expor010";     ||   7
     |NOME_DAT #55  "expor001";     ||   6
     |NOME_DAT #23  "expor065";     ||   5
     |NOME_DAT #4   "expor025";     ||   4
     |NOME_DAT #3   "expor112";     ||   3
     |NOME_DAT #2   "expor019";     ||   2
     |NOME_DAT #1   "expor024";     ||   1
|FPRC;
