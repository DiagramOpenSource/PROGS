|FICHEROS;
     con00622 #0;
     con00670 #1;
     agifa027 #2;
     con00623 #3;
     con00671 #5;

     agifa134 #20;
     agifa059 #21;
     agifa024 #24;
     agifa091 #50;
     dsz99984 #51;
     agifa133 #52;
     agis0002 #53;
     agifa177 #54;
     agifa142 #55;
|FIN;

|VARIABLES;
     nConta = 0;
     &enTiva = 0;
     &efFiva = @;
     &eaDiva = "";
     &enIva = 0;
     &enRec = 0;
     &aMoneda = "";
     &aDivisa = "";
     &EURODB = 0;
|FIN;


|PROGRAMA;
|HAZ TallerDeci;
|CLS;
|PINPA #0#0;
|PINDA #0#0;
|ENDATOS #1#0;
|SI FSalida = 0; |Y #0#17 = "S";
     ||\\ crear factura de la venta
     |ABRE #3;
     |DDEFECTO #3;
     #3#0 = #0#13;
     #3#1 = #0#14;
     #3#2 = #0#15;
     #3#3 = #0#16;
     #3#4 = #0#19;
     #3#5 = #0#0;
     #3#6 = #0#7;
     #3#7 = #0#8;
     #3#8 = #0#10;
     #3#9 = #0#11;
     #3#10 = #0#12;
     #3#11 = #0#6;
     #3#14 = #0#18;
     |GRABA 021#3n;
     |LIBERA #3;
     |CIERRA #3;

     |ABRE #20;   |ABRE #21;
     |HAZ CreaFactVenta;
     |CIERRA #20; |CIERRA #21;
     ||\\ guardar factura en vehiculos
     |ABRE #1;
     #1#0 = #0#0;
     #1#22 = #0#18;
     |LEE 121#1=;
     |SI FSalida = 0;
          #1#31 = #0#13;
          #1#32 = #0#14;
          |GRABA 020#1a;
     |FINSI;
     |CIERRA #1;
|FINSI;
|FPRO;

|PROCESO entra;
     |SI #1#32 ! 0;
          |MENAV "0000Vehiculo ya facturado";
          |ERROR;
     |SINO;
          |ABRE #1;
          #1#0  = #0#0;
          #1#22 = #0#18;
          |LEE 020#1=;
          |CIERRA #1;

          |ABRE #5;
          #5#0 = #0#0;
          #5#3 = #0#18;
          |LEE 000#5=;
          |CIERRA #5;

          #0#1 = #1#23;
          #0#2 = #1#27;
          #0#3 = (#0#1 % #0#2) !EURODB;
          #0#4 = #0#1 + #0#3;
          #0#5 = #1#33;
          #0#9 = #1#33;
          #0#16 = #5#2;
          |PINDA #0#0;
     |FINSI;
|FPRC;

|PROCESO venta;
     |SI #0#5 = "G";
          |SI #0#10 = 0;
               #0#7 = #0#6;
               #0#8 = 0;
               #0#12 = 0;
          |SINO;
               #0#7 = 0;
               #0#8 = (#0#6 / (1+(#0#11/100))) !EURODB;
               #0#12 = #0#6 - #0#8;
          |FINSI;
     |SINO;
          #0#7 = #0#1;
          |SI #0#6 > #0#1; |Y #0#10 ! 0;
               #0#8 = ((#0#6 - #0#7) /(1 + (#0#11/100))) !EURODB;
               #0#12 = #0#6 - (#0#7+#0#8);
          |FINSI;
     |FINSI;
     |PINTA #0#8;
     |PINTA #0#12;
     |PINTA #0#7;
|FPRC;

|PROCESO factura;
     |ABRE #55; |LEE 000#55p; |CIERRA #55;
|FPRC;

|PROCESO Conta7; |TIPO 7;
     |ABRE #20;
     #20#49 = #0#13;
     |HAZ ContaFV7;
     #0#14 = #20#0; |PINTA #0#14;
     |CIERRA #20;
|FPRC;

|PROCESO Conta0; |TIPO 0;
     |ABRE #20;
     #20#49 = #0#13;
     #20#0 = #0#14;
     |HAZ ContaFV0;
     |CIERRA #20;
|FPRC;

|PROCESO CreaFactVenta;
     aMoneda = "B"
     aDivisa = "EUR";
     |HAZ Divisas134;
     |ABRE #20;
     |ABRE #21;
     |ABRE #agifa024;

     #agifa024#0 = #3#3;
     |LEE 000#agifa024.=;
     |SI FSalida ! 0; |DDEFECTO #agifa024; |FINSI;

     |DDEFECTO #20;
     #20#0 = #3#1;
     #20#1 = #3#2;
     #20#2 = #3#3;
     #20#3 = #3#4;
     #20#12 = #agifa024#16;
     #20#49 = #3#0;

     #20#47 = #3#6; ||Exenta;

     #20#18 = #3#7 + #3#6; ||Bruto
     #20#65 = #20#18;
     #20#88 = #20#18;

     #20#21 = #3#7; ||Base1
     #20#68 = #20#21;
     #20#91 = #20#21;

     #20#22 = #3#10;||Cuota1
     #20#69 = #20#22;
     #20#92 = #20#22;

     #20#29 = #3#10; ||T.IVA
     #20#76 = #20#29;
     #20#99 = #20#29;

     #20#31 = #3#11; ||T.Fac
     #20#78 = #20#31;
     #20#101 = #20#31;

     #20#39 = #3#9;  ||%iva1

     #20#58 = "EUR";
     #20#59 = 1;
     #20#60 = "B";
     #20#61 = "EUR";
     #20#62 = 1;

     |GRABA 001#20c;
     |LIBERA #20;
     |HAZ VenciVta; |HAZ CreaRecibos;
     |CIERRA #20;
     #21#0 = #3#1;
     #21#1 = 1;
     #21#14 = #3#0;
     |GRABA 001#21n;
     |LIBERA #21;
     |CIERRA #21;
     |CIERRA #agifa024;
|FPRC;

|VARIABLES;
   &eaProg = "";
   &enAcuenta = 0;

   nVto = 0;
|FIN;

|PROCESO CreaRecibos;
     |ABRE #agifa133;
     |ABRE #agis0002;
     |ABRE #agifa177;
     |ABRE #agifa091;
     |ABRE #agifa142;

     |LEE 000#agifa142.p;
     |SI FSalida ! 0; |DDEFECTO #agifa142; |FINSI;

     #agifa024#0 = #agifa134#2;
     |LEE 000#agifa024.=;
     |SI FSalida ! 0; |DDEFECTO #agifa024; |FINSI;

     #agifa091#0 = #agifa134#11;
     |LEE 000#agifa091.=;
     |SI FSalida ! 0; |DDEFECTO #agifa091; |FINSI;

     nVto = 0;
     #agifa133#0 = #agifa134#0;
     #agifa133#4 = #agifa134#49;
     #agifa133#1 = 0;
     |LEE 000#agifa133.];
     |PARA ; |SI FSalida = 0; |Y #agifa133#0 = #agifa134#0;|Y #agifa133#4 = #agifa134#49; |HACIENDO;
          nVto = nVto + 1;
          |LEE 000#agifa133.s;
     |SIGUE;

     |HAZ AbreRecVenta;

     #agifa133#0 = #agifa134#0;
     #agifa133#4 = #agifa134#49;
     #agifa133#1 = 0;
     |LEE 000#agifa133.];
     |PARA ; |SI FSalida = 0; |Y #agifa133#0 = #agifa134#0;|Y #agifa133#4 = #agifa134#49; |HACIENDO;
          |SI #agifa133#5 = "S";
               |DDEFECTO #agis0002;
               #agis0002#30 = "A";       || busca como albaran
               #agis0002#20 = #agifa133#6;     || Serie pedido.
               #agis0002#17 = #agifa133#7;     || Numero pedido.
               #agis0002#18 = #agifa133#8;     || Numero recibo.
               |LEE 000#agis0002.=;
               |SI FSalida ! 0;
                    #agis0002#30 = "P";       || busca como pedido
                    |LEE 000#agis0002.=;
               |FINSI;
          |FINSI;
          |DDEFECTO #dsz99984;
          #dsz99984#17 = #agifa134#49;
          #dsz99984#0 = #agifa134#0;
          #dsz99984#1 = #agifa133#1;           || Linea;
          #dsz99984#2 = #agifa134#2;           || cliente
          #dsz99984#3 = #agifa134#3;           || nombre del cliente
          #dsz99984#4 = #agifa134#9;           || Banco
          #dsz99984#5 = "S";                   || domiciliado
          #dsz99984#6 = "N";                   || aceptado
          #dsz99984#7 = #agifa134#1;           || fecha de emision
          #dsz99984#8 = #agifa133#3;           || Fecha de vencimiento
          #dsz99984#9 = #agifa133#2;           || Importe
          |SI #agifa133#5 = "S";
               #dsz99984#10 = #agis0002#10;
               #dsz99984#11 = #agis0002#11;
          |SINO;
               #dsz99984#10 = "N";            || Impreso
               #dsz99984#11 = "N";            || Contabilizado
          |FINSI;
          |SI #agifa142#63 = "S";     ||  COGE LA CTA.CONTABLE DEL TIPO DE RECIBO.
               #agifa177#0 = #agifa091#69;
               |LEE 000#agifa177.=;
               |SI FSalida = 0;
                    #dsz99984#12 = #agifa177#3;     || NUMERO CTA.CONTABLE.
               |SINO;
                    #dsz99984#12 = #agifa134#12;     || NUMERO CTA.CONTABLE.
               |FINSI;
          |SINO;
               #dsz99984#12 = #agifa134#12;     || NUMERO CTA.CONTABLE.
          |FINSI;
          #dsz99984#13 = #agis0002#13;
          #dsz99984#16 = #agis0002#16;
          #dsz99984#22 = "Cobrado";
          #dsz99984#24 = #agifa134#11;          || Forma de Pago
          #dsz99984#25 = #agifa091#1;           || Descripcion de la forma de Pago
          #dsz99984#14 = "N";            || Impagado
          #dsz99984#15 = #agifa024#161;         || A aceptar
          |SI #agifa133#5 = "S";
               #dsz99984#21 = #agis0002#22;         || Tipo de Recibo (entr.a cta.)
          |SINO;
               #dsz99984#21 = #agifa091#69;          || Tipo de Recibo (forma de pago)
          |FINSI;
          #dsz99984#23 = nVto;
          #dsz99984#24 = #agifa091#0;
          #dsz99984#25 = #agifa091#1;
          eaProg = "agifa134";
          |HAZ RecVenta;
          |LEE 000#agifa133.s;
     |SIGUE;
     |HAZ CierraRecVenta;

     #agifa133#0 = #agifa134#0;
     #agifa133#4 = #agifa134#49;
     #agifa133#1 = 0;
     |LEE 101#agifa133.];
     |PARA ; |SI FSalida = 0; |Y #agifa133#0 = #agifa134#0;|Y #agifa133#4 = #agifa134#49; |HACIENDO;
          #dsz99984#17 = #agifa133#4;
          #dsz99984#0 = #agifa133#0;
          #dsz99984#1 = #agifa133#1;
          eaProg = "agifa134";
          |HAZ LeeRecVenta;
          #agifa134#32 = #agifa134#32 + enAcuenta;
          #agifa133#2 = #agifa133#2 - enAcuenta;
          |GRABA 020#agifa133.a;
          |LIBERA #agifa133;
          |LEE 101#agifa133.s;
     |SIGUE;
     |LIBERA #agifa133;

     |CIERRA #agifa091;
     |CIERRA #dsz99984;
     |CIERRA #agifa133;
     |CIERRA #agis0002;
     |CIERRA #agifa177;
|FPRC;

|PROCESO IVA622_66; |TIPO 66;
     enTiva = #0Campo;
     efFiva = #0#15;
     |HAZ ConsuIVA;
     |SI eaDiva = "";
          |ERROR;
     |SINO;
          #0Campo = enTiva; |PINTA #0Campo;
          #0#11 = enIva; |PINTA #0#11;
     |FINSI;
|FPRC;

|PROCESO IVA622_0; |TIPO 0;
     enTiva = #0Campo;
     efFiva = #0#15;
     |HAZ SacaIVA;
     |SI eaDiva = "";
          |MENAV "0000No existe tipo iva para esta fecha...";
          |ERROR; |ACABA;
     |SINO;
          #0#11 = enIva; |PINTA #0#11;
          |HAZ venta;
     |FINSI;
|FPRC;
