|FICHEROS;
     evarm029 #0;
     evarm030 #30;
|FIN;

|VARIABLES;
     nBotonImg = -1;
     {1}aLocal = "";
     aLon = "";
     aOrg = "";
     aDes = "";
     aNom = "";
     aCar = "";
     i = 0;
     nPos = 0;
     {1}aContiene = "";
     aMd5Org = "";
     aMd5Des = "";
     aIPRemoto = "";
|FIN;

|PROCESO T9; |TIPO 9;
     |SI nBotonImg ! -1;
          |FIN_CONTROL_WINDOWS nBotonImg;
     |FINSI;
|FPRC;

|PROCESO T0; |TIPO 0;
     |HAZ T13;
|FPRC;

|PROCESO SacaNombre;
     aLon = aOrg % A0;
     aNom = "";
     |PARA i = 1; |SI i [ aLon; |HACIENDO i = i + 1;
          nPos = -(i * 100 + 1)
          aCar = aOrg % nPos;
          |SI aCar = "\"; |O aCar = "/"; |SAL; |FINSI;
          aNom = aCar + aNom;
     |SIGUE;
|FPRC;

|PROCESO T13; |TIPO 13;
     |SI nBotonImg ! -1;
          |FIN_CONTROL_WINDOWS nBotonImg;
     |FINSI;
     |ABRE #30; |LEE 000#30p; |CIERRA #30;
     aOrg = #30#1; |QBF aOrg;
     aOrg = aOrg + #0#1; |QBF aOrg;
     |HAZ SacaNombre;
     |ESPECIFICA "RBASS", aLocal;
     aDes = aLocal;
     aDes = aDes + "img/";
     |RMKDIR aDes;
     aDes = aDes + aNom;
     |HAZ TraeImg;
     |SI aNom = "";
          aDes = "BOTON,Sin imagen";
     |SINO;
          aDes = "IMAGEN," + aDes;
     |FINSI;
     |CONTROL_SIMPLE 0, aDes, 1128, 2255, NULL;
     nBotonImg = FSalida;
|FPRC;

|PROCESO TraeImg;
     aContiene1 = aDes;
     |ESPECIFICA "REMOTOMD5", aContiene;
     aMd5Des = FSalida;

     aContiene1 = aOrg;
     |ESPECIFICA "MD5", aContiene;
     aMd5Org = FSalida;

     |QBF aMd5Des;
     |QBF aMd5Org;

     |SI aMd5Des ! aMd5Org; |O aMd5Des = "";
          aIPRemoto = "";
          |IP_REMOTO aIPRemoto;
          |QBT aIPRemoto;

          |SI aIPRemoto ! "";
               |ENVIA_FICHERO aOrg, aDes;
          |SINO;
               |COPIA_FICHERO aOrg, aDes;
          |FINSI;
     |FINSI;
|FPRC;
