|FICHEROS;
     vilaz001 #0;
     vilaz002 #2,MANTE;
     vilam006 #6;
     agifa079 #79;
     agifa079@;
     vilaz002@;
|FIN;

|VARIABLES;
     &Tempo = "";
     nForma = 0;
     nLinea = 0;
     aAlfa = "";
     aTmp = "";
     aTmp2 = "";
     aDNom = "";
     aHNom = "";
     aPath = "";
|FIN;

|PROCESO Tipo2; |TIPO 2;
     nForma = 0 +. 1;
     |SI #2#5 = "N";
          |SI nForma = -1;
               |MENAV "0000La linea no se puede modificar...";
          |FINSI;
          |ERROR; |ACABA;
     |FINSI;

     |ABRE #agifa079@;
     |ABRE #79;
     |SI nForma = 1;
          #agifa079@#66 = #2#1;
          #agifa079@#0 = #2#2;
          |BORRA 020#agifa079@.c;
     |SINO;
          #79#66 = #2#1;
          #79#0 = #2#2;
          |LEE 000#79=;
          |SI FSalida = 0;
               |SALVA_DATOS #79;
               |REPON_DATOS #agifa079@;
               |GRABA 020#agifa079@.n;
          |FINSI;
     |FINSI;
     |CIERRA #79;
     |CIERRA #agifa079@;
|FPRC;

|PROCESO Factura; |TIPO 0;
     |SI FSalida = 2; |ACABA; |FINSI;
     |ABRE #vilaz002@;
     |SELECT #2#vilaz002@;
     #vilaz002@#1 = #2#1;
     #vilaz002@#2 = #2#2;
     |LEE 000#vilaz002@.=;
     |SI FSalida = 0; |Y #vilaz002@#0 ! #2#0;
          aAlfa = "0000Factura introducida en linea: " + #vilaz002@#0;
          |MENAV aAlfa;
          |ERROR; |ACABA;
     |FINSI;
     |CIERRA #vilaz002@;

     |ABRE #79;
     #79#66 = #2#1;
     #79#0 = #2#2;
     |LEE 000#79=;
     |SI FSalida = 0;

          #2#1 = #79#66; |PINTA #2#1;
          #2#2 = #79#0; |PINTA #2#2;
          #2#3 = #79#31; |PINTA #2#3;
          #2#4 = Usuario % 810; |PINTA #2#4;
     |SINO;
          |MENAV "0000No existe factura...";
          |ERROR;
     |FINSI;
     |CIERRA #79;
|FPRC;

|PROCESO Consulta; |TIPO 66;
     |ABRE #agifa079@;
     #agifa079@#66 = #2#1;
     #agifa079@#0 = #2#2;
     |LEE 000#agifa079@.]
     |CONSULTA_CLAVE #2#agifa079@;
     |SI FSalida = 0;
          #2#1 = #agifa079@#66; |PINTA #2#1;
          #2#2 = #agifa079@#0; |PINTA #2#2;
     |SINO;
          |ERROR;
     |FINSI;
     |CIERRA #agifa079@;
|FPRC;

|PROCESO Descarga;
     |DDEFECTO #6;
     #6#0 = #2#1;
     #6#1 = #2#2;
     #6#2 = #0#0;
     #6#3 = #2#3;
     #6#4 = #2#4;
     |GRABA 020#6n;
|FPRC;

|DEFBUCLE Descarga;
     #2#1;
     5;
     00001, "S";
     99999, "S";
     ;
     NULL, Descarga;
|FIN;

|PROCESO Carga;
     nLinea = nLinea + 1;
     #2#0 = nLinea;
     #2#1 = #6#0;
     #2#2 = #6#1;
     #2#3 = #6#3;
     #2#4 = #6#4;
     #2#5 = "N";
     #2#1 = #6#0;
     |GRABA 020#2n;
|FPRC;

|DEFBUCLE Carga;
     #6#2;
     ;
     #0#0;
     #0#0;
     ;
     NULL, Carga;
|FIN;

|PROCESO Min;
     #2#0 = 00001;
|FPRC;

|PROCESO Max;
     #2#0 = 99999;
|FPRC;

|PROCESO CargaFac;
     #6#0 = #79#66;
     #6#1 = #79#0;
     |LEE 000#6=;
     |SI FSalida ! 0;
          |SALVA_DATOS #79;
          |REPON_DATOS #agifa079@;
          |GRABA 020#agifa079@.n;
     |FINSI;
|FPRC;

|DEFBUCLE CargaFac;
     #79#2;
     ;
     #0#0, aDNom;
     #0#0, aHNom;
     ;
     NULL, CargaFac;
|FIN;

|PROGRAMA;
     |PINPA #0#0;
     |PINDA #0#0;
     |ENTLINEAL #1#2, 1, 7, 22, 0, Min, Max;
     |ENDATOS #2#0;
     |SI FSalida = 0;
          |DDEF aPath;
          aAlfa = aPath + "agifa079";
          |CARGA_DEF aAlfa, agifa079@;
          |SI FSalida ! 0;
               |MENAV "0000Error al cargar 'agifa079'";
               |ACABA;
          |FINSI;
          aAlfa = aPath + "vilaz002";
          |CARGA_DEF aAlfa, vilaz002@;
          |SI FSalida ! 0;
               |MENAV "0000Error al cargar 'vilaz002'";
               |ACABA;
          |FINSI;

          |HAZ CreaTempo; |NOME_DAT #2 Tempo; aTmp2 = Tempo; |DELINDEX #2;
          |HAZ CreaTempo; |NOME_DAT #agifa079@#Tempo#; aTmp = Tempo; |DELINDEX #agifa079@;
          |NOME_DAT #vilaz002@#aTmp2#;

          aDNom = " " * 60;
          aHNom = "z" * 60;
          |ABRE #agifa079@;
          |ABRE #6;
          |BUCLE CargaFac;
          |CIERRA #6;
          |CIERRA #agifa079@;

          |ABRE #2;
          |BUCLE Carga;
          |CIERRA #2;
          |ENTLINEAL #1#2, 1, 1, 22, 0, Min, Max;
          |ABRE #6;
          |BUCLE Descarga;
          |CIERRA #6;
          Tempo = aTmp2; |HAZ BoraTempo; |DELINDEX #2;
          Tempo = aTmp; |HAZ BoraTempo; |DELINDEX #agifa079@;

          |DESCARGA_DEF #vilaz002@;
          |DESCARGA_DEF #agifa079@;
     |FINSI;
|FPRO;
