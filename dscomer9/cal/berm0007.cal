|FICHEROS;
     berm0007 #0;
     berm0006 #60;

     berm0100 #100;
|FIN;

|VARIABLES;
     nPanta = 0;
     nModo = 0;

     aFoto = "";         ||Sirve para distinguir el boton

     nFotoP = -1;
     nFoto1 = 0;
     nFoto2 = 0;
     nFoto3 = 0;
     nFoto4 = 0;

     aLogo = "";
     aOrg = "";
     aDes = "";
     aIP = "";

     ||DSSELECT
     aPathDif = "";
     aRuta = "";
     &enError = 0;
     {1}aLocal = "";
     aDirLocal = "";
     aPathDSSelect = "";
     aAux = "";
     aBorra = "";
     aParaIni = "";
     aCarpetaCaptura = "";
     &eaUnidadBasico = "";
     aTextoIni = "";
     nHandle = 0;
     aEjecuta = "";
     aPrograma = "";
     aAbre = "";
     aPath = "";
     nError = 0;
     aAlfa = "";
     aFichero = "";
     aLong = "";
     nLong = 0;
     nCarac = 0;
     nPos = 0;
     aCarac = "";
     aProg = "";
     &eaDestino = "";
     &eaCarpetaOrigen = "";
     {1}aContiene = "";
     &eaUnidad = "";
|FIN;

|PROCESO Car; |TIPO 0;
     |ABRE #60;
     #60#0 = #0Campo;
     |LEE 000#60=;
     |SI FSalida ! 0;
          |MENAV "0000No existe c¢digo...";
          |ERROR;
     |FINSI;
     |CIERRA #60;
|FPRC;

|PROCESO Tipo7_C2; |TIPO 7;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 1; |O nModo = 2;
          |ESTADO_CONTROL nFotoP, "ENABLE";
          |ESTADO_CONTROL nFoto1, "ENABLE";
          |ESTADO_CONTROL nFoto2, "ENABLE";
          |ESTADO_CONTROL nFoto3, "ENABLE";
          |ESTADO_CONTROL nFoto4, "ENABLE";
     |SINO;
          |ESTADO_CONTROL nFotoP, "DISABLE";
          |ESTADO_CONTROL nFoto1, "DISABLE";
          |ESTADO_CONTROL nFoto2, "DISABLE";
          |ESTADO_CONTROL nFoto3, "DISABLE";
          |ESTADO_CONTROL nFoto4, "DISABLE";
     |FINSI;
|FPRC;

|PROCESO Tipo12; |TIPO 12;
     |ESTADO_CONTROL nFotoP, "DISABLE";
     |ESTADO_CONTROL nFoto1, "DISABLE";
     |ESTADO_CONTROL nFoto2, "DISABLE";
     |ESTADO_CONTROL nFoto3, "DISABLE";
     |ESTADO_CONTROL nFoto4, "DISABLE";
|FPRC;

|PROCESO Foto1;
     aFoto = "1";
     |HAZ ControlImagen;
|FPRC;
|PROCESO Foto2;
     aFoto = "2";
     |HAZ ControlImagen;
|FPRC;
|PROCESO Foto3;
     aFoto = "3";
     |HAZ ControlImagen;
|FPRC;
|PROCESO Foto4;
     aFoto = "4";
     |HAZ ControlImagen;
|FPRC;

|PROCESO FotoP;
     aFoto = "P";
     |HAZ ControlImagen;
|FPRC;

|PROCESO ControlImagen;
     aRuta = "";
     |HAZ Traete_dsselect;
     |SI enError = 1;
         |MENAV "0000No puedo instala el dsselect.exe, consulte con su administrador";
     |FINSI;

     |ESPECIFICA "RBASS", aLocal;
     aDirLocal = aLocal;

     |HAZ DimeUnidad;
     aAux      = eaUnidad + ":\DOCUMENTOS\DSCOMER9\";
     aPrograma = aAux + "dsselect.exe";

     ||ARA. Donde ejecuto el dsselect.exe
     aPathDSSelect = aAux;
     aBorra = aPathDSSelect + "dsselect.txt";
     |RFBORRA aBorra;

     aParaIni = aAux + "dsselect.ini";
     |RFBORRA aParaIni;

     |ABRE #100;
     #100#0 = Usuario % 810;
     |LEE 000#100=;
     |SI FSalida ! 0;
          |DDEFECTO #100;
     |FINSI;
     aCarpetaCaptura = #100#3;
     |QBF aCarpetaCaptura;
     |SI aCarpetaCaptura = "";
          aCarpetaCaptura = eaUnidadBasico;
     |FINSI;

     aTextoIni = &34 + aCarpetaCaptura + &34 + " " + &34 + aBorra + &34;
     |XABRE "CW", aParaIni, nHandle;
     |SI FSalida ] 0;
          |XGRABA nHandle, aTextoIni;
     |FINSI;
     |XCIERRA nHandle;

     aEjecuta = aPrograma;
     |RSYSTEM aEjecuta;

     aAbre = aPathDSSelect + "dsselect.txt";
     |XABRE "CU", aAbre, nHandle;
     |SI FSalida < 0;
        aPath = "";
        nError = 1;
        |ACABA;
     |FINSI;

     |XLEE nHandle, 250, aPath;
     |SI FSalida < 0
         aPath = "";
         nError = 1;
         |ACABA;
     |FINSI;

     |QBF aPath;
     |SI aPath ! "";
         aAlfa    = aPath;
         aFichero = "";
         aLong    = aAlfa % 0;
         nLong    = aLong;
         aRuta    = "";
         |PARA nCarac = 1;  |SI nCarac [ nLong;  |HACIENDO nCarac = nCarac + 1;
               nPos   = (nCarac * 100) + 1;
               aCarac =  aAlfa % nPos;
               |SI aCarac = "/";  |O aCarac = "\";
                   aProg = "";
               |SINO;
                   aProg = aProg + aCarac;
               |FINSI;

               aRuta = aRuta + aCarac;
         |SIGUE;
     |FINSI;
     |XCIERRA nHandle;

     aBorra = aPathDSSelect + "dsselect.txt";
     |RFBORRA aBorra;

     |SI aRuta ! ""; |Y aProg ! "";
          ||Tengo que regrabar el #100 con el nuevo path
          |SI aFoto = "P";
               #0#2 = aProg;
               |PINTA #0#2;
          |FINSI;
          |SI aFoto = "1";
               #0#3 = aProg;
               |PINTA #0#3;
          |FINSI;
          |SI aFoto = "2";
               #0#4 = aProg;
               |PINTA #0#4;
          |FINSI;
          |SI aFoto = "3";
               #0#5 = aProg;
               |PINTA #0#5;
          |FINSI;
          |SI aFoto = "4";
               #0#6 = aProg;
               |PINTA #0#6;
          |FINSI;

          aLogo = aRuta;
          |HAZ CopiaLogo;

          aPathDif = aRuta - aProg;
          |QBF aPathDif;

          |DDEFECTO #100;
          #100#0 = Usuario % 810;
          |LEE 101#100=;
          |SI FSalida ! 0; |GRABA 020#100.b; |FINSI;
          #100#3 = aPathDif;
          |GRABA 020#100.a;
          |LIBERA #100;
     |SINO;
         nError = 1;
         |CIERRA #100;
         |ACABA;
     |FINSI;
     |CIERRA #100;
|FPRC;

|PROCESO CopiaLogo;
     |QBF aLogo;
     |SI aLogo = ""; |ACABA; |FINSI;

     |DBASE aAlfa;
     aAlfa = aAlfa + "logos/cweb/";
     |MKDIR aAlfa;
     aOrg = aLogo;
     aDes = aAlfa + aProg;
     |IP_REMOTO aIP;
     |SI aIP = "";
          |COPIA_FICHERO aOrg, aDes;
     |SINO;
          |RECIBE_FICHERO aOrg, aDes;
     |FINSI;
|FPRC;

|PROCESO Tipo13; |TIPO 13;
     ||Poner los botones;
     |SI nFotoP = -1;
          |PINPA #0#0; nPanta = FSalida;

          |CONTROL_SIMPLE nPanta, "BOTON,...", 1255, 1258, FotoP;
          nFotoP = FSalida;
          |CONTROL_SIMPLE nPanta, "BOTON,...", 1455, 1458, Foto1;
          nFoto1 = FSalida;
          |CONTROL_SIMPLE nPanta, "BOTON,...", 1555, 1558, Foto2;
          nFoto2 = FSalida;
          |CONTROL_SIMPLE nPanta, "BOTON,...", 1655, 1658, Foto3;
          nFoto3 = FSalida;
          |CONTROL_SIMPLE nPanta, "BOTON,...", 1755, 1758, Foto4;
          nFoto4 = FSalida;

          |ESTADO_CONTROL nFotoP, "DISABLE";
          |ESTADO_CONTROL nFoto1, "DISABLE";
          |ESTADO_CONTROL nFoto2, "DISABLE";
          |ESTADO_CONTROL nFoto3, "DISABLE";
          |ESTADO_CONTROL nFoto4, "DISABLE";
     |FINSI;
|FPRC;
