|FICHEROS;
     diapre05  #0;
     agifa024  #24;

     ma000001@ #100;
     ma000022@ #101;
     ma001022@ #102;
     ma000023@ #103;
     ma000024@ #105;
     ma000026@ #106;

     ma000501@ #501;
     ma000502@ #502;
     ma000503@ #503;

     :/dsp/def/dspm0000 #200;
     :/dspartes/def/dsparm05;
|FIN;

|VARIABLES;
     fFecha = @;

     aAlfa     = "";
     aAlfa1    = "";
     aAlfa2    = "";
     aAlfa3    = "";
     aAlfa4    = "";
     aAlfa5    = "";
     aAlfa6    = "";
     aAlfa7    = "";
     aSoft     = "";
     aHard     = "";
     aBase     = "";
     aAbre     = "";

     nHandle   = 0;
     nCalc     = 0;
|FIN;

|PROCESO ma001022;
     |DDEFECTO #dsparm05;
     #dsparm05#0 = #ma001022@#1;
     |LEE 000#dsparm05.=;
     |SI FSalida ! 0;    |ACABA;   |FINSI;

     #ma000022@#0 = #ma001022@#0;
     |LEE 000#ma000022@.=;
     |SI FSalida ! 0;    |ACABA;   |FINSI;

     aAlfa1 = #ma000022@#0;
     aAlfa2 = #dsparm05#2;
     aAlfa3 = #ma000022@#4;
     aAlfa4 = #ma001022@#4;
     aAlfa  = aAlfa1 + aAlfa2 + aAlfa3 + aAlfa4 + &13 + &10;
     |XGRABA nHandle, aAlfa;
|FPRC;

|DEFBUCLE ma001022;
     #ma001022@#1002;
     ;
     "  ",    1;
     "zz", 9999;
     ;
     NULL, ma001022;
|FIN;

|PROCESO sstlsprt;
     |ABRE #200;
     |LEE 040#200p;
     |SI FSalida ! 0;  |CIERRA #200;  |ACABA;  |FINSI;
     |CIERRA #200;

     aAlfa1 = "";   |DBASS aAlfa1; aAlfa1 = aAlfa1 + "dsman9/def/ma000022.mas";
     |CARGA_DEF aAlfa1, ma000022@;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     aAlfa1 = "";   |DBASS aAlfa1; aAlfa1 = aAlfa1 + "dsman9/def/ma001022.mas";
     |CARGA_DEF aAlfa1, ma001022@;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     aAlfa1 = "";   |DBASS aAlfa1; aAlfa1 = aAlfa1 + "dsman9/fich/84/";
     |PATH_DAT #ma000022@#aAlfa1#;
     |PATH_DAT #ma001022@#aAlfa1#;

     aBase = #200#1;  |QBF aBase;
     |SI aBase = "";  |ACABA;  |FINSI;

     aBase = aBase + "fich/";

     aAbre = aBase + "sstlsprt.txt";
     |XABRE "BW", aAbre, nHandle;
     |SI FSalida ] 0;
         |ABRE #dsparm05;
         |ABRE #ma000022@;
         |BUCLE ma001022;
         |CIERRA #dsparm05;
         |CIERRA #ma000022@;
     |FINSI;
     |XCIERRA nHandle;

     |DESCARGA_DEF #ma001022@;
     |DESCARGA_DEF #ma000022@;
|FPRC;

|PROCESO ma000023;
     |DDEFECTO #dsparm05;
     #dsparm05#0 = #ma000023@#0;
     |LEE 000#dsparm05.=;
     |SI FSalida ! 0;    |ACABA;   |FINSI;

     aAlfa1 = #dsparm05#3;
     aAlfa  = aAlfa1 + &13 + &10;
     |XGRABA nHandle, aAlfa;
|FPRC;

|DEFBUCLE ma000023;
     #ma000023@#1001;
     ;
        1;
     9999;
     ;
     NULL, ma000023;
|FIN;

|PROCESO emtlsprt;
     |ABRE #200;
     |LEE 040#200p;
     |SI FSalida ! 0;  |CIERRA #200;  |ACABA;  |FINSI;
     |CIERRA #200;

     aAlfa1 = "";   |DBASS aAlfa1; aAlfa1 = aAlfa1 + "dsman9/def/ma000023.mas";
     |CARGA_DEF aAlfa1, ma000023@;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     aAlfa1 = "";   |DBASS aAlfa1; aAlfa1 = aAlfa1 + "dsman9/fich/84/";
     |PATH_DAT #ma000023@#aAlfa1#;

     aBase = #200#1;  |QBF aBase;
     |SI aBase = "";  |ACABA;  |FINSI;

     aBase = aBase + "fich/";

     aAbre = aBase + "emtlsprt.txt";
     |XABRE "BW", aAbre, nHandle;
     |SI FSalida ] 0;
         |ABRE #dsparm05;
         |BUCLE ma000023;
         |CIERRA #dsparm05;
     |FINSI;
     |XCIERRA nHandle;

     |DESCARGA_DEF #ma000023@;
|FPRC;

|PROCESO ma000024;
     aAlfa1 = ("000" + #ma000024@#0) % -103;
     aAlfa2 = #ma000024@#1;
     aAlfa  = aAlfa1 + aAlfa2 + &13 + &10;
     |XGRABA nHandle, aAlfa;
|FPRC;

|DEFBUCLE ma000024;
     #ma000024@#1001;
     ;
       1;
     999;
     ;
     NULL, ma000024;
|FIN;

|PROCESO frtlsprt;
     |ABRE #200;
     |LEE 040#200p;
     |SI FSalida ! 0;  |CIERRA #200;  |ACABA;  |FINSI;
     |CIERRA #200;

     aAlfa1 = "";   |DBASS aAlfa1; aAlfa1 = aAlfa1 + "dsman9/def/ma000024.mas";
     |CARGA_DEF aAlfa1, ma000024@;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     aAlfa1 = "";   |DBASS aAlfa1; aAlfa1 = aAlfa1 + "dsman9/fich/84/";
     |PATH_DAT #ma000024@#aAlfa1#;

     aBase = #200#1;  |QBF aBase;
     |SI aBase = "";  |ACABA;  |FINSI;

     aBase = aBase + "fich/";

     aAbre = aBase + "frtlsprt.txt";
     |XABRE "BW", aAbre, nHandle;
     |SI FSalida ] 0;
         |BUCLE ma000024;
     |FINSI;
     |XCIERRA nHandle;

     |DESCARGA_DEF #ma000024@;
|FPRC;

|PROCESO ma000001;
     |DDEFECTO #24;
     #24#0 = #100#3;
     |LEE 040#24=;

     |DDEFECTO #101;
     #101#0 = #100#4;
     |LEE 040#101=;

     |DDEFECTO #dsparm05;
     #dsparm05#0 = #ma000001@#59;
     |LEE 000#dsparm05.=;

     aAlfa1 = ("000000" + #100#44) % -106;
     aAlfa2 = #24#0;
     aAlfa3 = #100#4;
     aAlfa4 = #24#1 % 130;
     aAlfa5 = #101#2;
     aAlfa6 = #100#58;             || telesoporte S/N
     aAlfa7 = #dsparm05#2;         || usuario guardian
     aAlfa  = aAlfa1 + aAlfa2 + aAlfa3 + aAlfa4 + aAlfa5 + aAlfa6 + aAlfa7 + &13 + &10;
     |XGRABA nHandle, aAlfa;
|FPRC;

|DEFBUCLE ma000001;
     #ma000001@#4001;
     ;
          1;
     999999;
     ;
     NULL, ma000001;
|FIN;

|PROCESO cftlsprt;
     |ABRE #200;
     |LEE 040#200p;
     |SI FSalida ! 0;  |CIERRA #200;  |ACABA;  |FINSI;
     |CIERRA #200;

     aAlfa1 = "";   |DBASS aAlfa1; aAlfa1 = aAlfa1 + "dsman9/def/ma000022.mas";
     |CARGA_DEF aAlfa1, ma000022@;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     aAlfa1 = "";   |DBASS aAlfa1; aAlfa1 = aAlfa1 + "dsman9/fich/84/";
     |PATH_DAT #ma000022@#aAlfa1#;

     aBase = #200#1;  |QBF aBase;
     |SI aBase = "";  |ACABA;  |FINSI;

     aBase = aBase + "fich/";

     aAbre = aBase + "cftlsprt.txt";
     |XABRE "BW", aAbre, nHandle;
     |SI FSalida ] 0;
         |ABRE #24;
         |ABRE #101;
         |ABRE #dsparm05;
         |BUCLE ma000001;
         |CIERRA #24;
         |CIERRA #101;
         |CIERRA #dsparm05;
     |FINSI;
     |XCIERRA nHandle;

     |DESCARGA_DEF #ma000022@;
|FPRC;

|PROCESO ma000026;
     aAlfa1 = ("000000" + #ma000026@#0) % -106;
     aAlfa2 = #ma000026@#2;
     aAlfa3 = #ma000026@#3;
     aAlfa  = aAlfa1 + aAlfa2 + aAlfa3 + &13 + &10;
     |XGRABA nHandle, aAlfa;
|FPRC;

|DEFBUCLE ma000026;
     #ma000026@#1002;
     ;
     000001,  1;
     999999, 99;
     ;
     NULL, ma000026;
|FIN;

|PROCESO optlsprt;
     |ABRE #200;
     |LEE 040#200p;
     |SI FSalida ! 0;  |CIERRA #200;  |ACABA;  |FINSI;
     |CIERRA #200;

     aAlfa1 = "";   |DBASS aAlfa1; aAlfa1 = aAlfa1 + "dsman9/def/ma000026.mas";
     |CARGA_DEF aAlfa1, ma000026@;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     aAlfa1 = "";   |DBASS aAlfa1; aAlfa1 = aAlfa1 + "dsman9/fich/84/";
     |PATH_DAT #ma000026@#aAlfa1#;

     aBase = #200#1;  |QBF aBase;
     |SI aBase = "";  |ACABA;  |FINSI;

     aBase = aBase + "fich/";

     aAbre = aBase + "optlsprt.txt";
     |XABRE "BW", aAbre, nHandle;
     |SI FSalida ] 0;
         |BUCLE ma000026;
     |FINSI;
     |XCIERRA nHandle;

     |DESCARGA_DEF #ma000026@;
|FPRC;

|PROCESO ma000503;
   aAlfa = #ma000503@#2; |QBF aAlfa;
   aAlfa = aAlfa % 0402;  |XGRABA nHandle, aAlfa;
   aAlfa = #ma000503@#2; |QBF aAlfa;
   aAlfa = aAlfa % 0102;  |XGRABA nHandle, aAlfa;
|FPRC;

|DEFBUCLE ma000503;
#ma000503@#1002;
;
nCalc, 01;
nCalc, 99;
;
NULL,ma000503;
|FIN;

|PROCESO MiraDia;
  |QBF aAlfa;
  |SI aAlfa = "Domingo";   aAlfa = "0"; |FINSI;
  |SI aAlfa = "Lunes";     aAlfa = "1"; |FINSI;
  |SI aAlfa = "Martes";    aAlfa = "2"; |FINSI;
  |SI aAlfa = "Miercoles"; aAlfa = "3"; |FINSI;
  |SI aAlfa = "Jueves";    aAlfa = "4"; |FINSI;
  |SI aAlfa = "Viernes";   aAlfa = "5"; |FINSI;
  |SI aAlfa = "Sabado";    aAlfa = "6"; |FINSI;
|FPRC;

|PROCESO calendario;
     |ABRE #200;
     |LEE 040#200p;
     |SI FSalida ! 0;  |CIERRA #200;  |ACABA;  |FINSI;
     |CIERRA #200;

     aAlfa1 = "";   |DBASS aAlfa1; aAlfa1 = aAlfa1 + "dsman9/def/ma000502.mas";
     |CARGA_DEF aAlfa1, ma000502@;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     aAlfa1 = "";   |DBASS aAlfa1; aAlfa1 = aAlfa1 + "dsman9/def/ma000503.mas";
     |CARGA_DEF aAlfa1, ma000503@;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     aAlfa1 = "";   |DBASS aAlfa1; aAlfa1 = aAlfa1 + "dsman9/fich/84/";
     |PATH_DAT #ma000502@#aAlfa1#; |PATH_DAT #ma000503@#aAlfa1#;
     |ABRE #ma000502@;

     aBase = #200#1;  |QBF aBase;
     |SI aBase = "";  |ACABA;  |FINSI;

     aBase = aBase + "fich/";

     fFecha = ~; aAlfa1 = fFecha; |QBF aAlfa1; aAlfa1 = aAlfa1 % -104;
     aAbre = aAlfa1 % -102; nCalc = aAlfa1;

     #ma000502@#0 = nCalc;
     |LEE 000#ma000502@.=;
     |SI FSalida = 0;
        aAbre = aBase + aAbre + "tlsprt.txt";
        |XABRE "BW", aAbre, nHandle;
        |SI FSalida ] 0;
            aAlfa = #ma000502@#1;  |HAZ MiraDia;      |XGRABA nHandle, aAlfa;
            aAlfa = #ma000502@#2;  |HAZ MiraDia;      |XGRABA nHandle, aAlfa;
            aAlfa = #ma000502@#3;  |HAZ MiraDia;      |XGRABA nHandle, aAlfa;
            aAlfa = (("00" + #ma000502@#4)  % -102);  |XGRABA nHandle, aAlfa;
            aAlfa = (("00" + #ma000502@#5)  % -102);  |XGRABA nHandle, aAlfa;
            aAlfa = (("00" + #ma000502@#6)  % -102);  |XGRABA nHandle, aAlfa;
            aAlfa = (("00" + #ma000502@#7)  % -102);  |XGRABA nHandle, aAlfa;
            aAlfa = (("00" + #ma000502@#8)  % -102);  |XGRABA nHandle, aAlfa;
            aAlfa = (("00" + #ma000502@#9)  % -102);  |XGRABA nHandle, aAlfa;
            aAlfa = (("00" + #ma000502@#10) % -102);  |XGRABA nHandle, aAlfa;
            aAlfa = (("00" + #ma000502@#11) % -102);  |XGRABA nHandle, aAlfa;
            aAlfa = #ma000502@#12; |HAZ MiraDia;      |XGRABA nHandle, aAlfa;
            aAlfa = (("00" + #ma000502@#13)  % -102); |XGRABA nHandle, aAlfa;
            aAlfa = (("00" + #ma000502@#14)  % -102); |XGRABA nHandle, aAlfa;
            aAlfa = (("00" + #ma000502@#15)  % -102); |XGRABA nHandle, aAlfa;
            aAlfa = (("00" + #ma000502@#16)  % -102); |XGRABA nHandle, aAlfa;
            aAlfa = (("00" + #ma000502@#17)  % -102); |XGRABA nHandle, aAlfa;
            aAlfa = (("00" + #ma000502@#18)  % -102); |XGRABA nHandle, aAlfa;
            aAlfa = (("00" + #ma000502@#19) % -102);  |XGRABA nHandle, aAlfa;
            aAlfa = (("00" + #ma000502@#20) % -102);  |XGRABA nHandle, aAlfa;
            aAlfa = #ma000502@#21; |HAZ MiraDia;      |XGRABA nHandle, aAlfa;
            aAlfa = (("00" + #ma000502@#22)  % -102); |XGRABA nHandle, aAlfa;
            aAlfa = (("00" + #ma000502@#23)  % -102); |XGRABA nHandle, aAlfa;
            aAlfa = (("00" + #ma000502@#24)  % -102); |XGRABA nHandle, aAlfa;
            aAlfa = (("00" + #ma000502@#25)  % -102); |XGRABA nHandle, aAlfa;
            aAlfa = (("00" + #ma000502@#26)  % -102); |XGRABA nHandle, aAlfa;
            aAlfa = (("00" + #ma000502@#27)  % -102); |XGRABA nHandle, aAlfa;
            aAlfa = (("00" + #ma000502@#28) % -102);  |XGRABA nHandle, aAlfa;
            aAlfa = (("00" + #ma000502@#29) % -102);  |XGRABA nHandle, aAlfa;
            aAlfa = (("00" + #ma000502@#30) % -102);  |XGRABA nHandle, aAlfa;
            aAlfa = (("00" + #ma000502@#31) % -102);  |XGRABA nHandle, aAlfa;
            aAlfa = (("00" + #ma000502@#32) % -102);  |XGRABA nHandle, aAlfa;
            aAlfa = (("00" + #ma000502@#33) % -102);  |XGRABA nHandle, aAlfa;
            aAlfa = (("00" + #ma000502@#34) % -102);  |XGRABA nHandle, aAlfa;
            aAlfa = (("00" + #ma000502@#35) % -102);  |XGRABA nHandle, aAlfa;
            aAlfa = (("00" + #ma000502@#36) % -102);  |XGRABA nHandle, aAlfa;
            aAlfa = (("00" + #ma000502@#37) % -102);  |XGRABA nHandle, aAlfa;
            aAlfa = (("00" + #ma000502@#38) % -102);  |XGRABA nHandle, aAlfa;
            aAlfa = (("00" + #ma000502@#39) % -102);  |XGRABA nHandle, aAlfa;
            aAlfa = (("00" + #ma000502@#40) % -102);  |XGRABA nHandle, aAlfa;
            aAlfa = (("00" + #ma000502@#41) % -102);  |XGRABA nHandle, aAlfa;
            aAlfa = #ma000502@#42; |HAZ MiraDia;      |XGRABA nHandle, aAlfa;
            aAlfa = (("00" + #ma000502@#43)  % -102); |XGRABA nHandle, aAlfa;
            aAlfa = (("00" + #ma000502@#44)  % -102); |XGRABA nHandle, aAlfa;
            aAlfa = (("00" + #ma000502@#45)  % -102); |XGRABA nHandle, aAlfa;
            aAlfa = (("00" + #ma000502@#46)  % -102); |XGRABA nHandle, aAlfa;
            aAlfa = (("00" + #ma000502@#47)  % -102); |XGRABA nHandle, aAlfa;
            aAlfa = (("00" + #ma000502@#48)  % -102); |XGRABA nHandle, aAlfa;
            aAlfa = (("00" + #ma000502@#49) % -102);  |XGRABA nHandle, aAlfa;
            aAlfa = (("00" + #ma000502@#50) % -102);  |XGRABA nHandle, aAlfa;
            aAlfa = #ma000502@#51; |HAZ MiraDia;      |XGRABA nHandle, aAlfa;
            aAlfa = (("00" + #ma000502@#52)  % -102); |XGRABA nHandle, aAlfa;
            aAlfa = (("00" + #ma000502@#53)  % -102); |XGRABA nHandle, aAlfa;
            aAlfa = (("00" + #ma000502@#54)  % -102); |XGRABA nHandle, aAlfa;
            aAlfa = (("00" + #ma000502@#55)  % -102); |XGRABA nHandle, aAlfa;
            aAlfa = (("00" + #ma000502@#56)  % -102); |XGRABA nHandle, aAlfa;
            aAlfa = (("00" + #ma000502@#57)  % -102); |XGRABA nHandle, aAlfa;
            aAlfa = (("00" + #ma000502@#58) % -102);  |XGRABA nHandle, aAlfa;
            aAlfa = (("00" + #ma000502@#59) % -102);  |XGRABA nHandle, aAlfa;
            |BUCLE ma000503;
            aAlfa = &10;      |XGRABA nHandle, aAlfa;
        |FINSI;
        |XCIERRA nHandle;
     |SINO;
        |MENAV "    No existe calendario para el a¤o actual";
     |FINSI;

     |DESCARGA_DEF #ma000503@;
     |CIERRA #ma000502@; |DESCARGA_DEF #ma000502@;
|FPRC;

|PROCESO ma000501;
   ||aAlfa = #ma000501@#1 + &13 + &10; |XGRABA nHandle, aAlfa;
   aAlfa = (#ma000501@#1 % 160) + (#ma000501@#1 % 6153) + &13 + &10; |XGRABA nHandle, aAlfa;
|FPRC;

|DEFBUCLE ma000501;
#ma000501@#1001;
;
00001;
99999;
;
NULL,ma000501;
|FIN;

|PROCESO programacion;
     |ABRE #200;
     |LEE 040#200p;
     |SI FSalida ! 0;  |CIERRA #200;  |ACABA;  |FINSI;
     |CIERRA #200;

     aAlfa1 = "";   |DBASS aAlfa1; aAlfa1 = aAlfa1 + "dsman9/def/ma000501.mas";
     |CARGA_DEF aAlfa1, ma000501@;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     aAlfa1 = "";   |DBASS aAlfa1; aAlfa1 = aAlfa1 + "dsman9/fich/84/";
     |PATH_DAT #ma000501@#aAlfa1#;

     aBase = #200#1;  |QBF aBase;
     |SI aBase = "";  |ACABA;  |FINSI;

     aBase = aBase + "fich/";
     aAbre = aBase + "prtlsprt.txt";
     |XABRE "BW", aAbre, nHandle;
     |SI FSalida ] 0;
        |BUCLE ma000501;
     |FINSI;
     |XCIERRA nHandle;

     |CIERRA #ma000501@; |DESCARGA_DEF #ma000501@;
|FPRC;

|PROGRAMA;
     |ABRE #diapre05;
     |LEE 101#diapre05.p;
     |SI FSalida ! 0;    |GRABA 020#diapre05.b;   |FINSI;

     aAlfa1 = "";   |DBASS aAlfa1; aAlfa1 = aAlfa1 + "dsman9/def/ma000001.mas";
     |CARGA_DEF aAlfa1, ma000001@;
     |SI FSalida = 0;
          aAlfa1 = "";   |DBASS aAlfa1; aAlfa1 = aAlfa1 + "dsman9/fich/84/";
          |PATH_DAT #ma000001@#aAlfa1#;

          |HAZ cftlsprt;
          |HAZ frtlsprt;
          |HAZ emtlsprt;
          |HAZ sstlsprt;
          |HAZ optlsprt;
          |HAZ calendario;
          |HAZ programacion;

          |DESCARGA_DEF #ma000001@;
     |SINO;
          |MENAV "0000DSMAN9 mal instalado.";
     |FINSI;

     |LIBERA #diapre05;
     |CIERRA #diapre05;
|FPRO;
