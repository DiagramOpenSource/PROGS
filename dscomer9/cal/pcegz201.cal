          || Reparaciones

|FICHEROS;
     pcegz001 #0;
     pcegm001 #1;
     dsm00003 #3;
     agifa017 #17;
     agifa019 #19;
     agifa024 #24;
     pcegm042 #42,MANTE; || Reparaciones C
     pcegm043 #43,MANTE; || Reparaciones L
     pcegz067 #67,MANTE; || Pantalla Textos
     pcegz068 #68,MANTE; || Pantalla Textos
     pcegz069 #69,MANTE; || Pantalla Textos

     &pcegm042@;
     &pcegm043@;
|FIN;

|VARIABLES;
     &Tempo = "";
     &eaCierra = "";
     &enForma = 0;
     &eaArtRep = "";
     &enEdiRep = 0;
     &enError = 0;
     &enTipoTexto = 0;
     &eaTexto = "";
     aAlfa = "";
     nLabel = 0;
     nPanRep = 0;
     nBtnNueva = 0;
     nBtnConsu = 0;
     nBtnModifi = 0;
     nBtnBaja = 0;
     nGridRep = 0;
     {-1}aVent = "";
         aVent1 = 0;
         aVent2 = 0;
         aVent3 = 0;
         aVent4 = 0;
         aVent5 = "";
     nVentana = 0;
     nRango = 0;
     aTmp43 = "";
     nSwBloquea = 0;
     aSer = "";
     nNum = 0;
     nLin = 0;
     nModo = 0;
     nError = 0;
     fFecha = @;
     aArtAnt = "";
     nBtnRepLinSal = 0;
|FIN;

|PROCESO LlenaLinRep;
     |SALVA_DATOS #pcegm043@;
     |REPON_DATOS #43;
     #43#0 = "";
     #43#1 = 0;
     |GRABA 020#43n;
|FPRC;

|DEFBUCLE LlenaLinRep;
     #pcegm043@#1003;
     ;
     #42#0, #42#1, 001;
     #42#0, #42#1, 999;
     ;
     NULL, LlenaLinRep;
|FIN;

|PROCESO BorraLinRep;
     |BORRA 020#pcegm043@.a;
|FPRC;

|DEFBUCLE BorraLinRep;
     #pcegm043@#1003;
     ;
     #42#0, #42#1, 001;
     #42#0, #42#1, 999;
     be;
     NULL, BorraLinRep;
|FIN;

|PROCESO GrabaLinRep;
     |SALVA_DATOS #43;
     |REPON_DATOS #pcegm043@;
     #pcegm043@#0 = #42#0;
     #pcegm043@#1 = #42#1;
     |GRABA 020#pcegm043@.n;
|FPRC;

|DEFBUCLE GrabaLinRep;
     #43#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, GrabaLinRep;
|FIN;

|PROCESO Min43;
     #43#0 = "";
     #43#1 = 0;
     #43#2 = 1;
|FPRC;

|PROCESO Max43;
     #43#0 = "";
     #43#1 = 0;
     #43#2 = 999;
|FPRC;

|PROCESO DefLin; |TIPO 7;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 1;
          |LEE 000#43u;
          |SI FSalida = 0;
               nLin = #43#2 + 1;
          |SINO;
               nLin = 1;
          |FINSI;
          |DDEFECTO #43;
          #43#2 = nLin;
     |FINSI;
|FPRC;

|PROCESO PintaDir; |TIPO 0;
     |SI #42#3 = "      "; |ACABA; |FINSI;
     |ABRE #3;
     #3#0 = #42#3;
     #3#1 = #42#5;
     |LEE 000#3=;
     |SI FSalida = 0;
          |PINTA 1321, #3#2;
     |SINO;
          |MENAV "0000No existe direcci¢n entrega...";
          |ERROR;
     |FINSI;
     |CIERRA #3;
|FPRC;

|PROCESO Bloquea; |TIPO 0;
     |GRABA 000#42b;
     |SI FSalida = 0;
          nSwBloquea = 1;
     |SINO;
          |MENAV "0000Registro existente...";
          |ERROR;
     |FINSI;
|FPRC;

|PROCESO Ulti42;
     aSer = #42#0;
     #42#1 = 999999;
     |LEE 000#42];
     |SI FSalida = 0;
          |LEE 000#42a;
     |SINO;
          |LEE 000#42u;
     |FINSI;
     |SI FSalida = 0; |Y aSer = #42#0;
          nNum = #42#1 + 1;
     |SINO;
          nNum = 1;
     |FINSI;
     |DDEFECTO #42;
     #42#0 = aSer;
     #42#1 = nNum;
|FPRC;

|PROCESO CalcuSerie;
     nError = 0;
     |ABRE #24;
     #24#0 = #0#0;
     |LEE 000#24=;
     |CIERRA #24;

     |ABRE #1;
     #1#0 = #24#205;
     |LEE 000#1=;
     |SI FSalida ! 0;
          aAlfa = "0000No existe el Pais:" + #1#0 + " en el fichero de series facturacion por paises";
          |MENAV aAlfa;
          nError = 1;
     |FINSI;
     |CIERRA #1;
     fFecha = ~;
     aAlfa = fFecha % -102;
     aAlfa = #1#1 + aAlfa;
|FPRC;

|PROCESO StockRep;
/*
Quitado Stock segun  003308/00605
     |DDEFECTO #19;
     |DDEFECTO #17;
     |ABRE #19;
     |ABRE #17;

     #19#0 = eaArtRep;
     |LEE 101#19=;
     |SI FSalida ! 0; |GRABA 020#19b; |FINSI;

     #17#0 = eaArtRep;
     #17#1 = 1;
     |LEE 101#17=;
     |SI FSalida ! 0; |GRABA 020#17b; |FINSI;

     #19#15 = #19#15 + enForma;
     #19#12 = #19#12 + enForma;
     #19#6 = #19#6 + enForma;
     #17#42 = #17#42 + enForma;
     #17#8 = #17#8 + enForma;
     #17#5 = #17#5 + enForma;
     |HAZ ValoraStock;
     |GRABA 020#17a;
     |GRABA 020#19a;
     |CIERRA #17;
     |CIERRA #19;
*/
|FPRC;

|PROCESO EditaRep;
     |HAZ CreaTempo; aTmp43 = Tempo; |NOME_DAT #43 aTmp43; |DELINDEX #43;
     |ABRET #42;
     |ABRET #43;

     |SI enEdiRep = 1; |VENTANA 0807, 3491,  -1, 17, "Nuevo parte reparaciones"; |FINSI;
     |SI enEdiRep = 2; |VENTANA 0807, 3491,  -1, 17, "Modifica parte reparaciones"; |FINSI;
     |SI enEdiRep = 4; |VENTANA 0807, 3491,  -1, 17, "Consulta parte reparaciones"; |FINSI;
     nVentana = FSalida;
     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentana;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |DDEFECTO #42;
     |SI enEdiRep = 1;
          #42#3 = #0#0;
          |SI #0#0 ! "000000"; #42#4 = #0#2; |FINSI;
          |SI #0#1 ! 0; #42#5 = #0#1; |FINSI;
          #42#6 = Usuario % 810;
     |SINO;
          #42#0 = #pcegm042@#0;
          #42#1 = #pcegm042@#1;
          |SI enEdiRep = 2; |LEE 121#42=; |FINSI;
          |SI enEdiRep = 4; |LEE 020#42=; |FINSI;
          aArtAnt = #42#7;
          |BUCLE LlenaLinRep;
          |LEE 000#43p;
     |FINSI;
     |PINPA #0#42; nPanRep = FSalida;
     |PINDA #0#42;
     |HAZ PintaDir;

     nRango = 1 + 4 + 8 + 16 + 32;
     |LINEAL_SIMPLE #1#43, nRango, 2102, 2985, Min43, Max43, NULL;
     nGridRep = FSalida;
     nSwBloquea = 0;
     nError = 0;
     |SI enEdiRep = 1;
          |HAZ CalcuSerie;
          |SI nError = 0;
               #42#0 = aAlfa; |PINTA #42#0;
               |HAZ Ulti42;
               #42#3 = #0#0;
               |SI #0#0 ! "000000"; #42#4 = #0#2; |FINSI;
               |SI #0#1 ! 0; #42#5 = #0#1; |FINSI;
               #42#6 = Usuario % 810;
            |ET E1;
               |ENCAMPO #1#42;
               |SI FSalida = 2; |VETE E1; |FINSI;
               |SI FSalida ! 7;
                    |ENDATOS #1#42;
               |FINSI;
          |FINSI;
     |SINO;
          |SI enEdiRep = 2; |ENDATOS #2#42; |FINSI;
          |SI enEdiRep = 4; |PAUSA; |FINSI;
     |FINSI;
     |SI enEdiRep ! 4; |Y nError = 0;
          enError = FSalida;
          |SI FSalida = 0;
               |SI enEdiRep = 1;
                    enForma = 1; eaArtRep = #42#7; |HAZ StockRep;
               |SINO;
                    enForma = -1; eaArtRep = aArtAnt; |HAZ StockRep;
                    enForma = 1; eaArtRep = #42#7; |HAZ StockRep;
               |FINSI;
               |GRABA 020#42a;
               |BUCLE BorraLinRep;
               |BUCLE GrabaLinRep;
          |SINO;
               |SI nSwBloquea = 1;
                    |BORRA 020#42c;
               |FINSI;
          |FINSI;
     |FINSI;
     |DESTRUYECONTROL nGridRep;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentana;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;
     |FINVENTANA nVentana;
     |PULSATECLA;
     |CIERRAT #42;
     |CIERRAT #43;
     Tempo = aTmp43; |HAZ BoraTempo; |DELINDEX #43;
     aAlfa = "pcegm043";
     |NOME_DAT #43 aAlfa;
|FPRC;

|PROCESO Ptec; |TIPO 0;
     |SI FSalida = 0;
          |PTEC 802;
     |FINSI;
|FPRC;

|PROCESO TextoRep;
     |SI enTipoTexto = 1; |VENTANA 1110, 2090,  -1, 17, "Cerrar parte sin factura"; |FINSI;
     |SI enTipoTexto = 2; |VENTANA 1110, 2090,  -1, 17, "Pasar a oferta"; |FINSI;
     |SI enTipoTexto = 3; |VENTANA 1110, 2090,  -1, 17, "A facturar"; |FINSI;
     nVentana = FSalida;
     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentana;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     #67#0 = #pcegm042@#0;
     #67#1 = #pcegm042@#1;
     #67#2 = #pcegm042@#3;
     #67#3 = #pcegm042@#4;
     |SI enTipoTexto = 1; #67#4 = #pcegm042@#19; |FINSI;
     |SI enTipoTexto = 2; #67#4 = #pcegm042@#14; |FINSI;
     |SI enTipoTexto = 3; #67#4 = #pcegm042@#19; |FINSI;

     |PINPA #0#67; nPanRep = FSalida;
     |PINDA #0#67;
     |SI enTipoTexto = 1; |CONTROL_SIMPLE nPanRep, "LABEL,{{001}}Texto de factura", 1003, 1050, NULL; |FINSI;
     |SI enTipoTexto = 2; |CONTROL_SIMPLE nPanRep, "LABEL,{{001}}Texto de oferta", 1003, 1050, NULL; |FINSI;
     |SI enTipoTexto = 3; |CONTROL_SIMPLE nPanRep, "LABEL,{{001}}Texto de factura", 1003, 1050, NULL; |FINSI;
     nLabel = FSalida;
     |PARA; |SI; |HACIENDO;
          |ENDATOS #1#67;
          enError = FSalida;
          |SI FSalida = 0;
               eaTexto = #67#4; |QBF eaTexto;
               |SI eaTexto = "";
                    |MENAV "0000Texto obligatorio...";
               |SINO;
                    |SAL;
               |FINSI;
          |SINO;
               |SAL;
          |FINSI;
     |SIGUE;

     |FIN_CONTROL_WINDOWS nLabel;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentana;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;
     |FINVENTANA nVentana;
     |PULSATECLA;
|FPRC;

|PROCESO TipoCierre; |TIPO 0;
     |SI #68#5 = "C";
          #68#4 = "";
          |C_M #68#4, 1, "N";
     |SINO;
          |C_M #68#4, 1, "S";
     |FINSI;
     |PINTA #68#4;
|FPRC;

|PROCESO TextoRep1;
     |VENTANA 1110, 2290,  -1, 17, "Cerrar reparaci¢n";
     nVentana = FSalida;
     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentana;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |DDEFECTO #68;
     #68#0 = #pcegm042@#0;
     #68#1 = #pcegm042@#1;
     #68#2 = #pcegm042@#3;
     #68#3 = #pcegm042@#4;
     #68#4 = #pcegm042@#19;

     |C_M #68#4, 1, "N";
     |PINPA #0#68; nPanRep = FSalida;
     |PINDA #0#68;
     |CONTROL_SIMPLE nPanRep, "LABEL,{{001}}Texto de factura", 1303, 1350, NULL;
     nLabel = FSalida;
     |PARA; |SI; |HACIENDO;
          |ENDATOS #1#68;
          enError = FSalida;
          |SI FSalida = 0;
               eaTexto = #68#4; |QBF eaTexto;
               eaCierra = #68#5;
               |SI eaTexto = ""; |Y eaCierra = "P";
                    |MENAV "0000Texto obligatorio...";
               |SINO;
                    |SAL;
               |FINSI;
          |SINO;
               |SAL;
          |FINSI;
     |SIGUE;

     |FIN_CONTROL_WINDOWS nLabel;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentana;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;
     |FINVENTANA nVentana;
     |PULSATECLA;
|FPRC;

|PROCESO TextoRepTodo;
     |VENTANA 1110, 1990,  -1, 17, "Cerrar todas las reparaciones";
     nVentana = FSalida;
     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentana;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |DDEFECTO #69;
     #69#0 = #0#0;
     #69#1 = #0#1;
     #69#2 = #0#2;
     #69#3 = #0#3;
     |PINPA #0#69; nPanRep = FSalida;
     |PINDA #0#69;
     |PARA; |SI; |HACIENDO;
          |ENDATOS #1#69;
          enError = FSalida;
          |SI FSalida = 0;
               eaTexto = #69#4; |QBF eaTexto;
               |SI eaTexto = "";
                    |MENAV "0000Texto obligatorio...";
               |SINO;
                    |SAL;
               |FINSI;
          |SINO;
               |SAL;
          |FINSI;
     |SIGUE;
     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentana;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;
     |FINVENTANA nVentana;
     |PULSATECLA;
|FPRC;

|PROCESO BtnRepLinSal;
     |PTEC 807;
|FPRC;

|PROCESO EditaRepLin;
     |HAZ CreaTempo; aTmp43 = Tempo; |NOME_DAT #43 aTmp43; |DELINDEX #43;
     |ABRET #42;
     |ABRET #43;

     |VENTANA 0807, 3491,  -1, 17, "Lineas parte reparaciones";
     nVentana = FSalida;
     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentana;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |DDEFECTO #42;
     #42#0 = #pcegm042@#0;
     #42#1 = #pcegm042@#1;
     |LEE 121#42=;
     |BUCLE LlenaLinRep;
     |PINPA #0#42; nPanRep = FSalida;
     |PINDA #0#42;
     |HAZ PintaDir;

     |CONTROL_SIMPLE nPanRep, "BOTON,{{207}} Salir", 3078, 3085, BtnRepLinSal;
     nBtnRepLinSal = FSalida;

     nRango = 1 + 4 + 8 + 16;
     |LINEAL_SIMPLE #1#43, nRango, 2102, 2985, Min43, Max43, NULL;
     nGridRep = FSalida;

     |BUCLE BorraLinRep;
     |BUCLE GrabaLinRep;

     |DESTRUYECONTROL nGridRep;
     |FIN_CONTROL_WINDOWS nBtnRepLinSal;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentana;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;
     |FINVENTANA nVentana;
     |PULSATECLA;
     |CIERRAT #42;
     |CIERRAT #43;
     Tempo = aTmp43; |HAZ BoraTempo; |DELINDEX #43;
     aAlfa = "pcegm043";
     |NOME_DAT #43 aAlfa;
|FPRC;
