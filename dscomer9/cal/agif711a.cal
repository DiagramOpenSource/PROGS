|FICHEROS;
   agifa704 #10;
   agifa716 #11,MANTE;
   agifa715 #12;
   &caenlac@ #23;

   agifa134 #100;
   agifa071 #101;
   agifa010 #102;
   agifa079 #103;
   agifa080 #104;
   agifa077 #105;
   agifa069 #106;
   agifa084 #107;
   agifa501 #108;
   agifa502 #109;
   agifa731 #110;
   agifa732 #111;
   agifa060 #112;
   agifa007 #114;
   agifa505 #115;
   agifa733 #116;
   agifa019 #117;
   agifa746 #746;
   agifa706 #706,MANTE;
   dsm00153 #707;

   Referen@ #500;
   prelava@ #501;
   prelavc@ #502;
   Refere1@ #503;
   ReferAp@ #504;
   otrodef@ #600;

   RefOTP0@ #610;
   otpm004@ #611;
   RefPCEG@ #612;

   agifa142 #1000;
   dsm00279 #1001;

   lxem0019@ #5000;
   lxem0014@ #5001;
   lxem0018@ #5002;
   lxem0006@ #5003;
   lxem0020@ #5004;
   lxem0027@ #5005;
   lxem0007@ #5006;
   lxem0008@ #5007;

   Fich732@  #5010;
   Refere1@  #6000;
|FIN;

|VARIABLES;
   &enTipoREC = 0;
   &PRMNT_ActCliPro = "";
   &enSw      = 0;
   &eaSwObra  = "";
   &enSwError = 0;
   &eaSerAlbaran = "";
   &enNumAlbaran = 0;
   &eaTipoImporte = "";
   &PRMNT_enLuxeRec = 0;
   &eaContabilizados = "";
   &enSwEnlSeries = 0;

   aColor = "";
   nCon = 0;
   aCodSubAgrup = "";

   &enTiva = 0;   || Variables para la gestion
   &efFiva = @;
   &eaDiva = "";
   &enIva = 0;
   &enRec = 0;
   &enIncLin = 0;

   &enTipoIVA  = 0;
   &efFechaIVA = @;
   &enEdificio = 0;
   &eaCtaAna  = "";
   &eaCuaAuto = "";
   &enSwComport = 0;
   &eaTipoAviso = "";
   &eaAviso     = "";

   &eaArticulo = "";
   &eaProveedor = "";
   &eaTipoEnl   = "";

   &enNumRegs = 0;

   &enImporte = 0;
   &enDiario  = 0;
   &efFecha   = @;
   &enDocum   = 0;
   &enApunt   = 0;
   &eaCuenta  = "";
   &eaRuta    = "";
   &enEmpresa = 0;
   &enPeriodo = 0;
   &efFechaCierre = @;
   &eaCtaAnalit = "";
   &CodEnlace   = "";

   &eaSerie     = "";
   &enFactura   = 0;
   &eaFamilia   = "";

   nSwHay = 0;

   aFich  = "";
   aFichC = "";
   aAlfa  = "";
   aAlfa1 = "";
   aAlfa2 = "";
   aAlfa3 = "";
   aFichero = "";

   nCont    = 0;
   nCont1   = 0;
   nCont2   = 0;
   nCalc    = 0;
   nCalc1   = 0;
   nCalc2   = 0;
   nComp    = 0;
   nClave   = 0;
   nNumRels = 0;
   nLineaApunte = 0;
   nFich732 = 0;
   nSwEnlaceFacFict = 0;

   nTotalBruto = 0;
   nTotalIVA   = 0;
   nTotalFact  = 0;
   nDtoCab     = 0;

   aDCodigoCli = ""; aHCodigoCli = "";
   aDNombreCli = ""; aHNombreCli = "";
   aDContab    = ""; aHContab    = "";
   aDSerieF    = ""; aHSerieF    = "";
   nDNumeroF   = 0;  nHNumeroF   = 0;
   aDSerie     = ""; aHSerie     = "";
   aDFamilia   = ""; aHFamilia   = "";
   aDArticulo  = ""; aHArticulo  = "";
   nDNumero    = 0;  nHNumero    = 0;
   nDLinea     = 0;  nHLinea     = 0;
   fDFecha     = @;  fHFecha     = @;
   fDFechaFact = @;  fHFechaFact = @;
   aDSerieAnt  = ""; nDNumeroAnt = 0;
   aHSerieAnt  = ""; nHNumeroAnt = 0;
   nDLineaAnt  = 0;  nHLineaAnt  = 0;
   aDReferen   = ""; aHReferen   = "";
   aDSuAlbaran = ""; aHSuAlbaran = "";
   aDTipo      = ""; aHTipo      = "";
   aDImpresa   = ""; aHImpresa   = "";
   aDFactur    = ""; aHFactur    = "";
   aDMarca     = ""; aHMarca     = "";

   aBase       = "";
   aMas        = "";
   aEmpresa    = "";
   nNumCto     = 0;

   aFicClave   = "";
   aCmpClave   = 0;
   nNumLin     = 0;
   nSwCont     = 0;
   nClPr       = 0;
   &eaCli      = "";
   &eaPrv      = "";
|FIN;

|PROCESO FiltraLAV;
   || ABDON   19/10/2012    N.Tiquet 003042/00685
   |SI aDContab ! " "; |O aHContab ! "z";
    |O fDFechaFact ! "01.01.0000"; |O fHFechaFact ! "31.12.9999";
      #agifa010#52 = #agifa071#29;
      #agifa010#0  = #agifa071#0;
      |LEE 000#agifa010.=;
      |SI FSalida = 0;
         #agifa134#49 = #agifa010#53;
         #agifa134#0  = #agifa010#39;
         |LEE 000#agifa134.=;
         |SI FSalida = 0;
            |SI #agifa134#48 < aDContab;    |O #agifa134#48 > aHContab; |ACABA; |FINSI;
            |SI #agifa134#1  < fDFechaFact; |O #agifa134#1 > fHFechaFact; |ACABA; |FINSI;
         |FINSI;
      |FINSI;
   |FINSI;

   aAlfa = "|NC"; aAlfa = #prelava@#aAlfa#;
   nCalc = aAlfa; nCalc = nCalc - 1;
   |PARA nCont = 0; |SI nCont [ nCalc; |HACIENDO nCont = nCont + 1;
      #prelava@#nCont# = #agifa071#nCont#;
   |SIGUE;
   |GRABA 020#prelava@.n;

   |SI aFich ! aFichC;
      || Grabo la cabecera
      #prelavc@#52 = #agifa071#29;
      #prelavc@#0 = #agifa071#0;
      |LEE 000#prelavc@.=;
      |SI FSalida ! 0;
         #agifa010#52 = #agifa071#29;
         #agifa010#0  = #agifa071#0;
         |LEE 000#agifa010.=;
         |SI FSalida = 0;
            aAlfa = "|NC"; aAlfa = #prelavc@#aAlfa#;
            nCalc = aAlfa; nCalc = nCalc - 1;
            |PARA nCont = 0; |SI nCont [ nCalc; |HACIENDO nCont = nCont + 1;
               #prelavc@#nCont# = #agifa010#nCont#;
            |SIGUE;
            |GRABA 020#prelavc@.n;
         |FINSI;
      |FINSI;
   |FINSI;

   nCont2 = nCont2 + 1; #agifa731#2 = nCont2; |PINTA #agifa731#2;
   nSwHay = 1;
|FPRC;

|DEFBUCLE AlbLinV1;
#agifa071#1;
;
aDSerie, nDNumero, nDLinea;
aHSerie, nHNumero, nHLinea;
be;
NULL,FiltraLAV;
|FIN;

|DEFBUCLE AlbLinV2;
#agifa071#2;
;
aDSerie, nDNumero, aDFamilia;
aHSerie, nHNumero, aHFamilia;
;
NULL,FiltraLAV;
|FIN;

|DEFBUCLE AlbLinV3;
#agifa071#3;
;
aDFamilia, aDArticulo;
aHFamilia, aHArticulo;
;
NULL,FiltraLAV;
|FIN;

|DEFBUCLE AlbLinV4;
#agifa071#4;
;
aDSerie, nDNumero, nDLinea;
aHSerie, nHNumero, nHLinea;
;
NULL,FiltraLAV;
|FIN;

|DEFBUCLE AlbLinV5;
#agifa071#5;
;
aDCodigoCli, aDArticulo;
aHCodigoCli, aHArticulo;
;
NULL,FiltraLAV;
|FIN;

|PROCESO FiltraCAV;
   || ABDON   19/10/2012    N.Tiquet 003042/00685
   |SI aDContab ! " "; |O aHContab ! "z";
    |O fDFechaFact ! "01.01.0000"; |O fHFechaFact ! "31.12.9999";
      #agifa134#49 = #agifa010#53;
      #agifa134#0  = #agifa010#39;
      |LEE 000#agifa134.=;
      |SI FSalida = 0;
         |SI #agifa134#48 < aDContab;    |O #agifa134#48 > aHContab; |ACABA; |FINSI;
         |SI #agifa134#1  < fDFechaFact; |O #agifa134#1 > fHFechaFact; |ACABA; |FINSI;
      |FINSI;
   |FINSI;

   aDSerieAnt = aDSerie;        nDNumeroAnt = nDNumero;
   aHSerieAnt = aDSerie;        nHNumeroAnt = nHNumero;
   nDLineaAnt = nDLinea;        nHLineaAnt  = nHLinea;
   aDSerie = #agifa010#52;      nDNumero = #agifa010#0;
   aHSerie = #agifa010#52;      nHNumero = #agifa010#0;
   nDLinea = 1; nHLinea = 999; |BUCLE AlbLinV1;
   aDSerie = aDSerieAnt;        nDNumero = nDNumeroAnt;
   aHSerie = aHSerieAnt;        nHNumero = nHNumeroAnt;
   nDLinea = nDLineaAnt;        nHLinea  = nHLineaAnt;
|FPRC;

|DEFBUCLE AlbCabV1;
#agifa010#1;
;
aDSerie, nDNumero;
aHSerie, nHNumero;

;
NULL,FiltraCAV;
|FIN;

|DEFBUCLE AlbCabV2;
#agifa010#2;
;
aDNombreCli, fDFecha, aDSerie, nDNumero;
aHNombreCli, fHFecha, aHSerie, nHNumero;
;
NULL,FiltraCAV;
|FIN;

|DEFBUCLE AlbCabV3;
#agifa010#3;
;
aDCodigoCli, fDFecha, aDSerie, nDNumero;
aHCodigoCli, fHFecha, aHSerie, nHNumero;
;
NULL,FiltraCAV;
|FIN;

|DEFBUCLE AlbCabV4;
#agifa010#4;
;
aDSerie, fDFecha, nDNumero;
aHSerie, fHFecha, nHNumero;
;
NULL,FiltraCAV;
|FIN;

|DEFBUCLE AlbCabV5;
#agifa010#5;
;
aDSerieF, nDNumeroF, aDSerie, nDNumero;
aHSerieF, nHNumeroF, aHSerie, nHNumero;
;
NULL,FiltraCAV;
|FIN;

|DEFBUCLE AlbCabV6;
#agifa010#6;
;
fDFecha, aDSerie, nDNumero;
fHFecha, aHSerie, nHNumero;
;
NULL,FiltraCAV;
|FIN;

|PROCESO FiltraLAC;
   || ABDON   19/10/2012    N.Tiquet 003042/00685
   |SI aDContab ! " "; |O aHContab ! "z";
    |O fDFechaFact ! "01.01.0000"; |O fHFechaFact ! "31.12.9999";
      #agifa077#52 = #agifa080#29;
      #agifa077#0  = #agifa080#0;
      |LEE 000#agifa077.=;
      |SI FSalida = 0;
         #agifa079#49 = #agifa077#51;
         #agifa079#0  = #agifa077#39;
         |LEE 000#agifa079.=;
         |SI FSalida = 0;
            |SI #agifa079#48 < aDContab;    |O #agifa079#48 > aHContab;   |ACABA; |FINSI;
            |SI #agifa079#1  < fDFechaFact; |O #agifa079#1 > fHFechaFact; |ACABA; |FINSI;
         |FINSI;
      |FINSI;
   |FINSI;

   aAlfa = "|NC"; aAlfa = #prelava@#aAlfa#;
   nCalc = aAlfa; nCalc = nCalc - 1;
   |PARA nCont = 0; |SI nCont [ nCalc; |HACIENDO nCont = nCont + 1;
      #prelava@#nCont# = #agifa080#nCont#;
   |SIGUE;
   |GRABA 020#prelava@.n;

   |SI aFich ! aFichC;
      || Grabo la cabecera
      #prelavc@#52 = #agifa080#27;
      #prelavc@#0 = #agifa080#0;
      |LEE 000#prelavc@.=;
      |SI FSalida ! 0;
         #agifa077#52 = #agifa080#27;
         #agifa077#0  = #agifa080#0;
         |LEE 000#agifa077.=;
         |SI FSalida = 0;
            aAlfa = "|NC"; aAlfa = #prelavc@#aAlfa#;
            nCalc = aAlfa; nCalc = nCalc - 1;
            |PARA nCont = 0; |SI nCont [ nCalc; |HACIENDO nCont = nCont + 1;
               #prelavc@#nCont# = #agifa077#nCont#;
            |SIGUE;
            |GRABA 020#prelavc@.n;
         |FINSI;
      |FINSI;
   |FINSI;

   nCont2 = nCont2 + 1; #agifa731#2 = nCont2; |PINTA #agifa731#2;
   nSwHay = 1;
|FPRC;

|DEFBUCLE AlbLinC1;
#agifa080#1;
;
aDSerie, nDNumero, nDLinea;
aHSerie, nHNumero, nHLinea;
;
NULL, FiltraLAC;
|FIN;

|DEFBUCLE AlbLinC2;
#agifa080#2;
;
aDSerie, nDNumero, aDFamilia;
aHSerie, nHNumero, aHFamilia;
;
NULL, FiltraLAC;
|FIN;

|DEFBUCLE AlbLinC3;
#agifa080#3;
;
aDSerie, nDNumero, nDLinea;
aHSerie, nHNumero, nHLinea;
;
NULL, FiltraLAC;
|FIN;

|DEFBUCLE AlbLinC4;
#agifa080#4;
;
aDSerie, nDNumero, aDArticulo;
aHSerie, nHNumero, aHArticulo;
;
NULL, FiltraLAC;
|FIN;

|PROCESO FiltraCAC;
   || ABDON   19/10/2012    N.Tiquet 003042/00685
   |SI aDContab ! " "; |O aHContab ! "z";
    |O fDFechaFact ! "01.01.0000"; |O fHFechaFact ! "31.12.9999";
      #agifa079#49 = #agifa077#51;
      #agifa079#0  = #agifa077#39;
      |LEE 000#agifa079.=;
      |SI FSalida = 0;
         |SI #agifa079#48 < aDContab;    |O #agifa079#48 > aHContab; |ACABA; |FINSI;
         |SI #agifa079#1  < fDFechaFact; |O #agifa079#1 > fHFechaFact; |ACABA; |FINSI;
      |FINSI;
   |FINSI;

   aDSerieAnt = aDSerie;        nDNumeroAnt = nDNumero;
   aHSerieAnt = aDSerie;        nHNumeroAnt = nHNumero;
   nDLineaAnt = nDLinea;        nHLineaAnt  = nHLinea;
   aDSerie = #agifa010#52;      nDNumero = #agifa010#0;
   aHSerie = #agifa010#52;      nHNumero = #agifa010#0;
   nDLinea = 1; nHLinea = 999; |BUCLE AlbLinC1;
   aDSerie = aDSerieAnt;        nDNumero = nDNumeroAnt;
   aHSerie = aHSerieAnt;        nHNumero = nHNumeroAnt;
   nDLinea = nDLineaAnt;        nHLinea  = nHLineaAnt;
|FPRC;

|DEFBUCLE AlbCabC1;
#agifa077#1;
;
aDSerie, nDNumero;
aHSerie, nHNumero;
;
NULL,FiltraCAC;
|FIN;

|DEFBUCLE AlbCabC2;
#agifa077#2;
;
aDNombreCli;
aHNombreCli;
;
NULL,FiltraCAC;
|FIN;

|DEFBUCLE AlbCabC3;
#agifa077#3;
;
aDCodigoCli, fDFecha, aDSerie, nDNumero;
aHCodigoCli, fHFecha, aHSerie, nHNumero;
;
NULL,FiltraCAC;
|FIN;

|DEFBUCLE AlbCabC4;
#agifa077#4;
;
aDCodigoCli, aDSuAlbaran;
aHCodigoCli, aHSuAlbaran;
;
NULL,FiltraCAC;
|FIN;

|DEFBUCLE AlbCabC5;
#agifa077#5;
;
aDCodigoCli, aDFactur, aDSerie, nDNumero;
aHCodigoCli, aHFactur, aHSerie, nHNumero;
;
NULL,FiltraCAC;
|FIN;

|DEFBUCLE AlbCabC6;
#agifa077#6;
;
aDSerieF, nDNumeroF, aDSerie, nDNumero;
aHSerieF, nHNumeroF, aHSerie, nHNumero;
;
NULL,FiltraCAC;
|FIN;

|DEFBUCLE AlbCabC7;
#agifa077#7;
;
fDFecha, aDSerie, nDNumero;
fHFecha, aHSerie, nHNumero;
;
NULL,FiltraCAC;
|FIN;

|PROCESO FiltraCFV;
   aAlfa = "|NC"; aAlfa = #prelava@#aAlfa#;
   nCalc = aAlfa; nCalc = nCalc - 1;
   |PARA nCont = 0; |SI nCont [ nCalc; |HACIENDO nCont = nCont + 1;
      #prelava@#nCont# = #agifa134#nCont#;
   |SIGUE;
   |GRABA 020#prelava@.n;
   nCont2 = nCont2 + 1; #agifa731#2 = nCont2; |PINTA #agifa731#2;
   nSwHay = 1;
|FPRC;

|DEFBUCLE FacCabV1;
#agifa134#1;
;
aDSerie, nDNumero;
aHSerie, nHNumero;
be;
NULL,FiltraCFV;
|FIN;

|DEFBUCLE FacCabV2;
#agifa134#2;
;
aDNombreCli, fDFecha, aDSerie, nDNumero;
aHNombreCli, fHFecha, aHSerie, nHNumero;
be;
NULL,FiltraCFV;
|FIN;

|DEFBUCLE FacCabV3;
#agifa134#3;
;
aDCodigoCli, fDFecha, aDSerie, nDNumero;
aHCodigoCli, fHFecha, aHSerie, nHNumero;
be;
NULL,FiltraCFV;
|FIN;

|DEFBUCLE FacCabV4;
#agifa134#4;
;
fHFecha, aHSerie, nHNumero, aDCodigoCli;
fDFecha, aDSerie, nDNumero, aHCodigoCli;
be;
NULL,FiltraCFV;
|FIN;

|DEFBUCLE FacCabV5;
#agifa134#5;
;
aDMarca, aDSerie, nDNumero;
aHMarca, aHSerie, nHNumero;
be;
NULL,FiltraCFV;
|FIN;

|PROCESO FiltraCFC;
   aAlfa = "|NC"; aAlfa = #prelava@#aAlfa#;
   nCalc = aAlfa; nCalc = nCalc - 1;
   |PARA nCont = 0; |SI nCont [ nCalc; |HACIENDO nCont = nCont + 1;
      #prelava@#nCont# = #agifa079#nCont#;
   |SIGUE;
   |GRABA 020#prelava@.n;
   nCont2 = nCont2 + 1; #agifa731#2 = nCont2; |PINTA #agifa731#2;
   nSwHay = 1;
|FPRC;

|DEFBUCLE FacCabC1;
#agifa079#1;
;
aDSerie, nDNumero;
aHSerie, nHNumero;
;
NULL,FiltraCFC;
|FIN;

|DEFBUCLE FacCabC2;
#agifa079#2;
;
aDCodigoCli, aDNombreCli;
aHCodigoCli, aHNombreCli;
;
NULL,FiltraCFC;
|FIN;

|DEFBUCLE FacCabC3;
#agifa079#3;
;
aDImpresa, aDCodigoCli, fDFecha, aDSerie, nDNumero;
aHImpresa, aHCodigoCli, fHFecha, aHSerie, nHNumero;
;
NULL,FiltraCFC;
|FIN;

|DEFBUCLE FacCabC4;
#agifa079#4;
;
aDCodigoCli, aDReferen;
aHCodigoCli, aHReferen;
;
NULL,FiltraCFC;
|FIN;

|DEFBUCLE FacCabC5;
#agifa079#5;
;
aDMarca, aDSerie, nDNumero;
aHMarca, aHSerie, nHNumero;
be;
NULL,FiltraCFC;
|FIN;

|PROCESO FiltraLAD;
   aAlfa = "|NC"; aAlfa = #prelava@#aAlfa#;
   nCalc = aAlfa; nCalc = nCalc - 1;
   |PARA nCont = 0; |SI nCont [ nCalc; |HACIENDO nCont = nCont + 1;
      #prelava@#nCont# = #agifa069#nCont#;
   |SIGUE;
   |GRABA 020#prelava@.n;

   |SI aFich ! aFichC;
      || Grabo la cabecera
      #prelavc@#48 = #agifa069#20;
      #prelavc@#0 = #agifa069#0;
      |LEE 000#prelavc@.=;
      |SI FSalida ! 0;
         #agifa084#48 = #agifa069#20;
         #agifa084#0  = #agifa069#0;
         |LEE 000#agifa084.=;
         |SI FSalida = 0;
            aAlfa = "|NC"; aAlfa = #prelavc@#aAlfa#;
            nCalc = aAlfa; nCalc = nCalc - 1;
            |PARA nCont = 0; |SI nCont [ nCalc; |HACIENDO nCont = nCont + 1;
               #prelavc@#nCont# = #agifa084#nCont#;
            |SIGUE;
            |GRABA 020#prelavc@.n;
         |FINSI;
      |FINSI;
   |FINSI;

   nCont2 = nCont2 + 1; #agifa731#2 = nCont2; |PINTA #agifa731#2;
   nSwHay = 1;
|FPRC;

|DEFBUCLE AlbLinD1;
#agifa069#1;
;
aDSerie, nDNumero, nDLinea;
aHSerie, nHNumero, nHLinea;
be;
NULL,FiltraLAD;
|FIN;

|DEFBUCLE AlbLinD2;
#agifa069#2;
;
aDSerie, nDNumero, aDFamilia;
aHSerie, nHNumero, aHFamilia;
be;
NULL,FiltraLAD;
|FIN;

|PROCESO FiltraCFD;
   aAlfa = "|NC"; aAlfa = #prelava@#aAlfa#;
   nCalc = aAlfa; nCalc = nCalc - 1;
   |PARA nCont = 0; |SI nCont [ nCalc; |HACIENDO nCont = nCont + 1;
      #prelava@#nCont# = #agifa084#nCont#;
   |SIGUE;
   |GRABA 020#prelava@.n;
   nCont2 = nCont2 + 1; #agifa731#2 = nCont2; |PINTA #agifa731#2;
   nSwHay = 1;
|FPRC;

|DEFBUCLE FacCabD1;
#agifa084#1;
;
aDSerie, nDNumero;
aHSerie, nHNumero;
;
NULL,FiltraCFD;
|FIN;

|DEFBUCLE FacCabD2;
#agifa084#2;
;
aDNombreCli, fDFecha, aDSerie, nDNumero;
aHNombreCli, fHFecha, aHSerie, nHNumero;
;
NULL,FiltraCFD;
|FIN;

|DEFBUCLE FacCabD3;
#agifa084#3;
;
aDCodigoCli, fDFecha, aDSerie, nDNumero;
aHCodigoCli, fHFecha, aHSerie, nHNumero;
;
NULL,FiltraCFD;
|FIN;

|DEFBUCLE FacCabD4;
#agifa084#4;
;
aDSerie, fDFecha, nDNumero;
aHSerie, fHFecha, nHNumero;
;
NULL,FiltraCFD;
|FIN;

|PROCESO FiltraLinT;
   aAlfa = "|NC"; aAlfa = #prelava@#aAlfa#;
   nCalc = aAlfa; nCalc = nCalc - 1;
   |PARA nCont = 0; |SI nCont [ nCalc; |HACIENDO nCont = nCont + 1;
      #prelava@#nCont# = #agifa502#nCont#;
   |SIGUE;
   |GRABA 020#prelava@.n;
   nCont2 = nCont2 + 1; #agifa731#2 = nCont2; |PINTA #agifa731#2;
   nSwHay = 1;
|FPRC;

|DEFBUCLE LinTick1;
#agifa502#1;
;
aDSerie, nDNumero, nDLinea;
aHSerie, nHNumero, nHLinea;
;
NULL,FiltraLinT;
|FIN;

|DEFBUCLE LinTick2;
#agifa502#2;
;
nDNumero, aDFamilia;
nHNumero, aHFamilia;
;
NULL,FiltraLinT;
|FIN;

|DEFBUCLE LinTick3;
#agifa502#3;
;
fDFecha, aDFamilia, aDArticulo;
fHFecha, aHFamilia, aHArticulo;
;
NULL,FiltraLinT;
|FIN;

|PROCESO FiltraCabT;
   aAlfa = "|NC"; aAlfa = #prelava@#aAlfa#;
   nCalc = aAlfa; nCalc = nCalc - 1;
   |PARA nCont = 0; |SI nCont [ nCalc; |HACIENDO nCont = nCont + 1;
      #prelava@#nCont# = #agifa501#nCont#;
   |SIGUE;
   |GRABA 020#prelava@.n;
   nCont2 = nCont2 + 1; #agifa731#2 = nCont2; |PINTA #agifa731#2;
   nSwHay = 1;
|FPRC;

|DEFBUCLE CabTick1;
#agifa501#1;
;
aDSerie, nDNumero;
aHSerie, nHNumero;
;
NULL,FiltraCabT;
|FIN;

|DEFBUCLE CabTick2;
#agifa501#2;
;
aDTipo, aDSerie, nDNumero;
aHTipo, aHSerie, nHNumero;
;
NULL,FiltraCabT;
|FIN;

|DEFBUCLE CabTick3;
#agifa501#3;
;
fDFecha, aDCodigoCli, aDTipo, aDSerie, nDNumero;
fHFecha, aHCodigoCli, aHTipo, aHSerie, nHNumero;
;
NULL,FiltraCabT;
|FIN;

|PROCESO SacaClave;

   nClave = 999; nComp = 999;
   |DDEF aAlfa; |QBF aAlfa; aAlfa = aAlfa + #agifa704#16 + ".mas";
   |CARGA_DEF aAlfa,Referen@;
   |SI FSalida = 0;
      aAlfa = "|NK"; aAlfa = #Referen@#aAlfa#; nNumRels = aAlfa; nNumRels = nNumRels - 1;
      |PARA nCont = 0; |SI nCont [ nNumRels; |HACIENDO nCont = nCont + 1;
         nCont1 = 0;
         aAlfa = "|K" + (("000" + nCont) % -103); aAlfa = #Referen@#aAlfa#;
         aAlfa1 = aAlfa % 0103; aAlfa = aAlfa % 0499;
         |PARA; |SI aAlfa ! ""; |HACIENDO;
            nCont1 = nCont1 + 1;
            aAlfa1 = aAlfa % 0103; aAlfa = aAlfa % 0499; nCalc = aAlfa1;
            |SI nCalc = #agifa704#17;
               |SI nCont1 [ nComp;
                  nClave = nCont + 1; nComp = nCont1;
               |FINSI;
            |FINSI;
         |SIGUE;
      |SIGUE;
      |DESCARGA_DEF #Referen@;
   |FINSI;
|FPRC;

|DEFBUCLE LinAlbaranesVta;
#agifa071#1;
;
#agifa010#52, #agifa010#0, 001;
#agifa010#52, #agifa010#0, 999;
;
NULL, FiltraLAV;
|FIN;

|PROCESO AlbaranesVta;
   |BUCLE LinAlbaranesVta;
|FPRC;

|DEFBUCLE AlbaranesVta;
#agifa010#5;
;
#agifa134#49, #agifa134#0, aDSerie, nDNumero;
#agifa134#49, #agifa134#0, aHSerie, nHNumero;
;
NULL, AlbaranesVta;
|FIN;

|PROCESO FrasVtaContab;
   |BUCLE AlbaranesVta;
|FPRC;

|DEFBUCLE FrasVtaContab;
#agifa134#5;
;
aDContab, aDSerieF, nDNumeroF;
aHContab, aHSerieF, nHNumeroF;
;
NULL, FrasVtaContab;
|FIN;

|PROCESO VentasContab;
   |BUCLE FrasVtaContab;
|FPRC;

|DEFBUCLE LinAlbaranesCmp;
#agifa071#1;
;
#agifa077#50, #agifa077#0, 001;
#agifa077#50, #agifa077#0, 999;
;
NULL, FiltraLAC;
|FIN;

|PROCESO AlbaranesCmp;
   |BUCLE LinAlbaranesCmp;
|FPRC;

|DEFBUCLE AlbaranesCmp;
#agifa077#6;
;
#agifa079#66, #agifa079#0, "     ", 000000;
#agifa079#66, #agifa079#0, "zzzzz", 999999;
;
NULL, AlbaranesCmp;
|FIN;

|PROCESO FrasCmpContab;
   |BUCLE AlbaranesCmp
|FPRC;

|DEFBUCLE FrasCmpContab;
#agifa079#5;
;
#agifa716#3, "     ", 000000;
#agifa716#4, "zzzzz", 999999;
;
NULL, FrasCmpContab;
|FIN;

|PROCESO ComprasContab;
   |BUCLE FrasCmpContab;
|FPRC;

|PROCESO Prelavado;
   |DDEFECTO #agifa731;
   |HORA aAlfa; |QBF aAlfa;
   |SI #agifa704#17 ! 999;
      #agifa731#0 = aAlfa;
   |SINO;
      #agifa731#0 = "";
      #agifa731#1 = "";
      #agifa731#2 = "DESACTIVADA";
   |FINSI;
   |PINPA #0#agifa731; |PINDA #0#agifa731;

   nCont = 0;

   |SI #agifa704#17 = 999;
      |PINTA 1523, " Seleccionando ...";
      |ACABA;
   |FINSI;

   |SI #agifa704#2 = "CC"; |O #agifa704#2 = "CR";
      |PINTA 1523, " Seleccionando ...";
      |ACABA;
   |FINSI;

   |SI #agifa704#2 = "FV";
      |SI #agifa704#8 = "S";
        aFich = "agifa071"; aFichC = "agifa010";
      |SINO;
        aFich = "agifa134"; aFichC = "agifa134";
      |FINSI;
   |FINSI;
   |SI #agifa704#2 = "FC";
      |SI #agifa704#8 = "S";
        aFich = "agifa080"; aFichC = "agifa077";
      |SINO;
        aFich = "agifa079"; aFichC = "agifa079";
      |FINSI;
   |FINSI;
   |SI #agifa704#2 = "FD";
      |SI #agifa704#8 = "S";
        aFich = "agifa069"; aFichC = "agifa084";
      |SINO;
        aFich = "agifa084"; aFichC = "agifa084";
      |FINSI;
   |FINSI;

   |SI #agifa704#2 = "TI";
      |SI #agifa704#8 = "S";
        aFich = "agifa502"; aFichC = "agifa501";
      |SINO;
        aFich = "agifa501"; aFichC = "agifa501";
      |FINSI;
   |FINSI;
   |SI #agifa704#2 = "CC";
      aFich = "agifa509"; aFichC = "agifa509";
   |FINSI;
   |SI #agifa704#2 = "CR";
      aFich = "agifa572"; aFichC = "agifa572";
   |FINSI;

   |DDEF aAlfa; |QBF aAlfa;
   aAlfa = aAlfa + aFich + ".mas";
   |CARGA_DEF aAlfa, prelava@;
   |SI FSalida ! 0;
      |PINTA 1523, " Seleccionando ...";
      |ACABA;
   |FINSI;

   |SI aFich ! aFichC;
      |DDEF aAlfa; |QBF aAlfa;
      aAlfa = aAlfa + aFichC + ".mas";
      |CARGA_DEF aAlfa, prelavc@;
      |SI FSalida ! 0;
         |DESCARGA_DEF #prelava@;
         |PINTA 1523, " Seleccionando ...";
         |ACABA;
      |FINSI;
   |FINSI;

   |SI #agifa704#8 = "S";
      aDContab    = " ";          aHContab    = "z";
      fDFechaFact = "01.01.0000"; fHFechaFact = "31.12.9999";
      nSwCont = 0;
      aAlfa = "ac" + Usuario; |NOME_DAT #agifa716#aAlfa#;
      |ABRE #agifa716;
      #agifa716#15 = #agifa704#0;
      #agifa716#0  = 1;
      |LEE 000#agifa716.=;
      |PARA; |SI FSalida = 0; |Y #agifa716#15 = #agifa704#0; |HACIENDO;
         |SI #agifa716#13 = "agifa134"; |Y #agifa716#14 = 1;
            fDFechaFact = #agifa716#7; fHFechaFact = #agifa716#8;
         |FINSI;
         |SI #agifa716#13 = "agifa079"; |Y #agifa716#14 = 1;
            fDFechaFact = #agifa716#7; fHFechaFact = #agifa716#8;
         |FINSI;

         |SI #agifa716#13 = "agifa134"; |Y #agifa716#14 = 48;
            aDContab = #agifa716#3; aDContab  = aDContab % 0101;
            aHContab = #agifa716#4; aHContab  = aHContab % 0101;
            nSwCont = 1;
         |FINSI;
         |SI #agifa716#13 = "agifa079"; |Y #agifa716#14 = 48;
            aDContab = #agifa716#3; aDContab  = aDContab % 0101;
            aHContab = #agifa716#4; aHContab  = aHContab % 0101;
            nSwCont = 1;
         |FINSI;
         |LEE 000#agifa716.s;
      |SIGUE;

      |SI nSwCont = 1;
         aFicClave   = ""; aCmpClave   = 0;
         #agifa716#15 = #agifa704#0;
         #agifa716#0  = 1;
         |LEE 000#agifa716.];
         |PARA; |SI FSalida = 0; |Y #agifa716#15 = #agifa704#0; |HACIENDO;
            |SI #agifa716#13 = aFich;
               #agifa704#16 = #agifa716#13; #agifa704#17 = #agifa716#14;
               |SAL;
            |FINSI;
            |LEE 000#agifa716.s;
         |SIGUE;
      |FINSI;
   |FINSI;

   |SI #agifa704#16 = aFich;
      |HAZ SacaClave;
   |SINO;
      |SI #agifa704#16 = aFichC;
         |HAZ SacaClave;
      |FINSI;
   |FINSI;

   |SI #agifa704#2 = "FV"; |Y #agifa704#8 = "S"; |Y #agifa704#16 = "agifa134";
      |SI #agifa704#17 ! 48; nClave = 999; |FINSI;
   |FINSI;
   |SI #agifa704#2 = "FC"; |Y #agifa704#8 = "S"; |Y #agifa704#16 = "agifa079";
      |SI #agifa704#17 ! 48; nClave = 999; |FINSI;
   |FINSI;

   nSwHay = 0;
   |SI nClave ! 999;
      aAlfa = "pl" + Usuario; |NOME_DAT #501#aAlfa#; |DELINDEX #501; |ABRE #501;
      |SI aFich ! aFichC;
         aAlfa = "pc" + Usuario; |NOME_DAT #502#aAlfa#; |DELINDEX #502; |ABRE #502;
      |FINSI;

      aDCodigoCli = "      ";     aHCodigoCli = "zzzzzz";
      aDNombreCli = " " * 60;     aHNombreCli = "z" * 60;
      aDSerie     = "     ";      aHSerie     = "zzzzz";
      aDSerieF    = "     ";      aHSerieF    = "zzzzz";
      nDNumero    = 1;            nHNumero    = 999999;
      nDNumeroF   = 1;            nHNumeroF   = 999999;
      fDFecha     = "01.01.1900"; fHFecha     = "31.12.2999";
      aDFamilia   = "   ";        aHFamilia   = "zzz";
      aDReferen   = " " * 20;     aHReferen   = "z" * 20;
      aDImpresa   = " ";          aHImpresa   = "z";
      aDFactur    = " ";          aHFactur    = "z";
      aDTipo      = " ";          aHTipo      = "z";
      aDArticulo  = " " * 20;     aHArticulo  = "z" * 20;
      aDSuAlbaran = " " * 10;     aHSuAlbaran = "z" * 10

      aAlfa = "ac" + Usuario; |NOME_DAT #agifa716#aAlfa#;
      |ABRE #agifa716;
      |SELECT #3#agifa716;
      #agifa716#13 = #agifa704#16;
      #agifa716#14 = #agifa704#17;
      |LEE 000#agifa716.=;
      |PARA; |SI FSalida = 0; |Y #agifa716#13 = #agifa704#16; |Y #agifa716#14 = #agifa704#17; |HACIENDO;
         |SI #agifa716#15 = #agifa704#0; |SAL; |FINSI;
         |LEE 000#agifa716.s;
      |SIGUE;
      |SI #agifa716#13 = #agifa704#16; |Y #agifa716#14 = #agifa704#17; |Y #agifa716#15 = #agifa704#0;
         |SI #agifa704#2 = "FV";
            |SI #agifa704#8 = "S";
               |SI #agifa704#16 = aFich;
                  |SI nClave = 1;
                     |SI nComp = 1; aDSerie  = #agifa716#3; aHSerie  = #agifa716#4; |FINSI;
                     |SI nComp = 2; nDNumero = #agifa716#5; nHNumero = #agifa716#6; |FINSI;
                     |SI nComp = 3; nDLinea  = #agifa716#5; nHLinea  = #agifa716#6; |FINSI;
                  |FINSI;
                  |SI nClave = 2;
                     |SI nComp = 1; aDSerie   = #agifa716#3; aHSerie   = #agifa716#4; |FINSI;
                     |SI nComp = 2; nDNumero  = #agifa716#5; nHNumero  = #agifa716#6; |FINSI;
                     |SI nComp = 3; aDFamilia = #agifa716#3; aHFamilia = #agifa716#4; |FINSI;
                  |FINSI;
                  |SI nClave = 3;
                     |SI nComp = 1; aDFamilia  = #agifa716#3; aHFamilia   = #agifa716#4; |FINSI;
                     |SI nComp = 2; aDArticulo = #agifa716#3; aHArticulo  = #agifa716#4; |FINSI;
                  |FINSI;
                  |SI nClave = 4;
                     |SI nComp = 1; aDSerie    = #agifa716#3; aHSerie    = #agifa716#4; |FINSI;
                     |SI nComp = 2; nDNumero   = #agifa716#5; nHNumero   = #agifa716#6; |FINSI;
                     |SI nComp = 3; nDLinea    = #agifa716#5; nHLinea    = #agifa716#6; |FINSI;
                  |FINSI;
                  |SI nClave = 5;
                     |SI nComp = 1; aDCodigoCli = #agifa716#3; aHCodigoCli = #agifa716#4; |FINSI;
                     |SI nComp = 2; aDArticulo  = #agifa716#3; aHArticulo  = #agifa716#4; |FINSI;
                  |FINSI;

                  |ABRE #agifa010; |ABRE #agifa134;
                  |SI nClave = 1; |BUCLE AlbLinV1; |FINSI;
                  |SI nClave = 2; |BUCLE AlbLinV2; |FINSI;
                  |SI nClave = 3; |BUCLE AlbLinV3; |FINSI;
                  |SI nClave = 4; |BUCLE AlbLinV4; |FINSI;
                  |SI nClave = 5; |BUCLE AlbLinV5; |FINSI;
                  |CIERRA #agifa134; |CIERRA #agifa010;
               |FINSI;
               |SI #agifa704#16 = aFichC;
                  |SI nClave = 1;
                     |SI nComp = 1; aDSerie  = #agifa716#3; aHSerie  = #agifa716#4; |FINSI;
                     |SI nComp = 2; nDNumero = #agifa716#5; nHNumero = #agifa716#6; |FINSI;
                  |FINSI;
                  |SI nClave = 2;
                     |SI nComp = 1; aDNombreCli = #agifa716#3; aHNombreCli = #agifa716#4; |FINSI;
                     |SI nComp = 2; fDFecha     = #agifa716#7; fHFecha     = #agifa716#8; |FINSI;
                     |SI nComp = 3; aDSerie     = #agifa716#3; aHSerie     = #agifa716#4; |FINSI;
                     |SI nComp = 4; nDNumero    = #agifa716#5; nHNumero    = #agifa716#6; |FINSI;
                  |FINSI;
                  |SI nClave = 3;
                     |SI nComp = 1; aDCodigoCli = #agifa716#3; aHCodigoCli = #agifa716#4; |FINSI;
                     |SI nComp = 2; fDFecha     = #agifa716#7; fHFecha     = #agifa716#8; |FINSI;
                     |SI nComp = 3; aDSerie     = #agifa716#3; aHSerie     = #agifa716#4; |FINSI;
                     |SI nComp = 4; nDNumero    = #agifa716#5; nHNumero    = #agifa716#6; |FINSI;
                  |FINSI;
                  |SI nClave = 4;
                     |SI nComp = 1; aDSerie    = #agifa716#3; aHSerie    = #agifa716#4; |FINSI;
                     |SI nComp = 2; fDFecha    = #agifa716#7; fHFecha    = #agifa716#8; |FINSI;
                     |SI nComp = 3; nDNumero   = #agifa716#5; nHNumero   = #agifa716#6; |FINSI;
                  |FINSI;
                  |SI nClave = 5;
                     |SI nComp = 1; aDSerieF   = #agifa716#3; aHSerieF   = #agifa716#4; |FINSI;
                     |SI nComp = 2; nDNumeroF  = #agifa716#5; nHNumeroF  = #agifa716#6; |FINSI;
                     |SI nComp = 3; aDSerie    = #agifa716#3; aHSerie    = #agifa716#4; |FINSI;
                     |SI nComp = 4; nDNumero   = #agifa716#5; nHNumero   = #agifa716#6; |FINSI;
                  |FINSI;
                  |SI nClave = 6;
                     |SI nComp = 1; fDFecha    = #agifa716#7; fHFecha    = #agifa716#8; |FINSI;
                     |SI nComp = 2; aDSerie    = #agifa716#3; aHSerie    = #agifa716#4; |FINSI;
                     |SI nComp = 3; nDNumero   = #agifa716#5; nHNumero   = #agifa716#6; |FINSI;
                  |FINSI;

                  |ABRE #agifa134;
                  |SI nClave = 1; |BUCLE AlbCabV1; |FINSI;
                  |SI nClave = 2; |BUCLE AlbCabV2; |FINSI;
                  |SI nClave = 3; |BUCLE AlbCabV3; |FINSI;
                  |SI nClave = 4; |BUCLE AlbCabV4; |FINSI;
                  |SI nClave = 5; |BUCLE AlbCabV5; |FINSI;
                  |SI nClave = 6; |BUCLE AlbCabV6; |FINSI;
                  |CIERRA #agifa134;
               |FINSI;
            |SINO;
               |SI nClave = 1;
                  |SI nComp = 1; aDSerie  = #agifa716#3; aHSerie  = #agifa716#4; |FINSI;
                  |SI nComp = 2; nDNumero = #agifa716#5; nHNumero = #agifa716#6; |FINSI;
               |FINSI;
               |SI nClave = 2;
                  |SI nComp = 1; aDNombreCli = #agifa716#3; aHNombreCli = #agifa716#4; |FINSI;
                  |SI nComp = 2; fDFecha     = #agifa716#7; fDFecha     = #agifa716#8; |FINSI;
                  |SI nComp = 3; aDSerie     = #agifa716#3; aHSerie     = #agifa716#4; |FINSI;
                  |SI nComp = 4; nDNumero    = #agifa716#5; nHNumero    = #agifa716#6; |FINSI;
               |FINSI;
               |SI nClave = 3;
                  |SI nComp = 1; aDCodigoCli = #agifa716#3; aHCodigoCli = #agifa716#4; |FINSI;
                  |SI nComp = 2; fDFecha     = #agifa716#7; fHFecha     = #agifa716#8; |FINSI;
                  |SI nComp = 3; aDSerie     = #agifa716#3; aHSerie     = #agifa716#4; |FINSI;
                  |SI nComp = 4; nDNumero    = #agifa716#5; nHNumero    = #agifa716#6; |FINSI;
               |FINSI;
               |SI nClave = 4;  || CLAVE INVERSA
                  |SI nComp = 1; fDFecha     = #agifa716#7; fHFecha     = #agifa716#8; |FINSI;
                  |SI nComp = 2; aDSerie     = #agifa716#3; aHSerie     = #agifa716#4; |FINSI;
                  |SI nComp = 3; nDNumero    = #agifa716#5; nHNumero    = #agifa716#6; |FINSI;
                  |SI nComp = 4; aDCodigoCli = #agifa716#3; aHCodigoCli = #agifa716#4; |FINSI;
               |FINSI;
               |SI nClave = 5;
                  |SI nComp = 1; aDMarca     = #agifa716#3; aHMarca     = #agifa716#4; |FINSI;
                  |SI nComp = 2; aDSerie     = #agifa716#3; aHSerie     = #agifa716#4; |FINSI;
                  |SI nComp = 3; nDNumero    = #agifa716#5; nHNumero    = #agifa716#6; |FINSI;
               |FINSI;

               |SI nClave = 1; |BUCLE FacCabV1; |FINSI;
               |SI nClave = 2; |BUCLE FacCabV2; |FINSI;
               |SI nClave = 3; |BUCLE FacCabV3; |FINSI;
               |SI nClave = 4; |BUCLE FacCabV4; |FINSI;
               |SI nClave = 5; |BUCLE FacCabV5; |FINSI;
            |FINSI;
         |FINSI;
         |SI #agifa704#2 = "FC";
            |SI #agifa704#8 = "S";
               |SI #agifa704#16 = aFich;
                  |SI nClave = 1;
                     |SI nComp = 1; aDSerie  = #agifa716#3; aHSerie  = #agifa716#4; |FINSI;
                     |SI nComp = 2; nDNumero = #agifa716#5; nHNumero = #agifa716#6; |FINSI;
                     |SI nComp = 3; nDLinea  = #agifa716#5; nHLinea  = #agifa716#6; |FINSI;
                  |FINSI;
                  |SI nClave = 2;
                     |SI nComp = 1; aDSerie   = #agifa716#3; aHSerie   = #agifa716#4; |FINSI;
                     |SI nComp = 2; nDNumero  = #agifa716#5; nHNumero  = #agifa716#6; |FINSI;
                     |SI nComp = 3; aDFamilia = #agifa716#3; aHFamilia = #agifa716#4; |FINSI;
                  |FINSI;
                  |SI nClave = 3;
                     |SI nComp = 1; aDSerie   = #agifa716#3; aHSerie   = #agifa716#4; |FINSI;
                     |SI nComp = 2; nDNumero  = #agifa716#5; nHNumero  = #agifa716#6; |FINSI;
                     |SI nComp = 3; nDLinea   = #agifa716#5; nHLinea   = #agifa716#6; |FINSI;
                  |FINSI;
                  |SI nClave = 4;
                     |SI nComp = 1; aDSerie    = #agifa716#3; aHSerie    = #agifa716#4; |FINSI;
                     |SI nComp = 2; nDNumero   = #agifa716#5; nHNumero   = #agifa716#6; |FINSI;
                     |SI nComp = 3; aDArticulo = #agifa716#3; aDArticulo = #agifa716#4; |FINSI;
                  |FINSI;

                  |ABRE #agifa077; |ABRE #agifa079;
                  |SI nClave = 1; |BUCLE AlbLinC1; |FINSI;
                  |SI nClave = 2; |BUCLE AlbLinC2; |FINSI;
                  |SI nClave = 3; |BUCLE AlbLinC3; |FINSI;
                  |SI nClave = 4; |BUCLE AlbLinC4; |FINSI;
                  |CIERRA #agifa077; |CIERRA #agifa079;
               |FINSI;

               |SI #agifa704#16 = aFichC;
                  |SI nClave = 1;
                     |SI nComp = 1; aDSerie  = #agifa716#3; aHSerie  = #agifa716#4; |FINSI;
                     |SI nComp = 2; nDNumero = #agifa716#5; nHNumero = #agifa716#6; |FINSI;
                  |FINSI;
                  |SI nClave = 2;
                     |SI nComp = 1; aDNombreCli = #agifa716#3; aHNombreCli = #agifa716#4; |FINSI;
                  |FINSI;
                  |SI nClave = 3;
                     |SI nComp = 1; aDCodigoCli = #agifa716#3; aHCodigoCli = #agifa716#4; |FINSI;
                     |SI nComp = 2; fDFecha     = #agifa716#7; fHFecha     = #agifa716#8; |FINSI;
                     |SI nComp = 3; aDSerie     = #agifa716#3; aHSerie     = #agifa716#4; |FINSI;
                     |SI nComp = 4; nDNumero    = #agifa716#5; nHNumero    = #agifa716#6; |FINSI;
                  |FINSI;
                  |SI nClave = 4;
                     |SI nComp = 1; aDCodigoCli = #agifa716#3; aHCodigoCli = #agifa716#4; |FINSI;
                     |SI nComp = 2; aDSuAlbaran = #agifa716#3; aHSuAlbaran = #agifa716#6; |FINSI;
                  |FINSI;
                  |SI nClave = 5;
                     |SI nComp = 1; aDCodigoCli = #agifa716#3; aHCodigoCli = #agifa716#4; |FINSI;
                     |SI nComp = 2; aDFactur    = #agifa716#3; aHFactur    = #agifa716#4; |FINSI;
                     |SI nComp = 3; aDSerie     = #agifa716#3; aHSerie     = #agifa716#4; |FINSI;
                     |SI nComp = 4; nDNumero    = #agifa716#5; nHNumero    = #agifa716#6; |FINSI;
                  |FINSI;
                  |SI nClave = 6;
                     |SI nComp = 1; aDSerieF    = #agifa716#3; aHSerieF    = #agifa716#4; |FINSI;
                     |SI nComp = 2; nDNumeroF   = #agifa716#5; nHNumeroF   = #agifa716#6; |FINSI;
                     |SI nComp = 3; aDSerie     = #agifa716#3; aHSerie     = #agifa716#4; |FINSI;
                     |SI nComp = 4; nDNumero    = #agifa716#5; nHNumero    = #agifa716#6; |FINSI;
                  |FINSI;
                  |SI nClave = 7;
                     |SI nComp = 1; fDFecha     = #agifa716#7; fHFecha     = #agifa716#8; |FINSI;
                     |SI nComp = 3; aDSerie     = #agifa716#3; aHSerie     = #agifa716#4; |FINSI;
                     |SI nComp = 4; nDNumero    = #agifa716#5; nHNumero    = #agifa716#6; |FINSI;
                  |FINSI;

                  |ABRE #agifa079;
                  |SI nClave = 1; |BUCLE AlbCabC1; |FINSI;
                  |SI nClave = 2; |BUCLE AlbCabC2; |FINSI;
                  |SI nClave = 3; |BUCLE AlbCabC3; |FINSI;
                  |SI nClave = 4; |BUCLE AlbCabC4; |FINSI;
                  |SI nClave = 5; |BUCLE AlbCabC5; |FINSI;
                  |SI nClave = 6; |BUCLE AlbCabC6; |FINSI;
                  |SI nClave = 7; |BUCLE AlbCabC7; |FINSI;
                  |CIERRA #agifa079;
               |FINSI;
            |SINO;
               |SI nClave = 1;
                  |SI nComp = 1; aDSerie  = #agifa716#3; aHSerie  = #agifa716#4; |FINSI;
                  |SI nComp = 2; nDNumero = #agifa716#5; nHNumero = #agifa716#6; |FINSI;
               |FINSI;
               |SI nClave = 2;
                  |SI nComp = 1; aDCodigoCli = #agifa716#3; aHCodigoCli = #agifa716#4; |FINSI;
                  |SI nComp = 2; aDNombreCli = #agifa716#3; aHNombreCli = #agifa716#4; |FINSI;
               |FINSI;
               |SI nClave = 3;
                  |SI nComp = 1; aDImpresa   = #agifa716#3; aHImpresa   = #agifa716#4; |FINSI;
                  |SI nComp = 2; aDCodigoCli = #agifa716#3; aHCodigoCli = #agifa716#4; |FINSI;
                  |SI nComp = 3; fDFecha     = #agifa716#7; fHFecha     = #agifa716#8; |FINSI;
                  |SI nComp = 4; aDSerie     = #agifa716#3; aHSerie     = #agifa716#4; |FINSI;
                  |SI nComp = 5; nDNumero    = #agifa716#5; nHNumero    = #agifa716#6; |FINSI;
               |FINSI;
               |SI nClave = 4;
                  |SI nComp = 1; aDCodigoCli = #agifa716#3; aHCodigoCli = #agifa716#4; |FINSI;
                  |SI nComp = 2; aDReferen   = #agifa716#3; aHReferen   = #agifa716#4; |FINSI;
               |FINSI;
               |SI nClave = 5;
                  |SI nComp = 1; aDMarca     = #agifa716#3; aHMarca     = #agifa716#4; |FINSI;
                  |SI nComp = 2; aDSerie     = #agifa716#3; aHSerie     = #agifa716#4; |FINSI;
                  |SI nComp = 3; nDNumero    = #agifa716#5; nHNumero    = #agifa716#6; |FINSI;
               |FINSI;

               |SI nClave = 1; |BUCLE FacCabC1; |FINSI;
               |SI nClave = 2; |BUCLE FacCabC2; |FINSI;
               |SI nClave = 3; |BUCLE FacCabC3; |FINSI;
               |SI nClave = 4; |BUCLE FacCabC4; |FINSI;
               |SI nClave = 5; |BUCLE FacCabC5; |FINSI;
            |FINSI;
         |FINSI;
         |SI #agifa704#2 = "FD";
            |SI #agifa704#8 = "S";
               |SI nClave = 1;
                  |SI nComp = 1; aDSerie  = #agifa716#3; aHSerie  = #agifa716#4; |FINSI;
                  |SI nComp = 2; nDNumero = #agifa716#5; nHNumero = #agifa716#6; |FINSI;
                  |SI nComp = 3; nDLinea  = #agifa716#5; nHLinea  = #agifa716#6; |FINSI;
               |FINSI;
               |SI nClave = 2;
                  |SI nComp = 1; aDSerie   = #agifa716#3; aHSerie   = #agifa716#4; |FINSI;
                  |SI nComp = 2; nDNumero  = #agifa716#5; nHNumero  = #agifa716#6; |FINSI;
                  |SI nComp = 3; aDFamilia = #agifa716#3; aHFamilia = #agifa716#4; |FINSI;
               |FINSI;
               |ABRE #agifa084;
               |SI nClave = 1; |BUCLE AlbLinD1; |FINSI;
               |SI nClave = 2; |BUCLE AlbLinD2; |FINSI;
               |CIERRA #agifa084;
            |SINO;
               |SI nClave = 1;
                  |SI nComp = 1; aDSerie  = #agifa716#3; aHSerie  = #agifa716#4; |FINSI;
                  |SI nComp = 2; nDNumero = #agifa716#5; nHNumero = #agifa716#6; |FINSI;
               |FINSI;
               |SI nClave = 2;
                  |SI nComp = 1; aDNombreCli = #agifa716#3; aHNombreCli = #agifa716#4; |FINSI;
                  |SI nComp = 2; fDFecha     = #agifa716#7; fHFecha     = #agifa716#8; |FINSI;
                  |SI nComp = 3; aDSerie     = #agifa716#3; aHSerie     = #agifa716#4; |FINSI;
                  |SI nComp = 4; nDNumero    = #agifa716#5; nHNumero    = #agifa716#6; |FINSI;
               |FINSI;
               |SI nClave = 3;
                  |SI nComp = 1; aDCodigoCli = #agifa716#3; aHCodigoCli = #agifa716#4; |FINSI;
                  |SI nComp = 2; fDFecha     = #agifa716#7; fHFecha     = #agifa716#8; |FINSI;
                  |SI nComp = 3; aDSerie     = #agifa716#3; aHSerie     = #agifa716#4; |FINSI;
                  |SI nComp = 4; nDNumero    = #agifa716#5; nHNumero    = #agifa716#6; |FINSI;
               |FINSI;
               |SI nClave = 4;
                  |SI nComp = 1; aDSerie     = #agifa716#3; aHSerie     = #agifa716#4; |FINSI;
                  |SI nComp = 2; fDFecha     = #agifa716#7; fHFecha     = #agifa716#8; |FINSI;
                  |SI nComp = 3; nDNumero    = #agifa716#5; nHNumero    = #agifa716#6; |FINSI;
               |FINSI;

               |SI nClave = 1; |BUCLE FacCabD1; |FINSI;
               |SI nClave = 2; |BUCLE FacCabD2; |FINSI;
               |SI nClave = 3; |BUCLE FacCabD3; |FINSI;
               |SI nClave = 4; |BUCLE FacCabD4; |FINSI;
            |FINSI;
         |FINSI;
         |SI #agifa704#2 = "TI";
            |SI #agifa704#8 = "S";
               |SI nClave = 1;
                  |SI nComp = 1; aDSerie  = #agifa716#3; aHSerie  = #agifa716#4; |FINSI;
                  |SI nComp = 2; nDNumero = #agifa716#5; nHNumero = #agifa716#6; |FINSI;
                  |SI nComp = 3; nDLinea  = #agifa716#5; nHLinea  = #agifa716#6; |FINSI;
               |FINSI;
               |SI nClave = 2;
                  |SI nComp = 1; nDNumero  = #agifa716#5; nHNumero  = #agifa716#6; |FINSI;
                  |SI nComp = 2; aDFamilia = #agifa716#3; aHFamilia = #agifa716#4; |FINSI;
               |FINSI;
               |SI nClave = 3;
                  |SI nComp = 1; fDFecha    = #agifa716#7; fHFecha    = #agifa716#8; |FINSI;
                  |SI nComp = 2; aDFamilia  = #agifa716#3; aHFamilia  = #agifa716#4; |FINSI;
                  |SI nComp = 3; aDArticulo = #agifa716#3; aDArticulo = #agifa716#4; |FINSI;
               |FINSI;

               |SI nClave = 1; |BUCLE LinTick1; |FINSI;
               |SI nClave = 2; |BUCLE LinTick2; |FINSI;
               |SI nClave = 3; |BUCLE LinTick3; |FINSI;
            |SINO;
               |SI nClave = 1;
                  |SI nComp = 1; aDSerie  = #agifa716#3; aHSerie  = #agifa716#4; |FINSI;
                  |SI nComp = 2; nDNumero = #agifa716#5; nHNumero = #agifa716#6; |FINSI;
               |FINSI;
               |SI nClave = 2;
                  |SI nComp = 1; aDTipo      = #agifa716#3; aHTipo      = #agifa716#4; |FINSI;
                  |SI nComp = 2; aDSerie     = #agifa716#3; aHSerie     = #agifa716#4; |FINSI;
                  |SI nComp = 3; nDNumero    = #agifa716#5; nHNumero    = #agifa716#6; |FINSI;
               |FINSI;
               |SI nClave = 3;
                  |SI nComp = 1; fDFecha     = #agifa716#7; fHFecha     = #agifa716#8; |FINSI;
                  |SI nComp = 2; aDCodigoCli = #agifa716#3; aHCodigoCli = #agifa716#4; |FINSI;
                  |SI nComp = 3; aDTipo      = #agifa716#3; aHTipo      = #agifa716#4; |FINSI;
                  |SI nComp = 4; aDSerie     = #agifa716#3; aHSerie     = #agifa716#4; |FINSI;
                  |SI nComp = 5; nDNumero    = #agifa716#5; nHNumero    = #agifa716#6; |FINSI;
               |FINSI;

               |SI nClave = 1; |BUCLE CabTick1; |FINSI;
               |SI nClave = 2; |BUCLE CabTick2; |FINSI;
               |SI nClave = 3; |BUCLE CabTick3; |FINSI;
            |FINSI;
         |FINSI;
      |FINSI;
      |CIERRA #agifa716;
   |SINO;
      |SI #agifa704#16 = "agifa134"; |Y #agifa704#17 = 48;
         aAlfa = "pl" + Usuario; |NOME_DAT #501#aAlfa#; |DELINDEX #501; |ABRE #501;
         |SI aFich ! aFichC;
            aAlfa = "pc" + Usuario; |NOME_DAT #502#aAlfa#; |DELINDEX #502; |ABRE #502;
         |FINSI;

         aDSerie   = "     "; aHSerie   = "zzzzz";
         nDNumero  = "";      nHNumero  = 999999;
         aDSerieF  = "     "; aHSerieF  = "zzzzz";
         nDNumeroF = "";      nHNumeroF = 999999;
         aDContab  = " ";     aHContab  = "z";
         aAlfa = "ac" + Usuario; |NOME_DAT #agifa716#aAlfa#;
         |ABRE #agifa716;
         #agifa716#15 = #agifa704#0;
         #agifa716#0  = 1;
         |LEE 000#agifa716.];
         |PARA; |SI FSalida = 0; |Y #agifa716#15 = #agifa704#0; |HACIENDO;
            |SI #agifa716#13 = "agifa134";
               |SI #agifa716#14 = 48;
                  aDContab = #agifa716#3; aDContab  = aDContab % 0101;
                  aHContab = #agifa716#4; aHContab  = aHContab % 0101;
               |FINSI;
               |SI #agifa716#14 = 49;
                  aDSerieF  = #agifa716#3; aDSerieF  = aDSerieF % 0105;
                  aHSerieF  = #agifa716#4; aHSerieF  = aHSerieF % 0105;
               |FINSI;
               |SI #agifa716#14 = 0;
                  nDNumeroF = #agifa716#5; nHNumeroF = #agifa716#6;
               |FINSI;
            |FINSI;
            |SI #agifa716#13 = "agifa010";
               |SI #agifa716#14 = 52;
                  aDSerie  = #agifa716#3; aDSerie  = aDSerieF % 0105;
                  aHSerie  = #agifa716#4; aHSerie  = aHSerieF % 0105;
               |FINSI;
               |SI #agifa716#14 = 0;
                  nDNumero = #agifa716#5; nHNumero = #agifa716#6;
               |FINSI;
            |FINSI;
            |SI #agifa716#13 = "agifa071";
               |SI #agifa716#14 = 30;
                  aDSerieF  = #agifa716#3; aDSerieF  = aDSerieF % 0105;
                  aHSerieF  = #agifa716#4; aHSerieF  = aHSerieF % 0105;
               |FINSI;
               |SI #agifa716#14 = 26;
                  nDNumeroF = #agifa716#5; nHNumeroF = #agifa716#6;
               |FINSI;
            |FINSI;
            |LEE 000#agifa716.s;
         |SIGUE;
         |HAZ VentasContab; nClave = 0;
      |FINSI;
      |SI #agifa704#16 = "agifa079"; |Y #agifa704#17 = 48;
         aAlfa = "pl" + Usuario; |NOME_DAT #501#aAlfa#; |DELINDEX #501; |ABRE #501;
         |SI aFich ! aFichC;
            aAlfa = "pc" + Usuario; |NOME_DAT #502#aAlfa#; |DELINDEX #502; |ABRE #502;
         |FINSI;

         aDSerie   = "     "; aHSerie   = "zzzzz";
         nDNumero  = "";      nHNumero  = 999999;
         aDSerieF  = "     "; aHSerieF  = "zzzzz";
         nDNumeroF = "";      nHNumeroF = 999999;
         aDContab  = " ";     aHContab  = "z";
         aAlfa = "ac" + Usuario; |NOME_DAT #agifa716#aAlfa#;
         |ABRE #agifa716;
         #agifa716#15 = #agifa704#0;
         #agifa716#0  = 1;
         |LEE 000#agifa716.];
         |PARA; |SI FSalida = 0; |Y #agifa716#15 = #agifa704#0; |HACIENDO;
            |SI #agifa716#13 = "agifa079";
               |SI #agifa716#14 = 48;
                  aDContab = #agifa716#3; aDContab  = aDContab % 0101;
                  aHContab = #agifa716#4; aHContab  = aHContab % 0101;
               |FINSI;
               |SI #agifa716#14 = 66;
                  aDSerieF  = #agifa716#3; aDSerieF  = aDSerieF % 0105;
                  aHSerieF  = #agifa716#4; aHSerieF  = aHSerieF % 0105;
               |FINSI;
               |SI #agifa716#14 = 0;
                  nDNumeroF = #agifa716#5; nHNumeroF = #agifa716#6;
               |FINSI;
            |FINSI;
            |SI #agifa716#13 = "agifa077";
               |SI #agifa716#14 = 50;
                  aDSerie  = #agifa716#3; aDSerie  = aDSerieF % 0105;
                  aHSerie  = #agifa716#4; aHSerie  = aHSerieF % 0105;
               |FINSI;
               |SI #agifa716#14 = 0;
                  nDNumero = #agifa716#5; nHNumero = #agifa716#6;
               |FINSI;
            |FINSI;
            |LEE 000#agifa716.s;
         |SIGUE;
         |HAZ ComprasContab; nClave = 0;
      |FINSI;
   |FINSI;

   |SI aFich ! aFichC;
      |CIERRA #prelavc@; |DESCARGA_DEF #prelavc@;
   |FINSI;
   |CIERRA #prelava@; |DESCARGA_DEF #prelava@;

   |SI nClave ! 999;
      enNumRegs = nCont2;
      ||SI #agifa704#2 = "FV"; ABDON
      |SI #agifa704#2 = "FV"; |Y nSwHay = 1;
         |SI #agifa704#8 = "S";
            aAlfa = "pl" + Usuario; |NOME_DAT #agifa071#aAlfa#;
            aAlfa = "pc" + Usuario; |NOME_DAT #agifa134#aAlfa#;
         |SINO;
            aAlfa = "pl" + Usuario; |NOME_DAT #agifa134#aAlfa#;
         |FINSI;
      |FINSI;
      |SI #agifa704#2 = "FC"; |Y nSwHay = 1;
         |SI #agifa704#8 = "S";
            aAlfa = "pl" + Usuario; |NOME_DAT #agifa080#aAlfa#;
            aAlfa = "pc" + Usuario; |NOME_DAT #agifa079#aAlfa#;
         |SINO;
            aAlfa = "pl" + Usuario; |NOME_DAT #agifa079#aAlfa#;
         |FINSI;
      |FINSI;
      |SI #agifa704#2 = "FD"; |Y nSwHay = 1;
         |SI #agifa704#8 = "S";
            aAlfa = "pl" + Usuario; |NOME_DAT #agifa069#aAlfa#;
            aAlfa = "pc" + Usuario; |NOME_DAT #agifa084#aAlfa#;
         |SINO;
            aAlfa = "pl" + Usuario; |NOME_DAT #agifa084#aAlfa#;
         |FINSI;
      |FINSI;
      |SI #agifa704#2 = "TI"; |Y nSwHay = 1;
         |SI #agifa704#8 = "S";
            aAlfa = "pl" + Usuario; |NOME_DAT #agifa502#aAlfa#;
            aAlfa = "pc" + Usuario; |NOME_DAT #agifa501#aAlfa#;
         |SINO;
            aAlfa = "pl" + Usuario; |NOME_DAT #agifa501#aAlfa#;
         |FINSI;
      |FINSI;
   |SINO;
      enNumRegs = -1;
   |FINSI;

   |HORA aAlfa; |QBF aAlfa;
   #agifa731#1 = aAlfa; |PINTA #agifa731#1;
   |PINTA 1523, " Seleccionando ...";
|FPRC;

|PROCESO DameCtaAna;
     |DDEF aAlfa; |QBF aAlfa;
     aAlfa = aAlfa + "vipem006.mas";
     |CARGA_DEF aAlfa, otrodef@;
     |SI FSalida = 0;
          |ABRE #otrodef@;
          #otrodef@#0 = enEdificio;
          |LEE 000#otrodef@.=;
          |SI FSalida = 0;
               |SI #otrodef@#25 = "S"; enSwComport = 0; |FINSI;
               |SI #otrodef@#25 = "T"; enSwComport = 1; |FINSI;
          |SINO;
               enSwComport = 0;
          |FINSI;
          |CIERRA #otrodef@;
          |DESCARGA_DEF #otrodef@;
     |FINSI;
|FPRC;

|PROCESO Rectifica;
   aAlfa2 = enImporte; |QBF aAlfa2;
   |SI aAlfa2 = "-0"; enImporte = 0; |ACABA; |FINSI;

   |ABRE #agifa142;
   |LEE 000#agifa142.p;
   |SI FSalida ! 0; |DDEFECTO #agifa142; |FINSI;
   |CIERRA #agifa142;

   |SI #agifa142#13 = "            "; |ACABA; |FINSI;

   enApunt = 1;
   #caenlac@#0 = enDiario;
   #caenlac@#1 = efFecha;
   #caenlac@#2 = enDocum;
   |LEE 000#caenlac@.=;
   |PARA; |SI FSalida = 0; |Y #caenlac@#0 = enDiario; |Y #caenlac@#1 = efFecha; |Y #caenlac@#2 = enDocum; |HACIENDO;
      enApunt = #caenlac@#3 + 10;
      |LEE 000#caenlac@.s;
   |SIGUE;

   #caenlac@#0  = enDiario;
   #caenlac@#1  = efFecha;
   #caenlac@#2  = enDocum;
   #caenlac@#37 = enEmpresa;
   #caenlac@#38 = enPeriodo;
   #caenlac@#3  = 1;
   |LEE 000#caenlac@.];
   |PARA; |SI FSalida = 0; |Y #caenlac@#0 = enDiario; |Y #caenlac@#1 = efFecha;
           |Y #caenlac@#2 = enDocum; |Y #caenlac@#37 = enEmpresa; |Y #caenlac@#38 = enPeriodo;
           |HACIENDO;
      nLineaApunte = #caenlac@#3 + 1;
      |LEE 000#caenlac@.s;
   |SIGUE;

   #caenlac@#0 = enDiario;
   #caenlac@#1 = efFecha;
   #caenlac@#2 = enDocum;
   #caenlac@#37 = enEmpresa;
   #caenlac@#38 = enPeriodo;
   #caenlac@#3 = nLineaApunte;
   |GRABA 020#caenlac@.b;
   #caenlac@#4 = #agifa142#13;
   #caenlac@#6 = 1;
   #caenlac@#7 = "Cuadre automatico";
   |SI enImporte < 0;
      #caenlac@#8 = "D";
      #caenlac@#9 = -enImporte;
   |SINO;
      #caenlac@#8 = "H";
      #caenlac@#9 = enImporte;
   |FINSI;
   #caenlac@#26 = "";
   #caenlac@#27 = 0;
   #caenlac@#28 = 0;
   #caenlac@#27 = 0;
   #caenlac@#41 = 0;
   #caenlac@#42 = 0;
   |GRABA 020#caenlac@.a;

   enImporte = 0;
   eaTipoAviso = "A"; eaAviso = "El asiento ";
   eaAviso = eaAviso + (("00" + #caenlac@#0) % -102) + "/" + #caenlac@#1 + "/";
   eaAviso = eaAviso + (("00000" + #caenlac@#2) % -105);
   eaAviso = eaAviso + " estaba descuadrado y se ha cuadrado automaticamente.";
   |HAZ AnadeAviso;
|FPRC;

|PROCESO Reemplaza;
   |ABRE #agifa142;
   |LEE 000#agifa142.p;
   |SI FSalida ! 0; |DDEFECTO #agifa142; |FINSI;
   |CIERRA #agifa142;

   |SI #agifa142#13 ! "            ";
      eaCuenta = #agifa142#13;
   |FINSI;
|FPRC;

|PROCESO Inicia732;
   aAlfa = eaRuta - "fich/";
   |SI FSalida ! 0;
      nCalc = ((FSalida / 100) ! 0) + 99;
      aAlfa = eaRuta % nCalc;
      aAlfa = aAlfa + "def/caw000a0.mas";
   |SINO;
      |DDEF aAlfa; |QBF aAlfa;
      aAlfa = aAlfa + "agifa732.mas";
   |FINSI;

   |CARGA_DEF aAlfa, Fich732@;
   |SI FSalida = 0;
      nFich732 = 1;
      |PATH_DAT #Fich732@#eaRuta#;
      aAlfa = "er" + Usuario; |NOME_DAT #Fich732@#aAlfa#;
      |DELINDEX #Fich732@; |ABRE #Fich732@;
   |SINO;
      nFich732 = 0;
      aAlfa = "    Problemas para abrir el fichero " + aAlfa;
      |MENAV aAlfa;
   |FINSI;
|FPRC;

|PROCESO Finaliza732;
   |SI nFich732 = 1;
      |CIERRA #Fich732@; |DELINDEX #Fich732@;
      |DESCARGA_DEF #Fich732@;
   |FINSI;
|FPRC;

|PROCESO AnadeAviso;
   |SI nFich732 = 0; |ACABA; |FINSI;

   |LEE 000#Fich732@.u; nCalc1 = #Fich732@#0;
   |DDEFECTO #Fich732@;
   #Fich732@#0 = nCalc1 + 1;
   #Fich732@#1 = eaTipoAviso;
   #Fich732@#2 = eaAviso;
   |GRABA 020#Fich732@.n;
|FPRC;

|PROCESO MiraSiCuaAuto;
   |ABRE #dsm00279;
   |LEE 000#dsm00279.p;
   |SI FSalida ! 0; |DDEFECTO #dsm00279; |FINSI;
   |CIERRA #dsm00279;

   eaCuaAuto = #dsm00279#5;
|FPRC;

|PROCESO LeeAgifa019;
   |ABRE #agifa019;
   |DDEFECTO #agifa019;
   #agifa019#0 = eaArticulo;
   |LEE 000#agifa019.=;
   |SI FSalida = 0;
      |ABRE #agifa060;
      |DDEFECTO #agifa060;
      #agifa060#0 = #agifa019#2;
      |LEE 000#agifa060.=;
      |SI FSalida = 0;
         |SI eaTipoEnl ! "FC";
            eaCuenta = #agifa060#2;   || Ventas
         |SINO;
            eaCuenta = #agifa060#3;   || Compras
         |FINSI;
      |FINSI;
      |CIERRA #agifa060;
   |FINSI;
   |CIERRA #agifa019;
|FPRC;

|PROCESO BuscaCtaLuxe;
   |DBASS aAlfa; |QBF aAlfa;

   aAlfa1 = aAlfa + "compaq4/def/lxem0019.mas";
   |CARGA_DEF aAlfa1, lxem0019@;
   |SI FSalida = 0;
      aAlfa1 = aAlfa + "compaq4/def/lxem0014.mas";
      |CARGA_DEF aAlfa1, lxem0014@;

      aAlfa1 = aAlfa + "compaq4/def/lxem0018.mas";
      |CARGA_DEF aAlfa1, lxem0018@;

      aAlfa1 = aAlfa + "compaq4/def/lxem0020.mas";
      |CARGA_DEF aAlfa1, lxem0020@;

      aAlfa1 = aAlfa + "compaq4/def/lxem0027.mas";
      |CARGA_DEF aAlfa1, lxem0027@;

      aAlfa1 = aAlfa + "compaq4/def/lxem0006.mas";
      |CARGA_DEF aAlfa1, lxem0006@;

      aAlfa1 = aAlfa + "compaq4/def/lxem0007.mas";
      |CARGA_DEF aAlfa1, lxem0007@;

      aAlfa1 = aAlfa + "compaq4/def/lxem0008.mas";
      |CARGA_DEF aAlfa1, lxem0008@;

      aAlfa1 = #48#0; |QBF aAlfa1; aAlfa1 = (("00" + aAlfa1) % -102);
      aAlfa1 = aAlfa + "compaq4/fich/" + aAlfa1 + "/";
      |PATH_DAT #lxem0027@#aAlfa1#; |ABRE #lxem0027@;
      |PATH_DAT #lxem0020@#aAlfa1#; |ABRE #lxem0020@;
      |PATH_DAT #lxem0018@#aAlfa1#; |ABRE #lxem0018@;
      |PATH_DAT #lxem0014@#aAlfa1#; |ABRE #lxem0014@;
      |PATH_DAT #lxem0019@#aAlfa1#; |ABRE #lxem0019@;
      |PATH_DAT #lxem0006@#aAlfa1#; |ABRE #lxem0006@;
      |PATH_DAT #lxem0007@#aAlfa1#; |ABRE #lxem0007@;
      |PATH_DAT #lxem0008@#aAlfa1#; |ABRE #lxem0008@;

      |SELECT #2#lxem0019@; |SELECT #2#lxem0018@;
      |SELECT #2#lxem0006@;
      |SELECT #2#lxem0007@;
      |SELECT #3#lxem0008@;
      |SELECT #3#lxem0020@;

      aCodSubAgrup = "";

      #lxem0019@#4 = eaArticulo;
      |LEE 000#lxem0019@.=;
      |SI FSalida = 0;
         |SI eaTipoEnl ! "FC";
            aAlfa = #lxem0019@#12; |QBF aAlfa;
            |SI aAlfa ! "";
               eaCuenta = #lxem0019@#12; |QBF eaCuenta; |VETE Final;
            |FINSI;
         |FINSI;

         #lxem0014@#0 = #lxem0019@#0;
         |LEE 000#lxem0014@.=;
         |SI FSalida = 0;
            |SI #lxem0014@#8 = "N";
                 aCodSubAgrup = #lxem0014@#15;
            |FINSI;
            |SI #lxem0014@#8 = "S";
                 |SI eaTipoEnl ! "FC";
                       ||Vtas
                       ||lxem0007
                       #lxem0007@#0 = #lxem0014@#2;
                       #lxem0007@#4 = #lxem0019@#2;
                       |LEE 000#lxem0007@.=;
                       |SI FSalida = 0;
                            aCodSubAgrup = #lxem0007@#3;
                       |FINSI;
                 |SINO;
                       ||Cpas
                       ||lxem0008
                       #lxem0008@#0 = #lxem0014@#2;
                       #lxem0008@#4 = eaProveedor;
                       #lxem0008@#6 = #lxem0019@#2;
                       |LEE 000#lxem0008@.=;
                       |SI FSalida = 0;
                            aCodSubAgrup = #lxem0008@#3;
                       |FINSI;
                 |FINSI;
            |FINSI;
            aAlfa = aCodSubAgrup;
            |QBF aAlfa;
            |SI aCodSubAgrup = "";
               |SELECT #1#lxem0006@;
               #lxem0006@#0 = #lxem0014@#2;
               #lxem0006@#1 = 1;
               |LEE 000#lxem0006@.];
               |PARA; |SI; |HACIENDO;
                    |SI FSalida = 0; |Y #lxem0006@#0 = #lxem0014@#2;
                         |SI #lxem0006@#8 = "S";
                              aCodSubAgrup = #lxem0006@#2;
                              |SAL;
                         |FINSI;
                    |SINO;
                         |SAL;
                    |FINSI;
                    |LEE 000#lxem0006@.s;
               |SIGUE;

               |SELECT #2#lxem0006@;
            |FINSI;


            |SI eaTipoEnl = "FC";
               |SI #lxem0014@#29 ! "N";
                  #lxem0027@#0 = #lxem0014@#0;
                  #lxem0027@#1 = aCodSubAgrup;
                  #lxem0027@#3 = eaProveedor;
                  |LEE 000#lxem0027@.=;
                  |SI FSalida = 0;
                     aAlfa = #lxem0027@#6; |QBF aAlfa;
                     |SI aAlfa ! "";
                        eaCuenta = #lxem0027@#6; |QBF eaCuenta; |VETE Final;
                     |SINO;
                        #lxem0006@#0 = #lxem0014@#2;
                        #lxem0006@#2 = aCodSubAgrup;
                        |LEE 000#lxem0006@.=;
                        |SI FSalida = 0;
                           eaCuenta = #lxem0006@#13; |QBF eaCuenta; |VETE Final;
                        |FINSI;
                     |FINSI;
                  |SINO;
                     #lxem0006@#0 = #lxem0014@#2;
                     #lxem0006@#2 = aCodSubAgrup;
                     |LEE 000#lxem0006@.=;
                     |SI FSalida = 0;
                        eaCuenta = #lxem0006@#13; |QBF eaCuenta; |VETE Final;
                     |FINSI;
                  |FINSI;
               |SINO;
                  #lxem0020@#0 = #lxem0014@#0;
                  #lxem0020@#3 = aCodSubAgrup;
                  #lxem0020@#5 = eaProveedor;
                  |LEE 000#lxem0020@.=;
                  |SI FSalida = 0;
                     aAlfa = #lxem0020@#16; |QBF aAlfa;
                     |SI aAlfa ! "";
                        eaCuenta = #lxem0020@#16; |QBF eaCuenta; |VETE Final;
                     |SINO;
                        #lxem0006@#0 = #lxem0014@#2;
                        #lxem0006@#2 = aCodSubAgrup;
                        |LEE 000#lxem0006@.=;
                        |SI FSalida = 0;
                           eaCuenta = #lxem0006@#13; |QBF eaCuenta; |VETE Final;
                        |FINSI;
                     |FINSI;
                  |SINO;
                     #lxem0006@#0 = #lxem0014@#2;
                     #lxem0006@#2 = aCodSubAgrup;
                     |LEE 000#lxem0006@.=;
                     |SI FSalida = 0;
                        eaCuenta = #lxem0006@#13; |QBF eaCuenta; |VETE Final;
                     |FINSI;
                  |FINSI;
               |FINSI;
            |SINO;
               #lxem0018@#0 = #lxem0014@#0;
               #lxem0018@#2 = #lxem0014@#2;
               #lxem0018@#3 = aCodSubAgrup;
               |LEE 000#lxem0018@.=;
               |SI FSalida = 0;
                  aAlfa = #lxem0018@#26; |QBF aAlfa;
                  |SI aAlfa ! "";
                     eaCuenta = #lxem0018@#26; |QBF eaCuenta; |VETE Final;
                  |SINO;
                     #lxem0006@#0 = #lxem0014@#2;
                     #lxem0006@#2 = aCodSubAgrup;
                     |LEE 000#lxem0006@.=;
                     |SI FSalida = 0;
                        eaCuenta = #lxem0006@#12; |QBF eaCuenta; |VETE Final;
                     |FINSI;
                  |FINSI;
               |SINO;
                  #lxem0006@#0 = #lxem0014@#2;
                  #lxem0006@#2 = aCodSubAgrup;
                  |LEE 000#lxem0006@.=;
                  |SI FSalida = 0;
                     eaCuenta = #lxem0006@#12; |QBF eaCuenta; |VETE Final;
                  |FINSI;
               |FINSI;
            |FINSI;
         |FINSI;
      |SINO;
         ||No existe el articulo en lxem0019.  Tengo que buscar directamente en lxem0014

         #lxem0014@#0 = eaArticulo;
         |LEE 000#lxem0014@.=;
         |SI FSalida = 0; |Y #lxem0014@#8 = "N";
            aCodSubAgrup = #lxem0014@#15;
         |SINO;
            aAlfa = eaArticulo;
            |QBF aAlfa;
            aAlfa = aAlfa % 0;

            nCon = aAlfa;
            nCon = nCon - 4 + 100;
            aAlfa = eaArticulo;
            |QBF aAlfa;
            aAlfa = aAlfa % nCon;

            #lxem0014@#0 = aAlfa;
            |LEE 000#lxem0014@.=;
            |SI FSalida = 0;
                 aColor = eaArticulo;
                 |QBF aColor;
                 aColor = aColor % -104;
                 |SI eaTipoEnl ! "FC";
                       ||Vtas
                       ||lxem0007
                       #lxem0007@#0 = #lxem0014@#2;
                       #lxem0007@#4 = aColor;
                       |LEE 000#lxem0007@.=;
                       |SI FSalida = 0;
                            aCodSubAgrup = #lxem0007@#3;
                       |FINSI;
                 |SINO;
                       ||Cpas
                       ||lxem0008
                       #lxem0008@#0 = #lxem0014@#2;
                       #lxem0008@#4 = eaProveedor;
                       #lxem0008@#6 = aColor;
                       |LEE 000#lxem0008@.=;
                       |SI FSalida = 0;
                            aCodSubAgrup = #lxem0008@#3;
                       |FINSI;
                 |FINSI;
            |FINSI;
         |FINSI;
         aAlfa = aCodSubAgrup;
         |QBF aAlfa;
         |SI aCodSubAgrup = "";
            |SELECT #1#lxem0006@;
            #lxem0006@#0 = #lxem0014@#2;
            #lxem0006@#1 = 1;
            |LEE 000#lxem0006@.];
            |PARA; |SI; |HACIENDO;
                 |SI FSalida = 0; |Y #lxem0006@#0 = #lxem0014@#2;
                      |SI #lxem0006@#8 = "S";
                           aCodSubAgrup = #lxem0006@#2;
                           |SAL;
                      |FINSI;
                 |SINO;
                      |SAL;
                 |FINSI;
                 |LEE 000#lxem0006@.s;
            |SIGUE;

            |SELECT #2#lxem0006@;
         |FINSI;

         |SI eaTipoEnl = "FC";
            |SI #lxem0014@#29 ! "N";
               #lxem0027@#0 = #lxem0014@#0;
               #lxem0027@#1 = aCodSubAgrup;
               #lxem0027@#3 = eaProveedor;
               |LEE 000#lxem0027@.=;
               |SI FSalida = 0;
                  aAlfa = #lxem0027@#6; |QBF aAlfa;
                  |SI aAlfa ! "";
                     eaCuenta = #lxem0027@#6; |QBF eaCuenta; |VETE Final;
                  |SINO;
                     #lxem0006@#0 = #lxem0014@#2;
                     #lxem0006@#2 = aCodSubAgrup;
                     |LEE 000#lxem0006@.=;
                     |SI FSalida = 0;
                        eaCuenta = #lxem0006@#13; |QBF eaCuenta; |VETE Final;
                     |FINSI;
                  |FINSI;
               |SINO;
                  #lxem0006@#0 = #lxem0014@#2;
                  #lxem0006@#2 = aCodSubAgrup;
                  |LEE 000#lxem0006@.=;
                  |SI FSalida = 0;
                     eaCuenta = #lxem0006@#13; |QBF eaCuenta; |VETE Final;
                  |FINSI;
               |FINSI;
            |SINO;
               #lxem0020@#0 = #lxem0014@#0;
               #lxem0020@#3 = aCodSubAgrup;
               #lxem0020@#5 = eaProveedor;
               |LEE 000#lxem0020@.=;
               |SI FSalida = 0;
                  aAlfa = #lxem0020@#16; |QBF aAlfa;
                  |SI aAlfa ! "";
                     eaCuenta = #lxem0020@#16; |QBF eaCuenta; |VETE Final;
                  |SINO;
                     #lxem0006@#0 = #lxem0014@#2;
                     #lxem0006@#2 = aCodSubAgrup;
                     |LEE 000#lxem0006@.=;
                     |SI FSalida = 0;
                        eaCuenta = #lxem0006@#13; |QBF eaCuenta; |VETE Final;
                     |FINSI;
                  |FINSI;
               |SINO;
                  #lxem0006@#0 = #lxem0014@#2;
                  #lxem0006@#2 = aCodSubAgrup;
                  |LEE 000#lxem0006@.=;
                  |SI FSalida = 0;
                     eaCuenta = #lxem0006@#13; |QBF eaCuenta; |VETE Final;
                  |FINSI;
               |FINSI;
            |FINSI;
         |SINO;
            #lxem0018@#0 = #lxem0014@#0;
            #lxem0018@#2 = #lxem0014@#2;
            #lxem0018@#3 = aCodSubAgrup;
            |LEE 000#lxem0018@.=;
            |SI FSalida = 0;
               aAlfa = #lxem0018@#26; |QBF aAlfa;
               |SI aAlfa ! "";
                  eaCuenta = #lxem0018@#26; |QBF eaCuenta; |VETE Final;
               |SINO;
                  #lxem0006@#0 = #lxem0014@#2;
                  #lxem0006@#2 = aCodSubAgrup;
                  |LEE 000#lxem0006@.=;
                  |SI FSalida = 0;
                     eaCuenta = #lxem0006@#12; |QBF eaCuenta; |VETE Final;
                  |FINSI;
               |FINSI;
            |SINO;
               #lxem0006@#0 = #lxem0014@#2;
               #lxem0006@#2 = aCodSubAgrup;
               |LEE 000#lxem0006@.=;
               |SI FSalida = 0;
                  eaCuenta = #lxem0006@#12; |QBF eaCuenta; |VETE Final;
               |FINSI;
            |FINSI;
         |FINSI;
      |FINSI;

|ET Final;
      aAlfa = eaCuenta; |QBF aAlfa;
      |SI aAlfa = "";
           |ABRE #agifa142;
           |LEE 000#agifa142.p;
           |SI FSalida ! 0; |DDEFECTO #agifa142; |FINSI;
           |CIERRA #agifa142;

           ||Tiquet 1483/683
           ||eaCuenta = "555000010";
           |SI #agifa142#13 ! "            ";
              eaCuenta = #agifa142#13;
           |FINSI;

           |HAZ LeeAgifa019;
      |FINSI;

      |SELECT #1#lxem0019@; |SELECT #1#lxem0018@;
      |SELECT #1#lxem0006@;
      |SELECT #1#lxem0007@;
      |SELECT #1#lxem0008@;

      |CIERRA #lxem0008@; |DESCARGA_DEF #lxem0008@;
      |CIERRA #lxem0007@; |DESCARGA_DEF #lxem0007@;
      |CIERRA #lxem0006@; |DESCARGA_DEF #lxem0006@;
      |CIERRA #lxem0027@; |DESCARGA_DEF #lxem0027@;
      |CIERRA #lxem0020@; |DESCARGA_DEF #lxem0020@;
      |CIERRA #lxem0018@; |DESCARGA_DEF #lxem0018@;
      |CIERRA #lxem0014@; |DESCARGA_DEF #lxem0014@;
      |CIERRA #lxem0019@; |DESCARGA_DEF #lxem0019@;
   |FINSI;
|FPRC;

|PROCESO BuscaCtaRevision;
   eaCuenta = "";
   |HAZ EsOTP;
   |SI FSalida = 0;
      |DBASS aBase;  |QBF aBase;
      aMas = aBase + "dspreven/def/pycm0011.mas";
      |XABRE "E", aMas, 0;
      |SI FSalida ] 0;
         aMas = aBase + "dspreven/def/visal000.mas";
         |CARGA_DEF aMas, RefOTP0@;
         |SI FSalida = 0;
            aEmpresa = "00000";
            aAlfa = aBase + "dspreven/fich/"; |PATH_DAT #RefOTP0@#aAlfa#;
            |ABRE #RefOTP0@;
            |SELECT #2#RefOTP0@;
            #RefOTP0@#3 = "S";
            |LEE 000#RefOTP0@.=;
            |SI FSalida = 0;
               aEmpresa = ("00000" + #RefOTP0@#0) % -105;
            |FINSI;
            |CIERRA #RefOTP0@; |DESCARGA_DEF #RefOTP0@;
            |SI aEmpresa ! "00000";
               aMas = aBase + "dspreven/def/pycm0011.mas";
               |CARGA_DEF aMas, RefOTP0@;
               |SI FSalida = 0;
                  nNumCto = 0;
                  aAlfa = aBase + "dspreven/fich/" + aEmpresa + "/";
                  |PATH_DAT #RefOTP0@#aAlfa#;
                  |ABRE #RefOTP0@; |SELECT #3#RefOTP0@;
                  #RefOTP0@#9  = eaSerie;
                  #RefOTP0@#10 = enFactura;
                  |LEE 000#RefOTP0@.=;
                  |SI FSalida = 0; nNumCto = #RefOTP0@#0; |FINSI;

                  |SI nNumCto = 0;
                     |SELECT #3#RefOTP0@;
                     #RefOTP0@#11 = eaSerie;
                     #RefOTP0@#12 = enFactura;
                     |LEE 000#RefOTP0@.=;
                     |SI FSalida = 0; nNumCto = #RefOTP0@#0; |FINSI;
                  |FINSI;
                  |CIERRA #RefOTP0@; |DESCARGA_DEF #RefOTP0@;

                  |SI nNumCto ! 0;
                     aMas = aBase + "dspreven/def/pycm0007.mas";
                     |CARGA_DEF aMas, RefOTP0@;
                     |SI FSalida = 0;
                        aAlfa = aBase + "dspreven/fich/" + aEmpresa + "/";
                        |PATH_DAT #RefOTP0@#aAlfa#;
                        |ABRE #RefOTP0@;
                        #RefOTP0@#0 = nNumCto;
                        |LEE 000#RefOTP0@.=;
                        |SI FSalida = 0; |Y #RefOTP0@#109 ! 0;
                           |DDEF aMas; |QBF aMas;
                           aMas = aMas + "otpm0004.mas";
                           |CARGA_DEF aMas, otpm004@;
                           |SI FSalida = 0;
                              |DFICE aAlfa; |QBF aAlfa;
                              |PATH_DAT #otpm004@#aAlfa#;
                              |ABRE #otpm004@;
                              #otpm004@#0 = eaFamilia;
                              |LEE 000#otpm004@.=;
                              |SI FSalida = 0;
                                 eaCuenta = #otpm004@#1;
                              |FINSI;
                              |CIERRA #otpm004@; |DESCARGA_DEF #otpm004@;
                           |FINSI;
                        |FINSI;
                        |CIERRA #RefOTP0@; |DESCARGA_DEF #RefOTP0@;
                     |FINSI;
                  |FINSI;
               |FINSI;
            |FINSI;
         |FINSI;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO GrabaIva;

   |SI nClPr = 0;
       |HAZ SacaIVA;
   |SINO;
       |SI nClPr = 1; |HAZ IVACli; |FINSI;
       |SI nClPr = 2; |HAZ IVAPrv; |FINSI;
   |FINSI;

   #agifa715#0 = "agifa066";
   #agifa715#1 = 0;
   |LEE 000#agifa715.=;
   |SI FSalida ! 0;
      |DDEFECTO #agifa715;
      #agifa715#0 = "agifa066";
      #agifa715#1 = 0;
      |GRABA 020#agifa715.c;
   |FINSI;
   #agifa715#2 = "N";
   #agifa715#4 = enTiva;
   #agifa715#6 = 1;
   |GRABA 020#agifa715.a;
   #agifa715#0 = "agifa066";
   #agifa715#1 = 2;
   |LEE 000#agifa715.=;
   |SI FSalida ! 0;
      |DDEFECTO #agifa715;
      #agifa715#0 = "agifa066";
      #agifa715#1 = 2;
      |GRABA 020#agifa715.c;
   |FINSI;
   #agifa715#2 = "N";
   #agifa715#4 = enIva;
   #agifa715#6 = 5;
   |GRABA 020#agifa715.a;
   #agifa715#0 = "agifa066";
   #agifa715#1 = 3;
   |LEE 000#agifa715.=;
   |SI FSalida ! 0;
      |DDEFECTO #agifa715;
      #agifa715#0 = "agifa066";
      #agifa715#1 = 3;
      |GRABA 020#agifa715.c;
   |FINSI;
   #agifa715#2 = "N";
   #agifa715#4 = enRec;
   #agifa715#6 = 5;
   |GRABA 020#agifa715.a;

   nClPr = 0;
   eaCli = "";
   eaPrv = "";
|FPRC;

|PROCESO AnadeMas;
|| Una vez acabado el ResuelveRels vemos si hay que incluir algun dato mas,
||    como por ejemplo en el modulo de Palm Hoteles Mediterraneo que necesita
||    sacar informacion de un fichero con el que ningun fichero esta relacionado
   |HAZ EsPalmHotel;
   |SI FSalida = 0;
      |ABRE #agifa715;

      |DDEF aAlfa3; |QBF aAlfa3;
      aAlfa3 = aAlfa3 + "palmhm01.mas";
      |CARGA_DEF aAlfa3, Refere1@;
      |SI FSalida = 0;
         |DFICE aAlfa3; |QBF aAlfa3; |PATH_DAT #Refere1@#aAlfa3#;
         |ABRE #Refere1@;
         |DDEFECTO #Refere1@;

         #agifa715#0 = "agifa029";
         #agifa715#1 = 0;
         |LEE 000#agifa715.=;
         |SI FSalida = 0;
            #Refere1@#0 = #agifa715#4;
         |FINSI;

         #agifa715#0 = "agifa060";
         #agifa715#1 = 0;
         |LEE 000#agifa715.=;
         |SI FSalida = 0;
            #Refere1@#1 = #agifa715#3;
         |FINSI;

         |LEE 000#Refere1@.=;
         |SI FSalida = 0;
            aAlfa3 = "|NC"; aAlfa3 = #Refere1@#aAlfa3#;
            nCalc2 = aAlfa3; nCalc2 = nCalc2 - 1;
            |PARA; |SI nCalc2 ] 0; |HACIENDO nCalc2 = nCalc2 - 1;
               |DDEFECTO #agifa715;
               #agifa715#0 = "palmhm01";
               #agifa715#1 = nCalc2;
               aAlfa3 = ("000" + nCalc2) % -103;
               aAlfa3 = "|C" + aAlfa3 + "TIPO";
               aAlfa3 = #Refere1@#aAlfa3#;
               #agifa715#2 = aAlfa3;
               |SI aAlfa3 = "A";  #agifa715#3 = #Refere1@#nCalc2#; |FINSI;
               |SI aAlfa3 = "N";  #agifa715#4 = #Refere1@#nCalc2#; |FINSI;
               |SI aAlfa3 = "F";  #agifa715#5 = #Refere1@#nCalc2#; |FINSI;
               aAlfa3 = ("000" + nCalc2) % -103;
               aAlfa3 = "|C" + aAlfa3 + "LONGITUD";
               #agifa715#6 = #Refere1@#aAlfa3#;
               |GRABA 020#agifa715.n;
            |SIGUE;
         |FINSI;

         |CIERRA #Refere1@; |DESCARGA_DEF #Refere1@;
      |FINSI;
/*
      nSwEnlaceFacFict = 0;
      |ABRE #agifa716;
      #agifa716#15 = CodEnlace;
      #agifa716#0  = 1;
      |LEE 000#agifa716.];
      |PARA; |SI FSalida = 0; |Y #agifa716#15 = CodEnlace; |HACIENDO;
         |SI #agifa716#13 = "agifa077";
            |SI #agifa716#14 = 51;
               aAlfa = #agifa716#3; |QBF aAlfa;
               aAlfa = aAlfa % 0101;
               |SI aAlfa = "Z";
                  aAlfa = #agifa716#4; |QBF aAlfa;
                  aAlfa = aAlfa % 0101;
                  |SI aAlfa = "Z";
                     nSwEnlaceFacFict = 1;
                     |SAL;
                  |FINSI;
               |FINSI;
            |FINSI;
         |FINSI;
         |SI #agifa716#13 = "agifa080";
            |SI #agifa716#14 = 28;
               aAlfa = #agifa716#3; |QBF aAlfa;
               aAlfa = aAlfa % 0101;
               |SI aAlfa = "Z";
                  aAlfa = #agifa716#4; |QBF aAlfa;
                  aAlfa = aAlfa % 0101;
                  |SI aAlfa = "Z";
                     nSwEnlaceFacFict = 1;
                     |SAL;
                  |FINSI;
               |FINSI;
            |FINSI;
         |FINSI;

         |LEE 000#agifa716.s;
      |SIGUE;
      |CIERRA #agifa716;

      |SI nSwEnlaceFacFict = 1;
         |DDEF aAlfa3; |QBF aAlfa3;
         aAlfa3 = aAlfa3 + "agifa079.mas";
         |CARGA_DEF aAlfa3, Refere1@;
         |SI FSalida = 0;
            |DFICE aAlfa3; |QBF aAlfa3; |PATH_DAT #Refere1@#aAlfa3#;
            |ABRE #Refere1@;
            |DDEFECTO #Refere1@;

            #agifa715#0 = "agifa077";
            #agifa715#1 = 50;
            |LEE 000#agifa715.=;
            |SI FSalida ! 0;
               #agifa715#0 = "agifa080";
               #agifa715#1 = 27;
               |LEE 000#agifa715.=;
               |SI FSalida ! 0; |DDEFECTO #agifa715; |FINSI;
            |FINSI;
            aAlfa = #agifa715#3; |QBF aAlfa; aAlfa = "Z" + aAlfa;
            #Refere1@#66 = aAlfa; || Serie Albaran mas la Z

            #agifa715#0 = "agifa077";
            #agifa715#1 = 0;
            |LEE 000#agifa715.=;
            |SI FSalida ! 0;
               #agifa715#0 = "agifa080";
               #agifa715#1 = 0;
               |LEE 000#agifa715.=;
               |SI FSalida ! 0; |DDEFECTO #agifa715; |FINSI;
            |FINSI;
            #Refere1@#0 = #agifa715#4;

            |LEE 000#Refere1@.=;
            |SI FSalida = 0;
               || Incluyo la fecha de la factura ficticia si es el enlace de
               ||      facturas ficticias
               #agifa715#0 = "agifa079";
               #agifa715#1 = 1;
               |LEE 000#agifa715.=;
               |SI FSalida ! 0;
                  |DDEFECTO #agifa715;
                  #agifa715#0 = "agifa079";
                  #agifa715#1 = 1;
                  |GRABA 020#agifa715.c;
               |FINSI;
               #agifa715#2 = "F";
               #agifa715#5 = #Refere1@#1;
               #agifa715#6 = 10;
               |GRABA 020#agifa715.a;

               || Incluyo el campo 'Contabilizada' de la factura ficticia si es el
               ||      enlace de facturas ficticias
               #agifa715#0 = "agifa079";
               #agifa715#1 = 48;
               |LEE 000#agifa715.=;
               |SI FSalida ! 0;
                  |DDEFECTO #agifa715;
                  #agifa715#0 = "agifa079";
                  #agifa715#1 = 48;
                  |GRABA 020#agifa715.c;
               |FINSI;
               #agifa715#2 = "A";
               #agifa715#3 = #Refere1@#48;
               #agifa715#6 = 1;
               |GRABA 020#agifa715.a;
            |FINSI;
            |CIERRA #Refere1@; |DESCARGA_DEF #Refere1@;
         |FINSI;
      |FINSI;
*/
      |CIERRA #agifa715;
   |FINSI;

   |ABRE #agifa715;
   #agifa715#0 = "agifa071";
   #agifa715#1 = 11;
   |LEE 000#agifa715.=;
   |SI FSalida = 0;
      |DDEF aAlfa3; |QBF aAlfa3;
      aAlfa3 = aAlfa3 + "agifa071.mas";
      |CARGA_DEF aAlfa3, Refere1@;
      |SI FSalida = 0;
         |DFICE aAlfa3; |QBF aAlfa3; |PATH_DAT #Refere1@#aAlfa3#;
         |ABRE #Refere1@;

         #agifa715#0 = "agifa071"; #agifa715#1 = 29; |LEE 000#agifa715.=; |SI FSalida ! 0; |DDEFECTO #agifa715; |FINSI;
         #Refere1@#29 = #agifa715#3;
         #agifa715#0 = "agifa071"; #agifa715#1 = 0; |LEE 000#agifa715.=; |SI FSalida ! 0; |DDEFECTO #agifa715; |FINSI;
         #Refere1@#0 = #agifa715#4;
         #agifa715#0 = "agifa071"; #agifa715#1 = 1; |LEE 000#agifa715.=; |SI FSalida ! 0; |DDEFECTO #agifa715; |FINSI;
         #Refere1@#1 = #agifa715#4;
         |LEE 000#Refere1@.=;
         |SI FSalida = 0;
            enTiva = #Refere1@#11;
            eaCli  = #Refere1@#15;
            nClPr  = 1;
         |FINSI;

         |CIERRA #Refere1@; |DESCARGA_DEF #Refere1@;
      |FINSI;
      |DDEF aAlfa3; |QBF aAlfa3;
      aAlfa3 = aAlfa3 + "agifa010.mas";
      |CARGA_DEF aAlfa3, Refere1@;
      |SI FSalida = 0;
         |DFICE aAlfa3; |QBF aAlfa3; |PATH_DAT #Refere1@#aAlfa3#;
         |ABRE #Refere1@;
         #agifa715#0 = "agifa071"; #agifa715#1 = 29; |LEE 000#agifa715.=; |SI FSalida ! 0; |DDEFECTO #agifa715; |FINSI;
         #Refere1@#52 = #agifa715#3;
         #agifa715#0 = "agifa071"; #agifa715#1 = 0; |LEE 000#agifa715.=; |SI FSalida ! 0; |DDEFECTO #agifa715; |FINSI;
         #Refere1@#0 = #agifa715#4;
         |LEE 000#Refere1@.=;
         |SI FSalida = 0;
            efFiva = #Refere1@#1;
         |FINSI;

         |CIERRA #Refere1@; |DESCARGA_DEF #Refere1@;
      |FINSI;

      |HAZ GrabaIva;
   |FINSI;

   #agifa715#0 = "agifa080";
   #agifa715#1 = 11;
   |LEE 000#agifa715.=;
   |SI FSalida = 0;
      |DDEF aAlfa3; |QBF aAlfa3;
      aAlfa3 = aAlfa3 + "agifa080.mas";
      |CARGA_DEF aAlfa3, Refere1@;
      |SI FSalida = 0;
         |DFICE aAlfa3; |QBF aAlfa3; |PATH_DAT #Refere1@#aAlfa3#;
         |ABRE #Refere1@;

         #agifa715#0 = "agifa080"; #agifa715#1 = 27; |LEE 000#agifa715.=; |SI FSalida ! 0; |DDEFECTO #agifa715; |FINSI;
         #Refere1@#27 = #agifa715#3;
         #agifa715#0 = "agifa080"; #agifa715#1 = 0; |LEE 000#agifa715.=; |SI FSalida ! 0; |DDEFECTO #agifa715; |FINSI;
         #Refere1@#0 = #agifa715#4;
         #agifa715#0 = "agifa080"; #agifa715#1 = 1; |LEE 000#agifa715.=; |SI FSalida ! 0; |DDEFECTO #agifa715; |FINSI;
         #Refere1@#1 = #agifa715#4;
         |LEE 000#Refere1@.=;
         |SI FSalida = 0;
            enTiva = #Refere1@#11;
            eaPrv  = #Refere1@#15;
            nClPr  = 2;
         |FINSI;

         |CIERRA #Refere1@; |DESCARGA_DEF #Refere1@;
      |FINSI;
      |DDEF aAlfa3; |QBF aAlfa3;
      aAlfa3 = aAlfa3 + "agifa077.mas";
      |CARGA_DEF aAlfa3, Refere1@;
      |SI FSalida = 0;
         |DFICE aAlfa3; |QBF aAlfa3; |PATH_DAT #Refere1@#aAlfa3#;
         |ABRE #Refere1@;
         #agifa715#0 = "agifa080"; #agifa715#1 = 27; |LEE 000#agifa715.=; |SI FSalida ! 0; |DDEFECTO #agifa715; |FINSI;
         #Refere1@#50 = #agifa715#3;
         #agifa715#0 = "agifa080"; #agifa715#1 = 0; |LEE 000#agifa715.=; |SI FSalida ! 0; |DDEFECTO #agifa715; |FINSI;
         #Refere1@#0 = #agifa715#4;
         |LEE 000#Refere1@.=;
         |SI FSalida = 0;
            efFiva = #Refere1@#1;
         |FINSI;

         |CIERRA #Refere1@; |DESCARGA_DEF #Refere1@;
      |FINSI;

      |HAZ GrabaIva;
   |FINSI;

   #agifa715#0 = "agifa069";
   #agifa715#1 = 11;
   |LEE 000#agifa715.=;
   |SI FSalida = 0;
      |DDEF aAlfa3; |QBF aAlfa3;
      aAlfa3 = aAlfa3 + "agifa069.mas";
      |CARGA_DEF aAlfa3, Refere1@;
      |SI FSalida = 0;
         |DFICE aAlfa3; |QBF aAlfa3; |PATH_DAT #Refere1@#aAlfa3#;
         |ABRE #Refere1@;

         #agifa715#0 = "agifa069"; #agifa715#1 = 20; |LEE 000#agifa715.=; |SI FSalida ! 0; |DDEFECTO #agifa715; |FINSI;
         #Refere1@#20 = #agifa715#3;
         #agifa715#0 = "agifa069"; #agifa715#1 = 0; |LEE 000#agifa715.=; |SI FSalida ! 0; |DDEFECTO #agifa715; |FINSI;
         #Refere1@#0 = #agifa715#4;
         #agifa715#0 = "agifa069"; #agifa715#1 = 1; |LEE 000#agifa715.=; |SI FSalida ! 0; |DDEFECTO #agifa715; |FINSI;
         #Refere1@#1 = #agifa715#4;
         |LEE 000#Refere1@.=;
         |SI FSalida = 0;
            enTiva = #Refere1@#11;
            eaCli  = #Refere1@#15;
            nClPr  = 1;
         |FINSI;

         |CIERRA #Refere1@; |DESCARGA_DEF #Refere1@;
      |FINSI;
      |DDEF aAlfa3; |QBF aAlfa3;
      aAlfa3 = aAlfa3 + "agifa084.mas";
      |CARGA_DEF aAlfa3, Refere1@;
      |SI FSalida = 0;
         |DFICE aAlfa3; |QBF aAlfa3; |PATH_DAT #Refere1@#aAlfa3#;
         |ABRE #Refere1@;
         #agifa715#0 = "agifa069"; #agifa715#1 = 20; |LEE 000#agifa715.=; |SI FSalida ! 0; |DDEFECTO #agifa715; |FINSI;
         #Refere1@#48 = #agifa715#3;
         #agifa715#0 = "agifa069"; #agifa715#1 = 0; |LEE 000#agifa715.=; |SI FSalida ! 0; |DDEFECTO #agifa715; |FINSI;
         #Refere1@#0 = #agifa715#4;
         |LEE 000#Refere1@.=;
         |SI FSalida = 0;
            efFiva = #Refere1@#1;
         |FINSI;

         |CIERRA #Refere1@; |DESCARGA_DEF #Refere1@;
      |FINSI;
      |HAZ GrabaIva;
   |FINSI;

   #agifa715#0 = "agifa502";
   #agifa715#1 = 13;
   |LEE 000#agifa715.=;
   |SI FSalida = 0;
      |DDEF aAlfa3; |QBF aAlfa3;
      aAlfa3 = aAlfa3 + "agifa502.mas";
      |CARGA_DEF aAlfa3, Refere1@;
      |SI FSalida = 0;
         |DFICE aAlfa3; |QBF aAlfa3; |PATH_DAT #Refere1@#aAlfa3#;
         |ABRE #Refere1@;

         #agifa715#0 = "agifa502"; #agifa715#1 = 20; |LEE 000#agifa715.=; |SI FSalida ! 0; |DDEFECTO #agifa715; |FINSI;
         #Refere1@#20 = #agifa715#3;
         #agifa715#0 = "agifa502"; #agifa715#1 = 0; |LEE 000#agifa715.=; |SI FSalida ! 0; |DDEFECTO #agifa715; |FINSI;
         #Refere1@#0 = #agifa715#4;
         #agifa715#0 = "agifa502"; #agifa715#1 = 1; |LEE 000#agifa715.=; |SI FSalida ! 0; |DDEFECTO #agifa715; |FINSI;
         #Refere1@#1 = #agifa715#4;
         |LEE 000#Refere1@.=;
         |SI FSalida = 0;
            enTiva = #Refere1@#13;
            eaCli  = "";
            nClPr  = 1;
         |FINSI;

         |CIERRA #Refere1@; |DESCARGA_DEF #Refere1@;
      |FINSI;
      |DDEF aAlfa3; |QBF aAlfa3;
      aAlfa3 = aAlfa3 + "agifa501.mas";
      |CARGA_DEF aAlfa3, Refere1@;
      |SI FSalida = 0;
         |DFICE aAlfa3; |QBF aAlfa3; |PATH_DAT #Refere1@#aAlfa3#;
         |ABRE #Refere1@;
         #agifa715#0 = "agifa502"; #agifa715#1 = 20; |LEE 000#agifa715.=; |SI FSalida ! 0; |DDEFECTO #agifa715; |FINSI;
         #Refere1@#36 = #agifa715#3;
         #agifa715#0 = "agifa502"; #agifa715#1 = 0; |LEE 000#agifa715.=; |SI FSalida ! 0; |DDEFECTO #agifa715; |FINSI;
         #Refere1@#0 = #agifa715#4;
         |LEE 000#Refere1@.=;
         |SI FSalida = 0;
            efFiva = #Refere1@#14;
         |FINSI;

         |CIERRA #Refere1@; |DESCARGA_DEF #Refere1@;
      |FINSI;

      |HAZ GrabaIva;
   |FINSI;
   |CIERRA #agifa715;
|FPRC;

/*
|PROCESO PasaTiquetsLins;
   #agifa060#0 = #agifa502#11;
   |LEE 000#agifa060.=;
   |SI FSalida ! 0; |DDEFECTO #agifa060; |FINSI;

   #agifa066#0 = #agifa502#13;
   |LEE 000#agifa066.=;
   |SI FSalida ! 0; |DDEFECTO #agifa066; |FINSI;

   #agifa505#0 = #agifa502#12;
   |LEE 000#agifa505.=;
   |SI FSalida ! 0; |DDEFECTO #agifa505; |FINSI;

   #agifa007#26 = #agifa501#57;
   |LEE 000#agifa007.=;
   |SI FSalida ! 0; |DDEFECTO #agifa007; |FINSI;

   #agifa733#0 = #agifa060#2;
   #agifa733#1 = "";
   |SI eaCtaAnalit = "C"; #agifa733#1 = #agifa505#166; |FINSI;
   |SI eaCtaAnalit = "F"; #agifa733#1 = #agifa060#4;   |FINSI;
   |SI eaCtaAnalit = "S"; #agifa733#1 = #agifa007#43;  |FINSI;
   |SI eaCtaAnalit = "L"; #agifa733#1 = #agifa501#32;  |FINSI;
   #agifa733#2 = #agifa066#2;
   |LEE 000#agifa733.=;
   |SI FSalida ! 0;
      |DDEFECTO #agifa733;
      #agifa733#0 = #agifa060#2;
      #agifa733#1 = "";
      |SI eaCtaAnalit = "C"; #agifa733#1 = #agifa505#166; |FINSI;
      |SI eaCtaAnalit = "F"; #agifa733#1 = #agifa060#4;   |FINSI;
      |SI eaCtaAnalit = "S"; #agifa733#1 = #agifa007#43;  |FINSI;
      |SI eaCtaAnalit = "L"; #agifa733#1 = #agifa501#32;  |FINSI;
      #agifa733#2 = #agifa066#2;
      |GRABA 020#agifa733.b;
   |FINSI;
   #agifa733#3 = #agifa733#3 + #agifa502#6;
   #agifa733#4 = #agifa733#4 + #agifa502#10;
   #agifa733#5 = #agifa733#5 + #agifa502#7;
   #agifa733#6 = #agifa733#6 + #agifa502#21;
   #agifa733#7 = #agifa733#7 + #agifa502#19;
   |GRABA 020#agifa733.a;
|FPRC;

|DEFBUCLE PasaTiquetsLins;
#agifa502#1;
;
#agifa501#36, #agifa501#0, 001;
#agifa501#36, #agifa501#0, 999;
;
NULL, PasaTiquetsLins;
|FIN;

|PROCESO PasaTiquets;
   nTotalBruto = #agifa501#3;
   nTotalIVA   = #agifa501#4;
   nTotalFact  = #agifa501#9;
   nDtoCab     = #agifa501#9;

   |BUCLE PasaTiquetsLins;
|FPRC;

|DEFBUCLE Tiquets;
#agifa501#1;
14;
"     ", 000001, efFechaCierre;
"zzzzz", 999999, efFechaCierre;
;
NULL, Tiquets;
|FIN;

|PROCESO Tiquets;
   aAlfa = "dg" + Usuario; |NOME_DAT #agifa733#aAlfa#;
   |DELINDEX #agifa733; |ABRE #agifa733;

   |BUCLE Tiquets;

   |CIERRA #agifa733; |DELINDEX #agifa733;
|FPRC;
*/

|PROCESO RecogeIva;
   ||SI #agifa704#2 = "FC"; |Y #agifa704#8 = "S";
      enTiva = enTipoIVA;
      efFiva = efFechaIVA; |HAZ SacaIVA;
      enTipoIVA = enIva;
      enTipoREC = enRec;
   ||FINSI;
|FPRC;

|PROCESO RecogeParametros;
   |ABRE #dsm00279;
   |LEE 000#dsm00279.p;
   |SI FSalida ! 0; |DDEFECTO #dsm00279; |FINSI;
   |CIERRA #dsm00279;

   enIncLin = #dsm00279#17;
|FPRC;

|PROCESO InicializaTmpAlbaranes;
   aAlfa = "tma" + Usuario; |NOME_DAT #agifa746#aAlfa#;
   |DELINDEX #agifa746;
|FPRC;

|PROCESO MiraSiPasadoAlbaran;
   aAlfa = "tma" + Usuario; |NOME_DAT #agifa746#aAlfa#;
   |ABRE #agifa746;
   #agifa746#0 = eaSerAlbaran;
   #agifa746#1 = enNumAlbaran;
   #agifa746#2 = eaTipoImporte;
   |LEE 000#agifa746.=;
   |SI FSalida ! 0;
      |DDEFECTO #agifa746;
      #agifa746#0 = eaSerAlbaran;
      #agifa746#1 = enNumAlbaran;
      #agifa746#2 = eaTipoImporte;
      |GRABA 020#agifa746.n;
      enSwError = 0;
   |SINO;
      enSwError = 1;
   |FINSI;
   |CIERRA #agifa746;
|FPRC;

|PROCESO MiraSiActCtas;
   |DDEF aAlfa; |QBF aAlfa;
   aAlfa = aAlfa + "pcegm045.mas";
   |CARGA_DEF aAlfa, RefPCEG@;
   |SI FSalida = 0;
      |ABRE #RefPCEG@;
      |LEE 000#RefPCEG@.p;
      |SI FSalida ! 0;
         |DDEFECTO #RefPCEG@;
         |GRABA 020#RefPCEG@.c;
      |FINSI;
   |FINSI;

   |SI #RefPCEG@#1 = "S"; enSw = 1; |FINSI;

   |CIERRA #RefPCEG@; |DESCARGA_DEF #RefPCEG@;

   |SI enSw = 1; |ACABA; |FINSI;

   |DDEF aAlfa; |QBF aAlfa;
   aAlfa = aAlfa + "pcegm047.mas";
   |CARGA_DEF aAlfa, RefPCEG@;
   |SI FSalida = 0;
      |ABRE #RefPCEG@;
      |LEE 000#RefPCEG@.p;
      |SI FSalida ! 0;
         |DDEFECTO #RefPCEG@;
         |GRABA 020#RefPCEG@.c;
      |FINSI;
   |FINSI;

   |SI #RefPCEG@#1 = "S"; enSw = 1; |FINSI;

   |CIERRA #RefPCEG@; |DESCARGA_DEF #RefPCEG@;
|FPRC;

|PROCESO MiraSiIntracom;
   |SI PRMNT_enLuxeRec = 1; |ACABA; |FINSI;

   |DBASS aAlfa; |QBF aAlfa;
   aAlfa = aAlfa + "modelos/def/dsmom030.mas";
   |CARGA_DEF aAlfa, Referen@;
   |SI FSalida = 0;
      |ABRE #Referen@;
      #Referen@#0 = #agifa706#5;
      |LEE 000#Referen@.=;
      |SI FSalida = 0; |Y enSwEnlSeries = 0;
         |SI #Referen@#72 = "S"; PRMNT_enLuxeRec = 1; |FINSI;
         |SI #Referen@#26 = 6;   PRMNT_enLuxeRec = 1; |FINSI;
      |FINSI;
      |CIERRA #Referen@; |DESCARGA_DEF #Referen@;
   |FINSI;
|FPRC;

   || ABDON    11/01/2013    N.Tiquet 004823/00015
|PROCESO MiraObra;
   |DDEF aAlfa; |QBF aAlfa;
   aAlfa = aAlfa + "goparame.mas";
   |CARGA_DEF aAlfa, Refere1@;
   |SI FSalida = 0;
      |ABRE #Refere1@;
      |LEE 000#Refere1@.p;
      |SI FSalida = 0;
         |SI #Refere1@#142 = "N";
            eaSwObra = (("00000" + eaSwObra) % -105);
         |SINO;
            #agifa007#26 = eaSwObra;
            |LEE 000#agifa007.=;
            |SI FSalida ! 0; |DDEFECTO #agifa007; |FINSI;
            eaSwObra = #agifa007#43;
         |FINSI;
      |SINO;
         eaSwObra = (("00000" + eaSwObra) % -105);
      |FINSI;
      |CIERRA #Refere1@; |DESCARGA_DEF #Refere1@;
   |SINO;
      eaSwObra = (("00000" + eaSwObra) % -105);
   |FINSI;
|FPRC;

|PROCESO CogeDefectos;
   |ABRE #agifa142;
   |LEE 000#agifa142.p;
   |SI FSalida ! 0; |DDEFECTO #agifa142; |FINSI;
   |CIERRA #agifa142;

   PRMNT_ActCliPro = #agifa142#208;
|FPRC;

|PROCESO MiraRectif;
   |SI #agifa704#2 ! "FD"; |Y #agifa704#2 ! "FV"; |ACABA; |FINSI;

/*
   |ABRE #dsm00153;
   |SI #agifa704#2 = "FD"; #dsm00153#0 = "D"; |FINSI;
   |SI #agifa704#2 = "FV"; #dsm00153#0 = "V"; |FINSI;
   #dsm00153#1 = #caenlac@#12;
   #dsm00153#2 = #caenlac@#13;
   |LEE 000#dsm00153.=;
   |SI FSalida = 0;
      #caenlac@#51 = #dsm00153#8;
      aAlfa = #dsm00153#6; |QBF aAlfa;
      aAlfa = ((aAlfa + "     ") % 0105) + "/" + (("000000" + #dsm00153#7) % -106);
      #caenlac@#45 = aAlfa;
      #caenlac@#48 = "D";
   |FINSI;
*/
   |ABRE #dsm00153; |SELECT #2#dsm00153;
   |SI #agifa704#2 = "FD"; #dsm00153#0 = "D"; |FINSI;
   |SI #agifa704#2 = "FV"; #dsm00153#0 = "V"; |FINSI;

   #dsm00153#6 = #caenlac@#12;
   #dsm00153#7 = #caenlac@#13;
   |LEE 000#dsm00153.=;
   |SI FSalida = 0;
      #caenlac@#51 = #dsm00153#3;
      aAlfa = #dsm00153#1; |QBF aAlfa;
      aAlfa = ((aAlfa + "     ") % 0105) + "/" + (("000000" + #dsm00153#2) % -106);
      #caenlac@#45 = aAlfa;
      #caenlac@#48 = "D";
   |FINSI;
   |CIERRA #dsm00153;
|FPRC;
