Excel_ARVIN_MERITOR_EPL

|FICHEROS;
     desan009 #0;
     desan003 #3;
     desan004 #4;
     agifa019 #19;
     agifa112 #112;
     agifa321 #321;
     agifa324 #324;
|FIN;

|VARIABLES;
     &nDeci_PreBase = 0;
     &nDeci_PreDiv  = 0;
     nCambioD       = 0;
     nCambioB       = 0;
     nPvp = 0;
     nNum = 0;
     nLin = 0;
     aRuta = "";
     aExcel = "";
     aMensa = "";
     nXls = 0;
     nSal = 0;
     aAlfa = "";
     aAlfb = "";
     aAlfc = "";
     aAlfd = "";
     aAlfe = "";
     aAlff = "";
     aAlfg = "";
     aAlfh = "";
     aAlfi = "";
     nPre = 0;
     nCan = 0;
|FIN;

B, código artículo.
C, descripción.
D, Cantidad 1
E, Cantidad 2
F, Cantidad 3
G, Precio Neto 1
H, Precio Neto 2
I, Precio Neto3

|PROCESO Registro;
     |SI aAlfb = ""; |ACABA; |FINSI;

     |DDEFECTO #19;
     #19#0 = aAlfb;
     |LEE 101#19=;
     |SI FSalida ! 0; |ACABA; |FINSI;

     aMensa = "0000Procesando " + #19#0;
     |MENSA aMensa;

     aAlfc = #19#1; |QBF aAlfc;
     |SI aAlfc = "";
          #19#1 = aAlfc;
          |GRABA 020#19a;
     |FINSI;
     |LIBERA #19;

     |SI nLin = 0;
          |LEE 000#3u;
          |SI FSalida = 0;
               nNum = #3#0 + 1;
          |SINO;
               nNum = 1;
          |FINSI;
          |DDEFECTO #3;
          #3#0 = nNum;
          |GRABA 020#3b;
          #3#1 = #112#0;
          #3#4 = #112#81;
          #3#2 = #0#4;
          #3#3 = #0#5;
          |GRABA 020#3a;
          |LIBERA #3;
     |FINSI;

     nCan = aAlfd;
     nPre = aAlfg;
     |SI nCan ! 0; |Y nPre ! 0;
          nLin = nLin + 1;
          |DDEFECTO #4;
          #4#0 = #3#0;
          #4#1 = nLin;
          |GRABA 020#4b;
          #4#2 = #19#0;
          #4#3 = #19#1;
          #4#5 = nPre;
          #4#4 = #4#5 / nCambioD * nCambioB;
          #4#8 = #0#1;
          #4#9 = #0#2;
          #4#10 = nCan
          #4#7 = #3#1;
          #4#12 = #3#2;
          #4#13 = #3#3;
          |GRABA 020#4a;
          |LIBERA #4;
     |FINSI;

     nCan = aAlfe;
     nPre = aAlfh;
     |SI nCan ! 0; |Y nPre ! 0;
          nLin = nLin + 1;
          |DDEFECTO #4;
          #4#0 = #3#0;
          #4#1 = nLin;
          |GRABA 020#4b;
          #4#2 = #19#0;
          #4#3 = #19#1;
          #4#5 = nPre;
          #4#4 = #4#5 / nCambioD * nCambioB;
          #4#8 = #0#1;
          #4#9 = #0#2;
          #4#10 = nCan
          #4#7 = #3#1;
          #4#12 = #3#2;
          #4#13 = #3#3;
          |GRABA 020#4a;
          |LIBERA #4;
     |FINSI;

     nCan = aAlff;
     nPre = aAlfi;
     |SI nCan ! 0; |Y nPre ! 0;
          nLin = nLin + 1;
          |DDEFECTO #4;
          #4#0 = #3#0;
          #4#1 = nLin;
          |GRABA 020#4b;
          #4#2 = #19#0;
          #4#3 = #19#1;
          #4#5 = nPre;
          #4#4 = #4#5 / nCambioD * nCambioB;
          #4#8 = #0#1;
          #4#9 = #0#2;
          #4#10 = nCan
          #4#7 = #3#1;
          #4#12 = #3#2;
          #4#13 = #3#3;
          |GRABA 020#4a;
          |LIBERA #4;
     |FINSI;
|FPRC;

|PROCESO Tipo3; |TIPO 3;
     |ABRE #112;
     |DDEFECTO #112;
     #112#0 = #0#3;
     |LEE 020#112=;
     |CIERRA #112;

     |ABRE #321; |LEE 000#321p; |CIERRA #321;
     |ABRE #324;
     #324#0 = #321#9;
     |LEE 000#324=;
     nDeci_PreBase = #324#9;
     nCambioB = #324#3;
     #324#0 = #112#81;
     |LEE 000#324=;
     nDeci_PreDiv = #324#9;
     nCambioD = #324#3;
     |CIERRA #324;

     |ABRE #19;
     |ABRE #3;
     |ABRE #4;

     aExcel = #0#6; |QBF aExcel;
     |XABRE "CE", aExcel, 0;
     |SI FSalida < 0
          |MENAV "0000No puedo abrir el fichero a importar";
     |SINO;
          |CARGADLL "agixl97.dll";
          |SI FSalida < 0;
               |MENAV "0000No se puede usar agixl97.dll";
          |SINO;
               |ALFACALLDLL "agixl97.dll", "carga_book", aExcel;
               aAlfa = #0#9; |QBF aAlfa;
               |ALFACALLDLL "agixl97.dll", "selecciona_hoja", aAlfa;
               |SI FSalida = 0;
                    |PARA nXls = #0#7; |SI nXls [ #0#8; |HACIENDO nXls = nXls + 1;
                         aMensa = "Importando:" + nXls;
                         |PINTA 2003, aMensa;
                         aAlfb = "B" + nXls; |ALFACALLDLL "agixl97.dll", "peek_dato", aAlfb;
                         |SI FSalida ! 0; |SAL; |FINSI;
                         aAlfc = "C" + nXls; |ALFACALLDLL "agixl97.dll", "peek_dato", aAlfc;
                         |SI FSalida ! 0; |SAL; |FINSI;
                         aAlfd = "D" + nXls; |ALFACALLDLL "agixl97.dll", "peek_dato", aAlfd;
                         |SI FSalida ! 0; |SAL; |FINSI;
                         aAlfe = "E" + nXls; |ALFACALLDLL "agixl97.dll", "peek_dato", aAlfe;
                         |SI FSalida ! 0; |SAL; |FINSI;
                         aAlff = "F" + nXls; |ALFACALLDLL "agixl97.dll", "peek_dato", aAlff;
                         |SI FSalida ! 0; |SAL; |FINSI;
                         aAlfg = "G" + nXls; |ALFACALLDLL "agixl97.dll", "peek_dato", aAlfg;
                         |SI FSalida ! 0; |SAL; |FINSI;
                         aAlfh = "H" + nXls; |ALFACALLDLL "agixl97.dll", "peek_dato", aAlfh;
                         |SI FSalida ! 0; |SAL; |FINSI;
                         aAlfi = "I" + nXls; |ALFACALLDLL "agixl97.dll", "peek_dato", aAlfi;
                         |SI FSalida ! 0; |SAL; |FINSI;

                         |HAZ Registro;
                         |SI nSal = 1; |SAL; |FINSI;
                    |SIGUE;
                    |ALFACALLDLL "agixl97.dll", "fin_book", "salva";
               |FINSI;
          |FINSI;
          |DESCARGADLL "agixl97.dll";
     |FINSI;

     |CIERRA #4;
     |CIERRA #3;
     |CIERRA #19;
|FPRC;

|PROCESO Browser; |TIPO 0;
     |SI FSalida ! 10; |ACABA; |FINSI;

     aRuta = "F*.xls";

     |BROWSE aRuta;

     aRuta = aRuta % 2; |QBF aRuta;
     |SI aRuta = "F"; aRuta = ""; |FINSI;

     |QBF aRuta;
     |SI aRuta = "";
          |ERROR;
     |SINO;
          #0#6 = aRuta;
          |PINTA #0#6;
     |FINSI;
|FPRC;

|PROGRAMA;
     |ABRE #0;
     |LEE 101#0p;
     |SI FSalida ! 0; |GRABA 020#0b; |FINSI;
     |PINPA #0#0;
     |PINDA #0#0;
     |ENDATOS #1#0;
     |SI FSalida = 0; |GRABA 020#0a; |FINSI;
     |CIERRA #0;
|FPRO;
