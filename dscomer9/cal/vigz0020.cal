|FICHEROS;
vigz0020 #0;
agifa065 #1;
agifa019 #3;
vigw0016 #5;   ||Temporal.
agifa007;
vigm0043 #43;
|FIN;

|VARIABLES;
aSerie = "";
&Tempo = "";
informe   = "vigz0020";
fecha     = @;
fecha_inf = "";
fecha_sup = "";
mes       = "";
mes1      = 0;
i         = 0;
&tt1      = 0;
&tt2      = 0;
&tt3      = 0;
&tt4      = 0;
&tt5      = 0;
&tt6      = 0;
&tt7      = 0;
&tt8      = 0;
&tt9      = 0;
&tt10     = 0;
&tt11     = 0;
&tt12     = 0;
&tt13     = 0;
|FIN;

|CALCULO ao;|TIPO 7;
fecha = ~;
#0#0 = fecha % 0704;
|PINTA #0#0;
|FCAL;

|PROCESO EsInternoHis;
     |ABRE #agifa007;
     #agifa007#26 = aSerie;
     |LEE 000#agifa007.=;
     |CIERRA #agifa007;

     |SI #agifa007#37 = "S";
          FSalida = 0;
     |SINO;
          FSalida = 1;
     |FINSI;
|FPRC;

|CALCULO pasa_hist;
     aSerie = #agifa065#11;
     |HAZ EsInternoHis;
     |SI FSalida = 0; |ACABA; |FINSI;

     |ABRE #3;
||     #3#0 = #1#2;
     #3#0 = #1#0;
     |LEE 000#3=;
     |CIERRA #3;

     |ABRE #5;
     #5#0 = #1#0;
     |LEE 000#5=;
     |SI FSalida ! 0;
         |DDEFECTO #5;
         #5#0 = #1#0;
         |GRABA 000#5c;
         |LIBERA #5;
     |FINSI;
     mes  = #1#1 % 402;
     mes1 = mes + 1;
     #5#0 = #1#0;
     #5#1 = #3#1;
     #5mes1 = #5mes1 + #1#6;
     #5#14  = #5#14 + #1#6;
     |GRABA 000#5a;
     |LIBERA #5;
     |PARA i = 0;|SI i = 14;|HACIENDO i = i + 1;
           #5i = "";
     |SIGUE;
     |LIBERA #5;
     |CIERRA #5;
|FCAL;

|DEFBUCLE lee_hist;
     #1#1;
     5;
     #0#3 , fecha_inf , #0#7 , 000001,     0, #0#1 , #0#9;
     #0#4 , fecha_sup , #0#8 , 999999, 99999, #0#2 , #0#10;
     ;
     NULL,pasa_hist;
|FIN;

|CALCULO imprime;
|PRINT;

tt1 = tt1 + #5#2;
tt2 = tt2 + #5#3;
tt3 = tt3 + #5#4;
tt4 = tt4 + #5#5;
tt5 = tt5 + #5#6;
tt6 = tt6 + #5#7;
tt7 = tt7 + #5#8;
tt8 = tt8 + #5#9;
tt9 = tt9 + #5#10;
tt10 = tt10 + #5#11;
tt11 = tt11 + #5#12;
tt12 = tt12 + #5#13;
tt13 = tt13 + #5#14;
|FCAL;

|DEFBUCLE impresion;
#5#1;
;
INICIO;
FINAL;
be;
NULL,imprime;
|FIN;

|PROCESO HistoTras;
     aSerie = #43#0;
     |HAZ EsInternoHis;
     |SI FSalida = 0; |ACABA; |FINSI;

     |ABRE #3;
     #3#0 = #43#12;
     |LEE 000#3=;
     |CIERRA #3;

     |DDEFECTO #5;
     |ABRE #5;
     #5#0 = #43#12;
     |LEE 000#5=;
     |SI FSalida ! 0; |GRABA 000#5b; |FINSI;
     mes  = #43#6 % 402;
     mes1 = mes + 1;
     #5#0 = #43#12;
     #5#1 = #3#1;
     #5mes1 = #5mes1 + #43#13;
     #5#14  = #5#14 + #43#13;
     |GRABA 000#5a;
     |LIBERA #5;
     |PARA i = 0;|SI i = 14;|HACIENDO i = i + 1;
           #5i = "";
     |SIGUE;
     |CIERRA #5;
|FPRC;

|DEFBUCLE HistoTras;
     #43#1;
     17, 12, 6;
     #0#1, 000000, 001, #0#9, #0#3, fecha_inf;
     #0#2, 999999, 999, #0#10, #0#4, fecha_sup;
     ;
     NULL, HistoTras;
|FIN;

|CALCULO alba0023;|TIPO 3;
|SI #0#5 = "SI";|O #0#5 = "si";
    |HAZ CreaTempo; |NOME_DAT #5 Tempo;
    |DELINDEX #5;
    |IMPRE 0;
    |SI FSalida = 0;
        |INFOR informe;
        |SI FSalida = 0;
            fecha_inf = "01.01." + #0#0;
            fecha_sup = "31.12." + #0#0;
            |BUCLE lee_hist;
            |SI "AV" ] #0#7; |Y "AV" [ #0#8;
                  |BUCLE HistoTras;
            |FINSI;
            |BUCLE impresion;
            |PIEINF;
        |FINSI;
        |FININF;
    |FINSI;
    |FINIMP;
    |HAZ BoraTempo; |DELINDEX #5;
|FINSI;
|FCAL;
