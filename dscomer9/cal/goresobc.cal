|FICHEROS;
     goresobc #0;
     goresobl #1;
     gopartca #2;
     gopartll #3;
     gomatcab #4;
     gomatlin #5;
     gotresob #6;
||     gocallac #7;
||     gocallal #8;
     gotrespa #9,MANTE;
     gotrespb #10;
     gopartia #11;
     goparame #12;
     gopre001 #13;
     gosubcoc #15;
     gosubpar #16;
|FIN;
-----------------------------------------------------------------------------
|VARIABLES;
     dVacio         = "                    ";
     hVacio         = "zzzzzzzzzzzzzzzzzzzz";
     &cCodMonBase   = "";
     &cDesMonBase   = "";
     &cCodMonTrab   = "";
     &cDesMonTrab   = "";

     &nDeci_PBase   = 0;
     &nDeci_TBase   = 0;
     &nDeci_PTrab   = 0;
     &nDeci_TTrab   = 0;
     &nDeci_TotVis  = 0;
     &nEurComTrab   = 0;
     &nEurComBase   = 0;
     &nEurVenTrab   = 0;
     &nEurVenBase   = 0;

     cMonPre        = "";
     cAno           = "";
     cDia           = "";
     cTipo          = "";
     cTrab          = "";
     cSubc          = "";
     cAlba          = "";
     cUsuario       = "";
     cFichero6      = "";
     cFichero10     = "";

     nModo          = 0;
     nCont          = 0;
     nAno           = 0;
     nSuma          = 0;
     nDias          = 0;

     fFecha         = @;
     fDia           = @;
     fHoy           = @;
|FIN;
-----------------------------------------------------------------------------
|PROCESO MonTraRes; |TIPO 13;
     cCodMonTrab = #0#6;
     |HAZ MonBas;
     |HAZ PinDatRes;

     |SI #12#141 = "O";
          |ATRI I; |PINTA 603, "O.T..........:"; |ATRI 0;
          |ATRI R; |PINTA 906, "O.E         "; |ATRI 0;
          |ATRI R; |PINTA 1214, "     O.E.            "; |ATRI 0;
     |FINSI;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO GrabFich;
     #6#6  = #6#2 + #6#4 + #6#17;                 ||Total   Venta Pres.
     #6#7  = #6#3 + #6#5 + #6#18;                 ||Total   Costo Pres.
     #6#8  = (#1#9/#6#14)*#6#15;                  ||Dia Hoy Venta.
     #6#9  = (#1#13/#6#14)*#6#15;                 ||Dia Hoy Costo.
     #6#10 = #6#6 - #6#8;                         ||Desviacion Moneda Venta.
     #6#11 = #6#7 - #6#9;                         ||Desviacion Moneda Costo.
     #6#12 = ((#6#10*100)/#1#9);                  ||Desviacion % Venta.
     #6#13 = ((#6#11*100)/#1#13);                 ||Desviacion % Costo.
     |GRABA 020#6a;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO GrabMate;
     #6#0 = #5#3;
     #6#1 = #5#4;
     |LEE 000#6=;
     cTipo = #5#9;
     |QBF cTipo;
     #6#2  = #6#2  + #5#7;                        ||Importe Venta Pres.
     #6#3  = #6#3  + #5#5;                        ||Importe Costo Pres.
     |HAZ GrabFich;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO GrabPart;

     |SI cTipo ! "dias";
          #6#0 = #3#4;
          #6#1 = #3#5;
          |LEE 000#6=;
          cTipo = #3#14;
          |QBF cTipo;
          #6#4 = #6#4  + #3#10;                   ||Importe Venta Materiales.
          #6#5 = #6#5  + #3#9;                    ||Importe Costo Materiales.
          |HAZ GrabFich;
     |SINO;
          nDias = nDias + 1;
     |FINSI;

|FPRC;
-----------------------------------------------------------------------------
|DEFBUCLE TomaMate;
     #5#2;
     ;
     #1#3, #1#4;
     #1#3, #1#4;
     ;
     NULL, GrabMate;
|FIN;
-----------------------------------------------------------------------------
|DEFBUCLE TomaPart;
     #3#3;
     ;
     #1#3, #1#4;
     #1#3, #1#4;
     ;
     NULL, GrabPart;
|FIN;
-----------------------------------------------------------------------------
|PROCESO GrabParti;

     |SELECT #2#9;
     #9#0   = #11#0;
     #9#1   = #11#1;
     #9#5   = #11#8;
     |LEE 000#9=;
     |SI FSalida = 0;

          #10#0 = #11#0;
          #10#1 = #11#1;
          #10#2 = #11#8;
          |LEE 000#10=;

          |SI FSalida ! 0;
               |DDEFECTO #10;
               #10#0 = #11#0;
               #10#1 = #11#1;
               #10#2 = #11#8;
               |GRABA 020#10c;
          |FINSI;

          |SI cAlba = #11#4;
               #10#3 = #10#3 + #11#13;                 ||Importe Venta Mate.
               #10#4 = #10#4 + #11#14;                 ||Importe Costo Mate.
          |FINSI;

          |SI cTrab = #11#4;
               #10#5  = #10#5  + #11#13;               ||Importe Venta Trabajos.
               #10#6  = #10#6  + #11#14;               ||Importe Costo Trabajos.
               #10#16 = #10#16 + #11#10;               ||Horas Asignadas.
          |FINSI;

          |SI cSubc = #11#4;
               #10#18 = #10#18 + #11#13;               ||Importe Venta Trabajos.
               #10#19 = #10#19 + #11#14;               ||Importe Costo Trabajos.
               #6#0 = #11#0;
               #6#1 = #11#1;
               |LEE 000#6=;
               cTipo = #5#9;
               |QBF cTipo;
               #6#17  = #6#17 + #11#13;                ||Importe Venta Pres.
               #6#18  = #6#18 + #11#14;                 ||Importe Costo Pres.
               |HAZ GrabFich;
          |FINSI;

          #10#15 = #9#9;                               ||Horas Estimadas.
          #10#7  = #10#3 + #10#5 + #10#18;             ||Total   Venta Pres.
          #10#8  = #10#4 + #10#6 + #10#19;             ||Total   Costo Pres.
          #10#9  = (#9#7/#10#15)*#10#16;               ||Dia Hoy Venta.
          #10#10 = (#9#8/#10#15)*#10#16;               ||Dia Hoy Costo.
          #10#11 = #10#7 - #10#9;                      ||Desviacion Moneda Venta.
          #10#12 = #10#8 - #10#10;                     ||Desviacion Moneda Costo.
          #10#13 = ((#10#11*100)/#9#7);                ||Desviacion % Venta.
          #10#14 = ((#10#12*100)/#9#8);                ||Desviacion % Coste.
          |GRABA 020#10a;
     |FINSI;

|FPRC;
-----------------------------------------------------------------------------
|DEFBUCLE TomaParti;
     #11#3;
     ;
     "     ", 000001, #1#3, #1#4, dVacio, dVacio;
     "zzzzz", 999999, #1#3, #1#4, hVacio, hVacio;
     ;
     NULL, GrabParti;
|FIN;
-----------------------------------------------------------------------------
|PROCESO GraSubPar;
     #6#0 = #15#4;
     #6#1 = #15#5;
     |LEE 000#6=;
     cTipo = #5#9;
     |QBF cTipo;
     #6#17  = #6#17 + #16#11;                       ||Importe Venta Pres.
     #6#18  = #6#18 + #16#9;                        ||Importe Costo Pres.
     |HAZ GrabFich;
|FPRC;
-------------------------------------------------------------------------------
|DEFBUCLE GraSubPar;
     #16#1;
     ;                                          ||Campos Extras.
     #15#0, "                    ",   1;
     #15#0, "zzzzzzzzzzzzzzzzzzzz", 999;
     ;                                          ||b/e Bolqueo-Ordenacion.
     NULL, GraSubPar;
|FIN;
-------------------------------------------------------------------------------
|PROCESO TomaSubPar;
     |BUCLE GraSubPar;
|FPRC;
-------------------------------------------------------------------------------
|DEFBUCLE TomaSubc;
     #15#1;
     4,5;                                          ||Campos Extras.
          1, #1#3, #1#4;
     999999, #1#3, #1#4;
     ;                                          ||b/e Bolqueo-Ordenacion.
     NULL, TomaSubPar;
|FIN;
-------------------------------------------------------------------------------
|PROCESO MiraDato;
     |HAZ Dias;
     |MENSA "0000PROCESANDO PARTES DE TRABAJO";
     |BUCLE TomaPart;
     |MENSA "0000PROCESANDO MATERIALES";
     |BUCLE TomaMate;
     |MENSA "0000PROCESANDO SUBCONTRATAS";
     ||BUCLE TomaSubc;
     |MENSA "0000PROCESANDO PARTIDAS";
     |ABRE #9;
     |BUCLE TomaParti;
     |CIERRA #9;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO Dias;
     nDias = 0;
     cTipo = "dias";
     #6#0 = #1#3;
     #6#1 = #1#4;
     |LEE 000#6=;

     |SI FSalida ! 0;

          |PARA nCont = 2; |SI nCont [ 15; |HACIENDO nCont=nCont+1;
               #6nCont = 0;
          |SIGUE;

          #6#16 = #1#5;
          |GRABA 020#6c;
     |FINSI;

     |BUCLE TomaPart;
     #6#14 = #1#15;
     #6#15 = nDias;
     |GRABA 020#6a;
     cTipo = "";
|FPRC;
-----------------------------------------------------------------------------
/*
|PROCESO MiraFech;
     |SELECT #2#8;
     #8#0 = nAno;
     #8#2 = fFecha;
     |LEE 000#8=;

     |SI FSalida = 0;
          nSuma = 0;
     |SINO;
          nSuma = 1;
     |FINSI;

|FPRC;
*/
-----------------------------------------------------------------------------
|PROCESO TomaDato; |TIPO 0;
     |ABRE #12;
     #12#0 = "A";
     |LEE 000#12=;

     |SI FSalida = 0;
          cTrab = #12#3;
          cAlba = #12#1;
          cSubc = #12#29;
     |SINO;
          |MENAV "0000NO HAY PARAMETROS DEFINIDOS DE OBRAS";
          |ERROR;
          |ACABA;
     |FINSI;

     |BUCLELIN 2 MiraDato #0;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO PinDatRes; |TIPO 7;
     |ABRE #6;
     #6#0 = #1#3;
     #6#1 = #1#4;
     |LEE 000#6=;

     |SI FSalida ! 0;
          |DDEFECTO #6;
     |FINSI;

     |ENTLINEAL #2#9, -3, 7, 22, 0, MinParti, MaxParti;
     |PINDA #0#6;
     |CIERRA #6;
     |ABRE #13;
     #13#0 = #1#3;
     #13#1 = #1#4;
     |LEE 000#13=;
     |SI FSalida = 0;
          #0#2 = #13#2;                           ||Codigo Cliente;
          #0#8 = #13#3;                           ||Nombre Cliente;
          |PINTA #0#2; |PINTA #0#8;
     |FINSI;
     |CIERRA #13;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO MinParti;
     #9#0 = #1#3;                                 ||Serie pres.
     #9#1 = #1#4;                                 ||N§ presupu.
     #9#5 = "                   ";                ||Partida.
|FPRC;
-----------------------------------------------------------------------------
|PROCESO MaxParti;
     #9#0 = #1#3;                                 ||Serie pres.
     #9#1 = #1#4;                                 ||N§ presupu.
     #9#5 = "zzzzzzzzzzzzzzzzzzz";                ||Partida.
|FPRC;
-----------------------------------------------------------------------------
|PROCESO EntParti; |TIPO 0;
     |ATRI R;
     |PINTA 1220, "  PARTIDAS  ";
     |ATRI I;
     |PINTA 1302, "Horas Esti.:";
     |PINTA 1402, "Horas Asig.:";
     |ATRI 0;
     |ENTLINEAL #2#9, 3, 2, 22, 0, MinParti, MaxParti;
     |ATRI R;
     |PINTA 1220, "PRESUPUESTO";
     |ATRI I;
     |PINTA 1302, "Dias Estim.:";
     |PINTA 1402, "Dias Trans.:";
     |ATRI 0;
     |PINDA #0#6;
     |ERROR;
|FPRC;
-----------------------------------------------------------------------------
|PROCESO MinMin;
     #1#0 = #0#0;
     #1#1 = #0#1;
     #1#2 = 1;
|FPRC;
-------------------------------------------------------------------------------
|PROCESO MaxMax;
     #1#0 = #0#0;
     #1#1 = #0#1;
     #1#2 = 999;
|FPRC;
-------------------------------------------------------------------------------

|PROGRAMA;
     |ABRE #12; |LEE 000#12p; |CIERRA #12;
     |CLS;
     |ABRE #0;
     |PINPA #0#0;
     |PINDA #0#0;
     |ENCLAVE #0,4,0;
     |LEE 000#0=;
     |SI FSalida = 0;
          cFichero6 = Usuario % 806;
          cFichero6 = cFichero6 + "AA";
          cFichero10 = Usuario % 806;
          cFichero10 = cFichero10 + "AB";
          |NOME_DAT #6 cFichero6;
          |NOME_DAT #10 cFichero10;
          |DELINDEX #6;
          |DELINDEX #10;
          |ABRE #6;
||          |ABRE #7;
||          |ABRE #8;
          |ABRE #9;
          |ABRE #10;
          cCodMonTrab = #0#6;
          |HAZ MonBas;
          |HAZ TomaDato;
          |ENTLINEAL #1#1, -3, 7, 11, 0, MinMin, MaxMax;
          |PINDA #0#0;
          |ENDATOS #4#0;
          |CIERRA #6;
||          |CIERRA #7;
||          |CIERRA #8;
          |CIERRA #9;
          |CIERRA #10;
          |DELINDEX #6;
          |DELINDEX #10;
     |FINSI;
     |CIERRA #0;
|FPROG;
-----------------------------------------------------------------------------
