|FICHEROS;
     aser0003 #100;
     aser0001 #0;
     agifa010 #10;
     dsm00020 #20;
     agifa024 #24;
     agifa019 #19;
     agifa017 #17;

     agifa071 #71;
     agifa142 #142;
     agifa321 #321;
     agifa324 #324;
|FIN;

|VARIABLES;
     &aDivisa = "";
     &aMoneda = "";
     &eaTag = "";
     aSerie         = "";
     aAlfa          = "";
     nConta         = 0;
     nNume          = 0;
     nModo          = 0;
     nSalMenu       = 0;
     aArticulo = "";
     aDesArti = "";
     nLin = 0;
     nPrecio = 0;
     nForma = 0;
     nDto = 0;
     nCampo = 0;
     nTiva = 0;
     nCanti = 0;
     &enImpCliPen = 0;
     &eaCliente = "";
     &efFecha = @;
     &enForma = 0;
|FIN;

|PROCESO AcuCliente;
     nCanti = #10#15 < #10#5;
     nCanti = nCanti < #10#32;
     nCanti = nCanti < #10#7;

     |LEE 101#24=;
     |SI FSalida = 0;
          #24#50 = #24#50 + (nCanti * nForma);
          |GRABA 020#24a;
          |LIBERA #24;
     |FINSI;

     enImpCliPen = nCanti * nForma;
     eaCliente = #10#3;
     efFecha = #10#1;
     |HAZ AcumulaCli;
     eaTag = "AV";  |HAZ Riesgos;
|FPRC;

|PROCESO CreaLinAlb;
     |DDEFECTO #19;
     |ABRE #19;
     #19#0 = aArticulo;
     |LEE 000#19=;
     |CIERRA #19;
     |SI aDesArti = ""; aDesArti = #19#1; |FINSI;
     |SI nTiva = -1; nTiva = #19#30; |FINSI;

     nLin = nLin + 1;
     |DDEFECTO #71;
     #71#29 = #10#52;
     #71#0 = #10#0;
     #71#1 = nLin;
     #71#2 = #19#0;
     #71#3 = 1;
     #71#4 = aDesArti;
     #71#5 = 1;
     #71#8 = nDto;
     #71#6 = nPrecio;
     #71#36 = nPrecio;
     #71#11 = nTiva;
     #71#13 = #19#2;
     #71#14 = #19#9 * #71#5;
     #71#15 = #24#0;
     #71#17 = #24#4;
     |HAZ TotalLin71;
     |HAZ CalCabAgifa010;
     |GRABA 020#71n;
     enForma = 1;
     |HAZ AcumulaAV;
|FPRC;

|PROCESO CreaCabAlb
     |DDEFECTO #24;
     |SI #0#8 = "P";
          #24#0 = #0#9;
     |SINO;
          #24#0 = #0#14;
     |FINSI;
     |LEE 000#24=;

     |DDEFECTO #10;
     #10#52 = #0#0;
     #10#0 = #0#1;
     #10#1 = #0#2;
     #10#83 = #0#3;
     #10#2 = #0#4;
     #10#64 = #0#8;
     |SI #0#8 = "P";
          #10#3 = #0#9;
          #10#4 = #0#10;
     |SINO;
          #10#3 = #0#14;
          #10#4 = #0#15;
     |FINSI;
     #10#29 = #0#15;
     #10#30 = #0#16;
     #10#62 = #0#17;
     #10#31 = #0#18;
     #10#55 = #0#21;
     #10#56 = #0#22;
     #10#20 = #0#38; #10#24 = #0#38;
     #10#67 = #0#40;
     #10#57 = #0#41;
     #10#88 = #0#42;
     #10#9 = #0#43;
     |ABRE #20; #20#0 = #0#42; |LEE 000#20=; |CIERRA #20;
     #10#88 = #20#0;
     #10#9 = #20#1;
     #10#90 = #0#44;

     |ABRE #324;
     #10#68 = #24#192; || Divisa
     #324#0 = #10#68;
     |LEE 000#324=;
     #10#69 = #324#2; || Cambio
     #10#70 = "B";    || Trabajo
     #10#73 = #321#9; || Moneda Base
     #324#0 = #10#73;
     |LEE 000#324=;
     #10#74 = #324#2; || Cambio a Eur
     |CIERRA #324;

     aMoneda = #10#70;
     aDivisa = #10#68;
     |HAZ Divisas010;

     |HAZ LimCabAgifa010;
|FPRC;

|PROCESO BorraLinAlb;
     enForma = -1;
     |HAZ AcumulaAV;
     |BORRA 020#71a;
|FPRC;

|PROCESO aser0001;
     #10#52 = #0#0;
     #10#0 = #0#1;
     |LEE 101#10=;
     |SI FSalida = 0;
          |BUCLELIN 0BorraLinAlb#10;
          |BORRA 020#10a;
          nForma = -1;
          |HAZ AcuCliente;
     |FINSI;

     |HAZ CreaCabAlb;
     nLin = 0;
     |ABRE #71;
     aArticulo = #0#25;
     aDesArti = #0#26;
     nPrecio = #0#28;
     nDto = #0#27;
     nTiva = #0#37;
     |HAZ CreaLinAlb;
     |SI #0#29 = "S";
          aArticulo = "REEMBOLSO";
          aDesArti = "";
          nPrecio = #0#30;
          nDto = 0;
          nTiva = 0;
          |HAZ CreaLinAlb;
     |FINSI;
     |SI #0#31 ! 0;
          aArticulo = "COM.REEMBOLSO";
          aDesArti = "";
          nPrecio = #0#31;
          nDto = 0;
          nTiva = -1;
          |HAZ CreaLinAlb;
     |FINSI;
     |SI #0#32 = "S";
          aArticulo = "REEXPEDICION";
          aDesArti = "";
          nPrecio = #0#33;
          nDto = 0;
          nTiva = -1;
          |HAZ CreaLinAlb;
     |FINSI;
     |SI #0#34 = "S";
          aArticulo = "SEGURO";
          aDesArti = "";
          nPrecio = #0#35;
          nDto = 0;
          nTiva = -1;
          |HAZ CreaLinAlb;
     |FINSI;
     |CIERRA #71;

     |GRABA 020#10n;
     |LIBERA #10;

     enForma = 1;
     |HAZ AcuCliente;
|FPRC;

|DEFBUCLE aser0001;
     #0#1;
     2;
     #100#0, #100#2, #100#4;
     #100#1, #100#3, #100#5;
     ;
     NULL, aser0001;
|FIN;

|PROCESO Tipo3; |TIPO 3;
     |ABRE #142; |LEE 000#142p; |CIERRA #142;
     |ABRE #321; |LEE 000#321p; |CIERRA #321;
     |ABRE #10;
     |ABRE #24;
     |BUCLE aser0001;
     |CIERRA #24;
     |CIERRA #10;
|FPRC;
