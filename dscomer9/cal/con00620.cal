|FICHEROS;
     con00620 #0;
     con00670 #1;
     con00690 #690;

     agifa079 #20;
     agifa091 #21;
     agifa177 #22;
     dsz99984 #23;
     agifa112 #112;
     con00673 #673;
|FIN;

|VARIABLES;
     aCta = "";
     aAlfa = "";
     aInf = "";
     modo = 0;
     nFlag = 0;

     i = 0;
     nCamFec = 0;
     nCamImp = 0;
     nHay = 0;
|FIN;

|PROCESO baja; |TIPO 2;
modo = (FEntrada/100)!0;
nFlag = 0 +. 1;
|SI modo = 3;
     |ABRE #1;
     |SELECT #2#1;
     #1#12 = #0#1;
     #1#30 = #0#0;
     |LEE 021#1=;
     |SI FSalida = 0;
          #1#12 = "";
          #1#30 = "";
          |GRABA 021#1a;
     |FINSI;
     |LIBERA #1;
     |CIERRA #1;
|FINSI;

|ABRE #20;
|SI nFlag < 0;
   |HAZ BorraFactCompra;
|SINO;
   |HAZ CreaFactCompra;
|FINSI;
|CIERRA #20;
|FPRC;

|PROCESO BorraFactCompra;
     #20#66 = #0#0;
     #20#0 = #0#1;
     |LEE 101#20=;
     |SI FSalida = 0;
        |HAZ BorraRecCompra;
        |BORRA 020#20a;
     |FINSI;
     |LIBERA #20;
|FPRC;

|PROCESO CreaFactCompra;
     |ABRE #112;
     #112#0 = #0#3;
     |LEE 000#112=;
     |SI FSalida = 0; |DDEFECTO #112; |FINSI;
     |CIERRA #112;
     aCta = #112#10;

     |DDEFECTO #20;
     #20#0 = #0#1;
     #20#1 = #0#2;
     #20#2 = #0#3;
     #20#3 = #0#4;
     #20#12 = aCta;
     #20#66 = #0#0;

     #20#47 = #0#6; ||Exenta
     #20#18  = #0#7 + #0#6; ||Bruto
     #20#82  = #20#18;
     #20#105 = #20#18;

     #20#21  = #0#7; ||Base1
     #20#85  = #20#21;
     #20#108 = #20#21;

     #20#22  = #0#10;||Cuota1
     #20#86  = #20#22;
     #20#109 = #20#22;

     #20#29  = #0#12; ||T.IVA
     #20#93  = #20#29;
     #20#116 = #20#29;

     #20#31  = #0#11; ||T.Fac
     #20#95  = #20#31;
     #20#118 = #20#31;

     #20#56 = #0#9;  ||%iva1

     #20#75 = "EUR";
     #20#76 = 1;
     #20#77 = "B";
     #20#78 = "EUR";
     #20#79 = 1;

     |HAZ VenciComp;
     |GRABA 001#20c; |LIBERA #20;

     |HAZ CreaRecibos
|FPRC;

|CALCULO leepago;
     |ABRE #agifa091;
     #agifa091#0 = #0#11;
     |LEE 021#agifa091.=;
     |SI 0 ! FSalida;
          |DDEFECTO #agifa091;
     |FINSI;
     |CIERRA #agifa091;
|FCAL;

|PROCESO CreaRecibos;
     |HAZ leepago;

     |DDEFECTO #dsz99984;
     #dsz99984#0 = #agifa079#0;
     #dsz99984#17 = #agifa079#66;

     |PARA i = 1; |SI i [ #agifa091#3; |HACIENDO i = i + 1;
          nCamImp = i + 32;
          |SI #agifa079#nCamImp# = 0; |O i > 12; |ACABA; |FINSI;
          |SI i [ 6;
               nCamFec = i + 67;
          |SINO;
               nCamFec = i + 128;
          |FINSI;

          #dsz99984#7 = #agifa079#1;
          #dsz99984#8 = #agifa079#nCamFec#;
          #dsz99984#9 = #agifa079#nCamImp#;
          #dsz99984#1 = i;
          #dsz99984#2 = #agifa079#2;
          #dsz99984#3 = #agifa079#3;
          #dsz99984#4 = #agifa079#9;
          #dsz99984#12 = #agifa079#12;
          #dsz99984#18 = #agifa091#69;
          #dsz99984#21 = #agifa091#69;
          #dsz99984#23 = #agifa091#3;
          #dsz99984#24 = #agifa091#0;
          #dsz99984#25 = #agifa091#1;

          |ABRE #agifa177;
          #agifa177#0 = #dsz99984#18;
          |LEE 000#agifa177.=;
          |CIERRA #agifa177;
          #dsz99984#15 = #agifa177#3;      ||Cuenta
          |HAZ CreaRecCompra;
     |SIGUE;
|FPRC;

|PROCESO DatEco;
     |PRINT;
|FPRC;

|DEFBUCLE DatEco;
     #673#1;
     ;
     #0#5, #0#14, 001;
     #0#5, #0#14, 999;
     ;
     NULL, DatEco;
|FIN;

|PROCESO Tipo4; |TIPO 4;
     |ABRE #690;
     #690#0 = #0#0;
     |LEE 000#690=;
     |CIERRA #690;
     aInf = #690#9; |QBF aAlfa;

     |IMPRE 0;
     |SI FSalida = 0;
          |INFOR aInf;
          |SI FSalida ! 0;
               aAlfa = "0000No existe Informe: " + aInf;
               |MENAV aAlfa;
          |SINO;
               #0#12 = "S"; |PINTA #0#12;
               |GRABA 020#0a;

               nHay = 0;
               |BUCLE DatEco;
               |SI nHay = 0;
                    |DDEFECTO #673;
                    |PRINT;
               |FINSI;
               |PIEINF;
               |FININF;
          |FINSI;
          |FINIMP;
     |FINSI;
|FPRC;

|PROCESO Tipo13_620; |TIPO 13;
     |HAZ TallerDeci;
|FPRC;
