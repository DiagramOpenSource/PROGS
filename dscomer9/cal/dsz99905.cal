|FICHEROS;
     dsz99905 #0,MANTE;
     ortsm008 #8;   ||Ped
     ortsm009 #9;   ||Alb
     ortsm010 #10;  ||Fac
     ortsm011 #11;  ||Depo
     ortsm012 #12;  ||Pro
     ortsm014 #14;  ||Pro
     ortsm016 #16;
     ortsm017 #17;
     ortsm018 #18;
     ortsm019 #19;
     ortsm020 #20;
     agifa073 #73;
     referen@;
|FIN;

|VARIABLES;
     &Tempo = "";
     &enUnidades = 0;
     &eaDocu = "";
     &enBulto = 0;
     &enCntrl = 0;

     &eaSerie = "";
     &enCodigo = 0;
     &enLinea = 0;

     &eaSeriePedido = "";
     &enCodigPedido = 0;
     &enLineaPedido = 0;
     aCompoAnt = "";
     aEscan = "";
     aCompoNue = "";
     aArtiAnt = "";
     aAlfa = "";
     nLin = 0;
     i = 0;
|FIN;

|PROCESO OrtsGraba;
     |SI eaDocu = "agifa073";
          #8#3 = #0#0;
          #8#4 = #0#1;
          |GRABA 020#8a;
          |CIERRA #8;
     |FINSI;
     |SI eaDocu = "agifa071";
          #9#3 = #0#0;
          #9#4 = #0#1;
          |GRABA 020#9a;
          |CIERRA #9;
     |FINSI;
     |SI eaDocu = "agifa069";
          #10#3 = #0#0;
          #10#4 = #0#1;
          |GRABA 020#10a;
          |CIERRA #10;
     |FINSI;
     |SI eaDocu = "agifa070";
          #11#3 = #0#0;
          #11#4 = #0#1;
          |GRABA 020#11a;
          |CIERRA #11;
     |FINSI;
     |SI eaDocu = "agifa147";
          #12#3 = #0#0;
          #12#4 = #0#1;
          |GRABA 020#12a;
          |CIERRA #12;
     |FINSI;
|FPRC;

|PROCESO OrtsLee;
     |SI eaDocu = "agifa073";
          |DDEFECTO #8;
          |ABRE #8;
          #8#0 = eaSerie;
          #8#1 = enCodigo;
          #8#2 = enLinea;
          |LEE 101#8=;
          |SI FSalida ! 0; |GRABA 020#8b; |FINSI;
          #0#0 = #8#3;
          #0#1 = #8#4;
     |FINSI;
     |SI eaDocu = "agifa071";
          |DDEFECTO #9;
          |ABRE #9;
          #9#0 = eaSerie;
          #9#1 = enCodigo;
          #9#2 = enLinea;
          |LEE 101#9=;
          |SI FSalida ! 0; |GRABA 020#9b; |FINSI;
          #0#0 = #9#3;
          #0#1 = #9#4;
     |FINSI;
     |SI eaDocu = "agifa069";
          |DDEFECTO #10;
          |ABRE #10;
          #10#0 = eaSerie;
          #10#1 = enCodigo;
          #10#2 = enLinea;
          |LEE 101#10=;
          |SI FSalida ! 0; |GRABA 020#10b; |FINSI;
          #0#0 = #10#3;
          #0#1 = #10#4;
     |FINSI;
     |SI eaDocu = "agifa070";
          |DDEFECTO #11;
          |ABRE #11;
          #11#0 = eaSerie;
          #11#1 = enCodigo;
          #11#2 = enLinea;
          |LEE 101#11=;
          |SI FSalida ! 0; |GRABA 020#11b; |FINSI;
          #0#0 = #11#3;
          #0#1 = #11#4;
     |FINSI;
     |SI eaDocu = "agifa147";
          |DDEFECTO #12;
          |ABRE #12;
          #12#0 = eaSerie;
          #12#1 = enCodigo;
          #12#2 = enLinea;
          |LEE 101#12=;
          |SI FSalida ! 0; |GRABA 020#12b; |FINSI;
          #0#0 = #12#3;
          #0#1 = #12#4;
     |FINSI;
|FPRC;

|PROCESO Orts12; |TIPO 12;
|FPRC;

|PROCESO OrtsEntra;
     |HAZ OrtsLee;
     |PUSHV 0501 2380;
     |BLANCO 14171953;
     |PINPA #0#0;
     |PINDA #0#0;
     |ENDATOS #1#0;
     |POPV;
     |HAZ OrtsGraba;
|FPRC;

|PROCESO Borra18;
     |BORRA 020#18a;
|FPRC;

|DEFBUCLE Borra18;
     #18#1;
     ;
     eaSerie, enCodigo, enLinea, 000, 1;
     eaSerie, enCodigo, enLinea, 999, 999;
     be;
     NULL, Borra18;
|FIN;

|PROCESO Borra17;
     |BORRA 020#17a;
|FPRC;

|DEFBUCLE Borra17;
     #17#1;
     ;
     eaSerie, enCodigo, enLinea, 000;
     eaSerie, enCodigo, enLinea, 999;
     be;
     NULL, Borra17;
|FIN;

|PROCESO OrtsBorra;
     |SI eaDocu = "agifa073";
          |ABRE #8;
          #8#0 = eaSerie;
          #8#1 = enCodigo;
          #8#2 = enLinea;
          |BORRA 000#8c;
          |CIERRA #8;
          |BUCLE Borra17;
          |BUCLE Borra18;
     |FINSI;
     |SI eaDocu = "agifa071";
          |ABRE #9;
          #9#0 = eaSerie;
          #9#1 = enCodigo;
          #9#2 = enLinea;
          |BORRA 000#9c;
          |CIERRA #9;
     |FINSI;
     |SI eaDocu = "agifa069";
          |ABRE #10;
          #10#0 = eaSerie;
          #10#1 = enCodigo;
          #10#2 = enLinea;
          |BORRA 000#10c;
          |CIERRA #10;
     |FINSI;
     |SI eaDocu = "agifa070";
          |ABRE #11;
          #11#0 = eaSerie;
          #11#1 = enCodigo;
          #11#2 = enLinea;
          |BORRA 000#11c;
          |CIERRA #11;
     |FINSI;
     |SI eaDocu = "agifa147";
          |ABRE #12;
          #12#0 = eaSerie;
          #12#1 = enCodigo;
          #12#2 = enLinea;
          |BORRA 000#12c;
          |CIERRA #12;
     |FINSI;
|FPRC;

|PROCESO OrtsVer;
     |HAZ OrtsLee;
     |PUSHV 0501 2380;
     |BLANCO 14171955;
     |PINPA #0#0;
     |PINDA #0#0;
     |PAUSA;
     |POPV;
|FPRC;

|PROCESO OrtsAdjPed;
     |ABRE #8;
     |ABRE #9;
     |DDEFECTO #8;
     #8#0 = eaSeriePedido;
     #8#1 = enCodigPedido;
     #8#2 = enLineaPedido;
     |LEE 000#8=;
     #9#0 = eaSerie;
     #9#1 = enCodigo;
     #9#2 = enLinea;
     |LEE 101#9=;
     |SI FSalida ! 0; |GRABA 020#9b; |FINSI;
     #9#3 = #8#3;
     #9#4 = #8#4;
     |GRABA 020#9a;
     |CIERRA #9;
     |CIERRA #8;
|FPRC;

|PROCESO OrtsAdjDep;
     |ABRE #11;
     |ABRE #9;
     |DDEFECTO #11;
     #11#0 = eaSeriePedido;
     #11#1 = enCodigPedido;
     #11#2 = enLineaPedido;
     |LEE 000#11=;
     #9#0 = eaSerie;
     #9#1 = enCodigo;
     #9#2 = enLinea;
     |LEE 101#9=;
     |SI FSalida ! 0; |GRABA 020#9b; |FINSI;
     #9#3 = #11#3;
     #9#4 = #11#4;
     |GRABA 020#9a;
     |CIERRA #9;
     |CIERRA #11;
|FPRC;

|PROCESO OrtsProPed;
     |ABRE #12;
     |ABRE #8;
     |DDEFECTO #12;
     #12#0 = eaSeriePedido;
     #12#1 = enCodigPedido;
     #12#2 = enLineaPedido;
     |LEE 000#12=;
     #8#0 = eaSerie;
     #8#1 = enCodigo;
     #8#2 = enLinea;
     |LEE 101#8=;
     |SI FSalida ! 0; |GRABA 020#8b; |FINSI;
     #8#3 = #12#3;
     #8#4 = #12#4;
     |GRABA 020#8a;
     |CIERRA #8;
     |CIERRA #12;
|FPRC;

|PROCESO OrtsProFac;
     |ABRE #12;
     |ABRE #10;
     |DDEFECTO #12;
     #12#0 = eaSeriePedido;
     #12#1 = enCodigPedido;
     #12#2 = enLineaPedido;
     |LEE 000#12=;
     #10#0 = eaSerie;
     #10#1 = enCodigo;
     #10#2 = enLinea;
     |LEE 101#10=;
     |SI FSalida ! 0; |GRABA 020#10b; |FINSI;
     #10#3 = #12#3;
     #10#4 = #12#4;
     |GRABA 020#10a;
     |CIERRA #10;
     |CIERRA #12;
|FPRC;

|PROCESO OrtsImpAlb;
     |ABRE #14;
     #14#0 = eaSerie;
     #14#1 = enCodigo;
     |LEE 000#14=;
     |SI FSalida = 0;
          enBulto = #14#2;
          enCntrl = #14#3;
     |SINO;
          enBulto = 0;
          enCntrl = 0;
     |FINSI;
     |CIERRA #14;
|FPRC;

|PROGRAMA;
     |SI PARAMETRO = "ENTRA"; |HAZ OrtsEntra; |FINSI;
     |SI PARAMETRO = "BORRA"; |HAZ OrtsBorra; |FINSI;
     |SI PARAMETRO = "VER"; |HAZ OrtsVer; |FINSI;

     |SI PARAMETRO = "IMPALB"; |HAZ OrtsImpAlb; |FINSI;

     |SI PARAMETRO = "ADJPED"; |HAZ OrtsAdjPed; |FINSI;
     |SI PARAMETRO = "ADJDEP"; |HAZ OrtsAdjDep; |FINSI;
     |SI PARAMETRO = "PROPED"; |HAZ OrtsProPed; |FINSI;
     |SI PARAMETRO = "PROFAC"; |HAZ OrtsProFac; |FINSI;

     aAlfa = PARAMETRO % 105;
     |SI aAlfa = "ESCAN"; |HAZ OrtsEscan; |FINSI;
|FPRO;

|PROCESO ortsm018;
     |SI #18#4 > enUnidades;
          |BORRA 020#18a;
     |FINSI;
|FPRC;

|DEFBUCLE ortsm018;
     #18#1;
     ;
     #17#0, #17#1, #17#2, #17#3, 1;
     #17#0, #17#1, #17#2, #17#3, 999;
     be;
     NULL, ortsm018;
|FIN;

|PROCESO Tmp;
     #17#0 = #referen@#0;
     #17#1 = #referen@#1;
     #17#2 = #referen@#2;
     #17#3 = #referen@#3;
     |LEE 121#17=;

     |DDEFECTO #16;
     #16#28 = #17#0;
     #16#0 = #17#1;
     #16#1 = #17#2;
     |LEE 000#16=;

     |SI enUnidades ! #17#7;
          |BUCLE ortsm018;
          |ABRE #18;
          |PARA i = 1; |SI i [ enUnidades; |HACIENDO i = i + 1;
               |DDEFECTO #18;
               #18#0 = #17#0;
               #18#1 = #17#1;
               #18#2 = #17#2;
               #18#3 = #17#3;
               #18#4 = i;
               |LEE 000#18=;
               |SI FSalida ! 0;
                    #18#5 = #16#59;
                    #18#6 = #16#60;
                    |GRABA 020#18n;
               |FINSI;
          |SIGUE;
          |CIERRA #18;
     |FINSI;

     #17#4 = aCompoNue;
     #17#7 = enUnidades;
     |GRABA 020#17a;
     |LIBERA #17;
|FPRC;

|DEFBUCLE Tmp;
     #referen@#1004;
     ;
     "     ", 000000, 000, 000;
     "zzzzz", 999999, 999, 999;
     ;
     NULL, Tmp;
|FIN;

|PROCESO ortsm017;
     #73#28 = #17#0;
     #73#0 = #17#1;
     #73#1 = #17#2;
     |LEE 000#73=;
     |SI FSalida = 0; |Y #73#2 = aEscan;
          |SI #73#43 = 0;
               |SALVA_DATOS #17;
               |REPON_DATOS #referen@;
               |GRABA 020#referen@.n;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE ortsm017;
     #17#3;
     ;
     aCompoAnt, "     ", 000000, 000, 000;
     aCompoAnt, "zzzzz", 999999, 999, 999;
     ;
     NULL, ortsm017;
|FIN;

|PROCESO OrtsEscan;
     aCompoAnt = PARAMETRO % 620;
     aEscan = PARAMETRO % 2620;
     aCompoNue = PARAMETRO % 4620;
     aAlfa = PARAMETRO % 66; nLin = aAlfa;

     |ABRE #19;
     #19#0 = aEscan;
     |LEE 000#19=;
     |SI FSalida = 0; |Y #19#1 = "S";
          |ABRE #20;
          #20#0 = aEscan;
          #20#1 = nLin;
          |LEE 000#20=;
          |SI FSalida = 0;
               |SI #20#2 = "S"; |O #20#2 = "T";
                    |CONFI "0000SActualizar pedidos pendientes:";
                    |SI FSalida = 0;
                         |DDEF aAlfa;
                         aAlfa = aAlfa + "ortsm017";
                         |CARGA_DEF aAlfa, referen@;
                         |SI FSalida = 0;
                              |HAZ CreaTempo;
                              |NOME_DAT #referen@#Tempo#;
                              |DELINDEX #referen@;

                              |ABRE #referen@;
                              |ABRE #73;
                              |BUCLE ortsm017;
                              |CIERRA #73;

                              |ABRE #16;
                              |ABRE #17;
                              |BUCLE Tmp;
                              |CIERRA #17;
                              |CIERRA #16;
                              |CIERRA #referen@;

                              |DELINDEX #referen@;
                              |DESCARGA_DEF #referen@;
                         |FINSI;
                    |FINSI;
               |FINSI;
          |FINSI;
          |CIERRA #20;
     |FINSI;
     |CIERRA #19;
|FPRC;
