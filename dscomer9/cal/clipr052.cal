|FICHEROS;
     clipr052 #0;
     clipr053 #10,MANTE; ||aux. entlineal
     clipr007 #7; ||contratos
     agifa084 #84;||facturas (cab)
     agifa069 #69;||facturas (lin)
     clipr001 #1; ||clientes
     clipr009 #9; ||contadores
     agifa091 #91;||formas de pago
     agifa321 #321;
     agifa324 #324;
     agifa019 #19;
     agifa025 #25;
|FIN;

|INCLUYE i_varart;

|VARIABLES;
     &nDeci_PreDiv = 0;
     &aCon_Serie = "";
     &aCon_Clave = "";
     &nCon_Conta = 0;
     aAlfa     = "";
     nLin      = 0;
     nMult     = 0;
     nImpDiv   = 0;
     inmneto = 0;
     fmes = "";
     mes = 0;
     retencion = 0;
     imneto = 0;
|FIN;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|CALCULO Marca;|TIPO 11;
     |SI FSalida = 10;
          |SI #10#5 = "*";
               #10#5 = " ";
          |SINO;
               #10#5 = "*";
          |FINSI;
          |PINTA #10#5;
          |GRABA 010#10a;
     |FINSI;
|FCAL;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO ActRepre;
     |ABRE #25;
     #25#0 = #84#6;
     |LEE 121#25=;
     |SI 0 = FSalida;
          imneto = #84#15 - #84#25;
          fmes = #84#1 % A402;
          mes = fmes - 1;
          mes = mes * 2;
          mes = mes + 11;
          #25mes = #25mes +. #84#26;
          retencion = #25mes % #25#39;
          mes = mes + 1;
          #25mes = #25mes +. imneto;
          #25#35 = #25#35 +. #84#26;
          #25#36 = #25#36 +. imneto;
          mes = fmes - 1;
          mes = mes + 40;
          #25mes = retencion;
          retencion = #25#35 % #25#39;
          #25#52 = retencion;
          |GRABA 020#25a;
          |LIBERA #25;

          enImpRepComi = #84#26;
          enImpRepVta = imneto;
          enImpRepRete = retencion;
          eaRepre = #84#6;
          efFecha = #84#1;
          |HAZ AcumulaRep;
     |FINSI;
|FPRC;

|PROCESO Cabecera;
     #1#0 = #7#3;
     |LEE 010#1=;
     |SI FSalida ! 0;|DDEFECTO #1;|FINSI;

     aCon_Serie = #0#4;
     aCon_Clave = "facturas";
     |HAZ ContadorFicClip;
     |DDEFECTO #84;
     #84#48 = aCon_Serie;
     #84#0 = nCon_Conta;
     #84#1 = #0#5;
     #84#3 = #1#58;
     #84#4 = #1#1;
     ||#84#6 = #1#64;  ||Repre
     #84#6 = #1#69;  ||Repre
     #84#8 = #1#50;  ||forma pago
     #84#29 = #1#1;
     #84#30 = #1#14; ||direccion
     #84#31 = #1#15; ||poblacion
     #84#33 = #1#19; ||provincia
     #84#64 = #1#18;
     #84#60 = #1#9;  ||cif
     #84#40 = #1#49; ||cuenta contable
     #84#65 = #321#9;
     #84#66 = #324#2;
     #84#67 = "B";
     #84#68 = #321#9;
     #84#69 = #324#2;
     #84#88 = #1#51;
     #84#89 = #1#52;
     #84#90 = #1#53;
     |HAZ Divisas084;
     |GRABA 020#84b;
|FPRC;

|PROCESO LineaCon;
     #69#20 = #84#48; ||SERIE
     #69#0 = #84#0; ||NUMERO
     #69#1 = 1; ||LINEA
     #69#2 = #19#0;
     #69#3 = 1;
     #69#4 = #19#1;
     #69#5 = 1;
     #69#6 = #7#5 + #7#6;
     #69#26 = #7#5 + #7#6;
     #69#11 = #7#11;
     |HAZ TotalLin69;
     |GRABA 020#69n;
|FPRC;

|PROCESO LineaSin;
     #69#20 = #84#48; ||SERIE
     #69#0 = #84#0; ||NUMERO
     #69#1 = 1; ||LINEA
     #69#2 = #19#0;
     #69#3 = 1;
     #69#4 = #19#1;
     #69#5 = 1;
     #69#6 = #7#7 + #7#49;
     #69#26 = #7#7 + #7#49;
     #69#11 = 0;
     |HAZ TotalLin69;
     |GRABA 020#69n;
|FPRC;

|PROCESO Tmp;
     #7#0 = #10#0;
     #7#1 = #10#1;
     |LEE 101#7=;
     |SI FSalida = 0;
          |HAZ Cabecera;
          |HAZ LineaSin;
          |HAZ LimCabAgifa084;
          |BUCLELIN 2 CalCabAgifa084 #84;
          |GRABA 020#84a;
          |HAZ ActRepre;

          |HAZ Cabecera;
          |HAZ LineaCon;
          |HAZ LimCabAgifa084;
          |BUCLELIN 2 CalCabAgifa084 #84;
          |GRABA 020#84a;
          |HAZ ActRepre;

          #7#36 = "S";
          |GRABA 010#7a;
          |LIBERA #7;
     |FINSI;
|FPRC;

|DEFBUCLE Tmp;
     #10#1;
     5;
     0000,"*";
     9999,"*";
     ;
     NULL, Tmp;
|FIN;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO clipr007;
     nLin = nLin + 1;
     #10#0 = #7#0;
     #10#1 = #7#1;
     #10#2 = #7#3;
     #10#3 = #7#4;
     #10#4 = #7#10;
     #10#5 = "*";
     #10#6 = nLin;
     |GRABA 020#10n;
|FPRC;

|DEFBUCLE clipr007;
     #7#1;
     36;
     #0#0, #0#2, "N";
     #0#1, #0#3, "N";
     ;
     NULL, clipr007;
|FIN;

|PROCESO Min;
     #10#6 = 0;
|FPRC;

|PROCESO Max;
     #10#6 = 9999;
|FPRC;

|PROCESO Tipo3; |TIPO 3;
     |ABRE #321; |LEE 000#321p; |CIERRA #321;
     |ABRE #324;
     #324#0 = #321#9;
     |LEE 000#324=;
     |CIERRA #324;

     ||컴컴컴컴컴컴컴컴컴컴컴Creo Articulo facturacion
     |ABRE #19;
     #19#0 = "CONT";
     #19#1 = "Concepto Facturacion Contratos";
     |LEE 101#19=;
     |SI FSalida ! 0; |GRABA 000#19n; |FINSI;
     |CIERRA #19;

     aAlfa = Usuario; |QBF aAlfa;
     |NOME_DAT #10 aAlfa; |DELINDEX #10;

     |ABRE #10;
     |BUCLE clipr007;
     |CIERRA #10;

     |PINPA #0#10;
     |ENTLINEAL #1#10, -1, 4, 22, 0, Min, Max;
     |CONFI "0000N Es Correcto:";
     |SI FSalida = 0;
          |ABRE #84;
          |ABRE #69;
          |ABRE #1;
          |ABRE #7;
          |BUCLE Tmp;
          |ABRE #69;
          |ABRE #84;
          |CIERRA #7;
          |CIERRA #1;
     |FINSI;

     |DELINDEX #10;
|FPRC;
