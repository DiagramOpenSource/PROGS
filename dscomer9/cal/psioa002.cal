     || Modificar el psioa202 si se cambia algun campo

     LIMITE DE FICHEROS 48

|FICHEROS;
     psioa002 #99;  || Este def.
     psioa001 #0;   || Fichero de control de parametros para el pase.
     agifa091 #1;   || Formas de Pago.
     agifa024 #2;   || Clientes.
     agifa019 #3;   || Articulos.
     agifa027 #5;   || Contadores.
     agifa017 #7;   || Datos Articulo Almacen.
     agifa023 #8;   || Precios Cliente/Articulo.
     agifa039 #9;   || Descuento Cliente/Familia.
     psioa017 #10;  || Visitas.
     psioa018 #11;  || Datos Empresa Por Serie.
     agifa010 #12;  || Cabeceras Albaranes.
     agifa142 #13;  || Parametros Generales.
     agifa321 #14;  || Divisas-Parametros.
     agifa324 #15;  || Divisas-Divisas.
     dsm00024 #24;  || Partidas
     psioa030 #30;  || Ayuda Ventas
     psioa032 #32;  || Rutas
     psioa033 #33;  || Rutas Clientes
     psioa034 #34;  || Situaciones
     psioa035 #35,MANTE;  || Rutas a exportar
     agifa112 #112;
     agifm002 #20;
     agifa029 #29;
     psioa081 #81;
     psioa083 #83;
     psioa084 #84;
     tmp00003 #600; ||Tmp Arti. coimasa

     dsm00003 #300;
     agifa025 #25;
     dsl00001 #100;
     psioa060 #60;       || Config. Articulo
     agim0001 #101;
     agis0002 #102;
     dsm00134 #134;
     agifa120 #120;
     agifa060 #160;
     psioa082 #82;
     psioa038 #38;

     referen1@ #501;
     referen2@ #502;
     referen3@ #502;
     referen4@ #504;
     referen5@ #505;
     dscam023@;
     dscam024@;
     dscam038@;
|FIN;

|VARIABLES;
     &nDeci_PreVis = 0;
     &nDeci_PreBase = 0;

     fFec = @;
     aGrupo = "";
     aArti = "";
     nTari = 0;
     fFechaAlba = @;
     aFechaAlba = "";
     aDia = "";
     aMes = "";
     aAny = "";

     &aDivisa = "";
     &aMoneda = "";
     nNumRec = 0;
     aSerRec = "";
     nLinRec = 0;
     aLimpia = "";
     ii = 0;
     nCar = 0;
     aRepre = "";
     aArtiPag = "";
     nPsion = 0;
     aMail = "";
     aCliente = "";
     aDato = "";
     &eaTempo = "";
     nSwCoimasa = 0;
     aCoimaArt = "";
     aCoimaFan = "";
     aCoimaSub = "";
     aCoimaDes = "";
     aCoimaAm1 = "";
     aCoimaAm2 = "";
     aCoimaAm3 = "";
     aCoimaAm4 = "";
     fHoy = @;
     aShell = "";
     aParam = "";
     nPvp1 = 0;
     nPvp2 = 0;
     nPvp3 = 0;
     nPvp4 = 0;
     nPvp5 = 0;
     nPvp6 = 0;
     &enTiva = 0;
     &efFiva = @;
     &eaDiva = "";
     &enIva = 0;
     &enRec = 0;
     aPath = "";
     aTipo = "";
     nSwCarnicas = 0;
     nTotal = 0;
     nActa = 0;
     nAbo = 0;
     nSwJamaica = 0;
     aSerie = "";
     fHFecha = @;
     fDFecha = @;
     nNume = 0;
     aSer = "";
     nNum = 0;
     nJamaEntre = 0;
     {10}&eaVariable = "";
     aCar = "";
     aExe = "";
     nPos = 0;
     aLon = "";
     &aFicDes = "";
     aFicOrg = "";
     aVer1 = "";
     aVer2 = "";
     aIP = "";
     aBase = "";
     aBass = "";
     {1}aLocal = "";
     {1}aConte = "";
     aOrigen = "";
     aDestino = "";

     aCadena = "";
     aLen = "";
     nLen = 0;
     nCampo = 0;
     nPosi = 0;
     aCaracter = "";
     nAlma = 0;
     nHandle = 0;
     aFinReg = "";
     aEjecuta = "";
     empresa  = "";
     cadena   = "";
     fichero  = "";
     long     = "";
     caracter = "";
     campo    = "";
     &variable = "";
     alfa     = "";
     tab1     = 0;
     final1   = 0;
     final2   = 0;
     tab      = "";
     final    = "";
     i        = 0;
     f        = 0;
     ind      = 0;
     valor    = 0;
     sw       = 0;
     pasa     = 0;
     jj       = 0;
     sal      = 0;
     guarda   = 0;
     se1      = "";
     se2      = "";
     se3      = "";
     se4      = "";
     se5      = "";
     se6      = "";
     se7      = "";
     se8      = "";
     se9      = "";
     se10     = "";
     se11     = "";
     se12     = "";
     con1     = 0;
     con2     = 0;
     con3     = 0;
     con4     = 0;
     con5     = 0;
     con6     = 0;
     con7     = 0;
     con8     = 0;
     con9     = 0;
     con10    = 0;
     con11    = 0;
     con12    = 0;
     nume1    = 0;

     aAlfa = "";
     nEmpresa = 0;

     aEmpGes = "";
     aEsEmpBase = "";
     aEmpBase = "";
     nSwCepsax = 0;
     nLiqui = 0;
|FIN;

|PROCESO Nombre1; |TIPO 0;
     |SI #99#2 = "N";
          |ABRE #0;
          #0#0 = #99Campo;
          |LEE 000#0=;
          |SI FSalida ! 0;
               |MENAV "0000No existe código...";
               |ERROR;
          |FINSI;
          |CIERRA #0;
     |FINSI;
|FPRC;

|PROCESO Nombre2; |TIPO 0;
     |SI #99#2 = "S";
          |ABRE #0;
          #0#0 = #99Campo;
          |LEE 000#0=;
          |SI FSalida ! 0; |Y #99Campo ! "          ";
               |MENAV "0000No existe código...";
               |ERROR;
          |FINSI;
          |CIERRA #0;
     |FINSI;
|FPRC;

|PROCESO QuitaExtra¤os;
     |QBF aAlfa;
     aLimpia = "";
     aLon = aAlfa % A0;
     |PARA ii = 1; |SI ii [ aLon; |HACIENDO ii = ii + 1;
          nPos = ii * 100 + 1;
          aCar = aAlfa % nPos;
          nCar = &aCar;
          |SI nCar = 34; |O aCar = ";";
               aLimpia = aLimpia + " ";
          |SINO;
               aLimpia = aLimpia + aCar;
          |FINSI;
     |SIGUE;
     aAlfa = aLimpia;
|FPRC;


|PROCESO EsCondepo
     |DBASS aBase;
     |DFICE aEmpGes; aEmpGes = aEmpGes % -205;

     aEsEmpBase = "N";
     aAlfa = aBase + "condepo/def/condm000";
     |CARGA_DEF aAlfa, referen1@;
     |SI FSalida = 0;
          aAlfa = aBase + "condepo/def/condm001";
          |CARGA_DEF aAlfa, referen2@;
          |SI FSalida = 0;
               aAlfa = aBase + "condepo/fich/";
               |PATH_DAT #referen1@#aAlfa#;
               |ABRE #referen1@;
               |LEE 000#referen1@.p;
               |PARA; |SI FSalida = 0; |HACIENDO;
                    aAlfa = aBase + "condepo/fich/" + (("00000" + #referen1@#0) % -105) + "/";
                    |PATH_DAT #referen2@#aAlfa#;
                    |ABRE #referen2@;
                    |LEE 0000#referen2@.p;
                    |SI FSalida = 0;
                         |SI #referen2@#1 = aEmpGes;
                              aEsEmpBase = "S";
                              aEmpBase = ("00000" + #referen1@#0) % -105;
                         |FINSI;
                    |FINSI;
                    |CIERRA #referen2@;
                    |LEE 000#referen1@.s;
               |SIGUE;
               |CIERRA #referen1@;
               |DESCARGA_DEF #referen2@;
          |SINO;
               |MENAV "0000Error al cargar 'condm001'";
          |FINSI;
          |DESCARGA_DEF #referen1@;
     |FINSI;
|FPRC;

|PROCESO TipoCanon;
     campo = #referen1@#0; |QBF campo; variable = campo;
     |PINTA 1922,"                                                         ";
     |PINTA 1922, "TIP.CANON:";
     |PINTA 1935,variable;

     campo = #referen1@#1; variable = variable + tab + campo;
     campo = #referen1@#2; variable = variable + tab + campo;
     campo = #referen1@#3; variable = variable + tab + campo;

     variable = variable + aFinReg;
     |HAZ QuitaRaros;
     |SI #0#67 = "D";
          |HAZ Diferencia;
          |SI FSalida ! 0;
               |XGRABA nHandle, variable;
          |FINSI;
     |SINO;
          |XGRABA nHandle, variable;
     |FINSI;
|FPRC;

|DEFBUCLE TipoCanon;
     #referen1@#1001;
     ;
     00;
     99;
     ;
     NULL, TipoCanon;
|FIN;

|PROCESO CepsaxTipoCanon;
     |DBASS aBass;
     aAlfa = aBass + "dscepsax/def/sigaus06";
     |CARGA_DEF aAlfa, referen1@;
     |SI FSalida = 0;
          aAlfa = aBass + "dscepsax/fich/";
          |PATH_DAT #referen1@#aAlfa#;

          empresa = #0#29;
          |QBF empresa;
          aFicOrg = empresa + "tipocanon.txt";
          aFicDes = empresa + "tipocanon.asc";
          |DFICE empresa; empresa = empresa + Usuario;

          |XABRE "WB", empresa, nHandle;
          |SI FSalida ] 0;
               |HAZ IniDiferencia;
               |BUCLE TipoCanon;
               |XCIERRA nHandle;
               |HAZ FinDiferencia;
          |SINO;
               aAlfa = "0000Error al crear:" + empresa;
               |SI aParam = ""; |MENAV aAlfa; |FINSI;
          |FINSI;
          |DESCARGA_DEF #referen1@;
     |FINSI;
|FPRC;

|PROCESO ArtiCanon;
     campo = #referen1@#0; |QBF campo; variable = campo;
     |PINTA 1922,"                                                         ";
     |PINTA 1922, "ART.CANON:";
     |PINTA 1935,variable;

     campo = #referen1@#187; variable = variable + tab + campo;
     campo = #referen1@#102; variable = variable + tab + campo;

     variable = variable + aFinReg;
     |HAZ QuitaRaros;
     |SI #0#67 = "D";
          |HAZ Diferencia;
          |SI FSalida ! 0;
               |XGRABA nHandle, variable;
          |FINSI;
     |SINO;
          |XGRABA nHandle, variable;
     |FINSI;
|FPRC;

|DEFBUCLE ArtiCanon;
     #referen1@#1001;
     2,125;
     #0#7, #0#9,  #0#36;
     #0#8, #0#10, #0#37;
     ;
     NULL, ArtiCanon;
|FIN;

|PROCESO CepsaxArtiCanon;
     |DBASS aBass;
     aAlfa = aBass + "dscepsax/def/agifa019";
     |CARGA_DEF aAlfa, referen1@;
     |SI FSalida = 0;
          |DFICE aEmpBase; aEmpBase = aEmpBase % -202;
          aAlfa = aBass + "dscepsax/fich/" + aEmpBase + "/";
          |PATH_DAT #referen1@#aAlfa#;

          empresa = #0#29;
          |QBF empresa;
          aFicOrg = empresa + "articulocanon.txt";
          aFicDes = empresa + "articulocanon.asc";
          |DFICE empresa; empresa = empresa + Usuario;

          |XABRE "WB", empresa, nHandle;
          |SI FSalida ] 0;
               |HAZ IniDiferencia;
               |BUCLE ArtiCanon;
               |XCIERRA nHandle;
               |HAZ FinDiferencia;
          |SINO;
               aAlfa = "0000Error al crear:" + empresa;
               |SI aParam = ""; |MENAV aAlfa; |FINSI;
          |FINSI;
          |DESCARGA_DEF #referen1@;
     |FINSI;
|FPRC;

|PROCESO CliGama;
     campo = #referen1@#0; |QBF campo; variable = campo;
     |PINTA 1922,"                                                         ";
     |PINTA 1922, "CLI.GAMA:";
     |PINTA 1935,variable;

     |PARA i = 1; |SI i [ 9; |HACIENDO i = i + 1;
          campo = #referen1@#i#; |QBF campo;
          variable = variable + tab + campo;
     |SIGUE;

     variable = variable + aFinReg;
     |HAZ QuitaRaros;
     |SI #0#67 = "D";
          |HAZ Diferencia;
          |SI FSalida ! 0;
               |XGRABA nHandle, variable;
          |FINSI;
     |SINO;
          |XGRABA nHandle, variable;
     |FINSI;
|FPRC;

|DEFBUCLE CliGama;
     #referen1@#1004;
     ;
     #0#2, "   ", "     ", "  ";
     #0#3, "zzz", "zzzzz", "zz";
     ;
     NULL, CliGama;
|FIN;

|PROCESO CepsaxCliGama;
     |DBASS aBass;
     aAlfa = aBass + "dscepsax/def/dsm00029";
     |CARGA_DEF aAlfa, referen1@;
     |SI FSalida = 0;
          |DFICE aEmpBase; aEmpBase = aEmpBase % -202;
          aAlfa = aBass + "dscepsax/fich/" + aEmpBase + "/";
          |PATH_DAT #referen1@#aAlfa#;

          empresa = #0#29;
          |QBF empresa;
          aFicOrg = empresa + "cligama.txt";
          aFicDes = empresa + "cligama.asc";
          |DFICE empresa; empresa = empresa + Usuario;

          |XABRE "WB", empresa, nHandle;
          |SI FSalida ] 0;
               |HAZ IniDiferencia;
               |BUCLE CliGama;
               |XCIERRA nHandle;
               |HAZ FinDiferencia;
          |SINO;
               aAlfa = "0000Error al crear:" + empresa;
               |SI aParam = ""; |MENAV aAlfa; |FINSI;
          |FINSI;
          |DESCARGA_DEF #referen1@;
     |FINSI;
|FPRC;

|PROCESO GrupoGama;
     campo = #referen1@#0; |QBF campo; variable = campo;
     |PINTA 1922,"                                                         ";
     |PINTA 1922, "GRU.GAMA:";
     |PINTA 1935,variable;

     |PARA i = 1; |SI i [ 9; |HACIENDO i = i + 1;
          campo = #referen1@#i#; |QBF campo;
          variable = variable + tab + campo;
     |SIGUE;

     variable = variable + aFinReg;
     |HAZ QuitaRaros;
     |SI #0#67 = "D";
          |HAZ Diferencia;
          |SI FSalida ! 0;
               |XGRABA nHandle, variable;
          |FINSI;
     |SINO;
          |XGRABA nHandle, variable;
     |FINSI;
|FPRC;

|DEFBUCLE GrupoGama;
     #referen1@#1004;
     ;
     #0#31, "   ", "     ", "  ";
     #0#32, "zzz", "zzzzz", "zz";
     ;
     NULL, GrupoGama;
|FIN;

|PROCESO CepsaxGrupoGama;
     |DBASS aBass;
     aAlfa = aBass + "dscepsax/def/dsm00012";
     |CARGA_DEF aAlfa, referen1@;
     |SI FSalida = 0;
          |DFICE aEmpBase; aEmpBase = aEmpBase % -202;
          aAlfa = aBass + "dscepsax/fich/" + aEmpBase + "/";
          |PATH_DAT #referen1@#aAlfa#;

          empresa = #0#29;
          |QBF empresa;
          aFicOrg = empresa + "grugama.txt";
          aFicDes = empresa + "grugama.asc";
          |DFICE empresa; empresa = empresa + Usuario;

          |XABRE "WB", empresa, nHandle;
          |SI FSalida ] 0;
               |HAZ IniDiferencia;
               |BUCLE GrupoGama;
               |XCIERRA nHandle;
               |HAZ FinDiferencia;
          |SINO;
               aAlfa = "0000Error al crear:" + empresa;
               |SI aParam = ""; |MENAV aAlfa; |FINSI;
          |FINSI;
          |DESCARGA_DEF #referen1@;
     |FINSI;
|FPRC;

|PROCESO GrupoArtiLin;
     aAlfa = #referen1@#0; |QBF aAlfa;
     aAlfa = aAlfa + " " + #referen1@#1; |QBF aAlfa;
     |PINTA 1922,"                                                         ";
     |PINTA 1922, "GRU.ARTI:";
     |PINTA 1935, aAlfa;

     variable = #referen1@#0#;
     |PARA i = 1; |SI i [ 8; |HACIENDO i = i + 1;
          campo = #referen1@#i#; |QBF campo;
          variable = variable + tab + campo;
     |SIGUE;

     variable = variable + aFinReg;
     |HAZ QuitaRaros;
     |SI #0#67 = "D";
          |HAZ Diferencia;
          |SI FSalida ! 0;
               |XGRABA nHandle, variable;
          |FINSI;
     |SINO;
          |XGRABA nHandle, variable;
     |FINSI;
|FPRC;

|DEFBUCLE GrupoArtiLin;
     #referen1@#1004;
     ;
     aGrupo, aArti, fFec, 001;
     aGrupo, aArti, fFec, 999;
     ;
     NULL, GrupoArtiLin;
|FIN;

|PROCESO GrupoArti;
     |SI aGrupo ! #referen2@#0; |O aArti ! #referen2@#1;
          aGrupo = #referen2@#0;
          aArti = #referen2@#1;
          fFec = #referen2@#2;
          |BUCLE GrupoArtiLin
     |FINSI;
|FPRC;

|DEFBUCLE GrupoArti;
     #referen2@#1003;
     ;
     #0#31, #0#7, "31.12.9999";
     #0#32, #0#8, "01.01.0000";
     ;
     NULL, GrupoArti;
|FIN;

|PROCESO CepsaxGrupoArti;
     |DBASS aBass;
     aAlfa = aBass + "dscepsax/def/dsgalm90";
     |CARGA_DEF aAlfa, referen2@;
     |SI FSalida = 0;
          aAlfa = aBass + "dscepsax/def/dsgalm91";
          |CARGA_DEF aAlfa, referen1@;
          |SI FSalida = 0;
               |DFICE aEmpBase; aEmpBase = aEmpBase % -202;
               aAlfa = aBass + "dscepsax/fich/" + aEmpBase + "/";
               |PATH_DAT #referen1@#aAlfa#;
               |PATH_DAT #referen2@#aAlfa#;

               empresa = #0#29;
               |QBF empresa;
               aFicOrg = empresa + "gruarti.txt";
               aFicDes = empresa + "gruarti.asc";
               |DFICE empresa; empresa = empresa + Usuario;

               |XABRE "WB", empresa, nHandle;
               |SI FSalida ] 0;
                    |HAZ IniDiferencia;
                    aGrupo = ""; aArti = "";
                    |BUCLE GrupoArti;
                    |XCIERRA nHandle;
                    |HAZ FinDiferencia;
               |SINO;
                    aAlfa = "0000Error al crear:" + empresa;
                    |SI aParam = ""; |MENAV aAlfa; |FINSI;
               |FINSI;
               |DESCARGA_DEF #referen1@;
          |FINSI;
          |DESCARGA_DEF #referen2@;
     |FINSI;
|FPRC;

|PROCESO condm002;
     campo = #referen1@#0; |QBF campo; variable = campo + tab;
     campo = #referen1@#1; |QBF campo; variable = variable + campo;
     |PINTA 1922,"                                                         ";
     |PINTA 1922, "CTR AR/FA:";
     |PINTA 1935,variable;

     campo = #referen1@#2; variable = variable + tab + campo;

     variable = variable + aFinReg;
     |HAZ QuitaRaros;
     |SI #0#67 = "D";
          |HAZ Diferencia;
          |SI FSalida ! 0;
               |XGRABA nHandle, variable;
          |FINSI;
     |SINO;
          |XGRABA nHandle, variable;
     |FINSI;
|FPRC;

|DEFBUCLE condm002;
     #referen1@#1001;
     ;
     "   ";
     "zzz";
     ;
     NULL, condm002;
|FIN;

|PROCESO condm004;
     campo = #referen1@#0; |QBF campo; variable = campo + tab;
     campo = #referen1@#1; |QBF campo; variable = variable + campo;
     |PINTA 1922,"                                                         ";
     |PINTA 1922, "CLI/PRODU:";
     |PINTA 1935,variable;

     campo = #referen1@#2; variable = variable + tab + campo;
     campo = #referen1@#3; variable = variable + tab + campo;
     campo = #referen1@#4; variable = variable + tab + campo;
     campo = #referen1@#5; variable = variable + tab + campo;
     campo = #referen1@#6; variable = variable + tab + campo;
     campo = #referen1@#7; variable = variable + tab + campo;
     campo = #referen1@#8; variable = variable + tab + campo;
     campo = #referen1@#9; variable = variable + tab + campo;
     campo = #referen1@#10; variable = variable + tab + campo;
     campo = #referen1@#11; variable = variable + tab + campo;
     campo = #referen1@#12; variable = variable + tab + campo;
     campo = #referen1@#13; variable = variable + tab + campo;
     campo = #referen1@#14; variable = variable + tab + campo;
     campo = #referen1@#15; variable = variable + tab + campo;
     campo = #referen1@#16; variable = variable + tab + campo;
     campo = #referen1@#17; variable = variable + tab + campo;

     variable = variable + aFinReg;
     |HAZ QuitaRaros;
     |SI #0#67 = "D";
          |HAZ Diferencia;
          |SI FSalida ! 0;
               |XGRABA nHandle, variable;
          |FINSI;
     |SINO;
          |XGRABA nHandle, variable;
     |FINSI;
|FPRC;

|DEFBUCLE condm004;
     #referen1@#1002;
     ;
     "      ", "                    ";
     "zzzzzz", "zzzzzzzzzzzzzzzzzzzz";
     ;
     NULL, condm004;
|FIN;

|PROCESO JamaAlbSATLin;
     campo = #12#52;  variable = campo + tab;
     campo = #12#0; variable = variable + campo;
     |PINTA 1922,"                                                         ";
     |PINTA 1922, "ALB SAT:";
     |PINTA 1935,variable;

     ||La fecha se envia a la web del ineed con el formato AAAA-MM-DD
||     campo = #12#1; variable = variable + tab + campo;
     fFechaAlba = #12#1;
     aFechaAlba = fFechaAlba;
     aDia = aFechaAlba % 102;
     aMes = aFechaAlba % 402;
     aAny = aFechaAlba % -104;
     aFechaAlba = aAny + "-" + aMes + "-" + aDia;
     variable = variable + tab + aFechaAlba;

     campo = #12#3; variable = variable + tab + campo;
     campo = #12#6; variable = variable + tab + campo;
     campo = #12#55; variable = variable + tab + campo;
     campo = #12#15; variable = variable + tab + campo;
     campo = #12#67; variable = variable + tab + campo;
     campo = #referen2@#1; variable = variable + tab + campo;
     campo = #referen2@#2; variable = variable + tab + campo;
     campo = #referen2@#4; variable = variable + tab + campo;
     campo = #referen2@#5; variable = variable + tab + campo;
     campo = #referen2@#6; variable = variable + tab + campo;

     variable = variable + aFinReg;
     |HAZ QuitaRaros;
     |SI #0#67 = "D";
          |HAZ Diferencia;
          |SI FSalida ! 0;
               |XGRABA nHandle, variable;
          |FINSI;
     |SINO;
          |XGRABA nHandle, variable;
     |FINSI;
|FPRC;

|DEFBUCLE JamaAlbSATLin;
     #referen2@#1003;
     ;
     #12#52, #12#0, 001;
     #12#52, #12#0, 999;
     ;
     NULL, JamaAlbSATLin;
|FIN;

|PROCESO JamaAlbSAT;
     aDivisa = #12#68;
     aMoneda = #12#70;
     |HAZ Divisas010;
     |BUCLE JamaAlbSATLin;
|FPRC;

|DEFBUCLE JamaAlbSAT;
     #12#7;
     ;
     fDFecha, "     ", 000001;
     fHFecha, "zzzzz", 999999;
     ;
     NULL, JamaAlbSAT;
|FIN;

|PROCESO JamaCtrlVtaArtFam;
     aAlfa = aBase + "condepo/def/condm002";
     |CARGA_DEF aAlfa, referen1@;
     |SI FSalida = 0;
          aAlfa = aBase + "condepo/fich/" + aEmpBase + "/";
          |PATH_DAT #referen1@#aAlfa#;

          empresa = #0#29;
          |QBF empresa;
          aFicOrg = empresa + "ctrartfam.txt";
          aFicDes = empresa + "ctrartfam.asc";
          |DFICE empresa; empresa = empresa + Usuario;

          |XABRE "WB", empresa, nHandle;
          |SI FSalida ] 0;
               |HAZ IniDiferencia;
               |BUCLE condm002;
               |XCIERRA nHandle;
               |HAZ FinDiferencia;
          |SINO;
               aAlfa = "0000Error al crear:" + empresa;
               |SI aParam = ""; |MENAV aAlfa; |FINSI;
          |FINSI;

          |DESCARGA_DEF #referen1@;
     |FINSI;
|FPRC;

|PROCESO JamaProCli;
     aAlfa = aBase + "condepo/def/condm004";
     |CARGA_DEF aAlfa, referen1@;
     |SI FSalida = 0;
          aAlfa = aBase + "condepo/fich/" + aEmpBase + "/";
          |PATH_DAT #referen1@#aAlfa#;

          empresa = #0#29;
          |QBF empresa;
          aFicOrg = empresa + "cliproduc.txt";
          aFicDes = empresa + "cliproduc.asc";
          |DFICE empresa; empresa = empresa + Usuario;

          |XABRE "WB", empresa, nHandle;
          |SI FSalida ] 0;
               |HAZ IniDiferencia;
               |BUCLE condm004;
               |XCIERRA nHandle;
               |HAZ FinDiferencia;
          |SINO;
               aAlfa = "0000Error al crear:" + empresa;
               |SI aParam = ""; |MENAV aAlfa; |FINSI;
          |FINSI;

          |DESCARGA_DEF #referen1@;
     |FINSI;
|FPRC;

|PROCESO JamaAlbSat;
     aAlfa = aBase + "dscomer9/def/cafe0028";
     |CARGA_DEF aAlfa, referen1@;
     |SI FSalida = 0;
          |ABRE #referen1@;
          #referen1@#0 = #0#0;
          |LEE 000#referen1@.=;
          |SI FSalida = 0;
               aAlfa = aBase + "dscomer9/def/agifa071";
               |CARGA_DEF aAlfa, referen2@;
               |SI FSalida = 0;
                    aAlfa = (("00000" + #referen1@#1) % -105);
                    aAlfa = aBase + "dscomer9/fich/" + aAlfa + "/";
                    |PATH_DAT #agifa010#aAlfa#;
                    |PATH_DAT #referen2@#aAlfa#;
                    fHFecha = ~; nNume = fHFecha; nNume = nNume - #referen1@#2;
                    fDFecha = nNume;

                    empresa = #0#29;
                    |QBF empresa;
                    aFicOrg = empresa + "albaransat.txt";
                    aFicDes = empresa + "albaransat.asc";
                    |DFICE empresa; empresa = empresa + Usuario;

                    |XABRE "WB", empresa, nHandle;
                    |SI FSalida ] 0;
                         |HAZ IniDiferencia;
                         |BUCLE JamaAlbSAT;
                         |XCIERRA nHandle;
                         |HAZ FinDiferencia;
                    |SINO;
                         aAlfa = "0000Error al crear:" + empresa;
                         |SI aParam = ""; |MENAV aAlfa; |FINSI;
                    |FINSI;
                    |DESCARGA_DEF #referen2@;
               |FINSI;
          |FINSI;
          |CIERRA #referen1@;
          |DESCARGA_DEF #referen1@;
     |FINSI;
|FPRC;

|PROCESO PrimeMail;
     |QBF aMail;
     aAlfa = "";
     aLon = aMail % A0;
     |PARA i = 1; |SI i [ aLon; |HACIENDO i = i + 1;
          nPos = i * 100 + 1;
          aCar = aMail % nPos;
          |SI aCar = ";"; |SAL; |FINSI;
          aAlfa = aAlfa + aCar;
     |SIGUE;
     aMail = aAlfa;
|FPRC;

|PROCESO ExpRiesgos;
     campo = #38#0; variable = campo + tab;
     |PINTA 1922,"                                                         ";
     |PINTA 1922, "RIESGOS:";
     |PINTA 1935,variable;

     campo = #38#1; variable = variable +  campo + tab;
     campo = #38#2; variable = variable + campo + tab;
     campo = #38#3; variable = variable + campo + tab;
     campo = #38#4; variable = variable + campo + tab;
     campo = #38#5; variable = variable + campo + tab;
     campo = #38#6; variable = variable + campo + tab;
     campo = #38#7; variable = variable + campo + tab;
     campo = #38#8; variable = variable + campo + tab;
     campo = #38#9; variable = variable + campo + tab;
     campo = #38#10; variable = variable + campo + tab;

     variable = variable + aFinReg;
     |HAZ QuitaRaros;
     |SI #0#67 = "D";
          |HAZ Diferencia;
          |SI FSalida ! 0;
               |XGRABA nHandle, variable;
          |FINSI;
     |SINO;
          |XGRABA nHandle, variable;
     |FINSI;
|FPRC;

|DEFBUCLE ExpRiesgos;
     #38#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, ExpRiesgos;
|FIN;

|PROCESO dscam024;
     |DDEFECTO #38;
     #38#0 = #dscam023@#0;
     |LEE 101#38=;
     |SI FSalida ! 0; |GRABA 020#38b; |FINSI;
     #38#1 = #dscam023@#20;
     #38#2 = #dscam023@#19;
     #38#3 = #dscam024@#2;
     #38#4 = #dscam024@#3;
     #38#5 = #dscam024@#4;
     #38#6 = #dscam024@#6;
     #38#7 = #dscam024@#7;
     |SI #dscam038@#2 = "P"; #38#8 = "S"; |FINSI;
     |SI #dscam038@#2 = "A"; #38#9 = "S"; |FINSI;
     |SI #dscam038@#2 = "F"; #38#10 = "S"; |FINSI;
     |GRABA 020#38a;
     |LIBERA #38;
|FPRC;

|DEFBUCLE dscam024;
     #dscam024@#1002;
     ;
     aCliente, 01;
     aCliente, 99;
     ;
     NULL, dscam024;
|FIN;

|PROCESO dscam023;
     aCliente = #dscam023@#0;
     |BUCLE dscam024;
|FPRC;

|DEFBUCLE dscam023;
     #dscam023@#1001;
     ;
     "      ";
     "zzzzzz";
     ;
     NULL, dscam023;
|FIN;

|PROCESO dscam038;
     |DBASS aAlfa; |QBF aAlfa;
     aAlfa = aAlfa + "dscarter/fich/" + (("00000" + #dscam038@#5) % -105) + "/";
     |PATH_DAT #dscam023@#aAlfa#;
     |PATH_DAT #dscam024@#aAlfa#;
     |BUCLE dscam023;
|FPRC;

|DEFBUCLE dscam038;
     #dscam038@#1002;
     ;
     nEmpresa, 001;
     nEmpresa, 999;
     ;
     NULL, dscam038;
|FIN;

|PROCESO Riesgos;
     empresa = #0#29;
     |QBF empresa;
     aFicOrg = empresa + "riesgos.txt";
     aFicDes = empresa + "riesgos.asc";
     |DFICE empresa; empresa = empresa + Usuario;

     |XABRE "WB", empresa, nHandle;
     |SI FSalida ] 0;
          |HAZ IniDiferencia;
          |DBASS aPath; aAlfa = aPath + "dscarter/def/dscam038.mas";
          |CARGA_DEF aAlfa, dscam038@;
          |SI FSalida = 0;
               aAlfa = aPath + "dscarter/fich/";
               |PATH_DAT #dscam038@#aAlfa#;
               aAlfa = aPath + "dscarter/def/dscam023.mas";
               |CARGA_DEF aAlfa, dscam023@;
               |SI FSalida = 0;
                    aAlfa = aPath + "dscarter/def/dscam024.mas";
                    |CARGA_DEF aAlfa, dscam024@;
                    |SI FSalida = 0;
                         |HAZ CreaTempo; |NOME_DAT #38 eaTempo; |DELINDEX #38; |ABRE #38;
                         nEmpresa = #48#0;
                         |BUCLE dscam038;
                         |DESCARGA_DEF #dscam024@;
                         |BUCLE ExpRiesgos;
                         |CIERRA #38; |DELINDEX #38; |HAZ BoraTempo;
                    |FINSI;
                    |DESCARGA_DEF #dscam023@;
               |FINSI;
               |DESCARGA_DEF #dscam038@;
          |FINSI;
          |XCIERRA nHandle;
          |HAZ FinDiferencia;
     |SINO;
          aAlfa = "0000Error al crear:" + empresa;
          |SI aParam = ""; |MENAV aAlfa; |FINSI;
     |FINSI;
|FPRC;

|PROCESO CambiBarra; ||cambia \ por /
     aDato = "";
     aLon = variable % A0;
     |PARA i = 1; |SI i [ aLon; |HACIENDO i = i + 1;
          nPos = i * 100 + 1;
          aCar = variable % nPos;
          |SI aCar = "\"; aCar = "/"; |FINSI;
          aDato = aDato + aCar;
     |SIGUE;
     variable = aDato;
|FPRC;

|PROCESO psioa081;
     |SI #81#1 = #0#23; |O #81#1 = #0#24; |O #81#1 = #0#25; |O #81#1 = #0#26;
               |O #81#1 = #0#12; |O #81#1 = #0#13; |O #81#1 = #0#14; |O #81#1 = #0#15;
               |O #81#1 = #0#16; |O #81#1 = #0#17; |O #81#1 = #0#81; |O #81#1 = #0#19;

          campo = #81#0; |QBF campo; variable = campo + tab;
          campo = #81#1; |QBF campo; variable = variable + campo + tab;
          campo = #81#2; |QBF campo; variable = variable + campo;
          |PINTA 1922,"                                                         ";
          |PINTA 1922, "CLI.MOD:";
          |PINTA 1935,variable;

          variable = variable + tab;
          campo = #81#3; |QBF campo; variable = variable + campo + tab;
          campo = #81#4; |QBF campo; variable = variable + campo;

          variable = variable + aFinReg;
          |HAZ QuitaRaros;
          |SI #0#67 = "D";
               |HAZ Diferencia;
               |SI FSalida ! 0;
                    |XGRABA nHandle, variable;
               |FINSI;
          |SINO;
               |XGRABA nHandle, variable;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE psioa081;
     #81#1
     ;
     INICIO;
     FINAL;
     ;
     NULL, psioa081;
|FIN;

|PROCESO CliModi;
     empresa = #0#29;
     |QBF empresa;
     aFicOrg = empresa + "climodi.txt";
     aFicDes = empresa + "climodi.asc";
     |DFICE empresa; empresa = empresa + Usuario;

     |XABRE "WB", empresa, nHandle;
     |SI FSalida ] 0;
          |HAZ IniDiferencia;
          |BUCLE psioa081;
          |XCIERRA nHandle;
          |HAZ FinDiferencia;
     |SINO;
          aAlfa = "0000Error al crear:" + empresa;
          |SI aParam = ""; |MENAV aAlfa; |FINSI;
     |FINSI;
|FPRC;

|PROCESO agifa029;
     campo = #29#0; |QBF campo; variable = campo + tab;
     campo = #29#1; |QBF campo; variable = variable + campo;
     |PINTA 1922,"                                                         ";
     |PINTA 1922, "ALMACEN:";
     |PINTA 1935,variable;

     variable = variable + tab;
     campo = #29#2; |QBF campo; variable = variable + campo + tab;
     campo = #29#3; |QBF campo; variable = variable + campo + tab;
     campo = #29#4; |QBF campo; variable = variable + campo + tab;
     campo = #29#5; |QBF campo; variable = variable + campo + tab;
     campo = "";
     |SI #29#0 = #0#70; campo = "C"; |FINSI;
     |SI #29#0 = #0#27; campo = "P"; |FINSI;
     variable = variable + campo;

     variable = variable + aFinReg;
     |HAZ QuitaRaros;
     |SI #0#67 = "D";
          |HAZ Diferencia;
          |SI FSalida ! 0;
               |XGRABA nHandle, variable;
          |FINSI;
     |SINO;
          |XGRABA nHandle, variable;
     |FINSI;
     variable = "";
|FPRC;

|DEFBUCLE agifa029;
     #29#1
     ;
     INICIO;
     FINAL;
     ;
     NULL, agifa029;
|FIN;

|PROCESO Almacenes;
     empresa = #0#29;
     |QBF empresa;
     aFicOrg = empresa + "almacenes.txt";
     aFicDes = empresa + "almacenes.asc";
     |DFICE empresa; empresa = empresa + Usuario;

     |XABRE "WB", empresa, nHandle;
     |SI FSalida ] 0;
          |HAZ IniDiferencia;
          |BUCLE agifa029;
          |XCIERRA nHandle;
          |HAZ FinDiferencia;
     |SINO;
          aAlfa = "0000Error al crear:" + empresa;
          |SI aParam = ""; |MENAV aAlfa; |FINSI;
     |FINSI;
|FPRC;

|PROCESO agifa120;
     campo = #120#0; |QBF campo; variable = campo + tab;
     campo = #120#1; |QBF campo; variable = variable + campo;
     |PINTA 1922,"                                                         ";
     |PINTA 1922, "SUBFAMILIA:";
     |PINTA 1935,variable;
     variable = variable + aFinReg;
     |HAZ QuitaRaros;
     |SI #0#67 = "D";
          |HAZ Diferencia;
          |SI FSalida ! 0;
               |XGRABA nHandle, variable;
          |FINSI;
     |SINO;
          |XGRABA nHandle, variable;
     |FINSI;
     variable = "";
|FPRC;

|DEFBUCLE agifa120;
     #120#1
     ;
     INICIO;
     FINAL;
     ;
     NULL, agifa120;
|FIN;

|PROCESO Coima019;
     |SI #referen3@#1 = "S";
          |SI #referen1@#0 ! #referen3@#4; |Y #referen1@#0 ! #referen3@#5;
                    |Y #referen1@#0 ! #referen3@#6; |Y #referen1@#0 ! #referen3@#7;
                    |Y #referen1@#0 ! #referen3@#8; |Y #referen1@#0 ! #referen3@#9;
                    |Y #referen1@#0 ! #referen3@#10; |Y #referen1@#0 ! #referen3@#11;
                    |Y #referen1@#0 ! #referen3@#12; |Y #referen1@#0 ! #referen3@#13;
               |ACABA;
          |FINSI;
     |SINO;
          |SI #referen1@#0 < #referen3@#2; |O #referen1@#0 > #referen3@#3;
               |ACABA;
          |FINSI;
     |FINSI;

     #referen2@#0 = #referen1@#0;
     |LEE 000#referen2@.=;
     |SI FSalida ! 0; |DDEFECTO #referen2@; |FINSI;

     aAlfa = #referen2@#22;
     aAlfa = aAlfa + (("000" + #referen1@#1) % -103);
     campo = aAlfa; |QBF campo; variable = campo + tab;

     aAlfa = #referen1@#2; |QBF aAlfa;
     aAlfa = aAlfa + " " + #referen1@#10; |QBF aAlfa;
     aAlfa = aAlfa + " " + #referen1@#11; |QBF aAlfa;
     aAlfa = aAlfa + " " + #referen1@#12; |QBF aAlfa;
     campo = aAlfa; |QBF campo; variable = variable + campo;
     aAlfa = variable % 160;
     |PINTA 1922,"                                                         ";
     |PINTA 1922, "COLECCIONES:";
     |PINTA 1935, aAlfa;
     variable = variable + aFinReg;
     |HAZ CambiBarra; |HAZ QuitaRaros;
     |SI #0#67 = "D";
          |HAZ Diferencia;
          |SI FSalida ! 0;
               |XGRABA nHandle, variable;
          |FINSI;
     |SINO;
          |XGRABA nHandle, variable;
     |FINSI;
     variable = "";
|FPRC;

|DEFBUCLE Coima019;
     #referen1@#1002;
     ;
     000, 000;
     999, 999;
     ;
     NULL, Coima019;
|FIN;

|PROCESO SubFamCoimasa;
     |DDEF aAlfa;
     aAlfa = aAlfa + "coima019";
     |CARGA_DEF aAlfa, referen1@;
     |SI FSalida = 0;
          |DDEF aAlfa;
          aAlfa = aAlfa + "coima018";
          |CARGA_DEF aAlfa, referen2@;
          |SI FSalida = 0;
               |DDEF aAlfa;
               aAlfa = aAlfa + "coima046";
               |CARGA_DEF aAlfa, referen3@;
               |SI FSalida = 0;
                    |ABRE #referen3@;
                    #referen3@#0 = #0#0;
                    |LEE 000#referen3@.=;
                    |SI FSalida ! 0; |DDEFECTO #referen3@; |FINSI;
                    |CIERRA #referen3@;

                    |ABRE #referen2@;
                    |BUCLE Coima019;
                    |CIERRA #referen2@;
                    |DESCARGA_DEF #referen3@;
               |FINSI;
               |DESCARGA_DEF #referen2@;
          |FINSI;
          |DESCARGA_DEF #referen1@;
     |FINSI;
|FPRC;

|PROCESO Subfamilias;
     empresa = #0#29;
     |QBF empresa;
     aFicOrg = empresa + "subfamilias.txt";
     aFicDes = empresa + "subfamilias.asc";
     ||empresa = empresa + "subfamilias.txt";
     |DFICE empresa; empresa = empresa + Usuario;

     |XABRE "WB", empresa, nHandle;
     |SI FSalida ] 0;
          |HAZ IniDiferencia;
/*
          |SI nSwCoimasa = 0;
               |HAZ SubFamCoimasa;
          |SINO;
*/
               |BUCLE agifa120;
||          |FINSI;
          |XCIERRA nHandle;
          |HAZ FinDiferencia;
     |SINO;
          aAlfa = "0000Error al crear:" + empresa;
          |SI aParam = ""; |MENAV aAlfa; |FINSI;
     |FINSI;
|FPRC;

|PROCESO agifa060;
     campo = #160#0; |QBF campo; variable = campo + tab;
     campo = #160#1; |QBF campo; variable = variable + campo + tab;
     |PINTA 1922,"                                                         ";
     |PINTA 1922, "FAMILIAS..:";
     |PINTA 1935,variable;
     campo = #160#2; |QBF campo; variable = variable + campo + tab;
     campo = #160#3; |QBF campo; variable = variable + campo + tab;
     campo = #160#4; |QBF campo; variable = variable + campo + tab;
     campo = #160#5; |QBF campo; variable = variable + campo;
     variable = variable + campo + aFinReg;
     |HAZ QuitaRaros;
     |SI #0#67 = "D";
          |HAZ Diferencia;
          |SI FSalida ! 0;
               |XGRABA nHandle, variable;
          |FINSI;
     |SINO;
          |XGRABA nHandle, variable;
     |FINSI;
     variable = "";
|FPRC;

|DEFBUCLE agifa060;
     #160#1
     ;
     INICIO;
     FINAL;
     ;
     NULL, agifa060;
|FIN;

|PROCESO Coima018;
     |SI #referen3@#1 = "S";
          |SI #referen1@#0 ! #referen3@#4; |Y #referen1@#0 ! #referen3@#5;
                    |Y #referen1@#0 ! #referen3@#6; |Y #referen1@#0 ! #referen3@#7;
                    |Y #referen1@#0 ! #referen3@#8; |Y #referen1@#0 ! #referen3@#9;
                    |Y #referen1@#0 ! #referen3@#10; |Y #referen1@#0 ! #referen3@#11;
                    |Y #referen1@#0 ! #referen3@#12; |Y #referen1@#0 ! #referen3@#13;
               |ACABA;
          |FINSI;
     |SINO;
          |SI #referen1@#0 < #referen3@#2; |O #referen1@#0 > #referen3@#3;
               |ACABA;
          |FINSI;
     |FINSI;

     campo = #referen1@#22; |QBF campo; variable = campo + tab;
     aAlfa = #referen1@#1; |QBF aAlfa;
     aAlfa = aAlfa + " " + #referen1@#14; |QBF aAlfa;
     aAlfa = aAlfa + " " + #referen1@#15; |QBF aAlfa;
     aAlfa = aAlfa + " " + #referen1@#16; |QBF aAlfa;
     campo = aAlfa; |QBF campo; variable = variable + campo + tab;

     aAlfa = variable % 160;
     |PINTA 1922,"                                                         ";
     |PINTA 1922, "CATALOGOS.:";
     |PINTA 1935, aAlfa;
     campo = ""; |QBF campo; variable = variable + campo + tab;
     campo = ""; |QBF campo; variable = variable + campo + tab;
     campo = ""; |QBF campo; variable = variable + campo + tab;
     campo = ""; |QBF campo; variable = variable + campo;
     variable = variable + campo + aFinReg;
     |HAZ CambiBarra; |HAZ QuitaRaros;
     |SI #0#67 = "D";
          |HAZ Diferencia;
          |SI FSalida ! 0;
               |XGRABA nHandle, variable;
          |FINSI;
     |SINO;
          |XGRABA nHandle, variable;
     |FINSI;
     variable = "";
|FPRC;

|DEFBUCLE Coima018;
     #referen1@#1001;
     ;
     000;
     999;
     ;
     NULL, Coima018;
|FIN;

|PROCESO FamCoimasa;
     |DDEF aAlfa;
     aAlfa = aAlfa + "coima018";
     |CARGA_DEF aAlfa, referen1@;
     |SI FSalida = 0;
          |DDEF aAlfa;
          aAlfa = aAlfa + "coima046";
          |CARGA_DEF aAlfa, referen3@;
          |SI FSalida = 0;
               |ABRE #referen3@;
               #referen3@#0 = #0#0;
               |LEE 000#referen3@.=;
               |SI FSalida ! 0; |DDEFECTO #referen3@; |FINSI;
               |CIERRA #referen3@;

               |BUCLE Coima018;
               |DESCARGA_DEF #referen3@;
          |FINSI;
          |DESCARGA_DEF #referen1@;
     |FINSI;
|FPRC;

|PROCESO Familias;
     empresa = #0#29;
     |QBF empresa;
     aFicOrg = empresa + "familias.txt";
     aFicDes = empresa + "familias.asc";
     ||empresa = empresa + "familias.txt";
     |DFICE empresa; empresa = empresa + Usuario;

     |XABRE "WB", empresa, nHandle;
     |SI FSalida ] 0;
          |HAZ IniDiferencia;
/*
          |SI nSwCoimasa = 0;
               |HAZ FamCoimasa;
          |SINO;
*/
               |BUCLE agifa060;    ||la estandar
||          |FINSI;
          |XCIERRA nHandle;
          |HAZ FinDiferencia;
     |SINO;
          aAlfa = "0000Error al crear:" + empresa;
          |SI aParam = ""; |MENAV aAlfa; |FINSI;
     |FINSI;
|FPRC;

|PROCESO BDobleStock;
     #referen1@#0 = #3#201;
     |LEE 000#referen1@.=;
     |SI FSalida ! 0; |DDEFECTO #referen1@; |FINSI;

     campo = #3#0; |QBF campo; variable = campo + tab;
     |PINTA 1922,"                                                         ";
     |PINTA 1922, "ARTICULO:";
     |PINTA 1935,variable;

     ||No se usa el codigo del dobleStock
     ||campo = #3#201; variable = variable + campo + tab;
     campo = #referen1@#14; variable = variable + campo + tab;
     campo = #referen1@#3; variable = variable + campo + tab;
     campo = #referen1@#5; variable = variable + campo + tab;
     campo = #referen1@#15; variable = variable + campo + tab;
     campo = #referen1@#2; variable = variable + campo + tab;
     campo = #referen1@#4; variable = variable + campo + tab;
     campo = #referen1@#6; variable = variable + campo;

     variable = variable + aFinReg;
     |HAZ QuitaRaros;
     |SI #0#67 = "D";
          |HAZ Diferencia;
          |SI FSalida ! 0;
               |XGRABA nHandle, variable;
          |FINSI;
     |SINO;
          |XGRABA nHandle, variable;
     |FINSI;
     variable = "";
|FPRC;

|DEFBUCLE BDobleStock;
     #3#1
     179;
     "                    ", "S";
     "zzzzzzzzzzzzzzzzzzzz", "S";
     ;
     NULL, BDobleStock;
|FIN;

|PROCESO DobleStock;
     empresa = #0#29;
     |QBF empresa;
     aFicOrg = empresa + "confdoblestock.txt";
     aFicDes = empresa + "confdoblestock.asc";
     |DFICE empresa; empresa = empresa + Usuario;

     |XABRE "WB", empresa, nHandle;
     |SI FSalida ] 0;
          |HAZ IniDiferencia;
          |DDEF aAlfa;
          aAlfa = aAlfa + "dsm00238";
          |CARGA_DEF aAlfa, referen1@;
          |SI FSalida = 0;
               |ABRE #referen1@;
               |BUCLE BDobleStock;
               |DESCARGA_DEF #referen1@;
          |FINSI;
          |XCIERRA nHandle;
          |HAZ FinDiferencia;
     |SINO;
          aAlfa = "0000Error al crear:" + empresa;
          |SI aParam = ""; |MENAV aAlfa; |FINSI;
     |FINSI;
|FPRC;

|PROCESO carm0001;
     campo = #referen1@#1; variable = variable + tab + campo;
     campo = #referen1@#2; variable = variable + tab + campo;
     campo = #referen1@#3; variable = variable + tab + campo;
     campo = #referen1@#4; variable = variable + tab + campo;
|FPRC;

|DEFBUCLE carm0001;
     #referen1@#1002;
     ;
     aTipo, "01.01.0000";
     aTipo, "31.12.9999";
     ;
     NULL, carm0001;
|FIN;

|PROCESO carm0002;
     campo = #referen2@#0; |QBF campo; variable = campo + tab;
     campo = #referen2@#1; |QBF campo; variable = variable + campo;
     |PINTA 1922,"                                                         ";
     |PINTA 1922, "IMPUESTOS:";
     |PINTA 1935,variable;
     aTipo = #referen2@#1;
     |BUCLE carm0001;
     variable = variable + aFinReg;
     |HAZ QuitaRaros;
     |SI #0#67 = "D";
          |HAZ Diferencia;
          |SI FSalida ! 0;
               |XGRABA nHandle, variable;
          |FINSI;
     |SINO;
          |XGRABA nHandle, variable;
     |FINSI;
     variable = "";
|FPRC;

|DEFBUCLE carm0002;
     #referen2@#1001;
     ;
     "                    ";
     "zzzzzzzzzzzzzzzzzzzz";
     ;
     NULL, carm0002;
|FIN;

|PROCESO CarImpuesto;
     |DDEF aPath;
     aAlfa = aPath + "carm0001";
     |CARGA_DEF aAlfa, referen1@;
     |SI FSalida ! 0;
          |SI aParam = ""; |MENAV "0000Error al cargar 'carm0001'"; |FINSI;
          |ACABA;
     |FINSI;

     aAlfa = aPath + "carm0002";
     |CARGA_DEF aAlfa, referen2@;
     |SI FSalida ! 0;
          |SI aParam = ""; |MENAV "0000Error al cargar 'carm0002'"; |FINSI;
     |SINO;
          empresa = #0#29;
          |QBF empresa;
          aFicOrg = empresa + "impuesto.txt";
          aFicDes = empresa + "impuesto.asc";
          ||empresa = empresa + "impuesto.txt";
          |DFICE empresa; empresa = empresa + Usuario;

          |XABRE "WB", empresa, nHandle;
          |SI FSalida ] 0;
               |HAZ IniDiferencia;
               |BUCLE carm0002;
               |XCIERRA nHandle;
               |HAZ FinDiferencia;
          |SINO;
               aAlfa = "0000Error al crear:" + empresa;
               |SI aParam = ""; |MENAV aAlfa; |FINSI;
          |FINSI;
          |DESCARGA_DEF #referen2@;
     |FINSI;
     |DESCARGA_DEF #referen1@;
|FPRC;

|PROCESO Ansi2Utf8;
     |QUE_SISTEMA aAlfa;
     |SI #0#59 = 1; |O #0#74 = "S"; |O aAlfa = "ESDOS";
          |DFICE aOrigen; aOrigen = aOrigen + Usuario;
          |SI #0#74 = "C";
               |ENVIA_FICHERO aOrigen, aFicDes;
          |SINO;
               |COPIA_FICHERO aOrigen, aFicDes;
          |FINSI;
          |FBORRA aOrigen;
     |SINO;
          aIP = "";
          |IP_REMOTO aIP;
          |DBASE aBase;
          |ESPECIFICA "RBASS", aLocal;

          aOrigen = aBase + "00psion/ansitoutf8.exe"
          aDestino = aLocal + "/bin/ansitoutf8.exe";
          aConte = aOrigen;
          |ESPECIFICA "MD5", aConte;
          aVer1 = FSalida;
          aConte = aDestino;
          |ESPECIFICA "REMOTOMD5", aConte;
          aVer2 = FSalida;
          |SI aVer1 ! aVer2;
               |SI aIP ! "";
                    |ENVIA_FICHERO aOrigen, aDestino;
               |SINO;
                    |COPIA_FICHERO aOrigen, aDestino;
               |FINSI;
          |FINSI;

          |DFICE aOrigen; aOrigen = aOrigen + Usuario;
          |ENVIA_FICHERO aOrigen, aFicOrg;

          aAlfa = aDestino + " 4 " + aFicOrg + " " + aFicDes;
          aLon = aAlfa % A0;
          aExe = "";
          |PARA i = 1; |SI i [ aLon; |HACIENDO i = i + 1;
               nPos = i * 100 + 1;
               aCar = aAlfa % nPos;
               |SI aCar = "/"; aCar = "\"; |FINSI;
               aExe = aExe + aCar;
          |SIGUE;

          aExe = "cmd " + &34 + "/c START /MIN /WAIT " + aExe + &34;
          |RSYSTEM aExe;
          |RFBORRA aFicOrg;
     |FINSI;
|FPRC;

|PROCESO QuitaRaros;
     |QUE_SISTEMA aAlfa;
     |SI #0#74 = "S"; |O aAlfa = "ESDOS";   ||Cuando es en el servidor
          aCadena = "";
          aLen = variable % 0;
          nLen = aLen;
          |PARA nCampo = 1;  |SI nCampo [ nLen;  |HACIENDO nCampo = nCampo + 1;
                nPosi = (100 * nCampo) + 1;
                aCaracter = variable % nPosi;
                |SI aCaracter = "¥";  aCaracter = &209; |FINSI;
                |SI aCaracter = "¤";  aCaracter = &241; |FINSI;
                |SI aCaracter = " ";  aCaracter = &225; |FINSI;
                |SI aCaracter = "";  aCaracter = &233; |FINSI;
                |SI aCaracter = "¡";  aCaracter = &237; |FINSI;
                |SI aCaracter = "¢";  aCaracter = &243; |FINSI;
                |SI aCaracter = "£";  aCaracter = &250; |FINSI;
                |SI aCaracter = "§";  aCaracter = &176; |FINSI;
                |SI aCaracter = "¦";  aCaracter = &170; |FINSI;
                |SI aCaracter = "¦";  aCaracter = &170; |FINSI;
                |SI aCaracter = "°";  aCaracter = &176; |FINSI;  ||Euro
                aCadena = aCadena + aCaracter;
          |SIGUE;
          variable = aCadena;
     |FINSI;
|FPRC;

|PROCESO dsm00134;
     campo = #134#0; |QBF campo; variable = campo + tab;
     campo = #134#1; |QBF campo; variable = variable + campo + tab;
     |PINTA 1922,"                                                         ";
     |PINTA 1922, "PROMOCION.:";
     |PINTA 1935,variable;
     campo = #134#2; |QBF campo; variable = variable + campo + tab;
     campo = #134#3; |QBF campo; variable = variable + campo + tab;
     campo = #134#4; |QBF campo; variable = variable + campo + tab;
     campo = #134#5; |QBF campo; variable = variable + campo + tab;
     campo = #134#6; |QBF campo; variable = variable + campo + tab;
     campo = #134#7; |QBF campo;
     variable = variable + campo + aFinReg;
     |HAZ QuitaRaros;
     |SI #0#67 = "D";
          |HAZ Diferencia;
          |SI FSalida ! 0;
               |XGRABA nHandle, variable;
          |FINSI;
     |SINO;
          |XGRABA nHandle, variable;
     |FINSI;
     variable = "";
|FPRC;

|DEFBUCLE dsm00134;
     #134#1
     ;
     #0#2, #0#7;
     #0#3, #0#8;
     ;
     NULL, dsm00134;
|FIN;

|PROCESO PromoCliArt;
     empresa = #0#29;
     |QBF empresa;
     aFicOrg = empresa + "prcliart.txt";
     aFicDes = empresa + "prcliart.asc";
     ||empresa = empresa + "prcliart.txt";
     |DFICE empresa; empresa = empresa + Usuario;

     |XABRE "WB", empresa, nHandle;
     |SI FSalida ] 0;
          |HAZ IniDiferencia;
          |SI #agifa142#250 = "S";
               |BUCLE dsm00134;
          |FINSI;
          |XCIERRA nHandle;
          |HAZ FinDiferencia;
     |SINO;
          aAlfa = "0000Error al crear:" + empresa;
          |SI aParam = ""; |MENAV aAlfa; |FINSI;
     |FINSI;
|FPRC;

|PROCESO agim0001;
     campo = #101#0; |QBF campo; variable = campo;
     campo = #101#1; |QBF campo; variable = variable + tab + campo;
     campo = #101#2; |QBF campo; variable = variable + tab + campo;

     |PINTA 1922,"                                                         ";
     |PINTA 1922, "ENVASES.:";
     |PINTA 1935,variable;
     variable = variable + aFinReg;
     |HAZ QuitaRaros;
     |SI #0#67 = "D";
          |HAZ Diferencia;
          |SI FSalida ! 0;
               |XGRABA nHandle, variable;
          |FINSI;
     |SINO;
          |XGRABA nHandle, variable;
     |FINSI;
     variable = "";
|FPRC;

|DEFBUCLE agim0001;
     #101#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, agim0001;
|FIN;

|PROCESO Envases;
     empresa = #0#29;
     |QBF empresa;
     aFicOrg = empresa + "envase.txt";
     aFicDes = empresa + "envase.asc";
     ||empresa = empresa + "envase.txt";
     |DFICE empresa; empresa = empresa + Usuario;

     |XABRE "WB", empresa, nHandle;
     |SI FSalida ] 0;
          |HAZ IniDiferencia;
          |BUCLE agim0001;
          |XCIERRA nHandle;
          |HAZ FinDiferencia;
     |SINO;
          aAlfa = "0000Error al crear:" + empresa;
          |SI aParam = ""; |MENAV aAlfa; |FINSI;
     |FINSI;
|FPRC;

|PROCESO agifa112;
     campo = #112#0; |QBF campo; variable = campo + tab;
     campo = #112#1; |QBF campo; variable = variable + campo + tab;
     |PINTA 1922,"                                                         ";
     |PINTA 1922, "PROVEEDOR.:";
     |PINTA 1935,variable;
     campo = #112#9; |QBF campo; variable = variable + campo + tab;
     campo = #112#3; |QBF campo; variable = variable + campo + tab;
     campo = #112#4; |QBF campo; variable = variable + campo + tab;
     campo = #112#76; |QBF campo; variable = variable + campo + tab;
     campo = #112#5; |QBF campo; variable = variable + campo;
     variable = variable + aFinReg;
     |HAZ QuitaRaros;
     |SI #0#67 = "D";
          |HAZ Diferencia;
          |SI FSalida ! 0;
               |XGRABA nHandle, variable;
          |FINSI;
     |SINO;
          |XGRABA nHandle, variable;
     |FINSI;
     variable = "";
|FPRC;

|DEFBUCLE agifa112;
     #112#1;
     ;
     #0#64;
     #0#65;
     ;
     NULL, agifa112;
|FIN;

|PROCESO Proveedores;
     empresa = #0#29;
     |QBF empresa;
     aFicOrg = empresa + "proveedo.txt";
     aFicDes = empresa + "proveedo.asc";
     ||empresa = empresa + "proveedo.txt";
     |DFICE empresa; empresa = empresa + Usuario;

     |XABRE "WB", empresa, nHandle;
     |SI FSalida ] 0;
          |HAZ IniDiferencia;
          |BUCLE agifa112;
          |XCIERRA nHandle;
          |HAZ FinDiferencia;
     |SINO;
          aAlfa = "0000Error al crear:" + empresa;
          |SI aParam = ""; |MENAV aAlfa; |FINSI;
     |FINSI;
|FPRC;

|PROCESO dsl00001;
     |SI #100#1 < #0#7; |O #100#1 > #0#8;
          |ACABA;
     |FINSI;
     #3#0 = #100#1;
     |LEE 000#3=;
     |SI FSalida ! 0; |ACABA; |FINSI;
     |SI #3#2 < #0#9; |O #3#2 > #0#10;
          |ACABA;
     |FINSI;
     |SI #3#125 < #0#36; |O #3#125 > #0#37;
          |ACABA;
     |FINSI;

     campo = #100#3; |QBF campo; variable = campo + tab;
     campo = #100#1; |QBF campo; variable = variable + campo + tab;

     |PINTA 1922,"                                                         ";
     |PINTA 1922, "COD.BARRAS:";
     |PINTA 1935,variable;
     campo = #100#6; |QBF campo; variable = variable + tab + campo + aFinReg;
     |HAZ QuitaRaros;
     |SI #0#67 = "D";
          |HAZ Diferencia;
          |SI FSalida ! 0;
               |XGRABA nHandle, variable;
          |FINSI;
     |SINO;
          |XGRABA nHandle, variable;
     |FINSI;
     variable = "";
|FPRC;

|DEFBUCLE dsl00001;
     #100#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, dsl00001;
|FIN;

|PROCESO CodBarra;
     empresa = #0#29;
     |QBF empresa;
     aFicOrg = empresa + "codbar.txt";
     aFicDes = empresa + "codbar.asc";
     ||empresa = empresa + "codbar.txt";
     |DFICE empresa; empresa = empresa + Usuario;

     |XABRE "WB", empresa, nHandle;
     |SI FSalida ] 0;
          |HAZ IniDiferencia;
          |ABRE #3;
          |BUCLE dsl00001;
          |CIERRA #3;
          |XCIERRA nHandle;
          |HAZ FinDiferencia;
     |SINO;
          aAlfa = "0000Error al crear:" + empresa;
          |SI aParam = ""; |MENAV aAlfa; |FINSI;
     |FINSI;
|FPRC;

|PROCESO agifa025;
     |SI #0#59 = 3;
          |SI #25#0 = "00"; |ACABA; |FINSI;
          |SI #25#0 = "  "; |ACABA; |FINSI;
     |FINSI;
     campo = #25#0; |QBF campo;
     variable = campo + tab;
     campo = #25#1; |QBF campo;
     variable = variable + campo;
     |PINTA 1922,"                                                         ";
     |PINTA 1922, "REPRESENT.:";
     |PINTA 1935,variable;
     variable = variable + aFinReg;
     |HAZ QuitaRaros;
     |SI #0#67 = "D";
          |HAZ Diferencia;
          |SI FSalida ! 0;
               |XGRABA nHandle, variable;
          |FINSI;
     |SINO;
          |XGRABA nHandle, variable;
     |FINSI;
     variable = "";
|FPRC;

|DEFBUCLE agifa025;
     #25#1;
     ;
     #0#39;
     #0#40;
     ;
     NULL, agifa025;
|FIN;

|PROCESO Representantes;
     empresa = #0#29;
     |QBF empresa;
     aFicOrg = empresa + "represen.txt";
     aFicDes = empresa + "represen.asc";
     ||empresa = empresa + "represen.txt";
     |DFICE empresa; empresa = empresa + Usuario;

     |XABRE "WB", empresa, nHandle;
     |SI FSalida ] 0;
          |HAZ IniDiferencia;
          |BUCLE agifa025;
          |XCIERRA nHandle;
          |HAZ FinDiferencia;
     |SINO;
          aAlfa = "0000Error al crear:" + empresa;
          |SI aParam = ""; |MENAV aAlfa; |FINSI;
     |FINSI;
|FPRC;

|PROCESO dsm00024;
     #3#0 = #24#0;
     |LEE 000#3=;
     |SI FSalida ! 0; |O #3#180 = "N"; |ACABA; |FINSI;

     |SI #3#125 < #0#36; |O #3#125 > #0#37; |ACABA; |FINSI; ||Linea
     |SI #3#2 < #0#9; |O #3#2 > #0#10; |ACABA; |FINSI;      ||Familia

     |SI #0#60 = "S"; |Y #24#22 [ 0; || Sin Stock
          |ACABA;
     |FINSI;

     campo = #24#0; |QBF campo;
     variable = campo + tab;
     campo = #24#2; |QBF campo;
     variable = variable + campo + tab;
     |PINTA 1922,"                                                         ";
     |PINTA 1922, "PARTIDA   :";
     |PINTA 1935,variable;
     campo = #24#22; |QBF campo;
     variable = variable + campo + aFinReg;
     |HAZ QuitaRaros;
     |SI #0#67 = "D";
          |HAZ Diferencia;
          |SI FSalida ! 0;
               |XGRABA nHandle, variable;
          |FINSI;
     |SINO;
          |XGRABA nHandle, variable;
     |FINSI;
     variable = "";
|FPRC;

|DEFBUCLE dsm00024;
     #24#1;
     ;
     #0#7, nAlma, "                              ";
     #0#8, nAlma, "zzzzzzzzzzzzzzzzzzzzzzzzzzzzzz";
     ;
     NULL, dsm00024;
|FIN;

|PROCESO Partidas;
     empresa = #0#29;
     |QBF empresa;
     aFicOrg = empresa + "partidas.txt";
     aFicDes = empresa + "partidas.asc";
     ||empresa = empresa + "partidas.txt";
     |DFICE empresa; empresa = empresa + Usuario;

     |XABRE "WB", empresa, nHandle;
     |SI FSalida ] 0;
          |HAZ IniDiferencia;
          nAlma = #0#27;
          |ABRE #3;
          |BUCLE dsm00024;
          |CIERRA #3;
          |XCIERRA nHandle;
          |HAZ FinDiferencia;
     |SINO;
          aAlfa = "0000Error al crear:" + empresa;
          |SI aParam = ""; |MENAV aAlfa; |FINSI;
     |FINSI;
|FPRC;

|PROCESO dsm00024_1;
     #3#0 = #24#0;
     |LEE 000#3=;
     |SI FSalida ! 0; |O #3#180 = "N"; |ACABA; |FINSI;

     |SI #3#125 < #0#36; |O #3#125 > #0#37; |ACABA; |FINSI; ||Linea
     |SI #3#2 < #0#9; |O #3#2 > #0#10; |ACABA; |FINSI;      ||Familia

     |SI #0#60 = "S"; |Y #24#22 [ 0; || Sin Stock
          |ACABA;
     |FINSI;

     campo = nAlma; |QBF campo;
     variable = campo + tab;

     campo = #24#0; |QBF campo;
     variable = variable + campo + tab;

     campo = #24#2; |QBF campo;
     variable = variable + campo + tab;
     |PINTA 1922,"                                                         ";
     |PINTA 1922, "PARTIDA1  :";
     |PINTA 1935,variable;
     campo = #24#22; |QBF campo;
     variable = variable + campo + aFinReg;
     |HAZ QuitaRaros;
     |SI #0#67 = "D";
          |HAZ Diferencia;
          |SI FSalida ! 0;
               |XGRABA nHandle, variable;
          |FINSI;
     |SINO;
          |XGRABA nHandle, variable;
     |FINSI;
     variable = "";
|FPRC;

|DEFBUCLE dsm00024_1;
     #24#1;
     ;
     #0#7, nAlma, "                              ";
     #0#8, nAlma, "zzzzzzzzzzzzzzzzzzzzzzzzzzzzzz";
     ;
     NULL, dsm00024_1;
|FIN;

|PROCESO PartiGen;
     empresa = #0#29;
     |QBF empresa;
     aFicOrg = empresa + "partidas1.txt";
     aFicDes = empresa + "partidas1.asc";
     ||empresa = empresa + "partidas1.txt";
     |DFICE empresa; empresa = empresa + Usuario;

     |XABRE "WB", empresa, nHandle;
     |SI FSalida ] 0;
          |HAZ IniDiferencia;
          nAlma = #0#70;
          |ABRE #3;
          |BUCLE dsm00024_1;
          |CIERRA #3;
          |XCIERRA nHandle;
          |HAZ FinDiferencia;
     |SINO;
          aAlfa = "0000Error al crear:" + empresa;
          |SI aParam = ""; |MENAV aAlfa; |FINSI;
     |FINSI;
|FPRC;

|PROCESO psioa030;
     #3#0 = #30#2;
     |LEE 000#3=;
     |SI FSalida ! 0; |O #0#6 = "N"; |ACABA; |FINSI;
     |SI #3#125 < #0#36; |O #3#125 > #0#37; |ACABA; |FINSI; ||Linea
     |SI #3#2 < #0#9; |O #3#2 > #0#10; |ACABA; |FINSI;      ||Familia

     #2#0 = #30#0;
     |LEE 000#2=
     |SI FSalida ! 0; |O #0#1 = "N"; |ACABA; |FINSI;
     |SI #2#3 < #0#4;|O #2#3 > #0#5; |ACABA; |FINSI;          || Zona
     |SI #2#25 < #0#39;|O #2#25 > #0#40; |ACABA; |FINSI;      || Repre
     |SI #2#158 < #0#31;|O #2#158 > #0#32; |ACABA; |FINSI;    || Grupo
     |SI #2#4 < #0#33;|O #2#4 > #0#34; |ACABA; |FINSI;        || Tipo
     |SI #2#39 < #0#51;|O #2#39 > #0#52; |ACABA; |FINSI;      || Tarifa

     campo = #30#0; |QBF campo;
     variable = campo + tab;
     campo = #30#1; |QBF campo;
     variable = variable + campo + tab;

     campo = #30#2; |QBF campo;
/*
     |SI nSwCoimasa = 0; campo = aCoimaArt; |FINSI;
*/
     variable = variable + campo + tab;
     |PINTA 1922,"                                                         ";
     |PINTA 1922, "AYUDA VTA.:";
     |PINTA 1935,variable;
     variable = variable + #30#3 + tab + #30#4 + tab + #30#5 + tab;
     variable = variable + #30#6 + tab + #30#7;
     |SI #0#59 = "3";
          variable = variable + tab + #30#8 + aFinReg;
     |SINO;
          variable = variable + aFinReg;
     |FINSI;
     |HAZ QuitaRaros;
     |SI #0#67 = "D";
          |HAZ Diferencia;
          |SI FSalida ! 0;
               |XGRABA nHandle, variable;
          |FINSI;
     |SINO;
          |XGRABA nHandle, variable;
     |FINSI;
     variable = "";
|FPRC;

|DEFBUCLE psioa030;
     #30#1;
     3;
     #0#2, 0001, #0#7, fDFecha;
     #0#3, 9999, #0#8, fHFecha;
     ;
     NULL, psioa030;
|FIN;

|PROCESO CoimaPsioa030;
     #referen2@#5 = #30#2;
     |LEE 000#referen2@.=;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |SI #referen1@#1 = "S";
          |SI #referen2@#0 ! #referen1@#4; |Y #referen2@#0 ! #referen1@#5;
                    |Y #referen2@#0 ! #referen1@#6; |Y #referen2@#0 ! #referen1@#7;
                    |Y #referen2@#0 ! #referen1@#8; |Y #referen2@#0 ! #referen1@#9;
                    |Y #referen2@#0 ! #referen1@#10; |Y #referen2@#0 ! #referen1@#11;
                    |Y #referen2@#0 ! #referen1@#12; |Y #referen2@#0 ! #referen1@#13;
               |ACABA;
          |FINSI;
     |SINO;
          |SI #referen2@#0 < #referen1@#2; |O #referen2@#0 > #referen1@#3;
               |ACABA;
          |FINSI;
     |FINSI;

     aAlfa = #referen2@#5;
     aCoimaArt = #referen2@#5; |QBF aCoimaArt;
     aCoimaArt = aCoimaArt + "-" + (("000"+#referen2@#0)%-103) + "-" + (("000"+#referen2@#1)%-103);

     |HAZ psioa030;
|FPRC;

|DEFBUCLE CoimaPsioa030;
     #30#1;
     3;
     #0#2, 0001, #0#7, fDFecha;
     #0#3, 9999, #0#8, fHFecha;
     ;
     NULL, CoimaPsioa030
|FIN;

|PROCESO AyudaCoimasa;
     |DDEF aPath;
     aAlfa = aPath + "coima046";
     |CARGA_DEF aAlfa, referen1@;
     |SI FSalida = 0;
          |ABRE #referen1@;
          #referen1@#0 = #0#0;
          |LEE 000#referen1@.=;
          |CIERRA #referen1@;

          aAlfa = aPath + "coima021";
          |CARGA_DEF aAlfa, referen2@;
          |SI FSalida = 0;
               |ABRE #referen2@;
               |SELECT #2#referen2@;
               |BUCLE CoimaPsioa030;
               |DESCARGA_DEF #referen2@;
          |FINSI;
          |DESCARGA_DEF #referen1@;
     |FINSI;
|FPRC;

|PROCESO AyudaVta;
     fHFecha = ~;
     nNume = fHFecha;
     nNume = nNume - #0#69;
     fDFecha = nNume;

     empresa = #0#29;
     |QBF empresa;
     aFicOrg = empresa + "ayudaven.txt";
     aFicDes = empresa + "ayudaven.asc";
     ||empresa = empresa + "ayudaven.txt";
     |DFICE empresa; empresa = empresa + Usuario;

     |XABRE "WB", empresa, nHandle;
     |SI FSalida ] 0;
          |HAZ IniDiferencia;
          |ABRE #2;
          |ABRE #3;
/*
          |SI nSwCoimasa = 0;
               |HAZ AyudaCoimasa;
          |SINO;
*/
               |BUCLE psioa030;
||          |FINSI;
          |CIERRA #2;
          |CIERRA #3;
          |XCIERRA nHandle;
          |HAZ FinDiferencia;
     |SINO;
          aAlfa = "0000Error al crear:" + empresa;
          |SI aParam = ""; |MENAV aAlfa; |FINSI;
     |FINSI;
|FPRC;

|PROCESO psioa032;
     campo = #32#0; |QBF campo;
     variable = campo + tab;
     campo = #32#1; |QBF campo;
     variable = variable + campo;
     |PINTA 1922,"                                                         ";
     |PINTA 1922, "RUTAS.....:";
     |PINTA 1935,variable;
     variable = variable + aFinReg;
     |HAZ QuitaRaros;
     |SI #0#67 = "D";
          |HAZ Diferencia;
          |SI FSalida ! 0;
               |XGRABA nHandle, variable;
          |FINSI;
     |SINO;
          |XGRABA nHandle, variable;
     |FINSI;
     variable = "";
|FPRC;

|DEFBUCLE psioa032;
     #32#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, psioa032;
|FIN;

|PROCESO Ruta;
     empresa = #0#29;
     |QBF empresa;
     aFicOrg = empresa + "rutas.txt";
     aFicDes = empresa + "rutas.asc";
     |DFICE empresa; empresa = empresa + Usuario;

     |XABRE "WB", empresa, nHandle;
     |SI FSalida ] 0;
          |HAZ IniDiferencia;
          |BUCLE psioa032;
          |XCIERRA nHandle;
          |HAZ FinDiferencia;
     |SINO;
          aAlfa = "0000Error al crear:" + empresa;
          |SI aParam = ""; |MENAV aAlfa; |FINSI;
     |FINSI;
|FPRC;

|PROCESO agifm002;
     campo = #20#0; |QBF campo;
     variable = campo + tab;
     campo = #20#1; |QBF campo;
     variable = variable + campo;
     |PINTA 1922,"                                                         ";
     |PINTA 1922, "RUTAS.....:";
     |PINTA 1935,variable;
     variable = variable + aFinReg;
     |HAZ QuitaRaros;
     |SI #0#67 = "D";
          |HAZ Diferencia;
          |SI FSalida ! 0;
               |XGRABA nHandle, variable;
          |FINSI;
     |SINO;
          |XGRABA nHandle, variable;
     |FINSI;
     variable = "";
|FPRC;

|DEFBUCLE agifm002;
     #20#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, agifm002;
|FIN;

|PROCESO RutaMaestros;
     empresa = #0#29;
     |QBF empresa;
     aFicOrg = empresa + "rutas.txt";
     aFicDes = empresa + "rutas.asc";
     |DFICE empresa; empresa = empresa + Usuario;

     |XABRE "WB", empresa, nHandle;
     |SI FSalida ] 0;
          |HAZ IniDiferencia;
          |BUCLE agifm002;
          |XCIERRA nHandle;
          |HAZ FinDiferencia;
     |SINO;
          aAlfa = "0000Error al crear:" + empresa;
          |SI aParam = ""; |MENAV aAlfa; |FINSI;
     |FINSI;
|FPRC;

|PROCESO psioa034;
     campo = #34#0; |QBF campo;
     variable = campo + tab;
     campo = #34#1; |QBF campo;
     variable = variable + campo + tab;
     |PINTA 1922,"                                                         ";
     |PINTA 1922, "SITUACION.:";
     |PINTA 1935,variable;
     variable = variable + #34#2 +  aFinReg;
     |HAZ QuitaRaros;
     |SI #0#67 = "D";
          |HAZ Diferencia;
          |SI FSalida ! 0;
               |XGRABA nHandle, variable;
          |FINSI;
     |SINO;
          |XGRABA nHandle, variable;
     |FINSI;
     variable = "";
|FPRC;

|DEFBUCLE psioa034;
     #34#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, psioa034;
|FIN;

|PROCESO Situaciones;
     empresa = #0#29;
     |QBF empresa;
     aFicOrg = empresa + "situacio.txt";
     aFicDes = empresa + "situacio.asc";
     ||empresa = empresa + "situacio.txt";
     |DFICE empresa; empresa = empresa + Usuario;

     |XABRE "WB", empresa, nHandle;
     |SI FSalida ] 0;
          |HAZ IniDiferencia;
          |BUCLE psioa034;
          |XCIERRA nHandle;
          |HAZ FinDiferencia;
     |SINO;
          aAlfa = "0000Error al crear:" + empresa;
          |SI aParam = ""; |MENAV aAlfa; |FINSI;
     |FINSI;
|FPRC;

|PROCESO psioa033;
     #2#0 = #33#1;
     |LEE 000#2=
     |SI FSalida ! 0; |O #0#1 = "N"; |ACABA; |FINSI;
     |SI #2#3 < #0#4;|O #2#3 > #0#5; |ACABA; |FINSI;          || Zona
     |SI #2#25 < #0#39;|O #2#25 > #0#40; |ACABA; |FINSI;      || Repre
     |SI #2#158 < #0#31;|O #2#158 > #0#32; |ACABA; |FINSI;    || Grupo
     |SI #2#4 < #0#33;|O #2#4 > #0#34; |ACABA; |FINSI;        || Tipo
     |SI #2#39 < #0#51;|O #2#39 > #0#52; |ACABA; |FINSI;      || Tarifa

     campo = #33#0; |QBF campo;
     variable = campo + tab;
     campo = #33#1; |QBF campo;
     variable = variable + campo + tab;
     campo = #33#2; |QBF campo;
     variable = variable + campo + tab;
     |PINTA 1922,"                                                         ";
     |PINTA 1922, "RUTAS CLI.:";
     |PINTA 1935,variable;
     variable = variable + #33#3 + aFinReg;
     |HAZ QuitaRaros;
     |SI #0#67 = "D";
          |HAZ Diferencia;
          |SI FSalida ! 0;
               |XGRABA nHandle, variable;
          |FINSI;
     |SINO;
          |XGRABA nHandle, variable;
     |FINSI;
     variable = "";
|FPRC;

|DEFBUCLE psioa033;
     #33#1;
     ;
     #35#1, #0#2, 0001;
     #35#1, #0#3, 9999;
     ;
     NULL, psioa033;
|FIN;

|PROCESO psioa035;
     |BUCLE psioa033;
|FPRC;

|DEFBUCLE psioa035;
     #35#1;
     3;
     #0#0, "      ", "*";
     #0#0, "zzzzzz", "*";
     ;
     NULL, psioa035;
|FIN;

|PROCESO RutasCli;
     empresa = #0#29;
     |QBF empresa;
     aFicOrg = empresa + "rutascli.txt";
     aFicDes = empresa + "rutascli.asc";
     ||empresa = empresa + "rutascli.txt";
     |DFICE empresa; empresa = empresa + Usuario;

     |XABRE "WB", empresa, nHandle;
     |SI FSalida ] 0;
          |HAZ IniDiferencia;
          |ABRE #2;
          |BUCLE psioa035;
          |CIERRA #2;
          |XCIERRA nHandle;
          |HAZ FinDiferencia;
     |SINO;
          aAlfa = "0000Error al crear:" + empresa;
          |SI aParam = ""; |MENAV aAlfa; |FINSI;
     |FINSI;
|FPRC;
||------------------------------  CLIENTES ----------------------------------

|PROCESO DirEnt;
     variable = #300#0 + tab + #300#1 + tab + #300#10 + tab + #300#11 + tab;
     |HAZ QuitaRaros;
     |SI #0#67 = "D";
          |HAZ Diferencia;
     |SINO;
          |XGRABA nHandle, variable;
     |FINSI;
     |PINTA 1922,"                                                         ";
     |PINTA 1922,"DIR.ENT.:";
     |PINTA 1935, variable;
     aAlfa = #300#2; |HAZ QuitaExtra¤os;
     variable = aAlfa + tab + #300#3 + tab + #300#6 + tab;
     |HAZ QuitaRaros;
     |SI #0#67 = "D";
          |HAZ Diferencia;
     |SINO;
          |XGRABA nHandle, variable;
     |FINSI;
     variable = #300#7 + tab + #300#13 + &13 + &10;
     |HAZ QuitaRaros;
     |SI #0#67 = "D";
          |HAZ Diferencia;
          |SI FSalida ! 0;
               |XGRABA nHandle, eaVariable1;
               |XGRABA nHandle, eaVariable2;
               |XGRABA nHandle, eaVariable3;
          |FINSI;
     |SINO;
          |XGRABA nHandle, variable;
     |FINSI;
|FPRC;

|DEFBUCLE DirEnt;
     #300#1;
     11;
     #2#0, 001, #0#4;
     #2#0, 999, #0#5;
     ;
     NULL, DirEnt;
|FIN;

|PROCESO Direccion;
     |BUCLE DirEnt;
|FPRC;

|DEFBUCLE Direccion;
     #2#1;
     3,158,4,25,39;
     #0#2,#0#4,#0#31,#0#33,#0#39,#0#51;
     #0#3,#0#5,#0#32,#0#34,#0#40,#0#52;
     ;
     NULL, Direccion;
|FIN;

|PROCESO pasa_cli;
     campo = #2#0; |QBF campo; variable = campo + tab;

     aAlfa = #2#1; |HAZ QuitaExtra¤os;
     campo = aAlfa; |SI #0#59 = 1; campo = campo % 130; |FINSI; |QBF campo;
     variable = variable + campo + tab;
     |PINTA 1922,"                                                         ";
     |PINTA 1922,"CLIENTES:";
     |PINTA 1935, variable;
     aAlfa = #2#2; |HAZ QuitaExtra¤os;
     campo = aAlfa; |SI #0#59 = 1; campo = campo % 130; |FINSI; |QBF campo;
     variable = variable + campo + tab;
     aAlfa = #2#5; |HAZ QuitaExtra¤os;
     campo = aAlfa; |SI #0#59 = 1; campo = campo % 130; |FINSI; |QBF campo;
     variable = variable + campo + tab;
     campo = #2#6; |SI #0#59 = 1; campo = campo % 130; |FINSI; |QBF campo;
     variable = variable + campo + tab;
     campo = #2#180;|QBF campo; variable = variable + campo + tab;
     campo = #2#7; |SI #0#59 = 1; campo = campo % 130; |FINSI; |QBF campo;
     variable = variable + campo + tab;
     campo = #2#15; |SI #0#59 = 1; campo = campo % 115; |FINSI; |QBF campo;
     variable = variable + campo + tab;
     campo = #2#17; |SI #0#59 = 1; campo = campo % 115; |FINSI; |QBF campo;
     variable = variable + campo + tab;
/*
     |HAZ QuitaRaros;
     |SI #0#67 = "D";
          |HAZ Diferencia;
     |SINO;
          |XGRABA nHandle, variable;
     |FINSI;
     variable = "";
*/
     |HAZ QuitaRaros;
     |XGRABA nHandle, variable;
     variable = "";

     campo = #2#47; |QBF campo; variable = variable + campo + tab;
     campo = #2#20; |QBF campo; variable = variable + campo + tab;
     campo = #2#39; |QBF campo; variable = variable + campo + tab;
     campo = #2#3;  |QBF campo; variable = variable + campo + tab;
     campo = #2#158; |QBF campo; variable = variable + campo + tab;
     campo = #2#37; |QBF campo; variable = variable + campo + tab;
     campo = #2#38; |QBF campo; variable = variable + campo + tab;
     campo = #2#156; |QBF campo;
     |SI #0#58 ] 10; |O #0#59 = 3;
         variable = variable + campo + tab;
         campo = #2#41; |QBF campo;
     |FINSI;
     variable = variable + campo;

     |SI #0#59 = 2;
          variable = variable + tab + #2#204;
     |FINSI;
     |SI #0#59 = 3;
          variable = variable + tab + #2#204;
          variable = variable + tab + #2#189;

          aMail = #2#197; |HAZ PrimeMail;
          variable = variable + tab + aMail;
          |HAZ QuitaRaros;
          |XGRABA nHandle, variable;
          variable = "";

          variable = variable + tab + #2#196;
          variable = variable + tab + #2#36;
          variable = variable + tab + #2#53;
     |FINSI;

     variable = variable + aFinReg;
     |HAZ QuitaRaros;
     |XGRABA nHandle, variable;

/*
     |HAZ QuitaRaros;
     |SI #0#67 = "D";
          |HAZ Diferencia;
          |SI FSalida ! 0;
               |XGRABA nHandle, eaVariable1;
               |XGRABA nHandle, eaVariable2;
          |FINSI;
     |SINO;
          |XGRABA nHandle, variable;
     |FINSI;
*/
|FPRC;

|DEFBUCLE lee_cli;
     #2#1;
     3,158,4,25,39;
     #0#2,#0#4,#0#31,#0#33,#0#39,#0#51;
     #0#3,#0#5,#0#32,#0#34,#0#40,#0#52;
     ;
     NULL,pasa_cli;
|FIN;

|PROCESO CliCoimasa;
     |SI #2#25 ] #0#39; |Y #2#25 [ #0#40;
          |HAZ pasa_cli;
     |SINO;
          |SI #2#26 ] #0#39; |Y #2#26 [ #0#40;
               |HAZ pasa_cli;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE CliCoimasa;
     #2#1;
     3,158,4,39;
     #0#2,#0#4,#0#31,#0#33,#0#51;
     #0#3,#0#5,#0#32,#0#34,#0#52;
     ;
     NULL, CliCoimasa;
|FIN;

|PROCESO clientes;
     empresa = #0#29;
     |QBF empresa;
     aFicOrg = empresa + "clientes.txt";
     aFicDes = empresa + "clientes.asc";
     ||empresa = empresa + "clientes.txt";
     |DFICE empresa; empresa = empresa + Usuario;

     |XABRE "WB", empresa, nHandle;
     |SI FSalida ] 0;
          |HAZ IniDiferencia;
          |SI nSwCoimasa = 0;
               |BUCLE CliCoimasa;
          |SINO;
               |BUCLE lee_cli;     || la estandar
          |FINSI;
          |XCIERRA nHandle;
          |HAZ FinDiferencia;
     |SINO;
          aAlfa = "0000Error al crear:" + empresa;
          |SI aParam = ""; |MENAV aAlfa; |FINSI;
     |FINSI;

     |HAZ Ansi2Utf8;

     |SI #0#59 ] 2; |Y #0#71 = "S";
          empresa = #0#29;
          |QBF empresa;
          aFicOrg = empresa + "direccion.txt";
          aFicDes = empresa + "direccion.asc";
          ||empresa = empresa + "direccion.txt";
          |DFICE empresa; empresa = empresa + Usuario;

          |XABRE "WB", empresa, nHandle;
          |SI FSalida ] 0;
               |HAZ IniDiferencia;
               |BUCLE Direccion;
               |XCIERRA nHandle;
               |HAZ FinDiferencia;
          |SINO;
               aAlfa = "0000Error al crear:" + empresa;
               |SI aParam = ""; |MENAV aAlfa; |FINSI;
          |FINSI;
          |HAZ Ansi2Utf8;
     |FINSI;
|FPRC;

||--------------------------  ARTICULOS  ------------------------------------

|PROCESO FiltraTari;
     nPvp1 = 0; nPvp2 = 0; nPvp3 = 0; nPvp4 = 0; nPvp5 = 0; nPvp6 = 0;
     |PARA nTari = #0#51; |SI nTari [ #0#52; |HACIENDO nTari = nTari + 1;
          |SI nTari = 1; nPvp1 = #3#18; |FINSI;
          |SI nTari = 2; nPvp2 = #3#19; |FINSI;
          |SI nTari = 3; nPvp3 = #3#20; |FINSI;
          |SI nTari = 4; nPvp4 = #3#147; |FINSI;
          |SI nTari = 5; nPvp5 = #3#148; |FINSI;
          |SI nTari = 6; nPvp6 = #3#149; |FINSI;
     |SIGUE;
|FPRC;

|PROCESO pasa_art;
     |ABRE #7;
     #7#0 = #3#0;
     #7#1 = #0#27;
     |LEE 111#7=;
     |SI FSalida ! 0;
         |DDEFECTO #7;
         #7#0 = #3#0;
         #7#1 = #0#27;
         |GRABA 000#7c;
         |LIBERA #7;
     |FINSI;
     |LIBERA #7;
     |CIERRA #7;

     #82#0 = #3#0;
     |LEE 000#82=;
     |SI FSalida ! 0; |DDEFECTO #82; |FINSI;

     #101#0 = #3#139;
     |LEE 000#101=;
     |SI FSalida ! 0; |DDEFECTO #101; |FINSI;


     |PINTA 1922,"                                                         ";
     |PINTA 1922,"ARTICULOS:";
     |PINTA 1935, #3#0;

     efFiva = ~;
     enTiva = #3#30;
     |HAZ SacaIVA;
     |HAZ FiltraTari;
     |SI #3#130 = "S"; nPvp1 = nPvp1 / (1+(enIva/100)); |FINSI;
     |SI #3#131 = "S"; nPvp2 = nPvp2 / (1+(enIva/100)); |FINSI;
     |SI #3#132 = "S"; nPvp3 = nPvp3 / (1+(enIva/100)); |FINSI;
     |SI #3#153 = "S"; nPvp4 = nPvp4 / (1+(enIva/100)); |FINSI;
     |SI #3#154 = "S"; nPvp5 = nPvp5 / (1+(enIva/100)); |FINSI;
     |SI #3#155 = "S"; nPvp6 = nPvp6 / (1+(enIva/100)); |FINSI;
     nPvp1 = nPvp1 ! #15#9;
     nPvp2 = nPvp2 ! #15#9;
     nPvp3 = nPvp3 ! #15#9;
     nPvp4 = nPvp4 ! #15#9;
     nPvp5 = nPvp5 ! #15#9;
     nPvp6 = nPvp6 ! #15#9;

     #60#0 = #99#0;
     |LEE 000#60=;
     |SI FSalida = 0; |Y #0#59 ! 3;
          |SI #60#1 = "S";
               |SI variable ! ""; variable = variable + tab; |FINSI;
               campo = #3#0; |QBF campo; variable = campo;
                    || el QBF estaba puesto en la 9.40, fue quitado
                    ||/en la 9.41, respuesto en la 00psion_9.41.005
          |FINSI;
          |SI #60#2 = "S";
               |SI variable ! ""; variable = variable + tab; |FINSI;
               campo = #3#1;|QBF campo;
               |SI nSwCepsax = 0;
                    campo = campo + " " + #101#1; |QBF campo;
               |FINSI;
               variable = variable + campo;
          |FINSI;
          |SI #60#3 = "S";
               |SI variable ! ""; variable = variable + tab; |FINSI;
               campo = #3#2; |QBF campo; variable = variable + campo;
          |FINSI;
          |SI #60#4 = "S";
               |SI variable ! ""; variable = variable + tab; |FINSI;
               campo = #3#128; |QBF campo; variable = variable + campo;
          |FINSI;
          |SI #60#5 = "S";
               |SI variable ! ""; variable = variable + tab; |FINSI;
               campo = #3#30; |QBF campo; variable = variable + campo;
          |FINSI;
          |SI #60#6 = "S";
               |SI variable ! ""; variable = variable + tab; |FINSI;
               campo = nPvp1; |QBF campo; variable = variable + campo;
          |FINSI;
          |SI #60#7 = "S";
               |SI variable ! ""; variable = variable + tab; |FINSI;
               campo = nPvp2; |QBF campo; variable = variable + campo;
          |FINSI;
          |SI #60#8 = "S";
               |SI variable ! ""; variable = variable + tab; |FINSI;
               campo = nPvp3; |QBF campo; variable = variable + campo;
          |FINSI;
          |SI #60#9 = "S";
               |SI variable ! ""; variable = variable + tab; |FINSI;
               campo = nPvp4; |QBF campo; variable = variable + campo;
          |FINSI;
          |SI #60#10 = "S";
               |SI variable ! ""; variable = variable + tab; |FINSI;
               campo = nPvp5; |QBF campo; variable = variable + campo;
          |FINSI;
          |SI #60#11 = "S";
               |SI variable ! ""; variable = variable + tab; |FINSI;
               campo = nPvp6; |QBF campo; variable = variable + campo;
          |FINSI;
          |SI #60#12 = "S";
               |SI variable ! ""; variable = variable + tab; |FINSI;
               campo = #3#21; |QBF campo; variable = variable + campo;
          |FINSI;
          |SI #60#13 = "S";
               |SI variable ! ""; variable = variable + tab; |FINSI;
               campo = #3#22; |QBF campo; variable = variable + campo;
          |FINSI;
          |SI #60#14 = "S";
               |SI variable ! ""; variable = variable + tab; |FINSI;
               campo = #3#23; |QBF campo; variable = variable + campo;
          |FINSI;
          |SI #60#15 = "S";
               |SI variable ! ""; variable = variable + tab; |FINSI;
               campo = #3#150; |QBF campo; variable = variable + campo;
          |FINSI;
          |SI #60#16 = "S";
               |SI variable ! ""; variable = variable + tab; |FINSI;
               campo = #3#151; |QBF campo; variable = variable + campo;
          |FINSI;
          |SI #60#17 = "S";
               |SI variable ! ""; variable = variable + tab; |FINSI;
               campo = #3#152; |QBF campo; variable = variable + campo;
          |FINSI;
          |SI #60#18 = "S";
               |SI variable ! ""; variable = variable + tab; |FINSI;
               campo = #7#5; |QBF campo; variable = variable + campo;
          |FINSI;
          |SI #60#19 = "S";
               |SI variable ! ""; variable = variable + tab; |FINSI;
               campo = #3#4; |QBF campo; variable = variable + campo;
          |FINSI;
          |SI #60#20 = "S";
               |SI variable ! ""; variable = variable + tab; |FINSI;
               campo = #3#180; |QBF campo; variable = variable + campo;
          |FINSI;
          |SI #60#21 = "S";
               |SI variable ! ""; variable = variable + tab; |FINSI;
               campo = #3#5; |QBF campo; variable = variable + campo;
          |FINSI;
          |SI #60#22 = "S";
               |SI variable ! ""; variable = variable + tab; |FINSI;
               campo = #3#139; |QBF campo; variable = variable + campo;
          |FINSI;
          |SI #60#23 = "S";
               |SI variable ! ""; variable = variable + tab; |FINSI;
               campo = #3#140; |QBF campo; variable = variable + campo;
          |FINSI;
          |SI #60#24 = "S";
               |SI variable ! ""; variable = variable + tab; |FINSI;
               campo = #3#141; |QBF campo; variable = variable + campo;
          |FINSI;
          |SI #60#25 = "S";
               |SI variable ! ""; variable = variable + tab; |FINSI;
               campo = #3#142; |QBF campo; variable = variable + campo;
          |FINSI;
          |SI #60#26 = "S";
               |SI variable ! ""; variable = variable + tab; |FINSI;
               campo = #3#143; |QBF campo; variable = variable + campo;
          |FINSI;
          |SI #60#27 = "S";
               |SI variable ! ""; variable = variable + tab; |FINSI;
               campo = #3#144; |QBF campo; variable = variable + campo;
          |FINSI;
          |SI #60#28 = "S";
               |SI variable ! ""; variable = variable + tab; |FINSI;
               campo = #3#145; |QBF campo; variable = variable + campo;
          |FINSI;
          |SI #60#29 = "S";
               |SI variable ! ""; variable = variable + tab; |FINSI;
               campo = #3#146; |QBF campo; variable = variable + campo;
          |FINSI;
          |SI #60#30 = "S";
               |SI variable ! ""; variable = variable + tab; |FINSI;
               campo = #3#208; |QBF campo; variable = variable + campo;
          |FINSI;
          |SI #60#31 = "S";
               |SI variable ! ""; variable = variable + tab; |FINSI;
               campo = #3#133; |QBF campo; variable = variable + campo;
          |FINSI;
     |SINO;
/*
          |SI nSwCoimasa = 0;
               campo = aCoimaArt; |QBF campo; variable = campo + tab;
               campo = aCoimaDes; |QBF campo; variable = variable + campo + tab;
               campo = aCoimaFan; |QBF campo; variable = variable + campo + tab;
          |SINO;
*/
               campo = #3#0; |QBF campo; variable = campo + tab;
               campo = #3#1; |QBF campo;
               |SI nSwCepsax = 0;
                    campo = campo + " " + #101#1; |QBF campo;
               |FINSI;
               variable = variable + campo + tab;

               campo = #3#2; |QBF campo; variable = variable + campo + tab;
||          |FINSI;
          campo = #3#128; |QBF campo; variable = variable + campo + tab;
          campo = #3#30; |QBF campo; variable = variable + campo + tab;
          campo = nPvp1; |QBF campo; variable = variable + campo + tab;
          campo = nPvp2; |QBF campo; variable = variable + campo + tab;
          campo = nPvp3; |QBF campo; variable = variable + campo + tab;
          campo = nPvp4; |QBF campo; variable = variable + campo + tab;
          campo = nPvp5; |QBF campo; variable = variable + campo + tab;
          campo = nPvp6; |QBF campo; variable = variable + campo + tab;
          campo = #3#21; |QBF campo; variable = variable + campo + tab;
          campo = #3#22; |QBF campo; variable = variable + campo + tab;
          campo = #3#23; |QBF campo; variable = variable + campo + tab;
          campo = #3#150; |QBF campo; variable = variable + campo + tab;
          campo = #3#151; |QBF campo; variable = variable + campo + tab;
          campo = #3#152; |QBF campo; variable = variable + campo + tab;
          |SI #0#59 = 1; || PSION
               campo = #7#5; |QBF campo;
               |SI #0#58 ] 10;
                    variable = variable + campo + tab;
                    campo = #3#4; |QBF campo;
               |FINSI;
               variable = variable + campo;
               |SI #0#58 = 30;
                    variable = variable + tab + #3#180;
               |FINSI;
               variable = variable + tab + #3#133;
          |FINSI;
          |SI #0#59 ] 2;  || PDA/Tablet
               campo = #7#5; |QBF campo;
               variable = variable + campo;
               variable = variable + tab + #3#180;
               |SI #0#59 = 2;
                    variable = variable + tab + #3#5;
               |FINSI;
               variable = variable + tab + #3#139;
               variable = variable + tab + #3#140;
               variable = variable + tab + #3#141;
               variable = variable + tab + #3#142;
               variable = variable + tab + #3#143;
               variable = variable + tab + #3#144;
               variable = variable + tab + #3#145;
               variable = variable + tab + #3#146;
               |SI #0#59 = 2;
                    variable = variable + tab + #3#208;
                    variable = variable + tab + #3#133;
               |FINSI;
               |SI #0#59 = 3;
/*
                    |SI nSwCoimasa = 0;
                         |HAZ QuitaRaros;
                         |XGRABA nHandle, variable;
                         variable = tab + aCoimaSub;
                         variable = variable + tab + aCoimaAm1;
                         variable = variable + tab + aCoimaAm2;
                         variable = variable + tab + aCoimaAm3;
                         variable = variable + tab + aCoimaAm4;
                         variable = variable + tab;
                    |SINO;
*/
                         |HAZ QuitaRaros;
                         |XGRABA nHandle, variable;
                         variable = tab + #3#3;
                         variable = variable + tab + #82#1;
                         variable = variable + tab + #82#2;
                         variable = variable + tab + #82#3;
                         variable = variable + tab + #82#4;
                         |HAZ QuitaRaros;
                         |XGRABA nHandle, variable;
                         variable = tab + #82#5;
||                    |FINSI;
               |FINSI;
          |FINSI;
          || OJO AL A¥ADIR, ANADIR EN EL  psioa060
     |FINSI;

     variable = variable + aFinReg;

     |HAZ QuitaRaros;
     |SI #0#67 = "D";
          |HAZ Diferencia;
          |SI FSalida ! 0;
               |XGRABA nHandle, variable;
          |FINSI;
     |SINO;
          |XGRABA nHandle, variable;
     |FINSI;
     campo = "";
     variable = "";
     cadena = "";
|FPRC;

|DEFBUCLE lee_art;
     #3#1;
     2,125;
     #0#7,#0#9,#0#36;
     #0#8,#0#10,#0#37;
     ;
     NULL,pasa_art;
|FIN;

|PROCESO Coima021;
     |SI #referen1@#1 = "S";
          |SI #referen2@#0 ! #referen1@#4; |Y #referen2@#0 ! #referen1@#5;
                    |Y #referen2@#0 ! #referen1@#6; |Y #referen2@#0 ! #referen1@#7;
                    |Y #referen2@#0 ! #referen1@#8; |Y #referen2@#0 ! #referen1@#9;
                    |Y #referen2@#0 ! #referen1@#10; |Y #referen2@#0 ! #referen1@#11;
                    |Y #referen2@#0 ! #referen1@#12; |Y #referen2@#0 ! #referen1@#13;
               |ACABA;
          |FINSI;
     |SINO;
          |SI #referen2@#0 < #referen1@#2; |O #referen2@#0 > #referen1@#3;
               |ACABA;
          |FINSI;
     |FINSI;

     #referen3@#0 = #referen2@#0;
     #referen3@#1 = #referen2@#1;
     #referen3@#2 = #referen2@#2;
     #referen3@#3 = #referen2@#3;
     |LEE 000#referen3@.=;
     |SI FSalida ! 0; |DDEFECTO #referen3@; |FINSI;

     #referen4@#0 = #referen2@#0;
     |LEE 000#referen4@.=;
     |SI FSalida ! 0; |DDEFECTO #referen4@; |FINSI;

     #referen5@#0 = #referen2@#0;
     #referen5@#1 = #referen2@#1;
     |LEE 000#referen5@.=;
     |SI FSalida ! 0; |DDEFECTO #referen5@; |FINSI;

     #3#0 = #referen2@#5;
     |LEE 000#3=;
     |SI FSalida ! 0; |ACABA; |FINSI;

     #160#0 = #3#2;
     |LEE 000#160=;
     |SI FSalida ! 0; |DDEFECTO #160; |FINSI;

     #120#0 = #3#3;
     |LEE 000#120=;
     |SI FSalida ! 0; |DDEFECTO #120; |FINSI;

     aCoimaArt = #referen2@#5; |QBF aCoimaArt;
     aCoimaArt = aCoimaArt + "-" + (("000"+#referen2@#0)%-103) + "-" + (("000"+#referen2@#1)%-103);
     aCoimaSub = #referen4@#22 + (("000"+#referen5@#1)%-103)
     aCoimaFan = #referen4@#22; |QBF aCoimaFan;
     aCoimaDes = #3#1; |QBF aCoimaDes;
     aCoimaAm1 = #referen4@#1; |QBF aCoimaAm1; ||catalogo
     aCoimaAm2 = #referen5@#2; |QBF aCoimaAm2; ||coleccion
     aCoimaAm3 = #referen3@#4; |QBF aCoimaAm3; ||pagina
     aCoimaAm4 = #referen2@#7; |QBF aCoimaAm4; ||linea pagina

     variable = aCoimaDes; |HAZ CambiBarra; |HAZ QuitaRaros; aCoimaDes = variable;
     variable = aCoimaAm1; |HAZ CambiBarra; |HAZ QuitaRaros; aCoimaAm1 = variable;
     variable = aCoimaAm2; |HAZ CambiBarra; |HAZ QuitaRaros; aCoimaAm2 = variable;
     variable = aCoimaAm3; |HAZ CambiBarra; |HAZ QuitaRaros; aCoimaAm3 = variable;
     variable = aCoimaAm4; |HAZ CambiBarra; |HAZ QuitaRaros; aCoimaAm4 = variable;

     #600#0 = aCoimaArt;
     |LEE 000#600=;
     |SI FSalida ! 0;
          |HAZ pasa_art;
          |GRABA 020#600n;
     |FINSI;
|FPRC;

|DEFBUCLE Coima021;
     #referen2@#2001;
     ;
     #0#7;
     #0#8;
     ;
     NULL, Coima021;
|FIN;

|PROCESO ArtiCoimasa;
     |HAZ CreaTempo; |NOME_DAT #600 eaTempo; |DELINDEX #600; |ABRE #600;

     |DDEF aPath;
     aAlfa = aPath + "coima046";
     |CARGA_DEF aAlfa, referen1@;
     |SI FSalida = 0;
          |ABRE #referen1@;
          #referen1@#0 = #0#0;
          |LEE 000#referen1@.=;
          |CIERRA #referen1@;

          aAlfa = aPath + "coima021";
          |CARGA_DEF aAlfa, referen2@;
          |SI FSalida = 0;
               aAlfa = aPath + "coima020";
               |CARGA_DEF aAlfa, referen3@;
               |SI FSalida = 0;
                    aAlfa = aPath + "coima018";
                    |CARGA_DEF aAlfa, referen4@;
                    |SI FSalida = 0;
                         aAlfa = aPath + "coima019";
                         |CARGA_DEF aAlfa, referen5@;
                         |SI FSalida = 0;
                              |ABRE #referen3@;
                              |ABRE #referen4@;
                              |ABRE #referen5@;
                              |ABRE #3;
                              |ABRE #160
                              |ABRE #120;
                              |BUCLE Coima021;
                              |CIERRA #120;
                              |CIERRA #160;
                              |CIERRA #3;
                              |CIERRA #referen5@;
                              |CIERRA #referen4@;
                              |CIERRA #referen3@;
                              |DESCARGA_DEF #referen5@;
                         |FINSI;
                         |DESCARGA_DEF #referen4@;
                    |FINSI;
                    |DESCARGA_DEF #referen3@;
               |FINSI;
               |DESCARGA_DEF #referen2@;
          |FINSI;
          |DESCARGA_DEF #referen1@;
     |FINSI;

     |CIERRA #600; |DELINDEX #600; |HAZ BoraTempo;
|FPRC;

|PROCESO articulos;
     empresa = #0#29;
     |QBF empresa;
     aFicOrg = empresa + "articulo.txt";
     aFicDes = empresa + "articulo.asc";
     ||empresa = empresa + "articulo.txt";
     |DFICE empresa; empresa = empresa + Usuario;

     |XABRE "WB", empresa, nHandle;
     |SI FSalida ] 0;
          |HAZ IniDiferencia;
          |ABRE #60;
/*
          |SI nSwCoimasa = 0;
               |HAZ ArtiCoimasa;
          |SINO;
*/
               |ABRE #82;
               |ABRE #101;
               |BUCLE lee_art;
               |CIERRA #101;
               |CIERRA #82;
||          |FINSI;
          |CIERRA #60;
          |XCIERRA nHandle;
          |HAZ FinDiferencia;
     |SINO;
          aAlfa = "0000Error al crear:" + empresa;
          |SI aParam = ""; |MENAV aAlfa; |FINSI;
     |FINSI;
|FPRC;

||---------------------------- FORMAS DE PAGO -------------------------------

|PROCESO pasa_pago;
          campo = #1#0; |QBF campo;
          variable = campo + tab;
          campo = #1#1; |QBF campo;
          variable = variable + campo + tab;
          |PINTA 1922,"                                                         ";
          |PINTA 1922,"F.PAGO:";
          |PINTA 1935,variable;
          campo = #1#3; |QBF campo;
          variable = variable + campo + tab;
          campo = #1#2; |QBF campo;
          variable = variable + campo + tab;
          campo = #1#4; |QBF campo;
          variable = variable + campo + aFinReg;
          |HAZ QuitaRaros;
          |SI #0#67 = "D";
               |HAZ Diferencia;
               |SI FSalida ! 0;
                    |XGRABA nHandle, variable;
               |FINSI;
          |SINO;
               |XGRABA nHandle, variable;
          |FINSI;
          campo = "";
          variable = "";
          cadena = "";
|FPRC;

|DEFBUCLE lee_pago;
     #1#1;
     ;
     "  ";
     "zz";
     ;
     NULL,pasa_pago;
|FIN;

|PROCESO f_pago;
     empresa = #0#29;
     |QBF empresa;
     aFicOrg = empresa + "fpago.txt";
     aFicDes = empresa + "fpago.asc";
     ||empresa = empresa + "fpago.txt";
     |DFICE empresa; empresa = empresa + Usuario;

     |XABRE "WB", empresa, nHandle;
     |SI FSalida ] 0;
          |HAZ IniDiferencia;
          |BUCLE lee_pago;
          |XCIERRA nHandle;
          |HAZ FinDiferencia;
     |SINO;
          aAlfa = "0000Error al crear:" + empresa;
          |SI aParam = ""; |MENAV aAlfa; |FINSI;
     |FINSI;
|FPRC;

||------------------------- FICHERO DE I.V.A. ------------------------------

|PROCESO lee_iva;
     |PARA enTiva = 0;  |SI enTiva [ 5; |HACIENDO enTiva = enTiva + 1;
          efFiva = ~;
          |HAZ SacaIVA;
          |SI eaDiva ! "";
               campo = enTiva; |QBF campo;
               variable = campo + tab;
               campo = enIva; |QBF campo;
               variable = variable + campo + tab;
               campo = enRec; |QBF campo;
               variable = variable + campo;
               |PINTA 1922,"                                                         ";
               |PINTA 1922,"TIPOS IVA:";
               |PINTA 1935,variable;
               variable = variable + aFinReg;
               |HAZ QuitaRaros;
               |SI #0#67 = "D";
                    |HAZ Diferencia;
                    |SI FSalida ! 0;
                         |XGRABA nHandle, variable;
                    |FINSI;
               |SINO;
                    |XGRABA nHandle, variable;
               |FINSI;
               campo = "";
               variable = "";
               cadena = "";
          |FINSI;
     |SIGUE;
|FPRC;


|PROCESO f_iva;
     empresa = #0#29;
     |QBF empresa;
     aFicOrg = empresa + "iva.txt";
     aFicDes = empresa + "iva.asc";
     ||empresa = empresa + "iva.txt";
     |DFICE empresa; empresa = empresa + Usuario;

     |XABRE "WB", empresa, nHandle;
     |SI FSalida ] 0;
          |HAZ IniDiferencia;
          |HAZ lee_iva;
          |XCIERRA nHandle;
          |HAZ FinDiferencia;
     |SINO;
          aAlfa = "0000Error al crear:" + empresa;
          |SI aParam = ""; |MENAV aAlfa; |FINSI;
     |FINSI;
|FPRC;

||----------------------- FICHERO DE CONTADOR ----------------------------

|PROCESO pasa_contador;
     alfa = #5#0;
     |QBF alfa;

     |SI alfa = "valbaran";
          |SI #5#2 = #0#12; se1 = #0#12; con1 = #5#1 - 1; |FINSI;
          |SI #5#2 = #0#13; se2 = #0#13; con2 = #5#1 - 1; |FINSI;
          |SI #5#2 = #0#14; se3 = #0#14; con3 = #5#1 - 1; |FINSI;
          |SI #5#2 = #0#15; se4 = #0#15; con4 = #5#1 - 1; |FINSI;
     |FINSI;

     |SI alfa = "vfactuco";
          |SI #5#2 = #0#16; se5 = #0#16; con5 = #5#1 - 1; |FINSI;
          |SI #5#2 = #0#17; se6 = #0#17; con6 = #5#1 - 1; |FINSI;
          |SI #5#2 = #0#18; se7 = #0#18; con7 = #5#1 - 1; |FINSI;
          |SI #5#2 = #0#19; se8 = #0#19; con8 = #5#1 - 1; |FINSI;
     |FINSI;

     |SI alfa = "vpedido";
          |SI #5#2 = #0#23; se9 = #0#23; con9 = #5#1 - 1; |FINSI;
          |SI #5#2 = #0#24; se10 = #0#24; con10 = #5#1 - 1; |FINSI;
          |SI #5#2 = #0#25; se11 = #0#25; con11 = #5#1 - 1; |FINSI;
          |SI #5#2 = #0#26; se12 = #0#26; con12 = #5#1 - 1; |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE lee_contador;
     #5#1;
     ;
     "     ","                               ";
     "zzzzz","zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz";
     ;
     NULL,pasa_contador;
|FIN;

|PROCESO f_contador;
     empresa = #0#29;
     |QBF empresa;
     aFicOrg = empresa + "contador.txt";
     aFicDes = empresa + "contador.asc";
     ||empresa = empresa + "contador.txt";
     |DFICE empresa; empresa = empresa + Usuario;

     |XABRE "WB", empresa, nHandle;
     |SI FSalida ] 0;
          |HAZ IniDiferencia;
          se1  = "";se2  = "";se3  = "";se4  = "";se5  = "";se6  = "";
          se7  = "";se8  = "";se9  = "";se10 = "";se11 = "";se12 = "";
          con1 = 0;con2  = 0;con3 = 0;con4  = 0;con5  = 0;con6  = 0;
          con7 = 0;con8  = 0;con9 = 0;con10 = 0;con11 = 0;con12 = 0;
          |BUCLE lee_contador;
          campo = se1; |QBF campo;
          variable = campo + tab;
          campo = se2; |QBF campo;
          variable = variable + campo + tab;
          campo = se3; |QBF campo;
          variable = variable + campo + tab;
          campo = se4; |QBF campo;
          variable = variable + campo + tab;
          |PINTA 1922,"                                                         ";
          |PINTA 1922,"CONTADORES:";
          |PINTA 1935,variable;
          campo = se5; |QBF campo;
          variable = variable + campo + tab;
          campo = se6; |QBF campo;
          variable = variable + campo + tab;
          campo = se7; |QBF campo;
          variable = variable + campo + tab;
          campo = se8; |QBF campo;
          variable = variable + campo + tab;
          campo = se9; |QBF campo;
          variable = variable + campo + tab;
          campo = se10; |QBF campo;
          variable = variable + campo + tab;
          campo = se11; |QBF campo;
          variable = variable + campo + tab;
          campo = se12; |QBF campo;
          variable = variable + campo + tab;
          campo = con1; |QBF campo;
          variable = variable + campo + tab;
          campo = con2; |QBF campo;
          variable = variable + campo + tab;
          campo = con3; |QBF campo;
          variable = variable + campo + tab;
          campo = con4; |QBF campo;
          variable = variable + campo + tab;
          campo = con5; |QBF campo;
          variable = variable + campo + tab;
          campo = con6; |QBF campo;
          variable = variable + campo + tab;
          campo = con7; |QBF campo;
          variable = variable + campo + tab;
          campo = con8; |QBF campo;
          variable = variable + campo + tab;
          campo = con9; |QBF campo;
          variable = variable + campo + tab;
          campo = con10; |QBF campo;
          variable = variable + campo + tab;
          campo = con11; |QBF campo;
          variable = variable + campo + tab;
          campo = con12; |QBF campo;
          variable = variable + campo + aFinReg;
          |HAZ QuitaRaros;
          |SI #0#67 = "D";
               |HAZ Diferencia;
               |SI FSalida ! 0;
                    |XGRABA nHandle, variable;
               |FINSI;
          |SINO;
               |XGRABA nHandle, variable;
          |FINSI;
          |XCIERRA nHandle;
          |HAZ FinDiferencia;
     |SINO;
          aAlfa = "0000Error al crear:" + empresa;
          |SI aParam = ""; |MENAV aAlfa; |FINSI;
     |FINSI;
     cadena = "";
     campo = "";
     variable = "";
|FPRC;

||------------------------- FICHERO DE COBROS DE FACTURAS ----------------------
|PROCESO pasa_recibos;
     |SI #referen2@#14 ! "P"; |Y #referen2@#14 ! "C"; |Y #referen2@#14 ! "I";
          |ACABA;
     |FINSI;

     aAlfa = "|C090TIPO"; aAlfa = #referen2@#aAlfa#;
     |SI aAlfa ! "F";
        |SI #referen2@#90 = "S"; |ACABA; |FINSI;
     |FINSI;

     |SI #referen2@#46 ! #48#0;  |ACABA; |FINSI;

     |SI #0#85 = "L";
          |SI #referen2@#12 < #0#86; |O #referen2@#12 > #0#87; |ACABA; |FINSI;
     |SINO;
          |SI #referen2@#12 ! #0#88; |Y #referen2@#12 ! #0#89;
                    |Y #referen2@#12 ! #0#90; |Y #referen2@#12 ! #0#91;
                    |Y #referen2@#12 ! #0#92; |Y #referen2@#12 ! #0#93;
                    |Y #referen2@#12 ! #0#94; |Y #referen2@#12 ! #0#95;
                    |Y #referen2@#12 ! #0#96; |Y #referen2@#12 ! #0#97;
               |ACABA;
          |FINSI;
     |FINSI;

     |SI #referen2@#69 ! " "; |O #referen2@#47 = "S";
          nLiqui = (#referen2@#23 + #referen2@#55) ! 2;|| liquidada + compensado/despreciado
          nTotal = #referen2@#30 ! 2;
          |SI nTotal = nLiqui;
               |ACABA;
          |FINSI;
     |SINO;
          nLiqui = #referen2@#23 ! 2;
          nTotal = #referen2@#30 ! 2;
          |SI nTotal = nLiqui;       || Total recibo = Total liquidado
               |ACABA;
          |FINSI;
     |FINSI;

     #2#0 = #referen2@#32;
     |LEE 000#2=;

     |SI #2#0 ] #0#2;|Y #2#0 [ #0#3;            || Cliente
       |SI #2#3 ] #0#4;|Y #2#3 [ #0#5;          || Zona
         |SI #referen2@#33 ] #0#39; |Y #referen2@#33 [ #0#40;    || Repre
           |SI #2#158 ] #0#31;|Y #2#158 [ #0#32;|| Grupo
             |SI #2#4 ] #0#33;|Y #2#4 [ #0#34;  || Tipo
               |SI #2#39 ] #0#51;|Y #2#39 [ #0#52;|| Tarifa

                   aSerRec = #referen2@#0;
                   nNumRec = #referen2@#1;
                   nLinRec = #referen2@#2;

                   |SI #referen2@#49 = "S";
                        |LEE 000#83u;
                        |SI FSalida = 0;
                             nNumRec = #83#0 + 1;
                        |SINO;
                             nNumRec = 1;
                        |FINSI;
                        aSerRec = "AGR";
                        nLinRec = 0;
                        |DDEFECTO #83;
                        #83#0 = nNumRec;
                        #83#1 = #referen2@#40;
                        #83#2 = #referen2@#0;
                        |GRABA 020#83n;
                   |FINSI;
                   |SI #referen2@#82 = "S";
                        |LEE 000#84u;
                        |SI FSalida = 0;
                             nNumRec = #84#0 + 1;
                        |SINO;
                             nNumRec = 1;
                        |FINSI;
                        aSerRec = "DIV";
                        nLinRec = 0;
                        |DDEFECTO #84;
                        #84#0 = nNumRec;
                        #84#1 = #referen2@#40;
                        #84#2 = #referen2@#0;
                        |GRABA 020#84n;
                   |FINSI;

                   campo = aSerRec; |QBF campo;
                   variable = campo + tab;
                   campo = nNumRec; |QBF campo;
                   variable = variable + campo + tab;
                   |PINTA 1922,"                                                         ";
                   |PINTA 1922,"REC.COBROS:";
                   |PINTA 1935,variable;
                   campo = nLinRec;
                   variable = variable + campo + tab;
                   campo = #referen2@#6;  |QBF campo;
                   variable = variable + campo + tab;
                   campo = #referen2@#30; |QBF campo;
                   variable = variable + campo + tab;
                   campo = #referen2@#23; |QBF campo;
                   variable = variable + campo + tab;
                   campo = "N";   |QBF campo;
                   variable = variable + campo + tab;
                   campo = #2#2;  |QBF campo;
                   |SI campo = "";
                       campo = #2#1;  |QBF campo;
                   |FINSI;
                   campo = campo + tab + (("000000000" + #referen2@#40) % -109);
                   variable = variable + campo;
                   |SI #0#59 = 1;  || PSION
                         |SI #0#58 = 80;
                            variable = variable + tab + #referen2@#12;
                            variable = variable + tab + #referen2@#99;
                         |FINSI;
                         |SI #0#58 = 40;
                             variable = variable + tab + #referen2@#12;
                             variable = variable + tab + #referen2@#99;
                         |FINSI;
                   |FINSI;
                   |SI #0#59 ] 2;
                        variable = variable + tab + #referen2@#32;
                        variable = variable + tab + #referen2@#4;
                   |FINSI;
                   |SI #0#59 = 3;
                        variable = variable + tab + #referen2@#3;
                   |FINSI;

                   variable = variable + aFinReg;
                   |HAZ QuitaRaros;
                   |SI #0#67 = "D";
                         |HAZ Diferencia;
                         |SI FSalida ! 0;
                              |XGRABA nHandle, variable;
                         |FINSI;
                   |SINO;
                         |XGRABA nHandle, variable;
                   |FINSI;
                   campo = "";
                   variable = "";
                   cadena = "";
               |FINSI;
             |FINSI;
           |FINSI;
         |FINSI;
       |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE lee_recibos;
     #referen2@#12006;
     ;
     #referen1@#4, 000000, 000, "00.00.0000", "            ", #0#2;
     #referen1@#5, 999999, 999, "31.12.9999", "zzzzzzzzzzzz", #0#3;
     ;
     NULL,pasa_recibos;
|FIN;

|PROCESO LineasCtrl;
   |DBASS aAlfa; |QBF aAlfa;
   aAlfa = aAlfa + "dscarter/fich/" + (("00000" + #referen1@#6) % -105) + "/";
   |PATH_DAT #referen2@#aAlfa#;
   |ABRE #2;
   |BUCLE lee_recibos;
   |CIERRA #2;
|FPRC;

|DEFBUCLE LineasCtrl;
     #referen1@#1002;
     2;
     nEmpresa, 001, "V";
     nEmpresa, 999, "V";
     ;
     NULL,LineasCtrl;
|FIN;

|PROCESO f_cobros;                || Cobros De Facturas.
     empresa = #0#29;
     |QBF empresa;
     |SI #0#59 ] 2;
          aFicOrg = empresa + "icobros.txt";
          aFicDes = empresa + "icobros.asc";
          ||empresa = empresa + "icobros.txt";
     |SINO;
          aFicOrg = empresa + "cobros.txt";
          aFicDes = empresa + "cobros.asc";
          ||empresa = empresa + "cobros.txt";
     |FINSI;
     |DFICE empresa; empresa = empresa + Usuario;

     |XABRE "WB", empresa, nHandle;
     |SI FSalida ] 0;
          |HAZ IniDiferencia;
          |DBASS aAlfa; |QBF aAlfa; aAlfa = aAlfa + "dscarter/def/dscam045.mas";
          |CARGA_DEF aAlfa, referen1@;
          |SI FSalida = 0;
             |DBASS aAlfa; |QBF aAlfa;
             aAlfa = aAlfa + "dscarter/fich/";
             |PATH_DAT #referen1@#aAlfa#;
             |DBASS aAlfa; |QBF aAlfa;
             aAlfa = aAlfa + "dscarter/def/dscam003.mas";
             |CARGA_DEF aAlfa, referen2@;
              |SI FSalida = 0;
                nEmpresa = #48#0;
                |ABRE #83;
                |ABRE #84;
                |BUCLE LineasCtrl;
                |CIERRA #84;
                |CIERRA #83;
                |DESCARGA_DEF #referen2@;
             |FINSI;
             |DESCARGA_DEF #referen1@;
          |FINSI;
          |XCIERRA nHandle;
          |HAZ FinDiferencia;
     |SINO;
          aAlfa = "0000Error al crear:" + empresa;
          |SI aParam = ""; |MENAV aAlfa; |FINSI;
     |FINSI;
|FPRC;

||------------------------- FICHERO DE COBROS DE ALBARANES ----------------------
|PROCESO Entregas;
     nActa = nActa + (#102#9 * nAbo);
|FPRC;

|DEFBUCLE Entregas;
     #102#1;
     22;
     "A", #12#52, #12#0, 01, 3;
     "A", #12#52, #12#0, 99, 4;
     ;
     NULL, Entregas;
|FIN;

|PROCESO RecEntrega;
     nActa = nActa + (#referen2@#23 * nAbo); ||liquidado
     nActa = nActa + (#referen2@#55 * nAbo); ||compensado/desprecio
|FPRC;

|DEFBUCLE RecEntrega;
     #referen2@#12006;
     69, 46;
     #12#52, #12#0, 001, "01.01.0000", "            ", "      ", "A", nEmpresa;
     #12#52, #12#0, 999, "31.12.9999", "zzzzzzzzzzzz", "zzzzzz", "A", nEmpresa;
     ;
     NULL, RecEntrega;
|FIN;

|PROCESO CtrCartera;
     |SI #12#52 ] #referen1@#4; |Y #12#52 [ #referen1@#5;
          aAlfa = aBass + "dscarter/fich/" + (("00000" + #referen1@#6) % -105) + "/";
          |PATH_DAT #referen2@#aAlfa#;
          |BUCLE RecEntrega;
     |FINSI;
|FPRC;

|DEFBUCLE CtrCartera;
     #referen1@#1002;
     2;
     nEmpresa, 001, "V";
     nEmpresa, 999, "V";
     ;
     NULL, CtrCartera;
|FIN;

|PROCESO pasa_recalb;
  |SI #12#67 ] 0;
     nAbo = 1;
  |SINO;
     nAbo = -1;
  |FINSI;
  nTotal = #12#67 * nAbo;

  |SI nSwJamaica = 0;
     nActa = #12#61 * nAbo;
     |BUCLE Entregas;
  |SINO;
     nActa = 0;
     |BUCLE CtrCartera;
  |FINSI;

  nActa = nActa ! 2;
  nTotal = nTotal ! 2;

  |SI nActa < nTotal;
      nActa = nActa * nAbo;
      nTotal = nTotal * nAbo;

      |ABRE #2;
      #2#0 = #12#3;
      |LEE 000#2=;
      |LIBERA #2;
      |SI #2#0 ] #0#2;|Y #2#0 [ #0#3;
        |SI #2#3 ] #0#4;|Y #2#3 [ #0#5;
          |SI #2#25 ] #0#39;|Y #2#25 [ #0#40;
            |SI #2#158 ] #0#31;|Y #2#158 [ #0#32;
              |SI #2#4 ] #0#33;|Y #2#4 [ #0#34;
               |SI #2#39 ] #0#51;|Y #2#39 [ #0#52;
                      campo = #12#52; |QBF campo;
                      variable = campo + tab;
                      campo = #12#0; |QBF campo;
                      variable = variable + campo + tab;
                      |PINTA 1922,"                                                         ";
                      |PINTA 1922,"REC.ALBARAN:";
                      |PINTA 1935,variable;
                      campo = "1";  |QBF campo;
                      variable = variable + campo + tab;
                      campo = #2#1;  |QBF campo;
                      variable = variable + campo + tab;
                      ||nume1 = #12#67 - #12#61;
                      nume1 = nTotal - nActa;
                      nume1 = nume1 ! #15#7;
                      campo = nume1; |QBF campo;
                      variable = variable + campo + tab;
                      campo = "0"; |QBF campo;
                      variable = variable + campo + tab;
                      campo = "N";   |QBF campo;
                      variable = variable + campo + tab;
                      campo = #2#2;  |QBF campo;
                      |SI campo = "";
                          campo = #2#1;  |QBF campo;
                      |FINSI;
                      variable = variable + campo;
                      |ABRE #1;
                      #1#0 = #12#8;
                      |LEE 000#1=;
                      |CIERRA #1;

                      |SI #0#59 ] 2;
                           variable = variable + tab + #12#3;
                      |FINSI;
                      |SI #0#59 = 1;
                            |SI #0#58 = 80;
                                variable = variable + tab + #1#69;
                                variable = variable + tab + #12#1;
                            |FINSI;
                            |SI #0#58 = 40;
                                variable = variable + tab + #1#69;
                                variable = variable + tab + #12#1;
                            |FINSI;
                      |FINSI;
                      |SI #0#59 = 3;
                           variable = variable + tab + #12#1;
                      |FINSI;
                      variable = variable + aFinReg;
                      |HAZ QuitaRaros;
                      |SI #0#67 = "D";
                           |HAZ Diferencia;
                           |SI FSalida ! 0;
                                |XGRABA nHandle, variable;
                                |SI nSwJamaica = 0; |HAZ JamaCheqActa; |FINSI;
                           |FINSI;
                      |SINO;
                           |XGRABA nHandle, variable;
                           |SI nSwJamaica = 0; |HAZ JamaCheqActa; |FINSI;
                      |FINSI;
                      campo = "";
                      variable = "";
                      cadena = "";
                |FINSI;
              |FINSI;
            |FINSI;
          |FINSI;
        |FINSI;
      |FINSI;
      |LIBERA #2;
      |CIERRA #2;
 |FINSI;
|FPRC;

|DEFBUCLE lee_recalb_T;
/*
     #12#1;
     3;
     "     ",     0,#0#2;
     "zzzzz",999999,#0#3;
*/
     #12#3;
     ;
     #0#2, "01.01.0000", "     ", 000000;
     #0#3, "31.12.9999", "zzzzz", 999999;
     ;
     NULL,NULL,NULL,NULL,NULL,pasa_recalb;
     #12#2;
|FIN;

|DEFBUCLE lee_recalb;
/*
     #12#1;
     3,38;
     "     ",     0,#0#2,"N";
     "zzzzz",999999,#0#3,"N";
*/
     #12#3;
     38;
     #0#2, "01.01.0000", "     ", 000000, "N";
     #0#3, "31.12.9999", "zzzzz", 999999, "N";
     ;
     NULL,NULL,NULL,NULL,NULL,pasa_recalb;
     #12#2;
|FIN;

|PROCESO f_cobalb;                || Cobros De Albaranes.
     empresa = #0#29;
     |QBF empresa;
     |SI #0#59 ] 2;
          aFicOrg = empresa + "icobros1.txt";
          aFicDes = empresa + "icobros1.asc";
          ||empresa = empresa + "icobros1.txt";
     |SINO;
          aFicOrg = empresa + "cobros1.txt";
          aFicDes = empresa + "cobros1.asc";
          ||empresa = empresa + "cobros1.txt";
     |FINSI;
     |DFICE empresa; empresa = empresa + Usuario;

     |XABRE "WB", empresa, nHandle;
     |SI FSalida ] 0;
          |HAZ IniDiferencia;
          |DBASS aBass;
          aAlfa = aBass + "dscarter/def/dscam045.mas";
          |CARGA_DEF aAlfa, referen1@;
          |SI FSalida = 0;
               aAlfa = aBass + "dscarter/fich/";
               |PATH_DAT #referen1@#aAlfa#;
               aAlfa = aBass + "dscarter/def/dscam003.mas";
               |CARGA_DEF aAlfa, referen2@;
               |SI FSalida = 0;
                    nEmpresa = #48#0;
                    |SI #0#53 = "S"; |BUCLE lee_recalb;   |FINSI;
                    |SI #0#53 = "T"; |BUCLE lee_recalb_T; |FINSI;
                    |DESCARGA_DEF #referen2@;
               |FINSI;
               |DESCARGA_DEF #referen1@;
          |FINSI;
          |XCIERRA nHandle;
          |HAZ FinDiferencia;
     |SINO;
          aAlfa = "0000Error al crear:" + empresa;
          |SI aParam = ""; |MENAV aAlfa; |FINSI;
     |FINSI;

|FPRC;

||------------------------- FICHERO DE PRECIOS -----------------------------

|PROCESO pasa_precios;
     #3#0 = #8#1;
     |LEE 000#3=;
     |SI FSalida ! 0; |DDEFECTO #3; |FINSI;

     |SI #3#2 ] #0#9;|Y #3#2 [ #0#10;
       |SI #3#125 ] #0#36;|Y #3#125 [ #0#37;
         |SI #2#3 ] #0#4;|Y #2#3 [ #0#5;
             |SI #2#158 ] #0#31;|Y #2#158 [ #0#32;
               |SI #2#4 ] #0#33;|Y #2#4 [ #0#34;
                 |SI #2#39 ] #0#51;|Y #2#39 [ #0#52;
                     campo = #8#0; |QBF campo;
                     variable = campo + tab;
/*
                     |SI nSwCoimasa = 0;
                          campo = aCoimaArt; |QBF campo;
                     |SINO;
*/
                          campo = #8#1; |QBF campo;
||                     |FINSI;
                     variable = variable + campo + tab;
                     #8#2 = #8#2 ! #15#9;
                     campo = #8#2;  |QBF campo;
                     |SI nSwCepsax = 0; |Y #8#2 = -1;
                         nPvp1 = #3#18;
                         |SI #3#130 = "S";
                              efFiva = ~;
                              enTiva = #3#30;
                              |HAZ SacaIVA;
                              nPvp1 = nPvp1 / (1+(enIva/100));
                         |FINSI;
                         nPvp1 = nPvp1 ! #15#9;
                         campo = nPvp1;
                     |FINSI;
                     variable = variable + campo + tab;
                     |PINTA 1922,"                                                         ";
                     |PINTA 1922,"PRE.CLI/ART:";
                     |PINTA 1935,variable;
                     campo = #8#32;
                     variable = variable + campo + tab;
                     campo = #8#36;
                     variable = variable + campo + aFinReg;
                     |HAZ QuitaRaros;
                     |SI #0#67 = "D";
                           |HAZ Diferencia;
                           |SI FSalida ! 0;
                                |XGRABA nHandle, variable;
                           |FINSI;
                     |SINO;
                           |XGRABA nHandle, variable;
                     |FINSI;
                     campo = "";
                     variable = "";
                     cadena = "";
                 |FINSI;
               |FINSI;
             |FINSI;
         |FINSI;
       |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE pasa_precios;
     #8#1;
     29;
     #referen1@#0 , #0#7, fHoy;
     #referen1@#0 , #0#8, "31.12.9999";
     ;
     NULL,pasa_precios;
|FIN;

|PROCESO lee_precios;
     #2#0 = #referen1@#0;
     |LEE 000#2=;
     |SI FSalida = 0;
          aRepre = "N";
          |SI #2#25 ] #0#39;|Y #2#25 [ #0#40;
               aRepre = "S";
          |FINSI;
          |SI #2#26 ] #0#39;|Y #2#26 [ #0#40;
               aRepre = "S";
          |FINSI;
          |SI aRepre = "S";
               |ABRE #agifa324;
               |SI #referen1@#1 = "S";
                    #agifa324#0 = #referen1@#2;
               |SINO;
                    #agifa324#0 = #2#192;
               |FINSI;
               |LEE 001#agifa324.=;          || Leo la divisa
               |CIERRA #agifa324;

               |SI #2#193 = "B";
                    nDeci_PreVis = nDeci_PreBase;
               |SINO;
                    nDeci_PreVis = #agifa324#9;
               |FINSI;

               |BUCLE pasa_precios;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE lee_precios;
     #referen1@#1001;
     ;
     #0#2;
     #0#3;
     ;
     NULL, lee_precios;
|FIN;

|DEFBUCLE CoimaPrecios;
     #8#1;
     29;
     #0#2 , aArtiPag, fHoy;
     #0#3 , aArtiPag, "31.12.9999";
     ;
     NULL, pasa_precios;
|FIN;

|PROCESO CoimaPagina;
     |SI #referen1@#1 = "S";
          |SI #referen2@#0 ! #referen1@#4; |Y #referen2@#0 ! #referen1@#5;
                    |Y #referen2@#0 ! #referen1@#6; |Y #referen2@#0 ! #referen1@#7;
                    |Y #referen2@#0 ! #referen1@#8; |Y #referen2@#0 ! #referen1@#9;
                    |Y #referen2@#0 ! #referen1@#10; |Y #referen2@#0 ! #referen1@#11;
                    |Y #referen2@#0 ! #referen1@#12; |Y #referen2@#0 ! #referen1@#13;
               |ACABA;
          |FINSI;
     |SINO;
          |SI #referen2@#0 < #referen1@#2; |O #referen2@#0 > #referen1@#3;
               |ACABA;
          |FINSI;
     |FINSI;

     aArtiPag = #referen2@#5;
     aCoimaArt = #referen2@#5; |QBF aCoimaArt;
/*
     aCoimaArt = aCoimaArt + "-" + (("000"+#referen2@#0)%-103) + "-" + (("000"+#referen2@#1)%-103);
*/
     |BUCLE CoimaPrecios;
|FPRC;

|DEFBUCLE CoimaPagina;
     #referen2@#2001;
     ;
     #0#7;
     #0#8;
     ;
     NULL, CoimaPagina;
|FIN;

|PROCESO PreArtCoimasa;
     |DDEF aPath;
     aAlfa = aPath + "coima046";
     |CARGA_DEF aAlfa, referen1@;
     |SI FSalida = 0;
          |ABRE #referen1@;
          #referen1@#0 = #0#0;
          |LEE 000#referen1@.=;
          |CIERRA #referen1@;

          aAlfa = aPath + "coima021";
          |CARGA_DEF aAlfa, referen2@;
          |SI FSalida = 0;
               |BUCLE CoimaPagina;
               |DESCARGA_DEF #referen2@;
          |FINSI;
          |DESCARGA_DEF #referen1@;
     |FINSI;
|FPRC;

|PROCESO f_precios;
     empresa = #0#29;
     |QBF empresa;
     aFicOrg = empresa + "precios.txt";
     aFicDes = empresa + "precios.asc";
     ||empresa = empresa + "precios.txt";
     |DFICE empresa; empresa = empresa + Usuario;

     fHoy = ~;
     |XABRE "WB", empresa, nHandle;
     |SI FSalida ] 0;
          |HAZ IniDiferencia;
/*
          |SI nSwCoimasa = 0;
               |ABRE #2;
               |ABRE #3;
               |HAZ PreArtCoimasa;
               |CIERRA #3;
               |CIERRA #2;
          |SINO;
*/             |ABRE #2;
               |ABRE #3;
               |DDEF aAlfa;
               aAlfa = aAlfa + "agifa020";
               |CARGA_DEF aAlfa, referen1@;
               |SI FSalida = 0;
                    |BUCLE lee_precios;
                    |DESCARGA_DEF #referen1@;
               |FINSI;
               |CIERRA #3;
               |CIERRA #2;
||          |FINSI;
          |XCIERRA nHandle;
          |HAZ FinDiferencia;
     |SINO;
          aAlfa = "0000Error al crear:" + empresa;
          |SI aParam = ""; |MENAV aAlfa; |FINSI;
     |FINSI;
|FPRC;

||------------------------- FICHERO DE DTOS.FAMILIA -------------------------

|PROCESO pasa_dtofam;
     |ABRE #2;
     #2#0 = #9#0;
     |LEE 000#2=;
     |LIBERA #2;
     |SI #2#3 ] #0#4;|Y #2#3 [ #0#5;
       |SI #2#25 ] #0#39;|Y #2#25 [ #0#40;
         |SI #2#158 ] #0#31;|Y #2#158 [ #0#32;
           |SI #2#4 ] #0#33;|Y #2#4 [ #0#34;
             |SI #2#39 ] #0#51;|Y #2#39 [ #0#52;
                 campo = #9#0; |QBF campo;
                 variable = campo + tab;
                 campo = #9#1; |QBF campo;
                 variable = variable + campo + tab;
                 campo = #9#2; |QBF campo;
                 |PINTA 1922,"                                                         ";
                 |PINTA 1922,"DTO.FAMILIA:";
                 |PINTA 1935,variable;
                 variable = variable + campo + aFinReg;
                 |HAZ QuitaRaros;
                 |SI #0#67 = "D";
                      |HAZ Diferencia;
                      |SI FSalida ! 0;
                           |XGRABA nHandle, variable;
                      |FINSI;
                 |SINO;
                      |XGRABA nHandle, variable;
                 |FINSI;
                 campo = "";
                 variable = "";
                 cadena = "";
             |FINSI;
           |FINSI;
         |FINSI;
       |FINSI;
     |FINSI;
     |LIBERA #2;
     |CIERRA #2;
|FPRC;

|DEFBUCLE lee_dtofam;
     #9#1;
     ;
     #0#2 , #0#9;
     #0#3 , #0#10;
     ;
     NULL,pasa_dtofam;
|FIN;

|PROCESO f_dtofam;
     empresa = #0#29;
     |QBF empresa;
     aFicOrg = empresa + "dtofam.txt";
     aFicDes = empresa + "dtofam.asc";
     ||empresa = empresa + "dtofam.txt";
     |DFICE empresa; empresa = empresa + Usuario;

     |XABRE "WB", empresa, nHandle;
     |SI FSalida ] 0;
          |HAZ IniDiferencia;
          |BUCLE lee_dtofam;
          |XCIERRA nHandle;
          |HAZ FinDiferencia;
     |SINO;
          aAlfa = "0000Error al crear:" + empresa;
          |SI aParam = ""; |MENAV aAlfa; |FINSI;
     |FINSI;
|FPRC;

||------------------------- FICHERO DE VISITAS ----------------------------
|PROCESO pasa_visitas;
   |ABRE #2;
   #2#0 = #10#0;
   |LEE 000#2=;
   |LIBERA #2;
   |SI #2#25 ] #0#39;|Y #2#25 [ #0#40;
     |SI #2#158 ] #0#31;|Y #2#158 [ #0#32;
       |SI #2#4 ] #0#33;|Y #2#4 [ #0#34;
         |SI #2#39 ] #0#51;|Y #2#39 [ #0#52;
             campo = #10#2; |QBF campo;
             variable = campo + tab;
             campo = #10#0; |QBF campo;
             variable = variable + campo + tab;
             campo = #2#1;  |QBF campo;
             variable = variable + campo + tab;
             |PINTA 1922,"                                                         ";
             |PINTA 1922,"VISITAS : ";
             |PINTA 1933,variable;
             campo = #10#1;  |QBF campo;
             variable = variable + campo + tab;
             campo = #2#2;  |QBF campo;
             |SI campo = "";
                 aAlfa = #2#1; |HAZ QuitaExtra¤os;
                 campo = aAlfa;  |QBF campo;
             |FINSI;
             variable = variable + campo + aFinReg;
             |HAZ QuitaRaros;
             |SI #0#67 = "D";
                  |HAZ Diferencia;
                  |SI FSalida ! 0;
                       |XGRABA nHandle, variable;
                  |FINSI;
             |SINO;
                  |XGRABA nHandle, variable;
             |FINSI;
             campo = "";
             variable = "";
             cadena = "";
         |FINSI;
       |FINSI;
     |FINSI;
   |FINSI;
   |LIBERA #2;
   |CIERRA #2;
|FPRC;

|DEFBUCLE lee_visitas;
     #10#1;
     ;
     #0#2,#0#4;
     #0#3,#0#5;
     ;
     NULL,NULL,NULL,NULL,NULL,pasa_visitas;
     #10#2;
|FIN;

|PROCESO f_visitas;
     empresa = #0#29;
     |QBF empresa;
     aFicOrg = empresa + "visitas.txt";
     aFicDes = empresa + "visitas.asc";
     ||empresa = empresa + "visitas.txt";
     |DFICE empresa; empresa = empresa + Usuario;

     |XABRE "WB", empresa, nHandle;
     |SI FSalida ] 0;
          |HAZ IniDiferencia;
          |BUCLE lee_visitas;
          |XCIERRA nHandle;
          |HAZ FinDiferencia;
     |SINO;
          aAlfa = "0000Error al crear:" + empresa;
          |SI aParam = ""; |MENAV aAlfa; |FINSI;
     |FINSI;
|FPRC;

||------------------------- FICHERO DE IMPRESION ----------------------------
|PROCESO pasa_impresion;
   |SI #0#47 = #11#0;|O #0#48 = #11#0;|O #0#49 = #11#0;|O #0#50 = #11#0;
           campo = #11#0; |QBF campo;
           variable = campo + tab;
           campo = #11#1; |QBF campo;
           variable = variable + campo + tab;
           |PINTA 1922,"                                                         ";
           |PINTA 1922,"IMPRESION : ";
           |PINTA 1933,variable;
           campo = #11#2;  |QBF campo;
           variable = variable + campo + tab;
           campo = #11#3;  |QBF campo;
           variable = variable + campo + tab;
           campo = #11#4;  |QBF campo;
           variable = variable + campo + tab;
           campo = #11#5;  |QBF campo;
           variable = variable + campo + tab;
           campo = #11#6;  |QBF campo;
           variable = variable + campo + tab;
           campo = #0#41;  |QBF campo;
           variable = variable + campo + tab;
           campo = #0#42;  |QBF campo;
           variable = variable + campo + tab;
           campo = #0#43;  |QBF campo;
           variable = variable + campo + tab;
           campo = #0#44;  |QBF campo;
           variable = variable + campo + tab;
           campo = #0#45;  |QBF campo;
           variable = variable + campo + tab;
           campo = #0#46;  |QBF campo;
           |SI #0#58 ] 10; |O #0#59 = 3;
               variable = variable + campo + tab;
               campo = #0#54;  |QBF campo;
               variable = variable + campo + tab;
               campo = #0#55;  |QBF campo;
               variable = variable + campo + tab;
               campo = #0#56;  |QBF campo;
               variable = variable + campo + tab;
               campo = #0#57;  |QBF campo;
               variable = variable + campo + tab;
               campo = #13#72;  |QBF campo;
           |FINSI;
           variable = variable + campo + aFinReg;
           |HAZ QuitaRaros;
           |SI #0#67 = "D";
                  |HAZ Diferencia;
                  |SI FSalida ! 0;
                       |XGRABA nHandle, variable;
                  |FINSI;
           |SINO;
                  |XGRABA nHandle, variable;
           |FINSI;
           campo = "";
           variable = "";
           cadena = "";
   |FINSI;
|FPRC;

|DEFBUCLE lee_impresion;
     #11#1;
     ;
     "     ";
     "zzzzz";
     ;
     NULL,NULL,NULL,NULL,NULL,pasa_impresion;
     #10#2;
|FIN;

|PROCESO f_impresion;
     empresa = #0#29;
     |QBF empresa;
     aFicOrg = empresa + "impre.txt";
     aFicDes = empresa + "impre.asc";
     ||empresa = empresa + "impre.txt";
     |DFICE empresa; empresa = empresa + Usuario;

     |XABRE "WB", empresa, nHandle;
     |SI FSalida ] 0;
          |HAZ IniDiferencia;
          |BUCLE lee_impresion;
          |XCIERRA nHandle;
          |HAZ FinDiferencia;
     |SINO;
          aAlfa = "0000Error al crear:" + empresa;
          |SI aParam = ""; |MENAV aAlfa; |FINSI;
     |FINSI;
|FPRC;

||--------------------------  ARTICULOS CODIGO -----------------------------

|PROCESO pasa_art1;
          campo = #3#0; |QBF campo;
          variable = campo + tab;
          campo = #3#1; |QBF campo;
          variable = variable + campo + tab;
          |PINTA 1922,"                                                         ";
          |PINTA 1922,"C.ARTICULO:";
          |PINTA 1935,variable;
          campo = #3#128; |QBF campo;
          variable = variable + campo;
          |SI #0#59 = 1;
               |SI #0#58 =  30;
                    variable = variable + tab + #3#180;
               |FINSI;
          |FINSI;
          |SI #0#59 ] 2;
               variable = variable + tab + #3#180;
          |FINSI;
          variable = variable + aFinReg;
          |HAZ QuitaRaros;
          |SI #0#67 = "D";
                  |HAZ Diferencia;
                  |SI FSalida ! 0;
                       |XGRABA nHandle, variable;
                  |FINSI;
          |SINO;
                  |XGRABA nHandle, variable;
          |FINSI;
          campo = "";
          variable = "";
          cadena = "";
|FPRC;

|DEFBUCLE lee_art1;
     #3#1;
     2,125;
     #0#7,#0#9,#0#36;
     #0#8,#0#10,#0#37;
     ;
     NULL,pasa_art1;
|FIN;

|PROCESO articul1;
     empresa = #0#29;
     |QBF empresa;
     aFicOrg = empresa + "articul1.txt";
     aFicDes = empresa + "articul1.asc";
     ||empresa = empresa + "articul1.txt";
     |DFICE empresa; empresa = empresa + Usuario;

     |XABRE "WB", empresa, nHandle;
     |SI FSalida ] 0;
          |HAZ IniDiferencia;
          |BUCLE lee_art1;
          |XCIERRA nHandle;
          |HAZ FinDiferencia;
     |SINO;
          aAlfa = "0000Error al crear:" + empresa;
          |SI aParam = ""; |MENAV aAlfa; |FINSI;
     |FINSI;
|FPRC;

||--------------------------  ARTICULOS COD.BARRAS ---------------------------

|PROCESO pasa_art2;
          campo = #3#128; |QBF campo;
          variable = campo + tab;
          campo = #3#1; |QBF campo;
          variable = variable + campo + tab;
          |PINTA 1922,"                                                         ";
          |PINTA 1922,"COD.BARRA:";
          |PINTA 1935,variable;
          campo = #3#0; |QBF campo;
          variable = variable + campo;
          |SI #0#59 = 1;
               |SI #0#58 = 30;
                    variable = variable + tab + #3#180;
               |FINSI;
          |FINSI;
          |SI #0#59 ] 2;
               variable = variable + tab + #3#180;
          |FINSI;
          variable = variable + aFinReg;
          |HAZ QuitaRaros;
          |SI #0#67 = "D";
                  |HAZ Diferencia;
                  |SI FSalida ! 0;
                       |XGRABA nHandle, variable;
                  |FINSI;
          |SINO;
                  |XGRABA nHandle, variable;
          |FINSI;
          campo = "";
          variable = "";
          cadena = "";
|FPRC;

|DEFBUCLE lee_art2;
     #3#1;
     2,125;
     #0#7,#0#9,#0#36;
     #0#8,#0#10,#0#37;
     ;
     NULL,NULL,NULL,NULL,NULL,pasa_art2;
     #3#128;
|FIN;

|PROCESO articul2;
     empresa = #0#29;
     |QBF empresa;
     aFicOrg = empresa + "articul2.txt";
     aFicDes = empresa + "articul2.asc";
     ||empresa = empresa + "articul2.txt";
     |DFICE empresa; empresa = empresa + Usuario;

     |XABRE "WB", empresa, nHandle;
     |SI FSalida ] 0;
          |HAZ IniDiferencia;
          |BUCLE lee_art2;
          |XCIERRA nHandle;
          |HAZ FinDiferencia;
     |SINO;
          aAlfa = "0000Error al crear:" + empresa;
          |SI aParam = ""; |MENAV aAlfa; |FINSI;
     |FINSI;
|FPRC;

||------------------------- RUTINA PRINCIPAL --------------------------------
|PROCESO pasa_psion; |TIPO 3;
     |HAZ EsJamaica; nSwJamaica = FSalida;
     |HAZ EsCarnicas; nSwCarnicas = FSalida;
     |HAZ EsCoimasa; nSwCoimasa = FSalida;
     |HAZ EsCepsax; nSwCepsax = FSalida;

     aFinReg = &13;
     aFinReg = aFinReg + &10;

     |SI #99#1 = "SI";|O #99#1 = "si";
         |HAZ LeeParam;
         |HAZ LeeDivisa;
         |SI #99#2 = "S";|O #99#2 = "s";
             |PARA nPsion = 3;|SI nPsion [ 12;|HACIENDO nPsion = nPsion + 1;
                   |SI #99nPsion = "";|O #99nPsion = "          ";
                       |SAL;
                   |FINSI;
                   |ABRE #0;
                   #0#0 = #99nPsion;
                   |LEE 000#0=;
                   |SI FSalida = 0;
                       |HAZ CreaContadores;
                       empresa = #0#29;
                       |HAZ inicio;
                   |FINSI;
                   |CIERRA #0;
             |SIGUE;
         |SINO;
             |ABRE #0;
             #0#0 = #99#0;
             |LEE 020#0=;
             |SI FSalida = 0;
                 |HAZ CreaContadores;
                 empresa = #0#29;
                 |HAZ inicio;
             |FINSI;
             |CIERRA #0;
         |FINSI;
         |SI aParam = ""; |MENAV "0000FIN DE PROCESOS"; |FINSI;
     |FINSI;
|FPRC;

|CALCULO inicio;
     |HAZ DecimalesBase;

     tab1 = 9;
     final1 = 10;
     final2 = 13;
     tab = &tab1;
     final = "";

     |SI #0#59 ] 2;
          aAlfa = #0#29; |QBF aAlfa;
          aAlfa = aAlfa + "exporta.cfg";
          |SI #0#74 = "C"
               |XABRE "CW", aAlfa, nHandle;
          |SINO;
               |XABRE "W", aAlfa, nHandle;
          |FINSI;
          |SI FSalida ] 0;
               aAlfa = #0#67;
               |XGRABA nHandle, aAlfa;
               |XCIERRA nHandle;
          |SINO;
               aAlfa = "0000Error al crear:" + aAlfa;
               |SI aParam = ""; |MENAV aAlfa; |FINSI;
          |FINSI;
     |FINSI;

     |SI #0#58 ! 99; |O #0#59 = 3;
          |SI #0#11 = "S"; |HAZ f_contador;|HAZ Ansi2Utf8; |FINSI;
     |FINSI;

     |SI #0#58 ! 99;
         |SI #0#1  = "S"; |HAZ clientes; |FINSI;
         |SI #0#6  = "S"; |HAZ articulos; |HAZ Ansi2Utf8; |FINSI;
         |SI #0#20 = "S"; |HAZ f_iva;     |HAZ Ansi2Utf8; |FINSI;
         |SI #0#21 = "S"; |HAZ f_pago;    |HAZ Ansi2Utf8; |FINSI;
         |SI #0#22 = "S"; |HAZ f_cobros;  |HAZ Ansi2Utf8; |FINSI;
         |SI #0#53 ! "N"; |HAZ f_cobalb;  |HAZ Ansi2Utf8; |FINSI;
         |SI #0#28 = "S"; |HAZ f_precios; |HAZ Ansi2Utf8; |FINSI;
         |SI #0#35 = "S"; |HAZ f_dtofam;  |HAZ Ansi2Utf8; |FINSI;
         |SI #0#38 = "S"; |HAZ f_visitas; |HAZ Ansi2Utf8; |FINSI;
         |SI #0#59 ] 2; |O #0#58 = 30;
              |SI #0#60 ! "N";
                    |SI #0#99 = "N";
                         |HAZ Partidas; |HAZ Ansi2Utf8;
                    |FINSI;
                    |HAZ PartiGen; |HAZ Ansi2Utf8;
              |FINSI;
         |FINSI;
     |FINSI;
     |SI #0#11 = "S"; |O #0#59 = 3;
          |HAZ f_impresion; |HAZ Ansi2Utf8;
     |FINSI;
     |SI #0#58 = 99;                  ||Venta Directa
         |SI #0#6  = "S"; |HAZ articul1; |HAZ Ansi2Utf8; |FINSI;
         |SI #0#6  = "S"; |HAZ articul2; |HAZ Ansi2Utf8; |FINSI;
     |FINSI;
     |SI #0#61 = "S"; |HAZ AyudaVta; |HAZ Ansi2Utf8; |FINSI;
     |SI #0#62 = "S";    ||Rutas
          |HAZ Ruta; |HAZ Ansi2Utf8
          |HAZ Situaciones; |HAZ Ansi2Utf8
          |HAZ RutasCli; |HAZ Ansi2Utf8
     |SINO;
          |SI #0#59 = 3;
               |HAZ RutaMaestros; |HAZ Ansi2Utf8
          |FINSI;
     |FINSI;
     |SI #0#59 ] 2;
          |HAZ Representantes; |HAZ Ansi2Utf8;
          |SI #0#6 = "S"; |Y #0#73 = "S";
               |HAZ CodBarra; |HAZ Ansi2Utf8;
          |FINSI;
     |FINSI;
     |SI #0#1 = "S"; |Y #0#6 = "S";
          |HAZ PromoCliArt; |HAZ Ansi2Utf8;
     |FINSI;
     |SI #0#63 = "S";
          |HAZ Proveedores; |HAZ Ansi2Utf8;
     |FINSI;
     |SI #0#6 = "S"; |Y #0#59 ] 2;
          |HAZ Envases; |HAZ Ansi2Utf8;
     |FINSI;
     |SI #0#59 = 3;
          |HAZ Familias; |HAZ Ansi2Utf8;
          |HAZ Subfamilias; |HAZ Ansi2Utf8;
          |HAZ CliModi; |HAZ Ansi2Utf8;
     |FINSI;
     |SI #0#82 = "S";
          |HAZ Almacenes; |HAZ Ansi2Utf8;
     |FINSI;
     |SI #0#84 = "S";
          |HAZ Riesgos; |HAZ Ansi2Utf8;
     |FINSI;
     |SI #0#98 = "S";
          |HAZ DobleStock; |HAZ Ansi2Utf8;
     |FINSI;

     |SI nSwCarnicas = 0;
          |HAZ CarImpuesto; |HAZ Ansi2Utf8;
     |FINSI;
     |SI nSwJamaica = 0;
          |HAZ EsCondepo;
          |SI aEsEmpBase = "S";
               |HAZ JamaCtrlVtaArtFam; |HAZ Ansi2Utf8;
               |HAZ JamaProCli; |HAZ Ansi2Utf8;
          |FINSI;
          |HAZ JamaAlbSat; |HAZ Ansi2Utf8;
     |FINSI;
     |SI nSwCepsax = 0;
          |HAZ CepsaxArtiCanon; |HAZ Ansi2Utf8;
          |HAZ CepsaxTipoCanon; |HAZ Ansi2Utf8;
          |HAZ CepsaxCliGama; |HAZ Ansi2Utf8;
          |HAZ CepsaxGrupoGama; |HAZ Ansi2Utf8;
          |HAZ CepsaxGrupoArti; |HAZ Ansi2Utf8;
     |FINSI;

     aPath = #0#29; |QBF aPath;
     aLon = aPath % A0;
     nPos = 100 + (aLon - 1);
     aPath = aPath % nPos;
     |SI #99#2 = "S";
          aEjecuta = #0#78; |QBF aEjecuta;
     |SINO;
          aEjecuta = #99#13; |QBF aEjecuta;
     |FINSI;
     |SI aEjecuta ! "";
          aEjecuta = aEjecuta + " " + #0#77; |QBF aEjecuta;
          aEjecuta = aEjecuta + " " + aPath;
          |SI #0#79 = "S";
               |SYSTEM aEjecuta;
          |SINO;
               |RSYSTEM aEjecuta;
          |FINSI;
     |FINSI;
|FCAL;

|CALCULO varios;
     |SI #99#2 = "N";
          |PARA i = 3;|SI i [ 12;|HACIENDO i = i + 1;
               |C_M #99i , 1 , "N";
          |SIGUE;
          |C_M #99#0 , 1 , "S";
          |C_M #99#13, 1, "S";
     |SINO;
          |PARA i = 3;|SI i [ 12;|HACIENDO i = i + 1;
               |C_M #99i , 1 , "S";
          |SIGUE;
          |C_M #99#0 , 1 , "N";
          |C_M #99#13, 1, "N";
          #99#13 = ""; |PINTA #99#13;
     |FINSI;
|FCAL;

|PROCESO LeeParam;
     |ABRE #13;
     #13#0 = "A";
     |LEE 001#13=;
     |SI FSalida ! 0; |DDEFECTO #13; |FINSI;
     |LIBERA #13;
     |CIERRA #13;
|FPRC;

|PROCESO LeeDivisa;
     |ABRE #14;
     |ABRE #15;
     #14#0 = "A";
     |LEE 001#14=;
     |SI FSalida ! 0; |DDEFECTO #14; |FINSI;
     #15#0 = #14#9;
     |LEE 001#15=;
     |SI FSalida ! 0; |DDEFECTO #15; |FINSI;
     |LIBERA #14;
     |LIBERA #15;
     |CIERRA #14;
     |CIERRA #15;
|FPRC;


|PROCESO Min;
     #35#0 = #0#0;
     #35#1 = "     ";
|FPRC;

|PROCESO Max;
     #35#0 = #0#0;
     #35#1 = "zzzzz";
|FPRC;

|PROCESO Rutas; |TIPO 0;
     |ABRE #0;
     #0#0 = #99Campo;
     |LEE 000#0=;
     |SI FSalida ! 0; |DDEFECTO #0; |FINSI;
     |CIERRA #0;

     |SI #99#2 = "S";
          |SI Campo = 3;
               #99#13 = #0#78; |PINTA #99#13;
          |FINSI;
     |SINO;
          |SI Campo = 0;
               #99#13 = #0#78; |PINTA #99#13;
          |FINSI;
     |FINSI;

     |C_M #99Campo, 0, aAlfa;
     |SI FSalida = 0; |Y #0#62 = "S"; |Y aAlfa = "S";
          |PUSHV 0501 2380;
          |BLANCO 818 2354;
          |ENTLINEAL #1#35, 2, 4, 21, 1, Min, Max;
          |POPV;
     |FINSI;
|FPRC;

|PROCESO Tecla; |TIPO 0;
     |SI FSalida = 0; |Y #35#1 = Contenido;
          |SI #35#3 = " ";
               #35#3 = "*";
          |SINO;
               #35#3 = " ";
          |FINSI;
          |GRABA 000#35a;
          |PINTA #35#3;
     |FINSI;
|FPRC;

|PROCESO CreaConta;
     #5#2 = aSerie;
     #5#0 = "";
     |LEE 000#5];
     |SI FSalida ! 0; |O #5#2 ! aSerie;
          #5#1 = 1;
          #5#2 = aSerie;
          #5#3 = "";
          #5#0 = "vpedido"; |GRABA 020#5n;
          #5#0 = "vpedcom"; |GRABA 020#5n;
          #5#0 = "vdepo"; |GRABA 020#5n;
          #5#0 = "valbaran"; |GRABA 020#5n;
          #5#0 = "valbaco"; |GRABA 020#5n;
          #5#0 = "vfactura"; |GRABA 020#5n;
          #5#0 = "vfacturo"; |GRABA 020#5n;
          #5#0 = "vfactuco"; |GRABA 020#5n;
          #5#0 = "vfacprof"; |GRABA 020#5n;
          #5#0 = "remesa"; |GRABA 020#5n;
          #5#0 = "desglos"; |GRABA 020#5n;
          #5#0 = "vpresup"; |GRABA 020#5n;
          #5#0 = "ordenfab"; |GRABA 020#5n;
          #5#0 = "vtiquet"; |GRABA 020#5n;
     |FINSI;
|FPRC;

|PROCESO CreaContadores;
     |ABRE #5
     aSerie = #0#23; |HAZ CreaConta;
     aSerie = #0#24; |HAZ CreaConta;
     aSerie = #0#25; |HAZ CreaConta;
     aSerie = #0#26; |HAZ CreaConta;
     aSerie = #0#12; |HAZ CreaConta;
     aSerie = #0#13; |HAZ CreaConta;
     aSerie = #0#14; |HAZ CreaConta;
     aSerie = #0#15; |HAZ CreaConta;
     aSerie = #0#16; |HAZ CreaConta;
     aSerie = #0#17; |HAZ CreaConta;
     aSerie = #0#18; |HAZ CreaConta;
     aSerie = #0#19; |HAZ CreaConta;
     aSerie = #0#47; |HAZ CreaConta;
     aSerie = #0#48; |HAZ CreaConta;
     aSerie = #0#49; |HAZ CreaConta;
     aSerie = #0#50; |HAZ CreaConta;
     |CIERRA #5;
|FPRC;

|PROCESO JamaCheqActa;
     |SI #12#61 = 0; |Y aParam = "";
          |ABRE #102;
          #102#30 = "A";
          #102#20 = #12#52;
          #102#17 = #12#0;
          #102#18 = 1;
          |LEE 000#102];
          |SI FSalida = 0; |Y #102#30 = "A"; |Y #102#20 = #12#52;
                    |Y #102#17 = #12#0;
               aAlfa = "0000Albaran:" + #12#52 + "/" + (("000000" + #12#0) % -106) + &13;
               aAlfa = aAlfa + " a cuenta '0' y con recibos !!!";
               |SI aParam = ""; |MENAV aAlfa; |FINSI;
          |FINSI;
          |CIERRA #102;
     |FINSI;
|FPRC;

|PROGRAMA;
     aParam = PARAMETRO;
     |ABRE #99;
     |LEE 101#99p;
     |SI FSalida ! 0; |GRABA 020#99b; |FINSI;

     |SI aParam = "";
          #99#1 = "NO";
          |PINPA #0#99;
          |PINDA #0#99;
          |ENDATOS #1#99;
          |SI FSalida = 0; |GRABA 020#99a; |FINSI;
     |SINO;
          #99#0 = aParam;
          #99#1 = "SI";
          |HAZ pasa_psion;
     |FINSI;

     |CIERRA #99;
|FPRO;
