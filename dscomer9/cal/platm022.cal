|FICHEROS;
     platm022 #0;
     platm011 #1;
     platm012 #2;
     platm020 #3;
|FIN;

|VARIABLES;
     aEstado = "";
     nModo = 0;
     a = 0;
     ii = 0;
     linea = 0;
     aMerca = "";
|FIN;

|PROCESO Estado;
     |SI #platm022#3 = "D";
          #platm011#7 = "INSTALADO";
          #platm012#3 = #platm012#3 + 1;
     |FINSI;
     |SI #platm022#3 = "A";
          #platm011#7 = "ALMACEN";
          #platm012#2 = #platm012#2 + 1;
     |FINSI;
|FPRC;

|PROCESO Estado1;
     |SI #platm022#3 = "D";
          #platm011#7 = "REPARADO";
          #platm012#3 = #platm012#3 - 1;
     |FINSI;
     |SI #platm022#3 = "A";
          #platm011#7 = "REPARADO";
          #platm012#2 = #platm012#2 - 1;
     |FINSI;
|FPRC;

|PROCESO AltaHisto;
     |ABRE #platm020;
     #platm020#0 = #0#0;
     #platm020#3 = 001;
     |LEE 000#platm020.=;
     |SI FSalida ! 0;
          linea = 1;
     |SINO;
          |PARA ii = 0;|SI ii [ 100;|HACIENDO;
               linea = #platm020#3;
               |LEE 000#platm020.s;
               |SI #platm020#0 ! #0#0;|O FSalida ! 0;
                    |SAL;
               |FINSI;
          |SIGUE;
          #platm020#0 = #0#0;
          #platm020#3 = linea + 1;
          |SI #0#3 = "D";     #platm020#1 = "DEVUELTO";     |FINSI;
          |SI #0#3 = "A";     #platm020#1 = "REALMACENADO"; |FINSI;
          #platm020#2 = #0#4;
          #platm020#6  = 1;
          |GRABA 020#platm020.n;
          |CIERRA #platm020;
     |FINSI;
|FPRC;

|PROCESO platm020;
     aEstado = #platm020#1;   |QBF aEstado;
     |SI aEstado = "DEVUELTO";|O aEstado = "REALMACENADO";
          |BORRA 010#platm020.a;
          |LIBERA #platm020;
     |FINSI;
|FPRC;

|DEFBUCLE platm020;
     #platm020#1;
     2;
     #0#0, 000, #0#4;
     #0#0, 999, #0#4;
     be;
     NULL, platm020;
|FIN;

|PROCESO BajaHisto;
     |BUCLE platm020;
|FPRC;

|PROCESO MiraEstado;
     aMerca = #0#0; |QBT aMerca;
     |SI aMerca !  "";
          |ABRE #platm011;
          #platm011#0 = #platm022#0;
          |LEE 000#platm011.=;
          |SI FSalida = 0;
               aEstado = #platm011#7;   |QBF aEstado;
               |SI aEstado ! "REPARADO";|Y aEstado ! "ENVIOPLATA";|Y aEstado ! "AVERIADO";
                    aEstado = "0000 Esta mercancia esta: " + aEstado;
                    |MENAV aEstado;
                    |ERROR;
               |FINSI;
               |SI #1#8 = "O";
                    |MENAV "0000SOLO NUMEROS DE SERIE";
                    |ERROR;
               |FINSI;
          |FINSI;
          |CIERRA #platm011;
     |FINSI;
|FPRC;

|PROCESO CambiaEstado;
     |ABRE #platm011;
     #platm011#0 = #platm022#0;
     |LEE 101#platm011.=;
     |SI FSalida = 0;
          |ABRE #platm012;
          #platm012#0 = #platm011#2; ||tipo mercancia
          |LEE 101#platm012.=;
          |SI FSalida = 0;
               |SI nModo = 1;
                    |HAZ Estado;
                    |HAZ AltaHisto;
               |FINSI;
               |SI nModo = 2;|Y a = 0;
                    |HAZ Estado;
                    |HAZ AltaHisto;
               |FINSI;
               |SI nModo = 2;|Y a < 0;
                    |HAZ Estado1;
               |FINSI;
               |SI nModo = 3;
                    |HAZ Estado1;
                    |HAZ BajaHisto;
               |FINSI;
               |SI aEstado = "REPARADO";
                    #platm012#5 = #platm012#5 -. 1;
               |SINO;
                    |SI aEstado = "AVERIADO";
                         #platm012#4 = #platm012#4 -. 1;
                    |SINO;
                         #platm012#7 = #platm012#7 -. 1;
                    |FINSI;
               |FINSI;
               |GRABA 020#platm012.a;
         |FINSI;
         |LIBERA #platm012;
         |CIERRA #platm012;
     |FINSI;
     |GRABA 020#platm011.a;
     |LIBERA #platm011;
     |CIERRA #platm011;
|FPRC;

|PROCESO tipo2022; |TIPO 2;
     nModo = (FEntrada / 100) ! 0;
     a = a +. 1;
     |HAZ CambiaEstado;
|FPRC;

|PROCESO tipo3022; |TIPO 3;
     a = 0;
|FPRC;
