|FICHEROS;
     dsz00126 #0;
     agis0002 #2;
     agifa024 #24;
     agifa010 #10;
     agifa036 #36;
     agifa069 #69;
     agifa065 #65;
     agifa070 #70;
     agifa071 #71;
     agifa073 #73;
     agifa084 #84;
     agifv110 #110;
     agifa104 #104;
     agifa133 #133;
     agifa146 #146;
     agifa147 #147;
     dsm00279 #279;
     referen@;
     dscam003@;
     dscam044@;
     dscam045@;
|FIN;

|VARIABLES;
     aPath = "";
     nSwAparecida = 0;
     nSwErp = 0;
     &enError = 0;
     &Tempo = "";
     &enSwMenu = 0;
     aAlfa = "";
     nError = 0;
     nSwRec = 0;
     nEmpresa = 0;
     aSer = "";
     nNum = 0;
     aBase = "";
     aEmp = "";
     nConta = 0;
     nSwModi = 0;
     nModo = 0;
     aAplicaErp = "";
     nEmpErp = 0;
     aDefErp = "";
     aClaveErp = "";
     aNuevaErp = "";
     aErp = "";
     aBass = "";
     aCien = "";
|FIN;

|PROCESO ModiVto;
     |BORRA 020#133a;
     #133#4 = #0#6;
     #133#0 = nConta;
     |GRABA 020#133n;
|FPRC;

|DEFBUCLE ModiVto;
     #133#1;
     ;
     #84#48, #84#0, 001;
     #84#48, #84#0, 999;
     be;
     NULL, ModiVto;
|FIN;

|PROCESO ModiReciFac;
     |SI #84#10 = "S";
          nSwModi = 1;
          nSwRec = 2;
          aSer = #84#48;
          nNum = #84#0;
          |HAZ ReciCartera;
          |BUCLE ModiVto;
     |FINSI;
|FPRC;

|PROCESO ModiReciActa;
     nSwModi = 1;
     nSwRec = 1;
     aSer = #10#52;
     nNum = #10#0;
     |HAZ ReciCartera;

     |BORRA 020#2a;
     #2#20 = #0#6;
     #2#17 = nConta;
     |GRABA 020#2n;
|FPRC;

|DEFBUCLE ModiReciActa;
     #2#1;
     ;
     "A", #10#52, #10#0, 01;
     "A", #10#52, #10#0, 99;
     be;
     NULL, ModiReciActa;
|FIN;

|PROCESO LinPedi;
     |BORRA 020#73a;
     #73#28 = #0#6;
     #73#0 = nConta;
     #73#19 = #24#4;
     #73#20 = #24#0;
     |GRABA 020#73n;
|FPRC;

|PROCESO LinDepo;
     |BORRA 020#70a;
     #70#22 = #0#6;
     #70#0 = nConta;
     #70#17 = #24#4;
     #70#15 = #24#0;
     |GRABA 020#70n;
|FPRC;

|PROCESO LinAlba;
     |BORRA 020#71a;

     #65#0 = #71#2;
     #65#1 = #10#1;
     |SI #10#43 = "S";
          #65#2 = "BV";
     |SINO;
          #65#2 = "AV";
     |FINSI;
     #65#3 = #71#0;
     #65#4 = #71#1;
     #65#11 = #71#29;
     |LEE 121#65=;
     |SI FSalida = 0;
          |BORRA 020#65a;
          |LIBERA #65;
          #65#3 = nConta;
          #65#11 = #0#6;
          #65#10 = #24#0;
          |GRABA 020#65n;
     |FINSI;

     #71#29 = #0#6;
     #71#0 = nConta;
     #71#17 = #24#4;
     #71#15 = #24#0;
     |GRABA 020#71n;
|FPRC;

|PROCESO LinFactu;
     |BORRA 020#69a;

     #65#0 = #69#2;
     #65#1 = #84#1;
     #65#2 = "FC";
     #65#3 = #69#0;
     #65#4 = #69#1;
     #65#11 = #69#20;
     |LEE 121#65=;
     |SI FSalida = 0;
          |BORRA 020#65a;
          |LIBERA #65;
          #65#3 = nConta;
          #65#11 = #0#6;
          #65#10 = #24#0;
          |GRABA 020#65n;
     |FINSI;

     #69#20 = #0#6;
     #69#0 = nConta;
     #69#17 = #24#4;
     #69#15 = #24#0;
     |GRABA 020#69n;
|FPRC;

|PROCESO LinPro;
     |BORRA 020#147a;
     #147#20 = #0#6;
     #147#0 = nConta;
     #147#17 = #24#4;
     #147#15 = #24#0;
     |GRABA 020#147n;
|FPRC;

|PROCESO Cambio;
     #24#0 = #0#5;
     |LEE 020#24=;
     |SI FSalida ! 0; |DDEFECTO #24; |FINSI;

     |SI #0#1 = "PD";
          enError = 0;
          |ABRE #104;
          |SI #0#7 = "N";
               #104#25 = #0#6;
               enSwMenu = 1; |HAZ ContaPV7;
               |GRABA 020#104n;
               nConta = #104#0;
          |SINO;
               nConta = #0#3;
          |FINSI;
          #0#8 = nConta;
          #104#25 = #0#2;
          #104#0 = #0#3;
          |LEE 121#104=;
          enError = FSalida;
          |SI FSalida = 0;
               |BUCLELIN 0 LinPedi #104;
               |BORRA 020#104a;
               |SI nSwErp = 0; aDefErp = "agifa104"; |HAZ DocErp; |FINSI;
               |SI #0#7 = "N";
                    |SALVA_DATOS #104;
                    #104#25 = #0#6;
                    #104#0 = nConta;
                    |LEE 121#104=;
                    |REPON_DATOS #104;
                    #104#25 = #0#6;
                    #104#0 = nConta;
               |FINSI;
               #104#25 = #0#6;
               #104#4 = #24#0;
               #104#8 = #24#2;
               #104#18 = #24#4;
               |SI #0#7 = "N";
                    |GRABA 020#104a;
               |SINO;
                    |GRABA 020#104n;
               |FINSI;
               enError = FSalida;
               |LIBERA #104;
          |FINSI;
          |CIERRA #104;
          |PRINT;
     |FINSI;
     |SI #0#1 = "DP";
          enError = 0;
          |ABRE #36;
          |SI #0#7 = "N";
               #36#46 = #0#6;
               enSwMenu = 1; |HAZ ContaDE7;
               |GRABA 020#36n;
               nConta = #36#0;
          |SINO;
               nConta = #0#3;
          |FINSI;
          #0#8 = nConta;
          #36#46 = #0#2;
          #36#0 = #0#3;
          |LEE 121#36=;
          enError = FSalida;
          |SI FSalida = 0;
               |BUCLELIN 0 LinDepo #36;
               |BORRA 020#36a;
               |SI nSwErp = 0; aDefErp = "agifa036"; |HAZ DocErp; |FINSI;
               |SI #0#7 = "N";
                    |SALVA_DATOS #36;
                    #36#46 = #0#6;
                    #36#0 = nConta;
                    |LEE 121#36=;
                    |REPON_DATOS #36;
                    #36#46 = #0#6;
                    #36#0 = nConta;
               |FINSI;
               #36#46 = #0#6;
               #36#3 = #24#0;
               #36#4 = #24#2;
               #36#35 = #24#4;
               |SI #0#7 = "N";
                    |GRABA 020#36a;
               |SINO;
                    |GRABA 020#36n;
               |FINSI;
               enError = FSalida;
               |LIBERA #36;
          |FINSI;
          |CIERRA #36;
          |PRINT;
     |FINSI;
     |SI #0#1 = "AV";
          enError = 0;
          |ABRE #10;
          |SI #0#7 = "N";
               #10#52 = #0#6;
               enSwMenu = 1; |HAZ ContaAV7;
               |GRABA 020#10n;
               nConta = #10#0;
          |SINO;
               nConta = #0#3;
          |FINSI;
          #0#8 = nConta;
          #10#52 = #0#2;
          #10#0 = #0#3;
          |LEE 121#10=;
          enError = FSalida;
          |SI FSalida = 0;
               |ABRE #65;
               |BUCLELIN 0 LinAlba #10;
               |CIERRA #65;
               |BUCLE ModiReciActa;
               |BORRA 020#10a;
               |SI nSwAparecida = 0; |HAZ AparecidaAlb; |FINSI;
               |SI nSwErp = 0; aDefErp = "agifa010"; |HAZ DocErp; |FINSI;
               |SI #0#7 = "N";
                    |SALVA_DATOS #10;
                    #10#52 = #0#6;
                    #10#0 = nConta;
                    |LEE 121#10=;
                    |REPON_DATOS #10;
                    #10#52 = #0#6;
                    #10#0 = nConta;
               |FINSI;
               #10#52 = #0#6;
               #10#3 = #24#0;
               #10#4 = #24#2;
               #10#35 = #24#4;
               |SI #0#7 = "N";
                    |GRABA 020#10a;
               |SINO;
                    |GRABA 020#10n;
               |FINSI;
               enError = FSalida;
               |LIBERA #10;
          |FINSI;
          |CIERRA #10;
          |PRINT;
     |FINSI;
     |SI #0#1 = "FD";
          enError = 0;
          |ABRE #84;
          |SI #0#7 = "N";
               #84#48 = #0#6;
               enSwMenu = 1; |HAZ ContaFD7;
               |GRABA 020#84n;
               nConta = #84#0;
          |SINO;
               nConta = #0#3;
          |FINSI;
          #0#8 = nConta;
          #84#48 = #0#2;
          #84#0 = #0#3;
          |LEE 121#84=;
          enError = FSalida;
          |SI FSalida = 0;
               |ABRE #65;
               |BUCLELIN 0 LinFactu #84;
               |CIERRA #65;
               |HAZ ModiReciFac;
               |BORRA 020#84a;
               |SI nSwErp = 0; aDefErp = "agifa084"; |HAZ DocErp; |FINSI;
               |SI #0#7 = "N";
                    |SALVA_DATOS #84;
                    #84#48 = #0#6;
                    #84#0 = nConta;
                    |LEE 121#84=;
                    |REPON_DATOS #84;
                    #84#48 = #0#6;
                    #84#0 = nConta;
               |FINSI;
               #84#48 = #0#6;
               #84#3 = #24#0;
               #84#4 = #24#2;
               #84#35 = #24#4;
               |SI #0#7 = "N";
                    |GRABA 020#84a;
               |SINO;
                    |GRABA 020#84n;
               |FINSI;
               enError = FSalida;
               |LIBERA #84;
          |FINSI;
          |CIERRA #84;
          |PRINT;
     |FINSI;
     |SI #0#1 = "PR";
          enError = 0;
          |ABRE #146;
          |SI #0#7 = "N";
               #146#48 = #0#6;
               enSwMenu = 1; |HAZ ContaPR7;
               |GRABA 020#146n;
               nConta = #146#0;
          |SINO;
               nConta = #0#3;
          |FINSI;
          #0#8 = nConta;
          #146#48 = #0#2;
          #146#0 = #0#3;
          |LEE 121#146=;
          enError = FSalida;
          |SI FSalida = 0;
               |BUCLELIN 0 LinPro #146;
               |BORRA 020#146a;
               |SI nSwErp = 0; aDefErp = "agifa146"; |HAZ DocErp; |FINSI;
               |SI #0#7 = "N";
                    |SALVA_DATOS #146;
                    #146#48 = #0#6;
                    #146#0 = nConta;
                    |LEE 121#146=;
                    |REPON_DATOS #146;
                    #146#48 = #0#6;
                    #146#0 = nConta;
               |FINSI;
               #146#48 = #0#6;
               #146#3 = #24#0;
               #146#4 = #24#2;
               #146#35 = #24#4;
               |SI #0#7 = "N";
                    |GRABA 020#146a;
               |SINO;
                    |GRABA 020#146n;
               |FINSI;
               enError = FSalida;
               |LIBERA #146;
          |FINSI;
          |CIERRA #146;
          |PRINT;
     |FINSI;
|FPRC;

|DEFBUCLE Cambio;
     #0#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Cambio;
|FIN;

|PROCESO Recibo;
     |SI nSwModi = 0;
          |SI nSwRec = 1; |Y #dscam003@#69 = "A";
               |SI #dscam003@#14 ! "e"; nError = 1; |FINSI;
          |FINSI;
          |SI nSwRec = 2; |Y #dscam003@#69 = " ";
               |SI #dscam003@#14 ! "P"; nError = 1; |FINSI;
          |FINSI;
          |SI nError ! 0; |ERROR10; |FINSI;
     |SINO;
          |SI nSwRec = 1; |Y #dscam003@#69 = "A";
               #dscam003@#0 = #0#6;
               #dscam003@#1 = nConta;
               #dscam003@#6 = #24#1;
               #dscam003@#5 = #24#16;
               #dscam003@#32 = #24#0;
               #dscam003@#7 = #24#29;
               #dscam003@#8 = #24#32;
               #dscam003@#9 = #24#33;
               #dscam003@#10 = #24#31;
               #dscam003@#11 = #24#30;
               |GRABA 020#dscam003@.a;
          |FINSI;
          |SI nSwRec = 2; |Y #dscam003@#69 = " ";
               #dscam003@#0 = #0#6;
               #dscam003@#1 = nConta;
               #dscam003@#6 = #24#1;
               #dscam003@#5 = #24#16;
               #dscam003@#32 = #24#0;
               #dscam003@#7 = #24#29;
               #dscam003@#8 = #24#32;
               #dscam003@#9 = #24#33;
               #dscam003@#10 = #24#31;
               #dscam003@#11 = #24#30;
               |GRABA 020#dscam003@.a;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE Recibo;
     #dscam003@#12006;
     ;
     aSer, nNum, 000, "01.01.0000", "            ", "      ";
     aSer, nNum, 999, "31.12.9999", "zzzzzzzzzzzz", "zzzzzz";
     be;
     NULL, Recibo;
|FIN;

|PROCESO dscam045;
     |SI aSer ] #dscam045@#4; |Y aSer [ #dscam045@#5;
          aEmp = ("00000" + #dscam045@#6) % -105;
          aAlfa = aBase + "dscarter/fich/" + aEmp + "/";
          |PATH_DAT #dscam003@#aAlfa#;
          |BUCLE Recibo;
          |SI nError ! 0; |ERROR10; |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE dscam045;
     #dscam045@#1002;
     2;
     nEmpresa, 001, "V";
     nEmpresa, 999, "V";
     ;
     NULL, dscam045;
|FIN;

|PROCESO ReciCartera;
     |DBASS aBase;
     aAlfa = aBase + "dscarter/def/dscam045";
     |CARGA_DEF aAlfa, dscam045@;
     |SI FSalida = 0;
          aAlfa = aBase + "dscarter/def/dscam044";
          |CARGA_DEF aAlfa, dscam044@;
          |SI FSalida = 0;
               aAlfa = aBase + "dscarter/def/dscam003";
               |CARGA_DEF aAlfa, dscam003@;
               |SI FSalida = 0;
                    |DFICE aAlfa;
                    aAlfa = aAlfa % -205;
                    nEmpresa = aAlfa;
                    aAlfa = aBase + "dscarter/fich/";
                    |PATH_DAT #dscam044@#aAlfa#;
                    |PATH_DAT #dscam045@#aAlfa#;
                    |ABRE #dscam044@;
                    |BUCLE dscam045;
                    |CIERRA #dscam044@;
                    |DESCARGA_DEF #dscam003@;
               |FINSI;
               |DESCARGA_DEF #dscam044@;
          |FINSI;
          |DESCARGA_DEF #dscam045@;
     |FINSI;
|FPRC;

|PROCESO MiraReciFac;
     nError = 0;
     |SI #84#10 = "S";
          nSwModi = 0;
          nSwRec = 2;
          aSer = #84#48;
          nNum = #84#0;
          |HAZ ReciCartera;
     |FINSI;
|FPRC;

|PROCESO ReciActa;
     |HAZ ReciCartera;
     |SI nError ! 0; |ERROR10; |FINSI;
|FPRC;

|DEFBUCLE ReciActa;
     #2#1;
     ;
     "A", #10#52, #10#0, 01;
     "A", #10#52, #10#0, 99;
     ;
     NULL, ReciActa;
|FIN;

|PROCESO MiraReciActa;
     nError = 0;
     nSwModi = 0;
     nSwRec = 1;
     aSer = #10#52;
     nNum = #10#0;
     |BUCLE ReciActa;
|FPRC;

|PROCESO Min110;
     #110#0 = #0#5;
     #110#1 = "     ";
|FPRC;

|PROCESO Max110;
     #110#0 = #0#5;
     #110#1 = "zzzzz";
|FPRC;

|PROCESO CliNuevo; |TIPO 0;
     nModo = (FEntrada / 100) ! 0;
     |SI #0#4 = #0#5;
          |MENAV "0000El cliente es el mismo...";
          |ERROR; |ACABA;
     |FINSI;
     |ABRE #110;
     #110#0 = #0#5;
     #110#1 = "";
     |LEE 000#110];
     |SI FSalida = 0; |Y #110#0 = #0#5;
          #0#6 = #110#1; |PINTA #0#6;
          |LEE 000#110s;
          |SI FSalida = 0; |Y #110#0 = #0#5;
               #110#0 = #0#5;
               #110#1 = #0#6;
               |LEE 000#110=;
               |CONSULTA_F_CLAVE #1#110, Min110, Max110;
               |SI FSalida = 0;
                    #0#6 = #110#1; |PINTA #0#6;
                    |SI nModo = 1;
                         |SI #0#2 = #0#6; #0#7 = "S"; |SINO; #0#7 = "N"; |PINTA #0#7; |FINSI;
                    |FINSI;
               |SINO;
                    |ERROR;
               |FINSI;
          |SINO;
               |SI nModo = 1;
                    |SI #0#2 = #0#6; #0#7 = "S"; |SINO; #0#7 = "N"; |PINTA #0#7; |FINSI;
               |FINSI;
          |FINSI;
     |SINO;
          |MENAV "0000No existe series por cliente...";
          |ERROR;
     |FINSI;
     |CIERRA #110;
|FPRC;

|PROCESO AdjDep;
     |SI #70#20 ! "01.01.0000";
          nError = 1;
     |FINSI;
|FPRC;

|PROCESO AdjPed;
     |SI #73#43 ! 0; |O #73#49 ! 0;
          nError = 1;
     |FINSI;
|FPRC;

|PROCESO Docu0; |TIPO 0;
     |SI FSalida = 2; |ACABA; |FINSI;
     nError = 0;
     |DDEF aAlfa;
     aAlfa = aAlfa + "dsz00126";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |NOME_DAT #referen@#Tempo#;
          |ABRE #referen@;
          |SELECT #2#referen@;
          #referen@#1 = #0#1;
          #referen@#2 = #0#2;
          #referen@#3 = #0#3;
          |LEE 000#referen@.=;
          |SI FSalida = 0; |Y #referen@#0 ! #0#0;
               nError = #referen@#0;
          |FINSI;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;
     |SI nError ! 0;
          aAlfa = "0000Documento introducido en la linea:" + nError;
          |MENAV aAlfa;
          |ERROR; |ACABA;
     |FINSI;

     |SI #0#1 = "PD";
          |ABRE #104;
          #104#25 = #0#2;
          #104#0 = #0#3;
          |LEE 000#104=;
          |SI FSalida = 0;
               nError = 0;
               |BUCLELIN 2 AdjPed #104;
               |SI nError ! 0;
                    |MENAV "0000Pedido con unidades adjudicadas...";
                    |ERROR;
               |SINO;
                    #0#4 = #104#4; |PINTA #0#4;
               |FINSI;
          |SINO;
               |MENAV "0000No existe documento...";
               |ERROR;
          |FINSI;
          |CIERRA #104;
     |FINSI;
     |SI #0#1 = "DP";
          |ABRE #36;
          #36#46 = #0#2;
          #36#0 = #0#3;
          |LEE 000#36=;
          |SI FSalida = 0;
               nError = 0;
               |BUCLELIN 2 AdjDep #36;
               |SI nError ! 0;
                    |MENAV "0000Deposito con unidades adjudicadas o devueltas...";
                    |ERROR;
               |SINO;
                    #0#4 = #36#3; |PINTA #0#4;
               |FINSI;
          |SINO;
               |MENAV "0000No existe documento...";
               |ERROR;
          |FINSI;
          |CIERRA #36;
     |FINSI;
     |SI #0#1 = "AV";
          |ABRE #10;
          #10#52 = #0#2;
          #10#0 = #0#3;
          |LEE 000#10=;
          |SI FSalida = 0;
               |SI #10#38 = "S";
                    |MENAV "0000Albaran facturado...";
                    |ERROR;
               |SINO;
                    |HAZ MiraReciActa;
                    |SI nError ! 0;
                         |MENAV "0000Recibos a cuenta con movimientos...";
                         |ERROR;
                    |SINO;
                         #0#4 = #10#3; |PINTA #0#4;
                    |FINSI;
               |FINSI;
          |SINO;
               |MENAV "0000No existe documento...";
               |ERROR;
          |FINSI;
          |CIERRA #10;
     |FINSI;
     |SI #0#1 = "FD";
          |ABRE #84;
          #84#48 = #0#2;
          #84#0 = #0#3;
          |LEE 000#84=;
          |SI FSalida = 0;
               |SI #84#39 = "S";
                    |MENAV "0000Factura contabilizada...";
                    |ERROR;
               |SINO;
                    |HAZ MiraReciFac;
                    |SI nError ! 0;
                         |MENAV "0000Recibo factura con movimientos...";
                         |ERROR;
                    |SINO;
                         #0#4 = #84#3; |PINTA #0#4;
                    |FINSI;
               |FINSI;
          |SINO;
               |MENAV "0000No existe documento...";
               |ERROR;
          |FINSI;
          |CIERRA #84;
     |FINSI;
     |SI #0#1 = "PR";
          |ABRE #146;
          #146#48 = #0#2;
          #146#0 = #0#3;
          |LEE 000#146=;
          |SI FSalida = 0;
               |SI #146#61 ! 0;
                    |MENAV "0000Proforma adjudicada...";
                    |ERROR;
               |SINO;
                    #0#4 = #146#3; |PINTA #0#4;
               |FINSI;
          |SINO;
               |MENAV "0000No existe documento...";
               |ERROR;
          |FINSI;
          |CIERRA #146;
     |FINSI;
|FPRC;

|PROCESO Docu66; |TIPO 66;
     |SI #0#1 = "PD";
          |ABRE #104;
          #104#25 = #0#2;
          #104#0 = #0#3;
          |LEE 000#104];
          |CONSULTA_CLAVE #1#104;
          |SI FSalida = 0;
               #0#2 = #104#25; |PINTA #0#2;
               #0#3 = #104#0; |PINTA #0#3;
          |FINSI;
          |CIERRA #104;
     |FINSI;
     |SI #0#1 = "DP";
          |ABRE #36;
          #36#46 = #0#2;
          #36#0 = #0#3;
          |LEE 000#36];
          |CONSULTA_CLAVE #1#36;
          |SI FSalida = 0;
               #0#2 = #36#46; |PINTA #0#2;
               #0#3 = #36#0; |PINTA #0#3;
          |FINSI;
          |CIERRA #36;
     |FINSI;
     |SI #0#1 = "AV";
          |ABRE #10;
          #10#52 = #0#2;
          #10#0 = #0#3;
          |LEE 000#10];
          |CONSULTA_CLAVE #1#10;
          |SI FSalida = 0;
               #0#2 = #10#52; |PINTA #0#2;
               #0#3 = #10#0; |PINTA #0#3;
          |FINSI;
          |CIERRA #10;
     |FINSI;
     |SI #0#1 = "FD";
          |ABRE #84;
          #84#48 = #0#2;
          #84#0 = #0#3;
          |LEE 000#84];
          |CONSULTA_CLAVE #1#84;
          |SI FSalida = 0;
               #0#2 = #84#48; |PINTA #0#2;
               #0#3 = #84#0; |PINTA #0#3;
          |FINSI;
          |CIERRA #84;
     |FINSI;
     |SI #0#1 = "PR";
          |ABRE #146;
          #146#48 = #0#2;
          #146#0 = #0#3;
          |LEE 000#146];
          |CONSULTA_CLAVE #1#146;
          |SI FSalida = 0;
               #0#2 = #146#48; |PINTA #0#2;
               #0#3 = #146#0; |PINTA #0#3;
          |FINSI;
          |CIERRA #146;
     |FINSI;
|FPRC;

|PROCESO CheqNuevo; |TIPO 0;
     |SI #0#7 = "N"; |ACABA; |FINSI;
     |SI #0#2 = #0#6; |ACABA; |FINSI;

     |SI #0#1 = "PD";
          |ABRE #104;
          #104#25 = #0#6;
          #104#0 = #0#3;
          |LEE 000#104=;
          |SI FSalida = 0;
               |MENAV "0000Existe el documento...";
               |ERROR;
          |FINSI;
          |CIERRA #104;
     |FINSI;
     |SI #0#1 = "DP";
          |ABRE #36;
          #36#46 = #0#6;
          #36#0 = #0#3;
          |LEE 000#36=;
          |SI FSalida = 0;
               |MENAV "0000Existe el documento...";
               |ERROR;
          |FINSI;
          |CIERRA #36;
     |FINSI;
     |SI #0#1 = "AV";
          |ABRE #10;
          #10#52 = #0#6;
          #10#0 = #0#3;
          |LEE 000#10=;
          |SI FSalida = 0;
               |MENAV "0000Existe el documento...";
               |ERROR;
          |FINSI;
          |CIERRA #10;
     |FINSI;
     |SI #0#1 = "FD";
          |ABRE #84;
          #84#48 = #0#6;
          #84#0 = #0#3;
          |LEE 000#84=;
          |SI FSalida = 0;
               |MENAV "0000Existe el documento...";
               |ERROR;
          |FINSI;
          |CIERRA #84;
     |FINSI;
     |SI #0#1 = "PR";
          |ABRE #146;
          #146#48 = #0#6;
          #146#0 = #0#3;
          |LEE 000#146=;
          |SI FSalida = 0;
               |MENAV "0000Existe el documento...";
               |ERROR;
          |FINSI;
          |CIERRA #146;
     |FINSI;
|FPRC;

|PROCESO Min;
     #0#0 = 1;
|FPRC;

|PROCESO Max;
     #0#0 = 999;
|FPRC;

|PROGRAMA;
     |DBASS aBass;
     aErp = aBass + "dserp/def/dserpm09.mas";
     |XABRE "E", aErp, 0;
     nSwErp = FSalida;

     |HAZ EsAparecida; nSwAparecida = FSalida;

     |ABRE #279; |LEE 000#279p; |CIERRA #279;
     |SI #279#24 = "S";
          |HAZ CreaTempo; |NOME_DAT #0 Tempo; |DELINDEX #0;
          |CLS;
          |CABEZA "Cambio Cliente Doc";
          |PINPA #0#0;
          |ENTLINEAL #1#0, 1, 1, 22, 0, Min, Max;
          |ABRE #0;
          |LEE 000#0p;
          |SI FSalida = 0;
               |CONFI "0000N¿Es correcto?";
               |SI FSalida = 0;
                    |IMPRE 0;
                    |SI FSalida = 0;
                         |INFOR "dsz00126";
                         |SI FSalida = 0;
                              |ABRE #24;
                              |BUCLE Cambio;
                              |CIERRA #24;
                              |PIEINF;
                              |FININF;
                         |SINO;
                              |MENAV "0000Error en informe 'dsz00126'...";
                         |FINSI;
                         |FINIMP;
                    |FINSI;
               |FINSI;
          |FINSI;
          |CIERRA #0;
          |HAZ BoraTempo; |DELINDEX #0;
     |SINO;
          |MENAV "0000Series por cliente no activo en parametros...";
     |FINSI;
|FPRO;

|PROCESO ModiDocErp;
     |BORRA 020#referen@.a;
     #referen@#1 = aNuevaErp;
     |GRABA 020#referen@.n;
|FPRC;

|DEFBUCLE ModiDocErp;
     #referen@#1005;
     ;
     aAplicaErp, nEmpErp, aDefErp, aClaveErp, 01;
     aAplicaErp, nEmpErp, aDefErp, aClaveErp, 99;
     be;
     NULL, ModiDocErp;
|FIN;

|PROCESO DocErp;
      |CARGA_DEF aErp, referen@;
      |SI FSalida = 0;
          aAlfa = aBass + "dserp/fich/";
          |PATH_DAT #referen@#aAlfa#;

          aCien = " " * 100;
          nEmpErp = #48#0;
          aAplicaErp = "dscomer9";
          aClaveErp = #0#2 + ("000000" + #0#3) % -106;
          aNuevaErp = #0#6 + ("000000" + nConta) % -106;
          |QBF aClaveErp;
          aClaveErp = (aClaveErp + aCien) % 199;
          aClaveErp = aClaveErp + " ";
          |QBF aNuevaErp;
          aNuevaErp = (aNuevaErp + aCien) % 199;
          aNuevaErp = aNuevaErp + " ";
          |BUCLE ModiDocErp;

          |DESCARGA_DEF #referen@;
      |FINSI;
|FPRC;

|PROCESO Aparm021;
     |BORRA 020#referen@.a;
     #referen@#1 = #0#6;
     #referen@#2 = nConta;
     #referen@#4 = #0#5;
     #referen@#6 = #24#2;
     |GRABA 020#referen@.n;
|FPRC;

|DEFBUCLE Aparm021;
     #referen@#3003;
     ;
     #0#2, #0#3, "          ";
     #0#2, #0#3, "zzzzzzzzzz";
     be;
     NULL, Aparm021;
|FIN;

|PROCESO AparecidaAlb;
     |DDEF aPath;
     aAlfa = aPath + "aparm016";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |ABRE #referen@;
          #referen@#0 = #0#2;
          #referen@#1 = #0#3;
          |LEE 101#referen@.=;
          |SI FSalida = 0;
               |BORRA 020#referen@.a;
               #referen@#0 = #0#6;
               #referen@#1 = nConta;
               #referen@#2 = #0#5;
               |GRABA 020#referen@.n;
          |FINSI;
          |CIERRA #referen@;
          |DESCARGA_DEF #referen@;
     |FINSI;

     |DDEF aPath;
     aAlfa = aPath + "aparm021";
     |CARGA_DEF aAlfa, referen@;
     |SI FSalida = 0;
          |BUCLE Aparm021;
          |DESCARGA_DEF #referen@;
     |FINSI;
|FPRC;
