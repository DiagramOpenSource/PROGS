
0.-Quita Barra Scroll
1.-Inventario
3.-Campos Modificables
4.-Documentos Modificables
5.-Clave en Representante
6.-Riesgos
9.-Unidades Venta Minimo
12.-Chequeo Importacion Iber21
=========================================================================
0.- Scroll
|PROCESO SinBarra; |TIPO 5;
     FSalida = "SINBARRA";
|FPRC;
=========================================================================

1.-  LLAMADAS PARA COMPROBAR SI SE HA HECHO UN INVENTARIO Y NO DEJA
     DE MODIFICAR EL DOCUMENTO

|FICHEROS;
     Referen@ #1000;
     agifa017 #17;

     agifa029 #29;
     agifa324 #324;
     agifa321 #321;
     agifa010 #0;
     agifa071 #1;
     agifa084 #2;
     agifa069 #3;
     agifa077 #4;
     agifa080 #5;
     agifa007 #7;
     agifa134 #10;
     agifa146 #146;
     agifa147 #147;
     agifa049 #49;
     agifa059 #59;
     dsm00025 #25;
     agifa036 #36;
     agifa069 #69;
     agifa070 #70;
     agifa071 #71;
     agifa073 #73;
     malpe091 #91;
     agifa104 #104;
     agis0002 #103;
     agifa025 #125;
     agifa142 #142;
     agifv030;
     ||컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴Telefonia
     tlfw0005@ #300;
     tlfm0001@ #301;
     tlfm0002@ #302;
     tlfm0003@ #303;
     agifa501 #501;
     agifa502 #502;
     agifa024 #24;
     agifa019 #19;
     ||컴컴컴컴컴컴컴컴컴컴컴컴컴컴횺odulo Foto
     &foto0016@;
     &foto0015@ #90;

     ||컴컴컴컴컴컴컴컴컴컴컴컴컴컴횺odulo
     dscamrie@ #100;
     dscam038@ #101;
     dscam037@;
     dscam023@ #102;
     dscam024@ #1004;
     dscam045@ #105;
     dsm00024;
     dsm00024@;
     dscam051@;
     champi07@;
|FIN;

|VARIABLES;
     &enRieConce = 0;
     &enRieDispo = 0;
     &enRieUtil = 0;
     aAlfa     = "";
     &PRMNT_enVer   = 0;
     &eaCliRiesgo = "";
     &enImpRiesgo = 0;
     &eaNomCliRie = "";
     &eaOpeRiesgo = "";
     &enImpoRiesgo = 0;
     &eaSerieRiesgo = "";
     &efFechaRiesgo = @;
     &eaEmpRiesgo = "";
     nSwCtrlEmp = 0;
     aAux = "";

     nNume = 0;
     nPrecio = 0;
     || &enPrecio = 0;
     || &eaArticulo = "";
     &enTotal = 0;
     &eaObserv = "";
     nError = 0;
     nEmpresa = 0;
     nTalon = 0;
     aHSer = "";
     aDSer = "";
     nEmp = 0;
     nHayEquiv = 0;
     nHayStock = 0;
     aTempo59 = "";
     &Tempo = "";

     &eaNomDef = "";
     &enCamposDef = 0;
     aDef = "";

     nCalc = 0;

     &VArticulo= "";
     &Envase    = "";
     &Unidades1 = 0;
     &Unidades2 = 0;
     aTecla    = "";
     aFin      = "";
     &enFicOrg = "";
     &enFicImp = "";
     &nDeci_PreDiv = 0;
     &nDeci_Base   = 0;
     &nDeci_PreBase= 0;
     &nDeci_TBas = 0;
     &nDeci_PBas = 0;

     &eaCodCliente = "";
     &eaNomCliente = "";
     &enSigno  = 0;

     aCentro   = "";
     nHandle1  = 0;
     nHandle2  = 0;
     aDat1     = "";
     aDat2     = "";
     nPrime    = 0;
     nVentana  = 0;

     aAlfaRB   = "";
     aAlfa1    = "";
     aAlfa2    = "";
    &qUnid     = 0;
     &qArti    = "";
     aParam    = "";
     aDef1     = "";
     aDef2     = "";
     aDef3     = "";
     aDef4     = "";
     aPath     = "";
     dPath     = "";
     aMensa    = "";
     nCartera  = 0;
     &aRPath   = "";
     &aRNome   = "";
     swCar     = 0;
     nCart     = 0;
     aDef104 = "";
     nImpaga = 0;
|FIN;

|INCLUYE i_varart;


|PROCESO agifv030_1;
/*
     |SELECT #2#agifv030;
     #agifv030#0 = "I";
     #agifv030#1 = 0;
     #agifv030#2 = efFec;
     |LEE 000#agifv030.];
     |SI FSalida = 0; |Y #agifv030#0 = "I"; |Y #agifv030#2 ] efFec;
          enErrHis = 1;
     |SINO;
          enErrHis = 0;
     |FINSI;
*/
     enErrHis = 0;
     |SELECT #2#agifv030;          || Fecha+Almacen
     |LEE 000#agifv030.p;
     |PARA; |SI FSalida = 0; |HACIENDO;
          |SI efFec [ #agifv030#2; |Y #agifv030#0 ! "D";
               enErrHis = 1;
          |FINSI;
          |LEE 000#agifv030.s;
     |SIGUE;
|FPRC;

|PROCESO agifv030;
/*
     |SELECT #2#agifv030;
     #agifv030#0 = "I";
     #agifv030#1 = enAlma;
     #agifv030#2 = efFec;
     |LEE 000#agifv030.];
     |SI FSalida = 0; |Y #agifv030#0 = "I"; |Y #agifv030#1 = enAlma;
               |Y #agifv030#2 ] efFec;
          enErrHis = 1;
     |SINO;
          enErrHis = 0;
     |FINSI;
*/
     enErrHis = 0;
     |SELECT #2#agifv030;          || Fecha+Almacen
     |LEE 000#agifv030.p;
     |PARA; |SI FSalida = 0; |HACIENDO;
          |SI #agifv030#1 = enAlma;
               |SI efFec [ #agifv030#2; |Y #agifv030#0 ! "D";
                    enErrHis = 1;
               |FINSI;
          |FINSI;
          |LEE 000#agifv030.s;
     |SIGUE;
|FPRC;

|PROCESO agifa010;
     enAlma = #agifa071#3;
     |HAZ agifv030;
|FPRC;

|PROCESO agifa084;
     enAlma = #agifa069#3;
     |HAZ agifv030;
|FPRC;

|PROCESO agifa077;
     enAlma = #agifa080#3;
     |HAZ agifv030;
|FPRC;

|PROCESO Error;
     |SI enErrHis ! 0;
          |SI aParam = "L";
               |MENAV "0000Almacen cerrado por inventario...";
          |SINO;
               |SI aParam = "T";
                    |MENAV "0000Stock almacenes cerrados por inventario...";
               |SINO;
                    |MENAV "0000Hay lineas con almacenes cerrados por inventario...";
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO MiraHisV;       || Alba Ventas Cabecera
     aParam = "";
     |ABRE #agifv030;
     |ABRE #agifa010;
     #agifa010#52 = eaSer;
     #agifa010#0 = enDocu;
     |LEE 000#agifa010.=;
     |SI FSalida = 0;
          |BUCLELIN 2 agifa010 #agifa010;
     |FINSI;
     |CIERRA #agifa010;
     |CIERRA #agifv030;
     |HAZ Error;
|FPRC;

|PROCESO MiraHisF;       || Facturas Contado
     aParam = "";
     |ABRE #agifv030;
     |ABRE #agifa084;
     #agifa084#50 = eaSer;
     #agifa084#0 = enDocu;
     |LEE 020#agifa084.=;
     |SI FSalida = 0;
          |BUCLELIN 2 agifa084 #agifa084;
     |FINSI;
     |CIERRA #agifa084;
     |CIERRA #agifv030;
     |HAZ Error;
|FPRC;

|PROCESO MiraHisC;       || Alba Compras Cabecera
     aParam = "";
     |ABRE #agifv030;
     |ABRE #agifa077;
     #agifa077#50 = eaSer;
     #agifa077#0 = enDocu;
     |LEE 020#agifa077.=;
     |SI FSalida = 0;
          |BUCLELIN 2 agifa077 #agifa077;
     |FINSI;
     |CIERRA #agifa077;
     |CIERRA #agifv030;
     |HAZ Error;
|FPRC;

|PROCESO MiraHisL;       || Para Lineas
     aParam = "L";
     |ABRE #agifv030;
     |HAZ agifv030;
     |CIERRA #agifv030;
     |HAZ Error;
|FPRC;

|PROCESO MiraHis0;       || Para Lineas sin error
     aParam = "L";
     |ABRE #agifv030;
     |HAZ agifv030;
     |CIERRA #agifv030;
|FPRC;

|PROCESO MiraHisT;       || Todos los almacenes
     aParam = "T";
     |ABRE #agifv030;
     |HAZ agifv030_1;
     |CIERRA #agifv030;
     |HAZ Error;
|FPRC;

|PROCESO MiraStockIni;
     |ABRE #142; |LEE 000#142p; |CIERRA #142;
     enErrHis = 0;
     |ABRE #29;
     #29#0 = enAlma;
     |LEE 000#29=;
     |SI FSalida = 0; |Y #29#5 ] efFec; |Y #142#153 = "S";
          aAlfa1 = "0000Movimiento no permitido" + &13;
          aAlfa1 = aAlfa1 + "Ultima Fecha Inventario del Almacen [" + efFec + "]";
          |MENAV aAlfa1;
          enErrHis = 1;
     |FINSI;
     |CIERRA #29;
|FPRC;
=========================================================================
3.- Campos Modificables

|VARIABLES;
     aNomUsu   = "";
     aModulo   = "";
     aSN       = "";
|FIN;

|PROCESO CamposModi; |TIPO 7;
     aNomUsu = Usuario % 810;
     |MODULO aModulo;
     |SI aModulo = "dsz99953"; |O aModulo = "dsz99914";
          aModulo = "agifa010";
     |FINSI;

     |ABRE #25;
     #25#0 = aNomUsu;
     |LEE 000#25=;
     |SI FSalida = 0;
          ||컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
          |SI aModulo = "agifa104";
               |C_M #104#9,  0, aSN;              || FP
               |SI aSN = "S"; |Y #25#87 = "N";
                    |C_M #104#9, 1, "N";
               |FINSI;
               |C_M #73#3,  0, aSN;              || Alma
               |SI aSN = "S"; |Y #25#1 = "N";
                    |C_M #73#3, 1, "N";
               |FINSI;
               |C_M #73#6, 0, aSN;              || Precio
               |SI aSN = "S"; |Y #25#2 = "N";
                    |C_M #73#6, 1, "N";
               |FINSI;
               |C_M #73#36, 0, aSN;              || Precio
               |SI aSN = "S"; |Y #25#2 = "N";
                    |C_M #73#36, 1, "N";
               |FINSI;
               |C_M #73#8,  0, aSN;              || Dto1
               |SI aSN = "S"; |Y #25#3 = "N";
                    |C_M #73#8, 1, "N";
               |FINSI;
               |C_M #73#29, 0, aSN;              || Dto2
               |SI aSN = "S"; |Y #25#4 = "N";
                    |C_M #73#29, 1, "N";
               |FINSI;
               |C_M #73#10, 0, aSN;              || Comi
               |SI aSN = "S"; |Y #25#5 = "N";
                    |C_M #73#10, 1, "N";
               |FINSI;
               |C_M #73#27, 0, aSN;              || DA
               |SI aSN = "S"; |Y #25#6 = "N";
                    |C_M #73#27, 1, "N";
               |FINSI;
               |C_M #73#14, 0, aSN;              || IVA
               |SI aSN = "S"; |Y #25#7 = "N";
                    |C_M #73#14, 1, "N";
               |FINSI;
               |C_M #73#22, 0, aSN;              || Rese
               |SI aSN = "S"; |Y #25#8 = "N";
                    |C_M #73#22, 1, "N";
               |FINSI;
               |C_M #73#15, 0, aSN;              || Bloq
               |SI aSN = "S"; |Y #25#9 = "N";
                    |C_M #73#15, 1, "N";
               |FINSI;
          |FINSI;
          ||컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
          |SI aModulo = "agifa036";
               |C_M #36#8,  0, aSN;              || FP
               |SI aSN = "S"; |Y #25#89 = "N";
                    |C_M #36#8, 1, "N";
               |FINSI;
               |C_M #70#3,  0, aSN;              || Alma
               |SI aSN = "S"; |Y #25#10 = "N";
                    |C_M #70#3, 1, "N";
               |FINSI;
               |C_M #70#6, 0, aSN;              || Precio
               |SI aSN = "S"; |Y #25#11 = "N";
                    |C_M #70#6, 1, "N";
               |FINSI;
               |C_M #70#26, 0, aSN;              || Precio
               |SI aSN = "S"; |Y #25#11 = "N";
                    |C_M #70#26, 1, "N";
               |FINSI;
               |C_M #70#8,  0, aSN;              || Dto1
               |SI aSN = "S"; |Y #25#12 = "N";
                    |C_M #70#8, 1, "N";
               |FINSI;
               |C_M #70#23, 0, aSN;              || Dto2
               |SI aSN = "S"; |Y #25#13 = "N";
                    |C_M #70#23, 1, "N";
               |FINSI;
               |C_M #70#10, 0, aSN;              || Comi
               |SI aSN = "S"; |Y #25#14 = "N";
                    |C_M #70#10, 1, "N";
               |FINSI;
               |C_M #70#21, 0, aSN;              || DA
               |SI aSN = "S"; |Y #25#15 = "N";
                    |C_M #70#21, 1, "N";
               |FINSI;
               |C_M #70#11, 0, aSN;              || IVA
               |SI aSN = "S"; |Y #25#16 = "N";
                    |C_M #70#11, 1, "N";
               |FINSI;
          |FINSI;
          ||컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
          |SI aModulo = "agifa010"; |O aModulo = "agifa210";
                    |O aModulo = "agifa033"; |O aModulo = "dsm01000";
                    |O aModulo = "con00610";
               |C_M #0#8,  0, aSN;              || FP
               |SI aSN = "S"; |Y #25#88 = "N";
                    |C_M #0#8, 1, "N";
               |FINSI;
               |C_M #71#3,  0, aSN;              || Alma
               |SI aSN = "S"; |Y #25#17 = "N";
                    |C_M #71#3, 1, "N";
               |FINSI;
               |C_M #71#6, 0, aSN;              || Precio
               |SI aSN = "S"; |Y #25#18 = "N";
                    |C_M #71#6, 1, "N";
               |FINSI;
               |C_M #71#36, 0, aSN;              || Precio
               |SI aSN = "S"; |Y #25#18 = "N";
                    |C_M #71#36, 1, "N";
               |FINSI;
               |C_M #71#8,  0, aSN;              || Dto1
               |SI aSN = "S"; |Y #25#19 = "N";
                    |C_M #71#8, 1, "N";
               |FINSI;
               |C_M #71#33, 0, aSN;              || Dto2
               |SI aSN = "S"; |Y #25#20 = "N";
                    |C_M #71#33, 1, "N";
               |FINSI;
               |C_M #71#10, 0, aSN;              || Comi
               |SI aSN = "S"; |Y #25#21 = "N";
                    |C_M #71#10, 1, "N";
               |FINSI;
               |C_M #71#27, 0, aSN;              || DA
               |SI aSN = "S"; |Y #25#22 = "N";
                    |C_M #71#27, 1, "N";
               |FINSI;
               |C_M #71#11, 0, aSN;              || IVA
               |SI aSN = "S"; |Y #25#23 = "N";
                    |C_M #71#11, 1, "N";
               |FINSI;
          |FINSI;
          ||컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
          |SI aModulo = "agifa084";
               |C_M #2#8,  0, aSN;              || FP
               |SI aSN = "S"; |Y #25#90 = "N";
                    |C_M #2#8, 1, "N";
               |FINSI;
               |C_M #69#3,  0, aSN;              || Alma
               |SI aSN = "S"; |Y #25#24 = "N";
                    |C_M #69#3, 1, "N";
               |FINSI;
               |C_M #69#6, 0, aSN;              || Precio
               |SI aSN = "S"; |Y #25#25 = "N";
                    |C_M #69#6, 1, "N";
               |FINSI;
               |C_M #69#26, 0, aSN;              || Precio
               |SI aSN = "S"; |Y #25#25 = "N";
                    |C_M #69#26, 1, "N";
               |FINSI;
               |C_M #69#8,  0, aSN;              || Dto1
               |SI aSN = "S"; |Y #25#26 = "N";
                    |C_M #69#8, 1, "N";
               |FINSI;
               |C_M #69#21, 0, aSN;              || Dto2
               |SI aSN = "S"; |Y #25#27 = "N";
                    |C_M #69#21, 1, "N";
               |FINSI;
               |C_M #69#10, 0, aSN;              || Comi
               |SI aSN = "S"; |Y #25#28 = "N";
                    |C_M #69#10, 1, "N";
               |FINSI;
               |C_M #69#18, 0, aSN;              || DA
               |SI aSN = "S"; |Y #25#29 = "N";
                    |C_M #69#18, 1, "N";
               |FINSI;
               |C_M #69#11, 0, aSN;              || IVA
               |SI aSN = "S"; |Y #25#30 = "N";
                    |C_M #69#11, 1, "N";
               |FINSI;
               |C_M #69#9, 0, aSN;              || Total
               |SI aSN = "S"; |Y #25#31 = "N";
                    |C_M #69#9, 1, "N";
               |FINSI;
               |C_M #69#27, 0, aSN;              || Total
               |SI aSN = "S"; |Y #25#31 = "N";
                    |C_M #69#27, 1, "N";
               |FINSI;
               |C_M #2#40, 0, aSN;              || Cta
               |SI aSN = "S"; |Y #25#86 = "N";
                    |C_M #2#40, 1, "N";
               |FINSI;
          |FINSI;
          ||컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
          |SI aModulo = "agifa048";
               |C_M #49#9,  0, aSN;              || Alma
               |SI aSN = "S"; |Y #25#65 = "N";
                    |C_M #49#9, 1, "N";
               |FINSI;
               |C_M #49#5, 0, aSN;              || Precio
               |SI aSN = "S"; |Y #25#66 = "N";
                    |C_M #49#5, 1, "N";
               |FINSI;
          |FINSI;
          ||컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
          |SI aModulo = "agifa146";
               |C_M #146#8,  0, aSN;              || FP
               |SI aSN = "S"; |Y #25#91 = "N";
                    |C_M #146#8, 1, "N";
               |FINSI;
               |C_M #147#3,  0, aSN;              || Alma
               |SI aSN = "S"; |Y #25#77 = "N";
                    |C_M #147#3, 1, "N";
               |FINSI;
               |C_M #147#6, 0, aSN;              || Precio
               |SI aSN = "S"; |Y #25#78 = "N";
                    |C_M #147#6, 1, "N";
               |FINSI;
               |C_M #147#26, 0, aSN;              || Precio
               |SI aSN = "S"; |Y #25#78 = "N";
                    |C_M #147#26, 1, "N";
               |FINSI;
               |C_M #147#8,  0, aSN;              || Dto1
               |SI aSN = "S"; |Y #25#79 = "N";
                    |C_M #147#8, 1, "N";
               |FINSI;
               |C_M #147#21, 0, aSN;              || Dto2
               |SI aSN = "S"; |Y #25#80 = "N";
                    |C_M #147#21, 1, "N";
               |FINSI;
               |C_M #147#10, 0, aSN;              || Comi
               |SI aSN = "S"; |Y #25#81 = "N";
                    |C_M #147#10, 1, "N";
               |FINSI;
               |C_M #147#18, 0, aSN;              || DA
               |SI aSN = "S"; |Y #25#82 = "N";
                    |C_M #147#18, 1, "N";
               |FINSI;
               |C_M #147#11, 0, aSN;              || IVA
               |SI aSN = "S"; |Y #25#83 = "N";
                    |C_M #147#11, 1, "N";
               |FINSI;
          |FINSI;
          ||컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
          |SI aModulo = "malpe090";
               |C_M #91#3,  0, aSN;              || Alma
               |SI aSN = "S"; |Y #25#17 = "N";
                    |C_M #91#3, 1, "N";
               |FINSI;
               |C_M #91#6, 0, aSN;              || Precio
               |SI aSN = "S"; |Y #25#18 = "N";
                    |C_M #91#6, 1, "N";
               |FINSI;
               |C_M #91#36, 0, aSN;              || Precio
               |SI aSN = "S"; |Y #25#18 = "N";
                    |C_M #91#36, 1, "N";
               |FINSI;

               |C_M #91#67, 0, aSN;              || Precio
               |SI aSN = "S"; |Y #25#18 = "N";
                    |C_M #91#67, 1, "N";
               |FINSI;
               |C_M #91#68, 0, aSN;              || Precio
               |SI aSN = "S"; |Y #25#18 = "N";
                    |C_M #91#68, 1, "N";
               |FINSI;
               |C_M #91#69, 0, aSN;              || Precio
               |SI aSN = "S"; |Y #25#18 = "N";
                    |C_M #91#69, 1, "N";
               |FINSI;

               |C_M #91#8,  0, aSN;              || Dto1
               |SI aSN = "S"; |Y #25#19 = "N";
                    |C_M #91#8, 1, "N";
               |FINSI;
               |C_M #91#33, 0, aSN;              || Dto2
               |SI aSN = "S"; |Y #25#20 = "N";
                    |C_M #91#33, 1, "N";
               |FINSI;
               |C_M #91#10, 0, aSN;              || Comi
               |SI aSN = "S"; |Y #25#21 = "N";
                    |C_M #91#10, 1, "N";
               |FINSI;
               |C_M #91#27, 0, aSN;              || DA
               |SI aSN = "S"; |Y #25#22 = "N";
                    |C_M #91#27, 1, "N";
               |FINSI;
               |C_M #91#11, 0, aSN;              || IVA
               |SI aSN = "S"; |Y #25#23 = "N";
                    |C_M #91#11, 1, "N";
               |FINSI;
          |FINSI;
          ||컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
          |SI aModulo = "agifa134"; |O aModulo = "agifa130";
               |C_M #10#11,  0, aSN;              || FP
               |SI aSN = "S"; |Y #25#92 = "N";
                    |C_M #10#11, 1, "N";
               |FINSI;
               |C_M #10#12,  0, aSN;              || Cta
               |SI aSN = "S"; |Y #25#85 = "N";
                    |C_M #10#12, 1, "N";
               |FINSI;
          |FINSI;
     |FINSI;
     |CIERRA #25;
|FPRC;

|PROCESO ModiDiviVta; |TIPO 7;
     |MODULO aModulo;
     |DDEF aAlfa; aAlfa = aAlfa + "dsm00279";
     |CARGA_DEF  aAlfa, Referen@;
     |SI FSalida = 0;
          |ABRE #Referen@; |LEE 000#Referen@.p; |CIERRA #Referen@;
          |SI #Referen@#14 = "N";
               |SI aModulo = "agifa010"; |C_M #0#68, 1, "N"; |C_M #0#69, 1, "N"; |C_M #0#70, 1, "N"; |C_M #0#71, 1, "N"; |FINSI;
               |SI aModulo = "agifa210"; |C_M #0#68, 1, "N"; |C_M #0#69, 1, "N"; |C_M #0#70, 1, "N"; |C_M #0#71, 1, "N"; |FINSI;
               |SI aModulo = "agifa033"; |C_M #0#68, 1, "N"; |C_M #0#69, 1, "N"; |C_M #0#70, 1, "N"; |C_M #0#71, 1, "N"; |FINSI;
               |SI aModulo = "agifa104"; |C_M #104#35, 1, "N"; |C_M #104#36, 1, "N"; |C_M #104#37, 1, "N"; |FINSI;
               |SI aModulo = "agifa036"; |C_M #36#49, 1, "N"; |C_M #36#50, 1, "N"; |C_M #36#51, 1, "N"; |FINSI;
               |SI aModulo = "agifa084"; |C_M #2#65, 1, "N"; |C_M #2#66, 1, "N"; |C_M #2#67, 1, "N"; |FINSI;
               |SI aModulo = "agifa146"; |C_M #146#65, 1, "N"; |C_M #146#66, 1, "N"; |C_M #146#67, 1, "N"; |FINSI;
          |FINSI;
          |DESCARGA_DEF #Referen@;
     |FINSI;
|FPRC;
=========================================================================
4.-Documentos Modificables

|VARIABLES;
     nModo     = 0;
     nForma    = 0;
|FIN;

|PROCESO LeeControl;
     aNomUsu = Usuario % 810;
     |MODULO aModulo;

     |ABRE #25;
     #25#0 = aNomUsu;
     |LEE 000#25=;
     |SI FSalida ! 0; |DDEFECTO #25; |FINSI;
     |CIERRA #25;

     nModo = (FEntrada/100) ! 0;
     enErr = 0;
     |SI aModulo = "agifa102"; nModo = 3; |FINSI;
     |SI aModulo = "agifa034"; nModo = 3; |FINSI;
     |SI aModulo = "agifa057"; nModo = 1; |FINSI;
     |SI aModulo = "agifa022"; nModo = 2; |FINSI;
     |SI aModulo = "agi00027"; nModo = 1; |FINSI;
     |SI aModulo = "agifa099"; nModo = 3; |FINSI;
     |SI aModulo = "agifa015"; nModo = 3; |FINSI;
     |SI aModulo = "agifa229"; nModo = 1; |FINSI;
     |SI aModulo = "agifa230"; nModo = 1; |FINSI;
     |SI aModulo = "agifv015"; nModo = 1; |FINSI;
     |SI aModulo = "dsfa0001"; nModo = 2; |FINSI;
     |SI aModulo = "vipez004"; nModo = 3; |FINSI;
|FPRC;

|PROCESO ErrUsuario;
     |SI enErr ! 0;
          aAlfa = "0000Usuario [" + #25#0 + "] NO AUTORIZADO...";
          |MENAV aAlfa;
     |SINO;
          |SI nModo ! 1;
               nForma = 0 +. 1;
               |HAZ RepreClave;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO ControlUsuPV;
     |HAZ LeeControl;
     |SI #25#32 = "N"; |Y nModo = 1; enErr = 1; |FINSI;
     |SI #25#34 = "N"; |Y nModo = 2; enErr = 1; |FINSI;
     |SI #25#33 = "N"; |Y nModo = 3; enErr = 1; |FINSI;
     |HAZ ErrUsuario;
|FPRC;

|PROCESO ControlUsuAV;
     |HAZ LeeControl;
     |SI #25#35 = "N"; |Y nModo = 1; enErr = 1; |FINSI;
     |SI #25#37 = "N"; |Y nModo = 2; enErr = 1; |FINSI;
     |SI #25#36 = "N"; |Y nModo = 3; enErr = 1; |FINSI;
     |HAZ ErrUsuario;
|FPRC;

|PROCESO ControlUsuDV;
     |HAZ LeeControl;
     |SI #25#38 = "N"; |Y nModo = 1; enErr = 1; |FINSI;
     |SI #25#40 = "N"; |Y nModo = 2; enErr = 1; |FINSI;
     |SI #25#39 = "N"; |Y nModo = 3; enErr = 1; |FINSI;
     |HAZ ErrUsuario;
|FPRC;

|PROCESO ControlUsuFT;
     |HAZ LeeControl;
     |SI #25#41 = "N"; |Y nModo = 1; enErr = 1; |FINSI;
     |SI #25#43 = "N"; |Y nModo = 2; enErr = 1; |FINSI;
     |SI #25#42 = "N"; |Y nModo = 3; enErr = 1; |FINSI;
     |HAZ ErrUsuario;
|FPRC;

|PROCESO ControlUsuEC;
     |HAZ LeeControl;
     |SI #25#44 = "N"; |Y nModo = 1; enErr = 1; |FINSI;
     |SI #25#46 = "N"; |Y nModo = 2; enErr = 1; |FINSI;
     |SI #25#45 = "N"; |Y nModo = 3; enErr = 1; |FINSI;
     |HAZ ErrUsuario;
|FPRC;

|PROCESO ControlUsuEC1;
     |HAZ LeeControl;
     |SI #25#44 = "N"; enErr = 1; |FINSI;
     |HAZ ErrUsuario;
|FPRC;

|PROCESO ControlUsuFV;
     |HAZ LeeControl;
     |SI #25#47 = "N"; |Y nModo = 1; enErr = 1; |FINSI;
     |SI #25#49 = "N"; |Y nModo = 2; enErr = 1; |FINSI;
     |SI #25#48 = "N"; |Y nModo = 3; enErr = 1; |FINSI;
     |HAZ ErrUsuario;
|FPRC;

|PROCESO ControlUsuPC;
     |HAZ LeeControl;
     |SI #25#50 = "N"; |Y nModo = 1; enErr = 1; |FINSI;
     |SI #25#52 = "N"; |Y nModo = 2; enErr = 1; |FINSI;
     |SI #25#51 = "N"; |Y nModo = 3; enErr = 1; |FINSI;
     |HAZ ErrUsuario;
|FPRC;

|PROCESO ControlUsuLL;
     |HAZ LeeControl;
     |SI #25#62 = "N"; |Y nModo = 1; enErr = 1; |FINSI;
     |SI #25#63 = "N"; |Y nModo = 2; enErr = 1; |FINSI;
     |SI #25#64 = "N"; |Y nModo = 3; enErr = 1; |FINSI;
     |HAZ ErrUsuario;
|FPRC;

|PROCESO ControlUsuAC;
     |HAZ LeeControl;
     |SI #25#53 = "N"; |Y nModo = 1; enErr = 1; |FINSI;
     |SI #25#55 = "N"; |Y nModo = 2; enErr = 1; |FINSI;
     |SI #25#54 = "N"; |Y nModo = 3; enErr = 1; |FINSI;
     |HAZ ErrUsuario;
|FPRC;

|PROCESO ControlUsuFC;
     |HAZ LeeControl;
     |SI #25#56 = "N"; |Y nModo = 1; enErr = 1; |FINSI;
     |SI #25#58 = "N"; |Y nModo = 2; enErr = 1; |FINSI;
     |SI #25#57 = "N"; |Y nModo = 3; enErr = 1; |FINSI;
     |HAZ ErrUsuario;
|FPRC;

|PROCESO ControlUsuRV;
     |HAZ LeeControl;
     |SI #25#59 = "N"; |Y nModo = 1; enErr = 1; |FINSI;
     |SI #25#61 = "N"; |Y nModo = 2; enErr = 1; |FINSI;
     |SI #25#60 = "N"; |Y nModo = 3; enErr = 1; |FINSI;
     |HAZ ErrUsuario;
|FPRC;

|PROCESO ControlUsuDC;
     |HAZ LeeControl;
     |SI #25#93 = "N"; |Y nModo = 1; enErr = 1; |FINSI;
     |SI #25#95 = "N"; |Y nModo = 2; enErr = 1; |FINSI;
     |SI #25#94 = "N"; |Y nModo = 3; enErr = 1; |FINSI;
     |HAZ ErrUsuario;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
5.- Clave en Representante
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|VARIABLES;
     &aMenClave= "";
     &aClave   = "";
     nu1       = 0;
     nu2       = 0;
     i         = 0;
     aAlf1     = "";
     aCod      = "";
|FINSI;

|PROCESO Clave;
     |BLIN 24;
     |PINTA 2418, aMenClave;
     aAlfa = "";
     E_sup = 10;
     E_inf = "";
     aAlfa = 2444 ? -1;
     |BLIN 24;
     nu2 = 0;
     |PARA i = 101; |SI i [ 1100; |HACIENDO i = i + 100;
          aAlf1 = aAlfa % i;
          nu1 = &aAlf1 * i;    || Encripta la clave
          nu2 = nu2 + nu1;
     |SIGUE;
     aClave = nu2;
     |QBF aClave;
|FPRC;

|PROCESO RepreClave; |TIPO 0;
     |SI #142#135 ! "S"; |ACABA; |FINSI;
     nModo = (FEntrada / 100) ! 0;

     aCod = "";
     |MODULO aModulo;
     |SI aModulo = "agifa104";
          aCod = #104#7;
     |FINSI;
     |SI aModulo = "agifa036";
          aCod = #36#6;
     |FINSI;
     |SI aModulo = "agifa010"; |O aModulo = "agifa210";
      |O aModulo = "agifa033"; |O aModulo = "dsm01000";
          aCod = #0#6;
     |FINSI;
     |SI aModulo = "agifa084";
          aCod = #2#6;
     |FINSI;

     |SI aCod = Contenido;
          ||la variable eaSeClaveRepre se inicializa en el 'dsz99988'
          |SI nModo = 1; |Y eaSwClaveRepre ! ""; |ACABA; |FINSI;
     |FINSI;

     |SI aCod = ""; |ACABA; |FINSI;
     |SI nForma = 1; |Y nModo ! 1; |ACABA; |FINSI;


     |ABRE #125;
     #125#0 = aCod;
     |LEE 020#125=;
     |CIERRA #125;

     aMenClave = "        Entre la CLAVE :";
     |HAZ Clave;
     aAlfa = #125#63;
     |SI aClave ! aAlfa;
          |AVISO;
          |MENAV "0000Clave incorrecta...";
          |SI nModo = 1;
               |PTEC 807;
          |SINO;
               |SI aCod ! Contenido;
                    |PTEC 807;
               |SINO;
                    enErr = 1;
               |FINSI;
          |FINSI;
     |SINO;
          eaSwClaveRepre = aCod;
     |FINSI;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
 6.-                   (RIESGOS)   ACUMULA
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|VARIABLES;
     &eaTag    = "";
     &aSer      = "";
     &aCli      = "";
     &aNomCli   = "";
     nTotal    = 0;
     &nRiesgo   = 0;
     &aDef111  = "";
     &aDef222  = "";
     &aDef333  = "";
      sumalin  = 0;
      &aTipodo  = "";
     &nRieTotal = 0;
     &nRieUtili = 0;
     &aRieBloqu = "";
     &aBloquead = "";
     bAlfa     = "";
     &nImpo    = 0;
|FIN;

|RUTINA AbreRiesgo;
     nCartera = 0;

     |DBASS aPath;
     aMensa = ""; aDef111 = "";

     aDef111 = aPath + "dscarter/def/" + "dscamrie";
     |CARGA_DEF aDef111, dscamrie@;
     |SI FSalida ! 0;
          nCartera = -1;
          |ACABA;
     |FINSI;


     aDef222 = aPath + "dscarter/def/" + "dscam038";
     |CARGA_DEF aDef222, dscam038@;
     |SI FSalida ! 0;
          nCartera = -1;
          |ACABA;
     |FINSI;

     aDef333 = aPath + "dscarter/def/" + "dscam023";
     |CARGA_DEF aDef333, dscam023@;
     |SI FSalida ! 0;
          nCartera = -1;
          |ACABA;
     |FINSI;

     aDef104 = aPath + "dscarter/def/" + "dscam024";
     |CARGA_DEF aDef104, dscam024@;
     |SI FSalida ! 0;
          nCartera = -1;
          |ACABA;
     |FINSI;

     aAlfa = aPath + "dscarter/fich/";

     |PATH_DAT #101 aAlfa;

     |DBASE aPath;

     aRPath = aPath +"fich/";
     |PATH_DAT #100 aRPath;

     aRNome = Usuario;
     |NOME_DAT #100 aRNome;

     ||Hay que borrarlo, por si se ha quedado pillado en una ejecucion anterior
     |ABRE #100;
     |CIERRA #100;
     |DELINDEX #100;
|FRUT;

|PROCESO dscarm038;
     |SI #101#3 > aSer; |O #101#4 < aSer; |ACABA; |FINSI;

     |SI swCar = 0;
          swCar = 1;
          nCart = #101#5;
     |FINSI;

     |DDEFECTO #100;
     sumalin = sumalin + 1;
     #100#0 = aAlfa;
     #100#1 = sumalin;
     #100#2 = nCart;
     #100#3 = aTipodo;
     #100#4 = aSer;
     #100#5 = nRiesgo;
     #100#6 = aCli;
     #100#9 = aNomCli;
     |GRABA 020#100n;
     nCart = #101#5;
|FPRC;

|DEFBUCLE dscarm038;
     #101#2004;
     ;
     00001,aAlfa,aAlfa2,001;
     99999,aAlfa,aAlfa2,999;
     ;
     NULL,dscarm038;
|FIN;

|RUTINA AcumulaRiesgo;
     |SI nRiesgo = 0; |Y eaTag ! ""; |ACABA; |FINSI;

     |SI nSwCtrlEmp = 0;
          |DFICE aAlfa; |QBF aAlfa; aAlfa = aAlfa % -106; aAlfa = aAlfa % 0105;
     |SINO;
          aAlfa = eaEmpRiesgo;
     |FINSI;

     |ABRE #100;
     || nCart = -1;
     swCar = 0; aAlfa2 = aTipodo > aTipodo;
     |BUCLE dscarm038;
/*
     |SI swCar = 0;
         |DDEFECTO #100;
         sumalin = sumalin + 1;
         #100#0 = aAlfa;
         #100#1 = sumalin;
         #100#2 = nCart;
         #100#3 = aTipodo;
         #100#4 = aSer
         #100#5 = nRiesgo;
         #100#6 = aCli;
         #100#9 = aNomCli;
         |GRABA 020#100n;
     |FINSI;
*/
     |CIERRA #100;
|FRUT;

|RUTINA CierraRiesgo;
     |SI aDef104 ! ""; |DESCARGA_DEF #dscam024@; |FINSI;
     |SI aDef333 ! ""; |DESCARGA_DEF #dscam023@; |FINSI;
     |SI aDef222 ! ""; |DESCARGA_DEF #dscam038@; |FINSI;
     |SI aDef111 ! ""; |DESCARGA_DEF #dscamrie@; |FINSI;
|FRUT;

|RUTINA EjecutaRiesgo;
     dPath = ":" + "dscarter/dsriesgo.tab;" + aAlfa;
     |SUB_EJECUTA_NP dPath;
|FRUT;

|PROCESO RiesgosPLB;
     aAux = eaCliRiesgo;
     |QBF aAux;
     |SI aAux ! ""; |Y aAux ! "000000";

         aTipodo = "";
         sumalin = 0;
         nCart   = 0;
         swCar   = 0;

         aCli = eaCliRiesgo;
         aNomCli = eaNomCliRie;
         aTipodo = eaOpeRiesgo;
         nRiesgo = enImpoRiesgo;
         aSer = eaSerieRiesgo;
         ||efFechaRiesgo = ~;
         nSwCtrlEmp = 1;

         |HAZ AbreRiesgo;
         |HAZ AcumulaRiesgo;
         |HAZ CierraRiesgo;
         |HAZ EjecutaRiesgo;
         nSwCtrlEmp = 0;
     |FINSI;
|FPRC

|PROCESO Riesgos;
     nRiesgo = 0;
     aTipodo = "";
     sumalin = 0;
     nCart   = 0;
     swCar   = 0;
     |SI eaTag = "";
          aCli = #24#0;
          aNomCli = #24#1;
          aTipodo = "A";
          |HAZ AbreRiesgo;
          |SI nCartera ! 0;   |ACABA;   |FINSI;
          |HAZ AcumulaRiesgo;
          |HAZ CierraRiesgo;
          |HAZ EjecutaRiesgo;
     |FINSI;
     |SI eaTag = "PE";
          aSer = #104#25;
          aCli = #104#4;
          aNomCli = #104#8;
          |SI nImpo = 0;
             nRiesgo = 0 +. #104#12;
          |SINO;
             nRiesgo = 0 +. nImpo;
          |FINSI;
          |SI enSigno ! 0;
             nRiesgo = nRiesgo * enSigno;
          |FINSI;
          aTipodo = "P";
          |HAZ AbreRiesgo;
          |SI nCartera ! 0;   |ACABA;   |FINSI;
          |HAZ AcumulaRiesgo;
          |HAZ CierraRiesgo;
          |HAZ EjecutaRiesgo;
     |FINSI;

     |SI eaTag = "AV";
          |SI #0#51 = "N"; |ACABA; |FINSI;   || Albaran Facturable
          aSer = #0#52;
          aCli = #0#3;
          aNomCli = #0#4;
          |SI enImpRiesgo = 0;
             nTotal = #0#16+#0#17+#0#18+#0#19+#0#20+#0#21+#0#22+#0#23;
             nTotal = nTotal + #0#44+#0#45+#0#46+#0#47+#0#48+#0#49+#0#28;
          |SINO;
             nTotal = enImpRiesgo;
             enImpRiesgo = 0;
          |FINSI;
          nRiesgo = 0 +. nTotal;
          |SI enSigno ! 0;
             nRiesgo = nRiesgo * enSigno;
          |FINSI;
          |SI #0#43 = "S"; nRiesgo = (nRiesgo * -1); |FINSI;  || Abono
          aTipodo = "A";
          |HAZ AbreRiesgo;
          |SI nCartera ! 0;   |ACABA;   |FINSI;
          |HAZ AcumulaRiesgo;
          |HAZ CierraRiesgo;
          |HAZ EjecutaRiesgo;
     |FINSI;
     |SI eaTag = "FC";
          aSer = #2#48;
          aCli = #2#3;
          aNomCli = #2#4;
          || ABDON (22/11/2004)
          || Esto se ha puesto porque cuando se hacia una factura directa con
          || una entrega a cuenta, al riesgo pasaba solo el total factura, no
          || tenia en cuenta el importe de la entrega
          || nRiesgo = 0 +. #2#41;
          nRiesgo = 0 +. (#2#41 - #2#63);
          |SI enSigno ! 0;
             nRiesgo = nRiesgo * enSigno;
          |FINSI;
          aTipodo = "F";
          |HAZ AbreRiesgo;
          |SI nCartera ! 0;   |ACABA;   |FINSI;
          |HAZ AcumulaRiesgo;
          |HAZ CierraRiesgo;
          |HAZ EjecutaRiesgo;
     |FINSI;
     |SI eaTag = "CB";
          aTipodo = "F"; nRiesgo = nImpo;
          |SI enSigno ! 0;
             nRiesgo = nRiesgo * enSigno;
          |FINSI;
          |HAZ AbreRiesgo;
          |SI nCartera ! 0;   |ACABA;   |FINSI;
          |HAZ AcumulaRiesgo;
          |HAZ CierraRiesgo;
          |HAZ EjecutaRiesgo;
     |FINSI;
     |SI eaTag = "FAC";
          aSer = #10#49;
          aCli = #10#2;
          aNomCli = #10#3;
          |HAZ AbreRiesgo;
          |SI nCartera ! 0;   |ACABA;   |FINSI;
          aTipodo = "F";
          nRiesgo = 0 +. #10#31;
          |SI enSigno ! 0;
             nRiesgo = nRiesgo * enSigno;
          |FINSI;
          |HAZ AcumulaRiesgo;
          aSer = #0#52;
          aTipodo = "A";
          nRiesgo = 0 -. #10#31;
          |SI enSigno ! 0;
             nRiesgo = nRiesgo * enSigno;
          |FINSI;
          |HAZ AcumulaRiesgo;
          |HAZ CierraRiesgo;
          |HAZ EjecutaRiesgo;
     |FINSI;
     |SI eaTag = "PAA";
          aSer = #1#31;
          aCli = #0#3;
          aNomCli = #0#4;
          |HAZ AbreRiesgo;
          |SI nCartera ! 0;   |ACABA;   |FINSI;
          nRiesgo = 0 - nImpo;
          |SI enSigno ! 0;
             nRiesgo = nRiesgo * enSigno;
          |FINSI;
          aTipodo = "P";
          |HAZ AcumulaRiesgo;
          |HAZ CierraRiesgo;
          |HAZ EjecutaRiesgo;
     |FINSI;

     |SI eaTag = "PAM";
          aSer = #1#31;
          aCli = #0#3;
          aNomCli = #0#4;
          |HAZ AbreRiesgo;
          |SI nCartera ! 0;   |ACABA;   |FINSI;
          nRiesgo = 0 + nImpo;
          |SI enSigno ! 0;
             nRiesgo = nRiesgo * enSigno;
          |FINSI;
          aTipodo = "P";
          |HAZ AcumulaRiesgo;
          |HAZ CierraRiesgo;
          |HAZ EjecutaRiesgo;
     |FINSI;

     |SI eaTag = "PAU";
          aSer = #104#25;
          aCli = #104#4;
          aNomCli = #104#8;
          |HAZ AbreRiesgo;
          |SI nCartera ! 0;   |ACABA;   |FINSI;
          nRiesgo = (nImpo * -1);
          |SI enSigno ! 0;
             nRiesgo = nRiesgo * enSigno;
          |FINSI;
          aTipodo = "P";
          |HAZ AcumulaRiesgo;
          |HAZ CierraRiesgo;
          |HAZ EjecutaRiesgo;
     |FINSI;
     |SI eaTag = "RAP"; || Recibos adelantados de pedidos
          aSer = #103#20;
          aCli = #103#2;
          aNomCli = #103#3;
          || nRiesgo = 0 -. #103#9;
          nRiesgo = 0 +. #103#9;
          |SI enSigno ! 0;
             nRiesgo = nRiesgo * enSigno;
          |FINSI;
          aTipodo = "p";
          |HAZ AbreRiesgo;
          |SI nCartera ! 0;   |ACABA;   |FINSI;
          |HAZ AcumulaRiesgo;
          |HAZ CierraRiesgo;
          |HAZ EjecutaRiesgo;
     |FINSI;
     |SI eaTag = "RAA"; || Recibos adelantados de albaranes
          aSer = #103#20;
          aCli = #103#2;
          aNomCli = #103#3;
          || nRiesgo = 0 -. #103#9;
          nRiesgo = 0 +. #103#9;
          |SI enSigno ! 0;
             nRiesgo = nRiesgo * enSigno;
          |FINSI;
          aTipodo = "a";
          |HAZ AbreRiesgo;
          |SI nCartera ! 0;   |ACABA;   |FINSI;
          |HAZ AcumulaRiesgo;
          |HAZ CierraRiesgo;
          |HAZ EjecutaRiesgo;
     |FINSI;
     |SI eaTag = "OR";
          aSer = eaSerie;
          aCli = eaCliente;
          aNomCli = eaNomCliente;
          nTotal = enTotal;
          nRiesgo = 0 +. nTotal;
          |SI enSigno ! 0;
             nRiesgo = nRiesgo * enSigno;
          |FINSI;
          aTipodo = "A";
          |HAZ AbreRiesgo;
          |SI nCartera ! 0;   |ACABA;   |FINSI;
          |HAZ AcumulaRiesgo;
          |HAZ CierraRiesgo;
          |HAZ EjecutaRiesgo;
     |FINSI;
|FPRC;

|PROCESO Impagado;
     nImpaga = nImpaga + #1004#7;
|FPRC;

|DEFBUCLE Impagado;
     #1004#1002;
     ;
     #102#0, 01;
     #102#0, 99;
     ;
     NULL, Impagado;
|FIN;

|PROCESO sacadatos;
     aAlfa = aPath + "dscarter/fich/" + (("00000" + #dscam038@#5) % -105) + "/";
     |PATH_DAT #dscam051@#aAlfa#; |ABRE #dscam051@;
     |LEE 000#dscam051@.p;
     |SI FSalida ! 0; |DDEFECTO #dscam051@; |FINSI;

     |SI #101#5 ! 0;
          |SI eaTag = ""; |Y #101#2 = "A"; eaRieSuma = "S"; |FINSI;
          |SI eaTag = "PE"; |Y #101#2 = "P"; eaRieSuma = "S"; |FINSI;
          |SI eaTag = "AV"; |Y #101#2 = "A"; eaRieSuma = "S"; |FINSI;
          |SI eaTag = "FD"; |Y #101#2 = "F"; eaRieSuma = "S"; |FINSI;
          |SI eaTag = "PORTATIL"; |Y #101#2 = "P"; eaRieSuma = "S"; |FINSI;
          |SI eaTag = "PROFO";    |Y #101#2 = "P"; eaRieSuma = "S"; |FINSI;

          bAlfa = #101#5;
          |QBF bAlfa;
          bAlfa = ( "00000" + bAlfa) % -105;
          aAlfa = aPath + "dscarter/fich/" + bAlfa + "/";
          |PATH_DAT #102 aAlfa;
          |PATH_DAT #1004 aAlfa;

          |ABRE #102;
          #102#0 = aCli;
          |LEE 000#102=;
          |SI FSalida = 0;
               eaExisteCliRie = "S";
               |SI nCart ! #101#5;
                    aAlfa = "|NC"; aAlfa = #dscam051@#aAlfa#; nCalc = aAlfa;
                    |SI nCalc ] 105;
                       |SI #dscam051@#105 = "S";
                          |SI eaSerie ] #dscam038@#3; |Y eaSerie [ #dscam038@#4;
                             nRieTotal = nRieTotal + #102#19;
                             nRieUtili = nRieUtili + #102#20;
                             nCart = #101#5;
                          |FINSI;
                       |SINO;
                          nRieTotal = nRieTotal + #102#19;
                          nRieUtili = nRieUtili + #102#20;
                          nCart = #101#5;
                       |FINSI;
                    |SINO;
                       nRieTotal = nRieTotal + #102#19;
                       nRieUtili = nRieUtili + #102#20;
                       nCart = #101#5;
                    |FINSI;
               |FINSI;
               |SI #102#9 = "S"; |O #102#9 = "X";
                    aRieBloqu = "S";
                    aBloquead = #102#10;
               |FINSI;
               |SI #102#9 = "A";
                    nImpaga = 0;
                    |BUCLE Impagado;
                    |SI nImpaga > 0;
                         aRieBloqu = "S";
                         aBloquead = #102#10;
                    |FINSI;
               |FINSI;

               eaObserv = "";
               |DBASE aAlfa;
               aAlfa = aAlfa + "/def/tagm0001.mas";
               |XABRE "E", aAlfa, 0;
               |SI FSalida = 0;
                    eaObserv = #102#24;
               |FINSI;
          |FINSI;
          |CIERRA #102;
     |FINSI;
     |CIERRA #dscam051@;
|FPRC;

|DEFBUCLE sacadatos;
     #101#2004;
     ;
     00001,#48#0," ",001;
     99999,#48#0,"z",999;
     ;
     NULL,sacadatos;
|FIN;

|PROCESO SacaRiesgo;
     |HAZ AbreRiesgo;
     |SI nCartera ! 0;   |ACABA;   |FINSI;
     nRieTotal  = 0;
     nRieUtili  = 0;
     aRieBloqu  = "";
     aBloquead  = "";
     swCar      = 0;
     nCart      = 0;
     eaRieSuma = "N";
     |SI eaTag = "AV";
          aCli = #0#3;
          aNomCli = #0#4;
     |FINSI;
     |SI eaTag = "PE";
          aCli = #104#4;
          aNomCli = #104#8;
     |FINSI;
     |SI eaTag = "FD";
          aCli = #2#3;
          aNomCli = #2#4;
     |FINSI;
     eaTag = eaTag % 108;
     |SI eaTag = "PORTATIL";
          aCli = eaTag % 906;
          aNomCli = eaTag % 1630;
     |FINSI;
     |SI eaTag = ""; |O eaTag = "PROFO";
        aCli = eaCodCliente;
        aNomCli = eaNomCliente;
     |FINSI;
     |DBASS aPath;
     eaExisteCliRie = "N";

     |DBASS aAlfa; aAlfa = aAlfa + "dscarter/def/dscam051.mas"
     |CARGA_DEF aAlfa, dscam051@;
     |SI FSalida ! 0;
        |MENAV "    No encuentro el def de parametros generales de cartera";
     |SINO;
        |BUCLE sacadatos;
        |DESCARGA_DEF #dscam051@;
     |FINSI;

     |HAZ CierraRiesgo;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
 9.-                   MODULO UNIDADE VENTA MINIMO
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO ComproMin;
     |ABRE #19;
     #19#0 = qArti;
     |LEE 000#19=;
     |SI qUnid < #19#198;
          aAlfa1 = #19#198;
          aAlfa = "0000Unidades Minimas Venta " + aAlfa1;
          |MENAV aAlfa;
          enErr = 1;
     |SINO;
          enErr = 0;
     |FINSI;
     |CIERRA #19;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
 12.-              Comprobacion Importacion de IBer21
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO CheqFicImp;
     |XABRE "U", enFicOrg, nHandle1;
     |SI FSalida ] 0;
          |XABRE "U", enFicImp, nHandle2;
          |SI FSalida ] 0;
               |XLEE nHandle1, 255, aDat1;
               |XLEE nHandle2, 255, aDat2;
               |PARA; |SI FSalida ] 0; |HACIENDO;
                    |XLEE nHandle1, 255, aDat1;
                    |XLEE nHandle2, 255, aDat2;
                    aDat1 = aDat1 % 107;
                    aDat2 = aDat2 % 107;
                    |SI aDat1 ! aDat2;  ||.... Es Incorrecto
                         enFicOrg = "";
                         enFicImp = "";
                         FSalida = 1;
                    |FINSI;
               |SIGUE;
               |XCIERRA nHandle2;
          |FINSI;
          |XCIERRA nHandle1;
     |FINSI;
|FPRC;

|PROCESO AvisaRiesgo;
     |AVISO;
     |PUSHV 0501 2380;
     |BLANCO 0919 1667;
     |CUADRO 0919 1667;
     |CUADRO 1020 1566;
     |COLOR 7,4; |ATRI 0; |BLANCO 1021 1465; |ATRI 0;
     |COLOR 4,7; |ATRI 0; |PINTA 1230, " RIESGO CLIENTE SUPERADO..."; |ATRI 0;
     |COLOR 15,4; |ATRI 0; |PINTA 1440, "Pulse Fin para continuar."; |ATRI 0;
     aFin = &255 + 816;
     |PARA aTecla = ""; |SI aTecla ! aFin; |HACIENDO;
          |LEETECLA aTecla;
     |SIGUE;
     |POPV;
|FPRC;

|PROCESO AvisaRiesgoX;
     |AVISO;
     |PUSHV 0919 1667;
     |VENTANA 0919, 1667, -1, -1, "";
     nVentana = FSalida;

     |CUADRO 0919 1667;
     |CUADRO 1020 1566;
     |COLOR 7,4; |ATRI 0; |BLANCO 1021 1465; |ATRI 0;
     |COLOR 4,7; |ATRI 0; |PINTA 1230, " RIESGO CLIENTE SUPERADO..."; |ATRI 0;
     |COLOR 15,4; |ATRI 0; |PINTA 1440, "Pulse Fin para continuar."; |ATRI 0;
     aFin = &255 + 816;
     |PARA aTecla = ""; |SI aTecla ! aFin; |HACIENDO;
          |LEETECLA aTecla;
     |SIGUE;

     |FINVENTANA nVentana;
     |POPV;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
   ENVASES
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO EntraEnvase;
     enEntraEnvase = 0;
     |ABRE #19;
     #19#0 = VArticulo;
     |LEE 000#19=;
     |SI FSalida = 0; |Y #19#4 > 0;
          |SI enTipEnvase = 2;
               ||llamadada desde un tipo2
               ||para rellenar Unidades y envase cuando factor = 1
               aAlfa = #19#139;
               |QBF aAlfa;
               |SI aAlfa ! ""; |Y #19#140 = 1;
                    aAlfa = #19#141 + #19#143 + #19#145;
                    |QBF aAlfa;
                    |SI aAlfa = "";
                         Envase = #19#139;
                         Unidades1 = Unidades2 * #19#140;
                    |FINSI;
               |FINSI;
          |SINO;
               || si tiene que salir siempre o pulsa la tecla
               |SI #agifa142#179 = "S"; |O enTipEnvase = 1;
                    aAlfa = #19#139 + #19#141 + #19#143 + #19#145;
                    |QBF aAlfa;
                    |SI aAlfa ! "";
                         aAlfa = #19#141 + #19#143 + #19#145;
                         |QBF aAlfa;
                         |SI aAlfa ! ""; |O #19#140 ! 1;
                                   |O enTipEnvase = 1; |O Envase ! "  ";
                              |SI Unidades1 = Unidades2; |Y #19#140 = 1;
                                        |Y aAlfa = ""; |Y enTipEnvase = 0;
                                   ||si Unid. son iguales y el factor=1
                                   ||y solo 1 envase, pos no sale...
                              |SINO;
                                   enModo = (FEntrada / 100) ! 0;
                                   |SUB_EJECUTA_NP "agiw0004;NOMEQUITES"
                                   enEntraEnvase = 1;
                              |FINSI;
                         |FINSI;
                    |SINO;
                         |SI enTipEnvase = 1;
                              |MENAV "0000Articulo sin envases...";
                              |ERROR;
                         |FINSI;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
     |CIERRA #19;
     enTipEnvase = 0;
|FPRC;

|PROCESO CamposDef;
     |DDEF aDef;
     aDef = aDef + eaNomDef;
     |CARGA_DEF aDef, Referen@;
     |SI FSalida = 0;
          aAlfa = "|NC";
          aAlfa = #Referen@#aAlfa#;
          enCamposDef = aAlfa;
          enCamposDef = enCamposDef - 1;
          |DESCARGA_DEF #Referen@;
     |FINSI;
|FPRC;

|PROCESO RecVentaTalon;
     nRieUtili = nRieUtili - #Referen@#64;
     nTalon = nTalon + #Referen@#64;
|FPRC;

|DEFBUCLE RecVentaTalon;
     #Referen@#12006;
     14;
     aDSer, 000000, 000, "01.01.0000", "            ", aCli, "T";
     aHSer, 999999, 999, "31.12.9999", "zzzzzzzzzzzz", aCli, "T";
     ;
     NULL, RecVentaTalon;
|FIN;

|PROCESO CtrlRiesgo;
     |SI #105#6 = 0; |ACABA; |FINSI;
     aAlfa = #105#6;
     |QBF aAlfa;
     aAlfa = ( "00000" + aAlfa) % -105;
     aAlfa = aPath + "dscarter/fich/" + aAlfa + "/";
     |PATH_DAT #Referen@#aAlfa#;
     aDSer = #105#4;
     aHSer = #105#5;
     |BUCLE RecVentaTalon;
|FPRC;

|DEFBUCLE CtrlRiesgo;
     #105#1002;
     2;
     nEmp, 001, "V";
     nEmp, 999, "V";
     ;
     NULL, CtrlRiesgo;
|FIN;

|PROCESO HorRiesgo;
     |HAZ AbreRiesgoHor;
     |SI nCartera ! 0;   |ACABA;   |FINSI;
     nRieUtili = nRieUtili - nRieTotal;

     |DFICE aAlfa;
     aAlfa = aAlfa % -205;
     nEmp = aAlfa;
     nTalon = 0;
     |BUCLE CtrlRiesgo;
     |HAZ CierraRiesgoHor;
|FPRC;


|RUTINA AbreRiesgoHor;
     nCartera = 0;

     |DBASS aPath;
     aMensa = ""; aDef111 = ""; aDef222 = "";

     aDef111 = aPath + "dscarter/def/" + "dscam045";
     |CARGA_DEF aDef111, dscam045@;
     |SI FSalida ! 0;
          nCartera = -1;
          |ACABA;
     |FINSI;

     aDef222 = aPath + "dscarter/def/" + "dscam003";
     |CARGA_DEF aDef222, Referen@;
     |SI FSalida ! 0;
          nCartera = -1;
          |ACABA;
     |FINSI;

     aAlfa = aPath + "dscarter/fich/";
     |PATH_DAT #105 aAlfa;
|FRUT;

|RUTINA CierraRiesgoHor;
     |SI aDef222 ! ""; |DESCARGA_DEF #Referen@; |FINSI;
     |SI aDef111 ! ""; |DESCARGA_DEF #dscam045@; |FINSI;
|FRUT;

----------------------------Copia Logos Crystal
|VARIABLES;
     aBase        = "";
     aDestinoDll  = "";
     aOrigenDll   = "";
     aDestinoLogo = "";
     aOrigenLogo  = "";
     aIPRemoto    = "";
     aDocRemoto   = "";
     aDocServidor = "";
     aOrigen      = "";
     aDestino     = "";
     aAbre        = "";
     aDirec       = "";
     aLong        = "";
     aCaracter    = "";
     aLogo        = "";

     nHandle      = 0;
     nLong        = 0;
     nCaracter    = 0;
     nPos         = 0;


     {1}aContieneLog = "";

     &eaPathLogo  = "";
|FIN;

|PROCESO MiraLogos;        || Para el Crystal
     |ABRE #142; |LEE 000#142p; |CIERRA #142;
     aAlfa = #142#228; |QBF aAlfa;
     |SI aAlfa = ""; |ACABA; |FINSI;

     aBase = "/DOCUMENTOS/LOGOS/DSCOMER9/";   |RMKDIR aBase;

     |DBASE aBase;  |QBF aBase;
     aAlfa = "00000" + #48#0;
     aAlfa = aAlfa % -105;
     aOrigen  = aBase + "Documentos/logos/" + aAlfa + "/" + #142#228; |QBF aOrigen;
     |XABRE "E", aOrigen, 0;
     |SI FSalida < 0; |ACABA; |FINSI;

     aDestino = "/DOCUMENTOS/LOGOS/DSCOMER9/logo.bmp"; |QBF aDestino;

     aContieneLog1 = aDestino;
     |ESPECIFICA "REMOTOMD5", aContieneLog;
     aDocRemoto = FSalida;  |QBF aDocRemoto;

     aContieneLog1 = aOrigen;
     |ESPECIFICA "MD5", aContieneLog;
     aDocServidor = FSalida;  |QBF aDocServidor;

     |SI aDocRemoto ! aDocServidor;  |O aDocRemoto = "";
         aIPRemoto = "";
         |IP_REMOTO aIPRemoto;  |QBT aIPRemoto;

         |SI aIPRemoto ! "";
             |ENVIA_FICHERO aOrigen, aDestino;
         |SINO;
             |COPIA_FICHERO aOrigen, aDestino;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO ChampiPinAux;
     |DDEF aDef;
     |SI eaTipo = "V";
          aAlfa = aDef + "champ004";
     |SINO;
          aAlfa = aDef + "champ005";
     |FINSI;
     |CARGA_DEF aAlfa, Referen@;
     |SI FSalida = 0;
          |DDEFECTO #Referen@;
          |ABRE #Referen@;
          #Referen@#0 = eaSerie;
          #Referen@#1 = enCodigo;
          #Referen@#2 = enLinea;
          |LEE 000#Referen@.=;
          |CIERRA #Referen@;
          |PINTA 2303, "Bultos:           Bruto:           Tara:          ";
          |PINTA 2310, #Referen@#3;
          |PINTA 2327, #Referen@#4;
          |PINTA 2343, #Referen@#5;
          |DESCARGA_DEF #Referen@;
     |FINSI;
|FPRC;

|PROCESO EmarPinAlb;
     || Pongo campos no visualisables del albaran
     || la pantalla del modulo se superpone sobre estos
     |C_V #4#58, 1, "N";
     |C_V #4#56, 1, "N";
     |C_V #4#57, 1, "N";
     |C_V #4#59, 1, "N";
     |C_V #4#60, 1, "N";

     |DDEF aAlfa;
     aAlfa = aAlfa + "champi07";
     |CARGA_DEF aAlfa, champi07@;
     |SI FSalida ! 0;
          |MENAV "0000Error al cargar 'champi07'";
     |SINO;
          |ABRE #champi07@;
          #champi07@#0 = #4#50;
          #champi07@#1 = #4#0;
          |LEE 000#champi07@.=;
          |CIERRA #champi07@;
          |PINPA #0#champi07@;
          |PINDA #0#champi07@;
          |DESCARGA_DEF #champi07@;
     |FINSI;
|FPRC;

|PROCESO ChampiPinEmar;
     |DDEF aDef;
     |SI eaTipo = "AV"; aAlfa = aDef + "champi04"; |FINSI;
     |SI eaTipo = "AC"; aAlfa = aDef + "champi05"; |FINSI;
     |SI eaTipo = "PV"; aAlfa = aDef + "champi10"; |FINSI;
     |SI eaTipo = "PR"; aAlfa = aDef + "champi11"; |FINSI;
     |CARGA_DEF aAlfa, Referen@;
     |SI FSalida = 0;
          |DDEFECTO #Referen@;
          |ABRE #Referen@;
          #Referen@#0 = eaSerie;
          #Referen@#1 = enCodigo;
          #Referen@#2 = enLinea;
          |LEE 000#Referen@.=;
          |CIERRA #Referen@;
          |PINTA 2303, "Envase:      Bultos:           Bruto:           Tara:          .";
          |PINTA 2311, #Referen@#6;
          |PINTA 2323, #Referen@#3;
          |PINTA 2340, #Referen@#4;
          |PINTA 2356, #Referen@#5;
          |DESCARGA_DEF #Referen@;
     |FINSI;
|FPRC;

|PROCESO SelecPartida;
     |SI #agifa142#237 = "S"; ||Solo Caducadas
          |SI #dsm00024#27 < efFecha; |ACABA; |FINSI;
     |FINSI;
     |SI #agifa142#238 = "S"; ||Solo Stock
          |SI #dsm00024#22 [ 0; |ACABA; |FINSI;
     |FINSI;
     |SALVA_DATOS #dsm00024;
     |REPON_DATOS #dsm00024@;
     |GRABA 020#dsm00024@.n;
|FPRC;

|DEFBUCLE SelecPartida;
     #dsm00024#1;
     ;
     eaArticulo, enAlmacen, "                              ";
     eaArticulo, enAlmacen, "zzzzzzzzzzzzzzzzzzzzzzzzzzzzzz";
     ;
     NULL, SelecPartida;
|FIN;

|PROCESO ConsultaPartida;
     |ABRE #142; |LEE 000#142p; |CIERRA #142;
     |DDEF aAlfa; aAlfa = aAlfa + "dsm00024";
     |CARGA_DEF aAlfa, dsm00024@;
     |SI FSalida ! 0; |ACABA; |FINSI;
     aAlfa = Usuario + "p";
     |NOME_DAT #dsm00024@#aAlfa#;
     |ABRE #dsm00024@;
     |BUCLE SelecPartida;
     |LEE 000#dsm00024.p;
     |CONSULTA_CLAVE #1#dsm00024@;
     |SI FSalida = 0;
          eaPartida = #dsm00024@#2;
     |SINO;
          |ERROR;
     |FINSI;
     |CIERRA #dsm00024@;
     |DELINDEX #dsm00024@;
     |DESCARGA_DEF #dsm00024@;
     |QBF eaPartida;
|FPRC;

|PROCESO LinCtrlRie;
     |SI nEmpresa ! #dscam038@#5; |Y eaSerie ] #dscam038@#3; |Y eaSerie [ #dscam038@#4;
          nEmpresa = #dscam038@#5;
          |ABRE #dscam037@;
          #dscam037@#0 = #dscam038@#0;
          |LEE 020#dscam037@.=;
          |SI FSalida = 0;
               |DBASS aPath;
               aAlfa = aPath + "dscarter/fich/" + (("00000" + #dscam038@#5) % -105) + "/";
               |PATH_DAT #dscam051@#aAlfa#;
               |ABRE #dscam051@;
               |LEE 000#dscam051@.p;
               |SI #dscam051@#3 = "S";
                    |PATH_DAT #dscam023@#aAlfa#;
                    |ABRE #dscam023@;
                    #dscam023@#0 = eaCliente;
                    |LEE 000#dscam023@.=;
                    |SI FSalida ! 0;
                         aAlfa = ("00000" + #dscam038@#5) % -105;
                         aAlfa = "0000No existe cliente '" + eaCliente + "' en empresa cartera '" + aAlfa + "'";
                         |MENAV aAlfa; nError = 1;
                    |FINSI;
                    |CIERRA #dscam023@;
               |FINSI;
               |CIERRA #dscam051@;
          |FINSI;
          |CIERRA #dscam037@;
     |FINSI;
|FPRC;

|DEFBUCLE LinCtrlRie;
     #dscam038@#2004;
     ;
     00000, nEmp, eaTipo, 001;
     99999, nEmp, eaTipo, 999;
     ;
     NULL, LinCtrlRie;
|FIN;

|PROCESO ExisteCliRie;
     nError = 0;
     |HAZ AbreRiesgo;
     |SI nCartera = 0;
          |DFICE aAlfa;
          aAlfa = aAlfa % -205;
          nEmp = aAlfa;
          |DBASS aPath;
          aAlfa = aPath + "dscarter/def/dscam037";
          |CARGA_DEF aAlfa, dscam037@;
          |SI FSalida ! 0;
               |MENAV "0000Error al cargar 'dscam037'";
          |SINO;
               aAlfa = aPath + "dscarter/def/dscam051"
               |CARGA_DEF aAlfa, dscam051@;
               |SI FSalida ! 0;
                    |MENAV "0000Error al cargar 'dscam051'";
               |SINO;
                    aAlfa = aPath + "dscarter/fich/";
                    |PATH_DAT #dscam037@#aAlfa#;
                    nEmpresa = 0;
                    |BUCLE LinCtrlRie;
                    |DESCARGA_DEF #dscam051@;
               |FINSI;
               |DESCARGA_DEF #dscam037@;
          |FINSI;
          |HAZ CierraRiesgo;
     |FINSI;

     |SI eaTipo = "A"; |O eaTipo = "F";
          |SI #142#22 = "P";
               |SI nError ! 0; |ERROR; |FINSI;
          |FINSI;
     |FINSI;
     |SI eaTipo = "P";
          |SI #142#167 = "P";
               |SI nError ! 0; |ERROR; |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO CheqPCM_PVP;
     |ABRE #142; |LEE 000#142p; |CIERRA #142;
     |SI #142#248 = "S";
          nPrecio = (enPrecio < enDto1) < enDto2;
          |ABRE #19;
          #19#0 = eaArticulo;
          |LEE 000#19=;
          |SI FSalida = 0; |Y #19#9 > nPrecio;
               aAlfa = "0000Precio venta (" + nPrecio + ")" + " inferior al precio coste ("+ #19#9 + ").";
               |MENAV aAlfa;
          |FINSI;
          |CIERRA #19;
     |FINSI;
     |HAZ EsForestales1;
     |SI FSalida = 0;
          nPrecio = (enPrecio < enDto1) < enDto2;
          |ABRE #19;
          #19#0 = eaArticulo;
          |LEE 000#19=;
          nNume = #19#149 < #19#152;
          |SI FSalida = 0; |Y nNume > nPrecio;
               aAlfa = "0000Precio venta (" + nPrecio + ")" + " inferior a la tarifa oficial ("+ #19#149 + " %dto " + #19#152 + ").";
               |MENAV aAlfa;
          |FINSI;
          |CIERRA #19;
     |FINSI;
|FPRC;

|PROCESO BloqCart;
   |QBF eaObserv;
   |SI eaObserv = "";
      |PUSHV 1210 1670;
      |BLANCO 1210 1670;
      |COLOR 7,2; |ATRI 0; |BLANCO 1311 1569; |ATRI 0;
      |COLOR 15,2; |ATRI 0;
      aAlfa = "    Riesgo bloqueado. Referencia : " + aBloquead;
      |PINTA 1412, aAlfa;
      |ATRI 0;
      |PAUSA;
      |POPV;
   |SINO;
      |PUSHV 1010 1670;
      |BLANCO 1010 1670;
      |COLOR 7,2; |ATRI 0; |BLANCO 1111 1569; |ATRI 0;
      |COLOR 15,2; |ATRI 0;
      aAlfa = "    Riesgo bloqueado. Referencia : " + aBloquead;
      |PINTA 1213, aAlfa;
      |COLOR 0,7; |ATRI 0;
      |PINTA 1312, " Observaciones                                           ";
      |COLOR 15,2; |ATRI 0;
      |PINTA 1413, eaObserv;
      |ATRI 0;
      |PAUSA;
      |POPV;
   |FINSI;
|FPRC;

|PROCESO TagloDefFP;
     |DDEF aAlfa;
     aAlfa = aAlfa + "tagm0059";
     |CARGA_DEF aAlfa, Referen@;
     |SI FSalida = 0;
          |ABRE #Referen@;
          #Referen@#0 = eaAlfa;
          |LEE 000#Referen@.=;
          |SI FSalida = 0;
               eaAlfa = #Referen@#1;
               eaQuitaDto = #Referen@#2;
          |SINO;
               eaQuitaDto = "N";
               eaAlfa = "";
          |FINSI;
          |CIERRA #Referen@;
          |DESCARGA_DEF #Referen@;
     |FINSI;
|FPRC;

|PROCESO CogeVersion;
   PRMNT_enVer   = 2;
|FPRC;

|PROCESO EsForestales1;    ||  004077
     |DBASE aPath;
     aPath = aPath + "def/goma0004.mas";
     |XABRE "E", aPath, 0;
|FPRC;
----------------------------------
|PROCESO DScam024;
     enRieDispo = #dscam024@#9
     |ERROR10;
|FPRC;

|DEFBUCLE DScam024;
     #dscam024@#1002;
     ;
     #dscam023@#0, 01;
     #dscam023@#0, 99;
     ;
     NULL, DScam024;
|FIN;

|PROCESO DScam038;
     |DBASS aAlfa;
     aAlfa = aAlfa + "dscarter/fich/" + (("00000" + #dscam038@#5) % -105) + "/";
     |PATH_DAT #dscam023@#aAlfa#;
     |PATH_DAT #dscam024@#aAlfa#;
     |DDEFECTO #dscam023@;
     |ABRE #dscam023@;
     #dscam023@#0 = #24#0;
     |LEE 000#dscam023@.=;
     enRieConce = #dscam023@#19;
     enRieUtil = #dscam023@#20;
     |CIERRA #dscam023@;
     |BUCLE DScam024;
     |ERROR10;
|FPRC;

|DEFBUCLE DScam038;
     #dscam038@#2004;
     ;
     00001, nEmp, " ", 001;
     99999, nEmp, "z", 999;
     ;
     NULL, DScam038;
|FIN;

|PROCESO RieTotales;
     enRieConce = 0;
     enRieDispo = 0;
     enRieUtil = 0;
     |HAZ AbreRiesgo;
     |SI nCartera ! 0;   |ACABA;   |FINSI;

     |DFICE aAlfa; aAlfa = aAlfa % -205; nEmp = aAlfa;
     |BUCLE DScam038;

     |HAZ CierraRiesgo;
|FPRC;

|PROCESO GestrDefFP;
     |DDEF aAlfa;
     aAlfa = aAlfa + "gestrm14";
     |CARGA_DEF aAlfa, Referen@;
     |SI FSalida = 0;
          |ABRE #Referen@;
          #Referen@#0 = eaAlfa;
          |LEE 000#Referen@.=;
          |SI FSalida = 0;
               eaAlfa = #Referen@#1;
               eaQuitaDto = #Referen@#2;
          |SINO;
               eaQuitaDto = "N";
               eaAlfa = "";
          |FINSI;
          |CIERRA #Referen@;
          |DESCARGA_DEF #Referen@;
     |FINSI;
|FPRC;
