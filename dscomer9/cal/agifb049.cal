      Modulo orts 001655

|FICHEROS;
     agifa048 #0;
     agifa049 #49;
     dsz00138 #1,MANTE; || Es solo para Orts, no esta modulado por el MANTE

     agifa019 #2,MANTE;   || articulos
     agifa017 #3;   || almacenes
     agifa142 #142;
     dsm00241 #241;
     dsm00238 #238;

     agifa048@ #480;
     ortsm020@;
|FIN;

|INCLUYE i_varart;

|VARIABLES;
     nModo = 0;
     nBtnF2 = 0;
     nBtnF3 = 0;
     nBtnF4 = 0;
     nAlma = 0;
     i = 0;
     nSal = 0;
     aAlfa = "";
     nCampo = 0;
     nNume1 = 0;
     nNume2 = 0;
     nUni = 0;
     nImpo = 0;
     nImpo2 = 0;
     nNume = 0;
     aTipo = "";
|FIN;

|PROCESO T15_12; |TIPO 12;
|FPRC;

|PROCESO ConverUniOrts;
     |HAZ LeeConverUniOrts;

     |SI #241#6 = "D";
          nNume1 = #1#12 * #241#5;
          nNume2 = #1#15 / #241#5;
          #1#4 = nNume1;
          #1#5 = nNume2;
     |SINO;
          nNume1 = #1#12 / #241#5;
          nNume2 = #1#15 * #241#5;
          #1#4 = nNume1;
          #1#5 = nNume2;
     |FINSI;
|FPRC;

|PROCESO LeeConverUniOrts;
     |ABRE #2;
     #2#0 = #1#2;
     |LEE 000#2=;
     |CIERRA #2;

     |ABRE #3;
     #3#0 = #1#2;
     #3#1 = #1#9;
     |LEE 000#3=;
     |CIERRA #3;

     |DDEFECTO #241;
     |SI #2#204 = "S";
          |ABRE #241; |SELECT #2#241;
          #241#0 = #2#5;
          #241#2 = #1#14;
          |LEE 000#241=;
          |CIERRA #241;
     |FINSI;
|FPRC;

|PROCESO totliesc15; |TIPO 0;
     |HAZ ConverUniOrts;

     nUni = #1#4;
     |ABRE #2;
     #2#0 = #1#2;
     |LEE 000#2=;
     |SI #2#179 = "S"; |Y FSalida = 0;  ||Doble stock
          |ABRE #238;
          #238#0 = #2#201;
          |LEE 000#238=;
          |SI FSalida = 0; |Y #238#6 = 2;    || Factura uni2
               nUni = #1#17;
          |FINSI;
          |CIERRA #238;
     |FINSI;
     |CIERRA #2;
     |SI #0#33 ! "K"; nUni = #1#4; |FINSI;

     |SI #0#36 = "S";
          |SI #1#16 = "D";
               nImpo = (nUni * #1#5) > #1#13;
          |SINO;
               nImpo = (nUni * #1#5) / ((100 - #1#13) / 100);
          |FINSI;
          nImpo = nImpo > #1#21;
     |SINO;
          |SI #1#16 = "D";
               nImpo = (nUni * #1#5) > #1#13;
          |SINO;
               nImpo = (nUni * #1#5) / ((100 - #1#13) / 100);
          |FINSI;
          nImpo = nImpo - (nUni * #1#5);
          nImpo2 = (nUni * #1#5) % #1#21;
          nImpo = (nUni * #1#5) + nImpo + nImpo2;
     |FINSI;
     #1#6 = nImpo;
     |PINTA #1#6;
|FPRC;

|PROCESO DefeUniPreOrts;
     |HAZ LeeConverUniOrts;
     |SI Campo = 9; |ACABA; |FINSI;
     |SI #241#6 = "D";
          nNume = #2#9 * #241#5;
          #1#15 = nNume;
     |SINO;
          nNume = #2#9 / #241#5;
          #1#15 = nNume;
     |FINSI;
     |PINTA #1#15;
|FPRC;

|PROCESO PintaUni49Orts; |TIPO 7;
     |SI #142#163 = "S";
          |HAZ LeeConverUni;
          |SI #2#204 = "S";
               |PINTA 2307, #1#14;
               |PINTA 2313, #241#4;
          |SINO;
               aAlfa = " " * 21;
               |PINTA 2307, aAlfa;
          |FINSI;
     |FINSI;
     |HAZ EsOrts;
     |SI FSalida = 0;
          |HAZ PinOrts;
     |FINSI;
|FPRC;

|PROCESO escartic15; |TIPO 0;
     nModo = (FEntrada / 100) ! 0;

     |SI #1Campo ! Contenido;
          |ABRE #2;
          #2#0 = #1#2;
          |LEE 000#2=;
          |CIERRA #2;
          #1#24 = #2#116; |PINTA #1#24;
          #1#25 = #2#115; |PINTA #1#25;
          #1#26 = #2#114; |PINTA #1#26;
          #1#27 = #2#116; |PINTA #1#27;
          #1#28 = #2#115; |PINTA #1#28;
     |FINSI;

     |SI #1#2 = #1#0;
          |MENAV "0000No se puede descomponer el Articulo en Escandallo ...";
          |ERROR; |ACABA;
     |FINSI;
     |SI #142#12 = "X";
          aTipo = "";
          |DDEF aAlfa;
          aAlfa = aAlfa + "agifa048";
          |CARGA_DEF aAlfa, agifa048@;
          |SI FSalida = 0;
               |ABRE #480;
               #480#0 = #1#2;
               |LEE 000#480=;
               |SI FSalida = 0;
                    aTipo = #480#33;
               |FINSI;
               |CIERRA #480;
               |DESCARGA_DEF #agifa048@;
          |FINSI;
          |SI aTipo = "K";
               |MENAV "0000Error, el componente es un KIT";
               |ERROR; |ACABA;
          |FINSI;
     |FINSI;

     |SI nModo = 1; |O #1Campo ! Contenido;
          |ABRE #2;
          #2#0 = #1#2;
          |LEE 020#2=;
          |CIERRA #2;

          |HAZ Es48X;
          |SI FSalida = 0;
               #1#3 = #2#1; |PINTA #1#3;
               #1#14 = #2#207;
          |FINSI;

          |HAZ DefeUniPreOrts;
          eaArticulo = #1#2;
          eaCliente = "";
          |||HAZ DefectoMediV;
          |SUB_EJECUTA_NP "dsz99919;D";
          #1#18 = enMedida1;
          #1#19 = enMedida2;
          #1#20 = enMedida3;
     |FINSI;
|FPRC;

|PROCESO Llena015; |TIPO 6;
     enAlta = 1;
     eaArticulo = #1Campo;
     |HAZ LlenaArticulo;
     |SI FSalida = 0;
          #1Campo = eaArticulo;
          |PINTA #1Campo;

          |HAZ CreaArti;
     |SINO;
          |ERROR; |ACABA;
     |FINSI;
|FPRC;

|PROCESO totcoste15; |TIPO 0;
     |HAZ totcoste;
|FPRC;

|PROCESO Observa15; |TIPO 0;
|FPRC;

|PROCESO CamposModi15; |TIPO 7;
|FPRC;

|PROCESO AlmaEsca715; |TIPO 7;
      nAlma = #1#9;
|FPRC;

|PROCESO AlmaEsca015; |TIPO 0;
     |SI #1#9 = 0;
          |AVISO; |ERROR; |ACABA;
     |FINSI;

     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 1; |O nAlma ! #1#9;
          |HAZ DefeUniPreOrts;
     |FINSI;
|FPRC;

|PROCESO AlmaCom615; |TIPO 6;
     |SI #1#9 ! 0;
          eaArticulo = #1#2;
          enAlmacen = #1#9;
          |HAZ CreaArtiAlma;
     |FINSI;
|FPRC;

|PROCESO TipoArti15; |TIPO 0;
     |SI #1#10 < 1; |O #1#10 > 4;
          |AVISO; |ERROR;
     |FINSI;
|FPRC;

|PROCESO EntraUni15; |TIPO 7;
     eaCliente = "";
     efFecha = "01.01.000";
 ||***
     eaArticulo = #1#2;
     enUnidad1 = #1#12;
     enUnidad2 = #1#17;
     enMedida1 = #1#18;
     enMedida2 = #1#19;
     enMedida3 = #1#20;

     ||HAZ DobleUniV;
     eaProgVta = "agifa048";
     enModoVta = (FEntrada / 100) ! 0;
     |SUB_EJECUTA_NP "dsz99919";

     |C_M #1#12, 1, "S";
     |SI eaSw2Stock = "S";
          |C_M #1#12, 1, "N";
          #1#12 = enUnidad1; |PINTA #1#12;
          #1#17 = enUnidad2;
          #1#18 = enMedida1;
          #1#19 = enMedida2;
          #1#20 = enMedida3;
     |FINSI;
|FPRC;

|PROCESO Tecla; |TIPO 6;
     |SI FSalida = 10;
          eaArticulo = #1#0; enLinea = #1#1;
          |SUB_EJECUTA_NP "ortsm027";
          |ERROR;
     |FINSI;
     |SI FSalida = 11;
          eaArticulo = #1#0; enLinea = #1#1;
          |SUB_EJECUTA_NP "ortsm028";
          |ERROR;
     |FINSI;
     |SI FSalida = 12;
          eaArticulo = #1#0; enLinea = #1#1;
          |SUB_EJECUTA_NP "ortsm037";
          |ERROR;
     |FINSI;
     |SI enModo = 4; |Y FSalida ! 1; |ERROR; |FINSI;
|FPRC;

|PROCESO BtnF2;
     |PTEC 824;
|FPRC;

|PROCESO BtnF3;
     |PTEC 825;
|FPRC;

|PROCESO BtnF4;
     |PTEC 826;
|FPRC;

|PROCESO EntraLinOrts;
     |ABRE #142; |LEE 000#142p; |CIERRA #142;

     |DDEF aAlfa;
     aAlfa = aAlfa + "ortsm020";
     |CARGA_DEF aAlfa, ortsm020@;
     |ABRE #ortsm020@;
     |DDEFECTO #ortsm020@;
     #ortsm020@#0 = #49#0;
     #ortsm020@#1 = #49#1;
     |SI enModo = 2; |O enModo = 4;
          |LEE 101#ortsm020@.=;
          |SI FSalida ! 0; |GRABA 020#ortsm020@.b; |FINSI;
     |FINSI;

     |DDEFECTO #1;
     |PARA i = 0; |SI i [ 21; |HACIENDO i = i + 1;
          #1i = #49i;
     |SIGUE;
     |PARA i = 2; |SI i [ 26; |HACIENDO i = i + 1;
          nCampo = i + 20;
          #1nCampo = #ortsm020@#i#;
     |SIGUE;

     |PUSHV 0501 2380;
     |PINPA #0#1;
     |PINDA #0#1;

     |CONTROL_SIMPLE 0, "BOTON,{{155}}F2.-Herrajes", 742, 753, BtnF2;
     nBtnF2 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{155}}F3.-Canteado", 755, 766, BtnF3;
     nBtnF3 = FSalida;

     |CONTROL_SIMPLE 0, "BOTON,{{155}}F4.-Elementos", 768, 779, BtnF4;
     nBtnF4 = FSalida;

     |SI enModo = 1; |ENDATOS #1#1; |FINSI;
     |SI enModo = 2; |ENDATOS #2#1; |FINSI;
     |SI enModo = 4; |ENDATOS #2#1; |FINSI;
     nSal = FSalida;
     |SI FSalida = 0; |Y enModo ! 4;
          |SI enModo = 1;
               #ortsm020@#0 = #49#0;
               #ortsm020@#1 = #49#1;
               |LEE 101#ortsm020@.=;
               |SI FSalida ! 0; |GRABA 020#ortsm020@.b; |FINSI;
          |FINSI;
          |PARA i = 0; |SI i [ 21; |HACIENDO i = i + 1;
               #49i = #1i;
          |SIGUE;
          |PARA i = 2; |SI i [ 26; |HACIENDO i = i + 1;
               nCampo = i + 20;
               #ortsm020@#i# = #1nCampo;
          |SIGUE;
          |GRABA 020#ortsm020@.a;
     |FINSI;
     |POPV;
     |FIN_CONTROL_WINDOWS nBtnF2;
     |FIN_CONTROL_WINDOWS nBtnF3;
     |FIN_CONTROL_WINDOWS nBtnF4;

     |CIERRA #ortsm020@;
     |DESCARGA_DEF #ortsm020@;

     FSalida = nSal;
|FPRC;
