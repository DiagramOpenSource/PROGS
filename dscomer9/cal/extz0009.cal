|FICHEROS;
     extz0009 #0;
     extw0001 #1;   ||Tmp Pdte Fac
     extm0002 #2;
     extm0003 #3;
     extw0004 #4;
     agifa010 #10;
     extm0011 #11;
     extm0013 #13;
     extm0014 #14;
     extm0018 #18;
     agifa019 #19;
     extm0022 #22,MANTE;
     extm0023 #23;
     agifa024 #24;
     extm0026 #26;
     dsm00003 #30;
     agifa059 #59;
     tmp00000 #100;
     extz0006 #106,MANTE;     || Pan. Lin
     extz0013 #113; ||Pan. Cambio N§ Serie
     extz0022 #122; ||Pan. Fec. Recoge
     extz0023 #123,MANTE; ||Pan. Varias
     extz0024 #124; ||Pan. Obser
     extz0025 #125; ||Pan. Fec. Real
     extz0026 #126,MANTE; ||Pan. Factu
     extz0028 #128,MANTE; ||Pan. Alba
     extz0029 #129,MANTE; ||Pan. Fecha fac
     agifa142 #142;
     agifa134 #134;
     extw0002 #200; ||Tmp Cli a Facturar
     extw0005 #205; ||Tmp Resu
     extw0006 #206; ||''
     extw0007 #207; ||''
     agifm001 #1000;
     referc1@;
     referc2@;
     referc4@;
     referl1@;
     referl2@;
     referl3@;
     referl4@;
     referen@ #500;
|FIN;

|VARIABLES;
     &eaPro = "";
     &enCod = 0;
     &eaVal = "";
     &enSwAgrupa = 0;
     &eaMenuImpre = "";
     &eaCli = "";
     &enDir = 0;
     &eaSerPedi = "";
     &enNumPedi = 0;
     &ser_alb = "";
     &num_alb = 0;
     &abono = "";
     &eaImpresora = "";
     &ser_fac = "";
     &num_fac = 0;
     &reimp = "";
     &eaOrdenado = "";
     &eaProg = "";
     &eaFichero = "";
     &eaCliInci = "";
     &eaSerParte = "";
     &enNumParte = 0;
     &eaSerPresu = "";
     &enNumPresu = 0;
     &enForma = 0;
     &enCtrFin = 0;
     &enNumero = 0;
     &eaNumSer = "";
     &enTipo = 0;
     &enError = 0;
     &Tempo = "";
     aTmp1 = "";
     aTmp2 = "";
     aTmp4 = "";
     aTmp100 = "";
     aTmp200 = "";
     aTmp205 = "";
     aTmp206 = "";
     aTmp207 = "";
     nBtnSalir = 0;
     nBtnTodos = 0;
     nBtnPdte = 0;
     nBtnRecogidos = 0;
     nBtnAbrir = 0;
     nBtnBorraL = "";
     nBtnCrea = 0;
     nBtnSele = 0;
     nBtnReabrir = 0;
     nBtnImpAlb = 0;
     nBtnImpFac = 0;
     nBtnImpCer = 0;
     nBtnImpEti = 0;
     nBtnMarca = 0;
     nBtnMarcaTodo = 0;
     nBtnPasar = 0;
     nBtnFactu = 0;
     nBtnCerrar = 0;
     nBtnBorrar = 0;
     nBtnModificar = 0;
     nBtnMateDeja = 0;
     nBtnMateExtra = 0;
     nBtnPresu = 0;
     nBtnPedido = 0;
     nBtnVerCom = 0;
     nBtnRecoCli = 0;
     nBtnObserva = 0;
     nBtnAnula = 0;
     nBtnBorNada = 0;
     nBtnCerApt = 0;
     nBtnCamSerie = 0;
     nBtnEtiqueta = 0;
     nBtnResumen = 0;
     nBtnIncidencia = 0;
     nBtnTrabajo = 0;
     nBtnCaracteris = 0;
     nGridC1 = 0;
     nGridC2 = 0;
     nGridC4 = 0;
     nGridC3 = 0;
     nGridL1 = 0;
     nGridL2 = 0;
     nGridL4 = 0;
     nGridL3 = 0;
     nGridCli = 0;
     nGridCom = 0;
     nPanta0 = 0;
     nPanta1 = 0;
     nPanta2 = 0;
     nPanta3 = 0;
     nPanta4 = 0;
     nPanOpc = 0;
     nPestana = 0;
     aDef = "";
     aAlfa = "";
     nRango = 0;
     {-1}aGet = 0;
         aGet1 = 0;
         aGet2 = 0;
     aDCli = "";
     aHCli = "";
     nDDir = 0;
     nHDir = 0;
     aDSis = "";
     aHSis = "";
     aDZona = "";
     aHZona = "";
     nPrime = 0;
     nNume = 0;
     i = 0;
     nSwBtnLin = 1;
     aSer = "";
     nNum = 0;
     aSerNue = "";
     nNumNue = 0;
     aEstado = "";
     aArti = "";
     nError = 0;
     nSwDes = 0;
     aSitu = "";
     fHoy = @;
     aAno1 = "";
     aAno2 = "";
     aMes1 = "";
     aMes2 = "";
     nPrecio = 0;
     nOpcion = 0;
     nHay = 0;
     nCampo = 0;
     nHayMarca = 0;
     nOpc = 0;
     aFecRec = "";
     aNumSer = "";
     {50}aCam = "";
     aSwTodos = "S";
     aDEdi = "";
     aHEdi = "";
     nDDire = 0;
     nHDire = 0;
     aFic = "";
     aSerie = "";
     nNumero = "";
     aMesAno1 = "";
     aMesAno2 = "";

     &uni_dt = 0;   || Unidades
     &uni_dt2 = 0;   || Unidades2
     &fed_dt = @;   || Fecha....
     &art_dt = "";  || Articulo.
     &cli_dt = "";  || Cliente..
     &fam_dt = "";  || Familia.
     &iva_dt = 0;   || Tipo Iva.
     &dtos_2 = 0;   || Descuento 2.
     &dto_pt = 0;   || Descuento Ptas.
     &dtos_1 = 0;   || Descuento 1.
     &pvp_ve = 0;   || Precio Venta.
     &tarifa = 0;   || Tarifa Cliente.
     &quedto = 0;   || 1=cli./art, 2=cli./familia, 3=cli./subfam.
     &gru_dt = "";  || Grupo Cliente.
     &nPromo = 0;
     &enMensaje = 0;
     &aParam = "";
     &eaSerie = "";
     &enDirEnt = 0;
     &enAlmacen = 0;

     aA¤o = "";
     aFecha = "";
     aHora = "";
     aFicTxt = "";
     nHandle = 0;
     aPro = "";
     nSwJava = 0;
     nSal = 0;
     nHayLin = 0;
|FIN;

|PROCESO CheqCara;
     eaPro = #26#2;
     enCod = #26#3;
     eaVal = #26#6;
     |HAZ ChequeaValor;
     |SI nError = 0;
          nError = enError;
     |FINSI;
|FPRC;

|DEFBUCLE CheqCara;
     #26#1;
     ;
     #14#0, #14#1, #14#2, 00000;
     #14#0, #14#1, #14#2, 99999;
     ;
     NULL, CheqCara;
|FIN;

|PROCESO CheqCara0;
     |BUCLE CheqCara;
|FPRC;

|DEFBUCLE CheqCara0
     #14#1;
     ;
     #13#0, #13#1, "                    ";
     #13#0, #13#1, "zzzzzzzzzzzzzzzzzzzz";
     ;
     NULL, CheqCara0
|FIN;

|PROCESO SacaPrecio;
     |ABRE #19;
     #19#0 = #14#16;
     |LEE 020#19=;
     |CIERRA #19;

     |ABRE #24;
     #24#0 = #13#4;
     |LEE 000#24=;
     |CIERRA #24;

     fed_dt = #13#3;   || Fecha....
     art_dt = #19#0;   || Articulo.
     cli_dt = #24#0;  || Cliente..
     fam_dt = #19#2;  || Familia.
     iva_dt = #19#30;  || Tipo Iva.
     dtos_2 = 0;      || Descuento 2.
     dto_pt = 0;      || Descuento Ptas.
     dtos_1 = 0;      || Descuento 1.
     pvp_ve = 0;      || Precio Venta.
     tarifa = #24#39;  || Tarifa Cliente....
     gru_dt = #24#158; || Grupo Cliente.
     nPromo = 0;
     uni_dt = #14#6;
     uni_dt2 = 0;
     enMensaje = 0;
     aParam = "";
     eaSerie = #13#0;
     enDirEnt = #13#6;
     enAlmacen = 1;
     |SI #19#176 = "S";  enMensaje = 1;  |FINSI;
     |HAZ calcdtos;
     nPrecio = pvp_ve - dto_pt;
     || = dtos_1;
     || = dtos_2;
|FPRC;

|PROCESO BtnIncidencia2;
     |LEE 000#4=;
     |SI FSalida = 0; |Y #referc2@#0 = #4#1; |Y #referc2@#1 = #4#2;
          aAlfa = #4#1 + (("000000"+#4#2)%-106) + #4#3;
          aAlfa = aAlfa + (("000000"+#4#27)%-106)
          eaProg = "extz0017;" + aAlfa;
          |HAZ EjecutaProg;
          |ABRE #14;
          #14#0 = #4#1;
          #14#1 = #4#2;
          #14#2 = #4#3;
          |LEE 020#14=;
          |SI FSalida = 0;
               #4#27 = #14#26;
               |GRABA 020#4a;
          |FINSI;
          |CIERRA #14;
          |REFRESCACONTROL nGridL1;
          |REFRESCACONTROL nGridCom;
     |FINSI;
|FPRC;

|PROCESO BtnIncidencia;
     |LEE 000#referl2@.=
     |SI FSalida = 0; |Y #referc2@#0 = #referl2@#0; |Y #referc2@#1 = #referl2@#1;
          aAlfa = #referl2@#0 + (("000000"+#referl2@#1)%-106) + #referl2@#2;
          aAlfa = aAlfa + (("000000"+#referl2@#26)%-106);
          eaProg = "extz0017;" + aAlfa;
          |HAZ EjecutaProg;
          |LEE 000#referl1@.=;
          |LEE 000#referl2@.=;
          |ABRE #14;
          #14#0 = #referl2@#0;
          #14#1 = #referl2@#1;
          #14#2 = #referl2@#2;
          |LEE 020#14=;
          |SI FSalida = 0;
               #referl2@#26 = #14#26;
               |GRABA 020#referl2@.a;
          |FINSI;
          |CIERRA #14;
          |REFRESCACONTROL nGridL1;
          |REFRESCACONTROL nGridL2;
     |FINSI;
|FPRC;

|PROCESO LinParte;
     |DDEFECTO #205;
     #205#0 = #14#5;
     |LEE 101#205=;
     |SI FSalida ! 0; |GRABA 020#205b; |FINSI;
     #19#0 = #205#0;
     |LEE 000#19=;
     |SI FSalida ! 0; |DDEFECTO #19; |FINSI;
     #205#1 = #19#1;
     #205#2 = #205#2 + #14#6;
     |GRABA 020#205a;
     |LIBERA #205;

     |DDEFECTO #206;
     #206#0 = #14#16;
     |LEE 101#206=;
     |SI FSalida ! 0; |GRABA 020#206b; |FINSI;
     #19#0 = #206#0;
     |LEE 000#19=;
     |SI FSalida ! 0; |DDEFECTO #19; |FINSI;
     #206#1 = #19#1;
     #206#2 = #206#2 + #14#6;
     |GRABA 020#206a;
     |LIBERA #206;

     |DDEFECTO #207;
     |SI #14#15 = " ";
          #207#0 = 1;
          |LEE 101#207=;
          |SI FSalida ! 0; |GRABA 020#207b; |FINSI;
          #207#1 = "Sin trabajo";
          #207#2 = #207#2 + #14#6;
          |GRABA 020#207a;
          |LIBERA #207;
     |FINSI;
     |SI #14#15 = "X";
          #207#0 = 2;
          |LEE 101#207=;
          |SI FSalida ! 0; |GRABA 020#207b; |FINSI;
          #207#1 = "No se hace nada";
          #207#2 = #207#2 + #14#6;
          |GRABA 020#207a;
          |LIBERA #207;
     |FINSI;
     |SI #14#15 = "N";
          #207#0 = 3;
          |LEE 101#207=;
          |SI FSalida ! 0; |GRABA 020#207b; |FINSI;
          #207#1 = "No apto";
          #207#2 = #207#2 + #14#6;
          |GRABA 020#207a;
          |LIBERA #207;
     |FINSI;
     |SI #14#15 = "I";
          #207#0 = 4;
          |LEE 101#207=;
          |SI FSalida ! 0; |GRABA 020#207b; |FINSI;
          #207#1 = "Revisi¢n in situ";
          #207#2 = #207#2 + #14#6;
          |GRABA 020#207a;
          |LIBERA #207;
     |FINSI;
     |SI #14#15 = "R";
          #207#0 = 5;
          |LEE 101#207=;
          |SI FSalida ! 0; |GRABA 020#207b; |FINSI;
          #207#1 = "Recarga";
          #207#2 = #207#2 + #14#6;
          |GRABA 020#207a;
          |LIBERA #207;
     |FINSI;
     |SI #14#15 = "T";
          #207#0 = 5;
          |LEE 101#207=;
          |SI FSalida ! 0; |GRABA 020#207b; |FINSI;
          #207#1 = "Retimbrado";
          #207#2 = #207#2 + #14#6;
          |GRABA 020#207a;
          |LIBERA #207;
     |FINSI;
|FPRC;

|DEFBUCLE LinParte;
     #14#1;
     ;
     aSer, nNum, "                    ";
     aSer, nNum, "zzzzzzzzzzzzzzzzzzzz";
     ;
     NULL, LinParte;
|FIN;

|PROCESO BtnResumen;
     |HAZ CreaTempo; |NOME_DAT #205Tempo; |DELINDEX #205; aTmp205 = Tempo;
     |HAZ CreaTempo; |NOME_DAT #206Tempo; |DELINDEX #206; aTmp206 = Tempo;
     |HAZ CreaTempo; |NOME_DAT #207Tempo; |DELINDEX #207; aTmp207 = Tempo;
     |ABRE #205;
     |ABRE #206;
     |ABRE #207;
     |ABRE #19;
     |BUCLE LinParte;
     |CIERRA #19;
     |LEE 000#205=;
     |LEE 000#206=;
     |LEE 000#207=;

     |VENTANA 901, 3398, -1, 17, "Resumen";
     |HAZ PushVenModal;

     nRango = 4 + 8 + 16 + 32;
     |CONTROL_SIMPLE 0, "LABEL,{{013}}Totales art¡culo", 1002, 1090, NULL;
     |LINEAL_SIMPLE #1#205, nRango, 1102, 1698, NULL, NULL, NULL;
     |CONTROL_SIMPLE 0, "LABEL,{{013}}Totales art¡culo a facturar", 1702, 1790, NULL;
     |LINEAL_SIMPLE #1#206, nRango, 1802, 2398, NULL, NULL, NULL;
     |CONTROL_SIMPLE 0, "LABEL,{{013}}Totales situaci¢n", 2402, 2490, NULL;
     |LINEAL_SIMPLE #1#207, nRango, 2502, 3198, NULL, NULL, NULL;
     |PAUSA;
     |CIERRA #207;
     |CIERRA #206;
     |CIERRA #205;

     |HAZ PopVenModal;

     Tempo = aTmp205; |HAZ BoraTempo; |DELINDEX #205;
     Tempo = aTmp206; |HAZ BoraTempo; |DELINDEX #206;
     Tempo = aTmp207; |HAZ BoraTempo; |DELINDEX #207;
|FPRC;

|PROCESO BtnEtiqueta;
     |LEE 000#referl2@.=;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |ABRE #14;
     #14#0 = #referl2@#0;
     #14#1 = #referl2@#1;
     #14#2 = #referl2@#2;
     |LEE 000#14=;
     |SI FSalida = 0;
          eaNumSer = #14#2;
          eaSerie = #14#0;
          enNumero = #14#1;
          |SUB_EJECUTA_NP "extz0012";
     |FINSI;
     |CIERRA #14;
|FPRC;

|PROCESO PideNuevoSerie;
     |VENTANA 1325, 2274, -1, 17, "Cambio n§ serie";
     |HAZ PushVenModal;

     |DDEFECTO #113;
     #113#0 = #14#2;
     |PINPA #0#113;
     |PINDA #0#113;
     |ENDATOS #1#113;
     aAlfa = FSalida;

     |HAZ PopVenModal;

     FSalida = aAlfa;
|FPRC;

|PROCESO CambiTmp4;
     |BORRA 020#4a;
     #4#3 = #113#1;
     |GRABA 020#4n;
|FPRC;

|DEFBUCLE CambiTmp4;
     #4#1;
     ;
     "     ", 000001, #113#0;
     "zzzzz", 999999, #113#0;
     ;
     NULL, CambiTmp4;
|FIN;

|PROCESO CambiTmp;
     |BORRA 020#referl2@.a;
     #referl2@#2 = #113#1;
     |GRABA 020#referl2@.n;
|FPRC;

|DEFBUCLE CambiTmp;
     #referl2@#1003;
     ;
     "     ", 000001, #113#0;
     "zzzzz", 999999, #113#0;
     ;
     NULL, CambiTmp;
|FIN;

|PROCESO CambiCarac;
     |BORRA 020#26a;
     #26#2 = #113#1;
     |GRABA 020#26n;
|FPRC;

|DEFBUCLE CambiCarac;
     #26#1;
     ;
     #14#0, #14#1, #14#2, 00000;
     #14#0, #14#1, #14#2, 99999;
     be;
     NULL, CambiCarac;
|FIN;

|PROCESO CambiRev;
     |BORRA 020#14a;
     #14#2 = #113#1;
     |GRABA 020#14n;
|FPRC;

|DEFBUCLE CambiRev;
     #14#1;
     2;
     "     ", 000001, "                    ", #113#0;
     "zzzzz", 999999, "zzzzzzzzzzzzzzzzzzzz", #113#0;
     be;
     NULL, CambiRev;
|FIN;

|PROCESO CheqNumSerie;
     #14#0 = #referl2@#0;
     #14#1 = #referl2@#1;
     #14#2 = #113#1;
     |LEE 000#14=;
     |SI FSalida = 0;
          |MENAV "0000N§ de serie existente...";
          FSalida = 1;
     |SINO;
          FSalida = 0;
     |FINSI;
|FPRC;

|PROCESO BtnCamSerie;
     |LEE 000#referl2@.=;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |ABRE #14;
     #14#0 = #referl2@#0;
     #14#1 = #referl2@#1;
     #14#2 = #referl2@#2;
     |LEE 101#14=;
     |SI FSalida = 0;
          |HAZ PideNuevoSerie;
          |SI FSalida = 0;
               |HAZ CheqNumSerie;
          |FINSI;
          |SI FSalida = 0;
               |BUCLE CambiRev;
               |BUCLE CambiTmp;
               |ABRE #11;
               #11#0 = #113#0;
               |LEE 121#11=;
               |SI FSalida = 0;
                    |BORRA 020#11a;
                    #11#0 = #113#1;
                    |GRABA 020#11n;
               |FINSI;
               |CIERRA #11;
               #referl2@#0 = #referc2@#0;
               #referl2@#1 = #referc2@#1;
               #referl2@#2 = #113#1;
               |LEE 020#referl2@.=;
               |REFRESCACONTROL nGridL2;
               |REFRESCACONTROL nGridC1;
               |REFRESCACONTROL nGridC4;
               |PULSATECLA;
          |FINSI;
     |FINSI;
     |CIERRA #14;
|FPRC;

|PROCESO ChekImp;
     |SI eaNumSer = ""; |O eaNumSer = #14#2;
          |SI #14#15 = " "; |O #14#15 = "X"; |O #14#15 = "N"; |O #14#24 = "S";
               |HAZ Situ;
               aAlfa = "0000N§ serie: '" + #14#2; |QBF aAlfa;
               |SI #14#24 = "S";
                    aAlfa = aAlfa + "' esta impreso";
               |SINO;
                    aAlfa = aAlfa + "' en situaci¢n: " + aSitu;
               |FINSI;
               |MENAV aAlfa;
          |SINO;
               nHay = 1;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE ChekImp;
     #14#1;
     ;
     aSer, nNum, "                    ";
     aSer, nNum, "zzzzzzzzzzzzzzzzzzzz";
     ;
     NULL, ChekImp;
|FIN;

|PROCESO BtnCerApt;
     |LEE 000#referl2@.=;
     |SI FSalida ! 0; |ACABA; |FINSI;

     aSer = #referl2@#0;
     nNum = #referl2@#1;

     |ABRE #14;
     #14#0 = #referl2@#0;
     #14#1 = #referl2@#1;
     #14#2 = #referl2@#2;
     |LEE 000#14=;
     |SI FSalida = 0;
          |CONFI "0000N¨Imprimir todas las lineas del parte?";
          |SI FSalida = 0;
               eaNumSer = "";
          |SINO;
               eaNumSer = #14#2;
          |FINSI;
          eaSerie = #14#0;
          enNumero = #14#1;

          nHay = 0;
          |BUCLE ChekImp;
          |SI nHay ! 0;
               |SUB_EJECUTA_NP "extz0011";
               |REFRESCACONTROL nGridL2;

               #14#0 = #referl2@#0;
               #14#1 = #referl2@#1;
               #14#2 = #referl2@#2;
               |LEE 000#14=;
               |SALVA_DATOS #14;
               |REPON_DATOS #referl2@;
               |GRABA 020#referl2@.a;
               |REFRESCACONTROL nGridL2;
          |FINSI;
     |FINSI;
     |CIERRA #14;
|FPRC;

|PROCESO BtnCrea;
     nOpcion = 1;
     |PTEC 807;
|FPRC;

|PROCESO BtnBorraL;
     nOpcion = 2;
     |PTEC 807;
|FPRC;

|PROCESO PideOpcion;
     |VENTANA 1335, 2165, -1, 17, "Borrar lineas 'no se hace nada'";
     |HAZ PushVenModal;

     |CONTROL_SIMPLE 0, "BOTON,Crear nuevo parte", 1540, 1560, BtnCrea;
     nBtnCrea = FSalida;
     |CONTROL_SIMPLE 0, "BOTON,Borrar lineas", 1740, 1760, BtnBorraL;
     nBtnBorraL = FSalida;
     nOpcion = 0;
     |PAUSA;

     |HAZ PopVenModal;
|FPRC;

|PROCESO UltParte;
     #13#0 = aSerNue;
     #13#1 = 999999;
     |LEE 000#13];
     |SI FSalida = 0;
          |LEE 000#13a;
     |SINO;
          |LEE 000#13u;
     |FINSI;
     |SI FSalida = 0; |Y #13#0 = aSerNue;
          nNumNue = #13#1 + 1;
     |SINO;
          nNumNue = 1;
     |FINSI;
|FPRC;

|PROCESO NuevaCarac;
     #26#0 = #13#0;
     #26#1 = #13#1;
     |GRABA 020#26n;
|FPRC;

|DEFBUCLE NuevaCarac;
     #26#1;
     ;
     aSer, nNum, aPro, 00000;
     aSer, nNum, aPro, 99999;
     ;
     NULL, NuevaCarac;
|FIN;

|PROCESO NuevaLin;
     |SI nOpcion = 1;
          |SALVA_DATOS #referl2@;
          |REPON_DATOS #14;
          #14#0 = #13#0;
          #14#1 = #13#1;
          #14#15 = "";
          |GRABA 020#14n;
          aPro = #14#2;
          |BUCLE NuevaCarac;

          #11#0 = #14#2;
          |LEE 121#11=;
          |SI FSalida = 0;
               #11#45 = aSerNue;
               #11#46 = nNumNue;
               |GRABA 020#11a;
               |LIBERA #11;
          |FINSI;
     |FINSI;
     |SI nOpcion = 2;         ||
          |SALVA_DATOS #referl2@;
          |REPON_DATOS #14;
          #14#0 = #13#0;
          #14#1 = #13#1;
          |GRABA 020#14n;
          aPro = #14#2;
          |BUCLE NuevaCarac;

          #11#0 = #14#2;
          |LEE 121#11=;
          |SI FSalida = 0;
               |SI #referl2@#10 ! "01.01.0000";
                    #11#27 = #referl2@#10;
               |FINSI;
               |SI #referl2@#13 ! "01.01.0000";
                    #11#37 = #referl2@#13;
               |FINSI;
               #11#45 = "";
               #11#46 = 0;
               |GRABA 020#11a;
               |LIBERA #11;
          |FINSI;
     |FINSI;

     |BORRA 020#referl2@.a;
     #14#0 = #referl2@#0;
     #14#1 = #referl2@#1;
     #14#2 = #referl2@#2;
     |BORRA 020#14c;
     |HAZ BorraCara0;
|FPRC;

|DEFBUCLE NuevaLin;
     #referl2@#1003;
     15;
     aSer, nNum, "                    ", "X";
     aSer, nNum, "zzzzzzzzzzzzzzzzzzzz", "X";
     ;
     NULL, NuevaLin;
|FIN;

|PROCESO HayNada;
     nHay = 1;
     |ERROR10;
|FPRC;

|DEFBUCLE HayNada;
     #14#1;
     15;
     aSer, nNum, "                    ", "X";
     aSer, nNum, "zzzzzzzzzzzzzzzzzzzz", "X";
     ;
     NULL, HayNada;
|FIN;

|PROCESO BtnBorNada;
     |LEE 000#referl2@.=;
     |SI FSalida ! 0; |ACABA; |FINSI;

     aSer = #referl2@#0;
     nNum = #referl2@#1;

     nOpcion = 0;
     nHay = 0;
     |BUCLE HayNada;
     |SI nHay = 0;
          |MENAV "0000No hay lineas de 'no se hace nada'";
     |SINO;
          |HAZ PideOpcion;
          |ABRE #11;
          |ABRE #13;
          |ABRE #14;
          |SI nOpcion = 1;    ||Nuevo
               aSerNue = #referl2@#0;
               |HAZ UltParte;
               #13#0 = #referl2@#0;
               #13#1 = #referl2@#1;
               |LEE 020#13=;
               #13#1 = nNumNue;
               #13#2 = ~;
               |GRABA 020#13n;
               |SI FSalida = 0;
                    |BUCLE NuevaLin;
                    aAlfa = "0000Creado parte: '" + #13#0 + "/" + (("000000"+#13#1)%-106) + "'";
                    |MENAV aAlfa;
               |FINSI;
          |FINSI;
          |SI nOpcion = 2;    ||Borra
               fHoy = ~; aAlfa = fHoy % -102;
               aSerNue = #18#11; |QBF aSerNue;
               aSerNue = ("     " + aSerNue + aAlfa) % -105;
               |HAZ UltParte;
               #13#0 = #referl2@#0;
               #13#1 = #referl2@#1;
               #13#2 = ~;
               |LEE 020#13=;
               #13#0 = aSerNue;
               #13#1 = nNumNue;
               #13#9 = "C";
               |GRABA 020#13n;
               |SI FSalida = 0;
                    |BUCLE NuevaLin;
                    aAlfa = "0000Creado parte: '" + #13#0 + "/" + (("000000"+#13#1)%-106) + "'";
                    |MENAV aAlfa;
               |FINSI;
          |FINSI;

          #14#0 = aSer;
          #14#1 = nNum;
          #14#2 = "";
          |LEE 000#14];
          |SI FSalida ! 0; |O #14#0 ! aSer; |O #14#1 ! nNum;
               #13#0 = aSer;
               #13#1 = nNum;
               |BORRA 020#13c;
          |FINSI;

          |CIERRA #14;
          |CIERRA #13;
          |CIERRA #11;
          |REFRESCACONTROL nGridC1;
          |REFRESCACONTROL nGridC2;
          |REFRESCACONTROL nGridC4;
     |FINSI;
|FPRC;

|PROCESO BtnAnula;
     |LEE 000#referl2@.=;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |ABRE #14;
     #14#0 = #referl2@#0;
     #14#1 = #referl2@#1;
     #14#2 = #referl2@#2;
     |LEE 101#14=;
     |SI FSalida = 0;
          |SI #14#15 = " ";
               |MENAV "0000Art¡culo sin situaci¢n...";
          |SINO;
               |HAZ Situ;
               aAlfa = "0000N¨Anular situaci¢n:" + aSitu + "?";
               |CONFI aAlfa;
               |SI FSalida = 0;
                    #14#9 = "01.01.0000";
                    #14#10 = "01.01.0000";
                    #14#12 = "01.01.0000";
                    #14#13 = "01.01.0000";
                    #14#15 = "";
                    #14#16 = "";
                    #14#17 = 0;
                    |GRABA 020#14a;
                    |SALVA_DATOS #14;
                    |REPON_DATOS #referl2@;
                    |GRABA 020#referl2@.a;
                    |REFRESCACONTROL nGridL2;
               |FINSI;
          |SINO;
          |FINSI;
     |FINSI;
     |CIERRA #14;
|FPRC;

|PROCESO BtnRetimbra;
     |LEE 000#referl2@.=;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |ABRE #14;
     #14#0 = #referl2@#0;
     #14#1 = #referl2@#1;
     #14#2 = #referl2@#2;
     |LEE 101#14=;
     |SI FSalida = 0;
          |HAZ Situ;
          aAlfa = "0000N§ serie: '" + #14#2; |QBF aAlfa;
          |SI #14#15 ! " ";
               aAlfa = aAlfa + "' en situaci¢n: " + aSitu;
               |MENAV aAlfa;
          |SINO;
               |SI #14#4 ! #18#6; |Y #14#4 ! #18#7; |Y #14#4 ! #18#8;
                         |Y #14#4 ! #18#9; |Y #14#4 ! #18#10;
                    aAlfa = "0000Sistema:" + #14#4 + ", no apto para retimbrado...";
                    |MENAV aAlfa;
               |SINO;
                    |SI #14#14 = "01.01.0000";
                         |MENAV "0000Art¡culo sin fecha de recogida...";
                    |SINO;
                         #14#15 = "T";
                         |ABRE #11;
                         #11#0 = #14#2;
                         |LEE 020#11=;
                         |SI FSalida ! 0; |DDEFECTO #11; |FINSI;
                         |CIERRA #11;
                         #14#16 = #11#32;
                         |HAZ SacaPrecio;
                         #14#17 = nPrecio;
                         |SI #11#25 = "A"; nNume = 1/1000000; |FINSI;
                         |SI #11#25 = "S"; nNume = 1/1000 * 6; |FINSI;
                         |SI #11#25 = "T"; nNume = 1/1000 * 3; |FINSI;
                         |SI #11#25 = "M"; nNume = 1/1000 * 1; |FINSI;
                         #14#10 = #14#14 + nNume;
                         nNume = #11#35/1000000;
                         #14#13 = #14#14 + nNume;
                         enTipo = 8; |HAZ ModiLin;

                         |SALVA_DATOS #14;
                         |REPON_DATOS #referl2@;
                         |GRABA 020#referl2@.a;
                         |REFRESCACONTROL nGridL2;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
     |CIERRA #14;
|FPRC;

|PROCESO BtnRecarga;
     |LEE 000#referl2@.=;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |ABRE #14;
     #14#0 = #referl2@#0;
     #14#1 = #referl2@#1;
     #14#2 = #referl2@#2;
     |LEE 101#14=;
     |SI FSalida = 0;
          |ABRE #13;
          #13#0 = #14#0;
          #13#1 = #14#1;
          |LEE 020#13=;
          |CIERRA #13;
          aMesAno1 = #13#2 % 407;
          aMesAno2 = #14#12 % 407;
          |SI aMesAno1 = aMesAno2;
               |MENAV "0000Se debe de realizar antes el retimbrado...";
          |SINO;
               |HAZ Situ;
               aAlfa = "0000N§ serie: '" + #14#2; |QBF aAlfa;
               |SI #14#15 ! " ";
                    aAlfa = aAlfa + "' en situaci¢n: " + aSitu;
                    |MENAV aAlfa;
               |SINO;
                    |SI #14#4 ! #18#1; |Y #14#4 ! #18#2; |Y #14#4 ! #18#3;
                              |Y #14#4 ! #18#4; |Y #14#4 ! #18#5;
                         aAlfa = "0000Sistema:" + #14#4 + ", no apto para la recarga...";
                         |MENAV aAlfa;
                    |SINO;
                         |SI #14#14 = "01.01.0000";
                              |MENAV "0000Art¡culo sin fecha de recogida...";
                         |SINO;
                              #14#15 = "R";
                              |ABRE #11;
                              #11#0 = #14#2;
                              |LEE 020#11=;
                              |SI FSalida ! 0; |DDEFECTO #11; |FINSI;
                              |CIERRA #11;
                              #14#16 = #11#30;
                              |HAZ SacaPrecio;
                              #14#17 = nPrecio;
                              |SI #11#25 = "A"; nNume = 1/1000000; |FINSI;
                              |SI #11#25 = "S"; nNume = 1/1000 * 6; |FINSI;
                              |SI #11#25 = "T"; nNume = 1/1000 * 3; |FINSI;
                              |SI #11#25 = "M"; nNume = 1/1000 * 1; |FINSI;
                              #14#10 = #14#14 + nNume;
                              enTipo = 7; |HAZ ModiLin;

                              |SALVA_DATOS #14;
                              |REPON_DATOS #referl2@;
                              |GRABA 020#referl2@.a;
                              |REFRESCACONTROL nGridL2;
                         |FINSI;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
     |CIERRA #14;
|FPRC;

|PROCESO BtnInSitu;
     |LEE 000#referl2@.=;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |ABRE #14;
     #14#0 = #referl2@#0;
     #14#1 = #referl2@#1;
     #14#2 = #referl2@#2;
     |LEE 101#14=;
     |SI FSalida = 0;
          |ABRE #13;
          #13#0 = #14#0;
          #13#1 = #14#1;
          |LEE 020#13=;
          |CIERRA #13;
          aMesAno1 = #13#2 % 407;
          aMesAno2 = #14#12 % 407;
          |SI aMesAno1 = aMesAno2;
               |MENAV "0000Se debe de realizar antes el retimbrado...";
          |SINO;
               |HAZ Situ;
               aAlfa = "0000N§ serie: '" + #14#2; |QBF aAlfa;
               |SI #14#15 ! " ";
                    aAlfa = aAlfa + "' en situaci¢n: " + aSitu;
                    |MENAV aAlfa;
               |SINO;
                    |SI #14#14 ! "01.01.0000";
                         aAlfa = "0000N§ serie: '" + #14#2; |QBF aAlfa;
                         aAlfa = aAlfa + "' con fecha recogida:" + #14#14;
                         |MENAV aAlfa;
                    |SINO;
                         fHoy = ~;
                         aMes1 = #14#13 % 402; aAno1 = #14#13 % 704;
                         aMes2 = fHoy % 402; aAno2 = fHoy % 704;
                         |SI aMes1 = aMes2; |Y aAno1 = aAno2;
                              |MENAV "0000No se puede hacer revisi¢n insitu si hay que hacer retimbrado";
                              enTipo = 5; |HAZ ModiLin;
                         |FINSI;
                         aMes1 = #14#13 % 402; aAno1 = #14#13 % 704;
                         aMes2 = fHoy % 402; aAno2 = fHoy % 704;
                         |SI aMes1 ! aMes2; |O aAno1 ! aAno2;
                              #14#15 = "I";
                              |ABRE #11;
                              #11#0 = #14#2;
                              |LEE 020#11=;
                              |SI FSalida ! 0; |DDEFECTO #11; |FINSI;
                              |CIERRA #11;
                              #14#16 = #11#29;
                              |HAZ SacaPrecio;
                              #14#17 = nPrecio;
                              enTipo = 6; |HAZ ModiLin;
                         |FINSI;
                         |SALVA_DATOS #14;
                         |REPON_DATOS #referl2@;
                         |GRABA 020#referl2@.a;
                         |REFRESCACONTROL nGridL2;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
     |CIERRA #14;
|FPRC;

|PROCESO BtnNoApto;
     |LEE 000#referl2@.=;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |ABRE #14;
     #14#0 = #referl2@#0;
     #14#1 = #referl2@#1;
     #14#2 = #referl2@#2;
     |LEE 101#14=;
     |SI FSalida = 0;
          |HAZ Situ;
          aAlfa = "0000N§ serie: '" + #14#2; |QBF aAlfa;
          |SI #14#15 ! " ";
               aAlfa = aAlfa + "' en situaci¢n: " + aSitu;
               |MENAV aAlfa;
          |SINO;
               #14#15 = "N";
               |ABRE #11;
               #11#0 = #14#2;
               |LEE 020#11=;
               |SI FSalida ! 0; |DDEFECTO #11; |FINSI;
               |CIERRA #11;
               #14#16 = #11#31;
               |HAZ SacaPrecio;
               #14#17 = nPrecio;
               #14#10 = "31.12.9999";
               #14#13 = "31.12.9999";
               enTipo = 4; |HAZ ModiLin;

               |SALVA_DATOS #14;
               |REPON_DATOS #referl2@;
               |GRABA 020#referl2@.a;
               |REFRESCACONTROL nGridL2;
          |FINSI;
     |FINSI;
     |CIERRA #14;
|FPRC;

|PROCESO BtnHaceNada;
     |LEE 000#referl2@.=;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |ABRE #14;
     #14#0 = #referl2@#0;
     #14#1 = #referl2@#1;
     #14#2 = #referl2@#2;
     |LEE 101#14=;
     |SI FSalida = 0;
          |HAZ Situ;
          aAlfa = "0000N§ serie: '" + #14#2; |QBF aAlfa;
          |SI #14#15 ! " ";
               aAlfa = aAlfa + "' en situaci¢n: " + aSitu;
               |MENAV aAlfa;
          |SINO;
               |SI #14#14 ! "01.01.0000";
                    aAlfa = aAlfa + "' con fecha recogida:" + #14#14;
                    |MENAV aAlfa;
               |SINO;
                    #14#15 = "X";
                    #14#10 = "01.01.0000";
                    enTipo = 3; |HAZ ModiLin;

                    |SALVA_DATOS #14;
                    |REPON_DATOS #referl2@;
                    |GRABA 020#referl2@.a;
                    |REFRESCACONTROL nGridL2;
               |FINSI;
          |FINSI;
     |FINSI;
     |CIERRA #14;
|FPRC;

|PROCESO BtnObserva;
     |LEE 000#referl2@.=;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |ABRE #14;
     #14#0 = #referl2@#0;
     #14#1 = #referl2@#1;
     #14#2 = #referl2@#2;
     |LEE 101#14=;
     |SI FSalida = 0;
          |SI #14#15 = " ";
               aAlfa = "0000N§ serie: '" + #14#2; |QBF aAlfa;
               aAlfa = aAlfa + "' sin realizar trabajo.";
               |MENAV aAlfa;
          |SINO;
               enTipo = 2; |HAZ ModiLin;

               |SALVA_DATOS #14;
               |REPON_DATOS #referl2@;
               |GRABA 020#referl2@.a;
               |REFRESCACONTROL nGridL2;
          |FINSI;
     |FINSI;
     |CIERRA #14;
|FPRC;

|PROCESO BtnRecoCli;
     |LEE 000#referl2@.=;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |ABRE #14;
     #14#0 = #referl2@#0;
     #14#1 = #referl2@#1;
     #14#2 = #referl2@#2;
     |LEE 101#14=;
     |SI FSalida = 0;
          |HAZ Situ;
          aAlfa = "0000N§ serie: '" + #14#2; |QBF aAlfa;
          aAlfa = aAlfa + "' en situaci¢n: " + aSitu;
          |SI #14#15 = " ";
               aAlfa = "";
          |FINSI;
          |SI aAlfa ! "";
               |MENAV aAlfa;
          |SINO;
               |SI #14#14 ! "01.01.0000";
                    aAlfa = "0000NN§ serie: '" + #14#2; |QBF aAlfa;
                    aAlfa = aAlfa + "' con fecha recogida:" + #14#14 + &13+&13+ "¨Anular?";
                    |CONFI aAlfa;
                    |SI FSalida = 0;
                         #14#14 = "01.01.0000";
                         |GRABA 020#14a;
                    |FINSI;
               |SINO;
                    enTipo = 1; |HAZ ModiLin;
               |FINSI;

               |SALVA_DATOS #14;
               |REPON_DATOS #referl2@;
               |GRABA 020#referl2@.a;
               |REFRESCACONTROL nGridL2;
          |FINSI;
     |FINSI;
     |CIERRA #14;
|FPRC;

|PROCESO BtnTrabajo;
     |VENTANA 1840, 3060, -1, 17, "Opciones de Trabajo";
     |HAZ PushVenModal;

     |CONTROL_SIMPLE 0, "BOTON,Revisi¢n in situ", 1942, 1958, BtnInSitu;
     |CONTROL_SIMPLE 0, "BOTON,Recarga", 2142, 2158, BtnRecarga;
     |CONTROL_SIMPLE 0, "BOTON,Retimbrado", 2342, 2358, BtnRetimbra;
     |CONTROL_SIMPLE 0, "BOTON,No se hace nada", 2542, 2558, BtnHaceNada
     |CONTROL_SIMPLE 0, "BOTON,No apto", 2742, 2758, BtnNoApto;

     |PAUSA;
     |HAZ PopVenModal;
|FPRC;

|PROCESO BtnCaracteris;
     |LEE 000#referl2@.=;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |PARA i = 0; |SI i [ 25; |HACIENDO i = i + 1;
          #106i = #referl2@#i#;
     |SIGUE;
     |HAZ BtnCarac;
|FPRC;

|PROCESO CheqMarca;
     |SI #1#0 = "*";
          nHay = 1;
          |ERROR10;
     |FINSI;
|FPRC;

|DEFBUCLE CheqMarca;
     #1#0;
     ;
     INICIO;
     FINAL;
     ;
     NULL, CheqMarca;
|FIN;

|PROCESO Cierra;
     |SI #1#0 = "*";
          |BORRA 020#1a;

          #13#0 = #1#1;
          #13#1 = #1#2;
          |LEE 121#13=;
          |SI FSalida = 0;
               #13#9 = "C";
               |GRABA 020#13a;
               |LIBERA #13;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE Cierra;
     #1#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Cierra;
|FIN;

|PROCESO CargCli;
     |SI #1#0 = "*";
          |SI #1#18 = "      "; #1#18 = "000000"; |FINSI;
          #2#0 = #1#18;
          #2#1 = #1#7;
          |LEE 000#2=;
          |SI FSalida ! 0; |DDEFECTO #2; |FINSI;

          #24#0 = #2#0;
          |LEE 000#24=;
          |SI FSalida ! 0; |DDEFECTO #24; |FINSI;

          |SI #2#3 = "P"; #200#0 = "PARTE"; |FINSI;
          |SI #2#3 = "E"; #200#0 = "EDIFICIO"; |FINSI;
          |SI #2#3 = "D"; #200#0 = "INSTALACION"; |FINSI;
          #200#1 = #1#18;
          #200#2 = #1#7;
          #200#3 = #24#2;
          |GRABA 000#200n;
     |FINSI;
|FPRC;

|DEFBUCLE CargCli;
     #1#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, CargCli;
|FIN;

|PROCESO EvtCli;
     |SI FSalida = 1; |O FSalida = 2;
          |LEE 000#200=;
     |FINSI;
     |SI FSalida = 4;
          aAlfa = #200#0; |QBF aAlfa;
          |SI aAlfa = "EDIFICIO";
               #200#0 = "INSTALACION";
          |SINO;
               |SI aAlfa = "INSTALACION";
                    #200#0 = "PARTE";
               |SINO;
                    #200#0 = "EDIFICIO";
               |FINSI;
          |FINSI;
          |GRABA 020#200a;
          |REFRESCACONTROL nGridCli;
     |FINSI;
|FPRC;

|PROCESO MuestraCli;
     |VENTANA 1301, 3398, -1, 17, "Clientes a facturar";
     |HAZ PushVenModal;

     |CONTROL_SIMPLE 0, "LABEL,{{013}}Doble click cambia tipo factura (edificio, instalaci¢n, parte)", 1402, 1490, NULL;

     nRango = 4 + 8 + 16 + 32;
     |LINEAL_SIMPLE #1#200, nRango, 1602, 3198, NULL, NULL, EvtCli;
     nGridCli = FSalida;
     enCtrFin = nGridCli;
     |HAZ EsperaFin;

     |HAZ PopVenModal;

     FSalida = aAlfa;
|FPRC;

|PROCESO VenFecFac;
     |VENTANA 1634, 2165, -1, 17, "Fecha factura";
     |HAZ PushVenModal;

     |DDEFECTO #129;
     #129#0 = ~;
     |PINPA #0#129;
     |PINDA #0#129;
     |ENDATOS #1#129;
     aAlfa = FSalida;

     |HAZ PopVenModal;

     FSalida = aAlfa;
|FPRC;

|PROCESO BtnFactu;
     nHay = 0;
     |BUCLE CheqMarca;
     |SI nHay = 0;
          |MENAV "0000No existen partes marcados...";
     |SINO;
          |HAZ CreaTempo;
          |NOME_DAT #200Tempo; aTmp200 = Tempo; |DELINDEX #200; |ABRE #200;
          |ABRE #2;
          |ABRE #24;
          |BUCLE CargCli;
          |CIERRA #24;
          |CIERRA #2;
          |LEE 000#200p;
          |HAZ MuestraCli;
          |HAZ VenFecFac;
          |SI FSalida = 0;
               |ABRE #13;
               enForma = 1;
               |HAZ Facturar;
               |BUCLE Cierra;
               |CIERRA #13;
               |LEE 000#1p;
               |HAZ Tiene3;
               |DDEFECTO #1;
               |REFRESCACONTROL nGridL3;
               |REFRESCACONTROL nGridC4;
               |REFRESCACONTROL nGridC3;
          |FINSI;
          |CIERRA #200; Tempo = aTmp200; |HAZ BoraTempo; |DELINDEX #200;
     |FINSI;
|FPRC;

|PROCESO Abre;
     |SI #1#0 = "*";
          |BORRA 020#1a;

          #13#0 = #1#1;
          #13#1 = #1#2;
          |LEE 121#13=;
          |SI FSalida = 0;
               |HAZ BajaAlbaran;
               #13#9 = "A";
               #13#14 = "";
               #13#15 = 0;
               |GRABA 020#13a;
               |LIBERA #13;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE Abre;
     #1#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Abre;
|FIN;

|PROCESO BtnPasar;
     nHay = 0;
     |BUCLE CheqMarca;
     |SI nHay = 0;
          |MENAV "0000No existen partes marcados...";
     |SINO;
          |CONFI "0000S¨Pasar a abiertos los partes marcados?";
          |SI FSalida = 0;
               |ABRE #13;
               |BUCLE Abre;
               |CIERRA #13;
               |LEE 000#1p;
               |HAZ Tiene3;
               |DDEFECTO #1;
               |REFRESCACONTROL nGridC2;
               |REFRESCACONTROL nGridL3;
               |REFRESCACONTROL nGridC3;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO BtnMarcaTodo
     |LEE 000#1=;
     |SI FSalida = 0;
          |SALVA_DATOS #1;
          |SI #1#0 = " ";
               aAlfa = "*";
          |SINO;
               aAlfa = " ";
          |FINSI;
          |LEE 000#1p;
          |PARA; |SI FSalida = 0; |HACIENDO;
               #1#0 = aAlfa;
               |GRABA 020#1a;
               |LEE 000#1s;
          |SIGUE;
          |REPON_DATOS #1;
          |LEE 000#1=;
          |REFRESCACONTROL nGridC3;
     |FINSI;
|FPRC;

|PROCESO BtnMarca
     |LEE 000#1=;
     |SI FSalida = 0;
          |SI #1#0 = " ";
               #1#0 = "*";
          |SINO;
               #1#0 = " ";
          |FINSI;
          |GRABA 020#1a;
          |REFRESCACONTROL nGridC3;
     |FINSI;
|FPRC;

|PROCESO CheqReabre;
     #11#0 = #14#2;
     |LEE 020#11=;
     |SI FSalida = 0; |Y #11#46 ! 0;
          |SI #11#45 ! #13#0; |O #11#46 ! #13#1;
               nError = 1;
               aAlfa = "0000N§ serie: '" + #14#2; |QBF aAlfa;
               aAlfa = aAlfa + "' con parte actual: " + #11#45 + "/" + (("000000" + #11#46)% -106);
               |MENAV aAlfa;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE CheqReabre;
     #14#1;
     ;
     #13#0, #13#1, "                    ";
     #13#0, #13#1, "zzzzzzzzzzzzzzzzzzzz";
     ;
     NULL, CheqReabre;
|FIN;

|PROCESO LineaFactura;
     |SELECT #4#13;
     #13#14 = #59#15;
     #13#15 = #59#2;
     |LEE 000#13=;
     |SI FSalida = 0;
          |SI #13#0 ! #referc4@#0; |O #13#1 ! #referc4@#1;
               aAlfa = "0000N¨Se reabre el parte: " + #referc2@#0 + "/" + (("000000" + #referc2@#1) % -106) + "?";
               |CONFI aAlfa;
               |SI FSalida ! 0;
                    nError = 1;
                    |ERROR10; |ACABA;
               |FINSI;
          |FINSI;
     |FINSI;
     #100#0 = #13#0;
     #100#1 = #13#1;
     |GRABA 000#100n;
|FPRC;

|DEFBUCLE LineaFactura;
     #59#1;
     ;
     #10#53, #10#39, 001;
     #10#53, #10#39, 999;
     ;
     NULL, LineaFactura;
|FIN;

|PROCESO BtnReabrir;
     |ABRE #13;
     #13#0 = #referc4@#0;
     #13#1 = #referc4@#1;
     |LEE 101#13=;
     |SI FSalida = 0;
          |CONFI "0000N¨Seguro de reabrir el parte?";
          |SI FSalida = 0;
               |HAZ CreaTempo;
               |NOME_DAT #100 Tempo; aTmp100 = Tempo; |DELINDEX #100; |ABRE #100;
               nError = 0;
               |ABRE #11;
               |BUCLE CheqReabre;
               |CIERRA #11;
               |SI nError = 0;
                    |ABRE #10;
                    #10#52 = #13#14;
                    #10#0 = #13#15;
                    |LEE 000#10=;
                    |SI FSalida = 0;
                         |SI #10#38 = "S";
                              |ABRE #134;
                              #134#49 = #10#53;
                              #134#0 = #10#39;
                              |LEE 000#134=;
                              |SI FSalida = 0; |Y #134#48 = "S";
                                   aAlfa = "0000Factura:" + #134#49 + (("000000" + #134#0) % -106)+ " contabilizada...";
                                   |MENAV aAlfa;
                                   nError = 1;
                              |SINO;
                                   |BUCLE LineaFactura;
                              |FINSI;
                              |CIERRA #134;
                         |SINO;
                              #100#0 = #13#0;
                              #100#1 = #13#1;
                              |GRABA 020#100n;
                         |FINSI;
                    |FINSI;
                    |CIERRA #10;
               |FINSI;
               |SI nError = 0;
                    |HAZ ReabreParte;
                    |HAZ Tiene4;
                    |REFRESCACONTROL nGridC2;
                    |REFRESCACONTROL nGridL4;
                    |REFRESCACONTROL nGridC4;
               |FINSI;
               |CIERRA #100; Tempo = aTmp100; |HAZ BoraTempo; |DELINDEX #100;
          |FINSI;
     |FINSI;
     |CIERRA #13;
|FPRC;

|PROCESO BtnImpAlb;
     |ABRE #13;
     #13#0 = #referc4@#0;
     #13#1 = #referc4@#1;
     |LEE 000#13=;
     |SI FSalida = 0;
          |ABRE #10;
          #10#52 = #13#14;
          #10#0 = #13#15;
          |LEE 000#10=;
          |SI FSalida = 0;
               ser_alb = #10#52;
               num_alb = #10#0;
               abono = #10#43;
               eaImpresora = "CrystalReport";
               eaMenuImpre = "N";
               |SUB_EJECUTA_NP "agifa014";
          |FINSI;
          |CIERRA #10;
     |FINSI;
     |CIERRA #13;
|FPRC;

|PROCESO BtnImpFac;
     |ABRE #13;
     #13#0 = #referc4@#0;
     #13#1 = #referc4@#1;
     |LEE 000#13=;
     |SI FSalida = 0;
          |ABRE #10;
          #10#52 = #13#14;
          #10#0 = #13#15;
          |LEE 000#10=;
          |SI FSalida = 0;
               |ABRE #134;
               #134#49 = #10#53;
               #134#0 = #10#39;
               |LEE 000#134=;
               |SI FSalida = 0;
                    ser_fac = #134#49;
                    num_fac = #134#0;
                    reimp = #134#45;
                    eaOrdenado = #142#141;
                    |SUB_EJECUTA_NP "agifa136";
               |FINSI;
               |CIERRA #134;
          |FINSI;
          |CIERRA #10;
     |FINSI;
     |CIERRA #13;
|FPRC;

|PROCESO BtnImpCer;
     |ABRE #13;
     #13#0 = #referc4@#0;
     #13#1 = #referc4@#1;
     |LEE 000#13=;
     |SI FSalida = 0;
          eaSerie = #13#0;
          enNumero = #13#1;
          eaNumSer = ""; ||Todos
          |SUB_EJECUTA_NP "extz0011";
     |FINSI;
     |CIERRA #13;
|FPRC;

|PROCESO BtnImpEti;
     |LEE 000#referl4@.=;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |ABRE #14;
     #14#0 = #referl4@#0;
     #14#1 = #referl4@#1;
     #14#2 = #referl4@#2;
     |LEE 000#14=;
     |SI FSalida = 0;
          eaNumSer = #14#2;
          eaSerie = #14#0;
          enNumero = #14#1;
          |SUB_EJECUTA_NP "extz0012";
     |FINSI;
     |CIERRA #14;
|FPRC;

|PROCESO FechaRecoge;
     |VENTANA 1634, 2165, -1, 17, "Fecha recogia";
     |HAZ PushVenModal;

     |DDEFECTO #122;
     #122#0 = "01.01.0000";
     |PINPA #0#122;
     |PINDA #0#122;
     |ENDATOS #1#122;
     aAlfa = FSalida;

     |HAZ PopVenModal;

     FSalida = aAlfa;
|FPRC;

|PROCESO Observa;
     |VENTANA 1625, 2474, -1, 17, "Observaciones";
     |HAZ PushVenModal;

     |DDEFECTO #124;
     #124#0 = aCam19;
     #124#1 = aCam20;
     #124#2 = aCam21;
     #124#3 = aCam22;
     #124#4 = aCam23;
     |PINPA #0#124;
     |PINDA #0#124;
     |ENDATOS #1#124;
     aAlfa = FSalida;

     |HAZ PopVenModal;

     FSalida = aAlfa;
|FPRC;

|PROCESO FechaReal;
     |VENTANA 1634, 2165, -1, 17, "Revisi¢n in situ";
     |HAZ PushVenModal;

     |DDEFECTO #125;
     #125#0 = "01.01.0000";
     |PINPA #0#125;
     |PINDA #0#125;
     |ENDATOS #1#125;
     aAlfa = FSalida;

     |HAZ PopVenModal;

     FSalida = aAlfa;
|FPRC;

|PROCESO FecReal2; |TIPO 0;
     |SI nOpc = 5;
          |ABRE #11;
          #11#0 = #123#2;
          |LEE 020#11=;
          |CIERRA #11;

          |SI #11#25 = "A"; nNume = 1/1000000; |FINSI;
          |SI #11#25 = "S"; nNume = 1/1000 * 6; |FINSI;
          |SI #11#25 = "T"; nNume = 1/1000 * 3; |FINSI;
          |SI #11#25 = "M"; nNume = 1/1000 * 1; |FINSI;
          #123#14 = #123#25; |PINTA #123#14;
          #123#10 = #123#14 + nNume; |PINTA #123#10;
     |FINSI;
|FPRC;

|PROCESO ArtFac2; |TIPO 0;
     |ABRE #19;
     #19#0 = #123#16;
     |LEE 000#19=;
     |SI FSalida = 0;
          #123#28 = #19#1; |PINTA #123#28;
     |SINO;
          |MENAV "0000No existe c¢digo art¡culo...";
          |ERROR;
     |FINSI;
     |CIERRA #19;
|FPRC;

|PROCESO BtnActual2;
     #123#10 = #123#8; |PINTA #123#10;
|FPRC;

|PROCESO BtnAuto2;
     |ABRE #11;
     #11#0 = #123#2;
     |LEE 020#11=;
     |CIERRA #11;

     |SI #11#25 = "A"; nNume = 1/1000000; |FINSI;
     |SI #11#25 = "S"; nNume = 1/1000 * 6; |FINSI;
     |SI #11#25 = "T"; nNume = 1/1000 * 3; |FINSI;
     |SI #11#25 = "M"; nNume = 1/1000 * 1; |FINSI;
     #123#10 = #123#8 + nNume; |PINTA #123#10;
|FPRC;

|PROCESO BtnCarac2;
     IaCam = aCam1<-;
     |PARA i = 0; |SI i [ 25; |HACIENDO i = i + 1;
          #106i = aCam;
          IaCam = IaCam + 1;
     |SIGUE;
     |HAZ BtnCarac;
|FPRC;

|PROCESO VenComun;
     |SI nOpc = 3; aAlfa = "No se hace nada"; |FINSI;
     |SI nOpc = 4; aAlfa = "No apto"; |FINSI;
     |SI nOpc = 5; aAlfa = "Revisi¢n in situ"; |FINSI;
     |SI nOpc = 6; aAlfa = "Recarga"; |FINSI;
     |SI nOpc = 7; aAlfa = "Retimbrado"; |FINSI;

     |VENTANA 1901, 3398, -1, 17, aAlfa;
     |HAZ PushVenModal;

     |DDEFECTO #123;
     IaCam = aCam1<-;
     |PARA i = 0; |SI i [ 25; |HACIENDO i = i + 1;
          #123i = aCam;
          |C_M #123i, 1, "N";
          IaCam = IaCam + 1;
     |SIGUE;

     |ABRE #13;
     #13#0 = #14#0;
     #13#1 = #14#1;
     |LEE 020#13=;
     |CIERRA #13;

     |ABRE #19;
     #19#0 = #123#16;
     |LEE 000#19=;
     |SI FSalida ! 0; |DDEFECTO #19; |FINSI;
     |CIERRA #19;

     |PINPA #0#123; nPanOpc = FSalida;
     |SI nOpc = 3;
          |C_M #123#13, 1, "S";
          |C_M #123#10, 1, "S";
          |C_M #123#19, 1, "S";
          |CONTROL_SIMPLE nPanOpc, "BOTON,Actual", 0992, 0999, BtnActual2;
          |CONTROL_SIMPLE nPanOpc, "BOTON,Auto", 1092, 1099, BtnAuto2;
     |FINSI;
     |SI nOpc = 4;
          |C_M #123#16, 1, "S";
          |C_M #123#6, 1, "S";
          |C_M #123#17, 1, "S";
          |C_M #123#10, 1, "S";
          |C_M #123#13, 1, "S";
          |C_M #123#19, 1, "S";
     |FINSI;
     |SI nOpc = 5;
          |C_M #123#16, 1, "S";
          |C_M #123#6, 1, "S";
          |C_M #123#17, 1, "S";
          |C_M #123#25, 1, "S";
          |C_M #123#10, 1, "S";
          |C_M #123#19, 1, "S";
     |FINSI;
     |SI nOpc = 6;
          |C_M #123#16, 1, "S";
          |C_M #123#6, 1, "S";
          |C_M #123#17, 1, "S";
          |C_M #123#10, 1, "S";
          |C_M #123#19, 1, "S";
     |FINSI;
     |SI nOpc = 7;
          |C_M #123#16, 1, "S";
          |C_M #123#6, 1, "S";
          |C_M #123#17, 1, "S";
          |C_M #123#10, 1, "S";
          |C_M #123#14, 1, "S";
          |C_M #123#19, 1, "S";
     |FINSI;
     |SI nOpc = 4; |O nOpc = 5; |O nOpc = 6; |O nOpc = 7;
          |SI nHayMarca < 2;
               |CONTROL_SIMPLE nPanOpc, "BOTON,{{137}}Caracteristicas", 0580, 0598, BtnCarac2;
          |FINSI;
     |FINSI;

     |PINDA #0#123;
     |ENDATOS #1#123;
     aAlfa = FSalida;

     |HAZ PopVenModal;

     FSalida = aAlfa;
|FPRC;

|PROCESO Opc1;
     |HAZ Situ;
     aAlfa = "0000N§ serie: '" + #14#2; |QBF aAlfa;
     aAlfa = aAlfa + "' en situaci¢n: " + aSitu;
     |SI #14#15 = " ";
          aAlfa = "";
     |FINSI;
     |SI aAlfa ! "";
          |MENAV aAlfa;
     |SINO;
          |SI #14#14 ! "01.01.0000";
               |SI nHayMarca ] 2;
                    FSalida = 0;
               |SINO;
                    aAlfa = "0000NN§ serie: '" + #14#2; |QBF aAlfa;
                    aAlfa = aAlfa + "' con fecha recogida:" + #14#14 + &13+&13+ "¨Anular?";
                    |CONFI aAlfa;
               |FINSI;
               |SI FSalida = 0;
                    #14#14 = "01.01.0000";
                    |GRABA 020#14a;
               |FINSI;
          |SINO;
               #14#14 = #122#0;
               |GRABA 020#14a;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Opc2;
     |SI #14#15 = " ";
          aAlfa = "0000N§ serie: '" + #14#2; |QBF aAlfa;
          aAlfa = aAlfa + "' sin realizar trabajo.";
          |MENAV aAlfa;
     |SINO;
          #14#19 = #124#0;
          #14#20 = #124#1;
          #14#21 = #124#2;
          #14#22 = #124#3;
          #14#23 = #124#4;
          |GRABA 020#14a;
     |FINSI;
|FPRC;

|PROCESO Opc3;
     |HAZ Situ;
     aAlfa = "0000N§ serie: '" + #14#2; |QBF aAlfa;
     |SI #14#15 ! " ";
          aAlfa = aAlfa + "' en situaci¢n: " + aSitu;
          |MENAV aAlfa;
     |SINO;
          |SI #14#14 ! "01.01.0000";
               aAlfa = aAlfa + "' con fecha recogida:" + #14#14;
               |MENAV aAlfa;
          |SINO;
               #14#15 = "X";
               #14#10 = "01.01.0000";
               #14#10 = #123#10;
               #14#19 = #123#19;
               #14#20 = #123#20;
               #14#21 = #123#21;
               #14#22 = #123#22;
               #14#23 = #123#23;
               |GRABA 020#14a;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Opc4;
     |HAZ Situ;
     aAlfa = "0000N§ serie: '" + #14#2; |QBF aAlfa;
     |SI #14#15 ! " ";
          aAlfa = aAlfa + "' en situaci¢n: " + aSitu;
          |MENAV aAlfa;
     |SINO;
          #14#15 = "N";
          #14#16 = #123#16;
          #14#6 = #123#6;
          #14#17 = #123#17;
          #14#10 = #123#10;
          #14#13 = #123#13;
          #14#19 = #123#19;
          #14#20 = #123#20;
          #14#21 = #123#21;
          #14#22 = #123#22;
          #14#23 = #123#23;
          |GRABA 020#14a;
     |FINSI;
|FPRC;

|PROCESO Opc5;
     |HAZ Situ;
     aAlfa = "0000N§ serie: '" + #14#2; |QBF aAlfa;
     aMesAno1 = #13#2 % 407;
     aMesAno2 = #14#12 % 407;
     |SI aMesAno1 = aMesAno2;
          aAlfa = aAlfa + " se debe de realizar antes el retimbrado...";
          |MENAV  aAlfa;
     |SINO;
          |SI #14#15 ! " ";
               aAlfa = aAlfa + "' en situaci¢n: " + aSitu;
               |MENAV aAlfa;
          |SINO;
               |SI #14#14 ! "01.01.0000";
                    aAlfa = "0000N§ serie: '" + #14#2; |QBF aAlfa;
                    aAlfa = aAlfa + "' con fecha recogida:" + #14#14;
                    |MENAV aAlfa;
               |SINO;
                    fHoy = ~;
                    aMes1 = #14#13 % 402; aAno1 = #14#13 % 704;
                    aMes2 = fHoy % 402; aAno2 = fHoy % 704;
                    |SI aMes1 = aMes2; |Y aAno1 = aAno2;
                         aAlfa = "0000N§ serie: '" + #14#2; |QBF aAlfa;
                         aAlfa = aAlfa + "' No se puede hacer revisi¢n insitu si hay que hacer retimbrado";
                         |MENAV aAlfa;
                    |SINO;
                         aMes1 = #14#13 % 402; aAno1 = #14#13 % 704;
                         aMes2 = fHoy % 402; aAno2 = fHoy % 704;
                         |SI aMes1 ! aMes2; |O aAno1 ! aAno2;
                              |SI aSwTodos = "N";
                                   #14#15 = "I";
                                   |ABRE #11;
                                   #11#0 = #14#2;
                                   |LEE 020#11=;
                                   |SI FSalida ! 0; |DDEFECTO #11; |FINSI;
                                   |CIERRA #11;
                                   #14#16 = #123#16;   ||Articulo
                                   #14#6 = #123#6;     ||Unida
                                   #14#17 = #123#17;   ||Impo
                                   #14#25 = #123#15;   ||F.Real
                                   #14#14 = #123#25;   ||F.Recoge Cli
                                   |SI #11#25 = "A"; nNume = 1/1000000; |FINSI;
                                   |SI #11#25 = "S"; nNume = 1/1000 * 6; |FINSI;
                                   |SI #11#25 = "T"; nNume = 1/1000 * 3; |FINSI;
                                   |SI #11#25 = "M"; nNume = 1/1000 * 1; |FINSI;
                                   #14#10 = #14#25 + nNume; ||F.Prox.Rev
                              |SINO;
                                   #14#15 = "I";
                                   |ABRE #11;
                                   #11#0 = #14#2;
                                   |LEE 020#11=;
                                   |SI FSalida ! 0; |DDEFECTO #11; |FINSI;
                                   |CIERRA #11;
                                   #14#16 = #11#29;
                                   |HAZ SacaPrecio;
                                   #14#17 = nPrecio;
                                   #14#25 = #125#0;   ||F.Real
                                   #14#14 = #14#25;   ||F.Recoge Cli
                                   |SI #11#25 = "A"; nNume = 1/1000000; |FINSI;
                                   |SI #11#25 = "S"; nNume = 1/1000 * 6; |FINSI;
                                   |SI #11#25 = "T"; nNume = 1/1000 * 3; |FINSI;
                                   |SI #11#25 = "M"; nNume = 1/1000 * 1; |FINSI;
                                   #14#10 = #14#25 + nNume;
                              |FINSI;
                              |GRABA 020#14a;
                         |FINSI;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Opc6;
     |HAZ Situ;
     aAlfa = "0000N§ serie: '" + #14#2; |QBF aAlfa;
     aMesAno1 = #13#2 % 407;
     aMesAno2 = #14#12 % 407;
     |SI aMesAno1 = aMesAno2;
          aAlfa = aAlfa + " se debe de realizar antes el retimbrado...";
          |MENAV  aAlfa;
     |SINO;
          |SI #14#15 ! " ";
               aAlfa = aAlfa + "' en situaci¢n: " + aSitu;
               |MENAV aAlfa;
          |SINO;
               |SI #14#4 ! #18#1; |Y #14#4 ! #18#2; |Y #14#4 ! #18#3;
                         |Y #14#4 ! #18#4; |Y #14#4 ! #18#5;
                    aAlfa = "0000Sistema:" + #14#4 + ", no apto para la recarga...";
                    |MENAV aAlfa;
               |SINO;
                    |SI #14#14 = "01.01.0000";
                         |MENAV "0000Art¡culo sin fecha de recogida...";
                    |SINO;
                         |SI aSwTodos = "N";
                              #14#15 = "R";
                              #14#16 = #123#16;
                              #14#6 = #123#6;
                              #14#17 = #123#17;
                              #14#10 = #123#10;
                              #14#19 = #123#19;
                              #14#20 = #123#20;
                              #14#21 = #123#21;
                              #14#22 = #123#22;
                              #14#23 = #123#23;
                         |SINO;
                              #14#15 = "R";
                              |ABRE #11;
                              #11#0 = #14#2;
                              |LEE 020#11=;
                              |SI FSalida ! 0; |DDEFECTO #11; |FINSI;
                              |CIERRA #11;
                              #14#16 = #11#30;
                              |HAZ SacaPrecio;
                              #14#17 = nPrecio;
                              |SI #11#25 = "A"; nNume = 1/1000000; |FINSI;
                              |SI #11#25 = "S"; nNume = 1/1000 * 6; |FINSI;
                              |SI #11#25 = "T"; nNume = 1/1000 * 3; |FINSI;
                              |SI #11#25 = "M"; nNume = 1/1000 * 1; |FINSI;
                              #14#10 = #14#14 + nNume;
                         |FINSI;
                         |GRABA 020#14a;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Opc7;
     |HAZ Situ;
     aAlfa = "0000N§ serie: '" + #14#2; |QBF aAlfa;
     |SI #14#15 ! " ";
          aAlfa = aAlfa + "' en situaci¢n: " + aSitu;
          |MENAV aAlfa;
     |SINO;
          |SI #14#4 ! #18#6; |Y #14#4 ! #18#7; |Y #14#4 ! #18#8;
                    |Y #14#4 ! #18#9; |Y #14#4 ! #18#10;
               aAlfa = "0000Sistema:" + #14#4 + ", no apto para retimbrado...";
               |MENAV aAlfa;
          |SINO;
               |SI #14#14 = "01.01.0000";
                    aAlfa = "0000N§ serie: '" + #14#2; |QBF aAlfa;
                    aAlfa = aAlfa + "' sin fecha de recogida...";
                    |MENAV aAlfa;
               |SINO;
                    |SI aSwTodos = "N";
                         #14#15 = "T";
                         #14#16 = #123#16;
                         #14#6 = #123#6;
                         #14#17 = #123#17;
                         #14#10 = #123#10;
                         #14#13 = #123#13;
                         #14#14 = #123#14;
                    |SINO;
                         #14#15 = "T";
                         |ABRE #11;
                         #11#0 = #14#2;
                         |LEE 020#11=;
                         |SI FSalida ! 0; |DDEFECTO #11; |FINSI;
                         |CIERRA #11;
                         #14#16 = #11#32;
                         |HAZ SacaPrecio;
                         #14#17 = nPrecio;
                         |SI #11#25 = "A"; nNume = 1/1000000; |FINSI;
                         |SI #11#25 = "S"; nNume = 1/1000 * 6; |FINSI;
                         |SI #11#25 = "T"; nNume = 1/1000 * 3; |FINSI;
                         |SI #11#25 = "M"; nNume = 1/1000 * 1; |FINSI;
                         #14#10 = #14#14 + nNume;
                         nNume = #11#35/1000000;
                         #14#13 = #14#14 + nNume;
                    |FINSI;
                    |GRABA 020#14a;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Opc8;
     |SI #14#15 = " ";
          aAlfa = "0000N§ serie: '" + #14#2; |QBF aAlfa;
          aAlfa = aAlfa + "' Art¡culo sin situaci¢n...";
          |MENAV aAlfa;
     |SINO;
          #14#9 = "01.01.0000";
          #14#10 = "01.01.0000";
          #14#12 = "01.01.0000";
          #14#13 = "01.01.0000";
          #14#15 = "";
          #14#16 = "";
          #14#17 = 0;
          |GRABA 020#14a;
     |FINSI;
|FPRC;

|PROCESO Opc11;
     |HAZ PideNuevoSerie;
     |SI FSalida = 0;
          |BUCLE CambiRev;
          |ABRE #11;
          #11#0 = #113#0;
          |LEE 121#11=;
          |SI FSalida = 0;
               |BORRA 020#11a;
               #11#0 = #113#1;
               |GRABA 020#11n;
          |FINSI;
          |CIERRA #11;
     |FINSI;
|FPRC;

|PROCESO Actua4;
     |SI nOpc = 11;

     |SINO;
          #4#1 = #14#0;
          #4#2 = #14#1;
          #4#3 = #14#2;
          |LEE 020#4=;
          |PARA i = 3; |SI i [ 26; |HACIENDO i = i + 1;
               nCampo = i + 1;
               #4nCampo = #14i;
          |SIGUE;
          |GRABA 020#4a;
     |FINSI;
|FPRC;

|PROCESO Marcados;
     |SI #4#0 = "*";
          #14#0 = #4#1;
          #14#1 = #4#2;
          #14#2 = #4#3;
          |LEE 121#14=;
          |SI FSalida ! 0; |ACABA; |FINSI;
          #13#0 = #14#0;
          #13#1 = #14#1;
          |LEE 020#13=;

          |SI nOpc = 1; |HAZ Opc1; |FINSI;
          |SI nOpc = 2; |HAZ Opc2; |FINSI;
          |SI nOpc = 3; |HAZ Opc3; |FINSI;
          |SI nOpc = 4; |HAZ Opc4; |FINSI;
          |SI nOpc = 5; |HAZ Opc5; |FINSI;
          |SI nOpc = 6; |HAZ Opc6; |FINSI;
          |SI nOpc = 7; |HAZ Opc7; |FINSI;
          |SI nOpc = 8; |HAZ Opc8; |FINSI;
          |SI nOpc = 11; |HAZ Opc11; |FINSI;

          |HAZ Actua4;
          |LIBERA #14;
     |FINSI;
|FPRC;

|DEFBUCLE Marcados;
     #4#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Marcados;
|FIN;

|PROCESO IniMarcados;
     nHayMarca = 0;
     aFecRec = "N";
     IaCam = aCam1<-;
     |PARA i = 0; |SI i [ 25; |HACIENDO i = i + 1;
          aCam = "";
          IaCam = IaCam + 1;
     |SIGUE;
|FPRC;

|PROCESO HayMarcados;
     |SI #4#0 = "*";
          nHayMarca = nHayMarca + 1;
          |SI #4#15 = "01.01.0000"; aFecRec = "S"; |FINSI;
          aNumSer = #4#3;
          |SI nHayMarca = 1;
               IaCam = aCam1<-;
               |PARA i = 1; |SI i [ 26; |HACIENDO i = i + 1;
                    aCam = #4i;
                    IaCam = IaCam + 1;
               |SIGUE;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE HayMarcados;
     #4#1;
     ;
     INICIO;
     FINAL;
     ;
     IniMarcados, HayMarcados;
|FIN;

|PROCESO BtnRecoCli2;
     |SALVA_DATOS #4;
     aNumSer = #4#3;
     |BUCLE HayMarcados;
     |SI nHayMarca ] 2;
          |SI aFecRec = "S";
               |HAZ FechaRecoge;
          |SINO;
               FSalida = 0;
          |FINSI;
          |SI FSalida = 0;
               nOpc = 1;
               |BUCLE Marcados;
          |FINSI;
     |SINO;
          #14#0 = aSer;
          #14#1 = nNum;
          #14#2 = aNumSer;
          |LEE 121#14=;
          |SI FSalida = 0;
               |SI #14#14 = "01.01.0000";
                    |HAZ FechaRecoge;
               |FINSI;
               |SI FSalida = 0;
                    |HAZ Opc1;
                    |HAZ Actua4;
               |FINSI;
               |LIBERA #14;
          |FINSI;
     |FINSI;
     |REPON_DATOS #4;
     |LEE 000#4=;
     |REFRESCACONTROL nGridCom;
|FPRC;

|PROCESO BtnObserva2;
     |SALVA_DATOS #4;
     aNumSer = #4#3;
     |BUCLE HayMarcados;
     |SI nHayMarca ] 2;
          |HAZ Observa;
          |SI FSalida = 0;
               nOpc = 2;
               |BUCLE Marcados;
          |FINSI;
     |SINO;
          #14#0 = aSer;
          #14#1 = nNum;
          #14#2 = aNumSer;
          |LEE 121#14=;
          |SI FSalida = 0;
               |SI #14#15 = " ";
                    aAlfa = "0000N§ serie: '" + #14#2; |QBF aAlfa;
                    aAlfa = aAlfa + "' sin realizar trabajo.";
                    |MENAV aAlfa;
               |SINO;
                    IaCam = aCam1<-;
                    |PARA i = 0; |SI i [ 25; |HACIENDO i = i + 1;
                         aCam = #14i;
                         IaCam = IaCam + 1;
                    |SIGUE;
                    |HAZ Observa;
                    |HAZ Opc2;
                    |HAZ Actua4;
               |FINSI;
               |LIBERA #14;
          |FINSI;
     |FINSI;
     |REPON_DATOS #4;
     |LEE 000#4=;
     |REFRESCACONTROL nGridCom;
|FPRC;

|PROCESO BtnHaceNada2;
     |SALVA_DATOS #4;
     aNumSer = #4#3;
     |BUCLE HayMarcados;
     |SI nHayMarca ] 2;
          nOpc = 3;
          |HAZ VenComun;
          |SI FSalida = 0; |BUCLE Marcados; |FINSI;
     |SINO;
          #14#0 = aSer;
          #14#1 = nNum;
          #14#2 = aNumSer;
          |LEE 121#14=;
          |SI FSalida = 0;
               |HAZ Situ;
               aAlfa = "0000N§ serie: '" + #14#2; |QBF aAlfa;
               |SI #14#15 ! " ";
                    aAlfa = aAlfa + "' en situaci¢n: " + aSitu;
                    |MENAV aAlfa;
               |SINO;
                    |SI #14#14 ! "01.01.0000";
                         aAlfa = aAlfa + "' con fecha recogida:" + #14#14;
                         |MENAV aAlfa;
                    |SINO;
                         IaCam = aCam1<-;
                         |PARA i = 0; |SI i [ 25; |HACIENDO i = i + 1;
                              aCam = #14i;
                              IaCam = IaCam + 1;
                         |SIGUE;
                         nOpc = 3;
                         |HAZ VenComun;
                         |SI FSalida = 0;
                              |HAZ Opc3;
                              |HAZ Actua4;
                         |FINSI;
                    |FINSI;
               |FINSI;
               |LIBERA #14;
          |FINSI;
     |FINSI;
     |REPON_DATOS #4;
     |LEE 000#4=;
     |REFRESCACONTROL nGridCom;
|FPRC;

|PROCESO BtnNoApto2;
     |SALVA_DATOS #4;
     aNumSer = #4#3;
     |BUCLE HayMarcados;
     |SI nHayMarca ] 2;
          #14#0 = aSer;
          #14#1 = nNum;
          #14#2 = aNumSer;
          |LEE 020#14=;
          |ABRE #11;
          #11#0 = #14#2;
          |LEE 020#11=;
          |SI FSalida ! 0; |DDEFECTO #11; |FINSI;
          |CIERRA #11;
          #14#16 = #11#31;
          |HAZ SacaPrecio;
          #14#17 = nPrecio;
          #14#10 = "31.12.9999";
          #14#13 = "31.12.9999";

          nOpc = 4;
          |HAZ VenComun;
          |SI FSalida = 0; |BUCLE Marcados; |FINSI;
     |SINO;
          #14#0 = aSer;
          #14#1 = nNum;
          #14#2 = aNumSer;
          |LEE 121#14=;
          |SI FSalida = 0;
               |HAZ Situ;
               aAlfa = "0000N§ serie: '" + #14#2; |QBF aAlfa;
               |SI #14#15 ! " ";
                    aAlfa = aAlfa + "' en situaci¢n: " + aSitu;
                    |MENAV aAlfa;
               |SINO;
                    |ABRE #11;
                    #11#0 = #14#2;
                    |LEE 020#11=;
                    |SI FSalida ! 0; |DDEFECTO #11; |FINSI;
                    |CIERRA #11;
                    #14#16 = #11#31;
                    |HAZ SacaPrecio;
                    #14#17 = nPrecio;
                    #14#10 = "31.12.9999";
                    #14#13 = "31.12.9999";

                    IaCam = aCam1<-;
                    |PARA i = 0; |SI i [ 25; |HACIENDO i = i + 1;
                         aCam = #14i;
                         IaCam = IaCam + 1;
                    |SIGUE;
                    nOpc = 4;
                    |HAZ VenComun;
                    |SI FSalida = 0;
                         |HAZ Opc4;
                         |HAZ Actua4;
                    |FINSI;
               |FINSI;
               |LIBERA #14;
          |FINSI;
     |FINSI;
     |REPON_DATOS #4;
     |LEE 000#4=;
     |REFRESCACONTROL nGridCom;
|FPRC;

|PROCESO BtnInSitu2;
     |SALVA_DATOS #4;
     aNumSer = #4#3;
     |BUCLE HayMarcados;
     |SI nHayMarca ] 2;
          |HAZ FechaReal;
          nOpc = 5;
          |SI FSalida = 0; |BUCLE Marcados; |FINSI;
     |SINO;
          #14#0 = aSer;
          #14#1 = nNum;
          #14#2 = aNumSer;
          |LEE 121#14=;
          |SI FSalida = 0;
               #13#0 = #14#0;
               #13#1 = #14#1;
               |LEE 020#13=;

               aMesAno1 = #13#2 % 407;
               aMesAno2 = #14#12 % 407;
               |SI aMesAno1 = aMesAno2;
                    |MENAV "0000Se debe de realizar antes el retimbrado...";
               |SINO;
                    |HAZ Situ;
                    aAlfa = "0000N§ serie: '" + #14#2; |QBF aAlfa;
                    |SI #14#15 ! " ";
                         aAlfa = aAlfa + "' en situaci¢n: " + aSitu;
                         |MENAV aAlfa;
                    |SINO;
                         |SI #14#14 ! "01.01.0000";
                              aAlfa = "0000N§ serie: '" + #14#2; |QBF aAlfa;
                              aAlfa = aAlfa + "' con fecha recogida:" + #14#14;
                              |MENAV aAlfa;
                         |SINO;
                              fHoy = ~;
                              aMes1 = #14#13 % 402; aAno1 = #14#13 % 704;
                              aMes2 = fHoy % 402; aAno2 = fHoy % 704;
                              |SI aMes1 = aMes2; |Y aAno1 = aAno2;
                                   aAlfa = "0000N§ serie: '" + #14#2; |QBF aAlfa;
                                   aAlfa = aAlfa + "' No se puede hacer revisi¢n insitu si hay que hacer retimbrado";
                                   |MENAV aAlfa;
                              |SINO;
                                   aMes1 = #14#13 % 402; aAno1 = #14#13 % 704;
                                   aMes2 = fHoy % 402; aAno2 = fHoy % 704;
                                   |SI aMes1 ! aMes2; |O aAno1 ! aAno2;
                                        |ABRE #11;
                                        #11#0 = #14#2;
                                        |LEE 020#11=;
                                        |SI FSalida ! 0; |DDEFECTO #11; |FINSI;
                                        |CIERRA #11;
                                        #14#16 = #11#29;
                                        |HAZ SacaPrecio;
                                        #14#17 = nPrecio;

                                        IaCam = aCam1<-;
                                        |PARA i = 0; |SI i [ 25; |HACIENDO i = i + 1;
                                             aCam = #14i;
                                             IaCam = IaCam + 1;
                                        |SIGUE;
                                        nOpc = 5;
                                        |HAZ VenComun;
                                        |SI FSalida = 0;
                                             aSwTodos = "N";
                                             |HAZ Opc5;
                                             aSwTodos = "S";
                                             |HAZ Actua4;
                                        |FINSI;
                                   |FINSI;
                              |FINSI;
                         |FINSI;
                    |FINSI;
               |FINSI;
               |LIBERA #14;
          |FINSI;
     |FINSI;
     |REPON_DATOS #4;
     |LEE 000#4=;
     |REFRESCACONTROL nGridCom;
|FPRC;

|PROCESO BtnRecarga2;
     |SALVA_DATOS #4;
     aNumSer = #4#3;
     |BUCLE HayMarcados;
     |SI nHayMarca ] 2;
          |CONFI "0000N¨Marcar con recarga los registros seleccionados?";
          nOpc = 6;
          |SI FSalida = 0; |BUCLE Marcados; |FINSI;
     |SINO;
          #14#0 = aSer;
          #14#1 = nNum;
          #14#2 = aNumSer;
          |LEE 121#14=;
          |SI FSalida = 0;
               #13#0 = #14#0;
               #13#1 = #14#1;
               |LEE 020#13=;

               aMesAno1 = #13#2 % 407;
               aMesAno2 = #14#12 % 407;
               |SI aMesAno1 = aMesAno2;
                    |MENAV "0000Se debe de realizar antes el retimbrado...";
               |SINO;
                    |HAZ Situ;
                    aAlfa = "0000N§ serie: '" + #14#2; |QBF aAlfa;
                    |SI #14#15 ! " ";
                         aAlfa = aAlfa + "' en situaci¢n: " + aSitu;
                         |MENAV aAlfa;
                    |SINO;
                         |SI #14#4 ! #18#1; |Y #14#4 ! #18#2; |Y #14#4 ! #18#3;
                                   |Y #14#4 ! #18#4; |Y #14#4 ! #18#5;
                              aAlfa = "0000Sistema:" + #14#4 + ", no apto para la recarga...";
                              |MENAV aAlfa;
                         |SINO;
                              |SI #14#14 = "01.01.0000";
                                   |MENAV "0000Art¡culo sin fecha de recogida...";
                              |SINO;
                                   |ABRE #11;
                                   #11#0 = #14#2;
                                   |LEE 020#11=;
                                   |SI FSalida ! 0; |DDEFECTO #11; |FINSI;
                                   |CIERRA #11;
                                   #14#16 = #11#30;
                                   |HAZ SacaPrecio;
                                   #14#17 = nPrecio;
                                   |SI #11#25 = "A"; nNume = 1/1000000; |FINSI;
                                   |SI #11#25 = "S"; nNume = 1/1000 * 6; |FINSI;
                                   |SI #11#25 = "T"; nNume = 1/1000 * 3; |FINSI;
                                   |SI #11#25 = "M"; nNume = 1/1000 * 1; |FINSI;
                                   #14#10 = #14#14 + nNume;

                                   IaCam = aCam1<-;
                                   |PARA i = 0; |SI i [ 25; |HACIENDO i = i + 1;
                                        aCam = #14i;
                                        IaCam = IaCam + 1;
                                   |SIGUE;
                                   nOpc = 6;
                                   |HAZ VenComun;
                                   |SI FSalida = 0;
                                        aSwTodos = "N";
                                        |HAZ Opc6;
                                        aSwTodos = "";
                                        |HAZ Actua4;
                                   |FINSI;
                              |FINSI;
                         |FINSI;
                    |FINSI;
               |FINSI;
               |LIBERA #14;
          |FINSI;
     |FINSI;
     |REPON_DATOS #4;
     |LEE 000#4=;
     |REFRESCACONTROL nGridCom;
|FPRC;

|PROCESO BtnRetimbra2;
     |SALVA_DATOS #4;
     aNumSer = #4#3;
     |BUCLE HayMarcados;
     |SI nHayMarca ] 2;
          |CONFI "0000N¨Marcar con retimbrado los registros seleccionados?";
          nOpc = 7;
          |SI FSalida = 0; |BUCLE Marcados; |FINSI;
     |SINO;
          #14#0 = aSer;
          #14#1 = nNum;
          #14#2 = aNumSer;
          |LEE 121#14=;
          |SI FSalida = 0;
               |HAZ Situ;
               aAlfa = "0000N§ serie: '" + #14#2; |QBF aAlfa;
               |SI #14#15 ! " ";
                    aAlfa = aAlfa + "' en situaci¢n: " + aSitu;
                    |MENAV aAlfa;
               |SINO;
                    |SI #14#4 ! #18#6; |Y #14#4 ! #18#7; |Y #14#4 ! #18#8;
                              |Y #14#4 ! #18#9; |Y #14#4 ! #18#10;
                         aAlfa = "0000Sistema:" + #14#4 + ", no apto para retimbrado...";
                         |MENAV aAlfa;
                    |SINO;
                         |SI #14#14 = "01.01.0000";
                              aAlfa = "0000N§ serie: '" + #14#2; |QBF aAlfa;
                              aAlfa = aAlfa + "' 0000sin fecha de recogida...";
                              |MENAV aAlfa;
                         |SINO;
                              |ABRE #11;
                              #11#0 = #14#2;
                              |LEE 020#11=;
                              |SI FSalida ! 0; |DDEFECTO #11; |FINSI;
                              |CIERRA #11;
                              #14#16 = #11#32;
                              |HAZ SacaPrecio;
                              #14#17 = nPrecio;
                              |SI #11#25 = "A"; nNume = 1/1000000; |FINSI;
                              |SI #11#25 = "S"; nNume = 1/1000 * 6; |FINSI;
                              |SI #11#25 = "T"; nNume = 1/1000 * 3; |FINSI;
                              |SI #11#25 = "M"; nNume = 1/1000 * 1; |FINSI;
                              #14#10 = #14#14 + nNume;
                              nNume = #11#35/1000000;
                              #14#13 = #14#14 + nNume;

                              IaCam = aCam1<-;
                              |PARA i = 0; |SI i [ 25; |HACIENDO i = i + 1;
                                   aCam = #14i;
                                   IaCam = IaCam + 1;
                              |SIGUE;
                              nOpc = 7;
                              |HAZ VenComun;
                              |SI FSalida = 0;
                                   aSwTodos = "N";
                                   |HAZ Opc7;
                                   aSwTodos = "S";
                                   |HAZ Actua4;
                              |FINSI;
                         |FINSI;
                    |FINSI;
               |FINSI;
               |LIBERA #14;
          |FINSI;
     |FINSI;
     |REPON_DATOS #4;
     |LEE 000#4=;
     |REFRESCACONTROL nGridCom;
|FPRC;

|PROCESO BtnAnula2;
     |SALVA_DATOS #4;
     aNumSer = #4#3;
     |BUCLE HayMarcados;
     |SI nHayMarca ] 2;
          |CONFI "0000N¨Anular situaci¢n art¡culos?";
          nOpc = 8;
          |SI FSalida = 0; |BUCLE Marcados; |FINSI;
     |SINO;
          #14#0 = aSer;
          #14#1 = nNum;
          #14#2 = aNumSer;
          |LEE 121#14=;
          |SI FSalida = 0;
               |HAZ Situ;
               aAlfa = "0000N¨Anular situaci¢n:" + aSitu + "?";
               |CONFI aAlfa;
               |SI FSalida = 0;
                    |HAZ Opc8;
                    |HAZ Actua4;
               |FINSI;
               |LIBERA #14;
          |FINSI;
     |FINSI;
     |REPON_DATOS #4;
     |LEE 000#4=;
     |REFRESCACONTROL nGridCom;
|FPRC;

|PROCESO NuevaLin2;
     |SI nOpcion = 1;
          |SALVA_DATOS #referen@;
          |REPON_DATOS #14;
          #14#0 = #13#0;
          #14#1 = #13#1;
          #14#15 = "";
          |GRABA 020#14n;
          aPro = #14#2;
          |BUCLE NuevaCarac;

          #11#0 = #14#2;
          |LEE 121#11=;
          |SI FSalida = 0;
               #11#45 = aSerNue;
               #11#46 = nNumNue;
               |GRABA 020#11a;
               |LIBERA #11;
          |FINSI;
     |FINSI;
     |SI nOpcion = 2;         ||
          |SALVA_DATOS #referen@;
          |REPON_DATOS #14;
          #14#0 = #13#0;
          #14#1 = #13#1;
          |GRABA 020#14n;
          aPro = #14#2;
          |BUCLE NuevaCarac;

          #11#0 = #14#2;
          |LEE 121#11=;
          |SI FSalida = 0;
               |SI #11#25 = "A"; nNume = 1/1000000; |FINSI;
               |SI #11#25 = "S"; nNume = 1/1000 * 6; |FINSI;
               |SI #11#25 = "T"; nNume = 1/1000 * 3; |FINSI;
               |SI #11#25 = "M"; nNume = 1/1000 * 1; |FINSI;
               |SI #11#23 ! "01.01.0000";
                    #11#27 = #11#23 + nNume;
               |FINSI;
               |SI #11#33 ! "01.01.0000";
                    nNume = #11#35 / 1000000;
                    #11#37 = #11#33 + nNume;
               |FINSI;
               #11#45 = "";
               #11#46 = 0;
               |GRABA 020#11a;
               |LIBERA #11;
          |FINSI;
     |FINSI;

     |BORRA 020#referen@.a;
     #14#0 = #referen@#0;
     #14#1 = #referen@#1;
     #14#2 = #referen@#2;
     |BORRA 020#14c;
     |HAZ BorraCara0;
|FPRC;

|DEFBUCLE NuevaLin2;
     #referen@#1003;
     15;
     aSer, nNum, "                    ", "X";
     aSer, nNum, "zzzzzzzzzzzzzzzzzzzz", "X";
     ;
     NULL, NuevaLin2;
|FIN;

|PROCESO BtnBorNada2;
     |SALVA_DATOS #4;
     nOpcion = 0;
     nHay = 0;
     |BUCLE HayNada;
     |SI nHay = 0;
          |MENAV "0000No hay lineas de 'no se hace nada'";
     |SINO;
          |HAZ PideOpcion;

          |DDEF aAlfa; aAlfa = aAlfa + "extm0014"; |CARGA_DEF aAlfa, referen@;
          |ABRE #11;
          |SI nOpcion = 1;    ||Nuevo
               aSerNue = aSer;
               |HAZ UltParte;
               #13#0 = aSer;
               #13#1 = nNum;
               |LEE 020#13=;
               #13#1 = nNumNue;
               #13#2 = ~;
               |GRABA 020#13n;
               |SI FSalida = 0;
                    |BUCLE NuevaLin2;
                    aAlfa = "0000Creado parte: '" + #13#0 + "/" + (("000000"+#13#1)%-106) + "'";
                    |MENAV aAlfa;
               |FINSI;
          |FINSI;
          |SI nOpcion = 2;    ||Borra
               fHoy = ~; aAlfa = fHoy % -102;
               aSerNue = #18#11; |QBF aSerNue;
               aSerNue = ("     " + aSerNue + aAlfa) % -105;
               |HAZ UltParte;
               #13#0 = aSer;
               #13#1 = nNum;
               #13#2 = ~;
               |LEE 020#13=;
               #13#0 = aSerNue;
               #13#1 = nNumNue;
               #13#9 = "C";
               |GRABA 020#13n;
               |SI FSalida = 0;
                    |BUCLE NuevaLin2;
                    aAlfa = "0000Creado parte: '" + #13#0 + "/" + (("000000"+#13#1)%-106) + "'";
                    |MENAV aAlfa;
               |FINSI;
          |FINSI;
          |CIERRA #11;
          |DESCARGA_DEF #referen@;

          #14#0 = aSer;
          #14#1 = nNum;
          #14#2 = "";
          |LEE 000#14];
          |SI FSalida ! 0; |O #14#0 ! aSer; |O #14#1 ! nNum;
               #13#0 = aSer;
               #13#1 = nNum;
               |BORRA 020#13c;
          |FINSI;

          |REFRESCACONTROL nGridC1;
          |REFRESCACONTROL nGridC2;
          |REFRESCACONTROL nGridC4;
     |FINSI;
     |REPON_DATOS #4;
     |LEE 000#4=;
     |REFRESCACONTROL nGridCom;
|FPRC;

|PROCESO BtnCerApt2;
     |SALVA_DATOS #4;
     aNumSer = #4#3;
     |BUCLE HayMarcados;
     |SI nHayMarca ] 2;
          eaSerie = #14#0;
          enNumero = #14#1;
          eaFichero = aTmp4;
          |SUB_EJECUTA_NP "extz0011;TMPMARCA";
     |SINO;
          #14#0 = aSer;
          #14#1 = nNum;
          #14#2 = aNumSer;
          |LEE 121#14=;
          |SI FSalida = 0;
               |CONFI "0000N¨Imprimir todas las lineas del parte?";
               |SI FSalida = 0;
                    eaNumSer = "";
               |SINO;
                    eaNumSer = #14#2;
               |FINSI;
               eaSerie = #14#0;
               enNumero = #14#1;
               nHay = 0;
               |BUCLE ChekImp;
               |SI nHay ! 0;
                    |SUB_EJECUTA_NP "extz0011";
               |FINSI;
          |FINSI;
     |FINSI;
     |REPON_DATOS #4;
     |LEE 000#4=;
     |REFRESCACONTROL nGridCom;
|FPRC;

|PROCESO BtnCamSerie2;
     aNumSer = #4#3;
     |BUCLE HayMarcados;
     |SI nHayMarca ] 2;
          nOpc = 11;
          |BUCLE Marcados;
          |HAZ CargaTmp4_0;
     |SINO;
          #14#0 = aSer;
          #14#1 = nNum;
          #14#2 = aNumSer;
          |LEE 121#14=;
          |SI FSalida = 0;
               |HAZ PideNuevoSerie;
               |SI FSalida = 0;
                    |BUCLE CambiRev;
                    |BUCLE CambiTmp4;
                    |ABRE #11;
                    #11#0 = #113#0;
                    |LEE 121#11=;
                    |SI FSalida = 0;
                         |BORRA 020#11a;
                         #11#0 = #113#1;
                         |GRABA 020#11n;
                    |FINSI;
                    |CIERRA #11;
               |FINSI;
               |LIBERA #14;
          |FINSI;
     |FINSI;
     |REFRESCACONTROL nGridCom;
|FPRC;

|PROCESO BtnEtiqueta2;
     |SALVA_DATOS #4;
     aNumSer = #4#3;
     |BUCLE HayMarcados;
     |SI nHayMarca ] 2;
          eaSerie = aSer;
          enNumero = nNum;
          aAlfa = "extz0012;" + aTmp4;
          |SUB_EJECUTA_NP aAlfa;
     |SINO;
          #14#0 = aSer;
          #14#1 = nNum;
          #14#2 = aNumSer;
          |LEE 020#14=;
          |SI FSalida = 0;
               eaNumSer = #14#2;
               eaSerie = #14#0;
               enNumero = #14#1;
               |SUB_EJECUTA_NP "extz0012";
          |FINSI;
     |FINSI;
     |REPON_DATOS #4;
     |LEE 000#4=;
     |REFRESCACONTROL nGridCom;
|FPRC;

|PROCESO EvtCom;
     |SI FSalida = 1; |O FSalida = 2;
          |LEE 000#4=;
     |FINSI;
     |SI FSalida = 4;
          |SI #4#0 = " ";
               #4#0 = "*";
          |SINO;
               #4#0 = " ";
          |FINSI;
          |GRABA 020#4a;
          |REFRESCACONTROL nGridCom;
     |FINSI;
|FPRC;

|PROCESO CargaTmp4;
     |SI nSwBtnLin = 3;
          |SI #14#14 = "01.01.0000"; |ACABA; |FINSI;
     |FINSI;
     |SI nSwBtnLin = 2;
          |SI #14#14 ! "01.01.0000"; |ACABA; |FINSI;
     |FINSI;
     |SI nSwBtnLin = 1;
     |FINSI;
     #4#0 = "";
     |PARA i = 0; |SI i [ 26; |HACIENDO i = i + 1;
          nCampo = i + 1;
          #4nCampo = #14i;
     |SIGUE;
     |GRABA 020#4n;
|FPRC;

|DEFBUCLE CargaTmp4;
     #14#1;
     ;
     aSer, nNum, "                    ";
     aSer, nNum, "zzzzzzzzzzzzzzzzzzzz";
     ;
     NULL, CargaTmp4;
|FIN;

|PROCESO CargaTmp4_0;
     |CIERRA #4; |DELINDEX #4; |ABRE #4;
     |BUCLE CargaTmp4;
     |LEE 000#4p;
     |PULSATECLA;
     |REFRESCACONTROL nGridCom;
|FPRC;

|PROCESO BtnMarDes;
     |SI #4#0 = " "; aAlfa = "*"; |SINO; aAlfa = ""; |FINSI;
     |SALVA_DATOS #4;
     |LEE 000#4p;
     |PARA; |SI FSalida = 0; |HACIENDO;
          #4#0 = aAlfa;
          |GRABA 020#4a;
          |LEE 000#4s;
     |SIGUE;
     |REPON_DATOS #4;
     |LEE 000#4=;
     |REFRESCACONTROL nGridCom;
|FPRC;

|PROCESO BtnVerCom;
     |HAZ CreaTempo; aTmp4 = Tempo; |NOME_DAT #4#Tempo#; |DELINDEX #4;
     |ABRE #4;
     aSer = #referc2@#0;
     nNum = #referc2@#1;
     |BUCLE CargaTmp4;
     |LEE 000#4p;
     aAlfa = "Lineas Parte:" + aSer + "/" + (("000000" + nNum) % -106);
     |VENTANA 901, 3398, -1, 17, aAlfa;
     |HAZ PushVenModal;

     |CONTROL_SIMPLE 0, "BOTON,Recogida cliente", 1002, 1017, BtnRecoCli2;
||     |CONTROL_SIMPLE 0, "BOTON,Observaciones", 1019, 1034, BtnObserva2;
     |CONTROL_SIMPLE 0, "BOTON,No se hace nada", 1019, 1034, BtnHaceNada2;
     |CONTROL_SIMPLE 0, "BOTON,No apto", 1036, 1051, BtnNoApto2;
     |CONTROL_SIMPLE 0, "BOTON,Revisi¢n in situ", 1053, 1068, BtnInSitu2;
     |CONTROL_SIMPLE 0, "BOTON,Recarga", 1070, 1085, BtnRecarga2;
     |CONTROL_SIMPLE 0, "BOTON,Retimbrado", 1087, 1098, BtnRetimbra2;

     |CONTROL_SIMPLE 0, "BOTON,Anular situaci¢n", 1102, 1117, BtnAnula2;
||     |CONTROL_SIMPLE 0, "BOTON,Borrar 'no se hace nada'", 1131, 1151, BtnBorNada2;
     |CONTROL_SIMPLE 0, "BOTON,Certificado aptitud", 1119, 1134, BtnCerApt2;
     |CONTROL_SIMPLE 0, "BOTON,Cambiar n§ serie", 1136, 1151, BtnCamSerie2;
     |CONTROL_SIMPLE 0, "BOTON,Etiqueta", 1153, 1168, BtnEtiqueta2;

     |CONTROL_SIMPLE 0, "LABEL,{{013}}Doble click marca linea", 1302, 1330, NULL;
     |CONTROL_SIMPLE 0, "BOTON,Marca/Desmarca todo", 1331, 1351, BtnMarDes;
     |CONTROL_SIMPLE 0, "BOTON,Resumen", 1353, 1368, BtnResumen;
     |CONTROL_SIMPLE 0, "BOTON,Incidencia", 1370, 1385, BtnIncidencia2;

     |ABRET #14;
     |ABRET #13;
     nRango = 4 + 8 + 16 + 32;
     |LINEAL_SIMPLE #1#4, nRango, 1402, 3198, NULL, NULL, EvtCom;
     nGridCom = FSalida;
     enCtrFin = nGridCom;
     |HAZ EsperaFin;
     |CIERRAT #13;
     |CIERRAT #14;

     |HAZ PopVenModal;

     |CIERRA #4;
     Tempo = aTmp4; |HAZ BoraTempo; |DELINDEX #4;

     |HAZ CargaLin;
|FPRC;

|PROCESO BtnPresu;
     |ABRE #13;
     #13#0 = #referc2@#0;
     #13#1 = #referc2@#1;
     |LEE 101#13=;
     |SI FSalida = 0;
          |HAZ CreaTempo;  ||Serie+Numero+Cliente+Dir+Tempo
          aAlfa = #13#31 + (("0000000" + #13#32) % -106) + "      " + "    " + Tempo;
          aAlfa = "*extz0014;" + aAlfa;
          |SUB_EJECUTA_NP aAlfa;
          |HAZ LeeTempo; |HAZ BoraTempo;
          #13#31 = aSerie;
          #13#32 = nNumero;
          |GRABA 020#13a;
     |FINSI;
     |CIERRA #13;
|FPRC;

|PROCESO BtnPedido;
     |ABRE #13;
     #13#0 = #referc2@#0;
     #13#1 = #referc2@#1;
     |LEE 101#13=;
     |SI FSalida = 0;
          |HAZ CreaTempo;  ||Serie+Numero+Cliente+Dir+Tempo
          aAlfa = #13#35 + (("0000000" + #13#36) % -106) + #13#4 + (("0000"+#13#6)%-104) + Tempo;
          aAlfa = "*extz0018;" + aAlfa;
          |SUB_EJECUTA_NP aAlfa;
          |HAZ LeeTempo; |HAZ BoraTempo;
          #13#35 = aSerie;
          #13#36 = nNumero;
          |GRABA 020#13a;
     |FINSI;
     |CIERRA #13;
|FPRC;

|PROCESO BtnMateDeja;
     |ABRE #13;
     #13#0 = #referc2@#0;
     #13#1 = #referc2@#1;
     |LEE 101#13=;
     |SI FSalida = 0;
          |HAZ BtnDejado0;
     |FINSI;
     |CIERRA #13;
|FPRC;

|PROCESO BtnMateExtra;
     |ABRE #13;
     #13#0 = #referc2@#0;
     #13#1 = #referc2@#1;
     |LEE 101#13=;
     |SI FSalida = 0;
          |HAZ BtnExtra0;
     |FINSI;
     |CIERRA #13;
|FPRC;

|PROCESO BtnModificar;
     |ABRE #13;
     #13#0 = #referc2@#0;
     #13#1 = #referc2@#1;
     |LEE 101#13=;
     |SI FSalida = 0;
          |HAZ ModiParte;
          |SI enError = 0;
               |GRABA 020#13a;
               |HAZ CargaLin;
               |PULSATECLA;
               |REFRESCACONTROL nGridC1;
               |REFRESCACONTROL nGridC2;
          |FINSI;
     |FINSI;
     |CIERRA #13;
|FPRC;

|PROCESO DesAdjArti;
     #11#45 = 0;
     #11#46 = "";
     |GRABA 020#11a;
     |LIBERA #11;
|FPRC;

|DEFBUCLE DesAdjArti;
     #11#3;
     ;
     #13#0, #13#1;
     #13#0, #13#1;
     ;
     NULL, DesAdjArti;
|FIN;

|PROCESO Situ;
     |SI #14#15 = " ";
          aSitu = "sin trabajo";
     |FINSI;
     |SI #14#15 = "X";
          aSitu = "no se hace nada";
     |FINSI;
     |SI #14#15 = "N";
          aSitu = "no apto";
     |FINSI;
     |SI #14#15 = "I";
          aSitu = "revisi¢n in situ";
     |FINSI;
     |SI #14#15 = "R";
          aSitu = "recarga";
     |FINSI;
     |SI #14#15 = "T";
          aSitu = "retimbrado";
     |FINSI;
|FPRC;

|PROCESO SituBorra;
     |SI #14#15 ! " "; |O #14#14 ! "01.01.0000";
          |HAZ Situ;
          aAlfa = "0000N§ serie: '" + #14#2; |QBF aAlfa;
          aAlfa = aAlfa + "' en situaci¢n: " + aSitu;
          aAlfa = aAlfa + " con fecha recogida: " + #14#14;
          |MENAV aAlfa;
          nError = 1;
     |FINSI;
|FPRC;

|DEFBUCLE SituBorra;
     #14#1;
     ;
     #13#0, #13#1, "                    ";
     #13#0, #13#1, "zzzzzzzzzzzzzzzzzzzz";
     ;
     NULL, SituBorra;
|FIN;

|PROCESO BtnBorrar;
     |ABRE #13;
     #13#0 = #referc2@#0;
     #13#1 = #referc2@#1;
     |LEE 101#13=;
     |SI FSalida = 0;
          aAlfa = "0000N¨Borrar parte:" + #13#0 + "/" + (("000000" + #13#1) % -106) + "?";
          |CONFI aAlfa;
          |SI FSalida = 0;
               nError = 0;
               |BUCLE SituBorra;
               |SI nError = 0;
                    |MENAV "0000No se han cambiado las fechas de proxima revisión, se mantienen las actuales...";
                    |BUCLE DesAdjArti;
                    |BORRA 020#13a;
                    |HAZ BorraLin0;
                    |REFRESCACONTROL nGridL1;
                    |REFRESCACONTROL nGridC1;
                    |REFRESCACONTROL nGridC2;
                    |HAZ Tiene1;
                    |HAZ Tiene2;
                    |HAZ CargaLin;
               |FINSI;
          |FINSI;
     |FINSI;
     |CIERRA #13;
|FPRC;

|PROCESO SituLin;
     |HAZ Situ;
     |SI #14#15 = " ";
          aAlfa = "0000N§ serie: '" + #14#2; |QBF aAlfa;
          aAlfa = aAlfa + "' " + aSitu;
          |MENAV aAlfa;
          nError = 1;
     |FINSI;
     |SI #14#15 = "X";
          aAlfa = "0000N§ serie: '" + #14#2; |QBF aAlfa;
          aAlfa = aAlfa + "' en situaci¢n: " + aSitu;
          |MENAV aAlfa;
          nError = 1;
     |FINSI;
     |SI #14#15 = "N"; |Y #14#10 = "01.01.0000"; |Y #14#13 = "01.01.0000";
          aAlfa = "0000N§ serie: '" + #14#2; |QBF aAlfa;
          aAlfa = aAlfa + "' en situaci¢n: " + aSitu + ", sin fecha prox. revisi¢n o timbrado...";
          |MENAV aAlfa;
          nError = 1;
     |FINSI;
     aArti = #14#16;
     |SI #14#15 = "I"; |Y #14#10 = "01.01.0000"; |Y aArti = "";
          aAlfa = "0000N§ serie: '" + #14#2; |QBF aAlfa;
          aAlfa = aAlfa + "' en situaci¢n: " + aSitu + ", sin fecha prox. revisi¢n o cod. art. fact...";
          |MENAV aAlfa;
          nError = 1;
     |FINSI;
     |SI #14#15 = "R"; |Y #14#10 = "01.01.0000"; |Y aArti = "";
          aAlfa = "0000N§ serie: '" + #14#2; |QBF aAlfa;
          aAlfa = aAlfa + "' en situaci¢n: " + aSitu + ", sin fecha prox. revisi¢n o cod. art. fact...";
          |MENAV aAlfa;
          nError = 1;
     |FINSI;
     |SI #14#15 = "T"; |Y #14#10 = "01.01.0000"; |Y #14#13 = "01.01.0000";
               |Y aArti = "";
          aAlfa = "0000N§ serie: '" + #14#2; |QBF aAlfa;
          aAlfa = aAlfa + "' en situaci¢n: " + aSitu + ", sin fecha prox. timbrado/revisi¢n o cod. art. fact...";
          |MENAV aAlfa;
          nError = 1;
     |FINSI;
     aAlfa = #14#2 % 104;
     |SI aAlfa = "DESC";
          nSwDes = nSwDes + 1;
     |FINSI;
|FPRC;

|DEFBUCLE SituLin;
     #14#1;
     ;
     #13#0, #13#1, "                    ";
     #13#0, #13#1, "zzzzzzzzzzzzzzzzzzzz";
     ;
     NULL, SituLin;
|FIN;

|PROCESO VenFactu;
     aAlfa = "Facturar parte :" + #13#0 + "/" + (("000000" + #13#1)%-106);
     |VENTANA 1135, 1865, -1, 17, aAlfa;
     |HAZ PushVenModal;

     |DDEFECTO #126;
     fHoy = ~; aA¤o = fHoy % -102;
     aAlfa = #13#0 % 103; |QBF aAlfa;
     aAlfa = aAlfa + aA¤o;
     #126#0 = aAlfa;
     #126#3 = #13#6;
     |SI #13#17 ! #13#4;
          #126#3 = 1;
     |FINSI;
     #126#4 = #13#17;

     |DDEFECTO #22;
     |ABRE #22;
     #22#0 = #13#17;
     #22#1 = #13#8;
     |LEE 000#22=;
     |SI FSalida ! 0;
          |HAZ AltaSerFac;
     |FINSI;
     |CIERRA #22;
     aAlfa = #22#2 % 103; |QBF aAlfa;
     aAlfa = aAlfa + aA¤o;
     #126#1 = aAlfa

     |SI #13#12 = "N";
          #126#1 = "";
          #126#2 = "01.01.0000";
          |C_M #126#1, 1, "N";
          |C_M #126#2, 1, "N";
     |SINO;
          |C_M #126#2, 1, "S";
          |C_M #126#2, 1, "S";
     |FINSI;

     |PINPA #0#126;
     |PINDA #0#126;
     |ENDATOS #1#126;
     nError = FSalida;

     |HAZ PopVenModal;
|FPRC;

|PROCESO VenAlba;
     aAlfa = "Albar n parte :" + #13#0 + "/" + (("000000" + #13#1)%-106);
     |VENTANA 1135, 1865, -1, 17, aAlfa;
     |HAZ PushVenModal;

     |DDEFECTO #128;
     fHoy = ~; aA¤o = fHoy % -102;
     aAlfa = #13#0 % 103; |QBF aAlfa;
     aAlfa = aAlfa + aA¤o;
     #128#0 = aAlfa;
     #128#1 = #13#6;
     |SI #13#17 ! #13#4;
          #128#1 = 1;
     |FINSI;
     #128#2 = #13#17;

     |PINPA #0#128;
     |PINDA #0#128;
     |ENDATOS #1#128;
     nError = FSalida;

     |HAZ PopVenModal;
|FPRC;

|PROCESO PdteFactu;
     |SI #referen@#0 ! #13#0; |O #referen@#1 ! #13#1;
          |SI #referen@#9 = "A"; |O #referen@#9 = "P";
               nHay = nHay + 1;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE PdteFactu;
     #referen@#6003;
     ;
     #13#4, nDDire, aDEdi;
     #13#4, nHDire, aHEdi;
     ;
     NULL, PdteFactu;
|FIN;

|PROCESO CtrFactu;
     nHay = 0;
     |ABRE #2;
     #2#0 = #13#4;
     #2#1 = #13#6;
     |LEE 000#2=;
     |SI FSalida = 0;
          |DDEF aAlfa;
          aAlfa = aAlfa + "extm0013";
          |CARGA_DEF aAlfa, referen@;
          |SI FSalida = 0;
               nHDire = 0000;
               nDDire = 9999;
               aDEdi = "                    ";
               aHEdi = "zzzzzzzzzzzzzzzzzzzz";
               |SI #2#3 = "E";
                    aDEdi = #13#7;
                    aHEdi = #13#7;
                    |BUCLE PdteFactu;
               |FINSI;
               |SI #2#3 = "D";
                    nDDire = #13#6;
                    nHDire = #13#6;
                    |BUCLE PdteFactu;
               |FINSI;
               |DESCARGA_DEF #referen@;
          |FINSI;
     |FINSI;
     |CIERRA #2;
     |SI nHay ! 0;
          |CONFI "0000NExisten partes del cliente abiertos o pendientes de facturar. ¨Continuar?";
          nError = FSalida;
     |FINSI;
|FPRC;

|PROCESO BtnCerrar;
     |ABRE #13;
     #13#0 = #referc2@#0;
     #13#1 = #referc2@#1;
     |LEE 101#13=;
     |SI FSalida = 0;
          enSwAgrupa = 1;
          |HAZ BtnAgrupa;
          enSwAgrupa = 0;

          nError = 0;
          nSwDes = 0;
          |BUCLE SituLin;
          |SI nError = 0;
               |SI nSwDes ] 1;
                    |SI nSwDes = 1;
                         aAlfa = "0000NExiste l¡nea con n§ de serie desconocido." + &13 + &13 + "¨Continuar?";
                    |SINO;
                         aAlfa = "0000NExisten l¡neas con n§ de series desconocidos." + &13 + &13 + "¨Continuar?";
                    |FINSI;
                    |CONFI aAlfa;
                    |SI FSalida ! 0; nError = 1; |FINSI;
               |FINSI;
          |FINSI;
          |SI nError = 0;
               |BUCLE CheqCara0;
          |FINSI;

          |SI nError = 0;
               #13#9 = "P";
               |CONFI "0000N¨Desea facturar el parte?";
               |SI FSalida = 0;
                    |HAZ CtrFactu;
                    |SI nError = 0;
                         |HAZ VenFactu;
                         |SI nError = 0;
                              enForma = 1;
                              |HAZ FactuParte;
                              #13#9 = "C";
                         |FINSI;
                    |SINO;
                         |CONFI "0000S¨Pasar a pendiente facturar?";
                         nError = FSalida;
                    |FINSI;
               |FINSI;
               |SI nError = 0;
                    |SI #13#9 = "P";
                         |HAZ VenAlba;
                         |SI nError = 0;
                              enForma = 1;
                              |HAZ Albaran;
                         |FINSI;
                    |FINSI;
                    |SI nError = 0;
                         enForma = 1;
                         |HAZ TraspasoSal;
                         |GRABA 020#13a;
                         |SALVA_DATOS #13;
                         |CIERRA #referl2@; |DELINDEX #referl2@; |ABRE #referl2@;
                         |REFRESCACONTROL nGridL2;
                         |REFRESCACONTROL nGridC2;
                         |HAZ Tiene2;
                         |REPON_DATOS #13;
                         |SI #13#9 = "P";
                              |HAZ CargaPdte;
                              |HAZ Tiene3;
                              |REFRESCACONTROL nGridC3;
                         |SINO;
                              |REFRESCACONTROL nGridC4;
                         |FINSI;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
     |CIERRA #13;
|FPRC;

|PROCESO BtnSele;
     |SI #referc1@#9 = "A";
          |SELECT #1#referc2@;
          #referc2@#0 = #referc1@#0;
          #referc2@#1 = #referc1@#1;
          |LEE 000#referc2@.=;
          |SELECT #3#referc2@;
          |LEE 000#referc2@.=;
          |REFRESCACONTROL nGridC2;
          |FOCOTECLADO nGridC2;
     |FINSI;
     |SI #referc1@#9 = "C";
          |SELECT #1#referc4@;
          #referc4@#0 = #referc1@#0;
          #referc4@#1 = #referc1@#1;
          |LEE 000#referc4@.=;
          |SELECT #3#referc4@;
          |LEE 000#referc4@.=;
          |REFRESCACONTROL nGridC4;
          |FOCOTECLADO nGridC4;
     |FINSI;
     |SI #referc1@#9 = "P";
          #1#0 = #referc1@#0;
          #1#1 = #referc1@#1;
          |LEE 000#1=;
          |REFRESCACONTROL nGridC3;
          |FOCOTECLADO nGridC3;
     |FINSI;
|FPRC;

|PROCESO BtnAbrir;
     |SI #0#0 ! "000000";
          |ABRE #24;
          #24#0 = #0#0;
          |LEE 000#24=;
          |SI FSalida ! 0; |DDEFECTO #24; |FINSI;
          |CIERRA #24;
          |SI #24#111 = "S";
               |MENAV "0000Cliente bloqueado...";
               |ERROR;
          |FINSI;
     |FINSI;

     |HAZ NuevoParte;
     |SI enError = 0;
          #referc1@#0 = eaSerParte;
          #referc1@#1 = enNumParte;
          |LEE 000#referc1@.=;
          |REFRESCACONTROL nGridC1;
          |SI #13#9 = "A"; |REFRESCACONTROL nGridC2; |FINSI;
          |SI #13#9 = "C"; |REFRESCACONTROL nGridC4; |FINSI;
          |SI #13#9 = "P";
               |HAZ CargaPdte;
               |HAZ Tiene3;
               |REFRESCACONTROL nGridC3;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO LinPdte;
     |SI nSwBtnLin = 3;
          |SI #14#14 ! "01.01.0000";
               |SALVA_DATOS #14;
               |REPON_DATOS #referl2@;
               |GRABA 020#referl2@.n;
          |FINSI;
     |FINSI;
     |SI nSwBtnLin = 2;
          |SI #14#14 = "01.01.0000";
               |SALVA_DATOS #14;
               |REPON_DATOS #referl2@;
               |GRABA 020#referl2@.n;
          |FINSI;
     |FINSI;
     |SI nSwBtnLin = 1;
          |SALVA_DATOS #14;
          |REPON_DATOS #referl2@;
          |GRABA 020#referl2@.n;
     |FINSI;
|FPRC;

|DEFBUCLE LinPdte;
     #14#1;
     ;
     aSer, nNum, "                    ";
     aSer, nNum, "zzzzzzzzzzzzzzzzzzzz";
     ;
     NULL, LinPdte;
|FIN;

|PROCESO CargaLin;
     |PULSATECLA;
     |CIERRA #referl2@; |DELINDEX #referl2@; |ABRE #referl2@;
     aSer = #referc2@#0;
     nNum = #referc2@#1;
     |SI nSwBtnLin = 1;
          |ESTADO_CONTROL nBtnTodos, "DISABLE";
          |ESTADO_CONTROL nBtnPdte, "ENABLE";
          |ESTADO_CONTROL nBtnRecogidos, "ENABLE";
          |BUCLE LinPdte;
     |FINSI;
     |SI nSwBtnLin = 2;
          |ESTADO_CONTROL nBtnTodos, "ENABLE";
          |ESTADO_CONTROL nBtnPdte, "DISABLE";
          |ESTADO_CONTROL nBtnRecogidos, "ENABLE";
          |BUCLE LinPdte;
     |FINSI;
     |SI nSwBtnLin = 3;
          |ESTADO_CONTROL nBtnTodos, "ENABLE";
          |ESTADO_CONTROL nBtnPdte, "ENABLE";
          |ESTADO_CONTROL nBtnRecogidos, "DISABLE";
          |BUCLE LinPdte;
     |FINSI;
     |LEE 000#referl2@.p;
     |SI FSalida = 0;
          |ESTADO_CONTROL nBtnRecoCli, "ENABLE";
          |ESTADO_CONTROL nBtnObserva, "ENABLE";
          |ESTADO_CONTROL nBtnTrabajo, "ENABLE";
          |ESTADO_CONTROL nBtnCaracteris, "ENABLE";
          |ESTADO_CONTROL nBtnAnula, "ENABLE";
          |ESTADO_CONTROL nBtnBorNada, "ENABLE";
          |ESTADO_CONTROL nBtnCerApt, "ENABLE";
          |ESTADO_CONTROL nBtnCamSerie, "ENABLE";
          |ESTADO_CONTROL nBtnEtiqueta, "ENABLE";
          |ESTADO_CONTROL nBtnResumen, "ENABLE";
          |ESTADO_CONTROL nBtnIncidencia, "ENABLE";
     |SINO;
          |ESTADO_CONTROL nBtnRecoCli, "DISABLE";
          |ESTADO_CONTROL nBtnObserva, "DISABLE";
          |ESTADO_CONTROL nBtnTrabajo, "DISABLE";
          |ESTADO_CONTROL nBtnCaracteris, "DISABLE";
          |ESTADO_CONTROL nBtnAnula, "DISABLE";
          |ESTADO_CONTROL nBtnBorNada, "DISABLE";
          |ESTADO_CONTROL nBtnCerApt, "DISABLE";
          |ESTADO_CONTROL nBtnCamSerie, "DISABLE";
          |ESTADO_CONTROL nBtnEtiqueta, "DISABLE";
          |ESTADO_CONTROL nBtnResumen, "DISABLE";
          |ESTADO_CONTROL nBtnIncidencia, "DISABLE";
     |FINSI;
     |REFRESCACONTROL nGridL2;
|FPRC;

|PROCESO BtnTodos;
     nSwBtnLin = 1;
     |HAZ CargaLin;
|FPRC;

|PROCESO BtnPdte;
     nSwBtnLin = 2;
     |HAZ CargaLin;
|FPRC;

|PROCESO BtnRecogidos;
     nSwBtnLin = 3;
     |HAZ CargaLin;
|FPRC;

|PROCESO CargaPdte;
     #1#0 = "";
     |PARA i = 0; |SI i [ 37; |HACIENDO i = i + 1;
          nNume = i + 1;
          #1nNume = #13i;
     |SIGUE;
     |GRABA 020#1n;
|FPRC;

|DEFBUCLE CargaPdte;
     #13#3;
     ;
     "P", aDCli, nDDir, aDSis, aDZona, "     ", 000001;
     "P", aHCli, nHDir, aHSis, aHZona, "zzzzz", 999999;
     ;
     NULL, CargaPdte;
|FIN;

|PROCESO MinC1;
     #referc1@#4 = aDCli;
     #referc1@#6 = nDDir;
     #referc1@#8 = aDSis;
     #referc1@#37 = aDZona;
     #referc1@#0 = "     ";
     #referc1@#1 = 000001;
|FPRC;

|PROCESO MaxC1;
     #referc1@#4 = aHCli;
     #referc1@#6 = nHDir;
     #referc1@#8 = aHSis;
     #referc1@#37 = aHZona;
     #referc1@#0 = "zzzzz";
     #referc1@#1 = 999999;
|FPRC;

|PROCESO MinC2;
     #referc2@#9 = "A";
     #referc2@#4 = aDCli;
     #referc2@#6 = nDDir;
     #referc2@#8 = aDSis;
     #referc2@#37 = aDZona;
     #referc2@#0 = "     ";
     #referc2@#1 = 000001;
|FPRC;

|PROCESO MaxC2;
     #referc2@#9 = "A";
     #referc2@#4 = aHCli;
     #referc2@#6 = nHDir;
     #referc2@#8 = aHSis;
     #referc2@#37 = aHZona;
     #referc2@#0 = "zzzzz";
     #referc2@#1 = 999999;
|FPRC;

|PROCESO MinC4;
     #referc4@#9 = "C";
     #referc4@#4 = aDCli;
     #referc4@#6 = nDDir;
     #referc4@#8 = aDSis;
     #referc4@#37 = aDZona;
     #referc4@#0 = "     ";
     #referc4@#1 = 000001;
|FPRC;

|PROCESO MaxC4;
     #referc4@#9 = "C";
     #referc4@#4 = aHCli;
     #referc4@#6 = nHDir;
     #referc4@#8 = aHSis;
     #referc4@#37 = aHZona;
     #referc4@#0 = "zzzzz";
     #referc4@#1 = 999999;
|FPRC;

|PROCESO Grids;
     |SI nPrime = 1;
          aDCli = "      "; aHCli = "zzzzzz";
          |SI #0#0 ! "000000";
               aDCli = #0#0;
               aHCli = #0#0;
          |FINSI;
          nDDir = 1; nHDir = 9999;
          |SI #0#1 ! 0;
               nDDir = #0#1;
               nHDir = #0#1;
          |FINSI;
          aDSis = "    "; aHSis = "zzzz";
          |SI #0#2 ! "    ";
               aDSis = #0#2;
               aHSis = #0#2;
          |FINSI;
          aDZona = "     "; aHZona = "zzzzz";
          |SI #0#6 ! "     ";
               aDZona = #0#6;
               aHZona = #0#6;
          |FINSI;
          |CIERRAT #1; |DELINDEX #1; |ABRET #1;
          |BUCLE CargaPdte;
          |HAZ Tiene2;
          |LEE 000#1p;
          |HAZ Tiene3;
          |HAZ Tiene4;
          aEstado = "ENABLE"; |HAZ Bloquea;
          |HAZ Tiene1;
     |FINSI;
     nPrime = 1;

     #referc1@#1 = 0;
     |PINPA #1#0; nPanta1 = FSalida;
     nRango = 4 + 8 + 16 + 32;
     |LINEAL_SIMPLE #1#referl1@, nRango, 1801, 2698, MinL1, MaxL1, EvtL1;
     nGridL1 = FSalida;
     |SI #0#6 = "     ";
          |LINEAL_SIMPLE #2#referc1@, nRango, 0701, 1698, MinC1, MaxC1, EvtC1;
     |SINO;
          |LINEAL_SIMPLE #7#referc1@, nRango, 0701, 1698, MinC1, MaxC1, EvtC1;
     |FINSI;
     nGridC1 = FSalida;

     #referc2@#1 = 0;
     |PINPA #2#0; nPanta2 = FSalida;
     |SI nSwJava = 1;
          |LINEAL_SIMPLE #1#referl2@, nRango, 2001, 2598, MinL2, MaxL2, EvtL2;
     |SINO;
          |LINEAL_SIMPLE #1#referl2@, nRango, 1901, 2598, MinL2, MaxL2, EvtL2;
     |FINSI;
     nGridL2 = FSalida;
     |SI #0#6 = "     ";
          |LINEAL_SIMPLE #3#referc2@, nRango, 0701, 1598, MinC2, MaxC2, EvtC2;
     |SINO;
          |LINEAL_SIMPLE #8#referc2@, nRango, 0701, 1598, MinC2, MaxC2, EvtC2;
     |FINSI;
     nGridC2 = FSalida;

     #1#2 = 0;
     |PINPA #3#0; nPanta3 = FSalida;
     |LINEAL_SIMPLE #1#referl3@, nRango, 1801, 2698, MinL3, MaxL3, EvtL3;
     nGridL3 = FSalida;
     |LINEAL_SIMPLE #1#1, nRango, 0701, 1698, NULL, NULL, EvtC3;
     nGridC3 = FSalida;

     #referc4@#1 = 0;
     |PINPA #4#0; nPanta4 = FSalida;
     |LINEAL_SIMPLE #1#referl4@, nRango, 1801, 2598, MinL4, MaxL4, EvtL4;
     nGridL4 = FSalida;
     |SI #0#6 = "     ";
          |LINEAL_SIMPLE #3#referc4@, nRango, 0701, 1698, MinC4, MaxC4, EvtC4;
     |SINO;
          |LINEAL_SIMPLE #8#referc4@, nRango, 0701, 1698, MinC4, MaxC4, EvtC4;
     |FINSI;
     nGridC4 = FSalida;
|FPRC;

|PROCESO BtnActualiza;
     |REFERENCIA_DEF aGet1, #0;
     aGet2  = 0;    || numero de campo
     IaGet = aGet1<-;
     |ESPECIFICA "GETDATACONTROL", aGet;
     aAlfa = FSalida; |QBT aAlfa;
     aAlfa = ("000000" + aAlfa) % -106;
     #0#0 = aAlfa; |PINTA #0#0;

     |REFERENCIA_DEF aGet1, #0;
     aGet2  = 1;    || numero de campo
     IaGet = aGet1<-;
     |ESPECIFICA "GETDATACONTROL", aGet;
     aAlfa = FSalida; |QBT aAlfa;
     #0#1 = aAlfa; |PINTA #0#0;

     |REFERENCIA_DEF aGet1, #0;
     aGet2  = 2;    || numero de campo
     IaGet = aGet1<-;
     |ESPECIFICA "GETDATACONTROL", aGet;
     aAlfa = FSalida; |QBT aAlfa;
     #0#2 = aAlfa; |PINTA #0#2;

     |REFERENCIA_DEF aGet1, #0;
     aGet2  = 6;    || numero de campo
     IaGet = aGet1<-;
     |ESPECIFICA "GETDATACONTROL", aGet;
     aAlfa = FSalida; |QBT aAlfa;
     #0#6 = aAlfa; |PINTA #0#6;

     |HAZ Descri;

     |DESTRUYECONTROL nGridC1;
     |DESTRUYECONTROL nGridC2;
     |DESTRUYECONTROL nGridC4;
     |DESTRUYECONTROL nGridC3;
     |PULSATECLA;

     |HAZ Grids;

     |PULSATECLA;
     |FOCOTECLADO nGridC2;
|FPRC;

|PROCESO BtnSalir;
     |PTEC 807;
|FPRC;

|PROCESO Min30;
     #30#0 = #0#0;
     #30#1 = 0001;
|FPRC;

|PROCESO Max30;
     #30#0 = #0#0;
     #30#1 = 9999;
|FPRC;

|PROCESO Dir66; |TIPO 66;
     |ABRE #30;
     #30#0 = #0#0;
     #30#1 = #0#1;
     |LEE 000#30];
     |CONSULTA_F_CLAVE #1#30, Min30, Max30;
     |SI FSalida = 0;
          #0#1 = #30#1;
     |SINO;
          |ERROR;
     |FINSI;
     |CIERRA #30;
|FPRC;

|PROCESO Descri;
     |ABRE #24;
     #24#0 = #0#0;
     |LEE 000#24=;
     |SI FSalida ! 0; |DDEFECTO #24; #24#2 = "No existe"; |FINSI;
     |CIERRA #24;
     |ABRE #30;
     #30#0 = #0#0;
     #30#1 = #0#1;
     |LEE 000#30=;
     |SI FSalida ! 0; |DDEFECTO #30; #30#10 = "No existe"; |FINSI;
     |CIERRA #30;
     |ABRE #3;
     #3#0 = #0#2;
     |LEE 000#3=;
     |SI FSalida ! 0; |DDEFECTO #3; #3#1 = "No existe"; |FINSI;
     |CIERRA #3;
     |ABRE #1000;
     #1000#0 = #0#6;
     |LEE 000#1000=;
     |SI FSalida ! 0; |DDEFECTO #1000; #1000#1 = "No existe"; |FINSI;
     |CIERRA #1000;

     #0#3 = #24#2; |PINTA #0#3;
     #0#4 = #30#10; |PINTA #0#4;
     #0#5 = #3#1; |PINTA #0#5;
     #0#7 = #1000#1; |PINTA #0#7;
     |SI #0#0 = "000000";
          #0#1 = 0; |PINTA #0#1;
          #0#3 = "<Todos los clientes>";
     |FINSI;
     |SI #0#1 = 0;
          #0#2 = ""; |PINTA #0#2;
          #0#4 = "<Todas las direcciones>";
     |FINSI;
     |SI #0#2 = "    ";
          #0#5 = "<Todos los sistemas>";
     |FINSI;
     |SI #0#6 = "     ";
          #0#7 = "<Todas las zonas>";
     |FINSI;
     |PINTA #0#3;
     |PINTA #0#4;
     |PINTA #0#5;
     |PINTA #0#7;
|FPRC;

|PROCESO Tipo0; |TIPO 0;
     |C_M #0Campo, 0, aAlfa;
     |SI aAlfa = "N"; |ACABA; |FINSI;

     |HAZ Descri;

     |SI Campo ! 6;
          |C_M #0#1, 1, "S"; |PINTA #0#1;
          |C_M #0#2, 1, "S"; |PINTA #0#2;
     |FINSI;

     |SI Campo = 0;
          |SI #0#0 = "000000";
               |C_M #0#1, 1, "N"; |PINTA #0#1;
               |C_M #0#2, 1, "N"; |PINTA #0#2;
          |FINSI;
     |FINSI;
     |SI Campo = 1;
          |SI #0#1 = 0;
               |C_M #0#2, 1, "N"; |PINTA #0#2;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Tiene;
     nHayLin = 1;
     |ERROR10;
|FPRC;

|DEFBUCLE Tiene4_C3;
     #13#3;
     ;
     "C", aDCli, nDDir, aDSis, aDZona, "     ", 000001;
     "C", aHCli, nHDir, aHSis, aHZona, "zzzzz", 999999;
     ;
     NULL, Tiene;
|FIN;

|DEFBUCLE Tiene4_C8;
     #13#8;
     ;
     aDZona, "C", aDCli, nDDir, aDSis, "     ", 000001;
     aHZona, "C", aHCli, nHDir, aHSis, "zzzzz", 999999;
     ;
     NULL, Tiene;
|FIN;

|PROCESO Tiene4;
     nHayLin = 0;
     |SI #0#6 = "     ";
          |BUCLE Tiene4_C3;
     |SINO;
          |BUCLE Tiene4_C8;
     |FINSI;
     |SI nHayLin = 0;
          |ESTADO_CONTROL nBtnReabrir, "DISABLE";
          |ESTADO_CONTROL nBtnImpAlb, "DISABLE";
          |ESTADO_CONTROL nBtnImpFac, "DISABLE";
          |ESTADO_CONTROL nBtnImpCer, "DISABLE";
          |ESTADO_CONTROL nBtnImpEti, "DISABLE";
     |SINO;
          |ESTADO_CONTROL nBtnReabrir, "ENABLE";
          |ESTADO_CONTROL nBtnImpAlb, "ENABLE";
          |ESTADO_CONTROL nBtnImpFac, "ENABLE";
          |ESTADO_CONTROL nBtnImpCer, "ENABLE";
          |ESTADO_CONTROL nBtnImpEti, "ENABLE";
     |FINSI;
|FPRC;

|PROCESO Tiene3;
     |SI FSalida = 0;
          |ESTADO_CONTROL nBtnMarca, "ENABLE";
          |ESTADO_CONTROL nBtnMarcaTodo, "ENABLE";
          |ESTADO_CONTROL nBtnPasar, "ENABLE";
          |ESTADO_CONTROL nBtnFactu, "ENABLE";
     |SINO;
          |ESTADO_CONTROL nBtnMarca, "DISABLE";
          |ESTADO_CONTROL nBtnMarcaTodo, "DISABLE";
          |ESTADO_CONTROL nBtnPasar, "DISABLE";
          |ESTADO_CONTROL nBtnFactu, "DISABLE";
     |FINSI;
|FPRC;

|DEFBUCLE Tiene2_C3;
     #13#3;
     ;
     "A", aDCli, nDDir, aDSis, aDZona, "     ", 000001;
     "A", aHCli, nHDir, aHSis, aHZona, "zzzzz", 999999;
     ;
     NULL, Tiene;
|FIN;

|DEFBUCLE Tiene2_C8;
     #13#8;
     ;
     aDZona, "A", aDCli, nDDir, aDSis, "     ", 000001;
     aHZona, "A", aHCli, nHDir, aHSis, "zzzzz", 999999;
     ;
     NULL, Tiene;
|FIN;

|PROCESO Tiene2;
     nHayLin = 0;
     |SI #0#6 = "     ";
          |BUCLE Tiene2_C3;
     |SINO;
          |BUCLE Tiene2_C8;
     |FINSI;
     |SI nHayLin = 0;
          |ESTADO_CONTROL nBtnCerrar, "DISABLE";
          |ESTADO_CONTROL nBtnBorrar, "DISABLE";
          |ESTADO_CONTROL nBtnModificar, "DISABLE";
          |ESTADO_CONTROL nBtnMateDeja, "DISABLE";
          |ESTADO_CONTROL nBtnMateExtra, "DISABLE";
          |ESTADO_CONTROL nBtnPresu, "DISABLE";
          |ESTADO_CONTROL nBtnPedido, "DISABLE";
          |ESTADO_CONTROL nBtnVerCom, "DISABLE";
     |SINO;
          |ESTADO_CONTROL nBtnCerrar, "ENABLE";
          |ESTADO_CONTROL nBtnBorrar, "ENABLE";
          |ESTADO_CONTROL nBtnModificar, "ENABLE";
          |ESTADO_CONTROL nBtnMateDeja, "ENABLE";
          |ESTADO_CONTROL nBtnMateExtra, "ENABLE";
          |ESTADO_CONTROL nBtnPresu, "ENABLE";
          |ESTADO_CONTROL nBtnPedido, "ENABLE";
          |ESTADO_CONTROL nBtnVerCom, "ENABLE";
     |FINSI;
|FPRC;

|DEFBUCLE Tiene1_C2;
     #13#2;
     ;
     aDCli, nDDir, aDSis, aDZona, "     ", 000001;
     aHCli, nHDir, aHSis, aHZona, "zzzzz", 999999;
     ;
     NULL, Tiene;
|FIN;

|DEFBUCLE Tiene1_C7;
     #13#7;
     ;
     aDZona, aDCli, nDDir, aDSis, "     ", 000001;
     aHZona, aHCli, nHDir, aHSis, "zzzzz", 999999;
     ;
     NULL, Tiene;
|FIN;

|PROCESO Tiene1;
     nHayLin = 0;
     |SI #0#6 = "     ";
          |BUCLE Tiene1_C2;
     |SINO;
          |BUCLE Tiene1_C7;
     |FINSI;
     |SI nHayLin = 0;
          |ESTADO_CONTROL nBtnSele, "DISABLE";
     |SINO;
          |ESTADO_CONTROL nBtnSele, "ENABLE";
     |FINSI;
|FPRC;

|PROCESO EvtC1;
     nSal = FSalida;
     |HAZ Tiene1;
     |SI nSal = 1; |O nSal = 2;
          |LEE 000#referc1@.=;
          |REFRESCACONTROL nGridL1;
     |FINSI;
|FPRC;

|PROCESO EvtL1;
     |SI FSalida = 1; |O FSalida = 2;
          |LEE 000#referl1@.=;
     |FINSI;
|FPRC;

|PROCESO MinL1;
     #referl1@#0 = #referc1@#0;
     #referl1@#1 = #referc1@#1;
     #referl1@#2 = "                    ";
|FPRC;

|PROCESO MaxL1;
     #referl1@#0 = #referc1@#0;
     #referl1@#1 = #referc1@#1;
     #referl1@#2 = "zzzzzzzzzzzzzzzzzzzz";
|FPRC;

|PROCESO EvtC2;
     nSal = FSalida;
     |HAZ Tiene2;
     |SI nSal = 1; |O nSal = 2;
          |LEE 000#referc2@.=;
          |HAZ CargaLin;
     |FINSI;
|FPRC;

|PROCESO EvtL2;
     |SI FSalida = 1; |O FSalida = 2;
          |LEE 000#referl2@.=;
     |FINSI;
|FPRC;

|PROCESO MinL2;
     #referl2@#0 = #referc2@#0;
     #referl2@#1 = #referc2@#1;
     #referl2@#2 = "                    ";
|FPRC;

|PROCESO MaxL2;
     #referl2@#0 = #referc2@#0;
     #referl2@#1 = #referc2@#1;
     #referl2@#2 = "zzzzzzzzzzzzzzzzzzzz";
|FPRC;

|PROCESO EvtC4;
     nSal = FSalida;
     |HAZ Tiene4;
     |SI nSal = 1; |O nSal = 2;
          |LEE 000#referc4@.=;
          |REFRESCACONTROL nGridL4;
     |FINSI;
|FPRC;

|PROCESO EvtL4;
     |SI FSalida = 1; |O FSalida = 2;
          |LEE 000#referl4@.=;
     |FINSI;
|FPRC;

|PROCESO MinL4;
     #referl4@#0 = #referc4@#0;
     #referl4@#1 = #referc4@#1;
     #referl4@#2 = "                    ";
|FPRC;

|PROCESO MaxL4;
     #referl4@#0 = #referc4@#0;
     #referl4@#1 = #referc4@#1;
     #referl4@#2 = "zzzzzzzzzzzzzzzzzzzz";
|FPRC;

|PROCESO EvtC3;
     |SI FSalida = 1; |O FSalida = 2;
          |LEE 000#1=;
          |REFRESCACONTROL nGridL3;
     |FINSI;
     |SI FSalida = 4;
          |HAZ BtnMarca;
     |FINSI;
|FPRC;

|PROCESO EvtL3;
     |SI FSalida = 1; |O FSalida = 2;
          |LEE 000#referl3@.=;
     |FINSI;
|FPRC;

|PROCESO MinL3;
     #referl3@#0 = #1#1;
     #referl3@#1 = #1#2;
     #referl3@#2 = "                    ";
|FPRC;

|PROCESO MaxL3;
     #referl3@#0 = #1#1;
     #referl3@#1 = #1#2;
     #referl3@#2 = "zzzzzzzzzzzzzzzzzzzz";
|FPRC;

|PROCESO Tipo12; |TIPO 12;
|FPRC;

|PROCESO Bloquea;
     || bloquea/desbloquea todas las pesta¤as
     aAlfa = nPanta1;
     |MAINCOMMAND 32913, "-1", "-1", aAlfa, "-1", "-1";
     |SI FSalida > 0;
          nPestana = FSalida;
          |ESTADO_CONTROL nPestana, aEstado;
     |FINSI;
     |ESTADO_CONTROL nBtnAbrir, aEstado;
     |ESTADO_CONTROL nBtnSele, aEstado;
     |ESTADO_CONTROL nBtnSalir, aEstado;
|FPRC;

|PROCESO Txt;
     nError = 0;
     aFecha = ""; aHora = "";
     |XABRE "", aFicTxt, nHandle;
     |SI FSalida = 0;
          |XLEE nHandle, 250, aFecha;
          |XLEE nHandle, 250, aHora;
          |XCIERRA nHandle;
     |FINSI;
     |SI aFecha ! "";
          aAlfa = "0000NYa hay una sesi¢n de partes de revisi¢n abierta el " + aFecha + " a las " + aHora + "." + &13 + "¨Seguro que desea entrar a esta sesi¢n?";
          |CONFI aAlfa;
          nError = FSalida;
     |FINSI;
     |SI nError = 0;
          |FBORRA aFicTxt;
          fHoy = ~; aFecha = fHoy;
          |HORA aHora;
          |XABRE "W", aFicTxt, nHandle;
          |SI FSalida = 0;
               |XGRABA nHandle, aFecha;
               |XGRABA nHandle, aHora;
               |XCIERRA nHandle;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO LeeTempo;
     |DFICE aFic;
     aFic = aFic + Tempo;
     |XABRE "", aFic, nHandle;
     |SI FSalida = 0;
          |XLEE nHandle, 250, aAlfa;
          aSerie = aAlfa % 105;
          aAlfa = aAlfa % 6;
          nNumero = aAlfa;
          |XCIERRA nHandle;
          |FBORRA aFic;
     |FINSI;
|FPRC;

|PROGRAMA;
     |VERSIONRTME aAlfa;
     aAlfa = aAlfa - "JAVA";
     |SI FSalida > 0; nSwJava = 1; |FINSI;

     |ABRE #18; |LEE 000#18p; |CIERRA #18;
     |ABRE #142; |LEE 000#142p; |CIERRA #142;
     |DDEF aDef;
     aAlfa = aDef + "extm0013"; |CARGA_DEF aAlfa, referc1@;
     aAlfa = aDef + "extm0013"; |CARGA_DEF aAlfa, referc2@;
     aAlfa = aDef + "extm0013"; |CARGA_DEF aAlfa, referc4@;
     aAlfa = aDef + "extm0014"; |CARGA_DEF aAlfa, referl1@;
     aAlfa = aDef + "extm0014"; |CARGA_DEF aAlfa, referl2@;
     aAlfa = aDef + "extm0014"; |CARGA_DEF aAlfa, referl4@;
     aAlfa = aDef + "extm0014"; |CARGA_DEF aAlfa, referl3@;
     |HAZ CreaTempo; aTmp1 = Tempo; |NOME_DAT #1Tempo; |DELINDEX #1;
     |HAZ CreaTempo; aTmp2 = Tempo; |NOME_DAT #referl2@#Tempo#; |DELINDEX #referl2@;
     |ABRET #1;
     |ABRE #referc1@;
     |ABRE #referc2@;
     |ABRE #referc4@;
     |ABRE #referl1@;
     |ABRE #referl2@;
     |ABRE #referl4@;
     |ABRE #referl3@;

     |PINPA #0#0; nPanta0 = FSalida; |PINDA #0#0;
     |CONTROL_SIMPLE nPanta0, "BOTON,Actualizar", 1002, 1011, BtnActualiza;

     |PINPA #1#0; nPanta1 = FSalida; |PINDA #1#0;
     |CONTROL_SIMPLE nPanta1, "BOTON,Abrir", 0602, 0612, BtnAbrir;
     nBtnAbrir = FSalida;
     |CONTROL_SIMPLE nPanta1, "BOTON,Seleccionar", 0614, 0624, BtnSele;
     nBtnSele = FSalida;
     |CONTROL_SIMPLE nPanta1, "BOTON,{{001}}Salir", 2888, 2898, BtnSalir;
     nBtnSalir = FSalida;

     |PINPA #2#0; nPanta2 = FSalida; |PINDA #2#0;
     |CONTROL_SIMPLE nPanta2, "BOTON,Cerrar", 0602, 0612, BtnCerrar;
     nBtnCerrar = FSalida;
     |CONTROL_SIMPLE nPanta2, "BOTON,Borrar", 0613, 0623, BtnBorrar;
     nBtnBorrar = FSalida;
     |CONTROL_SIMPLE nPanta2, "BOTON,Modificar", 0624, 0634, BtnModificar;
     nBtnModificar = FSalida;
     |CONTROL_SIMPLE nPanta2, "BOTON,Material dejado", 0635, 0647, BtnMateDeja;
     nBtnMateDeja = FSalida;
     |CONTROL_SIMPLE nPanta2, "BOTON,Material extra", 0648, 0660, BtnMateExtra;
     nBtnMateExtra = FSalida;
     |CONTROL_SIMPLE nPanta2, "BOTON,Presupuesto", 0661, 0673, BtnPresu;
     nBtnPresu = FSalida;
     |CONTROL_SIMPLE nPanta2, "BOTON,Pedido", 0674, 0686, BtnPedido;
     nBtnPedido = FSalida;
     |CONTROL_SIMPLE nPanta2, "BOTON,{{155}}Completo", 0687, 0698, BtnVerCom;
     nBtnVerCom = FSalida;

     |CONTROL_SIMPLE nPanta2, "BOTON,Recogida cliente", 1702, 1717, BtnRecoCli;
     nBtnRecoCli = FSalida;
     |CONTROL_SIMPLE nPanta2, "BOTON,Trabajo", 1719, 1734, BtnTrabajo;
     nBtnTrabajo = FSalida;
     |CONTROL_SIMPLE nPanta2, "BOTON,Caracteristicas", 1736, 1751, BtnCaracteris;
     nBtnCaracteris = FSalida;
     |CONTROL_SIMPLE nPanta2, "BOTON,Anular situaci¢n", 1753, 1768, BtnAnula;
     nBtnAnula = FSalida;
     |CONTROL_SIMPLE nPanta2, "BOTON,Borrar 'no se hace nada'", 1770, 1790, BtnBorNada;
     nBtnBorNada = FSalida;

     |CONTROL_SIMPLE nPanta2, "BOTON,Observaciones", 1802, 1817, BtnObserva;
     nBtnObserva = FSalida;
     |CONTROL_SIMPLE nPanta2, "BOTON,Cambiar n§ serie", 1819, 1834, BtnCamSerie;
     nBtnCamSerie = FSalida;
     |CONTROL_SIMPLE nPanta2, "BOTON,Certificado aptitud", 1836, 1851, BtnCerApt;
     nBtnCerApt = FSalida;
     |CONTROL_SIMPLE nPanta2, "BOTON,Etiqueta", 1853, 1868, BtnEtiqueta;
     nBtnEtiqueta = FSalida;

     |SI nSwJava = 1;
          |CONTROL_SIMPLE nPanta2, "BOTON,Todos", 2702, 2717, BtnTodos;
          nBtnTodos = FSalida;
          |CONTROL_SIMPLE nPanta2, "BOTON,Pdte recoger", 2719, 2734, BtnPdte;
          nBtnPdte = FSalida;
          |CONTROL_SIMPLE nPanta2, "BOTON,Recogidos", 2736, 2751, BtnRecogidos;
          nBtnRecogidos = FSalida;
          |CONTROL_SIMPLE nPanta2, "BOTON,Resumen", 2753, 2768, BtnResumen;
          nBtnResumen = FSalida;
          |CONTROL_SIMPLE nPanta2, "BOTON,Incidencia", 2770, 2785, BtnIncidencia;
          nBtnIncidencia = FSalida;
     |SINO;
          |CONTROL_SIMPLE nPanta2, "BOTON,Todos", 2602, 2617, BtnTodos;
          nBtnTodos = FSalida;
          |CONTROL_SIMPLE nPanta2, "BOTON,Pdte recoger", 2619, 2634, BtnPdte;
          nBtnPdte = FSalida;
          |CONTROL_SIMPLE nPanta2, "BOTON,Recogidos", 2636, 2651, BtnRecogidos;
          nBtnRecogidos = FSalida;
          |CONTROL_SIMPLE nPanta2, "BOTON,Resumen", 2653, 2668, BtnResumen;
          nBtnResumen = FSalida;
          |CONTROL_SIMPLE nPanta2, "BOTON,Incidencia", 2670, 2685, BtnIncidencia;
          nBtnIncidencia = FSalida;
     |FINSI;

     |CONTROL_SIMPLE nPanta2, "BOTON,{{001}}Salir", 2888, 2898, BtnSalir;

     |PINPA #3#0; nPanta3 = FSalida; |PINDA #3#0;
     |CONTROL_SIMPLE nPanta3, "BOTON,Marcar/Desmarcar", 0602, 0622, BtnMarca;
     nBtnMarca = FSalida;
     |CONTROL_SIMPLE nPanta3, "BOTON,Marcar/Desmarcar todos", 0624, 0644, BtnMarcaTodo;
     nBtnMarcaTodo = FSalida;
     |CONTROL_SIMPLE nPanta3, "BOTON,Pasar a abiertos", 0646, 0666, BtnPasar;
     nBtnPasar = FSalida;
     |CONTROL_SIMPLE nPanta3, "BOTON,Facturar", 0668, 0678, BtnFactu;
     nBtnFactu = FSalida;
     |CONTROL_SIMPLE nPanta3, "BOTON,{{001}}Salir", 2888, 2898, BtnSalir;

     |PINPA #4#0; nPanta4 = FSalida; |PINDA #4#0;
     |CONTROL_SIMPLE nPanta4, "BOTON,Reabrir", 0602, 0612, BtnReabrir;
     nBtnReabrir = FSalida;
     |CONTROL_SIMPLE nPanta4, "BOTON,{{205}}Imprimir Albar n", 0614, 0629, BtnImpAlb;
     nBtnImpAlb = FSalida;
     |CONTROL_SIMPLE nPanta4, "BOTON,{{205}}Imprimir Factura", 0631, 0646, BtnImpFac;
     nBtnImpFac = FSalida;
     |CONTROL_SIMPLE nPanta4, "BOTON,{{205}}Imprimir certificado", 0648, 0663, BtnImpCer;
     nBtnImpCer = FSalida;
     |SI nSwJava = 1;
          |CONTROL_SIMPLE nPanta4, "BOTON,{{205}}Etiqueta", 2702, 2717, BtnImpEti;
     |SINO;
          |CONTROL_SIMPLE nPanta4, "BOTON,{{205}}Etiqueta", 2602, 2617, BtnImpEti;
     |FINSI;
     nBtnImpEti = FSalida;
     |CONTROL_SIMPLE nPanta4, "BOTON,{{001}}Salir", 2888, 2898, BtnSalir;

     |ABRE #23;
     #23#0 = Usuario % 810;
     |LEE 000#23=;
     |SI FSalida ! 0; |DDEFECTO #23; |FINSI;
     |CIERRA #23;
     #0#6 = #23#1; |PINTA #0#6;
     |HAZ Descri;
     |SI #0#6 ! "     "; |C_M #0#6, 1, "N"; |FINSI;

     aEstado = "DISABLE"; |HAZ Bloquea;

     |HAZ Grids;

     |DFICE aFicTxt; aFicTxt = aFicTxt + (Usuario % 810) + ".txt";
     |HAZ Txt;
     |SI nError = 0;
          |PARA FSalida = 0; |SI FSalida = 0; |HACIENDO;
               FSalida = "::ENDATOS::SINBOTONES::";
               |ENDATOS #1#0;
          |SIGUE;
          |FBORRA aFicTxt;
     |FINSI;

     |CIERRAT #1;
     |CIERRA #referl3@;
     |CIERRA #referl4@;
     |CIERRA #referl2@;
     |CIERRA #referl1@;
     |CIERRA #referc4@;
     |CIERRA #referc2@;
     |CIERRA #referc1@;

     Tempo = aTmp1; |HAZ BoraTempo; |DELINDEX #1;
     Tempo = aTmp2; |HAZ BoraTempo; |DELINDEX #referl2@;

     |PULSATECLA;

     |DESCARGA_DEF #referl3@;
     |DESCARGA_DEF #referl4@;
     |DESCARGA_DEF #referl2@;
     |DESCARGA_DEF #referl1@;
     |DESCARGA_DEF #referc4@;
     |DESCARGA_DEF #referc2@;
     |DESCARGA_DEF #referc1@;
|FPRO;
