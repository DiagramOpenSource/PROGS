     Lo llama el agifa189

|FICHEROS;
     agifa189 #0;
     tempo044 #1;
     goprepec #2;
     goprepel #3;
     gomantho #4;
     gomantl1 #5;
     gopartia #6;
     gopre001 #7;
     gopre004 #8;
     goparame #10;
     agifa017 #17;
     agifa019 #19;
     guerm025 #25;
     dsm00054 #54;
     dsm00055 #55;
     agifa074 #74;
     agifa090 #90;
|FIN;

|VARIABLES;
     &enForma = 0;
     &eaFicArtic = "";
     &eaFicCompo = "";
     nUni1 = 0;
     nUni2 = 0;
     aPrepe = "";
     aLinea = "";
     nLin = 0;
     nPreVta = 0;
     nPreCom = 0;
     aSerExp = "";
     nNumExp = 0;
     nConta = 0;
     nAlm1 = 0;
     nAlm2 = 0;
     nAlma = 0;
|FIN;

|PROCESO MoviTermina;
     nAlm1 = #3#33;
     nAlm2 = #10#51;

     |ABRE #54;
     |DDEFECTO #54;
     #54#2 = #25#0;
     #54#0 = #25#1;
     |LEE 101#54=;
     |SI FSalida ! 0; |GRABA 020#54n; |FINSI;
     |CIERRA #54;

     |ABRE #55;
     #55#28 = #54#2;
     #55#27 = #54#0;
     #55#11 = 99999;
     |LEE 000#55];
     |SI FSalida = 0;
          |LEE 000#55a;
     |SINO;
          |LEE 000#55u;
     |FINSI;
     |SI FSalida = 0; |Y #55#28 = #54#2;  |Y #55#27 = #54#0;
          nConta = #55#11 + 1;
     |SINO;
          nConta = 1;
     |FINSI;

     |DDEFECTO #55;
     #55#28 = #54#2;
     #55#27 = #54#0;
     #55#11 = nConta;
     #55#0 = #19#0;
     #55#1 = nAlm1;    ||Alm Sal = Comp
     #55#2 = #19#1;

     |ABRE #17;
     #17#0 = #19#0;
     #17#1 = nAlm2;
     |LEE 000#17=;

     #55#7 = #19#6;
     #55#3 = #17#5;
     #55#4 = nUni1;
     #55#5 = nAlm2;    ||Alm Ent = Depo
     #55#9 = #17#41;

     #17#1 = nAlm2;
     |LEE 000#17=;
     |CIERRA #17;

     #55#6 = #17#5;
     #55#8 = #54#1;
     #55#10 = #17#41;
     |GRABA 020#55n;
     |CIERRA #55;
     enForma = 1;
     |HAZ AcumulaME_MS;
|FPRC;

|PROCESO ReservaTermina;
     aSerExp = #2#3; nNumExp = #2#7; || Exp del prepedido
     |HAZ BuscaPresu;

     ||#25#0 = #90#20;
     #25#0 = aSerExp;
     #25#1 = 999999;
     |LEE 000#25];
     |SI FSalida = 0;
          |LEE 000#25a;
     |SINO;
          |LEE 000#25u;
     |FINSI;
     |SI FSalida = 0; |Y #25#0 = #90#20;
          nConta = #25#1 + 1;
     |SINO;
          nConta = 1;
     |FINSI;


     |DDEFECTO #25;
     ||#25#0 = #90#20;
     #25#0 = aSerExp;
     #25#1 = nConta;
     #25#2 = ~;
     #25#3 = aSerExp;
     #25#4 = nNumExp;
     #25#18 = "S";
     #25#19 = #0#11;
     #25#20 = #0#0;
     #25#5 = #4#30;
     #25#6 = #4#31;
     #25#7 = #19#0;
     #25#8 = #19#1;
     #25#9 = nUni1;
     #25#10 = #3#0;
     #25#11 = #3#1;
     #25#14 = #3#33;  || Alma Com
     #25#15 = #10#51; || Alma Depo
     #25#17 = #25#9;
     #25#18 = "S";
     #25#19 = #90#20;
     #25#20 = #90#0;
     |GRABA 020#25n;
|FPRC;

|PROCESO MoviAlma;
     nAlm1 = #3#33;
     nAlm2 = #10#51;

     |ABRE #54;
     |DDEFECTO #54;
     #54#2 = #25#0;
     #54#0 = #25#1;
     |LEE 101#54=;
     |SI FSalida ! 0; |GRABA 020#54n; |FINSI;
     |CIERRA #54;

     |ABRE #55;
     #55#28 = #54#2;
     #55#27 = #54#0;
     #55#11 = 99999;
     |LEE 000#55];
     |SI FSalida = 0;
          |LEE 000#55a;
     |SINO;
          |LEE 000#55u;
     |FINSI;
     |SI FSalida = 0; |Y #55#28 = #54#2;  |Y #55#27 = #54#0;
          nConta = #55#11 + 1;
     |SINO;
          nConta = 1;
     |FINSI;

     |DDEFECTO #55;
     #55#28 = #54#2;
     #55#27 = #54#0;
     #55#11 = nConta;
     #55#0 = #3#2;
     #55#1 = nAlm1;    ||Alm Sal = Comp
     #55#2 = #3#3;

     |ABRE #17;
     #17#0 = #3#2;
     #17#1 = nAlm2;
     |LEE 000#17=;

     #55#7 = #19#6;
     #55#3 = #17#5;
     #55#4 = nUni1;
     #55#5 = nAlm2;    ||Alm Ent = Depo
     #55#9 = #17#41;

     #17#1 = nAlm2;
     |LEE 000#17=;
     |CIERRA #17;

     #55#6 = #17#5;
     #55#8 = #54#1;
     #55#10 = #17#41;
     |GRABA 020#55n;
     |CIERRA #55;
     enForma = 1;
     |HAZ AcumulaME_MS;
|FPRC;

|PROCESO ReservaAlma;
     #25#0 = #90#20;
     #25#1 = 999999;
     |LEE 000#25];
     |SI FSalida = 0;
          |LEE 000#25a;
     |SINO;
          |LEE 000#25u;
     |FINSI;
     |SI FSalida = 0; |Y #25#0 = #90#20;
          nConta = #25#1 + 1;
     |SINO;
          nConta = 1;
     |FINSI;

     aSerExp = #2#3; nNumExp = #2#7; || Exp del prepedido
     |HAZ BuscaPresu;

     |DDEFECTO #25;
     #25#0 = #90#20;
     #25#1 = nConta;
     #25#2 = ~;
     #25#3 = aSerExp;
     #25#4 = nNumExp;
     #25#18 = "S";
     #25#19 = #0#11;
     #25#20 = #0#0;
     #25#5 = #4#30;
     #25#6 = #4#31;
     #25#7 = #19#0;
     #25#8 = #19#1;
     #25#9 = nUni1;
     #25#10 = #3#0;
     #25#11 = #3#1;
     #25#14 = #3#33;  || Alma Com
     #25#15 = #10#51; || Alma Depo
     #25#17 = #25#9;
     #25#18 = "S";
     #25#19 = #90#20;
     #25#20 = #90#0;
     |GRABA 020#25n;
|FPRC;

|PROCESO UltGopartia;
     #6#34 = "A";
     #6#4 = #74#9;
     #6#5 = #74#0;
     #6#6 = #74#1;
     #6#7 = 999;
     |LEE 000#6];
     |SI FSalida = 0;
          |LEE 000#6a;
     |SINO;
          |LEE 000#6u;
     |FINSI;
     |SI FSalida = 0; |Y #6#34 = "A"; |Y #6#4 = #74#9; |Y #6#5 = #74#0; |Y #6#6 = #74#1;
          nLin = #6#7 + 1;
     |SINO;
          nLin = 1;
     |FINSI;
     |DDEFECTO #6;
     #6#34 = "A";
     #6#4 = #74#9;
     #6#5 = #74#0;
     #6#6 = #74#1;
     #6#7 = nLin;
     |GRABA 020#6b;
|FPRC;

|PROCESO BuscaPresu;
     |DDEFECTO #4;
     |DDEFECTO #5;
     |DDEFECTO #7;
     #4#0 = aSerExp;
     #4#1 = nNumExp;
     |LEE 020#4=;
     |SI FSalida = 0;
          #5#0 = #4#0;
          #5#1 = #4#1;
          #5#2 = 1;
          |LEE 020#5];
          |SI FSalida = 0; |Y #5#0 = #4#0; |Y #5#1 = #4#1;
               #7#0 = #5#3;
               #7#1 = #5#4;
               |LEE 020#7=;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO BuscaPrecio;
     nPreVta = #8#9;
     nPreCom = #8#10;
|FPRC;

|DEFBUCLE BuscaPrecio;
     #8#3;
     ;
     #7#0, #7#1, "                    ", #19#0;
     #7#0, #7#1, "zzzzzzzzzzzzzzzzzzzz", #19#0;
     ;
     NULL, BuscaPrecio;
|FIN;

|PROCESO BuscaExpeCentral;
     aSerExp = #4#0; nNumExp = #4#1;
     |ERROR10;
|FPRC;

|DEFBUCLE BuscaExpeCentral;
     #4#1;
     11;
     "     ", 000001, nAlma;
     "zzzzz", 999999, nAlma;
     ;
     NULL, BuscaExpeCentral;
|FIN;

|PROCESO DesAdjGopartia;
     |HAZ UltGopartia;
     nAlma = #3#33; ||Almacen linea prepedido = Almacen central
     |SI nAlma = 0; nAlma = #10#22; |FINSI;
     |BUCLE BuscaExpeCentral;
     |HAZ BuscaPresu;
     |BUCLE BuscaPrecio;
     |SI nPreVta = 0; nPreVta = #19#9; |FINSI;
     |SI nPreCom = 0; nPreCom = #19#9; |FINSI;

     #6#0 = #7#0;
     #6#1 = #7#1;
     #6#2 = aSerExp;
     #6#3 = nNumExp;
     #6#10 = -nUni1;
     #6#15 = #4#2;
     #6#16 = #4#8;
     #6#17 = #4#11;
     #6#18 = #4#12;
     #6#20 = #19#0;
     #6#21 = #7#7;
     #6#28 = ~;
     #6#30 = #19#1;
     #6#37 = nPreVta; #6#45 = nPreVta;
     #6#41 = nPreCom; #6#49 = nPreCom;
     |HAZ CalcuGopartia;
     |GRABA 020#6a;
     |LIBERA #6;
|FPRC;

|PROCESO AdjGopartia;
     |HAZ UltGopartia;
     aSerExp = #10#109; nNumExp = #10#114; || Exp Fabrica
     |HAZ BuscaPresu;
     |BUCLE BuscaPrecio;
     |SI nPreVta = 0; nPreVta = #19#9; |FINSI;
     |SI nPreCom = 0; nPreCom = #19#9; |FINSI;

     #6#0 = #7#0;
     #6#1 = #7#1;
     #6#2 = aSerExp;
     #6#3 = nNumExp;
     #6#10 = nUni1;
     #6#15 = #4#2;
     #6#16 = #4#8;
     #6#17 = #4#11;
     #6#18 = #4#12;
     #6#20 = #19#0;
     #6#21 = #7#7;
     #6#28 = ~;
     #6#30 = #19#1;
     #6#37 = nPreVta; #6#45 = nPreVta;
     #6#41 = nPreCom; #6#49 = nPreCom;
     |HAZ CalcuGopartia;
     |GRABA 020#6a;
     |LIBERA #6;
|FPRC;

|PROCESO Componentes;
     nUni1 = #1#5;
     nUni2 = #1#10;
     |SI #1#16 = "S";   || Multi
          nUni1 = #1#17;
          nUni2 = 0;
     |FINSI;

     |ABRE #19;
     #19#0 = #1#3;
     |LEE 020#19=;
     |CIERRA #19;

     aPrepe = #90#13 % 105;
     aLinea = #90#13 % 703;
     #3#0 = aPrepe;
     #3#1 = aLinea;
     |LEE 000#3=;
     |SI FSalida = 0;
          #2#0 = #3#0;
          |LEE 020#2=;
          |SI FSalida = 0;
               |HAZ AdjGopartia;
               |HAZ DesAdjGopartia;
          ||     |HAZ ReservaAlma;
               |HAZ MoviAlma;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE Componentes;
     #1#1;
     ;
     #0#11, #0#0, #0#1, 1;
     #0#11, #0#0, #0#1, 9999;
     ;
     NULL, Componentes;
|FIN;

|PROCESO Articulo;
     |SI #0#7 = 0; |Y #0#17 = 0;
          |ACABA;
     |FINSI;
     #74#9 = #0#11;
     #74#0 = #0#0;
     #74#1 = #0#1;
     |LEE 020#74=;
     |SI FSalida = 0; |Y #0#7 ! 0;
          #90#20 = #74#9;
          #90#0 = #74#0;
          |LEE 020#90=;
          |SI FSalida = 0;
               |BUCLE Componentes;

               aPrepe = #90#13 % 105;
               aLinea = #90#13 % 703;
               #3#0 = aPrepe;
               #3#1 = aLinea;
               |LEE 000#3=;
               |SI FSalida = 0;
                    #2#0 = #3#0;
                    |LEE 020#2=;
                    |SI FSalida = 0;
                         nUni1 = #0#7;
                         |ABRE #19;
                         #19#0 = #0#2;
                         |LEE 020#19=;
                         |CIERRA #19;

                         |HAZ ReservaTermina;
                         |HAZ MoviTermina;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE Articulo;
     #0#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Articulo;
|FIN;

|PROGRAMA;
     |ABRE #10; |LEE 000#10p; |CIERRA #10;

     |NOME_DAT #0 eaFicArtic;
     |NOME_DAT #1 eaFicCompo;
     |ABRE #74;
     |ABRE #90;
     |ABRE #2;
     |ABRE #3;
     |ABRE #4;
     |ABRE #5;
     |ABRE #6;
     |ABRE #7;
     |ABRE #25;
     |BUCLE Articulo;
     |CIERRA #25;
     |CIERRA #7;
     |CIERRA #6;
     |CIERRA #5;
     |CIERRA #4;
     |CIERRA #3;
     |CIERRA #2;
     |CIERRA #90;
     |CIERRA #74;
|FPRO;
