|FICHEROS;
     guerz072 #0;
     guerm001 #1;
     guerm002 #2;
     guerm004 #4,MANTE;
     guerm005 #5;
     guerm009 #9,MANTE;
     guerm010 #10,MANTE;
     guerm011 #11,MANTE;
     agifa019 #19;
     agifa024 #24,MANTE;
     guerm050 #50,MANTE;
     guerm051 #51;
     guerm052 #52; ||Historico
|FIN;

|VARIABLES;
     &EURODB = 0;
     nResto = 0;
     nMinu = 0;
     nBruto = 0;
     nDescu = 0;
     nMinutos = 0;
     nLin = 0;
     nNume = 0;
     nNume1 = 0;
     nNume2 = 0;
     nUni = 0;
     nConta = 0;
     aHora = "";
     nXls = 0;
     aRuta = "";
     nBoton1 = 0;
     aExcel = "";
     aAlfa = "";
     aAlfb = "";
     aAlfc = "";
     aAlfd = "";
     aAlfe = "";
     aAlff = "";
     aAlfg = "";
     aAlfh = "";
     aAlfi = "";
     aAlfj = "";
     aAlfk = "";
     aAlfl = "";
     aAlfm = "";
     aAlfn = "";
     aAlfo = "";
     aAlfp = "";
     aAlfq = "";
     aAlfr = "";
     aAlfs = "";
     aAlft = "";
     aAlfu = "";
     aAlfv = "";
     aAlfw = "";
     aAlfx = "";
     aAlfy = "";
     aAlfz = "";
     aAlfaa = "";
     aAlfab = "";
     aAlfac = "";
     aAlfad = "";
     aAlfae = "";
     aAlfaf = "";
     nSal = 0;
|FIN;

|PROCESO Articulo;
     |DDEFECTO #50;
     |ABRE #50;
     #50#0 = aAlfk;
     |LEE 000#50=;
     |SI FSalida ! 0;
          |MENAV "0000No existe Articulo...";
          |PUSHV 0501 2380;
          |PINPA #0#50;
          |PINDA #0#50;
          |PARA FSalida = 1; |SI FSalida ! 0; |HACIENDO;
               |ENDATOS #1#50;
               |SI FSalida ! 0;
                    |CONFI "0000NAbandonar la importacion";
                    |SI FSalida = 0; nSal = 1; |SAL; |FINSI;
               |FINSI;
          |SIGUE;
          |SI nSal = 0; |GRABA 020#50n; |FINSI;
          |POPV;
     |FINSI;
     aAlfk = #50#1;
|FPRC;

|PROCESO Cliente;
     |DDEFECTO #24;
     |ABRE #24;
     #24#0 = aAlfg;
     |LEE 000#24=;
     |SI FSalida ! 0;
          |MENAV "0000No existe Cliente...";
          |PUSHV 0501 2380;
          |PINPA #0#24;
          |PINDA #0#24;
          |PARA FSalida = 1; |SI FSalida ! 0; |HACIENDO;
               |ENDATOS #1#24;
               |SI FSalida ! 0;
                    |CONFI "0000NAbandonar la importacion";
                    |SI FSalida = 0; nSal = 1; |SAL; |FINSI;
               |FINSI;
          |SIGUE;
          |SI nSal = 0; |GRABA 020#24n; |FINSI;
          |POPV;
     |FINSI;
     |CIERRA #24;
|FPRC;

|PROCESO Obra;
     |DDEFECTO #9;
     |ABRE #9;
     #9#0 = aAlfg;
     #9#2 = aAlfi;
     |LEE 000#9=;
     |SI FSalida ! 0;
          |MENAV "0000No existe Obra...";
          |PUSHV 0501 2380;
          #9#1 = #24#1;
          |PINPA #0#9;
          |PINDA #0#9;
          |PARA FSalida = 1; |SI FSalida ! 0; |HACIENDO;
               |ENDATOS #1#9;
               |SI FSalida ! 0;
                    |CONFI "0000NAbandonar la importacion";
                    |SI FSalida = 0; nSal = 1; |SAL; |FINSI;
               |FINSI;
          |SIGUE;
          |SI nSal = 0; |GRABA 020#9n; |FINSI;
          |POPV;
     |FINSI;
     |CIERRA #9;
|FPRC;

|PROCESO Camion;
     |QBT aAlfn;
     |DDEFECTO #4;
     |ABRE #4;
     #4#0 = aAlfn;
     |LEE 000#4=;
     |SI FSalida ! 0;
          |MENAV "0000No existe Camion...";
          |PUSHV 0501 2380;
          |PINPA #0#4;
          |PINDA #0#4;
          |PARA FSalida = 1; |SI FSalida ! 0; |HACIENDO;
               |ENDATOS #1#4;
               |SI FSalida ! 0;
                    |CONFI "0000NAbandonar la importacion";
                    |SI FSalida = 0; nSal = 1; |SAL; |FINSI;
               |FINSI;
          |SIGUE;
          |SI nSal = 0; |GRABA 020#4n; |FINSI;
          |POPV;
     |FINSI;
     |CIERRA #4;
|FPRC;

|PROCESO ArtCliObra;
     |ABRE #19;
     #19#0 = aAlfk;
     |LEE 000#19=;
     |CIERRA #19;

     |DDEFECTO #11;
     |ABRE #11;
     #11#0 = aAlfg; ||Cli
     #11#1 = aAlfi; ||Obra
     #11#2 = aAlfk; ||Art
     |LEE 000#11=;
     |SI FSalida ! 0;
          |MENAV "0000No existe Articulo/Cliente...";
          |PUSHV 0501 2380;
          #11#3 = #24#1;
          #11#4 = #9#3;
          #11#5 = #19#1;
          |PINPA #0#11;
          |PINDA #0#11;
          |PARA FSalida = 1; |SI FSalida ! 0; |HACIENDO;
               |ENDATOS #1#11;
               |SI FSalida ! 0;
                    |CONFI "0000NAbandonar la importacion";
                    |SI FSalida = 0; nSal = 1; |SAL; |FINSI;
               |FINSI;
          |SIGUE;
          |SI nSal = 0; |GRABA 020#11n; |FINSI;
          |POPV;
     |FINSI;
     |CIERRA #11;
|FPRC;

|PROCESO Conductor;
     |DDEFECTO #10;
     |ABRE #10;
     #10#0 = aAlfo;
     |LEE 000#10=;
     |SI FSalida ! 0;
          |MENAV "0000No existe Conductor...";
          |PUSHV 0501 2380;
          |PINPA #0#10;
          |PINDA #0#10;
          |PARA FSalida = 1; |SI FSalida ! 0; |HACIENDO;
               |ENDATOS #1#10;
               |SI FSalida ! 0;
                    |CONFI "0000NAbandonar la importacion";
                    |SI FSalida = 0; nSal = 1; |SAL; |FINSI;
               |FINSI;
          |SIGUE;
          |SI nSal = 0;|GRABA 020#10n; |FINSI;
          |POPV;
     |FINSI;
     |CIERRA #10;
|FPRC;

|PROCESO ArtiDescarga;
     |DDEFECTO #51;
     |ABRE #51;
     |LEE 000#51p;
     |SI FSalida ! 0;
          |MENAV "0000No existe Articulo Descarga...";
          |PUSHV 0501 2380;
          |PINPA #0#51;
          |PINDA #0#51;
          |PARA FSalida = 1; |SI FSalida ! 0; |HACIENDO;
               |ENDATOS #1#51;
               |SI FSalida ! 0;
                    |CONFI "0000NAbandonar la importacion";
                    |SI FSalida = 0; nSal = 1; |SAL; |FINSI;
               |FINSI;
          |SIGUE;
          |SI nSal = 0;|GRABA 020#51n; |FINSI;
          |POPV;
     |FINSI;
     |CIERRA #51;
|FPRC;

|PROCESO LeeArti;
     |DDEFECTO #19;
     |ABRE #19;
     #19#0 = #2#2;
     |LEE 000#19=;
     |SI FSalida ! 0;
          |MENAV "0000No existe Articulo...";
          |PUSHV 0501 2380;
          |PINPA #0#19;
          |PINDA #0#19;
          |PARA FSalida = 1; |SI FSalida ! 0; |HACIENDO;
               |ENDATOS #1#19;
               |SI FSalida ! 0;
                    |CONFI "0000NAbandonar la importacion";
                    |SI FSalida = 0; nSal = 1; |SAL; |FINSI;
               |FINSI;
          |SIGUE;
          |SI nSal = 0; |GRABA 020#19n; |FINSI;
          |POPV;
     |FINSI;
     |CIERRA #19;
|FPRC;

|PROCESO Total;
     nBruto = (#2#4/1000  * #2#5) ! EURODB;
     nDescu = (nBruto % #2#8) ! EURODB;
     #2#6 = nBruto - nDescu;

     #1#19 = #1#19 + #2#4;
     #1#20 = #1#20 + #2#6;
     #1#21 = 0;
     #1#22 = #1#20 - #1#21;
     #1#23 = ((#1#22 * #1#14) / 100) ! EURODB;
     #1#24 = #1#22 + #1#23;
     #1#33 = #1#33 + #2#7;
     #1#34 = #1#34 + #2#4;

|FPRC;

|PROCESO Registro;
     #52#0 = "";
     #52#1 = aAlfd;
     |LEE 000#52=;
     |SI FSalida = 0;
          aAlfa = aAlfd; |QBT aAlfa;
          aAlfa = "0000Registro existente: " + aAlfa;
          |MENSA aAlfa;
          |ACABA;
     |FINSI;

     |QBT aAlfg;
     aAlfg = ("000000" + aAlfg) % -106;

     |QBT aAlfe;
     aAlfe = (aAlfe % 102)+"."+(aAlfe % 402)+"."+(aAlfe % 704);

     || No se porque pero el XLS trae el formato hora de la forma
     || 8:10:00 AM  .... pero la variable trae un valor decimal
     || la hora en minutos
     nNume1 = aAlfw; nNume1 = nNume1 * 1440;
     nNume2 = aAlfx; nNume2 = nNume2 * 1440;
     nMinutos = nNume2 - nNume1;

     |HAZ Articulo; |SI nSal = 1; |ACABA; |FINSI;
     |HAZ Cliente; |SI nSal = 1; |ACABA; |FINSI;
     |HAZ Obra; |SI nSal = 1; |ACABA; |FINSI;
     |HAZ Camion; |SI nSal = 1; |ACABA; |FINSI;
     |HAZ Conductor; |SI nSal = 1; |ACABA; |FINSI;
     |HAZ ArtCliObra; |SI nSal = 1; |ACABA; |FINSI;
     |ABRE #1;
     |ABRE #2;
     |ABRE #5; |LEE 000#5p; |CIERRA #5;
     ||Cabecera
     |LEE 000#1u;
     |SI FSalida = 0; nConta = #1#0 + 1; |SINO; nConta = 1; |FINSI;
     |HORA aHora;
     |DDEFECTO #1;
     #1#0 = nConta;
     #1#1 = aAlfe;
     #1#2 = aHora;
     #1#3 = #24#0;
     #1#4 = #24#1;
     #1#5 = #24#5;
     #1#6 = #24#178;
     #1#7 = #24#179;
     #1#8 = #24#7;
     #1#9 = #24#6;
     #1#10 = #24#15;
     #1#11 = #4#0;
     #1#12 = #4#1;
     #1#13 = #4#2;
     #1#14 = #5#3;
     #1#15 = "H";
     #1#18 = aAlfd;
     #1#28 = "N";
     #1#29 = #9#2;
     #1#30 = #9#3;
     #1#31 = #10#0;
     #1#32 = #10#1;
     #1#36 = "N";
     #1#37 = "N";
     #1#40 = "HO";    || Valor Fijo, cambiar guerz073
     nLin = 1;

     nUni = aAlfr;
     nUni = nUni * 1000;

     ||Linea
     |DDEFECTO #2;
     #2#0 = nLin;
     #2#1 = #1#0;
     #2#2 = aAlfk;
     |HAZ LeeArti;
     #2#3 = #19#1;
     #2#4 = nUni;
     #2#5 = #11#6; || Precio
     #2#8 = #11#7;
     #2#7 = 0;
     |HAZ Total;
     |GRABA 020#2n;
     nLin = nLin + 1;

     nUni = nUni / 1000;

     ||Linea Carga Incompleta
     |SI #9#4 > 0;
          nNume = (#9#4 - nUni) * 1000;
          |SI nNume > 0;
               |DDEFECTO #2;
               #2#0 = nLin;
               #2#1 = #1#0;
               #2#2 = #9#5;
               |HAZ LeeArti;
               #2#3 = #19#1;
               #2#4 = nNume;
               #2#5 = #9#6;
               #2#8 = 0;
               |HAZ Total;
               |GRABA 020#2n;
               nLin = nLin + 1;
          |FINSI;
     |FINSI;

     ||Linea Exceso descarga
     |SI #9#7 > 0; |Y #9#8 > 0;
          |SI nMinutos > #9#7;
               |HAZ ArtiDescarga;
               nNume = (nMinutos - #9#7) ! 0;
               nResto = nNume $ #9#8;
               nNume = (nNume - nResto) / #9#8;
               |SI nResto > 0;
                    nNume = nNume + 1;
               |FINSI;
               nNume = nNume * 1000;
               |DDEFECTO #2;
               #2#0 = nLin;
               #2#1 = #1#0;
               #2#2 = #51#1;
               |HAZ LeeArti;
               #2#3 = #19#1;
               #2#4 = nNume;
               #2#5 = #9#9;
               #2#8 = 0;
               |HAZ Total;
               |GRABA 020#2n;
               nLin = nLin + 1;
          |FINSI;
     |FINSI;

     |GRABA 020#1n;

     || Historico
     |SI FSalida = 0;
          #52#0 = "";
          #52#1 = aAlfd;
          #52#2 = #1#0;
          aAlfa = Usuario % 810;
          #52#3 = aAlfa;
          #52#4 = ~;
          |HORA aAlfa;
          #52#5 = aAlfa;
          |GRABA 020#52n;
     |FINSI;
     |CIERRA #1;
     |CIERRA #2;
|FPRC;

|PROCESO Tipo3; |TIPO 3;
     |ABRE #52;
     aExcel = #0#1; |QBF aExcel;
     |XABRE "CE", aExcel, 0;
     |SI FSalida < 0
          |MENAV "0000No puedo abrir el fichero a importar";
     |SINO;
          |CARGADLL "agixl97.dll";
          |SI FSalida < 0;
               |MENAV "0000No se puede usar agixl97.dll";
          |SINO;
               |ALFACALLDLL "agixl97.dll", "carga_book", aExcel;
               |ALFACALLDLL "agixl97.dll", "selecciona_hoja", "Hoja1";
               |SI FSalida = 0;
                    |PARA nXls = 7; |SI nXls < 65536; |HACIENDO nXls = nXls + 1;
                         aAlfa = "Importando:" + nXls;
                         |PINTA 2003, aAlfa;
                         aAlfb = "B" + nXls; |ALFACALLDLL "agixl97.dll", "peek_dato", aAlfb;
                         |SI FSalida ! 0; |SAL; |FINSI;
                         aAlfc = "C" + nXls; |ALFACALLDLL "agixl97.dll", "peek_dato", aAlfc;
                         |SI FSalida ! 0; |SAL; |FINSI;
                         aAlfd = "D" + nXls; |ALFACALLDLL "agixl97.dll", "peek_dato", aAlfd;
                         |SI FSalida ! 0; |SAL; |FINSI;
                         aAlfe = "E" + nXls; |ALFACALLDLL "agixl97.dll", "peek_dato", aAlfe;
                         |SI FSalida ! 0; |SAL; |FINSI;
                         aAlff = "F" + nXls; |ALFACALLDLL "agixl97.dll", "peek_dato", aAlff;
                         |SI FSalida ! 0; |SAL; |FINSI;
                         aAlfg = "G" + nXls; |ALFACALLDLL "agixl97.dll", "peek_dato", aAlfg;
                         |SI FSalida ! 0; |SAL; |FINSI;
                         aAlfh = "H" + nXls; |ALFACALLDLL "agixl97.dll", "peek_dato", aAlfh;
                         |SI FSalida ! 0; |SAL; |FINSI;
                         aAlfi = "I" + nXls; |ALFACALLDLL "agixl97.dll", "peek_dato", aAlfi;
                         |SI FSalida ! 0; |SAL; |FINSI;
                         aAlfj = "J" + nXls; |ALFACALLDLL "agixl97.dll", "peek_dato", aAlfj;
                         |SI FSalida ! 0; |SAL; |FINSI;
                         aAlfk = "K" + nXls; |ALFACALLDLL "agixl97.dll", "peek_dato", aAlfk;
                         |SI FSalida ! 0; |SAL; |FINSI;
                         aAlfl = "L" + nXls; |ALFACALLDLL "agixl97.dll", "peek_dato", aAlfl;
                         |SI FSalida ! 0; |SAL; |FINSI;
                         aAlfm = "M" + nXls; |ALFACALLDLL "agixl97.dll", "peek_dato", aAlfm;
                         |SI FSalida ! 0; |SAL; |FINSI;
                         aAlfn = "N" + nXls; |ALFACALLDLL "agixl97.dll", "peek_dato", aAlfn;
                         |SI FSalida ! 0; |SAL; |FINSI;
                         aAlfo = "O" + nXls; |ALFACALLDLL "agixl97.dll", "peek_dato", aAlfo;
                         |SI FSalida ! 0; |SAL; |FINSI;
                         aAlfp = "P" + nXls; |ALFACALLDLL "agixl97.dll", "peek_dato", aAlfp;
                         |SI FSalida ! 0; |SAL; |FINSI;
                         aAlfq = "Q" + nXls; |ALFACALLDLL "agixl97.dll", "peek_dato", aAlfq;
                         |SI FSalida ! 0; |SAL; |FINSI;
                         aAlfr = "R" + nXls; |ALFACALLDLL "agixl97.dll", "peek_dato", aAlfr;
                         |SI FSalida ! 0; |SAL; |FINSI;
                         aAlfs = "S" + nXls; |ALFACALLDLL "agixl97.dll", "peek_dato", aAlfs;
                         |SI FSalida ! 0; |SAL; |FINSI;
                         aAlft = "T" + nXls; |ALFACALLDLL "agixl97.dll", "peek_dato", aAlft;
                         |SI FSalida ! 0; |SAL; |FINSI;
                         aAlfu = "U" + nXls; |ALFACALLDLL "agixl97.dll", "peek_dato", aAlfu;
                         |SI FSalida ! 0; |SAL; |FINSI;
                         aAlfv = "V" + nXls; |ALFACALLDLL "agixl97.dll", "peek_dato", aAlfv;
                         |SI FSalida ! 0; |SAL; |FINSI;
                         aAlfw = "W" + nXls; |ALFACALLDLL "agixl97.dll", "peek_dato", aAlfw;
                         |SI FSalida ! 0; |SAL; |FINSI;
                         aAlfx = "X" + nXls; |ALFACALLDLL "agixl97.dll", "peek_dato", aAlfx;
                         |SI FSalida ! 0; |SAL; |FINSI;
                         aAlfy = "Y" + nXls; |ALFACALLDLL "agixl97.dll", "peek_dato", aAlfy;
                         |SI FSalida ! 0; |SAL; |FINSI;
                         aAlfz = "Z" + nXls; |ALFACALLDLL "agixl97.dll", "peek_dato", aAlfz;
                         |SI FSalida ! 0; |SAL; |FINSI;
                         aAlfaa = "AA" + nXls; |ALFACALLDLL "agixl97.dll", "peek_dato", aAlfaa;
                         |SI FSalida ! 0; |SAL; |FINSI;
                         aAlfab = "AB" + nXls; |ALFACALLDLL "agixl97.dll", "peek_dato", aAlfab;
                         |SI FSalida ! 0; |SAL; |FINSI;
                         aAlfac = "AC" + nXls; |ALFACALLDLL "agixl97.dll", "peek_dato", aAlfac;
                         |SI FSalida ! 0; |SAL; |FINSI;
                         aAlfad = "AD" + nXls; |ALFACALLDLL "agixl97.dll", "peek_dato", aAlfad;
                         |SI FSalida ! 0; |SAL; |FINSI;
                         aAlfae = "AE" + nXls; |ALFACALLDLL "agixl97.dll", "peek_dato", aAlfae;
                         |SI FSalida ! 0; |SAL; |FINSI;
                         aAlfaf = "AF" + nXls; |ALFACALLDLL "agixl97.dll", "peek_dato", aAlfaf;
                         |SI FSalida ! 0; |SAL; |FINSI;

                         aAlfa = aAlfd; |QBT aAlfa;
                         |SI aAlfa = ""; |SAL; |FINSI;

                         aAlfa = "0000Procesando " + aAlfa; |MENSA aAlfa;
                         |HAZ Registro;
                         |SI nSal = 1; |SAL; |FINSI;

                    |SIGUE;
                    |ALFACALLDLL "agixl97.dll", "fin_book", "salva";
               |FINSI;
          |FINSI;
          |DESCARGADLL "agixl97.dll";
     |FINSI;
     |CIERRA #52;
|FPRC;

|PROCESO Browser; |TIPO 0;
     |SI FSalida ! 10; |ACABA; |FINSI;

     aRuta = "F*.xls";

     |BROWSE aRuta;

     aRuta = aRuta % 2; |QBF aRuta;
     |SI aRuta = "F"; aRuta = ""; |FINSI;

     |QBF aRuta;
     |SI aRuta = "";
          |ERROR;
     |SINO;
          #0#1 = aRuta;
          |PINTA #0#1;
     |FINSI;
|FPRC;

|PROCESO Boton1;
     |PTEC 824;
|FPRC;

|PROGRAMA;
     |CLS;
     |CONTROL_SIMPLE 0, "BOTON,  Fichero ", 1119, 1127, Boton1;
     nBoton1 = FSalida;
     |ABRE #0;
     |LEE 101#0p;
     |SI FSalida ! 0; |GRABA 020#0b; |FINSI;
     |PINPA #0#0;
     |PINDA #0#0;
     |ENDATOS #1#0;
     |SI FSalida = 0;
          |GRABA 020#0a;
     |FINSI;
     |CIERRA #0;
     |FIN_CONTROL_WINDOWS nBoton1;
     |PULSATECLA;
|FPRO;
