|FICHEROS;
     gestrw01 #0;
     agifa017 #17;
     agifa019 #19;
     dsm00024 #24;
     dsm00067 #67;
     agifa074 #74;
     agifa142 #142;
|FIN;

|VARIABLES;
     &enAlmacen = 0;
     &eaSerie = "";
     &enOrden = 0;
     &enUniGestral = 0;
     &enMtsGestral = 0;
     aAlfa = "";
     aSer = "";
     nNum = 0;
     nLin = 0;
     aTmp = "";
     i = 0;
     nPos = 0;
     nParti = 0;
     &nDeci_Uni = 0;
     nUni = 0;
     nSw = 0;
     nInfor = -1;
     nImpre = -1;
     nPrime = 0;
     nNume = 0;
|FIN;

|PROCESO Parti; |TIPO 0;
     |SI #142#122 = "S";
          aAlfa = #142#121 * #142#120;
          aAlfa = aAlfa + #0#4; |QBF aAlfa;
          nNume = -1 * (100 + #142#120);
          aAlfa = aAlfa % nNume;
          #0#4 = aAlfa; |PINTA #0#4;
     |FINSI;
     |ABRE #24; |SELECT #4#24;
     #24#0 = #74#2;
     #24#2 = #0#4;
     |LEE 000#24=;
     |SI FSalida = 0;
          |MENAV "0000Partida existente...";
          |CONFI "0000N¿ Continuar ?";
          |SI FSalida ! 0; |ERROR; |FINSI;
     |FINSI;
     |CIERRA #24;
|FPRC;

|PROCESO ImpEti;
     #74#9 = #0#0;
     #74#0 = #0#1;
     #74#1 = #0#2;
     |LEE 000#74=;
     |SI FSalida ! 0; |DDEFECTO #74; |FINSI;
     #19#0 = #74#2;
     |LEE 000#19=;
     |SI FSalida ! 0; |DDEFECTO #19; |FINSI;

     #67#3 = #0#4;
     #67#4 = #0#5;

     |PRINT; |PIEINF;
|FPRC;

|DEFBUCLE ImpEti;
     #0#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, ImpEti;
|FIN;

|PROCESO dsm000067;
     |SI nPrime = 0;
          nPrime = 1;
          |CONFI "0000SImprimir etiquetas entrada partidas";
          |SI FSalida ! 0; |ERROR10; |ACABA; |FINSI;
          |IMPRE 0;
          nImpre = FSalida;
          |SI FSalida = 0;
               |INFOR "gestrw01";
               nInfor = FSalida;
          |FINSI;
     |FINSI;
     #74#9 = #67#0;
     #74#0 = #67#1;
     #74#1 = #67#2;
     |LEE 000#74=;
     |SI FSalida ! 0; |DDEFECTO #74; |FINSI;
     #19#0 = #74#2;
     |LEE 000#19=;
     |SI FSalida ! 0; |DDEFECTO #19; |FINSI;
     |SI nInfor = 0;
          |PRINT; |PIEINF;
     |FINSI;
|FPRC;

|DEFBUCLE dsm00067;
     #67#1;
     ;
     eaSerie, enOrden, 001, "                              ";
     eaSerie, enOrden, 999, "zzzzzzzzzzzzzzzzzzzzzzzzzzzzzz";
     ;
     NULL, dsm000067;
|FIN;

|PROCESO ImpEtiOrd;
     |ABRE #19;
     |ABRE #74;
     |BUCLE dsm00067;
     |CIERRA #19;
     |CIERRA #74;
     |SI nInfor = 0; |FININF; |FINSI;
     |SI nImpre = 0; |FINIMP; |FINSI;
|FPRC;

|PROCESO Actua;
     #19#0 = #74#2;
     |LEE 000#19=;
     |SI FSalida ! 0; |DDEFECTO #19; |FINSI;
     #17#0 = #74#2;
     #17#1 = enAlmacen;
     |LEE 000#17=;
     |SI FSalida ! 0; |DDEFECTO #17; |FINSI;

     |DDEFECTO #24;
     #24#0 = #74#2;
     #24#1 = enAlmacen;
     #24#2 = #0#4;
     |LEE 101#24=;
     |SI FSalida ! 0; |GRABA 020#24b; |FINSI;
     #24#9 = #24#9 + #0#5; #24#22 = #24#22 + #0#5; #24#31 = #24#31 + #0#5;
     #24#10 = #24#10 + 1; #24#23 = #24#23 + 1; #24#32 = #24#32 + 1;
     |HAZ ValoraStock;
     |GRABA 020#24a;
     |LIBERA #24;

     |DDEFECTO #67;
     #67#0 = #74#9;
     #67#1 = #74#0
     #67#2 = #74#1;
     #67#3 = #0#4;
     |LEE 101#67=;
     |SI FSalida ! 0; |GRABA 020#67b; |FINSI;
     #67#4 = #67#4 + #0#5;
     |GRABA 020#67a;
     |LIBERA #67;
|FPRC;

|DEFBUCLE Actua;
     #0#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Actua;
|FIN;

|PROCESO Actualiza;
     |ABRE #24;
     |ABRE #19;
     |ABRE #17;
     |ABRE #67;
     |BUCLE Actua;
     |CONFI "0000SImprimir etiquetas entrada partidas";
     |SI FSalida = 0;
          |IMPRE 0;
          |SI FSalida = 0;
               |INFOR "gestrw01";
               |SI FSalida = 0;
                    |ABRE #74;
                    |BUCLE ImpEti;
                    |CIERRA #74;
                    |FININF;
               |FINSI;
               |FINIMP;
          |FINSI;
     |FINSI;
     |CIERRA #67;
     |CIERRA #17;
     |CIERRA #19;
     |CIERRA #24;
|FPRC;

|PROCESO CuentaUni;
     |SI #0#5 ! 0; nUni = nUni + 1; |FINSI;
     enMtsGestral = enMtsGestral + #0#5;
|FPRC;

|DEFBUCLE CuentaUni;
     #0#1;
     ;
     aSer, nNum, nLin, 001;
     aSer, nNum, nLin, 999;
     ;
     NULL, CuentaUni;
|FIN;

|PROCESO PartiAuto;
     aAlfa = "9" * #142#120;
     |ABRE #24; |SELECT #4#24;
     #24#0 = #74#2;
     #24#2 = aAlfa;
     |LEE 000#24];
     |SI FSalida = 0;
          |LEE 000#24a;
     |SINO;
          |LEE 000#24u;
     |FINSI;
     |SI FSalida = 0; |Y #24#0 = #74#2;
          nParti = #24#2;
          nParti = nParti + 1;
     |SINO;
          nParti = 1;
     |FINSI;
     |CIERRA #24;
     |PARA i = 1; |SI i [ enUniGestral; |HACIENDO i = i + 1;
          aAlfa = "0" * #142#120;
          aAlfa = aAlfa + nParti;
          nPos = -1 * (100 + #142#120);
          aAlfa = aAlfa % nPos;

          #0#0 = aSer;
          #0#1 = nNum;
          #0#2 = nLin;
          #0#3 = i;
          #0#4 = aAlfa;
          |GRABA 020#0n;
          nParti = nParti + 1;
     |SIGUE;
|FPRC;

|PROCESO Min;
     #0#0 = aSer;
     #0#1 = nNum;
     #0#2 = nLin;
     #0#3 = 1;
|FPRC;

|PROCESO Max;
     #0#0 = aSer;
     #0#1 = nNum;
     #0#2 = nLin;
     #0#3 = 999;
|FPRC;

|PROGRAMA;
     |SI enOrden ! 0;    ||Llama agifa074
          |HAZ ImpEtiOrd;
          |ACABA;
     |FINSI;

     aAlfa = PARAMETRO % 103;
     |SI aAlfa = "ACT";
          nSw = 1;
          aAlfa = PARAMETRO % 405; aSer = aAlfa;
          aAlfa = PARAMETRO % 906; nNum = aAlfa;
          aAlfa = PARAMETRO % 1503; nLin = aAlfa;
          aTmp = PARAMETRO % 18;
     |SINO;
          nSw = 0;
          aAlfa = PARAMETRO % 105; aSer = aAlfa;
          aAlfa = PARAMETRO % 606; nNum = aAlfa;
          aAlfa = PARAMETRO % 1203; nLin = aAlfa;
          aTmp = PARAMETRO % 15;
     |FINSI;

     |ABRE #142; |LEE 000#142p; |CIERRA #142;
     nDeci_Uni = #142#8;

     |ABRE #74;
     #74#9 = aSer;
     #74#0 = nNum;
     #74#1 = nLin;
     |LEE 020#74=;
     |CIERRA #74;

     |NOME_DAT #0 aTmp;

     |ABRET #0;
     |SI nSw = 1;
          |HAZ Actualiza;
     |SINO;
          #0#0 = aSer;
          #0#1 = nNum;
          #0#2 = nLin;
          #0#3 = 0;
          |LEE 000#0];
          |SI FSalida ! 0; |O #0#0 ! aSer; |O #0#1 ! nNum; |O #0#2 ! nLin;
               |HAZ PartiAuto;
          |FINSI;

          |PINPA #0#0;
          |PARA; |SI; |HACIENDO;
               |ENTLINEAL #1#0, 4, 2, 21, 0, Min, Max;
               enMtsGestral = 0;
               nUni = 0;
               |BUCLE CuentaUni;
               |SI nUni ! enUniGestral;
                    |MENAV "0000Las unidades distintas a las partidas o partidas con metros a 0...";
                    |CONFI "0000NEs Correcto S/N:";
                    |SI FSalida = 0; |SAL; |FINSI;
               |SINO;
                    |SAL;
               |FINSI;
          |SIGUE;
          enUniGestral = nUni;
     |FINSI;
     |CIERRAT #0;
|FPRO;
