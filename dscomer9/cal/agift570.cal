|FICHEROS;
     agift570 #0;
     agifa515 #1;   ||tarjetas
     agifa516 #2;   ||Apuntes en tarjeta
     agifa501 #3;   ||tpv
     agifa513 #4;   ||Cobros
|FIN;

|PROCESO borrar;
     |BORRA 021#2a;
|FPRC;

|DEFBUCLE borra;
#2#1;
;
#0#0 , "01.01.1900";
#0#0 , "31.12.2500";
e;
NULL,borrar;
|FIN;


|PROCESO actualizar;
|SI #3#40 ! 0; || si hay algo en la tarjeta
     #0#2 = #3#35;
     #0#3 = #3#36;
     #0#4 = #3#0;
     #0#5 = #3#37;
     |PINDA #0#0;
     #1#0 = #0#0;
     |LEE 121#1=;
     #1#2 = #1#2 + #3#40;
     |SI #3#14 ] #1#3;
          #1#3 = #3#14;  ||fecha
          #1#4 = #3#40;  ||importe ult operacion
     |FINSI;
     |GRABA 021#1a;
     |LIBERA #1;


     #2#0 = #0#0;   ||Diario de tarjetas
     #2#1 = #3#14;
     |LEE 101#2=;
     |SI FSalida ! 0;
          #2#2 = 0;
          |GRABA 021#2b;
     |FINSI;
     #2#2 = #2#2 + #3#40;
     |GRABA 021#2a;
     |LIBERA #2;
|FINSI;
|FPRC;


|DEFBUCLE actualiza;
#3#1;
46;       ||Cobrado targeta
"     " ,       0 , #0#0;
"zzzzz" ,  999999 , #0#0;
e;
NULL,actualizar;
|FIN;

|PROCESO actcobro;
#0#2 = "C";
#0#3 = #4#14;
#0#5 = #4#0;
#0#4 = "";
|PINDA #0#0;
     #1#0 = #4#13;
     |LEE 101#1=;
     #1#2 = #1#2 + #4#4;
     |SI #4#11 ] #1#3;
          #1#3 = #4#11;  ||fecha
          #1#4 = #4#4;  ||importe ult operacion
     |FINSI;
     |GRABA 021#1a;
     |LIBERA #1;


     #2#0 = #0#0;   ||Diario de tarjetas
     #2#1 = #4#11;
     |LEE 101#2=;
     |SI FSalida ! 0; #2#2 = 0; |GRABA 021#2b; |FINSI;
     #2#2 = #2#2 + #4#4;
     |GRABA 021#2a;
     |LIBERA #2;

|FPRC;

|DEFBUCLE cobro;
#4#1;
12,13;
"     " ,       0 , "T" , #0#0;
"zzzzz" ,  999999 , "T" , #0#0;
e;
NULL,actcobro;
|FIN;


|PROCESO inicio;|TIPO 10;
|ENDATOS #1#0;
|SI FSalida ! 0; |ERROR; |ACABA; |FINSI;
|SI #0#1 ! "SI"; |ERROR; |ACABA; |FINSI;

|ABRE #1;
|ABRET #2;
#1#0 = #0#0;
|LEE 101#1=;
|SI FSalida ! 0;
     |MENAV "0000No encuentro la tarjeta";
     |CIERRA #1;
     |CIERRAT #2;
     |ERROR;
     |ACABA;
|FINSI;

#1#2 = 0;
#1#4 = 0;
#1#3 = "00.00.0000";
|GRABA 021#1a;
|BUCLE borra;

|ABRE #3;
|BUCLE actualiza;
|CIERRA #3;

|ABRE #4;
|BUCLE cobro;
|CIERRA #4;

|CIERRA #1;
|CIERRAT #2;
|ERROR;
|ACABA;
|FPRC;
