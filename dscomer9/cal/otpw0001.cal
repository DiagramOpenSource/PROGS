|FICHEROS;
     otpw0001 #0;
     agifa142 #142;
     agifa023 #23;
     agifa024 #24;
     agifa025 #25;
     agifa019 #19;
     agifa084 #84;
     agifa069 #69;
     agifa321 #321;
     agifa324 #324;
     agifa007 #7;
     agifa220 #220;
     dsm00053 #53;
     otpm0002 #2;
|FIN;

|INCLUYE i_varart;

|VARIABLES;
     aAlfa = "";

     nSw       = 0;
     &enSwMenu = 1;
     &eaTag    = "";
     nAlma     = 1;
     nForma    = 1;
     nLin      = 0;
     imneto    = 0;
     nImpDiv   = 0;
     nMult     = 0;
     fmes      = "";
     mes       = 0;
     nImpo     = 0;
     nMargen   = 0;
     nDto      = 0;
     retencion = 0;
     nSeleccio = 0;
|FIN;

|PROCESO agifa220;
     #53#0 = "F";
     #53#1 = #69#20;
     #53#2 = #69#0;
     #53#3 = #69#1;
     #53#4 = #220#1;
     #53#5 = #220#2;
     |GRABA 020#53n;
|FPRC;

|DEFBUCLE agifa220;
     #220#1;
     ;
     #69#2, 1;
     #69#2, 999;
     ;
     NULL, agifa220;
|FIN;

|PROCESO ActArti;
     fmes = #84#1 % A402;
     mes = fmes - 1;
     mes = mes * 5;
     mes = mes + 35;
     |ABRE #19;
     #19#0 = #69#2;
     |LEE 101#19=;
     |SI FSalida = 0;
          |SI #19#194 = 2;
               nImpo = ((((#69#30 * #69#6) < #69#8) < #69#21) < #84#5) < #84#32;
          |SINO;
               nImpo = ((((#69#5 * #69#6) < #69#8) < #69#21) < #84#5) < #84#32;
          |FINSI;
          |SI #142#115 = "S";
               nImpo = nImpo < #84#7;
          |FINSI;
          nMargen = nImpo - #69#14;
          #19mes = #19mes + (nImpo * nForma);
          #19#95 = #19#95 + (nImpo * nForma);
          mes = mes + 1;
          #19mes = #19mes + (nMargen * nForma);
          #19#96 = #19#96 + (nMargen * nForma);
          |GRABA 020#19a;
          |LIBERA #19;

          efFecha = #84#1;
          eaArticulo = #69#2;
          enImpVta = (nImpo * nForma);
          enImpMar = (nMargen * nForma);
          |HAZ AcumulaArt;
     |FINSI;
     |CIERRA #19;
|FPRC;

|CALCULO ActCli;
     |ABRE #24;
     #24#0 = #84#3;
     |LEE 101#24=;
     |SI 0 = FSalida;
          fmes = #84#1 % A402;
          mes = fmes - 1;
          mes = mes * 4;
          mes = mes + 54;
          imneto = #84#15 - #84#25;
          |SI #142#115 = "N";
               nImpo = (imneto * 100) / (100 - #84#7);
               nDto = #84#25 + (imneto - nImpo);
          |SINO;
               nImpo = imneto;
               nDto = #84#25;
          |FINSI;
          #24mes = #24mes +. nImpo; || imneto;
          mes = mes + 1;
          #24mes = #24mes +. nDto;  || #84#25;
          mes = mes + 1;
          #24mes = #24mes +. #84#37;
          #24#102 = #24#102 +. nImpo; || imneto;
          #24#103 = #24#103 +. nDto;  || #84#25;
          #24#104 = #24#104 +. #84#37;
          mes = FEntrada / 100;
          mes = mes ! 0;
          |SI 1 = mes;
               #24#45 = #84#1;
               #24#46 = imneto;
          |FINSI;
          #24#110 = #24#110 +. imneto;
          imneto = imneto + #84#24;
          |GRABA 020#24a;

          enImpCliCom = nImpo;
          enImpCliDto = nDto;
          enImpCliFac = imneto;
          enImpCliMar = #84#37;
          eaCliente = #84#3;
          efFecha = #84#1;
          |HAZ AcumulaCli;
     |FINSI;
     |CIERRA #24;

     |ABRE #25;
     #25#0 = #84#6;
     |LEE 101#25=;
     |SI 0 = FSalida;
           imneto = #84#15 - #84#25;
           fmes = #84#1 % A402;
           mes = fmes - 1;
           mes = mes * 2;
           mes = mes + 11;
           #25mes = #25mes +. #84#26;
           retencion = #25mes % #25#39;
           mes = mes + 1;
           #25mes = #25mes +. imneto;
           #25#35 = #25#35 +. #84#26;
           #25#36 = #25#36 +. imneto;
           mes = fmes - 1;
           mes = mes + 40;
           #25mes = retencion;
           retencion = #25#35 % #25#39;
           #25#52 = retencion;
           |GRABA 020#25a;

          enImpRepComi = #84#26;
          enImpRepVta = imneto;
          enImpRepRete = retencion;
          eaRepre = #84#6;
          efFecha = #84#1;
          |HAZ AcumulaRep;
     |FINSI;
     |CIERRA #25;
     ||***************** CALCULO DEL RIESGO;
     |SI #142#47 = "S";  ||컴컴컴컴컴 Acumula en riesgos Si Crea Recibo
          eaTag = "FC";  |HAZ Riesgos;
     |FINSI;
|FCAL;

|PROCESO agifa023;
     |SI nSw = 0;
          nSw = 1;
          |ERROR10;
          |ACABA;
     |FINSI;

     |DDEFECTO #19;
     |ABRE #19;
     #19#0 = #23#1;
     |LEE 000#19=;
     |CIERRA #19;

     nLin = nLin + 1;
     |DDEFECTO #69;
     #69#20 = #84#48;
     #69#0 = #84#0;
     #69#1 = nLin;
     #69#2 = #23#1;
     #69#3 = nAlma;
     #69#4 = #23#35;
     #69#5 = 1;
     #69#6 = #23#2;
     #69#26 = #23#2;
     #69#28 = #23#2;
     ||#69#8 = Dto1
     ||#69#10 = Comision
     #69#11 = #19#30;
     #69#13 = #19#2;
     ||#69#14
     #69#15 = #84#3;
     #69#16 = #84#34;
     #69#17 = #84#35;
     #69#26 = #69#6;

     imneto  = ((((#69#9  < #84#5) < #84#32) < #84#7));

     |HAZ TotalLin69;
     |HAZ CalCabAgifa084;

     enForma = 1;
     |HAZ AcumulaFC;

     #69#14 = enCoste;
     #84#37 = #84#37 + (imneto - enCoste);

     |HAZ ActArti;
     |GRABA 020#69n;

     |BUCLE agifa220;
|FPRC;

|DEFBUCLE agifa023;
     #23#1;
     ;
     #24#0, "                    ";
     #24#0, "zzzzzzzzzzzzzzzzzzzz";
     ;
     NULL, agifa023;
|FIN;

|PROCESO agifa024;

     #otpm0002#0 = #agifa024#158;
     #otpm0002#1 = #otpw0001#0;
     |LEE 000#otpm0002.=;
     |SI FSalida ! 0 ; |ACABA; |FINSI;

     nSeleccio = 1;

     |DDEFECTO #25;
     #25#0 = #24#25;
     |LEE 000#25=;

     nSw = 0;
     |BUCLE agifa023;
     |SI nSw = 0; |ACABA; |FINSI;

     nLin = 0;
     #84#48 = #0#1;
     enSwMenu = 1;
     |HAZ ContaFD7
     |GRABA 020#84b;
     |SI FSalida = 0;
          #84#1 = #0#2;
          #84#3 = #24#0;
          #84#4 = #24#1;
          #84#5 = #24#37;
          #84#6 = #24#25;
          #84#7 = #24#38;
          #84#8 = #24#20;
          #84#9 = #24#35;
          #84#29 = #24#1;
          #84#30 = #24#8;
          #84#31 = #24#9;
          #84#32 = #24#156;
          #84#33 = #24#10;
          #84#34 = #25#7;
          #84#35 = #24#4;
          #84#36 = #24#47;
          #84#40 = #24#16;
          #84#60 = #24#15;
          #84#64 = #24#183;

          #84#65 = #24#192;
          #324#0 = #84#65;
          |LEE 000#324=;

          #84#66 = #324#2;
          #84#67 = #24#193;
          #84#68 = #321#9;

          #324#0 = #84#65;
          |LEE 000#324=;
          #84#69 = #324#2;

          #84#78 = #24#202;
          #84#88 = #24#22;
          #84#89 = #24#23;
          #84#90 = #24#24;
          |BUCLE agifa023;
          |GRABA 020#84a;
          |LIBERA #84;
          |HAZ ActCli;
          |SI #142#47 = "S";
               |HAZ VenciDir;
          |FINSI;
     |FINSI;
|FPRC;

|DEFBUCLE agifa024;
     #24#1;
     3;
     "      ", #0#3;
     "zzzzzz", #0#4;
     ;
     NULL, agifa024;
|FIN;

|PROCESO Tipo3; |TIPO 3;
     |ABRE #otpm0002;
     |ABRE #142; |LEE 000#142p; |CIERRA #142;
     |ABRE #321;|LEE 000#321p; |CIERRA #321;
     |ABRE #84;
     |ABRE #69;
     |ABRE #25;
     |ABRE #7;
     |ABRE #324;
     |ABRE #220;
     |ABRE #53;
     #7#26 = #0#1;
     |LEE 000#7=;
     |SI FSalida = 0;
          |BUCLE agifa024;
          |SI nSeleccio = 0;
               |MENAV "0000Seleccion vacia.";
          |FINSI;
     |SINO;
          |MENAV "0000No existe Serie";
     |FINSI;
     |CIERRA #53;
     |CIERRA #220;
     |CIERRA #324;
     |CIERRA #7;
     |CIERRA #25;
     |CIERRA #69;
     |CIERRA #84;
     |CIERRA #otpm0002;
|FPRC;

|PROCESO NombreMes;
   |SI #otpw0001#0 = 1;  aAlfa = "ENERO     "; |FINSI;
   |SI #otpw0001#0 = 2;  aAlfa = "FEBRERO   "; |FINSI;
   |SI #otpw0001#0 = 3;  aAlfa = "MARZO     "; |FINSI;
   |SI #otpw0001#0 = 4;  aAlfa = "ABRIL     "; |FINSI;
   |SI #otpw0001#0 = 5;  aAlfa = "MAYO      "; |FINSI;
   |SI #otpw0001#0 = 6;  aAlfa = "JUNIO     "; |FINSI;
   |SI #otpw0001#0 = 7;  aAlfa = "JULIO     "; |FINSI;
   |SI #otpw0001#0 = 8;  aAlfa = "AGOSTO    "; |FINSI;
   |SI #otpw0001#0 = 9;  aAlfa = "SEPTIEMBRE"; |FINSI;
   |SI #otpw0001#0 = 10; aAlfa = "OCTUBRE   "; |FINSI;
   |SI #otpw0001#0 = 11; aAlfa = "NOVIEMBRE "; |FINSI;
   |SI #otpw0001#0 = 12; aAlfa = "DICIEMBRE "; |FINSI;
   |PINTA 1043, aAlfa;
|FPRC;
