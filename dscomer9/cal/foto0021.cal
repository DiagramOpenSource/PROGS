|FICHEROS;
     foto0021 #0; ||Exportacion
     foto0015 #1; ||Cabecera sobres
     foto0016 #2; ||Lineas sobres
     foto0x18 #3; ||Cabecera fantasma
     foto0z18 #4; ||Lineas fantasma
     foto0020 #5; ||Control path import
     foto0032 #6; ||Control path export
|FIN;

|VARIABLES;
     Dato="";
     Sobre="";
     i=0;
     Hora="";
     Fec=~;
     blanco1="         ";
     pintar="";
     path="";
     tiendainicial="";
     tiendafinal="";
     tiendaactual="";
     numerotienda=0;
|FIN;

||*************************************************************

|PROCESO ExportaFich;
     |ABRE #foto0x18;
     |PINTA 2163 , blanco1;
     pintar = #1#0;
     |PINTA 2163 , pintar;
     ||Actualizo los campos
     |PARA i = 0; |SI i [ 21; |HACIENDO i = i + 1;
          #3i = #1i; ||igualo todos los campos
     |SIGUE;
     #3#17="S";     || pongo exportado="S" para que ya no se vuelva a exportar
                    || una vez actualizado el registro original
     |GRABA 011#3n; || grabo el nuevo
     #1#17="S";
     |GRABA 011#1a; || grabo exportado="S"
     |ABRE #foto0z18;
     |BUCLELIN 2linsobre#1;     || Por cada una de las lineas del sobre
     |CIERRA #foto0z18;

|FPRC;

|PROCESO linsobre;        ||Lineas de sobre
||Actualizo los campos
     |PARA i = 0; |SI i [ 15; |HACIENDO i = i + 1;
          #4i = #2i;
     |SIGUE;

     |GRABA 011#4n;      ||Grabo en el fichero destino;
|FPRC;


|DEFBUCLE exporta;
#foto0015#3;
;
#foto0021#2,#foto0021#4,"R",#foto0021#0,"N";
#foto0021#3,#foto0021#5,"R",#foto0021#1,"N";
be;
NULL, ExportaFich;
|FIN;

||*************************************************************

|PROCESO Tipo3; |TIPO 3;
          tiendainicial=#foto0021#0;
          tiendafinal=#foto0021#1;
          tiendaactual=#foto0021#0;
          |ABRE #6;
          |SELECT #2#6;
       |PARA;|SI;|HACIENDO;
          #6#0=tiendaactual;
          |LEE 000#6=;
          |SI FSalida=0;
               path=#6#1;
               |QBF path;
               |PATH_DAT #3 path;   || Informo del camino de exportacion
               |ABRE #foto0x18;
               |DELINDEX #foto0x18;
               |CIERRA #foto0x18;
               |PATH_DAT #4 path;   || Informo del camino de exportacion
               |ABRE #foto0z18;
               |DELINDEX #foto0z18;
               |CIERRA #foto0z18;
               |ABRE #foto0015;
               |BUCLE exporta;
          |FINSI;
          numerotienda=tiendaactual+1;
          tiendaactual=numerotienda;
          |SI tiendaactual>tiendafinal;
               |ACABA;
          |FINSI;
     |SIGUE;
|FPRC;
