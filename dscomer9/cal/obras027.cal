
|FICHEROS;
    obras027  #0;  || Seleccion.
    obras006  #2;  || Lineas Presupuesto.
    obras001  #3;  || Obras.
    agifa079  #4;  || Facturas.(C).
    obras016  #5;  || Albaranes Asignados a Obras.
    agifa072  #6;  || Facturas.(L).
    agifa080  #7;  || Albaranes (L).
    agifa007  #8;  || Series........
    obrasf27  #10; || Fantasma Facturas Serie..........
    obras005  #9;  || Presupuestos..(C).................
|FIN;

|VARIABLES;
     aAlfa = "";
     nObra = 0;
    ficher = "";
    nFact  = 0;
    aSeri  = "";
    nPart  = 0;
    &tl    = 0;
    &total = 0;
    nSal   = 0;
    imp    = 0;
    topre  = 0;
    fFech  = @;
|FIN;

|PROCESO carga;
     #10#0 = nPart;
     #10#1 = aSeri;
     #10#2 = nFact;
     |LEE 041#10=;
     nSal = FSalida;
     |SI FSalida ! 0;
         |DDEFECTO #10;
         #10#7 = 0;
     |FINSI;
     #10#0 = nPart;
     #10#1 = aSeri;
     #10#2 = nFact;
     #10#3 = fFech;
     #10#4 = #4#2;
     #10#5 = #4#3;
     #10#6 = #4#74;
     #10#7 = #10#7 + #5#8;
     #10#8 = #9#3;
     #10#9 = #8#27;
     |SI nSal = 0; |GRABA 041#10a; |FINSI;
     |SI nSal ! 0; |GRABA 041#10n; |FINSI;
     |LIBERA #10;
|FPRC;

|PROCESO agifa080;
     #5#0 = #7#27;
     #5#1 = #7#0;
     #5#2 = #7#1;
     |LEE 101#5=;
     |SI FSalida = 0; |||Y #5#3 = #0#0;
         nPart = #5#5;   ||Partida;
         aSeri = #4#66;  ||Serie;
         nFact = #4#0;   ||N§ Factura.
         fFech = #4#1;   ||Fecha Factura.
         |DDEFECTO #8;
         #8#26 = #4#66;
         |LEE 000#8=;
         |DDEFECTO #9;
         #9#0 = #5#3;
         #9#1 = #5#4;
         #9#2 = #5#5;
         |LEE 000#9=;

         aAlfa = #9#5; |QBF aAlfa;
         |SI aAlfa ! "";             ||Es una copia
               |SI #0#5 = "O";
                    aAlfa = aAlfa % 103;
                    |DDEFECTO #9;
                    #9#0 = aAlfa;
                    #9#1 = #5#4;
                    #9#2 = #5#5;
                    |LEE 000#9=;
               |FINSI;
         |SINO;
               |SI #9#0 ! #0#0; |ACABA; |FINSI;
               |SI #9#4 ! #0#5; |ACABA; |FINSI;
         |FINSI;

         |HAZ carga;
         nFact = 0;
         fFech = "01.01.0000";
         |HAZ carga;
         aSeri = "";
         |HAZ carga;
     |FINSI;
     |LIBERA #5;
|FPRC;

|DEFBUCLE agifa080;
     #7#1;
     ;
     #6#17,#6#2,0;
     #6#17,#6#2,999;
     ;
     NULL,agifa080;
|FIN;

|PROCESO agifa072;
     |BUCLE agifa080;
|FPRC;

|DEFBUCLE leefac;
   #4#1;
   1;
   "    ",000000,#0#3;
   "zzzz",999999,#0#4;
   ;
   NULL,NULL,agifa072;
|FIN;

|PROCESO obrasf27;
    nFact = #10#2;
    aSeri = #10#1;
    |QBF aSeri;
    tl = 3;
    |SI nFact = 0;
          tl = 2;
    |FINSI;
    |SI aSeri = "";
          tl = 1;
          total = total - #10#7;
    |FINSI;
    |PRINT;
|FPRC;

|DEFBUCLE obrasf27;
     #10#2;
     ;
     #0#1, "    ", "01.01.0000",000000;
     #0#2, "zzzz", "31.12.9999",999999;
     ;
     NULL,obrasf27;
|FIN;

|PROCESO sacafa;
    tl = 0;
    total = topre;
    |PRINT;
    |BUCLE obrasf27;
|FPRC;

|PROCESO prolin;
     nObra = #9#0;
     aAlfa = #9#5; |QBF aAlfa;
     |SI aAlfa ! "";             ||Es una copia
           aAlfa = aAlfa % 103;
           |SI #9#0 ! #0#0; |Y aAlfa ! #0#0; |ACABA; |FINSI;
           |SI #0#5 = "O";
               |SI #9#0 ! #0#0;
                    |ACABA;
               |SINO;
                    nObra = aAlfa;
               |FINSI;
           |FINSI;
     |SINO;
           |SI #9#0 ! #0#0; |ACABA; |FINSI;
           |SI #9#4 ! #0#5; |ACABA; |FINSI;
     |FINSI;
     |SALVA_FICHA #2;
     #2#0 = nObra;
     |LEE 000#2=;

     |SI #2#7 = 0;
          imp = #2#8;
     |SINO;
          imp = (#2#7 * #2#8);
     |FINSI;
     topre = topre + imp;

     |REPON_FICHA #2;
|FPRC;

|DEFBUCLE leepre;
   #9#1;
   ;
   000,00,#0#1;
   999,99,#0#2;
   ;
   NULL,NULL,prolin;
|FIN;
/*
|DEFBUCLE leepre;
   #9#1;
   4;
   #0#0,00,#0#1, #0#5;
   #0#0,99,#0#2, #0#5;
   ;
   NULL,NULL,prolin;
|FIN;
*/
|PROCESO lista;  |TIPO 3;
     |IMPRE 0;
     |SI FSalida ! 0; |ACABA; |FINSI;
     |INFOR "obras027";
     |SI FSalida ! 0; |FINIMP; |ACABA; |FINSI;
          |BUCLE leepre;
          ficher = Usuario;
          |QBF ficher;
          |NOME_DAT #10 ficher;
          |DELINDEX #10;
          |ABRE #10;
          |ABRE #5;
          |ABRE #8;
          |ABRE #9;
          |BUCLE leefac;
          |HAZ sacafa;
          |CIERRA #10;
          |DELINDEX #10;
          |PIEINF;
          |CIERRA #5;
          |CIERRA #8;
          |CIERRA #9;
     |FININF;
     |FINIMP;
|FPRC;
