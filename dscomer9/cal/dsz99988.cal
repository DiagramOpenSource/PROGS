               VENTAS
|FICHEROS;
     dsz99988 #0,MANTE;
     referen@ #100;
     agifa010 #10;
     agifa024 #24;
     agifa027 #27;
     agifa036 #36;
     dsw00069 #69;
     agifa071 #71;
     agifa084 #84;
     agifa104 #104;
     agifa134 #134;
     agifa146 #146;
     agifa142 #142;
     dsm00279 #279;
     agifv110@;
|FIN;

|VARIABLES;
     &enErrorConta = 0;
     nSwEsc = 0;
     nTecla = 0;
     &eaFuerza = "";
     &eaCodigo = "";
     &enPosCli = 0;
     &eaCliSer = "";
     &eaSerCli = "";
     &enNum = 0;
     &eaSer = "";
     &enFacMasivaHuecos = 0;
     aAuxSer = "";
     fUltimo = @;
     &enMenuAuto = 0;
     nSwFechaPos = 0;
     &efFacPosterior = @;
     &enSwNuevaFecha = 0;

     nNum = 0;
     nUltimo = 0;
     aPath = "";
     &eaHuecosVipei = "";
     &eaHayHuecos = "";
     &eaSerHuecos = "";
     &enNumHueco = 0;
     &efFecHuecos = @;

     &nCon_Conta = 0;
     &aCon_Serie = "";

     &efFecConta = @;
     fFecha = @;
     nLin = 0;
     aDef = "";
     &eaDocu = "";
     &enSwMenu      = 0;
     &enCodigo      = 0;
     &enCodAlbNegro = 0;
     &eaSerie       = "";
     &enSwSimula    = 0;
     &enDesdeX      = 0;

 {-1}aMenu          = "";
     aMenu1         = "2400";
     aMenu2         = "1";
     aMenu3         = " Contador: ";
     aMenu4         = "AM";
     aMenu5         = " Automatico ";
     aMenu6         = " Manual ";
     aClave         = "";
     aSerie         = "";
     aAlfa          = "";
     nConta         = 0;
     nNume          = 0;
     nModo          = 0;
     nSalMenu       = 0;

     &eaSwClaveRepre= "";
     nConta2        = 0;
     aRef           = "";
|FIN;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO CompruConta;
     enErrorConta = 0;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo ! 1; |ACABA; |FINSI;

     |SI #142#137 = "F"; |ACABA; |FINSI;

     |SI #142#136 ! "S";
          aAlfa = ("000000" + nConta ) % -106;
          |SI #142#136 = "N";
               |SI nNume > nConta;
                    aAlfa = "0000Numero incorrecto. No puede ser mayor de " + aAlfa;
                    |MENAV aAlfa;
                    enErrorConta = 1;
                    |ERROR;
               |FINSI;
          |SINO;
               |SI nNume > nConta;
                    aAlfa = "0000Numero superior a " + aAlfa;
                    |MENAV aAlfa;
                    |CONFI "0000N풢sta Seguro?";
                    |SI FSalida ! 0;
                         enErrorConta = 1;
                         |ERROR;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO ContadorFic;
     |ABRE #142; |LEE 000#142p; |CIERRA #142;

     |SI enSwMenu = 0;
         |SI enDesdeX = 1;
             aMenu1 = "2800";
         |FINSI;
          |MENU aMenu
          nSalMenu = FSalida;
          enMenuAuto = FSalida;
          |SI nSalMenu ! 1; |ACABA; |FINSI;
     |FINSI;

     |SI #142#137 = "F";
          |ABRE #27;
          #27#2 = aSerie;
          #27#0 = aClave;
          |LEE  101#27=;
          |SI FSalida ! 0;
               #27#1 = 1;
               |GRABA 020#27b;
          |FINSI;
          nConta = #27#1;
          |SI enSwSimula = 0;       ||Lo usa la adj. de facturas ventas
               #27#1 = #27#1 + 1;
               |GRABA 020#27a;
          |FINSI;
          |CIERRA #27;
     |FINSI;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO ContaPV7; |TIPO 7;
     |SI enSwMenu = 0;
          nModo = (FEntrada/100) !  0;
          |SI nModo ! 1; |ACABA; |FINSI;
     |FINSI;
     eaSwClaveRepre = "";||Inicializa Sw Clave Representante ver 'dsz99995'

     nConta = 1;
     aSerie = #104#25;
     #104#0 = 999999;
     |LEE 000#104];
     |SI FSalida = 0;
          |LEE 000#104a;
     |SINO;
          |LEE 000#104u;
     |FINSI;
     |SI FSalida  = 0; |Y #104#25 = aSerie;
          nConta = #104#0 + 1;
     |FINSI;

     aClave = "vpedido";
     |HAZ ContadorFic;

     |DDEFECTO #104;
     #104#25 = aSerie;
     |SI enSwMenu = 0;       ||llamado por agifa166
          |SI nSalMenu = 1;
               #104#0 = nConta;
               |PTEC 802;
          |SINO;
               #104#0 = 1;
          |FINSI;
     |SINO;
          #104#0 = nConta;
     |FINSI;
     enSwMenu = 0;
|FPRC;

|PROCESO ContaPV0; |TIPO 0;
     |MODULO aAlfa;
     |SI aAlfa = "agifa104";  |O aAlfa = "albz0009";
          nNume = #104#0;
          |HAZ CompruConta;
     |FINSI;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO ContaAV7; |TIPO 7;
     |SI enSwMenu = 0;
          nModo = (FEntrada/100) !  0;
          |SI nModo ! 1; |ACABA; |FINSI;
     |FINSI;
     eaSwClaveRepre = "";||Inicializa Sw Clave Representante ver 'dsz99995'

     nConta = 1;
     aSerie = #10#52;
     #10#0 = 999999;
     |LEE 000#10];
     |SI FSalida = 0;
          |LEE 000#10a;
     |SINO;
          |LEE 000#10u;
     |FINSI;
     |SI FSalida  = 0; |Y #10#52 = aSerie;
          nConta = #10#0 + 1;
     |FINSI;

     aClave = "valbaran";
     |HAZ ContadorFic;

     |DDEFECTO #10;
     #10#52 = aSerie;
     |SI enSwMenu = 0;
          |SI nSalMenu = 1;
               #10#0 = nConta;
               |PTEC 802;
          |SINO;
               #10#0 = 1;
          |FINSI;
     |SINO;
          #10#0 = nConta;
     |FINSI;
     enSwMenu = 0;
|FPRC;

|PROCESO ContaAV0; |TIPO 0;
     nNume = #10#0;
     |HAZ CompruConta;
|FPRC;

|PROCESO ContaADJ;
     |SI enSwMenu = 0;
          nModo = (FEntrada/100) !  0;
          |SI nModo ! 1; |ACABA; |FINSI;
     |FINSI;
     eaSwClaveRepre = "";||Inicializa Sw Clave Representante ver 'dsz99995'

     |SALVA_DATOS #10;

     nConta = 1;
     aSerie = eaSerie;
     #10#52 = aSerie;
     #10#0 = 999999;
     |LEE 000#10];
     |SI FSalida = 0;
          |LEE 000#10a;
     |SINO;
          |LEE 000#10u;
     |FINSI;
     |SI FSalida  = 0; |Y #10#52 = aSerie;
          nConta = #10#0 + 1;
     |FINSI;

     aClave = "valbaran";
     |HAZ ContadorFic;

     |REPON_DATOS #10;
     enCodigo = nConta;
     enSwMenu = 0;
|FPRC;

|PROCESO ContadorNegro;
     |ABRE #24;
     #24#0 = #10#3;
     |LEE 000#24=;
     |SI FSalida ! 0; |DDEFECTO #24; |FINSI;
     |CIERRA #24;

     |SALVA_DATOS #10;

     nConta = 1;
     aSerie = #24#199;
     #10#52 = aSerie;
     #10#0 = 999999;
     |LEE 000#10];
     |SI FSalida = 0;
          |LEE 000#10a;
     |SINO;
          |LEE 000#10u;
     |FINSI;
     |SI FSalida  = 0; |Y #10#52 = aSerie;
          nConta = #10#0 + 1;
     |FINSI;

     aClave = "valbaran";
     |HAZ ContadorFic;

     enCodAlbNegro = nConta;
     |REPON_DATOS #10;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO ContaDE7; |TIPO 7;
     |SI enSwMenu = 0;
          nModo = (FEntrada/100) !  0;
          |SI nModo ! 1; |ACABA; |FINSI;
     |FINSI;
     eaSwClaveRepre = "";||Inicializa Sw Clave Representante ver 'dsz99995'

     nConta = 1;
     aSerie = #36#46;
     #36#0 = 999999;
     |LEE 000#36];
     |SI FSalida = 0;
          |LEE 000#36a;
     |SINO;
          |LEE 000#36u;
     |FINSI;
     |SI FSalida  = 0; |Y #36#46 = aSerie;
          nConta = #36#0 + 1;
     |FINSI;

     aClave = "vdepo";
     |HAZ ContadorFic;

     |DDEFECTO #36;
     #36#46 = aSerie;
     |SI enSwMenu = 0;
          |SI nSalMenu = 1;
               #36#0 = nConta;
               |PTEC 802;
          |SINO;
               #36#0 = 1;
          |FINSI;
     |SINO;
          #36#0 = nConta;
     |FINSI;
     enSwMenu = 0;
|FPRC;

|PROCESO ContaDE0; |TIPO 0;
     nNume = #36#0;
     |HAZ CompruConta;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO ContaFV7; |TIPO 7;
     |SI enSwMenu = 0;
          nModo = (FEntrada/100) !  0;
          |SI nModo ! 1; |ACABA; |FINSI;
     |FINSI;

     nConta = 1;
     aSerie = #134#49;
     #134#0 = 999999;
     |LEE 000#134];
     |SI FSalida = 0;
          |LEE 000#134a;
     |SINO;
          |LEE 000#134u;
     |FINSI;
     |SI FSalida  = 0; |Y #134#49 = aSerie;
          nConta = #134#0 + 1;
     |FINSI;
     |SI #142#26 = "S";
          |ABRE #84;
          #84#48 = aSerie;
          #84#0 = 999999;
          |LEE 000#84];
          |SI FSalida = 0;
               |LEE 000#84a;
          |SINO;
               |LEE 000#84u;
          |FINSI;
          nConta2 = 0;
          |SI FSalida  = 0; |Y #84#48 = aSerie;
               nConta2 = #84#0 + 1;
          |FINSI;
          |CIERRA #84;
          |SI nConta2 > nConta; nConta = nConta2; |FINSI;
     |SINO;
          |ABRE #84;
          #84#48 = aSerie;
          #84#0  = 1;
          |LEE 000#84];
          |SI FSalida = 0; |Y #84#48 = aSerie;
             |AVISO;
             |MENAV "    Esta serie se usa en facturas directas. Repase su configuracion de series.";
          |FINSI;
          |CIERRA #84;
     |FINSI;
     aClave = "vfactura";
     |HAZ ContadorFic;

     |DDEFECTO #134;
     #134#49 = aSerie;
     |SI enSwMenu = 0;
          |SI nSalMenu = 1;
               #134#0 = nConta;
               |PTEC 802;
          |SINO;
               #134#0 = 1;
          |FINSI;
     |SINO;
          #134#0 = nConta;
     |FINSI;
     enSwMenu = 0;
|FPRC;

|PROCESO ContaFV0; |TIPO 0;
     nNume = #134#0;
     |HAZ CompruConta;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO ContaFADJ;
     |DBASE aRef;
     aRef = aRef + "def/agifa134";
     |CARGA_DEF aRef, referen@;
     |SI FSalida ! 0;
          aRef = "0000Error al cargar " + aRef;
          |MENAV aRef;
          |ACABA;
     |FINSI;

     ||ARA. Huecos Vipei
     |DBASE aPath;
     aPath = aPath + "def/vipem004.mas";
     |XABRE "E", aPath, 0;
     |SI FSalida = 0;
          |SI enFacMasivaHuecos = 1;
               aSerie = eaSerie;
               |ABRE #100;
               |SI #142#26 = "S";
                    |ABRE #84;
                    #84#48 = aSerie;
                    #84#0 = 999999;
                    |LEE 000#84];
                    |SI FSalida = 0;
                         |LEE 000#84a;
                    |SINO;
                         |LEE 000#84u;
                    |FINSI;
                    |SI FSalida  = 0; |Y #84#48 = aSerie;
                         nConta = #84#0 + 1;
                    |SINO;
                         nConta = 1;
                    |FINSI;
                    |CIERRA #84;
                    #100#49 = aSerie;
                    #100#0 = 999999;
                    |LEE 000#100];
                    |SI FSalida = 0;
                         |LEE 000#100a;
                    |SINO;
                         |LEE 000#100u;
                    |FINSI;
                    nConta2 = 0;
                    |SI FSalida  = 0; |Y #100#49 = aSerie;
                         nConta2 = #100#0 + 1;
                    |SINO;
                         nConta2 = 1;
                    |FINSI;
                    |SI nConta2 > nConta; nConta = nConta2; |FINSI;
               |SINO;
                    #100#49 = aSerie;
                    #100#0 = 999999;
                    |LEE 000#100];
                    |SI FSalida = 0;
                         |LEE 000#100a;
                    |SINO;
                         |LEE 000#100u;
                    |FINSI;
                    |SI FSalida  = 0; |Y #100#49 = aSerie;
                         nConta = #100#0 + 1;
                    |SINO;
                         nConta = 1;
                    |FINSI;
               |FINSI;
               |CIERRA #100;
               ||ARA66
          |SINO;
               |SI eaHuecosVipei = "S";
                    eaHayHuecos = "N";
                    eaSerHuecos = eaSerie;
                    |HAZ MiraHuecosFVPLB;
                    |SI eaHayHuecos = "N";
                         |HAZ ContadorNormal;
                    |SINO;
                         nConta = enNumHueco;
                    |FINSI;
               |SINO;
                    |HAZ ContadorNormal;
               |FINSI;
          |FINSI;
     |SINO;
          |HAZ ContadorNormal;
     |FINSI;

     |DESCARGA_DEF #referen@;
     enCodigo = nConta;
     enSwMenu = 0;
|FPRC;

|PROCESO MiraHuecosFVPLB;
     ||ARA. ||TODO CCC

     |QBF eaSerHuecos;

     |ABRE #100;
     #100#49 = eaSerHuecos;
     #100#0 = 999999;
     |LEE 000#100];
     |SI FSalida = 0;
          |LEE 000#100a;
     |SINO;
          |LEE 000#100u;
     |FINSI;
     aAuxSer = #100#49;
     |QBF aAuxSer;
     |SI FSalida = 0; |Y aAuxSer = eaSerHuecos;
          nUltimo = #100#0;
     |SINO;
          eaHayHuecos = "S";
          enNumHueco = 1;
          |ACABA;
     |FINSI;

     ||Averiguo el ultimo numero de la serie
     ||Luego miro si hay huecos desde el 1 hasta el ultimo.

     fUltimo = "01.01.0000";
     enSwNuevaFecha = 0;
     nSwFechaPos = 0;
     eaHayHuecos = "N";
     |PARA nNum = 1; |SI nNum [ nUltimo; |HACIENDO nNum = nNum + 1;
          #100#49 = eaSerHuecos;
          #100#0 = nNum;
          |LEE 000#100=;
          |SI FSalida ! 0;
               |SI fUltimo [ efFecHuecos;
                    |SI nSwFechaPos = 0;
                         nSwFechaPos = 1;
                         enNumHueco = nNum;
                    |FINSI;
               |FINSI;
          |SINO;
               |SI nSwFechaPos = 1;
                    |SI #100#1 ] efFecHuecos;
                         eaHayHuecos = "S";
                         |SAL;
                    |FINSI;
                    nSwFechaPos = 0;
               |FINSI;
               fUltimo = #100#1;
          |FINSI;

/*
          |SI FSalida ! 0;
               |SI nSwFechaPos = 0;
                    eaHayHuecos = "S";
                    enNumHueco = nNum;
                    nSwFechaPos = 1;
               |FINSI;
          |SINO;
               |SI nSwFechaPos = 1;
                    enSwNuevaFecha = 1;
                    efFacPosterior = #100#1;
                    |SAL;
               |FINSI;
          |FINSI;
*/
     |SIGUE;
     |CIERRA #100;

     |SI eaHayHuecos = "N";
          |SI fUltimo [ efFecHuecos;
               eaHayHuecos = "S";
               enNumHueco = nUltimo + 1;
          |FINSI;
     |FINSI;
|FPRC;


|PROCESO ContadorNormal;
     enSwMenu = 1;
     nConta = 1;
     aSerie = eaSerie;
     |ABRE #100;
     |SI #142#26 = "S";
          |ABRE #84;
          #84#48 = aSerie;
          #84#0 = 999999;
          |LEE 000#84];
          |SI FSalida = 0;
               |LEE 000#84a;
          |SINO;
               |LEE 000#84u;
          |FINSI;
          |SI FSalida  = 0; |Y #84#48 = aSerie;
               nConta = #84#0 + 1;
          |FINSI;
          |CIERRA #84;
          #100#49 = aSerie;
          #100#0 = 999999;
          |LEE 000#100];
          |SI FSalida = 0;
               |LEE 000#100a;
          |SINO;
               |LEE 000#100u;
          |FINSI;
          nConta2 = 0;
          |SI FSalida  = 0; |Y #100#49 = aSerie;
               nConta2 = #100#0 + 1;
          |FINSI;
          |SI nConta2 > nConta; nConta = nConta2; |FINSI;
     |SINO;
          #100#49 = aSerie;
          #100#0 = 999999;
          |LEE 000#100];
          |SI FSalida = 0;
               |LEE 000#100a;
          |SINO;
               |LEE 000#100u;
          |FINSI;
          |SI FSalida  = 0; |Y #100#49 = aSerie;
               nConta = #100#0 + 1;
          |FINSI;
     |FINSI;
     |CIERRA #100;
     aClave = "vfactura";
     |HAZ ContadorFic;
|FPRC;

컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO ContaPR7; |TIPO 7;
     |SI enSwMenu = 0;
          nModo = (FEntrada/100) !  0;
          |SI nModo ! 1; |ACABA; |FINSI;
     |FINSI;
/*
|| quitado segun  Subtiquet nro. 00112.0013 Cliente: 003679
     |HAZ EsMecanogra;
     |SI FSalida = 0;
          #104#25 = #146#48;
          |HAZ ContaPV7;
          |DDEFECTO #146;
          #146#48 = #104#25;
          #146#0 = #104#0;
          |ACABA;
     |FINSI;
*/
     nConta = 1;
     aSerie = #146#48;
     #146#0 = 999999;
     |LEE 000#146];
     |SI FSalida = 0;
          |LEE 000#146a;
     |SINO;
          |LEE 000#146u;
     |FINSI;
     |SI FSalida  = 0; |Y #146#48 = aSerie;
          nConta = #146#0 + 1;
     |FINSI;

     aClave = "vfacprof";
     |HAZ ContadorFic;

     |DDEFECTO #146;
     #146#48 = aSerie;
     |SI enSwMenu = 0;
          |SI nSalMenu = 1;
               #146#0 = nConta;
               |PTEC 802;
          |SINO;
               #146#0 = 1;
          |FINSI;
     |SINO;
          #146#0 = nConta;
     |FINSI;
     enSwMenu = 0;
|FPRC;

|PROCESO ContaPR0; |TIPO 0;
     nNume = #146#0;
     |HAZ CompruConta;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO ContaFD7; |TIPO 7;
  |||   |HAZ EsProduccion;
  |||   |SI FSalida = 0; |HAZ Conta_FD7; |ACABA; |FINSI;

     |SI enSwMenu = 0;
          nModo = (FEntrada/100) !  0;
          |SI nModo ! 1; |ACABA; |FINSI;
     |FINSI;

     |ABRE #142; |LEE 000#142p; |CIERRA #142;

     nConta = 1;
     aSerie = #84#48;
     |SI #142#26 = "S";
          #84#0 = 999999;
          |LEE 000#84];
          |SI FSalida = 0;
               |LEE 000#84a;
          |SINO;
               |LEE 000#84u;
          |FINSI;
          |SI FSalida  = 0; |Y #84#48 = aSerie;
               nConta = #84#0 + 1;
          |FINSI;
          |ABRE #134;
          #134#49 = aSerie;
          #134#0 = 999999;
          |LEE 000#134];
          |SI FSalida = 0;
               |LEE 000#134a;
          |SINO;
               |LEE 000#134u;
          |FINSI;
          nConta2 = 0;
          |SI FSalida  = 0; |Y #134#49 = aSerie;
               nConta2 = #134#0 + 1;
          |FINSI;
          |CIERRA #134;
          |SI nConta2 > nConta; nConta = nConta2; |FINSI;
          aClave = "vfactura";
     |SINO;
          |ABRE #134;
          #134#49 = aSerie;
          #134#0  = 1;
          |LEE 000#134];
          |SI FSalida = 0; |Y #134#49 = aSerie;
             |AVISO;
             |MENAV "    Esta serie se usa en facturas de venta. Repase su configuracion de series.";
          |FINSI;
          |CIERRA #134;

          #84#0 = 999999;
          |LEE 000#84];
          |SI FSalida = 0;
               |LEE 000#84a;
          |SINO;
               |LEE 000#84u;
          |FINSI;
          |SI FSalida  = 0; |Y #84#48 = aSerie;
               nConta = #84#0 + 1;
          |FINSI;
          aClave = "vfactuco";
     |FINSI;

     |HAZ ContadorFic;

     |DDEFECTO #84;
     #84#48 = aSerie;
     |SI enSwMenu = 0;       ||llamado por agifa166
          |SI nSalMenu = 1;
               #84#0 = nConta;
               |PTEC 802;
          |SINO;
               #84#0 = 1;
          |FINSI;
     |SINO;
          #84#0 = nConta;
     |FINSI;
     enSwMenu = 0;
|FPRC;

|PROCESO ContaFD0; |TIPO 0;
     ||| |HAZ EsProduccion;
     ||| |SI FSalida = 0; |HAZ Conta_FD0; |ACABA; |FINSI;
     nNume = #84#0;
     |HAZ CompruConta;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO DefSerVta; |TIPO 7;
     nModo = (FEntrada / 100) ! 0;
     |ABRE #142; |LEE 000#142p; |CIERRA #142;
     |ABRE #279; |LEE 000#279p; |CIERRA #279;
     eaSerCli = "";
     eaCliSer = "";
     |MODULO aAlfa;
     |SI #142#185 = "S";
          |SI aAlfa = "agifa104"; #104#25 = #142#186; |FINSI;
          |SI aAlfa = "agifa036"; #36#46 = #142#187; |FINSI;
          |SI aAlfa = "agifa210"; #10#52 = #142#188; |FINSI;
          |SI aAlfa = "agifa010"; #10#52 = #142#188; |FINSI;
          |SI aAlfa = "agifa134"; #134#49 = #142#189; |FINSI;
          |SI aAlfa = "agifa084"; #84#48 = #142#190; |FINSI;
          |SI aAlfa = "agifa146"; #146#48 = #142#191; |FINSI;
          |SI aAlfa = "dsm01000"; #10#52 = #142#186; |FINSI;
          |SI aAlfa = "agifa033"; #10#52 = #142#187; |FINSI;
     |FINSI;
     |SI nModo = 1; |Y #279#24 = "S";
          |HAZ SerCli;
     |FINSI;

     |SI nModo = 1;
          |HAZ EsForestales;
          |SI FSalida = 0;
               |MODULO aAlfa;
               |SI aAlfa = "agifa104"; |C_P #104Campo, 0, enNum; |FINSI;
               |SI aAlfa = "agifa036"; |C_P #36Campo, 0, enNum; |FINSI;
               |SI aAlfa = "agifa210"; |C_P #10Campo, 0, enNum; |FINSI;
               |SI aAlfa = "agifa010"; |C_P #10Campo, 0, enNum; |FINSI;
               ||SI aAlfa = "agifa134"; |C_P #134Campo, 0, enNum; |FINSI;
               |SI aAlfa = "agifa134"; |ACABA; |FINSI;
               |SI aAlfa = "agifa084"; |C_P #84Campo, 0, enNum; |FINSI;
               |SI aAlfa = "agifa146"; |C_P #146Campo, 0, enNum; |FINSI;
               |SI aAlfa = "agifa033"; |C_P #10Campo, 0, enNum; |FINSI;
               |PUSHV 0501 2380;
               |SUB_EJECUTA_NP "goma0007;GES";
               |POPV;
               |SI eaSer = "";
                    |PTEC 807;
               |SINO;
                    |SI aAlfa = "agifa104"; #104Campo = eaSer; |FINSI;
                    |SI aAlfa = "agifa036"; #36Campo = eaSer; |FINSI;
                    |SI aAlfa = "agifa210"; #10Campo = eaSer; |FINSI;
                    |SI aAlfa = "agifa010"; #10Campo = eaSer; |FINSI;
                    |SI aAlfa = "agifa134"; #134Campo = eaSer; |FINSI;
                    |SI aAlfa = "agifa084"; #84Campo = eaSer; |FINSI;
                    |SI aAlfa = "agifa146"; #146Campo = eaSer; |FINSI;
                    |SI aAlfa = "agifa033"; #10Campo = eaSer; |FINSI;
                    |PTEC 802;
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO Contador_Fic;
     |SI enSwMenu = 0;
          |SI enDesdeX = 1;
               aMenu1 = "2700";
          |FINSI;
          |MENU aMenu
          nSalMenu = FSalida;
          |SI nSalMenu ! 1; |ACABA; |FINSI;
     |FINSI;

     |SI #142#137 = "F";
          nConta = #100#4;
          |SI enSwSimula = 0;       ||Lo usa la adj. de facturas ventas
               #100#4 = #100#4 + 1;
          |FINSI;
     |SINO;
          #100#4 = nConta;
     |FINSI;
     |SI nConta < #100#7; |O nConta > #100#8;
          aAlfa = ("000000" + nConta) % -106;
          aAlfa = "0000Contador [" + aAlfa + "] fuera de limites...";
          |MENAV aAlfa;
          |ERROR; |PTEC 807;
     |SINO;
          |GRABA 020#100a;
     |FINSI;
     |LIBERA #100;
|FPRC;

|PROCESO BusConta;
     |SI fFecha ] #100#5; |Y fFecha [ #100#6;
          nLin = #100#2;
          |ERROR10;
     |FINSI;
|FPRC;

|DEFBUCLE BusConta;
     #100#1003;
     9;
     aSerie, aClave, 001, "S";
     aSerie, aClave, 999, "S";
     ;
     NULL, BusConta;
|FIN;

|PROCESO CargaConta;
     #69#0 = #100#0;
     |LEE 000#69=;
     |SI FSalida ! 0;
          #69#0 = #100#0;
          #69#1 = #100#3;
          |GRABA 020#69n;
     |FINSI;
|FPRC;

|DEFBUCLE CargaConta;
     #100#1003;
     9, 5, 6;
     "     ", aClave, 001, "S", "01.01.0000", fFecha;
     "zzzzz", aClave, 999, "S", fFecha, "31.12.9999";
     ;
     NULL, CargaConta;
|FIN;
-----------------------------------------------
|PROCESO Conta_FD7; |TIPO 7;
     |ABRE #142; |LEE 000#142p; |CIERRA #142;
     nModo = (FEntrada/100) !  0;
     |SI enSwMenu = 0;
          |SI nModo ! 1; |ACABA; |FINSI;
     |FINSI;

     |C_M #84#1, 1, "S";
     |SI nModo ! 1; |ACABA; |FINSI;
     |ENCAMPO #1#84; efFecConta = #84#1;
     |SI FSalida ! 0; |PTEC 807; |ACABA; |FINSI;
     |C_M #84#1, 1, "N";

     |DDEF aDef; aDef = aDef + "dsm00131";
     |CARGA_DEF aDef, referen@;
     |SI FSalida ! 0;
          |MENAV "0000Error al cargar 'dsm00131'";
          |ACABA;
     |FINSI;
     aSerie = #84#48;
     fFecha = #84#1;
     |SI #142#26 = "S";
          aClave = "vfactura";
     |SINO;
          aClave = "vfactuco";
     |FINSI;
     nLin = 0;
     nConta = 1;
     |BUCLE BusConta;
     |SI nLin = 0;
          |MENAV "0000ERROR. No existe contador...";
          |ERROR; |PTEC 807;
     |SINO;
          |SI #142#26 = "S";
               #84#0 = 999999;
               |LEE 000#84];
               |SI FSalida = 0;
                    |LEE 000#84a;
               |SINO;
                    |LEE 000#84u;
               |FINSI;
               |SI FSalida  = 0; |Y #84#48 = aSerie;
                    nConta = #84#0 + 1;
               |FINSI;
               |ABRE #134;
               #134#49 = aSerie;
               #134#0 = 999999;
               |LEE 000#134];
               |SI FSalida = 0;
                    |LEE 000#134a;
               |SINO;
                    |LEE 000#134u;
               |FINSI;
               nConta2 = 0;
               |SI FSalida  = 0; |Y #134#49 = aSerie;
                    nConta2 = #134#0 + 1;
               |FINSI;
               |CIERRA #134;
               |SI nConta2 > nConta; nConta = nConta2; |FINSI;
          |SINO;
               |ABRE #134;
               #134#49 = aSerie;
               #134#0  = 1;
               |LEE 000#134];
               |SI FSalida = 0; |Y #134#49 = aSerie;
                    |AVISO;
                    |MENAV "    Esta serie se usa en facturas de venta. Repase su configuracion de series.";
               |FINSI;
               |CIERRA #134;

               #84#0 = 999999;
               |LEE 000#84];
               |SI FSalida = 0;
                    |LEE 000#84a;
               |SINO;
                    |LEE 000#84u;
               |FINSI;
               |SI FSalida  = 0; |Y #84#48 = aSerie;
                    nConta = #84#0 + 1;
               |FINSI;
          |FINSI;
          |ABRE #100;
          #100#0 = aSerie;
          #100#1 = aClave;
          #100#2 = nLin;
          |LEE 121#100=;
          |SI FSalida = 0;
               |HAZ Contador_Fic;
               |DDEFECTO #84;
               #84#48 = aSerie;
               |SI enSwMenu = 0;       ||llamado por agifa166
                    |SI nSalMenu = 1;
                         #84#0 = nConta;
                         |PTEC 802;
                    |SINO;
                         #84#0 = 1;
                    |FINSI;
               |SINO;
                    #84#0 = nConta;
               |FINSI;
               enSwMenu = 0;
          |FINSI;
          |CIERRA #100;
     |FINSI;
     |DESCARGA_DEF #referen@;
|FPRC;

|PROCESO Conta_FD0; |TIPO 0;
     nModo = (FEntrada/100) !  0;
     |SI nModo ! 1; |ACABA; |FINSI;

     #84#1 = efFecConta;

     |DDEF aDef; aDef = aDef + "dsm00131";
     |CARGA_DEF aDef, referen@;
     |SI FSalida ! 0;
          |MENAV "0000Error al cargar 'dsm00131'";
          |ACABA;
     |FINSI;
     aSerie = #84#48;
     fFecha = #84#1;
     |SI #142#26 = "S";
          aClave = "vfactura";
     |SINO;
          aClave = "vfactuco";
     |FINSI;
     nLin = 0;
     nConta = #84#0;
     |BUCLE BusConta;
     |SI nLin = 0;
          |MENAV "0000ERROR. No existe contador...";
          |ERROR;
     |SINO;
          |ABRE #100;
          #100#0 = aSerie;
          #100#1 = aClave;
          #100#2 = nLin;
          |LEE 020#100=;
          |SI FSalida = 0;
               |SI nConta < #100#7; |O nConta > #100#8;
                    |MENAV "0000Contador fuera de limites...";
                    |ERROR;
               |FINSI;
          |FINSI;
          |CIERRA #100;
     |FINSI;
     |DESCARGA_DEF #referen@;
|FPRC;

|PROCESO SerAct084; |TIPO 6;
     |SI FSalida ! 10; |ACABA; |FINSI;

     |DDEF aDef; aDef = aDef + "dsm00131";
     |CARGA_DEF aDef, referen@;
     |SI FSalida ! 0;
          |MENAV "0000Error al cargar 'dsm00131'";
          |ACABA;
     |FINSI;

     fFecha = #84#1;
     |SI #142#26 = "S";
          aClave = "vfactura";
     |SINO;
          aClave = "vfactuco";
     |FINSI;

     aAlfa = Usuario;
     |NOME_DAT #69 aAlfa;
     |DELINDEX #69;
     |ABRE #69;
     |BUCLE CargaConta;
     #69#0 = #84#48;
     |LEE 000#69];
     |CONSULTA_CLAVE #1#69;
     |SI FSalida = 0;
          #84#48 = #69#0; |PINTA #84#48;
     |SINO;
          |ERROR;
     |FINSI;
     |DELINDEX #69;

     |DESCARGA_DEF #referen@;
|FPRC;
==================Contador FV para PCEgroup========================
|VARIABLES;
     fFec = @;
     nHueco = 0;
     i = 0;
|FIN;

|PROCESO ContaHuecoFV;
     fFec = ~;        || Siempre es la del dia

     nConta = 1;
     aSerie = #134#49;
     #134#0 = 999999;
     |LEE 000#134];
     |SI FSalida = 0;
          |LEE 000#134a;
     |SINO;
          |LEE 000#134u;
     |FINSI;
     |SI FSalida  = 0; |Y #134#49 = aSerie;
          nConta = #134#0 + 1;
     |FINSI;

     |SI #142#26 = "S";
          |ABRE #84;
          #84#48 = aSerie;
          #84#0 = 999999;
          |LEE 000#84];
          |SI FSalida = 0;
               |LEE 000#84a;
          |SINO;
               |LEE 000#84u;
          |FINSI;
          nConta2 = 0;
          |SI FSalida  = 0; |Y #84#48 = aSerie;
               nConta2 = #84#0 + 1;
          |FINSI;
          |CIERRA #84;
          |SI nConta2 > nConta; nConta = nConta2; |FINSI;
     |SINO;
/*
          |ABRE #84;
          #84#48 = aSerie;
          #84#0  = 1;
          |LEE 000#84];
          |SI FSalida = 0; |Y #84#48 = aSerie;
               |AVISO;
               |MENAV "    Esta serie se usa en facturas directas. Repase su configuracion de series.";
          |FINSI;
          |CIERRA #84;
*/
     |FINSI;

     |SI #142#137 = "F";
          aClave = "vfactura";
          |ABRE #27;
          #27#2 = aSerie;
          #27#0 = aClave;
          |LEE  101#27=;
          |SI FSalida ! 0;
               #27#1 = 1;
               |GRABA 020#27b;
          |FINSI;
          nConta = #27#1;
     |FINSI;

     || Busca un hueco de la misma fecha
     nHueco = nConta;
     nConta = nConta - 1;
     |PARA i = nConta; |SI i > 1; |HACIENDO i = i - 1;
          #134#49 = aSerie;
          #134#0 = i;
          |LEE 000#134=;
          |SI FSalida = 0;
               |SI #134#1 < fFec; |SAL; |FINSI;
          |SINO;
               nHueco = i;
          |FINSI;
     |SIGUE;

     |SI #142#137 = "F";      || Incremeta el contador si procede
          |SI nHueco = #27#1;
               #27#1 = #27#1 + 1;
               |GRABA 020#27a;
          |FINSI;
          |CIERRA #27;
     |FINSI;

     |DDEFECTO #134;
     #134#49 = aSerie;
     #134#0 = nHueco;
     #134#1 = fFec;
     |PARA; |SI; |HACIENDO;        || Para asegurar que no existe
          |GRABA 000#134b;
          |SI FSalida = 0; |SAL; |FINSI;
          nHueco = nHueco + 1;
          #134#0 = nHueco;
     |SIGUE;
|FPRC;
------------
|PROCESO MinSerCli;
     #agifv110@#0 = #0#0;
     #agifv110@#1 = "     ";
|FPRC;

|PROCESO MaxSerCli;
     #agifv110@#0 = #0#0;
     #agifv110@#1 = "zzzzz";
|FPRC;

|PROCESO CliSer6; |TIPO 6;
     nTecla = FSalida;
|FPRC;

|PROCESO CliSer0; |TIPO 0;
|| Anulado ya que ahora si se pulda enter en el grid de clientes
|| devuelve en ntecla = 1 y no entra en el proceso
||     |SI nTecla = 1; |ACABA; |FINSI; || Escape

     |SI nTecla = 11; |O #142#102 = "S"; |O #142#102 = "X";|| F3 Observaciones
          eaFuerza = "N";
          |SI nTecla = 11; eaFuerza = "S"; |FINSI;
          eaCodigo = #0#0;
          |SUB_EJECUTA_NP "dsz99994";
          |SI nTecla = 11; |ERROR; |ACABA; |FINSI;
     |FINSI;

     |DDEF aAlfa;
     aAlfa = aAlfa + "agifv110";
     |CARGA_DEF aAlfa, agifv110@;
     |SI FSalida = 0;
          |ABRE #agifv110@;
          #agifv110@#0 = #0#0;
          #agifv110@#1 = "";
          |LEE 000#agifv110@.];
          |SI FSalida = 0; |Y #agifv110@#0 = #0#0;
               eaSerCli = #agifv110@#1;
               |LEE  000#agifv110@.s;
               |SI FSalida = 0; |Y #agifv110@#0 = #0#0;
                    |LEE  000#agifv110@.a;
                    |CONSULTA_F_CLAVE #1#agifv110@, MinSerCli, MaxSerCli;
                    |SI FSalida = 0;
                         eaSerCli = #agifv110@#1;
                    |SINO;
                         |ERROR;
                    |FINSI;
               |FINSI;
          |SINO;
               |MENAV "0000Cliente sin series definidas...";
               |ERROR;
          |FINSI;
          |CIERRA #agifv110@;
          |DESCARGA_DEF #agifv110@;
     |FINSI;
|FPRC;

|PROCESO CliSer12; |TIPO 12;
     |SI FSalida = 1; nSwEsc = 1; |FINSI;
|FPRC;

|PROCESO SerCli;
     |SI aAlfa = "dsm01000"; |ACABA; |FINSI;

     |C_P #0#0, 1, enPosCli;
     nSwEsc = 0;
     enPosCli = 0;
     |DDEFECTO #0;
     |ENDATOS #1#0;
     |SI FSalida = 0; |Y nSwEsc = 0;
          eaCliSer = #0#0;
     |SINO;
          eaCliSer = "";
          eaSerCli = "";
     |FINSI;
|FPRC;
