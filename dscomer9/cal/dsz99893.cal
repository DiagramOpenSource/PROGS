|FICHEROS;
     evarm004 #1;
     agifa019 #19;
     agifa073 #73;
     agifa071 #71;
     agifa104 #104;

     evarm003@;
     evarm012@;
     evarm014@;
     evarm015@;
     evarm005@;
     evarm021@;
|FIN;

|VARIABLES;
     &eaMenEva = 0; || lo usa evaz0007 con valor = 1 para que no avise
     &enForma = 0;
     i = 0;
     nUni = 0;
     aIncr = "";
     nPrime = 0;
     nOk = 0;
     aPath = "";
     Camino = "";
     nGuarda = 0;
     suma = 0;
     nModo = 0;
     uni = 0;
     talla = "";
     tt = "";
     etiq = "";
     bultos = 0;
     cta1 = "";
     cta = "";
     aPrime = "";
     aUlti = "";
     aBase = "";
     nPorce = 0;
     aAlfa = "";
|FIN;

|PROCESO EtiquetaBase;
     etiq = #73#0;
     etiq = "000000" + etiq;
     etiq = etiq % "-106";

     cta1 = #73#1;
     cta = "00" + cta1;
     cta = cta % "-102";

     etiq = etiq + cta;
     etiq = etiq + tt;

     aBase = etiq;
|FPRC;

|PROCESO EvaCargaDef;
     |DDEF aPath;
     Camino = aPath + "evarm003.mas";
     |CARGA_DEF Camino, evarm003@;
     |SI FSalida ! 0;|ACABA;|FINSI;

     Camino = aPath + "evaetiqa.mas";
     |CARGA_DEF Camino, evarm005@;
     |SI FSalida ! 0;|ACABA;|FINSI;

     Camino = aPath + "evarm012.mas";
     |CARGA_DEF Camino, evarm012@;
     |SI FSalida ! 0;|ACABA;|FINSI;

     Camino = aPath + "evarm021.mas";
     |CARGA_DEF Camino, evarm021@;
|FPRC;

|PROCESO EvaDescarga;
     |DESCARGA_DEF #evarm021@;
     |DESCARGA_DEF #evarm012@;
     |DESCARGA_DEF #evarm005@;
     |DESCARGA_DEF #evarm003@;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
Llamadas del plb
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴

|PROCESO EvaPinFecTope;
     |HAZ EvaCargaDef;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |DDEFECTO #evarm012@;
     |ABRE #evarm012@;
     #evarm012@#0 = #73#28; ||serie
     #evarm012@#1 = #73#0; ||numero
     #evarm012@#2 = #73#1; ||linea
     |LEE 000#evarm012@.=;
     |SI FSalida ! 0;
          #evarm012@#3 = #73#13; ||Fecha
     |FINSI;
     |CIERRA #evarm012@;
     |PINTA #evarm012@#3;
     |PINTA 1057, "F.Tope...:";

     |HAZ EvaDescarga;
|FPRC;

|PROCESO EvaEntFecTope;
     |HAZ EvaCargaDef;
     |SI FSalida ! 0; |ACABA; |FINSI;

     nModo = (FEntrada / 100) ! 0;
     |ABRE #evarm012@;
     #evarm012@#0 = #73#28; ||serie
     #evarm012@#1 = #73#0; ||numero
     #evarm012@#2 = #73#1; ||linea
     #evarm012@#3 = #73#13; ||Fecha
     |LEE 101#evarm012@.=;
     |SI nModo = 1;
          #evarm012@#3 = #73#13; ||Fecha
     |FINSI;
     |SI FSalida ! 0; |GRABA 020#evarm012@.b; |FINSI;
     |ENCAMPO #3#evarm012@;
     |GRABA 020#evarm012@.a;
     |CIERRA #evarm012@;

     |HAZ EvaDescarga;
|FPRC;

|PROCESO EvaUniRepe;
     |DDEF aPath;
     Camino = aPath + "evarm014.mas";
     |CARGA_DEF Camino, evarm014@;
     |SI FSalida ! 0;|ACABA;|FINSI;

     Camino = aPath + "evarm015.mas";
     |CARGA_DEF Camino, evarm015@;
     |SI FSalida ! 0;|ACABA;|FINSI;

     |ABRE #evarm014@; |LEE 000#evarm014@.p; |CIERRA #evarm014@;
     |ABRE #19;
     #19#0 = #73#2;
     |LEE 000#19=;
     |CIERRA #19;
     nOk = 0;
     |SI #19#3 ] #evarm014@#3; |Y #19#3 [ #evarm014@#4; nOk = 1; |FINSI;
     |SI #19#3 ] #evarm014@#5; |Y #19#3 [ #evarm014@#6; nOk = 1; |FINSI;
     |SI #19#3 ] #evarm014@#7; |Y #19#3 [ #evarm014@#8; nOk = 1; |FINSI;
     |SI #19#3 ] #evarm014@#9; |Y #19#3 [ #evarm014@#10; nOk = 1; |FINSI;
     |SI #19#3 ] #evarm014@#11; |Y #19#3 [ #evarm014@#12; nOk = 1; |FINSI;
     |SI #19#3 ] #evarm014@#13; |Y #19#3 [ #evarm014@#14; nOk = 1; |FINSI;
     |SI #19#3 ] #evarm014@#15; |Y #19#3 [ #evarm014@#16; nOk = 1; |FINSI;
     |SI #19#3 ] #evarm014@#17; |Y #19#3 [ #evarm014@#18; nOk = 1; |FINSI;
     |SI #19#3 ] #evarm014@#19; |Y #19#3 [ #evarm014@#20; nOk = 1; |FINSI;
     |SI #19#3 ] #evarm014@#21; |Y #19#3 [ #evarm014@#22; nOk = 1; |FINSI;
     |SI #19#3 ] #evarm014@#23; |Y #19#3 [ #evarm014@#24; nOk = 1; |FINSI;
     |SI nOk ! 0;
          |ABRE #evarm015@;
          |DDEFECTO #evarm015@;
          #evarm015@#3 = #104#4;
          #evarm015@#0 = #73#2; || Anulado Subtiquet nro. 00105.0003 Cliente: 000837
          |LEE 101#evarm015@.=;
          |SI FSalida ! 0; |GRABA 020#evarm015@.b; |FINSI;
          |SI #73#0 < #evarm014@#1;  || Pedido Incial
               #evarm015@#1 = #evarm015@#1 + (#73#5 * enForma);
          |SINO;              || Pedido de Repeticion
               #evarm015@#2 = #evarm015@#2 + (#73#5 * enForma);
          |FINSI;
          |GRABA 020#evarm015@.a;
          |CIERRA #evarm015@;
          |SI #evarm014@#2 ! 0; |Y enForma = 1;
               nPorce = 100 * #evarm015@#2 / #evarm015@#1;
               |SI nPorce ] #evarm014@#2; |Y eaMenEva = 0;
                    nPorce = nPorce ! 2;
                    |AVISO;
                    aAlfa = "0000Superado Porcentaje Repeticion: %" + nPorce;
                    |MENAV aAlfa;
               |FINSI;
          |FINSI;
     |FINSI;

     |DESCARGA_DEF #evarm015@;
     |DESCARGA_DEF #evarm014@;

     |HAZ EvaArtNormal;
|FPRC;


|PROCESO EvaImpUniFac;
     |ABRE #1;
     #1#30 = #71#31;
     #1#31 = #71#12;
     #1#32 = #71#21;
     |LEE 000#1=;
     |SI FSalida ! 0; |DDEFECTO #1; |FINSI;
     |CIERRA #1;
|FPRC;

|PROCESO ModiIncr;
     aAlfa = #1#36;
     |C_M #1#37, 1, aAlfa;
     |C_M #1#38, 1, aAlfa;
|FPRC;

|PROCESO EvaArtNormal;
     nUni = 0;
     |ABRE #1;
     #1#30 = #73#28;
     #1#31 = #73#0
     #1#32 = #73#1;
     |LEE 000#1=;
     |SI FSalida = 0;
          |PARA i = 3; |SI i [ 15; |HACIENDO i = i + 1;
               nUni = nUni + #1#i#;
          |SIGUE;
          nUni = nUni + #1#27#;
     |FINSI;
     |CIERRA #1;

     |SI nUni ! 0; |ACABA; |FINSI; || Si es 0 es un articulo normal (sin tallas)

     Camino = aPath + "evar0021.mas";
     |CARGA_DEF Camino, evarm021@;
     |SI FSalida ! 0;|ACABA;|FINSI;
     |DDEFECTO #evarm021@;
     |ABRE #evarm021@;
     #evarm021@#4 = #73#28;
     #evarm021@#5 = #73#0;
     #evarm021@#6 = #73#1;
     |SI enForma = 1;
          |LEE 101#evarm021@.=;
          |SI FSalida ! 0; |GRABA 020#evarm021@.b; |FINSI;
          #evarm021@#1 = #73#2;
          #evarm021@#3 = #1#29;
          #evarm021@#7 = #1#28;
          #evarm021@#10 = #104#4;
          #evarm021@#12 = #73#5;
          #evarm021@#13 = #73#5;
          #evarm021@#11 = "N";
          |GRABA 020#evarm021@.a;
     |SINO;
          |BORRA 020#evarm021@.c;
     |FINSI;
     |CIERRA #evarm021@;
     |DESCARGA_DEF #evarm021@;
|FPRC;
