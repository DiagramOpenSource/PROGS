LOS CAMPOS AUX_? DEL 51 al 88
para ver que significan mirar el 'tecaz024', son todos los de la pantalla
Se ha creado el 'tecam027' con cabecera datos del agifa017

El dsm00001 tiene una copia de este calculo y como datos el agifa017

|FICHEROS;
     agifa019 #0;
     agifa017 #1;
     agifa142 #2;
     agifa029 #3;
     agifa321 #4;
     agifa324 #5;
     dsl00001 #6; ||Codigos de barras multiples
     dsm00010 #910;
     dsm00238 #238;
     refere1@;
|FIN;

|CAMPOS;
     #0#9 pcma;
     #1#3 vskl;          || Valor stock.
     #1#5 stl;           || Stock.
     #1#4 pdvl;          || Stock pte.valorar.

     #0#15  art_pser;
     #0#182 art_pser2;
     #0#16  art_prec;
     #0#183 art_prec2;
     #0#17  art_pval;
     #0#11  art_nece;
     #0#12  art_rese;
     #0#14  art_depo;
     #0#184 art_depo2;
     #0#13  art_fabr;
     #0#10  art_vsto;
     #0#7   art_mini;
     #0#8   art_maxi;
     #0#6   art_tota;
     #0#185 art_tota2;
     #0#104 art_disp;
     #0#193 art_disp2;
     #0#9   art_pcm;

     #1#42  alm_pser;
     #1#44  alm_pser2;
     #1#43  alm_prec;
     #1#45  alm_prec2;
     #1#4   alm_pval;
     #1#50  alm_nece;
     #1#8   alm_rese;
     #1#10  alm_depo;
     #1#46  alm_depo2;
     #1#9   alm_fabr;
     #1#3   alm_vsto;
     #1#6   alm_mini;
     #1#7   alm_maxi;
     #1#5   alm_tota;
     #1#47  alm_tota2;
     #1#39  alm_disp;
     #1#48  alm_disp2;
|FIN;

|VARIABLES;
     nSal = 0;
     aArti = "";
     j = 0;
     nPos1 = 0;
     nPos2 = 0;
     nCamDes = 0;
     nCamLon = 0;
     nPosArt = 0;
     nPosDes = 0;
     nLon2 = 0;
     nLon1 = 0;
     nPos = 0;
     aDes = "";
     aGuarda = "";
     nCampo = 0;
     cambio_div = 0;
     cambio_base = 0;
     nForma = 0;
     nModo     = 0;
     aTx1      = "";
     aTx2      = "";
     aTx3      = "";
     aTx4      = "";
     aTx5      = "";
     aTx6      = "";
     aTx7      = "";
     aTx8      = "";
     aTx9      = "";
     aTx0      = "";
     aTx11     = "";
     aTx12     = "";
     &nDeci_Base    = 0;
     &nDeci_PreBase = 0;
     &nDeci_PreDiv = 0;
     &eArticulo     = "";
     &eAlmacen      = 0;

     ind       = 0;
     i         = 0;
     tot       = 0;
     ctotar1   = 0;
     ctotar2   = 0;
     mes       = 0;
     ctotal1   = 0;
     ctotal2   = 0;
     var_mod   = "";
     modo      = 0;
     prov2     = "";
     &r_arti   = "";
     aAlfa  = "";

     {-1}aMenuCoima = "";
     aMenuCoima1 = "2400";
     aMenuCoima2 = "1";
     aMenuCoima3 = "Consultas:  ";
     aMenuCoima4 = "KD";
     aMenuCoima5 = "      Kit       ";
     aMenuCoima6 = " Disponibilidad ";
|FIN;

|INCLUYE i_varart;

|PROCESO TipoAlma14; |TIPO 14;
     aGuarda = FSalida;
     |ABRE #2; |LEE 000#2p; |CIERRA #2;

     |ABRE #0;
     #0#0 = #0#0;
     |LEE 000#0=;
     |CIERRA #0;

     |ABRE #238;
     #238#0 = #0#201;
     |LEE 000#238=;
     |CIERRA #238;

     |ATRI N;
     |SI #0#179 = "S";
          aTx1 = "P.Servir  " + #238#5 + ":";
          aTx2 = "P.Servir  " + #238#4 + ":";
          aTx3 = "P.Recibir " + #238#5 + ":";
          aTx4 = "P.Recibir " + #238#4 + ":";
          aTx5 = "Dep.Vta."   + #238#5 + ":";
          aTx6 = "Dep.Vta."   + #238#4 + ":";
          aTx7 = "Total "     + #238#5 + ":";
          aTx8 = "Total "     + #238#4 + ":";
          aTx9 = "Dispo "     + #238#5 + ":";
          aTx0 = "Dispo "     + #238#4 + ":";
          aTx11 = "Dep.Com."   + #238#5 + ":";
          aTx12 = "Dep.Com."   + #238#5 + ":";
          |C_V #1#44, 1, "S";
          |C_V #1#45, 1, "S";
          |C_V #1#46, 1, "S";
          |C_V #1#47, 1, "S";
          |C_V #1#48, 1, "S";
          |C_V #1#95, 1, "S";
     |SINO;
          aAlfa = " " * 11;
          aTx1 = "P.Servir.....:";
          aTx2 = "              " + aAlfa;
          aTx3 = "P.Recibir....:";
          aTx4 = "              " + aAlfa;
          aTx5 = "Dep.Vta...:";
          aTx6 = "           " + aAlfa;
          aTx7 = "Total....:";
          aTx8 = "           " + aAlfa;
          aTx9 = "Dispo....:";
          aTx0 = "           " + aAlfa;
          aTx11 = "Dep.Com...:";
          aTx12 = "           " + aAlfa;
          |C_V #1#44, 1, "N";
          |C_V #1#45, 1, "N";
          |C_V #1#46, 1, "N";
          |C_V #1#47, 1, "N";
          |C_V #1#48, 1, "N";
          |C_V #1#95, 1, "N";
     |FINSI;
     |PINTA 1504, aTx1;
     |PINTA 1604, aTx2;
     |PINTA 1704, aTx3;
     |PINTA 1804, aTx4;
     |PINTA 1630, aTx5;
     |PINTA 1730, aTx6;
     |PINTA 1853, aTx7;
     |PINTA 1953, aTx8;
     |PINTA 2053, aTx9;
     |PINTA 2153, aTx0;
     |PINTA 1830, aTx11;
     |PINTA 1930, aTx12;
     |ATRI I;

     |HAZ EsMalpesa;
     |SI FSalida = 0;
          |HAZ MalpePinAlm;
     |FINSI;

     |HAZ EsTecatel;
     |SI FSalida = 0;
          eaArticulo = #1#0;
          enAlmacen = #1#1;
          |HAZ TecaPinTienda;
     |FINSI;

     |HAZ EsAparecida;
     |SI FSalida = 0;
          |HAZ PintaAparecida17;
     |FINSI;

     |HAZ EsCoimasa;
     |SI FSalida = 0;
          |HAZ PintaCoimasa;
     |FINSI;

     FSalida = aGuarda;
|FPRC;

|CALCULO alst1; |TIPO 0;
     vskl = stl - pdvl;
     |SI vskl > 0;
          vskl = pcma * vskl;
     |SINO;
          vskl = 0;
     |FINSI;
     |PINTA vskl;
|FCAL;

|CALCULO totalma; |TIPO 0;
     mes = Campo - 11;
     i = mes $ 2;
     tot = 35 + i;
     #1tot = #1tot - Contenido + #1Campo;
     |PINTA #1tot;
|FCAL;

|PROCESO decima;
     #0Campo = #0Campo ! #2#8;
     |PINTA #0Campo;
|FPRC;

|PROCESO nomod; |TIPO 7;
     |ABRE #2; |LEE 001#2p; |CIERRA #2;
     var_mod = #agifa142#29;
     |CAMPO_MODIFICA #1#4 , 1 , var_mod;   |CAMPO_MODIFICA #1#5 , 1 , var_mod;
     |CAMPO_MODIFICA #1#8 , 1 , var_mod;   |CAMPO_MODIFICA #1#9 , 1 , var_mod;
     |CAMPO_MODIFICA #1#10 , 1 , var_mod;  |CAMPO_MODIFICA #1#11 , 1 , var_mod;
     |CAMPO_MODIFICA #1#12 , 1 , var_mod;  |CAMPO_MODIFICA #1#13 , 1 , var_mod;
     |CAMPO_MODIFICA #1#14 , 1 , var_mod;  |CAMPO_MODIFICA #1#15 , 1 , var_mod;
     |CAMPO_MODIFICA #1#16 , 1 , var_mod;  |CAMPO_MODIFICA #1#17 , 1 , var_mod;
     |CAMPO_MODIFICA #1#18 , 1 , var_mod;  |CAMPO_MODIFICA #1#19 , 1 , var_mod;
     |CAMPO_MODIFICA #1#20 , 1 , var_mod;  |CAMPO_MODIFICA #1#21 , 1 , var_mod;
     |CAMPO_MODIFICA #1#22 , 1 , var_mod;  |CAMPO_MODIFICA #1#23 , 1 , var_mod;
     |CAMPO_MODIFICA #1#24 , 1 , var_mod;  |CAMPO_MODIFICA #1#25 , 1 , var_mod;
     |CAMPO_MODIFICA #1#26 , 1 , var_mod;  |CAMPO_MODIFICA #1#27 , 1 , var_mod;
     |CAMPO_MODIFICA #1#28 , 1 , var_mod;  |CAMPO_MODIFICA #1#29 , 1 , var_mod;
     |CAMPO_MODIFICA #1#30 , 1 , var_mod;  |CAMPO_MODIFICA #1#31 , 1 , var_mod;
     |CAMPO_MODIFICA #1#32 , 1 , var_mod;  |CAMPO_MODIFICA #1#33 , 1 , var_mod;
     |CAMPO_MODIFICA #1#34 , 1 , var_mod;  |CAMPO_MODIFICA #1#39 , 1 , var_mod;
|FPRC;

________________/ R.Aguera 23-06-98
________________/ CONTROL PARA CUANDO SE UTILIZA LA CREACION DE ARTICULOS
________________/ AUTOMATICOS, FUNCIONE BIEN EL ARTICULO EN BLANCO DESDE
________________/ PEDIDOS, ALB. ETC.
|PROCESO rarti1; |TIPO 6;
     r_arti = #1#0;
|FPRC;

|PROCESO rarti2; |TIPO 0;
     |QBF r_arti;
     |SI r_arti ! "";
          #1#0 = r_arti;
          |PINTA #1#0;
     |FINSI;
|FPRC;

|PROCESO actual; |TIPO 7;
     |ABRE #0;
     #0#0 = #1#0;
     |LEE 040#0=;
     |CIERRA #0;

     |ABRE #3;
     #3#0 = #1#1;
     |LEE 040#3=;
     |CIERRA #3;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo ! 4;
          #1#40 = #0#1;  |PINTA #1#40;
          #1#41 = #3#1;  |PINTA #1#41;
     |FINSI;
|FPRC;

|PROCESO LeeDecimBase1; |TIPO 13;
     |HAZ actual;
     |ABRE #agifa321;
     |ABRE #agifa324;

     #agifa324#0 = #agifa017#81;
     |LEE 000#agifa324.=;
     nDeci_PreDiv = #agifa324#9;

     |LEE 001#agifa321.p;
     #agifa324#0 = #agifa321#9; ||Igualo a moneda base
     |LEE 001#agifa324.=;
     nDeci_Base = #agifa324#7;  ||Decimales moneda base
     nDeci_PreBase = #agifa324#9;  ||Decimales precio de moneda base
     |CIERRA #agifa321;
     |CIERRA #agifa324;
|FPRC;

|PROCESO PuntoPed17_0; |TIPO 0;
     |SI FSalida ! 2;
          |HAZ EsMalpesa;
          |SI FSalida = 0;
               |HAZ MalpeEntAlm;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO Tipo6;
     |MODULO aAlfa;
     |SI aAlfa ! "agifa017"; |ACABA; |FINSI;

     |ABRE #6;
     |SELECT #2#6;
     #6#3=#1#0;
     |LEE 010#6=;
     |SI FSalida=0; |Y #1#0 ! #6#1;
          #1#0=#6#1;
          |PINTA #1#0;
          |ERROR;
     |FINSI;
     |CIERRA #6;

     |HAZ EsTallerSC;
     |SI FSalida = 0;
          eaArticulo = #1#0;
          |SUB_EJECUTA_NP "talle004;EXISTE";
     |FINSI;
|FPRC;

|PROCESO Calc617;  |TIPO 6;
     aGuarda = FSalida;
     enAlta = 1;
     eaArticulo = #1Campo;
     |HAZ LlenaArticulo;
     |SI FSalida = 0;
          |MODULO aAlfa;
          #1Campo = eaArticulo;
          |SI aAlfa = "agifa017"; |PINTA #0Campo; |FINSI;
     |SINO;
          |ERROR; |ACABA;
     |FINSI;

     |HAZ Tipo6;
     FSalida = aGuarda;
|FPRC;

|PROCESO PideArt17;  |TIPO 7;
     |ABRE #910;
     |LEE 040#910p;
     |SI FSalida ! 0;  |DDEFECTO #910;  |FINSI;
     |CIERRA #910;

     |SI #910#1 = "N"; |Y #910#2 ! 4;  |ACABA;  |FINSI;
     |SI #910#2 [ 2;    |ACABA;  |FINSI;

     eAlfa = #1Campo;
     |SUB_EJECUTA_NP "dsz99990";                 || Por Pantalla
     |SI eAlfa = "-1";  |PTEC 807;  |ACABA;  |FINSI;
     |SI eAlfa = "-2";              |ACABA;  |FINSI;

     eaArticulo = eAlfa;      ||  700000-4215

     #1Campo = eAlfa;
     |PINTA #1Campo;
     |PTEC 802;
     |SI #910#2 = 4;  |PTEC 802; |FINSI;
|FPRC;

|PROCESO Tipo12;  |TIPO 12;
     |ABRE #910;
     |LEE 040#910p;
     |SI FSalida ! 0;  |DDEFECTO #910;  |FINSI;
     |CIERRA #910;
     |SI #910#19 = "N";  |ACABA;  |FINSI;
     |SI #0#176  = "N";  |ACABA;  |FINSI;

     eArticulo = #1#0;
     eAlmacen  = #1#1;
     enModo = (FEntrada / 100) ! 0;
     |SUB_EJECUTA_NP "dsm00004";
|FPRC;

|PROCESO Tipo2017;  |TIPO 20;
     aAlfa = FSalida;

     |HAZ EsTecatel;
     |SI FSalida = 0;
          |SI aAlfa = "OPCION";
               FSalida = "Precios";
          |SINO;
               |LEE 101#1=;
               |SI FSalida = 0;
                    |HAZ TecPreArtAlm;
                    |LIBERA #1;
               |FINSI;
          |FINSI;
          |ACABA;
     |FINSI;

     |HAZ EsCoimasa;
     |SI FSalida = 0;
          |SI aAlfa = "OPCION";
               FSalida = "Opciones";
          |SINO;
               |LEE 101#1=;
               |SI FSalida = 0;
                    |PARA; |SI; |HACIENDO;
                    |MENU aMenuCoima;
                    aMenuCoima2 = FSalida;
                    eaArticulo = #1#0;
                    enAlmacen = #1#1;
                    |SI aMenuCoima2 [ 0; |SAL; |FINSI;
                    |SI aMenuCoima2 = 1; |SUB_EJECUTA_NP "coimw009"; |FINSI;
                    |SI aMenuCoima2 = 2; |SUB_EJECUTA_NP "coimw010"; |FINSI;
                    |SIGUE;
               |FINSI;
               |LIBERA #1;
          |FINSI;
          |ACABA;
     |FINSI;

     |ABRE #910;
     |LEE 040#910p;
     |SI FSalida ! 0;  |DDEFECTO #910;  |FINSI;
     |CIERRA #910;

     |SI aAlfa = "OPCION";
         |SI #910#19 = "S";
             aAlfa = #910#20;  |QBF aAlfa;
             FSalida = aAlfa;
         |SINO;
             FSalida = "";
         |FINSI;
         |ACABA;
     |FINSI;

     |SI #910#19 = "N";  |ACABA;  |FINSI;
     |SI #0#176  = "N";  |ACABA;  |FINSI;

     eArticulo = #1#0;
     eAlmacen  = #1#1;
     enModo    = 4;
     |SUB_EJECUTA_NP "dsm00004";
|FPRC;

|PROCESO TipoAlma30; |TIPO 30;
     ||컴컴컴컴컴컴컴컴컴컴컴컴컴Actualiza Max y Min del Articulo
     |ABRE #0;
     #0#0 = #1#0;
     |LEE 121#0=;
     |SI FSalida = 0;
          #0#7 = 0;
          #0#8 = 0;

          |SALVA_FICHA #1;
          #1#0 = #0#0;
          #1#1 = 1;
          |LEE 000#1];
          |PARA; |SI FSalida = 0; |Y #1#0 = #0#0; |HACIENDO;
               #0#7 = #0#7 + #1#6;
               #0#8 = #0#8 + #1#7;
               |LEE 000#1s;
          |SIGUE;
          art_nece = art_pser + art_mini - art_prec - art_disp;
          art_nece = art_nece - art_pval - art_fabr - art_rese;
          |SI art_nece < 0; art_nece = 0; |FINSI;
          |GRABA 020#0a;
          |REPON_FICHA #1;
     |FINSI;
     |CIERRA #0;
|FPRC;

|PROCESO Tipo17__2; |TIPO 2;
     nForma = 0 +. 1;
     nModo = (FEntrada / 100) ! 0;

     alm_nece = alm_pser + alm_mini - alm_prec - alm_disp;
     alm_nece = alm_nece - alm_pval - alm_fabr - alm_rese;
     |SI alm_nece < 0; alm_nece = 0; |FINSI;

     |ABRE #0;
     #0#0 = #1#0;
     |LEE 020#0=;
     |SI FSalida = 0;
          #0#7 = #0#7 +. #1#6;
          #0#8 = #0#8 +. #1#7;
          |GRABA 020#0a;
     |FINSI;
     |CIERRA #0;

     |HAZ EsMalpesa;
     |SI FSalida = 0;
          |HAZ MalpeAlma;
     |FINSI;

     |HAZ EsTecatel;
     |SI FSalida = 0; |Y nForma = 1;
          |HAZ TecPreArtAlm;
          |SI enSalida ! 0; |ERROR; |FINSI;
     |FINSI;

     |SI nModo = 3;
          |HAZ EsCoimasa;
          |SI FSalida = 0;
               eaArticulo = #1#0;
               enAlmacen = #1#1;
               |SUB_EJECUTA_NP "coima027;BAJA";
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO DefDescri; |TIPO 7;
     nSal = FSalida;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 1;
          |DDEF aAlfa;
          aAlfa = aAlfa + "agifa019";
          |CARGA_DEF aAlfa, refere1@;
          |SI FSalida = 0;
               |ABRE #refere1@;
               #refere1@#0 = #1#0
               |LEE 000#refere1@.=;
               |CIERRA #refere1@;
               #1#40 = #refere1@#1; |PINTA #1#40;
               |DESCARGA_DEF #refere1@;
          |FINSI;
          |ABRE #3;
          #3#0 = #1#1;
          |LEE 000#3=;
          |CIERRA #3;
          #1#41 = #3#1; |PINTA #1#41;
     |FINSI;

     |SI nSal = 0;
          |HAZ EsCoimasa;
          |SI FSalida = 0;
               eaArticulo = #1#0;
               enAlmacen = #1#1;
               |SUB_EJECUTA_NP "coima027";
               |HAZ PintaCoimasa;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO TecPreArtAlm;
     |GRABA 020#1a;
     |LIBERA #1;
     |CIERRAT #1;
     eaArticulo = #1#0;
     enAlmacen = #1#1;
     |SUB_EJECUTA_NP "tecaz024";
     |ABRET #1;
     |LEE 121#1=;
|FPRC;

|PROCESO MinAlma17;
     #refere1@#0 = #1#0;
     #refere1@#1 = 1;
|FPRC;

|PROCESO MaxAlma17;
     #refere1@#0 = #1#0;
     #refere1@#1 = 9999;
|FPRC;

|PROCESO TipoAlma11; |TIPO 11;
     |SI FSalida ! 13; |ACABA; |FINSI;
     |DDEF aAlfa;
     aAlfa = aAlfa + "agifa017";
     |CARGA_DEF aAlfa, refere1@;
     |SI FSalida = 0;
          |ABRE #refere1@;
          #refere1@#0 = #1#0;
          #refere1@#1 = #1#1;
          |LEE 000#refere1@.];
          |CONSULTA_F_CLAVE #1#refere1@, MinAlma17, MaxAlma17;
          |SI FSalida = 0;
               #1#0 = #refere1@#0;
               #1#1 = #refere1@#1;
               |LEE 020#1=;
               |PINDA #0#1;
          |SINO;
               |ERROR;
          |FINSI;
          |CIERRA #refere1@;
          |DESCARGA_DEF #refere1@;
     |FINSI;
|FPRC;

|PROCESO PintaAparecida17;
     |BLANCO 2202 2379;
     |PINTA 2202, "읕컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴켸";
     |SI #0#175 = "N";
          |ACABA;
     |FINSI;
     |ABRE #910; |LEE 000#910p; |CIERRA #910;
     |DDEF aAlfa;
     aAlfa = aAlfa + "aparm005";
     |CARGA_DEF aAlfa, refere1@;
     |SI FSalida ! 0; |ACABA; |FINSI;
     |ABRE #refere1@; |LEE 000#refere1@.p; |CIERRA #refere1@;
     nPos1 = 2203;
     nPos2 = 2303;
     nCamDes = 3;
     nCamLon = 4;
     nPosArt = 100;
     nPosDes = 100;
     |PARA j = 1; |SI j [ 4; |HACIENDO j = j + 1;
          |PARA i = 2; |SI i [ 5; |HACIENDO i = i + 1;
               |SI j = #refere1@#i#;
                    nLon2 = i + 4;
                    nLon2 = #refere1@#nLon2#;
                    nLon1 = 10 + 1 + #910#nCamLon#;
                    |SI nLon2 > 0;
                         nPos = nPosArt + #910#nCamLon#;
                         aArti = #0#0 % nPos;

                         nPos = nPosDes + nLon2;
                         aDes = #0#1 % nPos;

                         |ATRI R; |PINTA nPos1, #910#nCamDes#; |ATRI 0;
                         nPos = nPos1 + 11;
                         |ATRI I; |PINTA nPos, aArti; |ATRI 0;
                         |ATRI N; |PINTA nPos2, aDes; |ATRI 0;
                         |SI nLon1 > nLon2;
                              nPos1 = nPos1 + nLon1 + 1;
                              nPos2 = nPos2 + nLon1 + 1;
                         |SINO;
                              nPos1 = nPos1 + nLon2 + 1;
                              nPos2 = nPos2 + nLon2 + 1;
                         |FINSI;

                         nPosArt = nPosArt + (100 * #910#nCamLon#);
                         nPosDes = nPosDes + (100 * (nLon2+1));
                         nCamDes = nCamDes + 4;
                         nCamLon = nCamLon + 4;
                    |FINSI;
               |FINSI;
          |SIGUE;
     |SIGUE;
     |DESCARGA_DEF #refere1@;
     |ATRI I;
|FPRC;

|PROCESO PintaCoimasa;
     |DDEF aAlfa;
     aAlfa = aAlfa + "coima027";
     |CARGA_DEF aAlfa, refere1@;
     |SI FSalida ! 0; |ACABA; |FINSI;
     |DDEFECTO #refere1@;
     |ABRE #refere1@;
     #refere1@#0 = #1#0;
     #refere1@#1 = #1#1;
     |LEE 000#refere1@.=;
     |CIERRA #refere1@;
     |PINPA #0#refere1@;
     |PINDA #0#refere1@;
     |DESCARGA_DEF #refere1@;
     |ATRI I;
|FPRC;
