|FICHEROS;
     golis013 #0;
     gotmp005 #1;   ||Tmp
     gosubcoc #2;
     gopre001 #3;
     gomantho #4;
     gomantl1 #5;
     guerm030 #6;
     agifa077 #77;
     agifa079 #79;
|FIN;

|VARIABLES;
     &enSwSub = 0;
     aAlfa     = "";
     nHay      = 0;
     aInf      = "";
     aSerExp   = "";
     nNumExp   = 0;
     aSer      = "";
     nNum      = 0;
     aSubcontrata = "";
|FIN;

|PROCESO Tmp;
     enSwSub  = 0;
     |SI aSubcontrata = #1#0;
          enSwSub = 1;
     |FINSI;
     aSubcontrata = #1#0;

     nHay = 1;
     |PRINT;
|FPRC;

|DEFBUCLE Tmp1;
     #1#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Tmp;
|FIN;

|DEFBUCLE Tmp2;
     #1#2;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Tmp;
|FIN;

|DEFBUCLE Tmp3;
     #1#3;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Tmp;
|FIN;

|DEFBUCLE Tmp4;
     #1#4;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Tmp;
|FIN;

|PROCESO ImpoCer;
     |SI #1#8 = aSer; |Y #1#9 = nNum;
          #1#16 = 0;
     |SINO;
          #1#16 = #1#11;
     |FINSI;
     |GRABA 020#1a;
     |LIBERA #1;

     aSer = #1#8;
     nNum = #1#9;
|FPRC;

|PROCESO ImpoSub;
     |SI #1#0 = nNum;
          #1#15 = 0;
     |SINO;
          #1#15 = #1#7;
     |FINSI;
     |GRABA 020#1a;
     |LIBERA #1;

     nNum = #1#0;
|FPRC;

|DEFBUCLE ImpoCer;
     #1#5;
     ;
     INICIO;
     FINAL;
     be;
     NULL, ImpoCer;
|FIN;

|DEFBUCLE ImpoSub;
     #1#1;
     ;
     INICIO;
     FINAL;
     be;
     NULL, ImpoSub;
|FIN;


|PROCESO gomantl1;
     aSerExp = #5#0;
     nNumExp = #5#1;
     |ERROR;
|FPRC;

|DEFBUCLE gomantl1;
     #5#2;
     ;
     "     ", 000001, #2#4, #2#5;
     "zzzzz", 999999, #2#4, #2#5;
     ;
     NULL, gomantl1;
|FIN;

|PROCESO Seleccion;
     |DDEFECTO #3;
     #3#0 = #2#4;
     #3#1 = #2#5;
     |LEE 000#3=;


     |DDEFECTO #77;
     #77#50 = #6#0;
     #77#0 = #6#1;
     |LEE 000#77=;

     |DDEFECTO #1;
     #1#0 = #2#0; ||-    Subcontrata
     #1#1 = #2#1; ||-    Fecha.
     #1#2 = #2#2; ||-    Contratista.
     #1#3 = #2#4; ||-    Serie
     #1#4 = #2#5; ||/Presupuesto.
     #1#5 = #2#6; ||-    Cliente.
     #1#6 = #4#30;||-    Jefe Obra.
     #1#7 = #2#13;||-    Importe total de la subcontrata.
     #1#8 = #6#0; ||-    Serie Certificación
     #1#9 = #6#1; ||-    Número certificación
     #1#10 = #6#5;||-    Fecha.
     #1#11 = #77#65; ||-    Importe de la certificación.
     |SI #77#38 = "S";
          #1#12 = #77#51;||-    Serie factura.
          #1#13 = #77#39;||-    Número factura.

          |DDEFECTO #79;
          #79#66 = #1#12;
          #79#0 = #1#13;
          |LEE 000#79=;

          #1#14 = #79#1;||-    Fecha Factura.
     |FINSI;
     |GRABA 020#1n;
|FPRC;

|DEFBUCLE Seleccion;
     #6#2;
     ;
     #2#0;
     #2#0;
     ;
     NULL, Seleccion;
|FIN;

|PROCESO gosubcoc;
     nNumExp = 0;
     |BUCLE gomantl1;
||     |SI nNumExp = 0; |ACABA; |FINSI;

     |DDEFECTO #4;
     #4#0 = aSerExp;
     #4#1 = nNumExp;
     |LEE 000#4=;
     |SI #4#30 < #0#8; |O #4#30 > #0#9; |ACABA; |FINSI; ||Jefe

     |BUCLE Seleccion;
|FPRC;

|DEFBUCLE gosubcoc;
     #2#1;
     2, 9, 6;
     #0#0, #0#2, #0#4, #0#6;
     #0#1, #0#3, #0#5, #0#7;
     ;
     NULL, gosubcoc;
|FIN;

|PROCESO Tipo3; |TIPO 3;
     |HAZ MiraLogos; || Copia Logos para el Crystal

     aAlfa = Usuario; |QBF aAlfa;
     |NOME_DAT #1 aAlfa; |DELINDEX #1;

     |SI #0#10 = 1; aInf = "goli1013"; |FINSI;
     |SI #0#10 = 2; aInf = "goli2013"; |FINSI;
     |SI #0#10 = 3; aInf = "goli3013"; |FINSI;
     |SI #0#10 = 4; aInf = "goli4013"; |FINSI;
     |IMPRE 0;
     |SI FSalida = 0;
          |INFOR aInf;
          |SI FSalida ! 0;
               aInf = "0000No existe Informe " + aInf;
               |MENAV aInf;
          |SINO;
               |ABRE #1;
               |ABRE #3;
               |ABRE #4;
               |ABRE #77;
               |ABRE #79;
               |ABRE #6; |SELECT #2#6;
               |BUCLE gosubcoc;
               |CIERRA #6;
               |CIERRA #79;
               |CIERRA #77;
               |CIERRA #4;
               |CIERRA #3;
               |CIERRA #1;
               ||ÄÄÄÄÄÄÄÄÄCorige Acumulados
               aSer = ""; nNum = 0;
               |BUCLE ImpoSub;
               aSer = ""; nNum = 0;
               |BUCLE ImpoCer;

               |SI #0#10 = 1; |BUCLE Tmp1; |FINSI;
               |SI #0#10 = 2; |BUCLE Tmp2; |FINSI;
               |SI #0#10 = 3; |BUCLE Tmp3; |FINSI;
               |SI #0#10 = 4; |BUCLE Tmp4; |FINSI;
               |SI nHay ! 0; |PIEINF; |FINSI;
               |FININF;
          |FINSI;
          |FINIMP;
     |FINSI;

     |DELINDEX #1;
|FPRC;
