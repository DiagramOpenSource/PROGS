         SwCabAlm = 0; SwCabDet = 0; SwLinDet = 1; SwPieAlm = 0;
|FICHEROS;
   iber1500 #0;
   agifa065 #1;
   iber1501 #2;
   agifa019 #3;
   agifa060 #4;
   agifa029 #5;
|FIN;

|VARIABLES;
   &SwCabAlm = 0;
   &SwCabDet = 0;
   &SwLinDet = 0;
   &SwPieAlm = 0;
   &SwBlanco = 0;
   &nLinea = 0;
   &aSub = "";

   &Tempo = "";
   aTempo02 = "";
   UltFecha = @;
   nAlmAnt = 0;
   MaxLin = 66;
   nCalc = 0;
|FIN;

|PROCESO Impresion;
   |SI nAlmAnt < 0;
      nCalc = nLinea + 6; |SI nCalc > MaxLin; |HAZ VeteAlPie; |FINSI;
      SwCabAlm = 1; SwCabDet = 1; SwLinDet = 1;
      nLinea = nLinea + 5; |PRINT;
      SwCabAlm = 0; SwCabDet = 0;
      nAlmAnt = #iber1501#2;
   |SINO;
      |SI nAlmAnt ! #iber1501#2;
/*
         nCalc = nLinea + 4; |SI nCalc > MaxLin; |HAZ VeteAlPie; |FINSI;
         SwCabAlm = 0; SwCabDet = 0; SwLinDet = 0; SwPieAlm = 1;
         nLinea = nLinea + 3; |PRINT;
*/
         nCalc = nLinea + 6; |SI nCalc > MaxLin; |HAZ VeteAlPie; |FINSI;
         SwPieAlm = 0; SwCabAlm = 1; SwCabDet = 1; SwLinDet = 1;
         nLinea = nLinea + 5; |PRINT;
         nAlmAnt = #iber1501#2;
      |SINO;
/*
         nCalc = nLinea + 5;
         |SI nCalc > MaxLin;
            SwCabAlm = 0; SwCabDet = 0; SwLinDet = 0; SwPieAlm = 1;
            aSub = "SUB";
            nLinea = nLinea + 3; |PRINT;
            aSub = "";
            |HAZ VeteAlPie;
            SwPieAlm = 0; SwCabAlm = 1; SwCabDet = 1; SwLinDet = 0;
            nLinea = nLinea + 4; |PRINT;
         |FINSI;
*/
         nCalc = nLinea + 2;
         |SI nCalc > MaxLin;
            |HAZ VeteAlPie; SwCabAlm = 1; SwCabDet = 1;
            nLinea = nLinea + 4;
         |SINO;
            SwCabAlm = 0; SwCabDet = 0;
         |FINSI;
         SwPieAlm = 0; SwLinDet = 1;
         nLinea = nLinea + 1; |PRINT;
      |FINSI;
   |FINSI;
|FPRC;

|DEFBUCLE Impresion;
#iber1501#2;
;
INICIO;
FINAL;
;
NULL,Impresion;
|FIN;

|PROCESO VeteAlPie;
   |PARA nCalc = nLinea; |SI nCalc [ MaxLin; |HACIENDO nCalc = nCalc + 1;
      SwPieAlm = 0; SwCabAlm = 0; SwCabDet = 0; SwLinDet = 0; SwBlanco = 1;
      |PRINT;
      SwBlanco = 0;
   |SIGUE;
   |PIEINF;
   nLinea = 8;
|FPRC;

|PROCESO RellTempo;
   |SI #agifa019#2 < #iber1500#0; |O #agifa019#2 > #iber1500#1; |ACABA; |FINSI;

   #agifa019#0 = #agifa065#0;
   |LEE 000#agifa019.=;
   |SI FSalida ! 0;
      |MENAV "    Hay lineas del historico referentes a articulos que no existen";
      |ERROR; |ACABA;
   |FINSI;

   #agifa060#0 = #agifa019#2;
   |LEE 000#agifa060.=;
   |SI FSalida ! 0;
      |DDEFECTO #agifa060;
   |FINSI;

   #agifa029#0 = #agifa065#5;
   |LEE 000#agifa029.=;
   |SI FSalida ! 0;
      |DDEFECTO #agifa029;
   |FINSI;

   #iber1501#0 = #agifa065#0;
   #iber1501#2 = #agifa065#5;
   |LEE 000#iber1501.=;
   |SI FSalida = 0;
      #iber1501#3 = #agifa065#1;
      #iber1501#5 = #iber1501#5 + #agifa065#6;
      |GRABA 020#iber1501.a;
   |SINO;
      |DDEFECTO #iber1501;
      #iber1501#0 = #agifa065#0;
      #iber1501#1 = #agifa019#1;
      #iber1501#2 = #agifa065#5;
      #iber1501#3 = #agifa065#1;
      #iber1501#4 = #agifa019#2;
      #iber1501#5 = #agifa065#6;
      #iber1501#6 = #agifa060#1;
      #iber1501#7 = #agifa029#1;
      #iber1501#8 = #agifa019#5;
      |GRABA 020#iber1501.n;
   |FINSI;
|FPRC;

|DEFBUCLE RellTempo;
#agifa065#1;
5;
#iber1500#4,"01.01.1900","  ",000000,00000,"     ",#iber1500#2;
#iber1500#5,#iber1500#6, "zz",999999,99999,"zzzzz",#iber1500#3;
;
NULL,RellTempo;
|FIN;

|PROGRAMA;
   |CLS;
   |CABEZA "Informe stocks";
   |PINPA #0#0; |PINDA #0#0;
   |ENDATOS #1#0;
   |SI FSalida = 0;
      |IMPRE 0;
      |SI FSalida = 0;
         |INFOR "iber1500";
         |SI FSalida = 0;
            |HAZ CreaTempo; aTempo02 = Tempo;
            |NOME_DAT #2 aTempo02; |DELINDEX #iber1501;
            |ABRE #iber1501; |ABRE #agifa019; |ABRE #agifa060;
            |BUCLE RellTempo;
            nAlmAnt = -1; nLinea = 8;
            |BUCLE Impresion;
/*
            |SI nLinea ! 8;
               SwCabAlm = 0; SwCabDet = 0; SwLinDet = 0; SwPieAlm = 1;
               |PRINT;
            |FINSI;
*/
            |CIERRA #agifa019; |CIERRA #iber1501; |CIERRA #agifa060;
            |DELINDEX #iber1501; Tempo = aTempo02; |HAZ BoraTempo;
            |PIEINF;
            |FININF;
         |FINSI;
         |FINIMP;
      |FINSI;
   |FINSI;
|FPRO;
