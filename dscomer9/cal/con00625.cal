|FICHEROS;
     con00625 #0;
     con00626 #1,MANTE;
     con00627 #2;
     con00628 #3,MANTE;|| Tmp Servicios Exteriores
     con00629 #4,MANTE;|| Tmp Mano de Obra
     con00630 #5,MANTE;|| Tmp Piezas
     con00631 #6,MANTE;|| Tmp Lubricante
     con00632 #7; || Tmp totales
     con00605 #10; || articulos por mano de obra;
     agifa019 #11; || articulos
     agifa017 #9;  || almacen
     agifa065 #12; || Historico
     con00637 #20 ; || facturas
     con00638 #21,MANTE; || tmp facturas
     agifa024 #30; || clientes
     agifa091 #40; || formas de pago
     agifa059 #55;
     agifa134 #56;
     con00659 #65; || lineas or vn
     con00674 #80; || Lineas or vo
     con01625 #85; || texto inicial o.r.
     con00603 #63; || Maestro M.Obra
     con00606 #66; || Maestro Ser. Exteriores

     con00634 #14,MANTE; || Explicacion reparacion
     con00642 #67; || Lineas Fra. O.R.
     con00682 #82; || Trabajos operarios
     con00683 #83; ||control aplicacion
     con00684 #92;
     con00634 #8; ||texto explicativo
     con00680 #90; ||Operarios
     con00690 #91; ||Series / Formatos OR
     contmp02 #15;
     con00601 #601;

     agifa133 #530;
     agifa091 #531;
     agifa177 #532;
     agis0002 #533;
     agifa142 #534;
     dsz99984 #535;
     con00633 #633;
     dsm00248 #143;
     dsm00247 #141;
     conp0625 #625;
     con00007;
     con00703 #703;
     con00008 #800;
     con00691 #691;
     con00696 #696;
     con00614 #614;
|FIN;

|INCLUYE i_varart;

|VARIABLES;
     nSwActCli = 0;
     &enSwCoste = 0;
     aArti = "";
     nUni = 0;
     nCampo = 0;
     fFecha = @;
     nImpo = 0;
     nMargen = 0;
     &enUni = 0;
     {50}aModCam = "";
     aSwModCab = "";
     aCampos = "";
     aSwFactu = "";
     &enSwFactu = 0;
     &enTotaSin = 0;
     &eaTParte = "";
     &enAlmaSer = 0;
     &iva1 = 0;
     &iva2 = 0;
     &iva3 = 0;
     &iva4 = 0;
     &iva5 = 0;
     &rec1 = 0;
     &rec2 = 0;
     &rec3 = 0;
     &rec4 = 0;
     &rec5 = 0;

     &enTxtGaran = 0;
     &enTxtInter = 0;
     &enTxtNorma = 0;
     &enTxtSinca = 0;
     nTotCanon = 0;
     aNumHora = "";
     aNumMin = "";
     aHora = "";
     nLin = 0;
     &enLinCanon = 0;
     nTotal = 0;
     nError = 0;
     nEmpresa = 0;
     &aMenClave = "";
     nPrime = 0;
     nNume = 0;
     &eaMatricula = "";
     nTecla = 0;
     &eaCodCliente = "";
     &nMasRies = 0;
     &nRieUtili = 0;
     &nRieTotal = 0;
     nConAu = 0;
     aUs = "";

     &enTotal = 0;
     &eaTag = "";
     &eaNumero = "";
     &eaNomCliente = "";
     &Tempo = "";
     aTmp614 = "";
     aTmp92 = "";
     aTmp15 = "";
     nGuarda = 0;
     &enErrCarte = 0;
     &eaProg = "";
     &enAcuenta = 0;
     nSwModiOrden = 0;
     nVto = 0;
     nModo = 0;
     nPosFin = 0;
     nPosLin = 0;
     nSec = 0;
     aAlfa = "";
     nSeccion = 0;
     nSwFlag = 0;
     aMensaje = "";
     &aDivisa     = "";
     &aMoneda     = "";
hay_pendientes = "";
||\\ variables para el calculo de vencimientos

    nSwCambia = 0;
puente = "";
serie_orden = "";
numero_orden = "";
     solo_entrada = "S";
     aAlfa1 = "";
     eaCodigo = "";
     &sw_inf = 0;
     lineas_fra = 0;
     puedo_borrar = "N";
     tipo_iva = 0;
     fecha     = "          ";
     &opcion = 0;
     cafe      = "";
     diafe     = "";
     dianu     = "";
     dia_venci = "";
     mes_venci = "";
     any_venci = "";
     em = 0;
     j = 0;
     k = 0;
     importe = 0;
     redondeo = 0;
     resto = 0;
     tipo_imp = 0;
     fechas = "";
     fecha_fac = @;
     num = 0;
     mes_ven = 0;
     fechae = @;
     nCont = 0;

imneto = 0;
mod = 0;
precio = 0;
tipo_rec = "";
seguir = 0;
i = 0;
mensaje = "";
&matricula = "";
&bastidor = "";
&cliente = "";
&tipo_parte = "";
&fecha_ent = "01.01.1900";
&linea_usado = 0;
&numparte = "";
&serie_parte = "";
&es_garantia = 0;
linea = 0;
linea_aux = 0;
correcto = 0;
modo  = 0;
hacer_histo = 0;
mes = 0;
pri = 0;
fmes = "  ";
mes_margen = 0;
mes_importe = 0;
     {-1}aUtil  = "";
         aUtil1 = "2400";
         aUtil2 = "1";
         aUtil3 = ""
         aUtil4 = "LTRIFO";
         aUtil5 = "Lineas";
         aUtil6 = "Texto Inicial";
         aUtil7 = "Texto Repara.";
         aUtil8 = "Imprimir";
         aUilt9 = "Facturas";
         aUtil10 = "Opciones";


     {-1}aMImp  = "";
         aMImp1 = "2400";
         aMImp2 = "1";
         aMImp3 = "Impresion: "
         aMImp4 = "ECRV";
         aMImp5 = " O.R.Entrada    ";
         aMImp6 = " O.R.Completa ";
         aMImp7 = " Resguardo Deposito ";
         aMImp8 = " Volver ";


salida =0;
informe = "";
 {-1} menu      = "";
    menu1       = "2401";
    menu2       = "1";
    menu3       = "";
    menu4       = "OPSLMFTCREIA"
    menu5       = "M.Obra";
    menu6       = "Piezas";
    menu7       = "S.Ext.";
    menu8       = "Lubri.";
    menu9       = "Modif.";
    menu10      = "Fin";
    menu11      = "Tot";
    menu12      = "Cierra";
    menu13      = "ObseR.";
    menu14      = "TExt.";
    menu15      = "Imp.";
    menu16      = "Apar.";
    r_alfa = "";
    r_long = "";
    r_num = 0;
    alfa = "    ";
    expor = "";
    aEstado = "";
    nSwTallerSC = 0;
    nOk = 0;
|FIN;

|PROCESO MiraFactu;
     |SI aSwFactu = "N";
          aSwFactu = "S";
     |FINSI;
     |SI #1#38 ! "F";
          aSwFactu = "N"; |ERROR10;
     |FINSI;
|FPRC;

|DEFBUCLE MiraFactu;
     #1#1;
     ;
     #0#0, #0#1, 0001;
     #0#0, #0#1, 9999;
     ;
     NULL, MiraFactu;
|FIN;

|PROCESO Refresca;
     |ENTLINEAL #1#1 , 3 , 7 , 22 , 0 ,  min , max;
|FPRC;

|PROCESO PonEstado;
     |SI #1#36 = 0;
          |SI nSwActCli ! 0;
               |ABRE #30;
               #30#0 = #0#11;
               |LEE 101#30=;
               |SI FSalida = 0;
                    |SI nSwActCli = 1; |Y #1#38 ! "A";
                         #30#50 = #30#50 + (#1#8 * nSwActCli);
                    |FINSI;
                    |SI nSwActCli = -1; |Y #1#38 = "A";
                         #30#50 = #30#50 + (#1#8 * nSwActCli);
                    |FINSI;
                    |GRABA 020#30a;
               |FINSI;
               |CIERRA #30;
          |FINSI;
          #1#38 = aEstado;
     |FINSI;
     |GRABA 020#1a;
     |LIBERA #1;
|FPRC;

|DEFBUCLE PonEstado;
     #1#1;
     ;
     #0#0, #0#1, 0001;
     #0#0, #0#1, 9999;
     be;
     NULL, PonEstado, NULL, NULL, Refresca;
|FIN;


|PROCESO OR_20; |TIPO 20;
     |SI FSalida ! "OPCION";
          |SELECT #1#0;
          |LEE 000#0=;
          |SI FSalida ! 0;
               |MENAV "0000Por favor, consulte el registro correcto antes de imprimir.";
               |ACABA;
          |SINO;
               |PINDA #0#0;
          |FINSI;
     |FINSI;
     |HAZ tipo200;
|FPRC;

|PROCESO tipo200;
     aAlfa1 = FSalida;

     |SI aAlfa1 = "OPCION";
         FSalida = "Opciones";
         |ACABA;
     |FINSI;

     |LEE 101#0=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     eaCodigo = #0#0;

     |MENU aUtil;
     aUtil2 = FSalida;
     |SI aUtil2 = "1"; |ENTLINEAL #1#1 , 3 , 4 , 22 , 0 ,  min , max;  |FINSI;
     |SI aUtil2 = "2"; |HAZ datosor;|FINSI;
     |SI aUtil2 = "3"; |HAZ texto_reparacion;|FINSI;
     |SI aUtil2 = "4"; |HAZ imp_parte; |FINSI;
     |SI aUtil2 = "5"; |HAZ FacturasOR; |FINSI;
     |SI aUtil2 = "6";
          FEntrada = 202;     ||como si fuera modificacion
          |HAZ tipo33;
     |FINSI;
     |LIBERA #0;
|FPRC;

|PROCESO carga_tmp02;
hay_pendientes = "S";
#15#0 = #0#0;
#15#1 = #0#1;
#15#2 = #0#3;
#15#3 = #0#2;
#15#4 = #0#19;
#15#5 = #0#4;
#15#6 = #0#21;
|GRABA 001#15n;
|LIBERA #15;
|FPRC;

|DEFBUCLE carga_tmp02;
#0#4;
;
"     " , 000000 , "01.01.0000";
"     " , 000000 , "31.12.2990";
;
NULL , carga_tmp02;
|FIN;

|PROCESO efe11; |TIPO 66;
  |CONFI "0000SSolo Pendientes de Facturar";
  |SI FSalida = 0;
       |HAZ CreaTempo; aTmp15 = Tempo;
       |NOME_DAT #15 aTmp15; |DELINDEX #15; |ABRE #15;
       hay_pendientes = "N";
       |BUCLE carga_tmp02;
       |SI hay_pendientes = "S";
            |CONSULTA_CLAVE #2#15;
            |SI FSalida = 0;
               #0#0 = #15#0;
               #0#1 = #15#1;
               |LEE 000#0=;
               |PINTA #0#0;
               |PINTA #0#1;
            |SINO;
               |ERROR;
            |FINSI;
       |SINO;
          |MENAV "0000No hay O.R. Pendientes de Cerrar";
          |ERROR;
       |FINSI;
       |CIERRA #15;
       Tempo = aTmp15; |HAZ BoraTempo; |DELINDEX #15;
  |SINO;
       |CONSULTA_CLAVE #1#con00625;
  |FINSI;
|FPRC;

|PROCESO rellena;
    r_alfa = #0#1;
    |QBF r_alfa;
    #0#1 = "000000";
    r_long = #0#1 % A0;
    r_alfa = "000000" + r_alfa;
    r_num = -(r_long + 100);
    #0#1 = r_alfa % r_num;
    |PINTA #0#1;
|FPRC;


|PROCESO imp_parte;
     enTiva = 1; efFiva = #0#2; |HAZ SacaIVA; iva1 = enIva; rec1 = enRec;
     enTiva = 2; efFiva = #0#2; |HAZ SacaIVA; iva2 = enIva; rec2 = enRec;
     enTiva = 3; efFiva = #0#2; |HAZ SacaIVA; iva3 = enIva; rec3 = enRec;
     enTiva = 4; efFiva = #0#2; |HAZ SacaIVA; iva4 = enIva; rec4 = enRec;
     enTiva = 5; efFiva = #0#2; |HAZ SacaIVA; iva5 = enIva; rec5 = enRec;

     nTotal = #0#28;
     correcto = 1;
     |HAZ suma_tot;
     correcto = 0;
     |SI #0#28 ! nTotal;
          |GRABA 020#0a;
          aAlfa = "0000Total recalculado, total anterior: " + nTotal + " total actual: " + #0#28;
          |MENAV aAlfa;
     |FINSI;

     ||TODO CCC ... Menu Impresion.
     || OR.Entrada | OR.Completa | Resguardo | Volver

     |MENU aMImp;
     aMImp2 = FSalida;
     |SI aMImp2 = "1"; solo_entrada = "S"; |FINSI;
     |SI aMImp2 = "2"; solo_entrada = "N"; |FINSI;
     |SI aMImp2 = "3"; solo_entrada = "R"; |FINSI;
     |SI aMImp2 = "4"; solo_entrada = "V"; |FINSI;

     |SI solo_entrada = "N"; |O solo_entrada = "R";
          |HAZ SelecTexto;
     |FINSI;
     |SI solo_entrada = "V"; |ACABA; |FINSI;

     enTotaSin = 0;
     |IMPRE 0;
     |SI FSalida = 0;
          |ABRE #91;
          #91#0 = #0#0;
          |SI solo_entrada = "S";
               |LEE 010#91=;
               |SI FSalida = 0;
                 informe = #91#1;
               |SINO;
                 informe = "con00625";
               |FINSI;
               |INFOR informe;
               |SI FSalida = 0;
                    |PRINT; |PIEINF;
               |SINO;
                    aMensaje = "0000Problemas con el informe " + informe;
                    |MENAV aMensaje;
               |FINSI;
               |FININF;
          |FINSI;

          |SI solo_entrada = "N"; |O solo_entrada = "R";
               |LEE 010#91=;
               |SI solo_entrada = "N";
                    |SI FSalida = 0; informe = #91#3; |SINO; informe = "cone0625"; |FINSI;
               |SINO;
                    |SI FSalida = 0; informe = #91#6; |SINO; informe = "conr0625"; |FINSI;
               |FINSI;
               |INFOR informe;
               |SI FSalida = 0;
                    |ABRE #83;
                    |DDEFECTO #83;
                    |LEE 000#83]
                    |SI FSalida ! 0 ; |DDEFECTO #83; |FINSI;
                    |LIBERA #83;
                    |CIERRA #83;
                    |ABRE #85;
                    #85#0 = #0#0;
                    #85#1 = #0#1;
                    |LEE 001#85=;
                    sw_inf = 8; |PRINT;
                    |HAZ  imp_fra_linea;
                    |PIEINF;
                    |CIERRA #85;
               |SINO;
                    aMensaje = "0000Problemas con el informe " + informe;
                    |MENAV aMensaje;
               |FINSI;
               |FININF;
          |FINSI;

          |LIBERA #91;
          |CIERRA #91;
          |FINIMP;
     |FINSI;
|FPRC;


|PROCESO imp_fra_res;
|SI #92#1 = "G";
     es_garantia = 1;
|SINO;
     es_garantia = 0;
|FINSI;
|PRINT;
es_garantia = 0;
|FPRC;

|DEFBUCLE imp_fra_resu;
#92#1;
;
INICIO;
FINAL;
;
NULL , imp_fra_res;
|FIN;

|PROCESO con00614;
     sw_inf = 4;
     |PRINT;
     |BORRA 020#614a;
|FPRC;

|DEFBUCLE con00614;
     #614#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, con00614;
|FIN;

|PROCESO lee_fra_texto;
     |SI #8#4 = "G"; |Y enTxtGaran = 0; |ACABA; |FINSI;
     |SI #8#4 = "I"; |Y enTxtInter = 0; |ACABA; |FINSI;
     |SI #8#4 = "N"; |Y enTxtNorma = 0; |ACABA; |FINSI;
     |SI #8#4 = "S"; |Y enTxtSinca = 0; |ACABA; |FINSI;
     |PRINT;
|FPRC;

|PROCESO imp_fra_l2;
     aAlfa = "_" + #1#10;
     aAlfa = eaTParte - aAlfa;
     |SI eaTParte ! "TodoS"; |Y FSalida = 0;
          |ACABA;
     |FINSI;

     |SI #1#14 ! "S";
          enTotaSin = enTotaSin + #1#8;
     |FINSI;

     #633#0 = #1#10;
     |LEE 000#633=;
     |SI FSalida = 0; |Y #633#3 = "S";
          |DDEFECTO #614;
          #614#0 = #633#0;
          |LEE 101#614=;
          |SI FSalida ! 0; |GRABA 020#614b; |FINSI;
          #614#1 = #633#1;
          #614#2 = #633#2;
          #614#3 = #614#3 + #1#8;
          |GRABA 020#614a;
          |LIBERA #614;
          |ACABA;
     |FINSI;

     |SI #1#14 = "G";
          es_garantia = 1;
     |SINO;
          es_garantia = 0;
     |FINSI;


     |PRINT;
     es_garantia = 0;
|FPRC;

|PROCESO imp_fra_l1;
     aAlfa = "_" + #1#10;
     aAlfa = eaTParte - aAlfa;
     |SI eaTParte ! "TodoS"; |Y FSalida = 0;
          |ACABA;
     |FINSI;

     |SI #1#14 ! "S";
          enTotaSin = enTotaSin + #1#8;
     |FINSI;

     #633#0 = #1#10;
     |LEE 000#633=;
     |SI FSalida = 0; |Y #633#3 = "S";
          |DDEFECTO #614;
          #614#0 = #633#0;
          |LEE 101#614=;
          |SI FSalida ! 0; |GRABA 020#614b; |FINSI;
          #614#1 = #633#1;
          #614#2 = #633#2;
          #614#3 = #614#3 + #1#8;
          |GRABA 020#614a;
          |LIBERA #614;
          |ACABA;
     |FINSI;

     |ABRE #90;
     #90#0 = #1#21;
     |LEE 000#90=;
     |SI FSalida ! 0 ; |DDEFECTO #90; |FINSI;
     |CIERRA #90;

     |DDEFECTO #92;
     #92#0 = #90#4;
     #92#1 = #1#14;
     #92#3 = #1#5;
     #92#5 = #1#6;
     |LEE 001#92=;
     |SI FSalida ! 0 ; |GRABA 021#92b; |FINSI;
     #92#2 = #92#2 + #1#4;
     #92#4 = #92#4 + #1#8;
     |GRABA 001#92a;
     |LIBERA #92;

|FPRC;

|DEFBUCLE imp_fra_lin1;
#1#1;
;
#0#0 , #0#1 , 0001;
#0#0 , #0#1 , 0999;
;
NULL , imp_fra_l1;
|FIN;

|DEFBUCLE imp_fra_lin2;
#1#1;
;
#0#0 , #0#1 , 0001;
#0#0 , #0#1 , 0999;
;
NULL , imp_fra_l2;
|FIN;

|DEFBUCLE imp_fra_lin3;
#1#1;
;
#0#0 , #0#1 , 1000;
#0#0 , #0#1 , 9999;
;
NULL , imp_fra_l2;
|FIN;

|DEFBUCLE lee_fra_texto;
#8#1;
;
#0#0 , #0#1 , 001;
#0#0 , #0#1 , 999;
;
NULL , lee_fra_texto;
|FIN;

|PROCESO imp_fra_linea;
|SI #0#18 ! "R";
     |HAZ CreaTempo; aTmp614 = Tempo; |NOME_DAT #614 aTmp614; |DELINDEX #614;
     |ABRET #614;
     |ABRE #633;

     |SI #83#1 = "S";
          |HAZ CreaTempo; aTmp92 = Tempo; |NOME_DAT #92 aTmp92; |DELINDEX #92;
          |ABRE #92;
          |BUCLE imp_fra_lin1;
          |CIERRA #92;
          sw_inf = 2;
          |BUCLE imp_fra_resu;
          Tempo = aTmp92; |HAZ BoraTempo; |DELINDEX #92;
     |SINO;
          sw_inf = 0;
          |BUCLE imp_fra_lin2;
     |FINSI;
     sw_inf = 0;
     |BUCLE imp_fra_lin3;
     |BUCLE con00614;

     |CIERRA #633;
     |CIERRAT #614;
     Tempo = aTmp614; |HAZ BoraTempo; |DELINDEX #614;
|FINSI;
sw_inf = 3;
|BUCLE lee_fra_texto;
sw_inf = 0;
|FPRC;

|PROCESO quita_cliente;
          #30#0 = #0#11;
          |LEE 121#30=;
          |SI 0 = FSalida;
               fmes = #20#2 % A402;
               mes = ((fmes - 1) * 4) + 54;
               imneto = #20#6 + #20#7 + #20#23;
               #30mes = #30mes - imneto;
               #30#102 = #30#102 - imneto;
               #30#49  = #30#49  - #20#11;        || riesgo
/*
||*************** CALCULO DEL RIESGO;
*/
               #30#110 = #30#110 - imneto;
               #30#50 = #30#50 + imneto;
               |GRABA 020#30a;

               enImpCliCom = -imneto;
               enImpCliFac = -imneto;
               eaCliente = #0#11;
               efFecha = #20#2;
               |HAZ AcumulaCli;
          |FINSI;
          |LIBERA #30;
|FPRC;

|PROCESO actua_cliente;
          |ABRE #30;
          #30#0 = #0#11;
          |LEE 121#30=;
          |SI 0 = FSalida;
               fmes = #20#2 % A402;
               mes = ((fmes - 1) * 4) + 54;
               imneto = #20#6 + #20#7 + #20#23;
               #30mes = #30mes + imneto;
               #30#102 = #30#102 + imneto;
               #30#49  = #30#49  + (#21#11 - #21#23);        || riesgo
/*
||*************** CALCULO DEL RIESGO;
*/
               #30#45 = #0#17;
               #30#46 = imneto;
               #30#110 = #30#110 + imneto;
               |SI #0#16 = 999999;
                    #30#50 = #30#50 - imneto;
               |FINSI;
               |GRABA 020#30a;

               enImpCliCom = imneto;
               enImpCliFac = imneto;
               eaCliente = #0#11;
               efFecha = #20#2;
               |HAZ AcumulaCli;
          |FINSI;
          |LIBERA #30;
          |CIERRA #30;
|FPRC;

|CALCULO leepago;|TIPO 0;
     |ABRE #40;
     #40#0 = #20#20;
     |LEE 021#40=;
     |SI 0 ! FSalida; |DDEFECTO #40; |FINSI;
     tipo_rec = #40#69;
     |CIERRA #40;
|FCAL;

|PROCESO cambios;
     fecha = fechae;
     cafe = fecha;
     diafe = fecha % A102;
     dianu = diafe;
|FPRC;


|PROCESO fijos;
     |SI #30#21 = 0;          ||#6#22
          |VETE finfijos;
     |FINSI;
     |HAZ cambios;
     |SI dianu > #30#21;
          |VETE  fijos2;
     |FINSI;
     |ET fijos1;
     |SI dianu = #30#21;
          |VETE finfijos;
     |FINSI;
     fechae = fechae +1;
     |HAZ cambios;
     |VETE fijos1;
     |ET fijos2;
     |SI #30#22 = 0; |O dianu [ #30#21;
      |VETE fijos1;
 |FINSI;
 |SI dianu > #30#22;
     |VETE fijos3;
 |FINSI;
 |SI dianu = #30#22;
     |VETE finfijos;
 |FINSI;
 fechae = fechae + 1;
 |HAZ cambios;
 |VETE fijos2;
|ET fijos3;
 |SI #30#23 = 0;|O dianu > #30#23; |O dianu [ #30#21; |O dianu [ #30#22;
     |VETE fijos1;
 |FINSI;
 |SI dianu = #30#23;
     |VETE finfijos;
 |FINSI;
 fechae = fechae +1;
 |HAZ cambios;
 |VETE fijos3;
|ET finfijos;
 fecha = fechae;
|FPRC;

|PROCESO cambia_fecha;
     dia_venci = fechae % 102;
     mes_venci = fechae % 402;
     mes_ven = mes_venci + 1;
     mes_venci = ("00" + mes_ven) % -102;
     any_venci = fechae %704;
     |SI mes_ven > 12;
          mes_venci = "01";
          mes_ven = any_venci + 1;
          any_venci = mes_ven;
     |FINSI;
     fechas = dia_venci + "." + mes_venci + "." + any_venci;
     fechae = fechas;
|FPRC;

|PROCESO quita_VNVO;
|SI #0#7 = "VO";
     |ABRE #80;
     #80#0 = #0#3;
     #80#5 = #0#13;
     #80#1 = #0#14;
     |LEE 021#80=;
     |SI FSalida = 0;
          #80#4 = 0;
          |GRABA 021#80a;
     |FINSI;
     |LIBERA #80;
     |CIERRA #80;
|SINO;

|FINSI;
|FPRC;

|PROCESO borra_fra_standard;
|ABRE #55;
|ABRE #56;
#55#14 = #0#15;
#55#0 = #0#16;
|BORRA 021#55c;

#56#0 = #0#16;
#56#49 = #0#15;
|HAZ BorraRecVenta;
#56#0 = #0#16;
#56#49 = #0#15;
|BORRA 021#56c;
|LIBERA #55;
|LIBERA #56;
|CIERRA #55;
|CIERRA #56;
|FPRC;

|PROCESO borra_lin_fr;
|FPRC;

|PROCESO borra_fra;
|ABRE #20;
#20#0 = #0#15;
#20#1 = #0#16;
|LEE 001#20=;
|SI FSalida = 0;
     |SI #0#7 = "VN" ; |O #0#7 = "VO";
          |HAZ quita_VNVO;
     |SINO;
          |ABRE #30;
          |HAZ quita_cliente;
          |GRABA 021#30a;
          |LIBERA #30;
          |CIERRA #30;
     |FINSI;
     |BORRA 021#20a;
     |BUCLELIN 1borra_lin_fr#20;
     |HAZ borra_fra_standard;
     #0#15 = "";
     #0#16 = 0;
     #0#17 = "01.01.0000";
     aEstado = "";
     |BUCLE PonEstado;
     |PINTA #0#15;
     |PINTA #0#16;
     |PINTA #0#17;
     |GRABA 001#0a;

|FINSI;
|LIBERA #0;
|LIBERA #20;
|CIERRA #20;
|FPRC;

|PROCESO suma_lin_fra;
lineas_fra = lineas_fra + 1;
|FPRC;

|DEFBUCLE lee_lin_fra;
#67#1;
;
#0#15 , #0#16 , 001;
#0#15 , #0#16 , 999;
;
NULL , suma_lin_fra;
|FIN;

|PROCESO puedo_borrar;
lineas_fra = 0;
|BUCLE lee_lin_fra;
|SI lineas_fra > 1;
     puedo_borrar = "N";
|FINSI;
|FPRC;


|PROCESO pideclave;
    |PUSHV 0501 2475;
    |HAZ PintaClave;

    |PINTA 2415, "Clave modific. .:";
    alfa = "";
    E_sup = 4;
    E_inf = "";
    alfa = 2434 ? -1;
    |QBF alfa;

    alfa = alfa + " ";   || compatibiliza con las preguntas de la clave

    |POPV;
|FPRC;


|PROCESO borra_li;
     |SI #1#9 = 2 ; |O #1#9 = 4;
          |HAZ baja_histo;
     |FINSI;
     |BORRA 020#1a;
|FPRC;

|DEFBUCLE borra_lin;
     #1#1;
     ;
     #0#0 , #0#1 ,  1;
     #0#0 , #0#1 ,9999;
     be;
     NULL , borra_li;
|FIN;

|PROCESO MiraLin;
     |SI #1#26 ! 0; |Y #1#27 ! 0;
          aAlfa = "0000No se puede borrar. Modifique el albaran:";
          aAlfa = aAlfa + #1#25 + "/" + (("000000"+#1#26)%-106)+"/"+(("000"+#1#27)%-103);
          |MENAV aAlfa;
          nSwFlag = 1;
          |ERROR10; |ACABA;
     |FINSI;
     |SI #1#36 ! 0;
          aAlfa = "0000Linea OR facturada:" + #1#11 + ", Factura:" + #1#35 + "/" + (("000000"+#1#36)%-106);
          |MENAV aAlfa;
          nSwFlag = 1;
     |FINSI;
|FPRC;

|DEFBUCLE MiraLin;
     #1#1;
     ;
     #0#0 , #0#1 ,  1;
     #0#0 , #0#1 ,9999;
     ;
     NULL , MiraLin;
|FIN;

|PROCESO T625_1; |TIPO 1;
     nSwFlag = 0;
|FPRC;

|PROCESO mod_baja;|TIPO 2;
     modo = (FEntrada/100)!0;
     mod = 0 +. 1;

     |SI mod = 1; nSwFlag = 0; |FINSI;
     |SI nSwFlag = 1; |ACABA; |FINSI;

     |SI modo = 3;
          |SI #0#14 = 0;
/*
             puedo_borrar = "S";
             |HAZ puedo_borrar;
             |SI puedo_borrar ! "S";
                   |MENAV "0000Estar O.R. esta en una factura englobada. Borrar por Facturas";
                   correcto = 1;
                   nSwFlag = 1;
                   |ERROR; |ACABA;
             |FINSI;
*/
          |SINO;
               mensaje = "0000Este parte No se Puede Borrar. Viene de un ";
               mensaje = mensaje + #0#7;
               |MENAV mensaje;
               nSwFlag = 1;
               |ERROR; |ACABA;
          |FINSI;
          |BUCLE MiraLin;
          |SI nSwFlag = 1;
               |ERROR; |ACABA;
          |FINSI;
     |FINSI;

     |SI mod = 1;
          |ABRE #601;
          #601#0 = #0#3;
          |LEE 101#601=;
          |SI FSalida = 0;
               #601#12 = #0#5;
               |GRABA 020#601a;
          |FINSI;
          |CIERRA #601;
     |FINSI;

     |SI mod < 0;
          |SI modo = 2; |O modo = 3;
               |SI #0#16 ! 0;
                  |SI #0#16 ! 999999;
/*
                    |SI modo = 2; nSwModiOrden = 1; |FINSI;
                    |HAZ MiraRecibos;
                    nSwModiOrden = 0;
                    |SI enErrCarte ! 0;
                         nSwFlag = 1; |ERROR; |ACABA;
                    |FINSI;
*/
                    |SI modo = 3;
                         |CONFI "0000NConfirmar la Baja";
                         |SI FSalida ! 0;
                              correcto = 1;
                              nSwFlag = 1;
                              |ERROR; |ACABA;
                         |SINO;
/*
                              puedo_borrar = "S";
                              |HAZ puedo_borrar;
                              |SI puedo_borrar = "S";
                                  |HAZ borra_fra;
                              |SINO;
                                   |MENAV "0000Estar O.R. esta en una factura englobada. Borrar por Facturas";
                                   correcto = 1;
                                   nSwFlag = 1;
                                   |ERROR; |ACABA;
                              |FINSI;
*/
                         |FINSI;
                    |SINO;
                         |CONFI "0000NModificar O.R.";
                         |SI FSalida ! 0;
                              correcto = 1;
                              nSwFlag = 1;
                              |ERROR; |ACABA;
                         |SINO;
                            |HAZ pideclave;
                            |SI alfa = "MOR ";
/*
                              puedo_borrar = "S";
                              |HAZ puedo_borrar;
                              |SI puedo_borrar = "S";
                                   |HAZ borra_fra;
                              |SINO;
                                   |MENAV "0000Estar O.R. esta en una factura englobada. Borrar por Facturas";
                                   correcto = 1;
                                   nSwFlag = 1;
                                   |ERROR; |ACABA;
                              |FINSI;
*/
                            |SINO;
                               |MENAV "0000CLAVE INCORRECTA";
                               nSwFlag = 1;
                               |ERROR; |ACABA;
                            |FINSI;
                         |FINSI;
                    |FINSI;
                  |SINO;
                    |MENAV "0000Esta O.R. esta cerrada.";
                    |CONFI "0000SDesea Modificar (S/N) ";
                    |SI FSalida ! 0;
                         nSwFlag = 1; |ERROR; |ACABA;
                    |SINO;
                         |HAZ pideclave;
                         |SI alfa = "MOR ";
                            #0#16 = 0;
                            |PINTA #0#16;
                            |GRABA 001#0a;
                            |LIBERA #0;
                            nSwActCli = -1;
                            aEstado = "";
                            |BUCLE PonEstado;
                            nSwActCli = 0;
                          |SINO;
                             |MENAV "0000CLAVE INCORRECTA";
                             nSwFlag = 1;
                             |ERROR; |ACABA;
                          |FINSI;
                    |FINSI;
                  |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
     |SI modo = 3;
          |BUCLE borra_lin;
          |ABRE #625;
          #625#0 = #0#38;
          #625#1 = #0#39;
          |LEE 101#625=;
          |SI FSalida = 0;
               #625#38 = "N";
               #625#39 = "";
               #625#40 = "";
               |GRABA 020#625a;
          |FINSI;
          |CIERRA #625;
     |FINSI;
     eaSerie = #0#0;
     eaCliente = #0#11;
     eaNomCliente = #0#19;
     enTotal = 0;
     |HAZ CalculaTotal;
     eaTag = "OR";  |HAZ Riesgos;

     |SI modo = 2;
          aSwFactu = "N";
          |BUCLE MiraFactu;
          aSwModCab = "S";
          |SI aSwFactu = "S"; |Y #0#17 ! "01.01.0000";
               IaModCam = aModCam1<-;
               aAlfa = "|NC";
               aCampos = #0#aAlfa#;
               |SI mod = 1;
                    |PARA i = 0; |SI i < aCampos; |HACIENDO i = i + 1;
                         aAlfa = aModCam;
                         |C_M #0i, 1, aAlfa;
                         IaModCam = IaModCam + 1;
                    |SIGUE;
               |SINO;
                    aSwModCab = "N";
                    |PARA i = 0; |SI i < aCampos; |HACIENDO i = i + 1;
                         |C_M #0i, 0, aAlfa;
                         |C_M #0i, 1, "N";
                         aModCam = aAlfa;
                         IaModCam = IaModCam + 1;
                    |SIGUE;
                    |C_M #0#5, 1, "S";
               |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO actua_arti;
      |HAZ LeeSerie;

      |ABRE #9;
      |DDEFECTO #9;
      #9#0 = #1#2;
      #9#1 = enAlmaSer;
      |LEE 101#9=;
      |SI FSalida ! 0; |GRABA 011#9b; |FINSI;

      #9#39 = #9#39 - enUni;
      #9#5 = #9#5 - enUni;
      fmes = #0#2 % A402;
      mes = fmes - 1;
      mes = mes * 2;
      mes = mes + 11;
      #9mes = #9mes + enUni; ||salida mensual
      #9#35 = #9#35 + enUni; ||salida anual

      #11#6 = #11#6 - enUni;
      #11#104 = #11#104 - enUni;
      fmes = #0#2 % A402;
      mes = fmes - 1;
      mes = mes * 5;
      mes = mes + 34;
      #11mes = #11mes + enUni;
      #11#94 = #11#94 + enUni;
/*
      mes_importe = mes + 1;
      mes_margen = mes + 2;
      |SI #1#14 = "G"; |O #1#14 = "S";
           #11mes_margen  = #11mes_margen -  #1#17;||\\ resto el coste
           #11#96 = #11#96 - #1#17;  ||anual
      |SINO;
           #11mes_importe = #11mes_importe + #1#8; || Sumo la venta
           #11mes_margen  = #11mes_margen + (#1#8 - #1#17);||\\ resto el coste

           #11#95 = #11#95 + #1#8;            || ptas ventas anual
           #11#96 = #11#96 + (#1#8 - #1#17);  ||margen anual
      |FINSI;
*/
      |HAZ ValoraStock;
      |GRABA 021#11a;
      |GRABA 021#9a;
      |CIERRA #9;
      |LIBERA #11;
/*
     |SI #1#14 = "G"; |O #1#14 = "S";
          enImpMar =  - #1#17;  ||anual
     |SINO;
          enImpMar = (#1#8 - #1#17);  ||margen anual
          enImpVta = #1#8;
     |FINSI;
*/
     enUniVta = enUni;
     enUniSal = enUni;
     eaArticulo = #1#2;
     enAlmacen = enAlmaSer;
     efFecha = #0#2;
     |HAZ AcumulaArt;
     |HAZ AcumulaAlm;
|FPRC;

|PROCESO quita_histo;
 |ABRE #12;
 |DDEFECTO #12;
 #12#0 = #1#2;||articulo
 #12#11= #0#0;||Serie
 #12#1 = #1#22;||FECHA
 #12#2 = "OR";|| tipo operacion
 #12#3 = #1#1;|| documento
 #12#4 = #1#11;|| linea
 |BORRA 021#12c;
 |CIERRA #12;

|FPRC;

|PROCESO alta_histo;
|ABRE #11;
#11#0 = #1#2;
|LEE 021#11=;
|SI FSalida = 0; || \\ falta preguntar por el almacen
     enUni = #1#4;
     |HAZ actua_arti;
     |HAZ actua_histo;
|FINSI;
|LIBERA #11;
|CIERRA #11;
|FPRC;

|PROCESO baja_histo;
|ABRE #11;
#11#0 = #1#2;
|LEE 021#11=;
|SI FSalida = 0; || \\ falta preguntar por el almacen
     enUni = -#1#4;
     |HAZ actua_arti;
     |HAZ quita_histo;
|FINSI;
|LIBERA #11;
|CIERRA #11;
|FPRC;

|PROCESO comercial;
nPrime = 1;

|SI tipo_parte ! "";
#0#3 = matricula;
#0#4 = bastidor;
#0#11 = cliente;
#0#7 = tipo_parte;
#0#13 = fecha_ent;
#0#14 = linea_usado;
serie_parte = #0#0;
numparte = #0#1;
|PINTA #0#3;
|PINTA #0#4;
|PINTA #0#11;
|PINTA #0#7;
|FINSI;
|FPRC;


|PROCESO texto_reparacion;
     |PUSHV 0501 2380;
     |SI aSwModCab = "N";
          |ENTLINEAL #1#14 , 3 , 4 , 22 , 1 , min_texto , max_texto;
     |SINO;
          |ENTLINEAL #1#14 , 3 , 1 , 22 , 1 , min_texto , max_texto;
     |FINSI;
     |POPV;
|FPRC;

|PROCESO min_texto;
#14#0 = #0#0;
#14#1 = #0#1;
#14#2 = 001;
|FPRC;
|PROCESO max_texto;
#14#0 = #0#0;
#14#1 = #0#1;
#14#2 = 999;
|FPRC;

|PROCESO lineal;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 4;
          |ENTLINEAL #1#1 , 3 , 4 , 22 , 0 ,  min , max;
     |SINO;
          |ENTLINEAL #1#1 , 3 , 2 , 22 , 0 ,  min , max;
/*
          |SI #0#16 = 0;
               |ENTLINEAL #1#1 , 3 , 2 , 22 , 0 ,  min , max;
          |SINO;
               |ENTLINEAL #1#1 , 3 , 7 , 22 , 0 ,  min , max;
          |FINSI;
*/
     |FINSI;
|FPRC;


|PROCESO tipo13;|TIPO 13;
     |HAZ TallerDeci;
     |ENTLINEAL #1#1 , 3 , 7 , 22 , 0 ,  min , max;
|FPRC;

|PROCESO min;
     #1#0 = #0#0;
     #1#1 = #0#1;
     #1#11 = 1;
|FPRC;

|PROCESO minFin;
     #1#0 = #0#0;
     #1#1 = #0#1;
     #1#11 = nPosLin;
|FPRC;

|PROCESO max;
     #1#0 = #0#0;
     #1#1 = #0#1;
     #1#11 = 9999;
|FPRC;


|PROCESO pon_pieza;
nSeccion = #1#23;
|DDEFECTO #1;
#1#0 = #0#0;
#1#1 = #0#1;
#1#11 = 1999;
|LEE 001#1];
|SI FSalida ! 0;
      |LEE 001#1u;
|SINO;
     |LEE 001#1a;
|FINSI;
|SI FSalida ! 0;
     |DDEFECTO #1;
     #1#0 = #0#0;
     #1#1 = #0#1;
     #1#2 = #10#2;
     #1#3 = #11#1;
     #1#4 = #10#4;
     #1#5 = #11#18;
     #1#6 = 0;
     #1#7 = 0;
     #1#8 = #1#4 * #1#5;
     #1#10 = #0#7;
     #1#9 = 2;
     #1#11 = 1000;
     #1#12 = linea_aux;
     #1#14 = #4#12;
     ||\\#1#19 = #90#1;
     #1#15 = #11#9;|| costo medio;
     ||\\|SI #90#1 = 0;
     ||\\     #1#16 = #1#15;
     ||\\|SINO;
     ||\\     #1#16 = #1#5 - (#1#5 % #90#1)!0;
     ||\\|FINSI;
     #1#17 = #1#15 * #1#4;
     #1#18 = #1#16 * #1#4;
     #1#23 = nSeccion;
     |GRABA 001#1n;
|SINO;
     |SI #1#0 = #0#0;|Y #1#1 = #0#1;|Y #1#11 ] 999;|Y #1#11 [ 1999;
          linea = #1#11 + 1;
          |DDEFECTO #1;
          #1#0 = #0#0;
          #1#1 = #0#1;
          #1#2 = #10#2;
          #1#3 = #11#1;
          #1#4 = #10#4;
          #1#5 = #11#18;
          #1#6 = 0;
          #1#7 = 0;
          #1#8 = #1#4 * #1#5;
          #1#10 = #0#7;
          #1#9 = 2;
          #1#11 = linea;
          #1#12 = linea_aux;
          #1#14 = #4#12;
          ||#1#19 = #90#1;
          #1#15 = #11#9;|| costo medio;
          |||SI #90#1 = 0;
          ||     #1#16 = #1#15;
          |||SINO;
          ||     #1#16 = #1#5 - (#1#5 % #90#1)!0;
          |||FINSI;
           #1#17 = #1#15 * #1#4;
           #1#18 = #1#16 * #1#4;
          #1#23 = nSeccion;
          |GRABA 001#1n;
     |SINO;
          |DDEFECTO #1;
          #1#0 = #0#0;
          #1#1 = #0#1;
          #1#2 = #10#2;
          #1#3 = #11#1;
          #1#4 = #10#4;
          #1#5 = #11#18;
          #1#6 = 0;
          #1#7 = 0;
          #1#8 = #1#4 * #1#5;
          #1#10 = #0#7;
          #1#9 = 2;
          #1#11 = 1000;
          #1#12 = linea_aux;
          #1#14 = #4#12;
                 ||#1#19 = #90#1;
                 #1#15 = #11#9;|| costo medio;
          |||SI #90#1 = 0;
          ||     #1#16 = #1#15;
          |||SINO;
          ||     #1#16 = #1#5 - (#1#5 % #90#1)!0;
          |||FINSI;
                 #1#17 = #1#15 * #1#4;
                 #1#18 = #1#16 * #1#4;
          #1#23 = nSeccion;
          |GRABA 001#1n;
     |FINSI;
|FINSI;

|LIBERA #1;

|FPRC;

|PROCESO pon_lubri;
nSeccion = #1#23;
|DDEFECTO #1;
#1#0 = #0#0;
#1#1 = #0#1;
#1#11 = 4000;
|LEE 001#1];
|SI FSalida ! 0;
      |LEE 001#1u;
|SINO;
     |LEE 001#1a;
|FINSI;
|SI FSalida ! 0;
     |DDEFECTO #1;
     #1#0 = #0#0;
     #1#1 = #0#1;
          #1#2 = #10#2;
          #1#3 = #11#1;
          #1#4 = #10#4;
          #1#5 = #11#18;
          #1#6 = 0;
          #1#7 = 0;
          #1#8 = #1#4 * #1#5;
          #1#10 = #0#7;
     #1#9 = 4;
     #1#11 = 3000;
     #1#12 = linea_aux;
     #1#14 = #4#12;
     ||#1#19 = #90#1;
     #1#15 = #11#9;|| costo medio;
     ||     |SI #90#1 = 0;
     ||          #1#16 = #1#15;
     ||     |SINO;
     ||          #1#16 = #1#5 - (#1#5 % #90#1)!0;
     ||     |FINSI;
     #1#17 = #1#15 * #1#4;
     #1#18 = #1#16 * #1#4;
     #1#23 = nSeccion;
     |GRABA 001#1n;
|SINO;
     |SI #1#0 = #0#0;|Y #1#1 = #0#1;|Y #1#11 ] 3000;|Y #1#11 [ 3999;
          linea = #1#11 + 1;
          |DDEFECTO #1;
          #1#0 = #0#0;
          #1#1 = #0#1;
          #1#2 = #10#2;
          #1#3 = #11#1;
          #1#4 = #10#4;
          #1#5 = #11#18;
          #1#6 = 0;
          #1#7 = 0;
          #1#8 = #1#4 * #1#5;
          #1#10 = #0#7;
          #1#9 = 4;
          #1#11 = linea;
          #1#12 = linea_aux;
          #1#14 = #4#12;
     ||#1#19 = #90#1;
          #1#15 = #11#9;|| costo medio;
      ||    |SI #90#1 = 0;
      ||         #1#16 = #1#15;
      ||    |SINO;
      ||         #1#16 = #1#5 - (#1#5 % #90#1)!0;
      ||    |FINSI;
          #1#17 = #1#15 * #1#4;
          #1#18 = #1#16 * #1#4;
          #1#23 = nSeccion;
          |GRABA 001#1n;
     |SINO;
          |DDEFECTO #1;
          #1#0 = #0#0;
          #1#1 = #0#1;
          #1#2 = #10#2;
          #1#3 = #11#1;
          #1#4 = #10#4;
          #1#5 = #11#18;
          #1#6 = 0;
          #1#7 = 0;
          #1#8 = #1#4 * #1#5;
          #1#10 = #0#7;
          #1#9 = 4;
          #1#11 = 3000;
          #1#12 = linea_aux;
          #1#14 = #4#12;
     ||#1#19 = #90#1;
          #1#15 = #11#9;|| costo medio;
     ||     |SI #90#1 = 0;
     ||          #1#16 = #1#15;
     ||     |SINO;
     ||          #1#16 = #1#5 - (#1#5 % #90#1)!0;
     ||     |FINSI;
          #1#17 = #1#15 * #1#4;
          #1#18 = #1#16 * #1#4;
          #1#23 = nSeccion;
          |GRABA 001#1n;
     |FINSI;
|FINSI;

|LIBERA #1;

|FPRC;

|PROCESO pon_relac;
     |DDEFECTO #11;
     #11#0 = #10#2;
     |LEE 000#11=;

     |SI #10#5 = "P";
          |HAZ pon_pieza;
     |SINO;
          |HAZ pon_lubri;
     |FINSI;
     |HAZ alta_histo;
|FPRC;

|DEFBUCLE lee_relaci;
#10#1;
;
#4#0 , 1;
#4#0 , 99;
;
NULL , pon_relac;
|FIN;


|PROCESO ver_importe;
|ABRE #90;
#90#0 = #82#0;
|LEE 001#90=;
|SI FSalida ! 0 ; |DDEFECTO #90;|FINSI;
precio = #90#2;
|LIBERA #90;
|CIERRA #90;
|FPRC;

|PROCESO horas_pend;
     |SI pri = 0;
          seguir = 1;
          |CONFI "0000S ¨RECOGER HORAS PENDIENTES? (S/N) ";
          seguir = FSalida;
           pri = 1;
     |FINSI;
     |SI seguir = 0;  ||Recoger las horas
          |SI #82#10 ! 0;
               |HAZ ver_importe;
               |ABRE #1;
               |DDEFECTO #1;
               #1#0 = #0#0;
               #1#1 = #0#1;
               #1#11 = 999;
               |LEE 001#1];
               |SI FSalida ! 0;
                    |LEE 001#1u;
               |SINO;
                    |LEE 001#1a;
               |FINSI;
               |SI FSalida ! 0;
                    |DDEFECTO #1;
                    #1#0 = #0#0;
                    #1#1 = #0#1;
                    #1#2 = "";
                    #1#3 = "M. Obra Operario :" + #82#0;
                    #1#4 = #82#10;
                    #1#5 = precio;
                    #1#6 = 0;
                    #1#7 = 0;
                    #1#8 = #1#4 * #1#5;
                    #1#10 = #0#7;
                    #1#9 = 1;
                    #1#12 = 0;
                    #1#13 = #82#6;
                    #1#14 = #0#12;
                    #1#15 = 0;
                    #1#16 = 0;
                    #1#17 = 0;
                    #1#18 = 0;
                    #1#19 = 0;
                    #1#20 = "N";
                    #1#21 = #82#0;
                    #1#22 = #82#1;
                    #1#23 = #82#14;
                    #1#24 = #82#2;
                    linea_aux = #1#11;
                    |HAZ DtoOpe;
                    |GRABA 001#1n;
               |SINO;
                    |SI #1#0 = #0#0;|Y #1#1 = #0#1;|Y #1#11 [ 999;
                         linea = #1#11 + 1;
                         |DDEFECTO #1;
                         #1#0 = #0#0;
                         #1#1 = #0#1;
                         #1#2 = "";
                         #1#3 = "M. Obra Operario :" + #82#0;
                         #1#4 = #82#10;
                         #1#5 = precio;
                         #1#6 = 0;
                         #1#7 = 0;
                         #1#8 = #1#4 * #1#5;
                         #1#10 = #0#7;
                         #1#9 = 1;
                         #1#12 = 0;
                         #1#13 = #82#6;
                         #1#14 = #0#12;
                         #1#15 = 0;
                         #1#16 = 0;
                         #1#17 = 0;
                         #1#18 = 0;
                         #1#19 = 0;
                         #1#20 = "N";
                         #1#21 = #82#0;
                         #1#22 = #82#1;
                         #1#23 = #82#14;
                         #1#24 = #82#2;
                         #1#11 = linea;
                         linea_aux = linea;
                         |HAZ DtoOpe;
                         |GRABA 001#1n;
                    |SINO;
                         |DDEFECTO #1;
                         #1#0 = #0#0;
                         #1#1 = #0#1;
                         #1#2 = "";
                         #1#3 = "M. Obra Operario :" + #82#0;
                         #1#4 = #82#10;
                         #1#5 = precio;
                         #1#6 = 0;
                         #1#7 = 0;
                         #1#8 = #1#4 * #1#5;
                         #1#10 = #0#7;
                         #1#9 = 1;
                         #1#12 = 0;
                         #1#13 = #82#6;
                         #1#14 = #0#12;
                         #1#15 = 0;
                         #1#16 = 0;
                         #1#17 = 0;
                         #1#18 = 0;
                         #1#19 = 0;
                         #1#20 = "N";
                         #1#21 = #82#0;
                         #1#22 = #82#1;
                         #1#23 = #82#14;
                         #1#24 = #82#2;
                         #1#11 = 1;
                         linea_aux =  #1#11;
                         |HAZ DtoOpe;
                         |GRABA 001#1n;
                    |FINSI;
               |FINSI;
               #82#11 = "S";
               |GRABA 010#82a;
          |SINO;
               |MENAV "0000Esta orden tiene partes sin finalizar.";
          |FINSI;
     |SINO;
          |ERROR10;
     |FINSI;
|FPRC;

|DEFBUCLE ver_horas;
 #82#2;
 ;
 #0#0,#0#1,"N";
 #0#0,#0#1,"N";
 be;
 NULL ,horas_pend;
|FIN;

|PROCESO mano_obra;
     pri = 0;
     |BUCLE ver_horas;
     |SI pri ! 0; |Y seguir = 0; |ACABA; |FINSI; || Se han recogido Horas
     |DDEFECTO #4;
     #4#9 = #0#7;
     ||#4#15 = #1#23;
     #4#16 = 1;
     #4#17 = #0#0;
     |PUSHV 0501 2380;
     |PINPA #0#4;
     |PINDA #0#4;
     |ENDATOS #1#4;
     |SI FSalida = 0;
          |ABRE #con00680;
          #con00680#0 = #4#13;
          |LEE 000#con00680.=;
          |SI FSalida ! 0; |DDEFECTO #con00680; |FINSI;
          |CIERRA #con00680;
          enSwCoste = 0; |HAZ SacaCoste;

          |ABRE #1;
          |DDEFECTO #1;
          #1#0 = #0#0;
          #1#1 = #0#1;
          #1#11 = 999;
          |LEE 001#1];
          |SI FSalida ! 0;
                |LEE 001#1u;
          |SINO;
               |LEE 001#1a;
          |FINSI;
          |SI FSalida ! 0;
               |DDEFECTO #1;
               #1#0 = #0#0;
               #1#1 = #0#1;
               #1#2 = #4#0;
               #1#3 = #4#1;
               #1#4 = #4#2;
               #1#5 = #4#4;
               #1#6 = #4#6;
               #1#7 = #4#7;
               #1#8 = #4#8;
               #1#10 = #4#9;
               #1#9 = 1;
               #1#11 = 1;
               #1#13 = #4#3;
               #1#14 = #4#12;
               #1#16 = enSwCoste;
               #1#18 = enSwCoste * #1#4;
               #1#21 = #4#13;
               linea_aux = #1#11;
               #1#22 = #4#14;
               #1#23 = #4#15;
          |SINO;
               |SI #1#0 = #0#0;|Y #1#1 = #0#1;|Y #1#11 [ 999;
                    linea = #1#11 + 1;
                    |DDEFECTO #1;
                    #1#0 = #0#0;
                    #1#1 = #0#1;
                    #1#2 = #4#0;
                    #1#3 = #4#1;
                    #1#4 = #4#2;
                    #1#5 = #4#4;
                    #1#6 = #4#6;
                    #1#7 = #4#7;
                    #1#8 = #4#8;
                    #1#10 = #4#9;
                    #1#9 = 1;
                    #1#11 = linea;
                    linea_aux = linea;
                    #1#13 = #4#3;
                    #1#14 = #4#12;
                    #1#16 = enSwCoste;
                    #1#18 = enSwCoste * #1#4;
                    #1#21 = #4#13;
                    #1#22 = #4#14;
                    #1#23 = #4#15;
               |SINO;
                    |DDEFECTO #1;
                    #1#0 = #0#0;
                    #1#1 = #0#1;
                    #1#2 = #4#0;
                    #1#3 = #4#1;
                    #1#4 = #4#2;
                    #1#5 = #4#4;
                    #1#6 = #4#6;
                    #1#7 = #4#7;
                    #1#8 = #4#8;
                    #1#10 = #4#9;
                    #1#9 = 1;
                    #1#11 = 1;
                    linea_aux =  #1#11;
                    #1#13 = #4#3;
                    #1#14 = #4#12;
                    #1#16 = enSwCoste;
                    #1#18 = enSwCoste * #1#4;
                    #1#21 = #4#13;
                    #1#22 = #4#14;
                    #1#23 = #4#15;
               |FINSI;
          |FINSI;
          |HAZ RiesgoLin;
          |SI FSalida = 0; |GRABA 001#1n; |FINSI;
          |LIBERA #1;
          |ABRE #11;
          |BUCLE lee_relaci;
          |CIERRA #11;
          |CIERRA #1;
     |FINSI;
     |POPV;
|FPRC;

|PROCESO articulos;
|DDEFECTO #5;
#5#8 = #0#7;
||#5#18 = #1#23;
#5#19 = 2;
#5#20 = #0#0;
|PUSHV 0501 2380;
|PINPA #0#5;
|PINDA #0#5;
|ENDATOS #1#5;
|SI FSalida = 0;

|ABRE #1;
|DDEFECTO #1;
#1#0 = #0#0;
#1#1 = #0#1;
#1#11 = 1999;
|LEE 001#1];
|SI FSalida ! 0;
      |LEE 001#1u;
|SINO;
     |LEE 001#1a;
|FINSI;
|SI FSalida ! 0;
     |DDEFECTO #1;
     #1#0 = #0#0;
     #1#1 = #0#1;
     #1#2 = #5#0;
     #1#3 = #5#1;
     #1#4 = #5#2;
     #1#5 = #5#3;
     #1#6 = #5#5;
     #1#7 = #5#6;
     #1#8 = #5#7;
     #1#10 = #5#8
     #1#9 = 2;
     #1#11 = 1000;
     #1#14 = #5#11;
     #1#15 = #5#12;
     #1#16 = #5#13;
     #1#17 = #5#14;
     #1#18 = #5#15;
     #1#19 = #5#16;
     #1#22 = #5#17;
     #1#23 = #5#18;
|SINO;
     |SI #1#0 = #0#0;|Y #1#1 = #0#1;|Y #1#11 ] 999;|Y #1#11 [ 1999;
          linea = #1#11 + 1;
          |DDEFECTO #1;
          #1#0 = #0#0;
          #1#1 = #0#1;
          #1#2 = #5#0;
          #1#3 = #5#1;
          #1#4 = #5#2;
          #1#5 = #5#3;
          #1#6 = #5#5;
          #1#7 = #5#6;
          #1#8 = #5#7;
          #1#10 = #5#8
          #1#9 = 2;
          #1#11 = linea;
          #1#14 = #5#11;
          #1#15 = #5#12;
          #1#16 = #5#13;
          #1#17 = #5#14;
          #1#18 = #5#15;
          #1#19 = #5#16;
          #1#22 = #5#17;
          #1#23 = #5#18;
     |SINO;
          |DDEFECTO #1;
          #1#0 = #0#0;
          #1#1 = #0#1;
          #1#2 = #5#0;
          #1#3 = #5#1;
          #1#4 = #5#2;
          #1#5 = #5#3;
          #1#6 = #5#5;
          #1#7 = #5#6;
          #1#8 = #5#7;
          #1#10 = #5#8
          #1#9 = 2;
          #1#11 = 1000;
          #1#14 = #5#11;
          #1#15 = #5#12;
          #1#16 = #5#13;
          #1#17 = #5#14;
          #1#18 = #5#15;
          #1#19 = #5#16;
          #1#22 = #5#17;
          #1#23 = #5#18;
     |FINSI;
|FINSI;
|HAZ RiesgoLin;
|SI FSalida = 0;
     |GRABA 001#1b;
     |HAZ alta_histo;
     |SALVA_FICHA #1;
     |HAZ CanonArticulo;
     |REPON_FICHA #1;
     #1#28 = nLin;
     |GRABA 020#1a;
|FINSI;
|LIBERA #1;
|CIERRA #1;
|FINSI;
|POPV;
|FPRC;

|PROCESO ser_exter;
|DDEFECTO #3;
#3#7 = #0#7;
||#3#15 = #1#23;
#3#16 = 3;
#3#17 = #0#0;
|PUSHV 0501 2380;
|PINPA #0#3;
|PINDA #0#3;
|ENDATOS #1#3;
|SI FSalida = 0;

  |ABRE #1;
  |DDEFECTO #1;
  #1#0 = #0#0;
  #1#1 = #0#1;
  #1#11 = 3000;
  |LEE 001#1];
  |SI FSalida ! 0;
        |LEE 001#1u;
  |SINO;
       |LEE 001#1a;
  |FINSI;
  |SI FSalida ! 0;
       |DDEFECTO #1;
       #1#0 = #0#0;
       #1#1 = #0#1;
       #1#2 = #3#0;
       #1#3 = #3#1;
       #1#4 = #3#2;
       #1#5 = #3#3;
       #1#6 = #3#4;
       #1#7 = #3#5;
       #1#8 = #3#6;
       #1#9 = 3;
       #1#10 = #3#7;
       #1#11 = 2000;
       #1#14 = #3#11;
       #1#16 = #3#12;
       #1#18 = #3#13;
       #1#22 = #3#14;
       #1#23 = #3#15;
  |SINO;
       |SI #1#0 = #0#0;|Y #1#1 = #0#1;|Y #1#11 ] 2000;|Y #1#11 [ 2999;
            linea = #1#11 + 1;
            |DDEFECTO #1;
            #1#0 = #0#0;
            #1#1 = #0#1;
            #1#2 = #3#0;
            #1#3 = #3#1;
            #1#4 = #3#2;
            #1#5 = #3#3;
            #1#6 = #3#4;
            #1#7 = #3#5;
            #1#8 = #3#6;
            #1#9 = 3;
            #1#10 = #3#7;
            #1#11 = linea;
            #1#14 = #3#11;
            #1#16 = #3#12;
            #1#18 = #3#13;
            #1#22 = #3#14;
            #1#23 = #3#15;
       |SINO;
            |DDEFECTO #1;
            #1#0 = #0#0;
            #1#1 = #0#1;
            #1#2 = #3#0;
            #1#3 = #3#1;
            #1#4 = #3#2;
            #1#5 = #3#3;
            #1#6 = #3#4;
            #1#7 = #3#5;
            #1#8 = #3#6;
            #1#9 = 3;
            #1#10 = #3#7;
            #1#11 = 2000;
            #1#14 = #3#11;
            #1#16 = #3#12;
            #1#18 = #3#13;
            #1#22 = #3#14;
            #1#23 = #3#15;
       |FINSI;
  |FINSI;
  |HAZ RiesgoLin;
  |SI FSalida = 0; |GRABA 001#1n; |FINSI;
  |LIBERA #1;
  |CIERRA #1;
|FINSI;
|POPV;
|FPRC;

|PROCESO lubricant;
|DDEFECTO #6;
#6#8 = #0#7;
||#6#18 = #1#23;
#6#19 = 4;
#6#20 = #0#0;
|PUSHV 0501 2380;
|PINPA #0#6;
|PINDA #0#6;
|ENDATOS #1#6;
|SI FSalida = 0;
|ABRE #1;
|DDEFECTO #1;
#1#0 = #0#0;
#1#1 = #0#1;
#1#11 = 4000;
|LEE 001#1];
|SI FSalida ! 0;
      |LEE 001#1u;
|SINO;
     |LEE 001#1a;
|FINSI;
|SI FSalida ! 0;
     |DDEFECTO #1;
     #1#0 = #0#0;
     #1#1 = #0#1;
     #1#2 = #6#0;
     #1#3 = #6#1;
     #1#4 = #6#2;
     #1#5 = #6#3;
     #1#6 = #6#5;
     #1#7 = #6#6;
     #1#8 = #6#7;
     #1#10 = #6#8
     #1#9 = 4;
     #1#11 = 3000;
     #1#14 = #6#11;
     #1#15 = #6#12;
     #1#16 = #6#13;
     #1#17 = #6#14;
     #1#18 = #6#15;
     #1#19 = #6#16;
     #1#22 = #6#17;
     #1#23 = #6#18;
|SINO;
     |SI #1#0 = #0#0;|Y #1#1 = #0#1;|Y #1#11 ] 3000;|Y #1#11 [ 3999;
          linea = #1#11 + 1;
          |DDEFECTO #1;
          #1#0 = #0#0;
          #1#1 = #0#1;
          #1#2 = #6#0;
          #1#3 = #6#1;
          #1#4 = #6#2;
          #1#5 = #6#3;
          #1#6 = #6#5;
          #1#7 = #6#6;
          #1#8 = #6#7;
          #1#10 = #6#8
          #1#9 = 4;
          #1#11 = linea;
          #1#14 = #6#11;
          #1#15 = #6#12;
          #1#16 = #6#13;
          #1#17 = #6#14;
          #1#18 = #6#15;
          #1#19 = #6#16;
          #1#22 = #6#17;
          #1#23 = #6#18;
     |SINO;
          |DDEFECTO #1;
          #1#0 = #0#0;
          #1#1 = #0#1;
          #1#2 = #6#0;
          #1#3 = #6#1;
          #1#4 = #6#2;
          #1#5 = #6#3;
          #1#6 = #6#5;
          #1#7 = #6#6;
          #1#8 = #6#7;
          #1#10 = #6#8
          #1#9 = 4;
          #1#11 = 3000;
          #1#14 = #6#11;
          #1#15 = #6#12;
          #1#16 = #6#13;
          #1#17 = #6#14;
          #1#18 = #6#15;
          #1#19 = #6#16;
          #1#22 = #6#17;
          #1#23 = #6#18;
     |FINSI;
|FINSI;
|HAZ RiesgoLin;
|SI FSalida = 0;
     |GRABA 001#1b;
     |HAZ alta_histo;
     |SALVA_FICHA #1;
     |HAZ CanonLubri;
     |REPON_FICHA #1;
     #1#28 = nLin;
     |GRABA 020#1a;
|FINSI;
|LIBERA #1;
|CIERRA #1;

|FINSI;
|POPV;
|FPRC;

|PROCESO suma_to;
     nTotCanon = 0;
     |SALVA_FICHA #1;
     |SI #1#28 > 0;
          #1#11 = #1#28;
          |LEE 020#1=;
          |SI FSalida = 0;
               nTotCanon = nTotCanon + #1#8;
          |FINSI;
     |FINSI;
     |REPON_FICHA #1;

     |SI #1#11 [ 999;
          #7#0 = #7#0 + #1#8;
          #7#10 = #7#10 + #1#4;
          |SI #1#14 = "G";
               #7#7 = #7#7 + #1#4;
          |SINO;
               |SI #1#14 = "N";
                    #7#8 = #7#8 + #1#4;
               |SINO;
                    |SI #1#14 = "N";
                         #7#9 = #7#9 + #1#4;
                    |FINSI;
               |FINSI;
          |FINSI;
     |FINSI;
     |SI #1#11 ] 1000;|Y #1#11 [ 1999; #7#1 = #7#1 + #1#8 + nTotCanon; |FINSI;
     |SI #1#11 ] 2000;|Y #1#11 [ 2999; #7#3 = #7#3 + #1#8 + nTotCanon; |FINSI;
     |SI #1#11 ] 3000;|Y #1#11 [ 3999; #7#2 = #7#2 + #1#8 + nTotCanon; |FINSI;
     #7#4 = #7#4 + #1#8;
     |SI #1#14 = "S";|O #1#14 = "G";|O #1#14 = "I"; #7#5 = #7#5 + #1#8; |FINSI;
     #7#6 = #7#4 - #7#5;
|FPRC;

|DEFBUCLE suma_t;
#1#1;
;
#0#0 , #0#1 ,   1;
#0#0 , #0#1 , 9999;
;
NULL , suma_to;
|FIN;

|PROCESO suma_tot;
     |DDEFECTO #7;
     |BUCLE suma_t;
     |SI correcto = 0;
          |PUSHV 0501 2380;
          |BLANCO 0909 2271;
          |PINPA #0#7;
          |PINDA #0#7;
          nGuarda = FEntrada;
          |SI aSwModCab = "N";
               |PAUSA;
          |SINO;
               |ENDATOS #4#7;
          |FINSI;
          FEntrada = nGuarda;
          |POPV;
     |FINSI;
     |SI aSwModCab ! "N";
          #0#22 = #7#0;
          #0#23 = #7#1;
          #0#24 = #7#2;
          #0#25 = #7#3;
          #0#26 = #7#5;
          #0#28 = #7#6;
          |GRABA 021#0a;
     |FINSI;
|FPRC;

|PROCESO pondatos;
     |ABRE #30;
     #30#0 = #0#11;
     |LEE 000#30=;
     |CIERRA #30;

     #21#3 = #0#11; ||Cli
     #21#4 = #0#19; ||Nom
     #21#5 = #0#3; ||Matri
     #21#14 = #0#0; ||Se
     #21#15 = #0#1; ||Num
     #21#20 = #30#20; ||Forma pago
     #21#21 = #30#29; ||Banco
     #21#22 = #30#30; ||Cta Banco
|FPRC;

|PROCESO sumaf;
     |SI #1#36 ! 0;
          |ACABA;
     |FINSI;

     aAlfa = "_" + #1#10;
     aAlfa = eaTParte - aAlfa;
     |SI eaTParte ! "TodoS"; |Y FSalida = 0;
          |ACABA;
     |FINSI;

     nOk = 0;
     |SI nSwTallerSC = 0;
          |SI #1#14 ! "S"; nOk = 1; |FINSI;
     |SINO;
          |SI #1#14 = "N"; |O #1#14 = "I"; nOk = 1; |FINSI;
     |FINSI;

     |SI nOk = 0; |ACABA; |FINSI;

     |SI #1#14 ! "I";
          |SI #1#11 ] 1; |Y #1#11 [ 999; ||\\ mano de obra;
               #21#19 = #21#19 + #1#8;
               #63#0 = #1#2;
               |LEE 000#63=;
               |SI FSalida ! 0; |DDEFECTO #63; |FINSI;
               tipo_iva = #63#5;
               |LIBERA #63;
          |FINSI;
          |SI #1#11 ] 1000; |Y #1#11 [ 1999; ||Piezas;
               #21#16 = #21#16 + #1#8;
               #11#0 = #1#2;
               |LEE 000#11=;
               |SI FSalida ! 0 ; |DDEFECTO #11; |FINSI;
               tipo_iva = #11#30;
               |LIBERA #11;
          |FINSI;
          |SI #1#11 ] 2000; |Y #1#11 [ 2999; || S.exte;
               #21#18 = #21#18 + #1#8;
               #66#0 = #1#2;
               |LEE 000#66=;
               |SI FSalida ! 0 ; |DDEFECTO #66; |FINSI;
               tipo_iva = #66#4;
               |LIBERA #66;
          |FINSI;
          |SI #1#11 ] 3000; |Y #1#11 [ 3999; ||lubricante;
               #21#17 = #21#17 + #1#8;
               #11#0 = #1#2;
               |LEE 000#11=;
               |SI FSalida ! 0 ; |DDEFECTO #11; |FINSI;
               tipo_iva = #11#30;
               |LIBERA #11;
          |FINSI;
          ||\\ EN FUNCION DEL TIPO DE IVA ACUMULAR EN BASE 1 O BASE 2
          enTiva = tipo_iva;
          efFiva = #21#2;
          |HAZ SacaIVA;

          |SI tipo_iva = 1;
               #21#7 = #21#7 + #1#8;
               #21#8 = tipo_iva;
               #21#9 = enIva;
          |SINO;
            |SI tipo_iva = 2;
               #21#26 = #21#26 + #1#8;
               #21#27 = tipo_iva;
               #21#28 = enIva;
            |SINO;  ||EXENTO
               #21#6 = #21#6 + #1#8;
            |FINSI;
          |FINSI;

          expor = "N";
          |SI #1#28 = -1;          ||Linea Canon
               #21#31 = #21#31 + #1#8;
          |FINSI;
     |FINSI;
     |SI #1#14 = "I";
          #21#25 = #21#25 + #1#8;
     |FINSI;
|FPRC;

|DEFBUCLE suma_fac;
     #1#1;
     ;
     #0#0 , #0#1 ,    1;
     #0#0 , #0#1 , 9999;
     ;
     NULL , sumaf;
|FIN;

|PROCESO calcula_fac;
     |HAZ EsTallerSC;
     nSwTallerSC = FSalida;

     |ABRE #63;
     |ABRE #66;
     |ABRE #11;
     |BUCLE suma_fac;
     #21#10 = (#21#7 % #21#9);
     #21#29 = (#21#26% #21#28);
     |CIERRA #63;
     |CIERRA #66;
     |CIERRA #11;
|FPRC;

|PROCESO pon_VNVO;
|SI #0#7 = "VO";
     |ABRE #80;
     |SELECT #2#80;
     #80#2 = #0#0;
     #80#3 = #0#1;
     |LEE 121#80=;
     |SI FSalida = 0;
          #80#4 = #20#11;
          |GRABA 021#80a;
     |FINSI;
     |LIBERA #80;
     |CIERRA #80;
|SINO;
|FINSI;
|FPRC;

|PROCESO crea_fra_standard;
     |ABRE #30;
     #30#0 = #0#11;
     |LEE 121#30=;

     |ABRE #55;
     |DDEFECTO #55;
     #55#14 = #21#0;
     #55#0 = #21#1;
     #55#1 = 1;
     #55#2 = #0#1;
     #55#15 = #0#0;
     |GRABA 001#55n;
     |LIBERA #55;
     |CIERRA #55;

     aMoneda = "B"
     aDivisa = "EUR";
     |HAZ Divisas134;

     |ABRE #56;
     |DDEFECTO #56;
     #56#49 = #21#0;
     #56#0 = #21#1;
     #56#1 = #21#2;
     #56#2 = #21#3;
     #56#3 = #21#4;
     #56#9 = #21#21;
     #56#10 = #21#22;
     #56#11 = #21#20;
     #56#12 = #30#16;  ||Cta contable
     #56#14 = #30#22;    ||DIAS FIJOS DE PAGO
     #56#15 = #30#23;
     #56#16 = #30#24;

     #56#18 = #21#7 + #21#26+ #21#6;    ||Bruto
     #56#65 = #56#18;
     #56#88 = #56#18;

     #56#21 = #21#7; ||Base1
     #56#68 = #56#21;
     #56#91 = #56#21;

     #56#22 = #21#10; ||Cuota1
     #56#69 = #56#22;
     #56#92 = #56#22;

     #56#24 = #21#26;||Base2
     #56#71 = #56#24;
     #56#94 = #56#24;

     #56#25 = #21#29; ||Cuota2
     #56#72 = #56#25;
     #56#95 = #56#25;

     #56#29 = #21#10 + #21#29; ||T.IVAS
     #56#76 = #56#29;
     #56#99 = #56#29;

     #56#31 = #21#11; ||T.FAC
     #56#78 = #56#31;
     #56#101 = #56#31;

     #56#39 = #21#9;  ||%iva
     #56#41 = #21#28; ||%iva
     #56#47 = #21#6;  ||Exe.

     #56#58 = "EUR";
     #56#59 = 1;
     #56#60 = "B";
     #56#61 = "EUR";
     #56#62 = "1";
     #56#45 = "S";
     #56#125 = #21#31;
     |GRABA 001#56c;
     |LIBERA #56;
     |HAZ VenciVta; |HAZ CreaRecibos;

     |CIERRA #56;
|FPRC;

|PROCESO ActuaArti;
     |ABRE #11;
     #11#0 = aArti;
     |LEE 101#11=;
     |SI FSalida = 0;
          #11#24 = fFecha;
          #11#25 = nUni;
          #11#95 = #11#95 + nImpo;
          #11#96 = #11#96 + nMargen;
          aAlfa = fFecha % 402;
          nCampo = ((N\aAlfa) - 1) * 5 + 35;
          #11nCampo = #11nCampo + nImpo;
          nCampo = nCampo + 1;
          #11nCampo = #11nCampo + nMargen;
          |GRABA 020#11a;
     |FINSI;
     |CIERRA #11;
|FPRC;

|PROCESO LlenaLiFacOR;
     aAlfa = "_" + #1#10;
     aAlfa = eaTParte - aAlfa;
     |SI eaTParte ! "TodoS"; |Y FSalida = 0;
          |ACABA;
     |FINSI;

     |DDEFECTO #696;
     #696#0 = #67#0;
     #696#1 = #67#1;
     #696#2 = #67#2;
     #696#3 = #1#0;
     #696#4 = #1#1;
     #696#5 = #1#11;
     #696#6 = #20#2;
     #696#7 = #0#2;
     |GRABA 020#696n;

     #1#35 = #67#0;
     #1#36 = #67#1;
     #1#37 = #20#2;
     #1#38 = "F";
     |GRABA 020#1a;
     |LIBERA #1;

     aArti = #1#2;
     nUni = #1#4;
     fFecha = #1#37;
     |SI #1#9 = 2; |O #1#9 = 4;
          |SI #1#14 = "G"; |O #1#14 = "S";
               nMargen = -#1#17;
               nImpo = 0;
          |SINO;
               nMargen = #1#8 - #1#17;
               nImpo = #1#8;
          |FINSI;
          |HAZ ActuaArti;
     |FINSI;
|FPRC;

|DEFBUCLE LlenaLiFacOR;
     #1#1;
     ;
     #0#0, #0#1, 0001;
     #0#0, #0#1, 9999;
     be;
     NULL, LlenaLiFacOR;
|FIN;

|PROCESO crea_factura;
|ABRE #20;
|ABRE #67;
|PARA i = 0 ; |SI i [ 22; |HACIENDO i = i + 1;
#20i = #21i;
|SIGUE;
#20#23 = #21#26;
#20#24 = #21#27;
#20#25 = #21#28;
#20#26 = #21#29;
#20#28 = #0#30; || Marca
#20#29 = #0#20; || Modelo
#20#30 = #21#31;  || Canon
|SI #0#7 = "VN";|O #0#7 = "VO";
     #20#11 = #20#11 + #21#25;
|FINSI;
#67#0 = #20#0;
#67#1 = #20#1;
#67#2 = 1;
#67#3 = #0#0;
#67#4 = #0#1;
#67#5 = #20#6 + #20#7 + #20#23;
#67#6 = #20#10 + #20#26;
#67#7 = #20#11;
#67#8 = #20#2;
#67#9 = #0#2;
|HAZ RedondeoTotales;
|GRABA 021#20n;
|GRABA 021#67n;
|LIBERA #20;
|LIBERA #67;
|CIERRA #20;
|CIERRA #67;
#0#16 = 1;
#0#17 = #20#2;
|GRABA 001#0a;
|ABRE #696;
|BUCLE LlenaLiFacOR;
|CIERRA #696;
|HAZ crea_fra_standard;
|SI #0#7 = "VN";|O #0#7 = "VO";
          |HAZ pon_VNVO;
|SINO;
     |SI #20#11 ! 0;
           |HAZ actua_cliente;
     |FINSI;
|FINSI;
|FPRC;

|PROCESO resta_contador;
|FPRC;

|PROCESO CambiaFecha;
     |SI #21Campo ! Contenido;
          #21#6 = 0;
          #21#7 = 0;
          #21#10 = 0;
          #21#11 = 0;
          #21#12 = 0;
          #21#16 = 0;
          #21#17 = 0;
          #21#18 = 0;
          #21#19 = 0;
          #21#25 = 0;
          #21#26 = 0;
          #21#27 = 0;
          #21#29 = 0;
          |HAZ calcula_fac;
          |PINDA #0#21;
     |FINSI;
|FPRC;

|PROCESO FacParcial;
     |SI #1#36 ! 0;
          |MENAV "0000O.R. parcialmente facturada...";
          nError = 1;
          |ERROR10;
     |FINSI;
|FPRC;

|DEFBUCLE FacParcial;
     #1#1;
     ;
     #0#0, #0#1, 0001;
     #0#0, #0#1, 9999;
     be;
     NULL, FacParcial;
|FIN;

|PROCESO factura;

     |SI nSwTallerSC = 0;
          nError = 0;
     |SINO;
          nError = 0;
          |BUCLE FacParcial;
          |SI nError = 1; |ACABA; |FINSI;
     |FINSI;

     |DDEFECTO #21;
     |HAZ pondatos;

     eaTParte = "TodoS";
     |SI nSwTallerSC = 0;
          enSwFactu = 3;
          |HAZ SelecTexto;
          enSwFactu = 0;
     |FINSI;

     |HAZ calcula_fac;
     |PUSHV 0101 2380;
     |CLS;
     |PINPA #0#21;
     |PINDA #0#21;

     |C_M #21#0, 1, "S";
     |C_M #21#1, 1, "S";
     |C_M #21#2, 1, "S";
     |ENDATOS #1#21;
     |SI FSalida = 0; |Y #21#24 = "SI";
          nError = 0;
          |ABRE #83; |LEE 000#83p; |CIERRA #83;
          |HAZ CheqSeccion;
          |SI nError ! 0;
               |SI nError = 1;
                  |MENAV "0000Secciones incluidas con empresas contables distintas (Ventas). Revise configuración de secciones";
               |FINSI;
               |SI nError = 2;
                  |MENAV "0000Secciones incluidas con empresas contables distintas (Costes). Revise configuración de secciones";
               |FINSI;
          |SINO;
               #0#40 = ~;
               |HORA aHora;
               aAlfa = aHora % 102; #0#43 = aAlfa;
               aAlfa = aHora % -102; #0#44 = aAlfa;
               |HAZ crea_factura;
               |CONFI "0000SDesea Imprimir Factura";
               |SI FSalida = 0;
                    eaSerie = #20#0;
                    eaNumero = #20#1;
                    |SUB_EJECUTA_NP "con01637";
               |FINSI;
          |FINSI;
     |SINO;
          |MENAV "0000Factura no creada";
          |HAZ resta_contador;
     |FINSI;
     |POPV;
     |HAZ Refresca;
|FPRC;


|PROCESO datosor;
     |PUSHV 0501 2380;
     |DDEFECTO #85;
     |ABRE #85;
     #85#0 = #0#0;
     #85#1 = #0#1;
     |LEE 101#85=;
     |SI FSalida ! 0; |GRABA 020#85b; |FINSI;
     #85#0 = #0#0;
     #85#1 = #0#1;
     |PINPA #0#85;
     |PINDA #0#85;
     |SI aSwModCab = "N";
          |PAUSA;
     |SINO;
          |ENDATOS #1#85;
          |SI FSalida = 0; |GRABA 101#85a; |FINSI;
     |FINSI;
     |CIERRA #85;
     |POPV;
|FPRC;

|PROCESO aparcar;
     |SI #0#40 = "01.01.0000";
          #0#40 = ~;
          |HORA aHora;
          aAlfa = aHora % 102; #0#43 = aAlfa;
          aAlfa = aHora % -102; #0#44 = aAlfa;
     |FINSI;
     #0#16 = 999999;
     nSwActCli = 1;
     aEstado = "A";
     |BUCLE PonEstado;
     nSwActCli = 0;
     |PINTA #0#16;
     |PINTA #0#40;
     |PINTA #0#43;
     |PINTA #0#44;
     |GRABA 001#0a;
     |LIBERA #0;
|FPRC;

|PROCESO clave;
    |HAZ pideclave;
    |SI alfa = "MOR ";
       |SI opcion = 1;
          |HAZ mano_obra;
       |SINO;
          |SI opcion = 2;
             |HAZ articulos;
          |SINO;
             |SI opcion = 3;
                  |HAZ ser_exter;
             |SINO;
                |SI opcion = 4;
                    |HAZ lubricant;
                |SINO;
                    |HAZ factura;
                |FINSI;
             |FINSI;
          |FINSI;
       |FINSI;
    |SINO;
       |MENAV "0000CLAVE INCORRECTA";
    |FINSI;
|FPRC;


|PROCESO tipo33; |TIPO 3;
     |SI nSwFlag = 1; |ACABA; |FINSI;

     serie_orden = #0#0;
     numero_orden = #0#1;
     |ABRE #85;
     #85#0 = #0#0;
     #85#1 = #0#1;
     |LEE 101#85=;
     |SI FSalida ! 0;
          |PUSHV 0501 2380;
          |DDEFECTO #85;
          #85#0 = #0#0;
          #85#1 = #0#1;
          |PINPA #0#85;
          |ENDATOS #1#85;
          |SI FSalida = 0;
               |GRABA 101#85n;
          |FINSI;
          |POPV;
     |FINSI;
     |LIBERA #85;
     |CIERRA #85;
     |SI correcto = 0;
          |DDEFECTO #2;
          correcto = 0;

          |MODULO aAlfa;
          |SI nPrime = 1; |O aAlfa ! "con00625";
               nPrime = 0;
               |PTEC 807;
          |FINSI;

          |HAZ lineal;
          nPosFin = 1;
          |PARA; |SI correcto = 0; |HACIENDO;
               |SI nPosFin = 1;
                    |HAZ BuscaUltPos;
                    |ENTLINEAL #1#1 , 3 , 7 , 22 , 0 ,  minFin , max;
                    nPosFin = 0;
               |FINSI;
               |SI opcion < 0;
                                       || con AvPag en el menu se generaba un -14
                    opcion = 0; ||/y al volver con ese valor el |MENU petaba
               |FINSI;
               menu2 = opcion;
               |MENU menu;
               opcion = FSalida;
               salida = FSalida;
               aSwFactu = "N";
               |BUCLE MiraFactu;
               FSalida = 0;
               |SI aSwFactu = "S";
                    |SI opcion = 1; |O opcion = 2; |O opcion = 3; |O opcion = 4;
                              |O opcion = 8; |O opcion = 12;
                         |MENAV "0000O.R. facturada, no se puede modificar...";
                         FSalida = 1;
                    |FINSI;
               |FINSI;
               |SI FSalida = 0;
                    |SI opcion = 1;
                         |SI #0#16 = 0;
                             nPosFin = 1;
                             |HAZ mano_obra;
                         |SINO;
                              |MENAV "0000O.R. Ya cerrada. No admite modificaciones";
                              |HAZ clave;
                         |FINSI;
                    |FINSI;
                    |SI opcion = 2;
                         |SI #0#16 = 0;
                              nPosFin = 1;
                              |HAZ articulos;
                         |SINO;
                              |MENAV "0000O.R. Ya cerrada. No admite modificaciones";
                              |HAZ clave;
                         |FINSI;
                    |FINSI;
                    |SI opcion = 3;
                         |SI #0#16 = 0;
                              nPosFin = 1;
                              |HAZ ser_exter;
                         |SINO;
                              |MENAV "0000O.R. Ya cerrada. No admite modificaciones";
                              |HAZ clave;
                         |FINSI;
                    |FINSI;
                    |SI opcion = 4;
                         |SI #0#16 = 0;
                              nPosFin = 1;
                              |HAZ lubricant;
                         |SINO;
                              |MENAV "0000O.R. Ya cerrada. No admite modificaciones";
                              |HAZ clave;
                         |FINSI;
                    |FINSI;
                    |SI opcion = 5; |HAZ lineal; |FINSI;
                    |SI opcion = 6;
                        correcto = 1;
                        |HAZ suma_tot;
                    |SINO;
                        correcto = 1;
                        |HAZ suma_tot;
                         correcto = 0;
                    |FINSI;
                    |SI opcion = 7; |HAZ suma_tot; |FINSI;
                    |SI opcion = 8;
                         |SI PARAMETRO ! "";
                              |MENAV "0000Opcion no permitida...";
                         |SINO;
                              correcto = 1;
                              |HAZ suma_tot;
                              |HAZ MiraRecibos;
                              |SI enErrCarte = 0;
                                   |SI #0#16 = 0;
                                        |HAZ factura;
                                        correcto = 1;
                                   |SINO;
                                        |MENAV "0000O.R. Ya cerrada. No admite modificaciones";
                                        |HAZ clave;
                                   |FINSI;
                              |FINSI;
                         |FINSI;
                    |FINSI;
                    |SI opcion = 9; |HAZ datosor; |FINSI;
                    |SI opcion = 10; |HAZ texto_reparacion; |FINSI;
                    |SI opcion = 11;
                         correcto = 1;
                         |HAZ suma_tot;
                         correcto = 0;
                         |HAZ imp_parte;
                    |FINSI;
                    |SI opcion = 12;
                         |SI #0#16 = 0;
                              |HAZ aparcar;
                              correcto = 1;
                         |SINO;
                              |MENAV "0000O.R. Ya cerrada. No admite modificaciones";
                              |HAZ clave;
                         |FINSI;
                    |FINSI;
               |FINSI;
          |SIGUE;
     |FINSI;
     correcto = 0;

     |ABRE #65;
     |SELECT #2#65;
     #65#2 = #0#0;
     #65#3 = #0#1;
     |LEE 140#65=; || bloqueo sin error
     |SI FSalida = 0;
          #65#4 = #0#28;
          |GRABA 021#65a;
     |FINSI;
     |LIBERA #65;
     |CIERRA #65;
|FPRC;

|PROCESO Cli6; |TIPO 6;
     |DDEFECTO #agifa024;
     |ABRE #agifa024;
     #agifa024#0 = #0#11;
     |LEE 000#agifa024.=;
     |CIERRA #agifa024;
     |SI #0#11 ! Contenido;
          #0#19 = #agifa024#1;
          |PINTA #0#19;
     |FINSI;
|FPRC;

|PROCESO observaciones; |TIPO 0;
     |ABRE #534; |LEE 000#534p; |CIERRA #534;

     |ABRE #agifa024;
     #agifa024#0 = #0#11;
     |LEE 000#agifa024.=;
     |SI FSalida ! 0;
        |MENAV "    El cliente no existe"; |CIERRA #agifa024; |ERROR; |ACABA;
     |FINSI;
     |CIERRA #agifa024;

     puente = #agifa024#53;     |QBF puente;
     |SI puente ! "";
          |PUSHV 0501 2380;
          |BLANCO 1008 1370;
          |CUADRO 1008 1370;
          |ATRI R;
          |PINTA 1110 , #agifa024#53;
          |ATRI 0;
          |PAUSA;
          |POPV;
     |FINSI;

     ||ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ Control Riesgo Cliente.
     nMasRies = 0;
     eaCodCliente = #0#11;
     eaNomCliente = #0#19;
     eaTag = "";  |HAZ SacaRiesgo;
     |SI #agifa142#6 = "S"; |Y eaExisteCliRie = "S";
          eaDocu = "C";
          eaTipo = "A";
          |HAZ CalculaTotal
          enImpoDoc = enTotal;
          eaMuestra = "S";
          |HAZ ControlRiesgo;
          |SI enErrRie ! 0; |ERROR; |ACABA; |FINSI;
          |SI enAudito = 0;
               |ABRE #143;
               |LEE 000#143u;
               |SI FSalida = 0;
                    nConAu = #143#0 + 1;
               |SINO;
                    nConAu = 1;
               |FINSI;
               |DDEFECTO #143;
               #143#0 = nConAu;
               #143#12 = "ORDEN";
               #143#1 = #0#0;
               #143#2 = #0#1;
               #143#3 = #0#2;
               #143#4 = #0#11;
               #143#5 = #0#19;
               #143#6 = Usuario % 810;
               #143#7 = #141#0;
               #143#8 = #141#1;
               #143#9 = #141#2;
               #143#10 = #141#3;
               #143#11 = #141#4;
               |GRABA 020#143n;
               |CIERRA #143;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO CreaRecibos;
     |ABRE #agifa133;
     |ABRE #agis0002;
     |ABRE #agifa177;
     |ABRE #agifa024;
     |ABRE #agifa091;
     |ABRE #agifa142;

     |LEE 000#agifa142.p;
     |SI FSalida ! 0; |DDEFECTO #agifa142; |FINSI;

     #agifa024#0 = #agifa134#2;
     |LEE 000#agifa024.=;
     |SI FSalida ! 0; |DDEFECTO #agifa024; |FINSI;

     #agifa091#0 = #agifa134#11;
     |LEE 000#agifa091.=;
     |SI FSalida ! 0; |DDEFECTO #agifa091; |FINSI;

     nVto = 0;
     #agifa133#0 = #agifa134#0;
     #agifa133#4 = #agifa134#49;
     #agifa133#1 = 0;
     |LEE 000#agifa133.];
     |PARA ; |SI FSalida = 0; |Y #agifa133#0 = #agifa134#0;|Y #agifa133#4 = #agifa134#49; |HACIENDO;
          nVto = nVto + 1;
          |LEE 000#agifa133.s;
     |SIGUE;

     |HAZ AbreRecVenta;

     #agifa133#0 = #agifa134#0;
     #agifa133#4 = #agifa134#49;
     #agifa133#1 = 0;
     |LEE 000#agifa133.];
     |PARA ; |SI FSalida = 0; |Y #agifa133#0 = #agifa134#0;|Y #agifa133#4 = #agifa134#49; |HACIENDO;
          |SI #agifa133#5 = "S";
               |DDEFECTO #agis0002;
               #agis0002#30 = "A";       || busca como albaran
               #agis0002#20 = #agifa133#6;     || Serie pedido.
               #agis0002#17 = #agifa133#7;     || Numero pedido.
               #agis0002#18 = #agifa133#8;     || Numero recibo.
               |LEE 000#agis0002.=;
               |SI FSalida ! 0;
                    #agis0002#30 = "P";       || busca como pedido
                    |LEE 000#agis0002.=;
               |FINSI;
          |FINSI;
          |DDEFECTO #dsz99984;
          #dsz99984#17 = #agifa134#49;
          #dsz99984#0 = #agifa134#0;
          #dsz99984#1 = #agifa133#1;           || Linea;
          #dsz99984#2 = #agifa134#2;           || cliente
          #dsz99984#3 = #agifa134#3;           || nombre del cliente
          #dsz99984#4 = #agifa134#9;           || Banco
          #dsz99984#5 = "S";                   || domiciliado
          #dsz99984#6 = "N";                   || aceptado
          #dsz99984#7 = #agifa134#1;           || fecha de emision
          #dsz99984#8 = #agifa133#3;           || Fecha de vencimiento
          #dsz99984#9 = #agifa133#2;           || Importe
          |SI #agifa133#5 = "S";
               #dsz99984#10 = #agis0002#10;
               #dsz99984#11 = #agis0002#11;
          |SINO;
               #dsz99984#10 = "N";            || Impreso
               #dsz99984#11 = "N";            || Contabilizado
          |FINSI;
          |SI #agifa142#63 = "S";     ||  COGE LA CTA.CONTABLE DEL TIPO DE RECIBO.
               #agifa177#0 = #agifa091#69;
               |LEE 000#agifa177.=;
               |SI FSalida = 0;
                    #dsz99984#12 = #agifa177#3;     || NUMERO CTA.CONTABLE.
               |SINO;
                    #dsz99984#12 = #agifa134#12;     || NUMERO CTA.CONTABLE.
               |FINSI;
          |SINO;
               #dsz99984#12 = #agifa134#12;     || NUMERO CTA.CONTABLE.
          |FINSI;
          #dsz99984#13 = #agis0002#13;
          #dsz99984#16 = #agis0002#16;
          #dsz99984#22 = "Cobrado";
          #dsz99984#24 = #agifa134#11;          || Forma de Pago
          #dsz99984#25 = #agifa091#1;           || Descripcion de la forma de Pago
          #dsz99984#14 = "N";            || Impagado
          #dsz99984#15 = #agifa024#161;         || A aceptar
          |SI #agifa133#5 = "S";
               #dsz99984#21 = #agis0002#22;         || Tipo de Recibo (entr.a cta.)
          |SINO;
               #dsz99984#21 = #agifa091#69;          || Tipo de Recibo (forma de pago)
          |FINSI;
          #dsz99984#23 = nVto;
          #dsz99984#24 = #agifa091#0;
          #dsz99984#25 = #agifa091#1;
          eaProg = "agifa134";
          |HAZ RecVenta;
          |LEE 000#agifa133.s;
     |SIGUE;
     |HAZ CierraRecVenta;

     #agifa133#0 = #agifa134#0;
     #agifa133#4 = #agifa134#49;
     #agifa133#1 = 0;
     |LEE 101#agifa133.];
     |PARA ; |SI FSalida = 0; |Y #agifa133#0 = #agifa134#0;|Y #agifa133#4 = #agifa134#49; |HACIENDO;
          #dsz99984#17 = #agifa133#4;
          #dsz99984#0 = #agifa133#0;
          #dsz99984#1 = #agifa133#1;
          eaProg = "agifa134";
          |HAZ LeeRecVenta;
          #agifa134#32 = #agifa134#32 + enAcuenta;
          #agifa133#2 = #agifa133#2 - enAcuenta;
          |GRABA 020#agifa133.a;
          |LIBERA #agifa133;
          |LEE 101#agifa133.s;
     |SIGUE;
     |LIBERA #agifa133;

     |CIERRA #agifa091;
     |CIERRA #agifa024;
     |CIERRA #dsz99984;
     |CIERRA #agifa133;
     |CIERRA #agis0002;
     |CIERRA #agifa177;
|FPRC;
/*
|PROCESO Clave;          ||*** ANULADO ***
FSalida = 0;
|ACABA;
     |AVISO;
     |BLIN 24;
     |ATRI I;
     |PINTA 2420, "Entre la Clave...:";
     |ATRI 0;
     E_sup = 10;
     E_inf = "";
     aAlfa = "";
     aAlfa = 2439 ? -1;
     |BLIN 24;
     aAlfa = aAlfa > ""; |QBF aAlfa;
     FSalida = 0;
     |SI aAlfa ! "NUEVASEC";
          |MENAV "0000ERROR. Clave incorrecta";
          FSalida = 1;
          |ERROR;
     |FINSI;
|FPRC;
*/

|PROCESO ClaveSec628; |TIPO 0;
     |SI #3Campo ! nSec;
     |FINSI;
|FPRC;

|PROCESO ClaveSec629; |TIPO 0;
     |SI #4Campo ! nSec;
     |FINSI;
|FPRC;

|PROCESO ClaveSec630; |TIPO 0;
     |SI #5Campo ! nSec;
     |FINSI;
|FPRC;

|PROCESO ClaveSec631; |TIPO 0;
     |SI #6Campo ! nSec;
     |FINSI;
|FPRC;

|PROCESO CogeSec628; |TIPO 7;
     nSec = #3Campo;
|FPRC;

|PROCESO CogeSec629; |TIPO 7;
     nSec = #4Campo;
|FPRC;

|PROCESO CogeSec630; |TIPO 7;
     nSec = #5Campo;
|FPRC;

|PROCESO CogeSec631; |TIPO 7;
     nSec = #6Campo;
|FPRC;

|PROCESO TeclaOculta; |TIPO 6;
     |SI aAlfa = "*"; ||uso para d ebug
          |ABRE #con00633;
          #con00633#0=#0Campo;
          |GRABA 020#con00633.n;
          |CIERRA #con00633;
     |FINSI;
|FPRC;

|PROCESO BuscaUltPos;
     nPosLin = #1#11;
     |ABRE #1;
     #1#0 = #0#0;
     #1#1 = #0#1;
     #1#11 = nPosLin;
     |LEE 000#1=;
     |SI FSalida = 0; |Y #1#0 = #0#0; |Y #1#1 = #0#1;
          |PARA i = 1; |SI i [ 10; |HACIENDO i = i + 1;
               |LEE 000#1a; || Y le resta las lineas de pantalla
               |SI #1#0 ! #0#0; |O #1#1 ! #0#1; |SAL; |FINSI;
               nPosLin = #1#11;
          |SIGUE;
     |SINO;
          nPosLin = 0;
     |FINSI;
     |CIERRA #1;
|FPRC;

|PROCESO ModificaOrden;
     |HAZ pideclave;
     |SI alfa = "MOR ";
          |LIBERA #0;
          |CIERRAT #0;
          eaSerie = #0#0;     || copia del con00625, solo modifica
          eaDocu = #0#1;
          |SUB_EJECUTA_NP "con00902";
          |ABRET #0;
          |LEE 121#0=;
          |PINDA #0#0;
     |FINSI;
|FPRC;

|PROCESO MiraRecibos;
     |SI #0#16 ! 0; |Y #0#16 ! 999999;
          |MENAV "0000Esta facturado";
          |ABRE #56;
          #56#49 = #0#15;
          #56#0 = #0#16;
          |LEE 000#56=;
          |CIERRA #56;
          eaProg = "agifa134"; |HAZ MiraRecVenta;
          |SI enErrCarte ! 0;
               |SI nSwModiOrden = 1;
                    |CONFI "0000NModificar O.R.";
                    |SI FSalida = 0; |HAZ ModificaOrden; |FINSI;
               |SINO;
                    aAlfa = "0000Recibos con movimientos, NO SE DARA DE BAJA... [" + enErrCarte + "]";
                    |MENAV aAlfa;
               |FINSI;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO RiesgoLin;
     |||SI FSalida ! 0; |ACABA; |FINSI;
     |SALVA_FICHA #1;
     enTotal = 0;
     |HAZ CalculaTotal0;
     |HAZ CalculaTotal;
     enErrRie = 0;
     eaCodCliente = #0#11;
     eaNomCliente = #0#19;
     eaTag = "";  |HAZ SacaRiesgo;
     |SI eaRieSuma = "S"; nRieUtili = nRieUtili + enTotal; |FINSI;
     |SI #agifa142#6 = "S";
          eaDocu = "L";
          eaTipo = "A";
          enImpoDoc = 0;
          |HAZ ControlRiesgo;
          |SI enErrRie = 1; |REPON_FICHA #1; FSalida = 1; |ACABA; |FINSI;
          |SI enAudito = 0;
               |ABRE #143;
               |LEE 000#143u;
               |SI FSalida = 0;
                    nConAu = #143#0 + 1;
               |SINO;
                    nConAu = 1;
               |FINSI;
               |DDEFECTO #143;
               #143#0 = nConAu;          || contador
               #143#12 = "ORDEN";      || tipo documento
               #143#1 = #0#0;           || serie
               #143#2 = #0#1;            || documento
               #143#3 = #0#2;            || fecha
               #143#4 = #0#11;           || cliente
               #143#5 = #0#19;           || nombre
               #143#6 = aUs;             || usuario
               #143#7 = nRieTotal;       || riesto concedido
               #143#8 = nRieUtili;       || riesgo actual
               #143#9 = #141#2;           || % exceso
               #143#10= #141#3;           || importe % exceso
               #143#11= #141#4;           || limite exceso
               |GRABA 020#143n;
               |CIERRA #143;
          |FINSI;
     |FINSI;
     |REPON_FICHA #1;
     FSalida = 0;
|FPRC;

|PROCESO Fcierre; |TIPO 7;
     |SI #0#40 = "01.01.0000"; |O aSwModCab = "N";
          |C_M #0#40, 1, "N";
          |C_M #0#43, 1, "N";
          |C_M #0#44, 1, "N";
     |SINO;
          |C_M #0#40, 1, "S";
          |C_M #0#43, 1, "S";
          |C_M #0#44, 1, "S";
     |FINSI;
|FPRC;

|PROCESO Matri625; |TIPO 0;
     nTecla = FSalida;
     |ABRE #con00007;
     #con00007#0 = #0Campo;
     #con00007#1 = 1;
     |LEE 000#con00007.];
     |SI FSalida = 0; |Y #con00007#0 = #0Campo; |O nTecla = 11;
          eaMatricula = #0Campo;
          |SUB_EJECUTA_NP "con00007";
     |FINSI;
     |CIERRA #con00007;

     nModo = (FEntrada / 100) ! 0; nSwCambia = 0;
     |SI #con00625#3 ! Contenido; nSwCambia = 1; |FINSI;
     |SI nModo = 1;
        |SI #con00625#11 = "      "; |O #con00625#11 = "000000"; nSwCambia = 1; |FINSI;
        |HAZ PonHora;
     |FINSI;

     |SI nSwCambia = 1;  ||*
        |ABRE #con00601;
        #con00601#0 = #con00625#3;
        |LEE 000#con00601.=;
        |SI FSalida = 0;
           #con00625#11 = #con00601#1; |PINTA #con00625#11;
           |ABRE #agifa024;
           #agifa024#0 = #con00625#11;
           |LEE 000#agifa024.=;
           |CIERRA #agifa024;
           #con00625#19 = #agifa024#1; |PINTA #con00625#19;
        |FINSI;
        |CIERRA #con00601;
     |FINSI;
|FPRC;

|PROCESO AvisaKm; |TIPO 0;
     nModo = (FEntrada / 100) ! 0;
     aAlfa = #0#3; |QBF aAlfa;
     |SI nModo = 1; |Y aAlfa ! "";
          |ABRE #601;
          #601#0 = #0#3;
          |LEE 020#601=;
          |SI FSalida = 0; |Y #601#12 > #0#5;
               aAlfa = "0000Los km. introducidos no son correctos con respecto a la O.R. anterior:"+ #601#12;
               |MENAV aAlfa;
          |FINSI;
          |CIERRA #601;
     |FINSI;
|FPRC;

|PROCESO CheqSecLin;
     |DDEFECTO #800;
     #800#5 = #1#0;
     #800#6 = #1#9;
     #800#0 = #1#23;
     |LEE 000#800=;

     |SI nEmpresa = -1; nEmpresa = #800#3; |FINSI;

     |SI nEmpresa ! #800#3; |ERROR10; nError = 1; |FINSI;
|FPRC;

|DEFBUCLE CheqSecLin;
     #1#1;
     ;
     #0#0, #0#1, 0001;
     #0#0, #0#1, 9999;
     ;
     NULL, CheqSecLin;
|FIN;

|PROCESO CheqSeccion;
     |ABRE #con00703;
     #703#0 = #0#0;
     #703#1 = #0#1;
     |LEE 000#703=;
     |SI FSalida ! 0; |DDEFECTO #703; |FINSI;

     |ABRE #800;
     |DDEFECTO #800;
     #800#5 = #0#0;
     #800#6 = 0;
     #800#0 = #703#2;
     |LEE 000#800=;
     |SI #0#0 = #83#11; |O #0#0 = #83#12; |O #0#0 = #83#13;
               |O #0#0 = #83#17; |O #0#0 = #83#18; |O #0#0 = #83#19;
               |O #0#0 = #83#21; |O #0#0 = #83#22; |O #0#0 = #83#23;
               |O #0#0 = #83#24; |O #0#0 = #83#25; |O #0#0 = #83#26;
               |O #0#0 = #83#27; |O #0#0 = #83#28; |O #0#0 = #83#29;
               |O #0#0 = #83#30; |O #0#0 = #83#31; |O #0#0 = #83#32;
               |O #0#0 = #83#33; |O #0#0 = #83#34; |O #0#0 = #83#35;
           nEmpresa = #800#3;
     |SINO;
          nEmpresa = -1;
     |FINSI;
     |BUCLE CheqSecLin;
     |CIERRA #800;
     |CIERRA #con00703;
|FPRC;

-------------------------------------
|PROCESO CanonArticulo;
     nSeccion = #1#23;

     |DDEFECTO #11;
     |ABRE #11;
     #11#0 = #1#2;
     |LEE 020#11=;
     |CIERRA #11;

     nLin = 0;
     |SI #11#168 = 0; |ACABA; |FINSI;

     #1#0 = #0#0;
     #1#1 = #0#1;
     #1#11 = 5999;
     |LEE 000#1];
     |SI FSalida ! 0;
           |LEE 001#1u;
     |SINO;
          |LEE 001#1a;
     |FINSI;
     |SI FSalida = 0; |Y #1#0 = #0#0; |Y #1#1 = #0#1;
               |Y #1#11 ] 4999; |Y #1#11 [ 5999;
          nLin = #1#11 + 1;
     |SINO;
          nLin = 5000;
     |FINSI;
     |DDEFECTO #1;
     #1#0 = #0#0;
     #1#1 = #0#1;
     #1#11 = nLin;

     #1#2 = "xxxxx";
     #1#3 = "CANON " + #5#1;
     #1#4 = #5#2;
     #1#5 = #11#168;
     #1#6 = 0;
     #1#7 = 0;
     #1#8 = #1#4  * #1#5;
     #1#9 = 5;
     #1#10 = #5#8
     #1#14 = #5#11;
     #1#23 = nSeccion;
     #1#28 = -1;
     #1#29 = #11#30;
     |GRABA 020#1n;
     |HAZ alta_histo;
     enLinCanon = #1#11;
|FPRC;

|PROCESO CanonLubri;
     nSeccion = #1#23;

     |DDEFECTO #11;
     |ABRE #11;
     #11#0 = #1#2;
     |LEE 020#11=;
     |CIERRA #11;

     nLin = 0;
     |SI #11#168 = 0; |ACABA; |FINSI;

     #1#0 = #0#0;
     #1#1 = #0#1;
     #1#11 = 5999;
     |LEE 000#1];
     |SI FSalida ! 0;
           |LEE 001#1u;
     |SINO;
          |LEE 001#1a;
     |FINSI;
     |SI FSalida = 0; |Y #1#0 = #0#0; |Y #1#1 = #0#1;
               |Y #1#11 ] 4999; |Y #1#11 [ 5999;
          nLin = #1#11 + 1;
     |SINO;
          nLin = 5000;
     |FINSI;
     |DDEFECTO #1;
     #1#0 = #0#0;
     #1#1 = #0#1;
     #1#11 = nLin;

     #1#2 = "xxxxx";
     #1#3 = "CANON " + #6#1;
     #1#4 = #6#2;
     #1#5 = #11#168;
     #1#6 = 0;
     #1#7 = 0;
     #1#8 = #1#4  * #1#5;
     #1#9 = 5;
     #1#10 = #6#8
     #1#14 = #6#11;
     #1#23 = nSeccion;
     #1#28 = -1;
     #1#29 = #11#30;
     |GRABA 020#1n;
     |HAZ alta_histo;
     enLinCanon = #1#11;
|FPRC;

|PROCESO PonHora;
     |SI #con00625#41 = 0; |Y #con00625#42 = 0;
          |HORA aHora;
          |QBF aHora;
          aNumHora = aHora % 102;
          aNumMin = aHora % 402;
          #con00625#41 = aNumHora;
          #con00625#42 = aNumMin;
          |PINTA #con00625#41;
          |PINTA #con00625#42;
     |FINSI;
|FPRC;

|PROCESO RedondeoTotales;
     #con00637#6 = #con00637#6 ! #con00691#9;
     #con00637#7 = #con00637#7 ! #con00691#9;
     #con00637#10 = #con00637#10 ! #con00691#9;
     #con00637#23 = #con00637#23 ! #con00691#9;
     #con00637#26 = #con00637#26 ! #con00691#9;
     #con00637#30 = #con00637#30 ! #con00691#9;
     #con00637#31 = #con00637#31 ! #con00691#9;
     #con00637#32 = #con00637#32 ! #con00691#9;
     #con00637#34 = #con00637#34 ! #con00691#9;
     #con00637#37 = #con00637#37 ! #con00691#9;
     #con00637#35 = #con00637#35 ! #con00691#9;
     #con00637#38 = #con00637#38 ! #con00691#9;

     #con00637#11 = #con00637#6 + #con00637#7 + #con00637#23 + #con00637#31 + #con00637#34 + #con00637#37;
     #con00637#11 = #con00637#11 + #con00637#10 + #con00637#26 + #con00637#32 + #con00637#35 + #con00637#38;
     #con00637#11 = #con00637#11 ! #con00691#9;
|FPRC;
