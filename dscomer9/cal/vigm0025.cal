|FICHEROS;
     vigm0025 #0;
     vigm0026 #1;
     vigm0027 #27;
     vigm0040 #40;
     agifa073 #73;
     agifa104 #104;
     vigw0021 #21,MANTE;
     vigw0022 #22,MANTE;
     referen@;
|FIN;

|VARIABLES;
     nLin = 0;
     aSerAnt = "";
     nNumAnt = 0;
     &enViaje = 0;
     &Tempo = "";
     nForma = 0;
     nConta = 0;
     nModo = 0;
     aAlfa = "";
     nHay = 0;
     aSerie = "";
     nPedido = 0;
     nMarca = 0;
     nUni = 0;
     aTmp21 = "";
     aTmp22 = "";
|FIN;

|PROCESO Conta; |TIPO 7;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 1;
          |LEE 000#0u;
          |SI FSalida = 0;
               nConta = #0#0 + 1;
          |SINO;
               nConta = 1;
          |FINSI;
          |DDEFECTO #0;
          #0#0 = nConta;
     |FINSI;
|FPRC;

|PROCESO LinPed;
     #1#8 = #1#8 + #73#5;
|FPRC;

|PROCESO CheqPed; |TIPO 0;
     |ABRE #27;
     #27#0 = #1#2;
     #27#1 = #1#3;
     |LEE 000#27=;
     |SI FSalida = 0; |Y #27#2 = "S";
          aAlfa = "0000Pedido con viaje realizado. Viaje:" + #27#3;
          |MENAV aAlfa;
          |ERROR;
     |FINSI;
     |CIERRA #27;

     |ABRE #104;
     #104#25 = #1#2;
     #104#0 = #1#3;
     |LEE 000#104=;
     |SI FSalida ! 0;
          |MENAV "0000No existe Pedido";
          |ERROR; |ACABA;
     |SINO;
          |SI nModo = 1; |Y #1#8 = 0;
               |BUCLELIN 2LinPed#104;
          |FINSI;
          |SI aSerAnt ! #1#2; |O nNumAnt ! #1#3;
               #1#8 = 0;
               |BUCLELIN 2LinPed#104;
          |FINSI;
     |FINSI;
     |CIERRA #104;
     |PINTA #1#8;
|FPRC;

|PROCESO Coge7; |TIPO 7;
     aSerAnt = #1#2;
     nNumAnt = #1#3;
|FPRC;

|PROCESO ActViaje; |TIPO 2;
     nForma = 0 +. 1;
     |ABRE #104;
     #104#25 = #1#2;
     #104#0 = #1#3;
     |LEE 020#104=;
     |CIERRA #104;

     |DDEFECTO #27;
     |ABRE #27;
     #27#0 = #104#25;
     #27#1 = #104#0;
     |LEE 101#27=;
     |SI FSalida ! 0; |GRABA 020#27b; |FINSI;
     |SI nForma = 1;
          #27#2 = "S";
          #27#3 = #0#0;
          #27#4 = #0#1;
     |SINO;
          #27#2 = "N";
          #27#3 = 0;
          #27#4 = "01.01.0000";
     |FINSI;
     #27#5 = #104#4;
     |GRABA 020#27a;
     |CIERRA #27;

     #0#6 = #0#6 +. #1#8;
     |PINTA #0#6;
|FPRC;

|PROCESO Tipo4; |TIPO 4;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo ! 4; |GRABA 000#0a; |FINSI;
     |CIERRAT #0;
     enViaje = #0#0;
     |SUB_EJECUTA_NP "vigz0034";
     |ABRET #0;
     |LEE 000#0=;
|FPRC;

|PROCESO Tipo3; |TIPO 3;
     |CONFI "0000NImprimir asignacion?";
     |SI FSalida = 0;
          |HAZ Tipo4;
     |FINSI;
|FPRC;

|PROCESO Tipo5; |TIPO 5;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo ! 1; |ACABA; |FINSI;

     |HAZ EligePedidos;
|FPRC;

|PROCESO Tipo26_11; |TIPO 11;
     |SI FSalida = 13;
          |HAZ EligePedidos;
          ||ERROR;
          ||PTEC 801;
          |PTEC 816;
     |FINSI;
|FPRC;
--------------------------------
|PROCESO Min22;
     #22#5 = #21#0;
     #22#6 = #21#1;
     #22#0 = 1;
|FPRC;

|PROCESO Max22;
     #22#5 = #21#0;
     #22#6 = #21#1;
     #22#0 = 999;
|FPRC;

|PROCESO Min21;
     #21#0 = "     ";
     #21#1 = 000001;
|FPRC;

|PROCESO Max21;
     #21#0 = "zzzzz";
     #21#1 = 999999;
|FPRC;

|PROCESO Tecla21; |TIPO 0;
     |SI #21Campo = Contenido; |Y FSalida = 0;
          |SI #21#7 = "*";
               #21#7 = "";
               #0#6 = #0#6 - #21#5;
          |SINO;
               #21#7 = "*";
               #0#6 = #0#6 + #21#5;
          |FINSI;
          |GRABA 020#21a;
          |PINTA #21#7;
          |PINTA 570, #0#6;
     |FINSI;
|FPRC;

|PROCESO Tipo21_11; |TIPO 11;
     |SI FSalida = 13;
          |ENTLINEAL #1#22, 3, 4, 22, 0, Min22, Max22;
          |ERROR;
     |FINSI;
|FPRC;

|PROCESO LinPedido;
     |DDEFECTO #40;
     #40#0 = #73#28;
     #40#1 = #73#0;
     #40#2 = #73#1;
     |LEE 000#40=;

     |DDEFECTO #22;
     #22#5 = #73#28;
     #22#6 = #73#0;
     #22#0 = #73#1;
     #22#1 = #73#2;
     #22#2 = #73#4;
     #22#3 = #73#5;
     #22#7 = #40#3;
     |GRABA 020#22n;
     #21#5 = #21#5 + #73#5;
|FPRC;

|PROCESO Pedidos;
     #27#0 = #104#25;
     #27#1 = #104#0;
     |LEE 000#27=;
     |SI FSalida = 0; |Y #27#2 = "S"; |ACABA; |FINSI;

     |DDEFECTO #21;
     #21#0 = #104#25;
     #21#1 = #104#0;
     #21#2 = #104#1;
     #21#3 = #104#4;
     #21#4 = #104#8;
     #21#6 = #104#20;
     |BUCLELIN 2LinPedido#104;
     |GRABA 020#21n;
     nHay = 1;
|FPRC;

|DEFBUCLE Pedidos;
     #104#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Pedidos;
|FIN;

|PROCESO Tipo21_13; |TIPO 13;
     |ENTLINEAL #1#22, 3, 7, 22, 0, Min22, Max22;
|FPRC;

|PROCESO CargaLin;
     |SI #21#7 ! "*";
          |ACABA;
     |FINSI;
     #referen@#0 = #0#0;
     #referen@#1 = 999;
     |LEE 000#referen@.];
     |SI FSalida = 0;
          |LEE 000#referen@.a;
     |SINO;
          |LEE 000#referen@.u;
     |FINSI;
     |SI #referen@#0 = #0#0; |Y FSalida = 0;
          nLin = #referen@#1 + 1;
     |SINO;
          nLin = 1;
     |FINSI;
     |DDEFECTO #referen@;
     #referen@#0 = #0#0;
     #referen@#1 = nLin;
     #referen@#2 = #21#0;
     #referen@#3 = #21#1;
     #referen@#4 = #21#2;
     #referen@#5 = #21#3;
     #referen@#6 = #21#4;
     #referen@#7 = #21#6
     #referen@#8 = #21#5;
     |GRABA 020#referen@.n;

     |DDEFECTO #27;
     #27#0 = #21#0;
     #27#1 = #21#1;
     |LEE 101#27=;
     |SI FSalida ! 0; |GRABA 020#27b; |FINSI;
     #27#2 = "S";
     #27#3 = #0#0;
     #27#4 = #0#1;
     #27#5 = #21#3;
     |GRABA 020#27a;
     |LIBERA #27;
|FPRC;

|DEFBUCLE CargaLin;
     #21#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, CargaLin;
|FIN;

|PROCESO CuentaUni;
     #0#6 = #0#6 + #referen@#8;
|FPRC;

|DEFBUCLE CuentaUni;
     #referen@#1002;
     ;
     #0#0, 001;
     #0#0, 999;
     ;
     NULL, CuentaUni;
|FIN;

|PROCESO EligePedidos;
     |HAZ CreaTempo; |NOME_DAT #21 Tempo; |DELINDEX #21; aTmp21 = Tempo;
     |HAZ CreaTempo; |NOME_DAT #22 Tempo; |DELINDEX #22; aTmp22 = Tempo;
     |ABRE #21;
     |ABRE #22;
     |ABRE #27;
     |ABRE #40;
     |BUCLE Pedidos;
     |CIERRA #40;
     |CIERRA #27;
     |CIERRA #21;
     |CIERRA #22;
     |SI nHay ! 0;
          nPedido = 0;
          |PUSHV 0501 2380;
          |PINPA #0#21;
          |PINTA 570, #0#6;
          |ENTLINEAL #1#21, 1, 4, 14, 0, Min21, Max21;
          |POPV;

          |DDEF aAlfa;
          aAlfa = aAlfa + "vigm0026";
          |CARGA_DEF aAlfa, referen@;
          |SI FSalida = 0;
               |ABRE #referen@;
               |ABRE #27;
               |BUCLE CargaLin;
               |CIERRA #27;
               |CIERRA #referen@;
               #0#6 = 0;
               |BUCLE CuentaUni;
               |DESCARGA_DEF #referen@;
               |PINTA #0#6;
               |PTEC 816;
               |PTEC 808;
               |PONCONTROL 23, "SI";
          |FINSI;
     |SINO;
          |MENAV "0000No hay pedidos a asignar";
          |ERROR;
     |FINSI;
     Tempo = aTmp21; |HAZ BoraTempo; |DELINDEX #21;
     Tempo = aTmp22; |HAZ BoraTempo; |DELINDEX #22;
|FPRC;
