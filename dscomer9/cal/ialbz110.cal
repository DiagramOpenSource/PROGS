     Pdte Asignar

|FICHEROS;
     ialbz010 #0;
     dsm00003 #3;
     ialbm006 #6;
     ialbz016 #16,MANTE; ||Procesar Aviso
     ialbm017 #17;
     ialbm018 #18;
     ialbm019 #19;
     ialbm020 #20;
     ialbm021 #21;
     ialbm022 #22;
     agifa024 #24;
     agifa019 #119;

     &refera1@ #1001;
     &refera2@ #1002;
     &refera3@ #1003;
|FIN;

|VARIABLES;
     &enPestana = 0;
     &eaClave1 = "";
     &eaCliDoc = "";
     &eaAuto = "";
     &enModo = 0;
     &enError = 0;
     &eaMatricula = "";
     &eaSerAviso = "";
     &enNumAviso = 0;
     v0 = "000000";
     v1 = "   ";
     v2 = 0;
     aPath = "";
     i = 0;
     nPanta = 0;
     aAlfa = "";
     nRango = 0;
     nPos1 = 0;
     nPos2 = 0;
     nPrecio = 0;
     nDto = 0;
     nVentana = 0;
 {-1}aVent = "";
     aVent1 = 0;
     aVent2 = 0;
     aVent3 = 0;
     aVent4 = 0;
     aVent5 = "";

     aEstadoBtn = "";
     nPestana = 0;
     nBtnSalir1 = 0;
     nBtnAsgMat1 = 0;
     nBtnModi1 = 0;
     nBtnProcesa1 = 0;
     nBtnImpre1 = 0;
     nBtnHisto1 = 0;
     nBtnSMS1 = 0;
     nEvtFoco = 0;
     &enGrida1 = 0;
     &enGrida2 = 0;
     &enGrida3 = 0;
|FIN;

|PROCESO EventoFoco1;
     enPestana = 1;
|FPRC;

|PROCESO BtnAsgMat1;
     |LEE 000#refera1@.=;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |SALVA_DATOS #refera1@;
     |REPON_DATOS #17;
     |HAZ AsignaMatri;
     |SI enError = 0; |HAZ Refresca1; |FINSI;
|FPRC;

|PROCESO BtnModi1;
     |LEE 000#refera1@.=;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |SALVA_DATOS #refera1@;
     |REPON_DATOS #17;
     enModo = 2; |HAZ EditaAviso;
     |SI enError = 0; |HAZ Refresca1; |FINSI;
|FPRC;

/*
     esta en el ialbz910, porque sino no funciona ...pa fliparlo

|PROCESO ProcesaAviso;
     |VENTANA 0910, 2590, -1, 17, "Procesar Aviso";
     nVentana = FSalida;
     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentana;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;
     |PINPA #0#16;
     |PINDA #0#16;
     |ENDATOS #2#16;
     enError = FSalida;
     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentana;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;
     |FINVENTANA nVentana;
     |PULSATECLA;
|FPRC;
*/
|PROCESO BtnProcesa1;
     |LEE 000#refera1@.=;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |ABRE #17;
     #17#0 = #refera1@#0;
     #17#1 = #refera1@#1;
     |LEE 121#17=;
     #16#0 = #17#0;
     #16#1 = #17#1;
     #16#2 = #17#5;
     #16#3 = #17#6;
     #16#4 = #17#7;
     #16#5 = #17#8;
     #16#6 = #17#9;
     #16#7 = #17#10;
     #16#8 = #17#11;
     #16#9 = #17#12;
     #16#10 = #17#13;
     #16#11 = #17#14;
     #16#12 = #17#15;
     #16#13 = #17#16;
     #16#14 = #17#18;
     #16#15 = #17#19;

     |DDEFECTO #24;
     |ABRE #24;
     #24#0 = #16#2;
     |LEE 020#24=;
     |CIERRA #24;
     |DDEFECTO #3;
     |ABRE #3;
     #3#0 = #16#2;
     #3#1 = #16#3;
     |LEE 020#3=
     |CIERRA #3;
     |DDEFECTO #21;
     |ABRE #21;
     #21#0 = #16#14;
     |LEE 020#21=;
     |CIERRA #21;
     |DDEFECTO #22;
     |ABRE #22;
     #22#0 = #16#15;
     |LEE 020#22=;
     |CIERRA #22;

     #16#16 = #24#1;
     #16#17 = #3#2;
     #16#18 = #21#1;
     #16#19 = #22#1;
     |HAZ ProcesaAviso;
     |SI enError = 0;
          |HORA aAlfa;
          |ABRET #18;
          |ABRET #19;
          |DDEFECTO #18;
          #18#0 = #17#0;
          #18#1 = #17#1;
          #18#2 = 1;
          #18#3 = "A";
          #18#4 = Usuario % 810;
          #18#5 = ~;
          #18#6 = aAlfa;
          #18#7 = #16#20;
          #18#10 = #16#15;
          #18#11 = #16#14;
          #18#12 = #16#4;
          #18#13 = #16#5;
          #18#14 = #16#6;
          #18#15 = #16#7;
          #18#16 = #16#8;
          #18#17 = #16#9;
          #18#18 = #16#10;
          #18#19 = #16#11;
          #18#20 = #16#12;
          #18#21 = #16#13;
          #18#39 = #17#5;
          #18#40 = #17#21;
          #18#41 = #17#22;
          #18#42 = #17#45;
          #18#43 = #17#46;
          |GRABA 020#18n;
          |DDEFECTO #21;
          |ABRE #21;
          #21#0 = #16#14;
          |LEE 020#21=;
          |CIERRA #21;
          |DDEFECTO #24;
          |ABRE #24;
          #24#0 = #17#5;
          |LEE 020#24=;
          |CIERRA #24;
          |DDEFECTO #119;
          |ABRE #119;
          #119#0 = #21#3;
          |LEE 020#119=;
          |CIERRA #119;
          |SI #24#39 = 1; nPrecio = #119#18; nDto = #119#21; |FINSI;
          |SI #24#39 = 2; nPrecio = #119#19; nDto = #119#22; |FINSI;
          |SI #24#39 = 3; nPrecio = #119#20; nDto = #119#23; |FINSI;
          |SI #24#39 = 4; nPrecio = #119#147; nDto = #119#150; |FINSI;
          |SI #24#39 = 4; nPrecio = #119#148; nDto = #119#151; |FINSI;
          |SI #24#39 = 4; nPrecio = #119#149; nDto = #119#152; |FINSI;

          |DDEFECTO #19;
          #19#0 = #18#0;
          #19#1 = #18#1;
          #19#2 = #18#2;
          #19#3 = 1;
          #19#4 = #119#0;
          #19#5 = #119#1;
          #19#6 = #21#4;
          #19#7 = nPrecio;
          #19#8 = nDto;
          #19#9 = #19#6 * #19#7;
          #19#10 = (#19#6 * #19#7) < #19#8;
          #19#11 = "N";
          #19#12 = "O";
          #19#13 = #17#5;
          #19#14 = #17#21;
          #19#15 = #17#22;
          #19#16 = #119#9;
          |GRABA 020#19n;
          |CIERRAT #19;
          |CIERRAT #18;

          #17#24 = "T";
          |GRABA 020#17a;
          |HAZ RecalAviso;

          #refera2@#1 = 0; |REFRESCACONTROL enGrida3;
          #refera1@#1 = 0; |REFRESCACONTROL enGrida2;
          |REFRESCACONTROL enGrida1;
          |HAZ Refresca2;
     |FINSI;
     |CIERRA #17;
|FPRC;

|PROCESO BtnImpre1;
     |LEE 000#refera1@.=;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |SALVA_DATOS #refera1@;
     |REPON_DATOS #17;
     |HAZ ImpreAviso;
|FPRC;

|PROCESO BtnSMS1;
     |LEE 000#refera1@.=;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |ABRE #17;
     #17#0 = #refera1@#0;
     #17#1 = #refera1@#1;
     |LEE 000#17=;
     |SI FSalida = 0;
          |HAZ EnvioSMS;
     |FINSI;
     |CIERRA #17;
|FPRC;

|PROCESO BtnHisto1;
     |LEE 000#refera1@.=;
     |SI FSalida ! 0; |ACABA; |FINSI;

     eaMatricula = #refera1@#22;
     eaSerAviso = #refera1@#0;
     enNumAviso = #refera1@#1;
     |HAZ HistoMaquina;
|FPRC;

|PROCESO EstadoBotonIni;
     |ESTADO_CONTROL nBtnSalir1, aEstadoBtn;
     |ESTADO_CONTROL nBtnAsgMat1, aEstadoBtn;
     |ESTADO_CONTROL nBtnModi1, aEstadoBtn;
     |ESTADO_CONTROL nBtnProcesa1, aEstadoBtn;
     |ESTADO_CONTROL nBtnImpre1, aEstadoBtn;
     |ESTADO_CONTROL nBtnHisto1, aEstadoBtn;
     |ESTADO_CONTROL nBtnSMS1, aEstadoBtn;

     || bloquea/desbloquea todas las pesta¤as
     aAlfa = nPanta;
     |MAINCOMMAND 32913, "-1", "-1", aAlfa, "-1", "-1";
     |SI FSalida > 0;
          nPestana = FSalida;
          |ESTADO_CONTROL nPestana, aEstadoBtn
     |FINSI;
|FPRC;

|PROCESO Evento11;
     |SI FSalida = 1; |O FSalida = 2;
          |LEE 000#refera1@.=;
          |SI FSalida = 0;
               #0#6 = #refera1@#7;
               #0#7 = #refera1@#8;
               #0#8 = #refera1@#9;
               eaCliDoc = #refera1@#5;
          |SINO;
               #0#6 = "";
               #0#7 = "";
               #0#8 = "";
          |FINSI;
          |PINPA #1#0;
          |PINTA 1609, #0#6;
          |PINTA 1709, #0#7;
          |PINTA 1809, #0#8;
          #refera2@#1 = 0; |REFRESCACONTROL enGrida3;
          |REFRESCACONTROL enGrida2;
     |FINSI;
|FPRC;

|PROCESO Evento12;
     |SI FSalida = 1; |O FSalida = 2;
          |LEE 000#refera2@.=;
          |REFRESCACONTROL enGrida3;
     |FINSI;
|FPRC;

|PROCESO Evento13;
     |SI FSalida = 1; |O FSalida = 2;
          |LEE 000#refera3@.=;
     |FINSI;
|FPRC;

|PROCESO Min11;
     #refera1@#0 = "     ";
     #refera1@#1 = 000000;
     #refera1@#5 = #0#0;
     #refera1@#18 = #0#1;
     #refera1@#19 = #0#2;
     #refera1@#24 = "P";
     |SI #0#0 = "000000"; #refera1@#5# = "      "; |FINSI;
     |SI #0#1 = "000"; #refera1@#18# = "   "; |FINSI;
|FPRC;

|PROCESO Max11;
     #refera1@#0 = "zzzzz";
     #refera1@#1 = 999999;
     #refera1@#5 = #0#0;
     #refera1@#18 = #0#1;
     #refera1@#19 = #0#2;
     #refera1@#24 = "P";
     |SI #0#0 = "000000"; #refera1@#5# = "zzzzzz"; |FINSI;
     |SI #0#1 = "   "; #refera1@#18# = "zzz"; |FINSI;
     |SI #0#1 = "000"; #refera1@#18# = "zzz"; |FINSI;
     |SI #0#2 = 0; #refera1@#19# = 99999; |FINSI;
|FPRC;

|PROCESO Min12;
     #refera2@#0 = #refera1@#0;
     #refera2@#1 = #refera1@#1;
     #refera2@#2 = 1;
|FPRC;

|PROCESO Max12;
     #refera2@#0 = #refera1@#0;
     #refera2@#1 = #refera1@#1;
     #refera2@#2 = 999;
|FPRC;

|PROCESO Min13;
     #refera3@#0 = #refera2@#0;
     #refera3@#1 = #refera2@#1;
     #refera3@#2 = #refera2@#2;
     #refera3@#3 = 1;
|FPRC;

|PROCESO Max13;
     #refera3@#0 = #refera2@#0;
     #refera3@#1 = #refera2@#1;
     #refera3@#2 = #refera2@#2;
     #refera3@#3 = 999;
|FPRC;

|PROCESO Actualiza1;
     |DESTRUYECONTROL enGrida1;
     |PINPA #1#0; nPanta = FSalida;
     nRango = 4 + 8 + 16 + 32;
     nPos1 = 0602;
     nPos2 = 1598;
     |SI #0#0 ! v0;
          |SI #0#1 ! v1;
               |LINEAL_SIMPLE #8#refera1@, nRango, nPos1, nPos2, Min11, Max11, Evento11;
          |SINO;
               |LINEAL_SIMPLE #9#refera1@, nRango, nPos1, nPos2, Min11, Max11, Evento11;
          |FINSI;
     |SINO;
          |SI #0#1 ! v1;
               |SI #0#0 ! v0;
                    |LINEAL_SIMPLE #10#refera1@, nRango, nPos1, nPos2, Min11, Max11, Evento11;
               |SINO;
                    |LINEAL_SIMPLE #11#refera1@, nRango, nPos1, nPos2, Min11, Max11, Evento11;
               |FINSI;
          |SINO;
               |SI #0#0 ! v0;
                    |LINEAL_SIMPLE #12#refera1@, nRango, nPos1, nPos2, Min11, Max11, Evento11;
               |SINO;
                    |LINEAL_SIMPLE #13#refera1@, nRango, nPos1, nPos2, Min11, Max11, Evento11;
               |FINSI;
          |FINSI;
     |FINSI;
     enGrida1 = FSalida;
     #refera2@#1 = 0; |REFRESCACONTROL enGrida3;
     #refera1@#1 = 0; |REFRESCACONTROL enGrida2;
     |REFRESCACONTROL enGrida1;

     aEstadoBtn = "ENABLE"; |HAZ EstadoBotonIni;
|FPRC;

|PROCESO PintaPan1;
     |DDEF aPath;
     aAlfa = aPath + "ialbm017"; |CARGA_DEF aAlfa, refera1@;
     aAlfa = aPath + "ialbm018"; |CARGA_DEF aAlfa, refera2@;
     aAlfa = aPath + "ialbm019"; |CARGA_DEF aAlfa, refera3@;
     |ABRET #refera1@;
     |ABRET #refera2@;
     |ABRET #refera3@;

     |PINPA #1#0; nPanta = FSalida;
     nRango = 4 + 8 + 16 + 32;
     nPos1 = 2802;
     nPos2 = 3398;
     |LINEAL_SIMPLE #1#refera3@, nRango, nPos1, nPos2, Min13, Max13, Evento13;
     enGrida3 = FSalida;

     nRango = 4 + 8 + 16 + 32;
     nPos1 = 1902;
     nPos2 = 2798;
     |LINEAL_SIMPLE #1#refera2@, nRango, nPos1, nPos2, Min12, Max12, Evento12;
     enGrida2 = FSalida;

     nRango = 4 + 8 + 16 + 32;
     nPos1 = 0602;
     nPos2 = 1598;
     |LINEAL_SIMPLE #1#refera1@, nRango, nPos1, nPos2, Max11, Min11, Evento11;
     enGrida1 = FSalida;

     |CONTROL_SIMPLE nPanta, "EVENTOPAN", 0000, 0000, EventoFoco1;
     nEvtFoco = FSalida;

     |CONTROL_SIMPLE nPanta, "BOTON,Asigna Mat.", 0501, 0513, BtnAsgMat1;
     nBtnAsgMat1 = FSalida;
     |CONTROL_SIMPLE nPanta, "BOTON,Modificar", 0514, 0526, BtnModi1;
     nBtnModi1 = FSalida;
     |CONTROL_SIMPLE nPanta, "BOTON,Procesar", 0527, 0539, BtnProcesa1;
     nBtnProcesa1 = FSalida;
     |CONTROL_SIMPLE nPanta, "BOTON,Imprimir", 0540, 0552, BtnImpre1;
     nBtnImpre1 = FSalida;
     |CONTROL_SIMPLE nPanta, "BOTON,Historial Maq.", 0553, 0565, BtnHisto1;
     nBtnHisto1 = FSalida;
     |CONTROL_SIMPLE nPanta, "BOTON,Envio SMS", 0566, 0578, BtnSMS1;
     nBtnSMS1 = FSalida;

     |CONTROL_SIMPLE nPanta, "BOTON,{{207}} Salir", 3488, 3498, BtnSalir;
     nBtnSalir1 = FSalida;

     |PINTA 1609, #0#6;
     |PINTA 1709, #0#7;
     |PINTA 1809, #0#8;

     |SI eaAuto = "";
          aEstadoBtn = "DISABLE"; |HAZ EstadoBotonIni;
     |FINSI;
|FPRC;

|PROCESO DestruyePan1;
/*
     |DESTRUYECONTROL enGrida1;
     |DESTRUYECONTROL enGrida2;
     |DESTRUYECONTROL enGrida3;

     |FIN_CONTROL_WINDOWS nEvtFoco;
     |FIN_CONTROL_WINDOWS nBtnAsgMat1;
     |FIN_CONTROL_WINDOWS nBtnModi1;
     |FIN_CONTROL_WINDOWS nBtnProcesa1;
     |FIN_CONTROL_WINDOWS nBtnImpre1;
     |FIN_CONTROL_WINDOWS nBtnHisto1;
     |FIN_CONTROL_WINDOWS nBtnSMS1;

     |FIN_CONTROL_WINDOWS nBtnSalir1;
*/

     |CIERRAT #refera3@;
     |CIERRAT #refera2@;
     |CIERRAT #refera1@;
     |DESCARGA_DEF #refera3@;
     |DESCARGA_DEF #refera2@;
     |DESCARGA_DEF #refera1@;
|FPRC;
