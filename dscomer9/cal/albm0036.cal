|FICHEROS;
     albm0036 #0;
     albm0031 #10;
     albm0043 #13;
     dsm00056 #33;
     dsm00057 #34;
     dsm00043 #30;
     dsm00044 #31;

     albm0061 #61;       ||Mezclad.PorConfirmar

     albm0060 #60;       ||Rel. Orden/Mezclada
     albm0062 #62;       ||Rel.Orden-Partidas
     albm0038 #38;       ||Orden (L)

     albw0043 #43;       ||Aux. Validar Mezclad

     albm0031@ #555;
     agifa324 #324;
|FIN;

|VARIABLES;
     &EURODB = 0;

     aDir2 = "";
     aBorra = "";
     nGrid555 = 0;
     nSw555Cargado = 0;

     aBase = "";
     aMas = "";
     aFichSQL = "";
     aSQL = "";

     nSwRefresca = 0;
     {2}nNivel = 0;
     nIdSalir = 0;

     nBotonAceptar = 0;
     nBotonCancelar = 0;
     aQueBoton = "";
     aID = "";

     nNume = 0;
     nTecla = 0;
     fDFecha = @;
     fHFecha = @;
     &enMezcladaOk = 0;
     &enNuevaMez = 0;
     nVentana = 0;

     aMensaje = "";
     &eaDescrip = "";
     &efFecha = @;
     &eaFormula = "";
     &eaDesFor = "";
     &enLinea = 0;
     &eaDesLin = "";
     &enCuarto = 0;
     &eaDesCua = "";
     &enTrabaj = 0;
     &eaDesTra = "";
     &enAlmacen = 0;
     &eaDesAlm = "";
     &enKgRea = 0;
     &enClave61 = 0;

     aPrograma = "";
     aEsc1          = "";
     aEsc2          = "";
     aRetu          = "";
     aTecla         = "";


     aDTipo        = "";
     aHTipo        = "";

     nPrincipal    = 0;
     nFinal        = 0;
     nRango        = 0;

     &enMezclada   = 0;
     &enForma      = 0;
     &enCodigo     = 0;

     nOtroGrid = 0;
     nPanta0 = 0;
     nPanta1 = 0;
     nPanta2 = 0;

     nBoton1_1      = 0;
     nBoton1_2      = 0;
     nBoton1_3      = 0;
     nBoton1_4      = 0;
     nBoton1_5      = 0;
|FIN;

|PROCESO Baja555;
     #555#0 = 9999999;
|FPRC;

|PROCESO Alta555;
     #555#0 = 000000;
|FPRC;

|PROCESO Evento555;
     |SI FSalida = 1;
         |LEE 000#555=;
         |SI FSalida ! 0;  |DDEFECTO #555;  |FINSI;

         |DDEFECTO #10;
         #10#0 = #555#0;
         |LEE 000#10.=;
     |FINSI;

     |SI FSalida = 4;
         |LEE 000#555c;
         |SI FSalida ! 0;  |ACABA;  |FINSI;

         |DDEFECTO #10;
         #10#0 = #555#0;
         |LEE 040#10.=;
         |SI FSalida ! 0;  |ACABA;  |FINSI;

         nIdSalir = 0;
         |HAZ ObtenIdSalir;
         |ESTADO_CONTROL nIdSalir, "HIDE";

         |SI #10#16 = "S";
              |CONFI "0000NMezclada Finalizada. Esta seguro de Continuar?";
              |SI FSalida = 0;
                    |HAZ DesFinaliza;        ||Borra los datos del mant. Partidas
                    |HAZ DatosPartida;
              |FINSI;
         |SINO;
              |HAZ DatosPartida;
         |FINSI;

         |ESTADO_CONTROL nIdSalir, "SHOW";
     |FINSI;
|FPRC;

|PROCESO Baja10;
     |SELECT #3#10;
     #10#16 = aDTipo;
     #10#2 = fDFecha;    || Clave inversa
     #10#0  = 999999;
|FPRC;

|PROCESO Alta10;
     #10#16 = aHTipo;
     #10#2 = fHFecha;
     #10#0  = 1;
|FPRC;

|PROCESO Baja61;
     #61#24 = 1;
|FPRC;

|PROCESO Alta61;
     #61#24 = 999999;
|FPRC;

|PROCESO Tipo12_m0036; |TIPO 12;

|FPRC;

|PROCESO DatosPartida;
     enMezclada = #10#0;
     |SUB_EJECUTA_NP "albw0014;NOMEQUITESQUETECORTOLOSHUEVOS";

     |PULSATECLA;
     |PULSATECLA;
     |PULSATECLA;

     |HAZ RefrePrincipal;

     ||nSwRefresca = 1;
     ||REFRESCACONTROL nPrincipal;
|FPRC;

|PROCESO albm0043_des;
     #dsm00044#21 = #albm0043#11;
     #dsm00044#18 = #albm0043#12;
     #dsm00044#8 = #albm0043#13;
     |LEE 101#dsm00044.=;
     |SI FSalida = 0;
          enForma = -1; enCodigo = #dsm00044#18;
          |HAZ AcumulaES_SS;
          |BORRA 020#dsm00044.a;
     |FINSI;
     |LIBERA #dsm00044;

     #dsm00043#4 = #albm0043#11;
     #dsm00043#0 = #albm0043#12;
     |LEE 101#dsm00043.=;
     |SI FSalida = 0;
          |BORRA 020#dsm00043.a;
     |FINSI;
     |LIBERA #dsm00043;

     #albm0043#11 = "";
     #albm0043#12 = 0;
     #albm0043#13 = 1;
     |GRABA 020#albm0043.a;
     |LIBERA #albm0043;

|FPRC;

|PROCESO albm0060;
     ||TODO CCC
     |SELECT #2#albm0038;
     |DDEFECTO #albm0038;
     #albm0038#0 = #albm0060#0;
     #albm0038#2 = #albm0031#3;
     |LEE 000#albm0038.=;
     |SI FSalida = 0;
          |HAZ SacaOrdenPartida;
     |FINSI;
|FPRC;

|PROCESO SacaOrdenPartida;
     #albm0062#4 = #albm0038#16;
     #albm0062#0 = #albm0038#0;
     #albm0062#1 = #albm0038#1;
     #albm0062#2 = #albm0031#11;
     #albm0062#3 = #albm0031#20;
     |LEE 101#albm0062.=;
     |SI FSalida = 0;
          |BORRA 020#albm0062.a;
     |FINSI;
|FPRC;

|DEFBUCLE albm0060;
 #albm0060#2;
 3;
 #albm0031#0, "";
 #albm0031#0, "";
 ;
 NULL, albm0060;
|FIN;

|PROCESO DesOrdenPartida;
     |BUCLE albm0060;
|FPRC;

|DEFBUCLE albm0043_des;
     #albm0043#1;
     ;
     #albm0031#0, 01, "               ";
     #albm0031#0, 99, "zzzzzzzzzzzzzzz";
     be;
     NULL, albm0043_des;
|FIN;

|PROCESO dsm00057_des;
     enForma = -1; enCodigo = #dsm00057#28;
     |HAZ AcumulaEV;
     |BORRA 020#dsm00057.a;
     |LIBERA #dsm00057;
|FPRC;

|DEFBUCLE dsm00057_des;
     #dsm00057#1;
     ;
     #dsm00056#2, #dsm00056#0, 00001;
     #dsm00056#2, #dsm00056#0, 99999;
     be;
     NULL, dsm00057_des;
|FIN;

|PROCESO DesFinaliza;
     ||Es el proceso inverso a ActStock.
     |ABRE #dsm00056;
     #dsm00056#2 = #albm0031#17;
     #dsm00056#0 = #albm0031#18;
     |LEE 101#dsm00056.=;
     |SI FSalida = 0;
          |BUCLE dsm00057_des;
          |BORRA 020#dsm00056.a;
     |FINSI;
     |LIBERA #dsm00056;
     |CIERRA #dsm00056;
     #albm0031#16 = "N";
     #albm0031#17 = "";
     #albm0031#18 = 0;
     |GRABA 020#albm0031.a;

     |ABRE #dsm00043;
     |ABRE #dsm00044;
     |ABRE #albm0038;
     |ABRE #albm0062;
     |BUCLE albm0043_des;

     ||Es el proceso contrario al ActOrdenPartidas (que esta en albw0014)
     |HAZ DesOrdenPartida;

     |CIERRA #albm0062;
     |CIERRA #albm0038;
     |CIERRA #dsm00044;
     |CIERRA #dsm00043;
|FPRC;

|PROCESO ObtenIdSalir;
     InNivel = nNivel1<-;
     nNivel1 = 0;
     |ESPECIFICA "IDBOTONTECLA", nNivel;
     nIdSalir = nNivel2;
|FPRC;

|PROCESO Evento;
/*
     |SI nSwRefresca = 1;
          nSwRefresca = 0;
          |ACABA;
     |FINSI;
*/

     |SI FSalida = 1;
         |LEE 000#10=;
         |SI FSalida ! 0;  |DDEFECTO #10;  |FINSI;
     |FINSI;

     |SI FSalida = 4;
         |LEE 040#10c;
         |SI FSalida ! 0;  |ACABA;  |FINSI;

         nIdSalir = 0;
         |HAZ ObtenIdSalir;
         |ESTADO_CONTROL nIdSalir, "HIDE";

         |SI #10#16 = "S";
              |CONFI "0000NMezclada Finalizada. Esta seguro de Continuar?";
              |SI FSalida = 0;
                    |HAZ DesFinaliza;        ||Borra los datos del mant. Partidas
                    |HAZ DatosPartida;
              |FINSI;
         |SINO;
              |HAZ DatosPartida;
         |FINSI;

         |ESTADO_CONTROL nIdSalir, "SHOW";

||         FSalida = "SKIPDEFAULT";
     |FINSI;

||     |HAZ BotonRefresca;
|FPRC;

|PROCESO BotonRefresca;
     |SI nSwRefresca = 1;
          |REFRESCACONTROL nPrincipal;
          nSwRefresca = 0;
     |FINSI;
|FPRC;

|PROCESO Tipo80; |TIPO 80;
     FSalida = 3299;
|FPRC;

|PROCESO Tipo90; |TIPO 90;
     |SI nSw555Cargado = 1;
          nSw555Cargado = 0;
          aFichSQL = ("33" + Usuario) % 108;

          |DESTRUYECONTROL nGrid555;
          |CIERRA #555;
          |DESCARGA_DEF #albm0031@;

          |DBASE aBase;
          |QBF aBase;
          aBorra = aBase + "def/" + aFichSQL + ".mas";
          |FBORRA aBorra;

          |DFICE aDir2;
          |QBF aDir2;
          aBorra = aDir2 + aFichSQL + ".dat";
          |FBORRA aBorra;
          aBorra = aDir2 + aFichSQL + ".ddx";
          |FBORRA aBorra;
          aBorra = aDir2 + aFichSQL + ".ixx";
          |FBORRA aBorra;
     |FINSI;
|FPRC;

|PROCESO Tipo7C2_m0036; |TIPO 7;
     aQueBoton = "|X000";
     aID = #0#aQueBoton#;
     nBotonAceptar = aID;
     |ESTADO_CONTROL nBotonAceptar, "HIDE";

     aQueBoton = "|X001";
     aID = #0#aQueBoton#;
     nBotonCancelar = aID;
     |ESTADO_CONTROL nBotonCancelar, "HIDE";
|FPRC;

|PROCESO Dias; |TIPO 0;
     |SI FSalida = 1;
          |ERROR;
          |PTEC 802;
     |FINSI;

     fHFecha = ~;
     nNume = fHFecha;
     nNume = nNume - #0#2;
     fDFecha = nNume;

     |HAZ RefrePrincipal;

||     |LEE 000#10p;
||     |REFRESCACONTROL nPrincipal;
|FPRC;

|| ------------------------------------------------------
|| Procesos del Boton 1_1
|| ------------------------------------------------------

|PROCESO Boton1_1;
     |ESTADO_CONTROL nBoton1_1, "DISABLE";
     |ESTADO_CONTROL nBoton1_2, "ENABLE";
     |ESTADO_CONTROL nBoton1_3, "ENABLE";

     aDTipo = "N";
     aHTipo = "N";
     fHFecha = ~;
     nNume = fHFecha;
     nNume = nNume - #0#2;
     fDFecha = nNume;

     |HAZ RefrePrincipal;

||     |LEE 000#10p;
||     |REFRESCACONTROL nPrincipal;
|FPRC;

|| ------------------------------------------------------
|| Procesos del Boton 1_2
|| ------------------------------------------------------

|PROCESO Boton1_2;
     |ESTADO_CONTROL nBoton1_1, "ENABLE";
     |ESTADO_CONTROL nBoton1_2, "DISABLE";
     |ESTADO_CONTROL nBoton1_3, "ENABLE";

     aDTipo = "S";
     aHTipo = "S";
     fHFecha = ~;
     nNume = fHFecha;
     nNume = nNume - #0#2;
     fDFecha = nNume;

     |HAZ RefrePrincipal;

||     |LEE 000#10p;
||     |REFRESCACONTROL nPrincipal;
|FPRC;

|| ------------------------------------------------------
|| Procesos del Boton 1_3
|| ------------------------------------------------------

|PROCESO Boton1_3;
     |ESTADO_CONTROL nBoton1_1, "ENABLE";
     |ESTADO_CONTROL nBoton1_2, "ENABLE";
     |ESTADO_CONTROL nBoton1_3, "DISABLE";

     aDTipo = "";
     aHTipo = "z";
     fHFecha = ~;
     nNume = fHFecha;
     nNume = nNume - #0#2;
     fDFecha = nNume;

     |HAZ RefrePrincipal;

||     |LEE 000#10p;
||     |REFRESCACONTROL nPrincipal;
|FPRC;

|PROCESO RefrePrincipal;
     |SI nSw555Cargado = 1;
          |DESTRUYECONTROL nGrid555;
          |CIERRA #555;
          |DESCARGA_DEF #albm0031@;
     |FINSI;

     |PINPA #1#0; nPanta1 = FSalida;

     aFichSQL = ("33" + Usuario) % 108;

     aSQL = "SELECT * FROM albm0031 INTO " + aFichSQL + ".def WHERE ";
     aSQL = aSQL + "16 BETWEEN " + aDTipo + "," + aHTipo;
     aSQL = aSQL + " AND 2 BETWEEN " + fDFecha + "," + fHFecha;
     aSQL = aSQL + " AND 0 BETWEEN 0,999999";

     |SQL aSQL;

     |DBASE aBase;  |QBF aBase;
     aMas = aBase + "def/albm0031.mas";
     |CARGA_DEF aMas, albm0031@;
     |SI FSalida = 0;
          nSw555Cargado = 1;
     |FINSI;

     |NOME_DAT #555 aFichSQL;

     |ABRE #555;
     |LINEAL_SIMPLE #4#555, nRango, 0702, 2898, Baja555, Alta555, Evento555;
     nGrid555 = FSalida;
|FPRC;


|PROCESO Boton1_4;
     |PTEC 806;
|FPRC;

|PROCESO Boton1_5;
     |C_M #0#2, 1, "S";
     |PINTA #0#2;
     |ENCAMPO #2#0;
     |C_M #0#2, 1, "N";
     |PINTA #0#2;
|FPRC;

|PROGRAMA;
     |CLS;
     |DDEFECTO #0;


     |ABRE #agifa324;
     |DDEFECTO #agifa324;
     #agifa324#0 = "EUR";
     |LEE 000#agifa324.=;
     EURODB = #agifa324#9;
     |CIERRA #agifa324;


     aDTipo = "N";       ||Pendientes
     aHTipo = "N";
     fHFecha = ~;
     nNume = fHFecha;
     nNume = nNume - #0#2;
     fDFecha = nNume;

     |PINPA #0#0; nPanta0 = FSalida;
     |PINDA #0#0;

     |CONTROL_SIMPLE nPanta0, "BOTON,Modificar DIAS ", 0680, 0692, Boton1_5;
     nBoton1_5 = FSalida;

     nRango     = 4 + 8 + 16 + 32 + 128;

     |PINPA #1#0; nPanta1 = FSalida;

     |ABRE #10;

     |HAZ RefrePrincipal;
/*
     |LINEAL_SIMPLE #3#10, nRango, 0702, 2898, Baja10, Alta10, Evento;
     nPrincipal = FSalida;
*/

     |PINPA #2#0; nPanta2 = FSalida;

     |ABRE #61;

     nRango     = 4 + 8 + 16 + 32 + 128;
     |LINEAL_SIMPLE #1#61, nRango, 0702, 2898, Baja61, Alta61, Evento61;
     nOtroGrid = FSalida;

     |HAZ BotonesPanta1;

     aEsc1  = &255 + "806";
     aEsc2  = &255 + "807";
     aRetu  = &255 + "802";
     |PARA; |SI;  |HACIENDO;
         FSalida = "::Salir";
         |LEETECLA aTecla;
         |SI aTecla = aEsc1; |SAL;  |FINSI;
         |SI aTecla = aEsc2; |SAL;  |FINSI;
         |SI aTecla = aRetu; |SAL;  |FINSI;
     |SIGUE;

/*
     |PTEC 802;
     |PARA;  |SI;  |HACIENDO;
          |ENDATOS #1#0;
          |SI nTecla = 0;  |SAL;  |FINSI;
          |PULSATECLA;
          |PULSATECLA;
          |PULSATECLA;
          nTecla = 0;
     |SIGUE;
*/

     |CIERRA #61;
     |CIERRA #10;

     |FIN_CONTROL_WINDOWS nBoton1_1;
     |FIN_CONTROL_WINDOWS nBoton1_2;
     |FIN_CONTROL_WINDOWS nBoton1_3;
     |FIN_CONTROL_WINDOWS nBoton1_4;

     |DESTRUYECONTROL nPrincipal;
     |DESTRUYECONTROL nOtroGrid;
     |PULSATECLA;
|FPRO;
|PROCESO BotonesPanta1;

     |CONTROL_SIMPLE nPanta1, "BOTON,Pendientes ", 0620, 0640, Boton1_1;
     nBoton1_1 = FSalida;

     |CONTROL_SIMPLE nPanta1, "BOTON,Finalizadas ", 0642, 0662, Boton1_2;
     nBoton1_2 = FSalida;

     |CONTROL_SIMPLE nPanta1, "BOTON,Todas ", 0664, 0684, Boton1_3;
     nBoton1_3 = FSalida;

     |ESTADO_CONTROL nBoton1_1, "DISABLE";
     |ESTADO_CONTROL nBoton1_2, "ENABLE";
     |ESTADO_CONTROL nBoton1_3, "ENABLE";

||     |CONTROL_SIMPLE nPanta1, "BOTON,Salir ", 2985, 2995, Boton1_4;
||     nBoton1_4 = FSalida;
|FPRC;

|PROCESO Evento61;
     |SI FSalida = 1;
         |LEE 040#61=;
         |SI FSalida ! 0;  |DDEFECTO #61;  |FINSI;
     |FINSI;

     |SI FSalida = 4;

          |LEE 040#61c;
          |SI FSalida ! 0;  |ACABA;  |FINSI;

          ||Tengo que poner un ENDATOS. NO ME VA ...
          ||PORQUE el albm0031, esta en la pantalla con un lineal_simple

          ||Primero averiguo el numero de Mezclada
          ||Luego relleno los campos que me interesa
          ||Y ya se termina de rellenar.

          eaDescrip = #albm0061#1;
          efFecha = #albm0061#2;
          eaFormula = #albm0061#3;
          eaDesFor = #albm0061#4;
          enLinea = #albm0061#5;
          eaDesLin = #albm0061#6;
          enCuarto = #albm0061#7;
          eaDesCua = #albm0061#8;
          enTrabaj = #albm0061#9;
          eaDesTra = #albm0061#10;
          enAlmacen = #albm0061#11;
          eaDesAlm = #albm0061#12;
          enKgRea = #albm0061#13;

          enClave61 = #albm0061#24;

          |PULSATECLA;
          |PULSATECLA;
          |PULSATECLA;

          ||enMezcladaOk = 1;
          enMezcladaOk = 0;
          aPrograma = "albz0026;NOMEQUITESQUETECORTOLOSHUEVOS";
          |SUB_EJECUTA aPrograma;

          |PULSATECLA;
          |PULSATECLA;
          |PULSATECLA;

          |SI enMezcladaOk = 1;
               enMezclada = enNuevaMez;
               |SUB_EJECUTA_NP "albw0014;NOMEQUITESQUETECORTOLOSHUEVOS";

               |PULSATECLA;
               |PULSATECLA;
               |PULSATECLA;
          |FINSI;

||          |HAZ ValidaMezcladas;       ||No va el pintado de la pantalla

          FSalida = "SKIPDEFAULT";
          |REFRESCACONTROL nOtroGrid;
          |REFRESCACONTROL nPrincipal;
     |FINSI;
|FPRC;


|PROCESO ValidaMezcladas;
||     |VENTANA 0501, 1299, -1, -1, "";
     nVentana = FSalida;

     |ABRE #albw0043;
     |LEE 000#albw0043.p;
     |DDEFECTO #albw0043;

     |PINPA #0#albw0043;
     |PINDA #0#albw0043;
     |ENDATOS #1#albw0043;
     |SI FSalida = 0;
          ||TODO CCC
     |FINSI;
     |CIERRA #albw0043;

||     |FINVENTANA nVentana;
|FPRC;
