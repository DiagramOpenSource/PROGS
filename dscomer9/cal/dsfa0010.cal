|FICHEROS;
   dsfa0010 #0;

   agis0002 #10;
   agifa010 #11;
   agifa024 #12;
   agifa025 #13;

   dsfw0001 #100;
   dsfw0002 #101;
   agiw0010 #102;

   dscam003@ #1000;
   dscam004@ #1001;
   dscam045@ #1002;

   Referen@ #5000;
|FIN;

|VARIABLES;
   &enSw  = 0;
   &enContLin = 0;
   nSw    = 0;
   nSwAnt = 0;
   nLins  = 0;
   nCalc  = 0;
   nNumLins = 0;
   nPp      = 0;
   nTecla   = 0;
   nHandle  = 0;

   aAlfa = "";
   aAntCli = "";

   aSerie = "";
   nNumero = 0;
   nLinea  = 0;
|FIN;

/*
|PROCESO Entregas;
   #dscam004@#17 = #dscam003@#40;
   #dscam004@#3 = 1;
   |LEE 000#dscam004@.];
   |SI FSalida ! 0; |O #dscam004@#17 = #dscam003@#40;
      |DDEFECTO #dscam004@;
      #dscam004@#6 = "01.01.0000";
   |FINSI;

   aAlfa = #dscam003@#85; |QBF aAlfa;
   |SI aAlfa = "";
      #dsfw0001#10 = #dsfw0001#10 + #dscam003@#22;
   |SINO;
      #dsfw0001#11 = #dsfw0001#11 + #dscam003@#22;
   |FINSI;

   #dsfw0001#12 = #dsfw0001#8 - #dsfw0001#10;

   |DDEFECTO #dsfw0002;
   #dsfw0002#0 = #dscam003@#0;
   #dsfw0002#1 = #dscam003@#1;
   #dsfw0002#2 = nLinea;       nLinea = nLinea + 1;
   #dsfw0002#3 = #dscam003@#12;
   #dsfw0002#4 = #dscam004@#4;
   #dsfw0002#5 = #dscam003@#4;
   #dsfw0002#6 = #dscam003@#3;
   #dsfw0002#7 = #dscam003@#26;
   #dsfw0002#8 = #dscam003@#22;
   |SI aAlfa = "";
      #dsfw0002#9 = "S";
   |SINO;
      #dsfw0002#9 = "N";
   |FINSI;
   |GRABA 020#dsfw0002.n;
|FPRC;

|DEFBUCLE Entregas;
#dscam003@#6006;
;
00, #agifa010#52, #agifa010#0, 000, "A", 000000001;
99, #agifa010#52, #agifa010#0, 999, "A", 999999999;
;
NULL,Entregas;
|FIN;

|PROCESO Albaranes;
   |SI #agifa010#61 = 0; |ACABA; |FINSI;

   #agifa024#0 = #agifa010#3;
   |LEE 000#agifa024.=;
   |SI FSalida ! 0;
      |MENAV "    No encuentro el cliente de la entrega n§ " + #dscam003@#40;
      |ACABA;
   |FINSI;

   |SI #agifa024#189 < #dsfa0010#2; |O #agifa024#189 > #dsfa0010#3; |ACABA; |FINSI;

   #agifa025#0 = #agifa010#6;
   |LEE 000#agifa025.=;
   |SI FSalida ! 0; |DDEFECTO #agifa025; |FINSI;

   |DDEFECTO #dsfw0001;
   #dsfw0001#5 = #agifa010#52;
   #dsfw0001#6 = #agifa010#0;
   |LEE 000#dsfw0001.=;
   |SI FSalida ! 0; |GRABA 020#dsfw0001.b; |FINSI;

   #dsfw0001#0 = #agifa010#3;
   |SI #dsfa0010#9 = "F";
      #dsfw0001#1 = #agifa024#1;
   |SINO;
      #dsfw0001#1 = #agifa024#2;
   |FINSI;
   #dsfw0001#2 = #agifa024#189;
   #dsfw0001#3 = #agifa010#6;
   #dsfw0001#4 = #agifa025#1;
   #dsfw0001#7 = #agifa010#1;
   #dsfw0001#8 = #agifa010#78;
   #dsfw0001#9 = #agifa010#61;

   |DBASS aAlfa; |QBF aAlfa;
   aAlfa = aAlfa + "dscarter/fich/"; |PATH_DAT #dscam045@#aAlfa#;
   |ABRE #dscam045@;
   #dscam045@#0 = #48#0;
   #dscam045@#1 = 1;
   |LEE 000#dscam045@.];
   |PARA; |SI FSalida = 0; |Y #dscam045@#0 = #48#0; |HACIENDO;
      |SI #dscam045@#2 = "V";
         |SI #dscam045@#4 [ #agifa010#52; |Y #dscam045@#5 ] #agifa010#52;
            |DBASS aAlfa; |QBF aAlfa;
            aAlfa = aAlfa + "dscarter/def/dscam003.mas";
            |CARGA_DEF aAlfa, dscam003@;
            |SI FSalida = 0;
               |DBASS aAlfa; |QBF aAlfa;
               aAlfa = aAlfa + "dscarter/def/dscam004.mas";
               |CARGA_DEF aAlfa, dscam004@;
               |SI FSalida = 0;
                  |DBASS aAlfa; |QBF aAlfa;
                  aAlfa = aAlfa + "dscarter/fich/" + (("00000" + #dscam045@#6) % -105) + "/";
                  |PATH_DAT #dscam003@#aAlfa#; |PATH_DAT #dscam004@#aAlfa#;
                  |ABRE #dscam003@; |ABRE #dscam004@;
                  nLinea = 1; |BUCLE Entregas;
                  |CIERRA #dscam004@; |DESCARGA_DEF #dscam004@;
               |FINSI;
               |CIERRA #dscam003@; |DESCARGA_DEF #dscam003@;
            |FINSI;
            |SAL;
         |FINSI;
      |FINSI;
      |LEE 000#dscam045@.s;
   |SIGUE;
   |GRABA 020#dsfw0001.a; |LIBERA #dsfw0001;
|FPRC;

|DEFBUCLE Albaranes;
#agifa010#3;
6;
#dsfa0010#0, #dsfa0010#6, "     ", 000000, #dsfa0010#4;
#dsfa0010#1, #dsfa0010#7, "zzzzz", 999999, #dsfa0010#5;
;
NULL,Albaranes;
|FIN;

|PROCESO Print;
   |SI enSw = 1;
      |SI #dsfa0010#8 = "S";
         nLins = 8;
      |SINO;
         nLins = 4;
      |FINSI;
   |FINSI;
   |SI enSw = 2;
      |SI #dsfa0010#8 = "S";
         nLins = 8;
      |SINO;
         nLins = 4;
      |FINSI;
   |FINSI;
   |SI enSw = 3; nLins = 1;  |FINSI;
   |SI enSw = 4; nLins = 4;  |FINSI;
   |SI enSw = 5; nLins = 1;  |FINSI;

   nCalc = enContLin + nLins;
   |SI nCalc > nNumLins;
      nSwAnt = enSw;
      |PARA; |SI enContLin [ nNumLins; |HACIENDO enContLin = enContLin + 1;
         enSw = 6; |PRINT;
      |SIGUE;
      |PIEINF;
      enContLin = 6;
      |SI nSwAnt = 2;
         enSw = 1; |PRINT; enContLin = enContLin + 2;
      |FINSI;
      |SI nSwAnt = 3;
         enSw = 1; |PRINT; enContLin = enContLin + 2;
         enSw = 2; |PRINT; enContLin = enContLin + 3;
      |FINSI;
      |SI nSwAnt = 5;
         enSw = 4; |PRINT; enContLin = enContLin + 3;
      |FINSI;
      enSw = nSwAnt;
   |FINSI;

   |SI enSw = 1; enContLin = enContLin + 2; |FINSI;
   |SI enSw = 2; enContLin = enContLin + 3; |FINSI;
   |SI enSw = 3; enContLin = enContLin + 1; |FINSI;
   |SI enSw = 4; enContLin = enContLin + 3; |FINSI;
   |SI enSw = 5; enContLin = enContLin + 1; |FINSI;
   |PRINT;
|FPRC;

|PROCESO ImpEntregas;
   enSw = 5; |HAZ Print;
|FPRC;

|DEFBUCLE ImpEntregas;
#dsfw0002#1;
;
#dsfw0001#5, #dsfw0001#6, 001;
#dsfw0001#5, #dsfw0001#6, 999;
;
NULL,ImpEntregas;
|FIN;

|PROCESO Imprime;
   |SI aAntCli ! #dsfw0001#0;
      enSw = 1; |HAZ Print;
      enSw = 2; |HAZ Print;
      aAntCli = #dsfw0001#0;
   |SINO;
      |SI nPp = 1;
         enSw = 2; |HAZ Print;
         nPp = 0;
      |FINSI;
   |FINSI;

   |SI #100#12 ! 0; enSw = 3; |HAZ Print; |FINSI;

   nPp = 0;
   |SI #dsfa0010#8 = "S"; |Y #dsfw0001#9 ! 0;
      nPp = 1;
      enSw = 4; |HAZ Print;
      |BUCLE ImpEntregas;
   |FINSI;
|FPRC;

|DEFBUCLE Imprime;
#dsfw0001#2;
;
INICIO;
FINAL;
;
NULL,Imprime;
|FIN;

|PROCESO Tipo3; |TIPO 3;
   |DBASS aAlfa; |QBF aAlfa;
   aAlfa = aAlfa + "dscarter/def/dscam045.mas";
   |CARGA_DEF aAlfa, dscam045@;
   |SI FSalida = 0;
      |ABRE #agifa010; |ABRE #agifa024; |ABRE #agifa025;
      aAlfa = "t1" + Usuario; |NOME_DAT #dsfw0001#aAlfa#; |DELINDEX #dsfw0001;
      aAlfa = "t2" + Usuario; |NOME_DAT #dsfw0002#aAlfa#; |DELINDEX #dsfw0002;
      |ABRE #dsfw0002; |ABRE #dsfw0001;
      |BUCLE Albaranes;
      |CIERRA #dsfw0002; |CIERRA #dsfw0001;
      |CIERRA #agifa010; |CIERRA #agifa024; |CIERRA #agifa025;

      |IMPRE 0;
      |SI FSalida = 0;
         |CIMPR 11; nNumLins = FSalida;
         |INFOR "dsfa0010";
         |SI FSalida = 0;
            enContLin = 3;
            |BUCLE Imprime;
            |PIEINF; |FININF;
         |FINSI;
         |FINIMP;
      |FINSI;
      |CIERRA #dscam045@; |DESCARGA_DEF #dscam045@;
   |FINSI;
|FPRC;
*/
|PROCESO Print;
   |SI enSw = 1;
      |SI #dsfa0010#8 = "S";
         nLins = 8;
      |SINO;
         nLins = 4;
      |FINSI;
   |FINSI;
   |SI enSw = 2;
      |SI #dsfa0010#8 = "S";
         nLins = 8;
      |SINO;
         nLins = 4;
      |FINSI;
   |FINSI;
   |SI enSw = 3; nLins = 1;  |FINSI;
   |SI enSw = 4; nLins = 4;  |FINSI;
   |SI enSw = 5; nLins = 1;  |FINSI;

   nCalc = enContLin + nLins;
   |SI nCalc > nNumLins;
      nSwAnt = enSw;
      |PARA; |SI enContLin [ nNumLins; |HACIENDO enContLin = enContLin + 1;
         enSw = 6; |PRINT;
      |SIGUE;
      |PIEINF;
      enContLin = 6;
      |SI nSwAnt = 2;
         enSw = 1; |PRINT; enContLin = enContLin + 2;
      |FINSI;
      |SI nSwAnt = 3;
         enSw = 1; |PRINT; enContLin = enContLin + 2;
         enSw = 2; |PRINT; enContLin = enContLin + 3;
      |FINSI;
      |SI nSwAnt = 5;
         enSw = 4; |PRINT; enContLin = enContLin + 3;
      |FINSI;
      enSw = nSwAnt;
   |FINSI;

   |SI enSw = 1; enContLin = enContLin + 2; |FINSI;
   |SI enSw = 2; enContLin = enContLin + 3; |FINSI;
   |SI enSw = 3; enContLin = enContLin + 1; |FINSI;
   |SI enSw = 4; enContLin = enContLin + 3; |FINSI;
   |SI enSw = 5; enContLin = enContLin + 1; |FINSI;
   |PRINT;
|FPRC;

|PROCESO ImpEntregas;
   enSw = 5; |HAZ Print;
|FPRC;

|DEFBUCLE ImpEntregas;
#dsfw0002#1;
;
#dsfw0001#5, #dsfw0001#6, 001;
#dsfw0001#5, #dsfw0001#6, 999;
;
NULL,ImpEntregas;
|FIN;

|PROCESO Imprime;
   |SI aAntCli ! #dsfw0001#0;
      enSw = 1; |HAZ Print;
      enSw = 2; |HAZ Print;
      aAntCli = #dsfw0001#0;
   |SINO;
      |SI nPp = 1;
         enSw = 2; |HAZ Print;
         nPp = 0;
      |FINSI;
   |FINSI;

   |SI #100#12 ! 0; enSw = 3; |HAZ Print; |FINSI;

   nPp = 0;
   |SI #dsfa0010#8 = "S"; |Y #dsfw0001#9 ! 0;
      nPp = 1;
      enSw = 4; |HAZ Print;
      |BUCLE ImpEntregas;
   |FINSI;
|FPRC;

|DEFBUCLE Imprime;
#dsfw0001#2;
;
INICIO;
FINAL;
;
NULL,Imprime;
|FIN;

|PROCESO Entregas;
   |SI #dscam003@#30 = 0; |ACABA; |FINSI;
   |SI #dsfa0010#0 > #dscam003@#32; |O #dsfa0010#1 < #dscam003@#32; |ACABA; |FINSI;
   |SI #dsfa0010#4 > #dscam003@#33; |O #dsfa0010#5 < #dscam003@#33; |ACABA; |FINSI;

   #agifa010#52 = #dscam003@#0;
   #agifa010#0  = #dscam003@#1;
   |LEE 000#agifa010.=;
   |SI FSalida ! 0; |ACABA; |FINSI;

   |SI #agifa010#61 = 0; |ACABA; |FINSI;

   #agifa024#0 = #agifa010#3;
   |LEE 000#agifa024.=;
   |SI FSalida ! 0;
      |MENAV "    No encuentro el cliente de la entrega n§ " + #dscam003@#40;
      |ACABA;
   |FINSI;
   |SI #agifa024#189 < #dsfa0010#2; |O #agifa024#189 > #dsfa0010#3; |ACABA; |FINSI;

   #agifa025#0 = #agifa010#6;
   |LEE 000#agifa025.=;
   |SI FSalida ! 0; |DDEFECTO #agifa025; |FINSI;

   #dscam004@#17 = #dscam003@#40;
   #dscam004@#3 = 1;
   |LEE 000#dscam004@.];
   |SI FSalida ! 0; |O #dscam004@#17 = #dscam003@#40;
      |DDEFECTO #dscam004@;
      #dscam004@#6 = "01.01.0000";
   |FINSI;

   aAlfa = #dscam003@#85; |QBF aAlfa;

   |DDEFECTO #dsfw0001;
   #dsfw0001#5 = #agifa010#52;
   #dsfw0001#6 = #agifa010#0;
   |LEE 000#dsfw0001.=;
   |SI FSalida ! 0; |GRABA 020#dsfw0001.b; |FINSI;

   #dsfw0001#0 = #agifa010#3;
   |SI #dsfa0010#9 = "F";
      #dsfw0001#1 = #agifa024#1;
   |SINO;
      #dsfw0001#1 = #agifa024#2;
   |FINSI;
   #dsfw0001#2 = #agifa024#189;
   #dsfw0001#3 = #agifa010#6;
   #dsfw0001#4 = #agifa025#1;
   #dsfw0001#7 = #agifa010#1;
   #dsfw0001#8 = #agifa010#78;
   #dsfw0001#9 = #agifa010#61;
   aAlfa = #dscam003@#85; |QBF aAlfa;
   |SI aAlfa = "";
      #dsfw0001#10 = #dsfw0001#10 + #dscam003@#22;
   |SINO;
      #dsfw0001#11 = #dsfw0001#11 + #dscam003@#22;
   |FINSI;
   #dsfw0001#12 = #dsfw0001#8 - #dsfw0001#10;
   |GRABA 020#dsfw0001.a; |LIBERA #dsfw0001;

   |DDEFECTO #dsfw0002;
   #dsfw0002#0 = #dscam003@#0;
   #dsfw0002#1 = #dscam003@#1;
   #dsfw0002#2 = nLinea;       nLinea = nLinea + 1;
   #dsfw0002#3 = #dscam003@#12;
   #dsfw0002#4 = #dscam004@#4;
   #dsfw0002#5 = #dscam003@#4;
   #dsfw0002#6 = #dscam003@#3;
   #dsfw0002#7 = #dscam003@#26;
   #dsfw0002#8 = #dscam003@#22;
   |SI aAlfa = "";
      #dsfw0002#9 = "S";
   |SINO;
      #dsfw0002#9 = "N";
   |FINSI;
   |GRABA 020#dsfw0002.n;
|FPRC;

|DEFBUCLE Entregas;
#dscam003@#6006;
;
00, "     ", 000000, 000, "A", 000000001;
99, "zzzzz", 999999, 999, "A", 999999999;
;
NULL,Entregas;
|FIN;

|PROCESO MiraCartera;
   nTecla = FSalida;
   |SI Campo = 10; |Y nTecla ! 2;
      aAlfa = #dsfa0010#Campo#; |QBF aAlfa;
      aAlfa = aAlfa + "def/dscam000.mas";
      |XABRE "E", aAlfa, nHandle;
      |SI FSalida < 0;
         |MENAV "    No encuentro cartera"; |ERROR; |ACABA;
      |FINSI;
   |FINSI;
   |SI Campo = 11; |Y nTecla ! 2;
      aAlfa = #dsfa0010#10; |QBF aAlfa;
      aAlfa = aAlfa + "def/dscam000.mas";
      |CARGA_DEF aAlfa, Referen@;
      |SI FSalida = 0;
         aAlfa = #dsfa0010#10; |QBF aAlfa;
         aAlfa = aAlfa + "fich/";
         |PATH_DAT #Referen@#aAlfa#; |ABRE #Referen@;
         |SI nTecla = 10;
            #Referen@#0 = #dsfa0010#11;
            |LEE 000#Referen@.];
            |CONSULTA_CLAVE #1#Referen@;
            |SI FSalida = 0;
               #dsfa0010#11 = #Referen@#0; |PINTA #dsfa0010#11;
            |FINSI;
         |FINSI;
         #Referen@#0 = #dsfa0010#11;
         |LEE 000#Referen@.=;
         |SI FSalida = 0;
            |PINTA 2124, #Referen@#1;
         |SINO;
            |MENAV "    Empresa inexistente"; |ERROR;
         |FINSI;
         |CIERRA #Referen@; |DESCARGA_DEF #Referen@;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO AlbPdtes;
   #agifa024#0 = #agifa010#3;
   |LEE 000#agifa024.=;
   |SI FSalida ! 0;
      aAlfa = "    No encuentro el cliente del albaran n§ " + #agifa010#52 + "/" + (("000000" + #agifa010#0) % -106);
      |MENAV aAlfa;
      |ACABA;
   |FINSI;
   |SI #agifa024#189 < #dsfa0010#2; |O #agifa024#189 > #dsfa0010#3; |ACABA; |FINSI;
   |SI #dsfa0010#4 > #agifa010#6; |O #dsfa0010#5 < #agifa010#6; |ACABA; |FINSI;

   |SI #agifa010#61 ! 0; |ACABA; |FINSI;

   |DDEFECTO #dsfw0001;
   #dsfw0001#5 = #agifa010#52;
   #dsfw0001#6 = #agifa010#0;
   |LEE 000#dsfw0001.=;
   |SI FSalida ! 0; |GRABA 020#dsfw0001.b; |FINSI;

   #dsfw0001#0 = #agifa010#3;
   |SI #dsfa0010#9 = "F";
      #dsfw0001#1 = #agifa024#1;
   |SINO;
      #dsfw0001#1 = #agifa024#2;
   |FINSI;
   #dsfw0001#2 = #agifa024#189;
   #dsfw0001#3 = #agifa010#6;
   #dsfw0001#4 = #agifa025#1;
   #dsfw0001#7 = #agifa010#1;
   #dsfw0001#8 = #agifa010#78;
   #dsfw0001#9 = #agifa010#61;
   #dsfw0001#11 = #dsfw0001#11 + #agifa010#78;
   #dsfw0001#12 = #dsfw0001#8;
   |GRABA 020#dsfw0001.a; |LIBERA #dsfw0001;

|FPRC;

|DEFBUCLE AlbPdtes;
#agifa010#3;
;
#dsfa0010#0, #dsfa0010#6, "     ", 000000;
#dsfa0010#1, #dsfa0010#7, "zzzzz", 999999;
;
NULL,AlbPdtes;
|FIN;

|PROCESO Tipo3;
   aAlfa = "t1" + Usuario; |NOME_DAT #dsfw0001#aAlfa#;
   aAlfa = "t2" + Usuario; |NOME_DAT #dsfw0002#aAlfa#;
   |DELINDEX #dsfw0001; |DELINDEX #dsfw0002;
   |ABRE #dsfw0002; |ABRE #dsfw0001;
   |ABRE #agifa010; |ABRE #agifa024; |ABRE #agifa025;
   aAlfa = #dsfa0010#10; |QBF aAlfa; aAlfa = aAlfa + "def/dscam003.mas";
   |CARGA_DEF aAlfa, dscam003@;
   |SI FSalida = 0;
      aAlfa = #dsfa0010#10; |QBF aAlfa; aAlfa = aAlfa + "def/dscam004.mas";
      |CARGA_DEF aAlfa, dscam004@;

      aAlfa = #dsfa0010#10; |QBF aAlfa;
      aAlfa = aAlfa + "fich/" + (("00000" + #dsfa0010#11) % -105) + "/";
      |PATH_DAT #dscam003@#aAlfa#; |PATH_DAT #dscam004@#aAlfa#;
      |BUCLE Entregas;
      |CIERRA #dscam004@; |DESCARGA_DEF #dscam004@;
      |CIERRA #dscam003@; |DESCARGA_DEF #dscam003@;

      |BUCLE AlbPdtes;
   |FINSI;
   |CIERRA #agifa010; |CIERRA #agifa024; |CIERRA #agifa025;

   |IMPRE 0;
   |SI FSalida = 0;
      |CIMPR 11; nNumLins = FSalida;
      |INFOR "dsfa0010";
      |SI FSalida = 0;
         enContLin = 3;
         |BUCLE Imprime;
         |PIEINF; |FININF;
      |FINSI;
      |FINIMP;
   |FINSI;
   |CIERRA #dsfw0002; |CIERRA #dsfw0001;
|FPRC;

|PROGRAMA;
   |ABRE #dsfa0010;
   |LEE 000#dsfa0010.p;
   |SI FSalida ! 0;
      |DDEFECTO #dsfa0010;
      |GRABA 020#dsfa0010.n;
   |FINSI;

   |CLS;
   |PINPA #0#0; |PINDA #0#0;
   |ENDATOS #1#0;
   |SI FSalida = 0;
      |GRABA 020#dsfa0010.a;
      |HAZ Tipo3;
   |FINSI;
   |CIERRA #dsfa0010;
|FPRO;
