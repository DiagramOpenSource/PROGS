ANULADO 2/4/2013



|FICHEROS;
     vigz0038 #0;
     vigw0019 #1; ||Tmp
     vigm0029 #29;
     vigm0030 #30;
     vigm0031 #31;
     agifa010 #10;
     agifa071 #71;
     agifa084 #84;
     agifa069 #69;
     agifa019 #19;
     agifa024 #24;
     agifa120 #120;
     vigm0043 #43;
|FIN;

|VARIABLES;
     nSwCtrlComi = 0;
     nPreUltimo = 0;
     nEscala = 0;
     nDife = 0;
     nPreResul = 0;
     nPreEncontrado = 0;
     nPreDesde = 0;
     nPreHasta = 0;
     aDes = "";
     aClave = "";
     nUni = 0;
     &Tempo = "";
     nImpo = 0;
     nComi = 0;
     &aDivisa = "";
     &aMoneda = "";
     nPrecio = 0;
     nAbo = 0;
     aRepre = "";
|FIN;

|PROCESO Tmp;
     |SI #1#7 = "S";
          nComi = 0;
          nUni = #1#3;
          nAbo = 1;
          |SI nUni < 0;
               nUni = -nUni;
               nAbo = -1;
          |FINSI;
          #30#0 = #1#1
          #30#1 = #1#6;
          #30#14 = #1#0;
          |LEE 000#30=;
          |SI FSalida = 0;
               |SI nUni >     0; |Y nUni [ #30#2; nComi = #30#3; |FINSI;
               |SI nUni > #30#2; |Y nUni [ #30#4; nComi = #30#5; |FINSI;
               |SI nUni > #30#4; |Y nUni [ #30#6; nComi = #30#7; |FINSI;
               |SI nUni > #30#6; |Y nUni [ #30#8; nComi = #30#9; |FINSI;
               |SI nUni > #30#8; |Y nUni [ #30#10; nComi = #30#11; |FINSI;
               |SI nUni > #30#10; |Y nUni [ #30#12; nComi = #30#13; |FINSI;
               |SI nUni > #30#12; |Y #30#12 > 0; nComi = #30#13; |FINSI;
          |FINSI;

          |SI nComi ! 0;
               nUni = nUni * nAbo;
               nImpo = nUni / 1000 * nComi;
               #1#2 = nComi;
               #1#4 = nImpo;
          |FINSI;
     |FINSI;

     |PRINT;
|FPRC;

|DEFBUCLE Tmp;
     #1#2;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Tmp;
|FIN;


|PROCESO Escalado;
     |SI nPreDesde = -1;
          nPreDesde = 0;
          nPreHasta = #31#3;
          nEscala = 1;
     |SINO;
          nPreDesde = nPreHasta;
          nPreHasta = #31#3;
          nEscala = 2;
     |FINSI;
     |SI nPrecio ] nPreDesde; |Y nPrecio [ nPreHasta;
          nPreEncontrado = #31#3;
          |SI nEscala = 2;
               nDife = (nPreHasta - nPreDesde) / 2;
               nPreResul = nPreDesde + nDife;
               |SI nPrecio [ nPreResul;
                    |LEE 000#31a;
                    nPreEncontrado = #31#3;
               |FINSI;
          |FINSI;
          |ERROR10;
     |FINSI;
     nPreUltimo = #31#3;
|FPRC;

|DEFBUCLE Escalado;
     #31#1;
     ;
     aRepre, #19#0, #24#158, -9999999.999;
     aRepre, #19#0, #24#158, 9999999.999;
     ;
     NULL, Escalado;
|FIN;

|PROCESO Facturas;
     nSwCtrlComi = 0;

     |DDEFECTO #19;
     #19#0 = #69#2;
     |LEE 000#19=;

     |DDEFECTO #120;
     #120#0 = #19#3;
     |LEE 000#120=;

     |DDEFECTO #24;
     #24#0 = #84#3;
     |LEE 000#24=;

     nPrecio = #84#6;

     nComi = -1;

     nUni = #69#5 / 1000;
     |SI nUni < 0;
          nUni = -nUni;
     |FINSI;

     aRepre = #84#6;
     nPreDesde = -1;
     nPreEncontrado = -1;
     |BUCLE Escalado;
     |SI nPreDesde ! -1; |Y nPreEncontrado = -1;
          nPreEncontrado = nPreUltimo;
     |FINSI;
     |SI nPreEncontrado ! -1;
          |ABRE #31;
          #31#0 = #84#6;
          #31#1 = #19#0;
          #31#2 = #24#158;
          #31#3 = nPreEncontrado;
          |LEE 000#31=;
          |SI FSalida = 0;
               |SI nUni ] #31#4; |Y nUni [ #31#5; nComi = #31#6; |FINSI;
               |SI nUni ] #31#7; |Y nUni [ #31#8; nComi = #31#9; |FINSI;
               |SI nUni ] #31#10; |Y nUni [ #31#11; nComi = #31#12; |FINSI;
               |SI nUni ] #31#13; |Y nUni [ #31#14; nComi = #31#15; |FINSI;
               |SI nUni ] #31#16; |Y nUni [ #31#17; nComi = #31#18; |FINSI;
               |SI nUni ] #31#19; |Y nUni [ #31#20; nComi = #31#21; |FINSI;
               aClave = #19#0;
               aDes = #19#1;
          |FINSI;
          |CIERRA #31;
     |FINSI;

     |SI nComi = -1;
          #30#0 = #19#3;
          #30#1 = #24#158;
          #30#14 = #84#6;
          |LEE 000#30=;
          |SI FSalida = 0;
               nComi = 0;
               nSwCtrlComi = 1;
          |FINSI;
          aClave = #120#0;
          aDes = #120#1;
     |FINSI;

     |SI nComi ! -1;
          nImpo = #69#5 / 1000 * nComi;
          |DDEFECTO #1;
          #1#0 = #84#6;
          #1#1 = aClave;
          #1#2 = nComi;
          #1#6 = #24#158;
          |LEE 101#1=;
          |SI FSalida ! 0; |GRABA 020#1b; |FINSI;
          #1#3 = #1#3 + #69#5;
          #1#4 = #1#4 + nImpo;
          #1#5 = aDes;

          |SI nSwCtrlComi = 1;
               #1#7 = "S";
          |FINSI;
          |GRABA 020#1a;
          |LIBERA #1;
     |FINSI;
|FPRC;

|PROCESO FacCab;
     aDivisa = #84#65;
     aMoneda = #84#67;
     |HAZ Divisas084;
|FPRC;

|DEFBUCLE Facturas;
     #84#4;
     6;
     "     ", #0#2, 000001, #0#0;
     "zzzzz", #0#3, 999999, #0#0;
     ;
     NULL, FacCab, Facturas;
|FIN;

|PROCESO Albaranes;
     nSwCtrlComi = 0;

     |DDEFECTO #19;
     #19#0 = #71#2;
     |LEE 000#19=;

     |DDEFECTO #120;
     #120#0 = #19#3;
     |LEE 000#120=;

     |DDEFECTO #24;
     #24#0 = #10#3;
     |LEE 000#24=;

     nPrecio = #71#6;

     nComi = -1;

     nUni = #71#5 / 1000;
     |SI nUni < 0;
          nUni = -nUni;
     |FINSI;

     aRepre = #10#6;
     nPreDesde = -1;
     nPreEncontrado = -1;
     |BUCLE Escalado;
     |SI nPreDesde ! -1; |Y nPreEncontrado = -1;
          nPreEncontrado = nPreUltimo;
     |FINSI;
     |SI nPreEncontrado ! -1;
          |ABRE #31;
          #31#0 = #10#6;
          #31#1 = #19#0;
          #31#2 = #24#158;
          #31#3 = nPreEncontrado;
          |LEE 000#31=;
          |SI FSalida = 0;
               |SI nUni ] #31#4; |Y nUni [ #31#5; nComi = #31#6; |FINSI;
               |SI nUni ] #31#7; |Y nUni [ #31#8; nComi = #31#9; |FINSI;
               |SI nUni ] #31#10; |Y nUni [ #31#11; nComi = #31#12; |FINSI;
               |SI nUni ] #31#13; |Y nUni [ #31#14; nComi = #31#15; |FINSI;
               |SI nUni ] #31#16; |Y nUni [ #31#17; nComi = #31#18; |FINSI;
               |SI nUni ] #31#19; |Y nUni [ #31#20; nComi = #31#21; |FINSI;
               aClave = #19#0;
               aDes = #19#1;
          |FINSI;
          |CIERRA #31;
     |FINSI;

     |SI nComi = -1;
          #30#0 = #19#3;
          #30#1 = #24#158;
          #30#14 = #10#6;
          |LEE 000#30=;
          |SI FSalida = 0;
               nComi = 0;
               nSwCtrlComi = 1;
          |FINSI;
          aClave = #120#0;
          aDes = #120#1;
     |FINSI;

     |SI nComi ! -1;
          nImpo = #71#5 / 1000 * nComi;
          |DDEFECTO #1;
          #1#0 = #10#6;
          #1#1 = aClave;
          #1#2 = nComi;
          #1#6 = #24#158;
          |LEE 101#1=;
          |SI FSalida ! 0; |GRABA 020#1b; |FINSI;
          |SI #10#43 = "S";
               #1#3 = #1#3 + #71#5;
               #1#4 = #1#4 + nImpo;
          |SINO;
               #1#3 = #1#3 + #71#5;
               #1#4 = #1#4 + nImpo;
          |FINSI;
          #1#5 = aDes;
          |SI nSwCtrlComi = 1;
               #1#7 = "S";
          |FINSI;
          |GRABA 020#1a;
          |LIBERA #1;
     |FINSI;
|FPRC;

|PROCESO AlbCab;
     aDivisa = #10#68;
     aMoneda = #10#70;
     |HAZ Divisas010;
|FPRC;

|DEFBUCLE Albaranes;
     #10#4;
     6,43, 38;
     "     ", #0#2, 000001, #0#0, "N", "S";
     "zzzzz", #0#3, 999999, #0#0, "N", "S";
     ;
     NULL, AlbCab, Albaranes;
|FIN;

|PROCESO HistoTras;
     nSwCtrlComi = 0;

     |DDEFECTO #19;
     #19#0 = #43#12;
     |LEE 000#19=;

     |DDEFECTO #120;
     #120#0 = #19#3;
     |LEE 000#120=;

     |DDEFECTO #24;
     #24#0 = #43#8;
     |LEE 000#24=;

     nPrecio = #43#14;

     nComi = -1;

     nUni = #43#13 / 1000;
     |SI nUni < 0;
          nUni = -nUni;
     |FINSI;

     aRepre = #43#10;
     nPreDesde = -1;
     nPreEncontrado = -1;
     |BUCLE Escalado;
     |SI nPreDesde ! -1; |Y nPreEncontrado = -1;
          nPreEncontrado = nPreUltimo;
     |FINSI;
     |SI nPreEncontrado ! -1;
          |ABRE #31;
          #31#0 = #43#10;
          #31#1 = #19#0;
          #31#2 = #24#158;
          #31#3 = nPreEncontrado;
          |LEE 000#31=;
          |SI FSalida = 0;
               |SI nUni ] #31#4; |Y nUni [ #31#5; nComi = #31#6; |FINSI;
               |SI nUni ] #31#7; |Y nUni [ #31#8; nComi = #31#9; |FINSI;
               |SI nUni ] #31#10; |Y nUni [ #31#11; nComi = #31#12; |FINSI;
               |SI nUni ] #31#13; |Y nUni [ #31#14; nComi = #31#15; |FINSI;
               |SI nUni ] #31#16; |Y nUni [ #31#17; nComi = #31#18; |FINSI;
               |SI nUni ] #31#19; |Y nUni [ #31#20; nComi = #31#21; |FINSI;
               aClave = #19#0;
               aDes = #19#1;
          |FINSI;
          |CIERRA #31;
     |FINSI;

     |SI nComi = -1;
          #30#0 = #19#3;
          #30#1 = #24#158;
          #30#14 = #43#10;
          |LEE 000#30=;
          |SI FSalida = 0;
               nComi = 0;
               nSwCtrlComi = 1;
          |FINSI;
          aClave = #120#0;
          aDes = #120#1;
     |FINSI;

     |SI nComi ! -1;
          nImpo = #43#13 / 1000 * nComi;
          |DDEFECTO #1;
          #1#0 = #43#10;
          #1#1 = aClave;
          #1#2 = nComi;
          #1#6 = #24#158;
          |LEE 101#1=;
          |SI FSalida ! 0; |GRABA 020#1b; |FINSI;
          |SI #10#43 = "S";
               #1#3 = #1#3 + #43#13;
               #1#4 = #1#4 + nImpo;
          |SINO;
               #1#3 = #1#3 + #43#13;
               #1#4 = #1#4 + nImpo;
          |FINSI;
          #1#5 = aDes;
          |SI nSwCtrlComi = 1;
               #1#7 = "S";
          |FINSI;
          |GRABA 020#1a;
          |LIBERA #1;
     |FINSI;
|FPRC;

|DEFBUCLE HistoTras;
     #43#3;
     10;
     #0#2, #0#0;
     #0#3, #0#0;
     ;
     NULL, HistoTras;
|FIN;

|PROCESO Tipo3; |TIPO 3;
     |HAZ DecimalesBase;

     Impresora = "Crystal Reports";
     |IMPRE 0;
     |SI FSalida = 0;
          |INFOR "vigz0038";
          |SI FSalida = 0;
               |HAZ CreaTempo; |NOME_DAT #1#Tempo#; |DELINDEX #1;

               |ABRE #29;
               #29#0 = #0#0;
               |LEE 000#29=;
               |CIERRA #29;

               |ABRE #1;
               |ABRE #30;
               |ABRE #31;
               |ABRE #19;
               |ABRE #24;
               |ABRE #120;
               |BUCLE Albaranes;
               |BUCLE HistoTras;
               |BUCLE Facturas;
               |CIERRA #120;
               |CIERRA #24;
               |CIERRA #19;
               |CIERRA #31;
               |CIERRA #1;
               |BUCLE Tmp;
               |CIERRA #30;
               |PIEINF;
               |FININF;
               |HAZ BoraTempo; |DELINDEX #1;
          |SINO;
               |MENAV "0000Error en informe 'vigz0038'";
          |FINSI;
          |FINIMP;
     |FINSI;
|FPRC;
