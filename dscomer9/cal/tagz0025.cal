|FICHEROS;
     tagz0025 #0;
     tagm0084 #84;
     tagm0087 #87;
     tagm0088 #88;
     agifa077 #77;
     agifa079 #79;
|FIN;

|VARIABLES;
     aUsu = "";
     aBat = "";
     nHandle = 0;
     {1}aLocal = "";
     aNom = "";
     aNum = "";
     aAno = "";
     aSuAlb = "";
     aSuFac = "";
     aSiglas = "";
     aFijo = "";
     aExe = "";
     aPath = "";
     nPos = 0;
     i = 0;
     aCar = "";
     aLon = "";
     aPathExe = "";
     aParam = "";
     aTipo = "";
     aCli = "";
     aPrv = "";
     aSer = "";
     nNum = "";
     aAlfa = "";
     aEmpresa = "30";
 {-1}aMenuCli  = "";
     aMenuCli1 = "2400";
     aMenuCli2 = "1";
     aMenuCli3 = "";
     aMenuCli4  = "012345";
     aMenuCli5  = "Documentos";
     aMenuCli6  = "Albaranes";
     aMenuCli7  = "Correos";
     aMenuCli8  = "Documentos Cobros";
     aMenuCli10  = "Facturas";
     aMenuCli11  = "Presupuestos/Pedidos Aceptados";

 {-1}aMenuPrv  = "";
     aMenuPrv1 = "2400";
     aMenuPrv2 = "1";
     aMenuPrv3 = "";
     aMenuPrv4  = "01234";
     aMenuPrv5  = " Documentos ";
     aMenuPrv6  = " Albaranes Compras ";
     aMenuPrv7  = " Correos ";
     aMenuPrv8  = " Documentos Pagos ";
     aMenuPrv9  = " Facturas Compras ";
|FIN;

|PROCESO PinParam;
     |SI #87#7 = "S";
          |PUSHV 0501 2380;
          |DDEFECTO #0;
          aLon = aExe % A0;
          #0#0 = aExe % 160; aExe = aExe % 61;
          |SI aLon > 60;
               #0#1 = aExe % 160; aExe = aExe % 61;
               |SI aLon > 120;
                    #0#2 = aExe % 160; aExe = aExe % 61;
                    |SI aLon > 180;
                         #0#3 = aExe % 160;
                    |FINSI;
               |FINSI;
          |FINSI;
          |PINPA #0#0;
          |PINDA #0#0;
          |PAUSA;
          |POPV;
     |FINSI;
|FPRC;

|PROCESO CambiaBarra;
     aAlfa = "";
     aLon = aPath % A0;
     |PARA i = 1; |SI i [ aLon; |HACIENDO i = i + 1;
          nPos = i * 100 + 1;
          aCar = aPath % nPos;
          |SI aCar = "/"; aCar = "\"; |FINSI;
          aAlfa = aAlfa + aCar;
     |SIGUE;
     aPath = aAlfa;
|FPRC;

|PROGRAMA;
     |PULSATECLA;
     aParam = PARAMETRO;
     aAlfa = aParam % 101;
     |SI aAlfa = "W";
          aTipo = aParam % 103;
          aParam = aParam % 4;
     |SINO;
          aTipo = aParam % 102;
          aParam = aParam % 3;
     |FINSI;

     aAlfa = Usuario % 810;
     |ABRE #84;
     #84#0 = aAlfa;
     |LEE 000#84=;
     |SI FSalida ! 0; |DDEFECTO #84; |FINSI;
     |CIERRA #84;
     aSiglas = #84#6;


     |ABRE #87; |LEE 000#87p; |CIERRA #87;
     aPathExe = #87#4; |QBF aPathExe;
     aAlfa = aPathExe % -101;
     aPath = aPathExe; |HAZ CambiaBarra; aPathExe = aPath;

     |SI aTipo = "CL";
          |PARA FSalida = 1; |SI FSalida > 0; |HACIENDO;
               aCli = aParam;
               aFijo = "AVCL";
               |MENU aMenuCli;
               aMenuCli2 = FSalida;
               |SI FSalida [ 0; |SAL; |FINSI;
               |SI FSalida = 1;
                    aExe = aPathExe + "callercarpetas.exe "+ &34 + aFijo + aEmpresa + aCli + &34 + " " + aSiglas;
               |FINSI;
               |SI FSalida = 2;
                    aExe = aPathExe + "openidocfolder /CARSQL=" + &34 + aFijo + aEmpresa + aCli + "AL" + &34;
               |FINSI;
               |SI FSalida = 3;
                    aExe = aPathExe + "openidocfolder /CARSQL=" + &34 + aFijo + aEmpresa + aCli + "CO" + &34;
               |FINSI;
               |SI FSalida = 4;
                    aExe = aPathExe + "openidocfolder /CARSQL=" + &34 + aFijo + aEmpresa + aCli + "DC" + &34;
               |FINSI;
               |SI FSalida = 5;
                    aExe = aPathExe + "openidocfolder /CARSQL=" + &34 + aFijo + aEmpresa + aCli + "FA" + &34;
               |FINSI;
               |SI FSalida = 6;
                    aExe = aPathExe + "openidocfolder /CARSQL=" + &34 + aFijo + aEmpresa + aCli + "PA" + &34;
               |FINSI;
               |HAZ PinParam;
               ||RSYSTEM aExe;
               |HAZ System;
          |SIGUE;
     |FINSI;

     |SI aTipo = "PR";
          |PARA FSalida = 1; |SI FSalida > 0; |HACIENDO;
               aPrv = aParam;
               aFijo = "ACPR";
               |MENU aMenuPrv;
               aMenuPrv2 = FSalida;
               |SI FSalida [ 0; |SAL; |FINSI;
               |SI FSalida = 1;
                    aExe = aPathExe + "callercarpetas.exe " + &34 + aFijo + aEmpresa + aPrv + &34 + " " + aSiglas;
               |FINSI;
               |SI FSalida = 2;
                    aExe = aPathExe + "openidocfolder /CARSQL=" + &34 + aFijo + aEmpresa + aPrv + "AL" + &34;
               |FINSI;
               |SI FSalida = 3;
                    aExe = aPathExe + "openidocfolder /CARSQL=" + &34 + aFijo + aEmpresa + aPrv + "CO" + &34;
               |FINSI;
               |SI FSalida = 4;
                    aExe = aPathExe + "openidocfolder /CARSQL=" + &34 + aFijo + aEmpresa + aPrv + "DP" + &34;
               |FINSI;
               |SI FSalida = 5;
                    aExe = aPathExe + "openidocfolder /CARSQL=" + &34 + aFijo + aEmpresa + aPrv + "FA" + &34;
               |FINSI;
               |HAZ PinParam;
               ||RSYSTEM aExe;
               |HAZ System;
          |SIGUE;
     |FINSI;

     |SI aTipo = "AC";
          aSer = aParam % 105;
          aAlfa = aParam % 6;
          nNum = aAlfa;

          |ABRE #77;
          #77#50 = aSer;
          #77#0 = nNum;
          |LEE 000#77=;
          |CIERRA #77;
          aAno = #77#1 % 704;
          aPrv = #77#3;
          aSuAlb = #77#54;

          aExe = aPathExe + "cobete.exe -R:" + &34 + "A/"  + aAno + "/" + aEmpresa + aPrv + "/" + aSuAlb + &34;
          |HAZ PinParam;
          ||RSYSTEM aExe;
          |HAZ System;
     |FINSI;

     |SI aTipo = "FC";
          aSer = aParam % 105;
          aAlfa = aParam % 6;
          nNum = aAlfa;

          |ABRE #79;
          #79#66 = aSer;
          #79#0 = nNum;
          |LEE 000#79=;
          |CIERRA #79;
          aAno = #79#1 % 704;
          aPrv = #79#2;
          aSuFac = #79#74;

          aExe = aPathExe + "cobete.exe -R:" + &34 + "F/"  + aAno + "/" + aEmpresa + aPrv + "/" + aSuFac + &34;
          |HAZ PinParam;
          ||RSYSTEM aExe;
          |HAZ System;
     |FINSI;

     |SI aTipo = "PV";
          aSer = aParam % 105;
          aAlfa = aParam % 6;
          nNum = aAlfa;

          |ABRE #88;
          #88#0 = aSer;
          |LEE 000#88=;
          |CIERRA #88;

          aAlfa = aSer % 102;
          aNum = ("000000" + nNum) % -106;
          aNom = aEmpresa + aAlfa + aNum;
          aExe = aPathExe + "cobete.exe -R:" + &34 + "50/" + aNom + &34;
          |HAZ PinParam;
          ||RSYSTEM aExe;
          |HAZ System;
     |FINSI;

     |SI aTipo = "AV";
          aSer = aParam % 105;
          aAlfa = aParam % 6;
          nNum = aAlfa;

          |ABRE #88;
          #88#0 = aSer;
          |LEE 000#88=;
          |CIERRA #88;

          aAlfa = ("00" + #88#1) % -102;
          aNum = ("0000000" + nNum) % -107;
          aNom = aEmpresa + aAlfa + aNum;

          aExe = aPathExe + "cobete.exe -R:" + &34 + "90/" + aNom + &34;
          |HAZ PinParam;
          ||RSYSTEM aExe;
          |HAZ System;
     |FINSI;

     |SI aTipo = "FV";
          aSer = aParam % 105;
          aAlfa = aParam % 6;
          nNum = aAlfa;

          |ABRE #88;
          #88#0 = aSer;
          |LEE 000#88=;
          |CIERRA #88;

          aAlfa = ("00" + #88#1) % -102;
          aNum = ("0000000" + nNum) % -107;
          aNom = aEmpresa + aAlfa + aNum;

          aExe = aPathExe + "cobete.exe -R:" + &34 + "80/" + aNom + &34;
          |HAZ PinParam;
          ||RSYSTEM aExe;
          |HAZ System;
     |FINSI;
     ||---------------------Workflow
     |SI aTipo = "WPV";
          aSer = aParam % 102;
          aAlfa = aParam % 6;
          nNum = aAlfa;
          aNum = ("000000" + nNum) % -106;

          aUsu = Usuario % 810; |QBF aUsu;
          aAlfa = "50/30" + aSer + aNum;

          aExe = aPathExe + "docusers.exe /CLAVEOLD:" + aAlfa + " /USUARIO:" + aUsu;
          |HAZ PinParam;
          |HAZ System;
     |FINSI;
     |SI aTipo = "WPR";
          aSer = aParam % 102;
          aAlfa = aParam % 6;
          nNum = aAlfa;
          aNum = ("000000" + nNum) % -106;

          aUsu = Usuario % 810; |QBF aUsu;
          aAlfa = "51/30" + aSer + aNum;

          aExe = aPathExe + "docusers.exe /CLAVEOLD:" + aAlfa + " /USUARIO:" + aUsu;
          |HAZ PinParam;
          |HAZ System;
     |FINSI;

     |SI aTipo = "WAV";
          aSer = aParam % 102;
          aAlfa = aParam % 6;
          nNum = aAlfa;
          aNum = ("000000" + nNum) % -106;

          aUsu = Usuario % 810; |QBF aUsu;
          aAlfa = "90/30" + aSer + aNum;

          aExe = aPathExe + "docusers.exe /CLAVEOLD:" + aAlfa + " /USUARIO:" + aUsu;
          |HAZ PinParam;
          |HAZ System;
     |FINSI;

     |PULSATECLA;
|FPRO;

|PROCESO System;
     |ESPECIFICA "RBASS", aLocal;
     aBat = aLocal;
     aBat = aBat + "tmp/";
     |RMKDIR aBat;
     aBat = aBat + Usuario + ".bat";

     |XABRE "WC", aBat, nHandle;
     |XGRABA nHandle, "@echo off";
     |XGRABA nHandle, aExe;
     |XGRABA nHandle, "exit";
     |XCIERRA nHandle;

||     aAlfa = "cmd " + &34 + "/c START /MIN /WAIT " + aBat + &34;
     aAlfa = "cmd " + &34 + "/c START /MIN " + aBat + &34;
     |RSYSTEM aAlfa;
|FPRC;
