|FICHEROS;
     albad010 #0;
     albad011 #1; ||Tmp
     albad012 #2; ||Tmp
     albad013 #3; ||Tmp
     albad014 #4; ||Tmp
     albad042 #5; ||Tmp

     albad003 #30; || Albaran
     albad002 #12; ||GCC

     agifa024 #24;
     agifa010 #10;
     agifa071 #71;
     agifa019 #19;
     agifa077 #77;
     agifa080 #80;
     agifa084 #84;
     agifa069 #69;
|FIN;

|VARIABLES;
     aEnvase = "";
     aGraba = "";
     nUni      = 0;
     nConta    = 0;
     aAbo      = "N";
     aBlanco   = "";
     fFecha    = ~;
     aFic      = "";
     aPath     = "";
     aFinReg   = "";
     aAlf1     = "";
     aTipo     = "";
     nLon      = 0;
     aAlfa     = "";
     nVto      = 0;
     nNu1      = 0;
     nNu2      = 0;
     nPos      = 0;
     nNume     = 0;
     nDec      = 0;
     nHandle   = 0;
     para1     = 0;

     nPromo = 0;
     nDevu = 0;
     nRegalo = 0;
     nVenta = 0;
     nImpPromo = 0;
     nImpDevu = 0;
     nImpRegalo = 0;
     nImpVenta = 0;
     nImpBoni = 0;
|FINSI;

|CALCULO pasacli;
|C_M #0#5,1,"N";
|PARA para1 = 6;|SI para1 [ 15;|HACIENDO para1 = para1 + 1;
      |C_M #0para1,1,"N";
|SIGUE;
|SI #0#4 = "S";
    |C_M #0#5,1,"S";
    |PARA para1 = 6;|SI para1 [ 15;|HACIENDO para1 = para1 + 1;
          |C_M #0para1,1,"S";
    |SIGUE;
|FINSI;
|FCAL;

|CALCULO pasaalb;
|C_M #0#18,1,"N";
|C_M #0#19,1,"N";
|C_M #0#20,1,"N";
|C_M #0#58,1,"N";
|PARA para1 = 21;|SI para1 [ 30;|HACIENDO para1 = para1 + 1;
      |C_M #0para1,1,"N";
|SIGUE;
|SI #0#17 = "S";
    |C_M #0#18,1,"S";
    |C_M #0#19,1,"S";
    |C_M #0#20,1,"S";
    |C_M #0#58,1,"S";
    |PARA para1 = 21;|SI para1 [ 30;|HACIENDO para1 = para1 + 1;
          |C_M #0para1,1,"S";
    |SIGUE;
|FINSI;
|FCAL;

|CALCULO pasaalm;
|C_M #0#33,1,"N";
|PARA para1 = 34;|SI para1 [ 37;|HACIENDO para1 = para1 + 1;
      |C_M #0para1,1,"N";
|SIGUE;
|SI #0#32 = "S";
    |C_M #0#33,1,"S";
    |PARA para1 = 34;|SI para1 [ 37;|HACIENDO para1 = para1 + 1;
          |C_M #0para1,1,"S";
    |SIGUE;
|FINSI;
|FCAL;

|CALCULO pasaven;
|C_M #0#40,1,"N";
|PARA para1 = 41;|SI para1 [ 52;|HACIENDO para1 = para1 + 1;
      |C_M #0para1,1,"N";
|SIGUE;
|SI #0#39 = "S";
    |C_M #0#40,1,"S";
    |PARA para1 = 41;|SI para1 [ 52;|HACIENDO para1 = para1 + 1;
          |C_M #0para1,1,"S";
    |SIGUE;
|FINSI;
|FCAL;

|PROCESO pasacon;
     aAlfa = #0#61;
     |C_M #0#60, 1, aAlfa;
     |PARA para1 = 62;|SI para1 [ 69;|HACIENDO para1 = para1 + 1;
          |C_M #0para1, 1, aAlfa;
     |SIGUE;
|FPRC;

ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
|PROCESO Relleno;
     |SI aTipo = "F";
          ||Formato ddmmaaaa
          ||aAlfa = (aAlfa % 102) + (aAlfa % 402) + (aAlfa % -104);

          ||Formato aaaammdd
          aAlfa = (aAlfa % -104) + (aAlfa % 402) + (aAlfa % 102);
     |FINSI;
     |SI aTipo = "A";
          aAlf1 = " " * nLon;
          aAlfa = aAlfa + aAlf1;
          nPos = nLon + 100;
          aAlfa = aAlfa % nPos;
     |FINSI;
     |SI aTipo = "N";
          nNume = aAlfa;
          |SI nNume < 0; nNume = nNume * - 1; |FINSI;
          nNu1 = nNume ! 0;
          |SI nNu1 > nNume; nNu1 = nNu1 - 1; |FINSI;
          nNu2 = nNume - nNu1;
          aAlf1 = "0" * nLon;
          |SI nDec = 0;
               aAlfa = nNu1;
          |SINO;
               aAlfa = nNu2;
               aAlfa = aAlfa + aAlf1;
               nPos = nDec + 300;
               aAlfa = aAlfa % nPos;
||
||  SIN PUNTO DECIMAL
||             aAlfa = nNu1 + "." + aAlfa;
||
               aAlfa = nNu1 + aAlfa;
          |FINSI;
          aAlfa = aAlf1 + aAlfa;
          nPos = -1 * (nLon + 100);
          aAlfa = aAlfa % nPos;
          nDec = 0;
     |FINSI;
     |XGRABA nHandle, aAlfa;
|FPRC;
ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
|PROCESO Contado;
     |SI #69#45 = -1;
          |ACABA; ||Linea Promocion
     |FINSI;

     |DDEFECTO #19;
     #19#0 = #69#2;
     |LEE 000#19=;
     |DDEFECTO #12;
     #12#0 = #19#0;
     |LEE 000#12=;

     |SI #12#1 = 0; |ACABA; |FINSI;

     nPromo = 0; nDevu = 0; nRegalo = 0; nVenta = 0; nImpPromo = 0;
     nImpDevu = 0; nImpRegalo = 0; nImpVenta = 0; nImpBoni = 0;

     |SI #69#5 < 0;
          nDevu = -#69#5;
          nImpDevu = -#69#9;
     |SINO;
          nVenta = #69#5;
          nImpVenta = #69#5 * #69#6;
     |FINSI;

     |SALVA_FICHA #69;
     #69#1 = #69#45;
     |LEE 000#69=;
     |SI FSalida =0;
          nPromo = #71#5;
          nImpPromo = #71#5 * #69#6;
          nImpBoni = #71#46;
     |FINSI;
     |REPON_FICHA #69;

     |DDEFECTO #1;
     #1#0 = #84#3;
     #1#1 = #69#2;
     |LEE 101#1=;
     |SI FSalida ! 0; |GRABA 020#1b; |FINSI;

     #1#2 = #1#2 + nVenta;
     #1#3 = #1#3 + nDevu;
     #1#4 = #1#4 + nPromo;
     #1#5 = #1#5 + nRegalo;
     #1#6 = #1#6 + nImpVenta;
     #1#7 = #1#7 + nImpDevu;
     #1#8 = #1#8 + nImpPromo;
     #1#9 = #1#9 + nImpRegalo;
     #1#10 = #1#10 + (nImpBoni * #69#5);
     #1#11 = "EUR";
     #1#12 = #12#1;
     aAlfa = #84#1; aAlfa = aAlfa % -104; ||A¤o
     #1#13 = aAlfa;
     aAlfa = #84#1; aAlfa = aAlfa % 402; ||Mes
     #1#14 = aAlfa;
     |GRABA 020#1a;
     |LIBERA #1;
|FPRC;

|PROCESO TmpAlma;
     |DDEFECTO #19;
     #19#0 = #4#0;
     |LEE 000#19=;
     |DDEFECTO #12;
     #12#0 = #19#0;
     |LEE 000#12=;

||CONCES    Núm. 10
     aAlfa = #0#0;
     aTipo = "N"; nLon = 10; |HAZ Relleno;

||AÑO  Núm. 4
     aAlfa = #0#34;  aAlfa = aAlfa % -104;
     aTipo = "N"; nLon = 4; |HAZ Relleno;

||MES  Núm. 2
     aAlfa = #0#34;  aAlfa = aAlfa % 402;
     aTipo = "N"; nLon = 2; |HAZ Relleno;

||PRODUCTO  Núm. 18
     aAlfa = #12#1;
     aTipo = "N"; nLon = 18; |HAZ Relleno;

||SEXINICIO Núm. 1
     nNume = #4#3 - #4#1;
     |SI nNume ] 0; aAlfa = "0"; |SINO; aAlfa = "1"; |FINSI;
     aTipo = "N"; nLon = 1; |HAZ Relleno;

||EXINICIAL Núm. 15,3
     nNume = #4#3 - #4#1;
     aAlfa = nNume;
     aTipo = "N"; nLon = 15; nDec = 3; |HAZ Relleno;

||SENTRADA  Núm. 1
     |SI #4#4 ] 0; aAlfa = "0"; |SINO; aAlfa = "1"; |FINSI;
     aTipo = "N"; nLon = 1; |HAZ Relleno;

||ENTRADAS  Núm. 15,3
     aAlfa = #4#4;
     aTipo = "N"; nLon = 15; nDec = 3; |HAZ Relleno;

||SISALIDAS Núm. 1
     |SI #4#2 ] 0; aAlfa = "0"; |SINO; aAlfa = "1"; |FINSI;
     aTipo = "N"; nLon = 1; |HAZ Relleno;

||SALIDAS   Núm. 15,3
     aAlfa = #4#2;
     aTipo = "N"; nLon = 15; nDec = 3; |HAZ Relleno;

||SEXIFINAL Núm. 1
     nNume = #4#3 + #4#4 - #4#1 - #4#2;
     |SI nNume ] 0; aAlfa = "0"; |SINO; aAlfa = "1"; |FINSI;
     aTipo = "N"; nLon = 1; |HAZ Relleno;

||EXFINAL   Núm. 15,3
     nNume = #4#3 + #4#4 - #4#1 - #4#2;
     aAlfa = nNume;
     aTipo = "N"; nLon = 15; nDec = 3; |HAZ Relleno;

||DIATRANSM Núm. 2
     aAlfa = "99";
     aTipo = "N"; nLon = 2; |HAZ Relleno;
|FPRC;

|DEFBUCLE TmpAlma;
     #4#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, TmpAlma;
|FIN;

|PROCESO AlbaCom;
     |SI #80#2 < #0#36; |O #80#2 > #0#37;
          |ACABA;
     |FINSI;

     |DDEFECTO #19;
     #19#0 = #80#2;
     |LEE 000#19=;
     |DDEFECTO #12;
     #12#0 = #19#0;
     |LEE 000#12=;
     |SI #12#1 = 0; |ACABA; |FINSI;

     |DDEFECTO #4;
     #4#0 = #80#2;
     |LEE 101#4=;
     |SI FSalida ! 0; |GRABA 020#4b; |FINSI;

     |SI #77#42 = "S";
          nUni = -#80#5;
     |SINO;
          nUni = #80#5;
     |FINSI;

     |SI #77#1 < #0#34; ||Antes
          #4#3 = #4#3 + nUni;
     |SINO;
          #4#4 = #4#4 + nUni;
     |FINSI;

     |GRABA 020#4a;
     |LIBERA #4;
|FPRC;

|PROCESO AlbaVta;
     |SI #71#2 < #0#36; |O #71#2 > #0#37;
          |ACABA;
     |FINSI;

     |DDEFECTO #19;
     #19#0 = #71#2;
     |LEE 000#19=;
     |DDEFECTO #12;
     #12#0 = #19#0;
     |LEE 000#12=;
     |SI #12#1 = 0; |ACABA; |FINSI;

     |DDEFECTO #4;
     #4#0 = #71#2;
     |LEE 101#4=;
     |SI FSalida ! 0; |GRABA 020#4b; |FINSI;

     |SI #10#43 = "S";
          nUni = -#71#5;
     |SINO;
          nUni = #71#5;
     |FINSI;

     |SI #10#1 < #0#34; ||Antes
          #4#1 = #4#1 + nUni;
     |SINO;
          #4#2 = #4#2 + nUni;
     |FINSI;

     |GRABA 020#4a;
     |LIBERA #4;
|FPRC;

|DEFBUCLE AlbaCom;
     #77#3;
     ;
     "      ", "01.01.0000", "     ", 000001;
     "zzzzzz", #0#35       , "zzzzz", 999999;
     ;
     NULL, NULL, AlbaCom;
|FIN;

|DEFBUCLE AlbaVta;
     #10#3;
     ;
     "      ", "01.01.0000", "     ", 000000
     "zzzzzz", #0#35,        "zzzzz", 999999;
     ;
     NULL, NULL, AlbaVta;
|FIN;

|PROCESO ElAlmacen;
     aAlfa = Usuario; |QBF aAlfa; aAlfa = "4" + aAlfa;
     |NOME_DAT #4 aAlfa;
     |DELINDEX #4;
     |ABRE #4;
     |ABRE #19;
     |ABRE #12;
     |BUCLE AlbaCom;
     |BUCLE AlbaVta;
     |CIERRA #12;
     |CIERRA #19;
     |CIERRA #4;
     aFic = aPath + #0#33; |QBF aFic;
     |XABRE "CWB", aFic, nHandle
     |SI FSalida < 0;
          aFic = "0000Error " + aFic;
          |MENAV aFic;
     |SINO;
          |ABRE #19;
          |ABRE #12;
          |BUCLE TmpAlma;
          |CIERRA #12;
          |CIERRA #19;
          |XCIERRA nHandle;
     |FINSI;

     |DELINDEX #4;
|FPRC;
ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
|PROCESO TmpAlbV5; ||ALBAT_03.DAT
     |DDEFECTO #24;
     #24#0 = #5#9;
     |LEE 000#24=;

||1    FECHAPED  Núm. 8 -> 8
     aAlfa = #5#6;
     aTipo = "F"; |HAZ Relleno;

||2    FECHAENV  Núm. 8 -> 16
     aAlfa = #0#54;
     aTipo = "F"; |HAZ Relleno;

||3    NUALRES   Char.     8 -> 24
     nNume = #0#59 + 1;
     aAlfa = ("000000" + nNume) % -106;
     aAlfa = aAlfa + "8Q";
     aTipo = "A"; nLon = 8; |HAZ Relleno;

||4    CONCESIO  Núm. 10  -> 34
     aAlfa = #0#0;
     aTipo = "N"; nLon = 10; |HAZ Relleno;

||5    NUALCLI   Char 8 -> 42
     aAlfa = "8Q";
     aAlfa = (("000000" + #5#2) % -106) + aAlfa;
     aTipo = "A"; nLon = 8; |HAZ Relleno;

||6    CODCLIE   Núm. 10
     aAlfa = #24#165; |||#5#9;
     aTipo = "N"; nLon = 10; |HAZ Relleno;

||7    TIPOCLI   Núm. 1
     aAlfa = #5#8;
     aTipo = "N"; nLon = 1; |HAZ Relleno;

||8    CLISERVI  Núm. 10
     aAlfa = #0#0;
     aTipo = "N"; nLon = 10; |HAZ Relleno;

     |XGRABA nHandle, aFinReg;
|FPRC;

|DEFBUCLE TmpAlbV5;
     #5#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, TmpAlbV5;
|FIN;

|PROCESO TmpAlbV2; ||ALBAT_02.DAT
     |DDEFECTO #19;
     #19#0 = #3#0;
     |LEE 000#19=;
     |DDEFECTO #12;
     #12#0 = #19#0;
     |LEE 000#12=;
     |DDEFECTO #24;
     #24#0 = #3#9;
     |LEE 000#24=;

||1    NUPERE    Char 8
     aAlfa = "8Q" % 102;
     aAlfa = (("000000" + #3#2) % -106) + aAlfa;
     aTipo = "A"; nLon = 8; |HAZ Relleno;

||2    CODCLI    Núm. 10
     aAlfa = #24#165; ||#3#9;
     aTipo = "N"; nLon = 10; |HAZ Relleno;

||3    FECHAPED  Núm. 8
     aAlfa = #3#6;
     aTipo = "F"; |HAZ Relleno;

||4    FECHAENV  Núm. 8
     aAlfa = #0#54;
     aTipo = "F"; |HAZ Relleno;

||5    PRODUCTO  Núm. 18
     aAlfa = #12#1;
     aTipo = "N"; nLon = 18; |HAZ Relleno;

||6    TIMOVI    Char.     1
     |SI #3#10 = "D";
          aAlfa = "D";
     |SINO;
          aAlfa = "V";
     |FINSI;
     aTipo = "A"; nLon = 1; |HAZ Relleno;

||7    SIGNOMOV  Núm. 1
     |SI #19#125 = "E "; |Y #3#4 < 0;
          aAlfa = "1";
     |SINO;
          aAlfa = "0";
     |FINSI;
     aTipo = "N"; nLon = 1; |HAZ Relleno;

||8    CANTI     Núm. 15,3
     aAlfa = #3#4;
     aTipo = "N"; nLon = 15; nDec = 3; |HAZ Relleno;

||9    NUPECO    Char.     10
     aAlfa = "";
     aTipo = "A"; nLon = 10; |HAZ Relleno;

||10   IDENTIC   Char.     10
     aAlfa = "";
     aTipo = "A"; nLon = 10; |HAZ Relleno;

     |XGRABA nHandle, aFinReg;
|FPRC;

|DEFBUCLE TmpAlbV2;
     #3#2;
     ;
     INICIO;
     FINAL;
     ;
     NULL, TmpAlbV2;
|FIN;

|PROCESO TmpAlbV1; ||ALBAT_01.DAT
     |DDEFECTO #19;
     #19#0 = #2#0;
     |LEE 000#19=;
     |DDEFECTO #12;
     #12#0 = #19#0;
     |LEE 000#12=;

||1    NUPERE    Char 8 >1-8
     nNume = #0#59 + 1;
     aAlfa = ("000000" + nNume) % -106;
     aAlfa = aAlfa + "8Q";
     aTipo = "A"; nLon = 8; |HAZ Relleno;

||2    CONCESIO  Núm. 10 > 8-18
     aAlfa = #0#0;
     aTipo = "N"; nLon = 10; |HAZ Relleno;

||3    FECHAPED  Núm. 8 > 18-24
     aAlfa = #2#1;
     aTipo = "F"; |HAZ Relleno;

||4    FECHAENV  Núm. 8 > 24-32
     aAlfa = #0#54;
     aTipo = "F"; |HAZ Relleno;

||5    PRODUCTO  Núm. 18 > 32-50
     aAlfa = #12#1;
     aTipo = "N"; nLon = 18; |HAZ Relleno;

||6    TIMOVI    Char.     1
     |SI #2#3 = "D";
          aAlfa = "D";
     |SINO;
          aAlfa = "V";
     |FINSI;
     aTipo = "A"; nLon = 1; |HAZ Relleno;

||7    SIGNOMOV  Núm. 1
     |SI #19#125 = "E "; |Y #2#2 < 0;
          aAlfa = "0";
     |SINO;
          aAlfa = "1";
     |FINSI;
     aTipo = "N"; nLon = 1; |HAZ Relleno;

||8    CANTI     Núm. 15,3
     aAlfa = #2#2;
     aTipo = "N"; nLon = 15; nDec = 3; |HAZ Relleno;

||9    NUPECO    Char.     10
     aAlfa = "";
     aTipo = "A"; nLon = 10; |HAZ Relleno;

||10   IDENTIC   Char.     10
     aAlfa = "";
     aTipo = "A"; nLon = 10; |HAZ Relleno;

     |XGRABA nHandle, aFinReg;
|FPRC;

|DEFBUCLE TmpAlbV1;
     #2#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, TmpAlbV1;
|FIN;
ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
|PROCESO AlbaranLinV;
     |DDEFECTO #19;
     #19#0 = #71#2;
     |LEE 000#19=;
     |DDEFECTO #12;
     #12#0 = #19#0;
     |LEE 000#12=;
     aAlfa = #19#111;    ||Alfanumerico2
     |QBF aAlfa;

     aAbo = "N";
     |SI #71#5 < 0; |Y #19#125 ! "E ";
          |SI aAlfa = "N";
              aAbo = "S";  ||Abono
          |SINO;
               aAbo = "D"; ||Devolucion
          |FINSI;
     |FINSI;

     |SI #0#58 = "S";    ||Abono
          |SI aAbo ! "S"; |ACABA; |FINSI;
     |SINO;
          |SI aAbo = "S"; |ACABA; |FINSI;
     |FINSI;

     aEnvase = #19#125; |QBF aEnvase;
     |SI aEnvase = "E";
          |SI #10#43 = "N";
               aGraba = "S";
               |SI #71#5 > 0;
                    aGraba = "N";
               |FINSI;
          |SINO;
               aGraba = "N";
               |SI #71#5 > 0;
                    aGraba = "S";
               |FINSI;
          |FINSI;
     |SINO;
          aGraba = "S";
     |FINSI;

     |SI aGraba = "S";
          |DDEFECTO #2;
          #2#0 = #71#2;
          |LEE 101#2=;
          |SI FSalida ! 0;
               |GRABA 020#2b;
          |FINSI;
          |SI #10#1 > #2#1;
               #2#1 = #10#1;
          |FINSI;
          #2#2 = #2#2 + #71#5;
          #2#3 = aAbo;
          |GRABA 020#2a;
          |LIBERA #2;

          |DDEFECTO #3;
          #3#0 = #71#2;
          #3#1 = #71#29;
          #3#2 = #71#0;
          |LEE 101#3=;
          |SI FSalida ! 0; |GRABA 020#3b; |FINSI;
          #3#3 = #71#1;
          #3#4 = #3#4 + #71#5;
          #3#5 = #12#1;               ||GCC
          #3#6 = #10#1;
          #3#7 = #24#167;
          #3#8 = #24#167;
          #3#9 = #10#3;
          #3#10 = aAbo;
          |GRABA 020#3a;
          |LIBERA #3;
     |FINSI;

     |DDEFECTO #5;
     #5#1 = #71#29;
     #5#2 = #71#0;
     |LEE 101#5=;
     |SI FSalida ! 0;
          nConta = nConta + 1;
          |GRABA 020#5b;
     |FINSI;
     #5#3 = #71#1;
     #5#4 = #5#4 + #71#5;
     #5#5 = #12#1;               ||GCC
     #5#6 = #10#1;
     #5#7 = #24#167;
     #5#8 = #24#167;
     #5#9 = #10#3;
     |GRABA 020#5a;
     |LIBERA #5;
|FPRC;

|PROCESO AlbaranV;
     |DDEFECTO #24;
     #24#0 = #10#3;
     |LEE 000#24=;
     aAlfa = #24#167; || Numerico1
     aAlfa = aAlfa % 101;
     |SI aAlfa < #0#29; |O aAlfa > #0#30;
          |ERROR; |ACABA;
     |FINSI;
|FPRC;

|DEFBUCLE AlbaranV;
     #10#3;
     43;
     #0#25, #0#27, #0#21, #0#23, #0#58;
     #0#26, #0#28, #0#22, #0#24, #0#58;
     ;
     NULL, AlbaranV, AlbaranLinV;
|FIN;

|PROCESO ElAlbaranV;
     aAlfa = Usuario; |QBF aAlfa; aAlfa = "2" + aAlfa;
     |NOME_DAT #2 aAlfa;
     |DELINDEX #2;
     aAlfa = Usuario; |QBF aAlfa; aAlfa = "3" + aAlfa;
     |NOME_DAT #3 aAlfa;
     |DELINDEX #3;
     aAlfa = Usuario; |QBF aAlfa; aAlfa = "5" + aAlfa;
     |NOME_DAT #5 aAlfa;
     |DELINDEX #5;

     nConta = #0#59;
     |ABRE #5;
     |ABRE #2;
     |ABRE #3;
     |ABRE #19;
     |ABRE #12;
     |ABRE #24;
     |BUCLE AlbaranV;
     |CIERRA #24;
     |CIERRA #12;
     |CIERRA #19;
     |CIERRA #3;
     |CIERRA #2;
     |CIERRA #5;

     aFic = aPath + #0#18; |QBF aFic;
     |XABRE "CWB", aFic, nHandle
     |SI FSalida < 0;
          aFic = "0000Error " + aFic;
          |MENAV aFic;
     |SINO;
          |ABRE #19;
          |ABRE #12;
          |BUCLE TmpAlbV1;
          |CIERRA #12;
          |CIERRA #19;
          |XCIERRA nHandle;
     |FINSI;

     aFic = aPath + #0#19; |QBF aFic;
     |XABRE "CWB", aFic, nHandle
     |SI FSalida < 0;
          aFic = "0000Error " + aFic;
          |MENAV aFic;
     |SINO;
          |ABRE #19;
          |ABRE #12;
          |ABRE #24;
          |BUCLE TmpAlbV2;
          |CIERRA #24;
          |CIERRA #12;
          |CIERRA #19;
          |XCIERRA nHandle;
     |FINSI;

     aFic = aPath + #0#20; |QBF aFic;
     |XABRE "CWB", aFic, nHandle
     |SI FSalida < 0;
          aFic = "0000Error " + aFic;
          |MENAV aFic;
     |SINO;
          |ABRE #19;
          |ABRE #12;
          |ABRE #2;
          |ABRE #24;
          |BUCLE TmpAlbV5;
          |CIERRA #24;
          |CIERRA #2;
          |CIERRA #12;
          |CIERRA #19;
          |XCIERRA nHandle;
     |FINSI;

     |DELINDEX #2;
     |DELINDEX #3;
     |DELINDEX #5;
|FPRC;
ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ

|PROCESO TmpAlb;
     |DDEFECTO #24;
     #24#0 = #1#0;
     |LEE 000#24=;

||CONCES             Núm.     10
     aAlfa = #0#0;
     aTipo = "N"; nLon = 10; |HAZ Relleno;

||AÑO                Núm.     4
     aAlfa = #1#13;
     aTipo = "N"; nLon = 4; |HAZ Relleno;

||MES                Núm.     2
     aAlfa = #1#14;
     aTipo = "N"; nLon = 2; |HAZ Relleno;

||TIPOCLI            Núm.     1
     aAlfa = #24#167; aAlfa = aAlfa % 101;
     aTipo = "N"; nLon = 1; |HAZ Relleno;

||DELGACLI           Núm.     2
     aAlfa = #24#168; aAlfa = aAlfa % 102;
     aTipo = "N"; nLon = 2; |HAZ Relleno;

||CLIENTE            Núm.     8
     aAlfa = #24#165; || #1#0;
     aTipo = "N"; nLon = 8; |HAZ Relleno;

||CLIENTEGCC         Núm.     10
     aAlfa = #1#0;
     aTipo = "N"; nLon = 10; |HAZ Relleno;

||MONEDA             Char.    3
     aAlfa = #1#11;
     aTipo = "A"; nLon = 3; |HAZ Relleno;

||PRODUCTO           Núm.     18
     aAlfa = #1#12;
     aTipo = "N"; nLon = 18; |HAZ Relleno;

||SCVENTA            Núm.     1
     aAlfa = "";
     aTipo = "N"; nLon = 1; |HAZ Relleno;

||CVENTA             Núm.     15,3
     aAlfa = #1#2;
     aTipo = "N"; nLon = 15; nDec = 3; |HAZ Relleno;

||SCDEVO             Núm.     1
     aAlfa = "";
     aTipo = "N"; nLon = 1; |HAZ Relleno;

||CDEVO              Núm.     15,3
     aAlfa = #1#3;
     aTipo = "N"; nLon = 15; nDec = 3; |HAZ Relleno;

||SCPROMO            Núm.     1
     aAlfa = "";
     aTipo = "N"; nLon = 1; |HAZ Relleno;

||CPROMO             Núm.     15,3
     aAlfa = #1#4;
     aTipo = "N"; nLon = 15; nDec = 3; |HAZ Relleno;

||SCREGALO           Núm.     1
     aAlfa = "";
     aTipo = "N"; nLon = 1; |HAZ Relleno;

||CREGALO            Núm.     15,3
     aAlfa = #1#5;
     aTipo = "N"; nLon = 15; nDec = 3; |HAZ Relleno;

||SIMVENTA           Núm.     1
     aAlfa = "";
     aTipo = "N"; nLon = 1; |HAZ Relleno;

||IMVENTA            Núm.     13,2
     aAlfa = #1#6;
     aTipo = "N"; nLon = 13; nDec = 2; |HAZ Relleno;

||SIMDEVO            Núm.     1
     aAlfa = "";
     aTipo = "N"; nLon = 1; |HAZ Relleno;

||IMDEVO             Núm.     13,2
     aAlfa = #1#7;
     aTipo = "N"; nLon = 13; nDec = 2; |HAZ Relleno;

||SIMPROMO           Núm.     1
     aAlfa = "";
     aTipo = "N"; nLon = 1; |HAZ Relleno;

||IMPROMO            Núm.     13,2
     aAlfa = #1#8;
     aTipo = "N"; nLon = 13; nDec = 2; |HAZ Relleno;

||SIMREGALO          Núm.     1
     aAlfa = "";
     aTipo = "N"; nLon = 1; |HAZ Relleno;

||IMREGALO           Núm.     13,2
     aAlfa = #1#9;
     aTipo = "N"; nLon = 13; nDec = 2; |HAZ Relleno;

||SIMBONIFI          Núm.     1
     aAlfa = "";
     aTipo = "N"; nLon = 1; |HAZ Relleno;

||IMBONIFI           Núm.     13,2
     aAlfa = #1#10;
     aTipo = "N"; nLon = 13; nDec = 2; |HAZ Relleno;

||DIATRANSM          Núm.     2
     aAlfa = 99;
     aTipo = "N"; nLon = 2; |HAZ Relleno;

     |XGRABA nHandle, aFinReg;
|FPRC;

|PROCESO TmpContado;
||CONCES             Núm.     10
     aAlfa = #0#0;
     aTipo = "N"; nLon = 10; |HAZ Relleno;

||AÑO                Núm.     4
     aAlfa = #1#13;
     aTipo = "N"; nLon = 4; |HAZ Relleno;

||MES                Núm.     2
     aAlfa = #1#14;
     aTipo = "N"; nLon = 2; |HAZ Relleno;

||TIPOCLI            Núm.     1
     aAlfa = #24#167; aAlfa = aAlfa % 101;
     aTipo = "N"; nLon = 1; |HAZ Relleno;

||DELGACLI           Núm.     2
     aAlfa = #24#168; aAlfa = aAlfa % 102;
     aTipo = "N"; nLon = 2; |HAZ Relleno;

||CLIENTE            Núm.     8
     aAlfa = #24#165; || #1#0;
     aTipo = "N"; nLon = 8; |HAZ Relleno;

||CLIENTEGCC         Núm.     10
     aAlfa = #1#0;
     aTipo = "N"; nLon = 10; |HAZ Relleno;

||MONEDA             Char.    3
     aAlfa = #1#11;
     aTipo = "A"; nLon = 3; |HAZ Relleno;

||PRODUCTO           Núm.     18
     aAlfa = #1#12;
     aTipo = "N"; nLon = 18; |HAZ Relleno;

||SCVENTA            Núm.     1
     aAlfa = "";
     aTipo = "N"; nLon = 1; |HAZ Relleno;

||CVENTA             Núm.     15,3
     aAlfa = #1#2;
     aTipo = "N"; nLon = 15; nDec = 3; |HAZ Relleno;

||SCDEVO             Núm.     1
     aAlfa = "1";
     aTipo = "N"; nLon = 1; |HAZ Relleno;

||CDEVO              Núm.     15,3
     aAlfa = #1#3;
     aTipo = "N"; nLon = 15; nDec = 3; |HAZ Relleno;

||SCPROMO            Núm.     1
     aAlfa = "";
     aTipo = "N"; nLon = 1; |HAZ Relleno;

||CPROMO             Núm.     15,3
     aAlfa = #1#4;
     aTipo = "N"; nLon = 15; nDec = 3; |HAZ Relleno;

||SCREGALO           Núm.     1
     aAlfa = "";
     aTipo = "N"; nLon = 1; |HAZ Relleno;

||CREGALO            Núm.     15,3
     aAlfa = #1#5;
     aTipo = "N"; nLon = 15; nDec = 3; |HAZ Relleno;

||SIMVENTA           Núm.     1
     aAlfa = "";
     aTipo = "N"; nLon = 1; |HAZ Relleno;

||IMVENTA            Núm.     13,2
     aAlfa = #1#6;
     aTipo = "N"; nLon = 13; nDec = 2; |HAZ Relleno;

||SIMDEVO            Núm.     1
     aAlfa = "1";
     aTipo = "N"; nLon = 1; |HAZ Relleno;

||IMDEVO             Núm.     13,2
     aAlfa = #1#7;
     aTipo = "N"; nLon = 13; nDec = 2; |HAZ Relleno;

||SIMPROMO           Núm.     1
     aAlfa = "";
     aTipo = "N"; nLon = 1; |HAZ Relleno;

||IMPROMO            Núm.     13,2
     aAlfa = #1#8;
     aTipo = "N"; nLon = 13; nDec = 2; |HAZ Relleno;

||SIMREGALO          Núm.     1
     aAlfa = "";
     aTipo = "N"; nLon = 1; |HAZ Relleno;

||IMREGALO           Núm.     13,2
     aAlfa = #1#9;
     aTipo = "N"; nLon = 13; nDec = 2; |HAZ Relleno;

||SIMBONIFI          Núm.     1
     aAlfa = "";
     aTipo = "N"; nLon = 1; |HAZ Relleno;

||IMBONIFI           Núm.     13,2
     aAlfa = #1#10;
     aTipo = "N"; nLon = 13; nDec = 2; |HAZ Relleno;

||DIATRANSM          Núm.     2
     aAlfa = 99;
     aTipo = "N"; nLon = 2; |HAZ Relleno;

     |XGRABA nHandle, aFinReg;
|FPRC;

|PROCESO Clientes;
||CONCES        Núm.  10      #alba001#? No se que nº es
     aAlfa = #0#0;
     aTipo = "N"; nLon = 10; |HAZ Relleno;

||FECHALTA      Núm.  8       #agifa024#159
     aAlfa = #24#159;
     aTipo = "F"; |HAZ Relleno;

||TIPOCLI       Núm.  1
     aAlfa = #24#167; aAlfa = aAlfa % 101;
     aTipo = "N"; nLon = 1; |HAZ Relleno;

||DELEGACLI     Núm.  2
     aAlfa = #24#168; aAlfa = aAlfa % 102;
     aTipo = "N"; nLon = 2; |HAZ Relleno;

||CLIENTE       Núm.  8       #agifa024#0
     aAlfa = #24#165; ||| #24#0;
     aTipo = "N"; nLon = 8; |HAZ Relleno;

||CLIENTEGCC    Núm.  10      "0000000000"
     aAlfa = "";
     aTipo = "N"; nLon = 10; |HAZ Relleno;

||CIF           Char. 9       #agifa024#15
     aAlfa = #24#15;
     aTipo = "A"; nLon = 9; |HAZ Relleno;

||TIPOESTAB     Núm.  2
     aAlfa = #24#169; aAlfa = aAlfa % 102;
     aTipo = "N"; nLon = 2; |HAZ Relleno;

||NOMBRE        Char. 30      #agifa024#2
     aAlfa = #24#2;
     aTipo = "A"; nLon = 30; |HAZ Relleno;

||RAZONSO       Char. 30      #agifa024#1
     aAlfa = #24#1;
     aTipo = "A"; nLon = 30; |HAZ Relleno;

||DIRECCION     Char. 30      #agifa024#8
     aAlfa = #24#8;
     aTipo = "A"; nLon = 30; |HAZ Relleno;

||CP            Núm.  5       #agifa024#183
     aAlfa = #24#183;
     aTipo = "N"; nLon = 5; |HAZ Relleno;

||POBLACION     Char. 20      #agifa024#9
     aAlfa = #24#9;
     aTipo = "A"; nLon = 20; |HAZ Relleno;

||FECHANACI     Núm.  8       "00000000"
     aAlfa = "";
     aTipo = "N"; nLon = 8; |HAZ Relleno;

||TELEFONO      Núm.  9       #agifa024#17
     aAlfa = #24#17;
     aTipo = "N"; nLon = 9; |HAZ Relleno;

||FAX           Núm.  9       #agifa024#18
     aAlfa = #24#18;
     aTipo = "N"; nLon = 9; |HAZ Relleno;

||SITUACION     Char. 1
     aAlfa = #24#164; aAlfa = aAlfa % 101;
     aTipo = "A"; nLon = 1; |HAZ Relleno;

|| Relleno
     aAlfa = ""; aTipo = "A"; nLon = 13; |HAZ Relleno;
     aAlfa = ""; aTipo = "N"; nLon = 5; |HAZ Relleno;
     aAlfa = ""; aTipo = "N"; nLon = 5; |HAZ Relleno;
     aAlfa = ""; aTipo = "N"; nLon = 5; |HAZ Relleno;
     aAlfa = ""; aTipo = "A"; nLon = 10; |HAZ Relleno;
     aAlfa = ""; aTipo = "N"; nLon = 1; |HAZ Relleno;
     aAlfa = ""; aTipo = "A"; nLon = 8; |HAZ Relleno;

     |XGRABA nHandle, aFinReg;
|FPRC;

|PROCESO Albaran;
     |SI #71#63 = -1;    || Linea Promocion
          |ACABA;
     |FINSI;

     |DDEFECTO #19;
     #19#0 = #71#2;
     |LEE 000#19=;
     |DDEFECTO #12;
     #12#0 = #19#0;
     |LEE 000#12=;

     |SI #12#1 =  0; |ACABA; |FINSI;

     nPromo = 0; nDevu = 0; nRegalo = 0; nVenta = 0; nImpPromo = 0;
     nImpDevu = 0; nImpRegalo = 0; nImpVenta = 0; nImpBoni = 0;

     |DDEFECTO #30;
     |ABRE #30;
     #30#0 = #71#29;
     #30#1 = #71#0;
     |LEE 000#30=;
     |CIERRA #30;

     |SI #30#2 = "S";
          |SI #71#5 > 0;
               nRegalo = #71#5;
               nImpRegalo = #71#9;
          |SINO;
               nImpVenta = -#71#9; || Para que reste en el #1#6
               nImpBoni = #71#9;
          |FINSI;
     |SINO;
          |SI #71#5 < 0;
               nDevu = -#71#5;
               nImpDevu = -#71#9;
          |SINO;
               nVenta = #71#5;
               nImpVenta = #71#9;
          |FINSI;
          |SALVA_FICHA #71;
          #71#1 = #71#63;
          |LEE 000#71=;
          |SI FSalida = 0;
               nPromo = #71#5;
               nImpPromo = #71#64;
          |FINSI;
          |REPON_FICHA #5;
     |FINSI;

     |DDEFECTO #1;
     #1#0 = #10#3;
     #1#1 = #71#2;
     |LEE 101#1=;
     |SI FSalida ! 0; |GRABA 020#1b; |FINSI;

     #1#2 = #1#2 + nVenta;
     #1#3 = #1#3 + nDevu;
     #1#4 = #1#4 + nPromo;
     #1#5 = #1#5 + nRegalo;
     #1#6 = #1#6 + nImpPromo + nImpRegalo + nImpVenta;
     #1#7 = #1#7 + nImpDevu;
     #1#8 = #1#8 + nImpPromo;
     #1#9 = #1#9 + nImpRegalo;
     #1#10 = #1#10 + nImpBoni;
     #1#11 = "EUR";
     #1#12 = #12#1;
     aAlfa = #10#1; aAlfa = aAlfa % -104; ||A¤o
     #1#13 = aAlfa;
     aAlfa = #10#1; aAlfa = aAlfa % 402; ||Mes
     #1#14 = aAlfa;
     |GRABA 020#1a;
     |LIBERA #1;
|FPRC;

|DEFBUCLE TmpAlb;
     #1#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, TmpAlb;
|FIN;

|DEFBUCLE TmpContado;
     #1#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, TmpContado;
|FIN;

|PROCESO CabAlba;
     aAlfa = #10#55; |QBF aAlfa;
     |SI aAlfa ! "TRANSMITIDO";
          #10#55 = "TRANSMITIDO";
          |GRABA 020#10a;
          |LIBERA #10;
     |SINO;
          |ERROR;
     |FINSI;
|FPRC;

|DEFBUCLE Albaran;
     #10#1;
     1,3;
     #0#41, #0#43, #0#45, #0#47;
     #0#42, #0#44, #0#46, #0#48;
     be;
     NULL, CabAlba, Albaran;
|FIN;

|DEFBUCLE Clientes;
     #24#1;
     4;||Cod, Tipo
     #0#6, #0#10;
     #0#7, #0#11;
     ;
     NULL, Clientes;
|FIN;

|PROCESO CabConta;
     ||#84#62 = "TRANSMITIDO";
     #84#61 = "S";            || Ahora uso el campo exportado
     |GRABA 020#84a;
     |LIBERA #84;
|FPRC;

|DEFBUCLE Contado;
     #84#1;
     1,3, 61;
     #0#62, #0#64, #0#66, #0#68, "N";
     #0#63, #0#65, #0#67, #0#69, "N";
     be;
     NULL, CabConta, Contado;
|FIN;

|PROCESO LaContado;
     aFic = aPath + #0#60; |QBF aFic;
     |XABRE "CWB", aFic, nHandle
     |SI FSalida < 0;
          aFic = "0000Error " + aFic;
          |MENAV aFic;
     |SINO;
          aAlfa = Usuario; |QBF aAlfa;
          |NOME_DAT #1 aAlfa;
          |DELINDEX #1;
          |ABRE #1;
          |ABRE #19;
          |ABRE #12;
          |BUCLE Contado;
          |CIERRA #12;
          |CIERRA #19;
          |CIERRA #1;
          |BUCLE TmpContado;
          |DELINDEX #1;
          |XCIERRA nHandle;
     |FINSI;
|FPRC;

|PROCESO ElAlbaran;
     aFic = aPath + #0#40; |QBF aFic;
     |XABRE "CWB", aFic, nHandle
     |SI FSalida < 0;
          aFic = "0000Error " + aFic;
          |MENAV aFic;
     |SINO;
          aAlfa = Usuario; |QBF aAlfa;
          |NOME_DAT #1 aAlfa;
          |DELINDEX #1;
          |ABRE #1;
          |ABRE #19;
          |ABRE #12;
          |BUCLE Albaran;
          |CIERRA #12;
          |CIERRA #19;
          |CIERRA #1;
          |ABRE #24;
          |BUCLE TmpAlb;
          |CIERRA #24;
          |DELINDEX #1;
          |XCIERRA nHandle;
     |FINSI;
|FPRC;

|PROCESO ElCliente;
     aFic = aPath + #0#5; |QBF aFic;
     |XABRE "CWB", aFic, nHandle
     |SI FSalida < 0;
          aFic = "0000Error " + aFic;
          |MENAV aFic;
     |SINO;
          |BUCLE Clientes;
          |XCIERRA nHandle;
     |FINSI;
|FPRC;

|PROCESO Tipo12; |TIPO 12;
     |SI FSalida = 7; |ACABA; |FINSI;

     |PINPA #0#0;
     |PINDA #0#0;
     |CONFI "0000SCorrecto...";
     |SI FSalida ! 0; |ACABA; |FINSI;

     aFinReg = &13;
     aFinReg = aFinReg + & 10;
     aPath = #0#53; |QBF aPath;

     |SI #0#4 = "S";
          |HAZ ElCliente;
     |FINSI;
     |SI #0#39 = "S";
          |HAZ ElAlbaran;
     |FINSI;
     |SI #0#17 = "S";
          |HAZ ElAlbaranV;
     |FINSI;
     |SI #0#32 = "S";
          |HAZ ElAlmacen;
     |FINSI;
     |SI #0#61 = "S";
          |HAZ LaContado;
     |FINSI;
     #0#59 = nConta;
     |GRABA 020#0a;
     |LIBERA #0;
|FPRC;

|PROGRAMA;
     aBlanco = " " * 22;
     |CLS;
     |ABRE #0;
     |LEE 101#0=;
     |SI FSalida ! 0; |GRABA 020#0b; |FINSI;
     |PINPA #0#0;
     |PINDA #0#0;
     |ENDATOS #1#0;

     |CIERRA #0;
|FPRO;
