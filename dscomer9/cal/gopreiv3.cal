     AbyCalcuPrecio

|FICHEROS;
     gopre003 #3;
     gopre004 #4;
     agifa019 #19;
     agi00063 #63;
     goparame #100;
|FIN;

|VARIABLES;
     &nDeci_TTrab = 0;
     &aIveCodigoSerie     = "XXXX";
     &aIveCodigoPresupuesto = "XXXX";
     nNume = 0;
     nPreVta = 0;
     nPreCos = 0;
     nSw = 0;
     nLinea = 0;
     nInc = 0;
|FIN;

|PROCESO AbyComponentes;
     |SI nSw = 1;
          nPreCos = (nPreCos + (#4#9 * #4#8)) ! nDeci_TTrab;
     |SINO;
          #4#9 = #4#9 * nInc;
          nPreVta = (nPreVta + (#4#9 * #4#8)) ! nDeci_TTrab;
          |GRABA 020#4a;
     |FINSI;
     |LIBERA #4;

     nLinea = #4#4 + 1;
|FPRC;

|DEFBUCLE AbyComponentes;
     #4#1;
     ;
     #3#0, #3#1, #3#2, #3#4, 001;
     #3#0, #3#1, #3#2, #3#4, 999;
     be;
     NULL, AbyComponentes;
|FIN;

|PROCESO AbyPartida;
     nPreVta = #3#8;
     nPreCos = 0;
     nSw = 1; |BUCLE AbyComponentes;

     nInc = nPreVta / nPreCos;
     nPreVta = 0;
     nSw = 2; |BUCLE AbyComponentes;

     nPreVta = (#3#8 - nPreVta) ! nDeci_TTrab;
     |SI nPreVta ! 0;
          |ABRE #4;
          #4#0 = #3#0;
          #4#1 = #3#1;
          #4#2 = #3#2;
          #4#3 = #3#3;
          #4#4 = nLinea;
          #4#5 = #19#0;
          #4#6 = #19#1;
          #4#7 = #19#5;
          #4#8 = 1;
          #4#9 = nPreVta;
          #4#10 = 0;
          #4#11 = #4#9;
          #4#12 = 0;
          #4#13 = 0;
          #4#14 = #63#0;
          #4#15 = #63#1;
          |GRABA 020#4n;
          |CIERRA #4;
     |FINSI;
|FPRC;

|DEFBUCLE AbyPartida;
     #3#1;
     ;
     aIveCodigoSerie, nNume, "                    ", 001;
     aIveCodigoSerie, nNume, "zzzzzzzzzzzzzzzzzzzz", 999;
     ;
     NULL, AbyPartida;
|FIN;

  los componentes vienen con el precio de coste y
  la partida con el precio de venta
|PROCESO AbyCalcuPrecio;
     |ABRE #100; |LEE 000#100p; |CIERRA #100;
     |ABRE #19;
     #19#0 = #100#91;
     |LEE 000#19=;
     |CIERRA #19;

     |ABRE #63;
     #63#0 = #19#126;
     |LEE 000#63=;
     |CIERRA #63;

     nNume = aIveCodigoPresupuesto;
     |BUCLE AbyPartida;
|FPRC;
