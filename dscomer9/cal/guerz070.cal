|FICHEROS;
     guerz070 #0;
     gopre001 #1;
     gopre002 #2;
     gopre003 #3;
     gosubcoc #10;
     gosubcap #11;
     gosubpar #12;
     gosubdes #13;
     agifa019 #19;
     agifa041 #41;
     guerw064 #64,MANTE;  ||Tmp
     agifa067 #67;
     agifa081 #81;
     goparame #100;
     agifa112 #112;
     agifa142 #142;
     guerm119 #119;
     guerm120 #120;
     guerm122 #122;
     agifa321 #321;
     agifa324 #324;
|FIN;

|VARIABLES;
     aAlfa = "";
     &cCodMonTrab = "";
     &nDeci_Medi = 0;
     &nDeci_Meda = 0;
     aSerPre = "";
     nNumPre = 0;
     nPrime = 0;
     aSerie = "";
     nNumero = 0;
     nHay = 0;
     &Tempo = "";
     aTmp64 = "";
  {-1}aMenu = "";
     aMenu1 = "2400";
     aMenu2 = "1";
     aMenu3 = " ";
     aMenu4 = "RAC";
     aMenu5 = " Repasar ";
     aMenu6 = " Aceptar ";
     aMenu7 = " Cancelar ";
  {-1}aMenx = "";
     aMenx1 = "2400";
     aMenx2 = "1";
     aMenx3 = "Rechazar ofertas del mismo presupuesto";
     aMenx4 = "NST";
     aMenx5 = " No ";
     aMenx6 = " Si ";
     aMenx7 = " Todas ";
     nLin = 0;
     nLinCon = 0;
     &eaDocu = "";
     &enSwMenu = 0;
     &enImpPrvPed = 0;
     &efFecha = @;
     &eaProve = "";
     aDirEmp = "";
     aDatos = "";
     nCodEmp = 0;
     fmes1 = "";
     mes = 0;
     nImpo = 0;
|FIN;

|PROCESO LinSubcon;
     |DDEFECTO #3;
     |SELECT #4#3;
     #3#0 = #1#0;
     #3#1 = #1#1;
     #3#4 = #64#2;
     |LEE 000#3=; || gopre003

     |DDEFECTO #2;
     |SELECT #6#2;
     #2#0 = #3#0;
     #2#1 = #3#1;
     #2#12 = #3#2;
     |LEE 020#2=; || gopre002

     |SELECT #2#11;
     #11#0 = #10#0;
     #11#2 = #3#2;
     |LEE 101#11=;  || gosubcap
     |SI FSalida ! 0;
          |SELECT #1#11;
          #11#0 = #10#0;
          #11#1 = 999;
          |LEE 000#11];
          |SI FSalida = 0;
               |LEE 000#11a;
          |SINO;
               |LEE 000#11u;
          |FINSI;
          |SI FSalida = 0; |Y #11#0 = #10#0;
               nLin = #11#1 + 1;
          |SINO;
               nLin = 1;
          |FINSI;
          |DDEFECTO #11;
          #11#0 = #10#0;
          #11#1 = nLin;
          #11#2 = #3#2;
          #11#3 = #2#13;
          #11#4 = #2#6;
          |LIBERA #11;
          |GRABA 020#11b;
          nLinCon = 0;
     |FINSI;
     nLinCon = nLinCon + 1;
     |DDEFECTO #12; || gosubpar
     #12#0 = #11#0;
     #12#1 = #11#2;
     #12#2 = nLinCon;
     #12#3 = #64#2;
     #12#4 = #64#3;

     #12#5 = #3#7;
     #12#6 = #3#6;
     #12#7 = #3#9;
     #12#8 = #3#11;
     #12#10 = #3#8;
     #12#11 = #3#10;
     #12#13 = #64#5;
     #12#14 = #64#4;
     nImpo = (#12#13 * #12#14);
     nImpo = nImpo - (( #12#17 * nImpo)/100);
     #12#12 = nImpo - (( #12#18 * nImpo)/100);
     |GRABA 020#12n;

     #11#7 = #11#7 + #12#8;
     #11#9 = #11#9 + #12#11;
     #11#11 = #11#11 + #12#12;

     #10#13 = #10#13 +  #12#12;

     |GRABA 020#10a;
     |GRABA 020#11a;
     |LIBERA #11;
|FPRC;

|PROCESO CabSubcon;
     |LIBERA #10;

     |LEE 000#10u;
     |SI FSalida = 0;
          nNumero = #10#0 + 1;
     |SINO;
          nNumero = 1;
     |FINSI;
     |DDEFECTO #10;
     #10#0 = nNumero;
  ||   #10#1 = #119#1;
     #10#2 = #119#10;
     #10#3 = #119#11;
     #10#4 = #119#4;
     #10#5 = #119#5;
     #10#6 = #1#2;
     #10#7 = #1#3;
     #10#8 = #119#13;
     #10#9 = #119#2;
     #10#10 = #119#12;
     #10#11 = "N";
     #10#14 = #119#14;
     #10#15 = 2;
     |GRABA 020#10b;
|FPRC;

|PROCESO LinPedido;
     |ABRE #19;
     #19#0 = #64#2;
     |LEE 000#19=;
     |CIERRA #19;

     nLin = nLin + 1;
     |DDEFECTO #67;
     #67#28 = #81#25;
     #67#0 = #81#0;
     #67#1 = nLin;
     #67#2 = #19#0;
     #67#3 = 1;
     #67#4 = #64#3;
     #67#5 = #64#4;
     #67#6 = #64#5;
     #67#13 = #119#2;
     #67#14 = #19#30;
     #67#18 = #19#2;
     #67#20 = #112#0;
     #67#26 = #81#9;
     eaDocu = "agifa067";
     |HAZ StockEntra;
     |GRABA 020#67n;
|FPRC;

|PROCESO CabPedido;
     |LIBERA #81;

     #112#0 = #119#10;
     |LEE 000#112=;

     |DFICE aDirEmp;
     |DFICB aDatos;
     aDirEmp = aDirEmp % -205;
     nCodEmp = aDirEmp;
     |PATH_DAT #41 aDatos;
     |ABRE #41;
     #41#0 = nCodEmp;
     |LEE 000#41=;
     |CIERRA #41;

     aSerie = "     ";
     #81#25 = aSerie;
     enSwMenu = 1;
     |HAZ ContaPC7;
     nNumero = #81#0;
     ||#81#1 = #119#1;
     #81#2 = #119#2;
     #81#4 = #119#10;
     #81#5 = #119#14;
     #81#8 = #119#11;
     #81#9 = #112#17;
     #81#18 = #41#2;
     #81#20 = #41#3;
     #81#21 = #41#4;
     #81#27 = #112#81;

     #324#0 = #81#27;
     |LEE 000#324=;

     #81#28 = #324#3;
     #81#29 = #112#82;
     #81#32 = #321#9;

     #324#0 = #81#32;
     |LEE 000#324=;

     #81#33 = #324#3;
     |GRABA 020#81b;
|FPRC;

|PROCESO Historico;
     |DDEFECTO #122;
     #122#0 = #64#2;
     #122#1 = #119#10;
     |LEE 101#122=;
     |SI FSalida ! 0; |GRABA 020#122b; |FINSI;
     #122#2 = #64#3;
     #122#3 = #119#11;
     #122#4 = #119#1;
     #122#5 = #64#4;
     #122#6 = #64#5;
     |GRABA 020#122a;
     |LIBERA #122;
|FPRC;

|PROCESO ActProv;
     |ABRE #19;
     #19#0 = #67#2;
     |LEE 020#19=;
     |CIERRA #19;

     fmes1 = #81#1 % A402;
     mes = fmes1 + 42;
     |SI #19#196 = 2;
          nImpo = (((((#67#41 * #67#6) < #67#8) < #67#27) < #67#57) < #81#5) < #81#17;
     |SINO;
          nImpo = (((((#67#5 * #67#6) < #67#8) < #67#27) < #67#57) < #81#5) < #81#17;
     |FINSI;
     |SI #142#114 = "S";
          nImpo = nImpo < #81#6;
     |FINSI;
     #112mes = #112mes + nImpo;
     #112#55 = #112#55 + nImpo;

     enImpPrvPed = nImpo;
     efFecha = #81#1;
     eaProve = #81#4;
     |HAZ AcumulaPrv;
|FPRC;

|PROCESO Tmp;
     #120#0 = #64#0;
     #120#1 = #64#1;
     |LEE 121#120=;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |SI #64#7 = "S";
          |SI #119#9 = "A";
               |SI nPrime = 0; |HAZ CabPedido; |FINSI;
               |HAZ LinPedido;
               |HAZ Historico;
          |SINO;
               |SI nPrime = 0; |HAZ CabSubcon; |FINSI;
               |HAZ LinSubcon;
               |HAZ Historico;
          |FINSI;
          nPrime = 1;
          #120#8 = aSerie;
          #120#9 = nNumero;
          |SI #119#9 = "A";
               #120#10 = "P";
          |SINO;
               #120#10 = "S";
          |FINSI;
     |FINSI;
     #120#7 = #64#7;
     |GRABA 020#120a;
     |LIBERA #120;
|FPRC;

|DEFBUCLE Tmp;
     #64#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Tmp;
|FIN;

|PROCESO CreaLos;
     |ABRE #10;
     |ABRE #11;
     |ABRE #12;
     |ABRE #122;
     |ABRE #120;
     |ABRE #3;
     |ABRE #2;
     |ABRE #81;
     |ABRE #67
     |ABRE #112;
     |ABRE #324;
     |BUCLE Tmp;
     |CIERRA #324;
     |SI nPrime = 1; |Y #119#9 = "A";
          |HAZ CalCabAgifa081;
          #112#0 = #81#4;
          |LEE 101#112=;
          |SI FSalida = 0;
               |BUCLELIN 2 ActProv #0;
               |GRABA 020#112a;
          |FINSI;
     |FINSI;
     |CIERRA #112;
     |CIERRA #67;
     |CIERRA #81;
     |CIERRA #2;
     |CIERRA #3;
     |CIERRA #10;
     |CIERRA #11;
     |CIERRA #12;
     |CIERRA #120;
     |CIERRA #122;
|FPRC;

|PROCESO RechazaPresu;
     |SI #119#0 = #0#0;
          |ACABA;
     |FINSI;
     |SI aMenx = 2;
          |SELECT #2#64;
          #64#2 = #120#2;
          |SI FSalida ! 0; |ACABA; |FINSI;
     |FINSI;
     #120#7 = "R";
     |GRABA 020#120a;
     |LIBERA #120;
|FPRC;

|DEFBUCLE RechazaPresu;
     #119#2;
     ;
     aSerPre, nNumPre;
     aSerPre, nNumPre;
     be;
     NULL, NULL, RechazaPresu;
|FIN;

|PROCESO Tecla; |TIPO 11;
     |SI FSalida = 12; || F4
          |SI #64#7 = "N";
               #64#7 = "S";
          |SINO;
               #64#7 = "N";
          |FINSI;
          |GRABA 020#64a;
          |PINTA #64#7;
     |FINSI;
     |SI FSalida = 13; || F5
          |SI #64#7 = "N";
               #64#7 = "R";
          |SINO;
               #64#7 = "N";
          |FINSI;
          |GRABA 020#64a;
          |PINTA #64#7;
     |FINSI;
|FPRC;

|PROCESO LinOferta;
     |SI #120#7 = "N";
          |DDEFECTO #64;
          #64#0 = #120#0;
          #64#1 = #120#1;
          #64#2 = #120#2;
          #64#3 = #120#3;
          #64#4 = #120#4;
          #64#5 = #120#5;
          #64#6 = #120#6;
          |GRABA 020#64n;
          nHay = 1;
     |FINSI;
|FPRC;

|PROCESO Min;
     #64#0 = #0#0;
     #64#1 = 1;
|FPRC;

|PROCESO Max;
     #64#0 = #0#0;
     #64#1 = 999;
|FPRC;

|PROCESO Tipo3; |TIPO 3;
     |ABRE #142; |LEE 000#142p; |CIERRA #142;
     |ABRE #100; |LEE 000#100p; |CIERRA #100;
     |ABRE #321; |LEE 000#321p; |CIERRA #321;
     nDeci_Meda = #100#115;

     |HAZ CreaTempo;
     aTmp64 = Tempo; |NOME_DAT #64#Tempo#; |DELINDEX #64;
     |ABRE #64;
     |ABRE #119;
     #119#0 = #0#0;
     |LEE 101#119=;
     |SI FSalida = 0;
          |ABRE #1;
          #1#0 = #119#4;
          #1#1 = #119#5;
          |LEE 000#1=;
          |CIERRA #1;
          cCodMonTrab = #1#7;
          |HAZ MonBas;
          nDeci_Medi = #1#24;

          |BUCLELIN 2LinOferta#119;
          |SI nHay = 0;
               |MENAV "0000No hay lineas pendientes...";
          |SINO;
               |PINPA #0#64;
               |PINTA 710, #0#0;
               |SI #119#9 = "A";
                    |ATRI I; |PINTA 717, " Pase a Pedido"; |ATRI 0;
               |SINO;
                    |ATRI I; |PINTA 717, " Pase a Subcontrata"; |ATRI 0;
               |FINSI;
               |PARA; |SI aMenu2 = 1; |HACIENDO;
                    |ENTLINEAL #1#64, 2, 4, 22, 0, Min, Max;
                    |MENU aMenu;
                    aMenu2 = FSalida;
               |SIGUE;
               |SI aMenu2 = 2;
                    |HAZ CreaLos;
                    |SI nPrime = 1;
                         |SI #119#9 = "A";
                              aAlfa = "0000Creado pedido: " + aSerie + "/" + nNumero;
                         |SINO;
                              aAlfa = "0000Creada subcontrata: " + nNumero;
                         |FINSI;
                         |MENAV aAlfa;
                    |FINSI;
                    |MENU aMenx;
                    aMenx = FSalida;
                    |SI aMenx ] 2;
                         aSerPre = #119#4;
                         nNumPre = #119#5;
                         |ABRE #64;
                         |BUCLE RechazaPresu;
                         |CIERRA #64;
                    |FINSI;
               |FINSI;
          |FINSI;
     |SINO;
          |MENAV "0000No existe Oferta";
     |FINSI;
     |CIERRA #119;
     |CIERRA #64;
     aTmp64 = Tempo; |HAZ BoraTempo; |DELINDEX #64;
|FPRC;
