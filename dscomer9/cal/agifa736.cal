|FICHEROS;
   agifa736 #0;

   agifa737 #1,MANTE;
   agifa738 #2,MANTE;
   agifa739 #3,MANTE;
   agifa708 #4,MANTE;
   agifa709 #5,MANTE;

   agifa702 #6;
   agifa700 #7;
   agifa740 #17,MANTE;
   agifa741 #18,MANTE;
   agifa742 #19;
   agifa744 #22;
   agifa745 #23;

   agifa707 #8,MANTE;
   agifa717 #9,MANTE;
   agifa718 #16,MANTE;
   referen@ #10;
   caconce@ #11;

   canempr@ #12;
   agifa710 #13;
   agifa723 #14;
   refere1@ #15;
   calibro@ #20;
   caivses@ #21;

   agifa734 #30,MANTE;

   RefDato@ #500;
   RefDat1@ #501;
|FIN;

|VARIABLES;
   &eaTipoEnlace = "";
   &eaAlfa = "";
   &nDeci_nDec = 0;

   || NO METER VARIABLES ENTRE ESTE BLOQUE
{-1}aVent      = "";
    aVent1     = 0;
    aVent2     = 0;
    aVent3     = 0;
    aVent4     = 0;
    aVent5     = "";
   || NO METER VARIABLES ENTRE ESTE BLOQUE

   aAlfa  = ""; aAlfa1 = "";
   aAlfaX = "";
   nCalc  = 0;  nCalc1 = 0;
   nCalc2 = 0;

   aCuenta = ""; aDescri = ""; aImport = ""; aDepart = ""; SwDep = 0;
   aCmpClv = "";

   aFichC = ""; aFichP = "";

   nFlag = 0;
   Cont  = 0;
   ComodNum = 0;
   Comodin = "";
   Comodin1 = "";
   Comodin2 = "";
   Salir = 0;
   NumCampos = 0;
   DefCargado = "";
   Direc = "";
   aFormato = "";

   nTecla = 0;

   ModoEntrada = 0;
   TipoDato = ""; LongDato = 0;

   Linea = 0; LinCmps = 0;
   TipoCampo1 = "";
   TipoCampo2 = "";
   Fich = "";  NumCampo = 0; Cmp = ""; NomFich = "";

   aLong = ""; nLong = 0; Calc = 0; nPosic = 0;
   Tecla = 0; acota = 0; LinAcot = 0; Parte1 = ""; Parte2 = "";
   ConcepAntes = 0;
   aTipo = "";

   MaxDig = 0; Nivel = 0;

   aEsc1         = "";
   aEsc2         = "";
   aRetu         = "";
   aTecla        = "";

   nPos1  = 0;
   nPos2  = 0;
   nRango = 0;

   nVent   = 0;
   nVent1  = 0;
   nVent2  = 0;
   nPant0  = -1;
   nPant1  = -1;
   nGrid1  = -1;
   nGrid2  = -1;
   nLabel1 = -1;
   nLabel2 = -1;
   nLabel3 = -1;
   nLabel4 = -1;
   nLabel5 = -1;
   nLabel6 = -1;

   nLabelIntr = -1;
   nLabelLin1 = -1;
   nLabelLin2 = -1;

   nBotonNuevo = 0;
   nBotonModif = 0;
   nBotonBorra = 0;

   nBotAsNuevo = 0;
   nBotAsModif = 0;
   nBotAsBorra = 0;

   nBotonMem = 0;
   nBotonSel = 0;
   nBotonSel1 = 0;
   nBotonSel2 = 0;
   nGridSel   = 0;
|FIN;

|PROCESO PintaTipo;
   |SI #agifa736#2 = "V"; #agifa736#3 = "FACTURAS VENTA      "; |FINSI;
   |SI #agifa736#2 = "C"; #agifa736#3 = "FACTURAS COMPRA     "; |FINSI;
   |SI #agifa736#2 = "D"; #agifa736#3 = "FACTURAS DIRECTAS   "; |FINSI;
   |SI #agifa736#2 = "T"; #agifa736#3 = "TICKETS             "; |FINSI;
   |SI #agifa736#2 = "I"; #agifa736#3 = "CIERRE CAJA         "; |FINSI;
   |SI #agifa736#2 = "R"; #agifa736#3 = "CREDITOS            "; |FINSI;
   |PINTA #agifa736#3;
|FPRC;

|RUTINA inf717;
   #agifa717#0 = #agifa736#0;
   #agifa717#1 = "               ";
|FRUT;

|RUTINA sup717;
   #agifa717#0 = #agifa736#0;
   #agifa717#1 = "zzzzzzzzzzzzzzz";
|FRUT;

|RUTINA inf1;
   #agifa738#0 = #agifa736#0;
   #agifa738#1 = #agifa737#2;
   #agifa738#2 = 0001;
|FRUT;

|RUTINA sup1;
   #agifa738#0 = #agifa736#0;
   #agifa738#1 = #agifa737#2;
   #agifa738#2 = 9999;
|FRUT;

|RUTINA inf2;
   #agifa708#0 = 001;
   #agifa708#6 = TipoCampo1;
|FRUT;

|RUTINA sup2;
   #agifa708#0 = 999;
   #agifa708#6 = TipoCampo2;
|FRUT;

|RUTINA inf3;
   #agifa709#3 = #agifa736#0;
   #agifa709#4 = #agifa737#2;
   #agifa709#5 = #agifa738#2;
   |SI acota = 0;
      |SI TipoCampo1 = "A";
         #agifa709#6 = "E";
      |SINO;
         #agifa709#6 = TipoCampo1;
      |FINSI;
   |SINO;
      #agifa709#6 = TipoCampo1;
   |FINSI;
   #agifa709#0 = 1;
|FRUT;

|RUTINA sup3;
   #agifa709#3 = #agifa736#0;
   #agifa709#4 = #agifa737#2;
   #agifa709#5 = #agifa738#2;
   |SI acota = 0;
      |SI TipoCampo2 = "A";
         #agifa709#6 = "E";
      |SINO;
         #agifa709#6 = TipoCampo2;
      |FINSI;
   |SINO;
      #agifa709#6 = TipoCampo2;
   |FINSI;
   #agifa709#0 = 999;
|FRUT;

|RUTINA inf4;
   #agifa707#0 = 001;
   #agifa707#15 = #agifa736#0;
|FRUT;

|RUTINA sup4;
   #agifa707#0 = 999;
   #agifa707#15 = #agifa736#0;
|FRUT;

|RUTINA InfAcota;
   #agifa709#3 = #agifa736#0;
   #agifa709#4 = #agifa737#2;
   #agifa709#5 = #agifa738#2;
   #agifa709#6 = "A";
   #agifa709#0 = 1;
|FRUT;

|RUTINA SupAcota;
   #agifa709#3 = #agifa736#0;
   #agifa709#4 = #agifa737#2;
   #agifa709#5 = #agifa738#2;
   #agifa709#6 = "A";
   #agifa709#0 = 999;
|FRUT;

|PROCESO Inf737;
   #agifa737#0 = #agifa736#0;
   #agifa737#2 = 1;
|FPRC;

|PROCESO Sup737;
   #agifa737#0 = #agifa736#0;
   #agifa737#2 = 999999;
|FPRC;

|PROCESO Inf738;
   #agifa738#0 = #agifa737#0;
   #agifa738#1 = #agifa737#2;
   #agifa738#2 = 1;
|FPRC;

|PROCESO Sup738;
   #agifa738#0 = #agifa737#0;
   #agifa738#1 = #agifa737#2;
   #agifa738#2 = 9999;
|FPRC;

|PROCESO DefineLinea; |TIPO 3;
   |SI nGrid2 ! -1; |DESTRUYECONTROL nGrid2; nGrid2 = -1; |FINSI;

   |SI nLabelLin1 ! -1;
      |FIN_CONTROL_WINDOWS nLabelLin1; nLabelLin1 = -1;
   |FINSI;
   |CONTROL_SIMPLE nPant0, "LABEL,{{7}}Asientos", 1104, 1109, NULL;
   nLabelLin1 = FSalida;

   |SI nLabelLin2 ! -1;
      |FIN_CONTROL_WINDOWS nLabelLin2; nLabelLin2 = -1;
   |FINSI;
   |CONTROL_SIMPLE nPant0, "LABEL,{{6}}Lineas asientos", 1804, 1820, NULL;
   nLabelLin2 = FSalida;
   |PULSATECLA;

   nRango = 1 + 4 + 8 + 16;
   nPos1 = 1604; nPos2 = 2296;
   |LINEAL_SIMPLE #1#agifa738, nRango, nPos1, nPos2, Inf738, Sup738, EvtoGrid2;

   nRango = 4 + 8 + 16 + 32;
   nPos1 = 1604; nPos2 = 2296;
   |LINEAL_SIMPLE #1#agifa738, nRango, nPos1, nPos2, Inf738, Sup738, EvtoGrid2;
   nGrid2 = FSalida;
   |PULSATECLA;

   |FIN_CONTROL_WINDOWS nLabelLin2;
   |CONTROL_SIMPLE nPant0, "LABEL,{{7}}Lineas asientos", 1804, 1815, NULL;
   nLabelLin2 = FSalida;

   |FIN_CONTROL_WINDOWS nLabelLin1; nLabelLin1 = -1;
   |CONTROL_SIMPLE nPant0, "LABEL,{{6}}Asientos", 1104, 1113, NULL;
   nLabelLin1 = FSalida;
|FPRC;

|PROCESO Borra3;
   |BORRA 020#agifa707.a;
|FPRC;

|DEFBUCLE Borra3;
#agifa707#1;
;
#agifa736#0,001;
#agifa736#0,999;
;
NULL,Borra3;
|FIN;

|PROCESO BorraLins;
   |BORRA 020#agifa709.a;
|FPRC;

|DEFBUCLE BorraLins;
#agifa709#1;
;
#agifa736#0,#agifa737#2,#agifa738#2," ",001;
#agifa736#0,#agifa737#2,#agifa738#2,"z",999;
;
NULL,BorraLins;
|FIN

|PROCESO Borra2;
   |ABRE #agifa709;
   |BUCLE BorraLins;
   |CIERRA #agifa709;
   |BORRA 020#agifa738.a;
|FPRC;

|DEFBUCLE Borra2;
#agifa738#1;
;
#agifa736#0,000001,0001;
#agifa736#0,999999,9999;
;
NULL,Borra2;
|FIN;

|PROCESO Borra1;
   |BORRA 020#agifa737.a;
|FPRC;

|DEFBUCLE Borra1;
#agifa737#1;
;
#agifa736#0,000001;
#agifa736#0,999999;
;
NULL,Borra1;
|FIN;

|PROCESO PintaEmpCont;
   Comodin = #agifa736#6; |QBF Comodin;
   |SI Comodin ! "";
      Comodin1 = Comodin + "def/canempre.mas";
      |CARGA_DEF Comodin1 , canempr@;
      |SI FSalida = 0;
         Comodin1 = Comodin + "fich/";
         |PATH_DAT #12 Comodin1;
         |ABRE #canempr@;
         #canempr@#2 = #agifa736#4;
         #canempr@#3 = #agifa736#5;
         |LEE 010#canempr@.=;
         |SI FSalida = 0;
            |PINTA 1135, #canempr@#1;
         |FINSI;
         |CIERRA #canempr@;
         |DESCARGA_DEF #canempr@;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO BorraLineas; |TIPO 1;
   ModoEntrada = (FEntrada / 100) ! 0;
   |SI ModoEntrada = 3;
      |BUCLE Borra3;
      |BUCLE Borra2;
      |BUCLE Borra1;
   |SINO;
      |HAZ PintaEmpCont;
   |FINSI;
|FPRC;

|PROCESO Campos;

   |DDEF aAlfa; |QBF aAlfa; aAlfa = aAlfa + #agifa702#1 + ".mas";
   |CARGA_DEF aAlfa, RefDat1@;
   |SI FSalida = 0;
      aAlfa = "|TITULO"; aAlfa = #RefDat1@#aAlfa#;
      #agifa700#1 = aAlfa;
      |DESCARGA_DEF #RefDat1@;
   |SINO;
      #agifa700#0 = #agifa702#1;
      |LEE 000#agifa700.=;
   |FINSI;

   |DDEFECTO #agifa708;

   #agifa708#0 = Linea;  Linea = Linea + 1;
   #agifa708#1 = #agifa702#1;
   #agifa708#2 = #agifa700#1;
   #agifa708#3 = #agifa702#4;
   #agifa708#4 = #agifa702#2;
   #agifa708#5 = #agifa702#3;
   #agifa708#6 = #agifa702#5;
   |GRABA 020#agifa708.n;
|FPRC;

|DEFBUCLE Ficheros;
#agifa702#1;
4,5;
001,#agifa736#2,TipoCampo1;
999,#agifa736#2,TipoCampo2;
;
NULL,Campos;
|FIN;

|PROCESO Interpreta;
   Comodin1 = #agifa709#1 % 0102;
   |SI Comodin1 = "[%";
      Comodin1 = #agifa709#1 % 0105; |QBF Comodin1;
   |SINO;
      Comodin1 = #agifa709#2 % 0101;
   |FINSI;

   Comodin2 = #agifa709#2 % 0299; |QBF Comodin2;
   Comodin1 = Comodin1 + Comodin2; |QBF Comodin1;
   |SI Comodin1 = "";
      Comodin1 = #agifa709#1; |QBF Comodin1;
   |FINSI;
   Comodin = Comodin + Comodin1;
|FPRC;

|DEFBUCLE Interpreta;
#agifa709#1;
;
#agifa736#0,#agifa737#2,#agifa738#2,TipoCampo1,001;
#agifa736#0,#agifa737#2,#agifa738#2,TipoCampo1,999;
;
NULL,Interpreta;
|FIN;

|PROCESO EditaLineas; |TIPO 13;
   |SI FSalida = 10;
      |SI acota = 0;
         |ENTLINEAL #1#agifa709,-5,1,22,1,inf3,sup3;
         |ENTLINEAL #1#agifa709,5,7,22,1,inf3,sup3;
      |SINO;
         |ENTLINEAL #1#agifa709,-5,1,22,1,InfAcota,SupAcota;
         |ENTLINEAL #1#agifa709,5,7,22,1,InfAcota,SupAcota;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO LinFichero; |TIPO 0;
   LinCmps = 0;
   |SALVA_FICHA #agifa709;
   #agifa709#3 = #agifa736#0;
   #agifa709#4 = #agifa737#2;
   #agifa709#5 = #agifa738#2;
   |SI acota = 1;
      #agifa709#6 = "A";
   |SINO;
      |SI TipoCampo1 = "A";
         #agifa709#6 = "E";
      |SINO;
         #agifa709#6 = TipoCampo1;
      |FINSI;
   |FINSI;
   #agifa709#0 = 1;
   |LEE 010#agifa709.];
   |SI FSalida ! 0; LinCmps = 10; |FINSI;
   |PARA; |SI FSalida = 0; |HACIENDO;
      |SI acota = 0;
         |SI #agifa709#3 = #agifa736#0; |Y #agifa709#4 = #agifa737#2;
         |Y #agifa709#5 = #agifa738#2;  |Y #agifa709#6 = TipoCampo1;
            LinCmps = #agifa709#0 + 10;
            |LEE 010#agifa709.s;
         |SINO;
            |SI LinCmps = 0; LinCmps = 10; |FINSI;
            |SAL;
         |FINSI;
      |SINO;
         |SI #agifa709#3 = #agifa736#0; |Y #agifa709#4 = #agifa737#2;
         |Y #agifa709#5 = #agifa738#2;  |Y #agifa709#6 = "A";
            LinCmps = #agifa709#0 + 10;
            |LEE 010#agifa709.s;
         |SINO;
            |SI LinCmps = 0; LinCmps = 10; |FINSI;
            |SAL;
         |FINSI;
      |FINSI;
   |SIGUE;
   |REPON_FICHA #agifa709;

   |DDEFECTO #agifa709;
   #agifa709#0 = LinCmps;
   Comodin = "[" + #agifa708#2; |QBF Comodin;
   Comodin = Comodin + "][" + #agifa708#5; |QBF Comodin;
   Comodin = Comodin + "]";
   #agifa709#1 = Comodin;
   Comodin = "[" + #agifa708#1; |QBF Comodin;
   Comodin1 = ("000" + #agifa708#4) % -103;
   Comodin = Comodin + "][" + Comodin1 + "]";
   #agifa709#2 = Comodin;
   #agifa709#3 = #agifa736#0;
   #agifa709#4 = #agifa737#2;
   #agifa709#5 = #agifa738#2;
   |SI acota = 0;
      |SI TipoCampo1 = "A";
         #agifa709#6 = "E";
      |SINO;
         #agifa709#6 = TipoCampo1;
      |FINSI;
   |SINO;
      #agifa709#6 = "A";
   |FINSI;

   |GRABA 020#agifa709.n;
   |SI acota = 0;
      |ENTLINEAL #1#agifa709,-5,7,22,1,inf3,sup3;
   |SINO;
      |ENTLINEAL #1#agifa709,-5,7,22,1,InfAcota,SupAcota;
   |FINSI;
|FPRC;

|PROCESO Selec;

   |SI FSalida = 10;
      aAlfa = "hc" + Usuario; |NOME_DAT #agifa708#aAlfa#;
      |DELINDEX #agifa708;

      aAlfa = "gc" + Usuario; |NOME_DAT #agifa700#aAlfa#;
      |ABRE #agifa700;
      |ABRE #agifa702;
      |ABRE #agifa708;
      |ABRE #agifa709;

      SwDep = 0;
      |SI Campo = 3;  TipoCampo1 = "C"; TipoCampo2 = "C"; |FINSI;
      |SI Campo = 6;  TipoCampo1 = "D"; TipoCampo2 = "D"; |FINSI;
      |SI Campo = 8;  TipoCampo1 = "I"; TipoCampo2 = "I"; |FINSI;
      |SI Campo = 15; TipoCampo1 = "A"; TipoCampo2 = "A"; SwDep = 1; |FINSI;
      Linea = 1;
      |BUCLE Ficheros;

      |PUSHV 0501 2380;
      |PINPA #0#0;
      Salir = 0;
      |ENTLINEAL #1#agifa709,-5,7,22,1,inf3,sup3;
      |ENTLINEAL #2#agifa708,-1,4,13,1,inf2,sup2;

      |POPV;

      |CIERRA #agifa709;
      |CIERRA #agifa708;
      |CIERRA #agifa702;
      |CIERRA #agifa700;

      Comodin = "";
      |SI SwDep = 1; SwDep = 0; TipoCampo1 = "E"; TipoCampo2 = "E"; |FINSI;
      |BUCLE Interpreta;
      |SI TipoCampo1 = "C"; #agifa738#3  = Comodin; |PINTA #agifa738#3;  |FINSI;
      |SI TipoCampo1 = "D"; #agifa738#6  = Comodin; |PINTA #agifa738#6;  |FINSI;
      |SI TipoCampo1 = "I"; #agifa738#8  = Comodin; |PINTA #agifa738#8;  |FINSI;
      |SI TipoCampo1 = "E"; #agifa738#15 = Comodin; |PINTA #agifa738#15; |FINSI;

      |SI Comodin = ""; |ERROR; |FINSI;
      |PTEC 808; |PTEC 809;
   |FINSI;
   |SI FSalida = 11; |Y Campo = 8;
      |PUSHV 0501 2380;
      |CLS;
      |PINPA #0#agifa717; |PINDA #0#agifa717;
      |ATRI R; |PINTA 0502, " EDICION DE MEMORIAS PARA ENLACE      ";
      |ATRI N; |PINTA 0535, #agifa736#0;
      |ATRI N; |PINTA 0540, #agifa736#1;
      |ENTLINEAL #1#agifa717,-2,1,20,1,inf717,sup717;
      |POPV;
   |FINSI;
|FPRC;

|PROCESO Acotacion;
   Comodin = #agifa709#2; |QBF Comodin;
   |SI Comodin ! "";
      Comodin1 = #agifa709#2; |QBF Comodin1;
      Comodin1 = Comodin1 - "][";
      |SI FSalida ! 0;
         nPosic = FSalida;
         #agifa707#15 = #agifa736#0;
         #agifa707#0  = 1;
         |LEE 010#agifa707.=;
         |SI FSalida ! 0;
            LinAcot = 1;
         |SINO;
            |PARA; |SI FSalida = 0; |Y #agifa707#15 = #agifa736#0; |HACIENDO;
               LinAcot = #agifa707#0 + 1;
               |LEE 010#agifa707.s;
            |SIGUE;
         |FINSI;

         |DDEFECTO #agifa707;
         #agifa707#15 = #agifa736#0;
         #agifa707#16 = #agifa709#0;
         #agifa707#0 = LinAcot;
         Calc = ((nPosic / 100) ! 0) + 99;
         Comodin2 = Comodin1 % Calc; Comodin2 = Comodin2 - "[";
         #agifa707#13 = Comodin2; Comodin1 = Comodin1 - Comodin2;
         Comodin2 = Comodin1 - "[";
         Comodin2 = Comodin2 - "]";
         #agifa707#14 = Comodin2;

         |DBASE Direc; |QBF Direc;
         Direc = Direc + "def/" + #agifa707#13; |QBF Direc;
         Direc = Direc + ".mas"; |QBF Direc;
         |CARGA_DEF Direc, referen@;
         |SI FSalida = 0;
            |ABRE #referen@;
            Comodin1 = "|TITULO";
            #agifa707#1 = #referen@#Comodin1#;
            Comodin1 = #agifa707#14; |QBF Comodin1;
            Comodin1 = ("000" + Comodin1) % -103;
            Comodin2 = "|C" + Comodin1 + "TIPO";
            #agifa707#11 = #referen@#Comodin2#;
            Comodin2 = "|C" + Comodin1 + "LONGITUD";
            #agifa707#12 = #referen@#Comodin2#;
            Comodin2 = "|C" + Comodin1 + "NOMBRE";
            #agifa707#2 = #referen@#Comodin2#;
            Comodin2 = "|C" + Comodin1 + "MINIMO";
            |SI #agifa707#11 = "A"; #agifa707#3 = #referen@#Comodin2#; |FINSI;
            |SI #agifa707#11 = "N"; #agifa707#5 = #referen@#Comodin2#; |FINSI;
            |SI #agifa707#11 = "F"; #agifa707#7 = "01.01.1900";        |FINSI;
            Comodin2 = "|C" + Comodin1 + "MAXIMO";
            |SI #agifa707#11 = "A"; #agifa707#4 = #referen@#Comodin2#; |FINSI;
            |SI #agifa707#11 = "N"; #agifa707#6 = #referen@#Comodin2#; |FINSI;
            |SI #agifa707#11 = "F"; #agifa707#8 = "31.12.2999";        |FINSI;

            |SI #agifa707#11 = "A";
               Comodin = " " * #agifa707#12;
               Comodin1 = #agifa707#3; |QBF Comodin1;
               Comodin2 = #agifa707#4; |QBF Comodin2;
            |FINSI;

            |SI #agifa707#11 = "N";
               Comodin = "";
               Comodin1 = #agifa707#5; |QBF Comodin1;
               Comodin2 = #agifa707#6; |QBF Comodin2;
            |FINSI;

            |SI #agifa707#11 = "F";
               Comodin = "";
               Comodin1 = "   " + #agifa707#7; |QBF Comodin1;
               Comodin2 = "   " + #agifa707#8; |QBF Comodin2;
            |FINSI;

            |SI #agifa707#11 ! "F";
               Calc = 0 - (#agifa707#12 + 100);
               Comodin1 = (Comodin + Comodin1) % Calc;
               Comodin2 = (Comodin + Comodin2) % Calc;
            |FINSI;
            #agifa707#9  = Comodin1;
            #agifa707#10 = Comodin2;

            |GRABA 020#agifa707.n;
            |CIERRA #referen@;
            |DESCARGA_DEF #referen@;
         |FINSI;
      |FINSI;
   |FINSI;
|FPRC;

|DEFBUCLE Acotacion;
#agifa709#1;
;
#agifa736#0,#agifa737#2,#agifa738#2,"A",001;
#agifa736#0,#agifa737#2,#agifa738#2,"A",999;
;
NULL,Acotacion;
|FIN;

|PROCESO BorraAcot;
   |BORRA 020#agifa707.a;
|FPRC;

|DEFBUCLE BorraAcot;
#agifa707#1;
;
#agifa736#0,001;
#agifa736#0,999;
;
NULL,BorraAcot;
|FIN;

|PROCESO EscogeFich;

      ModoEntrada = (FEntrada / 100) ! 0;
      |SI ModoEntrada = 1;

         aAlfa = "hc" + Usuario; |NOME_DAT #agifa708#aAlfa#;
         |DELINDEX #agifa708;

         |ABRE #agifa700;
         |ABRE #agifa702;
         |ABRE #agifa708;
         |ABRE #agifa709;

         |BUCLE BorraAcot;
         Linea = 1;
         TipoCampo1 = " "; TipoCampo2 = "z";
         |BUCLE Ficheros;
         acota = 1; TipoCampo1 = "A"; TipoCampo2 = "A";
         #agifa737#2 = 1; #agifa738#2 = 1;

         |PUSHV 0501 2380;
         |PINPA #0#0;
         |ENTLINEAL #1#agifa709,-5,7,22,1,InfAcota,SupAcota;
         |ENTLINEAL #2#agifa708,-1,4,13,1,inf2,sup2;

         acota = 0;
         |PINDA #0#agifa707;
         |POPV;

         |CIERRA #agifa709;
         |CIERRA #agifa708;
         |CIERRA #agifa700;

         |BUCLE Acotacion;
         #agifa707#15 = #agifa736#0;
         #agifa707#0  = 1;
         |LEE 000#agifa707.];

      |SINO;

         TipoDato = #agifa707#11; LongDato = #agifa707#12;
         |SI TipoDato = "A";
            |CAMPO_ANCHO #agifa707#3,1,LongDato;
            |CAMPO_MAXIMO #agifa707#3,1,"#";
            |CAMPO_ANCHO #agifa707#4,1,LongDato;
            |CAMPO_MAXIMO #agifa707#4,1,"#";
            |C_M #agifa707#3,1,"S"; |C_V #agifa707#3,1,"S"; |PINTA #agifa707#3;
            |C_M #agifa707#4,1,"S"; |C_V #agifa707#4,1,"S"; |PINTA #agifa707#4;
            |C_M #agifa707#5,1,"N"; |C_V #agifa707#5,1,"N";
            |C_M #agifa707#6,1,"N"; |C_V #agifa707#6,1,"N";
            |C_M #agifa707#7,1,"N"; |C_V #agifa707#7,1,"N";
            |C_M #agifa707#8,1,"N"; |C_V #agifa707#8,1,"N";
         |FINSI;
         |SI TipoDato = "N";
            |C_M #agifa707#3,1,"N"; |C_V #agifa707#3,1,"N";
            |C_M #agifa707#4,1,"N"; |C_V #agifa707#4,1,"N";
            |C_M #agifa707#5,1,"S"; |C_V #agifa707#5,1,"S"; |PINTA #agifa707#5;
            |C_M #agifa707#6,1,"S"; |C_V #agifa707#6,1,"S"; |PINTA #agifa707#6;
            |C_M #agifa707#7,1,"N"; |C_V #agifa707#7,1,"N";
            |C_M #agifa707#8,1,"N"; |C_V #agifa707#8,1,"N";
         |FINSI;
         |SI TipoDato = "F";
            |C_M #agifa707#3,1,"N"; |C_V #agifa707#3,1,"N";
            |C_M #agifa707#4,1,"N"; |C_V #agifa707#4,1,"N";
            |C_M #agifa707#5,1,"N"; |C_V #agifa707#5,1,"N";
            |C_M #agifa707#6,1,"N"; |C_V #agifa707#6,1,"N";
            |C_M #agifa707#7,1,"S"; |C_V #agifa707#7,1,"S"; |PINTA #agifa707#7;
            |C_M #agifa707#8,1,"S"; |C_V #agifa707#8,1,"S"; |PINTA #agifa707#8;
         |FINSI;
      |FINSI;
|FPRC;

|PROCESO TomaValor; |TIPO 2;
   nFlag = 0 +. 1;
   |SI nFlag < 0; |ACABA; |FINSI;

   |SI TipoDato = "A"; #agifa707#9 = #agifa707#3; #agifa707#10 = #agifa707#4; |FINSI;
   |SI TipoDato = "N"; #agifa707#9 = #agifa707#5; #agifa707#10 = #agifa707#6; |FINSI;
   |SI TipoDato = "F"; #agifa707#9 = "   " + #agifa707#7; #agifa707#10 = "   "+ #agifa707#8; |FINSI;

   |SI Campo = 4; |O Campo = 6; |O Campo = 8;
      |C_M #agifa707#3,1,"N"; |C_V #agifa707#3,1,"N";
      |C_M #agifa707#4,1,"N"; |C_V #agifa707#4,1,"N";
      |C_M #agifa707#5,1,"N"; |C_V #agifa707#5,1,"N";
      |C_M #agifa707#6,1,"N"; |C_V #agifa707#6,1,"N";
      |C_M #agifa707#7,1,"N"; |C_V #agifa707#7,1,"N";
      |C_M #agifa707#8,1,"N"; |C_V #agifa707#8,1,"N";
                              |C_V #agifa707#9,1,"S";
                              |C_V #agifa707#10,1,"S";
   |FINSI;
|FPRC;

|PROCESO MiraEmpresas;
   Tecla = FSalida;
   |SI Tecla = 2; |ACABA; |FINSI;
   Comodin1 = Comodin + "def/canempre.mas";
   |CARGA_DEF Comodin1 , canempr@;
   |SI FSalida = 0;
      Comodin1 = Comodin + "fich/";
      |PATH_DAT #12 Comodin1;
      |ABRE #canempr@;
      |SI Tecla = 10;
         |CONSULTA_CLAVE #1#canempr@;
         |SI FSalida ] 0;
            #agifa736#4 = #canempr@#2; |PINTA #agifa736#4;
            #agifa736#5 = #canempr@#3; |PINTA #agifa736#5;
            MaxDig = 0;
            |SI MaxDig < #canempr@#14; MaxDig = #canempr@#14; Nivel = 1; |FINSI;
            |SI MaxDig < #canempr@#15; MaxDig = #canempr@#15; Nivel = 2; |FINSI;
            |SI MaxDig < #canempr@#16; MaxDig = #canempr@#16; Nivel = 3; |FINSI;
            |SI MaxDig < #canempr@#17; MaxDig = #canempr@#17; Nivel = 4; |FINSI;
            |SI MaxDig < #canempr@#18; MaxDig = #canempr@#18; Nivel = 5; |FINSI;
            |SI MaxDig < #canempr@#19; MaxDig = #canempr@#19; Nivel = 6; |FINSI;
         |FINSI;
      |SINO;
         #canempr@#2 = #agifa736#4;
         #canempr@#3 = #agifa736#5;
         |LEE 010#canempr@.=;
         |SI FSalida ! 0;
            |MENAV "    No existe empresa";
            |ERROR;
         |FINSI;
      |FINSI;
      |PINTA 1135, #canempr@#1;
      MaxDig = 0;
      |SI MaxDig < #canempr@#14; MaxDig = #canempr@#14; Nivel = 1; |FINSI;
      |SI MaxDig < #canempr@#15; MaxDig = #canempr@#15; Nivel = 2; |FINSI;
      |SI MaxDig < #canempr@#16; MaxDig = #canempr@#16; Nivel = 3; |FINSI;
      |SI MaxDig < #canempr@#17; MaxDig = #canempr@#17; Nivel = 4; |FINSI;
      |SI MaxDig < #canempr@#18; MaxDig = #canempr@#18; Nivel = 5; |FINSI;
      |SI MaxDig < #canempr@#19; MaxDig = #canempr@#19; Nivel = 6; |FINSI;
      |CIERRA #canempr@;
      |DESCARGA_DEF #canempr@;
   |SINO;
      |MENAV "    No puedo abrir el fichero de empresas";
      |ERROR;
   |FINSI;
|FPRC;

|PROCESO Mayus; |TIPO 0;
    #Fichero@#Campo# = #Fichero@#Campo# > #Fichero@#Campo#;
    |PINTA #Fichero@#Campo#;
|FPRC;

|PROCESO BajaL;
   |BORRA 020#agifa738.a;
|FPRC;

|DEFBUCLE BajaL;
#agifa738#1;
;
#agifa736#0,#agifa737#2,0001;
#agifa736#0,#agifa737#2,9999;
;
NULL,BajaL;
|FIN;

|PROCESO BajaLin; |TIPO 1;
   ModoEntrada = (FEntrada / 100) ! 0;
   |SI ModoEntrada = 3; |BUCLE BajaL; |FINSI;
|FPRC;

|PROCESO BorraExclus;
   |BORRA 020#agifa723.a;
|FPRC;

|DEFBUCLE BorraExclus;
#agifa723#1;
;
#agifa707#15,#agifa707#0,001;
#agifa707#15,#agifa707#0,999;
;
NULL,BorraExclus;
|FIN;

|PROCESO BajaAcota; |TIPO 1;
   ModoEntrada = (FEntrada / 100) ! 0;
   |SI ModoEntrada = 3;
      |ABRE #agifa709; |ABRE #agifa723;
      #agifa709#3 = #agifa707#15;
      #agifa709#4 = 1;
      #agifa709#5 = 1;
      #agifa709#6 = "A";
      #agifa709#0 = #agifa707#16;
      |LEE 010#agifa709.=;
      |SI FSalida = 0;
         |BORRA 020#agifa709.a;
      |FINSI;
      |CIERRA #agifa709;
      |BUCLE BorraExclus;
      |CIERRA #agifa723;
   |FINSI;
|FPRC;

|PROCESO MontaCuenta;
   Comodin = #agifa738#3; |QBF Comodin;
   Comodin = Comodin - ".";
   |SI FSalida ! 0;
      aLong = Comodin % 0; nLong = aLong;
      Calc = ((FSalida / 100) ! 0) + 99;
      Parte1 = Comodin % Calc;
      Parte2 = Comodin - Parte1;
      Calc = MaxDig - nLong;
      Comodin = "0" * Calc;
      #agifa738#3 = Parte1 + Comodin + Parte2;
      |PINTA #agifa738#3;
   |FINSI;
|FPRC;

|PROCESO agifa723;
   |SALVA_FICHA #agifa723;
   #agifa723#0 = #agifa710#0;
   |GRABA 020#agifa723.n;
   |REPON_FICHA #agifa723;
|FPRC;

|DEFBUCLE agifa723;
#agifa723#1;
;
#agifa736#0,001,001;
#agifa736#0,999,999;
;
NULL,agifa723;
|FIN;

|PROCESO agifa718;
   |SALVA_FICHA #agifa718;
   #agifa718#0 = #agifa710#0;
   |GRABA 020#agifa718.n;
   |REPON_FICHA #agifa718;
|FPRC;

|DEFBUCLE agifa718;
#agifa718#1;
;
#agifa736#0,"               ",001;
#agifa736#0,"zzzzzzzzzzzzzzz",999;
;
NULL,agifa718;
|FIN;

|PROCESO agifa717;
   |SALVA_FICHA #agifa717;
   #agifa717#0 = #agifa710#0;
   |GRABA 020#agifa717.n;
   |REPON_FICHA #agifa717;
|FPRC;

|DEFBUCLE agifa717;
#agifa717#1;
;
#agifa736#0,"               ";
#agifa736#0,"zzzzzzzzzzzzzzz";
;
NULL,agifa717;
|FIN;

|PROCESO agifa709;
   |SALVA_FICHA #agifa709;
   #agifa709#3 = #agifa710#0;
   |GRABA 020#agifa709.n;
   |REPON_FICHA #agifa709;
|FPRC;

|DEFBUCLE agifa709;
#agifa709#1;
;
#agifa736#0,000001,0001," ",001;
#agifa736#0,999999,9999,"z",999;
;
NULL,agifa709;
|FIN;

|PROCESO agifa707;
   |SALVA_FICHA #agifa707;
   #agifa707#15 = #agifa710#0;
   |GRABA 020#agifa707.n;
   |REPON_FICHA #agifa707;
|FPRC;

|DEFBUCLE agifa707;
#agifa707#1;
;
#agifa736#0,001;
#agifa736#0,999;
;
NULL,agifa707;
|FIN;

|PROCESO agifa738;
   |SALVA_FICHA #agifa738;
   #agifa738#0 = #agifa710#0;
   |GRABA 020#agifa738.n;
   |REPON_FICHA #agifa738;
|FPRC;

|DEFBUCLE agifa738;
#agifa738#1;
;
#agifa736#0,#agifa737#2,0001;
#agifa736#0,#agifa737#2,9999;
;
NULL,agifa738;
|FIN;

|PROCESO agifa737;
   |SALVA_FICHA #agifa737;
   #agifa737#0 = #agifa710#0;
   |GRABA 020#agifa737.n;
   |REPON_FICHA #agifa737;
   |BUCLE agifa738;
|FPRC;

|DEFBUCLE agifa737;
#agifa737#1;
;
#agifa736#0,000001;
#agifa736#0,999999;
;
NULL,agifa737;
|FIN;

|PROCESO Copia;
   |SALVA_FICHA #agifa736;
   #agifa736#0 = #agifa710#0;
   #agifa736#1 = #agifa710#1;
   |GRABA 020#agifa736.n;
   |REPON_FICHA #agifa736;
   |BUCLE agifa737;
   |BUCLE agifa707;
   |BUCLE agifa709;
   |BUCLE agifa717; |BUCLE agifa718;
   |BUCLE agifa723;
|FPRC;

|PROCESO MiraCopia;
   |SI FSalida = 10;
      |PUSHV 1032 1360;
      |PINPA #0#agifa710;
      |PINDA #0#agifa710;
      |ENDATOS #1#agifa710;
      |SI FSalida = 0;
         |HAZ Copia;
         #agifa736#0 = #agifa710#0;
         |LEE 010#agifa736.=;
         |SI FSalida = 0;
            |PINPA #0#0;
            |PINDA #0#0;
         |FINSI;
      |FINSI;
      |POPV;
   |FINSI;
|FPRC;

|PROCESO PintaApu; |TIPO 13;
   |ENTLINEAL #1#agifa738,-3,7,22,1,inf1,sup1;
|FPRC;

|PROCESO AntesTipo; |TIPO 7;
   |PUSHV 1129 1777;
   |BLANCO 1129 1777; |CUADRO 1129 1777;
   |ATRI R;
   |PINTA 1133, " B - Base              P - Cuota de IRPF  ";
   |PINTA 1233, " I - Cuota de Iva      D - Descuento      ";
   |PINTA 1333, " R - Cuota de Recargo  F - Total Registro ";
   |ATRI I;
   |PINTA 1433, " Para los enlaces de IVA es INDISPENSABLE ";
   |PINTA 1533, " que  la primera  linea  sea  la del Total";
   |PINTA 1633, " registro para su correcto funcionamiento ";
   |ATRI N;
|FPRC;

|PROCESO TrasTipo;
   |POPV;
   |SI #agifa738#13 = "B";
      |C_M #agifa738#16,1,"S";
   |SINO;
      |C_M #agifa738#16,1,"N"; #agifa738#16 = " ";
   |FINSI;
|FPRC;

|PROCESO AntesConcepto; |TIPO 7;
   ConcepAntes = #agifa738#5;
|FPRC;

|PROCESO BorraTempo;
   |BORRA 020#agifa709.a;
|FPRC;

|DEFBUCLE BorraTempo;
#agifa709#1;
;
#agifa738#0,#agifa738#1,#agifa738#2,"D",001;
#agifa738#0,#agifa738#1,#agifa738#2,"D",999;
;
NULL,BorraTempo;
|FIN;

|PROCESO TraeteConcepto;
   |SI ConcepAntes ! #agifa738#5;
      ConcepAntes = #agifa738#5;
      |ABRE #agifa709;
      |BUCLE BorraTempo;
      Comodin = #agifa736#6; |QBF Comodin;
      Comodin1 = Comodin - "contagen/";
      |SI FSalida ! 0;
         Comodin = Comodin1 + "modelos/";
         Comodin1 = Comodin + "def/dsmom030.mas";
         Comodin2 = Comodin + "fich/";
      |SINO;
         Comodin1 = Comodin + "def/caconcep.mas";
         Comodin2 = Comodin + "fich/" + (("00000" + #agifa736#4) % -105) + #agifa736#5 + "/";
      |FINSI;
      |CARGA_DEF Comodin1, caconce@;
      |SI FSalida = 0;
         |PATH_DAT #11 Comodin2;
         |ABRE #caconce@;
         #caconce@#0 = #agifa738#5;
         |LEE 000#caconce@.=;
         |SI FSalida = 0;
            #agifa738#6 = #caconce@#1; |PINTA #agifa738#6;
         |FINSI;
         |CIERRA #caconce@; |DESCARGA_DEF #caconce@;
      |FINSI;
      |DDEFECTO #agifa709;
      #agifa709#0 = 10;
      #agifa709#1 = #agifa738#6;
      #agifa709#2 = #agifa738#6;
      #agifa709#3 = #agifa738#0;
      #agifa709#4 = #agifa738#1;
      #agifa709#5 = #agifa738#2;
      #agifa709#6 = "D";
      |GRABA 020#agifa709.n;
      |CIERRA #agifa709;
   |FINSI;
|FPRC;

|PROCESO RecCampos;
   #agifa736#0 = #agifa707#15;
   |LEE 000#agifa736.=;
   |SI FSalida = 0;
      |DBASE Comodin; |QBF Comodin;
      Comodin = Comodin + "def/" + #agifa707#13 + ".mas";
      |CARGA_DEF Comodin, referen@;
      |SI FSalida = 0;
         Comodin  = ("000" + #agifa707#14) % -103;
         Comodin1 = "|C" + Comodin + "LONGITUD";
         Comodin1 = #referen@#Comodin1#;
         |SI Comodin1 ! #agifa707#12;
            #agifa707#12 = Comodin1; |GRABA 020#agifa707.a;
         |FINSI;
         |DESCARGA_DEF #referen@;
      |FINSI;
   |FINSI;
|FPRC;

|DEFBUCLE RecCampos;
#agifa707#1;
;
INICIO;
FINAL;
be;
NULL,RecCampos;
|FIN;

|PROCESO TamanyoPant; |TIPO 80;
   |ABRE #agifa737; |ABRE #agifa738;
   FSalida = 3299;
|FPRC;

|PROCESO Tipo90; |TIPO 90;
   |CIERRA #agifa737; |CIERRA #agifa738;

   |SI nLabel1 ! -1; |FIN_CONTROL_WINDOWS nLabel1; |FINSI;
   |SI nLabel2 ! -1; |FIN_CONTROL_WINDOWS nLabel2; |FINSI;
   |SI nLabel3 ! -1; |FIN_CONTROL_WINDOWS nLabel3; |FINSI;
   |SI nLabel4 ! -1; |FIN_CONTROL_WINDOWS nLabel4; |FINSI;
   |SI nLabel5 ! -1; |FIN_CONTROL_WINDOWS nLabel5; |FINSI;
   |SI nLabel6 ! -1; |FIN_CONTROL_WINDOWS nLabel6; |FINSI;
   |SI nLabelIntr ! -1; |FIN_CONTROL_WINDOWS nLabelIntr; |FINSI;
   |SI nLabelLin1 ! -1; |FIN_CONTROL_WINDOWS nLabelLin1; |FINSI;
   |SI nLabelLin2 ! -1; |FIN_CONTROL_WINDOWS nLabelLin2; |FINSI;
   |SI nGrid1  ! -1; |DESTRUYECONTROL nGrid1; |FINSI;
   |SI nGrid2  ! -1; |DESTRUYECONTROL nGrid2; |FINSI;
|FPRC;

|PROCESO RecalcCampos; |TIPO 8;
   |ABRE #agifa736; |ABRE #agifa707;
   |BUCLE RecCampos;
   |CIERRA #agifa707; |CIERRA #agifa736;
|FPRC;

|RUTINA inf723;
   #agifa723#0 = #agifa707#15;
   #agifa723#1 = #agifa707#0;
   #agifa723#2 = 1;
|FRUT;

|RUTINA sup723;
   #agifa723#0 = #agifa707#15;
   #agifa723#1 = #agifa707#0;
   #agifa723#2 = 999;
|FRUT;

|PROCESO Exclus; |TIPO 3;
   |PUSHV 0959 1979;
   |SI #agifa707#11 = "A";
      |C_V #agifa723#3,1,"S"; |C_M #agifa723#3,1,"S";
   |SINO;
      |C_V #agifa723#3,1,"N"; |C_M #agifa723#3,1,"N";
   |FINSI;
   |SI #agifa707#11 = "N";
      |C_V #agifa723#4,1,"S"; |C_M #agifa723#4,1,"S";
   |SINO;
      |C_V #agifa723#4,1,"N"; |C_M #agifa723#4,1,"N";
   |FINSI;
   |SI #agifa707#11 = "F";
      |C_V #agifa723#5,1,"S"; |C_M #agifa723#5,1,"S";
   |SINO;
      |C_V #agifa723#5,1,"N"; |C_M #agifa723#5,1,"N";
   |FINSI;
   |C_V #agifa723#6,1,"N";
   |ENTLINEAL #1#agifa723,-3,1,18,1,inf723,sup723;
   |C_V #agifa723#3,1,"N"; |C_M #agifa723#3,1,"N";
   |C_V #agifa723#4,1,"N"; |C_M #agifa723#4,1,"N";
   |C_V #agifa723#5,1,"N"; |C_M #agifa723#5,1,"N";
   |C_V #agifa723#6,1,"S";
   |POPV;
|FPRC;

|PROCESO AntesNumAcum; |TIPO 7;
   |SI #agifa738#13 = "F";
      |C_M #agifa738#14,1,"N";
   |SINO;
      |C_M #agifa738#14,1,"S";
   |FINSI;
|FPRC;

|PROCESO TrasNumAcum;
   |SI #agifa738#13 ! "B"; |Y #agifa738#14 = 6;
      |AVISO; |ERROR;
   |FINSI;
|FPRC;

|PROCESO TrasLibro704;
   |SI FSalida = 2; |ACABA; |FINSI;
   nTecla = FSalida;
   |SI #agifa736#2 = "I"; |ACABA; |FINSI;

   Comodin  = #agifa736#6; |QBF Comodin; Comodin  = Comodin + "def/";
   Comodin1 = Comodin + "calibros.mas"; |CARGA_DEF Comodin1, calibro@;

   Comodin = #agifa736#6; |QBF Comodin;
   Comodin1 = Comodin + "fich/" + ((("00000" + #agifa736#4) % -105) + #agifa736#5) + "/";
   |PATH_DAT #20 Comodin1;
   |ABRE #calibro@;
   |SI nTecla = 10;
      #calibro@#0 = #agifa736#14;
      |LEE 000#calibro@.];
      |CONSULTA_CLAVE #1#calibro@;
      |SI FSalida = 0;
         #agifa736#14 = #calibro@#0; |PINTA #agifa736#14;
         #agifa736#15 = #calibro@#1; |PINTA #agifa736#15;
      |FINSI;
   |FINSI;
   #calibro@#0 = #agifa736#14;
   |LEE 000#calibro@.=;
   |SI FSalida = 0;
      |SI #calibro@#2 = "S"; |Y #agifa736#2 ! "C";
         |MENAV "    Tipo de libro incorrecto";
         |ERROR;
      |FINSI;
      |SI #calibro@#2 = "R"; |Y #agifa736#2 ! "V"; |Y #agifa736#2 ! "D";
       |Y #agifa736#2 ! "T"; |Y #agifa736#2 ! "I"; |Y #agifa736#2 ! "R";
         |MENAV "    Tipo de libro incorrecto";
         |ERROR;
      |FINSI;
      #agifa736#15 = #calibro@#1; |PINTA #agifa736#15;
   |SINO;
      |MENAV "    Libro inexistente";
      |ERROR;
   |FINSI;
   |CIERRA #calibro@; |DESCARGA_DEF #calibro@;
|FPRC;

|PROCESO TrasSerie704;
   |SI #agifa736#2 = "I"; |ACABA; |FINSI;
   |SI #agifa736#9 = "N";  |ACABA; |FINSI;

   |PINTA 0420, "                                    ";
   Comodin  = #agifa736#6; |QBF Comodin; Comodin  = Comodin + "def/";
   Comodin1 = Comodin + "caivases.mas"; |CARGA_DEF Comodin1, caivses@;

   Comodin = #agifa736#6; |QBF Comodin;
   Comodin1 = Comodin + "fich/" + ((("00000" + #agifa736#4) % -105) + #agifa736#5) + "/";
   |PATH_DAT #21 Comodin1;
   |ABRE #caivses@;
   #caivses@#0 = #agifa736#11;
   |SI #agifa736#2 ! "C";
      #caivses@#1 = "S";
   |SINO;
      #caivses@#1 = "R";
   |FINSI;
   |LEE 000#caivses@.=;
   |SI FSalida = 0;
      #agifa736#13 = #caivses@#2; |PINTA #agifa736#13;
   |SINO;
      |MENAV "    Serie inexistente";
      |ERROR;
   |FINSI;
   |CIERRA #caivses@; |DESCARGA_DEF #caivses@;
|FPRC;

|PROCESO CogeDatos;
   Comodin = #agifa709#1; |QBF Comodin;
   |SI #agifa709#6 = "C"; aCuenta = aCuenta + Comodin; |FINSI;
   |SI #agifa709#6 = "D"; aDescri = aDescri + Comodin; |FINSI;
   |SI #agifa709#6 = "I"; aImport = aImport + Comodin; |FINSI;
   |SI #agifa709#6 = "E"; aDepart = aDepart + Comodin; |FINSI;
|FPRC;

|DEFBUCLE CogeDatos;
#agifa709#1;
;
#agifa738#0, #agifa738#1, #agifa738#2, " ", 001;
#agifa738#0, #agifa738#1, #agifa738#2, "z", 999;
;
NULL,CogeDatos;
|FIN;

|PROCESO MiraDep; |TIPO 7;
   |CAMPO_ANCHO #agifa738#15,1,2;
   |CAMPO_MAXIMO #agifa738#15,1,"#";
|FPRC;

|PROCESO ConsultaLibro; |TIPO 66;
   |CONSULTA_CLAVE #1#calibro@;
   #agifa736#14 = #calibro@#0; |PINTA #agifa736#14;
   #agifa736#15 = #calibro@#1; |PINTA #agifa736#15;
|FPRC;

|PROCESO PideLibro;
|ACABA;
   |SI FSalida = 2; |ACABA; |FINSI;

   |C_V #agifa736#9,  0, aAlfa;
   |SI aAlfa ! "N";
      |PUSHV 0901 0980;
      |PINTA 0904, " Libro IVA :                ";
      |C_P #agifa736#14,1,0917; |C_P #agifa736#15,1,0920;
      |C_M #agifa736#14,1,"S";  |C_V #agifa736#14,1,"S"; |PINTA #agifa736#14;
      |C_M #agifa736#15,1,"S";  |C_V #agifa736#15,1,"S"; |PINTA #agifa736#15;
      |PARA; |SI; |HACIENDO;
         |ENCAMPO #14#agifa736;
         |SI FSalida = 2; |O FSalida = 7; |SAL; |FINSI;

         Comodin  = #agifa736#6; |QBF Comodin; Comodin  = Comodin + "def/";
         Comodin1 = Comodin + "calibros.mas"; |CARGA_DEF Comodin1, calibro@;
         Comodin = #agifa736#6; |QBF Comodin;
         Comodin1 = Comodin + "fich/" + ((("00000" + #agifa736#4) % -105) + #agifa736#5) + "/";
         |PATH_DAT #20 Comodin1; |ABRE #calibro@;
         |SI FSalida = 10;
            |CONSULTA_CLAVE #1#calibro@;
            #agifa736#14 = #calibro@#0;
            #agifa736#15 = #calibro@#1;
            FSalida = 0;
         |FINSI;
         |SI FSalida = 0;
            #calibro@#0 = #agifa736#14;
            |LEE 000#calibro@.=;
            |SI FSalida = 0;
               |SI #calibro@#2 ! "S"; |Y #agifa736#2 = "C";
                  |MENAV "    Tipo de libro incorrecto"; |VETE Sigue;
               |FINSI;
               |SI #calibro@#2 = "R"; |Y #agifa736#2 ! "V"; |Y #agifa736#2 ! "D";
                |Y #agifa736#2 ! "T"; |Y #agifa736#2 ! "I";
                  |MENAV "    Tipo de libro incorrecto"; |VETE Sigue;
               |FINSI;
               #agifa736#15 = #calibro@#1; |PINTA #agifa736#15;
            |SINO;
               |MENAV "    Libro inexistente";  |VETE Sigue;
            |FINSI;
            |CONFI "    NConforme ? ";
            |SI FSalida = 0; |SAL; |FINSI;
   |ET Sigue;
         |FINSI;
         |CIERRA #calibro@; |DESCARGA_DEF #calibro@;
      |SIGUE;

      Calc = FSalida;
      |C_P #agifa736#14,1,0540; |C_P #agifa736#15,1,0550;
      |C_M #agifa736#14,1,"N";  |C_V #agifa736#14,1,"N";
      |C_M #agifa736#15,1,"N";  |C_V #agifa736#15,1,"N";
      |POPV;

      |SI Calc = 2; |O Calc = 7; |POSICIONATE #agifa736#8; |ACABA; |FINSI;
   |FINSI;

   |PUSHV 0501 2380;
   |BLANCO 1215 1470;
   |PINPA #0#agifa734; |PINDA #0#agifa734;
   |ENDATOS #1#agifa734;
   |SI FSalida = 0;
      #agifa736#19 = #agifa734#0;
      #agifa736#20 = #agifa734#1;
   |SINO;
      |POSICIONATE #agifa736#8;
   |FINSI;

   |C_M #agifa736#19, 1, "N"; |C_V #agifa736#19, 1, "N";
   |POPV;
   |SI Calc = 2; |O Calc = 7; |POSICIONATE #agifa736#8; |FINSI;
|FPRC;

|PROCESO Clave340; |TIPO 66;
     eaTipoEnlace = #agifa736#2;
     |HAZ PoPup340;
     |SI eaAlfa ! "";
          #agifa734#0 = eaAlfa % 101; |PINTA #agifa734#0;
          #agifa734#1 = eaAlfa % 3; |PINTA #agifa734#1;
     |FINSI;
|FPRC;


|PROCESO AntesAlbar; |TIPO 7;
   |C_M #agifa736#8,1,"S"; |ACABA;
/*
   |SI #agifa736#2 = "I";
      |C_M #agifa736#8,1,"N"; #agifa736#8 = "N"; |PINTA #agifa736#8;
   |SINO;
      |C_M #agifa736#8,1,"S";
   |FINSI;
*/
|FPRC;

|PROCESO MiraValor;
   |BLIN 4;
   |SI #agifa738#16 = " "; |ACABA; |FINSI;

   |SI #agifa736#8 = "S";
      |HAZ EsViarsa;
      |SI FSalida ! 0;
         |HAZ EsVipei;
         |SI FSalida ! 0;
            |HAZ EsConstru;
            |SI FSalida ! 0;
               |HAZ EsPalmHotel;
               |SI FSalida ! 0;
                  |HAZ EsCampoJerez;
                  |SI FSalida ! 0;
                     |SI #agifa738#16 = "C"; |O #agifa738#16 = "A"; |O #agifa738#16 = "L";
                        |MENAV "    Valor incorrecto.Solo puede ser <S>erie, <F>amilia o Blanco"; |ERROR;
                     |FINSI;
                  |FINSI;
               |FINSI;
            |SINO;
               |SI #agifa736#2 = "C";
                  |SI #agifa738#16 = "C";
                     |MENAV "    Valor incorrecto.Solo <S>erie,<F>amilia,<A>uxiliar,<L>Almacen o Blanco"; |ERROR;
                  |FINSI;
               |SINO;
                  |SI #agifa738#16 = "C"; |O #agifa738#16 = "L";
                     |MENAV "    Valor incorrecto.Solo puede ser <S>erie, <F>amilia, <A>uxiliar o Blanco"; |ERROR;
                  |FINSI;
               |FINSI;
            |FINSI;
         |SINO;
            |SI #agifa738#16 = "C"; |O #agifa738#16 = "L";
               |MENAV "    Valor incorrecto.Solo puede ser <S>erie, <F>amilia, <A>uxiliar o Blanco"; |ERROR;
            |FINSI;
         |FINSI;
      |SINO;
         |SI #agifa738#16 = "C"; |O #agifa738#16 = "L";
            |MENAV "    Valor incorrecto.Solo puede ser <S>erie, <F>amilia, <A>uxiliar o Blanco"; |ERROR;
         |FINSI;
      |FINSI;
   |SINO;
      |SI #agifa736#2 = "V"; |O #agifa736#2 = "C"; |O #agifa736#2 = "D"; |O #agifa736#2 = "T";
         |SI #agifa738#16 ! "S";
            |MENAV "    Valor incorrecto.Solo puede ser <S>erie o Blanco"; |ERROR;
         |FINSI;
      |SINO;
         |SI #agifa738#16 ! "C";
            |MENAV "    Valor incorrecto.Solo puede ser <C>aja o Blanco"; |ERROR;
         |FINSI;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO TomaDecims; |TIPO 13;
   |SI #agifa707#11 ! "N"; |ACABA; |FINSI;
   nLong = 0;

   |DBASE aAlfa; |QBF aAlfa;
   aAlfa = aAlfa + "def/" + #agifa707#13;
   |CARGA_DEF aAlfa, RefDato@;
   |SI FSalida = 0;
      aAlfa = "|C" + (("000" + #agifa707#14) % -103) + "MINIMO";
      aAlfa = #RefDato@#aAlfa#;
      aAlfa = aAlfa - ".";
      |SI FSalida ! 0;
         nCalc = FSalida; nCalc1 = nCalc + 98; aAlfa = aAlfa % nCalc1; |QBF aAlfa;
         aLong = aAlfa % 0; nLong = aLong;
         aAlfa1 = "9" * nLong;
         |SI aAlfa ! aAlfa1;
            aAlfa = "|C" + (("000" + #agifa707#14) % -103) + "MAXIMO";
            aAlfa = #RefDato@#aAlfa#;
            aAlfa = aAlfa - ".";
            |SI FSalida ! 0;
               nCalc1 = FSalida; nCalc1 = nCalc1 + 98; aAlfa = aAlfa % nCalc1; |QBF aAlfa;
            |FINSI;
            aLong = aAlfa % 0; nCalc1 = aLong;
            nCalc2 = (nCalc / 100) ! 0;
            |SI nCalc1 > nCalc2; nCalc = (nCalc1 + 1) * 100; |FINSI;
            nCalc1 = (nCalc / 100) ! 0; nLong = 15 - nCalc1;
         |FINSI;
      |FINSI;
      |DESCARGA_DEF #RefDato@;
   |FINSI;
   nDeci_nDec = nLong;
|FPRC;

|PROCESO Mensa; |TIPO 7;
   |SI #agifa736#8 = "S";
      |HAZ EsViarsa;
      |SI FSalida ! 0;
         |HAZ EsVipei;
         |SI FSalida ! 0;
            |HAZ EsConstru;
            |SI FSalida ! 0;
               |HAZ EsCampoJerez;
               |SI FSalida ! 0;
                  aAlfa = "    Recoger cuenta analitica: <S> De la serie, <F> De la familia, <C> De la caja";
               |SINO;
                  aAlfa = "    Recoger cta.analitica:<S> De serie,<F> De familia,<C> De caja, <A> Auxiliar ";
               |FINSI;
            |SINO;
               |SI #agifa736#2 = "C";
                  aAlfa = "    Recoger cuenta analitica: <S> Serie, <F> Familia, <C> Caja, <L> Almacen";
               |SINO;
                  aAlfa = "    Recoger cuenta analitica: <S> De la serie, <F> De la familia, <C> De la caja";
               |FINSI;
            |FINSI;
         |SINO;
              aAlfa = "    Recoger cta.analitica:<S> De serie,<F> De familia,<C> De caja, <A> Auxiliar ";
         |FINSI;
      |SINO;
         aAlfa = "    Recoger cta.analitica:<S> De serie,<F> De familia,<C> De caja, <A> Auxiliar ";
      |FINSI;
      |MENSA aAlfa;
   |SINO;
      aAlfa = "    Recoger cta.analitica:<S> De serie, < > No recogerla ";
   |FINSI;
|FPRC;

|PROCESO MiraCmpClave; |TIPO 11;
   |PINTA 0915, aCmpClv;

   |SI FSalida = 12;
      |SI #agifa736#2 = "V";
         |SI #agifa736#8 = "S";
            aFichP = "agifa071"; aFichC = "agifa010";
         |SINO;
            aFichP = "agifa134"; aFichC = "agifa134";
         |FINSI;
      |FINSI;
      |SI #agifa736#2 = "C";
         |SI #agifa736#8 = "S";
            aFichP = "agifa077"; aFichC = "agifa080";
         |SINO;
            aFichP = "agifa079"; aFichC = "agifa079";
         |FINSI;
      |FINSI;
      |SI #agifa736#2 = "D";
         |SI #agifa736#8 = "S";
            aFichP = "agifa084"; aFichC = "agifa069";
         |SINO;
            aFichP = "agifa084"; aFichC = "agifa084";
         |FINSI;
      |FINSI;
      |SI #agifa736#2 = "T";
         |SI #agifa736#8 = "S";
            aFichP = "agifa502"; aFichC = "agifa501";
         |SINO;
            aFichP = "agifa501"; aFichC = "agifa501";
         |FINSI;
      |FINSI;
      |SI #agifa736#2 = "I";
         aFichP = "agifa509"; aFichC = "agifa509";
      |FINSI;
      |SI #agifa736#2 = "R";
         |SI #agifa736#8 = "S";
            aFichP = "agifa572"; aFichC = "agifa571";
         |SINO;
            aFichP = "agifa571"; aFichC = "agifa571";
         |FINSI;
      |FINSI;
      aAlfa = #agifa707#13; |QBF aAlfa;
      |SI aAlfa = aFichP; |O aAlfa = aFichC;
         |SI #agifa736#17 ! 999;
            aAlfa = "    N" + &191 + " Desea cambiar el campo clave del enlace ? ";
            |CONFI aAlfa;
            |SI FSalida = 0;
               aAlfa = " Campo clave enlace : [" + #agifa707#1; |QBF aAlfa;
               aAlfa = aAlfa + "][" + #agifa707#2; |QBF aAlfa;
               aCmpClv = aAlfa + "]";
               |PINTA 0915, aCmpClv;
               #agifa736#16 = #agifa707#13; #agifa736#17 = #agifa707#14;
            |FINSI;
         |SINO;
            aAlfa = " Campo clave enlace : [" + #agifa707#1; |QBF aAlfa;
            aAlfa = aAlfa + "][" + #agifa707#2; |QBF aAlfa;
            aCmpClv = aAlfa + "]";
            |PINTA 0915, aCmpClv;
            #agifa736#16 = #agifa707#13; #agifa736#17 = #agifa707#14;
         |FINSI;
         |ERROR;
      |FINSI;
   |FINSI;
   |SI FSalida = 13; |Y #agifa736#17 ! 999;
      aAlfa = "    N" + &191 + " Desea vaciar el campo clave del enlace ? ";
      |CONFI aAlfa;
      |SI FSalida = 0;
         #agifa736#16 = ""; #agifa736#17 = 999;
         |GRABA 020#agifa736.a;
      |FINSI;
      aCmpClv = &196 * 60; |PINTA 0915, aCmpClv;
      |ERROR;
   |FINSI;
|FPRC;

|PROCESO MiraIntracom;
   |SI #agifa736#9 = "S";
      |C_V #agifa736#10, 1, "S"; |C_M #agifa736#10, 1, "S"; |PINTA #agifa736#10;
      |C_V #agifa736#11, 1, "S"; |C_M #agifa736#11, 1, "S"; |PINTA #agifa736#11;
   |SINO;
      |C_V #agifa736#10, 1, "N"; |C_M #agifa736#10, 1, "N";
      |C_V #agifa736#11, 1, "N"; |C_M #agifa736#11, 1, "N";
   |FINSI;
|FPRC;

|PROCESO EvtoGrid1;
   |SI FSalida = 1; |O FSalida = 2;
      |REFRESCACONTROL nGrid2;
   |FINSI;
|FPRC;

|PROCESO EvtoGrid2;
   |SI FSalida = 1; |O FSalida = 2;
      aCuenta = ""; aDescri = ""; aImport = ""; aDepart = "";
      |BUCLE CogeDatos;

      aAlfa = "LABEL,{{7}}" + aCuenta;
      |CONTROL_SIMPLE nPant0, aAlfa, 2746, 2795, NULL;

      aAlfa = "LABEL,{{7}}" + aDescri;
      |CONTROL_SIMPLE nPant0, aAlfa, 2946, 2995, NULL;

      aAlfa = "LABEL,{{7}}" + aImport;
      |CONTROL_SIMPLE nPant0, aAlfa, 3146, 3195, NULL;
   |FINSI;
|FPRC;

|PROCESO BotonSalir;
   |PTEC 807;
|FPRC;

|PROCESO BotonNuevo;
   |VENTANA 0921, 1375, -1 , 17, "Nuevo asiento"; nVent1 = FSalida;
   aVent1 = -1;
   aVent2 = -1;
   aVent3 = 0;
   aVent4 = nVent1;
   aVent5 = "MODAL";
   |ESPECIFICA "ESTADO_VENTANA", aVent;

   |DDEFECTO #agifa740; |DDEFECTO #agifa737;
   #agifa737#0 = #agifa736#0;
   #agifa737#2 = 999999;
   |LEE 000#agifa737.];
   |SI FSalida = 0;
      |LEE 000#agifa737.a;
   |SINO;
      |LEE 000#agifa737.u;
   |FINSI;
   |SI FSalida = 0; |Y #agifa737#0 = #agifa736#0;
      #agifa740#0 = #agifa737#2 + 1;
   |SINO;
      #agifa740#0 = 1;
   |FINSI;

   |DDEFECTO #agifa737;
   #agifa737#0 = #agifa736#0;
   #agifa737#2 = #agifa740#0;
   |GRABA 020#agifa737.b;
   |REFRESCACONTROL nGrid1;

   |PINPA #0#agifa740; |PINDA #0#agifa740;
   |ENDATOS #1#agifa740;
   |SI FSalida = 0;
      aVent4 = nVent1;
      aVent5 = "MODELESS";
      |ESPECIFICA "ESTADO_VENTANA", aVent;
      |FINVENTANA nVent1;

      #agifa737#3 = #agifa740#1;
      #agifa737#4 = #agifa740#2;
      #agifa737#5 = #agifa740#3;
      |GRABA 020#agifa737.a; |LIBERA #agifa737;
      |REFRESCACONTROL nGrid1;

      |ESTADO_CONTROL nBotonNuevo, "DISABLE"; |ESTADO_CONTROL nBotonModif, "DISABLE"; |ESTADO_CONTROL nBotonBorra, "DISABLE";
      |ESTADO_CONTROL nGrid1, "DISABLE";
      |ESTADO_CONTROL nBotAsNuevo, "ENABLE"; |ESTADO_CONTROL nBotAsModif, "ENABLE"; |ESTADO_CONTROL nBotAsBorra, "ENABLE";

      aEsc1  = &255 + "806";
      aEsc2  = &255 + "807";
      aRetu  = &255 + "802";
      |PARA; |SI;  |HACIENDO;
         FSalida = "::{{001}}Salir,"+nGrid2;
         |LEETECLA aTecla;
         |SI aTecla = aEsc1; |SAL; |FINSI;
         |SI aTecla = aEsc2; |SAL; |FINSI;
         |SI aTecla = aRetu; |SAL; |FINSI;
      |SIGUE;

      |ESTADO_CONTROL nBotonNuevo, "ENABLE"; |ESTADO_CONTROL nBotonModif, "ENABLE"; |ESTADO_CONTROL nBotonBorra, "ENABLE";
      |ESTADO_CONTROL nGrid1, "ENABLE";
      |ESTADO_CONTROL nBotAsNuevo, "DISABLE"; |ESTADO_CONTROL nBotAsModif, "DISABLE"; |ESTADO_CONTROL nBotAsBorra, "DISABLE";
   |SINO;
      |BORRA 020#agifa737.a; |LIBERA #agifa737;
      |REFRESCACONTROL nGrid1;

      aVent4 = nVent1;
      aVent5 = "MODELESS";
      |ESPECIFICA "ESTADO_VENTANA", aVent;
      |FINVENTANA nVent1
   |FINSI;
|FPRC;

|PROCESO BotonModif;
   |VENTANA 0921, 1375, -1 , 17, "Modificar asiento"; nVent1 = FSalida;
   aVent1 = -1;
   aVent2 = -1;
   aVent3 = 0;
   aVent4 = nVent1;
   aVent5 = "MODAL";
   |ESPECIFICA "ESTADO_VENTANA", aVent;

   #agifa740#1 = #agifa737#3;
   #agifa740#2 = #agifa737#4;
   #agifa740#3 = #agifa737#5;

   |PINPA #0#agifa740; |PINDA #0#agifa740;
   |ENDATOS #1#agifa740;
   |SI FSalida = 0;
      aVent4 = nVent1;
      aVent5 = "MODELESS";
      |ESPECIFICA "ESTADO_VENTANA", aVent;
      |FINVENTANA nVent1;

      #agifa737#3 = #agifa740#1;
      #agifa737#4 = #agifa740#2;
      #agifa737#5 = #agifa740#3;
      |GRABA 020#agifa737.a; |LIBERA #agifa737;
      |REFRESCACONTROL nGrid1;

      |ESTADO_CONTROL nBotonNuevo, "DISABLE"; |ESTADO_CONTROL nBotonModif, "DISABLE"; |ESTADO_CONTROL nBotonBorra, "DISABLE";
      |ESTADO_CONTROL nGrid1, "DISABLE";
      |ESTADO_CONTROL nBotAsNuevo, "ENABLE"; |ESTADO_CONTROL nBotAsModif, "ENABLE"; |ESTADO_CONTROL nBotAsBorra, "ENABLE";

      aEsc1  = &255 + "806";
      aEsc2  = &255 + "807";
      aRetu  = &255 + "802";
      |PARA; |SI;  |HACIENDO;
         FSalida = "::{{001}}Salir,"+nGrid2;
         |LEETECLA aTecla;
         |SI aTecla = aEsc1; |SAL; |FINSI;
         |SI aTecla = aEsc2; |SAL; |FINSI;
         |SI aTecla = aRetu; |SAL; |FINSI;
      |SIGUE;

      |ESTADO_CONTROL nBotonNuevo, "ENABLE"; |ESTADO_CONTROL nBotonModif, "ENABLE"; |ESTADO_CONTROL nBotonBorra, "ENABLE";
      |ESTADO_CONTROL nGrid1, "ENABLE";
      |ESTADO_CONTROL nBotAsNuevo, "DISABLE"; |ESTADO_CONTROL nBotAsModif, "DISABLE"; |ESTADO_CONTROL nBotAsBorra, "DISABLE";
   |SINO;
      aVent4 = nVent1;
      aVent5 = "MODELESS";
      |ESPECIFICA "ESTADO_VENTANA", aVent;
      |FINVENTANA nVent1
   |FINSI;
|FPRC;

|PROCESO BotonBorra;
   |LEE 000#agifa737.=;
   |SI FSalida = 0;
      aAlfa = "    NEsta punto de eliminar el asiento seleccionado. " + &191 + " Continuar ? ";
      |CONFI aAlfa;
      |SI FSalida = 0;
         ||BUCLE EliminaLineas;
         ||BUCLE EliminaMemorias;
         |BORRA 020#agifa737.a;

         |REFRESCACONTROL nGrid1;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO Poner;
|FPRC;

|PROCESO Quitar;
|FPRC;

|PROCESO Inf745;
   #agifa745#0 = aTipo;
   #agifa745#1 = " ";
   #agifa745#2 = "        ";
   #agifa745#3 = 000;
|FPRC;

|PROCESO Sup745;
   #agifa745#0 = aTipo;
   #agifa745#1 = " ";
   #agifa745#2 = "zzzzzzzz";
   #agifa745#3 = 255;
|FPRC;

|PROCESO SelCampos;
   |VENTANA 0816, 2281, -1 , 17, "Seleccion de campos"; nVent2 = FSalida;
   aVent1 = -1;
   aVent2 = -1;
   aVent3 = 0;
   aVent4 = nVent2;
   aVent5 = "MODAL";
   |ESPECIFICA "ESTADO_VENTANA", aVent;

   |PINPA #0#agifa744; nPant1 = FSalida;
   |PINDA #0#agifa744;

   nPos1 = 0664; nPos2 = 1265;
   |CONTROL_SIMPLE nPant1, "BOTON,{{231}}", nPos1, nPos2, Quitar;
   nBotonSel1 = FSalida;

   nPos1 = 1364; nPos2 = 1965;
   |CONTROL_SIMPLE nPant1, "BOTON,{{232}}", nPos1, nPos2, Poner;
   nBotonSel2 = FSalida;

   nRango = 4 + 8 + 16 + 32;
   nPos1 = 0602; nPos2 = 1462;
   |LINEAL_SIMPLE #1#agifa745, nRango, nPos1, nPos2, Inf745, Sup745, NULL;
   nGridSel = FSalida;

   |ENDATOS #1#agifa744;

   |DESTRUYECONTROL nGridSel;
   |FIN_CONTROL_WINDOWS nBotonSel1;
   |FIN_CONTROL_WINDOWS nBotonSel2;

   aVent4 = nVent2;
   aVent5 = "MODELESS";
   |ESPECIFICA "ESTADO_VENTANA", aVent;
   |FINVENTANA nVent2;
|FPRC;

|PROCESO Memorias;
|FPRC;

|PROCESO ActivaSel; |TIPO 7;
   |SI Campo = 2; |O Campo = 3; |O Campo = 5; |O Campo ] 10;
      |ESTADO_CONTROL nBotonSel, "DISABLE";
   |SINO;
      |ESTADO_CONTROL nBotonSel, "ENABLE";
   |FINSI;
|FPRC;

|PROCESO BotAsNuevo;
   |VENTANA 1108, 2088, -1 , 17, "Nueva linea de asiento"; nVent1 = FSalida;
   aVent1 = -1;
   aVent2 = -1;
   aVent3 = 0;
   aVent4 = nVent1;
   aVent5 = "MODAL";
   |ESPECIFICA "ESTADO_VENTANA", aVent;

   |DDEFECTO #agifa741; |DDEFECTO #agifa738;
   #agifa738#0 = #agifa737#0;
   #agifa738#1 = #agifa737#2;
   #agifa738#2 = 9999;
   |LEE 000#agifa738.];
   |SI FSalida = 0;
      |LEE 000#agifa738.a;
   |SINO;
      |LEE 000#agifa738.u;
   |FINSI;
   |SI FSalida = 0; |Y #agifa738#0 = #agifa737#0; |Y #agifa738#1 = #agifa737#2;
      #agifa741#0 = #agifa738#2 + 1;
   |SINO;
      #agifa741#0 = 1;
   |FINSI;

   |DDEFECTO #agifa738;
   #agifa738#0 = #agifa737#0;
   #agifa738#1 = #agifa737#2;
   #agifa738#2 = #agifa741#0;
   |GRABA 020#agifa738.b;
   |REFRESCACONTROL nGrid2;

   |PINPA #0#agifa741; nPant1 = FSalida;
   |PINDA #0#agifa741;
   |PTEC 802; |PAUSA;

   |CONTROL_SIMPLE nPant1, "BOTON,{{197}}Seleccion campos", 1460, 1480, SelCampos;
   nBotonSel = FSalida;
   |ESTADO_CONTROL nBotonSel, "DISABLE";

   |CONTROL_SIMPLE nPant1, "BOTON,{{197}}Memorias", 1438, 1458, Memorias;
   nBotonMem = FSalida;

   |ENDATOS #1#agifa741;
   |SI FSalida = 0;
      #agifa738#3 = #agifa741#1;
      #agifa738#4 = #agifa741#2;
      #agifa738#5 = #agifa741#3;
      #agifa738#6 = #agifa741#4;
      #agifa738#7 = #agifa741#5;
      #agifa738#8 = #agifa741#6;
      #agifa738#9 = #agifa741#7;
      #agifa738#10 = #agifa741#8;
      #agifa738#11 = #agifa741#9;
      #agifa738#12 = #agifa741#10;
      #agifa738#13 = #agifa741#11;
      #agifa738#14 = #agifa741#12;
      #agifa738#15 = #agifa741#13;
      #agifa738#16 = #agifa741#14;
      |GRABA 020#agifa738.a; |LIBERA #agifa738;
      |REFRESCACONTROL nGrid2;
   |SINO;
      |BORRA 020#agifa738.a; |LIBERA #agifa738;
   |FINSI;
   |FIN_CONTROL_WINDOWS nBotonSel;

   aVent4 = nVent1;
   aVent5 = "MODELESS";
   |ESPECIFICA "ESTADO_VENTANA", aVent;
   |FINVENTANA nVent1
|FPRC;

|PROCESO BotAsModif;
   |VENTANA 1108, 2088, -1 , 17, "Nueva linea de asiento"; nVent1 = FSalida;
   aVent1 = -1;
   aVent2 = -1;
   aVent3 = 0;
   aVent4 = nVent1;
   aVent5 = "MODAL";
   |ESPECIFICA "ESTADO_VENTANA", aVent;

   #agifa741#1  = #agifa738#3;
   #agifa741#2  = #agifa738#4;
   #agifa741#3  = #agifa738#5;
   #agifa741#4  = #agifa738#6;
   #agifa741#5  = #agifa738#7;
   #agifa741#6  = #agifa738#8;
   #agifa741#7  = #agifa738#9;
   #agifa741#8  = #agifa738#10;
   #agifa741#9  = #agifa738#11;
   #agifa741#10 = #agifa738#12;
   #agifa741#11 = #agifa738#13;
   #agifa741#12 = #agifa738#14;
   #agifa741#13 = #agifa738#15;
   #agifa741#14 = #agifa738#16;
   |PINPA #0#agifa741; nPant1 = FSalida;
   |PINDA #0#agifa741;
   |PTEC 802; |PAUSA;

   |CONTROL_SIMPLE nPant1, "BOTON,{{197}}Seleccion campos", 1460, 1480, SelCampos;
   nBotonSel = FSalida;
   |ESTADO_CONTROL nBotonSel, "DISABLE";

   |ENDATOS #1#agifa741;
   |SI FSalida = 0;
      #agifa738#3 = #agifa741#1;
      #agifa738#4 = #agifa741#2;
      #agifa738#5 = #agifa741#3;
      #agifa738#6 = #agifa741#4;
      #agifa738#7 = #agifa741#5;
      #agifa738#8 = #agifa741#6;
      #agifa738#9 = #agifa741#7;
      #agifa738#10 = #agifa741#8;
      #agifa738#11 = #agifa741#9;
      #agifa738#12 = #agifa741#10;
      #agifa738#13 = #agifa741#11;
      #agifa738#14 = #agifa741#12;
      #agifa738#15 = #agifa741#13;
      #agifa738#16 = #agifa741#14;
      |GRABA 020#agifa738.a; |LIBERA #agifa738;
      |REFRESCACONTROL nGrid2;
   |FINSI;

   |FIN_CONTROL_WINDOWS nBotonSel;

   aVent4 = nVent1;
   aVent5 = "MODELESS";
   |ESPECIFICA "ESTADO_VENTANA", aVent;
   |FINVENTANA nVent1
|FPRC;

|PROCESO BotAsBorra;
   |LEE 000#agifa738.=;
   |SI FSalida = 0;
      aAlfa = "    NEsta punto de eliminar la linea de asiento seleccionada. " + &191 + " Continuar ? ";
      |CONFI aAlfa;
      |SI FSalida = 0;
         ||BUCLE EliminaMemorias;
         |BORRA 020#agifa738.a;

         |REFRESCACONTROL nGrid2;
      |FINSI;
   |FINSI;
|FPRC;

|PROCESO PresentaLineas; |TIPO 13;
   |SI nPant0 = -1;
      |PINPA #0#0; nPant0 = FSalida;
      |PINDA #0#0;

      |PTEC 802; |PAUSA;

      |CONTROL_SIMPLE nPant0, "BOTON,{{137}}Nuevo", 3104, 3113, BotonNuevo;
      nBotonNuevo = FSalida;
      |ESTADO_CONTROL nBotonNuevo, "DISABLE";

      |CONTROL_SIMPLE nPant0, "BOTON,{{135}}Modificar", 3115, 3125, BotonModif;
      nBotonModif = FSalida;
      |ESTADO_CONTROL nBotonModif, "DISABLE";

      |CONTROL_SIMPLE nPant0, "BOTON,{{199}}Borra", 3127, 3136, BotonBorra;
      nBotonBorra = FSalida;
      |ESTADO_CONTROL nBotonBorra, "DISABLE";

      |CONTROL_SIMPLE nPant0, "BOTON,{{137}}Nuevo", 2441, 2451, BotAsNuevo;
      nBotAsNuevo = FSalida;
      |ESTADO_CONTROL nBotAsNuevo, "DISABLE";

      |CONTROL_SIMPLE nPant0, "BOTON,{{135}}Modificar", 2453, 2464, BotAsModif;
      nBotAsModif = FSalida;
      |ESTADO_CONTROL nBotAsModif, "DISABLE";

      |CONTROL_SIMPLE nPant0, "BOTON,{{199}}Borra", 2466, 2476, BotAsBorra;
      nBotAsBorra = FSalida;
      |ESTADO_CONTROL nBotAsBorra, "DISABLE";

      nRango = 4 + 8 + 16 + 32;
      nPos1 = 1604; nPos2 = 2939;
      |LINEAL_SIMPLE #1#agifa737, nRango, nPos1, nPos2, Inf737, Sup737, EvtoGrid1;
      nGrid1 = FSalida;

      nPos1 = 1641; nPos2 = 2296;
      |LINEAL_SIMPLE #1#agifa738, nRango, nPos1, nPos2, Inf738, Sup738, EvtoGrid2;
      nGrid2 = FSalida;
      |PULSATECLA;
   |FINSI;

   |SI #agifa736#17 ! 999;
      aCmpClv = &196 * 60;
      |DDEF aAlfa; |QBF aAlfa; aAlfa = aAlfa + #agifa736#16 + ".mas";
      |CARGA_DEF aAlfa, refere1@;
      |SI FSalida = 0;
         aCmpClv = " Campo clave enlace : ["; aAlfa1 = "|TITULO";
         aAlfa1 = #refere1@#aAlfa1#; aCmpClv = aCmpClv + aAlfa1 + "][";
         aAlfa1 = "|C" + (("000" + #agifa736#17) % -103) + "NOMBRE";
         aAlfa1 = #refere1@#aAlfa1#; aCmpClv = aCmpClv + aAlfa1 + "]";
         |DESCARGA_DEF #refere1@;
      |FINSI;
   |FINSI;

   aAlfa = "LABEL,{{7}}" + aCmpClv;
   |CONTROL_SIMPLE nPant0, aAlfa, 0704, 0736, NULL;
   nLabel1 = FSalida;

   |SI nLabelIntr ! -1; |FIN_CONTROL_WINDOWS nLabelIntr; nLabelIntr = -1; |FINSI;
   |SI #agifa736#9 = "S";
      aAlfa = "LABEL,{{7}}Enlace intracomunitario   Libro ";
      aAlfa = aAlfa + (("00" + #agifa736#10) % -102) + " " + #agifa736#12;
      aAlfa = aAlfa + "   Serie " + #agifa736#11 + " " + #agifa736#13;
   |SINO;
      aAlfa = "LABEL,{{7}} ";
   |FINSI;
   |CONTROL_SIMPLE nPant0, aAlfa, 1405, 1460, NULL;
   nLabelIntr = FSalida;

   |HAZ PintaEmpCont;
|FPRC;

|PROCESO PintaLibros;
   aAlfa = #agifa736#6; |QBF aAlfa; aAlfa = aAlfa < aAlfa;
   aAlfa = aAlfa - "contagen";
   |SI FSalida ! 0;
      |SI nLabel4 ! -1; |FIN_CONTROL_WINDOWS nLabel4; nLabel4 = -1; |FINSI;
      |SI nLabel5 ! -1; |FIN_CONTROL_WINDOWS nLabel5; nLabel5 = -1; |FINSI;
      |SI nLabel6 ! -1; |FIN_CONTROL_WINDOWS nLabel6; nLabel6 = -1; |FINSI;

      #agifa736#9 = "N";
      |C_M #agifa736#9,  1, "N"; |C_V #agifa736#9,  1, "N";
      |C_V #agifa736#10, 1, "N"; |C_M #agifa736#10, 1, "N"; |PINTA #agifa736#10;
      |C_V #agifa736#11, 1, "N"; |C_M #agifa736#11, 1, "N";
      |C_V #agifa736#12, 1, "N"; |C_V #agifa736#13, 1, "N";
   |SINO;
      |SI nLabel4 = -1;
         |SI nLabel3 ! -1; |FIN_CONTROL_WINDOWS nLabel3; nLabel3 = -1; |FINSI;
         |CONTROL_SIMPLE nPant0, "LABEL,{{7}}Enlace intracomunitario         Libro : ", 1105, 1131, NULL;
         nLabel4 = FSalida;

         |CONTROL_SIMPLE nPant0, "LABEL,{{7}}Serie : ", 1046, 1051, NULL;
         nLabel5 = FSalida;
      |FINSI;

      |C_V #agifa736#9,  1, "S"; |C_M #agifa736#9,  1, "S";
      |C_P #agifa736#9,1,1022; |PINTA #agifa736#9;
      |C_V #agifa736#10, 1, "S"; |C_M #agifa736#10, 1, "S";
      |C_P #agifa736#10,1,1029; |PINTA #agifa736#10;
      |C_V #agifa736#11, 1, "S"; |C_M #agifa736#11, 1, "S";
      |C_P #agifa736#11,1,1051; |PINTA #agifa736#11;
      |C_V #agifa736#12, 1, "S"; |C_P #agifa736#12,1,1032; |PINTA #agifa736#12;
      |C_V #agifa736#13, 1, "S"; |C_P #agifa736#13,1,1057; |PINTA #agifa736#13;
   |FINSI;
|FPRC;

|PROCESO TomaPath; |TIPO 7;
   aAlfa = #agifa736#6; |QBF aAlfa;
   |SI aAlfa = "";
      |DBASS Comodin; |QBF Comodin;
      Comodin = Comodin + "contagen/";
      #agifa736#6 = Comodin; |PINTA #agifa736#6;
   |FINSI;
|FPRC;

|PROCESO MiraPath;
   Comodin = #agifa736#6; |QBF Comodin;
   aLong = Comodin % 0; nLong = aLong;
   Calc = (nLong * 100) + 1;
   Comodin1 = Comodin % Calc;
   |SI Comodin1 ! "/"; |Y Comodin1 ! "\";
      Comodin = Comodin + "/";
      #agifa736#6 = Comodin; |PINTA #agifa736#6;
   |FINSI;

   aAlfa = #agifa736#6; |QBF aAlfa;
   aAlfa = aAlfa - "agicont";
   |SI FSalida = 0;
      #agifa736#9 = "N";
      #agifa736#10 = 0;  #agifa736#11 = "";
      #agifa736#12 = ""; #agifa736#13 = "";
   |FINSI;

   |SI nLabelIntr ! -1; |FIN_CONTROL_WINDOWS nLabelIntr; nLabelIntr = -1; |FINSI;
   |SI #agifa736#9 = "S";
      aAlfa = "LABEL,{{7}}Enlace intracomunitario   Libro ";
      aAlfa = aAlfa + (("00" + #agifa736#10) % -102) + " " + #agifa736#12;
      aAlfa = aAlfa + "   Serie " + #agifa736#11 + " " + #agifa736#13;
   |SINO;
      aAlfa = "LABEL,{{7}} ";
   |FINSI;
   |CONTROL_SIMPLE nPant0, aAlfa, 1405, 1460, NULL;
   nLabelIntr = FSalida;

|FPRC;

|PROCESO PideAyuda;
   |SI FSalida ! 10; |ACABA; |FINSI;

   |VENTANA 1115, 2386, -1 , 17, "Ayuda campo formato de fechas"; nVent1 = FSalida;
   aVent1 = -1;
   aVent2 = -1;
   aVent3 = 0;
   aVent4 = nVent1;
   aVent5 = "MODAL";
   |ESPECIFICA "ESTADO_VENTANA", aVent;

   |PINPA #0#agifa742; nPant1 = FSalida;

   aAlfa = "LABEL,{{6}}A) Formato automatico";
   |CONTROL_SIMPLE nPant1, aAlfa, 0504, 0569, NULL;
   nLabel4 = FSalida;
   aAlfa = "LABEL,{{7}}La fecha definida en el enlace se grabara  como fecha contable y en la fecha de registro";
   |CONTROL_SIMPLE nPant1, aAlfa, 0607, 0669, NULL;
   aAlfa = "LABEL,{{7}} se grabara la fecha del documento";
   |CONTROL_SIMPLE nPant1, aAlfa, 0707, 0769, NULL;

   aAlfa = "LABEL,{{6}}B) Manual";
   |CONTROL_SIMPLE nPant1, aAlfa, 0904, 0969, NULL;
   aAlfa = "LABEL,{{7}}Se pedira una fecha en el momento de enlazar y esta se grabara como fecha de registro y ";
   |CONTROL_SIMPLE nPant1, aAlfa, 1007, 1069, NULL;
   aAlfa = "LABEL,{{7}}la fecha definida en el enlace se grabara como fecha contable";
   |CONTROL_SIMPLE nPant1, aAlfa, 1107, 1169, NULL;

   aAlfa = "LABEL,{{6}}C) Manual contable";
   |CONTROL_SIMPLE nPant1, aAlfa, 1304, 1369, NULL;
   aAlfa = "LABEL,{{7}}Se pedira una fecha en el momento de enlazar y esta se grabara como fecha de registro y ";
   |CONTROL_SIMPLE nPant1, aAlfa, 1407, 1469, NULL;
   aAlfa = "LABEL,{{7}}como fecha contable";
   |CONTROL_SIMPLE nPant1, aAlfa, 1507, 1569, NULL;

   |PAUSA;

   |FIN_CONTROL_WINDOWS nLabel4;

   aVent4 = nVent1;
   aVent5 = "MODELESS";
   |ESPECIFICA "ESTADO_VENTANA", aVent;
   |FINVENTANA nVent1;
|FPRC;

|PROCESO PideLibros;
   aAlfa = #agifa736#6; |QBF aAlfa; aAlfa = aAlfa < aAlfa;
   aAlfa = aAlfa - "contagen";
   |SI FSalida = 0;
      |VENTANA 1011, 1479, -1 , 17, "Datos enlace intracomunitario"; nVent = FSalida;

      |PINPA #0#agifa739; nPant1 = FSalida;
      |PINDA #0#agifa739;

      |ENDATOS #1#agifa739;
      |SI FSalida = 0;
         #agifa736#9  = #agifa739#0;
         #agifa736#10 = #agifa739#1;
         #agifa736#11 = #agifa739#3;
         #agifa736#12 = #agifa739#2;
         #agifa736#13 = #agifa739#4;
      |FINSI;

      |FINVENTANA nVent;

      |SI nLabelIntr ! -1; |FIN_CONTROL_WINDOWS nLabelIntr; nLabelIntr = -1; |FINSI;

      |SI #agifa736#9 = "S";
         aAlfa = "LABEL,{{7}}Enlace intracomunitario   Libro ";
         aAlfa = aAlfa + (("00" + #agifa736#10) % -102) + " " + #agifa736#12;
         aAlfa = aAlfa + "   Serie " + #agifa736#11 + " " + #agifa736#13;
         |CONTROL_SIMPLE nPant0, aAlfa, 1105, 1160, NULL;
         nLabelIntr = FSalida;
      |FINSI;
   |FINSI;

   aAlfa = "|X000"; aAlfa = #agifa736#aAlfa#; nCalc = aAlfa; |ESTADO_CONTROL nCalc, "HIDE";
   aAlfa = "|X001"; aAlfa = #agifa736#aAlfa#; nCalc = aAlfa; |ESTADO_CONTROL nCalc, "HIDE";

   |ESTADO_CONTROL nBotonNuevo, "ENABLE"; |ESTADO_CONTROL nBotonModif, "ENABLE";
   |ESTADO_CONTROL nBotonBorra, "ENABLE";

   aEsc1  = &255 + "806";
   aEsc2  = &255 + "807";
   aRetu  = &255 + "802";
   |PARA; |SI;  |HACIENDO;
      FSalida = "::{{001}}Salir,"+nGrid1;
      |LEETECLA aTecla;
      |SI aTecla = aEsc1; |SAL; |FINSI;
      |SI aTecla = aEsc2; |SAL; |FINSI;
      |SI aTecla = aRetu; |SAL; |FINSI;
   |SIGUE;

   |ESTADO_CONTROL nBotonNuevo, "DISABLE"; |ESTADO_CONTROL nBotonModif, "DISABLE";
   |ESTADO_CONTROL nBotonBorra, "DISABLE";

   aAlfa = "|X000"; aAlfa = #agifa736#aAlfa#; nCalc = aAlfa; |ESTADO_CONTROL nCalc, "SHOW";
   aAlfa = "|X001"; aAlfa = #agifa736#aAlfa#; nCalc = aAlfa; |ESTADO_CONTROL nCalc, "SHOW";
/*
   aAlfa = "    S" + &191 + " Es correcto ?";
   |CONFI aAlfa;
   |SI FSalida = 0;
      |PTEC 801;
   |SINO;
      |PTEC 807;
   |FINSI;
*/

   |PULSATECLA;
   |PTEC 801;
|FPRC;

|PROCESO MiraEnlace;
   |SI #agifa739#0 = "S";
      |C_M #agifa739#1, 1, "S"; |C_M #agifa739#3, 1, "S";
   |SINO;
      #agifa739#1 = 0;  #agifa739#2 = "";
      #agifa739#3 = ""; #agifa739#4 = "";
      |C_M #agifa739#1, 1, "N"; |C_M #agifa739#3, 1, "N";
      |PINDA #0#agifa739;
   |FINSI;
|FPRC;

|PROCESO Tipo00Libro;
   |SI #agifa739#0 = "N"; |ACABA; |FINSI;

   Comodin  = #agifa736#6; |QBF Comodin; Comodin  = Comodin + "def/";
   Comodin1 = Comodin + "calibros.mas"; |CARGA_DEF Comodin1, calibro@;
   Comodin = #agifa736#6; |QBF Comodin;
   Comodin1 = Comodin + "fich/" + ((("00000" + #agifa736#4) % -105) + #agifa736#5) + "/";
   |PATH_DAT #20 Comodin1; |ABRE #calibro@;

   #calibro@#0 = #agifa739#1;
   |LEE 000#calibro@.=;
   |SI FSalida = 0;
      |SI #calibro@#2 ! "R"; |Y #agifa736#2 = "C";
         |MENAV "    Tipo de libro incorrecto"; |ERROR;
      |FINSI;
      |SI #calibro@#2 = "S"; |Y #agifa736#2 ! "V"; |Y #agifa736#2 ! "D";
       |Y #agifa736#2 ! "T"; |Y #agifa736#2 ! "I";
         |MENAV "    Tipo de libro incorrecto"; |ERROR;
      |FINSI;
      #agifa739#2 = #calibro@#1; |PINTA #agifa739#2;
   |SINO;
      |MENAV "    Libro inexistente";  |ERROR;
   |FINSI;
   |CIERRA #calibro@; |DESCARGA_DEF #calibro@;
|FPRC;

|PROCESO Tipo66Libro; |TIPO 66;
   Comodin  = #agifa736#6; |QBF Comodin; Comodin  = Comodin + "def/";
   Comodin1 = Comodin + "calibros.mas"; |CARGA_DEF Comodin1, calibro@;
   Comodin = #agifa736#6; |QBF Comodin;
   Comodin1 = Comodin + "fich/" + ((("00000" + #agifa736#4) % -105) + #agifa736#5) + "/";
   |PATH_DAT #20 Comodin1; |ABRE #calibro@;

   |CONSULTA_CLAVE #1#calibro@;
   |SI FSalida = 0;
      #agifa739#1 = #calibro@#0; |PINTA #agifa739#1;
      #agifa739#2 = #calibro@#1; |PINTA #agifa739#2;
   |SINO;
      |ERROR;
   |FINSI;

   |CIERRA #calibro@; |DESCARGA_DEF #calibro@;
|FPRC;

|PROCESO Tipo00Serie;
   |SI #agifa739#0 = "N"; |ACABA; |FINSI;

   Comodin  = #agifa736#6; |QBF Comodin; Comodin  = Comodin + "def/";
   Comodin1 = Comodin + "caivases.mas"; |CARGA_DEF Comodin1, caivses@;
   Comodin = #agifa736#6; |QBF Comodin;
   Comodin1 = Comodin + "fich/" + ((("00000" + #agifa736#4) % -105) + #agifa736#5) + "/";
   |PATH_DAT #21 Comodin1; |ABRE #caivses@;

   #caivses@#0 = #agifa739#3;
   |SI #agifa736#2 = "C"; #caivses@#1 = "R"; |FINSI;
   |SI #agifa736#2 ! "C"; #caivses@#1 = "S"; |FINSI;
   |LEE 000#caivses@.=;
   |SI FSalida = 0;
      #agifa739#4 = #caivses@#2; |PINTA #agifa739#4;
   |SINO;
      |MENAV "    Serie inexistente";  |ERROR;
   |FINSI;
   |CIERRA #caivses@; |DESCARGA_DEF #caivses@;
|FPRC;

|PROCESO Tipo66Serie; |TIPO 66;
   Comodin  = #agifa736#6; |QBF Comodin; Comodin  = Comodin + "def/";
   Comodin1 = Comodin + "caivases.mas"; |CARGA_DEF Comodin1, caivses@;
   Comodin  = #agifa736#6; |QBF Comodin;
   Comodin1 = Comodin + "fich/" + ((("00000" + #agifa736#4) % -105) + #agifa736#5) + "/";
   |PATH_DAT #21 Comodin1; |ABRE #caivses@;

   |CONSULTA_CLAVE #1#caivses@;
   |SI FSalida = 0;
      #agifa739#3 = #caivses@#0; |PINTA #agifa739#3;
      #agifa739#4 = #caivses@#2; |PINTA #agifa739#4;
   |SINO;
      |ERROR;
   |FINSI;

   |CIERRA #caivses@; |DESCARGA_DEF #caivses@;
|FPRC;

|PROCESO Tipo02F737; ||TIPO 2;
|FPRC;

|PROCESO MiraRegs; |TIPO 7;
|FPRC;
