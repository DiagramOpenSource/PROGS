|FICHEROS;
     gopre016 #0;
     gopre017 #1;
     gopre018 #2,MANTE;
     gopre019 #3,MANTE;

     gopre001 #11;
     gopre002 #12;
     gopre003 #13;
     gopre004 #14;
     goparame #100;
|FIN;

|VARIABLES;
     nSwNuevo = 0;
     nBajaCab = 0;
     i = 0;
     nSw = 0;
     &eaSer = "";
     &enNum = 0;
     &cCodMonTrab = "";
     nTotalTrasBaja = 0;
     nTotalTrasDto = 0;
     nModo = 0;
     nForma = 0;
     aAlfa = "";
     nConta = 0;
     nImproye = 0;
     nImpresu = 0
     nPEM = 0;
     C5 = 0;
     C28 = 0;
     C43 = 0;
     C45 = 0;
|FIN;

|PROCESO Min2;
     #2#0 = #1#0;
     #2#1 = #1#1;
     #2#2 = #1#2;
     #2#3 = 001;
|FPRC;

|PROCESO Min3;
     #3#0 = #2#0;
     #3#1 = #2#1;
     #3#2 = #2#2;
     #3#3 = #2#3;
     #3#4 = 001;
|FPRC;

|PROCESO Max2;
     #2#0 = #1#0;
     #2#1 = #1#1;
     #2#2 = #1#2;
     #2#3 = 999;
|FPRC;

|PROCESO Max3;
     #3#0 = #2#0;
     #3#1 = #2#1;
     #3#2 = #2#2;
     #3#3 = #2#3;
     #3#4 = 999;
|FPRC;

|PROCESO Escape; |TIPO 11;
     |SI FSalida = 7;
          |ERROR;
     |FINSI;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO Presu4;
     nImproye = #14#12 * #13#7;

||     C5 = #14#11; ||Total Venta
     C5 = #14#12 * #13#7; ||Total Venta
     C28 = #0#21; ||%Descuento Baja
     C43 = #0#18; ||%Descuento
     C45 = #0#20; ||%PEM

     /* COPIADO DEL ANEXO */
     nTotalTrasBaja = C5 -(((C5 * C28)/100) ! 2);
     nTotalTrasDto = nTotalTrasBaja - (((nTotalTrasBaja * C43)/100) ! 2);
     nPEM = (nTotalTrasDto / (1 + (C45/100))) ! 2;

     nImpresu = nPEM;

     nConta = nConta + 1;
     |DDEFECTO #3;
     #3#0 = #2#0;
     #3#1 = #2#1;
     #3#2 = #2#2;
     #3#3 = #2#3;
     |SI #0#2 = "S";
          #3#4 = #14#4;
          #3#5 = #14#5;
          #3#6 = #14#6;

          #3#7 = nImproye;
          #3#8 = nImpresu;
          #3#9 = nImpresu;

          |GRABA 000#3n;
          |SI FSalida ! 0;
               |BORRA 020#3c;
               |GRABA 020#3n;
          |FINSI;
     |SINO;
          #3#4 = 1;
          |LEE 101#3=;
          |SI FSalida ! 0; |GRABA 020#3b; |FINSI;
          #3#5 = ".PA";
          #3#6 = "MATERIALES";

          #3#7 = #3#7 + nImproye;
          #3#8 = #3#7 + nImpresu;
          #3#9 = #3#7 + nImpresu;

          |GRABA 020#3a;
          |LIBERA #3;
     |FINSI;
     nSw = 1;
     |HAZ Tipo19_2;
     nSw = 0;
|FPRC;

|DEFBUCLE Presu4;
     #14#1;
     ;
     #13#0, #13#1, #13#2, #13#4, 001;
     #13#0, #13#1, #13#2, #13#4, 999;
     ;
     NULL, Presu4;
|FIN;

|PROCESO Presu3;
     |DDEFECTO #2;
     #2#0 = #1#0;
     #2#1 = #1#1;
     #2#2 = #1#2;
     #2#3 = #13#3;
     #2#4 = #13#4;
     #2#5 = #13#5;
     |BUCLE Presu4;
     |GRABA 020#2n;
|FPRC;

|DEFBUCLE Presu3;
     #13#1;
     ;
     #12#0, #12#1, #12#12, 001;
     #12#0, #12#1, #12#12, 999;
     ;
     NULL, Presu3;
|FIN;

|PROCESO Presu2;
     |DDEFECTO #1;
     #1#0 = #0#0;
     #1#1 = #0#1;
     #1#2 = #12#2;
     #1#3 = #12#12;
     #1#4 = #12#13;
     |BUCLE Presu3;
     |GRABA 020#1n;
|FPRC;

|PROCESO Presu1;
     nConta = 0;

     #0#3 = #11#2;
     #0#4 = #11#3;
     #0#5 = #11#4;   ||F.Proyecto
     #0#6 = ~;       ||F.Estudio
     #0#7 = #11#4;   ||F.Presu

     #0#8 = 0;       ||T.Pry
     #0#9 = 0;       ||T.Estu
     #0#10 = 0;      ||T.Presu

     #0#11 = #11#7;
     #0#12 = #11#8;
     #0#13 = #11#18;
     #0#14 = #11#19;
     #0#15 = #11#20;
     #0#16 = #11#26;
     #0#17 = #11#27;
||     #0#18 = #11#28;
     #0#18 = #11#43;
     #0#19 = #11#41;
     #0#20 = #11#45;
||     #0#21 = #11#48;
     #0#21 = #11#28;
|FPRC;

|DEFBUCLE Presu1;
     #11#1;
     ;
     #0#0, #0#1;
     #0#0, #0#1;
     ;
     NULL, Presu1, Presu2;
|FIN;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO Borra19;
     nConta = nConta + 1;

     #2#6 = #2#6 - #3#7;
     #2#7 = #2#7 - #3#8;
     #2#8 = #2#8 - #3#9;

     #1#5 = #1#5 - #3#7;
     #1#6 = #1#6 - #3#8;
     #1#7 = #1#7 - #3#9;

     #0#8 = #0#8 - #3#7;
     #0#9 = #0#9 - #3#8;
     #0#10 = #0#10 - #3#9;

     |BORRA 020#3a;
|FPRC;

|DEFBUCLE Borra19;
     #3#1;
     ;
     #2#0, #2#1, #2#2, #2#3, 001;
     #2#0, #2#1, #2#2, #2#3, 999;
     be;
     NULL, Borra19;
|FIN;

|PROCESO Borra18;
     |BUCLE Borra19;
     |BORRA 020#2a;
|FPRC;

|DEFBUCLE Borra18;
     #2#1;
     ;
     #1#0, #1#1, #1#2, 001;
     #1#0, #1#1, #1#2, 999;
     be;
     NULL, Borra18;
|FIN;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO Lin19; |TIPO 0;
     nModo = (FEntrada / 100) ! 0;
     |SI FSalida = 0; |Y #3Campo = Contenido; |Y nModo = 1;
          |MENAV "0000Alta no permitida...";
          |ERROR; |ACABA;
     |FINSI;
|FPRC;

|PROCESO Tipo19_13; |TIPO 13;
     |PINTA 2345, #2#6;
     |PINTA 2357, #2#7;
     |PINTA 2369, #2#8;
|FPRC;

|PROCESO Tipo19_2; |TIPO 2;
     nModo = (FEntrada / 100) ! 0;
     nForma = 0 +. 1;
     |SI nSw = 0;
          |SI nModo = 1; |O nModo = 3;
               |SI nForma = -1;
                    |MENAV "0000Baja no permitida...";
               |FINSI;
               |ERROR; |ACABA;
          |FINSI;
     |FINSI;

     #2#6 = #2#6 +. #3#7;
     #2#7 = #2#7 +. #3#8;
     #2#8 = #2#8 +. #3#9;

     #1#5 = #1#5 +. #3#7;
     #1#6 = #1#6 +. #3#8;
     #1#7 = #1#7 +. #3#9;

     #0#8 = #0#8 +. #3#7;
     #0#9 = #0#9 +. #3#8;
     #0#10 = #0#10 +. #3#9;

     |HAZ Tipo19_13;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO Lin18; |TIPO 0;
     nModo = (FEntrada / 100) ! 0;
     |SI FSalida = 0; |Y #2Campo = Contenido; |Y nModo = 1;
          |MENAV "0000Alta no permitida...";
          |ERROR; |ACABA;
     |FINSI;
     |SI FSalida = 0; |Y #2Campo = Contenido; |Y nModo ! 2;
          |PUSHV 0501 2380;
          |ENTLINEAL #1#3, 5, nModo, 21, 1, Min3, Max3;
          |POPV;
          |PINTA #2#6;
          |PINTA #2#7;
          |PINTA #2#8;
     |FINSI;
|FPRC;

|PROCESO Tipo18_13; |TIPO 13;
     |PINTA 2345, #1#5;
     |PINTA 2357, #1#6;
     |PINTA 2369, #1#7;
|FPRC;

|PROCESO Tipo18_2; |TIPO 2;
     nModo = (FEntrada / 100) ! 0;
     nForma = 0 +. 1;
     |SI nModo = 1; |O nModo = 3;
          |SI nForma = -1;
               |MENAV "0000Baja no permitida...";
          |FINSI;
          |ERROR; |ACABA;
     |FINSI;
     |SI nModo = 2; |Y nForma = -1;
          |PUSHV 0501 2380;
          |ENTLINEAL #1#3, 5, nModo, 21, 1, Min3, Max3;
          |POPV;
     |FINSI;
     |SI nModo = 3;
          |BUCLE Borra19;
     |FINSI;
     |HAZ Tipo18_13;
     |PINTA #2#6;
     |PINTA #2#7;
     |PINTA #2#8;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO Lin17; |TIPO 0;
     nModo = (FEntrada / 100) ! 0;
     |SI FSalida = 0; |Y #1Campo = Contenido; |Y nModo = 1;
          |MENAV "0000Alta no permitida...";
          |ERROR; |ACABA;
     |FINSI;
     |SI FSalida = 0; |Y #1Campo = Contenido; |Y nModo ! 2;
          |PUSHV 0501 2380;
          |ENTLINEAL #1#2, 4, nModo, 21, 1, Min2, Max2;
          |POPV;
          |HAZ PinTotal;
     |FINSI;
|FPRC;

|PROCESO Tipo5; |TIPO 5;
     nBajaCab = 0;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 1; |Y nSwNuevo = 1;
          nSwNuevo = 0;
          |ABRE #2;
          |ABRE #3;
          |BUCLE Presu1;
          aAlfa = "0000Lineas [" + nConta + "]";
          ||MENAV aAlfa;
          |CIERRA #2;
          |CIERRA #3;
          |PINDA #0#0;
          |HAZ PinTotal;
     |FINSI;
|FPRC;

|PROCESO Tipo17_2; |TIPO 2;
     nModo = (FEntrada / 100) ! 0;
     nForma = 0 +. 1;
     |SI nBajaCab ! 3;
          |SI nModo = 1; |O nModo = 3;
               |SI nForma = -1;
                    |MENAV "0000Baja no permitida...";
               |FINSI;
               |ERROR; |ACABA;
          |FINSI;
          |SI nModo = 2; |Y nForma = -1;
               |PUSHV 0501 2380;
               |ENTLINEAL #1#2, 4, nModo, 21, 1, Min2, Max2;
               |POPV;
          |FINSI;
     |FINSI;
     |SI nModo = 3;
          nConta = 0;
          |BUCLE Borra18;
          aAlfa = "0000Lineas [" + nConta + "]";
          ||MENAV aAlfa;
     |FINSI;
     |HAZ PinTotal;
|FPRC;
컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
|PROCESO PinTotal;
     |PINTA #0#8;
     |PINTA #0#9;
     |PINTA #0#10;

     |PINTA #1#5;
     |PINTA #1#6;
     |PINTA #1#7;
|FPRC;

|PROCESO Tipo16_13; |TIPO 13;
     cCodMonTrab = #0#11;
     |HAZ MonBas;
     |ABRE #100; |LEE 000#100p; |CIERRA #100;
     |SI #100#141 = "O";
          |PINTA 503, "O.E...........:";
          |ATRI R; |PINTA 1269, "O.E.       "; |ATRI 0;
     |FINSI;
|FPRC;

|PROCESO Tipo16_2; |TIPO 2;
     nBajaCab = (FEntrada / 100) ! 0;
|FPRC;

|PROCESO NoModi; |TIPO 7;
     nSwNuevo = 1;
     nModo = (FEntrada / 100) ! 0;
     |PARA i = 3; |SI i [ 21; |HACIENDO i = i + 1;
          |C_M #0i, 1, "N";
     |SIGUE;
     |SI nModo = 2;
          |C_M #0#3, 1, "S";
          |C_M #0#4, 1, "S";
          |C_M #0#5, 1, "S";
          |C_M #0#6, 1, "S";
          |C_M #0#7, 1, "S";
          |C_M #0#12, 1, "S";
          |C_M #0#13, 1, "S";
          |C_M #0#14, 1, "S";
          |C_M #0#15, 1, "S";
          |C_M #0#19, 1, "S";
     |FINSI;
|FPRC;

|PROCESO Tipo4; |TIPO 4;
     eaSer = #0#0;
     enNum = #0#1;
     |SUB_EJECUTA "gopre020";
|FPRC;
