||Cambiar "aAno" antes de cada cierre de ejercicio.
||y volver a compilar toda la aplicacion.

|FICHEROS;
     iberz009 #0;
     agifa007 #7;
     agifa505 #505;
     iber0016 #16;
     agifa046 #46;
|FIN;

|VARIABLES;
     nSw       = 0;
     aOrg      = "";
     aDes      = "";
     aAlfa     = "";
     aLon      = "";
     aEmp      = "";
     aBase     = "";
     aFic      = "";
     nNum      = 0;
     fFecha    = @;
     aAno      = "";
     nAny = 0;
     aDirDes = "";
|FIN;

|PROCESO iber0016;
     aAlfa = #16#11;
     aAlfa = aAlfa % 104; aAlfa = aAlfa + aAno;
     #16#11 = aAlfa;

     aAlfa = #16#12;
     aAlfa = aAlfa % 104; aAlfa = aAlfa + aAno;
     #16#12 = aAlfa;

     aAlfa = #16#13;
     aAlfa = aAlfa % 104; aAlfa = aAlfa + aAno;
     #16#13 = aAlfa;

     aAlfa = #16#16;
     aAlfa = aAlfa % 104; aAlfa = aAlfa + aAno;
     #16#16 = aAlfa;

     |GRABA 020#16a;
     |LIBERA #16;
|FPRC;

|DEFBUCLE iber0016;
     #16#1;
     ;
     INICIO;
     FINAL;
     be;
     NULL, iber0016;
|FIN;

|PROCESO agifa505;
     aAlfa = #505#89;
     aAlfa = aAlfa % 104; aAlfa = aAlfa + aAno;
     #505#89 = aAlfa;

     aAlfa = #505#103;
     aAlfa = aAlfa % 104; aAlfa = aAlfa + aAno;
     #505#103 = aAlfa;

     aAlfa = #505#104;
     aAlfa = aAlfa % 104; aAlfa = aAlfa + aAno;
     #505#104 = aAlfa;

     aAlfa = #505#105;
     aAlfa = aAlfa % 104; aAlfa = aAlfa + aAno;
     #505#105 = aAlfa;

     aAlfa = #505#106;
     aAlfa = aAlfa % 104; aAlfa = aAlfa + aAno;
     #505#106 = aAlfa;

     aAlfa = #505#107;
     aAlfa = aAlfa % 104; aAlfa = aAlfa + aAno;
     #505#107 = aAlfa;

     |GRABA 040#505a;
     |LIBERA #505;
|FPRC;

|DEFBUCLE agifa505;
     #505;
     ;
     INICIO;
     FINAL;
     be;
     NULL, agifa505;
|FIN;

|PROCESO CambioControl;
     |BUCLE agifa505;
     |BUCLE iber0016;
|FPRC;

|PROCESO agifa007;
     aAlfa = #7#26;
     aAlfa = aAlfa % -101;
     |SI aAlfa ! "1"; |ACABA; |FINSI;

     aAlfa = #7#26;
     aAlfa = aAlfa % 104;
     aAlfa = aAlfa + aAno;

     #7#26 = aAlfa;
     |GRABA 040#7n;
|FPRC;

|DEFBUCLE CambioSerie;
     #7#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, agifa007;
|FIN;

|PROCESO CopiaEmpresa;
     |DFICE aBase;
     aOrg = aBase;
     aLon = aOrg % A0;
     nNum = aLon;
     nNum = nNum - 6 + 100;
     aDes = aOrg % nNum;
     aEmp = aOrg % -205;
     nNum = aEmp;

     |PARA nAny = 1; |SI nAny [ 9; |HACIENDO nAny = nAny + 1;
          aAno = nAny;
          aDirDes = ""
          |SI nNum < 100;
               aAlfa = aEmp % 102;
               aAlfa = aAlfa + "10" + aAno;
          |SINO;
               aAlfa = aEmp % 103;
               aAlfa = aAlfa + "0" + aAno;
          |FINSI;
          nNum = aAlfa;
          aEmp = ("00000" + nNum) % -105;
          aDirDes = aDes + aEmp + "/";
          |MKDIR aDirDes;
          |SI FSalida = 0;
               |SAL;
          |FINSI;
     |SIGUE;

     aDes = aDirDes;

/*
     |MKDIR aDes;
     |SI FSalida ! 0;
          |CONFI "N0000LA EMPRESA DE COPIA EXISTE, SOBREESCRIBIR";
          |SI FSalida ! 0;
               nSw = 1;
               |ACABA;
          |FINSI;
     |FINSI;
*/

     |_PDIR aOrg;
     |PARA; |SI FSalida = 0; |HACIENDO;
          aFic = aOrg - aBase;
          aAlfa = aDes + aFic;
          |PINTA 2202, aAlfa;
          |COPIA_FICHERO aOrg, aAlfa;
          |_SDIR aOrg;
     |SIGUE;
|FPRC;

|PROCESO Tipo3; |TIPO 3;

     fFecha = ~;
     ||aAno = fFecha;
     ||aAno = "1";

     |SI #0#0 = "SI";
          nSw = 0;
          |HAZ CopiaEmpresa;
          |SI nSw = 0;
               |SUB_EJECUTA "agifa061;iber21";
               aAno = "3";
               |BUCLE CambioSerie;
               |HAZ CambioControl;

               ||SUB_EJECUTA "dsptasin;iber21";

               |ABRE #46;
               |LEE 101#46p;
               |SI FSalida = 0;
                    #46#15 = 4;
                    #46#16 = 4;
                    |GRABA 020#46a;
               |FINSI;
               |CIERRA #46;


               |CLS;
               |BLANCO 921 1662;
               |CUADRO 921 1662;
               |ATRI R;
               |PINTA 1124, "  CIERRE TERMINADO  ";
               |ATRI I;
               |PINTA 1324, "  Pulse Tecla <Fin> ";
               |ATRI 0;

               |PARA; |SI aAlfa ! "816"; |HACIENDO;
                    |LEETECLA aAlfa;
                    aAlfa = aAlfa % -103;
               |SIGUE;
          |FINSI;
     |FINSI;
|FPRC;
