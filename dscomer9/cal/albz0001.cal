|FICHEROS;
     albz0001 #0;
     albm0001 #1,MANTE;
     albm0002 #2;
     albm0003 #3;
     albm0006 #6;
     albm0007 #7;
     albm0013 #13;
     albm0046 #46;
     albm0051 #51;
     albm0052 #52;
     albm0053 #53;
     albm0054 #54;
     albm0056 #56;
     albw0003 #901;
     albw0031 #902;

     dsm00043 #143;
     dsm00044 #144;
     dsm00056 #156;
     dsm00057 #157;

     agifa017 #17;
     agifa019 #19;
     ||agifa041 #41;

     agifa081 #81;        || Cabecera Pedidos Compras
     agifa067 #67;        || Lineas Pedidos Cmpras

     agifa077 #77;        || Cabecera Albaranes Compras
     agifa080 #80;        || Lineas Albaranes Compras

     agifa112 #112;
     agifa142 #142;

     dsm00024 #224;

     agifa321;
     agifa322;
     agifa323;
     agifa324;

     albm0049 #649;        ||Aux.Impresion Etiq.
     albm0045 #45;         ||Contadores Partidas
|FIN;

|VARIABLES;
     aEsc1 = "";
     aEsc2 = "";
     aRetu = "";
 {-1}aVent = "";
     aVent1 = 0;
     aVent2 = 0;
     aVent3 = 0;
     aVent4 = 0;
     aVent5 = "";
     &aDivisa = "";
     &aMoneda = "";
     nDecTotales = 0;
     aObs = "";
     aObs1 = "";
     aObs2 = "";
     aProceso = "";
     &eaObser47 = "";
     &eaIncPar = "";
     aArticulo = "";
     aAlmacen = "";
     aPartida46 = "";
     nGrid1       = -1;
     nGrid2       = -1;
     nGrid3       = -1;
     nGrid4       = -1;
     nPanta0      = 0;
     nPanta1      = 0;
     nPanta2      = 0;
     nPanta3      = 0;
     nPanta4      = 0;
     nPos1        = 0;
     nPos2        = 0;
     nRango       = 0;
     nSalir       = 0;
     nNume        = 0;
     nBoton       = 0;
     nBoton1      = 0;
     nBoton2      = 0;
     nBoton3      = 0;
     nBoton4      = 0;
     nBoton5      = 0;
     nBoton6      = 0;
     nBoton7      = 0;
     nBoton8      = 0;
     nBoton9      = 0;
     nBoton10     = 0;
     nBoton11     = 0;
     nBoton12     = 0;
     nBoton13     = 0;
     nBoton14     = 0;
     nBoton15     = 0;
     nBoton16     = 0;
     nBoton17     = 0;
     nBoton18     = 0;
     nBoton19     = 0;
     nBoton20     = 0;
     nTecla       = 0;
     nVentana     = 0;
     nVentana1    = 0;
     nVentana2    = 0;
     cambiomb     = 0;
     cambio       = 0;
     div_act      = 0;
     nfecha       = 0;
     nCodEmp      = 0;
     nImpDiv      = 0;
     nPend        = 0;
     nImpo        = 0;
     mes          = 0;
     nPPort1      = 0;
     nPPort2      = 0;
     nNume7       = 0;
     nNume11      = 0;
     importe      = 0;
     importeD     = 0;
     nPendiente   = 0;
     nPendiente2  = 0;
     nVaria1      = 0;
     nVaria2      = 0;
     nMes         = 0;
     nDocum       = 0;
     nLinea       = 0;
     nPtec        = 0;

     aDCerrado    = "";
     aHCerrado    = "";
     monba        = "";
     montra       = "";
     aDatos       = "";
     aDirEmp      = "";
     aAlfa        = "";
     aMes         = "";
     aParametro   = "";
     aPartida     = "";
     aCod1        = "";
     aCod2        = "";
     aTecla       = "";

     fDFecha      = @;
     fHFecha      = @;
     fechasis     = @;
     fmes1        = "  ";

     &decim_base      = 0;
     &precio_base     = 0;

     &decim_divisa    = 0;  || Decimales de la divisa
     &precio_divisa   = 0; || Decimales del precio en divisa
     &prov_divisa     = "";
     &enAlbaran       = 0;
     &enRechazar      = 0;

     &nDeci_Base      = 2;   || Decimales en Totales de la moneda base
     &nDeci_PreBase   = 2;   || Decimales en el Precio en moneda base
     &nDeci_BaseMxP   = 2;   || Decimales en Totales de la moneda base (Maxima precision)
     &nDeci_BaseMx    = 2;   || Decimales en Totales de la moneda base (Maxima precision)
     &nDeci_PreBasMxP = 2;   || Decimales en el Precio en moneda base (Maxima precision)
     &nDeci_PreBaseMx = 2;   || Decimales en el Precio en moneda base (Maxima precision)
     &nDeci_Div       = 2;   || Decimales en Totales de la divisa
     &nDeci_DivP      = 2;   || Decimales en Totales de la divisa
     &nDeci_PreDivP   = 2;  || Decimales en el Precio en divisa
     &nDeci_PreDiv    = 2;  || Decimales en el Precio en divisa
     &nDeci_TotVisP   = 2;  || Decimales en Totales visibles (el de la moneda de trabajo)
     &nDeci_TotNoVisP = 2;  || Decimales en Totales no visibles (el de la otra moneda)
     &nDeci_PreVisP   = 2;  || Decimales en el Precio visual. (lineas)
     &nDeci_ImpVisP   = 2;  || Decimales en el Importe visual. (lineas)
     &nDeci_DivF      = 2;   || Decimales en Totales de la divisa
     &nDeci_PreDivF   = 2;   || Decimales en el Precio en divisa
     &nDeci_TotVisF   = 2;   || Decimales en Totales visibles (el de la moneda de trabajo)
     &nDeci_TotNoVisF = 2;   || Decimales en Totales no visibles (el de la otra moneda)
     &nDeci_PreVisF   = 2;   || Decimales en el Precio visual. (lineas)
     &nDeci_ImpVisF   = 2;   || Decimales en el Importe visual. (lineas)
     &EURODB          = 2;
     nModo = 0;
     &enPosicion = 0;
     aProvPartida = "";

     &eaHoraPed     = "";
     &eaDefImpre    = "";
     &ser_ped       = "";
     &num_ped       = 0;
     &enTintado     = 0;
     &eaDespreciar1 = "";
     &eaDespreciar2 = "";
     &eaCerrarPar   = "";
     &eaDocExt      = "";
     &eaSerExt      = "";
     &enNumExt      = 0;

     aMensaje = "";

     nAlmBorra = 0;
     aParBorra = "";
     aUsaPar = "";
     aPedPar = "";
     aTipoMov = "";
     aParConta = "";

     &enAlberoDentro = 0;
|FIN;

|INCLUYE i_varart;

|PROCESO ClaveBaja1;
     #1#0 = fDFecha;
     #1#1 = "";
     #1#2 = #0#1;
|FPRC;

|PROCESO ClaveAlta1;
     #1#0 = fHFecha;
     #1#1 = "zzzzzzzzzzzzzzzzzzzz";
     #1#2 = #0#1;
|FPRC;

|PROCESO ClaveBaja2;
     |HAZ MiraEstadoOpenClose;
     #2#10 = aDCerrado;
     #2#2  = fDFecha;
     #2#3  = #0#1;
     #2#4  = "";
     #2#0  = "";
     #2#1  = 1;
|FPRC;

|PROCESO ClaveAlta2;
     |HAZ MiraEstadoOpenClose;
     #2#10 = aHCerrado;
     #2#2  = fHFecha;
     #2#3  = #0#1;
     #2#4  = "zzzzzzzzzzzzzzzzzzzz";
     #2#0  = "zzzzz";
     #2#1  = 999999;
|FPRC;

|PROCESO ClaveBaja3;
     #3#2  = "01.01.0000";
     #3#0  = "";
     #3#1  = 1;
|FPRC;

|PROCESO ClaveAlta3;
     #3#2  = "31.12.9999";
     #3#0  = "zzzzz";
     #3#1  = 999999;
|FPRC;

|PROCESO MiraMonedaBase;
     |ABRE #agifa321;
     |ABRE #agifa324;

     |LEE 010#agifa321.p;   ||Leo parametros de divisa
     monba = #agifa321#9;  ||Cojo la Moneda Base de parametros

     #agifa324#0 = #agifa321#9;
     |LEE 010#agifa324.=;         ||Leo la ficha de la moneda base en Divisas
     cambiomb    = #agifa324#3;  ||Asigno el cambio de la moneda base con el euro
     decim_base  = #agifa324#7;    ||Asigno los decimales de la moneda base
     precio_base = #agifa324#9;   ||Asigno los decimales del precio en la mon. base

     |CIERRA #agifa324;
     |CIERRA #agifa321;
|FPRC;

|PROCESO Param_Divisas; |TIPO 0;
     aDivisa = #77#56;
     aMoneda = #77#58;
     |HAZ Divisas077;
/*
     |ABRE #agifa324;
     #agifa324#0 = #112#81;
     |LEE 001#agifa324.=;
     |CIERRA #agifa324;

     decim_divisa  = #agifa324#7;
     precio_divisa = #agifa324#9;
     nDeci_DivP    = decim_divisa;
     nDeci_PreDivP = precio_divisa;
     cambio        = #agifa324#3; ||Cambio divisa

     |SI montra = "B";
         nDeci_PreVisP   = precio_divisa;
         nDeci_ImpVisP   = decim_divisa;
         nDeci_Base      = decim_base;
         nDeci_PreBase   = precio_base;
         nDeci_BaseMxP   = decim_base;
         nDeci_BaseMx    = decim_base;
         nDeci_PreBasMxP = precio_base;
         nDeci_PreBaseMx = precio_base;
         nDeci_TotVisP   = decim_base;
         nDeci_TotNoVisP = decim_divisa;
     |SINO;
         nDeci_PreVisP   = precio_base;
         nDeci_ImpVisP   = decim_base;
         nDeci_Base      = decim_base;
         nDeci_PreBase   = precio_base;
         |SI cambio = 1;
              nDeci_BaseMxP   = decim_base;    || sin triangulacion
              nDeci_BaseMx    = decim_base;    || sin triangulacion
              nDeci_PreBasMxP = precio_base;
              nDeci_PreBaseMx = precio_base;
         |SINO;
              nDeci_BaseMxP   = #agifa321#10;  || con triangulacion
              nDeci_BaseMx    = #agifa321#10;  || con triangulacion
              nDeci_PreBasMxP = #agifa321#11;
              nDeci_PreBaseMx = #agifa321#11;
         |FINSI;
         nDeci_TotVisP   = decim_divisa;
         nDeci_TotNoVisP = decim_base;
     |FINSI;
*/
|FPRC;

|PROCESO CambioDivisa; |TIPO 0;
      |SI #agifa112#80 = "S"; || Si el proveedor es de divisa pactada
          |ABRE #agifa323;
          |ABRE #agifa322;
          #agifa322#0 = #agifa081#4;
          #agifa322#2 = #agifa081#27;
          #agifa322#7 = "N";
          |SELECT #2#agifa322;  || Con esta clave ...
          |LEE 011#agifa322.=;  || ... busco periodos no finalizados de esa divisa
          |SI FSalida = 0;  || Si existe un periodo no finalizado
              |PARA div_act = 0; |SI div_act = 0; |HACIENDO;
                 #agifa081#28 = #agifa322#3;        || ...y el cambio
                 |LEE 001#agifa322.=;   || Leo las lineas de Proveed/Divisas
                 nfecha = fechasis - #agifa322#6;  || Resto la fecha de fin de periodo a la actual
                 |SI nfecha > 0;  || Si la fecha actual supera a la del periodo asignado ...
                     |MENAV "0000ATENCION deberia Actualizar primero la divisa en Proveedores/Divisas";
                     prov_divisa = #agifa081#4;  || Le envio el cod. de proveedor a "agifa323"
                     |SUB_EJECUTA_NP "agifa323.tab";  || Ejecuto Proveedores/Divisas
                     |ERROR;
                 |SINO;
                     div_act = 1;  || Para salir del PARA
                 |FINSI;
              |SIGUE;
           |SINO;  || Si no existe un periodo no finalizado para esa divisa
              |MENAV "0000No existe un periodo activo para la divisa en Proveedores / Divisas";
              prov_divisa = #agifa081#4;  || Le paso a "agifa323" el proveedor
              |SUB_EJECUTA_NP "agifa323.tab";  || Ejecuto Proveedores / Divisas
              |ERROR;
           |FINSI;
           |SELECT #1#agifa322;
           |CIERRA #agifa322;
           |CIERRA #agifa323;
      |SINO; || Si el Proveedor no es de Divisa pactada ...
           |ABRE #agifa324; || ...miro directamente en divisas
           #agifa324#0 = #agifa081#27;
           |LEE 001#agifa324.=;
           |SI FSalida = 0; ||Si existe la divisa...
               #agifa081#28 = #agifa324#3; || la recojo
               |SI #agifa324#6 ! -1; || Si los dias de margen de actualizacion no
                                  || son = -1 (indefinidos)
                   |PARA div_act = 0; |SI div_act = 0; |HACIENDO;
                      #agifa081#28 = #agifa324#3;        ||Cargo el valor del cambio
                      |LEE 001#agifa324.=;  || Leo la divisa
                      nfecha = fechasis - #agifa324#4;
                      |SI nfecha > #agifa324#6; |Y #agifa324#6 ! -1;  || Si la fecha actual
                          |MENAV "0000ATENCION deberia Actualizar primero la divisa";
                          |SUB_EJECUTA_NP "agifa326.tab";
                          |ERROR;
                      |SINO;
                          div_act = 1;
                      |FINSI;
                    |SIGUE;
                |FINSI;
            |FINSI;
            |CIERRA #agifa324;
      |FINSI;
|FPRC;

|| PROCESOS DEL albm0001 ----------------------------------------------------

|PROCESO UsarPartida;  |TIPO 7;
     |ESTADO_CONTROL nBoton6, "ENABLE";
|FPRC;

|PROCESO Tipo0C1;  |TIPO 6;
     |SI aCod1 ! "";
         #1#1 = aCod1;  |PINTA #1#1;
         #1#2 = aCod2;  |PINTA #1#2;
         #1#5 = aProvPartida; |PINTA #1#5;
     |FINSI;

     aCod1 = "";
     aCod2 = "";
     aProvPartida = "";
|FPRC;

|PROCESO Relleno;  |TIPO 6;
     aAlfa = #1#5;  |QBT aAlfa;
     #1#5  = ("000000" + aAlfa) % -106;
     |PINTA #1#5;

     |ABRE #52;
     |LEE 000#52p;
     |SI FSalida ! 0;  |DDEFECTO #52;  |FINSI;
     |CIERRA #52;

     |ABRE #53;
     #53#0 = #1#5;
     |LEE 000#53=;
     |SI FSalida ! 0;  |DDEFECTO #53;  |FINSI;
     |CIERRA #53;

     |SI #53#10 [ #52#55;
         aAlfa = "0000NEl proveedor tiene una valoracion de " + #53#10 + " puntos, " + #53#18;
         |QBF aAlfa;
         aAlfa = aAlfa + ". Desea continuar ";

         |CONFI aAlfa;
         |SI FSalida ! 0;  |ERROR;  |ACABA;  |FINSI;
     |FINSI;

     |ABRE #54;
     #54#0 = #1#5;
     #54#1 = #1#1;
     |LEE 000#54=;
     |SI FSalida ! 0;  |DDEFECTO #54;  |FINSI;
     |CIERRA #54;

     |SI #54#5 = 0;  |Y #54#6 = 0;  |Y #54#7 = 0;  |Y #54#8 = 0;
         aAlfa = "0000 El proveedor-articulo es NUEVO";
         |MENAV aAlfa;
     |SINO;
         |SI #54#12 [ #52#55;
             aAlfa = "0000NEl proveedor-articulo tiene una valoracion de " + #54#12 + " puntos, " + #54#20;
             |QBF aAlfa;
             aAlfa = aAlfa + ". Desea continuar ";

             |CONFI aAlfa;
             |SI FSalida ! 0;  |ERROR;  |FINSI;
         |FINSI;
     |FINSI;
|FPRC;

|PROCESO PintaDescri;  |TIPO 7;
     |ESTADO_CONTROL nBoton6, "DISABLE";

     aAlfa = #1#3;  |QBF aAlfa;
     |SI aAlfa ! "";
          |PINTA #1#3;
          |ACABA;
     |FINSI;

     |ABRE #19;
     #19#0 = #1#1;
     |LEE 000#19=;
     |SI FSalida ! 0;  |DDEFECTO #19;  |FINSI;
     |CIERRA #19;

     #1#3 = #19#195;  |PINTA #1#3;

     aAlfa = #1#3;  |QBF aAlfa;
     |SI aAlfa ! "";
          |PINTA #1#3;
          |ACABA;
     |FINSI;

     #1#3 = #19#1;    |PINTA #1#3;
|FPRC;

|PROCESO Evento1;
     |ESTADO_CONTROL nBoton6, "DISABLE";

     |SI FSalida = 1;
          |LEE 040#1c;
          |SI FSalida ! 0;
               ||#1#0 = ~;
               #albm0001#0 = #albz0001#0;
               |PINTA #1#0;
          |FINSI;
     |FINSI;

     |SI FSalida = 4;
         |LEE 040#1c;
         |SI FSalida ! 0; |ACABA; |FINSI;

         aParametro = #1#5 + #1#1 + (("00000" + #1#2) % -105);
         aParametro = aParametro + (("000000000000000" + #1#4) % -115);
         aParametro = aParametro + #1#7;
         aParametro = aParametro + #1#0;

         aMensaje = "0000NEs un Prepedido de Tintado?";
         |CONFI aMensaje;
         |SI FSalida = 0;
              aAlfa      = "albm0056;" + aParametro;
         |SINO;
              aAlfa      = "albz0008;" + aParametro;
         |FINSI;
         |SUB_EJECUTA_NP aAlfa;

         |REFRESCACONTROL nGrid1;
         |REFRESCACONTROL nGrid2;
         |REFRESCACONTROL nGrid3;
         |REFRESCACONTROL nGrid4;

         FSalida = "SKIPDEFAULT";
     |FINSI;
|FPRC;

|PROCESO Evento2;
     |SI FSalida = 1;
         |LEE 040#2c;
     |FINSI;
|FPRC;

|| -------------------------------------------------------------------------
|| PROCESOS DE ADJUDICACION ALBARANES COMUNES
|| -------------------------------------------------------------------------

|PROCESO BorraPedido;
     |ABRE #81;
     #81#25 = #3#0;
     #81#0  = #3#1;
     |LEE 101#81=;
     |SI FSalida = 0;
         |BORRA 020#81a;
     |FINSI;
     |CIERRA #81;

     |ABRE #67;
     #67#28  = #3#0;
     #67#0   = #3#1;
     #67#1   = 1;
     |LEE 101#67=;
     |SI FSalida = 0;
         |BORRA 020#67a;
     |FINSI;

     #67#28  = #3#0;
     #67#0   = #3#1;
     #67#1   = 2;
     |LEE 101#67=;
     |SI FSalida = 0;
         |BORRA 020#67a;
     |FINSI;
     |CIERRA #67;

     |HAZ AlbePedBorra;
|FPRC;

|PROCESO DesAcumulaMaestros;
     #112#0 = #81#4;
     |LEE 101#112=;
     |SI FSalida = 0;
         |SI #19#196 = 2;
             nImpo = ((((#67#41 * #67#6) < #67#8) < #67#27) < #81#5) < #81#17;
         |SINO;
             nImpo = ((((#67#5 * #67#6) < #67#8) < #67#27) < #81#5) < #81#17;
         |FINSI;
         |SI #142#114 = "S";
             nImpo = nImpo < #81#6;
         |FINSI;

         fmes1 = #81#1 % A402;
         mes   = fmes1 + 42;

         #112mes = #112mes - nImpo;
         #112#55 = #112#55 - nImpo;

         |GRABA 020#112a;
         |LIBERA #112;

          enImpPrvPed = -nImpo;
          efFecha = #81#1;
          eaProve = #81#4;
          |HAZ AcumulaPrv;
     |FINSI;
|FPRC;

|PROCESO LeeArticulo;
     #19#0 = #80#2;
     |LEE 101#19=;
     |SI FSalida ! 0;
          |DDEFECTO #19;
          #19#0 = #80#2;
          #19#1 = #80#4;
          |GRABA 020#19n;
     |FINSI;
     |LIBERA #19;

     #17#0 = #80#2;
     #17#1 = #80#3;
     |LEE 101#17=;
     |SI FSalida ! 0;
          |DDEFECTO #17;
          #17#0  = #80#2;
          #17#1  = #80#3;
          #17#40 = #80#4;
          |GRABA 020#17n;
     |FINSI;
|FPRC;

|PROCESO LeeProveedor;
     #112#0 = #80#15;
     |LEE 101#112=;
     |SI FSalida ! 0;
          |DDEFECTO #112;
          #112#0 = #80#15;
          |GRABA 020#112b;
     |FINSI;
|FPRC;

|PROCESO ActuaPedido;
     nPendiente  = #67#5  - #67#38;
     nPendiente2 = #67#41 - #67#46;

     |SI #81#29 = "D";
          nPPort1 = #67#50 / #81#28 * #81#33;
          nPPort2 = #67#50;
     |SINO;
          nPPort1 = #67#50;
          nPPort2 = #67#50 / #81#33 * #81#28;
     |FINSI;

     importe  = #81#13;                || Imp Servido (C)
     importeD = #81#36;                || Imp Servido (C)

     |SI #19#196 = 2;
         #81#13 = #67#46 * #67#6;
         #81#36 = #67#46 * #67#33;
     |SINO;
         #81#13 = #67#38 * #67#6;
         #81#36 = #67#38 * #67#33;
     |FINSI;

     #81#13 = (#81#13 < #67#8) < #67#27;
     #81#36 = (#81#36 < #67#8) < #67#27;

     |SI #19#196 = 2;
          #81#13 = (#81#13 + (#67#46 * nPPort1));
          #81#36 = (#81#36 + (#67#46 * nPPort2));
     |SINO;
          #81#13 = (#81#13 + (#67#38 * nPPort1));
          #81#36 = (#81#36 + (#67#38 * nPPort2));
     |FINSI;

     #81#13 = ((#81#13 < #81#5) < #81#17) < #81#6;
     #81#13 = importe - #81#13;

     #81#36 = ((#81#36 < #81#5) < #81#17) < #81#6;
     #81#36 = importeD - #81#36;

     |SI #3#13 = 0;
         #67#38 = #67#38 + #901#5;
         #67#46 = #67#46 + #901#4;
         #67#45 = #67#45 + #901#4;
     |SINO;
         #67#38 = #67#38 + #902#27;
         #67#46 = #67#46 + #902#26;
     |FINSI;

     |SI eaDespreciar = "S";
         nVaria1 = #67#12;
         nVaria2 = #67#44;

         #67#12 = #67#38 - #67#37;
         #67#44 = #67#46 - #67#45;

         nVaria1 = #67#12 - nVaria1;
         nVaria2 = #67#44 - nVaria2;

         #80#22 = nVaria1;
         #80#24 = nVaria2;
     |SINO;
         |SI #142#225 = "B";
             |SI #67#37 = 0;
                  #67#12 = #67#38 - #67#37;
             |FINSI;
             |SI #67#45 = 0;
                  #67#44 = #67#46 - #67#45;
             |FINSI;
         |FINSI;
     |FINSI;

     #81#11 = #81#11 - #67#9;
     #81#34 = #81#34 - #67#34;

     #67#5  = #67#37 + #67#12;
     #67#41 = #67#45 + #67#44;

     |SI #19#196 = 2;
          #67#7   = #67#41 * #67#6;
          nImpDiv = #67#41 * #67#33;
     |SINO;
          #67#7   = #67#5 * #67#6;
          nImpDiv = #67#5 * #67#33;
     |FINSI;

     #67#9  = (#67#7 < #67#8) < #67#27;
     #67#34 = (nImpDiv < #67#8) < #67#27;
     |SI #19#196 = 2;
         #67#9  = (#67#9  + (#67#41 * nPPort1));
         #67#34 = (#67#34 + (#67#41 * nPPort2));
     |SINO;
         #67#9  = (#67#9  + (#67#5  * nPPort1));
         #67#34 = (#67#34 + (#67#5  * nPPort2));
     |FINSI;
     #67#9  = ((#67#9  < #81#5) < #81#17) < #81#6;
     #67#34 = ((#67#34 < #81#5) < #81#17) < #81#6;

     #81#11 = #81#11 + #67#9;
     #81#34 = #81#34 + #67#34;

     |SI #81#29 = "D";
         #67#36 = #67#9;
     |SINO;
         #67#36 = #67#34;
     |FINSI;

     |SI #19#196 = 2;
          importe  = #67#46 * #67#6;
          importe  = (importe < #67#8) < #67#27;
          importe  = importe + (#67#46 * nPPort1);

          importeD = #67#46 * #67#33;
          importeD = (importeD < #67#8) < #67#27;
          importeD = importeD + (#67#46 * nPPort2);
     |SINO;
          importe  = #67#38 * #67#6;
          importe  = (importe < #67#8) < #67#27;
          importe  = importe + (#67#38 * nPPort1);

          importeD = #67#38 * #67#33;
          importeD = (importeD < #67#8) < #67#27;
          importeD = importeD + (#67#38 * nPPort2);
     |FINSI;

     importe  = ((importe  < #81#5) < #81#17) < #81#6;
     importeD = ((importeD < #81#5) < #81#17) < #81#6;

     #67#11 = #67#9  - importe;

     #81#13 = #81#13 + importe;         || Imp Servido (C)
     #81#12 = #81#11 - #81#13;           || Imp Pdte serv (C)

     #81#36 = #81#36 + importeD;        || Imp Servido (C)
     #81#35 = #81#34 - #81#36;           || Imp Pdte serv (C)

     #81#24 = #81#24 + #77#5;           || Ctrl Servido (C)

     |SI eaDespreciar = "S";
         enUnidPend  = #80#5  + (nPendiente  - #80#5);
         enUnidPend2 = #80#36 + (nPendiente2 - #80#36);
     |SINO;
          enUnidPend  = #80#5  - enUnidPend;
          enUnidPend2 = #80#36 - enUnidPend2;

          |SI #67#37 = 0; enUnidPend  = 0; |FINSI;
          |SI #67#45 = 0; enUnidPend2 = 0; |FINSI;
     |FINSI;

     enForma = 1;
     eaDocu = "agifa213";
     |HAZ StockEntra;
|FPRC;

|PROCESO ModPrvArt;
     |SI #142#209 = "S";
          #19#0 = #80#2;
          |LEE 101#19=;
          |SI FSalida = 0; |Y  #19#27 ! #77#3;
               aAlfa = "0000N Modificar Proveedor en Articulo:"+&13+"Articulo:["+#80#2+"]"+&13+"Actual:["+#19#27+"]";
               |CONFI aAlfa;
               |SI FSalida = 0; #19#27 = #77#3; |GRABA 020#19a; |FINSI;
          |FINSI;
     |FINSI;
|FPRC;

|PROCESO TotPedDiv;
     |SI #81#29 = "B";  || Asigna campos visual. y no visual. en el pedido segun la moneda de trabajo
         #81#37 = #81#11;
         #81#38 = #81#12;
         #81#39 = #81#13;
         #81#40 = #81#34;
         #81#41 = #81#35;
         #81#42 = #81#36;
     |SINO;
         #81#37 = #81#34;
         #81#38 = #81#35;
         #81#39 = #81#36;
         #81#40 = #81#11;
         #81#41 = #81#12;
         #81#42 = #81#13;
     |FINSI;
|FPRC;

|PROCESO AlPedido;
     |HAZ ActuaPedido;
     |HAZ TotPedDiv;

     enForma = 1;
     |GRABA 020#67a;
     |LIBERA #67;

     |GRABA 020#81a;
     |LIBERA #81;

     |HAZ ModPrvArt;
|FPRC;

|PROCESO ActuaCabecera;
     |HAZ CalCabAgifa077;
|FPRC;

|PROCESO ActuaResto;
     #77#41  = 1;

     |HAZ LeeArticulo;
     |HAZ LeeProveedor;

     |HAZ AlPedido;

     aAlfa = #77#71; |QBF aAlfa;
     |SI aAlfa = "";
         #77#71 = #81#43;
     |FINSI;

     importe = #80#9 < #77#5;
     importe = importe < #77#7;
     importe = importe < #77#32;
     importe = importe;

     |HAZ ActuaCabecera;

     #80#23 = #67#5;

     |LIBERA #112;
     |LIBERA #19;
     |LIBERA #17;
|FPRC;

|| -------------------------------------------------------------------------
|| PROCESOS DE ADJUDICACION ALBARANES NORMALES
|| -------------------------------------------------------------------------

|PROCESO CreaCabeceraAlb;
     |ABRE #7;
     #7#0 = #901#0;
     #7#1 = #901#1;
     #7#2 = #901#7;
     |GRABA 020#7n;
     |LIBERA #7;
     |CIERRA #7;

     #112#0  = #81#4;
     |LEE 040#112=;
     |SI FSalida ! 0;  |DDEFECTO #112;  |FINSI;

     |DDEFECTO #77;
     #77#50  = #901#0;
     #77#0   = #901#1;
     #77#1   = #901#2;
     #77#3   = #81#4;
     #77#4   = #81#8;
     #77#5   = #81#5;
     #77#7   = #81#6;
     #77#8   = #81#9;
     #77#9   = #112#22;
     #77#29  = #81#19;
     #77#30  = #81#18;
     #77#31  = #81#20;
     #77#33  = #81#21;
     #77#36  = #112#58;
     #77#52  = #112#78;
     #77#54  = #901#10;
     #77#56  = #81#27;
     #77#57  = #81#28;
     #77#58  = #81#29;
     #77#60  = #81#31;
     #77#61  = #81#32;
     #77#62  = #81#33;
     #77#71  = #81#43;

     |GRABA 020#77b;

     |HAZ Param_Divisas;
     |HAZ CambioDivisa;
|FPRC;

|PROCESO AcumulaMaestros;
     ||컴컴컴컴컴컴 Doble/Multi
     eaIncPar   = #901#9;
     enPrecioB  = precio_base;
     enDeciB    = nDeci_PreBase;
     enForma    = 1;
     eaDocu     = "agifa212";
     |HAZ StockEntra;
     ||컴컴컴컴컴컴컴컴컴컴컴컴
     ||-------------------------------Prov
     #112#0 = #77#3;
     |LEE 101#112=;
     |SI FSalida = 0;
         nImpo = (#80#9 < #77#5) < #77#32;
         |SI #142#114 = "S";
             nImpo = nImpo < #77#7;
         |FINSI;

         aMes = #77#1 % A402;
         nMes = aMes + 26;
         |SI #77#42 = "N";
             #112nMes = #112nMes + nImpo;
             #112#39  = #112#39  + nImpo;
         |SINO;
             #112nMes = #112nMes - nImpo;
             #112#39  = #112#39  - nImpo;
         |FINSI;

         fmes1 = #81#1 % A402;
         mes   = fmes1 + 42;

         |SI #19#196 = 2;
             nImpo = ((((#67#41 * #67#6) < #67#8) < #67#27) < #81#5) < #81#17;
         |SINO;
             nImpo = ((((#67#5 * #67#6) < #67#8) < #67#27) < #81#5) < #81#17;
         |FINSI;

         |SI #142#114 = "S";
             nImpo = nImpo < #81#6;
         |FINSI;

         #112mes = #112mes + nImpo;
         #112#55 = #112#55 + nImpo;

         |GRABA 020#112a;
         |LIBERA #112;

         enImpPrvPed = nImpo;
         efFecha = #81#1;
         eaProve = #81#4;
         |HAZ AcumulaPrv;

          |SI #77#42 = "N";
               enImpPrvCom = nImpo;
          |SINO;
               enImpPrvCom = -nImpo;
          |FINSI;
          efFecha = #77#1;
          eaProve = #77#3;
          |HAZ AcumulaPrv;
     |FINSI;
|FPRC;

|PROCESO CreaLineaAlb;
     |DDEFECTO #80;
     #80#27 = #77#50;
     #80#0  = #77#0;
     #80#1  = 1;
     #80#2  = #3#4;
     #80#3  = #3#3;
     #80#4  = #3#5;
     #80#5  = #901#5;
     #80#6  = #901#6;
     #80#11 = #67#14;
     #80#12 = #67#0;
     #80#13 = #67#18;
     #80#15 = #3#7;
     #80#21 = 1;
     #80#29 = #67#28;
     #80#36 = #901#4;
     #80#37 = #901#8;

     |HAZ TotalLin80;
     |HAZ ActuaResto;

     |GRABA 020#80n;

     |GRABA 020#77a;
     |LIBERA #77;

     |HAZ AlbeFecPedi;
|FPRC;

|PROCESO CreaAlbaran;
     |ABRET #81;
     #81#25 = #3#0;
     #81#0  = #3#1;
     |LEE 101#81=;
     |SI FSalida ! 0;
         |MENAV "00000 No Existe el Pedido.";
         |CIERRAT #81;
         |ACABA;
     |FINSI;

     |ABRET #67;
     #67#28  = #3#0;
     #67#0   = #3#1;
     #67#1   = 1;
     |LEE 101#67=;
     |SI FSalida ! 0;
         |MENAV "00000 No Existe la Lineal del Pedido.";
         |CIERRAT #67;
         |CIERRAT #81;
         |ACABA;
     |FINSI;

     |HAZ MiraMonedaBase;

     |ABRE #112;
     |ABRET #19;
     |ABRET #17;
     |ABRET #77;
     |ABRET #80;

     |HAZ DesAcumulaMaestros;
     |HAZ CreaCabeceraAlb;
     |HAZ CreaLineaAlb;
     |HAZ AcumulaMaestros;

     |CIERRA  #112;
     |CIERRAT #19;
     |CIERRAT #17;
     |CIERRAT #77;
     |CIERRAT #81;
     |CIERRAT #77;
     |CIERRAT #67;

     |SI #901#5 ] #901#3;  |O eaDespreciar = "S";
         |BORRA 020#3a;
     |SINO;
         #3#10 = #901#8;
         #3#6  = #3#6 - #901#5;
         #3#11 = #901#9;
         |GRABA 020#3a;
         |LIBERA #3;
     |FINSI;

     |SELECT #1#2;
     #2#0 = #3#0;
     #2#1 = #3#1;
     |LEE 101#2=;
     |SI FSalida = 0;
         |SI #901#5 ] #901#3;  |O eaDespreciar = "S";
             #2#10 = "S";
         |SINO;
             #2#10 = "N";
         |FINSI;

         #2#11 = #901#0;
         #2#12 = #901#1;
         #2#15 = #2#15 + #901#5;
         #2#14 = #901#7;

         |GRABA 020#2a;
         |LIBERA #2;
     |FINSI;

     aAlfa    = "albm0053;CALCUL" + #2#7;
     |SUB_EJECUTA_NP aAlfa;

     aAlfa    = "albm0054;CALCUL" + #2#7 + #2#4;
     |SUB_EJECUTA_NP aAlfa;

     |SELECT #2#2;

     |CONFI "0000SDesea Imprimir las Etiquetas";
     |SI FSalida = 0;
          |PUSHV  1263 1579;
          |C_V #albm0049#2, 1, "N";
          |PINPA #0#albm0049;
          |PINDA #0#albm0049;
          |PINTA 1464, "               ";
          |ENCAMPO #1#albm0049;
          |POPV;
          enPosicion = #albm0049#1;
          eaSerie   = #901#0;
          enAlbaran = #901#1;
          enTintado = 0;
          |SUB_EJECUTA "alby0001";
     |FINSI;

     |REFRESCACONTROL nGrid3;
|FPRC;

|PROCESO AdjudicaNormal;
||     |VENTANA 0501, 2399, -1, -1, "";
     |VENTANA 0501, 2599, -1, 17, "";
     nVentana2 = FSalida;

     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentana2;
     aVent5 = "MODAL";
     |ESPECIFICA "ESTADO_VENTANA", aVent;

     |ABRE #67;
     #67#28  = #3#0;
     #67#0   = #3#1;
     #67#1   = 1;
     |LEE 000#67=;
     |CIERRA #67;

     |ABRE #81;
     #81#25 = #3#0;
     #81#0  = #3#1;
     |LEE 000#81=;
     |CIERRA #81;

     #2#0 = #3#0;
     #2#1 = #3#1;
     |LEE 040#2=;
     |SI FSalida ! 0;  |DDEFECTO #2;  |FINSI;

     |DDEFECTO #901;
     #901#0 = #3#0;
     #901#2 = #3#2;
     #901#3 = #3#6;
     #901#6 = #3#8;
     #901#8 = #3#10;
     #901#9 = #3#11;

     |ABRE #6;
     |DDEFECTO #6;
     #6#0 = #3#0;
     #6#1 = #3#1;
     |LEE 000#6=;
     |CIERRA #6;

     #901#7 = #6#2;
     |C_M #901#7, 1, "N";

     |SI #901#7 = "01.01.0000";  #901#7 = #901#2;  |FINSI;

     |SI #142#185 = "S"; #901#0 = #142#193; |PTEC 802; |PTEC 802; |FINSI;
     |PINPA #0#901;
     |PINDA #0#901;
     |ENDATOS #1#901;
     |SI FSalida = 0;
         |HAZ CreaAlbaran;
     |SINO;
         |SI enRechazar = 0;
             |SI FSalida ! 0;
                  aUsaPar = #901#8;
                  |QBF aUsaPar;
                  aPedPar = #3#10;
                  |QBF aPedPar;
                  |SI aUsaPar ! ""; |Y aPedPar = "";
                        ||Ticket. 298.
                        ||Hemos creado una partida nueva vacia, que no habiamos usado antes en esta linea
                        nAlmBorra = #3#3;
                        aParBorra = #901#8;
                        aTipoMov = "entrada";
                        |HAZ BorraPartida;
                  |FINSI;
             |SINO;
                  #3#10 = #901#8;
                  #3#11 = #901#9;
                  |GRABA 020#3a;
             |FINSI;
         |SINO;
             |HAZ BorraPedido;

             |BORRA 020#3a;
         |FINSI;
         |LIBERA #3;
     |FINSI;
     aVent1 = -1;
     aVent2 = -1;
     aVent3 = 0;
     aVent4 = nVentana2;
     aVent5 = "MODELESS";
     |ESPECIFICA "ESTADO_VENTANA", aVent;
     |FINVENTANA nVentana2;
     |PULSATECLA;
|FPRC;

|| -------------------------------------------------------------------------
|| PROCESOS DE ADJUDICACION ALBARANES TINTADO
|| -------------------------------------------------------------------------

|PROCESO CreaCabeceraAlbT;
     eaDespreciar = "N";
     |SI eaDespreciar1 = "S";  |O eaDespreciar2 = "S";
         eaDespreciar = "S";
     |FINSI;

     |ABRE #7;
     #7#0 = #902#0;
     #7#1 = #902#1;
     #7#2 = #902#3;
     |GRABA 020#7n;
     |LIBERA #7;
     |CIERRA #7;

     #112#0  = #81#4;
     |LEE 040#112=;
     |SI FSalida ! 0;  |DDEFECTO #112;  |FINSI;

     |DDEFECTO #77;
     #77#50  = #902#0;
     #77#0   = #902#1;
     #77#1   = #902#2;
     #77#3   = #81#4;
     #77#4   = #81#8;
     #77#5   = #81#5;
     #77#7   = #81#6;
     #77#8   = #81#9;
     #77#9   = #112#22;
     #77#29  = #81#19;
     #77#30  = #81#18;
     #77#31  = #81#20;
     #77#33  = #81#21;
     #77#36  = #112#58;
     #77#52  = #112#78;
     #77#56  = #81#27;
     #77#57  = #81#28;
     #77#58  = #81#29;
     #77#60  = #81#31;
     #77#61  = #81#32;
     #77#62  = #81#33;
     #77#71  = #81#43;

     |GRABA 020#77b;

     |HAZ Param_Divisas;
     |HAZ CambioDivisa;
|FPRC;

|PROCESO CreaLineaAlbT;
     |DDEFECTO #80;
     #80#27 = #77#50;
     #80#0  = #77#0;
     #80#1  = 1;
     #80#2  = #56#14;
     #80#3  = #56#30;
     #80#4  = #56#15;
     #80#5  = #902#27;
     #80#6  = #902#28;
     #80#11 = #67#14;
     #80#12 = #67#0;
     #80#13 = #67#18;
     #80#15 = #3#7;
     #80#21 = 1;
     #80#29 = #67#28;
     #80#36 = #902#26;
     #80#37 = "";

     |HAZ LeeArticulo;
     |HAZ TotalLin80;
     |HAZ ActuaResto;

     |GRABA 020#80n;

     |DDEFECTO #80;
     #80#27 = #77#50;
     #80#0  = #77#0;
     #80#1  = 2;
     #80#2  = "";
     #80#3  = 0;
     #80#4  = #56#23;
     #80#11 = 0;
     #80#12 = #67#0;
     #80#15 = #3#7;
     #80#21 = 2;
     #80#29 = #67#28;
     |GRABA 020#80n;

     |GRABA 020#77a;
     |LIBERA #77;

     |HAZ AlbeFecPedi;
|FPRC;

|PROCESO AcumulaMaestrosT;
     ||컴컴컴컴컴컴 Doble/Multi
     eaIncPar   = #902#37;
     enPrecioB  = precio_base;
     enDeciB    = nDeci_PreBase;
     enForma    = 1;
     eaDocu     = "agifa212";
     |HAZ StockEntra;
     ||컴컴컴컴컴컴컴컴컴컴컴컴
     ||-------------------------------Prov
     #112#0 = #77#3;
     |LEE 101#112=;
     |SI FSalida = 0;
         nImpo = (#80#9 < #77#5) < #77#32;
         |SI #142#114 = "S";
             nImpo = nImpo < #77#7;
         |FINSI;

         aMes = #77#1 % A402;
         nMes = aMes + 26;
         |SI #77#42 = "N";
             #112nMes = #112nMes + nImpo;
             #112#39  = #112#39  + nImpo;
         |SINO;
             #112nMes = #112nMes - nImpo;
             #112#39  = #112#39  - nImpo;
         |FINSI;

         fmes1 = #81#1 % A402;
         mes   = fmes1 + 42;

         |SI #19#196 = 2;
             nImpo = ((((#67#41 * #67#6) < #67#8) < #67#27) < #81#5) < #81#17;
         |SINO;
             nImpo = ((((#67#5 * #67#6) < #67#8) < #67#27) < #81#5) < #81#17;
         |FINSI;

         |SI #142#114 = "S";
             nImpo = nImpo < #81#6;
         |FINSI;

         #112mes = #112mes + nImpo;
         #112#55 = #112#55 + nImpo;

         |GRABA 020#112a;
         |LIBERA #112;

         enImpPrvPed = nImpo;
         efFecha = #81#1;
         eaProve = #81#4;
         |HAZ AcumulaPrv;

          |SI #77#42 = "N";
               enImpPrvCom = nImpo;
          |SINO;
               enImpPrvCom = -nImpo;
          |FINSI;
          efFecha = #77#1;
          eaProve = #77#3;
          |HAZ AcumulaPrv;
     |FINSI;
|FPRC;

|PROCESO CreaAlbaranT;
     |ABRET #81;
     #81#25 = #3#0;
     #81#0  = #3#1;
     |LEE 101#81=;
     |SI FSalida ! 0;
         |MENAV "00000 No Existe el Pedido.";
         |CIERRAT #81;
         |ACABA;
     |FINSI;

     |ABRET #67;
     #67#28  = #3#0;
     #67#0   = #3#1;
     #67#1   = 1;
     |LEE 101#67=;
     |SI FSalida ! 0;
         |MENAV "00000 No Existe la Lineal del Pedido.";
         |CIERRAT #67;
         |CIERRAT #81;
         |ACABA;
     |FINSI;

     |HAZ MiraMonedaBase;

     |ABRE #112;
     |ABRET #19;
     |ABRET #17;
     |ABRET #77;
     |ABRET #80;

     |HAZ DesAcumulaMaestros;
     |HAZ CreaCabeceraAlbT;
     |HAZ CreaLineaAlbT;
     |HAZ AcumulaMaestrosT;

     |CIERRA  #112;
     |CIERRAT #19;
     |CIERRAT #17;
     |CIERRAT #77;
     |CIERRAT #81;
     |CIERRAT #77;
     |CIERRAT #67;

     |SI #902#17 ] #902#13; |Y #902#18 ] #902#14;
      |Y #902#24 ] #902#20; |Y #902#25 ] #902#21;
         |BORRA 020#3a;
     |SINO;
         |SI eaDespreciar = "S";
             |BORRA 020#3a;
         |SINO;
             #3#10 = #902#29;
             #3#6  = #3#6 - #902#18;
             #3#11 = #902#37;
             |GRABA 020#3a;
             |LIBERA #3;
         |FINSI;
     |FINSI;

     |SELECT #1#2;
     #2#0 = #3#0;
     #2#1 = #3#1;
     |LEE 101#2=;
     |SI FSalida = 0;
         |SI #902#17 ] #902#13; |Y #902#18 ] #902#14;
          |Y #902#24 ] #902#20; |Y #902#25 ] #902#21;
             #2#10 = "S";
         |SINO;
             |SI eaDespreciar = "S";
                 #2#10 = "S";
             |SINO;
                 #2#10 = "N";
             |FINSI;
         |FINSI;

         #2#11 = #902#0;
         #2#12 = #902#1;
         #2#15 = #2#15 + #902#27;
         #2#14 = #902#3;

         |GRABA 020#2a;
         |LIBERA #2;
     |FINSI;

     aAlfa    = "albm0053;CALCUL" + #2#7;
     |SUB_EJECUTA_NP aAlfa;

     aAlfa    = "albm0054;CALCUL" + #2#7 + #2#4;
     |SUB_EJECUTA_NP aAlfa;

     |SELECT #2#2;

|FPRC;

|PROCESO SacaDocum143;
     #143#4 = "     ";
     #143#0 = 999999;
     |LEE 000#143];
     |SI FSalida = 0;
         |LEE 000#143a;
     |SINO;
         |LEE 000#143u;
     |FINSI;

     nDocum = 1;
     |SI FSalida = 0;  |Y #143#4 = "     ";
         nDocum = #143#0 + 1;
     |FINSI;
|FPRC;

|PROCESO SalidasTinte;
     |ABRE #143;
     |ABRE #144;
     |ABRE #224;

     nLinea = 0;

     |SI #902#18 ! 0;
         |ABRE #19;
         #19#0 = #902#8;
         |LEE 101#agifa019.=;
         |SI FSalida = 0;
             #19#12  = #19#12  - #902#18;
             #19#104 = #19#104 + #902#18;
             |GRABA 020#19a;
             |LIBERA #19;
         |FINSI;
         |CIERRA #19;

         |ABRE #agifa017;
         #17#0 = #902#8;
         #17#1 = #902#10;
         |LEE 101#17=;
         |SI FSalida = 0;
             #17#8  = #17#8  - #902#18;
             #17#39 = #17#39 + #902#18;
             |GRABA 020#17a;
             |LIBERA #17;
         |FINSI;
         |CIERRA #17;

         #224#0 = #902#8;
         #224#1 = #902#10;
         #224#2 = #902#12;
         |LEE 101#224=;
         |SI FSalida = 0;
/*
             ||Tiquet. 3026/774.
             ||Esto no se esta ejecutando. Lo quito.
             #224#43 = #224#43 - #902#18;
             |SI #224#43 < 0;  #224#43 = 0;  |FINSI;

             #224#44 = #224#44 - #902#17;
             |SI #224#44 < 0;  #224#44 = 0;  |FINSI;

             |GRABA 020#224a;
*/
             |LIBERA #224;
         |FINSI;

         |HAZ SacaDocum143;

         |DDEFECTO #143;
         #143#0 = nDocum;
         #143#1 = ~;
         #143#4 = "     ";
         |LEE 101#143=;
         |SI FSalida ! 0;
             |DDEFECTO #143;
             #143#0 = nDocum;
             #143#1 = ~;
             #143#4 = "     ";
             |GRABA 020#143n;
         |FINSI;

         nLinea = nLinea + 1;
         |DDEFECTO #144;
         #144#0  = #902#8;
         #144#1  = #902#10;
         #144#2  = #902#9;
         #144#3  = #17#39;
         #144#4  = #902#18;
         #144#5  = ~;
         #144#6  = #19#104;
         #144#7  = "S";
         #144#8  = nLinea;
         #144#12 = #902#17;
         #144#13 = #902#12;
         #144#18 = nDocum;
         #144#19 = #17#5;
         #144#20 = #17#6;
         #144#21 = "     ";
         #144#22 = #19#185;
         #144#23 = #17#47;
         #144#24 = #19#193;
         #144#25 = #17#48;
         |GRABA 020#144b;

         enForma     = 1;
         enCodigo    = nDocum;
         eaCerrarPar = "N";
         eaIncPar    = #902#37;

         aProceso = "";
         |ABRE #agifa080;
         #agifa080#27 = #902#0;
         #agifa080#0 = #902#1;
         #agifa080#1 = 1;
         |LEE 000#agifa080.=;
         |SI FSalida = 0;
               aProceso = #agifa080#4;
               |QBF aProceso;
               aProceso = aProceso + ", ";
         |FINSI;
         |CIERRA #agifa080;

         eaObser47 = aProceso + "PASA A SER PARTIDA " + #902#29;
         aObs = eaObser47;
         ||ARA
         |HAZ AcumulaES_SS;
         eaObser47 = "";

         |QBF aObs;
         aObs1 = aObs % 140;
         aObs2 = aObs % 4140;
         #144#9 = aObs1;
         #144#10 = aObs2;

         #144#3  = #agifa017#39;
         #144#19 = #agifa017#5;
         |GRABA 020#144a;
         |LIBERA #144;

         #224#0 = #902#8;
         #224#1 = #902#10;
         #224#2 = #902#12;
         |LEE 101#224=;
         |SI FSalida = 0;
             #224#31 = #224#9  - #224#11 - #224#43;
             |SI #224#31 < 0;  #224#31 = 0;  |FINSI;

             #224#32 = #224#10 - #224#12 - #224#44;
             |SI #224#32 < 0;  #224#32 = 0;  |FINSI;

             |GRABA 020#224a;
             |LIBERA #224;
         |FINSI;
     |FINSI;

     |SI #902#25 ! 0;
         |ABRE #19;
         #19#0 = #902#8;
         |LEE 101#agifa019.=;
         |SI FSalida = 0;
             #19#12  = #19#12  - #902#25;
             #19#104 = #19#104 + #902#25;
             |GRABA 020#19a;
             |LIBERA #19;
         |FINSI;
         |CIERRA #19;

         |ABRE #agifa017;
         #17#0 = #902#8;
         #17#1 = #902#10;
         |LEE 101#17=;
         |SI FSalida = 0;
             #17#8  = #17#8  - #902#25;
             #17#39 = #17#39 + #902#25;
             |GRABA 020#17a;
             |LIBERA #17;
         |FINSI;
         |CIERRA #17;

         #224#0 = #902#8;
         #224#1 = #902#10;
         #224#2 = #902#19;
         |LEE 101#224=;
         |SI FSalida = 0;
/*
             ||Tiquet. 3026/774.
             #224#43 = #224#43 - #902#25;
             |SI #224#43 < 0;  #224#43 = 0;  |FINSI;

             #224#44 = #224#44 - #902#24;
             |SI #224#44 < 0;  #224#44 = 0;  |FINSI;

             |GRABA 020#224a;
*/
             |LIBERA #224;
         |FINSI;

         |DDEFECTO #143;
         #143#0 = nDocum;
         #143#1 = ~;
         #143#4 = "     ";
         |LEE 101#143=;
         |SI FSalida ! 0;
             |DDEFECTO #143;
             #143#0 = nDocum;
             #143#1 = ~;
             #143#4 = "     ";
             |GRABA 020#143n;
         |FINSI;

         nLinea = nLinea + 1;
         |DDEFECTO #144;
         #144#0  = #902#8;
         #144#1  = #902#10;
         #144#2  = #902#9;
         #144#3  = #17#39;
         #144#4  = #902#25;
         #144#5  = ~;
         #144#6  = #19#104;
         #144#7  = "S";
         #144#8  = nLinea;
         #144#12 = #902#24;
         #144#13 = #902#19;
         #144#18 = nDocum;
         #144#19 = #17#5;
         #144#20 = #17#6;
         #144#21 = "     ";
         #144#22 = #19#185;
         #144#23 = #17#47;
         #144#24 = #19#193;
         #144#25 = #17#48;
         |GRABA 020#144b;

         enForma     = 1;
         enCodigo    = nDocum;
         eaCerrarPar = "N";
         eaIncPar    = #902#37;
         |HAZ AcumulaES_SS;

         #144#3  = #17#39;
         #144#19 = #17#5;
         |GRABA 020#144a;
         |LIBERA #144;

         #224#0 = #902#8;
         #224#1 = #902#10;
         #224#2 = #902#19;
         |LEE 101#224=;
         |SI FSalida = 0;
             #224#31 = #224#9  - #224#11 - #224#43;
             |SI #224#31 < 0;  #224#31 = 0;  |FINSI;

             #224#32 = #224#10 - #224#12 - #224#44;
             |SI #224#32 < 0;  #224#32 = 0;  |FINSI;

             |GRABA 020#224a;
             |LIBERA #224;
         |FINSI;
   |FINSI;
   |CIERRA #143;
   |CIERRA #144;
   |CIERRA #224;
|FPRC;

|PROCESO EntradasTinte;
     |ABRE #156;
     |ABRE #157;

     |DDEFECTO #156;
     #156#2 = #902#0;
     #156#0 = 999999;
     |LEE 000#156];
     |SI FSalida = 0;
         |LEE 000#156a;
     |SINO;
         |LEE 000#156u;
     |FINSI;

     nDocum = 1;
     |SI FSalida = 0;  |Y #156#2 = #902#0;
         nDocum = #156#0 + 1;
     |FINSI;

     |DDEFECTO #156;
     #156#0 = nDocum;
     #156#1 = ~;
     #156#2 = #902#0;
     |GRABA 020#156n;

     nLinea = 1;

     |ABRE #19;
     #19#0 = #902#30;
     |LEE 000#19=;
     |SI FSalida ! 0; |DDEFECTO #agifa019; |FINSI;
     |CIERRA #19;

     |ABRE #17;
     #17#0 = #902#30;
     #17#1 = #902#32;
     |LEE 000#17=;
     |SI FSalida ! 0; |DDEFECTO #17; |FINSI;
     |CIERRA #17;

     |DDEFECTO #157;
     #157#0  = #902#30;
     #157#1  = #902#32;
     #157#2  = #902#31;
     #157#3  = #17#39;
     #157#4  = #902#35;
     #157#5  = #56#53;
     #157#6  = #902#36;
     #157#8  = #56#37;
     #157#9  = #56#38;
     #157#11 = #902#36;
     #157#12 = ~;
     #157#13 = #19#104;
     #157#14 = nLinea;
     #157#18 = "EUR";
     #157#19 = #902#36;
     #157#21 = #902#34;
     #157#22 = #902#29;
     #157#27 = nDocum;
     #157#28 = #902#0;

     enForma  = 1;
     enCodigo = nDocum;
     eaDocExt = "TI";
     eaSerExt = "";
     enNumExt = #56#0;
     eaObser47 = "PROCEDENTE DE LA PARTIDA " + #902#12;
     |HAZ AcumulaEV;
     eaObser47 = "";

     eaDocExt = "";
     eaSerExt = "";
     enNumExt = 0;

     #157#3  = #17#39;
     #157#13 = #17#5;
     |GRABA 020#157n;

     |CIERRA #156;
     |CIERRA #157;
|FPRC;

|PROCESO AdjudicacionTinte;
     |HAZ CreaAlbaranT;
     |HAZ SalidasTinte;
     |HAZ EntradasTinte;

     |ABRE #56;
     #56#0 = #3#13;
     |LEE 101#56=;
     |SI FSalida = 0;
         #56#46 = #56#46 + #902#17;
         #56#47 = #56#47 + #902#18;
         #56#48 = #56#48 + #902#24;
         #56#49 = #56#49 + #902#25;
         #56#50 = #902#34;
         #56#51 = #902#35;
         #56#52 = #902#29;
         |GRABA 020#56a;
         |LIBERA #56;
     |FINSI;
     |CIERRA #56;

     |CONFI "0000SDesea Imprimir las Etiquetas";
     |SI FSalida = 0;
          |PUSHV  1263 1579;
          |C_V #albm0049#2, 1, "N";
          |PINPA #0#albm0049;
          |PINDA #0#albm0049;
          |PINTA 1464, "               ";
          |ENCAMPO #1#albm0049;
          |POPV;
          enPosicion = #albm0049#1;
          eaSerie   = #56#1;
          enAlbaran = #56#2;
          |SUB_EJECUTA "alby0008";
     |FINSI;

     |REFRESCACONTROL nGrid3;
|FPRC;

|PROCESO AdjudicaTintado;
     |VENTANA 0501, 2999, -1, -1, "";
     nVentana2 = FSalida;

     |ABRE #67;
     #67#28  = #3#0;
     #67#0   = #3#1;
     #67#1   = 1;
     |LEE 000#67=;
     |CIERRA #67;

     |ABRE #81;
     #81#25 = #3#0;
     #81#0  = #3#1;
     |LEE 000#81=;
     |CIERRA #81;

     #2#0 = #3#0;
     #2#1 = #3#1;
     |LEE 040#2=;
     |SI FSalida ! 0;  |DDEFECTO #2;  |FINSI;

     |ABRE #56;
     #56#0 = #3#13;
     |LEE 040#56=;
     |SI FSalida ! 0;  |DDEFECTO #56;  |FINSI;
     |CIERRA #56;

     |ABRE #46;

     |DDEFECTO #902;
     #902#0  = #3#0;
     #902#2  = #3#2;
     #902#3  = #2#13;
     #902#4  = #56#6;
     #902#5  = #56#7;
     #902#6  = #56#1;
     #902#7  = #56#2;
     #902#8  = #56#22;
     #902#9  = #56#23;
     #902#10 = #56#12;
     #902#11 = #56#13;

     #902#12 = #56#16;
     #902#13 = #56#17 - #56#46;
     #902#14 = #56#18 - #56#47;

     #46#1   = #56#12;
     #46#2   = #56#16;
     |LEE 000#46=;
     |SI FSalida ! 0;  |DDEFECTO #46;  |FINSI;

     #902#15 = #46#44;
     #902#16 = #46#43;

     #902#19 = #56#19;
     #902#20 = #56#20 - #56#48;
     #902#21 = #56#21 - #56#49;

     #46#1   = #56#12;
     #46#2   = #56#19;
     |LEE 000#46=;
     |SI FSalida ! 0;  |DDEFECTO #46;  |FINSI;
     |CIERRA #46;

     #902#22 = #46#44;
     #902#23 = #46#43;

     #902#28 = #56#26;
     #902#29 = #3#10;
     #902#30 = #56#28;
     #902#31 = #56#29;
     #902#32 = #56#30;
     #902#33 = #56#31;
     #902#36 = #3#8;
     #902#37 = #3#11;

     |SI #902#3 = "01.01.0000";  #902#3 = #902#2;  |FINSI;

     |C_M #902#24, 1, "S";
     |C_M #902#25, 1, "S";
     |SI #902#19 = "               ";
         |C_M #902#24, 1, "N";
         |C_M #902#25, 1, "N";

         #902#20 = 0;
         #902#21 = 0;
         #902#22 = 0;
         #902#23 = 0;
         #902#24 = 0;
         #902#25 = 0;
     |FINSI;

     |SI #142#185 = "S";
         #902#0 = #142#193;
         |PTEC 802;
         |PTEC 802;
     |FINSI;

     |PINPA #0#902;
     |PINDA #0#902;
     |ENDATOS #1#902;
     |SI FSalida = 0;
         |HAZ AdjudicacionTinte;
     |SINO;
         |SI enRechazar = 0;
             |SI FSalida ! 0;
                  ||ARA
                  aUsaPar = #902#29;
                  |QBF aUsaPar;
                  aPedPar = #3#10;
                  |QBF aPedPar;
                  |SI aUsaPar ! ""; |Y aPedPar = "";
                        ||Ticket. 298.
                        ||Hemos creado una partida nueva vacia, que no habiamos usado antes en esta linea
                        nAlmBorra = #3#3;
                        aParBorra = #902#29;
                        aTipoMov = "entrada";
                        |HAZ BorraPartida;
                  |FINSI;
             |SINO;
                  #3#10 = #902#29;
                  #3#11 = #902#37;
                  |GRABA 020#3a;
             |FINSI;
         |SINO;
             |HAZ BorraPedido;

             |BORRA 020#3a;
         |FINSI;
         |LIBERA #3;
     |FINSI;

     |FINVENTANA nVentana2;
|FPRC;

|PROCESO Boton17;
     |FINVENTANA nVentana1;
     nVentana1 = -1;

     |SI #3#13 = 0;  |HAZ AdjudicaNormal;   |FINSI;
     |SI #3#13 ! 0;  |HAZ AdjudicaTintado;  |FINSI;

     nPtec  = &"A";  |PTEC nPtec;
|FPRC;

|PROCESO Boton15;
     |ABRE #13;
     |LEE 000#13p;
     |SI FSalida ! 0;  |DDEFECTO #13;  |FINSI;
     |CIERRA #13;

     eaHoraPed = (("00" + #3#5) % -102) + ":" + (("00" + #3#5) % -102);
     eaDefImpre = #13#6;
     ser_ped    = #3#0;
     num_ped    = #3#1;
     enTintado  = #3#13;
     |SUB_EJECUTA_NP "agifa100";
|FPRC;

|PROCESO Boton19;
     |ABRE #13;
     |LEE 000#13p;
     |SI FSalida ! 0;  |DDEFECTO #13;  |FINSI;
     |CIERRA #13;

     eaHoraPed = (("00" + #3#5) % -102) + ":" + (("00" + #3#5) % -102);
     eaDefImpre = #13#6;
     ser_ped    = #3#0;
     num_ped    = #3#1;
     enTintado  = #3#13;
     |SUB_EJECUTA_NP "agifa100;FAX";
|FPRC;

|PROCESO Boton20;
     |ABRE #13;
     |LEE 000#13p;
     |SI FSalida ! 0;  |DDEFECTO #13;  |FINSI;
     |CIERRA #13;

     eaHoraPed = (("00" + #3#5) % -102) + ":" + (("00" + #3#5) % -102);
     eaDefImpre = #13#6;
     ser_ped    = #3#0;
     num_ped    = #3#1;
     enTintado  = #3#13;
     |SUB_EJECUTA_NP "agifa100;EMAIL";
|FPRC;




|PROCESO Boton16;
     |FINVENTANA nVentana1;
     nBoton = 16;

     |VENTANA 0501, 3399, -1, -1, "";
     nVentana2 = FSalida;

     |SI #3#13 = 0;
         ser_ped    = #3#0;
         num_ped    = #3#1;
         aAlfa      = "albz0008;MODIFICA";
         |SUB_EJECUTA aAlfa;
     |SINO;
         enTintado  = #3#13;
         aAlfa      = "albm0056;MODIFICA";
         |SUB_EJECUTA aAlfa;
     |FINSI;

     |FINVENTANA nVentana2;
     |PTEC 802;
|FPRC;

|PROCESO MenuPendiente;
|ET Arriba;
     |VENTANA 0835, 2065, -1, -1, "";
     nVentana1 = FSalida;

     nBoton = 0;
     |CONTROL_SIMPLE 0,"BOTON,{{205}}Imprimir Pedido", 0936, 0964,  Boton15;
     nBoton15 = FSalida;

     |CONTROL_SIMPLE 0,"BOTON,{{205}}Envio Fax", 1136, 1164,  Boton19;
     nBoton19 = FSalida;

     |CONTROL_SIMPLE 0,"BOTON,{{205}}Envio Email", 1336, 1364,  Boton20;
     nBoton20 = FSalida;

     |CONTROL_SIMPLE 0,"BOTON,{{218}}Modificar Pedido", 1536, 1564,  Boton16;
     nBoton16 = FSalida;

     |CONTROL_SIMPLE 0,"BOTON,{{218}}Adjudicar Pedido", 1736, 1764,  Boton17;
     nBoton17 = FSalida;

     |ESTADO_CONTROL nBoton15, "ENABLE";
     |ESTADO_CONTROL nBoton16, "ENABLE";
     |ESTADO_CONTROL nBoton17, "ENABLE";
     |ESTADO_CONTROL nBoton19, "ENABLE";
     |ESTADO_CONTROL nBoton20, "ENABLE";

     |SI #51#1 = "C";  |ESTADO_CONTROL nBoton16, "DISABLE";  |FINSI;
     |SI #51#2 = "N";  |ESTADO_CONTROL nBoton17, "DISABLE";  |FINSI;

     |LEETECLA aTecla;

     |FIN_CONTROL_WINDOWS nBoton15;
     |FIN_CONTROL_WINDOWS nBoton16;
     |FIN_CONTROL_WINDOWS nBoton17;
     |FIN_CONTROL_WINDOWS nBoton19;
     |FIN_CONTROL_WINDOWS nBoton20;

     |SI nBoton = 16;  |VETE Arriba;  |FINSI;

     |SI nVentana1 ! -1;  |FINVENTANA nVentana1;  |FINSI;

     |PULSATECLA;
|FPRC;

|PROCESO Evento3;
     |SI FSalida = 1;
         |LEE 040#3c;
     |FINSI;

     |SI FSalida = 4;
         |LEE 040#3c;
         |SI FSalida ! 0;  |ACABA;  |FINSI;

         |HAZ MenuPendiente;

         |REFRESCACONTROL nGrid4;
         FSalida = "SKIPDEFAULT";
     |FINSI;
|FPRC;

|PROCESO Boton1;
     nTecla = 1;
|FPRC;

|PROCESO Boton2;
     nSalir = 1;
     |PTEC 806;
|FPRC;

|PROCESO Boton3;
     |LEE 000#2=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |ABRE #81;
     #81#25 = #2#0;
     #81#0  = #2#1;
     |LEE 040#81=;
     |SI FSalida ! 0;  |CIERRA #81;  |ACABA;  |FINSI;
     |CIERRA #81;

     |HAZ PedComEnt;
|FPRC;

|PROCESO Boton4;
     |LEE 000#2=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |ABRE #81;
     #81#25 = #2#0;
     #81#0  = #2#1;
     |LEE 040#81=;
     |SI FSalida ! 0;  |CIERRA #81;  |ACABA;  |FINSI;
     |CIERRA #81;

     |ABRE #67;
     #67#25 = #2#0;
     #67#0  = #2#1;
     #67#1  = 1;
     |LEE 040#67=;
     |SI FSalida ! 0;  |CIERRA #67;  |ACABA;  |FINSI;
     |CIERRA #67;

     |HAZ PedComEntL;
|FPRC;

|PROCESO Boton5;
     |LEE 000#2=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |ABRE #6;
     #6#0 = #2#0;
     #6#1 = #2#1;
     |LEE 040#6=;
     |SI FSalida ! 0;  |DDEFECTO #6;  |FINSI;
     |CIERRA #6;

     efFecha  = #6#2;
     |HAZ PedComVal;
|FPRC;

|PROCESO Boton6;
     |LEE 000#2=;
     |SI FSalida ! 0;  |ACABA;  |FINSI;

     |SI #2#12 = 0;
         |MENAV "0000 No existe Albaran.";
         |ACABA;
     |FINSI;

     |ABRE #7;
     #7#0 = #2#11;
     #7#1 = #2#12;
     |LEE 040#7=;
     |SI FSalida ! 0;  |DDEFECTO #7;  |FINSI;
     |CIERRA #7;

     efFecha = #7#2;
     |HAZ AlbComVal;
|FPRC;

|PROCESO Ptec;
     |PTEC 807;
|FPRC;

|PROCESO Boton11;
     |SUB_EJECUTA_NP "albz0008;MANUAL";

     |REFRESCACONTROL nGrid1;
     |REFRESCACONTROL nGrid2;
     |REFRESCACONTROL nGrid3;
     |REFRESCACONTROL nGrid4;
|FPRC;

|PROCESO Boton18;
     enTintado = 0;
     |SUB_EJECUTA_NP "albm0056;MANUAL";

     |REFRESCACONTROL nGrid1;
     |REFRESCACONTROL nGrid2;
     |REFRESCACONTROL nGrid3;
     |REFRESCACONTROL nGrid4;
|FPRC;

|PROCESO Boton12;
     |VENTANA 1030, 1460, -1, -1, "";
     nVentana = FSalida;

     |ATRI R; |PINTA 1030, "Usar Partida";  |ATRI r;
     |PINTA 1232, " Inserte el numero de partida";

     aPartida = "";
     E_inf    = "";
     E_sup    = "15";
     aPartida = 1332 ? 1;  |QBF aPartida;

     |FINVENTANA nVentana;

     |SI aPartida = "";  |ACABA;  |FINSI;

     aCod1 = "";
     aCod2 = "";
     aProvPartida = "";
     |ABRE #224;
     |SELECT #3#224;
     #224#2 = aPartida;
     |LEE 040#224=;
     |SI FSalida = 0;
         aCod1 = #224#0;
         aCod2 = #224#1;
         aProvPartida = #224#3;
     |FINSI;
     |CIERRA #224;

     #1#9 = aPartida;

     |PTEC 802;
|FPRC;

|PROCESO Tipo12z1;  |TIPO 12;
     nNume     = #0#0;
     nNume     = nNume - #0#4;
     fDFecha   = nNume;

     nNume     = #0#0;
     nNume     = nNume + #0#4;
     fHFecha   = nNume;


     |HAZ MiraEstadoOpenClose;

     |REFRESCACONTROL nGrid1;
     |REFRESCACONTROL nGrid2;
     |REFRESCACONTROL nGrid3;
     |REFRESCACONTROL nGrid4;

|| Botones Pantalla 1

     |CONTROL_SIMPLE nPanta1,"BOTON,{{206}} Datos Nuevos",  2370, 2385, Boton1;
     nBoton1  = FSalida;

     |CONTROL_SIMPLE nPanta1,"BOTON,{{207}} Salir",  2390, 2398, Boton2;
     nBoton2  = FSalida;

|| Botones Pantalla 2

     |CONTROL_SIMPLE nPanta2,"BOTON,{{206}} Datos Nuevos",  2370, 2385, Boton1;
     nBoton3  = FSalida;

     |CONTROL_SIMPLE nPanta2,"BOTON,{{207}} Salir",  2390, 2398, Boton2;
     nBoton4  = FSalida;

     |CONTROL_SIMPLE nPanta2,"BOTON,Pedido Manual",  2330, 2345, Boton11;
     nBoton5  = FSalida;

     |CONTROL_SIMPLE nPanta2,"BOTON,{{137}} Usar Partida",  2310, 2325, Boton12;
     nBoton6  = FSalida;

     |CONTROL_SIMPLE nPanta2,"BOTON,Tintado",  2350, 2365, Boton18;
     nBoton18 = FSalida;

|| Botones Pantalla 3

     |CONTROL_SIMPLE nPanta3,"BOTON,{{206}} Datos Nuevos",  2370, 2385, Boton1;
     nBoton7  = FSalida;

     |CONTROL_SIMPLE nPanta3,"BOTON,{{207}} Salir",  2390, 2398, Boton2;
     nBoton8  = FSalida;

     |CONTROL_SIMPLE nPanta3,"BOTON,{{137}} Entrega",  2301, 2310, Boton3;
     nBoton9  = FSalida;

     |CONTROL_SIMPLE nPanta3,"BOTON,{{137}} Entrega Real",  2312, 2325, Boton4;
     nBoton10 = FSalida;

     |CONTROL_SIMPLE nPanta3,"BOTON,{{137}} Valor Pedido",  2327, 2340, Boton5;
     nBoton11 = FSalida;

     |CONTROL_SIMPLE nPanta3,"BOTON,{{137}} Valor Albaran",  2342, 2355, Boton6;
     nBoton12 = FSalida;

|| Botones Pantalla 4

     |CONTROL_SIMPLE nPanta4,"BOTON,{{206}} Datos Nuevos",  2370, 2385, Boton1;
     nBoton13  = FSalida;

     |CONTROL_SIMPLE nPanta4,"BOTON,{{207}} Salir",  2390, 2398, Boton2;
     nBoton14  = FSalida;

     |ESTADO_CONTROL nBoton6, "DISABLE";

     aEsc1 = &255 + "806";
     aEsc2 = &255 + "807";
     aRetu = &255 + "802";
     |PARA;  |SI; |HACIENDO;
             ||PULSATECLA;
             |LEETECLA aTecla;

             |SI aTecla = aEsc1; |SAL; |FINSI;
             |SI aTecla = aEsc2; |SAL; |FINSI;
             |SI aTecla = aRetu; |SAL; |FINSI;
             |SI nTecla  = 1;  |SAL;  |FINSI;
             |SI nSalir  = 1;  |SAL;  |FINSI;
     |SIGUE;

     |DESTRUYECONTROL nBoton1;
     |DESTRUYECONTROL nBoton2;
     |DESTRUYECONTROL nBoton3;
     |DESTRUYECONTROL nBoton4;
     |DESTRUYECONTROL nBoton5;
     |DESTRUYECONTROL nBoton6;
     |DESTRUYECONTROL nBoton7;
     |DESTRUYECONTROL nBoton8;
     |DESTRUYECONTROL nBoton9;
     |DESTRUYECONTROL nBoton10;
     |DESTRUYECONTROL nBoton11;
     |DESTRUYECONTROL nBoton12;
     |DESTRUYECONTROL nBoton13;
     |DESTRUYECONTROL nBoton14;
     |DESTRUYECONTROL nBoton18;

     |PULSATECLA;
|FPRC;

|PROCESO Tipo80;  |TIPO 80;
     |ABRET #1;
     |ABRET #2;
     |ABRET #3;

     FSalida = 2499;
|FPRC;

|PROCESO Tipo90;  |TIPO 90;
     |CIERRAT #1;
     |CIERRAT #2;
     |CIERRAT #3;
|FPRC;

|PROCESO CargaVar;
     |ABRE #agifa324;
     |DDEFECTO #agifa324;
     #agifa324#0 = "EUR";
     |LEE 000#agifa324.=;
     EURODB = #agifa324#9;
     nDecTotales = #agifa324#7;
     |CIERRA #agifa324;


     nDeci_Base      = nDecTotales;
     nDeci_BaseMxP   = nDecTotales;
     nDeci_BaseMx    = nDecTotales;
     nDeci_Div       = nDecTotales;
     nDeci_DivP      = nDecTotales;
     nDeci_TotVisP   = nDecTotales;
     nDeci_TotNoVisP = nDecTotales;
     nDeci_TotVisF   = nDecTotales;
     nDeci_DivF      = nDecTotales;
     nDeci_TotNoVisF = nDecTotales;

     nDeci_PreBase   = EURODB;
     nDeci_PreBasMxP = EURODB;
     nDeci_PreBaseMx = EURODB;
     nDeci_PreDivP   = EURODB;
     nDeci_PreDiv    = EURODB;
     nDeci_PreVisP   = EURODB;
     nDeci_ImpVisP   = EURODB;
     nDeci_PreDivF   = EURODB;
     nDeci_PreVisF   = EURODB;
     nDeci_ImpVisF   = EURODB;
|FPRC;


|PROCESO EntradaFec; |TIPO 7;
     nModo = (FEntrada / 100) ! 0;
     |SI nModo = 1;
          ||#albm0001#0 = ~;
          #albm0001#0 = #albz0001#0;
          |PINTA #albm0001#0;
     |FINSI;
|FPRC;

|PROCESO Tipo3; |TIPO 30;
     |REFRESCACONTROL nGrid1;
     |PULSATECLA;
|FPRC;

|PROCESO CtrlAlm; |TIPO 0;
     |SI #1#2 ! #0#1;
          aMensaje = "0000Almacen distinto al almacen seleccionado en la cabecera";
          |MENAV aMensaje;
          |ERROR;
     |FINSI;
|FPRC;

|PROCESO dsm00024_borra;
     |BORRA 020#dsm00024.a;
     |LIBERA #dsm00024;
|FPRC;

|DEFBUCLE dsm00024_borra;
 #dsm00024#1;
 ;
 "                    ", nAlmBorra, aParBorra;
 "zzzzzzzzzzzzzzzzzzzz", nAlmBorra, aParBorra;
 be;
 NULL, dsm00024_borra;
|FIN;

|PROCESO BorraPartida;
     |ABRE #46;
     #46#1 = nAlmBorra;
     #46#2 = aParBorra;
     |LEE 101#46=;
     |SI FSalida = 0;
          |SI #46#9 = 0; |Y #46#10 = 0; |Y #46#11 = 0; |Y #46#12 = 0; |Y #46#31 = 0; |Y #46#32 = 0; |Y #46#43 = 0; |Y #46#44 = 0;
               enAlberoDentro = 1;
               |BORRA 020#46a;
               |LIBERA #46;
               |BUCLE dsm00024_borra;
               enAlberoDentro = 0;
               |HAZ DesContador;
          |FINSI;
     |FINSI;
     |CIERRA #46;
|FPRC;

|PROCESO DesContador;
     |ABRE #albm0045;
     #albm0045#0 = nAlmBorra;
     #albm0045#1 = aTipoMov;
     |LEE 101#albm0045.=;
     |SI FSalida = 0;
          |SI #albm0045#2 > 0;
               aParConta = (#albm0045#2 + "               ") % 115;
               |SI aParBorra = aParConta;
                    #albm0045#2 = #albm0045#2 - 1;
                    |GRABA 020#albm0045.a;
               |FINSI;
          |FINSI;
          |LIBERA #albm0045;
     |FINSI;
     |CIERRA #albm0045;
|FPRC;

|PROCESO MiraEstadoOpenClose;
     aDCerrado = "N";
     aHCerrado = "N";
     |SI #0#3 = "S";
         aDCerrado = " ";
         aHCerrado = "z";
     |FINSI;
|FPRC;


|PROGRAMA;
     |ABRE #51;
     #51#0 = Usuario % 810;
     |LEE 000#51=;
     |SI FSalida ! 0;  |DDEFECTO #51;  |FINSI;
     |CIERRA #51;

     |SI #51#1 = "N";
         |MENAV "0000 Usted no tiene permiso para entrar en esta opcion.";
         |ACABA;
     |FINSI;

     |ABRE #142; |LEE 000#142p; |CIERRA #142;
     |CLS;

     |PINPA #0#0;  nPanta0 = FSalida;

     |DDEFECTO #0;

     |HAZ CargaVar;

     nNume     = #0#0;
     nNume     = nNume - #0#4;
     fDFecha   = nNume;

     nNume     = #0#0;
     nNume     = nNume + #0#4;
     fHFecha   = nNume;

     nPos1     = 0501;
     nPos2     = 2299;
     aDCerrado = "N";
     aHCerrado = "N";

     |PINPA #1#0;   nPanta1 = FSalida;

     nRango = 4 + 8 + 16 + 32 + 128;
     |LINEAL_SIMPLE #1#1, nRango, nPos1, nPos2, ClaveBaja1, ClaveAlta1, Evento1;
     nGrid1 = FSalida;

     |PINPA #2#0;   nPanta2 = FSalida;

     nRango     = 1 + 4 + 8 + 16 + 32 + 128;
     |LINEAL_SIMPLE #1#1, nRango, nPos1, nPos2, ClaveBaja1, ClaveAlta1, Evento1;
     nGrid2 = FSalida;

     |PINPA #3#0;   nPanta3 = FSalida;

     nRango = 4 + 8 + 16 + 32 + 128;
     |LINEAL_SIMPLE #2#2, nRango, nPos1, nPos2, ClaveBaja2, ClaveAlta2, Evento2;
     nGrid3 = FSalida;

     |PINPA #4#0;   nPanta4 = FSalida;

     nRango = 4 + 8 + 16 + 32 + 128;
     |LINEAL_SIMPLE #2#3, nRango, nPos1, nPos2, ClaveBaja3, ClaveAlta3, Evento3;
     nGrid4 = FSalida;

     |PINDA #0#0;
     |PARA;  |SI;  |HACIENDO;
          |ENDATOS #1#0;
          |SI nTecla = 0;  |SAL;  |FINSI;
          |PULSATECLA;
          |PULSATECLA;
          |PULSATECLA;
          nTecla = 0;
     |SIGUE;

     |DESTRUYECONTROL nGrid1;
     |DESTRUYECONTROL nGrid2;
     |DESTRUYECONTROL nGrid3;
     |DESTRUYECONTROL nGrid4;

     |PULSATECLA;
|FPRO;
