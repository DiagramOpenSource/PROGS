|FICHEROS;
     diam0001;
     diam0002;
     diam0004;
|FIN;

|PROCESO diam0002;
     |SI #diam0002#4 ] #diam0004#1;|Y #diam0002#4 [ #diam0004#2;
          #diam0001#20 = #diam0001#20 +. #diam0002#11;
          #diam0001#21 = #diam0001#21 +. #diam0002#9;
          |SI #diam0001#20 ! 0;|O #diam0001#21 ! 0;
               #diam0001#22 = ((#diam0001#21 - #diam0001#20) / #diam0001#21) * 100;
          |SINO;
               #diam0001#22 = 0;
          |FINSI;
     |FINSI;

     #diam0001#16 = #diam0001#16 +. #diam0002#11;
     #diam0001#17 = #diam0001#17 +. #diam0002#9;
     |SI #diam0001#16 ! 0;|O #diam0001#17 ! 0;
          #diam0001#19 = ((#diam0001#17 - #diam0001#16) / #diam0001#17) * 100;
     |SINO;
          #diam0001#19 = 0;
     |FINSI;

     |GRABA 020#diam0001.a;
|FPRC;

|PROCESO diam0001;
     #diam0001#16 = 0;
     #diam0001#17 = 0;
     #diam0001#19 = 0;
     #diam0001#20 = 0;
     #diam0001#21 = 0;
     #diam0001#22 = 0;
|FPRC;

|DEFBUCLE diam0001;
     #diam0001#1;
     ;
     INICIO;
     FINAL;
     be;
     NULL, diam0001, diam0002;
|FIN;

|PROGRAMA;
     |CLS;
     |CABEZA "Margen HARD";
     |PINPA #0#diam0004;
     |ABRE #diam0004;
     |LEE 101#diam0004.=;
     |SI FSalida ! 0;    |GRABA 020#diam0004.b;   |FINSI;
     |PINDA #0#diam0004;
     |ENDATOS #1#diam0004;
     |SI FSalida = 0;
          |GRABA 020#diam0004.a;

          |AVISO;
          |CONFI "0000SRecalcular acumulados";
          |SI FSalida = 0;
               |BUCLE diam0001;
          |FINSI;
     |FINSI;
     |LIBERA #diam0004;
     |CIERRA #diam0004;
|FPRO;
