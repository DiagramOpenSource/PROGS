*************************DEFINICION DEL TXT *****************************

C1|                 //cAB.1 Datos del cliente al que se dirige la oferta
28|                      -- usuario
28|                      -- contraseña
2004-05-11|                   -- fecha_actual
|                        -- cliente
CONTRATAS CENTRO,SA|               -- nom_cliente
CL Dr.Esquerdo, 59|           -- direccion_cliente
MADRID|                       -- poblacion_cliente
28007|                        -- CP_cliente
MADRID|                       -- provincia_cliente


C2|                 //CAB.2 Direcciones de la obra y del envío
Avda.Catalu¤a cv Isla de Palma|         -- direccion_obra
MADRID|                       -- provincia_obra
28000|                        -- CP_obra
SAN SEBASTIAN DE LOS REYES|        -- poblacion_obra
CL Dr.Esquerdo, 59|           -- direccion_envio
MADRID|                       -- poblacion_envio
28007|                        -- CP_envio
|
                         -- provincia_envío


C3|                 //CAB.3 Descripción de la obra
aaaaaaa|                 -- descripcion_obra
AAAA|                         -- persona_contacto
915040360|                    -- telefono_contacto
915040435|                    -- fax
|                        -- jefe_obra
|                        -- telefono_obra
|                        -- fax_obra
|                        -- arquitecto


C4|                 //CAB.4 ...
|                        -- colegio arquitecto
2004-05-11|                   -- fecha_sumin
S|                       -- ritmo_suministro
|                        -- observaciones
PAGARE 120 DIAS FECHA FRA|         -- forma_pago
2004-05-11|                   -- validez_de   //validez de la oferta
2004-12-31|                   -- validez_a


C5|                 //CAB.5 ...
LADRILLOS SUCHIL,SL|               -- comercial
1|                       -- num_productos


L|                  //LINE
|                        -- descripcion
10000|                        -- cantidad
1,50|                         -- precio
15.01.2004|                   -- plazo_entrega
********************************************************************
|FICHEROS;
     web20007 #7;   || Registro Correo (CAB)
     web20008 #8;   || Registro Correo (LIN)
     web20001 #1;      || Parametros
|FIN;

|VARIABLES;
     nLin      = 0;
     aFic      = "";
     aNombre   = "";
     aHora     = "";
     i         = 0;
     nHandle   = 0;
     aAlfa     = "";
     aAlfa2    = "";
     aMensaje  = "";
     nLinea    = 0;
     aDir      = "";
     aNom      = "";
     aTipo = "";
{100}aCampos = "";
     aCampo = "";
     aReg = "";
     aReg1 = "";
     aReg2 = "";
     aReg3 = "";
     aReg4 = "";
     aReg5 = "";
     aLon = "";
     nPos = 0;
     fFecha = "";
     aUsu = "";
     aCli = "";
|FIN;

|PROCESO Fecha;
     aAlfa = (aAlfa % -102) + "/" + (aAlfa % 602) + "/" + (aAlfa % 104);
|FPRC;

|PROCESO Split;
     IaCampos = aCampos1<-;
     aLon = aReg % A0;
     |PARA i = 1; |SI i [ aLon; |HACIENDO i = i + 1;
          nPos = i * 100 + 1;
          aAlfa = aReg % nPos;
          |SI aAlfa = "|";
               aCampos = aCampo;
               aCampo = "";
               IaCampos = IaCampos + 1;
          |SINO;
               aCampo = aCampo + aAlfa;
          |FINSI;
     |SIGUE;
|FPRC;

|PROCESO Lineas;
     nLin = nLin + 1;
     |DDEFECTO #8;
     #8#0 = #7#0;
     #8#1 = #7#1;
     #8#2 = #7#2;
     #8#3 = nLin;
     |LEE 000#8=;
     |SI FSalida ! 0;
          |HAZ Split;
          #8#5 = aCampos2; ||Descr
          #8#7 = aCampos3; ||Cantid
          #8#8 = aCampos4; ||Precio
          aAlfa = aCampos5; |HAZ Fecha;
          #8#10 = aAlfa; ||F.Entrega
          #8#9 = #8#7 * #8#9
          |GRABA 020#8n;
     |FINSI;
|FPRC;

|PROCESO Cabecera;
     aTipo = aReg % 201;
     |SI aTipo = 1; aReg1 = aReg; |FINSI;
     |SI aTipo = 2; aReg2 = aReg; |FINSI;
     |SI aTipo = 3; aReg3 = aReg; |FINSI;
     |SI aTipo = 4; aReg4 = aReg; |FINSI;
     |SI aTipo ! 5; |ACABA; |FINSI;
     aReg5 = aReg;

     |DDEFECTO #7;

     aReg = aReg1; |HAZ Split;
     aCli = aCampos5; |QBF aCli;
     |SI aCli = "";
          #7#0 = "999999";
     |SINO;
           #7#0 = aCampos5;
     |FINSI;
     aAlfa = aCampos4; |HAZ Fecha;
     #7#1 = aAlfa;
     |HORA aAlfa;
     #7#2 = aAlfa;
     #7#3 = aCampos6;
     #7#5 = aCampos7;
     #7#6 = aCampos8;
     #7#9 = aCampos9;
     #7#7 = aCampos10;

     aReg = aReg2; |HAZ Split;
     #7#17 = aCampos2;
     #7#18 = aCampos3;
     #7#19 = aCampos4;
     #7#20 = aCampos5;
     #7#21 = aCampos6;
     #7#22 = aCampos7;
     #7#23 = aCampos8;
     #7#24 = aCampos9;

     aReg = aReg3; |HAZ Split;
     #7#25 = aCampos2;
     #7#26 = aCampos3;
     #7#27 = aCampos4;
     #7#28 = aCampos5;
     #7#29 = aCampos6;
     #7#30 = aCampos7;
     #7#31 = aCampos8;
     #7#32 = aCampos9;

     aReg = aReg4; |HAZ Split;
     #7#33 = aCampos2;
     aAlfa = aCampos3; |HAZ Fecha;
     #7#34 = aAlfa;
     #7#35 = aCampos4;
     #7#36 = aCampos5;
     #7#37 = aCampos6;
     aAlfa = aCampos7; |HAZ Fecha;
     #7#38 = aAlfa;
     aAlfa = aCampos8; |HAZ Fecha;
     #7#39 = aAlfa;

     aCampos = aCampos5; |HAZ Split;
     #7#40 = aCampos2;
     #7#41 = aCampos3;
     |LEE 000#7=;
     |SI FSalida ! 0;
          |GRABA 020#7n;
     |FINSI;
|FPRC;

|PROCESO Registros;
     |PARA; |SI; |HACIENDO;
          |XLEE nHandle, 250, aReg;
          |SI FSalida < 0; |SAL; |FINSI;

          aTipo = aReg % 101;
          |SI aTipo = "C";
               nLin = 0;
               |HAZ Cabecera;
          |SINO;
               |HAZ Lineas;
          |FINSI;
     |SIGUE;
|FPRC;

|PROGRAMA;
     |ABRE #1; |LEE 101#1p; |CIERRA #1;
     aNombre = #1#3;  |QBF aNombre;

     |CLS;
     fFecha = ~;
     |HORA aHora;
     aHora = aHora % 105;
     aFic = aNombre;

     aDir = aFic + "*.of";
     |_PDIR aDir;
     |PARA; |SI FSalida = 0; |HACIENDO;
          aNom = aDir - aFic; |QBF aNom;
          |XABRE "U", aDir, nHandle;
          |SI FSalida < 0;
               aMensaje = "0000 Problemas procesando correo: " + aFic;
               |MENAV aMensaje;
               ||ACABA;
          |SINO;
               |ABRE #web20007;
               |ABRE #web20008;

               |HAZ Registros;
               |XCIERRA nHandle;

               aAlfa = aFic + aNom + "_";
               |COPIA_FICHERO aDir, aAlfa;
               |SI FSalida = 0; |FBORRA aDir; |FINSI;

               |CIERRA #web20007;
               |CIERRA #web20008;
          |FINSI;
          |_SDIR aDir;
     |SIGUE;
|FPRO;
