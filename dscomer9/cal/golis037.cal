|FICHEROS;
     golis037 #0;
     gomantho #1;
     gomantl1 #2;
     gopre001 #3;
     gopre004 #4;
     gopartia #6;
     gopre003 #7;
     gotmp010 #10;
     agifa019 #19;
     agifa039 #39;
     agifa024 #24;
     guerm039 #390;
     gopre001@;
|FIN;

|VARIABLES;
     &Tempo = "";
     aAlfa = "";
     aD = "";
     aH = "";
     nPre = 0;
     nDto = 0;
     aArt = "";
     aDes = "";
|FIN;

|PROCESO Tmp;
     |PRINT;
|FPRC;

|DEFBUCLE Tmp;
     #10#1;
     ;
     INICIO;
     FINAL;
     ;
     NULL, Tmp;
|FIN;

|PROCESO Gopartia;
     |DDEFECTO #24;
     #24#0 = #6#15;
     |LEE 000#24=;

     |DDEFECTO #19;
     #19#0 = #6#20;
     |LEE 000#19=;

     #39#0 = #6#20;
     #39#1 = #19#2;
     |LEE 000#39=;
     |SI FSalida = 0; |Y #6#28 ] #39#3; |Y #6#28 [ #39#4;
          nDto = #39#2;
     |SINO;
          |SI #24#39 = 1; nDto = #19#21; |FINSI;
          |SI #24#39 = 2; nDto = #19#22; |FINSI;
          |SI #24#39 = 3; nDto = #19#23; |FINSI;
          |SI #24#39 = 4; nDto = #19#150; |FINSI;
          |SI #24#39 = 5; nDto = #19#151; |FINSI;
          |SI #24#39 = 6; nDto = #19#152; |FINSI;
     |FINSI;
     |SI #24#39 = 1; nPre = #19#18; |FINSI;
     |SI #24#39 = 2; nPre = #19#19; |FINSI;
     |SI #24#39 = 3; nPre = #19#20; |FINSI;
     |SI #24#39 = 4; nPre = #19#147; |FINSI;
     |SI #24#39 = 5; nPre = #19#148; |FINSI;
     |SI #24#39 = 6; nPre = #19#149; |FINSI;
     nPre = nPre - (nPre * nDto / 100);

     #10#0 = #6#20;
     #10#1 = nPre;
     |LEE 000#10=;
     |SI FSalida ! 0;
          #10#1 = 0;
          |LEE 000#10];
          |SI FSalida = 0; |Y #10#0 = #6#20;
               |LEE 121#10=;
          |SINO;
               |DDEFECTO #10;
               #10#0 = #6#20;
               #10#1 = nPre;
               |GRABA 020#10b;
               #10#2 = #19#1;
               #10#3 = #19#5;
               #10#9 = 2;
          |FINSI;
     |FINSI;
     #10#5 = #10#5 + #6#10;
     #10#7 = #10#7 + #6#13;
     #10#8 = #10#8 + #6#14;
     |GRABA 020#10a;
     |LIBERA #10;
|FPRC;

|DEFBUCLE Gopartia;
     #6#3;
     ;
     #0#0, #0#1, #0#2, #0#4, aD, aD;
     #0#0, #0#1, #0#3, #0#5, aH, aH;
     ;
     NULL, Gopartia;
|FIN;

|PROCESO Gopre004;
     aArt = #4#5;
     aDes = #4#6;
     #390#0 = aArt;
     |LEE 000#390=;
     |SI FSalida = 0;
          aArt = #390#1;
          aDes = #390#2;
     |FINSI;

     |DDEFECTO #10;
     #10#0 = aArt;
     #10#1 = #4#9;
     |LEE 101#10=;
     |SI FSalida ! 0; |GRABA 020#10b; |FINSI;
     #10#2 = aDes;
     #10#3 = #4#7;
     #10#4 = #10#4 + (#4#8 * #7#7);
     #10#6 = #10#6 + (#4#11 * #7#7);
     #10#9 = 1;
     |GRABA 020#10a;
     |LIBERA #10;
|FPRC;

|DEFBUCLE Gopre004;
     #4#1;
     ;
     #7#0, #7#1, #7#2, #7#4, 001;
     #7#0, #7#1, #7#2, #7#4, 999;
     ;
     NULL, Gopre004;
|FIN;

|PROCESO Gopre003;
     |BUCLE Gopre004;
|FPRC;

|DEFBUCLE Gopre003;
     #7#1;
     ;
     #2#3, #2#4, aD, 001;
     #2#3, #2#4, aH, 999;
     ;
     NULL, Gopre003;
|FIN;

|PROCESO Lineas;
     |SI #2#3 ] #0#2; |Y #2#3 [ #0#3;
               |Y #2#4 ] #0#4; |Y #2#4 [ #0#5;
          |BUCLE Gopre003;
     |FINSI;
|FPRC;

|DEFBUCLE Expediente;
     #1#1;
     ;
     #0#0, #0#1;
     #0#0, #0#1;
     ;
     NULL, NULL, Lineas;
|FIN;

|PROCESO LinExpe;
     #3#0 = #2#3;
     #3#1 = #2#4;
     |LEE 020#3=;
     |SI FSalida = 0;
          |SALVA_DATOS #3;
          |REPON_DATOS #gopre001@;
          |GRABA 020#gopre001@.n;
     |FINSI;
|FPRC;

|DEFBUCLE LinExpe;
     #2#1;
     ;
     #0#0, #0#1, 001;
     #0#0, #0#1, 999;
     ;
     NULL, LinExpe;
|FIN;

|PROCESO Consulta; |TIPO 66;
     |DDEF aAlfa;
     aAlfa = aAlfa + "gopre001";
     |CARGA_DEF aAlfa, gopre001@;
     |SI FSalida ! 0; |ACABA; |FINSI;

     |HAZ CreaTempo; |NOME_DAT #gopre001@#Tempo#; |DELINDEX #gopre001@;
     |ABRE #gopre001@;
     |ABRE #3;
     |SI Campo = 2; |O Campo = 4;
          |BUCLE LinExpe;
          |CONSULTA_CLAVE #1#gopre001@;
          |SI FSalida = 0;
               #0#2 = #gopre001@#0; |PINTA #0#2;
               #0#4 = #gopre001@#1; |PINTA #0#4;
          |SINO;
               |ERROR;
          |FINSI;
     |SINO;
          |BUCLE LinExpe;
          |CONSULTA_CLAVE #1#gopre001@;
          |SI FSalida = 0;
               #0#3 = #gopre001@#0; |PINTA #0#3;
               #0#5 = #gopre001@#1; |PINTA #0#5;
          |SINO;
               |ERROR;
          |FINSI;
     |FINSI;
     |CIERRA #3;
     |CIERRA #gopre001@; |DELINDEX #gopre001@;
     |DESCARGA_DEF #gopre001;
|FPRC;

|PROCESO Tipo3; |TIPO 3;
     |HAZ CreaTempo; |NOME_DAT #10 Tempo; |DELINDEX #10; |ABRE #10;

     aD = " " * 20;
     aH = "z" * 20;

     Impresora = "Crystal Reports";
     |IMPRE 0;
     |SI FSalida = 0;
          |INFOR "golis037";
          |SI FSalida = 0;
               |ABRE #390;
               |BUCLE Expediente;
               |CIERRA #390;
               |ABRE #39;
               |ABRE #24;
               |ABRE #19;
               |BUCLE Gopartia;
               |CIERRA #19;
               |CIERRA #24;
               |CIERRA #39;
               |BUCLE Tmp;
               |PIEINF;
               |FININF;
          |FINSI;
          |FINIMP;
     |FINSI;

     |CIERRA #10; |DELINDEX #10; |HAZ BoraTempo;
|FPRC;
