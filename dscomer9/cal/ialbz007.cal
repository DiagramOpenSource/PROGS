|FICHEROS;
     ialbz007 #0;
|FIN;

|VARIABLES;
     &Tempo = "";
     &eaSerNuevo = "";
     &enNumNuevo = 0;
     aCli = "";
     nSwContinua = 0;
     aEmp = "";
     aFich = "";
     aFichero = "";
     aAuto = "";
     nHandle = 0;
     aBase = "";
     aAlfa = "";
     aProg = "";
     aDef = "";
     aMas = "";
     aPrograma = "";
     aParametro = "";
     aCliente = "";
     aTmp = "";
     i = 0;
     nPos = 0;
     aAlf1 = ""; aAlf2 = ""; aAlf3 = ""; aAlf4 = ""; aAlf5 = "";
     aAlf6 = ""; aAlf7 = ""; aAlf8 = ""; aAlf9 = "";
|FIN;

|PROCESO GraNueTxt;
     |XABRE "W", aFichero, nHandle;
     |XGRABA nHandle, aAlf1;
     |XGRABA nHandle, aAlf2;
     |XGRABA nHandle, aAlf3;
     |XGRABA nHandle, aAlf4;
     |XGRABA nHandle, aAlf5;
     |XGRABA nHandle, aAlf6;
     |XGRABA nHandle, aAlf7;
     |XGRABA nHandle, aAlf8;
     |XGRABA nHandle, aAlf9;
     |XCIERRA nHandle;
|FPRC;

|PROCESO LeeNueTxt;
     |XABRE "", aFichero, nHandle;

     |XLEE nHandle, 250, aAlf1; || Empresa
     |XLEE nHandle, 250, aAlf2; || Auto;
     |XLEE nHandle, 250, aAlf3; || Temporales;
     |XLEE nHandle, 250, aAlf4; || Programa;
     |XLEE nHandle, 250, aAlf5; || Cliente
     |XLEE nHandle, 250, aAlf6; || Pesta¤a
     |XLEE nHandle, 250, aAlf7; || aSwCarga
     |XLEE nHandle, 250, aAlf8; || Claves
     |XLEE nHandle, 250, aAlf9; || RegNuevo

     |XCIERRA nHandle;
|FPRC;

|PROCESO Ejecuta;
     |DDEF aDef;
     aMas = aDef + (aProg % 108) + ".mas";
     |XABRE "E", aMas, 0;
     |SI FSalida = 0;
          eaSerNuevo = "";
          enNumNuevo = 0;
          aPrograma = aProg % 108;
          aParametro = aProg - aPrograma;
          aAlfa = aPrograma + ";" + aParametro + aCliente;
          |SUB_EJECUTA_NP aAlfa;

          |SI eaSerNuevo ! "";
               |HAZ LeeNueTxt;
               aAlf9 = eaSerNuevo + (("000000"+enNumNuevo)%-106);
               |HAZ GraNueTxt;
          |FINSI;

          FSalida = 0;
     |FINSI;
|FPRC;

|PROCESO CreaTxtAvisos;
     |DFICE aFich;
     aEmp = aFich % -205;

     |DBASE aBase;
     aFichero = aBase + "fich/" + "A" + (Usuario % 810);

     |XABRE "E", aFichero, 0;
     |SI FSalida = 0;
          |AVISO;
          |MENAV "0000Este proceso solo puede ejecutarse una tarea por usuario";
          aAlfa = "0000NYa existe una tarea con el usuario [" + (Usuario % 810) + "]. ¿Continuar?"
          |CONFI aAlfa;
          nSwContinua = FSalida;
          |SI FSalida ! 0;
               |ACABA;
          |FINSI;
     |FINSI;

     |XABRE "W", aFichero, nHandle;

     |XGRABA nHandle, aEmp;
     |XGRABA nHandle, aAuto;
     |XGRABA nHandle, aTmp;
     |XGRABA nHandle, aProg;
     |XGRABA nHandle, aCliente;

     |XCIERRA nHandle;
|FPRC;

|PROCESO LeeTxtAvisos;
     aAuto = "";
     |XABRE "", aFichero, nHandle;

     |XLEE nHandle, 250, aEmp;
     |XLEE nHandle, 250, aAuto;
     |XLEE nHandle, 250, aTmp;
     |XLEE nHandle, 250, aProg;
     |XLEE nHandle, 250, aCliente;

     |XCIERRA nHandle;
|FPRC;

|PROCESO CreaTxt;
     |DFICE aFich;
     aEmp = aFich % -205;

     |DBASE aBase;
     aFichero = aBase + "fich/" + (Usuario % 810);

     |XABRE "E", aFichero, 0;
     |SI FSalida = 0;
          |AVISO;
          |MENAV "0000Este proceso solo puede ejecutarse una tarea por usuario";
          aAlfa = "0000NYa existe una tarea con el usuario [" + (Usuario % 810) + "]. ¿Continuar?"
          |CONFI aAlfa;
          nSwContinua = FSalida;
          |SI FSalida ! 0;
               |ACABA;
          |FINSI;
     |FINSI;

     |XABRE "W", aFichero, nHandle;

     |XGRABA nHandle, aEmp;
     |XGRABA nHandle, aAuto;
     |XGRABA nHandle, aTmp;
     |XGRABA nHandle, aProg;
     |XGRABA nHandle, aCliente;

     |XCIERRA nHandle;
|FPRC;

|PROCESO LeeTxt;
     aAuto = "";
     |XABRE "", aFichero, nHandle;

     |XLEE nHandle, 250, aEmp;
     |XLEE nHandle, 250, aAuto;
     |XLEE nHandle, 250, aTmp;
     |XLEE nHandle, 250, aProg;
     |XLEE nHandle, 250, aCliente;

     |XCIERRA nHandle;
|FPRC;

|PROGRAMA;
     aProg = PARAMETRO % 108;
     aAlfa = "|:dscomer9/" + PARAMETRO + " agif0041 " + #48#0;
     |SUB_EJECUTA_NP aAlfa;
|ACABA;



     |SI aProg = "ialbz008";
          |PARA i = 0; |SI i [ 6; |HACIENDO i = i + 1;
               |HAZ CreaTempo;
               aTmp = aTmp + Tempo;
               |NOME_DAT #0 Tempo; |DELINDEX #0;
          |SIGUE;
          |HAZ CreaTxt;
          |SI nSwContinua  = 0;
               |PARA; |SI; |HACIENDO;
                    aAlfa = "|:dscomer9/ialbz008 agif0041 " + #48#0;
                    |SUB_EJECUTA_NP aAlfa;
                    |HAZ LeeTxt;
                    |SI aAuto = ""; |SAL; |FINSI;
                    |HAZ Ejecuta;
                    |SI FSalida ! 0;
                         aAlfa = "0000Ejecuta:" + aProg;
                         |MENAV aAlfa;
                    |FINSI;
               |SIGUE;
          |FINSI;
          |PARA i = 0; |SI i [ 6; |HACIENDO i = i + 1;
               nPos = (8 * i + 1) * 100 + 8;
               aAlfa = aTmp % nPos;
               Tempo = aAlfa;
               |HAZ BoraTempo;
               |NOME_DAT #0 Tempo; |DELINDEX #0;
          |SIGUE;
          |FBORRA aFichero;
          |ACABA;
     |FINSI;
     |SI aProg = "ialbz010";
          aParametro = PARAMETRO - aProg;
          aCliente = aParametro % 106; |QBF aCliente;
          |HAZ CreaTempo;
          aTmp = Tempo;
          |NOME_DAT #0 Tempo; |DELINDEX #0;
          |HAZ CreaTxtAvisos;
          |SI nSwContinua  = 0;
               |PARA; |SI; |HACIENDO;
                    aAlfa = "|:dscomer9/ialbz010 agif0041 " + #48#0;
                    |SUB_EJECUTA_NP aAlfa;
                    |HAZ LeeTxtAvisos;
                    |SI aAuto = ""; |SAL; |FINSI;
                    |HAZ Ejecuta;
                    |SI FSalida ! 0;
                         aAlfa = "0000Ejecuta:" + aProg;
                         |MENAV aAlfa;
                    |FINSI;
               |SIGUE;
          |FINSI;
          Tempo = aTmp;
          |HAZ BoraTempo;
          |NOME_DAT #0 Tempo; |DELINDEX #0;
          |FBORRA aFichero;
          |ACABA;
     |FINSI;

     aAlfa = "|:dscomer9/" + PARAMETRO + " agif0041 " + #48#0;
     |SUB_EJECUTA_NP aAlfa;
|FPRO;
